const a0_0x2b5f55=a0_0x1ee3;function a0_0xb2e8(){const _0x3633b3=['$maxProdPerUnit','$category','$unit','$brand','428379IDUwyt','$product.quantity','1427472uYNPvf','/barcode_scanner','$secondary_unit','$product.floorlevel','ejs','aggregate','1284LypEuC','$primary_code','$product_code','$product.room_name','741159OLBpBV','$invoice','query','suppliers','$suppliers','Router','path','152HcbOFN','exports','$secondary_code','$paid_amount','$alertquantity','$product.bin','$product','status','5672023vkckBK','table\x20page','$product.bay','length','$maxStocks','$note','Raw\x20Materials','message','suppliers_docs','log','$return_data','8798801stLwXY','4yZtOvp','name','$warehouse_name','29500AgPDyg','20XrOsQr','$name','express','json','$due_amount','../middleware/auth','$product.type','../public/language/languages.json','$finalize','$_id','1246022seUBNy','get'];a0_0xb2e8=function(){return _0x3633b3;};return a0_0xb2e8();}(function(_0x2863cd,_0x1324a6){const _0x42754a=a0_0x1ee3,_0x3ca983=_0x2863cd();while(!![]){try{const _0x95aa00=-parseInt(_0x42754a(0x136))/0x1+-parseInt(_0x42754a(0x163))/0x2*(-parseInt(_0x42754a(0x13c))/0x3)+-parseInt(_0x42754a(0x13e))/0x4+parseInt(_0x42754a(0x166))/0x5*(parseInt(_0x42754a(0x144))/0x6)+parseInt(_0x42754a(0x157))/0x7+parseInt(_0x42754a(0x14f))/0x8*(-parseInt(_0x42754a(0x148))/0x9)+parseInt(_0x42754a(0x12c))/0xa*(parseInt(_0x42754a(0x162))/0xb);if(_0x95aa00===_0x1324a6)break;else _0x3ca983['push'](_0x3ca983['shift']());}catch(_0x5be950){_0x3ca983['push'](_0x3ca983['shift']());}}}(a0_0xb2e8,0xc10aa));const express=require(a0_0x2b5f55(0x12e)),app=express(),router=express[a0_0x2b5f55(0x14d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x2b5f55(0x131)),nodemailer=require('nodemailer');function a0_0x1ee3(_0x3e5082,_0x2b2672){const _0xb2e8d6=a0_0xb2e8();return a0_0x1ee3=function(_0x1ee3f2,_0x22c844){_0x1ee3f2=_0x1ee3f2-0x12c;let _0x5c1f23=_0xb2e8d6[_0x1ee3f2];return _0x5c1f23;},a0_0x1ee3(_0x3e5082,_0x2b2672);}var ejs=require(a0_0x2b5f55(0x142));const path=require(a0_0x2b5f55(0x14e)),users=require(a0_0x2b5f55(0x133));router[a0_0x2b5f55(0x137)]('/view',async(_0x5ef8fd,_0x20e2e6)=>{const _0x3750b8=a0_0x2b5f55;try{const _0x1192cd=parseInt(_0x5ef8fd[_0x3750b8(0x14a)]['start'])||0x0,_0x5b87f9=parseInt(_0x5ef8fd[_0x3750b8(0x14a)]['end'])||0xa;let _0x18ffc2;_0x18ffc2=await purchases[_0x3750b8(0x143)]([{'$lookup':{'from':'suppliers','localField':_0x3750b8(0x14b),'foreignField':_0x3750b8(0x164),'as':_0x3750b8(0x15f)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x3750b8(0x155)},{'$group':{'_id':_0x3750b8(0x135),'invoice':{'$first':_0x3750b8(0x149)},'suppliers':{'$first':_0x3750b8(0x14c)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3750b8(0x165)},'room':{'$addToSet':_0x3750b8(0x147)},'product':{'$push':_0x3750b8(0x155)},'note':{'$first':_0x3750b8(0x15c)},'paid_amount':{'$first':_0x3750b8(0x152)},'due_amount':{'$first':_0x3750b8(0x130)},'return_data':{'$first':_0x3750b8(0x161)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x3750b8(0x13d)},'level':{'$addToSet':_0x3750b8(0x159)},'isle':{'$addToSet':_0x3750b8(0x154)},'type':{'$addToSet':_0x3750b8(0x132)},'floorlevel':{'$addToSet':_0x3750b8(0x141)},'finalize':{'$first':_0x3750b8(0x134)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x1192cd},{'$limit':_0x5b87f9-_0x1192cd}]),_0x20e2e6[_0x3750b8(0x12f)](_0x18ffc2);}catch(_0x1d9fa0){console[_0x3750b8(0x160)](_0x3750b8(0x158),_0x1d9fa0),_0x20e2e6[_0x3750b8(0x156)](0xc8)['json']({'message':_0x1d9fa0[_0x3750b8(0x15e)]});}}),router['post'](a0_0x2b5f55(0x13f),async(_0x1c0a13,_0x456155)=>{const _0x2725e9=a0_0x2b5f55,{product_code:_0x53dce3}=_0x1c0a13['body'];var _0x7122c6;const _0x32919e=await product['aggregate']([{'$match':{'primary_code':_0x53dce3,'product_category':_0x2725e9(0x15d)}},{'$group':{'_id':_0x2725e9(0x135),'name':{'$first':_0x2725e9(0x12d)},'category':{'$first':_0x2725e9(0x139)},'brand':{'$first':_0x2725e9(0x13b)},'unit':{'$first':_0x2725e9(0x13a)},'alertquantity':{'$first':_0x2725e9(0x153)},'product_code':{'$first':_0x2725e9(0x146)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2725e9(0x151)},'maxStocks':{'$first':_0x2725e9(0x15b)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2725e9(0x140)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xc9bdda=await product[_0x2725e9(0x143)]([{'$match':{'secondary_code':_0x53dce3,'product_category':_0x2725e9(0x15d)}},{'$group':{'_id':_0x2725e9(0x135),'name':{'$first':_0x2725e9(0x12d)},'category':{'$first':_0x2725e9(0x139)},'brand':{'$first':_0x2725e9(0x13b)},'unit':{'$first':_0x2725e9(0x13a)},'alertquantity':{'$first':_0x2725e9(0x153)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2725e9(0x145)},'secondary_code':{'$first':_0x2725e9(0x151)},'maxStocks':{'$first':_0x2725e9(0x15b)},'maxProdPerUnit':{'$first':_0x2725e9(0x138)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x32919e['length']>0x0)_0x7122c6=_0x32919e;else _0xc9bdda[_0x2725e9(0x15a)]>0x0&&(_0x7122c6=_0xc9bdda);_0x456155[_0x2725e9(0x12f)](_0x7122c6);}),module[a0_0x2b5f55(0x150)]=router;