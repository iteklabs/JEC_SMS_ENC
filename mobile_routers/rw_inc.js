const a0_0x2a9b6c=a0_0x231c;(function(_0xb36aa9,_0x268764){const _0x5e5918=a0_0x231c,_0x2691b=_0xb36aa9();while(!![]){try{const _0x2df7dc=parseInt(_0x5e5918(0xea))/0x1+parseInt(_0x5e5918(0xe9))/0x2+-parseInt(_0x5e5918(0xef))/0x3+-parseInt(_0x5e5918(0xc7))/0x4*(parseInt(_0x5e5918(0xd7))/0x5)+-parseInt(_0x5e5918(0xbd))/0x6+-parseInt(_0x5e5918(0xd4))/0x7*(parseInt(_0x5e5918(0xed))/0x8)+-parseInt(_0x5e5918(0xdf))/0x9*(-parseInt(_0x5e5918(0xdd))/0xa);if(_0x2df7dc===_0x268764)break;else _0x2691b['push'](_0x2691b['shift']());}catch(_0x1f6e3d){_0x2691b['push'](_0x2691b['shift']());}}}(a0_0x12cb,0x30652));function a0_0x231c(_0x1c437e,_0x532175){const _0x12cbe4=a0_0x12cb();return a0_0x231c=function(_0x231c4a,_0xc3ef6f){_0x231c4a=_0x231c4a-0xbd;let _0x4615ce=_0x12cbe4[_0x231c4a];return _0x4615ce;},a0_0x231c(_0x1c437e,_0x532175);}const express=require(a0_0x2a9b6c(0xcc)),app=express(),router=express[a0_0x2a9b6c(0xf3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2a9b6c(0xc4)),auth=require(a0_0x2a9b6c(0xdc)),nodemailer=require(a0_0x2a9b6c(0xe0));function a0_0x12cb(){const _0x1d39b8=['$category','856728RIcZrG','$product.floorlevel','1106148ZIIvwx','$product.bay','Raw\x20Materials','get','Router','$secondary_code','$date','$product.type','1081512bgLKyR','$product.quantity','$product_code','../public/language/languages.json','end','$product.bin','$primary_code','../models/all_models','$finalize','/view','20QoeybF','$alertquantity','json','suppliers_docs','$name','express','suppliers','$maxProdPerUnit','message','/barcode_scanner','$note','start','$secondary_unit','7HycpQq','query','$unit','188115YYaHYP','$paid_amount','$_id','$invoice','log','../middleware/auth','30OqthiW','$batch_code','2214441gykijf','nodemailer','$brand','$product','length','ejs','$suppliers_docs','$maxStocks','exports','aggregate','487746gfgFmt','60380IbGvkH','$return_data'];a0_0x12cb=function(){return _0x1d39b8;};return a0_0x12cb();}var ejs=require(a0_0x2a9b6c(0xe4));const path=require('path'),users=require(a0_0x2a9b6c(0xc0));router[a0_0x2a9b6c(0xf2)](a0_0x2a9b6c(0xc6),async(_0x4f189b,_0x46d333)=>{const _0x220d55=a0_0x2a9b6c;try{const _0x45f065=parseInt(_0x4f189b['query'][_0x220d55(0xd2)])||0x0,_0x4be198=parseInt(_0x4f189b[_0x220d55(0xd5)][_0x220d55(0xc1)])||0xa;let _0x783e2a;_0x783e2a=await purchases[_0x220d55(0xe8)]([{'$lookup':{'from':_0x220d55(0xcd),'localField':'suppliers','foreignField':'name','as':_0x220d55(0xca)}},{'$unwind':_0x220d55(0xe5)},{'$unwind':_0x220d55(0xe2)},{'$group':{'_id':_0x220d55(0xd9),'invoice':{'$first':_0x220d55(0xda)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x220d55(0xf5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x220d55(0xd1)},'paid_amount':{'$first':_0x220d55(0xd8)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x220d55(0xeb)},'batch_code':{'$first':_0x220d55(0xde)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x220d55(0xe5)},'total_product_quantity':{'$sum':_0x220d55(0xbe)},'level':{'$addToSet':_0x220d55(0xf0)},'isle':{'$addToSet':_0x220d55(0xc2)},'type':{'$addToSet':_0x220d55(0xf6)},'floorlevel':{'$addToSet':_0x220d55(0xee)},'finalize':{'$first':_0x220d55(0xc5)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x45f065},{'$limit':_0x4be198-_0x45f065}]),_0x46d333[_0x220d55(0xc9)](_0x783e2a);}catch(_0x5c6bce){console[_0x220d55(0xdb)]('table\x20page',_0x5c6bce),_0x46d333['status'](0xc8)['json']({'message':_0x5c6bce[_0x220d55(0xcf)]});}}),router['post'](a0_0x2a9b6c(0xd0),async(_0x1790d2,_0x3728fa)=>{const _0x44c8fe=a0_0x2a9b6c,{product_code:_0x7f13c2}=_0x1790d2['body'];var _0x407d90;const _0x2d38a9=await product['aggregate']([{'$match':{'primary_code':_0x7f13c2,'product_category':_0x44c8fe(0xf1)}},{'$group':{'_id':_0x44c8fe(0xd9),'name':{'$first':_0x44c8fe(0xcb)},'category':{'$first':_0x44c8fe(0xec)},'brand':{'$first':_0x44c8fe(0xe1)},'unit':{'$first':_0x44c8fe(0xd6)},'alertquantity':{'$first':_0x44c8fe(0xc8)},'product_code':{'$first':_0x44c8fe(0xbf)},'primary_code':{'$first':_0x44c8fe(0xc3)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x44c8fe(0xe6)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x44c8fe(0xd3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x114d55=await product['aggregate']([{'$match':{'secondary_code':_0x7f13c2,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x44c8fe(0xd9),'name':{'$first':_0x44c8fe(0xcb)},'category':{'$first':'$category'},'brand':{'$first':_0x44c8fe(0xe1)},'unit':{'$first':_0x44c8fe(0xd6)},'alertquantity':{'$first':_0x44c8fe(0xc8)},'product_code':{'$first':_0x44c8fe(0xbf)},'primary_code':{'$first':_0x44c8fe(0xc3)},'secondary_code':{'$first':_0x44c8fe(0xf4)},'maxStocks':{'$first':_0x44c8fe(0xe6)},'maxProdPerUnit':{'$first':_0x44c8fe(0xce)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x44c8fe(0xd3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2d38a9['length']>0x0)_0x407d90=_0x2d38a9;else _0x114d55[_0x44c8fe(0xe3)]>0x0&&(_0x407d90=_0x114d55);_0x3728fa['json'](_0x407d90);}),module[a0_0x2a9b6c(0xe7)]=router;