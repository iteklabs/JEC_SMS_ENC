function a0_0x445f(_0x1e191b,_0x3be31c){const _0x238994=a0_0x2389();return a0_0x445f=function(_0x445f82,_0x217bc3){_0x445f82=_0x445f82-0x9c;let _0x117fff=_0x238994[_0x445f82];return _0x117fff;},a0_0x445f(_0x1e191b,_0x3be31c);}const a0_0x19a9d3=a0_0x445f;(function(_0x2405fc,_0x5ad5f7){const _0x22713f=a0_0x445f,_0x331649=_0x2405fc();while(!![]){try{const _0x39266d=-parseInt(_0x22713f(0xa3))/0x1*(-parseInt(_0x22713f(0xcd))/0x2)+parseInt(_0x22713f(0xcb))/0x3+parseInt(_0x22713f(0xd0))/0x4+parseInt(_0x22713f(0xae))/0x5+parseInt(_0x22713f(0xa4))/0x6+-parseInt(_0x22713f(0xcc))/0x7+-parseInt(_0x22713f(0xd2))/0x8*(parseInt(_0x22713f(0xb4))/0x9);if(_0x39266d===_0x5ad5f7)break;else _0x331649['push'](_0x331649['shift']());}catch(_0x4070d3){_0x331649['push'](_0x331649['shift']());}}}(a0_0x2389,0xc11f7));const express=require(a0_0x19a9d3(0x9e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x19a9d3(0xcf)),auth=require(a0_0x19a9d3(0xaf)),nodemailer=require('nodemailer');function a0_0x2389(){const _0x5082f7=['end','../models/all_models','3548600hnFLHp','$secondary_unit','20537448vcYfDz','$suppliers_docs','message','table\x20page','express','$product.bay','aggregate','$batch_code','$product.floorlevel','1vsgEjo','4148964mizALS','$due_amount','name','$product.bin','$unit','$maxProdPerUnit','ejs','$product.room_name','suppliers','$brand','5327040ICacLZ','../middleware/auth','$invoice','$product','get','log','9rUtQwS','$paid_amount','$finalize','$_id','$maxStocks','$product.quantity','query','/barcode_scanner','length','exports','$return_data','json','$category','/view','../public/language/languages.json','$product_code','$primary_code','$note','suppliers_docs','path','$suppliers','$name','status','4592427eVPsDO','8877995AKhahX','903272cDJSAJ'];a0_0x2389=function(){return _0x5082f7;};return a0_0x2389();}var ejs=require(a0_0x19a9d3(0xaa));const path=require(a0_0x19a9d3(0xc7)),users=require(a0_0x19a9d3(0xc2));router[a0_0x19a9d3(0xb2)](a0_0x19a9d3(0xc1),async(_0x152b20,_0x47db34)=>{const _0xe81632=a0_0x19a9d3;try{const _0xe4f44e=parseInt(_0x152b20[_0xe81632(0xba)]['start'])||0x0,_0x1504bb=parseInt(_0x152b20[_0xe81632(0xba)][_0xe81632(0xce)])||0xa;let _0x43ff00;_0x43ff00=await purchases[_0xe81632(0xa0)]([{'$lookup':{'from':_0xe81632(0xac),'localField':_0xe81632(0xac),'foreignField':_0xe81632(0xa6),'as':_0xe81632(0xc6)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0xe81632(0xb1)},{'$group':{'_id':'$_id','invoice':{'$first':_0xe81632(0xb0)},'suppliers':{'$first':_0xe81632(0xc8)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0xe81632(0xab)},'product':{'$push':'$product'},'note':{'$first':_0xe81632(0xc5)},'paid_amount':{'$first':_0xe81632(0xb5)},'due_amount':{'$first':_0xe81632(0xa5)},'return_data':{'$first':_0xe81632(0xbe)},'batch_code':{'$first':_0xe81632(0xa1)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0xe81632(0xd3)},'total_product_quantity':{'$sum':_0xe81632(0xb9)},'level':{'$addToSet':_0xe81632(0x9f)},'isle':{'$addToSet':_0xe81632(0xa7)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xe81632(0xa2)},'finalize':{'$first':_0xe81632(0xb6)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0xe4f44e},{'$limit':_0x1504bb-_0xe4f44e}]),_0x47db34['json'](_0x43ff00);}catch(_0x5ef018){console[_0xe81632(0xb3)](_0xe81632(0x9d),_0x5ef018),_0x47db34[_0xe81632(0xca)](0xc8)[_0xe81632(0xbf)]({'message':_0x5ef018[_0xe81632(0x9c)]});}}),router['post'](a0_0x19a9d3(0xbb),async(_0xaeee61,_0x37cb76)=>{const _0xe2a640=a0_0x19a9d3,{product_code:_0x2fbb23}=_0xaeee61['body'];var _0x166312;const _0x6304d3=await product[_0xe2a640(0xa0)]([{'$match':{'primary_code':_0x2fbb23,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0xe2a640(0xc9)},'category':{'$first':_0xe2a640(0xc0)},'brand':{'$first':_0xe2a640(0xad)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xe2a640(0xc4)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0xe2a640(0xb8)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xe2a640(0xd1)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x357f24=await product[_0xe2a640(0xa0)]([{'$match':{'secondary_code':_0x2fbb23,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0xe2a640(0xb7),'name':{'$first':_0xe2a640(0xc9)},'category':{'$first':_0xe2a640(0xc0)},'brand':{'$first':_0xe2a640(0xad)},'unit':{'$first':_0xe2a640(0xa8)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0xe2a640(0xc3)},'primary_code':{'$first':_0xe2a640(0xc4)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0xe2a640(0xb8)},'maxProdPerUnit':{'$first':_0xe2a640(0xa9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xe2a640(0xd1)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x6304d3[_0xe2a640(0xbc)]>0x0)_0x166312=_0x6304d3;else _0x357f24['length']>0x0&&(_0x166312=_0x357f24);_0x37cb76['json'](_0x166312);}),module[a0_0x19a9d3(0xbd)]=router;