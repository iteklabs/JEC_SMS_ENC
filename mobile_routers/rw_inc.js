const a0_0x2c010c=a0_0x3cce;function a0_0x58e9(){const _0x49c6d2=['aggregate','$brand','$return_data','$secondary_unit','body','1432qvndRc','$suppliers','1685643mvMRbJ','express','table\x20page','../models/all_models','log','../public/language/languages.json','Raw\x20Materials','$product_code','10vNAwNS','$maxStocks','$paid_amount','$_id','$product.bay','$suppliers_docs','6729606OHWbFS','$product.floorlevel','json','$date','$category','suppliers','5774395XhAemC','length','/view','$alertquantity','$warehouse_name','$product','$batch_code','6588912MwNLBi','suppliers_docs','$invoice','name','get','$product.quantity','$expiry_date','$maxProdPerUnit','16893290VNggxi','$product.type','296873UxrrQL','$secondary_code','ejs','query','$primary_code','message','37849NIhBRE','18VaXIxf','end','status','start','$due_amount','$unit','exports'];a0_0x58e9=function(){return _0x49c6d2;};return a0_0x58e9();}(function(_0x45b7fb,_0x2a4b11){const _0x1638e8=a0_0x3cce,_0x3f3c45=_0x45b7fb();while(!![]){try{const _0x248b42=parseInt(_0x1638e8(0x194))/0x1*(-parseInt(_0x1638e8(0x177))/0x2)+-parseInt(_0x1638e8(0x16f))/0x3+-parseInt(_0x1638e8(0x18a))/0x4+parseInt(_0x1638e8(0x183))/0x5+parseInt(_0x1638e8(0x17d))/0x6+parseInt(_0x1638e8(0x19a))/0x7*(-parseInt(_0x1638e8(0x16d))/0x8)+parseInt(_0x1638e8(0x19b))/0x9*(parseInt(_0x1638e8(0x192))/0xa);if(_0x248b42===_0x2a4b11)break;else _0x3f3c45['push'](_0x3f3c45['shift']());}catch(_0x38efbe){_0x3f3c45['push'](_0x3f3c45['shift']());}}}(a0_0x58e9,0xf2a13));function a0_0x3cce(_0x3a5dd3,_0x34b074){const _0x58e9dc=a0_0x58e9();return a0_0x3cce=function(_0x3cce81,_0x23b5b7){_0x3cce81=_0x3cce81-0x169;let _0x5a8638=_0x58e9dc[_0x3cce81];return _0x5a8638;},a0_0x3cce(_0x3a5dd3,_0x34b074);}const express=require(a0_0x2c010c(0x170)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2c010c(0x172)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require(a0_0x2c010c(0x196));const path=require('path'),users=require(a0_0x2c010c(0x174));router[a0_0x2c010c(0x18e)](a0_0x2c010c(0x185),async(_0x321ca8,_0x21c589)=>{const _0x1dc153=a0_0x2c010c;try{const _0xfa248=parseInt(_0x321ca8['query'][_0x1dc153(0x19e)])||0x0,_0x5712ae=parseInt(_0x321ca8[_0x1dc153(0x197)][_0x1dc153(0x19c)])||0xa;let _0x167cd7;_0x167cd7=await purchases[_0x1dc153(0x1a2)]([{'$lookup':{'from':_0x1dc153(0x182),'localField':_0x1dc153(0x182),'foreignField':_0x1dc153(0x18d),'as':_0x1dc153(0x18b)}},{'$unwind':_0x1dc153(0x17c)},{'$unwind':'$product'},{'$group':{'_id':_0x1dc153(0x17a),'invoice':{'$first':_0x1dc153(0x18c)},'suppliers':{'$first':_0x1dc153(0x16e)},'date':{'$first':_0x1dc153(0x180)},'warehouse_name':{'$first':_0x1dc153(0x187)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x1dc153(0x188)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x1dc153(0x179)},'due_amount':{'$first':_0x1dc153(0x19f)},'return_data':{'$first':_0x1dc153(0x16a)},'batch_code':{'$first':_0x1dc153(0x189)},'expiry_date':{'$first':_0x1dc153(0x190)},'suppliers_docs':{'$first':_0x1dc153(0x17c)},'total_product_quantity':{'$sum':_0x1dc153(0x18f)},'level':{'$addToSet':_0x1dc153(0x17b)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x1dc153(0x193)},'floorlevel':{'$addToSet':_0x1dc153(0x17e)},'finalize':{'$first':'$finalize'}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0xfa248},{'$limit':_0x5712ae-_0xfa248}]),_0x21c589[_0x1dc153(0x17f)](_0x167cd7);}catch(_0x25db80){console[_0x1dc153(0x173)](_0x1dc153(0x171),_0x25db80),_0x21c589[_0x1dc153(0x19d)](0xc8)[_0x1dc153(0x17f)]({'message':_0x25db80[_0x1dc153(0x199)]});}}),router['post']('/barcode_scanner',async(_0x6fe8b4,_0x5e57bf)=>{const _0x132154=a0_0x2c010c,{product_code:_0x534c45}=_0x6fe8b4[_0x132154(0x16c)];var _0x1977c3;const _0x53b4f0=await product[_0x132154(0x1a2)]([{'$match':{'primary_code':_0x534c45,'product_category':_0x132154(0x175)}},{'$group':{'_id':_0x132154(0x17a),'name':{'$first':'$name'},'category':{'$first':_0x132154(0x181)},'brand':{'$first':_0x132154(0x169)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x132154(0x198)},'secondary_code':{'$first':_0x132154(0x195)},'maxStocks':{'$first':_0x132154(0x178)},'maxProdPerUnit':{'$first':_0x132154(0x191)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x132154(0x16b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1bacbe=await product[_0x132154(0x1a2)]([{'$match':{'secondary_code':_0x534c45,'product_category':_0x132154(0x175)}},{'$group':{'_id':_0x132154(0x17a),'name':{'$first':'$name'},'category':{'$first':_0x132154(0x181)},'brand':{'$first':_0x132154(0x169)},'unit':{'$first':_0x132154(0x1a0)},'alertquantity':{'$first':_0x132154(0x186)},'product_code':{'$first':_0x132154(0x176)},'primary_code':{'$first':_0x132154(0x198)},'secondary_code':{'$first':_0x132154(0x195)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x132154(0x191)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x132154(0x16b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x53b4f0[_0x132154(0x184)]>0x0)_0x1977c3=_0x53b4f0;else _0x1bacbe['length']>0x0&&(_0x1977c3=_0x1bacbe);_0x5e57bf[_0x132154(0x17f)](_0x1977c3);}),module[a0_0x2c010c(0x1a1)]=router;