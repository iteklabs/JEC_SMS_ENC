const a0_0x384d18=a0_0x13dd;(function(_0x327e8a,_0x5e5404){const _0x451d94=a0_0x13dd,_0x3784f9=_0x327e8a();while(!![]){try{const _0x5d332e=-parseInt(_0x451d94(0x1ee))/0x1+-parseInt(_0x451d94(0x20d))/0x2*(parseInt(_0x451d94(0x217))/0x3)+parseInt(_0x451d94(0x218))/0x4*(-parseInt(_0x451d94(0x1f0))/0x5)+-parseInt(_0x451d94(0x200))/0x6+parseInt(_0x451d94(0x212))/0x7*(parseInt(_0x451d94(0x20e))/0x8)+parseInt(_0x451d94(0x207))/0x9*(parseInt(_0x451d94(0x203))/0xa)+-parseInt(_0x451d94(0x215))/0xb*(-parseInt(_0x451d94(0x20a))/0xc);if(_0x5d332e===_0x5e5404)break;else _0x3784f9['push'](_0x3784f9['shift']());}catch(_0x46383b){_0x3784f9['push'](_0x3784f9['shift']());}}}(a0_0x199c,0xa79c2));function a0_0x13dd(_0x40b723,_0x3446c6){const _0x199c0c=a0_0x199c();return a0_0x13dd=function(_0x13dddc,_0x4a2080){_0x13dddc=_0x13dddc-0x1ea;let _0x2ecd25=_0x199c0c[_0x13dddc];return _0x2ecd25;},a0_0x13dd(_0x40b723,_0x3446c6);}const express=require('express'),app=express(),router=express[a0_0x384d18(0x1fd)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x384d18(0x209)),auth=require(a0_0x384d18(0x1fa)),nodemailer=require(a0_0x384d18(0x21f));function a0_0x199c(){const _0x44026a=['$due_amount','$product.quantity','$suppliers_docs','$date','165164dCWfMi','$secondary_unit','1313230YSxuZp','end','$invoice','$_id','name','exports','table\x20page','query','start','$brand','../middleware/auth','$return_data','$maxStocks','Router','$unit','$finalize','1285218fvYBOH','Raw\x20Materials','../public/language/languages.json','3380050lXkgBr','message','$product_code','$paid_amount','27QrNCyq','$secondary_code','../models/all_models','4404lwhNtZ','$maxProdPerUnit','$name','1888440DRzOKc','8FYoogy','status','$product','body','4700759VqNMMj','$product.bin','$product.type','41217eZrdAZ','$note','3TFVdzz','16VFWwkA','$batch_code','$expiry_date','/view','path','$alertquantity','length','nodemailer','suppliers','json','$product.room_name','/barcode_scanner','post','$primary_code','$category','aggregate'];a0_0x199c=function(){return _0x44026a;};return a0_0x199c();}var ejs=require('ejs');const path=require(a0_0x384d18(0x21c)),users=require(a0_0x384d18(0x202));router['get'](a0_0x384d18(0x21b),async(_0x3f196d,_0x5258b7)=>{const _0x45560c=a0_0x384d18;try{const _0x5be812=parseInt(_0x3f196d[_0x45560c(0x1f7)][_0x45560c(0x1f8)])||0x0,_0x4d5a6a=parseInt(_0x3f196d[_0x45560c(0x1f7)][_0x45560c(0x1f1)])||0xa;let _0x134c9c;_0x134c9c=await purchases[_0x45560c(0x227)]([{'$lookup':{'from':_0x45560c(0x220),'localField':_0x45560c(0x220),'foreignField':_0x45560c(0x1f4),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x45560c(0x1f3),'invoice':{'$first':_0x45560c(0x1f2)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x45560c(0x1ed)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x45560c(0x222)},'product':{'$push':_0x45560c(0x210)},'note':{'$first':_0x45560c(0x216)},'paid_amount':{'$first':_0x45560c(0x206)},'due_amount':{'$first':_0x45560c(0x1ea)},'return_data':{'$first':_0x45560c(0x1fb)},'batch_code':{'$first':_0x45560c(0x219)},'expiry_date':{'$first':_0x45560c(0x21a)},'suppliers_docs':{'$first':_0x45560c(0x1ec)},'total_product_quantity':{'$sum':_0x45560c(0x1eb)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x45560c(0x213)},'type':{'$addToSet':_0x45560c(0x214)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x45560c(0x1ff)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x5be812},{'$limit':_0x4d5a6a-_0x5be812}]),_0x5258b7['json'](_0x134c9c);}catch(_0x4bd05e){console['log'](_0x45560c(0x1f6),_0x4bd05e),_0x5258b7[_0x45560c(0x20f)](0xc8)[_0x45560c(0x221)]({'message':_0x4bd05e[_0x45560c(0x204)]});}}),router[a0_0x384d18(0x224)](a0_0x384d18(0x223),async(_0x39bfd4,_0x58ef0b)=>{const _0x5e5e9d=a0_0x384d18,{product_code:_0x5a708e}=_0x39bfd4[_0x5e5e9d(0x211)];var _0x48243f;const _0x5cfb44=await product[_0x5e5e9d(0x227)]([{'$match':{'primary_code':_0x5a708e,'product_category':_0x5e5e9d(0x201)}},{'$group':{'_id':_0x5e5e9d(0x1f3),'name':{'$first':'$name'},'category':{'$first':_0x5e5e9d(0x226)},'brand':{'$first':_0x5e5e9d(0x1f9)},'unit':{'$first':_0x5e5e9d(0x1fe)},'alertquantity':{'$first':_0x5e5e9d(0x21d)},'product_code':{'$first':_0x5e5e9d(0x205)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x5e5e9d(0x208)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5e5e9d(0x20b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5e5e9d(0x1ef)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1e23a5=await product['aggregate']([{'$match':{'secondary_code':_0x5a708e,'product_category':_0x5e5e9d(0x201)}},{'$group':{'_id':_0x5e5e9d(0x1f3),'name':{'$first':_0x5e5e9d(0x20c)},'category':{'$first':_0x5e5e9d(0x226)},'brand':{'$first':_0x5e5e9d(0x1f9)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x5e5e9d(0x21d)},'product_code':{'$first':_0x5e5e9d(0x205)},'primary_code':{'$first':_0x5e5e9d(0x225)},'secondary_code':{'$first':_0x5e5e9d(0x208)},'maxStocks':{'$first':_0x5e5e9d(0x1fc)},'maxProdPerUnit':{'$first':_0x5e5e9d(0x20b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5cfb44[_0x5e5e9d(0x21e)]>0x0)_0x48243f=_0x5cfb44;else _0x1e23a5['length']>0x0&&(_0x48243f=_0x1e23a5);_0x58ef0b[_0x5e5e9d(0x221)](_0x48243f);}),module[a0_0x384d18(0x1f5)]=router;