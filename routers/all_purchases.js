var a0_0x265f88=a0_0x406b;(function(_0x506850,_0x5d39cd){var _0x299cdc=a0_0x406b,_0x1bbe2d=_0x506850();while(!![]){try{var _0x4c531a=-parseInt(_0x299cdc(0x183))/0x1*(-parseInt(_0x299cdc(0x118))/0x2)+parseInt(_0x299cdc(0xd2))/0x3*(parseInt(_0x299cdc(0x1de))/0x4)+parseInt(_0x299cdc(0xee))/0x5*(-parseInt(_0x299cdc(0x14e))/0x6)+-parseInt(_0x299cdc(0x1f2))/0x7*(parseInt(_0x299cdc(0x1e8))/0x8)+-parseInt(_0x299cdc(0x193))/0x9*(parseInt(_0x299cdc(0x12e))/0xa)+-parseInt(_0x299cdc(0x159))/0xb*(-parseInt(_0x299cdc(0xf7))/0xc)+parseInt(_0x299cdc(0x18a))/0xd;if(_0x4c531a===_0x5d39cd)break;else _0x1bbe2d['push'](_0x1bbe2d['shift']());}catch(_0x29c2de){_0x1bbe2d['push'](_0x1bbe2d['shift']());}}}(a0_0x44fa,0x5241d));const express=require('express'),app=express(),router=express[a0_0x265f88(0x1ca)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x265f88(0x155)),auth=require(a0_0x265f88(0x108)),nodemailer=require('nodemailer');function a0_0x44fa(){var _0x342266=['host','/view','flash','$product_details.maxProducts','all','aggregate','\x20</h2>','render','$paid_amount','Error\x20Occurs','getMonth','$product.bin','An\x20error\x20occurred\x20while\x20saving\x20data.','storage','primary_code_hide','Purchase\x20Return','product_list','<span\x20style=\x22float:\x20right;\x22>','length','isle','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product.floorlevel','$unit','</td>','$maxProdPerUnit','language','concat','toString','findById','product','production_date','An\x20error\x20occurred.','prod_secondunit','batch_code','prod_code','Chinese','$product_details.primary_code','max_product_unit','stock_quantity','Portuguese','all_purchases_barcode','prod_qty','$suppliers','Rack\x20A','edit_purchases','</h5>','product_name','stocks','Rack\x20D','ejs','\x20Order\x20Date\x20:\x20','Router','$finalize','$due_amount','/invoice/:id','$maxStocks','catch','Purchase\x20data\x20added\x20successfully','maxStocks','user','findOne','success','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Purchase\x20Return\x20Mail','$product_details.floorlevel','$_id','types','\x20<\x20wew\x20>\x20','$product.bay','</div>','208cQEVjG','$product','English','product_stock','paid_amount','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.type','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','suppliers','432XegSCy','level','getDate','then','message','prod_cat','add_purchases','password','port','Floor','9884QEzmDt','<div>','/view/return_purchase/:id','$product_details.product_name','French','post','log','find','delivery_code','German','21177xjgOIm','$secondary_code','Enclosed','slice','DRY\x20STORAGE','Logo.png','/view/:id','status','RMSEmail','staff','INC-','prod_name','$alertquantity','/preview/:id','filter','string','$product_details.secondary_code','email','forEach','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','logo','role','$return_data','</table>','expiry_date','image','warehouse_name','prod_Qty','5xrtUDn','alertQTY','primary_code','$product.type','Return\x20Goods','product_cat','</thead>','suppliers_docs','$room','5952VEutfU','$expiry_date','product_code_hide','json','$name','Purchase\x20Mail','delivery_date','/upload/','$secondary_unit','POnumber','sendMail','</head><body>','amount','MaxStocks_data','name','Shelves','Hindi','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','rak','$product_details.expiry_date','site_title','/barcode_scanner','map','/all_purchases/view','Raw\x20Materials','return_qty','actual_qty','<h5>','$product_details','floorlevel','/view/add_purchases','9402hbbFHT','floor','<!DOCTYPE\x20html>','\x20<>\x20','$product_code','$brand','actual_uom','Email\x20sent\x20successfully','There\x27s\x20a\x20error\x20in\x20this\x20transaction','master','error','body','JO_number','params','$product_details.product_stock','$product_details.level','secondary_unit','/all_purchases/view/','prod_unit','RoomAssign','return_product','return_data','10VgpNis','Spanish','purchase_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','abs','<tbody\x20style=\x22text-align:\x20center;\x22>','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20Order\x20Number\x20:\x20','due_amount','/give_payment/:id','warehouse','prod_primunit','product_details','</body></html>','date','finalize','prod_invoice','room_name','here','$product_details.isle','<hr\x20class=\x22my-3\x22>','prod_isle','/../public','secondary_code','$product_details.bay','rack','padStart','$product_details.rack','Level','$product_details.pallet','2684382nWJiCk','createTransport','<h5\x20style=\x22text-align:\x20left;\x22>','prod_level','</tr>','Rack\x20B','/view/add_purchases/:id','../models/all_models','$invoice','product_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','11737OhpNWs','path','random','../public/language/languages.json','stock_data','$product_details.product_code','all_purchases','type','gmail','exports','bin','<html><head><title></title>','Receiving\x20Area','return_purchase','purchases\x20item\x20return\x20successfull','getFullYear','push','Arabic\x20(ae)','$product_details.bin','$batch_code','quantity','save','user_id','room','get','$product_details._id','purchase\x20data\x20update\x20successfully','purchase_invoice','errors','secondary_code_hide','$date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','pallet','$warehouse_name','$suppliers_docs','currency_placement','back','edit_purchases_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','invoice','$note','$primary_code','3nOQUBC','<h2>\x20','English\x20(US)','</tbody>','/CheckingWarehouse','$product_details.storage','payment\x20successfull','5535660ktKCCm','standard_unit','Rack\x20E','$category','Arabic','add\x20post','Enabled','COLD\x20STORAGE','currency','4280877aFRTxZ','bay','redirect','$product.quantity'];a0_0x44fa=function(){return _0x342266;};return a0_0x44fa();}var ejs=require(a0_0x265f88(0x1c8));const path=require(a0_0x265f88(0x15a)),users=require(a0_0x265f88(0x15c));function a0_0x406b(_0x2a65a9,_0x2f1cad){var _0x44fafb=a0_0x44fa();return a0_0x406b=function(_0x406b95,_0x4d4951){_0x406b95=_0x406b95-0xd1;var _0x399b22=_0x44fafb[_0x406b95];return _0x399b22;},a0_0x406b(_0x2a65a9,_0x2f1cad);}router[a0_0x265f88(0x171)](a0_0x265f88(0x198),auth,async(_0x5a3e55,_0x567927)=>{var _0x285b8b=a0_0x265f88;try{const {username:_0x15ddaf,email:_0x31e941,role:_0x9eecc0}=_0x5a3e55[_0x285b8b(0x1d2)],_0x5d5c51=_0x5a3e55[_0x285b8b(0x1d2)],_0x100c7f=await profile[_0x285b8b(0x1d3)]({'email':_0x5d5c51[_0x285b8b(0xe3)]}),_0x274120=await staff[_0x285b8b(0x1d3)]({'email':_0x5d5c51[_0x285b8b(0xe3)]});if(_0x5d5c51[_0x285b8b(0xe7)]=='staff'){const _0x455900=await staff[_0x285b8b(0x1d3)]({'email':_0x5d5c51['email']});}const _0x10e9e8=await master_shop[_0x285b8b(0x1f9)]();let _0x4fd729;if(_0x5d5c51[_0x285b8b(0xe7)]==_0x285b8b(0xdb)){const _0x4247d9=await staff[_0x285b8b(0x1d3)]({'email':_0x5d5c51[_0x285b8b(0xe3)]});_0x4fd729=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4247d9[_0x285b8b(0x13a)]}},{'$lookup':{'from':_0x285b8b(0x1e7),'localField':_0x285b8b(0x1e7),'foreignField':_0x285b8b(0x105),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x285b8b(0x1df)},{'$group':{'_id':_0x285b8b(0x1d9),'invoice':{'$first':_0x285b8b(0x156)},'suppliers':{'$first':_0x285b8b(0x1c1)},'date':{'$first':_0x285b8b(0x177)},'warehouse_name':{'$first':_0x285b8b(0x17a)},'room':{'$first':_0x285b8b(0xf6)},'product':{'$push':_0x285b8b(0x1df)},'note':{'$first':_0x285b8b(0x181)},'paid_amount':{'$first':_0x285b8b(0x19f)},'due_amount':{'$first':_0x285b8b(0x1cc)},'return_data':{'$first':_0x285b8b(0xe8)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x285b8b(0xf8)},'suppliers_docs':{'$first':_0x285b8b(0x17b)},'total_product_quantity':{'$sum':_0x285b8b(0x196)},'level':{'$addToSet':_0x285b8b(0x1dc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x285b8b(0xf1)},'floorlevel':{'$addToSet':_0x285b8b(0x1ac)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4fd729=await purchases[_0x285b8b(0x19c)]([{'$lookup':{'from':_0x285b8b(0x1e7),'localField':_0x285b8b(0x1e7),'foreignField':_0x285b8b(0x105),'as':_0x285b8b(0xf5)}},{'$unwind':_0x285b8b(0x17b)},{'$unwind':_0x285b8b(0x1df)},{'$group':{'_id':_0x285b8b(0x1d9),'invoice':{'$first':_0x285b8b(0x156)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x285b8b(0x177)},'warehouse_name':{'$first':_0x285b8b(0x17a)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x285b8b(0x181)},'paid_amount':{'$first':_0x285b8b(0x19f)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x285b8b(0xe8)},'batch_code':{'$first':_0x285b8b(0x16c)},'expiry_date':{'$first':_0x285b8b(0xf8)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x285b8b(0x196)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x285b8b(0x1a2)},'type':{'$addToSet':_0x285b8b(0xf1)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x285b8b(0x1cb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x10e9e8[0x0]['language']==_0x285b8b(0x185)){var _0x7b88d=users[_0x285b8b(0x1e0)];console[_0x285b8b(0x1f8)](_0x7b88d);}else{if(_0x10e9e8[0x0][_0x285b8b(0x1b0)]==_0x285b8b(0x107))var _0x7b88d=users[_0x285b8b(0x107)];else{if(_0x10e9e8[0x0][_0x285b8b(0x1b0)]==_0x285b8b(0xd1))var _0x7b88d=users[_0x285b8b(0xd1)];else{if(_0x10e9e8[0x0]['language']=='Spanish')var _0x7b88d=users[_0x285b8b(0x12f)];else{if(_0x10e9e8[0x0]['language']==_0x285b8b(0x1f6))var _0x7b88d=users[_0x285b8b(0x1f6)];else{if(_0x10e9e8[0x0]['language']==_0x285b8b(0x1d5))var _0x7b88d=users['Portuguese'];else{if(_0x10e9e8[0x0][_0x285b8b(0x1b0)]==_0x285b8b(0x1ba))var _0x7b88d=users[_0x285b8b(0x1ba)];else{if(_0x10e9e8[0x0][_0x285b8b(0x1b0)]==_0x285b8b(0x16a))var _0x7b88d=users[_0x285b8b(0x18e)];}}}}}}}_0x567927[_0x285b8b(0x19e)](_0x285b8b(0x15f),{'success':_0x5a3e55[_0x285b8b(0x199)](_0x285b8b(0x1d4)),'errors':_0x5a3e55[_0x285b8b(0x199)](_0x285b8b(0x175)),'purchases':_0x4fd729,'role':_0x5d5c51,'profile':_0x100c7f,'master_shop':_0x10e9e8,'language':_0x7b88d});}catch(_0x7464a){console[_0x285b8b(0x1f8)]('table\x20page',_0x7464a),_0x567927['status'](0xc8)[_0x285b8b(0xfa)]({'message':_0x7464a[_0x285b8b(0x1ec)]});}});function BayBinSelected(_0x1d3b6b,_0x2698bd){var _0x22f042=a0_0x265f88,_0x1073c2=[],_0x5dd3ec=[],_0x47f652=[],_0x57c853=[],_0x4c5532=[],_0x1b8b32=[];let _0x5c0f23=[];if(_0x1d3b6b==_0x22f042(0xd6))switch(_0x2698bd){case _0x22f042(0x1c2):_0x1073c2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5dd3ec=[0x1,0x2],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=[_0x22f042(0x14c),_0x22f042(0x1f1)],_0x4c5532=['D'],_0x1b8b32=['A'];break;case _0x22f042(0x153):_0x1073c2=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5dd3ec=[0x1,0x2],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=[_0x22f042(0x14c),'Floor'],_0x4c5532=['D'],_0x1b8b32=['B'];break;case _0x22f042(0x106):_0x1073c2=[0x0],_0x5dd3ec=[0x0],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=[_0x22f042(0x1f1)],_0x4c5532=['D'],_0x1b8b32=['S'];break;case _0x22f042(0x165):_0x1073c2=[0x0],_0x5dd3ec=[0x0],_0x57c853=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x47f652=[_0x22f042(0x1f1)],_0x4c5532=['D'],_0x1b8b32=['R'];break;}else{if(_0x1d3b6b==_0x22f042(0x191))switch(_0x2698bd){case _0x22f042(0x1c2):_0x1073c2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5dd3ec=['B','F'],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=[_0x22f042(0x14c),_0x22f042(0x1f1)],_0x4c5532=['C'],_0x1b8b32=['A'];break;case _0x22f042(0x153):_0x1073c2=[0x5,0x4,0x3,0x2,0x1],_0x5dd3ec=['F','B','S'],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=[_0x22f042(0x14c),'Floor'],_0x4c5532=['C'],_0x1b8b32=['B'];break;case'Rack\x20C':_0x1073c2=[0x1,0x2,0x3,0x4,0x5],_0x5dd3ec=['B','F','S'],_0x57c853=[0x5,0x4,0x3,0x2,0x1],_0x47f652=['Level',_0x22f042(0x1f1)],_0x4c5532=['C'],_0x1b8b32=['C'];break;case _0x22f042(0x1c7):_0x1073c2=[0x5,0x4,0x3,0x2,0x1],_0x5dd3ec=['F','B','S'],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=[_0x22f042(0x14c),'Floor'],_0x4c5532=['C'],_0x1b8b32=['D'];break;case _0x22f042(0x18c):_0x1073c2=[0x4,0x3,0x2,0x1],_0x5dd3ec=[0x1,0x2],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=['Level',_0x22f042(0x1f1)],_0x4c5532=['C'],_0x1b8b32=['E'];break;case'Rack\x20F':_0x1073c2=[0x1,0x2,0x3],_0x5dd3ec=[0x1,0x2],_0x57c853=[0x1,0x2,0x3,0x4,0x5],_0x47f652=['Level'],_0x4c5532=['C'],_0x1b8b32=['F'];break;}}return{'levels':_0x1073c2,'Isle':_0x5dd3ec,'rack':_0x57c853,'type':_0x47f652,'storage':_0x4c5532,'rak':_0x1b8b32};}async function getRandom8DigitNumber(){var _0x270c0d=a0_0x265f88;const _0x48a143=0x989680,_0x5e72e0=0x5f5e0ff,_0x4ffd41=Math[_0x270c0d(0x119)](Math[_0x270c0d(0x15b)]()*(_0x5e72e0-_0x48a143+0x1))+_0x48a143;var _0x43b7c8;const _0x2a7e50=await purchases[_0x270c0d(0x1d3)]({'invoice':_0x270c0d(0xdc)+_0x4ffd41});return _0x2a7e50&&_0x2a7e50[_0x270c0d(0x1a9)]>0x0?_0x43b7c8=_0x270c0d(0xdc)+_0x4ffd41:_0x43b7c8=_0x270c0d(0xdc)+_0x4ffd41,_0x43b7c8;}router[a0_0x265f88(0x171)](a0_0x265f88(0x117),auth,async(_0x34f362,_0x5305db)=>{var _0x32817e=a0_0x265f88;try{const {username:_0xe94df7,email:_0x5717d8,role:_0x244f2e}=_0x34f362[_0x32817e(0x1d2)],_0x4670e3=_0x34f362[_0x32817e(0x1d2)],_0x570771=await profile[_0x32817e(0x1d3)]({'email':_0x4670e3[_0x32817e(0xe3)]}),_0x2f75a2=await master_shop[_0x32817e(0x1f9)](),_0x1ca8ab=await staff[_0x32817e(0x1d3)]({'email':_0x4670e3['email']}),_0x14ec74=await suppliers[_0x32817e(0x1f9)]({});let _0x26adc7;if(_0x4670e3[_0x32817e(0xe7)]==_0x32817e(0xdb)){const _0x17c8ea=await staff[_0x32817e(0x1d3)]({'email':_0x4670e3[_0x32817e(0xe3)]});_0x26adc7=await warehouse['aggregate']([{'$match':{'status':_0x32817e(0x190),'name':_0x17c8ea[_0x32817e(0x13a)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x32817e(0xf2)}}},{'$group':{'_id':_0x32817e(0xfb),'name':{'$first':_0x32817e(0xfb)}}}]);}else _0x26adc7=await warehouse[_0x32817e(0x19c)]([{'$match':{'status':_0x32817e(0x190),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x32817e(0xf2)}}},{'$group':{'_id':'$name','name':{'$first':_0x32817e(0xfb)}}}]);const _0x292c8a=await product[_0x32817e(0x1f9)]({}),_0x4fef9d=await warehouse[_0x32817e(0x1f9)]({'status':_0x32817e(0x190)}),_0x233e4a=await purchases[_0x32817e(0x1f9)]({}),_0x1d5c69=_0x233e4a[_0x32817e(0x1a9)]+0x1,_0x5a4502=_0x32817e(0xdc)+_0x1d5c69[_0x32817e(0x1b2)]()[_0x32817e(0x14a)](0x5,'0');var _0x269905=[_0x32817e(0x135),_0x32817e(0xd4)];if(_0x2f75a2[0x0]['language']==_0x32817e(0x185))var _0x15f306=users[_0x32817e(0x1e0)];else{if(_0x2f75a2[0x0]['language']==_0x32817e(0x107))var _0x15f306=users[_0x32817e(0x107)];else{if(_0x2f75a2[0x0][_0x32817e(0x1b0)]==_0x32817e(0xd1))var _0x15f306=users[_0x32817e(0xd1)];else{if(_0x2f75a2[0x0]['language']=='Spanish')var _0x15f306=users[_0x32817e(0x12f)];else{if(_0x2f75a2[0x0][_0x32817e(0x1b0)]==_0x32817e(0x1f6))var _0x15f306=users[_0x32817e(0x1f6)];else{if(_0x2f75a2[0x0][_0x32817e(0x1b0)]=='Portuguese\x20(BR)')var _0x15f306=users[_0x32817e(0x1be)];else{if(_0x2f75a2[0x0][_0x32817e(0x1b0)]==_0x32817e(0x1ba))var _0x15f306=users[_0x32817e(0x1ba)];else{if(_0x2f75a2[0x0][_0x32817e(0x1b0)]==_0x32817e(0x16a))var _0x15f306=users[_0x32817e(0x18e)];}}}}}}}const _0x6046b1=getRandom8DigitNumber();_0x6046b1[_0x32817e(0x1eb)](_0x586465=>{var _0x21852f=_0x32817e;_0x5305db[_0x21852f(0x19e)](_0x21852f(0x1ee),{'success':_0x34f362[_0x21852f(0x199)]('success'),'errors':_0x34f362[_0x21852f(0x199)](_0x21852f(0x175)),'role':_0x4670e3,'profile':_0x570771,'suppliers':_0x14ec74,'warehouse':_0x26adc7,'product':_0x292c8a,'invoice':_0x586465,'master_shop':_0x2f75a2,'language':_0x15f306,'find_data':_0x4fef9d,'rooms_data':_0x269905});})[_0x32817e(0x1cf)](_0x22c852=>{var _0x4ebc65=_0x32817e;_0x34f362[_0x4ebc65(0x199)]('errors',_0x4ebc65(0x120)),_0x5305db[_0x4ebc65(0x195)]('/all_purchases/view');});}catch(_0x4d8d7e){console[_0x32817e(0x1f8)](_0x4d8d7e);}}),router[a0_0x265f88(0x171)](a0_0x265f88(0x154),auth,async(_0x24ad24,_0x3bc6a8)=>{var _0x49784d=a0_0x265f88;try{const _0x18cc40=_0x24ad24[_0x49784d(0x125)]['id'];console[_0x49784d(0x1f8)](_0x18cc40);const _0x2adae4=await master_shop[_0x49784d(0x1f9)]();console[_0x49784d(0x1f8)]('master',_0x2adae4);const _0x20bf7f=await product[_0x49784d(0x1d3)]({'name':_0x18cc40});console[_0x49784d(0x1f8)](_0x49784d(0x1b4),_0x20bf7f),_0x3bc6a8['status'](0xc8)[_0x49784d(0xfa)]({'product_data':_0x20bf7f,'master':_0x2adae4});}catch(_0xcfbef7){console[_0x49784d(0x1f8)]('add_purchases\x20error',_0xcfbef7);}}),router['post'](a0_0x265f88(0x117),auth,async(_0x1b78d4,_0x485a17)=>{var _0x42e929=a0_0x265f88;try{const {invoice:_0x3e2aad,date:_0x491e5a,warehouse_name:_0x34da12,prod_name:_0x21105d,prod_code:_0x10458f,prod_qty:_0x266b8d,prod_unit:_0x120031,prod_secondunit:_0x3c2fa6,prod_level:_0x2e65b2,prod_isle:_0xa82150,prod_pallet:_0x2cf919,note:_0x652a1b,expiry_date:_0x3d6efc,batch_code:_0x459d92,payable:_0x579abd,due_amount:_0x14d34c,Room_name:_0x32019b,primary_code:_0x474fa8,secondary_code:_0xd93455,MaxStocks_data:_0xd0cb8c,PO_number:_0x3b37c1,SCRN:_0x77c7ee,JO_number:_0x2a5748}=_0x1b78d4[_0x42e929(0x123)];if(typeof _0x21105d==_0x42e929(0xe1))var _0x12561d=[_0x1b78d4[_0x42e929(0x123)]['prod_name']],_0x4d846b=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1b9)]],_0x27f73b=[_0x1b78d4[_0x42e929(0x123)]['prod_Qty']],_0x22d647=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x13b)]],_0x4278f3=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1b7)]],_0x13a49b=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x151)]],_0x443fb6=[_0x1b78d4['body']['primary_code']],_0x573643=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x147)]],_0x2f8aec=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x104)]],_0x504a5a=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1b8)]],_0x587464=[_0x1b78d4['body'][_0x42e929(0xea)]],_0x5dd356=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1bc)]],_0x8eab7c=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0xef)]],_0x4f4736=[_0x1b78d4[_0x42e929(0x123)]['production_date']],_0x37cc4e=[_0x1b78d4['body'][_0x42e929(0x1ed)]],_0x3ebae5=[_0x1b78d4[_0x42e929(0x123)]['RoomAssign']],_0xd654f7=[_0x1b78d4[_0x42e929(0x123)]['deliverycode']],_0x2014b1=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x140)]],_0x148e5f=[_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x113)]],_0x559fe3=[_0x1b78d4['body'][_0x42e929(0x11e)]];else var _0x12561d=[..._0x1b78d4[_0x42e929(0x123)]['prod_name']],_0x4d846b=[..._0x1b78d4['body'][_0x42e929(0x1b9)]],_0x27f73b=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0xed)]],_0x22d647=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x13b)]],_0x4278f3=[..._0x1b78d4['body']['prod_secondunit']],_0x13a49b=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x151)]],_0x443fb6=[..._0x1b78d4[_0x42e929(0x123)]['primary_code']],_0x573643=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x147)]],_0x2f8aec=[..._0x1b78d4[_0x42e929(0x123)]['MaxStocks_data']],_0x504a5a=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1b8)]],_0x587464=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0xea)]],_0x5dd356=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1bc)]],_0x8eab7c=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0xef)]],_0x4f4736=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1b5)]],_0x37cc4e=[..._0x1b78d4['body'][_0x42e929(0x1ed)]],_0x3ebae5=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x12b)]],_0xd654f7=[..._0x1b78d4[_0x42e929(0x123)]['deliverycode']],_0x2014b1=[..._0x1b78d4['body'][_0x42e929(0x140)]],_0x148e5f=[..._0x1b78d4[_0x42e929(0x123)][_0x42e929(0x113)]],_0x559fe3=[..._0x1b78d4[_0x42e929(0x123)]['actual_uom']];const _0x1f9b68=_0x12561d[_0x42e929(0x10f)](_0x326516=>{return _0x326516={'product_name':_0x326516};});_0x148e5f[_0x42e929(0xe4)]((_0x2b6792,_0x1e15e1)=>{var _0x50ed05=_0x42e929;_0x1f9b68[_0x1e15e1]['actual_qty']=Math[_0x50ed05(0x133)](_0x2b6792);}),_0x559fe3['forEach']((_0x45f102,_0x472519)=>{var _0x1413ea=_0x42e929;_0x1f9b68[_0x472519][_0x1413ea(0x11e)]=_0x45f102;}),_0x4d846b[_0x42e929(0xe4)]((_0x30b4c2,_0x33874d)=>{var _0xbb18c3=_0x42e929;_0x1f9b68[_0x33874d][_0xbb18c3(0x157)]=_0x30b4c2;}),_0x27f73b['forEach']((_0x51bb61,_0x493bd8)=>{var _0xd178a2=_0x42e929;_0x1f9b68[_0x493bd8][_0xd178a2(0x16d)]=Math[_0xd178a2(0x133)](_0x51bb61);}),_0x22d647['forEach']((_0x414dc2,_0x65b075)=>{var _0x473d70=_0x42e929;_0x1f9b68[_0x65b075][_0x473d70(0x18b)]=_0x414dc2;}),_0x4278f3[_0x42e929(0xe4)]((_0x1180af,_0x245411)=>{var _0x4e7cba=_0x42e929;_0x1f9b68[_0x245411][_0x4e7cba(0x128)]=_0x1180af;}),_0x13a49b['forEach']((_0x36e624,_0x3e60f6)=>{_0x3ebae5['forEach']((_0x5ca108,_0x382438)=>{var _0x21c08a=a0_0x406b;if(_0x5ca108==_0x21c08a(0x165)&&_0x3e60f6==_0x382438){console[_0x21c08a(0x1f8)](_0x5ca108+_0x21c08a(0x1db)+_0x3e60f6+_0x21c08a(0x11b)+_0x382438+_0x21c08a(0x11b)+_0x36e624);var _0xc4d993=_0x36e624[_0x21c08a(0xd5)](0x3);_0x1f9b68[_0x3e60f6][_0x21c08a(0x1a4)]=_0x36e624[0x0],_0x1f9b68[_0x3e60f6][_0x21c08a(0x149)]=_0x36e624[0x1],_0x1f9b68[_0x3e60f6][_0x21c08a(0x194)]=0x0,_0x1f9b68[_0x3e60f6]['bin']=0x0,_0x1f9b68[_0x3e60f6][_0x21c08a(0x160)]='Floor',_0x1f9b68[_0x3e60f6]['floorlevel']=_0xc4d993;}else{if(_0x5ca108==_0x21c08a(0x106)&&_0x3e60f6==_0x382438){var _0xc4d993=_0x36e624[_0x21c08a(0xd5)](0x3);_0x1f9b68[_0x3e60f6]['storage']=_0x36e624[0x0],_0x1f9b68[_0x3e60f6][_0x21c08a(0x149)]=_0x36e624[0x1],_0x1f9b68[_0x3e60f6][_0x21c08a(0x194)]=0x0,_0x1f9b68[_0x3e60f6][_0x21c08a(0x163)]=0x0,_0x1f9b68[_0x3e60f6][_0x21c08a(0x160)]=_0x21c08a(0x1f1),_0x1f9b68[_0x3e60f6]['floorlevel']=_0x36e624[0x5];}else{if(_0x3e60f6==_0x382438){if(_0x36e624[0x0]=='A'&&_0x36e624[0x1]=='L'&&_0x36e624[0x2]=='L')console['log'](_0x5ca108+_0x21c08a(0x11b)+_0x3e60f6+'\x20<>\x20'+_0x382438+_0x21c08a(0x11b)+_0x36e624+_0x21c08a(0x142)),_0x1f9b68[_0x3e60f6][_0x21c08a(0x1a4)]=_0x36e624[0x0],_0x1f9b68[_0x3e60f6][_0x21c08a(0x149)]=_0x36e624[0x1],_0x1f9b68[_0x3e60f6][_0x21c08a(0x194)]=0x0,_0x1f9b68[_0x3e60f6]['bin']=0x0,_0x1f9b68[_0x3e60f6][_0x21c08a(0x160)]=_0x21c08a(0x1f1),_0x1f9b68[_0x3e60f6]['floorlevel']=_0x36e624[0x3];else{var _0x3a8f37;if(_0x36e624[0x4]=='L')_0x3a8f37=_0x21c08a(0x14c);else _0x36e624[0x4]=='F'&&(_0x3a8f37='Floor');_0x1f9b68[_0x3e60f6]['storage']=_0x36e624[0x0],_0x1f9b68[_0x3e60f6][_0x21c08a(0x149)]=_0x36e624[0x1],_0x1f9b68[_0x3e60f6][_0x21c08a(0x194)]=_0x36e624[0x2],_0x1f9b68[_0x3e60f6][_0x21c08a(0x163)]=_0x36e624[0x3],_0x1f9b68[_0x3e60f6][_0x21c08a(0x160)]=_0x3a8f37,_0x1f9b68[_0x3e60f6]['floorlevel']=_0x36e624[0x5];}}}}});}),_0x443fb6[_0x42e929(0xe4)]((_0x233c48,_0x4155f0)=>{var _0x4c1a17=_0x42e929;_0x1f9b68[_0x4155f0][_0x4c1a17(0xf0)]=_0x233c48;}),_0x573643['forEach']((_0x29f5f8,_0x45c3b9)=>{var _0xf98aa4=_0x42e929;_0x1f9b68[_0x45c3b9][_0xf98aa4(0x147)]=_0x29f5f8;}),_0x2f8aec[_0x42e929(0xe4)]((_0x3469a6,_0x5577f8)=>{var _0x294893=_0x42e929;_0x1f9b68[_0x5577f8][_0x294893(0x1d1)]=_0x3469a6;}),_0x504a5a['forEach']((_0x5b26cf,_0x23bb21)=>{var _0x20558d=_0x42e929;_0x1f9b68[_0x23bb21][_0x20558d(0x1b8)]=_0x5b26cf;}),_0x587464[_0x42e929(0xe4)]((_0xb57a04,_0x1f0cf2)=>{_0x1f9b68[_0x1f0cf2]['expiry_date']=_0xb57a04;}),_0x5dd356[_0x42e929(0xe4)]((_0x16a09e,_0x48e71d)=>{_0x1f9b68[_0x48e71d]['maxperunit']=_0x16a09e;}),_0x8eab7c[_0x42e929(0xe4)]((_0x32d9d2,_0x1ae8e3)=>{var _0x23f9a0=_0x42e929;_0x1f9b68[_0x1ae8e3][_0x23f9a0(0xef)]=_0x32d9d2;}),_0x4f4736['forEach']((_0xba8c7b,_0x17a82e)=>{var _0x2be44f=_0x42e929;_0x1f9b68[_0x17a82e][_0x2be44f(0x1b5)]=_0xba8c7b;}),_0x37cc4e['forEach']((_0x3bb2ea,_0x4b3c34)=>{var _0x282a87=_0x42e929;_0x1f9b68[_0x4b3c34][_0x282a87(0xf3)]=_0x3bb2ea;}),_0x3ebae5[_0x42e929(0xe4)]((_0x26e824,_0x59a3df)=>{var _0x394bb6=_0x42e929;_0x1f9b68[_0x59a3df][_0x394bb6(0x141)]=_0x26e824;}),_0xd654f7[_0x42e929(0xe4)]((_0x5587f6,_0x425b4f)=>{var _0x37a5fc=_0x42e929;_0x1f9b68[_0x425b4f][_0x37a5fc(0x1fa)]=_0x5587f6;}),_0x2014b1['forEach']((_0x5b18c8,_0x10bc89)=>{var _0x367181=_0x42e929;_0x1f9b68[_0x10bc89][_0x367181(0x180)]=_0x5b18c8;});const _0x23061f=_0x3ebae5['map'](_0x467460=>{return _0x467460={'room_name':_0x467460};}),_0x36f8ae=_0x1f9b68[_0x42e929(0xe0)](_0x211412=>_0x211412['quantity']!=='0'&&_0x211412[_0x42e929(0x16d)]!==''),_0x1d0af0=new purchases({'invoice':_0x3e2aad,'suppliers':_0x1b78d4[_0x42e929(0x123)][_0x42e929(0x1e7)],'date':_0x491e5a,'warehouse_name':_0x34da12,'product':_0x36f8ae,'note':_0x652a1b,'due_amount':_0x14d34c,'POnumber':_0x3b37c1,'SCRN':_0x77c7ee,'JO_number':_0x2a5748,'roomList':_0x23061f}),_0x32ede8=await _0x1d0af0[_0x42e929(0x16e)](),_0x293dce=await purchases[_0x42e929(0x1d3)]({'invoice':_0x3e2aad}),_0x2f66c5=_0x293dce[_0x42e929(0x1b4)][_0x42e929(0x10f)](async _0x31480c=>{var _0x4be881=_0x42e929,_0x2f3c8f=await warehouse[_0x4be881(0x1d3)]({'name':_0x34da12,'room':_0x31480c[_0x4be881(0x141)]}),_0x3d3f52=0x0;return _0x2f3c8f[_0x4be881(0x13c)][_0x4be881(0xe4)](_0x5efd19=>{var _0x16ca10=_0x4be881;_0x5efd19[_0x16ca10(0x1c5)]==_0x31480c[_0x16ca10(0x1c5)]&&_0x5efd19[_0x16ca10(0x116)]==_0x31480c[_0x16ca10(0x116)]&&_0x5efd19['type']==_0x31480c[_0x16ca10(0x160)]&&_0x5efd19[_0x16ca10(0x163)]==_0x31480c['bin']&&_0x5efd19['bay']==_0x31480c[_0x16ca10(0x194)]&&_0x5efd19[_0x16ca10(0x149)]==_0x31480c[_0x16ca10(0x149)]&&_0x5efd19[_0x16ca10(0x1a4)]==_0x31480c['storage']&&_0x5efd19[_0x16ca10(0xea)]==_0x31480c[_0x16ca10(0xea)]&&_0x5efd19[_0x16ca10(0x1b8)]==_0x31480c[_0x16ca10(0x1b8)]&&_0x5efd19[_0x16ca10(0x1b5)]==_0x31480c[_0x16ca10(0x1b5)]&&_0x5efd19[_0x16ca10(0x180)]==_0x293dce[_0x16ca10(0x180)]&&(_0x5efd19[_0x16ca10(0x1e1)]+=Math[_0x16ca10(0x133)](_0x31480c['quantity']),_0x3d3f52++);}),_0x3d3f52===0x0&&_0x2f3c8f['product_details'][_0x4be881(0x169)]({'product_name':_0x31480c[_0x4be881(0x1c5)],'product_stock':Math[_0x4be881(0x133)](_0x31480c[_0x4be881(0x16d)]),'primary_code':_0x31480c[_0x4be881(0xf0)],'secondary_code':_0x31480c['secondary_code'],'product_code':_0x31480c[_0x4be881(0x157)],'storage':_0x31480c[_0x4be881(0x1a4)],'rack':_0x31480c[_0x4be881(0x149)],'bay':_0x31480c[_0x4be881(0x194)],'bin':_0x31480c[_0x4be881(0x163)],'type':_0x31480c['type'],'floorlevel':_0x31480c[_0x4be881(0x116)],'maxProducts':_0x31480c[_0x4be881(0x1d1)],'unit':_0x31480c[_0x4be881(0x18b)],'secondary_unit':_0x31480c[_0x4be881(0x128)],'expiry_date':_0x31480c[_0x4be881(0xea)],'maxPerUnit':_0x31480c['maxperunit'],'batch_code':_0x31480c['batch_code'],'alertQTY':_0x31480c[_0x4be881(0xef)],'production_date':_0x31480c[_0x4be881(0x1b5)],'product_cat':_0x31480c['product_cat'],'invoice':_0x31480c[_0x4be881(0x180)],'actual_qty':Math[_0x4be881(0x133)](_0x31480c[_0x4be881(0x113)]),'actual_uom':_0x31480c['actual_uom']}),_0x2f3c8f;});Promise[_0x42e929(0x19b)](_0x2f66c5)[_0x42e929(0x1eb)](async _0x3ed27d=>{var _0x304c0d=_0x42e929;try{for(const _0x19db2f of _0x3ed27d){await _0x19db2f[_0x304c0d(0x16e)]();}const _0x464493=await master_shop['find'](),_0x2ba464=await email_settings[_0x304c0d(0x1d3)](),_0x53d4c3=await supervisor_settings[_0x304c0d(0x1f9)]();var _0x2a30bc=_0x293dce[_0x304c0d(0x1b4)],_0x365eaa='',_0x1832ee;for(_0x1832ee in _0x2a30bc){_0x365eaa+=_0x304c0d(0x1e3)+_0x304c0d(0x1e6)+_0x2a30bc[_0x1832ee][_0x304c0d(0x1c5)]+_0x304c0d(0x1ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a30bc[_0x1832ee][_0x304c0d(0x157)]+_0x304c0d(0x1ae)+_0x304c0d(0x1e6)+_0x2a30bc[_0x1832ee][_0x304c0d(0x16d)]+_0x304c0d(0x1ae)+_0x304c0d(0x1e6)+_0x2a30bc[_0x1832ee][_0x304c0d(0x18b)]+'</td>'+_0x304c0d(0x1e6)+_0x2a30bc[_0x1832ee][_0x304c0d(0x128)]+_0x304c0d(0x1ae)+_0x304c0d(0x1e6)+_0x293dce[_0x304c0d(0xec)]+_0x304c0d(0x1ae)+_0x304c0d(0x1e6)+_0x2a30bc[_0x1832ee][_0x304c0d(0x141)]+'</td>'+_0x304c0d(0x1e6)+_0x2a30bc[_0x1832ee][_0x304c0d(0x1a4)]+_0x2a30bc[_0x1832ee][_0x304c0d(0x149)]+_0x2a30bc[_0x1832ee][_0x304c0d(0x194)]+_0x2a30bc[_0x1832ee][_0x304c0d(0x163)]+_0x2a30bc[_0x1832ee][_0x304c0d(0x160)][0x0]+_0x2a30bc[_0x1832ee][_0x304c0d(0x116)]+_0x304c0d(0x1ae),'</tr>';}let _0x3de56b=nodemailer[_0x304c0d(0x14f)]({'host':_0x2ba464[_0x304c0d(0x197)],'port':Number(_0x2ba464[_0x304c0d(0x1f0)]),'secure':![],'auth':{'user':_0x2ba464[_0x304c0d(0xe3)],'pass':_0x2ba464['password']}}),_0x346abf={'from':_0x2ba464[_0x304c0d(0xe3)],'to':_0x53d4c3[0x0][_0x304c0d(0xda)],'subject':_0x304c0d(0xfc),'attachments':[{'filename':_0x304c0d(0xd7),'path':__dirname+_0x304c0d(0x146)+_0x304c0d(0xfe)+_0x464493[0x0][_0x304c0d(0xeb)],'cid':_0x304c0d(0xe6)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x304c0d(0x102)+_0x304c0d(0x1f3)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x304c0d(0x1f3)+_0x304c0d(0x1ab)+_0x304c0d(0x1dd)+_0x304c0d(0x1f3)+_0x304c0d(0x184)+_0x464493[0x0][_0x304c0d(0x10d)]+_0x304c0d(0x19d)+_0x304c0d(0x1dd)+_0x304c0d(0x1dd)+_0x304c0d(0x144)+'<div>'+_0x304c0d(0x150)+_0x304c0d(0x137)+_0x293dce[_0x304c0d(0x180)]+'\x20'+_0x304c0d(0x1a8)+'\x20Order\x20Date\x20:\x20'+_0x293dce[_0x304c0d(0x13e)]+'\x20'+'</span>'+'</h5>'+_0x304c0d(0x1dd)+_0x304c0d(0x178)+_0x304c0d(0xe5)+_0x304c0d(0x1e3)+_0x304c0d(0x1d6)+_0x304c0d(0x1e4)+_0x304c0d(0x136)+_0x304c0d(0x17f)+_0x304c0d(0x131)+_0x304c0d(0x109)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x304c0d(0x152)+_0x304c0d(0xf4)+_0x304c0d(0x134)+'\x20'+_0x365eaa+'\x20'+_0x304c0d(0x186)+_0x304c0d(0xe9)+_0x304c0d(0x1f3)+'<strong>\x20Regards\x20</strong>'+_0x304c0d(0x114)+_0x464493[0x0][_0x304c0d(0x10d)]+'</h5>'+'</div>'+_0x304c0d(0x1dd)+_0x304c0d(0x13d)};_0x3de56b[_0x304c0d(0x101)](_0x346abf,function(_0x28dbfa,_0x6e9b1){var _0x16c05b=_0x304c0d;_0x28dbfa?(console['log'](_0x28dbfa),console['log'](_0x16c05b(0x1a0))):console['log'](_0x16c05b(0x11f));}),_0x1b78d4[_0x304c0d(0x199)](_0x304c0d(0x1d4),_0x304c0d(0x1d0)),_0x485a17[_0x304c0d(0x195)](_0x304c0d(0x129));}catch(_0xd03f78){console[_0x304c0d(0x122)](_0xd03f78),_0x485a17['status'](0x1f4)[_0x304c0d(0xfa)]({'error':_0x304c0d(0x1a3)});}})[_0x42e929(0x1cf)](_0x3e1436=>{var _0x19d2c2=_0x42e929;console[_0x19d2c2(0x122)](_0x3e1436),_0x485a17[_0x19d2c2(0xd9)](0x1f4)[_0x19d2c2(0xfa)]({'error':_0x19d2c2(0x1b6)});});}catch(_0x2ce655){console[_0x42e929(0x1f8)](_0x2ce655);}}),router['get'](a0_0x265f88(0xdf),auth,async(_0x1c9cfb,_0x583c64)=>{var _0x400be5=a0_0x265f88;try{const {username:_0x46f1e2,email:_0x27d2a4,role:_0x318dcf}=_0x1c9cfb[_0x400be5(0x1d2)],_0x3b5779=_0x1c9cfb[_0x400be5(0x1d2)],_0x29d9b8=await profile[_0x400be5(0x1d3)]({'email':_0x3b5779[_0x400be5(0xe3)]}),_0x1b5531=await master_shop[_0x400be5(0x1f9)](),_0x338447=_0x1c9cfb['params']['id'],_0x3004d6=await purchases[_0x400be5(0x1b3)](_0x338447),_0x1d1991=await warehouse['aggregate']([{'$match':{'name':_0x3004d6[_0x400be5(0xec)],'room':_0x3004d6[_0x400be5(0x170)]}},{'$unwind':_0x400be5(0x115)},{'$group':{'_id':_0x400be5(0x172),'name':{'$first':_0x400be5(0x1f5)},'product_stock':{'$first':_0x400be5(0x126)},'bay':{'$first':_0x400be5(0x148)},'bin':{'$first':_0x400be5(0x16b)},'type':{'$first':_0x400be5(0x1e5)},'floorlevel':{'$first':_0x400be5(0x1d8)},'primary_code':{'$first':_0x400be5(0x1bb)},'secondary_code':{'$first':_0x400be5(0xe2)},'product_code':{'$first':_0x400be5(0x15e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x400be5(0x14b)},'expiry_date':{'$first':_0x400be5(0x10c)}}}]),_0xf723f1=await customer[_0x400be5(0x1f9)]({});let _0x4a0ce0;if(_0x3b5779[_0x400be5(0xe7)]==_0x400be5(0xdb)){const _0x3028a9=await staff[_0x400be5(0x1d3)]({'email':_0x3b5779[_0x400be5(0xe3)]});_0x4a0ce0=await warehouse[_0x400be5(0x19c)]([{'$match':{'status':_0x400be5(0x190),'name':_0x3028a9[_0x400be5(0x13a)]}},{'$group':{'_id':_0x400be5(0xfb),'name':{'$first':_0x400be5(0xfb)}}}]);}else _0x4a0ce0=await warehouse[_0x400be5(0x19c)]([{'$match':{'status':_0x400be5(0x190)}},{'$group':{'_id':_0x400be5(0xfb),'name':{'$first':'$name'}}}]);const _0x53c3de=await product[_0x400be5(0x1f9)]({}),_0x166e7f=await suppliers[_0x400be5(0x1f9)]({}),_0x39d50b=BayBinSelected(_0x3004d6['warehouse_name'],_0x3004d6['room']);if(_0x1b5531[0x0][_0x400be5(0x1b0)]=='English\x20(US)'){var _0x1e6b07=users[_0x400be5(0x1e0)];console[_0x400be5(0x1f8)](_0x1e6b07);}else{if(_0x1b5531[0x0][_0x400be5(0x1b0)]==_0x400be5(0x107))var _0x1e6b07=users[_0x400be5(0x107)];else{if(_0x1b5531[0x0][_0x400be5(0x1b0)]=='German')var _0x1e6b07=users[_0x400be5(0xd1)];else{if(_0x1b5531[0x0][_0x400be5(0x1b0)]==_0x400be5(0x12f))var _0x1e6b07=users[_0x400be5(0x12f)];else{if(_0x1b5531[0x0][_0x400be5(0x1b0)]==_0x400be5(0x1f6))var _0x1e6b07=users[_0x400be5(0x1f6)];else{if(_0x1b5531[0x0][_0x400be5(0x1b0)]=='Portuguese\x20(BR)')var _0x1e6b07=users[_0x400be5(0x1be)];else{if(_0x1b5531[0x0]['language']==_0x400be5(0x1ba))var _0x1e6b07=users[_0x400be5(0x1ba)];else{if(_0x1b5531[0x0][_0x400be5(0x1b0)]=='Arabic\x20(ae)')var _0x1e6b07=users[_0x400be5(0x18e)];}}}}}}}_0x583c64[_0x400be5(0x19e)](_0x400be5(0x17e),{'success':_0x1c9cfb['flash'](_0x400be5(0x1d4)),'errors':_0x1c9cfb[_0x400be5(0x199)](_0x400be5(0x175)),'role':_0x3b5779,'profile':_0x29d9b8,'customer':_0xf723f1,'warehouse':_0x4a0ce0,'product':_0x1d1991,'user':_0x3004d6,'master_shop':_0x1b5531,'unit':_0x53c3de,'language':_0x1e6b07,'suppliers':_0x166e7f,'dataSelected':_0x39d50b});}catch(_0x1a354c){console[_0x400be5(0x1f8)](_0x1a354c);}}),router[a0_0x265f88(0x1f7)]('/preview/:id',auth,async(_0x5d3b71,_0x5c6a75)=>{var _0x4c4851=a0_0x265f88;try{const _0x12078a=_0x5d3b71[_0x4c4851(0x125)]['id'],{invoice:_0x1c86db,warehouse_name:_0x19148c,Room_name:_0x5e297}=_0x5d3b71['body'],_0x1adf42=await warehouse['findOne']({'name':_0x19148c,'room':_0x5e297}),_0x4e4f03=await purchases[_0x4c4851(0x1d3)]({'invoice':_0x1c86db});_0x4e4f03[_0x4c4851(0x1b4)][_0x4c4851(0xe4)](_0xa2e2fd=>{var _0x8561c0=_0x4c4851,_0x4fa9aa=0x0;const _0x3d0ba3=_0x1adf42[_0x8561c0(0x13c)]['map'](_0x3d8e06=>{var _0x30717c=_0x8561c0;_0x3d8e06[_0x30717c(0x1c5)]==_0xa2e2fd[_0x30717c(0x1c5)]&&_0x3d8e06[_0x30717c(0x116)]==_0xa2e2fd['floorlevel']&&_0x3d8e06[_0x30717c(0x160)]==_0xa2e2fd[_0x30717c(0x160)]&&_0x3d8e06[_0x30717c(0x163)]==_0xa2e2fd[_0x30717c(0x163)]&&_0x3d8e06[_0x30717c(0x194)]==_0xa2e2fd[_0x30717c(0x194)]&&_0x3d8e06[_0x30717c(0x149)]==_0xa2e2fd[_0x30717c(0x149)]&&_0x3d8e06['storage']==_0xa2e2fd[_0x30717c(0x1a4)]&&_0x3d8e06[_0x30717c(0xea)]==_0xa2e2fd['expiry_date']&&_0x3d8e06[_0x30717c(0x1b8)]==_0xa2e2fd['batch_code']&&_0x3d8e06[_0x30717c(0x1b5)]==_0xa2e2fd[_0x30717c(0x1b5)]&&_0x3d8e06[_0x30717c(0xfd)]==_0xa2e2fd[_0x30717c(0xfd)]&&_0x3d8e06[_0x30717c(0x1fa)]==_0xa2e2fd[_0x30717c(0x1fa)]&&(_0x3d8e06[_0x30717c(0x1e1)]=parseInt(_0x3d8e06[_0x30717c(0x1e1)])+parseInt(_0xa2e2fd[_0x30717c(0x16d)]),_0x4fa9aa++);});_0x4fa9aa=='0'&&(_0x1adf42[_0x8561c0(0x13c)]=_0x1adf42['product_details'][_0x8561c0(0x1b1)]({'product_name':_0xa2e2fd[_0x8561c0(0x1c5)],'product_stock':_0xa2e2fd[_0x8561c0(0x16d)],'primary_code':_0xa2e2fd[_0x8561c0(0xf0)],'secondary_code':_0xa2e2fd[_0x8561c0(0x147)],'product_code':_0xa2e2fd['product_code'],'storage':_0xa2e2fd['storage'],'rack':_0xa2e2fd['rack'],'bay':_0xa2e2fd[_0x8561c0(0x194)],'bin':_0xa2e2fd['bin'],'type':_0xa2e2fd[_0x8561c0(0x160)],'floorlevel':_0xa2e2fd[_0x8561c0(0x116)],'maxProducts':_0xa2e2fd[_0x8561c0(0x1d1)],'unit':_0xa2e2fd[_0x8561c0(0x18b)],'secondary_unit':_0xa2e2fd[_0x8561c0(0x128)],'expiry_date':_0xa2e2fd[_0x8561c0(0xea)],'maxPerUnit':_0xa2e2fd['maxperunit'],'batch_code':_0xa2e2fd['batch_code'],'alertQTY':_0xa2e2fd[_0x8561c0(0xef)],'production_date':_0xa2e2fd['production_date'],'delivery_date':_0xa2e2fd[_0x8561c0(0xfd)],'delivery_code':_0xa2e2fd[_0x8561c0(0x1fa)]}));}),await _0x1adf42[_0x4c4851(0x16e)](),_0x4e4f03[_0x4c4851(0x13f)]='True';const _0x3e96b0=await _0x4e4f03[_0x4c4851(0x16e)]();_0x5d3b71[_0x4c4851(0x199)](_0x4c4851(0x1d4),'Sales\x20Update\x20successfully'),_0x5c6a75[_0x4c4851(0x195)](_0x4c4851(0x110));}catch(_0x712174){console[_0x4c4851(0x1f8)](_0x712174);}}),router[a0_0x265f88(0x171)]('/view/:id',auth,async(_0xccc710,_0x2a9c65)=>{var _0x53a05a=a0_0x265f88;try{const {username:_0x12b560,email:_0x2a2b92,role:_0x5c25e6}=_0xccc710[_0x53a05a(0x1d2)],_0x5761c6=_0xccc710[_0x53a05a(0x1d2)],_0xf89d01=await profile['findOne']({'email':_0x5761c6[_0x53a05a(0xe3)]}),_0x5074ec=await master_shop[_0x53a05a(0x1f9)](),_0x493022=_0xccc710[_0x53a05a(0x125)]['id'],_0x51e695=await purchases[_0x53a05a(0x1b3)](_0x493022),_0xd25710=await suppliers[_0x53a05a(0x1f9)]({});let _0x1b9556;if(_0x5761c6['role']==_0x53a05a(0xdb)){const _0x47d6ac=await staff[_0x53a05a(0x1d3)]({'email':_0x5761c6[_0x53a05a(0xe3)]});_0x1b9556=await warehouse[_0x53a05a(0x1f9)]({'status':_0x53a05a(0x190),'name':_0x47d6ac[_0x53a05a(0x13a)],'warehouse_category':_0x53a05a(0x111)});}else _0x1b9556=await warehouse[_0x53a05a(0x19c)]([{'$match':{'status':_0x53a05a(0x190),'warehouse_category':_0x53a05a(0x111)}},{'$group':{'_id':_0x53a05a(0xfb),'name':{'$first':'$name'}}}]);const _0x234be6=await product['find']({}),_0x3f1849=BayBinSelected(_0x51e695[_0x53a05a(0xec)],_0x51e695[_0x53a05a(0x170)]);let _0x129767=new Date(_0x51e695['expiry_date']),_0x3d27c6=('0'+_0x129767[_0x53a05a(0x1ea)]())[_0x53a05a(0xd5)](-0x2),_0x35b27b=('0'+(_0x129767['getMonth']()+0x1))[_0x53a05a(0xd5)](-0x2),_0x105095=_0x129767[_0x53a05a(0x168)](),_0x55f552=_0x105095+'-'+_0x35b27b+'-'+_0x3d27c6;if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0x185)){var _0x36fcde=users['English'];console[_0x53a05a(0x1f8)](_0x36fcde);}else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0x107))var _0x36fcde=users[_0x53a05a(0x107)];else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0xd1))var _0x36fcde=users[_0x53a05a(0xd1)];else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0x12f))var _0x36fcde=users[_0x53a05a(0x12f)];else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0x1f6))var _0x36fcde=users[_0x53a05a(0x1f6)];else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]=='Portuguese\x20(BR)')var _0x36fcde=users['Portuguese'];else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0x1ba))var _0x36fcde=users[_0x53a05a(0x1ba)];else{if(_0x5074ec[0x0][_0x53a05a(0x1b0)]==_0x53a05a(0x16a))var _0x36fcde=users['Arabic'];}}}}}}}_0x2a9c65[_0x53a05a(0x19e)](_0x53a05a(0x1c3),{'success':_0xccc710[_0x53a05a(0x199)]('success'),'errors':_0xccc710[_0x53a05a(0x199)]('errors'),'role':_0x5761c6,'profile':_0xf89d01,'purchases':_0x51e695,'suppliers':_0xd25710,'warehouse':_0x1b9556,'product':_0x234be6,'master_shop':_0x5074ec,'language':_0x36fcde,'ed_fullDate':_0x55f552,'dataSelected':_0x3f1849});}catch(_0x1a32e3){console[_0x53a05a(0x1f8)](_0x1a32e3);}}),router[a0_0x265f88(0x1f7)](a0_0x265f88(0xd8),auth,async(_0x1314f9,_0x5bb48a)=>{var _0x1319cc=a0_0x265f88;try{const _0x16e666=_0x1314f9[_0x1319cc(0x125)]['id'],_0x10f2cf=await purchases[_0x1319cc(0x1d3)]({'_id':_0x1314f9[_0x1319cc(0x125)]['id']}),_0x4958a4=await warehouse[_0x1319cc(0x1d3)]({'name':_0x10f2cf[_0x1319cc(0xec)],'room':_0x10f2cf[_0x1319cc(0x170)]});_0x10f2cf[_0x1319cc(0x1b4)]['forEach'](_0x5072eb=>{var _0x1c0b2e=_0x1319cc;const _0x812355=_0x4958a4[_0x1c0b2e(0x13c)][_0x1c0b2e(0x10f)](_0x5d6af4=>{var _0x33bbbb=_0x1c0b2e;_0x5d6af4[_0x33bbbb(0x1c5)]==_0x5072eb[_0x33bbbb(0x1c5)]&&_0x5d6af4[_0x33bbbb(0x116)]==_0x5072eb[_0x33bbbb(0x116)]&&_0x5d6af4[_0x33bbbb(0x160)]==_0x5072eb[_0x33bbbb(0x160)]&&_0x5d6af4['bin']==_0x5072eb[_0x33bbbb(0x163)]&&_0x5d6af4[_0x33bbbb(0x194)]==_0x5072eb[_0x33bbbb(0x194)]&&_0x5d6af4[_0x33bbbb(0x149)]==_0x5072eb[_0x33bbbb(0x149)]&&_0x5d6af4['storage']==_0x5072eb['storage']&&(_0x5d6af4[_0x33bbbb(0x1e1)]=parseInt(_0x5d6af4[_0x33bbbb(0x1e1)])-parseInt(_0x5072eb[_0x33bbbb(0x16d)]));});}),await _0x4958a4[_0x1319cc(0x16e)]();const {invoice:_0x3885d2,suppliers:_0x279ac4,date:_0x1d6697,warehouse_name:_0x1b3057,prod_name:_0x4e2817,prod_code:_0x580d0c,prod_qty:_0x495b1d,prod_unit:_0x4c9b8a,prod_secondunit:_0x16c379,prod_level:_0x502d26,prod_isle:_0x2286be,prod_pallet:_0x2c4a7a,note:_0x2215e6,expiry_date:_0x2bff4f,batch_code:_0x5c06f9,paid_amount:_0x20ee8b,due_amount:_0x2f190d,Room_name:_0x56a7b4,primary_code:_0x1cda4f,secondary_code:_0x569c97,PO_number:_0xdbf511,JO_number:_0x5535be}=_0x1314f9[_0x1319cc(0x123)];if(typeof _0x4e2817==_0x1319cc(0xe1))var _0x3de8e3=[_0x1314f9['body'][_0x1319cc(0xdd)]],_0x462efe=[_0x1314f9['body'][_0x1319cc(0x1b9)]],_0x9fd3f9=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x1c0)]],_0x1471b9=[_0x1314f9['body'][_0x1319cc(0x12a)]],_0x5d8b79=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x1b7)]],_0xc0f16b=[_0x1314f9['body'][_0x1319cc(0x151)]],_0x415c93=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x145)]],_0x38c447=[_0x1314f9['body']['prod_pallet']],_0x133c0d=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0xf0)]],_0x573090=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x147)]],_0xa5ffa=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x104)]],_0x3c1f1d=[_0x1314f9[_0x1319cc(0x123)]['batch_code']],_0x479533=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0xea)]],_0x5945c0=[_0x1314f9[_0x1319cc(0x123)]['storage']],_0x4660ee=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x10b)]],_0x22f47a=[_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x160)]];else var _0x3de8e3=[..._0x1314f9[_0x1319cc(0x123)]['prod_name']],_0x462efe=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x1b9)]],_0x9fd3f9=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x1c0)]],_0x1471b9=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x12a)]],_0x5d8b79=[..._0x1314f9[_0x1319cc(0x123)]['prod_secondunit']],_0xc0f16b=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x151)]],_0x415c93=[..._0x1314f9['body'][_0x1319cc(0x145)]],_0x38c447=[..._0x1314f9[_0x1319cc(0x123)]['prod_pallet']],_0x133c0d=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0xf0)]],_0x573090=[..._0x1314f9['body']['secondary_code']],_0xa5ffa=[..._0x1314f9['body'][_0x1319cc(0x104)]],_0x3c1f1d=[..._0x1314f9['body'][_0x1319cc(0x1b8)]],_0x479533=[..._0x1314f9['body'][_0x1319cc(0xea)]],_0x5945c0=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x1a4)]],_0x4660ee=[..._0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x10b)]],_0x22f47a=[..._0x1314f9['body']['type']];const _0x491947=_0x3de8e3[_0x1319cc(0x10f)](_0x18aa7b=>{return _0x18aa7b={'product_name':_0x18aa7b};});_0x462efe[_0x1319cc(0xe4)]((_0x2e2080,_0x43093b)=>{var _0x200cd2=_0x1319cc;_0x491947[_0x43093b][_0x200cd2(0x157)]=_0x2e2080;}),_0x9fd3f9[_0x1319cc(0xe4)]((_0x382450,_0x4edd7b)=>{var _0x10b123=_0x1319cc;_0x491947[_0x4edd7b][_0x10b123(0x16d)]=_0x382450;}),_0x1471b9[_0x1319cc(0xe4)]((_0x3c836c,_0x3fd7da)=>{var _0x21af6e=_0x1319cc;_0x491947[_0x3fd7da][_0x21af6e(0x18b)]=_0x3c836c;}),_0x5d8b79[_0x1319cc(0xe4)]((_0xe5e588,_0x22a17e)=>{_0x491947[_0x22a17e]['secondary_unit']=_0xe5e588;}),_0xc0f16b[_0x1319cc(0xe4)]((_0x2038f1,_0x434072)=>{_0x491947[_0x434072]['bay']=_0x2038f1;}),_0x415c93[_0x1319cc(0xe4)]((_0x1e2314,_0x371d92)=>{var _0x4cf591=_0x1319cc;_0x491947[_0x371d92][_0x4cf591(0x163)]=_0x1e2314;}),_0x38c447[_0x1319cc(0xe4)]((_0x26ab73,_0x4bf24e)=>{var _0x145a45=_0x1319cc;_0x491947[_0x4bf24e][_0x145a45(0x116)]=_0x26ab73;}),_0x133c0d['forEach']((_0x60ecf4,_0x13a118)=>{var _0x46fdbc=_0x1319cc;_0x491947[_0x13a118][_0x46fdbc(0xf0)]=_0x60ecf4;}),_0x573090['forEach']((_0xdc2625,_0x2022ba)=>{_0x491947[_0x2022ba]['secondary_code']=_0xdc2625;}),_0xa5ffa[_0x1319cc(0xe4)]((_0xf07f46,_0x4b910a)=>{_0x491947[_0x4b910a]['maxStocks']=_0xf07f46;}),_0x3c1f1d[_0x1319cc(0xe4)]((_0x347a85,_0x311074)=>{var _0x1ef154=_0x1319cc;_0x491947[_0x311074][_0x1ef154(0x1b8)]=_0x347a85;}),_0x479533[_0x1319cc(0xe4)]((_0x254a3e,_0x99a0a7)=>{var _0x362da8=_0x1319cc;_0x491947[_0x99a0a7][_0x362da8(0xea)]=_0x254a3e;}),_0x22f47a[_0x1319cc(0xe4)]((_0x4806ee,_0x1fdfc3)=>{var _0x3d9927=_0x1319cc;_0x491947[_0x1fdfc3][_0x3d9927(0x160)]=_0x4806ee;}),_0x5945c0[_0x1319cc(0xe4)]((_0x5a0598,_0x5e5c67)=>{var _0x3983f7=_0x1319cc;_0x491947[_0x5e5c67][_0x3983f7(0x1a4)]=_0x5a0598;}),_0x4660ee[_0x1319cc(0xe4)]((_0x407fe9,_0x178e8b)=>{var _0x345810=_0x1319cc;_0x491947[_0x178e8b][_0x345810(0x149)]=_0x407fe9;});const _0x224bd0=_0x491947[_0x1319cc(0xe0)](_0x331b9f=>_0x331b9f[_0x1319cc(0x16d)]!=='0'&&_0x331b9f['quantity']!=='');_0x10f2cf[_0x1319cc(0x180)]=_0x3885d2,_0x10f2cf[_0x1319cc(0x1e7)]=_0x279ac4,_0x10f2cf[_0x1319cc(0x13e)]=_0x1d6697,_0x10f2cf[_0x1319cc(0xec)]=_0x1b3057,_0x10f2cf[_0x1319cc(0x1b4)]=_0x224bd0,_0x10f2cf['note']=_0x2215e6,_0x10f2cf['paid_amount']=_0x20ee8b,_0x10f2cf[_0x1319cc(0x138)]=_0x2f190d,_0x10f2cf[_0x1319cc(0x170)]=_0x56a7b4,_0x10f2cf[_0x1319cc(0x100)]=_0xdbf511,_0x10f2cf[_0x1319cc(0x124)]=_0x5535be;const _0x321d39=await _0x10f2cf[_0x1319cc(0x16e)](),_0x12335d=await warehouse[_0x1319cc(0x1d3)]({'name':_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0xec)],'room':_0x1314f9[_0x1319cc(0x123)]['Room_name']});_0x10f2cf[_0x1319cc(0x1b4)][_0x1319cc(0xe4)](_0x1b3710=>{var _0x5f532d=_0x1319cc,_0x5f43fb=0x0;const _0x3200b0=_0x12335d[_0x5f532d(0x13c)][_0x5f532d(0x10f)](_0x283176=>{var _0x143dce=_0x5f532d;_0x283176[_0x143dce(0x1c5)]==_0x1b3710[_0x143dce(0x1c5)]&&_0x283176['floorlevel']==_0x1b3710[_0x143dce(0x116)]&&_0x283176['type']==_0x1b3710['type']&&_0x283176[_0x143dce(0x163)]==_0x1b3710[_0x143dce(0x163)]&&_0x283176['bay']==_0x1b3710[_0x143dce(0x194)]&&_0x283176[_0x143dce(0x149)]==_0x1b3710[_0x143dce(0x149)]&&_0x283176[_0x143dce(0x1a4)]==_0x1b3710[_0x143dce(0x1a4)]&&(_0x283176['product_stock']=parseInt(_0x283176[_0x143dce(0x1e1)])+parseInt(_0x1b3710['quantity']),_0x5f43fb++);});_0x5f43fb=='0'&&(_0x12335d[_0x5f532d(0x13c)]=_0x12335d[_0x5f532d(0x13c)][_0x5f532d(0x1b1)]({'product_name':_0x1b3710[_0x5f532d(0x1c5)],'product_stock':_0x1b3710[_0x5f532d(0x16d)],'primary_code':_0x1b3710['primary_code'],'secondary_code':_0x1b3710['secondary_code'],'product_code':_0x1b3710['product_code'],'storage':_0x1b3710[_0x5f532d(0x1a4)],'rack':_0x1b3710['rack'],'bay':_0x1b3710[_0x5f532d(0x194)],'bin':_0x1b3710[_0x5f532d(0x163)],'type':_0x1b3710['type'],'floorlevel':_0x1b3710[_0x5f532d(0x116)],'maxProducts':_0x1b3710[_0x5f532d(0x1d1)],'unit':_0x1b3710[_0x5f532d(0x18b)],'secondary_unit':_0x1b3710['secondary_unit'],'expiry_date':_0x1b3710[_0x5f532d(0xea)]}));}),await _0x12335d[_0x1319cc(0x16e)]();const _0x1196d0=await s_payment_data['findOne']({'invoice':_0x1314f9['body']['invoice']});if(_0x1196d0===null){}else console[_0x1319cc(0x1f8)](_0x1319cc(0x1e7),_0x1196d0,_0x1314f9['body'][_0x1319cc(0x180)]),_0x1196d0['suppliers']=_0x1314f9[_0x1319cc(0x123)][_0x1319cc(0x1e7)],await _0x1196d0[_0x1319cc(0x16e)]();_0x1314f9[_0x1319cc(0x199)](_0x1319cc(0x1d4),_0x1319cc(0x173)),_0x5bb48a['redirect'](_0x1319cc(0x110));}catch(_0x5bb650){console[_0x1319cc(0x1f8)](_0x5bb650);}}),router[a0_0x265f88(0x1f7)](a0_0x265f88(0x139),auth,async(_0x4f39d1,_0x4debeb)=>{var _0x26ec1b=a0_0x265f88;try{const _0x155530=_0x4f39d1[_0x26ec1b(0x125)]['id'],{invoice:_0x3a1fe2,suppliers:_0x5ea205,payable:_0x3cea18,due_amount:_0x57e684}=_0x4f39d1[_0x26ec1b(0x123)],_0x4b600d=await purchases[_0x26ec1b(0x1b3)](_0x155530);var _0x5cd0bf=_0x3cea18-_0x57e684;_0x4b600d[_0x26ec1b(0x1e2)]=parseFloat(_0x4b600d[_0x26ec1b(0x1e2)])+parseFloat(_0x57e684),_0x4b600d[_0x26ec1b(0x138)]=_0x5cd0bf;const _0x2eccd3=await _0x4b600d['save']();console['log'](_0x2eccd3);const _0x97586e=await s_payment_data['findOne']({'invoice':_0x3a1fe2});_0x97586e[_0x26ec1b(0x103)]=_0x5cd0bf,await _0x97586e[_0x26ec1b(0x16e)]();let _0x58ed3c=new Date(),_0x44f1a3=('0'+_0x58ed3c[_0x26ec1b(0x1ea)]())[_0x26ec1b(0xd5)](-0x2),_0x6f5d6d=('0'+(_0x58ed3c[_0x26ec1b(0x1a1)]()+0x1))[_0x26ec1b(0xd5)](-0x2),_0x16b72b=_0x58ed3c[_0x26ec1b(0x168)](),_0x9fd8f9=_0x16b72b+'-'+_0x6f5d6d+'-'+_0x44f1a3;const _0x3e204d=new suppliers_payment({'invoice':_0x3a1fe2,'date':_0x16b72b+'-'+_0x6f5d6d+'-'+_0x44f1a3,'suppliers':_0x5ea205,'reason':'Paid\x20For\x20Purchase','amount':_0x57e684}),_0x392791=await _0x3e204d['save']();_0x4f39d1[_0x26ec1b(0x199)](_0x26ec1b(0x1d4),_0x26ec1b(0x189)),_0x4debeb[_0x26ec1b(0x195)](_0x26ec1b(0x110));}catch(_0x2b1dde){console['log'](_0x2b1dde);}}),router[a0_0x265f88(0x171)](a0_0x265f88(0x1cd),auth,async(_0x18de9d,_0x48facf)=>{var _0x2c63a1=a0_0x265f88;try{const {username:_0x444171,email:_0x2aab65,role:_0xa9a201}=_0x18de9d[_0x2c63a1(0x1d2)],_0xc79f7b=_0x18de9d['user'],_0x36bdd6=await profile[_0x2c63a1(0x1d3)]({'email':_0xc79f7b['email']}),_0x505bc7=await master_shop['find']();console['log'](_0x2c63a1(0x121),_0x505bc7);const _0x5a229b=_0x18de9d[_0x2c63a1(0x125)]['id'],_0x2b4c56=await purchases['findById'](_0x5a229b);console['log'](_0x2b4c56);const _0x397544=await suppliers[_0x2c63a1(0x1d3)]({'name':_0x2b4c56[_0x2c63a1(0x1e7)]});console['log'](_0x397544);if(_0x505bc7[0x0]['language']==_0x2c63a1(0x185)){var _0x3d6cd2=users[_0x2c63a1(0x1e0)];console['log'](_0x3d6cd2);}else{if(_0x505bc7[0x0][_0x2c63a1(0x1b0)]==_0x2c63a1(0x107))var _0x3d6cd2=users['Hindi'];else{if(_0x505bc7[0x0][_0x2c63a1(0x1b0)]==_0x2c63a1(0xd1))var _0x3d6cd2=users[_0x2c63a1(0xd1)];else{if(_0x505bc7[0x0]['language']==_0x2c63a1(0x12f))var _0x3d6cd2=users[_0x2c63a1(0x12f)];else{if(_0x505bc7[0x0][_0x2c63a1(0x1b0)]==_0x2c63a1(0x1f6))var _0x3d6cd2=users[_0x2c63a1(0x1f6)];else{if(_0x505bc7[0x0][_0x2c63a1(0x1b0)]==_0x2c63a1(0x1d5))var _0x3d6cd2=users[_0x2c63a1(0x1be)];else{if(_0x505bc7[0x0][_0x2c63a1(0x1b0)]==_0x2c63a1(0x1ba))var _0x3d6cd2=users['Chinese'];else{if(_0x505bc7[0x0][_0x2c63a1(0x1b0)]=='Arabic\x20(ae)')var _0x3d6cd2=users['Arabic'];}}}}}}}_0x48facf['render'](_0x2c63a1(0x174),{'success':_0x18de9d[_0x2c63a1(0x199)]('success'),'errors':_0x18de9d[_0x2c63a1(0x199)](_0x2c63a1(0x175)),'role':_0xc79f7b,'profile':_0x36bdd6,'master_shop':_0x505bc7,'supplier':_0x397544,'purchase':_0x2b4c56,'language':_0x3d6cd2});}catch(_0x5866e8){console[_0x2c63a1(0x1f8)](_0x5866e8);}}),router[a0_0x265f88(0x171)](a0_0x265f88(0x1f4),auth,async(_0x4ec13a,_0x1f1de0)=>{var _0x390efc=a0_0x265f88;try{const {username:_0x5b29d5,email:_0x4faf1b,role:_0x154573}=_0x4ec13a[_0x390efc(0x1d2)],_0x280a85=_0x4ec13a[_0x390efc(0x1d2)],_0x26a307=await profile[_0x390efc(0x1d3)]({'email':_0x280a85[_0x390efc(0xe3)]}),_0x250c53=await master_shop[_0x390efc(0x1f9)]();console[_0x390efc(0x1f8)](_0x390efc(0x121),_0x250c53);const _0x542ce8=_0x4ec13a[_0x390efc(0x125)]['id'];console[_0x390efc(0x1f8)](_0x542ce8);const _0x3d3b6e=await purchases['findById'](_0x542ce8);console[_0x390efc(0x1f8)](_0x390efc(0x16f),_0x3d3b6e);const _0x33c3ef=await product[_0x390efc(0x1f9)]({}),_0xcd3ced=await warehouse['aggregate']([{'$match':{'name':_0x3d3b6e[_0x390efc(0xec)],'room':_0x3d3b6e['room'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x390efc(0x115)},{'$group':{'_id':_0x390efc(0x172),'name':{'$first':_0x390efc(0x1f5)},'product_stock':{'$first':_0x390efc(0x126)},'bay':{'$first':_0x390efc(0x148)},'bin':{'$first':_0x390efc(0x16b)},'type':{'$first':_0x390efc(0x1e5)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x390efc(0x1bb)},'secondary_code':{'$first':_0x390efc(0xe2)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x390efc(0x188)},'rack':{'$first':_0x390efc(0x14b)}}}]);warehouse_data=await warehouse[_0x390efc(0x19c)]([{'$match':{'status':'Enabled','name':_0x390efc(0xf2),'warehouse_category':_0x390efc(0x111)}},{'$group':{'_id':_0x390efc(0xfb),'name':{'$first':_0x390efc(0xfb)}}},{'$sort':{'name':0x1}}]),console[_0x390efc(0x1f8)](_0x390efc(0x15d),_0xcd3ced);if(_0x250c53[0x0]['language']=='English\x20(US)'){var _0x17de28=users['English'];console[_0x390efc(0x1f8)](_0x17de28);}else{if(_0x250c53[0x0][_0x390efc(0x1b0)]==_0x390efc(0x107))var _0x17de28=users[_0x390efc(0x107)];else{if(_0x250c53[0x0][_0x390efc(0x1b0)]==_0x390efc(0xd1))var _0x17de28=users[_0x390efc(0xd1)];else{if(_0x250c53[0x0]['language']=='Spanish')var _0x17de28=users['Spanish'];else{if(_0x250c53[0x0][_0x390efc(0x1b0)]=='French')var _0x17de28=users[_0x390efc(0x1f6)];else{if(_0x250c53[0x0][_0x390efc(0x1b0)]=='Portuguese\x20(BR)')var _0x17de28=users['Portuguese'];else{if(_0x250c53[0x0][_0x390efc(0x1b0)]==_0x390efc(0x1ba))var _0x17de28=users['Chinese'];else{if(_0x250c53[0x0]['language']==_0x390efc(0x16a))var _0x17de28=users[_0x390efc(0x18e)];}}}}}}}_0x1f1de0[_0x390efc(0x19e)](_0x390efc(0x166),{'success':_0x4ec13a[_0x390efc(0x199)](_0x390efc(0x1d4)),'errors':_0x4ec13a['flash'](_0x390efc(0x175)),'role':_0x280a85,'profile':_0x26a307,'user':_0x3d3b6e,'stock':_0xcd3ced,'master_shop':_0x250c53,'product':_0x33c3ef,'language':_0x17de28,'warehouse':warehouse_data});}catch(_0x1ff344){console[_0x390efc(0x1f8)](_0x1ff344);}}),router[a0_0x265f88(0x1f7)](a0_0x265f88(0x1f4),auth,async(_0x3c9531,_0x51dc66)=>{var _0x148467=a0_0x265f88;try{const {invoice:_0x4419b0,date:_0xcce6cd,warehouse_name:_0x2dee51,Room_name:_0x45c394,product_name:_0x223f8b,purchase_quantity:_0x404fa4,stocks:_0x46b47f,return_qty:_0x584c17,note:_0x56f495,level:_0x3cffa4,isle:_0x2ff21c,pallet:_0x2efca5,to_warehouse_name:_0x484be9,to_Room_name:_0x521add}=_0x3c9531[_0x148467(0x123)],_0x1a87d9=await purchases[_0x148467(0x1d3)]({'_id':_0x3c9531[_0x148467(0x125)]['id']}),_0x45605a=await warehouse[_0x148467(0x1d3)]({'name':_0x2dee51,'room':_0x45c394});if(typeof _0x223f8b=='string')var _0x153af2=[_0x3c9531[_0x148467(0x123)]['product_name']],_0x1ceced=[_0x3c9531['body'][_0x148467(0x130)]],_0x19f44d=[_0x3c9531[_0x148467(0x123)][_0x148467(0x1c6)]],_0x2b46be=[_0x3c9531[_0x148467(0x123)][_0x148467(0x112)]],_0x7a7619=[_0x3c9531[_0x148467(0x123)][_0x148467(0x1e9)]],_0x89ea8f=[_0x3c9531[_0x148467(0x123)][_0x148467(0x1aa)]],_0x3560b5=[_0x3c9531[_0x148467(0x123)][_0x148467(0x179)]],_0x90d82=[_0x3c9531[_0x148467(0x123)][_0x148467(0x1da)]],_0x173a42=[_0x3c9531[_0x148467(0x123)][_0x148467(0xf9)]],_0x17a24a=[_0x3c9531[_0x148467(0x123)]['primary_code_hide']],_0x428a44=[_0x3c9531['body'][_0x148467(0x176)]];else var _0x153af2=[..._0x3c9531['body'][_0x148467(0x1c5)]],_0x1ceced=[..._0x3c9531[_0x148467(0x123)][_0x148467(0x130)]],_0x19f44d=[..._0x3c9531[_0x148467(0x123)]['stocks']],_0x2b46be=[..._0x3c9531['body']['return_qty']],_0x7a7619=[..._0x3c9531[_0x148467(0x123)][_0x148467(0x1e9)]],_0x89ea8f=[..._0x3c9531['body'][_0x148467(0x1aa)]],_0x3560b5=[..._0x3c9531[_0x148467(0x123)]['pallet']],_0x90d82=[..._0x3c9531[_0x148467(0x123)]['types']],_0x173a42=[..._0x3c9531[_0x148467(0x123)][_0x148467(0xf9)]],_0x17a24a=[..._0x3c9531['body'][_0x148467(0x1a5)]],_0x428a44=[..._0x3c9531[_0x148467(0x123)][_0x148467(0x176)]];const _0x359535=_0x153af2[_0x148467(0x10f)](_0x3f21ae=>{return _0x3f21ae={'product_name':_0x3f21ae};});_0x1ceced[_0x148467(0xe4)]((_0x3ded7a,_0x371f60)=>{var _0x33e30f=_0x148467;_0x359535[_0x371f60][_0x33e30f(0x130)]=_0x3ded7a;}),_0x19f44d[_0x148467(0xe4)]((_0x1bafd9,_0x35427f)=>{var _0x1356c5=_0x148467;_0x359535[_0x35427f][_0x1356c5(0x1bd)]=_0x1bafd9;}),_0x2b46be[_0x148467(0xe4)]((_0xa45c9b,_0x304483)=>{var _0x455c50=_0x148467;_0x359535[_0x304483][_0x455c50(0x112)]=_0xa45c9b;}),_0x7a7619['forEach']((_0x21c136,_0x20c97a)=>{var _0x1d976a=_0x148467;_0x359535[_0x20c97a][_0x1d976a(0x194)]=_0x21c136;}),_0x89ea8f[_0x148467(0xe4)]((_0x36677c,_0x1708db)=>{var _0xfc018f=_0x148467;_0x359535[_0x1708db][_0xfc018f(0x163)]=_0x36677c;}),_0x3560b5[_0x148467(0xe4)]((_0x2d91bf,_0x19cabd)=>{var _0x3fec68=_0x148467;_0x359535[_0x19cabd][_0x3fec68(0x116)]=_0x2d91bf;}),_0x90d82[_0x148467(0xe4)]((_0x46f347,_0x101676)=>{var _0xa687d9=_0x148467;_0x359535[_0x101676][_0xa687d9(0x160)]=_0x46f347;}),_0x173a42[_0x148467(0xe4)]((_0xc8baa2,_0x4954fa)=>{var _0x2743d0=_0x148467;_0x359535[_0x4954fa][_0x2743d0(0x157)]=_0xc8baa2;}),_0x17a24a[_0x148467(0xe4)]((_0x5c9975,_0x50054f)=>{var _0x28baa0=_0x148467;_0x359535[_0x50054f][_0x28baa0(0xf0)]=_0x5c9975;}),_0x428a44[_0x148467(0xe4)]((_0x584763,_0x15538d)=>{var _0x3f7510=_0x148467;_0x359535[_0x15538d][_0x3f7510(0x147)]=_0x584763;}),_0x1a87d9[_0x148467(0x1b4)][_0x148467(0xe4)](_0x151716=>{var _0x17ffc7=_0x148467;const _0x25ee15=_0x45605a[_0x17ffc7(0x13c)]['map'](_0x66352=>{var _0x3305af=_0x17ffc7;_0x66352[_0x3305af(0x1c5)]==_0x151716[_0x3305af(0x1c5)]&&_0x66352[_0x3305af(0x116)]==_0x151716[_0x3305af(0x116)]&&_0x66352['type']==_0x151716[_0x3305af(0x160)]&&_0x66352['bin']==_0x151716[_0x3305af(0x163)]&&_0x66352['bay']==_0x151716['bay']&&_0x66352['rack']==_0x151716['rack']&&_0x66352[_0x3305af(0x1a4)]==_0x151716[_0x3305af(0x1a4)]&&(console['log'](parseInt(_0x66352['product_stock'])+_0x3305af(0x11b)+parseInt(_0x151716[_0x3305af(0x16d)])),_0x66352['product_stock']=parseInt(_0x66352[_0x3305af(0x1e1)])+parseInt(_0x151716['quantity']));});}),await _0x45605a[_0x148467(0x16e)]();const _0x3a6e87=_0x359535['filter'](_0xb2ee9b=>_0xb2ee9b[_0x148467(0x112)]!=='0'&&_0xb2ee9b[_0x148467(0x112)]!=='');var _0x112904=0x0;_0x3a6e87[_0x148467(0xe4)](_0x4f7eab=>{var _0xc22499=_0x148467;console[_0xc22499(0x1f8)]('foreach\x20newproduct',_0x4f7eab),(parseInt(_0x4f7eab[_0xc22499(0x130)])<parseInt(_0x4f7eab[_0xc22499(0x112)])||parseInt(_0x4f7eab['stock_quantity'])<parseInt(_0x4f7eab['return_qty']))&&_0x112904++;});if(_0x112904!=0x0)return _0x3c9531[_0x148467(0x199)](_0x148467(0x175),_0x148467(0x10a)),_0x51dc66[_0x148467(0x195)](_0x148467(0x17d));const _0xa466fa=new purchases_return({'invoice':_0x4419b0,'suppliers':_0x3c9531['body']['suppliers'],'date':_0xcce6cd,'warehouse_name':_0x2dee51,'return_product':_0x3a6e87,'note':_0x56f495,'room':_0x45c394,'to_warehouse_name':_0x484be9,'to_room':_0x521add}),_0x487c07=await _0xa466fa[_0x148467(0x16e)]();console[_0x148467(0x1f8)](_0xa466fa);const _0x539c7b=await purchases_return[_0x148467(0x1d3)]({'invoice':_0x4419b0}),_0x401d7e=await warehouse[_0x148467(0x1d3)]({'name':_0x484be9,'room':_0x521add});_0x539c7b[_0x148467(0x12c)][_0x148467(0xe4)](_0x32c9b1=>{var _0x46220f=_0x148467,_0x5638e9=0x0;const _0x4760e9=_0x401d7e['product_details'][_0x46220f(0x10f)](_0x3c8623=>{var _0x1e99ba=_0x46220f;_0x3c8623[_0x1e99ba(0x1c5)]==_0x32c9b1[_0x1e99ba(0x1c5)]&&_0x3c8623[_0x1e99ba(0x116)]==_0x32c9b1['floorlevel']&&_0x3c8623[_0x1e99ba(0x160)]==_0x32c9b1['type']&&_0x3c8623[_0x1e99ba(0x163)]==_0x32c9b1[_0x1e99ba(0x163)]&&_0x3c8623[_0x1e99ba(0x194)]==_0x32c9b1[_0x1e99ba(0x194)]&&(_0x3c8623['product_stock']=parseInt(_0x3c8623[_0x1e99ba(0x1e1)])-parseInt(_0x32c9b1[_0x1e99ba(0x112)]),_0x5638e9++);});_0x5638e9=='0'&&(_0x401d7e['product_details']=_0x401d7e[_0x46220f(0x13c)][_0x46220f(0x1b1)]({'product_name':_0x32c9b1[_0x46220f(0x1c5)],'product_stock':_0x32c9b1[_0x46220f(0x112)],'primary_code':_0x32c9b1[_0x46220f(0xf0)],'secondary_code':_0x32c9b1[_0x46220f(0x147)],'product_code':_0x32c9b1[_0x46220f(0x157)],'storage':_0x32c9b1['storage'],'rack':_0x32c9b1[_0x46220f(0x149)],'bay':_0x32c9b1[_0x46220f(0x194)],'bin':_0x32c9b1[_0x46220f(0x163)],'type':_0x32c9b1[_0x46220f(0x160)],'floorlevel':_0x32c9b1[_0x46220f(0x116)],'maxProducts':_0x32c9b1[_0x46220f(0x1d1)],'unit':_0x32c9b1[_0x46220f(0x18b)],'secondary_unit':_0x32c9b1[_0x46220f(0x128)],'expiry_date':_0x32c9b1[_0x46220f(0xea)]}));}),await _0x401d7e[_0x148467(0x16e)]();const _0x15e761=await purchases[_0x148467(0x1d3)]({'invoice':_0x4419b0});_0x15e761[_0x148467(0x12d)]='True';const _0x40f8b5=await _0x15e761['save'](),_0x1aa023=new s_payment_data({'invoice':_0x4419b0,'suppliers':_0x3c9531[_0x148467(0x123)][_0x148467(0x1e7)],'reason':_0x148467(0x1a6)});await _0x1aa023[_0x148467(0x16e)]();const _0x393788=await master_shop[_0x148467(0x1f9)]();console[_0x148467(0x1f8)](_0x148467(0x18f),_0x393788[0x0]['image']);const _0x595d7e=await email_settings['findOne'](),_0xcc543f=await suppliers['findOne']({'name':_0x3c9531[_0x148467(0x123)][_0x148467(0x1e7)]});console[_0x148467(0x1f8)]('suppliers_data',_0xcc543f);_0x393788[0x0][_0x148467(0x17c)]==0x1?(right_currency=_0x393788[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x393788[0x0][_0x148467(0x192)]);var _0x436e0a=_0x153af2,_0x19b24f=_0x2b46be,_0x2dc484='',_0x32adfd;for(_0x32adfd in _0x436e0a){_0x2dc484+=_0x148467(0x1e3)+_0x148467(0x1e6)+_0x436e0a[_0x32adfd]+_0x148467(0x1ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x19b24f[_0x32adfd]+_0x148467(0x1ae)+_0x148467(0x152);}console[_0x148467(0x1f8)](_0x148467(0x1a7),_0x2dc484);let _0x5bfe29=nodemailer[_0x148467(0x14f)]({'service':_0x148467(0x161),'auth':{'user':_0x595d7e['email'],'pass':_0x595d7e[_0x148467(0x1ef)]}}),_0x1dcbbe={'from':_0x595d7e[_0x148467(0xe3)],'to':_0xcc543f['email'],'subject':_0x148467(0x1d7),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x148467(0xfe)+_0x393788[0x0][_0x148467(0xeb)],'cid':_0x148467(0xe6)}],'html':_0x148467(0x11a)+_0x148467(0x164)+_0x148467(0x102)+_0x148467(0x1f3)+_0x148467(0x158)+_0x148467(0x1f3)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x148467(0x1dd)+_0x148467(0x1f3)+_0x148467(0x184)+_0x393788[0x0][_0x148467(0x10d)]+_0x148467(0x19d)+_0x148467(0x1dd)+_0x148467(0x1dd)+_0x148467(0x144)+_0x148467(0x1f3)+_0x148467(0x150)+'\x20Order\x20Number\x20:\x20'+_0x4419b0+'\x20'+_0x148467(0x1a8)+_0x148467(0x1c9)+_0xcce6cd+'\x20'+'</span>'+'</h5>'+'</div>'+_0x148467(0x178)+_0x148467(0xe5)+_0x148467(0x1e3)+_0x148467(0x1d6)+_0x148467(0x132)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x148467(0x152)+_0x148467(0xf4)+_0x148467(0x134)+'\x20'+_0x2dc484+'\x20'+_0x148467(0x186)+_0x148467(0xe9)+_0x148467(0x1f3)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x393788[0x0][_0x148467(0x10d)]+_0x148467(0x1c4)+'</div>'+'</div>'+'</body></html>'};_0x5bfe29['sendMail'](_0x1dcbbe,function(_0x460caf,_0x411525){var _0x58f7d1=_0x148467;_0x460caf?(console[_0x58f7d1(0x1f8)](_0x460caf),console[_0x58f7d1(0x1f8)](_0x58f7d1(0x1a0))):console['log'](_0x58f7d1(0x11f));}),_0x3c9531['flash']('success',_0x148467(0x167)),_0x51dc66[_0x148467(0x195)](_0x148467(0x110));}catch(_0x31e4fa){console[_0x148467(0x1f8)](_0x31e4fa),_0x51dc66[_0x148467(0xd9)](0xc8)[_0x148467(0xfa)]({'message':_0x31e4fa[_0x148467(0x1ec)]});}}),router['get']('/barcode/:id',auth,async(_0x201e11,_0x42e77e)=>{var _0x4c6f57=a0_0x265f88;try{const {username:_0x634a20,email:_0x2672dd,role:_0x416db6}=_0x201e11['user'],_0x4385a4=_0x201e11[_0x4c6f57(0x1d2)],_0x5d1d65=await profile[_0x4c6f57(0x1d3)]({'email':_0x4385a4['email']}),_0x18ff9b=await master_shop[_0x4c6f57(0x1f9)](),_0x2942b6=_0x201e11[_0x4c6f57(0x125)]['id'],_0x26b0fc=await purchases['findById'](_0x2942b6);if(_0x18ff9b[0x0]['language']=='English\x20(US)')var _0x3f7427=users[_0x4c6f57(0x1e0)];else{if(_0x18ff9b[0x0]['language']==_0x4c6f57(0x107))var _0x3f7427=users['Hindi'];else{if(_0x18ff9b[0x0][_0x4c6f57(0x1b0)]==_0x4c6f57(0xd1))var _0x3f7427=users[_0x4c6f57(0xd1)];else{if(_0x18ff9b[0x0]['language']=='Spanish')var _0x3f7427=users[_0x4c6f57(0x12f)];else{if(_0x18ff9b[0x0][_0x4c6f57(0x1b0)]==_0x4c6f57(0x1f6))var _0x3f7427=users[_0x4c6f57(0x1f6)];else{if(_0x18ff9b[0x0][_0x4c6f57(0x1b0)]=='Portuguese\x20(BR)')var _0x3f7427=users[_0x4c6f57(0x1be)];else{if(_0x18ff9b[0x0][_0x4c6f57(0x1b0)]==_0x4c6f57(0x1ba))var _0x3f7427=users[_0x4c6f57(0x1ba)];else{if(_0x18ff9b[0x0]['language']==_0x4c6f57(0x16a))var _0x3f7427=users['Arabic'];}}}}}}}_0x42e77e[_0x4c6f57(0x19e)](_0x4c6f57(0x1bf),{'success':_0x201e11['flash']('success'),'errors':_0x201e11[_0x4c6f57(0x199)](_0x4c6f57(0x175)),'role':_0x4385a4,'profile':_0x5d1d65,'alldata':_0x26b0fc,'master_shop':_0x18ff9b,'language':_0x3f7427}),console[_0x4c6f57(0x1f8)](alldata);}catch(_0x2b06ca){console[_0x4c6f57(0x1f8)](_0x2b06ca);}}),router[a0_0x265f88(0x1f7)](a0_0x265f88(0x10e),async(_0x4261b5,_0x4c6595)=>{var _0x538fbf=a0_0x265f88;const {product_code:_0x5b8e65}=_0x4261b5[_0x538fbf(0x123)];var _0x1d319c;const _0x328108=await product[_0x538fbf(0x19c)]([{'$match':{'primary_code':_0x5b8e65,'product_category':_0x538fbf(0x111)}},{'$group':{'_id':_0x538fbf(0x1d9),'name':{'$first':'$name'},'category':{'$first':_0x538fbf(0x18d)},'brand':{'$first':_0x538fbf(0x11d)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x538fbf(0x11c)},'primary_code':{'$first':_0x538fbf(0x182)},'secondary_code':{'$first':_0x538fbf(0xd3)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x538fbf(0x1af)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x538fbf(0xff)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x288bb2=await product['aggregate']([{'$match':{'secondary_code':_0x5b8e65,'product_category':_0x538fbf(0x111)}},{'$group':{'_id':_0x538fbf(0x1d9),'name':{'$first':'$name'},'category':{'$first':_0x538fbf(0x18d)},'brand':{'$first':'$brand'},'unit':{'$first':_0x538fbf(0x1ad)},'alertquantity':{'$first':_0x538fbf(0xde)},'product_code':{'$first':_0x538fbf(0x11c)},'primary_code':{'$first':_0x538fbf(0x182)},'secondary_code':{'$first':_0x538fbf(0xd3)},'maxStocks':{'$first':_0x538fbf(0x1ce)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x538fbf(0xff)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x328108[_0x538fbf(0x1a9)]>0x0)_0x1d319c=_0x328108;else _0x288bb2['length']>0x0&&(_0x1d319c=_0x288bb2);_0x4c6595[_0x538fbf(0xfa)](_0x1d319c);}),router[a0_0x265f88(0x1f7)](a0_0x265f88(0x187),async(_0x34acfa,_0x2e7913)=>{var _0x311f24=a0_0x265f88;const {primaryCode:_0x108b83,secondaryCode:_0x6abb33,productCode:_0x104db2,bay:_0x3c6480,bin:_0x1a6688,types:_0x1e26c2,pallet:_0x3b3943,warehouses:_0xa7c590,room:_0x32f7f8}=_0x34acfa['body'];console[_0x311f24(0x1f8)](_0x34acfa['body']);try{const _0x3e24de=await warehouse[_0x311f24(0x19c)]([{'$match':{'name':_0xa7c590,'room':_0x32f7f8}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x3c6480,'product_details.bin':_0x1a6688,'product_details.type':_0x1e26c2}},{'$group':{'_id':_0x311f24(0x172),'name':{'$first':_0x311f24(0x1f5)},'product_stock':{'$first':_0x311f24(0x126)},'level':{'$first':_0x311f24(0x127)},'isle':{'$first':_0x311f24(0x143)},'pallet':{'$first':_0x311f24(0x14d)},'maxProducts':{'$first':_0x311f24(0x19a)}}}]);_0x2e7913[_0x311f24(0xd9)](0xc8)[_0x311f24(0xfa)](_0x3e24de);}catch(_0x341a71){_0x2e7913[_0x311f24(0xd9)](0x194)[_0x311f24(0xfa)]({'message':_0x341a71[_0x311f24(0x1ec)]});}}),module[a0_0x265f88(0x162)]=router;