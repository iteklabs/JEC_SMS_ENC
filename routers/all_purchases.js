function a0_0x13f6(_0x16e32e,_0x5e3cc2){var _0x4a63db=a0_0x4a63();return a0_0x13f6=function(_0x13f6fc,_0x180b86){_0x13f6fc=_0x13f6fc-0x10e;var _0x4b4c85=_0x4a63db[_0x13f6fc];return _0x4b4c85;},a0_0x13f6(_0x16e32e,_0x5e3cc2);}var a0_0x3a69b5=a0_0x13f6;function a0_0x4a63(){var _0x2f6a34=['maxStocks','Email\x20sent\x20successfully','../models/all_models','RoomAssign','Level','room_name','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','push','pallet','edit_purchases','filter','</td>','Portuguese\x20(BR)','random','forEach','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','625236nNtMhs','body','Raw\x20Materials','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','exports','$suppliers_docs','</h5>','all','language','errors','$product.room_name','product_stock','$paid_amount','/CheckingWarehouse','all_purchases','$note','Enclosed','email','name','$name','product','/barcode_scanner','staff','master','rak','$product_details.secondary_code','../middleware/auth','find','bin','error','product_cat','primary_code','Rack\x20A','paid_amount','currency_placement','</body></html>','<h2>\x20','$product.bin','room','foreach\x20newproduct','site_title','currency','Logo.png','$product_details.isle','suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$invoice','message','$product_details.bin','Arabic','2101365GJsZdM','English\x20(US)','$product.bay','Error\x20Occurs','log','$return_data','nodemailer','secondary_unit','36450zTzSCt','/view/:id','catch','purchase_invoice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/give_payment/:id','Receiving\x20Area','warehouse','types','$product_details.product_stock','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers_docs','INC-','add_purchases','finalize','prod_cat','floorlevel','$category','../public/language/languages.json','purchase\x20data\x20update\x20successfully','maxperunit','\x20<>\x20','$product_details.floorlevel','COLD\x20STORAGE','</tr>','suppliers_data','actual_qty','password','</div>','production_date','image','createTransport','/barcode/:id','here','prod_secondunit','Rack\x20F','product_list','role','Return\x20Goods','warehouse_name','English','<!DOCTYPE\x20html>','length','status','bay','Purchase\x20Return\x20Mail','$brand','Rack\x20E','abs','$date','$product_details.type','\x20Order\x20Number\x20:\x20','expiry_date','$product','storage','product_details','Shelves','delivery_code','Ambient','prod_isle','138295dCNJhd','padStart','Hindi','prod_qty','German','\x20</h2>','Purchase\x20Mail','$product_details','purchase_quantity','<hr\x20class=\x22my-3\x22>','max_product_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Chinese','return_qty','Router','JO_number','toString','actual_uom','$batch_code','edit_purchases_view','get','$maxStocks','Rack\x20D','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$suppliers','prod_pallet','1054015UJxIkd','$expiry_date','POnumber','$product_details.maxProducts','redirect','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','amount','findById','</head><body>','gmail','product_code_hide','<strong>\x20Regards\x20</strong>','DRY\x20STORAGE','findOne','deliverycode','</thead>','prod_code','298824BkYNWA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','stock_quantity','rack','prod_name','$product.quantity','$product_details.rack','payment\x20successfull','isle','<span\x20style=\x22float:\x20right;\x22>','Portuguese','map','secondary_code','quantity','Spanish','<h5\x20style=\x22text-align:\x20left;\x22>','render','return_purchase','Floor','$alertquantity','aggregate','516456kiqQVV','/view/add_purchases/:id','invoice','True','prod_level','/all_purchases/view','Enabled','level','/view','slice','sendMail','logo','Arabic\x20(ae)','$product_details.product_code','ejs','note','prod_Qty','<h5>','$product_details.product_name','$room','add\x20post','then','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product.type','</tbody>','<div>','$finalize','/upload/','batch_code','<tbody\x20style=\x22text-align:\x20center;\x22>','user','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','concat','prod_invoice','/view/return_purchase/:id','$product_details.primary_code','</table>','/invoice/:id','alertQTY','$product_details.storage','$secondary_code','prod_unit','back','post','$warehouse_name','$maxProdPerUnit','<tr>','params','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','prod_primunit','Room_name','purchases\x20item\x20return\x20successfull','save','French','secondary_code_hide','/preview/:id','</span>','success','standard_unit','product_code','primary_code_hide','add_purchases\x20error','flash','$product_details.pallet','json','<html><head><title></title>','/view/add_purchases','$product.floorlevel','$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','type','$unit','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','string','/../public','Purchase\x20data\x20added\x20successfully','delivery_date','$product_details._id','MaxStocks_data','\x20<\x20wew\x20>\x20','$secondary_unit','due_amount','product_name'];a0_0x4a63=function(){return _0x2f6a34;};return a0_0x4a63();}(function(_0x9facda,_0x3cd636){var _0x4aaecb=a0_0x13f6,_0x500908=_0x9facda();while(!![]){try{var _0xb77017=-parseInt(_0x4aaecb(0x22d))/0x1+parseInt(_0x4aaecb(0x1f1))/0x2+-parseInt(_0x4aaecb(0x14d))/0x3+-parseInt(_0x4aaecb(0x1b6))/0x4+parseInt(_0x4aaecb(0x127))/0x5+parseInt(_0x4aaecb(0x138))/0x6+parseInt(_0x4aaecb(0x1e9))/0x7;if(_0xb77017===_0x3cd636)break;else _0x500908['push'](_0x500908['shift']());}catch(_0x40ad9b){_0x500908['push'](_0x500908['shift']());}}}(a0_0x4a63,0x1b68f));const express=require('express'),app=express(),router=express[a0_0x3a69b5(0x11b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x3a69b5(0x1a7)),auth=require(a0_0x3a69b5(0x1d1)),nodemailer=require(a0_0x3a69b5(0x1ef));var ejs=require(a0_0x3a69b5(0x15b));const path=require('path'),users=require(a0_0x3a69b5(0x203));router[a0_0x3a69b5(0x121)](a0_0x3a69b5(0x155),auth,async(_0x7259d1,_0x7e57c8)=>{var _0x58700f=a0_0x3a69b5;try{const {username:_0x424656,email:_0x99896a,role:_0x58a6c7}=_0x7259d1[_0x58700f(0x16b)],_0x17ac11=_0x7259d1[_0x58700f(0x16b)],_0xe5d383=await profile[_0x58700f(0x134)]({'email':_0x17ac11[_0x58700f(0x1c8)]}),_0xf8953=await staff['findOne']({'email':_0x17ac11[_0x58700f(0x1c8)]});if(_0x17ac11[_0x58700f(0x216)]==_0x58700f(0x1cd)){const _0x585905=await staff[_0x58700f(0x134)]({'email':_0x17ac11[_0x58700f(0x1c8)]});}const _0x2f5fe3=await master_shop[_0x58700f(0x1d2)]();let _0x13b3ae;if(_0x17ac11[_0x58700f(0x216)]==_0x58700f(0x1cd)){const _0x393720=await staff[_0x58700f(0x134)]({'email':_0x17ac11[_0x58700f(0x1c8)]});_0x13b3ae=await purchases[_0x58700f(0x14c)]([{'$match':{'warehouse_name':_0x393720[_0x58700f(0x1f8)]}},{'$lookup':{'from':_0x58700f(0x1e3),'localField':_0x58700f(0x1e3),'foreignField':_0x58700f(0x1c9),'as':_0x58700f(0x1fc)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x58700f(0x1ab),'invoice':{'$first':_0x58700f(0x1e5)},'suppliers':{'$first':_0x58700f(0x125)},'date':{'$first':_0x58700f(0x222)},'warehouse_name':{'$first':_0x58700f(0x17a)},'room':{'$first':_0x58700f(0x160)},'product':{'$push':_0x58700f(0x226)},'note':{'$first':_0x58700f(0x1c6)},'paid_amount':{'$first':_0x58700f(0x1c3)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x58700f(0x1ee)},'batch_code':{'$first':_0x58700f(0x11f)},'expiry_date':{'$first':_0x58700f(0x128)},'suppliers_docs':{'$first':_0x58700f(0x1bc)},'total_product_quantity':{'$sum':_0x58700f(0x13d)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x58700f(0x1dc)},'type':{'$addToSet':_0x58700f(0x164)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x13b3ae=await purchases[_0x58700f(0x14c)]([{'$lookup':{'from':_0x58700f(0x1e3),'localField':'suppliers','foreignField':_0x58700f(0x1c9),'as':_0x58700f(0x1fc)}},{'$unwind':_0x58700f(0x1bc)},{'$unwind':_0x58700f(0x226)},{'$group':{'_id':_0x58700f(0x1ab),'invoice':{'$first':_0x58700f(0x1e5)},'suppliers':{'$first':_0x58700f(0x125)},'date':{'$first':_0x58700f(0x222)},'warehouse_name':{'$first':_0x58700f(0x17a)},'room':{'$addToSet':_0x58700f(0x1c1)},'product':{'$push':_0x58700f(0x226)},'note':{'$first':_0x58700f(0x1c6)},'paid_amount':{'$first':_0x58700f(0x1c3)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x58700f(0x1ee)},'batch_code':{'$first':_0x58700f(0x11f)},'expiry_date':{'$first':_0x58700f(0x128)},'suppliers_docs':{'$first':_0x58700f(0x1bc)},'total_product_quantity':{'$sum':_0x58700f(0x13d)},'level':{'$addToSet':_0x58700f(0x1eb)},'isle':{'$addToSet':_0x58700f(0x1dc)},'type':{'$addToSet':_0x58700f(0x164)},'floorlevel':{'$addToSet':_0x58700f(0x192)},'finalize':{'$first':_0x58700f(0x167)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2f5fe3[0x0]['language']==_0x58700f(0x1ea)){var _0x68b9c0=users[_0x58700f(0x219)];console[_0x58700f(0x1ed)](_0x68b9c0);}else{if(_0x2f5fe3[0x0][_0x58700f(0x1bf)]==_0x58700f(0x10f))var _0x68b9c0=users[_0x58700f(0x10f)];else{if(_0x2f5fe3[0x0][_0x58700f(0x1bf)]==_0x58700f(0x111))var _0x68b9c0=users['German'];else{if(_0x2f5fe3[0x0][_0x58700f(0x1bf)]==_0x58700f(0x146))var _0x68b9c0=users[_0x58700f(0x146)];else{if(_0x2f5fe3[0x0][_0x58700f(0x1bf)]==_0x58700f(0x184))var _0x68b9c0=users[_0x58700f(0x184)];else{if(_0x2f5fe3[0x0][_0x58700f(0x1bf)]==_0x58700f(0x1b2))var _0x68b9c0=users[_0x58700f(0x142)];else{if(_0x2f5fe3[0x0]['language']==_0x58700f(0x119))var _0x68b9c0=users[_0x58700f(0x119)];else{if(_0x2f5fe3[0x0][_0x58700f(0x1bf)]==_0x58700f(0x159))var _0x68b9c0=users[_0x58700f(0x1e8)];}}}}}}}_0x7e57c8[_0x58700f(0x148)](_0x58700f(0x1c5),{'success':_0x7259d1['flash'](_0x58700f(0x188)),'errors':_0x7259d1[_0x58700f(0x18d)](_0x58700f(0x1c0)),'purchases':_0x13b3ae,'role':_0x17ac11,'profile':_0xe5d383,'master_shop':_0x2f5fe3,'language':_0x68b9c0});}catch(_0x3c5d6c){console[_0x58700f(0x1ed)]('table\x20page',_0x3c5d6c),_0x7e57c8[_0x58700f(0x21c)](0xc8)[_0x58700f(0x18f)]({'message':_0x3c5d6c[_0x58700f(0x1e6)]});}});function BayBinSelected(_0x1e128a,_0x1b03e0){var _0x3a4ad5=a0_0x3a69b5,_0x4ea7d3=[],_0x44ba35=[],_0x434185=[],_0x2dd0a2=[],_0x51b80e=[],_0x33ad02=[];let _0x3a9439=[];if(_0x1e128a==_0x3a4ad5(0x133))switch(_0x1b03e0){case'Rack\x20A':_0x4ea7d3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x44ba35=[0x1,0x2],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=[_0x3a4ad5(0x1a9),_0x3a4ad5(0x14a)],_0x51b80e=['D'],_0x33ad02=['A'];break;case'Rack\x20B':_0x4ea7d3=[0x6,0x5,0x4,0x3,0x2,0x1],_0x44ba35=[0x1,0x2],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=[_0x3a4ad5(0x1a9),_0x3a4ad5(0x14a)],_0x51b80e=['D'],_0x33ad02=['B'];break;case _0x3a4ad5(0x229):_0x4ea7d3=[0x0],_0x44ba35=[0x0],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=['Floor'],_0x51b80e=['D'],_0x33ad02=['S'];break;case _0x3a4ad5(0x1f7):_0x4ea7d3=[0x0],_0x44ba35=[0x0],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x434185=['Floor'],_0x51b80e=['D'],_0x33ad02=['R'];break;}else{if(_0x1e128a==_0x3a4ad5(0x208))switch(_0x1b03e0){case _0x3a4ad5(0x1d7):_0x4ea7d3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x44ba35=['B','F'],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=[_0x3a4ad5(0x1a9),'Floor'],_0x51b80e=['C'],_0x33ad02=['A'];break;case'Rack\x20B':_0x4ea7d3=[0x5,0x4,0x3,0x2,0x1],_0x44ba35=['F','B','S'],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=[_0x3a4ad5(0x1a9),'Floor'],_0x51b80e=['C'],_0x33ad02=['B'];break;case'Rack\x20C':_0x4ea7d3=[0x1,0x2,0x3,0x4,0x5],_0x44ba35=['B','F','S'],_0x2dd0a2=[0x5,0x4,0x3,0x2,0x1],_0x434185=['Level','Floor'],_0x51b80e=['C'],_0x33ad02=['C'];break;case _0x3a4ad5(0x123):_0x4ea7d3=[0x5,0x4,0x3,0x2,0x1],_0x44ba35=['F','B','S'],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=[_0x3a4ad5(0x1a9),_0x3a4ad5(0x14a)],_0x51b80e=['C'],_0x33ad02=['D'];break;case _0x3a4ad5(0x220):_0x4ea7d3=[0x4,0x3,0x2,0x1],_0x44ba35=[0x1,0x2],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=[_0x3a4ad5(0x1a9),_0x3a4ad5(0x14a)],_0x51b80e=['C'],_0x33ad02=['E'];break;case _0x3a4ad5(0x214):_0x4ea7d3=[0x1,0x2,0x3],_0x44ba35=[0x1,0x2],_0x2dd0a2=[0x1,0x2,0x3,0x4,0x5],_0x434185=['Level'],_0x51b80e=['C'],_0x33ad02=['F'];break;}}return{'levels':_0x4ea7d3,'Isle':_0x44ba35,'rack':_0x2dd0a2,'type':_0x434185,'storage':_0x51b80e,'rak':_0x33ad02};}async function getRandom8DigitNumber(){var _0xd1d6d4=a0_0x3a69b5;const _0x25253f=0x989680,_0x4b51fc=0x5f5e0ff,_0x467a26=Math['floor'](Math[_0xd1d6d4(0x1b3)]()*(_0x4b51fc-_0x25253f+0x1))+_0x25253f;var _0x5b8cfa;const _0x2ac271=await purchases[_0xd1d6d4(0x134)]({'invoice':_0xd1d6d4(0x1fd)+_0x467a26});return _0x2ac271&&_0x2ac271[_0xd1d6d4(0x21b)]>0x0?_0x5b8cfa=_0xd1d6d4(0x1fd)+_0x467a26:_0x5b8cfa=_0xd1d6d4(0x1fd)+_0x467a26,_0x5b8cfa;}router[a0_0x3a69b5(0x121)](a0_0x3a69b5(0x191),auth,async(_0x2a1043,_0x37f5b5)=>{var _0x98b200=a0_0x3a69b5;try{const {username:_0x52611b,email:_0x42e9d2,role:_0x2587b8}=_0x2a1043[_0x98b200(0x16b)],_0x57622d=_0x2a1043[_0x98b200(0x16b)],_0xaa36d2=await profile[_0x98b200(0x134)]({'email':_0x57622d[_0x98b200(0x1c8)]}),_0x34854e=await master_shop[_0x98b200(0x1d2)](),_0x325a7e=await staff[_0x98b200(0x134)]({'email':_0x57622d[_0x98b200(0x1c8)]}),_0x1e43b3=await suppliers[_0x98b200(0x1d2)]({});let _0x56e19c;if(_0x57622d[_0x98b200(0x216)]==_0x98b200(0x1cd)){const _0x3a55c5=await staff[_0x98b200(0x134)]({'email':_0x57622d['email']});_0x56e19c=await warehouse[_0x98b200(0x14c)]([{'$match':{'status':_0x98b200(0x153),'name':_0x3a55c5[_0x98b200(0x1f8)],'warehouse_category':_0x98b200(0x1b8),'name':{'$ne':_0x98b200(0x217)}}},{'$group':{'_id':_0x98b200(0x1ca),'name':{'$first':_0x98b200(0x1ca)}}}]);}else _0x56e19c=await warehouse[_0x98b200(0x14c)]([{'$match':{'status':_0x98b200(0x153),'warehouse_category':_0x98b200(0x1b8),'name':{'$ne':_0x98b200(0x217)}}},{'$group':{'_id':'$name','name':{'$first':_0x98b200(0x1ca)}}}]);const _0x2cff95=await product[_0x98b200(0x1d2)]({}),_0x27513a=await warehouse[_0x98b200(0x1d2)]({'status':'Enabled'}),_0x3d6101=await purchases[_0x98b200(0x1d2)]({}),_0x50e254=_0x3d6101[_0x98b200(0x21b)]+0x1,_0x2e68e1='INC-'+_0x50e254[_0x98b200(0x11d)]()[_0x98b200(0x10e)](0x5,'0');var _0x403788=[_0x98b200(0x22b),_0x98b200(0x1c7)];if(_0x34854e[0x0][_0x98b200(0x1bf)]=='English\x20(US)')var _0xed4d7d=users['English'];else{if(_0x34854e[0x0][_0x98b200(0x1bf)]==_0x98b200(0x10f))var _0xed4d7d=users[_0x98b200(0x10f)];else{if(_0x34854e[0x0]['language']=='German')var _0xed4d7d=users[_0x98b200(0x111)];else{if(_0x34854e[0x0][_0x98b200(0x1bf)]==_0x98b200(0x146))var _0xed4d7d=users['Spanish'];else{if(_0x34854e[0x0][_0x98b200(0x1bf)]==_0x98b200(0x184))var _0xed4d7d=users[_0x98b200(0x184)];else{if(_0x34854e[0x0][_0x98b200(0x1bf)]==_0x98b200(0x1b2))var _0xed4d7d=users[_0x98b200(0x142)];else{if(_0x34854e[0x0][_0x98b200(0x1bf)]=='Chinese')var _0xed4d7d=users[_0x98b200(0x119)];else{if(_0x34854e[0x0]['language']==_0x98b200(0x159))var _0xed4d7d=users['Arabic'];}}}}}}}const _0x6d9eee=getRandom8DigitNumber();_0x6d9eee[_0x98b200(0x162)](_0x5c0d2f=>{var _0x2fe0cf=_0x98b200;_0x37f5b5[_0x2fe0cf(0x148)](_0x2fe0cf(0x1fe),{'success':_0x2a1043['flash'](_0x2fe0cf(0x188)),'errors':_0x2a1043[_0x2fe0cf(0x18d)]('errors'),'role':_0x57622d,'profile':_0xaa36d2,'suppliers':_0x1e43b3,'warehouse':_0x56e19c,'product':_0x2cff95,'invoice':_0x5c0d2f,'master_shop':_0x34854e,'language':_0xed4d7d,'find_data':_0x27513a,'rooms_data':_0x403788});})[_0x98b200(0x1f3)](_0x4db43a=>{var _0x257611=_0x98b200;_0x2a1043[_0x257611(0x18d)]('errors',_0x257611(0x1f5)),_0x37f5b5['redirect'](_0x257611(0x152));});}catch(_0xd15f2f){console[_0x98b200(0x1ed)](_0xd15f2f);}}),router['get'](a0_0x3a69b5(0x14e),auth,async(_0x5a0a7c,_0x490238)=>{var _0x290539=a0_0x3a69b5;try{const _0x5f22a6=_0x5a0a7c['params']['id'];console[_0x290539(0x1ed)](_0x5f22a6);const _0xc6764d=await master_shop['find']();console[_0x290539(0x1ed)](_0x290539(0x1ce),_0xc6764d);const _0x2388ad=await product['findOne']({'name':_0x5f22a6});console[_0x290539(0x1ed)](_0x290539(0x1cb),_0x2388ad),_0x490238[_0x290539(0x21c)](0xc8)[_0x290539(0x18f)]({'product_data':_0x2388ad,'master':_0xc6764d});}catch(_0x19e841){console[_0x290539(0x1ed)](_0x290539(0x18c),_0x19e841);}}),router['post'](a0_0x3a69b5(0x191),auth,async(_0x23f1c5,_0x5e9436)=>{var _0x397aef=a0_0x3a69b5;try{const {invoice:_0x56b2f1,date:_0x37da07,warehouse_name:_0x85e186,prod_name:_0x4d4746,prod_code:_0x5bf895,prod_qty:_0x3fa124,prod_unit:_0x309b5e,prod_secondunit:_0x10afe6,prod_level:_0x141fc0,prod_isle:_0x136de2,prod_pallet:_0x1f2cea,note:_0x9a37cb,expiry_date:_0x283edf,batch_code:_0x4ce535,payable:_0x4d6306,due_amount:_0x3cf619,Room_name:_0x2829b4,primary_code:_0x8396c1,secondary_code:_0x2e357c,MaxStocks_data:_0x519bda,PO_number:_0x22d57b,SCRN:_0x1c92ce,JO_number:_0x3f371d}=_0x23f1c5[_0x397aef(0x1b7)];if(typeof _0x4d4746==_0x397aef(0x19b))var _0x98741f=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x13c)]],_0x260a3a=[_0x23f1c5[_0x397aef(0x1b7)]['prod_code']],_0x217a82=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x15d)]],_0x383657=[_0x23f1c5[_0x397aef(0x1b7)]['prod_primunit']],_0x27d44a=[_0x23f1c5['body'][_0x397aef(0x213)]],_0x257ecf=[_0x23f1c5[_0x397aef(0x1b7)]['prod_level']],_0x4bf61f=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x1d6)]],_0x5138d3=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x144)]],_0x590acc=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x1a0)]],_0x19e36c=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x169)]],_0x11308d=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x225)]],_0x5a3f76=[_0x23f1c5['body'][_0x397aef(0x117)]],_0x33ab03=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x174)]],_0x1c4e08=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x20e)]],_0x992530=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x200)]],_0x2c1ffd=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x1a8)]],_0x3c7fa8=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x135)]],_0x2ddc38=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x16f)]],_0x3dd52a=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x20b)]],_0x2ea34d=[_0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x11e)]];else var _0x98741f=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x13c)]],_0x260a3a=[..._0x23f1c5['body'][_0x397aef(0x137)]],_0x217a82=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x15d)]],_0x383657=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x180)]],_0x27d44a=[..._0x23f1c5['body'][_0x397aef(0x213)]],_0x257ecf=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x151)]],_0x4bf61f=[..._0x23f1c5['body'][_0x397aef(0x1d6)]],_0x5138d3=[..._0x23f1c5[_0x397aef(0x1b7)]['secondary_code']],_0x590acc=[..._0x23f1c5[_0x397aef(0x1b7)]['MaxStocks_data']],_0x19e36c=[..._0x23f1c5[_0x397aef(0x1b7)]['batch_code']],_0x11308d=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x225)]],_0x5a3f76=[..._0x23f1c5['body'][_0x397aef(0x117)]],_0x33ab03=[..._0x23f1c5['body'][_0x397aef(0x174)]],_0x1c4e08=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x20e)]],_0x992530=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x200)]],_0x2c1ffd=[..._0x23f1c5[_0x397aef(0x1b7)]['RoomAssign']],_0x3c7fa8=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x135)]],_0x2ddc38=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x16f)]],_0x3dd52a=[..._0x23f1c5[_0x397aef(0x1b7)]['actual_qty']],_0x2ea34d=[..._0x23f1c5[_0x397aef(0x1b7)][_0x397aef(0x11e)]];const _0x89d926=_0x98741f[_0x397aef(0x143)](_0x10b1cc=>{return _0x10b1cc={'product_name':_0x10b1cc};});_0x3dd52a[_0x397aef(0x1b4)]((_0x3bce99,_0x4a448a)=>{var _0x186c7a=_0x397aef;_0x89d926[_0x4a448a]['actual_qty']=Math[_0x186c7a(0x221)](_0x3bce99);}),_0x2ea34d[_0x397aef(0x1b4)]((_0x5a68b9,_0x1f68d5)=>{_0x89d926[_0x1f68d5]['actual_uom']=_0x5a68b9;}),_0x260a3a[_0x397aef(0x1b4)]((_0x30b42e,_0x404d8d)=>{_0x89d926[_0x404d8d]['product_code']=_0x30b42e;}),_0x217a82[_0x397aef(0x1b4)]((_0x52237b,_0x48796a)=>{var _0x2c0115=_0x397aef;_0x89d926[_0x48796a][_0x2c0115(0x145)]=Math[_0x2c0115(0x221)](_0x52237b);}),_0x383657[_0x397aef(0x1b4)]((_0x3a34ac,_0xaa32e7)=>{_0x89d926[_0xaa32e7]['standard_unit']=_0x3a34ac;}),_0x27d44a['forEach']((_0x1c0eb9,_0xd19868)=>{_0x89d926[_0xd19868]['secondary_unit']=_0x1c0eb9;}),_0x257ecf[_0x397aef(0x1b4)]((_0x3f7ccb,_0x1b0647)=>{var _0x353618=_0x397aef;_0x2c1ffd[_0x353618(0x1b4)]((_0x20f8fb,_0x2df896)=>{var _0x4efa38=_0x353618;if(_0x20f8fb==_0x4efa38(0x1f7)&&_0x1b0647==_0x2df896){console[_0x4efa38(0x1ed)](_0x20f8fb+_0x4efa38(0x1a1)+_0x1b0647+_0x4efa38(0x206)+_0x2df896+_0x4efa38(0x206)+_0x3f7ccb);var _0x47b66d=_0x3f7ccb[_0x4efa38(0x156)](0x3);_0x89d926[_0x1b0647][_0x4efa38(0x227)]=_0x3f7ccb[0x0],_0x89d926[_0x1b0647][_0x4efa38(0x13b)]=_0x3f7ccb[0x1],_0x89d926[_0x1b0647]['bay']=0x0,_0x89d926[_0x1b0647]['bin']=0x0,_0x89d926[_0x1b0647]['type']=_0x4efa38(0x14a),_0x89d926[_0x1b0647][_0x4efa38(0x201)]=_0x47b66d;}else{if(_0x20f8fb==_0x4efa38(0x229)&&_0x1b0647==_0x2df896){var _0x47b66d=_0x3f7ccb[_0x4efa38(0x156)](0x3);_0x89d926[_0x1b0647]['storage']=_0x3f7ccb[0x0],_0x89d926[_0x1b0647][_0x4efa38(0x13b)]=_0x3f7ccb[0x1],_0x89d926[_0x1b0647][_0x4efa38(0x21d)]=0x0,_0x89d926[_0x1b0647][_0x4efa38(0x1d3)]=0x0,_0x89d926[_0x1b0647][_0x4efa38(0x197)]='Floor',_0x89d926[_0x1b0647][_0x4efa38(0x201)]=_0x3f7ccb[0x5];}else{if(_0x1b0647==_0x2df896){if(_0x3f7ccb[0x0]=='A'&&_0x3f7ccb[0x1]=='L'&&_0x3f7ccb[0x2]=='L')console[_0x4efa38(0x1ed)](_0x20f8fb+_0x4efa38(0x206)+_0x1b0647+_0x4efa38(0x206)+_0x2df896+_0x4efa38(0x206)+_0x3f7ccb+_0x4efa38(0x212)),_0x89d926[_0x1b0647][_0x4efa38(0x227)]=_0x3f7ccb[0x0],_0x89d926[_0x1b0647]['rack']=_0x3f7ccb[0x1],_0x89d926[_0x1b0647][_0x4efa38(0x21d)]=0x0,_0x89d926[_0x1b0647]['bin']=0x0,_0x89d926[_0x1b0647][_0x4efa38(0x197)]=_0x4efa38(0x14a),_0x89d926[_0x1b0647][_0x4efa38(0x201)]=_0x3f7ccb[0x3];else{var _0x372c6d;if(_0x3f7ccb[0x4]=='L')_0x372c6d=_0x4efa38(0x1a9);else _0x3f7ccb[0x4]=='F'&&(_0x372c6d='Floor');_0x89d926[_0x1b0647]['storage']=_0x3f7ccb[0x0],_0x89d926[_0x1b0647][_0x4efa38(0x13b)]=_0x3f7ccb[0x1],_0x89d926[_0x1b0647][_0x4efa38(0x21d)]=_0x3f7ccb[0x2],_0x89d926[_0x1b0647]['bin']=_0x3f7ccb[0x3],_0x89d926[_0x1b0647][_0x4efa38(0x197)]=_0x372c6d,_0x89d926[_0x1b0647][_0x4efa38(0x201)]=_0x3f7ccb[0x5];}}}}});}),_0x4bf61f[_0x397aef(0x1b4)]((_0x2181c5,_0x2bf3aa)=>{var _0x570c58=_0x397aef;_0x89d926[_0x2bf3aa][_0x570c58(0x1d6)]=_0x2181c5;}),_0x5138d3[_0x397aef(0x1b4)]((_0x4226c4,_0x1b0087)=>{var _0x4d79df=_0x397aef;_0x89d926[_0x1b0087][_0x4d79df(0x144)]=_0x4226c4;}),_0x590acc[_0x397aef(0x1b4)]((_0x121cee,_0x92b0dd)=>{var _0x56cc20=_0x397aef;_0x89d926[_0x92b0dd][_0x56cc20(0x1a5)]=_0x121cee;}),_0x19e36c[_0x397aef(0x1b4)]((_0xc0cf9c,_0x2cdfaf)=>{var _0x3a840d=_0x397aef;_0x89d926[_0x2cdfaf][_0x3a840d(0x169)]=_0xc0cf9c;}),_0x11308d[_0x397aef(0x1b4)]((_0x59fe14,_0x107172)=>{_0x89d926[_0x107172]['expiry_date']=_0x59fe14;}),_0x5a3f76[_0x397aef(0x1b4)]((_0x5408af,_0x2da4ca)=>{var _0x244729=_0x397aef;_0x89d926[_0x2da4ca][_0x244729(0x205)]=_0x5408af;}),_0x33ab03['forEach']((_0x1bb93a,_0x420558)=>{var _0x17ea8a=_0x397aef;_0x89d926[_0x420558][_0x17ea8a(0x174)]=_0x1bb93a;}),_0x1c4e08[_0x397aef(0x1b4)]((_0x1d103a,_0x2651f2)=>{var _0x55993b=_0x397aef;_0x89d926[_0x2651f2][_0x55993b(0x20e)]=_0x1d103a;}),_0x992530['forEach']((_0x18742e,_0x3ea2c9)=>{var _0x5c6037=_0x397aef;_0x89d926[_0x3ea2c9][_0x5c6037(0x1d5)]=_0x18742e;}),_0x2c1ffd[_0x397aef(0x1b4)]((_0x177e6a,_0x4119b9)=>{var _0xcc1c71=_0x397aef;_0x89d926[_0x4119b9][_0xcc1c71(0x1aa)]=_0x177e6a;}),_0x3c7fa8['forEach']((_0x9cee31,_0x4f4935)=>{var _0x51ff9d=_0x397aef;_0x89d926[_0x4f4935][_0x51ff9d(0x22a)]=_0x9cee31;}),_0x2ddc38[_0x397aef(0x1b4)]((_0x12c867,_0x17e002)=>{var _0x61faf7=_0x397aef;_0x89d926[_0x17e002][_0x61faf7(0x14f)]=_0x12c867;});const _0x1bb3de=_0x2c1ffd['map'](_0x4c257d=>{return _0x4c257d={'room_name':_0x4c257d};}),_0x2fb132=_0x89d926[_0x397aef(0x1b0)](_0x5218ac=>_0x5218ac['quantity']!=='0'&&_0x5218ac[_0x397aef(0x145)]!==''),_0x37d366=new purchases({'invoice':_0x56b2f1,'suppliers':_0x23f1c5['body'][_0x397aef(0x1e3)],'date':_0x37da07,'warehouse_name':_0x85e186,'product':_0x2fb132,'note':_0x9a37cb,'due_amount':_0x3cf619,'POnumber':_0x22d57b,'SCRN':_0x1c92ce,'JO_number':_0x3f371d,'roomList':_0x1bb3de}),_0x8063d0=await _0x37d366[_0x397aef(0x183)](),_0x3f6ac5=await purchases[_0x397aef(0x134)]({'invoice':_0x56b2f1}),_0x98b84f=_0x3f6ac5[_0x397aef(0x1cb)][_0x397aef(0x143)](async _0x1470ed=>{var _0x1ece49=_0x397aef,_0x51cab7=await warehouse['findOne']({'name':_0x85e186,'room':_0x1470ed[_0x1ece49(0x1aa)]}),_0x2d6869=0x0;return _0x51cab7[_0x1ece49(0x228)][_0x1ece49(0x1b4)](_0x126dbb=>{var _0x38b342=_0x1ece49;_0x126dbb[_0x38b342(0x1a4)]==_0x1470ed['product_name']&&_0x126dbb[_0x38b342(0x201)]==_0x1470ed[_0x38b342(0x201)]&&_0x126dbb['type']==_0x1470ed[_0x38b342(0x197)]&&_0x126dbb[_0x38b342(0x1d3)]==_0x1470ed[_0x38b342(0x1d3)]&&_0x126dbb['bay']==_0x1470ed['bay']&&_0x126dbb['rack']==_0x1470ed[_0x38b342(0x13b)]&&_0x126dbb[_0x38b342(0x227)]==_0x1470ed[_0x38b342(0x227)]&&_0x126dbb[_0x38b342(0x225)]==_0x1470ed['expiry_date']&&_0x126dbb[_0x38b342(0x169)]==_0x1470ed[_0x38b342(0x169)]&&_0x126dbb['production_date']==_0x1470ed[_0x38b342(0x20e)]&&_0x126dbb[_0x38b342(0x14f)]==_0x3f6ac5[_0x38b342(0x14f)]&&(_0x126dbb[_0x38b342(0x1c2)]+=Math[_0x38b342(0x221)](_0x1470ed[_0x38b342(0x145)]),_0x2d6869++);}),_0x2d6869===0x0&&_0x51cab7['product_details'][_0x1ece49(0x1ad)]({'product_name':_0x1470ed['product_name'],'product_stock':Math[_0x1ece49(0x221)](_0x1470ed[_0x1ece49(0x145)]),'primary_code':_0x1470ed[_0x1ece49(0x1d6)],'secondary_code':_0x1470ed[_0x1ece49(0x144)],'product_code':_0x1470ed[_0x1ece49(0x18a)],'storage':_0x1470ed[_0x1ece49(0x227)],'rack':_0x1470ed['rack'],'bay':_0x1470ed[_0x1ece49(0x21d)],'bin':_0x1470ed[_0x1ece49(0x1d3)],'type':_0x1470ed[_0x1ece49(0x197)],'floorlevel':_0x1470ed[_0x1ece49(0x201)],'maxProducts':_0x1470ed[_0x1ece49(0x1a5)],'unit':_0x1470ed[_0x1ece49(0x189)],'secondary_unit':_0x1470ed[_0x1ece49(0x1f0)],'expiry_date':_0x1470ed['expiry_date'],'maxPerUnit':_0x1470ed['maxperunit'],'batch_code':_0x1470ed[_0x1ece49(0x169)],'alertQTY':_0x1470ed['alertQTY'],'production_date':_0x1470ed[_0x1ece49(0x20e)],'product_cat':_0x1470ed['product_cat'],'invoice':_0x1470ed[_0x1ece49(0x14f)],'actual_qty':Math[_0x1ece49(0x221)](_0x1470ed[_0x1ece49(0x20b)]),'actual_uom':_0x1470ed[_0x1ece49(0x11e)]}),_0x51cab7;});Promise[_0x397aef(0x1be)](_0x98b84f)[_0x397aef(0x162)](async _0x50c239=>{var _0x4958fa=_0x397aef;try{for(const _0x598d35 of _0x50c239){await _0x598d35['save']();}const _0x53a943=await master_shop[_0x4958fa(0x1d2)](),_0x33c18a=await email_settings['findOne'](),_0x3fe8aa=await supervisor_settings[_0x4958fa(0x1d2)]();var _0x233665=_0x3f6ac5[_0x4958fa(0x1cb)],_0xb15a8b='',_0x287c6a;for(_0x287c6a in _0x233665){_0xb15a8b+=_0x4958fa(0x17c)+_0x4958fa(0x1b5)+_0x233665[_0x287c6a][_0x4958fa(0x1a4)]+_0x4958fa(0x1b1)+_0x4958fa(0x1b5)+_0x233665[_0x287c6a][_0x4958fa(0x18a)]+'</td>'+_0x4958fa(0x1b5)+_0x233665[_0x287c6a][_0x4958fa(0x145)]+_0x4958fa(0x1b1)+_0x4958fa(0x1b5)+_0x233665[_0x287c6a]['standard_unit']+_0x4958fa(0x1b1)+_0x4958fa(0x1b5)+_0x233665[_0x287c6a]['secondary_unit']+_0x4958fa(0x1b1)+_0x4958fa(0x1b5)+_0x3f6ac5[_0x4958fa(0x218)]+_0x4958fa(0x1b1)+_0x4958fa(0x1b5)+_0x233665[_0x287c6a]['room_name']+'</td>'+_0x4958fa(0x1b5)+_0x233665[_0x287c6a]['storage']+_0x233665[_0x287c6a][_0x4958fa(0x13b)]+_0x233665[_0x287c6a]['bay']+_0x233665[_0x287c6a][_0x4958fa(0x1d3)]+_0x233665[_0x287c6a][_0x4958fa(0x197)][0x0]+_0x233665[_0x287c6a]['floorlevel']+_0x4958fa(0x1b1),_0x4958fa(0x209);}let _0x52e034=nodemailer['createTransport']({'host':_0x33c18a['host'],'port':Number(_0x33c18a['port']),'secure':![],'auth':{'user':_0x33c18a['email'],'pass':_0x33c18a[_0x4958fa(0x20c)]}}),_0x248c11={'from':_0x33c18a[_0x4958fa(0x1c8)],'to':_0x3fe8aa[0x0]['RMSEmail'],'subject':_0x4958fa(0x113),'attachments':[{'filename':_0x4958fa(0x1e1),'path':__dirname+_0x4958fa(0x19c)+'/upload/'+_0x53a943[0x0]['image'],'cid':_0x4958fa(0x158)}],'html':_0x4958fa(0x21a)+_0x4958fa(0x190)+_0x4958fa(0x12f)+_0x4958fa(0x166)+_0x4958fa(0x196)+_0x4958fa(0x166)+_0x4958fa(0x12c)+_0x4958fa(0x20d)+_0x4958fa(0x166)+_0x4958fa(0x1db)+_0x53a943[0x0][_0x4958fa(0x1df)]+'\x20</h2>'+'</div>'+_0x4958fa(0x20d)+_0x4958fa(0x116)+_0x4958fa(0x166)+_0x4958fa(0x147)+_0x4958fa(0x224)+_0x3f6ac5['invoice']+'\x20'+_0x4958fa(0x141)+_0x4958fa(0x16c)+_0x3f6ac5[_0x4958fa(0x17e)]+'\x20'+_0x4958fa(0x187)+_0x4958fa(0x1bd)+_0x4958fa(0x20d)+_0x4958fa(0x124)+_0x4958fa(0x1fb)+_0x4958fa(0x17c)+_0x4958fa(0x118)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4958fa(0x1e4)+_0x4958fa(0x194)+_0x4958fa(0x139)+_0x4958fa(0x19a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4958fa(0x1ba)+_0x4958fa(0x209)+_0x4958fa(0x136)+_0x4958fa(0x16a)+'\x20'+_0xb15a8b+'\x20'+'</tbody>'+_0x4958fa(0x172)+_0x4958fa(0x166)+_0x4958fa(0x132)+_0x4958fa(0x15e)+_0x53a943[0x0][_0x4958fa(0x1df)]+_0x4958fa(0x1bd)+_0x4958fa(0x20d)+_0x4958fa(0x20d)+_0x4958fa(0x1da)};_0x52e034[_0x4958fa(0x157)](_0x248c11,function(_0x1ceedf,_0x54be08){var _0x18639d=_0x4958fa;_0x1ceedf?(console[_0x18639d(0x1ed)](_0x1ceedf),console['log'](_0x18639d(0x1ec))):console['log'](_0x18639d(0x1a6));}),_0x23f1c5['flash'](_0x4958fa(0x188),_0x4958fa(0x19d)),_0x5e9436['redirect']('/all_purchases/view/');}catch(_0x1af7b6){console[_0x4958fa(0x1d4)](_0x1af7b6),_0x5e9436[_0x4958fa(0x21c)](0x1f4)[_0x4958fa(0x18f)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0xa30811=>{var _0x3829dc=_0x397aef;console['error'](_0xa30811),_0x5e9436[_0x3829dc(0x21c)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x138fef){console[_0x397aef(0x1ed)](_0x138fef);}}),router[a0_0x3a69b5(0x121)]('/preview/:id',auth,async(_0x381382,_0x55474d)=>{var _0x2759da=a0_0x3a69b5;try{const {username:_0x9dc21b,email:_0x2c20b8,role:_0xe5b256}=_0x381382[_0x2759da(0x16b)],_0x4e2f8f=_0x381382[_0x2759da(0x16b)],_0x274abe=await profile[_0x2759da(0x134)]({'email':_0x4e2f8f[_0x2759da(0x1c8)]}),_0x354808=await master_shop[_0x2759da(0x1d2)](),_0x55ceb5=_0x381382['params']['id'],_0x2541ff=await purchases[_0x2759da(0x12e)](_0x55ceb5),_0x3e9760=await warehouse['aggregate']([{'$match':{'name':_0x2541ff[_0x2759da(0x218)],'room':_0x2541ff['room']}},{'$unwind':_0x2759da(0x114)},{'$group':{'_id':_0x2759da(0x19f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2759da(0x1fa)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2759da(0x1e7)},'type':{'$first':_0x2759da(0x223)},'floorlevel':{'$first':_0x2759da(0x207)},'primary_code':{'$first':_0x2759da(0x171)},'secondary_code':{'$first':_0x2759da(0x1d0)},'product_code':{'$first':_0x2759da(0x15a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2759da(0x13e)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x511b51=await customer['find']({});let _0x43305a;if(_0x4e2f8f[_0x2759da(0x216)]=='staff'){const _0x3bb32a=await staff['findOne']({'email':_0x4e2f8f['email']});_0x43305a=await warehouse['aggregate']([{'$match':{'status':_0x2759da(0x153),'name':_0x3bb32a[_0x2759da(0x1f8)]}},{'$group':{'_id':_0x2759da(0x1ca),'name':{'$first':_0x2759da(0x1ca)}}}]);}else _0x43305a=await warehouse['aggregate']([{'$match':{'status':_0x2759da(0x153)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x4588f6=await product[_0x2759da(0x1d2)]({}),_0xf9a8b4=await suppliers[_0x2759da(0x1d2)]({}),_0x47180d=BayBinSelected(_0x2541ff[_0x2759da(0x218)],_0x2541ff[_0x2759da(0x1dd)]);if(_0x354808[0x0][_0x2759da(0x1bf)]==_0x2759da(0x1ea)){var _0x290e78=users['English'];console[_0x2759da(0x1ed)](_0x290e78);}else{if(_0x354808[0x0]['language']==_0x2759da(0x10f))var _0x290e78=users[_0x2759da(0x10f)];else{if(_0x354808[0x0][_0x2759da(0x1bf)]==_0x2759da(0x111))var _0x290e78=users['German'];else{if(_0x354808[0x0]['language']=='Spanish')var _0x290e78=users[_0x2759da(0x146)];else{if(_0x354808[0x0][_0x2759da(0x1bf)]==_0x2759da(0x184))var _0x290e78=users[_0x2759da(0x184)];else{if(_0x354808[0x0][_0x2759da(0x1bf)]=='Portuguese\x20(BR)')var _0x290e78=users[_0x2759da(0x142)];else{if(_0x354808[0x0][_0x2759da(0x1bf)]=='Chinese')var _0x290e78=users[_0x2759da(0x119)];else{if(_0x354808[0x0][_0x2759da(0x1bf)]=='Arabic\x20(ae)')var _0x290e78=users[_0x2759da(0x1e8)];}}}}}}}_0x55474d[_0x2759da(0x148)](_0x2759da(0x120),{'success':_0x381382[_0x2759da(0x18d)](_0x2759da(0x188)),'errors':_0x381382[_0x2759da(0x18d)](_0x2759da(0x1c0)),'role':_0x4e2f8f,'profile':_0x274abe,'customer':_0x511b51,'warehouse':_0x43305a,'product':_0x3e9760,'user':_0x2541ff,'master_shop':_0x354808,'unit':_0x4588f6,'language':_0x290e78,'suppliers':_0xf9a8b4,'dataSelected':_0x47180d});}catch(_0x27af40){console[_0x2759da(0x1ed)](_0x27af40);}}),router[a0_0x3a69b5(0x179)](a0_0x3a69b5(0x186),auth,async(_0x2a34a4,_0x97ac10)=>{var _0x2dee7e=a0_0x3a69b5;try{const _0x39aba9=_0x2a34a4[_0x2dee7e(0x17d)]['id'],{invoice:_0x49b1f8,warehouse_name:_0x5d424d,Room_name:_0x74fc92}=_0x2a34a4['body'],_0x51a653=await warehouse[_0x2dee7e(0x134)]({'name':_0x5d424d,'room':_0x74fc92}),_0x2caecd=await purchases[_0x2dee7e(0x134)]({'invoice':_0x49b1f8});_0x2caecd['product'][_0x2dee7e(0x1b4)](_0x4d965e=>{var _0x3e6169=_0x2dee7e,_0x275fd0=0x0;const _0x49fd5b=_0x51a653[_0x3e6169(0x228)][_0x3e6169(0x143)](_0x536a33=>{var _0x3c9f4f=_0x3e6169;_0x536a33['product_name']==_0x4d965e['product_name']&&_0x536a33[_0x3c9f4f(0x201)]==_0x4d965e[_0x3c9f4f(0x201)]&&_0x536a33[_0x3c9f4f(0x197)]==_0x4d965e[_0x3c9f4f(0x197)]&&_0x536a33[_0x3c9f4f(0x1d3)]==_0x4d965e['bin']&&_0x536a33[_0x3c9f4f(0x21d)]==_0x4d965e['bay']&&_0x536a33[_0x3c9f4f(0x13b)]==_0x4d965e[_0x3c9f4f(0x13b)]&&_0x536a33['storage']==_0x4d965e[_0x3c9f4f(0x227)]&&_0x536a33[_0x3c9f4f(0x225)]==_0x4d965e[_0x3c9f4f(0x225)]&&_0x536a33[_0x3c9f4f(0x169)]==_0x4d965e[_0x3c9f4f(0x169)]&&_0x536a33[_0x3c9f4f(0x20e)]==_0x4d965e[_0x3c9f4f(0x20e)]&&_0x536a33['delivery_date']==_0x4d965e['delivery_date']&&_0x536a33['delivery_code']==_0x4d965e[_0x3c9f4f(0x22a)]&&(_0x536a33[_0x3c9f4f(0x1c2)]=parseInt(_0x536a33[_0x3c9f4f(0x1c2)])+parseInt(_0x4d965e[_0x3c9f4f(0x145)]),_0x275fd0++);});_0x275fd0=='0'&&(_0x51a653[_0x3e6169(0x228)]=_0x51a653[_0x3e6169(0x228)][_0x3e6169(0x16e)]({'product_name':_0x4d965e[_0x3e6169(0x1a4)],'product_stock':_0x4d965e[_0x3e6169(0x145)],'primary_code':_0x4d965e[_0x3e6169(0x1d6)],'secondary_code':_0x4d965e['secondary_code'],'product_code':_0x4d965e[_0x3e6169(0x18a)],'storage':_0x4d965e[_0x3e6169(0x227)],'rack':_0x4d965e[_0x3e6169(0x13b)],'bay':_0x4d965e['bay'],'bin':_0x4d965e[_0x3e6169(0x1d3)],'type':_0x4d965e['type'],'floorlevel':_0x4d965e[_0x3e6169(0x201)],'maxProducts':_0x4d965e[_0x3e6169(0x1a5)],'unit':_0x4d965e[_0x3e6169(0x189)],'secondary_unit':_0x4d965e['secondary_unit'],'expiry_date':_0x4d965e['expiry_date'],'maxPerUnit':_0x4d965e[_0x3e6169(0x205)],'batch_code':_0x4d965e[_0x3e6169(0x169)],'alertQTY':_0x4d965e[_0x3e6169(0x174)],'production_date':_0x4d965e[_0x3e6169(0x20e)],'delivery_date':_0x4d965e[_0x3e6169(0x19e)],'delivery_code':_0x4d965e['delivery_code']}));}),await _0x51a653[_0x2dee7e(0x183)](),_0x2caecd[_0x2dee7e(0x1ff)]=_0x2dee7e(0x150);const _0x25a826=await _0x2caecd[_0x2dee7e(0x183)]();_0x2a34a4[_0x2dee7e(0x18d)](_0x2dee7e(0x188),'Sales\x20Update\x20successfully'),_0x97ac10[_0x2dee7e(0x12b)]('/all_purchases/view');}catch(_0x350f2c){console[_0x2dee7e(0x1ed)](_0x350f2c);}}),router['get'](a0_0x3a69b5(0x1f2),auth,async(_0x586976,_0x1fd1c3)=>{var _0x248732=a0_0x3a69b5;try{const {username:_0x1789bd,email:_0x29baa2,role:_0x5139cb}=_0x586976[_0x248732(0x16b)],_0x200bfe=_0x586976[_0x248732(0x16b)],_0x58858b=await profile[_0x248732(0x134)]({'email':_0x200bfe['email']}),_0x19b032=await master_shop[_0x248732(0x1d2)](),_0x26d9b5=_0x586976[_0x248732(0x17d)]['id'],_0xf7c75b=await purchases['findById'](_0x26d9b5),_0x411565=await suppliers[_0x248732(0x1d2)]({});let _0x10b671;if(_0x200bfe[_0x248732(0x216)]==_0x248732(0x1cd)){const _0x508153=await staff[_0x248732(0x134)]({'email':_0x200bfe[_0x248732(0x1c8)]});_0x10b671=await warehouse['find']({'status':_0x248732(0x153),'name':_0x508153['warehouse'],'warehouse_category':'Raw\x20Materials'});}else _0x10b671=await warehouse[_0x248732(0x14c)]([{'$match':{'status':'Enabled','warehouse_category':_0x248732(0x1b8)}},{'$group':{'_id':_0x248732(0x1ca),'name':{'$first':_0x248732(0x1ca)}}}]);const _0x57fe6c=await product[_0x248732(0x1d2)]({}),_0x5411e9=BayBinSelected(_0xf7c75b[_0x248732(0x218)],_0xf7c75b[_0x248732(0x1dd)]);let _0x35c6d8=new Date(_0xf7c75b[_0x248732(0x225)]),_0x3b55ab=('0'+_0x35c6d8['getDate']())[_0x248732(0x156)](-0x2),_0x53ba9a=('0'+(_0x35c6d8[_0x248732(0x199)]()+0x1))[_0x248732(0x156)](-0x2),_0xec8845=_0x35c6d8['getFullYear'](),_0x5d0c00=_0xec8845+'-'+_0x53ba9a+'-'+_0x3b55ab;if(_0x19b032[0x0][_0x248732(0x1bf)]==_0x248732(0x1ea)){var _0x4a054e=users['English'];console[_0x248732(0x1ed)](_0x4a054e);}else{if(_0x19b032[0x0]['language']==_0x248732(0x10f))var _0x4a054e=users[_0x248732(0x10f)];else{if(_0x19b032[0x0][_0x248732(0x1bf)]==_0x248732(0x111))var _0x4a054e=users[_0x248732(0x111)];else{if(_0x19b032[0x0]['language']==_0x248732(0x146))var _0x4a054e=users[_0x248732(0x146)];else{if(_0x19b032[0x0]['language']==_0x248732(0x184))var _0x4a054e=users['French'];else{if(_0x19b032[0x0][_0x248732(0x1bf)]==_0x248732(0x1b2))var _0x4a054e=users[_0x248732(0x142)];else{if(_0x19b032[0x0]['language']=='Chinese')var _0x4a054e=users[_0x248732(0x119)];else{if(_0x19b032[0x0][_0x248732(0x1bf)]==_0x248732(0x159))var _0x4a054e=users[_0x248732(0x1e8)];}}}}}}}_0x1fd1c3[_0x248732(0x148)](_0x248732(0x1af),{'success':_0x586976[_0x248732(0x18d)](_0x248732(0x188)),'errors':_0x586976['flash'](_0x248732(0x1c0)),'role':_0x200bfe,'profile':_0x58858b,'purchases':_0xf7c75b,'suppliers':_0x411565,'warehouse':_0x10b671,'product':_0x57fe6c,'master_shop':_0x19b032,'language':_0x4a054e,'ed_fullDate':_0x5d0c00,'dataSelected':_0x5411e9});}catch(_0x1626eb){console[_0x248732(0x1ed)](_0x1626eb);}}),router['post']('/view/:id',auth,async(_0x2ca2cd,_0x30a2ec)=>{var _0x15f471=a0_0x3a69b5;try{const _0x465900=_0x2ca2cd[_0x15f471(0x17d)]['id'],_0x39499d=await purchases['findOne']({'_id':_0x2ca2cd[_0x15f471(0x17d)]['id']}),_0x46a2a5=await warehouse['findOne']({'name':_0x39499d[_0x15f471(0x218)],'room':_0x39499d[_0x15f471(0x1dd)]});_0x39499d['product'][_0x15f471(0x1b4)](_0x1354c8=>{var _0x2953a7=_0x15f471;const _0x145ca2=_0x46a2a5[_0x2953a7(0x228)][_0x2953a7(0x143)](_0x2b86e2=>{var _0x20ac4b=_0x2953a7;_0x2b86e2[_0x20ac4b(0x1a4)]==_0x1354c8[_0x20ac4b(0x1a4)]&&_0x2b86e2[_0x20ac4b(0x201)]==_0x1354c8['floorlevel']&&_0x2b86e2[_0x20ac4b(0x197)]==_0x1354c8[_0x20ac4b(0x197)]&&_0x2b86e2[_0x20ac4b(0x1d3)]==_0x1354c8[_0x20ac4b(0x1d3)]&&_0x2b86e2[_0x20ac4b(0x21d)]==_0x1354c8[_0x20ac4b(0x21d)]&&_0x2b86e2['rack']==_0x1354c8['rack']&&_0x2b86e2['storage']==_0x1354c8[_0x20ac4b(0x227)]&&(_0x2b86e2[_0x20ac4b(0x1c2)]=parseInt(_0x2b86e2[_0x20ac4b(0x1c2)])-parseInt(_0x1354c8[_0x20ac4b(0x145)]));});}),await _0x46a2a5[_0x15f471(0x183)]();const {invoice:_0xe34170,suppliers:_0x590d86,date:_0x2c72e3,warehouse_name:_0x230af4,prod_name:_0x2a2b4e,prod_code:_0x5e1620,prod_qty:_0x24bfff,prod_unit:_0x11bfcb,prod_secondunit:_0x439a1a,prod_level:_0x321ef1,prod_isle:_0x18b8e5,prod_pallet:_0x346cc9,note:_0x2181ba,expiry_date:_0x190b4f,batch_code:_0x560e1,paid_amount:_0x2e77ac,due_amount:_0x250cc5,Room_name:_0x272b15,primary_code:_0x475620,secondary_code:_0x210944,PO_number:_0x34214f,JO_number:_0x2f957b}=_0x2ca2cd[_0x15f471(0x1b7)];if(typeof _0x2a2b4e==_0x15f471(0x19b))var _0x2b12c3=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x13c)]],_0x29cd3f=[_0x2ca2cd['body'][_0x15f471(0x137)]],_0x568e10=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x110)]],_0x1f78ed=[_0x2ca2cd['body']['prod_unit']],_0x42f23c=[_0x2ca2cd[_0x15f471(0x1b7)]['prod_secondunit']],_0x196a79=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x151)]],_0x1110c3=[_0x2ca2cd[_0x15f471(0x1b7)]['prod_isle']],_0x44cdea=[_0x2ca2cd[_0x15f471(0x1b7)]['prod_pallet']],_0x467f5a=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x1d6)]],_0x8a174=[_0x2ca2cd[_0x15f471(0x1b7)]['secondary_code']],_0x2efe98=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x1a0)]],_0x558975=[_0x2ca2cd['body'][_0x15f471(0x169)]],_0x28b4f9=[_0x2ca2cd[_0x15f471(0x1b7)]['expiry_date']],_0x25186a=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x227)]],_0xb90197=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x1cf)]],_0x176127=[_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x197)]];else var _0x2b12c3=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x13c)]],_0x29cd3f=[..._0x2ca2cd['body']['prod_code']],_0x568e10=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x110)]],_0x1f78ed=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x177)]],_0x42f23c=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x213)]],_0x196a79=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x151)]],_0x1110c3=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x22c)]],_0x44cdea=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x126)]],_0x467f5a=[..._0x2ca2cd['body'][_0x15f471(0x1d6)]],_0x8a174=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x144)]],_0x2efe98=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x1a0)]],_0x558975=[..._0x2ca2cd['body'][_0x15f471(0x169)]],_0x28b4f9=[..._0x2ca2cd['body'][_0x15f471(0x225)]],_0x25186a=[..._0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x227)]],_0xb90197=[..._0x2ca2cd[_0x15f471(0x1b7)]['rak']],_0x176127=[..._0x2ca2cd['body'][_0x15f471(0x197)]];const _0x3ce578=_0x2b12c3[_0x15f471(0x143)](_0xb30076=>{return _0xb30076={'product_name':_0xb30076};});_0x29cd3f[_0x15f471(0x1b4)]((_0x2418f6,_0x387c8f)=>{_0x3ce578[_0x387c8f]['product_code']=_0x2418f6;}),_0x568e10['forEach']((_0x3222d4,_0x3d603e)=>{var _0x340576=_0x15f471;_0x3ce578[_0x3d603e][_0x340576(0x145)]=_0x3222d4;}),_0x1f78ed[_0x15f471(0x1b4)]((_0x19430c,_0x123d4f)=>{var _0x8f8f51=_0x15f471;_0x3ce578[_0x123d4f][_0x8f8f51(0x189)]=_0x19430c;}),_0x42f23c[_0x15f471(0x1b4)]((_0x55147c,_0x3783c5)=>{var _0x45c0de=_0x15f471;_0x3ce578[_0x3783c5][_0x45c0de(0x1f0)]=_0x55147c;}),_0x196a79[_0x15f471(0x1b4)]((_0x9f3fd7,_0x1757d5)=>{var _0xa06206=_0x15f471;_0x3ce578[_0x1757d5][_0xa06206(0x21d)]=_0x9f3fd7;}),_0x1110c3[_0x15f471(0x1b4)]((_0x14cf51,_0x2931d2)=>{var _0x5e35e1=_0x15f471;_0x3ce578[_0x2931d2][_0x5e35e1(0x1d3)]=_0x14cf51;}),_0x44cdea[_0x15f471(0x1b4)]((_0x561ebb,_0x209180)=>{var _0x530f31=_0x15f471;_0x3ce578[_0x209180][_0x530f31(0x201)]=_0x561ebb;}),_0x467f5a['forEach']((_0x3c55b7,_0x122009)=>{var _0x29a3db=_0x15f471;_0x3ce578[_0x122009][_0x29a3db(0x1d6)]=_0x3c55b7;}),_0x8a174[_0x15f471(0x1b4)]((_0x2126a1,_0x4c10a7)=>{var _0x5c5663=_0x15f471;_0x3ce578[_0x4c10a7][_0x5c5663(0x144)]=_0x2126a1;}),_0x2efe98['forEach']((_0x9c456,_0x117e40)=>{var _0x2534bf=_0x15f471;_0x3ce578[_0x117e40][_0x2534bf(0x1a5)]=_0x9c456;}),_0x558975[_0x15f471(0x1b4)]((_0x2bcd9a,_0x110028)=>{var _0x3be9ee=_0x15f471;_0x3ce578[_0x110028][_0x3be9ee(0x169)]=_0x2bcd9a;}),_0x28b4f9[_0x15f471(0x1b4)]((_0x395d3b,_0x595db9)=>{_0x3ce578[_0x595db9]['expiry_date']=_0x395d3b;}),_0x176127['forEach']((_0x20ba8d,_0x3c5866)=>{var _0x4604ad=_0x15f471;_0x3ce578[_0x3c5866][_0x4604ad(0x197)]=_0x20ba8d;}),_0x25186a[_0x15f471(0x1b4)]((_0x2f2754,_0x5f4b6f)=>{_0x3ce578[_0x5f4b6f]['storage']=_0x2f2754;}),_0xb90197[_0x15f471(0x1b4)]((_0x18a49f,_0x2e9565)=>{_0x3ce578[_0x2e9565]['rack']=_0x18a49f;});const _0x3b0291=_0x3ce578[_0x15f471(0x1b0)](_0x3bb64d=>_0x3bb64d[_0x15f471(0x145)]!=='0'&&_0x3bb64d['quantity']!=='');_0x39499d[_0x15f471(0x14f)]=_0xe34170,_0x39499d[_0x15f471(0x1e3)]=_0x590d86,_0x39499d[_0x15f471(0x17e)]=_0x2c72e3,_0x39499d['warehouse_name']=_0x230af4,_0x39499d[_0x15f471(0x1cb)]=_0x3b0291,_0x39499d[_0x15f471(0x15c)]=_0x2181ba,_0x39499d[_0x15f471(0x1d8)]=_0x2e77ac,_0x39499d[_0x15f471(0x1a3)]=_0x250cc5,_0x39499d['room']=_0x272b15,_0x39499d[_0x15f471(0x129)]=_0x34214f,_0x39499d[_0x15f471(0x11c)]=_0x2f957b;const _0x17a3b3=await _0x39499d[_0x15f471(0x183)](),_0x26096c=await warehouse[_0x15f471(0x134)]({'name':_0x2ca2cd['body'][_0x15f471(0x218)],'room':_0x2ca2cd[_0x15f471(0x1b7)][_0x15f471(0x181)]});_0x39499d[_0x15f471(0x1cb)][_0x15f471(0x1b4)](_0x1ffe32=>{var _0x18c287=_0x15f471,_0x210287=0x0;const _0x2918db=_0x26096c[_0x18c287(0x228)][_0x18c287(0x143)](_0x37fd3b=>{var _0x10cb1a=_0x18c287;_0x37fd3b['product_name']==_0x1ffe32['product_name']&&_0x37fd3b['floorlevel']==_0x1ffe32[_0x10cb1a(0x201)]&&_0x37fd3b[_0x10cb1a(0x197)]==_0x1ffe32['type']&&_0x37fd3b['bin']==_0x1ffe32['bin']&&_0x37fd3b[_0x10cb1a(0x21d)]==_0x1ffe32[_0x10cb1a(0x21d)]&&_0x37fd3b[_0x10cb1a(0x13b)]==_0x1ffe32[_0x10cb1a(0x13b)]&&_0x37fd3b[_0x10cb1a(0x227)]==_0x1ffe32[_0x10cb1a(0x227)]&&(_0x37fd3b[_0x10cb1a(0x1c2)]=parseInt(_0x37fd3b[_0x10cb1a(0x1c2)])+parseInt(_0x1ffe32[_0x10cb1a(0x145)]),_0x210287++);});_0x210287=='0'&&(_0x26096c[_0x18c287(0x228)]=_0x26096c[_0x18c287(0x228)][_0x18c287(0x16e)]({'product_name':_0x1ffe32['product_name'],'product_stock':_0x1ffe32[_0x18c287(0x145)],'primary_code':_0x1ffe32[_0x18c287(0x1d6)],'secondary_code':_0x1ffe32['secondary_code'],'product_code':_0x1ffe32['product_code'],'storage':_0x1ffe32[_0x18c287(0x227)],'rack':_0x1ffe32[_0x18c287(0x13b)],'bay':_0x1ffe32[_0x18c287(0x21d)],'bin':_0x1ffe32['bin'],'type':_0x1ffe32[_0x18c287(0x197)],'floorlevel':_0x1ffe32['floorlevel'],'maxProducts':_0x1ffe32[_0x18c287(0x1a5)],'unit':_0x1ffe32[_0x18c287(0x189)],'secondary_unit':_0x1ffe32[_0x18c287(0x1f0)],'expiry_date':_0x1ffe32['expiry_date']}));}),await _0x26096c['save']();const _0x456018=await s_payment_data[_0x15f471(0x134)]({'invoice':_0x2ca2cd[_0x15f471(0x1b7)]['invoice']});if(_0x456018===null){}else console[_0x15f471(0x1ed)](_0x15f471(0x1e3),_0x456018,_0x2ca2cd['body'][_0x15f471(0x14f)]),_0x456018[_0x15f471(0x1e3)]=_0x2ca2cd[_0x15f471(0x1b7)]['suppliers'],await _0x456018[_0x15f471(0x183)]();_0x2ca2cd[_0x15f471(0x18d)](_0x15f471(0x188),_0x15f471(0x204)),_0x30a2ec[_0x15f471(0x12b)](_0x15f471(0x152));}catch(_0x51985e){console[_0x15f471(0x1ed)](_0x51985e);}}),router[a0_0x3a69b5(0x179)](a0_0x3a69b5(0x1f6),auth,async(_0x5a509d,_0x304fd6)=>{var _0x474371=a0_0x3a69b5;try{const _0x2cbc84=_0x5a509d[_0x474371(0x17d)]['id'],{invoice:_0x3173ee,suppliers:_0x2d7680,payable:_0x4ad712,due_amount:_0x2daa90}=_0x5a509d[_0x474371(0x1b7)],_0x32e72b=await purchases[_0x474371(0x12e)](_0x2cbc84);var _0x4f5c0d=_0x4ad712-_0x2daa90;_0x32e72b[_0x474371(0x1d8)]=parseFloat(_0x32e72b[_0x474371(0x1d8)])+parseFloat(_0x2daa90),_0x32e72b[_0x474371(0x1a3)]=_0x4f5c0d;const _0x5103f4=await _0x32e72b['save']();console[_0x474371(0x1ed)](_0x5103f4);const _0x947476=await s_payment_data['findOne']({'invoice':_0x3173ee});_0x947476[_0x474371(0x12d)]=_0x4f5c0d,await _0x947476[_0x474371(0x183)]();let _0x1d7ed7=new Date(),_0x1e501d=('0'+_0x1d7ed7['getDate']())[_0x474371(0x156)](-0x2),_0x41a546=('0'+(_0x1d7ed7[_0x474371(0x199)]()+0x1))[_0x474371(0x156)](-0x2),_0x3ad352=_0x1d7ed7[_0x474371(0x1b9)](),_0x498751=_0x3ad352+'-'+_0x41a546+'-'+_0x1e501d;const _0x587761=new suppliers_payment({'invoice':_0x3173ee,'date':_0x3ad352+'-'+_0x41a546+'-'+_0x1e501d,'suppliers':_0x2d7680,'reason':'Paid\x20For\x20Purchase','amount':_0x2daa90}),_0x13b865=await _0x587761[_0x474371(0x183)]();_0x5a509d[_0x474371(0x18d)](_0x474371(0x188),_0x474371(0x13f)),_0x304fd6[_0x474371(0x12b)]('/all_purchases/view');}catch(_0x229da4){console[_0x474371(0x1ed)](_0x229da4);}}),router[a0_0x3a69b5(0x121)](a0_0x3a69b5(0x173),auth,async(_0x2f7f43,_0x4d4b18)=>{var _0x4d89d3=a0_0x3a69b5;try{const {username:_0x2e0722,email:_0x105d9c,role:_0x204a39}=_0x2f7f43[_0x4d89d3(0x16b)],_0x440ffa=_0x2f7f43[_0x4d89d3(0x16b)],_0x3317cc=await profile[_0x4d89d3(0x134)]({'email':_0x440ffa[_0x4d89d3(0x1c8)]}),_0x74ed6d=await master_shop[_0x4d89d3(0x1d2)]();console[_0x4d89d3(0x1ed)]('master',_0x74ed6d);const _0x45c719=_0x2f7f43[_0x4d89d3(0x17d)]['id'],_0x4fdda0=await purchases['findById'](_0x45c719);console[_0x4d89d3(0x1ed)](_0x4fdda0);const _0x15431e=await suppliers[_0x4d89d3(0x134)]({'name':_0x4fdda0[_0x4d89d3(0x1e3)]});console[_0x4d89d3(0x1ed)](_0x15431e);if(_0x74ed6d[0x0][_0x4d89d3(0x1bf)]==_0x4d89d3(0x1ea)){var _0x341824=users[_0x4d89d3(0x219)];console['log'](_0x341824);}else{if(_0x74ed6d[0x0][_0x4d89d3(0x1bf)]==_0x4d89d3(0x10f))var _0x341824=users[_0x4d89d3(0x10f)];else{if(_0x74ed6d[0x0][_0x4d89d3(0x1bf)]==_0x4d89d3(0x111))var _0x341824=users['German'];else{if(_0x74ed6d[0x0][_0x4d89d3(0x1bf)]==_0x4d89d3(0x146))var _0x341824=users[_0x4d89d3(0x146)];else{if(_0x74ed6d[0x0]['language']=='French')var _0x341824=users[_0x4d89d3(0x184)];else{if(_0x74ed6d[0x0][_0x4d89d3(0x1bf)]==_0x4d89d3(0x1b2))var _0x341824=users[_0x4d89d3(0x142)];else{if(_0x74ed6d[0x0][_0x4d89d3(0x1bf)]==_0x4d89d3(0x119))var _0x341824=users[_0x4d89d3(0x119)];else{if(_0x74ed6d[0x0]['language']=='Arabic\x20(ae)')var _0x341824=users[_0x4d89d3(0x1e8)];}}}}}}}_0x4d4b18[_0x4d89d3(0x148)](_0x4d89d3(0x1f4),{'success':_0x2f7f43[_0x4d89d3(0x18d)](_0x4d89d3(0x188)),'errors':_0x2f7f43[_0x4d89d3(0x18d)](_0x4d89d3(0x1c0)),'role':_0x440ffa,'profile':_0x3317cc,'master_shop':_0x74ed6d,'supplier':_0x15431e,'purchase':_0x4fdda0,'language':_0x341824});}catch(_0x4c6ac9){console[_0x4d89d3(0x1ed)](_0x4c6ac9);}}),router[a0_0x3a69b5(0x121)](a0_0x3a69b5(0x170),auth,async(_0x30bfb8,_0x48c079)=>{var _0x1246b8=a0_0x3a69b5;try{const {username:_0x58adae,email:_0x18e2b3,role:_0xf0ce26}=_0x30bfb8[_0x1246b8(0x16b)],_0x1cdbb7=_0x30bfb8[_0x1246b8(0x16b)],_0xd35cfa=await profile[_0x1246b8(0x134)]({'email':_0x1cdbb7['email']}),_0x2a5173=await master_shop[_0x1246b8(0x1d2)]();console[_0x1246b8(0x1ed)]('master',_0x2a5173);const _0x12c63c=_0x30bfb8[_0x1246b8(0x17d)]['id'];console['log'](_0x12c63c);const _0x2863f1=await purchases[_0x1246b8(0x12e)](_0x12c63c);console[_0x1246b8(0x1ed)]('user_id',_0x2863f1);const _0x4ae465=await product['find']({}),_0x41a53a=await warehouse[_0x1246b8(0x14c)]([{'$match':{'name':_0x2863f1[_0x1246b8(0x218)],'room':_0x2863f1[_0x1246b8(0x1dd)],'warehouse_category':_0x1246b8(0x1b8)}},{'$unwind':_0x1246b8(0x114)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1246b8(0x15f)},'product_stock':{'$first':_0x1246b8(0x1fa)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1246b8(0x1e7)},'type':{'$first':_0x1246b8(0x223)},'floorlevel':{'$first':_0x1246b8(0x207)},'primary_code':{'$first':_0x1246b8(0x171)},'secondary_code':{'$first':_0x1246b8(0x1d0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1246b8(0x175)},'rack':{'$first':_0x1246b8(0x13e)}}}]);warehouse_data=await warehouse[_0x1246b8(0x14c)]([{'$match':{'status':_0x1246b8(0x153),'name':'Return\x20Goods','warehouse_category':_0x1246b8(0x1b8)}},{'$group':{'_id':_0x1246b8(0x1ca),'name':{'$first':_0x1246b8(0x1ca)}}},{'$sort':{'name':0x1}}]),console[_0x1246b8(0x1ed)]('stock_data',_0x41a53a);if(_0x2a5173[0x0][_0x1246b8(0x1bf)]=='English\x20(US)'){var _0x3556b1=users[_0x1246b8(0x219)];console['log'](_0x3556b1);}else{if(_0x2a5173[0x0][_0x1246b8(0x1bf)]==_0x1246b8(0x10f))var _0x3556b1=users[_0x1246b8(0x10f)];else{if(_0x2a5173[0x0][_0x1246b8(0x1bf)]==_0x1246b8(0x111))var _0x3556b1=users[_0x1246b8(0x111)];else{if(_0x2a5173[0x0][_0x1246b8(0x1bf)]==_0x1246b8(0x146))var _0x3556b1=users[_0x1246b8(0x146)];else{if(_0x2a5173[0x0][_0x1246b8(0x1bf)]=='French')var _0x3556b1=users[_0x1246b8(0x184)];else{if(_0x2a5173[0x0][_0x1246b8(0x1bf)]==_0x1246b8(0x1b2))var _0x3556b1=users['Portuguese'];else{if(_0x2a5173[0x0]['language']==_0x1246b8(0x119))var _0x3556b1=users[_0x1246b8(0x119)];else{if(_0x2a5173[0x0]['language']=='Arabic\x20(ae)')var _0x3556b1=users['Arabic'];}}}}}}}_0x48c079[_0x1246b8(0x148)](_0x1246b8(0x149),{'success':_0x30bfb8[_0x1246b8(0x18d)]('success'),'errors':_0x30bfb8[_0x1246b8(0x18d)](_0x1246b8(0x1c0)),'role':_0x1cdbb7,'profile':_0xd35cfa,'user':_0x2863f1,'stock':_0x41a53a,'master_shop':_0x2a5173,'product':_0x4ae465,'language':_0x3556b1,'warehouse':warehouse_data});}catch(_0x23c8c2){console[_0x1246b8(0x1ed)](_0x23c8c2);}}),router[a0_0x3a69b5(0x179)](a0_0x3a69b5(0x170),auth,async(_0x44cc83,_0x4d3e25)=>{var _0x5a3958=a0_0x3a69b5;try{const {invoice:_0x473d7d,date:_0x541109,warehouse_name:_0x525519,Room_name:_0x3d30e2,product_name:_0x1d8140,purchase_quantity:_0x47a110,stocks:_0x10aaa5,return_qty:_0x148097,note:_0x201ded,level:_0x564d41,isle:_0x4f37eb,pallet:_0x1121dc,to_warehouse_name:_0x2fb07f,to_Room_name:_0x5d4ff4}=_0x44cc83[_0x5a3958(0x1b7)],_0x51716f=await purchases[_0x5a3958(0x134)]({'_id':_0x44cc83['params']['id']}),_0x4a09bf=await warehouse[_0x5a3958(0x134)]({'name':_0x525519,'room':_0x3d30e2});if(typeof _0x1d8140==_0x5a3958(0x19b))var _0x23f5c5=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x1a4)]],_0x44b7ab=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x115)]],_0x3edcd8=[_0x44cc83['body']['stocks']],_0x4da9e4=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x11a)]],_0xeb1ccf=[_0x44cc83['body'][_0x5a3958(0x154)]],_0xca5a3c=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x140)]],_0x36d17d=[_0x44cc83['body'][_0x5a3958(0x1ae)]],_0x2ed72d=[_0x44cc83[_0x5a3958(0x1b7)]['types']],_0x1f72b5=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x131)]],_0x86651=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x18b)]],_0x1d1fed=[_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x185)]];else var _0x23f5c5=[..._0x44cc83['body'][_0x5a3958(0x1a4)]],_0x44b7ab=[..._0x44cc83['body'][_0x5a3958(0x115)]],_0x3edcd8=[..._0x44cc83[_0x5a3958(0x1b7)]['stocks']],_0x4da9e4=[..._0x44cc83['body']['return_qty']],_0xeb1ccf=[..._0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x154)]],_0xca5a3c=[..._0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x140)]],_0x36d17d=[..._0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x1ae)]],_0x2ed72d=[..._0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x1f9)]],_0x1f72b5=[..._0x44cc83[_0x5a3958(0x1b7)]['product_code_hide']],_0x86651=[..._0x44cc83['body'][_0x5a3958(0x18b)]],_0x1d1fed=[..._0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x185)]];const _0xca2fe2=_0x23f5c5[_0x5a3958(0x143)](_0x2fc313=>{return _0x2fc313={'product_name':_0x2fc313};});_0x44b7ab[_0x5a3958(0x1b4)]((_0x40341a,_0x77c0b7)=>{var _0x40c6d4=_0x5a3958;_0xca2fe2[_0x77c0b7][_0x40c6d4(0x115)]=_0x40341a;}),_0x3edcd8['forEach']((_0x2528d7,_0x1ed619)=>{var _0x49a310=_0x5a3958;_0xca2fe2[_0x1ed619][_0x49a310(0x13a)]=_0x2528d7;}),_0x4da9e4[_0x5a3958(0x1b4)]((_0x1c97ce,_0x14eccc)=>{var _0x27faaf=_0x5a3958;_0xca2fe2[_0x14eccc][_0x27faaf(0x11a)]=_0x1c97ce;}),_0xeb1ccf['forEach']((_0x5c44b5,_0x5dccc8)=>{var _0x418dec=_0x5a3958;_0xca2fe2[_0x5dccc8][_0x418dec(0x21d)]=_0x5c44b5;}),_0xca5a3c[_0x5a3958(0x1b4)]((_0xc10683,_0x203094)=>{_0xca2fe2[_0x203094]['bin']=_0xc10683;}),_0x36d17d[_0x5a3958(0x1b4)]((_0x330b31,_0x14e468)=>{var _0x9c6c20=_0x5a3958;_0xca2fe2[_0x14e468][_0x9c6c20(0x201)]=_0x330b31;}),_0x2ed72d[_0x5a3958(0x1b4)]((_0xb964f1,_0x5cd614)=>{var _0x44ab37=_0x5a3958;_0xca2fe2[_0x5cd614][_0x44ab37(0x197)]=_0xb964f1;}),_0x1f72b5[_0x5a3958(0x1b4)]((_0xa62a90,_0x401e11)=>{var _0x4ea28c=_0x5a3958;_0xca2fe2[_0x401e11][_0x4ea28c(0x18a)]=_0xa62a90;}),_0x86651['forEach']((_0x23a38f,_0x3fb480)=>{var _0x33ebb4=_0x5a3958;_0xca2fe2[_0x3fb480][_0x33ebb4(0x1d6)]=_0x23a38f;}),_0x1d1fed[_0x5a3958(0x1b4)]((_0x552223,_0x205885)=>{_0xca2fe2[_0x205885]['secondary_code']=_0x552223;}),_0x51716f['product'][_0x5a3958(0x1b4)](_0x560491=>{var _0x47dc09=_0x5a3958;const _0x2cf8e4=_0x4a09bf[_0x47dc09(0x228)][_0x47dc09(0x143)](_0x3a676f=>{var _0x4ab4a5=_0x47dc09;_0x3a676f[_0x4ab4a5(0x1a4)]==_0x560491[_0x4ab4a5(0x1a4)]&&_0x3a676f[_0x4ab4a5(0x201)]==_0x560491[_0x4ab4a5(0x201)]&&_0x3a676f['type']==_0x560491[_0x4ab4a5(0x197)]&&_0x3a676f[_0x4ab4a5(0x1d3)]==_0x560491['bin']&&_0x3a676f['bay']==_0x560491[_0x4ab4a5(0x21d)]&&_0x3a676f[_0x4ab4a5(0x13b)]==_0x560491[_0x4ab4a5(0x13b)]&&_0x3a676f[_0x4ab4a5(0x227)]==_0x560491[_0x4ab4a5(0x227)]&&(console[_0x4ab4a5(0x1ed)](parseInt(_0x3a676f['product_stock'])+_0x4ab4a5(0x206)+parseInt(_0x560491[_0x4ab4a5(0x145)])),_0x3a676f[_0x4ab4a5(0x1c2)]=parseInt(_0x3a676f['product_stock'])+parseInt(_0x560491[_0x4ab4a5(0x145)]));});}),await _0x4a09bf[_0x5a3958(0x183)]();const _0x50774c=_0xca2fe2[_0x5a3958(0x1b0)](_0x494511=>_0x494511[_0x5a3958(0x11a)]!=='0'&&_0x494511['return_qty']!=='');var _0x2323ad=0x0;_0x50774c[_0x5a3958(0x1b4)](_0x2a163c=>{var _0x2b2982=_0x5a3958;console[_0x2b2982(0x1ed)](_0x2b2982(0x1de),_0x2a163c),(parseInt(_0x2a163c[_0x2b2982(0x115)])<parseInt(_0x2a163c[_0x2b2982(0x11a)])||parseInt(_0x2a163c[_0x2b2982(0x13a)])<parseInt(_0x2a163c['return_qty']))&&_0x2323ad++;});if(_0x2323ad!=0x0)return _0x44cc83[_0x5a3958(0x18d)](_0x5a3958(0x1c0),_0x5a3958(0x163)),_0x4d3e25[_0x5a3958(0x12b)](_0x5a3958(0x178));const _0x3d018c=new purchases_return({'invoice':_0x473d7d,'suppliers':_0x44cc83[_0x5a3958(0x1b7)]['suppliers'],'date':_0x541109,'warehouse_name':_0x525519,'return_product':_0x50774c,'note':_0x201ded,'room':_0x3d30e2,'to_warehouse_name':_0x2fb07f,'to_room':_0x5d4ff4}),_0x396f00=await _0x3d018c[_0x5a3958(0x183)]();console[_0x5a3958(0x1ed)](_0x3d018c);const _0x2180a6=await purchases_return['findOne']({'invoice':_0x473d7d}),_0x5dfedf=await warehouse[_0x5a3958(0x134)]({'name':_0x2fb07f,'room':_0x5d4ff4});_0x2180a6['return_product'][_0x5a3958(0x1b4)](_0x41129b=>{var _0x1e21ad=_0x5a3958,_0x16bafb=0x0;const _0xe87322=_0x5dfedf['product_details']['map'](_0x348d50=>{var _0x144340=a0_0x13f6;_0x348d50[_0x144340(0x1a4)]==_0x41129b['product_name']&&_0x348d50[_0x144340(0x201)]==_0x41129b['floorlevel']&&_0x348d50['type']==_0x41129b[_0x144340(0x197)]&&_0x348d50['bin']==_0x41129b[_0x144340(0x1d3)]&&_0x348d50['bay']==_0x41129b[_0x144340(0x21d)]&&(_0x348d50[_0x144340(0x1c2)]=parseInt(_0x348d50['product_stock'])-parseInt(_0x41129b['return_qty']),_0x16bafb++);});_0x16bafb=='0'&&(_0x5dfedf[_0x1e21ad(0x228)]=_0x5dfedf['product_details'][_0x1e21ad(0x16e)]({'product_name':_0x41129b[_0x1e21ad(0x1a4)],'product_stock':_0x41129b[_0x1e21ad(0x11a)],'primary_code':_0x41129b[_0x1e21ad(0x1d6)],'secondary_code':_0x41129b[_0x1e21ad(0x144)],'product_code':_0x41129b[_0x1e21ad(0x18a)],'storage':_0x41129b['storage'],'rack':_0x41129b['rack'],'bay':_0x41129b[_0x1e21ad(0x21d)],'bin':_0x41129b[_0x1e21ad(0x1d3)],'type':_0x41129b[_0x1e21ad(0x197)],'floorlevel':_0x41129b[_0x1e21ad(0x201)],'maxProducts':_0x41129b['maxStocks'],'unit':_0x41129b[_0x1e21ad(0x189)],'secondary_unit':_0x41129b[_0x1e21ad(0x1f0)],'expiry_date':_0x41129b['expiry_date']}));}),await _0x5dfedf[_0x5a3958(0x183)]();const _0x4c5084=await purchases[_0x5a3958(0x134)]({'invoice':_0x473d7d});_0x4c5084['return_data']=_0x5a3958(0x150);const _0x217d0f=await _0x4c5084[_0x5a3958(0x183)](),_0xd76b95=new s_payment_data({'invoice':_0x473d7d,'suppliers':_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x1e3)],'reason':'Purchase\x20Return'});await _0xd76b95[_0x5a3958(0x183)]();const _0x13f046=await master_shop[_0x5a3958(0x1d2)]();console['log'](_0x5a3958(0x161),_0x13f046[0x0][_0x5a3958(0x20f)]);const _0x299b4e=await email_settings['findOne'](),_0x31b535=await suppliers['findOne']({'name':_0x44cc83[_0x5a3958(0x1b7)][_0x5a3958(0x1e3)]});console[_0x5a3958(0x1ed)](_0x5a3958(0x20a),_0x31b535);_0x13f046[0x0][_0x5a3958(0x1d9)]==0x1?(right_currency=_0x13f046[0x0][_0x5a3958(0x1e0)],left_currency=''):(right_currency='',left_currency=_0x13f046[0x0][_0x5a3958(0x1e0)]);var _0x59347b=_0x23f5c5,_0x4b58b5=_0x4da9e4,_0x3905fd='',_0x2f0a63;for(_0x2f0a63 in _0x59347b){_0x3905fd+=_0x5a3958(0x17c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59347b[_0x2f0a63]+_0x5a3958(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b58b5[_0x2f0a63]+_0x5a3958(0x1b1)+'</tr>';}console['log'](_0x5a3958(0x215),_0x3905fd);let _0x43b4f1=nodemailer[_0x5a3958(0x210)]({'service':_0x5a3958(0x130),'auth':{'user':_0x299b4e['email'],'pass':_0x299b4e['password']}}),_0xbeec79={'from':_0x299b4e[_0x5a3958(0x1c8)],'to':_0x31b535[_0x5a3958(0x1c8)],'subject':_0x5a3958(0x21e),'attachments':[{'filename':_0x5a3958(0x1e1),'path':__dirname+_0x5a3958(0x19c)+_0x5a3958(0x168)+_0x13f046[0x0][_0x5a3958(0x20f)],'cid':_0x5a3958(0x158)}],'html':_0x5a3958(0x21a)+_0x5a3958(0x190)+_0x5a3958(0x12f)+_0x5a3958(0x166)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5a3958(0x166)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5a3958(0x20d)+'<div>'+_0x5a3958(0x1db)+_0x13f046[0x0][_0x5a3958(0x1df)]+_0x5a3958(0x112)+_0x5a3958(0x20d)+_0x5a3958(0x20d)+_0x5a3958(0x116)+_0x5a3958(0x166)+_0x5a3958(0x147)+_0x5a3958(0x224)+_0x473d7d+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5a3958(0x16c)+_0x541109+'\x20'+_0x5a3958(0x187)+_0x5a3958(0x1bd)+_0x5a3958(0x20d)+_0x5a3958(0x124)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x5a3958(0x118)+_0x5a3958(0x1ac)+_0x5a3958(0x17f)+_0x5a3958(0x16d)+_0x5a3958(0x209)+'</thead>'+_0x5a3958(0x16a)+'\x20'+_0x3905fd+'\x20'+_0x5a3958(0x165)+_0x5a3958(0x172)+_0x5a3958(0x166)+_0x5a3958(0x132)+_0x5a3958(0x15e)+_0x13f046[0x0][_0x5a3958(0x1df)]+_0x5a3958(0x1bd)+_0x5a3958(0x20d)+'</div>'+'</body></html>'};_0x43b4f1[_0x5a3958(0x157)](_0xbeec79,function(_0x46878,_0x47191a){var _0x37ed24=_0x5a3958;_0x46878?(console['log'](_0x46878),console[_0x37ed24(0x1ed)]('Error\x20Occurs')):console['log'](_0x37ed24(0x1a6));}),_0x44cc83[_0x5a3958(0x18d)](_0x5a3958(0x188),_0x5a3958(0x182)),_0x4d3e25[_0x5a3958(0x12b)](_0x5a3958(0x152));}catch(_0x29cce0){console['log'](_0x29cce0),_0x4d3e25['status'](0xc8)['json']({'message':_0x29cce0['message']});}}),router[a0_0x3a69b5(0x121)](a0_0x3a69b5(0x211),auth,async(_0x4f74a4,_0x52e163)=>{var _0x31a40b=a0_0x3a69b5;try{const {username:_0x42fc35,email:_0x3d24ab,role:_0x1b38b9}=_0x4f74a4[_0x31a40b(0x16b)],_0xe1c1fc=_0x4f74a4[_0x31a40b(0x16b)],_0x40c2a6=await profile[_0x31a40b(0x134)]({'email':_0xe1c1fc['email']}),_0x13dafc=await master_shop[_0x31a40b(0x1d2)](),_0x443d65=_0x4f74a4[_0x31a40b(0x17d)]['id'],_0x8e7636=await purchases[_0x31a40b(0x12e)](_0x443d65);if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x1ea))var _0x437458=users[_0x31a40b(0x219)];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x10f))var _0x437458=users[_0x31a40b(0x10f)];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x111))var _0x437458=users[_0x31a40b(0x111)];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x146))var _0x437458=users['Spanish'];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]=='French')var _0x437458=users[_0x31a40b(0x184)];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x1b2))var _0x437458=users[_0x31a40b(0x142)];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x119))var _0x437458=users[_0x31a40b(0x119)];else{if(_0x13dafc[0x0][_0x31a40b(0x1bf)]==_0x31a40b(0x159))var _0x437458=users[_0x31a40b(0x1e8)];}}}}}}}_0x52e163[_0x31a40b(0x148)]('all_purchases_barcode',{'success':_0x4f74a4[_0x31a40b(0x18d)](_0x31a40b(0x188)),'errors':_0x4f74a4[_0x31a40b(0x18d)](_0x31a40b(0x1c0)),'role':_0xe1c1fc,'profile':_0x40c2a6,'alldata':_0x8e7636,'master_shop':_0x13dafc,'language':_0x437458}),console[_0x31a40b(0x1ed)](alldata);}catch(_0x383199){console[_0x31a40b(0x1ed)](_0x383199);}}),router[a0_0x3a69b5(0x179)](a0_0x3a69b5(0x1cc),async(_0x166845,_0x5aa051)=>{var _0x7a4449=a0_0x3a69b5;const {product_code:_0x29fdc0}=_0x166845[_0x7a4449(0x1b7)];var _0x5a5b8a;const _0x3246d3=await product['aggregate']([{'$match':{'primary_code':_0x29fdc0,'product_category':_0x7a4449(0x1b8)}},{'$group':{'_id':_0x7a4449(0x1ab),'name':{'$first':_0x7a4449(0x1ca)},'category':{'$first':_0x7a4449(0x202)},'brand':{'$first':'$brand'},'unit':{'$first':_0x7a4449(0x198)},'alertquantity':{'$first':_0x7a4449(0x14b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x7a4449(0x176)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x7a4449(0x17b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x7a4449(0x1a2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x490bff=await product[_0x7a4449(0x14c)]([{'$match':{'secondary_code':_0x29fdc0,'product_category':_0x7a4449(0x1b8)}},{'$group':{'_id':_0x7a4449(0x1ab),'name':{'$first':_0x7a4449(0x1ca)},'category':{'$first':'$category'},'brand':{'$first':_0x7a4449(0x21f)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x7a4449(0x14b)},'product_code':{'$first':_0x7a4449(0x195)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x7a4449(0x176)},'maxStocks':{'$first':_0x7a4449(0x122)},'maxProdPerUnit':{'$first':_0x7a4449(0x17b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3246d3[_0x7a4449(0x21b)]>0x0)_0x5a5b8a=_0x3246d3;else _0x490bff['length']>0x0&&(_0x5a5b8a=_0x490bff);_0x5aa051[_0x7a4449(0x18f)](_0x5a5b8a);}),router[a0_0x3a69b5(0x179)](a0_0x3a69b5(0x1c4),async(_0x3e0be9,_0x3354c6)=>{var _0x1a679b=a0_0x3a69b5;const {primaryCode:_0x582bfb,secondaryCode:_0x456626,productCode:_0x49cf70,bay:_0x102cf0,bin:_0x3e6eb1,types:_0x2e2250,pallet:_0x490dc6,warehouses:_0x4c56fe,room:_0x32b38d}=_0x3e0be9[_0x1a679b(0x1b7)];console['log'](_0x3e0be9[_0x1a679b(0x1b7)]);try{const _0xe5b09f=await warehouse[_0x1a679b(0x14c)]([{'$match':{'name':_0x4c56fe,'room':_0x32b38d}},{'$unwind':_0x1a679b(0x114)},{'$match':{'product_details.bay':_0x102cf0,'product_details.bin':_0x3e6eb1,'product_details.type':_0x2e2250}},{'$group':{'_id':_0x1a679b(0x19f),'name':{'$first':_0x1a679b(0x15f)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x1a679b(0x193)},'isle':{'$first':_0x1a679b(0x1e2)},'pallet':{'$first':_0x1a679b(0x18e)},'maxProducts':{'$first':_0x1a679b(0x12a)}}}]);_0x3354c6[_0x1a679b(0x21c)](0xc8)[_0x1a679b(0x18f)](_0xe5b09f);}catch(_0x593a96){_0x3354c6[_0x1a679b(0x21c)](0x194)[_0x1a679b(0x18f)]({'message':_0x593a96['message']});}}),module[a0_0x3a69b5(0x1bb)]=router;