var a0_0x36a308=a0_0x33e3;(function(_0x15b68c,_0x32e782){var _0x357e6b=a0_0x33e3,_0x201fb3=_0x15b68c();while(!![]){try{var _0x3730e7=-parseInt(_0x357e6b(0x23e))/0x1*(-parseInt(_0x357e6b(0x20b))/0x2)+parseInt(_0x357e6b(0x2be))/0x3*(parseInt(_0x357e6b(0x2e5))/0x4)+parseInt(_0x357e6b(0x1ec))/0x5*(-parseInt(_0x357e6b(0x260))/0x6)+-parseInt(_0x357e6b(0x1d4))/0x7+parseInt(_0x357e6b(0x2bc))/0x8*(-parseInt(_0x357e6b(0x2a0))/0x9)+parseInt(_0x357e6b(0x295))/0xa*(-parseInt(_0x357e6b(0x22b))/0xb)+parseInt(_0x357e6b(0x1f1))/0xc;if(_0x3730e7===_0x32e782)break;else _0x201fb3['push'](_0x201fb3['shift']());}catch(_0xea6a75){_0x201fb3['push'](_0x201fb3['shift']());}}}(a0_0x3569,0xb9d22));function a0_0x3569(){var _0x5934de=['\x20Order\x20Number\x20:\x20','warehouse','Enclosed','payment\x20successfull','/../public','MaxStocks_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_qty','add_purchases','$name','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$suppliers_docs','room','/invoice/:id','<tr>','</tr>','/barcode/:id','params','floorlevel','json','length','$product_details.rack','random','prod_cat','$warehouse_name','edit_purchases','$product_details.product_code','warehouse_name','</table>','edit_purchases_view','purchase_quantity','$product_details.bay','role','secondary_code','$product_details.floorlevel','nodemailer','$product_details.secondary_code','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','\x20<\x20wew\x20>\x20','13593110EOiDWH','$product_details.product_stock','room_name','abs','</span>','Level','$product.quantity','product','prod_pallet','getMonth','<tbody\x20style=\x22text-align:\x20center;\x22>','1125IUCDEa','$secondary_unit','master','An\x20error\x20occurred.','/view','$product.bay','product_stock','<table\x20style=\x22width:\x20100%\x20!important;\x22>','host','then','port','Rack\x20F','$product_details.storage','rak','Rack\x20E','Spanish','Rack\x20D','findOne','</h5>','<html><head><title></title>','Raw\x20Materials','level','forEach','date','Return\x20Goods','German','createTransport','standard_unit','83432pNSlOF','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','3453ACuGav','map','product_cat','product_code_hide','save','all','POnumber','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<span\x20style=\x22float:\x20right;\x22>','Chinese','email','Enabled','/barcode_scanner','suppliers','prod_code','$product.room_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','user','purchase_invoice','$product_details.type','due_amount','expiry_date','RoomAssign','site_title','render','</td>','$_id','</thead>','maxperunit','Rack\x20C','</head><body>','prod_Qty','primary_code_hide','actual_qty','/preview/:id','return_product','Rack\x20B','1212tHCbgQ','<h5>','Portuguese\x20(BR)','find','<h5\x20style=\x22text-align:\x20left;\x22>','</body></html>','Sales\x20Update\x20successfully','$return_data','language','alertQTY','get','ejs','stock_quantity','$alertquantity','English','success','6834506TUulVA','bay','/CheckingWarehouse','$suppliers','../middleware/auth','delivery_code','path','currency_placement','padStart','name','Purchase\x20data\x20added\x20successfully','Hindi','body','$unit','filter','all_purchases_barcode','return_qty','Room_name','storage','\x20Order\x20Date\x20:\x20','status','isle','<!DOCTYPE\x20html>','$finalize','515030tEftmz','$product','COLD\x20STORAGE','batch_code','return_data','37909812tsaclS','push','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$secondary_code','$batch_code','user_id','$room','redirect','floor','$brand','\x20<>\x20','purchases\x20item\x20return\x20successfull','/view/add_purchases/:id','secondary_unit','DRY\x20STORAGE','Rack\x20A','product_details','../public/language/languages.json','error','prod_unit','Arabic\x20(ae)','Portuguese','max_product_unit','Receiving\x20Area','</tbody>','product_code','1098524ulpbqg','delivery_date','getFullYear','invoice','paid_amount','add_purchases\x20error','back','$product.bin','$product.type','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$category','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','image','prod_level','$product_details','getDate','Purchase\x20Mail','actual_uom','slice','</div>','gmail','type','suppliers_docs','English\x20(US)','$invoice','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','production_date','Error\x20Occurs','$product_details.product_name','11Ipkpja','purchase\x20data\x20update\x20successfully','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','stock_data','$maxProdPerUnit','$date','post','quantity','Logo.png','$product_details.primary_code','here','prod_secondunit','secondary_code_hide','Arabic','primary_code','/all_purchases/view/','currency','/all_purchases/view','2FsdRrf','prod_invoice','pallet','deliverycode','errors','product_name','prod_name','$product.floorlevel','$product_code','password','flash','maxStocks','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<div>','Email\x20sent\x20successfully','Shelves','INC-','note','bin','JO_number','$product_details.bin','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','logo','Ambient','$expiry_date','$primary_code','$paid_amount','/view/add_purchases','sendMail','Purchase\x20Return','$product_details._id','French','\x20</h2>','12DiSYNW','/view/return_purchase/:id','True','finalize','Floor','findById','$note','staff','aggregate','/give_payment/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','types'];a0_0x3569=function(){return _0x5934de;};return a0_0x3569();}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x36a308(0x1d8)),nodemailer=require(a0_0x36a308(0x290));var ejs=require(a0_0x36a308(0x2f0));const path=require(a0_0x36a308(0x1da)),users=require(a0_0x36a308(0x202));router['get'](a0_0x36a308(0x2a4),auth,async(_0x548f2a,_0x5444e5)=>{var _0x210b97=a0_0x36a308;try{const {username:_0x51169f,email:_0x37b686,role:_0x19b6da}=_0x548f2a[_0x210b97(0x2d1)],_0x54fbe1=_0x548f2a['user'],_0x3b3c15=await profile['findOne']({'email':_0x54fbe1[_0x210b97(0x2ca)]}),_0xd36bb2=await staff[_0x210b97(0x2b1)]({'email':_0x54fbe1[_0x210b97(0x2ca)]});if(_0x54fbe1[_0x210b97(0x28d)]==_0x210b97(0x267)){const _0x1ee8a2=await staff[_0x210b97(0x2b1)]({'email':_0x54fbe1[_0x210b97(0x2ca)]});}const _0x1c6226=await master_shop['find']();let _0x1a3e08;if(_0x54fbe1['role']=='staff'){const _0x28c68b=await staff['findOne']({'email':_0x54fbe1[_0x210b97(0x2ca)]});_0x1a3e08=await purchases['aggregate']([{'$match':{'warehouse_name':_0x28c68b[_0x210b97(0x26d)]}},{'$lookup':{'from':_0x210b97(0x2cd),'localField':_0x210b97(0x2cd),'foreignField':_0x210b97(0x1dd),'as':_0x210b97(0x223)}},{'$unwind':_0x210b97(0x278)},{'$unwind':_0x210b97(0x1ed)},{'$group':{'_id':_0x210b97(0x2da),'invoice':{'$first':_0x210b97(0x225)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x210b97(0x231)},'warehouse_name':{'$first':_0x210b97(0x285)},'room':{'$first':_0x210b97(0x1f7)},'product':{'$push':'$product'},'note':{'$first':_0x210b97(0x266)},'paid_amount':{'$first':_0x210b97(0x259)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x210b97(0x1f5)},'expiry_date':{'$first':_0x210b97(0x257)},'suppliers_docs':{'$first':_0x210b97(0x278)},'total_product_quantity':{'$sum':_0x210b97(0x29b)},'level':{'$addToSet':_0x210b97(0x2a5)},'isle':{'$addToSet':_0x210b97(0x212)},'type':{'$addToSet':_0x210b97(0x213)},'floorlevel':{'$addToSet':_0x210b97(0x245)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1a3e08=await purchases['aggregate']([{'$lookup':{'from':_0x210b97(0x2cd),'localField':'suppliers','foreignField':_0x210b97(0x1dd),'as':'suppliers_docs'}},{'$unwind':_0x210b97(0x278)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x210b97(0x225)},'suppliers':{'$first':_0x210b97(0x1d7)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x210b97(0x285)},'room':{'$addToSet':_0x210b97(0x2cf)},'product':{'$push':_0x210b97(0x1ed)},'note':{'$first':_0x210b97(0x266)},'paid_amount':{'$first':_0x210b97(0x259)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x210b97(0x2ec)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x210b97(0x257)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x210b97(0x29b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x210b97(0x212)},'type':{'$addToSet':_0x210b97(0x213)},'floorlevel':{'$addToSet':_0x210b97(0x245)},'finalize':{'$first':_0x210b97(0x1eb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1c6226[0x0][_0x210b97(0x2ed)]==_0x210b97(0x224)){var _0x4708aa=users[_0x210b97(0x1d2)];console[_0x210b97(0x24a)](_0x4708aa);}else{if(_0x1c6226[0x0][_0x210b97(0x2ed)]=='Hindi')var _0x4708aa=users[_0x210b97(0x1df)];else{if(_0x1c6226[0x0]['language']==_0x210b97(0x2b9))var _0x4708aa=users[_0x210b97(0x2b9)];else{if(_0x1c6226[0x0][_0x210b97(0x2ed)]=='Spanish')var _0x4708aa=users[_0x210b97(0x2af)];else{if(_0x1c6226[0x0][_0x210b97(0x2ed)]==_0x210b97(0x25e))var _0x4708aa=users[_0x210b97(0x25e)];else{if(_0x1c6226[0x0]['language']=='Portuguese\x20(BR)')var _0x4708aa=users[_0x210b97(0x206)];else{if(_0x1c6226[0x0][_0x210b97(0x2ed)]=='Chinese')var _0x4708aa=users[_0x210b97(0x2c9)];else{if(_0x1c6226[0x0][_0x210b97(0x2ed)]==_0x210b97(0x205))var _0x4708aa=users[_0x210b97(0x239)];}}}}}}}_0x5444e5['render']('all_purchases',{'success':_0x548f2a[_0x210b97(0x248)](_0x210b97(0x1d3)),'errors':_0x548f2a['flash'](_0x210b97(0x242)),'purchases':_0x1a3e08,'role':_0x54fbe1,'profile':_0x3b3c15,'master_shop':_0x1c6226,'language':_0x4708aa});}catch(_0x152a48){console[_0x210b97(0x24a)]('table\x20page',_0x152a48),_0x5444e5[_0x210b97(0x1e8)](0xc8)['json']({'message':_0x152a48[_0x210b97(0x276)]});}});function BayBinSelected(_0x1c40f8,_0x121a46){var _0x5376a3=a0_0x36a308,_0x34deda=[],_0x26f29a=[],_0x615b56=[],_0x36ff94=[],_0x148fb1=[],_0x4ef591=[];let _0x312484=[];if(_0x1c40f8==_0x5376a3(0x1ff))switch(_0x121a46){case'Rack\x20A':_0x34deda=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x26f29a=[0x1,0x2],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=[_0x5376a3(0x29a),_0x5376a3(0x264)],_0x148fb1=['D'],_0x4ef591=['A'];break;case _0x5376a3(0x2e4):_0x34deda=[0x6,0x5,0x4,0x3,0x2,0x1],_0x26f29a=[0x1,0x2],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=['Level',_0x5376a3(0x264)],_0x148fb1=['D'],_0x4ef591=['B'];break;case _0x5376a3(0x24e):_0x34deda=[0x0],_0x26f29a=[0x0],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=[_0x5376a3(0x264)],_0x148fb1=['D'],_0x4ef591=['S'];break;case _0x5376a3(0x208):_0x34deda=[0x0],_0x26f29a=[0x0],_0x36ff94=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x615b56=[_0x5376a3(0x264)],_0x148fb1=['D'],_0x4ef591=['R'];break;}else{if(_0x1c40f8==_0x5376a3(0x1ee))switch(_0x121a46){case _0x5376a3(0x200):_0x34deda=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x26f29a=['B','F'],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=['Level',_0x5376a3(0x264)],_0x148fb1=['C'],_0x4ef591=['A'];break;case _0x5376a3(0x2e4):_0x34deda=[0x5,0x4,0x3,0x2,0x1],_0x26f29a=['F','B','S'],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=[_0x5376a3(0x29a),_0x5376a3(0x264)],_0x148fb1=['C'],_0x4ef591=['B'];break;case _0x5376a3(0x2dd):_0x34deda=[0x1,0x2,0x3,0x4,0x5],_0x26f29a=['B','F','S'],_0x36ff94=[0x5,0x4,0x3,0x2,0x1],_0x615b56=['Level',_0x5376a3(0x264)],_0x148fb1=['C'],_0x4ef591=['C'];break;case _0x5376a3(0x2b0):_0x34deda=[0x5,0x4,0x3,0x2,0x1],_0x26f29a=['F','B','S'],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=[_0x5376a3(0x29a),_0x5376a3(0x264)],_0x148fb1=['C'],_0x4ef591=['D'];break;case _0x5376a3(0x2ae):_0x34deda=[0x4,0x3,0x2,0x1],_0x26f29a=[0x1,0x2],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=['Level',_0x5376a3(0x264)],_0x148fb1=['C'],_0x4ef591=['E'];break;case _0x5376a3(0x2ab):_0x34deda=[0x1,0x2,0x3],_0x26f29a=[0x1,0x2],_0x36ff94=[0x1,0x2,0x3,0x4,0x5],_0x615b56=[_0x5376a3(0x29a)],_0x148fb1=['C'],_0x4ef591=['F'];break;}}return{'levels':_0x34deda,'Isle':_0x26f29a,'rack':_0x36ff94,'type':_0x615b56,'storage':_0x148fb1,'rak':_0x4ef591};}async function getRandom8DigitNumber(){var _0x45be18=a0_0x36a308;const _0x105f49=0x989680,_0x2d653d=0x5f5e0ff,_0x1e8196=Math[_0x45be18(0x1f9)](Math[_0x45be18(0x283)]()*(_0x2d653d-_0x105f49+0x1))+_0x105f49;var _0x15b478;const _0x1fcb7e=await purchases['findOne']({'invoice':'INC-'+_0x1e8196});return _0x1fcb7e&&_0x1fcb7e['length']>0x0?_0x15b478='INC-'+_0x1e8196:_0x15b478=_0x45be18(0x24f)+_0x1e8196,_0x15b478;}function a0_0x33e3(_0x5a2c57,_0x579060){var _0x356959=a0_0x3569();return a0_0x33e3=function(_0x33e3ed,_0x49f549){_0x33e3ed=_0x33e3ed-0x1d1;var _0x22ce19=_0x356959[_0x33e3ed];return _0x22ce19;},a0_0x33e3(_0x5a2c57,_0x579060);}router[a0_0x36a308(0x2ef)](a0_0x36a308(0x25a),auth,async(_0x37f73c,_0x51989c)=>{var _0x7d1d30=a0_0x36a308;try{const {username:_0x5614fc,email:_0x335372,role:_0x58be68}=_0x37f73c[_0x7d1d30(0x2d1)],_0x343ae5=_0x37f73c[_0x7d1d30(0x2d1)],_0x196c2d=await profile[_0x7d1d30(0x2b1)]({'email':_0x343ae5[_0x7d1d30(0x2ca)]}),_0x1d2406=await master_shop[_0x7d1d30(0x2e8)](),_0x501477=await staff[_0x7d1d30(0x2b1)]({'email':_0x343ae5[_0x7d1d30(0x2ca)]}),_0x5b073f=await suppliers[_0x7d1d30(0x2e8)]({});let _0x6887aa;if(_0x343ae5['role']=='staff'){const _0x3b56d0=await staff[_0x7d1d30(0x2b1)]({'email':_0x343ae5['email']});_0x6887aa=await warehouse[_0x7d1d30(0x268)]([{'$match':{'status':_0x7d1d30(0x2cb),'name':_0x3b56d0[_0x7d1d30(0x26d)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x7d1d30(0x2b8)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x6887aa=await warehouse[_0x7d1d30(0x268)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x7d1d30(0x2b8)}}},{'$group':{'_id':_0x7d1d30(0x275),'name':{'$first':'$name'}}}]);const _0x57e6c3=await product[_0x7d1d30(0x2e8)]({}),_0x2afa9c=await warehouse[_0x7d1d30(0x2e8)]({'status':_0x7d1d30(0x2cb)}),_0x49f3c3=await purchases[_0x7d1d30(0x2e8)]({}),_0x3605a6=_0x49f3c3[_0x7d1d30(0x281)]+0x1,_0x3be9f2=_0x7d1d30(0x24f)+_0x3605a6['toString']()[_0x7d1d30(0x1dc)](0x5,'0');var _0x2db775=[_0x7d1d30(0x256),_0x7d1d30(0x26e)];if(_0x1d2406[0x0][_0x7d1d30(0x2ed)]==_0x7d1d30(0x224))var _0x5a469a=users['English'];else{if(_0x1d2406[0x0][_0x7d1d30(0x2ed)]==_0x7d1d30(0x1df))var _0x5a469a=users[_0x7d1d30(0x1df)];else{if(_0x1d2406[0x0][_0x7d1d30(0x2ed)]=='German')var _0x5a469a=users[_0x7d1d30(0x2b9)];else{if(_0x1d2406[0x0][_0x7d1d30(0x2ed)]==_0x7d1d30(0x2af))var _0x5a469a=users[_0x7d1d30(0x2af)];else{if(_0x1d2406[0x0]['language']==_0x7d1d30(0x25e))var _0x5a469a=users[_0x7d1d30(0x25e)];else{if(_0x1d2406[0x0][_0x7d1d30(0x2ed)]==_0x7d1d30(0x2e7))var _0x5a469a=users[_0x7d1d30(0x206)];else{if(_0x1d2406[0x0][_0x7d1d30(0x2ed)]=='Chinese')var _0x5a469a=users[_0x7d1d30(0x2c9)];else{if(_0x1d2406[0x0]['language']==_0x7d1d30(0x205))var _0x5a469a=users['Arabic'];}}}}}}}const _0x232aee=getRandom8DigitNumber();_0x232aee[_0x7d1d30(0x2a9)](_0x506cd2=>{var _0x1a7865=_0x7d1d30;_0x51989c[_0x1a7865(0x2d8)](_0x1a7865(0x274),{'success':_0x37f73c[_0x1a7865(0x248)](_0x1a7865(0x1d3)),'errors':_0x37f73c[_0x1a7865(0x248)]('errors'),'role':_0x343ae5,'profile':_0x196c2d,'suppliers':_0x5b073f,'warehouse':_0x6887aa,'product':_0x57e6c3,'invoice':_0x506cd2,'master_shop':_0x1d2406,'language':_0x5a469a,'find_data':_0x2afa9c,'rooms_data':_0x2db775});})[_0x7d1d30(0x214)](_0x26b8c6=>{var _0x1fa693=_0x7d1d30;_0x37f73c[_0x1fa693(0x248)](_0x1fa693(0x242),_0x1fa693(0x1f3)),_0x51989c[_0x1fa693(0x1f8)](_0x1fa693(0x23d));});}catch(_0x1c7a3a){console['log'](_0x1c7a3a);}}),router['get'](a0_0x36a308(0x1fd),auth,async(_0x4045ba,_0xedeb8e)=>{var _0x3972f1=a0_0x36a308;try{const _0x13b9f0=_0x4045ba[_0x3972f1(0x27e)]['id'];console[_0x3972f1(0x24a)](_0x13b9f0);const _0x12f302=await master_shop[_0x3972f1(0x2e8)]();console[_0x3972f1(0x24a)](_0x3972f1(0x2a2),_0x12f302);const _0x516e02=await product[_0x3972f1(0x2b1)]({'name':_0x13b9f0});console[_0x3972f1(0x24a)](_0x3972f1(0x29c),_0x516e02),_0xedeb8e['status'](0xc8)[_0x3972f1(0x280)]({'product_data':_0x516e02,'master':_0x12f302});}catch(_0x5c5ba7){console[_0x3972f1(0x24a)](_0x3972f1(0x210),_0x5c5ba7);}}),router[a0_0x36a308(0x232)](a0_0x36a308(0x25a),auth,async(_0x4b888e,_0x4ca7bf)=>{var _0x55a5f1=a0_0x36a308;try{const {invoice:_0x261b34,date:_0x5c6cf7,warehouse_name:_0x1823c8,prod_name:_0x3b87f3,prod_code:_0x4253df,prod_qty:_0x143d46,prod_unit:_0x2fb19d,prod_secondunit:_0x2389bd,prod_level:_0x26dc88,prod_isle:_0x5b0213,prod_pallet:_0x3129bf,note:_0x5b1497,expiry_date:_0x406544,batch_code:_0x32a797,payable:_0x47f5da,due_amount:_0xb7f8b9,Room_name:_0x12aac0,primary_code:_0x250e41,secondary_code:_0x2348e0,MaxStocks_data:_0x1f3c7b,PO_number:_0x29cb37,SCRN:_0x4ae8d7,JO_number:_0xb5caab}=_0x4b888e[_0x55a5f1(0x1e0)];if(typeof _0x3b87f3==_0x55a5f1(0x22d))var _0x112c36=[_0x4b888e['body']['prod_name']],_0x5ef653=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2ce)]],_0x2060ae=[_0x4b888e['body'][_0x55a5f1(0x2df)]],_0x4c033f=[_0x4b888e['body']['prod_primunit']],_0x3dccde=[_0x4b888e[_0x55a5f1(0x1e0)]['prod_secondunit']],_0x4a4980=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x21a)]],_0x43843a=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x23a)]],_0x2e5ee5=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x28e)]],_0x58d0b8=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x271)]],_0x12fb46=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x1ef)]],_0x27b345=[_0x4b888e[_0x55a5f1(0x1e0)]['expiry_date']],_0x38c418=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x207)]],_0x28c65a=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2ee)]],_0x4f37c6=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x228)]],_0x2fc16d=[_0x4b888e['body']['prod_cat']],_0xdc8a81=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2d6)]],_0x50d238=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x241)]],_0x54984d=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x23f)]],_0x268b83=[_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2e1)]],_0x1c7ab3=[_0x4b888e[_0x55a5f1(0x1e0)]['actual_uom']];else var _0x112c36=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x244)]],_0x5ef653=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2ce)]],_0x2060ae=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2df)]],_0x4c033f=[..._0x4b888e[_0x55a5f1(0x1e0)]['prod_primunit']],_0x3dccde=[..._0x4b888e['body']['prod_secondunit']],_0x4a4980=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x21a)]],_0x43843a=[..._0x4b888e[_0x55a5f1(0x1e0)]['primary_code']],_0x2e5ee5=[..._0x4b888e[_0x55a5f1(0x1e0)]['secondary_code']],_0x58d0b8=[..._0x4b888e[_0x55a5f1(0x1e0)]['MaxStocks_data']],_0x12fb46=[..._0x4b888e[_0x55a5f1(0x1e0)]['batch_code']],_0x27b345=[..._0x4b888e['body'][_0x55a5f1(0x2d5)]],_0x38c418=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x207)]],_0x28c65a=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2ee)]],_0x4f37c6=[..._0x4b888e['body']['production_date']],_0x2fc16d=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x284)]],_0xdc8a81=[..._0x4b888e['body'][_0x55a5f1(0x2d6)]],_0x50d238=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x241)]],_0x54984d=[..._0x4b888e[_0x55a5f1(0x1e0)]['prod_invoice']],_0x268b83=[..._0x4b888e['body']['actual_qty']],_0x1c7ab3=[..._0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x21e)]];const _0x5445df=_0x112c36[_0x55a5f1(0x2bf)](_0x25a7fe=>{return _0x25a7fe={'product_name':_0x25a7fe};});_0x268b83[_0x55a5f1(0x2b6)]((_0x573dc2,_0x22baea)=>{var _0x4bc0c3=_0x55a5f1;_0x5445df[_0x22baea][_0x4bc0c3(0x2e1)]=Math[_0x4bc0c3(0x298)](_0x573dc2);}),_0x1c7ab3['forEach']((_0x321aa4,_0x8434d3)=>{var _0x2380d3=_0x55a5f1;_0x5445df[_0x8434d3][_0x2380d3(0x21e)]=_0x321aa4;}),_0x5ef653['forEach']((_0x23769a,_0x1399c3)=>{var _0x251504=_0x55a5f1;_0x5445df[_0x1399c3][_0x251504(0x20a)]=_0x23769a;}),_0x2060ae[_0x55a5f1(0x2b6)]((_0x4e2ff1,_0x2c9a21)=>{var _0x4d0e42=_0x55a5f1;_0x5445df[_0x2c9a21][_0x4d0e42(0x233)]=Math['abs'](_0x4e2ff1);}),_0x4c033f[_0x55a5f1(0x2b6)]((_0x51429f,_0x27b952)=>{var _0x5bd395=_0x55a5f1;_0x5445df[_0x27b952][_0x5bd395(0x2bb)]=_0x51429f;}),_0x3dccde[_0x55a5f1(0x2b6)]((_0x303b96,_0x513790)=>{_0x5445df[_0x513790]['secondary_unit']=_0x303b96;}),_0x4a4980[_0x55a5f1(0x2b6)]((_0x27da62,_0x4f44bc)=>{var _0x54deb4=_0x55a5f1;_0xdc8a81[_0x54deb4(0x2b6)]((_0x2abe16,_0x3e2bb0)=>{var _0x577efe=_0x54deb4;if(_0x2abe16==_0x577efe(0x208)&&_0x4f44bc==_0x3e2bb0){console[_0x577efe(0x24a)](_0x2abe16+_0x577efe(0x294)+_0x4f44bc+_0x577efe(0x1fb)+_0x3e2bb0+_0x577efe(0x1fb)+_0x27da62);var _0x509e87=_0x27da62[_0x577efe(0x21f)](0x3);_0x5445df[_0x4f44bc][_0x577efe(0x1e6)]=_0x27da62[0x0],_0x5445df[_0x4f44bc][_0x577efe(0x226)]=_0x27da62[0x1],_0x5445df[_0x4f44bc][_0x577efe(0x1d5)]=0x0,_0x5445df[_0x4f44bc][_0x577efe(0x251)]=0x0,_0x5445df[_0x4f44bc][_0x577efe(0x222)]=_0x577efe(0x264),_0x5445df[_0x4f44bc][_0x577efe(0x27f)]=_0x509e87;}else{if(_0x2abe16==_0x577efe(0x24e)&&_0x4f44bc==_0x3e2bb0){var _0x509e87=_0x27da62[_0x577efe(0x21f)](0x3);_0x5445df[_0x4f44bc][_0x577efe(0x1e6)]=_0x27da62[0x0],_0x5445df[_0x4f44bc][_0x577efe(0x226)]=_0x27da62[0x1],_0x5445df[_0x4f44bc]['bay']=0x0,_0x5445df[_0x4f44bc][_0x577efe(0x251)]=0x0,_0x5445df[_0x4f44bc][_0x577efe(0x222)]='Floor',_0x5445df[_0x4f44bc][_0x577efe(0x27f)]=_0x27da62[0x5];}else{if(_0x4f44bc==_0x3e2bb0){if(_0x27da62[0x0]=='A'&&_0x27da62[0x1]=='L'&&_0x27da62[0x2]=='L')console[_0x577efe(0x24a)](_0x2abe16+_0x577efe(0x1fb)+_0x4f44bc+_0x577efe(0x1fb)+_0x3e2bb0+'\x20<>\x20'+_0x27da62+_0x577efe(0x236)),_0x5445df[_0x4f44bc]['storage']=_0x27da62[0x0],_0x5445df[_0x4f44bc][_0x577efe(0x226)]=_0x27da62[0x1],_0x5445df[_0x4f44bc][_0x577efe(0x1d5)]=0x0,_0x5445df[_0x4f44bc][_0x577efe(0x251)]=0x0,_0x5445df[_0x4f44bc]['type']=_0x577efe(0x264),_0x5445df[_0x4f44bc][_0x577efe(0x27f)]=_0x27da62[0x3];else{var _0x149892;if(_0x27da62[0x4]=='L')_0x149892='Level';else _0x27da62[0x4]=='F'&&(_0x149892='Floor');_0x5445df[_0x4f44bc][_0x577efe(0x1e6)]=_0x27da62[0x0],_0x5445df[_0x4f44bc][_0x577efe(0x226)]=_0x27da62[0x1],_0x5445df[_0x4f44bc][_0x577efe(0x1d5)]=_0x27da62[0x2],_0x5445df[_0x4f44bc][_0x577efe(0x251)]=_0x27da62[0x3],_0x5445df[_0x4f44bc][_0x577efe(0x222)]=_0x149892,_0x5445df[_0x4f44bc][_0x577efe(0x27f)]=_0x27da62[0x5];}}}}});}),_0x43843a['forEach']((_0x1cfd95,_0x5dc37f)=>{var _0x5512e3=_0x55a5f1;_0x5445df[_0x5dc37f][_0x5512e3(0x23a)]=_0x1cfd95;}),_0x2e5ee5[_0x55a5f1(0x2b6)]((_0x579fc2,_0x10b2f9)=>{var _0x3d17c3=_0x55a5f1;_0x5445df[_0x10b2f9][_0x3d17c3(0x28e)]=_0x579fc2;}),_0x58d0b8[_0x55a5f1(0x2b6)]((_0x3f0915,_0x618c8a)=>{_0x5445df[_0x618c8a]['maxStocks']=_0x3f0915;}),_0x12fb46[_0x55a5f1(0x2b6)]((_0xa9be39,_0xebb48e)=>{var _0x7b10ca=_0x55a5f1;_0x5445df[_0xebb48e][_0x7b10ca(0x1ef)]=_0xa9be39;}),_0x27b345[_0x55a5f1(0x2b6)]((_0x3ced64,_0x394093)=>{var _0x12c3f1=_0x55a5f1;_0x5445df[_0x394093][_0x12c3f1(0x2d5)]=_0x3ced64;}),_0x38c418[_0x55a5f1(0x2b6)]((_0x3c1dfa,_0x4973cd)=>{var _0x45814f=_0x55a5f1;_0x5445df[_0x4973cd][_0x45814f(0x2dc)]=_0x3c1dfa;}),_0x28c65a[_0x55a5f1(0x2b6)]((_0x1875d5,_0x2860c4)=>{var _0x56d0c3=_0x55a5f1;_0x5445df[_0x2860c4][_0x56d0c3(0x2ee)]=_0x1875d5;}),_0x4f37c6[_0x55a5f1(0x2b6)]((_0x363020,_0x4a62f9)=>{var _0x225414=_0x55a5f1;_0x5445df[_0x4a62f9][_0x225414(0x228)]=_0x363020;}),_0x2fc16d[_0x55a5f1(0x2b6)]((_0x20db38,_0x4044b7)=>{_0x5445df[_0x4044b7]['product_cat']=_0x20db38;}),_0xdc8a81[_0x55a5f1(0x2b6)]((_0x49e907,_0x1e6d40)=>{_0x5445df[_0x1e6d40]['room_name']=_0x49e907;}),_0x50d238['forEach']((_0x290d2a,_0x17099c)=>{_0x5445df[_0x17099c]['delivery_code']=_0x290d2a;}),_0x54984d['forEach']((_0x1ce907,_0x3d465b)=>{var _0x4b2d5b=_0x55a5f1;_0x5445df[_0x3d465b][_0x4b2d5b(0x20e)]=_0x1ce907;});const _0x538f5b=_0xdc8a81['map'](_0x9042f2=>{return _0x9042f2={'room_name':_0x9042f2};}),_0x31df30=_0x5445df[_0x55a5f1(0x1e2)](_0x35d5f1=>_0x35d5f1[_0x55a5f1(0x233)]!=='0'&&_0x35d5f1[_0x55a5f1(0x233)]!==''),_0x1b75ad=new purchases({'invoice':_0x261b34,'suppliers':_0x4b888e[_0x55a5f1(0x1e0)][_0x55a5f1(0x2cd)],'date':_0x5c6cf7,'warehouse_name':_0x1823c8,'product':_0x31df30,'note':_0x5b1497,'due_amount':_0xb7f8b9,'POnumber':_0x29cb37,'SCRN':_0x4ae8d7,'JO_number':_0xb5caab,'roomList':_0x538f5b}),_0x302583=await _0x1b75ad['save'](),_0x5254d5=await purchases[_0x55a5f1(0x2b1)]({'invoice':_0x261b34}),_0x3fd2fc=_0x5254d5[_0x55a5f1(0x29c)][_0x55a5f1(0x2bf)](async _0x3d8a91=>{var _0x219ddb=_0x55a5f1,_0x30be3f=await warehouse['findOne']({'name':_0x1823c8,'room':_0x3d8a91[_0x219ddb(0x297)]}),_0xe7e076=0x0;return _0x30be3f[_0x219ddb(0x201)][_0x219ddb(0x2b6)](_0x32244c=>{var _0x4f4c79=_0x219ddb;_0x32244c['product_name']==_0x3d8a91['product_name']&&_0x32244c['floorlevel']==_0x3d8a91['floorlevel']&&_0x32244c[_0x4f4c79(0x222)]==_0x3d8a91['type']&&_0x32244c[_0x4f4c79(0x251)]==_0x3d8a91[_0x4f4c79(0x251)]&&_0x32244c['bay']==_0x3d8a91['bay']&&_0x32244c[_0x4f4c79(0x226)]==_0x3d8a91['rack']&&_0x32244c[_0x4f4c79(0x1e6)]==_0x3d8a91[_0x4f4c79(0x1e6)]&&_0x32244c[_0x4f4c79(0x2d5)]==_0x3d8a91[_0x4f4c79(0x2d5)]&&_0x32244c[_0x4f4c79(0x1ef)]==_0x3d8a91[_0x4f4c79(0x1ef)]&&_0x32244c['production_date']==_0x3d8a91[_0x4f4c79(0x228)]&&_0x32244c[_0x4f4c79(0x20e)]==_0x5254d5[_0x4f4c79(0x20e)]&&(_0x32244c[_0x4f4c79(0x2a6)]+=Math[_0x4f4c79(0x298)](_0x3d8a91[_0x4f4c79(0x233)]),_0xe7e076++);}),_0xe7e076===0x0&&_0x30be3f[_0x219ddb(0x201)][_0x219ddb(0x1f2)]({'product_name':_0x3d8a91[_0x219ddb(0x243)],'product_stock':Math[_0x219ddb(0x298)](_0x3d8a91[_0x219ddb(0x233)]),'primary_code':_0x3d8a91[_0x219ddb(0x23a)],'secondary_code':_0x3d8a91[_0x219ddb(0x28e)],'product_code':_0x3d8a91[_0x219ddb(0x20a)],'storage':_0x3d8a91[_0x219ddb(0x1e6)],'rack':_0x3d8a91[_0x219ddb(0x226)],'bay':_0x3d8a91['bay'],'bin':_0x3d8a91[_0x219ddb(0x251)],'type':_0x3d8a91[_0x219ddb(0x222)],'floorlevel':_0x3d8a91[_0x219ddb(0x27f)],'maxProducts':_0x3d8a91[_0x219ddb(0x249)],'unit':_0x3d8a91['standard_unit'],'secondary_unit':_0x3d8a91[_0x219ddb(0x1fe)],'expiry_date':_0x3d8a91[_0x219ddb(0x2d5)],'maxPerUnit':_0x3d8a91[_0x219ddb(0x2dc)],'batch_code':_0x3d8a91[_0x219ddb(0x1ef)],'alertQTY':_0x3d8a91['alertQTY'],'production_date':_0x3d8a91['production_date'],'product_cat':_0x3d8a91[_0x219ddb(0x2c0)],'invoice':_0x3d8a91[_0x219ddb(0x20e)],'actual_qty':Math[_0x219ddb(0x298)](_0x3d8a91['actual_qty']),'actual_uom':_0x3d8a91[_0x219ddb(0x21e)]}),_0x30be3f;});Promise[_0x55a5f1(0x2c3)](_0x3fd2fc)[_0x55a5f1(0x2a9)](async _0xe6c01f=>{var _0x3ac7f5=_0x55a5f1;try{for(const _0x5f56a9 of _0xe6c01f){await _0x5f56a9[_0x3ac7f5(0x2c2)]();}const _0x1928b6=await master_shop['find'](),_0xedd4d=await email_settings[_0x3ac7f5(0x2b1)](),_0xf6a1e1=await supervisor_settings[_0x3ac7f5(0x2e8)]();var _0x358ce5=_0x5254d5[_0x3ac7f5(0x29c)],_0x3c6c42='',_0x548ac2;for(_0x548ac2 in _0x358ce5){_0x3c6c42+=_0x3ac7f5(0x27b)+_0x3ac7f5(0x2d0)+_0x358ce5[_0x548ac2]['product_name']+_0x3ac7f5(0x2d9)+_0x3ac7f5(0x2d0)+_0x358ce5[_0x548ac2][_0x3ac7f5(0x20a)]+_0x3ac7f5(0x2d9)+_0x3ac7f5(0x2d0)+_0x358ce5[_0x548ac2]['quantity']+'</td>'+_0x3ac7f5(0x2d0)+_0x358ce5[_0x548ac2][_0x3ac7f5(0x2bb)]+_0x3ac7f5(0x2d9)+_0x3ac7f5(0x2d0)+_0x358ce5[_0x548ac2][_0x3ac7f5(0x1fe)]+_0x3ac7f5(0x2d9)+_0x3ac7f5(0x2d0)+_0x5254d5[_0x3ac7f5(0x288)]+_0x3ac7f5(0x2d9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x358ce5[_0x548ac2][_0x3ac7f5(0x297)]+_0x3ac7f5(0x2d9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x358ce5[_0x548ac2]['storage']+_0x358ce5[_0x548ac2][_0x3ac7f5(0x226)]+_0x358ce5[_0x548ac2][_0x3ac7f5(0x1d5)]+_0x358ce5[_0x548ac2][_0x3ac7f5(0x251)]+_0x358ce5[_0x548ac2][_0x3ac7f5(0x222)][0x0]+_0x358ce5[_0x548ac2][_0x3ac7f5(0x27f)]+'</td>','</tr>';}let _0x41a157=nodemailer[_0x3ac7f5(0x2ba)]({'host':_0xedd4d[_0x3ac7f5(0x2a8)],'port':Number(_0xedd4d[_0x3ac7f5(0x2aa)]),'secure':![],'auth':{'user':_0xedd4d['email'],'pass':_0xedd4d[_0x3ac7f5(0x247)]}}),_0x5e4c99={'from':_0xedd4d[_0x3ac7f5(0x2ca)],'to':_0xf6a1e1[0x0]['RMSEmail'],'subject':_0x3ac7f5(0x21d),'attachments':[{'filename':_0x3ac7f5(0x234),'path':__dirname+_0x3ac7f5(0x270)+'/upload/'+_0x1928b6[0x0][_0x3ac7f5(0x219)],'cid':_0x3ac7f5(0x255)}],'html':_0x3ac7f5(0x1ea)+_0x3ac7f5(0x2b3)+_0x3ac7f5(0x2de)+'<div>'+_0x3ac7f5(0x26a)+_0x3ac7f5(0x24c)+_0x3ac7f5(0x272)+'</div>'+_0x3ac7f5(0x24c)+'<h2>\x20'+_0x1928b6[0x0][_0x3ac7f5(0x2d7)]+_0x3ac7f5(0x25f)+_0x3ac7f5(0x220)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x3ac7f5(0x2e9)+_0x3ac7f5(0x26c)+_0x5254d5[_0x3ac7f5(0x20e)]+'\x20'+_0x3ac7f5(0x2c8)+'\x20Order\x20Date\x20:\x20'+_0x5254d5[_0x3ac7f5(0x2b7)]+'\x20'+_0x3ac7f5(0x299)+_0x3ac7f5(0x2b2)+_0x3ac7f5(0x220)+_0x3ac7f5(0x2a7)+_0x3ac7f5(0x254)+_0x3ac7f5(0x27b)+_0x3ac7f5(0x215)+_0x3ac7f5(0x293)+_0x3ac7f5(0x2c5)+_0x3ac7f5(0x218)+_0x3ac7f5(0x24b)+_0x3ac7f5(0x2c7)+_0x3ac7f5(0x2bd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3ac7f5(0x27c)+_0x3ac7f5(0x2db)+_0x3ac7f5(0x29f)+'\x20'+_0x3c6c42+'\x20'+'</tbody>'+_0x3ac7f5(0x289)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x3ac7f5(0x2e6)+_0x1928b6[0x0][_0x3ac7f5(0x2d7)]+'</h5>'+_0x3ac7f5(0x220)+_0x3ac7f5(0x220)+_0x3ac7f5(0x2ea)};_0x41a157[_0x3ac7f5(0x25b)](_0x5e4c99,function(_0xd14936,_0x107305){var _0x4f00e0=_0x3ac7f5;_0xd14936?(console[_0x4f00e0(0x24a)](_0xd14936),console['log'](_0x4f00e0(0x229))):console[_0x4f00e0(0x24a)](_0x4f00e0(0x24d));}),_0x4b888e[_0x3ac7f5(0x248)]('success',_0x3ac7f5(0x1de)),_0x4ca7bf[_0x3ac7f5(0x1f8)](_0x3ac7f5(0x23b));}catch(_0x549cfb){console[_0x3ac7f5(0x203)](_0x549cfb),_0x4ca7bf[_0x3ac7f5(0x1e8)](0x1f4)[_0x3ac7f5(0x280)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x55a5f1(0x214)](_0x4818cf=>{var _0x49fa96=_0x55a5f1;console[_0x49fa96(0x203)](_0x4818cf),_0x4ca7bf[_0x49fa96(0x1e8)](0x1f4)[_0x49fa96(0x280)]({'error':_0x49fa96(0x2a3)});});}catch(_0x236a6b){console[_0x55a5f1(0x24a)](_0x236a6b);}}),router[a0_0x36a308(0x2ef)](a0_0x36a308(0x2e2),auth,async(_0x54e901,_0x1a396f)=>{var _0x534d79=a0_0x36a308;try{const {username:_0x163a94,email:_0x3349cb,role:_0x389275}=_0x54e901[_0x534d79(0x2d1)],_0x43bd36=_0x54e901[_0x534d79(0x2d1)],_0x559903=await profile['findOne']({'email':_0x43bd36[_0x534d79(0x2ca)]}),_0x3fef89=await master_shop[_0x534d79(0x2e8)](),_0x412fbb=_0x54e901[_0x534d79(0x27e)]['id'],_0x142b4a=await purchases[_0x534d79(0x265)](_0x412fbb),_0x1b3289=await warehouse[_0x534d79(0x268)]([{'$match':{'name':_0x142b4a['warehouse_name'],'room':_0x142b4a[_0x534d79(0x279)]}},{'$unwind':_0x534d79(0x21b)},{'$group':{'_id':_0x534d79(0x25d),'name':{'$first':_0x534d79(0x22a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x534d79(0x28c)},'bin':{'$first':_0x534d79(0x253)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x534d79(0x28f)},'primary_code':{'$first':_0x534d79(0x235)},'secondary_code':{'$first':_0x534d79(0x291)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x534d79(0x2ac)},'rack':{'$first':_0x534d79(0x282)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x33f25b=await customer[_0x534d79(0x2e8)]({});let _0x36bbd5;if(_0x43bd36[_0x534d79(0x28d)]==_0x534d79(0x267)){const _0x5d2987=await staff[_0x534d79(0x2b1)]({'email':_0x43bd36[_0x534d79(0x2ca)]});_0x36bbd5=await warehouse[_0x534d79(0x268)]([{'$match':{'status':_0x534d79(0x2cb),'name':_0x5d2987[_0x534d79(0x26d)]}},{'$group':{'_id':_0x534d79(0x275),'name':{'$first':_0x534d79(0x275)}}}]);}else _0x36bbd5=await warehouse[_0x534d79(0x268)]([{'$match':{'status':_0x534d79(0x2cb)}},{'$group':{'_id':'$name','name':{'$first':_0x534d79(0x275)}}}]);const _0x21881e=await product[_0x534d79(0x2e8)]({}),_0x500156=await suppliers[_0x534d79(0x2e8)]({}),_0x11a2c0=BayBinSelected(_0x142b4a['warehouse_name'],_0x142b4a[_0x534d79(0x279)]);if(_0x3fef89[0x0][_0x534d79(0x2ed)]==_0x534d79(0x224)){var _0x20aabf=users[_0x534d79(0x1d2)];console[_0x534d79(0x24a)](_0x20aabf);}else{if(_0x3fef89[0x0][_0x534d79(0x2ed)]==_0x534d79(0x1df))var _0x20aabf=users[_0x534d79(0x1df)];else{if(_0x3fef89[0x0][_0x534d79(0x2ed)]==_0x534d79(0x2b9))var _0x20aabf=users[_0x534d79(0x2b9)];else{if(_0x3fef89[0x0]['language']==_0x534d79(0x2af))var _0x20aabf=users[_0x534d79(0x2af)];else{if(_0x3fef89[0x0][_0x534d79(0x2ed)]==_0x534d79(0x25e))var _0x20aabf=users[_0x534d79(0x25e)];else{if(_0x3fef89[0x0][_0x534d79(0x2ed)]=='Portuguese\x20(BR)')var _0x20aabf=users[_0x534d79(0x206)];else{if(_0x3fef89[0x0][_0x534d79(0x2ed)]=='Chinese')var _0x20aabf=users['Chinese'];else{if(_0x3fef89[0x0][_0x534d79(0x2ed)]==_0x534d79(0x205))var _0x20aabf=users[_0x534d79(0x239)];}}}}}}}_0x1a396f[_0x534d79(0x2d8)](_0x534d79(0x28a),{'success':_0x54e901['flash'](_0x534d79(0x1d3)),'errors':_0x54e901[_0x534d79(0x248)]('errors'),'role':_0x43bd36,'profile':_0x559903,'customer':_0x33f25b,'warehouse':_0x36bbd5,'product':_0x1b3289,'user':_0x142b4a,'master_shop':_0x3fef89,'unit':_0x21881e,'language':_0x20aabf,'suppliers':_0x500156,'dataSelected':_0x11a2c0});}catch(_0x21d414){console[_0x534d79(0x24a)](_0x21d414);}}),router['post'](a0_0x36a308(0x2e2),auth,async(_0x213cbe,_0x117b89)=>{var _0x180d4f=a0_0x36a308;try{const _0x207c13=_0x213cbe['params']['id'],{invoice:_0x1fd429,warehouse_name:_0x2af43b,Room_name:_0x3f98ac}=_0x213cbe[_0x180d4f(0x1e0)],_0x30677b=await warehouse[_0x180d4f(0x2b1)]({'name':_0x2af43b,'room':_0x3f98ac}),_0x32510b=await purchases[_0x180d4f(0x2b1)]({'invoice':_0x1fd429});_0x32510b[_0x180d4f(0x29c)][_0x180d4f(0x2b6)](_0x3d3ef8=>{var _0x266234=_0x180d4f,_0xb664d1=0x0;const _0xef9136=_0x30677b[_0x266234(0x201)][_0x266234(0x2bf)](_0x1685d1=>{var _0x545a97=_0x266234;_0x1685d1[_0x545a97(0x243)]==_0x3d3ef8[_0x545a97(0x243)]&&_0x1685d1[_0x545a97(0x27f)]==_0x3d3ef8[_0x545a97(0x27f)]&&_0x1685d1['type']==_0x3d3ef8[_0x545a97(0x222)]&&_0x1685d1[_0x545a97(0x251)]==_0x3d3ef8['bin']&&_0x1685d1[_0x545a97(0x1d5)]==_0x3d3ef8['bay']&&_0x1685d1[_0x545a97(0x226)]==_0x3d3ef8['rack']&&_0x1685d1[_0x545a97(0x1e6)]==_0x3d3ef8[_0x545a97(0x1e6)]&&_0x1685d1[_0x545a97(0x2d5)]==_0x3d3ef8['expiry_date']&&_0x1685d1[_0x545a97(0x1ef)]==_0x3d3ef8[_0x545a97(0x1ef)]&&_0x1685d1['production_date']==_0x3d3ef8[_0x545a97(0x228)]&&_0x1685d1[_0x545a97(0x20c)]==_0x3d3ef8[_0x545a97(0x20c)]&&_0x1685d1[_0x545a97(0x1d9)]==_0x3d3ef8[_0x545a97(0x1d9)]&&(_0x1685d1[_0x545a97(0x2a6)]=parseInt(_0x1685d1[_0x545a97(0x2a6)])+parseInt(_0x3d3ef8['quantity']),_0xb664d1++);});_0xb664d1=='0'&&(_0x30677b['product_details']=_0x30677b[_0x266234(0x201)]['concat']({'product_name':_0x3d3ef8[_0x266234(0x243)],'product_stock':_0x3d3ef8['quantity'],'primary_code':_0x3d3ef8[_0x266234(0x23a)],'secondary_code':_0x3d3ef8['secondary_code'],'product_code':_0x3d3ef8['product_code'],'storage':_0x3d3ef8[_0x266234(0x1e6)],'rack':_0x3d3ef8[_0x266234(0x226)],'bay':_0x3d3ef8[_0x266234(0x1d5)],'bin':_0x3d3ef8['bin'],'type':_0x3d3ef8['type'],'floorlevel':_0x3d3ef8[_0x266234(0x27f)],'maxProducts':_0x3d3ef8[_0x266234(0x249)],'unit':_0x3d3ef8[_0x266234(0x2bb)],'secondary_unit':_0x3d3ef8['secondary_unit'],'expiry_date':_0x3d3ef8[_0x266234(0x2d5)],'maxPerUnit':_0x3d3ef8[_0x266234(0x2dc)],'batch_code':_0x3d3ef8[_0x266234(0x1ef)],'alertQTY':_0x3d3ef8['alertQTY'],'production_date':_0x3d3ef8[_0x266234(0x228)],'delivery_date':_0x3d3ef8[_0x266234(0x20c)],'delivery_code':_0x3d3ef8['delivery_code']}));}),await _0x30677b['save'](),_0x32510b[_0x180d4f(0x263)]='True';const _0x16f58d=await _0x32510b[_0x180d4f(0x2c2)]();_0x213cbe['flash'](_0x180d4f(0x1d3),_0x180d4f(0x2eb)),_0x117b89['redirect'](_0x180d4f(0x23d));}catch(_0x4ae741){console[_0x180d4f(0x24a)](_0x4ae741);}}),router[a0_0x36a308(0x2ef)](a0_0x36a308(0x292),auth,async(_0x220101,_0x438c1e)=>{var _0x241f0e=a0_0x36a308;try{const {username:_0x4024c3,email:_0x38aebc,role:_0x131119}=_0x220101[_0x241f0e(0x2d1)],_0x237e28=_0x220101[_0x241f0e(0x2d1)],_0x42dbc4=await profile[_0x241f0e(0x2b1)]({'email':_0x237e28[_0x241f0e(0x2ca)]}),_0x409acf=await master_shop['find'](),_0x784686=_0x220101[_0x241f0e(0x27e)]['id'],_0x1cfd6f=await purchases[_0x241f0e(0x265)](_0x784686),_0x38ac4a=await suppliers[_0x241f0e(0x2e8)]({});let _0x1f0555;if(_0x237e28['role']==_0x241f0e(0x267)){const _0x45ce37=await staff['findOne']({'email':_0x237e28['email']});_0x1f0555=await warehouse[_0x241f0e(0x2e8)]({'status':'Enabled','name':_0x45ce37[_0x241f0e(0x26d)],'warehouse_category':_0x241f0e(0x2b4)});}else _0x1f0555=await warehouse[_0x241f0e(0x268)]([{'$match':{'status':_0x241f0e(0x2cb),'warehouse_category':_0x241f0e(0x2b4)}},{'$group':{'_id':'$name','name':{'$first':_0x241f0e(0x275)}}}]);const _0x541e48=await product[_0x241f0e(0x2e8)]({}),_0x132881=BayBinSelected(_0x1cfd6f['warehouse_name'],_0x1cfd6f[_0x241f0e(0x279)]);let _0x31f327=new Date(_0x1cfd6f[_0x241f0e(0x2d5)]),_0x428008=('0'+_0x31f327[_0x241f0e(0x21c)]())[_0x241f0e(0x21f)](-0x2),_0x416380=('0'+(_0x31f327[_0x241f0e(0x29e)]()+0x1))[_0x241f0e(0x21f)](-0x2),_0x32de42=_0x31f327[_0x241f0e(0x20d)](),_0x2b401d=_0x32de42+'-'+_0x416380+'-'+_0x428008;if(_0x409acf[0x0][_0x241f0e(0x2ed)]=='English\x20(US)'){var _0x340607=users[_0x241f0e(0x1d2)];console[_0x241f0e(0x24a)](_0x340607);}else{if(_0x409acf[0x0][_0x241f0e(0x2ed)]==_0x241f0e(0x1df))var _0x340607=users['Hindi'];else{if(_0x409acf[0x0][_0x241f0e(0x2ed)]=='German')var _0x340607=users['German'];else{if(_0x409acf[0x0][_0x241f0e(0x2ed)]=='Spanish')var _0x340607=users['Spanish'];else{if(_0x409acf[0x0]['language']=='French')var _0x340607=users[_0x241f0e(0x25e)];else{if(_0x409acf[0x0]['language']==_0x241f0e(0x2e7))var _0x340607=users[_0x241f0e(0x206)];else{if(_0x409acf[0x0][_0x241f0e(0x2ed)]==_0x241f0e(0x2c9))var _0x340607=users['Chinese'];else{if(_0x409acf[0x0][_0x241f0e(0x2ed)]==_0x241f0e(0x205))var _0x340607=users['Arabic'];}}}}}}}_0x438c1e['render'](_0x241f0e(0x286),{'success':_0x220101[_0x241f0e(0x248)](_0x241f0e(0x1d3)),'errors':_0x220101['flash']('errors'),'role':_0x237e28,'profile':_0x42dbc4,'purchases':_0x1cfd6f,'suppliers':_0x38ac4a,'warehouse':_0x1f0555,'product':_0x541e48,'master_shop':_0x409acf,'language':_0x340607,'ed_fullDate':_0x2b401d,'dataSelected':_0x132881});}catch(_0x2a1377){console[_0x241f0e(0x24a)](_0x2a1377);}}),router['post'](a0_0x36a308(0x292),auth,async(_0x53fd12,_0x28b3ea)=>{var _0x3c9a3f=a0_0x36a308;try{const _0x9d66fc=_0x53fd12[_0x3c9a3f(0x27e)]['id'],_0x117d1b=await purchases[_0x3c9a3f(0x2b1)]({'_id':_0x53fd12[_0x3c9a3f(0x27e)]['id']}),_0xf2032f=await warehouse[_0x3c9a3f(0x2b1)]({'name':_0x117d1b[_0x3c9a3f(0x288)],'room':_0x117d1b['room']});_0x117d1b[_0x3c9a3f(0x29c)][_0x3c9a3f(0x2b6)](_0x186317=>{const _0x47fbe2=_0xf2032f['product_details']['map'](_0x4b246b=>{var _0x328652=a0_0x33e3;_0x4b246b['product_name']==_0x186317['product_name']&&_0x4b246b[_0x328652(0x27f)]==_0x186317[_0x328652(0x27f)]&&_0x4b246b[_0x328652(0x222)]==_0x186317[_0x328652(0x222)]&&_0x4b246b[_0x328652(0x251)]==_0x186317[_0x328652(0x251)]&&_0x4b246b['bay']==_0x186317[_0x328652(0x1d5)]&&_0x4b246b[_0x328652(0x226)]==_0x186317[_0x328652(0x226)]&&_0x4b246b[_0x328652(0x1e6)]==_0x186317[_0x328652(0x1e6)]&&(_0x4b246b['product_stock']=parseInt(_0x4b246b[_0x328652(0x2a6)])-parseInt(_0x186317[_0x328652(0x233)]));});}),await _0xf2032f[_0x3c9a3f(0x2c2)]();const {invoice:_0x3856ee,suppliers:_0x4a0bf7,date:_0x35e624,warehouse_name:_0x433f2e,prod_name:_0x37e848,prod_code:_0x4e52cc,prod_qty:_0x5bd590,prod_unit:_0x2d3b31,prod_secondunit:_0x4a610a,prod_level:_0x4400bb,prod_isle:_0x217e82,prod_pallet:_0x1f0901,note:_0x2c86ce,expiry_date:_0x343f85,batch_code:_0x4bf7f7,paid_amount:_0x4f67e2,due_amount:_0x289b37,Room_name:_0x4aaa8c,primary_code:_0xddc0f,secondary_code:_0x3c0eec,PO_number:_0x36765d,JO_number:_0x16915b}=_0x53fd12[_0x3c9a3f(0x1e0)];if(typeof _0x37e848==_0x3c9a3f(0x22d))var _0x3ef85b=[_0x53fd12['body'][_0x3c9a3f(0x244)]],_0x32e26b=[_0x53fd12['body'][_0x3c9a3f(0x2ce)]],_0x73b384=[_0x53fd12['body'][_0x3c9a3f(0x273)]],_0x3a27ee=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x204)]],_0x5bcfbe=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x237)]],_0x33434b=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x21a)]],_0x569fc2=[_0x53fd12['body']['prod_isle']],_0x5a22bc=[_0x53fd12['body'][_0x3c9a3f(0x29d)]],_0x1dba50=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x23a)]],_0x20e22b=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x28e)]],_0x52cec1=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x271)]],_0x4b8f25=[_0x53fd12['body']['batch_code']],_0x568c0d=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x2d5)]],_0x5f2726=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x1e6)]],_0x1e41db=[_0x53fd12['body'][_0x3c9a3f(0x2ad)]],_0x35856f=[_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x222)]];else var _0x3ef85b=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x244)]],_0x32e26b=[..._0x53fd12['body'][_0x3c9a3f(0x2ce)]],_0x73b384=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x273)]],_0x3a27ee=[..._0x53fd12[_0x3c9a3f(0x1e0)]['prod_unit']],_0x5bcfbe=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x237)]],_0x33434b=[..._0x53fd12['body'][_0x3c9a3f(0x21a)]],_0x569fc2=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x2c6)]],_0x5a22bc=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x29d)]],_0x1dba50=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x23a)]],_0x20e22b=[..._0x53fd12['body'][_0x3c9a3f(0x28e)]],_0x52cec1=[..._0x53fd12['body'][_0x3c9a3f(0x271)]],_0x4b8f25=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x1ef)]],_0x568c0d=[..._0x53fd12['body'][_0x3c9a3f(0x2d5)]],_0x5f2726=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x1e6)]],_0x1e41db=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x2ad)]],_0x35856f=[..._0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x222)]];const _0x4678fc=_0x3ef85b[_0x3c9a3f(0x2bf)](_0x3305da=>{return _0x3305da={'product_name':_0x3305da};});_0x32e26b[_0x3c9a3f(0x2b6)]((_0x3ca1b3,_0x25dc53)=>{var _0x4771c0=_0x3c9a3f;_0x4678fc[_0x25dc53][_0x4771c0(0x20a)]=_0x3ca1b3;}),_0x73b384[_0x3c9a3f(0x2b6)]((_0x476e2e,_0x482c08)=>{_0x4678fc[_0x482c08]['quantity']=_0x476e2e;}),_0x3a27ee[_0x3c9a3f(0x2b6)]((_0x31aefd,_0x541ece)=>{var _0x5e4b5c=_0x3c9a3f;_0x4678fc[_0x541ece][_0x5e4b5c(0x2bb)]=_0x31aefd;}),_0x5bcfbe[_0x3c9a3f(0x2b6)]((_0x1e6fda,_0x2f143)=>{var _0x169505=_0x3c9a3f;_0x4678fc[_0x2f143][_0x169505(0x1fe)]=_0x1e6fda;}),_0x33434b[_0x3c9a3f(0x2b6)]((_0x3337a6,_0x24dd48)=>{_0x4678fc[_0x24dd48]['bay']=_0x3337a6;}),_0x569fc2['forEach']((_0x30ebfb,_0xf83133)=>{var _0x2143ce=_0x3c9a3f;_0x4678fc[_0xf83133][_0x2143ce(0x251)]=_0x30ebfb;}),_0x5a22bc[_0x3c9a3f(0x2b6)]((_0x4cb9f6,_0x582f6d)=>{var _0x5a3974=_0x3c9a3f;_0x4678fc[_0x582f6d][_0x5a3974(0x27f)]=_0x4cb9f6;}),_0x1dba50[_0x3c9a3f(0x2b6)]((_0x519f4b,_0x5b3d77)=>{_0x4678fc[_0x5b3d77]['primary_code']=_0x519f4b;}),_0x20e22b[_0x3c9a3f(0x2b6)]((_0x4baa30,_0x4ff591)=>{_0x4678fc[_0x4ff591]['secondary_code']=_0x4baa30;}),_0x52cec1['forEach']((_0x1ef5c0,_0x398f20)=>{var _0xdf1a2d=_0x3c9a3f;_0x4678fc[_0x398f20][_0xdf1a2d(0x249)]=_0x1ef5c0;}),_0x4b8f25[_0x3c9a3f(0x2b6)]((_0x3db132,_0x38d45d)=>{_0x4678fc[_0x38d45d]['batch_code']=_0x3db132;}),_0x568c0d[_0x3c9a3f(0x2b6)]((_0x5e5ea9,_0x8c3269)=>{var _0xcfc8a3=_0x3c9a3f;_0x4678fc[_0x8c3269][_0xcfc8a3(0x2d5)]=_0x5e5ea9;}),_0x35856f[_0x3c9a3f(0x2b6)]((_0x5c90bb,_0xa0ca19)=>{var _0x5dd48c=_0x3c9a3f;_0x4678fc[_0xa0ca19][_0x5dd48c(0x222)]=_0x5c90bb;}),_0x5f2726[_0x3c9a3f(0x2b6)]((_0x19b429,_0x1062b5)=>{_0x4678fc[_0x1062b5]['storage']=_0x19b429;}),_0x1e41db['forEach']((_0x2dd4ad,_0x3906e6)=>{_0x4678fc[_0x3906e6]['rack']=_0x2dd4ad;});const _0x4a9ea9=_0x4678fc['filter'](_0x4f7f67=>_0x4f7f67[_0x3c9a3f(0x233)]!=='0'&&_0x4f7f67['quantity']!=='');_0x117d1b[_0x3c9a3f(0x20e)]=_0x3856ee,_0x117d1b['suppliers']=_0x4a0bf7,_0x117d1b[_0x3c9a3f(0x2b7)]=_0x35e624,_0x117d1b['warehouse_name']=_0x433f2e,_0x117d1b[_0x3c9a3f(0x29c)]=_0x4a9ea9,_0x117d1b[_0x3c9a3f(0x250)]=_0x2c86ce,_0x117d1b[_0x3c9a3f(0x20f)]=_0x4f67e2,_0x117d1b[_0x3c9a3f(0x2d4)]=_0x289b37,_0x117d1b['room']=_0x4aaa8c,_0x117d1b[_0x3c9a3f(0x2c4)]=_0x36765d,_0x117d1b[_0x3c9a3f(0x252)]=_0x16915b;const _0x3f8f1b=await _0x117d1b['save'](),_0x26c814=await warehouse[_0x3c9a3f(0x2b1)]({'name':_0x53fd12[_0x3c9a3f(0x1e0)]['warehouse_name'],'room':_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x1e5)]});_0x117d1b[_0x3c9a3f(0x29c)][_0x3c9a3f(0x2b6)](_0x5146d9=>{var _0x29ecc4=_0x3c9a3f,_0xb61857=0x0;const _0x17a0ff=_0x26c814[_0x29ecc4(0x201)][_0x29ecc4(0x2bf)](_0x217063=>{var _0x1f0bab=_0x29ecc4;_0x217063[_0x1f0bab(0x243)]==_0x5146d9[_0x1f0bab(0x243)]&&_0x217063[_0x1f0bab(0x27f)]==_0x5146d9[_0x1f0bab(0x27f)]&&_0x217063[_0x1f0bab(0x222)]==_0x5146d9['type']&&_0x217063['bin']==_0x5146d9[_0x1f0bab(0x251)]&&_0x217063[_0x1f0bab(0x1d5)]==_0x5146d9['bay']&&_0x217063[_0x1f0bab(0x226)]==_0x5146d9[_0x1f0bab(0x226)]&&_0x217063['storage']==_0x5146d9[_0x1f0bab(0x1e6)]&&(_0x217063['product_stock']=parseInt(_0x217063['product_stock'])+parseInt(_0x5146d9['quantity']),_0xb61857++);});_0xb61857=='0'&&(_0x26c814['product_details']=_0x26c814[_0x29ecc4(0x201)]['concat']({'product_name':_0x5146d9[_0x29ecc4(0x243)],'product_stock':_0x5146d9[_0x29ecc4(0x233)],'primary_code':_0x5146d9[_0x29ecc4(0x23a)],'secondary_code':_0x5146d9['secondary_code'],'product_code':_0x5146d9[_0x29ecc4(0x20a)],'storage':_0x5146d9['storage'],'rack':_0x5146d9[_0x29ecc4(0x226)],'bay':_0x5146d9['bay'],'bin':_0x5146d9[_0x29ecc4(0x251)],'type':_0x5146d9[_0x29ecc4(0x222)],'floorlevel':_0x5146d9['floorlevel'],'maxProducts':_0x5146d9[_0x29ecc4(0x249)],'unit':_0x5146d9[_0x29ecc4(0x2bb)],'secondary_unit':_0x5146d9[_0x29ecc4(0x1fe)],'expiry_date':_0x5146d9['expiry_date']}));}),await _0x26c814[_0x3c9a3f(0x2c2)]();const _0x5b2526=await s_payment_data[_0x3c9a3f(0x2b1)]({'invoice':_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x20e)]});if(_0x5b2526===null){}else console[_0x3c9a3f(0x24a)](_0x3c9a3f(0x2cd),_0x5b2526,_0x53fd12[_0x3c9a3f(0x1e0)][_0x3c9a3f(0x20e)]),_0x5b2526['suppliers']=_0x53fd12['body'][_0x3c9a3f(0x2cd)],await _0x5b2526[_0x3c9a3f(0x2c2)]();_0x53fd12[_0x3c9a3f(0x248)]('success',_0x3c9a3f(0x22c)),_0x28b3ea[_0x3c9a3f(0x1f8)](_0x3c9a3f(0x23d));}catch(_0x2dda27){console[_0x3c9a3f(0x24a)](_0x2dda27);}}),router['post'](a0_0x36a308(0x269),auth,async(_0x890fc3,_0x3f6255)=>{var _0x36303c=a0_0x36a308;try{const _0x34e5ff=_0x890fc3[_0x36303c(0x27e)]['id'],{invoice:_0x59c0f6,suppliers:_0x200254,payable:_0x19c56f,due_amount:_0x455dd6}=_0x890fc3[_0x36303c(0x1e0)],_0x488b66=await purchases['findById'](_0x34e5ff);var _0x322f92=_0x19c56f-_0x455dd6;_0x488b66[_0x36303c(0x20f)]=parseFloat(_0x488b66[_0x36303c(0x20f)])+parseFloat(_0x455dd6),_0x488b66[_0x36303c(0x2d4)]=_0x322f92;const _0x17fbe6=await _0x488b66[_0x36303c(0x2c2)]();console[_0x36303c(0x24a)](_0x17fbe6);const _0x2c0e4a=await s_payment_data[_0x36303c(0x2b1)]({'invoice':_0x59c0f6});_0x2c0e4a['amount']=_0x322f92,await _0x2c0e4a[_0x36303c(0x2c2)]();let _0x2de8ae=new Date(),_0x163205=('0'+_0x2de8ae[_0x36303c(0x21c)]())[_0x36303c(0x21f)](-0x2),_0x2125a5=('0'+(_0x2de8ae['getMonth']()+0x1))[_0x36303c(0x21f)](-0x2),_0xdb2088=_0x2de8ae[_0x36303c(0x20d)](),_0xb1efae=_0xdb2088+'-'+_0x2125a5+'-'+_0x163205;const _0x320560=new suppliers_payment({'invoice':_0x59c0f6,'date':_0xdb2088+'-'+_0x2125a5+'-'+_0x163205,'suppliers':_0x200254,'reason':'Paid\x20For\x20Purchase','amount':_0x455dd6}),_0x2b10c9=await _0x320560[_0x36303c(0x2c2)]();_0x890fc3[_0x36303c(0x248)]('success',_0x36303c(0x26f)),_0x3f6255[_0x36303c(0x1f8)](_0x36303c(0x23d));}catch(_0x5570d3){console[_0x36303c(0x24a)](_0x5570d3);}}),router[a0_0x36a308(0x2ef)](a0_0x36a308(0x27a),auth,async(_0x3a0dc0,_0x5c1d6f)=>{var _0x32d6a7=a0_0x36a308;try{const {username:_0x1d4694,email:_0x746f76,role:_0x35c7fc}=_0x3a0dc0['user'],_0x5990b7=_0x3a0dc0[_0x32d6a7(0x2d1)],_0x486e40=await profile[_0x32d6a7(0x2b1)]({'email':_0x5990b7[_0x32d6a7(0x2ca)]}),_0x2a9697=await master_shop[_0x32d6a7(0x2e8)]();console[_0x32d6a7(0x24a)](_0x32d6a7(0x2a2),_0x2a9697);const _0x43a166=_0x3a0dc0[_0x32d6a7(0x27e)]['id'],_0xa470f5=await purchases[_0x32d6a7(0x265)](_0x43a166);console[_0x32d6a7(0x24a)](_0xa470f5);const _0x4345a5=await suppliers[_0x32d6a7(0x2b1)]({'name':_0xa470f5[_0x32d6a7(0x2cd)]});console[_0x32d6a7(0x24a)](_0x4345a5);if(_0x2a9697[0x0]['language']==_0x32d6a7(0x224)){var _0x6c28df=users[_0x32d6a7(0x1d2)];console[_0x32d6a7(0x24a)](_0x6c28df);}else{if(_0x2a9697[0x0]['language']==_0x32d6a7(0x1df))var _0x6c28df=users[_0x32d6a7(0x1df)];else{if(_0x2a9697[0x0][_0x32d6a7(0x2ed)]==_0x32d6a7(0x2b9))var _0x6c28df=users['German'];else{if(_0x2a9697[0x0]['language']==_0x32d6a7(0x2af))var _0x6c28df=users[_0x32d6a7(0x2af)];else{if(_0x2a9697[0x0][_0x32d6a7(0x2ed)]=='French')var _0x6c28df=users['French'];else{if(_0x2a9697[0x0][_0x32d6a7(0x2ed)]=='Portuguese\x20(BR)')var _0x6c28df=users['Portuguese'];else{if(_0x2a9697[0x0][_0x32d6a7(0x2ed)]==_0x32d6a7(0x2c9))var _0x6c28df=users[_0x32d6a7(0x2c9)];else{if(_0x2a9697[0x0]['language']=='Arabic\x20(ae)')var _0x6c28df=users[_0x32d6a7(0x239)];}}}}}}}_0x5c1d6f[_0x32d6a7(0x2d8)](_0x32d6a7(0x2d2),{'success':_0x3a0dc0[_0x32d6a7(0x248)](_0x32d6a7(0x1d3)),'errors':_0x3a0dc0['flash']('errors'),'role':_0x5990b7,'profile':_0x486e40,'master_shop':_0x2a9697,'supplier':_0x4345a5,'purchase':_0xa470f5,'language':_0x6c28df});}catch(_0x544b6b){console[_0x32d6a7(0x24a)](_0x544b6b);}}),router['get'](a0_0x36a308(0x261),auth,async(_0x545a53,_0x563487)=>{var _0x377c58=a0_0x36a308;try{const {username:_0x28a0f9,email:_0x278b1f,role:_0xb0f75c}=_0x545a53[_0x377c58(0x2d1)],_0x5c8ad0=_0x545a53[_0x377c58(0x2d1)],_0x40fb98=await profile[_0x377c58(0x2b1)]({'email':_0x5c8ad0['email']}),_0x5be57c=await master_shop[_0x377c58(0x2e8)]();console[_0x377c58(0x24a)]('master',_0x5be57c);const _0x5d74c5=_0x545a53[_0x377c58(0x27e)]['id'];console[_0x377c58(0x24a)](_0x5d74c5);const _0x4fb1ba=await purchases['findById'](_0x5d74c5);console[_0x377c58(0x24a)](_0x377c58(0x1f6),_0x4fb1ba);const _0x1bc46c=await product[_0x377c58(0x2e8)]({}),_0x4bffcc=await warehouse[_0x377c58(0x268)]([{'$match':{'name':_0x4fb1ba[_0x377c58(0x288)],'room':_0x4fb1ba['room'],'warehouse_category':_0x377c58(0x2b4)}},{'$unwind':_0x377c58(0x21b)},{'$group':{'_id':_0x377c58(0x25d),'name':{'$first':_0x377c58(0x22a)},'product_stock':{'$first':_0x377c58(0x296)},'bay':{'$first':_0x377c58(0x28c)},'bin':{'$first':_0x377c58(0x253)},'type':{'$first':_0x377c58(0x2d3)},'floorlevel':{'$first':_0x377c58(0x28f)},'primary_code':{'$first':_0x377c58(0x235)},'secondary_code':{'$first':_0x377c58(0x291)},'product_code':{'$first':_0x377c58(0x287)},'storage':{'$first':_0x377c58(0x2ac)},'rack':{'$first':_0x377c58(0x282)}}}]);warehouse_data=await warehouse[_0x377c58(0x268)]([{'$match':{'status':'Enabled','name':_0x377c58(0x2b8),'warehouse_category':_0x377c58(0x2b4)}},{'$group':{'_id':_0x377c58(0x275),'name':{'$first':_0x377c58(0x275)}}},{'$sort':{'name':0x1}}]),console['log'](_0x377c58(0x22f),_0x4bffcc);if(_0x5be57c[0x0][_0x377c58(0x2ed)]==_0x377c58(0x224)){var _0x2832ee=users[_0x377c58(0x1d2)];console[_0x377c58(0x24a)](_0x2832ee);}else{if(_0x5be57c[0x0][_0x377c58(0x2ed)]==_0x377c58(0x1df))var _0x2832ee=users['Hindi'];else{if(_0x5be57c[0x0][_0x377c58(0x2ed)]==_0x377c58(0x2b9))var _0x2832ee=users[_0x377c58(0x2b9)];else{if(_0x5be57c[0x0]['language']==_0x377c58(0x2af))var _0x2832ee=users[_0x377c58(0x2af)];else{if(_0x5be57c[0x0][_0x377c58(0x2ed)]=='French')var _0x2832ee=users[_0x377c58(0x25e)];else{if(_0x5be57c[0x0][_0x377c58(0x2ed)]==_0x377c58(0x2e7))var _0x2832ee=users[_0x377c58(0x206)];else{if(_0x5be57c[0x0]['language']==_0x377c58(0x2c9))var _0x2832ee=users['Chinese'];else{if(_0x5be57c[0x0][_0x377c58(0x2ed)]=='Arabic\x20(ae)')var _0x2832ee=users[_0x377c58(0x239)];}}}}}}}_0x563487[_0x377c58(0x2d8)]('return_purchase',{'success':_0x545a53[_0x377c58(0x248)](_0x377c58(0x1d3)),'errors':_0x545a53[_0x377c58(0x248)](_0x377c58(0x242)),'role':_0x5c8ad0,'profile':_0x40fb98,'user':_0x4fb1ba,'stock':_0x4bffcc,'master_shop':_0x5be57c,'product':_0x1bc46c,'language':_0x2832ee,'warehouse':warehouse_data});}catch(_0xd80eab){console['log'](_0xd80eab);}}),router[a0_0x36a308(0x232)](a0_0x36a308(0x261),auth,async(_0x1b5a40,_0x33055f)=>{var _0x58008b=a0_0x36a308;try{const {invoice:_0x174e01,date:_0x320314,warehouse_name:_0x272dc2,Room_name:_0x415148,product_name:_0x370525,purchase_quantity:_0x568c83,stocks:_0x5af225,return_qty:_0x2c9286,note:_0x24d906,level:_0x29474a,isle:_0x250d66,pallet:_0x18a064,to_warehouse_name:_0x1fe699,to_Room_name:_0x1c2d48}=_0x1b5a40['body'],_0x3a10f3=await purchases[_0x58008b(0x2b1)]({'_id':_0x1b5a40[_0x58008b(0x27e)]['id']}),_0x4446df=await warehouse[_0x58008b(0x2b1)]({'name':_0x272dc2,'room':_0x415148});if(typeof _0x370525==_0x58008b(0x22d))var _0x286b36=[_0x1b5a40['body'][_0x58008b(0x243)]],_0x1eb90c=[_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x28b)]],_0x14c333=[_0x1b5a40[_0x58008b(0x1e0)]['stocks']],_0x1cd72a=[_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x1e4)]],_0x511032=[_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x2b5)]],_0x20095a=[_0x1b5a40['body'][_0x58008b(0x1e9)]],_0x3c6bf7=[_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x240)]],_0xb8fad3=[_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x26b)]],_0x3809f4=[_0x1b5a40['body'][_0x58008b(0x2c1)]],_0x271ef9=[_0x1b5a40['body'][_0x58008b(0x2e0)]],_0x2271b3=[_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x238)]];else var _0x286b36=[..._0x1b5a40['body']['product_name']],_0x1eb90c=[..._0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x28b)]],_0x14c333=[..._0x1b5a40['body']['stocks']],_0x1cd72a=[..._0x1b5a40[_0x58008b(0x1e0)]['return_qty']],_0x511032=[..._0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x2b5)]],_0x20095a=[..._0x1b5a40[_0x58008b(0x1e0)]['isle']],_0x3c6bf7=[..._0x1b5a40['body'][_0x58008b(0x240)]],_0xb8fad3=[..._0x1b5a40[_0x58008b(0x1e0)]['types']],_0x3809f4=[..._0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x2c1)]],_0x271ef9=[..._0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x2e0)]],_0x2271b3=[..._0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x238)]];const _0x55549c=_0x286b36[_0x58008b(0x2bf)](_0x53afb1=>{return _0x53afb1={'product_name':_0x53afb1};});_0x1eb90c['forEach']((_0x3db5f9,_0x539ef0)=>{var _0x5aaf5d=_0x58008b;_0x55549c[_0x539ef0][_0x5aaf5d(0x28b)]=_0x3db5f9;}),_0x14c333[_0x58008b(0x2b6)]((_0x2b454d,_0x342d67)=>{var _0x22f6ce=_0x58008b;_0x55549c[_0x342d67][_0x22f6ce(0x2f1)]=_0x2b454d;}),_0x1cd72a[_0x58008b(0x2b6)]((_0x5cd207,_0xdf2fa8)=>{var _0x566853=_0x58008b;_0x55549c[_0xdf2fa8][_0x566853(0x1e4)]=_0x5cd207;}),_0x511032[_0x58008b(0x2b6)]((_0x476b4c,_0xfe0f57)=>{var _0x5d446e=_0x58008b;_0x55549c[_0xfe0f57][_0x5d446e(0x1d5)]=_0x476b4c;}),_0x20095a[_0x58008b(0x2b6)]((_0x3e07c6,_0x7f88bd)=>{_0x55549c[_0x7f88bd]['bin']=_0x3e07c6;}),_0x3c6bf7[_0x58008b(0x2b6)]((_0x45eed9,_0x1a1284)=>{_0x55549c[_0x1a1284]['floorlevel']=_0x45eed9;}),_0xb8fad3[_0x58008b(0x2b6)]((_0x55ffa5,_0x12459d)=>{var _0xfc2195=_0x58008b;_0x55549c[_0x12459d][_0xfc2195(0x222)]=_0x55ffa5;}),_0x3809f4[_0x58008b(0x2b6)]((_0xd4e947,_0x3342d0)=>{var _0x5b0761=_0x58008b;_0x55549c[_0x3342d0][_0x5b0761(0x20a)]=_0xd4e947;}),_0x271ef9[_0x58008b(0x2b6)]((_0xdc415f,_0x4850bf)=>{_0x55549c[_0x4850bf]['primary_code']=_0xdc415f;}),_0x2271b3[_0x58008b(0x2b6)]((_0x39e942,_0x577571)=>{var _0x5c8ff8=_0x58008b;_0x55549c[_0x577571][_0x5c8ff8(0x28e)]=_0x39e942;}),_0x3a10f3['product']['forEach'](_0x13a422=>{var _0x407441=_0x58008b;const _0x1da82b=_0x4446df[_0x407441(0x201)][_0x407441(0x2bf)](_0x1685e8=>{var _0x5518f0=_0x407441;_0x1685e8['product_name']==_0x13a422[_0x5518f0(0x243)]&&_0x1685e8['floorlevel']==_0x13a422[_0x5518f0(0x27f)]&&_0x1685e8[_0x5518f0(0x222)]==_0x13a422[_0x5518f0(0x222)]&&_0x1685e8[_0x5518f0(0x251)]==_0x13a422['bin']&&_0x1685e8['bay']==_0x13a422['bay']&&_0x1685e8[_0x5518f0(0x226)]==_0x13a422[_0x5518f0(0x226)]&&_0x1685e8[_0x5518f0(0x1e6)]==_0x13a422[_0x5518f0(0x1e6)]&&(console[_0x5518f0(0x24a)](parseInt(_0x1685e8[_0x5518f0(0x2a6)])+_0x5518f0(0x1fb)+parseInt(_0x13a422[_0x5518f0(0x233)])),_0x1685e8['product_stock']=parseInt(_0x1685e8[_0x5518f0(0x2a6)])+parseInt(_0x13a422[_0x5518f0(0x233)]));});}),await _0x4446df[_0x58008b(0x2c2)]();const _0x3e67fd=_0x55549c[_0x58008b(0x1e2)](_0x507204=>_0x507204[_0x58008b(0x1e4)]!=='0'&&_0x507204['return_qty']!=='');var _0x2b552d=0x0;_0x3e67fd[_0x58008b(0x2b6)](_0xe0bf21=>{var _0x518975=_0x58008b;console[_0x518975(0x24a)]('foreach\x20newproduct',_0xe0bf21),(parseInt(_0xe0bf21[_0x518975(0x28b)])<parseInt(_0xe0bf21[_0x518975(0x1e4)])||parseInt(_0xe0bf21['stock_quantity'])<parseInt(_0xe0bf21['return_qty']))&&_0x2b552d++;});if(_0x2b552d!=0x0)return _0x1b5a40[_0x58008b(0x248)](_0x58008b(0x242),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x33055f[_0x58008b(0x1f8)](_0x58008b(0x211));const _0x246319=new purchases_return({'invoice':_0x174e01,'suppliers':_0x1b5a40[_0x58008b(0x1e0)]['suppliers'],'date':_0x320314,'warehouse_name':_0x272dc2,'return_product':_0x3e67fd,'note':_0x24d906,'room':_0x415148,'to_warehouse_name':_0x1fe699,'to_room':_0x1c2d48}),_0x138e8=await _0x246319[_0x58008b(0x2c2)]();console[_0x58008b(0x24a)](_0x246319);const _0x23406d=await purchases_return['findOne']({'invoice':_0x174e01}),_0x8f1f5b=await warehouse[_0x58008b(0x2b1)]({'name':_0x1fe699,'room':_0x1c2d48});_0x23406d[_0x58008b(0x2e3)][_0x58008b(0x2b6)](_0x5898bd=>{var _0x70aee1=_0x58008b,_0x5e21e6=0x0;const _0x13f057=_0x8f1f5b[_0x70aee1(0x201)][_0x70aee1(0x2bf)](_0x3184b3=>{var _0x41204b=_0x70aee1;_0x3184b3['product_name']==_0x5898bd[_0x41204b(0x243)]&&_0x3184b3[_0x41204b(0x27f)]==_0x5898bd[_0x41204b(0x27f)]&&_0x3184b3[_0x41204b(0x222)]==_0x5898bd[_0x41204b(0x222)]&&_0x3184b3[_0x41204b(0x251)]==_0x5898bd['bin']&&_0x3184b3[_0x41204b(0x1d5)]==_0x5898bd[_0x41204b(0x1d5)]&&(_0x3184b3['product_stock']=parseInt(_0x3184b3['product_stock'])-parseInt(_0x5898bd['return_qty']),_0x5e21e6++);});_0x5e21e6=='0'&&(_0x8f1f5b[_0x70aee1(0x201)]=_0x8f1f5b[_0x70aee1(0x201)]['concat']({'product_name':_0x5898bd['product_name'],'product_stock':_0x5898bd[_0x70aee1(0x1e4)],'primary_code':_0x5898bd[_0x70aee1(0x23a)],'secondary_code':_0x5898bd[_0x70aee1(0x28e)],'product_code':_0x5898bd[_0x70aee1(0x20a)],'storage':_0x5898bd[_0x70aee1(0x1e6)],'rack':_0x5898bd[_0x70aee1(0x226)],'bay':_0x5898bd[_0x70aee1(0x1d5)],'bin':_0x5898bd[_0x70aee1(0x251)],'type':_0x5898bd[_0x70aee1(0x222)],'floorlevel':_0x5898bd[_0x70aee1(0x27f)],'maxProducts':_0x5898bd[_0x70aee1(0x249)],'unit':_0x5898bd[_0x70aee1(0x2bb)],'secondary_unit':_0x5898bd[_0x70aee1(0x1fe)],'expiry_date':_0x5898bd[_0x70aee1(0x2d5)]}));}),await _0x8f1f5b['save']();const _0x5c1fd4=await purchases[_0x58008b(0x2b1)]({'invoice':_0x174e01});_0x5c1fd4[_0x58008b(0x1f0)]=_0x58008b(0x262);const _0x425302=await _0x5c1fd4[_0x58008b(0x2c2)](),_0x2eb58c=new s_payment_data({'invoice':_0x174e01,'suppliers':_0x1b5a40[_0x58008b(0x1e0)]['suppliers'],'reason':_0x58008b(0x25c)});await _0x2eb58c[_0x58008b(0x2c2)]();const _0x51e0d9=await master_shop[_0x58008b(0x2e8)]();console[_0x58008b(0x24a)]('add\x20post',_0x51e0d9[0x0][_0x58008b(0x219)]);const _0x336d44=await email_settings[_0x58008b(0x2b1)](),_0x5ad016=await suppliers[_0x58008b(0x2b1)]({'name':_0x1b5a40[_0x58008b(0x1e0)][_0x58008b(0x2cd)]});console[_0x58008b(0x24a)]('suppliers_data',_0x5ad016);_0x51e0d9[0x0][_0x58008b(0x1db)]==0x1?(right_currency=_0x51e0d9[0x0][_0x58008b(0x23c)],left_currency=''):(right_currency='',left_currency=_0x51e0d9[0x0][_0x58008b(0x23c)]);var _0x1ee628=_0x286b36,_0x52518a=_0x1cd72a,_0x57c99c='',_0x462ecb;for(_0x462ecb in _0x1ee628){_0x57c99c+=_0x58008b(0x27b)+_0x58008b(0x2d0)+_0x1ee628[_0x462ecb]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x52518a[_0x462ecb]+'</td>'+_0x58008b(0x27c);}console['log']('product_list',_0x57c99c);let _0x58de36=nodemailer[_0x58008b(0x2ba)]({'service':_0x58008b(0x221),'auth':{'user':_0x336d44[_0x58008b(0x2ca)],'pass':_0x336d44[_0x58008b(0x247)]}}),_0x415649={'from':_0x336d44[_0x58008b(0x2ca)],'to':_0x5ad016[_0x58008b(0x2ca)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x58008b(0x234),'path':__dirname+'/../public'+'/upload/'+_0x51e0d9[0x0]['image'],'cid':'logo'}],'html':_0x58008b(0x1ea)+'<html><head><title></title>'+_0x58008b(0x2de)+_0x58008b(0x24c)+_0x58008b(0x26a)+_0x58008b(0x24c)+_0x58008b(0x272)+_0x58008b(0x220)+'<div>'+'<h2>\x20'+_0x51e0d9[0x0][_0x58008b(0x2d7)]+_0x58008b(0x25f)+_0x58008b(0x220)+_0x58008b(0x220)+'<hr\x20class=\x22my-3\x22>'+_0x58008b(0x24c)+_0x58008b(0x2e9)+_0x58008b(0x26c)+_0x174e01+'\x20'+_0x58008b(0x2c8)+_0x58008b(0x1e7)+_0x320314+'\x20'+_0x58008b(0x299)+'</h5>'+_0x58008b(0x220)+_0x58008b(0x2a7)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x58008b(0x27b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x58008b(0x227)+_0x58008b(0x277)+_0x58008b(0x22e)+_0x58008b(0x27c)+'</thead>'+_0x58008b(0x29f)+'\x20'+_0x57c99c+'\x20'+_0x58008b(0x209)+'</table>'+_0x58008b(0x24c)+'<strong>\x20Regards\x20</strong>'+_0x58008b(0x2e6)+_0x51e0d9[0x0][_0x58008b(0x2d7)]+_0x58008b(0x2b2)+_0x58008b(0x220)+_0x58008b(0x220)+_0x58008b(0x2ea)};_0x58de36[_0x58008b(0x25b)](_0x415649,function(_0x196fd0,_0x357844){var _0x1e52b9=_0x58008b;_0x196fd0?(console[_0x1e52b9(0x24a)](_0x196fd0),console[_0x1e52b9(0x24a)](_0x1e52b9(0x229))):console[_0x1e52b9(0x24a)](_0x1e52b9(0x24d));}),_0x1b5a40[_0x58008b(0x248)](_0x58008b(0x1d3),_0x58008b(0x1fc)),_0x33055f[_0x58008b(0x1f8)](_0x58008b(0x23d));}catch(_0x5a4a93){console[_0x58008b(0x24a)](_0x5a4a93),_0x33055f[_0x58008b(0x1e8)](0xc8)[_0x58008b(0x280)]({'message':_0x5a4a93[_0x58008b(0x276)]});}}),router[a0_0x36a308(0x2ef)](a0_0x36a308(0x27d),auth,async(_0x47baac,_0x5309b9)=>{var _0x1f6242=a0_0x36a308;try{const {username:_0x1b7aae,email:_0x12d73d,role:_0x145491}=_0x47baac['user'],_0xa05aff=_0x47baac[_0x1f6242(0x2d1)],_0x31f030=await profile['findOne']({'email':_0xa05aff[_0x1f6242(0x2ca)]}),_0x3a02f9=await master_shop[_0x1f6242(0x2e8)](),_0x51f610=_0x47baac['params']['id'],_0x796f6f=await purchases[_0x1f6242(0x265)](_0x51f610);if(_0x3a02f9[0x0]['language']==_0x1f6242(0x224))var _0x482c5f=users[_0x1f6242(0x1d2)];else{if(_0x3a02f9[0x0]['language']=='Hindi')var _0x482c5f=users[_0x1f6242(0x1df)];else{if(_0x3a02f9[0x0][_0x1f6242(0x2ed)]==_0x1f6242(0x2b9))var _0x482c5f=users[_0x1f6242(0x2b9)];else{if(_0x3a02f9[0x0]['language']==_0x1f6242(0x2af))var _0x482c5f=users['Spanish'];else{if(_0x3a02f9[0x0][_0x1f6242(0x2ed)]==_0x1f6242(0x25e))var _0x482c5f=users[_0x1f6242(0x25e)];else{if(_0x3a02f9[0x0]['language']=='Portuguese\x20(BR)')var _0x482c5f=users['Portuguese'];else{if(_0x3a02f9[0x0]['language']=='Chinese')var _0x482c5f=users[_0x1f6242(0x2c9)];else{if(_0x3a02f9[0x0]['language']==_0x1f6242(0x205))var _0x482c5f=users[_0x1f6242(0x239)];}}}}}}}_0x5309b9['render'](_0x1f6242(0x1e3),{'success':_0x47baac['flash'](_0x1f6242(0x1d3)),'errors':_0x47baac[_0x1f6242(0x248)](_0x1f6242(0x242)),'role':_0xa05aff,'profile':_0x31f030,'alldata':_0x796f6f,'master_shop':_0x3a02f9,'language':_0x482c5f}),console['log'](alldata);}catch(_0x3d3158){console[_0x1f6242(0x24a)](_0x3d3158);}}),router[a0_0x36a308(0x232)](a0_0x36a308(0x2cc),async(_0x290bd8,_0x12092b)=>{var _0x55ad06=a0_0x36a308;const {product_code:_0x55c3a7}=_0x290bd8[_0x55ad06(0x1e0)];var _0x35e4c2;const _0x22d3cb=await product['aggregate']([{'$match':{'primary_code':_0x55c3a7,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x55ad06(0x2da),'name':{'$first':_0x55ad06(0x275)},'category':{'$first':_0x55ad06(0x216)},'brand':{'$first':_0x55ad06(0x1fa)},'unit':{'$first':_0x55ad06(0x1e1)},'alertquantity':{'$first':_0x55ad06(0x1d1)},'product_code':{'$first':_0x55ad06(0x246)},'primary_code':{'$first':_0x55ad06(0x258)},'secondary_code':{'$first':_0x55ad06(0x1f4)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x55ad06(0x230)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x55ad06(0x2a1)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x296741=await product[_0x55ad06(0x268)]([{'$match':{'secondary_code':_0x55c3a7,'product_category':_0x55ad06(0x2b4)}},{'$group':{'_id':_0x55ad06(0x2da),'name':{'$first':_0x55ad06(0x275)},'category':{'$first':_0x55ad06(0x216)},'brand':{'$first':_0x55ad06(0x1fa)},'unit':{'$first':_0x55ad06(0x1e1)},'alertquantity':{'$first':_0x55ad06(0x1d1)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x55ad06(0x217)},'maxProdPerUnit':{'$first':_0x55ad06(0x230)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x22d3cb[_0x55ad06(0x281)]>0x0)_0x35e4c2=_0x22d3cb;else _0x296741['length']>0x0&&(_0x35e4c2=_0x296741);_0x12092b['json'](_0x35e4c2);}),router[a0_0x36a308(0x232)](a0_0x36a308(0x1d6),async(_0x54b4b0,_0x1c1d6b)=>{var _0x46bdf4=a0_0x36a308;const {primaryCode:_0x36d6ea,secondaryCode:_0x5959b9,productCode:_0x12375a,bay:_0x5b7979,bin:_0x3b818b,types:_0x4e07b8,pallet:_0x254076,warehouses:_0xe6c68,room:_0x28d574}=_0x54b4b0[_0x46bdf4(0x1e0)];console[_0x46bdf4(0x24a)](_0x54b4b0[_0x46bdf4(0x1e0)]);try{const _0x58aa66=await warehouse[_0x46bdf4(0x268)]([{'$match':{'name':_0xe6c68,'room':_0x28d574}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x5b7979,'product_details.bin':_0x3b818b,'product_details.type':_0x4e07b8}},{'$group':{'_id':_0x46bdf4(0x25d),'name':{'$first':_0x46bdf4(0x22a)},'product_stock':{'$first':_0x46bdf4(0x296)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1c1d6b['status'](0xc8)[_0x46bdf4(0x280)](_0x58aa66);}catch(_0x378007){_0x1c1d6b['status'](0x194)[_0x46bdf4(0x280)]({'message':_0x378007[_0x46bdf4(0x276)]});}}),module['exports']=router;