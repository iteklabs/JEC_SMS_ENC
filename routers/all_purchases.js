var a0_0x589dfb=a0_0x3588;(function(_0x3435ac,_0x18af35){var _0x471794=a0_0x3588,_0x148f05=_0x3435ac();while(!![]){try{var _0x44e244=parseInt(_0x471794(0x1dd))/0x1+-parseInt(_0x471794(0x211))/0x2+-parseInt(_0x471794(0x248))/0x3*(-parseInt(_0x471794(0x1f8))/0x4)+parseInt(_0x471794(0x2b1))/0x5+parseInt(_0x471794(0x1d5))/0x6+-parseInt(_0x471794(0x2a8))/0x7+-parseInt(_0x471794(0x27e))/0x8;if(_0x44e244===_0x18af35)break;else _0x148f05['push'](_0x148f05['shift']());}catch(_0x171c2d){_0x148f05['push'](_0x148f05['shift']());}}}(a0_0x2b12,0xaf017));const express=require(a0_0x589dfb(0x212)),app=express(),router=express[a0_0x589dfb(0x27f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x589dfb(0x280)),auth=require(a0_0x589dfb(0x2d9)),nodemailer=require(a0_0x589dfb(0x2c8));function a0_0x2b12(){var _0x13540f=['An\x20error\x20occurred.','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.type','post','toString','due_amount','Purchase\x20data\x20added\x20successfully','$product.quantity','back','<tbody\x20style=\x22text-align:\x20center;\x22>','Rack\x20A','Purchase\x20Return\x20Mail','$product_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','exports','catch','foreach\x20newproduct','<h5\x20style=\x22text-align:\x20left;\x22>','get','push','rak','160824EfEjpj','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Portuguese','note','Portuguese\x20(BR)','quantity','level','</table>','sendMail','$note','$product_details.primary_code','delivery_code','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','warehouse_name','INC-','maxStocks','suppliers','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/all_purchases/view','$product_details.expiry_date','user_id','$product_details.secondary_code','$product_details.rack','role','pallet','<h5>','body','flash','English\x20(US)','prod_level','$product.bay','map','</h5>','delivery_date','gmail','/view/return_purchase/:id','There\x27s\x20a\x20error\x20in\x20this\x20transaction','\x20<>\x20','product_code_hide','Sales\x20Update\x20successfully','floor','/view/add_purchases/:id','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','../public/language/languages.json','findOne','Email\x20sent\x20successfully','<table\x20style=\x22width:\x20100%\x20!important;\x22>','POnumber','staff','type','password','$return_data','2267076ThdPbY','secondary_unit','$suppliers_docs','port','then','$product.type','currency_placement','amount','$brand','</tbody>','language','stocks','purchase_quantity','master','email','padStart','return_purchase','<hr\x20class=\x22my-3\x22>','render','prod_Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','actual_qty','$product_details.bin','Chinese','$product_details.product_code','$invoice','errors','/CheckingWarehouse','</div>','floorlevel','/preview/:id','$warehouse_name','alertQTY','production_date','product_details','$primary_code','$product_details','Level','abs','Enclosed','$product_details._id','primary_code','$maxStocks','expiry_date','<span\x20style=\x22float:\x20right;\x22>','Spanish','prod_isle','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/all_purchases/view/','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Shelves','/../public','7143672xpMEMy','Router','../models/all_models','/view/:id','stock_quantity','prod_cat','Room_name','getMonth','suppliers_data','product_code','concat','secondary_code_hide','$suppliers','json','$product.room_name','status','add_purchases','Rack\x20B','$batch_code','$date','rack','maxperunit','$product_details.bay','createTransport','standard_unit','product','product_cat','save','getDate','/upload/','Logo.png','redirect','forEach','<h2>\x20','Arabic\x20(ae)','$product_details.isle','COLD\x20STORAGE','Receiving\x20Area','add\x20post','product_list','/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','6006189MKHboa','</td>','Arabic','$paid_amount','$product_details.pallet','$product_details.floorlevel','prod_unit','product_name','length','1544445jBJBlc','$secondary_code','product_stock','secondary_code','English','isle','error','purchase\x20data\x20update\x20successfully','aggregate','bay','bin','Raw\x20Materials','MaxStocks_data','$product_details.product_name','$product.bin','purchase_invoice','edit_purchases','invoice','$product_details.storage','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Floor','room','nodemailer','</tr>','prod_secondunit','RoomAssign','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','max_product_unit','stock_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','types','</span>','DRY\x20STORAGE','Paid\x20For\x20Purchase','image','warehouse','success','filter','/give_payment/:id','../middleware/auth','Ambient','suppliers_docs','prod_code','finalize','$product','$finalize','/barcode_scanner','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_pallet','Rack\x20E','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','currency','prod_primunit','$secondary_unit','findById','RMSEmail','user','$product_details.level','here','<div>','\x20<\x20wew\x20>\x20','$maxProdPerUnit','$alertquantity','\x20</h2>','Return\x20Goods','\x20Order\x20Date\x20:\x20','$_id','$expiry_date','$product.floorlevel','</body></html>','string','paid_amount','German','1615290VVmcnM','room_name','<html><head><title></title>','$due_amount','primary_code_hide','slice','$unit','storage','1214425uiVKkZ','log','host','random','find','message','/view/add_purchases','$category','$name','JO_number','deliverycode','True','site_title','return_data','French','<!DOCTYPE\x20html>','Hindi','batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','\x20Order\x20Number\x20:\x20','all_purchases','params','return_product','actual_uom','prod_invoice','Enabled','<tr>','4dfSVUo','Rack\x20D','Error\x20Occurs','logo'];a0_0x2b12=function(){return _0x13540f;};return a0_0x2b12();}var ejs=require('ejs');const path=require('path'),users=require(a0_0x589dfb(0x23f));router[a0_0x589dfb(0x20e)](a0_0x589dfb(0x2a6),auth,async(_0x10db91,_0x264109)=>{var _0x10923c=a0_0x589dfb;try{const {username:_0xbf907a,email:_0x4cf9da,role:_0x23f6ea}=_0x10db91[_0x10923c(0x2ec)],_0x15aa24=_0x10db91[_0x10923c(0x2ec)],_0x43cd4d=await profile[_0x10923c(0x240)]({'email':_0x15aa24[_0x10923c(0x256)]}),_0x52e7c0=await staff['findOne']({'email':_0x15aa24[_0x10923c(0x256)]});if(_0x15aa24[_0x10923c(0x22a)]=='staff'){const _0x1a294b=await staff[_0x10923c(0x240)]({'email':_0x15aa24[_0x10923c(0x256)]});}const _0x5e1442=await master_shop[_0x10923c(0x1e1)]();let _0x396f70;if(_0x15aa24[_0x10923c(0x22a)]==_0x10923c(0x244)){const _0x1dcb8a=await staff[_0x10923c(0x240)]({'email':_0x15aa24[_0x10923c(0x256)]});_0x396f70=await purchases[_0x10923c(0x2b9)]([{'$match':{'warehouse_name':_0x1dcb8a[_0x10923c(0x2d5)]}},{'$lookup':{'from':_0x10923c(0x222),'localField':_0x10923c(0x222),'foreignField':'name','as':_0x10923c(0x2db)}},{'$unwind':_0x10923c(0x24a)},{'$unwind':_0x10923c(0x2de)},{'$group':{'_id':'$_id','invoice':{'$first':_0x10923c(0x261)},'suppliers':{'$first':_0x10923c(0x28a)},'date':{'$first':_0x10923c(0x291)},'warehouse_name':{'$first':_0x10923c(0x267)},'room':{'$first':'$room'},'product':{'$push':_0x10923c(0x2de)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x10923c(0x1d8)},'return_data':{'$first':_0x10923c(0x247)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x10923c(0x1cf)},'suppliers_docs':{'$first':_0x10923c(0x24a)},'total_product_quantity':{'$sum':_0x10923c(0x203)},'level':{'$addToSet':_0x10923c(0x231)},'isle':{'$addToSet':_0x10923c(0x2bf)},'type':{'$addToSet':_0x10923c(0x24d)},'floorlevel':{'$addToSet':_0x10923c(0x1d0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x396f70=await purchases[_0x10923c(0x2b9)]([{'$lookup':{'from':_0x10923c(0x222),'localField':_0x10923c(0x222),'foreignField':'name','as':_0x10923c(0x2db)}},{'$unwind':_0x10923c(0x24a)},{'$unwind':_0x10923c(0x2de)},{'$group':{'_id':_0x10923c(0x1ce),'invoice':{'$first':_0x10923c(0x261)},'suppliers':{'$first':_0x10923c(0x28a)},'date':{'$first':_0x10923c(0x291)},'warehouse_name':{'$first':_0x10923c(0x267)},'room':{'$addToSet':_0x10923c(0x28c)},'product':{'$push':_0x10923c(0x2de)},'note':{'$first':_0x10923c(0x21b)},'paid_amount':{'$first':_0x10923c(0x2ab)},'due_amount':{'$first':_0x10923c(0x1d8)},'return_data':{'$first':_0x10923c(0x247)},'batch_code':{'$first':_0x10923c(0x290)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x10923c(0x24a)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x10923c(0x231)},'isle':{'$addToSet':_0x10923c(0x2bf)},'type':{'$addToSet':_0x10923c(0x24d)},'floorlevel':{'$addToSet':_0x10923c(0x1d0)},'finalize':{'$first':_0x10923c(0x2df)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5e1442[0x0][_0x10923c(0x252)]==_0x10923c(0x22f)){var _0x526816=users[_0x10923c(0x2b5)];console[_0x10923c(0x1de)](_0x526816);}else{if(_0x5e1442[0x0][_0x10923c(0x252)]=='Hindi')var _0x526816=users[_0x10923c(0x1ed)];else{if(_0x5e1442[0x0][_0x10923c(0x252)]=='German')var _0x526816=users[_0x10923c(0x1d4)];else{if(_0x5e1442[0x0][_0x10923c(0x252)]==_0x10923c(0x275))var _0x526816=users['Spanish'];else{if(_0x5e1442[0x0][_0x10923c(0x252)]=='French')var _0x526816=users[_0x10923c(0x1eb)];else{if(_0x5e1442[0x0][_0x10923c(0x252)]=='Portuguese\x20(BR)')var _0x526816=users[_0x10923c(0x214)];else{if(_0x5e1442[0x0][_0x10923c(0x252)]=='Chinese')var _0x526816=users[_0x10923c(0x25f)];else{if(_0x5e1442[0x0][_0x10923c(0x252)]==_0x10923c(0x2a0))var _0x526816=users[_0x10923c(0x2aa)];}}}}}}}_0x264109[_0x10923c(0x25a)](_0x10923c(0x1f1),{'success':_0x10db91[_0x10923c(0x22e)](_0x10923c(0x2d6)),'errors':_0x10db91[_0x10923c(0x22e)](_0x10923c(0x262)),'purchases':_0x396f70,'role':_0x15aa24,'profile':_0x43cd4d,'master_shop':_0x5e1442,'language':_0x526816});}catch(_0x3d34e0){console[_0x10923c(0x1de)]('table\x20page',_0x3d34e0),_0x264109[_0x10923c(0x28d)](0xc8)[_0x10923c(0x28b)]({'message':_0x3d34e0[_0x10923c(0x1e2)]});}});function BayBinSelected(_0x4a342f,_0x25da8d){var _0x529511=a0_0x589dfb,_0x55e64a=[],_0x424bad=[],_0x18f6d8=[],_0x5de702=[],_0x9b4a15=[],_0x2aa086=[];let _0x3cc81b=[];if(_0x4a342f==_0x529511(0x2d2))switch(_0x25da8d){case _0x529511(0x206):_0x55e64a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x424bad=[0x1,0x2],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=[_0x529511(0x26d),_0x529511(0x2c6)],_0x9b4a15=['D'],_0x2aa086=['A'];break;case _0x529511(0x28f):_0x55e64a=[0x6,0x5,0x4,0x3,0x2,0x1],_0x424bad=[0x1,0x2],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=['Level',_0x529511(0x2c6)],_0x9b4a15=['D'],_0x2aa086=['B'];break;case _0x529511(0x27c):_0x55e64a=[0x0],_0x424bad=[0x0],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=[_0x529511(0x2c6)],_0x9b4a15=['D'],_0x2aa086=['S'];break;case _0x529511(0x2a3):_0x55e64a=[0x0],_0x424bad=[0x0],_0x5de702=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x18f6d8=['Floor'],_0x9b4a15=['D'],_0x2aa086=['R'];break;}else{if(_0x4a342f==_0x529511(0x2a2))switch(_0x25da8d){case _0x529511(0x206):_0x55e64a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x424bad=['B','F'],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=['Level','Floor'],_0x9b4a15=['C'],_0x2aa086=['A'];break;case _0x529511(0x28f):_0x55e64a=[0x5,0x4,0x3,0x2,0x1],_0x424bad=['F','B','S'],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=[_0x529511(0x26d),_0x529511(0x2c6)],_0x9b4a15=['C'],_0x2aa086=['B'];break;case'Rack\x20C':_0x55e64a=[0x1,0x2,0x3,0x4,0x5],_0x424bad=['B','F','S'],_0x5de702=[0x5,0x4,0x3,0x2,0x1],_0x18f6d8=[_0x529511(0x26d),_0x529511(0x2c6)],_0x9b4a15=['C'],_0x2aa086=['C'];break;case _0x529511(0x1f9):_0x55e64a=[0x5,0x4,0x3,0x2,0x1],_0x424bad=['F','B','S'],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=[_0x529511(0x26d),_0x529511(0x2c6)],_0x9b4a15=['C'],_0x2aa086=['D'];break;case _0x529511(0x2e5):_0x55e64a=[0x4,0x3,0x2,0x1],_0x424bad=[0x1,0x2],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=[_0x529511(0x26d),_0x529511(0x2c6)],_0x9b4a15=['C'],_0x2aa086=['E'];break;case'Rack\x20F':_0x55e64a=[0x1,0x2,0x3],_0x424bad=[0x1,0x2],_0x5de702=[0x1,0x2,0x3,0x4,0x5],_0x18f6d8=[_0x529511(0x26d)],_0x9b4a15=['C'],_0x2aa086=['F'];break;}}return{'levels':_0x55e64a,'Isle':_0x424bad,'rack':_0x5de702,'type':_0x18f6d8,'storage':_0x9b4a15,'rak':_0x2aa086};}function a0_0x3588(_0x459749,_0x4fefb3){var _0x2b12d3=a0_0x2b12();return a0_0x3588=function(_0x35881e,_0x53c02a){_0x35881e=_0x35881e-0x1c9;var _0x476847=_0x2b12d3[_0x35881e];return _0x476847;},a0_0x3588(_0x459749,_0x4fefb3);}async function getRandom8DigitNumber(){var _0x320a2c=a0_0x589dfb;const _0x4aec27=0x989680,_0x56eb97=0x5f5e0ff,_0x48b465=Math[_0x320a2c(0x23b)](Math[_0x320a2c(0x1e0)]()*(_0x56eb97-_0x4aec27+0x1))+_0x4aec27;var _0x471f97;const _0xd421cc=await purchases[_0x320a2c(0x240)]({'invoice':_0x320a2c(0x220)+_0x48b465});return _0xd421cc&&_0xd421cc[_0x320a2c(0x2b0)]>0x0?_0x471f97=_0x320a2c(0x220)+_0x48b465:_0x471f97=_0x320a2c(0x220)+_0x48b465,_0x471f97;}router[a0_0x589dfb(0x20e)](a0_0x589dfb(0x1e3),auth,async(_0x1b5dee,_0x377b67)=>{var _0x47fb6f=a0_0x589dfb;try{const {username:_0x5ea33a,email:_0x3bb66c,role:_0x4f6b6b}=_0x1b5dee[_0x47fb6f(0x2ec)],_0x3025c3=_0x1b5dee[_0x47fb6f(0x2ec)],_0x99a013=await profile[_0x47fb6f(0x240)]({'email':_0x3025c3[_0x47fb6f(0x256)]}),_0xbdc8cd=await master_shop[_0x47fb6f(0x1e1)](),_0x391303=await staff[_0x47fb6f(0x240)]({'email':_0x3025c3['email']}),_0x57d677=await suppliers[_0x47fb6f(0x1e1)]({});let _0x5443a2;if(_0x3025c3['role']==_0x47fb6f(0x244)){const _0x1e391e=await staff[_0x47fb6f(0x240)]({'email':_0x3025c3[_0x47fb6f(0x256)]});_0x5443a2=await warehouse[_0x47fb6f(0x2b9)]([{'$match':{'status':_0x47fb6f(0x1f6),'name':_0x1e391e[_0x47fb6f(0x2d5)],'warehouse_category':_0x47fb6f(0x2bc),'name':{'$ne':_0x47fb6f(0x1cc)}}},{'$group':{'_id':_0x47fb6f(0x1e5),'name':{'$first':'$name'}}}]);}else _0x5443a2=await warehouse[_0x47fb6f(0x2b9)]([{'$match':{'status':_0x47fb6f(0x1f6),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x47fb6f(0x1cc)}}},{'$group':{'_id':_0x47fb6f(0x1e5),'name':{'$first':_0x47fb6f(0x1e5)}}}]);const _0x9ab5c9=await product['find']({}),_0x34a5fb=await warehouse[_0x47fb6f(0x1e1)]({'status':_0x47fb6f(0x1f6)}),_0xce882c=await purchases[_0x47fb6f(0x1e1)]({}),_0x3cbe34=_0xce882c['length']+0x1,_0x25f3d8=_0x47fb6f(0x220)+_0x3cbe34[_0x47fb6f(0x200)]()[_0x47fb6f(0x257)](0x5,'0');var _0x12a9cc=[_0x47fb6f(0x2da),_0x47fb6f(0x26f)];if(_0xbdc8cd[0x0][_0x47fb6f(0x252)]==_0x47fb6f(0x22f))var _0x14dbc2=users[_0x47fb6f(0x2b5)];else{if(_0xbdc8cd[0x0][_0x47fb6f(0x252)]==_0x47fb6f(0x1ed))var _0x14dbc2=users[_0x47fb6f(0x1ed)];else{if(_0xbdc8cd[0x0][_0x47fb6f(0x252)]==_0x47fb6f(0x1d4))var _0x14dbc2=users['German'];else{if(_0xbdc8cd[0x0]['language']==_0x47fb6f(0x275))var _0x14dbc2=users['Spanish'];else{if(_0xbdc8cd[0x0][_0x47fb6f(0x252)]==_0x47fb6f(0x1eb))var _0x14dbc2=users[_0x47fb6f(0x1eb)];else{if(_0xbdc8cd[0x0]['language']==_0x47fb6f(0x216))var _0x14dbc2=users['Portuguese'];else{if(_0xbdc8cd[0x0][_0x47fb6f(0x252)]==_0x47fb6f(0x25f))var _0x14dbc2=users[_0x47fb6f(0x25f)];else{if(_0xbdc8cd[0x0][_0x47fb6f(0x252)]==_0x47fb6f(0x2a0))var _0x14dbc2=users[_0x47fb6f(0x2aa)];}}}}}}}const _0x509e72=getRandom8DigitNumber();_0x509e72[_0x47fb6f(0x24c)](_0x2a74fb=>{var _0x593e5a=_0x47fb6f;_0x377b67['render'](_0x593e5a(0x28e),{'success':_0x1b5dee[_0x593e5a(0x22e)](_0x593e5a(0x2d6)),'errors':_0x1b5dee[_0x593e5a(0x22e)](_0x593e5a(0x262)),'role':_0x3025c3,'profile':_0x99a013,'suppliers':_0x57d677,'warehouse':_0x5443a2,'product':_0x9ab5c9,'invoice':_0x2a74fb,'master_shop':_0xbdc8cd,'language':_0x14dbc2,'find_data':_0x34a5fb,'rooms_data':_0x12a9cc});})[_0x47fb6f(0x20b)](_0x5c0983=>{var _0x368eab=_0x47fb6f;_0x1b5dee[_0x368eab(0x22e)](_0x368eab(0x262),_0x368eab(0x237)),_0x377b67[_0x368eab(0x29d)]('/all_purchases/view');});}catch(_0x462cc9){console[_0x47fb6f(0x1de)](_0x462cc9);}}),router[a0_0x589dfb(0x20e)](a0_0x589dfb(0x23c),auth,async(_0x2a4678,_0x55f9fc)=>{var _0x3d5a9f=a0_0x589dfb;try{const _0x5e2c01=_0x2a4678[_0x3d5a9f(0x1f2)]['id'];console[_0x3d5a9f(0x1de)](_0x5e2c01);const _0xb20338=await master_shop[_0x3d5a9f(0x1e1)]();console[_0x3d5a9f(0x1de)](_0x3d5a9f(0x255),_0xb20338);const _0x33afe6=await product[_0x3d5a9f(0x240)]({'name':_0x5e2c01});console[_0x3d5a9f(0x1de)](_0x3d5a9f(0x297),_0x33afe6),_0x55f9fc[_0x3d5a9f(0x28d)](0xc8)['json']({'product_data':_0x33afe6,'master':_0xb20338});}catch(_0x567e96){console[_0x3d5a9f(0x1de)]('add_purchases\x20error',_0x567e96);}}),router[a0_0x589dfb(0x1ff)](a0_0x589dfb(0x1e3),auth,async(_0x39018e,_0x2861ec)=>{var _0x501930=a0_0x589dfb;try{const {invoice:_0x141349,date:_0x350152,warehouse_name:_0x26101c,prod_name:_0x355143,prod_code:_0x96e32a,prod_qty:_0x1d2f39,prod_unit:_0x3acc29,prod_secondunit:_0x1826a0,prod_level:_0x365417,prod_isle:_0x529b23,prod_pallet:_0x51573e,note:_0x3f0eb9,expiry_date:_0x533720,batch_code:_0x487b80,payable:_0x120df7,due_amount:_0x10445d,Room_name:_0x2cd003,primary_code:_0x2be10e,secondary_code:_0x19dd90,MaxStocks_data:_0x35c17d,PO_number:_0xc63e77,SCRN:_0x11490d,JO_number:_0x2b09af}=_0x39018e['body'];if(typeof _0x355143=='string')var _0x1780dd=[_0x39018e[_0x501930(0x22d)][_0x501930(0x27a)]],_0x1338c5=[_0x39018e[_0x501930(0x22d)]['prod_code']],_0x80814d=[_0x39018e[_0x501930(0x22d)][_0x501930(0x25b)]],_0x4acd37=[_0x39018e[_0x501930(0x22d)]['prod_primunit']],_0x1e0276=[_0x39018e[_0x501930(0x22d)][_0x501930(0x2ca)]],_0x212994=[_0x39018e[_0x501930(0x22d)]['prod_level']],_0x25697c=[_0x39018e[_0x501930(0x22d)]['primary_code']],_0x183b8b=[_0x39018e['body']['secondary_code']],_0x35effc=[_0x39018e[_0x501930(0x22d)][_0x501930(0x2bd)]],_0x51f8f7=[_0x39018e[_0x501930(0x22d)][_0x501930(0x1ee)]],_0x4983fb=[_0x39018e[_0x501930(0x22d)][_0x501930(0x273)]],_0xcd1806=[_0x39018e['body'][_0x501930(0x2cd)]],_0x334ee5=[_0x39018e[_0x501930(0x22d)][_0x501930(0x268)]],_0x280e6a=[_0x39018e[_0x501930(0x22d)][_0x501930(0x269)]],_0x1b2081=[_0x39018e[_0x501930(0x22d)][_0x501930(0x283)]],_0x3c94de=[_0x39018e[_0x501930(0x22d)]['RoomAssign']],_0x23d1c1=[_0x39018e['body'][_0x501930(0x1e7)]],_0x2c777b=[_0x39018e['body'][_0x501930(0x1f5)]],_0x4df226=[_0x39018e['body'][_0x501930(0x25d)]],_0x25c746=[_0x39018e[_0x501930(0x22d)]['actual_uom']];else var _0x1780dd=[..._0x39018e['body']['prod_name']],_0x1338c5=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x2dc)]],_0x80814d=[..._0x39018e['body'][_0x501930(0x25b)]],_0x4acd37=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x2e8)]],_0x1e0276=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x2ca)]],_0x212994=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x230)]],_0x25697c=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x271)]],_0x183b8b=[..._0x39018e['body'][_0x501930(0x2b4)]],_0x35effc=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x2bd)]],_0x51f8f7=[..._0x39018e[_0x501930(0x22d)]['batch_code']],_0x4983fb=[..._0x39018e['body'][_0x501930(0x273)]],_0xcd1806=[..._0x39018e['body'][_0x501930(0x2cd)]],_0x334ee5=[..._0x39018e['body'][_0x501930(0x268)]],_0x280e6a=[..._0x39018e['body']['production_date']],_0x1b2081=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x283)]],_0x3c94de=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x2cb)]],_0x23d1c1=[..._0x39018e[_0x501930(0x22d)]['deliverycode']],_0x2c777b=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x1f5)]],_0x4df226=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x25d)]],_0x25c746=[..._0x39018e[_0x501930(0x22d)][_0x501930(0x1f4)]];const _0x51120e=_0x1780dd['map'](_0x1194ee=>{return _0x1194ee={'product_name':_0x1194ee};});_0x4df226[_0x501930(0x29e)]((_0x2de0de,_0x164ad2)=>{var _0x1ff8d5=_0x501930;_0x51120e[_0x164ad2]['actual_qty']=Math[_0x1ff8d5(0x26e)](_0x2de0de);}),_0x25c746[_0x501930(0x29e)]((_0xc59a1f,_0x810cfc)=>{_0x51120e[_0x810cfc]['actual_uom']=_0xc59a1f;}),_0x1338c5[_0x501930(0x29e)]((_0x1acf3b,_0x55669b)=>{var _0x3f19fe=_0x501930;_0x51120e[_0x55669b][_0x3f19fe(0x287)]=_0x1acf3b;}),_0x80814d[_0x501930(0x29e)]((_0x119806,_0x5ac56d)=>{_0x51120e[_0x5ac56d]['quantity']=Math['abs'](_0x119806);}),_0x4acd37['forEach']((_0x1b9f9e,_0x64e046)=>{var _0x35254d=_0x501930;_0x51120e[_0x64e046][_0x35254d(0x296)]=_0x1b9f9e;}),_0x1e0276[_0x501930(0x29e)]((_0x16cfa4,_0x53c45e)=>{_0x51120e[_0x53c45e]['secondary_unit']=_0x16cfa4;}),_0x212994[_0x501930(0x29e)]((_0x386ac2,_0x26b269)=>{_0x3c94de['forEach']((_0x439420,_0x38ed4e)=>{var _0x1c671b=a0_0x3588;if(_0x439420==_0x1c671b(0x2a3)&&_0x26b269==_0x38ed4e){console[_0x1c671b(0x1de)](_0x439420+_0x1c671b(0x2f0)+_0x26b269+_0x1c671b(0x238)+_0x38ed4e+_0x1c671b(0x238)+_0x386ac2);var _0x232ea6=_0x386ac2[_0x1c671b(0x1da)](0x3);_0x51120e[_0x26b269][_0x1c671b(0x1dc)]=_0x386ac2[0x0],_0x51120e[_0x26b269][_0x1c671b(0x292)]=_0x386ac2[0x1],_0x51120e[_0x26b269][_0x1c671b(0x2ba)]=0x0,_0x51120e[_0x26b269][_0x1c671b(0x2bb)]=0x0,_0x51120e[_0x26b269][_0x1c671b(0x245)]=_0x1c671b(0x2c6),_0x51120e[_0x26b269][_0x1c671b(0x265)]=_0x232ea6;}else{if(_0x439420=='Shelves'&&_0x26b269==_0x38ed4e){var _0x232ea6=_0x386ac2['slice'](0x3);_0x51120e[_0x26b269][_0x1c671b(0x1dc)]=_0x386ac2[0x0],_0x51120e[_0x26b269]['rack']=_0x386ac2[0x1],_0x51120e[_0x26b269]['bay']=0x0,_0x51120e[_0x26b269][_0x1c671b(0x2bb)]=0x0,_0x51120e[_0x26b269][_0x1c671b(0x245)]=_0x1c671b(0x2c6),_0x51120e[_0x26b269][_0x1c671b(0x265)]=_0x386ac2[0x5];}else{if(_0x26b269==_0x38ed4e){if(_0x386ac2[0x0]=='A'&&_0x386ac2[0x1]=='L'&&_0x386ac2[0x2]=='L')console['log'](_0x439420+'\x20<>\x20'+_0x26b269+_0x1c671b(0x238)+_0x38ed4e+_0x1c671b(0x238)+_0x386ac2+_0x1c671b(0x2ee)),_0x51120e[_0x26b269][_0x1c671b(0x1dc)]=_0x386ac2[0x0],_0x51120e[_0x26b269][_0x1c671b(0x292)]=_0x386ac2[0x1],_0x51120e[_0x26b269][_0x1c671b(0x2ba)]=0x0,_0x51120e[_0x26b269][_0x1c671b(0x2bb)]=0x0,_0x51120e[_0x26b269][_0x1c671b(0x245)]='Floor',_0x51120e[_0x26b269][_0x1c671b(0x265)]=_0x386ac2[0x3];else{var _0x22fc4c;if(_0x386ac2[0x4]=='L')_0x22fc4c='Level';else _0x386ac2[0x4]=='F'&&(_0x22fc4c=_0x1c671b(0x2c6));_0x51120e[_0x26b269][_0x1c671b(0x1dc)]=_0x386ac2[0x0],_0x51120e[_0x26b269][_0x1c671b(0x292)]=_0x386ac2[0x1],_0x51120e[_0x26b269][_0x1c671b(0x2ba)]=_0x386ac2[0x2],_0x51120e[_0x26b269][_0x1c671b(0x2bb)]=_0x386ac2[0x3],_0x51120e[_0x26b269][_0x1c671b(0x245)]=_0x22fc4c,_0x51120e[_0x26b269][_0x1c671b(0x265)]=_0x386ac2[0x5];}}}}});}),_0x25697c[_0x501930(0x29e)]((_0x228d62,_0x5a6f09)=>{_0x51120e[_0x5a6f09]['primary_code']=_0x228d62;}),_0x183b8b['forEach']((_0x2dfcef,_0x4a1bf0)=>{var _0x52ced9=_0x501930;_0x51120e[_0x4a1bf0][_0x52ced9(0x2b4)]=_0x2dfcef;}),_0x35effc[_0x501930(0x29e)]((_0x140bc7,_0x51c40e)=>{_0x51120e[_0x51c40e]['maxStocks']=_0x140bc7;}),_0x51f8f7['forEach']((_0x22c14d,_0x176424)=>{var _0x5a73f0=_0x501930;_0x51120e[_0x176424][_0x5a73f0(0x1ee)]=_0x22c14d;}),_0x4983fb[_0x501930(0x29e)]((_0x589c57,_0x21d8aa)=>{var _0x439b3c=_0x501930;_0x51120e[_0x21d8aa][_0x439b3c(0x273)]=_0x589c57;}),_0xcd1806[_0x501930(0x29e)]((_0x584df4,_0x3f88d6)=>{var _0x155a33=_0x501930;_0x51120e[_0x3f88d6][_0x155a33(0x293)]=_0x584df4;}),_0x334ee5['forEach']((_0x4d8255,_0x27ff4d)=>{var _0x2b3b63=_0x501930;_0x51120e[_0x27ff4d][_0x2b3b63(0x268)]=_0x4d8255;}),_0x280e6a[_0x501930(0x29e)]((_0x5b0d4e,_0x25f16d)=>{var _0x520ce0=_0x501930;_0x51120e[_0x25f16d][_0x520ce0(0x269)]=_0x5b0d4e;}),_0x1b2081[_0x501930(0x29e)]((_0xfb4478,_0xfc6324)=>{var _0x15335f=_0x501930;_0x51120e[_0xfc6324][_0x15335f(0x298)]=_0xfb4478;}),_0x3c94de[_0x501930(0x29e)]((_0x2cf792,_0x1fba63)=>{var _0x5d617a=_0x501930;_0x51120e[_0x1fba63][_0x5d617a(0x1d6)]=_0x2cf792;}),_0x23d1c1[_0x501930(0x29e)]((_0x4301ec,_0x38b352)=>{_0x51120e[_0x38b352]['delivery_code']=_0x4301ec;}),_0x2c777b[_0x501930(0x29e)]((_0x5853b7,_0x3e5614)=>{var _0x2d7c36=_0x501930;_0x51120e[_0x3e5614][_0x2d7c36(0x2c2)]=_0x5853b7;});const _0x2cc1c5=_0x3c94de[_0x501930(0x232)](_0x3d8c0e=>{return _0x3d8c0e={'room_name':_0x3d8c0e};}),_0x1748b1=_0x51120e[_0x501930(0x2d7)](_0x42b322=>_0x42b322['quantity']!=='0'&&_0x42b322[_0x501930(0x217)]!==''),_0x2c0b35=new purchases({'invoice':_0x141349,'suppliers':_0x39018e[_0x501930(0x22d)][_0x501930(0x222)],'date':_0x350152,'warehouse_name':_0x26101c,'product':_0x1748b1,'note':_0x3f0eb9,'due_amount':_0x10445d,'POnumber':_0xc63e77,'SCRN':_0x11490d,'JO_number':_0x2b09af,'roomList':_0x2cc1c5}),_0x35cb87=await _0x2c0b35[_0x501930(0x299)](),_0x539c1f=await purchases[_0x501930(0x240)]({'invoice':_0x141349}),_0x50056d=_0x539c1f[_0x501930(0x297)]['map'](async _0x1c6545=>{var _0x1af39b=_0x501930,_0x44f355=await warehouse[_0x1af39b(0x240)]({'name':_0x26101c,'room':_0x1c6545[_0x1af39b(0x1d6)]}),_0x5cf8a=0x0;return _0x44f355['product_details'][_0x1af39b(0x29e)](_0x4a9141=>{var _0x562066=_0x1af39b;_0x4a9141[_0x562066(0x2af)]==_0x1c6545[_0x562066(0x2af)]&&_0x4a9141[_0x562066(0x265)]==_0x1c6545[_0x562066(0x265)]&&_0x4a9141['type']==_0x1c6545[_0x562066(0x245)]&&_0x4a9141[_0x562066(0x2bb)]==_0x1c6545[_0x562066(0x2bb)]&&_0x4a9141[_0x562066(0x2ba)]==_0x1c6545[_0x562066(0x2ba)]&&_0x4a9141['rack']==_0x1c6545[_0x562066(0x292)]&&_0x4a9141['storage']==_0x1c6545[_0x562066(0x1dc)]&&_0x4a9141[_0x562066(0x273)]==_0x1c6545[_0x562066(0x273)]&&_0x4a9141[_0x562066(0x1ee)]==_0x1c6545[_0x562066(0x1ee)]&&_0x4a9141[_0x562066(0x269)]==_0x1c6545[_0x562066(0x269)]&&_0x4a9141[_0x562066(0x2c2)]==_0x539c1f[_0x562066(0x2c2)]&&(_0x4a9141['product_stock']+=Math[_0x562066(0x26e)](_0x1c6545['quantity']),_0x5cf8a++);}),_0x5cf8a===0x0&&_0x44f355[_0x1af39b(0x26a)][_0x1af39b(0x20f)]({'product_name':_0x1c6545['product_name'],'product_stock':Math[_0x1af39b(0x26e)](_0x1c6545['quantity']),'primary_code':_0x1c6545[_0x1af39b(0x271)],'secondary_code':_0x1c6545[_0x1af39b(0x2b4)],'product_code':_0x1c6545[_0x1af39b(0x287)],'storage':_0x1c6545[_0x1af39b(0x1dc)],'rack':_0x1c6545['rack'],'bay':_0x1c6545[_0x1af39b(0x2ba)],'bin':_0x1c6545[_0x1af39b(0x2bb)],'type':_0x1c6545[_0x1af39b(0x245)],'floorlevel':_0x1c6545['floorlevel'],'maxProducts':_0x1c6545[_0x1af39b(0x221)],'unit':_0x1c6545[_0x1af39b(0x296)],'secondary_unit':_0x1c6545[_0x1af39b(0x249)],'expiry_date':_0x1c6545[_0x1af39b(0x273)],'maxPerUnit':_0x1c6545[_0x1af39b(0x293)],'batch_code':_0x1c6545[_0x1af39b(0x1ee)],'alertQTY':_0x1c6545[_0x1af39b(0x268)],'production_date':_0x1c6545[_0x1af39b(0x269)],'product_cat':_0x1c6545[_0x1af39b(0x298)],'invoice':_0x1c6545[_0x1af39b(0x2c2)],'actual_qty':Math[_0x1af39b(0x26e)](_0x1c6545[_0x1af39b(0x25d)]),'actual_uom':_0x1c6545[_0x1af39b(0x1f4)]}),_0x44f355;});Promise['all'](_0x50056d)[_0x501930(0x24c)](async _0x4a9818=>{var _0x5be59b=_0x501930;try{for(const _0xbed19d of _0x4a9818){await _0xbed19d['save']();}const _0x655fca=await master_shop[_0x5be59b(0x1e1)](),_0x4ff307=await email_settings[_0x5be59b(0x240)](),_0x417e48=await supervisor_settings[_0x5be59b(0x1e1)]();var _0x4b094a=_0x539c1f[_0x5be59b(0x297)],_0x15c809='',_0x536ebf;for(_0x536ebf in _0x4b094a){_0x15c809+=_0x5be59b(0x1f7)+_0x5be59b(0x1fd)+_0x4b094a[_0x536ebf][_0x5be59b(0x2af)]+_0x5be59b(0x2a9)+_0x5be59b(0x1fd)+_0x4b094a[_0x536ebf][_0x5be59b(0x287)]+_0x5be59b(0x2a9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b094a[_0x536ebf][_0x5be59b(0x217)]+'</td>'+_0x5be59b(0x1fd)+_0x4b094a[_0x536ebf][_0x5be59b(0x296)]+_0x5be59b(0x2a9)+_0x5be59b(0x1fd)+_0x4b094a[_0x536ebf][_0x5be59b(0x249)]+'</td>'+_0x5be59b(0x1fd)+_0x539c1f[_0x5be59b(0x21f)]+_0x5be59b(0x2a9)+_0x5be59b(0x1fd)+_0x4b094a[_0x536ebf][_0x5be59b(0x1d6)]+_0x5be59b(0x2a9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b094a[_0x536ebf][_0x5be59b(0x1dc)]+_0x4b094a[_0x536ebf][_0x5be59b(0x292)]+_0x4b094a[_0x536ebf][_0x5be59b(0x2ba)]+_0x4b094a[_0x536ebf][_0x5be59b(0x2bb)]+_0x4b094a[_0x536ebf][_0x5be59b(0x245)][0x0]+_0x4b094a[_0x536ebf][_0x5be59b(0x265)]+_0x5be59b(0x2a9),'</tr>';}let _0x12688c=nodemailer[_0x5be59b(0x295)]({'host':_0x4ff307[_0x5be59b(0x1df)],'port':Number(_0x4ff307[_0x5be59b(0x24b)]),'secure':![],'auth':{'user':_0x4ff307['email'],'pass':_0x4ff307[_0x5be59b(0x246)]}}),_0x26df4a={'from':_0x4ff307['email'],'to':_0x417e48[0x0][_0x5be59b(0x2eb)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x5be59b(0x29c),'path':__dirname+_0x5be59b(0x27d)+_0x5be59b(0x29b)+_0x655fca[0x0][_0x5be59b(0x2d4)],'cid':_0x5be59b(0x1fb)}],'html':'<!DOCTYPE\x20html>'+_0x5be59b(0x1d7)+'</head><body>'+'<div>'+_0x5be59b(0x2e6)+_0x5be59b(0x2ef)+_0x5be59b(0x2cf)+_0x5be59b(0x264)+_0x5be59b(0x2ef)+_0x5be59b(0x29f)+_0x655fca[0x0]['site_title']+_0x5be59b(0x1cb)+'</div>'+_0x5be59b(0x264)+_0x5be59b(0x259)+_0x5be59b(0x2ef)+_0x5be59b(0x20d)+_0x5be59b(0x1f0)+_0x539c1f[_0x5be59b(0x2c2)]+'\x20'+_0x5be59b(0x274)+_0x5be59b(0x1cd)+_0x539c1f[_0x5be59b(0x223)]+'\x20'+'</span>'+'</h5>'+_0x5be59b(0x264)+_0x5be59b(0x242)+_0x5be59b(0x209)+_0x5be59b(0x1f7)+_0x5be59b(0x2e2)+_0x5be59b(0x2a7)+_0x5be59b(0x2e3)+_0x5be59b(0x27b)+_0x5be59b(0x25c)+_0x5be59b(0x23e)+_0x5be59b(0x278)+_0x5be59b(0x2c5)+_0x5be59b(0x2c9)+'</thead>'+_0x5be59b(0x205)+'\x20'+_0x15c809+'\x20'+_0x5be59b(0x251)+_0x5be59b(0x219)+_0x5be59b(0x2ef)+'<strong>\x20Regards\x20</strong>'+_0x5be59b(0x22c)+_0x655fca[0x0][_0x5be59b(0x1e9)]+_0x5be59b(0x233)+_0x5be59b(0x264)+_0x5be59b(0x264)+_0x5be59b(0x1d1)};_0x12688c[_0x5be59b(0x21a)](_0x26df4a,function(_0x261c98,_0x1b0010){var _0x23f3c5=_0x5be59b;_0x261c98?(console['log'](_0x261c98),console['log'](_0x23f3c5(0x1fa))):console['log'](_0x23f3c5(0x241));}),_0x39018e['flash'](_0x5be59b(0x2d6),_0x5be59b(0x202)),_0x2861ec[_0x5be59b(0x29d)](_0x5be59b(0x279));}catch(_0x544169){console['error'](_0x544169),_0x2861ec['status'](0x1f4)[_0x5be59b(0x28b)]({'error':_0x5be59b(0x1ef)});}})[_0x501930(0x20b)](_0x42c0e6=>{var _0xbedb32=_0x501930;console[_0xbedb32(0x2b7)](_0x42c0e6),_0x2861ec['status'](0x1f4)[_0xbedb32(0x28b)]({'error':_0xbedb32(0x1fc)});});}catch(_0x4ae067){console[_0x501930(0x1de)](_0x4ae067);}}),router['get'](a0_0x589dfb(0x266),auth,async(_0x132b15,_0x26364f)=>{var _0x230af5=a0_0x589dfb;try{const {username:_0x1b21f7,email:_0x4ee8a2,role:_0x9b9da9}=_0x132b15[_0x230af5(0x2ec)],_0x22c485=_0x132b15[_0x230af5(0x2ec)],_0x284a41=await profile[_0x230af5(0x240)]({'email':_0x22c485[_0x230af5(0x256)]}),_0x166393=await master_shop[_0x230af5(0x1e1)](),_0x192faa=_0x132b15['params']['id'],_0x269027=await purchases[_0x230af5(0x2ea)](_0x192faa),_0x18a270=await warehouse[_0x230af5(0x2b9)]([{'$match':{'name':_0x269027['warehouse_name'],'room':_0x269027[_0x230af5(0x2c7)]}},{'$unwind':_0x230af5(0x26c)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x230af5(0x277)},'bay':{'$first':_0x230af5(0x294)},'bin':{'$first':_0x230af5(0x25e)},'type':{'$first':_0x230af5(0x1fe)},'floorlevel':{'$first':_0x230af5(0x2ad)},'primary_code':{'$first':_0x230af5(0x21c)},'secondary_code':{'$first':_0x230af5(0x228)},'product_code':{'$first':_0x230af5(0x260)},'storage':{'$first':_0x230af5(0x2c3)},'rack':{'$first':_0x230af5(0x229)},'expiry_date':{'$first':_0x230af5(0x226)}}}]),_0x415a93=await customer[_0x230af5(0x1e1)]({});let _0x524b16;if(_0x22c485[_0x230af5(0x22a)]==_0x230af5(0x244)){const _0x2adae3=await staff[_0x230af5(0x240)]({'email':_0x22c485[_0x230af5(0x256)]});_0x524b16=await warehouse[_0x230af5(0x2b9)]([{'$match':{'status':_0x230af5(0x1f6),'name':_0x2adae3[_0x230af5(0x2d5)]}},{'$group':{'_id':_0x230af5(0x1e5),'name':{'$first':_0x230af5(0x1e5)}}}]);}else _0x524b16=await warehouse[_0x230af5(0x2b9)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x230af5(0x1e5),'name':{'$first':_0x230af5(0x1e5)}}}]);const _0x250f37=await product[_0x230af5(0x1e1)]({}),_0x16052b=await suppliers['find']({}),_0x5e15cd=BayBinSelected(_0x269027['warehouse_name'],_0x269027[_0x230af5(0x2c7)]);if(_0x166393[0x0][_0x230af5(0x252)]==_0x230af5(0x22f)){var _0x4d00a9=users['English'];console[_0x230af5(0x1de)](_0x4d00a9);}else{if(_0x166393[0x0][_0x230af5(0x252)]=='Hindi')var _0x4d00a9=users[_0x230af5(0x1ed)];else{if(_0x166393[0x0][_0x230af5(0x252)]=='German')var _0x4d00a9=users[_0x230af5(0x1d4)];else{if(_0x166393[0x0][_0x230af5(0x252)]==_0x230af5(0x275))var _0x4d00a9=users['Spanish'];else{if(_0x166393[0x0]['language']==_0x230af5(0x1eb))var _0x4d00a9=users[_0x230af5(0x1eb)];else{if(_0x166393[0x0][_0x230af5(0x252)]==_0x230af5(0x216))var _0x4d00a9=users['Portuguese'];else{if(_0x166393[0x0][_0x230af5(0x252)]=='Chinese')var _0x4d00a9=users['Chinese'];else{if(_0x166393[0x0][_0x230af5(0x252)]==_0x230af5(0x2a0))var _0x4d00a9=users[_0x230af5(0x2aa)];}}}}}}}_0x26364f[_0x230af5(0x25a)]('edit_purchases_view',{'success':_0x132b15[_0x230af5(0x22e)](_0x230af5(0x2d6)),'errors':_0x132b15[_0x230af5(0x22e)](_0x230af5(0x262)),'role':_0x22c485,'profile':_0x284a41,'customer':_0x415a93,'warehouse':_0x524b16,'product':_0x18a270,'user':_0x269027,'master_shop':_0x166393,'unit':_0x250f37,'language':_0x4d00a9,'suppliers':_0x16052b,'dataSelected':_0x5e15cd});}catch(_0x50c587){console[_0x230af5(0x1de)](_0x50c587);}}),router[a0_0x589dfb(0x1ff)](a0_0x589dfb(0x266),auth,async(_0x1a5fcc,_0x14452a)=>{var _0x302831=a0_0x589dfb;try{const _0x15f819=_0x1a5fcc['params']['id'],{invoice:_0x39c736,warehouse_name:_0x15c22a,Room_name:_0x208d73}=_0x1a5fcc[_0x302831(0x22d)],_0x21c695=await warehouse['findOne']({'name':_0x15c22a,'room':_0x208d73}),_0x3f4a74=await purchases[_0x302831(0x240)]({'invoice':_0x39c736});_0x3f4a74[_0x302831(0x297)][_0x302831(0x29e)](_0x55f50b=>{var _0x2315de=_0x302831,_0x2d4fc8=0x0;const _0x7d2e85=_0x21c695['product_details']['map'](_0x12aaa1=>{var _0x168dbb=a0_0x3588;_0x12aaa1[_0x168dbb(0x2af)]==_0x55f50b[_0x168dbb(0x2af)]&&_0x12aaa1[_0x168dbb(0x265)]==_0x55f50b[_0x168dbb(0x265)]&&_0x12aaa1[_0x168dbb(0x245)]==_0x55f50b[_0x168dbb(0x245)]&&_0x12aaa1['bin']==_0x55f50b[_0x168dbb(0x2bb)]&&_0x12aaa1[_0x168dbb(0x2ba)]==_0x55f50b[_0x168dbb(0x2ba)]&&_0x12aaa1[_0x168dbb(0x292)]==_0x55f50b[_0x168dbb(0x292)]&&_0x12aaa1[_0x168dbb(0x1dc)]==_0x55f50b[_0x168dbb(0x1dc)]&&_0x12aaa1['expiry_date']==_0x55f50b[_0x168dbb(0x273)]&&_0x12aaa1['batch_code']==_0x55f50b[_0x168dbb(0x1ee)]&&_0x12aaa1[_0x168dbb(0x269)]==_0x55f50b[_0x168dbb(0x269)]&&_0x12aaa1['delivery_date']==_0x55f50b['delivery_date']&&_0x12aaa1['delivery_code']==_0x55f50b[_0x168dbb(0x21d)]&&(_0x12aaa1['product_stock']=parseInt(_0x12aaa1[_0x168dbb(0x2b3)])+parseInt(_0x55f50b[_0x168dbb(0x217)]),_0x2d4fc8++);});_0x2d4fc8=='0'&&(_0x21c695[_0x2315de(0x26a)]=_0x21c695[_0x2315de(0x26a)][_0x2315de(0x288)]({'product_name':_0x55f50b['product_name'],'product_stock':_0x55f50b[_0x2315de(0x217)],'primary_code':_0x55f50b[_0x2315de(0x271)],'secondary_code':_0x55f50b[_0x2315de(0x2b4)],'product_code':_0x55f50b['product_code'],'storage':_0x55f50b[_0x2315de(0x1dc)],'rack':_0x55f50b['rack'],'bay':_0x55f50b[_0x2315de(0x2ba)],'bin':_0x55f50b[_0x2315de(0x2bb)],'type':_0x55f50b[_0x2315de(0x245)],'floorlevel':_0x55f50b[_0x2315de(0x265)],'maxProducts':_0x55f50b[_0x2315de(0x221)],'unit':_0x55f50b[_0x2315de(0x296)],'secondary_unit':_0x55f50b[_0x2315de(0x249)],'expiry_date':_0x55f50b['expiry_date'],'maxPerUnit':_0x55f50b['maxperunit'],'batch_code':_0x55f50b[_0x2315de(0x1ee)],'alertQTY':_0x55f50b[_0x2315de(0x268)],'production_date':_0x55f50b['production_date'],'delivery_date':_0x55f50b[_0x2315de(0x234)],'delivery_code':_0x55f50b['delivery_code']}));}),await _0x21c695[_0x302831(0x299)](),_0x3f4a74[_0x302831(0x2dd)]=_0x302831(0x1e8);const _0x23eaa2=await _0x3f4a74['save']();_0x1a5fcc[_0x302831(0x22e)]('success',_0x302831(0x23a)),_0x14452a['redirect'](_0x302831(0x225));}catch(_0x71c31){console[_0x302831(0x1de)](_0x71c31);}}),router['get']('/view/:id',auth,async(_0x355b20,_0x498156)=>{var _0x17a4d5=a0_0x589dfb;try{const {username:_0x10e6eb,email:_0x142640,role:_0x3c827f}=_0x355b20[_0x17a4d5(0x2ec)],_0x19ddbf=_0x355b20[_0x17a4d5(0x2ec)],_0x288d94=await profile[_0x17a4d5(0x240)]({'email':_0x19ddbf[_0x17a4d5(0x256)]}),_0x4ad608=await master_shop['find'](),_0x27d390=_0x355b20[_0x17a4d5(0x1f2)]['id'],_0xa0471a=await purchases[_0x17a4d5(0x2ea)](_0x27d390),_0x2f719a=await suppliers[_0x17a4d5(0x1e1)]({});let _0x1ee9ff;if(_0x19ddbf[_0x17a4d5(0x22a)]==_0x17a4d5(0x244)){const _0x50a899=await staff[_0x17a4d5(0x240)]({'email':_0x19ddbf[_0x17a4d5(0x256)]});_0x1ee9ff=await warehouse[_0x17a4d5(0x1e1)]({'status':'Enabled','name':_0x50a899[_0x17a4d5(0x2d5)],'warehouse_category':_0x17a4d5(0x2bc)});}else _0x1ee9ff=await warehouse[_0x17a4d5(0x2b9)]([{'$match':{'status':'Enabled','warehouse_category':_0x17a4d5(0x2bc)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0xe5e02c=await product['find']({}),_0x2a3753=BayBinSelected(_0xa0471a[_0x17a4d5(0x21f)],_0xa0471a[_0x17a4d5(0x2c7)]);let _0x446ac5=new Date(_0xa0471a['expiry_date']),_0x3fe5d7=('0'+_0x446ac5[_0x17a4d5(0x29a)]())[_0x17a4d5(0x1da)](-0x2),_0x335a3d=('0'+(_0x446ac5[_0x17a4d5(0x285)]()+0x1))['slice'](-0x2),_0x2fe415=_0x446ac5['getFullYear'](),_0x42d889=_0x2fe415+'-'+_0x335a3d+'-'+_0x3fe5d7;if(_0x4ad608[0x0][_0x17a4d5(0x252)]==_0x17a4d5(0x22f)){var _0x3742df=users[_0x17a4d5(0x2b5)];console[_0x17a4d5(0x1de)](_0x3742df);}else{if(_0x4ad608[0x0][_0x17a4d5(0x252)]==_0x17a4d5(0x1ed))var _0x3742df=users[_0x17a4d5(0x1ed)];else{if(_0x4ad608[0x0]['language']==_0x17a4d5(0x1d4))var _0x3742df=users[_0x17a4d5(0x1d4)];else{if(_0x4ad608[0x0][_0x17a4d5(0x252)]==_0x17a4d5(0x275))var _0x3742df=users[_0x17a4d5(0x275)];else{if(_0x4ad608[0x0][_0x17a4d5(0x252)]=='French')var _0x3742df=users[_0x17a4d5(0x1eb)];else{if(_0x4ad608[0x0][_0x17a4d5(0x252)]==_0x17a4d5(0x216))var _0x3742df=users[_0x17a4d5(0x214)];else{if(_0x4ad608[0x0]['language']==_0x17a4d5(0x25f))var _0x3742df=users[_0x17a4d5(0x25f)];else{if(_0x4ad608[0x0]['language']==_0x17a4d5(0x2a0))var _0x3742df=users['Arabic'];}}}}}}}_0x498156['render'](_0x17a4d5(0x2c1),{'success':_0x355b20[_0x17a4d5(0x22e)](_0x17a4d5(0x2d6)),'errors':_0x355b20[_0x17a4d5(0x22e)]('errors'),'role':_0x19ddbf,'profile':_0x288d94,'purchases':_0xa0471a,'suppliers':_0x2f719a,'warehouse':_0x1ee9ff,'product':_0xe5e02c,'master_shop':_0x4ad608,'language':_0x3742df,'ed_fullDate':_0x42d889,'dataSelected':_0x2a3753});}catch(_0x53017d){console[_0x17a4d5(0x1de)](_0x53017d);}}),router[a0_0x589dfb(0x1ff)](a0_0x589dfb(0x281),auth,async(_0x2f98e9,_0x225385)=>{var _0x2db14d=a0_0x589dfb;try{const _0x4706a4=_0x2f98e9[_0x2db14d(0x1f2)]['id'],_0xfbdea6=await purchases[_0x2db14d(0x240)]({'_id':_0x2f98e9['params']['id']}),_0x28f688=await warehouse[_0x2db14d(0x240)]({'name':_0xfbdea6['warehouse_name'],'room':_0xfbdea6['room']});_0xfbdea6['product'][_0x2db14d(0x29e)](_0x4051d7=>{var _0x397b1e=_0x2db14d;const _0x281927=_0x28f688[_0x397b1e(0x26a)]['map'](_0x9e99b7=>{var _0x1bda2d=_0x397b1e;_0x9e99b7[_0x1bda2d(0x2af)]==_0x4051d7[_0x1bda2d(0x2af)]&&_0x9e99b7[_0x1bda2d(0x265)]==_0x4051d7[_0x1bda2d(0x265)]&&_0x9e99b7[_0x1bda2d(0x245)]==_0x4051d7[_0x1bda2d(0x245)]&&_0x9e99b7[_0x1bda2d(0x2bb)]==_0x4051d7[_0x1bda2d(0x2bb)]&&_0x9e99b7[_0x1bda2d(0x2ba)]==_0x4051d7['bay']&&_0x9e99b7['rack']==_0x4051d7[_0x1bda2d(0x292)]&&_0x9e99b7[_0x1bda2d(0x1dc)]==_0x4051d7[_0x1bda2d(0x1dc)]&&(_0x9e99b7[_0x1bda2d(0x2b3)]=parseInt(_0x9e99b7[_0x1bda2d(0x2b3)])-parseInt(_0x4051d7['quantity']));});}),await _0x28f688['save']();const {invoice:_0x477e9d,suppliers:_0x2ec451,date:_0x7ce6b7,warehouse_name:_0x3faa48,prod_name:_0x393a01,prod_code:_0x680550,prod_qty:_0x39d5f2,prod_unit:_0x1f0277,prod_secondunit:_0x401e88,prod_level:_0xddd4e0,prod_isle:_0x458e48,prod_pallet:_0x5d79a9,note:_0x3f8d1a,expiry_date:_0xc5dfbb,batch_code:_0x30a0f2,paid_amount:_0x563f7a,due_amount:_0x3b6c83,Room_name:_0x5b9842,primary_code:_0x3b2b29,secondary_code:_0x4c55bf,PO_number:_0x568a98,JO_number:_0x31287d}=_0x2f98e9[_0x2db14d(0x22d)];if(typeof _0x393a01==_0x2db14d(0x1d2))var _0x579ccb=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x27a)]],_0x113645=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2dc)]],_0x5ee3e9=[_0x2f98e9[_0x2db14d(0x22d)]['prod_qty']],_0x718e3=[_0x2f98e9[_0x2db14d(0x22d)]['prod_unit']],_0x30483f=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2ca)]],_0x5b97ab=[_0x2f98e9[_0x2db14d(0x22d)]['prod_level']],_0xaef1a2=[_0x2f98e9['body'][_0x2db14d(0x276)]],_0x449623=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2e4)]],_0x27dc87=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x271)]],_0x20f72a=[_0x2f98e9['body'][_0x2db14d(0x2b4)]],_0xeedb75=[_0x2f98e9['body'][_0x2db14d(0x2bd)]],_0x1391a5=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x1ee)]],_0x5dfd6a=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x273)]],_0xe16812=[_0x2f98e9['body']['storage']],_0x41e004=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x210)]],_0x59702a=[_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x245)]];else var _0x579ccb=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x27a)]],_0x113645=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2dc)]],_0x5ee3e9=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2e1)]],_0x718e3=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2ae)]],_0x30483f=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2ca)]],_0x5b97ab=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x230)]],_0xaef1a2=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x276)]],_0x449623=[..._0x2f98e9['body'][_0x2db14d(0x2e4)]],_0x27dc87=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x271)]],_0x20f72a=[..._0x2f98e9[_0x2db14d(0x22d)]['secondary_code']],_0xeedb75=[..._0x2f98e9['body'][_0x2db14d(0x2bd)]],_0x1391a5=[..._0x2f98e9['body'][_0x2db14d(0x1ee)]],_0x5dfd6a=[..._0x2f98e9['body'][_0x2db14d(0x273)]],_0xe16812=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x1dc)]],_0x41e004=[..._0x2f98e9['body'][_0x2db14d(0x210)]],_0x59702a=[..._0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x245)]];const _0x4c6fc1=_0x579ccb['map'](_0x2f8c12=>{return _0x2f8c12={'product_name':_0x2f8c12};});_0x113645[_0x2db14d(0x29e)]((_0x3a8d48,_0x5e23bb)=>{var _0x51a5e5=_0x2db14d;_0x4c6fc1[_0x5e23bb][_0x51a5e5(0x287)]=_0x3a8d48;}),_0x5ee3e9['forEach']((_0x391093,_0x2a23c7)=>{var _0x201bae=_0x2db14d;_0x4c6fc1[_0x2a23c7][_0x201bae(0x217)]=_0x391093;}),_0x718e3[_0x2db14d(0x29e)]((_0x42e38c,_0x5aeb68)=>{var _0x92b786=_0x2db14d;_0x4c6fc1[_0x5aeb68][_0x92b786(0x296)]=_0x42e38c;}),_0x30483f['forEach']((_0x524143,_0x5672ff)=>{var _0x506e07=_0x2db14d;_0x4c6fc1[_0x5672ff][_0x506e07(0x249)]=_0x524143;}),_0x5b97ab[_0x2db14d(0x29e)]((_0x845844,_0x1c3a5f)=>{var _0x182315=_0x2db14d;_0x4c6fc1[_0x1c3a5f][_0x182315(0x2ba)]=_0x845844;}),_0xaef1a2[_0x2db14d(0x29e)]((_0x410502,_0x21cd98)=>{var _0x46b879=_0x2db14d;_0x4c6fc1[_0x21cd98][_0x46b879(0x2bb)]=_0x410502;}),_0x449623[_0x2db14d(0x29e)]((_0x4490b1,_0x4d49ec)=>{var _0x20a50d=_0x2db14d;_0x4c6fc1[_0x4d49ec][_0x20a50d(0x265)]=_0x4490b1;}),_0x27dc87[_0x2db14d(0x29e)]((_0x412f79,_0x3adea5)=>{var _0x32663a=_0x2db14d;_0x4c6fc1[_0x3adea5][_0x32663a(0x271)]=_0x412f79;}),_0x20f72a[_0x2db14d(0x29e)]((_0x3ebf6d,_0x4b755f)=>{var _0x2f2a35=_0x2db14d;_0x4c6fc1[_0x4b755f][_0x2f2a35(0x2b4)]=_0x3ebf6d;}),_0xeedb75[_0x2db14d(0x29e)]((_0x49e1a1,_0x37abf3)=>{var _0x1470c5=_0x2db14d;_0x4c6fc1[_0x37abf3][_0x1470c5(0x221)]=_0x49e1a1;}),_0x1391a5[_0x2db14d(0x29e)]((_0x546814,_0x2a0b81)=>{var _0x4058ca=_0x2db14d;_0x4c6fc1[_0x2a0b81][_0x4058ca(0x1ee)]=_0x546814;}),_0x5dfd6a['forEach']((_0x10c9dc,_0x364927)=>{_0x4c6fc1[_0x364927]['expiry_date']=_0x10c9dc;}),_0x59702a[_0x2db14d(0x29e)]((_0xeaf345,_0x425513)=>{_0x4c6fc1[_0x425513]['type']=_0xeaf345;}),_0xe16812[_0x2db14d(0x29e)]((_0x4e5068,_0x465bde)=>{var _0x3103d2=_0x2db14d;_0x4c6fc1[_0x465bde][_0x3103d2(0x1dc)]=_0x4e5068;}),_0x41e004[_0x2db14d(0x29e)]((_0x2b3283,_0x5ad427)=>{var _0x198654=_0x2db14d;_0x4c6fc1[_0x5ad427][_0x198654(0x292)]=_0x2b3283;});const _0x4ddb5c=_0x4c6fc1[_0x2db14d(0x2d7)](_0x2135df=>_0x2135df[_0x2db14d(0x217)]!=='0'&&_0x2135df[_0x2db14d(0x217)]!=='');_0xfbdea6[_0x2db14d(0x2c2)]=_0x477e9d,_0xfbdea6[_0x2db14d(0x222)]=_0x2ec451,_0xfbdea6[_0x2db14d(0x223)]=_0x7ce6b7,_0xfbdea6[_0x2db14d(0x21f)]=_0x3faa48,_0xfbdea6[_0x2db14d(0x297)]=_0x4ddb5c,_0xfbdea6[_0x2db14d(0x215)]=_0x3f8d1a,_0xfbdea6[_0x2db14d(0x1d3)]=_0x563f7a,_0xfbdea6[_0x2db14d(0x201)]=_0x3b6c83,_0xfbdea6[_0x2db14d(0x2c7)]=_0x5b9842,_0xfbdea6[_0x2db14d(0x243)]=_0x568a98,_0xfbdea6[_0x2db14d(0x1e6)]=_0x31287d;const _0x3a8dfe=await _0xfbdea6[_0x2db14d(0x299)](),_0x38df39=await warehouse['findOne']({'name':_0x2f98e9[_0x2db14d(0x22d)]['warehouse_name'],'room':_0x2f98e9['body'][_0x2db14d(0x284)]});_0xfbdea6[_0x2db14d(0x297)]['forEach'](_0x24a7d5=>{var _0x1c2b0c=_0x2db14d,_0x5be789=0x0;const _0x1f541b=_0x38df39[_0x1c2b0c(0x26a)]['map'](_0x48a740=>{var _0x630202=_0x1c2b0c;_0x48a740[_0x630202(0x2af)]==_0x24a7d5[_0x630202(0x2af)]&&_0x48a740[_0x630202(0x265)]==_0x24a7d5[_0x630202(0x265)]&&_0x48a740['type']==_0x24a7d5['type']&&_0x48a740['bin']==_0x24a7d5[_0x630202(0x2bb)]&&_0x48a740[_0x630202(0x2ba)]==_0x24a7d5[_0x630202(0x2ba)]&&_0x48a740[_0x630202(0x292)]==_0x24a7d5[_0x630202(0x292)]&&_0x48a740[_0x630202(0x1dc)]==_0x24a7d5['storage']&&(_0x48a740[_0x630202(0x2b3)]=parseInt(_0x48a740[_0x630202(0x2b3)])+parseInt(_0x24a7d5[_0x630202(0x217)]),_0x5be789++);});_0x5be789=='0'&&(_0x38df39[_0x1c2b0c(0x26a)]=_0x38df39[_0x1c2b0c(0x26a)][_0x1c2b0c(0x288)]({'product_name':_0x24a7d5[_0x1c2b0c(0x2af)],'product_stock':_0x24a7d5[_0x1c2b0c(0x217)],'primary_code':_0x24a7d5['primary_code'],'secondary_code':_0x24a7d5[_0x1c2b0c(0x2b4)],'product_code':_0x24a7d5['product_code'],'storage':_0x24a7d5['storage'],'rack':_0x24a7d5[_0x1c2b0c(0x292)],'bay':_0x24a7d5[_0x1c2b0c(0x2ba)],'bin':_0x24a7d5['bin'],'type':_0x24a7d5[_0x1c2b0c(0x245)],'floorlevel':_0x24a7d5[_0x1c2b0c(0x265)],'maxProducts':_0x24a7d5[_0x1c2b0c(0x221)],'unit':_0x24a7d5[_0x1c2b0c(0x296)],'secondary_unit':_0x24a7d5[_0x1c2b0c(0x249)],'expiry_date':_0x24a7d5[_0x1c2b0c(0x273)]}));}),await _0x38df39[_0x2db14d(0x299)]();const _0x5c435e=await s_payment_data[_0x2db14d(0x240)]({'invoice':_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2c2)]});if(_0x5c435e===null){}else console[_0x2db14d(0x1de)]('suppliers',_0x5c435e,_0x2f98e9[_0x2db14d(0x22d)][_0x2db14d(0x2c2)]),_0x5c435e[_0x2db14d(0x222)]=_0x2f98e9[_0x2db14d(0x22d)]['suppliers'],await _0x5c435e[_0x2db14d(0x299)]();_0x2f98e9[_0x2db14d(0x22e)](_0x2db14d(0x2d6),_0x2db14d(0x2b8)),_0x225385[_0x2db14d(0x29d)](_0x2db14d(0x225));}catch(_0x43ed48){console[_0x2db14d(0x1de)](_0x43ed48);}}),router[a0_0x589dfb(0x1ff)](a0_0x589dfb(0x2d8),auth,async(_0x4b097e,_0x5b8e16)=>{var _0x5be277=a0_0x589dfb;try{const _0x52c670=_0x4b097e[_0x5be277(0x1f2)]['id'],{invoice:_0x3683f6,suppliers:_0x37511c,payable:_0x3c528d,due_amount:_0x16d4b6}=_0x4b097e[_0x5be277(0x22d)],_0x3e8035=await purchases[_0x5be277(0x2ea)](_0x52c670);var _0x6f05d6=_0x3c528d-_0x16d4b6;_0x3e8035[_0x5be277(0x1d3)]=parseFloat(_0x3e8035[_0x5be277(0x1d3)])+parseFloat(_0x16d4b6),_0x3e8035['due_amount']=_0x6f05d6;const _0x490a0f=await _0x3e8035[_0x5be277(0x299)]();console[_0x5be277(0x1de)](_0x490a0f);const _0x60247c=await s_payment_data[_0x5be277(0x240)]({'invoice':_0x3683f6});_0x60247c[_0x5be277(0x24f)]=_0x6f05d6,await _0x60247c[_0x5be277(0x299)]();let _0x428383=new Date(),_0x57de78=('0'+_0x428383[_0x5be277(0x29a)]())[_0x5be277(0x1da)](-0x2),_0x1ae039=('0'+(_0x428383[_0x5be277(0x285)]()+0x1))['slice'](-0x2),_0x121274=_0x428383['getFullYear'](),_0x2a32e9=_0x121274+'-'+_0x1ae039+'-'+_0x57de78;const _0x2aea4e=new suppliers_payment({'invoice':_0x3683f6,'date':_0x121274+'-'+_0x1ae039+'-'+_0x57de78,'suppliers':_0x37511c,'reason':_0x5be277(0x2d3),'amount':_0x16d4b6}),_0x390585=await _0x2aea4e['save']();_0x4b097e[_0x5be277(0x22e)](_0x5be277(0x2d6),'payment\x20successfull'),_0x5b8e16['redirect']('/all_purchases/view');}catch(_0x11572f){console[_0x5be277(0x1de)](_0x11572f);}}),router[a0_0x589dfb(0x20e)]('/invoice/:id',auth,async(_0x306105,_0x30ae5b)=>{var _0x25dd7c=a0_0x589dfb;try{const {username:_0x763035,email:_0x4500cf,role:_0x2616fd}=_0x306105[_0x25dd7c(0x2ec)],_0x2949c1=_0x306105[_0x25dd7c(0x2ec)],_0x22b841=await profile[_0x25dd7c(0x240)]({'email':_0x2949c1['email']}),_0x1ba686=await master_shop[_0x25dd7c(0x1e1)]();console[_0x25dd7c(0x1de)]('master',_0x1ba686);const _0x52173a=_0x306105[_0x25dd7c(0x1f2)]['id'],_0x65cb6a=await purchases['findById'](_0x52173a);console['log'](_0x65cb6a);const _0x898fe6=await suppliers[_0x25dd7c(0x240)]({'name':_0x65cb6a['suppliers']});console[_0x25dd7c(0x1de)](_0x898fe6);if(_0x1ba686[0x0][_0x25dd7c(0x252)]==_0x25dd7c(0x22f)){var _0x38ddee=users[_0x25dd7c(0x2b5)];console[_0x25dd7c(0x1de)](_0x38ddee);}else{if(_0x1ba686[0x0][_0x25dd7c(0x252)]==_0x25dd7c(0x1ed))var _0x38ddee=users[_0x25dd7c(0x1ed)];else{if(_0x1ba686[0x0][_0x25dd7c(0x252)]=='German')var _0x38ddee=users['German'];else{if(_0x1ba686[0x0]['language']==_0x25dd7c(0x275))var _0x38ddee=users['Spanish'];else{if(_0x1ba686[0x0][_0x25dd7c(0x252)]=='French')var _0x38ddee=users[_0x25dd7c(0x1eb)];else{if(_0x1ba686[0x0][_0x25dd7c(0x252)]==_0x25dd7c(0x216))var _0x38ddee=users[_0x25dd7c(0x214)];else{if(_0x1ba686[0x0]['language']==_0x25dd7c(0x25f))var _0x38ddee=users[_0x25dd7c(0x25f)];else{if(_0x1ba686[0x0][_0x25dd7c(0x252)]==_0x25dd7c(0x2a0))var _0x38ddee=users[_0x25dd7c(0x2aa)];}}}}}}}_0x30ae5b[_0x25dd7c(0x25a)](_0x25dd7c(0x2c0),{'success':_0x306105[_0x25dd7c(0x22e)](_0x25dd7c(0x2d6)),'errors':_0x306105[_0x25dd7c(0x22e)](_0x25dd7c(0x262)),'role':_0x2949c1,'profile':_0x22b841,'master_shop':_0x1ba686,'supplier':_0x898fe6,'purchase':_0x65cb6a,'language':_0x38ddee});}catch(_0x48dc54){console[_0x25dd7c(0x1de)](_0x48dc54);}}),router['get']('/view/return_purchase/:id',auth,async(_0x3d49e5,_0x5e8d8d)=>{var _0x21fef6=a0_0x589dfb;try{const {username:_0x4e1417,email:_0x3997a2,role:_0x332852}=_0x3d49e5['user'],_0x2684eb=_0x3d49e5[_0x21fef6(0x2ec)],_0xc14126=await profile['findOne']({'email':_0x2684eb['email']}),_0x1a1120=await master_shop['find']();console[_0x21fef6(0x1de)]('master',_0x1a1120);const _0x1b4348=_0x3d49e5[_0x21fef6(0x1f2)]['id'];console[_0x21fef6(0x1de)](_0x1b4348);const _0x13e6fc=await purchases[_0x21fef6(0x2ea)](_0x1b4348);console[_0x21fef6(0x1de)](_0x21fef6(0x227),_0x13e6fc);const _0x3aa836=await product['find']({}),_0x3df234=await warehouse['aggregate']([{'$match':{'name':_0x13e6fc['warehouse_name'],'room':_0x13e6fc['room'],'warehouse_category':_0x21fef6(0x2bc)}},{'$unwind':_0x21fef6(0x26c)},{'$group':{'_id':_0x21fef6(0x270),'name':{'$first':_0x21fef6(0x2be)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x21fef6(0x294)},'bin':{'$first':_0x21fef6(0x25e)},'type':{'$first':_0x21fef6(0x1fe)},'floorlevel':{'$first':_0x21fef6(0x2ad)},'primary_code':{'$first':_0x21fef6(0x21c)},'secondary_code':{'$first':_0x21fef6(0x228)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x21fef6(0x2c3)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x21fef6(0x1f6),'name':_0x21fef6(0x1cc),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x21fef6(0x1e5),'name':{'$first':_0x21fef6(0x1e5)}}},{'$sort':{'name':0x1}}]),console[_0x21fef6(0x1de)](_0x21fef6(0x2ce),_0x3df234);if(_0x1a1120[0x0][_0x21fef6(0x252)]==_0x21fef6(0x22f)){var _0x4e1628=users[_0x21fef6(0x2b5)];console['log'](_0x4e1628);}else{if(_0x1a1120[0x0][_0x21fef6(0x252)]==_0x21fef6(0x1ed))var _0x4e1628=users['Hindi'];else{if(_0x1a1120[0x0]['language']==_0x21fef6(0x1d4))var _0x4e1628=users['German'];else{if(_0x1a1120[0x0][_0x21fef6(0x252)]=='Spanish')var _0x4e1628=users[_0x21fef6(0x275)];else{if(_0x1a1120[0x0][_0x21fef6(0x252)]=='French')var _0x4e1628=users[_0x21fef6(0x1eb)];else{if(_0x1a1120[0x0][_0x21fef6(0x252)]==_0x21fef6(0x216))var _0x4e1628=users[_0x21fef6(0x214)];else{if(_0x1a1120[0x0][_0x21fef6(0x252)]==_0x21fef6(0x25f))var _0x4e1628=users[_0x21fef6(0x25f)];else{if(_0x1a1120[0x0][_0x21fef6(0x252)]==_0x21fef6(0x2a0))var _0x4e1628=users[_0x21fef6(0x2aa)];}}}}}}}_0x5e8d8d[_0x21fef6(0x25a)](_0x21fef6(0x258),{'success':_0x3d49e5[_0x21fef6(0x22e)]('success'),'errors':_0x3d49e5[_0x21fef6(0x22e)](_0x21fef6(0x262)),'role':_0x2684eb,'profile':_0xc14126,'user':_0x13e6fc,'stock':_0x3df234,'master_shop':_0x1a1120,'product':_0x3aa836,'language':_0x4e1628,'warehouse':warehouse_data});}catch(_0x1b916a){console[_0x21fef6(0x1de)](_0x1b916a);}}),router[a0_0x589dfb(0x1ff)](a0_0x589dfb(0x236),auth,async(_0x167530,_0x4c6231)=>{var _0x256e94=a0_0x589dfb;try{const {invoice:_0x82c007,date:_0x5e7650,warehouse_name:_0x5821cc,Room_name:_0x4e094f,product_name:_0x4286bd,purchase_quantity:_0x3c5439,stocks:_0x1fd5b9,return_qty:_0x4e72a1,note:_0x34ef44,level:_0x3c0789,isle:_0x1c4046,pallet:_0x47fd4f,to_warehouse_name:_0x448fa7,to_Room_name:_0x2756de}=_0x167530[_0x256e94(0x22d)],_0x2334b3=await purchases[_0x256e94(0x240)]({'_id':_0x167530[_0x256e94(0x1f2)]['id']}),_0x469595=await warehouse[_0x256e94(0x240)]({'name':_0x5821cc,'room':_0x4e094f});if(typeof _0x4286bd==_0x256e94(0x1d2))var _0x216ea7=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x2af)]],_0x30b534=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x254)]],_0x285060=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x253)]],_0x2a97c=[_0x167530['body'][_0x256e94(0x23d)]],_0x1b4ed6=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x218)]],_0x54c156=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x2b6)]],_0x280262=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x22b)]],_0x2a6d4d=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x2d0)]],_0x587426=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x239)]],_0x4f32fc=[_0x167530[_0x256e94(0x22d)]['primary_code_hide']],_0x566184=[_0x167530[_0x256e94(0x22d)][_0x256e94(0x289)]];else var _0x216ea7=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x2af)]],_0x30b534=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x254)]],_0x285060=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x253)]],_0x2a97c=[..._0x167530['body'][_0x256e94(0x23d)]],_0x1b4ed6=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x218)]],_0x54c156=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x2b6)]],_0x280262=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x22b)]],_0x2a6d4d=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x2d0)]],_0x587426=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x239)]],_0x4f32fc=[..._0x167530[_0x256e94(0x22d)][_0x256e94(0x1d9)]],_0x566184=[..._0x167530['body']['secondary_code_hide']];const _0x29d4d2=_0x216ea7[_0x256e94(0x232)](_0x3d300b=>{return _0x3d300b={'product_name':_0x3d300b};});_0x30b534[_0x256e94(0x29e)]((_0x5a905c,_0x57a2b1)=>{var _0x1005d4=_0x256e94;_0x29d4d2[_0x57a2b1][_0x1005d4(0x254)]=_0x5a905c;}),_0x285060[_0x256e94(0x29e)]((_0x53dc59,_0x5d5e95)=>{var _0x5b1717=_0x256e94;_0x29d4d2[_0x5d5e95][_0x5b1717(0x282)]=_0x53dc59;}),_0x2a97c['forEach']((_0x4ab7a8,_0x2d643f)=>{var _0x3e440b=_0x256e94;_0x29d4d2[_0x2d643f][_0x3e440b(0x23d)]=_0x4ab7a8;}),_0x1b4ed6[_0x256e94(0x29e)]((_0x2b51f9,_0x4511d9)=>{_0x29d4d2[_0x4511d9]['bay']=_0x2b51f9;}),_0x54c156[_0x256e94(0x29e)]((_0x123042,_0x41a7b7)=>{var _0xac55c8=_0x256e94;_0x29d4d2[_0x41a7b7][_0xac55c8(0x2bb)]=_0x123042;}),_0x280262[_0x256e94(0x29e)]((_0x2af08e,_0x4899ef)=>{var _0x255865=_0x256e94;_0x29d4d2[_0x4899ef][_0x255865(0x265)]=_0x2af08e;}),_0x2a6d4d[_0x256e94(0x29e)]((_0x8ca4ef,_0x991a12)=>{var _0x3b05b4=_0x256e94;_0x29d4d2[_0x991a12][_0x3b05b4(0x245)]=_0x8ca4ef;}),_0x587426[_0x256e94(0x29e)]((_0x3664df,_0x3208fd)=>{var _0x50fe85=_0x256e94;_0x29d4d2[_0x3208fd][_0x50fe85(0x287)]=_0x3664df;}),_0x4f32fc[_0x256e94(0x29e)]((_0x25aa22,_0x3ffc99)=>{var _0x33ab53=_0x256e94;_0x29d4d2[_0x3ffc99][_0x33ab53(0x271)]=_0x25aa22;}),_0x566184['forEach']((_0x2d4146,_0x2fb2d9)=>{var _0x1f274c=_0x256e94;_0x29d4d2[_0x2fb2d9][_0x1f274c(0x2b4)]=_0x2d4146;}),_0x2334b3[_0x256e94(0x297)][_0x256e94(0x29e)](_0xc6800a=>{var _0xa84e2a=_0x256e94;const _0x48f7d5=_0x469595[_0xa84e2a(0x26a)][_0xa84e2a(0x232)](_0x530dd1=>{var _0x49db83=_0xa84e2a;_0x530dd1[_0x49db83(0x2af)]==_0xc6800a[_0x49db83(0x2af)]&&_0x530dd1[_0x49db83(0x265)]==_0xc6800a['floorlevel']&&_0x530dd1[_0x49db83(0x245)]==_0xc6800a[_0x49db83(0x245)]&&_0x530dd1[_0x49db83(0x2bb)]==_0xc6800a[_0x49db83(0x2bb)]&&_0x530dd1[_0x49db83(0x2ba)]==_0xc6800a[_0x49db83(0x2ba)]&&_0x530dd1[_0x49db83(0x292)]==_0xc6800a[_0x49db83(0x292)]&&_0x530dd1['storage']==_0xc6800a['storage']&&(console['log'](parseInt(_0x530dd1[_0x49db83(0x2b3)])+_0x49db83(0x238)+parseInt(_0xc6800a[_0x49db83(0x217)])),_0x530dd1[_0x49db83(0x2b3)]=parseInt(_0x530dd1[_0x49db83(0x2b3)])+parseInt(_0xc6800a[_0x49db83(0x217)]));});}),await _0x469595['save']();const _0x28333f=_0x29d4d2[_0x256e94(0x2d7)](_0x4e73ca=>_0x4e73ca[_0x256e94(0x23d)]!=='0'&&_0x4e73ca[_0x256e94(0x23d)]!=='');var _0x153db6=0x0;_0x28333f[_0x256e94(0x29e)](_0x59155e=>{var _0x3b862d=_0x256e94;console[_0x3b862d(0x1de)](_0x3b862d(0x20c),_0x59155e),(parseInt(_0x59155e[_0x3b862d(0x254)])<parseInt(_0x59155e[_0x3b862d(0x23d)])||parseInt(_0x59155e[_0x3b862d(0x282)])<parseInt(_0x59155e['return_qty']))&&_0x153db6++;});if(_0x153db6!=0x0)return _0x167530[_0x256e94(0x22e)]('errors',_0x256e94(0x21e)),_0x4c6231[_0x256e94(0x29d)](_0x256e94(0x204));const _0x3e1430=new purchases_return({'invoice':_0x82c007,'suppliers':_0x167530[_0x256e94(0x22d)][_0x256e94(0x222)],'date':_0x5e7650,'warehouse_name':_0x5821cc,'return_product':_0x28333f,'note':_0x34ef44,'room':_0x4e094f,'to_warehouse_name':_0x448fa7,'to_room':_0x2756de}),_0x53cfd7=await _0x3e1430['save']();console['log'](_0x3e1430);const _0x13737e=await purchases_return[_0x256e94(0x240)]({'invoice':_0x82c007}),_0x4e3aa9=await warehouse['findOne']({'name':_0x448fa7,'room':_0x2756de});_0x13737e[_0x256e94(0x1f3)][_0x256e94(0x29e)](_0x36c4ed=>{var _0x433e9c=_0x256e94,_0x384261=0x0;const _0x3a46ae=_0x4e3aa9['product_details'][_0x433e9c(0x232)](_0x301ad1=>{var _0x53c569=_0x433e9c;_0x301ad1[_0x53c569(0x2af)]==_0x36c4ed[_0x53c569(0x2af)]&&_0x301ad1[_0x53c569(0x265)]==_0x36c4ed[_0x53c569(0x265)]&&_0x301ad1[_0x53c569(0x245)]==_0x36c4ed[_0x53c569(0x245)]&&_0x301ad1['bin']==_0x36c4ed['bin']&&_0x301ad1[_0x53c569(0x2ba)]==_0x36c4ed[_0x53c569(0x2ba)]&&(_0x301ad1['product_stock']=parseInt(_0x301ad1[_0x53c569(0x2b3)])-parseInt(_0x36c4ed[_0x53c569(0x23d)]),_0x384261++);});_0x384261=='0'&&(_0x4e3aa9[_0x433e9c(0x26a)]=_0x4e3aa9[_0x433e9c(0x26a)][_0x433e9c(0x288)]({'product_name':_0x36c4ed['product_name'],'product_stock':_0x36c4ed[_0x433e9c(0x23d)],'primary_code':_0x36c4ed[_0x433e9c(0x271)],'secondary_code':_0x36c4ed['secondary_code'],'product_code':_0x36c4ed[_0x433e9c(0x287)],'storage':_0x36c4ed['storage'],'rack':_0x36c4ed[_0x433e9c(0x292)],'bay':_0x36c4ed[_0x433e9c(0x2ba)],'bin':_0x36c4ed[_0x433e9c(0x2bb)],'type':_0x36c4ed['type'],'floorlevel':_0x36c4ed[_0x433e9c(0x265)],'maxProducts':_0x36c4ed['maxStocks'],'unit':_0x36c4ed[_0x433e9c(0x296)],'secondary_unit':_0x36c4ed[_0x433e9c(0x249)],'expiry_date':_0x36c4ed[_0x433e9c(0x273)]}));}),await _0x4e3aa9[_0x256e94(0x299)]();const _0x14012b=await purchases['findOne']({'invoice':_0x82c007});_0x14012b[_0x256e94(0x1ea)]='True';const _0x376b5c=await _0x14012b['save'](),_0x1073f3=new s_payment_data({'invoice':_0x82c007,'suppliers':_0x167530[_0x256e94(0x22d)][_0x256e94(0x222)],'reason':'Purchase\x20Return'});await _0x1073f3[_0x256e94(0x299)]();const _0x36b264=await master_shop[_0x256e94(0x1e1)]();console[_0x256e94(0x1de)](_0x256e94(0x2a4),_0x36b264[0x0][_0x256e94(0x2d4)]);const _0x9f84b0=await email_settings['findOne'](),_0x2b20a0=await suppliers[_0x256e94(0x240)]({'name':_0x167530['body'][_0x256e94(0x222)]});console[_0x256e94(0x1de)](_0x256e94(0x286),_0x2b20a0);_0x36b264[0x0][_0x256e94(0x24e)]==0x1?(right_currency=_0x36b264[0x0][_0x256e94(0x2e7)],left_currency=''):(right_currency='',left_currency=_0x36b264[0x0][_0x256e94(0x2e7)]);var _0x1e4212=_0x216ea7,_0x6df85d=_0x2a97c,_0x35aff6='',_0x515505;for(_0x515505 in _0x1e4212){_0x35aff6+=_0x256e94(0x1f7)+_0x256e94(0x1fd)+_0x1e4212[_0x515505]+_0x256e94(0x2a9)+_0x256e94(0x1fd)+_0x6df85d[_0x515505]+_0x256e94(0x2a9)+'</tr>';}console[_0x256e94(0x1de)](_0x256e94(0x2a5),_0x35aff6);let _0x5622a1=nodemailer[_0x256e94(0x295)]({'service':_0x256e94(0x235),'auth':{'user':_0x9f84b0[_0x256e94(0x256)],'pass':_0x9f84b0[_0x256e94(0x246)]}}),_0x2fd905={'from':_0x9f84b0[_0x256e94(0x256)],'to':_0x2b20a0['email'],'subject':_0x256e94(0x207),'attachments':[{'filename':_0x256e94(0x29c),'path':__dirname+_0x256e94(0x27d)+_0x256e94(0x29b)+_0x36b264[0x0][_0x256e94(0x2d4)],'cid':'logo'}],'html':_0x256e94(0x1ec)+_0x256e94(0x1d7)+'</head><body>'+_0x256e94(0x2ef)+_0x256e94(0x2e6)+_0x256e94(0x2ef)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x256e94(0x2ef)+'<h2>\x20'+_0x36b264[0x0][_0x256e94(0x1e9)]+_0x256e94(0x1cb)+_0x256e94(0x264)+_0x256e94(0x264)+_0x256e94(0x259)+_0x256e94(0x2ef)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x256e94(0x1f0)+_0x82c007+'\x20'+_0x256e94(0x274)+_0x256e94(0x1cd)+_0x5e7650+'\x20'+_0x256e94(0x2d1)+_0x256e94(0x233)+_0x256e94(0x264)+_0x256e94(0x242)+_0x256e94(0x209)+_0x256e94(0x1f7)+_0x256e94(0x2e2)+_0x256e94(0x224)+_0x256e94(0x2cc)+_0x256e94(0x213)+_0x256e94(0x2c9)+'</thead>'+_0x256e94(0x205)+'\x20'+_0x35aff6+'\x20'+_0x256e94(0x251)+'</table>'+_0x256e94(0x2ef)+'<strong>\x20Regards\x20</strong>'+_0x256e94(0x22c)+_0x36b264[0x0][_0x256e94(0x1e9)]+'</h5>'+_0x256e94(0x264)+_0x256e94(0x264)+_0x256e94(0x1d1)};_0x5622a1[_0x256e94(0x21a)](_0x2fd905,function(_0x439b6d,_0x1a65d8){var _0xdf915b=_0x256e94;_0x439b6d?(console[_0xdf915b(0x1de)](_0x439b6d),console[_0xdf915b(0x1de)](_0xdf915b(0x1fa))):console[_0xdf915b(0x1de)](_0xdf915b(0x241));}),_0x167530[_0x256e94(0x22e)](_0x256e94(0x2d6),'purchases\x20item\x20return\x20successfull'),_0x4c6231[_0x256e94(0x29d)](_0x256e94(0x225));}catch(_0x8678fc){console[_0x256e94(0x1de)](_0x8678fc),_0x4c6231[_0x256e94(0x28d)](0xc8)['json']({'message':_0x8678fc[_0x256e94(0x1e2)]});}}),router['get'](a0_0x589dfb(0x2c4),auth,async(_0x32ffb0,_0x45ef4f)=>{var _0x2f342e=a0_0x589dfb;try{const {username:_0x41d820,email:_0x4057e4,role:_0xd93ad9}=_0x32ffb0[_0x2f342e(0x2ec)],_0x5853b3=_0x32ffb0['user'],_0x5cde40=await profile[_0x2f342e(0x240)]({'email':_0x5853b3[_0x2f342e(0x256)]}),_0x19e2b3=await master_shop[_0x2f342e(0x1e1)](),_0x15b0c4=_0x32ffb0[_0x2f342e(0x1f2)]['id'],_0x41e644=await purchases['findById'](_0x15b0c4);if(_0x19e2b3[0x0][_0x2f342e(0x252)]==_0x2f342e(0x22f))var _0x48e722=users['English'];else{if(_0x19e2b3[0x0][_0x2f342e(0x252)]==_0x2f342e(0x1ed))var _0x48e722=users[_0x2f342e(0x1ed)];else{if(_0x19e2b3[0x0][_0x2f342e(0x252)]==_0x2f342e(0x1d4))var _0x48e722=users[_0x2f342e(0x1d4)];else{if(_0x19e2b3[0x0][_0x2f342e(0x252)]==_0x2f342e(0x275))var _0x48e722=users['Spanish'];else{if(_0x19e2b3[0x0][_0x2f342e(0x252)]==_0x2f342e(0x1eb))var _0x48e722=users['French'];else{if(_0x19e2b3[0x0][_0x2f342e(0x252)]=='Portuguese\x20(BR)')var _0x48e722=users[_0x2f342e(0x214)];else{if(_0x19e2b3[0x0][_0x2f342e(0x252)]==_0x2f342e(0x25f))var _0x48e722=users[_0x2f342e(0x25f)];else{if(_0x19e2b3[0x0]['language']==_0x2f342e(0x2a0))var _0x48e722=users[_0x2f342e(0x2aa)];}}}}}}}_0x45ef4f['render']('all_purchases_barcode',{'success':_0x32ffb0['flash'](_0x2f342e(0x2d6)),'errors':_0x32ffb0[_0x2f342e(0x22e)](_0x2f342e(0x262)),'role':_0x5853b3,'profile':_0x5cde40,'alldata':_0x41e644,'master_shop':_0x19e2b3,'language':_0x48e722}),console[_0x2f342e(0x1de)](alldata);}catch(_0x1d4807){console[_0x2f342e(0x1de)](_0x1d4807);}}),router['post'](a0_0x589dfb(0x2e0),async(_0x2b6585,_0x55d818)=>{var _0x591356=a0_0x589dfb;const {product_code:_0x4d664f}=_0x2b6585[_0x591356(0x22d)];var _0x4e204d;const _0x2fd44b=await product[_0x591356(0x2b9)]([{'$match':{'primary_code':_0x4d664f,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x591356(0x1ce),'name':{'$first':_0x591356(0x1e5)},'category':{'$first':'$category'},'brand':{'$first':_0x591356(0x250)},'unit':{'$first':_0x591356(0x1db)},'alertquantity':{'$first':_0x591356(0x1ca)},'product_code':{'$first':_0x591356(0x208)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x591356(0x2b2)},'maxStocks':{'$first':_0x591356(0x272)},'maxProdPerUnit':{'$first':_0x591356(0x1c9)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x629b87=await product[_0x591356(0x2b9)]([{'$match':{'secondary_code':_0x4d664f,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x591356(0x1ce),'name':{'$first':_0x591356(0x1e5)},'category':{'$first':_0x591356(0x1e4)},'brand':{'$first':_0x591356(0x250)},'unit':{'$first':_0x591356(0x1db)},'alertquantity':{'$first':_0x591356(0x1ca)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x591356(0x26b)},'secondary_code':{'$first':_0x591356(0x2b2)},'maxStocks':{'$first':_0x591356(0x272)},'maxProdPerUnit':{'$first':_0x591356(0x1c9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x591356(0x2e9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2fd44b['length']>0x0)_0x4e204d=_0x2fd44b;else _0x629b87[_0x591356(0x2b0)]>0x0&&(_0x4e204d=_0x629b87);_0x55d818['json'](_0x4e204d);}),router[a0_0x589dfb(0x1ff)](a0_0x589dfb(0x263),async(_0x35349f,_0x4dbb1d)=>{var _0x4ebc27=a0_0x589dfb;const {primaryCode:_0x50dfbe,secondaryCode:_0x24f5ed,productCode:_0xe39b6a,bay:_0x330b2d,bin:_0x486991,types:_0x24bc47,pallet:_0x15beeb,warehouses:_0x57f9cf,room:_0x34ac8d}=_0x35349f['body'];console[_0x4ebc27(0x1de)](_0x35349f[_0x4ebc27(0x22d)]);try{const _0x27c86f=await warehouse['aggregate']([{'$match':{'name':_0x57f9cf,'room':_0x34ac8d}},{'$unwind':_0x4ebc27(0x26c)},{'$match':{'product_details.bay':_0x330b2d,'product_details.bin':_0x486991,'product_details.type':_0x24bc47}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4ebc27(0x2be)},'product_stock':{'$first':_0x4ebc27(0x277)},'level':{'$first':_0x4ebc27(0x2ed)},'isle':{'$first':_0x4ebc27(0x2a1)},'pallet':{'$first':_0x4ebc27(0x2ac)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4dbb1d[_0x4ebc27(0x28d)](0xc8)[_0x4ebc27(0x28b)](_0x27c86f);}catch(_0xea3e3e){_0x4dbb1d[_0x4ebc27(0x28d)](0x194)[_0x4ebc27(0x28b)]({'message':_0xea3e3e['message']});}}),module[a0_0x589dfb(0x20a)]=router;