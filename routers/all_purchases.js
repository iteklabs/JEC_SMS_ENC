var a0_0x3a5ae7=a0_0x3a1d;(function(_0x5d309c,_0x226202){var _0x555b93=a0_0x3a1d,_0x11effe=_0x5d309c();while(!![]){try{var _0x477e8a=parseInt(_0x555b93(0x15b))/0x1*(-parseInt(_0x555b93(0x16b))/0x2)+parseInt(_0x555b93(0x18a))/0x3*(-parseInt(_0x555b93(0x1d3))/0x4)+-parseInt(_0x555b93(0x23f))/0x5+-parseInt(_0x555b93(0x1ed))/0x6*(-parseInt(_0x555b93(0x12d))/0x7)+parseInt(_0x555b93(0x1d6))/0x8+-parseInt(_0x555b93(0x1cb))/0x9*(-parseInt(_0x555b93(0x14a))/0xa)+-parseInt(_0x555b93(0x226))/0xb;if(_0x477e8a===_0x226202)break;else _0x11effe['push'](_0x11effe['shift']());}catch(_0x66720f){_0x11effe['push'](_0x11effe['shift']());}}}(a0_0x381a,0x7f151));const express=require(a0_0x3a5ae7(0x178)),app=express(),router=express[a0_0x3a5ae7(0x1d8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3a5ae7(0x1b6)),nodemailer=require(a0_0x3a5ae7(0x206));var ejs=require(a0_0x3a5ae7(0x20f));const path=require('path'),users=require(a0_0x3a5ae7(0x1df));function a0_0x381a(){var _0x587843=['<strong>\x20Regards\x20</strong>','findById','role','purchase\x20data\x20update\x20successfully','Enabled','45900BUDPLs','note','edit_purchases','filter','currency','$product_details.expiry_date','</table>','map','/upload/','level','/give_payment/:id','/invoice/:id','Arabic','get','40453WfhHUZ','</td>','invoice','$product_details.primary_code','standard_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','language','English\x20(US)','here','JO_number','bay','add_purchases','<!DOCTYPE\x20html>','$secondary_unit','Arabic\x20(ae)','length','/view/add_purchases','Level','finalize','foreach\x20newproduct','host','amount','$product.bay','product_stock','$product_code','Raw\x20Materials','site_title','10VhALlm','/view/return_purchase/:id','actual_qty','find','An\x20error\x20occurred\x20while\x20saving\x20data.','$due_amount','$product_details','name','True','/barcode_scanner','push','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/preview/:id','<hr\x20class=\x22my-3\x22>','prod_code','date','Rack\x20A','1zWOJVl','prod_primunit','/../public','</head><body>','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<h5>','Rack\x20E','$product_details.product_name','warehouse','secondary_code_hide','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','\x20<>\x20','/view/add_purchases/:id','$primary_code','312262yCgZXS','DRY\x20STORAGE','$product_details.type','$brand','<tr>','<div>','render','COLD\x20STORAGE','table\x20page','batch_code','$product_details.rack','\x20<\x20wew\x20>\x20','$batch_code','express','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','all_purchases_barcode','gmail','$product','$return_data','/all_purchases/view/','rak','prod_unit','due_amount','prod_invoice','product','purchases\x20item\x20return\x20successfull','prod_pallet','post','log','deliverycode','505023QcRpZB','Purchase\x20Mail','$product_details.floorlevel','room_name','RoomAssign','status','product_code_hide','alertQTY','<h5\x20style=\x22text-align:\x20left;\x22>','stock_quantity','body','return_product','secondary_code','$product.bin','English','INC-','$expiry_date','product_details','\x20Order\x20Number\x20:\x20','password','Spanish','floor','maxStocks','Hindi','master','exports','flash','$room','concat','$date','bin','primary_code_hide','floorlevel','Floor','</tr>','user_id','back','product_list','Return\x20Goods','edit_purchases_view','primary_code','$suppliers','redirect','An\x20error\x20occurred.','../middleware/auth','Receiving\x20Area','</body></html>','type','currency_placement','$product_details.bin','getMonth','$product_details.secondary_code','expiry_date','</h5>','forEach','prod_qty','production_date','stocks','</thead>','$product_details.product_code','$suppliers_docs','</tbody>','delivery_date','isle','$product_details.storage','3095766SkvQIG','$name','<tbody\x20style=\x22text-align:\x20center;\x22>','string','getFullYear','image','pallet','MaxStocks_data','4OkPMHm','prod_level','sendMail','1085264vjemxs','suppliers','Router','$product_details.bay','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Ambient','paid_amount','$unit','../public/language/languages.json','$product_details._id','Rack\x20C','actual_uom','$product_details.level','purchase_quantity','then','quantity','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$alertquantity','prod_secondunit','abs','<span\x20style=\x22float:\x20right;\x22>','1062iLFKeg','success','$product_details.isle','return_purchase','</span>','$product.room_name','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$finalize','$product_details.pallet','params','$product.type','product_code','getDate','$secondary_code','POnumber','delivery_code','user','prod_name','product_cat','</div>','$product_details.product_stock','Purchase\x20Return','catch','staff','nodemailer','storage','return_qty','rack','findOne','email','toString','purchase_invoice','prod_Qty','ejs','random','padStart','Error\x20Occurs','French','$product_details.maxProducts','/view/:id','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','slice','$warehouse_name','\x20Order\x20Date\x20:\x20','room','/all_purchases/view','Logo.png','Purchase\x20Return\x20Mail','error','Chinese','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Rack\x20B','types','prod_isle','json','7131674xTxCyp','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/barcode/:id','<h2>\x20','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$note','createTransport','$maxProdPerUnit','port','Portuguese\x20(BR)','errors','secondary_unit','warehouse_name','aggregate','message','suppliers_docs','\x20</h2>','German','$maxStocks','save'];a0_0x381a=function(){return _0x587843;};return a0_0x381a();}router[a0_0x3a5ae7(0x12c)]('/view',auth,async(_0x4a9f62,_0x2eed0f)=>{var _0x2fb327=a0_0x3a5ae7;try{const {username:_0x4974d8,email:_0x2f5b7e,role:_0x3a62f3}=_0x4a9f62[_0x2fb327(0x1fe)],_0x2f83a5=_0x4a9f62[_0x2fb327(0x1fe)],_0x2d1eef=await profile[_0x2fb327(0x20a)]({'email':_0x2f83a5[_0x2fb327(0x20b)]}),_0x339545=await staff['findOne']({'email':_0x2f83a5[_0x2fb327(0x20b)]});if(_0x2f83a5['role']==_0x2fb327(0x205)){const _0x5df294=await staff[_0x2fb327(0x20a)]({'email':_0x2f83a5['email']});}const _0x26cee9=await master_shop[_0x2fb327(0x14d)]();let _0x5c4cb3;if(_0x2f83a5[_0x2fb327(0x23c)]==_0x2fb327(0x205)){const _0x4e3521=await staff[_0x2fb327(0x20a)]({'email':_0x2f83a5[_0x2fb327(0x20b)]});_0x5c4cb3=await purchases[_0x2fb327(0x233)]([{'$match':{'warehouse_name':_0x4e3521['warehouse']}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x2fb327(0x151),'as':_0x2fb327(0x235)}},{'$unwind':_0x2fb327(0x1c6)},{'$unwind':'$product'},{'$group':{'_id':_0x2fb327(0x216),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2fb327(0x1b3)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2fb327(0x1a5)},'product':{'$push':'$product'},'note':{'$first':_0x2fb327(0x22b)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2fb327(0x14f)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x2fb327(0x177)},'expiry_date':{'$first':_0x2fb327(0x19a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2fb327(0x145)},'isle':{'$addToSet':_0x2fb327(0x197)},'type':{'$addToSet':_0x2fb327(0x1f8)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5c4cb3=await purchases[_0x2fb327(0x233)]([{'$lookup':{'from':_0x2fb327(0x1d7),'localField':_0x2fb327(0x1d7),'foreignField':_0x2fb327(0x151),'as':_0x2fb327(0x235)}},{'$unwind':_0x2fb327(0x1c6)},{'$unwind':_0x2fb327(0x17d)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2fb327(0x1b3)},'date':{'$first':_0x2fb327(0x1a7)},'warehouse_name':{'$first':_0x2fb327(0x219)},'room':{'$addToSet':_0x2fb327(0x1f2)},'product':{'$push':_0x2fb327(0x17d)},'note':{'$first':_0x2fb327(0x22b)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2fb327(0x14f)},'return_data':{'$first':_0x2fb327(0x17e)},'batch_code':{'$first':_0x2fb327(0x177)},'expiry_date':{'$first':_0x2fb327(0x19a)},'suppliers_docs':{'$first':_0x2fb327(0x1c6)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2fb327(0x145)},'isle':{'$addToSet':_0x2fb327(0x197)},'type':{'$addToSet':_0x2fb327(0x1f8)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x2fb327(0x1f5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x26cee9[0x0]['language']=='English\x20(US)'){var _0x3cb4b0=users['English'];console['log'](_0x3cb4b0);}else{if(_0x26cee9[0x0][_0x2fb327(0x135)]==_0x2fb327(0x1a1))var _0x3cb4b0=users[_0x2fb327(0x1a1)];else{if(_0x26cee9[0x0]['language']==_0x2fb327(0x237))var _0x3cb4b0=users['German'];else{if(_0x26cee9[0x0][_0x2fb327(0x135)]==_0x2fb327(0x19e))var _0x3cb4b0=users[_0x2fb327(0x19e)];else{if(_0x26cee9[0x0][_0x2fb327(0x135)]==_0x2fb327(0x213))var _0x3cb4b0=users[_0x2fb327(0x213)];else{if(_0x26cee9[0x0][_0x2fb327(0x135)]==_0x2fb327(0x22f))var _0x3cb4b0=users[_0x2fb327(0x1da)];else{if(_0x26cee9[0x0][_0x2fb327(0x135)]=='Chinese')var _0x3cb4b0=users['Chinese'];else{if(_0x26cee9[0x0][_0x2fb327(0x135)]==_0x2fb327(0x13d))var _0x3cb4b0=users[_0x2fb327(0x12b)];}}}}}}}_0x2eed0f[_0x2fb327(0x171)]('all_purchases',{'success':_0x4a9f62[_0x2fb327(0x1a4)]('success'),'errors':_0x4a9f62[_0x2fb327(0x1a4)](_0x2fb327(0x230)),'purchases':_0x5c4cb3,'role':_0x2f83a5,'profile':_0x2d1eef,'master_shop':_0x26cee9,'language':_0x3cb4b0});}catch(_0x3b3ba5){console[_0x2fb327(0x188)](_0x2fb327(0x173),_0x3b3ba5),_0x2eed0f[_0x2fb327(0x18f)](0xc8)[_0x2fb327(0x225)]({'message':_0x3b3ba5['message']});}});function BayBinSelected(_0x294c83,_0x3ab6fc){var _0x7f9cbe=a0_0x3a5ae7,_0x564eff=[],_0x5dda96=[],_0x2be5e7=[],_0x4af9bc=[],_0x2d8920=[],_0x13a49a=[];let _0x302125=[];if(_0x294c83==_0x7f9cbe(0x16c))switch(_0x3ab6fc){case _0x7f9cbe(0x15a):_0x564eff=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5dda96=[0x1,0x2],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=[_0x7f9cbe(0x140),_0x7f9cbe(0x1ab)],_0x2d8920=['D'],_0x13a49a=['A'];break;case _0x7f9cbe(0x222):_0x564eff=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5dda96=[0x1,0x2],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=[_0x7f9cbe(0x140),'Floor'],_0x2d8920=['D'],_0x13a49a=['B'];break;case'Shelves':_0x564eff=[0x0],_0x5dda96=[0x0],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=[_0x7f9cbe(0x1ab)],_0x2d8920=['D'],_0x13a49a=['S'];break;case _0x7f9cbe(0x1b7):_0x564eff=[0x0],_0x5dda96=[0x0],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2be5e7=['Floor'],_0x2d8920=['D'],_0x13a49a=['R'];break;}else{if(_0x294c83==_0x7f9cbe(0x172))switch(_0x3ab6fc){case'Rack\x20A':_0x564eff=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5dda96=['B','F'],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=[_0x7f9cbe(0x140),_0x7f9cbe(0x1ab)],_0x2d8920=['C'],_0x13a49a=['A'];break;case _0x7f9cbe(0x222):_0x564eff=[0x5,0x4,0x3,0x2,0x1],_0x5dda96=['F','B','S'],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=['Level',_0x7f9cbe(0x1ab)],_0x2d8920=['C'],_0x13a49a=['B'];break;case _0x7f9cbe(0x1e1):_0x564eff=[0x1,0x2,0x3,0x4,0x5],_0x5dda96=['B','F','S'],_0x4af9bc=[0x5,0x4,0x3,0x2,0x1],_0x2be5e7=['Level','Floor'],_0x2d8920=['C'],_0x13a49a=['C'];break;case'Rack\x20D':_0x564eff=[0x5,0x4,0x3,0x2,0x1],_0x5dda96=['F','B','S'],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=[_0x7f9cbe(0x140),_0x7f9cbe(0x1ab)],_0x2d8920=['C'],_0x13a49a=['D'];break;case _0x7f9cbe(0x162):_0x564eff=[0x4,0x3,0x2,0x1],_0x5dda96=[0x1,0x2],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=['Level','Floor'],_0x2d8920=['C'],_0x13a49a=['E'];break;case'Rack\x20F':_0x564eff=[0x1,0x2,0x3],_0x5dda96=[0x1,0x2],_0x4af9bc=[0x1,0x2,0x3,0x4,0x5],_0x2be5e7=[_0x7f9cbe(0x140)],_0x2d8920=['C'],_0x13a49a=['F'];break;}}return{'levels':_0x564eff,'Isle':_0x5dda96,'rack':_0x4af9bc,'type':_0x2be5e7,'storage':_0x2d8920,'rak':_0x13a49a};}function a0_0x3a1d(_0x425489,_0x196637){var _0x381a3c=a0_0x381a();return a0_0x3a1d=function(_0x3a1df7,_0x4be35a){_0x3a1df7=_0x3a1df7-0x127;var _0x50f43d=_0x381a3c[_0x3a1df7];return _0x50f43d;},a0_0x3a1d(_0x425489,_0x196637);}async function getRandom8DigitNumber(){var _0x2473a0=a0_0x3a5ae7;const _0x594f57=0x989680,_0x15df5d=0x5f5e0ff,_0xa8c6de=Math[_0x2473a0(0x19f)](Math[_0x2473a0(0x210)]()*(_0x15df5d-_0x594f57+0x1))+_0x594f57;var _0xf1d2f;const _0x571997=await purchases[_0x2473a0(0x20a)]({'invoice':'INC-'+_0xa8c6de});return _0x571997&&_0x571997[_0x2473a0(0x13e)]>0x0?_0xf1d2f='INC-'+_0xa8c6de:_0xf1d2f=_0x2473a0(0x199)+_0xa8c6de,_0xf1d2f;}router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x13f),auth,async(_0x3ef0b6,_0x4e39d5)=>{var _0x1b04c1=a0_0x3a5ae7;try{const {username:_0xc88ef5,email:_0x249812,role:_0x515294}=_0x3ef0b6[_0x1b04c1(0x1fe)],_0x24a8f4=_0x3ef0b6[_0x1b04c1(0x1fe)],_0x32de38=await profile['findOne']({'email':_0x24a8f4['email']}),_0x1bc2b1=await master_shop[_0x1b04c1(0x14d)](),_0x470b56=await staff[_0x1b04c1(0x20a)]({'email':_0x24a8f4[_0x1b04c1(0x20b)]}),_0x1c9a84=await suppliers['find']({});let _0x567d57;if(_0x24a8f4[_0x1b04c1(0x23c)]==_0x1b04c1(0x205)){const _0x1050d9=await staff[_0x1b04c1(0x20a)]({'email':_0x24a8f4[_0x1b04c1(0x20b)]});_0x567d57=await warehouse[_0x1b04c1(0x233)]([{'$match':{'status':'Enabled','name':_0x1050d9['warehouse'],'warehouse_category':_0x1b04c1(0x148),'name':{'$ne':_0x1b04c1(0x1b0)}}},{'$group':{'_id':_0x1b04c1(0x1cc),'name':{'$first':_0x1b04c1(0x1cc)}}}]);}else _0x567d57=await warehouse['aggregate']([{'$match':{'status':_0x1b04c1(0x23e),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1b04c1(0x1b0)}}},{'$group':{'_id':'$name','name':{'$first':_0x1b04c1(0x1cc)}}}]);const _0x3dbc04=await product['find']({}),_0x2ee75a=await warehouse['find']({'status':_0x1b04c1(0x23e)}),_0x409a9b=await purchases[_0x1b04c1(0x14d)]({}),_0xa39890=_0x409a9b[_0x1b04c1(0x13e)]+0x1,_0x2ccaa7=_0x1b04c1(0x199)+_0xa39890[_0x1b04c1(0x20c)]()[_0x1b04c1(0x211)](0x5,'0');var _0x312ca0=[_0x1b04c1(0x1dc),'Enclosed'];if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]==_0x1b04c1(0x136))var _0x5160b8=users['English'];else{if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]==_0x1b04c1(0x1a1))var _0x5160b8=users[_0x1b04c1(0x1a1)];else{if(_0x1bc2b1[0x0]['language']==_0x1b04c1(0x237))var _0x5160b8=users['German'];else{if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]==_0x1b04c1(0x19e))var _0x5160b8=users[_0x1b04c1(0x19e)];else{if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]=='French')var _0x5160b8=users['French'];else{if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]==_0x1b04c1(0x22f))var _0x5160b8=users[_0x1b04c1(0x1da)];else{if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]==_0x1b04c1(0x220))var _0x5160b8=users['Chinese'];else{if(_0x1bc2b1[0x0][_0x1b04c1(0x135)]==_0x1b04c1(0x13d))var _0x5160b8=users[_0x1b04c1(0x12b)];}}}}}}}const _0xb0de52=getRandom8DigitNumber();_0xb0de52[_0x1b04c1(0x1e5)](_0x3957d0=>{var _0x1f723e=_0x1b04c1;_0x4e39d5[_0x1f723e(0x171)](_0x1f723e(0x13a),{'success':_0x3ef0b6[_0x1f723e(0x1a4)]('success'),'errors':_0x3ef0b6[_0x1f723e(0x1a4)](_0x1f723e(0x230)),'role':_0x24a8f4,'profile':_0x32de38,'suppliers':_0x1c9a84,'warehouse':_0x567d57,'product':_0x3dbc04,'invoice':_0x3957d0,'master_shop':_0x1bc2b1,'language':_0x5160b8,'find_data':_0x2ee75a,'rooms_data':_0x312ca0});})['catch'](_0x478d0a=>{var _0x190a03=_0x1b04c1;_0x3ef0b6[_0x190a03(0x1a4)](_0x190a03(0x230),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4e39d5[_0x190a03(0x1b4)](_0x190a03(0x21c));});}catch(_0x562904){console[_0x1b04c1(0x188)](_0x562904);}}),router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x169),auth,async(_0x3d7213,_0x1a83ed)=>{var _0x1f402b=a0_0x3a5ae7;try{const _0x28dc1b=_0x3d7213[_0x1f402b(0x1f7)]['id'];console[_0x1f402b(0x188)](_0x28dc1b);const _0x5e8ca9=await master_shop['find']();console[_0x1f402b(0x188)](_0x1f402b(0x1a2),_0x5e8ca9);const _0x5a104d=await product[_0x1f402b(0x20a)]({'name':_0x28dc1b});console[_0x1f402b(0x188)](_0x1f402b(0x184),_0x5a104d),_0x1a83ed[_0x1f402b(0x18f)](0xc8)['json']({'product_data':_0x5a104d,'master':_0x5e8ca9});}catch(_0x2f1e51){console[_0x1f402b(0x188)]('add_purchases\x20error',_0x2f1e51);}}),router['post'](a0_0x3a5ae7(0x13f),auth,async(_0xc81430,_0x334f5f)=>{var _0x5eeded=a0_0x3a5ae7;try{const {invoice:_0x267011,date:_0x3613af,warehouse_name:_0x30c732,prod_name:_0xdd61a9,prod_code:_0x4c40c1,prod_qty:_0x2a1dc5,prod_unit:_0x23ceb3,prod_secondunit:_0x6f9995,prod_level:_0x3287aa,prod_isle:_0x42b7b8,prod_pallet:_0x36f3c5,note:_0x42d8e0,expiry_date:_0x49e764,batch_code:_0x491ea6,payable:_0x49523d,due_amount:_0x443a0c,Room_name:_0x455141,primary_code:_0x5c1fc2,secondary_code:_0x4d898d,MaxStocks_data:_0x516a98,PO_number:_0x48052c,SCRN:_0x136b6e,JO_number:_0xbb60ee}=_0xc81430[_0x5eeded(0x194)];if(typeof _0xdd61a9==_0x5eeded(0x1ce))var _0x49cc88=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1ff)]],_0x3ba1e5=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x158)]],_0xceb721=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x20e)]],_0x4cadd3=[_0xc81430['body'][_0x5eeded(0x15c)]],_0x457c86=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1ea)]],_0x4e5fe0=[_0xc81430['body']['prod_level']],_0x1db8bf=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1b2)]],_0x5c326e=[_0xc81430[_0x5eeded(0x194)]['secondary_code']],_0x389c10=[_0xc81430[_0x5eeded(0x194)]['MaxStocks_data']],_0x2561f0=[_0xc81430[_0x5eeded(0x194)]['batch_code']],_0x5577b8=[_0xc81430['body']['expiry_date']],_0x1fd404=[_0xc81430['body']['max_product_unit']],_0x528668=[_0xc81430[_0x5eeded(0x194)]['alertQTY']],_0x10a600=[_0xc81430['body']['production_date']],_0x3ec910=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x133)]],_0x19a70a=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x18e)]],_0xfd77f5=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x189)]],_0x46d6e7=[_0xc81430['body'][_0x5eeded(0x183)]],_0x199a27=[_0xc81430['body'][_0x5eeded(0x14c)]],_0x3d546a=[_0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1e2)]];else var _0x49cc88=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1ff)]],_0x3ba1e5=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x158)]],_0xceb721=[..._0xc81430['body'][_0x5eeded(0x20e)]],_0x4cadd3=[..._0xc81430['body'][_0x5eeded(0x15c)]],_0x457c86=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1ea)]],_0x4e5fe0=[..._0xc81430['body'][_0x5eeded(0x1d4)]],_0x1db8bf=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1b2)]],_0x5c326e=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x196)]],_0x389c10=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1d2)]],_0x2561f0=[..._0xc81430[_0x5eeded(0x194)]['batch_code']],_0x5577b8=[..._0xc81430['body'][_0x5eeded(0x1be)]],_0x1fd404=[..._0xc81430['body']['max_product_unit']],_0x528668=[..._0xc81430['body'][_0x5eeded(0x191)]],_0x10a600=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1c2)]],_0x3ec910=[..._0xc81430['body'][_0x5eeded(0x133)]],_0x19a70a=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x18e)]],_0xfd77f5=[..._0xc81430['body'][_0x5eeded(0x189)]],_0x46d6e7=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x183)]],_0x199a27=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x14c)]],_0x3d546a=[..._0xc81430[_0x5eeded(0x194)][_0x5eeded(0x1e2)]];const _0x10f343=_0x49cc88['map'](_0x2c9c71=>{return _0x2c9c71={'product_name':_0x2c9c71};});_0x199a27[_0x5eeded(0x1c0)]((_0x41cd56,_0x20ea64)=>{var _0x36ae9c=_0x5eeded;_0x10f343[_0x20ea64]['actual_qty']=Math[_0x36ae9c(0x1eb)](_0x41cd56);}),_0x3d546a[_0x5eeded(0x1c0)]((_0x56b023,_0x320ec0)=>{var _0x5bf857=_0x5eeded;_0x10f343[_0x320ec0][_0x5bf857(0x1e2)]=_0x56b023;}),_0x3ba1e5[_0x5eeded(0x1c0)]((_0x491a3d,_0x302809)=>{var _0x1f52c6=_0x5eeded;_0x10f343[_0x302809][_0x1f52c6(0x1f9)]=_0x491a3d;}),_0xceb721[_0x5eeded(0x1c0)]((_0x18f517,_0x19f10a)=>{var _0x2c567a=_0x5eeded;_0x10f343[_0x19f10a][_0x2c567a(0x1e6)]=Math[_0x2c567a(0x1eb)](_0x18f517);}),_0x4cadd3[_0x5eeded(0x1c0)]((_0x27264e,_0x3f796b)=>{_0x10f343[_0x3f796b]['standard_unit']=_0x27264e;}),_0x457c86[_0x5eeded(0x1c0)]((_0x3aa3a3,_0x17f2a7)=>{var _0x16dfc7=_0x5eeded;_0x10f343[_0x17f2a7][_0x16dfc7(0x231)]=_0x3aa3a3;}),_0x4e5fe0[_0x5eeded(0x1c0)]((_0x229aa3,_0x5778c4)=>{var _0x22ebb4=_0x5eeded;_0x19a70a[_0x22ebb4(0x1c0)]((_0x41d68f,_0x4ac1c3)=>{var _0x39b02b=_0x22ebb4;if(_0x41d68f==_0x39b02b(0x1b7)&&_0x5778c4==_0x4ac1c3){console['log'](_0x41d68f+_0x39b02b(0x176)+_0x5778c4+_0x39b02b(0x168)+_0x4ac1c3+_0x39b02b(0x168)+_0x229aa3);var _0x50b5e2=_0x229aa3['slice'](0x3);_0x10f343[_0x5778c4]['storage']=_0x229aa3[0x0],_0x10f343[_0x5778c4][_0x39b02b(0x209)]=_0x229aa3[0x1],_0x10f343[_0x5778c4][_0x39b02b(0x139)]=0x0,_0x10f343[_0x5778c4][_0x39b02b(0x1a8)]=0x0,_0x10f343[_0x5778c4][_0x39b02b(0x1b9)]='Floor',_0x10f343[_0x5778c4][_0x39b02b(0x1aa)]=_0x50b5e2;}else{if(_0x41d68f=='Shelves'&&_0x5778c4==_0x4ac1c3){var _0x50b5e2=_0x229aa3[_0x39b02b(0x218)](0x3);_0x10f343[_0x5778c4][_0x39b02b(0x207)]=_0x229aa3[0x0],_0x10f343[_0x5778c4][_0x39b02b(0x209)]=_0x229aa3[0x1],_0x10f343[_0x5778c4][_0x39b02b(0x139)]=0x0,_0x10f343[_0x5778c4][_0x39b02b(0x1a8)]=0x0,_0x10f343[_0x5778c4][_0x39b02b(0x1b9)]='Floor',_0x10f343[_0x5778c4][_0x39b02b(0x1aa)]=_0x229aa3[0x5];}else{if(_0x5778c4==_0x4ac1c3){if(_0x229aa3[0x0]=='A'&&_0x229aa3[0x1]=='L'&&_0x229aa3[0x2]=='L')console[_0x39b02b(0x188)](_0x41d68f+'\x20<>\x20'+_0x5778c4+_0x39b02b(0x168)+_0x4ac1c3+_0x39b02b(0x168)+_0x229aa3+_0x39b02b(0x137)),_0x10f343[_0x5778c4][_0x39b02b(0x207)]=_0x229aa3[0x0],_0x10f343[_0x5778c4][_0x39b02b(0x209)]=_0x229aa3[0x1],_0x10f343[_0x5778c4][_0x39b02b(0x139)]=0x0,_0x10f343[_0x5778c4][_0x39b02b(0x1a8)]=0x0,_0x10f343[_0x5778c4][_0x39b02b(0x1b9)]=_0x39b02b(0x1ab),_0x10f343[_0x5778c4]['floorlevel']=_0x229aa3[0x3];else{var _0x2d561e;if(_0x229aa3[0x4]=='L')_0x2d561e=_0x39b02b(0x140);else _0x229aa3[0x4]=='F'&&(_0x2d561e=_0x39b02b(0x1ab));_0x10f343[_0x5778c4][_0x39b02b(0x207)]=_0x229aa3[0x0],_0x10f343[_0x5778c4][_0x39b02b(0x209)]=_0x229aa3[0x1],_0x10f343[_0x5778c4][_0x39b02b(0x139)]=_0x229aa3[0x2],_0x10f343[_0x5778c4][_0x39b02b(0x1a8)]=_0x229aa3[0x3],_0x10f343[_0x5778c4][_0x39b02b(0x1b9)]=_0x2d561e,_0x10f343[_0x5778c4][_0x39b02b(0x1aa)]=_0x229aa3[0x5];}}}}});}),_0x1db8bf[_0x5eeded(0x1c0)]((_0x465347,_0x1a2d39)=>{var _0x57a7df=_0x5eeded;_0x10f343[_0x1a2d39][_0x57a7df(0x1b2)]=_0x465347;}),_0x5c326e[_0x5eeded(0x1c0)]((_0x224a1d,_0x71a779)=>{_0x10f343[_0x71a779]['secondary_code']=_0x224a1d;}),_0x389c10['forEach']((_0x547e3e,_0xc7bec9)=>{var _0x3e0991=_0x5eeded;_0x10f343[_0xc7bec9][_0x3e0991(0x1a0)]=_0x547e3e;}),_0x2561f0[_0x5eeded(0x1c0)]((_0x342d16,_0x3c1d19)=>{var _0x54d196=_0x5eeded;_0x10f343[_0x3c1d19][_0x54d196(0x174)]=_0x342d16;}),_0x5577b8[_0x5eeded(0x1c0)]((_0x448eb2,_0x27f9b5)=>{var _0x4382d3=_0x5eeded;_0x10f343[_0x27f9b5][_0x4382d3(0x1be)]=_0x448eb2;}),_0x1fd404[_0x5eeded(0x1c0)]((_0x39b011,_0x351cfd)=>{var _0x33309d=_0x5eeded;_0x10f343[_0x351cfd][_0x33309d(0x1e7)]=_0x39b011;}),_0x528668[_0x5eeded(0x1c0)]((_0x6fcb4b,_0x42566f)=>{var _0x4cfa25=_0x5eeded;_0x10f343[_0x42566f][_0x4cfa25(0x191)]=_0x6fcb4b;}),_0x10a600[_0x5eeded(0x1c0)]((_0x4543b8,_0x43a425)=>{_0x10f343[_0x43a425]['production_date']=_0x4543b8;}),_0x3ec910['forEach']((_0x407c46,_0x26c026)=>{_0x10f343[_0x26c026]['product_cat']=_0x407c46;}),_0x19a70a[_0x5eeded(0x1c0)]((_0x6a4ab9,_0x37715f)=>{var _0x54b648=_0x5eeded;_0x10f343[_0x37715f][_0x54b648(0x18d)]=_0x6a4ab9;}),_0xfd77f5[_0x5eeded(0x1c0)]((_0x79434e,_0xa45dd3)=>{_0x10f343[_0xa45dd3]['delivery_code']=_0x79434e;}),_0x46d6e7['forEach']((_0x3465f3,_0x12e6a2)=>{var _0x49e365=_0x5eeded;_0x10f343[_0x12e6a2][_0x49e365(0x12f)]=_0x3465f3;});const _0x4a2561=_0x19a70a[_0x5eeded(0x246)](_0x3779e6=>{return _0x3779e6={'room_name':_0x3779e6};}),_0x1edaf7=_0x10f343[_0x5eeded(0x242)](_0x2bfb55=>_0x2bfb55['quantity']!=='0'&&_0x2bfb55[_0x5eeded(0x1e6)]!==''),_0x157cda=new purchases({'invoice':_0x267011,'suppliers':_0xc81430['body'][_0x5eeded(0x1d7)],'date':_0x3613af,'warehouse_name':_0x30c732,'product':_0x1edaf7,'note':_0x42d8e0,'due_amount':_0x443a0c,'POnumber':_0x48052c,'SCRN':_0x136b6e,'JO_number':_0xbb60ee,'roomList':_0x4a2561}),_0x3d6845=await _0x157cda[_0x5eeded(0x239)](),_0x16321a=await purchases[_0x5eeded(0x20a)]({'invoice':_0x267011}),_0x4eda0e=_0x16321a[_0x5eeded(0x184)][_0x5eeded(0x246)](async _0x42bbc7=>{var _0x492c40=_0x5eeded,_0x404c9b=await warehouse[_0x492c40(0x20a)]({'name':_0x30c732,'room':_0x42bbc7[_0x492c40(0x18d)]}),_0x1e8660=0x0;return _0x404c9b[_0x492c40(0x19b)][_0x492c40(0x1c0)](_0xbfe913=>{var _0x1dc754=_0x492c40;_0xbfe913[_0x1dc754(0x167)]==_0x42bbc7[_0x1dc754(0x167)]&&_0xbfe913['floorlevel']==_0x42bbc7[_0x1dc754(0x1aa)]&&_0xbfe913[_0x1dc754(0x1b9)]==_0x42bbc7[_0x1dc754(0x1b9)]&&_0xbfe913['bin']==_0x42bbc7[_0x1dc754(0x1a8)]&&_0xbfe913['bay']==_0x42bbc7['bay']&&_0xbfe913[_0x1dc754(0x209)]==_0x42bbc7['rack']&&_0xbfe913[_0x1dc754(0x207)]==_0x42bbc7[_0x1dc754(0x207)]&&_0xbfe913[_0x1dc754(0x1be)]==_0x42bbc7[_0x1dc754(0x1be)]&&_0xbfe913[_0x1dc754(0x174)]==_0x42bbc7[_0x1dc754(0x174)]&&_0xbfe913[_0x1dc754(0x1c2)]==_0x42bbc7[_0x1dc754(0x1c2)]&&_0xbfe913['invoice']==_0x16321a[_0x1dc754(0x12f)]&&(_0xbfe913[_0x1dc754(0x146)]+=Math['abs'](_0x42bbc7[_0x1dc754(0x1e6)]),_0x1e8660++);}),_0x1e8660===0x0&&_0x404c9b[_0x492c40(0x19b)][_0x492c40(0x154)]({'product_name':_0x42bbc7[_0x492c40(0x167)],'product_stock':Math[_0x492c40(0x1eb)](_0x42bbc7[_0x492c40(0x1e6)]),'primary_code':_0x42bbc7[_0x492c40(0x1b2)],'secondary_code':_0x42bbc7[_0x492c40(0x196)],'product_code':_0x42bbc7[_0x492c40(0x1f9)],'storage':_0x42bbc7[_0x492c40(0x207)],'rack':_0x42bbc7[_0x492c40(0x209)],'bay':_0x42bbc7['bay'],'bin':_0x42bbc7['bin'],'type':_0x42bbc7[_0x492c40(0x1b9)],'floorlevel':_0x42bbc7[_0x492c40(0x1aa)],'maxProducts':_0x42bbc7[_0x492c40(0x1a0)],'unit':_0x42bbc7[_0x492c40(0x131)],'secondary_unit':_0x42bbc7[_0x492c40(0x231)],'expiry_date':_0x42bbc7[_0x492c40(0x1be)],'maxPerUnit':_0x42bbc7[_0x492c40(0x1e7)],'batch_code':_0x42bbc7[_0x492c40(0x174)],'alertQTY':_0x42bbc7[_0x492c40(0x191)],'production_date':_0x42bbc7[_0x492c40(0x1c2)],'product_cat':_0x42bbc7[_0x492c40(0x200)],'invoice':_0x42bbc7['invoice'],'actual_qty':Math[_0x492c40(0x1eb)](_0x42bbc7['actual_qty']),'actual_uom':_0x42bbc7[_0x492c40(0x1e2)]}),_0x404c9b;});Promise['all'](_0x4eda0e)[_0x5eeded(0x1e5)](async _0x4beb02=>{var _0x5cac75=_0x5eeded;try{for(const _0x384dbd of _0x4beb02){await _0x384dbd[_0x5cac75(0x239)]();}const _0x53627b=await master_shop['find'](),_0x192abb=await email_settings['findOne'](),_0x1b0b00=await supervisor_settings[_0x5cac75(0x14d)]();var _0x1074ba=_0x16321a[_0x5cac75(0x184)],_0x572488='',_0x189dfa;for(_0x189dfa in _0x1074ba){_0x572488+=_0x5cac75(0x16f)+_0x5cac75(0x155)+_0x1074ba[_0x189dfa][_0x5cac75(0x167)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1074ba[_0x189dfa][_0x5cac75(0x1f9)]+_0x5cac75(0x12e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1074ba[_0x189dfa][_0x5cac75(0x1e6)]+_0x5cac75(0x12e)+_0x5cac75(0x155)+_0x1074ba[_0x189dfa][_0x5cac75(0x131)]+'</td>'+_0x5cac75(0x155)+_0x1074ba[_0x189dfa]['secondary_unit']+_0x5cac75(0x12e)+_0x5cac75(0x155)+_0x16321a[_0x5cac75(0x232)]+_0x5cac75(0x12e)+_0x5cac75(0x155)+_0x1074ba[_0x189dfa][_0x5cac75(0x18d)]+'</td>'+_0x5cac75(0x155)+_0x1074ba[_0x189dfa]['storage']+_0x1074ba[_0x189dfa][_0x5cac75(0x209)]+_0x1074ba[_0x189dfa][_0x5cac75(0x139)]+_0x1074ba[_0x189dfa]['bin']+_0x1074ba[_0x189dfa][_0x5cac75(0x1b9)][0x0]+_0x1074ba[_0x189dfa][_0x5cac75(0x1aa)]+_0x5cac75(0x12e),_0x5cac75(0x1ac);}let _0x5494ae=nodemailer[_0x5cac75(0x22c)]({'host':_0x192abb[_0x5cac75(0x143)],'port':Number(_0x192abb[_0x5cac75(0x22e)]),'secure':![],'auth':{'user':_0x192abb['email'],'pass':_0x192abb[_0x5cac75(0x19d)]}}),_0x3c9e2b={'from':_0x192abb[_0x5cac75(0x20b)],'to':_0x1b0b00[0x0]['RMSEmail'],'subject':_0x5cac75(0x18b),'attachments':[{'filename':_0x5cac75(0x21d),'path':__dirname+'/../public'+'/upload/'+_0x53627b[0x0][_0x5cac75(0x1d0)],'cid':_0x5cac75(0x15f)}],'html':_0x5cac75(0x13b)+'<html><head><title></title>'+_0x5cac75(0x15e)+_0x5cac75(0x170)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x5cac75(0x227)+_0x5cac75(0x201)+'<div>'+_0x5cac75(0x229)+_0x53627b[0x0]['site_title']+_0x5cac75(0x236)+_0x5cac75(0x201)+'</div>'+_0x5cac75(0x157)+_0x5cac75(0x170)+_0x5cac75(0x192)+_0x5cac75(0x19c)+_0x16321a[_0x5cac75(0x12f)]+'\x20'+_0x5cac75(0x1ec)+_0x5cac75(0x21a)+_0x16321a[_0x5cac75(0x159)]+'\x20'+_0x5cac75(0x1f1)+_0x5cac75(0x1bf)+_0x5cac75(0x201)+_0x5cac75(0x179)+_0x5cac75(0x221)+'<tr>'+_0x5cac75(0x160)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5cac75(0x217)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x5cac75(0x134)+_0x5cac75(0x132)+_0x5cac75(0x1ac)+_0x5cac75(0x1c4)+_0x5cac75(0x1cd)+'\x20'+_0x572488+'\x20'+_0x5cac75(0x1c7)+_0x5cac75(0x245)+_0x5cac75(0x170)+_0x5cac75(0x23a)+'<h5>'+_0x53627b[0x0][_0x5cac75(0x149)]+'</h5>'+_0x5cac75(0x201)+_0x5cac75(0x201)+_0x5cac75(0x1b8)};_0x5494ae[_0x5cac75(0x1d5)](_0x3c9e2b,function(_0x526072,_0x1efaec){var _0xf4d184=_0x5cac75;_0x526072?(console[_0xf4d184(0x188)](_0x526072),console['log'](_0xf4d184(0x212))):console[_0xf4d184(0x188)](_0xf4d184(0x17a));}),_0xc81430['flash']('success','Purchase\x20data\x20added\x20successfully'),_0x334f5f['redirect'](_0x5cac75(0x17f));}catch(_0x12e6af){console[_0x5cac75(0x21f)](_0x12e6af),_0x334f5f[_0x5cac75(0x18f)](0x1f4)[_0x5cac75(0x225)]({'error':_0x5cac75(0x14e)});}})[_0x5eeded(0x204)](_0x4eca69=>{var _0x49aee5=_0x5eeded;console[_0x49aee5(0x21f)](_0x4eca69),_0x334f5f[_0x49aee5(0x18f)](0x1f4)['json']({'error':_0x49aee5(0x1b5)});});}catch(_0x240c1f){console['log'](_0x240c1f);}}),router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x156),auth,async(_0x110bc3,_0x2e2820)=>{var _0x24e2cc=a0_0x3a5ae7;try{const {username:_0x935eb0,email:_0x2f6463,role:_0x276416}=_0x110bc3['user'],_0x20f6b3=_0x110bc3[_0x24e2cc(0x1fe)],_0xa974bc=await profile[_0x24e2cc(0x20a)]({'email':_0x20f6b3[_0x24e2cc(0x20b)]}),_0x127101=await master_shop[_0x24e2cc(0x14d)](),_0x3275ef=_0x110bc3[_0x24e2cc(0x1f7)]['id'],_0x24669a=await purchases[_0x24e2cc(0x23b)](_0x3275ef),_0x18a127=await warehouse['aggregate']([{'$match':{'name':_0x24669a[_0x24e2cc(0x232)],'room':_0x24669a[_0x24e2cc(0x21b)]}},{'$unwind':_0x24e2cc(0x150)},{'$group':{'_id':_0x24e2cc(0x1e0),'name':{'$first':_0x24e2cc(0x163)},'product_stock':{'$first':_0x24e2cc(0x202)},'bay':{'$first':_0x24e2cc(0x1d9)},'bin':{'$first':_0x24e2cc(0x1bb)},'type':{'$first':_0x24e2cc(0x16d)},'floorlevel':{'$first':_0x24e2cc(0x18c)},'primary_code':{'$first':_0x24e2cc(0x130)},'secondary_code':{'$first':_0x24e2cc(0x1bd)},'product_code':{'$first':_0x24e2cc(0x1c5)},'storage':{'$first':_0x24e2cc(0x1ca)},'rack':{'$first':_0x24e2cc(0x175)},'expiry_date':{'$first':_0x24e2cc(0x244)}}}]),_0x3370be=await customer[_0x24e2cc(0x14d)]({});let _0x18b48a;if(_0x20f6b3[_0x24e2cc(0x23c)]=='staff'){const _0x1524b5=await staff[_0x24e2cc(0x20a)]({'email':_0x20f6b3[_0x24e2cc(0x20b)]});_0x18b48a=await warehouse[_0x24e2cc(0x233)]([{'$match':{'status':_0x24e2cc(0x23e),'name':_0x1524b5[_0x24e2cc(0x164)]}},{'$group':{'_id':_0x24e2cc(0x1cc),'name':{'$first':_0x24e2cc(0x1cc)}}}]);}else _0x18b48a=await warehouse[_0x24e2cc(0x233)]([{'$match':{'status':_0x24e2cc(0x23e)}},{'$group':{'_id':_0x24e2cc(0x1cc),'name':{'$first':'$name'}}}]);const _0x9638d1=await product[_0x24e2cc(0x14d)]({}),_0x465593=await suppliers[_0x24e2cc(0x14d)]({}),_0x256ef1=BayBinSelected(_0x24669a['warehouse_name'],_0x24669a[_0x24e2cc(0x21b)]);if(_0x127101[0x0][_0x24e2cc(0x135)]=='English\x20(US)'){var _0x309d16=users['English'];console[_0x24e2cc(0x188)](_0x309d16);}else{if(_0x127101[0x0][_0x24e2cc(0x135)]=='Hindi')var _0x309d16=users[_0x24e2cc(0x1a1)];else{if(_0x127101[0x0][_0x24e2cc(0x135)]==_0x24e2cc(0x237))var _0x309d16=users['German'];else{if(_0x127101[0x0][_0x24e2cc(0x135)]==_0x24e2cc(0x19e))var _0x309d16=users[_0x24e2cc(0x19e)];else{if(_0x127101[0x0][_0x24e2cc(0x135)]==_0x24e2cc(0x213))var _0x309d16=users[_0x24e2cc(0x213)];else{if(_0x127101[0x0]['language']==_0x24e2cc(0x22f))var _0x309d16=users['Portuguese'];else{if(_0x127101[0x0][_0x24e2cc(0x135)]==_0x24e2cc(0x220))var _0x309d16=users[_0x24e2cc(0x220)];else{if(_0x127101[0x0][_0x24e2cc(0x135)]==_0x24e2cc(0x13d))var _0x309d16=users[_0x24e2cc(0x12b)];}}}}}}}_0x2e2820['render'](_0x24e2cc(0x1b1),{'success':_0x110bc3[_0x24e2cc(0x1a4)](_0x24e2cc(0x1ee)),'errors':_0x110bc3['flash'](_0x24e2cc(0x230)),'role':_0x20f6b3,'profile':_0xa974bc,'customer':_0x3370be,'warehouse':_0x18b48a,'product':_0x18a127,'user':_0x24669a,'master_shop':_0x127101,'unit':_0x9638d1,'language':_0x309d16,'suppliers':_0x465593,'dataSelected':_0x256ef1});}catch(_0x4bd97c){console[_0x24e2cc(0x188)](_0x4bd97c);}}),router[a0_0x3a5ae7(0x187)](a0_0x3a5ae7(0x156),auth,async(_0x5c3355,_0x55568d)=>{var _0x313484=a0_0x3a5ae7;try{const _0x401469=_0x5c3355[_0x313484(0x1f7)]['id'],{invoice:_0x297d4a,warehouse_name:_0x4b3c97,Room_name:_0xc42de5}=_0x5c3355[_0x313484(0x194)],_0x18a7f6=await warehouse[_0x313484(0x20a)]({'name':_0x4b3c97,'room':_0xc42de5}),_0x63a595=await purchases[_0x313484(0x20a)]({'invoice':_0x297d4a});_0x63a595[_0x313484(0x184)]['forEach'](_0x4d7757=>{var _0x970fcd=_0x313484,_0x521053=0x0;const _0x4c14e1=_0x18a7f6['product_details'][_0x970fcd(0x246)](_0x35b0b1=>{var _0x4fa118=_0x970fcd;_0x35b0b1[_0x4fa118(0x167)]==_0x4d7757['product_name']&&_0x35b0b1['floorlevel']==_0x4d7757[_0x4fa118(0x1aa)]&&_0x35b0b1[_0x4fa118(0x1b9)]==_0x4d7757[_0x4fa118(0x1b9)]&&_0x35b0b1[_0x4fa118(0x1a8)]==_0x4d7757[_0x4fa118(0x1a8)]&&_0x35b0b1['bay']==_0x4d7757['bay']&&_0x35b0b1[_0x4fa118(0x209)]==_0x4d7757[_0x4fa118(0x209)]&&_0x35b0b1[_0x4fa118(0x207)]==_0x4d7757[_0x4fa118(0x207)]&&_0x35b0b1[_0x4fa118(0x1be)]==_0x4d7757['expiry_date']&&_0x35b0b1['batch_code']==_0x4d7757[_0x4fa118(0x174)]&&_0x35b0b1['production_date']==_0x4d7757[_0x4fa118(0x1c2)]&&_0x35b0b1[_0x4fa118(0x1c8)]==_0x4d7757[_0x4fa118(0x1c8)]&&_0x35b0b1['delivery_code']==_0x4d7757[_0x4fa118(0x1fd)]&&(_0x35b0b1[_0x4fa118(0x146)]=parseInt(_0x35b0b1[_0x4fa118(0x146)])+parseInt(_0x4d7757[_0x4fa118(0x1e6)]),_0x521053++);});_0x521053=='0'&&(_0x18a7f6[_0x970fcd(0x19b)]=_0x18a7f6['product_details'][_0x970fcd(0x1a6)]({'product_name':_0x4d7757[_0x970fcd(0x167)],'product_stock':_0x4d7757[_0x970fcd(0x1e6)],'primary_code':_0x4d7757[_0x970fcd(0x1b2)],'secondary_code':_0x4d7757[_0x970fcd(0x196)],'product_code':_0x4d7757[_0x970fcd(0x1f9)],'storage':_0x4d7757['storage'],'rack':_0x4d7757[_0x970fcd(0x209)],'bay':_0x4d7757['bay'],'bin':_0x4d7757[_0x970fcd(0x1a8)],'type':_0x4d7757['type'],'floorlevel':_0x4d7757[_0x970fcd(0x1aa)],'maxProducts':_0x4d7757['maxStocks'],'unit':_0x4d7757[_0x970fcd(0x131)],'secondary_unit':_0x4d7757['secondary_unit'],'expiry_date':_0x4d7757[_0x970fcd(0x1be)],'maxPerUnit':_0x4d7757[_0x970fcd(0x1e7)],'batch_code':_0x4d7757['batch_code'],'alertQTY':_0x4d7757[_0x970fcd(0x191)],'production_date':_0x4d7757[_0x970fcd(0x1c2)],'delivery_date':_0x4d7757[_0x970fcd(0x1c8)],'delivery_code':_0x4d7757[_0x970fcd(0x1fd)]}));}),await _0x18a7f6[_0x313484(0x239)](),_0x63a595[_0x313484(0x141)]=_0x313484(0x152);const _0x157943=await _0x63a595['save']();_0x5c3355[_0x313484(0x1a4)](_0x313484(0x1ee),'Sales\x20Update\x20successfully'),_0x55568d['redirect'](_0x313484(0x21c));}catch(_0x3bca63){console['log'](_0x3bca63);}}),router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x215),auth,async(_0x4e3de3,_0x4a3c80)=>{var _0x407bf6=a0_0x3a5ae7;try{const {username:_0x497a4a,email:_0x4057c8,role:_0x37baae}=_0x4e3de3[_0x407bf6(0x1fe)],_0xcc741f=_0x4e3de3[_0x407bf6(0x1fe)],_0x260f8b=await profile[_0x407bf6(0x20a)]({'email':_0xcc741f[_0x407bf6(0x20b)]}),_0x445cd1=await master_shop[_0x407bf6(0x14d)](),_0x196982=_0x4e3de3[_0x407bf6(0x1f7)]['id'],_0x12acd7=await purchases[_0x407bf6(0x23b)](_0x196982),_0x4c17d0=await suppliers[_0x407bf6(0x14d)]({});let _0x21d9ea;if(_0xcc741f[_0x407bf6(0x23c)]==_0x407bf6(0x205)){const _0x361fb7=await staff[_0x407bf6(0x20a)]({'email':_0xcc741f[_0x407bf6(0x20b)]});_0x21d9ea=await warehouse[_0x407bf6(0x14d)]({'status':'Enabled','name':_0x361fb7['warehouse'],'warehouse_category':_0x407bf6(0x148)});}else _0x21d9ea=await warehouse['aggregate']([{'$match':{'status':_0x407bf6(0x23e),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x407bf6(0x1cc),'name':{'$first':_0x407bf6(0x1cc)}}}]);const _0x290bfd=await product['find']({}),_0x291c5a=BayBinSelected(_0x12acd7[_0x407bf6(0x232)],_0x12acd7['room']);let _0x397f40=new Date(_0x12acd7['expiry_date']),_0xbc8986=('0'+_0x397f40[_0x407bf6(0x1fa)]())[_0x407bf6(0x218)](-0x2),_0x2911a6=('0'+(_0x397f40['getMonth']()+0x1))[_0x407bf6(0x218)](-0x2),_0x3a5608=_0x397f40['getFullYear'](),_0x5a9a3e=_0x3a5608+'-'+_0x2911a6+'-'+_0xbc8986;if(_0x445cd1[0x0][_0x407bf6(0x135)]=='English\x20(US)'){var _0x53cd54=users[_0x407bf6(0x198)];console['log'](_0x53cd54);}else{if(_0x445cd1[0x0][_0x407bf6(0x135)]=='Hindi')var _0x53cd54=users['Hindi'];else{if(_0x445cd1[0x0][_0x407bf6(0x135)]==_0x407bf6(0x237))var _0x53cd54=users['German'];else{if(_0x445cd1[0x0][_0x407bf6(0x135)]=='Spanish')var _0x53cd54=users[_0x407bf6(0x19e)];else{if(_0x445cd1[0x0][_0x407bf6(0x135)]==_0x407bf6(0x213))var _0x53cd54=users['French'];else{if(_0x445cd1[0x0]['language']==_0x407bf6(0x22f))var _0x53cd54=users['Portuguese'];else{if(_0x445cd1[0x0]['language']==_0x407bf6(0x220))var _0x53cd54=users[_0x407bf6(0x220)];else{if(_0x445cd1[0x0][_0x407bf6(0x135)]=='Arabic\x20(ae)')var _0x53cd54=users['Arabic'];}}}}}}}_0x4a3c80[_0x407bf6(0x171)](_0x407bf6(0x241),{'success':_0x4e3de3[_0x407bf6(0x1a4)]('success'),'errors':_0x4e3de3[_0x407bf6(0x1a4)](_0x407bf6(0x230)),'role':_0xcc741f,'profile':_0x260f8b,'purchases':_0x12acd7,'suppliers':_0x4c17d0,'warehouse':_0x21d9ea,'product':_0x290bfd,'master_shop':_0x445cd1,'language':_0x53cd54,'ed_fullDate':_0x5a9a3e,'dataSelected':_0x291c5a});}catch(_0xdb6c3f){console[_0x407bf6(0x188)](_0xdb6c3f);}}),router[a0_0x3a5ae7(0x187)](a0_0x3a5ae7(0x215),auth,async(_0x3816d4,_0x534b58)=>{var _0xc1de84=a0_0x3a5ae7;try{const _0x18f790=_0x3816d4[_0xc1de84(0x1f7)]['id'],_0x4d6531=await purchases[_0xc1de84(0x20a)]({'_id':_0x3816d4['params']['id']}),_0x3f5b31=await warehouse[_0xc1de84(0x20a)]({'name':_0x4d6531[_0xc1de84(0x232)],'room':_0x4d6531[_0xc1de84(0x21b)]});_0x4d6531[_0xc1de84(0x184)]['forEach'](_0x2b2995=>{var _0x470e9e=_0xc1de84;const _0x4db4e7=_0x3f5b31['product_details'][_0x470e9e(0x246)](_0x413050=>{var _0x4f5759=_0x470e9e;_0x413050['product_name']==_0x2b2995[_0x4f5759(0x167)]&&_0x413050['floorlevel']==_0x2b2995['floorlevel']&&_0x413050[_0x4f5759(0x1b9)]==_0x2b2995[_0x4f5759(0x1b9)]&&_0x413050[_0x4f5759(0x1a8)]==_0x2b2995[_0x4f5759(0x1a8)]&&_0x413050['bay']==_0x2b2995[_0x4f5759(0x139)]&&_0x413050['rack']==_0x2b2995[_0x4f5759(0x209)]&&_0x413050[_0x4f5759(0x207)]==_0x2b2995[_0x4f5759(0x207)]&&(_0x413050[_0x4f5759(0x146)]=parseInt(_0x413050['product_stock'])-parseInt(_0x2b2995[_0x4f5759(0x1e6)]));});}),await _0x3f5b31['save']();const {invoice:_0x273739,suppliers:_0x34138e,date:_0x3b461f,warehouse_name:_0x3613fa,prod_name:_0x33896e,prod_code:_0x98b728,prod_qty:_0x13c0e6,prod_unit:_0x572354,prod_secondunit:_0x12b153,prod_level:_0x37e116,prod_isle:_0x4d1288,prod_pallet:_0x56e995,note:_0x508071,expiry_date:_0x5ef3b3,batch_code:_0x30368c,paid_amount:_0x429d4f,due_amount:_0x43f195,Room_name:_0x23e7cb,primary_code:_0x216fe7,secondary_code:_0x37d9b0,PO_number:_0x5ed532,JO_number:_0x112cf1}=_0x3816d4[_0xc1de84(0x194)];if(typeof _0x33896e==_0xc1de84(0x1ce))var _0x2f57e5=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1ff)]],_0x452b66=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x158)]],_0x44df68=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1c1)]],_0x11b77f=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x181)]],_0x3799d8=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1ea)]],_0x552c48=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1d4)]],_0x37b8d1=[_0x3816d4['body'][_0xc1de84(0x224)]],_0x554b98=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x186)]],_0x90d4ef=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1b2)]],_0x1d67e9=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x196)]],_0xbe3c32=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1d2)]],_0x5af26a=[_0x3816d4[_0xc1de84(0x194)]['batch_code']],_0x4c20a7=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1be)]],_0x160500=[_0x3816d4['body'][_0xc1de84(0x207)]],_0x5a949b=[_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x180)]],_0x50aaae=[_0x3816d4['body']['type']];else var _0x2f57e5=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1ff)]],_0x452b66=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x158)]],_0x44df68=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1c1)]],_0x11b77f=[..._0x3816d4['body'][_0xc1de84(0x181)]],_0x3799d8=[..._0x3816d4[_0xc1de84(0x194)]['prod_secondunit']],_0x552c48=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1d4)]],_0x37b8d1=[..._0x3816d4[_0xc1de84(0x194)]['prod_isle']],_0x554b98=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x186)]],_0x90d4ef=[..._0x3816d4['body'][_0xc1de84(0x1b2)]],_0x1d67e9=[..._0x3816d4[_0xc1de84(0x194)]['secondary_code']],_0xbe3c32=[..._0x3816d4[_0xc1de84(0x194)]['MaxStocks_data']],_0x5af26a=[..._0x3816d4['body'][_0xc1de84(0x174)]],_0x4c20a7=[..._0x3816d4[_0xc1de84(0x194)]['expiry_date']],_0x160500=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x207)]],_0x5a949b=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x180)]],_0x50aaae=[..._0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1b9)]];const _0x5da884=_0x2f57e5[_0xc1de84(0x246)](_0x36808e=>{return _0x36808e={'product_name':_0x36808e};});_0x452b66[_0xc1de84(0x1c0)]((_0x3647e4,_0x2e3d96)=>{var _0x1151b1=_0xc1de84;_0x5da884[_0x2e3d96][_0x1151b1(0x1f9)]=_0x3647e4;}),_0x44df68[_0xc1de84(0x1c0)]((_0xf93cec,_0x33c5f6)=>{var _0x510da3=_0xc1de84;_0x5da884[_0x33c5f6][_0x510da3(0x1e6)]=_0xf93cec;}),_0x11b77f[_0xc1de84(0x1c0)]((_0x129d1e,_0x3c355f)=>{var _0xd30e82=_0xc1de84;_0x5da884[_0x3c355f][_0xd30e82(0x131)]=_0x129d1e;}),_0x3799d8[_0xc1de84(0x1c0)]((_0x2cea75,_0x217080)=>{var _0x28e756=_0xc1de84;_0x5da884[_0x217080][_0x28e756(0x231)]=_0x2cea75;}),_0x552c48[_0xc1de84(0x1c0)]((_0x209e2c,_0x38cc8c)=>{_0x5da884[_0x38cc8c]['bay']=_0x209e2c;}),_0x37b8d1[_0xc1de84(0x1c0)]((_0xb9f45,_0x5f0ec8)=>{var _0x118148=_0xc1de84;_0x5da884[_0x5f0ec8][_0x118148(0x1a8)]=_0xb9f45;}),_0x554b98[_0xc1de84(0x1c0)]((_0x24a9e7,_0x1975a9)=>{var _0x1f075d=_0xc1de84;_0x5da884[_0x1975a9][_0x1f075d(0x1aa)]=_0x24a9e7;}),_0x90d4ef[_0xc1de84(0x1c0)]((_0x55e2c0,_0x53c2e6)=>{var _0x1c27f8=_0xc1de84;_0x5da884[_0x53c2e6][_0x1c27f8(0x1b2)]=_0x55e2c0;}),_0x1d67e9[_0xc1de84(0x1c0)]((_0x4ebc73,_0x7d3c9a)=>{var _0x322733=_0xc1de84;_0x5da884[_0x7d3c9a][_0x322733(0x196)]=_0x4ebc73;}),_0xbe3c32['forEach']((_0x529685,_0x220fb4)=>{var _0x25fa99=_0xc1de84;_0x5da884[_0x220fb4][_0x25fa99(0x1a0)]=_0x529685;}),_0x5af26a[_0xc1de84(0x1c0)]((_0x2f8cbb,_0x1c332f)=>{_0x5da884[_0x1c332f]['batch_code']=_0x2f8cbb;}),_0x4c20a7[_0xc1de84(0x1c0)]((_0x4aa9a6,_0x2fdb01)=>{var _0x46ab46=_0xc1de84;_0x5da884[_0x2fdb01][_0x46ab46(0x1be)]=_0x4aa9a6;}),_0x50aaae['forEach']((_0xc3f647,_0x49dcde)=>{var _0x2fdcdb=_0xc1de84;_0x5da884[_0x49dcde][_0x2fdcdb(0x1b9)]=_0xc3f647;}),_0x160500['forEach']((_0x3ff97a,_0x165f7a)=>{var _0x22f68e=_0xc1de84;_0x5da884[_0x165f7a][_0x22f68e(0x207)]=_0x3ff97a;}),_0x5a949b[_0xc1de84(0x1c0)]((_0x5a43af,_0x306266)=>{var _0x2c53f3=_0xc1de84;_0x5da884[_0x306266][_0x2c53f3(0x209)]=_0x5a43af;});const _0xcd570d=_0x5da884[_0xc1de84(0x242)](_0x3f945a=>_0x3f945a['quantity']!=='0'&&_0x3f945a['quantity']!=='');_0x4d6531[_0xc1de84(0x12f)]=_0x273739,_0x4d6531['suppliers']=_0x34138e,_0x4d6531[_0xc1de84(0x159)]=_0x3b461f,_0x4d6531[_0xc1de84(0x232)]=_0x3613fa,_0x4d6531[_0xc1de84(0x184)]=_0xcd570d,_0x4d6531[_0xc1de84(0x240)]=_0x508071,_0x4d6531[_0xc1de84(0x1dd)]=_0x429d4f,_0x4d6531[_0xc1de84(0x182)]=_0x43f195,_0x4d6531[_0xc1de84(0x21b)]=_0x23e7cb,_0x4d6531[_0xc1de84(0x1fc)]=_0x5ed532,_0x4d6531[_0xc1de84(0x138)]=_0x112cf1;const _0x18c506=await _0x4d6531[_0xc1de84(0x239)](),_0x14d708=await warehouse[_0xc1de84(0x20a)]({'name':_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x232)],'room':_0x3816d4[_0xc1de84(0x194)]['Room_name']});_0x4d6531[_0xc1de84(0x184)][_0xc1de84(0x1c0)](_0x355a63=>{var _0x633e79=_0xc1de84,_0xe79ff1=0x0;const _0x55a284=_0x14d708[_0x633e79(0x19b)][_0x633e79(0x246)](_0x2613b6=>{var _0x515705=_0x633e79;_0x2613b6['product_name']==_0x355a63[_0x515705(0x167)]&&_0x2613b6[_0x515705(0x1aa)]==_0x355a63[_0x515705(0x1aa)]&&_0x2613b6['type']==_0x355a63[_0x515705(0x1b9)]&&_0x2613b6[_0x515705(0x1a8)]==_0x355a63[_0x515705(0x1a8)]&&_0x2613b6[_0x515705(0x139)]==_0x355a63['bay']&&_0x2613b6[_0x515705(0x209)]==_0x355a63[_0x515705(0x209)]&&_0x2613b6[_0x515705(0x207)]==_0x355a63['storage']&&(_0x2613b6[_0x515705(0x146)]=parseInt(_0x2613b6[_0x515705(0x146)])+parseInt(_0x355a63['quantity']),_0xe79ff1++);});_0xe79ff1=='0'&&(_0x14d708['product_details']=_0x14d708[_0x633e79(0x19b)][_0x633e79(0x1a6)]({'product_name':_0x355a63[_0x633e79(0x167)],'product_stock':_0x355a63['quantity'],'primary_code':_0x355a63[_0x633e79(0x1b2)],'secondary_code':_0x355a63['secondary_code'],'product_code':_0x355a63[_0x633e79(0x1f9)],'storage':_0x355a63[_0x633e79(0x207)],'rack':_0x355a63[_0x633e79(0x209)],'bay':_0x355a63[_0x633e79(0x139)],'bin':_0x355a63[_0x633e79(0x1a8)],'type':_0x355a63[_0x633e79(0x1b9)],'floorlevel':_0x355a63['floorlevel'],'maxProducts':_0x355a63['maxStocks'],'unit':_0x355a63[_0x633e79(0x131)],'secondary_unit':_0x355a63[_0x633e79(0x231)],'expiry_date':_0x355a63[_0x633e79(0x1be)]}));}),await _0x14d708[_0xc1de84(0x239)]();const _0x4ba41a=await s_payment_data[_0xc1de84(0x20a)]({'invoice':_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x12f)]});if(_0x4ba41a===null){}else console[_0xc1de84(0x188)]('suppliers',_0x4ba41a,_0x3816d4[_0xc1de84(0x194)]['invoice']),_0x4ba41a['suppliers']=_0x3816d4[_0xc1de84(0x194)][_0xc1de84(0x1d7)],await _0x4ba41a[_0xc1de84(0x239)]();_0x3816d4['flash'](_0xc1de84(0x1ee),_0xc1de84(0x23d)),_0x534b58[_0xc1de84(0x1b4)](_0xc1de84(0x21c));}catch(_0x361c28){console[_0xc1de84(0x188)](_0x361c28);}}),router['post'](a0_0x3a5ae7(0x129),auth,async(_0x2a1bac,_0x5987d2)=>{var _0x223da4=a0_0x3a5ae7;try{const _0x5e28bc=_0x2a1bac[_0x223da4(0x1f7)]['id'],{invoice:_0x2431e2,suppliers:_0x5131b0,payable:_0xc2c832,due_amount:_0x5eb678}=_0x2a1bac[_0x223da4(0x194)],_0x503fb0=await purchases['findById'](_0x5e28bc);var _0x44b222=_0xc2c832-_0x5eb678;_0x503fb0[_0x223da4(0x1dd)]=parseFloat(_0x503fb0[_0x223da4(0x1dd)])+parseFloat(_0x5eb678),_0x503fb0[_0x223da4(0x182)]=_0x44b222;const _0xacf619=await _0x503fb0['save']();console[_0x223da4(0x188)](_0xacf619);const _0x2a9c3a=await s_payment_data[_0x223da4(0x20a)]({'invoice':_0x2431e2});_0x2a9c3a[_0x223da4(0x144)]=_0x44b222,await _0x2a9c3a[_0x223da4(0x239)]();let _0x46fcf9=new Date(),_0x3da301=('0'+_0x46fcf9[_0x223da4(0x1fa)]())['slice'](-0x2),_0x2058e6=('0'+(_0x46fcf9[_0x223da4(0x1bc)]()+0x1))['slice'](-0x2),_0xa81f9f=_0x46fcf9[_0x223da4(0x1cf)](),_0x40a7bc=_0xa81f9f+'-'+_0x2058e6+'-'+_0x3da301;const _0xe2faff=new suppliers_payment({'invoice':_0x2431e2,'date':_0xa81f9f+'-'+_0x2058e6+'-'+_0x3da301,'suppliers':_0x5131b0,'reason':'Paid\x20For\x20Purchase','amount':_0x5eb678}),_0x38fe20=await _0xe2faff[_0x223da4(0x239)]();_0x2a1bac[_0x223da4(0x1a4)]('success',_0x223da4(0x1f3)),_0x5987d2['redirect']('/all_purchases/view');}catch(_0x3eeb76){console['log'](_0x3eeb76);}}),router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x12a),auth,async(_0xfa3853,_0x167c33)=>{var _0x55a52c=a0_0x3a5ae7;try{const {username:_0x2de74b,email:_0x229762,role:_0x1c33ba}=_0xfa3853[_0x55a52c(0x1fe)],_0x3ebe1d=_0xfa3853[_0x55a52c(0x1fe)],_0x3bc662=await profile[_0x55a52c(0x20a)]({'email':_0x3ebe1d[_0x55a52c(0x20b)]}),_0x562647=await master_shop[_0x55a52c(0x14d)]();console['log'](_0x55a52c(0x1a2),_0x562647);const _0x456cb1=_0xfa3853['params']['id'],_0x1a4d18=await purchases[_0x55a52c(0x23b)](_0x456cb1);console[_0x55a52c(0x188)](_0x1a4d18);const _0xa77ed2=await suppliers[_0x55a52c(0x20a)]({'name':_0x1a4d18[_0x55a52c(0x1d7)]});console[_0x55a52c(0x188)](_0xa77ed2);if(_0x562647[0x0][_0x55a52c(0x135)]==_0x55a52c(0x136)){var _0x540dcc=users[_0x55a52c(0x198)];console[_0x55a52c(0x188)](_0x540dcc);}else{if(_0x562647[0x0][_0x55a52c(0x135)]=='Hindi')var _0x540dcc=users[_0x55a52c(0x1a1)];else{if(_0x562647[0x0]['language']==_0x55a52c(0x237))var _0x540dcc=users[_0x55a52c(0x237)];else{if(_0x562647[0x0][_0x55a52c(0x135)]=='Spanish')var _0x540dcc=users['Spanish'];else{if(_0x562647[0x0][_0x55a52c(0x135)]==_0x55a52c(0x213))var _0x540dcc=users[_0x55a52c(0x213)];else{if(_0x562647[0x0][_0x55a52c(0x135)]=='Portuguese\x20(BR)')var _0x540dcc=users[_0x55a52c(0x1da)];else{if(_0x562647[0x0][_0x55a52c(0x135)]==_0x55a52c(0x220))var _0x540dcc=users[_0x55a52c(0x220)];else{if(_0x562647[0x0][_0x55a52c(0x135)]==_0x55a52c(0x13d))var _0x540dcc=users['Arabic'];}}}}}}}_0x167c33[_0x55a52c(0x171)](_0x55a52c(0x20d),{'success':_0xfa3853[_0x55a52c(0x1a4)](_0x55a52c(0x1ee)),'errors':_0xfa3853['flash'](_0x55a52c(0x230)),'role':_0x3ebe1d,'profile':_0x3bc662,'master_shop':_0x562647,'supplier':_0xa77ed2,'purchase':_0x1a4d18,'language':_0x540dcc});}catch(_0x4e0499){console['log'](_0x4e0499);}}),router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x14b),auth,async(_0x4775ba,_0x2c8801)=>{var _0x1aeef0=a0_0x3a5ae7;try{const {username:_0x4cb703,email:_0x59fa45,role:_0x4b94c9}=_0x4775ba[_0x1aeef0(0x1fe)],_0x383bbf=_0x4775ba[_0x1aeef0(0x1fe)],_0x294c03=await profile[_0x1aeef0(0x20a)]({'email':_0x383bbf[_0x1aeef0(0x20b)]}),_0xc0087a=await master_shop[_0x1aeef0(0x14d)]();console['log'](_0x1aeef0(0x1a2),_0xc0087a);const _0x28ef34=_0x4775ba[_0x1aeef0(0x1f7)]['id'];console[_0x1aeef0(0x188)](_0x28ef34);const _0x14b021=await purchases[_0x1aeef0(0x23b)](_0x28ef34);console[_0x1aeef0(0x188)](_0x1aeef0(0x1ad),_0x14b021);const _0x584fb0=await product[_0x1aeef0(0x14d)]({}),_0x1c69e8=await warehouse['aggregate']([{'$match':{'name':_0x14b021[_0x1aeef0(0x232)],'room':_0x14b021[_0x1aeef0(0x21b)],'warehouse_category':_0x1aeef0(0x148)}},{'$unwind':_0x1aeef0(0x150)},{'$group':{'_id':_0x1aeef0(0x1e0),'name':{'$first':_0x1aeef0(0x163)},'product_stock':{'$first':_0x1aeef0(0x202)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1aeef0(0x16d)},'floorlevel':{'$first':_0x1aeef0(0x18c)},'primary_code':{'$first':_0x1aeef0(0x130)},'secondary_code':{'$first':_0x1aeef0(0x1bd)},'product_code':{'$first':_0x1aeef0(0x1c5)},'storage':{'$first':_0x1aeef0(0x1ca)},'rack':{'$first':_0x1aeef0(0x175)}}}]);warehouse_data=await warehouse[_0x1aeef0(0x233)]([{'$match':{'status':_0x1aeef0(0x23e),'name':_0x1aeef0(0x1b0),'warehouse_category':_0x1aeef0(0x148)}},{'$group':{'_id':_0x1aeef0(0x1cc),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x1aeef0(0x188)]('stock_data',_0x1c69e8);if(_0xc0087a[0x0][_0x1aeef0(0x135)]=='English\x20(US)'){var _0x4311b9=users[_0x1aeef0(0x198)];console[_0x1aeef0(0x188)](_0x4311b9);}else{if(_0xc0087a[0x0]['language']==_0x1aeef0(0x1a1))var _0x4311b9=users[_0x1aeef0(0x1a1)];else{if(_0xc0087a[0x0]['language']=='German')var _0x4311b9=users[_0x1aeef0(0x237)];else{if(_0xc0087a[0x0]['language']==_0x1aeef0(0x19e))var _0x4311b9=users[_0x1aeef0(0x19e)];else{if(_0xc0087a[0x0][_0x1aeef0(0x135)]==_0x1aeef0(0x213))var _0x4311b9=users[_0x1aeef0(0x213)];else{if(_0xc0087a[0x0][_0x1aeef0(0x135)]=='Portuguese\x20(BR)')var _0x4311b9=users[_0x1aeef0(0x1da)];else{if(_0xc0087a[0x0][_0x1aeef0(0x135)]==_0x1aeef0(0x220))var _0x4311b9=users['Chinese'];else{if(_0xc0087a[0x0][_0x1aeef0(0x135)]==_0x1aeef0(0x13d))var _0x4311b9=users['Arabic'];}}}}}}}_0x2c8801[_0x1aeef0(0x171)](_0x1aeef0(0x1f0),{'success':_0x4775ba[_0x1aeef0(0x1a4)](_0x1aeef0(0x1ee)),'errors':_0x4775ba['flash'](_0x1aeef0(0x230)),'role':_0x383bbf,'profile':_0x294c03,'user':_0x14b021,'stock':_0x1c69e8,'master_shop':_0xc0087a,'product':_0x584fb0,'language':_0x4311b9,'warehouse':warehouse_data});}catch(_0x26529b){console[_0x1aeef0(0x188)](_0x26529b);}}),router[a0_0x3a5ae7(0x187)](a0_0x3a5ae7(0x14b),auth,async(_0x36c513,_0x4de2f9)=>{var _0x2c7763=a0_0x3a5ae7;try{const {invoice:_0x399d32,date:_0x4f11b8,warehouse_name:_0x24f6cd,Room_name:_0x5467a5,product_name:_0x2ad514,purchase_quantity:_0x5334f5,stocks:_0x339fcb,return_qty:_0x4067b1,note:_0x59ecc0,level:_0x29b377,isle:_0x1e26b1,pallet:_0x286f47,to_warehouse_name:_0x1b8f98,to_Room_name:_0x596c7b}=_0x36c513['body'],_0x44183d=await purchases[_0x2c7763(0x20a)]({'_id':_0x36c513['params']['id']}),_0x4cd9f1=await warehouse[_0x2c7763(0x20a)]({'name':_0x24f6cd,'room':_0x5467a5});if(typeof _0x2ad514=='string')var _0x25f4b0=[_0x36c513['body'][_0x2c7763(0x167)]],_0xb83c4f=[_0x36c513['body'][_0x2c7763(0x1e4)]],_0x527cdc=[_0x36c513[_0x2c7763(0x194)]['stocks']],_0x286503=[_0x36c513['body'][_0x2c7763(0x208)]],_0xc80b38=[_0x36c513['body'][_0x2c7763(0x128)]],_0x37e5c7=[_0x36c513[_0x2c7763(0x194)][_0x2c7763(0x1c9)]],_0x271a88=[_0x36c513[_0x2c7763(0x194)][_0x2c7763(0x1d1)]],_0x5d8032=[_0x36c513['body'][_0x2c7763(0x223)]],_0x3d6b03=[_0x36c513[_0x2c7763(0x194)][_0x2c7763(0x190)]],_0x4d625e=[_0x36c513[_0x2c7763(0x194)][_0x2c7763(0x1a9)]],_0x533ad3=[_0x36c513[_0x2c7763(0x194)][_0x2c7763(0x165)]];else var _0x25f4b0=[..._0x36c513[_0x2c7763(0x194)][_0x2c7763(0x167)]],_0xb83c4f=[..._0x36c513['body'][_0x2c7763(0x1e4)]],_0x527cdc=[..._0x36c513['body'][_0x2c7763(0x1c3)]],_0x286503=[..._0x36c513['body']['return_qty']],_0xc80b38=[..._0x36c513[_0x2c7763(0x194)][_0x2c7763(0x128)]],_0x37e5c7=[..._0x36c513['body'][_0x2c7763(0x1c9)]],_0x271a88=[..._0x36c513[_0x2c7763(0x194)]['pallet']],_0x5d8032=[..._0x36c513[_0x2c7763(0x194)][_0x2c7763(0x223)]],_0x3d6b03=[..._0x36c513['body'][_0x2c7763(0x190)]],_0x4d625e=[..._0x36c513[_0x2c7763(0x194)][_0x2c7763(0x1a9)]],_0x533ad3=[..._0x36c513[_0x2c7763(0x194)][_0x2c7763(0x165)]];const _0x439bac=_0x25f4b0[_0x2c7763(0x246)](_0x540361=>{return _0x540361={'product_name':_0x540361};});_0xb83c4f['forEach']((_0x27b12c,_0x5949a5)=>{var _0x44d242=_0x2c7763;_0x439bac[_0x5949a5][_0x44d242(0x1e4)]=_0x27b12c;}),_0x527cdc[_0x2c7763(0x1c0)]((_0x6a2fe,_0x3689e0)=>{var _0x20bce4=_0x2c7763;_0x439bac[_0x3689e0][_0x20bce4(0x193)]=_0x6a2fe;}),_0x286503['forEach']((_0x247fda,_0x29ad96)=>{var _0xa42f05=_0x2c7763;_0x439bac[_0x29ad96][_0xa42f05(0x208)]=_0x247fda;}),_0xc80b38[_0x2c7763(0x1c0)]((_0x16ffa3,_0x550f67)=>{_0x439bac[_0x550f67]['bay']=_0x16ffa3;}),_0x37e5c7[_0x2c7763(0x1c0)]((_0x9a1faa,_0x3694fe)=>{var _0x38777e=_0x2c7763;_0x439bac[_0x3694fe][_0x38777e(0x1a8)]=_0x9a1faa;}),_0x271a88[_0x2c7763(0x1c0)]((_0x2369c3,_0x293757)=>{var _0x4d5032=_0x2c7763;_0x439bac[_0x293757][_0x4d5032(0x1aa)]=_0x2369c3;}),_0x5d8032[_0x2c7763(0x1c0)]((_0x48ce6d,_0xe34853)=>{var _0x4441d6=_0x2c7763;_0x439bac[_0xe34853][_0x4441d6(0x1b9)]=_0x48ce6d;}),_0x3d6b03[_0x2c7763(0x1c0)]((_0x27dbdf,_0x40809d)=>{var _0xfc72cb=_0x2c7763;_0x439bac[_0x40809d][_0xfc72cb(0x1f9)]=_0x27dbdf;}),_0x4d625e['forEach']((_0x611348,_0x3e57b9)=>{_0x439bac[_0x3e57b9]['primary_code']=_0x611348;}),_0x533ad3[_0x2c7763(0x1c0)]((_0x2aad0d,_0x1f14b6)=>{var _0x2e2812=_0x2c7763;_0x439bac[_0x1f14b6][_0x2e2812(0x196)]=_0x2aad0d;}),_0x44183d[_0x2c7763(0x184)]['forEach'](_0x4b8ce4=>{var _0x4f6c7d=_0x2c7763;const _0x4f83be=_0x4cd9f1[_0x4f6c7d(0x19b)][_0x4f6c7d(0x246)](_0x496488=>{var _0x4b90af=_0x4f6c7d;_0x496488[_0x4b90af(0x167)]==_0x4b8ce4[_0x4b90af(0x167)]&&_0x496488[_0x4b90af(0x1aa)]==_0x4b8ce4['floorlevel']&&_0x496488[_0x4b90af(0x1b9)]==_0x4b8ce4[_0x4b90af(0x1b9)]&&_0x496488[_0x4b90af(0x1a8)]==_0x4b8ce4[_0x4b90af(0x1a8)]&&_0x496488[_0x4b90af(0x139)]==_0x4b8ce4['bay']&&_0x496488[_0x4b90af(0x209)]==_0x4b8ce4[_0x4b90af(0x209)]&&_0x496488[_0x4b90af(0x207)]==_0x4b8ce4[_0x4b90af(0x207)]&&(console[_0x4b90af(0x188)](parseInt(_0x496488['product_stock'])+_0x4b90af(0x168)+parseInt(_0x4b8ce4[_0x4b90af(0x1e6)])),_0x496488[_0x4b90af(0x146)]=parseInt(_0x496488[_0x4b90af(0x146)])+parseInt(_0x4b8ce4[_0x4b90af(0x1e6)]));});}),await _0x4cd9f1[_0x2c7763(0x239)]();const _0x8c3818=_0x439bac[_0x2c7763(0x242)](_0x462ee5=>_0x462ee5[_0x2c7763(0x208)]!=='0'&&_0x462ee5[_0x2c7763(0x208)]!=='');var _0xc98d2d=0x0;_0x8c3818['forEach'](_0x4e571e=>{var _0x1f24f4=_0x2c7763;console['log'](_0x1f24f4(0x142),_0x4e571e),(parseInt(_0x4e571e[_0x1f24f4(0x1e4)])<parseInt(_0x4e571e[_0x1f24f4(0x208)])||parseInt(_0x4e571e[_0x1f24f4(0x193)])<parseInt(_0x4e571e[_0x1f24f4(0x208)]))&&_0xc98d2d++;});if(_0xc98d2d!=0x0)return _0x36c513[_0x2c7763(0x1a4)](_0x2c7763(0x230),_0x2c7763(0x22a)),_0x4de2f9[_0x2c7763(0x1b4)](_0x2c7763(0x1ae));const _0x44dd03=new purchases_return({'invoice':_0x399d32,'suppliers':_0x36c513[_0x2c7763(0x194)][_0x2c7763(0x1d7)],'date':_0x4f11b8,'warehouse_name':_0x24f6cd,'return_product':_0x8c3818,'note':_0x59ecc0,'room':_0x5467a5,'to_warehouse_name':_0x1b8f98,'to_room':_0x596c7b}),_0x3bdd62=await _0x44dd03[_0x2c7763(0x239)]();console[_0x2c7763(0x188)](_0x44dd03);const _0x5db881=await purchases_return[_0x2c7763(0x20a)]({'invoice':_0x399d32}),_0x2155d6=await warehouse[_0x2c7763(0x20a)]({'name':_0x1b8f98,'room':_0x596c7b});_0x5db881[_0x2c7763(0x195)][_0x2c7763(0x1c0)](_0x3f5d80=>{var _0x4ec0a6=_0x2c7763,_0x48adc2=0x0;const _0x5a01da=_0x2155d6[_0x4ec0a6(0x19b)][_0x4ec0a6(0x246)](_0x9a0d6b=>{var _0x2d475c=_0x4ec0a6;_0x9a0d6b['product_name']==_0x3f5d80[_0x2d475c(0x167)]&&_0x9a0d6b[_0x2d475c(0x1aa)]==_0x3f5d80[_0x2d475c(0x1aa)]&&_0x9a0d6b[_0x2d475c(0x1b9)]==_0x3f5d80['type']&&_0x9a0d6b[_0x2d475c(0x1a8)]==_0x3f5d80[_0x2d475c(0x1a8)]&&_0x9a0d6b[_0x2d475c(0x139)]==_0x3f5d80[_0x2d475c(0x139)]&&(_0x9a0d6b[_0x2d475c(0x146)]=parseInt(_0x9a0d6b[_0x2d475c(0x146)])-parseInt(_0x3f5d80[_0x2d475c(0x208)]),_0x48adc2++);});_0x48adc2=='0'&&(_0x2155d6['product_details']=_0x2155d6['product_details'][_0x4ec0a6(0x1a6)]({'product_name':_0x3f5d80[_0x4ec0a6(0x167)],'product_stock':_0x3f5d80[_0x4ec0a6(0x208)],'primary_code':_0x3f5d80[_0x4ec0a6(0x1b2)],'secondary_code':_0x3f5d80[_0x4ec0a6(0x196)],'product_code':_0x3f5d80[_0x4ec0a6(0x1f9)],'storage':_0x3f5d80[_0x4ec0a6(0x207)],'rack':_0x3f5d80[_0x4ec0a6(0x209)],'bay':_0x3f5d80['bay'],'bin':_0x3f5d80[_0x4ec0a6(0x1a8)],'type':_0x3f5d80[_0x4ec0a6(0x1b9)],'floorlevel':_0x3f5d80['floorlevel'],'maxProducts':_0x3f5d80[_0x4ec0a6(0x1a0)],'unit':_0x3f5d80[_0x4ec0a6(0x131)],'secondary_unit':_0x3f5d80[_0x4ec0a6(0x231)],'expiry_date':_0x3f5d80[_0x4ec0a6(0x1be)]}));}),await _0x2155d6[_0x2c7763(0x239)]();const _0x390a46=await purchases['findOne']({'invoice':_0x399d32});_0x390a46['return_data']=_0x2c7763(0x152);const _0x224f96=await _0x390a46['save'](),_0x5e7da5=new s_payment_data({'invoice':_0x399d32,'suppliers':_0x36c513['body']['suppliers'],'reason':_0x2c7763(0x203)});await _0x5e7da5[_0x2c7763(0x239)]();const _0x213515=await master_shop['find']();console[_0x2c7763(0x188)]('add\x20post',_0x213515[0x0][_0x2c7763(0x1d0)]);const _0x212c14=await email_settings[_0x2c7763(0x20a)](),_0x26db50=await suppliers['findOne']({'name':_0x36c513['body'][_0x2c7763(0x1d7)]});console[_0x2c7763(0x188)]('suppliers_data',_0x26db50);_0x213515[0x0][_0x2c7763(0x1ba)]==0x1?(right_currency=_0x213515[0x0][_0x2c7763(0x243)],left_currency=''):(right_currency='',left_currency=_0x213515[0x0][_0x2c7763(0x243)]);var _0x369557=_0x25f4b0,_0x2f7434=_0x286503,_0x586c0a='',_0x29554c;for(_0x29554c in _0x369557){_0x586c0a+=_0x2c7763(0x16f)+_0x2c7763(0x155)+_0x369557[_0x29554c]+_0x2c7763(0x12e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f7434[_0x29554c]+_0x2c7763(0x12e)+_0x2c7763(0x1ac);}console[_0x2c7763(0x188)](_0x2c7763(0x1af),_0x586c0a);let _0x56434c=nodemailer[_0x2c7763(0x22c)]({'service':_0x2c7763(0x17c),'auth':{'user':_0x212c14[_0x2c7763(0x20b)],'pass':_0x212c14[_0x2c7763(0x19d)]}}),_0x81df44={'from':_0x212c14[_0x2c7763(0x20b)],'to':_0x26db50[_0x2c7763(0x20b)],'subject':_0x2c7763(0x21e),'attachments':[{'filename':_0x2c7763(0x21d),'path':__dirname+_0x2c7763(0x15d)+_0x2c7763(0x127)+_0x213515[0x0][_0x2c7763(0x1d0)],'cid':_0x2c7763(0x15f)}],'html':_0x2c7763(0x13b)+'<html><head><title></title>'+_0x2c7763(0x15e)+_0x2c7763(0x170)+_0x2c7763(0x166)+'<div>'+_0x2c7763(0x227)+_0x2c7763(0x201)+'<div>'+_0x2c7763(0x229)+_0x213515[0x0][_0x2c7763(0x149)]+_0x2c7763(0x236)+_0x2c7763(0x201)+_0x2c7763(0x201)+_0x2c7763(0x157)+'<div>'+_0x2c7763(0x192)+'\x20Order\x20Number\x20:\x20'+_0x399d32+'\x20'+_0x2c7763(0x1ec)+_0x2c7763(0x21a)+_0x4f11b8+'\x20'+_0x2c7763(0x1f1)+_0x2c7763(0x1bf)+_0x2c7763(0x201)+_0x2c7763(0x179)+_0x2c7763(0x221)+_0x2c7763(0x16f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2c7763(0x1f4)+_0x2c7763(0x1e8)+_0x2c7763(0x1db)+_0x2c7763(0x1ac)+_0x2c7763(0x1c4)+_0x2c7763(0x1cd)+'\x20'+_0x586c0a+'\x20'+_0x2c7763(0x1c7)+_0x2c7763(0x245)+_0x2c7763(0x170)+_0x2c7763(0x23a)+_0x2c7763(0x161)+_0x213515[0x0][_0x2c7763(0x149)]+_0x2c7763(0x1bf)+_0x2c7763(0x201)+_0x2c7763(0x201)+_0x2c7763(0x1b8)};_0x56434c[_0x2c7763(0x1d5)](_0x81df44,function(_0xe6cb1e,_0x1f6942){var _0x53a603=_0x2c7763;_0xe6cb1e?(console[_0x53a603(0x188)](_0xe6cb1e),console[_0x53a603(0x188)](_0x53a603(0x212))):console[_0x53a603(0x188)](_0x53a603(0x17a));}),_0x36c513[_0x2c7763(0x1a4)](_0x2c7763(0x1ee),_0x2c7763(0x185)),_0x4de2f9[_0x2c7763(0x1b4)]('/all_purchases/view');}catch(_0x32901c){console[_0x2c7763(0x188)](_0x32901c),_0x4de2f9['status'](0xc8)[_0x2c7763(0x225)]({'message':_0x32901c['message']});}}),router[a0_0x3a5ae7(0x12c)](a0_0x3a5ae7(0x228),auth,async(_0x3a5e30,_0x53190b)=>{var _0x11737e=a0_0x3a5ae7;try{const {username:_0x2af801,email:_0x36863e,role:_0x4dd7ef}=_0x3a5e30['user'],_0x584a98=_0x3a5e30[_0x11737e(0x1fe)],_0x56933e=await profile[_0x11737e(0x20a)]({'email':_0x584a98[_0x11737e(0x20b)]}),_0x24e272=await master_shop[_0x11737e(0x14d)](),_0x5b08e2=_0x3a5e30[_0x11737e(0x1f7)]['id'],_0x160cde=await purchases[_0x11737e(0x23b)](_0x5b08e2);if(_0x24e272[0x0][_0x11737e(0x135)]==_0x11737e(0x136))var _0x153e80=users[_0x11737e(0x198)];else{if(_0x24e272[0x0][_0x11737e(0x135)]==_0x11737e(0x1a1))var _0x153e80=users['Hindi'];else{if(_0x24e272[0x0][_0x11737e(0x135)]==_0x11737e(0x237))var _0x153e80=users['German'];else{if(_0x24e272[0x0][_0x11737e(0x135)]==_0x11737e(0x19e))var _0x153e80=users[_0x11737e(0x19e)];else{if(_0x24e272[0x0][_0x11737e(0x135)]==_0x11737e(0x213))var _0x153e80=users[_0x11737e(0x213)];else{if(_0x24e272[0x0][_0x11737e(0x135)]=='Portuguese\x20(BR)')var _0x153e80=users[_0x11737e(0x1da)];else{if(_0x24e272[0x0][_0x11737e(0x135)]=='Chinese')var _0x153e80=users['Chinese'];else{if(_0x24e272[0x0][_0x11737e(0x135)]==_0x11737e(0x13d))var _0x153e80=users[_0x11737e(0x12b)];}}}}}}}_0x53190b[_0x11737e(0x171)](_0x11737e(0x17b),{'success':_0x3a5e30['flash'](_0x11737e(0x1ee)),'errors':_0x3a5e30[_0x11737e(0x1a4)](_0x11737e(0x230)),'role':_0x584a98,'profile':_0x56933e,'alldata':_0x160cde,'master_shop':_0x24e272,'language':_0x153e80}),console['log'](alldata);}catch(_0x4e6574){console['log'](_0x4e6574);}}),router[a0_0x3a5ae7(0x187)](a0_0x3a5ae7(0x153),async(_0x12f3e7,_0x2c2e53)=>{var _0x285b5f=a0_0x3a5ae7;const {product_code:_0x575d37}=_0x12f3e7[_0x285b5f(0x194)];var _0x5cd820;const _0x1d88fe=await product[_0x285b5f(0x233)]([{'$match':{'primary_code':_0x575d37,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x285b5f(0x216),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x285b5f(0x16e)},'unit':{'$first':_0x285b5f(0x1de)},'alertquantity':{'$first':_0x285b5f(0x1e9)},'product_code':{'$first':_0x285b5f(0x147)},'primary_code':{'$first':_0x285b5f(0x16a)},'secondary_code':{'$first':_0x285b5f(0x1fb)},'maxStocks':{'$first':_0x285b5f(0x238)},'maxProdPerUnit':{'$first':_0x285b5f(0x22d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x285b5f(0x13c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x16a634=await product[_0x285b5f(0x233)]([{'$match':{'secondary_code':_0x575d37,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x285b5f(0x1cc)},'category':{'$first':'$category'},'brand':{'$first':_0x285b5f(0x16e)},'unit':{'$first':_0x285b5f(0x1de)},'alertquantity':{'$first':_0x285b5f(0x1e9)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x285b5f(0x1fb)},'maxStocks':{'$first':_0x285b5f(0x238)},'maxProdPerUnit':{'$first':_0x285b5f(0x22d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x285b5f(0x13c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1d88fe[_0x285b5f(0x13e)]>0x0)_0x5cd820=_0x1d88fe;else _0x16a634['length']>0x0&&(_0x5cd820=_0x16a634);_0x2c2e53[_0x285b5f(0x225)](_0x5cd820);}),router['post']('/CheckingWarehouse',async(_0x1e4b3c,_0x2aeb22)=>{var _0x3fe7e4=a0_0x3a5ae7;const {primaryCode:_0x3e2550,secondaryCode:_0x15d04d,productCode:_0x4b78d1,bay:_0x5e4dc3,bin:_0x36b411,types:_0x54fb46,pallet:_0x287656,warehouses:_0x3450ef,room:_0x159fdb}=_0x1e4b3c['body'];console[_0x3fe7e4(0x188)](_0x1e4b3c['body']);try{const _0x1d9d61=await warehouse['aggregate']([{'$match':{'name':_0x3450ef,'room':_0x159fdb}},{'$unwind':_0x3fe7e4(0x150)},{'$match':{'product_details.bay':_0x5e4dc3,'product_details.bin':_0x36b411,'product_details.type':_0x54fb46}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3fe7e4(0x163)},'product_stock':{'$first':_0x3fe7e4(0x202)},'level':{'$first':_0x3fe7e4(0x1e3)},'isle':{'$first':_0x3fe7e4(0x1ef)},'pallet':{'$first':_0x3fe7e4(0x1f6)},'maxProducts':{'$first':_0x3fe7e4(0x214)}}}]);_0x2aeb22[_0x3fe7e4(0x18f)](0xc8)[_0x3fe7e4(0x225)](_0x1d9d61);}catch(_0x4aba1a){_0x2aeb22['status'](0x194)[_0x3fe7e4(0x225)]({'message':_0x4aba1a[_0x3fe7e4(0x234)]});}}),module[a0_0x3a5ae7(0x1a3)]=router;