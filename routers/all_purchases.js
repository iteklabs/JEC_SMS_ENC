var a0_0x318fa5=a0_0xb208;(function(_0x57b805,_0x3aaf74){var _0x3a7672=a0_0xb208,_0x58a45b=_0x57b805();while(!![]){try{var _0x488b37=parseInt(_0x3a7672(0x1eb))/0x1*(parseInt(_0x3a7672(0x2e0))/0x2)+-parseInt(_0x3a7672(0x2ab))/0x3+-parseInt(_0x3a7672(0x264))/0x4+-parseInt(_0x3a7672(0x254))/0x5*(-parseInt(_0x3a7672(0x27d))/0x6)+-parseInt(_0x3a7672(0x22a))/0x7*(-parseInt(_0x3a7672(0x1fc))/0x8)+parseInt(_0x3a7672(0x1fa))/0x9+-parseInt(_0x3a7672(0x2a7))/0xa*(-parseInt(_0x3a7672(0x221))/0xb);if(_0x488b37===_0x3aaf74)break;else _0x58a45b['push'](_0x58a45b['shift']());}catch(_0x2b78aa){_0x58a45b['push'](_0x58a45b['shift']());}}}(a0_0x2188,0xc11bd));const express=require(a0_0x318fa5(0x273)),app=express(),router=express[a0_0x318fa5(0x1f3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x318fa5(0x1ff));function a0_0xb208(_0x412cb4,_0x1c5b94){var _0x2188cb=a0_0x2188();return a0_0xb208=function(_0xb208cc,_0x580846){_0xb208cc=_0xb208cc-0x1db;var _0x3183f7=_0x2188cb[_0xb208cc];return _0x3183f7;},a0_0xb208(_0x412cb4,_0x1c5b94);}var ejs=require(a0_0x318fa5(0x2c4));function a0_0x2188(){var _0x3c4f9a=['Enclosed','password','An\x20error\x20occurred\x20while\x20saving\x20data.','</tbody>','user_id','get','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','length','Portuguese\x20(BR)','$product_details.bin','Floor','foreach\x20newproduct','Error\x20Occurs','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Rack\x20A','$product_details.rack','10VHfyby','$room','English\x20(US)','finalize','2327106NkDYaH','prod_level','DRY\x20STORAGE','catch','note','Arabic','email','getFullYear','Purchase\x20Mail','German','error','all_purchases','RMSEmail','Receiving\x20Area','$product_details.expiry_date','$product_details.secondary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','floorlevel','filter','production_date','isle','site_title','prod_secondunit','Portuguese','<h5>','ejs','maxStocks','findOne','add\x20post','body','quantity','max_product_unit','/view','message','stock_quantity','Purchase\x20Return','standard_unit','\x20<\x20wew\x20>\x20','prod_code','<div>','$product_details.primary_code','logo','$expiry_date','prod_cat','$alertquantity','return_purchase','$name','/preview/:id','role','$product_details.product_name','then','master','COLD\x20STORAGE','2HiGgsv','/upload/','here','prod_unit','$product_details._id','Ambient','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','level','product','product_cat','MaxStocks_data','$product.floorlevel','expiry_date','all_purchases_barcode','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.bin','$due_amount','$product_details.type','flash','/all_purchases/view/','forEach','<h5\x20style=\x22text-align:\x20left;\x22>','$product_code','push','exports','maxperunit','$product_details.storage','$product.type','prod_pallet','secondary_unit','$secondary_code','delivery_code','$category','</h5>','$batch_code','$paid_amount','$product_details.maxProducts','params','edit_purchases_view','prod_invoice','Raw\x20Materials','name','<html><head><title></title>','1073726vntpuz','string','$_id','product_name','paid_amount','INC-','/barcode/:id','Rack\x20E','Router','$unit','Sales\x20Update\x20successfully','rak','primary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$maxStocks','1031886nnMmxk','prod_isle','3631864mTZMTr','types','type','nodemailer','/view/:id','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','concat','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','purchases\x20item\x20return\x20successfull','RoomAssign','alertQTY','<span\x20style=\x22float:\x20right;\x22>','getDate','</div>','edit_purchases','$warehouse_name','abs','$product_details.product_stock','$suppliers','add_purchases\x20error','<table\x20style=\x22width:\x20100%\x20!important;\x22>','actual_uom','Hindi','currency','product_code','secondary_code_hide','/CheckingWarehouse','$invoice','secondary_code','$product.bay','purchase\x20data\x20update\x20successfully','success','Shelves','warehouse_name','stock_data','7311645wbQUlY','$finalize','prod_qty','purchase_invoice','actual_qty','$product.room_name','Return\x20Goods','slice','French','14uYUoav','batch_code','Spanish','currency_placement','sendMail','product_details','errors','$product.quantity','prod_name','suppliers_docs','language','random','Level','Rack\x20F','prod_primunit','aggregate','room','/view/add_purchases/:id','Chinese','$product_details.product_code','Room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','return_qty','Enabled','$product_details.pallet','status','<hr\x20class=\x22my-3\x22>','$maxProdPerUnit','redirect','$suppliers_docs','Rack\x20D','rack','json','room_name','render','/invoice/:id','/give_payment/:id','toString','bin','staff','38085TyXppx','$return_data','pallet','deliverycode','return_product','invoice','storage','$primary_code','</span>','$product_details.bay','log','warehouse','Rack\x20C','$product','\x20Order\x20Date\x20:\x20','path','5264952lEsHYs','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</table>','findById','\x20<>\x20','$product_details.level','delivery_date','Rack\x20B','<tr>','\x20Order\x20Number\x20:\x20','<h2>\x20','Purchase\x20data\x20added\x20successfully','</td>','user','express','POnumber','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','post','createTransport','primary_code','/all_purchases/view','product_stock','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','96uUWaUH','<!DOCTYPE\x20html>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Arabic\x20(ae)','suppliers','</head><body>','$secondary_unit','$product_details.floorlevel','<strong>\x20Regards\x20</strong>','bay','purchase_quantity','find','all','/view/return_purchase/:id','getMonth','$product_details','image','port','<tbody\x20style=\x22text-align:\x20center;\x22>','product_code_hide','map','/barcode_scanner','True','back','</tr>'];a0_0x2188=function(){return _0x3c4f9a;};return a0_0x2188();}const path=require(a0_0x318fa5(0x263)),users=require('../public/language/languages.json');router[a0_0x318fa5(0x29b)](a0_0x318fa5(0x2cb),auth,async(_0x26497b,_0x1c9b2a)=>{var _0x29abbe=a0_0x318fa5;try{const {username:_0x1fc70d,email:_0x29ae16,role:_0x42d7ba}=_0x26497b[_0x29abbe(0x272)],_0x266399=_0x26497b[_0x29abbe(0x272)],_0x26cee0=await profile[_0x29abbe(0x2c6)]({'email':_0x266399[_0x29abbe(0x2b1)]}),_0x42f2ea=await staff[_0x29abbe(0x2c6)]({'email':_0x266399[_0x29abbe(0x2b1)]});if(_0x266399[_0x29abbe(0x2db)]==_0x29abbe(0x253)){const _0x59c43c=await staff['findOne']({'email':_0x266399[_0x29abbe(0x2b1)]});}const _0xe78e69=await master_shop[_0x29abbe(0x288)]();let _0x52a0cb;if(_0x266399[_0x29abbe(0x2db)]==_0x29abbe(0x253)){const _0x372cab=await staff['findOne']({'email':_0x266399[_0x29abbe(0x2b1)]});_0x52a0cb=await purchases['aggregate']([{'$match':{'warehouse_name':_0x372cab[_0x29abbe(0x25f)]}},{'$lookup':{'from':_0x29abbe(0x281),'localField':_0x29abbe(0x281),'foreignField':_0x29abbe(0x1e9),'as':_0x29abbe(0x233)}},{'$unwind':_0x29abbe(0x249)},{'$unwind':_0x29abbe(0x261)},{'$group':{'_id':_0x29abbe(0x1ed),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x29abbe(0x210)},'date':{'$first':_0x29abbe(0x265)},'warehouse_name':{'$first':_0x29abbe(0x20d)},'room':{'$first':_0x29abbe(0x2a8)},'product':{'$push':_0x29abbe(0x261)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x29abbe(0x1e3)},'due_amount':{'$first':_0x29abbe(0x2f1)},'return_data':{'$first':_0x29abbe(0x255)},'batch_code':{'$first':_0x29abbe(0x1e2)},'expiry_date':{'$first':_0x29abbe(0x2d5)},'suppliers_docs':{'$first':_0x29abbe(0x249)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x29abbe(0x21b)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x29abbe(0x2eb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x52a0cb=await purchases['aggregate']([{'$lookup':{'from':_0x29abbe(0x281),'localField':_0x29abbe(0x281),'foreignField':_0x29abbe(0x1e9),'as':_0x29abbe(0x233)}},{'$unwind':_0x29abbe(0x249)},{'$unwind':_0x29abbe(0x261)},{'$group':{'_id':'$_id','invoice':{'$first':_0x29abbe(0x219)},'suppliers':{'$first':_0x29abbe(0x210)},'date':{'$first':_0x29abbe(0x265)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x29abbe(0x226)},'product':{'$push':_0x29abbe(0x261)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x29abbe(0x1e3)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x29abbe(0x255)},'batch_code':{'$first':_0x29abbe(0x1e2)},'expiry_date':{'$first':_0x29abbe(0x2d5)},'suppliers_docs':{'$first':_0x29abbe(0x249)},'total_product_quantity':{'$sum':_0x29abbe(0x231)},'level':{'$addToSet':_0x29abbe(0x21b)},'isle':{'$addToSet':_0x29abbe(0x2f0)},'type':{'$addToSet':_0x29abbe(0x1db)},'floorlevel':{'$addToSet':_0x29abbe(0x2eb)},'finalize':{'$first':_0x29abbe(0x222)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xe78e69[0x0][_0x29abbe(0x234)]==_0x29abbe(0x2a9)){var _0x252528=users[_0x29abbe(0x2a3)];console['log'](_0x252528);}else{if(_0xe78e69[0x0][_0x29abbe(0x234)]==_0x29abbe(0x214))var _0x252528=users[_0x29abbe(0x214)];else{if(_0xe78e69[0x0][_0x29abbe(0x234)]==_0x29abbe(0x2b4))var _0x252528=users[_0x29abbe(0x2b4)];else{if(_0xe78e69[0x0]['language']=='Spanish')var _0x252528=users[_0x29abbe(0x22c)];else{if(_0xe78e69[0x0][_0x29abbe(0x234)]==_0x29abbe(0x229))var _0x252528=users['French'];else{if(_0xe78e69[0x0][_0x29abbe(0x234)]==_0x29abbe(0x29e))var _0x252528=users['Portuguese'];else{if(_0xe78e69[0x0]['language']==_0x29abbe(0x23c))var _0x252528=users[_0x29abbe(0x23c)];else{if(_0xe78e69[0x0]['language']==_0x29abbe(0x280))var _0x252528=users[_0x29abbe(0x2b0)];}}}}}}}_0x1c9b2a[_0x29abbe(0x24e)](_0x29abbe(0x2b6),{'success':_0x26497b[_0x29abbe(0x2f3)](_0x29abbe(0x21d)),'errors':_0x26497b[_0x29abbe(0x2f3)](_0x29abbe(0x230)),'purchases':_0x52a0cb,'role':_0x266399,'profile':_0x26cee0,'master_shop':_0xe78e69,'language':_0x252528});}catch(_0x503f64){console[_0x29abbe(0x25e)]('table\x20page',_0x503f64),_0x1c9b2a['status'](0xc8)[_0x29abbe(0x24c)]({'message':_0x503f64[_0x29abbe(0x2cc)]});}});function BayBinSelected(_0x4e8a38,_0x47c2b3){var _0x1a309c=a0_0x318fa5,_0x69fa76=[],_0x59e68a=[],_0x1da05c=[],_0x2ef6fe=[],_0x44bcda=[],_0x10ea80=[];let _0xb17aa2=[];if(_0x4e8a38==_0x1a309c(0x2ad))switch(_0x47c2b3){case _0x1a309c(0x2a5):_0x69fa76=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x59e68a=[0x1,0x2],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=['Level',_0x1a309c(0x2a0)],_0x44bcda=['D'],_0x10ea80=['A'];break;case _0x1a309c(0x26c):_0x69fa76=[0x6,0x5,0x4,0x3,0x2,0x1],_0x59e68a=[0x1,0x2],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=[_0x1a309c(0x236),_0x1a309c(0x2a0)],_0x44bcda=['D'],_0x10ea80=['B'];break;case'Shelves':_0x69fa76=[0x0],_0x59e68a=[0x0],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=[_0x1a309c(0x2a0)],_0x44bcda=['D'],_0x10ea80=['S'];break;case _0x1a309c(0x2b8):_0x69fa76=[0x0],_0x59e68a=[0x0],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1da05c=['Floor'],_0x44bcda=['D'],_0x10ea80=['R'];break;}else{if(_0x4e8a38==_0x1a309c(0x2df))switch(_0x47c2b3){case _0x1a309c(0x2a5):_0x69fa76=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x59e68a=['B','F'],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=['Level','Floor'],_0x44bcda=['C'],_0x10ea80=['A'];break;case _0x1a309c(0x26c):_0x69fa76=[0x5,0x4,0x3,0x2,0x1],_0x59e68a=['F','B','S'],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=[_0x1a309c(0x236),_0x1a309c(0x2a0)],_0x44bcda=['C'],_0x10ea80=['B'];break;case _0x1a309c(0x260):_0x69fa76=[0x1,0x2,0x3,0x4,0x5],_0x59e68a=['B','F','S'],_0x2ef6fe=[0x5,0x4,0x3,0x2,0x1],_0x1da05c=[_0x1a309c(0x236),'Floor'],_0x44bcda=['C'],_0x10ea80=['C'];break;case _0x1a309c(0x24a):_0x69fa76=[0x5,0x4,0x3,0x2,0x1],_0x59e68a=['F','B','S'],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=[_0x1a309c(0x236),_0x1a309c(0x2a0)],_0x44bcda=['C'],_0x10ea80=['D'];break;case _0x1a309c(0x1f2):_0x69fa76=[0x4,0x3,0x2,0x1],_0x59e68a=[0x1,0x2],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=[_0x1a309c(0x236),_0x1a309c(0x2a0)],_0x44bcda=['C'],_0x10ea80=['E'];break;case _0x1a309c(0x237):_0x69fa76=[0x1,0x2,0x3],_0x59e68a=[0x1,0x2],_0x2ef6fe=[0x1,0x2,0x3,0x4,0x5],_0x1da05c=[_0x1a309c(0x236)],_0x44bcda=['C'],_0x10ea80=['F'];break;}}return{'levels':_0x69fa76,'Isle':_0x59e68a,'rack':_0x2ef6fe,'type':_0x1da05c,'storage':_0x44bcda,'rak':_0x10ea80};}async function getRandom8DigitNumber(){var _0x54cca1=a0_0x318fa5;const _0x39bb3c=0x989680,_0x3c912b=0x5f5e0ff,_0x266591=Math['floor'](Math[_0x54cca1(0x235)]()*(_0x3c912b-_0x39bb3c+0x1))+_0x39bb3c;var _0x693179;const _0x5f2ae2=await purchases[_0x54cca1(0x2c6)]({'invoice':'INC-'+_0x266591});return _0x5f2ae2&&_0x5f2ae2[_0x54cca1(0x29d)]>0x0?_0x693179=_0x54cca1(0x1f0)+_0x266591:_0x693179=_0x54cca1(0x1f0)+_0x266591,_0x693179;}router[a0_0x318fa5(0x29b)]('/view/add_purchases',auth,async(_0x2757f3,_0x34561d)=>{var _0x437b58=a0_0x318fa5;try{const {username:_0x57ea93,email:_0x43e63e,role:_0x5b951a}=_0x2757f3[_0x437b58(0x272)],_0x145530=_0x2757f3['user'],_0x59956c=await profile[_0x437b58(0x2c6)]({'email':_0x145530[_0x437b58(0x2b1)]}),_0x1c4cf6=await master_shop['find'](),_0x31cabf=await staff['findOne']({'email':_0x145530['email']}),_0x3a113c=await suppliers['find']({});let _0xcf6afd;if(_0x145530[_0x437b58(0x2db)]==_0x437b58(0x253)){const _0x24aa48=await staff[_0x437b58(0x2c6)]({'email':_0x145530[_0x437b58(0x2b1)]});_0xcf6afd=await warehouse[_0x437b58(0x239)]([{'$match':{'status':_0x437b58(0x243),'name':_0x24aa48[_0x437b58(0x25f)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x437b58(0x227)}}},{'$group':{'_id':'$name','name':{'$first':_0x437b58(0x2d9)}}}]);}else _0xcf6afd=await warehouse[_0x437b58(0x239)]([{'$match':{'status':_0x437b58(0x243),'warehouse_category':_0x437b58(0x1e8),'name':{'$ne':_0x437b58(0x227)}}},{'$group':{'_id':_0x437b58(0x2d9),'name':{'$first':_0x437b58(0x2d9)}}}]);const _0x20fbc8=await product['find']({}),_0x1042ae=await warehouse[_0x437b58(0x288)]({'status':_0x437b58(0x243)}),_0x4f0e62=await purchases[_0x437b58(0x288)]({}),_0x7c2259=_0x4f0e62[_0x437b58(0x29d)]+0x1,_0x2b005f='INC-'+_0x7c2259[_0x437b58(0x251)]()['padStart'](0x5,'0');var _0x4dc519=[_0x437b58(0x2e5),_0x437b58(0x296)];if(_0x1c4cf6[0x0]['language']==_0x437b58(0x2a9))var _0x173691=users[_0x437b58(0x2a3)];else{if(_0x1c4cf6[0x0]['language']==_0x437b58(0x214))var _0x173691=users[_0x437b58(0x214)];else{if(_0x1c4cf6[0x0][_0x437b58(0x234)]=='German')var _0x173691=users[_0x437b58(0x2b4)];else{if(_0x1c4cf6[0x0][_0x437b58(0x234)]==_0x437b58(0x22c))var _0x173691=users['Spanish'];else{if(_0x1c4cf6[0x0]['language']=='French')var _0x173691=users['French'];else{if(_0x1c4cf6[0x0][_0x437b58(0x234)]=='Portuguese\x20(BR)')var _0x173691=users[_0x437b58(0x2c2)];else{if(_0x1c4cf6[0x0][_0x437b58(0x234)]==_0x437b58(0x23c))var _0x173691=users[_0x437b58(0x23c)];else{if(_0x1c4cf6[0x0]['language']=='Arabic\x20(ae)')var _0x173691=users['Arabic'];}}}}}}}const _0x3e2e9f=getRandom8DigitNumber();_0x3e2e9f[_0x437b58(0x2dd)](_0x58fb58=>{var _0x587351=_0x437b58;_0x34561d[_0x587351(0x24e)]('add_purchases',{'success':_0x2757f3['flash'](_0x587351(0x21d)),'errors':_0x2757f3[_0x587351(0x2f3)](_0x587351(0x230)),'role':_0x145530,'profile':_0x59956c,'suppliers':_0x3a113c,'warehouse':_0xcf6afd,'product':_0x20fbc8,'invoice':_0x58fb58,'master_shop':_0x1c4cf6,'language':_0x173691,'find_data':_0x1042ae,'rooms_data':_0x4dc519});})[_0x437b58(0x2ae)](_0x3cca99=>{var _0x3c7858=_0x437b58;_0x2757f3[_0x3c7858(0x2f3)](_0x3c7858(0x230),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x34561d[_0x3c7858(0x248)](_0x3c7858(0x279));});}catch(_0x2cc3c9){console[_0x437b58(0x25e)](_0x2cc3c9);}}),router[a0_0x318fa5(0x29b)](a0_0x318fa5(0x23b),auth,async(_0x32ec10,_0x17e47f)=>{var _0x49a2df=a0_0x318fa5;try{const _0x10bd3a=_0x32ec10[_0x49a2df(0x1e5)]['id'];console['log'](_0x10bd3a);const _0x5bdc9f=await master_shop[_0x49a2df(0x288)]();console[_0x49a2df(0x25e)](_0x49a2df(0x2de),_0x5bdc9f);const _0x5e4dd5=await product[_0x49a2df(0x2c6)]({'name':_0x10bd3a});console[_0x49a2df(0x25e)](_0x49a2df(0x2e8),_0x5e4dd5),_0x17e47f['status'](0xc8)[_0x49a2df(0x24c)]({'product_data':_0x5e4dd5,'master':_0x5bdc9f});}catch(_0x3352f6){console['log'](_0x49a2df(0x211),_0x3352f6);}}),router[a0_0x318fa5(0x276)]('/view/add_purchases',auth,async(_0x53fed3,_0x5ae583)=>{var _0x542d8d=a0_0x318fa5;try{const {invoice:_0x388342,date:_0x1ea61a,warehouse_name:_0x7db573,prod_name:_0x1b5dbe,prod_code:_0x3107cc,prod_qty:_0x1800ce,prod_unit:_0x416387,prod_secondunit:_0x5e30e9,prod_level:_0x1396ba,prod_isle:_0x27eb8f,prod_pallet:_0x1fd3ec,note:_0x54550c,expiry_date:_0x2eb6cb,batch_code:_0x1db321,payable:_0x4889c8,due_amount:_0x2a8d9c,Room_name:_0x22418e,primary_code:_0x331220,secondary_code:_0x574eee,MaxStocks_data:_0x250090,PO_number:_0x1f273e,SCRN:_0xc147ef,JO_number:_0xf608bf}=_0x53fed3[_0x542d8d(0x2c8)];if(typeof _0x1b5dbe==_0x542d8d(0x1ec))var _0x577c92=[_0x53fed3['body'][_0x542d8d(0x232)]],_0x589ad1=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2d1)]],_0x22eb9a=[_0x53fed3[_0x542d8d(0x2c8)]['prod_Qty']],_0x5b133c=[_0x53fed3[_0x542d8d(0x2c8)]['prod_primunit']],_0x348dad=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2c1)]],_0xde56be=[_0x53fed3['body'][_0x542d8d(0x2ac)]],_0x2f7fb2=[_0x53fed3['body'][_0x542d8d(0x278)]],_0x3d70c6=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x21a)]],_0x1516b0=[_0x53fed3['body'][_0x542d8d(0x2ea)]],_0x4846a6=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x22b)]],_0x2d4265=[_0x53fed3['body']['expiry_date']],_0x336759=[_0x53fed3['body'][_0x542d8d(0x2ca)]],_0x3987c2=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x208)]],_0x35db4e=[_0x53fed3['body'][_0x542d8d(0x2be)]],_0x2068b0=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2d6)]],_0x4e4c88=[_0x53fed3[_0x542d8d(0x2c8)]['RoomAssign']],_0xa9cbc9=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x257)]],_0x2a1790=[_0x53fed3['body'][_0x542d8d(0x1e7)]],_0x4ae9a8=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x225)]],_0x456ce6=[_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x213)]];else var _0x577c92=[..._0x53fed3[_0x542d8d(0x2c8)]['prod_name']],_0x589ad1=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2d1)]],_0x22eb9a=[..._0x53fed3[_0x542d8d(0x2c8)]['prod_Qty']],_0x5b133c=[..._0x53fed3['body'][_0x542d8d(0x238)]],_0x348dad=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2c1)]],_0xde56be=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2ac)]],_0x2f7fb2=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x278)]],_0x3d70c6=[..._0x53fed3['body'][_0x542d8d(0x21a)]],_0x1516b0=[..._0x53fed3[_0x542d8d(0x2c8)]['MaxStocks_data']],_0x4846a6=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x22b)]],_0x2d4265=[..._0x53fed3['body'][_0x542d8d(0x2ec)]],_0x336759=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2ca)]],_0x3987c2=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x208)]],_0x35db4e=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2be)]],_0x2068b0=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x2d6)]],_0x4e4c88=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x207)]],_0xa9cbc9=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x257)]],_0x2a1790=[..._0x53fed3['body'][_0x542d8d(0x1e7)]],_0x4ae9a8=[..._0x53fed3[_0x542d8d(0x2c8)]['actual_qty']],_0x456ce6=[..._0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x213)]];const _0x4b19c2=_0x577c92['map'](_0x17f2b7=>{return _0x17f2b7={'product_name':_0x17f2b7};});_0x4ae9a8[_0x542d8d(0x2f5)]((_0x437965,_0x3d070a)=>{var _0x116172=_0x542d8d;_0x4b19c2[_0x3d070a][_0x116172(0x225)]=Math[_0x116172(0x20e)](_0x437965);}),_0x456ce6[_0x542d8d(0x2f5)]((_0x6547fa,_0x4c0a49)=>{var _0xaf21a=_0x542d8d;_0x4b19c2[_0x4c0a49][_0xaf21a(0x213)]=_0x6547fa;}),_0x589ad1[_0x542d8d(0x2f5)]((_0x3f2341,_0xeb0da1)=>{var _0xbe0df3=_0x542d8d;_0x4b19c2[_0xeb0da1][_0xbe0df3(0x216)]=_0x3f2341;}),_0x22eb9a[_0x542d8d(0x2f5)]((_0x4bf8fe,_0x8ad439)=>{var _0x38869b=_0x542d8d;_0x4b19c2[_0x8ad439][_0x38869b(0x2c9)]=Math[_0x38869b(0x20e)](_0x4bf8fe);}),_0x5b133c[_0x542d8d(0x2f5)]((_0x49aefb,_0x1669f0)=>{var _0x2bb0af=_0x542d8d;_0x4b19c2[_0x1669f0][_0x2bb0af(0x2cf)]=_0x49aefb;}),_0x348dad[_0x542d8d(0x2f5)]((_0x1805ff,_0x47e816)=>{_0x4b19c2[_0x47e816]['secondary_unit']=_0x1805ff;}),_0xde56be[_0x542d8d(0x2f5)]((_0x41f7d0,_0x6953db)=>{var _0x3ce138=_0x542d8d;_0x4e4c88[_0x3ce138(0x2f5)]((_0x3cabb9,_0x53d8cf)=>{var _0x5442a4=_0x3ce138;if(_0x3cabb9==_0x5442a4(0x2b8)&&_0x6953db==_0x53d8cf){console[_0x5442a4(0x25e)](_0x3cabb9+_0x5442a4(0x2d0)+_0x6953db+_0x5442a4(0x269)+_0x53d8cf+_0x5442a4(0x269)+_0x41f7d0);var _0x46e0ae=_0x41f7d0['slice'](0x3);_0x4b19c2[_0x6953db][_0x5442a4(0x25a)]=_0x41f7d0[0x0],_0x4b19c2[_0x6953db][_0x5442a4(0x24b)]=_0x41f7d0[0x1],_0x4b19c2[_0x6953db][_0x5442a4(0x286)]=0x0,_0x4b19c2[_0x6953db]['bin']=0x0,_0x4b19c2[_0x6953db]['type']=_0x5442a4(0x2a0),_0x4b19c2[_0x6953db][_0x5442a4(0x2bc)]=_0x46e0ae;}else{if(_0x3cabb9==_0x5442a4(0x21e)&&_0x6953db==_0x53d8cf){var _0x46e0ae=_0x41f7d0[_0x5442a4(0x228)](0x3);_0x4b19c2[_0x6953db]['storage']=_0x41f7d0[0x0],_0x4b19c2[_0x6953db][_0x5442a4(0x24b)]=_0x41f7d0[0x1],_0x4b19c2[_0x6953db]['bay']=0x0,_0x4b19c2[_0x6953db][_0x5442a4(0x252)]=0x0,_0x4b19c2[_0x6953db][_0x5442a4(0x1fe)]=_0x5442a4(0x2a0),_0x4b19c2[_0x6953db]['floorlevel']=_0x41f7d0[0x5];}else{if(_0x6953db==_0x53d8cf){if(_0x41f7d0[0x0]=='A'&&_0x41f7d0[0x1]=='L'&&_0x41f7d0[0x2]=='L')console[_0x5442a4(0x25e)](_0x3cabb9+_0x5442a4(0x269)+_0x6953db+_0x5442a4(0x269)+_0x53d8cf+_0x5442a4(0x269)+_0x41f7d0+_0x5442a4(0x2e2)),_0x4b19c2[_0x6953db][_0x5442a4(0x25a)]=_0x41f7d0[0x0],_0x4b19c2[_0x6953db][_0x5442a4(0x24b)]=_0x41f7d0[0x1],_0x4b19c2[_0x6953db][_0x5442a4(0x286)]=0x0,_0x4b19c2[_0x6953db][_0x5442a4(0x252)]=0x0,_0x4b19c2[_0x6953db]['type']=_0x5442a4(0x2a0),_0x4b19c2[_0x6953db]['floorlevel']=_0x41f7d0[0x3];else{var _0x2eb801;if(_0x41f7d0[0x4]=='L')_0x2eb801=_0x5442a4(0x236);else _0x41f7d0[0x4]=='F'&&(_0x2eb801=_0x5442a4(0x2a0));_0x4b19c2[_0x6953db][_0x5442a4(0x25a)]=_0x41f7d0[0x0],_0x4b19c2[_0x6953db][_0x5442a4(0x24b)]=_0x41f7d0[0x1],_0x4b19c2[_0x6953db][_0x5442a4(0x286)]=_0x41f7d0[0x2],_0x4b19c2[_0x6953db]['bin']=_0x41f7d0[0x3],_0x4b19c2[_0x6953db][_0x5442a4(0x1fe)]=_0x2eb801,_0x4b19c2[_0x6953db][_0x5442a4(0x2bc)]=_0x41f7d0[0x5];}}}}});}),_0x2f7fb2[_0x542d8d(0x2f5)]((_0x57032a,_0x459561)=>{var _0x10e9f2=_0x542d8d;_0x4b19c2[_0x459561][_0x10e9f2(0x278)]=_0x57032a;}),_0x3d70c6[_0x542d8d(0x2f5)]((_0x31687f,_0x4b571c)=>{var _0x1a0eab=_0x542d8d;_0x4b19c2[_0x4b571c][_0x1a0eab(0x21a)]=_0x31687f;}),_0x1516b0[_0x542d8d(0x2f5)]((_0x25373e,_0x2aa6a6)=>{var _0x17aedb=_0x542d8d;_0x4b19c2[_0x2aa6a6][_0x17aedb(0x2c5)]=_0x25373e;}),_0x4846a6[_0x542d8d(0x2f5)]((_0x23a7de,_0x4ad7b6)=>{var _0x19f6f6=_0x542d8d;_0x4b19c2[_0x4ad7b6][_0x19f6f6(0x22b)]=_0x23a7de;}),_0x2d4265['forEach']((_0x3f0225,_0x7df464)=>{var _0x50f9ff=_0x542d8d;_0x4b19c2[_0x7df464][_0x50f9ff(0x2ec)]=_0x3f0225;}),_0x336759[_0x542d8d(0x2f5)]((_0x239c2d,_0x6ed4c)=>{var _0x4e23bb=_0x542d8d;_0x4b19c2[_0x6ed4c][_0x4e23bb(0x2fa)]=_0x239c2d;}),_0x3987c2[_0x542d8d(0x2f5)]((_0x149bbb,_0x30d332)=>{_0x4b19c2[_0x30d332]['alertQTY']=_0x149bbb;}),_0x35db4e['forEach']((_0x3c64cf,_0x46d105)=>{_0x4b19c2[_0x46d105]['production_date']=_0x3c64cf;}),_0x2068b0[_0x542d8d(0x2f5)]((_0x53c91c,_0x3d8d58)=>{var _0x2ff043=_0x542d8d;_0x4b19c2[_0x3d8d58][_0x2ff043(0x2e9)]=_0x53c91c;}),_0x4e4c88['forEach']((_0x490d2b,_0x507888)=>{var _0x3ebe40=_0x542d8d;_0x4b19c2[_0x507888][_0x3ebe40(0x24d)]=_0x490d2b;}),_0xa9cbc9[_0x542d8d(0x2f5)]((_0x161487,_0xe42a02)=>{_0x4b19c2[_0xe42a02]['delivery_code']=_0x161487;}),_0x2a1790['forEach']((_0x500e53,_0x8ec175)=>{var _0x30b0f4=_0x542d8d;_0x4b19c2[_0x8ec175][_0x30b0f4(0x259)]=_0x500e53;});const _0x2c3de2=_0x4e4c88['map'](_0x3d6cf7=>{return _0x3d6cf7={'room_name':_0x3d6cf7};}),_0x54a322=_0x4b19c2['filter'](_0xdf33c1=>_0xdf33c1[_0x542d8d(0x2c9)]!=='0'&&_0xdf33c1[_0x542d8d(0x2c9)]!==''),_0x1c567a=new purchases({'invoice':_0x388342,'suppliers':_0x53fed3[_0x542d8d(0x2c8)][_0x542d8d(0x281)],'date':_0x1ea61a,'warehouse_name':_0x7db573,'product':_0x54a322,'note':_0x54550c,'due_amount':_0x2a8d9c,'POnumber':_0x1f273e,'SCRN':_0xc147ef,'JO_number':_0xf608bf,'roomList':_0x2c3de2}),_0x486bc=await _0x1c567a[_0x542d8d(0x2ee)](),_0x3acbf7=await purchases[_0x542d8d(0x2c6)]({'invoice':_0x388342}),_0x3bf0f7=_0x3acbf7['product'][_0x542d8d(0x291)](async _0x5009ac=>{var _0x25c27f=_0x542d8d,_0xefa27e=await warehouse[_0x25c27f(0x2c6)]({'name':_0x7db573,'room':_0x5009ac[_0x25c27f(0x24d)]}),_0x4b8668=0x0;return _0xefa27e[_0x25c27f(0x22f)][_0x25c27f(0x2f5)](_0xd46506=>{var _0x57ea6b=_0x25c27f;_0xd46506[_0x57ea6b(0x1ee)]==_0x5009ac[_0x57ea6b(0x1ee)]&&_0xd46506[_0x57ea6b(0x2bc)]==_0x5009ac['floorlevel']&&_0xd46506['type']==_0x5009ac['type']&&_0xd46506[_0x57ea6b(0x252)]==_0x5009ac[_0x57ea6b(0x252)]&&_0xd46506[_0x57ea6b(0x286)]==_0x5009ac[_0x57ea6b(0x286)]&&_0xd46506[_0x57ea6b(0x24b)]==_0x5009ac[_0x57ea6b(0x24b)]&&_0xd46506['storage']==_0x5009ac[_0x57ea6b(0x25a)]&&_0xd46506[_0x57ea6b(0x2ec)]==_0x5009ac[_0x57ea6b(0x2ec)]&&_0xd46506[_0x57ea6b(0x22b)]==_0x5009ac[_0x57ea6b(0x22b)]&&_0xd46506['production_date']==_0x5009ac[_0x57ea6b(0x2be)]&&_0xd46506[_0x57ea6b(0x259)]==_0x3acbf7[_0x57ea6b(0x259)]&&(_0xd46506[_0x57ea6b(0x27a)]+=Math[_0x57ea6b(0x20e)](_0x5009ac[_0x57ea6b(0x2c9)]),_0x4b8668++);}),_0x4b8668===0x0&&_0xefa27e[_0x25c27f(0x22f)][_0x25c27f(0x2f8)]({'product_name':_0x5009ac[_0x25c27f(0x1ee)],'product_stock':Math[_0x25c27f(0x20e)](_0x5009ac[_0x25c27f(0x2c9)]),'primary_code':_0x5009ac[_0x25c27f(0x278)],'secondary_code':_0x5009ac['secondary_code'],'product_code':_0x5009ac['product_code'],'storage':_0x5009ac['storage'],'rack':_0x5009ac['rack'],'bay':_0x5009ac[_0x25c27f(0x286)],'bin':_0x5009ac['bin'],'type':_0x5009ac['type'],'floorlevel':_0x5009ac['floorlevel'],'maxProducts':_0x5009ac[_0x25c27f(0x2c5)],'unit':_0x5009ac[_0x25c27f(0x2cf)],'secondary_unit':_0x5009ac[_0x25c27f(0x1dd)],'expiry_date':_0x5009ac[_0x25c27f(0x2ec)],'maxPerUnit':_0x5009ac['maxperunit'],'batch_code':_0x5009ac[_0x25c27f(0x22b)],'alertQTY':_0x5009ac[_0x25c27f(0x208)],'production_date':_0x5009ac['production_date'],'product_cat':_0x5009ac[_0x25c27f(0x2e9)],'invoice':_0x5009ac[_0x25c27f(0x259)],'actual_qty':Math['abs'](_0x5009ac['actual_qty']),'actual_uom':_0x5009ac[_0x25c27f(0x213)]}),_0xefa27e;});Promise[_0x542d8d(0x289)](_0x3bf0f7)[_0x542d8d(0x2dd)](async _0x52aeb3=>{var _0x395b95=_0x542d8d;try{for(const _0x5f0d98 of _0x52aeb3){await _0x5f0d98[_0x395b95(0x2ee)]();}const _0x2a2910=await master_shop['find'](),_0xf3c908=await email_settings[_0x395b95(0x2c6)](),_0x336648=await supervisor_settings[_0x395b95(0x288)]();var _0x251853=_0x3acbf7[_0x395b95(0x2e8)],_0x5d1d8f='',_0x221aad;for(_0x221aad in _0x251853){_0x5d1d8f+=_0x395b95(0x26d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x251853[_0x221aad][_0x395b95(0x1ee)]+_0x395b95(0x271)+_0x395b95(0x2bb)+_0x251853[_0x221aad][_0x395b95(0x216)]+'</td>'+_0x395b95(0x2bb)+_0x251853[_0x221aad][_0x395b95(0x2c9)]+_0x395b95(0x271)+_0x395b95(0x2bb)+_0x251853[_0x221aad][_0x395b95(0x2cf)]+_0x395b95(0x271)+_0x395b95(0x2bb)+_0x251853[_0x221aad][_0x395b95(0x1dd)]+_0x395b95(0x271)+_0x395b95(0x2bb)+_0x3acbf7[_0x395b95(0x21f)]+_0x395b95(0x271)+_0x395b95(0x2bb)+_0x251853[_0x221aad]['room_name']+_0x395b95(0x271)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x251853[_0x221aad][_0x395b95(0x25a)]+_0x251853[_0x221aad][_0x395b95(0x24b)]+_0x251853[_0x221aad][_0x395b95(0x286)]+_0x251853[_0x221aad][_0x395b95(0x252)]+_0x251853[_0x221aad]['type'][0x0]+_0x251853[_0x221aad][_0x395b95(0x2bc)]+_0x395b95(0x271),_0x395b95(0x295);}let _0x3aaaad=nodemailer[_0x395b95(0x277)]({'host':_0xf3c908['host'],'port':Number(_0xf3c908[_0x395b95(0x28e)]),'secure':![],'auth':{'user':_0xf3c908[_0x395b95(0x2b1)],'pass':_0xf3c908[_0x395b95(0x297)]}}),_0x13af3d={'from':_0xf3c908[_0x395b95(0x2b1)],'to':_0x336648[0x0][_0x395b95(0x2b7)],'subject':_0x395b95(0x2b3),'attachments':[{'filename':_0x395b95(0x201),'path':__dirname+'/../public'+_0x395b95(0x2e1)+_0x2a2910[0x0][_0x395b95(0x28d)],'cid':_0x395b95(0x2d4)}],'html':_0x395b95(0x27e)+_0x395b95(0x1ea)+_0x395b95(0x282)+'<div>'+_0x395b95(0x27f)+'<div>'+_0x395b95(0x2e6)+_0x395b95(0x20b)+_0x395b95(0x2d2)+_0x395b95(0x26f)+_0x2a2910[0x0]['site_title']+_0x395b95(0x240)+'</div>'+_0x395b95(0x20b)+_0x395b95(0x246)+'<div>'+_0x395b95(0x2f6)+_0x395b95(0x26e)+_0x3acbf7[_0x395b95(0x259)]+'\x20'+_0x395b95(0x209)+_0x395b95(0x262)+_0x3acbf7['date']+'\x20'+_0x395b95(0x25c)+'</h5>'+_0x395b95(0x20b)+_0x395b95(0x212)+_0x395b95(0x29c)+'<tr>'+_0x395b95(0x266)+_0x395b95(0x23f)+_0x395b95(0x205)+_0x395b95(0x2a4)+_0x395b95(0x27c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x395b95(0x241)+_0x395b95(0x1f8)+'</tr>'+'</thead>'+_0x395b95(0x28f)+'\x20'+_0x5d1d8f+'\x20'+_0x395b95(0x299)+_0x395b95(0x267)+_0x395b95(0x2d2)+_0x395b95(0x285)+_0x395b95(0x2c3)+_0x2a2910[0x0][_0x395b95(0x2c0)]+_0x395b95(0x1e1)+_0x395b95(0x20b)+_0x395b95(0x20b)+'</body></html>'};_0x3aaaad['sendMail'](_0x13af3d,function(_0x3b7d87,_0x2b109a){var _0x126c4e=_0x395b95;_0x3b7d87?(console[_0x126c4e(0x25e)](_0x3b7d87),console[_0x126c4e(0x25e)](_0x126c4e(0x2a2))):console[_0x126c4e(0x25e)]('Email\x20sent\x20successfully');}),_0x53fed3[_0x395b95(0x2f3)](_0x395b95(0x21d),_0x395b95(0x270)),_0x5ae583[_0x395b95(0x248)](_0x395b95(0x2f4));}catch(_0x2e28d3){console[_0x395b95(0x2b5)](_0x2e28d3),_0x5ae583['status'](0x1f4)['json']({'error':_0x395b95(0x298)});}})[_0x542d8d(0x2ae)](_0x5bd475=>{var _0x4aadf=_0x542d8d;console['error'](_0x5bd475),_0x5ae583[_0x4aadf(0x245)](0x1f4)[_0x4aadf(0x24c)]({'error':'An\x20error\x20occurred.'});});}catch(_0x6ede92){console['log'](_0x6ede92);}}),router['get']('/preview/:id',auth,async(_0x5f5657,_0x3ac237)=>{var _0x469a84=a0_0x318fa5;try{const {username:_0x2833d9,email:_0x5341f6,role:_0x5d34e0}=_0x5f5657[_0x469a84(0x272)],_0x3e80e6=_0x5f5657[_0x469a84(0x272)],_0x47e59c=await profile[_0x469a84(0x2c6)]({'email':_0x3e80e6['email']}),_0x159186=await master_shop[_0x469a84(0x288)](),_0x1d8142=_0x5f5657[_0x469a84(0x1e5)]['id'],_0xfa64f3=await purchases[_0x469a84(0x268)](_0x1d8142),_0x4a1f3d=await warehouse[_0x469a84(0x239)]([{'$match':{'name':_0xfa64f3[_0x469a84(0x21f)],'room':_0xfa64f3[_0x469a84(0x23a)]}},{'$unwind':_0x469a84(0x28c)},{'$group':{'_id':_0x469a84(0x2e4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x469a84(0x2f2)},'floorlevel':{'$first':_0x469a84(0x284)},'primary_code':{'$first':_0x469a84(0x2d3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x469a84(0x23d)},'storage':{'$first':_0x469a84(0x2fb)},'rack':{'$first':_0x469a84(0x2a6)},'expiry_date':{'$first':_0x469a84(0x2b9)}}}]),_0x52b721=await customer['find']({});let _0x4213c5;if(_0x3e80e6['role']==_0x469a84(0x253)){const _0x42606b=await staff[_0x469a84(0x2c6)]({'email':_0x3e80e6[_0x469a84(0x2b1)]});_0x4213c5=await warehouse[_0x469a84(0x239)]([{'$match':{'status':_0x469a84(0x243),'name':_0x42606b[_0x469a84(0x25f)]}},{'$group':{'_id':'$name','name':{'$first':_0x469a84(0x2d9)}}}]);}else _0x4213c5=await warehouse['aggregate']([{'$match':{'status':_0x469a84(0x243)}},{'$group':{'_id':_0x469a84(0x2d9),'name':{'$first':_0x469a84(0x2d9)}}}]);const _0x55513c=await product['find']({}),_0x718189=await suppliers[_0x469a84(0x288)]({}),_0x1c63f0=BayBinSelected(_0xfa64f3[_0x469a84(0x21f)],_0xfa64f3[_0x469a84(0x23a)]);if(_0x159186[0x0][_0x469a84(0x234)]=='English\x20(US)'){var _0x1c4d84=users[_0x469a84(0x2a3)];console[_0x469a84(0x25e)](_0x1c4d84);}else{if(_0x159186[0x0][_0x469a84(0x234)]==_0x469a84(0x214))var _0x1c4d84=users['Hindi'];else{if(_0x159186[0x0][_0x469a84(0x234)]==_0x469a84(0x2b4))var _0x1c4d84=users[_0x469a84(0x2b4)];else{if(_0x159186[0x0][_0x469a84(0x234)]==_0x469a84(0x22c))var _0x1c4d84=users['Spanish'];else{if(_0x159186[0x0]['language']==_0x469a84(0x229))var _0x1c4d84=users[_0x469a84(0x229)];else{if(_0x159186[0x0][_0x469a84(0x234)]==_0x469a84(0x29e))var _0x1c4d84=users[_0x469a84(0x2c2)];else{if(_0x159186[0x0][_0x469a84(0x234)]==_0x469a84(0x23c))var _0x1c4d84=users[_0x469a84(0x23c)];else{if(_0x159186[0x0][_0x469a84(0x234)]==_0x469a84(0x280))var _0x1c4d84=users[_0x469a84(0x2b0)];}}}}}}}_0x3ac237[_0x469a84(0x24e)](_0x469a84(0x1e6),{'success':_0x5f5657[_0x469a84(0x2f3)]('success'),'errors':_0x5f5657['flash'](_0x469a84(0x230)),'role':_0x3e80e6,'profile':_0x47e59c,'customer':_0x52b721,'warehouse':_0x4213c5,'product':_0x4a1f3d,'user':_0xfa64f3,'master_shop':_0x159186,'unit':_0x55513c,'language':_0x1c4d84,'suppliers':_0x718189,'dataSelected':_0x1c63f0});}catch(_0x6ebfdb){console[_0x469a84(0x25e)](_0x6ebfdb);}}),router[a0_0x318fa5(0x276)](a0_0x318fa5(0x2da),auth,async(_0x1b292b,_0x5ec07e)=>{var _0x15854b=a0_0x318fa5;try{const _0x2b3e94=_0x1b292b[_0x15854b(0x1e5)]['id'],{invoice:_0x3f14fa,warehouse_name:_0x41c102,Room_name:_0x4da7a0}=_0x1b292b['body'],_0x5bf5f2=await warehouse[_0x15854b(0x2c6)]({'name':_0x41c102,'room':_0x4da7a0}),_0x5bb067=await purchases[_0x15854b(0x2c6)]({'invoice':_0x3f14fa});_0x5bb067['product'][_0x15854b(0x2f5)](_0x51b10a=>{var _0x10117d=_0x15854b,_0x57d310=0x0;const _0x50990b=_0x5bf5f2[_0x10117d(0x22f)][_0x10117d(0x291)](_0xd5b028=>{var _0x4c26ae=_0x10117d;_0xd5b028[_0x4c26ae(0x1ee)]==_0x51b10a[_0x4c26ae(0x1ee)]&&_0xd5b028[_0x4c26ae(0x2bc)]==_0x51b10a[_0x4c26ae(0x2bc)]&&_0xd5b028['type']==_0x51b10a[_0x4c26ae(0x1fe)]&&_0xd5b028['bin']==_0x51b10a[_0x4c26ae(0x252)]&&_0xd5b028[_0x4c26ae(0x286)]==_0x51b10a[_0x4c26ae(0x286)]&&_0xd5b028[_0x4c26ae(0x24b)]==_0x51b10a['rack']&&_0xd5b028[_0x4c26ae(0x25a)]==_0x51b10a[_0x4c26ae(0x25a)]&&_0xd5b028[_0x4c26ae(0x2ec)]==_0x51b10a[_0x4c26ae(0x2ec)]&&_0xd5b028['batch_code']==_0x51b10a[_0x4c26ae(0x22b)]&&_0xd5b028[_0x4c26ae(0x2be)]==_0x51b10a[_0x4c26ae(0x2be)]&&_0xd5b028['delivery_date']==_0x51b10a[_0x4c26ae(0x26b)]&&_0xd5b028['delivery_code']==_0x51b10a[_0x4c26ae(0x1df)]&&(_0xd5b028[_0x4c26ae(0x27a)]=parseInt(_0xd5b028[_0x4c26ae(0x27a)])+parseInt(_0x51b10a[_0x4c26ae(0x2c9)]),_0x57d310++);});_0x57d310=='0'&&(_0x5bf5f2['product_details']=_0x5bf5f2['product_details'][_0x10117d(0x203)]({'product_name':_0x51b10a[_0x10117d(0x1ee)],'product_stock':_0x51b10a[_0x10117d(0x2c9)],'primary_code':_0x51b10a[_0x10117d(0x278)],'secondary_code':_0x51b10a[_0x10117d(0x21a)],'product_code':_0x51b10a[_0x10117d(0x216)],'storage':_0x51b10a[_0x10117d(0x25a)],'rack':_0x51b10a[_0x10117d(0x24b)],'bay':_0x51b10a[_0x10117d(0x286)],'bin':_0x51b10a[_0x10117d(0x252)],'type':_0x51b10a[_0x10117d(0x1fe)],'floorlevel':_0x51b10a[_0x10117d(0x2bc)],'maxProducts':_0x51b10a[_0x10117d(0x2c5)],'unit':_0x51b10a[_0x10117d(0x2cf)],'secondary_unit':_0x51b10a[_0x10117d(0x1dd)],'expiry_date':_0x51b10a[_0x10117d(0x2ec)],'maxPerUnit':_0x51b10a[_0x10117d(0x2fa)],'batch_code':_0x51b10a[_0x10117d(0x22b)],'alertQTY':_0x51b10a[_0x10117d(0x208)],'production_date':_0x51b10a[_0x10117d(0x2be)],'delivery_date':_0x51b10a[_0x10117d(0x26b)],'delivery_code':_0x51b10a['delivery_code']}));}),await _0x5bf5f2[_0x15854b(0x2ee)](),_0x5bb067[_0x15854b(0x2aa)]='True';const _0x49a997=await _0x5bb067[_0x15854b(0x2ee)]();_0x1b292b[_0x15854b(0x2f3)]('success',_0x15854b(0x1f5)),_0x5ec07e[_0x15854b(0x248)]('/all_purchases/view');}catch(_0x269c0c){console[_0x15854b(0x25e)](_0x269c0c);}}),router[a0_0x318fa5(0x29b)]('/view/:id',auth,async(_0x2c2d11,_0x4fe52f)=>{var _0x481258=a0_0x318fa5;try{const {username:_0x30a7bf,email:_0xa6e858,role:_0x483183}=_0x2c2d11[_0x481258(0x272)],_0x2af5aa=_0x2c2d11[_0x481258(0x272)],_0x19ccb0=await profile[_0x481258(0x2c6)]({'email':_0x2af5aa[_0x481258(0x2b1)]}),_0x43415e=await master_shop[_0x481258(0x288)](),_0x1d7269=_0x2c2d11['params']['id'],_0x1d8dab=await purchases[_0x481258(0x268)](_0x1d7269),_0xfc934c=await suppliers[_0x481258(0x288)]({});let _0x42dfe8;if(_0x2af5aa[_0x481258(0x2db)]==_0x481258(0x253)){const _0x179cc0=await staff[_0x481258(0x2c6)]({'email':_0x2af5aa[_0x481258(0x2b1)]});_0x42dfe8=await warehouse[_0x481258(0x288)]({'status':_0x481258(0x243),'name':_0x179cc0['warehouse'],'warehouse_category':_0x481258(0x1e8)});}else _0x42dfe8=await warehouse['aggregate']([{'$match':{'status':_0x481258(0x243),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x481258(0x2d9),'name':{'$first':_0x481258(0x2d9)}}}]);const _0x54fea5=await product[_0x481258(0x288)]({}),_0x1ffa89=BayBinSelected(_0x1d8dab[_0x481258(0x21f)],_0x1d8dab[_0x481258(0x23a)]);let _0xba1235=new Date(_0x1d8dab[_0x481258(0x2ec)]),_0x5b0605=('0'+_0xba1235[_0x481258(0x20a)]())[_0x481258(0x228)](-0x2),_0x33f2b7=('0'+(_0xba1235[_0x481258(0x28b)]()+0x1))['slice'](-0x2),_0x1c4494=_0xba1235[_0x481258(0x2b2)](),_0x72a236=_0x1c4494+'-'+_0x33f2b7+'-'+_0x5b0605;if(_0x43415e[0x0][_0x481258(0x234)]==_0x481258(0x2a9)){var _0x1946ab=users[_0x481258(0x2a3)];console[_0x481258(0x25e)](_0x1946ab);}else{if(_0x43415e[0x0][_0x481258(0x234)]==_0x481258(0x214))var _0x1946ab=users[_0x481258(0x214)];else{if(_0x43415e[0x0][_0x481258(0x234)]=='German')var _0x1946ab=users[_0x481258(0x2b4)];else{if(_0x43415e[0x0][_0x481258(0x234)]=='Spanish')var _0x1946ab=users[_0x481258(0x22c)];else{if(_0x43415e[0x0][_0x481258(0x234)]==_0x481258(0x229))var _0x1946ab=users['French'];else{if(_0x43415e[0x0][_0x481258(0x234)]==_0x481258(0x29e))var _0x1946ab=users[_0x481258(0x2c2)];else{if(_0x43415e[0x0][_0x481258(0x234)]=='Chinese')var _0x1946ab=users[_0x481258(0x23c)];else{if(_0x43415e[0x0][_0x481258(0x234)]=='Arabic\x20(ae)')var _0x1946ab=users[_0x481258(0x2b0)];}}}}}}}_0x4fe52f[_0x481258(0x24e)](_0x481258(0x20c),{'success':_0x2c2d11['flash']('success'),'errors':_0x2c2d11['flash']('errors'),'role':_0x2af5aa,'profile':_0x19ccb0,'purchases':_0x1d8dab,'suppliers':_0xfc934c,'warehouse':_0x42dfe8,'product':_0x54fea5,'master_shop':_0x43415e,'language':_0x1946ab,'ed_fullDate':_0x72a236,'dataSelected':_0x1ffa89});}catch(_0x322b5a){console[_0x481258(0x25e)](_0x322b5a);}}),router[a0_0x318fa5(0x276)](a0_0x318fa5(0x200),auth,async(_0x900dc,_0x765986)=>{var _0x46b88b=a0_0x318fa5;try{const _0x19b12f=_0x900dc[_0x46b88b(0x1e5)]['id'],_0x46c5a4=await purchases[_0x46b88b(0x2c6)]({'_id':_0x900dc[_0x46b88b(0x1e5)]['id']}),_0x18c8eb=await warehouse[_0x46b88b(0x2c6)]({'name':_0x46c5a4[_0x46b88b(0x21f)],'room':_0x46c5a4['room']});_0x46c5a4[_0x46b88b(0x2e8)]['forEach'](_0x45665c=>{var _0x17f33a=_0x46b88b;const _0x5c6928=_0x18c8eb[_0x17f33a(0x22f)][_0x17f33a(0x291)](_0x314d88=>{var _0x23607b=_0x17f33a;_0x314d88[_0x23607b(0x1ee)]==_0x45665c['product_name']&&_0x314d88[_0x23607b(0x2bc)]==_0x45665c[_0x23607b(0x2bc)]&&_0x314d88[_0x23607b(0x1fe)]==_0x45665c[_0x23607b(0x1fe)]&&_0x314d88[_0x23607b(0x252)]==_0x45665c['bin']&&_0x314d88[_0x23607b(0x286)]==_0x45665c[_0x23607b(0x286)]&&_0x314d88[_0x23607b(0x24b)]==_0x45665c[_0x23607b(0x24b)]&&_0x314d88[_0x23607b(0x25a)]==_0x45665c[_0x23607b(0x25a)]&&(_0x314d88['product_stock']=parseInt(_0x314d88[_0x23607b(0x27a)])-parseInt(_0x45665c['quantity']));});}),await _0x18c8eb[_0x46b88b(0x2ee)]();const {invoice:_0x2254e5,suppliers:_0x1c66da,date:_0x19d8b8,warehouse_name:_0x3fddb5,prod_name:_0x473615,prod_code:_0x24648e,prod_qty:_0x546e23,prod_unit:_0x1d5b00,prod_secondunit:_0x7e2023,prod_level:_0x2b4231,prod_isle:_0x5dcca3,prod_pallet:_0x2deb69,note:_0x3bd5e8,expiry_date:_0x5aa769,batch_code:_0x23c1b6,paid_amount:_0x13b8a6,due_amount:_0xcd6087,Room_name:_0x3426ad,primary_code:_0x5c1b9b,secondary_code:_0x239fc1,PO_number:_0x5c628c,JO_number:_0x565d6a}=_0x900dc[_0x46b88b(0x2c8)];if(typeof _0x473615==_0x46b88b(0x1ec))var _0x3c974e=[_0x900dc['body'][_0x46b88b(0x232)]],_0x366b9f=[_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2d1)]],_0x29e8c7=[_0x900dc[_0x46b88b(0x2c8)]['prod_qty']],_0x29b6ee=[_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2e3)]],_0x2053ea=[_0x900dc['body'][_0x46b88b(0x2c1)]],_0x53d96b=[_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2ac)]],_0x13cf65=[_0x900dc[_0x46b88b(0x2c8)]['prod_isle']],_0x24185e=[_0x900dc[_0x46b88b(0x2c8)]['prod_pallet']],_0x459231=[_0x900dc['body']['primary_code']],_0x287a84=[_0x900dc[_0x46b88b(0x2c8)]['secondary_code']],_0x40cd26=[_0x900dc['body'][_0x46b88b(0x2ea)]],_0x4e444f=[_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x22b)]],_0x22aa59=[_0x900dc[_0x46b88b(0x2c8)]['expiry_date']],_0x1dcc19=[_0x900dc['body']['storage']],_0x4fd98a=[_0x900dc['body']['rak']],_0x5ff8c3=[_0x900dc['body'][_0x46b88b(0x1fe)]];else var _0x3c974e=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x232)]],_0x366b9f=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2d1)]],_0x29e8c7=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x223)]],_0x29b6ee=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2e3)]],_0x2053ea=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2c1)]],_0x53d96b=[..._0x900dc[_0x46b88b(0x2c8)]['prod_level']],_0x13cf65=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x1fb)]],_0x24185e=[..._0x900dc['body'][_0x46b88b(0x1dc)]],_0x459231=[..._0x900dc[_0x46b88b(0x2c8)]['primary_code']],_0x287a84=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x21a)]],_0x40cd26=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2ea)]],_0x4e444f=[..._0x900dc['body'][_0x46b88b(0x22b)]],_0x22aa59=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x2ec)]],_0x1dcc19=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x25a)]],_0x4fd98a=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x1f6)]],_0x5ff8c3=[..._0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x1fe)]];const _0x768941=_0x3c974e[_0x46b88b(0x291)](_0x4fd2ef=>{return _0x4fd2ef={'product_name':_0x4fd2ef};});_0x366b9f[_0x46b88b(0x2f5)]((_0x1bd01a,_0x5096d7)=>{var _0x4f5e99=_0x46b88b;_0x768941[_0x5096d7][_0x4f5e99(0x216)]=_0x1bd01a;}),_0x29e8c7[_0x46b88b(0x2f5)]((_0x4aef88,_0x111c7f)=>{var _0x4020e2=_0x46b88b;_0x768941[_0x111c7f][_0x4020e2(0x2c9)]=_0x4aef88;}),_0x29b6ee[_0x46b88b(0x2f5)]((_0x417be1,_0x2f1d5e)=>{var _0x41a6a4=_0x46b88b;_0x768941[_0x2f1d5e][_0x41a6a4(0x2cf)]=_0x417be1;}),_0x2053ea[_0x46b88b(0x2f5)]((_0x1c57e5,_0x481b06)=>{_0x768941[_0x481b06]['secondary_unit']=_0x1c57e5;}),_0x53d96b[_0x46b88b(0x2f5)]((_0x52d0b0,_0x36ada0)=>{var _0x4bd2d8=_0x46b88b;_0x768941[_0x36ada0][_0x4bd2d8(0x286)]=_0x52d0b0;}),_0x13cf65[_0x46b88b(0x2f5)]((_0x5dbdb4,_0x406de0)=>{var _0x3947e1=_0x46b88b;_0x768941[_0x406de0][_0x3947e1(0x252)]=_0x5dbdb4;}),_0x24185e[_0x46b88b(0x2f5)]((_0xdd5a4,_0x548856)=>{var _0x22fa84=_0x46b88b;_0x768941[_0x548856][_0x22fa84(0x2bc)]=_0xdd5a4;}),_0x459231[_0x46b88b(0x2f5)]((_0x1b4741,_0xe4dafe)=>{_0x768941[_0xe4dafe]['primary_code']=_0x1b4741;}),_0x287a84[_0x46b88b(0x2f5)]((_0x21c7d3,_0x88404)=>{_0x768941[_0x88404]['secondary_code']=_0x21c7d3;}),_0x40cd26[_0x46b88b(0x2f5)]((_0x565ec2,_0x437653)=>{var _0x492a0b=_0x46b88b;_0x768941[_0x437653][_0x492a0b(0x2c5)]=_0x565ec2;}),_0x4e444f['forEach']((_0x18ecf9,_0x331362)=>{var _0x2f1ac4=_0x46b88b;_0x768941[_0x331362][_0x2f1ac4(0x22b)]=_0x18ecf9;}),_0x22aa59[_0x46b88b(0x2f5)]((_0x5b009a,_0x53041b)=>{_0x768941[_0x53041b]['expiry_date']=_0x5b009a;}),_0x5ff8c3[_0x46b88b(0x2f5)]((_0x177c24,_0x9522b7)=>{var _0x4ae863=_0x46b88b;_0x768941[_0x9522b7][_0x4ae863(0x1fe)]=_0x177c24;}),_0x1dcc19[_0x46b88b(0x2f5)]((_0x5b5ed2,_0x3852ea)=>{var _0x114478=_0x46b88b;_0x768941[_0x3852ea][_0x114478(0x25a)]=_0x5b5ed2;}),_0x4fd98a[_0x46b88b(0x2f5)]((_0x1906da,_0x32198b)=>{var _0x4ff6eb=_0x46b88b;_0x768941[_0x32198b][_0x4ff6eb(0x24b)]=_0x1906da;});const _0x498e79=_0x768941[_0x46b88b(0x2bd)](_0x312ea8=>_0x312ea8[_0x46b88b(0x2c9)]!=='0'&&_0x312ea8[_0x46b88b(0x2c9)]!=='');_0x46c5a4['invoice']=_0x2254e5,_0x46c5a4[_0x46b88b(0x281)]=_0x1c66da,_0x46c5a4['date']=_0x19d8b8,_0x46c5a4[_0x46b88b(0x21f)]=_0x3fddb5,_0x46c5a4[_0x46b88b(0x2e8)]=_0x498e79,_0x46c5a4[_0x46b88b(0x2af)]=_0x3bd5e8,_0x46c5a4[_0x46b88b(0x1ef)]=_0x13b8a6,_0x46c5a4['due_amount']=_0xcd6087,_0x46c5a4[_0x46b88b(0x23a)]=_0x3426ad,_0x46c5a4[_0x46b88b(0x274)]=_0x5c628c,_0x46c5a4['JO_number']=_0x565d6a;const _0x1ecbbc=await _0x46c5a4[_0x46b88b(0x2ee)](),_0x2275bc=await warehouse[_0x46b88b(0x2c6)]({'name':_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x21f)],'room':_0x900dc['body'][_0x46b88b(0x23e)]});_0x46c5a4[_0x46b88b(0x2e8)][_0x46b88b(0x2f5)](_0x5cf76a=>{var _0x3e18ce=_0x46b88b,_0x107342=0x0;const _0xce957c=_0x2275bc[_0x3e18ce(0x22f)][_0x3e18ce(0x291)](_0x3af73a=>{var _0x373561=_0x3e18ce;_0x3af73a[_0x373561(0x1ee)]==_0x5cf76a[_0x373561(0x1ee)]&&_0x3af73a['floorlevel']==_0x5cf76a[_0x373561(0x2bc)]&&_0x3af73a[_0x373561(0x1fe)]==_0x5cf76a[_0x373561(0x1fe)]&&_0x3af73a[_0x373561(0x252)]==_0x5cf76a[_0x373561(0x252)]&&_0x3af73a[_0x373561(0x286)]==_0x5cf76a['bay']&&_0x3af73a[_0x373561(0x24b)]==_0x5cf76a[_0x373561(0x24b)]&&_0x3af73a[_0x373561(0x25a)]==_0x5cf76a['storage']&&(_0x3af73a[_0x373561(0x27a)]=parseInt(_0x3af73a[_0x373561(0x27a)])+parseInt(_0x5cf76a[_0x373561(0x2c9)]),_0x107342++);});_0x107342=='0'&&(_0x2275bc[_0x3e18ce(0x22f)]=_0x2275bc[_0x3e18ce(0x22f)][_0x3e18ce(0x203)]({'product_name':_0x5cf76a[_0x3e18ce(0x1ee)],'product_stock':_0x5cf76a[_0x3e18ce(0x2c9)],'primary_code':_0x5cf76a[_0x3e18ce(0x278)],'secondary_code':_0x5cf76a['secondary_code'],'product_code':_0x5cf76a[_0x3e18ce(0x216)],'storage':_0x5cf76a[_0x3e18ce(0x25a)],'rack':_0x5cf76a[_0x3e18ce(0x24b)],'bay':_0x5cf76a[_0x3e18ce(0x286)],'bin':_0x5cf76a[_0x3e18ce(0x252)],'type':_0x5cf76a[_0x3e18ce(0x1fe)],'floorlevel':_0x5cf76a[_0x3e18ce(0x2bc)],'maxProducts':_0x5cf76a[_0x3e18ce(0x2c5)],'unit':_0x5cf76a[_0x3e18ce(0x2cf)],'secondary_unit':_0x5cf76a[_0x3e18ce(0x1dd)],'expiry_date':_0x5cf76a['expiry_date']}));}),await _0x2275bc[_0x46b88b(0x2ee)]();const _0x5bbd61=await s_payment_data[_0x46b88b(0x2c6)]({'invoice':_0x900dc['body'][_0x46b88b(0x259)]});if(_0x5bbd61===null){}else console[_0x46b88b(0x25e)]('suppliers',_0x5bbd61,_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x259)]),_0x5bbd61[_0x46b88b(0x281)]=_0x900dc[_0x46b88b(0x2c8)][_0x46b88b(0x281)],await _0x5bbd61[_0x46b88b(0x2ee)]();_0x900dc['flash'](_0x46b88b(0x21d),_0x46b88b(0x21c)),_0x765986['redirect'](_0x46b88b(0x279));}catch(_0x51a4a8){console[_0x46b88b(0x25e)](_0x51a4a8);}}),router[a0_0x318fa5(0x276)](a0_0x318fa5(0x250),auth,async(_0x4d649f,_0x1d86d1)=>{var _0x21c4e6=a0_0x318fa5;try{const _0x11c01e=_0x4d649f[_0x21c4e6(0x1e5)]['id'],{invoice:_0x4d962c,suppliers:_0xff7847,payable:_0x4cc565,due_amount:_0x186f6a}=_0x4d649f['body'],_0x5aef06=await purchases[_0x21c4e6(0x268)](_0x11c01e);var _0x25e71f=_0x4cc565-_0x186f6a;_0x5aef06[_0x21c4e6(0x1ef)]=parseFloat(_0x5aef06['paid_amount'])+parseFloat(_0x186f6a),_0x5aef06['due_amount']=_0x25e71f;const _0x5e4fe4=await _0x5aef06[_0x21c4e6(0x2ee)]();console['log'](_0x5e4fe4);const _0x57d33e=await s_payment_data[_0x21c4e6(0x2c6)]({'invoice':_0x4d962c});_0x57d33e[_0x21c4e6(0x204)]=_0x25e71f,await _0x57d33e[_0x21c4e6(0x2ee)]();let _0x364dfd=new Date(),_0x4cef25=('0'+_0x364dfd[_0x21c4e6(0x20a)]())['slice'](-0x2),_0x261510=('0'+(_0x364dfd[_0x21c4e6(0x28b)]()+0x1))[_0x21c4e6(0x228)](-0x2),_0x21acfb=_0x364dfd[_0x21c4e6(0x2b2)](),_0x4c5c80=_0x21acfb+'-'+_0x261510+'-'+_0x4cef25;const _0x31514c=new suppliers_payment({'invoice':_0x4d962c,'date':_0x21acfb+'-'+_0x261510+'-'+_0x4cef25,'suppliers':_0xff7847,'reason':'Paid\x20For\x20Purchase','amount':_0x186f6a}),_0x2bc8ce=await _0x31514c[_0x21c4e6(0x2ee)]();_0x4d649f[_0x21c4e6(0x2f3)](_0x21c4e6(0x21d),_0x21c4e6(0x27b)),_0x1d86d1[_0x21c4e6(0x248)](_0x21c4e6(0x279));}catch(_0x2be805){console['log'](_0x2be805);}}),router[a0_0x318fa5(0x29b)](a0_0x318fa5(0x24f),auth,async(_0x19bce3,_0x5bfc72)=>{var _0x13aca5=a0_0x318fa5;try{const {username:_0x3f84f9,email:_0x2aae19,role:_0x42be5}=_0x19bce3[_0x13aca5(0x272)],_0x4b0673=_0x19bce3[_0x13aca5(0x272)],_0x1ffcf0=await profile[_0x13aca5(0x2c6)]({'email':_0x4b0673[_0x13aca5(0x2b1)]}),_0x24e75d=await master_shop['find']();console['log'](_0x13aca5(0x2de),_0x24e75d);const _0x5cacf6=_0x19bce3[_0x13aca5(0x1e5)]['id'],_0xb594c1=await purchases[_0x13aca5(0x268)](_0x5cacf6);console['log'](_0xb594c1);const _0x3bd3e3=await suppliers[_0x13aca5(0x2c6)]({'name':_0xb594c1['suppliers']});console[_0x13aca5(0x25e)](_0x3bd3e3);if(_0x24e75d[0x0]['language']==_0x13aca5(0x2a9)){var _0x366227=users[_0x13aca5(0x2a3)];console[_0x13aca5(0x25e)](_0x366227);}else{if(_0x24e75d[0x0][_0x13aca5(0x234)]==_0x13aca5(0x214))var _0x366227=users['Hindi'];else{if(_0x24e75d[0x0]['language']==_0x13aca5(0x2b4))var _0x366227=users[_0x13aca5(0x2b4)];else{if(_0x24e75d[0x0][_0x13aca5(0x234)]==_0x13aca5(0x22c))var _0x366227=users[_0x13aca5(0x22c)];else{if(_0x24e75d[0x0][_0x13aca5(0x234)]==_0x13aca5(0x229))var _0x366227=users[_0x13aca5(0x229)];else{if(_0x24e75d[0x0][_0x13aca5(0x234)]==_0x13aca5(0x29e))var _0x366227=users[_0x13aca5(0x2c2)];else{if(_0x24e75d[0x0][_0x13aca5(0x234)]==_0x13aca5(0x23c))var _0x366227=users[_0x13aca5(0x23c)];else{if(_0x24e75d[0x0][_0x13aca5(0x234)]=='Arabic\x20(ae)')var _0x366227=users[_0x13aca5(0x2b0)];}}}}}}}_0x5bfc72[_0x13aca5(0x24e)](_0x13aca5(0x224),{'success':_0x19bce3[_0x13aca5(0x2f3)](_0x13aca5(0x21d)),'errors':_0x19bce3[_0x13aca5(0x2f3)]('errors'),'role':_0x4b0673,'profile':_0x1ffcf0,'master_shop':_0x24e75d,'supplier':_0x3bd3e3,'purchase':_0xb594c1,'language':_0x366227});}catch(_0x90d3b7){console[_0x13aca5(0x25e)](_0x90d3b7);}}),router['get'](a0_0x318fa5(0x28a),auth,async(_0x26a83a,_0xb7cf3e)=>{var _0x501ff5=a0_0x318fa5;try{const {username:_0x2fbbac,email:_0x5ed0a9,role:_0x371948}=_0x26a83a['user'],_0x57338c=_0x26a83a[_0x501ff5(0x272)],_0x2a63d4=await profile[_0x501ff5(0x2c6)]({'email':_0x57338c[_0x501ff5(0x2b1)]}),_0x316749=await master_shop[_0x501ff5(0x288)]();console[_0x501ff5(0x25e)](_0x501ff5(0x2de),_0x316749);const _0x3e5e99=_0x26a83a['params']['id'];console[_0x501ff5(0x25e)](_0x3e5e99);const _0x26b706=await purchases['findById'](_0x3e5e99);console[_0x501ff5(0x25e)](_0x501ff5(0x29a),_0x26b706);const _0x1bf250=await product[_0x501ff5(0x288)]({}),_0x54e8f1=await warehouse['aggregate']([{'$match':{'name':_0x26b706['warehouse_name'],'room':_0x26b706['room'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x501ff5(0x28c)},{'$group':{'_id':_0x501ff5(0x2e4),'name':{'$first':_0x501ff5(0x2dc)},'product_stock':{'$first':_0x501ff5(0x20f)},'bay':{'$first':_0x501ff5(0x25d)},'bin':{'$first':_0x501ff5(0x29f)},'type':{'$first':_0x501ff5(0x2f2)},'floorlevel':{'$first':_0x501ff5(0x284)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x501ff5(0x2ba)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x501ff5(0x2a6)}}}]);warehouse_data=await warehouse[_0x501ff5(0x239)]([{'$match':{'status':_0x501ff5(0x243),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x501ff5(0x2d9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x501ff5(0x220),_0x54e8f1);if(_0x316749[0x0][_0x501ff5(0x234)]==_0x501ff5(0x2a9)){var _0x57ccba=users['English'];console[_0x501ff5(0x25e)](_0x57ccba);}else{if(_0x316749[0x0][_0x501ff5(0x234)]==_0x501ff5(0x214))var _0x57ccba=users['Hindi'];else{if(_0x316749[0x0][_0x501ff5(0x234)]=='German')var _0x57ccba=users[_0x501ff5(0x2b4)];else{if(_0x316749[0x0][_0x501ff5(0x234)]==_0x501ff5(0x22c))var _0x57ccba=users[_0x501ff5(0x22c)];else{if(_0x316749[0x0]['language']=='French')var _0x57ccba=users[_0x501ff5(0x229)];else{if(_0x316749[0x0]['language']==_0x501ff5(0x29e))var _0x57ccba=users['Portuguese'];else{if(_0x316749[0x0][_0x501ff5(0x234)]==_0x501ff5(0x23c))var _0x57ccba=users[_0x501ff5(0x23c)];else{if(_0x316749[0x0][_0x501ff5(0x234)]==_0x501ff5(0x280))var _0x57ccba=users['Arabic'];}}}}}}}_0xb7cf3e[_0x501ff5(0x24e)](_0x501ff5(0x2d8),{'success':_0x26a83a['flash'](_0x501ff5(0x21d)),'errors':_0x26a83a[_0x501ff5(0x2f3)](_0x501ff5(0x230)),'role':_0x57338c,'profile':_0x2a63d4,'user':_0x26b706,'stock':_0x54e8f1,'master_shop':_0x316749,'product':_0x1bf250,'language':_0x57ccba,'warehouse':warehouse_data});}catch(_0x2ee828){console[_0x501ff5(0x25e)](_0x2ee828);}}),router[a0_0x318fa5(0x276)](a0_0x318fa5(0x28a),auth,async(_0x8881c6,_0x2666f3)=>{var _0x34b360=a0_0x318fa5;try{const {invoice:_0x3c748a,date:_0x3de247,warehouse_name:_0x5ef4dd,Room_name:_0x4e1204,product_name:_0x1f7661,purchase_quantity:_0x473dee,stocks:_0x44e965,return_qty:_0x2c2886,note:_0x246137,level:_0x2530b6,isle:_0x5d558f,pallet:_0x4449b0,to_warehouse_name:_0x15a581,to_Room_name:_0x588d24}=_0x8881c6[_0x34b360(0x2c8)],_0x24394e=await purchases[_0x34b360(0x2c6)]({'_id':_0x8881c6[_0x34b360(0x1e5)]['id']}),_0x35c134=await warehouse[_0x34b360(0x2c6)]({'name':_0x5ef4dd,'room':_0x4e1204});if(typeof _0x1f7661=='string')var _0x27a5bb=[_0x8881c6['body'][_0x34b360(0x1ee)]],_0x33c2de=[_0x8881c6['body']['purchase_quantity']],_0x1958c7=[_0x8881c6[_0x34b360(0x2c8)]['stocks']],_0x14f4b1=[_0x8881c6['body'][_0x34b360(0x242)]],_0x194e5b=[_0x8881c6['body']['level']],_0x3a4780=[_0x8881c6['body'][_0x34b360(0x2bf)]],_0x5d8173=[_0x8881c6[_0x34b360(0x2c8)]['pallet']],_0x5733c2=[_0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x1fd)]],_0x239608=[_0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x290)]],_0x37500b=[_0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x1f7)]],_0x1e505b=[_0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x217)]];else var _0x27a5bb=[..._0x8881c6['body']['product_name']],_0x33c2de=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x287)]],_0x1958c7=[..._0x8881c6[_0x34b360(0x2c8)]['stocks']],_0x14f4b1=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x242)]],_0x194e5b=[..._0x8881c6['body'][_0x34b360(0x2e7)]],_0x3a4780=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x2bf)]],_0x5d8173=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x256)]],_0x5733c2=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x1fd)]],_0x239608=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x290)]],_0x37500b=[..._0x8881c6['body']['primary_code_hide']],_0x1e505b=[..._0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x217)]];const _0x5af7f2=_0x27a5bb[_0x34b360(0x291)](_0x243478=>{return _0x243478={'product_name':_0x243478};});_0x33c2de[_0x34b360(0x2f5)]((_0x4464d6,_0x54b2d4)=>{var _0x26f1f2=_0x34b360;_0x5af7f2[_0x54b2d4][_0x26f1f2(0x287)]=_0x4464d6;}),_0x1958c7['forEach']((_0x3188c6,_0x1fbad7)=>{var _0x64ee87=_0x34b360;_0x5af7f2[_0x1fbad7][_0x64ee87(0x2cd)]=_0x3188c6;}),_0x14f4b1['forEach']((_0x2fe276,_0x3b3c09)=>{var _0x17541f=_0x34b360;_0x5af7f2[_0x3b3c09][_0x17541f(0x242)]=_0x2fe276;}),_0x194e5b[_0x34b360(0x2f5)]((_0x57a264,_0x459635)=>{var _0x5b13c7=_0x34b360;_0x5af7f2[_0x459635][_0x5b13c7(0x286)]=_0x57a264;}),_0x3a4780['forEach']((_0x4f174d,_0x180052)=>{var _0x4350bf=_0x34b360;_0x5af7f2[_0x180052][_0x4350bf(0x252)]=_0x4f174d;}),_0x5d8173[_0x34b360(0x2f5)]((_0x1f7122,_0x66bdd5)=>{var _0x571cd7=_0x34b360;_0x5af7f2[_0x66bdd5][_0x571cd7(0x2bc)]=_0x1f7122;}),_0x5733c2[_0x34b360(0x2f5)]((_0x39aa51,_0x31e460)=>{_0x5af7f2[_0x31e460]['type']=_0x39aa51;}),_0x239608[_0x34b360(0x2f5)]((_0x39ba07,_0x9d0052)=>{_0x5af7f2[_0x9d0052]['product_code']=_0x39ba07;}),_0x37500b[_0x34b360(0x2f5)]((_0x3258ac,_0x5a056a)=>{var _0x30e002=_0x34b360;_0x5af7f2[_0x5a056a][_0x30e002(0x278)]=_0x3258ac;}),_0x1e505b[_0x34b360(0x2f5)]((_0x93e9bd,_0xb9533c)=>{_0x5af7f2[_0xb9533c]['secondary_code']=_0x93e9bd;}),_0x24394e[_0x34b360(0x2e8)][_0x34b360(0x2f5)](_0x420a1e=>{var _0x55bff1=_0x34b360;const _0x55e69c=_0x35c134[_0x55bff1(0x22f)]['map'](_0x3ff28f=>{var _0x1c0207=_0x55bff1;_0x3ff28f['product_name']==_0x420a1e['product_name']&&_0x3ff28f['floorlevel']==_0x420a1e[_0x1c0207(0x2bc)]&&_0x3ff28f[_0x1c0207(0x1fe)]==_0x420a1e[_0x1c0207(0x1fe)]&&_0x3ff28f['bin']==_0x420a1e[_0x1c0207(0x252)]&&_0x3ff28f[_0x1c0207(0x286)]==_0x420a1e[_0x1c0207(0x286)]&&_0x3ff28f[_0x1c0207(0x24b)]==_0x420a1e['rack']&&_0x3ff28f['storage']==_0x420a1e[_0x1c0207(0x25a)]&&(console[_0x1c0207(0x25e)](parseInt(_0x3ff28f[_0x1c0207(0x27a)])+_0x1c0207(0x269)+parseInt(_0x420a1e[_0x1c0207(0x2c9)])),_0x3ff28f['product_stock']=parseInt(_0x3ff28f[_0x1c0207(0x27a)])+parseInt(_0x420a1e[_0x1c0207(0x2c9)]));});}),await _0x35c134[_0x34b360(0x2ee)]();const _0x22cb35=_0x5af7f2['filter'](_0x437102=>_0x437102['return_qty']!=='0'&&_0x437102[_0x34b360(0x242)]!=='');var _0x163d60=0x0;_0x22cb35[_0x34b360(0x2f5)](_0x4412cf=>{var _0x172d49=_0x34b360;console[_0x172d49(0x25e)](_0x172d49(0x2a1),_0x4412cf),(parseInt(_0x4412cf[_0x172d49(0x287)])<parseInt(_0x4412cf[_0x172d49(0x242)])||parseInt(_0x4412cf[_0x172d49(0x2cd)])<parseInt(_0x4412cf[_0x172d49(0x242)]))&&_0x163d60++;});if(_0x163d60!=0x0)return _0x8881c6[_0x34b360(0x2f3)](_0x34b360(0x230),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x2666f3['redirect'](_0x34b360(0x294));const _0x6219f0=new purchases_return({'invoice':_0x3c748a,'suppliers':_0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x281)],'date':_0x3de247,'warehouse_name':_0x5ef4dd,'return_product':_0x22cb35,'note':_0x246137,'room':_0x4e1204,'to_warehouse_name':_0x15a581,'to_room':_0x588d24}),_0x374066=await _0x6219f0[_0x34b360(0x2ee)]();console[_0x34b360(0x25e)](_0x6219f0);const _0x599fd6=await purchases_return[_0x34b360(0x2c6)]({'invoice':_0x3c748a}),_0x20048a=await warehouse[_0x34b360(0x2c6)]({'name':_0x15a581,'room':_0x588d24});_0x599fd6[_0x34b360(0x258)][_0x34b360(0x2f5)](_0x5b6c83=>{var _0x4aa558=_0x34b360,_0x46bbe2=0x0;const _0xd9f781=_0x20048a[_0x4aa558(0x22f)][_0x4aa558(0x291)](_0x54ae50=>{var _0x366214=_0x4aa558;_0x54ae50[_0x366214(0x1ee)]==_0x5b6c83[_0x366214(0x1ee)]&&_0x54ae50[_0x366214(0x2bc)]==_0x5b6c83['floorlevel']&&_0x54ae50[_0x366214(0x1fe)]==_0x5b6c83[_0x366214(0x1fe)]&&_0x54ae50[_0x366214(0x252)]==_0x5b6c83[_0x366214(0x252)]&&_0x54ae50['bay']==_0x5b6c83['bay']&&(_0x54ae50['product_stock']=parseInt(_0x54ae50[_0x366214(0x27a)])-parseInt(_0x5b6c83[_0x366214(0x242)]),_0x46bbe2++);});_0x46bbe2=='0'&&(_0x20048a[_0x4aa558(0x22f)]=_0x20048a[_0x4aa558(0x22f)][_0x4aa558(0x203)]({'product_name':_0x5b6c83[_0x4aa558(0x1ee)],'product_stock':_0x5b6c83[_0x4aa558(0x242)],'primary_code':_0x5b6c83[_0x4aa558(0x278)],'secondary_code':_0x5b6c83[_0x4aa558(0x21a)],'product_code':_0x5b6c83[_0x4aa558(0x216)],'storage':_0x5b6c83['storage'],'rack':_0x5b6c83[_0x4aa558(0x24b)],'bay':_0x5b6c83['bay'],'bin':_0x5b6c83[_0x4aa558(0x252)],'type':_0x5b6c83[_0x4aa558(0x1fe)],'floorlevel':_0x5b6c83['floorlevel'],'maxProducts':_0x5b6c83['maxStocks'],'unit':_0x5b6c83[_0x4aa558(0x2cf)],'secondary_unit':_0x5b6c83[_0x4aa558(0x1dd)],'expiry_date':_0x5b6c83[_0x4aa558(0x2ec)]}));}),await _0x20048a[_0x34b360(0x2ee)]();const _0x1fc0f6=await purchases[_0x34b360(0x2c6)]({'invoice':_0x3c748a});_0x1fc0f6['return_data']=_0x34b360(0x293);const _0x1ff4e5=await _0x1fc0f6[_0x34b360(0x2ee)](),_0x11786c=new s_payment_data({'invoice':_0x3c748a,'suppliers':_0x8881c6['body'][_0x34b360(0x281)],'reason':_0x34b360(0x2ce)});await _0x11786c[_0x34b360(0x2ee)]();const _0x48ce00=await master_shop[_0x34b360(0x288)]();console['log'](_0x34b360(0x2c7),_0x48ce00[0x0][_0x34b360(0x28d)]);const _0x102f14=await email_settings[_0x34b360(0x2c6)](),_0x1b5f03=await suppliers[_0x34b360(0x2c6)]({'name':_0x8881c6[_0x34b360(0x2c8)][_0x34b360(0x281)]});console[_0x34b360(0x25e)]('suppliers_data',_0x1b5f03);_0x48ce00[0x0][_0x34b360(0x22d)]==0x1?(right_currency=_0x48ce00[0x0][_0x34b360(0x215)],left_currency=''):(right_currency='',left_currency=_0x48ce00[0x0][_0x34b360(0x215)]);var _0x29128c=_0x27a5bb,_0x2e042e=_0x14f4b1,_0x5456c0='',_0x90216f;for(_0x90216f in _0x29128c){_0x5456c0+=_0x34b360(0x26d)+_0x34b360(0x2bb)+_0x29128c[_0x90216f]+_0x34b360(0x271)+_0x34b360(0x2bb)+_0x2e042e[_0x90216f]+_0x34b360(0x271)+_0x34b360(0x295);}console[_0x34b360(0x25e)]('product_list',_0x5456c0);let _0x1a5370=nodemailer[_0x34b360(0x277)]({'service':'gmail','auth':{'user':_0x102f14['email'],'pass':_0x102f14['password']}}),_0x1abf1b={'from':_0x102f14[_0x34b360(0x2b1)],'to':_0x1b5f03[_0x34b360(0x2b1)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x34b360(0x2e1)+_0x48ce00[0x0]['image'],'cid':_0x34b360(0x2d4)}],'html':'<!DOCTYPE\x20html>'+_0x34b360(0x1ea)+_0x34b360(0x282)+_0x34b360(0x2d2)+_0x34b360(0x27f)+_0x34b360(0x2d2)+_0x34b360(0x2e6)+_0x34b360(0x20b)+_0x34b360(0x2d2)+_0x34b360(0x26f)+_0x48ce00[0x0]['site_title']+_0x34b360(0x240)+_0x34b360(0x20b)+_0x34b360(0x20b)+'<hr\x20class=\x22my-3\x22>'+_0x34b360(0x2d2)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x34b360(0x26e)+_0x3c748a+'\x20'+_0x34b360(0x209)+_0x34b360(0x262)+_0x3de247+'\x20'+_0x34b360(0x25c)+_0x34b360(0x1e1)+_0x34b360(0x20b)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x34b360(0x29c)+_0x34b360(0x26d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x34b360(0x275)+_0x34b360(0x2ef)+_0x34b360(0x202)+_0x34b360(0x295)+'</thead>'+_0x34b360(0x28f)+'\x20'+_0x5456c0+'\x20'+_0x34b360(0x299)+_0x34b360(0x267)+_0x34b360(0x2d2)+_0x34b360(0x285)+_0x34b360(0x2c3)+_0x48ce00[0x0]['site_title']+_0x34b360(0x1e1)+_0x34b360(0x20b)+_0x34b360(0x20b)+'</body></html>'};_0x1a5370[_0x34b360(0x22e)](_0x1abf1b,function(_0x4e75ce,_0x4afd5d){var _0x495e64=_0x34b360;_0x4e75ce?(console[_0x495e64(0x25e)](_0x4e75ce),console['log'](_0x495e64(0x2a2))):console[_0x495e64(0x25e)]('Email\x20sent\x20successfully');}),_0x8881c6['flash']('success',_0x34b360(0x206)),_0x2666f3[_0x34b360(0x248)](_0x34b360(0x279));}catch(_0x2133c8){console[_0x34b360(0x25e)](_0x2133c8),_0x2666f3[_0x34b360(0x245)](0xc8)[_0x34b360(0x24c)]({'message':_0x2133c8[_0x34b360(0x2cc)]});}}),router['get'](a0_0x318fa5(0x1f1),auth,async(_0x1eeaae,_0x1e778f)=>{var _0x34880a=a0_0x318fa5;try{const {username:_0x5585f0,email:_0x5d293d,role:_0xe8f3cd}=_0x1eeaae['user'],_0x34b78e=_0x1eeaae[_0x34880a(0x272)],_0x39e115=await profile[_0x34880a(0x2c6)]({'email':_0x34b78e[_0x34880a(0x2b1)]}),_0x186da8=await master_shop[_0x34880a(0x288)](),_0x413556=_0x1eeaae[_0x34880a(0x1e5)]['id'],_0x25c593=await purchases[_0x34880a(0x268)](_0x413556);if(_0x186da8[0x0][_0x34880a(0x234)]==_0x34880a(0x2a9))var _0x219432=users[_0x34880a(0x2a3)];else{if(_0x186da8[0x0][_0x34880a(0x234)]=='Hindi')var _0x219432=users[_0x34880a(0x214)];else{if(_0x186da8[0x0][_0x34880a(0x234)]==_0x34880a(0x2b4))var _0x219432=users[_0x34880a(0x2b4)];else{if(_0x186da8[0x0][_0x34880a(0x234)]=='Spanish')var _0x219432=users[_0x34880a(0x22c)];else{if(_0x186da8[0x0][_0x34880a(0x234)]==_0x34880a(0x229))var _0x219432=users[_0x34880a(0x229)];else{if(_0x186da8[0x0][_0x34880a(0x234)]==_0x34880a(0x29e))var _0x219432=users['Portuguese'];else{if(_0x186da8[0x0][_0x34880a(0x234)]=='Chinese')var _0x219432=users[_0x34880a(0x23c)];else{if(_0x186da8[0x0][_0x34880a(0x234)]==_0x34880a(0x280))var _0x219432=users[_0x34880a(0x2b0)];}}}}}}}_0x1e778f[_0x34880a(0x24e)](_0x34880a(0x2ed),{'success':_0x1eeaae[_0x34880a(0x2f3)](_0x34880a(0x21d)),'errors':_0x1eeaae[_0x34880a(0x2f3)](_0x34880a(0x230)),'role':_0x34b78e,'profile':_0x39e115,'alldata':_0x25c593,'master_shop':_0x186da8,'language':_0x219432}),console['log'](alldata);}catch(_0x390033){console['log'](_0x390033);}}),router['post'](a0_0x318fa5(0x292),async(_0x2273af,_0x2f6b89)=>{var _0x5db347=a0_0x318fa5;const {product_code:_0x264a24}=_0x2273af[_0x5db347(0x2c8)];var _0x1eab9d;const _0x5e5f70=await product[_0x5db347(0x239)]([{'$match':{'primary_code':_0x264a24,'product_category':_0x5db347(0x1e8)}},{'$group':{'_id':_0x5db347(0x1ed),'name':{'$first':'$name'},'category':{'$first':_0x5db347(0x1e0)},'brand':{'$first':'$brand'},'unit':{'$first':_0x5db347(0x1f4)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5db347(0x2f7)},'primary_code':{'$first':_0x5db347(0x25b)},'secondary_code':{'$first':_0x5db347(0x1de)},'maxStocks':{'$first':_0x5db347(0x1f9)},'maxProdPerUnit':{'$first':_0x5db347(0x247)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5db347(0x283)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x166f00=await product['aggregate']([{'$match':{'secondary_code':_0x264a24,'product_category':_0x5db347(0x1e8)}},{'$group':{'_id':'$_id','name':{'$first':_0x5db347(0x2d9)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x5db347(0x1f4)},'alertquantity':{'$first':_0x5db347(0x2d7)},'product_code':{'$first':_0x5db347(0x2f7)},'primary_code':{'$first':_0x5db347(0x25b)},'secondary_code':{'$first':_0x5db347(0x1de)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5db347(0x247)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5e5f70[_0x5db347(0x29d)]>0x0)_0x1eab9d=_0x5e5f70;else _0x166f00[_0x5db347(0x29d)]>0x0&&(_0x1eab9d=_0x166f00);_0x2f6b89[_0x5db347(0x24c)](_0x1eab9d);}),router['post'](a0_0x318fa5(0x218),async(_0x1b7ef7,_0x1cc838)=>{var _0x7d9806=a0_0x318fa5;const {primaryCode:_0x3e33e3,secondaryCode:_0x5edb99,productCode:_0x16d7ea,bay:_0x3ee0b6,bin:_0x2a6f51,types:_0x373169,pallet:_0x4772c6,warehouses:_0x7b8646,room:_0x125341}=_0x1b7ef7[_0x7d9806(0x2c8)];console[_0x7d9806(0x25e)](_0x1b7ef7[_0x7d9806(0x2c8)]);try{const _0x4f2007=await warehouse[_0x7d9806(0x239)]([{'$match':{'name':_0x7b8646,'room':_0x125341}},{'$unwind':_0x7d9806(0x28c)},{'$match':{'product_details.bay':_0x3ee0b6,'product_details.bin':_0x2a6f51,'product_details.type':_0x373169}},{'$group':{'_id':_0x7d9806(0x2e4),'name':{'$first':_0x7d9806(0x2dc)},'product_stock':{'$first':_0x7d9806(0x20f)},'level':{'$first':_0x7d9806(0x26a)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x7d9806(0x244)},'maxProducts':{'$first':_0x7d9806(0x1e4)}}}]);_0x1cc838[_0x7d9806(0x245)](0xc8)[_0x7d9806(0x24c)](_0x4f2007);}catch(_0x566e66){_0x1cc838['status'](0x194)['json']({'message':_0x566e66[_0x7d9806(0x2cc)]});}}),module[a0_0x318fa5(0x2f9)]=router;