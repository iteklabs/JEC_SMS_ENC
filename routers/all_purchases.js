var a0_0x1892f6=a0_0x1e96;(function(_0x678c3c,_0x3f9fa4){var _0x1b3926=a0_0x1e96,_0x5c374c=_0x678c3c();while(!![]){try{var _0xc7e9f5=-parseInt(_0x1b3926(0xa1))/0x1*(-parseInt(_0x1b3926(0xfb))/0x2)+-parseInt(_0x1b3926(0x6a))/0x3+parseInt(_0x1b3926(0x7c))/0x4*(parseInt(_0x1b3926(0x11d))/0x5)+-parseInt(_0x1b3926(0x181))/0x6*(-parseInt(_0x1b3926(0x143))/0x7)+parseInt(_0x1b3926(0x14d))/0x8*(-parseInt(_0x1b3926(0x65))/0x9)+-parseInt(_0x1b3926(0x135))/0xa*(parseInt(_0x1b3926(0x84))/0xb)+parseInt(_0x1b3926(0x77))/0xc;if(_0xc7e9f5===_0x3f9fa4)break;else _0x5c374c['push'](_0x5c374c['shift']());}catch(_0x28571c){_0x5c374c['push'](_0x5c374c['shift']());}}}(a0_0x36bb,0xb592a));const express=require(a0_0x1892f6(0x17f)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1892f6(0x8a)),auth=require(a0_0x1892f6(0xf1)),nodemailer=require(a0_0x1892f6(0x92));var ejs=require('ejs');const path=require(a0_0x1892f6(0x93)),users=require('../public/language/languages.json');router['get']('/view',auth,async(_0x2d6bea,_0x2b6b07)=>{var _0x38aca8=a0_0x1892f6;try{const {username:_0x51a857,email:_0x1edb7e,role:_0x56e90d}=_0x2d6bea[_0x38aca8(0xd7)],_0x484ea3=_0x2d6bea[_0x38aca8(0xd7)],_0x137f90=await profile[_0x38aca8(0x188)]({'email':_0x484ea3['email']}),_0x1ac8bf=await staff[_0x38aca8(0x188)]({'email':_0x484ea3[_0x38aca8(0x14e)]});if(_0x484ea3[_0x38aca8(0xe7)]=='staff'){const _0x3d69ba=await staff[_0x38aca8(0x188)]({'email':_0x484ea3['email']});}const _0x38415a=await master_shop[_0x38aca8(0xb2)]();let _0x1b0c33;if(_0x484ea3[_0x38aca8(0xe7)]==_0x38aca8(0x7b)){const _0x1210fa=await staff[_0x38aca8(0x188)]({'email':_0x484ea3[_0x38aca8(0x14e)]});_0x1b0c33=await purchases[_0x38aca8(0xce)]([{'$match':{'warehouse_name':_0x1210fa[_0x38aca8(0x168)]}},{'$lookup':{'from':_0x38aca8(0x118),'localField':_0x38aca8(0x118),'foreignField':_0x38aca8(0xd2),'as':_0x38aca8(0xee)}},{'$unwind':_0x38aca8(0x131)},{'$unwind':_0x38aca8(0x105)},{'$group':{'_id':'$_id','invoice':{'$first':_0x38aca8(0xa3)},'suppliers':{'$first':_0x38aca8(0xaa)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x38aca8(0xe4)},'room':{'$first':'$room'},'product':{'$push':_0x38aca8(0x105)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x38aca8(0x12d)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x38aca8(0x75)},'batch_code':{'$first':_0x38aca8(0x140)},'expiry_date':{'$first':_0x38aca8(0x158)},'suppliers_docs':{'$first':_0x38aca8(0x131)},'total_product_quantity':{'$sum':_0x38aca8(0xcc)},'level':{'$addToSet':_0x38aca8(0x138)},'isle':{'$addToSet':_0x38aca8(0x8f)},'type':{'$addToSet':_0x38aca8(0xa7)},'floorlevel':{'$addToSet':_0x38aca8(0x10c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1b0c33=await purchases[_0x38aca8(0xce)]([{'$lookup':{'from':_0x38aca8(0x118),'localField':_0x38aca8(0x118),'foreignField':_0x38aca8(0xd2),'as':_0x38aca8(0xee)}},{'$unwind':_0x38aca8(0x131)},{'$unwind':_0x38aca8(0x105)},{'$group':{'_id':_0x38aca8(0x172),'invoice':{'$first':_0x38aca8(0xa3)},'suppliers':{'$first':_0x38aca8(0xaa)},'date':{'$first':_0x38aca8(0x11f)},'warehouse_name':{'$first':_0x38aca8(0xe4)},'room':{'$addToSet':_0x38aca8(0xac)},'product':{'$push':_0x38aca8(0x105)},'note':{'$first':_0x38aca8(0xf5)},'paid_amount':{'$first':_0x38aca8(0x12d)},'due_amount':{'$first':_0x38aca8(0xd6)},'return_data':{'$first':_0x38aca8(0x75)},'batch_code':{'$first':_0x38aca8(0x140)},'expiry_date':{'$first':_0x38aca8(0x158)},'suppliers_docs':{'$first':_0x38aca8(0x131)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x38aca8(0x138)},'isle':{'$addToSet':_0x38aca8(0x8f)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x38aca8(0x10c)},'finalize':{'$first':_0x38aca8(0x187)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x38415a[0x0][_0x38aca8(0xf0)]==_0x38aca8(0x73)){var _0x277f5f=users['English'];console[_0x38aca8(0x186)](_0x277f5f);}else{if(_0x38415a[0x0]['language']=='Hindi')var _0x277f5f=users[_0x38aca8(0xf9)];else{if(_0x38415a[0x0]['language']==_0x38aca8(0x11c))var _0x277f5f=users[_0x38aca8(0x11c)];else{if(_0x38415a[0x0][_0x38aca8(0xf0)]==_0x38aca8(0x147))var _0x277f5f=users[_0x38aca8(0x147)];else{if(_0x38415a[0x0][_0x38aca8(0xf0)]==_0x38aca8(0xc7))var _0x277f5f=users[_0x38aca8(0xc7)];else{if(_0x38415a[0x0][_0x38aca8(0xf0)]=='Portuguese\x20(BR)')var _0x277f5f=users['Portuguese'];else{if(_0x38415a[0x0][_0x38aca8(0xf0)]==_0x38aca8(0x17a))var _0x277f5f=users['Chinese'];else{if(_0x38415a[0x0]['language']==_0x38aca8(0x6e))var _0x277f5f=users['Arabic'];}}}}}}}_0x2b6b07[_0x38aca8(0x14a)]('all_purchases',{'success':_0x2d6bea[_0x38aca8(0xc3)]('success'),'errors':_0x2d6bea[_0x38aca8(0xc3)]('errors'),'purchases':_0x1b0c33,'role':_0x484ea3,'profile':_0x137f90,'master_shop':_0x38415a,'language':_0x277f5f});}catch(_0x346f8f){console[_0x38aca8(0x186)]('table\x20page',_0x346f8f),_0x2b6b07[_0x38aca8(0x6c)](0xc8)[_0x38aca8(0x12b)]({'message':_0x346f8f[_0x38aca8(0x150)]});}});function a0_0x36bb(){var _0x30bbd3=['product_name','forEach','/view/:id','<html><head><title></title>','logo','</tr>','Chinese','Purchase\x20Mail','product_details','/barcode/:id','<span\x20style=\x22float:\x20right;\x22>','express','$brand','1671498wrvGbC','An\x20error\x20occurred\x20while\x20saving\x20data.','purchase\x20data\x20update\x20successfully','params','/view/return_purchase/:id','log','$finalize','findOne','<tbody\x20style=\x22text-align:\x20center;\x22>','then','return_qty','toString','/../public','341028pnmVlc','random','\x20<>\x20','suppliers_data','<!DOCTYPE\x20html>','1578318eAnewW','production_date','status','/barcode_scanner','Arabic\x20(ae)','\x20Order\x20Date\x20:\x20','</span>','RoomAssign','prod_name','English\x20(US)','RMSEmail','$return_data','here','13583760RQMzng','prod_isle','max_product_unit','currency_placement','staff','24572okvehs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','COLD\x20STORAGE','redirect','getMonth','maxStocks','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_code','4977533tgJHRg','floor','True','Arabic','$product_details.type','Logo.png','../models/all_models','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','back','purchase_quantity','$product.bin','$product_details._id','return_data','nodemailer','path','primary_code','$product_details.rack','edit_purchases_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Room_name','exports','stock_quantity','Email\x20sent\x20successfully','Purchase\x20Return\x20Mail','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','isle','$maxStocks','658058NiCDXb','</tbody>','$invoice','<h5\x20style=\x22text-align:\x20left;\x22>','error','/view/add_purchases','$product.type','Level','getFullYear','$suppliers','standard_unit','$product.room_name','prod_level','save','concat','Rack\x20F','$product_details.expiry_date','find','prod_invoice','foreach\x20newproduct','room_name','prod_secondunit','prod_unit','all','map','$product_details.product_code','/preview/:id','quantity','</div>','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Rack\x20D','image','flash','product_stock','product_cat','POnumber','French','Rack\x20B','gmail','product_code_hide','bay','$product.quantity','batch_code','aggregate','$product_details.primary_code','Error\x20Occurs','Rack\x20A','name','level','$unit','Portuguese\x20(BR)','$due_amount','user','storage','product_list','$product_details','delivery_code','$product_details.product_name','room','invoice','type','/all_purchases/view/','Enclosed','</h5>','$product_details.product_stock','$warehouse_name','Raw\x20Materials','Rack\x20E','role','primary_code_hide','$alertquantity','</head><body>','Return\x20Goods','return_purchase','errors','suppliers_docs','master','language','../middleware/auth','prod_primunit','$product_details.bay','English','$note','\x20</h2>','bin','$secondary_code','Hindi','site_title','2ISglNh','alertQTY','port','\x20Order\x20Number\x20:\x20','$product_details.floorlevel','$product_details.pallet','add_purchases\x20error','</thead>','types','<hr\x20class=\x22my-3\x22>','$product','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','prod_pallet','/all_purchases/view','Paid\x20For\x20Purchase','abs','$product.floorlevel','$primary_code','JO_number','user_id','floorlevel','return_product','password','body','INC-','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','deliverycode','catch','suppliers','Enabled','\x20<\x20wew\x20>\x20','warehouse_name','German','970zKZCWO','slice','$date','Rack\x20C','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_unit','<div>','<tr>','padStart','due_amount','edit_purchases','MaxStocks_data','$product_code','add_purchases','json','secondary_code_hide','$paid_amount','</td>','<h5>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.storage','rak','20ScXGkD','$category','createTransport','$product.bay','actual_uom','/view/add_purchases/:id','success','$product_details.isle','paid_amount','purchase_invoice','date','$batch_code','prod_cat','get','14BUtkLx','getDate','Sales\x20Update\x20successfully','product_code','Spanish','Purchase\x20data\x20added\x20successfully','post','render','product','Portuguese','288AJiYXe','email','stocks','message','prod_qty','$name','all_purchases_barcode','expiry_date','purchases\x20item\x20return\x20successfull','Floor','</body></html>','$expiry_date','An\x20error\x20occurred.','note','DRY\x20STORAGE','findById','delivery_date','filter','$secondary_unit','/upload/','add\x20post','push','<strong>\x20Regards\x20</strong>','$product_details.secondary_code','Purchase\x20Return','$maxProdPerUnit','sendMail','warehouse','prod_Qty','Shelves','$product_details.maxProducts','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.bin','secondary_code','maxperunit','</table>','actual_qty','$_id','currency'];a0_0x36bb=function(){return _0x30bbd3;};return a0_0x36bb();}function BayBinSelected(_0x491d3b,_0x221546){var _0x2503fa=a0_0x1892f6,_0xd0864=[],_0x456880=[],_0x464c85=[],_0x1e11e0=[],_0x59cfe0=[],_0x17def6=[];let _0x31c96e=[];if(_0x491d3b==_0x2503fa(0x15b))switch(_0x221546){case _0x2503fa(0xd1):_0xd0864=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x456880=[0x1,0x2],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8),_0x2503fa(0x156)],_0x59cfe0=['D'],_0x17def6=['A'];break;case _0x2503fa(0xc8):_0xd0864=[0x6,0x5,0x4,0x3,0x2,0x1],_0x456880=[0x1,0x2],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8),_0x2503fa(0x156)],_0x59cfe0=['D'],_0x17def6=['B'];break;case _0x2503fa(0x16a):_0xd0864=[0x0],_0x456880=[0x0],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0x156)],_0x59cfe0=['D'],_0x17def6=['S'];break;case'Receiving\x20Area':_0xd0864=[0x0],_0x456880=[0x0],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x464c85=[_0x2503fa(0x156)],_0x59cfe0=['D'],_0x17def6=['R'];break;}else{if(_0x491d3b==_0x2503fa(0x7e))switch(_0x221546){case _0x2503fa(0xd1):_0xd0864=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x456880=['B','F'],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8),'Floor'],_0x59cfe0=['C'],_0x17def6=['A'];break;case _0x2503fa(0xc8):_0xd0864=[0x5,0x4,0x3,0x2,0x1],_0x456880=['F','B','S'],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8),_0x2503fa(0x156)],_0x59cfe0=['C'],_0x17def6=['B'];break;case _0x2503fa(0x120):_0xd0864=[0x1,0x2,0x3,0x4,0x5],_0x456880=['B','F','S'],_0x1e11e0=[0x5,0x4,0x3,0x2,0x1],_0x464c85=[_0x2503fa(0xa8),'Floor'],_0x59cfe0=['C'],_0x17def6=['C'];break;case _0x2503fa(0xc1):_0xd0864=[0x5,0x4,0x3,0x2,0x1],_0x456880=['F','B','S'],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8),_0x2503fa(0x156)],_0x59cfe0=['C'],_0x17def6=['D'];break;case _0x2503fa(0xe6):_0xd0864=[0x4,0x3,0x2,0x1],_0x456880=[0x1,0x2],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8),'Floor'],_0x59cfe0=['C'],_0x17def6=['E'];break;case _0x2503fa(0xb0):_0xd0864=[0x1,0x2,0x3],_0x456880=[0x1,0x2],_0x1e11e0=[0x1,0x2,0x3,0x4,0x5],_0x464c85=[_0x2503fa(0xa8)],_0x59cfe0=['C'],_0x17def6=['F'];break;}}return{'levels':_0xd0864,'Isle':_0x456880,'rack':_0x1e11e0,'type':_0x464c85,'storage':_0x59cfe0,'rak':_0x17def6};}function a0_0x1e96(_0x39020c,_0x3878ff){var _0x36bb6c=a0_0x36bb();return a0_0x1e96=function(_0x1e96aa,_0x3e3cf4){_0x1e96aa=_0x1e96aa-0x65;var _0x231e0a=_0x36bb6c[_0x1e96aa];return _0x231e0a;},a0_0x1e96(_0x39020c,_0x3878ff);}async function getRandom8DigitNumber(){var _0x1ea500=a0_0x1892f6;const _0x4fdd64=0x989680,_0x1ef3aa=0x5f5e0ff,_0x37ed3b=Math[_0x1ea500(0x85)](Math[_0x1ea500(0x66)]()*(_0x1ef3aa-_0x4fdd64+0x1))+_0x4fdd64;var _0x4a13b4;const _0x4b6afe=await purchases['findOne']({'invoice':'INC-'+_0x37ed3b});return _0x4b6afe&&_0x4b6afe['length']>0x0?_0x4a13b4=_0x1ea500(0x114)+_0x37ed3b:_0x4a13b4=_0x1ea500(0x114)+_0x37ed3b,_0x4a13b4;}router[a0_0x1892f6(0x142)]('/view/add_purchases',auth,async(_0x568c3c,_0x56b454)=>{var _0x28a587=a0_0x1892f6;try{const {username:_0x3c2bdf,email:_0x139cef,role:_0x4ee14c}=_0x568c3c[_0x28a587(0xd7)],_0x303383=_0x568c3c[_0x28a587(0xd7)],_0x4b97c7=await profile[_0x28a587(0x188)]({'email':_0x303383['email']}),_0x3ca1d2=await master_shop[_0x28a587(0xb2)](),_0x1e2d82=await staff[_0x28a587(0x188)]({'email':_0x303383[_0x28a587(0x14e)]}),_0x4830f8=await suppliers['find']({});let _0x335424;if(_0x303383[_0x28a587(0xe7)]==_0x28a587(0x7b)){const _0x5bca4f=await staff[_0x28a587(0x188)]({'email':_0x303383[_0x28a587(0x14e)]});_0x335424=await warehouse['aggregate']([{'$match':{'status':_0x28a587(0x119),'name':_0x5bca4f[_0x28a587(0x168)],'warehouse_category':_0x28a587(0xe5),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x28a587(0x152),'name':{'$first':_0x28a587(0x152)}}}]);}else _0x335424=await warehouse['aggregate']([{'$match':{'status':_0x28a587(0x119),'warehouse_category':_0x28a587(0xe5),'name':{'$ne':_0x28a587(0xeb)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x15beaa=await product['find']({}),_0x3b5fcb=await warehouse[_0x28a587(0xb2)]({'status':_0x28a587(0x119)}),_0x409b82=await purchases[_0x28a587(0xb2)]({}),_0x41db86=_0x409b82[_0x28a587(0xbe)]+0x1,_0xa68e18=_0x28a587(0x114)+_0x41db86[_0x28a587(0x18c)]()[_0x28a587(0x125)](0x5,'0');var _0x1507ab=['Ambient',_0x28a587(0xe1)];if(_0x3ca1d2[0x0]['language']==_0x28a587(0x73))var _0x14fa4f=users['English'];else{if(_0x3ca1d2[0x0]['language']==_0x28a587(0xf9))var _0x14fa4f=users[_0x28a587(0xf9)];else{if(_0x3ca1d2[0x0][_0x28a587(0xf0)]==_0x28a587(0x11c))var _0x14fa4f=users['German'];else{if(_0x3ca1d2[0x0]['language']==_0x28a587(0x147))var _0x14fa4f=users[_0x28a587(0x147)];else{if(_0x3ca1d2[0x0][_0x28a587(0xf0)]==_0x28a587(0xc7))var _0x14fa4f=users[_0x28a587(0xc7)];else{if(_0x3ca1d2[0x0][_0x28a587(0xf0)]=='Portuguese\x20(BR)')var _0x14fa4f=users[_0x28a587(0x14c)];else{if(_0x3ca1d2[0x0]['language']==_0x28a587(0x17a))var _0x14fa4f=users[_0x28a587(0x17a)];else{if(_0x3ca1d2[0x0]['language']=='Arabic\x20(ae)')var _0x14fa4f=users[_0x28a587(0x87)];}}}}}}}const _0x316388=getRandom8DigitNumber();_0x316388['then'](_0x5d5b98=>{var _0x44c81c=_0x28a587;_0x56b454[_0x44c81c(0x14a)](_0x44c81c(0x12a),{'success':_0x568c3c[_0x44c81c(0xc3)](_0x44c81c(0x13b)),'errors':_0x568c3c['flash'](_0x44c81c(0xed)),'role':_0x303383,'profile':_0x4b97c7,'suppliers':_0x4830f8,'warehouse':_0x335424,'product':_0x15beaa,'invoice':_0x5d5b98,'master_shop':_0x3ca1d2,'language':_0x14fa4f,'find_data':_0x3b5fcb,'rooms_data':_0x1507ab});})[_0x28a587(0x117)](_0x3351ce=>{var _0x1e4f17=_0x28a587;_0x568c3c[_0x1e4f17(0xc3)](_0x1e4f17(0xed),_0x1e4f17(0x7d)),_0x56b454['redirect']('/all_purchases/view');});}catch(_0x58283e){console[_0x28a587(0x186)](_0x58283e);}}),router['get'](a0_0x1892f6(0x13a),auth,async(_0x2cb175,_0x34a254)=>{var _0x4329ca=a0_0x1892f6;try{const _0x44d9f9=_0x2cb175['params']['id'];console[_0x4329ca(0x186)](_0x44d9f9);const _0x1fcc4e=await master_shop[_0x4329ca(0xb2)]();console[_0x4329ca(0x186)]('master',_0x1fcc4e);const _0x320118=await product[_0x4329ca(0x188)]({'name':_0x44d9f9});console[_0x4329ca(0x186)](_0x4329ca(0x14b),_0x320118),_0x34a254['status'](0xc8)[_0x4329ca(0x12b)]({'product_data':_0x320118,'master':_0x1fcc4e});}catch(_0xd373f8){console[_0x4329ca(0x186)](_0x4329ca(0x101),_0xd373f8);}}),router[a0_0x1892f6(0x149)](a0_0x1892f6(0xa6),auth,async(_0xc30b67,_0x229c7e)=>{var _0x106f1e=a0_0x1892f6;try{const {invoice:_0x475433,date:_0x1366b3,warehouse_name:_0x1b58ee,prod_name:_0x4e3a92,prod_code:_0x51bba8,prod_qty:_0x9e11b,prod_unit:_0x166ee9,prod_secondunit:_0x1420ae,prod_level:_0x286d5b,prod_isle:_0x62de41,prod_pallet:_0x23fc1d,note:_0x1af772,expiry_date:_0xe664bd,batch_code:_0x5bd7af,payable:_0x3d1ed3,due_amount:_0x51f4ee,Room_name:_0x98a208,primary_code:_0x16f216,secondary_code:_0x4b16b0,MaxStocks_data:_0x591779,PO_number:_0x34b44f,SCRN:_0x43bf9a,JO_number:_0x25c3ea}=_0xc30b67['body'];if(typeof _0x4e3a92==_0x106f1e(0x8b))var _0x3d01af=[_0xc30b67['body'][_0x106f1e(0x72)]],_0x27d861=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x83)]],_0x1df953=[_0xc30b67[_0x106f1e(0x113)]['prod_Qty']],_0x22a8ac=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xf2)]],_0x124edf=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xb6)]],_0x39a94c=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xad)]],_0xc09adc=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x94)]],_0x415ee2=[_0xc30b67[_0x106f1e(0x113)]['secondary_code']],_0x1c01c6=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x128)]],_0x531b39=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xcd)]],_0xa514b3=[_0xc30b67['body'][_0x106f1e(0x154)]],_0x317886=[_0xc30b67['body']['max_product_unit']],_0x13e30b=[_0xc30b67['body'][_0x106f1e(0xfc)]],_0x4f4744=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x6b)]],_0x24778d=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x141)]],_0x4c1b95=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x71)]],_0x28579b=[_0xc30b67['body'][_0x106f1e(0x116)]],_0x22c309=[_0xc30b67['body']['prod_invoice']],_0x1a79e4=[_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x171)]],_0x537425=[_0xc30b67['body']['actual_uom']];else var _0x3d01af=[..._0xc30b67[_0x106f1e(0x113)]['prod_name']],_0x27d861=[..._0xc30b67[_0x106f1e(0x113)]['prod_code']],_0x1df953=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x169)]],_0x22a8ac=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xf2)]],_0x124edf=[..._0xc30b67[_0x106f1e(0x113)]['prod_secondunit']],_0x39a94c=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xad)]],_0xc09adc=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x94)]],_0x415ee2=[..._0xc30b67[_0x106f1e(0x113)]['secondary_code']],_0x1c01c6=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x128)]],_0x531b39=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xcd)]],_0xa514b3=[..._0xc30b67[_0x106f1e(0x113)]['expiry_date']],_0x317886=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x79)]],_0x13e30b=[..._0xc30b67['body'][_0x106f1e(0xfc)]],_0x4f4744=[..._0xc30b67['body'][_0x106f1e(0x6b)]],_0x24778d=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x141)]],_0x4c1b95=[..._0xc30b67[_0x106f1e(0x113)]['RoomAssign']],_0x28579b=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x116)]],_0x22c309=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0xb3)]],_0x1a79e4=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x171)]],_0x537425=[..._0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x139)]];const _0x287f49=_0x3d01af[_0x106f1e(0xb9)](_0x4add00=>{return _0x4add00={'product_name':_0x4add00};});_0x1a79e4['forEach']((_0x20b41a,_0x2a90af)=>{var _0x58e3e6=_0x106f1e;_0x287f49[_0x2a90af][_0x58e3e6(0x171)]=Math[_0x58e3e6(0x10b)](_0x20b41a);}),_0x537425[_0x106f1e(0x175)]((_0x1f9b6f,_0x4a9297)=>{_0x287f49[_0x4a9297]['actual_uom']=_0x1f9b6f;}),_0x27d861['forEach']((_0x2319d1,_0x25a0ca)=>{var _0x581de7=_0x106f1e;_0x287f49[_0x25a0ca][_0x581de7(0x146)]=_0x2319d1;}),_0x1df953['forEach']((_0x25ed36,_0x2bd8e0)=>{var _0x2f4184=_0x106f1e;_0x287f49[_0x2bd8e0][_0x2f4184(0xbc)]=Math[_0x2f4184(0x10b)](_0x25ed36);}),_0x22a8ac[_0x106f1e(0x175)]((_0x524c07,_0x1d32c9)=>{_0x287f49[_0x1d32c9]['standard_unit']=_0x524c07;}),_0x124edf[_0x106f1e(0x175)]((_0x56869d,_0x528ab7)=>{var _0x2d1b39=_0x106f1e;_0x287f49[_0x528ab7][_0x2d1b39(0x122)]=_0x56869d;}),_0x39a94c['forEach']((_0x58f1f3,_0x9ab7ad)=>{var _0x92a96c=_0x106f1e;_0x4c1b95[_0x92a96c(0x175)]((_0x123cc5,_0x2915e9)=>{var _0xb2e168=_0x92a96c;if(_0x123cc5=='Receiving\x20Area'&&_0x9ab7ad==_0x2915e9){console[_0xb2e168(0x186)](_0x123cc5+_0xb2e168(0x11a)+_0x9ab7ad+_0xb2e168(0x67)+_0x2915e9+'\x20<>\x20'+_0x58f1f3);var _0x586bb4=_0x58f1f3[_0xb2e168(0x11e)](0x3);_0x287f49[_0x9ab7ad][_0xb2e168(0xd8)]=_0x58f1f3[0x0],_0x287f49[_0x9ab7ad]['rack']=_0x58f1f3[0x1],_0x287f49[_0x9ab7ad]['bay']=0x0,_0x287f49[_0x9ab7ad][_0xb2e168(0xf7)]=0x0,_0x287f49[_0x9ab7ad][_0xb2e168(0xdf)]='Floor',_0x287f49[_0x9ab7ad][_0xb2e168(0x110)]=_0x586bb4;}else{if(_0x123cc5=='Shelves'&&_0x9ab7ad==_0x2915e9){var _0x586bb4=_0x58f1f3[_0xb2e168(0x11e)](0x3);_0x287f49[_0x9ab7ad][_0xb2e168(0xd8)]=_0x58f1f3[0x0],_0x287f49[_0x9ab7ad][_0xb2e168(0x106)]=_0x58f1f3[0x1],_0x287f49[_0x9ab7ad][_0xb2e168(0xcb)]=0x0,_0x287f49[_0x9ab7ad][_0xb2e168(0xf7)]=0x0,_0x287f49[_0x9ab7ad][_0xb2e168(0xdf)]=_0xb2e168(0x156),_0x287f49[_0x9ab7ad][_0xb2e168(0x110)]=_0x58f1f3[0x5];}else{if(_0x9ab7ad==_0x2915e9){if(_0x58f1f3[0x0]=='A'&&_0x58f1f3[0x1]=='L'&&_0x58f1f3[0x2]=='L')console[_0xb2e168(0x186)](_0x123cc5+_0xb2e168(0x67)+_0x9ab7ad+_0xb2e168(0x67)+_0x2915e9+_0xb2e168(0x67)+_0x58f1f3+_0xb2e168(0x76)),_0x287f49[_0x9ab7ad]['storage']=_0x58f1f3[0x0],_0x287f49[_0x9ab7ad][_0xb2e168(0x106)]=_0x58f1f3[0x1],_0x287f49[_0x9ab7ad][_0xb2e168(0xcb)]=0x0,_0x287f49[_0x9ab7ad][_0xb2e168(0xf7)]=0x0,_0x287f49[_0x9ab7ad][_0xb2e168(0xdf)]=_0xb2e168(0x156),_0x287f49[_0x9ab7ad]['floorlevel']=_0x58f1f3[0x3];else{var _0x18632b;if(_0x58f1f3[0x4]=='L')_0x18632b=_0xb2e168(0xa8);else _0x58f1f3[0x4]=='F'&&(_0x18632b=_0xb2e168(0x156));_0x287f49[_0x9ab7ad][_0xb2e168(0xd8)]=_0x58f1f3[0x0],_0x287f49[_0x9ab7ad][_0xb2e168(0x106)]=_0x58f1f3[0x1],_0x287f49[_0x9ab7ad][_0xb2e168(0xcb)]=_0x58f1f3[0x2],_0x287f49[_0x9ab7ad][_0xb2e168(0xf7)]=_0x58f1f3[0x3],_0x287f49[_0x9ab7ad][_0xb2e168(0xdf)]=_0x18632b,_0x287f49[_0x9ab7ad]['floorlevel']=_0x58f1f3[0x5];}}}}});}),_0xc09adc[_0x106f1e(0x175)]((_0x5042e7,_0x1989c3)=>{_0x287f49[_0x1989c3]['primary_code']=_0x5042e7;}),_0x415ee2[_0x106f1e(0x175)]((_0x2c3953,_0xe4ce1d)=>{var _0x23e104=_0x106f1e;_0x287f49[_0xe4ce1d][_0x23e104(0x16e)]=_0x2c3953;}),_0x1c01c6[_0x106f1e(0x175)]((_0x5e0049,_0x399502)=>{var _0x25ee15=_0x106f1e;_0x287f49[_0x399502][_0x25ee15(0x81)]=_0x5e0049;}),_0x531b39[_0x106f1e(0x175)]((_0x34f23b,_0x7b2498)=>{_0x287f49[_0x7b2498]['batch_code']=_0x34f23b;}),_0xa514b3[_0x106f1e(0x175)]((_0x372c3d,_0x2d73ad)=>{var _0x5584c3=_0x106f1e;_0x287f49[_0x2d73ad][_0x5584c3(0x154)]=_0x372c3d;}),_0x317886[_0x106f1e(0x175)]((_0x201f2e,_0x5f1489)=>{var _0x135be4=_0x106f1e;_0x287f49[_0x5f1489][_0x135be4(0x16f)]=_0x201f2e;}),_0x13e30b[_0x106f1e(0x175)]((_0x825772,_0x89cbd0)=>{var _0x44db1c=_0x106f1e;_0x287f49[_0x89cbd0][_0x44db1c(0xfc)]=_0x825772;}),_0x4f4744[_0x106f1e(0x175)]((_0x58d679,_0x4c739f)=>{var _0x378770=_0x106f1e;_0x287f49[_0x4c739f][_0x378770(0x6b)]=_0x58d679;}),_0x24778d['forEach']((_0xa03d09,_0x516855)=>{var _0x24fdbb=_0x106f1e;_0x287f49[_0x516855][_0x24fdbb(0xc5)]=_0xa03d09;}),_0x4c1b95[_0x106f1e(0x175)]((_0x2cbbde,_0x481cce)=>{var _0x452f48=_0x106f1e;_0x287f49[_0x481cce][_0x452f48(0xb5)]=_0x2cbbde;}),_0x28579b['forEach']((_0x21bc17,_0x345740)=>{_0x287f49[_0x345740]['delivery_code']=_0x21bc17;}),_0x22c309[_0x106f1e(0x175)]((_0x579e3c,_0x25adf1)=>{_0x287f49[_0x25adf1]['invoice']=_0x579e3c;});const _0x4ca94c=_0x4c1b95[_0x106f1e(0xb9)](_0x28063d=>{return _0x28063d={'room_name':_0x28063d};}),_0x1655cd=_0x287f49[_0x106f1e(0x15e)](_0x643d65=>_0x643d65[_0x106f1e(0xbc)]!=='0'&&_0x643d65['quantity']!==''),_0xd44157=new purchases({'invoice':_0x475433,'suppliers':_0xc30b67[_0x106f1e(0x113)][_0x106f1e(0x118)],'date':_0x1366b3,'warehouse_name':_0x1b58ee,'product':_0x1655cd,'note':_0x1af772,'due_amount':_0x51f4ee,'POnumber':_0x34b44f,'SCRN':_0x43bf9a,'JO_number':_0x25c3ea,'roomList':_0x4ca94c}),_0x2c4dcd=await _0xd44157['save'](),_0x39cf16=await purchases[_0x106f1e(0x188)]({'invoice':_0x475433}),_0x18d0c2=_0x39cf16['product']['map'](async _0x167a6f=>{var _0xc89eb=_0x106f1e,_0xf388bf=await warehouse[_0xc89eb(0x188)]({'name':_0x1b58ee,'room':_0x167a6f[_0xc89eb(0xb5)]}),_0x41aff4=0x0;return _0xf388bf[_0xc89eb(0x17c)][_0xc89eb(0x175)](_0x1725a7=>{var _0x2de5d6=_0xc89eb;_0x1725a7[_0x2de5d6(0x174)]==_0x167a6f[_0x2de5d6(0x174)]&&_0x1725a7[_0x2de5d6(0x110)]==_0x167a6f[_0x2de5d6(0x110)]&&_0x1725a7[_0x2de5d6(0xdf)]==_0x167a6f[_0x2de5d6(0xdf)]&&_0x1725a7['bin']==_0x167a6f['bin']&&_0x1725a7[_0x2de5d6(0xcb)]==_0x167a6f[_0x2de5d6(0xcb)]&&_0x1725a7['rack']==_0x167a6f['rack']&&_0x1725a7[_0x2de5d6(0xd8)]==_0x167a6f[_0x2de5d6(0xd8)]&&_0x1725a7[_0x2de5d6(0x154)]==_0x167a6f[_0x2de5d6(0x154)]&&_0x1725a7[_0x2de5d6(0xcd)]==_0x167a6f[_0x2de5d6(0xcd)]&&_0x1725a7[_0x2de5d6(0x6b)]==_0x167a6f[_0x2de5d6(0x6b)]&&_0x1725a7[_0x2de5d6(0xde)]==_0x39cf16['invoice']&&(_0x1725a7[_0x2de5d6(0xc4)]+=Math[_0x2de5d6(0x10b)](_0x167a6f['quantity']),_0x41aff4++);}),_0x41aff4===0x0&&_0xf388bf['product_details'][_0xc89eb(0x162)]({'product_name':_0x167a6f['product_name'],'product_stock':Math[_0xc89eb(0x10b)](_0x167a6f[_0xc89eb(0xbc)]),'primary_code':_0x167a6f['primary_code'],'secondary_code':_0x167a6f['secondary_code'],'product_code':_0x167a6f[_0xc89eb(0x146)],'storage':_0x167a6f[_0xc89eb(0xd8)],'rack':_0x167a6f[_0xc89eb(0x106)],'bay':_0x167a6f[_0xc89eb(0xcb)],'bin':_0x167a6f[_0xc89eb(0xf7)],'type':_0x167a6f[_0xc89eb(0xdf)],'floorlevel':_0x167a6f[_0xc89eb(0x110)],'maxProducts':_0x167a6f[_0xc89eb(0x81)],'unit':_0x167a6f[_0xc89eb(0xab)],'secondary_unit':_0x167a6f[_0xc89eb(0x122)],'expiry_date':_0x167a6f['expiry_date'],'maxPerUnit':_0x167a6f[_0xc89eb(0x16f)],'batch_code':_0x167a6f['batch_code'],'alertQTY':_0x167a6f[_0xc89eb(0xfc)],'production_date':_0x167a6f['production_date'],'product_cat':_0x167a6f['product_cat'],'invoice':_0x167a6f['invoice'],'actual_qty':Math[_0xc89eb(0x10b)](_0x167a6f[_0xc89eb(0x171)]),'actual_uom':_0x167a6f[_0xc89eb(0x139)]}),_0xf388bf;});Promise[_0x106f1e(0xb8)](_0x18d0c2)[_0x106f1e(0x18a)](async _0x4fcca7=>{var _0x4541c1=_0x106f1e;try{for(const _0x2dd86f of _0x4fcca7){await _0x2dd86f['save']();}const _0x47a3c9=await master_shop[_0x4541c1(0xb2)](),_0x30bd28=await email_settings[_0x4541c1(0x188)](),_0xbc320a=await supervisor_settings[_0x4541c1(0xb2)]();var _0xc90344=_0x39cf16[_0x4541c1(0x14b)],_0x5d4b1a='',_0x33118f;for(_0x33118f in _0xc90344){_0x5d4b1a+='<tr>'+_0x4541c1(0x16c)+_0xc90344[_0x33118f]['product_name']+_0x4541c1(0x12e)+_0x4541c1(0x16c)+_0xc90344[_0x33118f][_0x4541c1(0x146)]+_0x4541c1(0x12e)+_0x4541c1(0x16c)+_0xc90344[_0x33118f][_0x4541c1(0xbc)]+_0x4541c1(0x12e)+_0x4541c1(0x16c)+_0xc90344[_0x33118f][_0x4541c1(0xab)]+_0x4541c1(0x12e)+_0x4541c1(0x16c)+_0xc90344[_0x33118f]['secondary_unit']+_0x4541c1(0x12e)+_0x4541c1(0x16c)+_0x39cf16[_0x4541c1(0x11b)]+_0x4541c1(0x12e)+_0x4541c1(0x16c)+_0xc90344[_0x33118f][_0x4541c1(0xb5)]+'</td>'+_0x4541c1(0x16c)+_0xc90344[_0x33118f][_0x4541c1(0xd8)]+_0xc90344[_0x33118f][_0x4541c1(0x106)]+_0xc90344[_0x33118f]['bay']+_0xc90344[_0x33118f][_0x4541c1(0xf7)]+_0xc90344[_0x33118f][_0x4541c1(0xdf)][0x0]+_0xc90344[_0x33118f]['floorlevel']+_0x4541c1(0x12e),_0x4541c1(0x179);}let _0x290d0b=nodemailer[_0x4541c1(0x137)]({'host':_0x30bd28['host'],'port':Number(_0x30bd28[_0x4541c1(0xfd)]),'secure':![],'auth':{'user':_0x30bd28['email'],'pass':_0x30bd28[_0x4541c1(0x112)]}}),_0x553dd2={'from':_0x30bd28[_0x4541c1(0x14e)],'to':_0xbc320a[0x0][_0x4541c1(0x74)],'subject':_0x4541c1(0x17b),'attachments':[{'filename':_0x4541c1(0x89),'path':__dirname+_0x4541c1(0x18d)+_0x4541c1(0x160)+_0x47a3c9[0x0][_0x4541c1(0xc2)],'cid':'logo'}],'html':_0x4541c1(0x69)+'<html><head><title></title>'+_0x4541c1(0xea)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4541c1(0x123)+_0x4541c1(0x82)+_0x4541c1(0xbd)+'<div>'+_0x4541c1(0x9d)+_0x47a3c9[0x0][_0x4541c1(0xfa)]+_0x4541c1(0xf6)+_0x4541c1(0xbd)+_0x4541c1(0xbd)+_0x4541c1(0x104)+_0x4541c1(0x123)+_0x4541c1(0xa4)+_0x4541c1(0xfe)+_0x39cf16[_0x4541c1(0xde)]+'\x20'+_0x4541c1(0x17e)+_0x4541c1(0x6f)+_0x39cf16[_0x4541c1(0x13f)]+'\x20'+_0x4541c1(0x70)+'</h5>'+_0x4541c1(0xbd)+_0x4541c1(0x130)+_0x4541c1(0x121)+'<tr>'+_0x4541c1(0x132)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4541c1(0xbf)+_0x4541c1(0x9e)+_0x4541c1(0x97)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x4541c1(0x8c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x4541c1(0x179)+_0x4541c1(0x102)+_0x4541c1(0x189)+'\x20'+_0x5d4b1a+'\x20'+'</tbody>'+'</table>'+_0x4541c1(0x123)+'<strong>\x20Regards\x20</strong>'+_0x4541c1(0x12f)+_0x47a3c9[0x0][_0x4541c1(0xfa)]+_0x4541c1(0xe2)+_0x4541c1(0xbd)+'</div>'+_0x4541c1(0x157)};_0x290d0b[_0x4541c1(0x167)](_0x553dd2,function(_0x192c06,_0x15bec8){var _0x155134=_0x4541c1;_0x192c06?(console[_0x155134(0x186)](_0x192c06),console[_0x155134(0x186)](_0x155134(0xd0))):console['log']('Email\x20sent\x20successfully');}),_0xc30b67[_0x4541c1(0xc3)](_0x4541c1(0x13b),_0x4541c1(0x148)),_0x229c7e['redirect'](_0x4541c1(0xe0));}catch(_0x662d9c){console[_0x4541c1(0xa5)](_0x662d9c),_0x229c7e[_0x4541c1(0x6c)](0x1f4)[_0x4541c1(0x12b)]({'error':_0x4541c1(0x182)});}})['catch'](_0x492da0=>{var _0x453aef=_0x106f1e;console[_0x453aef(0xa5)](_0x492da0),_0x229c7e['status'](0x1f4)[_0x453aef(0x12b)]({'error':_0x453aef(0x159)});});}catch(_0x24c69a){console[_0x106f1e(0x186)](_0x24c69a);}}),router['get'](a0_0x1892f6(0xbb),auth,async(_0x159f3e,_0xd9762)=>{var _0xb5ed6a=a0_0x1892f6;try{const {username:_0x5cd5ba,email:_0x3614f4,role:_0x2c95d9}=_0x159f3e[_0xb5ed6a(0xd7)],_0x4e8866=_0x159f3e['user'],_0x26ebb0=await profile[_0xb5ed6a(0x188)]({'email':_0x4e8866[_0xb5ed6a(0x14e)]}),_0x2c8629=await master_shop['find'](),_0x3ddf53=_0x159f3e[_0xb5ed6a(0x184)]['id'],_0x3d47da=await purchases[_0xb5ed6a(0x15c)](_0x3ddf53),_0x40f6c0=await warehouse[_0xb5ed6a(0xce)]([{'$match':{'name':_0x3d47da[_0xb5ed6a(0x11b)],'room':_0x3d47da[_0xb5ed6a(0xdd)]}},{'$unwind':_0xb5ed6a(0xda)},{'$group':{'_id':_0xb5ed6a(0x90),'name':{'$first':_0xb5ed6a(0xdc)},'product_stock':{'$first':_0xb5ed6a(0xe3)},'bay':{'$first':_0xb5ed6a(0xf3)},'bin':{'$first':_0xb5ed6a(0x16d)},'type':{'$first':_0xb5ed6a(0x88)},'floorlevel':{'$first':_0xb5ed6a(0xff)},'primary_code':{'$first':_0xb5ed6a(0xcf)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xb5ed6a(0xba)},'storage':{'$first':_0xb5ed6a(0x133)},'rack':{'$first':_0xb5ed6a(0x95)},'expiry_date':{'$first':_0xb5ed6a(0xb1)}}}]),_0xe1145c=await customer['find']({});let _0x53918a;if(_0x4e8866[_0xb5ed6a(0xe7)]==_0xb5ed6a(0x7b)){const _0x281bd8=await staff[_0xb5ed6a(0x188)]({'email':_0x4e8866[_0xb5ed6a(0x14e)]});_0x53918a=await warehouse[_0xb5ed6a(0xce)]([{'$match':{'status':_0xb5ed6a(0x119),'name':_0x281bd8[_0xb5ed6a(0x168)]}},{'$group':{'_id':'$name','name':{'$first':_0xb5ed6a(0x152)}}}]);}else _0x53918a=await warehouse[_0xb5ed6a(0xce)]([{'$match':{'status':_0xb5ed6a(0x119)}},{'$group':{'_id':_0xb5ed6a(0x152),'name':{'$first':_0xb5ed6a(0x152)}}}]);const _0x3540a0=await product[_0xb5ed6a(0xb2)]({}),_0x1d164d=await suppliers[_0xb5ed6a(0xb2)]({}),_0x10f927=BayBinSelected(_0x3d47da[_0xb5ed6a(0x11b)],_0x3d47da[_0xb5ed6a(0xdd)]);if(_0x2c8629[0x0]['language']==_0xb5ed6a(0x73)){var _0x4e2963=users[_0xb5ed6a(0xf4)];console[_0xb5ed6a(0x186)](_0x4e2963);}else{if(_0x2c8629[0x0][_0xb5ed6a(0xf0)]==_0xb5ed6a(0xf9))var _0x4e2963=users[_0xb5ed6a(0xf9)];else{if(_0x2c8629[0x0]['language']=='German')var _0x4e2963=users[_0xb5ed6a(0x11c)];else{if(_0x2c8629[0x0]['language']==_0xb5ed6a(0x147))var _0x4e2963=users['Spanish'];else{if(_0x2c8629[0x0]['language']==_0xb5ed6a(0xc7))var _0x4e2963=users['French'];else{if(_0x2c8629[0x0][_0xb5ed6a(0xf0)]==_0xb5ed6a(0xd5))var _0x4e2963=users['Portuguese'];else{if(_0x2c8629[0x0][_0xb5ed6a(0xf0)]==_0xb5ed6a(0x17a))var _0x4e2963=users['Chinese'];else{if(_0x2c8629[0x0][_0xb5ed6a(0xf0)]==_0xb5ed6a(0x6e))var _0x4e2963=users[_0xb5ed6a(0x87)];}}}}}}}_0xd9762[_0xb5ed6a(0x14a)](_0xb5ed6a(0x96),{'success':_0x159f3e['flash'](_0xb5ed6a(0x13b)),'errors':_0x159f3e[_0xb5ed6a(0xc3)](_0xb5ed6a(0xed)),'role':_0x4e8866,'profile':_0x26ebb0,'customer':_0xe1145c,'warehouse':_0x53918a,'product':_0x40f6c0,'user':_0x3d47da,'master_shop':_0x2c8629,'unit':_0x3540a0,'language':_0x4e2963,'suppliers':_0x1d164d,'dataSelected':_0x10f927});}catch(_0x5860ce){console['log'](_0x5860ce);}}),router[a0_0x1892f6(0x149)](a0_0x1892f6(0xbb),auth,async(_0x255af4,_0x218dfa)=>{var _0x473c03=a0_0x1892f6;try{const _0x536da3=_0x255af4[_0x473c03(0x184)]['id'],{invoice:_0x54a63f,warehouse_name:_0x33cc15,Room_name:_0x23d994}=_0x255af4[_0x473c03(0x113)],_0x108b7a=await warehouse[_0x473c03(0x188)]({'name':_0x33cc15,'room':_0x23d994}),_0x15797e=await purchases['findOne']({'invoice':_0x54a63f});_0x15797e[_0x473c03(0x14b)]['forEach'](_0x144db7=>{var _0x13ab81=_0x473c03,_0x3db988=0x0;const _0x34b6f9=_0x108b7a[_0x13ab81(0x17c)][_0x13ab81(0xb9)](_0x327214=>{var _0x584091=_0x13ab81;_0x327214[_0x584091(0x174)]==_0x144db7[_0x584091(0x174)]&&_0x327214[_0x584091(0x110)]==_0x144db7['floorlevel']&&_0x327214[_0x584091(0xdf)]==_0x144db7[_0x584091(0xdf)]&&_0x327214[_0x584091(0xf7)]==_0x144db7[_0x584091(0xf7)]&&_0x327214[_0x584091(0xcb)]==_0x144db7['bay']&&_0x327214[_0x584091(0x106)]==_0x144db7['rack']&&_0x327214[_0x584091(0xd8)]==_0x144db7['storage']&&_0x327214[_0x584091(0x154)]==_0x144db7[_0x584091(0x154)]&&_0x327214['batch_code']==_0x144db7[_0x584091(0xcd)]&&_0x327214[_0x584091(0x6b)]==_0x144db7[_0x584091(0x6b)]&&_0x327214[_0x584091(0x15d)]==_0x144db7[_0x584091(0x15d)]&&_0x327214[_0x584091(0xdb)]==_0x144db7[_0x584091(0xdb)]&&(_0x327214[_0x584091(0xc4)]=parseInt(_0x327214[_0x584091(0xc4)])+parseInt(_0x144db7[_0x584091(0xbc)]),_0x3db988++);});_0x3db988=='0'&&(_0x108b7a[_0x13ab81(0x17c)]=_0x108b7a[_0x13ab81(0x17c)][_0x13ab81(0xaf)]({'product_name':_0x144db7['product_name'],'product_stock':_0x144db7[_0x13ab81(0xbc)],'primary_code':_0x144db7[_0x13ab81(0x94)],'secondary_code':_0x144db7[_0x13ab81(0x16e)],'product_code':_0x144db7[_0x13ab81(0x146)],'storage':_0x144db7[_0x13ab81(0xd8)],'rack':_0x144db7['rack'],'bay':_0x144db7[_0x13ab81(0xcb)],'bin':_0x144db7[_0x13ab81(0xf7)],'type':_0x144db7['type'],'floorlevel':_0x144db7[_0x13ab81(0x110)],'maxProducts':_0x144db7['maxStocks'],'unit':_0x144db7[_0x13ab81(0xab)],'secondary_unit':_0x144db7[_0x13ab81(0x122)],'expiry_date':_0x144db7[_0x13ab81(0x154)],'maxPerUnit':_0x144db7[_0x13ab81(0x16f)],'batch_code':_0x144db7[_0x13ab81(0xcd)],'alertQTY':_0x144db7['alertQTY'],'production_date':_0x144db7[_0x13ab81(0x6b)],'delivery_date':_0x144db7[_0x13ab81(0x15d)],'delivery_code':_0x144db7[_0x13ab81(0xdb)]}));}),await _0x108b7a[_0x473c03(0xae)](),_0x15797e['finalize']=_0x473c03(0x86);const _0x21db78=await _0x15797e[_0x473c03(0xae)]();_0x255af4['flash'](_0x473c03(0x13b),_0x473c03(0x145)),_0x218dfa[_0x473c03(0x7f)](_0x473c03(0x109));}catch(_0x127967){console[_0x473c03(0x186)](_0x127967);}}),router[a0_0x1892f6(0x142)]('/view/:id',auth,async(_0x1e53bb,_0x4bdaa5)=>{var _0x227cbc=a0_0x1892f6;try{const {username:_0x150f09,email:_0x423e28,role:_0xf109b8}=_0x1e53bb[_0x227cbc(0xd7)],_0x52b0dd=_0x1e53bb[_0x227cbc(0xd7)],_0x732933=await profile['findOne']({'email':_0x52b0dd[_0x227cbc(0x14e)]}),_0x5780e1=await master_shop[_0x227cbc(0xb2)](),_0x5cc06e=_0x1e53bb[_0x227cbc(0x184)]['id'],_0x1be1ad=await purchases[_0x227cbc(0x15c)](_0x5cc06e),_0x5775f7=await suppliers['find']({});let _0x223241;if(_0x52b0dd[_0x227cbc(0xe7)]=='staff'){const _0x4a952b=await staff[_0x227cbc(0x188)]({'email':_0x52b0dd[_0x227cbc(0x14e)]});_0x223241=await warehouse[_0x227cbc(0xb2)]({'status':_0x227cbc(0x119),'name':_0x4a952b[_0x227cbc(0x168)],'warehouse_category':_0x227cbc(0xe5)});}else _0x223241=await warehouse[_0x227cbc(0xce)]([{'$match':{'status':_0x227cbc(0x119),'warehouse_category':_0x227cbc(0xe5)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x4ed317=await product[_0x227cbc(0xb2)]({}),_0x47d280=BayBinSelected(_0x1be1ad[_0x227cbc(0x11b)],_0x1be1ad['room']);let _0x377e85=new Date(_0x1be1ad[_0x227cbc(0x154)]),_0x724b22=('0'+_0x377e85[_0x227cbc(0x144)]())[_0x227cbc(0x11e)](-0x2),_0x291d69=('0'+(_0x377e85[_0x227cbc(0x80)]()+0x1))[_0x227cbc(0x11e)](-0x2),_0x4bbd3e=_0x377e85[_0x227cbc(0xa9)](),_0x1cb477=_0x4bbd3e+'-'+_0x291d69+'-'+_0x724b22;if(_0x5780e1[0x0][_0x227cbc(0xf0)]=='English\x20(US)'){var _0x5eb5a5=users[_0x227cbc(0xf4)];console[_0x227cbc(0x186)](_0x5eb5a5);}else{if(_0x5780e1[0x0][_0x227cbc(0xf0)]==_0x227cbc(0xf9))var _0x5eb5a5=users[_0x227cbc(0xf9)];else{if(_0x5780e1[0x0]['language']=='German')var _0x5eb5a5=users[_0x227cbc(0x11c)];else{if(_0x5780e1[0x0][_0x227cbc(0xf0)]==_0x227cbc(0x147))var _0x5eb5a5=users[_0x227cbc(0x147)];else{if(_0x5780e1[0x0][_0x227cbc(0xf0)]==_0x227cbc(0xc7))var _0x5eb5a5=users[_0x227cbc(0xc7)];else{if(_0x5780e1[0x0]['language']==_0x227cbc(0xd5))var _0x5eb5a5=users['Portuguese'];else{if(_0x5780e1[0x0]['language']=='Chinese')var _0x5eb5a5=users[_0x227cbc(0x17a)];else{if(_0x5780e1[0x0][_0x227cbc(0xf0)]==_0x227cbc(0x6e))var _0x5eb5a5=users[_0x227cbc(0x87)];}}}}}}}_0x4bdaa5[_0x227cbc(0x14a)](_0x227cbc(0x127),{'success':_0x1e53bb[_0x227cbc(0xc3)]('success'),'errors':_0x1e53bb[_0x227cbc(0xc3)](_0x227cbc(0xed)),'role':_0x52b0dd,'profile':_0x732933,'purchases':_0x1be1ad,'suppliers':_0x5775f7,'warehouse':_0x223241,'product':_0x4ed317,'master_shop':_0x5780e1,'language':_0x5eb5a5,'ed_fullDate':_0x1cb477,'dataSelected':_0x47d280});}catch(_0x35d9f1){console[_0x227cbc(0x186)](_0x35d9f1);}}),router['post'](a0_0x1892f6(0x176),auth,async(_0x43b4cb,_0x451bda)=>{var _0x1dcd08=a0_0x1892f6;try{const _0x9fb51a=_0x43b4cb['params']['id'],_0xeb36aa=await purchases[_0x1dcd08(0x188)]({'_id':_0x43b4cb[_0x1dcd08(0x184)]['id']}),_0x46b02d=await warehouse[_0x1dcd08(0x188)]({'name':_0xeb36aa[_0x1dcd08(0x11b)],'room':_0xeb36aa['room']});_0xeb36aa[_0x1dcd08(0x14b)][_0x1dcd08(0x175)](_0x713b6=>{var _0x2ad2b9=_0x1dcd08;const _0x4c9493=_0x46b02d[_0x2ad2b9(0x17c)][_0x2ad2b9(0xb9)](_0x12fb00=>{var _0x57fcfb=_0x2ad2b9;_0x12fb00[_0x57fcfb(0x174)]==_0x713b6[_0x57fcfb(0x174)]&&_0x12fb00['floorlevel']==_0x713b6[_0x57fcfb(0x110)]&&_0x12fb00[_0x57fcfb(0xdf)]==_0x713b6[_0x57fcfb(0xdf)]&&_0x12fb00[_0x57fcfb(0xf7)]==_0x713b6[_0x57fcfb(0xf7)]&&_0x12fb00[_0x57fcfb(0xcb)]==_0x713b6[_0x57fcfb(0xcb)]&&_0x12fb00[_0x57fcfb(0x106)]==_0x713b6['rack']&&_0x12fb00[_0x57fcfb(0xd8)]==_0x713b6[_0x57fcfb(0xd8)]&&(_0x12fb00[_0x57fcfb(0xc4)]=parseInt(_0x12fb00[_0x57fcfb(0xc4)])-parseInt(_0x713b6[_0x57fcfb(0xbc)]));});}),await _0x46b02d[_0x1dcd08(0xae)]();const {invoice:_0x11c507,suppliers:_0xe3dfd6,date:_0x34e5c1,warehouse_name:_0x8b176f,prod_name:_0x259195,prod_code:_0x30ad1b,prod_qty:_0x1140d8,prod_unit:_0x433447,prod_secondunit:_0x17ed4d,prod_level:_0x1b537d,prod_isle:_0x1cb79f,prod_pallet:_0xa494df,note:_0x1c28aa,expiry_date:_0x11e5a8,batch_code:_0x794e77,paid_amount:_0x40a0d2,due_amount:_0x3d45bd,Room_name:_0x251f00,primary_code:_0x4118c6,secondary_code:_0x1b7fd2,PO_number:_0x3050bc,JO_number:_0xec776e}=_0x43b4cb[_0x1dcd08(0x113)];if(typeof _0x259195==_0x1dcd08(0x8b))var _0x4f8f49=[_0x43b4cb[_0x1dcd08(0x113)]['prod_name']],_0x202b71=[_0x43b4cb['body'][_0x1dcd08(0x83)]],_0x4925cd=[_0x43b4cb['body'][_0x1dcd08(0x151)]],_0x4533ce=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xb7)]],_0x25a848=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xb6)]],_0x461386=[_0x43b4cb[_0x1dcd08(0x113)]['prod_level']],_0x5666b9=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x78)]],_0xb65772=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x108)]],_0x333845=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x94)]],_0x1fe302=[_0x43b4cb['body'][_0x1dcd08(0x16e)]],_0x3eb72a=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x128)]],_0x1fadc3=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xcd)]],_0x137cb1=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x154)]],_0x1fa8e0=[_0x43b4cb['body']['storage']],_0x1527a1=[_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x134)]],_0x44505e=[_0x43b4cb[_0x1dcd08(0x113)]['type']];else var _0x4f8f49=[..._0x43b4cb['body'][_0x1dcd08(0x72)]],_0x202b71=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x83)]],_0x4925cd=[..._0x43b4cb['body'][_0x1dcd08(0x151)]],_0x4533ce=[..._0x43b4cb[_0x1dcd08(0x113)]['prod_unit']],_0x25a848=[..._0x43b4cb[_0x1dcd08(0x113)]['prod_secondunit']],_0x461386=[..._0x43b4cb['body'][_0x1dcd08(0xad)]],_0x5666b9=[..._0x43b4cb['body']['prod_isle']],_0xb65772=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x108)]],_0x333845=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x94)]],_0x1fe302=[..._0x43b4cb['body'][_0x1dcd08(0x16e)]],_0x3eb72a=[..._0x43b4cb['body'][_0x1dcd08(0x128)]],_0x1fadc3=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xcd)]],_0x137cb1=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x154)]],_0x1fa8e0=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xd8)]],_0x1527a1=[..._0x43b4cb[_0x1dcd08(0x113)]['rak']],_0x44505e=[..._0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xdf)]];const _0x11aaca=_0x4f8f49['map'](_0x37cbe9=>{return _0x37cbe9={'product_name':_0x37cbe9};});_0x202b71['forEach']((_0x197c59,_0x334a8f)=>{_0x11aaca[_0x334a8f]['product_code']=_0x197c59;}),_0x4925cd[_0x1dcd08(0x175)]((_0x48622f,_0x276c0d)=>{var _0x50314d=_0x1dcd08;_0x11aaca[_0x276c0d][_0x50314d(0xbc)]=_0x48622f;}),_0x4533ce['forEach']((_0x1a927b,_0x4b7676)=>{_0x11aaca[_0x4b7676]['standard_unit']=_0x1a927b;}),_0x25a848['forEach']((_0x28d4b0,_0x3f2703)=>{var _0x643dc9=_0x1dcd08;_0x11aaca[_0x3f2703][_0x643dc9(0x122)]=_0x28d4b0;}),_0x461386[_0x1dcd08(0x175)]((_0x93d4a4,_0x8da041)=>{var _0x476884=_0x1dcd08;_0x11aaca[_0x8da041][_0x476884(0xcb)]=_0x93d4a4;}),_0x5666b9[_0x1dcd08(0x175)]((_0x3a342d,_0x20c8a3)=>{var _0x588bf1=_0x1dcd08;_0x11aaca[_0x20c8a3][_0x588bf1(0xf7)]=_0x3a342d;}),_0xb65772[_0x1dcd08(0x175)]((_0x4e3bf9,_0x381926)=>{var _0x12f5df=_0x1dcd08;_0x11aaca[_0x381926][_0x12f5df(0x110)]=_0x4e3bf9;}),_0x333845[_0x1dcd08(0x175)]((_0x1b5ca0,_0x1133cc)=>{var _0x39964d=_0x1dcd08;_0x11aaca[_0x1133cc][_0x39964d(0x94)]=_0x1b5ca0;}),_0x1fe302[_0x1dcd08(0x175)]((_0x38f0e8,_0x37c099)=>{var _0xcee3c2=_0x1dcd08;_0x11aaca[_0x37c099][_0xcee3c2(0x16e)]=_0x38f0e8;}),_0x3eb72a[_0x1dcd08(0x175)]((_0x23f439,_0x30d38e)=>{var _0x5b27fa=_0x1dcd08;_0x11aaca[_0x30d38e][_0x5b27fa(0x81)]=_0x23f439;}),_0x1fadc3[_0x1dcd08(0x175)]((_0x2d9750,_0xab33b3)=>{var _0x2c1c48=_0x1dcd08;_0x11aaca[_0xab33b3][_0x2c1c48(0xcd)]=_0x2d9750;}),_0x137cb1[_0x1dcd08(0x175)]((_0x280cca,_0x3f11d3)=>{var _0x285b77=_0x1dcd08;_0x11aaca[_0x3f11d3][_0x285b77(0x154)]=_0x280cca;}),_0x44505e['forEach']((_0xff275e,_0x35bba4)=>{_0x11aaca[_0x35bba4]['type']=_0xff275e;}),_0x1fa8e0[_0x1dcd08(0x175)]((_0x569efb,_0xd77f16)=>{var _0x22b802=_0x1dcd08;_0x11aaca[_0xd77f16][_0x22b802(0xd8)]=_0x569efb;}),_0x1527a1[_0x1dcd08(0x175)]((_0x4aaa2d,_0x2f831e)=>{var _0x346c45=_0x1dcd08;_0x11aaca[_0x2f831e][_0x346c45(0x106)]=_0x4aaa2d;});const _0x478e52=_0x11aaca['filter'](_0x43a7d4=>_0x43a7d4['quantity']!=='0'&&_0x43a7d4[_0x1dcd08(0xbc)]!=='');_0xeb36aa['invoice']=_0x11c507,_0xeb36aa[_0x1dcd08(0x118)]=_0xe3dfd6,_0xeb36aa[_0x1dcd08(0x13f)]=_0x34e5c1,_0xeb36aa[_0x1dcd08(0x11b)]=_0x8b176f,_0xeb36aa[_0x1dcd08(0x14b)]=_0x478e52,_0xeb36aa[_0x1dcd08(0x15a)]=_0x1c28aa,_0xeb36aa[_0x1dcd08(0x13d)]=_0x40a0d2,_0xeb36aa[_0x1dcd08(0x126)]=_0x3d45bd,_0xeb36aa[_0x1dcd08(0xdd)]=_0x251f00,_0xeb36aa[_0x1dcd08(0xc6)]=_0x3050bc,_0xeb36aa[_0x1dcd08(0x10e)]=_0xec776e;const _0x9cf24d=await _0xeb36aa[_0x1dcd08(0xae)](),_0x4f85b2=await warehouse[_0x1dcd08(0x188)]({'name':_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x11b)],'room':_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0x98)]});_0xeb36aa[_0x1dcd08(0x14b)][_0x1dcd08(0x175)](_0x1ed964=>{var _0x3bc275=_0x1dcd08,_0x2109e3=0x0;const _0x112501=_0x4f85b2[_0x3bc275(0x17c)][_0x3bc275(0xb9)](_0x24991d=>{var _0x55d0f1=_0x3bc275;_0x24991d['product_name']==_0x1ed964[_0x55d0f1(0x174)]&&_0x24991d['floorlevel']==_0x1ed964[_0x55d0f1(0x110)]&&_0x24991d[_0x55d0f1(0xdf)]==_0x1ed964['type']&&_0x24991d[_0x55d0f1(0xf7)]==_0x1ed964['bin']&&_0x24991d['bay']==_0x1ed964[_0x55d0f1(0xcb)]&&_0x24991d[_0x55d0f1(0x106)]==_0x1ed964['rack']&&_0x24991d[_0x55d0f1(0xd8)]==_0x1ed964[_0x55d0f1(0xd8)]&&(_0x24991d[_0x55d0f1(0xc4)]=parseInt(_0x24991d[_0x55d0f1(0xc4)])+parseInt(_0x1ed964[_0x55d0f1(0xbc)]),_0x2109e3++);});_0x2109e3=='0'&&(_0x4f85b2[_0x3bc275(0x17c)]=_0x4f85b2[_0x3bc275(0x17c)]['concat']({'product_name':_0x1ed964['product_name'],'product_stock':_0x1ed964[_0x3bc275(0xbc)],'primary_code':_0x1ed964[_0x3bc275(0x94)],'secondary_code':_0x1ed964['secondary_code'],'product_code':_0x1ed964['product_code'],'storage':_0x1ed964[_0x3bc275(0xd8)],'rack':_0x1ed964['rack'],'bay':_0x1ed964['bay'],'bin':_0x1ed964['bin'],'type':_0x1ed964['type'],'floorlevel':_0x1ed964[_0x3bc275(0x110)],'maxProducts':_0x1ed964[_0x3bc275(0x81)],'unit':_0x1ed964['standard_unit'],'secondary_unit':_0x1ed964[_0x3bc275(0x122)],'expiry_date':_0x1ed964[_0x3bc275(0x154)]}));}),await _0x4f85b2[_0x1dcd08(0xae)]();const _0x20767d=await s_payment_data[_0x1dcd08(0x188)]({'invoice':_0x43b4cb[_0x1dcd08(0x113)][_0x1dcd08(0xde)]});if(_0x20767d===null){}else console[_0x1dcd08(0x186)](_0x1dcd08(0x118),_0x20767d,_0x43b4cb[_0x1dcd08(0x113)]['invoice']),_0x20767d['suppliers']=_0x43b4cb[_0x1dcd08(0x113)]['suppliers'],await _0x20767d[_0x1dcd08(0xae)]();_0x43b4cb[_0x1dcd08(0xc3)]('success',_0x1dcd08(0x183)),_0x451bda[_0x1dcd08(0x7f)]('/all_purchases/view');}catch(_0x3fc1e0){console['log'](_0x3fc1e0);}}),router['post']('/give_payment/:id',auth,async(_0x3db516,_0x5ec334)=>{var _0x4fabb1=a0_0x1892f6;try{const _0x13c25c=_0x3db516[_0x4fabb1(0x184)]['id'],{invoice:_0x3771a2,suppliers:_0x2b7c57,payable:_0x137042,due_amount:_0x44759a}=_0x3db516[_0x4fabb1(0x113)],_0x109841=await purchases[_0x4fabb1(0x15c)](_0x13c25c);var _0x1fa42e=_0x137042-_0x44759a;_0x109841[_0x4fabb1(0x13d)]=parseFloat(_0x109841[_0x4fabb1(0x13d)])+parseFloat(_0x44759a),_0x109841['due_amount']=_0x1fa42e;const _0x4ab244=await _0x109841[_0x4fabb1(0xae)]();console[_0x4fabb1(0x186)](_0x4ab244);const _0x1d2e30=await s_payment_data[_0x4fabb1(0x188)]({'invoice':_0x3771a2});_0x1d2e30['amount']=_0x1fa42e,await _0x1d2e30[_0x4fabb1(0xae)]();let _0x396b20=new Date(),_0x10b7c8=('0'+_0x396b20['getDate']())[_0x4fabb1(0x11e)](-0x2),_0x1317ca=('0'+(_0x396b20[_0x4fabb1(0x80)]()+0x1))[_0x4fabb1(0x11e)](-0x2),_0x394d46=_0x396b20[_0x4fabb1(0xa9)](),_0x1b33f8=_0x394d46+'-'+_0x1317ca+'-'+_0x10b7c8;const _0xe56bdf=new suppliers_payment({'invoice':_0x3771a2,'date':_0x394d46+'-'+_0x1317ca+'-'+_0x10b7c8,'suppliers':_0x2b7c57,'reason':_0x4fabb1(0x10a),'amount':_0x44759a}),_0x2fb051=await _0xe56bdf[_0x4fabb1(0xae)]();_0x3db516[_0x4fabb1(0xc3)](_0x4fabb1(0x13b),'payment\x20successfull'),_0x5ec334[_0x4fabb1(0x7f)]('/all_purchases/view');}catch(_0x4462de){console[_0x4fabb1(0x186)](_0x4462de);}}),router[a0_0x1892f6(0x142)]('/invoice/:id',auth,async(_0x5efc5b,_0x297e26)=>{var _0x2c4fc3=a0_0x1892f6;try{const {username:_0xbbf1fa,email:_0x4899f2,role:_0x8ea8fb}=_0x5efc5b[_0x2c4fc3(0xd7)],_0x190a45=_0x5efc5b[_0x2c4fc3(0xd7)],_0x46b81f=await profile[_0x2c4fc3(0x188)]({'email':_0x190a45[_0x2c4fc3(0x14e)]}),_0x1fddba=await master_shop[_0x2c4fc3(0xb2)]();console[_0x2c4fc3(0x186)]('master',_0x1fddba);const _0x1aafcb=_0x5efc5b[_0x2c4fc3(0x184)]['id'],_0x5e29b3=await purchases[_0x2c4fc3(0x15c)](_0x1aafcb);console['log'](_0x5e29b3);const _0x1d098a=await suppliers[_0x2c4fc3(0x188)]({'name':_0x5e29b3['suppliers']});console['log'](_0x1d098a);if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]==_0x2c4fc3(0x73)){var _0x257c48=users['English'];console[_0x2c4fc3(0x186)](_0x257c48);}else{if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]==_0x2c4fc3(0xf9))var _0x257c48=users[_0x2c4fc3(0xf9)];else{if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]=='German')var _0x257c48=users['German'];else{if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]==_0x2c4fc3(0x147))var _0x257c48=users['Spanish'];else{if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]==_0x2c4fc3(0xc7))var _0x257c48=users[_0x2c4fc3(0xc7)];else{if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]==_0x2c4fc3(0xd5))var _0x257c48=users[_0x2c4fc3(0x14c)];else{if(_0x1fddba[0x0]['language']==_0x2c4fc3(0x17a))var _0x257c48=users[_0x2c4fc3(0x17a)];else{if(_0x1fddba[0x0][_0x2c4fc3(0xf0)]==_0x2c4fc3(0x6e))var _0x257c48=users['Arabic'];}}}}}}}_0x297e26['render'](_0x2c4fc3(0x13e),{'success':_0x5efc5b[_0x2c4fc3(0xc3)]('success'),'errors':_0x5efc5b['flash']('errors'),'role':_0x190a45,'profile':_0x46b81f,'master_shop':_0x1fddba,'supplier':_0x1d098a,'purchase':_0x5e29b3,'language':_0x257c48});}catch(_0x4ec444){console[_0x2c4fc3(0x186)](_0x4ec444);}}),router[a0_0x1892f6(0x142)]('/view/return_purchase/:id',auth,async(_0x3f2418,_0xd6dd45)=>{var _0x3eb158=a0_0x1892f6;try{const {username:_0x4cb108,email:_0x49f693,role:_0x5c180d}=_0x3f2418[_0x3eb158(0xd7)],_0x21e6cd=_0x3f2418[_0x3eb158(0xd7)],_0x2a27d0=await profile[_0x3eb158(0x188)]({'email':_0x21e6cd['email']}),_0x2acd5a=await master_shop[_0x3eb158(0xb2)]();console[_0x3eb158(0x186)](_0x3eb158(0xef),_0x2acd5a);const _0x59cf3d=_0x3f2418[_0x3eb158(0x184)]['id'];console[_0x3eb158(0x186)](_0x59cf3d);const _0x168253=await purchases['findById'](_0x59cf3d);console[_0x3eb158(0x186)](_0x3eb158(0x10f),_0x168253);const _0x1b4c41=await product[_0x3eb158(0xb2)]({}),_0x5b9107=await warehouse[_0x3eb158(0xce)]([{'$match':{'name':_0x168253['warehouse_name'],'room':_0x168253[_0x3eb158(0xdd)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x3eb158(0xda)},{'$group':{'_id':_0x3eb158(0x90),'name':{'$first':_0x3eb158(0xdc)},'product_stock':{'$first':_0x3eb158(0xe3)},'bay':{'$first':_0x3eb158(0xf3)},'bin':{'$first':_0x3eb158(0x16d)},'type':{'$first':_0x3eb158(0x88)},'floorlevel':{'$first':_0x3eb158(0xff)},'primary_code':{'$first':_0x3eb158(0xcf)},'secondary_code':{'$first':_0x3eb158(0x164)},'product_code':{'$first':_0x3eb158(0xba)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x3eb158(0xeb),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3eb158(0x152),'name':{'$first':_0x3eb158(0x152)}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0x5b9107);if(_0x2acd5a[0x0]['language']=='English\x20(US)'){var _0x53faf7=users[_0x3eb158(0xf4)];console['log'](_0x53faf7);}else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]==_0x3eb158(0xf9))var _0x53faf7=users[_0x3eb158(0xf9)];else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]=='German')var _0x53faf7=users['German'];else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]==_0x3eb158(0x147))var _0x53faf7=users[_0x3eb158(0x147)];else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]==_0x3eb158(0xc7))var _0x53faf7=users[_0x3eb158(0xc7)];else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]==_0x3eb158(0xd5))var _0x53faf7=users[_0x3eb158(0x14c)];else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]==_0x3eb158(0x17a))var _0x53faf7=users[_0x3eb158(0x17a)];else{if(_0x2acd5a[0x0][_0x3eb158(0xf0)]==_0x3eb158(0x6e))var _0x53faf7=users['Arabic'];}}}}}}}_0xd6dd45[_0x3eb158(0x14a)](_0x3eb158(0xec),{'success':_0x3f2418[_0x3eb158(0xc3)]('success'),'errors':_0x3f2418[_0x3eb158(0xc3)](_0x3eb158(0xed)),'role':_0x21e6cd,'profile':_0x2a27d0,'user':_0x168253,'stock':_0x5b9107,'master_shop':_0x2acd5a,'product':_0x1b4c41,'language':_0x53faf7,'warehouse':warehouse_data});}catch(_0x14ad78){console['log'](_0x14ad78);}}),router[a0_0x1892f6(0x149)](a0_0x1892f6(0x185),auth,async(_0x31eedd,_0xc7b619)=>{var _0x16b983=a0_0x1892f6;try{const {invoice:_0x1882d8,date:_0x424783,warehouse_name:_0x4765c4,Room_name:_0x5375b7,product_name:_0xfdcd21,purchase_quantity:_0x62bb96,stocks:_0x423ef0,return_qty:_0x1c15f3,note:_0x47c5b7,level:_0x40b99f,isle:_0x4a0a93,pallet:_0x28b274,to_warehouse_name:_0x35f12b,to_Room_name:_0x391790}=_0x31eedd[_0x16b983(0x113)],_0x14f6cc=await purchases[_0x16b983(0x188)]({'_id':_0x31eedd[_0x16b983(0x184)]['id']}),_0x1f5b4d=await warehouse[_0x16b983(0x188)]({'name':_0x4765c4,'room':_0x5375b7});if(typeof _0xfdcd21=='string')var _0x5594d1=[_0x31eedd[_0x16b983(0x113)]['product_name']],_0x8919d7=[_0x31eedd[_0x16b983(0x113)][_0x16b983(0x8e)]],_0x916e28=[_0x31eedd[_0x16b983(0x113)]['stocks']],_0x1a53f7=[_0x31eedd[_0x16b983(0x113)][_0x16b983(0x18b)]],_0x3f4970=[_0x31eedd[_0x16b983(0x113)][_0x16b983(0xd3)]],_0x5550a2=[_0x31eedd[_0x16b983(0x113)][_0x16b983(0x9f)]],_0xe8724=[_0x31eedd[_0x16b983(0x113)]['pallet']],_0x13aea3=[_0x31eedd[_0x16b983(0x113)]['types']],_0x35bba1=[_0x31eedd[_0x16b983(0x113)][_0x16b983(0xca)]],_0x4ac2a7=[_0x31eedd[_0x16b983(0x113)][_0x16b983(0xe8)]],_0x47a0a2=[_0x31eedd['body'][_0x16b983(0x12c)]];else var _0x5594d1=[..._0x31eedd['body'][_0x16b983(0x174)]],_0x8919d7=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0x8e)]],_0x916e28=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0x14f)]],_0x1a53f7=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0x18b)]],_0x3f4970=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0xd3)]],_0x5550a2=[..._0x31eedd['body'][_0x16b983(0x9f)]],_0xe8724=[..._0x31eedd['body']['pallet']],_0x13aea3=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0x103)]],_0x35bba1=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0xca)]],_0x4ac2a7=[..._0x31eedd['body'][_0x16b983(0xe8)]],_0x47a0a2=[..._0x31eedd[_0x16b983(0x113)][_0x16b983(0x12c)]];const _0x2ba72d=_0x5594d1['map'](_0x39ea2b=>{return _0x39ea2b={'product_name':_0x39ea2b};});_0x8919d7['forEach']((_0x1385fe,_0x51077e)=>{var _0xbc7d88=_0x16b983;_0x2ba72d[_0x51077e][_0xbc7d88(0x8e)]=_0x1385fe;}),_0x916e28[_0x16b983(0x175)]((_0x43b298,_0x243df6)=>{_0x2ba72d[_0x243df6]['stock_quantity']=_0x43b298;}),_0x1a53f7[_0x16b983(0x175)]((_0x18f5e5,_0xf79cfe)=>{var _0x1baa78=_0x16b983;_0x2ba72d[_0xf79cfe][_0x1baa78(0x18b)]=_0x18f5e5;}),_0x3f4970[_0x16b983(0x175)]((_0x42cb5d,_0xfbcf47)=>{_0x2ba72d[_0xfbcf47]['bay']=_0x42cb5d;}),_0x5550a2[_0x16b983(0x175)]((_0x47a00e,_0x3ceb10)=>{var _0x2c259e=_0x16b983;_0x2ba72d[_0x3ceb10][_0x2c259e(0xf7)]=_0x47a00e;}),_0xe8724[_0x16b983(0x175)]((_0x41aaab,_0x44d7c3)=>{_0x2ba72d[_0x44d7c3]['floorlevel']=_0x41aaab;}),_0x13aea3[_0x16b983(0x175)]((_0x341728,_0x445ba5)=>{var _0x59167a=_0x16b983;_0x2ba72d[_0x445ba5][_0x59167a(0xdf)]=_0x341728;}),_0x35bba1[_0x16b983(0x175)]((_0x20f9ef,_0x12a175)=>{var _0x55aa64=_0x16b983;_0x2ba72d[_0x12a175][_0x55aa64(0x146)]=_0x20f9ef;}),_0x4ac2a7[_0x16b983(0x175)]((_0x2b2f6a,_0xb8c891)=>{var _0x48cd87=_0x16b983;_0x2ba72d[_0xb8c891][_0x48cd87(0x94)]=_0x2b2f6a;}),_0x47a0a2[_0x16b983(0x175)]((_0x1e5628,_0x41b125)=>{var _0x1bc107=_0x16b983;_0x2ba72d[_0x41b125][_0x1bc107(0x16e)]=_0x1e5628;}),_0x14f6cc[_0x16b983(0x14b)][_0x16b983(0x175)](_0x2b6151=>{const _0x95c129=_0x1f5b4d['product_details']['map'](_0x25e959=>{var _0x46cced=a0_0x1e96;_0x25e959[_0x46cced(0x174)]==_0x2b6151['product_name']&&_0x25e959['floorlevel']==_0x2b6151[_0x46cced(0x110)]&&_0x25e959[_0x46cced(0xdf)]==_0x2b6151['type']&&_0x25e959[_0x46cced(0xf7)]==_0x2b6151['bin']&&_0x25e959[_0x46cced(0xcb)]==_0x2b6151[_0x46cced(0xcb)]&&_0x25e959[_0x46cced(0x106)]==_0x2b6151['rack']&&_0x25e959[_0x46cced(0xd8)]==_0x2b6151[_0x46cced(0xd8)]&&(console['log'](parseInt(_0x25e959['product_stock'])+_0x46cced(0x67)+parseInt(_0x2b6151[_0x46cced(0xbc)])),_0x25e959[_0x46cced(0xc4)]=parseInt(_0x25e959[_0x46cced(0xc4)])+parseInt(_0x2b6151[_0x46cced(0xbc)]));});}),await _0x1f5b4d[_0x16b983(0xae)]();const _0x1f987f=_0x2ba72d['filter'](_0x40c0fc=>_0x40c0fc[_0x16b983(0x18b)]!=='0'&&_0x40c0fc[_0x16b983(0x18b)]!=='');var _0x529f4d=0x0;_0x1f987f[_0x16b983(0x175)](_0x44c01b=>{var _0x59a8ff=_0x16b983;console['log'](_0x59a8ff(0xb4),_0x44c01b),(parseInt(_0x44c01b[_0x59a8ff(0x8e)])<parseInt(_0x44c01b[_0x59a8ff(0x18b)])||parseInt(_0x44c01b[_0x59a8ff(0x9a)])<parseInt(_0x44c01b[_0x59a8ff(0x18b)]))&&_0x529f4d++;});if(_0x529f4d!=0x0)return _0x31eedd[_0x16b983(0xc3)](_0x16b983(0xed),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0xc7b619['redirect'](_0x16b983(0x8d));const _0x54edb2=new purchases_return({'invoice':_0x1882d8,'suppliers':_0x31eedd[_0x16b983(0x113)][_0x16b983(0x118)],'date':_0x424783,'warehouse_name':_0x4765c4,'return_product':_0x1f987f,'note':_0x47c5b7,'room':_0x5375b7,'to_warehouse_name':_0x35f12b,'to_room':_0x391790}),_0x5b3103=await _0x54edb2[_0x16b983(0xae)]();console[_0x16b983(0x186)](_0x54edb2);const _0x2259ad=await purchases_return['findOne']({'invoice':_0x1882d8}),_0x299b91=await warehouse[_0x16b983(0x188)]({'name':_0x35f12b,'room':_0x391790});_0x2259ad[_0x16b983(0x111)][_0x16b983(0x175)](_0x40e9af=>{var _0x49c9ac=_0x16b983,_0x175506=0x0;const _0x201622=_0x299b91['product_details']['map'](_0x362e33=>{var _0x20dcca=a0_0x1e96;_0x362e33[_0x20dcca(0x174)]==_0x40e9af[_0x20dcca(0x174)]&&_0x362e33[_0x20dcca(0x110)]==_0x40e9af[_0x20dcca(0x110)]&&_0x362e33[_0x20dcca(0xdf)]==_0x40e9af[_0x20dcca(0xdf)]&&_0x362e33['bin']==_0x40e9af[_0x20dcca(0xf7)]&&_0x362e33[_0x20dcca(0xcb)]==_0x40e9af[_0x20dcca(0xcb)]&&(_0x362e33[_0x20dcca(0xc4)]=parseInt(_0x362e33['product_stock'])-parseInt(_0x40e9af[_0x20dcca(0x18b)]),_0x175506++);});_0x175506=='0'&&(_0x299b91[_0x49c9ac(0x17c)]=_0x299b91[_0x49c9ac(0x17c)]['concat']({'product_name':_0x40e9af[_0x49c9ac(0x174)],'product_stock':_0x40e9af['return_qty'],'primary_code':_0x40e9af[_0x49c9ac(0x94)],'secondary_code':_0x40e9af['secondary_code'],'product_code':_0x40e9af[_0x49c9ac(0x146)],'storage':_0x40e9af[_0x49c9ac(0xd8)],'rack':_0x40e9af[_0x49c9ac(0x106)],'bay':_0x40e9af[_0x49c9ac(0xcb)],'bin':_0x40e9af[_0x49c9ac(0xf7)],'type':_0x40e9af[_0x49c9ac(0xdf)],'floorlevel':_0x40e9af['floorlevel'],'maxProducts':_0x40e9af[_0x49c9ac(0x81)],'unit':_0x40e9af['standard_unit'],'secondary_unit':_0x40e9af[_0x49c9ac(0x122)],'expiry_date':_0x40e9af[_0x49c9ac(0x154)]}));}),await _0x299b91['save']();const _0x18634f=await purchases[_0x16b983(0x188)]({'invoice':_0x1882d8});_0x18634f[_0x16b983(0x91)]=_0x16b983(0x86);const _0x48233c=await _0x18634f[_0x16b983(0xae)](),_0x16ac4b=new s_payment_data({'invoice':_0x1882d8,'suppliers':_0x31eedd[_0x16b983(0x113)][_0x16b983(0x118)],'reason':_0x16b983(0x165)});await _0x16ac4b[_0x16b983(0xae)]();const _0x1597c1=await master_shop[_0x16b983(0xb2)]();console[_0x16b983(0x186)](_0x16b983(0x161),_0x1597c1[0x0]['image']);const _0x270006=await email_settings[_0x16b983(0x188)](),_0xda37b0=await suppliers['findOne']({'name':_0x31eedd[_0x16b983(0x113)]['suppliers']});console[_0x16b983(0x186)](_0x16b983(0x68),_0xda37b0);_0x1597c1[0x0][_0x16b983(0x7a)]==0x1?(right_currency=_0x1597c1[0x0][_0x16b983(0x173)],left_currency=''):(right_currency='',left_currency=_0x1597c1[0x0]['currency']);var _0x362774=_0x5594d1,_0x1d8d10=_0x1a53f7,_0x14effb='',_0x168dd5;for(_0x168dd5 in _0x362774){_0x14effb+='<tr>'+_0x16b983(0x16c)+_0x362774[_0x168dd5]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d8d10[_0x168dd5]+_0x16b983(0x12e)+_0x16b983(0x179);}console[_0x16b983(0x186)](_0x16b983(0xd9),_0x14effb);let _0x22046c=nodemailer[_0x16b983(0x137)]({'service':_0x16b983(0xc9),'auth':{'user':_0x270006[_0x16b983(0x14e)],'pass':_0x270006[_0x16b983(0x112)]}}),_0x2c2999={'from':_0x270006[_0x16b983(0x14e)],'to':_0xda37b0['email'],'subject':_0x16b983(0x9c),'attachments':[{'filename':_0x16b983(0x89),'path':__dirname+'/../public'+_0x16b983(0x160)+_0x1597c1[0x0][_0x16b983(0xc2)],'cid':_0x16b983(0x178)}],'html':_0x16b983(0x69)+_0x16b983(0x177)+_0x16b983(0xea)+'<div>'+_0x16b983(0x115)+_0x16b983(0x123)+_0x16b983(0x82)+'</div>'+_0x16b983(0x123)+_0x16b983(0x9d)+_0x1597c1[0x0][_0x16b983(0xfa)]+_0x16b983(0xf6)+'</div>'+_0x16b983(0xbd)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x16b983(0xa4)+_0x16b983(0xfe)+_0x1882d8+'\x20'+_0x16b983(0x17e)+_0x16b983(0x6f)+_0x424783+'\x20'+_0x16b983(0x70)+_0x16b983(0xe2)+_0x16b983(0xbd)+_0x16b983(0x130)+_0x16b983(0x121)+_0x16b983(0x124)+_0x16b983(0x132)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x16b983(0x107)+_0x16b983(0xc0)+_0x16b983(0x179)+'</thead>'+_0x16b983(0x189)+'\x20'+_0x14effb+'\x20'+_0x16b983(0xa2)+_0x16b983(0x170)+'<div>'+_0x16b983(0x163)+_0x16b983(0x12f)+_0x1597c1[0x0]['site_title']+'</h5>'+_0x16b983(0xbd)+'</div>'+_0x16b983(0x157)};_0x22046c['sendMail'](_0x2c2999,function(_0x3c87f4,_0x1587f1){var _0x1a48af=_0x16b983;_0x3c87f4?(console[_0x1a48af(0x186)](_0x3c87f4),console[_0x1a48af(0x186)](_0x1a48af(0xd0))):console[_0x1a48af(0x186)](_0x1a48af(0x9b));}),_0x31eedd['flash'](_0x16b983(0x13b),_0x16b983(0x155)),_0xc7b619['redirect']('/all_purchases/view');}catch(_0x35a541){console[_0x16b983(0x186)](_0x35a541),_0xc7b619[_0x16b983(0x6c)](0xc8)[_0x16b983(0x12b)]({'message':_0x35a541[_0x16b983(0x150)]});}}),router[a0_0x1892f6(0x142)](a0_0x1892f6(0x17d),auth,async(_0x59a596,_0x508593)=>{var _0x5bdb31=a0_0x1892f6;try{const {username:_0x13e147,email:_0x370f2c,role:_0x5cfc44}=_0x59a596[_0x5bdb31(0xd7)],_0x3dc877=_0x59a596[_0x5bdb31(0xd7)],_0x44c9e4=await profile['findOne']({'email':_0x3dc877[_0x5bdb31(0x14e)]}),_0x52ceb4=await master_shop[_0x5bdb31(0xb2)](),_0x2e0149=_0x59a596[_0x5bdb31(0x184)]['id'],_0x58e5b3=await purchases[_0x5bdb31(0x15c)](_0x2e0149);if(_0x52ceb4[0x0][_0x5bdb31(0xf0)]==_0x5bdb31(0x73))var _0x3c7ce1=users['English'];else{if(_0x52ceb4[0x0]['language']==_0x5bdb31(0xf9))var _0x3c7ce1=users[_0x5bdb31(0xf9)];else{if(_0x52ceb4[0x0][_0x5bdb31(0xf0)]==_0x5bdb31(0x11c))var _0x3c7ce1=users[_0x5bdb31(0x11c)];else{if(_0x52ceb4[0x0][_0x5bdb31(0xf0)]==_0x5bdb31(0x147))var _0x3c7ce1=users[_0x5bdb31(0x147)];else{if(_0x52ceb4[0x0][_0x5bdb31(0xf0)]==_0x5bdb31(0xc7))var _0x3c7ce1=users[_0x5bdb31(0xc7)];else{if(_0x52ceb4[0x0]['language']==_0x5bdb31(0xd5))var _0x3c7ce1=users[_0x5bdb31(0x14c)];else{if(_0x52ceb4[0x0][_0x5bdb31(0xf0)]=='Chinese')var _0x3c7ce1=users['Chinese'];else{if(_0x52ceb4[0x0]['language']==_0x5bdb31(0x6e))var _0x3c7ce1=users['Arabic'];}}}}}}}_0x508593['render'](_0x5bdb31(0x153),{'success':_0x59a596['flash']('success'),'errors':_0x59a596[_0x5bdb31(0xc3)]('errors'),'role':_0x3dc877,'profile':_0x44c9e4,'alldata':_0x58e5b3,'master_shop':_0x52ceb4,'language':_0x3c7ce1}),console[_0x5bdb31(0x186)](alldata);}catch(_0x36eaf0){console[_0x5bdb31(0x186)](_0x36eaf0);}}),router['post'](a0_0x1892f6(0x6d),async(_0x27ad3b,_0x441c77)=>{var _0x5be1c8=a0_0x1892f6;const {product_code:_0x330bee}=_0x27ad3b[_0x5be1c8(0x113)];var _0x2bd0a1;const _0x2e1302=await product[_0x5be1c8(0xce)]([{'$match':{'primary_code':_0x330bee,'product_category':_0x5be1c8(0xe5)}},{'$group':{'_id':_0x5be1c8(0x172),'name':{'$first':'$name'},'category':{'$first':_0x5be1c8(0x136)},'brand':{'$first':'$brand'},'unit':{'$first':_0x5be1c8(0xd4)},'alertquantity':{'$first':_0x5be1c8(0xe9)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5be1c8(0x10d)},'secondary_code':{'$first':_0x5be1c8(0xf8)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5be1c8(0x166)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5be1c8(0x15f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1b5d32=await product['aggregate']([{'$match':{'secondary_code':_0x330bee,'product_category':_0x5be1c8(0xe5)}},{'$group':{'_id':_0x5be1c8(0x172),'name':{'$first':_0x5be1c8(0x152)},'category':{'$first':'$category'},'brand':{'$first':_0x5be1c8(0x180)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x5be1c8(0xe9)},'product_code':{'$first':_0x5be1c8(0x129)},'primary_code':{'$first':_0x5be1c8(0x10d)},'secondary_code':{'$first':_0x5be1c8(0xf8)},'maxStocks':{'$first':_0x5be1c8(0xa0)},'maxProdPerUnit':{'$first':_0x5be1c8(0x166)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5be1c8(0x15f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2e1302[_0x5be1c8(0xbe)]>0x0)_0x2bd0a1=_0x2e1302;else _0x1b5d32['length']>0x0&&(_0x2bd0a1=_0x1b5d32);_0x441c77[_0x5be1c8(0x12b)](_0x2bd0a1);}),router[a0_0x1892f6(0x149)]('/CheckingWarehouse',async(_0x4a764f,_0x55eaed)=>{var _0x19ada8=a0_0x1892f6;const {primaryCode:_0x102058,secondaryCode:_0x359682,productCode:_0x337a1c,bay:_0x48828b,bin:_0x31304a,types:_0x1b6c0e,pallet:_0x55fbce,warehouses:_0x5b6982,room:_0x1c3a85}=_0x4a764f[_0x19ada8(0x113)];console[_0x19ada8(0x186)](_0x4a764f[_0x19ada8(0x113)]);try{const _0x3cfb05=await warehouse['aggregate']([{'$match':{'name':_0x5b6982,'room':_0x1c3a85}},{'$unwind':_0x19ada8(0xda)},{'$match':{'product_details.bay':_0x48828b,'product_details.bin':_0x31304a,'product_details.type':_0x1b6c0e}},{'$group':{'_id':_0x19ada8(0x90),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x19ada8(0xe3)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x19ada8(0x13c)},'pallet':{'$first':_0x19ada8(0x100)},'maxProducts':{'$first':_0x19ada8(0x16b)}}}]);_0x55eaed[_0x19ada8(0x6c)](0xc8)[_0x19ada8(0x12b)](_0x3cfb05);}catch(_0x476984){_0x55eaed['status'](0x194)[_0x19ada8(0x12b)]({'message':_0x476984['message']});}}),module[a0_0x1892f6(0x99)]=router;