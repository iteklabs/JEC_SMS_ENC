var a0_0x6a53cf=a0_0x410b;function a0_0x410b(_0x42e281,_0x5f301f){var _0x153bb2=a0_0x153b();return a0_0x410b=function(_0x410b44,_0x227a2b){_0x410b44=_0x410b44-0x129;var _0x53d7d4=_0x153bb2[_0x410b44];return _0x53d7d4;},a0_0x410b(_0x42e281,_0x5f301f);}(function(_0x18ddb7,_0x24e117){var _0x4200bf=a0_0x410b,_0x53c730=_0x18ddb7();while(!![]){try{var _0x5ba9a8=-parseInt(_0x4200bf(0x13c))/0x1*(parseInt(_0x4200bf(0x161))/0x2)+parseInt(_0x4200bf(0x1f2))/0x3*(-parseInt(_0x4200bf(0x166))/0x4)+-parseInt(_0x4200bf(0x1f6))/0x5+-parseInt(_0x4200bf(0x182))/0x6*(parseInt(_0x4200bf(0x18e))/0x7)+-parseInt(_0x4200bf(0x171))/0x8+-parseInt(_0x4200bf(0x23a))/0x9*(-parseInt(_0x4200bf(0x22d))/0xa)+-parseInt(_0x4200bf(0x1ca))/0xb*(-parseInt(_0x4200bf(0x145))/0xc);if(_0x5ba9a8===_0x24e117)break;else _0x53c730['push'](_0x53c730['shift']());}catch(_0x513b25){_0x53c730['push'](_0x53c730['shift']());}}}(a0_0x153b,0x76249));const express=require('express'),app=express(),router=express[a0_0x6a53cf(0x16c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x6a53cf(0x1fc)),auth=require(a0_0x6a53cf(0x1c0)),nodemailer=require(a0_0x6a53cf(0x1c3));var ejs=require(a0_0x6a53cf(0x16e));const path=require(a0_0x6a53cf(0x1b6)),users=require(a0_0x6a53cf(0x13b));function a0_0x153b(){var _0x5a38bb=['product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_invoice','product_stock','183794qGcWYM','push','$product_details.storage','floorlevel','prod_pallet','12XFvoao','product_cat','Arabic\x20(ae)','Email\x20sent\x20successfully','delivery_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Router','Error\x20Occurs','ejs','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','2402368aqQrId','Shelves','primary_code','invoice','<tbody\x20style=\x22text-align:\x20center;\x22>','RMSEmail','catch','add_purchases','actual_qty','$date','/all_purchases/view/','purchase_invoice','prod_unit','role','/../public','forEach','return_qty','6bEAOdL','\x20<\x20wew\x20>\x20','RoomAssign','prod_code','\x20</h2>','$_id','/view/add_purchases','map','Rack\x20A','Receiving\x20Area','type','$product.bin','1040382IZUfEx','$finalize','prod_level','max_product_unit','</thead>','</div>','purchase_quantity','$category','$product_details._id','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.expiry_date','<h2>\x20','Raw\x20Materials','sendMail','COLD\x20STORAGE','body','$brand','edit_purchases_view','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/view/:id','$batch_code','$product_details.secondary_code','delivery_date','English','stock_data','note','$maxStocks','message','MaxStocks_data','</head><body>','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/invoice/:id','host','quantity','render','\x20<>\x20','/all_purchases/view','path','abs','English\x20(US)','production_date','status','product_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<hr\x20class=\x22my-3\x22>','/barcode_scanner','$product_details.maxProducts','../middleware/auth','language','/view/add_purchases/:id','nodemailer','suppliers','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$suppliers_docs','<tr>','$product_details.primary_code','prod_isle','66DWMMCx','$product_details.floorlevel','<div>','$secondary_code','German','There\x27s\x20a\x20error\x20in\x20this\x20transaction','then','\x20Order\x20Date\x20:\x20','room','$warehouse_name','getDate','port','Sales\x20Update\x20successfully','password','maxperunit','$invoice','$product_details','$product_details.type','log','<strong>\x20Regards\x20</strong>','Purchase\x20Return','due_amount','storage','$room','stock_quantity','$product_details.product_code','product_list','Enclosed','prod_name','user','/barcode/:id','$product_details.product_name','all_purchases_barcode','True','get','</tbody>','errors','date','return_product','Arabic','342621VMhVNK','findOne','add_purchases\x20error','secondary_code','3203850NQNIeW','prod_qty','$suppliers','Return\x20Goods','length','rack','../models/all_models','$product_details.product_stock','product_code','Paid\x20For\x20Purchase','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','JO_number','$product_details.level','add\x20post','image','success','site_title','$note','$product','pallet','email','master','currency','$product.quantity','$product_details.bin','random','$product_details.bay','Spanish','params','<span\x20style=\x22float:\x20right;\x22>','$secondary_unit','isle','$paid_amount','primary_code_hide','<!DOCTYPE\x20html>','batch_code','$primary_code','Rack\x20D','Level','finalize','edit_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','rak','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','alertQTY','flash','prod_cat','expiry_date','error','Chinese','logo','payment\x20successfull','10moMUoh','/preview/:id','Enabled','$maxProdPerUnit','standard_unit','/CheckingWarehouse','json','table\x20page','maxStocks','gmail','post','$name','room_name','4035213AWKNbM','Portuguese\x20(BR)','slice','getFullYear','staff','purchase\x20data\x20update\x20successfully','$expiry_date','prod_secondunit','Portuguese','POnumber','return_data','$product_details.rack','save','floor','suppliers_docs','bin','</tr>','An\x20error\x20occurred\x20while\x20saving\x20data.','suppliers_data','warehouse_name','Rack\x20B','secondary_code_hide','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Rack\x20C','$unit','$product_details.isle','DRY\x20STORAGE','level','prod_Qty','types','</h5>','\x20Order\x20Number\x20:\x20','<h5>','$product.floorlevel','Purchase\x20Mail','aggregate','concat','INC-','actual_uom','</table>','/view','</span>','../public/language/languages.json','1RbcaCF','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Floor','/upload/','amount','/view/return_purchase/:id','name','deliverycode','user_id','3119532LweijU','getMonth','prod_primunit','paid_amount','</body></html>','foreach\x20newproduct','<h5\x20style=\x22text-align:\x20left;\x22>','Logo.png','French','all','secondary_unit','</td>','padStart','$alertquantity','$due_amount','$product.bay','warehouse','findById','product','filter','An\x20error\x20occurred.','$return_data','string','$product.type'];a0_0x153b=function(){return _0x5a38bb;};return a0_0x153b();}router[a0_0x6a53cf(0x1ec)](a0_0x6a53cf(0x139),auth,async(_0x22e651,_0x303c4e)=>{var _0x300420=a0_0x6a53cf;try{const {username:_0x4ab7bc,email:_0x38d82e,role:_0xd887fc}=_0x22e651['user'],_0x8c0bb=_0x22e651[_0x300420(0x1e7)],_0x3a0f70=await profile[_0x300420(0x1f3)]({'email':_0x8c0bb['email']}),_0x1959a0=await staff[_0x300420(0x1f3)]({'email':_0x8c0bb['email']});if(_0x8c0bb[_0x300420(0x17e)]==_0x300420(0x23e)){const _0x4728ee=await staff['findOne']({'email':_0x8c0bb['email']});}const _0x1fc230=await master_shop[_0x300420(0x222)]();let _0x565653;if(_0x8c0bb[_0x300420(0x17e)]=='staff'){const _0x5cbe3e=await staff[_0x300420(0x1f3)]({'email':_0x8c0bb[_0x300420(0x20b)]});_0x565653=await purchases[_0x300420(0x134)]([{'$match':{'warehouse_name':_0x5cbe3e[_0x300420(0x155)]}},{'$lookup':{'from':_0x300420(0x1c4),'localField':_0x300420(0x1c4),'foreignField':_0x300420(0x142),'as':_0x300420(0x248)}},{'$unwind':_0x300420(0x1c6)},{'$unwind':_0x300420(0x209)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x300420(0x1f8)},'date':{'$first':_0x300420(0x17a)},'warehouse_name':{'$first':_0x300420(0x1d3)},'room':{'$first':_0x300420(0x1e1)},'product':{'$push':_0x300420(0x209)},'note':{'$first':_0x300420(0x208)},'paid_amount':{'$first':_0x300420(0x217)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x300420(0x15a)},'batch_code':{'$first':_0x300420(0x1a4)},'expiry_date':{'$first':_0x300420(0x240)},'suppliers_docs':{'$first':_0x300420(0x1c6)},'total_product_quantity':{'$sum':_0x300420(0x20e)},'level':{'$addToSet':_0x300420(0x154)},'isle':{'$addToSet':_0x300420(0x18d)},'type':{'$addToSet':_0x300420(0x15c)},'floorlevel':{'$addToSet':_0x300420(0x132)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x565653=await purchases[_0x300420(0x134)]([{'$lookup':{'from':_0x300420(0x1c4),'localField':_0x300420(0x1c4),'foreignField':_0x300420(0x142),'as':_0x300420(0x248)}},{'$unwind':_0x300420(0x1c6)},{'$unwind':_0x300420(0x209)},{'$group':{'_id':_0x300420(0x187),'invoice':{'$first':_0x300420(0x1d9)},'suppliers':{'$first':_0x300420(0x1f8)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x300420(0x1d3)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x300420(0x209)},'note':{'$first':_0x300420(0x208)},'paid_amount':{'$first':_0x300420(0x217)},'due_amount':{'$first':_0x300420(0x153)},'return_data':{'$first':_0x300420(0x15a)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x300420(0x240)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x300420(0x20e)},'level':{'$addToSet':_0x300420(0x154)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x300420(0x15c)},'floorlevel':{'$addToSet':_0x300420(0x132)},'finalize':{'$first':_0x300420(0x18f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1fc230[0x0][_0x300420(0x1c1)]==_0x300420(0x1b8)){var _0x1e51ef=users['English'];console[_0x300420(0x1dc)](_0x1e51ef);}else{if(_0x1fc230[0x0][_0x300420(0x1c1)]==_0x300420(0x200))var _0x1e51ef=users[_0x300420(0x200)];else{if(_0x1fc230[0x0][_0x300420(0x1c1)]==_0x300420(0x1ce))var _0x1e51ef=users['German'];else{if(_0x1fc230[0x0][_0x300420(0x1c1)]==_0x300420(0x212))var _0x1e51ef=users[_0x300420(0x212)];else{if(_0x1fc230[0x0][_0x300420(0x1c1)]==_0x300420(0x14d))var _0x1e51ef=users[_0x300420(0x14d)];else{if(_0x1fc230[0x0][_0x300420(0x1c1)]==_0x300420(0x23b))var _0x1e51ef=users['Portuguese'];else{if(_0x1fc230[0x0]['language']==_0x300420(0x22a))var _0x1e51ef=users[_0x300420(0x22a)];else{if(_0x1fc230[0x0]['language']==_0x300420(0x168))var _0x1e51ef=users['Arabic'];}}}}}}}_0x303c4e[_0x300420(0x1b3)]('all_purchases',{'success':_0x22e651[_0x300420(0x226)]('success'),'errors':_0x22e651[_0x300420(0x226)]('errors'),'purchases':_0x565653,'role':_0x8c0bb,'profile':_0x3a0f70,'master_shop':_0x1fc230,'language':_0x1e51ef});}catch(_0x2a36fb){console[_0x300420(0x1dc)](_0x300420(0x234),_0x2a36fb),_0x303c4e['status'](0xc8)['json']({'message':_0x2a36fb[_0x300420(0x1ab)]});}});function BayBinSelected(_0x52c5f7,_0x526462){var _0xecda8b=a0_0x6a53cf,_0x58c348=[],_0x58746d=[],_0x56b9ae=[],_0x545d40=[],_0x51ee8f=[],_0x18cdbf=[];let _0x1da53f=[];if(_0x52c5f7==_0xecda8b(0x12b))switch(_0x526462){case _0xecda8b(0x18a):_0x58c348=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x58746d=[0x1,0x2],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=['Level','Floor'],_0x51ee8f=['D'],_0x18cdbf=['A'];break;case'Rack\x20B':_0x58c348=[0x6,0x5,0x4,0x3,0x2,0x1],_0x58746d=[0x1,0x2],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=[_0xecda8b(0x21d),'Floor'],_0x51ee8f=['D'],_0x18cdbf=['B'];break;case _0xecda8b(0x172):_0x58c348=[0x0],_0x58746d=[0x0],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=['Floor'],_0x51ee8f=['D'],_0x18cdbf=['S'];break;case _0xecda8b(0x18b):_0x58c348=[0x0],_0x58746d=[0x0],_0x545d40=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x56b9ae=[_0xecda8b(0x13e)],_0x51ee8f=['D'],_0x18cdbf=['R'];break;}else{if(_0x52c5f7==_0xecda8b(0x19d))switch(_0x526462){case _0xecda8b(0x18a):_0x58c348=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x58746d=['B','F'],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=['Level',_0xecda8b(0x13e)],_0x51ee8f=['C'],_0x18cdbf=['A'];break;case _0xecda8b(0x24e):_0x58c348=[0x5,0x4,0x3,0x2,0x1],_0x58746d=['F','B','S'],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=[_0xecda8b(0x21d),_0xecda8b(0x13e)],_0x51ee8f=['C'],_0x18cdbf=['B'];break;case _0xecda8b(0x251):_0x58c348=[0x1,0x2,0x3,0x4,0x5],_0x58746d=['B','F','S'],_0x545d40=[0x5,0x4,0x3,0x2,0x1],_0x56b9ae=[_0xecda8b(0x21d),_0xecda8b(0x13e)],_0x51ee8f=['C'],_0x18cdbf=['C'];break;case _0xecda8b(0x21c):_0x58c348=[0x5,0x4,0x3,0x2,0x1],_0x58746d=['F','B','S'],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=[_0xecda8b(0x21d),_0xecda8b(0x13e)],_0x51ee8f=['C'],_0x18cdbf=['D'];break;case'Rack\x20E':_0x58c348=[0x4,0x3,0x2,0x1],_0x58746d=[0x1,0x2],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=[_0xecda8b(0x21d),_0xecda8b(0x13e)],_0x51ee8f=['C'],_0x18cdbf=['E'];break;case'Rack\x20F':_0x58c348=[0x1,0x2,0x3],_0x58746d=[0x1,0x2],_0x545d40=[0x1,0x2,0x3,0x4,0x5],_0x56b9ae=['Level'],_0x51ee8f=['C'],_0x18cdbf=['F'];break;}}return{'levels':_0x58c348,'Isle':_0x58746d,'rack':_0x545d40,'type':_0x56b9ae,'storage':_0x51ee8f,'rak':_0x18cdbf};}async function getRandom8DigitNumber(){var _0x321bf9=a0_0x6a53cf;const _0x1a48b5=0x989680,_0x534c59=0x5f5e0ff,_0x341102=Math[_0x321bf9(0x247)](Math[_0x321bf9(0x210)]()*(_0x534c59-_0x1a48b5+0x1))+_0x1a48b5;var _0x1bbbcd;const _0xe8c4d4=await purchases[_0x321bf9(0x1f3)]({'invoice':_0x321bf9(0x136)+_0x341102});return _0xe8c4d4&&_0xe8c4d4[_0x321bf9(0x1fa)]>0x0?_0x1bbbcd='INC-'+_0x341102:_0x1bbbcd=_0x321bf9(0x136)+_0x341102,_0x1bbbcd;}router[a0_0x6a53cf(0x1ec)](a0_0x6a53cf(0x188),auth,async(_0x178082,_0x13d44f)=>{var _0x129bd5=a0_0x6a53cf;try{const {username:_0x552f1d,email:_0x407856,role:_0x11ea22}=_0x178082[_0x129bd5(0x1e7)],_0x578ad7=_0x178082[_0x129bd5(0x1e7)],_0x16f63b=await profile[_0x129bd5(0x1f3)]({'email':_0x578ad7['email']}),_0x153892=await master_shop['find'](),_0x1e2990=await staff[_0x129bd5(0x1f3)]({'email':_0x578ad7['email']}),_0x588898=await suppliers[_0x129bd5(0x222)]({});let _0x1b305c;if(_0x578ad7[_0x129bd5(0x17e)]=='staff'){const _0x381009=await staff[_0x129bd5(0x1f3)]({'email':_0x578ad7['email']});_0x1b305c=await warehouse[_0x129bd5(0x134)]([{'$match':{'status':_0x129bd5(0x22f),'name':_0x381009['warehouse'],'warehouse_category':_0x129bd5(0x19b),'name':{'$ne':_0x129bd5(0x1f9)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1b305c=await warehouse[_0x129bd5(0x134)]([{'$match':{'status':_0x129bd5(0x22f),'warehouse_category':_0x129bd5(0x19b),'name':{'$ne':_0x129bd5(0x1f9)}}},{'$group':{'_id':'$name','name':{'$first':_0x129bd5(0x238)}}}]);const _0x43adac=await product[_0x129bd5(0x222)]({}),_0x217718=await warehouse[_0x129bd5(0x222)]({'status':_0x129bd5(0x22f)}),_0x28d773=await purchases[_0x129bd5(0x222)]({}),_0x171de9=_0x28d773[_0x129bd5(0x1fa)]+0x1,_0x2b766e=_0x129bd5(0x136)+_0x171de9['toString']()[_0x129bd5(0x151)](0x5,'0');var _0x1cb91f=['Ambient',_0x129bd5(0x1e5)];if(_0x153892[0x0]['language']==_0x129bd5(0x1b8))var _0x41dbaa=users['English'];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x200))var _0x41dbaa=users[_0x129bd5(0x200)];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x1ce))var _0x41dbaa=users['German'];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x212))var _0x41dbaa=users['Spanish'];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x14d))var _0x41dbaa=users[_0x129bd5(0x14d)];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x23b))var _0x41dbaa=users[_0x129bd5(0x242)];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x22a))var _0x41dbaa=users['Chinese'];else{if(_0x153892[0x0][_0x129bd5(0x1c1)]==_0x129bd5(0x168))var _0x41dbaa=users[_0x129bd5(0x1f1)];}}}}}}}const _0x7ded2c=getRandom8DigitNumber();_0x7ded2c['then'](_0x4f9d30=>{var _0x50db1d=_0x129bd5;_0x13d44f[_0x50db1d(0x1b3)](_0x50db1d(0x178),{'success':_0x178082[_0x50db1d(0x226)](_0x50db1d(0x206)),'errors':_0x178082[_0x50db1d(0x226)](_0x50db1d(0x1ee)),'role':_0x578ad7,'profile':_0x16f63b,'suppliers':_0x588898,'warehouse':_0x1b305c,'product':_0x43adac,'invoice':_0x4f9d30,'master_shop':_0x153892,'language':_0x41dbaa,'find_data':_0x217718,'rooms_data':_0x1cb91f});})[_0x129bd5(0x177)](_0x387660=>{var _0x276723=_0x129bd5;_0x178082[_0x276723(0x226)](_0x276723(0x1ee),_0x276723(0x1cf)),_0x13d44f[_0x276723(0x16f)](_0x276723(0x1b5));});}catch(_0x215d2a){console['log'](_0x215d2a);}}),router[a0_0x6a53cf(0x1ec)](a0_0x6a53cf(0x1c2),auth,async(_0x3e9de8,_0x16c76e)=>{var _0xe87b4c=a0_0x6a53cf;try{const _0x11673b=_0x3e9de8['params']['id'];console[_0xe87b4c(0x1dc)](_0x11673b);const _0x2af6b6=await master_shop[_0xe87b4c(0x222)]();console[_0xe87b4c(0x1dc)](_0xe87b4c(0x20c),_0x2af6b6);const _0x34f811=await product[_0xe87b4c(0x1f3)]({'name':_0x11673b});console[_0xe87b4c(0x1dc)](_0xe87b4c(0x157),_0x34f811),_0x16c76e[_0xe87b4c(0x1ba)](0xc8)[_0xe87b4c(0x233)]({'product_data':_0x34f811,'master':_0x2af6b6});}catch(_0x28a3c8){console[_0xe87b4c(0x1dc)](_0xe87b4c(0x1f4),_0x28a3c8);}}),router[a0_0x6a53cf(0x237)](a0_0x6a53cf(0x188),auth,async(_0xbc2233,_0x16ff79)=>{var _0x4f24ce=a0_0x6a53cf;try{const {invoice:_0x354732,date:_0x3e0e38,warehouse_name:_0x2dd813,prod_name:_0x303807,prod_code:_0x20b1fc,prod_qty:_0x22f0d8,prod_unit:_0x5c7a99,prod_secondunit:_0x340509,prod_level:_0x956ccc,prod_isle:_0x5080dc,prod_pallet:_0x3092ee,note:_0x1e2599,expiry_date:_0x2e31ed,batch_code:_0x254894,payable:_0x16b98e,due_amount:_0x5a1398,Room_name:_0x52243f,primary_code:_0x252ec5,secondary_code:_0x201804,MaxStocks_data:_0x4380b0,PO_number:_0x21803a,SCRN:_0x2b7fd9,JO_number:_0x3a3034}=_0xbc2233[_0x4f24ce(0x19e)];if(typeof _0x303807==_0x4f24ce(0x15b))var _0x2350a5=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x1e6)]],_0x26a0f2=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x185)]],_0x4c5c30=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x12d)]],_0x49615a=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x147)]],_0x51891a=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x241)]],_0x42909e=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x190)]],_0x50387f=[_0xbc2233[_0x4f24ce(0x19e)]['primary_code']],_0x1e966c=[_0xbc2233['body']['secondary_code']],_0x44def4=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x1ac)]],_0x418039=[_0xbc2233['body']['batch_code']],_0x5872f7=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x228)]],_0x4cfe73=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x191)]],_0x462f42=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x225)]],_0x4cc5c9=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x1b9)]],_0x39e7d9=[_0xbc2233[_0x4f24ce(0x19e)]['prod_cat']],_0x3acaf4=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x184)]],_0x5dc8ea=[_0xbc2233['body'][_0x4f24ce(0x143)]],_0x201df1=[_0xbc2233['body']['prod_invoice']],_0x286c67=[_0xbc2233[_0x4f24ce(0x19e)]['actual_qty']],_0x41f2c8=[_0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x137)]];else var _0x2350a5=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x1e6)]],_0x26a0f2=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x185)]],_0x4c5c30=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x12d)]],_0x49615a=[..._0xbc2233['body'][_0x4f24ce(0x147)]],_0x51891a=[..._0xbc2233[_0x4f24ce(0x19e)]['prod_secondunit']],_0x42909e=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x190)]],_0x50387f=[..._0xbc2233['body'][_0x4f24ce(0x173)]],_0x1e966c=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x1f5)]],_0x44def4=[..._0xbc2233['body'][_0x4f24ce(0x1ac)]],_0x418039=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x21a)]],_0x5872f7=[..._0xbc2233[_0x4f24ce(0x19e)]['expiry_date']],_0x4cfe73=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x191)]],_0x462f42=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x225)]],_0x4cc5c9=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x1b9)]],_0x39e7d9=[..._0xbc2233['body'][_0x4f24ce(0x227)]],_0x3acaf4=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x184)]],_0x5dc8ea=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x143)]],_0x201df1=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x15f)]],_0x286c67=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x179)]],_0x41f2c8=[..._0xbc2233[_0x4f24ce(0x19e)][_0x4f24ce(0x137)]];const _0x44f81e=_0x2350a5[_0x4f24ce(0x189)](_0x4fa2df=>{return _0x4fa2df={'product_name':_0x4fa2df};});_0x286c67['forEach']((_0x1e160a,_0xd4016a)=>{var _0x1214ea=_0x4f24ce;_0x44f81e[_0xd4016a][_0x1214ea(0x179)]=Math['abs'](_0x1e160a);}),_0x41f2c8[_0x4f24ce(0x180)]((_0x4d8d38,_0xfff26e)=>{var _0x4fd39e=_0x4f24ce;_0x44f81e[_0xfff26e][_0x4fd39e(0x137)]=_0x4d8d38;}),_0x26a0f2[_0x4f24ce(0x180)]((_0x7a5f8b,_0xaa1c63)=>{_0x44f81e[_0xaa1c63]['product_code']=_0x7a5f8b;}),_0x4c5c30[_0x4f24ce(0x180)]((_0x3af48f,_0x63c040)=>{var _0x11f9b6=_0x4f24ce;_0x44f81e[_0x63c040][_0x11f9b6(0x1b2)]=Math[_0x11f9b6(0x1b7)](_0x3af48f);}),_0x49615a[_0x4f24ce(0x180)]((_0xdc7ecf,_0x59fb7b)=>{var _0x2f6e9c=_0x4f24ce;_0x44f81e[_0x59fb7b][_0x2f6e9c(0x231)]=_0xdc7ecf;}),_0x51891a[_0x4f24ce(0x180)]((_0x131387,_0x6e0bd7)=>{var _0x3ce530=_0x4f24ce;_0x44f81e[_0x6e0bd7][_0x3ce530(0x14f)]=_0x131387;}),_0x42909e[_0x4f24ce(0x180)]((_0x406f19,_0x36345a)=>{var _0x177ba8=_0x4f24ce;_0x3acaf4[_0x177ba8(0x180)]((_0x2b83d8,_0x2478d9)=>{var _0x34a349=_0x177ba8;if(_0x2b83d8==_0x34a349(0x18b)&&_0x36345a==_0x2478d9){console[_0x34a349(0x1dc)](_0x2b83d8+_0x34a349(0x183)+_0x36345a+'\x20<>\x20'+_0x2478d9+'\x20<>\x20'+_0x406f19);var _0x42ff7c=_0x406f19[_0x34a349(0x23c)](0x3);_0x44f81e[_0x36345a][_0x34a349(0x1e0)]=_0x406f19[0x0],_0x44f81e[_0x36345a][_0x34a349(0x1fb)]=_0x406f19[0x1],_0x44f81e[_0x36345a][_0x34a349(0x1ae)]=0x0,_0x44f81e[_0x36345a][_0x34a349(0x249)]=0x0,_0x44f81e[_0x36345a][_0x34a349(0x18c)]=_0x34a349(0x13e),_0x44f81e[_0x36345a][_0x34a349(0x164)]=_0x42ff7c;}else{if(_0x2b83d8==_0x34a349(0x172)&&_0x36345a==_0x2478d9){var _0x42ff7c=_0x406f19['slice'](0x3);_0x44f81e[_0x36345a][_0x34a349(0x1e0)]=_0x406f19[0x0],_0x44f81e[_0x36345a][_0x34a349(0x1fb)]=_0x406f19[0x1],_0x44f81e[_0x36345a]['bay']=0x0,_0x44f81e[_0x36345a][_0x34a349(0x249)]=0x0,_0x44f81e[_0x36345a][_0x34a349(0x18c)]='Floor',_0x44f81e[_0x36345a]['floorlevel']=_0x406f19[0x5];}else{if(_0x36345a==_0x2478d9){if(_0x406f19[0x0]=='A'&&_0x406f19[0x1]=='L'&&_0x406f19[0x2]=='L')console[_0x34a349(0x1dc)](_0x2b83d8+'\x20<>\x20'+_0x36345a+_0x34a349(0x1b4)+_0x2478d9+_0x34a349(0x1b4)+_0x406f19+'here'),_0x44f81e[_0x36345a]['storage']=_0x406f19[0x0],_0x44f81e[_0x36345a][_0x34a349(0x1fb)]=_0x406f19[0x1],_0x44f81e[_0x36345a]['bay']=0x0,_0x44f81e[_0x36345a][_0x34a349(0x249)]=0x0,_0x44f81e[_0x36345a][_0x34a349(0x18c)]='Floor',_0x44f81e[_0x36345a][_0x34a349(0x164)]=_0x406f19[0x3];else{var _0x8c26c8;if(_0x406f19[0x4]=='L')_0x8c26c8=_0x34a349(0x21d);else _0x406f19[0x4]=='F'&&(_0x8c26c8=_0x34a349(0x13e));_0x44f81e[_0x36345a][_0x34a349(0x1e0)]=_0x406f19[0x0],_0x44f81e[_0x36345a]['rack']=_0x406f19[0x1],_0x44f81e[_0x36345a][_0x34a349(0x1ae)]=_0x406f19[0x2],_0x44f81e[_0x36345a][_0x34a349(0x249)]=_0x406f19[0x3],_0x44f81e[_0x36345a][_0x34a349(0x18c)]=_0x8c26c8,_0x44f81e[_0x36345a][_0x34a349(0x164)]=_0x406f19[0x5];}}}}});}),_0x50387f[_0x4f24ce(0x180)]((_0xc868b7,_0x428636)=>{var _0x3d99b3=_0x4f24ce;_0x44f81e[_0x428636][_0x3d99b3(0x173)]=_0xc868b7;}),_0x1e966c['forEach']((_0x10576b,_0x1ca540)=>{var _0x4bd306=_0x4f24ce;_0x44f81e[_0x1ca540][_0x4bd306(0x1f5)]=_0x10576b;}),_0x44def4[_0x4f24ce(0x180)]((_0x3365e7,_0x2d98da)=>{_0x44f81e[_0x2d98da]['maxStocks']=_0x3365e7;}),_0x418039[_0x4f24ce(0x180)]((_0x4a68c0,_0xf774f5)=>{var _0x1de60a=_0x4f24ce;_0x44f81e[_0xf774f5][_0x1de60a(0x21a)]=_0x4a68c0;}),_0x5872f7['forEach']((_0x10e3e6,_0x1b7ddb)=>{_0x44f81e[_0x1b7ddb]['expiry_date']=_0x10e3e6;}),_0x4cfe73['forEach']((_0x16cfe2,_0x13afb0)=>{var _0xeb8747=_0x4f24ce;_0x44f81e[_0x13afb0][_0xeb8747(0x1d8)]=_0x16cfe2;}),_0x462f42[_0x4f24ce(0x180)]((_0x2f7826,_0x3705d9)=>{var _0x10ad79=_0x4f24ce;_0x44f81e[_0x3705d9][_0x10ad79(0x225)]=_0x2f7826;}),_0x4cc5c9[_0x4f24ce(0x180)]((_0x2cc603,_0x1a53e5)=>{var _0x133d00=_0x4f24ce;_0x44f81e[_0x1a53e5][_0x133d00(0x1b9)]=_0x2cc603;}),_0x39e7d9[_0x4f24ce(0x180)]((_0x3ae00d,_0x5b48ee)=>{var _0x37ee7b=_0x4f24ce;_0x44f81e[_0x5b48ee][_0x37ee7b(0x167)]=_0x3ae00d;}),_0x3acaf4[_0x4f24ce(0x180)]((_0x54cc85,_0x8e28c8)=>{var _0x4ac165=_0x4f24ce;_0x44f81e[_0x8e28c8][_0x4ac165(0x239)]=_0x54cc85;}),_0x5dc8ea['forEach']((_0x494251,_0x207a5a)=>{_0x44f81e[_0x207a5a]['delivery_code']=_0x494251;}),_0x201df1[_0x4f24ce(0x180)]((_0x1aa82b,_0x247ce0)=>{var _0x1701e7=_0x4f24ce;_0x44f81e[_0x247ce0][_0x1701e7(0x174)]=_0x1aa82b;});const _0xe3726e=_0x3acaf4['map'](_0x270883=>{return _0x270883={'room_name':_0x270883};}),_0x23fb76=_0x44f81e[_0x4f24ce(0x158)](_0x4314cc=>_0x4314cc[_0x4f24ce(0x1b2)]!=='0'&&_0x4314cc[_0x4f24ce(0x1b2)]!==''),_0x57eca6=new purchases({'invoice':_0x354732,'suppliers':_0xbc2233['body'][_0x4f24ce(0x1c4)],'date':_0x3e0e38,'warehouse_name':_0x2dd813,'product':_0x23fb76,'note':_0x1e2599,'due_amount':_0x5a1398,'POnumber':_0x21803a,'SCRN':_0x2b7fd9,'JO_number':_0x3a3034,'roomList':_0xe3726e}),_0x5f090f=await _0x57eca6[_0x4f24ce(0x246)](),_0x161a42=await purchases[_0x4f24ce(0x1f3)]({'invoice':_0x354732}),_0x5c11da=_0x161a42[_0x4f24ce(0x157)][_0x4f24ce(0x189)](async _0x45be86=>{var _0x1516cd=_0x4f24ce,_0x24ff68=await warehouse[_0x1516cd(0x1f3)]({'name':_0x2dd813,'room':_0x45be86[_0x1516cd(0x239)]}),_0x2b2a65=0x0;return _0x24ff68[_0x1516cd(0x15d)]['forEach'](_0x46c785=>{var _0x472b4d=_0x1516cd;_0x46c785[_0x472b4d(0x1bb)]==_0x45be86['product_name']&&_0x46c785[_0x472b4d(0x164)]==_0x45be86[_0x472b4d(0x164)]&&_0x46c785['type']==_0x45be86['type']&&_0x46c785['bin']==_0x45be86[_0x472b4d(0x249)]&&_0x46c785['bay']==_0x45be86['bay']&&_0x46c785[_0x472b4d(0x1fb)]==_0x45be86[_0x472b4d(0x1fb)]&&_0x46c785[_0x472b4d(0x1e0)]==_0x45be86[_0x472b4d(0x1e0)]&&_0x46c785['expiry_date']==_0x45be86[_0x472b4d(0x228)]&&_0x46c785[_0x472b4d(0x21a)]==_0x45be86['batch_code']&&_0x46c785['production_date']==_0x45be86[_0x472b4d(0x1b9)]&&_0x46c785[_0x472b4d(0x174)]==_0x161a42['invoice']&&(_0x46c785[_0x472b4d(0x160)]+=Math['abs'](_0x45be86[_0x472b4d(0x1b2)]),_0x2b2a65++);}),_0x2b2a65===0x0&&_0x24ff68['product_details'][_0x1516cd(0x162)]({'product_name':_0x45be86[_0x1516cd(0x1bb)],'product_stock':Math[_0x1516cd(0x1b7)](_0x45be86[_0x1516cd(0x1b2)]),'primary_code':_0x45be86['primary_code'],'secondary_code':_0x45be86[_0x1516cd(0x1f5)],'product_code':_0x45be86[_0x1516cd(0x1fe)],'storage':_0x45be86['storage'],'rack':_0x45be86[_0x1516cd(0x1fb)],'bay':_0x45be86[_0x1516cd(0x1ae)],'bin':_0x45be86[_0x1516cd(0x249)],'type':_0x45be86['type'],'floorlevel':_0x45be86['floorlevel'],'maxProducts':_0x45be86[_0x1516cd(0x235)],'unit':_0x45be86[_0x1516cd(0x231)],'secondary_unit':_0x45be86[_0x1516cd(0x14f)],'expiry_date':_0x45be86[_0x1516cd(0x228)],'maxPerUnit':_0x45be86[_0x1516cd(0x1d8)],'batch_code':_0x45be86[_0x1516cd(0x21a)],'alertQTY':_0x45be86[_0x1516cd(0x225)],'production_date':_0x45be86[_0x1516cd(0x1b9)],'product_cat':_0x45be86[_0x1516cd(0x167)],'invoice':_0x45be86[_0x1516cd(0x174)],'actual_qty':Math[_0x1516cd(0x1b7)](_0x45be86[_0x1516cd(0x179)]),'actual_uom':_0x45be86[_0x1516cd(0x137)]}),_0x24ff68;});Promise[_0x4f24ce(0x14e)](_0x5c11da)[_0x4f24ce(0x1d0)](async _0x260d0=>{var _0xf92fec=_0x4f24ce;try{for(const _0x572369 of _0x260d0){await _0x572369[_0xf92fec(0x246)]();}const _0x578083=await master_shop[_0xf92fec(0x222)](),_0x582b99=await email_settings['findOne'](),_0xb63fa=await supervisor_settings[_0xf92fec(0x222)]();var _0x232a4e=_0x161a42[_0xf92fec(0x157)],_0x4d46f9='',_0x2bae65;for(_0x2bae65 in _0x232a4e){_0x4d46f9+=_0xf92fec(0x1c7)+_0xf92fec(0x224)+_0x232a4e[_0x2bae65][_0xf92fec(0x1bb)]+_0xf92fec(0x150)+_0xf92fec(0x224)+_0x232a4e[_0x2bae65]['product_code']+_0xf92fec(0x150)+_0xf92fec(0x224)+_0x232a4e[_0x2bae65][_0xf92fec(0x1b2)]+_0xf92fec(0x150)+_0xf92fec(0x224)+_0x232a4e[_0x2bae65][_0xf92fec(0x231)]+_0xf92fec(0x150)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x232a4e[_0x2bae65][_0xf92fec(0x14f)]+'</td>'+_0xf92fec(0x224)+_0x161a42[_0xf92fec(0x24d)]+'</td>'+_0xf92fec(0x224)+_0x232a4e[_0x2bae65][_0xf92fec(0x239)]+_0xf92fec(0x150)+_0xf92fec(0x224)+_0x232a4e[_0x2bae65][_0xf92fec(0x1e0)]+_0x232a4e[_0x2bae65][_0xf92fec(0x1fb)]+_0x232a4e[_0x2bae65]['bay']+_0x232a4e[_0x2bae65][_0xf92fec(0x249)]+_0x232a4e[_0x2bae65][_0xf92fec(0x18c)][0x0]+_0x232a4e[_0x2bae65][_0xf92fec(0x164)]+_0xf92fec(0x150),_0xf92fec(0x24a);}let _0x1595e0=nodemailer['createTransport']({'host':_0x582b99[_0xf92fec(0x1b1)],'port':Number(_0x582b99[_0xf92fec(0x1d5)]),'secure':![],'auth':{'user':_0x582b99[_0xf92fec(0x20b)],'pass':_0x582b99['password']}}),_0x5b2b25={'from':_0x582b99[_0xf92fec(0x20b)],'to':_0xb63fa[0x0][_0xf92fec(0x176)],'subject':_0xf92fec(0x133),'attachments':[{'filename':_0xf92fec(0x14c),'path':__dirname+_0xf92fec(0x17f)+_0xf92fec(0x13f)+_0x578083[0x0][_0xf92fec(0x205)],'cid':'logo'}],'html':_0xf92fec(0x219)+'<html><head><title></title>'+_0xf92fec(0x1ad)+_0xf92fec(0x1cc)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xf92fec(0x1cc)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xf92fec(0x193)+_0xf92fec(0x1cc)+_0xf92fec(0x19a)+_0x578083[0x0][_0xf92fec(0x207)]+_0xf92fec(0x186)+_0xf92fec(0x193)+'</div>'+_0xf92fec(0x1bd)+_0xf92fec(0x1cc)+_0xf92fec(0x14b)+_0xf92fec(0x130)+_0x161a42[_0xf92fec(0x174)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xf92fec(0x1d1)+_0x161a42[_0xf92fec(0x1ef)]+'\x20'+_0xf92fec(0x13a)+'</h5>'+_0xf92fec(0x193)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xf92fec(0x1c5)+'<tr>'+_0xf92fec(0x198)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0xf92fec(0x223)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0xf92fec(0x1a2)+_0xf92fec(0x220)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0xf92fec(0x15e)+_0xf92fec(0x24a)+_0xf92fec(0x192)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4d46f9+'\x20'+_0xf92fec(0x1ed)+_0xf92fec(0x138)+_0xf92fec(0x1cc)+_0xf92fec(0x1dd)+_0xf92fec(0x131)+_0x578083[0x0][_0xf92fec(0x207)]+'</h5>'+'</div>'+_0xf92fec(0x193)+_0xf92fec(0x149)};_0x1595e0[_0xf92fec(0x19c)](_0x5b2b25,function(_0x19710b,_0x2226ba){var _0x165bec=_0xf92fec;_0x19710b?(console[_0x165bec(0x1dc)](_0x19710b),console['log'](_0x165bec(0x16d))):console[_0x165bec(0x1dc)](_0x165bec(0x169));}),_0xbc2233['flash'](_0xf92fec(0x206),'Purchase\x20data\x20added\x20successfully'),_0x16ff79[_0xf92fec(0x16f)](_0xf92fec(0x17b));}catch(_0x492be6){console[_0xf92fec(0x229)](_0x492be6),_0x16ff79[_0xf92fec(0x1ba)](0x1f4)['json']({'error':_0xf92fec(0x24b)});}})[_0x4f24ce(0x177)](_0x28dedb=>{var _0x1651b8=_0x4f24ce;console['error'](_0x28dedb),_0x16ff79['status'](0x1f4)[_0x1651b8(0x233)]({'error':_0x1651b8(0x159)});});}catch(_0x54d2ce){console['log'](_0x54d2ce);}}),router['get']('/preview/:id',auth,async(_0x370702,_0xc2ff46)=>{var _0x58f84d=a0_0x6a53cf;try{const {username:_0x1956c9,email:_0x258584,role:_0x172d75}=_0x370702['user'],_0x39b9ee=_0x370702[_0x58f84d(0x1e7)],_0x323dcc=await profile['findOne']({'email':_0x39b9ee['email']}),_0x15987b=await master_shop[_0x58f84d(0x222)](),_0x2cb9a9=_0x370702['params']['id'],_0x5ddb83=await purchases[_0x58f84d(0x156)](_0x2cb9a9),_0x1098b6=await warehouse['aggregate']([{'$match':{'name':_0x5ddb83[_0x58f84d(0x24d)],'room':_0x5ddb83['room']}},{'$unwind':_0x58f84d(0x1da)},{'$group':{'_id':_0x58f84d(0x196),'name':{'$first':_0x58f84d(0x1e9)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x58f84d(0x211)},'bin':{'$first':_0x58f84d(0x20f)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x58f84d(0x1cb)},'primary_code':{'$first':_0x58f84d(0x1c8)},'secondary_code':{'$first':_0x58f84d(0x1a5)},'product_code':{'$first':_0x58f84d(0x1e3)},'storage':{'$first':_0x58f84d(0x163)},'rack':{'$first':_0x58f84d(0x245)},'expiry_date':{'$first':_0x58f84d(0x199)}}}]),_0x799123=await customer['find']({});let _0x88c54d;if(_0x39b9ee['role']=='staff'){const _0x432637=await staff[_0x58f84d(0x1f3)]({'email':_0x39b9ee[_0x58f84d(0x20b)]});_0x88c54d=await warehouse['aggregate']([{'$match':{'status':_0x58f84d(0x22f),'name':_0x432637['warehouse']}},{'$group':{'_id':_0x58f84d(0x238),'name':{'$first':_0x58f84d(0x238)}}}]);}else _0x88c54d=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x58f84d(0x238),'name':{'$first':_0x58f84d(0x238)}}}]);const _0x237e75=await product['find']({}),_0x48f94b=await suppliers['find']({}),_0x4335f8=BayBinSelected(_0x5ddb83[_0x58f84d(0x24d)],_0x5ddb83[_0x58f84d(0x1d2)]);if(_0x15987b[0x0][_0x58f84d(0x1c1)]==_0x58f84d(0x1b8)){var _0x57eab0=users['English'];console[_0x58f84d(0x1dc)](_0x57eab0);}else{if(_0x15987b[0x0][_0x58f84d(0x1c1)]=='Hindi')var _0x57eab0=users[_0x58f84d(0x200)];else{if(_0x15987b[0x0]['language']==_0x58f84d(0x1ce))var _0x57eab0=users[_0x58f84d(0x1ce)];else{if(_0x15987b[0x0]['language']==_0x58f84d(0x212))var _0x57eab0=users['Spanish'];else{if(_0x15987b[0x0][_0x58f84d(0x1c1)]==_0x58f84d(0x14d))var _0x57eab0=users[_0x58f84d(0x14d)];else{if(_0x15987b[0x0]['language']==_0x58f84d(0x23b))var _0x57eab0=users[_0x58f84d(0x242)];else{if(_0x15987b[0x0][_0x58f84d(0x1c1)]==_0x58f84d(0x22a))var _0x57eab0=users[_0x58f84d(0x22a)];else{if(_0x15987b[0x0][_0x58f84d(0x1c1)]==_0x58f84d(0x168))var _0x57eab0=users[_0x58f84d(0x1f1)];}}}}}}}_0xc2ff46[_0x58f84d(0x1b3)](_0x58f84d(0x1a0),{'success':_0x370702[_0x58f84d(0x226)](_0x58f84d(0x206)),'errors':_0x370702['flash']('errors'),'role':_0x39b9ee,'profile':_0x323dcc,'customer':_0x799123,'warehouse':_0x88c54d,'product':_0x1098b6,'user':_0x5ddb83,'master_shop':_0x15987b,'unit':_0x237e75,'language':_0x57eab0,'suppliers':_0x48f94b,'dataSelected':_0x4335f8});}catch(_0x8a2732){console[_0x58f84d(0x1dc)](_0x8a2732);}}),router[a0_0x6a53cf(0x237)](a0_0x6a53cf(0x22e),auth,async(_0x7338e5,_0x2aa20a)=>{var _0x1ff8b9=a0_0x6a53cf;try{const _0x5c4f63=_0x7338e5[_0x1ff8b9(0x213)]['id'],{invoice:_0x7b370e,warehouse_name:_0x1f4515,Room_name:_0x40ec97}=_0x7338e5[_0x1ff8b9(0x19e)],_0x5662a7=await warehouse[_0x1ff8b9(0x1f3)]({'name':_0x1f4515,'room':_0x40ec97}),_0x54082d=await purchases[_0x1ff8b9(0x1f3)]({'invoice':_0x7b370e});_0x54082d['product']['forEach'](_0x13251d=>{var _0x3861ee=_0x1ff8b9,_0x572f9f=0x0;const _0x2f5471=_0x5662a7[_0x3861ee(0x15d)][_0x3861ee(0x189)](_0x4d0479=>{var _0x4b90e6=_0x3861ee;_0x4d0479['product_name']==_0x13251d[_0x4b90e6(0x1bb)]&&_0x4d0479[_0x4b90e6(0x164)]==_0x13251d[_0x4b90e6(0x164)]&&_0x4d0479[_0x4b90e6(0x18c)]==_0x13251d[_0x4b90e6(0x18c)]&&_0x4d0479['bin']==_0x13251d[_0x4b90e6(0x249)]&&_0x4d0479[_0x4b90e6(0x1ae)]==_0x13251d[_0x4b90e6(0x1ae)]&&_0x4d0479['rack']==_0x13251d['rack']&&_0x4d0479[_0x4b90e6(0x1e0)]==_0x13251d[_0x4b90e6(0x1e0)]&&_0x4d0479['expiry_date']==_0x13251d[_0x4b90e6(0x228)]&&_0x4d0479[_0x4b90e6(0x21a)]==_0x13251d[_0x4b90e6(0x21a)]&&_0x4d0479[_0x4b90e6(0x1b9)]==_0x13251d[_0x4b90e6(0x1b9)]&&_0x4d0479[_0x4b90e6(0x1a6)]==_0x13251d[_0x4b90e6(0x1a6)]&&_0x4d0479['delivery_code']==_0x13251d[_0x4b90e6(0x16a)]&&(_0x4d0479[_0x4b90e6(0x160)]=parseInt(_0x4d0479[_0x4b90e6(0x160)])+parseInt(_0x13251d[_0x4b90e6(0x1b2)]),_0x572f9f++);});_0x572f9f=='0'&&(_0x5662a7[_0x3861ee(0x15d)]=_0x5662a7[_0x3861ee(0x15d)]['concat']({'product_name':_0x13251d[_0x3861ee(0x1bb)],'product_stock':_0x13251d[_0x3861ee(0x1b2)],'primary_code':_0x13251d[_0x3861ee(0x173)],'secondary_code':_0x13251d[_0x3861ee(0x1f5)],'product_code':_0x13251d[_0x3861ee(0x1fe)],'storage':_0x13251d[_0x3861ee(0x1e0)],'rack':_0x13251d[_0x3861ee(0x1fb)],'bay':_0x13251d['bay'],'bin':_0x13251d[_0x3861ee(0x249)],'type':_0x13251d['type'],'floorlevel':_0x13251d['floorlevel'],'maxProducts':_0x13251d[_0x3861ee(0x235)],'unit':_0x13251d['standard_unit'],'secondary_unit':_0x13251d[_0x3861ee(0x14f)],'expiry_date':_0x13251d[_0x3861ee(0x228)],'maxPerUnit':_0x13251d[_0x3861ee(0x1d8)],'batch_code':_0x13251d[_0x3861ee(0x21a)],'alertQTY':_0x13251d['alertQTY'],'production_date':_0x13251d[_0x3861ee(0x1b9)],'delivery_date':_0x13251d[_0x3861ee(0x1a6)],'delivery_code':_0x13251d[_0x3861ee(0x16a)]}));}),await _0x5662a7[_0x1ff8b9(0x246)](),_0x54082d[_0x1ff8b9(0x21e)]=_0x1ff8b9(0x1eb);const _0x1ad3b2=await _0x54082d[_0x1ff8b9(0x246)]();_0x7338e5[_0x1ff8b9(0x226)]('success',_0x1ff8b9(0x1d6)),_0x2aa20a[_0x1ff8b9(0x16f)](_0x1ff8b9(0x1b5));}catch(_0x3b7fb0){console[_0x1ff8b9(0x1dc)](_0x3b7fb0);}}),router[a0_0x6a53cf(0x1ec)](a0_0x6a53cf(0x1a3),auth,async(_0x463ef0,_0x49d38b)=>{var _0x4651a5=a0_0x6a53cf;try{const {username:_0x9b739f,email:_0x27db98,role:_0x914d91}=_0x463ef0['user'],_0x8a71b7=_0x463ef0[_0x4651a5(0x1e7)],_0x105385=await profile[_0x4651a5(0x1f3)]({'email':_0x8a71b7[_0x4651a5(0x20b)]}),_0x39dc17=await master_shop[_0x4651a5(0x222)](),_0x4e9188=_0x463ef0[_0x4651a5(0x213)]['id'],_0x50ed8c=await purchases[_0x4651a5(0x156)](_0x4e9188),_0x3d4c77=await suppliers['find']({});let _0x520b27;if(_0x8a71b7[_0x4651a5(0x17e)]=='staff'){const _0x563393=await staff['findOne']({'email':_0x8a71b7[_0x4651a5(0x20b)]});_0x520b27=await warehouse[_0x4651a5(0x222)]({'status':_0x4651a5(0x22f),'name':_0x563393[_0x4651a5(0x155)],'warehouse_category':'Raw\x20Materials'});}else _0x520b27=await warehouse[_0x4651a5(0x134)]([{'$match':{'status':'Enabled','warehouse_category':_0x4651a5(0x19b)}},{'$group':{'_id':_0x4651a5(0x238),'name':{'$first':'$name'}}}]);const _0xd6a2fe=await product[_0x4651a5(0x222)]({}),_0x13ec26=BayBinSelected(_0x50ed8c['warehouse_name'],_0x50ed8c['room']);let _0x180993=new Date(_0x50ed8c['expiry_date']),_0x1a30ec=('0'+_0x180993[_0x4651a5(0x1d4)]())[_0x4651a5(0x23c)](-0x2),_0x52ae60=('0'+(_0x180993[_0x4651a5(0x146)]()+0x1))['slice'](-0x2),_0x672cb2=_0x180993[_0x4651a5(0x23d)](),_0x9a184d=_0x672cb2+'-'+_0x52ae60+'-'+_0x1a30ec;if(_0x39dc17[0x0][_0x4651a5(0x1c1)]==_0x4651a5(0x1b8)){var _0x1f8512=users[_0x4651a5(0x1a7)];console['log'](_0x1f8512);}else{if(_0x39dc17[0x0]['language']==_0x4651a5(0x200))var _0x1f8512=users[_0x4651a5(0x200)];else{if(_0x39dc17[0x0][_0x4651a5(0x1c1)]==_0x4651a5(0x1ce))var _0x1f8512=users[_0x4651a5(0x1ce)];else{if(_0x39dc17[0x0][_0x4651a5(0x1c1)]==_0x4651a5(0x212))var _0x1f8512=users[_0x4651a5(0x212)];else{if(_0x39dc17[0x0][_0x4651a5(0x1c1)]==_0x4651a5(0x14d))var _0x1f8512=users['French'];else{if(_0x39dc17[0x0][_0x4651a5(0x1c1)]=='Portuguese\x20(BR)')var _0x1f8512=users[_0x4651a5(0x242)];else{if(_0x39dc17[0x0][_0x4651a5(0x1c1)]=='Chinese')var _0x1f8512=users[_0x4651a5(0x22a)];else{if(_0x39dc17[0x0][_0x4651a5(0x1c1)]==_0x4651a5(0x168))var _0x1f8512=users[_0x4651a5(0x1f1)];}}}}}}}_0x49d38b['render'](_0x4651a5(0x21f),{'success':_0x463ef0[_0x4651a5(0x226)](_0x4651a5(0x206)),'errors':_0x463ef0[_0x4651a5(0x226)](_0x4651a5(0x1ee)),'role':_0x8a71b7,'profile':_0x105385,'purchases':_0x50ed8c,'suppliers':_0x3d4c77,'warehouse':_0x520b27,'product':_0xd6a2fe,'master_shop':_0x39dc17,'language':_0x1f8512,'ed_fullDate':_0x9a184d,'dataSelected':_0x13ec26});}catch(_0x1609b2){console['log'](_0x1609b2);}}),router[a0_0x6a53cf(0x237)](a0_0x6a53cf(0x1a3),auth,async(_0x305919,_0x5e9675)=>{var _0x2498dd=a0_0x6a53cf;try{const _0x5dd32c=_0x305919['params']['id'],_0xaccb8e=await purchases['findOne']({'_id':_0x305919[_0x2498dd(0x213)]['id']}),_0x3a0f8f=await warehouse[_0x2498dd(0x1f3)]({'name':_0xaccb8e[_0x2498dd(0x24d)],'room':_0xaccb8e['room']});_0xaccb8e[_0x2498dd(0x157)][_0x2498dd(0x180)](_0x4b2772=>{var _0x2de688=_0x2498dd;const _0x2df668=_0x3a0f8f[_0x2de688(0x15d)]['map'](_0x1a5dfb=>{var _0x5930b2=_0x2de688;_0x1a5dfb['product_name']==_0x4b2772['product_name']&&_0x1a5dfb[_0x5930b2(0x164)]==_0x4b2772['floorlevel']&&_0x1a5dfb[_0x5930b2(0x18c)]==_0x4b2772[_0x5930b2(0x18c)]&&_0x1a5dfb['bin']==_0x4b2772[_0x5930b2(0x249)]&&_0x1a5dfb[_0x5930b2(0x1ae)]==_0x4b2772[_0x5930b2(0x1ae)]&&_0x1a5dfb[_0x5930b2(0x1fb)]==_0x4b2772[_0x5930b2(0x1fb)]&&_0x1a5dfb[_0x5930b2(0x1e0)]==_0x4b2772[_0x5930b2(0x1e0)]&&(_0x1a5dfb['product_stock']=parseInt(_0x1a5dfb[_0x5930b2(0x160)])-parseInt(_0x4b2772[_0x5930b2(0x1b2)]));});}),await _0x3a0f8f[_0x2498dd(0x246)]();const {invoice:_0x41c381,suppliers:_0x19c386,date:_0x3cae0b,warehouse_name:_0x5e36e2,prod_name:_0x2a0d20,prod_code:_0x5bfbd9,prod_qty:_0x588f1c,prod_unit:_0x5dafe3,prod_secondunit:_0x3209d5,prod_level:_0x7da8da,prod_isle:_0x3935c7,prod_pallet:_0x494afd,note:_0x490665,expiry_date:_0x4acbec,batch_code:_0x670b75,paid_amount:_0x123b37,due_amount:_0x2954d5,Room_name:_0x56d8bd,primary_code:_0x18f255,secondary_code:_0x105ba3,PO_number:_0x2b9dc2,JO_number:_0x4d08f3}=_0x305919[_0x2498dd(0x19e)];if(typeof _0x2a0d20=='string')var _0x15f9f8=[_0x305919[_0x2498dd(0x19e)]['prod_name']],_0x613899=[_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x185)]],_0x38bf3f=[_0x305919['body'][_0x2498dd(0x1f7)]],_0x24be1c=[_0x305919[_0x2498dd(0x19e)]['prod_unit']],_0x5c8a53=[_0x305919[_0x2498dd(0x19e)]['prod_secondunit']],_0x570fb8=[_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x190)]],_0x15bdcf=[_0x305919[_0x2498dd(0x19e)]['prod_isle']],_0x53be10=[_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x165)]],_0x3f752e=[_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x173)]],_0x6a5891=[_0x305919[_0x2498dd(0x19e)]['secondary_code']],_0x54e885=[_0x305919['body'][_0x2498dd(0x1ac)]],_0x9b3b9b=[_0x305919['body'][_0x2498dd(0x21a)]],_0x202901=[_0x305919['body'][_0x2498dd(0x228)]],_0x1277d1=[_0x305919[_0x2498dd(0x19e)]['storage']],_0x5dfb3e=[_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x221)]],_0x3736e4=[_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x18c)]];else var _0x15f9f8=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x1e6)]],_0x613899=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x185)]],_0x38bf3f=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x1f7)]],_0x24be1c=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x17d)]],_0x5c8a53=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x241)]],_0x570fb8=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x190)]],_0x15bdcf=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x1c9)]],_0x53be10=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x165)]],_0x3f752e=[..._0x305919[_0x2498dd(0x19e)]['primary_code']],_0x6a5891=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x1f5)]],_0x54e885=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x1ac)]],_0x9b3b9b=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x21a)]],_0x202901=[..._0x305919[_0x2498dd(0x19e)]['expiry_date']],_0x1277d1=[..._0x305919[_0x2498dd(0x19e)][_0x2498dd(0x1e0)]],_0x5dfb3e=[..._0x305919['body']['rak']],_0x3736e4=[..._0x305919[_0x2498dd(0x19e)]['type']];const _0x5220bf=_0x15f9f8[_0x2498dd(0x189)](_0x17c80e=>{return _0x17c80e={'product_name':_0x17c80e};});_0x613899[_0x2498dd(0x180)]((_0x2d968c,_0x162420)=>{var _0x376b1a=_0x2498dd;_0x5220bf[_0x162420][_0x376b1a(0x1fe)]=_0x2d968c;}),_0x38bf3f[_0x2498dd(0x180)]((_0x4dd918,_0x12a080)=>{var _0x520bc3=_0x2498dd;_0x5220bf[_0x12a080][_0x520bc3(0x1b2)]=_0x4dd918;}),_0x24be1c[_0x2498dd(0x180)]((_0x3204f5,_0x509d9c)=>{var _0x2e6057=_0x2498dd;_0x5220bf[_0x509d9c][_0x2e6057(0x231)]=_0x3204f5;}),_0x5c8a53[_0x2498dd(0x180)]((_0x25fd70,_0x349ca8)=>{var _0x17795e=_0x2498dd;_0x5220bf[_0x349ca8][_0x17795e(0x14f)]=_0x25fd70;}),_0x570fb8[_0x2498dd(0x180)]((_0x24c404,_0x4e5d4c)=>{var _0x497918=_0x2498dd;_0x5220bf[_0x4e5d4c][_0x497918(0x1ae)]=_0x24c404;}),_0x15bdcf[_0x2498dd(0x180)]((_0x18dd97,_0x458d64)=>{_0x5220bf[_0x458d64]['bin']=_0x18dd97;}),_0x53be10[_0x2498dd(0x180)]((_0x3766d1,_0x267d36)=>{var _0x381392=_0x2498dd;_0x5220bf[_0x267d36][_0x381392(0x164)]=_0x3766d1;}),_0x3f752e['forEach']((_0x43f1a6,_0x3ebf74)=>{_0x5220bf[_0x3ebf74]['primary_code']=_0x43f1a6;}),_0x6a5891[_0x2498dd(0x180)]((_0x14d7ed,_0x1f6094)=>{var _0x11f0af=_0x2498dd;_0x5220bf[_0x1f6094][_0x11f0af(0x1f5)]=_0x14d7ed;}),_0x54e885[_0x2498dd(0x180)]((_0x1d721d,_0x437294)=>{var _0x3bd157=_0x2498dd;_0x5220bf[_0x437294][_0x3bd157(0x235)]=_0x1d721d;}),_0x9b3b9b[_0x2498dd(0x180)]((_0x4c6e31,_0x5aff69)=>{_0x5220bf[_0x5aff69]['batch_code']=_0x4c6e31;}),_0x202901[_0x2498dd(0x180)]((_0x48a28d,_0x259740)=>{var _0x597413=_0x2498dd;_0x5220bf[_0x259740][_0x597413(0x228)]=_0x48a28d;}),_0x3736e4[_0x2498dd(0x180)]((_0xa617d5,_0x4a5df7)=>{var _0x1322d4=_0x2498dd;_0x5220bf[_0x4a5df7][_0x1322d4(0x18c)]=_0xa617d5;}),_0x1277d1['forEach']((_0x2649a3,_0x56626d)=>{_0x5220bf[_0x56626d]['storage']=_0x2649a3;}),_0x5dfb3e[_0x2498dd(0x180)]((_0xcffcf8,_0x15f186)=>{var _0x2c8249=_0x2498dd;_0x5220bf[_0x15f186][_0x2c8249(0x1fb)]=_0xcffcf8;});const _0x9f6070=_0x5220bf[_0x2498dd(0x158)](_0x4b54f3=>_0x4b54f3['quantity']!=='0'&&_0x4b54f3[_0x2498dd(0x1b2)]!=='');_0xaccb8e['invoice']=_0x41c381,_0xaccb8e['suppliers']=_0x19c386,_0xaccb8e['date']=_0x3cae0b,_0xaccb8e['warehouse_name']=_0x5e36e2,_0xaccb8e[_0x2498dd(0x157)]=_0x9f6070,_0xaccb8e[_0x2498dd(0x1a9)]=_0x490665,_0xaccb8e[_0x2498dd(0x148)]=_0x123b37,_0xaccb8e[_0x2498dd(0x1df)]=_0x2954d5,_0xaccb8e[_0x2498dd(0x1d2)]=_0x56d8bd,_0xaccb8e[_0x2498dd(0x243)]=_0x2b9dc2,_0xaccb8e[_0x2498dd(0x202)]=_0x4d08f3;const _0x3290ad=await _0xaccb8e[_0x2498dd(0x246)](),_0xa7895d=await warehouse[_0x2498dd(0x1f3)]({'name':_0x305919[_0x2498dd(0x19e)]['warehouse_name'],'room':_0x305919[_0x2498dd(0x19e)]['Room_name']});_0xaccb8e['product']['forEach'](_0x1c5a18=>{var _0x4edc3b=_0x2498dd,_0x8c7b91=0x0;const _0x35cd1c=_0xa7895d[_0x4edc3b(0x15d)][_0x4edc3b(0x189)](_0x2f781d=>{var _0x44172b=_0x4edc3b;_0x2f781d[_0x44172b(0x1bb)]==_0x1c5a18[_0x44172b(0x1bb)]&&_0x2f781d['floorlevel']==_0x1c5a18[_0x44172b(0x164)]&&_0x2f781d[_0x44172b(0x18c)]==_0x1c5a18[_0x44172b(0x18c)]&&_0x2f781d[_0x44172b(0x249)]==_0x1c5a18['bin']&&_0x2f781d[_0x44172b(0x1ae)]==_0x1c5a18[_0x44172b(0x1ae)]&&_0x2f781d[_0x44172b(0x1fb)]==_0x1c5a18['rack']&&_0x2f781d[_0x44172b(0x1e0)]==_0x1c5a18[_0x44172b(0x1e0)]&&(_0x2f781d['product_stock']=parseInt(_0x2f781d['product_stock'])+parseInt(_0x1c5a18[_0x44172b(0x1b2)]),_0x8c7b91++);});_0x8c7b91=='0'&&(_0xa7895d['product_details']=_0xa7895d[_0x4edc3b(0x15d)]['concat']({'product_name':_0x1c5a18[_0x4edc3b(0x1bb)],'product_stock':_0x1c5a18['quantity'],'primary_code':_0x1c5a18[_0x4edc3b(0x173)],'secondary_code':_0x1c5a18['secondary_code'],'product_code':_0x1c5a18['product_code'],'storage':_0x1c5a18[_0x4edc3b(0x1e0)],'rack':_0x1c5a18[_0x4edc3b(0x1fb)],'bay':_0x1c5a18['bay'],'bin':_0x1c5a18['bin'],'type':_0x1c5a18[_0x4edc3b(0x18c)],'floorlevel':_0x1c5a18[_0x4edc3b(0x164)],'maxProducts':_0x1c5a18[_0x4edc3b(0x235)],'unit':_0x1c5a18[_0x4edc3b(0x231)],'secondary_unit':_0x1c5a18['secondary_unit'],'expiry_date':_0x1c5a18[_0x4edc3b(0x228)]}));}),await _0xa7895d[_0x2498dd(0x246)]();const _0xf00598=await s_payment_data[_0x2498dd(0x1f3)]({'invoice':_0x305919[_0x2498dd(0x19e)][_0x2498dd(0x174)]});if(_0xf00598===null){}else console[_0x2498dd(0x1dc)]('suppliers',_0xf00598,_0x305919['body'][_0x2498dd(0x174)]),_0xf00598[_0x2498dd(0x1c4)]=_0x305919[_0x2498dd(0x19e)]['suppliers'],await _0xf00598[_0x2498dd(0x246)]();_0x305919[_0x2498dd(0x226)]('success',_0x2498dd(0x23f)),_0x5e9675[_0x2498dd(0x16f)](_0x2498dd(0x1b5));}catch(_0x470e95){console[_0x2498dd(0x1dc)](_0x470e95);}}),router[a0_0x6a53cf(0x237)]('/give_payment/:id',auth,async(_0x46cd7d,_0xfe8da2)=>{var _0x3baf7e=a0_0x6a53cf;try{const _0x21969a=_0x46cd7d[_0x3baf7e(0x213)]['id'],{invoice:_0x1f050b,suppliers:_0x23bd74,payable:_0x49e8d9,due_amount:_0x42b3d3}=_0x46cd7d[_0x3baf7e(0x19e)],_0x970acf=await purchases[_0x3baf7e(0x156)](_0x21969a);var _0x330bd4=_0x49e8d9-_0x42b3d3;_0x970acf[_0x3baf7e(0x148)]=parseFloat(_0x970acf[_0x3baf7e(0x148)])+parseFloat(_0x42b3d3),_0x970acf[_0x3baf7e(0x1df)]=_0x330bd4;const _0x33844c=await _0x970acf['save']();console[_0x3baf7e(0x1dc)](_0x33844c);const _0x157b85=await s_payment_data[_0x3baf7e(0x1f3)]({'invoice':_0x1f050b});_0x157b85[_0x3baf7e(0x140)]=_0x330bd4,await _0x157b85[_0x3baf7e(0x246)]();let _0xae1ba4=new Date(),_0x10a448=('0'+_0xae1ba4[_0x3baf7e(0x1d4)]())[_0x3baf7e(0x23c)](-0x2),_0x18f3f0=('0'+(_0xae1ba4['getMonth']()+0x1))[_0x3baf7e(0x23c)](-0x2),_0x245a8d=_0xae1ba4[_0x3baf7e(0x23d)](),_0x737403=_0x245a8d+'-'+_0x18f3f0+'-'+_0x10a448;const _0x60efa4=new suppliers_payment({'invoice':_0x1f050b,'date':_0x245a8d+'-'+_0x18f3f0+'-'+_0x10a448,'suppliers':_0x23bd74,'reason':_0x3baf7e(0x1ff),'amount':_0x42b3d3}),_0x5ae5cf=await _0x60efa4['save']();_0x46cd7d['flash'](_0x3baf7e(0x206),_0x3baf7e(0x22c)),_0xfe8da2[_0x3baf7e(0x16f)]('/all_purchases/view');}catch(_0x556c59){console[_0x3baf7e(0x1dc)](_0x556c59);}}),router[a0_0x6a53cf(0x1ec)](a0_0x6a53cf(0x1b0),auth,async(_0x2eee6f,_0x4e008e)=>{var _0x2e8c0d=a0_0x6a53cf;try{const {username:_0x62b39c,email:_0x1772e8,role:_0x5c7bb4}=_0x2eee6f[_0x2e8c0d(0x1e7)],_0x162887=_0x2eee6f[_0x2e8c0d(0x1e7)],_0x46b6f8=await profile[_0x2e8c0d(0x1f3)]({'email':_0x162887['email']}),_0x58b5ee=await master_shop['find']();console['log'](_0x2e8c0d(0x20c),_0x58b5ee);const _0x44ea11=_0x2eee6f[_0x2e8c0d(0x213)]['id'],_0x216568=await purchases[_0x2e8c0d(0x156)](_0x44ea11);console[_0x2e8c0d(0x1dc)](_0x216568);const _0x2a01ca=await suppliers[_0x2e8c0d(0x1f3)]({'name':_0x216568[_0x2e8c0d(0x1c4)]});console[_0x2e8c0d(0x1dc)](_0x2a01ca);if(_0x58b5ee[0x0][_0x2e8c0d(0x1c1)]=='English\x20(US)'){var _0x3c621d=users[_0x2e8c0d(0x1a7)];console[_0x2e8c0d(0x1dc)](_0x3c621d);}else{if(_0x58b5ee[0x0][_0x2e8c0d(0x1c1)]=='Hindi')var _0x3c621d=users[_0x2e8c0d(0x200)];else{if(_0x58b5ee[0x0][_0x2e8c0d(0x1c1)]==_0x2e8c0d(0x1ce))var _0x3c621d=users[_0x2e8c0d(0x1ce)];else{if(_0x58b5ee[0x0][_0x2e8c0d(0x1c1)]=='Spanish')var _0x3c621d=users[_0x2e8c0d(0x212)];else{if(_0x58b5ee[0x0]['language']=='French')var _0x3c621d=users[_0x2e8c0d(0x14d)];else{if(_0x58b5ee[0x0][_0x2e8c0d(0x1c1)]=='Portuguese\x20(BR)')var _0x3c621d=users[_0x2e8c0d(0x242)];else{if(_0x58b5ee[0x0]['language']==_0x2e8c0d(0x22a))var _0x3c621d=users['Chinese'];else{if(_0x58b5ee[0x0][_0x2e8c0d(0x1c1)]=='Arabic\x20(ae)')var _0x3c621d=users[_0x2e8c0d(0x1f1)];}}}}}}}_0x4e008e[_0x2e8c0d(0x1b3)](_0x2e8c0d(0x17c),{'success':_0x2eee6f[_0x2e8c0d(0x226)](_0x2e8c0d(0x206)),'errors':_0x2eee6f['flash']('errors'),'role':_0x162887,'profile':_0x46b6f8,'master_shop':_0x58b5ee,'supplier':_0x2a01ca,'purchase':_0x216568,'language':_0x3c621d});}catch(_0x1c03ce){console[_0x2e8c0d(0x1dc)](_0x1c03ce);}}),router[a0_0x6a53cf(0x1ec)]('/view/return_purchase/:id',auth,async(_0x1d17c6,_0x42225e)=>{var _0x39cc91=a0_0x6a53cf;try{const {username:_0x316ba8,email:_0x5b657f,role:_0x2dfc72}=_0x1d17c6[_0x39cc91(0x1e7)],_0x45a444=_0x1d17c6[_0x39cc91(0x1e7)],_0x177bad=await profile[_0x39cc91(0x1f3)]({'email':_0x45a444[_0x39cc91(0x20b)]}),_0x514864=await master_shop['find']();console[_0x39cc91(0x1dc)](_0x39cc91(0x20c),_0x514864);const _0x15909d=_0x1d17c6['params']['id'];console['log'](_0x15909d);const _0x229882=await purchases[_0x39cc91(0x156)](_0x15909d);console[_0x39cc91(0x1dc)](_0x39cc91(0x144),_0x229882);const _0x229592=await product['find']({}),_0x423c45=await warehouse[_0x39cc91(0x134)]([{'$match':{'name':_0x229882['warehouse_name'],'room':_0x229882[_0x39cc91(0x1d2)],'warehouse_category':_0x39cc91(0x19b)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x39cc91(0x196),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x39cc91(0x1fd)},'bay':{'$first':_0x39cc91(0x211)},'bin':{'$first':_0x39cc91(0x20f)},'type':{'$first':_0x39cc91(0x1db)},'floorlevel':{'$first':_0x39cc91(0x1cb)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x39cc91(0x1a5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x39cc91(0x163)},'rack':{'$first':_0x39cc91(0x245)}}}]);warehouse_data=await warehouse[_0x39cc91(0x134)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x39cc91(0x19b)}},{'$group':{'_id':_0x39cc91(0x238),'name':{'$first':_0x39cc91(0x238)}}},{'$sort':{'name':0x1}}]),console[_0x39cc91(0x1dc)](_0x39cc91(0x1a8),_0x423c45);if(_0x514864[0x0][_0x39cc91(0x1c1)]==_0x39cc91(0x1b8)){var _0xbab72b=users[_0x39cc91(0x1a7)];console['log'](_0xbab72b);}else{if(_0x514864[0x0][_0x39cc91(0x1c1)]==_0x39cc91(0x200))var _0xbab72b=users[_0x39cc91(0x200)];else{if(_0x514864[0x0]['language']==_0x39cc91(0x1ce))var _0xbab72b=users[_0x39cc91(0x1ce)];else{if(_0x514864[0x0][_0x39cc91(0x1c1)]==_0x39cc91(0x212))var _0xbab72b=users['Spanish'];else{if(_0x514864[0x0][_0x39cc91(0x1c1)]==_0x39cc91(0x14d))var _0xbab72b=users['French'];else{if(_0x514864[0x0][_0x39cc91(0x1c1)]=='Portuguese\x20(BR)')var _0xbab72b=users[_0x39cc91(0x242)];else{if(_0x514864[0x0][_0x39cc91(0x1c1)]==_0x39cc91(0x22a))var _0xbab72b=users['Chinese'];else{if(_0x514864[0x0]['language']==_0x39cc91(0x168))var _0xbab72b=users[_0x39cc91(0x1f1)];}}}}}}}_0x42225e['render']('return_purchase',{'success':_0x1d17c6[_0x39cc91(0x226)]('success'),'errors':_0x1d17c6['flash'](_0x39cc91(0x1ee)),'role':_0x45a444,'profile':_0x177bad,'user':_0x229882,'stock':_0x423c45,'master_shop':_0x514864,'product':_0x229592,'language':_0xbab72b,'warehouse':warehouse_data});}catch(_0x33a096){console[_0x39cc91(0x1dc)](_0x33a096);}}),router[a0_0x6a53cf(0x237)](a0_0x6a53cf(0x141),auth,async(_0x56ca6f,_0x526b9b)=>{var _0x2aa0a9=a0_0x6a53cf;try{const {invoice:_0x3dd5a8,date:_0x4dd12e,warehouse_name:_0x433b49,Room_name:_0x484203,product_name:_0x31e75d,purchase_quantity:_0x7ea13a,stocks:_0x2a8581,return_qty:_0x56b4f5,note:_0x6a0d77,level:_0x34e7b7,isle:_0x31137e,pallet:_0x47272a,to_warehouse_name:_0x1b6f97,to_Room_name:_0xc8db52}=_0x56ca6f[_0x2aa0a9(0x19e)],_0x239bef=await purchases[_0x2aa0a9(0x1f3)]({'_id':_0x56ca6f[_0x2aa0a9(0x213)]['id']}),_0x587420=await warehouse['findOne']({'name':_0x433b49,'room':_0x484203});if(typeof _0x31e75d=='string')var _0x47e85a=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x1bb)]],_0xfb01bb=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x194)]],_0x480ae5=[_0x56ca6f['body']['stocks']],_0x2a436d=[_0x56ca6f[_0x2aa0a9(0x19e)]['return_qty']],_0x36064e=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x12c)]],_0x5b0d34=[_0x56ca6f['body'][_0x2aa0a9(0x216)]],_0x2ae135=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x20a)]],_0x5cfdf3=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x12e)]],_0x812893=[_0x56ca6f[_0x2aa0a9(0x19e)]['product_code_hide']],_0x18ba6a=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x218)]],_0x587d9b=[_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x24f)]];else var _0x47e85a=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x1bb)]],_0xfb01bb=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x194)]],_0x480ae5=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x1a1)]],_0x2a436d=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x181)]],_0x36064e=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x12c)]],_0x5b0d34=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x216)]],_0x2ae135=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x20a)]],_0x5cfdf3=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x12e)]],_0x812893=[..._0x56ca6f[_0x2aa0a9(0x19e)]['product_code_hide']],_0x18ba6a=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x218)]],_0x587d9b=[..._0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x24f)]];const _0x160928=_0x47e85a[_0x2aa0a9(0x189)](_0x45b9ba=>{return _0x45b9ba={'product_name':_0x45b9ba};});_0xfb01bb[_0x2aa0a9(0x180)]((_0x433ba8,_0x39ae0b)=>{_0x160928[_0x39ae0b]['purchase_quantity']=_0x433ba8;}),_0x480ae5[_0x2aa0a9(0x180)]((_0x599098,_0x37bc2c)=>{_0x160928[_0x37bc2c]['stock_quantity']=_0x599098;}),_0x2a436d['forEach']((_0x417285,_0x462d91)=>{var _0x320791=_0x2aa0a9;_0x160928[_0x462d91][_0x320791(0x181)]=_0x417285;}),_0x36064e['forEach']((_0x3cef79,_0x2924ec)=>{_0x160928[_0x2924ec]['bay']=_0x3cef79;}),_0x5b0d34[_0x2aa0a9(0x180)]((_0x3e417f,_0x119d81)=>{var _0x1b6dcf=_0x2aa0a9;_0x160928[_0x119d81][_0x1b6dcf(0x249)]=_0x3e417f;}),_0x2ae135[_0x2aa0a9(0x180)]((_0x174f60,_0x17a173)=>{var _0x33cee1=_0x2aa0a9;_0x160928[_0x17a173][_0x33cee1(0x164)]=_0x174f60;}),_0x5cfdf3[_0x2aa0a9(0x180)]((_0x5b6ee5,_0x2bebb3)=>{var _0x105f60=_0x2aa0a9;_0x160928[_0x2bebb3][_0x105f60(0x18c)]=_0x5b6ee5;}),_0x812893[_0x2aa0a9(0x180)]((_0x50bb89,_0x5c280e)=>{var _0x35c208=_0x2aa0a9;_0x160928[_0x5c280e][_0x35c208(0x1fe)]=_0x50bb89;}),_0x18ba6a[_0x2aa0a9(0x180)]((_0x1fde76,_0x24d8a3)=>{var _0x56b1cd=_0x2aa0a9;_0x160928[_0x24d8a3][_0x56b1cd(0x173)]=_0x1fde76;}),_0x587d9b[_0x2aa0a9(0x180)]((_0x25b5de,_0x199f68)=>{var _0x4edbd7=_0x2aa0a9;_0x160928[_0x199f68][_0x4edbd7(0x1f5)]=_0x25b5de;}),_0x239bef[_0x2aa0a9(0x157)][_0x2aa0a9(0x180)](_0x7d351=>{var _0x3336eb=_0x2aa0a9;const _0x240df9=_0x587420[_0x3336eb(0x15d)][_0x3336eb(0x189)](_0x5e886b=>{var _0x2e6f33=_0x3336eb;_0x5e886b['product_name']==_0x7d351[_0x2e6f33(0x1bb)]&&_0x5e886b['floorlevel']==_0x7d351[_0x2e6f33(0x164)]&&_0x5e886b[_0x2e6f33(0x18c)]==_0x7d351[_0x2e6f33(0x18c)]&&_0x5e886b[_0x2e6f33(0x249)]==_0x7d351[_0x2e6f33(0x249)]&&_0x5e886b[_0x2e6f33(0x1ae)]==_0x7d351[_0x2e6f33(0x1ae)]&&_0x5e886b['rack']==_0x7d351[_0x2e6f33(0x1fb)]&&_0x5e886b[_0x2e6f33(0x1e0)]==_0x7d351[_0x2e6f33(0x1e0)]&&(console[_0x2e6f33(0x1dc)](parseInt(_0x5e886b[_0x2e6f33(0x160)])+_0x2e6f33(0x1b4)+parseInt(_0x7d351['quantity'])),_0x5e886b[_0x2e6f33(0x160)]=parseInt(_0x5e886b[_0x2e6f33(0x160)])+parseInt(_0x7d351[_0x2e6f33(0x1b2)]));});}),await _0x587420['save']();const _0x5006f0=_0x160928[_0x2aa0a9(0x158)](_0x5ae5db=>_0x5ae5db[_0x2aa0a9(0x181)]!=='0'&&_0x5ae5db['return_qty']!=='');var _0x3cb5d2=0x0;_0x5006f0[_0x2aa0a9(0x180)](_0x1c135a=>{var _0x63e36d=_0x2aa0a9;console['log'](_0x63e36d(0x14a),_0x1c135a),(parseInt(_0x1c135a[_0x63e36d(0x194)])<parseInt(_0x1c135a['return_qty'])||parseInt(_0x1c135a[_0x63e36d(0x1e2)])<parseInt(_0x1c135a[_0x63e36d(0x181)]))&&_0x3cb5d2++;});if(_0x3cb5d2!=0x0)return _0x56ca6f[_0x2aa0a9(0x226)](_0x2aa0a9(0x1ee),_0x2aa0a9(0x250)),_0x526b9b[_0x2aa0a9(0x16f)]('back');const _0x3956f0=new purchases_return({'invoice':_0x3dd5a8,'suppliers':_0x56ca6f[_0x2aa0a9(0x19e)]['suppliers'],'date':_0x4dd12e,'warehouse_name':_0x433b49,'return_product':_0x5006f0,'note':_0x6a0d77,'room':_0x484203,'to_warehouse_name':_0x1b6f97,'to_room':_0xc8db52}),_0x219db8=await _0x3956f0[_0x2aa0a9(0x246)]();console[_0x2aa0a9(0x1dc)](_0x3956f0);const _0x4dba0a=await purchases_return['findOne']({'invoice':_0x3dd5a8}),_0x169e4e=await warehouse[_0x2aa0a9(0x1f3)]({'name':_0x1b6f97,'room':_0xc8db52});_0x4dba0a[_0x2aa0a9(0x1f0)][_0x2aa0a9(0x180)](_0x39828a=>{var _0x3c309e=_0x2aa0a9,_0x4449b3=0x0;const _0x455812=_0x169e4e[_0x3c309e(0x15d)]['map'](_0x46dc9a=>{var _0x323ae2=_0x3c309e;_0x46dc9a[_0x323ae2(0x1bb)]==_0x39828a['product_name']&&_0x46dc9a[_0x323ae2(0x164)]==_0x39828a[_0x323ae2(0x164)]&&_0x46dc9a[_0x323ae2(0x18c)]==_0x39828a[_0x323ae2(0x18c)]&&_0x46dc9a[_0x323ae2(0x249)]==_0x39828a[_0x323ae2(0x249)]&&_0x46dc9a[_0x323ae2(0x1ae)]==_0x39828a[_0x323ae2(0x1ae)]&&(_0x46dc9a[_0x323ae2(0x160)]=parseInt(_0x46dc9a[_0x323ae2(0x160)])-parseInt(_0x39828a[_0x323ae2(0x181)]),_0x4449b3++);});_0x4449b3=='0'&&(_0x169e4e['product_details']=_0x169e4e['product_details'][_0x3c309e(0x135)]({'product_name':_0x39828a['product_name'],'product_stock':_0x39828a[_0x3c309e(0x181)],'primary_code':_0x39828a['primary_code'],'secondary_code':_0x39828a[_0x3c309e(0x1f5)],'product_code':_0x39828a['product_code'],'storage':_0x39828a[_0x3c309e(0x1e0)],'rack':_0x39828a[_0x3c309e(0x1fb)],'bay':_0x39828a[_0x3c309e(0x1ae)],'bin':_0x39828a[_0x3c309e(0x249)],'type':_0x39828a[_0x3c309e(0x18c)],'floorlevel':_0x39828a[_0x3c309e(0x164)],'maxProducts':_0x39828a['maxStocks'],'unit':_0x39828a[_0x3c309e(0x231)],'secondary_unit':_0x39828a[_0x3c309e(0x14f)],'expiry_date':_0x39828a['expiry_date']}));}),await _0x169e4e[_0x2aa0a9(0x246)]();const _0x4488ff=await purchases[_0x2aa0a9(0x1f3)]({'invoice':_0x3dd5a8});_0x4488ff[_0x2aa0a9(0x244)]=_0x2aa0a9(0x1eb);const _0x3d8984=await _0x4488ff[_0x2aa0a9(0x246)](),_0xd69d76=new s_payment_data({'invoice':_0x3dd5a8,'suppliers':_0x56ca6f[_0x2aa0a9(0x19e)]['suppliers'],'reason':_0x2aa0a9(0x1de)});await _0xd69d76['save']();const _0x575018=await master_shop['find']();console['log'](_0x2aa0a9(0x204),_0x575018[0x0][_0x2aa0a9(0x205)]);const _0x3680a9=await email_settings[_0x2aa0a9(0x1f3)](),_0x42f45a=await suppliers[_0x2aa0a9(0x1f3)]({'name':_0x56ca6f[_0x2aa0a9(0x19e)][_0x2aa0a9(0x1c4)]});console[_0x2aa0a9(0x1dc)](_0x2aa0a9(0x24c),_0x42f45a);_0x575018[0x0]['currency_placement']==0x1?(right_currency=_0x575018[0x0][_0x2aa0a9(0x20d)],left_currency=''):(right_currency='',left_currency=_0x575018[0x0][_0x2aa0a9(0x20d)]);var _0x45b748=_0x47e85a,_0xfc4c0e=_0x2a436d,_0x41d9ab='',_0x5cce0f;for(_0x5cce0f in _0x45b748){_0x41d9ab+=_0x2aa0a9(0x1c7)+_0x2aa0a9(0x224)+_0x45b748[_0x5cce0f]+_0x2aa0a9(0x150)+_0x2aa0a9(0x224)+_0xfc4c0e[_0x5cce0f]+_0x2aa0a9(0x150)+'</tr>';}console[_0x2aa0a9(0x1dc)](_0x2aa0a9(0x1e4),_0x41d9ab);let _0x5ecdfb=nodemailer['createTransport']({'service':_0x2aa0a9(0x236),'auth':{'user':_0x3680a9[_0x2aa0a9(0x20b)],'pass':_0x3680a9[_0x2aa0a9(0x1d7)]}}),_0x2d0d11={'from':_0x3680a9[_0x2aa0a9(0x20b)],'to':_0x42f45a['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x2aa0a9(0x14c),'path':__dirname+_0x2aa0a9(0x17f)+_0x2aa0a9(0x13f)+_0x575018[0x0][_0x2aa0a9(0x205)],'cid':_0x2aa0a9(0x22b)}],'html':_0x2aa0a9(0x219)+'<html><head><title></title>'+'</head><body>'+_0x2aa0a9(0x1cc)+_0x2aa0a9(0x13d)+_0x2aa0a9(0x1cc)+_0x2aa0a9(0x16b)+'</div>'+_0x2aa0a9(0x1cc)+_0x2aa0a9(0x19a)+_0x575018[0x0][_0x2aa0a9(0x207)]+_0x2aa0a9(0x186)+_0x2aa0a9(0x193)+_0x2aa0a9(0x193)+_0x2aa0a9(0x1bd)+_0x2aa0a9(0x1cc)+_0x2aa0a9(0x14b)+_0x2aa0a9(0x130)+_0x3dd5a8+'\x20'+_0x2aa0a9(0x214)+_0x2aa0a9(0x1d1)+_0x4dd12e+'\x20'+'</span>'+_0x2aa0a9(0x12f)+'</div>'+_0x2aa0a9(0x1bc)+_0x2aa0a9(0x1c5)+_0x2aa0a9(0x1c7)+_0x2aa0a9(0x198)+_0x2aa0a9(0x170)+_0x2aa0a9(0x201)+_0x2aa0a9(0x1af)+'</tr>'+'</thead>'+_0x2aa0a9(0x175)+'\x20'+_0x41d9ab+'\x20'+'</tbody>'+_0x2aa0a9(0x138)+'<div>'+_0x2aa0a9(0x1dd)+'<h5>'+_0x575018[0x0][_0x2aa0a9(0x207)]+_0x2aa0a9(0x12f)+'</div>'+_0x2aa0a9(0x193)+_0x2aa0a9(0x149)};_0x5ecdfb['sendMail'](_0x2d0d11,function(_0x236c8a,_0x1862d3){var _0x420688=_0x2aa0a9;_0x236c8a?(console[_0x420688(0x1dc)](_0x236c8a),console[_0x420688(0x1dc)](_0x420688(0x16d))):console[_0x420688(0x1dc)](_0x420688(0x169));}),_0x56ca6f['flash'](_0x2aa0a9(0x206),'purchases\x20item\x20return\x20successfull'),_0x526b9b['redirect'](_0x2aa0a9(0x1b5));}catch(_0x2193d6){console['log'](_0x2193d6),_0x526b9b[_0x2aa0a9(0x1ba)](0xc8)[_0x2aa0a9(0x233)]({'message':_0x2193d6[_0x2aa0a9(0x1ab)]});}}),router[a0_0x6a53cf(0x1ec)](a0_0x6a53cf(0x1e8),auth,async(_0x26160b,_0x56283d)=>{var _0x2c7331=a0_0x6a53cf;try{const {username:_0x50a5b2,email:_0x57f3a3,role:_0x587417}=_0x26160b[_0x2c7331(0x1e7)],_0x1a09fe=_0x26160b[_0x2c7331(0x1e7)],_0x59039b=await profile['findOne']({'email':_0x1a09fe[_0x2c7331(0x20b)]}),_0x1481f3=await master_shop[_0x2c7331(0x222)](),_0x26a4a6=_0x26160b[_0x2c7331(0x213)]['id'],_0x367ab9=await purchases['findById'](_0x26a4a6);if(_0x1481f3[0x0]['language']=='English\x20(US)')var _0x5ae033=users[_0x2c7331(0x1a7)];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]==_0x2c7331(0x200))var _0x5ae033=users[_0x2c7331(0x200)];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]==_0x2c7331(0x1ce))var _0x5ae033=users[_0x2c7331(0x1ce)];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]=='Spanish')var _0x5ae033=users['Spanish'];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]==_0x2c7331(0x14d))var _0x5ae033=users[_0x2c7331(0x14d)];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]==_0x2c7331(0x23b))var _0x5ae033=users[_0x2c7331(0x242)];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]==_0x2c7331(0x22a))var _0x5ae033=users[_0x2c7331(0x22a)];else{if(_0x1481f3[0x0][_0x2c7331(0x1c1)]==_0x2c7331(0x168))var _0x5ae033=users[_0x2c7331(0x1f1)];}}}}}}}_0x56283d['render'](_0x2c7331(0x1ea),{'success':_0x26160b['flash'](_0x2c7331(0x206)),'errors':_0x26160b['flash'](_0x2c7331(0x1ee)),'role':_0x1a09fe,'profile':_0x59039b,'alldata':_0x367ab9,'master_shop':_0x1481f3,'language':_0x5ae033}),console[_0x2c7331(0x1dc)](alldata);}catch(_0x3ada1c){console[_0x2c7331(0x1dc)](_0x3ada1c);}}),router[a0_0x6a53cf(0x237)](a0_0x6a53cf(0x1be),async(_0x13b2b6,_0x2ffd7b)=>{var _0x381450=a0_0x6a53cf;const {product_code:_0x58e48c}=_0x13b2b6[_0x381450(0x19e)];var _0x16d14f;const _0x45263e=await product[_0x381450(0x134)]([{'$match':{'primary_code':_0x58e48c,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x381450(0x195)},'brand':{'$first':_0x381450(0x19f)},'unit':{'$first':_0x381450(0x129)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x381450(0x197)},'primary_code':{'$first':_0x381450(0x21b)},'secondary_code':{'$first':_0x381450(0x1cd)},'maxStocks':{'$first':_0x381450(0x1aa)},'maxProdPerUnit':{'$first':_0x381450(0x230)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x41d5eb=await product['aggregate']([{'$match':{'secondary_code':_0x58e48c,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x381450(0x187),'name':{'$first':'$name'},'category':{'$first':_0x381450(0x195)},'brand':{'$first':_0x381450(0x19f)},'unit':{'$first':_0x381450(0x129)},'alertquantity':{'$first':_0x381450(0x152)},'product_code':{'$first':_0x381450(0x197)},'primary_code':{'$first':_0x381450(0x21b)},'secondary_code':{'$first':_0x381450(0x1cd)},'maxStocks':{'$first':_0x381450(0x1aa)},'maxProdPerUnit':{'$first':_0x381450(0x230)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x381450(0x215)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x45263e[_0x381450(0x1fa)]>0x0)_0x16d14f=_0x45263e;else _0x41d5eb[_0x381450(0x1fa)]>0x0&&(_0x16d14f=_0x41d5eb);_0x2ffd7b[_0x381450(0x233)](_0x16d14f);}),router[a0_0x6a53cf(0x237)](a0_0x6a53cf(0x232),async(_0x291e13,_0x510d24)=>{var _0x45de6e=a0_0x6a53cf;const {primaryCode:_0xb6460c,secondaryCode:_0x36f3bf,productCode:_0x139f2f,bay:_0x51722d,bin:_0x38c967,types:_0x448f0d,pallet:_0x4c6419,warehouses:_0x4a2a40,room:_0x5412ed}=_0x291e13['body'];console[_0x45de6e(0x1dc)](_0x291e13[_0x45de6e(0x19e)]);try{const _0x4f26eb=await warehouse[_0x45de6e(0x134)]([{'$match':{'name':_0x4a2a40,'room':_0x5412ed}},{'$unwind':_0x45de6e(0x1da)},{'$match':{'product_details.bay':_0x51722d,'product_details.bin':_0x38c967,'product_details.type':_0x448f0d}},{'$group':{'_id':_0x45de6e(0x196),'name':{'$first':_0x45de6e(0x1e9)},'product_stock':{'$first':_0x45de6e(0x1fd)},'level':{'$first':_0x45de6e(0x203)},'isle':{'$first':_0x45de6e(0x12a)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x45de6e(0x1bf)}}}]);_0x510d24[_0x45de6e(0x1ba)](0xc8)[_0x45de6e(0x233)](_0x4f26eb);}catch(_0x26b611){_0x510d24[_0x45de6e(0x1ba)](0x194)[_0x45de6e(0x233)]({'message':_0x26b611[_0x45de6e(0x1ab)]});}}),module['exports']=router;