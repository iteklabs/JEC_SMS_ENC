var a0_0xbe6af6=a0_0x2c98;(function(_0x1ab47a,_0x4508f1){var _0x1e873c=a0_0x2c98,_0x1e3893=_0x1ab47a();while(!![]){try{var _0x42f8c0=-parseInt(_0x1e873c(0x121))/0x1*(parseInt(_0x1e873c(0xa7))/0x2)+-parseInt(_0x1e873c(0xad))/0x3*(-parseInt(_0x1e873c(0x1bf))/0x4)+parseInt(_0x1e873c(0x124))/0x5*(-parseInt(_0x1e873c(0x10c))/0x6)+-parseInt(_0x1e873c(0x19e))/0x7+-parseInt(_0x1e873c(0xda))/0x8*(parseInt(_0x1e873c(0x1a9))/0x9)+-parseInt(_0x1e873c(0x17f))/0xa+-parseInt(_0x1e873c(0x14d))/0xb*(-parseInt(_0x1e873c(0xe1))/0xc);if(_0x42f8c0===_0x4508f1)break;else _0x1e3893['push'](_0x1e3893['shift']());}catch(_0xeafae5){_0x1e3893['push'](_0x1e3893['shift']());}}}(a0_0x27aa,0xa9671));function a0_0x27aa(){var _0x3b70ea=['$product_details.storage','INC-','/preview/:id','</table>','/all_purchases/view','params','name','899rVVXDc','Receiving\x20Area','push','3445qSsztu','Return\x20Goods','getDate','floorlevel','rak','quantity','$maxStocks','Portuguese','MaxStocks_data','find','$name','deliverycode','maxStocks','/CheckingWarehouse','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','floor','prod_pallet','production_date','English\x20(US)','<html><head><title></title>','random','storage','padStart','secondary_code_hide','$product_details.type','edit_purchases_view','batch_code','<h2>\x20','$primary_code','standard_unit','Email\x20sent\x20successfully','abs','Purchase\x20Return','$warehouse_name','types','$product','Hindi','$product_details.rack','foreach\x20newproduct','suppliers','9218NQEHYL','log','/barcode_scanner','return_purchase','add_purchases\x20error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<h5>','/view/return_purchase/:id','primary_code_hide','invoice','error','delivery_date','all_purchases','add\x20post','$suppliers','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_isle','prod_primunit','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Arabic\x20(ae)','Rack\x20D','product_code_hide','\x20Order\x20Number\x20:\x20','errors','staff','$brand','currency_placement','language','getMonth','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$expiry_date','$product_details.maxProducts','prod_Qty','purchase\x20data\x20update\x20successfully','nodemailer','$product_details._id','$note','get','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_list','$_id','purchase_quantity','product_stock','actual_qty','host','../models/all_models','status','$finalize','json','7262930BgUMSi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','../middleware/auth','prod_secondunit','currency','Spanish','$product.type','$product_details.pallet','secondary_code','master','amount','$product_details.product_name','concat','Error\x20Occurs','here','True','stocks','findOne','<h5\x20style=\x22text-align:\x20left;\x22>','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</span>','$maxProdPerUnit','German','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Portuguese\x20(BR)','prod_code','level','then','POnumber','8138137aIWIGp','sendMail','$return_data','bay','primary_code','user','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details','\x20Order\x20Date\x20:\x20','slice','return_data','2394mPYLLQ','delivery_code','email','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','RoomAssign','$secondary_code','$product_details.product_stock','paid_amount','Purchase\x20data\x20added\x20successfully','stock_quantity','add_purchases','map','string','$product_details.floorlevel','stock_data','JO_number','back','<div>','suppliers_data','site_title','filter','232QSXfoy','product','Purchase\x20Return\x20Mail','$product_details.level','</h5>','return_product','Logo.png','$unit','prod_cat','/view/add_purchases/:id','room','/../public','length','Rack\x20F','/upload/','</tr>','$product_details.secondary_code','2270ligtlz','express','COLD\x20STORAGE','French','port','exports','65202vARGdT','type','$secondary_unit','Raw\x20Materials','bin','pallet','</td>','flash','product_details','/view','<hr\x20class=\x22my-3\x22>','warehouse','path','product_name','body','createTransport','Floor','$product_details.isle','/invoice/:id','Room_name','product_code','<tr>','getFullYear','message','Rack\x20C','catch','rack','purchase_invoice','role','finalize','/view/:id','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','actual_uom','/barcode/:id','table\x20page','secondary_unit','maxperunit','$invoice','success','post','An\x20error\x20occurred.','$product.floorlevel','prod_name','room_name','36056BVPmnv','date','$date','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Enabled','return_qty','53100WSdPCE','$paid_amount','/view/add_purchases','$due_amount','<span\x20style=\x22float:\x20right;\x22>','$product.quantity','logo','user_id','</head><body>','RMSEmail','<!DOCTYPE\x20html>','suppliers_docs','gmail','prod_invoice','$product_details.product_code','$product_details.bay','all_purchases_barcode','</thead>','edit_purchases','prod_level','$product_details.primary_code','\x20<\x20wew\x20>\x20','</body></html>','expiry_date','</div>','forEach','\x20<>\x20','max_product_unit','alertQTY','note','An\x20error\x20occurred\x20while\x20saving\x20data.','Arabic','$product.bay','English','password','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_cat','$alertquantity','Chinese','warehouse_name','prod_unit','<strong>\x20Regards\x20</strong>','1452TbqEKu','$suppliers_docs','Rack\x20B','Level','due_amount','image','prod_qty','Ambient','\x20</h2>','render','findById','aggregate','Rack\x20A','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'];a0_0x27aa=function(){return _0x3b70ea;};return a0_0x27aa();}const express=require(a0_0xbe6af6(0xa8)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xbe6af6(0x17b)),auth=require(a0_0xbe6af6(0x181)),nodemailer=require(a0_0xbe6af6(0x170));var ejs=require('ejs');const path=require(a0_0xbe6af6(0xb9)),users=require(a0_0xbe6af6(0xcc));router['get'](a0_0xbe6af6(0xb6),auth,async(_0x50b409,_0x339e89)=>{var _0x54ebc0=a0_0xbe6af6;try{const {username:_0x497ea3,email:_0x3f7ad9,role:_0x4621a7}=_0x50b409[_0x54ebc0(0x1a3)],_0x20b167=_0x50b409[_0x54ebc0(0x1a3)],_0x37e7d7=await profile[_0x54ebc0(0x190)]({'email':_0x20b167['email']}),_0x3c653c=await staff[_0x54ebc0(0x190)]({'email':_0x20b167[_0x54ebc0(0x1ab)]});if(_0x20b167['role']==_0x54ebc0(0x166)){const _0x4c254e=await staff['findOne']({'email':_0x20b167[_0x54ebc0(0x1ab)]});}const _0x398668=await master_shop[_0x54ebc0(0x12d)]();let _0x4b8901;if(_0x20b167[_0x54ebc0(0xc9)]==_0x54ebc0(0x166)){const _0x43a30f=await staff['findOne']({'email':_0x20b167[_0x54ebc0(0x1ab)]});_0x4b8901=await purchases[_0x54ebc0(0x117)]([{'$match':{'warehouse_name':_0x43a30f[_0x54ebc0(0xb8)]}},{'$lookup':{'from':_0x54ebc0(0x14c),'localField':_0x54ebc0(0x14c),'foreignField':_0x54ebc0(0x120),'as':_0x54ebc0(0xec)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x54ebc0(0x176),'invoice':{'$first':_0x54ebc0(0xd3)},'suppliers':{'$first':_0x54ebc0(0x15b)},'date':{'$first':_0x54ebc0(0xdc)},'warehouse_name':{'$first':_0x54ebc0(0x146)},'room':{'$first':'$room'},'product':{'$push':_0x54ebc0(0x148)},'note':{'$first':_0x54ebc0(0x172)},'paid_amount':{'$first':_0x54ebc0(0xe2)},'due_amount':{'$first':_0x54ebc0(0xe4)},'return_data':{'$first':_0x54ebc0(0x1a0)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x54ebc0(0x16c)},'suppliers_docs':{'$first':_0x54ebc0(0x10d)},'total_product_quantity':{'$sum':_0x54ebc0(0xe6)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x54ebc0(0xd7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4b8901=await purchases[_0x54ebc0(0x117)]([{'$lookup':{'from':_0x54ebc0(0x14c),'localField':'suppliers','foreignField':_0x54ebc0(0x120),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x54ebc0(0x176),'invoice':{'$first':_0x54ebc0(0xd3)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x54ebc0(0xdc)},'warehouse_name':{'$first':_0x54ebc0(0x146)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x54ebc0(0xe2)},'due_amount':{'$first':_0x54ebc0(0xe4)},'return_data':{'$first':_0x54ebc0(0x1a0)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x54ebc0(0x16c)},'suppliers_docs':{'$first':_0x54ebc0(0x10d)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x54ebc0(0x101)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x54ebc0(0x185)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x54ebc0(0x17d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x398668[0x0][_0x54ebc0(0x169)]==_0x54ebc0(0x137)){var _0xab1eba=users[_0x54ebc0(0x102)];console[_0x54ebc0(0x14e)](_0xab1eba);}else{if(_0x398668[0x0][_0x54ebc0(0x169)]=='Hindi')var _0xab1eba=users[_0x54ebc0(0x149)];else{if(_0x398668[0x0]['language']==_0x54ebc0(0x196))var _0xab1eba=users['German'];else{if(_0x398668[0x0][_0x54ebc0(0x169)]==_0x54ebc0(0x184))var _0xab1eba=users['Spanish'];else{if(_0x398668[0x0][_0x54ebc0(0x169)]=='French')var _0xab1eba=users[_0x54ebc0(0xaa)];else{if(_0x398668[0x0][_0x54ebc0(0x169)]==_0x54ebc0(0x199))var _0xab1eba=users['Portuguese'];else{if(_0x398668[0x0][_0x54ebc0(0x169)]=='Chinese')var _0xab1eba=users['Chinese'];else{if(_0x398668[0x0][_0x54ebc0(0x169)]==_0x54ebc0(0x161))var _0xab1eba=users['Arabic'];}}}}}}}_0x339e89[_0x54ebc0(0x115)](_0x54ebc0(0x159),{'success':_0x50b409[_0x54ebc0(0xb4)](_0x54ebc0(0xd4)),'errors':_0x50b409[_0x54ebc0(0xb4)](_0x54ebc0(0x165)),'purchases':_0x4b8901,'role':_0x20b167,'profile':_0x37e7d7,'master_shop':_0x398668,'language':_0xab1eba});}catch(_0x6f94f9){console[_0x54ebc0(0x14e)](_0x54ebc0(0xd0),_0x6f94f9),_0x339e89['status'](0xc8)[_0x54ebc0(0x17e)]({'message':_0x6f94f9[_0x54ebc0(0xc4)]});}});function BayBinSelected(_0x127c0e,_0x179dcf){var _0x1c2234=a0_0xbe6af6,_0x570329=[],_0x5cbdb4=[],_0x42a65f=[],_0x3362fb=[],_0x52decf=[],_0x3d0399=[];let _0x100114=[];if(_0x127c0e=='DRY\x20STORAGE')switch(_0x179dcf){case _0x1c2234(0x118):_0x570329=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5cbdb4=[0x1,0x2],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['D'],_0x3d0399=['A'];break;case'Rack\x20B':_0x570329=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5cbdb4=[0x1,0x2],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['D'],_0x3d0399=['B'];break;case'Shelves':_0x570329=[0x0],_0x5cbdb4=[0x0],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0xbd)],_0x52decf=['D'],_0x3d0399=['S'];break;case _0x1c2234(0x122):_0x570329=[0x0],_0x5cbdb4=[0x0],_0x3362fb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x42a65f=['Floor'],_0x52decf=['D'],_0x3d0399=['R'];break;}else{if(_0x127c0e==_0x1c2234(0xa9))switch(_0x179dcf){case'Rack\x20A':_0x570329=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5cbdb4=['B','F'],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['C'],_0x3d0399=['A'];break;case _0x1c2234(0x10e):_0x570329=[0x5,0x4,0x3,0x2,0x1],_0x5cbdb4=['F','B','S'],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['C'],_0x3d0399=['B'];break;case _0x1c2234(0xc5):_0x570329=[0x1,0x2,0x3,0x4,0x5],_0x5cbdb4=['B','F','S'],_0x3362fb=[0x5,0x4,0x3,0x2,0x1],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['C'],_0x3d0399=['C'];break;case _0x1c2234(0x162):_0x570329=[0x5,0x4,0x3,0x2,0x1],_0x5cbdb4=['F','B','S'],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['C'],_0x3d0399=['D'];break;case'Rack\x20E':_0x570329=[0x4,0x3,0x2,0x1],_0x5cbdb4=[0x1,0x2],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f),_0x1c2234(0xbd)],_0x52decf=['C'],_0x3d0399=['E'];break;case _0x1c2234(0xa3):_0x570329=[0x1,0x2,0x3],_0x5cbdb4=[0x1,0x2],_0x3362fb=[0x1,0x2,0x3,0x4,0x5],_0x42a65f=[_0x1c2234(0x10f)],_0x52decf=['C'],_0x3d0399=['F'];break;}}return{'levels':_0x570329,'Isle':_0x5cbdb4,'rack':_0x3362fb,'type':_0x42a65f,'storage':_0x52decf,'rak':_0x3d0399};}function a0_0x2c98(_0x30feba,_0x55558b){var _0x27aaea=a0_0x27aa();return a0_0x2c98=function(_0x2c9820,_0x2e68af){_0x2c9820=_0x2c9820-0xa0;var _0x27eb25=_0x27aaea[_0x2c9820];return _0x27eb25;},a0_0x2c98(_0x30feba,_0x55558b);}async function getRandom8DigitNumber(){var _0x4a5a92=a0_0xbe6af6;const _0xe91c9c=0x989680,_0x3f0b5f=0x5f5e0ff,_0x46846b=Math[_0x4a5a92(0x134)](Math[_0x4a5a92(0x139)]()*(_0x3f0b5f-_0xe91c9c+0x1))+_0xe91c9c;var _0x227da0;const _0x3451f0=await purchases[_0x4a5a92(0x190)]({'invoice':_0x4a5a92(0x11b)+_0x46846b});return _0x3451f0&&_0x3451f0[_0x4a5a92(0xa2)]>0x0?_0x227da0=_0x4a5a92(0x11b)+_0x46846b:_0x227da0=_0x4a5a92(0x11b)+_0x46846b,_0x227da0;}router['get'](a0_0xbe6af6(0xe3),auth,async(_0x1668e3,_0x1c9ffe)=>{var _0x28e2e2=a0_0xbe6af6;try{const {username:_0x4164ec,email:_0x901e14,role:_0x542b22}=_0x1668e3['user'],_0x34373e=_0x1668e3['user'],_0x9aa681=await profile['findOne']({'email':_0x34373e[_0x28e2e2(0x1ab)]}),_0x12b758=await master_shop[_0x28e2e2(0x12d)](),_0xfa4d19=await staff[_0x28e2e2(0x190)]({'email':_0x34373e['email']}),_0x1c6db6=await suppliers[_0x28e2e2(0x12d)]({});let _0x2aa91e;if(_0x34373e['role']=='staff'){const _0x26af2b=await staff[_0x28e2e2(0x190)]({'email':_0x34373e[_0x28e2e2(0x1ab)]});_0x2aa91e=await warehouse[_0x28e2e2(0x117)]([{'$match':{'status':'Enabled','name':_0x26af2b[_0x28e2e2(0xb8)],'warehouse_category':_0x28e2e2(0xb0),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x2aa91e=await warehouse[_0x28e2e2(0x117)]([{'$match':{'status':_0x28e2e2(0xdf),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x28e2e2(0x125)}}},{'$group':{'_id':'$name','name':{'$first':_0x28e2e2(0x12e)}}}]);const _0x5d21e9=await product[_0x28e2e2(0x12d)]({}),_0x207d93=await warehouse[_0x28e2e2(0x12d)]({'status':'Enabled'}),_0x4cfe46=await purchases[_0x28e2e2(0x12d)]({}),_0xdd7c50=_0x4cfe46['length']+0x1,_0x5a4497=_0x28e2e2(0x11b)+_0xdd7c50['toString']()[_0x28e2e2(0x13b)](0x5,'0');var _0x475a98=[_0x28e2e2(0x113),'Enclosed'];if(_0x12b758[0x0]['language']==_0x28e2e2(0x137))var _0x1518ed=users[_0x28e2e2(0x102)];else{if(_0x12b758[0x0][_0x28e2e2(0x169)]==_0x28e2e2(0x149))var _0x1518ed=users[_0x28e2e2(0x149)];else{if(_0x12b758[0x0]['language']=='German')var _0x1518ed=users['German'];else{if(_0x12b758[0x0][_0x28e2e2(0x169)]==_0x28e2e2(0x184))var _0x1518ed=users[_0x28e2e2(0x184)];else{if(_0x12b758[0x0][_0x28e2e2(0x169)]==_0x28e2e2(0xaa))var _0x1518ed=users['French'];else{if(_0x12b758[0x0][_0x28e2e2(0x169)]==_0x28e2e2(0x199))var _0x1518ed=users[_0x28e2e2(0x12b)];else{if(_0x12b758[0x0][_0x28e2e2(0x169)]==_0x28e2e2(0x108))var _0x1518ed=users[_0x28e2e2(0x108)];else{if(_0x12b758[0x0][_0x28e2e2(0x169)]==_0x28e2e2(0x161))var _0x1518ed=users['Arabic'];}}}}}}}const _0x42cd38=getRandom8DigitNumber();_0x42cd38[_0x28e2e2(0x19c)](_0x87861d=>{var _0x3b930f=_0x28e2e2;_0x1c9ffe[_0x3b930f(0x115)](_0x3b930f(0x1b4),{'success':_0x1668e3[_0x3b930f(0xb4)](_0x3b930f(0xd4)),'errors':_0x1668e3[_0x3b930f(0xb4)](_0x3b930f(0x165)),'role':_0x34373e,'profile':_0x9aa681,'suppliers':_0x1c6db6,'warehouse':_0x2aa91e,'product':_0x5d21e9,'invoice':_0x87861d,'master_shop':_0x12b758,'language':_0x1518ed,'find_data':_0x207d93,'rooms_data':_0x475a98});})['catch'](_0x351610=>{var _0x2d34a4=_0x28e2e2;_0x1668e3['flash'](_0x2d34a4(0x165),_0x2d34a4(0x1ac)),_0x1c9ffe[_0x2d34a4(0x192)](_0x2d34a4(0x11e));});}catch(_0xc3ed5a){console[_0x28e2e2(0x14e)](_0xc3ed5a);}}),router[a0_0xbe6af6(0x173)](a0_0xbe6af6(0x1c8),auth,async(_0x2668ad,_0xa12360)=>{var _0x2aed02=a0_0xbe6af6;try{const _0x5c21fc=_0x2668ad['params']['id'];console[_0x2aed02(0x14e)](_0x5c21fc);const _0x2fdd6f=await master_shop[_0x2aed02(0x12d)]();console[_0x2aed02(0x14e)](_0x2aed02(0x188),_0x2fdd6f);const _0x5efa32=await product[_0x2aed02(0x190)]({'name':_0x5c21fc});console[_0x2aed02(0x14e)]('product',_0x5efa32),_0xa12360[_0x2aed02(0x17c)](0xc8)['json']({'product_data':_0x5efa32,'master':_0x2fdd6f});}catch(_0x280a10){console[_0x2aed02(0x14e)](_0x2aed02(0x151),_0x280a10);}}),router[a0_0xbe6af6(0xd5)](a0_0xbe6af6(0xe3),auth,async(_0x2d6c0a,_0x573432)=>{var _0x324589=a0_0xbe6af6;try{const {invoice:_0x4785de,date:_0x32960e,warehouse_name:_0x2e8e7f,prod_name:_0x52845b,prod_code:_0x328cbc,prod_qty:_0x2b3c84,prod_unit:_0x5c3107,prod_secondunit:_0x5a2213,prod_level:_0x521b85,prod_isle:_0xaaae6f,prod_pallet:_0x10ed84,note:_0x10d332,expiry_date:_0x18adb6,batch_code:_0x3b4118,payable:_0x363258,due_amount:_0x1d783d,Room_name:_0x3e33ba,primary_code:_0x486610,secondary_code:_0x1e7a7c,MaxStocks_data:_0x21867c,PO_number:_0x11218d,SCRN:_0x3f8539,JO_number:_0x5b2ceb}=_0x2d6c0a[_0x324589(0xbb)];if(typeof _0x52845b==_0x324589(0x1b6))var _0x5b6f2d=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0xd8)]],_0x1c954d=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x19a)]],_0x5ea088=[_0x2d6c0a['body'][_0x324589(0x16e)]],_0x48141e=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x15e)]],_0x1a5401=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x182)]],_0x5d52cc=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0xf4)]],_0x290add=[_0x2d6c0a['body'][_0x324589(0x1a2)]],_0x249a4f=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x187)]],_0x52b4e0=[_0x2d6c0a['body']['MaxStocks_data']],_0x29486b=[_0x2d6c0a[_0x324589(0xbb)]['batch_code']],_0xd37525=[_0x2d6c0a['body'][_0x324589(0xf8)]],_0x1ebfe9=[_0x2d6c0a['body'][_0x324589(0xfc)]],_0xba383c=[_0x2d6c0a['body']['alertQTY']],_0x5509c7=[_0x2d6c0a['body'][_0x324589(0x136)]],_0x746fe3=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x1c7)]],_0x29e7d9=[_0x2d6c0a['body'][_0x324589(0x1ae)]],_0x2861af=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x12f)]],_0x1f086f=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0xee)]],_0x4eb8bf=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x179)]],_0x19ef24=[_0x2d6c0a[_0x324589(0xbb)][_0x324589(0xce)]];else var _0x5b6f2d=[..._0x2d6c0a[_0x324589(0xbb)]['prod_name']],_0x1c954d=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x19a)]],_0x5ea088=[..._0x2d6c0a[_0x324589(0xbb)]['prod_Qty']],_0x48141e=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x15e)]],_0x1a5401=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x182)]],_0x5d52cc=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0xf4)]],_0x290add=[..._0x2d6c0a['body']['primary_code']],_0x249a4f=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x187)]],_0x52b4e0=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x12c)]],_0x29486b=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x13f)]],_0xd37525=[..._0x2d6c0a[_0x324589(0xbb)]['expiry_date']],_0x1ebfe9=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0xfc)]],_0xba383c=[..._0x2d6c0a[_0x324589(0xbb)]['alertQTY']],_0x5509c7=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x136)]],_0x746fe3=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x1c7)]],_0x29e7d9=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0x1ae)]],_0x2861af=[..._0x2d6c0a[_0x324589(0xbb)]['deliverycode']],_0x1f086f=[..._0x2d6c0a[_0x324589(0xbb)][_0x324589(0xee)]],_0x4eb8bf=[..._0x2d6c0a['body']['actual_qty']],_0x19ef24=[..._0x2d6c0a[_0x324589(0xbb)]['actual_uom']];const _0x19c9a2=_0x5b6f2d['map'](_0x2db21a=>{return _0x2db21a={'product_name':_0x2db21a};});_0x4eb8bf[_0x324589(0xfa)]((_0x10b894,_0x52150a)=>{var _0x32a19d=_0x324589;_0x19c9a2[_0x52150a]['actual_qty']=Math[_0x32a19d(0x144)](_0x10b894);}),_0x19ef24[_0x324589(0xfa)]((_0x5dc1a9,_0x11e20e)=>{var _0x5862d6=_0x324589;_0x19c9a2[_0x11e20e][_0x5862d6(0xce)]=_0x5dc1a9;}),_0x1c954d[_0x324589(0xfa)]((_0x41b370,_0x4ecba2)=>{var _0x439b3f=_0x324589;_0x19c9a2[_0x4ecba2][_0x439b3f(0xc1)]=_0x41b370;}),_0x5ea088[_0x324589(0xfa)]((_0x238514,_0x31fd8f)=>{var _0xe0d4d=_0x324589;_0x19c9a2[_0x31fd8f][_0xe0d4d(0x129)]=Math[_0xe0d4d(0x144)](_0x238514);}),_0x48141e[_0x324589(0xfa)]((_0x3eb2ee,_0x4d392b)=>{var _0x182afa=_0x324589;_0x19c9a2[_0x4d392b][_0x182afa(0x142)]=_0x3eb2ee;}),_0x1a5401[_0x324589(0xfa)]((_0x122fee,_0x363a91)=>{var _0x1df5c2=_0x324589;_0x19c9a2[_0x363a91][_0x1df5c2(0xd1)]=_0x122fee;}),_0x5d52cc['forEach']((_0x5238df,_0x59ab1b)=>{var _0xd52f52=_0x324589;_0x29e7d9[_0xd52f52(0xfa)]((_0xc58091,_0x10114e)=>{var _0x57d3b3=_0xd52f52;if(_0xc58091==_0x57d3b3(0x122)&&_0x59ab1b==_0x10114e){console[_0x57d3b3(0x14e)](_0xc58091+_0x57d3b3(0xf6)+_0x59ab1b+_0x57d3b3(0xfb)+_0x10114e+_0x57d3b3(0xfb)+_0x5238df);var _0x582637=_0x5238df[_0x57d3b3(0x1a7)](0x3);_0x19c9a2[_0x59ab1b][_0x57d3b3(0x13a)]=_0x5238df[0x0],_0x19c9a2[_0x59ab1b][_0x57d3b3(0xc7)]=_0x5238df[0x1],_0x19c9a2[_0x59ab1b][_0x57d3b3(0x1a1)]=0x0,_0x19c9a2[_0x59ab1b][_0x57d3b3(0xb1)]=0x0,_0x19c9a2[_0x59ab1b]['type']='Floor',_0x19c9a2[_0x59ab1b]['floorlevel']=_0x582637;}else{if(_0xc58091==_0x57d3b3(0xdd)&&_0x59ab1b==_0x10114e){var _0x582637=_0x5238df[_0x57d3b3(0x1a7)](0x3);_0x19c9a2[_0x59ab1b][_0x57d3b3(0x13a)]=_0x5238df[0x0],_0x19c9a2[_0x59ab1b][_0x57d3b3(0xc7)]=_0x5238df[0x1],_0x19c9a2[_0x59ab1b][_0x57d3b3(0x1a1)]=0x0,_0x19c9a2[_0x59ab1b][_0x57d3b3(0xb1)]=0x0,_0x19c9a2[_0x59ab1b][_0x57d3b3(0xae)]=_0x57d3b3(0xbd),_0x19c9a2[_0x59ab1b][_0x57d3b3(0x127)]=_0x5238df[0x5];}else{if(_0x59ab1b==_0x10114e){if(_0x5238df[0x0]=='A'&&_0x5238df[0x1]=='L'&&_0x5238df[0x2]=='L')console['log'](_0xc58091+_0x57d3b3(0xfb)+_0x59ab1b+_0x57d3b3(0xfb)+_0x10114e+_0x57d3b3(0xfb)+_0x5238df+_0x57d3b3(0x18d)),_0x19c9a2[_0x59ab1b]['storage']=_0x5238df[0x0],_0x19c9a2[_0x59ab1b][_0x57d3b3(0xc7)]=_0x5238df[0x1],_0x19c9a2[_0x59ab1b]['bay']=0x0,_0x19c9a2[_0x59ab1b][_0x57d3b3(0xb1)]=0x0,_0x19c9a2[_0x59ab1b]['type']=_0x57d3b3(0xbd),_0x19c9a2[_0x59ab1b]['floorlevel']=_0x5238df[0x3];else{var _0x10d335;if(_0x5238df[0x4]=='L')_0x10d335=_0x57d3b3(0x10f);else _0x5238df[0x4]=='F'&&(_0x10d335='Floor');_0x19c9a2[_0x59ab1b][_0x57d3b3(0x13a)]=_0x5238df[0x0],_0x19c9a2[_0x59ab1b]['rack']=_0x5238df[0x1],_0x19c9a2[_0x59ab1b]['bay']=_0x5238df[0x2],_0x19c9a2[_0x59ab1b][_0x57d3b3(0xb1)]=_0x5238df[0x3],_0x19c9a2[_0x59ab1b][_0x57d3b3(0xae)]=_0x10d335,_0x19c9a2[_0x59ab1b][_0x57d3b3(0x127)]=_0x5238df[0x5];}}}}});}),_0x290add[_0x324589(0xfa)]((_0x541cf9,_0x194769)=>{var _0x17b664=_0x324589;_0x19c9a2[_0x194769][_0x17b664(0x1a2)]=_0x541cf9;}),_0x249a4f[_0x324589(0xfa)]((_0x247988,_0x25777)=>{_0x19c9a2[_0x25777]['secondary_code']=_0x247988;}),_0x52b4e0[_0x324589(0xfa)]((_0x25d9cc,_0x304f11)=>{var _0x27a439=_0x324589;_0x19c9a2[_0x304f11][_0x27a439(0x130)]=_0x25d9cc;}),_0x29486b[_0x324589(0xfa)]((_0x3c5d82,_0x593340)=>{var _0x5cacf3=_0x324589;_0x19c9a2[_0x593340][_0x5cacf3(0x13f)]=_0x3c5d82;}),_0xd37525[_0x324589(0xfa)]((_0xfe66c7,_0x17744a)=>{var _0x44807a=_0x324589;_0x19c9a2[_0x17744a][_0x44807a(0xf8)]=_0xfe66c7;}),_0x1ebfe9[_0x324589(0xfa)]((_0x14b609,_0xa9790b)=>{var _0x316927=_0x324589;_0x19c9a2[_0xa9790b][_0x316927(0xd2)]=_0x14b609;}),_0xba383c[_0x324589(0xfa)]((_0x144afb,_0x34c4cc)=>{var _0x4eb1da=_0x324589;_0x19c9a2[_0x34c4cc][_0x4eb1da(0xfd)]=_0x144afb;}),_0x5509c7[_0x324589(0xfa)]((_0x269824,_0xb995a9)=>{var _0x77e4a1=_0x324589;_0x19c9a2[_0xb995a9][_0x77e4a1(0x136)]=_0x269824;}),_0x746fe3[_0x324589(0xfa)]((_0x228777,_0x33286f)=>{var _0x433154=_0x324589;_0x19c9a2[_0x33286f][_0x433154(0x106)]=_0x228777;}),_0x29e7d9[_0x324589(0xfa)]((_0x19fc35,_0x36830d)=>{var _0x4df712=_0x324589;_0x19c9a2[_0x36830d][_0x4df712(0xd9)]=_0x19fc35;}),_0x2861af['forEach']((_0x4efe81,_0x3f74c5)=>{var _0x4bcb93=_0x324589;_0x19c9a2[_0x3f74c5][_0x4bcb93(0x1aa)]=_0x4efe81;}),_0x1f086f[_0x324589(0xfa)]((_0x666fd1,_0x47fc23)=>{var _0x358419=_0x324589;_0x19c9a2[_0x47fc23][_0x358419(0x156)]=_0x666fd1;});const _0x265e51=_0x29e7d9[_0x324589(0x1b5)](_0x5f3fd9=>{return _0x5f3fd9={'room_name':_0x5f3fd9};}),_0x47f694=_0x19c9a2[_0x324589(0x1be)](_0x161dd1=>_0x161dd1[_0x324589(0x129)]!=='0'&&_0x161dd1[_0x324589(0x129)]!==''),_0x5bf3b3=new purchases({'invoice':_0x4785de,'suppliers':_0x2d6c0a[_0x324589(0xbb)][_0x324589(0x14c)],'date':_0x32960e,'warehouse_name':_0x2e8e7f,'product':_0x47f694,'note':_0x10d332,'due_amount':_0x1d783d,'POnumber':_0x11218d,'SCRN':_0x3f8539,'JO_number':_0x5b2ceb,'roomList':_0x265e51}),_0x1fabe8=await _0x5bf3b3[_0x324589(0x104)](),_0x36ac5d=await purchases[_0x324589(0x190)]({'invoice':_0x4785de}),_0x776962=_0x36ac5d[_0x324589(0x1c0)][_0x324589(0x1b5)](async _0x5c3801=>{var _0x8efe2e=_0x324589,_0x21e92b=await warehouse[_0x8efe2e(0x190)]({'name':_0x2e8e7f,'room':_0x5c3801[_0x8efe2e(0xd9)]}),_0x562dd4=0x0;return _0x21e92b[_0x8efe2e(0xb5)][_0x8efe2e(0xfa)](_0xfe4c18=>{var _0x2dcd19=_0x8efe2e;_0xfe4c18[_0x2dcd19(0xba)]==_0x5c3801[_0x2dcd19(0xba)]&&_0xfe4c18[_0x2dcd19(0x127)]==_0x5c3801[_0x2dcd19(0x127)]&&_0xfe4c18[_0x2dcd19(0xae)]==_0x5c3801[_0x2dcd19(0xae)]&&_0xfe4c18[_0x2dcd19(0xb1)]==_0x5c3801['bin']&&_0xfe4c18['bay']==_0x5c3801[_0x2dcd19(0x1a1)]&&_0xfe4c18[_0x2dcd19(0xc7)]==_0x5c3801[_0x2dcd19(0xc7)]&&_0xfe4c18[_0x2dcd19(0x13a)]==_0x5c3801[_0x2dcd19(0x13a)]&&_0xfe4c18[_0x2dcd19(0xf8)]==_0x5c3801[_0x2dcd19(0xf8)]&&_0xfe4c18[_0x2dcd19(0x13f)]==_0x5c3801[_0x2dcd19(0x13f)]&&_0xfe4c18[_0x2dcd19(0x136)]==_0x5c3801[_0x2dcd19(0x136)]&&_0xfe4c18[_0x2dcd19(0x156)]==_0x36ac5d[_0x2dcd19(0x156)]&&(_0xfe4c18['product_stock']+=Math[_0x2dcd19(0x144)](_0x5c3801[_0x2dcd19(0x129)]),_0x562dd4++);}),_0x562dd4===0x0&&_0x21e92b[_0x8efe2e(0xb5)][_0x8efe2e(0x123)]({'product_name':_0x5c3801[_0x8efe2e(0xba)],'product_stock':Math[_0x8efe2e(0x144)](_0x5c3801[_0x8efe2e(0x129)]),'primary_code':_0x5c3801[_0x8efe2e(0x1a2)],'secondary_code':_0x5c3801[_0x8efe2e(0x187)],'product_code':_0x5c3801[_0x8efe2e(0xc1)],'storage':_0x5c3801[_0x8efe2e(0x13a)],'rack':_0x5c3801[_0x8efe2e(0xc7)],'bay':_0x5c3801[_0x8efe2e(0x1a1)],'bin':_0x5c3801['bin'],'type':_0x5c3801[_0x8efe2e(0xae)],'floorlevel':_0x5c3801[_0x8efe2e(0x127)],'maxProducts':_0x5c3801[_0x8efe2e(0x130)],'unit':_0x5c3801['standard_unit'],'secondary_unit':_0x5c3801[_0x8efe2e(0xd1)],'expiry_date':_0x5c3801[_0x8efe2e(0xf8)],'maxPerUnit':_0x5c3801['maxperunit'],'batch_code':_0x5c3801['batch_code'],'alertQTY':_0x5c3801[_0x8efe2e(0xfd)],'production_date':_0x5c3801[_0x8efe2e(0x136)],'product_cat':_0x5c3801[_0x8efe2e(0x106)],'invoice':_0x5c3801[_0x8efe2e(0x156)],'actual_qty':Math[_0x8efe2e(0x144)](_0x5c3801[_0x8efe2e(0x179)]),'actual_uom':_0x5c3801['actual_uom']}),_0x21e92b;});Promise['all'](_0x776962)[_0x324589(0x19c)](async _0x4c01e4=>{var _0x588099=_0x324589;try{for(const _0x17a0da of _0x4c01e4){await _0x17a0da[_0x588099(0x104)]();}const _0x33f21f=await master_shop[_0x588099(0x12d)](),_0x3bbbaa=await email_settings['findOne'](),_0x1a77c0=await supervisor_settings[_0x588099(0x12d)]();var _0xc860cd=_0x36ac5d[_0x588099(0x1c0)],_0x20ecde='',_0x3fe06b;for(_0x3fe06b in _0xc860cd){_0x20ecde+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc860cd[_0x3fe06b][_0x588099(0xba)]+'</td>'+_0x588099(0x174)+_0xc860cd[_0x3fe06b][_0x588099(0xc1)]+_0x588099(0xb3)+_0x588099(0x174)+_0xc860cd[_0x3fe06b][_0x588099(0x129)]+'</td>'+_0x588099(0x174)+_0xc860cd[_0x3fe06b][_0x588099(0x142)]+_0x588099(0xb3)+_0x588099(0x174)+_0xc860cd[_0x3fe06b][_0x588099(0xd1)]+_0x588099(0xb3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x36ac5d[_0x588099(0x109)]+'</td>'+_0x588099(0x174)+_0xc860cd[_0x3fe06b][_0x588099(0xd9)]+'</td>'+_0x588099(0x174)+_0xc860cd[_0x3fe06b][_0x588099(0x13a)]+_0xc860cd[_0x3fe06b][_0x588099(0xc7)]+_0xc860cd[_0x3fe06b][_0x588099(0x1a1)]+_0xc860cd[_0x3fe06b][_0x588099(0xb1)]+_0xc860cd[_0x3fe06b][_0x588099(0xae)][0x0]+_0xc860cd[_0x3fe06b][_0x588099(0x127)]+_0x588099(0xb3),_0x588099(0xa5);}let _0x4cc66f=nodemailer[_0x588099(0xbc)]({'host':_0x3bbbaa[_0x588099(0x17a)],'port':Number(_0x3bbbaa[_0x588099(0xab)]),'secure':![],'auth':{'user':_0x3bbbaa[_0x588099(0x1ab)],'pass':_0x3bbbaa[_0x588099(0x103)]}}),_0x4f65ab={'from':_0x3bbbaa[_0x588099(0x1ab)],'to':_0x1a77c0[0x0][_0x588099(0xea)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x588099(0x1c5),'path':__dirname+_0x588099(0xa1)+_0x588099(0xa4)+_0x33f21f[0x0]['image'],'cid':'logo'}],'html':_0x588099(0xeb)+_0x588099(0x138)+_0x588099(0xe9)+_0x588099(0x1bb)+_0x588099(0x16b)+_0x588099(0x1bb)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x588099(0xf9)+_0x588099(0x1bb)+_0x588099(0x140)+_0x33f21f[0x0][_0x588099(0x1bd)]+_0x588099(0x114)+'</div>'+'</div>'+_0x588099(0xb7)+_0x588099(0x1bb)+_0x588099(0x191)+_0x588099(0x164)+_0x36ac5d[_0x588099(0x156)]+'\x20'+_0x588099(0xe5)+_0x588099(0x1a6)+_0x36ac5d[_0x588099(0xdb)]+'\x20'+_0x588099(0x194)+'</h5>'+_0x588099(0xf9)+_0x588099(0x15c)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x588099(0xc2)+_0x588099(0x160)+_0x588099(0x180)+_0x588099(0x193)+_0x588099(0xde)+_0x588099(0x105)+_0x588099(0xcd)+_0x588099(0x119)+_0x588099(0x152)+_0x588099(0xa5)+_0x588099(0xf2)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x20ecde+'\x20'+'</tbody>'+'</table>'+_0x588099(0x1bb)+_0x588099(0x10b)+_0x588099(0x153)+_0x33f21f[0x0]['site_title']+_0x588099(0x1c3)+_0x588099(0xf9)+_0x588099(0xf9)+_0x588099(0xf7)};_0x4cc66f[_0x588099(0x19f)](_0x4f65ab,function(_0x5e0b2b,_0x2a8a69){var _0x57c221=_0x588099;_0x5e0b2b?(console['log'](_0x5e0b2b),console[_0x57c221(0x14e)](_0x57c221(0x18c))):console[_0x57c221(0x14e)](_0x57c221(0x143));}),_0x2d6c0a[_0x588099(0xb4)]('success',_0x588099(0x1b2)),_0x573432[_0x588099(0x192)]('/all_purchases/view/');}catch(_0x47988e){console[_0x588099(0x157)](_0x47988e),_0x573432[_0x588099(0x17c)](0x1f4)[_0x588099(0x17e)]({'error':_0x588099(0xff)});}})[_0x324589(0xc6)](_0x397b6f=>{var _0x2cc8d7=_0x324589;console[_0x2cc8d7(0x157)](_0x397b6f),_0x573432[_0x2cc8d7(0x17c)](0x1f4)[_0x2cc8d7(0x17e)]({'error':_0x2cc8d7(0xd6)});});}catch(_0x412dd4){console[_0x324589(0x14e)](_0x412dd4);}}),router[a0_0xbe6af6(0x173)](a0_0xbe6af6(0x11c),auth,async(_0x12c2ad,_0x4d1ae9)=>{var _0x342d22=a0_0xbe6af6;try{const {username:_0x53a4ff,email:_0x195cd1,role:_0x2dce12}=_0x12c2ad[_0x342d22(0x1a3)],_0xcd26cf=_0x12c2ad[_0x342d22(0x1a3)],_0x3222da=await profile['findOne']({'email':_0xcd26cf['email']}),_0x35420d=await master_shop[_0x342d22(0x12d)](),_0x471589=_0x12c2ad[_0x342d22(0x11f)]['id'],_0xedfb82=await purchases[_0x342d22(0x116)](_0x471589),_0x122ee9=await warehouse[_0x342d22(0x117)]([{'$match':{'name':_0xedfb82[_0x342d22(0x109)],'room':_0xedfb82[_0x342d22(0xa0)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x342d22(0x171),'name':{'$first':_0x342d22(0x18a)},'product_stock':{'$first':_0x342d22(0x1b0)},'bay':{'$first':_0x342d22(0xf0)},'bin':{'$first':_0x342d22(0x15f)},'type':{'$first':_0x342d22(0x13d)},'floorlevel':{'$first':_0x342d22(0x1b7)},'primary_code':{'$first':_0x342d22(0xf5)},'secondary_code':{'$first':_0x342d22(0xa6)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x342d22(0x11a)},'rack':{'$first':_0x342d22(0x14a)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x1d79cb=await customer[_0x342d22(0x12d)]({});let _0x2dc52b;if(_0xcd26cf['role']=='staff'){const _0x1f7806=await staff[_0x342d22(0x190)]({'email':_0xcd26cf[_0x342d22(0x1ab)]});_0x2dc52b=await warehouse['aggregate']([{'$match':{'status':_0x342d22(0xdf),'name':_0x1f7806[_0x342d22(0xb8)]}},{'$group':{'_id':'$name','name':{'$first':_0x342d22(0x12e)}}}]);}else _0x2dc52b=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x342d22(0x12e)}}}]);const _0x1f7cd7=await product[_0x342d22(0x12d)]({}),_0x592260=await suppliers[_0x342d22(0x12d)]({}),_0x4f85e1=BayBinSelected(_0xedfb82[_0x342d22(0x109)],_0xedfb82[_0x342d22(0xa0)]);if(_0x35420d[0x0][_0x342d22(0x169)]=='English\x20(US)'){var _0x178a3e=users[_0x342d22(0x102)];console[_0x342d22(0x14e)](_0x178a3e);}else{if(_0x35420d[0x0][_0x342d22(0x169)]==_0x342d22(0x149))var _0x178a3e=users[_0x342d22(0x149)];else{if(_0x35420d[0x0][_0x342d22(0x169)]=='German')var _0x178a3e=users[_0x342d22(0x196)];else{if(_0x35420d[0x0]['language']==_0x342d22(0x184))var _0x178a3e=users[_0x342d22(0x184)];else{if(_0x35420d[0x0][_0x342d22(0x169)]==_0x342d22(0xaa))var _0x178a3e=users[_0x342d22(0xaa)];else{if(_0x35420d[0x0][_0x342d22(0x169)]=='Portuguese\x20(BR)')var _0x178a3e=users[_0x342d22(0x12b)];else{if(_0x35420d[0x0]['language']==_0x342d22(0x108))var _0x178a3e=users[_0x342d22(0x108)];else{if(_0x35420d[0x0][_0x342d22(0x169)]==_0x342d22(0x161))var _0x178a3e=users[_0x342d22(0x100)];}}}}}}}_0x4d1ae9[_0x342d22(0x115)](_0x342d22(0x13e),{'success':_0x12c2ad[_0x342d22(0xb4)](_0x342d22(0xd4)),'errors':_0x12c2ad[_0x342d22(0xb4)](_0x342d22(0x165)),'role':_0xcd26cf,'profile':_0x3222da,'customer':_0x1d79cb,'warehouse':_0x2dc52b,'product':_0x122ee9,'user':_0xedfb82,'master_shop':_0x35420d,'unit':_0x1f7cd7,'language':_0x178a3e,'suppliers':_0x592260,'dataSelected':_0x4f85e1});}catch(_0x40c9fa){console[_0x342d22(0x14e)](_0x40c9fa);}}),router['post']('/preview/:id',auth,async(_0x5f2898,_0x85aff4)=>{var _0x4aa437=a0_0xbe6af6;try{const _0x48574c=_0x5f2898[_0x4aa437(0x11f)]['id'],{invoice:_0x212c30,warehouse_name:_0x482e40,Room_name:_0x3c15a0}=_0x5f2898[_0x4aa437(0xbb)],_0x2f187e=await warehouse['findOne']({'name':_0x482e40,'room':_0x3c15a0}),_0x343c24=await purchases[_0x4aa437(0x190)]({'invoice':_0x212c30});_0x343c24[_0x4aa437(0x1c0)][_0x4aa437(0xfa)](_0x13f3c0=>{var _0x24b277=_0x4aa437,_0x1e19cf=0x0;const _0xfc06ce=_0x2f187e[_0x24b277(0xb5)][_0x24b277(0x1b5)](_0x174876=>{var _0x1e4be2=_0x24b277;_0x174876[_0x1e4be2(0xba)]==_0x13f3c0[_0x1e4be2(0xba)]&&_0x174876[_0x1e4be2(0x127)]==_0x13f3c0['floorlevel']&&_0x174876['type']==_0x13f3c0[_0x1e4be2(0xae)]&&_0x174876['bin']==_0x13f3c0['bin']&&_0x174876[_0x1e4be2(0x1a1)]==_0x13f3c0[_0x1e4be2(0x1a1)]&&_0x174876[_0x1e4be2(0xc7)]==_0x13f3c0[_0x1e4be2(0xc7)]&&_0x174876[_0x1e4be2(0x13a)]==_0x13f3c0['storage']&&_0x174876[_0x1e4be2(0xf8)]==_0x13f3c0['expiry_date']&&_0x174876[_0x1e4be2(0x13f)]==_0x13f3c0[_0x1e4be2(0x13f)]&&_0x174876[_0x1e4be2(0x136)]==_0x13f3c0['production_date']&&_0x174876['delivery_date']==_0x13f3c0['delivery_date']&&_0x174876[_0x1e4be2(0x1aa)]==_0x13f3c0[_0x1e4be2(0x1aa)]&&(_0x174876['product_stock']=parseInt(_0x174876[_0x1e4be2(0x178)])+parseInt(_0x13f3c0[_0x1e4be2(0x129)]),_0x1e19cf++);});_0x1e19cf=='0'&&(_0x2f187e[_0x24b277(0xb5)]=_0x2f187e[_0x24b277(0xb5)][_0x24b277(0x18b)]({'product_name':_0x13f3c0['product_name'],'product_stock':_0x13f3c0[_0x24b277(0x129)],'primary_code':_0x13f3c0[_0x24b277(0x1a2)],'secondary_code':_0x13f3c0[_0x24b277(0x187)],'product_code':_0x13f3c0[_0x24b277(0xc1)],'storage':_0x13f3c0[_0x24b277(0x13a)],'rack':_0x13f3c0[_0x24b277(0xc7)],'bay':_0x13f3c0[_0x24b277(0x1a1)],'bin':_0x13f3c0[_0x24b277(0xb1)],'type':_0x13f3c0[_0x24b277(0xae)],'floorlevel':_0x13f3c0['floorlevel'],'maxProducts':_0x13f3c0['maxStocks'],'unit':_0x13f3c0['standard_unit'],'secondary_unit':_0x13f3c0[_0x24b277(0xd1)],'expiry_date':_0x13f3c0[_0x24b277(0xf8)],'maxPerUnit':_0x13f3c0[_0x24b277(0xd2)],'batch_code':_0x13f3c0[_0x24b277(0x13f)],'alertQTY':_0x13f3c0[_0x24b277(0xfd)],'production_date':_0x13f3c0['production_date'],'delivery_date':_0x13f3c0[_0x24b277(0x158)],'delivery_code':_0x13f3c0[_0x24b277(0x1aa)]}));}),await _0x2f187e[_0x4aa437(0x104)](),_0x343c24[_0x4aa437(0xca)]=_0x4aa437(0x18e);const _0x3c6d01=await _0x343c24[_0x4aa437(0x104)]();_0x5f2898[_0x4aa437(0xb4)]('success','Sales\x20Update\x20successfully'),_0x85aff4[_0x4aa437(0x192)](_0x4aa437(0x11e));}catch(_0x300ccb){console[_0x4aa437(0x14e)](_0x300ccb);}}),router[a0_0xbe6af6(0x173)](a0_0xbe6af6(0xcb),auth,async(_0x11c733,_0x20eb76)=>{var _0x2bafdf=a0_0xbe6af6;try{const {username:_0x4bed5a,email:_0xd68828,role:_0x234d03}=_0x11c733['user'],_0x2b76b6=_0x11c733[_0x2bafdf(0x1a3)],_0x2037f6=await profile[_0x2bafdf(0x190)]({'email':_0x2b76b6['email']}),_0x8fddd9=await master_shop['find'](),_0x2b1a8e=_0x11c733[_0x2bafdf(0x11f)]['id'],_0x15314d=await purchases[_0x2bafdf(0x116)](_0x2b1a8e),_0x1d3c9a=await suppliers[_0x2bafdf(0x12d)]({});let _0x1efe60;if(_0x2b76b6[_0x2bafdf(0xc9)]==_0x2bafdf(0x166)){const _0x3f67fe=await staff[_0x2bafdf(0x190)]({'email':_0x2b76b6['email']});_0x1efe60=await warehouse[_0x2bafdf(0x12d)]({'status':'Enabled','name':_0x3f67fe[_0x2bafdf(0xb8)],'warehouse_category':_0x2bafdf(0xb0)});}else _0x1efe60=await warehouse['aggregate']([{'$match':{'status':_0x2bafdf(0xdf),'warehouse_category':_0x2bafdf(0xb0)}},{'$group':{'_id':_0x2bafdf(0x12e),'name':{'$first':_0x2bafdf(0x12e)}}}]);const _0x108478=await product[_0x2bafdf(0x12d)]({}),_0x482cab=BayBinSelected(_0x15314d[_0x2bafdf(0x109)],_0x15314d[_0x2bafdf(0xa0)]);let _0x2913c6=new Date(_0x15314d[_0x2bafdf(0xf8)]),_0x4665f1=('0'+_0x2913c6[_0x2bafdf(0x126)]())[_0x2bafdf(0x1a7)](-0x2),_0x2d2cae=('0'+(_0x2913c6[_0x2bafdf(0x16a)]()+0x1))['slice'](-0x2),_0x1ffe3f=_0x2913c6[_0x2bafdf(0xc3)](),_0x5ff6a1=_0x1ffe3f+'-'+_0x2d2cae+'-'+_0x4665f1;if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x137)){var _0xb59057=users[_0x2bafdf(0x102)];console['log'](_0xb59057);}else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x149))var _0xb59057=users[_0x2bafdf(0x149)];else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x196))var _0xb59057=users[_0x2bafdf(0x196)];else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x184))var _0xb59057=users[_0x2bafdf(0x184)];else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0xaa))var _0xb59057=users[_0x2bafdf(0xaa)];else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x199))var _0xb59057=users['Portuguese'];else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x108))var _0xb59057=users['Chinese'];else{if(_0x8fddd9[0x0][_0x2bafdf(0x169)]==_0x2bafdf(0x161))var _0xb59057=users['Arabic'];}}}}}}}_0x20eb76['render'](_0x2bafdf(0xf3),{'success':_0x11c733[_0x2bafdf(0xb4)](_0x2bafdf(0xd4)),'errors':_0x11c733[_0x2bafdf(0xb4)](_0x2bafdf(0x165)),'role':_0x2b76b6,'profile':_0x2037f6,'purchases':_0x15314d,'suppliers':_0x1d3c9a,'warehouse':_0x1efe60,'product':_0x108478,'master_shop':_0x8fddd9,'language':_0xb59057,'ed_fullDate':_0x5ff6a1,'dataSelected':_0x482cab});}catch(_0x3a4160){console[_0x2bafdf(0x14e)](_0x3a4160);}}),router['post']('/view/:id',auth,async(_0x256b07,_0x1b5048)=>{var _0x39e623=a0_0xbe6af6;try{const _0x48aff3=_0x256b07['params']['id'],_0x5cae0d=await purchases[_0x39e623(0x190)]({'_id':_0x256b07[_0x39e623(0x11f)]['id']}),_0xaa807d=await warehouse[_0x39e623(0x190)]({'name':_0x5cae0d[_0x39e623(0x109)],'room':_0x5cae0d['room']});_0x5cae0d[_0x39e623(0x1c0)][_0x39e623(0xfa)](_0x4364a1=>{const _0x20e5db=_0xaa807d['product_details']['map'](_0x105c04=>{var _0x3d0161=a0_0x2c98;_0x105c04[_0x3d0161(0xba)]==_0x4364a1[_0x3d0161(0xba)]&&_0x105c04[_0x3d0161(0x127)]==_0x4364a1[_0x3d0161(0x127)]&&_0x105c04[_0x3d0161(0xae)]==_0x4364a1['type']&&_0x105c04['bin']==_0x4364a1[_0x3d0161(0xb1)]&&_0x105c04[_0x3d0161(0x1a1)]==_0x4364a1[_0x3d0161(0x1a1)]&&_0x105c04[_0x3d0161(0xc7)]==_0x4364a1['rack']&&_0x105c04[_0x3d0161(0x13a)]==_0x4364a1[_0x3d0161(0x13a)]&&(_0x105c04[_0x3d0161(0x178)]=parseInt(_0x105c04[_0x3d0161(0x178)])-parseInt(_0x4364a1['quantity']));});}),await _0xaa807d[_0x39e623(0x104)]();const {invoice:_0x3cf1ac,suppliers:_0x5976a2,date:_0x12ccd7,warehouse_name:_0x4d47b6,prod_name:_0x58ab9c,prod_code:_0x1137ac,prod_qty:_0xfbad30,prod_unit:_0x4d60d4,prod_secondunit:_0x2ee3e4,prod_level:_0x803430,prod_isle:_0x50c2f5,prod_pallet:_0x52d166,note:_0x3d92ca,expiry_date:_0x443f46,batch_code:_0x11ef99,paid_amount:_0x2f9ea3,due_amount:_0x15fb32,Room_name:_0x4db15e,primary_code:_0x3c5c1e,secondary_code:_0x4d5cae,PO_number:_0x5f328a,JO_number:_0x288e02}=_0x256b07[_0x39e623(0xbb)];if(typeof _0x58ab9c==_0x39e623(0x1b6))var _0x423ee8=[_0x256b07['body'][_0x39e623(0xd8)]],_0x26705c=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0x19a)]],_0x18ba2d=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0x112)]],_0x3393e4=[_0x256b07[_0x39e623(0xbb)]['prod_unit']],_0x363e34=[_0x256b07[_0x39e623(0xbb)]['prod_secondunit']],_0x383dd7=[_0x256b07[_0x39e623(0xbb)]['prod_level']],_0x1b6f7f=[_0x256b07[_0x39e623(0xbb)]['prod_isle']],_0x200f88=[_0x256b07['body'][_0x39e623(0x135)]],_0x30f31f=[_0x256b07[_0x39e623(0xbb)]['primary_code']],_0x336ff9=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0x187)]],_0x55e730=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0x12c)]],_0x489585=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0x13f)]],_0x3ad066=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0xf8)]],_0x37a5ef=[_0x256b07['body'][_0x39e623(0x13a)]],_0x54e1a7=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0x128)]],_0xef94e3=[_0x256b07[_0x39e623(0xbb)][_0x39e623(0xae)]];else var _0x423ee8=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0xd8)]],_0x26705c=[..._0x256b07[_0x39e623(0xbb)]['prod_code']],_0x18ba2d=[..._0x256b07['body'][_0x39e623(0x112)]],_0x3393e4=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x10a)]],_0x363e34=[..._0x256b07['body']['prod_secondunit']],_0x383dd7=[..._0x256b07[_0x39e623(0xbb)]['prod_level']],_0x1b6f7f=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x15d)]],_0x200f88=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x135)]],_0x30f31f=[..._0x256b07[_0x39e623(0xbb)]['primary_code']],_0x336ff9=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x187)]],_0x55e730=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x12c)]],_0x489585=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x13f)]],_0x3ad066=[..._0x256b07['body'][_0x39e623(0xf8)]],_0x37a5ef=[..._0x256b07['body'][_0x39e623(0x13a)]],_0x54e1a7=[..._0x256b07[_0x39e623(0xbb)][_0x39e623(0x128)]],_0xef94e3=[..._0x256b07['body']['type']];const _0xba5b53=_0x423ee8[_0x39e623(0x1b5)](_0x15dafd=>{return _0x15dafd={'product_name':_0x15dafd};});_0x26705c[_0x39e623(0xfa)]((_0x1320e6,_0x519fcc)=>{var _0x3fecbb=_0x39e623;_0xba5b53[_0x519fcc][_0x3fecbb(0xc1)]=_0x1320e6;}),_0x18ba2d['forEach']((_0x54c688,_0x585dc5)=>{var _0x5defbc=_0x39e623;_0xba5b53[_0x585dc5][_0x5defbc(0x129)]=_0x54c688;}),_0x3393e4[_0x39e623(0xfa)]((_0x12048f,_0xa397e8)=>{var _0x5398cb=_0x39e623;_0xba5b53[_0xa397e8][_0x5398cb(0x142)]=_0x12048f;}),_0x363e34[_0x39e623(0xfa)]((_0x435f4d,_0x12365b)=>{var _0x21f48a=_0x39e623;_0xba5b53[_0x12365b][_0x21f48a(0xd1)]=_0x435f4d;}),_0x383dd7[_0x39e623(0xfa)]((_0x2abb20,_0x4762bd)=>{_0xba5b53[_0x4762bd]['bay']=_0x2abb20;}),_0x1b6f7f[_0x39e623(0xfa)]((_0x544e12,_0x26f3e6)=>{var _0x43aeed=_0x39e623;_0xba5b53[_0x26f3e6][_0x43aeed(0xb1)]=_0x544e12;}),_0x200f88[_0x39e623(0xfa)]((_0x5af53c,_0x49276b)=>{_0xba5b53[_0x49276b]['floorlevel']=_0x5af53c;}),_0x30f31f['forEach']((_0x3d6895,_0x465c2d)=>{var _0x11172d=_0x39e623;_0xba5b53[_0x465c2d][_0x11172d(0x1a2)]=_0x3d6895;}),_0x336ff9[_0x39e623(0xfa)]((_0x31c2a3,_0x2c323f)=>{var _0x451732=_0x39e623;_0xba5b53[_0x2c323f][_0x451732(0x187)]=_0x31c2a3;}),_0x55e730[_0x39e623(0xfa)]((_0x3875d1,_0x21ef30)=>{var _0x4fd655=_0x39e623;_0xba5b53[_0x21ef30][_0x4fd655(0x130)]=_0x3875d1;}),_0x489585['forEach']((_0x571af3,_0x2fe428)=>{_0xba5b53[_0x2fe428]['batch_code']=_0x571af3;}),_0x3ad066[_0x39e623(0xfa)]((_0x298e55,_0x1ccd0f)=>{var _0x533c31=_0x39e623;_0xba5b53[_0x1ccd0f][_0x533c31(0xf8)]=_0x298e55;}),_0xef94e3[_0x39e623(0xfa)]((_0x1bf9fc,_0x18c1ac)=>{_0xba5b53[_0x18c1ac]['type']=_0x1bf9fc;}),_0x37a5ef[_0x39e623(0xfa)]((_0xcb6ce5,_0x437fcd)=>{var _0x3ebe2f=_0x39e623;_0xba5b53[_0x437fcd][_0x3ebe2f(0x13a)]=_0xcb6ce5;}),_0x54e1a7[_0x39e623(0xfa)]((_0x2043b8,_0x3d8a4)=>{var _0x1b6469=_0x39e623;_0xba5b53[_0x3d8a4][_0x1b6469(0xc7)]=_0x2043b8;});const _0x4f4e3a=_0xba5b53[_0x39e623(0x1be)](_0x17d611=>_0x17d611[_0x39e623(0x129)]!=='0'&&_0x17d611[_0x39e623(0x129)]!=='');_0x5cae0d[_0x39e623(0x156)]=_0x3cf1ac,_0x5cae0d[_0x39e623(0x14c)]=_0x5976a2,_0x5cae0d[_0x39e623(0xdb)]=_0x12ccd7,_0x5cae0d[_0x39e623(0x109)]=_0x4d47b6,_0x5cae0d[_0x39e623(0x1c0)]=_0x4f4e3a,_0x5cae0d[_0x39e623(0xfe)]=_0x3d92ca,_0x5cae0d[_0x39e623(0x1b1)]=_0x2f9ea3,_0x5cae0d[_0x39e623(0x110)]=_0x15fb32,_0x5cae0d['room']=_0x4db15e,_0x5cae0d[_0x39e623(0x19d)]=_0x5f328a,_0x5cae0d[_0x39e623(0x1b9)]=_0x288e02;const _0x5316ee=await _0x5cae0d[_0x39e623(0x104)](),_0x362611=await warehouse['findOne']({'name':_0x256b07['body'][_0x39e623(0x109)],'room':_0x256b07[_0x39e623(0xbb)][_0x39e623(0xc0)]});_0x5cae0d[_0x39e623(0x1c0)][_0x39e623(0xfa)](_0xf811b9=>{var _0x26c600=_0x39e623,_0x2d3cfc=0x0;const _0x58ced0=_0x362611['product_details'][_0x26c600(0x1b5)](_0x252947=>{var _0xc431cb=_0x26c600;_0x252947[_0xc431cb(0xba)]==_0xf811b9[_0xc431cb(0xba)]&&_0x252947['floorlevel']==_0xf811b9[_0xc431cb(0x127)]&&_0x252947['type']==_0xf811b9[_0xc431cb(0xae)]&&_0x252947['bin']==_0xf811b9[_0xc431cb(0xb1)]&&_0x252947[_0xc431cb(0x1a1)]==_0xf811b9[_0xc431cb(0x1a1)]&&_0x252947[_0xc431cb(0xc7)]==_0xf811b9['rack']&&_0x252947[_0xc431cb(0x13a)]==_0xf811b9[_0xc431cb(0x13a)]&&(_0x252947['product_stock']=parseInt(_0x252947[_0xc431cb(0x178)])+parseInt(_0xf811b9[_0xc431cb(0x129)]),_0x2d3cfc++);});_0x2d3cfc=='0'&&(_0x362611['product_details']=_0x362611[_0x26c600(0xb5)][_0x26c600(0x18b)]({'product_name':_0xf811b9[_0x26c600(0xba)],'product_stock':_0xf811b9[_0x26c600(0x129)],'primary_code':_0xf811b9[_0x26c600(0x1a2)],'secondary_code':_0xf811b9['secondary_code'],'product_code':_0xf811b9[_0x26c600(0xc1)],'storage':_0xf811b9[_0x26c600(0x13a)],'rack':_0xf811b9[_0x26c600(0xc7)],'bay':_0xf811b9[_0x26c600(0x1a1)],'bin':_0xf811b9[_0x26c600(0xb1)],'type':_0xf811b9[_0x26c600(0xae)],'floorlevel':_0xf811b9[_0x26c600(0x127)],'maxProducts':_0xf811b9[_0x26c600(0x130)],'unit':_0xf811b9['standard_unit'],'secondary_unit':_0xf811b9[_0x26c600(0xd1)],'expiry_date':_0xf811b9['expiry_date']}));}),await _0x362611[_0x39e623(0x104)]();const _0x254f9a=await s_payment_data[_0x39e623(0x190)]({'invoice':_0x256b07[_0x39e623(0xbb)]['invoice']});if(_0x254f9a===null){}else console['log'](_0x39e623(0x14c),_0x254f9a,_0x256b07['body'][_0x39e623(0x156)]),_0x254f9a[_0x39e623(0x14c)]=_0x256b07[_0x39e623(0xbb)]['suppliers'],await _0x254f9a['save']();_0x256b07[_0x39e623(0xb4)](_0x39e623(0xd4),_0x39e623(0x16f)),_0x1b5048['redirect'](_0x39e623(0x11e));}catch(_0x133abc){console[_0x39e623(0x14e)](_0x133abc);}}),router[a0_0xbe6af6(0xd5)]('/give_payment/:id',auth,async(_0x41e4e6,_0x1e0cf0)=>{var _0x46ee53=a0_0xbe6af6;try{const _0x356d8c=_0x41e4e6['params']['id'],{invoice:_0x578a8e,suppliers:_0x4d3854,payable:_0x81c72a,due_amount:_0x3c8ff3}=_0x41e4e6[_0x46ee53(0xbb)],_0x11cd34=await purchases[_0x46ee53(0x116)](_0x356d8c);var _0x1cb143=_0x81c72a-_0x3c8ff3;_0x11cd34[_0x46ee53(0x1b1)]=parseFloat(_0x11cd34[_0x46ee53(0x1b1)])+parseFloat(_0x3c8ff3),_0x11cd34[_0x46ee53(0x110)]=_0x1cb143;const _0x489e98=await _0x11cd34[_0x46ee53(0x104)]();console[_0x46ee53(0x14e)](_0x489e98);const _0x26e20f=await s_payment_data['findOne']({'invoice':_0x578a8e});_0x26e20f[_0x46ee53(0x189)]=_0x1cb143,await _0x26e20f[_0x46ee53(0x104)]();let _0x281e8b=new Date(),_0x553c11=('0'+_0x281e8b[_0x46ee53(0x126)]())[_0x46ee53(0x1a7)](-0x2),_0x36b2f6=('0'+(_0x281e8b['getMonth']()+0x1))[_0x46ee53(0x1a7)](-0x2),_0x1e0351=_0x281e8b[_0x46ee53(0xc3)](),_0x4db07d=_0x1e0351+'-'+_0x36b2f6+'-'+_0x553c11;const _0xc68995=new suppliers_payment({'invoice':_0x578a8e,'date':_0x1e0351+'-'+_0x36b2f6+'-'+_0x553c11,'suppliers':_0x4d3854,'reason':'Paid\x20For\x20Purchase','amount':_0x3c8ff3}),_0x20ad0f=await _0xc68995['save']();_0x41e4e6['flash']('success','payment\x20successfull'),_0x1e0cf0[_0x46ee53(0x192)](_0x46ee53(0x11e));}catch(_0x497faf){console['log'](_0x497faf);}}),router[a0_0xbe6af6(0x173)](a0_0xbe6af6(0xbf),auth,async(_0x49f619,_0x2bf8d2)=>{var _0x27f29d=a0_0xbe6af6;try{const {username:_0x4f3505,email:_0x5a00b1,role:_0x22ab24}=_0x49f619[_0x27f29d(0x1a3)],_0x1b440a=_0x49f619[_0x27f29d(0x1a3)],_0x1b337f=await profile[_0x27f29d(0x190)]({'email':_0x1b440a[_0x27f29d(0x1ab)]}),_0x3f69fd=await master_shop[_0x27f29d(0x12d)]();console[_0x27f29d(0x14e)]('master',_0x3f69fd);const _0x27fda8=_0x49f619[_0x27f29d(0x11f)]['id'],_0x2dddfc=await purchases[_0x27f29d(0x116)](_0x27fda8);console[_0x27f29d(0x14e)](_0x2dddfc);const _0xbe407=await suppliers[_0x27f29d(0x190)]({'name':_0x2dddfc[_0x27f29d(0x14c)]});console[_0x27f29d(0x14e)](_0xbe407);if(_0x3f69fd[0x0][_0x27f29d(0x169)]=='English\x20(US)'){var _0x1a4116=users['English'];console[_0x27f29d(0x14e)](_0x1a4116);}else{if(_0x3f69fd[0x0][_0x27f29d(0x169)]==_0x27f29d(0x149))var _0x1a4116=users[_0x27f29d(0x149)];else{if(_0x3f69fd[0x0][_0x27f29d(0x169)]==_0x27f29d(0x196))var _0x1a4116=users[_0x27f29d(0x196)];else{if(_0x3f69fd[0x0][_0x27f29d(0x169)]==_0x27f29d(0x184))var _0x1a4116=users['Spanish'];else{if(_0x3f69fd[0x0][_0x27f29d(0x169)]=='French')var _0x1a4116=users['French'];else{if(_0x3f69fd[0x0]['language']=='Portuguese\x20(BR)')var _0x1a4116=users[_0x27f29d(0x12b)];else{if(_0x3f69fd[0x0][_0x27f29d(0x169)]==_0x27f29d(0x108))var _0x1a4116=users[_0x27f29d(0x108)];else{if(_0x3f69fd[0x0][_0x27f29d(0x169)]==_0x27f29d(0x161))var _0x1a4116=users[_0x27f29d(0x100)];}}}}}}}_0x2bf8d2[_0x27f29d(0x115)](_0x27f29d(0xc8),{'success':_0x49f619['flash']('success'),'errors':_0x49f619[_0x27f29d(0xb4)](_0x27f29d(0x165)),'role':_0x1b440a,'profile':_0x1b337f,'master_shop':_0x3f69fd,'supplier':_0xbe407,'purchase':_0x2dddfc,'language':_0x1a4116});}catch(_0x49caa7){console[_0x27f29d(0x14e)](_0x49caa7);}}),router['get'](a0_0xbe6af6(0x154),auth,async(_0x56cf5c,_0x5cf48c)=>{var _0x1c90cc=a0_0xbe6af6;try{const {username:_0x2fff0f,email:_0x23f829,role:_0x4f8db5}=_0x56cf5c[_0x1c90cc(0x1a3)],_0xa4ac72=_0x56cf5c['user'],_0x2f7853=await profile[_0x1c90cc(0x190)]({'email':_0xa4ac72[_0x1c90cc(0x1ab)]}),_0x2c9a1e=await master_shop[_0x1c90cc(0x12d)]();console[_0x1c90cc(0x14e)]('master',_0x2c9a1e);const _0x589fc6=_0x56cf5c[_0x1c90cc(0x11f)]['id'];console[_0x1c90cc(0x14e)](_0x589fc6);const _0x1f6321=await purchases[_0x1c90cc(0x116)](_0x589fc6);console[_0x1c90cc(0x14e)](_0x1c90cc(0xe8),_0x1f6321);const _0x297bf7=await product['find']({}),_0x3ded02=await warehouse[_0x1c90cc(0x117)]([{'$match':{'name':_0x1f6321[_0x1c90cc(0x109)],'room':_0x1f6321[_0x1c90cc(0xa0)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1c90cc(0x171),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1c90cc(0x1b0)},'bay':{'$first':_0x1c90cc(0xf0)},'bin':{'$first':_0x1c90cc(0x15f)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1c90cc(0x1b7)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1c90cc(0xef)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1c90cc(0x14a)}}}]);warehouse_data=await warehouse[_0x1c90cc(0x117)]([{'$match':{'status':_0x1c90cc(0xdf),'name':_0x1c90cc(0x125),'warehouse_category':_0x1c90cc(0xb0)}},{'$group':{'_id':_0x1c90cc(0x12e),'name':{'$first':_0x1c90cc(0x12e)}}},{'$sort':{'name':0x1}}]),console[_0x1c90cc(0x14e)](_0x1c90cc(0x1b8),_0x3ded02);if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]==_0x1c90cc(0x137)){var _0x288d88=users[_0x1c90cc(0x102)];console['log'](_0x288d88);}else{if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]==_0x1c90cc(0x149))var _0x288d88=users['Hindi'];else{if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]==_0x1c90cc(0x196))var _0x288d88=users[_0x1c90cc(0x196)];else{if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]==_0x1c90cc(0x184))var _0x288d88=users[_0x1c90cc(0x184)];else{if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]=='French')var _0x288d88=users['French'];else{if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]==_0x1c90cc(0x199))var _0x288d88=users[_0x1c90cc(0x12b)];else{if(_0x2c9a1e[0x0]['language']==_0x1c90cc(0x108))var _0x288d88=users[_0x1c90cc(0x108)];else{if(_0x2c9a1e[0x0][_0x1c90cc(0x169)]==_0x1c90cc(0x161))var _0x288d88=users['Arabic'];}}}}}}}_0x5cf48c[_0x1c90cc(0x115)](_0x1c90cc(0x150),{'success':_0x56cf5c[_0x1c90cc(0xb4)](_0x1c90cc(0xd4)),'errors':_0x56cf5c[_0x1c90cc(0xb4)](_0x1c90cc(0x165)),'role':_0xa4ac72,'profile':_0x2f7853,'user':_0x1f6321,'stock':_0x3ded02,'master_shop':_0x2c9a1e,'product':_0x297bf7,'language':_0x288d88,'warehouse':warehouse_data});}catch(_0x21fb02){console[_0x1c90cc(0x14e)](_0x21fb02);}}),router[a0_0xbe6af6(0xd5)](a0_0xbe6af6(0x154),auth,async(_0xd7f454,_0x5f02a5)=>{var _0x23173a=a0_0xbe6af6;try{const {invoice:_0x3a6c20,date:_0x15b7c4,warehouse_name:_0x2bf457,Room_name:_0x5c5804,product_name:_0xd9459b,purchase_quantity:_0x588f42,stocks:_0x26f435,return_qty:_0x1a81f3,note:_0x4859fa,level:_0x5a1ff1,isle:_0x15bc7a,pallet:_0x7c74ac,to_warehouse_name:_0x1329e8,to_Room_name:_0x3ffe59}=_0xd7f454[_0x23173a(0xbb)],_0x123d41=await purchases[_0x23173a(0x190)]({'_id':_0xd7f454['params']['id']}),_0x16dd50=await warehouse['findOne']({'name':_0x2bf457,'room':_0x5c5804});if(typeof _0xd9459b=='string')var _0x5158c5=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0xba)]],_0x4945c1=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x177)]],_0x3c48fd=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x18f)]],_0x3e1179=[_0xd7f454['body'][_0x23173a(0xe0)]],_0x5b1537=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x19b)]],_0x2969de=[_0xd7f454[_0x23173a(0xbb)]['isle']],_0x524a43=[_0xd7f454[_0x23173a(0xbb)]['pallet']],_0x438117=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x147)]],_0x5be4ef=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x163)]],_0x3c9149=[_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x155)]],_0x10172d=[_0xd7f454[_0x23173a(0xbb)]['secondary_code_hide']];else var _0x5158c5=[..._0xd7f454[_0x23173a(0xbb)]['product_name']],_0x4945c1=[..._0xd7f454[_0x23173a(0xbb)]['purchase_quantity']],_0x3c48fd=[..._0xd7f454[_0x23173a(0xbb)]['stocks']],_0x3e1179=[..._0xd7f454[_0x23173a(0xbb)]['return_qty']],_0x5b1537=[..._0xd7f454[_0x23173a(0xbb)]['level']],_0x2969de=[..._0xd7f454[_0x23173a(0xbb)]['isle']],_0x524a43=[..._0xd7f454['body'][_0x23173a(0xb2)]],_0x438117=[..._0xd7f454['body'][_0x23173a(0x147)]],_0x5be4ef=[..._0xd7f454[_0x23173a(0xbb)][_0x23173a(0x163)]],_0x3c9149=[..._0xd7f454[_0x23173a(0xbb)]['primary_code_hide']],_0x10172d=[..._0xd7f454[_0x23173a(0xbb)][_0x23173a(0x13c)]];const _0x42bd0a=_0x5158c5[_0x23173a(0x1b5)](_0x445ffc=>{return _0x445ffc={'product_name':_0x445ffc};});_0x4945c1[_0x23173a(0xfa)]((_0x3cecd4,_0x497d7e)=>{var _0x27ddfd=_0x23173a;_0x42bd0a[_0x497d7e][_0x27ddfd(0x177)]=_0x3cecd4;}),_0x3c48fd['forEach']((_0x42a2b6,_0x4d59bb)=>{var _0x476c0d=_0x23173a;_0x42bd0a[_0x4d59bb][_0x476c0d(0x1b3)]=_0x42a2b6;}),_0x3e1179[_0x23173a(0xfa)]((_0x184b83,_0x398a25)=>{var _0x285dc1=_0x23173a;_0x42bd0a[_0x398a25][_0x285dc1(0xe0)]=_0x184b83;}),_0x5b1537[_0x23173a(0xfa)]((_0x29e615,_0x333d21)=>{var _0x3dad47=_0x23173a;_0x42bd0a[_0x333d21][_0x3dad47(0x1a1)]=_0x29e615;}),_0x2969de[_0x23173a(0xfa)]((_0x53a06d,_0x486059)=>{var _0x1b48ac=_0x23173a;_0x42bd0a[_0x486059][_0x1b48ac(0xb1)]=_0x53a06d;}),_0x524a43[_0x23173a(0xfa)]((_0x31643b,_0x5dfda1)=>{var _0x372d01=_0x23173a;_0x42bd0a[_0x5dfda1][_0x372d01(0x127)]=_0x31643b;}),_0x438117[_0x23173a(0xfa)]((_0x11e1f5,_0x3526c5)=>{var _0x593562=_0x23173a;_0x42bd0a[_0x3526c5][_0x593562(0xae)]=_0x11e1f5;}),_0x5be4ef[_0x23173a(0xfa)]((_0x224e46,_0xfe2a4f)=>{_0x42bd0a[_0xfe2a4f]['product_code']=_0x224e46;}),_0x3c9149[_0x23173a(0xfa)]((_0x2ace04,_0x221c2b)=>{var _0x500250=_0x23173a;_0x42bd0a[_0x221c2b][_0x500250(0x1a2)]=_0x2ace04;}),_0x10172d['forEach']((_0x4289a1,_0x2121fb)=>{var _0x335d24=_0x23173a;_0x42bd0a[_0x2121fb][_0x335d24(0x187)]=_0x4289a1;}),_0x123d41[_0x23173a(0x1c0)][_0x23173a(0xfa)](_0x1cf7a7=>{var _0xae97ec=_0x23173a;const _0x58f682=_0x16dd50['product_details'][_0xae97ec(0x1b5)](_0x2b810b=>{var _0x7d8bf7=_0xae97ec;_0x2b810b['product_name']==_0x1cf7a7[_0x7d8bf7(0xba)]&&_0x2b810b[_0x7d8bf7(0x127)]==_0x1cf7a7['floorlevel']&&_0x2b810b[_0x7d8bf7(0xae)]==_0x1cf7a7[_0x7d8bf7(0xae)]&&_0x2b810b[_0x7d8bf7(0xb1)]==_0x1cf7a7[_0x7d8bf7(0xb1)]&&_0x2b810b[_0x7d8bf7(0x1a1)]==_0x1cf7a7['bay']&&_0x2b810b['rack']==_0x1cf7a7[_0x7d8bf7(0xc7)]&&_0x2b810b[_0x7d8bf7(0x13a)]==_0x1cf7a7[_0x7d8bf7(0x13a)]&&(console[_0x7d8bf7(0x14e)](parseInt(_0x2b810b['product_stock'])+'\x20<>\x20'+parseInt(_0x1cf7a7[_0x7d8bf7(0x129)])),_0x2b810b[_0x7d8bf7(0x178)]=parseInt(_0x2b810b[_0x7d8bf7(0x178)])+parseInt(_0x1cf7a7['quantity']));});}),await _0x16dd50[_0x23173a(0x104)]();const _0x344d70=_0x42bd0a[_0x23173a(0x1be)](_0x3469b5=>_0x3469b5['return_qty']!=='0'&&_0x3469b5[_0x23173a(0xe0)]!=='');var _0x57774e=0x0;_0x344d70['forEach'](_0x2cb9a5=>{var _0x1280b9=_0x23173a;console['log'](_0x1280b9(0x14b),_0x2cb9a5),(parseInt(_0x2cb9a5[_0x1280b9(0x177)])<parseInt(_0x2cb9a5['return_qty'])||parseInt(_0x2cb9a5[_0x1280b9(0x1b3)])<parseInt(_0x2cb9a5[_0x1280b9(0xe0)]))&&_0x57774e++;});if(_0x57774e!=0x0)return _0xd7f454[_0x23173a(0xb4)](_0x23173a(0x165),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x5f02a5['redirect'](_0x23173a(0x1ba));const _0x527b58=new purchases_return({'invoice':_0x3a6c20,'suppliers':_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x14c)],'date':_0x15b7c4,'warehouse_name':_0x2bf457,'return_product':_0x344d70,'note':_0x4859fa,'room':_0x5c5804,'to_warehouse_name':_0x1329e8,'to_room':_0x3ffe59}),_0x59f7be=await _0x527b58[_0x23173a(0x104)]();console[_0x23173a(0x14e)](_0x527b58);const _0x39ffdb=await purchases_return[_0x23173a(0x190)]({'invoice':_0x3a6c20}),_0x1aff99=await warehouse[_0x23173a(0x190)]({'name':_0x1329e8,'room':_0x3ffe59});_0x39ffdb[_0x23173a(0x1c4)]['forEach'](_0x1307db=>{var _0x580b59=_0x23173a,_0x3ec2dc=0x0;const _0x4cce9e=_0x1aff99['product_details'][_0x580b59(0x1b5)](_0x33ad55=>{var _0x1b8e9c=_0x580b59;_0x33ad55[_0x1b8e9c(0xba)]==_0x1307db['product_name']&&_0x33ad55[_0x1b8e9c(0x127)]==_0x1307db[_0x1b8e9c(0x127)]&&_0x33ad55['type']==_0x1307db['type']&&_0x33ad55[_0x1b8e9c(0xb1)]==_0x1307db[_0x1b8e9c(0xb1)]&&_0x33ad55[_0x1b8e9c(0x1a1)]==_0x1307db[_0x1b8e9c(0x1a1)]&&(_0x33ad55[_0x1b8e9c(0x178)]=parseInt(_0x33ad55[_0x1b8e9c(0x178)])-parseInt(_0x1307db[_0x1b8e9c(0xe0)]),_0x3ec2dc++);});_0x3ec2dc=='0'&&(_0x1aff99[_0x580b59(0xb5)]=_0x1aff99[_0x580b59(0xb5)][_0x580b59(0x18b)]({'product_name':_0x1307db['product_name'],'product_stock':_0x1307db[_0x580b59(0xe0)],'primary_code':_0x1307db[_0x580b59(0x1a2)],'secondary_code':_0x1307db[_0x580b59(0x187)],'product_code':_0x1307db[_0x580b59(0xc1)],'storage':_0x1307db['storage'],'rack':_0x1307db[_0x580b59(0xc7)],'bay':_0x1307db[_0x580b59(0x1a1)],'bin':_0x1307db[_0x580b59(0xb1)],'type':_0x1307db[_0x580b59(0xae)],'floorlevel':_0x1307db[_0x580b59(0x127)],'maxProducts':_0x1307db[_0x580b59(0x130)],'unit':_0x1307db['standard_unit'],'secondary_unit':_0x1307db[_0x580b59(0xd1)],'expiry_date':_0x1307db[_0x580b59(0xf8)]}));}),await _0x1aff99[_0x23173a(0x104)]();const _0x5652aa=await purchases['findOne']({'invoice':_0x3a6c20});_0x5652aa[_0x23173a(0x1a8)]=_0x23173a(0x18e);const _0x4522ef=await _0x5652aa['save'](),_0x584544=new s_payment_data({'invoice':_0x3a6c20,'suppliers':_0xd7f454[_0x23173a(0xbb)][_0x23173a(0x14c)],'reason':_0x23173a(0x145)});await _0x584544[_0x23173a(0x104)]();const _0x4386e5=await master_shop[_0x23173a(0x12d)]();console[_0x23173a(0x14e)](_0x23173a(0x15a),_0x4386e5[0x0][_0x23173a(0x111)]);const _0x4cefb8=await email_settings[_0x23173a(0x190)](),_0xfa4aa6=await suppliers[_0x23173a(0x190)]({'name':_0xd7f454['body'][_0x23173a(0x14c)]});console[_0x23173a(0x14e)](_0x23173a(0x1bc),_0xfa4aa6);_0x4386e5[0x0][_0x23173a(0x168)]==0x1?(right_currency=_0x4386e5[0x0][_0x23173a(0x183)],left_currency=''):(right_currency='',left_currency=_0x4386e5[0x0]['currency']);var _0x3e8654=_0x5158c5,_0x29a3fa=_0x3e1179,_0x3595e5='',_0x36ac78;for(_0x36ac78 in _0x3e8654){_0x3595e5+=_0x23173a(0xc2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e8654[_0x36ac78]+_0x23173a(0xb3)+_0x23173a(0x174)+_0x29a3fa[_0x36ac78]+'</td>'+'</tr>';}console[_0x23173a(0x14e)](_0x23173a(0x175),_0x3595e5);let _0x529de9=nodemailer[_0x23173a(0xbc)]({'service':_0x23173a(0xed),'auth':{'user':_0x4cefb8['email'],'pass':_0x4cefb8['password']}}),_0x279768={'from':_0x4cefb8[_0x23173a(0x1ab)],'to':_0xfa4aa6[_0x23173a(0x1ab)],'subject':_0x23173a(0x1c1),'attachments':[{'filename':_0x23173a(0x1c5),'path':__dirname+_0x23173a(0xa1)+_0x23173a(0xa4)+_0x4386e5[0x0][_0x23173a(0x111)],'cid':_0x23173a(0xe7)}],'html':_0x23173a(0xeb)+_0x23173a(0x138)+_0x23173a(0xe9)+_0x23173a(0x1bb)+_0x23173a(0x16b)+_0x23173a(0x1bb)+_0x23173a(0x197)+_0x23173a(0xf9)+'<div>'+_0x23173a(0x140)+_0x4386e5[0x0][_0x23173a(0x1bd)]+_0x23173a(0x114)+'</div>'+_0x23173a(0xf9)+_0x23173a(0xb7)+_0x23173a(0x1bb)+_0x23173a(0x191)+'\x20Order\x20Number\x20:\x20'+_0x3a6c20+'\x20'+_0x23173a(0xe5)+'\x20Order\x20Date\x20:\x20'+_0x15b7c4+'\x20'+'</span>'+_0x23173a(0x1c3)+_0x23173a(0xf9)+_0x23173a(0x15c)+_0x23173a(0x1a4)+_0x23173a(0xc2)+_0x23173a(0x160)+_0x23173a(0x1ad)+_0x23173a(0x198)+_0x23173a(0x133)+_0x23173a(0xa5)+_0x23173a(0xf2)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3595e5+'\x20'+'</tbody>'+_0x23173a(0x11d)+'<div>'+_0x23173a(0x10b)+_0x23173a(0x153)+_0x4386e5[0x0][_0x23173a(0x1bd)]+_0x23173a(0x1c3)+_0x23173a(0xf9)+_0x23173a(0xf9)+_0x23173a(0xf7)};_0x529de9['sendMail'](_0x279768,function(_0x5cf4f5,_0x1e07c6){var _0x1deed4=_0x23173a;_0x5cf4f5?(console[_0x1deed4(0x14e)](_0x5cf4f5),console['log']('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0xd7f454[_0x23173a(0xb4)](_0x23173a(0xd4),'purchases\x20item\x20return\x20successfull'),_0x5f02a5['redirect'](_0x23173a(0x11e));}catch(_0x3ba08c){console[_0x23173a(0x14e)](_0x3ba08c),_0x5f02a5['status'](0xc8)[_0x23173a(0x17e)]({'message':_0x3ba08c[_0x23173a(0xc4)]});}}),router['get'](a0_0xbe6af6(0xcf),auth,async(_0x59f03b,_0x4a88e3)=>{var _0x56e93f=a0_0xbe6af6;try{const {username:_0xead91c,email:_0x8e6b2e,role:_0x70cc2f}=_0x59f03b['user'],_0x317342=_0x59f03b[_0x56e93f(0x1a3)],_0x182b12=await profile[_0x56e93f(0x190)]({'email':_0x317342[_0x56e93f(0x1ab)]}),_0x4801e1=await master_shop['find'](),_0x22e678=_0x59f03b[_0x56e93f(0x11f)]['id'],_0x31913e=await purchases[_0x56e93f(0x116)](_0x22e678);if(_0x4801e1[0x0]['language']=='English\x20(US)')var _0x1c743d=users[_0x56e93f(0x102)];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]==_0x56e93f(0x149))var _0x1c743d=users['Hindi'];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]=='German')var _0x1c743d=users[_0x56e93f(0x196)];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]==_0x56e93f(0x184))var _0x1c743d=users['Spanish'];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]==_0x56e93f(0xaa))var _0x1c743d=users[_0x56e93f(0xaa)];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]==_0x56e93f(0x199))var _0x1c743d=users[_0x56e93f(0x12b)];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]==_0x56e93f(0x108))var _0x1c743d=users[_0x56e93f(0x108)];else{if(_0x4801e1[0x0][_0x56e93f(0x169)]==_0x56e93f(0x161))var _0x1c743d=users['Arabic'];}}}}}}}_0x4a88e3[_0x56e93f(0x115)](_0x56e93f(0xf1),{'success':_0x59f03b[_0x56e93f(0xb4)](_0x56e93f(0xd4)),'errors':_0x59f03b[_0x56e93f(0xb4)]('errors'),'role':_0x317342,'profile':_0x182b12,'alldata':_0x31913e,'master_shop':_0x4801e1,'language':_0x1c743d}),console[_0x56e93f(0x14e)](alldata);}catch(_0x4a0ba3){console[_0x56e93f(0x14e)](_0x4a0ba3);}}),router[a0_0xbe6af6(0xd5)](a0_0xbe6af6(0x14f),async(_0x343d6c,_0xea2f33)=>{var _0x5a1a68=a0_0xbe6af6;const {product_code:_0x526706}=_0x343d6c[_0x5a1a68(0xbb)];var _0x3b03bd;const _0x4d3298=await product['aggregate']([{'$match':{'primary_code':_0x526706,'product_category':_0x5a1a68(0xb0)}},{'$group':{'_id':_0x5a1a68(0x176),'name':{'$first':_0x5a1a68(0x12e)},'category':{'$first':'$category'},'brand':{'$first':_0x5a1a68(0x167)},'unit':{'$first':_0x5a1a68(0x1c6)},'alertquantity':{'$first':_0x5a1a68(0x107)},'product_code':{'$first':_0x5a1a68(0x132)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x5a1a68(0x1af)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5a1a68(0x195)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5a1a68(0xaf)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x26bcc7=await product[_0x5a1a68(0x117)]([{'$match':{'secondary_code':_0x526706,'product_category':_0x5a1a68(0xb0)}},{'$group':{'_id':_0x5a1a68(0x176),'name':{'$first':_0x5a1a68(0x12e)},'category':{'$first':'$category'},'brand':{'$first':_0x5a1a68(0x167)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x5a1a68(0x107)},'product_code':{'$first':_0x5a1a68(0x132)},'primary_code':{'$first':_0x5a1a68(0x141)},'secondary_code':{'$first':_0x5a1a68(0x1af)},'maxStocks':{'$first':_0x5a1a68(0x12a)},'maxProdPerUnit':{'$first':_0x5a1a68(0x195)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5a1a68(0xaf)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4d3298[_0x5a1a68(0xa2)]>0x0)_0x3b03bd=_0x4d3298;else _0x26bcc7['length']>0x0&&(_0x3b03bd=_0x26bcc7);_0xea2f33['json'](_0x3b03bd);}),router[a0_0xbe6af6(0xd5)](a0_0xbe6af6(0x131),async(_0x1efbf6,_0x61f31a)=>{var _0x5b8cea=a0_0xbe6af6;const {primaryCode:_0x2ffeeb,secondaryCode:_0x2bcab7,productCode:_0x1d2c0f,bay:_0x38ad03,bin:_0x5329a1,types:_0x4c3035,pallet:_0xbf9842,warehouses:_0x1b8539,room:_0x43cf8d}=_0x1efbf6[_0x5b8cea(0xbb)];console[_0x5b8cea(0x14e)](_0x1efbf6[_0x5b8cea(0xbb)]);try{const _0x110895=await warehouse[_0x5b8cea(0x117)]([{'$match':{'name':_0x1b8539,'room':_0x43cf8d}},{'$unwind':_0x5b8cea(0x1a5)},{'$match':{'product_details.bay':_0x38ad03,'product_details.bin':_0x5329a1,'product_details.type':_0x4c3035}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5b8cea(0x18a)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x5b8cea(0x1c2)},'isle':{'$first':_0x5b8cea(0xbe)},'pallet':{'$first':_0x5b8cea(0x186)},'maxProducts':{'$first':_0x5b8cea(0x16d)}}}]);_0x61f31a['status'](0xc8)[_0x5b8cea(0x17e)](_0x110895);}catch(_0x14967f){_0x61f31a[_0x5b8cea(0x17c)](0x194)['json']({'message':_0x14967f[_0x5b8cea(0xc4)]});}}),module[a0_0xbe6af6(0xac)]=router;