var a0_0x2aa5c5=a0_0x5ac4;(function(_0x5d0799,_0x120c63){var _0x3de9b4=a0_0x5ac4,_0x219638=_0x5d0799();while(!![]){try{var _0x2f692f=parseInt(_0x3de9b4(0xf5))/0x1+parseInt(_0x3de9b4(0x1cc))/0x2+-parseInt(_0x3de9b4(0x153))/0x3+-parseInt(_0x3de9b4(0x170))/0x4+parseInt(_0x3de9b4(0x10e))/0x5*(parseInt(_0x3de9b4(0x105))/0x6)+parseInt(_0x3de9b4(0x1db))/0x7+-parseInt(_0x3de9b4(0x188))/0x8*(parseInt(_0x3de9b4(0xe0))/0x9);if(_0x2f692f===_0x120c63)break;else _0x219638['push'](_0x219638['shift']());}catch(_0x1ed963){_0x219638['push'](_0x219638['shift']());}}}(a0_0x5e74,0xf31ba));const express=require(a0_0x2aa5c5(0x1ba)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2aa5c5(0x1a9)),auth=require('../middleware/auth'),nodemailer=require(a0_0x2aa5c5(0x1be));var ejs=require('ejs');const path=require(a0_0x2aa5c5(0x1fa)),users=require(a0_0x2aa5c5(0x135));router[a0_0x2aa5c5(0x148)](a0_0x2aa5c5(0xf2),auth,async(_0x4b6aed,_0x49014a)=>{var _0x54cc64=a0_0x2aa5c5;try{const {username:_0x129d1e,email:_0xb7fe1b,role:_0x3c41d6}=_0x4b6aed['user'],_0x451a4e=_0x4b6aed[_0x54cc64(0x178)],_0x399ecf=await profile[_0x54cc64(0x1a4)]({'email':_0x451a4e['email']}),_0x93642=await staff[_0x54cc64(0x1a4)]({'email':_0x451a4e[_0x54cc64(0x1c4)]});if(_0x451a4e[_0x54cc64(0x104)]==_0x54cc64(0x1c3)){const _0x1ad457=await staff[_0x54cc64(0x1a4)]({'email':_0x451a4e[_0x54cc64(0x1c4)]});}const _0x5d2257=await master_shop[_0x54cc64(0x198)]();let _0x56a496;if(_0x451a4e[_0x54cc64(0x104)]=='staff'){const _0x38e016=await staff['findOne']({'email':_0x451a4e['email']});_0x56a496=await purchases[_0x54cc64(0x108)]([{'$match':{'warehouse_name':_0x38e016[_0x54cc64(0x11e)]}},{'$lookup':{'from':_0x54cc64(0x1e2),'localField':_0x54cc64(0x1e2),'foreignField':'name','as':_0x54cc64(0x19e)}},{'$unwind':_0x54cc64(0x132)},{'$unwind':_0x54cc64(0x1af)},{'$group':{'_id':_0x54cc64(0x129),'invoice':{'$first':_0x54cc64(0x14c)},'suppliers':{'$first':_0x54cc64(0x138)},'date':{'$first':_0x54cc64(0x16b)},'warehouse_name':{'$first':_0x54cc64(0x1bc)},'room':{'$first':_0x54cc64(0x1ae)},'product':{'$push':_0x54cc64(0x1af)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x54cc64(0x1a2)},'due_amount':{'$first':_0x54cc64(0xee)},'return_data':{'$first':_0x54cc64(0x17c)},'batch_code':{'$first':_0x54cc64(0x1f0)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x54cc64(0x132)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x54cc64(0x1e4)},'type':{'$addToSet':_0x54cc64(0xf8)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x56a496=await purchases[_0x54cc64(0x108)]([{'$lookup':{'from':_0x54cc64(0x1e2),'localField':_0x54cc64(0x1e2),'foreignField':_0x54cc64(0x150),'as':_0x54cc64(0x19e)}},{'$unwind':_0x54cc64(0x132)},{'$unwind':'$product'},{'$group':{'_id':_0x54cc64(0x129),'invoice':{'$first':_0x54cc64(0x14c)},'suppliers':{'$first':_0x54cc64(0x138)},'date':{'$first':_0x54cc64(0x16b)},'warehouse_name':{'$first':_0x54cc64(0x1bc)},'room':{'$addToSet':_0x54cc64(0x1a1)},'product':{'$push':'$product'},'note':{'$first':_0x54cc64(0x140)},'paid_amount':{'$first':_0x54cc64(0x1a2)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x54cc64(0x17c)},'batch_code':{'$first':_0x54cc64(0x1f0)},'expiry_date':{'$first':_0x54cc64(0x11a)},'suppliers_docs':{'$first':_0x54cc64(0x132)},'total_product_quantity':{'$sum':_0x54cc64(0x1d3)},'level':{'$addToSet':_0x54cc64(0x1bf)},'isle':{'$addToSet':_0x54cc64(0x1e4)},'type':{'$addToSet':_0x54cc64(0xf8)},'floorlevel':{'$addToSet':_0x54cc64(0x143)},'finalize':{'$first':_0x54cc64(0x124)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5d2257[0x0][_0x54cc64(0x157)]==_0x54cc64(0x1d6)){var _0x479139=users[_0x54cc64(0x15d)];console[_0x54cc64(0x1dc)](_0x479139);}else{if(_0x5d2257[0x0][_0x54cc64(0x157)]==_0x54cc64(0x175))var _0x479139=users[_0x54cc64(0x175)];else{if(_0x5d2257[0x0][_0x54cc64(0x157)]=='German')var _0x479139=users[_0x54cc64(0x1b1)];else{if(_0x5d2257[0x0][_0x54cc64(0x157)]==_0x54cc64(0xf6))var _0x479139=users[_0x54cc64(0xf6)];else{if(_0x5d2257[0x0][_0x54cc64(0x157)]==_0x54cc64(0x166))var _0x479139=users[_0x54cc64(0x166)];else{if(_0x5d2257[0x0]['language']==_0x54cc64(0x1b4))var _0x479139=users[_0x54cc64(0x1c5)];else{if(_0x5d2257[0x0][_0x54cc64(0x157)]==_0x54cc64(0x160))var _0x479139=users[_0x54cc64(0x160)];else{if(_0x5d2257[0x0]['language']==_0x54cc64(0x12a))var _0x479139=users['Arabic'];}}}}}}}_0x49014a[_0x54cc64(0x18f)](_0x54cc64(0x103),{'success':_0x4b6aed[_0x54cc64(0x155)]('success'),'errors':_0x4b6aed[_0x54cc64(0x155)](_0x54cc64(0xe7)),'purchases':_0x56a496,'role':_0x451a4e,'profile':_0x399ecf,'master_shop':_0x5d2257,'language':_0x479139});}catch(_0x3871b2){console[_0x54cc64(0x1dc)](_0x54cc64(0x11d),_0x3871b2),_0x49014a[_0x54cc64(0x18e)](0xc8)['json']({'message':_0x3871b2[_0x54cc64(0x190)]});}});function a0_0x5e74(){var _0x588297=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','payment\x20successfull','$suppliers','secondary_unit','$product_code','$product_details.floorlevel','<tbody\x20style=\x22text-align:\x20center;\x22>','rak','JO_number','floor','$note','foreach\x20newproduct','map','$product.floorlevel','user_id','prod_primunit','Arabic','/barcode/:id','get','/upload/','prod_name','add_purchases','$invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.product_stock','/all_purchases/view','name','stock_quantity','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','1867941tjKwPJ','note','flash','max_product_unit','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/invoice/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','product_code','/give_payment/:id','English','isle','$category','Chinese','prod_cat','$product_details.type','</h5>','invoice','$name','French','<!DOCTYPE\x20html>','<strong>\x20Regards\x20</strong>','/view/add_purchases','COLD\x20STORAGE','$date','getDate','prod_level','filter','Rack\x20A','1532776WGFNzd','<div>','return_qty','error','$product_details.product_code','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','batch_code','user','product_stock','return_purchase','secondary_code_hide','$return_data','delivery_date','$product_details.expiry_date','</tbody>','$secondary_unit','site_title','Sales\x20Update\x20successfully','Receiving\x20Area','level','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Room_name','</span>','24392VjWecH','prod_unit','POnumber','</thead>','post','add_purchases\x20error','status','render','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','DRY\x20STORAGE','\x20</h2>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','primary_code_hide','Purchase\x20Mail','prod_qty','find','<table\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssign','Logo.png','prod_secondunit','<h2>\x20','suppliers_docs','Floor','storage','$product.room_name','$paid_amount','type','findOne','return_product','product_cat','Rack\x20D','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','../models/all_models','/CheckingWarehouse','/../public','catch','Enabled','$room','$product','product_code_hide','German','$product_details._id','createTransport','Portuguese\x20(BR)','$product_details','json','slice','forEach','/view/return_purchase/:id','express','warehouse_name','$warehouse_name','quantity','nodemailer','$product.bay','$product_details.primary_code','</table>','prod_code','staff','email','Portuguese','prod_isle','bay','/barcode_scanner','maxperunit','findById','Raw\x20Materials','3376402eYjBii','prod_Qty','primary_code','purchase\x20data\x20update\x20successfully','$product_details.bin','There\x27s\x20a\x20error\x20in\x20this\x20transaction','actual_qty','$product.quantity','$alertquantity','redirect','English\x20(US)','Return\x20Goods','success','currency_placement','maxStocks','7665630ZyrEUN','log','secondary_code','Rack\x20B','<tr>','\x20Order\x20Date\x20:\x20','push','suppliers','delivery_code','$product.bin','concat','product_name','actual_uom','alertQTY','date','$product_details.isle','Shelves','then','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','room','$batch_code','<h5\x20style=\x22text-align:\x20left;\x22>','rack','prod_invoice','exports','RMSEmail','image','string','deliverycode','save','path','\x20<\x20wew\x20>\x20','edit_purchases','13113DUcDOX','Error\x20Occurs','<h5>','</td>','port','master','abs','errors','due_amount','$unit','pallet','logo','/preview/:id','stocks','$due_amount','padStart','$maxStocks','</tr>','/view','random','all','1794835KCGghA','Spanish','\x20Order\x20Number\x20:\x20','$product.type','room_name','INC-','</body></html>','here','add\x20post','production_date','$brand','$product_details.bay','types','<hr\x20class=\x22my-3\x22>','all_purchases','role','5597634nYnTaI','Level','\x20<>\x20','aggregate','product_details','An\x20error\x20occurred\x20while\x20saving\x20data.','expiry_date','Paid\x20For\x20Purchase','back','10wkkEfT','<span\x20style=\x22float:\x20right;\x22>','product_list','purchase_quantity','floorlevel','$product_details.storage','/all_purchases/view/','body','params','$product_details.secondary_code','length','MaxStocks_data','$expiry_date','password','paid_amount','table\x20page','warehouse','$maxProdPerUnit','getMonth','toString','$primary_code','$product_details.maxProducts','$finalize','host','/view/:id','$secondary_code','Email\x20sent\x20successfully','$_id','Arabic\x20(ae)','$product_details.pallet','sendMail','</head><body>','</div>','True','standard_unit','bin','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.level','../public/language/languages.json'];a0_0x5e74=function(){return _0x588297;};return a0_0x5e74();}function BayBinSelected(_0x31f2f5,_0xb5502d){var _0x233b15=a0_0x2aa5c5,_0x33aa5c=[],_0x189f16=[],_0x2b775e=[],_0xb2253f=[],_0x7c3870=[],_0x18dcd6=[];let _0x2a8c27=[];if(_0x31f2f5==_0x233b15(0x192))switch(_0xb5502d){case _0x233b15(0x16f):_0x33aa5c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x189f16=[0x1,0x2],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=[_0x233b15(0x106),_0x233b15(0x19f)],_0x7c3870=['D'],_0x18dcd6=['A'];break;case _0x233b15(0x1de):_0x33aa5c=[0x6,0x5,0x4,0x3,0x2,0x1],_0x189f16=[0x1,0x2],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=['Level',_0x233b15(0x19f)],_0x7c3870=['D'],_0x18dcd6=['B'];break;case _0x233b15(0x1eb):_0x33aa5c=[0x0],_0x189f16=[0x0],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=[_0x233b15(0x19f)],_0x7c3870=['D'],_0x18dcd6=['S'];break;case _0x233b15(0x183):_0x33aa5c=[0x0],_0x189f16=[0x0],_0xb2253f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2b775e=[_0x233b15(0x19f)],_0x7c3870=['D'],_0x18dcd6=['R'];break;}else{if(_0x31f2f5==_0x233b15(0x16a))switch(_0xb5502d){case _0x233b15(0x16f):_0x33aa5c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x189f16=['B','F'],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=['Level','Floor'],_0x7c3870=['C'],_0x18dcd6=['A'];break;case _0x233b15(0x1de):_0x33aa5c=[0x5,0x4,0x3,0x2,0x1],_0x189f16=['F','B','S'],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=[_0x233b15(0x106),_0x233b15(0x19f)],_0x7c3870=['C'],_0x18dcd6=['B'];break;case'Rack\x20C':_0x33aa5c=[0x1,0x2,0x3,0x4,0x5],_0x189f16=['B','F','S'],_0xb2253f=[0x5,0x4,0x3,0x2,0x1],_0x2b775e=[_0x233b15(0x106),_0x233b15(0x19f)],_0x7c3870=['C'],_0x18dcd6=['C'];break;case _0x233b15(0x1a7):_0x33aa5c=[0x5,0x4,0x3,0x2,0x1],_0x189f16=['F','B','S'],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=[_0x233b15(0x106),_0x233b15(0x19f)],_0x7c3870=['C'],_0x18dcd6=['D'];break;case'Rack\x20E':_0x33aa5c=[0x4,0x3,0x2,0x1],_0x189f16=[0x1,0x2],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=[_0x233b15(0x106),_0x233b15(0x19f)],_0x7c3870=['C'],_0x18dcd6=['E'];break;case'Rack\x20F':_0x33aa5c=[0x1,0x2,0x3],_0x189f16=[0x1,0x2],_0xb2253f=[0x1,0x2,0x3,0x4,0x5],_0x2b775e=[_0x233b15(0x106)],_0x7c3870=['C'],_0x18dcd6=['F'];break;}}return{'levels':_0x33aa5c,'Isle':_0x189f16,'rack':_0xb2253f,'type':_0x2b775e,'storage':_0x7c3870,'rak':_0x18dcd6};}function a0_0x5ac4(_0x46807d,_0x4dd063){var _0x5e7485=a0_0x5e74();return a0_0x5ac4=function(_0x5ac412,_0x1d102d){_0x5ac412=_0x5ac412-0xde;var _0x48db65=_0x5e7485[_0x5ac412];return _0x48db65;},a0_0x5ac4(_0x46807d,_0x4dd063);}async function getRandom8DigitNumber(){var _0x4f08d6=a0_0x2aa5c5;const _0x5570d2=0x989680,_0x310af9=0x5f5e0ff,_0x2e5523=Math[_0x4f08d6(0x13f)](Math[_0x4f08d6(0xf3)]()*(_0x310af9-_0x5570d2+0x1))+_0x5570d2;var _0x44a964;const _0x4bed32=await purchases[_0x4f08d6(0x1a4)]({'invoice':'INC-'+_0x2e5523});return _0x4bed32&&_0x4bed32[_0x4f08d6(0x118)]>0x0?_0x44a964='INC-'+_0x2e5523:_0x44a964=_0x4f08d6(0xfa)+_0x2e5523,_0x44a964;}router['get'](a0_0x2aa5c5(0x169),auth,async(_0x5d1834,_0x100026)=>{var _0x267fbb=a0_0x2aa5c5;try{const {username:_0x5238f6,email:_0x2a9b19,role:_0x41653b}=_0x5d1834[_0x267fbb(0x178)],_0x49eafa=_0x5d1834[_0x267fbb(0x178)],_0x2547a8=await profile['findOne']({'email':_0x49eafa[_0x267fbb(0x1c4)]}),_0x4f8c8d=await master_shop[_0x267fbb(0x198)](),_0x3d3d65=await staff[_0x267fbb(0x1a4)]({'email':_0x49eafa['email']}),_0x4a32a9=await suppliers['find']({});let _0x405476;if(_0x49eafa['role']==_0x267fbb(0x1c3)){const _0x262002=await staff['findOne']({'email':_0x49eafa['email']});_0x405476=await warehouse[_0x267fbb(0x108)]([{'$match':{'status':_0x267fbb(0x1ad),'name':_0x262002[_0x267fbb(0x11e)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x267fbb(0x1d7)}}},{'$group':{'_id':'$name','name':{'$first':_0x267fbb(0x165)}}}]);}else _0x405476=await warehouse[_0x267fbb(0x108)]([{'$match':{'status':_0x267fbb(0x1ad),'warehouse_category':_0x267fbb(0x1cb),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x267fbb(0x165),'name':{'$first':_0x267fbb(0x165)}}}]);const _0x49b8a7=await product[_0x267fbb(0x198)]({}),_0x16c184=await warehouse['find']({'status':_0x267fbb(0x1ad)}),_0x578bd2=await purchases['find']({}),_0x4a4cb7=_0x578bd2[_0x267fbb(0x118)]+0x1,_0x5a6aab='INC-'+_0x4a4cb7[_0x267fbb(0x121)]()[_0x267fbb(0xef)](0x5,'0');var _0xc31230=['Ambient','Enclosed'];if(_0x4f8c8d[0x0][_0x267fbb(0x157)]==_0x267fbb(0x1d6))var _0x2a4aa3=users[_0x267fbb(0x15d)];else{if(_0x4f8c8d[0x0][_0x267fbb(0x157)]==_0x267fbb(0x175))var _0x2a4aa3=users[_0x267fbb(0x175)];else{if(_0x4f8c8d[0x0]['language']==_0x267fbb(0x1b1))var _0x2a4aa3=users[_0x267fbb(0x1b1)];else{if(_0x4f8c8d[0x0]['language']=='Spanish')var _0x2a4aa3=users[_0x267fbb(0xf6)];else{if(_0x4f8c8d[0x0][_0x267fbb(0x157)]==_0x267fbb(0x166))var _0x2a4aa3=users[_0x267fbb(0x166)];else{if(_0x4f8c8d[0x0][_0x267fbb(0x157)]=='Portuguese\x20(BR)')var _0x2a4aa3=users[_0x267fbb(0x1c5)];else{if(_0x4f8c8d[0x0][_0x267fbb(0x157)]==_0x267fbb(0x160))var _0x2a4aa3=users[_0x267fbb(0x160)];else{if(_0x4f8c8d[0x0][_0x267fbb(0x157)]==_0x267fbb(0x12a))var _0x2a4aa3=users[_0x267fbb(0x146)];}}}}}}}const _0x3b25f1=getRandom8DigitNumber();_0x3b25f1[_0x267fbb(0x1ec)](_0x12e0b2=>{var _0x2a8e34=_0x267fbb;_0x100026[_0x2a8e34(0x18f)](_0x2a8e34(0x14b),{'success':_0x5d1834[_0x2a8e34(0x155)](_0x2a8e34(0x1d8)),'errors':_0x5d1834[_0x2a8e34(0x155)](_0x2a8e34(0xe7)),'role':_0x49eafa,'profile':_0x2547a8,'suppliers':_0x4a32a9,'warehouse':_0x405476,'product':_0x49b8a7,'invoice':_0x12e0b2,'master_shop':_0x4f8c8d,'language':_0x2a4aa3,'find_data':_0x16c184,'rooms_data':_0xc31230});})[_0x267fbb(0x1ac)](_0xd30f77=>{var _0x2ee3f6=_0x267fbb;_0x5d1834[_0x2ee3f6(0x155)](_0x2ee3f6(0xe7),_0x2ee3f6(0x1d1)),_0x100026[_0x2ee3f6(0x1d5)]('/all_purchases/view');});}catch(_0x4ede50){console[_0x267fbb(0x1dc)](_0x4ede50);}}),router[a0_0x2aa5c5(0x148)]('/view/add_purchases/:id',auth,async(_0x4ed4df,_0x470609)=>{var _0x506561=a0_0x2aa5c5;try{const _0x4844a4=_0x4ed4df['params']['id'];console['log'](_0x4844a4);const _0x4f7919=await master_shop['find']();console[_0x506561(0x1dc)]('master',_0x4f7919);const _0xb54d5f=await product[_0x506561(0x1a4)]({'name':_0x4844a4});console[_0x506561(0x1dc)]('product',_0xb54d5f),_0x470609[_0x506561(0x18e)](0xc8)[_0x506561(0x1b6)]({'product_data':_0xb54d5f,'master':_0x4f7919});}catch(_0x5493dd){console[_0x506561(0x1dc)](_0x506561(0x18d),_0x5493dd);}}),router[a0_0x2aa5c5(0x18c)](a0_0x2aa5c5(0x169),auth,async(_0x3a3930,_0x39b72b)=>{var _0x1b9e83=a0_0x2aa5c5;try{const {invoice:_0x4e8ec6,date:_0x5bfc67,warehouse_name:_0x217ac7,prod_name:_0x165a72,prod_code:_0x48d8b4,prod_qty:_0x4043cf,prod_unit:_0x52e2f7,prod_secondunit:_0x2f3268,prod_level:_0x5cc1f0,prod_isle:_0x23b6ef,prod_pallet:_0x5e7521,note:_0x510d0d,expiry_date:_0x12d4bb,batch_code:_0x18a91b,payable:_0x46c95e,due_amount:_0x197efd,Room_name:_0x4db7c7,primary_code:_0x664475,secondary_code:_0x85bbca,MaxStocks_data:_0x31e252,PO_number:_0x4f9966,SCRN:_0x1d70bb,JO_number:_0x40494b}=_0x3a3930[_0x1b9e83(0x115)];if(typeof _0x165a72==_0x1b9e83(0x1f7))var _0x4b0058=[_0x3a3930[_0x1b9e83(0x115)]['prod_name']],_0x47982c=[_0x3a3930['body']['prod_code']],_0x32fd59=[_0x3a3930[_0x1b9e83(0x115)]['prod_Qty']],_0x7f9e2f=[_0x3a3930['body'][_0x1b9e83(0x145)]],_0x4fd2c3=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x19c)]],_0x154341=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x16d)]],_0x57523c=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1ce)]],_0x1cc4f0=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1dd)]],_0x24ef3d=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x119)]],_0x54838f=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x177)]],_0x43d5b1=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x10b)]],_0x14574d=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x156)]],_0x71181c=[_0x3a3930['body'][_0x1b9e83(0x1e8)]],_0x22a00f=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0xfe)]],_0x4910c7=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x161)]],_0x197c1e=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x19a)]],_0x4b2e40=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1f8)]],_0x4e6515=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1f3)]],_0x40002f=[_0x3a3930['body'][_0x1b9e83(0x1d2)]],_0xa912c=[_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1e7)]];else var _0x4b0058=[..._0x3a3930['body'][_0x1b9e83(0x14a)]],_0x47982c=[..._0x3a3930[_0x1b9e83(0x115)]['prod_code']],_0x32fd59=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1cd)]],_0x7f9e2f=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x145)]],_0x4fd2c3=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x19c)]],_0x154341=[..._0x3a3930['body']['prod_level']],_0x57523c=[..._0x3a3930[_0x1b9e83(0x115)]['primary_code']],_0x1cc4f0=[..._0x3a3930['body'][_0x1b9e83(0x1dd)]],_0x24ef3d=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x119)]],_0x54838f=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x177)]],_0x43d5b1=[..._0x3a3930['body']['expiry_date']],_0x14574d=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x156)]],_0x71181c=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1e8)]],_0x22a00f=[..._0x3a3930[_0x1b9e83(0x115)]['production_date']],_0x4910c7=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x161)]],_0x197c1e=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x19a)]],_0x4b2e40=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1f8)]],_0x4e6515=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1f3)]],_0x40002f=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1d2)]],_0xa912c=[..._0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1e7)]];const _0x3ba45e=_0x4b0058['map'](_0x36ba37=>{return _0x36ba37={'product_name':_0x36ba37};});_0x40002f[_0x1b9e83(0x1b8)]((_0x5a0701,_0x22e83c)=>{var _0x413f7b=_0x1b9e83;_0x3ba45e[_0x22e83c][_0x413f7b(0x1d2)]=Math[_0x413f7b(0xe6)](_0x5a0701);}),_0xa912c['forEach']((_0x1ab592,_0x308d31)=>{_0x3ba45e[_0x308d31]['actual_uom']=_0x1ab592;}),_0x47982c[_0x1b9e83(0x1b8)]((_0x522b12,_0x5b63b9)=>{var _0x5cd3a2=_0x1b9e83;_0x3ba45e[_0x5b63b9][_0x5cd3a2(0x15b)]=_0x522b12;}),_0x32fd59[_0x1b9e83(0x1b8)]((_0x39ddea,_0x240be2)=>{var _0x1cdc15=_0x1b9e83;_0x3ba45e[_0x240be2][_0x1cdc15(0x1bd)]=Math[_0x1cdc15(0xe6)](_0x39ddea);}),_0x7f9e2f[_0x1b9e83(0x1b8)]((_0x29d870,_0x3179a1)=>{var _0x47f6a5=_0x1b9e83;_0x3ba45e[_0x3179a1][_0x47f6a5(0x130)]=_0x29d870;}),_0x4fd2c3['forEach']((_0x4b1b91,_0x123472)=>{var _0x36670f=_0x1b9e83;_0x3ba45e[_0x123472][_0x36670f(0x139)]=_0x4b1b91;}),_0x154341[_0x1b9e83(0x1b8)]((_0x48b51d,_0x3dd0fe)=>{var _0x17b1e6=_0x1b9e83;_0x197c1e[_0x17b1e6(0x1b8)]((_0x3279ca,_0x50995c)=>{var _0x1ac515=_0x17b1e6;if(_0x3279ca=='Receiving\x20Area'&&_0x3dd0fe==_0x50995c){console[_0x1ac515(0x1dc)](_0x3279ca+_0x1ac515(0xde)+_0x3dd0fe+_0x1ac515(0x107)+_0x50995c+_0x1ac515(0x107)+_0x48b51d);var _0x271cf3=_0x48b51d[_0x1ac515(0x1b7)](0x3);_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1a0)]=_0x48b51d[0x0],_0x3ba45e[_0x3dd0fe]['rack']=_0x48b51d[0x1],_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1c7)]=0x0,_0x3ba45e[_0x3dd0fe][_0x1ac515(0x131)]=0x0,_0x3ba45e[_0x3dd0fe]['type']='Floor',_0x3ba45e[_0x3dd0fe][_0x1ac515(0x112)]=_0x271cf3;}else{if(_0x3279ca=='Shelves'&&_0x3dd0fe==_0x50995c){var _0x271cf3=_0x48b51d[_0x1ac515(0x1b7)](0x3);_0x3ba45e[_0x3dd0fe]['storage']=_0x48b51d[0x0],_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1f2)]=_0x48b51d[0x1],_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1c7)]=0x0,_0x3ba45e[_0x3dd0fe][_0x1ac515(0x131)]=0x0,_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1a3)]=_0x1ac515(0x19f),_0x3ba45e[_0x3dd0fe]['floorlevel']=_0x48b51d[0x5];}else{if(_0x3dd0fe==_0x50995c){if(_0x48b51d[0x0]=='A'&&_0x48b51d[0x1]=='L'&&_0x48b51d[0x2]=='L')console[_0x1ac515(0x1dc)](_0x3279ca+_0x1ac515(0x107)+_0x3dd0fe+_0x1ac515(0x107)+_0x50995c+_0x1ac515(0x107)+_0x48b51d+_0x1ac515(0xfc)),_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1a0)]=_0x48b51d[0x0],_0x3ba45e[_0x3dd0fe]['rack']=_0x48b51d[0x1],_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1c7)]=0x0,_0x3ba45e[_0x3dd0fe][_0x1ac515(0x131)]=0x0,_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1a3)]=_0x1ac515(0x19f),_0x3ba45e[_0x3dd0fe]['floorlevel']=_0x48b51d[0x3];else{var _0x26b492;if(_0x48b51d[0x4]=='L')_0x26b492='Level';else _0x48b51d[0x4]=='F'&&(_0x26b492=_0x1ac515(0x19f));_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1a0)]=_0x48b51d[0x0],_0x3ba45e[_0x3dd0fe]['rack']=_0x48b51d[0x1],_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1c7)]=_0x48b51d[0x2],_0x3ba45e[_0x3dd0fe]['bin']=_0x48b51d[0x3],_0x3ba45e[_0x3dd0fe][_0x1ac515(0x1a3)]=_0x26b492,_0x3ba45e[_0x3dd0fe][_0x1ac515(0x112)]=_0x48b51d[0x5];}}}}});}),_0x57523c[_0x1b9e83(0x1b8)]((_0x238741,_0x2dc68b)=>{_0x3ba45e[_0x2dc68b]['primary_code']=_0x238741;}),_0x1cc4f0[_0x1b9e83(0x1b8)]((_0x118877,_0x1ce05e)=>{var _0x400b3d=_0x1b9e83;_0x3ba45e[_0x1ce05e][_0x400b3d(0x1dd)]=_0x118877;}),_0x24ef3d[_0x1b9e83(0x1b8)]((_0x288f2c,_0x590321)=>{var _0x48933a=_0x1b9e83;_0x3ba45e[_0x590321][_0x48933a(0x1da)]=_0x288f2c;}),_0x54838f['forEach']((_0x49b60b,_0x2d9811)=>{_0x3ba45e[_0x2d9811]['batch_code']=_0x49b60b;}),_0x43d5b1[_0x1b9e83(0x1b8)]((_0x807c0,_0x47c311)=>{var _0x3833f7=_0x1b9e83;_0x3ba45e[_0x47c311][_0x3833f7(0x10b)]=_0x807c0;}),_0x14574d[_0x1b9e83(0x1b8)]((_0x39094e,_0x98060a)=>{var _0x480143=_0x1b9e83;_0x3ba45e[_0x98060a][_0x480143(0x1c9)]=_0x39094e;}),_0x71181c[_0x1b9e83(0x1b8)]((_0x377605,_0x4471ae)=>{var _0x2c9e8c=_0x1b9e83;_0x3ba45e[_0x4471ae][_0x2c9e8c(0x1e8)]=_0x377605;}),_0x22a00f['forEach']((_0x5cb900,_0xe7323d)=>{_0x3ba45e[_0xe7323d]['production_date']=_0x5cb900;}),_0x4910c7[_0x1b9e83(0x1b8)]((_0x3cb66a,_0xf5f925)=>{var _0x1f9d35=_0x1b9e83;_0x3ba45e[_0xf5f925][_0x1f9d35(0x1a6)]=_0x3cb66a;}),_0x197c1e['forEach']((_0x134343,_0x2d16f3)=>{var _0x28c684=_0x1b9e83;_0x3ba45e[_0x2d16f3][_0x28c684(0xf9)]=_0x134343;}),_0x4b2e40[_0x1b9e83(0x1b8)]((_0x4c6d4e,_0x1cde64)=>{var _0x5e9e58=_0x1b9e83;_0x3ba45e[_0x1cde64][_0x5e9e58(0x1e3)]=_0x4c6d4e;}),_0x4e6515[_0x1b9e83(0x1b8)]((_0x2f7039,_0x3d72b1)=>{var _0x55a3d6=_0x1b9e83;_0x3ba45e[_0x3d72b1][_0x55a3d6(0x164)]=_0x2f7039;});const _0x37c128=_0x197c1e['map'](_0x5b6b9a=>{return _0x5b6b9a={'room_name':_0x5b6b9a};}),_0xeed5e0=_0x3ba45e[_0x1b9e83(0x16e)](_0xcbd4ad=>_0xcbd4ad[_0x1b9e83(0x1bd)]!=='0'&&_0xcbd4ad['quantity']!==''),_0x28f2a3=new purchases({'invoice':_0x4e8ec6,'suppliers':_0x3a3930[_0x1b9e83(0x115)][_0x1b9e83(0x1e2)],'date':_0x5bfc67,'warehouse_name':_0x217ac7,'product':_0xeed5e0,'note':_0x510d0d,'due_amount':_0x197efd,'POnumber':_0x4f9966,'SCRN':_0x1d70bb,'JO_number':_0x40494b,'roomList':_0x37c128}),_0x337aee=await _0x28f2a3[_0x1b9e83(0x1f9)](),_0x563a7d=await purchases['findOne']({'invoice':_0x4e8ec6}),_0x2c76d7=_0x563a7d[_0x1b9e83(0x1ed)][_0x1b9e83(0x142)](async _0x33f420=>{var _0xe3c10d=_0x1b9e83,_0x50a693=await warehouse[_0xe3c10d(0x1a4)]({'name':_0x217ac7,'room':_0x33f420[_0xe3c10d(0xf9)]}),_0x500304=0x0;return _0x50a693['product_details']['forEach'](_0x2f3f49=>{var _0x2fa582=_0xe3c10d;_0x2f3f49[_0x2fa582(0x1e6)]==_0x33f420[_0x2fa582(0x1e6)]&&_0x2f3f49[_0x2fa582(0x112)]==_0x33f420[_0x2fa582(0x112)]&&_0x2f3f49[_0x2fa582(0x1a3)]==_0x33f420[_0x2fa582(0x1a3)]&&_0x2f3f49[_0x2fa582(0x131)]==_0x33f420[_0x2fa582(0x131)]&&_0x2f3f49[_0x2fa582(0x1c7)]==_0x33f420['bay']&&_0x2f3f49['rack']==_0x33f420[_0x2fa582(0x1f2)]&&_0x2f3f49[_0x2fa582(0x1a0)]==_0x33f420[_0x2fa582(0x1a0)]&&_0x2f3f49[_0x2fa582(0x10b)]==_0x33f420[_0x2fa582(0x10b)]&&_0x2f3f49['batch_code']==_0x33f420['batch_code']&&_0x2f3f49['production_date']==_0x33f420[_0x2fa582(0xfe)]&&_0x2f3f49['invoice']==_0x563a7d['invoice']&&(_0x2f3f49[_0x2fa582(0x179)]+=Math[_0x2fa582(0xe6)](_0x33f420['quantity']),_0x500304++);}),_0x500304===0x0&&_0x50a693[_0xe3c10d(0x109)][_0xe3c10d(0x1e1)]({'product_name':_0x33f420[_0xe3c10d(0x1e6)],'product_stock':Math['abs'](_0x33f420['quantity']),'primary_code':_0x33f420['primary_code'],'secondary_code':_0x33f420[_0xe3c10d(0x1dd)],'product_code':_0x33f420[_0xe3c10d(0x15b)],'storage':_0x33f420[_0xe3c10d(0x1a0)],'rack':_0x33f420[_0xe3c10d(0x1f2)],'bay':_0x33f420[_0xe3c10d(0x1c7)],'bin':_0x33f420['bin'],'type':_0x33f420[_0xe3c10d(0x1a3)],'floorlevel':_0x33f420[_0xe3c10d(0x112)],'maxProducts':_0x33f420[_0xe3c10d(0x1da)],'unit':_0x33f420[_0xe3c10d(0x130)],'secondary_unit':_0x33f420['secondary_unit'],'expiry_date':_0x33f420[_0xe3c10d(0x10b)],'maxPerUnit':_0x33f420['maxperunit'],'batch_code':_0x33f420['batch_code'],'alertQTY':_0x33f420[_0xe3c10d(0x1e8)],'production_date':_0x33f420['production_date'],'product_cat':_0x33f420[_0xe3c10d(0x1a6)],'invoice':_0x33f420[_0xe3c10d(0x164)],'actual_qty':Math[_0xe3c10d(0xe6)](_0x33f420['actual_qty']),'actual_uom':_0x33f420[_0xe3c10d(0x1e7)]}),_0x50a693;});Promise[_0x1b9e83(0xf4)](_0x2c76d7)[_0x1b9e83(0x1ec)](async _0x4247d5=>{var _0x50caf9=_0x1b9e83;try{for(const _0x26907c of _0x4247d5){await _0x26907c['save']();}const _0x26729d=await master_shop[_0x50caf9(0x198)](),_0x26f24f=await email_settings[_0x50caf9(0x1a4)](),_0x28693e=await supervisor_settings[_0x50caf9(0x198)]();var _0x12e637=_0x563a7d[_0x50caf9(0x1ed)],_0x585e5d='',_0x15293a;for(_0x15293a in _0x12e637){_0x585e5d+='<tr>'+_0x50caf9(0x152)+_0x12e637[_0x15293a]['product_name']+_0x50caf9(0xe3)+_0x50caf9(0x152)+_0x12e637[_0x15293a]['product_code']+_0x50caf9(0xe3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12e637[_0x15293a][_0x50caf9(0x1bd)]+_0x50caf9(0xe3)+_0x50caf9(0x152)+_0x12e637[_0x15293a][_0x50caf9(0x130)]+_0x50caf9(0xe3)+_0x50caf9(0x152)+_0x12e637[_0x15293a][_0x50caf9(0x139)]+_0x50caf9(0xe3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x563a7d[_0x50caf9(0x1bb)]+'</td>'+_0x50caf9(0x152)+_0x12e637[_0x15293a][_0x50caf9(0xf9)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12e637[_0x15293a][_0x50caf9(0x1a0)]+_0x12e637[_0x15293a][_0x50caf9(0x1f2)]+_0x12e637[_0x15293a]['bay']+_0x12e637[_0x15293a][_0x50caf9(0x131)]+_0x12e637[_0x15293a][_0x50caf9(0x1a3)][0x0]+_0x12e637[_0x15293a][_0x50caf9(0x112)]+_0x50caf9(0xe3),_0x50caf9(0xf1);}let _0x205b91=nodemailer[_0x50caf9(0x1b3)]({'host':_0x26f24f[_0x50caf9(0x125)],'port':Number(_0x26f24f[_0x50caf9(0xe4)]),'secure':![],'auth':{'user':_0x26f24f[_0x50caf9(0x1c4)],'pass':_0x26f24f['password']}}),_0x3a55d4={'from':_0x26f24f[_0x50caf9(0x1c4)],'to':_0x28693e[0x0][_0x50caf9(0x1f5)],'subject':_0x50caf9(0x196),'attachments':[{'filename':_0x50caf9(0x19b),'path':__dirname+_0x50caf9(0x1ab)+_0x50caf9(0x149)+_0x26729d[0x0]['image'],'cid':_0x50caf9(0xeb)}],'html':_0x50caf9(0x167)+'<html><head><title></title>'+_0x50caf9(0x12d)+_0x50caf9(0x171)+_0x50caf9(0x194)+_0x50caf9(0x171)+_0x50caf9(0x14d)+_0x50caf9(0x12e)+_0x50caf9(0x171)+_0x50caf9(0x19d)+_0x26729d[0x0][_0x50caf9(0x181)]+'\x20</h2>'+_0x50caf9(0x12e)+'</div>'+_0x50caf9(0x102)+_0x50caf9(0x171)+_0x50caf9(0x1f1)+_0x50caf9(0xf7)+_0x563a7d[_0x50caf9(0x164)]+'\x20'+_0x50caf9(0x10f)+_0x50caf9(0x1e0)+_0x563a7d[_0x50caf9(0x1e9)]+'\x20'+_0x50caf9(0x187)+'</h5>'+_0x50caf9(0x12e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x50caf9(0x185)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x50caf9(0x136)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x50caf9(0x1ee)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x50caf9(0x191)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x50caf9(0x133)+_0x50caf9(0xf1)+_0x50caf9(0x18b)+_0x50caf9(0x13c)+'\x20'+_0x585e5d+'\x20'+_0x50caf9(0x17f)+_0x50caf9(0x1c1)+_0x50caf9(0x171)+_0x50caf9(0x168)+_0x50caf9(0xe2)+_0x26729d[0x0][_0x50caf9(0x181)]+_0x50caf9(0x163)+_0x50caf9(0x12e)+_0x50caf9(0x12e)+'</body></html>'};_0x205b91[_0x50caf9(0x12c)](_0x3a55d4,function(_0x2aa781,_0x149ac2){var _0x52483c=_0x50caf9;_0x2aa781?(console['log'](_0x2aa781),console[_0x52483c(0x1dc)](_0x52483c(0xe1))):console[_0x52483c(0x1dc)](_0x52483c(0x128));}),_0x3a3930[_0x50caf9(0x155)](_0x50caf9(0x1d8),'Purchase\x20data\x20added\x20successfully'),_0x39b72b[_0x50caf9(0x1d5)](_0x50caf9(0x114));}catch(_0x3087f3){console[_0x50caf9(0x173)](_0x3087f3),_0x39b72b['status'](0x1f4)['json']({'error':_0x50caf9(0x10a)});}})['catch'](_0x5f138b=>{var _0x4e8e52=_0x1b9e83;console[_0x4e8e52(0x173)](_0x5f138b),_0x39b72b[_0x4e8e52(0x18e)](0x1f4)[_0x4e8e52(0x1b6)]({'error':'An\x20error\x20occurred.'});});}catch(_0x238a9d){console['log'](_0x238a9d);}}),router['get'](a0_0x2aa5c5(0xec),auth,async(_0x374f93,_0x244905)=>{var _0x4cf667=a0_0x2aa5c5;try{const {username:_0x3129ef,email:_0x5070ad,role:_0x296488}=_0x374f93[_0x4cf667(0x178)],_0x2d5f18=_0x374f93[_0x4cf667(0x178)],_0x10e2dd=await profile[_0x4cf667(0x1a4)]({'email':_0x2d5f18['email']}),_0x254614=await master_shop['find'](),_0x833fda=_0x374f93[_0x4cf667(0x116)]['id'],_0x500a56=await purchases[_0x4cf667(0x1ca)](_0x833fda),_0xda0471=await warehouse['aggregate']([{'$match':{'name':_0x500a56['warehouse_name'],'room':_0x500a56[_0x4cf667(0x1ef)]}},{'$unwind':_0x4cf667(0x1b5)},{'$group':{'_id':_0x4cf667(0x1b2),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4cf667(0x100)},'bin':{'$first':_0x4cf667(0x1d0)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4cf667(0x13b)},'primary_code':{'$first':_0x4cf667(0x1c0)},'secondary_code':{'$first':_0x4cf667(0x117)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4cf667(0x17e)}}}]),_0xbff135=await customer[_0x4cf667(0x198)]({});let _0x4899a6;if(_0x2d5f18['role']==_0x4cf667(0x1c3)){const _0x9decfc=await staff[_0x4cf667(0x1a4)]({'email':_0x2d5f18['email']});_0x4899a6=await warehouse[_0x4cf667(0x108)]([{'$match':{'status':_0x4cf667(0x1ad),'name':_0x9decfc[_0x4cf667(0x11e)]}},{'$group':{'_id':_0x4cf667(0x165),'name':{'$first':_0x4cf667(0x165)}}}]);}else _0x4899a6=await warehouse[_0x4cf667(0x108)]([{'$match':{'status':_0x4cf667(0x1ad)}},{'$group':{'_id':_0x4cf667(0x165),'name':{'$first':_0x4cf667(0x165)}}}]);const _0x4f4919=await product['find']({}),_0x551beb=await suppliers[_0x4cf667(0x198)]({}),_0x146bef=BayBinSelected(_0x500a56[_0x4cf667(0x1bb)],_0x500a56[_0x4cf667(0x1ef)]);if(_0x254614[0x0][_0x4cf667(0x157)]==_0x4cf667(0x1d6)){var _0x4a65da=users['English'];console['log'](_0x4a65da);}else{if(_0x254614[0x0][_0x4cf667(0x157)]==_0x4cf667(0x175))var _0x4a65da=users[_0x4cf667(0x175)];else{if(_0x254614[0x0][_0x4cf667(0x157)]=='German')var _0x4a65da=users[_0x4cf667(0x1b1)];else{if(_0x254614[0x0][_0x4cf667(0x157)]==_0x4cf667(0xf6))var _0x4a65da=users[_0x4cf667(0xf6)];else{if(_0x254614[0x0][_0x4cf667(0x157)]==_0x4cf667(0x166))var _0x4a65da=users[_0x4cf667(0x166)];else{if(_0x254614[0x0]['language']==_0x4cf667(0x1b4))var _0x4a65da=users[_0x4cf667(0x1c5)];else{if(_0x254614[0x0][_0x4cf667(0x157)]==_0x4cf667(0x160))var _0x4a65da=users[_0x4cf667(0x160)];else{if(_0x254614[0x0][_0x4cf667(0x157)]=='Arabic\x20(ae)')var _0x4a65da=users[_0x4cf667(0x146)];}}}}}}}_0x244905[_0x4cf667(0x18f)]('edit_purchases_view',{'success':_0x374f93[_0x4cf667(0x155)](_0x4cf667(0x1d8)),'errors':_0x374f93[_0x4cf667(0x155)](_0x4cf667(0xe7)),'role':_0x2d5f18,'profile':_0x10e2dd,'customer':_0xbff135,'warehouse':_0x4899a6,'product':_0xda0471,'user':_0x500a56,'master_shop':_0x254614,'unit':_0x4f4919,'language':_0x4a65da,'suppliers':_0x551beb,'dataSelected':_0x146bef});}catch(_0x98c5fe){console[_0x4cf667(0x1dc)](_0x98c5fe);}}),router[a0_0x2aa5c5(0x18c)](a0_0x2aa5c5(0xec),auth,async(_0x5127e4,_0x33148d)=>{var _0x26da5d=a0_0x2aa5c5;try{const _0x1e98bc=_0x5127e4[_0x26da5d(0x116)]['id'],{invoice:_0x50ed01,warehouse_name:_0x440d75,Room_name:_0x22519b}=_0x5127e4[_0x26da5d(0x115)],_0x31b0b6=await warehouse[_0x26da5d(0x1a4)]({'name':_0x440d75,'room':_0x22519b}),_0x2f280e=await purchases[_0x26da5d(0x1a4)]({'invoice':_0x50ed01});_0x2f280e[_0x26da5d(0x1ed)][_0x26da5d(0x1b8)](_0x251b02=>{var _0x2c91e9=_0x26da5d,_0x4ed933=0x0;const _0x1c4a96=_0x31b0b6[_0x2c91e9(0x109)][_0x2c91e9(0x142)](_0x2678ee=>{var _0x4ecccd=_0x2c91e9;_0x2678ee[_0x4ecccd(0x1e6)]==_0x251b02[_0x4ecccd(0x1e6)]&&_0x2678ee['floorlevel']==_0x251b02[_0x4ecccd(0x112)]&&_0x2678ee[_0x4ecccd(0x1a3)]==_0x251b02[_0x4ecccd(0x1a3)]&&_0x2678ee['bin']==_0x251b02['bin']&&_0x2678ee[_0x4ecccd(0x1c7)]==_0x251b02[_0x4ecccd(0x1c7)]&&_0x2678ee['rack']==_0x251b02[_0x4ecccd(0x1f2)]&&_0x2678ee[_0x4ecccd(0x1a0)]==_0x251b02[_0x4ecccd(0x1a0)]&&_0x2678ee['expiry_date']==_0x251b02['expiry_date']&&_0x2678ee[_0x4ecccd(0x177)]==_0x251b02[_0x4ecccd(0x177)]&&_0x2678ee[_0x4ecccd(0xfe)]==_0x251b02['production_date']&&_0x2678ee[_0x4ecccd(0x17d)]==_0x251b02[_0x4ecccd(0x17d)]&&_0x2678ee['delivery_code']==_0x251b02[_0x4ecccd(0x1e3)]&&(_0x2678ee[_0x4ecccd(0x179)]=parseInt(_0x2678ee[_0x4ecccd(0x179)])+parseInt(_0x251b02[_0x4ecccd(0x1bd)]),_0x4ed933++);});_0x4ed933=='0'&&(_0x31b0b6[_0x2c91e9(0x109)]=_0x31b0b6[_0x2c91e9(0x109)][_0x2c91e9(0x1e5)]({'product_name':_0x251b02[_0x2c91e9(0x1e6)],'product_stock':_0x251b02[_0x2c91e9(0x1bd)],'primary_code':_0x251b02[_0x2c91e9(0x1ce)],'secondary_code':_0x251b02[_0x2c91e9(0x1dd)],'product_code':_0x251b02[_0x2c91e9(0x15b)],'storage':_0x251b02[_0x2c91e9(0x1a0)],'rack':_0x251b02[_0x2c91e9(0x1f2)],'bay':_0x251b02['bay'],'bin':_0x251b02[_0x2c91e9(0x131)],'type':_0x251b02[_0x2c91e9(0x1a3)],'floorlevel':_0x251b02['floorlevel'],'maxProducts':_0x251b02['maxStocks'],'unit':_0x251b02['standard_unit'],'secondary_unit':_0x251b02[_0x2c91e9(0x139)],'expiry_date':_0x251b02[_0x2c91e9(0x10b)],'maxPerUnit':_0x251b02[_0x2c91e9(0x1c9)],'batch_code':_0x251b02[_0x2c91e9(0x177)],'alertQTY':_0x251b02['alertQTY'],'production_date':_0x251b02['production_date'],'delivery_date':_0x251b02[_0x2c91e9(0x17d)],'delivery_code':_0x251b02['delivery_code']}));}),await _0x31b0b6[_0x26da5d(0x1f9)](),_0x2f280e['finalize']=_0x26da5d(0x12f);const _0x4cfe5c=await _0x2f280e[_0x26da5d(0x1f9)]();_0x5127e4[_0x26da5d(0x155)](_0x26da5d(0x1d8),_0x26da5d(0x182)),_0x33148d[_0x26da5d(0x1d5)](_0x26da5d(0x14f));}catch(_0x48fbad){console[_0x26da5d(0x1dc)](_0x48fbad);}}),router[a0_0x2aa5c5(0x148)](a0_0x2aa5c5(0x126),auth,async(_0x1e1b24,_0x5c3553)=>{var _0x167c68=a0_0x2aa5c5;try{const {username:_0x1fdbba,email:_0x27d3c8,role:_0x997405}=_0x1e1b24[_0x167c68(0x178)],_0x12afc2=_0x1e1b24[_0x167c68(0x178)],_0x45d939=await profile[_0x167c68(0x1a4)]({'email':_0x12afc2[_0x167c68(0x1c4)]}),_0x21b7db=await master_shop['find'](),_0x5d6126=_0x1e1b24[_0x167c68(0x116)]['id'],_0x45cc93=await purchases[_0x167c68(0x1ca)](_0x5d6126),_0x38646f=await suppliers['find']({});let _0x7c297c;if(_0x12afc2[_0x167c68(0x104)]==_0x167c68(0x1c3)){const _0x569082=await staff[_0x167c68(0x1a4)]({'email':_0x12afc2[_0x167c68(0x1c4)]});_0x7c297c=await warehouse[_0x167c68(0x198)]({'status':_0x167c68(0x1ad),'name':_0x569082[_0x167c68(0x11e)],'warehouse_category':_0x167c68(0x1cb)});}else _0x7c297c=await warehouse[_0x167c68(0x108)]([{'$match':{'status':_0x167c68(0x1ad),'warehouse_category':_0x167c68(0x1cb)}},{'$group':{'_id':_0x167c68(0x165),'name':{'$first':'$name'}}}]);const _0x5d0e07=await product[_0x167c68(0x198)]({}),_0x12d847=BayBinSelected(_0x45cc93[_0x167c68(0x1bb)],_0x45cc93[_0x167c68(0x1ef)]);let _0x40a245=new Date(_0x45cc93['expiry_date']),_0x4a6919=('0'+_0x40a245[_0x167c68(0x16c)]())[_0x167c68(0x1b7)](-0x2),_0x21884f=('0'+(_0x40a245[_0x167c68(0x120)]()+0x1))[_0x167c68(0x1b7)](-0x2),_0x3dc3d8=_0x40a245['getFullYear'](),_0xbdf372=_0x3dc3d8+'-'+_0x21884f+'-'+_0x4a6919;if(_0x21b7db[0x0]['language']==_0x167c68(0x1d6)){var _0x5bb52b=users[_0x167c68(0x15d)];console['log'](_0x5bb52b);}else{if(_0x21b7db[0x0]['language']=='Hindi')var _0x5bb52b=users[_0x167c68(0x175)];else{if(_0x21b7db[0x0]['language']==_0x167c68(0x1b1))var _0x5bb52b=users[_0x167c68(0x1b1)];else{if(_0x21b7db[0x0][_0x167c68(0x157)]==_0x167c68(0xf6))var _0x5bb52b=users[_0x167c68(0xf6)];else{if(_0x21b7db[0x0][_0x167c68(0x157)]==_0x167c68(0x166))var _0x5bb52b=users['French'];else{if(_0x21b7db[0x0][_0x167c68(0x157)]==_0x167c68(0x1b4))var _0x5bb52b=users[_0x167c68(0x1c5)];else{if(_0x21b7db[0x0]['language']==_0x167c68(0x160))var _0x5bb52b=users[_0x167c68(0x160)];else{if(_0x21b7db[0x0][_0x167c68(0x157)]=='Arabic\x20(ae)')var _0x5bb52b=users[_0x167c68(0x146)];}}}}}}}_0x5c3553[_0x167c68(0x18f)](_0x167c68(0xdf),{'success':_0x1e1b24[_0x167c68(0x155)](_0x167c68(0x1d8)),'errors':_0x1e1b24[_0x167c68(0x155)](_0x167c68(0xe7)),'role':_0x12afc2,'profile':_0x45d939,'purchases':_0x45cc93,'suppliers':_0x38646f,'warehouse':_0x7c297c,'product':_0x5d0e07,'master_shop':_0x21b7db,'language':_0x5bb52b,'ed_fullDate':_0xbdf372,'dataSelected':_0x12d847});}catch(_0x4273ab){console['log'](_0x4273ab);}}),router[a0_0x2aa5c5(0x18c)]('/view/:id',auth,async(_0x5445d4,_0xc1c3f6)=>{var _0x572496=a0_0x2aa5c5;try{const _0x751f58=_0x5445d4[_0x572496(0x116)]['id'],_0x19a348=await purchases[_0x572496(0x1a4)]({'_id':_0x5445d4[_0x572496(0x116)]['id']}),_0x301981=await warehouse[_0x572496(0x1a4)]({'name':_0x19a348[_0x572496(0x1bb)],'room':_0x19a348[_0x572496(0x1ef)]});_0x19a348[_0x572496(0x1ed)][_0x572496(0x1b8)](_0x3e071f=>{var _0x324b33=_0x572496;const _0x2d3f2b=_0x301981[_0x324b33(0x109)][_0x324b33(0x142)](_0x35608d=>{var _0x4a2a1e=_0x324b33;_0x35608d[_0x4a2a1e(0x1e6)]==_0x3e071f['product_name']&&_0x35608d[_0x4a2a1e(0x112)]==_0x3e071f[_0x4a2a1e(0x112)]&&_0x35608d[_0x4a2a1e(0x1a3)]==_0x3e071f['type']&&_0x35608d[_0x4a2a1e(0x131)]==_0x3e071f[_0x4a2a1e(0x131)]&&_0x35608d['bay']==_0x3e071f[_0x4a2a1e(0x1c7)]&&_0x35608d['rack']==_0x3e071f[_0x4a2a1e(0x1f2)]&&_0x35608d['storage']==_0x3e071f[_0x4a2a1e(0x1a0)]&&(_0x35608d['product_stock']=parseInt(_0x35608d[_0x4a2a1e(0x179)])-parseInt(_0x3e071f['quantity']));});}),await _0x301981[_0x572496(0x1f9)]();const {invoice:_0x8b65e9,suppliers:_0x10af3c,date:_0x3909ab,warehouse_name:_0x113c95,prod_name:_0x34f4b7,prod_code:_0x285a3b,prod_qty:_0x152543,prod_unit:_0x592009,prod_secondunit:_0x17f981,prod_level:_0x909e29,prod_isle:_0x5a772c,prod_pallet:_0x194d64,note:_0x49a10a,expiry_date:_0xcabc88,batch_code:_0x1765cb,paid_amount:_0x1709f7,due_amount:_0x32ba1b,Room_name:_0x28c8d5,primary_code:_0x414699,secondary_code:_0x3e5174,PO_number:_0x1efd85,JO_number:_0x3ef6e9}=_0x5445d4['body'];if(typeof _0x34f4b7==_0x572496(0x1f7))var _0x33bf2e=[_0x5445d4['body'][_0x572496(0x14a)]],_0x20da81=[_0x5445d4[_0x572496(0x115)][_0x572496(0x1c2)]],_0x2efc2a=[_0x5445d4[_0x572496(0x115)][_0x572496(0x197)]],_0x24c626=[_0x5445d4[_0x572496(0x115)][_0x572496(0x189)]],_0x1a40b7=[_0x5445d4[_0x572496(0x115)][_0x572496(0x19c)]],_0x23bda7=[_0x5445d4[_0x572496(0x115)][_0x572496(0x16d)]],_0x12c90f=[_0x5445d4[_0x572496(0x115)][_0x572496(0x1c6)]],_0x4eba55=[_0x5445d4[_0x572496(0x115)]['prod_pallet']],_0x4b02be=[_0x5445d4[_0x572496(0x115)][_0x572496(0x1ce)]],_0x2aa88a=[_0x5445d4[_0x572496(0x115)]['secondary_code']],_0x589eb9=[_0x5445d4[_0x572496(0x115)][_0x572496(0x119)]],_0x424b5b=[_0x5445d4[_0x572496(0x115)][_0x572496(0x177)]],_0xe737d0=[_0x5445d4[_0x572496(0x115)][_0x572496(0x10b)]],_0x3fd6db=[_0x5445d4[_0x572496(0x115)][_0x572496(0x1a0)]],_0x7fb2f=[_0x5445d4[_0x572496(0x115)][_0x572496(0x13d)]],_0x982598=[_0x5445d4[_0x572496(0x115)]['type']];else var _0x33bf2e=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x14a)]],_0x20da81=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x1c2)]],_0x2efc2a=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x197)]],_0x24c626=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x189)]],_0x1a40b7=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x19c)]],_0x23bda7=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x16d)]],_0x12c90f=[..._0x5445d4['body'][_0x572496(0x1c6)]],_0x4eba55=[..._0x5445d4[_0x572496(0x115)]['prod_pallet']],_0x4b02be=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x1ce)]],_0x2aa88a=[..._0x5445d4[_0x572496(0x115)]['secondary_code']],_0x589eb9=[..._0x5445d4['body'][_0x572496(0x119)]],_0x424b5b=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x177)]],_0xe737d0=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x10b)]],_0x3fd6db=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x1a0)]],_0x7fb2f=[..._0x5445d4['body'][_0x572496(0x13d)]],_0x982598=[..._0x5445d4[_0x572496(0x115)][_0x572496(0x1a3)]];const _0xf98ff9=_0x33bf2e[_0x572496(0x142)](_0x599f47=>{return _0x599f47={'product_name':_0x599f47};});_0x20da81['forEach']((_0x1ccf6c,_0x4cba16)=>{var _0x3c1878=_0x572496;_0xf98ff9[_0x4cba16][_0x3c1878(0x15b)]=_0x1ccf6c;}),_0x2efc2a[_0x572496(0x1b8)]((_0x38411f,_0x265bc4)=>{var _0x1b8e85=_0x572496;_0xf98ff9[_0x265bc4][_0x1b8e85(0x1bd)]=_0x38411f;}),_0x24c626[_0x572496(0x1b8)]((_0x4c1ee2,_0x5c5414)=>{var _0x47fa19=_0x572496;_0xf98ff9[_0x5c5414][_0x47fa19(0x130)]=_0x4c1ee2;}),_0x1a40b7[_0x572496(0x1b8)]((_0xd81d8d,_0x5e9545)=>{var _0x15350c=_0x572496;_0xf98ff9[_0x5e9545][_0x15350c(0x139)]=_0xd81d8d;}),_0x23bda7[_0x572496(0x1b8)]((_0x476337,_0x6714ec)=>{var _0x3998f7=_0x572496;_0xf98ff9[_0x6714ec][_0x3998f7(0x1c7)]=_0x476337;}),_0x12c90f[_0x572496(0x1b8)]((_0x5633a8,_0x5d6542)=>{_0xf98ff9[_0x5d6542]['bin']=_0x5633a8;}),_0x4eba55[_0x572496(0x1b8)]((_0x47b1fd,_0x5e13fb)=>{_0xf98ff9[_0x5e13fb]['floorlevel']=_0x47b1fd;}),_0x4b02be[_0x572496(0x1b8)]((_0x47c2cc,_0x45f85a)=>{var _0x5d8358=_0x572496;_0xf98ff9[_0x45f85a][_0x5d8358(0x1ce)]=_0x47c2cc;}),_0x2aa88a[_0x572496(0x1b8)]((_0x268dd1,_0x53da55)=>{_0xf98ff9[_0x53da55]['secondary_code']=_0x268dd1;}),_0x589eb9[_0x572496(0x1b8)]((_0x6cabb8,_0x3bf57e)=>{_0xf98ff9[_0x3bf57e]['maxStocks']=_0x6cabb8;}),_0x424b5b['forEach']((_0xb920fa,_0x3252c1)=>{var _0x47d11a=_0x572496;_0xf98ff9[_0x3252c1][_0x47d11a(0x177)]=_0xb920fa;}),_0xe737d0['forEach']((_0x4a7626,_0x47eea2)=>{var _0x4aaf69=_0x572496;_0xf98ff9[_0x47eea2][_0x4aaf69(0x10b)]=_0x4a7626;}),_0x982598[_0x572496(0x1b8)]((_0xe7c265,_0x336adc)=>{var _0x4878a9=_0x572496;_0xf98ff9[_0x336adc][_0x4878a9(0x1a3)]=_0xe7c265;}),_0x3fd6db[_0x572496(0x1b8)]((_0x3e6c36,_0x4a46da)=>{_0xf98ff9[_0x4a46da]['storage']=_0x3e6c36;}),_0x7fb2f['forEach']((_0x510b5e,_0x5da15d)=>{var _0x981a3=_0x572496;_0xf98ff9[_0x5da15d][_0x981a3(0x1f2)]=_0x510b5e;});const _0x184d36=_0xf98ff9[_0x572496(0x16e)](_0x4e72f6=>_0x4e72f6[_0x572496(0x1bd)]!=='0'&&_0x4e72f6[_0x572496(0x1bd)]!=='');_0x19a348[_0x572496(0x164)]=_0x8b65e9,_0x19a348[_0x572496(0x1e2)]=_0x10af3c,_0x19a348['date']=_0x3909ab,_0x19a348[_0x572496(0x1bb)]=_0x113c95,_0x19a348[_0x572496(0x1ed)]=_0x184d36,_0x19a348[_0x572496(0x154)]=_0x49a10a,_0x19a348[_0x572496(0x11c)]=_0x1709f7,_0x19a348[_0x572496(0xe8)]=_0x32ba1b,_0x19a348[_0x572496(0x1ef)]=_0x28c8d5,_0x19a348[_0x572496(0x18a)]=_0x1efd85,_0x19a348[_0x572496(0x13e)]=_0x3ef6e9;const _0x13e593=await _0x19a348['save'](),_0x50910c=await warehouse[_0x572496(0x1a4)]({'name':_0x5445d4[_0x572496(0x115)][_0x572496(0x1bb)],'room':_0x5445d4['body'][_0x572496(0x186)]});_0x19a348[_0x572496(0x1ed)]['forEach'](_0x3dc93e=>{var _0x21eb45=_0x572496,_0x479b93=0x0;const _0x3f0062=_0x50910c[_0x21eb45(0x109)][_0x21eb45(0x142)](_0x332065=>{var _0x377168=_0x21eb45;_0x332065['product_name']==_0x3dc93e[_0x377168(0x1e6)]&&_0x332065['floorlevel']==_0x3dc93e[_0x377168(0x112)]&&_0x332065[_0x377168(0x1a3)]==_0x3dc93e[_0x377168(0x1a3)]&&_0x332065[_0x377168(0x131)]==_0x3dc93e[_0x377168(0x131)]&&_0x332065[_0x377168(0x1c7)]==_0x3dc93e[_0x377168(0x1c7)]&&_0x332065[_0x377168(0x1f2)]==_0x3dc93e[_0x377168(0x1f2)]&&_0x332065[_0x377168(0x1a0)]==_0x3dc93e[_0x377168(0x1a0)]&&(_0x332065['product_stock']=parseInt(_0x332065[_0x377168(0x179)])+parseInt(_0x3dc93e['quantity']),_0x479b93++);});_0x479b93=='0'&&(_0x50910c[_0x21eb45(0x109)]=_0x50910c[_0x21eb45(0x109)]['concat']({'product_name':_0x3dc93e[_0x21eb45(0x1e6)],'product_stock':_0x3dc93e[_0x21eb45(0x1bd)],'primary_code':_0x3dc93e[_0x21eb45(0x1ce)],'secondary_code':_0x3dc93e[_0x21eb45(0x1dd)],'product_code':_0x3dc93e[_0x21eb45(0x15b)],'storage':_0x3dc93e[_0x21eb45(0x1a0)],'rack':_0x3dc93e['rack'],'bay':_0x3dc93e['bay'],'bin':_0x3dc93e['bin'],'type':_0x3dc93e[_0x21eb45(0x1a3)],'floorlevel':_0x3dc93e[_0x21eb45(0x112)],'maxProducts':_0x3dc93e[_0x21eb45(0x1da)],'unit':_0x3dc93e[_0x21eb45(0x130)],'secondary_unit':_0x3dc93e[_0x21eb45(0x139)],'expiry_date':_0x3dc93e[_0x21eb45(0x10b)]}));}),await _0x50910c[_0x572496(0x1f9)]();const _0x2cc400=await s_payment_data[_0x572496(0x1a4)]({'invoice':_0x5445d4[_0x572496(0x115)][_0x572496(0x164)]});if(_0x2cc400===null){}else console[_0x572496(0x1dc)](_0x572496(0x1e2),_0x2cc400,_0x5445d4[_0x572496(0x115)][_0x572496(0x164)]),_0x2cc400['suppliers']=_0x5445d4[_0x572496(0x115)][_0x572496(0x1e2)],await _0x2cc400['save']();_0x5445d4[_0x572496(0x155)](_0x572496(0x1d8),_0x572496(0x1cf)),_0xc1c3f6['redirect']('/all_purchases/view');}catch(_0x48c05f){console[_0x572496(0x1dc)](_0x48c05f);}}),router[a0_0x2aa5c5(0x18c)](a0_0x2aa5c5(0x15c),auth,async(_0x540d8b,_0x461989)=>{var _0x21e96d=a0_0x2aa5c5;try{const _0x5f305c=_0x540d8b[_0x21e96d(0x116)]['id'],{invoice:_0x409451,suppliers:_0x5a68e6,payable:_0x11e760,due_amount:_0x572358}=_0x540d8b[_0x21e96d(0x115)],_0x1fc8fd=await purchases['findById'](_0x5f305c);var _0x19e0d2=_0x11e760-_0x572358;_0x1fc8fd[_0x21e96d(0x11c)]=parseFloat(_0x1fc8fd[_0x21e96d(0x11c)])+parseFloat(_0x572358),_0x1fc8fd['due_amount']=_0x19e0d2;const _0x41f39c=await _0x1fc8fd[_0x21e96d(0x1f9)]();console[_0x21e96d(0x1dc)](_0x41f39c);const _0x1bb16d=await s_payment_data[_0x21e96d(0x1a4)]({'invoice':_0x409451});_0x1bb16d['amount']=_0x19e0d2,await _0x1bb16d['save']();let _0x37fa21=new Date(),_0x106604=('0'+_0x37fa21[_0x21e96d(0x16c)]())['slice'](-0x2),_0x571d34=('0'+(_0x37fa21[_0x21e96d(0x120)]()+0x1))['slice'](-0x2),_0x5d7983=_0x37fa21['getFullYear'](),_0x43e687=_0x5d7983+'-'+_0x571d34+'-'+_0x106604;const _0x719ba6=new suppliers_payment({'invoice':_0x409451,'date':_0x5d7983+'-'+_0x571d34+'-'+_0x106604,'suppliers':_0x5a68e6,'reason':_0x21e96d(0x10c),'amount':_0x572358}),_0x26eed2=await _0x719ba6[_0x21e96d(0x1f9)]();_0x540d8b[_0x21e96d(0x155)](_0x21e96d(0x1d8),_0x21e96d(0x137)),_0x461989['redirect']('/all_purchases/view');}catch(_0x7087d5){console[_0x21e96d(0x1dc)](_0x7087d5);}}),router[a0_0x2aa5c5(0x148)](a0_0x2aa5c5(0x159),auth,async(_0x3a896a,_0x427208)=>{var _0x448f5e=a0_0x2aa5c5;try{const {username:_0x4a05e5,email:_0x34135e,role:_0x250f35}=_0x3a896a[_0x448f5e(0x178)],_0x434c4e=_0x3a896a[_0x448f5e(0x178)],_0x5e4ea2=await profile[_0x448f5e(0x1a4)]({'email':_0x434c4e[_0x448f5e(0x1c4)]}),_0x30fabe=await master_shop[_0x448f5e(0x198)]();console[_0x448f5e(0x1dc)](_0x448f5e(0xe5),_0x30fabe);const _0x52349c=_0x3a896a['params']['id'],_0x4b3a97=await purchases[_0x448f5e(0x1ca)](_0x52349c);console['log'](_0x4b3a97);const _0x1bd3bd=await suppliers[_0x448f5e(0x1a4)]({'name':_0x4b3a97[_0x448f5e(0x1e2)]});console['log'](_0x1bd3bd);if(_0x30fabe[0x0][_0x448f5e(0x157)]==_0x448f5e(0x1d6)){var _0x4cf00b=users[_0x448f5e(0x15d)];console[_0x448f5e(0x1dc)](_0x4cf00b);}else{if(_0x30fabe[0x0][_0x448f5e(0x157)]=='Hindi')var _0x4cf00b=users['Hindi'];else{if(_0x30fabe[0x0][_0x448f5e(0x157)]=='German')var _0x4cf00b=users[_0x448f5e(0x1b1)];else{if(_0x30fabe[0x0][_0x448f5e(0x157)]==_0x448f5e(0xf6))var _0x4cf00b=users['Spanish'];else{if(_0x30fabe[0x0][_0x448f5e(0x157)]==_0x448f5e(0x166))var _0x4cf00b=users[_0x448f5e(0x166)];else{if(_0x30fabe[0x0]['language']==_0x448f5e(0x1b4))var _0x4cf00b=users[_0x448f5e(0x1c5)];else{if(_0x30fabe[0x0][_0x448f5e(0x157)]=='Chinese')var _0x4cf00b=users[_0x448f5e(0x160)];else{if(_0x30fabe[0x0][_0x448f5e(0x157)]==_0x448f5e(0x12a))var _0x4cf00b=users[_0x448f5e(0x146)];}}}}}}}_0x427208[_0x448f5e(0x18f)]('purchase_invoice',{'success':_0x3a896a[_0x448f5e(0x155)](_0x448f5e(0x1d8)),'errors':_0x3a896a[_0x448f5e(0x155)](_0x448f5e(0xe7)),'role':_0x434c4e,'profile':_0x5e4ea2,'master_shop':_0x30fabe,'supplier':_0x1bd3bd,'purchase':_0x4b3a97,'language':_0x4cf00b});}catch(_0x58b159){console[_0x448f5e(0x1dc)](_0x58b159);}}),router[a0_0x2aa5c5(0x148)](a0_0x2aa5c5(0x1b9),auth,async(_0x4bbb79,_0x457e4a)=>{var _0x4f5765=a0_0x2aa5c5;try{const {username:_0x238a8f,email:_0x227eec,role:_0x43b88e}=_0x4bbb79[_0x4f5765(0x178)],_0x10c73e=_0x4bbb79[_0x4f5765(0x178)],_0x2ea4b6=await profile[_0x4f5765(0x1a4)]({'email':_0x10c73e[_0x4f5765(0x1c4)]}),_0x460c31=await master_shop[_0x4f5765(0x198)]();console['log'](_0x4f5765(0xe5),_0x460c31);const _0xea5cee=_0x4bbb79[_0x4f5765(0x116)]['id'];console[_0x4f5765(0x1dc)](_0xea5cee);const _0x1c6e02=await purchases[_0x4f5765(0x1ca)](_0xea5cee);console['log'](_0x4f5765(0x144),_0x1c6e02);const _0x191528=await product[_0x4f5765(0x198)]({}),_0x25424e=await warehouse[_0x4f5765(0x108)]([{'$match':{'name':_0x1c6e02[_0x4f5765(0x1bb)],'room':_0x1c6e02[_0x4f5765(0x1ef)],'warehouse_category':_0x4f5765(0x1cb)}},{'$unwind':_0x4f5765(0x1b5)},{'$group':{'_id':_0x4f5765(0x1b2),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4f5765(0x14e)},'bay':{'$first':_0x4f5765(0x100)},'bin':{'$first':_0x4f5765(0x1d0)},'type':{'$first':_0x4f5765(0x162)},'floorlevel':{'$first':_0x4f5765(0x13b)},'primary_code':{'$first':_0x4f5765(0x1c0)},'secondary_code':{'$first':_0x4f5765(0x117)},'product_code':{'$first':_0x4f5765(0x174)},'storage':{'$first':_0x4f5765(0x113)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x4f5765(0x108)]([{'$match':{'status':_0x4f5765(0x1ad),'name':_0x4f5765(0x1d7),'warehouse_category':_0x4f5765(0x1cb)}},{'$group':{'_id':'$name','name':{'$first':_0x4f5765(0x165)}}},{'$sort':{'name':0x1}}]),console[_0x4f5765(0x1dc)]('stock_data',_0x25424e);if(_0x460c31[0x0]['language']==_0x4f5765(0x1d6)){var _0x2f8605=users[_0x4f5765(0x15d)];console[_0x4f5765(0x1dc)](_0x2f8605);}else{if(_0x460c31[0x0][_0x4f5765(0x157)]==_0x4f5765(0x175))var _0x2f8605=users['Hindi'];else{if(_0x460c31[0x0]['language']==_0x4f5765(0x1b1))var _0x2f8605=users['German'];else{if(_0x460c31[0x0][_0x4f5765(0x157)]==_0x4f5765(0xf6))var _0x2f8605=users[_0x4f5765(0xf6)];else{if(_0x460c31[0x0][_0x4f5765(0x157)]==_0x4f5765(0x166))var _0x2f8605=users['French'];else{if(_0x460c31[0x0][_0x4f5765(0x157)]==_0x4f5765(0x1b4))var _0x2f8605=users['Portuguese'];else{if(_0x460c31[0x0][_0x4f5765(0x157)]==_0x4f5765(0x160))var _0x2f8605=users[_0x4f5765(0x160)];else{if(_0x460c31[0x0][_0x4f5765(0x157)]==_0x4f5765(0x12a))var _0x2f8605=users[_0x4f5765(0x146)];}}}}}}}_0x457e4a[_0x4f5765(0x18f)](_0x4f5765(0x17a),{'success':_0x4bbb79[_0x4f5765(0x155)](_0x4f5765(0x1d8)),'errors':_0x4bbb79[_0x4f5765(0x155)](_0x4f5765(0xe7)),'role':_0x10c73e,'profile':_0x2ea4b6,'user':_0x1c6e02,'stock':_0x25424e,'master_shop':_0x460c31,'product':_0x191528,'language':_0x2f8605,'warehouse':warehouse_data});}catch(_0xc856aa){console['log'](_0xc856aa);}}),router[a0_0x2aa5c5(0x18c)](a0_0x2aa5c5(0x1b9),auth,async(_0x116dee,_0x255b76)=>{var _0x1c582f=a0_0x2aa5c5;try{const {invoice:_0x458462,date:_0x25076f,warehouse_name:_0x4e10fc,Room_name:_0x311260,product_name:_0x335e54,purchase_quantity:_0xb95488,stocks:_0x4ef317,return_qty:_0x5f53c7,note:_0x3eaf35,level:_0x11cdae,isle:_0x485284,pallet:_0x384dc1,to_warehouse_name:_0xc297a7,to_Room_name:_0x4697a4}=_0x116dee[_0x1c582f(0x115)],_0x19cfbf=await purchases['findOne']({'_id':_0x116dee['params']['id']}),_0x3416d4=await warehouse[_0x1c582f(0x1a4)]({'name':_0x4e10fc,'room':_0x311260});if(typeof _0x335e54==_0x1c582f(0x1f7))var _0x3ddcf3=[_0x116dee['body'][_0x1c582f(0x1e6)]],_0x93fc10=[_0x116dee['body'][_0x1c582f(0x111)]],_0x53bc02=[_0x116dee['body'][_0x1c582f(0xed)]],_0x22f4cb=[_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x172)]],_0x49464e=[_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x184)]],_0x52f45f=[_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x15e)]],_0x5155c5=[_0x116dee[_0x1c582f(0x115)]['pallet']],_0x48c654=[_0x116dee[_0x1c582f(0x115)]['types']],_0x1917a5=[_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x1b0)]],_0x17b41f=[_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x195)]],_0x1240d1=[_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x17b)]];else var _0x3ddcf3=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x1e6)]],_0x93fc10=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x111)]],_0x53bc02=[..._0x116dee[_0x1c582f(0x115)]['stocks']],_0x22f4cb=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x172)]],_0x49464e=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x184)]],_0x52f45f=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x15e)]],_0x5155c5=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0xea)]],_0x48c654=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x101)]],_0x1917a5=[..._0x116dee[_0x1c582f(0x115)][_0x1c582f(0x1b0)]],_0x17b41f=[..._0x116dee['body']['primary_code_hide']],_0x1240d1=[..._0x116dee['body'][_0x1c582f(0x17b)]];const _0x29dba7=_0x3ddcf3[_0x1c582f(0x142)](_0x89d32e=>{return _0x89d32e={'product_name':_0x89d32e};});_0x93fc10[_0x1c582f(0x1b8)]((_0x2bc88b,_0xa79de5)=>{var _0x594d66=_0x1c582f;_0x29dba7[_0xa79de5][_0x594d66(0x111)]=_0x2bc88b;}),_0x53bc02[_0x1c582f(0x1b8)]((_0x3b5f20,_0x105770)=>{var _0x214621=_0x1c582f;_0x29dba7[_0x105770][_0x214621(0x151)]=_0x3b5f20;}),_0x22f4cb[_0x1c582f(0x1b8)]((_0x12cdc0,_0x2910e3)=>{var _0x45fee1=_0x1c582f;_0x29dba7[_0x2910e3][_0x45fee1(0x172)]=_0x12cdc0;}),_0x49464e[_0x1c582f(0x1b8)]((_0x435f95,_0x1a5fed)=>{var _0x5e5452=_0x1c582f;_0x29dba7[_0x1a5fed][_0x5e5452(0x1c7)]=_0x435f95;}),_0x52f45f[_0x1c582f(0x1b8)]((_0x4f9e77,_0x342e51)=>{var _0x28d431=_0x1c582f;_0x29dba7[_0x342e51][_0x28d431(0x131)]=_0x4f9e77;}),_0x5155c5['forEach']((_0x31d04f,_0x577565)=>{var _0x57a239=_0x1c582f;_0x29dba7[_0x577565][_0x57a239(0x112)]=_0x31d04f;}),_0x48c654[_0x1c582f(0x1b8)]((_0x3d2a64,_0x3f7dbf)=>{var _0x6e0203=_0x1c582f;_0x29dba7[_0x3f7dbf][_0x6e0203(0x1a3)]=_0x3d2a64;}),_0x1917a5[_0x1c582f(0x1b8)]((_0x3a1564,_0x3c8cd4)=>{_0x29dba7[_0x3c8cd4]['product_code']=_0x3a1564;}),_0x17b41f[_0x1c582f(0x1b8)]((_0x1447c9,_0x2e4fac)=>{var _0x1390a2=_0x1c582f;_0x29dba7[_0x2e4fac][_0x1390a2(0x1ce)]=_0x1447c9;}),_0x1240d1[_0x1c582f(0x1b8)]((_0x30803b,_0x2c2b21)=>{var _0x199e66=_0x1c582f;_0x29dba7[_0x2c2b21][_0x199e66(0x1dd)]=_0x30803b;}),_0x19cfbf[_0x1c582f(0x1ed)][_0x1c582f(0x1b8)](_0x290698=>{var _0x21d8f2=_0x1c582f;const _0xc111d7=_0x3416d4[_0x21d8f2(0x109)][_0x21d8f2(0x142)](_0x2b6415=>{var _0x3ad74e=_0x21d8f2;_0x2b6415[_0x3ad74e(0x1e6)]==_0x290698[_0x3ad74e(0x1e6)]&&_0x2b6415['floorlevel']==_0x290698[_0x3ad74e(0x112)]&&_0x2b6415[_0x3ad74e(0x1a3)]==_0x290698[_0x3ad74e(0x1a3)]&&_0x2b6415[_0x3ad74e(0x131)]==_0x290698['bin']&&_0x2b6415['bay']==_0x290698[_0x3ad74e(0x1c7)]&&_0x2b6415['rack']==_0x290698[_0x3ad74e(0x1f2)]&&_0x2b6415[_0x3ad74e(0x1a0)]==_0x290698[_0x3ad74e(0x1a0)]&&(console[_0x3ad74e(0x1dc)](parseInt(_0x2b6415[_0x3ad74e(0x179)])+_0x3ad74e(0x107)+parseInt(_0x290698[_0x3ad74e(0x1bd)])),_0x2b6415[_0x3ad74e(0x179)]=parseInt(_0x2b6415[_0x3ad74e(0x179)])+parseInt(_0x290698[_0x3ad74e(0x1bd)]));});}),await _0x3416d4[_0x1c582f(0x1f9)]();const _0x36b4a4=_0x29dba7[_0x1c582f(0x16e)](_0x49009c=>_0x49009c['return_qty']!=='0'&&_0x49009c['return_qty']!=='');var _0xa90cd0=0x0;_0x36b4a4['forEach'](_0x4f5f42=>{var _0x1f93f9=_0x1c582f;console[_0x1f93f9(0x1dc)](_0x1f93f9(0x141),_0x4f5f42),(parseInt(_0x4f5f42[_0x1f93f9(0x111)])<parseInt(_0x4f5f42['return_qty'])||parseInt(_0x4f5f42[_0x1f93f9(0x151)])<parseInt(_0x4f5f42[_0x1f93f9(0x172)]))&&_0xa90cd0++;});if(_0xa90cd0!=0x0)return _0x116dee['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x255b76[_0x1c582f(0x1d5)](_0x1c582f(0x10d));const _0x2cae43=new purchases_return({'invoice':_0x458462,'suppliers':_0x116dee[_0x1c582f(0x115)][_0x1c582f(0x1e2)],'date':_0x25076f,'warehouse_name':_0x4e10fc,'return_product':_0x36b4a4,'note':_0x3eaf35,'room':_0x311260,'to_warehouse_name':_0xc297a7,'to_room':_0x4697a4}),_0x50bf41=await _0x2cae43[_0x1c582f(0x1f9)]();console['log'](_0x2cae43);const _0x20c51f=await purchases_return[_0x1c582f(0x1a4)]({'invoice':_0x458462}),_0x25527d=await warehouse['findOne']({'name':_0xc297a7,'room':_0x4697a4});_0x20c51f[_0x1c582f(0x1a5)]['forEach'](_0x2645fd=>{var _0x41fde3=_0x1c582f,_0x39c333=0x0;const _0x19cb2a=_0x25527d[_0x41fde3(0x109)][_0x41fde3(0x142)](_0x1a1736=>{var _0x5d4434=_0x41fde3;_0x1a1736[_0x5d4434(0x1e6)]==_0x2645fd[_0x5d4434(0x1e6)]&&_0x1a1736[_0x5d4434(0x112)]==_0x2645fd[_0x5d4434(0x112)]&&_0x1a1736[_0x5d4434(0x1a3)]==_0x2645fd[_0x5d4434(0x1a3)]&&_0x1a1736[_0x5d4434(0x131)]==_0x2645fd['bin']&&_0x1a1736[_0x5d4434(0x1c7)]==_0x2645fd[_0x5d4434(0x1c7)]&&(_0x1a1736[_0x5d4434(0x179)]=parseInt(_0x1a1736[_0x5d4434(0x179)])-parseInt(_0x2645fd[_0x5d4434(0x172)]),_0x39c333++);});_0x39c333=='0'&&(_0x25527d[_0x41fde3(0x109)]=_0x25527d[_0x41fde3(0x109)][_0x41fde3(0x1e5)]({'product_name':_0x2645fd[_0x41fde3(0x1e6)],'product_stock':_0x2645fd['return_qty'],'primary_code':_0x2645fd['primary_code'],'secondary_code':_0x2645fd[_0x41fde3(0x1dd)],'product_code':_0x2645fd[_0x41fde3(0x15b)],'storage':_0x2645fd[_0x41fde3(0x1a0)],'rack':_0x2645fd[_0x41fde3(0x1f2)],'bay':_0x2645fd[_0x41fde3(0x1c7)],'bin':_0x2645fd[_0x41fde3(0x131)],'type':_0x2645fd[_0x41fde3(0x1a3)],'floorlevel':_0x2645fd['floorlevel'],'maxProducts':_0x2645fd['maxStocks'],'unit':_0x2645fd[_0x41fde3(0x130)],'secondary_unit':_0x2645fd[_0x41fde3(0x139)],'expiry_date':_0x2645fd[_0x41fde3(0x10b)]}));}),await _0x25527d['save']();const _0x5edcfc=await purchases[_0x1c582f(0x1a4)]({'invoice':_0x458462});_0x5edcfc['return_data']=_0x1c582f(0x12f);const _0x308088=await _0x5edcfc[_0x1c582f(0x1f9)](),_0x305e36=new s_payment_data({'invoice':_0x458462,'suppliers':_0x116dee['body'][_0x1c582f(0x1e2)],'reason':'Purchase\x20Return'});await _0x305e36['save']();const _0x21e1e1=await master_shop[_0x1c582f(0x198)]();console[_0x1c582f(0x1dc)](_0x1c582f(0xfd),_0x21e1e1[0x0]['image']);const _0x5865a8=await email_settings['findOne'](),_0xba75ff=await suppliers['findOne']({'name':_0x116dee['body'][_0x1c582f(0x1e2)]});console[_0x1c582f(0x1dc)]('suppliers_data',_0xba75ff);_0x21e1e1[0x0][_0x1c582f(0x1d9)]==0x1?(right_currency=_0x21e1e1[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x21e1e1[0x0]['currency']);var _0x20a1ad=_0x3ddcf3,_0x2de6ca=_0x22f4cb,_0x488f56='',_0x16dd46;for(_0x16dd46 in _0x20a1ad){_0x488f56+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20a1ad[_0x16dd46]+_0x1c582f(0xe3)+_0x1c582f(0x152)+_0x2de6ca[_0x16dd46]+_0x1c582f(0xe3)+_0x1c582f(0xf1);}console[_0x1c582f(0x1dc)](_0x1c582f(0x110),_0x488f56);let _0x2822a4=nodemailer[_0x1c582f(0x1b3)]({'service':'gmail','auth':{'user':_0x5865a8[_0x1c582f(0x1c4)],'pass':_0x5865a8[_0x1c582f(0x11b)]}}),_0x106a90={'from':_0x5865a8['email'],'to':_0xba75ff[_0x1c582f(0x1c4)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x1c582f(0x19b),'path':__dirname+'/../public'+_0x1c582f(0x149)+_0x21e1e1[0x0][_0x1c582f(0x1f6)],'cid':_0x1c582f(0xeb)}],'html':_0x1c582f(0x167)+'<html><head><title></title>'+_0x1c582f(0x12d)+_0x1c582f(0x171)+_0x1c582f(0x194)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x1c582f(0x19d)+_0x21e1e1[0x0]['site_title']+_0x1c582f(0x193)+_0x1c582f(0x12e)+'</div>'+_0x1c582f(0x102)+'<div>'+_0x1c582f(0x1f1)+_0x1c582f(0xf7)+_0x458462+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1c582f(0x1e0)+_0x25076f+'\x20'+'</span>'+_0x1c582f(0x163)+_0x1c582f(0x12e)+_0x1c582f(0x199)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1c582f(0x1df)+_0x1c582f(0x158)+_0x1c582f(0x1a8)+_0x1c582f(0x176)+_0x1c582f(0x15a)+_0x1c582f(0xf1)+_0x1c582f(0x18b)+_0x1c582f(0x13c)+'\x20'+_0x488f56+'\x20'+_0x1c582f(0x17f)+_0x1c582f(0x1c1)+'<div>'+_0x1c582f(0x168)+'<h5>'+_0x21e1e1[0x0][_0x1c582f(0x181)]+'</h5>'+_0x1c582f(0x12e)+'</div>'+_0x1c582f(0xfb)};_0x2822a4[_0x1c582f(0x12c)](_0x106a90,function(_0x2dcea2,_0x5f52fc){var _0x27be91=_0x1c582f;_0x2dcea2?(console[_0x27be91(0x1dc)](_0x2dcea2),console[_0x27be91(0x1dc)]('Error\x20Occurs')):console[_0x27be91(0x1dc)](_0x27be91(0x128));}),_0x116dee[_0x1c582f(0x155)](_0x1c582f(0x1d8),'purchases\x20item\x20return\x20successfull'),_0x255b76[_0x1c582f(0x1d5)](_0x1c582f(0x14f));}catch(_0x4979c3){console[_0x1c582f(0x1dc)](_0x4979c3),_0x255b76['status'](0xc8)[_0x1c582f(0x1b6)]({'message':_0x4979c3[_0x1c582f(0x190)]});}}),router[a0_0x2aa5c5(0x148)](a0_0x2aa5c5(0x147),auth,async(_0xe706cd,_0x3c638e)=>{var _0x19c0a1=a0_0x2aa5c5;try{const {username:_0x5f2d4d,email:_0x575bff,role:_0x6f3ced}=_0xe706cd[_0x19c0a1(0x178)],_0x50466a=_0xe706cd[_0x19c0a1(0x178)],_0x55d25c=await profile[_0x19c0a1(0x1a4)]({'email':_0x50466a[_0x19c0a1(0x1c4)]}),_0x592933=await master_shop[_0x19c0a1(0x198)](),_0x2d5a4a=_0xe706cd[_0x19c0a1(0x116)]['id'],_0x4af78f=await purchases[_0x19c0a1(0x1ca)](_0x2d5a4a);if(_0x592933[0x0][_0x19c0a1(0x157)]==_0x19c0a1(0x1d6))var _0x5c7ba0=users[_0x19c0a1(0x15d)];else{if(_0x592933[0x0][_0x19c0a1(0x157)]=='Hindi')var _0x5c7ba0=users[_0x19c0a1(0x175)];else{if(_0x592933[0x0]['language']=='German')var _0x5c7ba0=users['German'];else{if(_0x592933[0x0][_0x19c0a1(0x157)]==_0x19c0a1(0xf6))var _0x5c7ba0=users[_0x19c0a1(0xf6)];else{if(_0x592933[0x0][_0x19c0a1(0x157)]=='French')var _0x5c7ba0=users['French'];else{if(_0x592933[0x0][_0x19c0a1(0x157)]==_0x19c0a1(0x1b4))var _0x5c7ba0=users[_0x19c0a1(0x1c5)];else{if(_0x592933[0x0]['language']=='Chinese')var _0x5c7ba0=users['Chinese'];else{if(_0x592933[0x0][_0x19c0a1(0x157)]==_0x19c0a1(0x12a))var _0x5c7ba0=users[_0x19c0a1(0x146)];}}}}}}}_0x3c638e[_0x19c0a1(0x18f)]('all_purchases_barcode',{'success':_0xe706cd['flash'](_0x19c0a1(0x1d8)),'errors':_0xe706cd[_0x19c0a1(0x155)](_0x19c0a1(0xe7)),'role':_0x50466a,'profile':_0x55d25c,'alldata':_0x4af78f,'master_shop':_0x592933,'language':_0x5c7ba0}),console[_0x19c0a1(0x1dc)](alldata);}catch(_0x25b831){console['log'](_0x25b831);}}),router['post'](a0_0x2aa5c5(0x1c8),async(_0x164529,_0x42df5f)=>{var _0x30dba2=a0_0x2aa5c5;const {product_code:_0x2d62d8}=_0x164529[_0x30dba2(0x115)];var _0x49ffb9;const _0x9a6bd2=await product['aggregate']([{'$match':{'primary_code':_0x2d62d8,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x30dba2(0x129),'name':{'$first':'$name'},'category':{'$first':_0x30dba2(0x15f)},'brand':{'$first':_0x30dba2(0xff)},'unit':{'$first':_0x30dba2(0xe9)},'alertquantity':{'$first':_0x30dba2(0x1d4)},'product_code':{'$first':_0x30dba2(0x13a)},'primary_code':{'$first':_0x30dba2(0x122)},'secondary_code':{'$first':_0x30dba2(0x127)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x30dba2(0x11f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x30dba2(0x180)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x43a8e5=await product[_0x30dba2(0x108)]([{'$match':{'secondary_code':_0x2d62d8,'product_category':_0x30dba2(0x1cb)}},{'$group':{'_id':_0x30dba2(0x129),'name':{'$first':_0x30dba2(0x165)},'category':{'$first':_0x30dba2(0x15f)},'brand':{'$first':'$brand'},'unit':{'$first':_0x30dba2(0xe9)},'alertquantity':{'$first':_0x30dba2(0x1d4)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x30dba2(0x127)},'maxStocks':{'$first':_0x30dba2(0xf0)},'maxProdPerUnit':{'$first':_0x30dba2(0x11f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x30dba2(0x180)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x9a6bd2['length']>0x0)_0x49ffb9=_0x9a6bd2;else _0x43a8e5[_0x30dba2(0x118)]>0x0&&(_0x49ffb9=_0x43a8e5);_0x42df5f['json'](_0x49ffb9);}),router[a0_0x2aa5c5(0x18c)](a0_0x2aa5c5(0x1aa),async(_0x372177,_0x49e811)=>{var _0x300a00=a0_0x2aa5c5;const {primaryCode:_0x372b5e,secondaryCode:_0x1ef8c1,productCode:_0x2c36e0,bay:_0x10b098,bin:_0x199940,types:_0x35288b,pallet:_0x4691ad,warehouses:_0x4b0bb8,room:_0x472f2e}=_0x372177[_0x300a00(0x115)];console['log'](_0x372177['body']);try{const _0x21d3e7=await warehouse[_0x300a00(0x108)]([{'$match':{'name':_0x4b0bb8,'room':_0x472f2e}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x10b098,'product_details.bin':_0x199940,'product_details.type':_0x35288b}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x300a00(0x134)},'isle':{'$first':_0x300a00(0x1ea)},'pallet':{'$first':_0x300a00(0x12b)},'maxProducts':{'$first':_0x300a00(0x123)}}}]);_0x49e811[_0x300a00(0x18e)](0xc8)[_0x300a00(0x1b6)](_0x21d3e7);}catch(_0x42ba24){_0x49e811[_0x300a00(0x18e)](0x194)[_0x300a00(0x1b6)]({'message':_0x42ba24['message']});}}),module[a0_0x2aa5c5(0x1f4)]=router;