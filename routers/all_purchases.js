var a0_0x29f78d=a0_0x4f86;(function(_0x9040cc,_0x425c92){var _0x51c813=a0_0x4f86,_0x1f9d9a=_0x9040cc();while(!![]){try{var _0x26cc8b=-parseInt(_0x51c813(0x1ec))/0x1*(-parseInt(_0x51c813(0x22e))/0x2)+-parseInt(_0x51c813(0x23b))/0x3+parseInt(_0x51c813(0x1d9))/0x4*(-parseInt(_0x51c813(0x21f))/0x5)+-parseInt(_0x51c813(0x283))/0x6+parseInt(_0x51c813(0x28a))/0x7+parseInt(_0x51c813(0x298))/0x8*(parseInt(_0x51c813(0x20a))/0x9)+parseInt(_0x51c813(0x273))/0xa;if(_0x26cc8b===_0x425c92)break;else _0x1f9d9a['push'](_0x1f9d9a['shift']());}catch(_0xb14c92){_0x1f9d9a['push'](_0x1f9d9a['shift']());}}}(a0_0x5479,0x1e119));const express=require(a0_0x29f78d(0x2c0)),app=express(),router=express[a0_0x29f78d(0x25b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x29f78d(0x227)),nodemailer=require(a0_0x29f78d(0x2a4));function a0_0x5479(){var _0x31934d=['</table>','forEach','standard_unit','Rack\x20C','</h5>','level','purchases\x20item\x20return\x20successfull','DRY\x20STORAGE','$product_details.primary_code','Email\x20sent\x20successfully','/upload/','../public/language/languages.json','delivery_date','1760780MOUsMY','$secondary_unit','return_qty','German','Raw\x20Materials','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_primunit','success','$batch_code','message','$product_details.maxProducts','Arabic','Portuguese\x20(BR)','suppliers_data','deliverycode','541002uNAvXm','<strong>\x20Regards\x20</strong>','RMSEmail','suppliers_docs','$product_details.product_stock','ejs','</thead>','230104hxGbdg','True','gmail','<h5>','$brand','Level','filter','Rack\x20B','prod_secondunit','$suppliers','Spanish','floor','Purchase\x20Return','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','3256MHCsHY','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','sendMail','$maxProdPerUnit','return_product','room','</td>','Portuguese','Logo.png','/view/return_purchase/:id','concat','nodemailer','floorlevel','<tbody\x20style=\x22text-align:\x20center;\x22>','<html><head><title></title>','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room_name','$unit','get','master','<span\x20style=\x22float:\x20right;\x22>','Rack\x20D','maxperunit','primary_code_hide','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','staff','errors','all','\x20<\x20wew\x20>\x20','prod_unit','/preview/:id','prod_qty','prod_name','string','production_date','/CheckingWarehouse','actual_uom','POnumber','express','Arabic\x20(ae)','$product_details.product_code','Receiving\x20Area','date','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','site_title','$product.bay','push','add_purchases','$invoice','French','foreach\x20newproduct','toString','host','/all_purchases/view','save','currency_placement','product_list','$product_details.storage','An\x20error\x20occurred.','pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','aggregate','Enabled','MaxStocks_data','prod_cat','rak','bay','name','all_purchases','getMonth','$note','$product.type','/view/add_purchases/:id','$alertquantity','return_purchase','params','$product_details._id','add_purchases\x20error','$date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','due_amount','edit_purchases_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','padStart','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.bay','image','$product_details.floorlevel','<h2>\x20','<h5\x20style=\x22text-align:\x20left;\x22>','\x20Order\x20Number\x20:\x20','/../public','$suppliers_docs','20snVtrS','Purchase\x20Return\x20Mail','$due_amount','Rack\x20F','/all_purchases/view/','map','maxStocks','isle','Ambient','exports','<!DOCTYPE\x20html>','/barcode/:id','secondary_code_hide','\x20<>\x20','alertQTY','Shelves','</div>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20Order\x20Date\x20:\x20','1HgjEqn','quantity','</tbody>','$name','$warehouse_name','$return_data','prod_invoice','\x20</h2>','role','English\x20(US)','port','types','json','find','stock_data','purchase_invoice','language','suppliers','<tr>','redirect','getFullYear','</span>','password','product_cat','prod_pallet','/invoice/:id','actual_qty','batch_code','error','secondary_unit','657iNlftv','INC-','/view/:id','$secondary_code','user_id','findById','email','$product.bin','storage','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$expiry_date','paid_amount','Rack\x20A','prod_code','product_stock','length','RoomAssign','invoice','product_name','max_product_unit','$product_code','17770eKqDIc','getDate','$product','$product.quantity','prod_Qty','Return\x20Goods','warehouse','user','../middleware/auth','product_code_hide','payment\x20successfull','COLD\x20STORAGE','Room_name','add\x20post','purchase_quantity','118738HHMiRx','type','abs','post','findOne','all_purchases_barcode','Floor','Error\x20Occurs','Chinese','</head><body>','flash','$product_details.bin','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','200796dItpZc','bin','body','catch','createTransport','$product_details.level','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.expiry_date','$primary_code','$product_details.rack','secondary_code','stock_quantity','</body></html>','rack','/view/add_purchases','delivery_code','log','product_code','Hindi','currency','slice','$finalize','English','$product_details.secondary_code','status','$product_details.type','product','prod_level','/view','logo','warehouse_name','Router','<div>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','stocks','expiry_date','then','<hr\x20class=\x22my-3\x22>','$paid_amount','back','primary_code','$product_details'];a0_0x5479=function(){return _0x31934d;};return a0_0x5479();}var ejs=require(a0_0x29f78d(0x288));function a0_0x4f86(_0x5bbf02,_0x392197){var _0x54794e=a0_0x5479();return a0_0x4f86=function(_0x4f86da,_0x569a45){_0x4f86da=_0x4f86da-0x1be;var _0x28c808=_0x54794e[_0x4f86da];return _0x28c808;},a0_0x4f86(_0x5bbf02,_0x392197);}const path=require('path'),users=require(a0_0x29f78d(0x271));router['get'](a0_0x29f78d(0x258),auth,async(_0x3d5c78,_0x58206a)=>{var _0x26d252=a0_0x29f78d;try{const {username:_0x54bb7b,email:_0x3e1ff9,role:_0xef77ee}=_0x3d5c78[_0x26d252(0x226)],_0x2054f2=_0x3d5c78[_0x26d252(0x226)],_0x366274=await profile[_0x26d252(0x232)]({'email':_0x2054f2['email']}),_0x599230=await staff['findOne']({'email':_0x2054f2[_0x26d252(0x210)]});if(_0x2054f2[_0x26d252(0x1f4)]==_0x26d252(0x2b3)){const _0x150319=await staff[_0x26d252(0x232)]({'email':_0x2054f2[_0x26d252(0x210)]});}const _0x1e686d=await master_shop[_0x26d252(0x1f9)]();let _0x5618d2;if(_0x2054f2['role']==_0x26d252(0x2b3)){const _0x14f0c5=await staff[_0x26d252(0x232)]({'email':_0x2054f2[_0x26d252(0x210)]});_0x5618d2=await purchases[_0x26d252(0x2d8)]([{'$match':{'warehouse_name':_0x14f0c5[_0x26d252(0x225)]}},{'$lookup':{'from':_0x26d252(0x1fd),'localField':_0x26d252(0x1fd),'foreignField':_0x26d252(0x1be),'as':_0x26d252(0x286)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x26d252(0x1cf),'invoice':{'$first':_0x26d252(0x2cb)},'suppliers':{'$first':_0x26d252(0x293)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x26d252(0x1f0)},'room':{'$first':'$room'},'product':{'$push':_0x26d252(0x221)},'note':{'$first':_0x26d252(0x1c1)},'paid_amount':{'$first':_0x26d252(0x262)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x26d252(0x1f1)},'batch_code':{'$first':_0x26d252(0x27c)},'expiry_date':{'$first':_0x26d252(0x214)},'suppliers_docs':{'$first':_0x26d252(0x1d8)},'total_product_quantity':{'$sum':_0x26d252(0x222)},'level':{'$addToSet':_0x26d252(0x2c8)},'isle':{'$addToSet':_0x26d252(0x211)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5618d2=await purchases[_0x26d252(0x2d8)]([{'$lookup':{'from':_0x26d252(0x1fd),'localField':_0x26d252(0x1fd),'foreignField':_0x26d252(0x1be),'as':_0x26d252(0x286)}},{'$unwind':_0x26d252(0x1d8)},{'$unwind':_0x26d252(0x221)},{'$group':{'_id':_0x26d252(0x1cf),'invoice':{'$first':_0x26d252(0x2cb)},'suppliers':{'$first':_0x26d252(0x293)},'date':{'$first':_0x26d252(0x1c9)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x26d252(0x1c1)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x26d252(0x1db)},'return_data':{'$first':_0x26d252(0x1f1)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x26d252(0x214)},'suppliers_docs':{'$first':_0x26d252(0x1d8)},'total_product_quantity':{'$sum':_0x26d252(0x222)},'level':{'$addToSet':_0x26d252(0x2c8)},'isle':{'$addToSet':_0x26d252(0x211)},'type':{'$addToSet':_0x26d252(0x1c2)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x26d252(0x251)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1e686d[0x0]['language']==_0x26d252(0x1f5)){var _0x1efd5f=users[_0x26d252(0x252)];console[_0x26d252(0x24c)](_0x1efd5f);}else{if(_0x1e686d[0x0][_0x26d252(0x1fc)]=='Hindi')var _0x1efd5f=users[_0x26d252(0x24e)];else{if(_0x1e686d[0x0][_0x26d252(0x1fc)]=='German')var _0x1efd5f=users[_0x26d252(0x276)];else{if(_0x1e686d[0x0][_0x26d252(0x1fc)]==_0x26d252(0x294))var _0x1efd5f=users[_0x26d252(0x294)];else{if(_0x1e686d[0x0][_0x26d252(0x1fc)]==_0x26d252(0x2cc))var _0x1efd5f=users[_0x26d252(0x2cc)];else{if(_0x1e686d[0x0]['language']=='Portuguese\x20(BR)')var _0x1efd5f=users[_0x26d252(0x2a0)];else{if(_0x1e686d[0x0][_0x26d252(0x1fc)]==_0x26d252(0x236))var _0x1efd5f=users['Chinese'];else{if(_0x1e686d[0x0][_0x26d252(0x1fc)]=='Arabic\x20(ae)')var _0x1efd5f=users[_0x26d252(0x27f)];}}}}}}}_0x58206a[_0x26d252(0x278)](_0x26d252(0x1bf),{'success':_0x3d5c78['flash'](_0x26d252(0x27b)),'errors':_0x3d5c78[_0x26d252(0x238)](_0x26d252(0x2b4)),'purchases':_0x5618d2,'role':_0x2054f2,'profile':_0x366274,'master_shop':_0x1e686d,'language':_0x1efd5f});}catch(_0x229c8a){console['log']('table\x20page',_0x229c8a),_0x58206a[_0x26d252(0x254)](0xc8)['json']({'message':_0x229c8a[_0x26d252(0x27d)]});}});function BayBinSelected(_0x455210,_0x26b876){var _0x188275=a0_0x29f78d,_0x4452f6=[],_0x538102=[],_0x5e6665=[],_0x4eea57=[],_0xd4ecce=[],_0xf1983d=[];let _0x2b5be3=[];if(_0x455210==_0x188275(0x26d))switch(_0x26b876){case'Rack\x20A':_0x4452f6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x538102=[0x1,0x2],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=['Level',_0x188275(0x234)],_0xd4ecce=['D'],_0xf1983d=['A'];break;case _0x188275(0x291):_0x4452f6=[0x6,0x5,0x4,0x3,0x2,0x1],_0x538102=[0x1,0x2],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x28f),_0x188275(0x234)],_0xd4ecce=['D'],_0xf1983d=['B'];break;case'Shelves':_0x4452f6=[0x0],_0x538102=[0x0],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x234)],_0xd4ecce=['D'],_0xf1983d=['S'];break;case _0x188275(0x2c3):_0x4452f6=[0x0],_0x538102=[0x0],_0x4eea57=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5e6665=[_0x188275(0x234)],_0xd4ecce=['D'],_0xf1983d=['R'];break;}else{if(_0x455210==_0x188275(0x22a))switch(_0x26b876){case _0x188275(0x216):_0x4452f6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x538102=['B','F'],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x28f),_0x188275(0x234)],_0xd4ecce=['C'],_0xf1983d=['A'];break;case _0x188275(0x291):_0x4452f6=[0x5,0x4,0x3,0x2,0x1],_0x538102=['F','B','S'],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x28f),_0x188275(0x234)],_0xd4ecce=['C'],_0xf1983d=['B'];break;case _0x188275(0x269):_0x4452f6=[0x1,0x2,0x3,0x4,0x5],_0x538102=['B','F','S'],_0x4eea57=[0x5,0x4,0x3,0x2,0x1],_0x5e6665=['Level','Floor'],_0xd4ecce=['C'],_0xf1983d=['C'];break;case _0x188275(0x2af):_0x4452f6=[0x5,0x4,0x3,0x2,0x1],_0x538102=['F','B','S'],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x28f),_0x188275(0x234)],_0xd4ecce=['C'],_0xf1983d=['D'];break;case'Rack\x20E':_0x4452f6=[0x4,0x3,0x2,0x1],_0x538102=[0x1,0x2],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x28f),_0x188275(0x234)],_0xd4ecce=['C'],_0xf1983d=['E'];break;case _0x188275(0x1dc):_0x4452f6=[0x1,0x2,0x3],_0x538102=[0x1,0x2],_0x4eea57=[0x1,0x2,0x3,0x4,0x5],_0x5e6665=[_0x188275(0x28f)],_0xd4ecce=['C'],_0xf1983d=['F'];break;}}return{'levels':_0x4452f6,'Isle':_0x538102,'rack':_0x4eea57,'type':_0x5e6665,'storage':_0xd4ecce,'rak':_0xf1983d};}async function getRandom8DigitNumber(){var _0x293986=a0_0x29f78d;const _0x25f969=0x989680,_0x4528b7=0x5f5e0ff,_0x336f46=Math[_0x293986(0x295)](Math[_0x293986(0x241)]()*(_0x4528b7-_0x25f969+0x1))+_0x25f969;var _0x5d25eb;const _0x59eb79=await purchases[_0x293986(0x232)]({'invoice':_0x293986(0x20b)+_0x336f46});return _0x59eb79&&_0x59eb79[_0x293986(0x219)]>0x0?_0x5d25eb=_0x293986(0x20b)+_0x336f46:_0x5d25eb=_0x293986(0x20b)+_0x336f46,_0x5d25eb;}router[a0_0x29f78d(0x2ac)](a0_0x29f78d(0x24a),auth,async(_0x40c1f4,_0x423fdc)=>{var _0x507590=a0_0x29f78d;try{const {username:_0x11ce66,email:_0x3ef330,role:_0x3fc6c1}=_0x40c1f4[_0x507590(0x226)],_0x55ba38=_0x40c1f4[_0x507590(0x226)],_0x48906d=await profile[_0x507590(0x232)]({'email':_0x55ba38[_0x507590(0x210)]}),_0x258441=await master_shop[_0x507590(0x1f9)](),_0x396094=await staff[_0x507590(0x232)]({'email':_0x55ba38[_0x507590(0x210)]}),_0x2e0c89=await suppliers[_0x507590(0x1f9)]({});let _0x4b6f4d;if(_0x55ba38[_0x507590(0x1f4)]==_0x507590(0x2b3)){const _0x200780=await staff[_0x507590(0x232)]({'email':_0x55ba38[_0x507590(0x210)]});_0x4b6f4d=await warehouse[_0x507590(0x2d8)]([{'$match':{'status':_0x507590(0x2d9),'name':_0x200780['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x507590(0x224)}}},{'$group':{'_id':_0x507590(0x1ef),'name':{'$first':_0x507590(0x1ef)}}}]);}else _0x4b6f4d=await warehouse[_0x507590(0x2d8)]([{'$match':{'status':_0x507590(0x2d9),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x507590(0x224)}}},{'$group':{'_id':_0x507590(0x1ef),'name':{'$first':_0x507590(0x1ef)}}}]);const _0x3ae495=await product[_0x507590(0x1f9)]({}),_0x1fc38e=await warehouse[_0x507590(0x1f9)]({'status':'Enabled'}),_0x16f318=await purchases[_0x507590(0x1f9)]({}),_0x8b57db=_0x16f318['length']+0x1,_0x4e6c69='INC-'+_0x8b57db[_0x507590(0x2ce)]()[_0x507590(0x1ce)](0x5,'0');var _0x15fe0e=[_0x507590(0x1e1),'Enclosed'];if(_0x258441[0x0][_0x507590(0x1fc)]==_0x507590(0x1f5))var _0x5d54e6=users['English'];else{if(_0x258441[0x0][_0x507590(0x1fc)]==_0x507590(0x24e))var _0x5d54e6=users[_0x507590(0x24e)];else{if(_0x258441[0x0][_0x507590(0x1fc)]==_0x507590(0x276))var _0x5d54e6=users[_0x507590(0x276)];else{if(_0x258441[0x0]['language']==_0x507590(0x294))var _0x5d54e6=users[_0x507590(0x294)];else{if(_0x258441[0x0]['language']=='French')var _0x5d54e6=users['French'];else{if(_0x258441[0x0][_0x507590(0x1fc)]==_0x507590(0x280))var _0x5d54e6=users[_0x507590(0x2a0)];else{if(_0x258441[0x0][_0x507590(0x1fc)]==_0x507590(0x236))var _0x5d54e6=users['Chinese'];else{if(_0x258441[0x0][_0x507590(0x1fc)]=='Arabic\x20(ae)')var _0x5d54e6=users[_0x507590(0x27f)];}}}}}}}const _0x207b9f=getRandom8DigitNumber();_0x207b9f[_0x507590(0x260)](_0x4b10df=>{var _0x38990c=_0x507590;_0x423fdc[_0x38990c(0x278)](_0x38990c(0x2ca),{'success':_0x40c1f4[_0x38990c(0x238)]('success'),'errors':_0x40c1f4[_0x38990c(0x238)](_0x38990c(0x2b4)),'role':_0x55ba38,'profile':_0x48906d,'suppliers':_0x2e0c89,'warehouse':_0x4b6f4d,'product':_0x3ae495,'invoice':_0x4b10df,'master_shop':_0x258441,'language':_0x5d54e6,'find_data':_0x1fc38e,'rooms_data':_0x15fe0e});})[_0x507590(0x23e)](_0x4d4533=>{var _0x27b410=_0x507590;_0x40c1f4[_0x27b410(0x238)](_0x27b410(0x2b4),_0x27b410(0x1ca)),_0x423fdc[_0x27b410(0x1ff)]('/all_purchases/view');});}catch(_0xf072bd){console[_0x507590(0x24c)](_0xf072bd);}}),router['get'](a0_0x29f78d(0x1c3),auth,async(_0x26cf35,_0x74a50)=>{var _0x188632=a0_0x29f78d;try{const _0xa06684=_0x26cf35[_0x188632(0x1c6)]['id'];console[_0x188632(0x24c)](_0xa06684);const _0x54732f=await master_shop[_0x188632(0x1f9)]();console[_0x188632(0x24c)](_0x188632(0x2ad),_0x54732f);const _0x23db78=await product[_0x188632(0x232)]({'name':_0xa06684});console[_0x188632(0x24c)](_0x188632(0x256),_0x23db78),_0x74a50[_0x188632(0x254)](0xc8)['json']({'product_data':_0x23db78,'master':_0x54732f});}catch(_0x480146){console[_0x188632(0x24c)](_0x188632(0x1c8),_0x480146);}}),router['post'](a0_0x29f78d(0x24a),auth,async(_0x5aea40,_0x48132d)=>{var _0x357dfe=a0_0x29f78d;try{const {invoice:_0x47ae45,date:_0x234b79,warehouse_name:_0x80db12,prod_name:_0x7bebf4,prod_code:_0x48886b,prod_qty:_0x409aea,prod_unit:_0x43e570,prod_secondunit:_0x52ca6d,prod_level:_0x3aa1ca,prod_isle:_0x32fafb,prod_pallet:_0x311bcd,note:_0x1c4a66,expiry_date:_0x591b9e,batch_code:_0x6dce3,payable:_0x25b304,due_amount:_0x550ebf,Room_name:_0x2353f1,primary_code:_0x28ec9c,secondary_code:_0x23fee8,MaxStocks_data:_0x232491,PO_number:_0x369664,SCRN:_0x590f84,JO_number:_0x1d9f93}=_0x5aea40['body'];if(typeof _0x7bebf4==_0x357dfe(0x2bb))var _0x2448f4=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2ba)]],_0x1b4106=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x217)]],_0x2d8946=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x223)]],_0x54e647=[_0x5aea40['body'][_0x357dfe(0x27a)]],_0x4ade9e=[_0x5aea40['body'][_0x357dfe(0x292)]],_0x16ed9b=[_0x5aea40[_0x357dfe(0x23d)]['prod_level']],_0x184821=[_0x5aea40['body'][_0x357dfe(0x264)]],_0x1148e5=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x246)]],_0x453faf=[_0x5aea40['body']['MaxStocks_data']],_0x859bfe=[_0x5aea40['body']['batch_code']],_0x241fdf=[_0x5aea40['body'][_0x357dfe(0x25f)]],_0x132c5a=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x21d)]],_0x182824=[_0x5aea40['body'][_0x357dfe(0x1e7)]],_0x47b9ec=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2bc)]],_0x137630=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2db)]],_0x380c47=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x21a)]],_0x15b09d=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x282)]],_0x277c98=[_0x5aea40['body'][_0x357dfe(0x1f2)]],_0xf36a91=[_0x5aea40['body'][_0x357dfe(0x206)]],_0x207acd=[_0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2be)]];else var _0x2448f4=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2ba)]],_0x1b4106=[..._0x5aea40[_0x357dfe(0x23d)]['prod_code']],_0x2d8946=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x223)]],_0x54e647=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x27a)]],_0x4ade9e=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x292)]],_0x16ed9b=[..._0x5aea40['body']['prod_level']],_0x184821=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x264)]],_0x1148e5=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x246)]],_0x453faf=[..._0x5aea40['body'][_0x357dfe(0x2da)]],_0x859bfe=[..._0x5aea40['body'][_0x357dfe(0x207)]],_0x241fdf=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x25f)]],_0x132c5a=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x21d)]],_0x182824=[..._0x5aea40[_0x357dfe(0x23d)]['alertQTY']],_0x47b9ec=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2bc)]],_0x137630=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2db)]],_0x380c47=[..._0x5aea40['body'][_0x357dfe(0x21a)]],_0x15b09d=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x282)]],_0x277c98=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x1f2)]],_0xf36a91=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x206)]],_0x207acd=[..._0x5aea40[_0x357dfe(0x23d)][_0x357dfe(0x2be)]];const _0x4d4120=_0x2448f4['map'](_0x284565=>{return _0x284565={'product_name':_0x284565};});_0xf36a91[_0x357dfe(0x267)]((_0x208570,_0x5630a1)=>{var _0x4d5e68=_0x357dfe;_0x4d4120[_0x5630a1]['actual_qty']=Math[_0x4d5e68(0x230)](_0x208570);}),_0x207acd[_0x357dfe(0x267)]((_0x4d78b7,_0x1f59c7)=>{var _0x3cbc9e=_0x357dfe;_0x4d4120[_0x1f59c7][_0x3cbc9e(0x2be)]=_0x4d78b7;}),_0x1b4106[_0x357dfe(0x267)]((_0x40d308,_0xc816e5)=>{var _0x11b8f9=_0x357dfe;_0x4d4120[_0xc816e5][_0x11b8f9(0x24d)]=_0x40d308;}),_0x2d8946[_0x357dfe(0x267)]((_0x605ec6,_0x3b2665)=>{var _0x4ce133=_0x357dfe;_0x4d4120[_0x3b2665][_0x4ce133(0x1ed)]=Math[_0x4ce133(0x230)](_0x605ec6);}),_0x54e647['forEach']((_0x2c3ff6,_0x73f891)=>{var _0x14c083=_0x357dfe;_0x4d4120[_0x73f891][_0x14c083(0x268)]=_0x2c3ff6;}),_0x4ade9e[_0x357dfe(0x267)]((_0x5203a9,_0x4766d9)=>{var _0xfd823a=_0x357dfe;_0x4d4120[_0x4766d9][_0xfd823a(0x209)]=_0x5203a9;}),_0x16ed9b[_0x357dfe(0x267)]((_0x515498,_0x5210cb)=>{_0x380c47['forEach']((_0x1eb7d1,_0x19baea)=>{var _0x5c9cbe=a0_0x4f86;if(_0x1eb7d1=='Receiving\x20Area'&&_0x5210cb==_0x19baea){console['log'](_0x1eb7d1+_0x5c9cbe(0x2b6)+_0x5210cb+'\x20<>\x20'+_0x19baea+_0x5c9cbe(0x1e6)+_0x515498);var _0x3fa887=_0x515498[_0x5c9cbe(0x250)](0x3);_0x4d4120[_0x5210cb][_0x5c9cbe(0x212)]=_0x515498[0x0],_0x4d4120[_0x5210cb][_0x5c9cbe(0x249)]=_0x515498[0x1],_0x4d4120[_0x5210cb][_0x5c9cbe(0x2dd)]=0x0,_0x4d4120[_0x5210cb][_0x5c9cbe(0x23c)]=0x0,_0x4d4120[_0x5210cb][_0x5c9cbe(0x22f)]=_0x5c9cbe(0x234),_0x4d4120[_0x5210cb][_0x5c9cbe(0x2a5)]=_0x3fa887;}else{if(_0x1eb7d1==_0x5c9cbe(0x1e8)&&_0x5210cb==_0x19baea){var _0x3fa887=_0x515498[_0x5c9cbe(0x250)](0x3);_0x4d4120[_0x5210cb]['storage']=_0x515498[0x0],_0x4d4120[_0x5210cb][_0x5c9cbe(0x249)]=_0x515498[0x1],_0x4d4120[_0x5210cb][_0x5c9cbe(0x2dd)]=0x0,_0x4d4120[_0x5210cb]['bin']=0x0,_0x4d4120[_0x5210cb][_0x5c9cbe(0x22f)]='Floor',_0x4d4120[_0x5210cb][_0x5c9cbe(0x2a5)]=_0x515498[0x5];}else{if(_0x5210cb==_0x19baea){if(_0x515498[0x0]=='A'&&_0x515498[0x1]=='L'&&_0x515498[0x2]=='L')console[_0x5c9cbe(0x24c)](_0x1eb7d1+'\x20<>\x20'+_0x5210cb+_0x5c9cbe(0x1e6)+_0x19baea+'\x20<>\x20'+_0x515498+'here'),_0x4d4120[_0x5210cb][_0x5c9cbe(0x212)]=_0x515498[0x0],_0x4d4120[_0x5210cb][_0x5c9cbe(0x249)]=_0x515498[0x1],_0x4d4120[_0x5210cb][_0x5c9cbe(0x2dd)]=0x0,_0x4d4120[_0x5210cb][_0x5c9cbe(0x23c)]=0x0,_0x4d4120[_0x5210cb]['type']=_0x5c9cbe(0x234),_0x4d4120[_0x5210cb]['floorlevel']=_0x515498[0x3];else{var _0x270bf5;if(_0x515498[0x4]=='L')_0x270bf5=_0x5c9cbe(0x28f);else _0x515498[0x4]=='F'&&(_0x270bf5=_0x5c9cbe(0x234));_0x4d4120[_0x5210cb]['storage']=_0x515498[0x0],_0x4d4120[_0x5210cb][_0x5c9cbe(0x249)]=_0x515498[0x1],_0x4d4120[_0x5210cb]['bay']=_0x515498[0x2],_0x4d4120[_0x5210cb]['bin']=_0x515498[0x3],_0x4d4120[_0x5210cb]['type']=_0x270bf5,_0x4d4120[_0x5210cb][_0x5c9cbe(0x2a5)]=_0x515498[0x5];}}}}});}),_0x184821[_0x357dfe(0x267)]((_0x1f94bc,_0x1a242c)=>{var _0x5918ef=_0x357dfe;_0x4d4120[_0x1a242c][_0x5918ef(0x264)]=_0x1f94bc;}),_0x1148e5['forEach']((_0x3c21c8,_0x4e65b2)=>{var _0x559df7=_0x357dfe;_0x4d4120[_0x4e65b2][_0x559df7(0x246)]=_0x3c21c8;}),_0x453faf['forEach']((_0x379838,_0x3d8bb9)=>{var _0x22cd40=_0x357dfe;_0x4d4120[_0x3d8bb9][_0x22cd40(0x1df)]=_0x379838;}),_0x859bfe[_0x357dfe(0x267)]((_0x2fcc7b,_0x3229e8)=>{var _0x4e18a7=_0x357dfe;_0x4d4120[_0x3229e8][_0x4e18a7(0x207)]=_0x2fcc7b;}),_0x241fdf[_0x357dfe(0x267)]((_0x500bb1,_0x68d7a9)=>{var _0x1b995b=_0x357dfe;_0x4d4120[_0x68d7a9][_0x1b995b(0x25f)]=_0x500bb1;}),_0x132c5a[_0x357dfe(0x267)]((_0x32e161,_0x147735)=>{var _0x4895c5=_0x357dfe;_0x4d4120[_0x147735][_0x4895c5(0x2b0)]=_0x32e161;}),_0x182824[_0x357dfe(0x267)]((_0x3ad943,_0x3dc279)=>{var _0x5e619c=_0x357dfe;_0x4d4120[_0x3dc279][_0x5e619c(0x1e7)]=_0x3ad943;}),_0x47b9ec[_0x357dfe(0x267)]((_0x3c3d80,_0x5354e5)=>{_0x4d4120[_0x5354e5]['production_date']=_0x3c3d80;}),_0x137630[_0x357dfe(0x267)]((_0x18424f,_0x119878)=>{_0x4d4120[_0x119878]['product_cat']=_0x18424f;}),_0x380c47[_0x357dfe(0x267)]((_0x10e277,_0x1bf1b7)=>{var _0x5642b9=_0x357dfe;_0x4d4120[_0x1bf1b7][_0x5642b9(0x2aa)]=_0x10e277;}),_0x15b09d[_0x357dfe(0x267)]((_0x27e664,_0x19b63c)=>{var _0xbf3a65=_0x357dfe;_0x4d4120[_0x19b63c][_0xbf3a65(0x24b)]=_0x27e664;}),_0x277c98[_0x357dfe(0x267)]((_0x5e229d,_0x38bbe3)=>{var _0x15834c=_0x357dfe;_0x4d4120[_0x38bbe3][_0x15834c(0x21b)]=_0x5e229d;});const _0x28ccaf=_0x380c47[_0x357dfe(0x1de)](_0x2ecd7d=>{return _0x2ecd7d={'room_name':_0x2ecd7d};}),_0x1ff7fd=_0x4d4120[_0x357dfe(0x290)](_0x45fd04=>_0x45fd04['quantity']!=='0'&&_0x45fd04[_0x357dfe(0x1ed)]!==''),_0x483847=new purchases({'invoice':_0x47ae45,'suppliers':_0x5aea40[_0x357dfe(0x23d)]['suppliers'],'date':_0x234b79,'warehouse_name':_0x80db12,'product':_0x1ff7fd,'note':_0x1c4a66,'due_amount':_0x550ebf,'POnumber':_0x369664,'SCRN':_0x590f84,'JO_number':_0x1d9f93,'roomList':_0x28ccaf}),_0x4814e8=await _0x483847[_0x357dfe(0x2d1)](),_0x134648=await purchases[_0x357dfe(0x232)]({'invoice':_0x47ae45}),_0x355816=_0x134648[_0x357dfe(0x256)][_0x357dfe(0x1de)](async _0x569776=>{var _0x19845c=_0x357dfe,_0x47f644=await warehouse[_0x19845c(0x232)]({'name':_0x80db12,'room':_0x569776[_0x19845c(0x2aa)]}),_0x43af84=0x0;return _0x47f644['product_details'][_0x19845c(0x267)](_0x474f67=>{var _0x1c37a9=_0x19845c;_0x474f67['product_name']==_0x569776[_0x1c37a9(0x21c)]&&_0x474f67[_0x1c37a9(0x2a5)]==_0x569776[_0x1c37a9(0x2a5)]&&_0x474f67[_0x1c37a9(0x22f)]==_0x569776[_0x1c37a9(0x22f)]&&_0x474f67[_0x1c37a9(0x23c)]==_0x569776[_0x1c37a9(0x23c)]&&_0x474f67[_0x1c37a9(0x2dd)]==_0x569776[_0x1c37a9(0x2dd)]&&_0x474f67[_0x1c37a9(0x249)]==_0x569776['rack']&&_0x474f67[_0x1c37a9(0x212)]==_0x569776[_0x1c37a9(0x212)]&&_0x474f67[_0x1c37a9(0x25f)]==_0x569776[_0x1c37a9(0x25f)]&&_0x474f67[_0x1c37a9(0x207)]==_0x569776[_0x1c37a9(0x207)]&&_0x474f67[_0x1c37a9(0x2bc)]==_0x569776[_0x1c37a9(0x2bc)]&&_0x474f67[_0x1c37a9(0x21b)]==_0x134648[_0x1c37a9(0x21b)]&&(_0x474f67[_0x1c37a9(0x218)]+=Math[_0x1c37a9(0x230)](_0x569776['quantity']),_0x43af84++);}),_0x43af84===0x0&&_0x47f644[_0x19845c(0x2c5)][_0x19845c(0x2c9)]({'product_name':_0x569776[_0x19845c(0x21c)],'product_stock':Math[_0x19845c(0x230)](_0x569776[_0x19845c(0x1ed)]),'primary_code':_0x569776[_0x19845c(0x264)],'secondary_code':_0x569776[_0x19845c(0x246)],'product_code':_0x569776[_0x19845c(0x24d)],'storage':_0x569776[_0x19845c(0x212)],'rack':_0x569776['rack'],'bay':_0x569776[_0x19845c(0x2dd)],'bin':_0x569776[_0x19845c(0x23c)],'type':_0x569776['type'],'floorlevel':_0x569776[_0x19845c(0x2a5)],'maxProducts':_0x569776['maxStocks'],'unit':_0x569776[_0x19845c(0x268)],'secondary_unit':_0x569776['secondary_unit'],'expiry_date':_0x569776[_0x19845c(0x25f)],'maxPerUnit':_0x569776[_0x19845c(0x2b0)],'batch_code':_0x569776[_0x19845c(0x207)],'alertQTY':_0x569776[_0x19845c(0x1e7)],'production_date':_0x569776[_0x19845c(0x2bc)],'product_cat':_0x569776[_0x19845c(0x203)],'invoice':_0x569776[_0x19845c(0x21b)],'actual_qty':Math[_0x19845c(0x230)](_0x569776[_0x19845c(0x206)]),'actual_uom':_0x569776['actual_uom']}),_0x47f644;});Promise[_0x357dfe(0x2b5)](_0x355816)['then'](async _0x1204ba=>{var _0x156f3d=_0x357dfe;try{for(const _0x4908b2 of _0x1204ba){await _0x4908b2[_0x156f3d(0x2d1)]();}const _0xb72c9b=await master_shop[_0x156f3d(0x1f9)](),_0x333902=await email_settings['findOne'](),_0x14340f=await supervisor_settings[_0x156f3d(0x1f9)]();var _0x205592=_0x134648[_0x156f3d(0x256)],_0x5af217='',_0x25f11e;for(_0x25f11e in _0x205592){_0x5af217+=_0x156f3d(0x1fe)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x205592[_0x25f11e]['product_name']+'</td>'+_0x156f3d(0x1ea)+_0x205592[_0x25f11e][_0x156f3d(0x24d)]+_0x156f3d(0x29f)+_0x156f3d(0x1ea)+_0x205592[_0x25f11e][_0x156f3d(0x1ed)]+_0x156f3d(0x29f)+_0x156f3d(0x1ea)+_0x205592[_0x25f11e]['standard_unit']+_0x156f3d(0x29f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x205592[_0x25f11e][_0x156f3d(0x209)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x134648[_0x156f3d(0x25a)]+_0x156f3d(0x29f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x205592[_0x25f11e][_0x156f3d(0x2aa)]+_0x156f3d(0x29f)+_0x156f3d(0x1ea)+_0x205592[_0x25f11e][_0x156f3d(0x212)]+_0x205592[_0x25f11e]['rack']+_0x205592[_0x25f11e][_0x156f3d(0x2dd)]+_0x205592[_0x25f11e][_0x156f3d(0x23c)]+_0x205592[_0x25f11e][_0x156f3d(0x22f)][0x0]+_0x205592[_0x25f11e][_0x156f3d(0x2a5)]+_0x156f3d(0x29f),_0x156f3d(0x2a8);}let _0x5985d4=nodemailer[_0x156f3d(0x23f)]({'host':_0x333902[_0x156f3d(0x2cf)],'port':Number(_0x333902[_0x156f3d(0x1f6)]),'secure':![],'auth':{'user':_0x333902[_0x156f3d(0x210)],'pass':_0x333902['password']}}),_0x17dbf2={'from':_0x333902['email'],'to':_0x14340f[0x0][_0x156f3d(0x285)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x156f3d(0x270)+_0xb72c9b[0x0][_0x156f3d(0x1d2)],'cid':_0x156f3d(0x259)}],'html':_0x156f3d(0x1e3)+'<html><head><title></title>'+_0x156f3d(0x237)+_0x156f3d(0x25c)+_0x156f3d(0x213)+_0x156f3d(0x25c)+_0x156f3d(0x2b2)+_0x156f3d(0x1e9)+_0x156f3d(0x25c)+_0x156f3d(0x1d4)+_0xb72c9b[0x0][_0x156f3d(0x2c7)]+_0x156f3d(0x1f3)+_0x156f3d(0x1e9)+_0x156f3d(0x1e9)+'<hr\x20class=\x22my-3\x22>'+_0x156f3d(0x25c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x156f3d(0x1d6)+_0x134648[_0x156f3d(0x21b)]+'\x20'+_0x156f3d(0x2ae)+_0x156f3d(0x1eb)+_0x134648['date']+'\x20'+_0x156f3d(0x201)+_0x156f3d(0x26a)+_0x156f3d(0x1e9)+_0x156f3d(0x25d)+_0x156f3d(0x23a)+_0x156f3d(0x1fe)+_0x156f3d(0x279)+_0x156f3d(0x29a)+_0x156f3d(0x2d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x156f3d(0x2a9)+_0x156f3d(0x1cd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x156f3d(0x242)+_0x156f3d(0x2a8)+_0x156f3d(0x289)+_0x156f3d(0x2a6)+'\x20'+_0x5af217+'\x20'+_0x156f3d(0x1ee)+_0x156f3d(0x266)+_0x156f3d(0x25c)+_0x156f3d(0x284)+_0x156f3d(0x28d)+_0xb72c9b[0x0][_0x156f3d(0x2c7)]+_0x156f3d(0x26a)+_0x156f3d(0x1e9)+'</div>'+_0x156f3d(0x248)};_0x5985d4[_0x156f3d(0x29b)](_0x17dbf2,function(_0x2a12cf,_0x52e909){var _0x3d6ee8=_0x156f3d;_0x2a12cf?(console[_0x3d6ee8(0x24c)](_0x2a12cf),console[_0x3d6ee8(0x24c)](_0x3d6ee8(0x235))):console[_0x3d6ee8(0x24c)](_0x3d6ee8(0x26f));}),_0x5aea40[_0x156f3d(0x238)]('success','Purchase\x20data\x20added\x20successfully'),_0x48132d[_0x156f3d(0x1ff)](_0x156f3d(0x1dd));}catch(_0x3b4634){console[_0x156f3d(0x208)](_0x3b4634),_0x48132d['status'](0x1f4)[_0x156f3d(0x1f8)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x357dfe(0x23e)](_0x194841=>{var _0x1ce839=_0x357dfe;console[_0x1ce839(0x208)](_0x194841),_0x48132d[_0x1ce839(0x254)](0x1f4)[_0x1ce839(0x1f8)]({'error':_0x1ce839(0x2d5)});});}catch(_0x416168){console[_0x357dfe(0x24c)](_0x416168);}}),router['get'](a0_0x29f78d(0x2b8),auth,async(_0x3c54ac,_0x4a9972)=>{var _0x866c13=a0_0x29f78d;try{const {username:_0x2c4d70,email:_0x5d4f38,role:_0x5595d8}=_0x3c54ac['user'],_0xc876a2=_0x3c54ac['user'],_0x5732d5=await profile[_0x866c13(0x232)]({'email':_0xc876a2[_0x866c13(0x210)]}),_0x15da36=await master_shop[_0x866c13(0x1f9)](),_0xe5ea8b=_0x3c54ac[_0x866c13(0x1c6)]['id'],_0x1c0dd5=await purchases[_0x866c13(0x20f)](_0xe5ea8b),_0x51f4ec=await warehouse[_0x866c13(0x2d8)]([{'$match':{'name':_0x1c0dd5[_0x866c13(0x25a)],'room':_0x1c0dd5[_0x866c13(0x29e)]}},{'$unwind':_0x866c13(0x265)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x866c13(0x287)},'bay':{'$first':_0x866c13(0x1d1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x866c13(0x255)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x866c13(0x26e)},'secondary_code':{'$first':_0x866c13(0x253)},'product_code':{'$first':_0x866c13(0x2c2)},'storage':{'$first':_0x866c13(0x2d4)},'rack':{'$first':_0x866c13(0x245)},'expiry_date':{'$first':_0x866c13(0x243)}}}]),_0x26561b=await customer[_0x866c13(0x1f9)]({});let _0x2f6cdb;if(_0xc876a2[_0x866c13(0x1f4)]==_0x866c13(0x2b3)){const _0x3028c7=await staff[_0x866c13(0x232)]({'email':_0xc876a2[_0x866c13(0x210)]});_0x2f6cdb=await warehouse['aggregate']([{'$match':{'status':_0x866c13(0x2d9),'name':_0x3028c7[_0x866c13(0x225)]}},{'$group':{'_id':_0x866c13(0x1ef),'name':{'$first':_0x866c13(0x1ef)}}}]);}else _0x2f6cdb=await warehouse[_0x866c13(0x2d8)]([{'$match':{'status':_0x866c13(0x2d9)}},{'$group':{'_id':_0x866c13(0x1ef),'name':{'$first':_0x866c13(0x1ef)}}}]);const _0x4f0f53=await product[_0x866c13(0x1f9)]({}),_0xb5f814=await suppliers[_0x866c13(0x1f9)]({}),_0xe7d58d=BayBinSelected(_0x1c0dd5[_0x866c13(0x25a)],_0x1c0dd5[_0x866c13(0x29e)]);if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x1f5)){var _0x3dfca4=users[_0x866c13(0x252)];console['log'](_0x3dfca4);}else{if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x24e))var _0x3dfca4=users['Hindi'];else{if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x276))var _0x3dfca4=users['German'];else{if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x294))var _0x3dfca4=users[_0x866c13(0x294)];else{if(_0x15da36[0x0][_0x866c13(0x1fc)]=='French')var _0x3dfca4=users['French'];else{if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x280))var _0x3dfca4=users[_0x866c13(0x2a0)];else{if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x236))var _0x3dfca4=users['Chinese'];else{if(_0x15da36[0x0][_0x866c13(0x1fc)]==_0x866c13(0x2c1))var _0x3dfca4=users[_0x866c13(0x27f)];}}}}}}}_0x4a9972[_0x866c13(0x278)](_0x866c13(0x1cc),{'success':_0x3c54ac['flash']('success'),'errors':_0x3c54ac['flash'](_0x866c13(0x2b4)),'role':_0xc876a2,'profile':_0x5732d5,'customer':_0x26561b,'warehouse':_0x2f6cdb,'product':_0x51f4ec,'user':_0x1c0dd5,'master_shop':_0x15da36,'unit':_0x4f0f53,'language':_0x3dfca4,'suppliers':_0xb5f814,'dataSelected':_0xe7d58d});}catch(_0x55cd05){console[_0x866c13(0x24c)](_0x55cd05);}}),router[a0_0x29f78d(0x231)](a0_0x29f78d(0x2b8),auth,async(_0x2e586d,_0x312ae7)=>{var _0x35454b=a0_0x29f78d;try{const _0x2dcc30=_0x2e586d[_0x35454b(0x1c6)]['id'],{invoice:_0x7dfc61,warehouse_name:_0x35464e,Room_name:_0x326824}=_0x2e586d[_0x35454b(0x23d)],_0x31c618=await warehouse[_0x35454b(0x232)]({'name':_0x35464e,'room':_0x326824}),_0x4b133f=await purchases[_0x35454b(0x232)]({'invoice':_0x7dfc61});_0x4b133f[_0x35454b(0x256)][_0x35454b(0x267)](_0x40cf2e=>{var _0x4038e4=_0x35454b,_0x418468=0x0;const _0x539a3f=_0x31c618[_0x4038e4(0x2c5)][_0x4038e4(0x1de)](_0x1aea41=>{var _0x2c90dd=_0x4038e4;_0x1aea41[_0x2c90dd(0x21c)]==_0x40cf2e['product_name']&&_0x1aea41[_0x2c90dd(0x2a5)]==_0x40cf2e['floorlevel']&&_0x1aea41['type']==_0x40cf2e[_0x2c90dd(0x22f)]&&_0x1aea41[_0x2c90dd(0x23c)]==_0x40cf2e[_0x2c90dd(0x23c)]&&_0x1aea41[_0x2c90dd(0x2dd)]==_0x40cf2e[_0x2c90dd(0x2dd)]&&_0x1aea41[_0x2c90dd(0x249)]==_0x40cf2e['rack']&&_0x1aea41[_0x2c90dd(0x212)]==_0x40cf2e[_0x2c90dd(0x212)]&&_0x1aea41[_0x2c90dd(0x25f)]==_0x40cf2e[_0x2c90dd(0x25f)]&&_0x1aea41[_0x2c90dd(0x207)]==_0x40cf2e[_0x2c90dd(0x207)]&&_0x1aea41[_0x2c90dd(0x2bc)]==_0x40cf2e['production_date']&&_0x1aea41[_0x2c90dd(0x272)]==_0x40cf2e[_0x2c90dd(0x272)]&&_0x1aea41[_0x2c90dd(0x24b)]==_0x40cf2e[_0x2c90dd(0x24b)]&&(_0x1aea41['product_stock']=parseInt(_0x1aea41[_0x2c90dd(0x218)])+parseInt(_0x40cf2e[_0x2c90dd(0x1ed)]),_0x418468++);});_0x418468=='0'&&(_0x31c618[_0x4038e4(0x2c5)]=_0x31c618[_0x4038e4(0x2c5)][_0x4038e4(0x2a3)]({'product_name':_0x40cf2e[_0x4038e4(0x21c)],'product_stock':_0x40cf2e[_0x4038e4(0x1ed)],'primary_code':_0x40cf2e['primary_code'],'secondary_code':_0x40cf2e['secondary_code'],'product_code':_0x40cf2e[_0x4038e4(0x24d)],'storage':_0x40cf2e[_0x4038e4(0x212)],'rack':_0x40cf2e[_0x4038e4(0x249)],'bay':_0x40cf2e[_0x4038e4(0x2dd)],'bin':_0x40cf2e['bin'],'type':_0x40cf2e[_0x4038e4(0x22f)],'floorlevel':_0x40cf2e[_0x4038e4(0x2a5)],'maxProducts':_0x40cf2e[_0x4038e4(0x1df)],'unit':_0x40cf2e['standard_unit'],'secondary_unit':_0x40cf2e[_0x4038e4(0x209)],'expiry_date':_0x40cf2e[_0x4038e4(0x25f)],'maxPerUnit':_0x40cf2e[_0x4038e4(0x2b0)],'batch_code':_0x40cf2e[_0x4038e4(0x207)],'alertQTY':_0x40cf2e[_0x4038e4(0x1e7)],'production_date':_0x40cf2e[_0x4038e4(0x2bc)],'delivery_date':_0x40cf2e['delivery_date'],'delivery_code':_0x40cf2e[_0x4038e4(0x24b)]}));}),await _0x31c618[_0x35454b(0x2d1)](),_0x4b133f['finalize']=_0x35454b(0x28b);const _0xb86035=await _0x4b133f[_0x35454b(0x2d1)]();_0x2e586d[_0x35454b(0x238)]('success',_0x35454b(0x299)),_0x312ae7[_0x35454b(0x1ff)](_0x35454b(0x2d0));}catch(_0xcaef38){console[_0x35454b(0x24c)](_0xcaef38);}}),router[a0_0x29f78d(0x2ac)](a0_0x29f78d(0x20c),auth,async(_0xa2ae8b,_0x28d380)=>{var _0x2fc739=a0_0x29f78d;try{const {username:_0x233ffc,email:_0x114d40,role:_0x380857}=_0xa2ae8b['user'],_0x14af96=_0xa2ae8b[_0x2fc739(0x226)],_0x2e04be=await profile[_0x2fc739(0x232)]({'email':_0x14af96['email']}),_0x65f8da=await master_shop[_0x2fc739(0x1f9)](),_0x155168=_0xa2ae8b[_0x2fc739(0x1c6)]['id'],_0x41572d=await purchases[_0x2fc739(0x20f)](_0x155168),_0x46c084=await suppliers[_0x2fc739(0x1f9)]({});let _0x21af5b;if(_0x14af96['role']=='staff'){const _0x44bec9=await staff['findOne']({'email':_0x14af96[_0x2fc739(0x210)]});_0x21af5b=await warehouse[_0x2fc739(0x1f9)]({'status':_0x2fc739(0x2d9),'name':_0x44bec9['warehouse'],'warehouse_category':_0x2fc739(0x277)});}else _0x21af5b=await warehouse[_0x2fc739(0x2d8)]([{'$match':{'status':'Enabled','warehouse_category':_0x2fc739(0x277)}},{'$group':{'_id':_0x2fc739(0x1ef),'name':{'$first':_0x2fc739(0x1ef)}}}]);const _0x15c82a=await product[_0x2fc739(0x1f9)]({}),_0x430e75=BayBinSelected(_0x41572d[_0x2fc739(0x25a)],_0x41572d[_0x2fc739(0x29e)]);let _0x224b4d=new Date(_0x41572d['expiry_date']),_0x2dfa3=('0'+_0x224b4d[_0x2fc739(0x220)]())[_0x2fc739(0x250)](-0x2),_0x28f0eb=('0'+(_0x224b4d[_0x2fc739(0x1c0)]()+0x1))[_0x2fc739(0x250)](-0x2),_0x32738f=_0x224b4d[_0x2fc739(0x200)](),_0x4af1c8=_0x32738f+'-'+_0x28f0eb+'-'+_0x2dfa3;if(_0x65f8da[0x0][_0x2fc739(0x1fc)]=='English\x20(US)'){var _0x4cd80c=users[_0x2fc739(0x252)];console[_0x2fc739(0x24c)](_0x4cd80c);}else{if(_0x65f8da[0x0][_0x2fc739(0x1fc)]==_0x2fc739(0x24e))var _0x4cd80c=users[_0x2fc739(0x24e)];else{if(_0x65f8da[0x0][_0x2fc739(0x1fc)]==_0x2fc739(0x276))var _0x4cd80c=users[_0x2fc739(0x276)];else{if(_0x65f8da[0x0]['language']==_0x2fc739(0x294))var _0x4cd80c=users[_0x2fc739(0x294)];else{if(_0x65f8da[0x0][_0x2fc739(0x1fc)]==_0x2fc739(0x2cc))var _0x4cd80c=users[_0x2fc739(0x2cc)];else{if(_0x65f8da[0x0][_0x2fc739(0x1fc)]=='Portuguese\x20(BR)')var _0x4cd80c=users[_0x2fc739(0x2a0)];else{if(_0x65f8da[0x0]['language']==_0x2fc739(0x236))var _0x4cd80c=users[_0x2fc739(0x236)];else{if(_0x65f8da[0x0][_0x2fc739(0x1fc)]==_0x2fc739(0x2c1))var _0x4cd80c=users['Arabic'];}}}}}}}_0x28d380[_0x2fc739(0x278)]('edit_purchases',{'success':_0xa2ae8b[_0x2fc739(0x238)](_0x2fc739(0x27b)),'errors':_0xa2ae8b[_0x2fc739(0x238)](_0x2fc739(0x2b4)),'role':_0x14af96,'profile':_0x2e04be,'purchases':_0x41572d,'suppliers':_0x46c084,'warehouse':_0x21af5b,'product':_0x15c82a,'master_shop':_0x65f8da,'language':_0x4cd80c,'ed_fullDate':_0x4af1c8,'dataSelected':_0x430e75});}catch(_0x1ae8b2){console[_0x2fc739(0x24c)](_0x1ae8b2);}}),router[a0_0x29f78d(0x231)]('/view/:id',auth,async(_0x51fd59,_0x38c32e)=>{var _0xc5248f=a0_0x29f78d;try{const _0x136ed9=_0x51fd59['params']['id'],_0x76e1fc=await purchases[_0xc5248f(0x232)]({'_id':_0x51fd59[_0xc5248f(0x1c6)]['id']}),_0x3a5226=await warehouse[_0xc5248f(0x232)]({'name':_0x76e1fc[_0xc5248f(0x25a)],'room':_0x76e1fc[_0xc5248f(0x29e)]});_0x76e1fc[_0xc5248f(0x256)][_0xc5248f(0x267)](_0x379df3=>{var _0x3a9b09=_0xc5248f;const _0xc8824d=_0x3a5226[_0x3a9b09(0x2c5)]['map'](_0x3a369d=>{var _0x5b3cce=_0x3a9b09;_0x3a369d[_0x5b3cce(0x21c)]==_0x379df3[_0x5b3cce(0x21c)]&&_0x3a369d[_0x5b3cce(0x2a5)]==_0x379df3['floorlevel']&&_0x3a369d['type']==_0x379df3[_0x5b3cce(0x22f)]&&_0x3a369d[_0x5b3cce(0x23c)]==_0x379df3['bin']&&_0x3a369d[_0x5b3cce(0x2dd)]==_0x379df3[_0x5b3cce(0x2dd)]&&_0x3a369d[_0x5b3cce(0x249)]==_0x379df3[_0x5b3cce(0x249)]&&_0x3a369d['storage']==_0x379df3[_0x5b3cce(0x212)]&&(_0x3a369d[_0x5b3cce(0x218)]=parseInt(_0x3a369d[_0x5b3cce(0x218)])-parseInt(_0x379df3[_0x5b3cce(0x1ed)]));});}),await _0x3a5226['save']();const {invoice:_0x653ce1,suppliers:_0x573942,date:_0x3223c0,warehouse_name:_0x1c27e3,prod_name:_0x29478f,prod_code:_0x4c8e52,prod_qty:_0x51f983,prod_unit:_0x451c8c,prod_secondunit:_0x395611,prod_level:_0x4fd8e7,prod_isle:_0x90f865,prod_pallet:_0x97d745,note:_0x283021,expiry_date:_0x4f2fa0,batch_code:_0x3d7c0a,paid_amount:_0x5afba7,due_amount:_0x34def4,Room_name:_0x47eee6,primary_code:_0x442b18,secondary_code:_0x3a4430,PO_number:_0x5ba227,JO_number:_0x830e81}=_0x51fd59['body'];if(typeof _0x29478f==_0xc5248f(0x2bb))var _0x345420=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2ba)]],_0x3f154d=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x217)]],_0xef75fe=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2b9)]],_0x149485=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2b7)]],_0x42c3f0=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x292)]],_0x23cf7b=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x257)]],_0x4826a5=[_0x51fd59[_0xc5248f(0x23d)]['prod_isle']],_0x89e5fe=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x204)]],_0x392780=[_0x51fd59['body'][_0xc5248f(0x264)]],_0x1fe3bf=[_0x51fd59[_0xc5248f(0x23d)]['secondary_code']],_0x24e7cb=[_0x51fd59[_0xc5248f(0x23d)]['MaxStocks_data']],_0x5439cf=[_0x51fd59[_0xc5248f(0x23d)]['batch_code']],_0x3db233=[_0x51fd59[_0xc5248f(0x23d)]['expiry_date']],_0x325fa5=[_0x51fd59[_0xc5248f(0x23d)]['storage']],_0x563a1e=[_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2dc)]],_0x253e01=[_0x51fd59[_0xc5248f(0x23d)]['type']];else var _0x345420=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2ba)]],_0x3f154d=[..._0x51fd59['body'][_0xc5248f(0x217)]],_0xef75fe=[..._0x51fd59['body'][_0xc5248f(0x2b9)]],_0x149485=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2b7)]],_0x42c3f0=[..._0x51fd59[_0xc5248f(0x23d)]['prod_secondunit']],_0x23cf7b=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x257)]],_0x4826a5=[..._0x51fd59[_0xc5248f(0x23d)]['prod_isle']],_0x89e5fe=[..._0x51fd59[_0xc5248f(0x23d)]['prod_pallet']],_0x392780=[..._0x51fd59['body'][_0xc5248f(0x264)]],_0x1fe3bf=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x246)]],_0x24e7cb=[..._0x51fd59[_0xc5248f(0x23d)]['MaxStocks_data']],_0x5439cf=[..._0x51fd59['body'][_0xc5248f(0x207)]],_0x3db233=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x25f)]],_0x325fa5=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x212)]],_0x563a1e=[..._0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x2dc)]],_0x253e01=[..._0x51fd59[_0xc5248f(0x23d)]['type']];const _0x53cb96=_0x345420[_0xc5248f(0x1de)](_0x140aae=>{return _0x140aae={'product_name':_0x140aae};});_0x3f154d[_0xc5248f(0x267)]((_0x7e205f,_0x198f5b)=>{_0x53cb96[_0x198f5b]['product_code']=_0x7e205f;}),_0xef75fe[_0xc5248f(0x267)]((_0x550dbc,_0x357529)=>{var _0x30f24d=_0xc5248f;_0x53cb96[_0x357529][_0x30f24d(0x1ed)]=_0x550dbc;}),_0x149485['forEach']((_0x63f9c0,_0x578613)=>{var _0x4d5e7d=_0xc5248f;_0x53cb96[_0x578613][_0x4d5e7d(0x268)]=_0x63f9c0;}),_0x42c3f0['forEach']((_0x2c1945,_0x3c7a77)=>{var _0x296312=_0xc5248f;_0x53cb96[_0x3c7a77][_0x296312(0x209)]=_0x2c1945;}),_0x23cf7b[_0xc5248f(0x267)]((_0x271b3a,_0x2050c0)=>{_0x53cb96[_0x2050c0]['bay']=_0x271b3a;}),_0x4826a5['forEach']((_0x4c88fc,_0x2a8794)=>{var _0x5f4604=_0xc5248f;_0x53cb96[_0x2a8794][_0x5f4604(0x23c)]=_0x4c88fc;}),_0x89e5fe[_0xc5248f(0x267)]((_0xffd8fa,_0x526f65)=>{var _0x1275c6=_0xc5248f;_0x53cb96[_0x526f65][_0x1275c6(0x2a5)]=_0xffd8fa;}),_0x392780[_0xc5248f(0x267)]((_0x171d51,_0x76a934)=>{var _0x2a86e4=_0xc5248f;_0x53cb96[_0x76a934][_0x2a86e4(0x264)]=_0x171d51;}),_0x1fe3bf[_0xc5248f(0x267)]((_0x2f32a1,_0xd25916)=>{var _0x16e278=_0xc5248f;_0x53cb96[_0xd25916][_0x16e278(0x246)]=_0x2f32a1;}),_0x24e7cb[_0xc5248f(0x267)]((_0xa204de,_0x36fc81)=>{var _0x4dac94=_0xc5248f;_0x53cb96[_0x36fc81][_0x4dac94(0x1df)]=_0xa204de;}),_0x5439cf[_0xc5248f(0x267)]((_0x7fef34,_0x4c85e3)=>{var _0x396c83=_0xc5248f;_0x53cb96[_0x4c85e3][_0x396c83(0x207)]=_0x7fef34;}),_0x3db233[_0xc5248f(0x267)]((_0x126c37,_0x43e310)=>{var _0x4d1d7f=_0xc5248f;_0x53cb96[_0x43e310][_0x4d1d7f(0x25f)]=_0x126c37;}),_0x253e01['forEach']((_0x24b2db,_0x4db927)=>{var _0x5ddab7=_0xc5248f;_0x53cb96[_0x4db927][_0x5ddab7(0x22f)]=_0x24b2db;}),_0x325fa5['forEach']((_0x2b75c9,_0x1c4892)=>{_0x53cb96[_0x1c4892]['storage']=_0x2b75c9;}),_0x563a1e[_0xc5248f(0x267)]((_0x54a659,_0x55d825)=>{var _0x5ae48d=_0xc5248f;_0x53cb96[_0x55d825][_0x5ae48d(0x249)]=_0x54a659;});const _0x31aa0b=_0x53cb96[_0xc5248f(0x290)](_0x449c8f=>_0x449c8f['quantity']!=='0'&&_0x449c8f[_0xc5248f(0x1ed)]!=='');_0x76e1fc[_0xc5248f(0x21b)]=_0x653ce1,_0x76e1fc['suppliers']=_0x573942,_0x76e1fc[_0xc5248f(0x2c4)]=_0x3223c0,_0x76e1fc[_0xc5248f(0x25a)]=_0x1c27e3,_0x76e1fc['product']=_0x31aa0b,_0x76e1fc['note']=_0x283021,_0x76e1fc[_0xc5248f(0x215)]=_0x5afba7,_0x76e1fc[_0xc5248f(0x1cb)]=_0x34def4,_0x76e1fc['room']=_0x47eee6,_0x76e1fc[_0xc5248f(0x2bf)]=_0x5ba227,_0x76e1fc['JO_number']=_0x830e81;const _0x328161=await _0x76e1fc[_0xc5248f(0x2d1)](),_0x551164=await warehouse[_0xc5248f(0x232)]({'name':_0x51fd59[_0xc5248f(0x23d)]['warehouse_name'],'room':_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x22b)]});_0x76e1fc[_0xc5248f(0x256)]['forEach'](_0x4edd70=>{var _0x546ae6=_0xc5248f,_0x420922=0x0;const _0x355b78=_0x551164[_0x546ae6(0x2c5)]['map'](_0x3f4ee6=>{var _0x252e6d=_0x546ae6;_0x3f4ee6[_0x252e6d(0x21c)]==_0x4edd70[_0x252e6d(0x21c)]&&_0x3f4ee6[_0x252e6d(0x2a5)]==_0x4edd70[_0x252e6d(0x2a5)]&&_0x3f4ee6[_0x252e6d(0x22f)]==_0x4edd70[_0x252e6d(0x22f)]&&_0x3f4ee6[_0x252e6d(0x23c)]==_0x4edd70[_0x252e6d(0x23c)]&&_0x3f4ee6[_0x252e6d(0x2dd)]==_0x4edd70[_0x252e6d(0x2dd)]&&_0x3f4ee6['rack']==_0x4edd70[_0x252e6d(0x249)]&&_0x3f4ee6['storage']==_0x4edd70['storage']&&(_0x3f4ee6['product_stock']=parseInt(_0x3f4ee6[_0x252e6d(0x218)])+parseInt(_0x4edd70['quantity']),_0x420922++);});_0x420922=='0'&&(_0x551164[_0x546ae6(0x2c5)]=_0x551164[_0x546ae6(0x2c5)][_0x546ae6(0x2a3)]({'product_name':_0x4edd70[_0x546ae6(0x21c)],'product_stock':_0x4edd70[_0x546ae6(0x1ed)],'primary_code':_0x4edd70[_0x546ae6(0x264)],'secondary_code':_0x4edd70[_0x546ae6(0x246)],'product_code':_0x4edd70[_0x546ae6(0x24d)],'storage':_0x4edd70['storage'],'rack':_0x4edd70[_0x546ae6(0x249)],'bay':_0x4edd70[_0x546ae6(0x2dd)],'bin':_0x4edd70[_0x546ae6(0x23c)],'type':_0x4edd70[_0x546ae6(0x22f)],'floorlevel':_0x4edd70[_0x546ae6(0x2a5)],'maxProducts':_0x4edd70[_0x546ae6(0x1df)],'unit':_0x4edd70['standard_unit'],'secondary_unit':_0x4edd70[_0x546ae6(0x209)],'expiry_date':_0x4edd70[_0x546ae6(0x25f)]}));}),await _0x551164[_0xc5248f(0x2d1)]();const _0x1e9fc7=await s_payment_data['findOne']({'invoice':_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x21b)]});if(_0x1e9fc7===null){}else console[_0xc5248f(0x24c)](_0xc5248f(0x1fd),_0x1e9fc7,_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x21b)]),_0x1e9fc7[_0xc5248f(0x1fd)]=_0x51fd59[_0xc5248f(0x23d)][_0xc5248f(0x1fd)],await _0x1e9fc7[_0xc5248f(0x2d1)]();_0x51fd59[_0xc5248f(0x238)](_0xc5248f(0x27b),'purchase\x20data\x20update\x20successfully'),_0x38c32e[_0xc5248f(0x1ff)](_0xc5248f(0x2d0));}catch(_0x4c1350){console['log'](_0x4c1350);}}),router['post']('/give_payment/:id',auth,async(_0x2d9978,_0x50d1d2)=>{var _0x2c0fa3=a0_0x29f78d;try{const _0x30c8e3=_0x2d9978[_0x2c0fa3(0x1c6)]['id'],{invoice:_0x22a0ad,suppliers:_0x45c7b1,payable:_0x558a8b,due_amount:_0x496511}=_0x2d9978['body'],_0x57401a=await purchases['findById'](_0x30c8e3);var _0x1794d8=_0x558a8b-_0x496511;_0x57401a[_0x2c0fa3(0x215)]=parseFloat(_0x57401a[_0x2c0fa3(0x215)])+parseFloat(_0x496511),_0x57401a[_0x2c0fa3(0x1cb)]=_0x1794d8;const _0xd5c6b8=await _0x57401a[_0x2c0fa3(0x2d1)]();console[_0x2c0fa3(0x24c)](_0xd5c6b8);const _0x31adc0=await s_payment_data[_0x2c0fa3(0x232)]({'invoice':_0x22a0ad});_0x31adc0['amount']=_0x1794d8,await _0x31adc0[_0x2c0fa3(0x2d1)]();let _0x292dbf=new Date(),_0x534d53=('0'+_0x292dbf[_0x2c0fa3(0x220)]())[_0x2c0fa3(0x250)](-0x2),_0x7523e4=('0'+(_0x292dbf[_0x2c0fa3(0x1c0)]()+0x1))['slice'](-0x2),_0x468d7a=_0x292dbf[_0x2c0fa3(0x200)](),_0x3528ea=_0x468d7a+'-'+_0x7523e4+'-'+_0x534d53;const _0x30ecf8=new suppliers_payment({'invoice':_0x22a0ad,'date':_0x468d7a+'-'+_0x7523e4+'-'+_0x534d53,'suppliers':_0x45c7b1,'reason':'Paid\x20For\x20Purchase','amount':_0x496511}),_0x694dfe=await _0x30ecf8['save']();_0x2d9978[_0x2c0fa3(0x238)](_0x2c0fa3(0x27b),_0x2c0fa3(0x229)),_0x50d1d2[_0x2c0fa3(0x1ff)](_0x2c0fa3(0x2d0));}catch(_0x530347){console[_0x2c0fa3(0x24c)](_0x530347);}}),router[a0_0x29f78d(0x2ac)](a0_0x29f78d(0x205),auth,async(_0x3a4ee4,_0x4e9292)=>{var _0x2b658e=a0_0x29f78d;try{const {username:_0x331381,email:_0xc8c9a3,role:_0x63e7e4}=_0x3a4ee4[_0x2b658e(0x226)],_0x5907cb=_0x3a4ee4[_0x2b658e(0x226)],_0x560095=await profile[_0x2b658e(0x232)]({'email':_0x5907cb['email']}),_0x4b0f96=await master_shop['find']();console[_0x2b658e(0x24c)](_0x2b658e(0x2ad),_0x4b0f96);const _0x4a8536=_0x3a4ee4[_0x2b658e(0x1c6)]['id'],_0x5850e9=await purchases[_0x2b658e(0x20f)](_0x4a8536);console[_0x2b658e(0x24c)](_0x5850e9);const _0x4af9d5=await suppliers[_0x2b658e(0x232)]({'name':_0x5850e9['suppliers']});console[_0x2b658e(0x24c)](_0x4af9d5);if(_0x4b0f96[0x0][_0x2b658e(0x1fc)]==_0x2b658e(0x1f5)){var _0x4405c3=users[_0x2b658e(0x252)];console[_0x2b658e(0x24c)](_0x4405c3);}else{if(_0x4b0f96[0x0][_0x2b658e(0x1fc)]==_0x2b658e(0x24e))var _0x4405c3=users[_0x2b658e(0x24e)];else{if(_0x4b0f96[0x0]['language']==_0x2b658e(0x276))var _0x4405c3=users[_0x2b658e(0x276)];else{if(_0x4b0f96[0x0][_0x2b658e(0x1fc)]==_0x2b658e(0x294))var _0x4405c3=users['Spanish'];else{if(_0x4b0f96[0x0]['language']==_0x2b658e(0x2cc))var _0x4405c3=users['French'];else{if(_0x4b0f96[0x0]['language']==_0x2b658e(0x280))var _0x4405c3=users['Portuguese'];else{if(_0x4b0f96[0x0][_0x2b658e(0x1fc)]==_0x2b658e(0x236))var _0x4405c3=users[_0x2b658e(0x236)];else{if(_0x4b0f96[0x0][_0x2b658e(0x1fc)]==_0x2b658e(0x2c1))var _0x4405c3=users[_0x2b658e(0x27f)];}}}}}}}_0x4e9292[_0x2b658e(0x278)](_0x2b658e(0x1fb),{'success':_0x3a4ee4['flash']('success'),'errors':_0x3a4ee4[_0x2b658e(0x238)](_0x2b658e(0x2b4)),'role':_0x5907cb,'profile':_0x560095,'master_shop':_0x4b0f96,'supplier':_0x4af9d5,'purchase':_0x5850e9,'language':_0x4405c3});}catch(_0x24ff33){console['log'](_0x24ff33);}}),router[a0_0x29f78d(0x2ac)](a0_0x29f78d(0x2a2),auth,async(_0x723b7e,_0x5ad177)=>{var _0x478e25=a0_0x29f78d;try{const {username:_0xadc4d4,email:_0x4fb0f0,role:_0x233026}=_0x723b7e[_0x478e25(0x226)],_0x69bda0=_0x723b7e[_0x478e25(0x226)],_0x495c39=await profile[_0x478e25(0x232)]({'email':_0x69bda0[_0x478e25(0x210)]}),_0x4e00d2=await master_shop[_0x478e25(0x1f9)]();console[_0x478e25(0x24c)](_0x478e25(0x2ad),_0x4e00d2);const _0x14ee00=_0x723b7e[_0x478e25(0x1c6)]['id'];console[_0x478e25(0x24c)](_0x14ee00);const _0x53897f=await purchases['findById'](_0x14ee00);console[_0x478e25(0x24c)](_0x478e25(0x20e),_0x53897f);const _0x29bd9e=await product[_0x478e25(0x1f9)]({}),_0x414bea=await warehouse[_0x478e25(0x2d8)]([{'$match':{'name':_0x53897f[_0x478e25(0x25a)],'room':_0x53897f[_0x478e25(0x29e)],'warehouse_category':_0x478e25(0x277)}},{'$unwind':_0x478e25(0x265)},{'$group':{'_id':_0x478e25(0x1c7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x478e25(0x287)},'bay':{'$first':_0x478e25(0x1d1)},'bin':{'$first':_0x478e25(0x239)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x478e25(0x1d3)},'primary_code':{'$first':_0x478e25(0x26e)},'secondary_code':{'$first':_0x478e25(0x253)},'product_code':{'$first':_0x478e25(0x2c2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x478e25(0x245)}}}]);warehouse_data=await warehouse[_0x478e25(0x2d8)]([{'$match':{'status':_0x478e25(0x2d9),'name':'Return\x20Goods','warehouse_category':_0x478e25(0x277)}},{'$group':{'_id':_0x478e25(0x1ef),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x478e25(0x24c)](_0x478e25(0x1fa),_0x414bea);if(_0x4e00d2[0x0]['language']=='English\x20(US)'){var _0x2a43cd=users[_0x478e25(0x252)];console[_0x478e25(0x24c)](_0x2a43cd);}else{if(_0x4e00d2[0x0][_0x478e25(0x1fc)]==_0x478e25(0x24e))var _0x2a43cd=users[_0x478e25(0x24e)];else{if(_0x4e00d2[0x0][_0x478e25(0x1fc)]==_0x478e25(0x276))var _0x2a43cd=users[_0x478e25(0x276)];else{if(_0x4e00d2[0x0][_0x478e25(0x1fc)]==_0x478e25(0x294))var _0x2a43cd=users[_0x478e25(0x294)];else{if(_0x4e00d2[0x0][_0x478e25(0x1fc)]==_0x478e25(0x2cc))var _0x2a43cd=users['French'];else{if(_0x4e00d2[0x0]['language']==_0x478e25(0x280))var _0x2a43cd=users[_0x478e25(0x2a0)];else{if(_0x4e00d2[0x0][_0x478e25(0x1fc)]==_0x478e25(0x236))var _0x2a43cd=users['Chinese'];else{if(_0x4e00d2[0x0][_0x478e25(0x1fc)]=='Arabic\x20(ae)')var _0x2a43cd=users[_0x478e25(0x27f)];}}}}}}}_0x5ad177['render'](_0x478e25(0x1c5),{'success':_0x723b7e[_0x478e25(0x238)](_0x478e25(0x27b)),'errors':_0x723b7e[_0x478e25(0x238)](_0x478e25(0x2b4)),'role':_0x69bda0,'profile':_0x495c39,'user':_0x53897f,'stock':_0x414bea,'master_shop':_0x4e00d2,'product':_0x29bd9e,'language':_0x2a43cd,'warehouse':warehouse_data});}catch(_0x4d1677){console['log'](_0x4d1677);}}),router[a0_0x29f78d(0x231)]('/view/return_purchase/:id',auth,async(_0x1296bb,_0x253f3b)=>{var _0x18500d=a0_0x29f78d;try{const {invoice:_0xf3117a,date:_0x2b722a,warehouse_name:_0x5449c6,Room_name:_0x3bc8ad,product_name:_0x42e6ff,purchase_quantity:_0x5708a7,stocks:_0x14fe98,return_qty:_0x4cd2e4,note:_0x53dca3,level:_0x3da77b,isle:_0x3834b2,pallet:_0x172780,to_warehouse_name:_0xc49c02,to_Room_name:_0x450cb3}=_0x1296bb[_0x18500d(0x23d)],_0x39fc7e=await purchases[_0x18500d(0x232)]({'_id':_0x1296bb[_0x18500d(0x1c6)]['id']}),_0x248d70=await warehouse['findOne']({'name':_0x5449c6,'room':_0x3bc8ad});if(typeof _0x42e6ff==_0x18500d(0x2bb))var _0x2ca7da=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x21c)]],_0x4f2865=[_0x1296bb['body']['purchase_quantity']],_0x1d2449=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x25e)]],_0x550f18=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x275)]],_0x5ad845=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x26b)]],_0x49a04f=[_0x1296bb[_0x18500d(0x23d)]['isle']],_0x452600=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x2d6)]],_0x4da636=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x1f7)]],_0x1030e0=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x228)]],_0x4dfa59=[_0x1296bb[_0x18500d(0x23d)]['primary_code_hide']],_0x206ce7=[_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x1e5)]];else var _0x2ca7da=[..._0x1296bb['body'][_0x18500d(0x21c)]],_0x4f2865=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x22d)]],_0x1d2449=[..._0x1296bb['body'][_0x18500d(0x25e)]],_0x550f18=[..._0x1296bb['body'][_0x18500d(0x275)]],_0x5ad845=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x26b)]],_0x49a04f=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x1e0)]],_0x452600=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x2d6)]],_0x4da636=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x1f7)]],_0x1030e0=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x228)]],_0x4dfa59=[..._0x1296bb[_0x18500d(0x23d)][_0x18500d(0x2b1)]],_0x206ce7=[..._0x1296bb[_0x18500d(0x23d)]['secondary_code_hide']];const _0x222792=_0x2ca7da[_0x18500d(0x1de)](_0x45be6d=>{return _0x45be6d={'product_name':_0x45be6d};});_0x4f2865['forEach']((_0x4c18ff,_0x33f8b7)=>{_0x222792[_0x33f8b7]['purchase_quantity']=_0x4c18ff;}),_0x1d2449['forEach']((_0x2ba10b,_0x1f5e92)=>{var _0x18bf46=_0x18500d;_0x222792[_0x1f5e92][_0x18bf46(0x247)]=_0x2ba10b;}),_0x550f18['forEach']((_0x41262f,_0x54d05c)=>{var _0x1ff986=_0x18500d;_0x222792[_0x54d05c][_0x1ff986(0x275)]=_0x41262f;}),_0x5ad845[_0x18500d(0x267)]((_0x534efe,_0x5eeb0a)=>{var _0x327718=_0x18500d;_0x222792[_0x5eeb0a][_0x327718(0x2dd)]=_0x534efe;}),_0x49a04f['forEach']((_0x369991,_0x5bdc08)=>{var _0x51dbb4=_0x18500d;_0x222792[_0x5bdc08][_0x51dbb4(0x23c)]=_0x369991;}),_0x452600[_0x18500d(0x267)]((_0x372028,_0x1f5782)=>{var _0x56c0c3=_0x18500d;_0x222792[_0x1f5782][_0x56c0c3(0x2a5)]=_0x372028;}),_0x4da636[_0x18500d(0x267)]((_0x5c5d4a,_0x2529e0)=>{var _0x11ab98=_0x18500d;_0x222792[_0x2529e0][_0x11ab98(0x22f)]=_0x5c5d4a;}),_0x1030e0['forEach']((_0x3516e5,_0x4b38b4)=>{var _0x251abb=_0x18500d;_0x222792[_0x4b38b4][_0x251abb(0x24d)]=_0x3516e5;}),_0x4dfa59[_0x18500d(0x267)]((_0x5a05e5,_0x315c95)=>{var _0x5ebca0=_0x18500d;_0x222792[_0x315c95][_0x5ebca0(0x264)]=_0x5a05e5;}),_0x206ce7['forEach']((_0x421001,_0x3d43f6)=>{_0x222792[_0x3d43f6]['secondary_code']=_0x421001;}),_0x39fc7e['product'][_0x18500d(0x267)](_0x5d86ff=>{var _0x4c7ac4=_0x18500d;const _0x3b8418=_0x248d70['product_details'][_0x4c7ac4(0x1de)](_0x5e5892=>{var _0x2e474c=_0x4c7ac4;_0x5e5892[_0x2e474c(0x21c)]==_0x5d86ff[_0x2e474c(0x21c)]&&_0x5e5892[_0x2e474c(0x2a5)]==_0x5d86ff['floorlevel']&&_0x5e5892['type']==_0x5d86ff[_0x2e474c(0x22f)]&&_0x5e5892[_0x2e474c(0x23c)]==_0x5d86ff[_0x2e474c(0x23c)]&&_0x5e5892[_0x2e474c(0x2dd)]==_0x5d86ff[_0x2e474c(0x2dd)]&&_0x5e5892[_0x2e474c(0x249)]==_0x5d86ff[_0x2e474c(0x249)]&&_0x5e5892[_0x2e474c(0x212)]==_0x5d86ff[_0x2e474c(0x212)]&&(console[_0x2e474c(0x24c)](parseInt(_0x5e5892['product_stock'])+_0x2e474c(0x1e6)+parseInt(_0x5d86ff['quantity'])),_0x5e5892[_0x2e474c(0x218)]=parseInt(_0x5e5892['product_stock'])+parseInt(_0x5d86ff[_0x2e474c(0x1ed)]));});}),await _0x248d70[_0x18500d(0x2d1)]();const _0x31935c=_0x222792[_0x18500d(0x290)](_0x9b6915=>_0x9b6915[_0x18500d(0x275)]!=='0'&&_0x9b6915['return_qty']!=='');var _0x484e1d=0x0;_0x31935c[_0x18500d(0x267)](_0x340e1a=>{var _0x3ba98a=_0x18500d;console[_0x3ba98a(0x24c)](_0x3ba98a(0x2cd),_0x340e1a),(parseInt(_0x340e1a['purchase_quantity'])<parseInt(_0x340e1a[_0x3ba98a(0x275)])||parseInt(_0x340e1a[_0x3ba98a(0x247)])<parseInt(_0x340e1a[_0x3ba98a(0x275)]))&&_0x484e1d++;});if(_0x484e1d!=0x0)return _0x1296bb[_0x18500d(0x238)]('errors',_0x18500d(0x297)),_0x253f3b['redirect'](_0x18500d(0x263));const _0x1f224a=new purchases_return({'invoice':_0xf3117a,'suppliers':_0x1296bb['body'][_0x18500d(0x1fd)],'date':_0x2b722a,'warehouse_name':_0x5449c6,'return_product':_0x31935c,'note':_0x53dca3,'room':_0x3bc8ad,'to_warehouse_name':_0xc49c02,'to_room':_0x450cb3}),_0x442ec1=await _0x1f224a[_0x18500d(0x2d1)]();console[_0x18500d(0x24c)](_0x1f224a);const _0x74065e=await purchases_return[_0x18500d(0x232)]({'invoice':_0xf3117a}),_0x3b0cf8=await warehouse['findOne']({'name':_0xc49c02,'room':_0x450cb3});_0x74065e[_0x18500d(0x29d)][_0x18500d(0x267)](_0x35f694=>{var _0x559765=_0x18500d,_0x166ed0=0x0;const _0x304ba4=_0x3b0cf8['product_details']['map'](_0x47f89f=>{var _0x39e9fa=a0_0x4f86;_0x47f89f['product_name']==_0x35f694['product_name']&&_0x47f89f[_0x39e9fa(0x2a5)]==_0x35f694[_0x39e9fa(0x2a5)]&&_0x47f89f['type']==_0x35f694[_0x39e9fa(0x22f)]&&_0x47f89f[_0x39e9fa(0x23c)]==_0x35f694[_0x39e9fa(0x23c)]&&_0x47f89f[_0x39e9fa(0x2dd)]==_0x35f694[_0x39e9fa(0x2dd)]&&(_0x47f89f[_0x39e9fa(0x218)]=parseInt(_0x47f89f['product_stock'])-parseInt(_0x35f694[_0x39e9fa(0x275)]),_0x166ed0++);});_0x166ed0=='0'&&(_0x3b0cf8['product_details']=_0x3b0cf8[_0x559765(0x2c5)]['concat']({'product_name':_0x35f694[_0x559765(0x21c)],'product_stock':_0x35f694[_0x559765(0x275)],'primary_code':_0x35f694[_0x559765(0x264)],'secondary_code':_0x35f694[_0x559765(0x246)],'product_code':_0x35f694[_0x559765(0x24d)],'storage':_0x35f694[_0x559765(0x212)],'rack':_0x35f694[_0x559765(0x249)],'bay':_0x35f694['bay'],'bin':_0x35f694['bin'],'type':_0x35f694[_0x559765(0x22f)],'floorlevel':_0x35f694[_0x559765(0x2a5)],'maxProducts':_0x35f694[_0x559765(0x1df)],'unit':_0x35f694['standard_unit'],'secondary_unit':_0x35f694[_0x559765(0x209)],'expiry_date':_0x35f694[_0x559765(0x25f)]}));}),await _0x3b0cf8[_0x18500d(0x2d1)]();const _0x198276=await purchases['findOne']({'invoice':_0xf3117a});_0x198276['return_data']=_0x18500d(0x28b);const _0x391616=await _0x198276[_0x18500d(0x2d1)](),_0x204a1a=new s_payment_data({'invoice':_0xf3117a,'suppliers':_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x1fd)],'reason':_0x18500d(0x296)});await _0x204a1a[_0x18500d(0x2d1)]();const _0x1a887a=await master_shop['find']();console[_0x18500d(0x24c)](_0x18500d(0x22c),_0x1a887a[0x0][_0x18500d(0x1d2)]);const _0xa0f359=await email_settings[_0x18500d(0x232)](),_0x1ab307=await suppliers[_0x18500d(0x232)]({'name':_0x1296bb[_0x18500d(0x23d)][_0x18500d(0x1fd)]});console[_0x18500d(0x24c)](_0x18500d(0x281),_0x1ab307);_0x1a887a[0x0][_0x18500d(0x2d2)]==0x1?(right_currency=_0x1a887a[0x0][_0x18500d(0x24f)],left_currency=''):(right_currency='',left_currency=_0x1a887a[0x0][_0x18500d(0x24f)]);var _0x380455=_0x2ca7da,_0x6142a5=_0x550f18,_0x2c0dfe='',_0x50add5;for(_0x50add5 in _0x380455){_0x2c0dfe+=_0x18500d(0x1fe)+_0x18500d(0x1ea)+_0x380455[_0x50add5]+'</td>'+_0x18500d(0x1ea)+_0x6142a5[_0x50add5]+'</td>'+_0x18500d(0x2a8);}console[_0x18500d(0x24c)](_0x18500d(0x2d3),_0x2c0dfe);let _0x17a869=nodemailer['createTransport']({'service':_0x18500d(0x28c),'auth':{'user':_0xa0f359[_0x18500d(0x210)],'pass':_0xa0f359[_0x18500d(0x202)]}}),_0x45af41={'from':_0xa0f359['email'],'to':_0x1ab307['email'],'subject':_0x18500d(0x1da),'attachments':[{'filename':_0x18500d(0x2a1),'path':__dirname+_0x18500d(0x1d7)+_0x18500d(0x270)+_0x1a887a[0x0][_0x18500d(0x1d2)],'cid':'logo'}],'html':_0x18500d(0x1e3)+_0x18500d(0x2a7)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x18500d(0x25c)+_0x18500d(0x2b2)+_0x18500d(0x1e9)+'<div>'+_0x18500d(0x1d4)+_0x1a887a[0x0][_0x18500d(0x2c7)]+_0x18500d(0x1f3)+_0x18500d(0x1e9)+_0x18500d(0x1e9)+_0x18500d(0x261)+'<div>'+_0x18500d(0x1d5)+_0x18500d(0x1d6)+_0xf3117a+'\x20'+_0x18500d(0x2ae)+_0x18500d(0x1eb)+_0x2b722a+'\x20'+_0x18500d(0x201)+_0x18500d(0x26a)+'</div>'+_0x18500d(0x25d)+_0x18500d(0x23a)+_0x18500d(0x1fe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x18500d(0x2c6)+_0x18500d(0x1d0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x18500d(0x2a8)+'</thead>'+_0x18500d(0x2a6)+'\x20'+_0x2c0dfe+'\x20'+_0x18500d(0x1ee)+_0x18500d(0x266)+_0x18500d(0x25c)+'<strong>\x20Regards\x20</strong>'+_0x18500d(0x28d)+_0x1a887a[0x0]['site_title']+_0x18500d(0x26a)+_0x18500d(0x1e9)+_0x18500d(0x1e9)+_0x18500d(0x248)};_0x17a869[_0x18500d(0x29b)](_0x45af41,function(_0x4ad0e2,_0x5a632d){var _0x581bbb=_0x18500d;_0x4ad0e2?(console[_0x581bbb(0x24c)](_0x4ad0e2),console[_0x581bbb(0x24c)](_0x581bbb(0x235))):console[_0x581bbb(0x24c)](_0x581bbb(0x26f));}),_0x1296bb[_0x18500d(0x238)](_0x18500d(0x27b),_0x18500d(0x26c)),_0x253f3b['redirect'](_0x18500d(0x2d0));}catch(_0x531f68){console[_0x18500d(0x24c)](_0x531f68),_0x253f3b[_0x18500d(0x254)](0xc8)[_0x18500d(0x1f8)]({'message':_0x531f68[_0x18500d(0x27d)]});}}),router[a0_0x29f78d(0x2ac)](a0_0x29f78d(0x1e4),auth,async(_0xd1621c,_0x553d3b)=>{var _0x4dcd32=a0_0x29f78d;try{const {username:_0x56ace1,email:_0x5f04ad,role:_0x4611ab}=_0xd1621c['user'],_0x534441=_0xd1621c[_0x4dcd32(0x226)],_0xb536b4=await profile[_0x4dcd32(0x232)]({'email':_0x534441[_0x4dcd32(0x210)]}),_0x3b69dc=await master_shop['find'](),_0x4d6678=_0xd1621c[_0x4dcd32(0x1c6)]['id'],_0xe2a45b=await purchases[_0x4dcd32(0x20f)](_0x4d6678);if(_0x3b69dc[0x0]['language']==_0x4dcd32(0x1f5))var _0x4cef60=users[_0x4dcd32(0x252)];else{if(_0x3b69dc[0x0][_0x4dcd32(0x1fc)]==_0x4dcd32(0x24e))var _0x4cef60=users[_0x4dcd32(0x24e)];else{if(_0x3b69dc[0x0][_0x4dcd32(0x1fc)]=='German')var _0x4cef60=users[_0x4dcd32(0x276)];else{if(_0x3b69dc[0x0][_0x4dcd32(0x1fc)]==_0x4dcd32(0x294))var _0x4cef60=users[_0x4dcd32(0x294)];else{if(_0x3b69dc[0x0][_0x4dcd32(0x1fc)]==_0x4dcd32(0x2cc))var _0x4cef60=users[_0x4dcd32(0x2cc)];else{if(_0x3b69dc[0x0][_0x4dcd32(0x1fc)]==_0x4dcd32(0x280))var _0x4cef60=users[_0x4dcd32(0x2a0)];else{if(_0x3b69dc[0x0]['language']==_0x4dcd32(0x236))var _0x4cef60=users[_0x4dcd32(0x236)];else{if(_0x3b69dc[0x0][_0x4dcd32(0x1fc)]==_0x4dcd32(0x2c1))var _0x4cef60=users[_0x4dcd32(0x27f)];}}}}}}}_0x553d3b['render'](_0x4dcd32(0x233),{'success':_0xd1621c[_0x4dcd32(0x238)]('success'),'errors':_0xd1621c[_0x4dcd32(0x238)]('errors'),'role':_0x534441,'profile':_0xb536b4,'alldata':_0xe2a45b,'master_shop':_0x3b69dc,'language':_0x4cef60}),console['log'](alldata);}catch(_0x42c0c1){console[_0x4dcd32(0x24c)](_0x42c0c1);}}),router[a0_0x29f78d(0x231)]('/barcode_scanner',async(_0x24ff5e,_0x3bfb7e)=>{var _0x1a8bcd=a0_0x29f78d;const {product_code:_0x16545a}=_0x24ff5e[_0x1a8bcd(0x23d)];var _0x4afd04;const _0x2dc241=await product[_0x1a8bcd(0x2d8)]([{'$match':{'primary_code':_0x16545a,'product_category':_0x1a8bcd(0x277)}},{'$group':{'_id':_0x1a8bcd(0x1cf),'name':{'$first':_0x1a8bcd(0x1ef)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x1a8bcd(0x2ab)},'alertquantity':{'$first':_0x1a8bcd(0x1c4)},'product_code':{'$first':_0x1a8bcd(0x21e)},'primary_code':{'$first':_0x1a8bcd(0x244)},'secondary_code':{'$first':_0x1a8bcd(0x20d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1a8bcd(0x29c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1a8bcd(0x274)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x99e9ac=await product[_0x1a8bcd(0x2d8)]([{'$match':{'secondary_code':_0x16545a,'product_category':_0x1a8bcd(0x277)}},{'$group':{'_id':_0x1a8bcd(0x1cf),'name':{'$first':_0x1a8bcd(0x1ef)},'category':{'$first':'$category'},'brand':{'$first':_0x1a8bcd(0x28e)},'unit':{'$first':_0x1a8bcd(0x2ab)},'alertquantity':{'$first':_0x1a8bcd(0x1c4)},'product_code':{'$first':_0x1a8bcd(0x21e)},'primary_code':{'$first':_0x1a8bcd(0x244)},'secondary_code':{'$first':_0x1a8bcd(0x20d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1a8bcd(0x29c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1a8bcd(0x274)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2dc241['length']>0x0)_0x4afd04=_0x2dc241;else _0x99e9ac[_0x1a8bcd(0x219)]>0x0&&(_0x4afd04=_0x99e9ac);_0x3bfb7e[_0x1a8bcd(0x1f8)](_0x4afd04);}),router[a0_0x29f78d(0x231)](a0_0x29f78d(0x2bd),async(_0x415b33,_0x41afc4)=>{var _0x1ca8ec=a0_0x29f78d;const {primaryCode:_0x1a0cf6,secondaryCode:_0x154a26,productCode:_0x58c878,bay:_0x43aa41,bin:_0x59b443,types:_0x3c07ff,pallet:_0x2aaf8d,warehouses:_0x5cf9c2,room:_0x262c9f}=_0x415b33[_0x1ca8ec(0x23d)];console['log'](_0x415b33[_0x1ca8ec(0x23d)]);try{const _0x365261=await warehouse['aggregate']([{'$match':{'name':_0x5cf9c2,'room':_0x262c9f}},{'$unwind':_0x1ca8ec(0x265)},{'$match':{'product_details.bay':_0x43aa41,'product_details.bin':_0x59b443,'product_details.type':_0x3c07ff}},{'$group':{'_id':_0x1ca8ec(0x1c7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1ca8ec(0x287)},'level':{'$first':_0x1ca8ec(0x240)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x1ca8ec(0x27e)}}}]);_0x41afc4[_0x1ca8ec(0x254)](0xc8)[_0x1ca8ec(0x1f8)](_0x365261);}catch(_0x3d2587){_0x41afc4[_0x1ca8ec(0x254)](0x194)['json']({'message':_0x3d2587['message']});}}),module[a0_0x29f78d(0x1e2)]=router;