function a0_0x580a(_0x493b38,_0x282824){var _0x4b77d8=a0_0x4b77();return a0_0x580a=function(_0x580afd,_0x5ca295){_0x580afd=_0x580afd-0x192;var _0x244f8b=_0x4b77d8[_0x580afd];return _0x244f8b;},a0_0x580a(_0x493b38,_0x282824);}var a0_0x445a07=a0_0x580a;(function(_0xe0207d,_0x25e3fe){var _0x1e4f2d=a0_0x580a,_0x4f26a9=_0xe0207d();while(!![]){try{var _0x101517=parseInt(_0x1e4f2d(0x28d))/0x1*(-parseInt(_0x1e4f2d(0x226))/0x2)+-parseInt(_0x1e4f2d(0x29f))/0x3+-parseInt(_0x1e4f2d(0x2ab))/0x4*(-parseInt(_0x1e4f2d(0x224))/0x5)+-parseInt(_0x1e4f2d(0x1ef))/0x6+-parseInt(_0x1e4f2d(0x205))/0x7*(parseInt(_0x1e4f2d(0x28e))/0x8)+-parseInt(_0x1e4f2d(0x1ad))/0x9+parseInt(_0x1e4f2d(0x290))/0xa;if(_0x101517===_0x25e3fe)break;else _0x4f26a9['push'](_0x4f26a9['shift']());}catch(_0x35ace2){_0x4f26a9['push'](_0x4f26a9['shift']());}}}(a0_0x4b77,0xe0e07));const express=require(a0_0x445a07(0x27b)),app=express(),router=express[a0_0x445a07(0x23c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x445a07(0x1dd)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');function a0_0x4b77(){var _0x5acdf0=['POnumber','floorlevel','</h5>','secondary_code','type','createTransport','string','secondary_unit','2401640aQIEmm','port','delivery_code','<strong>\x20Regards\x20</strong>','$primary_code','stocks','<tbody\x20style=\x22text-align:\x20center;\x22>','note','$product_details.bin','Rack\x20D','$product.floorlevel','flash','ejs','suppliers_data','delivery_date','Arabic','body','$product.type','product_cat','product','/barcode_scanner','Portuguese','<!DOCTYPE\x20html>','Ambient','product_details','getDate','German','role','2742138WxNHLa','</tbody>','prod_level','date','master','prod_Qty','$product_details.maxProducts','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','paid_amount','$maxProdPerUnit','prod_cat','product_code','logo','<tr>','return_purchase','prod_invoice','aggregate','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.room_name','$product_details.product_code','$name','due_amount','warehouse','concat','prod_code','max_product_unit','expiry_date','site_title','length','pallet','Rack\x20B','primary_code','render','all_purchases_barcode','/all_purchases/view','product_stock','$product_details.bay','find','Email\x20sent\x20successfully','actual_qty','$due_amount','$product_details.level','$suppliers_docs','<div>','Arabic\x20(ae)','password','$product_details.rack','../models/all_models','$product_details.product_name','Error\x20Occurs','../public/language/languages.json','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','English','random','<h5>','suppliers_docs','Spanish','<span\x20style=\x22float:\x20right;\x22>','/barcode/:id','exports','json','prod_unit','types','$batch_code','/view/:id','990900lRwvEG','host','amount','staff','prod_isle','\x20<\x20wew\x20>\x20','product_list','</thead>','Rack\x20A','save','bay','get','foreach\x20newproduct','add\x20post','bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','email','\x20Order\x20Date\x20:\x20','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$invoice','<h5\x20style=\x22text-align:\x20left;\x22>','14uFuCiJ','path','<table\x20style=\x22width:\x20100%\x20!important;\x22>','invoice','user','\x20<>\x20','Shelves','Purchase\x20Return','/preview/:id','name','return_qty','post','Portuguese\x20(BR)','status','</span>','params','</head><body>','$expiry_date','filter','storage','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','warehouse_name','slice','alertQTY','$return_data','$product_details.pallet','image','DRY\x20STORAGE','$product_details._id','production_date','Enabled','5OVXSAi','Rack\x20C','327046Fnyudt','redirect','language','True','\x20Order\x20Number\x20:\x20','$product_code','English\x20(US)','room','toString','product_code_hide','COLD\x20STORAGE','$product.bin','$note','$warehouse_name','findById','French','Raw\x20Materials','all','$product.bay','</div>','Purchase\x20Return\x20Mail','room_name','Router','Receiving\x20Area','Paid\x20For\x20Purchase','</tr>','stock_data','catch','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','rack','/view','$product_details.storage','$product_details.expiry_date','Rack\x20E','padStart','sendMail','batch_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view/return_purchase/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$paid_amount','RMSEmail','edit_purchases_view','An\x20error\x20occurred\x20while\x20saving\x20data.','<h2>\x20','currency','findOne','Purchase\x20data\x20added\x20successfully','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','level','then','gmail','$suppliers','purchase\x20data\x20update\x20successfully','$product_details.product_stock','Chinese','rak','$_id','</table>','/CheckingWarehouse','Level','Enclosed','finalize','errors','purchases\x20item\x20return\x20successfull','$finalize','$unit','$room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','actual_uom','getMonth','$date','</body></html>','product_name','Purchase\x20Mail','success','$category','$product_details.secondary_code','MaxStocks_data','$product','Logo.png','$product_details.type','$product.quantity','express','/invoice/:id','Room_name','deliverycode','Return\x20Goods','purchase_quantity','/view/add_purchases/:id','Floor','forEach','standard_unit','RoomAssign','back','$product_details.floorlevel','/../public','\x20</h2>','suppliers','$secondary_unit','INC-','1ANFqzm','3102152ctgvNd','<hr\x20class=\x22my-3\x22>','19930550barTEM','$product_details.primary_code','log','prod_secondunit','error','floor','abs','Hindi','maxStocks','/view/add_purchases','<html><head><title></title>','quantity','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details','getFullYear','790431tCzIRh','/upload/','secondary_code_hide','maxperunit'];a0_0x4b77=function(){return _0x5acdf0;};return a0_0x4b77();}var ejs=require(a0_0x445a07(0x19d));const path=require(a0_0x445a07(0x206)),users=require(a0_0x445a07(0x1e0));router[a0_0x445a07(0x1fa)](a0_0x445a07(0x245),auth,async(_0x1bb5bb,_0x367eb7)=>{var _0x2c6681=a0_0x445a07;try{const {username:_0x178fc6,email:_0x79776a,role:_0xde3538}=_0x1bb5bb[_0x2c6681(0x209)],_0x453fd0=_0x1bb5bb[_0x2c6681(0x209)],_0x1cfe29=await profile[_0x2c6681(0x255)]({'email':_0x453fd0[_0x2c6681(0x1ff)]}),_0xe06e0c=await staff[_0x2c6681(0x255)]({'email':_0x453fd0[_0x2c6681(0x1ff)]});if(_0x453fd0[_0x2c6681(0x1ac)]=='staff'){const _0x68aff8=await staff['findOne']({'email':_0x453fd0[_0x2c6681(0x1ff)]});}const _0x24d3a5=await master_shop[_0x2c6681(0x1d3)]();let _0x198b1d;if(_0x453fd0[_0x2c6681(0x1ac)]==_0x2c6681(0x1f2)){const _0x19fa4b=await staff[_0x2c6681(0x255)]({'email':_0x453fd0[_0x2c6681(0x1ff)]});_0x198b1d=await purchases['aggregate']([{'$match':{'warehouse_name':_0x19fa4b[_0x2c6681(0x1c4)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x2c6681(0x20e),'as':_0x2c6681(0x1e5)}},{'$unwind':_0x2c6681(0x1d8)},{'$unwind':_0x2c6681(0x277)},{'$group':{'_id':_0x2c6681(0x261),'invoice':{'$first':_0x2c6681(0x203)},'suppliers':{'$first':_0x2c6681(0x25c)},'date':{'$first':_0x2c6681(0x26f)},'warehouse_name':{'$first':_0x2c6681(0x233)},'room':{'$first':_0x2c6681(0x26b)},'product':{'$push':'$product'},'note':{'$first':_0x2c6681(0x232)},'paid_amount':{'$first':_0x2c6681(0x24f)},'due_amount':{'$first':_0x2c6681(0x1d6)},'return_data':{'$first':_0x2c6681(0x21d)},'batch_code':{'$first':_0x2c6681(0x1ed)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2c6681(0x1d8)},'total_product_quantity':{'$sum':_0x2c6681(0x27a)},'level':{'$addToSet':_0x2c6681(0x238)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2c6681(0x1a2)},'floorlevel':{'$addToSet':_0x2c6681(0x19b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x198b1d=await purchases['aggregate']([{'$lookup':{'from':_0x2c6681(0x28a),'localField':'suppliers','foreignField':_0x2c6681(0x20e),'as':_0x2c6681(0x1e5)}},{'$unwind':_0x2c6681(0x1d8)},{'$unwind':'$product'},{'$group':{'_id':_0x2c6681(0x261),'invoice':{'$first':_0x2c6681(0x203)},'suppliers':{'$first':_0x2c6681(0x25c)},'date':{'$first':_0x2c6681(0x26f)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x2c6681(0x1c0)},'product':{'$push':_0x2c6681(0x277)},'note':{'$first':_0x2c6681(0x232)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2c6681(0x1d6)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x2c6681(0x1ed)},'expiry_date':{'$first':_0x2c6681(0x216)},'suppliers_docs':{'$first':_0x2c6681(0x1d8)},'total_product_quantity':{'$sum':_0x2c6681(0x27a)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2c6681(0x231)},'type':{'$addToSet':_0x2c6681(0x1a2)},'floorlevel':{'$addToSet':_0x2c6681(0x19b)},'finalize':{'$first':_0x2c6681(0x269)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x24d3a5[0x0][_0x2c6681(0x228)]==_0x2c6681(0x22c)){var _0x3f95dc=users[_0x2c6681(0x1e2)];console[_0x2c6681(0x292)](_0x3f95dc);}else{if(_0x24d3a5[0x0]['language']==_0x2c6681(0x297))var _0x3f95dc=users[_0x2c6681(0x297)];else{if(_0x24d3a5[0x0][_0x2c6681(0x228)]==_0x2c6681(0x1ab))var _0x3f95dc=users[_0x2c6681(0x1ab)];else{if(_0x24d3a5[0x0]['language']==_0x2c6681(0x1e6))var _0x3f95dc=users['Spanish'];else{if(_0x24d3a5[0x0][_0x2c6681(0x228)]==_0x2c6681(0x235))var _0x3f95dc=users[_0x2c6681(0x235)];else{if(_0x24d3a5[0x0][_0x2c6681(0x228)]=='Portuguese\x20(BR)')var _0x3f95dc=users['Portuguese'];else{if(_0x24d3a5[0x0][_0x2c6681(0x228)]==_0x2c6681(0x25f))var _0x3f95dc=users[_0x2c6681(0x25f)];else{if(_0x24d3a5[0x0]['language']==_0x2c6681(0x1da))var _0x3f95dc=users[_0x2c6681(0x1a0)];}}}}}}}_0x367eb7['render']('all_purchases',{'success':_0x1bb5bb[_0x2c6681(0x19c)](_0x2c6681(0x273)),'errors':_0x1bb5bb[_0x2c6681(0x19c)](_0x2c6681(0x267)),'purchases':_0x198b1d,'role':_0x453fd0,'profile':_0x1cfe29,'master_shop':_0x24d3a5,'language':_0x3f95dc});}catch(_0x10eeea){console[_0x2c6681(0x292)]('table\x20page',_0x10eeea),_0x367eb7[_0x2c6681(0x212)](0xc8)[_0x2c6681(0x1ea)]({'message':_0x10eeea[_0x2c6681(0x242)]});}});function BayBinSelected(_0x3b5b3a,_0x1d3b50){var _0x3bd969=a0_0x445a07,_0x458627=[],_0x2732c9=[],_0x2691b2=[],_0x1d42c3=[],_0x4c208b=[],_0x20018c=[];let _0x29fe3c=[];if(_0x3b5b3a==_0x3bd969(0x220))switch(_0x1d3b50){case _0x3bd969(0x1f7):_0x458627=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2732c9=[0x1,0x2],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=['Level',_0x3bd969(0x282)],_0x4c208b=['D'],_0x20018c=['A'];break;case _0x3bd969(0x1cc):_0x458627=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2732c9=[0x1,0x2],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=['Level',_0x3bd969(0x282)],_0x4c208b=['D'],_0x20018c=['B'];break;case _0x3bd969(0x20b):_0x458627=[0x0],_0x2732c9=[0x0],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=[_0x3bd969(0x282)],_0x4c208b=['D'],_0x20018c=['S'];break;case _0x3bd969(0x23d):_0x458627=[0x0],_0x2732c9=[0x0],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2691b2=[_0x3bd969(0x282)],_0x4c208b=['D'],_0x20018c=['R'];break;}else{if(_0x3b5b3a==_0x3bd969(0x230))switch(_0x1d3b50){case _0x3bd969(0x1f7):_0x458627=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2732c9=['B','F'],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=[_0x3bd969(0x264),'Floor'],_0x4c208b=['C'],_0x20018c=['A'];break;case _0x3bd969(0x1cc):_0x458627=[0x5,0x4,0x3,0x2,0x1],_0x2732c9=['F','B','S'],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=['Level',_0x3bd969(0x282)],_0x4c208b=['C'],_0x20018c=['B'];break;case _0x3bd969(0x225):_0x458627=[0x1,0x2,0x3,0x4,0x5],_0x2732c9=['B','F','S'],_0x1d42c3=[0x5,0x4,0x3,0x2,0x1],_0x2691b2=['Level',_0x3bd969(0x282)],_0x4c208b=['C'],_0x20018c=['C'];break;case _0x3bd969(0x19a):_0x458627=[0x5,0x4,0x3,0x2,0x1],_0x2732c9=['F','B','S'],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=[_0x3bd969(0x264),_0x3bd969(0x282)],_0x4c208b=['C'],_0x20018c=['D'];break;case _0x3bd969(0x248):_0x458627=[0x4,0x3,0x2,0x1],_0x2732c9=[0x1,0x2],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=[_0x3bd969(0x264),'Floor'],_0x4c208b=['C'],_0x20018c=['E'];break;case'Rack\x20F':_0x458627=[0x1,0x2,0x3],_0x2732c9=[0x1,0x2],_0x1d42c3=[0x1,0x2,0x3,0x4,0x5],_0x2691b2=['Level'],_0x4c208b=['C'],_0x20018c=['F'];break;}}return{'levels':_0x458627,'Isle':_0x2732c9,'rack':_0x1d42c3,'type':_0x2691b2,'storage':_0x4c208b,'rak':_0x20018c};}async function getRandom8DigitNumber(){var _0x4483b7=a0_0x445a07;const _0x3bcbd1=0x989680,_0x4d9085=0x5f5e0ff,_0x2bbad9=Math[_0x4483b7(0x295)](Math[_0x4483b7(0x1e3)]()*(_0x4d9085-_0x3bcbd1+0x1))+_0x3bcbd1;var _0x3bf174;const _0x11abe3=await purchases[_0x4483b7(0x255)]({'invoice':_0x4483b7(0x28c)+_0x2bbad9});return _0x11abe3&&_0x11abe3['length']>0x0?_0x3bf174=_0x4483b7(0x28c)+_0x2bbad9:_0x3bf174=_0x4483b7(0x28c)+_0x2bbad9,_0x3bf174;}router[a0_0x445a07(0x1fa)]('/view/add_purchases',auth,async(_0x5899f7,_0x126305)=>{var _0x57957c=a0_0x445a07;try{const {username:_0xb4672c,email:_0x29f846,role:_0x3818ee}=_0x5899f7['user'],_0x3d2999=_0x5899f7[_0x57957c(0x209)],_0x39c346=await profile[_0x57957c(0x255)]({'email':_0x3d2999['email']}),_0x1defee=await master_shop['find'](),_0x358f19=await staff['findOne']({'email':_0x3d2999[_0x57957c(0x1ff)]}),_0x540dfc=await suppliers[_0x57957c(0x1d3)]({});let _0x4e15a4;if(_0x3d2999[_0x57957c(0x1ac)]==_0x57957c(0x1f2)){const _0x59141d=await staff[_0x57957c(0x255)]({'email':_0x3d2999[_0x57957c(0x1ff)]});_0x4e15a4=await warehouse[_0x57957c(0x1bd)]([{'$match':{'status':_0x57957c(0x223),'name':_0x59141d[_0x57957c(0x1c4)],'warehouse_category':_0x57957c(0x236),'name':{'$ne':_0x57957c(0x27f)}}},{'$group':{'_id':_0x57957c(0x1c2),'name':{'$first':_0x57957c(0x1c2)}}}]);}else _0x4e15a4=await warehouse['aggregate']([{'$match':{'status':_0x57957c(0x223),'warehouse_category':_0x57957c(0x236),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x57957c(0x1c2),'name':{'$first':'$name'}}}]);const _0x27e7d1=await product[_0x57957c(0x1d3)]({}),_0x1a02bb=await warehouse[_0x57957c(0x1d3)]({'status':_0x57957c(0x223)}),_0x3a6b53=await purchases[_0x57957c(0x1d3)]({}),_0x43601c=_0x3a6b53['length']+0x1,_0x3a38af=_0x57957c(0x28c)+_0x43601c[_0x57957c(0x22e)]()[_0x57957c(0x249)](0x5,'0');var _0x25268e=[_0x57957c(0x1a8),_0x57957c(0x265)];if(_0x1defee[0x0]['language']==_0x57957c(0x22c))var _0x35c443=users[_0x57957c(0x1e2)];else{if(_0x1defee[0x0][_0x57957c(0x228)]==_0x57957c(0x297))var _0x35c443=users[_0x57957c(0x297)];else{if(_0x1defee[0x0]['language']=='German')var _0x35c443=users[_0x57957c(0x1ab)];else{if(_0x1defee[0x0][_0x57957c(0x228)]==_0x57957c(0x1e6))var _0x35c443=users[_0x57957c(0x1e6)];else{if(_0x1defee[0x0][_0x57957c(0x228)]==_0x57957c(0x235))var _0x35c443=users[_0x57957c(0x235)];else{if(_0x1defee[0x0][_0x57957c(0x228)]==_0x57957c(0x211))var _0x35c443=users[_0x57957c(0x1a6)];else{if(_0x1defee[0x0][_0x57957c(0x228)]=='Chinese')var _0x35c443=users['Chinese'];else{if(_0x1defee[0x0][_0x57957c(0x228)]==_0x57957c(0x1da))var _0x35c443=users[_0x57957c(0x1a0)];}}}}}}}const _0x5de02=getRandom8DigitNumber();_0x5de02['then'](_0x6cf245=>{var _0x371acb=_0x57957c;_0x126305[_0x371acb(0x1ce)]('add_purchases',{'success':_0x5899f7['flash'](_0x371acb(0x273)),'errors':_0x5899f7[_0x371acb(0x19c)](_0x371acb(0x267)),'role':_0x3d2999,'profile':_0x39c346,'suppliers':_0x540dfc,'warehouse':_0x4e15a4,'product':_0x27e7d1,'invoice':_0x6cf245,'master_shop':_0x1defee,'language':_0x35c443,'find_data':_0x1a02bb,'rooms_data':_0x25268e});})[_0x57957c(0x241)](_0x371715=>{var _0x43908d=_0x57957c;_0x5899f7[_0x43908d(0x19c)](_0x43908d(0x267),_0x43908d(0x24c)),_0x126305[_0x43908d(0x227)](_0x43908d(0x1d0));});}catch(_0x35f23b){console['log'](_0x35f23b);}}),router[a0_0x445a07(0x1fa)](a0_0x445a07(0x281),auth,async(_0x479ed7,_0x1f7c5f)=>{var _0x416f74=a0_0x445a07;try{const _0x786fba=_0x479ed7[_0x416f74(0x214)]['id'];console['log'](_0x786fba);const _0x10dbea=await master_shop[_0x416f74(0x1d3)]();console[_0x416f74(0x292)](_0x416f74(0x1b1),_0x10dbea);const _0x5d5570=await product['findOne']({'name':_0x786fba});console[_0x416f74(0x292)]('product',_0x5d5570),_0x1f7c5f['status'](0xc8)['json']({'product_data':_0x5d5570,'master':_0x10dbea});}catch(_0x4847a2){console[_0x416f74(0x292)]('add_purchases\x20error',_0x4847a2);}}),router[a0_0x445a07(0x210)](a0_0x445a07(0x299),auth,async(_0x22e006,_0x3d1abc)=>{var _0x25b1d7=a0_0x445a07;try{const {invoice:_0x2958cf,date:_0x30ed58,warehouse_name:_0x307863,prod_name:_0x18868c,prod_code:_0x4cb73f,prod_qty:_0x2b0098,prod_unit:_0x3f30e1,prod_secondunit:_0x344f1b,prod_level:_0x294cf1,prod_isle:_0x43d81b,prod_pallet:_0x40854e,note:_0x7e2129,expiry_date:_0x42c278,batch_code:_0x2c9df5,payable:_0xb33385,due_amount:_0x409839,Room_name:_0x1f025c,primary_code:_0x1336c9,secondary_code:_0x1872bc,MaxStocks_data:_0x233e31,PO_number:_0x2321dc,SCRN:_0xc56fa8,JO_number:_0x2add94}=_0x22e006[_0x25b1d7(0x1a1)];if(typeof _0x18868c=='string')var _0x2ebd40=[_0x22e006['body'][_0x25b1d7(0x1be)]],_0x166326=[_0x22e006['body']['prod_code']],_0x3da78c=[_0x22e006['body'][_0x25b1d7(0x1b2)]],_0x3a6a6a=[_0x22e006[_0x25b1d7(0x1a1)]['prod_primunit']],_0x2f957a=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x293)]],_0xadf515=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1af)]],_0x4d0888=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1cd)]],_0x2f8c9c=[_0x22e006[_0x25b1d7(0x1a1)]['secondary_code']],_0x11414a=[_0x22e006[_0x25b1d7(0x1a1)]['MaxStocks_data']],_0x45dcee=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x24b)]],_0x2ba725=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1c8)]],_0x1bc9cf=[_0x22e006['body'][_0x25b1d7(0x1c7)]],_0x6d843a=[_0x22e006[_0x25b1d7(0x1a1)]['alertQTY']],_0x57ed81=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x222)]],_0x1d7c08=[_0x22e006['body'][_0x25b1d7(0x1b7)]],_0x3591af=[_0x22e006[_0x25b1d7(0x1a1)]['RoomAssign']],_0x3356cb=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x27e)]],_0x523c37=[_0x22e006['body'][_0x25b1d7(0x1bc)]],_0x160fac=[_0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1d5)]],_0x287f04=[_0x22e006['body'][_0x25b1d7(0x26d)]];else var _0x2ebd40=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1be)]],_0x166326=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1c6)]],_0x3da78c=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1b2)]],_0x3a6a6a=[..._0x22e006['body']['prod_primunit']],_0x2f957a=[..._0x22e006[_0x25b1d7(0x1a1)]['prod_secondunit']],_0xadf515=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1af)]],_0x4d0888=[..._0x22e006[_0x25b1d7(0x1a1)]['primary_code']],_0x2f8c9c=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x2a6)]],_0x11414a=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x276)]],_0x45dcee=[..._0x22e006['body'][_0x25b1d7(0x24b)]],_0x2ba725=[..._0x22e006['body'][_0x25b1d7(0x1c8)]],_0x1bc9cf=[..._0x22e006['body'][_0x25b1d7(0x1c7)]],_0x6d843a=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x21c)]],_0x57ed81=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x222)]],_0x1d7c08=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1b7)]],_0x3591af=[..._0x22e006['body'][_0x25b1d7(0x285)]],_0x3356cb=[..._0x22e006['body'][_0x25b1d7(0x27e)]],_0x523c37=[..._0x22e006['body'][_0x25b1d7(0x1bc)]],_0x160fac=[..._0x22e006[_0x25b1d7(0x1a1)][_0x25b1d7(0x1d5)]],_0x287f04=[..._0x22e006['body'][_0x25b1d7(0x26d)]];const _0x4a83e0=_0x2ebd40['map'](_0x3d6610=>{return _0x3d6610={'product_name':_0x3d6610};});_0x160fac[_0x25b1d7(0x283)]((_0x596f0f,_0x356e13)=>{var _0x429bc9=_0x25b1d7;_0x4a83e0[_0x356e13]['actual_qty']=Math[_0x429bc9(0x296)](_0x596f0f);}),_0x287f04['forEach']((_0x2d2b96,_0x1f8b7a)=>{var _0x1ddff9=_0x25b1d7;_0x4a83e0[_0x1f8b7a][_0x1ddff9(0x26d)]=_0x2d2b96;}),_0x166326[_0x25b1d7(0x283)]((_0x4eff6e,_0x1b9c8c)=>{var _0x26cbcc=_0x25b1d7;_0x4a83e0[_0x1b9c8c][_0x26cbcc(0x1b8)]=_0x4eff6e;}),_0x3da78c[_0x25b1d7(0x283)]((_0x1cf40e,_0x5c7ccc)=>{var _0x1b85f8=_0x25b1d7;_0x4a83e0[_0x5c7ccc][_0x1b85f8(0x29b)]=Math['abs'](_0x1cf40e);}),_0x3a6a6a[_0x25b1d7(0x283)]((_0x3abe54,_0x16fbc7)=>{var _0x5cbece=_0x25b1d7;_0x4a83e0[_0x16fbc7][_0x5cbece(0x284)]=_0x3abe54;}),_0x2f957a[_0x25b1d7(0x283)]((_0x3296a3,_0x370738)=>{var _0x6ac291=_0x25b1d7;_0x4a83e0[_0x370738][_0x6ac291(0x2aa)]=_0x3296a3;}),_0xadf515[_0x25b1d7(0x283)]((_0x36e73d,_0x541a22)=>{var _0x5c98bc=_0x25b1d7;_0x3591af[_0x5c98bc(0x283)]((_0x40d3f5,_0x332bb1)=>{var _0x5d7b94=_0x5c98bc;if(_0x40d3f5=='Receiving\x20Area'&&_0x541a22==_0x332bb1){console[_0x5d7b94(0x292)](_0x40d3f5+_0x5d7b94(0x1f4)+_0x541a22+_0x5d7b94(0x20a)+_0x332bb1+_0x5d7b94(0x20a)+_0x36e73d);var _0xa58e31=_0x36e73d[_0x5d7b94(0x21b)](0x3);_0x4a83e0[_0x541a22][_0x5d7b94(0x218)]=_0x36e73d[0x0],_0x4a83e0[_0x541a22]['rack']=_0x36e73d[0x1],_0x4a83e0[_0x541a22]['bay']=0x0,_0x4a83e0[_0x541a22][_0x5d7b94(0x1fd)]=0x0,_0x4a83e0[_0x541a22][_0x5d7b94(0x2a7)]=_0x5d7b94(0x282),_0x4a83e0[_0x541a22][_0x5d7b94(0x2a4)]=_0xa58e31;}else{if(_0x40d3f5=='Shelves'&&_0x541a22==_0x332bb1){var _0xa58e31=_0x36e73d[_0x5d7b94(0x21b)](0x3);_0x4a83e0[_0x541a22][_0x5d7b94(0x218)]=_0x36e73d[0x0],_0x4a83e0[_0x541a22][_0x5d7b94(0x244)]=_0x36e73d[0x1],_0x4a83e0[_0x541a22]['bay']=0x0,_0x4a83e0[_0x541a22][_0x5d7b94(0x1fd)]=0x0,_0x4a83e0[_0x541a22]['type']=_0x5d7b94(0x282),_0x4a83e0[_0x541a22]['floorlevel']=_0x36e73d[0x5];}else{if(_0x541a22==_0x332bb1){if(_0x36e73d[0x0]=='A'&&_0x36e73d[0x1]=='L'&&_0x36e73d[0x2]=='L')console[_0x5d7b94(0x292)](_0x40d3f5+_0x5d7b94(0x20a)+_0x541a22+_0x5d7b94(0x20a)+_0x332bb1+'\x20<>\x20'+_0x36e73d+'here'),_0x4a83e0[_0x541a22]['storage']=_0x36e73d[0x0],_0x4a83e0[_0x541a22]['rack']=_0x36e73d[0x1],_0x4a83e0[_0x541a22]['bay']=0x0,_0x4a83e0[_0x541a22][_0x5d7b94(0x1fd)]=0x0,_0x4a83e0[_0x541a22][_0x5d7b94(0x2a7)]=_0x5d7b94(0x282),_0x4a83e0[_0x541a22][_0x5d7b94(0x2a4)]=_0x36e73d[0x3];else{var _0x40419d;if(_0x36e73d[0x4]=='L')_0x40419d='Level';else _0x36e73d[0x4]=='F'&&(_0x40419d='Floor');_0x4a83e0[_0x541a22]['storage']=_0x36e73d[0x0],_0x4a83e0[_0x541a22][_0x5d7b94(0x244)]=_0x36e73d[0x1],_0x4a83e0[_0x541a22][_0x5d7b94(0x1f9)]=_0x36e73d[0x2],_0x4a83e0[_0x541a22][_0x5d7b94(0x1fd)]=_0x36e73d[0x3],_0x4a83e0[_0x541a22]['type']=_0x40419d,_0x4a83e0[_0x541a22]['floorlevel']=_0x36e73d[0x5];}}}}});}),_0x4d0888['forEach']((_0xcad743,_0x509520)=>{var _0x31040c=_0x25b1d7;_0x4a83e0[_0x509520][_0x31040c(0x1cd)]=_0xcad743;}),_0x2f8c9c['forEach']((_0x2280f8,_0x514704)=>{_0x4a83e0[_0x514704]['secondary_code']=_0x2280f8;}),_0x11414a[_0x25b1d7(0x283)]((_0x336b96,_0x572738)=>{_0x4a83e0[_0x572738]['maxStocks']=_0x336b96;}),_0x45dcee[_0x25b1d7(0x283)]((_0xed06c1,_0x3c84e0)=>{var _0x5207b2=_0x25b1d7;_0x4a83e0[_0x3c84e0][_0x5207b2(0x24b)]=_0xed06c1;}),_0x2ba725['forEach']((_0x55d15f,_0x387a9d)=>{var _0x35fe21=_0x25b1d7;_0x4a83e0[_0x387a9d][_0x35fe21(0x1c8)]=_0x55d15f;}),_0x1bc9cf[_0x25b1d7(0x283)]((_0x30d262,_0x3463e5)=>{var _0x3babec=_0x25b1d7;_0x4a83e0[_0x3463e5][_0x3babec(0x2a2)]=_0x30d262;}),_0x6d843a[_0x25b1d7(0x283)]((_0x1df940,_0x396152)=>{_0x4a83e0[_0x396152]['alertQTY']=_0x1df940;}),_0x57ed81[_0x25b1d7(0x283)]((_0x2daf7b,_0x11d331)=>{var _0x5ca443=_0x25b1d7;_0x4a83e0[_0x11d331][_0x5ca443(0x222)]=_0x2daf7b;}),_0x1d7c08[_0x25b1d7(0x283)]((_0x591849,_0x3fc3b8)=>{var _0x28c1ea=_0x25b1d7;_0x4a83e0[_0x3fc3b8][_0x28c1ea(0x1a3)]=_0x591849;}),_0x3591af[_0x25b1d7(0x283)]((_0x2b28c3,_0x375490)=>{var _0x477a73=_0x25b1d7;_0x4a83e0[_0x375490][_0x477a73(0x23b)]=_0x2b28c3;}),_0x3356cb['forEach']((_0xcf024d,_0x5c3470)=>{var _0x4821d1=_0x25b1d7;_0x4a83e0[_0x5c3470][_0x4821d1(0x193)]=_0xcf024d;}),_0x523c37[_0x25b1d7(0x283)]((_0x333ab8,_0x1c3c13)=>{var _0x42e569=_0x25b1d7;_0x4a83e0[_0x1c3c13][_0x42e569(0x208)]=_0x333ab8;});const _0x36acb8=_0x3591af['map'](_0x33cf18=>{return _0x33cf18={'room_name':_0x33cf18};}),_0x1ccfa9=_0x4a83e0['filter'](_0x4f5893=>_0x4f5893['quantity']!=='0'&&_0x4f5893[_0x25b1d7(0x29b)]!==''),_0xaa0784=new purchases({'invoice':_0x2958cf,'suppliers':_0x22e006['body'][_0x25b1d7(0x28a)],'date':_0x30ed58,'warehouse_name':_0x307863,'product':_0x1ccfa9,'note':_0x7e2129,'due_amount':_0x409839,'POnumber':_0x2321dc,'SCRN':_0xc56fa8,'JO_number':_0x2add94,'roomList':_0x36acb8}),_0x5c2b52=await _0xaa0784['save'](),_0x4c209c=await purchases[_0x25b1d7(0x255)]({'invoice':_0x2958cf}),_0x22e394=_0x4c209c['product'][_0x25b1d7(0x201)](async _0x21d870=>{var _0x344ba9=_0x25b1d7,_0x14f7df=await warehouse[_0x344ba9(0x255)]({'name':_0x307863,'room':_0x21d870[_0x344ba9(0x23b)]}),_0x542c63=0x0;return _0x14f7df[_0x344ba9(0x1a9)][_0x344ba9(0x283)](_0x3fb8b5=>{var _0x460072=_0x344ba9;_0x3fb8b5[_0x460072(0x271)]==_0x21d870[_0x460072(0x271)]&&_0x3fb8b5[_0x460072(0x2a4)]==_0x21d870[_0x460072(0x2a4)]&&_0x3fb8b5[_0x460072(0x2a7)]==_0x21d870[_0x460072(0x2a7)]&&_0x3fb8b5[_0x460072(0x1fd)]==_0x21d870[_0x460072(0x1fd)]&&_0x3fb8b5[_0x460072(0x1f9)]==_0x21d870[_0x460072(0x1f9)]&&_0x3fb8b5[_0x460072(0x244)]==_0x21d870[_0x460072(0x244)]&&_0x3fb8b5[_0x460072(0x218)]==_0x21d870['storage']&&_0x3fb8b5[_0x460072(0x1c8)]==_0x21d870['expiry_date']&&_0x3fb8b5[_0x460072(0x24b)]==_0x21d870[_0x460072(0x24b)]&&_0x3fb8b5[_0x460072(0x222)]==_0x21d870[_0x460072(0x222)]&&_0x3fb8b5[_0x460072(0x208)]==_0x4c209c[_0x460072(0x208)]&&(_0x3fb8b5[_0x460072(0x1d1)]+=Math[_0x460072(0x296)](_0x21d870[_0x460072(0x29b)]),_0x542c63++);}),_0x542c63===0x0&&_0x14f7df[_0x344ba9(0x1a9)]['push']({'product_name':_0x21d870['product_name'],'product_stock':Math['abs'](_0x21d870[_0x344ba9(0x29b)]),'primary_code':_0x21d870[_0x344ba9(0x1cd)],'secondary_code':_0x21d870['secondary_code'],'product_code':_0x21d870[_0x344ba9(0x1b8)],'storage':_0x21d870[_0x344ba9(0x218)],'rack':_0x21d870[_0x344ba9(0x244)],'bay':_0x21d870[_0x344ba9(0x1f9)],'bin':_0x21d870[_0x344ba9(0x1fd)],'type':_0x21d870[_0x344ba9(0x2a7)],'floorlevel':_0x21d870[_0x344ba9(0x2a4)],'maxProducts':_0x21d870[_0x344ba9(0x298)],'unit':_0x21d870[_0x344ba9(0x284)],'secondary_unit':_0x21d870[_0x344ba9(0x2aa)],'expiry_date':_0x21d870[_0x344ba9(0x1c8)],'maxPerUnit':_0x21d870['maxperunit'],'batch_code':_0x21d870[_0x344ba9(0x24b)],'alertQTY':_0x21d870['alertQTY'],'production_date':_0x21d870[_0x344ba9(0x222)],'product_cat':_0x21d870[_0x344ba9(0x1a3)],'invoice':_0x21d870[_0x344ba9(0x208)],'actual_qty':Math[_0x344ba9(0x296)](_0x21d870[_0x344ba9(0x1d5)]),'actual_uom':_0x21d870[_0x344ba9(0x26d)]}),_0x14f7df;});Promise[_0x25b1d7(0x237)](_0x22e394)[_0x25b1d7(0x25a)](async _0x547ec6=>{var _0xa49440=_0x25b1d7;try{for(const _0x37e41d of _0x547ec6){await _0x37e41d[_0xa49440(0x1f8)]();}const _0x22962e=await master_shop['find'](),_0x48e9a0=await email_settings[_0xa49440(0x255)](),_0x22c70c=await supervisor_settings[_0xa49440(0x1d3)]();var _0x56045e=_0x4c209c[_0xa49440(0x1a4)],_0x676c29='',_0x458b20;for(_0x458b20 in _0x56045e){_0x676c29+=_0xa49440(0x1ba)+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x271)]+_0xa49440(0x257)+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x1b8)]+_0xa49440(0x257)+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x29b)]+'</td>'+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x284)]+'</td>'+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x2aa)]+_0xa49440(0x257)+_0xa49440(0x29c)+_0x4c209c[_0xa49440(0x21a)]+_0xa49440(0x257)+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x23b)]+_0xa49440(0x257)+_0xa49440(0x29c)+_0x56045e[_0x458b20][_0xa49440(0x218)]+_0x56045e[_0x458b20][_0xa49440(0x244)]+_0x56045e[_0x458b20][_0xa49440(0x1f9)]+_0x56045e[_0x458b20][_0xa49440(0x1fd)]+_0x56045e[_0x458b20][_0xa49440(0x2a7)][0x0]+_0x56045e[_0x458b20][_0xa49440(0x2a4)]+'</td>',_0xa49440(0x23f);}let _0x13e904=nodemailer[_0xa49440(0x2a8)]({'host':_0x48e9a0[_0xa49440(0x1f0)],'port':Number(_0x48e9a0[_0xa49440(0x192)]),'secure':![],'auth':{'user':_0x48e9a0[_0xa49440(0x1ff)],'pass':_0x48e9a0['password']}}),_0x390a03={'from':_0x48e9a0[_0xa49440(0x1ff)],'to':_0x22c70c[0x0][_0xa49440(0x250)],'subject':_0xa49440(0x272),'attachments':[{'filename':_0xa49440(0x278),'path':__dirname+_0xa49440(0x288)+'/upload/'+_0x22962e[0x0][_0xa49440(0x21f)],'cid':_0xa49440(0x1b9)}],'html':_0xa49440(0x1a7)+_0xa49440(0x29a)+'</head><body>'+_0xa49440(0x1d9)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xa49440(0x1d9)+_0xa49440(0x1e1)+_0xa49440(0x239)+_0xa49440(0x1d9)+_0xa49440(0x253)+_0x22962e[0x0][_0xa49440(0x1c9)]+_0xa49440(0x289)+_0xa49440(0x239)+_0xa49440(0x239)+_0xa49440(0x28f)+'<div>'+_0xa49440(0x204)+_0xa49440(0x22a)+_0x4c209c[_0xa49440(0x208)]+'\x20'+_0xa49440(0x1e7)+_0xa49440(0x200)+_0x4c209c[_0xa49440(0x1b0)]+'\x20'+_0xa49440(0x213)+_0xa49440(0x2a5)+'</div>'+_0xa49440(0x207)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xa49440(0x1ba)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0xa49440(0x202)+_0xa49440(0x258)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0xa49440(0x1fe)+_0xa49440(0x243)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0xa49440(0x1f6)+_0xa49440(0x197)+'\x20'+_0x676c29+'\x20'+'</tbody>'+_0xa49440(0x262)+'<div>'+_0xa49440(0x194)+_0xa49440(0x1e4)+_0x22962e[0x0][_0xa49440(0x1c9)]+_0xa49440(0x2a5)+'</div>'+_0xa49440(0x239)+_0xa49440(0x270)};_0x13e904[_0xa49440(0x24a)](_0x390a03,function(_0x571fa3,_0x195338){var _0x48ac4d=_0xa49440;_0x571fa3?(console['log'](_0x571fa3),console[_0x48ac4d(0x292)]('Error\x20Occurs')):console[_0x48ac4d(0x292)](_0x48ac4d(0x1d4));}),_0x22e006['flash']('success',_0xa49440(0x256)),_0x3d1abc[_0xa49440(0x227)]('/all_purchases/view/');}catch(_0x3a40c1){console[_0xa49440(0x294)](_0x3a40c1),_0x3d1abc[_0xa49440(0x212)](0x1f4)['json']({'error':_0xa49440(0x252)});}})['catch'](_0x492ce6=>{var _0x33f56e=_0x25b1d7;console[_0x33f56e(0x294)](_0x492ce6),_0x3d1abc['status'](0x1f4)[_0x33f56e(0x1ea)]({'error':'An\x20error\x20occurred.'});});}catch(_0x56e907){console[_0x25b1d7(0x292)](_0x56e907);}}),router['get'](a0_0x445a07(0x20d),auth,async(_0x9ff596,_0x563a89)=>{var _0x42222f=a0_0x445a07;try{const {username:_0x572e7c,email:_0x3af515,role:_0x26ce63}=_0x9ff596[_0x42222f(0x209)],_0xc96f41=_0x9ff596[_0x42222f(0x209)],_0x33e48e=await profile[_0x42222f(0x255)]({'email':_0xc96f41['email']}),_0x2359f9=await master_shop[_0x42222f(0x1d3)](),_0x3c5fa9=_0x9ff596['params']['id'],_0x38e404=await purchases[_0x42222f(0x234)](_0x3c5fa9),_0x42095b=await warehouse[_0x42222f(0x1bd)]([{'$match':{'name':_0x38e404[_0x42222f(0x21a)],'room':_0x38e404[_0x42222f(0x22d)]}},{'$unwind':_0x42222f(0x29d)},{'$group':{'_id':_0x42222f(0x221),'name':{'$first':_0x42222f(0x1de)},'product_stock':{'$first':_0x42222f(0x25e)},'bay':{'$first':_0x42222f(0x1d2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x42222f(0x287)},'primary_code':{'$first':_0x42222f(0x291)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x42222f(0x1c1)},'storage':{'$first':_0x42222f(0x246)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x42222f(0x247)}}}]),_0x14fa6a=await customer[_0x42222f(0x1d3)]({});let _0x278779;if(_0xc96f41[_0x42222f(0x1ac)]==_0x42222f(0x1f2)){const _0x10dfd1=await staff[_0x42222f(0x255)]({'email':_0xc96f41[_0x42222f(0x1ff)]});_0x278779=await warehouse[_0x42222f(0x1bd)]([{'$match':{'status':'Enabled','name':_0x10dfd1[_0x42222f(0x1c4)]}},{'$group':{'_id':_0x42222f(0x1c2),'name':{'$first':_0x42222f(0x1c2)}}}]);}else _0x278779=await warehouse['aggregate']([{'$match':{'status':_0x42222f(0x223)}},{'$group':{'_id':'$name','name':{'$first':_0x42222f(0x1c2)}}}]);const _0x59b6da=await product['find']({}),_0x29d640=await suppliers[_0x42222f(0x1d3)]({}),_0x79f734=BayBinSelected(_0x38e404[_0x42222f(0x21a)],_0x38e404[_0x42222f(0x22d)]);if(_0x2359f9[0x0][_0x42222f(0x228)]==_0x42222f(0x22c)){var _0x10ce86=users['English'];console['log'](_0x10ce86);}else{if(_0x2359f9[0x0][_0x42222f(0x228)]==_0x42222f(0x297))var _0x10ce86=users[_0x42222f(0x297)];else{if(_0x2359f9[0x0]['language']==_0x42222f(0x1ab))var _0x10ce86=users[_0x42222f(0x1ab)];else{if(_0x2359f9[0x0]['language']=='Spanish')var _0x10ce86=users[_0x42222f(0x1e6)];else{if(_0x2359f9[0x0][_0x42222f(0x228)]=='French')var _0x10ce86=users[_0x42222f(0x235)];else{if(_0x2359f9[0x0]['language']==_0x42222f(0x211))var _0x10ce86=users['Portuguese'];else{if(_0x2359f9[0x0][_0x42222f(0x228)]=='Chinese')var _0x10ce86=users[_0x42222f(0x25f)];else{if(_0x2359f9[0x0][_0x42222f(0x228)]==_0x42222f(0x1da))var _0x10ce86=users[_0x42222f(0x1a0)];}}}}}}}_0x563a89[_0x42222f(0x1ce)](_0x42222f(0x251),{'success':_0x9ff596[_0x42222f(0x19c)](_0x42222f(0x273)),'errors':_0x9ff596[_0x42222f(0x19c)](_0x42222f(0x267)),'role':_0xc96f41,'profile':_0x33e48e,'customer':_0x14fa6a,'warehouse':_0x278779,'product':_0x42095b,'user':_0x38e404,'master_shop':_0x2359f9,'unit':_0x59b6da,'language':_0x10ce86,'suppliers':_0x29d640,'dataSelected':_0x79f734});}catch(_0x59a5ba){console[_0x42222f(0x292)](_0x59a5ba);}}),router[a0_0x445a07(0x210)](a0_0x445a07(0x20d),auth,async(_0x16eee9,_0x185dc8)=>{var _0x4842f9=a0_0x445a07;try{const _0x5afac0=_0x16eee9[_0x4842f9(0x214)]['id'],{invoice:_0x41f599,warehouse_name:_0x5afe58,Room_name:_0x13aa53}=_0x16eee9[_0x4842f9(0x1a1)],_0x4f2c6b=await warehouse[_0x4842f9(0x255)]({'name':_0x5afe58,'room':_0x13aa53}),_0x33083e=await purchases[_0x4842f9(0x255)]({'invoice':_0x41f599});_0x33083e[_0x4842f9(0x1a4)]['forEach'](_0x4fd6f6=>{var _0x75686c=_0x4842f9,_0xde00b8=0x0;const _0x1c9179=_0x4f2c6b['product_details']['map'](_0x31bbda=>{var _0x134955=a0_0x580a;_0x31bbda[_0x134955(0x271)]==_0x4fd6f6['product_name']&&_0x31bbda[_0x134955(0x2a4)]==_0x4fd6f6['floorlevel']&&_0x31bbda[_0x134955(0x2a7)]==_0x4fd6f6['type']&&_0x31bbda[_0x134955(0x1fd)]==_0x4fd6f6[_0x134955(0x1fd)]&&_0x31bbda[_0x134955(0x1f9)]==_0x4fd6f6[_0x134955(0x1f9)]&&_0x31bbda[_0x134955(0x244)]==_0x4fd6f6[_0x134955(0x244)]&&_0x31bbda[_0x134955(0x218)]==_0x4fd6f6[_0x134955(0x218)]&&_0x31bbda[_0x134955(0x1c8)]==_0x4fd6f6['expiry_date']&&_0x31bbda['batch_code']==_0x4fd6f6[_0x134955(0x24b)]&&_0x31bbda['production_date']==_0x4fd6f6[_0x134955(0x222)]&&_0x31bbda['delivery_date']==_0x4fd6f6[_0x134955(0x19f)]&&_0x31bbda[_0x134955(0x193)]==_0x4fd6f6['delivery_code']&&(_0x31bbda[_0x134955(0x1d1)]=parseInt(_0x31bbda[_0x134955(0x1d1)])+parseInt(_0x4fd6f6[_0x134955(0x29b)]),_0xde00b8++);});_0xde00b8=='0'&&(_0x4f2c6b[_0x75686c(0x1a9)]=_0x4f2c6b[_0x75686c(0x1a9)][_0x75686c(0x1c5)]({'product_name':_0x4fd6f6[_0x75686c(0x271)],'product_stock':_0x4fd6f6[_0x75686c(0x29b)],'primary_code':_0x4fd6f6[_0x75686c(0x1cd)],'secondary_code':_0x4fd6f6[_0x75686c(0x2a6)],'product_code':_0x4fd6f6[_0x75686c(0x1b8)],'storage':_0x4fd6f6[_0x75686c(0x218)],'rack':_0x4fd6f6[_0x75686c(0x244)],'bay':_0x4fd6f6[_0x75686c(0x1f9)],'bin':_0x4fd6f6[_0x75686c(0x1fd)],'type':_0x4fd6f6[_0x75686c(0x2a7)],'floorlevel':_0x4fd6f6['floorlevel'],'maxProducts':_0x4fd6f6['maxStocks'],'unit':_0x4fd6f6[_0x75686c(0x284)],'secondary_unit':_0x4fd6f6['secondary_unit'],'expiry_date':_0x4fd6f6[_0x75686c(0x1c8)],'maxPerUnit':_0x4fd6f6[_0x75686c(0x2a2)],'batch_code':_0x4fd6f6[_0x75686c(0x24b)],'alertQTY':_0x4fd6f6[_0x75686c(0x21c)],'production_date':_0x4fd6f6[_0x75686c(0x222)],'delivery_date':_0x4fd6f6[_0x75686c(0x19f)],'delivery_code':_0x4fd6f6[_0x75686c(0x193)]}));}),await _0x4f2c6b[_0x4842f9(0x1f8)](),_0x33083e[_0x4842f9(0x266)]=_0x4842f9(0x229);const _0x85d7a0=await _0x33083e[_0x4842f9(0x1f8)]();_0x16eee9['flash']('success','Sales\x20Update\x20successfully'),_0x185dc8[_0x4842f9(0x227)](_0x4842f9(0x1d0));}catch(_0x329b23){console[_0x4842f9(0x292)](_0x329b23);}}),router[a0_0x445a07(0x1fa)](a0_0x445a07(0x1ee),auth,async(_0x1871f1,_0xf7dd58)=>{var _0x3726fa=a0_0x445a07;try{const {username:_0x257766,email:_0x18fd11,role:_0x2bf5a5}=_0x1871f1[_0x3726fa(0x209)],_0x5366b1=_0x1871f1['user'],_0x310345=await profile[_0x3726fa(0x255)]({'email':_0x5366b1['email']}),_0x4e8cf3=await master_shop[_0x3726fa(0x1d3)](),_0x172eb1=_0x1871f1[_0x3726fa(0x214)]['id'],_0x318e5c=await purchases[_0x3726fa(0x234)](_0x172eb1),_0x19217d=await suppliers[_0x3726fa(0x1d3)]({});let _0xdf4c15;if(_0x5366b1[_0x3726fa(0x1ac)]==_0x3726fa(0x1f2)){const _0x7a6d80=await staff[_0x3726fa(0x255)]({'email':_0x5366b1[_0x3726fa(0x1ff)]});_0xdf4c15=await warehouse[_0x3726fa(0x1d3)]({'status':'Enabled','name':_0x7a6d80[_0x3726fa(0x1c4)],'warehouse_category':_0x3726fa(0x236)});}else _0xdf4c15=await warehouse[_0x3726fa(0x1bd)]([{'$match':{'status':_0x3726fa(0x223),'warehouse_category':_0x3726fa(0x236)}},{'$group':{'_id':_0x3726fa(0x1c2),'name':{'$first':'$name'}}}]);const _0x56142b=await product[_0x3726fa(0x1d3)]({}),_0x26ab49=BayBinSelected(_0x318e5c[_0x3726fa(0x21a)],_0x318e5c[_0x3726fa(0x22d)]);let _0x46e4f9=new Date(_0x318e5c[_0x3726fa(0x1c8)]),_0x3ad25f=('0'+_0x46e4f9[_0x3726fa(0x1aa)]())[_0x3726fa(0x21b)](-0x2),_0x449edb=('0'+(_0x46e4f9[_0x3726fa(0x26e)]()+0x1))[_0x3726fa(0x21b)](-0x2),_0x1c3d0f=_0x46e4f9[_0x3726fa(0x29e)](),_0x16063f=_0x1c3d0f+'-'+_0x449edb+'-'+_0x3ad25f;if(_0x4e8cf3[0x0][_0x3726fa(0x228)]==_0x3726fa(0x22c)){var _0x2b025b=users[_0x3726fa(0x1e2)];console[_0x3726fa(0x292)](_0x2b025b);}else{if(_0x4e8cf3[0x0][_0x3726fa(0x228)]=='Hindi')var _0x2b025b=users['Hindi'];else{if(_0x4e8cf3[0x0]['language']=='German')var _0x2b025b=users['German'];else{if(_0x4e8cf3[0x0]['language']=='Spanish')var _0x2b025b=users[_0x3726fa(0x1e6)];else{if(_0x4e8cf3[0x0]['language']==_0x3726fa(0x235))var _0x2b025b=users[_0x3726fa(0x235)];else{if(_0x4e8cf3[0x0][_0x3726fa(0x228)]==_0x3726fa(0x211))var _0x2b025b=users[_0x3726fa(0x1a6)];else{if(_0x4e8cf3[0x0][_0x3726fa(0x228)]==_0x3726fa(0x25f))var _0x2b025b=users['Chinese'];else{if(_0x4e8cf3[0x0][_0x3726fa(0x228)]==_0x3726fa(0x1da))var _0x2b025b=users['Arabic'];}}}}}}}_0xf7dd58[_0x3726fa(0x1ce)]('edit_purchases',{'success':_0x1871f1['flash']('success'),'errors':_0x1871f1['flash'](_0x3726fa(0x267)),'role':_0x5366b1,'profile':_0x310345,'purchases':_0x318e5c,'suppliers':_0x19217d,'warehouse':_0xdf4c15,'product':_0x56142b,'master_shop':_0x4e8cf3,'language':_0x2b025b,'ed_fullDate':_0x16063f,'dataSelected':_0x26ab49});}catch(_0xdfad0f){console[_0x3726fa(0x292)](_0xdfad0f);}}),router[a0_0x445a07(0x210)](a0_0x445a07(0x1ee),auth,async(_0x13976e,_0x30ae6e)=>{var _0x89551c=a0_0x445a07;try{const _0x5cd3fa=_0x13976e['params']['id'],_0x153dcb=await purchases['findOne']({'_id':_0x13976e[_0x89551c(0x214)]['id']}),_0x2e342e=await warehouse[_0x89551c(0x255)]({'name':_0x153dcb[_0x89551c(0x21a)],'room':_0x153dcb['room']});_0x153dcb[_0x89551c(0x1a4)][_0x89551c(0x283)](_0x594b31=>{var _0x3e0955=_0x89551c;const _0x358c40=_0x2e342e[_0x3e0955(0x1a9)]['map'](_0x38d18b=>{var _0x53b74d=_0x3e0955;_0x38d18b[_0x53b74d(0x271)]==_0x594b31[_0x53b74d(0x271)]&&_0x38d18b[_0x53b74d(0x2a4)]==_0x594b31[_0x53b74d(0x2a4)]&&_0x38d18b[_0x53b74d(0x2a7)]==_0x594b31['type']&&_0x38d18b['bin']==_0x594b31[_0x53b74d(0x1fd)]&&_0x38d18b[_0x53b74d(0x1f9)]==_0x594b31[_0x53b74d(0x1f9)]&&_0x38d18b[_0x53b74d(0x244)]==_0x594b31[_0x53b74d(0x244)]&&_0x38d18b[_0x53b74d(0x218)]==_0x594b31[_0x53b74d(0x218)]&&(_0x38d18b[_0x53b74d(0x1d1)]=parseInt(_0x38d18b[_0x53b74d(0x1d1)])-parseInt(_0x594b31[_0x53b74d(0x29b)]));});}),await _0x2e342e[_0x89551c(0x1f8)]();const {invoice:_0x4722e3,suppliers:_0x27490f,date:_0x47b0ee,warehouse_name:_0x50bda3,prod_name:_0x34921b,prod_code:_0x839ecc,prod_qty:_0x38d4db,prod_unit:_0x20e703,prod_secondunit:_0x272a5e,prod_level:_0x350fc1,prod_isle:_0x1295b5,prod_pallet:_0x583b83,note:_0x21af64,expiry_date:_0x6e7c99,batch_code:_0x4ef030,paid_amount:_0x4e55ee,due_amount:_0xd00d24,Room_name:_0x5ef392,primary_code:_0x1e93ee,secondary_code:_0xe9713e,PO_number:_0x360d73,JO_number:_0x5a5932}=_0x13976e['body'];if(typeof _0x34921b==_0x89551c(0x2a9))var _0x4407f5=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1be)]],_0x51cb79=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1c6)]],_0x5842f2=[_0x13976e[_0x89551c(0x1a1)]['prod_qty']],_0x1f61a0=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1eb)]],_0x5d58e7=[_0x13976e[_0x89551c(0x1a1)]['prod_secondunit']],_0x2bd6c7=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1af)]],_0x3c0995=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1f3)]],_0x5a197a=[_0x13976e['body']['prod_pallet']],_0x641d13=[_0x13976e['body']['primary_code']],_0x12fddf=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x2a6)]],_0x44b479=[_0x13976e['body'][_0x89551c(0x276)]],_0x24ddc8=[_0x13976e['body'][_0x89551c(0x24b)]],_0x35ea0d=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1c8)]],_0x5c9488=[_0x13976e[_0x89551c(0x1a1)]['storage']],_0x557b38=[_0x13976e['body'][_0x89551c(0x260)]],_0x36fd99=[_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x2a7)]];else var _0x4407f5=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1be)]],_0x51cb79=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1c6)]],_0x5842f2=[..._0x13976e[_0x89551c(0x1a1)]['prod_qty']],_0x1f61a0=[..._0x13976e['body'][_0x89551c(0x1eb)]],_0x5d58e7=[..._0x13976e['body'][_0x89551c(0x293)]],_0x2bd6c7=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1af)]],_0x3c0995=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1f3)]],_0x5a197a=[..._0x13976e[_0x89551c(0x1a1)]['prod_pallet']],_0x641d13=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x1cd)]],_0x12fddf=[..._0x13976e['body'][_0x89551c(0x2a6)]],_0x44b479=[..._0x13976e['body'][_0x89551c(0x276)]],_0x24ddc8=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x24b)]],_0x35ea0d=[..._0x13976e[_0x89551c(0x1a1)]['expiry_date']],_0x5c9488=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x218)]],_0x557b38=[..._0x13976e[_0x89551c(0x1a1)][_0x89551c(0x260)]],_0x36fd99=[..._0x13976e['body'][_0x89551c(0x2a7)]];const _0xb98b05=_0x4407f5['map'](_0xd1802f=>{return _0xd1802f={'product_name':_0xd1802f};});_0x51cb79[_0x89551c(0x283)]((_0x544c26,_0x9d2926)=>{var _0x2eaa9f=_0x89551c;_0xb98b05[_0x9d2926][_0x2eaa9f(0x1b8)]=_0x544c26;}),_0x5842f2[_0x89551c(0x283)]((_0x4b37f8,_0x3ac395)=>{var _0xa9baca=_0x89551c;_0xb98b05[_0x3ac395][_0xa9baca(0x29b)]=_0x4b37f8;}),_0x1f61a0[_0x89551c(0x283)]((_0xbc81a3,_0x5a4a74)=>{_0xb98b05[_0x5a4a74]['standard_unit']=_0xbc81a3;}),_0x5d58e7[_0x89551c(0x283)]((_0x110633,_0x18ed4b)=>{var _0x2f5ad5=_0x89551c;_0xb98b05[_0x18ed4b][_0x2f5ad5(0x2aa)]=_0x110633;}),_0x2bd6c7['forEach']((_0x356631,_0x9de92c)=>{var _0x54a51c=_0x89551c;_0xb98b05[_0x9de92c][_0x54a51c(0x1f9)]=_0x356631;}),_0x3c0995[_0x89551c(0x283)]((_0x4deadf,_0x28bf17)=>{var _0x5f31fc=_0x89551c;_0xb98b05[_0x28bf17][_0x5f31fc(0x1fd)]=_0x4deadf;}),_0x5a197a[_0x89551c(0x283)]((_0x35fa49,_0x41eda7)=>{var _0xf1cb02=_0x89551c;_0xb98b05[_0x41eda7][_0xf1cb02(0x2a4)]=_0x35fa49;}),_0x641d13['forEach']((_0x23cc68,_0x311f25)=>{var _0x5a66d0=_0x89551c;_0xb98b05[_0x311f25][_0x5a66d0(0x1cd)]=_0x23cc68;}),_0x12fddf[_0x89551c(0x283)]((_0x404ceb,_0x22659c)=>{var _0x39f471=_0x89551c;_0xb98b05[_0x22659c][_0x39f471(0x2a6)]=_0x404ceb;}),_0x44b479[_0x89551c(0x283)]((_0xfcbd47,_0x39b99b)=>{_0xb98b05[_0x39b99b]['maxStocks']=_0xfcbd47;}),_0x24ddc8[_0x89551c(0x283)]((_0x172043,_0x9fa59c)=>{var _0x3e401b=_0x89551c;_0xb98b05[_0x9fa59c][_0x3e401b(0x24b)]=_0x172043;}),_0x35ea0d[_0x89551c(0x283)]((_0x26c22e,_0x11084a)=>{var _0x121898=_0x89551c;_0xb98b05[_0x11084a][_0x121898(0x1c8)]=_0x26c22e;}),_0x36fd99[_0x89551c(0x283)]((_0x4b73a8,_0x3306e5)=>{_0xb98b05[_0x3306e5]['type']=_0x4b73a8;}),_0x5c9488['forEach']((_0x230c01,_0x3cba1f)=>{var _0x196778=_0x89551c;_0xb98b05[_0x3cba1f][_0x196778(0x218)]=_0x230c01;}),_0x557b38[_0x89551c(0x283)]((_0x44d965,_0x34a38b)=>{var _0x1bc17d=_0x89551c;_0xb98b05[_0x34a38b][_0x1bc17d(0x244)]=_0x44d965;});const _0x47e539=_0xb98b05[_0x89551c(0x217)](_0x476d06=>_0x476d06[_0x89551c(0x29b)]!=='0'&&_0x476d06[_0x89551c(0x29b)]!=='');_0x153dcb[_0x89551c(0x208)]=_0x4722e3,_0x153dcb[_0x89551c(0x28a)]=_0x27490f,_0x153dcb['date']=_0x47b0ee,_0x153dcb['warehouse_name']=_0x50bda3,_0x153dcb[_0x89551c(0x1a4)]=_0x47e539,_0x153dcb[_0x89551c(0x198)]=_0x21af64,_0x153dcb['paid_amount']=_0x4e55ee,_0x153dcb['due_amount']=_0xd00d24,_0x153dcb['room']=_0x5ef392,_0x153dcb[_0x89551c(0x2a3)]=_0x360d73,_0x153dcb['JO_number']=_0x5a5932;const _0x2d6984=await _0x153dcb[_0x89551c(0x1f8)](),_0x3d0a84=await warehouse[_0x89551c(0x255)]({'name':_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x21a)],'room':_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x27d)]});_0x153dcb[_0x89551c(0x1a4)][_0x89551c(0x283)](_0x18ddea=>{var _0x1e812b=_0x89551c,_0x53f7b9=0x0;const _0x18898c=_0x3d0a84['product_details'][_0x1e812b(0x201)](_0x3eb0d6=>{var _0x576b43=_0x1e812b;_0x3eb0d6[_0x576b43(0x271)]==_0x18ddea[_0x576b43(0x271)]&&_0x3eb0d6['floorlevel']==_0x18ddea[_0x576b43(0x2a4)]&&_0x3eb0d6[_0x576b43(0x2a7)]==_0x18ddea[_0x576b43(0x2a7)]&&_0x3eb0d6['bin']==_0x18ddea[_0x576b43(0x1fd)]&&_0x3eb0d6[_0x576b43(0x1f9)]==_0x18ddea[_0x576b43(0x1f9)]&&_0x3eb0d6['rack']==_0x18ddea[_0x576b43(0x244)]&&_0x3eb0d6[_0x576b43(0x218)]==_0x18ddea[_0x576b43(0x218)]&&(_0x3eb0d6[_0x576b43(0x1d1)]=parseInt(_0x3eb0d6[_0x576b43(0x1d1)])+parseInt(_0x18ddea[_0x576b43(0x29b)]),_0x53f7b9++);});_0x53f7b9=='0'&&(_0x3d0a84[_0x1e812b(0x1a9)]=_0x3d0a84[_0x1e812b(0x1a9)][_0x1e812b(0x1c5)]({'product_name':_0x18ddea['product_name'],'product_stock':_0x18ddea[_0x1e812b(0x29b)],'primary_code':_0x18ddea['primary_code'],'secondary_code':_0x18ddea['secondary_code'],'product_code':_0x18ddea[_0x1e812b(0x1b8)],'storage':_0x18ddea[_0x1e812b(0x218)],'rack':_0x18ddea[_0x1e812b(0x244)],'bay':_0x18ddea[_0x1e812b(0x1f9)],'bin':_0x18ddea[_0x1e812b(0x1fd)],'type':_0x18ddea[_0x1e812b(0x2a7)],'floorlevel':_0x18ddea[_0x1e812b(0x2a4)],'maxProducts':_0x18ddea[_0x1e812b(0x298)],'unit':_0x18ddea['standard_unit'],'secondary_unit':_0x18ddea[_0x1e812b(0x2aa)],'expiry_date':_0x18ddea[_0x1e812b(0x1c8)]}));}),await _0x3d0a84[_0x89551c(0x1f8)]();const _0x2eb4d1=await s_payment_data['findOne']({'invoice':_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x208)]});if(_0x2eb4d1===null){}else console[_0x89551c(0x292)](_0x89551c(0x28a),_0x2eb4d1,_0x13976e[_0x89551c(0x1a1)][_0x89551c(0x208)]),_0x2eb4d1[_0x89551c(0x28a)]=_0x13976e['body'][_0x89551c(0x28a)],await _0x2eb4d1['save']();_0x13976e[_0x89551c(0x19c)](_0x89551c(0x273),_0x89551c(0x25d)),_0x30ae6e[_0x89551c(0x227)](_0x89551c(0x1d0));}catch(_0xe4e0d5){console[_0x89551c(0x292)](_0xe4e0d5);}}),router['post']('/give_payment/:id',auth,async(_0xc0a7c8,_0x55d01a)=>{var _0x5cc9e9=a0_0x445a07;try{const _0x50e106=_0xc0a7c8[_0x5cc9e9(0x214)]['id'],{invoice:_0x5382ed,suppliers:_0x4710e2,payable:_0x21cf02,due_amount:_0x1068e4}=_0xc0a7c8[_0x5cc9e9(0x1a1)],_0x35d2d7=await purchases[_0x5cc9e9(0x234)](_0x50e106);var _0x4825df=_0x21cf02-_0x1068e4;_0x35d2d7[_0x5cc9e9(0x1b5)]=parseFloat(_0x35d2d7[_0x5cc9e9(0x1b5)])+parseFloat(_0x1068e4),_0x35d2d7[_0x5cc9e9(0x1c3)]=_0x4825df;const _0x6b3cf8=await _0x35d2d7[_0x5cc9e9(0x1f8)]();console['log'](_0x6b3cf8);const _0x3abe82=await s_payment_data[_0x5cc9e9(0x255)]({'invoice':_0x5382ed});_0x3abe82[_0x5cc9e9(0x1f1)]=_0x4825df,await _0x3abe82[_0x5cc9e9(0x1f8)]();let _0x393561=new Date(),_0x19671f=('0'+_0x393561[_0x5cc9e9(0x1aa)]())[_0x5cc9e9(0x21b)](-0x2),_0x13ffb4=('0'+(_0x393561[_0x5cc9e9(0x26e)]()+0x1))['slice'](-0x2),_0x259198=_0x393561[_0x5cc9e9(0x29e)](),_0x1e7ca2=_0x259198+'-'+_0x13ffb4+'-'+_0x19671f;const _0x548614=new suppliers_payment({'invoice':_0x5382ed,'date':_0x259198+'-'+_0x13ffb4+'-'+_0x19671f,'suppliers':_0x4710e2,'reason':_0x5cc9e9(0x23e),'amount':_0x1068e4}),_0x312279=await _0x548614[_0x5cc9e9(0x1f8)]();_0xc0a7c8[_0x5cc9e9(0x19c)](_0x5cc9e9(0x273),'payment\x20successfull'),_0x55d01a[_0x5cc9e9(0x227)](_0x5cc9e9(0x1d0));}catch(_0x76033b){console['log'](_0x76033b);}}),router[a0_0x445a07(0x1fa)](a0_0x445a07(0x27c),auth,async(_0x4d2505,_0x36bee7)=>{var _0x1f37aa=a0_0x445a07;try{const {username:_0x487fe4,email:_0x3ae505,role:_0x3e12be}=_0x4d2505[_0x1f37aa(0x209)],_0x1a8072=_0x4d2505[_0x1f37aa(0x209)],_0x472aef=await profile[_0x1f37aa(0x255)]({'email':_0x1a8072[_0x1f37aa(0x1ff)]}),_0x1e455f=await master_shop['find']();console[_0x1f37aa(0x292)](_0x1f37aa(0x1b1),_0x1e455f);const _0x3c46b0=_0x4d2505[_0x1f37aa(0x214)]['id'],_0x211f95=await purchases[_0x1f37aa(0x234)](_0x3c46b0);console['log'](_0x211f95);const _0x44af7b=await suppliers[_0x1f37aa(0x255)]({'name':_0x211f95[_0x1f37aa(0x28a)]});console[_0x1f37aa(0x292)](_0x44af7b);if(_0x1e455f[0x0][_0x1f37aa(0x228)]=='English\x20(US)'){var _0x1bb1b2=users[_0x1f37aa(0x1e2)];console['log'](_0x1bb1b2);}else{if(_0x1e455f[0x0][_0x1f37aa(0x228)]==_0x1f37aa(0x297))var _0x1bb1b2=users['Hindi'];else{if(_0x1e455f[0x0]['language']==_0x1f37aa(0x1ab))var _0x1bb1b2=users[_0x1f37aa(0x1ab)];else{if(_0x1e455f[0x0]['language']==_0x1f37aa(0x1e6))var _0x1bb1b2=users['Spanish'];else{if(_0x1e455f[0x0][_0x1f37aa(0x228)]==_0x1f37aa(0x235))var _0x1bb1b2=users[_0x1f37aa(0x235)];else{if(_0x1e455f[0x0]['language']=='Portuguese\x20(BR)')var _0x1bb1b2=users[_0x1f37aa(0x1a6)];else{if(_0x1e455f[0x0][_0x1f37aa(0x228)]==_0x1f37aa(0x25f))var _0x1bb1b2=users[_0x1f37aa(0x25f)];else{if(_0x1e455f[0x0][_0x1f37aa(0x228)]=='Arabic\x20(ae)')var _0x1bb1b2=users[_0x1f37aa(0x1a0)];}}}}}}}_0x36bee7['render']('purchase_invoice',{'success':_0x4d2505['flash'](_0x1f37aa(0x273)),'errors':_0x4d2505['flash'](_0x1f37aa(0x267)),'role':_0x1a8072,'profile':_0x472aef,'master_shop':_0x1e455f,'supplier':_0x44af7b,'purchase':_0x211f95,'language':_0x1bb1b2});}catch(_0x347df7){console[_0x1f37aa(0x292)](_0x347df7);}}),router[a0_0x445a07(0x1fa)](a0_0x445a07(0x24d),auth,async(_0x5a8d49,_0x1b8eef)=>{var _0x22ce50=a0_0x445a07;try{const {username:_0x223462,email:_0x5b7b16,role:_0x59df4c}=_0x5a8d49[_0x22ce50(0x209)],_0x5ab01d=_0x5a8d49[_0x22ce50(0x209)],_0x2e627a=await profile[_0x22ce50(0x255)]({'email':_0x5ab01d[_0x22ce50(0x1ff)]}),_0x326db6=await master_shop[_0x22ce50(0x1d3)]();console[_0x22ce50(0x292)](_0x22ce50(0x1b1),_0x326db6);const _0x497ef2=_0x5a8d49[_0x22ce50(0x214)]['id'];console[_0x22ce50(0x292)](_0x497ef2);const _0x523c8c=await purchases['findById'](_0x497ef2);console['log']('user_id',_0x523c8c);const _0x32e4dc=await product[_0x22ce50(0x1d3)]({}),_0x2eefc5=await warehouse[_0x22ce50(0x1bd)]([{'$match':{'name':_0x523c8c[_0x22ce50(0x21a)],'room':_0x523c8c[_0x22ce50(0x22d)],'warehouse_category':_0x22ce50(0x236)}},{'$unwind':_0x22ce50(0x29d)},{'$group':{'_id':_0x22ce50(0x221),'name':{'$first':_0x22ce50(0x1de)},'product_stock':{'$first':_0x22ce50(0x25e)},'bay':{'$first':_0x22ce50(0x1d2)},'bin':{'$first':_0x22ce50(0x199)},'type':{'$first':_0x22ce50(0x279)},'floorlevel':{'$first':_0x22ce50(0x287)},'primary_code':{'$first':_0x22ce50(0x291)},'secondary_code':{'$first':_0x22ce50(0x275)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x22ce50(0x246)},'rack':{'$first':_0x22ce50(0x1dc)}}}]);warehouse_data=await warehouse[_0x22ce50(0x1bd)]([{'$match':{'status':_0x22ce50(0x223),'name':'Return\x20Goods','warehouse_category':_0x22ce50(0x236)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x22ce50(0x292)](_0x22ce50(0x240),_0x2eefc5);if(_0x326db6[0x0]['language']==_0x22ce50(0x22c)){var _0x190f27=users[_0x22ce50(0x1e2)];console[_0x22ce50(0x292)](_0x190f27);}else{if(_0x326db6[0x0][_0x22ce50(0x228)]==_0x22ce50(0x297))var _0x190f27=users[_0x22ce50(0x297)];else{if(_0x326db6[0x0]['language']==_0x22ce50(0x1ab))var _0x190f27=users['German'];else{if(_0x326db6[0x0][_0x22ce50(0x228)]==_0x22ce50(0x1e6))var _0x190f27=users['Spanish'];else{if(_0x326db6[0x0][_0x22ce50(0x228)]==_0x22ce50(0x235))var _0x190f27=users['French'];else{if(_0x326db6[0x0][_0x22ce50(0x228)]==_0x22ce50(0x211))var _0x190f27=users[_0x22ce50(0x1a6)];else{if(_0x326db6[0x0][_0x22ce50(0x228)]==_0x22ce50(0x25f))var _0x190f27=users[_0x22ce50(0x25f)];else{if(_0x326db6[0x0][_0x22ce50(0x228)]==_0x22ce50(0x1da))var _0x190f27=users['Arabic'];}}}}}}}_0x1b8eef[_0x22ce50(0x1ce)](_0x22ce50(0x1bb),{'success':_0x5a8d49[_0x22ce50(0x19c)](_0x22ce50(0x273)),'errors':_0x5a8d49[_0x22ce50(0x19c)](_0x22ce50(0x267)),'role':_0x5ab01d,'profile':_0x2e627a,'user':_0x523c8c,'stock':_0x2eefc5,'master_shop':_0x326db6,'product':_0x32e4dc,'language':_0x190f27,'warehouse':warehouse_data});}catch(_0x384fa9){console[_0x22ce50(0x292)](_0x384fa9);}}),router[a0_0x445a07(0x210)]('/view/return_purchase/:id',auth,async(_0x2fb40c,_0x3ccaa0)=>{var _0x340b39=a0_0x445a07;try{const {invoice:_0x395773,date:_0x5ceb08,warehouse_name:_0x41937d,Room_name:_0x436597,product_name:_0x2324db,purchase_quantity:_0x3d0db7,stocks:_0x84c99,return_qty:_0x9d17bb,note:_0x24b948,level:_0x11dbf0,isle:_0x1468d2,pallet:_0x153d71,to_warehouse_name:_0x489438,to_Room_name:_0x6bae72}=_0x2fb40c['body'],_0x54a702=await purchases[_0x340b39(0x255)]({'_id':_0x2fb40c[_0x340b39(0x214)]['id']}),_0x3684a1=await warehouse[_0x340b39(0x255)]({'name':_0x41937d,'room':_0x436597});if(typeof _0x2324db==_0x340b39(0x2a9))var _0x5b21e0=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x271)]],_0x510a91=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x280)]],_0x3466f4=[_0x2fb40c['body'][_0x340b39(0x196)]],_0x2ddaa5=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x20f)]],_0x4d880a=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x259)]],_0x146818=[_0x2fb40c[_0x340b39(0x1a1)]['isle']],_0x51658d=[_0x2fb40c['body'][_0x340b39(0x1cb)]],_0x911301=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x1ec)]],_0x18f2df=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x22f)]],_0x1bab3f=[_0x2fb40c['body']['primary_code_hide']],_0x29e3fc=[_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x2a1)]];else var _0x5b21e0=[..._0x2fb40c['body'][_0x340b39(0x271)]],_0x510a91=[..._0x2fb40c['body'][_0x340b39(0x280)]],_0x3466f4=[..._0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x196)]],_0x2ddaa5=[..._0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x20f)]],_0x4d880a=[..._0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x259)]],_0x146818=[..._0x2fb40c[_0x340b39(0x1a1)]['isle']],_0x51658d=[..._0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x1cb)]],_0x911301=[..._0x2fb40c[_0x340b39(0x1a1)]['types']],_0x18f2df=[..._0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x22f)]],_0x1bab3f=[..._0x2fb40c[_0x340b39(0x1a1)]['primary_code_hide']],_0x29e3fc=[..._0x2fb40c['body']['secondary_code_hide']];const _0x5b8fa4=_0x5b21e0['map'](_0x217bbc=>{return _0x217bbc={'product_name':_0x217bbc};});_0x510a91[_0x340b39(0x283)]((_0xa3192,_0x13d672)=>{_0x5b8fa4[_0x13d672]['purchase_quantity']=_0xa3192;}),_0x3466f4['forEach']((_0x32c9f0,_0x208886)=>{_0x5b8fa4[_0x208886]['stock_quantity']=_0x32c9f0;}),_0x2ddaa5['forEach']((_0x4fcb9a,_0xb0480c)=>{var _0x1ef207=_0x340b39;_0x5b8fa4[_0xb0480c][_0x1ef207(0x20f)]=_0x4fcb9a;}),_0x4d880a[_0x340b39(0x283)]((_0x47d622,_0x1e115d)=>{var _0x3ffc3c=_0x340b39;_0x5b8fa4[_0x1e115d][_0x3ffc3c(0x1f9)]=_0x47d622;}),_0x146818[_0x340b39(0x283)]((_0x5a2276,_0x329ceb)=>{var _0x105c4b=_0x340b39;_0x5b8fa4[_0x329ceb][_0x105c4b(0x1fd)]=_0x5a2276;}),_0x51658d[_0x340b39(0x283)]((_0x5698d6,_0x47836b)=>{var _0x4a605f=_0x340b39;_0x5b8fa4[_0x47836b][_0x4a605f(0x2a4)]=_0x5698d6;}),_0x911301['forEach']((_0xda2b9b,_0x31985d)=>{var _0x26d542=_0x340b39;_0x5b8fa4[_0x31985d][_0x26d542(0x2a7)]=_0xda2b9b;}),_0x18f2df[_0x340b39(0x283)]((_0x14a28e,_0x599bcc)=>{var _0x3f6e25=_0x340b39;_0x5b8fa4[_0x599bcc][_0x3f6e25(0x1b8)]=_0x14a28e;}),_0x1bab3f[_0x340b39(0x283)]((_0x1071f2,_0x2aa12c)=>{var _0x2d728c=_0x340b39;_0x5b8fa4[_0x2aa12c][_0x2d728c(0x1cd)]=_0x1071f2;}),_0x29e3fc[_0x340b39(0x283)]((_0x5c75cf,_0x115013)=>{var _0x3c4b67=_0x340b39;_0x5b8fa4[_0x115013][_0x3c4b67(0x2a6)]=_0x5c75cf;}),_0x54a702['product']['forEach'](_0x20f3ed=>{var _0x59c623=_0x340b39;const _0x11e644=_0x3684a1[_0x59c623(0x1a9)][_0x59c623(0x201)](_0x2adea2=>{var _0x26f66a=_0x59c623;_0x2adea2[_0x26f66a(0x271)]==_0x20f3ed['product_name']&&_0x2adea2[_0x26f66a(0x2a4)]==_0x20f3ed[_0x26f66a(0x2a4)]&&_0x2adea2['type']==_0x20f3ed[_0x26f66a(0x2a7)]&&_0x2adea2[_0x26f66a(0x1fd)]==_0x20f3ed[_0x26f66a(0x1fd)]&&_0x2adea2[_0x26f66a(0x1f9)]==_0x20f3ed[_0x26f66a(0x1f9)]&&_0x2adea2[_0x26f66a(0x244)]==_0x20f3ed[_0x26f66a(0x244)]&&_0x2adea2['storage']==_0x20f3ed[_0x26f66a(0x218)]&&(console[_0x26f66a(0x292)](parseInt(_0x2adea2['product_stock'])+_0x26f66a(0x20a)+parseInt(_0x20f3ed[_0x26f66a(0x29b)])),_0x2adea2[_0x26f66a(0x1d1)]=parseInt(_0x2adea2['product_stock'])+parseInt(_0x20f3ed[_0x26f66a(0x29b)]));});}),await _0x3684a1[_0x340b39(0x1f8)]();const _0x35dd80=_0x5b8fa4[_0x340b39(0x217)](_0x564a34=>_0x564a34['return_qty']!=='0'&&_0x564a34['return_qty']!=='');var _0x5dc12e=0x0;_0x35dd80[_0x340b39(0x283)](_0x3eeadf=>{var _0x8ee796=_0x340b39;console['log'](_0x8ee796(0x1fb),_0x3eeadf),(parseInt(_0x3eeadf[_0x8ee796(0x280)])<parseInt(_0x3eeadf[_0x8ee796(0x20f)])||parseInt(_0x3eeadf['stock_quantity'])<parseInt(_0x3eeadf[_0x8ee796(0x20f)]))&&_0x5dc12e++;});if(_0x5dc12e!=0x0)return _0x2fb40c[_0x340b39(0x19c)](_0x340b39(0x267),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3ccaa0['redirect'](_0x340b39(0x286));const _0x5e3c51=new purchases_return({'invoice':_0x395773,'suppliers':_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x28a)],'date':_0x5ceb08,'warehouse_name':_0x41937d,'return_product':_0x35dd80,'note':_0x24b948,'room':_0x436597,'to_warehouse_name':_0x489438,'to_room':_0x6bae72}),_0x1b9e4b=await _0x5e3c51[_0x340b39(0x1f8)]();console[_0x340b39(0x292)](_0x5e3c51);const _0x197574=await purchases_return[_0x340b39(0x255)]({'invoice':_0x395773}),_0x28ebf9=await warehouse['findOne']({'name':_0x489438,'room':_0x6bae72});_0x197574['return_product'][_0x340b39(0x283)](_0x114109=>{var _0x38bb1f=_0x340b39,_0x3cfe16=0x0;const _0x3c84f0=_0x28ebf9[_0x38bb1f(0x1a9)][_0x38bb1f(0x201)](_0x39a71d=>{var _0x1ffa07=_0x38bb1f;_0x39a71d[_0x1ffa07(0x271)]==_0x114109[_0x1ffa07(0x271)]&&_0x39a71d[_0x1ffa07(0x2a4)]==_0x114109['floorlevel']&&_0x39a71d['type']==_0x114109[_0x1ffa07(0x2a7)]&&_0x39a71d['bin']==_0x114109[_0x1ffa07(0x1fd)]&&_0x39a71d['bay']==_0x114109[_0x1ffa07(0x1f9)]&&(_0x39a71d[_0x1ffa07(0x1d1)]=parseInt(_0x39a71d[_0x1ffa07(0x1d1)])-parseInt(_0x114109[_0x1ffa07(0x20f)]),_0x3cfe16++);});_0x3cfe16=='0'&&(_0x28ebf9[_0x38bb1f(0x1a9)]=_0x28ebf9[_0x38bb1f(0x1a9)][_0x38bb1f(0x1c5)]({'product_name':_0x114109[_0x38bb1f(0x271)],'product_stock':_0x114109[_0x38bb1f(0x20f)],'primary_code':_0x114109[_0x38bb1f(0x1cd)],'secondary_code':_0x114109[_0x38bb1f(0x2a6)],'product_code':_0x114109[_0x38bb1f(0x1b8)],'storage':_0x114109[_0x38bb1f(0x218)],'rack':_0x114109['rack'],'bay':_0x114109['bay'],'bin':_0x114109[_0x38bb1f(0x1fd)],'type':_0x114109[_0x38bb1f(0x2a7)],'floorlevel':_0x114109['floorlevel'],'maxProducts':_0x114109['maxStocks'],'unit':_0x114109[_0x38bb1f(0x284)],'secondary_unit':_0x114109[_0x38bb1f(0x2aa)],'expiry_date':_0x114109['expiry_date']}));}),await _0x28ebf9['save']();const _0x167c10=await purchases[_0x340b39(0x255)]({'invoice':_0x395773});_0x167c10['return_data']=_0x340b39(0x229);const _0x3dcbdc=await _0x167c10[_0x340b39(0x1f8)](),_0x4bfe4c=new s_payment_data({'invoice':_0x395773,'suppliers':_0x2fb40c['body'][_0x340b39(0x28a)],'reason':_0x340b39(0x20c)});await _0x4bfe4c['save']();const _0x1f90be=await master_shop[_0x340b39(0x1d3)]();console[_0x340b39(0x292)](_0x340b39(0x1fc),_0x1f90be[0x0][_0x340b39(0x21f)]);const _0xc0d855=await email_settings[_0x340b39(0x255)](),_0x24e429=await suppliers[_0x340b39(0x255)]({'name':_0x2fb40c[_0x340b39(0x1a1)][_0x340b39(0x28a)]});console['log'](_0x340b39(0x19e),_0x24e429);_0x1f90be[0x0]['currency_placement']==0x1?(right_currency=_0x1f90be[0x0][_0x340b39(0x254)],left_currency=''):(right_currency='',left_currency=_0x1f90be[0x0][_0x340b39(0x254)]);var _0x5461bf=_0x5b21e0,_0x327b07=_0x2ddaa5,_0x1e094b='',_0x3c50e3;for(_0x3c50e3 in _0x5461bf){_0x1e094b+=_0x340b39(0x1ba)+_0x340b39(0x29c)+_0x5461bf[_0x3c50e3]+'</td>'+_0x340b39(0x29c)+_0x327b07[_0x3c50e3]+_0x340b39(0x257)+_0x340b39(0x23f);}console['log'](_0x340b39(0x1f5),_0x1e094b);let _0x15e926=nodemailer[_0x340b39(0x2a8)]({'service':_0x340b39(0x25b),'auth':{'user':_0xc0d855[_0x340b39(0x1ff)],'pass':_0xc0d855[_0x340b39(0x1db)]}}),_0x5e6885={'from':_0xc0d855[_0x340b39(0x1ff)],'to':_0x24e429[_0x340b39(0x1ff)],'subject':_0x340b39(0x23a),'attachments':[{'filename':_0x340b39(0x278),'path':__dirname+_0x340b39(0x288)+_0x340b39(0x2a0)+_0x1f90be[0x0][_0x340b39(0x21f)],'cid':_0x340b39(0x1b9)}],'html':'<!DOCTYPE\x20html>'+_0x340b39(0x29a)+_0x340b39(0x215)+'<div>'+_0x340b39(0x1b4)+_0x340b39(0x1d9)+_0x340b39(0x1e1)+'</div>'+_0x340b39(0x1d9)+'<h2>\x20'+_0x1f90be[0x0][_0x340b39(0x1c9)]+_0x340b39(0x289)+'</div>'+'</div>'+_0x340b39(0x28f)+_0x340b39(0x1d9)+_0x340b39(0x204)+_0x340b39(0x22a)+_0x395773+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x5ceb08+'\x20'+'</span>'+_0x340b39(0x2a5)+_0x340b39(0x239)+_0x340b39(0x207)+_0x340b39(0x219)+_0x340b39(0x1ba)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x340b39(0x24e)+_0x340b39(0x1bf)+_0x340b39(0x26c)+_0x340b39(0x23f)+'</thead>'+_0x340b39(0x197)+'\x20'+_0x1e094b+'\x20'+_0x340b39(0x1ae)+'</table>'+_0x340b39(0x1d9)+_0x340b39(0x194)+_0x340b39(0x1e4)+_0x1f90be[0x0][_0x340b39(0x1c9)]+_0x340b39(0x2a5)+'</div>'+_0x340b39(0x239)+_0x340b39(0x270)};_0x15e926[_0x340b39(0x24a)](_0x5e6885,function(_0x369d72,_0x2be9a3){var _0x55fcaa=_0x340b39;_0x369d72?(console[_0x55fcaa(0x292)](_0x369d72),console['log'](_0x55fcaa(0x1df))):console['log']('Email\x20sent\x20successfully');}),_0x2fb40c[_0x340b39(0x19c)](_0x340b39(0x273),_0x340b39(0x268)),_0x3ccaa0[_0x340b39(0x227)](_0x340b39(0x1d0));}catch(_0x48e8d1){console[_0x340b39(0x292)](_0x48e8d1),_0x3ccaa0['status'](0xc8)['json']({'message':_0x48e8d1[_0x340b39(0x242)]});}}),router['get'](a0_0x445a07(0x1e8),auth,async(_0x5e0a44,_0x488929)=>{var _0x111b8a=a0_0x445a07;try{const {username:_0x5c8081,email:_0xbd9ceb,role:_0x59f3e2}=_0x5e0a44[_0x111b8a(0x209)],_0x4a7c85=_0x5e0a44[_0x111b8a(0x209)],_0x93798a=await profile['findOne']({'email':_0x4a7c85['email']}),_0x596590=await master_shop[_0x111b8a(0x1d3)](),_0x4c4367=_0x5e0a44[_0x111b8a(0x214)]['id'],_0x50d07a=await purchases[_0x111b8a(0x234)](_0x4c4367);if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x22c))var _0x32d85c=users['English'];else{if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x297))var _0x32d85c=users[_0x111b8a(0x297)];else{if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x1ab))var _0x32d85c=users[_0x111b8a(0x1ab)];else{if(_0x596590[0x0]['language']=='Spanish')var _0x32d85c=users[_0x111b8a(0x1e6)];else{if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x235))var _0x32d85c=users[_0x111b8a(0x235)];else{if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x211))var _0x32d85c=users[_0x111b8a(0x1a6)];else{if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x25f))var _0x32d85c=users[_0x111b8a(0x25f)];else{if(_0x596590[0x0][_0x111b8a(0x228)]==_0x111b8a(0x1da))var _0x32d85c=users[_0x111b8a(0x1a0)];}}}}}}}_0x488929[_0x111b8a(0x1ce)](_0x111b8a(0x1cf),{'success':_0x5e0a44['flash'](_0x111b8a(0x273)),'errors':_0x5e0a44[_0x111b8a(0x19c)](_0x111b8a(0x267)),'role':_0x4a7c85,'profile':_0x93798a,'alldata':_0x50d07a,'master_shop':_0x596590,'language':_0x32d85c}),console['log'](alldata);}catch(_0x36c0ff){console[_0x111b8a(0x292)](_0x36c0ff);}}),router['post'](a0_0x445a07(0x1a5),async(_0x106fab,_0x3e4f1c)=>{var _0x3eb010=a0_0x445a07;const {product_code:_0x3212eb}=_0x106fab['body'];var _0x5bca20;const _0x154ee7=await product[_0x3eb010(0x1bd)]([{'$match':{'primary_code':_0x3212eb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3eb010(0x261),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x3eb010(0x26a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3eb010(0x22b)},'primary_code':{'$first':_0x3eb010(0x195)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3eb010(0x1b6)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3eb010(0x28b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x38df8d=await product[_0x3eb010(0x1bd)]([{'$match':{'secondary_code':_0x3212eb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3eb010(0x261),'name':{'$first':'$name'},'category':{'$first':_0x3eb010(0x274)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3eb010(0x26a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3eb010(0x22b)},'primary_code':{'$first':_0x3eb010(0x195)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3eb010(0x28b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x154ee7[_0x3eb010(0x1ca)]>0x0)_0x5bca20=_0x154ee7;else _0x38df8d[_0x3eb010(0x1ca)]>0x0&&(_0x5bca20=_0x38df8d);_0x3e4f1c[_0x3eb010(0x1ea)](_0x5bca20);}),router[a0_0x445a07(0x210)](a0_0x445a07(0x263),async(_0xf107a5,_0x201d57)=>{var _0x503981=a0_0x445a07;const {primaryCode:_0x345210,secondaryCode:_0x1028b2,productCode:_0x30b8cb,bay:_0x2c245c,bin:_0x4b94a2,types:_0x4573e4,pallet:_0x1e39bc,warehouses:_0x161630,room:_0x685dc9}=_0xf107a5[_0x503981(0x1a1)];console['log'](_0xf107a5[_0x503981(0x1a1)]);try{const _0x3450e0=await warehouse[_0x503981(0x1bd)]([{'$match':{'name':_0x161630,'room':_0x685dc9}},{'$unwind':_0x503981(0x29d)},{'$match':{'product_details.bay':_0x2c245c,'product_details.bin':_0x4b94a2,'product_details.type':_0x4573e4}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x503981(0x1de)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x503981(0x1d7)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x503981(0x21e)},'maxProducts':{'$first':_0x503981(0x1b3)}}}]);_0x201d57['status'](0xc8)['json'](_0x3450e0);}catch(_0x53f7ff){_0x201d57[_0x503981(0x212)](0x194)['json']({'message':_0x53f7ff[_0x503981(0x242)]});}}),module[a0_0x445a07(0x1e9)]=router;