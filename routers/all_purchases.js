var a0_0x2252df=a0_0x331c;(function(_0x488cbd,_0x3f946d){var _0x57b992=a0_0x331c,_0x10982d=_0x488cbd();while(!![]){try{var _0x58013f=parseInt(_0x57b992(0x136))/0x1*(parseInt(_0x57b992(0xea))/0x2)+-parseInt(_0x57b992(0x171))/0x3*(parseInt(_0x57b992(0xf6))/0x4)+-parseInt(_0x57b992(0x198))/0x5*(parseInt(_0x57b992(0xf2))/0x6)+parseInt(_0x57b992(0xce))/0x7*(-parseInt(_0x57b992(0x168))/0x8)+-parseInt(_0x57b992(0x172))/0x9*(-parseInt(_0x57b992(0x143))/0xa)+-parseInt(_0x57b992(0x112))/0xb*(parseInt(_0x57b992(0xc6))/0xc)+parseInt(_0x57b992(0x158))/0xd;if(_0x58013f===_0x3f946d)break;else _0x10982d['push'](_0x10982d['shift']());}catch(_0x401fa3){_0x10982d['push'](_0x10982d['shift']());}}}(a0_0x16d3,0xec0ba));const express=require('express'),app=express(),router=express[a0_0x2252df(0x9d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x2252df(0xf4)),nodemailer=require(a0_0x2252df(0xc7));function a0_0x16d3(){var _0x1fc49e=['role','$secondary_unit','floorlevel','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','room_name','/all_purchases/view','Ambient','Rack\x20B','Rack\x20C','quantity','$name','product_code_hide','$product.quantity','error','deliverycode','$product_details.expiry_date','stock_data','/upload/','Logo.png','8437eifpYM','Return\x20Goods','$paid_amount','\x20</h2>','level','save','Shelves','product_list','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_cat','$product_details.storage','<h5>','toString','Rack\x20F','suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','email','findById','$due_amount','product_name','date','payment\x20successfull','suppliers_docs','<strong>\x20Regards\x20</strong>','getMonth','$maxStocks','$primary_code','Rack\x20E','\x20<>\x20','prod_qty','prod_invoice','slice','secondary_code_hide','$product_details.bin','3wdwvUW','Chinese','actual_qty','master','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$unit','Arabic\x20(ae)','/barcode_scanner','product_stock','bin','prod_isle','pallet','edit_purchases','40hsWKdv','Sales\x20Update\x20successfully','<h5\x20style=\x22text-align:\x20left;\x22>','abs','paid_amount','createTransport','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/all_purchases/view/','currency','Purchase\x20Return','$batch_code','return_product','secondary_code','all','language','batch_code','product_details','password','staff','$product.floorlevel','44083819xOWYkG','Portuguese\x20(BR)','concat','/CheckingWarehouse','$product_details','Purchase\x20Return\x20Mail','/invoice/:id','getFullYear','$_id','</table>','$product_details.level','$product_details.primary_code','Spanish','port','$product_details.product_code','$alertquantity','4984lzxzgP','sendMail','secondary_unit','logo','Level','MaxStocks_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic','$product_details.product_stock','3683181duObKO','2480697twoqFz','/view','<span\x20style=\x22float:\x20right;\x22>','Email\x20sent\x20successfully','Hindi','bay','/../public','gmail','RMSEmail','warehouse_name','True','</span>','prod_secondunit','$product_details.floorlevel','$product_details.bay','stock_quantity','$product.room_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Purchase\x20Mail','return_data','\x20<\x20wew\x20>\x20','Enclosed','Receiving\x20Area','\x20Order\x20Number\x20:\x20','warehouse','params','$secondary_code','Enabled','/view/add_purchases/:id','prod_level','$product','$product_details.secondary_code','room','<!DOCTYPE\x20html>','find','primary_code_hide','get','</tbody>','114370PFChLE','map','amount','due_amount','POnumber','product_cat','then','max_product_unit','host','types','/view/return_purchase/:id','$product_details.type','$suppliers','invoice','$product.bay','return_qty','INC-','/barcode/:id','suppliers_data','<html><head><title></title>','$invoice','$return_data','$brand','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','rak','prod_unit','purchase_quantity','back','message','$maxProdPerUnit','catch','$product.type','$expiry_date','Raw\x20Materials','add_purchases','English\x20(US)','/preview/:id','Purchase\x20data\x20added\x20successfully','floor','name','Router','$date','</thead>','standard_unit','finalize','$suppliers_docs','German','here','$product.bin','RoomAssign','/view/:id','<div>','Floor','Portuguese','actual_uom','storage','English','isle','ejs','post','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','prod_pallet','$product_code','delivery_date','</head><body>','padStart','aggregate','maxStocks','type','<tbody\x20style=\x22text-align:\x20center;\x22>','forEach','</td>','prod_primunit','$product_details.rack','prod_Qty','Room_name','$finalize','$category','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','2124tFOhUM','nodemailer','user','errors','delivery_code','length','/view/add_purchases','body','11998wuYTbE','path','table\x20page','getDate','French','</tr>','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details._id','site_title','../public/language/languages.json','log','filter','alertQTY','$warehouse_name','prod_name','product','production_date','status','flash','redirect','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','push','json','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<tr>','primary_code','306658fwAnRe','prod_code','all_purchases','$room','</div>','findOne','expiry_date','rack','408dxZlZM','<hr\x20class=\x22my-3\x22>','../middleware/auth','\x20Order\x20Date\x20:\x20','4tPfHjr','render','</h5>','success','Rack\x20A','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_code','$product_details.isle','purchase_invoice'];a0_0x16d3=function(){return _0x1fc49e;};return a0_0x16d3();}var ejs=require(a0_0x2252df(0xaf));const path=require(a0_0x2252df(0xcf)),users=require(a0_0x2252df(0xd8));router[a0_0x2252df(0x196)](a0_0x2252df(0x173),auth,async(_0x23c7d1,_0x20e710)=>{var _0x4c63a8=a0_0x2252df;try{const {username:_0x104c27,email:_0x506605,role:_0x6c626d}=_0x23c7d1[_0x4c63a8(0xc8)],_0x3f5cad=_0x23c7d1[_0x4c63a8(0xc8)],_0x54d513=await profile[_0x4c63a8(0xef)]({'email':_0x3f5cad[_0x4c63a8(0x124)]}),_0x460e9b=await staff[_0x4c63a8(0xef)]({'email':_0x3f5cad['email']});if(_0x3f5cad['role']==_0x4c63a8(0x156)){const _0x2193b9=await staff[_0x4c63a8(0xef)]({'email':_0x3f5cad[_0x4c63a8(0x124)]});}const _0x514fd0=await master_shop[_0x4c63a8(0x194)]();let _0x104b7e;if(_0x3f5cad['role']=='staff'){const _0x5dde51=await staff[_0x4c63a8(0xef)]({'email':_0x3f5cad[_0x4c63a8(0x124)]});_0x104b7e=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5dde51[_0x4c63a8(0x18a)]}},{'$lookup':{'from':_0x4c63a8(0x120),'localField':_0x4c63a8(0x120),'foreignField':_0x4c63a8(0x9c),'as':_0x4c63a8(0x12a)}},{'$unwind':_0x4c63a8(0xa2)},{'$unwind':_0x4c63a8(0x190)},{'$group':{'_id':_0x4c63a8(0x160),'invoice':{'$first':_0x4c63a8(0x1ac)},'suppliers':{'$first':_0x4c63a8(0x1a4)},'date':{'$first':_0x4c63a8(0x9e)},'warehouse_name':{'$first':_0x4c63a8(0xdc)},'room':{'$first':_0x4c63a8(0xed)},'product':{'$push':_0x4c63a8(0x190)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x4c63a8(0x114)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4c63a8(0x1ad)},'batch_code':{'$first':_0x4c63a8(0x14e)},'expiry_date':{'$first':_0x4c63a8(0x95)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x4c63a8(0x10b)},'level':{'$addToSet':_0x4c63a8(0x1a6)},'isle':{'$addToSet':_0x4c63a8(0xa5)},'type':{'$addToSet':_0x4c63a8(0x94)},'floorlevel':{'$addToSet':_0x4c63a8(0x157)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x104b7e=await purchases[_0x4c63a8(0xb8)]([{'$lookup':{'from':_0x4c63a8(0x120),'localField':'suppliers','foreignField':_0x4c63a8(0x9c),'as':_0x4c63a8(0x12a)}},{'$unwind':_0x4c63a8(0xa2)},{'$unwind':'$product'},{'$group':{'_id':_0x4c63a8(0x160),'invoice':{'$first':_0x4c63a8(0x1ac)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4c63a8(0x9e)},'warehouse_name':{'$first':_0x4c63a8(0xdc)},'room':{'$addToSet':_0x4c63a8(0x182)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x4c63a8(0x126)},'return_data':{'$first':_0x4c63a8(0x1ad)},'batch_code':{'$first':_0x4c63a8(0x14e)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4c63a8(0xa2)},'total_product_quantity':{'$sum':_0x4c63a8(0x10b)},'level':{'$addToSet':_0x4c63a8(0x1a6)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4c63a8(0x94)},'floorlevel':{'$addToSet':_0x4c63a8(0x157)},'finalize':{'$first':_0x4c63a8(0xc2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x514fd0[0x0][_0x4c63a8(0x152)]==_0x4c63a8(0x98)){var _0x180760=users[_0x4c63a8(0xad)];console[_0x4c63a8(0xd9)](_0x180760);}else{if(_0x514fd0[0x0]['language']==_0x4c63a8(0x176))var _0x180760=users['Hindi'];else{if(_0x514fd0[0x0]['language']=='German')var _0x180760=users['German'];else{if(_0x514fd0[0x0][_0x4c63a8(0x152)]==_0x4c63a8(0x164))var _0x180760=users[_0x4c63a8(0x164)];else{if(_0x514fd0[0x0]['language']==_0x4c63a8(0xd2))var _0x180760=users[_0x4c63a8(0xd2)];else{if(_0x514fd0[0x0][_0x4c63a8(0x152)]==_0x4c63a8(0x159))var _0x180760=users['Portuguese'];else{if(_0x514fd0[0x0][_0x4c63a8(0x152)]==_0x4c63a8(0x137))var _0x180760=users[_0x4c63a8(0x137)];else{if(_0x514fd0[0x0]['language']==_0x4c63a8(0x13c))var _0x180760=users[_0x4c63a8(0x16f)];}}}}}}}_0x20e710[_0x4c63a8(0xf7)](_0x4c63a8(0xec),{'success':_0x23c7d1[_0x4c63a8(0xe1)](_0x4c63a8(0xf9)),'errors':_0x23c7d1['flash'](_0x4c63a8(0xc9)),'purchases':_0x104b7e,'role':_0x3f5cad,'profile':_0x54d513,'master_shop':_0x514fd0,'language':_0x180760});}catch(_0x1e70b6){console[_0x4c63a8(0xd9)](_0x4c63a8(0xd0),_0x1e70b6),_0x20e710[_0x4c63a8(0xe0)](0xc8)[_0x4c63a8(0xe5)]({'message':_0x1e70b6[_0x4c63a8(0x1b5)]});}});function BayBinSelected(_0x32145b,_0x367f4c){var _0x3e82a2=a0_0x2252df,_0x23b9d0=[],_0x553c4a=[],_0x5709d7=[],_0x1d1408=[],_0x34cbf0=[],_0x1c24ec=[];let _0x549a4a=[];if(_0x32145b=='DRY\x20STORAGE')switch(_0x367f4c){case'Rack\x20A':_0x23b9d0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x553c4a=[0x1,0x2],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0x16c),_0x3e82a2(0xa9)],_0x34cbf0=['D'],_0x1c24ec=['A'];break;case _0x3e82a2(0x106):_0x23b9d0=[0x6,0x5,0x4,0x3,0x2,0x1],_0x553c4a=[0x1,0x2],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0x16c),_0x3e82a2(0xa9)],_0x34cbf0=['D'],_0x1c24ec=['B'];break;case _0x3e82a2(0x118):_0x23b9d0=[0x0],_0x553c4a=[0x0],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0xa9)],_0x34cbf0=['D'],_0x1c24ec=['S'];break;case _0x3e82a2(0x188):_0x23b9d0=[0x0],_0x553c4a=[0x0],_0x1d1408=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5709d7=[_0x3e82a2(0xa9)],_0x34cbf0=['D'],_0x1c24ec=['R'];break;}else{if(_0x32145b=='COLD\x20STORAGE')switch(_0x367f4c){case _0x3e82a2(0xfa):_0x23b9d0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x553c4a=['B','F'],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0x16c),_0x3e82a2(0xa9)],_0x34cbf0=['C'],_0x1c24ec=['A'];break;case _0x3e82a2(0x106):_0x23b9d0=[0x5,0x4,0x3,0x2,0x1],_0x553c4a=['F','B','S'],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0x16c),'Floor'],_0x34cbf0=['C'],_0x1c24ec=['B'];break;case _0x3e82a2(0x107):_0x23b9d0=[0x1,0x2,0x3,0x4,0x5],_0x553c4a=['B','F','S'],_0x1d1408=[0x5,0x4,0x3,0x2,0x1],_0x5709d7=[_0x3e82a2(0x16c),_0x3e82a2(0xa9)],_0x34cbf0=['C'],_0x1c24ec=['C'];break;case'Rack\x20D':_0x23b9d0=[0x5,0x4,0x3,0x2,0x1],_0x553c4a=['F','B','S'],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0x16c),_0x3e82a2(0xa9)],_0x34cbf0=['C'],_0x1c24ec=['D'];break;case _0x3e82a2(0x12f):_0x23b9d0=[0x4,0x3,0x2,0x1],_0x553c4a=[0x1,0x2],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=[_0x3e82a2(0x16c),_0x3e82a2(0xa9)],_0x34cbf0=['C'],_0x1c24ec=['E'];break;case _0x3e82a2(0x11f):_0x23b9d0=[0x1,0x2,0x3],_0x553c4a=[0x1,0x2],_0x1d1408=[0x1,0x2,0x3,0x4,0x5],_0x5709d7=['Level'],_0x34cbf0=['C'],_0x1c24ec=['F'];break;}}return{'levels':_0x23b9d0,'Isle':_0x553c4a,'rack':_0x1d1408,'type':_0x5709d7,'storage':_0x34cbf0,'rak':_0x1c24ec};}function a0_0x331c(_0xca243e,_0x461f4f){var _0x16d301=a0_0x16d3();return a0_0x331c=function(_0x331c42,_0x59fbba){_0x331c42=_0x331c42-0x93;var _0x3351bc=_0x16d301[_0x331c42];return _0x3351bc;},a0_0x331c(_0xca243e,_0x461f4f);}async function getRandom8DigitNumber(){var _0x34f08c=a0_0x2252df;const _0x1b9bc1=0x989680,_0x13c3ec=0x5f5e0ff,_0x67440f=Math[_0x34f08c(0x9b)](Math['random']()*(_0x13c3ec-_0x1b9bc1+0x1))+_0x1b9bc1;var _0x9e5ba5;const _0x4fe9d1=await purchases[_0x34f08c(0xef)]({'invoice':_0x34f08c(0x1a8)+_0x67440f});return _0x4fe9d1&&_0x4fe9d1[_0x34f08c(0xcb)]>0x0?_0x9e5ba5=_0x34f08c(0x1a8)+_0x67440f:_0x9e5ba5=_0x34f08c(0x1a8)+_0x67440f,_0x9e5ba5;}router['get'](a0_0x2252df(0xcc),auth,async(_0x2428ac,_0x33d000)=>{var _0xc917cb=a0_0x2252df;try{const {username:_0x5178db,email:_0x415bb9,role:_0x4b3c63}=_0x2428ac[_0xc917cb(0xc8)],_0xba2792=_0x2428ac['user'],_0x4e085e=await profile['findOne']({'email':_0xba2792[_0xc917cb(0x124)]}),_0x7a6b11=await master_shop[_0xc917cb(0x194)](),_0x362864=await staff[_0xc917cb(0xef)]({'email':_0xba2792[_0xc917cb(0x124)]}),_0xf9f9bc=await suppliers[_0xc917cb(0x194)]({});let _0x3a378b;if(_0xba2792[_0xc917cb(0xff)]=='staff'){const _0x3f3af2=await staff[_0xc917cb(0xef)]({'email':_0xba2792[_0xc917cb(0x124)]});_0x3a378b=await warehouse[_0xc917cb(0xb8)]([{'$match':{'status':_0xc917cb(0x18d),'name':_0x3f3af2['warehouse'],'warehouse_category':_0xc917cb(0x96),'name':{'$ne':_0xc917cb(0x113)}}},{'$group':{'_id':_0xc917cb(0x109),'name':{'$first':_0xc917cb(0x109)}}}]);}else _0x3a378b=await warehouse[_0xc917cb(0xb8)]([{'$match':{'status':_0xc917cb(0x18d),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xc917cb(0x113)}}},{'$group':{'_id':'$name','name':{'$first':_0xc917cb(0x109)}}}]);const _0x25ac57=await product['find']({}),_0x58cf96=await warehouse[_0xc917cb(0x194)]({'status':_0xc917cb(0x18d)}),_0x3567fb=await purchases[_0xc917cb(0x194)]({}),_0x433de5=_0x3567fb[_0xc917cb(0xcb)]+0x1,_0x41b21a=_0xc917cb(0x1a8)+_0x433de5[_0xc917cb(0x11e)]()[_0xc917cb(0xb7)](0x5,'0');var _0x147601=[_0xc917cb(0x105),_0xc917cb(0x187)];if(_0x7a6b11[0x0][_0xc917cb(0x152)]==_0xc917cb(0x98))var _0x15fc4f=users[_0xc917cb(0xad)];else{if(_0x7a6b11[0x0][_0xc917cb(0x152)]==_0xc917cb(0x176))var _0x15fc4f=users[_0xc917cb(0x176)];else{if(_0x7a6b11[0x0][_0xc917cb(0x152)]=='German')var _0x15fc4f=users[_0xc917cb(0xa3)];else{if(_0x7a6b11[0x0]['language']==_0xc917cb(0x164))var _0x15fc4f=users[_0xc917cb(0x164)];else{if(_0x7a6b11[0x0]['language']==_0xc917cb(0xd2))var _0x15fc4f=users[_0xc917cb(0xd2)];else{if(_0x7a6b11[0x0][_0xc917cb(0x152)]==_0xc917cb(0x159))var _0x15fc4f=users[_0xc917cb(0xaa)];else{if(_0x7a6b11[0x0][_0xc917cb(0x152)]==_0xc917cb(0x137))var _0x15fc4f=users[_0xc917cb(0x137)];else{if(_0x7a6b11[0x0][_0xc917cb(0x152)]=='Arabic\x20(ae)')var _0x15fc4f=users[_0xc917cb(0x16f)];}}}}}}}const _0x58f2e1=getRandom8DigitNumber();_0x58f2e1[_0xc917cb(0x19e)](_0x236fd3=>{var _0x4e06b2=_0xc917cb;_0x33d000[_0x4e06b2(0xf7)](_0x4e06b2(0x97),{'success':_0x2428ac[_0x4e06b2(0xe1)](_0x4e06b2(0xf9)),'errors':_0x2428ac['flash'](_0x4e06b2(0xc9)),'role':_0xba2792,'profile':_0x4e085e,'suppliers':_0xf9f9bc,'warehouse':_0x3a378b,'product':_0x25ac57,'invoice':_0x236fd3,'master_shop':_0x7a6b11,'language':_0x15fc4f,'find_data':_0x58cf96,'rooms_data':_0x147601});})[_0xc917cb(0x93)](_0xff7b40=>{var _0x194c41=_0xc917cb;_0x2428ac[_0x194c41(0xe1)](_0x194c41(0xc9),_0x194c41(0xfb)),_0x33d000[_0x194c41(0xe2)](_0x194c41(0x104));});}catch(_0x532a88){console['log'](_0x532a88);}}),router['get'](a0_0x2252df(0x18e),auth,async(_0xd0f920,_0x11c3e0)=>{var _0x4a7699=a0_0x2252df;try{const _0x55aeeb=_0xd0f920[_0x4a7699(0x18b)]['id'];console['log'](_0x55aeeb);const _0x486015=await master_shop[_0x4a7699(0x194)]();console['log'](_0x4a7699(0x139),_0x486015);const _0x34df10=await product[_0x4a7699(0xef)]({'name':_0x55aeeb});console['log'](_0x4a7699(0xde),_0x34df10),_0x11c3e0[_0x4a7699(0xe0)](0xc8)[_0x4a7699(0xe5)]({'product_data':_0x34df10,'master':_0x486015});}catch(_0x20fa3d){console[_0x4a7699(0xd9)]('add_purchases\x20error',_0x20fa3d);}}),router['post'](a0_0x2252df(0xcc),auth,async(_0x4cd81b,_0xc0602e)=>{var _0x1d7afd=a0_0x2252df;try{const {invoice:_0xe624a3,date:_0x1618c3,warehouse_name:_0x368fc5,prod_name:_0x39acaa,prod_code:_0x2608f9,prod_qty:_0x4437bd,prod_unit:_0x14b839,prod_secondunit:_0x3a4a20,prod_level:_0xdaea16,prod_isle:_0x1f988e,prod_pallet:_0x5e817f,note:_0x161154,expiry_date:_0x5e5cce,batch_code:_0x4bbada,payable:_0x5cfcad,due_amount:_0x475a96,Room_name:_0x28e5e3,primary_code:_0xd6e62,secondary_code:_0x2dd60a,MaxStocks_data:_0x34cde5,PO_number:_0x2dd293,SCRN:_0x51da4f,JO_number:_0xac3a7d}=_0x4cd81b['body'];if(typeof _0x39acaa=='string')var _0x1a07a1=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xdd)]],_0x2aaffa=[_0x4cd81b['body'][_0x1d7afd(0xeb)]],_0x2b4795=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xc0)]],_0x55f755=[_0x4cd81b['body'][_0x1d7afd(0xbe)]],_0x431531=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x17e)]],_0x3f1cbf=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x18f)]],_0x1b360b=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xe9)]],_0x56a398=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x150)]],_0x2df2e5=[_0x4cd81b['body'][_0x1d7afd(0x16d)]],_0x210214=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x153)]],_0x59b7eb=[_0x4cd81b['body'][_0x1d7afd(0xf0)]],_0x2a1d84=[_0x4cd81b['body'][_0x1d7afd(0x19f)]],_0x317596=[_0x4cd81b['body'][_0x1d7afd(0xdb)]],_0x4ce4fa=[_0x4cd81b['body'][_0x1d7afd(0xdf)]],_0x2afea2=[_0x4cd81b['body'][_0x1d7afd(0x11b)]],_0x25822b=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xa6)]],_0x19798b=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x10d)]],_0x528f06=[_0x4cd81b['body'][_0x1d7afd(0x132)]],_0x3b9b65=[_0x4cd81b['body'][_0x1d7afd(0x138)]],_0x416077=[_0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xab)]];else var _0x1a07a1=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xdd)]],_0x2aaffa=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xeb)]],_0x2b4795=[..._0x4cd81b[_0x1d7afd(0xcd)]['prod_Qty']],_0x55f755=[..._0x4cd81b['body']['prod_primunit']],_0x431531=[..._0x4cd81b[_0x1d7afd(0xcd)]['prod_secondunit']],_0x3f1cbf=[..._0x4cd81b['body'][_0x1d7afd(0x18f)]],_0x1b360b=[..._0x4cd81b['body'][_0x1d7afd(0xe9)]],_0x56a398=[..._0x4cd81b[_0x1d7afd(0xcd)]['secondary_code']],_0x2df2e5=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x16d)]],_0x210214=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x153)]],_0x59b7eb=[..._0x4cd81b['body'][_0x1d7afd(0xf0)]],_0x2a1d84=[..._0x4cd81b[_0x1d7afd(0xcd)]['max_product_unit']],_0x317596=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0xdb)]],_0x4ce4fa=[..._0x4cd81b['body'][_0x1d7afd(0xdf)]],_0x2afea2=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x11b)]],_0x25822b=[..._0x4cd81b[_0x1d7afd(0xcd)]['RoomAssign']],_0x19798b=[..._0x4cd81b['body'][_0x1d7afd(0x10d)]],_0x528f06=[..._0x4cd81b[_0x1d7afd(0xcd)][_0x1d7afd(0x132)]],_0x3b9b65=[..._0x4cd81b['body']['actual_qty']],_0x416077=[..._0x4cd81b['body'][_0x1d7afd(0xab)]];const _0x27de5c=_0x1a07a1[_0x1d7afd(0x199)](_0x56872e=>{return _0x56872e={'product_name':_0x56872e};});_0x3b9b65[_0x1d7afd(0xbc)]((_0x582e19,_0x462249)=>{var _0x21267f=_0x1d7afd;_0x27de5c[_0x462249][_0x21267f(0x138)]=Math['abs'](_0x582e19);}),_0x416077[_0x1d7afd(0xbc)]((_0x5390fd,_0x259f19)=>{var _0x57f935=_0x1d7afd;_0x27de5c[_0x259f19][_0x57f935(0xab)]=_0x5390fd;}),_0x2aaffa[_0x1d7afd(0xbc)]((_0x54fe2b,_0x498b52)=>{_0x27de5c[_0x498b52]['product_code']=_0x54fe2b;}),_0x2b4795[_0x1d7afd(0xbc)]((_0x437dce,_0x970f25)=>{var _0x30325f=_0x1d7afd;_0x27de5c[_0x970f25][_0x30325f(0x108)]=Math[_0x30325f(0x146)](_0x437dce);}),_0x55f755[_0x1d7afd(0xbc)]((_0x1e3b65,_0x5aa01e)=>{var _0x251f47=_0x1d7afd;_0x27de5c[_0x5aa01e][_0x251f47(0xa0)]=_0x1e3b65;}),_0x431531[_0x1d7afd(0xbc)]((_0x3b130a,_0x46edce)=>{_0x27de5c[_0x46edce]['secondary_unit']=_0x3b130a;}),_0x3f1cbf[_0x1d7afd(0xbc)]((_0x40d33e,_0x57d732)=>{var _0x4cb6aa=_0x1d7afd;_0x25822b[_0x4cb6aa(0xbc)]((_0x5a86f1,_0x3de70b)=>{var _0x5f3126=_0x4cb6aa;if(_0x5a86f1==_0x5f3126(0x188)&&_0x57d732==_0x3de70b){console[_0x5f3126(0xd9)](_0x5a86f1+_0x5f3126(0x186)+_0x57d732+_0x5f3126(0x130)+_0x3de70b+_0x5f3126(0x130)+_0x40d33e);var _0x346b42=_0x40d33e[_0x5f3126(0x133)](0x3);_0x27de5c[_0x57d732][_0x5f3126(0xac)]=_0x40d33e[0x0],_0x27de5c[_0x57d732][_0x5f3126(0xf1)]=_0x40d33e[0x1],_0x27de5c[_0x57d732][_0x5f3126(0x177)]=0x0,_0x27de5c[_0x57d732]['bin']=0x0,_0x27de5c[_0x57d732][_0x5f3126(0xba)]=_0x5f3126(0xa9),_0x27de5c[_0x57d732][_0x5f3126(0x101)]=_0x346b42;}else{if(_0x5a86f1==_0x5f3126(0x118)&&_0x57d732==_0x3de70b){var _0x346b42=_0x40d33e[_0x5f3126(0x133)](0x3);_0x27de5c[_0x57d732][_0x5f3126(0xac)]=_0x40d33e[0x0],_0x27de5c[_0x57d732][_0x5f3126(0xf1)]=_0x40d33e[0x1],_0x27de5c[_0x57d732][_0x5f3126(0x177)]=0x0,_0x27de5c[_0x57d732]['bin']=0x0,_0x27de5c[_0x57d732]['type']='Floor',_0x27de5c[_0x57d732][_0x5f3126(0x101)]=_0x40d33e[0x5];}else{if(_0x57d732==_0x3de70b){if(_0x40d33e[0x0]=='A'&&_0x40d33e[0x1]=='L'&&_0x40d33e[0x2]=='L')console['log'](_0x5a86f1+_0x5f3126(0x130)+_0x57d732+_0x5f3126(0x130)+_0x3de70b+'\x20<>\x20'+_0x40d33e+_0x5f3126(0xa4)),_0x27de5c[_0x57d732][_0x5f3126(0xac)]=_0x40d33e[0x0],_0x27de5c[_0x57d732][_0x5f3126(0xf1)]=_0x40d33e[0x1],_0x27de5c[_0x57d732]['bay']=0x0,_0x27de5c[_0x57d732][_0x5f3126(0x13f)]=0x0,_0x27de5c[_0x57d732][_0x5f3126(0xba)]=_0x5f3126(0xa9),_0x27de5c[_0x57d732]['floorlevel']=_0x40d33e[0x3];else{var _0x5a790d;if(_0x40d33e[0x4]=='L')_0x5a790d=_0x5f3126(0x16c);else _0x40d33e[0x4]=='F'&&(_0x5a790d=_0x5f3126(0xa9));_0x27de5c[_0x57d732][_0x5f3126(0xac)]=_0x40d33e[0x0],_0x27de5c[_0x57d732][_0x5f3126(0xf1)]=_0x40d33e[0x1],_0x27de5c[_0x57d732]['bay']=_0x40d33e[0x2],_0x27de5c[_0x57d732]['bin']=_0x40d33e[0x3],_0x27de5c[_0x57d732][_0x5f3126(0xba)]=_0x5a790d,_0x27de5c[_0x57d732][_0x5f3126(0x101)]=_0x40d33e[0x5];}}}}});}),_0x1b360b[_0x1d7afd(0xbc)]((_0x3474c9,_0x59029e)=>{_0x27de5c[_0x59029e]['primary_code']=_0x3474c9;}),_0x56a398[_0x1d7afd(0xbc)]((_0xb6f23,_0x251f40)=>{_0x27de5c[_0x251f40]['secondary_code']=_0xb6f23;}),_0x2df2e5['forEach']((_0x21f81c,_0x2e0640)=>{var _0x163d70=_0x1d7afd;_0x27de5c[_0x2e0640][_0x163d70(0xb9)]=_0x21f81c;}),_0x210214[_0x1d7afd(0xbc)]((_0x112162,_0x9b412b)=>{var _0xd28f7f=_0x1d7afd;_0x27de5c[_0x9b412b][_0xd28f7f(0x153)]=_0x112162;}),_0x59b7eb[_0x1d7afd(0xbc)]((_0x10a10e,_0x32b953)=>{var _0x5d46a2=_0x1d7afd;_0x27de5c[_0x32b953][_0x5d46a2(0xf0)]=_0x10a10e;}),_0x2a1d84[_0x1d7afd(0xbc)]((_0x340616,_0x223a71)=>{_0x27de5c[_0x223a71]['maxperunit']=_0x340616;}),_0x317596[_0x1d7afd(0xbc)]((_0x4a74d6,_0x2f3c6a)=>{var _0x356f9c=_0x1d7afd;_0x27de5c[_0x2f3c6a][_0x356f9c(0xdb)]=_0x4a74d6;}),_0x4ce4fa['forEach']((_0x105cf5,_0x216be9)=>{var _0x49b58b=_0x1d7afd;_0x27de5c[_0x216be9][_0x49b58b(0xdf)]=_0x105cf5;}),_0x2afea2['forEach']((_0x48bfc7,_0x48131b)=>{var _0x409ab0=_0x1d7afd;_0x27de5c[_0x48131b][_0x409ab0(0x19d)]=_0x48bfc7;}),_0x25822b[_0x1d7afd(0xbc)]((_0x193358,_0x3ad3ce)=>{var _0x54ca24=_0x1d7afd;_0x27de5c[_0x3ad3ce][_0x54ca24(0x103)]=_0x193358;}),_0x19798b[_0x1d7afd(0xbc)]((_0xfea270,_0x56e391)=>{var _0x5aac0c=_0x1d7afd;_0x27de5c[_0x56e391][_0x5aac0c(0xca)]=_0xfea270;}),_0x528f06['forEach']((_0x57202b,_0x375550)=>{var _0x2fcd5c=_0x1d7afd;_0x27de5c[_0x375550][_0x2fcd5c(0x1a5)]=_0x57202b;});const _0x2f067a=_0x25822b['map'](_0x47939d=>{return _0x47939d={'room_name':_0x47939d};}),_0x48a6e8=_0x27de5c[_0x1d7afd(0xda)](_0x588cb7=>_0x588cb7['quantity']!=='0'&&_0x588cb7['quantity']!==''),_0x18d37b=new purchases({'invoice':_0xe624a3,'suppliers':_0x4cd81b[_0x1d7afd(0xcd)]['suppliers'],'date':_0x1618c3,'warehouse_name':_0x368fc5,'product':_0x48a6e8,'note':_0x161154,'due_amount':_0x475a96,'POnumber':_0x2dd293,'SCRN':_0x51da4f,'JO_number':_0xac3a7d,'roomList':_0x2f067a}),_0x183688=await _0x18d37b[_0x1d7afd(0x117)](),_0x21010e=await purchases['findOne']({'invoice':_0xe624a3}),_0x42256b=_0x21010e[_0x1d7afd(0xde)]['map'](async _0x4a7a11=>{var _0x5cc146=_0x1d7afd,_0x1fa729=await warehouse[_0x5cc146(0xef)]({'name':_0x368fc5,'room':_0x4a7a11[_0x5cc146(0x103)]}),_0x3553b0=0x0;return _0x1fa729[_0x5cc146(0x154)][_0x5cc146(0xbc)](_0x5653d0=>{var _0x486d03=_0x5cc146;_0x5653d0[_0x486d03(0x127)]==_0x4a7a11[_0x486d03(0x127)]&&_0x5653d0['floorlevel']==_0x4a7a11[_0x486d03(0x101)]&&_0x5653d0['type']==_0x4a7a11['type']&&_0x5653d0['bin']==_0x4a7a11['bin']&&_0x5653d0[_0x486d03(0x177)]==_0x4a7a11['bay']&&_0x5653d0[_0x486d03(0xf1)]==_0x4a7a11[_0x486d03(0xf1)]&&_0x5653d0[_0x486d03(0xac)]==_0x4a7a11[_0x486d03(0xac)]&&_0x5653d0['expiry_date']==_0x4a7a11['expiry_date']&&_0x5653d0['batch_code']==_0x4a7a11[_0x486d03(0x153)]&&_0x5653d0['production_date']==_0x4a7a11[_0x486d03(0xdf)]&&_0x5653d0[_0x486d03(0x1a5)]==_0x21010e[_0x486d03(0x1a5)]&&(_0x5653d0[_0x486d03(0x13e)]+=Math['abs'](_0x4a7a11[_0x486d03(0x108)]),_0x3553b0++);}),_0x3553b0===0x0&&_0x1fa729[_0x5cc146(0x154)][_0x5cc146(0xe4)]({'product_name':_0x4a7a11[_0x5cc146(0x127)],'product_stock':Math['abs'](_0x4a7a11[_0x5cc146(0x108)]),'primary_code':_0x4a7a11[_0x5cc146(0xe9)],'secondary_code':_0x4a7a11['secondary_code'],'product_code':_0x4a7a11['product_code'],'storage':_0x4a7a11[_0x5cc146(0xac)],'rack':_0x4a7a11[_0x5cc146(0xf1)],'bay':_0x4a7a11[_0x5cc146(0x177)],'bin':_0x4a7a11[_0x5cc146(0x13f)],'type':_0x4a7a11[_0x5cc146(0xba)],'floorlevel':_0x4a7a11[_0x5cc146(0x101)],'maxProducts':_0x4a7a11['maxStocks'],'unit':_0x4a7a11['standard_unit'],'secondary_unit':_0x4a7a11[_0x5cc146(0x16a)],'expiry_date':_0x4a7a11[_0x5cc146(0xf0)],'maxPerUnit':_0x4a7a11[_0x5cc146(0x1af)],'batch_code':_0x4a7a11['batch_code'],'alertQTY':_0x4a7a11['alertQTY'],'production_date':_0x4a7a11[_0x5cc146(0xdf)],'product_cat':_0x4a7a11[_0x5cc146(0x19d)],'invoice':_0x4a7a11[_0x5cc146(0x1a5)],'actual_qty':Math[_0x5cc146(0x146)](_0x4a7a11[_0x5cc146(0x138)]),'actual_uom':_0x4a7a11['actual_uom']}),_0x1fa729;});Promise[_0x1d7afd(0x151)](_0x42256b)[_0x1d7afd(0x19e)](async _0x5a7c9d=>{var _0x17968e=_0x1d7afd;try{for(const _0x17718f of _0x5a7c9d){await _0x17718f[_0x17968e(0x117)]();}const _0x38c7e1=await master_shop[_0x17968e(0x194)](),_0x55c018=await email_settings[_0x17968e(0xef)](),_0x59612d=await supervisor_settings[_0x17968e(0x194)]();var _0xfbeb48=_0x21010e[_0x17968e(0xde)],_0x5b0a0f='',_0x56bb80;for(_0x56bb80 in _0xfbeb48){_0x5b0a0f+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xfbeb48[_0x56bb80][_0x17968e(0x127)]+_0x17968e(0xbd)+_0x17968e(0x13a)+_0xfbeb48[_0x56bb80]['product_code']+_0x17968e(0xbd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xfbeb48[_0x56bb80]['quantity']+_0x17968e(0xbd)+_0x17968e(0x13a)+_0xfbeb48[_0x56bb80][_0x17968e(0xa0)]+_0x17968e(0xbd)+_0x17968e(0x13a)+_0xfbeb48[_0x56bb80][_0x17968e(0x16a)]+_0x17968e(0xbd)+_0x17968e(0x13a)+_0x21010e[_0x17968e(0x17b)]+_0x17968e(0xbd)+_0x17968e(0x13a)+_0xfbeb48[_0x56bb80][_0x17968e(0x103)]+_0x17968e(0xbd)+_0x17968e(0x13a)+_0xfbeb48[_0x56bb80][_0x17968e(0xac)]+_0xfbeb48[_0x56bb80][_0x17968e(0xf1)]+_0xfbeb48[_0x56bb80][_0x17968e(0x177)]+_0xfbeb48[_0x56bb80]['bin']+_0xfbeb48[_0x56bb80][_0x17968e(0xba)][0x0]+_0xfbeb48[_0x56bb80][_0x17968e(0x101)]+_0x17968e(0xbd),'</tr>';}let _0x3a9ad3=nodemailer[_0x17968e(0x148)]({'host':_0x55c018[_0x17968e(0x1a0)],'port':Number(_0x55c018[_0x17968e(0x165)]),'secure':![],'auth':{'user':_0x55c018[_0x17968e(0x124)],'pass':_0x55c018[_0x17968e(0x155)]}}),_0x2c7bbf={'from':_0x55c018['email'],'to':_0x59612d[0x0][_0x17968e(0x17a)],'subject':_0x17968e(0x184),'attachments':[{'filename':_0x17968e(0x111),'path':__dirname+'/../public'+_0x17968e(0x110)+_0x38c7e1[0x0]['image'],'cid':_0x17968e(0x16b)}],'html':'<!DOCTYPE\x20html>'+_0x17968e(0x1ab)+_0x17968e(0xb6)+'<div>'+_0x17968e(0x183)+'<div>'+_0x17968e(0x11a)+'</div>'+'<div>'+'<h2>\x20'+_0x38c7e1[0x0]['site_title']+_0x17968e(0x115)+_0x17968e(0xee)+_0x17968e(0xee)+_0x17968e(0xf3)+_0x17968e(0xa8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x17968e(0x189)+_0x21010e[_0x17968e(0x1a5)]+'\x20'+_0x17968e(0x174)+_0x17968e(0xf5)+_0x21010e['date']+'\x20'+_0x17968e(0x17d)+_0x17968e(0xf8)+'</div>'+_0x17968e(0x16e)+_0x17968e(0x102)+_0x17968e(0xe8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x17968e(0x14a)+_0x17968e(0xe7)+_0x17968e(0x1b0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x17968e(0xb2)+_0x17968e(0x121)+_0x17968e(0x123)+_0x17968e(0xd3)+_0x17968e(0x9f)+_0x17968e(0xbb)+'\x20'+_0x5b0a0f+'\x20'+_0x17968e(0x197)+'</table>'+_0x17968e(0xa8)+_0x17968e(0x12b)+_0x17968e(0x11d)+_0x38c7e1[0x0][_0x17968e(0xd7)]+'</h5>'+'</div>'+'</div>'+'</body></html>'};_0x3a9ad3[_0x17968e(0x169)](_0x2c7bbf,function(_0x412796,_0xfc2b04){var _0x132b93=_0x17968e;_0x412796?(console[_0x132b93(0xd9)](_0x412796),console[_0x132b93(0xd9)]('Error\x20Occurs')):console[_0x132b93(0xd9)](_0x132b93(0x175));}),_0x4cd81b[_0x17968e(0xe1)](_0x17968e(0xf9),_0x17968e(0x9a)),_0xc0602e[_0x17968e(0xe2)](_0x17968e(0x14b));}catch(_0x4fb1f1){console[_0x17968e(0x10c)](_0x4fb1f1),_0xc0602e[_0x17968e(0xe0)](0x1f4)[_0x17968e(0xe5)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1d7afd(0x93)](_0x2921f7=>{var _0x1e9ef7=_0x1d7afd;console[_0x1e9ef7(0x10c)](_0x2921f7),_0xc0602e[_0x1e9ef7(0xe0)](0x1f4)[_0x1e9ef7(0xe5)]({'error':'An\x20error\x20occurred.'});});}catch(_0x11b754){console[_0x1d7afd(0xd9)](_0x11b754);}}),router['get'](a0_0x2252df(0x99),auth,async(_0x2f6dd5,_0x1187ca)=>{var _0x29ec3e=a0_0x2252df;try{const {username:_0x5cda65,email:_0x143845,role:_0x3e42f9}=_0x2f6dd5[_0x29ec3e(0xc8)],_0x1bbf06=_0x2f6dd5[_0x29ec3e(0xc8)],_0x51d88a=await profile[_0x29ec3e(0xef)]({'email':_0x1bbf06[_0x29ec3e(0x124)]}),_0x56cf08=await master_shop[_0x29ec3e(0x194)](),_0x681518=_0x2f6dd5['params']['id'],_0xba48b3=await purchases['findById'](_0x681518),_0x2c741f=await warehouse[_0x29ec3e(0xb8)]([{'$match':{'name':_0xba48b3[_0x29ec3e(0x17b)],'room':_0xba48b3[_0x29ec3e(0x192)]}},{'$unwind':_0x29ec3e(0x15c)},{'$group':{'_id':_0x29ec3e(0xd6),'name':{'$first':_0x29ec3e(0xc4)},'product_stock':{'$first':_0x29ec3e(0x170)},'bay':{'$first':_0x29ec3e(0x180)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x29ec3e(0x1a3)},'floorlevel':{'$first':_0x29ec3e(0x17f)},'primary_code':{'$first':_0x29ec3e(0x163)},'secondary_code':{'$first':_0x29ec3e(0x191)},'product_code':{'$first':_0x29ec3e(0x166)},'storage':{'$first':_0x29ec3e(0x11c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x29ec3e(0x10e)}}}]),_0x1fb9d2=await customer['find']({});let _0x1e39bd;if(_0x1bbf06[_0x29ec3e(0xff)]==_0x29ec3e(0x156)){const _0xbf222d=await staff[_0x29ec3e(0xef)]({'email':_0x1bbf06['email']});_0x1e39bd=await warehouse[_0x29ec3e(0xb8)]([{'$match':{'status':'Enabled','name':_0xbf222d[_0x29ec3e(0x18a)]}},{'$group':{'_id':_0x29ec3e(0x109),'name':{'$first':'$name'}}}]);}else _0x1e39bd=await warehouse[_0x29ec3e(0xb8)]([{'$match':{'status':_0x29ec3e(0x18d)}},{'$group':{'_id':_0x29ec3e(0x109),'name':{'$first':'$name'}}}]);const _0x2f50b5=await product[_0x29ec3e(0x194)]({}),_0x4d49b3=await suppliers[_0x29ec3e(0x194)]({}),_0xfc21e9=BayBinSelected(_0xba48b3['warehouse_name'],_0xba48b3[_0x29ec3e(0x192)]);if(_0x56cf08[0x0]['language']==_0x29ec3e(0x98)){var _0x1c150a=users[_0x29ec3e(0xad)];console[_0x29ec3e(0xd9)](_0x1c150a);}else{if(_0x56cf08[0x0]['language']==_0x29ec3e(0x176))var _0x1c150a=users[_0x29ec3e(0x176)];else{if(_0x56cf08[0x0][_0x29ec3e(0x152)]==_0x29ec3e(0xa3))var _0x1c150a=users[_0x29ec3e(0xa3)];else{if(_0x56cf08[0x0][_0x29ec3e(0x152)]==_0x29ec3e(0x164))var _0x1c150a=users['Spanish'];else{if(_0x56cf08[0x0][_0x29ec3e(0x152)]==_0x29ec3e(0xd2))var _0x1c150a=users[_0x29ec3e(0xd2)];else{if(_0x56cf08[0x0][_0x29ec3e(0x152)]==_0x29ec3e(0x159))var _0x1c150a=users['Portuguese'];else{if(_0x56cf08[0x0]['language']==_0x29ec3e(0x137))var _0x1c150a=users[_0x29ec3e(0x137)];else{if(_0x56cf08[0x0][_0x29ec3e(0x152)]==_0x29ec3e(0x13c))var _0x1c150a=users[_0x29ec3e(0x16f)];}}}}}}}_0x1187ca[_0x29ec3e(0xf7)]('edit_purchases_view',{'success':_0x2f6dd5[_0x29ec3e(0xe1)](_0x29ec3e(0xf9)),'errors':_0x2f6dd5[_0x29ec3e(0xe1)](_0x29ec3e(0xc9)),'role':_0x1bbf06,'profile':_0x51d88a,'customer':_0x1fb9d2,'warehouse':_0x1e39bd,'product':_0x2c741f,'user':_0xba48b3,'master_shop':_0x56cf08,'unit':_0x2f50b5,'language':_0x1c150a,'suppliers':_0x4d49b3,'dataSelected':_0xfc21e9});}catch(_0x1ba34a){console[_0x29ec3e(0xd9)](_0x1ba34a);}}),router[a0_0x2252df(0xb0)](a0_0x2252df(0x99),auth,async(_0x165348,_0x1f4007)=>{var _0x5d1629=a0_0x2252df;try{const _0x5c8175=_0x165348[_0x5d1629(0x18b)]['id'],{invoice:_0x1df655,warehouse_name:_0x1fc82a,Room_name:_0x231cf5}=_0x165348['body'],_0xd6ee15=await warehouse['findOne']({'name':_0x1fc82a,'room':_0x231cf5}),_0x395903=await purchases[_0x5d1629(0xef)]({'invoice':_0x1df655});_0x395903[_0x5d1629(0xde)][_0x5d1629(0xbc)](_0xa9cbb2=>{var _0x5e446d=_0x5d1629,_0x3a407b=0x0;const _0x4b82d9=_0xd6ee15[_0x5e446d(0x154)][_0x5e446d(0x199)](_0x45e5ea=>{var _0x232258=_0x5e446d;_0x45e5ea[_0x232258(0x127)]==_0xa9cbb2[_0x232258(0x127)]&&_0x45e5ea[_0x232258(0x101)]==_0xa9cbb2[_0x232258(0x101)]&&_0x45e5ea['type']==_0xa9cbb2[_0x232258(0xba)]&&_0x45e5ea[_0x232258(0x13f)]==_0xa9cbb2[_0x232258(0x13f)]&&_0x45e5ea[_0x232258(0x177)]==_0xa9cbb2[_0x232258(0x177)]&&_0x45e5ea[_0x232258(0xf1)]==_0xa9cbb2[_0x232258(0xf1)]&&_0x45e5ea[_0x232258(0xac)]==_0xa9cbb2[_0x232258(0xac)]&&_0x45e5ea[_0x232258(0xf0)]==_0xa9cbb2['expiry_date']&&_0x45e5ea[_0x232258(0x153)]==_0xa9cbb2[_0x232258(0x153)]&&_0x45e5ea[_0x232258(0xdf)]==_0xa9cbb2[_0x232258(0xdf)]&&_0x45e5ea[_0x232258(0xb5)]==_0xa9cbb2[_0x232258(0xb5)]&&_0x45e5ea['delivery_code']==_0xa9cbb2['delivery_code']&&(_0x45e5ea[_0x232258(0x13e)]=parseInt(_0x45e5ea[_0x232258(0x13e)])+parseInt(_0xa9cbb2[_0x232258(0x108)]),_0x3a407b++);});_0x3a407b=='0'&&(_0xd6ee15['product_details']=_0xd6ee15[_0x5e446d(0x154)][_0x5e446d(0x15a)]({'product_name':_0xa9cbb2['product_name'],'product_stock':_0xa9cbb2['quantity'],'primary_code':_0xa9cbb2['primary_code'],'secondary_code':_0xa9cbb2['secondary_code'],'product_code':_0xa9cbb2[_0x5e446d(0xfc)],'storage':_0xa9cbb2['storage'],'rack':_0xa9cbb2[_0x5e446d(0xf1)],'bay':_0xa9cbb2[_0x5e446d(0x177)],'bin':_0xa9cbb2[_0x5e446d(0x13f)],'type':_0xa9cbb2['type'],'floorlevel':_0xa9cbb2[_0x5e446d(0x101)],'maxProducts':_0xa9cbb2[_0x5e446d(0xb9)],'unit':_0xa9cbb2[_0x5e446d(0xa0)],'secondary_unit':_0xa9cbb2['secondary_unit'],'expiry_date':_0xa9cbb2[_0x5e446d(0xf0)],'maxPerUnit':_0xa9cbb2[_0x5e446d(0x1af)],'batch_code':_0xa9cbb2['batch_code'],'alertQTY':_0xa9cbb2[_0x5e446d(0xdb)],'production_date':_0xa9cbb2[_0x5e446d(0xdf)],'delivery_date':_0xa9cbb2[_0x5e446d(0xb5)],'delivery_code':_0xa9cbb2[_0x5e446d(0xca)]}));}),await _0xd6ee15[_0x5d1629(0x117)](),_0x395903[_0x5d1629(0xa1)]='True';const _0x4fd46b=await _0x395903[_0x5d1629(0x117)]();_0x165348[_0x5d1629(0xe1)](_0x5d1629(0xf9),_0x5d1629(0x144)),_0x1f4007[_0x5d1629(0xe2)](_0x5d1629(0x104));}catch(_0x195871){console[_0x5d1629(0xd9)](_0x195871);}}),router['get'](a0_0x2252df(0xa7),auth,async(_0x1ed57c,_0x1d2213)=>{var _0x41749c=a0_0x2252df;try{const {username:_0x9cf95c,email:_0x1463b7,role:_0x11d5a2}=_0x1ed57c['user'],_0x5b0527=_0x1ed57c[_0x41749c(0xc8)],_0xddd392=await profile['findOne']({'email':_0x5b0527['email']}),_0x3fdd99=await master_shop[_0x41749c(0x194)](),_0x584c00=_0x1ed57c[_0x41749c(0x18b)]['id'],_0x4116f5=await purchases['findById'](_0x584c00),_0x346cda=await suppliers[_0x41749c(0x194)]({});let _0x3aae83;if(_0x5b0527['role']==_0x41749c(0x156)){const _0x38aa80=await staff[_0x41749c(0xef)]({'email':_0x5b0527[_0x41749c(0x124)]});_0x3aae83=await warehouse['find']({'status':_0x41749c(0x18d),'name':_0x38aa80[_0x41749c(0x18a)],'warehouse_category':_0x41749c(0x96)});}else _0x3aae83=await warehouse['aggregate']([{'$match':{'status':_0x41749c(0x18d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x41749c(0x109),'name':{'$first':'$name'}}}]);const _0x18ed8c=await product[_0x41749c(0x194)]({}),_0x532a71=BayBinSelected(_0x4116f5[_0x41749c(0x17b)],_0x4116f5[_0x41749c(0x192)]);let _0x3100e5=new Date(_0x4116f5[_0x41749c(0xf0)]),_0x406771=('0'+_0x3100e5['getDate']())[_0x41749c(0x133)](-0x2),_0x1481df=('0'+(_0x3100e5['getMonth']()+0x1))[_0x41749c(0x133)](-0x2),_0x1c551c=_0x3100e5[_0x41749c(0x15f)](),_0x15ab47=_0x1c551c+'-'+_0x1481df+'-'+_0x406771;if(_0x3fdd99[0x0]['language']==_0x41749c(0x98)){var _0x536bc3=users[_0x41749c(0xad)];console[_0x41749c(0xd9)](_0x536bc3);}else{if(_0x3fdd99[0x0][_0x41749c(0x152)]=='Hindi')var _0x536bc3=users['Hindi'];else{if(_0x3fdd99[0x0]['language']==_0x41749c(0xa3))var _0x536bc3=users[_0x41749c(0xa3)];else{if(_0x3fdd99[0x0]['language']==_0x41749c(0x164))var _0x536bc3=users[_0x41749c(0x164)];else{if(_0x3fdd99[0x0][_0x41749c(0x152)]==_0x41749c(0xd2))var _0x536bc3=users[_0x41749c(0xd2)];else{if(_0x3fdd99[0x0][_0x41749c(0x152)]==_0x41749c(0x159))var _0x536bc3=users[_0x41749c(0xaa)];else{if(_0x3fdd99[0x0][_0x41749c(0x152)]==_0x41749c(0x137))var _0x536bc3=users[_0x41749c(0x137)];else{if(_0x3fdd99[0x0][_0x41749c(0x152)]=='Arabic\x20(ae)')var _0x536bc3=users[_0x41749c(0x16f)];}}}}}}}_0x1d2213[_0x41749c(0xf7)](_0x41749c(0x142),{'success':_0x1ed57c[_0x41749c(0xe1)]('success'),'errors':_0x1ed57c[_0x41749c(0xe1)](_0x41749c(0xc9)),'role':_0x5b0527,'profile':_0xddd392,'purchases':_0x4116f5,'suppliers':_0x346cda,'warehouse':_0x3aae83,'product':_0x18ed8c,'master_shop':_0x3fdd99,'language':_0x536bc3,'ed_fullDate':_0x15ab47,'dataSelected':_0x532a71});}catch(_0x5b0a12){console['log'](_0x5b0a12);}}),router[a0_0x2252df(0xb0)](a0_0x2252df(0xa7),auth,async(_0x18b008,_0x226010)=>{var _0x26deb2=a0_0x2252df;try{const _0x4a0115=_0x18b008[_0x26deb2(0x18b)]['id'],_0x39a277=await purchases['findOne']({'_id':_0x18b008['params']['id']}),_0x21d69e=await warehouse['findOne']({'name':_0x39a277[_0x26deb2(0x17b)],'room':_0x39a277[_0x26deb2(0x192)]});_0x39a277[_0x26deb2(0xde)][_0x26deb2(0xbc)](_0x5a741f=>{var _0x178021=_0x26deb2;const _0x4588f7=_0x21d69e[_0x178021(0x154)]['map'](_0x3234b6=>{var _0x18a339=_0x178021;_0x3234b6[_0x18a339(0x127)]==_0x5a741f['product_name']&&_0x3234b6[_0x18a339(0x101)]==_0x5a741f[_0x18a339(0x101)]&&_0x3234b6[_0x18a339(0xba)]==_0x5a741f[_0x18a339(0xba)]&&_0x3234b6[_0x18a339(0x13f)]==_0x5a741f[_0x18a339(0x13f)]&&_0x3234b6[_0x18a339(0x177)]==_0x5a741f[_0x18a339(0x177)]&&_0x3234b6[_0x18a339(0xf1)]==_0x5a741f[_0x18a339(0xf1)]&&_0x3234b6[_0x18a339(0xac)]==_0x5a741f['storage']&&(_0x3234b6[_0x18a339(0x13e)]=parseInt(_0x3234b6['product_stock'])-parseInt(_0x5a741f[_0x18a339(0x108)]));});}),await _0x21d69e[_0x26deb2(0x117)]();const {invoice:_0x1452a9,suppliers:_0x3f84d8,date:_0x2960a1,warehouse_name:_0x1110e4,prod_name:_0x19ce66,prod_code:_0x597850,prod_qty:_0x436ebe,prod_unit:_0x20c893,prod_secondunit:_0x500682,prod_level:_0x560e58,prod_isle:_0x2f6202,prod_pallet:_0x4861c0,note:_0x2290d7,expiry_date:_0x2f8351,batch_code:_0x417ef6,paid_amount:_0x3d46b7,due_amount:_0x456596,Room_name:_0x2ed3f7,primary_code:_0x2e91f1,secondary_code:_0x53576e,PO_number:_0x33b2ab,JO_number:_0x55ce78}=_0x18b008[_0x26deb2(0xcd)];if(typeof _0x19ce66==_0x26deb2(0xd4))var _0x165d06=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xdd)]],_0x209982=[_0x18b008['body'][_0x26deb2(0xeb)]],_0x1260d4=[_0x18b008[_0x26deb2(0xcd)]['prod_qty']],_0x3b0bab=[_0x18b008['body'][_0x26deb2(0x1b2)]],_0x3ad241=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x17e)]],_0x1438ee=[_0x18b008[_0x26deb2(0xcd)]['prod_level']],_0x5ba9db=[_0x18b008['body'][_0x26deb2(0x140)]],_0x5f3e1c=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xb3)]],_0x54e3b6=[_0x18b008[_0x26deb2(0xcd)]['primary_code']],_0x482426=[_0x18b008['body'][_0x26deb2(0x150)]],_0x4a0cf6=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x16d)]],_0x2b115d=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x153)]],_0x302ae9=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xf0)]],_0x3ba712=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xac)]],_0xa961b6=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x1b1)]],_0x5d3595=[_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xba)]];else var _0x165d06=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xdd)]],_0x209982=[..._0x18b008['body'][_0x26deb2(0xeb)]],_0x1260d4=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x131)]],_0x3b0bab=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x1b2)]],_0x3ad241=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x17e)]],_0x1438ee=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x18f)]],_0x5ba9db=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x140)]],_0x5f3e1c=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xb3)]],_0x54e3b6=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0xe9)]],_0x482426=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x150)]],_0x4a0cf6=[..._0x18b008[_0x26deb2(0xcd)]['MaxStocks_data']],_0x2b115d=[..._0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x153)]],_0x302ae9=[..._0x18b008[_0x26deb2(0xcd)]['expiry_date']],_0x3ba712=[..._0x18b008['body'][_0x26deb2(0xac)]],_0xa961b6=[..._0x18b008['body'][_0x26deb2(0x1b1)]],_0x5d3595=[..._0x18b008['body'][_0x26deb2(0xba)]];const _0x1492b1=_0x165d06[_0x26deb2(0x199)](_0x30325e=>{return _0x30325e={'product_name':_0x30325e};});_0x209982[_0x26deb2(0xbc)]((_0x51947a,_0x3675f3)=>{var _0x4f5fed=_0x26deb2;_0x1492b1[_0x3675f3][_0x4f5fed(0xfc)]=_0x51947a;}),_0x1260d4[_0x26deb2(0xbc)]((_0x4c3a88,_0xc1bc0f)=>{var _0x37bd84=_0x26deb2;_0x1492b1[_0xc1bc0f][_0x37bd84(0x108)]=_0x4c3a88;}),_0x3b0bab[_0x26deb2(0xbc)]((_0x250b3a,_0x540f51)=>{var _0x2abd3c=_0x26deb2;_0x1492b1[_0x540f51][_0x2abd3c(0xa0)]=_0x250b3a;}),_0x3ad241[_0x26deb2(0xbc)]((_0x208e2a,_0x5777cc)=>{var _0x5b06c4=_0x26deb2;_0x1492b1[_0x5777cc][_0x5b06c4(0x16a)]=_0x208e2a;}),_0x1438ee[_0x26deb2(0xbc)]((_0x5c8c32,_0x3a2f68)=>{var _0x5aa246=_0x26deb2;_0x1492b1[_0x3a2f68][_0x5aa246(0x177)]=_0x5c8c32;}),_0x5ba9db[_0x26deb2(0xbc)]((_0xd6dade,_0x4517fc)=>{_0x1492b1[_0x4517fc]['bin']=_0xd6dade;}),_0x5f3e1c[_0x26deb2(0xbc)]((_0x356f26,_0x1455f9)=>{var _0x2f0f4b=_0x26deb2;_0x1492b1[_0x1455f9][_0x2f0f4b(0x101)]=_0x356f26;}),_0x54e3b6[_0x26deb2(0xbc)]((_0x449240,_0x153eb1)=>{var _0x13baba=_0x26deb2;_0x1492b1[_0x153eb1][_0x13baba(0xe9)]=_0x449240;}),_0x482426[_0x26deb2(0xbc)]((_0x436f7b,_0x5b336e)=>{var _0xe9a0ed=_0x26deb2;_0x1492b1[_0x5b336e][_0xe9a0ed(0x150)]=_0x436f7b;}),_0x4a0cf6[_0x26deb2(0xbc)]((_0x399ef2,_0x590778)=>{var _0x40de3b=_0x26deb2;_0x1492b1[_0x590778][_0x40de3b(0xb9)]=_0x399ef2;}),_0x2b115d[_0x26deb2(0xbc)]((_0x2de17a,_0xc15359)=>{var _0x1027f8=_0x26deb2;_0x1492b1[_0xc15359][_0x1027f8(0x153)]=_0x2de17a;}),_0x302ae9[_0x26deb2(0xbc)]((_0x605b61,_0x5ab3f2)=>{var _0x2f5613=_0x26deb2;_0x1492b1[_0x5ab3f2][_0x2f5613(0xf0)]=_0x605b61;}),_0x5d3595[_0x26deb2(0xbc)]((_0x55b915,_0x3d0e5a)=>{var _0x418312=_0x26deb2;_0x1492b1[_0x3d0e5a][_0x418312(0xba)]=_0x55b915;}),_0x3ba712[_0x26deb2(0xbc)]((_0x5f455f,_0x5a9388)=>{_0x1492b1[_0x5a9388]['storage']=_0x5f455f;}),_0xa961b6['forEach']((_0x448447,_0x84781a)=>{var _0x25a6ff=_0x26deb2;_0x1492b1[_0x84781a][_0x25a6ff(0xf1)]=_0x448447;});const _0x3f650d=_0x1492b1[_0x26deb2(0xda)](_0x2bd08a=>_0x2bd08a[_0x26deb2(0x108)]!=='0'&&_0x2bd08a[_0x26deb2(0x108)]!=='');_0x39a277[_0x26deb2(0x1a5)]=_0x1452a9,_0x39a277[_0x26deb2(0x120)]=_0x3f84d8,_0x39a277[_0x26deb2(0x128)]=_0x2960a1,_0x39a277[_0x26deb2(0x17b)]=_0x1110e4,_0x39a277[_0x26deb2(0xde)]=_0x3f650d,_0x39a277[_0x26deb2(0x149)]=_0x2290d7,_0x39a277[_0x26deb2(0x147)]=_0x3d46b7,_0x39a277[_0x26deb2(0x19b)]=_0x456596,_0x39a277[_0x26deb2(0x192)]=_0x2ed3f7,_0x39a277[_0x26deb2(0x19c)]=_0x33b2ab,_0x39a277['JO_number']=_0x55ce78;const _0x3e6513=await _0x39a277[_0x26deb2(0x117)](),_0x438771=await warehouse[_0x26deb2(0xef)]({'name':_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x17b)],'room':_0x18b008['body'][_0x26deb2(0xc1)]});_0x39a277[_0x26deb2(0xde)][_0x26deb2(0xbc)](_0x508e77=>{var _0x1964f0=_0x26deb2,_0x3692b0=0x0;const _0x5a0e72=_0x438771[_0x1964f0(0x154)][_0x1964f0(0x199)](_0x29c54e=>{var _0x5586fb=_0x1964f0;_0x29c54e[_0x5586fb(0x127)]==_0x508e77[_0x5586fb(0x127)]&&_0x29c54e[_0x5586fb(0x101)]==_0x508e77[_0x5586fb(0x101)]&&_0x29c54e['type']==_0x508e77['type']&&_0x29c54e[_0x5586fb(0x13f)]==_0x508e77['bin']&&_0x29c54e['bay']==_0x508e77['bay']&&_0x29c54e[_0x5586fb(0xf1)]==_0x508e77[_0x5586fb(0xf1)]&&_0x29c54e[_0x5586fb(0xac)]==_0x508e77['storage']&&(_0x29c54e[_0x5586fb(0x13e)]=parseInt(_0x29c54e[_0x5586fb(0x13e)])+parseInt(_0x508e77[_0x5586fb(0x108)]),_0x3692b0++);});_0x3692b0=='0'&&(_0x438771[_0x1964f0(0x154)]=_0x438771[_0x1964f0(0x154)][_0x1964f0(0x15a)]({'product_name':_0x508e77[_0x1964f0(0x127)],'product_stock':_0x508e77[_0x1964f0(0x108)],'primary_code':_0x508e77[_0x1964f0(0xe9)],'secondary_code':_0x508e77['secondary_code'],'product_code':_0x508e77[_0x1964f0(0xfc)],'storage':_0x508e77['storage'],'rack':_0x508e77['rack'],'bay':_0x508e77['bay'],'bin':_0x508e77['bin'],'type':_0x508e77['type'],'floorlevel':_0x508e77[_0x1964f0(0x101)],'maxProducts':_0x508e77[_0x1964f0(0xb9)],'unit':_0x508e77[_0x1964f0(0xa0)],'secondary_unit':_0x508e77[_0x1964f0(0x16a)],'expiry_date':_0x508e77[_0x1964f0(0xf0)]}));}),await _0x438771[_0x26deb2(0x117)]();const _0x4e9244=await s_payment_data[_0x26deb2(0xef)]({'invoice':_0x18b008[_0x26deb2(0xcd)][_0x26deb2(0x1a5)]});if(_0x4e9244===null){}else console[_0x26deb2(0xd9)](_0x26deb2(0x120),_0x4e9244,_0x18b008['body'][_0x26deb2(0x1a5)]),_0x4e9244[_0x26deb2(0x120)]=_0x18b008[_0x26deb2(0xcd)]['suppliers'],await _0x4e9244['save']();_0x18b008[_0x26deb2(0xe1)](_0x26deb2(0xf9),'purchase\x20data\x20update\x20successfully'),_0x226010['redirect'](_0x26deb2(0x104));}catch(_0x2f4c53){console[_0x26deb2(0xd9)](_0x2f4c53);}}),router['post']('/give_payment/:id',auth,async(_0x1e8b7e,_0x80dd5c)=>{var _0x5d4aa0=a0_0x2252df;try{const _0x5c30a2=_0x1e8b7e['params']['id'],{invoice:_0x17adca,suppliers:_0x11a268,payable:_0x527ffb,due_amount:_0x876527}=_0x1e8b7e[_0x5d4aa0(0xcd)],_0x243a29=await purchases[_0x5d4aa0(0x125)](_0x5c30a2);var _0x290c73=_0x527ffb-_0x876527;_0x243a29[_0x5d4aa0(0x147)]=parseFloat(_0x243a29[_0x5d4aa0(0x147)])+parseFloat(_0x876527),_0x243a29[_0x5d4aa0(0x19b)]=_0x290c73;const _0x3fbc12=await _0x243a29[_0x5d4aa0(0x117)]();console[_0x5d4aa0(0xd9)](_0x3fbc12);const _0x301297=await s_payment_data[_0x5d4aa0(0xef)]({'invoice':_0x17adca});_0x301297[_0x5d4aa0(0x19a)]=_0x290c73,await _0x301297[_0x5d4aa0(0x117)]();let _0x35cdb7=new Date(),_0x2c7f83=('0'+_0x35cdb7[_0x5d4aa0(0xd1)]())[_0x5d4aa0(0x133)](-0x2),_0x43981e=('0'+(_0x35cdb7[_0x5d4aa0(0x12c)]()+0x1))[_0x5d4aa0(0x133)](-0x2),_0x2c6a0c=_0x35cdb7[_0x5d4aa0(0x15f)](),_0x44aa9c=_0x2c6a0c+'-'+_0x43981e+'-'+_0x2c7f83;const _0x5a6e54=new suppliers_payment({'invoice':_0x17adca,'date':_0x2c6a0c+'-'+_0x43981e+'-'+_0x2c7f83,'suppliers':_0x11a268,'reason':_0x5d4aa0(0xb1),'amount':_0x876527}),_0x232bcf=await _0x5a6e54[_0x5d4aa0(0x117)]();_0x1e8b7e[_0x5d4aa0(0xe1)](_0x5d4aa0(0xf9),_0x5d4aa0(0x129)),_0x80dd5c[_0x5d4aa0(0xe2)](_0x5d4aa0(0x104));}catch(_0x2b8249){console['log'](_0x2b8249);}}),router[a0_0x2252df(0x196)](a0_0x2252df(0x15e),auth,async(_0x39fba3,_0x2d4f98)=>{var _0x57c8f4=a0_0x2252df;try{const {username:_0x441cfe,email:_0x4e0f9f,role:_0x5e564c}=_0x39fba3[_0x57c8f4(0xc8)],_0x1757d5=_0x39fba3[_0x57c8f4(0xc8)],_0x2cc95b=await profile[_0x57c8f4(0xef)]({'email':_0x1757d5['email']}),_0x5aa2ac=await master_shop[_0x57c8f4(0x194)]();console[_0x57c8f4(0xd9)](_0x57c8f4(0x139),_0x5aa2ac);const _0x251c66=_0x39fba3['params']['id'],_0x185b2e=await purchases[_0x57c8f4(0x125)](_0x251c66);console[_0x57c8f4(0xd9)](_0x185b2e);const _0xebd96c=await suppliers[_0x57c8f4(0xef)]({'name':_0x185b2e[_0x57c8f4(0x120)]});console[_0x57c8f4(0xd9)](_0xebd96c);if(_0x5aa2ac[0x0][_0x57c8f4(0x152)]==_0x57c8f4(0x98)){var _0x45d502=users[_0x57c8f4(0xad)];console[_0x57c8f4(0xd9)](_0x45d502);}else{if(_0x5aa2ac[0x0][_0x57c8f4(0x152)]==_0x57c8f4(0x176))var _0x45d502=users[_0x57c8f4(0x176)];else{if(_0x5aa2ac[0x0]['language']==_0x57c8f4(0xa3))var _0x45d502=users[_0x57c8f4(0xa3)];else{if(_0x5aa2ac[0x0][_0x57c8f4(0x152)]=='Spanish')var _0x45d502=users[_0x57c8f4(0x164)];else{if(_0x5aa2ac[0x0]['language']==_0x57c8f4(0xd2))var _0x45d502=users[_0x57c8f4(0xd2)];else{if(_0x5aa2ac[0x0]['language']=='Portuguese\x20(BR)')var _0x45d502=users[_0x57c8f4(0xaa)];else{if(_0x5aa2ac[0x0]['language']=='Chinese')var _0x45d502=users[_0x57c8f4(0x137)];else{if(_0x5aa2ac[0x0]['language']==_0x57c8f4(0x13c))var _0x45d502=users[_0x57c8f4(0x16f)];}}}}}}}_0x2d4f98['render'](_0x57c8f4(0xfe),{'success':_0x39fba3[_0x57c8f4(0xe1)](_0x57c8f4(0xf9)),'errors':_0x39fba3[_0x57c8f4(0xe1)](_0x57c8f4(0xc9)),'role':_0x1757d5,'profile':_0x2cc95b,'master_shop':_0x5aa2ac,'supplier':_0xebd96c,'purchase':_0x185b2e,'language':_0x45d502});}catch(_0x415848){console[_0x57c8f4(0xd9)](_0x415848);}}),router[a0_0x2252df(0x196)](a0_0x2252df(0x1a2),auth,async(_0x32ec22,_0x1ee597)=>{var _0x1730c1=a0_0x2252df;try{const {username:_0x9cc8d8,email:_0x2de1c2,role:_0x59ee57}=_0x32ec22[_0x1730c1(0xc8)],_0x5ed0f6=_0x32ec22['user'],_0x2c3330=await profile[_0x1730c1(0xef)]({'email':_0x5ed0f6[_0x1730c1(0x124)]}),_0xdf0aff=await master_shop[_0x1730c1(0x194)]();console[_0x1730c1(0xd9)](_0x1730c1(0x139),_0xdf0aff);const _0x9b68bd=_0x32ec22[_0x1730c1(0x18b)]['id'];console[_0x1730c1(0xd9)](_0x9b68bd);const _0x592390=await purchases[_0x1730c1(0x125)](_0x9b68bd);console['log']('user_id',_0x592390);const _0x10887a=await product[_0x1730c1(0x194)]({}),_0x50f65f=await warehouse[_0x1730c1(0xb8)]([{'$match':{'name':_0x592390[_0x1730c1(0x17b)],'room':_0x592390[_0x1730c1(0x192)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1730c1(0xd6),'name':{'$first':_0x1730c1(0xc4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1730c1(0x180)},'bin':{'$first':_0x1730c1(0x135)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1730c1(0x17f)},'primary_code':{'$first':_0x1730c1(0x163)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1730c1(0x166)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1730c1(0xbf)}}}]);warehouse_data=await warehouse[_0x1730c1(0xb8)]([{'$match':{'status':_0x1730c1(0x18d),'name':_0x1730c1(0x113),'warehouse_category':_0x1730c1(0x96)}},{'$group':{'_id':'$name','name':{'$first':_0x1730c1(0x109)}}},{'$sort':{'name':0x1}}]),console['log'](_0x1730c1(0x10f),_0x50f65f);if(_0xdf0aff[0x0]['language']=='English\x20(US)'){var _0x4b0469=users[_0x1730c1(0xad)];console[_0x1730c1(0xd9)](_0x4b0469);}else{if(_0xdf0aff[0x0][_0x1730c1(0x152)]=='Hindi')var _0x4b0469=users['Hindi'];else{if(_0xdf0aff[0x0][_0x1730c1(0x152)]==_0x1730c1(0xa3))var _0x4b0469=users[_0x1730c1(0xa3)];else{if(_0xdf0aff[0x0][_0x1730c1(0x152)]==_0x1730c1(0x164))var _0x4b0469=users['Spanish'];else{if(_0xdf0aff[0x0]['language']=='French')var _0x4b0469=users[_0x1730c1(0xd2)];else{if(_0xdf0aff[0x0]['language']==_0x1730c1(0x159))var _0x4b0469=users[_0x1730c1(0xaa)];else{if(_0xdf0aff[0x0][_0x1730c1(0x152)]==_0x1730c1(0x137))var _0x4b0469=users['Chinese'];else{if(_0xdf0aff[0x0][_0x1730c1(0x152)]==_0x1730c1(0x13c))var _0x4b0469=users[_0x1730c1(0x16f)];}}}}}}}_0x1ee597['render']('return_purchase',{'success':_0x32ec22[_0x1730c1(0xe1)](_0x1730c1(0xf9)),'errors':_0x32ec22[_0x1730c1(0xe1)](_0x1730c1(0xc9)),'role':_0x5ed0f6,'profile':_0x2c3330,'user':_0x592390,'stock':_0x50f65f,'master_shop':_0xdf0aff,'product':_0x10887a,'language':_0x4b0469,'warehouse':warehouse_data});}catch(_0x5a5d3d){console['log'](_0x5a5d3d);}}),router[a0_0x2252df(0xb0)](a0_0x2252df(0x1a2),auth,async(_0x11f951,_0x448104)=>{var _0x3bf728=a0_0x2252df;try{const {invoice:_0x3d37ff,date:_0x4558ca,warehouse_name:_0x1db27e,Room_name:_0xbbc74e,product_name:_0x13427a,purchase_quantity:_0x34738b,stocks:_0x13d60d,return_qty:_0x26f49a,note:_0xff5801,level:_0x56643a,isle:_0x5c12c3,pallet:_0x2800a3,to_warehouse_name:_0x787f5c,to_Room_name:_0x41cccc}=_0x11f951[_0x3bf728(0xcd)],_0x2ae4fe=await purchases[_0x3bf728(0xef)]({'_id':_0x11f951[_0x3bf728(0x18b)]['id']}),_0x1b65c6=await warehouse[_0x3bf728(0xef)]({'name':_0x1db27e,'room':_0xbbc74e});if(typeof _0x13427a==_0x3bf728(0xd4))var _0x4ef85f=[_0x11f951[_0x3bf728(0xcd)]['product_name']],_0x1643dd=[_0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x1b3)]],_0x868e6c=[_0x11f951[_0x3bf728(0xcd)][_0x3bf728(0xe6)]],_0x32dc76=[_0x11f951[_0x3bf728(0xcd)]['return_qty']],_0x50d0b6=[_0x11f951['body'][_0x3bf728(0x116)]],_0x1e41fb=[_0x11f951[_0x3bf728(0xcd)][_0x3bf728(0xae)]],_0x3204b4=[_0x11f951['body'][_0x3bf728(0x141)]],_0x2e86a5=[_0x11f951[_0x3bf728(0xcd)]['types']],_0x47ed14=[_0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x10a)]],_0x518713=[_0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x195)]],_0x5280c3=[_0x11f951['body'][_0x3bf728(0x134)]];else var _0x4ef85f=[..._0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x127)]],_0x1643dd=[..._0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x1b3)]],_0x868e6c=[..._0x11f951[_0x3bf728(0xcd)]['stocks']],_0x32dc76=[..._0x11f951['body']['return_qty']],_0x50d0b6=[..._0x11f951['body'][_0x3bf728(0x116)]],_0x1e41fb=[..._0x11f951['body'][_0x3bf728(0xae)]],_0x3204b4=[..._0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x141)]],_0x2e86a5=[..._0x11f951['body'][_0x3bf728(0x1a1)]],_0x47ed14=[..._0x11f951[_0x3bf728(0xcd)]['product_code_hide']],_0x518713=[..._0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x195)]],_0x5280c3=[..._0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x134)]];const _0x27e2b5=_0x4ef85f[_0x3bf728(0x199)](_0x2b8364=>{return _0x2b8364={'product_name':_0x2b8364};});_0x1643dd['forEach']((_0x134d2a,_0x2516c8)=>{_0x27e2b5[_0x2516c8]['purchase_quantity']=_0x134d2a;}),_0x868e6c[_0x3bf728(0xbc)]((_0x416eea,_0xda1b2c)=>{var _0x50ad82=_0x3bf728;_0x27e2b5[_0xda1b2c][_0x50ad82(0x181)]=_0x416eea;}),_0x32dc76['forEach']((_0x1509f5,_0x5f1107)=>{var _0x59ec85=_0x3bf728;_0x27e2b5[_0x5f1107][_0x59ec85(0x1a7)]=_0x1509f5;}),_0x50d0b6['forEach']((_0x40d6d4,_0x1e0b94)=>{_0x27e2b5[_0x1e0b94]['bay']=_0x40d6d4;}),_0x1e41fb['forEach']((_0x2e4c0d,_0x1703db)=>{var _0x5c35eb=_0x3bf728;_0x27e2b5[_0x1703db][_0x5c35eb(0x13f)]=_0x2e4c0d;}),_0x3204b4[_0x3bf728(0xbc)]((_0x39ca21,_0xb9ca1)=>{var _0x4b1dfd=_0x3bf728;_0x27e2b5[_0xb9ca1][_0x4b1dfd(0x101)]=_0x39ca21;}),_0x2e86a5[_0x3bf728(0xbc)]((_0x4ffc20,_0x3668fa)=>{var _0x312a5b=_0x3bf728;_0x27e2b5[_0x3668fa][_0x312a5b(0xba)]=_0x4ffc20;}),_0x47ed14[_0x3bf728(0xbc)]((_0x351c89,_0x534dec)=>{var _0x45ea7f=_0x3bf728;_0x27e2b5[_0x534dec][_0x45ea7f(0xfc)]=_0x351c89;}),_0x518713[_0x3bf728(0xbc)]((_0x10fd60,_0x1a7743)=>{var _0x4c6c98=_0x3bf728;_0x27e2b5[_0x1a7743][_0x4c6c98(0xe9)]=_0x10fd60;}),_0x5280c3[_0x3bf728(0xbc)]((_0xe3f607,_0x592dce)=>{var _0x16e207=_0x3bf728;_0x27e2b5[_0x592dce][_0x16e207(0x150)]=_0xe3f607;}),_0x2ae4fe[_0x3bf728(0xde)][_0x3bf728(0xbc)](_0x13aafb=>{var _0x48a461=_0x3bf728;const _0x53d745=_0x1b65c6[_0x48a461(0x154)][_0x48a461(0x199)](_0x50fa77=>{var _0x47c729=_0x48a461;_0x50fa77[_0x47c729(0x127)]==_0x13aafb[_0x47c729(0x127)]&&_0x50fa77[_0x47c729(0x101)]==_0x13aafb['floorlevel']&&_0x50fa77[_0x47c729(0xba)]==_0x13aafb[_0x47c729(0xba)]&&_0x50fa77['bin']==_0x13aafb[_0x47c729(0x13f)]&&_0x50fa77[_0x47c729(0x177)]==_0x13aafb[_0x47c729(0x177)]&&_0x50fa77['rack']==_0x13aafb[_0x47c729(0xf1)]&&_0x50fa77[_0x47c729(0xac)]==_0x13aafb[_0x47c729(0xac)]&&(console[_0x47c729(0xd9)](parseInt(_0x50fa77[_0x47c729(0x13e)])+_0x47c729(0x130)+parseInt(_0x13aafb[_0x47c729(0x108)])),_0x50fa77[_0x47c729(0x13e)]=parseInt(_0x50fa77[_0x47c729(0x13e)])+parseInt(_0x13aafb[_0x47c729(0x108)]));});}),await _0x1b65c6[_0x3bf728(0x117)]();const _0xb6cccb=_0x27e2b5['filter'](_0x55250b=>_0x55250b['return_qty']!=='0'&&_0x55250b[_0x3bf728(0x1a7)]!=='');var _0x1cbfc0=0x0;_0xb6cccb[_0x3bf728(0xbc)](_0x1b829a=>{var _0x508750=_0x3bf728;console[_0x508750(0xd9)]('foreach\x20newproduct',_0x1b829a),(parseInt(_0x1b829a[_0x508750(0x1b3)])<parseInt(_0x1b829a[_0x508750(0x1a7)])||parseInt(_0x1b829a[_0x508750(0x181)])<parseInt(_0x1b829a[_0x508750(0x1a7)]))&&_0x1cbfc0++;});if(_0x1cbfc0!=0x0)return _0x11f951[_0x3bf728(0xe1)](_0x3bf728(0xc9),_0x3bf728(0xe3)),_0x448104['redirect'](_0x3bf728(0x1b4));const _0x43b1ea=new purchases_return({'invoice':_0x3d37ff,'suppliers':_0x11f951[_0x3bf728(0xcd)]['suppliers'],'date':_0x4558ca,'warehouse_name':_0x1db27e,'return_product':_0xb6cccb,'note':_0xff5801,'room':_0xbbc74e,'to_warehouse_name':_0x787f5c,'to_room':_0x41cccc}),_0x29a39d=await _0x43b1ea[_0x3bf728(0x117)]();console[_0x3bf728(0xd9)](_0x43b1ea);const _0x5735a1=await purchases_return[_0x3bf728(0xef)]({'invoice':_0x3d37ff}),_0x472faa=await warehouse[_0x3bf728(0xef)]({'name':_0x787f5c,'room':_0x41cccc});_0x5735a1[_0x3bf728(0x14f)][_0x3bf728(0xbc)](_0x813df5=>{var _0x5b5dc3=_0x3bf728,_0x3cae89=0x0;const _0x536414=_0x472faa['product_details'][_0x5b5dc3(0x199)](_0x22f64b=>{var _0x5de1df=_0x5b5dc3;_0x22f64b[_0x5de1df(0x127)]==_0x813df5[_0x5de1df(0x127)]&&_0x22f64b[_0x5de1df(0x101)]==_0x813df5[_0x5de1df(0x101)]&&_0x22f64b[_0x5de1df(0xba)]==_0x813df5[_0x5de1df(0xba)]&&_0x22f64b['bin']==_0x813df5['bin']&&_0x22f64b[_0x5de1df(0x177)]==_0x813df5[_0x5de1df(0x177)]&&(_0x22f64b['product_stock']=parseInt(_0x22f64b[_0x5de1df(0x13e)])-parseInt(_0x813df5[_0x5de1df(0x1a7)]),_0x3cae89++);});_0x3cae89=='0'&&(_0x472faa[_0x5b5dc3(0x154)]=_0x472faa[_0x5b5dc3(0x154)]['concat']({'product_name':_0x813df5[_0x5b5dc3(0x127)],'product_stock':_0x813df5[_0x5b5dc3(0x1a7)],'primary_code':_0x813df5['primary_code'],'secondary_code':_0x813df5[_0x5b5dc3(0x150)],'product_code':_0x813df5[_0x5b5dc3(0xfc)],'storage':_0x813df5[_0x5b5dc3(0xac)],'rack':_0x813df5[_0x5b5dc3(0xf1)],'bay':_0x813df5[_0x5b5dc3(0x177)],'bin':_0x813df5[_0x5b5dc3(0x13f)],'type':_0x813df5[_0x5b5dc3(0xba)],'floorlevel':_0x813df5[_0x5b5dc3(0x101)],'maxProducts':_0x813df5['maxStocks'],'unit':_0x813df5[_0x5b5dc3(0xa0)],'secondary_unit':_0x813df5['secondary_unit'],'expiry_date':_0x813df5['expiry_date']}));}),await _0x472faa[_0x3bf728(0x117)]();const _0x201ffa=await purchases[_0x3bf728(0xef)]({'invoice':_0x3d37ff});_0x201ffa[_0x3bf728(0x185)]=_0x3bf728(0x17c);const _0x41d52e=await _0x201ffa[_0x3bf728(0x117)](),_0x17a16b=new s_payment_data({'invoice':_0x3d37ff,'suppliers':_0x11f951['body']['suppliers'],'reason':_0x3bf728(0x14d)});await _0x17a16b[_0x3bf728(0x117)]();const _0x2b4d62=await master_shop[_0x3bf728(0x194)]();console[_0x3bf728(0xd9)]('add\x20post',_0x2b4d62[0x0][_0x3bf728(0x122)]);const _0x5abb2d=await email_settings[_0x3bf728(0xef)](),_0x14ef05=await suppliers[_0x3bf728(0xef)]({'name':_0x11f951[_0x3bf728(0xcd)][_0x3bf728(0x120)]});console['log'](_0x3bf728(0x1aa),_0x14ef05);_0x2b4d62[0x0]['currency_placement']==0x1?(right_currency=_0x2b4d62[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x2b4d62[0x0][_0x3bf728(0x14c)]);var _0x3cb3d5=_0x4ef85f,_0x34ec0a=_0x32dc76,_0x864d67='',_0x5aa23d;for(_0x5aa23d in _0x3cb3d5){_0x864d67+=_0x3bf728(0xe8)+_0x3bf728(0x13a)+_0x3cb3d5[_0x5aa23d]+_0x3bf728(0xbd)+_0x3bf728(0x13a)+_0x34ec0a[_0x5aa23d]+_0x3bf728(0xbd)+_0x3bf728(0xd3);}console[_0x3bf728(0xd9)](_0x3bf728(0x119),_0x864d67);let _0x2da8f9=nodemailer['createTransport']({'service':_0x3bf728(0x179),'auth':{'user':_0x5abb2d[_0x3bf728(0x124)],'pass':_0x5abb2d[_0x3bf728(0x155)]}}),_0x3581fc={'from':_0x5abb2d[_0x3bf728(0x124)],'to':_0x14ef05[_0x3bf728(0x124)],'subject':_0x3bf728(0x15d),'attachments':[{'filename':_0x3bf728(0x111),'path':__dirname+_0x3bf728(0x178)+'/upload/'+_0x2b4d62[0x0][_0x3bf728(0x122)],'cid':_0x3bf728(0x16b)}],'html':_0x3bf728(0x193)+'<html><head><title></title>'+_0x3bf728(0xb6)+_0x3bf728(0xa8)+_0x3bf728(0x183)+_0x3bf728(0xa8)+_0x3bf728(0x11a)+_0x3bf728(0xee)+_0x3bf728(0xa8)+'<h2>\x20'+_0x2b4d62[0x0][_0x3bf728(0xd7)]+'\x20</h2>'+_0x3bf728(0xee)+_0x3bf728(0xee)+'<hr\x20class=\x22my-3\x22>'+_0x3bf728(0xa8)+_0x3bf728(0x145)+'\x20Order\x20Number\x20:\x20'+_0x3d37ff+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x4558ca+'\x20'+_0x3bf728(0x17d)+'</h5>'+'</div>'+_0x3bf728(0x16e)+_0x3bf728(0x102)+_0x3bf728(0xe8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x3bf728(0xc5)+_0x3bf728(0xd5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3bf728(0xd3)+'</thead>'+_0x3bf728(0xbb)+'\x20'+_0x864d67+'\x20'+_0x3bf728(0x197)+_0x3bf728(0x161)+_0x3bf728(0xa8)+'<strong>\x20Regards\x20</strong>'+_0x3bf728(0x11d)+_0x2b4d62[0x0]['site_title']+_0x3bf728(0xf8)+_0x3bf728(0xee)+'</div>'+'</body></html>'};_0x2da8f9['sendMail'](_0x3581fc,function(_0x438c80,_0x464e23){var _0x2d6010=_0x3bf728;_0x438c80?(console[_0x2d6010(0xd9)](_0x438c80),console[_0x2d6010(0xd9)]('Error\x20Occurs')):console[_0x2d6010(0xd9)](_0x2d6010(0x175));}),_0x11f951[_0x3bf728(0xe1)](_0x3bf728(0xf9),'purchases\x20item\x20return\x20successfull'),_0x448104['redirect'](_0x3bf728(0x104));}catch(_0x6b5180){console['log'](_0x6b5180),_0x448104['status'](0xc8)['json']({'message':_0x6b5180[_0x3bf728(0x1b5)]});}}),router[a0_0x2252df(0x196)](a0_0x2252df(0x1a9),auth,async(_0x38468e,_0x24dd2d)=>{var _0x24b318=a0_0x2252df;try{const {username:_0x191fb6,email:_0x3675b1,role:_0x434209}=_0x38468e[_0x24b318(0xc8)],_0x177f75=_0x38468e[_0x24b318(0xc8)],_0x9f54f8=await profile['findOne']({'email':_0x177f75['email']}),_0x4712f2=await master_shop[_0x24b318(0x194)](),_0x7dcd47=_0x38468e[_0x24b318(0x18b)]['id'],_0x405d9c=await purchases[_0x24b318(0x125)](_0x7dcd47);if(_0x4712f2[0x0][_0x24b318(0x152)]==_0x24b318(0x98))var _0x591049=users[_0x24b318(0xad)];else{if(_0x4712f2[0x0]['language']==_0x24b318(0x176))var _0x591049=users[_0x24b318(0x176)];else{if(_0x4712f2[0x0][_0x24b318(0x152)]==_0x24b318(0xa3))var _0x591049=users[_0x24b318(0xa3)];else{if(_0x4712f2[0x0]['language']==_0x24b318(0x164))var _0x591049=users[_0x24b318(0x164)];else{if(_0x4712f2[0x0][_0x24b318(0x152)]==_0x24b318(0xd2))var _0x591049=users[_0x24b318(0xd2)];else{if(_0x4712f2[0x0][_0x24b318(0x152)]==_0x24b318(0x159))var _0x591049=users[_0x24b318(0xaa)];else{if(_0x4712f2[0x0][_0x24b318(0x152)]==_0x24b318(0x137))var _0x591049=users['Chinese'];else{if(_0x4712f2[0x0][_0x24b318(0x152)]=='Arabic\x20(ae)')var _0x591049=users[_0x24b318(0x16f)];}}}}}}}_0x24dd2d[_0x24b318(0xf7)]('all_purchases_barcode',{'success':_0x38468e[_0x24b318(0xe1)]('success'),'errors':_0x38468e[_0x24b318(0xe1)](_0x24b318(0xc9)),'role':_0x177f75,'profile':_0x9f54f8,'alldata':_0x405d9c,'master_shop':_0x4712f2,'language':_0x591049}),console[_0x24b318(0xd9)](alldata);}catch(_0x3c4b45){console['log'](_0x3c4b45);}}),router['post'](a0_0x2252df(0x13d),async(_0x26f2e1,_0x19b9b2)=>{var _0x25aee0=a0_0x2252df;const {product_code:_0x4bfba3}=_0x26f2e1[_0x25aee0(0xcd)];var _0x54f843;const _0x415945=await product[_0x25aee0(0xb8)]([{'$match':{'primary_code':_0x4bfba3,'product_category':_0x25aee0(0x96)}},{'$group':{'_id':_0x25aee0(0x160),'name':{'$first':_0x25aee0(0x109)},'category':{'$first':_0x25aee0(0xc3)},'brand':{'$first':_0x25aee0(0x1ae)},'unit':{'$first':_0x25aee0(0x13b)},'alertquantity':{'$first':_0x25aee0(0x167)},'product_code':{'$first':_0x25aee0(0xb4)},'primary_code':{'$first':_0x25aee0(0x12e)},'secondary_code':{'$first':_0x25aee0(0x18c)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x25aee0(0x100)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xd83bd8=await product[_0x25aee0(0xb8)]([{'$match':{'secondary_code':_0x4bfba3,'product_category':_0x25aee0(0x96)}},{'$group':{'_id':_0x25aee0(0x160),'name':{'$first':_0x25aee0(0x109)},'category':{'$first':_0x25aee0(0xc3)},'brand':{'$first':_0x25aee0(0x1ae)},'unit':{'$first':_0x25aee0(0x13b)},'alertquantity':{'$first':_0x25aee0(0x167)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x25aee0(0x12e)},'secondary_code':{'$first':_0x25aee0(0x18c)},'maxStocks':{'$first':_0x25aee0(0x12d)},'maxProdPerUnit':{'$first':_0x25aee0(0x1b6)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x25aee0(0x100)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x415945[_0x25aee0(0xcb)]>0x0)_0x54f843=_0x415945;else _0xd83bd8[_0x25aee0(0xcb)]>0x0&&(_0x54f843=_0xd83bd8);_0x19b9b2[_0x25aee0(0xe5)](_0x54f843);}),router[a0_0x2252df(0xb0)](a0_0x2252df(0x15b),async(_0x274a2d,_0x1a546d)=>{var _0x5ae62e=a0_0x2252df;const {primaryCode:_0x51e98c,secondaryCode:_0x521ae2,productCode:_0x43407a,bay:_0x1c226d,bin:_0x3a8b36,types:_0x374a51,pallet:_0x5d3f16,warehouses:_0x29f34b,room:_0x28febc}=_0x274a2d[_0x5ae62e(0xcd)];console[_0x5ae62e(0xd9)](_0x274a2d[_0x5ae62e(0xcd)]);try{const _0x43d578=await warehouse[_0x5ae62e(0xb8)]([{'$match':{'name':_0x29f34b,'room':_0x28febc}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x1c226d,'product_details.bin':_0x3a8b36,'product_details.type':_0x374a51}},{'$group':{'_id':_0x5ae62e(0xd6),'name':{'$first':_0x5ae62e(0xc4)},'product_stock':{'$first':_0x5ae62e(0x170)},'level':{'$first':_0x5ae62e(0x162)},'isle':{'$first':_0x5ae62e(0xfd)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1a546d['status'](0xc8)[_0x5ae62e(0xe5)](_0x43d578);}catch(_0x24fbd7){_0x1a546d[_0x5ae62e(0xe0)](0x194)['json']({'message':_0x24fbd7[_0x5ae62e(0x1b5)]});}}),module['exports']=router;