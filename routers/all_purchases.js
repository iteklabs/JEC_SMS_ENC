var a0_0x4307a3=a0_0x156a;(function(_0x23c381,_0x4356a6){var _0x1fc0f8=a0_0x156a,_0xbb8d03=_0x23c381();while(!![]){try{var _0x1e7abf=parseInt(_0x1fc0f8(0x226))/0x1*(-parseInt(_0x1fc0f8(0x229))/0x2)+-parseInt(_0x1fc0f8(0x1a9))/0x3+parseInt(_0x1fc0f8(0x207))/0x4+parseInt(_0x1fc0f8(0x1a7))/0x5*(parseInt(_0x1fc0f8(0x268))/0x6)+-parseInt(_0x1fc0f8(0x29d))/0x7*(parseInt(_0x1fc0f8(0x2d1))/0x8)+-parseInt(_0x1fc0f8(0x1ce))/0x9*(-parseInt(_0x1fc0f8(0x295))/0xa)+-parseInt(_0x1fc0f8(0x2ce))/0xb*(-parseInt(_0x1fc0f8(0x258))/0xc);if(_0x1e7abf===_0x4356a6)break;else _0xbb8d03['push'](_0xbb8d03['shift']());}catch(_0x34bf4b){_0xbb8d03['push'](_0xbb8d03['shift']());}}}(a0_0x3a6e,0x4b11a));function a0_0x3a6e(){var _0x4c126=['$alertquantity','gmail','prod_Qty','Rack\x20F','$product_details.expiry_date','$warehouse_name','Logo.png','slice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_cat','stock_quantity','product_stock','redirect','<strong>\x20Regards\x20</strong>','Paid\x20For\x20Purchase','add_purchases\x20error','status','Error\x20Occurs','$product_details.rack','errors','/upload/','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Portuguese','user_id','json','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.storage','9153OVNJyI','language','Floor','warehouse','bay','error','path','due_amount','$product_details.floorlevel','$primary_code','max_product_unit','type','$secondary_unit','isle','image','getDate','$room','COLD\x20STORAGE','prod_invoice','/view/add_purchases/:id','payment\x20successfull','$product_details.bin','then','/invoice/:id','random','stocks','createTransport','Return\x20Goods','return_purchase','MaxStocks_data','$unit','\x20<>\x20','bin','$product_details.secondary_code','$expiry_date','Arabic\x20(ae)','standard_unit','../public/language/languages.json','rack','Arabic','product_name','suppliers_docs','Rack\x20C','$product_details.level','\x20<\x20wew\x20>\x20','level','$product.type','$batch_code','$paid_amount','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','message','Receiving\x20Area','return_data','$product_details._id','catch','forEach','1010840lwlWIk','$maxProdPerUnit','return_product','table\x20page','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.maxProducts','toString','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</body></html>','port','English','/barcode_scanner','English\x20(US)','all_purchases_barcode','log','warehouse_name','getFullYear','$product.floorlevel','Ambient','Rack\x20E','rak','expiry_date','render','prod_code','host','suppliers_data','DRY\x20STORAGE','findById','finalize','573853pwCyKg','<hr\x20class=\x22my-3\x22>','date','2rEWNzC','$secondary_code','currency_placement','master','$product.bin','</div>','$finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_code','JO_number','Level','\x20Order\x20Number\x20:\x20','prod_unit','purchase_invoice','$product_details.primary_code','room_name','suppliers','maxperunit','/view/return_purchase/:id','<tr>','role','Rack\x20A','/all_purchases/view','filter','$product.bay','invoice','add\x20post','express','Rack\x20D','$product_details.product_name','secondary_code','floor','logo','prod_secondunit','$suppliers','$product_details.pallet','RoomAssign','<h5>','quantity','primary_code','user','<!DOCTYPE\x20html>','Sales\x20Update\x20successfully','Rack\x20B','ejs','actual_qty','prod_isle','5256432LjHZoi','<span\x20style=\x22float:\x20right;\x22>','Room_name','nodemailer','POnumber','string','<html><head><title></title>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','alertQTY','note','abs','$due_amount','$product_details.product_stock','product','$brand','concat','6tOVkBa','success','password','delivery_date','prod_primunit','Hindi','production_date','</tbody>','length','maxStocks','French','purchases\x20item\x20return\x20successfull','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/view','stock_data','prod_name','\x20Order\x20Date\x20:\x20','$product','find','$product_details.isle','back','$product_details.product_code','</table>','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details','$maxStocks','sendMail','/../public','INC-','</td>','storage','RMSEmail','push','pallet','staff','</thead>','$suppliers_docs','Raw\x20Materials','types','body','</tr>','$category','Portuguese\x20(BR)','230gaUfcW','$product_details.type','prod_level','/preview/:id','secondary_code_hide','/view/:id','Email\x20sent\x20successfully','secondary_unit','582365ZckvrD','<tbody\x20style=\x22text-align:\x20center;\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_pallet','</h5>','map','getMonth','An\x20error\x20occurred.','$product_details.bay','<h5\x20style=\x22text-align:\x20left;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Enabled','/barcode/:id','return_qty','$return_data','edit_purchases','$name','/all_purchases/view/','product_code','Router','<div>','True','floorlevel','padStart','<h2>\x20','product_code_hide','prod_cat','email','/CheckingWarehouse','\x20</h2>','params','delivery_code','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','German','$invoice','flash','post','get','deliverycode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','save','$note','purchase_quantity','$date','Purchase\x20Mail','aggregate','Spanish','$_id','22bOlTEe','here','batch_code','56JSWglt','exports','currency','3043745JgtoFC','all_purchases','891666ACcRvg','prod_qty','product_details','Purchase\x20Return\x20Mail','site_title','/view/add_purchases','paid_amount','actual_uom','findOne','primary_code_hide'];a0_0x3a6e=function(){return _0x4c126;};return a0_0x3a6e();}const express=require(a0_0x4307a3(0x244)),app=express(),router=express[a0_0x4307a3(0x2b0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x4307a3(0x25b));function a0_0x156a(_0x28be07,_0x363ddc){var _0x3a6e58=a0_0x3a6e();return a0_0x156a=function(_0x156a67,_0x5d2ca5){_0x156a67=_0x156a67-0x1a5;var _0x8f3b98=_0x3a6e58[_0x156a67];return _0x8f3b98;},a0_0x156a(_0x28be07,_0x363ddc);}var ejs=require(a0_0x4307a3(0x255));const path=require(a0_0x4307a3(0x1d4)),users=require(a0_0x4307a3(0x1f3));router[a0_0x4307a3(0x2c3)](a0_0x4307a3(0x276),auth,async(_0x2488d3,_0x3cd463)=>{var _0x28e082=a0_0x4307a3;try{const {username:_0x2abba1,email:_0x656ac2,role:_0x1324cb}=_0x2488d3[_0x28e082(0x251)],_0x480539=_0x2488d3[_0x28e082(0x251)],_0x37d492=await profile[_0x28e082(0x1b1)]({'email':_0x480539['email']}),_0x21287e=await staff[_0x28e082(0x1b1)]({'email':_0x480539[_0x28e082(0x2b8)]});if(_0x480539[_0x28e082(0x23d)]==_0x28e082(0x28c)){const _0x1d8561=await staff[_0x28e082(0x1b1)]({'email':_0x480539[_0x28e082(0x2b8)]});}const _0x2960ef=await master_shop[_0x28e082(0x27b)]();let _0x6c291c;if(_0x480539[_0x28e082(0x23d)]==_0x28e082(0x28c)){const _0x2d260e=await staff['findOne']({'email':_0x480539[_0x28e082(0x2b8)]});_0x6c291c=await purchases[_0x28e082(0x2cb)]([{'$match':{'warehouse_name':_0x2d260e['warehouse']}},{'$lookup':{'from':_0x28e082(0x239),'localField':_0x28e082(0x239),'foreignField':'name','as':_0x28e082(0x1f7)}},{'$unwind':_0x28e082(0x28e)},{'$unwind':_0x28e082(0x27a)},{'$group':{'_id':'$_id','invoice':{'$first':_0x28e082(0x2c0)},'suppliers':{'$first':_0x28e082(0x24b)},'date':{'$first':_0x28e082(0x2c9)},'warehouse_name':{'$first':_0x28e082(0x1b8)},'room':{'$first':_0x28e082(0x1de)},'product':{'$push':'$product'},'note':{'$first':_0x28e082(0x2c7)},'paid_amount':{'$first':_0x28e082(0x1fe)},'due_amount':{'$first':_0x28e082(0x263)},'return_data':{'$first':_0x28e082(0x2ab)},'batch_code':{'$first':_0x28e082(0x1fd)},'expiry_date':{'$first':_0x28e082(0x1f0)},'suppliers_docs':{'$first':_0x28e082(0x28e)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x28e082(0x241)},'isle':{'$addToSet':_0x28e082(0x22d)},'type':{'$addToSet':_0x28e082(0x1fc)},'floorlevel':{'$addToSet':_0x28e082(0x21a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x6c291c=await purchases[_0x28e082(0x2cb)]([{'$lookup':{'from':_0x28e082(0x239),'localField':'suppliers','foreignField':'name','as':_0x28e082(0x1f7)}},{'$unwind':_0x28e082(0x28e)},{'$unwind':_0x28e082(0x27a)},{'$group':{'_id':'$_id','invoice':{'$first':_0x28e082(0x2c0)},'suppliers':{'$first':_0x28e082(0x24b)},'date':{'$first':_0x28e082(0x2c9)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x28e082(0x27a)},'note':{'$first':_0x28e082(0x2c7)},'paid_amount':{'$first':_0x28e082(0x1fe)},'due_amount':{'$first':_0x28e082(0x263)},'return_data':{'$first':_0x28e082(0x2ab)},'batch_code':{'$first':_0x28e082(0x1fd)},'expiry_date':{'$first':_0x28e082(0x1f0)},'suppliers_docs':{'$first':_0x28e082(0x28e)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x28e082(0x241)},'isle':{'$addToSet':_0x28e082(0x22d)},'type':{'$addToSet':_0x28e082(0x1fc)},'floorlevel':{'$addToSet':_0x28e082(0x21a)},'finalize':{'$first':_0x28e082(0x22f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2960ef[0x0][_0x28e082(0x1cf)]=='English\x20(US)'){var _0x57b398=users['English'];console[_0x28e082(0x217)](_0x57b398);}else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]==_0x28e082(0x26d))var _0x57b398=users[_0x28e082(0x26d)];else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]==_0x28e082(0x2bf))var _0x57b398=users[_0x28e082(0x2bf)];else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]==_0x28e082(0x2cc))var _0x57b398=users[_0x28e082(0x2cc)];else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]=='French')var _0x57b398=users[_0x28e082(0x272)];else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]==_0x28e082(0x294))var _0x57b398=users[_0x28e082(0x1c9)];else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]=='Chinese')var _0x57b398=users[_0x28e082(0x20b)];else{if(_0x2960ef[0x0][_0x28e082(0x1cf)]==_0x28e082(0x1f1))var _0x57b398=users[_0x28e082(0x1f5)];}}}}}}}_0x3cd463['render'](_0x28e082(0x1a8),{'success':_0x2488d3[_0x28e082(0x2c1)](_0x28e082(0x269)),'errors':_0x2488d3[_0x28e082(0x2c1)](_0x28e082(0x1c6)),'purchases':_0x6c291c,'role':_0x480539,'profile':_0x37d492,'master_shop':_0x2960ef,'language':_0x57b398});}catch(_0x347d13){console[_0x28e082(0x217)](_0x28e082(0x20a),_0x347d13),_0x3cd463['status'](0xc8)[_0x28e082(0x1cb)]({'message':_0x347d13[_0x28e082(0x201)]});}});function BayBinSelected(_0x136f1e,_0x29deb2){var _0x5f1f33=a0_0x4307a3,_0x61e339=[],_0x1f46a0=[],_0xdfd0c0=[],_0x3420b1=[],_0x980bec=[],_0x17fe39=[];let _0x834718=[];if(_0x136f1e==_0x5f1f33(0x223))switch(_0x29deb2){case _0x5f1f33(0x23e):_0x61e339=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1f46a0=[0x1,0x2],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233),'Floor'],_0x980bec=['D'],_0x17fe39=['A'];break;case'Rack\x20B':_0x61e339=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1f46a0=[0x1,0x2],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233),_0x5f1f33(0x1d0)],_0x980bec=['D'],_0x17fe39=['B'];break;case _0x5f1f33(0x274):_0x61e339=[0x0],_0x1f46a0=[0x0],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x1d0)],_0x980bec=['D'],_0x17fe39=['S'];break;case _0x5f1f33(0x202):_0x61e339=[0x0],_0x1f46a0=[0x0],_0x3420b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xdfd0c0=[_0x5f1f33(0x1d0)],_0x980bec=['D'],_0x17fe39=['R'];break;}else{if(_0x136f1e==_0x5f1f33(0x1df))switch(_0x29deb2){case _0x5f1f33(0x23e):_0x61e339=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1f46a0=['B','F'],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233),_0x5f1f33(0x1d0)],_0x980bec=['C'],_0x17fe39=['A'];break;case _0x5f1f33(0x254):_0x61e339=[0x5,0x4,0x3,0x2,0x1],_0x1f46a0=['F','B','S'],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233),_0x5f1f33(0x1d0)],_0x980bec=['C'],_0x17fe39=['B'];break;case _0x5f1f33(0x1f8):_0x61e339=[0x1,0x2,0x3,0x4,0x5],_0x1f46a0=['B','F','S'],_0x3420b1=[0x5,0x4,0x3,0x2,0x1],_0xdfd0c0=[_0x5f1f33(0x233),_0x5f1f33(0x1d0)],_0x980bec=['C'],_0x17fe39=['C'];break;case _0x5f1f33(0x245):_0x61e339=[0x5,0x4,0x3,0x2,0x1],_0x1f46a0=['F','B','S'],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233),_0x5f1f33(0x1d0)],_0x980bec=['C'],_0x17fe39=['D'];break;case _0x5f1f33(0x21c):_0x61e339=[0x4,0x3,0x2,0x1],_0x1f46a0=[0x1,0x2],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233),_0x5f1f33(0x1d0)],_0x980bec=['C'],_0x17fe39=['E'];break;case _0x5f1f33(0x1b6):_0x61e339=[0x1,0x2,0x3],_0x1f46a0=[0x1,0x2],_0x3420b1=[0x1,0x2,0x3,0x4,0x5],_0xdfd0c0=[_0x5f1f33(0x233)],_0x980bec=['C'],_0x17fe39=['F'];break;}}return{'levels':_0x61e339,'Isle':_0x1f46a0,'rack':_0x3420b1,'type':_0xdfd0c0,'storage':_0x980bec,'rak':_0x17fe39};}async function getRandom8DigitNumber(){var _0x26834a=a0_0x4307a3;const _0x53f597=0x989680,_0x2805d2=0x5f5e0ff,_0xcf871b=Math[_0x26834a(0x248)](Math[_0x26834a(0x1e6)]()*(_0x2805d2-_0x53f597+0x1))+_0x53f597;var _0x10adf0;const _0xcd8181=await purchases[_0x26834a(0x1b1)]({'invoice':_0x26834a(0x286)+_0xcf871b});return _0xcd8181&&_0xcd8181[_0x26834a(0x270)]>0x0?_0x10adf0='INC-'+_0xcf871b:_0x10adf0=_0x26834a(0x286)+_0xcf871b,_0x10adf0;}router[a0_0x4307a3(0x2c3)]('/view/add_purchases',auth,async(_0x4955d9,_0x20988d)=>{var _0x25498b=a0_0x4307a3;try{const {username:_0x115b47,email:_0x2b07b2,role:_0x21d56f}=_0x4955d9[_0x25498b(0x251)],_0x63e458=_0x4955d9[_0x25498b(0x251)],_0x2bdf87=await profile[_0x25498b(0x1b1)]({'email':_0x63e458['email']}),_0x1d4839=await master_shop[_0x25498b(0x27b)](),_0x173a77=await staff[_0x25498b(0x1b1)]({'email':_0x63e458[_0x25498b(0x2b8)]}),_0x3aad06=await suppliers[_0x25498b(0x27b)]({});let _0x3cdab0;if(_0x63e458['role']==_0x25498b(0x28c)){const _0xc43968=await staff['findOne']({'email':_0x63e458['email']});_0x3cdab0=await warehouse[_0x25498b(0x2cb)]([{'$match':{'status':_0x25498b(0x2a8),'name':_0xc43968['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x25498b(0x1e9)}}},{'$group':{'_id':_0x25498b(0x2ad),'name':{'$first':_0x25498b(0x2ad)}}}]);}else _0x3cdab0=await warehouse[_0x25498b(0x2cb)]([{'$match':{'status':_0x25498b(0x2a8),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x25498b(0x1e9)}}},{'$group':{'_id':'$name','name':{'$first':_0x25498b(0x2ad)}}}]);const _0x5d6172=await product[_0x25498b(0x27b)]({}),_0x559129=await warehouse['find']({'status':_0x25498b(0x2a8)}),_0x473b5b=await purchases[_0x25498b(0x27b)]({}),_0x2f697f=_0x473b5b[_0x25498b(0x270)]+0x1,_0x18ece0=_0x25498b(0x286)+_0x2f697f[_0x25498b(0x20e)]()[_0x25498b(0x2b4)](0x5,'0');var _0x1a9388=[_0x25498b(0x21b),_0x25498b(0x2bd)];if(_0x1d4839[0x0][_0x25498b(0x1cf)]==_0x25498b(0x215))var _0x30cadf=users[_0x25498b(0x213)];else{if(_0x1d4839[0x0][_0x25498b(0x1cf)]==_0x25498b(0x26d))var _0x30cadf=users[_0x25498b(0x26d)];else{if(_0x1d4839[0x0]['language']==_0x25498b(0x2bf))var _0x30cadf=users[_0x25498b(0x2bf)];else{if(_0x1d4839[0x0][_0x25498b(0x1cf)]==_0x25498b(0x2cc))var _0x30cadf=users[_0x25498b(0x2cc)];else{if(_0x1d4839[0x0][_0x25498b(0x1cf)]==_0x25498b(0x272))var _0x30cadf=users[_0x25498b(0x272)];else{if(_0x1d4839[0x0]['language']==_0x25498b(0x294))var _0x30cadf=users[_0x25498b(0x1c9)];else{if(_0x1d4839[0x0]['language']==_0x25498b(0x20b))var _0x30cadf=users['Chinese'];else{if(_0x1d4839[0x0][_0x25498b(0x1cf)]==_0x25498b(0x1f1))var _0x30cadf=users[_0x25498b(0x1f5)];}}}}}}}const _0x37c1a3=getRandom8DigitNumber();_0x37c1a3[_0x25498b(0x1e4)](_0x339de3=>{var _0x18b585=_0x25498b;_0x20988d[_0x18b585(0x21f)]('add_purchases',{'success':_0x4955d9[_0x18b585(0x2c1)](_0x18b585(0x269)),'errors':_0x4955d9[_0x18b585(0x2c1)]('errors'),'role':_0x63e458,'profile':_0x2bdf87,'suppliers':_0x3aad06,'warehouse':_0x3cdab0,'product':_0x5d6172,'invoice':_0x339de3,'master_shop':_0x1d4839,'language':_0x30cadf,'find_data':_0x559129,'rooms_data':_0x1a9388});})[_0x25498b(0x205)](_0x4c3161=>{var _0x6d2ccf=_0x25498b;_0x4955d9[_0x6d2ccf(0x2c1)](_0x6d2ccf(0x1c6),_0x6d2ccf(0x1bb)),_0x20988d[_0x6d2ccf(0x1bf)](_0x6d2ccf(0x23f));});}catch(_0x1ca4de){console[_0x25498b(0x217)](_0x1ca4de);}}),router['get'](a0_0x4307a3(0x1e1),auth,async(_0x51e796,_0xfe17bd)=>{var _0x380ff0=a0_0x4307a3;try{const _0xa0165b=_0x51e796['params']['id'];console[_0x380ff0(0x217)](_0xa0165b);const _0xa5ba2a=await master_shop[_0x380ff0(0x27b)]();console[_0x380ff0(0x217)](_0x380ff0(0x22c),_0xa5ba2a);const _0x206dc0=await product[_0x380ff0(0x1b1)]({'name':_0xa0165b});console[_0x380ff0(0x217)](_0x380ff0(0x265),_0x206dc0),_0xfe17bd[_0x380ff0(0x1c3)](0xc8)[_0x380ff0(0x1cb)]({'product_data':_0x206dc0,'master':_0xa5ba2a});}catch(_0x279cb0){console[_0x380ff0(0x217)](_0x380ff0(0x1c2),_0x279cb0);}}),router[a0_0x4307a3(0x2c2)](a0_0x4307a3(0x1ae),auth,async(_0x33a1ed,_0x1d0a5e)=>{var _0x172312=a0_0x4307a3;try{const {invoice:_0x565eef,date:_0x28b5ac,warehouse_name:_0x12f8b3,prod_name:_0x38bee5,prod_code:_0x5d2706,prod_qty:_0x5eb873,prod_unit:_0x344846,prod_secondunit:_0x466d03,prod_level:_0x477205,prod_isle:_0x402d03,prod_pallet:_0x30a954,note:_0x45a7fa,expiry_date:_0x3248f7,batch_code:_0x9199e1,payable:_0x760c48,due_amount:_0x5e3826,Room_name:_0x236c22,primary_code:_0x5bc4f2,secondary_code:_0x20e33b,MaxStocks_data:_0x2b599e,PO_number:_0x1f1418,SCRN:_0x442ea8,JO_number:_0x5596aa}=_0x33a1ed[_0x172312(0x291)];if(typeof _0x38bee5==_0x172312(0x25d))var _0x2ae878=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x278)]],_0x1bc5e5=[_0x33a1ed['body'][_0x172312(0x220)]],_0x45981d=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x1b5)]],_0x5bb358=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x26c)]],_0x6d9428=[_0x33a1ed['body'][_0x172312(0x24a)]],_0x2961cf=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x297)]],_0xf7cfdf=[_0x33a1ed['body'][_0x172312(0x250)]],_0x32749d=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x247)]],_0x3659fd=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x1eb)]],_0x1cfce7=[_0x33a1ed[_0x172312(0x291)]['batch_code']],_0x2fac28=[_0x33a1ed['body']['expiry_date']],_0x560bd2=[_0x33a1ed[_0x172312(0x291)]['max_product_unit']],_0x1acf0e=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x260)]],_0x1df8fa=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x26e)]],_0x586e72=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x2b7)]],_0x544169=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x24d)]],_0xc15894=[_0x33a1ed[_0x172312(0x291)]['deliverycode']],_0x23180f=[_0x33a1ed[_0x172312(0x291)]['prod_invoice']],_0x52c2c1=[_0x33a1ed[_0x172312(0x291)][_0x172312(0x256)]],_0x3a121c=[_0x33a1ed['body'][_0x172312(0x1b0)]];else var _0x2ae878=[..._0x33a1ed['body']['prod_name']],_0x1bc5e5=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x220)]],_0x45981d=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x1b5)]],_0x5bb358=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x26c)]],_0x6d9428=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x24a)]],_0x2961cf=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x297)]],_0xf7cfdf=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x250)]],_0x32749d=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x247)]],_0x3659fd=[..._0x33a1ed['body'][_0x172312(0x1eb)]],_0x1cfce7=[..._0x33a1ed['body'][_0x172312(0x2d0)]],_0x2fac28=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x21e)]],_0x560bd2=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x1d8)]],_0x1acf0e=[..._0x33a1ed['body'][_0x172312(0x260)]],_0x1df8fa=[..._0x33a1ed['body'][_0x172312(0x26e)]],_0x586e72=[..._0x33a1ed['body']['prod_cat']],_0x544169=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x24d)]],_0xc15894=[..._0x33a1ed['body'][_0x172312(0x2c4)]],_0x23180f=[..._0x33a1ed[_0x172312(0x291)][_0x172312(0x1e0)]],_0x52c2c1=[..._0x33a1ed['body'][_0x172312(0x256)]],_0x3a121c=[..._0x33a1ed[_0x172312(0x291)]['actual_uom']];const _0x57992c=_0x2ae878[_0x172312(0x2a2)](_0x187451=>{return _0x187451={'product_name':_0x187451};});_0x52c2c1[_0x172312(0x206)]((_0x5d872f,_0x1b38c3)=>{var _0x495001=_0x172312;_0x57992c[_0x1b38c3][_0x495001(0x256)]=Math[_0x495001(0x262)](_0x5d872f);}),_0x3a121c[_0x172312(0x206)]((_0x47efb9,_0x2609e5)=>{var _0x348aa1=_0x172312;_0x57992c[_0x2609e5][_0x348aa1(0x1b0)]=_0x47efb9;}),_0x1bc5e5[_0x172312(0x206)]((_0x2ce415,_0x164a55)=>{var _0x199480=_0x172312;_0x57992c[_0x164a55][_0x199480(0x2af)]=_0x2ce415;}),_0x45981d['forEach']((_0x3582dd,_0x44a064)=>{var _0x4f7c59=_0x172312;_0x57992c[_0x44a064][_0x4f7c59(0x24f)]=Math[_0x4f7c59(0x262)](_0x3582dd);}),_0x5bb358[_0x172312(0x206)]((_0x71aa92,_0x37e858)=>{var _0x4bb3aa=_0x172312;_0x57992c[_0x37e858][_0x4bb3aa(0x1f2)]=_0x71aa92;}),_0x6d9428[_0x172312(0x206)]((_0x182766,_0x2c65b9)=>{var _0x19e1c0=_0x172312;_0x57992c[_0x2c65b9][_0x19e1c0(0x29c)]=_0x182766;}),_0x2961cf[_0x172312(0x206)]((_0x2817f5,_0xfb07ac)=>{_0x544169['forEach']((_0x4b024,_0x535e20)=>{var _0x266f95=a0_0x156a;if(_0x4b024==_0x266f95(0x202)&&_0xfb07ac==_0x535e20){console[_0x266f95(0x217)](_0x4b024+_0x266f95(0x1fa)+_0xfb07ac+_0x266f95(0x1ed)+_0x535e20+_0x266f95(0x1ed)+_0x2817f5);var _0x10351b=_0x2817f5[_0x266f95(0x1ba)](0x3);_0x57992c[_0xfb07ac][_0x266f95(0x288)]=_0x2817f5[0x0],_0x57992c[_0xfb07ac][_0x266f95(0x1f4)]=_0x2817f5[0x1],_0x57992c[_0xfb07ac][_0x266f95(0x1d2)]=0x0,_0x57992c[_0xfb07ac][_0x266f95(0x1ee)]=0x0,_0x57992c[_0xfb07ac]['type']=_0x266f95(0x1d0),_0x57992c[_0xfb07ac][_0x266f95(0x2b3)]=_0x10351b;}else{if(_0x4b024==_0x266f95(0x274)&&_0xfb07ac==_0x535e20){var _0x10351b=_0x2817f5[_0x266f95(0x1ba)](0x3);_0x57992c[_0xfb07ac][_0x266f95(0x288)]=_0x2817f5[0x0],_0x57992c[_0xfb07ac][_0x266f95(0x1f4)]=_0x2817f5[0x1],_0x57992c[_0xfb07ac]['bay']=0x0,_0x57992c[_0xfb07ac][_0x266f95(0x1ee)]=0x0,_0x57992c[_0xfb07ac][_0x266f95(0x1d9)]=_0x266f95(0x1d0),_0x57992c[_0xfb07ac]['floorlevel']=_0x2817f5[0x5];}else{if(_0xfb07ac==_0x535e20){if(_0x2817f5[0x0]=='A'&&_0x2817f5[0x1]=='L'&&_0x2817f5[0x2]=='L')console[_0x266f95(0x217)](_0x4b024+_0x266f95(0x1ed)+_0xfb07ac+_0x266f95(0x1ed)+_0x535e20+'\x20<>\x20'+_0x2817f5+_0x266f95(0x2cf)),_0x57992c[_0xfb07ac][_0x266f95(0x288)]=_0x2817f5[0x0],_0x57992c[_0xfb07ac]['rack']=_0x2817f5[0x1],_0x57992c[_0xfb07ac][_0x266f95(0x1d2)]=0x0,_0x57992c[_0xfb07ac][_0x266f95(0x1ee)]=0x0,_0x57992c[_0xfb07ac][_0x266f95(0x1d9)]=_0x266f95(0x1d0),_0x57992c[_0xfb07ac][_0x266f95(0x2b3)]=_0x2817f5[0x3];else{var _0x56acac;if(_0x2817f5[0x4]=='L')_0x56acac=_0x266f95(0x233);else _0x2817f5[0x4]=='F'&&(_0x56acac='Floor');_0x57992c[_0xfb07ac][_0x266f95(0x288)]=_0x2817f5[0x0],_0x57992c[_0xfb07ac]['rack']=_0x2817f5[0x1],_0x57992c[_0xfb07ac][_0x266f95(0x1d2)]=_0x2817f5[0x2],_0x57992c[_0xfb07ac]['bin']=_0x2817f5[0x3],_0x57992c[_0xfb07ac][_0x266f95(0x1d9)]=_0x56acac,_0x57992c[_0xfb07ac][_0x266f95(0x2b3)]=_0x2817f5[0x5];}}}}});}),_0xf7cfdf[_0x172312(0x206)]((_0x25bbf8,_0xa56f37)=>{_0x57992c[_0xa56f37]['primary_code']=_0x25bbf8;}),_0x32749d[_0x172312(0x206)]((_0x4f7dec,_0x2f4f6e)=>{var _0x9641ec=_0x172312;_0x57992c[_0x2f4f6e][_0x9641ec(0x247)]=_0x4f7dec;}),_0x3659fd[_0x172312(0x206)]((_0x171e45,_0x2e8c9a)=>{var _0x1c14e6=_0x172312;_0x57992c[_0x2e8c9a][_0x1c14e6(0x271)]=_0x171e45;}),_0x1cfce7['forEach']((_0x7b97f0,_0x424eb9)=>{var _0x5a1039=_0x172312;_0x57992c[_0x424eb9][_0x5a1039(0x2d0)]=_0x7b97f0;}),_0x2fac28[_0x172312(0x206)]((_0x62430b,_0x4801e9)=>{_0x57992c[_0x4801e9]['expiry_date']=_0x62430b;}),_0x560bd2[_0x172312(0x206)]((_0x5e952f,_0x3f39dd)=>{var _0x559739=_0x172312;_0x57992c[_0x3f39dd][_0x559739(0x23a)]=_0x5e952f;}),_0x1acf0e['forEach']((_0x342742,_0x1b3c11)=>{_0x57992c[_0x1b3c11]['alertQTY']=_0x342742;}),_0x1df8fa['forEach']((_0x5cb76d,_0x1decd7)=>{var _0x5d651d=_0x172312;_0x57992c[_0x1decd7][_0x5d651d(0x26e)]=_0x5cb76d;}),_0x586e72[_0x172312(0x206)]((_0x2dcd7d,_0x46bd8a)=>{var _0x2bc965=_0x172312;_0x57992c[_0x46bd8a][_0x2bc965(0x1bc)]=_0x2dcd7d;}),_0x544169['forEach']((_0x41e20d,_0x10210b)=>{_0x57992c[_0x10210b]['room_name']=_0x41e20d;}),_0xc15894[_0x172312(0x206)]((_0x1fa4c2,_0x3d4784)=>{var _0x235a35=_0x172312;_0x57992c[_0x3d4784][_0x235a35(0x2bc)]=_0x1fa4c2;}),_0x23180f[_0x172312(0x206)]((_0x1f7641,_0x5ee33e)=>{var _0x37c17b=_0x172312;_0x57992c[_0x5ee33e][_0x37c17b(0x242)]=_0x1f7641;});const _0x33e90a=_0x544169['map'](_0x86f8d=>{return _0x86f8d={'room_name':_0x86f8d};}),_0x437d6f=_0x57992c[_0x172312(0x240)](_0x1ef24c=>_0x1ef24c[_0x172312(0x24f)]!=='0'&&_0x1ef24c[_0x172312(0x24f)]!==''),_0x3697be=new purchases({'invoice':_0x565eef,'suppliers':_0x33a1ed[_0x172312(0x291)]['suppliers'],'date':_0x28b5ac,'warehouse_name':_0x12f8b3,'product':_0x437d6f,'note':_0x45a7fa,'due_amount':_0x5e3826,'POnumber':_0x1f1418,'SCRN':_0x442ea8,'JO_number':_0x5596aa,'roomList':_0x33e90a}),_0x46a681=await _0x3697be['save'](),_0x250d75=await purchases[_0x172312(0x1b1)]({'invoice':_0x565eef}),_0x21c205=_0x250d75['product']['map'](async _0x18559e=>{var _0x5c3333=_0x172312,_0x5639a5=await warehouse['findOne']({'name':_0x12f8b3,'room':_0x18559e['room_name']}),_0x2887fa=0x0;return _0x5639a5[_0x5c3333(0x1ab)][_0x5c3333(0x206)](_0x530a35=>{var _0x4774e6=_0x5c3333;_0x530a35[_0x4774e6(0x1f6)]==_0x18559e['product_name']&&_0x530a35['floorlevel']==_0x18559e[_0x4774e6(0x2b3)]&&_0x530a35[_0x4774e6(0x1d9)]==_0x18559e[_0x4774e6(0x1d9)]&&_0x530a35[_0x4774e6(0x1ee)]==_0x18559e['bin']&&_0x530a35[_0x4774e6(0x1d2)]==_0x18559e['bay']&&_0x530a35[_0x4774e6(0x1f4)]==_0x18559e['rack']&&_0x530a35['storage']==_0x18559e['storage']&&_0x530a35[_0x4774e6(0x21e)]==_0x18559e[_0x4774e6(0x21e)]&&_0x530a35[_0x4774e6(0x2d0)]==_0x18559e['batch_code']&&_0x530a35[_0x4774e6(0x26e)]==_0x18559e[_0x4774e6(0x26e)]&&_0x530a35['invoice']==_0x250d75['invoice']&&(_0x530a35[_0x4774e6(0x1be)]+=Math['abs'](_0x18559e[_0x4774e6(0x24f)]),_0x2887fa++);}),_0x2887fa===0x0&&_0x5639a5['product_details'][_0x5c3333(0x28a)]({'product_name':_0x18559e['product_name'],'product_stock':Math[_0x5c3333(0x262)](_0x18559e[_0x5c3333(0x24f)]),'primary_code':_0x18559e['primary_code'],'secondary_code':_0x18559e['secondary_code'],'product_code':_0x18559e[_0x5c3333(0x2af)],'storage':_0x18559e['storage'],'rack':_0x18559e[_0x5c3333(0x1f4)],'bay':_0x18559e[_0x5c3333(0x1d2)],'bin':_0x18559e['bin'],'type':_0x18559e[_0x5c3333(0x1d9)],'floorlevel':_0x18559e[_0x5c3333(0x2b3)],'maxProducts':_0x18559e[_0x5c3333(0x271)],'unit':_0x18559e['standard_unit'],'secondary_unit':_0x18559e[_0x5c3333(0x29c)],'expiry_date':_0x18559e[_0x5c3333(0x21e)],'maxPerUnit':_0x18559e[_0x5c3333(0x23a)],'batch_code':_0x18559e['batch_code'],'alertQTY':_0x18559e[_0x5c3333(0x260)],'production_date':_0x18559e['production_date'],'product_cat':_0x18559e[_0x5c3333(0x1bc)],'invoice':_0x18559e[_0x5c3333(0x242)],'actual_qty':Math[_0x5c3333(0x262)](_0x18559e['actual_qty']),'actual_uom':_0x18559e[_0x5c3333(0x1b0)]}),_0x5639a5;});Promise['all'](_0x21c205)[_0x172312(0x1e4)](async _0x5b024c=>{var _0x497aaf=_0x172312;try{for(const _0x3ebba0 of _0x5b024c){await _0x3ebba0[_0x497aaf(0x2c6)]();}const _0x1ecee8=await master_shop[_0x497aaf(0x27b)](),_0xbdac0e=await email_settings[_0x497aaf(0x1b1)](),_0x45f510=await supervisor_settings[_0x497aaf(0x27b)]();var _0x5cb8a6=_0x250d75[_0x497aaf(0x265)],_0x99c1aa='',_0x421f80;for(_0x421f80 in _0x5cb8a6){_0x99c1aa+=_0x497aaf(0x23c)+_0x497aaf(0x29f)+_0x5cb8a6[_0x421f80][_0x497aaf(0x1f6)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5cb8a6[_0x421f80]['product_code']+_0x497aaf(0x287)+_0x497aaf(0x29f)+_0x5cb8a6[_0x421f80][_0x497aaf(0x24f)]+_0x497aaf(0x287)+_0x497aaf(0x29f)+_0x5cb8a6[_0x421f80][_0x497aaf(0x1f2)]+_0x497aaf(0x287)+_0x497aaf(0x29f)+_0x5cb8a6[_0x421f80][_0x497aaf(0x29c)]+_0x497aaf(0x287)+_0x497aaf(0x29f)+_0x250d75[_0x497aaf(0x218)]+_0x497aaf(0x287)+_0x497aaf(0x29f)+_0x5cb8a6[_0x421f80][_0x497aaf(0x238)]+_0x497aaf(0x287)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5cb8a6[_0x421f80][_0x497aaf(0x288)]+_0x5cb8a6[_0x421f80][_0x497aaf(0x1f4)]+_0x5cb8a6[_0x421f80]['bay']+_0x5cb8a6[_0x421f80][_0x497aaf(0x1ee)]+_0x5cb8a6[_0x421f80][_0x497aaf(0x1d9)][0x0]+_0x5cb8a6[_0x421f80][_0x497aaf(0x2b3)]+_0x497aaf(0x287),_0x497aaf(0x292);}let _0x3b56bf=nodemailer[_0x497aaf(0x1e8)]({'host':_0xbdac0e[_0x497aaf(0x221)],'port':Number(_0xbdac0e[_0x497aaf(0x212)]),'secure':![],'auth':{'user':_0xbdac0e[_0x497aaf(0x2b8)],'pass':_0xbdac0e['password']}}),_0x354524={'from':_0xbdac0e['email'],'to':_0x45f510[0x0][_0x497aaf(0x289)],'subject':_0x497aaf(0x2ca),'attachments':[{'filename':_0x497aaf(0x1b9),'path':__dirname+_0x497aaf(0x285)+'/upload/'+_0x1ecee8[0x0][_0x497aaf(0x1dc)],'cid':'logo'}],'html':_0x497aaf(0x252)+_0x497aaf(0x25e)+_0x497aaf(0x1ff)+'<div>'+_0x497aaf(0x1c8)+_0x497aaf(0x2b1)+_0x497aaf(0x2a7)+'</div>'+_0x497aaf(0x2b1)+_0x497aaf(0x2b5)+_0x1ecee8[0x0][_0x497aaf(0x1ad)]+_0x497aaf(0x2ba)+'</div>'+_0x497aaf(0x22e)+_0x497aaf(0x227)+_0x497aaf(0x2b1)+_0x497aaf(0x2a6)+_0x497aaf(0x234)+_0x250d75[_0x497aaf(0x242)]+'\x20'+_0x497aaf(0x259)+_0x497aaf(0x279)+_0x250d75[_0x497aaf(0x228)]+'\x20'+_0x497aaf(0x280)+_0x497aaf(0x2a1)+_0x497aaf(0x22e)+_0x497aaf(0x25f)+_0x497aaf(0x230)+'<tr>'+_0x497aaf(0x200)+_0x497aaf(0x2c5)+_0x497aaf(0x20c)+_0x497aaf(0x275)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x497aaf(0x2be)+_0x497aaf(0x292)+_0x497aaf(0x28d)+_0x497aaf(0x29e)+'\x20'+_0x99c1aa+'\x20'+_0x497aaf(0x26f)+_0x497aaf(0x27f)+_0x497aaf(0x2b1)+_0x497aaf(0x1c0)+_0x497aaf(0x24e)+_0x1ecee8[0x0][_0x497aaf(0x1ad)]+_0x497aaf(0x2a1)+_0x497aaf(0x22e)+'</div>'+'</body></html>'};_0x3b56bf[_0x497aaf(0x284)](_0x354524,function(_0x19bd9b,_0x571372){var _0x36a765=_0x497aaf;_0x19bd9b?(console[_0x36a765(0x217)](_0x19bd9b),console[_0x36a765(0x217)](_0x36a765(0x1c4))):console['log']('Email\x20sent\x20successfully');}),_0x33a1ed['flash'](_0x497aaf(0x269),'Purchase\x20data\x20added\x20successfully'),_0x1d0a5e['redirect'](_0x497aaf(0x2ae));}catch(_0x17e45d){console[_0x497aaf(0x1d3)](_0x17e45d),_0x1d0a5e[_0x497aaf(0x1c3)](0x1f4)[_0x497aaf(0x1cb)]({'error':_0x497aaf(0x1cc)});}})[_0x172312(0x205)](_0x468e6c=>{var _0x2f4b47=_0x172312;console[_0x2f4b47(0x1d3)](_0x468e6c),_0x1d0a5e['status'](0x1f4)[_0x2f4b47(0x1cb)]({'error':_0x2f4b47(0x2a4)});});}catch(_0xd00f12){console[_0x172312(0x217)](_0xd00f12);}}),router[a0_0x4307a3(0x2c3)]('/preview/:id',auth,async(_0x45ba39,_0x37d893)=>{var _0x3970b0=a0_0x4307a3;try{const {username:_0x4048f7,email:_0x347945,role:_0x2df645}=_0x45ba39[_0x3970b0(0x251)],_0x1c85ad=_0x45ba39[_0x3970b0(0x251)],_0x5ebae2=await profile['findOne']({'email':_0x1c85ad[_0x3970b0(0x2b8)]}),_0x369fde=await master_shop[_0x3970b0(0x27b)](),_0x89fe58=_0x45ba39[_0x3970b0(0x2bb)]['id'],_0x9db412=await purchases['findById'](_0x89fe58),_0x564904=await warehouse['aggregate']([{'$match':{'name':_0x9db412[_0x3970b0(0x218)],'room':_0x9db412[_0x3970b0(0x20f)]}},{'$unwind':_0x3970b0(0x282)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3970b0(0x246)},'product_stock':{'$first':_0x3970b0(0x264)},'bay':{'$first':_0x3970b0(0x2a5)},'bin':{'$first':_0x3970b0(0x1e3)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3970b0(0x1d6)},'primary_code':{'$first':_0x3970b0(0x237)},'secondary_code':{'$first':_0x3970b0(0x1ef)},'product_code':{'$first':_0x3970b0(0x27e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3970b0(0x1c5)},'expiry_date':{'$first':_0x3970b0(0x1b7)}}}]),_0x5dfba0=await customer[_0x3970b0(0x27b)]({});let _0x1ccc40;if(_0x1c85ad[_0x3970b0(0x23d)]=='staff'){const _0x24eb3d=await staff[_0x3970b0(0x1b1)]({'email':_0x1c85ad[_0x3970b0(0x2b8)]});_0x1ccc40=await warehouse['aggregate']([{'$match':{'status':_0x3970b0(0x2a8),'name':_0x24eb3d[_0x3970b0(0x1d1)]}},{'$group':{'_id':_0x3970b0(0x2ad),'name':{'$first':_0x3970b0(0x2ad)}}}]);}else _0x1ccc40=await warehouse['aggregate']([{'$match':{'status':_0x3970b0(0x2a8)}},{'$group':{'_id':'$name','name':{'$first':_0x3970b0(0x2ad)}}}]);const _0x13f6de=await product[_0x3970b0(0x27b)]({}),_0xfa58f7=await suppliers[_0x3970b0(0x27b)]({}),_0x14eea1=BayBinSelected(_0x9db412[_0x3970b0(0x218)],_0x9db412[_0x3970b0(0x20f)]);if(_0x369fde[0x0][_0x3970b0(0x1cf)]==_0x3970b0(0x215)){var _0x3003bc=users[_0x3970b0(0x213)];console[_0x3970b0(0x217)](_0x3003bc);}else{if(_0x369fde[0x0][_0x3970b0(0x1cf)]==_0x3970b0(0x26d))var _0x3003bc=users[_0x3970b0(0x26d)];else{if(_0x369fde[0x0]['language']=='German')var _0x3003bc=users['German'];else{if(_0x369fde[0x0][_0x3970b0(0x1cf)]==_0x3970b0(0x2cc))var _0x3003bc=users['Spanish'];else{if(_0x369fde[0x0][_0x3970b0(0x1cf)]==_0x3970b0(0x272))var _0x3003bc=users[_0x3970b0(0x272)];else{if(_0x369fde[0x0]['language']==_0x3970b0(0x294))var _0x3003bc=users[_0x3970b0(0x1c9)];else{if(_0x369fde[0x0]['language']==_0x3970b0(0x20b))var _0x3003bc=users[_0x3970b0(0x20b)];else{if(_0x369fde[0x0]['language']==_0x3970b0(0x1f1))var _0x3003bc=users[_0x3970b0(0x1f5)];}}}}}}}_0x37d893[_0x3970b0(0x21f)]('edit_purchases_view',{'success':_0x45ba39[_0x3970b0(0x2c1)](_0x3970b0(0x269)),'errors':_0x45ba39[_0x3970b0(0x2c1)](_0x3970b0(0x1c6)),'role':_0x1c85ad,'profile':_0x5ebae2,'customer':_0x5dfba0,'warehouse':_0x1ccc40,'product':_0x564904,'user':_0x9db412,'master_shop':_0x369fde,'unit':_0x13f6de,'language':_0x3003bc,'suppliers':_0xfa58f7,'dataSelected':_0x14eea1});}catch(_0x3d9b35){console[_0x3970b0(0x217)](_0x3d9b35);}}),router[a0_0x4307a3(0x2c2)](a0_0x4307a3(0x298),auth,async(_0x30cfc6,_0x7df50b)=>{var _0x10326f=a0_0x4307a3;try{const _0x45c563=_0x30cfc6[_0x10326f(0x2bb)]['id'],{invoice:_0x11a4d7,warehouse_name:_0x30c3c,Room_name:_0x15c614}=_0x30cfc6['body'],_0x2956a9=await warehouse[_0x10326f(0x1b1)]({'name':_0x30c3c,'room':_0x15c614}),_0x4096bf=await purchases['findOne']({'invoice':_0x11a4d7});_0x4096bf[_0x10326f(0x265)][_0x10326f(0x206)](_0x1381f0=>{var _0x340b77=_0x10326f,_0x16bccd=0x0;const _0x9388d8=_0x2956a9[_0x340b77(0x1ab)][_0x340b77(0x2a2)](_0x225156=>{var _0x58b412=_0x340b77;_0x225156[_0x58b412(0x1f6)]==_0x1381f0[_0x58b412(0x1f6)]&&_0x225156[_0x58b412(0x2b3)]==_0x1381f0['floorlevel']&&_0x225156[_0x58b412(0x1d9)]==_0x1381f0['type']&&_0x225156[_0x58b412(0x1ee)]==_0x1381f0['bin']&&_0x225156['bay']==_0x1381f0['bay']&&_0x225156['rack']==_0x1381f0['rack']&&_0x225156['storage']==_0x1381f0[_0x58b412(0x288)]&&_0x225156['expiry_date']==_0x1381f0['expiry_date']&&_0x225156[_0x58b412(0x2d0)]==_0x1381f0['batch_code']&&_0x225156['production_date']==_0x1381f0['production_date']&&_0x225156[_0x58b412(0x26b)]==_0x1381f0[_0x58b412(0x26b)]&&_0x225156[_0x58b412(0x2bc)]==_0x1381f0['delivery_code']&&(_0x225156[_0x58b412(0x1be)]=parseInt(_0x225156['product_stock'])+parseInt(_0x1381f0[_0x58b412(0x24f)]),_0x16bccd++);});_0x16bccd=='0'&&(_0x2956a9[_0x340b77(0x1ab)]=_0x2956a9[_0x340b77(0x1ab)]['concat']({'product_name':_0x1381f0[_0x340b77(0x1f6)],'product_stock':_0x1381f0[_0x340b77(0x24f)],'primary_code':_0x1381f0['primary_code'],'secondary_code':_0x1381f0[_0x340b77(0x247)],'product_code':_0x1381f0[_0x340b77(0x2af)],'storage':_0x1381f0['storage'],'rack':_0x1381f0[_0x340b77(0x1f4)],'bay':_0x1381f0['bay'],'bin':_0x1381f0[_0x340b77(0x1ee)],'type':_0x1381f0[_0x340b77(0x1d9)],'floorlevel':_0x1381f0[_0x340b77(0x2b3)],'maxProducts':_0x1381f0[_0x340b77(0x271)],'unit':_0x1381f0[_0x340b77(0x1f2)],'secondary_unit':_0x1381f0[_0x340b77(0x29c)],'expiry_date':_0x1381f0['expiry_date'],'maxPerUnit':_0x1381f0['maxperunit'],'batch_code':_0x1381f0[_0x340b77(0x2d0)],'alertQTY':_0x1381f0[_0x340b77(0x260)],'production_date':_0x1381f0[_0x340b77(0x26e)],'delivery_date':_0x1381f0['delivery_date'],'delivery_code':_0x1381f0['delivery_code']}));}),await _0x2956a9['save'](),_0x4096bf[_0x10326f(0x225)]=_0x10326f(0x2b2);const _0x4ff55a=await _0x4096bf[_0x10326f(0x2c6)]();_0x30cfc6[_0x10326f(0x2c1)](_0x10326f(0x269),_0x10326f(0x253)),_0x7df50b[_0x10326f(0x1bf)](_0x10326f(0x23f));}catch(_0x2c9062){console['log'](_0x2c9062);}}),router[a0_0x4307a3(0x2c3)](a0_0x4307a3(0x29a),auth,async(_0x3a7639,_0xe8e0a9)=>{var _0x340a6c=a0_0x4307a3;try{const {username:_0x5628d,email:_0x3d429b,role:_0xe7076}=_0x3a7639[_0x340a6c(0x251)],_0x4325e7=_0x3a7639[_0x340a6c(0x251)],_0x29fa29=await profile[_0x340a6c(0x1b1)]({'email':_0x4325e7[_0x340a6c(0x2b8)]}),_0x3c9ef4=await master_shop[_0x340a6c(0x27b)](),_0x399127=_0x3a7639['params']['id'],_0x1c9a09=await purchases[_0x340a6c(0x224)](_0x399127),_0x29f8c9=await suppliers[_0x340a6c(0x27b)]({});let _0x341a2a;if(_0x4325e7['role']==_0x340a6c(0x28c)){const _0x24dc2e=await staff[_0x340a6c(0x1b1)]({'email':_0x4325e7['email']});_0x341a2a=await warehouse[_0x340a6c(0x27b)]({'status':_0x340a6c(0x2a8),'name':_0x24dc2e[_0x340a6c(0x1d1)],'warehouse_category':'Raw\x20Materials'});}else _0x341a2a=await warehouse['aggregate']([{'$match':{'status':_0x340a6c(0x2a8),'warehouse_category':_0x340a6c(0x28f)}},{'$group':{'_id':_0x340a6c(0x2ad),'name':{'$first':'$name'}}}]);const _0x4ea844=await product[_0x340a6c(0x27b)]({}),_0x4ff110=BayBinSelected(_0x1c9a09[_0x340a6c(0x218)],_0x1c9a09[_0x340a6c(0x20f)]);let _0x33e078=new Date(_0x1c9a09['expiry_date']),_0x4e927a=('0'+_0x33e078[_0x340a6c(0x1dd)]())[_0x340a6c(0x1ba)](-0x2),_0x242358=('0'+(_0x33e078[_0x340a6c(0x2a3)]()+0x1))[_0x340a6c(0x1ba)](-0x2),_0x3c654d=_0x33e078[_0x340a6c(0x219)](),_0x5303ad=_0x3c654d+'-'+_0x242358+'-'+_0x4e927a;if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]==_0x340a6c(0x215)){var _0x294f9f=users['English'];console[_0x340a6c(0x217)](_0x294f9f);}else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]==_0x340a6c(0x26d))var _0x294f9f=users[_0x340a6c(0x26d)];else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]==_0x340a6c(0x2bf))var _0x294f9f=users[_0x340a6c(0x2bf)];else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]==_0x340a6c(0x2cc))var _0x294f9f=users[_0x340a6c(0x2cc)];else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]=='French')var _0x294f9f=users['French'];else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]==_0x340a6c(0x294))var _0x294f9f=users[_0x340a6c(0x1c9)];else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]==_0x340a6c(0x20b))var _0x294f9f=users[_0x340a6c(0x20b)];else{if(_0x3c9ef4[0x0][_0x340a6c(0x1cf)]=='Arabic\x20(ae)')var _0x294f9f=users[_0x340a6c(0x1f5)];}}}}}}}_0xe8e0a9[_0x340a6c(0x21f)](_0x340a6c(0x2ac),{'success':_0x3a7639['flash'](_0x340a6c(0x269)),'errors':_0x3a7639[_0x340a6c(0x2c1)](_0x340a6c(0x1c6)),'role':_0x4325e7,'profile':_0x29fa29,'purchases':_0x1c9a09,'suppliers':_0x29f8c9,'warehouse':_0x341a2a,'product':_0x4ea844,'master_shop':_0x3c9ef4,'language':_0x294f9f,'ed_fullDate':_0x5303ad,'dataSelected':_0x4ff110});}catch(_0x52ca10){console[_0x340a6c(0x217)](_0x52ca10);}}),router[a0_0x4307a3(0x2c2)](a0_0x4307a3(0x29a),auth,async(_0x35042b,_0x117448)=>{var _0x484832=a0_0x4307a3;try{const _0xb55bd8=_0x35042b[_0x484832(0x2bb)]['id'],_0xbcf9c5=await purchases[_0x484832(0x1b1)]({'_id':_0x35042b[_0x484832(0x2bb)]['id']}),_0x4d9e8f=await warehouse['findOne']({'name':_0xbcf9c5[_0x484832(0x218)],'room':_0xbcf9c5['room']});_0xbcf9c5['product'][_0x484832(0x206)](_0x80ffd7=>{var _0x5ac0ac=_0x484832;const _0x3dfbad=_0x4d9e8f[_0x5ac0ac(0x1ab)][_0x5ac0ac(0x2a2)](_0x5725ee=>{var _0x2a1240=_0x5ac0ac;_0x5725ee[_0x2a1240(0x1f6)]==_0x80ffd7['product_name']&&_0x5725ee[_0x2a1240(0x2b3)]==_0x80ffd7[_0x2a1240(0x2b3)]&&_0x5725ee[_0x2a1240(0x1d9)]==_0x80ffd7[_0x2a1240(0x1d9)]&&_0x5725ee['bin']==_0x80ffd7[_0x2a1240(0x1ee)]&&_0x5725ee['bay']==_0x80ffd7[_0x2a1240(0x1d2)]&&_0x5725ee[_0x2a1240(0x1f4)]==_0x80ffd7[_0x2a1240(0x1f4)]&&_0x5725ee[_0x2a1240(0x288)]==_0x80ffd7[_0x2a1240(0x288)]&&(_0x5725ee[_0x2a1240(0x1be)]=parseInt(_0x5725ee[_0x2a1240(0x1be)])-parseInt(_0x80ffd7[_0x2a1240(0x24f)]));});}),await _0x4d9e8f[_0x484832(0x2c6)]();const {invoice:_0x4e47ba,suppliers:_0x571696,date:_0x22b7a8,warehouse_name:_0x387f74,prod_name:_0x97865d,prod_code:_0x2285f9,prod_qty:_0x503e97,prod_unit:_0x1f3f10,prod_secondunit:_0x381fd0,prod_level:_0x3c36c9,prod_isle:_0x8e051a,prod_pallet:_0x2a40aa,note:_0x538e1e,expiry_date:_0x442fbc,batch_code:_0x35fa76,paid_amount:_0x48cc13,due_amount:_0x46019b,Room_name:_0x1c7aa2,primary_code:_0x314949,secondary_code:_0xf12445,PO_number:_0x56cf1b,JO_number:_0x359163}=_0x35042b[_0x484832(0x291)];if(typeof _0x97865d==_0x484832(0x25d))var _0x526d96=[_0x35042b[_0x484832(0x291)]['prod_name']],_0x450d21=[_0x35042b[_0x484832(0x291)][_0x484832(0x220)]],_0x29b33b=[_0x35042b[_0x484832(0x291)][_0x484832(0x1aa)]],_0x5051b9=[_0x35042b[_0x484832(0x291)][_0x484832(0x235)]],_0x36c3ea=[_0x35042b[_0x484832(0x291)][_0x484832(0x24a)]],_0x30ca49=[_0x35042b['body']['prod_level']],_0x35f0a3=[_0x35042b[_0x484832(0x291)]['prod_isle']],_0x592a12=[_0x35042b[_0x484832(0x291)][_0x484832(0x2a0)]],_0x1bcba5=[_0x35042b[_0x484832(0x291)]['primary_code']],_0x41baf7=[_0x35042b[_0x484832(0x291)][_0x484832(0x247)]],_0x4daaf4=[_0x35042b[_0x484832(0x291)][_0x484832(0x1eb)]],_0x2f3a31=[_0x35042b[_0x484832(0x291)]['batch_code']],_0xd23b2b=[_0x35042b[_0x484832(0x291)][_0x484832(0x21e)]],_0x5805d7=[_0x35042b[_0x484832(0x291)][_0x484832(0x288)]],_0x5e12ce=[_0x35042b[_0x484832(0x291)][_0x484832(0x21d)]],_0x19f447=[_0x35042b[_0x484832(0x291)][_0x484832(0x1d9)]];else var _0x526d96=[..._0x35042b[_0x484832(0x291)][_0x484832(0x278)]],_0x450d21=[..._0x35042b[_0x484832(0x291)]['prod_code']],_0x29b33b=[..._0x35042b['body']['prod_qty']],_0x5051b9=[..._0x35042b[_0x484832(0x291)][_0x484832(0x235)]],_0x36c3ea=[..._0x35042b[_0x484832(0x291)][_0x484832(0x24a)]],_0x30ca49=[..._0x35042b[_0x484832(0x291)][_0x484832(0x297)]],_0x35f0a3=[..._0x35042b[_0x484832(0x291)][_0x484832(0x257)]],_0x592a12=[..._0x35042b[_0x484832(0x291)][_0x484832(0x2a0)]],_0x1bcba5=[..._0x35042b['body'][_0x484832(0x250)]],_0x41baf7=[..._0x35042b[_0x484832(0x291)][_0x484832(0x247)]],_0x4daaf4=[..._0x35042b['body'][_0x484832(0x1eb)]],_0x2f3a31=[..._0x35042b[_0x484832(0x291)]['batch_code']],_0xd23b2b=[..._0x35042b['body'][_0x484832(0x21e)]],_0x5805d7=[..._0x35042b[_0x484832(0x291)][_0x484832(0x288)]],_0x5e12ce=[..._0x35042b[_0x484832(0x291)]['rak']],_0x19f447=[..._0x35042b[_0x484832(0x291)]['type']];const _0x422d2e=_0x526d96['map'](_0x3aa94c=>{return _0x3aa94c={'product_name':_0x3aa94c};});_0x450d21[_0x484832(0x206)]((_0x1fcc21,_0x5a2971)=>{var _0x3e9780=_0x484832;_0x422d2e[_0x5a2971][_0x3e9780(0x2af)]=_0x1fcc21;}),_0x29b33b['forEach']((_0x2a1139,_0x5811a8)=>{var _0xaf9943=_0x484832;_0x422d2e[_0x5811a8][_0xaf9943(0x24f)]=_0x2a1139;}),_0x5051b9[_0x484832(0x206)]((_0x2bb907,_0x2ada64)=>{_0x422d2e[_0x2ada64]['standard_unit']=_0x2bb907;}),_0x36c3ea[_0x484832(0x206)]((_0x85f07,_0x5eac5b)=>{var _0x33ab98=_0x484832;_0x422d2e[_0x5eac5b][_0x33ab98(0x29c)]=_0x85f07;}),_0x30ca49['forEach']((_0x3f023d,_0x4e0357)=>{var _0x102260=_0x484832;_0x422d2e[_0x4e0357][_0x102260(0x1d2)]=_0x3f023d;}),_0x35f0a3['forEach']((_0x5c181b,_0x407313)=>{var _0x4e8c48=_0x484832;_0x422d2e[_0x407313][_0x4e8c48(0x1ee)]=_0x5c181b;}),_0x592a12['forEach']((_0x573906,_0x16f81f)=>{_0x422d2e[_0x16f81f]['floorlevel']=_0x573906;}),_0x1bcba5[_0x484832(0x206)]((_0x5e2171,_0x3f5b6c)=>{var _0xef07d=_0x484832;_0x422d2e[_0x3f5b6c][_0xef07d(0x250)]=_0x5e2171;}),_0x41baf7[_0x484832(0x206)]((_0x1a7260,_0x41148f)=>{var _0x9dd7fc=_0x484832;_0x422d2e[_0x41148f][_0x9dd7fc(0x247)]=_0x1a7260;}),_0x4daaf4[_0x484832(0x206)]((_0x454590,_0x3390cf)=>{var _0x34e068=_0x484832;_0x422d2e[_0x3390cf][_0x34e068(0x271)]=_0x454590;}),_0x2f3a31[_0x484832(0x206)]((_0x19df96,_0x9fe6e9)=>{var _0x543a97=_0x484832;_0x422d2e[_0x9fe6e9][_0x543a97(0x2d0)]=_0x19df96;}),_0xd23b2b[_0x484832(0x206)]((_0x2dd527,_0x3f01f2)=>{var _0x57001b=_0x484832;_0x422d2e[_0x3f01f2][_0x57001b(0x21e)]=_0x2dd527;}),_0x19f447[_0x484832(0x206)]((_0x451dd4,_0x4d509b)=>{_0x422d2e[_0x4d509b]['type']=_0x451dd4;}),_0x5805d7[_0x484832(0x206)]((_0x5c63f4,_0x1a1f55)=>{var _0x56f910=_0x484832;_0x422d2e[_0x1a1f55][_0x56f910(0x288)]=_0x5c63f4;}),_0x5e12ce['forEach']((_0x2f1c9,_0x2f01a2)=>{var _0x431175=_0x484832;_0x422d2e[_0x2f01a2][_0x431175(0x1f4)]=_0x2f1c9;});const _0x2c4b0b=_0x422d2e[_0x484832(0x240)](_0x46e12f=>_0x46e12f[_0x484832(0x24f)]!=='0'&&_0x46e12f['quantity']!=='');_0xbcf9c5[_0x484832(0x242)]=_0x4e47ba,_0xbcf9c5[_0x484832(0x239)]=_0x571696,_0xbcf9c5[_0x484832(0x228)]=_0x22b7a8,_0xbcf9c5['warehouse_name']=_0x387f74,_0xbcf9c5[_0x484832(0x265)]=_0x2c4b0b,_0xbcf9c5[_0x484832(0x261)]=_0x538e1e,_0xbcf9c5[_0x484832(0x1af)]=_0x48cc13,_0xbcf9c5[_0x484832(0x1d5)]=_0x46019b,_0xbcf9c5['room']=_0x1c7aa2,_0xbcf9c5[_0x484832(0x25c)]=_0x56cf1b,_0xbcf9c5[_0x484832(0x232)]=_0x359163;const _0x4cba74=await _0xbcf9c5['save'](),_0x2734b9=await warehouse[_0x484832(0x1b1)]({'name':_0x35042b[_0x484832(0x291)]['warehouse_name'],'room':_0x35042b['body'][_0x484832(0x25a)]});_0xbcf9c5['product'][_0x484832(0x206)](_0x2fc150=>{var _0x25f9c2=_0x484832,_0x12e362=0x0;const _0x20a907=_0x2734b9[_0x25f9c2(0x1ab)][_0x25f9c2(0x2a2)](_0x424138=>{var _0x164393=_0x25f9c2;_0x424138[_0x164393(0x1f6)]==_0x2fc150[_0x164393(0x1f6)]&&_0x424138[_0x164393(0x2b3)]==_0x2fc150[_0x164393(0x2b3)]&&_0x424138[_0x164393(0x1d9)]==_0x2fc150[_0x164393(0x1d9)]&&_0x424138[_0x164393(0x1ee)]==_0x2fc150[_0x164393(0x1ee)]&&_0x424138[_0x164393(0x1d2)]==_0x2fc150['bay']&&_0x424138[_0x164393(0x1f4)]==_0x2fc150[_0x164393(0x1f4)]&&_0x424138[_0x164393(0x288)]==_0x2fc150[_0x164393(0x288)]&&(_0x424138[_0x164393(0x1be)]=parseInt(_0x424138[_0x164393(0x1be)])+parseInt(_0x2fc150[_0x164393(0x24f)]),_0x12e362++);});_0x12e362=='0'&&(_0x2734b9[_0x25f9c2(0x1ab)]=_0x2734b9[_0x25f9c2(0x1ab)][_0x25f9c2(0x267)]({'product_name':_0x2fc150['product_name'],'product_stock':_0x2fc150[_0x25f9c2(0x24f)],'primary_code':_0x2fc150[_0x25f9c2(0x250)],'secondary_code':_0x2fc150['secondary_code'],'product_code':_0x2fc150[_0x25f9c2(0x2af)],'storage':_0x2fc150['storage'],'rack':_0x2fc150['rack'],'bay':_0x2fc150[_0x25f9c2(0x1d2)],'bin':_0x2fc150['bin'],'type':_0x2fc150[_0x25f9c2(0x1d9)],'floorlevel':_0x2fc150[_0x25f9c2(0x2b3)],'maxProducts':_0x2fc150[_0x25f9c2(0x271)],'unit':_0x2fc150[_0x25f9c2(0x1f2)],'secondary_unit':_0x2fc150['secondary_unit'],'expiry_date':_0x2fc150[_0x25f9c2(0x21e)]}));}),await _0x2734b9[_0x484832(0x2c6)]();const _0x2b83d8=await s_payment_data['findOne']({'invoice':_0x35042b[_0x484832(0x291)]['invoice']});if(_0x2b83d8===null){}else console['log'](_0x484832(0x239),_0x2b83d8,_0x35042b[_0x484832(0x291)][_0x484832(0x242)]),_0x2b83d8[_0x484832(0x239)]=_0x35042b[_0x484832(0x291)]['suppliers'],await _0x2b83d8[_0x484832(0x2c6)]();_0x35042b[_0x484832(0x2c1)](_0x484832(0x269),'purchase\x20data\x20update\x20successfully'),_0x117448[_0x484832(0x1bf)](_0x484832(0x23f));}catch(_0x39cda3){console['log'](_0x39cda3);}}),router['post']('/give_payment/:id',auth,async(_0x21534a,_0x5bdd9d)=>{var _0x36c491=a0_0x4307a3;try{const _0x2452c2=_0x21534a[_0x36c491(0x2bb)]['id'],{invoice:_0x4d15f2,suppliers:_0x15df12,payable:_0xbfbf7f,due_amount:_0x187d5b}=_0x21534a[_0x36c491(0x291)],_0x5bc886=await purchases[_0x36c491(0x224)](_0x2452c2);var _0x14edca=_0xbfbf7f-_0x187d5b;_0x5bc886[_0x36c491(0x1af)]=parseFloat(_0x5bc886[_0x36c491(0x1af)])+parseFloat(_0x187d5b),_0x5bc886[_0x36c491(0x1d5)]=_0x14edca;const _0x37ba53=await _0x5bc886[_0x36c491(0x2c6)]();console['log'](_0x37ba53);const _0x35e590=await s_payment_data['findOne']({'invoice':_0x4d15f2});_0x35e590['amount']=_0x14edca,await _0x35e590[_0x36c491(0x2c6)]();let _0x4efd8c=new Date(),_0x5aa6fe=('0'+_0x4efd8c['getDate']())[_0x36c491(0x1ba)](-0x2),_0x45cf14=('0'+(_0x4efd8c[_0x36c491(0x2a3)]()+0x1))[_0x36c491(0x1ba)](-0x2),_0x3bdd17=_0x4efd8c[_0x36c491(0x219)](),_0x3e12f9=_0x3bdd17+'-'+_0x45cf14+'-'+_0x5aa6fe;const _0x4db20f=new suppliers_payment({'invoice':_0x4d15f2,'date':_0x3bdd17+'-'+_0x45cf14+'-'+_0x5aa6fe,'suppliers':_0x15df12,'reason':_0x36c491(0x1c1),'amount':_0x187d5b}),_0x42adaa=await _0x4db20f[_0x36c491(0x2c6)]();_0x21534a[_0x36c491(0x2c1)]('success',_0x36c491(0x1e2)),_0x5bdd9d[_0x36c491(0x1bf)](_0x36c491(0x23f));}catch(_0x291d48){console[_0x36c491(0x217)](_0x291d48);}}),router[a0_0x4307a3(0x2c3)](a0_0x4307a3(0x1e5),auth,async(_0x6ac89c,_0x35380e)=>{var _0x48d41d=a0_0x4307a3;try{const {username:_0x141474,email:_0x39a79c,role:_0x4352a4}=_0x6ac89c[_0x48d41d(0x251)],_0x4d0d2b=_0x6ac89c[_0x48d41d(0x251)],_0x1babb9=await profile[_0x48d41d(0x1b1)]({'email':_0x4d0d2b[_0x48d41d(0x2b8)]}),_0x25d2e3=await master_shop[_0x48d41d(0x27b)]();console['log'](_0x48d41d(0x22c),_0x25d2e3);const _0x950aa7=_0x6ac89c[_0x48d41d(0x2bb)]['id'],_0x48adea=await purchases['findById'](_0x950aa7);console[_0x48d41d(0x217)](_0x48adea);const _0x3255e4=await suppliers[_0x48d41d(0x1b1)]({'name':_0x48adea['suppliers']});console[_0x48d41d(0x217)](_0x3255e4);if(_0x25d2e3[0x0][_0x48d41d(0x1cf)]=='English\x20(US)'){var _0x4262cd=users['English'];console[_0x48d41d(0x217)](_0x4262cd);}else{if(_0x25d2e3[0x0][_0x48d41d(0x1cf)]=='Hindi')var _0x4262cd=users[_0x48d41d(0x26d)];else{if(_0x25d2e3[0x0][_0x48d41d(0x1cf)]==_0x48d41d(0x2bf))var _0x4262cd=users[_0x48d41d(0x2bf)];else{if(_0x25d2e3[0x0]['language']==_0x48d41d(0x2cc))var _0x4262cd=users[_0x48d41d(0x2cc)];else{if(_0x25d2e3[0x0]['language']==_0x48d41d(0x272))var _0x4262cd=users[_0x48d41d(0x272)];else{if(_0x25d2e3[0x0][_0x48d41d(0x1cf)]=='Portuguese\x20(BR)')var _0x4262cd=users[_0x48d41d(0x1c9)];else{if(_0x25d2e3[0x0][_0x48d41d(0x1cf)]==_0x48d41d(0x20b))var _0x4262cd=users[_0x48d41d(0x20b)];else{if(_0x25d2e3[0x0]['language']==_0x48d41d(0x1f1))var _0x4262cd=users[_0x48d41d(0x1f5)];}}}}}}}_0x35380e[_0x48d41d(0x21f)](_0x48d41d(0x236),{'success':_0x6ac89c[_0x48d41d(0x2c1)](_0x48d41d(0x269)),'errors':_0x6ac89c[_0x48d41d(0x2c1)](_0x48d41d(0x1c6)),'role':_0x4d0d2b,'profile':_0x1babb9,'master_shop':_0x25d2e3,'supplier':_0x3255e4,'purchase':_0x48adea,'language':_0x4262cd});}catch(_0x1b2c53){console[_0x48d41d(0x217)](_0x1b2c53);}}),router[a0_0x4307a3(0x2c3)](a0_0x4307a3(0x23b),auth,async(_0x21b695,_0x40bbaa)=>{var _0x436647=a0_0x4307a3;try{const {username:_0x517c1c,email:_0x4e9a52,role:_0x442744}=_0x21b695[_0x436647(0x251)],_0x53dc8d=_0x21b695[_0x436647(0x251)],_0x5930bc=await profile[_0x436647(0x1b1)]({'email':_0x53dc8d[_0x436647(0x2b8)]}),_0x7c5e27=await master_shop[_0x436647(0x27b)]();console['log'](_0x436647(0x22c),_0x7c5e27);const _0x3de1d4=_0x21b695[_0x436647(0x2bb)]['id'];console['log'](_0x3de1d4);const _0xdff4bb=await purchases['findById'](_0x3de1d4);console[_0x436647(0x217)](_0x436647(0x1ca),_0xdff4bb);const _0x1b4bd2=await product['find']({}),_0x3f2201=await warehouse[_0x436647(0x2cb)]([{'$match':{'name':_0xdff4bb[_0x436647(0x218)],'room':_0xdff4bb[_0x436647(0x20f)],'warehouse_category':_0x436647(0x28f)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x436647(0x204),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x436647(0x264)},'bay':{'$first':_0x436647(0x2a5)},'bin':{'$first':_0x436647(0x1e3)},'type':{'$first':_0x436647(0x296)},'floorlevel':{'$first':_0x436647(0x1d6)},'primary_code':{'$first':_0x436647(0x237)},'secondary_code':{'$first':_0x436647(0x1ef)},'product_code':{'$first':_0x436647(0x27e)},'storage':{'$first':_0x436647(0x1cd)},'rack':{'$first':_0x436647(0x1c5)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x436647(0x2a8),'name':_0x436647(0x1e9),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x436647(0x2ad),'name':{'$first':_0x436647(0x2ad)}}},{'$sort':{'name':0x1}}]),console[_0x436647(0x217)](_0x436647(0x277),_0x3f2201);if(_0x7c5e27[0x0][_0x436647(0x1cf)]==_0x436647(0x215)){var _0x52c75a=users['English'];console[_0x436647(0x217)](_0x52c75a);}else{if(_0x7c5e27[0x0][_0x436647(0x1cf)]==_0x436647(0x26d))var _0x52c75a=users[_0x436647(0x26d)];else{if(_0x7c5e27[0x0]['language']==_0x436647(0x2bf))var _0x52c75a=users['German'];else{if(_0x7c5e27[0x0][_0x436647(0x1cf)]==_0x436647(0x2cc))var _0x52c75a=users[_0x436647(0x2cc)];else{if(_0x7c5e27[0x0][_0x436647(0x1cf)]==_0x436647(0x272))var _0x52c75a=users[_0x436647(0x272)];else{if(_0x7c5e27[0x0][_0x436647(0x1cf)]==_0x436647(0x294))var _0x52c75a=users[_0x436647(0x1c9)];else{if(_0x7c5e27[0x0][_0x436647(0x1cf)]=='Chinese')var _0x52c75a=users[_0x436647(0x20b)];else{if(_0x7c5e27[0x0][_0x436647(0x1cf)]=='Arabic\x20(ae)')var _0x52c75a=users[_0x436647(0x1f5)];}}}}}}}_0x40bbaa[_0x436647(0x21f)](_0x436647(0x1ea),{'success':_0x21b695['flash'](_0x436647(0x269)),'errors':_0x21b695[_0x436647(0x2c1)](_0x436647(0x1c6)),'role':_0x53dc8d,'profile':_0x5930bc,'user':_0xdff4bb,'stock':_0x3f2201,'master_shop':_0x7c5e27,'product':_0x1b4bd2,'language':_0x52c75a,'warehouse':warehouse_data});}catch(_0x37466f){console['log'](_0x37466f);}}),router[a0_0x4307a3(0x2c2)](a0_0x4307a3(0x23b),auth,async(_0x17a690,_0x1fa327)=>{var _0x313392=a0_0x4307a3;try{const {invoice:_0x13393f,date:_0x5166de,warehouse_name:_0x5a0739,Room_name:_0x24ff41,product_name:_0x27a854,purchase_quantity:_0x13933e,stocks:_0x4a00a3,return_qty:_0x5665e1,note:_0x2d84a3,level:_0x23354a,isle:_0x1f4571,pallet:_0x20e40a,to_warehouse_name:_0x3fee17,to_Room_name:_0x3c888c}=_0x17a690[_0x313392(0x291)],_0x47e2c4=await purchases[_0x313392(0x1b1)]({'_id':_0x17a690['params']['id']}),_0x53a14b=await warehouse[_0x313392(0x1b1)]({'name':_0x5a0739,'room':_0x24ff41});if(typeof _0x27a854=='string')var _0x2e5a0e=[_0x17a690['body']['product_name']],_0x3b2198=[_0x17a690[_0x313392(0x291)][_0x313392(0x2c8)]],_0x1b3351=[_0x17a690[_0x313392(0x291)][_0x313392(0x1e7)]],_0x52c905=[_0x17a690['body'][_0x313392(0x2aa)]],_0x24876e=[_0x17a690[_0x313392(0x291)][_0x313392(0x1fb)]],_0x587c9a=[_0x17a690[_0x313392(0x291)][_0x313392(0x1db)]],_0x39bd22=[_0x17a690[_0x313392(0x291)]['pallet']],_0x32d3ef=[_0x17a690['body']['types']],_0x10c758=[_0x17a690[_0x313392(0x291)][_0x313392(0x2b6)]],_0x235e29=[_0x17a690[_0x313392(0x291)][_0x313392(0x1b2)]],_0x59439a=[_0x17a690[_0x313392(0x291)][_0x313392(0x299)]];else var _0x2e5a0e=[..._0x17a690[_0x313392(0x291)][_0x313392(0x1f6)]],_0x3b2198=[..._0x17a690['body'][_0x313392(0x2c8)]],_0x1b3351=[..._0x17a690[_0x313392(0x291)][_0x313392(0x1e7)]],_0x52c905=[..._0x17a690[_0x313392(0x291)]['return_qty']],_0x24876e=[..._0x17a690[_0x313392(0x291)][_0x313392(0x1fb)]],_0x587c9a=[..._0x17a690[_0x313392(0x291)][_0x313392(0x1db)]],_0x39bd22=[..._0x17a690[_0x313392(0x291)][_0x313392(0x28b)]],_0x32d3ef=[..._0x17a690[_0x313392(0x291)][_0x313392(0x290)]],_0x10c758=[..._0x17a690[_0x313392(0x291)][_0x313392(0x2b6)]],_0x235e29=[..._0x17a690[_0x313392(0x291)][_0x313392(0x1b2)]],_0x59439a=[..._0x17a690[_0x313392(0x291)][_0x313392(0x299)]];const _0xda263e=_0x2e5a0e[_0x313392(0x2a2)](_0x40e3da=>{return _0x40e3da={'product_name':_0x40e3da};});_0x3b2198['forEach']((_0x53a8b4,_0x1444ef)=>{var _0x277c30=_0x313392;_0xda263e[_0x1444ef][_0x277c30(0x2c8)]=_0x53a8b4;}),_0x1b3351[_0x313392(0x206)]((_0x43e557,_0x2689e5)=>{var _0x365468=_0x313392;_0xda263e[_0x2689e5][_0x365468(0x1bd)]=_0x43e557;}),_0x52c905[_0x313392(0x206)]((_0x505d4a,_0x5f4e02)=>{var _0x3b7fdf=_0x313392;_0xda263e[_0x5f4e02][_0x3b7fdf(0x2aa)]=_0x505d4a;}),_0x24876e['forEach']((_0x2c49c4,_0x4e375a)=>{var _0x11b31f=_0x313392;_0xda263e[_0x4e375a][_0x11b31f(0x1d2)]=_0x2c49c4;}),_0x587c9a[_0x313392(0x206)]((_0x27ca98,_0x4fb80b)=>{var _0x549d3c=_0x313392;_0xda263e[_0x4fb80b][_0x549d3c(0x1ee)]=_0x27ca98;}),_0x39bd22[_0x313392(0x206)]((_0x230b4a,_0x120f0f)=>{var _0x3e9851=_0x313392;_0xda263e[_0x120f0f][_0x3e9851(0x2b3)]=_0x230b4a;}),_0x32d3ef['forEach']((_0x508121,_0x2ab826)=>{var _0x23c0d4=_0x313392;_0xda263e[_0x2ab826][_0x23c0d4(0x1d9)]=_0x508121;}),_0x10c758[_0x313392(0x206)]((_0x12a542,_0x434dd5)=>{var _0x1e2214=_0x313392;_0xda263e[_0x434dd5][_0x1e2214(0x2af)]=_0x12a542;}),_0x235e29['forEach']((_0x4520b7,_0x107598)=>{var _0x5e7501=_0x313392;_0xda263e[_0x107598][_0x5e7501(0x250)]=_0x4520b7;}),_0x59439a['forEach']((_0x46ea2c,_0x478239)=>{var _0xede70e=_0x313392;_0xda263e[_0x478239][_0xede70e(0x247)]=_0x46ea2c;}),_0x47e2c4['product'][_0x313392(0x206)](_0x29decc=>{var _0x3bf7f7=_0x313392;const _0x5d9329=_0x53a14b[_0x3bf7f7(0x1ab)]['map'](_0x1c51f7=>{var _0x3c17a6=_0x3bf7f7;_0x1c51f7['product_name']==_0x29decc['product_name']&&_0x1c51f7['floorlevel']==_0x29decc[_0x3c17a6(0x2b3)]&&_0x1c51f7[_0x3c17a6(0x1d9)]==_0x29decc[_0x3c17a6(0x1d9)]&&_0x1c51f7[_0x3c17a6(0x1ee)]==_0x29decc[_0x3c17a6(0x1ee)]&&_0x1c51f7[_0x3c17a6(0x1d2)]==_0x29decc['bay']&&_0x1c51f7['rack']==_0x29decc[_0x3c17a6(0x1f4)]&&_0x1c51f7[_0x3c17a6(0x288)]==_0x29decc[_0x3c17a6(0x288)]&&(console['log'](parseInt(_0x1c51f7[_0x3c17a6(0x1be)])+_0x3c17a6(0x1ed)+parseInt(_0x29decc[_0x3c17a6(0x24f)])),_0x1c51f7[_0x3c17a6(0x1be)]=parseInt(_0x1c51f7['product_stock'])+parseInt(_0x29decc[_0x3c17a6(0x24f)]));});}),await _0x53a14b[_0x313392(0x2c6)]();const _0x3a923f=_0xda263e[_0x313392(0x240)](_0x2c1b45=>_0x2c1b45[_0x313392(0x2aa)]!=='0'&&_0x2c1b45[_0x313392(0x2aa)]!=='');var _0x55c07d=0x0;_0x3a923f[_0x313392(0x206)](_0x4fe0c4=>{var _0x1e59ee=_0x313392;console[_0x1e59ee(0x217)]('foreach\x20newproduct',_0x4fe0c4),(parseInt(_0x4fe0c4[_0x1e59ee(0x2c8)])<parseInt(_0x4fe0c4[_0x1e59ee(0x2aa)])||parseInt(_0x4fe0c4[_0x1e59ee(0x1bd)])<parseInt(_0x4fe0c4['return_qty']))&&_0x55c07d++;});if(_0x55c07d!=0x0)return _0x17a690[_0x313392(0x2c1)](_0x313392(0x1c6),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x1fa327[_0x313392(0x1bf)](_0x313392(0x27d));const _0x3c81ab=new purchases_return({'invoice':_0x13393f,'suppliers':_0x17a690[_0x313392(0x291)]['suppliers'],'date':_0x5166de,'warehouse_name':_0x5a0739,'return_product':_0x3a923f,'note':_0x2d84a3,'room':_0x24ff41,'to_warehouse_name':_0x3fee17,'to_room':_0x3c888c}),_0x3f6f25=await _0x3c81ab['save']();console[_0x313392(0x217)](_0x3c81ab);const _0x51dfa6=await purchases_return[_0x313392(0x1b1)]({'invoice':_0x13393f}),_0xab8a34=await warehouse[_0x313392(0x1b1)]({'name':_0x3fee17,'room':_0x3c888c});_0x51dfa6[_0x313392(0x209)][_0x313392(0x206)](_0x3bbca4=>{var _0x2caefe=_0x313392,_0x2e97a5=0x0;const _0x2b0a4a=_0xab8a34[_0x2caefe(0x1ab)]['map'](_0x4fcad6=>{var _0x3b17d9=_0x2caefe;_0x4fcad6[_0x3b17d9(0x1f6)]==_0x3bbca4[_0x3b17d9(0x1f6)]&&_0x4fcad6[_0x3b17d9(0x2b3)]==_0x3bbca4[_0x3b17d9(0x2b3)]&&_0x4fcad6['type']==_0x3bbca4[_0x3b17d9(0x1d9)]&&_0x4fcad6[_0x3b17d9(0x1ee)]==_0x3bbca4[_0x3b17d9(0x1ee)]&&_0x4fcad6[_0x3b17d9(0x1d2)]==_0x3bbca4[_0x3b17d9(0x1d2)]&&(_0x4fcad6[_0x3b17d9(0x1be)]=parseInt(_0x4fcad6[_0x3b17d9(0x1be)])-parseInt(_0x3bbca4['return_qty']),_0x2e97a5++);});_0x2e97a5=='0'&&(_0xab8a34[_0x2caefe(0x1ab)]=_0xab8a34['product_details'][_0x2caefe(0x267)]({'product_name':_0x3bbca4['product_name'],'product_stock':_0x3bbca4[_0x2caefe(0x2aa)],'primary_code':_0x3bbca4[_0x2caefe(0x250)],'secondary_code':_0x3bbca4[_0x2caefe(0x247)],'product_code':_0x3bbca4[_0x2caefe(0x2af)],'storage':_0x3bbca4[_0x2caefe(0x288)],'rack':_0x3bbca4[_0x2caefe(0x1f4)],'bay':_0x3bbca4[_0x2caefe(0x1d2)],'bin':_0x3bbca4[_0x2caefe(0x1ee)],'type':_0x3bbca4[_0x2caefe(0x1d9)],'floorlevel':_0x3bbca4[_0x2caefe(0x2b3)],'maxProducts':_0x3bbca4[_0x2caefe(0x271)],'unit':_0x3bbca4['standard_unit'],'secondary_unit':_0x3bbca4[_0x2caefe(0x29c)],'expiry_date':_0x3bbca4[_0x2caefe(0x21e)]}));}),await _0xab8a34[_0x313392(0x2c6)]();const _0x58ca4d=await purchases['findOne']({'invoice':_0x13393f});_0x58ca4d[_0x313392(0x203)]=_0x313392(0x2b2);const _0x28d297=await _0x58ca4d[_0x313392(0x2c6)](),_0x1cf193=new s_payment_data({'invoice':_0x13393f,'suppliers':_0x17a690['body'][_0x313392(0x239)],'reason':'Purchase\x20Return'});await _0x1cf193[_0x313392(0x2c6)]();const _0x3760c2=await master_shop[_0x313392(0x27b)]();console[_0x313392(0x217)](_0x313392(0x243),_0x3760c2[0x0][_0x313392(0x1dc)]);const _0x4090f7=await email_settings[_0x313392(0x1b1)](),_0x205300=await suppliers[_0x313392(0x1b1)]({'name':_0x17a690[_0x313392(0x291)]['suppliers']});console[_0x313392(0x217)](_0x313392(0x222),_0x205300);_0x3760c2[0x0][_0x313392(0x22b)]==0x1?(right_currency=_0x3760c2[0x0][_0x313392(0x1a6)],left_currency=''):(right_currency='',left_currency=_0x3760c2[0x0][_0x313392(0x1a6)]);var _0x2b1b16=_0x2e5a0e,_0x2b1125=_0x52c905,_0x5c23a4='',_0x1d42bd;for(_0x1d42bd in _0x2b1b16){_0x5c23a4+=_0x313392(0x23c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b1b16[_0x1d42bd]+_0x313392(0x287)+_0x313392(0x29f)+_0x2b1125[_0x1d42bd]+'</td>'+_0x313392(0x292);}console['log']('product_list',_0x5c23a4);let _0x35da29=nodemailer[_0x313392(0x1e8)]({'service':_0x313392(0x1b4),'auth':{'user':_0x4090f7[_0x313392(0x2b8)],'pass':_0x4090f7[_0x313392(0x26a)]}}),_0x4053ba={'from':_0x4090f7[_0x313392(0x2b8)],'to':_0x205300[_0x313392(0x2b8)],'subject':_0x313392(0x1ac),'attachments':[{'filename':_0x313392(0x1b9),'path':__dirname+'/../public'+_0x313392(0x1c7)+_0x3760c2[0x0][_0x313392(0x1dc)],'cid':_0x313392(0x249)}],'html':'<!DOCTYPE\x20html>'+_0x313392(0x25e)+_0x313392(0x1ff)+_0x313392(0x2b1)+_0x313392(0x1c8)+_0x313392(0x2b1)+_0x313392(0x2a7)+'</div>'+_0x313392(0x2b1)+_0x313392(0x2b5)+_0x3760c2[0x0]['site_title']+_0x313392(0x2ba)+_0x313392(0x22e)+_0x313392(0x22e)+_0x313392(0x227)+_0x313392(0x2b1)+_0x313392(0x2a6)+_0x313392(0x234)+_0x13393f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x313392(0x279)+_0x5166de+'\x20'+_0x313392(0x280)+_0x313392(0x2a1)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x313392(0x210)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x313392(0x281)+'</tr>'+_0x313392(0x28d)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5c23a4+'\x20'+_0x313392(0x26f)+_0x313392(0x27f)+_0x313392(0x2b1)+_0x313392(0x1c0)+_0x313392(0x24e)+_0x3760c2[0x0][_0x313392(0x1ad)]+_0x313392(0x2a1)+'</div>'+'</div>'+_0x313392(0x211)};_0x35da29[_0x313392(0x284)](_0x4053ba,function(_0x242938,_0x270a27){var _0x5f3a5a=_0x313392;_0x242938?(console[_0x5f3a5a(0x217)](_0x242938),console['log'](_0x5f3a5a(0x1c4))):console[_0x5f3a5a(0x217)](_0x5f3a5a(0x29b));}),_0x17a690[_0x313392(0x2c1)](_0x313392(0x269),_0x313392(0x273)),_0x1fa327['redirect'](_0x313392(0x23f));}catch(_0x121cc5){console[_0x313392(0x217)](_0x121cc5),_0x1fa327[_0x313392(0x1c3)](0xc8)[_0x313392(0x1cb)]({'message':_0x121cc5[_0x313392(0x201)]});}}),router['get'](a0_0x4307a3(0x2a9),auth,async(_0x396a16,_0x150fcd)=>{var _0x1411cb=a0_0x4307a3;try{const {username:_0x4aa06f,email:_0x4b2b13,role:_0x5763ec}=_0x396a16[_0x1411cb(0x251)],_0x2e5829=_0x396a16[_0x1411cb(0x251)],_0x1e7b50=await profile[_0x1411cb(0x1b1)]({'email':_0x2e5829['email']}),_0x17dcd0=await master_shop['find'](),_0x477ae9=_0x396a16[_0x1411cb(0x2bb)]['id'],_0x4fa7a1=await purchases['findById'](_0x477ae9);if(_0x17dcd0[0x0]['language']==_0x1411cb(0x215))var _0x562d21=users[_0x1411cb(0x213)];else{if(_0x17dcd0[0x0]['language']==_0x1411cb(0x26d))var _0x562d21=users['Hindi'];else{if(_0x17dcd0[0x0]['language']==_0x1411cb(0x2bf))var _0x562d21=users[_0x1411cb(0x2bf)];else{if(_0x17dcd0[0x0][_0x1411cb(0x1cf)]==_0x1411cb(0x2cc))var _0x562d21=users[_0x1411cb(0x2cc)];else{if(_0x17dcd0[0x0][_0x1411cb(0x1cf)]=='French')var _0x562d21=users['French'];else{if(_0x17dcd0[0x0]['language']==_0x1411cb(0x294))var _0x562d21=users[_0x1411cb(0x1c9)];else{if(_0x17dcd0[0x0][_0x1411cb(0x1cf)]==_0x1411cb(0x20b))var _0x562d21=users[_0x1411cb(0x20b)];else{if(_0x17dcd0[0x0]['language']==_0x1411cb(0x1f1))var _0x562d21=users[_0x1411cb(0x1f5)];}}}}}}}_0x150fcd[_0x1411cb(0x21f)](_0x1411cb(0x216),{'success':_0x396a16[_0x1411cb(0x2c1)](_0x1411cb(0x269)),'errors':_0x396a16[_0x1411cb(0x2c1)](_0x1411cb(0x1c6)),'role':_0x2e5829,'profile':_0x1e7b50,'alldata':_0x4fa7a1,'master_shop':_0x17dcd0,'language':_0x562d21}),console[_0x1411cb(0x217)](alldata);}catch(_0x1e8355){console[_0x1411cb(0x217)](_0x1e8355);}}),router[a0_0x4307a3(0x2c2)](a0_0x4307a3(0x214),async(_0x51bca0,_0x4a7707)=>{var _0x48aedf=a0_0x4307a3;const {product_code:_0x1507ba}=_0x51bca0[_0x48aedf(0x291)];var _0x5e1a6a;const _0xb926fb=await product[_0x48aedf(0x2cb)]([{'$match':{'primary_code':_0x1507ba,'product_category':_0x48aedf(0x28f)}},{'$group':{'_id':_0x48aedf(0x2cd),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x48aedf(0x266)},'unit':{'$first':_0x48aedf(0x1ec)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x48aedf(0x231)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x48aedf(0x22a)},'maxStocks':{'$first':_0x48aedf(0x283)},'maxProdPerUnit':{'$first':_0x48aedf(0x208)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x48aedf(0x1da)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x131fdf=await product[_0x48aedf(0x2cb)]([{'$match':{'secondary_code':_0x1507ba,'product_category':_0x48aedf(0x28f)}},{'$group':{'_id':_0x48aedf(0x2cd),'name':{'$first':_0x48aedf(0x2ad)},'category':{'$first':_0x48aedf(0x293)},'brand':{'$first':_0x48aedf(0x266)},'unit':{'$first':_0x48aedf(0x1ec)},'alertquantity':{'$first':_0x48aedf(0x1b3)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x48aedf(0x1d7)},'secondary_code':{'$first':_0x48aedf(0x22a)},'maxStocks':{'$first':_0x48aedf(0x283)},'maxProdPerUnit':{'$first':_0x48aedf(0x208)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x48aedf(0x1da)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xb926fb['length']>0x0)_0x5e1a6a=_0xb926fb;else _0x131fdf[_0x48aedf(0x270)]>0x0&&(_0x5e1a6a=_0x131fdf);_0x4a7707[_0x48aedf(0x1cb)](_0x5e1a6a);}),router[a0_0x4307a3(0x2c2)](a0_0x4307a3(0x2b9),async(_0x87af66,_0x517722)=>{var _0x3ebbde=a0_0x4307a3;const {primaryCode:_0x26e325,secondaryCode:_0x11cff0,productCode:_0x9504b6,bay:_0x31c220,bin:_0x13f286,types:_0x5c4ccc,pallet:_0x4dd0af,warehouses:_0x291384,room:_0xb61531}=_0x87af66['body'];console[_0x3ebbde(0x217)](_0x87af66[_0x3ebbde(0x291)]);try{const _0x5327a5=await warehouse[_0x3ebbde(0x2cb)]([{'$match':{'name':_0x291384,'room':_0xb61531}},{'$unwind':_0x3ebbde(0x282)},{'$match':{'product_details.bay':_0x31c220,'product_details.bin':_0x13f286,'product_details.type':_0x5c4ccc}},{'$group':{'_id':_0x3ebbde(0x204),'name':{'$first':_0x3ebbde(0x246)},'product_stock':{'$first':_0x3ebbde(0x264)},'level':{'$first':_0x3ebbde(0x1f9)},'isle':{'$first':_0x3ebbde(0x27c)},'pallet':{'$first':_0x3ebbde(0x24c)},'maxProducts':{'$first':_0x3ebbde(0x20d)}}}]);_0x517722[_0x3ebbde(0x1c3)](0xc8)[_0x3ebbde(0x1cb)](_0x5327a5);}catch(_0x582ce2){_0x517722[_0x3ebbde(0x1c3)](0x194)[_0x3ebbde(0x1cb)]({'message':_0x582ce2['message']});}}),module[a0_0x4307a3(0x1a5)]=router;