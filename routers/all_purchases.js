var a0_0x397cd0=a0_0x4f54;(function(_0x16d1db,_0x221b7f){var _0x187d34=a0_0x4f54,_0x2d1bf5=_0x16d1db();while(!![]){try{var _0xe7816d=parseInt(_0x187d34(0x28f))/0x1+parseInt(_0x187d34(0x1a7))/0x2*(-parseInt(_0x187d34(0x27e))/0x3)+-parseInt(_0x187d34(0x192))/0x4*(-parseInt(_0x187d34(0x252))/0x5)+parseInt(_0x187d34(0x28b))/0x6*(-parseInt(_0x187d34(0x1c0))/0x7)+-parseInt(_0x187d34(0x18e))/0x8+parseInt(_0x187d34(0x250))/0x9*(-parseInt(_0x187d34(0x1a1))/0xa)+parseInt(_0x187d34(0x199))/0xb;if(_0xe7816d===_0x221b7f)break;else _0x2d1bf5['push'](_0x2d1bf5['shift']());}catch(_0x2a16eb){_0x2d1bf5['push'](_0x2d1bf5['shift']());}}}(a0_0x10e1,0x7aea8));const express=require('express'),app=express(),router=express[a0_0x397cd0(0x1c2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x397cd0(0x1dd)),auth=require(a0_0x397cd0(0x1b1)),nodemailer=require(a0_0x397cd0(0x1d9));var ejs=require(a0_0x397cd0(0x226));function a0_0x10e1(){var _0x4bb993=['redirect','maxperunit','rak','map','types','floorlevel','return_data','product_cat','secondary_unit','Rack\x20D','$note','warehouse_name','$primary_code','type','findOne','getDate','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Hindi','</h5>','../models/all_models','name','error','room_name','json','Rack\x20C','random','bay','Chinese','primary_code_hide','gmail','role','French','deliverycode','Rack\x20A','Receiving\x20Area','English','delivery_code','amount','$product_details.secondary_code','$product_details.type','secondary_code','currency','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</tbody>','<tr>','Email\x20sent\x20successfully','Purchase\x20data\x20added\x20successfully','$alertquantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','alertQTY','logo','/invoice/:id','$brand','product_details','prod_secondunit','all','Raw\x20Materials','$product_details.storage','primary_code','padStart','<h5>','due_amount','$product_details.product_name','English\x20(US)','purchase_quantity','stock_data','\x20<>\x20','$secondary_code','$invoice','secondary_code_hide','$product_details.floorlevel','flash','catch','find','Rack\x20F','all_purchases','actual_uom','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','rack','add_purchases','product_stock','\x20Order\x20Number\x20:\x20','staff','toString','</thead>','$product.bin','product_code_hide','prod_invoice','concat','user_id','back','ejs','Purchase\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.bin','$product_details.primary_code','message','$product_details.maxProducts','standard_unit','RMSEmail','$suppliers','floor','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product.quantity','quantity','password','$product.type','suppliers_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','save','<span\x20style=\x22float:\x20right;\x22>','</td>','forEach','all_purchases_barcode','True','$product_details.isle','Portuguese','/view/return_purchase/:id','$batch_code','actual_qty','note','product_list','Shelves','</span>','expiry_date','Paid\x20For\x20Purchase','$product_details.expiry_date','$product.bay','</table>','/upload/','$product_code','German','63WSALLz','Error\x20Occurs','1919765QyFnPW','/give_payment/:id','prod_primunit','$paid_amount','$product_details','site_title','$product_details._id','payment\x20successfull','prod_level','Enabled','storage','Arabic','<strong>\x20Regards\x20</strong>','max_product_unit','path','exports','delivery_date','$product.floorlevel','Level','$unit','MaxStocks_data','Sales\x20Update\x20successfully','COLD\x20STORAGE','aggregate','prod_cat','string','<div>','image','/view/add_purchases','prod_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','foreach\x20newproduct','/../public','</tr>','table\x20page','$product.room_name','length','paid_amount','POnumber','<h2>\x20','/preview/:id','Rack\x20E','$expiry_date','level','69603fDnZki','slice','sendMail','render','\x20</h2>','pallet','prod_pallet','<hr\x20class=\x22my-3\x22>','findById','suppliers_docs','$suppliers_docs','/barcode_scanner','Ambient','282kAICZL','prod_isle','production_date','language','418649pagqyb','DRY\x20STORAGE','get','$product_details.product_stock','room','log','$return_data','Enclosed','product_code','Return\x20Goods','success','$product_details.level','status','edit_purchases','/CheckingWarehouse','bin','</body></html>','prod_code','INC-','params','</head><body>','$date','$maxProdPerUnit','<tbody\x20style=\x22text-align:\x20center;\x22>','maxStocks','add\x20post','here','\x20Order\x20Date\x20:\x20','$_id','$name','$finalize','finalize','/view/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','6246256uJeOdi','$warehouse_name','$product','master','4EYLXQx','product','filter','/view/add_purchases/:id','$product_details.bay','<h5\x20style=\x22text-align:\x20left;\x22>','/view','28207619rgPkFZ','/all_purchases/view','stock_quantity','JO_number','suppliers','then','body','/barcode/:id','1095830WBwpDo','abs','Logo.png','</div>','$product_details.rack','Rack\x20B','30fOkdfW','$product_details.pallet','Portuguese\x20(BR)','createTransport','Spanish','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','return_qty','email','$due_amount','../middleware/auth','post','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getMonth','batch_code','prod_Qty','invoice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_unit','purchase_invoice','product_name','push','/all_purchases/view/','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$maxStocks','144109knkBAl','user','Router','Arabic\x20(ae)','currency_placement','RoomAssign','Floor','Purchase\x20Return\x20Mail','stocks'];a0_0x10e1=function(){return _0x4bb993;};return a0_0x10e1();}const path=require(a0_0x397cd0(0x260)),users=require('../public/language/languages.json');router[a0_0x397cd0(0x291)](a0_0x397cd0(0x198),auth,async(_0x20f1ae,_0x43a2fe)=>{var _0x367386=a0_0x397cd0;try{const {username:_0x42bcc6,email:_0x2b089d,role:_0x33efcd}=_0x20f1ae['user'],_0x2e85e7=_0x20f1ae[_0x367386(0x1c1)],_0x4be857=await profile[_0x367386(0x1d7)]({'email':_0x2e85e7['email']}),_0x41748c=await staff['findOne']({'email':_0x2e85e7['email']});if(_0x2e85e7[_0x367386(0x1e8)]=='staff'){const _0x71f63f=await staff[_0x367386(0x1d7)]({'email':_0x2e85e7['email']});}const _0x21dd0a=await master_shop[_0x367386(0x213)]();let _0x32e9df;if(_0x2e85e7['role']==_0x367386(0x21d)){const _0x1071c1=await staff[_0x367386(0x1d7)]({'email':_0x2e85e7[_0x367386(0x1af)]});_0x32e9df=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1071c1[_0x367386(0x1ac)]}},{'$lookup':{'from':_0x367386(0x19d),'localField':'suppliers','foreignField':_0x367386(0x1de),'as':_0x367386(0x287)}},{'$unwind':_0x367386(0x288)},{'$unwind':_0x367386(0x190)},{'$group':{'_id':_0x367386(0x188),'invoice':{'$first':_0x367386(0x20e)},'suppliers':{'$first':_0x367386(0x22f)},'date':{'$first':_0x367386(0x181)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x367386(0x190)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x367386(0x255)},'due_amount':{'$first':_0x367386(0x1b0)},'return_data':{'$first':_0x367386(0x172)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x367386(0x27c)},'suppliers_docs':{'$first':_0x367386(0x288)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x367386(0x24b)},'isle':{'$addToSet':_0x367386(0x220)},'type':{'$addToSet':_0x367386(0x236)},'floorlevel':{'$addToSet':_0x367386(0x263)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x32e9df=await purchases[_0x367386(0x269)]([{'$lookup':{'from':_0x367386(0x19d),'localField':'suppliers','foreignField':'name','as':_0x367386(0x287)}},{'$unwind':_0x367386(0x288)},{'$unwind':_0x367386(0x190)},{'$group':{'_id':_0x367386(0x188),'invoice':{'$first':_0x367386(0x20e)},'suppliers':{'$first':_0x367386(0x22f)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x367386(0x18f)},'room':{'$addToSet':_0x367386(0x275)},'product':{'$push':_0x367386(0x190)},'note':{'$first':_0x367386(0x1d3)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x367386(0x1b0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x367386(0x242)},'expiry_date':{'$first':_0x367386(0x27c)},'suppliers_docs':{'$first':_0x367386(0x288)},'total_product_quantity':{'$sum':_0x367386(0x233)},'level':{'$addToSet':_0x367386(0x24b)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x367386(0x236)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x367386(0x18a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x21dd0a[0x0][_0x367386(0x28e)]==_0x367386(0x209)){var _0x34281f=users[_0x367386(0x1ed)];console['log'](_0x34281f);}else{if(_0x21dd0a[0x0][_0x367386(0x28e)]==_0x367386(0x1db))var _0x34281f=users[_0x367386(0x1db)];else{if(_0x21dd0a[0x0][_0x367386(0x28e)]==_0x367386(0x24f))var _0x34281f=users[_0x367386(0x24f)];else{if(_0x21dd0a[0x0][_0x367386(0x28e)]==_0x367386(0x1ab))var _0x34281f=users['Spanish'];else{if(_0x21dd0a[0x0][_0x367386(0x28e)]==_0x367386(0x1e9))var _0x34281f=users['French'];else{if(_0x21dd0a[0x0]['language']==_0x367386(0x1a9))var _0x34281f=users[_0x367386(0x240)];else{if(_0x21dd0a[0x0][_0x367386(0x28e)]==_0x367386(0x1e5))var _0x34281f=users[_0x367386(0x1e5)];else{if(_0x21dd0a[0x0][_0x367386(0x28e)]=='Arabic\x20(ae)')var _0x34281f=users[_0x367386(0x25d)];}}}}}}}_0x43a2fe[_0x367386(0x281)](_0x367386(0x215),{'success':_0x20f1ae[_0x367386(0x211)](_0x367386(0x176)),'errors':_0x20f1ae[_0x367386(0x211)](_0x367386(0x217)),'purchases':_0x32e9df,'role':_0x2e85e7,'profile':_0x4be857,'master_shop':_0x21dd0a,'language':_0x34281f});}catch(_0x3f188b){console[_0x367386(0x171)](_0x367386(0x274),_0x3f188b),_0x43a2fe[_0x367386(0x178)](0xc8)['json']({'message':_0x3f188b['message']});}});function a0_0x4f54(_0x48b908,_0x11c764){var _0x10e1cf=a0_0x10e1();return a0_0x4f54=function(_0x4f5401,_0x4ec9de){_0x4f5401=_0x4f5401-0x171;var _0x6d73b=_0x10e1cf[_0x4f5401];return _0x6d73b;},a0_0x4f54(_0x48b908,_0x11c764);}function BayBinSelected(_0x2013ba,_0x2ce8f9){var _0xd5b183=a0_0x397cd0,_0x47aa1b=[],_0x287f74=[],_0x5a71d8=[],_0x488462=[],_0x36431e=[],_0x16396f=[];let _0x5d93c7=[];if(_0x2013ba==_0xd5b183(0x290))switch(_0x2ce8f9){case _0xd5b183(0x1eb):_0x47aa1b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x287f74=[0x1,0x2],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=[_0xd5b183(0x264),_0xd5b183(0x1c6)],_0x36431e=['D'],_0x16396f=['A'];break;case'Rack\x20B':_0x47aa1b=[0x6,0x5,0x4,0x3,0x2,0x1],_0x287f74=[0x1,0x2],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=[_0xd5b183(0x264),_0xd5b183(0x1c6)],_0x36431e=['D'],_0x16396f=['B'];break;case'Shelves':_0x47aa1b=[0x0],_0x287f74=[0x0],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=[_0xd5b183(0x1c6)],_0x36431e=['D'],_0x16396f=['S'];break;case _0xd5b183(0x1ec):_0x47aa1b=[0x0],_0x287f74=[0x0],_0x488462=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5a71d8=[_0xd5b183(0x1c6)],_0x36431e=['D'],_0x16396f=['R'];break;}else{if(_0x2013ba==_0xd5b183(0x268))switch(_0x2ce8f9){case _0xd5b183(0x1eb):_0x47aa1b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x287f74=['B','F'],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=[_0xd5b183(0x264),'Floor'],_0x36431e=['C'],_0x16396f=['A'];break;case _0xd5b183(0x1a6):_0x47aa1b=[0x5,0x4,0x3,0x2,0x1],_0x287f74=['F','B','S'],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=['Level',_0xd5b183(0x1c6)],_0x36431e=['C'],_0x16396f=['B'];break;case _0xd5b183(0x1e2):_0x47aa1b=[0x1,0x2,0x3,0x4,0x5],_0x287f74=['B','F','S'],_0x488462=[0x5,0x4,0x3,0x2,0x1],_0x5a71d8=[_0xd5b183(0x264),_0xd5b183(0x1c6)],_0x36431e=['C'],_0x16396f=['C'];break;case _0xd5b183(0x1d2):_0x47aa1b=[0x5,0x4,0x3,0x2,0x1],_0x287f74=['F','B','S'],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=[_0xd5b183(0x264),_0xd5b183(0x1c6)],_0x36431e=['C'],_0x16396f=['D'];break;case _0xd5b183(0x27b):_0x47aa1b=[0x4,0x3,0x2,0x1],_0x287f74=[0x1,0x2],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=['Level',_0xd5b183(0x1c6)],_0x36431e=['C'],_0x16396f=['E'];break;case _0xd5b183(0x214):_0x47aa1b=[0x1,0x2,0x3],_0x287f74=[0x1,0x2],_0x488462=[0x1,0x2,0x3,0x4,0x5],_0x5a71d8=[_0xd5b183(0x264)],_0x36431e=['C'],_0x16396f=['F'];break;}}return{'levels':_0x47aa1b,'Isle':_0x287f74,'rack':_0x488462,'type':_0x5a71d8,'storage':_0x36431e,'rak':_0x16396f};}async function getRandom8DigitNumber(){var _0x5b7483=a0_0x397cd0;const _0x5f57dc=0x989680,_0x555027=0x5f5e0ff,_0x52737d=Math[_0x5b7483(0x230)](Math[_0x5b7483(0x1e3)]()*(_0x555027-_0x5f57dc+0x1))+_0x5f57dc;var _0x3f96a6;const _0x210639=await purchases['findOne']({'invoice':'INC-'+_0x52737d});return _0x210639&&_0x210639[_0x5b7483(0x276)]>0x0?_0x3f96a6='INC-'+_0x52737d:_0x3f96a6=_0x5b7483(0x17e)+_0x52737d,_0x3f96a6;}router[a0_0x397cd0(0x291)](a0_0x397cd0(0x26e),auth,async(_0x4b8f00,_0x15257a)=>{var _0x4d6b9c=a0_0x397cd0;try{const {username:_0xa1a1df,email:_0x2dafbe,role:_0x2ab7a6}=_0x4b8f00[_0x4d6b9c(0x1c1)],_0x5b99d2=_0x4b8f00[_0x4d6b9c(0x1c1)],_0x3367a1=await profile[_0x4d6b9c(0x1d7)]({'email':_0x5b99d2['email']}),_0x24a6b2=await master_shop['find'](),_0x431b06=await staff[_0x4d6b9c(0x1d7)]({'email':_0x5b99d2[_0x4d6b9c(0x1af)]}),_0x173c7a=await suppliers['find']({});let _0x1b514a;if(_0x5b99d2[_0x4d6b9c(0x1e8)]==_0x4d6b9c(0x21d)){const _0x4a25a2=await staff[_0x4d6b9c(0x1d7)]({'email':_0x5b99d2[_0x4d6b9c(0x1af)]});_0x1b514a=await warehouse[_0x4d6b9c(0x269)]([{'$match':{'status':_0x4d6b9c(0x25b),'name':_0x4a25a2[_0x4d6b9c(0x1ac)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x4d6b9c(0x175)}}},{'$group':{'_id':'$name','name':{'$first':_0x4d6b9c(0x189)}}}]);}else _0x1b514a=await warehouse['aggregate']([{'$match':{'status':_0x4d6b9c(0x25b),'warehouse_category':_0x4d6b9c(0x202),'name':{'$ne':_0x4d6b9c(0x175)}}},{'$group':{'_id':_0x4d6b9c(0x189),'name':{'$first':_0x4d6b9c(0x189)}}}]);const _0x25a5e4=await product[_0x4d6b9c(0x213)]({}),_0x2020d3=await warehouse[_0x4d6b9c(0x213)]({'status':_0x4d6b9c(0x25b)}),_0x4bd5bb=await purchases[_0x4d6b9c(0x213)]({}),_0xdee309=_0x4bd5bb[_0x4d6b9c(0x276)]+0x1,_0x50f08f='INC-'+_0xdee309[_0x4d6b9c(0x21e)]()[_0x4d6b9c(0x205)](0x5,'0');var _0x321b81=[_0x4d6b9c(0x28a),_0x4d6b9c(0x173)];if(_0x24a6b2[0x0]['language']=='English\x20(US)')var _0x4a7a00=users[_0x4d6b9c(0x1ed)];else{if(_0x24a6b2[0x0][_0x4d6b9c(0x28e)]=='Hindi')var _0x4a7a00=users[_0x4d6b9c(0x1db)];else{if(_0x24a6b2[0x0][_0x4d6b9c(0x28e)]=='German')var _0x4a7a00=users[_0x4d6b9c(0x24f)];else{if(_0x24a6b2[0x0][_0x4d6b9c(0x28e)]==_0x4d6b9c(0x1ab))var _0x4a7a00=users[_0x4d6b9c(0x1ab)];else{if(_0x24a6b2[0x0][_0x4d6b9c(0x28e)]==_0x4d6b9c(0x1e9))var _0x4a7a00=users['French'];else{if(_0x24a6b2[0x0][_0x4d6b9c(0x28e)]==_0x4d6b9c(0x1a9))var _0x4a7a00=users[_0x4d6b9c(0x240)];else{if(_0x24a6b2[0x0]['language']==_0x4d6b9c(0x1e5))var _0x4a7a00=users[_0x4d6b9c(0x1e5)];else{if(_0x24a6b2[0x0]['language']=='Arabic\x20(ae)')var _0x4a7a00=users[_0x4d6b9c(0x25d)];}}}}}}}const _0x3bc63a=getRandom8DigitNumber();_0x3bc63a[_0x4d6b9c(0x19e)](_0x578872=>{var _0x3ae354=_0x4d6b9c;_0x15257a[_0x3ae354(0x281)](_0x3ae354(0x21a),{'success':_0x4b8f00['flash'](_0x3ae354(0x176)),'errors':_0x4b8f00[_0x3ae354(0x211)](_0x3ae354(0x217)),'role':_0x5b99d2,'profile':_0x3367a1,'suppliers':_0x173c7a,'warehouse':_0x1b514a,'product':_0x25a5e4,'invoice':_0x578872,'master_shop':_0x24a6b2,'language':_0x4a7a00,'find_data':_0x2020d3,'rooms_data':_0x321b81});})[_0x4d6b9c(0x212)](_0x22d0a5=>{var _0x5d8cb5=_0x4d6b9c;_0x4b8f00[_0x5d8cb5(0x211)](_0x5d8cb5(0x217),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x15257a[_0x5d8cb5(0x1c9)](_0x5d8cb5(0x19a));});}catch(_0x31b772){console[_0x4d6b9c(0x171)](_0x31b772);}}),router[a0_0x397cd0(0x291)](a0_0x397cd0(0x195),auth,async(_0x1e5ffe,_0x1f931b)=>{var _0x2c40f5=a0_0x397cd0;try{const _0x2af3c8=_0x1e5ffe[_0x2c40f5(0x17f)]['id'];console[_0x2c40f5(0x171)](_0x2af3c8);const _0x261d3c=await master_shop[_0x2c40f5(0x213)]();console['log'](_0x2c40f5(0x191),_0x261d3c);const _0x1ae4e0=await product['findOne']({'name':_0x2af3c8});console['log'](_0x2c40f5(0x193),_0x1ae4e0),_0x1f931b[_0x2c40f5(0x178)](0xc8)[_0x2c40f5(0x1e1)]({'product_data':_0x1ae4e0,'master':_0x261d3c});}catch(_0x5015a6){console[_0x2c40f5(0x171)]('add_purchases\x20error',_0x5015a6);}}),router[a0_0x397cd0(0x1b2)](a0_0x397cd0(0x26e),auth,async(_0x1e929a,_0x5510b7)=>{var _0x4b1d38=a0_0x397cd0;try{const {invoice:_0xc9d5ad,date:_0x441574,warehouse_name:_0x3b2acf,prod_name:_0x2f230e,prod_code:_0x1a0d92,prod_qty:_0x2d7336,prod_unit:_0x3f53f6,prod_secondunit:_0x4ce070,prod_level:_0x537303,prod_isle:_0x2c0e54,prod_pallet:_0x41de13,note:_0x27dced,expiry_date:_0x3d8f91,batch_code:_0x470e41,payable:_0x53016e,due_amount:_0x47627c,Room_name:_0x579e32,primary_code:_0x269521,secondary_code:_0x184641,MaxStocks_data:_0x7eb7ff,PO_number:_0x5ae8ee,SCRN:_0x2e2bc1,JO_number:_0x23b70c}=_0x1e929a['body'];if(typeof _0x2f230e==_0x4b1d38(0x26b))var _0x3d763=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x26f)]],_0x5e2db1=[_0x1e929a['body'][_0x4b1d38(0x17d)]],_0x27f762=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1b6)]],_0x5500f5=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x254)]],_0x2cd1b3=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x200)]],_0xa89690=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x25a)]],_0x2f03c5=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x204)]],_0x231e20=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1f2)]],_0x312123=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x266)]],_0x11d6eb=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1b5)]],_0x2cb83a=[_0x1e929a[_0x4b1d38(0x19f)]['expiry_date']],_0x263df9=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x25f)]],_0x2fac28=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1fb)]],_0x1c0f53=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x28d)]],_0x27f3a4=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x26a)]],_0x47ddde=[_0x1e929a['body'][_0x4b1d38(0x1c5)]],_0x4f7852=[_0x1e929a['body'][_0x4b1d38(0x1ea)]],_0x403cf6=[_0x1e929a[_0x4b1d38(0x19f)]['prod_invoice']],_0x4d9b57=[_0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x243)]],_0x33bffc=[_0x1e929a['body'][_0x4b1d38(0x216)]];else var _0x3d763=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x26f)]],_0x5e2db1=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x17d)]],_0x27f762=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1b6)]],_0x5500f5=[..._0x1e929a['body']['prod_primunit']],_0x2cd1b3=[..._0x1e929a[_0x4b1d38(0x19f)]['prod_secondunit']],_0xa89690=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x25a)]],_0x2f03c5=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x204)]],_0x231e20=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1f2)]],_0x312123=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x266)]],_0x11d6eb=[..._0x1e929a['body'][_0x4b1d38(0x1b5)]],_0x2cb83a=[..._0x1e929a['body']['expiry_date']],_0x263df9=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x25f)]],_0x2fac28=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1fb)]],_0x1c0f53=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x28d)]],_0x27f3a4=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x26a)]],_0x47ddde=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1c5)]],_0x4f7852=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x1ea)]],_0x403cf6=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x222)]],_0x4d9b57=[..._0x1e929a[_0x4b1d38(0x19f)][_0x4b1d38(0x243)]],_0x33bffc=[..._0x1e929a['body'][_0x4b1d38(0x216)]];const _0x301c84=_0x3d763[_0x4b1d38(0x1cc)](_0xb5f681=>{return _0xb5f681={'product_name':_0xb5f681};});_0x4d9b57[_0x4b1d38(0x23c)]((_0x192dd6,_0x339c5c)=>{var _0x2933bd=_0x4b1d38;_0x301c84[_0x339c5c][_0x2933bd(0x243)]=Math[_0x2933bd(0x1a2)](_0x192dd6);}),_0x33bffc[_0x4b1d38(0x23c)]((_0x2e4a45,_0x2bc777)=>{var _0x161d68=_0x4b1d38;_0x301c84[_0x2bc777][_0x161d68(0x216)]=_0x2e4a45;}),_0x5e2db1[_0x4b1d38(0x23c)]((_0x21f510,_0x18e5f4)=>{var _0x4075a1=_0x4b1d38;_0x301c84[_0x18e5f4][_0x4075a1(0x174)]=_0x21f510;}),_0x27f762[_0x4b1d38(0x23c)]((_0x88b81b,_0x342a8a)=>{var _0x1ca7c4=_0x4b1d38;_0x301c84[_0x342a8a][_0x1ca7c4(0x234)]=Math['abs'](_0x88b81b);}),_0x5500f5[_0x4b1d38(0x23c)]((_0x5a357f,_0x9c8e6d)=>{var _0x14e49f=_0x4b1d38;_0x301c84[_0x9c8e6d][_0x14e49f(0x22d)]=_0x5a357f;}),_0x2cd1b3[_0x4b1d38(0x23c)]((_0x5563e,_0x488366)=>{_0x301c84[_0x488366]['secondary_unit']=_0x5563e;}),_0xa89690[_0x4b1d38(0x23c)]((_0x41176c,_0x12f216)=>{var _0x10201a=_0x4b1d38;_0x47ddde[_0x10201a(0x23c)]((_0x41abde,_0x302e4c)=>{var _0x47abbd=_0x10201a;if(_0x41abde=='Receiving\x20Area'&&_0x12f216==_0x302e4c){console[_0x47abbd(0x171)](_0x41abde+'\x20<\x20wew\x20>\x20'+_0x12f216+_0x47abbd(0x20c)+_0x302e4c+'\x20<>\x20'+_0x41176c);var _0x22f0d7=_0x41176c[_0x47abbd(0x27f)](0x3);_0x301c84[_0x12f216]['storage']=_0x41176c[0x0],_0x301c84[_0x12f216][_0x47abbd(0x219)]=_0x41176c[0x1],_0x301c84[_0x12f216]['bay']=0x0,_0x301c84[_0x12f216][_0x47abbd(0x17b)]=0x0,_0x301c84[_0x12f216][_0x47abbd(0x1d6)]='Floor',_0x301c84[_0x12f216][_0x47abbd(0x1ce)]=_0x22f0d7;}else{if(_0x41abde==_0x47abbd(0x246)&&_0x12f216==_0x302e4c){var _0x22f0d7=_0x41176c[_0x47abbd(0x27f)](0x3);_0x301c84[_0x12f216][_0x47abbd(0x25c)]=_0x41176c[0x0],_0x301c84[_0x12f216]['rack']=_0x41176c[0x1],_0x301c84[_0x12f216][_0x47abbd(0x1e4)]=0x0,_0x301c84[_0x12f216][_0x47abbd(0x17b)]=0x0,_0x301c84[_0x12f216][_0x47abbd(0x1d6)]=_0x47abbd(0x1c6),_0x301c84[_0x12f216][_0x47abbd(0x1ce)]=_0x41176c[0x5];}else{if(_0x12f216==_0x302e4c){if(_0x41176c[0x0]=='A'&&_0x41176c[0x1]=='L'&&_0x41176c[0x2]=='L')console[_0x47abbd(0x171)](_0x41abde+_0x47abbd(0x20c)+_0x12f216+_0x47abbd(0x20c)+_0x302e4c+_0x47abbd(0x20c)+_0x41176c+_0x47abbd(0x186)),_0x301c84[_0x12f216]['storage']=_0x41176c[0x0],_0x301c84[_0x12f216][_0x47abbd(0x219)]=_0x41176c[0x1],_0x301c84[_0x12f216][_0x47abbd(0x1e4)]=0x0,_0x301c84[_0x12f216][_0x47abbd(0x17b)]=0x0,_0x301c84[_0x12f216][_0x47abbd(0x1d6)]='Floor',_0x301c84[_0x12f216]['floorlevel']=_0x41176c[0x3];else{var _0x222208;if(_0x41176c[0x4]=='L')_0x222208=_0x47abbd(0x264);else _0x41176c[0x4]=='F'&&(_0x222208='Floor');_0x301c84[_0x12f216][_0x47abbd(0x25c)]=_0x41176c[0x0],_0x301c84[_0x12f216][_0x47abbd(0x219)]=_0x41176c[0x1],_0x301c84[_0x12f216]['bay']=_0x41176c[0x2],_0x301c84[_0x12f216]['bin']=_0x41176c[0x3],_0x301c84[_0x12f216][_0x47abbd(0x1d6)]=_0x222208,_0x301c84[_0x12f216][_0x47abbd(0x1ce)]=_0x41176c[0x5];}}}}});}),_0x2f03c5[_0x4b1d38(0x23c)]((_0x1b9355,_0xcf3730)=>{var _0x51ffc3=_0x4b1d38;_0x301c84[_0xcf3730][_0x51ffc3(0x204)]=_0x1b9355;}),_0x231e20['forEach']((_0x4d5ff0,_0x29f8a4)=>{var _0x5d4309=_0x4b1d38;_0x301c84[_0x29f8a4][_0x5d4309(0x1f2)]=_0x4d5ff0;}),_0x312123[_0x4b1d38(0x23c)]((_0x4827b5,_0x211f7c)=>{_0x301c84[_0x211f7c]['maxStocks']=_0x4827b5;}),_0x11d6eb[_0x4b1d38(0x23c)]((_0x5460ba,_0x4d2393)=>{var _0x14f30d=_0x4b1d38;_0x301c84[_0x4d2393][_0x14f30d(0x1b5)]=_0x5460ba;}),_0x2cb83a[_0x4b1d38(0x23c)]((_0x463648,_0x12f9bf)=>{var _0x2f00cb=_0x4b1d38;_0x301c84[_0x12f9bf][_0x2f00cb(0x248)]=_0x463648;}),_0x263df9[_0x4b1d38(0x23c)]((_0xaa54ad,_0x24fc66)=>{_0x301c84[_0x24fc66]['maxperunit']=_0xaa54ad;}),_0x2fac28[_0x4b1d38(0x23c)]((_0x4061f1,_0xca047f)=>{var _0x4fcecf=_0x4b1d38;_0x301c84[_0xca047f][_0x4fcecf(0x1fb)]=_0x4061f1;}),_0x1c0f53[_0x4b1d38(0x23c)]((_0x52aeb6,_0x4202b3)=>{_0x301c84[_0x4202b3]['production_date']=_0x52aeb6;}),_0x27f3a4['forEach']((_0x571dd1,_0x285048)=>{_0x301c84[_0x285048]['product_cat']=_0x571dd1;}),_0x47ddde[_0x4b1d38(0x23c)]((_0x364127,_0x335021)=>{var _0x4efc7d=_0x4b1d38;_0x301c84[_0x335021][_0x4efc7d(0x1e0)]=_0x364127;}),_0x4f7852['forEach']((_0x2807f4,_0x148db8)=>{var _0x3ad436=_0x4b1d38;_0x301c84[_0x148db8][_0x3ad436(0x1ee)]=_0x2807f4;}),_0x403cf6[_0x4b1d38(0x23c)]((_0x4b66bc,_0x2b6dd6)=>{var _0x10ef16=_0x4b1d38;_0x301c84[_0x2b6dd6][_0x10ef16(0x1b7)]=_0x4b66bc;});const _0x7e5075=_0x47ddde[_0x4b1d38(0x1cc)](_0x256858=>{return _0x256858={'room_name':_0x256858};}),_0x3ed406=_0x301c84[_0x4b1d38(0x194)](_0x27bd1e=>_0x27bd1e[_0x4b1d38(0x234)]!=='0'&&_0x27bd1e[_0x4b1d38(0x234)]!==''),_0x2c3c79=new purchases({'invoice':_0xc9d5ad,'suppliers':_0x1e929a['body'][_0x4b1d38(0x19d)],'date':_0x441574,'warehouse_name':_0x3b2acf,'product':_0x3ed406,'note':_0x27dced,'due_amount':_0x47627c,'POnumber':_0x5ae8ee,'SCRN':_0x2e2bc1,'JO_number':_0x23b70c,'roomList':_0x7e5075}),_0x38c9d7=await _0x2c3c79[_0x4b1d38(0x239)](),_0x5ce004=await purchases[_0x4b1d38(0x1d7)]({'invoice':_0xc9d5ad}),_0x3c9d35=_0x5ce004[_0x4b1d38(0x193)][_0x4b1d38(0x1cc)](async _0x4fe3d7=>{var _0x17a9c4=_0x4b1d38,_0x45b65a=await warehouse[_0x17a9c4(0x1d7)]({'name':_0x3b2acf,'room':_0x4fe3d7['room_name']}),_0x432adc=0x0;return _0x45b65a[_0x17a9c4(0x1ff)][_0x17a9c4(0x23c)](_0x4947cf=>{var _0x54e9d4=_0x17a9c4;_0x4947cf[_0x54e9d4(0x1bb)]==_0x4fe3d7['product_name']&&_0x4947cf[_0x54e9d4(0x1ce)]==_0x4fe3d7[_0x54e9d4(0x1ce)]&&_0x4947cf[_0x54e9d4(0x1d6)]==_0x4fe3d7[_0x54e9d4(0x1d6)]&&_0x4947cf[_0x54e9d4(0x17b)]==_0x4fe3d7[_0x54e9d4(0x17b)]&&_0x4947cf[_0x54e9d4(0x1e4)]==_0x4fe3d7[_0x54e9d4(0x1e4)]&&_0x4947cf[_0x54e9d4(0x219)]==_0x4fe3d7[_0x54e9d4(0x219)]&&_0x4947cf[_0x54e9d4(0x25c)]==_0x4fe3d7[_0x54e9d4(0x25c)]&&_0x4947cf[_0x54e9d4(0x248)]==_0x4fe3d7[_0x54e9d4(0x248)]&&_0x4947cf[_0x54e9d4(0x1b5)]==_0x4fe3d7[_0x54e9d4(0x1b5)]&&_0x4947cf['production_date']==_0x4fe3d7[_0x54e9d4(0x28d)]&&_0x4947cf[_0x54e9d4(0x1b7)]==_0x5ce004[_0x54e9d4(0x1b7)]&&(_0x4947cf['product_stock']+=Math[_0x54e9d4(0x1a2)](_0x4fe3d7[_0x54e9d4(0x234)]),_0x432adc++);}),_0x432adc===0x0&&_0x45b65a[_0x17a9c4(0x1ff)][_0x17a9c4(0x1bc)]({'product_name':_0x4fe3d7[_0x17a9c4(0x1bb)],'product_stock':Math[_0x17a9c4(0x1a2)](_0x4fe3d7[_0x17a9c4(0x234)]),'primary_code':_0x4fe3d7[_0x17a9c4(0x204)],'secondary_code':_0x4fe3d7['secondary_code'],'product_code':_0x4fe3d7[_0x17a9c4(0x174)],'storage':_0x4fe3d7['storage'],'rack':_0x4fe3d7[_0x17a9c4(0x219)],'bay':_0x4fe3d7[_0x17a9c4(0x1e4)],'bin':_0x4fe3d7[_0x17a9c4(0x17b)],'type':_0x4fe3d7[_0x17a9c4(0x1d6)],'floorlevel':_0x4fe3d7[_0x17a9c4(0x1ce)],'maxProducts':_0x4fe3d7[_0x17a9c4(0x184)],'unit':_0x4fe3d7[_0x17a9c4(0x22d)],'secondary_unit':_0x4fe3d7[_0x17a9c4(0x1d1)],'expiry_date':_0x4fe3d7[_0x17a9c4(0x248)],'maxPerUnit':_0x4fe3d7[_0x17a9c4(0x1ca)],'batch_code':_0x4fe3d7[_0x17a9c4(0x1b5)],'alertQTY':_0x4fe3d7['alertQTY'],'production_date':_0x4fe3d7[_0x17a9c4(0x28d)],'product_cat':_0x4fe3d7[_0x17a9c4(0x1d0)],'invoice':_0x4fe3d7['invoice'],'actual_qty':Math['abs'](_0x4fe3d7[_0x17a9c4(0x243)]),'actual_uom':_0x4fe3d7[_0x17a9c4(0x216)]}),_0x45b65a;});Promise[_0x4b1d38(0x201)](_0x3c9d35)[_0x4b1d38(0x19e)](async _0x11017e=>{var _0x6c32e5=_0x4b1d38;try{for(const _0x4f19ee of _0x11017e){await _0x4f19ee[_0x6c32e5(0x239)]();}const _0x119e73=await master_shop[_0x6c32e5(0x213)](),_0x4f5446=await email_settings[_0x6c32e5(0x1d7)](),_0x165762=await supervisor_settings[_0x6c32e5(0x213)]();var _0x55a03c=_0x5ce004[_0x6c32e5(0x193)],_0x9661c4='',_0x22b45b;for(_0x22b45b in _0x55a03c){_0x9661c4+=_0x6c32e5(0x1f6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x55a03c[_0x22b45b][_0x6c32e5(0x1bb)]+_0x6c32e5(0x23b)+_0x6c32e5(0x1b8)+_0x55a03c[_0x22b45b]['product_code']+_0x6c32e5(0x23b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x55a03c[_0x22b45b][_0x6c32e5(0x234)]+_0x6c32e5(0x23b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x55a03c[_0x22b45b][_0x6c32e5(0x22d)]+_0x6c32e5(0x23b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x55a03c[_0x22b45b]['secondary_unit']+_0x6c32e5(0x23b)+_0x6c32e5(0x1b8)+_0x5ce004[_0x6c32e5(0x1d4)]+_0x6c32e5(0x23b)+_0x6c32e5(0x1b8)+_0x55a03c[_0x22b45b][_0x6c32e5(0x1e0)]+_0x6c32e5(0x23b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x55a03c[_0x22b45b][_0x6c32e5(0x25c)]+_0x55a03c[_0x22b45b][_0x6c32e5(0x219)]+_0x55a03c[_0x22b45b][_0x6c32e5(0x1e4)]+_0x55a03c[_0x22b45b][_0x6c32e5(0x17b)]+_0x55a03c[_0x22b45b][_0x6c32e5(0x1d6)][0x0]+_0x55a03c[_0x22b45b]['floorlevel']+_0x6c32e5(0x23b),_0x6c32e5(0x273);}let _0x3c4500=nodemailer['createTransport']({'host':_0x4f5446['host'],'port':Number(_0x4f5446['port']),'secure':![],'auth':{'user':_0x4f5446[_0x6c32e5(0x1af)],'pass':_0x4f5446[_0x6c32e5(0x235)]}}),_0x1a2ab6={'from':_0x4f5446[_0x6c32e5(0x1af)],'to':_0x165762[0x0][_0x6c32e5(0x22e)],'subject':_0x6c32e5(0x227),'attachments':[{'filename':_0x6c32e5(0x1a3),'path':__dirname+_0x6c32e5(0x272)+_0x6c32e5(0x24d)+_0x119e73[0x0][_0x6c32e5(0x26d)],'cid':_0x6c32e5(0x1fc)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x6c32e5(0x180)+'<div>'+_0x6c32e5(0x270)+_0x6c32e5(0x26c)+_0x6c32e5(0x1b3)+_0x6c32e5(0x1a4)+_0x6c32e5(0x26c)+_0x6c32e5(0x279)+_0x119e73[0x0][_0x6c32e5(0x257)]+_0x6c32e5(0x282)+'</div>'+_0x6c32e5(0x1a4)+_0x6c32e5(0x285)+_0x6c32e5(0x26c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x6c32e5(0x21c)+_0x5ce004[_0x6c32e5(0x1b7)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x6c32e5(0x187)+_0x5ce004[_0x6c32e5(0x231)]+'\x20'+'</span>'+_0x6c32e5(0x1dc)+_0x6c32e5(0x1a4)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x6c32e5(0x1be)+'<tr>'+_0x6c32e5(0x232)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x6c32e5(0x1da)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x6c32e5(0x1fa)+_0x6c32e5(0x238)+_0x6c32e5(0x228)+_0x6c32e5(0x273)+'</thead>'+_0x6c32e5(0x183)+'\x20'+_0x9661c4+'\x20'+_0x6c32e5(0x1f5)+_0x6c32e5(0x24c)+_0x6c32e5(0x26c)+'<strong>\x20Regards\x20</strong>'+_0x6c32e5(0x206)+_0x119e73[0x0]['site_title']+'</h5>'+_0x6c32e5(0x1a4)+_0x6c32e5(0x1a4)+_0x6c32e5(0x17c)};_0x3c4500[_0x6c32e5(0x280)](_0x1a2ab6,function(_0x5927c6,_0xca4008){var _0x8d915b=_0x6c32e5;_0x5927c6?(console[_0x8d915b(0x171)](_0x5927c6),console[_0x8d915b(0x171)]('Error\x20Occurs')):console[_0x8d915b(0x171)](_0x8d915b(0x1f7));}),_0x1e929a['flash'](_0x6c32e5(0x176),_0x6c32e5(0x1f8)),_0x5510b7[_0x6c32e5(0x1c9)](_0x6c32e5(0x1bd));}catch(_0x5be0de){console[_0x6c32e5(0x1df)](_0x5be0de),_0x5510b7[_0x6c32e5(0x178)](0x1f4)[_0x6c32e5(0x1e1)]({'error':_0x6c32e5(0x18d)});}})['catch'](_0x2e9fe7=>{var _0x48df72=_0x4b1d38;console['error'](_0x2e9fe7),_0x5510b7[_0x48df72(0x178)](0x1f4)[_0x48df72(0x1e1)]({'error':'An\x20error\x20occurred.'});});}catch(_0x2599ed){console[_0x4b1d38(0x171)](_0x2599ed);}}),router[a0_0x397cd0(0x291)](a0_0x397cd0(0x27a),auth,async(_0x17419d,_0x42b248)=>{var _0x3ac791=a0_0x397cd0;try{const {username:_0xc19f5c,email:_0x3de829,role:_0x112bfc}=_0x17419d[_0x3ac791(0x1c1)],_0x48746e=_0x17419d[_0x3ac791(0x1c1)],_0x3a9bc0=await profile[_0x3ac791(0x1d7)]({'email':_0x48746e[_0x3ac791(0x1af)]}),_0x602e63=await master_shop[_0x3ac791(0x213)](),_0x316632=_0x17419d[_0x3ac791(0x17f)]['id'],_0x20f9e0=await purchases[_0x3ac791(0x286)](_0x316632),_0x1ca19b=await warehouse[_0x3ac791(0x269)]([{'$match':{'name':_0x20f9e0[_0x3ac791(0x1d4)],'room':_0x20f9e0['room']}},{'$unwind':_0x3ac791(0x256)},{'$group':{'_id':_0x3ac791(0x258),'name':{'$first':_0x3ac791(0x208)},'product_stock':{'$first':_0x3ac791(0x292)},'bay':{'$first':_0x3ac791(0x196)},'bin':{'$first':_0x3ac791(0x229)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3ac791(0x210)},'primary_code':{'$first':_0x3ac791(0x22a)},'secondary_code':{'$first':_0x3ac791(0x1f0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3ac791(0x203)},'rack':{'$first':_0x3ac791(0x1a5)},'expiry_date':{'$first':_0x3ac791(0x24a)}}}]),_0x27a149=await customer[_0x3ac791(0x213)]({});let _0x2b6a40;if(_0x48746e[_0x3ac791(0x1e8)]==_0x3ac791(0x21d)){const _0x1c2d45=await staff[_0x3ac791(0x1d7)]({'email':_0x48746e[_0x3ac791(0x1af)]});_0x2b6a40=await warehouse[_0x3ac791(0x269)]([{'$match':{'status':_0x3ac791(0x25b),'name':_0x1c2d45['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x3ac791(0x189)}}}]);}else _0x2b6a40=await warehouse[_0x3ac791(0x269)]([{'$match':{'status':_0x3ac791(0x25b)}},{'$group':{'_id':_0x3ac791(0x189),'name':{'$first':_0x3ac791(0x189)}}}]);const _0x3d9901=await product[_0x3ac791(0x213)]({}),_0x5f2a48=await suppliers[_0x3ac791(0x213)]({}),_0x3900f7=BayBinSelected(_0x20f9e0[_0x3ac791(0x1d4)],_0x20f9e0[_0x3ac791(0x293)]);if(_0x602e63[0x0][_0x3ac791(0x28e)]==_0x3ac791(0x209)){var _0x3af760=users[_0x3ac791(0x1ed)];console[_0x3ac791(0x171)](_0x3af760);}else{if(_0x602e63[0x0][_0x3ac791(0x28e)]=='Hindi')var _0x3af760=users['Hindi'];else{if(_0x602e63[0x0][_0x3ac791(0x28e)]=='German')var _0x3af760=users[_0x3ac791(0x24f)];else{if(_0x602e63[0x0]['language']==_0x3ac791(0x1ab))var _0x3af760=users[_0x3ac791(0x1ab)];else{if(_0x602e63[0x0][_0x3ac791(0x28e)]==_0x3ac791(0x1e9))var _0x3af760=users[_0x3ac791(0x1e9)];else{if(_0x602e63[0x0][_0x3ac791(0x28e)]==_0x3ac791(0x1a9))var _0x3af760=users[_0x3ac791(0x240)];else{if(_0x602e63[0x0][_0x3ac791(0x28e)]==_0x3ac791(0x1e5))var _0x3af760=users['Chinese'];else{if(_0x602e63[0x0][_0x3ac791(0x28e)]==_0x3ac791(0x1c3))var _0x3af760=users[_0x3ac791(0x25d)];}}}}}}}_0x42b248['render']('edit_purchases_view',{'success':_0x17419d[_0x3ac791(0x211)](_0x3ac791(0x176)),'errors':_0x17419d['flash'](_0x3ac791(0x217)),'role':_0x48746e,'profile':_0x3a9bc0,'customer':_0x27a149,'warehouse':_0x2b6a40,'product':_0x1ca19b,'user':_0x20f9e0,'master_shop':_0x602e63,'unit':_0x3d9901,'language':_0x3af760,'suppliers':_0x5f2a48,'dataSelected':_0x3900f7});}catch(_0x1c38af){console[_0x3ac791(0x171)](_0x1c38af);}}),router['post'](a0_0x397cd0(0x27a),auth,async(_0x30363d,_0x17828b)=>{var _0x18d773=a0_0x397cd0;try{const _0x582775=_0x30363d['params']['id'],{invoice:_0x2f7ac2,warehouse_name:_0xa58c8,Room_name:_0x438c53}=_0x30363d[_0x18d773(0x19f)],_0x4f7ad8=await warehouse[_0x18d773(0x1d7)]({'name':_0xa58c8,'room':_0x438c53}),_0xf09073=await purchases[_0x18d773(0x1d7)]({'invoice':_0x2f7ac2});_0xf09073[_0x18d773(0x193)][_0x18d773(0x23c)](_0x1e9c8c=>{var _0x50c089=_0x18d773,_0x9a7461=0x0;const _0x48b263=_0x4f7ad8[_0x50c089(0x1ff)][_0x50c089(0x1cc)](_0x1325b6=>{var _0x5219e0=_0x50c089;_0x1325b6['product_name']==_0x1e9c8c[_0x5219e0(0x1bb)]&&_0x1325b6[_0x5219e0(0x1ce)]==_0x1e9c8c['floorlevel']&&_0x1325b6[_0x5219e0(0x1d6)]==_0x1e9c8c['type']&&_0x1325b6['bin']==_0x1e9c8c['bin']&&_0x1325b6[_0x5219e0(0x1e4)]==_0x1e9c8c[_0x5219e0(0x1e4)]&&_0x1325b6[_0x5219e0(0x219)]==_0x1e9c8c[_0x5219e0(0x219)]&&_0x1325b6[_0x5219e0(0x25c)]==_0x1e9c8c[_0x5219e0(0x25c)]&&_0x1325b6['expiry_date']==_0x1e9c8c[_0x5219e0(0x248)]&&_0x1325b6[_0x5219e0(0x1b5)]==_0x1e9c8c[_0x5219e0(0x1b5)]&&_0x1325b6[_0x5219e0(0x28d)]==_0x1e9c8c[_0x5219e0(0x28d)]&&_0x1325b6[_0x5219e0(0x262)]==_0x1e9c8c[_0x5219e0(0x262)]&&_0x1325b6['delivery_code']==_0x1e9c8c[_0x5219e0(0x1ee)]&&(_0x1325b6[_0x5219e0(0x21b)]=parseInt(_0x1325b6[_0x5219e0(0x21b)])+parseInt(_0x1e9c8c['quantity']),_0x9a7461++);});_0x9a7461=='0'&&(_0x4f7ad8[_0x50c089(0x1ff)]=_0x4f7ad8['product_details'][_0x50c089(0x223)]({'product_name':_0x1e9c8c[_0x50c089(0x1bb)],'product_stock':_0x1e9c8c['quantity'],'primary_code':_0x1e9c8c['primary_code'],'secondary_code':_0x1e9c8c[_0x50c089(0x1f2)],'product_code':_0x1e9c8c['product_code'],'storage':_0x1e9c8c[_0x50c089(0x25c)],'rack':_0x1e9c8c[_0x50c089(0x219)],'bay':_0x1e9c8c['bay'],'bin':_0x1e9c8c[_0x50c089(0x17b)],'type':_0x1e9c8c[_0x50c089(0x1d6)],'floorlevel':_0x1e9c8c[_0x50c089(0x1ce)],'maxProducts':_0x1e9c8c[_0x50c089(0x184)],'unit':_0x1e9c8c['standard_unit'],'secondary_unit':_0x1e9c8c[_0x50c089(0x1d1)],'expiry_date':_0x1e9c8c[_0x50c089(0x248)],'maxPerUnit':_0x1e9c8c['maxperunit'],'batch_code':_0x1e9c8c[_0x50c089(0x1b5)],'alertQTY':_0x1e9c8c[_0x50c089(0x1fb)],'production_date':_0x1e9c8c[_0x50c089(0x28d)],'delivery_date':_0x1e9c8c[_0x50c089(0x262)],'delivery_code':_0x1e9c8c[_0x50c089(0x1ee)]}));}),await _0x4f7ad8[_0x18d773(0x239)](),_0xf09073[_0x18d773(0x18b)]='True';const _0x3535e5=await _0xf09073[_0x18d773(0x239)]();_0x30363d[_0x18d773(0x211)](_0x18d773(0x176),_0x18d773(0x267)),_0x17828b[_0x18d773(0x1c9)]('/all_purchases/view');}catch(_0xad5633){console[_0x18d773(0x171)](_0xad5633);}}),router[a0_0x397cd0(0x291)](a0_0x397cd0(0x18c),auth,async(_0x5f5728,_0x54f70a)=>{var _0x53391d=a0_0x397cd0;try{const {username:_0x5778b0,email:_0x4e8806,role:_0x441fde}=_0x5f5728[_0x53391d(0x1c1)],_0x1c348a=_0x5f5728[_0x53391d(0x1c1)],_0x2132bb=await profile[_0x53391d(0x1d7)]({'email':_0x1c348a[_0x53391d(0x1af)]}),_0x56b133=await master_shop[_0x53391d(0x213)](),_0x490bfe=_0x5f5728[_0x53391d(0x17f)]['id'],_0x9cff11=await purchases[_0x53391d(0x286)](_0x490bfe),_0x392990=await suppliers['find']({});let _0x2898e4;if(_0x1c348a['role']==_0x53391d(0x21d)){const _0x3d1965=await staff[_0x53391d(0x1d7)]({'email':_0x1c348a[_0x53391d(0x1af)]});_0x2898e4=await warehouse[_0x53391d(0x213)]({'status':_0x53391d(0x25b),'name':_0x3d1965[_0x53391d(0x1ac)],'warehouse_category':'Raw\x20Materials'});}else _0x2898e4=await warehouse[_0x53391d(0x269)]([{'$match':{'status':_0x53391d(0x25b),'warehouse_category':_0x53391d(0x202)}},{'$group':{'_id':'$name','name':{'$first':_0x53391d(0x189)}}}]);const _0x544afa=await product[_0x53391d(0x213)]({}),_0x37eb2a=BayBinSelected(_0x9cff11[_0x53391d(0x1d4)],_0x9cff11[_0x53391d(0x293)]);let _0x2eebcf=new Date(_0x9cff11[_0x53391d(0x248)]),_0x314448=('0'+_0x2eebcf[_0x53391d(0x1d8)]())[_0x53391d(0x27f)](-0x2),_0x3c7c04=('0'+(_0x2eebcf[_0x53391d(0x1b4)]()+0x1))[_0x53391d(0x27f)](-0x2),_0x410235=_0x2eebcf['getFullYear'](),_0x185d53=_0x410235+'-'+_0x3c7c04+'-'+_0x314448;if(_0x56b133[0x0][_0x53391d(0x28e)]=='English\x20(US)'){var _0x1d2ab1=users[_0x53391d(0x1ed)];console[_0x53391d(0x171)](_0x1d2ab1);}else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x1db))var _0x1d2ab1=users['Hindi'];else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x24f))var _0x1d2ab1=users['German'];else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x1ab))var _0x1d2ab1=users['Spanish'];else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x1e9))var _0x1d2ab1=users['French'];else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x1a9))var _0x1d2ab1=users[_0x53391d(0x240)];else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x1e5))var _0x1d2ab1=users['Chinese'];else{if(_0x56b133[0x0][_0x53391d(0x28e)]==_0x53391d(0x1c3))var _0x1d2ab1=users[_0x53391d(0x25d)];}}}}}}}_0x54f70a['render'](_0x53391d(0x179),{'success':_0x5f5728[_0x53391d(0x211)](_0x53391d(0x176)),'errors':_0x5f5728[_0x53391d(0x211)]('errors'),'role':_0x1c348a,'profile':_0x2132bb,'purchases':_0x9cff11,'suppliers':_0x392990,'warehouse':_0x2898e4,'product':_0x544afa,'master_shop':_0x56b133,'language':_0x1d2ab1,'ed_fullDate':_0x185d53,'dataSelected':_0x37eb2a});}catch(_0x12e06b){console[_0x53391d(0x171)](_0x12e06b);}}),router[a0_0x397cd0(0x1b2)](a0_0x397cd0(0x18c),auth,async(_0x597ced,_0x289506)=>{var _0x277451=a0_0x397cd0;try{const _0x42d6e4=_0x597ced['params']['id'],_0x11cef0=await purchases[_0x277451(0x1d7)]({'_id':_0x597ced['params']['id']}),_0x1625d2=await warehouse[_0x277451(0x1d7)]({'name':_0x11cef0[_0x277451(0x1d4)],'room':_0x11cef0[_0x277451(0x293)]});_0x11cef0[_0x277451(0x193)][_0x277451(0x23c)](_0x3e2c1e=>{const _0x427f34=_0x1625d2['product_details']['map'](_0xa021a8=>{var _0x234174=a0_0x4f54;_0xa021a8[_0x234174(0x1bb)]==_0x3e2c1e[_0x234174(0x1bb)]&&_0xa021a8[_0x234174(0x1ce)]==_0x3e2c1e[_0x234174(0x1ce)]&&_0xa021a8['type']==_0x3e2c1e['type']&&_0xa021a8[_0x234174(0x17b)]==_0x3e2c1e['bin']&&_0xa021a8[_0x234174(0x1e4)]==_0x3e2c1e[_0x234174(0x1e4)]&&_0xa021a8[_0x234174(0x219)]==_0x3e2c1e[_0x234174(0x219)]&&_0xa021a8[_0x234174(0x25c)]==_0x3e2c1e[_0x234174(0x25c)]&&(_0xa021a8[_0x234174(0x21b)]=parseInt(_0xa021a8[_0x234174(0x21b)])-parseInt(_0x3e2c1e['quantity']));});}),await _0x1625d2[_0x277451(0x239)]();const {invoice:_0x2b88bc,suppliers:_0x2cf796,date:_0x25301c,warehouse_name:_0x5c442f,prod_name:_0x14dad1,prod_code:_0x28c9d2,prod_qty:_0x323283,prod_unit:_0x1716a5,prod_secondunit:_0x516579,prod_level:_0x2cc414,prod_isle:_0x1cac85,prod_pallet:_0x308ba1,note:_0x4a1f66,expiry_date:_0x37cfa4,batch_code:_0x30e381,paid_amount:_0x22c6c9,due_amount:_0x351390,Room_name:_0x267a81,primary_code:_0x429cfd,secondary_code:_0x130c21,PO_number:_0x4a8b68,JO_number:_0x4fca10}=_0x597ced['body'];if(typeof _0x14dad1==_0x277451(0x26b))var _0x482826=[_0x597ced[_0x277451(0x19f)][_0x277451(0x26f)]],_0x1f661d=[_0x597ced['body'][_0x277451(0x17d)]],_0x186d1d=[_0x597ced[_0x277451(0x19f)]['prod_qty']],_0x13ba11=[_0x597ced[_0x277451(0x19f)][_0x277451(0x1b9)]],_0x2a7b35=[_0x597ced[_0x277451(0x19f)][_0x277451(0x200)]],_0xe25cbe=[_0x597ced[_0x277451(0x19f)][_0x277451(0x25a)]],_0x581af1=[_0x597ced[_0x277451(0x19f)][_0x277451(0x28c)]],_0x4ff27a=[_0x597ced[_0x277451(0x19f)][_0x277451(0x284)]],_0x478c68=[_0x597ced[_0x277451(0x19f)][_0x277451(0x204)]],_0x41180c=[_0x597ced[_0x277451(0x19f)]['secondary_code']],_0x56a854=[_0x597ced[_0x277451(0x19f)][_0x277451(0x266)]],_0x140b86=[_0x597ced[_0x277451(0x19f)][_0x277451(0x1b5)]],_0x28f8a5=[_0x597ced[_0x277451(0x19f)][_0x277451(0x248)]],_0x25290d=[_0x597ced[_0x277451(0x19f)][_0x277451(0x25c)]],_0x24e3d6=[_0x597ced[_0x277451(0x19f)][_0x277451(0x1cb)]],_0x1cac46=[_0x597ced[_0x277451(0x19f)]['type']];else var _0x482826=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x26f)]],_0x1f661d=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x17d)]],_0x186d1d=[..._0x597ced['body']['prod_qty']],_0x13ba11=[..._0x597ced[_0x277451(0x19f)]['prod_unit']],_0x2a7b35=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x200)]],_0xe25cbe=[..._0x597ced['body'][_0x277451(0x25a)]],_0x581af1=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x28c)]],_0x4ff27a=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x284)]],_0x478c68=[..._0x597ced['body'][_0x277451(0x204)]],_0x41180c=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x1f2)]],_0x56a854=[..._0x597ced['body'][_0x277451(0x266)]],_0x140b86=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x1b5)]],_0x28f8a5=[..._0x597ced['body'][_0x277451(0x248)]],_0x25290d=[..._0x597ced['body'][_0x277451(0x25c)]],_0x24e3d6=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x1cb)]],_0x1cac46=[..._0x597ced[_0x277451(0x19f)][_0x277451(0x1d6)]];const _0x57cb36=_0x482826[_0x277451(0x1cc)](_0x20fd80=>{return _0x20fd80={'product_name':_0x20fd80};});_0x1f661d['forEach']((_0x2083e9,_0xd0a467)=>{var _0x80fc24=_0x277451;_0x57cb36[_0xd0a467][_0x80fc24(0x174)]=_0x2083e9;}),_0x186d1d[_0x277451(0x23c)]((_0x12b11e,_0x4b22bb)=>{var _0x4337f8=_0x277451;_0x57cb36[_0x4b22bb][_0x4337f8(0x234)]=_0x12b11e;}),_0x13ba11[_0x277451(0x23c)]((_0x248f3e,_0x2aacfa)=>{var _0x4354cf=_0x277451;_0x57cb36[_0x2aacfa][_0x4354cf(0x22d)]=_0x248f3e;}),_0x2a7b35[_0x277451(0x23c)]((_0x2e2599,_0x460cd2)=>{_0x57cb36[_0x460cd2]['secondary_unit']=_0x2e2599;}),_0xe25cbe[_0x277451(0x23c)]((_0x1eaad8,_0x94a35)=>{_0x57cb36[_0x94a35]['bay']=_0x1eaad8;}),_0x581af1['forEach']((_0x44170d,_0x576bb5)=>{var _0x1154bf=_0x277451;_0x57cb36[_0x576bb5][_0x1154bf(0x17b)]=_0x44170d;}),_0x4ff27a[_0x277451(0x23c)]((_0x391d2b,_0x379ffb)=>{var _0x788ff5=_0x277451;_0x57cb36[_0x379ffb][_0x788ff5(0x1ce)]=_0x391d2b;}),_0x478c68[_0x277451(0x23c)]((_0x34d543,_0x2df506)=>{var _0x30cb8f=_0x277451;_0x57cb36[_0x2df506][_0x30cb8f(0x204)]=_0x34d543;}),_0x41180c[_0x277451(0x23c)]((_0x2b871b,_0x431737)=>{var _0x1a7a33=_0x277451;_0x57cb36[_0x431737][_0x1a7a33(0x1f2)]=_0x2b871b;}),_0x56a854['forEach']((_0x3663d5,_0x57db5e)=>{var _0x442ebf=_0x277451;_0x57cb36[_0x57db5e][_0x442ebf(0x184)]=_0x3663d5;}),_0x140b86[_0x277451(0x23c)]((_0x2ca9c9,_0x34b5f9)=>{var _0x5ab136=_0x277451;_0x57cb36[_0x34b5f9][_0x5ab136(0x1b5)]=_0x2ca9c9;}),_0x28f8a5[_0x277451(0x23c)]((_0x1ada3d,_0xa0aba7)=>{_0x57cb36[_0xa0aba7]['expiry_date']=_0x1ada3d;}),_0x1cac46[_0x277451(0x23c)]((_0xab81fb,_0x2d10e7)=>{var _0x370601=_0x277451;_0x57cb36[_0x2d10e7][_0x370601(0x1d6)]=_0xab81fb;}),_0x25290d[_0x277451(0x23c)]((_0x4fff89,_0x1c62ca)=>{var _0x540018=_0x277451;_0x57cb36[_0x1c62ca][_0x540018(0x25c)]=_0x4fff89;}),_0x24e3d6['forEach']((_0x4618f2,_0x2e09b5)=>{var _0x164e2e=_0x277451;_0x57cb36[_0x2e09b5][_0x164e2e(0x219)]=_0x4618f2;});const _0x5e495f=_0x57cb36[_0x277451(0x194)](_0x4fe501=>_0x4fe501[_0x277451(0x234)]!=='0'&&_0x4fe501['quantity']!=='');_0x11cef0[_0x277451(0x1b7)]=_0x2b88bc,_0x11cef0[_0x277451(0x19d)]=_0x2cf796,_0x11cef0['date']=_0x25301c,_0x11cef0[_0x277451(0x1d4)]=_0x5c442f,_0x11cef0[_0x277451(0x193)]=_0x5e495f,_0x11cef0[_0x277451(0x244)]=_0x4a1f66,_0x11cef0[_0x277451(0x277)]=_0x22c6c9,_0x11cef0[_0x277451(0x207)]=_0x351390,_0x11cef0[_0x277451(0x293)]=_0x267a81,_0x11cef0[_0x277451(0x278)]=_0x4a8b68,_0x11cef0[_0x277451(0x19c)]=_0x4fca10;const _0x212b73=await _0x11cef0[_0x277451(0x239)](),_0x3020db=await warehouse[_0x277451(0x1d7)]({'name':_0x597ced['body'][_0x277451(0x1d4)],'room':_0x597ced[_0x277451(0x19f)]['Room_name']});_0x11cef0[_0x277451(0x193)][_0x277451(0x23c)](_0x21883d=>{var _0x1d4f81=_0x277451,_0x4e22fd=0x0;const _0x2efa19=_0x3020db['product_details'][_0x1d4f81(0x1cc)](_0x31b774=>{var _0x1f69f9=_0x1d4f81;_0x31b774[_0x1f69f9(0x1bb)]==_0x21883d[_0x1f69f9(0x1bb)]&&_0x31b774[_0x1f69f9(0x1ce)]==_0x21883d[_0x1f69f9(0x1ce)]&&_0x31b774['type']==_0x21883d[_0x1f69f9(0x1d6)]&&_0x31b774[_0x1f69f9(0x17b)]==_0x21883d[_0x1f69f9(0x17b)]&&_0x31b774[_0x1f69f9(0x1e4)]==_0x21883d['bay']&&_0x31b774[_0x1f69f9(0x219)]==_0x21883d[_0x1f69f9(0x219)]&&_0x31b774[_0x1f69f9(0x25c)]==_0x21883d['storage']&&(_0x31b774[_0x1f69f9(0x21b)]=parseInt(_0x31b774[_0x1f69f9(0x21b)])+parseInt(_0x21883d['quantity']),_0x4e22fd++);});_0x4e22fd=='0'&&(_0x3020db[_0x1d4f81(0x1ff)]=_0x3020db[_0x1d4f81(0x1ff)]['concat']({'product_name':_0x21883d[_0x1d4f81(0x1bb)],'product_stock':_0x21883d['quantity'],'primary_code':_0x21883d[_0x1d4f81(0x204)],'secondary_code':_0x21883d[_0x1d4f81(0x1f2)],'product_code':_0x21883d[_0x1d4f81(0x174)],'storage':_0x21883d[_0x1d4f81(0x25c)],'rack':_0x21883d['rack'],'bay':_0x21883d['bay'],'bin':_0x21883d[_0x1d4f81(0x17b)],'type':_0x21883d[_0x1d4f81(0x1d6)],'floorlevel':_0x21883d[_0x1d4f81(0x1ce)],'maxProducts':_0x21883d[_0x1d4f81(0x184)],'unit':_0x21883d['standard_unit'],'secondary_unit':_0x21883d[_0x1d4f81(0x1d1)],'expiry_date':_0x21883d['expiry_date']}));}),await _0x3020db['save']();const _0x195270=await s_payment_data['findOne']({'invoice':_0x597ced[_0x277451(0x19f)][_0x277451(0x1b7)]});if(_0x195270===null){}else console[_0x277451(0x171)]('suppliers',_0x195270,_0x597ced[_0x277451(0x19f)][_0x277451(0x1b7)]),_0x195270[_0x277451(0x19d)]=_0x597ced['body'][_0x277451(0x19d)],await _0x195270[_0x277451(0x239)]();_0x597ced[_0x277451(0x211)](_0x277451(0x176),'purchase\x20data\x20update\x20successfully'),_0x289506[_0x277451(0x1c9)](_0x277451(0x19a));}catch(_0x573040){console[_0x277451(0x171)](_0x573040);}}),router['post'](a0_0x397cd0(0x253),auth,async(_0x19bfc9,_0x5d5115)=>{var _0x2c66e4=a0_0x397cd0;try{const _0x2b6902=_0x19bfc9[_0x2c66e4(0x17f)]['id'],{invoice:_0x2b4938,suppliers:_0x25170f,payable:_0x593d48,due_amount:_0x14bff0}=_0x19bfc9[_0x2c66e4(0x19f)],_0x1602fc=await purchases[_0x2c66e4(0x286)](_0x2b6902);var _0x293c59=_0x593d48-_0x14bff0;_0x1602fc[_0x2c66e4(0x277)]=parseFloat(_0x1602fc[_0x2c66e4(0x277)])+parseFloat(_0x14bff0),_0x1602fc[_0x2c66e4(0x207)]=_0x293c59;const _0x462c4d=await _0x1602fc[_0x2c66e4(0x239)]();console[_0x2c66e4(0x171)](_0x462c4d);const _0x5522d4=await s_payment_data[_0x2c66e4(0x1d7)]({'invoice':_0x2b4938});_0x5522d4[_0x2c66e4(0x1ef)]=_0x293c59,await _0x5522d4[_0x2c66e4(0x239)]();let _0x3c19fc=new Date(),_0x4253d4=('0'+_0x3c19fc[_0x2c66e4(0x1d8)]())['slice'](-0x2),_0x2f1824=('0'+(_0x3c19fc[_0x2c66e4(0x1b4)]()+0x1))[_0x2c66e4(0x27f)](-0x2),_0xaff426=_0x3c19fc['getFullYear'](),_0x58a3c2=_0xaff426+'-'+_0x2f1824+'-'+_0x4253d4;const _0x48d013=new suppliers_payment({'invoice':_0x2b4938,'date':_0xaff426+'-'+_0x2f1824+'-'+_0x4253d4,'suppliers':_0x25170f,'reason':_0x2c66e4(0x249),'amount':_0x14bff0}),_0x5378c4=await _0x48d013[_0x2c66e4(0x239)]();_0x19bfc9[_0x2c66e4(0x211)](_0x2c66e4(0x176),_0x2c66e4(0x259)),_0x5d5115[_0x2c66e4(0x1c9)](_0x2c66e4(0x19a));}catch(_0x2f2ed6){console['log'](_0x2f2ed6);}}),router['get'](a0_0x397cd0(0x1fd),auth,async(_0x4fceee,_0x25e7b1)=>{var _0x15ba92=a0_0x397cd0;try{const {username:_0x3c7178,email:_0x3c26a3,role:_0x3861cb}=_0x4fceee[_0x15ba92(0x1c1)],_0x58d371=_0x4fceee[_0x15ba92(0x1c1)],_0x558ea6=await profile['findOne']({'email':_0x58d371[_0x15ba92(0x1af)]}),_0x166013=await master_shop['find']();console['log'](_0x15ba92(0x191),_0x166013);const _0x35836a=_0x4fceee[_0x15ba92(0x17f)]['id'],_0x3f20ce=await purchases['findById'](_0x35836a);console[_0x15ba92(0x171)](_0x3f20ce);const _0x29c401=await suppliers[_0x15ba92(0x1d7)]({'name':_0x3f20ce[_0x15ba92(0x19d)]});console['log'](_0x29c401);if(_0x166013[0x0]['language']==_0x15ba92(0x209)){var _0x75bd6=users['English'];console[_0x15ba92(0x171)](_0x75bd6);}else{if(_0x166013[0x0][_0x15ba92(0x28e)]=='Hindi')var _0x75bd6=users[_0x15ba92(0x1db)];else{if(_0x166013[0x0]['language']==_0x15ba92(0x24f))var _0x75bd6=users[_0x15ba92(0x24f)];else{if(_0x166013[0x0][_0x15ba92(0x28e)]=='Spanish')var _0x75bd6=users[_0x15ba92(0x1ab)];else{if(_0x166013[0x0][_0x15ba92(0x28e)]=='French')var _0x75bd6=users[_0x15ba92(0x1e9)];else{if(_0x166013[0x0][_0x15ba92(0x28e)]=='Portuguese\x20(BR)')var _0x75bd6=users[_0x15ba92(0x240)];else{if(_0x166013[0x0]['language']==_0x15ba92(0x1e5))var _0x75bd6=users[_0x15ba92(0x1e5)];else{if(_0x166013[0x0][_0x15ba92(0x28e)]==_0x15ba92(0x1c3))var _0x75bd6=users['Arabic'];}}}}}}}_0x25e7b1[_0x15ba92(0x281)](_0x15ba92(0x1ba),{'success':_0x4fceee['flash']('success'),'errors':_0x4fceee['flash'](_0x15ba92(0x217)),'role':_0x58d371,'profile':_0x558ea6,'master_shop':_0x166013,'supplier':_0x29c401,'purchase':_0x3f20ce,'language':_0x75bd6});}catch(_0x1c9cd5){console[_0x15ba92(0x171)](_0x1c9cd5);}}),router[a0_0x397cd0(0x291)](a0_0x397cd0(0x241),auth,async(_0x178dcc,_0x13a027)=>{var _0x9b5b3c=a0_0x397cd0;try{const {username:_0x6e3e6d,email:_0x3164d5,role:_0x1279a3}=_0x178dcc[_0x9b5b3c(0x1c1)],_0x28569c=_0x178dcc[_0x9b5b3c(0x1c1)],_0x4bf342=await profile[_0x9b5b3c(0x1d7)]({'email':_0x28569c['email']}),_0x10e909=await master_shop['find']();console[_0x9b5b3c(0x171)](_0x9b5b3c(0x191),_0x10e909);const _0xfb0a24=_0x178dcc['params']['id'];console[_0x9b5b3c(0x171)](_0xfb0a24);const _0x1e91f9=await purchases['findById'](_0xfb0a24);console['log'](_0x9b5b3c(0x224),_0x1e91f9);const _0x13a623=await product[_0x9b5b3c(0x213)]({}),_0x1370a0=await warehouse['aggregate']([{'$match':{'name':_0x1e91f9[_0x9b5b3c(0x1d4)],'room':_0x1e91f9['room'],'warehouse_category':_0x9b5b3c(0x202)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x9b5b3c(0x258),'name':{'$first':_0x9b5b3c(0x208)},'product_stock':{'$first':_0x9b5b3c(0x292)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x9b5b3c(0x1f1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x9b5b3c(0x22a)},'secondary_code':{'$first':_0x9b5b3c(0x1f0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x9b5b3c(0x203)},'rack':{'$first':_0x9b5b3c(0x1a5)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x9b5b3c(0x25b),'name':_0x9b5b3c(0x175),'warehouse_category':_0x9b5b3c(0x202)}},{'$group':{'_id':_0x9b5b3c(0x189),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x9b5b3c(0x20b),_0x1370a0);if(_0x10e909[0x0]['language']=='English\x20(US)'){var _0x122e07=users[_0x9b5b3c(0x1ed)];console[_0x9b5b3c(0x171)](_0x122e07);}else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x1db))var _0x122e07=users[_0x9b5b3c(0x1db)];else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x24f))var _0x122e07=users[_0x9b5b3c(0x24f)];else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x1ab))var _0x122e07=users[_0x9b5b3c(0x1ab)];else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x1e9))var _0x122e07=users['French'];else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x1a9))var _0x122e07=users[_0x9b5b3c(0x240)];else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x1e5))var _0x122e07=users[_0x9b5b3c(0x1e5)];else{if(_0x10e909[0x0][_0x9b5b3c(0x28e)]==_0x9b5b3c(0x1c3))var _0x122e07=users[_0x9b5b3c(0x25d)];}}}}}}}_0x13a027[_0x9b5b3c(0x281)]('return_purchase',{'success':_0x178dcc[_0x9b5b3c(0x211)](_0x9b5b3c(0x176)),'errors':_0x178dcc[_0x9b5b3c(0x211)]('errors'),'role':_0x28569c,'profile':_0x4bf342,'user':_0x1e91f9,'stock':_0x1370a0,'master_shop':_0x10e909,'product':_0x13a623,'language':_0x122e07,'warehouse':warehouse_data});}catch(_0x4554fe){console[_0x9b5b3c(0x171)](_0x4554fe);}}),router[a0_0x397cd0(0x1b2)]('/view/return_purchase/:id',auth,async(_0x17b4a6,_0x402a50)=>{var _0x1398b4=a0_0x397cd0;try{const {invoice:_0x884f50,date:_0x1f8a59,warehouse_name:_0x5985a2,Room_name:_0x1673f1,product_name:_0x5666f8,purchase_quantity:_0x3a6d1f,stocks:_0x3839ec,return_qty:_0x10b51c,note:_0x2acf79,level:_0x4172e9,isle:_0x29be51,pallet:_0x4a7db5,to_warehouse_name:_0x566333,to_Room_name:_0x4dcea2}=_0x17b4a6['body'],_0xeaf1bf=await purchases[_0x1398b4(0x1d7)]({'_id':_0x17b4a6[_0x1398b4(0x17f)]['id']}),_0x174a1a=await warehouse[_0x1398b4(0x1d7)]({'name':_0x5985a2,'room':_0x1673f1});if(typeof _0x5666f8==_0x1398b4(0x26b))var _0x5b6724=[_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x1bb)]],_0x91f054=[_0x17b4a6['body'][_0x1398b4(0x20a)]],_0x4fe722=[_0x17b4a6['body'][_0x1398b4(0x1c8)]],_0x3f3212=[_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x1ae)]],_0x2c10a7=[_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x27d)]],_0x525a8a=[_0x17b4a6[_0x1398b4(0x19f)]['isle']],_0x9b829d=[_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x283)]],_0x2b7682=[_0x17b4a6['body'][_0x1398b4(0x1cd)]],_0x4b20da=[_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x221)]],_0xac1d6e=[_0x17b4a6['body'][_0x1398b4(0x1e6)]],_0x270f7b=[_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x20f)]];else var _0x5b6724=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x1bb)]],_0x91f054=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x20a)]],_0x4fe722=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x1c8)]],_0x3f3212=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x1ae)]],_0x2c10a7=[..._0x17b4a6[_0x1398b4(0x19f)]['level']],_0x525a8a=[..._0x17b4a6[_0x1398b4(0x19f)]['isle']],_0x9b829d=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x283)]],_0x2b7682=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x1cd)]],_0x4b20da=[..._0x17b4a6['body']['product_code_hide']],_0xac1d6e=[..._0x17b4a6['body'][_0x1398b4(0x1e6)]],_0x270f7b=[..._0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x20f)]];const _0x33d9d3=_0x5b6724[_0x1398b4(0x1cc)](_0x511113=>{return _0x511113={'product_name':_0x511113};});_0x91f054['forEach']((_0x221f1a,_0x53f572)=>{var _0x844085=_0x1398b4;_0x33d9d3[_0x53f572][_0x844085(0x20a)]=_0x221f1a;}),_0x4fe722[_0x1398b4(0x23c)]((_0x367a94,_0x23ec56)=>{var _0x34eaa0=_0x1398b4;_0x33d9d3[_0x23ec56][_0x34eaa0(0x19b)]=_0x367a94;}),_0x3f3212[_0x1398b4(0x23c)]((_0x4596a5,_0x2f6ee7)=>{_0x33d9d3[_0x2f6ee7]['return_qty']=_0x4596a5;}),_0x2c10a7[_0x1398b4(0x23c)]((_0x3e58fe,_0x16750f)=>{var _0x26b278=_0x1398b4;_0x33d9d3[_0x16750f][_0x26b278(0x1e4)]=_0x3e58fe;}),_0x525a8a[_0x1398b4(0x23c)]((_0xc1ec35,_0x2a5874)=>{var _0x589f68=_0x1398b4;_0x33d9d3[_0x2a5874][_0x589f68(0x17b)]=_0xc1ec35;}),_0x9b829d['forEach']((_0x5ddc2b,_0x458cb0)=>{var _0x1b8834=_0x1398b4;_0x33d9d3[_0x458cb0][_0x1b8834(0x1ce)]=_0x5ddc2b;}),_0x2b7682['forEach']((_0x198499,_0x3c0c43)=>{var _0x5d5228=_0x1398b4;_0x33d9d3[_0x3c0c43][_0x5d5228(0x1d6)]=_0x198499;}),_0x4b20da[_0x1398b4(0x23c)]((_0x1373d7,_0x17a0ee)=>{var _0x54d596=_0x1398b4;_0x33d9d3[_0x17a0ee][_0x54d596(0x174)]=_0x1373d7;}),_0xac1d6e['forEach']((_0x32887a,_0x1e0199)=>{var _0x1bc7df=_0x1398b4;_0x33d9d3[_0x1e0199][_0x1bc7df(0x204)]=_0x32887a;}),_0x270f7b['forEach']((_0x3185e4,_0x148f2f)=>{var _0x593dee=_0x1398b4;_0x33d9d3[_0x148f2f][_0x593dee(0x1f2)]=_0x3185e4;}),_0xeaf1bf['product'][_0x1398b4(0x23c)](_0x1dc4b5=>{var _0x2eb87b=_0x1398b4;const _0x441b6d=_0x174a1a[_0x2eb87b(0x1ff)][_0x2eb87b(0x1cc)](_0x5a5004=>{var _0x1181ab=_0x2eb87b;_0x5a5004['product_name']==_0x1dc4b5[_0x1181ab(0x1bb)]&&_0x5a5004['floorlevel']==_0x1dc4b5[_0x1181ab(0x1ce)]&&_0x5a5004[_0x1181ab(0x1d6)]==_0x1dc4b5[_0x1181ab(0x1d6)]&&_0x5a5004[_0x1181ab(0x17b)]==_0x1dc4b5[_0x1181ab(0x17b)]&&_0x5a5004[_0x1181ab(0x1e4)]==_0x1dc4b5[_0x1181ab(0x1e4)]&&_0x5a5004[_0x1181ab(0x219)]==_0x1dc4b5[_0x1181ab(0x219)]&&_0x5a5004[_0x1181ab(0x25c)]==_0x1dc4b5[_0x1181ab(0x25c)]&&(console[_0x1181ab(0x171)](parseInt(_0x5a5004[_0x1181ab(0x21b)])+_0x1181ab(0x20c)+parseInt(_0x1dc4b5[_0x1181ab(0x234)])),_0x5a5004[_0x1181ab(0x21b)]=parseInt(_0x5a5004[_0x1181ab(0x21b)])+parseInt(_0x1dc4b5[_0x1181ab(0x234)]));});}),await _0x174a1a[_0x1398b4(0x239)]();const _0x327ba4=_0x33d9d3[_0x1398b4(0x194)](_0x1ff319=>_0x1ff319[_0x1398b4(0x1ae)]!=='0'&&_0x1ff319[_0x1398b4(0x1ae)]!=='');var _0x567c46=0x0;_0x327ba4['forEach'](_0x2a67cf=>{var _0x438b55=_0x1398b4;console['log'](_0x438b55(0x271),_0x2a67cf),(parseInt(_0x2a67cf[_0x438b55(0x20a)])<parseInt(_0x2a67cf[_0x438b55(0x1ae)])||parseInt(_0x2a67cf[_0x438b55(0x19b)])<parseInt(_0x2a67cf[_0x438b55(0x1ae)]))&&_0x567c46++;});if(_0x567c46!=0x0)return _0x17b4a6[_0x1398b4(0x211)](_0x1398b4(0x217),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x402a50[_0x1398b4(0x1c9)](_0x1398b4(0x225));const _0x2b4289=new purchases_return({'invoice':_0x884f50,'suppliers':_0x17b4a6[_0x1398b4(0x19f)][_0x1398b4(0x19d)],'date':_0x1f8a59,'warehouse_name':_0x5985a2,'return_product':_0x327ba4,'note':_0x2acf79,'room':_0x1673f1,'to_warehouse_name':_0x566333,'to_room':_0x4dcea2}),_0x2ce577=await _0x2b4289['save']();console[_0x1398b4(0x171)](_0x2b4289);const _0x31ad32=await purchases_return[_0x1398b4(0x1d7)]({'invoice':_0x884f50}),_0xac3786=await warehouse[_0x1398b4(0x1d7)]({'name':_0x566333,'room':_0x4dcea2});_0x31ad32['return_product'][_0x1398b4(0x23c)](_0x305669=>{var _0x2710fc=_0x1398b4,_0x20dc03=0x0;const _0x5c1175=_0xac3786[_0x2710fc(0x1ff)]['map'](_0x36c614=>{var _0x47d0db=_0x2710fc;_0x36c614['product_name']==_0x305669[_0x47d0db(0x1bb)]&&_0x36c614['floorlevel']==_0x305669[_0x47d0db(0x1ce)]&&_0x36c614[_0x47d0db(0x1d6)]==_0x305669['type']&&_0x36c614[_0x47d0db(0x17b)]==_0x305669[_0x47d0db(0x17b)]&&_0x36c614[_0x47d0db(0x1e4)]==_0x305669[_0x47d0db(0x1e4)]&&(_0x36c614[_0x47d0db(0x21b)]=parseInt(_0x36c614[_0x47d0db(0x21b)])-parseInt(_0x305669[_0x47d0db(0x1ae)]),_0x20dc03++);});_0x20dc03=='0'&&(_0xac3786['product_details']=_0xac3786[_0x2710fc(0x1ff)][_0x2710fc(0x223)]({'product_name':_0x305669[_0x2710fc(0x1bb)],'product_stock':_0x305669['return_qty'],'primary_code':_0x305669[_0x2710fc(0x204)],'secondary_code':_0x305669[_0x2710fc(0x1f2)],'product_code':_0x305669[_0x2710fc(0x174)],'storage':_0x305669['storage'],'rack':_0x305669[_0x2710fc(0x219)],'bay':_0x305669['bay'],'bin':_0x305669[_0x2710fc(0x17b)],'type':_0x305669[_0x2710fc(0x1d6)],'floorlevel':_0x305669[_0x2710fc(0x1ce)],'maxProducts':_0x305669[_0x2710fc(0x184)],'unit':_0x305669[_0x2710fc(0x22d)],'secondary_unit':_0x305669['secondary_unit'],'expiry_date':_0x305669[_0x2710fc(0x248)]}));}),await _0xac3786[_0x1398b4(0x239)]();const _0x57b29a=await purchases[_0x1398b4(0x1d7)]({'invoice':_0x884f50});_0x57b29a[_0x1398b4(0x1cf)]=_0x1398b4(0x23e);const _0x2968b0=await _0x57b29a[_0x1398b4(0x239)](),_0x9f38ec=new s_payment_data({'invoice':_0x884f50,'suppliers':_0x17b4a6['body']['suppliers'],'reason':'Purchase\x20Return'});await _0x9f38ec[_0x1398b4(0x239)]();const _0x402775=await master_shop[_0x1398b4(0x213)]();console['log'](_0x1398b4(0x185),_0x402775[0x0]['image']);const _0x12678a=await email_settings[_0x1398b4(0x1d7)](),_0x2b1dd6=await suppliers['findOne']({'name':_0x17b4a6[_0x1398b4(0x19f)]['suppliers']});console[_0x1398b4(0x171)](_0x1398b4(0x237),_0x2b1dd6);_0x402775[0x0][_0x1398b4(0x1c4)]==0x1?(right_currency=_0x402775[0x0][_0x1398b4(0x1f3)],left_currency=''):(right_currency='',left_currency=_0x402775[0x0]['currency']);var _0x5d435f=_0x5b6724,_0x2f8ac6=_0x3f3212,_0xd643ac='',_0x4cde1a;for(_0x4cde1a in _0x5d435f){_0xd643ac+='<tr>'+_0x1398b4(0x1b8)+_0x5d435f[_0x4cde1a]+_0x1398b4(0x23b)+_0x1398b4(0x1b8)+_0x2f8ac6[_0x4cde1a]+_0x1398b4(0x23b)+_0x1398b4(0x273);}console['log'](_0x1398b4(0x245),_0xd643ac);let _0x242540=nodemailer[_0x1398b4(0x1aa)]({'service':_0x1398b4(0x1e7),'auth':{'user':_0x12678a[_0x1398b4(0x1af)],'pass':_0x12678a[_0x1398b4(0x235)]}}),_0x97def={'from':_0x12678a[_0x1398b4(0x1af)],'to':_0x2b1dd6[_0x1398b4(0x1af)],'subject':_0x1398b4(0x1c7),'attachments':[{'filename':_0x1398b4(0x1a3),'path':__dirname+'/../public'+_0x1398b4(0x24d)+_0x402775[0x0]['image'],'cid':_0x1398b4(0x1fc)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1398b4(0x180)+_0x1398b4(0x26c)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1398b4(0x26c)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1398b4(0x1a4)+_0x1398b4(0x26c)+'<h2>\x20'+_0x402775[0x0][_0x1398b4(0x257)]+_0x1398b4(0x282)+_0x1398b4(0x1a4)+_0x1398b4(0x1a4)+_0x1398b4(0x285)+_0x1398b4(0x26c)+_0x1398b4(0x197)+_0x1398b4(0x21c)+_0x884f50+'\x20'+_0x1398b4(0x23a)+'\x20Order\x20Date\x20:\x20'+_0x1f8a59+'\x20'+_0x1398b4(0x247)+'</h5>'+_0x1398b4(0x1a4)+_0x1398b4(0x1f4)+_0x1398b4(0x1be)+_0x1398b4(0x1f6)+_0x1398b4(0x232)+_0x1398b4(0x1ad)+_0x1398b4(0x218)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x1398b4(0x21f)+_0x1398b4(0x183)+'\x20'+_0xd643ac+'\x20'+_0x1398b4(0x1f5)+'</table>'+_0x1398b4(0x26c)+_0x1398b4(0x25e)+'<h5>'+_0x402775[0x0][_0x1398b4(0x257)]+_0x1398b4(0x1dc)+'</div>'+'</div>'+_0x1398b4(0x17c)};_0x242540[_0x1398b4(0x280)](_0x97def,function(_0x1d198d,_0x32cb8b){var _0x1ddb2a=_0x1398b4;_0x1d198d?(console[_0x1ddb2a(0x171)](_0x1d198d),console[_0x1ddb2a(0x171)](_0x1ddb2a(0x251))):console['log'](_0x1ddb2a(0x1f7));}),_0x17b4a6[_0x1398b4(0x211)](_0x1398b4(0x176),'purchases\x20item\x20return\x20successfull'),_0x402a50[_0x1398b4(0x1c9)](_0x1398b4(0x19a));}catch(_0x105c8b){console[_0x1398b4(0x171)](_0x105c8b),_0x402a50['status'](0xc8)[_0x1398b4(0x1e1)]({'message':_0x105c8b[_0x1398b4(0x22b)]});}}),router['get'](a0_0x397cd0(0x1a0),auth,async(_0x95788c,_0x33d02d)=>{var _0x4159f4=a0_0x397cd0;try{const {username:_0x5e9736,email:_0x1e83a6,role:_0x9b5de6}=_0x95788c['user'],_0x259335=_0x95788c[_0x4159f4(0x1c1)],_0x3cf07c=await profile[_0x4159f4(0x1d7)]({'email':_0x259335[_0x4159f4(0x1af)]}),_0x3778fd=await master_shop[_0x4159f4(0x213)](),_0x427195=_0x95788c['params']['id'],_0x20664b=await purchases[_0x4159f4(0x286)](_0x427195);if(_0x3778fd[0x0][_0x4159f4(0x28e)]=='English\x20(US)')var _0x41bbaf=users['English'];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]==_0x4159f4(0x1db))var _0x41bbaf=users['Hindi'];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]==_0x4159f4(0x24f))var _0x41bbaf=users['German'];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]==_0x4159f4(0x1ab))var _0x41bbaf=users[_0x4159f4(0x1ab)];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]==_0x4159f4(0x1e9))var _0x41bbaf=users[_0x4159f4(0x1e9)];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]=='Portuguese\x20(BR)')var _0x41bbaf=users[_0x4159f4(0x240)];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]==_0x4159f4(0x1e5))var _0x41bbaf=users[_0x4159f4(0x1e5)];else{if(_0x3778fd[0x0][_0x4159f4(0x28e)]==_0x4159f4(0x1c3))var _0x41bbaf=users[_0x4159f4(0x25d)];}}}}}}}_0x33d02d[_0x4159f4(0x281)](_0x4159f4(0x23d),{'success':_0x95788c['flash'](_0x4159f4(0x176)),'errors':_0x95788c[_0x4159f4(0x211)](_0x4159f4(0x217)),'role':_0x259335,'profile':_0x3cf07c,'alldata':_0x20664b,'master_shop':_0x3778fd,'language':_0x41bbaf}),console['log'](alldata);}catch(_0x3cf14d){console['log'](_0x3cf14d);}}),router[a0_0x397cd0(0x1b2)](a0_0x397cd0(0x289),async(_0x3439ac,_0xac6306)=>{var _0x24b06f=a0_0x397cd0;const {product_code:_0x146bd0}=_0x3439ac[_0x24b06f(0x19f)];var _0x2ddca6;const _0x3a66bc=await product[_0x24b06f(0x269)]([{'$match':{'primary_code':_0x146bd0,'product_category':_0x24b06f(0x202)}},{'$group':{'_id':_0x24b06f(0x188),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x24b06f(0x1fe)},'unit':{'$first':_0x24b06f(0x265)},'alertquantity':{'$first':_0x24b06f(0x1f9)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x24b06f(0x1d5)},'secondary_code':{'$first':_0x24b06f(0x20d)},'maxStocks':{'$first':_0x24b06f(0x1bf)},'maxProdPerUnit':{'$first':_0x24b06f(0x182)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xc88785=await product[_0x24b06f(0x269)]([{'$match':{'secondary_code':_0x146bd0,'product_category':_0x24b06f(0x202)}},{'$group':{'_id':_0x24b06f(0x188),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x24b06f(0x1fe)},'unit':{'$first':_0x24b06f(0x265)},'alertquantity':{'$first':_0x24b06f(0x1f9)},'product_code':{'$first':_0x24b06f(0x24e)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x24b06f(0x20d)},'maxStocks':{'$first':_0x24b06f(0x1bf)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3a66bc[_0x24b06f(0x276)]>0x0)_0x2ddca6=_0x3a66bc;else _0xc88785[_0x24b06f(0x276)]>0x0&&(_0x2ddca6=_0xc88785);_0xac6306[_0x24b06f(0x1e1)](_0x2ddca6);}),router['post'](a0_0x397cd0(0x17a),async(_0x2ed49a,_0xaf8b1)=>{var _0x16dd5c=a0_0x397cd0;const {primaryCode:_0x2d5ed9,secondaryCode:_0x3d10b3,productCode:_0x2f4c5e,bay:_0x2d45d2,bin:_0x5867b2,types:_0x530850,pallet:_0x2e32be,warehouses:_0x371ab4,room:_0x572be5}=_0x2ed49a[_0x16dd5c(0x19f)];console[_0x16dd5c(0x171)](_0x2ed49a[_0x16dd5c(0x19f)]);try{const _0x1cb876=await warehouse[_0x16dd5c(0x269)]([{'$match':{'name':_0x371ab4,'room':_0x572be5}},{'$unwind':_0x16dd5c(0x256)},{'$match':{'product_details.bay':_0x2d45d2,'product_details.bin':_0x5867b2,'product_details.type':_0x530850}},{'$group':{'_id':_0x16dd5c(0x258),'name':{'$first':_0x16dd5c(0x208)},'product_stock':{'$first':_0x16dd5c(0x292)},'level':{'$first':_0x16dd5c(0x177)},'isle':{'$first':_0x16dd5c(0x23f)},'pallet':{'$first':_0x16dd5c(0x1a8)},'maxProducts':{'$first':_0x16dd5c(0x22c)}}}]);_0xaf8b1['status'](0xc8)['json'](_0x1cb876);}catch(_0x33da61){_0xaf8b1[_0x16dd5c(0x178)](0x194)[_0x16dd5c(0x1e1)]({'message':_0x33da61[_0x16dd5c(0x22b)]});}}),module[a0_0x397cd0(0x261)]=router;