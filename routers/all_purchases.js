var a0_0x38d43a=a0_0x13fc;(function(_0x3f313e,_0x6983cb){var _0x4a3f39=a0_0x13fc,_0xf28b8e=_0x3f313e();while(!![]){try{var _0x26163=parseInt(_0x4a3f39(0x19b))/0x1+-parseInt(_0x4a3f39(0x1c8))/0x2+parseInt(_0x4a3f39(0x138))/0x3*(parseInt(_0x4a3f39(0x15f))/0x4)+-parseInt(_0x4a3f39(0x1d7))/0x5*(-parseInt(_0x4a3f39(0x1da))/0x6)+-parseInt(_0x4a3f39(0x120))/0x7+parseInt(_0x4a3f39(0x186))/0x8*(-parseInt(_0x4a3f39(0x135))/0x9)+-parseInt(_0x4a3f39(0xd9))/0xa*(parseInt(_0x4a3f39(0xfd))/0xb);if(_0x26163===_0x6983cb)break;else _0xf28b8e['push'](_0xf28b8e['shift']());}catch(_0x909b7b){_0xf28b8e['push'](_0xf28b8e['shift']());}}}(a0_0x5075,0x8d19a));const express=require(a0_0x38d43a(0x1b3)),app=express(),router=express[a0_0x38d43a(0x106)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x38d43a(0x1b2));var ejs=require('ejs');const path=require(a0_0x38d43a(0x151)),users=require('../public/language/languages.json');router['get']('/view',auth,async(_0x139f9f,_0x1df907)=>{var _0x3e75d9=a0_0x38d43a;try{const {username:_0x495c5a,email:_0x2180c7,role:_0x2b9995}=_0x139f9f[_0x3e75d9(0x190)],_0x30b0b8=_0x139f9f[_0x3e75d9(0x190)],_0x476a06=await profile[_0x3e75d9(0x15e)]({'email':_0x30b0b8[_0x3e75d9(0x19c)]}),_0x61d1b=await staff[_0x3e75d9(0x15e)]({'email':_0x30b0b8[_0x3e75d9(0x19c)]});if(_0x30b0b8['role']==_0x3e75d9(0x182)){const _0x37b126=await staff['findOne']({'email':_0x30b0b8['email']});}const _0x4a8129=await master_shop[_0x3e75d9(0x1e7)]();let _0x7372fb;if(_0x30b0b8[_0x3e75d9(0x11a)]==_0x3e75d9(0x182)){const _0x4fbd0f=await staff[_0x3e75d9(0x15e)]({'email':_0x30b0b8[_0x3e75d9(0x19c)]});_0x7372fb=await purchases[_0x3e75d9(0x110)]([{'$match':{'warehouse_name':_0x4fbd0f['warehouse']}},{'$lookup':{'from':_0x3e75d9(0x1b5),'localField':_0x3e75d9(0x1b5),'foreignField':_0x3e75d9(0x1d6),'as':'suppliers_docs'}},{'$unwind':_0x3e75d9(0x1be)},{'$unwind':_0x3e75d9(0x198)},{'$group':{'_id':_0x3e75d9(0x1d4),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x3e75d9(0x1d8)},'date':{'$first':_0x3e75d9(0x111)},'warehouse_name':{'$first':_0x3e75d9(0x19f)},'room':{'$first':_0x3e75d9(0x187)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3e75d9(0x167)},'batch_code':{'$first':_0x3e75d9(0x1d5)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3e75d9(0x1be)},'total_product_quantity':{'$sum':_0x3e75d9(0x1b1)},'level':{'$addToSet':_0x3e75d9(0xf6)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3e75d9(0x1a4)},'floorlevel':{'$addToSet':_0x3e75d9(0x10f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x7372fb=await purchases[_0x3e75d9(0x110)]([{'$lookup':{'from':'suppliers','localField':_0x3e75d9(0x1b5),'foreignField':_0x3e75d9(0x1d6),'as':_0x3e75d9(0x17e)}},{'$unwind':_0x3e75d9(0x1be)},{'$unwind':_0x3e75d9(0x198)},{'$group':{'_id':_0x3e75d9(0x1d4),'invoice':{'$first':_0x3e75d9(0xe1)},'suppliers':{'$first':_0x3e75d9(0x1d8)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3e75d9(0x19f)},'room':{'$addToSet':_0x3e75d9(0x1d1)},'product':{'$push':_0x3e75d9(0x198)},'note':{'$first':_0x3e75d9(0xee)},'paid_amount':{'$first':_0x3e75d9(0x122)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3e75d9(0x167)},'batch_code':{'$first':_0x3e75d9(0x1d5)},'expiry_date':{'$first':_0x3e75d9(0x1b7)},'suppliers_docs':{'$first':_0x3e75d9(0x1be)},'total_product_quantity':{'$sum':_0x3e75d9(0x1b1)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3e75d9(0x1a4)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x4a8129[0x0]['language']==_0x3e75d9(0x1ab)){var _0x2cd877=users['English'];console[_0x3e75d9(0x128)](_0x2cd877);}else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]==_0x3e75d9(0x1a1))var _0x2cd877=users[_0x3e75d9(0x1a1)];else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]=='German')var _0x2cd877=users['German'];else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]==_0x3e75d9(0x1cd))var _0x2cd877=users[_0x3e75d9(0x1cd)];else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]==_0x3e75d9(0x1d2))var _0x2cd877=users['French'];else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]==_0x3e75d9(0x159))var _0x2cd877=users[_0x3e75d9(0x19d)];else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]=='Chinese')var _0x2cd877=users[_0x3e75d9(0xe5)];else{if(_0x4a8129[0x0][_0x3e75d9(0x1cb)]==_0x3e75d9(0x1c6))var _0x2cd877=users['Arabic'];}}}}}}}_0x1df907[_0x3e75d9(0x1e1)](_0x3e75d9(0x1c2),{'success':_0x139f9f[_0x3e75d9(0x10d)](_0x3e75d9(0x154)),'errors':_0x139f9f['flash'](_0x3e75d9(0x1af)),'purchases':_0x7372fb,'role':_0x30b0b8,'profile':_0x476a06,'master_shop':_0x4a8129,'language':_0x2cd877});}catch(_0x19caf5){console[_0x3e75d9(0x128)]('table\x20page',_0x19caf5),_0x1df907[_0x3e75d9(0x17a)](0xc8)[_0x3e75d9(0x192)]({'message':_0x19caf5['message']});}});function BayBinSelected(_0x4300ae,_0x5c15eb){var _0xac0476=a0_0x38d43a,_0x2ad0d3=[],_0x4dcd1d=[],_0x1436ac=[],_0x10ede4=[],_0x4558b7=[],_0x5d8f4d=[];let _0x512442=[];if(_0x4300ae==_0xac0476(0x107))switch(_0x5c15eb){case _0xac0476(0x179):_0x2ad0d3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4dcd1d=[0x1,0x2],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x1bf),_0xac0476(0x161)],_0x4558b7=['D'],_0x5d8f4d=['A'];break;case _0xac0476(0x158):_0x2ad0d3=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4dcd1d=[0x1,0x2],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x1bf),_0xac0476(0x161)],_0x4558b7=['D'],_0x5d8f4d=['B'];break;case'Shelves':_0x2ad0d3=[0x0],_0x4dcd1d=[0x0],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x161)],_0x4558b7=['D'],_0x5d8f4d=['S'];break;case _0xac0476(0x1a9):_0x2ad0d3=[0x0],_0x4dcd1d=[0x0],_0x10ede4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1436ac=['Floor'],_0x4558b7=['D'],_0x5d8f4d=['R'];break;}else{if(_0x4300ae==_0xac0476(0x18f))switch(_0x5c15eb){case _0xac0476(0x179):_0x2ad0d3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4dcd1d=['B','F'],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x1bf),_0xac0476(0x161)],_0x4558b7=['C'],_0x5d8f4d=['A'];break;case _0xac0476(0x158):_0x2ad0d3=[0x5,0x4,0x3,0x2,0x1],_0x4dcd1d=['F','B','S'],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x1bf),_0xac0476(0x161)],_0x4558b7=['C'],_0x5d8f4d=['B'];break;case'Rack\x20C':_0x2ad0d3=[0x1,0x2,0x3,0x4,0x5],_0x4dcd1d=['B','F','S'],_0x10ede4=[0x5,0x4,0x3,0x2,0x1],_0x1436ac=[_0xac0476(0x1bf),'Floor'],_0x4558b7=['C'],_0x5d8f4d=['C'];break;case _0xac0476(0x16b):_0x2ad0d3=[0x5,0x4,0x3,0x2,0x1],_0x4dcd1d=['F','B','S'],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=['Level',_0xac0476(0x161)],_0x4558b7=['C'],_0x5d8f4d=['D'];break;case _0xac0476(0x178):_0x2ad0d3=[0x4,0x3,0x2,0x1],_0x4dcd1d=[0x1,0x2],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x1bf),'Floor'],_0x4558b7=['C'],_0x5d8f4d=['E'];break;case _0xac0476(0xfb):_0x2ad0d3=[0x1,0x2,0x3],_0x4dcd1d=[0x1,0x2],_0x10ede4=[0x1,0x2,0x3,0x4,0x5],_0x1436ac=[_0xac0476(0x1bf)],_0x4558b7=['C'],_0x5d8f4d=['F'];break;}}return{'levels':_0x2ad0d3,'Isle':_0x4dcd1d,'rack':_0x10ede4,'type':_0x1436ac,'storage':_0x4558b7,'rak':_0x5d8f4d};}function a0_0x13fc(_0x2c6bae,_0x185c2f){var _0x5075c5=a0_0x5075();return a0_0x13fc=function(_0x13fc7a,_0x424e10){_0x13fc7a=_0x13fc7a-0xd6;var _0xb4121a=_0x5075c5[_0x13fc7a];return _0xb4121a;},a0_0x13fc(_0x2c6bae,_0x185c2f);}function a0_0x5075(){var _0x19f5ef=['secondary_unit','prod_Qty','German','image','Receiving\x20Area','abs','English\x20(US)','</body></html>','filter','$product_details.product_code','errors','</span>','$product.quantity','nodemailer','express','</head><body>','suppliers','POnumber','$expiry_date','/preview/:id','return_product','<h5\x20style=\x22text-align:\x20left;\x22>','quantity','production_date','max_product_unit','$suppliers_docs','Level','rak','alertQTY','all_purchases','Purchase\x20Return','bin','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Arabic\x20(ae)','/invoice/:id','142098EoOfvP','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','True','language','purchase_quantity','Spanish','Paid\x20For\x20Purchase','due_amount','type','$product.room_name','French','$product_details.product_name','$_id','$batch_code','name','301215wNywOl','$suppliers','add\x20post','66qRdHBb','currency','foreach\x20newproduct','product','payment\x20successfull','/all_purchases/view','$product_details.primary_code','render','prod_secondunit','sendMail','product_code','prod_invoice','$product_details','find','INC-','$product_details.product_stock','\x20<>\x20','3305910JXsWdm','edit_purchases','paid_amount','/give_payment/:id','save','maxperunit','Purchase\x20Mail','/view/return_purchase/:id','$invoice','Shelves','actual_qty','getMonth','Chinese','\x20<\x20wew\x20>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/upload/','error','level','</table>','push','add_purchases','$note','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchases\x20item\x20return\x20successfull','RoomAssign','product_code_hide','post','concat','secondary_code_hide','$product.bay','/CheckingWarehouse','product_cat','primary_code','\x20</h2>','Rack\x20F','$product_details.bay','11SWbiwk','Enabled','\x20Order\x20Date\x20:\x20','$name','prod_unit','prod_primunit','password','primary_code_hide','Error\x20Occurs','Router','DRY\x20STORAGE','An\x20error\x20occurred.','warehouse_name','$primary_code','redirect','</td>','flash','date','$product.floorlevel','aggregate','$date','$alertquantity','$brand','$secondary_unit','getFullYear','delivery_code','storage','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','master','role','<html><head><title></title>','$product_details.rack','host','forEach','body','1645665aWgIBa','<span\x20style=\x22float:\x20right;\x22>','$paid_amount','Arabic','expiry_date','finalize','prod_cat','<tr>','log','product_stock','Raw\x20Materials','standard_unit','findById','$product_details.type','$product_details.storage','back','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','delivery_date','stock_quantity','edit_purchases_view','54WJezks','$product_details.bin','Purchase\x20data\x20added\x20successfully','9mtAfep','map','maxStocks','$product_code','<strong>\x20Regards\x20</strong>','here','Logo.png','/all_purchases/view/','types','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','RMSEmail','prod_name','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','product_details','slice','exports','product_list','$maxStocks','</tbody>','gmail','$unit','string','$maxProdPerUnit','path','<h2>\x20','MaxStocks_data','success','$product_details.secondary_code','/barcode_scanner','$product_details.expiry_date','Rack\x20B','Portuguese\x20(BR)','room','Enclosed','pallet','product_name','findOne','613828ydFtBi','$product_details._id','Floor','/view/add_purchases','$product_details.pallet','</h5>','secondary_code','currency_placement','$return_data','catch','user_id','bay','Rack\x20D','get','getDate','<hr\x20class=\x22my-3\x22>','suppliers_data','JO_number','length','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','actual_uom','return_qty','$secondary_code','prod_code','Rack\x20E','Rack\x20A','status','warehouse','deliverycode','/../public','suppliers_docs','stock_data','/view/:id','Return\x20Goods','staff','prod_qty','$product_details.maxProducts','prod_pallet','129848robJlh','$room','rack','all_purchases_barcode','createTransport','prod_isle','purchase\x20data\x20update\x20successfully','batch_code','invoice','COLD\x20STORAGE','user','message','json','<div>','English','params','logo','stocks','$product','</tr>','\x20Order\x20Number\x20:\x20','189023dJEuwP','email','Portuguese','prod_level','$warehouse_name','floorlevel','Hindi','site_title','</div>','$product.type'];a0_0x5075=function(){return _0x19f5ef;};return a0_0x5075();}async function getRandom8DigitNumber(){var _0x5ab47e=a0_0x38d43a;const _0x5a53b6=0x989680,_0x905916=0x5f5e0ff,_0x300317=Math['floor'](Math['random']()*(_0x905916-_0x5a53b6+0x1))+_0x5a53b6;var _0x5a9331;const _0x4f0583=await purchases[_0x5ab47e(0x15e)]({'invoice':'INC-'+_0x300317});return _0x4f0583&&_0x4f0583['length']>0x0?_0x5a9331='INC-'+_0x300317:_0x5a9331=_0x5ab47e(0xd6)+_0x300317,_0x5a9331;}router[a0_0x38d43a(0x16c)](a0_0x38d43a(0x162),auth,async(_0x19d39a,_0x5a3fd6)=>{var _0x1e353e=a0_0x38d43a;try{const {username:_0x56523c,email:_0x40780c,role:_0x15e8e3}=_0x19d39a['user'],_0x4fd16c=_0x19d39a[_0x1e353e(0x190)],_0x4bfe30=await profile['findOne']({'email':_0x4fd16c[_0x1e353e(0x19c)]}),_0x301a15=await master_shop[_0x1e353e(0x1e7)](),_0x22684c=await staff[_0x1e353e(0x15e)]({'email':_0x4fd16c['email']}),_0x5c069f=await suppliers[_0x1e353e(0x1e7)]({});let _0x3e7875;if(_0x4fd16c[_0x1e353e(0x11a)]==_0x1e353e(0x182)){const _0xbf06f1=await staff[_0x1e353e(0x15e)]({'email':_0x4fd16c['email']});_0x3e7875=await warehouse[_0x1e353e(0x110)]([{'$match':{'status':_0x1e353e(0xfe),'name':_0xbf06f1['warehouse'],'warehouse_category':_0x1e353e(0x12a),'name':{'$ne':_0x1e353e(0x181)}}},{'$group':{'_id':_0x1e353e(0x100),'name':{'$first':_0x1e353e(0x100)}}}]);}else _0x3e7875=await warehouse[_0x1e353e(0x110)]([{'$match':{'status':_0x1e353e(0xfe),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1e353e(0x181)}}},{'$group':{'_id':_0x1e353e(0x100),'name':{'$first':_0x1e353e(0x100)}}}]);const _0xc81f66=await product['find']({}),_0x35d591=await warehouse[_0x1e353e(0x1e7)]({'status':_0x1e353e(0xfe)}),_0x27dc19=await purchases[_0x1e353e(0x1e7)]({}),_0x27b6bf=_0x27dc19[_0x1e353e(0x171)]+0x1,_0x2b0a56='INC-'+_0x27b6bf['toString']()['padStart'](0x5,'0');var _0x218b76=['Ambient',_0x1e353e(0x15b)];if(_0x301a15[0x0]['language']==_0x1e353e(0x1ab))var _0x577180=users[_0x1e353e(0x194)];else{if(_0x301a15[0x0][_0x1e353e(0x1cb)]==_0x1e353e(0x1a1))var _0x577180=users[_0x1e353e(0x1a1)];else{if(_0x301a15[0x0][_0x1e353e(0x1cb)]=='German')var _0x577180=users[_0x1e353e(0x1a7)];else{if(_0x301a15[0x0][_0x1e353e(0x1cb)]==_0x1e353e(0x1cd))var _0x577180=users['Spanish'];else{if(_0x301a15[0x0]['language']=='French')var _0x577180=users[_0x1e353e(0x1d2)];else{if(_0x301a15[0x0][_0x1e353e(0x1cb)]==_0x1e353e(0x159))var _0x577180=users[_0x1e353e(0x19d)];else{if(_0x301a15[0x0]['language']==_0x1e353e(0xe5))var _0x577180=users[_0x1e353e(0xe5)];else{if(_0x301a15[0x0][_0x1e353e(0x1cb)]==_0x1e353e(0x1c6))var _0x577180=users['Arabic'];}}}}}}}const _0x382be0=getRandom8DigitNumber();_0x382be0['then'](_0x3f8f42=>{var _0x8a06af=_0x1e353e;_0x5a3fd6['render'](_0x8a06af(0xed),{'success':_0x19d39a[_0x8a06af(0x10d)](_0x8a06af(0x154)),'errors':_0x19d39a[_0x8a06af(0x10d)](_0x8a06af(0x1af)),'role':_0x4fd16c,'profile':_0x4bfe30,'suppliers':_0x5c069f,'warehouse':_0x3e7875,'product':_0xc81f66,'invoice':_0x3f8f42,'master_shop':_0x301a15,'language':_0x577180,'find_data':_0x35d591,'rooms_data':_0x218b76});})[_0x1e353e(0x168)](_0x24f5df=>{var _0x3df087=_0x1e353e;_0x19d39a['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5a3fd6[_0x3df087(0x10b)](_0x3df087(0x1df));});}catch(_0x4b98ac){console[_0x1e353e(0x128)](_0x4b98ac);}}),router[a0_0x38d43a(0x16c)]('/view/add_purchases/:id',auth,async(_0x3dbaf2,_0x5b1a0c)=>{var _0x164b3c=a0_0x38d43a;try{const _0x28db90=_0x3dbaf2[_0x164b3c(0x195)]['id'];console[_0x164b3c(0x128)](_0x28db90);const _0x5481aa=await master_shop[_0x164b3c(0x1e7)]();console['log'](_0x164b3c(0x119),_0x5481aa);const _0x56a4fb=await product['findOne']({'name':_0x28db90});console['log'](_0x164b3c(0x1dd),_0x56a4fb),_0x5b1a0c[_0x164b3c(0x17a)](0xc8)[_0x164b3c(0x192)]({'product_data':_0x56a4fb,'master':_0x5481aa});}catch(_0x101328){console['log']('add_purchases\x20error',_0x101328);}}),router['post'](a0_0x38d43a(0x162),auth,async(_0x20142b,_0x1dd224)=>{var _0x4b3c2d=a0_0x38d43a;try{const {invoice:_0x1ef6bb,date:_0x58425c,warehouse_name:_0x4035af,prod_name:_0x16fed4,prod_code:_0x15e198,prod_qty:_0x2e0a67,prod_unit:_0x4a6742,prod_secondunit:_0x1c3adb,prod_level:_0x2f1964,prod_isle:_0x584313,prod_pallet:_0x1e9bde,note:_0x4503d1,expiry_date:_0xadce9c,batch_code:_0x3935bf,payable:_0x1af680,due_amount:_0x13c2d6,Room_name:_0x9ff35b,primary_code:_0xcd245c,secondary_code:_0xede7ca,MaxStocks_data:_0x251735,PO_number:_0x26ff34,SCRN:_0x17026a,JO_number:_0x59a71e}=_0x20142b['body'];if(typeof _0x16fed4==_0x4b3c2d(0x14f))var _0x109ec0=[_0x20142b[_0x4b3c2d(0x11f)]['prod_name']],_0x5dc3bb=[_0x20142b['body'][_0x4b3c2d(0x177)]],_0x480393=[_0x20142b[_0x4b3c2d(0x11f)]['prod_Qty']],_0x4d5959=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x102)]],_0x25edc3=[_0x20142b[_0x4b3c2d(0x11f)]['prod_secondunit']],_0x137973=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x19e)]],_0x7217ce=[_0x20142b[_0x4b3c2d(0x11f)]['primary_code']],_0x39284e=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x165)]],_0x4e74c7=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x153)]],_0x3187cf=[_0x20142b[_0x4b3c2d(0x11f)]['batch_code']],_0x1fd2f0=[_0x20142b['body'][_0x4b3c2d(0x124)]],_0x29d8a5=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x1bd)]],_0x35d2b8=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x1c1)]],_0x321584=[_0x20142b[_0x4b3c2d(0x11f)]['production_date']],_0x2275ef=[_0x20142b['body'][_0x4b3c2d(0x126)]],_0x2b36a2=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0xf1)]],_0x5d7903=[_0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x17c)]],_0x143192=[_0x20142b['body'][_0x4b3c2d(0x1e5)]],_0x1c01ec=[_0x20142b['body']['actual_qty']],_0x167d4c=[_0x20142b[_0x4b3c2d(0x11f)]['actual_uom']];else var _0x109ec0=[..._0x20142b['body']['prod_name']],_0x5dc3bb=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x177)]],_0x480393=[..._0x20142b['body'][_0x4b3c2d(0x1a6)]],_0x4d5959=[..._0x20142b['body'][_0x4b3c2d(0x102)]],_0x25edc3=[..._0x20142b[_0x4b3c2d(0x11f)]['prod_secondunit']],_0x137973=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x19e)]],_0x7217ce=[..._0x20142b['body']['primary_code']],_0x39284e=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x165)]],_0x4e74c7=[..._0x20142b['body'][_0x4b3c2d(0x153)]],_0x3187cf=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x18d)]],_0x1fd2f0=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x124)]],_0x29d8a5=[..._0x20142b['body'][_0x4b3c2d(0x1bd)]],_0x35d2b8=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x1c1)]],_0x321584=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x1bc)]],_0x2275ef=[..._0x20142b[_0x4b3c2d(0x11f)]['prod_cat']],_0x2b36a2=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0xf1)]],_0x5d7903=[..._0x20142b[_0x4b3c2d(0x11f)]['deliverycode']],_0x143192=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x1e5)]],_0x1c01ec=[..._0x20142b['body'][_0x4b3c2d(0xe3)]],_0x167d4c=[..._0x20142b[_0x4b3c2d(0x11f)][_0x4b3c2d(0x174)]];const _0x5526bd=_0x109ec0[_0x4b3c2d(0x139)](_0x266f98=>{return _0x266f98={'product_name':_0x266f98};});_0x1c01ec['forEach']((_0x4f2e80,_0x119977)=>{var _0x3bbf60=_0x4b3c2d;_0x5526bd[_0x119977]['actual_qty']=Math[_0x3bbf60(0x1aa)](_0x4f2e80);}),_0x167d4c[_0x4b3c2d(0x11e)]((_0x27ec72,_0x1efc8c)=>{var _0x4ec1f8=_0x4b3c2d;_0x5526bd[_0x1efc8c][_0x4ec1f8(0x174)]=_0x27ec72;}),_0x5dc3bb[_0x4b3c2d(0x11e)]((_0x34ec76,_0x43843e)=>{var _0x377b8f=_0x4b3c2d;_0x5526bd[_0x43843e][_0x377b8f(0x1e4)]=_0x34ec76;}),_0x480393['forEach']((_0x1e1a72,_0x1185cb)=>{var _0x49a505=_0x4b3c2d;_0x5526bd[_0x1185cb][_0x49a505(0x1bb)]=Math['abs'](_0x1e1a72);}),_0x4d5959[_0x4b3c2d(0x11e)]((_0x141758,_0x58c433)=>{var _0x516c83=_0x4b3c2d;_0x5526bd[_0x58c433][_0x516c83(0x12b)]=_0x141758;}),_0x25edc3[_0x4b3c2d(0x11e)]((_0x20b9cc,_0x51ffbc)=>{var _0x1b1a8e=_0x4b3c2d;_0x5526bd[_0x51ffbc][_0x1b1a8e(0x1a5)]=_0x20b9cc;}),_0x137973['forEach']((_0x45e134,_0x2f1e3d)=>{_0x2b36a2['forEach']((_0x532cfe,_0x5ae0bd)=>{var _0x375103=a0_0x13fc;if(_0x532cfe==_0x375103(0x1a9)&&_0x2f1e3d==_0x5ae0bd){console[_0x375103(0x128)](_0x532cfe+_0x375103(0xe6)+_0x2f1e3d+'\x20<>\x20'+_0x5ae0bd+_0x375103(0xd8)+_0x45e134);var _0x48ed70=_0x45e134[_0x375103(0x148)](0x3);_0x5526bd[_0x2f1e3d][_0x375103(0x117)]=_0x45e134[0x0],_0x5526bd[_0x2f1e3d][_0x375103(0x188)]=_0x45e134[0x1],_0x5526bd[_0x2f1e3d]['bay']=0x0,_0x5526bd[_0x2f1e3d]['bin']=0x0,_0x5526bd[_0x2f1e3d][_0x375103(0x1d0)]=_0x375103(0x161),_0x5526bd[_0x2f1e3d][_0x375103(0x1a0)]=_0x48ed70;}else{if(_0x532cfe==_0x375103(0xe2)&&_0x2f1e3d==_0x5ae0bd){var _0x48ed70=_0x45e134[_0x375103(0x148)](0x3);_0x5526bd[_0x2f1e3d][_0x375103(0x117)]=_0x45e134[0x0],_0x5526bd[_0x2f1e3d][_0x375103(0x188)]=_0x45e134[0x1],_0x5526bd[_0x2f1e3d][_0x375103(0x16a)]=0x0,_0x5526bd[_0x2f1e3d]['bin']=0x0,_0x5526bd[_0x2f1e3d][_0x375103(0x1d0)]=_0x375103(0x161),_0x5526bd[_0x2f1e3d][_0x375103(0x1a0)]=_0x45e134[0x5];}else{if(_0x2f1e3d==_0x5ae0bd){if(_0x45e134[0x0]=='A'&&_0x45e134[0x1]=='L'&&_0x45e134[0x2]=='L')console[_0x375103(0x128)](_0x532cfe+_0x375103(0xd8)+_0x2f1e3d+'\x20<>\x20'+_0x5ae0bd+'\x20<>\x20'+_0x45e134+_0x375103(0x13d)),_0x5526bd[_0x2f1e3d][_0x375103(0x117)]=_0x45e134[0x0],_0x5526bd[_0x2f1e3d][_0x375103(0x188)]=_0x45e134[0x1],_0x5526bd[_0x2f1e3d][_0x375103(0x16a)]=0x0,_0x5526bd[_0x2f1e3d]['bin']=0x0,_0x5526bd[_0x2f1e3d]['type']=_0x375103(0x161),_0x5526bd[_0x2f1e3d]['floorlevel']=_0x45e134[0x3];else{var _0x2bb76b;if(_0x45e134[0x4]=='L')_0x2bb76b=_0x375103(0x1bf);else _0x45e134[0x4]=='F'&&(_0x2bb76b=_0x375103(0x161));_0x5526bd[_0x2f1e3d][_0x375103(0x117)]=_0x45e134[0x0],_0x5526bd[_0x2f1e3d][_0x375103(0x188)]=_0x45e134[0x1],_0x5526bd[_0x2f1e3d][_0x375103(0x16a)]=_0x45e134[0x2],_0x5526bd[_0x2f1e3d][_0x375103(0x1c4)]=_0x45e134[0x3],_0x5526bd[_0x2f1e3d][_0x375103(0x1d0)]=_0x2bb76b,_0x5526bd[_0x2f1e3d][_0x375103(0x1a0)]=_0x45e134[0x5];}}}}});}),_0x7217ce[_0x4b3c2d(0x11e)]((_0xb4f9b8,_0x2ef8f2)=>{var _0x2e21bc=_0x4b3c2d;_0x5526bd[_0x2ef8f2][_0x2e21bc(0xf9)]=_0xb4f9b8;}),_0x39284e[_0x4b3c2d(0x11e)]((_0x2752e4,_0x1f6471)=>{var _0x33a7d2=_0x4b3c2d;_0x5526bd[_0x1f6471][_0x33a7d2(0x165)]=_0x2752e4;}),_0x4e74c7['forEach']((_0x29b357,_0x28f64e)=>{var _0x35304e=_0x4b3c2d;_0x5526bd[_0x28f64e][_0x35304e(0x13a)]=_0x29b357;}),_0x3187cf['forEach']((_0x37b5c1,_0x52e12f)=>{_0x5526bd[_0x52e12f]['batch_code']=_0x37b5c1;}),_0x1fd2f0[_0x4b3c2d(0x11e)]((_0xe793a0,_0x2398b3)=>{var _0x6958df=_0x4b3c2d;_0x5526bd[_0x2398b3][_0x6958df(0x124)]=_0xe793a0;}),_0x29d8a5['forEach']((_0x4bd591,_0xc19aee)=>{var _0x5b37b3=_0x4b3c2d;_0x5526bd[_0xc19aee][_0x5b37b3(0xde)]=_0x4bd591;}),_0x35d2b8[_0x4b3c2d(0x11e)]((_0x521b5e,_0x4d3e5b)=>{var _0x124cd0=_0x4b3c2d;_0x5526bd[_0x4d3e5b][_0x124cd0(0x1c1)]=_0x521b5e;}),_0x321584['forEach']((_0xfde57e,_0x232f78)=>{_0x5526bd[_0x232f78]['production_date']=_0xfde57e;}),_0x2275ef[_0x4b3c2d(0x11e)]((_0x2c93fa,_0xf4d45a)=>{var _0x16b00f=_0x4b3c2d;_0x5526bd[_0xf4d45a][_0x16b00f(0xf8)]=_0x2c93fa;}),_0x2b36a2[_0x4b3c2d(0x11e)]((_0x36b444,_0xb13bc5)=>{_0x5526bd[_0xb13bc5]['room_name']=_0x36b444;}),_0x5d7903[_0x4b3c2d(0x11e)]((_0x5874ac,_0x210eda)=>{var _0x1453d2=_0x4b3c2d;_0x5526bd[_0x210eda][_0x1453d2(0x116)]=_0x5874ac;}),_0x143192[_0x4b3c2d(0x11e)]((_0x5c7471,_0x26b99d)=>{var _0x196ecf=_0x4b3c2d;_0x5526bd[_0x26b99d][_0x196ecf(0x18e)]=_0x5c7471;});const _0xbffa6a=_0x2b36a2[_0x4b3c2d(0x139)](_0x23c8ac=>{return _0x23c8ac={'room_name':_0x23c8ac};}),_0x55a56e=_0x5526bd['filter'](_0x1f9b58=>_0x1f9b58[_0x4b3c2d(0x1bb)]!=='0'&&_0x1f9b58['quantity']!==''),_0x565b0f=new purchases({'invoice':_0x1ef6bb,'suppliers':_0x20142b[_0x4b3c2d(0x11f)]['suppliers'],'date':_0x58425c,'warehouse_name':_0x4035af,'product':_0x55a56e,'note':_0x4503d1,'due_amount':_0x13c2d6,'POnumber':_0x26ff34,'SCRN':_0x17026a,'JO_number':_0x59a71e,'roomList':_0xbffa6a}),_0x484b9c=await _0x565b0f[_0x4b3c2d(0xdd)](),_0x23be14=await purchases[_0x4b3c2d(0x15e)]({'invoice':_0x1ef6bb}),_0x3a77c6=_0x23be14[_0x4b3c2d(0x1dd)][_0x4b3c2d(0x139)](async _0x192b30=>{var _0x57ff60=_0x4b3c2d,_0x11a383=await warehouse[_0x57ff60(0x15e)]({'name':_0x4035af,'room':_0x192b30['room_name']}),_0x2f586d=0x0;return _0x11a383['product_details'][_0x57ff60(0x11e)](_0x9d3ec6=>{var _0x4e0057=_0x57ff60;_0x9d3ec6['product_name']==_0x192b30['product_name']&&_0x9d3ec6[_0x4e0057(0x1a0)]==_0x192b30['floorlevel']&&_0x9d3ec6[_0x4e0057(0x1d0)]==_0x192b30['type']&&_0x9d3ec6['bin']==_0x192b30['bin']&&_0x9d3ec6[_0x4e0057(0x16a)]==_0x192b30[_0x4e0057(0x16a)]&&_0x9d3ec6['rack']==_0x192b30[_0x4e0057(0x188)]&&_0x9d3ec6[_0x4e0057(0x117)]==_0x192b30[_0x4e0057(0x117)]&&_0x9d3ec6[_0x4e0057(0x124)]==_0x192b30['expiry_date']&&_0x9d3ec6['batch_code']==_0x192b30[_0x4e0057(0x18d)]&&_0x9d3ec6[_0x4e0057(0x1bc)]==_0x192b30['production_date']&&_0x9d3ec6[_0x4e0057(0x18e)]==_0x23be14[_0x4e0057(0x18e)]&&(_0x9d3ec6[_0x4e0057(0x129)]+=Math['abs'](_0x192b30[_0x4e0057(0x1bb)]),_0x2f586d++);}),_0x2f586d===0x0&&_0x11a383[_0x57ff60(0x147)][_0x57ff60(0xec)]({'product_name':_0x192b30[_0x57ff60(0x15d)],'product_stock':Math['abs'](_0x192b30[_0x57ff60(0x1bb)]),'primary_code':_0x192b30[_0x57ff60(0xf9)],'secondary_code':_0x192b30[_0x57ff60(0x165)],'product_code':_0x192b30[_0x57ff60(0x1e4)],'storage':_0x192b30[_0x57ff60(0x117)],'rack':_0x192b30[_0x57ff60(0x188)],'bay':_0x192b30[_0x57ff60(0x16a)],'bin':_0x192b30[_0x57ff60(0x1c4)],'type':_0x192b30[_0x57ff60(0x1d0)],'floorlevel':_0x192b30['floorlevel'],'maxProducts':_0x192b30[_0x57ff60(0x13a)],'unit':_0x192b30[_0x57ff60(0x12b)],'secondary_unit':_0x192b30[_0x57ff60(0x1a5)],'expiry_date':_0x192b30[_0x57ff60(0x124)],'maxPerUnit':_0x192b30[_0x57ff60(0xde)],'batch_code':_0x192b30[_0x57ff60(0x18d)],'alertQTY':_0x192b30[_0x57ff60(0x1c1)],'production_date':_0x192b30[_0x57ff60(0x1bc)],'product_cat':_0x192b30[_0x57ff60(0xf8)],'invoice':_0x192b30[_0x57ff60(0x18e)],'actual_qty':Math['abs'](_0x192b30[_0x57ff60(0xe3)]),'actual_uom':_0x192b30[_0x57ff60(0x174)]}),_0x11a383;});Promise['all'](_0x3a77c6)['then'](async _0x1b2fef=>{var _0x20327e=_0x4b3c2d;try{for(const _0x2e8d7e of _0x1b2fef){await _0x2e8d7e['save']();}const _0x3e937d=await master_shop[_0x20327e(0x1e7)](),_0x13e488=await email_settings[_0x20327e(0x15e)](),_0x2438d2=await supervisor_settings[_0x20327e(0x1e7)]();var _0x87afc3=_0x23be14[_0x20327e(0x1dd)],_0x234e78='',_0x575b05;for(_0x575b05 in _0x87afc3){_0x234e78+=_0x20327e(0x127)+_0x20327e(0x1c9)+_0x87afc3[_0x575b05]['product_name']+_0x20327e(0x10c)+_0x20327e(0x1c9)+_0x87afc3[_0x575b05][_0x20327e(0x1e4)]+_0x20327e(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x87afc3[_0x575b05][_0x20327e(0x1bb)]+_0x20327e(0x10c)+_0x20327e(0x1c9)+_0x87afc3[_0x575b05][_0x20327e(0x12b)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x87afc3[_0x575b05][_0x20327e(0x1a5)]+_0x20327e(0x10c)+_0x20327e(0x1c9)+_0x23be14[_0x20327e(0x109)]+_0x20327e(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x87afc3[_0x575b05]['room_name']+_0x20327e(0x10c)+_0x20327e(0x1c9)+_0x87afc3[_0x575b05][_0x20327e(0x117)]+_0x87afc3[_0x575b05][_0x20327e(0x188)]+_0x87afc3[_0x575b05][_0x20327e(0x16a)]+_0x87afc3[_0x575b05][_0x20327e(0x1c4)]+_0x87afc3[_0x575b05][_0x20327e(0x1d0)][0x0]+_0x87afc3[_0x575b05]['floorlevel']+_0x20327e(0x10c),_0x20327e(0x199);}let _0x2584e9=nodemailer[_0x20327e(0x18a)]({'host':_0x13e488[_0x20327e(0x11d)],'port':Number(_0x13e488['port']),'secure':![],'auth':{'user':_0x13e488[_0x20327e(0x19c)],'pass':_0x13e488[_0x20327e(0x103)]}}),_0x1f05f4={'from':_0x13e488[_0x20327e(0x19c)],'to':_0x2438d2[0x0][_0x20327e(0x143)],'subject':_0x20327e(0xdf),'attachments':[{'filename':_0x20327e(0x13e),'path':__dirname+_0x20327e(0x17d)+'/upload/'+_0x3e937d[0x0][_0x20327e(0x1a8)],'cid':_0x20327e(0x196)}],'html':_0x20327e(0x145)+_0x20327e(0x11b)+_0x20327e(0x1b4)+_0x20327e(0x193)+_0x20327e(0x118)+_0x20327e(0x193)+_0x20327e(0x1c5)+'</div>'+_0x20327e(0x193)+_0x20327e(0x152)+_0x3e937d[0x0]['site_title']+_0x20327e(0xfa)+_0x20327e(0x1a3)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x20327e(0x193)+_0x20327e(0x1ba)+_0x20327e(0x19a)+_0x23be14[_0x20327e(0x18e)]+'\x20'+_0x20327e(0x121)+_0x20327e(0xff)+_0x23be14[_0x20327e(0x10e)]+'\x20'+_0x20327e(0x1b0)+_0x20327e(0x164)+'</div>'+_0x20327e(0xef)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x20327e(0x127)+_0x20327e(0x131)+_0x20327e(0x173)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x20327e(0xe7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x20327e(0x146)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x234e78+'\x20'+_0x20327e(0x14c)+'</table>'+_0x20327e(0x193)+'<strong>\x20Regards\x20</strong>'+_0x20327e(0x172)+_0x3e937d[0x0][_0x20327e(0x1a2)]+'</h5>'+'</div>'+_0x20327e(0x1a3)+_0x20327e(0x1ac)};_0x2584e9[_0x20327e(0x1e3)](_0x1f05f4,function(_0x4e5452,_0x551455){var _0x59d1ef=_0x20327e;_0x4e5452?(console[_0x59d1ef(0x128)](_0x4e5452),console[_0x59d1ef(0x128)](_0x59d1ef(0x105))):console[_0x59d1ef(0x128)](_0x59d1ef(0x141));}),_0x20142b[_0x20327e(0x10d)]('success',_0x20327e(0x137)),_0x1dd224['redirect'](_0x20327e(0x13f));}catch(_0x1c76f1){console[_0x20327e(0xe9)](_0x1c76f1),_0x1dd224[_0x20327e(0x17a)](0x1f4)[_0x20327e(0x192)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4b3c2d(0x168)](_0x1c74b7=>{var _0xd1dc85=_0x4b3c2d;console[_0xd1dc85(0xe9)](_0x1c74b7),_0x1dd224[_0xd1dc85(0x17a)](0x1f4)[_0xd1dc85(0x192)]({'error':_0xd1dc85(0x108)});});}catch(_0x203867){console[_0x4b3c2d(0x128)](_0x203867);}}),router[a0_0x38d43a(0x16c)]('/preview/:id',auth,async(_0x1e70d4,_0x5d1b8e)=>{var _0x5da991=a0_0x38d43a;try{const {username:_0x368a40,email:_0xfefe7,role:_0x429dd1}=_0x1e70d4[_0x5da991(0x190)],_0x1170f6=_0x1e70d4[_0x5da991(0x190)],_0x327cc0=await profile['findOne']({'email':_0x1170f6[_0x5da991(0x19c)]}),_0x2d2e17=await master_shop[_0x5da991(0x1e7)](),_0x5a5e96=_0x1e70d4[_0x5da991(0x195)]['id'],_0x44f512=await purchases['findById'](_0x5a5e96),_0x3d4409=await warehouse[_0x5da991(0x110)]([{'$match':{'name':_0x44f512[_0x5da991(0x109)],'room':_0x44f512[_0x5da991(0x15a)]}},{'$unwind':_0x5da991(0x1e6)},{'$group':{'_id':_0x5da991(0x160),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5da991(0xd7)},'bay':{'$first':_0x5da991(0xfc)},'bin':{'$first':_0x5da991(0x136)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5da991(0x1e0)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5da991(0x1ae)},'storage':{'$first':_0x5da991(0x12e)},'rack':{'$first':_0x5da991(0x11c)},'expiry_date':{'$first':_0x5da991(0x157)}}}]),_0x118adb=await customer['find']({});let _0x46d311;if(_0x1170f6[_0x5da991(0x11a)]=='staff'){const _0x3aa3bf=await staff['findOne']({'email':_0x1170f6[_0x5da991(0x19c)]});_0x46d311=await warehouse[_0x5da991(0x110)]([{'$match':{'status':_0x5da991(0xfe),'name':_0x3aa3bf['warehouse']}},{'$group':{'_id':_0x5da991(0x100),'name':{'$first':_0x5da991(0x100)}}}]);}else _0x46d311=await warehouse[_0x5da991(0x110)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x199c43=await product['find']({}),_0x2e18e6=await suppliers[_0x5da991(0x1e7)]({}),_0x3e6dc1=BayBinSelected(_0x44f512[_0x5da991(0x109)],_0x44f512['room']);if(_0x2d2e17[0x0]['language']==_0x5da991(0x1ab)){var _0x2f8dda=users[_0x5da991(0x194)];console[_0x5da991(0x128)](_0x2f8dda);}else{if(_0x2d2e17[0x0][_0x5da991(0x1cb)]==_0x5da991(0x1a1))var _0x2f8dda=users['Hindi'];else{if(_0x2d2e17[0x0]['language']=='German')var _0x2f8dda=users[_0x5da991(0x1a7)];else{if(_0x2d2e17[0x0][_0x5da991(0x1cb)]==_0x5da991(0x1cd))var _0x2f8dda=users[_0x5da991(0x1cd)];else{if(_0x2d2e17[0x0]['language']==_0x5da991(0x1d2))var _0x2f8dda=users[_0x5da991(0x1d2)];else{if(_0x2d2e17[0x0][_0x5da991(0x1cb)]==_0x5da991(0x159))var _0x2f8dda=users[_0x5da991(0x19d)];else{if(_0x2d2e17[0x0][_0x5da991(0x1cb)]==_0x5da991(0xe5))var _0x2f8dda=users[_0x5da991(0xe5)];else{if(_0x2d2e17[0x0][_0x5da991(0x1cb)]==_0x5da991(0x1c6))var _0x2f8dda=users['Arabic'];}}}}}}}_0x5d1b8e[_0x5da991(0x1e1)](_0x5da991(0x134),{'success':_0x1e70d4['flash'](_0x5da991(0x154)),'errors':_0x1e70d4[_0x5da991(0x10d)](_0x5da991(0x1af)),'role':_0x1170f6,'profile':_0x327cc0,'customer':_0x118adb,'warehouse':_0x46d311,'product':_0x3d4409,'user':_0x44f512,'master_shop':_0x2d2e17,'unit':_0x199c43,'language':_0x2f8dda,'suppliers':_0x2e18e6,'dataSelected':_0x3e6dc1});}catch(_0x47f1f0){console['log'](_0x47f1f0);}}),router[a0_0x38d43a(0xf3)](a0_0x38d43a(0x1b8),auth,async(_0x4a82e7,_0x32408a)=>{var _0x4fe984=a0_0x38d43a;try{const _0x4279a6=_0x4a82e7['params']['id'],{invoice:_0x17aa91,warehouse_name:_0x185a98,Room_name:_0x46c5a6}=_0x4a82e7[_0x4fe984(0x11f)],_0x16abed=await warehouse[_0x4fe984(0x15e)]({'name':_0x185a98,'room':_0x46c5a6}),_0x13d734=await purchases['findOne']({'invoice':_0x17aa91});_0x13d734[_0x4fe984(0x1dd)][_0x4fe984(0x11e)](_0x23faeb=>{var _0x2851b9=_0x4fe984,_0x2a4750=0x0;const _0x473e36=_0x16abed[_0x2851b9(0x147)][_0x2851b9(0x139)](_0x423535=>{var _0x431779=_0x2851b9;_0x423535[_0x431779(0x15d)]==_0x23faeb['product_name']&&_0x423535['floorlevel']==_0x23faeb['floorlevel']&&_0x423535[_0x431779(0x1d0)]==_0x23faeb['type']&&_0x423535[_0x431779(0x1c4)]==_0x23faeb[_0x431779(0x1c4)]&&_0x423535[_0x431779(0x16a)]==_0x23faeb[_0x431779(0x16a)]&&_0x423535[_0x431779(0x188)]==_0x23faeb[_0x431779(0x188)]&&_0x423535['storage']==_0x23faeb[_0x431779(0x117)]&&_0x423535[_0x431779(0x124)]==_0x23faeb[_0x431779(0x124)]&&_0x423535[_0x431779(0x18d)]==_0x23faeb[_0x431779(0x18d)]&&_0x423535['production_date']==_0x23faeb[_0x431779(0x1bc)]&&_0x423535[_0x431779(0x132)]==_0x23faeb['delivery_date']&&_0x423535['delivery_code']==_0x23faeb['delivery_code']&&(_0x423535['product_stock']=parseInt(_0x423535['product_stock'])+parseInt(_0x23faeb[_0x431779(0x1bb)]),_0x2a4750++);});_0x2a4750=='0'&&(_0x16abed[_0x2851b9(0x147)]=_0x16abed[_0x2851b9(0x147)]['concat']({'product_name':_0x23faeb[_0x2851b9(0x15d)],'product_stock':_0x23faeb[_0x2851b9(0x1bb)],'primary_code':_0x23faeb[_0x2851b9(0xf9)],'secondary_code':_0x23faeb['secondary_code'],'product_code':_0x23faeb['product_code'],'storage':_0x23faeb[_0x2851b9(0x117)],'rack':_0x23faeb[_0x2851b9(0x188)],'bay':_0x23faeb[_0x2851b9(0x16a)],'bin':_0x23faeb[_0x2851b9(0x1c4)],'type':_0x23faeb[_0x2851b9(0x1d0)],'floorlevel':_0x23faeb[_0x2851b9(0x1a0)],'maxProducts':_0x23faeb[_0x2851b9(0x13a)],'unit':_0x23faeb[_0x2851b9(0x12b)],'secondary_unit':_0x23faeb[_0x2851b9(0x1a5)],'expiry_date':_0x23faeb['expiry_date'],'maxPerUnit':_0x23faeb[_0x2851b9(0xde)],'batch_code':_0x23faeb[_0x2851b9(0x18d)],'alertQTY':_0x23faeb[_0x2851b9(0x1c1)],'production_date':_0x23faeb[_0x2851b9(0x1bc)],'delivery_date':_0x23faeb[_0x2851b9(0x132)],'delivery_code':_0x23faeb[_0x2851b9(0x116)]}));}),await _0x16abed['save'](),_0x13d734[_0x4fe984(0x125)]=_0x4fe984(0x1ca);const _0xfc3d14=await _0x13d734[_0x4fe984(0xdd)]();_0x4a82e7[_0x4fe984(0x10d)](_0x4fe984(0x154),'Sales\x20Update\x20successfully'),_0x32408a[_0x4fe984(0x10b)]('/all_purchases/view');}catch(_0x5b38b0){console[_0x4fe984(0x128)](_0x5b38b0);}}),router[a0_0x38d43a(0x16c)](a0_0x38d43a(0x180),auth,async(_0x3e300e,_0x34823a)=>{var _0x22bf73=a0_0x38d43a;try{const {username:_0x13ae5d,email:_0x529543,role:_0x17c91c}=_0x3e300e['user'],_0x3b4580=_0x3e300e[_0x22bf73(0x190)],_0x26569e=await profile[_0x22bf73(0x15e)]({'email':_0x3b4580['email']}),_0x484787=await master_shop[_0x22bf73(0x1e7)](),_0x1c513b=_0x3e300e[_0x22bf73(0x195)]['id'],_0x198503=await purchases['findById'](_0x1c513b),_0x174f63=await suppliers[_0x22bf73(0x1e7)]({});let _0x184132;if(_0x3b4580[_0x22bf73(0x11a)]=='staff'){const _0x596f14=await staff[_0x22bf73(0x15e)]({'email':_0x3b4580[_0x22bf73(0x19c)]});_0x184132=await warehouse[_0x22bf73(0x1e7)]({'status':'Enabled','name':_0x596f14[_0x22bf73(0x17b)],'warehouse_category':'Raw\x20Materials'});}else _0x184132=await warehouse[_0x22bf73(0x110)]([{'$match':{'status':_0x22bf73(0xfe),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x22bf73(0x100)}}}]);const _0x360c4a=await product['find']({}),_0x13a402=BayBinSelected(_0x198503[_0x22bf73(0x109)],_0x198503[_0x22bf73(0x15a)]);let _0x208cfe=new Date(_0x198503[_0x22bf73(0x124)]),_0x134604=('0'+_0x208cfe[_0x22bf73(0x16d)]())[_0x22bf73(0x148)](-0x2),_0x221ab3=('0'+(_0x208cfe[_0x22bf73(0xe4)]()+0x1))['slice'](-0x2),_0x2c3b4e=_0x208cfe[_0x22bf73(0x115)](),_0x1a1ac7=_0x2c3b4e+'-'+_0x221ab3+'-'+_0x134604;if(_0x484787[0x0][_0x22bf73(0x1cb)]=='English\x20(US)'){var _0x19787e=users['English'];console[_0x22bf73(0x128)](_0x19787e);}else{if(_0x484787[0x0][_0x22bf73(0x1cb)]==_0x22bf73(0x1a1))var _0x19787e=users[_0x22bf73(0x1a1)];else{if(_0x484787[0x0][_0x22bf73(0x1cb)]==_0x22bf73(0x1a7))var _0x19787e=users[_0x22bf73(0x1a7)];else{if(_0x484787[0x0][_0x22bf73(0x1cb)]=='Spanish')var _0x19787e=users[_0x22bf73(0x1cd)];else{if(_0x484787[0x0][_0x22bf73(0x1cb)]==_0x22bf73(0x1d2))var _0x19787e=users['French'];else{if(_0x484787[0x0][_0x22bf73(0x1cb)]==_0x22bf73(0x159))var _0x19787e=users[_0x22bf73(0x19d)];else{if(_0x484787[0x0][_0x22bf73(0x1cb)]==_0x22bf73(0xe5))var _0x19787e=users[_0x22bf73(0xe5)];else{if(_0x484787[0x0][_0x22bf73(0x1cb)]==_0x22bf73(0x1c6))var _0x19787e=users[_0x22bf73(0x123)];}}}}}}}_0x34823a['render'](_0x22bf73(0xda),{'success':_0x3e300e[_0x22bf73(0x10d)](_0x22bf73(0x154)),'errors':_0x3e300e[_0x22bf73(0x10d)](_0x22bf73(0x1af)),'role':_0x3b4580,'profile':_0x26569e,'purchases':_0x198503,'suppliers':_0x174f63,'warehouse':_0x184132,'product':_0x360c4a,'master_shop':_0x484787,'language':_0x19787e,'ed_fullDate':_0x1a1ac7,'dataSelected':_0x13a402});}catch(_0x2c4248){console['log'](_0x2c4248);}}),router[a0_0x38d43a(0xf3)](a0_0x38d43a(0x180),auth,async(_0x5650c2,_0x5d4936)=>{var _0x7f637d=a0_0x38d43a;try{const _0x32365c=_0x5650c2[_0x7f637d(0x195)]['id'],_0x2712af=await purchases[_0x7f637d(0x15e)]({'_id':_0x5650c2[_0x7f637d(0x195)]['id']}),_0x1d43da=await warehouse['findOne']({'name':_0x2712af[_0x7f637d(0x109)],'room':_0x2712af[_0x7f637d(0x15a)]});_0x2712af[_0x7f637d(0x1dd)][_0x7f637d(0x11e)](_0x15c622=>{var _0x8ddabb=_0x7f637d;const _0x5db613=_0x1d43da[_0x8ddabb(0x147)][_0x8ddabb(0x139)](_0xfee1a0=>{var _0x471478=_0x8ddabb;_0xfee1a0[_0x471478(0x15d)]==_0x15c622[_0x471478(0x15d)]&&_0xfee1a0[_0x471478(0x1a0)]==_0x15c622[_0x471478(0x1a0)]&&_0xfee1a0[_0x471478(0x1d0)]==_0x15c622[_0x471478(0x1d0)]&&_0xfee1a0['bin']==_0x15c622[_0x471478(0x1c4)]&&_0xfee1a0[_0x471478(0x16a)]==_0x15c622['bay']&&_0xfee1a0[_0x471478(0x188)]==_0x15c622[_0x471478(0x188)]&&_0xfee1a0[_0x471478(0x117)]==_0x15c622[_0x471478(0x117)]&&(_0xfee1a0[_0x471478(0x129)]=parseInt(_0xfee1a0[_0x471478(0x129)])-parseInt(_0x15c622[_0x471478(0x1bb)]));});}),await _0x1d43da[_0x7f637d(0xdd)]();const {invoice:_0x1a58ec,suppliers:_0x39736a,date:_0x29a6fc,warehouse_name:_0x278277,prod_name:_0x922120,prod_code:_0x379d15,prod_qty:_0x36b525,prod_unit:_0x313185,prod_secondunit:_0x5ac7fc,prod_level:_0x33871f,prod_isle:_0x4b464e,prod_pallet:_0xfa7778,note:_0x23d48e,expiry_date:_0x394342,batch_code:_0x4a6160,paid_amount:_0x5ae452,due_amount:_0x5b64b5,Room_name:_0x38e11e,primary_code:_0x58218a,secondary_code:_0xa428e,PO_number:_0x393dc6,JO_number:_0x3a2547}=_0x5650c2[_0x7f637d(0x11f)];if(typeof _0x922120==_0x7f637d(0x14f))var _0x19272b=[_0x5650c2[_0x7f637d(0x11f)]['prod_name']],_0xf6129e=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x177)]],_0x67dcea=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x183)]],_0x58fcc7=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x101)]],_0x553931=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x1e2)]],_0x18114a=[_0x5650c2[_0x7f637d(0x11f)]['prod_level']],_0x1b2d82=[_0x5650c2['body'][_0x7f637d(0x18b)]],_0x2a2823=[_0x5650c2[_0x7f637d(0x11f)]['prod_pallet']],_0x57c83c=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0xf9)]],_0x39b0ec=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x165)]],_0x465790=[_0x5650c2[_0x7f637d(0x11f)]['MaxStocks_data']],_0xdec9aa=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x18d)]],_0x2fa6f3=[_0x5650c2['body'][_0x7f637d(0x124)]],_0x246c31=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x117)]],_0x17c409=[_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x1c0)]],_0x2469c8=[_0x5650c2['body']['type']];else var _0x19272b=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x144)]],_0xf6129e=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x177)]],_0x67dcea=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x183)]],_0x58fcc7=[..._0x5650c2[_0x7f637d(0x11f)]['prod_unit']],_0x553931=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x1e2)]],_0x18114a=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x19e)]],_0x1b2d82=[..._0x5650c2['body'][_0x7f637d(0x18b)]],_0x2a2823=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x185)]],_0x57c83c=[..._0x5650c2['body'][_0x7f637d(0xf9)]],_0x39b0ec=[..._0x5650c2[_0x7f637d(0x11f)]['secondary_code']],_0x465790=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x153)]],_0xdec9aa=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x18d)]],_0x2fa6f3=[..._0x5650c2['body'][_0x7f637d(0x124)]],_0x246c31=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x117)]],_0x17c409=[..._0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x1c0)]],_0x2469c8=[..._0x5650c2['body'][_0x7f637d(0x1d0)]];const _0x1162f1=_0x19272b[_0x7f637d(0x139)](_0x2e4f5c=>{return _0x2e4f5c={'product_name':_0x2e4f5c};});_0xf6129e[_0x7f637d(0x11e)]((_0x1c6047,_0x1d96b8)=>{var _0x410838=_0x7f637d;_0x1162f1[_0x1d96b8][_0x410838(0x1e4)]=_0x1c6047;}),_0x67dcea[_0x7f637d(0x11e)]((_0x4bee5d,_0x1b979d)=>{var _0x4ae543=_0x7f637d;_0x1162f1[_0x1b979d][_0x4ae543(0x1bb)]=_0x4bee5d;}),_0x58fcc7['forEach']((_0x18c790,_0x11a4c1)=>{var _0x1691c1=_0x7f637d;_0x1162f1[_0x11a4c1][_0x1691c1(0x12b)]=_0x18c790;}),_0x553931[_0x7f637d(0x11e)]((_0xd81b11,_0x155d29)=>{_0x1162f1[_0x155d29]['secondary_unit']=_0xd81b11;}),_0x18114a[_0x7f637d(0x11e)]((_0x45cf3d,_0x9bccc6)=>{var _0xd95c59=_0x7f637d;_0x1162f1[_0x9bccc6][_0xd95c59(0x16a)]=_0x45cf3d;}),_0x1b2d82[_0x7f637d(0x11e)]((_0x1e99c1,_0x4f7ab8)=>{var _0x4a0cf3=_0x7f637d;_0x1162f1[_0x4f7ab8][_0x4a0cf3(0x1c4)]=_0x1e99c1;}),_0x2a2823[_0x7f637d(0x11e)]((_0x24f3a3,_0x2a2203)=>{var _0x3da3fc=_0x7f637d;_0x1162f1[_0x2a2203][_0x3da3fc(0x1a0)]=_0x24f3a3;}),_0x57c83c[_0x7f637d(0x11e)]((_0x49c753,_0x3bb2ed)=>{var _0x30b794=_0x7f637d;_0x1162f1[_0x3bb2ed][_0x30b794(0xf9)]=_0x49c753;}),_0x39b0ec[_0x7f637d(0x11e)]((_0x238407,_0x299027)=>{_0x1162f1[_0x299027]['secondary_code']=_0x238407;}),_0x465790[_0x7f637d(0x11e)]((_0x46de82,_0xf72077)=>{var _0x1ce78a=_0x7f637d;_0x1162f1[_0xf72077][_0x1ce78a(0x13a)]=_0x46de82;}),_0xdec9aa[_0x7f637d(0x11e)]((_0x230f99,_0x250616)=>{var _0x209839=_0x7f637d;_0x1162f1[_0x250616][_0x209839(0x18d)]=_0x230f99;}),_0x2fa6f3['forEach']((_0x3bba1b,_0x5eaf5a)=>{var _0x394341=_0x7f637d;_0x1162f1[_0x5eaf5a][_0x394341(0x124)]=_0x3bba1b;}),_0x2469c8[_0x7f637d(0x11e)]((_0x119498,_0x5779ea)=>{var _0x2d1476=_0x7f637d;_0x1162f1[_0x5779ea][_0x2d1476(0x1d0)]=_0x119498;}),_0x246c31['forEach']((_0x3a9c8e,_0x50e1dd)=>{_0x1162f1[_0x50e1dd]['storage']=_0x3a9c8e;}),_0x17c409['forEach']((_0x267ef5,_0x261a60)=>{var _0x31ea5e=_0x7f637d;_0x1162f1[_0x261a60][_0x31ea5e(0x188)]=_0x267ef5;});const _0x5148c6=_0x1162f1[_0x7f637d(0x1ad)](_0x45872a=>_0x45872a[_0x7f637d(0x1bb)]!=='0'&&_0x45872a[_0x7f637d(0x1bb)]!=='');_0x2712af['invoice']=_0x1a58ec,_0x2712af['suppliers']=_0x39736a,_0x2712af['date']=_0x29a6fc,_0x2712af[_0x7f637d(0x109)]=_0x278277,_0x2712af['product']=_0x5148c6,_0x2712af['note']=_0x23d48e,_0x2712af[_0x7f637d(0xdb)]=_0x5ae452,_0x2712af[_0x7f637d(0x1cf)]=_0x5b64b5,_0x2712af[_0x7f637d(0x15a)]=_0x38e11e,_0x2712af[_0x7f637d(0x1b6)]=_0x393dc6,_0x2712af[_0x7f637d(0x170)]=_0x3a2547;const _0x311b93=await _0x2712af['save'](),_0x124b80=await warehouse[_0x7f637d(0x15e)]({'name':_0x5650c2['body'][_0x7f637d(0x109)],'room':_0x5650c2[_0x7f637d(0x11f)]['Room_name']});_0x2712af[_0x7f637d(0x1dd)][_0x7f637d(0x11e)](_0x38d266=>{var _0x5b3ca8=_0x7f637d,_0x5a6438=0x0;const _0x4901f5=_0x124b80[_0x5b3ca8(0x147)][_0x5b3ca8(0x139)](_0x1c6698=>{var _0x30c84b=_0x5b3ca8;_0x1c6698['product_name']==_0x38d266[_0x30c84b(0x15d)]&&_0x1c6698['floorlevel']==_0x38d266[_0x30c84b(0x1a0)]&&_0x1c6698[_0x30c84b(0x1d0)]==_0x38d266[_0x30c84b(0x1d0)]&&_0x1c6698[_0x30c84b(0x1c4)]==_0x38d266['bin']&&_0x1c6698[_0x30c84b(0x16a)]==_0x38d266[_0x30c84b(0x16a)]&&_0x1c6698[_0x30c84b(0x188)]==_0x38d266[_0x30c84b(0x188)]&&_0x1c6698['storage']==_0x38d266[_0x30c84b(0x117)]&&(_0x1c6698[_0x30c84b(0x129)]=parseInt(_0x1c6698['product_stock'])+parseInt(_0x38d266[_0x30c84b(0x1bb)]),_0x5a6438++);});_0x5a6438=='0'&&(_0x124b80[_0x5b3ca8(0x147)]=_0x124b80['product_details'][_0x5b3ca8(0xf4)]({'product_name':_0x38d266[_0x5b3ca8(0x15d)],'product_stock':_0x38d266['quantity'],'primary_code':_0x38d266['primary_code'],'secondary_code':_0x38d266[_0x5b3ca8(0x165)],'product_code':_0x38d266['product_code'],'storage':_0x38d266['storage'],'rack':_0x38d266[_0x5b3ca8(0x188)],'bay':_0x38d266['bay'],'bin':_0x38d266['bin'],'type':_0x38d266[_0x5b3ca8(0x1d0)],'floorlevel':_0x38d266['floorlevel'],'maxProducts':_0x38d266[_0x5b3ca8(0x13a)],'unit':_0x38d266[_0x5b3ca8(0x12b)],'secondary_unit':_0x38d266[_0x5b3ca8(0x1a5)],'expiry_date':_0x38d266['expiry_date']}));}),await _0x124b80[_0x7f637d(0xdd)]();const _0x3c4ee0=await s_payment_data[_0x7f637d(0x15e)]({'invoice':_0x5650c2[_0x7f637d(0x11f)][_0x7f637d(0x18e)]});if(_0x3c4ee0===null){}else console[_0x7f637d(0x128)]('suppliers',_0x3c4ee0,_0x5650c2['body']['invoice']),_0x3c4ee0[_0x7f637d(0x1b5)]=_0x5650c2[_0x7f637d(0x11f)]['suppliers'],await _0x3c4ee0['save']();_0x5650c2[_0x7f637d(0x10d)](_0x7f637d(0x154),_0x7f637d(0x18c)),_0x5d4936[_0x7f637d(0x10b)](_0x7f637d(0x1df));}catch(_0x2217e6){console[_0x7f637d(0x128)](_0x2217e6);}}),router['post'](a0_0x38d43a(0xdc),auth,async(_0x448ea0,_0x17f898)=>{var _0x16da38=a0_0x38d43a;try{const _0x137262=_0x448ea0['params']['id'],{invoice:_0x111e5a,suppliers:_0x5cb23b,payable:_0x3ff044,due_amount:_0x1d911d}=_0x448ea0['body'],_0x73ea2c=await purchases['findById'](_0x137262);var _0x1f2912=_0x3ff044-_0x1d911d;_0x73ea2c['paid_amount']=parseFloat(_0x73ea2c[_0x16da38(0xdb)])+parseFloat(_0x1d911d),_0x73ea2c[_0x16da38(0x1cf)]=_0x1f2912;const _0x188249=await _0x73ea2c[_0x16da38(0xdd)]();console[_0x16da38(0x128)](_0x188249);const _0xbba52f=await s_payment_data['findOne']({'invoice':_0x111e5a});_0xbba52f['amount']=_0x1f2912,await _0xbba52f['save']();let _0x31c69c=new Date(),_0x47c2b4=('0'+_0x31c69c[_0x16da38(0x16d)]())[_0x16da38(0x148)](-0x2),_0xdf47ce=('0'+(_0x31c69c['getMonth']()+0x1))['slice'](-0x2),_0x250146=_0x31c69c['getFullYear'](),_0x509ecc=_0x250146+'-'+_0xdf47ce+'-'+_0x47c2b4;const _0x970514=new suppliers_payment({'invoice':_0x111e5a,'date':_0x250146+'-'+_0xdf47ce+'-'+_0x47c2b4,'suppliers':_0x5cb23b,'reason':_0x16da38(0x1ce),'amount':_0x1d911d}),_0x53d4cf=await _0x970514[_0x16da38(0xdd)]();_0x448ea0[_0x16da38(0x10d)](_0x16da38(0x154),_0x16da38(0x1de)),_0x17f898['redirect']('/all_purchases/view');}catch(_0x3db3fe){console[_0x16da38(0x128)](_0x3db3fe);}}),router['get'](a0_0x38d43a(0x1c7),auth,async(_0x38d87e,_0x49c398)=>{var _0x32f4e3=a0_0x38d43a;try{const {username:_0xfd22b3,email:_0x40c4c7,role:_0x32e559}=_0x38d87e['user'],_0x5dd449=_0x38d87e['user'],_0x2fde65=await profile[_0x32f4e3(0x15e)]({'email':_0x5dd449['email']}),_0x103cb3=await master_shop[_0x32f4e3(0x1e7)]();console['log']('master',_0x103cb3);const _0x1b2d1d=_0x38d87e[_0x32f4e3(0x195)]['id'],_0x36902b=await purchases['findById'](_0x1b2d1d);console[_0x32f4e3(0x128)](_0x36902b);const _0x2df9d5=await suppliers[_0x32f4e3(0x15e)]({'name':_0x36902b[_0x32f4e3(0x1b5)]});console[_0x32f4e3(0x128)](_0x2df9d5);if(_0x103cb3[0x0][_0x32f4e3(0x1cb)]==_0x32f4e3(0x1ab)){var _0x30ef85=users[_0x32f4e3(0x194)];console[_0x32f4e3(0x128)](_0x30ef85);}else{if(_0x103cb3[0x0][_0x32f4e3(0x1cb)]==_0x32f4e3(0x1a1))var _0x30ef85=users[_0x32f4e3(0x1a1)];else{if(_0x103cb3[0x0][_0x32f4e3(0x1cb)]=='German')var _0x30ef85=users[_0x32f4e3(0x1a7)];else{if(_0x103cb3[0x0][_0x32f4e3(0x1cb)]=='Spanish')var _0x30ef85=users[_0x32f4e3(0x1cd)];else{if(_0x103cb3[0x0][_0x32f4e3(0x1cb)]==_0x32f4e3(0x1d2))var _0x30ef85=users[_0x32f4e3(0x1d2)];else{if(_0x103cb3[0x0][_0x32f4e3(0x1cb)]==_0x32f4e3(0x159))var _0x30ef85=users[_0x32f4e3(0x19d)];else{if(_0x103cb3[0x0]['language']==_0x32f4e3(0xe5))var _0x30ef85=users['Chinese'];else{if(_0x103cb3[0x0]['language']==_0x32f4e3(0x1c6))var _0x30ef85=users[_0x32f4e3(0x123)];}}}}}}}_0x49c398[_0x32f4e3(0x1e1)]('purchase_invoice',{'success':_0x38d87e[_0x32f4e3(0x10d)]('success'),'errors':_0x38d87e[_0x32f4e3(0x10d)](_0x32f4e3(0x1af)),'role':_0x5dd449,'profile':_0x2fde65,'master_shop':_0x103cb3,'supplier':_0x2df9d5,'purchase':_0x36902b,'language':_0x30ef85});}catch(_0x371299){console['log'](_0x371299);}}),router[a0_0x38d43a(0x16c)](a0_0x38d43a(0xe0),auth,async(_0x9e821c,_0x365e38)=>{var _0x5a6108=a0_0x38d43a;try{const {username:_0x26b919,email:_0x3d174a,role:_0xdad879}=_0x9e821c['user'],_0x530421=_0x9e821c[_0x5a6108(0x190)],_0x314990=await profile[_0x5a6108(0x15e)]({'email':_0x530421[_0x5a6108(0x19c)]}),_0x3500b0=await master_shop['find']();console['log']('master',_0x3500b0);const _0x5c6b05=_0x9e821c[_0x5a6108(0x195)]['id'];console[_0x5a6108(0x128)](_0x5c6b05);const _0x53a64a=await purchases['findById'](_0x5c6b05);console['log'](_0x5a6108(0x169),_0x53a64a);const _0x555922=await product[_0x5a6108(0x1e7)]({}),_0x137105=await warehouse['aggregate']([{'$match':{'name':_0x53a64a[_0x5a6108(0x109)],'room':_0x53a64a['room'],'warehouse_category':_0x5a6108(0x12a)}},{'$unwind':_0x5a6108(0x1e6)},{'$group':{'_id':_0x5a6108(0x160),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5a6108(0xd7)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5a6108(0x136)},'type':{'$first':_0x5a6108(0x12d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5a6108(0x1e0)},'secondary_code':{'$first':_0x5a6108(0x155)},'product_code':{'$first':_0x5a6108(0x1ae)},'storage':{'$first':_0x5a6108(0x12e)},'rack':{'$first':_0x5a6108(0x11c)}}}]);warehouse_data=await warehouse[_0x5a6108(0x110)]([{'$match':{'status':_0x5a6108(0xfe),'name':_0x5a6108(0x181),'warehouse_category':_0x5a6108(0x12a)}},{'$group':{'_id':_0x5a6108(0x100),'name':{'$first':_0x5a6108(0x100)}}},{'$sort':{'name':0x1}}]),console[_0x5a6108(0x128)](_0x5a6108(0x17f),_0x137105);if(_0x3500b0[0x0][_0x5a6108(0x1cb)]==_0x5a6108(0x1ab)){var _0x7876f8=users[_0x5a6108(0x194)];console['log'](_0x7876f8);}else{if(_0x3500b0[0x0][_0x5a6108(0x1cb)]==_0x5a6108(0x1a1))var _0x7876f8=users['Hindi'];else{if(_0x3500b0[0x0]['language']==_0x5a6108(0x1a7))var _0x7876f8=users[_0x5a6108(0x1a7)];else{if(_0x3500b0[0x0]['language']=='Spanish')var _0x7876f8=users[_0x5a6108(0x1cd)];else{if(_0x3500b0[0x0][_0x5a6108(0x1cb)]=='French')var _0x7876f8=users[_0x5a6108(0x1d2)];else{if(_0x3500b0[0x0][_0x5a6108(0x1cb)]=='Portuguese\x20(BR)')var _0x7876f8=users['Portuguese'];else{if(_0x3500b0[0x0][_0x5a6108(0x1cb)]==_0x5a6108(0xe5))var _0x7876f8=users[_0x5a6108(0xe5)];else{if(_0x3500b0[0x0]['language']==_0x5a6108(0x1c6))var _0x7876f8=users[_0x5a6108(0x123)];}}}}}}}_0x365e38[_0x5a6108(0x1e1)]('return_purchase',{'success':_0x9e821c[_0x5a6108(0x10d)]('success'),'errors':_0x9e821c[_0x5a6108(0x10d)](_0x5a6108(0x1af)),'role':_0x530421,'profile':_0x314990,'user':_0x53a64a,'stock':_0x137105,'master_shop':_0x3500b0,'product':_0x555922,'language':_0x7876f8,'warehouse':warehouse_data});}catch(_0x440d76){console['log'](_0x440d76);}}),router[a0_0x38d43a(0xf3)]('/view/return_purchase/:id',auth,async(_0x49be67,_0x16548f)=>{var _0x4a166c=a0_0x38d43a;try{const {invoice:_0x3fda1a,date:_0x5a1569,warehouse_name:_0x12e85b,Room_name:_0x2131b1,product_name:_0x311611,purchase_quantity:_0x4adeca,stocks:_0x1c4f25,return_qty:_0x522b37,note:_0x16ae7b,level:_0x55009f,isle:_0x28d155,pallet:_0x1a92b5,to_warehouse_name:_0x58a863,to_Room_name:_0x2e281f}=_0x49be67[_0x4a166c(0x11f)],_0x4ca22f=await purchases['findOne']({'_id':_0x49be67[_0x4a166c(0x195)]['id']}),_0x1c6c4c=await warehouse[_0x4a166c(0x15e)]({'name':_0x12e85b,'room':_0x2131b1});if(typeof _0x311611=='string')var _0x22e1e5=[_0x49be67[_0x4a166c(0x11f)]['product_name']],_0x12b533=[_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x1cc)]],_0x2b4047=[_0x49be67['body']['stocks']],_0xc8cc76=[_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x175)]],_0x516ad1=[_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0xea)]],_0x1296f6=[_0x49be67[_0x4a166c(0x11f)]['isle']],_0x296bbd=[_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x15c)]],_0x367424=[_0x49be67[_0x4a166c(0x11f)]['types']],_0x5008f5=[_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0xf2)]],_0x21c1a3=[_0x49be67[_0x4a166c(0x11f)]['primary_code_hide']],_0x21402c=[_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0xf5)]];else var _0x22e1e5=[..._0x49be67['body'][_0x4a166c(0x15d)]],_0x12b533=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x1cc)]],_0x2b4047=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x197)]],_0xc8cc76=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x175)]],_0x516ad1=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0xea)]],_0x1296f6=[..._0x49be67[_0x4a166c(0x11f)]['isle']],_0x296bbd=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x15c)]],_0x367424=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x140)]],_0x5008f5=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0xf2)]],_0x21c1a3=[..._0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x104)]],_0x21402c=[..._0x49be67['body'][_0x4a166c(0xf5)]];const _0x341ad8=_0x22e1e5[_0x4a166c(0x139)](_0x29889a=>{return _0x29889a={'product_name':_0x29889a};});_0x12b533[_0x4a166c(0x11e)]((_0x5b1ce3,_0x3080df)=>{_0x341ad8[_0x3080df]['purchase_quantity']=_0x5b1ce3;}),_0x2b4047[_0x4a166c(0x11e)]((_0x190f3d,_0x5cccbe)=>{var _0x578d2f=_0x4a166c;_0x341ad8[_0x5cccbe][_0x578d2f(0x133)]=_0x190f3d;}),_0xc8cc76['forEach']((_0x4f9749,_0x11489e)=>{var _0x404df3=_0x4a166c;_0x341ad8[_0x11489e][_0x404df3(0x175)]=_0x4f9749;}),_0x516ad1[_0x4a166c(0x11e)]((_0x2cd9a8,_0x1e7b9b)=>{var _0x159468=_0x4a166c;_0x341ad8[_0x1e7b9b][_0x159468(0x16a)]=_0x2cd9a8;}),_0x1296f6[_0x4a166c(0x11e)]((_0x18469b,_0x19e41f)=>{var _0x48e3be=_0x4a166c;_0x341ad8[_0x19e41f][_0x48e3be(0x1c4)]=_0x18469b;}),_0x296bbd[_0x4a166c(0x11e)]((_0x28b962,_0x21cc27)=>{var _0x3a62b4=_0x4a166c;_0x341ad8[_0x21cc27][_0x3a62b4(0x1a0)]=_0x28b962;}),_0x367424[_0x4a166c(0x11e)]((_0x4cd36c,_0x58278b)=>{var _0x4bf250=_0x4a166c;_0x341ad8[_0x58278b][_0x4bf250(0x1d0)]=_0x4cd36c;}),_0x5008f5['forEach']((_0x4b4420,_0x23c982)=>{var _0x5e982f=_0x4a166c;_0x341ad8[_0x23c982][_0x5e982f(0x1e4)]=_0x4b4420;}),_0x21c1a3['forEach']((_0x2b5fef,_0x550fc9)=>{var _0x408b8a=_0x4a166c;_0x341ad8[_0x550fc9][_0x408b8a(0xf9)]=_0x2b5fef;}),_0x21402c[_0x4a166c(0x11e)]((_0x2c2a5d,_0x1d84e9)=>{var _0x1738f5=_0x4a166c;_0x341ad8[_0x1d84e9][_0x1738f5(0x165)]=_0x2c2a5d;}),_0x4ca22f[_0x4a166c(0x1dd)]['forEach'](_0x1b2fb9=>{var _0x26031c=_0x4a166c;const _0x50df4f=_0x1c6c4c[_0x26031c(0x147)][_0x26031c(0x139)](_0x1ffbb3=>{var _0x487515=_0x26031c;_0x1ffbb3['product_name']==_0x1b2fb9[_0x487515(0x15d)]&&_0x1ffbb3[_0x487515(0x1a0)]==_0x1b2fb9['floorlevel']&&_0x1ffbb3[_0x487515(0x1d0)]==_0x1b2fb9[_0x487515(0x1d0)]&&_0x1ffbb3['bin']==_0x1b2fb9[_0x487515(0x1c4)]&&_0x1ffbb3[_0x487515(0x16a)]==_0x1b2fb9[_0x487515(0x16a)]&&_0x1ffbb3[_0x487515(0x188)]==_0x1b2fb9[_0x487515(0x188)]&&_0x1ffbb3[_0x487515(0x117)]==_0x1b2fb9['storage']&&(console[_0x487515(0x128)](parseInt(_0x1ffbb3['product_stock'])+'\x20<>\x20'+parseInt(_0x1b2fb9[_0x487515(0x1bb)])),_0x1ffbb3[_0x487515(0x129)]=parseInt(_0x1ffbb3[_0x487515(0x129)])+parseInt(_0x1b2fb9['quantity']));});}),await _0x1c6c4c[_0x4a166c(0xdd)]();const _0x39f79f=_0x341ad8[_0x4a166c(0x1ad)](_0x5c7ce3=>_0x5c7ce3[_0x4a166c(0x175)]!=='0'&&_0x5c7ce3[_0x4a166c(0x175)]!=='');var _0x5bfe02=0x0;_0x39f79f[_0x4a166c(0x11e)](_0x577b17=>{var _0x5abb0b=_0x4a166c;console[_0x5abb0b(0x128)](_0x5abb0b(0x1dc),_0x577b17),(parseInt(_0x577b17['purchase_quantity'])<parseInt(_0x577b17['return_qty'])||parseInt(_0x577b17[_0x5abb0b(0x133)])<parseInt(_0x577b17[_0x5abb0b(0x175)]))&&_0x5bfe02++;});if(_0x5bfe02!=0x0)return _0x49be67[_0x4a166c(0x10d)](_0x4a166c(0x1af),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x16548f[_0x4a166c(0x10b)](_0x4a166c(0x12f));const _0x42472c=new purchases_return({'invoice':_0x3fda1a,'suppliers':_0x49be67[_0x4a166c(0x11f)][_0x4a166c(0x1b5)],'date':_0x5a1569,'warehouse_name':_0x12e85b,'return_product':_0x39f79f,'note':_0x16ae7b,'room':_0x2131b1,'to_warehouse_name':_0x58a863,'to_room':_0x2e281f}),_0x10e63d=await _0x42472c[_0x4a166c(0xdd)]();console[_0x4a166c(0x128)](_0x42472c);const _0x51d80f=await purchases_return[_0x4a166c(0x15e)]({'invoice':_0x3fda1a}),_0x4d802f=await warehouse['findOne']({'name':_0x58a863,'room':_0x2e281f});_0x51d80f[_0x4a166c(0x1b9)][_0x4a166c(0x11e)](_0x1f2ef2=>{var _0x29bdac=_0x4a166c,_0x47ea98=0x0;const _0x2dd069=_0x4d802f[_0x29bdac(0x147)][_0x29bdac(0x139)](_0x41759a=>{var _0x1e1f44=_0x29bdac;_0x41759a[_0x1e1f44(0x15d)]==_0x1f2ef2['product_name']&&_0x41759a[_0x1e1f44(0x1a0)]==_0x1f2ef2['floorlevel']&&_0x41759a[_0x1e1f44(0x1d0)]==_0x1f2ef2[_0x1e1f44(0x1d0)]&&_0x41759a[_0x1e1f44(0x1c4)]==_0x1f2ef2[_0x1e1f44(0x1c4)]&&_0x41759a[_0x1e1f44(0x16a)]==_0x1f2ef2[_0x1e1f44(0x16a)]&&(_0x41759a['product_stock']=parseInt(_0x41759a[_0x1e1f44(0x129)])-parseInt(_0x1f2ef2[_0x1e1f44(0x175)]),_0x47ea98++);});_0x47ea98=='0'&&(_0x4d802f[_0x29bdac(0x147)]=_0x4d802f['product_details']['concat']({'product_name':_0x1f2ef2['product_name'],'product_stock':_0x1f2ef2[_0x29bdac(0x175)],'primary_code':_0x1f2ef2[_0x29bdac(0xf9)],'secondary_code':_0x1f2ef2['secondary_code'],'product_code':_0x1f2ef2[_0x29bdac(0x1e4)],'storage':_0x1f2ef2[_0x29bdac(0x117)],'rack':_0x1f2ef2['rack'],'bay':_0x1f2ef2[_0x29bdac(0x16a)],'bin':_0x1f2ef2['bin'],'type':_0x1f2ef2[_0x29bdac(0x1d0)],'floorlevel':_0x1f2ef2[_0x29bdac(0x1a0)],'maxProducts':_0x1f2ef2[_0x29bdac(0x13a)],'unit':_0x1f2ef2['standard_unit'],'secondary_unit':_0x1f2ef2[_0x29bdac(0x1a5)],'expiry_date':_0x1f2ef2[_0x29bdac(0x124)]}));}),await _0x4d802f[_0x4a166c(0xdd)]();const _0x4369b2=await purchases['findOne']({'invoice':_0x3fda1a});_0x4369b2['return_data']='True';const _0x2eed76=await _0x4369b2[_0x4a166c(0xdd)](),_0x8523b8=new s_payment_data({'invoice':_0x3fda1a,'suppliers':_0x49be67['body'][_0x4a166c(0x1b5)],'reason':_0x4a166c(0x1c3)});await _0x8523b8[_0x4a166c(0xdd)]();const _0x9b379a=await master_shop['find']();console['log'](_0x4a166c(0x1d9),_0x9b379a[0x0][_0x4a166c(0x1a8)]);const _0x6d0323=await email_settings[_0x4a166c(0x15e)](),_0x316802=await suppliers[_0x4a166c(0x15e)]({'name':_0x49be67['body'][_0x4a166c(0x1b5)]});console[_0x4a166c(0x128)](_0x4a166c(0x16f),_0x316802);_0x9b379a[0x0][_0x4a166c(0x166)]==0x1?(right_currency=_0x9b379a[0x0][_0x4a166c(0x1db)],left_currency=''):(right_currency='',left_currency=_0x9b379a[0x0][_0x4a166c(0x1db)]);var _0x37e3cd=_0x22e1e5,_0x44d73e=_0xc8cc76,_0x24ed59='',_0x33e208;for(_0x33e208 in _0x37e3cd){_0x24ed59+=_0x4a166c(0x127)+_0x4a166c(0x1c9)+_0x37e3cd[_0x33e208]+_0x4a166c(0x10c)+_0x4a166c(0x1c9)+_0x44d73e[_0x33e208]+'</td>'+_0x4a166c(0x199);}console[_0x4a166c(0x128)](_0x4a166c(0x14a),_0x24ed59);let _0x4602ab=nodemailer[_0x4a166c(0x18a)]({'service':_0x4a166c(0x14d),'auth':{'user':_0x6d0323[_0x4a166c(0x19c)],'pass':_0x6d0323[_0x4a166c(0x103)]}}),_0x43a87b={'from':_0x6d0323[_0x4a166c(0x19c)],'to':_0x316802['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x4a166c(0x17d)+_0x4a166c(0xe8)+_0x9b379a[0x0][_0x4a166c(0x1a8)],'cid':_0x4a166c(0x196)}],'html':_0x4a166c(0x145)+'<html><head><title></title>'+_0x4a166c(0x1b4)+_0x4a166c(0x193)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4a166c(0x193)+_0x4a166c(0x1c5)+_0x4a166c(0x1a3)+_0x4a166c(0x193)+'<h2>\x20'+_0x9b379a[0x0][_0x4a166c(0x1a2)]+'\x20</h2>'+_0x4a166c(0x1a3)+_0x4a166c(0x1a3)+_0x4a166c(0x16e)+_0x4a166c(0x193)+_0x4a166c(0x1ba)+_0x4a166c(0x19a)+_0x3fda1a+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4a166c(0xff)+_0x5a1569+'\x20'+_0x4a166c(0x1b0)+'</h5>'+_0x4a166c(0x1a3)+_0x4a166c(0xef)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4a166c(0x127)+_0x4a166c(0x131)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x4a166c(0x142)+'</tr>'+_0x4a166c(0x130)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x24ed59+'\x20'+_0x4a166c(0x14c)+_0x4a166c(0xeb)+_0x4a166c(0x193)+_0x4a166c(0x13c)+_0x4a166c(0x172)+_0x9b379a[0x0][_0x4a166c(0x1a2)]+_0x4a166c(0x164)+'</div>'+_0x4a166c(0x1a3)+_0x4a166c(0x1ac)};_0x4602ab[_0x4a166c(0x1e3)](_0x43a87b,function(_0x4de131,_0x38bc37){var _0x59127b=_0x4a166c;_0x4de131?(console[_0x59127b(0x128)](_0x4de131),console[_0x59127b(0x128)](_0x59127b(0x105))):console[_0x59127b(0x128)](_0x59127b(0x141));}),_0x49be67['flash']('success',_0x4a166c(0xf0)),_0x16548f[_0x4a166c(0x10b)](_0x4a166c(0x1df));}catch(_0x201fe1){console[_0x4a166c(0x128)](_0x201fe1),_0x16548f[_0x4a166c(0x17a)](0xc8)[_0x4a166c(0x192)]({'message':_0x201fe1['message']});}}),router[a0_0x38d43a(0x16c)]('/barcode/:id',auth,async(_0x1a4beb,_0x4330c2)=>{var _0x21e181=a0_0x38d43a;try{const {username:_0x1c8e9f,email:_0x17e904,role:_0x3c7155}=_0x1a4beb[_0x21e181(0x190)],_0x106876=_0x1a4beb[_0x21e181(0x190)],_0x500144=await profile[_0x21e181(0x15e)]({'email':_0x106876[_0x21e181(0x19c)]}),_0x26d906=await master_shop[_0x21e181(0x1e7)](),_0x3ee53f=_0x1a4beb[_0x21e181(0x195)]['id'],_0x206fc=await purchases[_0x21e181(0x12c)](_0x3ee53f);if(_0x26d906[0x0][_0x21e181(0x1cb)]==_0x21e181(0x1ab))var _0xdac1f0=users['English'];else{if(_0x26d906[0x0]['language']==_0x21e181(0x1a1))var _0xdac1f0=users[_0x21e181(0x1a1)];else{if(_0x26d906[0x0][_0x21e181(0x1cb)]==_0x21e181(0x1a7))var _0xdac1f0=users['German'];else{if(_0x26d906[0x0][_0x21e181(0x1cb)]==_0x21e181(0x1cd))var _0xdac1f0=users[_0x21e181(0x1cd)];else{if(_0x26d906[0x0][_0x21e181(0x1cb)]==_0x21e181(0x1d2))var _0xdac1f0=users[_0x21e181(0x1d2)];else{if(_0x26d906[0x0][_0x21e181(0x1cb)]=='Portuguese\x20(BR)')var _0xdac1f0=users['Portuguese'];else{if(_0x26d906[0x0][_0x21e181(0x1cb)]==_0x21e181(0xe5))var _0xdac1f0=users[_0x21e181(0xe5)];else{if(_0x26d906[0x0][_0x21e181(0x1cb)]==_0x21e181(0x1c6))var _0xdac1f0=users[_0x21e181(0x123)];}}}}}}}_0x4330c2[_0x21e181(0x1e1)](_0x21e181(0x189),{'success':_0x1a4beb[_0x21e181(0x10d)](_0x21e181(0x154)),'errors':_0x1a4beb[_0x21e181(0x10d)](_0x21e181(0x1af)),'role':_0x106876,'profile':_0x500144,'alldata':_0x206fc,'master_shop':_0x26d906,'language':_0xdac1f0}),console[_0x21e181(0x128)](alldata);}catch(_0x32afcb){console[_0x21e181(0x128)](_0x32afcb);}}),router[a0_0x38d43a(0xf3)](a0_0x38d43a(0x156),async(_0x4b0b44,_0x46d34e)=>{var _0xc4ac97=a0_0x38d43a;const {product_code:_0x290cd7}=_0x4b0b44['body'];var _0x37e823;const _0x513ef4=await product[_0xc4ac97(0x110)]([{'$match':{'primary_code':_0x290cd7,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0xc4ac97(0x100)},'category':{'$first':'$category'},'brand':{'$first':_0xc4ac97(0x113)},'unit':{'$first':_0xc4ac97(0x14e)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0xc4ac97(0x13b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0xc4ac97(0x176)},'maxStocks':{'$first':_0xc4ac97(0x14b)},'maxProdPerUnit':{'$first':_0xc4ac97(0x150)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xc4ac97(0x114)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5287cc=await product[_0xc4ac97(0x110)]([{'$match':{'secondary_code':_0x290cd7,'product_category':_0xc4ac97(0x12a)}},{'$group':{'_id':_0xc4ac97(0x1d4),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0xc4ac97(0x113)},'unit':{'$first':_0xc4ac97(0x14e)},'alertquantity':{'$first':_0xc4ac97(0x112)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xc4ac97(0x10a)},'secondary_code':{'$first':_0xc4ac97(0x176)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0xc4ac97(0x150)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x513ef4[_0xc4ac97(0x171)]>0x0)_0x37e823=_0x513ef4;else _0x5287cc[_0xc4ac97(0x171)]>0x0&&(_0x37e823=_0x5287cc);_0x46d34e[_0xc4ac97(0x192)](_0x37e823);}),router[a0_0x38d43a(0xf3)](a0_0x38d43a(0xf7),async(_0x9b39fd,_0x543a48)=>{var _0x5071fd=a0_0x38d43a;const {primaryCode:_0x5eb0ed,secondaryCode:_0x447f06,productCode:_0x19642b,bay:_0xc1f13c,bin:_0x200c38,types:_0x4e1869,pallet:_0x57cb5f,warehouses:_0x293773,room:_0x4eb5fa}=_0x9b39fd['body'];console[_0x5071fd(0x128)](_0x9b39fd[_0x5071fd(0x11f)]);try{const _0x54352e=await warehouse[_0x5071fd(0x110)]([{'$match':{'name':_0x293773,'room':_0x4eb5fa}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0xc1f13c,'product_details.bin':_0x200c38,'product_details.type':_0x4e1869}},{'$group':{'_id':_0x5071fd(0x160),'name':{'$first':_0x5071fd(0x1d3)},'product_stock':{'$first':_0x5071fd(0xd7)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5071fd(0x163)},'maxProducts':{'$first':_0x5071fd(0x184)}}}]);_0x543a48['status'](0xc8)[_0x5071fd(0x192)](_0x54352e);}catch(_0x2ecc7f){_0x543a48[_0x5071fd(0x17a)](0x194)[_0x5071fd(0x192)]({'message':_0x2ecc7f[_0x5071fd(0x191)]});}}),module[a0_0x38d43a(0x149)]=router;