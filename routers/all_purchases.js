var a0_0x382e64=a0_0x3e2a;(function(_0x505eb0,_0x40ef8e){var _0x4f9ad0=a0_0x3e2a,_0x426f68=_0x505eb0();while(!![]){try{var _0x2caed3=-parseInt(_0x4f9ad0(0x29b))/0x1*(parseInt(_0x4f9ad0(0x24a))/0x2)+-parseInt(_0x4f9ad0(0x1d6))/0x3+-parseInt(_0x4f9ad0(0x1ff))/0x4*(-parseInt(_0x4f9ad0(0x262))/0x5)+parseInt(_0x4f9ad0(0x1c8))/0x6+-parseInt(_0x4f9ad0(0x2d2))/0x7*(-parseInt(_0x4f9ad0(0x243))/0x8)+-parseInt(_0x4f9ad0(0x21b))/0x9+parseInt(_0x4f9ad0(0x23b))/0xa;if(_0x2caed3===_0x40ef8e)break;else _0x426f68['push'](_0x426f68['shift']());}catch(_0x1e1186){_0x426f68['push'](_0x426f68['shift']());}}}(a0_0x21fb,0x65c84));function a0_0x21fb(){var _0x1d5a96=['INC-','currency','/barcode_scanner','</body></html>','rack','production_date','bin','Arabic\x20(ae)','type','$product_details.storage','$_id','MaxStocks_data','redirect','/barcode/:id','aggregate','slice','getFullYear','prod_primunit','concat','Logo.png','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Rack\x20C','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','invoice','purchases\x20item\x20return\x20successfull','/view/:id','$primary_code','map','</tr>','return_product','$product_details.bay','abs','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.level','role','purchase_invoice','Hindi','$alertquantity','level','$product_details.product_code','purchase_quantity','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','actual_uom','Return\x20Goods','</table>','here','batch_code','pallet','Portuguese','<tr>','1156855gjTqYM','Room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','body','$product_details.pallet','bay','primary_code','Purchase\x20Return','user_id','staff','Error\x20Occurs','master','/../public','$product_details.expiry_date','due_amount','logo','Chinese','foreach\x20newproduct','push','success','274392QNcIDq','prod_name','Enclosed','maxStocks','$return_data','/preview/:id','<h2>\x20','return_qty','../public/language/languages.json','suppliers_data','stocks','$maxStocks','Receiving\x20Area','rak','1548519ILwmBJ','Purchase\x20data\x20added\x20successfully','$product_details','floor','room_name','note','prod_secondunit','prod_unit','path','params','$secondary_unit','alertQTY','deliverycode','room','Router','$name','storage','Sales\x20Update\x20successfully','render','Spanish','</head><body>','getMonth','Rack\x20B','host','standard_unit','createTransport','True','findOne','$product_details.product_name','back','string','<span\x20style=\x22float:\x20right;\x22>','<h5>','add_purchases\x20error','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_level','/view','$room','floorlevel','flash','4BinCcT','RoomAssign','user','language','secondary_code','padStart','product_code','post','getDate','status','warehouse_name','types','payment\x20successfull','</h5>','table\x20page','forEach','prod_pallet','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','get','filter','quantity','edit_purchases','primary_code_hide','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Portuguese\x20(BR)','exports','catch','3892473TZZsbF','German','Shelves','prod_code','express','all_purchases','Email\x20sent\x20successfully','$batch_code','Raw\x20Materials','return_purchase','/give_payment/:id','$expiry_date','$product_details.maxProducts','$product.bin','findById','$note','add_purchases','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/add_purchases','$product.bay','password','all','Rack\x20F','warehouse','toString','paid_amount','prod_cat','$secondary_code','error','/all_purchases/view/','$suppliers','product_cat','8299040HblMyJ','product_name','$product.quantity','prod_qty','RMSEmail','Arabic','$product_details.product_stock','actual_qty','16VnuSpl','An\x20error\x20occurred\x20while\x20saving\x20data.','date','$product.floorlevel','\x20<\x20wew\x20>\x20','POnumber','log','282kWZsFF','$brand','add\x20post','Ambient','<div>','$category','prod_isle','delivery_date','$maxProdPerUnit','/upload/','random','$product_details.type','$product_details.bin','length','$suppliers_docs','English\x20(US)','$product_details.floorlevel','json','$product','$date','/all_purchases/view','<!DOCTYPE\x20html>','save','ejs','3135505YuALyN','product_details','delivery_code','French','$product_details.rack','</tbody>','$product_details.secondary_code','$product.type','currency_placement','secondary_unit','product_stock','Enabled','image','Floor','Level','product','find','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','suppliers','$product_details.primary_code','Rack\x20A','</div>','$unit','/invoice/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','purchase\x20data\x20update\x20successfully','email','<strong>\x20Regards\x20</strong>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<html><head><title></title>','<hr\x20class=\x22my-3\x22>','site_title','Rack\x20E','errors','secondary_code_hide','sendMail','English','$due_amount','</span>','maxperunit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','\x20<>\x20','product_code_hide','An\x20error\x20occurred.','port','stock_quantity','return_data','Purchase\x20Return\x20Mail','isle','message','There\x27s\x20a\x20error\x20in\x20this\x20transaction','suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$warehouse_name','$product.room_name','\x20</h2>','3317YWBEzE','$product_details._id','nodemailer'];a0_0x21fb=function(){return _0x1d5a96;};return a0_0x21fb();}const express=require(a0_0x382e64(0x21f)),app=express(),router=express[a0_0x382e64(0x1e4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x382e64(0x29d));var ejs=require(a0_0x382e64(0x261));function a0_0x3e2a(_0x21b318,_0x3880b9){var _0x21fb6c=a0_0x21fb();return a0_0x3e2a=function(_0x3e2a74,_0x115f8e){_0x3e2a74=_0x3e2a74-0x1bb;var _0x5fafe4=_0x21fb6c[_0x3e2a74];return _0x5fafe4;},a0_0x3e2a(_0x21b318,_0x3880b9);}const path=require(a0_0x382e64(0x1de)),users=require(a0_0x382e64(0x1d0));router[a0_0x382e64(0x212)](a0_0x382e64(0x1fb),auth,async(_0xf4ba42,_0x26b72e)=>{var _0x21264d=a0_0x382e64;try{const {username:_0x553420,email:_0x256365,role:_0x44a271}=_0xf4ba42[_0x21264d(0x201)],_0x26c847=_0xf4ba42[_0x21264d(0x201)],_0x546e14=await profile[_0x21264d(0x1f1)]({'email':_0x26c847[_0x21264d(0x27d)]}),_0x1eaaeb=await staff['findOne']({'email':_0x26c847[_0x21264d(0x27d)]});if(_0x26c847[_0x21264d(0x2c2)]==_0x21264d(0x1bd)){const _0x22f6e9=await staff['findOne']({'email':_0x26c847[_0x21264d(0x27d)]});}const _0x1640d0=await master_shop[_0x21264d(0x272)]();let _0x37c856;if(_0x26c847[_0x21264d(0x2c2)]==_0x21264d(0x1bd)){const _0x58b2d9=await staff[_0x21264d(0x1f1)]({'email':_0x26c847[_0x21264d(0x27d)]});_0x37c856=await purchases[_0x21264d(0x2ac)]([{'$match':{'warehouse_name':_0x58b2d9[_0x21264d(0x232)]}},{'$lookup':{'from':'suppliers','localField':_0x21264d(0x275),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x21264d(0x2a8),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x21264d(0x239)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x21264d(0x298)},'room':{'$first':_0x21264d(0x1fc)},'product':{'$push':_0x21264d(0x25c)},'note':{'$first':_0x21264d(0x22a)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x21264d(0x1cc)},'batch_code':{'$first':_0x21264d(0x222)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x21264d(0x228)},'type':{'$addToSet':_0x21264d(0x269)},'floorlevel':{'$addToSet':_0x21264d(0x246)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x37c856=await purchases[_0x21264d(0x2ac)]([{'$lookup':{'from':_0x21264d(0x275),'localField':'suppliers','foreignField':'name','as':_0x21264d(0x296)}},{'$unwind':_0x21264d(0x258)},{'$unwind':_0x21264d(0x25c)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x21264d(0x239)},'date':{'$first':_0x21264d(0x25d)},'warehouse_name':{'$first':_0x21264d(0x298)},'room':{'$addToSet':_0x21264d(0x299)},'product':{'$push':_0x21264d(0x25c)},'note':{'$first':_0x21264d(0x22a)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x21264d(0x288)},'return_data':{'$first':_0x21264d(0x1cc)},'batch_code':{'$first':_0x21264d(0x222)},'expiry_date':{'$first':_0x21264d(0x226)},'suppliers_docs':{'$first':_0x21264d(0x258)},'total_product_quantity':{'$sum':_0x21264d(0x23d)},'level':{'$addToSet':_0x21264d(0x22e)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x21264d(0x269)},'floorlevel':{'$addToSet':_0x21264d(0x246)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1640d0[0x0]['language']==_0x21264d(0x259)){var _0x36321e=users[_0x21264d(0x287)];console[_0x21264d(0x249)](_0x36321e);}else{if(_0x1640d0[0x0][_0x21264d(0x202)]==_0x21264d(0x2c4))var _0x36321e=users[_0x21264d(0x2c4)];else{if(_0x1640d0[0x0][_0x21264d(0x202)]==_0x21264d(0x21c))var _0x36321e=users[_0x21264d(0x21c)];else{if(_0x1640d0[0x0][_0x21264d(0x202)]=='Spanish')var _0x36321e=users['Spanish'];else{if(_0x1640d0[0x0][_0x21264d(0x202)]=='French')var _0x36321e=users[_0x21264d(0x265)];else{if(_0x1640d0[0x0]['language']=='Portuguese\x20(BR)')var _0x36321e=users[_0x21264d(0x2d0)];else{if(_0x1640d0[0x0][_0x21264d(0x202)]==_0x21264d(0x1c4))var _0x36321e=users['Chinese'];else{if(_0x1640d0[0x0][_0x21264d(0x202)]==_0x21264d(0x2a5))var _0x36321e=users['Arabic'];}}}}}}}_0x26b72e['render'](_0x21264d(0x220),{'success':_0xf4ba42[_0x21264d(0x1fe)](_0x21264d(0x1c7)),'errors':_0xf4ba42[_0x21264d(0x1fe)](_0x21264d(0x284)),'purchases':_0x37c856,'role':_0x26c847,'profile':_0x546e14,'master_shop':_0x1640d0,'language':_0x36321e});}catch(_0x5d03f8){console[_0x21264d(0x249)](_0x21264d(0x20d),_0x5d03f8),_0x26b72e['status'](0xc8)[_0x21264d(0x25b)]({'message':_0x5d03f8['message']});}});function BayBinSelected(_0x37a2e5,_0x531605){var _0x541680=a0_0x382e64,_0x2417b1=[],_0x27024c=[],_0x109b03=[],_0x53d85d=[],_0x450f3c=[],_0x43e98d=[];let _0x3307d4=[];if(_0x37a2e5=='DRY\x20STORAGE')switch(_0x531605){case _0x541680(0x277):_0x2417b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x27024c=[0x1,0x2],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=['Level',_0x541680(0x26f)],_0x450f3c=['D'],_0x43e98d=['A'];break;case _0x541680(0x1ec):_0x2417b1=[0x6,0x5,0x4,0x3,0x2,0x1],_0x27024c=[0x1,0x2],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=[_0x541680(0x270),'Floor'],_0x450f3c=['D'],_0x43e98d=['B'];break;case'Shelves':_0x2417b1=[0x0],_0x27024c=[0x0],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=[_0x541680(0x26f)],_0x450f3c=['D'],_0x43e98d=['S'];break;case _0x541680(0x1d4):_0x2417b1=[0x0],_0x27024c=[0x0],_0x53d85d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x109b03=[_0x541680(0x26f)],_0x450f3c=['D'],_0x43e98d=['R'];break;}else{if(_0x37a2e5=='COLD\x20STORAGE')switch(_0x531605){case _0x541680(0x277):_0x2417b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x27024c=['B','F'],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=[_0x541680(0x270),_0x541680(0x26f)],_0x450f3c=['C'],_0x43e98d=['A'];break;case'Rack\x20B':_0x2417b1=[0x5,0x4,0x3,0x2,0x1],_0x27024c=['F','B','S'],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=['Level','Floor'],_0x450f3c=['C'],_0x43e98d=['B'];break;case _0x541680(0x2b4):_0x2417b1=[0x1,0x2,0x3,0x4,0x5],_0x27024c=['B','F','S'],_0x53d85d=[0x5,0x4,0x3,0x2,0x1],_0x109b03=[_0x541680(0x270),_0x541680(0x26f)],_0x450f3c=['C'],_0x43e98d=['C'];break;case'Rack\x20D':_0x2417b1=[0x5,0x4,0x3,0x2,0x1],_0x27024c=['F','B','S'],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=[_0x541680(0x270),'Floor'],_0x450f3c=['C'],_0x43e98d=['D'];break;case _0x541680(0x283):_0x2417b1=[0x4,0x3,0x2,0x1],_0x27024c=[0x1,0x2],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=[_0x541680(0x270),'Floor'],_0x450f3c=['C'],_0x43e98d=['E'];break;case _0x541680(0x231):_0x2417b1=[0x1,0x2,0x3],_0x27024c=[0x1,0x2],_0x53d85d=[0x1,0x2,0x3,0x4,0x5],_0x109b03=[_0x541680(0x270)],_0x450f3c=['C'],_0x43e98d=['F'];break;}}return{'levels':_0x2417b1,'Isle':_0x27024c,'rack':_0x53d85d,'type':_0x109b03,'storage':_0x450f3c,'rak':_0x43e98d};}async function getRandom8DigitNumber(){var _0x22bf2a=a0_0x382e64;const _0x215ee1=0x989680,_0x124813=0x5f5e0ff,_0x4c4b19=Math[_0x22bf2a(0x1d9)](Math[_0x22bf2a(0x254)]()*(_0x124813-_0x215ee1+0x1))+_0x215ee1;var _0x98a6f;const _0x567336=await purchases[_0x22bf2a(0x1f1)]({'invoice':_0x22bf2a(0x29e)+_0x4c4b19});return _0x567336&&_0x567336[_0x22bf2a(0x257)]>0x0?_0x98a6f=_0x22bf2a(0x29e)+_0x4c4b19:_0x98a6f='INC-'+_0x4c4b19,_0x98a6f;}router[a0_0x382e64(0x212)](a0_0x382e64(0x22d),auth,async(_0x574b10,_0x2c0f03)=>{var _0x321719=a0_0x382e64;try{const {username:_0x2216bf,email:_0x5b08f9,role:_0x36e302}=_0x574b10[_0x321719(0x201)],_0x49b3ee=_0x574b10[_0x321719(0x201)],_0x3a6b19=await profile[_0x321719(0x1f1)]({'email':_0x49b3ee[_0x321719(0x27d)]}),_0x29f712=await master_shop[_0x321719(0x272)](),_0x8e45f0=await staff[_0x321719(0x1f1)]({'email':_0x49b3ee[_0x321719(0x27d)]}),_0x550d10=await suppliers[_0x321719(0x272)]({});let _0x4cf6a9;if(_0x49b3ee[_0x321719(0x2c2)]==_0x321719(0x1bd)){const _0xa71928=await staff[_0x321719(0x1f1)]({'email':_0x49b3ee['email']});_0x4cf6a9=await warehouse[_0x321719(0x2ac)]([{'$match':{'status':_0x321719(0x26d),'name':_0xa71928['warehouse'],'warehouse_category':_0x321719(0x223),'name':{'$ne':_0x321719(0x2cb)}}},{'$group':{'_id':_0x321719(0x1e5),'name':{'$first':_0x321719(0x1e5)}}}]);}else _0x4cf6a9=await warehouse[_0x321719(0x2ac)]([{'$match':{'status':'Enabled','warehouse_category':_0x321719(0x223),'name':{'$ne':_0x321719(0x2cb)}}},{'$group':{'_id':_0x321719(0x1e5),'name':{'$first':_0x321719(0x1e5)}}}]);const _0x4a6708=await product['find']({}),_0x4f5078=await warehouse['find']({'status':_0x321719(0x26d)}),_0x13283f=await purchases[_0x321719(0x272)]({}),_0xe6bee8=_0x13283f[_0x321719(0x257)]+0x1,_0x4151d2='INC-'+_0xe6bee8[_0x321719(0x233)]()[_0x321719(0x204)](0x5,'0');var _0x521371=[_0x321719(0x24d),_0x321719(0x1ca)];if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x259))var _0x2e40c0=users[_0x321719(0x287)];else{if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x2c4))var _0x2e40c0=users[_0x321719(0x2c4)];else{if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x21c))var _0x2e40c0=users[_0x321719(0x21c)];else{if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x1e9))var _0x2e40c0=users[_0x321719(0x1e9)];else{if(_0x29f712[0x0][_0x321719(0x202)]=='French')var _0x2e40c0=users['French'];else{if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x218))var _0x2e40c0=users[_0x321719(0x2d0)];else{if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x1c4))var _0x2e40c0=users['Chinese'];else{if(_0x29f712[0x0][_0x321719(0x202)]==_0x321719(0x2a5))var _0x2e40c0=users[_0x321719(0x240)];}}}}}}}const _0x87dbf1=getRandom8DigitNumber();_0x87dbf1['then'](_0x28e673=>{var _0x251a8a=_0x321719;_0x2c0f03[_0x251a8a(0x1e8)](_0x251a8a(0x22b),{'success':_0x574b10['flash'](_0x251a8a(0x1c7)),'errors':_0x574b10[_0x251a8a(0x1fe)](_0x251a8a(0x284)),'role':_0x49b3ee,'profile':_0x3a6b19,'suppliers':_0x550d10,'warehouse':_0x4cf6a9,'product':_0x4a6708,'invoice':_0x28e673,'master_shop':_0x29f712,'language':_0x2e40c0,'find_data':_0x4f5078,'rooms_data':_0x521371});})[_0x321719(0x21a)](_0x259b5f=>{var _0x50bb0e=_0x321719;_0x574b10['flash'](_0x50bb0e(0x284),_0x50bb0e(0x295)),_0x2c0f03[_0x50bb0e(0x2aa)](_0x50bb0e(0x25e));});}catch(_0x522cce){console[_0x321719(0x249)](_0x522cce);}}),router[a0_0x382e64(0x212)]('/view/add_purchases/:id',auth,async(_0x2b2d40,_0x3b3005)=>{var _0x114633=a0_0x382e64;try{const _0x208010=_0x2b2d40[_0x114633(0x1df)]['id'];console[_0x114633(0x249)](_0x208010);const _0x1397bd=await master_shop['find']();console[_0x114633(0x249)]('master',_0x1397bd);const _0x2113b9=await product[_0x114633(0x1f1)]({'name':_0x208010});console[_0x114633(0x249)](_0x114633(0x271),_0x2113b9),_0x3b3005[_0x114633(0x208)](0xc8)[_0x114633(0x25b)]({'product_data':_0x2113b9,'master':_0x1397bd});}catch(_0x358f10){console[_0x114633(0x249)](_0x114633(0x1f7),_0x358f10);}}),router[a0_0x382e64(0x206)](a0_0x382e64(0x22d),auth,async(_0x1bcd88,_0x4f53f7)=>{var _0x309b33=a0_0x382e64;try{const {invoice:_0x3f06d2,date:_0x3abafb,warehouse_name:_0x1e79ef,prod_name:_0xf10b90,prod_code:_0x4fa69b,prod_qty:_0x311990,prod_unit:_0x25d6b0,prod_secondunit:_0x20501a,prod_level:_0x3ffd8d,prod_isle:_0x4d82c9,prod_pallet:_0x28d7f9,note:_0x10d892,expiry_date:_0x2befe0,batch_code:_0x42cc16,payable:_0x2a3721,due_amount:_0x4add67,Room_name:_0xd47521,primary_code:_0x4ecc89,secondary_code:_0x220439,MaxStocks_data:_0x424475,PO_number:_0x2102c6,SCRN:_0x27f9ed,JO_number:_0xa7df20}=_0x1bcd88[_0x309b33(0x2d5)];if(typeof _0xf10b90=='string')var _0x306fd0=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1c9)]],_0x3b78b8=[_0x1bcd88['body'][_0x309b33(0x21e)]],_0x1bb37c=[_0x1bcd88['body']['prod_Qty']],_0x45077a=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2af)]],_0x2323e8=[_0x1bcd88['body'][_0x309b33(0x1dc)]],_0x1505ab=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1fa)]],_0x5ca5f5=[_0x1bcd88[_0x309b33(0x2d5)]['primary_code']],_0x1d222c=[_0x1bcd88['body'][_0x309b33(0x203)]],_0x4a0f4a=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2a9)]],_0xc040cf=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2ce)]],_0xdaf22e=[_0x1bcd88['body'][_0x309b33(0x210)]],_0xd1ba33=[_0x1bcd88[_0x309b33(0x2d5)]['max_product_unit']],_0x3a1b24=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1e1)]],_0x286354=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2a3)]],_0x4a2d03=[_0x1bcd88['body'][_0x309b33(0x235)]],_0x17b6c0=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x200)]],_0x57086b=[_0x1bcd88['body'][_0x309b33(0x1e2)]],_0x4ed038=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x273)]],_0x54fadf=[_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x242)]],_0xf37da=[_0x1bcd88[_0x309b33(0x2d5)]['actual_uom']];else var _0x306fd0=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1c9)]],_0x3b78b8=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x21e)]],_0x1bb37c=[..._0x1bcd88['body']['prod_Qty']],_0x45077a=[..._0x1bcd88['body'][_0x309b33(0x2af)]],_0x2323e8=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1dc)]],_0x1505ab=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1fa)]],_0x5ca5f5=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2d8)]],_0x1d222c=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x203)]],_0x4a0f4a=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2a9)]],_0xc040cf=[..._0x1bcd88['body']['batch_code']],_0xdaf22e=[..._0x1bcd88['body'][_0x309b33(0x210)]],_0xd1ba33=[..._0x1bcd88[_0x309b33(0x2d5)]['max_product_unit']],_0x3a1b24=[..._0x1bcd88[_0x309b33(0x2d5)]['alertQTY']],_0x286354=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2a3)]],_0x4a2d03=[..._0x1bcd88[_0x309b33(0x2d5)]['prod_cat']],_0x17b6c0=[..._0x1bcd88['body'][_0x309b33(0x200)]],_0x57086b=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x1e2)]],_0x4ed038=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x273)]],_0x54fadf=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x242)]],_0xf37da=[..._0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x2ca)]];const _0x44f070=_0x306fd0['map'](_0xbb2937=>{return _0xbb2937={'product_name':_0xbb2937};});_0x54fadf[_0x309b33(0x20e)]((_0x43b4c4,_0x46f995)=>{var _0x493f52=_0x309b33;_0x44f070[_0x46f995][_0x493f52(0x242)]=Math['abs'](_0x43b4c4);}),_0xf37da[_0x309b33(0x20e)]((_0x12d099,_0x31a9f7)=>{_0x44f070[_0x31a9f7]['actual_uom']=_0x12d099;}),_0x3b78b8['forEach']((_0x192cf9,_0x3ca1b0)=>{_0x44f070[_0x3ca1b0]['product_code']=_0x192cf9;}),_0x1bb37c['forEach']((_0xff9981,_0xc4e31b)=>{var _0x17d2b2=_0x309b33;_0x44f070[_0xc4e31b][_0x17d2b2(0x214)]=Math[_0x17d2b2(0x2be)](_0xff9981);}),_0x45077a[_0x309b33(0x20e)]((_0x2617a9,_0x2f86bc)=>{var _0x1aa2c7=_0x309b33;_0x44f070[_0x2f86bc][_0x1aa2c7(0x1ee)]=_0x2617a9;}),_0x2323e8['forEach']((_0x5b347b,_0x50068e)=>{var _0x554ce4=_0x309b33;_0x44f070[_0x50068e][_0x554ce4(0x26b)]=_0x5b347b;}),_0x1505ab[_0x309b33(0x20e)]((_0x3b5aed,_0x15e046)=>{var _0x3be131=_0x309b33;_0x17b6c0[_0x3be131(0x20e)]((_0x3357ea,_0x450cf9)=>{var _0x2f5157=_0x3be131;if(_0x3357ea==_0x2f5157(0x1d4)&&_0x15e046==_0x450cf9){console[_0x2f5157(0x249)](_0x3357ea+_0x2f5157(0x247)+_0x15e046+_0x2f5157(0x28c)+_0x450cf9+'\x20<>\x20'+_0x3b5aed);var _0x4fb79c=_0x3b5aed[_0x2f5157(0x2ad)](0x3);_0x44f070[_0x15e046][_0x2f5157(0x1e6)]=_0x3b5aed[0x0],_0x44f070[_0x15e046][_0x2f5157(0x2a2)]=_0x3b5aed[0x1],_0x44f070[_0x15e046][_0x2f5157(0x2d7)]=0x0,_0x44f070[_0x15e046]['bin']=0x0,_0x44f070[_0x15e046][_0x2f5157(0x2a6)]='Floor',_0x44f070[_0x15e046][_0x2f5157(0x1fd)]=_0x4fb79c;}else{if(_0x3357ea==_0x2f5157(0x21d)&&_0x15e046==_0x450cf9){var _0x4fb79c=_0x3b5aed[_0x2f5157(0x2ad)](0x3);_0x44f070[_0x15e046][_0x2f5157(0x1e6)]=_0x3b5aed[0x0],_0x44f070[_0x15e046][_0x2f5157(0x2a2)]=_0x3b5aed[0x1],_0x44f070[_0x15e046]['bay']=0x0,_0x44f070[_0x15e046][_0x2f5157(0x2a4)]=0x0,_0x44f070[_0x15e046]['type']=_0x2f5157(0x26f),_0x44f070[_0x15e046][_0x2f5157(0x1fd)]=_0x3b5aed[0x5];}else{if(_0x15e046==_0x450cf9){if(_0x3b5aed[0x0]=='A'&&_0x3b5aed[0x1]=='L'&&_0x3b5aed[0x2]=='L')console[_0x2f5157(0x249)](_0x3357ea+_0x2f5157(0x28c)+_0x15e046+_0x2f5157(0x28c)+_0x450cf9+'\x20<>\x20'+_0x3b5aed+_0x2f5157(0x2cd)),_0x44f070[_0x15e046][_0x2f5157(0x1e6)]=_0x3b5aed[0x0],_0x44f070[_0x15e046]['rack']=_0x3b5aed[0x1],_0x44f070[_0x15e046][_0x2f5157(0x2d7)]=0x0,_0x44f070[_0x15e046]['bin']=0x0,_0x44f070[_0x15e046][_0x2f5157(0x2a6)]=_0x2f5157(0x26f),_0x44f070[_0x15e046][_0x2f5157(0x1fd)]=_0x3b5aed[0x3];else{var _0x18506a;if(_0x3b5aed[0x4]=='L')_0x18506a=_0x2f5157(0x270);else _0x3b5aed[0x4]=='F'&&(_0x18506a=_0x2f5157(0x26f));_0x44f070[_0x15e046][_0x2f5157(0x1e6)]=_0x3b5aed[0x0],_0x44f070[_0x15e046]['rack']=_0x3b5aed[0x1],_0x44f070[_0x15e046][_0x2f5157(0x2d7)]=_0x3b5aed[0x2],_0x44f070[_0x15e046]['bin']=_0x3b5aed[0x3],_0x44f070[_0x15e046][_0x2f5157(0x2a6)]=_0x18506a,_0x44f070[_0x15e046][_0x2f5157(0x1fd)]=_0x3b5aed[0x5];}}}}});}),_0x5ca5f5[_0x309b33(0x20e)]((_0x406aac,_0x4592d1)=>{var _0x1c620d=_0x309b33;_0x44f070[_0x4592d1][_0x1c620d(0x2d8)]=_0x406aac;}),_0x1d222c[_0x309b33(0x20e)]((_0x45312b,_0x1ea583)=>{var _0x1ec157=_0x309b33;_0x44f070[_0x1ea583][_0x1ec157(0x203)]=_0x45312b;}),_0x4a0f4a['forEach']((_0x523ad7,_0x2760ca)=>{var _0xafe51e=_0x309b33;_0x44f070[_0x2760ca][_0xafe51e(0x1cb)]=_0x523ad7;}),_0xc040cf[_0x309b33(0x20e)]((_0x27f4f1,_0x541395)=>{var _0x158e04=_0x309b33;_0x44f070[_0x541395][_0x158e04(0x2ce)]=_0x27f4f1;}),_0xdaf22e['forEach']((_0x135699,_0x449e8c)=>{var _0x488f0e=_0x309b33;_0x44f070[_0x449e8c][_0x488f0e(0x210)]=_0x135699;}),_0xd1ba33[_0x309b33(0x20e)]((_0x51ef7d,_0x392737)=>{var _0x24240c=_0x309b33;_0x44f070[_0x392737][_0x24240c(0x28a)]=_0x51ef7d;}),_0x3a1b24['forEach']((_0x2435fb,_0x96046c)=>{var _0x4d5920=_0x309b33;_0x44f070[_0x96046c][_0x4d5920(0x1e1)]=_0x2435fb;}),_0x286354[_0x309b33(0x20e)]((_0x1e744b,_0x25af5a)=>{_0x44f070[_0x25af5a]['production_date']=_0x1e744b;}),_0x4a2d03[_0x309b33(0x20e)]((_0x184f3c,_0x199a07)=>{var _0x5aa8a9=_0x309b33;_0x44f070[_0x199a07][_0x5aa8a9(0x23a)]=_0x184f3c;}),_0x17b6c0[_0x309b33(0x20e)]((_0x43609d,_0x2e6f97)=>{var _0x3ad9c5=_0x309b33;_0x44f070[_0x2e6f97][_0x3ad9c5(0x1da)]=_0x43609d;}),_0x57086b[_0x309b33(0x20e)]((_0x4c134d,_0x52f443)=>{_0x44f070[_0x52f443]['delivery_code']=_0x4c134d;}),_0x4ed038[_0x309b33(0x20e)]((_0x460a5d,_0x4c243c)=>{var _0x1609b4=_0x309b33;_0x44f070[_0x4c243c][_0x1609b4(0x2b6)]=_0x460a5d;});const _0x55202f=_0x17b6c0['map'](_0x171eca=>{return _0x171eca={'room_name':_0x171eca};}),_0x372035=_0x44f070[_0x309b33(0x213)](_0x1a7831=>_0x1a7831['quantity']!=='0'&&_0x1a7831[_0x309b33(0x214)]!==''),_0x3fcc6b=new purchases({'invoice':_0x3f06d2,'suppliers':_0x1bcd88[_0x309b33(0x2d5)][_0x309b33(0x275)],'date':_0x3abafb,'warehouse_name':_0x1e79ef,'product':_0x372035,'note':_0x10d892,'due_amount':_0x4add67,'POnumber':_0x2102c6,'SCRN':_0x27f9ed,'JO_number':_0xa7df20,'roomList':_0x55202f}),_0x1b1d62=await _0x3fcc6b[_0x309b33(0x260)](),_0x48400b=await purchases[_0x309b33(0x1f1)]({'invoice':_0x3f06d2}),_0x2043ac=_0x48400b[_0x309b33(0x271)][_0x309b33(0x2ba)](async _0x106ff1=>{var _0x79a176=_0x309b33,_0x278640=await warehouse['findOne']({'name':_0x1e79ef,'room':_0x106ff1['room_name']}),_0x5edd71=0x0;return _0x278640[_0x79a176(0x263)][_0x79a176(0x20e)](_0x3f463a=>{var _0x27f60e=_0x79a176;_0x3f463a['product_name']==_0x106ff1[_0x27f60e(0x23c)]&&_0x3f463a[_0x27f60e(0x1fd)]==_0x106ff1[_0x27f60e(0x1fd)]&&_0x3f463a[_0x27f60e(0x2a6)]==_0x106ff1[_0x27f60e(0x2a6)]&&_0x3f463a['bin']==_0x106ff1['bin']&&_0x3f463a['bay']==_0x106ff1[_0x27f60e(0x2d7)]&&_0x3f463a[_0x27f60e(0x2a2)]==_0x106ff1[_0x27f60e(0x2a2)]&&_0x3f463a[_0x27f60e(0x1e6)]==_0x106ff1['storage']&&_0x3f463a[_0x27f60e(0x210)]==_0x106ff1[_0x27f60e(0x210)]&&_0x3f463a['batch_code']==_0x106ff1[_0x27f60e(0x2ce)]&&_0x3f463a[_0x27f60e(0x2a3)]==_0x106ff1[_0x27f60e(0x2a3)]&&_0x3f463a[_0x27f60e(0x2b6)]==_0x48400b[_0x27f60e(0x2b6)]&&(_0x3f463a[_0x27f60e(0x26c)]+=Math[_0x27f60e(0x2be)](_0x106ff1[_0x27f60e(0x214)]),_0x5edd71++);}),_0x5edd71===0x0&&_0x278640[_0x79a176(0x263)][_0x79a176(0x1c6)]({'product_name':_0x106ff1[_0x79a176(0x23c)],'product_stock':Math[_0x79a176(0x2be)](_0x106ff1['quantity']),'primary_code':_0x106ff1[_0x79a176(0x2d8)],'secondary_code':_0x106ff1['secondary_code'],'product_code':_0x106ff1[_0x79a176(0x205)],'storage':_0x106ff1[_0x79a176(0x1e6)],'rack':_0x106ff1[_0x79a176(0x2a2)],'bay':_0x106ff1[_0x79a176(0x2d7)],'bin':_0x106ff1['bin'],'type':_0x106ff1[_0x79a176(0x2a6)],'floorlevel':_0x106ff1[_0x79a176(0x1fd)],'maxProducts':_0x106ff1[_0x79a176(0x1cb)],'unit':_0x106ff1[_0x79a176(0x1ee)],'secondary_unit':_0x106ff1[_0x79a176(0x26b)],'expiry_date':_0x106ff1[_0x79a176(0x210)],'maxPerUnit':_0x106ff1[_0x79a176(0x28a)],'batch_code':_0x106ff1['batch_code'],'alertQTY':_0x106ff1[_0x79a176(0x1e1)],'production_date':_0x106ff1[_0x79a176(0x2a3)],'product_cat':_0x106ff1['product_cat'],'invoice':_0x106ff1[_0x79a176(0x2b6)],'actual_qty':Math['abs'](_0x106ff1[_0x79a176(0x242)]),'actual_uom':_0x106ff1['actual_uom']}),_0x278640;});Promise[_0x309b33(0x230)](_0x2043ac)['then'](async _0x4d8627=>{var _0x27c18b=_0x309b33;try{for(const _0x70fbdf of _0x4d8627){await _0x70fbdf[_0x27c18b(0x260)]();}const _0x24bea1=await master_shop[_0x27c18b(0x272)](),_0x26f922=await email_settings[_0x27c18b(0x1f1)](),_0x231a31=await supervisor_settings[_0x27c18b(0x272)]();var _0xd9dfa4=_0x48400b[_0x27c18b(0x271)],_0xda3587='',_0x547b67;for(_0x547b67 in _0xd9dfa4){_0xda3587+=_0x27c18b(0x2d1)+_0x27c18b(0x27f)+_0xd9dfa4[_0x547b67]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd9dfa4[_0x547b67]['product_code']+_0x27c18b(0x2bf)+_0x27c18b(0x27f)+_0xd9dfa4[_0x547b67]['quantity']+_0x27c18b(0x2bf)+_0x27c18b(0x27f)+_0xd9dfa4[_0x547b67][_0x27c18b(0x1ee)]+_0x27c18b(0x2bf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd9dfa4[_0x547b67][_0x27c18b(0x26b)]+_0x27c18b(0x2bf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48400b[_0x27c18b(0x209)]+_0x27c18b(0x2bf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd9dfa4[_0x547b67][_0x27c18b(0x1da)]+_0x27c18b(0x2bf)+_0x27c18b(0x27f)+_0xd9dfa4[_0x547b67][_0x27c18b(0x1e6)]+_0xd9dfa4[_0x547b67][_0x27c18b(0x2a2)]+_0xd9dfa4[_0x547b67][_0x27c18b(0x2d7)]+_0xd9dfa4[_0x547b67][_0x27c18b(0x2a4)]+_0xd9dfa4[_0x547b67][_0x27c18b(0x2a6)][0x0]+_0xd9dfa4[_0x547b67]['floorlevel']+_0x27c18b(0x2bf),_0x27c18b(0x2bb);}let _0xdc3835=nodemailer[_0x27c18b(0x1ef)]({'host':_0x26f922[_0x27c18b(0x1ed)],'port':Number(_0x26f922[_0x27c18b(0x28f)]),'secure':![],'auth':{'user':_0x26f922[_0x27c18b(0x27d)],'pass':_0x26f922[_0x27c18b(0x22f)]}}),_0x36fc02={'from':_0x26f922[_0x27c18b(0x27d)],'to':_0x231a31[0x0][_0x27c18b(0x23f)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x27c18b(0x2b1),'path':__dirname+_0x27c18b(0x1c0)+_0x27c18b(0x253)+_0x24bea1[0x0][_0x27c18b(0x26e)],'cid':_0x27c18b(0x1c3)}],'html':_0x27c18b(0x25f)+_0x27c18b(0x280)+_0x27c18b(0x1ea)+'<div>'+_0x27c18b(0x217)+_0x27c18b(0x24e)+_0x27c18b(0x2c9)+_0x27c18b(0x278)+_0x27c18b(0x24e)+_0x27c18b(0x1ce)+_0x24bea1[0x0]['site_title']+_0x27c18b(0x29a)+'</div>'+_0x27c18b(0x278)+_0x27c18b(0x281)+_0x27c18b(0x24e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x27c18b(0x2b2)+_0x48400b[_0x27c18b(0x2b6)]+'\x20'+_0x27c18b(0x1f5)+'\x20Order\x20Date\x20:\x20'+_0x48400b[_0x27c18b(0x245)]+'\x20'+'</span>'+_0x27c18b(0x20c)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x27c18b(0x28b)+_0x27c18b(0x2d1)+_0x27c18b(0x2b5)+_0x27c18b(0x27b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x27c18b(0x211)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x27c18b(0x2c0)+_0x27c18b(0x297)+_0x27c18b(0x2b3)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xda3587+'\x20'+_0x27c18b(0x267)+'</table>'+_0x27c18b(0x24e)+_0x27c18b(0x27e)+_0x27c18b(0x1f6)+_0x24bea1[0x0][_0x27c18b(0x282)]+_0x27c18b(0x20c)+'</div>'+'</div>'+_0x27c18b(0x2a1)};_0xdc3835[_0x27c18b(0x286)](_0x36fc02,function(_0x89c969,_0x417daf){var _0x462390=_0x27c18b;_0x89c969?(console['log'](_0x89c969),console['log'](_0x462390(0x1be))):console[_0x462390(0x249)](_0x462390(0x221));}),_0x1bcd88['flash'](_0x27c18b(0x1c7),_0x27c18b(0x1d7)),_0x4f53f7[_0x27c18b(0x2aa)](_0x27c18b(0x238));}catch(_0x2718ee){console[_0x27c18b(0x237)](_0x2718ee),_0x4f53f7[_0x27c18b(0x208)](0x1f4)[_0x27c18b(0x25b)]({'error':_0x27c18b(0x244)});}})[_0x309b33(0x21a)](_0x391709=>{var _0x276079=_0x309b33;console[_0x276079(0x237)](_0x391709),_0x4f53f7[_0x276079(0x208)](0x1f4)[_0x276079(0x25b)]({'error':_0x276079(0x28e)});});}catch(_0x43a5c1){console[_0x309b33(0x249)](_0x43a5c1);}}),router[a0_0x382e64(0x212)](a0_0x382e64(0x1cd),auth,async(_0x28e9b4,_0x4793ab)=>{var _0x36a82e=a0_0x382e64;try{const {username:_0x1a954f,email:_0x5605ba,role:_0x19131b}=_0x28e9b4[_0x36a82e(0x201)],_0x22fd87=_0x28e9b4[_0x36a82e(0x201)],_0x31542a=await profile[_0x36a82e(0x1f1)]({'email':_0x22fd87[_0x36a82e(0x27d)]}),_0x18d331=await master_shop[_0x36a82e(0x272)](),_0x14b9e5=_0x28e9b4[_0x36a82e(0x1df)]['id'],_0x397227=await purchases[_0x36a82e(0x229)](_0x14b9e5),_0x4e8d88=await warehouse['aggregate']([{'$match':{'name':_0x397227[_0x36a82e(0x209)],'room':_0x397227[_0x36a82e(0x1e3)]}},{'$unwind':_0x36a82e(0x1d8)},{'$group':{'_id':_0x36a82e(0x29c),'name':{'$first':_0x36a82e(0x1f2)},'product_stock':{'$first':_0x36a82e(0x241)},'bay':{'$first':_0x36a82e(0x2bd)},'bin':{'$first':_0x36a82e(0x256)},'type':{'$first':_0x36a82e(0x255)},'floorlevel':{'$first':_0x36a82e(0x25a)},'primary_code':{'$first':_0x36a82e(0x276)},'secondary_code':{'$first':_0x36a82e(0x268)},'product_code':{'$first':_0x36a82e(0x2c7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x36a82e(0x266)},'expiry_date':{'$first':_0x36a82e(0x1c1)}}}]),_0xe7fda0=await customer[_0x36a82e(0x272)]({});let _0x2f6e29;if(_0x22fd87[_0x36a82e(0x2c2)]==_0x36a82e(0x1bd)){const _0x2ba87b=await staff[_0x36a82e(0x1f1)]({'email':_0x22fd87['email']});_0x2f6e29=await warehouse[_0x36a82e(0x2ac)]([{'$match':{'status':_0x36a82e(0x26d),'name':_0x2ba87b[_0x36a82e(0x232)]}},{'$group':{'_id':'$name','name':{'$first':_0x36a82e(0x1e5)}}}]);}else _0x2f6e29=await warehouse[_0x36a82e(0x2ac)]([{'$match':{'status':_0x36a82e(0x26d)}},{'$group':{'_id':_0x36a82e(0x1e5),'name':{'$first':'$name'}}}]);const _0xb27e38=await product[_0x36a82e(0x272)]({}),_0x14ede9=await suppliers[_0x36a82e(0x272)]({}),_0x3926a2=BayBinSelected(_0x397227[_0x36a82e(0x209)],_0x397227[_0x36a82e(0x1e3)]);if(_0x18d331[0x0]['language']==_0x36a82e(0x259)){var _0x2aa6b6=users[_0x36a82e(0x287)];console[_0x36a82e(0x249)](_0x2aa6b6);}else{if(_0x18d331[0x0]['language']=='Hindi')var _0x2aa6b6=users['Hindi'];else{if(_0x18d331[0x0][_0x36a82e(0x202)]==_0x36a82e(0x21c))var _0x2aa6b6=users[_0x36a82e(0x21c)];else{if(_0x18d331[0x0][_0x36a82e(0x202)]==_0x36a82e(0x1e9))var _0x2aa6b6=users[_0x36a82e(0x1e9)];else{if(_0x18d331[0x0]['language']==_0x36a82e(0x265))var _0x2aa6b6=users[_0x36a82e(0x265)];else{if(_0x18d331[0x0][_0x36a82e(0x202)]=='Portuguese\x20(BR)')var _0x2aa6b6=users[_0x36a82e(0x2d0)];else{if(_0x18d331[0x0][_0x36a82e(0x202)]==_0x36a82e(0x1c4))var _0x2aa6b6=users['Chinese'];else{if(_0x18d331[0x0][_0x36a82e(0x202)]==_0x36a82e(0x2a5))var _0x2aa6b6=users[_0x36a82e(0x240)];}}}}}}}_0x4793ab[_0x36a82e(0x1e8)]('edit_purchases_view',{'success':_0x28e9b4[_0x36a82e(0x1fe)](_0x36a82e(0x1c7)),'errors':_0x28e9b4[_0x36a82e(0x1fe)](_0x36a82e(0x284)),'role':_0x22fd87,'profile':_0x31542a,'customer':_0xe7fda0,'warehouse':_0x2f6e29,'product':_0x4e8d88,'user':_0x397227,'master_shop':_0x18d331,'unit':_0xb27e38,'language':_0x2aa6b6,'suppliers':_0x14ede9,'dataSelected':_0x3926a2});}catch(_0x574810){console[_0x36a82e(0x249)](_0x574810);}}),router[a0_0x382e64(0x206)](a0_0x382e64(0x1cd),auth,async(_0x1fb3db,_0x18a498)=>{var _0x4dd28e=a0_0x382e64;try{const _0x5c0ae2=_0x1fb3db[_0x4dd28e(0x1df)]['id'],{invoice:_0x4ef328,warehouse_name:_0xe54092,Room_name:_0x5d3644}=_0x1fb3db['body'],_0x52053c=await warehouse[_0x4dd28e(0x1f1)]({'name':_0xe54092,'room':_0x5d3644}),_0x5f49fc=await purchases[_0x4dd28e(0x1f1)]({'invoice':_0x4ef328});_0x5f49fc[_0x4dd28e(0x271)][_0x4dd28e(0x20e)](_0x28d72f=>{var _0x54e32d=_0x4dd28e,_0x248b20=0x0;const _0x5ac70=_0x52053c[_0x54e32d(0x263)][_0x54e32d(0x2ba)](_0x2ed39c=>{var _0x191874=_0x54e32d;_0x2ed39c[_0x191874(0x23c)]==_0x28d72f[_0x191874(0x23c)]&&_0x2ed39c['floorlevel']==_0x28d72f[_0x191874(0x1fd)]&&_0x2ed39c['type']==_0x28d72f[_0x191874(0x2a6)]&&_0x2ed39c[_0x191874(0x2a4)]==_0x28d72f[_0x191874(0x2a4)]&&_0x2ed39c['bay']==_0x28d72f[_0x191874(0x2d7)]&&_0x2ed39c[_0x191874(0x2a2)]==_0x28d72f[_0x191874(0x2a2)]&&_0x2ed39c[_0x191874(0x1e6)]==_0x28d72f[_0x191874(0x1e6)]&&_0x2ed39c[_0x191874(0x210)]==_0x28d72f['expiry_date']&&_0x2ed39c[_0x191874(0x2ce)]==_0x28d72f[_0x191874(0x2ce)]&&_0x2ed39c[_0x191874(0x2a3)]==_0x28d72f['production_date']&&_0x2ed39c[_0x191874(0x251)]==_0x28d72f['delivery_date']&&_0x2ed39c[_0x191874(0x264)]==_0x28d72f[_0x191874(0x264)]&&(_0x2ed39c[_0x191874(0x26c)]=parseInt(_0x2ed39c['product_stock'])+parseInt(_0x28d72f[_0x191874(0x214)]),_0x248b20++);});_0x248b20=='0'&&(_0x52053c[_0x54e32d(0x263)]=_0x52053c[_0x54e32d(0x263)][_0x54e32d(0x2b0)]({'product_name':_0x28d72f[_0x54e32d(0x23c)],'product_stock':_0x28d72f[_0x54e32d(0x214)],'primary_code':_0x28d72f[_0x54e32d(0x2d8)],'secondary_code':_0x28d72f[_0x54e32d(0x203)],'product_code':_0x28d72f['product_code'],'storage':_0x28d72f[_0x54e32d(0x1e6)],'rack':_0x28d72f[_0x54e32d(0x2a2)],'bay':_0x28d72f[_0x54e32d(0x2d7)],'bin':_0x28d72f['bin'],'type':_0x28d72f[_0x54e32d(0x2a6)],'floorlevel':_0x28d72f[_0x54e32d(0x1fd)],'maxProducts':_0x28d72f[_0x54e32d(0x1cb)],'unit':_0x28d72f[_0x54e32d(0x1ee)],'secondary_unit':_0x28d72f[_0x54e32d(0x26b)],'expiry_date':_0x28d72f['expiry_date'],'maxPerUnit':_0x28d72f[_0x54e32d(0x28a)],'batch_code':_0x28d72f['batch_code'],'alertQTY':_0x28d72f[_0x54e32d(0x1e1)],'production_date':_0x28d72f[_0x54e32d(0x2a3)],'delivery_date':_0x28d72f[_0x54e32d(0x251)],'delivery_code':_0x28d72f[_0x54e32d(0x264)]}));}),await _0x52053c[_0x4dd28e(0x260)](),_0x5f49fc['finalize']=_0x4dd28e(0x1f0);const _0x4ee75e=await _0x5f49fc[_0x4dd28e(0x260)]();_0x1fb3db[_0x4dd28e(0x1fe)]('success',_0x4dd28e(0x1e7)),_0x18a498[_0x4dd28e(0x2aa)](_0x4dd28e(0x25e));}catch(_0x2758d3){console[_0x4dd28e(0x249)](_0x2758d3);}}),router['get']('/view/:id',auth,async(_0x5dd576,_0x34d90d)=>{var _0x2059ee=a0_0x382e64;try{const {username:_0x48daa9,email:_0x2f9d9b,role:_0x5d1525}=_0x5dd576[_0x2059ee(0x201)],_0x1e5e86=_0x5dd576[_0x2059ee(0x201)],_0x1400aa=await profile['findOne']({'email':_0x1e5e86[_0x2059ee(0x27d)]}),_0x108385=await master_shop[_0x2059ee(0x272)](),_0x59f264=_0x5dd576[_0x2059ee(0x1df)]['id'],_0x2f8106=await purchases['findById'](_0x59f264),_0x4f1e72=await suppliers[_0x2059ee(0x272)]({});let _0x3208d6;if(_0x1e5e86['role']==_0x2059ee(0x1bd)){const _0x29eaba=await staff[_0x2059ee(0x1f1)]({'email':_0x1e5e86[_0x2059ee(0x27d)]});_0x3208d6=await warehouse[_0x2059ee(0x272)]({'status':_0x2059ee(0x26d),'name':_0x29eaba[_0x2059ee(0x232)],'warehouse_category':_0x2059ee(0x223)});}else _0x3208d6=await warehouse[_0x2059ee(0x2ac)]([{'$match':{'status':'Enabled','warehouse_category':_0x2059ee(0x223)}},{'$group':{'_id':_0x2059ee(0x1e5),'name':{'$first':_0x2059ee(0x1e5)}}}]);const _0x1e3f8f=await product[_0x2059ee(0x272)]({}),_0x204949=BayBinSelected(_0x2f8106[_0x2059ee(0x209)],_0x2f8106[_0x2059ee(0x1e3)]);let _0x7ffa54=new Date(_0x2f8106[_0x2059ee(0x210)]),_0x48567b=('0'+_0x7ffa54[_0x2059ee(0x207)]())[_0x2059ee(0x2ad)](-0x2),_0x34107e=('0'+(_0x7ffa54['getMonth']()+0x1))[_0x2059ee(0x2ad)](-0x2),_0x343c52=_0x7ffa54[_0x2059ee(0x2ae)](),_0x30b20a=_0x343c52+'-'+_0x34107e+'-'+_0x48567b;if(_0x108385[0x0][_0x2059ee(0x202)]==_0x2059ee(0x259)){var _0x309ebf=users[_0x2059ee(0x287)];console[_0x2059ee(0x249)](_0x309ebf);}else{if(_0x108385[0x0][_0x2059ee(0x202)]=='Hindi')var _0x309ebf=users[_0x2059ee(0x2c4)];else{if(_0x108385[0x0][_0x2059ee(0x202)]==_0x2059ee(0x21c))var _0x309ebf=users[_0x2059ee(0x21c)];else{if(_0x108385[0x0][_0x2059ee(0x202)]=='Spanish')var _0x309ebf=users[_0x2059ee(0x1e9)];else{if(_0x108385[0x0]['language']==_0x2059ee(0x265))var _0x309ebf=users['French'];else{if(_0x108385[0x0][_0x2059ee(0x202)]==_0x2059ee(0x218))var _0x309ebf=users[_0x2059ee(0x2d0)];else{if(_0x108385[0x0][_0x2059ee(0x202)]==_0x2059ee(0x1c4))var _0x309ebf=users['Chinese'];else{if(_0x108385[0x0]['language']==_0x2059ee(0x2a5))var _0x309ebf=users[_0x2059ee(0x240)];}}}}}}}_0x34d90d['render'](_0x2059ee(0x215),{'success':_0x5dd576[_0x2059ee(0x1fe)](_0x2059ee(0x1c7)),'errors':_0x5dd576[_0x2059ee(0x1fe)](_0x2059ee(0x284)),'role':_0x1e5e86,'profile':_0x1400aa,'purchases':_0x2f8106,'suppliers':_0x4f1e72,'warehouse':_0x3208d6,'product':_0x1e3f8f,'master_shop':_0x108385,'language':_0x309ebf,'ed_fullDate':_0x30b20a,'dataSelected':_0x204949});}catch(_0x3bcb35){console[_0x2059ee(0x249)](_0x3bcb35);}}),router[a0_0x382e64(0x206)](a0_0x382e64(0x2b8),auth,async(_0x47fac0,_0x2768b6)=>{var _0x27212e=a0_0x382e64;try{const _0x32b7e2=_0x47fac0[_0x27212e(0x1df)]['id'],_0x24bee7=await purchases['findOne']({'_id':_0x47fac0[_0x27212e(0x1df)]['id']}),_0x2a6b5a=await warehouse['findOne']({'name':_0x24bee7[_0x27212e(0x209)],'room':_0x24bee7['room']});_0x24bee7['product'][_0x27212e(0x20e)](_0x47e1fc=>{var _0x3fa43f=_0x27212e;const _0x865646=_0x2a6b5a[_0x3fa43f(0x263)][_0x3fa43f(0x2ba)](_0x209986=>{var _0x2684dc=_0x3fa43f;_0x209986[_0x2684dc(0x23c)]==_0x47e1fc[_0x2684dc(0x23c)]&&_0x209986['floorlevel']==_0x47e1fc[_0x2684dc(0x1fd)]&&_0x209986[_0x2684dc(0x2a6)]==_0x47e1fc[_0x2684dc(0x2a6)]&&_0x209986[_0x2684dc(0x2a4)]==_0x47e1fc[_0x2684dc(0x2a4)]&&_0x209986[_0x2684dc(0x2d7)]==_0x47e1fc[_0x2684dc(0x2d7)]&&_0x209986[_0x2684dc(0x2a2)]==_0x47e1fc[_0x2684dc(0x2a2)]&&_0x209986['storage']==_0x47e1fc[_0x2684dc(0x1e6)]&&(_0x209986[_0x2684dc(0x26c)]=parseInt(_0x209986[_0x2684dc(0x26c)])-parseInt(_0x47e1fc[_0x2684dc(0x214)]));});}),await _0x2a6b5a[_0x27212e(0x260)]();const {invoice:_0x592b32,suppliers:_0x25e169,date:_0x4befed,warehouse_name:_0x3d8b82,prod_name:_0x220dc9,prod_code:_0x110e7f,prod_qty:_0x4386bd,prod_unit:_0xc763cb,prod_secondunit:_0x5d1c54,prod_level:_0x528f25,prod_isle:_0x16e1ee,prod_pallet:_0x476140,note:_0x55ccae,expiry_date:_0x3c2eaa,batch_code:_0x19fd07,paid_amount:_0x3a5d4b,due_amount:_0x5db525,Room_name:_0x3eb86f,primary_code:_0x28fb24,secondary_code:_0x2954f0,PO_number:_0x5c0b2b,JO_number:_0x4cf85b}=_0x47fac0['body'];if(typeof _0x220dc9==_0x27212e(0x1f4))var _0x4dea5a=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1c9)]],_0x14bb2d=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x21e)]],_0x32bfad=[_0x47fac0['body'][_0x27212e(0x23e)]],_0x1090b1=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1dd)]],_0x2f884d=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1dc)]],_0xffcb1a=[_0x47fac0[_0x27212e(0x2d5)]['prod_level']],_0x45fe99=[_0x47fac0['body']['prod_isle']],_0x2019f0=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x20f)]],_0x2a80f4=[_0x47fac0['body'][_0x27212e(0x2d8)]],_0x15b42e=[_0x47fac0[_0x27212e(0x2d5)]['secondary_code']],_0x573d68=[_0x47fac0[_0x27212e(0x2d5)]['MaxStocks_data']],_0x3526b5=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x2ce)]],_0x4fdb00=[_0x47fac0[_0x27212e(0x2d5)]['expiry_date']],_0x3dafb3=[_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1e6)]],_0x5c41ab=[_0x47fac0['body']['rak']],_0x1ae242=[_0x47fac0[_0x27212e(0x2d5)]['type']];else var _0x4dea5a=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1c9)]],_0x14bb2d=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x21e)]],_0x32bfad=[..._0x47fac0[_0x27212e(0x2d5)]['prod_qty']],_0x1090b1=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1dd)]],_0x2f884d=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1dc)]],_0xffcb1a=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1fa)]],_0x45fe99=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x250)]],_0x2019f0=[..._0x47fac0[_0x27212e(0x2d5)]['prod_pallet']],_0x2a80f4=[..._0x47fac0[_0x27212e(0x2d5)]['primary_code']],_0x15b42e=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x203)]],_0x573d68=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x2a9)]],_0x3526b5=[..._0x47fac0[_0x27212e(0x2d5)]['batch_code']],_0x4fdb00=[..._0x47fac0['body'][_0x27212e(0x210)]],_0x3dafb3=[..._0x47fac0['body'][_0x27212e(0x1e6)]],_0x5c41ab=[..._0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x1d5)]],_0x1ae242=[..._0x47fac0['body'][_0x27212e(0x2a6)]];const _0x5907ba=_0x4dea5a[_0x27212e(0x2ba)](_0x41eb8a=>{return _0x41eb8a={'product_name':_0x41eb8a};});_0x14bb2d[_0x27212e(0x20e)]((_0x3a598c,_0x317a3b)=>{var _0x4cb4e3=_0x27212e;_0x5907ba[_0x317a3b][_0x4cb4e3(0x205)]=_0x3a598c;}),_0x32bfad[_0x27212e(0x20e)]((_0xcc3e1b,_0x3dde27)=>{var _0x301ff8=_0x27212e;_0x5907ba[_0x3dde27][_0x301ff8(0x214)]=_0xcc3e1b;}),_0x1090b1[_0x27212e(0x20e)]((_0x260644,_0xc5760)=>{var _0x42dbac=_0x27212e;_0x5907ba[_0xc5760][_0x42dbac(0x1ee)]=_0x260644;}),_0x2f884d[_0x27212e(0x20e)]((_0x581b56,_0x53e66d)=>{var _0x1010b5=_0x27212e;_0x5907ba[_0x53e66d][_0x1010b5(0x26b)]=_0x581b56;}),_0xffcb1a[_0x27212e(0x20e)]((_0x5dade9,_0xb6d476)=>{var _0x2a0417=_0x27212e;_0x5907ba[_0xb6d476][_0x2a0417(0x2d7)]=_0x5dade9;}),_0x45fe99[_0x27212e(0x20e)]((_0x3dc90e,_0x29fbb0)=>{var _0x21741a=_0x27212e;_0x5907ba[_0x29fbb0][_0x21741a(0x2a4)]=_0x3dc90e;}),_0x2019f0[_0x27212e(0x20e)]((_0x2f3be6,_0x398565)=>{var _0x1f1e10=_0x27212e;_0x5907ba[_0x398565][_0x1f1e10(0x1fd)]=_0x2f3be6;}),_0x2a80f4[_0x27212e(0x20e)]((_0x316c05,_0x4df80d)=>{var _0x1fef25=_0x27212e;_0x5907ba[_0x4df80d][_0x1fef25(0x2d8)]=_0x316c05;}),_0x15b42e[_0x27212e(0x20e)]((_0x4387b7,_0x145aa0)=>{var _0x54dc46=_0x27212e;_0x5907ba[_0x145aa0][_0x54dc46(0x203)]=_0x4387b7;}),_0x573d68[_0x27212e(0x20e)]((_0x2e74b2,_0xb99a38)=>{var _0x53deb7=_0x27212e;_0x5907ba[_0xb99a38][_0x53deb7(0x1cb)]=_0x2e74b2;}),_0x3526b5[_0x27212e(0x20e)]((_0x31449c,_0x5cbe4c)=>{var _0x2dbfed=_0x27212e;_0x5907ba[_0x5cbe4c][_0x2dbfed(0x2ce)]=_0x31449c;}),_0x4fdb00[_0x27212e(0x20e)]((_0xaf2788,_0x55dc14)=>{_0x5907ba[_0x55dc14]['expiry_date']=_0xaf2788;}),_0x1ae242[_0x27212e(0x20e)]((_0x2d2687,_0x245f91)=>{var _0x6a3ffb=_0x27212e;_0x5907ba[_0x245f91][_0x6a3ffb(0x2a6)]=_0x2d2687;}),_0x3dafb3[_0x27212e(0x20e)]((_0x2b2834,_0x5ab98c)=>{var _0x556d93=_0x27212e;_0x5907ba[_0x5ab98c][_0x556d93(0x1e6)]=_0x2b2834;}),_0x5c41ab[_0x27212e(0x20e)]((_0x2659cd,_0x34849c)=>{var _0xf217f2=_0x27212e;_0x5907ba[_0x34849c][_0xf217f2(0x2a2)]=_0x2659cd;});const _0x32db8f=_0x5907ba['filter'](_0x5e1787=>_0x5e1787[_0x27212e(0x214)]!=='0'&&_0x5e1787[_0x27212e(0x214)]!=='');_0x24bee7[_0x27212e(0x2b6)]=_0x592b32,_0x24bee7[_0x27212e(0x275)]=_0x25e169,_0x24bee7[_0x27212e(0x245)]=_0x4befed,_0x24bee7[_0x27212e(0x209)]=_0x3d8b82,_0x24bee7[_0x27212e(0x271)]=_0x32db8f,_0x24bee7[_0x27212e(0x1db)]=_0x55ccae,_0x24bee7[_0x27212e(0x234)]=_0x3a5d4b,_0x24bee7[_0x27212e(0x1c2)]=_0x5db525,_0x24bee7['room']=_0x3eb86f,_0x24bee7[_0x27212e(0x248)]=_0x5c0b2b,_0x24bee7['JO_number']=_0x4cf85b;const _0x140a95=await _0x24bee7[_0x27212e(0x260)](),_0x3ff922=await warehouse[_0x27212e(0x1f1)]({'name':_0x47fac0['body'][_0x27212e(0x209)],'room':_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x2d3)]});_0x24bee7[_0x27212e(0x271)][_0x27212e(0x20e)](_0x5123b8=>{var _0x1c796a=_0x27212e,_0x41bc17=0x0;const _0x3fabf1=_0x3ff922[_0x1c796a(0x263)][_0x1c796a(0x2ba)](_0x5216fb=>{var _0x490cc4=_0x1c796a;_0x5216fb[_0x490cc4(0x23c)]==_0x5123b8[_0x490cc4(0x23c)]&&_0x5216fb[_0x490cc4(0x1fd)]==_0x5123b8[_0x490cc4(0x1fd)]&&_0x5216fb[_0x490cc4(0x2a6)]==_0x5123b8[_0x490cc4(0x2a6)]&&_0x5216fb[_0x490cc4(0x2a4)]==_0x5123b8['bin']&&_0x5216fb[_0x490cc4(0x2d7)]==_0x5123b8['bay']&&_0x5216fb['rack']==_0x5123b8[_0x490cc4(0x2a2)]&&_0x5216fb[_0x490cc4(0x1e6)]==_0x5123b8[_0x490cc4(0x1e6)]&&(_0x5216fb[_0x490cc4(0x26c)]=parseInt(_0x5216fb[_0x490cc4(0x26c)])+parseInt(_0x5123b8[_0x490cc4(0x214)]),_0x41bc17++);});_0x41bc17=='0'&&(_0x3ff922['product_details']=_0x3ff922['product_details']['concat']({'product_name':_0x5123b8['product_name'],'product_stock':_0x5123b8[_0x1c796a(0x214)],'primary_code':_0x5123b8['primary_code'],'secondary_code':_0x5123b8[_0x1c796a(0x203)],'product_code':_0x5123b8[_0x1c796a(0x205)],'storage':_0x5123b8[_0x1c796a(0x1e6)],'rack':_0x5123b8[_0x1c796a(0x2a2)],'bay':_0x5123b8['bay'],'bin':_0x5123b8[_0x1c796a(0x2a4)],'type':_0x5123b8[_0x1c796a(0x2a6)],'floorlevel':_0x5123b8[_0x1c796a(0x1fd)],'maxProducts':_0x5123b8[_0x1c796a(0x1cb)],'unit':_0x5123b8[_0x1c796a(0x1ee)],'secondary_unit':_0x5123b8[_0x1c796a(0x26b)],'expiry_date':_0x5123b8[_0x1c796a(0x210)]}));}),await _0x3ff922['save']();const _0x493428=await s_payment_data['findOne']({'invoice':_0x47fac0['body'][_0x27212e(0x2b6)]});if(_0x493428===null){}else console[_0x27212e(0x249)]('suppliers',_0x493428,_0x47fac0['body'][_0x27212e(0x2b6)]),_0x493428['suppliers']=_0x47fac0[_0x27212e(0x2d5)][_0x27212e(0x275)],await _0x493428[_0x27212e(0x260)]();_0x47fac0[_0x27212e(0x1fe)]('success',_0x27212e(0x27c)),_0x2768b6['redirect'](_0x27212e(0x25e));}catch(_0x4b4dc9){console['log'](_0x4b4dc9);}}),router[a0_0x382e64(0x206)](a0_0x382e64(0x225),auth,async(_0x2696a3,_0x4433ad)=>{var _0x2c1a5a=a0_0x382e64;try{const _0x41db91=_0x2696a3[_0x2c1a5a(0x1df)]['id'],{invoice:_0x30a179,suppliers:_0x3ddf13,payable:_0x37ca2a,due_amount:_0x59ad42}=_0x2696a3[_0x2c1a5a(0x2d5)],_0x13b7e3=await purchases[_0x2c1a5a(0x229)](_0x41db91);var _0x1e1c6e=_0x37ca2a-_0x59ad42;_0x13b7e3['paid_amount']=parseFloat(_0x13b7e3['paid_amount'])+parseFloat(_0x59ad42),_0x13b7e3[_0x2c1a5a(0x1c2)]=_0x1e1c6e;const _0x5dc67f=await _0x13b7e3[_0x2c1a5a(0x260)]();console['log'](_0x5dc67f);const _0x5586f6=await s_payment_data[_0x2c1a5a(0x1f1)]({'invoice':_0x30a179});_0x5586f6['amount']=_0x1e1c6e,await _0x5586f6[_0x2c1a5a(0x260)]();let _0x3115fa=new Date(),_0x42fc65=('0'+_0x3115fa[_0x2c1a5a(0x207)]())[_0x2c1a5a(0x2ad)](-0x2),_0x147c07=('0'+(_0x3115fa[_0x2c1a5a(0x1eb)]()+0x1))[_0x2c1a5a(0x2ad)](-0x2),_0x535fd4=_0x3115fa[_0x2c1a5a(0x2ae)](),_0x3ca95a=_0x535fd4+'-'+_0x147c07+'-'+_0x42fc65;const _0x5eb70c=new suppliers_payment({'invoice':_0x30a179,'date':_0x535fd4+'-'+_0x147c07+'-'+_0x42fc65,'suppliers':_0x3ddf13,'reason':'Paid\x20For\x20Purchase','amount':_0x59ad42}),_0x55f4f6=await _0x5eb70c[_0x2c1a5a(0x260)]();_0x2696a3['flash'](_0x2c1a5a(0x1c7),_0x2c1a5a(0x20b)),_0x4433ad[_0x2c1a5a(0x2aa)](_0x2c1a5a(0x25e));}catch(_0x2454f0){console['log'](_0x2454f0);}}),router[a0_0x382e64(0x212)](a0_0x382e64(0x27a),auth,async(_0x4e635c,_0x5a8638)=>{var _0x2cdf00=a0_0x382e64;try{const {username:_0x300808,email:_0x142113,role:_0x41f667}=_0x4e635c[_0x2cdf00(0x201)],_0x227e86=_0x4e635c[_0x2cdf00(0x201)],_0x5d2a92=await profile[_0x2cdf00(0x1f1)]({'email':_0x227e86[_0x2cdf00(0x27d)]}),_0x5a4072=await master_shop[_0x2cdf00(0x272)]();console[_0x2cdf00(0x249)](_0x2cdf00(0x1bf),_0x5a4072);const _0x339144=_0x4e635c[_0x2cdf00(0x1df)]['id'],_0x24aa04=await purchases[_0x2cdf00(0x229)](_0x339144);console[_0x2cdf00(0x249)](_0x24aa04);const _0x388d11=await suppliers['findOne']({'name':_0x24aa04[_0x2cdf00(0x275)]});console[_0x2cdf00(0x249)](_0x388d11);if(_0x5a4072[0x0][_0x2cdf00(0x202)]==_0x2cdf00(0x259)){var _0x3f425b=users[_0x2cdf00(0x287)];console['log'](_0x3f425b);}else{if(_0x5a4072[0x0][_0x2cdf00(0x202)]==_0x2cdf00(0x2c4))var _0x3f425b=users[_0x2cdf00(0x2c4)];else{if(_0x5a4072[0x0][_0x2cdf00(0x202)]=='German')var _0x3f425b=users[_0x2cdf00(0x21c)];else{if(_0x5a4072[0x0][_0x2cdf00(0x202)]==_0x2cdf00(0x1e9))var _0x3f425b=users[_0x2cdf00(0x1e9)];else{if(_0x5a4072[0x0][_0x2cdf00(0x202)]==_0x2cdf00(0x265))var _0x3f425b=users[_0x2cdf00(0x265)];else{if(_0x5a4072[0x0][_0x2cdf00(0x202)]==_0x2cdf00(0x218))var _0x3f425b=users[_0x2cdf00(0x2d0)];else{if(_0x5a4072[0x0][_0x2cdf00(0x202)]==_0x2cdf00(0x1c4))var _0x3f425b=users[_0x2cdf00(0x1c4)];else{if(_0x5a4072[0x0]['language']==_0x2cdf00(0x2a5))var _0x3f425b=users[_0x2cdf00(0x240)];}}}}}}}_0x5a8638[_0x2cdf00(0x1e8)](_0x2cdf00(0x2c3),{'success':_0x4e635c['flash'](_0x2cdf00(0x1c7)),'errors':_0x4e635c[_0x2cdf00(0x1fe)](_0x2cdf00(0x284)),'role':_0x227e86,'profile':_0x5d2a92,'master_shop':_0x5a4072,'supplier':_0x388d11,'purchase':_0x24aa04,'language':_0x3f425b});}catch(_0x11e9c8){console[_0x2cdf00(0x249)](_0x11e9c8);}}),router[a0_0x382e64(0x212)]('/view/return_purchase/:id',auth,async(_0x10c12a,_0x3a11c5)=>{var _0x218831=a0_0x382e64;try{const {username:_0x47a429,email:_0x3c62de,role:_0x154fff}=_0x10c12a['user'],_0x5e2c01=_0x10c12a[_0x218831(0x201)],_0x5f52ef=await profile[_0x218831(0x1f1)]({'email':_0x5e2c01['email']}),_0x5c2edb=await master_shop['find']();console[_0x218831(0x249)](_0x218831(0x1bf),_0x5c2edb);const _0x189e9f=_0x10c12a[_0x218831(0x1df)]['id'];console[_0x218831(0x249)](_0x189e9f);const _0x5f9f36=await purchases['findById'](_0x189e9f);console[_0x218831(0x249)](_0x218831(0x1bc),_0x5f9f36);const _0x3aab86=await product[_0x218831(0x272)]({}),_0x37a80e=await warehouse[_0x218831(0x2ac)]([{'$match':{'name':_0x5f9f36[_0x218831(0x209)],'room':_0x5f9f36[_0x218831(0x1e3)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x218831(0x29c),'name':{'$first':_0x218831(0x1f2)},'product_stock':{'$first':_0x218831(0x241)},'bay':{'$first':_0x218831(0x2bd)},'bin':{'$first':_0x218831(0x256)},'type':{'$first':_0x218831(0x255)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x218831(0x268)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x218831(0x2a7)},'rack':{'$first':_0x218831(0x266)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x218831(0x26d),'name':_0x218831(0x2cb),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x218831(0x1e5),'name':{'$first':_0x218831(0x1e5)}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0x37a80e);if(_0x5c2edb[0x0]['language']==_0x218831(0x259)){var _0x40af42=users[_0x218831(0x287)];console[_0x218831(0x249)](_0x40af42);}else{if(_0x5c2edb[0x0][_0x218831(0x202)]=='Hindi')var _0x40af42=users[_0x218831(0x2c4)];else{if(_0x5c2edb[0x0]['language']==_0x218831(0x21c))var _0x40af42=users[_0x218831(0x21c)];else{if(_0x5c2edb[0x0][_0x218831(0x202)]==_0x218831(0x1e9))var _0x40af42=users[_0x218831(0x1e9)];else{if(_0x5c2edb[0x0][_0x218831(0x202)]==_0x218831(0x265))var _0x40af42=users[_0x218831(0x265)];else{if(_0x5c2edb[0x0]['language']==_0x218831(0x218))var _0x40af42=users[_0x218831(0x2d0)];else{if(_0x5c2edb[0x0]['language']=='Chinese')var _0x40af42=users['Chinese'];else{if(_0x5c2edb[0x0]['language']=='Arabic\x20(ae)')var _0x40af42=users[_0x218831(0x240)];}}}}}}}_0x3a11c5['render'](_0x218831(0x224),{'success':_0x10c12a[_0x218831(0x1fe)](_0x218831(0x1c7)),'errors':_0x10c12a['flash'](_0x218831(0x284)),'role':_0x5e2c01,'profile':_0x5f52ef,'user':_0x5f9f36,'stock':_0x37a80e,'master_shop':_0x5c2edb,'product':_0x3aab86,'language':_0x40af42,'warehouse':warehouse_data});}catch(_0x4b942b){console[_0x218831(0x249)](_0x4b942b);}}),router[a0_0x382e64(0x206)]('/view/return_purchase/:id',auth,async(_0x5e7c0e,_0x2567d0)=>{var _0x36fc8e=a0_0x382e64;try{const {invoice:_0x2fd8da,date:_0x53a55c,warehouse_name:_0x225958,Room_name:_0x587009,product_name:_0x2823ed,purchase_quantity:_0x42d810,stocks:_0x266e94,return_qty:_0x726aae,note:_0x39b303,level:_0x514174,isle:_0x45882f,pallet:_0x5aea9f,to_warehouse_name:_0x41720a,to_Room_name:_0x34e659}=_0x5e7c0e[_0x36fc8e(0x2d5)],_0x34ddc5=await purchases[_0x36fc8e(0x1f1)]({'_id':_0x5e7c0e[_0x36fc8e(0x1df)]['id']}),_0x30fa6a=await warehouse[_0x36fc8e(0x1f1)]({'name':_0x225958,'room':_0x587009});if(typeof _0x2823ed==_0x36fc8e(0x1f4))var _0x5ec85d=[_0x5e7c0e['body'][_0x36fc8e(0x23c)]],_0x18f044=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x2c8)]],_0x3fb569=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x1d2)]],_0x28a2ad=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x1cf)]],_0x5f3222=[_0x5e7c0e['body']['level']],_0x1689aa=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x293)]],_0x3c8275=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x2cf)]],_0x592892=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x20a)]],_0x41253b=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x28d)]],_0x4658fe=[_0x5e7c0e[_0x36fc8e(0x2d5)]['primary_code_hide']],_0x3c4ff2=[_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x285)]];else var _0x5ec85d=[..._0x5e7c0e['body']['product_name']],_0x18f044=[..._0x5e7c0e['body'][_0x36fc8e(0x2c8)]],_0x3fb569=[..._0x5e7c0e[_0x36fc8e(0x2d5)]['stocks']],_0x28a2ad=[..._0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x1cf)]],_0x5f3222=[..._0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x2c6)]],_0x1689aa=[..._0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x293)]],_0x3c8275=[..._0x5e7c0e[_0x36fc8e(0x2d5)]['pallet']],_0x592892=[..._0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x20a)]],_0x41253b=[..._0x5e7c0e[_0x36fc8e(0x2d5)]['product_code_hide']],_0x4658fe=[..._0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x216)]],_0x3c4ff2=[..._0x5e7c0e['body'][_0x36fc8e(0x285)]];const _0x473248=_0x5ec85d[_0x36fc8e(0x2ba)](_0x1b924f=>{return _0x1b924f={'product_name':_0x1b924f};});_0x18f044[_0x36fc8e(0x20e)]((_0x14039c,_0x497d76)=>{var _0x531c45=_0x36fc8e;_0x473248[_0x497d76][_0x531c45(0x2c8)]=_0x14039c;}),_0x3fb569[_0x36fc8e(0x20e)]((_0x17b890,_0x1d5db4)=>{var _0x16aaf5=_0x36fc8e;_0x473248[_0x1d5db4][_0x16aaf5(0x290)]=_0x17b890;}),_0x28a2ad[_0x36fc8e(0x20e)]((_0x4b513e,_0x156591)=>{var _0x190504=_0x36fc8e;_0x473248[_0x156591][_0x190504(0x1cf)]=_0x4b513e;}),_0x5f3222['forEach']((_0x2f55a8,_0x20610c)=>{_0x473248[_0x20610c]['bay']=_0x2f55a8;}),_0x1689aa[_0x36fc8e(0x20e)]((_0x37f5ed,_0x1cdc5a)=>{var _0x910b72=_0x36fc8e;_0x473248[_0x1cdc5a][_0x910b72(0x2a4)]=_0x37f5ed;}),_0x3c8275[_0x36fc8e(0x20e)]((_0x2898ba,_0x138515)=>{var _0x120558=_0x36fc8e;_0x473248[_0x138515][_0x120558(0x1fd)]=_0x2898ba;}),_0x592892['forEach']((_0x3dd959,_0x18822e)=>{var _0xc3b0b1=_0x36fc8e;_0x473248[_0x18822e][_0xc3b0b1(0x2a6)]=_0x3dd959;}),_0x41253b[_0x36fc8e(0x20e)]((_0x3db5c2,_0x3c2602)=>{var _0x8eac12=_0x36fc8e;_0x473248[_0x3c2602][_0x8eac12(0x205)]=_0x3db5c2;}),_0x4658fe[_0x36fc8e(0x20e)]((_0x42be17,_0xb210ae)=>{_0x473248[_0xb210ae]['primary_code']=_0x42be17;}),_0x3c4ff2[_0x36fc8e(0x20e)]((_0x395d0a,_0x9a4683)=>{var _0x2252bf=_0x36fc8e;_0x473248[_0x9a4683][_0x2252bf(0x203)]=_0x395d0a;}),_0x34ddc5['product'][_0x36fc8e(0x20e)](_0x440d33=>{var _0x1135f4=_0x36fc8e;const _0x23a47f=_0x30fa6a[_0x1135f4(0x263)]['map'](_0x450959=>{var _0x386b59=_0x1135f4;_0x450959[_0x386b59(0x23c)]==_0x440d33[_0x386b59(0x23c)]&&_0x450959[_0x386b59(0x1fd)]==_0x440d33[_0x386b59(0x1fd)]&&_0x450959[_0x386b59(0x2a6)]==_0x440d33[_0x386b59(0x2a6)]&&_0x450959[_0x386b59(0x2a4)]==_0x440d33[_0x386b59(0x2a4)]&&_0x450959[_0x386b59(0x2d7)]==_0x440d33[_0x386b59(0x2d7)]&&_0x450959[_0x386b59(0x2a2)]==_0x440d33['rack']&&_0x450959[_0x386b59(0x1e6)]==_0x440d33[_0x386b59(0x1e6)]&&(console['log'](parseInt(_0x450959[_0x386b59(0x26c)])+_0x386b59(0x28c)+parseInt(_0x440d33['quantity'])),_0x450959[_0x386b59(0x26c)]=parseInt(_0x450959[_0x386b59(0x26c)])+parseInt(_0x440d33[_0x386b59(0x214)]));});}),await _0x30fa6a[_0x36fc8e(0x260)]();const _0x37ecf3=_0x473248['filter'](_0x33ca08=>_0x33ca08[_0x36fc8e(0x1cf)]!=='0'&&_0x33ca08[_0x36fc8e(0x1cf)]!=='');var _0x492a44=0x0;_0x37ecf3[_0x36fc8e(0x20e)](_0x56d6ef=>{var _0x10a5a5=_0x36fc8e;console[_0x10a5a5(0x249)](_0x10a5a5(0x1c5),_0x56d6ef),(parseInt(_0x56d6ef['purchase_quantity'])<parseInt(_0x56d6ef[_0x10a5a5(0x1cf)])||parseInt(_0x56d6ef['stock_quantity'])<parseInt(_0x56d6ef[_0x10a5a5(0x1cf)]))&&_0x492a44++;});if(_0x492a44!=0x0)return _0x5e7c0e[_0x36fc8e(0x1fe)](_0x36fc8e(0x284),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x2567d0[_0x36fc8e(0x2aa)](_0x36fc8e(0x1f3));const _0x4bafe6=new purchases_return({'invoice':_0x2fd8da,'suppliers':_0x5e7c0e[_0x36fc8e(0x2d5)][_0x36fc8e(0x275)],'date':_0x53a55c,'warehouse_name':_0x225958,'return_product':_0x37ecf3,'note':_0x39b303,'room':_0x587009,'to_warehouse_name':_0x41720a,'to_room':_0x34e659}),_0x565de5=await _0x4bafe6[_0x36fc8e(0x260)]();console[_0x36fc8e(0x249)](_0x4bafe6);const _0x258c85=await purchases_return[_0x36fc8e(0x1f1)]({'invoice':_0x2fd8da}),_0x524d27=await warehouse['findOne']({'name':_0x41720a,'room':_0x34e659});_0x258c85[_0x36fc8e(0x2bc)][_0x36fc8e(0x20e)](_0x38f0c0=>{var _0x5b49d5=_0x36fc8e,_0x4b35b3=0x0;const _0x30c1c3=_0x524d27[_0x5b49d5(0x263)]['map'](_0x2a1102=>{var _0x41596c=_0x5b49d5;_0x2a1102[_0x41596c(0x23c)]==_0x38f0c0['product_name']&&_0x2a1102[_0x41596c(0x1fd)]==_0x38f0c0[_0x41596c(0x1fd)]&&_0x2a1102[_0x41596c(0x2a6)]==_0x38f0c0[_0x41596c(0x2a6)]&&_0x2a1102[_0x41596c(0x2a4)]==_0x38f0c0[_0x41596c(0x2a4)]&&_0x2a1102[_0x41596c(0x2d7)]==_0x38f0c0[_0x41596c(0x2d7)]&&(_0x2a1102[_0x41596c(0x26c)]=parseInt(_0x2a1102[_0x41596c(0x26c)])-parseInt(_0x38f0c0[_0x41596c(0x1cf)]),_0x4b35b3++);});_0x4b35b3=='0'&&(_0x524d27[_0x5b49d5(0x263)]=_0x524d27[_0x5b49d5(0x263)][_0x5b49d5(0x2b0)]({'product_name':_0x38f0c0[_0x5b49d5(0x23c)],'product_stock':_0x38f0c0[_0x5b49d5(0x1cf)],'primary_code':_0x38f0c0['primary_code'],'secondary_code':_0x38f0c0[_0x5b49d5(0x203)],'product_code':_0x38f0c0['product_code'],'storage':_0x38f0c0[_0x5b49d5(0x1e6)],'rack':_0x38f0c0[_0x5b49d5(0x2a2)],'bay':_0x38f0c0[_0x5b49d5(0x2d7)],'bin':_0x38f0c0[_0x5b49d5(0x2a4)],'type':_0x38f0c0[_0x5b49d5(0x2a6)],'floorlevel':_0x38f0c0[_0x5b49d5(0x1fd)],'maxProducts':_0x38f0c0[_0x5b49d5(0x1cb)],'unit':_0x38f0c0[_0x5b49d5(0x1ee)],'secondary_unit':_0x38f0c0[_0x5b49d5(0x26b)],'expiry_date':_0x38f0c0['expiry_date']}));}),await _0x524d27[_0x36fc8e(0x260)]();const _0x417890=await purchases[_0x36fc8e(0x1f1)]({'invoice':_0x2fd8da});_0x417890[_0x36fc8e(0x291)]=_0x36fc8e(0x1f0);const _0x4eb0b9=await _0x417890[_0x36fc8e(0x260)](),_0x2dab48=new s_payment_data({'invoice':_0x2fd8da,'suppliers':_0x5e7c0e['body'][_0x36fc8e(0x275)],'reason':_0x36fc8e(0x1bb)});await _0x2dab48[_0x36fc8e(0x260)]();const _0x45f490=await master_shop[_0x36fc8e(0x272)]();console['log'](_0x36fc8e(0x24c),_0x45f490[0x0][_0x36fc8e(0x26e)]);const _0x4ec0c2=await email_settings[_0x36fc8e(0x1f1)](),_0x43fa51=await suppliers[_0x36fc8e(0x1f1)]({'name':_0x5e7c0e[_0x36fc8e(0x2d5)]['suppliers']});console[_0x36fc8e(0x249)](_0x36fc8e(0x1d1),_0x43fa51);_0x45f490[0x0][_0x36fc8e(0x26a)]==0x1?(right_currency=_0x45f490[0x0][_0x36fc8e(0x29f)],left_currency=''):(right_currency='',left_currency=_0x45f490[0x0][_0x36fc8e(0x29f)]);var _0x2631de=_0x5ec85d,_0x3b9d83=_0x28a2ad,_0xdfc766='',_0x914fff;for(_0x914fff in _0x2631de){_0xdfc766+=_0x36fc8e(0x2d1)+_0x36fc8e(0x27f)+_0x2631de[_0x914fff]+_0x36fc8e(0x2bf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b9d83[_0x914fff]+_0x36fc8e(0x2bf)+_0x36fc8e(0x2bb);}console[_0x36fc8e(0x249)]('product_list',_0xdfc766);let _0x3c33e7=nodemailer[_0x36fc8e(0x1ef)]({'service':'gmail','auth':{'user':_0x4ec0c2[_0x36fc8e(0x27d)],'pass':_0x4ec0c2['password']}}),_0xde343a={'from':_0x4ec0c2[_0x36fc8e(0x27d)],'to':_0x43fa51[_0x36fc8e(0x27d)],'subject':_0x36fc8e(0x292),'attachments':[{'filename':_0x36fc8e(0x2b1),'path':__dirname+'/../public'+_0x36fc8e(0x253)+_0x45f490[0x0]['image'],'cid':_0x36fc8e(0x1c3)}],'html':_0x36fc8e(0x25f)+_0x36fc8e(0x280)+_0x36fc8e(0x1ea)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x36fc8e(0x24e)+_0x36fc8e(0x2c9)+_0x36fc8e(0x278)+_0x36fc8e(0x24e)+_0x36fc8e(0x1ce)+_0x45f490[0x0][_0x36fc8e(0x282)]+_0x36fc8e(0x29a)+_0x36fc8e(0x278)+_0x36fc8e(0x278)+_0x36fc8e(0x281)+_0x36fc8e(0x24e)+_0x36fc8e(0x1f8)+_0x36fc8e(0x2b2)+_0x2fd8da+'\x20'+_0x36fc8e(0x1f5)+'\x20Order\x20Date\x20:\x20'+_0x53a55c+'\x20'+_0x36fc8e(0x289)+_0x36fc8e(0x20c)+_0x36fc8e(0x278)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x36fc8e(0x28b)+_0x36fc8e(0x2d1)+_0x36fc8e(0x2b5)+_0x36fc8e(0x1f9)+_0x36fc8e(0x2d4)+_0x36fc8e(0x274)+_0x36fc8e(0x2bb)+'</thead>'+_0x36fc8e(0x22c)+'\x20'+_0xdfc766+'\x20'+_0x36fc8e(0x267)+_0x36fc8e(0x2cc)+_0x36fc8e(0x24e)+_0x36fc8e(0x27e)+'<h5>'+_0x45f490[0x0]['site_title']+_0x36fc8e(0x20c)+_0x36fc8e(0x278)+_0x36fc8e(0x278)+_0x36fc8e(0x2a1)};_0x3c33e7[_0x36fc8e(0x286)](_0xde343a,function(_0x3b5737,_0x52ee54){var _0x521921=_0x36fc8e;_0x3b5737?(console[_0x521921(0x249)](_0x3b5737),console[_0x521921(0x249)](_0x521921(0x1be))):console[_0x521921(0x249)](_0x521921(0x221));}),_0x5e7c0e[_0x36fc8e(0x1fe)](_0x36fc8e(0x1c7),_0x36fc8e(0x2b7)),_0x2567d0['redirect'](_0x36fc8e(0x25e));}catch(_0x31a6b4){console[_0x36fc8e(0x249)](_0x31a6b4),_0x2567d0['status'](0xc8)[_0x36fc8e(0x25b)]({'message':_0x31a6b4[_0x36fc8e(0x294)]});}}),router['get'](a0_0x382e64(0x2ab),auth,async(_0x6109bc,_0x34ecfb)=>{var _0x129f4e=a0_0x382e64;try{const {username:_0x110f5d,email:_0x54cdf8,role:_0x8b9956}=_0x6109bc[_0x129f4e(0x201)],_0x2cc505=_0x6109bc['user'],_0x3d4a8b=await profile['findOne']({'email':_0x2cc505[_0x129f4e(0x27d)]}),_0x1ace0e=await master_shop[_0x129f4e(0x272)](),_0x42e9ed=_0x6109bc['params']['id'],_0x5f438d=await purchases[_0x129f4e(0x229)](_0x42e9ed);if(_0x1ace0e[0x0]['language']=='English\x20(US)')var _0x14f9d2=users[_0x129f4e(0x287)];else{if(_0x1ace0e[0x0][_0x129f4e(0x202)]==_0x129f4e(0x2c4))var _0x14f9d2=users[_0x129f4e(0x2c4)];else{if(_0x1ace0e[0x0][_0x129f4e(0x202)]==_0x129f4e(0x21c))var _0x14f9d2=users['German'];else{if(_0x1ace0e[0x0][_0x129f4e(0x202)]==_0x129f4e(0x1e9))var _0x14f9d2=users[_0x129f4e(0x1e9)];else{if(_0x1ace0e[0x0]['language']==_0x129f4e(0x265))var _0x14f9d2=users['French'];else{if(_0x1ace0e[0x0][_0x129f4e(0x202)]==_0x129f4e(0x218))var _0x14f9d2=users['Portuguese'];else{if(_0x1ace0e[0x0][_0x129f4e(0x202)]==_0x129f4e(0x1c4))var _0x14f9d2=users['Chinese'];else{if(_0x1ace0e[0x0][_0x129f4e(0x202)]==_0x129f4e(0x2a5))var _0x14f9d2=users[_0x129f4e(0x240)];}}}}}}}_0x34ecfb[_0x129f4e(0x1e8)]('all_purchases_barcode',{'success':_0x6109bc[_0x129f4e(0x1fe)](_0x129f4e(0x1c7)),'errors':_0x6109bc[_0x129f4e(0x1fe)](_0x129f4e(0x284)),'role':_0x2cc505,'profile':_0x3d4a8b,'alldata':_0x5f438d,'master_shop':_0x1ace0e,'language':_0x14f9d2}),console[_0x129f4e(0x249)](alldata);}catch(_0x34c165){console[_0x129f4e(0x249)](_0x34c165);}}),router[a0_0x382e64(0x206)](a0_0x382e64(0x2a0),async(_0x58cac1,_0x157303)=>{var _0x326f81=a0_0x382e64;const {product_code:_0x7ef8eb}=_0x58cac1['body'];var _0x224ea6;const _0x32c82f=await product[_0x326f81(0x2ac)]([{'$match':{'primary_code':_0x7ef8eb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x326f81(0x2a8),'name':{'$first':_0x326f81(0x1e5)},'category':{'$first':_0x326f81(0x24f)},'brand':{'$first':_0x326f81(0x24b)},'unit':{'$first':_0x326f81(0x279)},'alertquantity':{'$first':_0x326f81(0x2c5)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x326f81(0x2b9)},'secondary_code':{'$first':_0x326f81(0x236)},'maxStocks':{'$first':_0x326f81(0x1d3)},'maxProdPerUnit':{'$first':_0x326f81(0x252)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x326f81(0x1e0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3588b7=await product[_0x326f81(0x2ac)]([{'$match':{'secondary_code':_0x7ef8eb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x326f81(0x1e5)},'category':{'$first':_0x326f81(0x24f)},'brand':{'$first':'$brand'},'unit':{'$first':_0x326f81(0x279)},'alertquantity':{'$first':_0x326f81(0x2c5)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x326f81(0x2b9)},'secondary_code':{'$first':_0x326f81(0x236)},'maxStocks':{'$first':_0x326f81(0x1d3)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x326f81(0x1e0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x32c82f[_0x326f81(0x257)]>0x0)_0x224ea6=_0x32c82f;else _0x3588b7[_0x326f81(0x257)]>0x0&&(_0x224ea6=_0x3588b7);_0x157303[_0x326f81(0x25b)](_0x224ea6);}),router[a0_0x382e64(0x206)]('/CheckingWarehouse',async(_0x57c165,_0x50c645)=>{var _0xe39061=a0_0x382e64;const {primaryCode:_0x41c32b,secondaryCode:_0x222a45,productCode:_0x2a752c,bay:_0x28e176,bin:_0x2d1e98,types:_0x16cf58,pallet:_0x46fb62,warehouses:_0x40a2e6,room:_0x34d17f}=_0x57c165['body'];console[_0xe39061(0x249)](_0x57c165[_0xe39061(0x2d5)]);try{const _0x1474ad=await warehouse['aggregate']([{'$match':{'name':_0x40a2e6,'room':_0x34d17f}},{'$unwind':_0xe39061(0x1d8)},{'$match':{'product_details.bay':_0x28e176,'product_details.bin':_0x2d1e98,'product_details.type':_0x16cf58}},{'$group':{'_id':_0xe39061(0x29c),'name':{'$first':_0xe39061(0x1f2)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0xe39061(0x2c1)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xe39061(0x2d6)},'maxProducts':{'$first':_0xe39061(0x227)}}}]);_0x50c645[_0xe39061(0x208)](0xc8)[_0xe39061(0x25b)](_0x1474ad);}catch(_0x50bde9){_0x50c645[_0xe39061(0x208)](0x194)[_0xe39061(0x25b)]({'message':_0x50bde9[_0xe39061(0x294)]});}}),module[a0_0x382e64(0x219)]=router;