var a0_0x13a685=a0_0x4954;(function(_0x516422,_0x577d7c){var _0x16a80e=a0_0x4954,_0x35226b=_0x516422();while(!![]){try{var _0x5d9cae=-parseInt(_0x16a80e(0xe4))/0x1+parseInt(_0x16a80e(0x13c))/0x2*(parseInt(_0x16a80e(0x1b0))/0x3)+parseInt(_0x16a80e(0x12b))/0x4+parseInt(_0x16a80e(0x1b8))/0x5*(-parseInt(_0x16a80e(0x142))/0x6)+parseInt(_0x16a80e(0x12f))/0x7+parseInt(_0x16a80e(0x111))/0x8+parseInt(_0x16a80e(0x115))/0x9*(parseInt(_0x16a80e(0x107))/0xa);if(_0x5d9cae===_0x577d7c)break;else _0x35226b['push'](_0x35226b['shift']());}catch(_0x1ab1e5){_0x35226b['push'](_0x35226b['shift']());}}}(a0_0x5eca,0xe15be));function a0_0x5eca(){var _0x1061b8=['610kwTyBm','stocks','all_purchases_barcode','map','$name','email','role','$warehouse_name','Email\x20sent\x20successfully','/view/add_purchases/:id','6292544EsrXmC','prod_isle','delivery_code','An\x20error\x20occurred\x20while\x20saving\x20data.','7425WFZvof','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_stock','$maxStocks','$expiry_date','English\x20(US)','Portuguese\x20(BR)','<tbody\x20style=\x22text-align:\x20center;\x22>','due_amount','type','bin','getMonth','</head><body>','Purchase\x20data\x20added\x20successfully','/all_purchases/view/','RMSEmail','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','date','flash','prod_cat','stock_quantity','1595532JBrWDI','room_name','staff','$product.floorlevel','11194841PRhpds','<h2>\x20','MaxStocks_data','concat','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','/../public','Logo.png','$product_details.level','$paid_amount','message','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.product_stock','4iVkGFC','site_title','There\x27s\x20a\x20error\x20in\x20this\x20transaction','add_purchases','language','batch_code','2443542tGnuPE','$product_code','$product_details.pallet','Paid\x20For\x20Purchase','name','Rack\x20A','</tr>','rack','$product_details._id','<!DOCTYPE\x20html>','errors','/view','$room','<h5\x20style=\x22text-align:\x20left;\x22>','redirect','status','Hindi','abs','error','German','$product_details.type','aggregate','save','$product.type','floorlevel','warehouse_name','master','$return_data','<h5>','prod_secondunit','True','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.bin','prod_level','product_code','$product.bin','Rack\x20F','\x20Order\x20Date\x20:\x20','prod_qty','findById','getDate','$product_details.product_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_cat','image','suppliers','standard_unit','product_name','secondary_unit','$primary_code','types','$maxProdPerUnit','Arabic','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</tbody>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','isle','logo','$product.room_name','suppliers_docs','back','return_product','Chinese','Purchase\x20Return\x20Mail','toString','POnumber','all_purchases','/upload/','</div>','$product_details.bay','$product.bay','purchase_quantity','prod_pallet','finalize','host','../public/language/languages.json','sendMail','<div>','/all_purchases/view','<hr\x20class=\x22my-3\x22>','payment\x20successfull','\x20<\x20wew\x20>\x20','$product_details.primary_code','prod_code','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','params','/view/return_purchase/:id','</table>','Error\x20Occurs','$secondary_code','$unit','</h5>','production_date','find','/CheckingWarehouse','Purchase\x20Return','string','foreach\x20newproduct','RoomAssign','$product_details.storage','product_details','Portuguese','primary_code_hide','Shelves','$product_details.maxProducts','note','/view/:id','table\x20page','732372hXElXg','Floor','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','secondary_code','Raw\x20Materials','post','$brand','20bXGjBi','/invoice/:id','Ambient','Rack\x20D','warehouse','path','secondary_code_hide','currency','\x20<>\x20','bay','prod_unit','gmail','$batch_code','<html><head><title></title>','user_id','add_purchases\x20error','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$secondary_unit','/view/add_purchases','actual_uom','actual_qty','prod_name','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details','forEach','get','DRY\x20STORAGE','</thead>','log','Return\x20Goods','findOne','$product_details.product_code','invoice','length','return_qty','</td>','$category','maxStocks','express','Arabic\x20(ae)','edit_purchases','maxperunit','filter','Spanish','Enabled','</body></html>','An\x20error\x20occurred.','rak','render','$product','$product_details.floorlevel','$suppliers_docs','Level','paid_amount','expiry_date','$invoice','then','ejs','French','catch','max_product_unit','body','purchase_invoice','/preview/:id','<tr>','771189MpfSVi','success','../middleware/auth','password','$_id','English','\x20Order\x20Number\x20:\x20','push','currency_placement','prod_invoice','INC-','Rack\x20B','slice','Receiving\x20Area','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','user','json','$product_details.isle','storage','all','return_purchase','<strong>\x20Regards\x20</strong>','$product.quantity','level','$suppliers','$alertquantity','delivery_date','alertQTY','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_primunit','<span\x20style=\x22float:\x20right;\x22>','quantity','room','floor'];a0_0x5eca=function(){return _0x1061b8;};return a0_0x5eca();}const express=require(a0_0x13a685(0xc9)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x13a685(0xe6)),nodemailer=require('nodemailer');function a0_0x4954(_0x7d7a89,_0x54ba8c){var _0x5eca16=a0_0x5eca();return a0_0x4954=function(_0x49544b,_0x1641af){_0x49544b=_0x49544b-0xb9;var _0x446406=_0x5eca16[_0x49544b];return _0x446406;},a0_0x4954(_0x7d7a89,_0x54ba8c);}var ejs=require(a0_0x13a685(0xdc));const path=require(a0_0x13a685(0x1bd)),users=require(a0_0x13a685(0x18e));router[a0_0x13a685(0xbc)](a0_0x13a685(0x14d),auth,async(_0x55c230,_0x228f0d)=>{var _0x24d606=a0_0x13a685;try{const {username:_0xe05c26,email:_0xab821c,role:_0x1a9683}=_0x55c230[_0x24d606(0xf3)],_0x587571=_0x55c230[_0x24d606(0xf3)],_0x8431f6=await profile[_0x24d606(0xc1)]({'email':_0x587571[_0x24d606(0x10c)]}),_0x3d1aa2=await staff[_0x24d606(0xc1)]({'email':_0x587571[_0x24d606(0x10c)]});if(_0x587571[_0x24d606(0x10d)]==_0x24d606(0x12d)){const _0x496cbc=await staff[_0x24d606(0xc1)]({'email':_0x587571[_0x24d606(0x10c)]});}const _0x56d35b=await master_shop[_0x24d606(0x1a1)]();let _0x3966b9;if(_0x587571[_0x24d606(0x10d)]=='staff'){const _0x560f2f=await staff['findOne']({'email':_0x587571[_0x24d606(0x10c)]});_0x3966b9=await purchases[_0x24d606(0x157)]([{'$match':{'warehouse_name':_0x560f2f[_0x24d606(0x1bc)]}},{'$lookup':{'from':_0x24d606(0x170),'localField':_0x24d606(0x170),'foreignField':_0x24d606(0x146),'as':_0x24d606(0x17e)}},{'$unwind':_0x24d606(0xd6)},{'$unwind':_0x24d606(0xd4)},{'$group':{'_id':'$_id','invoice':{'$first':_0x24d606(0xda)},'suppliers':{'$first':_0x24d606(0xfc)},'date':{'$first':_0x24d606(0x1cf)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x24d606(0x14e)},'product':{'$push':_0x24d606(0xd4)},'note':{'$first':_0x24d606(0x1b2)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x24d606(0x15d)},'batch_code':{'$first':_0x24d606(0x1c4)},'expiry_date':{'$first':_0x24d606(0x119)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x24d606(0xfa)},'level':{'$addToSet':_0x24d606(0x189)},'isle':{'$addToSet':_0x24d606(0x166)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x24d606(0x12e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3966b9=await purchases['aggregate']([{'$lookup':{'from':_0x24d606(0x170),'localField':'suppliers','foreignField':_0x24d606(0x146),'as':'suppliers_docs'}},{'$unwind':_0x24d606(0xd6)},{'$unwind':_0x24d606(0xd4)},{'$group':{'_id':_0x24d606(0xe8),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x24d606(0xfc)},'date':{'$first':_0x24d606(0x1cf)},'warehouse_name':{'$first':_0x24d606(0x10e)},'room':{'$addToSet':_0x24d606(0x17d)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x24d606(0x137)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x24d606(0x15d)},'batch_code':{'$first':_0x24d606(0x1c4)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x24d606(0xd6)},'total_product_quantity':{'$sum':_0x24d606(0xfa)},'level':{'$addToSet':_0x24d606(0x189)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x24d606(0x159)},'floorlevel':{'$addToSet':_0x24d606(0x12e)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x56d35b[0x0]['language']==_0x24d606(0x11a)){var _0xce6432=users[_0x24d606(0xe9)];console[_0x24d606(0xbf)](_0xce6432);}else{if(_0x56d35b[0x0][_0x24d606(0x140)]=='Hindi')var _0xce6432=users[_0x24d606(0x152)];else{if(_0x56d35b[0x0][_0x24d606(0x140)]==_0x24d606(0x155))var _0xce6432=users[_0x24d606(0x155)];else{if(_0x56d35b[0x0][_0x24d606(0x140)]==_0x24d606(0xce))var _0xce6432=users['Spanish'];else{if(_0x56d35b[0x0][_0x24d606(0x140)]=='French')var _0xce6432=users[_0x24d606(0xdd)];else{if(_0x56d35b[0x0][_0x24d606(0x140)]=='Portuguese\x20(BR)')var _0xce6432=users['Portuguese'];else{if(_0x56d35b[0x0][_0x24d606(0x140)]==_0x24d606(0x181))var _0xce6432=users[_0x24d606(0x181)];else{if(_0x56d35b[0x0][_0x24d606(0x140)]==_0x24d606(0xca))var _0xce6432=users['Arabic'];}}}}}}}_0x228f0d['render'](_0x24d606(0x185),{'success':_0x55c230['flash'](_0x24d606(0xe5)),'errors':_0x55c230[_0x24d606(0x128)](_0x24d606(0x14c)),'purchases':_0x3966b9,'role':_0x587571,'profile':_0x8431f6,'master_shop':_0x56d35b,'language':_0xce6432});}catch(_0x1a1586){console[_0x24d606(0xbf)](_0x24d606(0x1af),_0x1a1586),_0x228f0d[_0x24d606(0x151)](0xc8)[_0x24d606(0xf4)]({'message':_0x1a1586['message']});}});function BayBinSelected(_0x351c5b,_0x126cf3){var _0x3c5280=a0_0x13a685,_0x40d6f6=[],_0xb00b82=[],_0x2c0ba1=[],_0x4219a0=[],_0x3764e0=[],_0x434ac4=[];let _0x2c745e=[];if(_0x351c5b==_0x3c5280(0xbd))switch(_0x126cf3){case _0x3c5280(0x147):_0x40d6f6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xb00b82=[0x1,0x2],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=[_0x3c5280(0xd7),_0x3c5280(0x1b1)],_0x3764e0=['D'],_0x434ac4=['A'];break;case _0x3c5280(0xef):_0x40d6f6=[0x6,0x5,0x4,0x3,0x2,0x1],_0xb00b82=[0x1,0x2],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=['Level',_0x3c5280(0x1b1)],_0x3764e0=['D'],_0x434ac4=['B'];break;case'Shelves':_0x40d6f6=[0x0],_0xb00b82=[0x0],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=['Floor'],_0x3764e0=['D'],_0x434ac4=['S'];break;case _0x3c5280(0xf1):_0x40d6f6=[0x0],_0xb00b82=[0x0],_0x4219a0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2c0ba1=[_0x3c5280(0x1b1)],_0x3764e0=['D'],_0x434ac4=['R'];break;}else{if(_0x351c5b=='COLD\x20STORAGE')switch(_0x126cf3){case'Rack\x20A':_0x40d6f6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xb00b82=['B','F'],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=[_0x3c5280(0xd7),_0x3c5280(0x1b1)],_0x3764e0=['C'],_0x434ac4=['A'];break;case'Rack\x20B':_0x40d6f6=[0x5,0x4,0x3,0x2,0x1],_0xb00b82=['F','B','S'],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=[_0x3c5280(0xd7),_0x3c5280(0x1b1)],_0x3764e0=['C'],_0x434ac4=['B'];break;case'Rack\x20C':_0x40d6f6=[0x1,0x2,0x3,0x4,0x5],_0xb00b82=['B','F','S'],_0x4219a0=[0x5,0x4,0x3,0x2,0x1],_0x2c0ba1=[_0x3c5280(0xd7),_0x3c5280(0x1b1)],_0x3764e0=['C'],_0x434ac4=['C'];break;case _0x3c5280(0x1bb):_0x40d6f6=[0x5,0x4,0x3,0x2,0x1],_0xb00b82=['F','B','S'],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=['Level','Floor'],_0x3764e0=['C'],_0x434ac4=['D'];break;case'Rack\x20E':_0x40d6f6=[0x4,0x3,0x2,0x1],_0xb00b82=[0x1,0x2],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=[_0x3c5280(0xd7),'Floor'],_0x3764e0=['C'],_0x434ac4=['E'];break;case _0x3c5280(0x167):_0x40d6f6=[0x1,0x2,0x3],_0xb00b82=[0x1,0x2],_0x4219a0=[0x1,0x2,0x3,0x4,0x5],_0x2c0ba1=[_0x3c5280(0xd7)],_0x3764e0=['C'],_0x434ac4=['F'];break;}}return{'levels':_0x40d6f6,'Isle':_0xb00b82,'rack':_0x4219a0,'type':_0x2c0ba1,'storage':_0x3764e0,'rak':_0x434ac4};}async function getRandom8DigitNumber(){var _0x3b2175=a0_0x13a685;const _0x32a5a7=0x989680,_0x4bf1b9=0x5f5e0ff,_0x2df66f=Math[_0x3b2175(0x106)](Math['random']()*(_0x4bf1b9-_0x32a5a7+0x1))+_0x32a5a7;var _0x3ab85c;const _0x1cb82b=await purchases[_0x3b2175(0xc1)]({'invoice':_0x3b2175(0xee)+_0x2df66f});return _0x1cb82b&&_0x1cb82b['length']>0x0?_0x3ab85c='INC-'+_0x2df66f:_0x3ab85c='INC-'+_0x2df66f,_0x3ab85c;}router[a0_0x13a685(0xbc)](a0_0x13a685(0x1cb),auth,async(_0x5f247f,_0x254189)=>{var _0xf6f55b=a0_0x13a685;try{const {username:_0x1fe1c0,email:_0x107769,role:_0x55cdf9}=_0x5f247f[_0xf6f55b(0xf3)],_0x3b2a9c=_0x5f247f['user'],_0xdaab1=await profile['findOne']({'email':_0x3b2a9c[_0xf6f55b(0x10c)]}),_0x335687=await master_shop[_0xf6f55b(0x1a1)](),_0x2e564c=await staff['findOne']({'email':_0x3b2a9c[_0xf6f55b(0x10c)]}),_0x4a1d3f=await suppliers['find']({});let _0x54c80e;if(_0x3b2a9c[_0xf6f55b(0x10d)]==_0xf6f55b(0x12d)){const _0x1fa297=await staff['findOne']({'email':_0x3b2a9c['email']});_0x54c80e=await warehouse[_0xf6f55b(0x157)]([{'$match':{'status':_0xf6f55b(0xcf),'name':_0x1fa297[_0xf6f55b(0x1bc)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xf6f55b(0xc0)}}},{'$group':{'_id':_0xf6f55b(0x10b),'name':{'$first':_0xf6f55b(0x10b)}}}]);}else _0x54c80e=await warehouse[_0xf6f55b(0x157)]([{'$match':{'status':_0xf6f55b(0xcf),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xf6f55b(0xc0)}}},{'$group':{'_id':_0xf6f55b(0x10b),'name':{'$first':_0xf6f55b(0x10b)}}}]);const _0x32d5cd=await product['find']({}),_0x5b5196=await warehouse[_0xf6f55b(0x1a1)]({'status':'Enabled'}),_0x158bd3=await purchases[_0xf6f55b(0x1a1)]({}),_0x50987f=_0x158bd3[_0xf6f55b(0xc4)]+0x1,_0x5c6e37='INC-'+_0x50987f[_0xf6f55b(0x183)]()['padStart'](0x5,'0');var _0x3b8b2b=[_0xf6f55b(0x1ba),'Enclosed'];if(_0x335687[0x0][_0xf6f55b(0x140)]==_0xf6f55b(0x11a))var _0x2e1749=users[_0xf6f55b(0xe9)];else{if(_0x335687[0x0][_0xf6f55b(0x140)]==_0xf6f55b(0x152))var _0x2e1749=users['Hindi'];else{if(_0x335687[0x0][_0xf6f55b(0x140)]==_0xf6f55b(0x155))var _0x2e1749=users[_0xf6f55b(0x155)];else{if(_0x335687[0x0][_0xf6f55b(0x140)]==_0xf6f55b(0xce))var _0x2e1749=users[_0xf6f55b(0xce)];else{if(_0x335687[0x0]['language']==_0xf6f55b(0xdd))var _0x2e1749=users[_0xf6f55b(0xdd)];else{if(_0x335687[0x0][_0xf6f55b(0x140)]==_0xf6f55b(0x11b))var _0x2e1749=users['Portuguese'];else{if(_0x335687[0x0]['language']=='Chinese')var _0x2e1749=users['Chinese'];else{if(_0x335687[0x0]['language']==_0xf6f55b(0xca))var _0x2e1749=users[_0xf6f55b(0x177)];}}}}}}}const _0x365b59=getRandom8DigitNumber();_0x365b59[_0xf6f55b(0xdb)](_0x4dfe28=>{var _0x4966f0=_0xf6f55b;_0x254189[_0x4966f0(0xd3)](_0x4966f0(0x13f),{'success':_0x5f247f[_0x4966f0(0x128)](_0x4966f0(0xe5)),'errors':_0x5f247f['flash']('errors'),'role':_0x3b2a9c,'profile':_0xdaab1,'suppliers':_0x4a1d3f,'warehouse':_0x54c80e,'product':_0x32d5cd,'invoice':_0x4dfe28,'master_shop':_0x335687,'language':_0x2e1749,'find_data':_0x5b5196,'rooms_data':_0x3b8b2b});})[_0xf6f55b(0xde)](_0x3b5d61=>{var _0x2e7fd0=_0xf6f55b;_0x5f247f[_0x2e7fd0(0x128)]('errors',_0x2e7fd0(0x13e)),_0x254189[_0x2e7fd0(0x150)]('/all_purchases/view');});}catch(_0x16b304){console['log'](_0x16b304);}}),router[a0_0x13a685(0xbc)](a0_0x13a685(0x110),auth,async(_0x5a5625,_0x396042)=>{var _0x5e9d5c=a0_0x13a685;try{const _0x5da75b=_0x5a5625[_0x5e9d5c(0x199)]['id'];console[_0x5e9d5c(0xbf)](_0x5da75b);const _0x249c61=await master_shop[_0x5e9d5c(0x1a1)]();console[_0x5e9d5c(0xbf)](_0x5e9d5c(0x15c),_0x249c61);const _0x582698=await product[_0x5e9d5c(0xc1)]({'name':_0x5da75b});console[_0x5e9d5c(0xbf)](_0x5e9d5c(0x197),_0x582698),_0x396042[_0x5e9d5c(0x151)](0xc8)[_0x5e9d5c(0xf4)]({'product_data':_0x582698,'master':_0x249c61});}catch(_0x4918d6){console[_0x5e9d5c(0xbf)](_0x5e9d5c(0x1c7),_0x4918d6);}}),router[a0_0x13a685(0x1b6)](a0_0x13a685(0x1cb),auth,async(_0x2b21aa,_0x36f624)=>{var _0xcb3b0d=a0_0x13a685;try{const {invoice:_0x439499,date:_0x23823a,warehouse_name:_0x3dbf6f,prod_name:_0x104d73,prod_code:_0x390fce,prod_qty:_0x42d7f9,prod_unit:_0x36d216,prod_secondunit:_0x42116a,prod_level:_0x2f83e2,prod_isle:_0x58aaae,prod_pallet:_0x5b512f,note:_0x3ce352,expiry_date:_0x23705b,batch_code:_0x125ef3,payable:_0x162850,due_amount:_0x18b91f,Room_name:_0x551ec5,primary_code:_0x2e10cf,secondary_code:_0x32ce6f,MaxStocks_data:_0x5f4694,PO_number:_0x3ff77b,SCRN:_0x1f95d0,JO_number:_0x22b4b7}=_0x2b21aa[_0xcb3b0d(0xe0)];if(typeof _0x104d73==_0xcb3b0d(0x1a4))var _0xee57fd=[_0x2b21aa['body'][_0xcb3b0d(0x1ce)]],_0x464708=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x196)]],_0x2f2afb=[_0x2b21aa[_0xcb3b0d(0xe0)]['prod_Qty']],_0x4608b9=[_0x2b21aa[_0xcb3b0d(0xe0)]['prod_primunit']],_0x50893c=[_0x2b21aa['body'][_0xcb3b0d(0x15f)]],_0x10bf4f=[_0x2b21aa[_0xcb3b0d(0xe0)]['prod_level']],_0x5eb428=[_0x2b21aa['body'][_0xcb3b0d(0x125)]],_0x58add6=[_0x2b21aa[_0xcb3b0d(0xe0)]['secondary_code']],_0x123562=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x131)]],_0x3f8393=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x141)]],_0x531eed=[_0x2b21aa['body'][_0xcb3b0d(0xd9)]],_0x4d3fa3=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0xdf)]],_0x277110=[_0x2b21aa[_0xcb3b0d(0xe0)]['alertQTY']],_0x5f0f92=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x1a0)]],_0x6a80d9=[_0x2b21aa[_0xcb3b0d(0xe0)]['prod_cat']],_0x3efa11=[_0x2b21aa[_0xcb3b0d(0xe0)]['RoomAssign']],_0x53bada=[_0x2b21aa['body']['deliverycode']],_0x3fb0a4=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0xed)]],_0x3dcd09=[_0x2b21aa['body'][_0xcb3b0d(0x1cd)]],_0x208061=[_0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x1cc)]];else var _0xee57fd=[..._0x2b21aa[_0xcb3b0d(0xe0)]['prod_name']],_0x464708=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x196)]],_0x2f2afb=[..._0x2b21aa[_0xcb3b0d(0xe0)]['prod_Qty']],_0x4608b9=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x102)]],_0x50893c=[..._0x2b21aa['body'][_0xcb3b0d(0x15f)]],_0x10bf4f=[..._0x2b21aa['body'][_0xcb3b0d(0x164)]],_0x5eb428=[..._0x2b21aa['body'][_0xcb3b0d(0x125)]],_0x58add6=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x1b4)]],_0x123562=[..._0x2b21aa[_0xcb3b0d(0xe0)]['MaxStocks_data']],_0x3f8393=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x141)]],_0x531eed=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0xd9)]],_0x4d3fa3=[..._0x2b21aa[_0xcb3b0d(0xe0)]['max_product_unit']],_0x277110=[..._0x2b21aa['body'][_0xcb3b0d(0xff)]],_0x5f0f92=[..._0x2b21aa['body'][_0xcb3b0d(0x1a0)]],_0x6a80d9=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x129)]],_0x3efa11=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x1a6)]],_0x53bada=[..._0x2b21aa[_0xcb3b0d(0xe0)]['deliverycode']],_0x3fb0a4=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0xed)]],_0x3dcd09=[..._0x2b21aa[_0xcb3b0d(0xe0)]['actual_qty']],_0x208061=[..._0x2b21aa[_0xcb3b0d(0xe0)][_0xcb3b0d(0x1cc)]];const _0x3b9fb2=_0xee57fd[_0xcb3b0d(0x10a)](_0x158370=>{return _0x158370={'product_name':_0x158370};});_0x3dcd09[_0xcb3b0d(0xbb)]((_0x4f01d2,_0x296fc4)=>{_0x3b9fb2[_0x296fc4]['actual_qty']=Math['abs'](_0x4f01d2);}),_0x208061[_0xcb3b0d(0xbb)]((_0x59bed1,_0x2ae533)=>{var _0x3ddb7f=_0xcb3b0d;_0x3b9fb2[_0x2ae533][_0x3ddb7f(0x1cc)]=_0x59bed1;}),_0x464708[_0xcb3b0d(0xbb)]((_0x4ef08a,_0x355ab2)=>{var _0x22b659=_0xcb3b0d;_0x3b9fb2[_0x355ab2][_0x22b659(0x165)]=_0x4ef08a;}),_0x2f2afb['forEach']((_0x2b43a9,_0x49e39f)=>{var _0x26059a=_0xcb3b0d;_0x3b9fb2[_0x49e39f][_0x26059a(0x104)]=Math[_0x26059a(0x153)](_0x2b43a9);}),_0x4608b9[_0xcb3b0d(0xbb)]((_0x126519,_0x39185c)=>{var _0x2d082b=_0xcb3b0d;_0x3b9fb2[_0x39185c][_0x2d082b(0x171)]=_0x126519;}),_0x50893c['forEach']((_0xac44f4,_0x1abff2)=>{_0x3b9fb2[_0x1abff2]['secondary_unit']=_0xac44f4;}),_0x10bf4f['forEach']((_0xa520e5,_0x5281a5)=>{var _0x25fc3e=_0xcb3b0d;_0x3efa11[_0x25fc3e(0xbb)]((_0x1da2fc,_0x472055)=>{var _0x4b8d05=_0x25fc3e;if(_0x1da2fc==_0x4b8d05(0xf1)&&_0x5281a5==_0x472055){console[_0x4b8d05(0xbf)](_0x1da2fc+_0x4b8d05(0x194)+_0x5281a5+_0x4b8d05(0x1c0)+_0x472055+_0x4b8d05(0x1c0)+_0xa520e5);var _0x4dfd9c=_0xa520e5[_0x4b8d05(0xf0)](0x3);_0x3b9fb2[_0x5281a5][_0x4b8d05(0xf6)]=_0xa520e5[0x0],_0x3b9fb2[_0x5281a5][_0x4b8d05(0x149)]=_0xa520e5[0x1],_0x3b9fb2[_0x5281a5][_0x4b8d05(0x1c1)]=0x0,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x11f)]=0x0,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x11e)]=_0x4b8d05(0x1b1),_0x3b9fb2[_0x5281a5]['floorlevel']=_0x4dfd9c;}else{if(_0x1da2fc==_0x4b8d05(0x1ab)&&_0x5281a5==_0x472055){var _0x4dfd9c=_0xa520e5[_0x4b8d05(0xf0)](0x3);_0x3b9fb2[_0x5281a5]['storage']=_0xa520e5[0x0],_0x3b9fb2[_0x5281a5]['rack']=_0xa520e5[0x1],_0x3b9fb2[_0x5281a5][_0x4b8d05(0x1c1)]=0x0,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x11f)]=0x0,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x11e)]=_0x4b8d05(0x1b1),_0x3b9fb2[_0x5281a5][_0x4b8d05(0x15a)]=_0xa520e5[0x5];}else{if(_0x5281a5==_0x472055){if(_0xa520e5[0x0]=='A'&&_0xa520e5[0x1]=='L'&&_0xa520e5[0x2]=='L')console[_0x4b8d05(0xbf)](_0x1da2fc+'\x20<>\x20'+_0x5281a5+_0x4b8d05(0x1c0)+_0x472055+_0x4b8d05(0x1c0)+_0xa520e5+'here'),_0x3b9fb2[_0x5281a5]['storage']=_0xa520e5[0x0],_0x3b9fb2[_0x5281a5]['rack']=_0xa520e5[0x1],_0x3b9fb2[_0x5281a5][_0x4b8d05(0x1c1)]=0x0,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x11f)]=0x0,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x11e)]=_0x4b8d05(0x1b1),_0x3b9fb2[_0x5281a5][_0x4b8d05(0x15a)]=_0xa520e5[0x3];else{var _0x4daa9e;if(_0xa520e5[0x4]=='L')_0x4daa9e=_0x4b8d05(0xd7);else _0xa520e5[0x4]=='F'&&(_0x4daa9e='Floor');_0x3b9fb2[_0x5281a5]['storage']=_0xa520e5[0x0],_0x3b9fb2[_0x5281a5]['rack']=_0xa520e5[0x1],_0x3b9fb2[_0x5281a5][_0x4b8d05(0x1c1)]=_0xa520e5[0x2],_0x3b9fb2[_0x5281a5]['bin']=_0xa520e5[0x3],_0x3b9fb2[_0x5281a5]['type']=_0x4daa9e,_0x3b9fb2[_0x5281a5][_0x4b8d05(0x15a)]=_0xa520e5[0x5];}}}}});}),_0x5eb428[_0xcb3b0d(0xbb)]((_0x324425,_0x15b458)=>{var _0x13ec4f=_0xcb3b0d;_0x3b9fb2[_0x15b458][_0x13ec4f(0x125)]=_0x324425;}),_0x58add6[_0xcb3b0d(0xbb)]((_0x322f3d,_0x59eaa8)=>{var _0x4003e5=_0xcb3b0d;_0x3b9fb2[_0x59eaa8][_0x4003e5(0x1b4)]=_0x322f3d;}),_0x123562[_0xcb3b0d(0xbb)]((_0x5aa4cd,_0xa6557b)=>{var _0x2f42ef=_0xcb3b0d;_0x3b9fb2[_0xa6557b][_0x2f42ef(0xc8)]=_0x5aa4cd;}),_0x3f8393['forEach']((_0x883e11,_0x1613af)=>{_0x3b9fb2[_0x1613af]['batch_code']=_0x883e11;}),_0x531eed[_0xcb3b0d(0xbb)]((_0x5e5857,_0x5f2764)=>{_0x3b9fb2[_0x5f2764]['expiry_date']=_0x5e5857;}),_0x4d3fa3['forEach']((_0x3fd0f8,_0x3995fd)=>{var _0x1a71d9=_0xcb3b0d;_0x3b9fb2[_0x3995fd][_0x1a71d9(0xcc)]=_0x3fd0f8;}),_0x277110[_0xcb3b0d(0xbb)]((_0x311f0e,_0xfb5c7f)=>{var _0x471e1a=_0xcb3b0d;_0x3b9fb2[_0xfb5c7f][_0x471e1a(0xff)]=_0x311f0e;}),_0x5f0f92['forEach']((_0x2d5f61,_0x2dc5ba)=>{_0x3b9fb2[_0x2dc5ba]['production_date']=_0x2d5f61;}),_0x6a80d9['forEach']((_0xadcf2f,_0x29e2f1)=>{var _0x1ee070=_0xcb3b0d;_0x3b9fb2[_0x29e2f1][_0x1ee070(0x16e)]=_0xadcf2f;}),_0x3efa11[_0xcb3b0d(0xbb)]((_0x325a35,_0x1821de)=>{var _0x7db211=_0xcb3b0d;_0x3b9fb2[_0x1821de][_0x7db211(0x12c)]=_0x325a35;}),_0x53bada[_0xcb3b0d(0xbb)]((_0x4bfe33,_0x1b2fa3)=>{var _0x47dc56=_0xcb3b0d;_0x3b9fb2[_0x1b2fa3][_0x47dc56(0x113)]=_0x4bfe33;}),_0x3fb0a4['forEach']((_0x22fc0e,_0x10fd85)=>{var _0x178518=_0xcb3b0d;_0x3b9fb2[_0x10fd85][_0x178518(0xc3)]=_0x22fc0e;});const _0x38395d=_0x3efa11[_0xcb3b0d(0x10a)](_0x776a46=>{return _0x776a46={'room_name':_0x776a46};}),_0x531d37=_0x3b9fb2['filter'](_0x2db62c=>_0x2db62c[_0xcb3b0d(0x104)]!=='0'&&_0x2db62c[_0xcb3b0d(0x104)]!==''),_0x15f94d=new purchases({'invoice':_0x439499,'suppliers':_0x2b21aa['body'][_0xcb3b0d(0x170)],'date':_0x23823a,'warehouse_name':_0x3dbf6f,'product':_0x531d37,'note':_0x3ce352,'due_amount':_0x18b91f,'POnumber':_0x3ff77b,'SCRN':_0x1f95d0,'JO_number':_0x22b4b7,'roomList':_0x38395d}),_0x1a11df=await _0x15f94d[_0xcb3b0d(0x158)](),_0x3a3bd9=await purchases[_0xcb3b0d(0xc1)]({'invoice':_0x439499}),_0x5ea5c4=_0x3a3bd9[_0xcb3b0d(0x197)][_0xcb3b0d(0x10a)](async _0x4023ff=>{var _0x119a4f=_0xcb3b0d,_0x1791f0=await warehouse[_0x119a4f(0xc1)]({'name':_0x3dbf6f,'room':_0x4023ff[_0x119a4f(0x12c)]}),_0x14f4a2=0x0;return _0x1791f0[_0x119a4f(0x1a8)][_0x119a4f(0xbb)](_0x34b3c5=>{var _0x4031c7=_0x119a4f;_0x34b3c5['product_name']==_0x4023ff[_0x4031c7(0x172)]&&_0x34b3c5[_0x4031c7(0x15a)]==_0x4023ff[_0x4031c7(0x15a)]&&_0x34b3c5[_0x4031c7(0x11e)]==_0x4023ff[_0x4031c7(0x11e)]&&_0x34b3c5[_0x4031c7(0x11f)]==_0x4023ff[_0x4031c7(0x11f)]&&_0x34b3c5[_0x4031c7(0x1c1)]==_0x4023ff['bay']&&_0x34b3c5[_0x4031c7(0x149)]==_0x4023ff[_0x4031c7(0x149)]&&_0x34b3c5[_0x4031c7(0xf6)]==_0x4023ff[_0x4031c7(0xf6)]&&_0x34b3c5[_0x4031c7(0xd9)]==_0x4023ff[_0x4031c7(0xd9)]&&_0x34b3c5[_0x4031c7(0x141)]==_0x4023ff[_0x4031c7(0x141)]&&_0x34b3c5[_0x4031c7(0x1a0)]==_0x4023ff[_0x4031c7(0x1a0)]&&_0x34b3c5[_0x4031c7(0xc3)]==_0x3a3bd9[_0x4031c7(0xc3)]&&(_0x34b3c5['product_stock']+=Math[_0x4031c7(0x153)](_0x4023ff[_0x4031c7(0x104)]),_0x14f4a2++);}),_0x14f4a2===0x0&&_0x1791f0['product_details'][_0x119a4f(0xeb)]({'product_name':_0x4023ff[_0x119a4f(0x172)],'product_stock':Math[_0x119a4f(0x153)](_0x4023ff['quantity']),'primary_code':_0x4023ff[_0x119a4f(0x125)],'secondary_code':_0x4023ff['secondary_code'],'product_code':_0x4023ff[_0x119a4f(0x165)],'storage':_0x4023ff[_0x119a4f(0xf6)],'rack':_0x4023ff['rack'],'bay':_0x4023ff[_0x119a4f(0x1c1)],'bin':_0x4023ff[_0x119a4f(0x11f)],'type':_0x4023ff[_0x119a4f(0x11e)],'floorlevel':_0x4023ff[_0x119a4f(0x15a)],'maxProducts':_0x4023ff[_0x119a4f(0xc8)],'unit':_0x4023ff[_0x119a4f(0x171)],'secondary_unit':_0x4023ff['secondary_unit'],'expiry_date':_0x4023ff[_0x119a4f(0xd9)],'maxPerUnit':_0x4023ff[_0x119a4f(0xcc)],'batch_code':_0x4023ff[_0x119a4f(0x141)],'alertQTY':_0x4023ff[_0x119a4f(0xff)],'production_date':_0x4023ff['production_date'],'product_cat':_0x4023ff['product_cat'],'invoice':_0x4023ff[_0x119a4f(0xc3)],'actual_qty':Math[_0x119a4f(0x153)](_0x4023ff[_0x119a4f(0x1cd)]),'actual_uom':_0x4023ff['actual_uom']}),_0x1791f0;});Promise[_0xcb3b0d(0xf7)](_0x5ea5c4)[_0xcb3b0d(0xdb)](async _0x446692=>{var _0x3e8330=_0xcb3b0d;try{for(const _0xe6be51 of _0x446692){await _0xe6be51[_0x3e8330(0x158)]();}const _0x14952b=await master_shop[_0x3e8330(0x1a1)](),_0x106392=await email_settings[_0x3e8330(0xc1)](),_0x505aed=await supervisor_settings['find']();var _0x1bb10e=_0x3a3bd9['product'],_0x1b0c85='',_0x5aae6c;for(_0x5aae6c in _0x1bb10e){_0x1b0c85+=_0x3e8330(0xe3)+_0x3e8330(0x16d)+_0x1bb10e[_0x5aae6c][_0x3e8330(0x172)]+'</td>'+_0x3e8330(0x16d)+_0x1bb10e[_0x5aae6c][_0x3e8330(0x165)]+_0x3e8330(0xc6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1bb10e[_0x5aae6c][_0x3e8330(0x104)]+'</td>'+_0x3e8330(0x16d)+_0x1bb10e[_0x5aae6c]['standard_unit']+_0x3e8330(0xc6)+_0x3e8330(0x16d)+_0x1bb10e[_0x5aae6c][_0x3e8330(0x173)]+_0x3e8330(0xc6)+_0x3e8330(0x16d)+_0x3a3bd9[_0x3e8330(0x15b)]+_0x3e8330(0xc6)+_0x3e8330(0x16d)+_0x1bb10e[_0x5aae6c][_0x3e8330(0x12c)]+_0x3e8330(0xc6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1bb10e[_0x5aae6c][_0x3e8330(0xf6)]+_0x1bb10e[_0x5aae6c][_0x3e8330(0x149)]+_0x1bb10e[_0x5aae6c]['bay']+_0x1bb10e[_0x5aae6c][_0x3e8330(0x11f)]+_0x1bb10e[_0x5aae6c][_0x3e8330(0x11e)][0x0]+_0x1bb10e[_0x5aae6c][_0x3e8330(0x15a)]+_0x3e8330(0xc6),_0x3e8330(0x148);}let _0x2496c2=nodemailer['createTransport']({'host':_0x106392[_0x3e8330(0x18d)],'port':Number(_0x106392['port']),'secure':![],'auth':{'user':_0x106392[_0x3e8330(0x10c)],'pass':_0x106392['password']}}),_0x5e60a2={'from':_0x106392[_0x3e8330(0x10c)],'to':_0x505aed[0x0][_0x3e8330(0x124)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x3e8330(0x134)+_0x3e8330(0x186)+_0x14952b[0x0][_0x3e8330(0x16f)],'cid':'logo'}],'html':_0x3e8330(0x14b)+_0x3e8330(0x1c5)+'</head><body>'+_0x3e8330(0x190)+_0x3e8330(0x178)+_0x3e8330(0x190)+_0x3e8330(0x116)+_0x3e8330(0x187)+_0x3e8330(0x190)+_0x3e8330(0x130)+_0x14952b[0x0][_0x3e8330(0x13d)]+_0x3e8330(0x100)+'</div>'+_0x3e8330(0x187)+_0x3e8330(0x192)+_0x3e8330(0x190)+_0x3e8330(0x14f)+_0x3e8330(0xea)+_0x3a3bd9[_0x3e8330(0xc3)]+'\x20'+_0x3e8330(0x103)+_0x3e8330(0x168)+_0x3a3bd9[_0x3e8330(0x127)]+'\x20'+_0x3e8330(0x161)+_0x3e8330(0x19f)+_0x3e8330(0x187)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3e8330(0xf2)+'<tr>'+_0x3e8330(0x126)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x3e8330(0x1b3)+_0x3e8330(0x1c9)+_0x3e8330(0x198)+_0x3e8330(0x13a)+_0x3e8330(0xb9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3e8330(0x148)+_0x3e8330(0xbe)+_0x3e8330(0x11c)+'\x20'+_0x1b0c85+'\x20'+_0x3e8330(0x179)+_0x3e8330(0x19b)+'<div>'+_0x3e8330(0xf9)+_0x3e8330(0x15e)+_0x14952b[0x0][_0x3e8330(0x13d)]+_0x3e8330(0x19f)+'</div>'+_0x3e8330(0x187)+_0x3e8330(0xd0)};_0x2496c2[_0x3e8330(0x18f)](_0x5e60a2,function(_0xde8342,_0x5e69d8){var _0x2b13de=_0x3e8330;_0xde8342?(console[_0x2b13de(0xbf)](_0xde8342),console[_0x2b13de(0xbf)](_0x2b13de(0x19c))):console['log'](_0x2b13de(0x10f));}),_0x2b21aa[_0x3e8330(0x128)]('success',_0x3e8330(0x122)),_0x36f624[_0x3e8330(0x150)](_0x3e8330(0x123));}catch(_0xe41a0a){console[_0x3e8330(0x154)](_0xe41a0a),_0x36f624[_0x3e8330(0x151)](0x1f4)[_0x3e8330(0xf4)]({'error':_0x3e8330(0x114)});}})[_0xcb3b0d(0xde)](_0x5e1297=>{var _0x62b222=_0xcb3b0d;console[_0x62b222(0x154)](_0x5e1297),_0x36f624['status'](0x1f4)['json']({'error':_0x62b222(0xd1)});});}catch(_0x5463e6){console[_0xcb3b0d(0xbf)](_0x5463e6);}}),router['get'](a0_0x13a685(0xe2),auth,async(_0x1d964c,_0x164774)=>{var _0x5bacb6=a0_0x13a685;try{const {username:_0x1a3e5f,email:_0x4d713b,role:_0x409b41}=_0x1d964c[_0x5bacb6(0xf3)],_0x5e1e28=_0x1d964c[_0x5bacb6(0xf3)],_0x451ad2=await profile['findOne']({'email':_0x5e1e28['email']}),_0x50e09b=await master_shop['find'](),_0x4b3c02=_0x1d964c[_0x5bacb6(0x199)]['id'],_0x11f74e=await purchases[_0x5bacb6(0x16a)](_0x4b3c02),_0x10e3d2=await warehouse['aggregate']([{'$match':{'name':_0x11f74e[_0x5bacb6(0x15b)],'room':_0x11f74e['room']}},{'$unwind':_0x5bacb6(0xba)},{'$group':{'_id':_0x5bacb6(0x14a),'name':{'$first':_0x5bacb6(0x16c)},'product_stock':{'$first':_0x5bacb6(0x13b)},'bay':{'$first':_0x5bacb6(0x188)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5bacb6(0xd5)},'primary_code':{'$first':_0x5bacb6(0x195)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5bacb6(0xc2)},'storage':{'$first':_0x5bacb6(0x1a7)},'rack':{'$first':_0x5bacb6(0x139)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x312f2c=await customer[_0x5bacb6(0x1a1)]({});let _0x30025f;if(_0x5e1e28[_0x5bacb6(0x10d)]==_0x5bacb6(0x12d)){const _0x18d9d4=await staff[_0x5bacb6(0xc1)]({'email':_0x5e1e28[_0x5bacb6(0x10c)]});_0x30025f=await warehouse[_0x5bacb6(0x157)]([{'$match':{'status':_0x5bacb6(0xcf),'name':_0x18d9d4[_0x5bacb6(0x1bc)]}},{'$group':{'_id':_0x5bacb6(0x10b),'name':{'$first':_0x5bacb6(0x10b)}}}]);}else _0x30025f=await warehouse[_0x5bacb6(0x157)]([{'$match':{'status':_0x5bacb6(0xcf)}},{'$group':{'_id':_0x5bacb6(0x10b),'name':{'$first':_0x5bacb6(0x10b)}}}]);const _0x44fe9f=await product[_0x5bacb6(0x1a1)]({}),_0x4d1ac7=await suppliers[_0x5bacb6(0x1a1)]({}),_0x110c1c=BayBinSelected(_0x11f74e[_0x5bacb6(0x15b)],_0x11f74e[_0x5bacb6(0x105)]);if(_0x50e09b[0x0]['language']==_0x5bacb6(0x11a)){var _0x3caf46=users['English'];console[_0x5bacb6(0xbf)](_0x3caf46);}else{if(_0x50e09b[0x0][_0x5bacb6(0x140)]=='Hindi')var _0x3caf46=users[_0x5bacb6(0x152)];else{if(_0x50e09b[0x0][_0x5bacb6(0x140)]==_0x5bacb6(0x155))var _0x3caf46=users[_0x5bacb6(0x155)];else{if(_0x50e09b[0x0]['language']==_0x5bacb6(0xce))var _0x3caf46=users[_0x5bacb6(0xce)];else{if(_0x50e09b[0x0][_0x5bacb6(0x140)]==_0x5bacb6(0xdd))var _0x3caf46=users[_0x5bacb6(0xdd)];else{if(_0x50e09b[0x0][_0x5bacb6(0x140)]==_0x5bacb6(0x11b))var _0x3caf46=users[_0x5bacb6(0x1a9)];else{if(_0x50e09b[0x0]['language']=='Chinese')var _0x3caf46=users[_0x5bacb6(0x181)];else{if(_0x50e09b[0x0][_0x5bacb6(0x140)]==_0x5bacb6(0xca))var _0x3caf46=users[_0x5bacb6(0x177)];}}}}}}}_0x164774[_0x5bacb6(0xd3)]('edit_purchases_view',{'success':_0x1d964c[_0x5bacb6(0x128)](_0x5bacb6(0xe5)),'errors':_0x1d964c[_0x5bacb6(0x128)](_0x5bacb6(0x14c)),'role':_0x5e1e28,'profile':_0x451ad2,'customer':_0x312f2c,'warehouse':_0x30025f,'product':_0x10e3d2,'user':_0x11f74e,'master_shop':_0x50e09b,'unit':_0x44fe9f,'language':_0x3caf46,'suppliers':_0x4d1ac7,'dataSelected':_0x110c1c});}catch(_0x2de9df){console[_0x5bacb6(0xbf)](_0x2de9df);}}),router[a0_0x13a685(0x1b6)](a0_0x13a685(0xe2),auth,async(_0x2267d3,_0x38899b)=>{var _0x3f624e=a0_0x13a685;try{const _0x4bdc07=_0x2267d3[_0x3f624e(0x199)]['id'],{invoice:_0x40ca15,warehouse_name:_0x4a8172,Room_name:_0x32faa7}=_0x2267d3[_0x3f624e(0xe0)],_0xa0c49b=await warehouse[_0x3f624e(0xc1)]({'name':_0x4a8172,'room':_0x32faa7}),_0x3cbd2e=await purchases[_0x3f624e(0xc1)]({'invoice':_0x40ca15});_0x3cbd2e['product'][_0x3f624e(0xbb)](_0x152148=>{var _0x3a0262=_0x3f624e,_0x3eb051=0x0;const _0x35d73f=_0xa0c49b[_0x3a0262(0x1a8)][_0x3a0262(0x10a)](_0x4a727b=>{var _0x2154bd=_0x3a0262;_0x4a727b[_0x2154bd(0x172)]==_0x152148[_0x2154bd(0x172)]&&_0x4a727b[_0x2154bd(0x15a)]==_0x152148[_0x2154bd(0x15a)]&&_0x4a727b[_0x2154bd(0x11e)]==_0x152148[_0x2154bd(0x11e)]&&_0x4a727b[_0x2154bd(0x11f)]==_0x152148[_0x2154bd(0x11f)]&&_0x4a727b[_0x2154bd(0x1c1)]==_0x152148[_0x2154bd(0x1c1)]&&_0x4a727b[_0x2154bd(0x149)]==_0x152148[_0x2154bd(0x149)]&&_0x4a727b['storage']==_0x152148[_0x2154bd(0xf6)]&&_0x4a727b[_0x2154bd(0xd9)]==_0x152148[_0x2154bd(0xd9)]&&_0x4a727b[_0x2154bd(0x141)]==_0x152148[_0x2154bd(0x141)]&&_0x4a727b[_0x2154bd(0x1a0)]==_0x152148[_0x2154bd(0x1a0)]&&_0x4a727b[_0x2154bd(0xfe)]==_0x152148[_0x2154bd(0xfe)]&&_0x4a727b[_0x2154bd(0x113)]==_0x152148[_0x2154bd(0x113)]&&(_0x4a727b[_0x2154bd(0x117)]=parseInt(_0x4a727b[_0x2154bd(0x117)])+parseInt(_0x152148[_0x2154bd(0x104)]),_0x3eb051++);});_0x3eb051=='0'&&(_0xa0c49b[_0x3a0262(0x1a8)]=_0xa0c49b[_0x3a0262(0x1a8)][_0x3a0262(0x132)]({'product_name':_0x152148[_0x3a0262(0x172)],'product_stock':_0x152148[_0x3a0262(0x104)],'primary_code':_0x152148[_0x3a0262(0x125)],'secondary_code':_0x152148['secondary_code'],'product_code':_0x152148[_0x3a0262(0x165)],'storage':_0x152148['storage'],'rack':_0x152148[_0x3a0262(0x149)],'bay':_0x152148[_0x3a0262(0x1c1)],'bin':_0x152148['bin'],'type':_0x152148[_0x3a0262(0x11e)],'floorlevel':_0x152148[_0x3a0262(0x15a)],'maxProducts':_0x152148['maxStocks'],'unit':_0x152148[_0x3a0262(0x171)],'secondary_unit':_0x152148[_0x3a0262(0x173)],'expiry_date':_0x152148['expiry_date'],'maxPerUnit':_0x152148[_0x3a0262(0xcc)],'batch_code':_0x152148['batch_code'],'alertQTY':_0x152148[_0x3a0262(0xff)],'production_date':_0x152148[_0x3a0262(0x1a0)],'delivery_date':_0x152148[_0x3a0262(0xfe)],'delivery_code':_0x152148[_0x3a0262(0x113)]}));}),await _0xa0c49b[_0x3f624e(0x158)](),_0x3cbd2e[_0x3f624e(0x18c)]=_0x3f624e(0x160);const _0x5604de=await _0x3cbd2e['save']();_0x2267d3[_0x3f624e(0x128)](_0x3f624e(0xe5),'Sales\x20Update\x20successfully'),_0x38899b[_0x3f624e(0x150)](_0x3f624e(0x191));}catch(_0x4781e6){console[_0x3f624e(0xbf)](_0x4781e6);}}),router[a0_0x13a685(0xbc)](a0_0x13a685(0x1ae),auth,async(_0x24f488,_0x57fb24)=>{var _0x422333=a0_0x13a685;try{const {username:_0x21db7a,email:_0x4e5732,role:_0x2ed251}=_0x24f488[_0x422333(0xf3)],_0x450dde=_0x24f488[_0x422333(0xf3)],_0x2f5fe7=await profile[_0x422333(0xc1)]({'email':_0x450dde[_0x422333(0x10c)]}),_0x10a40f=await master_shop['find'](),_0x3c3fe9=_0x24f488[_0x422333(0x199)]['id'],_0x40e65e=await purchases[_0x422333(0x16a)](_0x3c3fe9),_0x1fc6e4=await suppliers[_0x422333(0x1a1)]({});let _0x247219;if(_0x450dde[_0x422333(0x10d)]=='staff'){const _0xf308c4=await staff[_0x422333(0xc1)]({'email':_0x450dde[_0x422333(0x10c)]});_0x247219=await warehouse['find']({'status':'Enabled','name':_0xf308c4['warehouse'],'warehouse_category':_0x422333(0x1b5)});}else _0x247219=await warehouse[_0x422333(0x157)]([{'$match':{'status':_0x422333(0xcf),'warehouse_category':_0x422333(0x1b5)}},{'$group':{'_id':_0x422333(0x10b),'name':{'$first':_0x422333(0x10b)}}}]);const _0x5f2141=await product[_0x422333(0x1a1)]({}),_0x406866=BayBinSelected(_0x40e65e[_0x422333(0x15b)],_0x40e65e[_0x422333(0x105)]);let _0x5a2716=new Date(_0x40e65e[_0x422333(0xd9)]),_0x370e=('0'+_0x5a2716['getDate']())[_0x422333(0xf0)](-0x2),_0x58a3f8=('0'+(_0x5a2716[_0x422333(0x120)]()+0x1))[_0x422333(0xf0)](-0x2),_0x15ecb7=_0x5a2716['getFullYear'](),_0x48f9c2=_0x15ecb7+'-'+_0x58a3f8+'-'+_0x370e;if(_0x10a40f[0x0][_0x422333(0x140)]==_0x422333(0x11a)){var _0x2bcd00=users[_0x422333(0xe9)];console[_0x422333(0xbf)](_0x2bcd00);}else{if(_0x10a40f[0x0][_0x422333(0x140)]=='Hindi')var _0x2bcd00=users[_0x422333(0x152)];else{if(_0x10a40f[0x0][_0x422333(0x140)]==_0x422333(0x155))var _0x2bcd00=users[_0x422333(0x155)];else{if(_0x10a40f[0x0][_0x422333(0x140)]=='Spanish')var _0x2bcd00=users[_0x422333(0xce)];else{if(_0x10a40f[0x0][_0x422333(0x140)]==_0x422333(0xdd))var _0x2bcd00=users[_0x422333(0xdd)];else{if(_0x10a40f[0x0]['language']==_0x422333(0x11b))var _0x2bcd00=users[_0x422333(0x1a9)];else{if(_0x10a40f[0x0][_0x422333(0x140)]==_0x422333(0x181))var _0x2bcd00=users['Chinese'];else{if(_0x10a40f[0x0][_0x422333(0x140)]=='Arabic\x20(ae)')var _0x2bcd00=users[_0x422333(0x177)];}}}}}}}_0x57fb24[_0x422333(0xd3)](_0x422333(0xcb),{'success':_0x24f488[_0x422333(0x128)](_0x422333(0xe5)),'errors':_0x24f488[_0x422333(0x128)](_0x422333(0x14c)),'role':_0x450dde,'profile':_0x2f5fe7,'purchases':_0x40e65e,'suppliers':_0x1fc6e4,'warehouse':_0x247219,'product':_0x5f2141,'master_shop':_0x10a40f,'language':_0x2bcd00,'ed_fullDate':_0x48f9c2,'dataSelected':_0x406866});}catch(_0x194deb){console[_0x422333(0xbf)](_0x194deb);}}),router['post'](a0_0x13a685(0x1ae),auth,async(_0x2c3868,_0x1c7bca)=>{var _0x59310a=a0_0x13a685;try{const _0x3aa5ce=_0x2c3868[_0x59310a(0x199)]['id'],_0x443ea4=await purchases[_0x59310a(0xc1)]({'_id':_0x2c3868['params']['id']}),_0x34481e=await warehouse[_0x59310a(0xc1)]({'name':_0x443ea4[_0x59310a(0x15b)],'room':_0x443ea4[_0x59310a(0x105)]});_0x443ea4[_0x59310a(0x197)][_0x59310a(0xbb)](_0x370148=>{var _0x3036ca=_0x59310a;const _0x34a59d=_0x34481e[_0x3036ca(0x1a8)]['map'](_0x1f34c9=>{var _0x12c920=_0x3036ca;_0x1f34c9[_0x12c920(0x172)]==_0x370148[_0x12c920(0x172)]&&_0x1f34c9[_0x12c920(0x15a)]==_0x370148[_0x12c920(0x15a)]&&_0x1f34c9[_0x12c920(0x11e)]==_0x370148[_0x12c920(0x11e)]&&_0x1f34c9[_0x12c920(0x11f)]==_0x370148[_0x12c920(0x11f)]&&_0x1f34c9['bay']==_0x370148[_0x12c920(0x1c1)]&&_0x1f34c9[_0x12c920(0x149)]==_0x370148[_0x12c920(0x149)]&&_0x1f34c9['storage']==_0x370148['storage']&&(_0x1f34c9[_0x12c920(0x117)]=parseInt(_0x1f34c9[_0x12c920(0x117)])-parseInt(_0x370148[_0x12c920(0x104)]));});}),await _0x34481e[_0x59310a(0x158)]();const {invoice:_0x4f9edb,suppliers:_0x44c2fe,date:_0x6205aa,warehouse_name:_0x529ecc,prod_name:_0x18b4d4,prod_code:_0x175d02,prod_qty:_0x5eadd3,prod_unit:_0x5a0f4d,prod_secondunit:_0x492a60,prod_level:_0x818f32,prod_isle:_0x246b25,prod_pallet:_0x3fa6cb,note:_0x5b8578,expiry_date:_0x1a0add,batch_code:_0x5ee677,paid_amount:_0x5b6e6d,due_amount:_0x96aa5e,Room_name:_0x17ce14,primary_code:_0x3dc1a7,secondary_code:_0xf0284b,PO_number:_0x2a44c2,JO_number:_0x4aabb7}=_0x2c3868['body'];if(typeof _0x18b4d4==_0x59310a(0x1a4))var _0x2ce07f=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x1ce)]],_0x7ca5a=[_0x2c3868['body']['prod_code']],_0x642505=[_0x2c3868[_0x59310a(0xe0)]['prod_qty']],_0x2ea01b=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x1c2)]],_0x420d6f=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x15f)]],_0x32eb0d=[_0x2c3868[_0x59310a(0xe0)]['prod_level']],_0x50a87f=[_0x2c3868['body'][_0x59310a(0x112)]],_0xabef45=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x18b)]],_0x5406a7=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x125)]],_0x2b3962=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x1b4)]],_0x34fdc6=[_0x2c3868['body'][_0x59310a(0x131)]],_0x436758=[_0x2c3868['body'][_0x59310a(0x141)]],_0x557eed=[_0x2c3868[_0x59310a(0xe0)]['expiry_date']],_0x3f7ede=[_0x2c3868[_0x59310a(0xe0)][_0x59310a(0xf6)]],_0x1f8b6f=[_0x2c3868['body']['rak']],_0x1e8d4f=[_0x2c3868['body'][_0x59310a(0x11e)]];else var _0x2ce07f=[..._0x2c3868['body']['prod_name']],_0x7ca5a=[..._0x2c3868['body'][_0x59310a(0x196)]],_0x642505=[..._0x2c3868[_0x59310a(0xe0)][_0x59310a(0x169)]],_0x2ea01b=[..._0x2c3868['body'][_0x59310a(0x1c2)]],_0x420d6f=[..._0x2c3868[_0x59310a(0xe0)][_0x59310a(0x15f)]],_0x32eb0d=[..._0x2c3868[_0x59310a(0xe0)][_0x59310a(0x164)]],_0x50a87f=[..._0x2c3868['body'][_0x59310a(0x112)]],_0xabef45=[..._0x2c3868[_0x59310a(0xe0)]['prod_pallet']],_0x5406a7=[..._0x2c3868['body'][_0x59310a(0x125)]],_0x2b3962=[..._0x2c3868['body'][_0x59310a(0x1b4)]],_0x34fdc6=[..._0x2c3868['body'][_0x59310a(0x131)]],_0x436758=[..._0x2c3868[_0x59310a(0xe0)]['batch_code']],_0x557eed=[..._0x2c3868[_0x59310a(0xe0)]['expiry_date']],_0x3f7ede=[..._0x2c3868['body']['storage']],_0x1f8b6f=[..._0x2c3868[_0x59310a(0xe0)][_0x59310a(0xd2)]],_0x1e8d4f=[..._0x2c3868['body'][_0x59310a(0x11e)]];const _0x49790d=_0x2ce07f[_0x59310a(0x10a)](_0x2e9f40=>{return _0x2e9f40={'product_name':_0x2e9f40};});_0x7ca5a['forEach']((_0xdf0f8c,_0x214265)=>{var _0x17688b=_0x59310a;_0x49790d[_0x214265][_0x17688b(0x165)]=_0xdf0f8c;}),_0x642505[_0x59310a(0xbb)]((_0x41c6e5,_0x537851)=>{_0x49790d[_0x537851]['quantity']=_0x41c6e5;}),_0x2ea01b[_0x59310a(0xbb)]((_0x3182af,_0x47adc9)=>{var _0x4cfffe=_0x59310a;_0x49790d[_0x47adc9][_0x4cfffe(0x171)]=_0x3182af;}),_0x420d6f[_0x59310a(0xbb)]((_0x283710,_0x30311c)=>{_0x49790d[_0x30311c]['secondary_unit']=_0x283710;}),_0x32eb0d[_0x59310a(0xbb)]((_0x3ef947,_0xf9032a)=>{_0x49790d[_0xf9032a]['bay']=_0x3ef947;}),_0x50a87f['forEach']((_0x1c8155,_0x119adf)=>{var _0xd2d894=_0x59310a;_0x49790d[_0x119adf][_0xd2d894(0x11f)]=_0x1c8155;}),_0xabef45[_0x59310a(0xbb)]((_0x4b732e,_0x445214)=>{_0x49790d[_0x445214]['floorlevel']=_0x4b732e;}),_0x5406a7['forEach']((_0x416d82,_0x1ceaa5)=>{_0x49790d[_0x1ceaa5]['primary_code']=_0x416d82;}),_0x2b3962['forEach']((_0x328b1f,_0x10d9d3)=>{var _0x27847e=_0x59310a;_0x49790d[_0x10d9d3][_0x27847e(0x1b4)]=_0x328b1f;}),_0x34fdc6[_0x59310a(0xbb)]((_0x4f8df3,_0x46a091)=>{_0x49790d[_0x46a091]['maxStocks']=_0x4f8df3;}),_0x436758[_0x59310a(0xbb)]((_0x224ed3,_0x240765)=>{_0x49790d[_0x240765]['batch_code']=_0x224ed3;}),_0x557eed[_0x59310a(0xbb)]((_0x485bf7,_0x397e5e)=>{var _0x4097ec=_0x59310a;_0x49790d[_0x397e5e][_0x4097ec(0xd9)]=_0x485bf7;}),_0x1e8d4f[_0x59310a(0xbb)]((_0x427a27,_0x93d255)=>{_0x49790d[_0x93d255]['type']=_0x427a27;}),_0x3f7ede[_0x59310a(0xbb)]((_0x24f206,_0x371cc8)=>{var _0x584215=_0x59310a;_0x49790d[_0x371cc8][_0x584215(0xf6)]=_0x24f206;}),_0x1f8b6f[_0x59310a(0xbb)]((_0x56bba1,_0x3cfb85)=>{var _0x44979f=_0x59310a;_0x49790d[_0x3cfb85][_0x44979f(0x149)]=_0x56bba1;});const _0x234405=_0x49790d[_0x59310a(0xcd)](_0x47cdcc=>_0x47cdcc[_0x59310a(0x104)]!=='0'&&_0x47cdcc['quantity']!=='');_0x443ea4[_0x59310a(0xc3)]=_0x4f9edb,_0x443ea4[_0x59310a(0x170)]=_0x44c2fe,_0x443ea4[_0x59310a(0x127)]=_0x6205aa,_0x443ea4[_0x59310a(0x15b)]=_0x529ecc,_0x443ea4[_0x59310a(0x197)]=_0x234405,_0x443ea4[_0x59310a(0x1ad)]=_0x5b8578,_0x443ea4['paid_amount']=_0x5b6e6d,_0x443ea4[_0x59310a(0x11d)]=_0x96aa5e,_0x443ea4[_0x59310a(0x105)]=_0x17ce14,_0x443ea4[_0x59310a(0x184)]=_0x2a44c2,_0x443ea4['JO_number']=_0x4aabb7;const _0x3388ba=await _0x443ea4[_0x59310a(0x158)](),_0x3a61b9=await warehouse['findOne']({'name':_0x2c3868[_0x59310a(0xe0)]['warehouse_name'],'room':_0x2c3868['body']['Room_name']});_0x443ea4[_0x59310a(0x197)][_0x59310a(0xbb)](_0x35352e=>{var _0x472120=_0x59310a,_0xb5a425=0x0;const _0x5c9d4b=_0x3a61b9['product_details']['map'](_0x59573c=>{var _0x432a9f=a0_0x4954;_0x59573c[_0x432a9f(0x172)]==_0x35352e[_0x432a9f(0x172)]&&_0x59573c[_0x432a9f(0x15a)]==_0x35352e[_0x432a9f(0x15a)]&&_0x59573c['type']==_0x35352e[_0x432a9f(0x11e)]&&_0x59573c[_0x432a9f(0x11f)]==_0x35352e[_0x432a9f(0x11f)]&&_0x59573c['bay']==_0x35352e[_0x432a9f(0x1c1)]&&_0x59573c[_0x432a9f(0x149)]==_0x35352e['rack']&&_0x59573c[_0x432a9f(0xf6)]==_0x35352e[_0x432a9f(0xf6)]&&(_0x59573c[_0x432a9f(0x117)]=parseInt(_0x59573c[_0x432a9f(0x117)])+parseInt(_0x35352e[_0x432a9f(0x104)]),_0xb5a425++);});_0xb5a425=='0'&&(_0x3a61b9[_0x472120(0x1a8)]=_0x3a61b9[_0x472120(0x1a8)]['concat']({'product_name':_0x35352e[_0x472120(0x172)],'product_stock':_0x35352e[_0x472120(0x104)],'primary_code':_0x35352e[_0x472120(0x125)],'secondary_code':_0x35352e[_0x472120(0x1b4)],'product_code':_0x35352e[_0x472120(0x165)],'storage':_0x35352e[_0x472120(0xf6)],'rack':_0x35352e[_0x472120(0x149)],'bay':_0x35352e[_0x472120(0x1c1)],'bin':_0x35352e['bin'],'type':_0x35352e[_0x472120(0x11e)],'floorlevel':_0x35352e[_0x472120(0x15a)],'maxProducts':_0x35352e[_0x472120(0xc8)],'unit':_0x35352e[_0x472120(0x171)],'secondary_unit':_0x35352e[_0x472120(0x173)],'expiry_date':_0x35352e[_0x472120(0xd9)]}));}),await _0x3a61b9['save']();const _0x84284a=await s_payment_data['findOne']({'invoice':_0x2c3868[_0x59310a(0xe0)][_0x59310a(0xc3)]});if(_0x84284a===null){}else console[_0x59310a(0xbf)]('suppliers',_0x84284a,_0x2c3868[_0x59310a(0xe0)][_0x59310a(0xc3)]),_0x84284a[_0x59310a(0x170)]=_0x2c3868[_0x59310a(0xe0)][_0x59310a(0x170)],await _0x84284a[_0x59310a(0x158)]();_0x2c3868[_0x59310a(0x128)](_0x59310a(0xe5),'purchase\x20data\x20update\x20successfully'),_0x1c7bca[_0x59310a(0x150)]('/all_purchases/view');}catch(_0x259373){console['log'](_0x259373);}}),router[a0_0x13a685(0x1b6)]('/give_payment/:id',auth,async(_0x47ae59,_0x243b2a)=>{var _0x388a33=a0_0x13a685;try{const _0x154c0e=_0x47ae59[_0x388a33(0x199)]['id'],{invoice:_0x3c0d5d,suppliers:_0x2928bc,payable:_0x21f071,due_amount:_0xf7d51a}=_0x47ae59[_0x388a33(0xe0)],_0x2a811e=await purchases[_0x388a33(0x16a)](_0x154c0e);var _0x1c2a25=_0x21f071-_0xf7d51a;_0x2a811e[_0x388a33(0xd8)]=parseFloat(_0x2a811e[_0x388a33(0xd8)])+parseFloat(_0xf7d51a),_0x2a811e[_0x388a33(0x11d)]=_0x1c2a25;const _0x1e979c=await _0x2a811e[_0x388a33(0x158)]();console['log'](_0x1e979c);const _0x367810=await s_payment_data[_0x388a33(0xc1)]({'invoice':_0x3c0d5d});_0x367810['amount']=_0x1c2a25,await _0x367810[_0x388a33(0x158)]();let _0x580828=new Date(),_0xcf08d2=('0'+_0x580828[_0x388a33(0x16b)]())['slice'](-0x2),_0xb2e4ee=('0'+(_0x580828[_0x388a33(0x120)]()+0x1))[_0x388a33(0xf0)](-0x2),_0x1f8bcc=_0x580828['getFullYear'](),_0x3efd53=_0x1f8bcc+'-'+_0xb2e4ee+'-'+_0xcf08d2;const _0x303df4=new suppliers_payment({'invoice':_0x3c0d5d,'date':_0x1f8bcc+'-'+_0xb2e4ee+'-'+_0xcf08d2,'suppliers':_0x2928bc,'reason':_0x388a33(0x145),'amount':_0xf7d51a}),_0xb00e59=await _0x303df4['save']();_0x47ae59[_0x388a33(0x128)](_0x388a33(0xe5),_0x388a33(0x193)),_0x243b2a[_0x388a33(0x150)](_0x388a33(0x191));}catch(_0x3516bd){console['log'](_0x3516bd);}}),router[a0_0x13a685(0xbc)](a0_0x13a685(0x1b9),auth,async(_0xa0f794,_0x3c18a3)=>{var _0x19c7a4=a0_0x13a685;try{const {username:_0x3e6ee2,email:_0x5de979,role:_0x5c7f79}=_0xa0f794['user'],_0x2cb938=_0xa0f794[_0x19c7a4(0xf3)],_0x23b915=await profile[_0x19c7a4(0xc1)]({'email':_0x2cb938[_0x19c7a4(0x10c)]}),_0x1f8085=await master_shop[_0x19c7a4(0x1a1)]();console['log'](_0x19c7a4(0x15c),_0x1f8085);const _0x197ca6=_0xa0f794['params']['id'],_0x51f7c7=await purchases['findById'](_0x197ca6);console['log'](_0x51f7c7);const _0x1acbc4=await suppliers[_0x19c7a4(0xc1)]({'name':_0x51f7c7[_0x19c7a4(0x170)]});console[_0x19c7a4(0xbf)](_0x1acbc4);if(_0x1f8085[0x0][_0x19c7a4(0x140)]==_0x19c7a4(0x11a)){var _0x26e05a=users[_0x19c7a4(0xe9)];console[_0x19c7a4(0xbf)](_0x26e05a);}else{if(_0x1f8085[0x0][_0x19c7a4(0x140)]==_0x19c7a4(0x152))var _0x26e05a=users[_0x19c7a4(0x152)];else{if(_0x1f8085[0x0][_0x19c7a4(0x140)]==_0x19c7a4(0x155))var _0x26e05a=users[_0x19c7a4(0x155)];else{if(_0x1f8085[0x0]['language']==_0x19c7a4(0xce))var _0x26e05a=users[_0x19c7a4(0xce)];else{if(_0x1f8085[0x0][_0x19c7a4(0x140)]=='French')var _0x26e05a=users[_0x19c7a4(0xdd)];else{if(_0x1f8085[0x0][_0x19c7a4(0x140)]==_0x19c7a4(0x11b))var _0x26e05a=users[_0x19c7a4(0x1a9)];else{if(_0x1f8085[0x0]['language']==_0x19c7a4(0x181))var _0x26e05a=users['Chinese'];else{if(_0x1f8085[0x0]['language']=='Arabic\x20(ae)')var _0x26e05a=users[_0x19c7a4(0x177)];}}}}}}}_0x3c18a3['render'](_0x19c7a4(0xe1),{'success':_0xa0f794[_0x19c7a4(0x128)]('success'),'errors':_0xa0f794['flash']('errors'),'role':_0x2cb938,'profile':_0x23b915,'master_shop':_0x1f8085,'supplier':_0x1acbc4,'purchase':_0x51f7c7,'language':_0x26e05a});}catch(_0x44f604){console['log'](_0x44f604);}}),router[a0_0x13a685(0xbc)](a0_0x13a685(0x19a),auth,async(_0x238191,_0x4ea771)=>{var _0xdb85a7=a0_0x13a685;try{const {username:_0x315862,email:_0x4a3408,role:_0x4a0644}=_0x238191[_0xdb85a7(0xf3)],_0x2d70e9=_0x238191[_0xdb85a7(0xf3)],_0x12845c=await profile[_0xdb85a7(0xc1)]({'email':_0x2d70e9['email']}),_0x44436e=await master_shop[_0xdb85a7(0x1a1)]();console[_0xdb85a7(0xbf)](_0xdb85a7(0x15c),_0x44436e);const _0x26f242=_0x238191[_0xdb85a7(0x199)]['id'];console[_0xdb85a7(0xbf)](_0x26f242);const _0x253d07=await purchases[_0xdb85a7(0x16a)](_0x26f242);console[_0xdb85a7(0xbf)](_0xdb85a7(0x1c6),_0x253d07);const _0x9dc448=await product[_0xdb85a7(0x1a1)]({}),_0x4bd1c4=await warehouse[_0xdb85a7(0x157)]([{'$match':{'name':_0x253d07[_0xdb85a7(0x15b)],'room':_0x253d07[_0xdb85a7(0x105)],'warehouse_category':_0xdb85a7(0x1b5)}},{'$unwind':_0xdb85a7(0xba)},{'$group':{'_id':_0xdb85a7(0x14a),'name':{'$first':_0xdb85a7(0x16c)},'product_stock':{'$first':_0xdb85a7(0x13b)},'bay':{'$first':_0xdb85a7(0x188)},'bin':{'$first':_0xdb85a7(0x163)},'type':{'$first':_0xdb85a7(0x156)},'floorlevel':{'$first':_0xdb85a7(0xd5)},'primary_code':{'$first':_0xdb85a7(0x195)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xdb85a7(0xc2)},'storage':{'$first':_0xdb85a7(0x1a7)},'rack':{'$first':_0xdb85a7(0x139)}}}]);warehouse_data=await warehouse[_0xdb85a7(0x157)]([{'$match':{'status':'Enabled','name':_0xdb85a7(0xc0),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0xdb85a7(0x10b),'name':{'$first':_0xdb85a7(0x10b)}}},{'$sort':{'name':0x1}}]),console[_0xdb85a7(0xbf)]('stock_data',_0x4bd1c4);if(_0x44436e[0x0][_0xdb85a7(0x140)]==_0xdb85a7(0x11a)){var _0x5a9fbf=users[_0xdb85a7(0xe9)];console[_0xdb85a7(0xbf)](_0x5a9fbf);}else{if(_0x44436e[0x0][_0xdb85a7(0x140)]==_0xdb85a7(0x152))var _0x5a9fbf=users[_0xdb85a7(0x152)];else{if(_0x44436e[0x0][_0xdb85a7(0x140)]=='German')var _0x5a9fbf=users[_0xdb85a7(0x155)];else{if(_0x44436e[0x0][_0xdb85a7(0x140)]==_0xdb85a7(0xce))var _0x5a9fbf=users['Spanish'];else{if(_0x44436e[0x0][_0xdb85a7(0x140)]=='French')var _0x5a9fbf=users['French'];else{if(_0x44436e[0x0][_0xdb85a7(0x140)]==_0xdb85a7(0x11b))var _0x5a9fbf=users['Portuguese'];else{if(_0x44436e[0x0]['language']=='Chinese')var _0x5a9fbf=users['Chinese'];else{if(_0x44436e[0x0][_0xdb85a7(0x140)]==_0xdb85a7(0xca))var _0x5a9fbf=users[_0xdb85a7(0x177)];}}}}}}}_0x4ea771['render'](_0xdb85a7(0xf8),{'success':_0x238191[_0xdb85a7(0x128)](_0xdb85a7(0xe5)),'errors':_0x238191['flash'](_0xdb85a7(0x14c)),'role':_0x2d70e9,'profile':_0x12845c,'user':_0x253d07,'stock':_0x4bd1c4,'master_shop':_0x44436e,'product':_0x9dc448,'language':_0x5a9fbf,'warehouse':warehouse_data});}catch(_0x20e149){console[_0xdb85a7(0xbf)](_0x20e149);}}),router[a0_0x13a685(0x1b6)](a0_0x13a685(0x19a),auth,async(_0x70f620,_0x563f70)=>{var _0x1d1258=a0_0x13a685;try{const {invoice:_0x3a7948,date:_0x3e24fb,warehouse_name:_0x24ed99,Room_name:_0x491d1c,product_name:_0x1acfd5,purchase_quantity:_0x121549,stocks:_0xe84d6c,return_qty:_0x42aea2,note:_0xdd3ddf,level:_0x44c793,isle:_0x10992d,pallet:_0xf7a1eb,to_warehouse_name:_0x2c68b4,to_Room_name:_0x102424}=_0x70f620['body'],_0xba2ebf=await purchases[_0x1d1258(0xc1)]({'_id':_0x70f620[_0x1d1258(0x199)]['id']}),_0x51bae6=await warehouse[_0x1d1258(0xc1)]({'name':_0x24ed99,'room':_0x491d1c});if(typeof _0x1acfd5==_0x1d1258(0x1a4))var _0x328316=[_0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x172)]],_0x16188c=[_0x70f620['body'][_0x1d1258(0x18a)]],_0xa7f623=[_0x70f620['body'][_0x1d1258(0x108)]],_0x4017d2=[_0x70f620['body'][_0x1d1258(0xc5)]],_0x1b756d=[_0x70f620[_0x1d1258(0xe0)]['level']],_0x4e4546=[_0x70f620[_0x1d1258(0xe0)]['isle']],_0x187712=[_0x70f620[_0x1d1258(0xe0)]['pallet']],_0x5ac80c=[_0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x175)]],_0x4f4792=[_0x70f620['body']['product_code_hide']],_0x3f0dda=[_0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x1aa)]],_0x1bbb60=[_0x70f620[_0x1d1258(0xe0)]['secondary_code_hide']];else var _0x328316=[..._0x70f620['body'][_0x1d1258(0x172)]],_0x16188c=[..._0x70f620['body'][_0x1d1258(0x18a)]],_0xa7f623=[..._0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x108)]],_0x4017d2=[..._0x70f620[_0x1d1258(0xe0)][_0x1d1258(0xc5)]],_0x1b756d=[..._0x70f620[_0x1d1258(0xe0)][_0x1d1258(0xfb)]],_0x4e4546=[..._0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x17b)]],_0x187712=[..._0x70f620[_0x1d1258(0xe0)]['pallet']],_0x5ac80c=[..._0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x175)]],_0x4f4792=[..._0x70f620[_0x1d1258(0xe0)]['product_code_hide']],_0x3f0dda=[..._0x70f620[_0x1d1258(0xe0)]['primary_code_hide']],_0x1bbb60=[..._0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x1be)]];const _0x22977e=_0x328316['map'](_0x10c852=>{return _0x10c852={'product_name':_0x10c852};});_0x16188c[_0x1d1258(0xbb)]((_0xf8ad1,_0x428089)=>{var _0x1fca97=_0x1d1258;_0x22977e[_0x428089][_0x1fca97(0x18a)]=_0xf8ad1;}),_0xa7f623['forEach']((_0x3fe0f0,_0x84becd)=>{_0x22977e[_0x84becd]['stock_quantity']=_0x3fe0f0;}),_0x4017d2['forEach']((_0x2548aa,_0x4b9c0e)=>{var _0x11d153=_0x1d1258;_0x22977e[_0x4b9c0e][_0x11d153(0xc5)]=_0x2548aa;}),_0x1b756d['forEach']((_0x31778c,_0x391d44)=>{var _0x23c07f=_0x1d1258;_0x22977e[_0x391d44][_0x23c07f(0x1c1)]=_0x31778c;}),_0x4e4546[_0x1d1258(0xbb)]((_0xe528c3,_0xc58e8a)=>{var _0x498725=_0x1d1258;_0x22977e[_0xc58e8a][_0x498725(0x11f)]=_0xe528c3;}),_0x187712['forEach']((_0x4d4a28,_0x353943)=>{var _0x5384b0=_0x1d1258;_0x22977e[_0x353943][_0x5384b0(0x15a)]=_0x4d4a28;}),_0x5ac80c[_0x1d1258(0xbb)]((_0x3df0b6,_0x38e91b)=>{var _0x634a8=_0x1d1258;_0x22977e[_0x38e91b][_0x634a8(0x11e)]=_0x3df0b6;}),_0x4f4792[_0x1d1258(0xbb)]((_0x19e306,_0x806eed)=>{_0x22977e[_0x806eed]['product_code']=_0x19e306;}),_0x3f0dda[_0x1d1258(0xbb)]((_0x5278b3,_0x2baf34)=>{_0x22977e[_0x2baf34]['primary_code']=_0x5278b3;}),_0x1bbb60['forEach']((_0x37e24b,_0x308551)=>{var _0x138f69=_0x1d1258;_0x22977e[_0x308551][_0x138f69(0x1b4)]=_0x37e24b;}),_0xba2ebf['product'][_0x1d1258(0xbb)](_0x47c8b1=>{var _0x19a7f8=_0x1d1258;const _0x4784e5=_0x51bae6[_0x19a7f8(0x1a8)]['map'](_0x19348c=>{var _0x56f721=_0x19a7f8;_0x19348c[_0x56f721(0x172)]==_0x47c8b1[_0x56f721(0x172)]&&_0x19348c[_0x56f721(0x15a)]==_0x47c8b1[_0x56f721(0x15a)]&&_0x19348c[_0x56f721(0x11e)]==_0x47c8b1[_0x56f721(0x11e)]&&_0x19348c[_0x56f721(0x11f)]==_0x47c8b1[_0x56f721(0x11f)]&&_0x19348c['bay']==_0x47c8b1[_0x56f721(0x1c1)]&&_0x19348c[_0x56f721(0x149)]==_0x47c8b1[_0x56f721(0x149)]&&_0x19348c[_0x56f721(0xf6)]==_0x47c8b1[_0x56f721(0xf6)]&&(console[_0x56f721(0xbf)](parseInt(_0x19348c[_0x56f721(0x117)])+_0x56f721(0x1c0)+parseInt(_0x47c8b1[_0x56f721(0x104)])),_0x19348c['product_stock']=parseInt(_0x19348c[_0x56f721(0x117)])+parseInt(_0x47c8b1[_0x56f721(0x104)]));});}),await _0x51bae6[_0x1d1258(0x158)]();const _0x3f2188=_0x22977e[_0x1d1258(0xcd)](_0x4998d3=>_0x4998d3[_0x1d1258(0xc5)]!=='0'&&_0x4998d3['return_qty']!=='');var _0x3fe0e5=0x0;_0x3f2188[_0x1d1258(0xbb)](_0x114874=>{var _0x1270b9=_0x1d1258;console[_0x1270b9(0xbf)](_0x1270b9(0x1a5),_0x114874),(parseInt(_0x114874['purchase_quantity'])<parseInt(_0x114874[_0x1270b9(0xc5)])||parseInt(_0x114874[_0x1270b9(0x12a)])<parseInt(_0x114874[_0x1270b9(0xc5)]))&&_0x3fe0e5++;});if(_0x3fe0e5!=0x0)return _0x70f620[_0x1d1258(0x128)](_0x1d1258(0x14c),_0x1d1258(0x133)),_0x563f70[_0x1d1258(0x150)](_0x1d1258(0x17f));const _0x11f8c3=new purchases_return({'invoice':_0x3a7948,'suppliers':_0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x170)],'date':_0x3e24fb,'warehouse_name':_0x24ed99,'return_product':_0x3f2188,'note':_0xdd3ddf,'room':_0x491d1c,'to_warehouse_name':_0x2c68b4,'to_room':_0x102424}),_0x17a101=await _0x11f8c3[_0x1d1258(0x158)]();console['log'](_0x11f8c3);const _0x416747=await purchases_return['findOne']({'invoice':_0x3a7948}),_0x3dea0d=await warehouse[_0x1d1258(0xc1)]({'name':_0x2c68b4,'room':_0x102424});_0x416747[_0x1d1258(0x180)][_0x1d1258(0xbb)](_0x2f668b=>{var _0x37f24e=_0x1d1258,_0x147c32=0x0;const _0x1f5cff=_0x3dea0d[_0x37f24e(0x1a8)]['map'](_0x1ec38a=>{var _0x5e276d=_0x37f24e;_0x1ec38a[_0x5e276d(0x172)]==_0x2f668b[_0x5e276d(0x172)]&&_0x1ec38a[_0x5e276d(0x15a)]==_0x2f668b[_0x5e276d(0x15a)]&&_0x1ec38a[_0x5e276d(0x11e)]==_0x2f668b[_0x5e276d(0x11e)]&&_0x1ec38a[_0x5e276d(0x11f)]==_0x2f668b['bin']&&_0x1ec38a['bay']==_0x2f668b[_0x5e276d(0x1c1)]&&(_0x1ec38a['product_stock']=parseInt(_0x1ec38a[_0x5e276d(0x117)])-parseInt(_0x2f668b[_0x5e276d(0xc5)]),_0x147c32++);});_0x147c32=='0'&&(_0x3dea0d[_0x37f24e(0x1a8)]=_0x3dea0d[_0x37f24e(0x1a8)][_0x37f24e(0x132)]({'product_name':_0x2f668b[_0x37f24e(0x172)],'product_stock':_0x2f668b[_0x37f24e(0xc5)],'primary_code':_0x2f668b[_0x37f24e(0x125)],'secondary_code':_0x2f668b[_0x37f24e(0x1b4)],'product_code':_0x2f668b['product_code'],'storage':_0x2f668b[_0x37f24e(0xf6)],'rack':_0x2f668b[_0x37f24e(0x149)],'bay':_0x2f668b[_0x37f24e(0x1c1)],'bin':_0x2f668b[_0x37f24e(0x11f)],'type':_0x2f668b['type'],'floorlevel':_0x2f668b[_0x37f24e(0x15a)],'maxProducts':_0x2f668b[_0x37f24e(0xc8)],'unit':_0x2f668b['standard_unit'],'secondary_unit':_0x2f668b[_0x37f24e(0x173)],'expiry_date':_0x2f668b[_0x37f24e(0xd9)]}));}),await _0x3dea0d['save']();const _0x102efc=await purchases[_0x1d1258(0xc1)]({'invoice':_0x3a7948});_0x102efc['return_data']='True';const _0x112f8b=await _0x102efc[_0x1d1258(0x158)](),_0x5faa93=new s_payment_data({'invoice':_0x3a7948,'suppliers':_0x70f620[_0x1d1258(0xe0)]['suppliers'],'reason':_0x1d1258(0x1a3)});await _0x5faa93[_0x1d1258(0x158)]();const _0x20be2b=await master_shop[_0x1d1258(0x1a1)]();console[_0x1d1258(0xbf)]('add\x20post',_0x20be2b[0x0][_0x1d1258(0x16f)]);const _0x17a466=await email_settings[_0x1d1258(0xc1)](),_0x5d2a6c=await suppliers[_0x1d1258(0xc1)]({'name':_0x70f620[_0x1d1258(0xe0)][_0x1d1258(0x170)]});console[_0x1d1258(0xbf)]('suppliers_data',_0x5d2a6c);_0x20be2b[0x0][_0x1d1258(0xec)]==0x1?(right_currency=_0x20be2b[0x0][_0x1d1258(0x1bf)],left_currency=''):(right_currency='',left_currency=_0x20be2b[0x0][_0x1d1258(0x1bf)]);var _0x38c5e7=_0x328316,_0x37b462=_0x4017d2,_0x325be2='',_0x54b791;for(_0x54b791 in _0x38c5e7){_0x325be2+='<tr>'+_0x1d1258(0x16d)+_0x38c5e7[_0x54b791]+_0x1d1258(0xc6)+_0x1d1258(0x16d)+_0x37b462[_0x54b791]+_0x1d1258(0xc6)+_0x1d1258(0x148);}console['log']('product_list',_0x325be2);let _0x53be09=nodemailer['createTransport']({'service':_0x1d1258(0x1c3),'auth':{'user':_0x17a466[_0x1d1258(0x10c)],'pass':_0x17a466[_0x1d1258(0xe7)]}}),_0x2b1113={'from':_0x17a466['email'],'to':_0x5d2a6c[_0x1d1258(0x10c)],'subject':_0x1d1258(0x182),'attachments':[{'filename':_0x1d1258(0x135),'path':__dirname+_0x1d1258(0x134)+_0x1d1258(0x186)+_0x20be2b[0x0][_0x1d1258(0x16f)],'cid':_0x1d1258(0x17c)}],'html':_0x1d1258(0x14b)+_0x1d1258(0x1c5)+_0x1d1258(0x121)+_0x1d1258(0x190)+_0x1d1258(0x178)+_0x1d1258(0x190)+_0x1d1258(0x116)+_0x1d1258(0x187)+_0x1d1258(0x190)+_0x1d1258(0x130)+_0x20be2b[0x0]['site_title']+_0x1d1258(0x100)+_0x1d1258(0x187)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x1d1258(0x14f)+_0x1d1258(0xea)+_0x3a7948+'\x20'+_0x1d1258(0x103)+_0x1d1258(0x168)+_0x3e24fb+'\x20'+_0x1d1258(0x161)+_0x1d1258(0x19f)+'</div>'+_0x1d1258(0x17a)+_0x1d1258(0xf2)+_0x1d1258(0xe3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1d1258(0x162)+_0x1d1258(0x101)+_0x1d1258(0x148)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x325be2+'\x20'+'</tbody>'+_0x1d1258(0x19b)+_0x1d1258(0x190)+_0x1d1258(0xf9)+_0x1d1258(0x15e)+_0x20be2b[0x0]['site_title']+_0x1d1258(0x19f)+_0x1d1258(0x187)+_0x1d1258(0x187)+_0x1d1258(0xd0)};_0x53be09['sendMail'](_0x2b1113,function(_0x41b27b,_0x425775){var _0x51474b=_0x1d1258;_0x41b27b?(console['log'](_0x41b27b),console[_0x51474b(0xbf)](_0x51474b(0x19c))):console[_0x51474b(0xbf)]('Email\x20sent\x20successfully');}),_0x70f620[_0x1d1258(0x128)](_0x1d1258(0xe5),'purchases\x20item\x20return\x20successfull'),_0x563f70[_0x1d1258(0x150)](_0x1d1258(0x191));}catch(_0x5ac665){console[_0x1d1258(0xbf)](_0x5ac665),_0x563f70[_0x1d1258(0x151)](0xc8)['json']({'message':_0x5ac665['message']});}}),router[a0_0x13a685(0xbc)]('/barcode/:id',auth,async(_0x43a323,_0x1cbe1d)=>{var _0x5f51bd=a0_0x13a685;try{const {username:_0x1b126a,email:_0x429341,role:_0x1a0744}=_0x43a323[_0x5f51bd(0xf3)],_0x5a3d75=_0x43a323['user'],_0x51be99=await profile[_0x5f51bd(0xc1)]({'email':_0x5a3d75[_0x5f51bd(0x10c)]}),_0x2a867e=await master_shop[_0x5f51bd(0x1a1)](),_0x544849=_0x43a323[_0x5f51bd(0x199)]['id'],_0x37009c=await purchases[_0x5f51bd(0x16a)](_0x544849);if(_0x2a867e[0x0][_0x5f51bd(0x140)]==_0x5f51bd(0x11a))var _0x5c866f=users[_0x5f51bd(0xe9)];else{if(_0x2a867e[0x0][_0x5f51bd(0x140)]==_0x5f51bd(0x152))var _0x5c866f=users[_0x5f51bd(0x152)];else{if(_0x2a867e[0x0][_0x5f51bd(0x140)]==_0x5f51bd(0x155))var _0x5c866f=users[_0x5f51bd(0x155)];else{if(_0x2a867e[0x0]['language']==_0x5f51bd(0xce))var _0x5c866f=users[_0x5f51bd(0xce)];else{if(_0x2a867e[0x0]['language']==_0x5f51bd(0xdd))var _0x5c866f=users[_0x5f51bd(0xdd)];else{if(_0x2a867e[0x0][_0x5f51bd(0x140)]==_0x5f51bd(0x11b))var _0x5c866f=users[_0x5f51bd(0x1a9)];else{if(_0x2a867e[0x0][_0x5f51bd(0x140)]==_0x5f51bd(0x181))var _0x5c866f=users['Chinese'];else{if(_0x2a867e[0x0][_0x5f51bd(0x140)]==_0x5f51bd(0xca))var _0x5c866f=users[_0x5f51bd(0x177)];}}}}}}}_0x1cbe1d['render'](_0x5f51bd(0x109),{'success':_0x43a323['flash'](_0x5f51bd(0xe5)),'errors':_0x43a323[_0x5f51bd(0x128)](_0x5f51bd(0x14c)),'role':_0x5a3d75,'profile':_0x51be99,'alldata':_0x37009c,'master_shop':_0x2a867e,'language':_0x5c866f}),console[_0x5f51bd(0xbf)](alldata);}catch(_0x5a5fae){console[_0x5f51bd(0xbf)](_0x5a5fae);}}),router[a0_0x13a685(0x1b6)]('/barcode_scanner',async(_0x3ed29e,_0x47254f)=>{var _0x4f6c99=a0_0x13a685;const {product_code:_0xb3a6bf}=_0x3ed29e[_0x4f6c99(0xe0)];var _0x1685bd;const _0x39d665=await product[_0x4f6c99(0x157)]([{'$match':{'primary_code':_0xb3a6bf,'product_category':_0x4f6c99(0x1b5)}},{'$group':{'_id':'$_id','name':{'$first':_0x4f6c99(0x10b)},'category':{'$first':_0x4f6c99(0xc7)},'brand':{'$first':_0x4f6c99(0x1b7)},'unit':{'$first':_0x4f6c99(0x19e)},'alertquantity':{'$first':_0x4f6c99(0xfd)},'product_code':{'$first':_0x4f6c99(0x143)},'primary_code':{'$first':_0x4f6c99(0x174)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4f6c99(0x118)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4f6c99(0x1ca)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x35be3=await product[_0x4f6c99(0x157)]([{'$match':{'secondary_code':_0xb3a6bf,'product_category':_0x4f6c99(0x1b5)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x4f6c99(0x1b7)},'unit':{'$first':_0x4f6c99(0x19e)},'alertquantity':{'$first':_0x4f6c99(0xfd)},'product_code':{'$first':_0x4f6c99(0x143)},'primary_code':{'$first':_0x4f6c99(0x174)},'secondary_code':{'$first':_0x4f6c99(0x19d)},'maxStocks':{'$first':_0x4f6c99(0x118)},'maxProdPerUnit':{'$first':_0x4f6c99(0x176)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x39d665[_0x4f6c99(0xc4)]>0x0)_0x1685bd=_0x39d665;else _0x35be3[_0x4f6c99(0xc4)]>0x0&&(_0x1685bd=_0x35be3);_0x47254f[_0x4f6c99(0xf4)](_0x1685bd);}),router[a0_0x13a685(0x1b6)](a0_0x13a685(0x1a2),async(_0x3616d8,_0xd80e5)=>{var _0x3e92f0=a0_0x13a685;const {primaryCode:_0x469cd8,secondaryCode:_0x734bc,productCode:_0x5136db,bay:_0x3e346a,bin:_0x18ff92,types:_0x3fd87e,pallet:_0x25073a,warehouses:_0x3c3fa0,room:_0x449c4d}=_0x3616d8[_0x3e92f0(0xe0)];console['log'](_0x3616d8['body']);try{const _0x4fbc50=await warehouse[_0x3e92f0(0x157)]([{'$match':{'name':_0x3c3fa0,'room':_0x449c4d}},{'$unwind':_0x3e92f0(0xba)},{'$match':{'product_details.bay':_0x3e346a,'product_details.bin':_0x18ff92,'product_details.type':_0x3fd87e}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3e92f0(0x16c)},'product_stock':{'$first':_0x3e92f0(0x13b)},'level':{'$first':_0x3e92f0(0x136)},'isle':{'$first':_0x3e92f0(0xf5)},'pallet':{'$first':_0x3e92f0(0x144)},'maxProducts':{'$first':_0x3e92f0(0x1ac)}}}]);_0xd80e5[_0x3e92f0(0x151)](0xc8)[_0x3e92f0(0xf4)](_0x4fbc50);}catch(_0x1d1a74){_0xd80e5[_0x3e92f0(0x151)](0x194)[_0x3e92f0(0xf4)]({'message':_0x1d1a74[_0x3e92f0(0x138)]});}}),module[a0_0x13a685(0x1c8)]=router;