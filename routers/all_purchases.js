var a0_0x36fdb1=a0_0x12e5;function a0_0x12e5(_0x401111,_0x417ab9){var _0x44d04f=a0_0x44d0();return a0_0x12e5=function(_0x12e539,_0x42ae8a){_0x12e539=_0x12e539-0xf1;var _0xd1337f=_0x44d04f[_0x12e539];return _0xd1337f;},a0_0x12e5(_0x401111,_0x417ab9);}function a0_0x44d0(){var _0x4dd842=['$secondary_code','/all_purchases/view/','../models/all_models','catch','Router','$unit','Ambient','foreach\x20newproduct','product_code','random','$secondary_unit','$product','/view/return_purchase/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.type','</tbody>','1130jPgwCL','rack','Level','language','$product_details.rack','7JaUVwx','room','params','suppliers_docs','/view/add_purchases/:id','abs','primary_code','length','prod_name','pallet','English\x20(US)','$invoice','$alertquantity','<h5\x20style=\x22text-align:\x20left;\x22>','9148964JnwqHB','Shelves','Enclosed','$product_details.maxProducts','site_title','production_date','image','stock_data','$return_data','maxperunit','save','alertQTY','error','payment\x20successfull','Rack\x20D','rak','purchase\x20data\x20update\x20successfully','$primary_code','$product.type','DRY\x20STORAGE','Rack\x20F','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','push','prod_primunit','delivery_code','paid_amount','purchase_quantity','Purchase\x20Return\x20Mail','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_pallet','render','string','table\x20page','Return\x20Goods','Portuguese','prod_secondunit','name','bin','currency','/view/:id','max_product_unit','getMonth','$_id','role','MaxStocks_data','$product_details.expiry_date','</tr>','stock_quantity','status','then','return_qty','prod_invoice','$note','$batch_code','json','$brand','</thead>','findOne','True','<strong>\x20Regards\x20</strong>','$product_details.product_code','purchase_invoice','<!DOCTYPE\x20html>','expiry_date','product_code_hide','Arabic','$category','<h5>','Hindi','RoomAssign','<tr>','$product.floorlevel','batch_code','$product_details.storage','product_name','INC-','password','storage','gmail','/view','return_purchase','9XJqASq','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.pallet','$expiry_date','$paid_amount','logo','stocks','prod_code','sendMail','91454iCxbjd','flash','get','English','add_purchases','</body></html>','staff','$suppliers','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</table>','Paid\x20For\x20Purchase','edit_purchases_view','$suppliers_docs','POnumber','maxStocks','createTransport','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product.quantity','Room_name','/../public','port','$maxStocks','prod_cat','type','991206bKDGDQ','secondary_code_hide','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','host','3525896mEkSSA','<div>','</td>','edit_purchases','findById','$product_details.secondary_code','note','$product_code','types','prod_isle','log','success','/give_payment/:id','/invoice/:id','Rack\x20E','aggregate','$product_details.isle','$product_details.primary_code','floor','Enabled','concat','slice','Email\x20sent\x20successfully','/upload/','Portuguese\x20(BR)','/view/add_purchases','$product_details','return_data','German','4059Rrmfzp','user','$product_details.product_stock','primary_code_hide','$product_details.floorlevel','<hr\x20class=\x22my-3\x22>','level','secondary_unit','prod_qty','<h2>\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$maxProdPerUnit','51183XRZQPm','invoice','forEach','$product.bay','Chinese','deliverycode','Floor','padStart','Spanish','body','purchases\x20item\x20return\x20successfull','prod_level','map','Arabic\x20(ae)','quantity','master','Rack\x20A','$name','\x20<>\x20','$warehouse_name','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','message','bay','\x20Order\x20Number\x20:\x20','RMSEmail','suppliers','all','</head><body>','$room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</div>','<span\x20style=\x22float:\x20right;\x22>','\x20Order\x20Date\x20:\x20','../middleware/auth','$product_details.level','add_purchases\x20error','692JWbDQU','$product_details._id','Error\x20Occurs','prod_Qty','/all_purchases/view','getDate','$due_amount','6450xMlunS','$product_details.bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','errors','isle','<tbody\x20style=\x22text-align:\x20center;\x22>','Raw\x20Materials','redirect','JO_number','post','</h5>','/preview/:id','$product_details.product_name','<html><head><title></title>','here','12TmXaAh','product_details','$date','date','find','An\x20error\x20occurred.','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','French','ejs','Rack\x20B','product_stock','warehouse_name','room_name','back','secondary_code','product','actual_qty','\x20<\x20wew\x20>\x20','standard_unit','floorlevel','delivery_date','warehouse','Logo.png','exports','Purchase\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','filter','\x20</h2>','actual_uom','Receiving\x20Area','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'];a0_0x44d0=function(){return _0x4dd842;};return a0_0x44d0();}(function(_0x573b2d,_0x5cae06){var _0x232bce=a0_0x12e5,_0x34e603=_0x573b2d();while(!![]){try{var _0x50cb1e=parseInt(_0x232bce(0x133))/0x1+parseInt(_0x232bce(0x20c))/0x2*(parseInt(_0x232bce(0x203))/0x3)+-parseInt(_0x232bce(0x158))/0x4*(-parseInt(_0x232bce(0x15f))/0x5)+-parseInt(_0x232bce(0x106))/0x6*(-parseInt(_0x232bce(0x1a2))/0x7)+parseInt(_0x232bce(0x10a))/0x8+-parseInt(_0x232bce(0x127))/0x9*(-parseInt(_0x232bce(0x19d))/0xa)+-parseInt(_0x232bce(0x1b0))/0xb*(parseInt(_0x232bce(0x16e))/0xc);if(_0x50cb1e===_0x5cae06)break;else _0x34e603['push'](_0x34e603['shift']());}catch(_0x496030){_0x34e603['push'](_0x34e603['shift']());}}}(a0_0x44d0,0x39ca7));const express=require('express'),app=express(),router=express[a0_0x36fdb1(0x191)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x36fdb1(0x18f)),auth=require(a0_0x36fdb1(0x155)),nodemailer=require('nodemailer');var ejs=require(a0_0x36fdb1(0x176));const path=require('path'),users=require('../public/language/languages.json');router['get'](a0_0x36fdb1(0x201),auth,async(_0x6ef342,_0xf1c17e)=>{var _0x4fcd16=a0_0x36fdb1;try{const {username:_0x3f535f,email:_0x9b8cbf,role:_0x180ec1}=_0x6ef342['user'],_0x15b44f=_0x6ef342[_0x4fcd16(0x128)],_0x400cbd=await profile['findOne']({'email':_0x15b44f[_0x4fcd16(0x1c5)]}),_0x10d784=await staff[_0x4fcd16(0x1eb)]({'email':_0x15b44f[_0x4fcd16(0x1c5)]});if(_0x15b44f[_0x4fcd16(0x1dd)]==_0x4fcd16(0xf1)){const _0x58f071=await staff['findOne']({'email':_0x15b44f[_0x4fcd16(0x1c5)]});}const _0x2a3f14=await master_shop[_0x4fcd16(0x172)]();let _0x57650a;if(_0x15b44f[_0x4fcd16(0x1dd)]==_0x4fcd16(0xf1)){const _0xaae32d=await staff['findOne']({'email':_0x15b44f['email']});_0x57650a=await purchases[_0x4fcd16(0x119)]([{'$match':{'warehouse_name':_0xaae32d[_0x4fcd16(0x183)]}},{'$lookup':{'from':_0x4fcd16(0x14d),'localField':_0x4fcd16(0x14d),'foreignField':_0x4fcd16(0x1d6),'as':'suppliers_docs'}},{'$unwind':_0x4fcd16(0xf8)},{'$unwind':'$product'},{'$group':{'_id':_0x4fcd16(0x1dc),'invoice':{'$first':_0x4fcd16(0x1ad)},'suppliers':{'$first':_0x4fcd16(0xf2)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4fcd16(0x146)},'room':{'$first':_0x4fcd16(0x150)},'product':{'$push':'$product'},'note':{'$first':_0x4fcd16(0x1e6)},'paid_amount':{'$first':_0x4fcd16(0x207)},'due_amount':{'$first':_0x4fcd16(0x15e)},'return_data':{'$first':_0x4fcd16(0x1b8)},'batch_code':{'$first':_0x4fcd16(0x1e7)},'expiry_date':{'$first':_0x4fcd16(0x206)},'suppliers_docs':{'$first':_0x4fcd16(0xf8)},'total_product_quantity':{'$sum':_0x4fcd16(0xff)},'level':{'$addToSet':_0x4fcd16(0x136)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x4fcd16(0x1f9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x57650a=await purchases[_0x4fcd16(0x119)]([{'$lookup':{'from':_0x4fcd16(0x14d),'localField':_0x4fcd16(0x14d),'foreignField':_0x4fcd16(0x1d6),'as':_0x4fcd16(0x1a5)}},{'$unwind':_0x4fcd16(0xf8)},{'$unwind':'$product'},{'$group':{'_id':_0x4fcd16(0x1dc),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4fcd16(0xf2)},'date':{'$first':_0x4fcd16(0x170)},'warehouse_name':{'$first':_0x4fcd16(0x146)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x4fcd16(0x198)},'note':{'$first':_0x4fcd16(0x1e6)},'paid_amount':{'$first':_0x4fcd16(0x207)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4fcd16(0x1e7)},'expiry_date':{'$first':_0x4fcd16(0x206)},'suppliers_docs':{'$first':_0x4fcd16(0xf8)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4fcd16(0x136)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4fcd16(0x1c2)},'floorlevel':{'$addToSet':_0x4fcd16(0x1f9)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2a3f14[0x0]['language']==_0x4fcd16(0x1ac)){var _0x1b8b9c=users[_0x4fcd16(0x20f)];console[_0x4fcd16(0x114)](_0x1b8b9c);}else{if(_0x2a3f14[0x0][_0x4fcd16(0x1a0)]==_0x4fcd16(0x1f6))var _0x1b8b9c=users['Hindi'];else{if(_0x2a3f14[0x0][_0x4fcd16(0x1a0)]=='German')var _0x1b8b9c=users[_0x4fcd16(0x126)];else{if(_0x2a3f14[0x0][_0x4fcd16(0x1a0)]==_0x4fcd16(0x13b))var _0x1b8b9c=users[_0x4fcd16(0x13b)];else{if(_0x2a3f14[0x0]['language']=='French')var _0x1b8b9c=users[_0x4fcd16(0x175)];else{if(_0x2a3f14[0x0][_0x4fcd16(0x1a0)]==_0x4fcd16(0x122))var _0x1b8b9c=users['Portuguese'];else{if(_0x2a3f14[0x0][_0x4fcd16(0x1a0)]==_0x4fcd16(0x137))var _0x1b8b9c=users[_0x4fcd16(0x137)];else{if(_0x2a3f14[0x0][_0x4fcd16(0x1a0)]=='Arabic\x20(ae)')var _0x1b8b9c=users[_0x4fcd16(0x1f3)];}}}}}}}_0xf1c17e[_0x4fcd16(0x1d0)]('all_purchases',{'success':_0x6ef342[_0x4fcd16(0x20d)](_0x4fcd16(0x115)),'errors':_0x6ef342[_0x4fcd16(0x20d)](_0x4fcd16(0x162)),'purchases':_0x57650a,'role':_0x15b44f,'profile':_0x400cbd,'master_shop':_0x2a3f14,'language':_0x1b8b9c});}catch(_0x36060c){console['log'](_0x4fcd16(0x1d2),_0x36060c),_0xf1c17e['status'](0xc8)[_0x4fcd16(0x1e8)]({'message':_0x36060c[_0x4fcd16(0x149)]});}});function BayBinSelected(_0x1d66ba,_0x329f80){var _0x5e8bcb=a0_0x36fdb1,_0x3dc5f7=[],_0x2b4aa6=[],_0x39e19d=[],_0x3faae8=[],_0x1933f4=[],_0x2d5dc2=[];let _0xcfa453=[];if(_0x1d66ba==_0x5e8bcb(0x1c3))switch(_0x329f80){case _0x5e8bcb(0x143):_0x3dc5f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2b4aa6=[0x1,0x2],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x19f),_0x5e8bcb(0x139)],_0x1933f4=['D'],_0x2d5dc2=['A'];break;case _0x5e8bcb(0x177):_0x3dc5f7=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2b4aa6=[0x1,0x2],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x19f),'Floor'],_0x1933f4=['D'],_0x2d5dc2=['B'];break;case _0x5e8bcb(0x1b1):_0x3dc5f7=[0x0],_0x2b4aa6=[0x0],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x139)],_0x1933f4=['D'],_0x2d5dc2=['S'];break;case _0x5e8bcb(0x18b):_0x3dc5f7=[0x0],_0x2b4aa6=[0x0],_0x3faae8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x39e19d=[_0x5e8bcb(0x139)],_0x1933f4=['D'],_0x2d5dc2=['R'];break;}else{if(_0x1d66ba=='COLD\x20STORAGE')switch(_0x329f80){case _0x5e8bcb(0x143):_0x3dc5f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2b4aa6=['B','F'],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x19f),_0x5e8bcb(0x139)],_0x1933f4=['C'],_0x2d5dc2=['A'];break;case _0x5e8bcb(0x177):_0x3dc5f7=[0x5,0x4,0x3,0x2,0x1],_0x2b4aa6=['F','B','S'],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x19f),_0x5e8bcb(0x139)],_0x1933f4=['C'],_0x2d5dc2=['B'];break;case'Rack\x20C':_0x3dc5f7=[0x1,0x2,0x3,0x4,0x5],_0x2b4aa6=['B','F','S'],_0x3faae8=[0x5,0x4,0x3,0x2,0x1],_0x39e19d=[_0x5e8bcb(0x19f),_0x5e8bcb(0x139)],_0x1933f4=['C'],_0x2d5dc2=['C'];break;case _0x5e8bcb(0x1be):_0x3dc5f7=[0x5,0x4,0x3,0x2,0x1],_0x2b4aa6=['F','B','S'],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x19f),_0x5e8bcb(0x139)],_0x1933f4=['C'],_0x2d5dc2=['D'];break;case _0x5e8bcb(0x118):_0x3dc5f7=[0x4,0x3,0x2,0x1],_0x2b4aa6=[0x1,0x2],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=['Level',_0x5e8bcb(0x139)],_0x1933f4=['C'],_0x2d5dc2=['E'];break;case _0x5e8bcb(0x1c4):_0x3dc5f7=[0x1,0x2,0x3],_0x2b4aa6=[0x1,0x2],_0x3faae8=[0x1,0x2,0x3,0x4,0x5],_0x39e19d=[_0x5e8bcb(0x19f)],_0x1933f4=['C'],_0x2d5dc2=['F'];break;}}return{'levels':_0x3dc5f7,'Isle':_0x2b4aa6,'rack':_0x3faae8,'type':_0x39e19d,'storage':_0x1933f4,'rak':_0x2d5dc2};}async function getRandom8DigitNumber(){var _0x4f039f=a0_0x36fdb1;const _0x361107=0x989680,_0x139a01=0x5f5e0ff,_0x3529d7=Math[_0x4f039f(0x11c)](Math[_0x4f039f(0x196)]()*(_0x139a01-_0x361107+0x1))+_0x361107;var _0x5e5577;const _0x489118=await purchases['findOne']({'invoice':_0x4f039f(0x1fd)+_0x3529d7});return _0x489118&&_0x489118[_0x4f039f(0x1a9)]>0x0?_0x5e5577='INC-'+_0x3529d7:_0x5e5577='INC-'+_0x3529d7,_0x5e5577;}router[a0_0x36fdb1(0x20e)](a0_0x36fdb1(0x123),auth,async(_0x2064ee,_0x3f9720)=>{var _0xcc7f47=a0_0x36fdb1;try{const {username:_0x4c01f1,email:_0x50d8c7,role:_0x251795}=_0x2064ee[_0xcc7f47(0x128)],_0x42cef6=_0x2064ee[_0xcc7f47(0x128)],_0x582f09=await profile[_0xcc7f47(0x1eb)]({'email':_0x42cef6[_0xcc7f47(0x1c5)]}),_0x23088e=await master_shop['find'](),_0x351551=await staff[_0xcc7f47(0x1eb)]({'email':_0x42cef6[_0xcc7f47(0x1c5)]}),_0xb70b46=await suppliers[_0xcc7f47(0x172)]({});let _0x4a2e20;if(_0x42cef6[_0xcc7f47(0x1dd)]==_0xcc7f47(0xf1)){const _0xf4e380=await staff['findOne']({'email':_0x42cef6[_0xcc7f47(0x1c5)]});_0x4a2e20=await warehouse[_0xcc7f47(0x119)]([{'$match':{'status':_0xcc7f47(0x11d),'name':_0xf4e380['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0xcc7f47(0x144),'name':{'$first':_0xcc7f47(0x144)}}}]);}else _0x4a2e20=await warehouse['aggregate']([{'$match':{'status':_0xcc7f47(0x11d),'warehouse_category':_0xcc7f47(0x165),'name':{'$ne':_0xcc7f47(0x1d3)}}},{'$group':{'_id':_0xcc7f47(0x144),'name':{'$first':_0xcc7f47(0x144)}}}]);const _0x4c9ee4=await product[_0xcc7f47(0x172)]({}),_0x172c20=await warehouse[_0xcc7f47(0x172)]({'status':_0xcc7f47(0x11d)}),_0x95aeb4=await purchases['find']({}),_0x264528=_0x95aeb4[_0xcc7f47(0x1a9)]+0x1,_0x12fec7='INC-'+_0x264528['toString']()[_0xcc7f47(0x13a)](0x5,'0');var _0x2a6291=[_0xcc7f47(0x193),_0xcc7f47(0x1b2)];if(_0x23088e[0x0][_0xcc7f47(0x1a0)]==_0xcc7f47(0x1ac))var _0x2e7dba=users[_0xcc7f47(0x20f)];else{if(_0x23088e[0x0][_0xcc7f47(0x1a0)]=='Hindi')var _0x2e7dba=users['Hindi'];else{if(_0x23088e[0x0][_0xcc7f47(0x1a0)]==_0xcc7f47(0x126))var _0x2e7dba=users[_0xcc7f47(0x126)];else{if(_0x23088e[0x0][_0xcc7f47(0x1a0)]=='Spanish')var _0x2e7dba=users[_0xcc7f47(0x13b)];else{if(_0x23088e[0x0][_0xcc7f47(0x1a0)]==_0xcc7f47(0x175))var _0x2e7dba=users['French'];else{if(_0x23088e[0x0]['language']==_0xcc7f47(0x122))var _0x2e7dba=users[_0xcc7f47(0x1d4)];else{if(_0x23088e[0x0][_0xcc7f47(0x1a0)]==_0xcc7f47(0x137))var _0x2e7dba=users['Chinese'];else{if(_0x23088e[0x0]['language']==_0xcc7f47(0x140))var _0x2e7dba=users[_0xcc7f47(0x1f3)];}}}}}}}const _0x31d5cf=getRandom8DigitNumber();_0x31d5cf[_0xcc7f47(0x1e3)](_0x3b6e11=>{var _0x85c252=_0xcc7f47;_0x3f9720[_0x85c252(0x1d0)](_0x85c252(0x210),{'success':_0x2064ee['flash'](_0x85c252(0x115)),'errors':_0x2064ee[_0x85c252(0x20d)](_0x85c252(0x162)),'role':_0x42cef6,'profile':_0x582f09,'suppliers':_0xb70b46,'warehouse':_0x4a2e20,'product':_0x4c9ee4,'invoice':_0x3b6e11,'master_shop':_0x23088e,'language':_0x2e7dba,'find_data':_0x172c20,'rooms_data':_0x2a6291});})['catch'](_0x27ac3f=>{var _0x5bfb44=_0xcc7f47;_0x2064ee[_0x5bfb44(0x20d)](_0x5bfb44(0x162),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3f9720['redirect'](_0x5bfb44(0x15c));});}catch(_0x130284){console['log'](_0x130284);}}),router[a0_0x36fdb1(0x20e)](a0_0x36fdb1(0x1a6),auth,async(_0x2eafa9,_0x2fccdf)=>{var _0x46778c=a0_0x36fdb1;try{const _0x303d40=_0x2eafa9[_0x46778c(0x1a4)]['id'];console['log'](_0x303d40);const _0x3921b9=await master_shop[_0x46778c(0x172)]();console[_0x46778c(0x114)](_0x46778c(0x142),_0x3921b9);const _0x33abc7=await product[_0x46778c(0x1eb)]({'name':_0x303d40});console[_0x46778c(0x114)](_0x46778c(0x17d),_0x33abc7),_0x2fccdf['status'](0xc8)[_0x46778c(0x1e8)]({'product_data':_0x33abc7,'master':_0x3921b9});}catch(_0x2189b0){console[_0x46778c(0x114)](_0x46778c(0x157),_0x2189b0);}}),router[a0_0x36fdb1(0x168)](a0_0x36fdb1(0x123),auth,async(_0x25baab,_0x4490d4)=>{var _0x4f464a=a0_0x36fdb1;try{const {invoice:_0x1d3a14,date:_0xc3f84d,warehouse_name:_0x5f88b2,prod_name:_0x4c5b80,prod_code:_0x564029,prod_qty:_0x21edf4,prod_unit:_0x179e3c,prod_secondunit:_0x23ff7d,prod_level:_0x1a348c,prod_isle:_0x10c21c,prod_pallet:_0x4cc500,note:_0x1de438,expiry_date:_0x2c4f6b,batch_code:_0x27b2a1,payable:_0x4bc176,due_amount:_0x1d5b24,Room_name:_0x46ef28,primary_code:_0x17481c,secondary_code:_0x4fc550,MaxStocks_data:_0x2a636c,PO_number:_0x1081f9,SCRN:_0x1562e6,JO_number:_0x2af983}=_0x25baab[_0x4f464a(0x13c)];if(typeof _0x4c5b80==_0x4f464a(0x1d1))var _0x479173=[_0x25baab['body'][_0x4f464a(0x1aa)]],_0x3cea53=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x20a)]],_0x292b3e=[_0x25baab[_0x4f464a(0x13c)]['prod_Qty']],_0x4b2b4c=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1c8)]],_0x5ec877=[_0x25baab['body'][_0x4f464a(0x1d5)]],_0x4c193f=[_0x25baab['body'][_0x4f464a(0x13e)]],_0x32c83c=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1a8)]],_0x531160=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x17c)]],_0x2115ca=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1de)]],_0x45e829=[_0x25baab['body'][_0x4f464a(0x1fa)]],_0x2e8c65=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1f1)]],_0x340fe7=[_0x25baab[_0x4f464a(0x13c)]['max_product_unit']],_0x3cccce=[_0x25baab['body'][_0x4f464a(0x1bb)]],_0xff410b=[_0x25baab['body'][_0x4f464a(0x1b5)]],_0x87c38d=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x104)]],_0x4b4af9=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1f7)]],_0x4b9290=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x138)]],_0x4ac2a2=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1e5)]],_0x41a0eb=[_0x25baab['body'][_0x4f464a(0x17e)]],_0x3f3b74=[_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x18a)]];else var _0x479173=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1aa)]],_0x3cea53=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x20a)]],_0x292b3e=[..._0x25baab['body'][_0x4f464a(0x15b)]],_0x4b2b4c=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1c8)]],_0x5ec877=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1d5)]],_0x4c193f=[..._0x25baab[_0x4f464a(0x13c)]['prod_level']],_0x32c83c=[..._0x25baab['body'][_0x4f464a(0x1a8)]],_0x531160=[..._0x25baab['body'][_0x4f464a(0x17c)]],_0x2115ca=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x1de)]],_0x45e829=[..._0x25baab['body']['batch_code']],_0x2e8c65=[..._0x25baab[_0x4f464a(0x13c)]['expiry_date']],_0x340fe7=[..._0x25baab['body'][_0x4f464a(0x1da)]],_0x3cccce=[..._0x25baab['body'][_0x4f464a(0x1bb)]],_0xff410b=[..._0x25baab[_0x4f464a(0x13c)]['production_date']],_0x87c38d=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x104)]],_0x4b4af9=[..._0x25baab['body']['RoomAssign']],_0x4b9290=[..._0x25baab['body'][_0x4f464a(0x138)]],_0x4ac2a2=[..._0x25baab[_0x4f464a(0x13c)]['prod_invoice']],_0x41a0eb=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x17e)]],_0x3f3b74=[..._0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x18a)]];const _0x374377=_0x479173[_0x4f464a(0x13f)](_0x277612=>{return _0x277612={'product_name':_0x277612};});_0x41a0eb['forEach']((_0x54e10f,_0x584c66)=>{_0x374377[_0x584c66]['actual_qty']=Math['abs'](_0x54e10f);}),_0x3f3b74[_0x4f464a(0x135)]((_0x27f97b,_0x5e3a81)=>{var _0x24fbe4=_0x4f464a;_0x374377[_0x5e3a81][_0x24fbe4(0x18a)]=_0x27f97b;}),_0x3cea53['forEach']((_0x18ef45,_0x30d607)=>{_0x374377[_0x30d607]['product_code']=_0x18ef45;}),_0x292b3e['forEach']((_0x2809c3,_0x5e858f)=>{var _0x5e6532=_0x4f464a;_0x374377[_0x5e858f][_0x5e6532(0x141)]=Math[_0x5e6532(0x1a7)](_0x2809c3);}),_0x4b2b4c[_0x4f464a(0x135)]((_0x3258d9,_0x4fba73)=>{_0x374377[_0x4fba73]['standard_unit']=_0x3258d9;}),_0x5ec877[_0x4f464a(0x135)]((_0x1dcdbc,_0x25bbfe)=>{var _0x4ad0af=_0x4f464a;_0x374377[_0x25bbfe][_0x4ad0af(0x12e)]=_0x1dcdbc;}),_0x4c193f[_0x4f464a(0x135)]((_0x4b0784,_0x23a550)=>{var _0x300c3e=_0x4f464a;_0x4b4af9[_0x300c3e(0x135)]((_0x5b9ac9,_0x3b9a5f)=>{var _0x158965=_0x300c3e;if(_0x5b9ac9==_0x158965(0x18b)&&_0x23a550==_0x3b9a5f){console['log'](_0x5b9ac9+_0x158965(0x17f)+_0x23a550+'\x20<>\x20'+_0x3b9a5f+'\x20<>\x20'+_0x4b0784);var _0x2c9ca8=_0x4b0784['slice'](0x3);_0x374377[_0x23a550][_0x158965(0x1ff)]=_0x4b0784[0x0],_0x374377[_0x23a550]['rack']=_0x4b0784[0x1],_0x374377[_0x23a550][_0x158965(0x14a)]=0x0,_0x374377[_0x23a550][_0x158965(0x1d7)]=0x0,_0x374377[_0x23a550][_0x158965(0x105)]=_0x158965(0x139),_0x374377[_0x23a550]['floorlevel']=_0x2c9ca8;}else{if(_0x5b9ac9==_0x158965(0x1b1)&&_0x23a550==_0x3b9a5f){var _0x2c9ca8=_0x4b0784[_0x158965(0x11f)](0x3);_0x374377[_0x23a550][_0x158965(0x1ff)]=_0x4b0784[0x0],_0x374377[_0x23a550][_0x158965(0x19e)]=_0x4b0784[0x1],_0x374377[_0x23a550][_0x158965(0x14a)]=0x0,_0x374377[_0x23a550][_0x158965(0x1d7)]=0x0,_0x374377[_0x23a550][_0x158965(0x105)]=_0x158965(0x139),_0x374377[_0x23a550]['floorlevel']=_0x4b0784[0x5];}else{if(_0x23a550==_0x3b9a5f){if(_0x4b0784[0x0]=='A'&&_0x4b0784[0x1]=='L'&&_0x4b0784[0x2]=='L')console[_0x158965(0x114)](_0x5b9ac9+'\x20<>\x20'+_0x23a550+_0x158965(0x145)+_0x3b9a5f+_0x158965(0x145)+_0x4b0784+_0x158965(0x16d)),_0x374377[_0x23a550][_0x158965(0x1ff)]=_0x4b0784[0x0],_0x374377[_0x23a550][_0x158965(0x19e)]=_0x4b0784[0x1],_0x374377[_0x23a550][_0x158965(0x14a)]=0x0,_0x374377[_0x23a550][_0x158965(0x1d7)]=0x0,_0x374377[_0x23a550][_0x158965(0x105)]=_0x158965(0x139),_0x374377[_0x23a550][_0x158965(0x181)]=_0x4b0784[0x3];else{var _0x4ce06a;if(_0x4b0784[0x4]=='L')_0x4ce06a=_0x158965(0x19f);else _0x4b0784[0x4]=='F'&&(_0x4ce06a=_0x158965(0x139));_0x374377[_0x23a550][_0x158965(0x1ff)]=_0x4b0784[0x0],_0x374377[_0x23a550][_0x158965(0x19e)]=_0x4b0784[0x1],_0x374377[_0x23a550][_0x158965(0x14a)]=_0x4b0784[0x2],_0x374377[_0x23a550]['bin']=_0x4b0784[0x3],_0x374377[_0x23a550][_0x158965(0x105)]=_0x4ce06a,_0x374377[_0x23a550][_0x158965(0x181)]=_0x4b0784[0x5];}}}}});}),_0x32c83c['forEach']((_0x448c2b,_0x1de583)=>{_0x374377[_0x1de583]['primary_code']=_0x448c2b;}),_0x531160['forEach']((_0x528668,_0x4e1b32)=>{_0x374377[_0x4e1b32]['secondary_code']=_0x528668;}),_0x2115ca['forEach']((_0xaa4e6f,_0x5b0ba3)=>{var _0x2b2ab7=_0x4f464a;_0x374377[_0x5b0ba3][_0x2b2ab7(0xfa)]=_0xaa4e6f;}),_0x45e829[_0x4f464a(0x135)]((_0x3e4311,_0x32600e)=>{var _0x16e4e7=_0x4f464a;_0x374377[_0x32600e][_0x16e4e7(0x1fa)]=_0x3e4311;}),_0x2e8c65[_0x4f464a(0x135)]((_0x29b488,_0x48d686)=>{_0x374377[_0x48d686]['expiry_date']=_0x29b488;}),_0x340fe7[_0x4f464a(0x135)]((_0x114a50,_0x18b999)=>{var _0x256547=_0x4f464a;_0x374377[_0x18b999][_0x256547(0x1b9)]=_0x114a50;}),_0x3cccce['forEach']((_0x5d7872,_0x3b56b8)=>{_0x374377[_0x3b56b8]['alertQTY']=_0x5d7872;}),_0xff410b[_0x4f464a(0x135)]((_0x5d2baf,_0x1e6fe5)=>{var _0x458818=_0x4f464a;_0x374377[_0x1e6fe5][_0x458818(0x1b5)]=_0x5d2baf;}),_0x87c38d['forEach']((_0x25ca2f,_0xf15630)=>{_0x374377[_0xf15630]['product_cat']=_0x25ca2f;}),_0x4b4af9['forEach']((_0x12c751,_0x5e4b5b)=>{_0x374377[_0x5e4b5b]['room_name']=_0x12c751;}),_0x4b9290['forEach']((_0x52bec2,_0xe5598a)=>{var _0x52f049=_0x4f464a;_0x374377[_0xe5598a][_0x52f049(0x1c9)]=_0x52bec2;}),_0x4ac2a2[_0x4f464a(0x135)]((_0x3653c7,_0x2efcfc)=>{_0x374377[_0x2efcfc]['invoice']=_0x3653c7;});const _0x459970=_0x4b4af9[_0x4f464a(0x13f)](_0x5edc79=>{return _0x5edc79={'room_name':_0x5edc79};}),_0x2066dc=_0x374377['filter'](_0x46efcf=>_0x46efcf['quantity']!=='0'&&_0x46efcf[_0x4f464a(0x141)]!==''),_0x2989e4=new purchases({'invoice':_0x1d3a14,'suppliers':_0x25baab[_0x4f464a(0x13c)][_0x4f464a(0x14d)],'date':_0xc3f84d,'warehouse_name':_0x5f88b2,'product':_0x2066dc,'note':_0x1de438,'due_amount':_0x1d5b24,'POnumber':_0x1081f9,'SCRN':_0x1562e6,'JO_number':_0x2af983,'roomList':_0x459970}),_0x29b5ce=await _0x2989e4[_0x4f464a(0x1ba)](),_0x469a7d=await purchases[_0x4f464a(0x1eb)]({'invoice':_0x1d3a14}),_0x4e571a=_0x469a7d[_0x4f464a(0x17d)][_0x4f464a(0x13f)](async _0x1a7954=>{var _0x311ae6=_0x4f464a,_0x20040c=await warehouse[_0x311ae6(0x1eb)]({'name':_0x5f88b2,'room':_0x1a7954[_0x311ae6(0x17a)]}),_0x51cb11=0x0;return _0x20040c[_0x311ae6(0x16f)][_0x311ae6(0x135)](_0x4c6b87=>{var _0x5ed0e2=_0x311ae6;_0x4c6b87['product_name']==_0x1a7954['product_name']&&_0x4c6b87[_0x5ed0e2(0x181)]==_0x1a7954[_0x5ed0e2(0x181)]&&_0x4c6b87[_0x5ed0e2(0x105)]==_0x1a7954['type']&&_0x4c6b87['bin']==_0x1a7954[_0x5ed0e2(0x1d7)]&&_0x4c6b87['bay']==_0x1a7954[_0x5ed0e2(0x14a)]&&_0x4c6b87['rack']==_0x1a7954[_0x5ed0e2(0x19e)]&&_0x4c6b87['storage']==_0x1a7954[_0x5ed0e2(0x1ff)]&&_0x4c6b87[_0x5ed0e2(0x1f1)]==_0x1a7954[_0x5ed0e2(0x1f1)]&&_0x4c6b87[_0x5ed0e2(0x1fa)]==_0x1a7954['batch_code']&&_0x4c6b87[_0x5ed0e2(0x1b5)]==_0x1a7954[_0x5ed0e2(0x1b5)]&&_0x4c6b87[_0x5ed0e2(0x134)]==_0x469a7d[_0x5ed0e2(0x134)]&&(_0x4c6b87[_0x5ed0e2(0x178)]+=Math[_0x5ed0e2(0x1a7)](_0x1a7954[_0x5ed0e2(0x141)]),_0x51cb11++);}),_0x51cb11===0x0&&_0x20040c[_0x311ae6(0x16f)][_0x311ae6(0x1c7)]({'product_name':_0x1a7954[_0x311ae6(0x1fc)],'product_stock':Math[_0x311ae6(0x1a7)](_0x1a7954[_0x311ae6(0x141)]),'primary_code':_0x1a7954[_0x311ae6(0x1a8)],'secondary_code':_0x1a7954[_0x311ae6(0x17c)],'product_code':_0x1a7954[_0x311ae6(0x195)],'storage':_0x1a7954[_0x311ae6(0x1ff)],'rack':_0x1a7954[_0x311ae6(0x19e)],'bay':_0x1a7954[_0x311ae6(0x14a)],'bin':_0x1a7954['bin'],'type':_0x1a7954[_0x311ae6(0x105)],'floorlevel':_0x1a7954[_0x311ae6(0x181)],'maxProducts':_0x1a7954['maxStocks'],'unit':_0x1a7954[_0x311ae6(0x180)],'secondary_unit':_0x1a7954['secondary_unit'],'expiry_date':_0x1a7954[_0x311ae6(0x1f1)],'maxPerUnit':_0x1a7954[_0x311ae6(0x1b9)],'batch_code':_0x1a7954[_0x311ae6(0x1fa)],'alertQTY':_0x1a7954[_0x311ae6(0x1bb)],'production_date':_0x1a7954[_0x311ae6(0x1b5)],'product_cat':_0x1a7954['product_cat'],'invoice':_0x1a7954[_0x311ae6(0x134)],'actual_qty':Math[_0x311ae6(0x1a7)](_0x1a7954[_0x311ae6(0x17e)]),'actual_uom':_0x1a7954[_0x311ae6(0x18a)]}),_0x20040c;});Promise[_0x4f464a(0x14e)](_0x4e571a)[_0x4f464a(0x1e3)](async _0x5c17d4=>{var _0xd14bd9=_0x4f464a;try{for(const _0x3ab1d0 of _0x5c17d4){await _0x3ab1d0[_0xd14bd9(0x1ba)]();}const _0x2966ca=await master_shop[_0xd14bd9(0x172)](),_0x550882=await email_settings[_0xd14bd9(0x1eb)](),_0x2bbb44=await supervisor_settings[_0xd14bd9(0x172)]();var _0x59edbc=_0x469a7d[_0xd14bd9(0x17d)],_0x244d1e='',_0x4d17c3;for(_0x4d17c3 in _0x59edbc){_0x244d1e+=_0xd14bd9(0x1f8)+_0xd14bd9(0x108)+_0x59edbc[_0x4d17c3][_0xd14bd9(0x1fc)]+_0xd14bd9(0x10c)+_0xd14bd9(0x108)+_0x59edbc[_0x4d17c3]['product_code']+_0xd14bd9(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59edbc[_0x4d17c3][_0xd14bd9(0x141)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59edbc[_0x4d17c3][_0xd14bd9(0x180)]+_0xd14bd9(0x10c)+_0xd14bd9(0x108)+_0x59edbc[_0x4d17c3][_0xd14bd9(0x12e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x469a7d[_0xd14bd9(0x179)]+_0xd14bd9(0x10c)+_0xd14bd9(0x108)+_0x59edbc[_0x4d17c3][_0xd14bd9(0x17a)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59edbc[_0x4d17c3]['storage']+_0x59edbc[_0x4d17c3][_0xd14bd9(0x19e)]+_0x59edbc[_0x4d17c3][_0xd14bd9(0x14a)]+_0x59edbc[_0x4d17c3][_0xd14bd9(0x1d7)]+_0x59edbc[_0x4d17c3][_0xd14bd9(0x105)][0x0]+_0x59edbc[_0x4d17c3][_0xd14bd9(0x181)]+_0xd14bd9(0x10c),_0xd14bd9(0x1e0);}let _0x2be80f=nodemailer[_0xd14bd9(0xfb)]({'host':_0x550882[_0xd14bd9(0x109)],'port':Number(_0x550882[_0xd14bd9(0x102)]),'secure':![],'auth':{'user':_0x550882[_0xd14bd9(0x1c5)],'pass':_0x550882[_0xd14bd9(0x1fe)]}}),_0x3d52d6={'from':_0x550882[_0xd14bd9(0x1c5)],'to':_0x2bbb44[0x0][_0xd14bd9(0x14c)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0xd14bd9(0x184),'path':__dirname+'/../public'+_0xd14bd9(0x121)+_0x2966ca[0x0]['image'],'cid':_0xd14bd9(0x208)}],'html':_0xd14bd9(0x1f0)+_0xd14bd9(0x16c)+_0xd14bd9(0x14f)+_0xd14bd9(0x10b)+_0xd14bd9(0x131)+_0xd14bd9(0x10b)+_0xd14bd9(0xf3)+_0xd14bd9(0x152)+_0xd14bd9(0x10b)+_0xd14bd9(0x130)+_0x2966ca[0x0][_0xd14bd9(0x1b4)]+_0xd14bd9(0x189)+'</div>'+_0xd14bd9(0x152)+_0xd14bd9(0x12c)+'<div>'+_0xd14bd9(0x1af)+_0xd14bd9(0x14b)+_0x469a7d[_0xd14bd9(0x134)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xd14bd9(0x154)+_0x469a7d[_0xd14bd9(0x171)]+'\x20'+_0xd14bd9(0x1cd)+_0xd14bd9(0x169)+_0xd14bd9(0x152)+_0xd14bd9(0x161)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xd14bd9(0x1f8)+_0xd14bd9(0x187)+_0xd14bd9(0x1ce)+_0xd14bd9(0x18c)+_0xd14bd9(0x204)+_0xd14bd9(0x1c6)+_0xd14bd9(0x148)+_0xd14bd9(0xfe)+_0xd14bd9(0x151)+'</tr>'+'</thead>'+_0xd14bd9(0x164)+'\x20'+_0x244d1e+'\x20'+_0xd14bd9(0x19c)+_0xd14bd9(0xf5)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0xd14bd9(0x1f5)+_0x2966ca[0x0][_0xd14bd9(0x1b4)]+'</h5>'+_0xd14bd9(0x152)+_0xd14bd9(0x152)+_0xd14bd9(0x211)};_0x2be80f['sendMail'](_0x3d52d6,function(_0x46560d,_0x2d4c80){var _0x14cfe4=_0xd14bd9;_0x46560d?(console[_0x14cfe4(0x114)](_0x46560d),console[_0x14cfe4(0x114)]('Error\x20Occurs')):console[_0x14cfe4(0x114)](_0x14cfe4(0x120));}),_0x25baab[_0xd14bd9(0x20d)]('success','Purchase\x20data\x20added\x20successfully'),_0x4490d4['redirect'](_0xd14bd9(0x18e));}catch(_0x8eaa3d){console[_0xd14bd9(0x1bc)](_0x8eaa3d),_0x4490d4['status'](0x1f4)[_0xd14bd9(0x1e8)]({'error':_0xd14bd9(0x19a)});}})[_0x4f464a(0x190)](_0xd8c52b=>{var _0x4589e1=_0x4f464a;console[_0x4589e1(0x1bc)](_0xd8c52b),_0x4490d4[_0x4589e1(0x1e2)](0x1f4)['json']({'error':_0x4589e1(0x173)});});}catch(_0x194e88){console[_0x4f464a(0x114)](_0x194e88);}}),router['get'](a0_0x36fdb1(0x16a),auth,async(_0x2cff98,_0x5991d0)=>{var _0x46cf2e=a0_0x36fdb1;try{const {username:_0x5469c4,email:_0x15b7b5,role:_0x308dbe}=_0x2cff98[_0x46cf2e(0x128)],_0x3cd22f=_0x2cff98[_0x46cf2e(0x128)],_0x38ea09=await profile['findOne']({'email':_0x3cd22f[_0x46cf2e(0x1c5)]}),_0x3921b4=await master_shop[_0x46cf2e(0x172)](),_0x2420e2=_0x2cff98[_0x46cf2e(0x1a4)]['id'],_0x1d8661=await purchases[_0x46cf2e(0x10e)](_0x2420e2),_0x384758=await warehouse[_0x46cf2e(0x119)]([{'$match':{'name':_0x1d8661[_0x46cf2e(0x179)],'room':_0x1d8661['room']}},{'$unwind':_0x46cf2e(0x124)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x46cf2e(0xfc)},'bin':{'$first':_0x46cf2e(0x160)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x46cf2e(0x12b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x46cf2e(0x10f)},'product_code':{'$first':_0x46cf2e(0x1ee)},'storage':{'$first':_0x46cf2e(0x1fb)},'rack':{'$first':_0x46cf2e(0x1a1)},'expiry_date':{'$first':_0x46cf2e(0x1df)}}}]),_0x38b1ff=await customer[_0x46cf2e(0x172)]({});let _0x19af7c;if(_0x3cd22f[_0x46cf2e(0x1dd)]==_0x46cf2e(0xf1)){const _0x1c454a=await staff[_0x46cf2e(0x1eb)]({'email':_0x3cd22f[_0x46cf2e(0x1c5)]});_0x19af7c=await warehouse[_0x46cf2e(0x119)]([{'$match':{'status':_0x46cf2e(0x11d),'name':_0x1c454a['warehouse']}},{'$group':{'_id':_0x46cf2e(0x144),'name':{'$first':_0x46cf2e(0x144)}}}]);}else _0x19af7c=await warehouse['aggregate']([{'$match':{'status':_0x46cf2e(0x11d)}},{'$group':{'_id':_0x46cf2e(0x144),'name':{'$first':_0x46cf2e(0x144)}}}]);const _0x2c35ea=await product[_0x46cf2e(0x172)]({}),_0x241f4d=await suppliers[_0x46cf2e(0x172)]({}),_0x47958a=BayBinSelected(_0x1d8661[_0x46cf2e(0x179)],_0x1d8661['room']);if(_0x3921b4[0x0]['language']==_0x46cf2e(0x1ac)){var _0x5deb83=users[_0x46cf2e(0x20f)];console['log'](_0x5deb83);}else{if(_0x3921b4[0x0][_0x46cf2e(0x1a0)]==_0x46cf2e(0x1f6))var _0x5deb83=users['Hindi'];else{if(_0x3921b4[0x0]['language']==_0x46cf2e(0x126))var _0x5deb83=users['German'];else{if(_0x3921b4[0x0][_0x46cf2e(0x1a0)]==_0x46cf2e(0x13b))var _0x5deb83=users[_0x46cf2e(0x13b)];else{if(_0x3921b4[0x0]['language']=='French')var _0x5deb83=users[_0x46cf2e(0x175)];else{if(_0x3921b4[0x0][_0x46cf2e(0x1a0)]==_0x46cf2e(0x122))var _0x5deb83=users[_0x46cf2e(0x1d4)];else{if(_0x3921b4[0x0][_0x46cf2e(0x1a0)]==_0x46cf2e(0x137))var _0x5deb83=users[_0x46cf2e(0x137)];else{if(_0x3921b4[0x0][_0x46cf2e(0x1a0)]==_0x46cf2e(0x140))var _0x5deb83=users[_0x46cf2e(0x1f3)];}}}}}}}_0x5991d0['render'](_0x46cf2e(0xf7),{'success':_0x2cff98['flash'](_0x46cf2e(0x115)),'errors':_0x2cff98['flash']('errors'),'role':_0x3cd22f,'profile':_0x38ea09,'customer':_0x38b1ff,'warehouse':_0x19af7c,'product':_0x384758,'user':_0x1d8661,'master_shop':_0x3921b4,'unit':_0x2c35ea,'language':_0x5deb83,'suppliers':_0x241f4d,'dataSelected':_0x47958a});}catch(_0x45be02){console[_0x46cf2e(0x114)](_0x45be02);}}),router[a0_0x36fdb1(0x168)](a0_0x36fdb1(0x16a),auth,async(_0x3cf87e,_0x15077a)=>{var _0x5864c5=a0_0x36fdb1;try{const _0x1edf29=_0x3cf87e[_0x5864c5(0x1a4)]['id'],{invoice:_0x28985f,warehouse_name:_0x2bfb62,Room_name:_0x1948b6}=_0x3cf87e[_0x5864c5(0x13c)],_0x4fcb80=await warehouse[_0x5864c5(0x1eb)]({'name':_0x2bfb62,'room':_0x1948b6}),_0x42f20e=await purchases[_0x5864c5(0x1eb)]({'invoice':_0x28985f});_0x42f20e['product']['forEach'](_0x29f6e7=>{var _0x12b636=_0x5864c5,_0x125a9d=0x0;const _0x12869a=_0x4fcb80[_0x12b636(0x16f)]['map'](_0x54d1b8=>{var _0x49e32d=_0x12b636;_0x54d1b8['product_name']==_0x29f6e7[_0x49e32d(0x1fc)]&&_0x54d1b8[_0x49e32d(0x181)]==_0x29f6e7[_0x49e32d(0x181)]&&_0x54d1b8[_0x49e32d(0x105)]==_0x29f6e7[_0x49e32d(0x105)]&&_0x54d1b8[_0x49e32d(0x1d7)]==_0x29f6e7['bin']&&_0x54d1b8[_0x49e32d(0x14a)]==_0x29f6e7['bay']&&_0x54d1b8[_0x49e32d(0x19e)]==_0x29f6e7[_0x49e32d(0x19e)]&&_0x54d1b8[_0x49e32d(0x1ff)]==_0x29f6e7[_0x49e32d(0x1ff)]&&_0x54d1b8[_0x49e32d(0x1f1)]==_0x29f6e7[_0x49e32d(0x1f1)]&&_0x54d1b8['batch_code']==_0x29f6e7[_0x49e32d(0x1fa)]&&_0x54d1b8[_0x49e32d(0x1b5)]==_0x29f6e7[_0x49e32d(0x1b5)]&&_0x54d1b8[_0x49e32d(0x182)]==_0x29f6e7[_0x49e32d(0x182)]&&_0x54d1b8[_0x49e32d(0x1c9)]==_0x29f6e7[_0x49e32d(0x1c9)]&&(_0x54d1b8['product_stock']=parseInt(_0x54d1b8[_0x49e32d(0x178)])+parseInt(_0x29f6e7[_0x49e32d(0x141)]),_0x125a9d++);});_0x125a9d=='0'&&(_0x4fcb80[_0x12b636(0x16f)]=_0x4fcb80[_0x12b636(0x16f)][_0x12b636(0x11e)]({'product_name':_0x29f6e7[_0x12b636(0x1fc)],'product_stock':_0x29f6e7['quantity'],'primary_code':_0x29f6e7[_0x12b636(0x1a8)],'secondary_code':_0x29f6e7[_0x12b636(0x17c)],'product_code':_0x29f6e7[_0x12b636(0x195)],'storage':_0x29f6e7[_0x12b636(0x1ff)],'rack':_0x29f6e7[_0x12b636(0x19e)],'bay':_0x29f6e7[_0x12b636(0x14a)],'bin':_0x29f6e7[_0x12b636(0x1d7)],'type':_0x29f6e7[_0x12b636(0x105)],'floorlevel':_0x29f6e7[_0x12b636(0x181)],'maxProducts':_0x29f6e7[_0x12b636(0xfa)],'unit':_0x29f6e7['standard_unit'],'secondary_unit':_0x29f6e7[_0x12b636(0x12e)],'expiry_date':_0x29f6e7[_0x12b636(0x1f1)],'maxPerUnit':_0x29f6e7[_0x12b636(0x1b9)],'batch_code':_0x29f6e7[_0x12b636(0x1fa)],'alertQTY':_0x29f6e7[_0x12b636(0x1bb)],'production_date':_0x29f6e7['production_date'],'delivery_date':_0x29f6e7['delivery_date'],'delivery_code':_0x29f6e7[_0x12b636(0x1c9)]}));}),await _0x4fcb80[_0x5864c5(0x1ba)](),_0x42f20e['finalize']=_0x5864c5(0x1ec);const _0x3d91f4=await _0x42f20e['save']();_0x3cf87e[_0x5864c5(0x20d)](_0x5864c5(0x115),'Sales\x20Update\x20successfully'),_0x15077a[_0x5864c5(0x166)](_0x5864c5(0x15c));}catch(_0x5b55af){console[_0x5864c5(0x114)](_0x5b55af);}}),router[a0_0x36fdb1(0x20e)](a0_0x36fdb1(0x1d9),auth,async(_0xd02e8d,_0x4a9817)=>{var _0x1d367c=a0_0x36fdb1;try{const {username:_0x50aa80,email:_0x3a99e4,role:_0x3dbcd1}=_0xd02e8d[_0x1d367c(0x128)],_0x5547a0=_0xd02e8d[_0x1d367c(0x128)],_0x447acf=await profile[_0x1d367c(0x1eb)]({'email':_0x5547a0[_0x1d367c(0x1c5)]}),_0x5a9e28=await master_shop[_0x1d367c(0x172)](),_0x5cb5c6=_0xd02e8d[_0x1d367c(0x1a4)]['id'],_0x1d6ca2=await purchases['findById'](_0x5cb5c6),_0x346037=await suppliers[_0x1d367c(0x172)]({});let _0x17efcf;if(_0x5547a0['role']==_0x1d367c(0xf1)){const _0x49a274=await staff[_0x1d367c(0x1eb)]({'email':_0x5547a0[_0x1d367c(0x1c5)]});_0x17efcf=await warehouse['find']({'status':_0x1d367c(0x11d),'name':_0x49a274[_0x1d367c(0x183)],'warehouse_category':_0x1d367c(0x165)});}else _0x17efcf=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x1d367c(0x165)}},{'$group':{'_id':_0x1d367c(0x144),'name':{'$first':_0x1d367c(0x144)}}}]);const _0x526566=await product[_0x1d367c(0x172)]({}),_0x371b39=BayBinSelected(_0x1d6ca2[_0x1d367c(0x179)],_0x1d6ca2[_0x1d367c(0x1a3)]);let _0x16b924=new Date(_0x1d6ca2[_0x1d367c(0x1f1)]),_0x246577=('0'+_0x16b924[_0x1d367c(0x15d)]())[_0x1d367c(0x11f)](-0x2),_0xef8f64=('0'+(_0x16b924[_0x1d367c(0x1db)]()+0x1))[_0x1d367c(0x11f)](-0x2),_0x1a1b49=_0x16b924[_0x1d367c(0x147)](),_0x219788=_0x1a1b49+'-'+_0xef8f64+'-'+_0x246577;if(_0x5a9e28[0x0]['language']=='English\x20(US)'){var _0x45e722=users[_0x1d367c(0x20f)];console[_0x1d367c(0x114)](_0x45e722);}else{if(_0x5a9e28[0x0][_0x1d367c(0x1a0)]==_0x1d367c(0x1f6))var _0x45e722=users['Hindi'];else{if(_0x5a9e28[0x0]['language']=='German')var _0x45e722=users[_0x1d367c(0x126)];else{if(_0x5a9e28[0x0]['language']=='Spanish')var _0x45e722=users[_0x1d367c(0x13b)];else{if(_0x5a9e28[0x0][_0x1d367c(0x1a0)]=='French')var _0x45e722=users[_0x1d367c(0x175)];else{if(_0x5a9e28[0x0][_0x1d367c(0x1a0)]==_0x1d367c(0x122))var _0x45e722=users[_0x1d367c(0x1d4)];else{if(_0x5a9e28[0x0][_0x1d367c(0x1a0)]==_0x1d367c(0x137))var _0x45e722=users[_0x1d367c(0x137)];else{if(_0x5a9e28[0x0][_0x1d367c(0x1a0)]==_0x1d367c(0x140))var _0x45e722=users[_0x1d367c(0x1f3)];}}}}}}}_0x4a9817[_0x1d367c(0x1d0)](_0x1d367c(0x10d),{'success':_0xd02e8d[_0x1d367c(0x20d)](_0x1d367c(0x115)),'errors':_0xd02e8d[_0x1d367c(0x20d)](_0x1d367c(0x162)),'role':_0x5547a0,'profile':_0x447acf,'purchases':_0x1d6ca2,'suppliers':_0x346037,'warehouse':_0x17efcf,'product':_0x526566,'master_shop':_0x5a9e28,'language':_0x45e722,'ed_fullDate':_0x219788,'dataSelected':_0x371b39});}catch(_0x45377b){console['log'](_0x45377b);}}),router[a0_0x36fdb1(0x168)](a0_0x36fdb1(0x1d9),auth,async(_0x336180,_0x2a26b0)=>{var _0x930955=a0_0x36fdb1;try{const _0x2548ef=_0x336180[_0x930955(0x1a4)]['id'],_0x5f4221=await purchases[_0x930955(0x1eb)]({'_id':_0x336180[_0x930955(0x1a4)]['id']}),_0x320376=await warehouse[_0x930955(0x1eb)]({'name':_0x5f4221[_0x930955(0x179)],'room':_0x5f4221[_0x930955(0x1a3)]});_0x5f4221['product']['forEach'](_0x298287=>{var _0x4f9811=_0x930955;const _0x3ef9e8=_0x320376[_0x4f9811(0x16f)][_0x4f9811(0x13f)](_0xf7932e=>{var _0x90c689=_0x4f9811;_0xf7932e['product_name']==_0x298287[_0x90c689(0x1fc)]&&_0xf7932e[_0x90c689(0x181)]==_0x298287[_0x90c689(0x181)]&&_0xf7932e[_0x90c689(0x105)]==_0x298287[_0x90c689(0x105)]&&_0xf7932e[_0x90c689(0x1d7)]==_0x298287['bin']&&_0xf7932e['bay']==_0x298287['bay']&&_0xf7932e[_0x90c689(0x19e)]==_0x298287['rack']&&_0xf7932e[_0x90c689(0x1ff)]==_0x298287[_0x90c689(0x1ff)]&&(_0xf7932e[_0x90c689(0x178)]=parseInt(_0xf7932e['product_stock'])-parseInt(_0x298287[_0x90c689(0x141)]));});}),await _0x320376['save']();const {invoice:_0x37ddd7,suppliers:_0x2e03c1,date:_0x16551b,warehouse_name:_0x5120a6,prod_name:_0x31aec1,prod_code:_0x170560,prod_qty:_0x101d80,prod_unit:_0x5c38ec,prod_secondunit:_0x80ab39,prod_level:_0x1d2f08,prod_isle:_0x345f58,prod_pallet:_0xef9336,note:_0x7a8bd7,expiry_date:_0x22bf7b,batch_code:_0x2d0fe2,paid_amount:_0x5eb66a,due_amount:_0x1f7d1a,Room_name:_0x126a34,primary_code:_0x55a7f7,secondary_code:_0x3544c2,PO_number:_0x57caba,JO_number:_0x2eddb5}=_0x336180['body'];if(typeof _0x31aec1==_0x930955(0x1d1))var _0x189299=[_0x336180[_0x930955(0x13c)]['prod_name']],_0x1d75ed=[_0x336180[_0x930955(0x13c)][_0x930955(0x20a)]],_0x1a2644=[_0x336180[_0x930955(0x13c)][_0x930955(0x12f)]],_0x5c144f=[_0x336180[_0x930955(0x13c)]['prod_unit']],_0x3d7139=[_0x336180[_0x930955(0x13c)][_0x930955(0x1d5)]],_0x40a6f6=[_0x336180[_0x930955(0x13c)][_0x930955(0x13e)]],_0x39a832=[_0x336180[_0x930955(0x13c)][_0x930955(0x113)]],_0x26e4b3=[_0x336180[_0x930955(0x13c)][_0x930955(0x1cf)]],_0x2d24b2=[_0x336180['body'][_0x930955(0x1a8)]],_0x4fd412=[_0x336180['body'][_0x930955(0x17c)]],_0x4c21f1=[_0x336180[_0x930955(0x13c)]['MaxStocks_data']],_0x146a59=[_0x336180['body']['batch_code']],_0x5f19d8=[_0x336180[_0x930955(0x13c)]['expiry_date']],_0x261294=[_0x336180[_0x930955(0x13c)]['storage']],_0x11328a=[_0x336180[_0x930955(0x13c)][_0x930955(0x1bf)]],_0x430b7c=[_0x336180[_0x930955(0x13c)][_0x930955(0x105)]];else var _0x189299=[..._0x336180[_0x930955(0x13c)][_0x930955(0x1aa)]],_0x1d75ed=[..._0x336180[_0x930955(0x13c)][_0x930955(0x20a)]],_0x1a2644=[..._0x336180[_0x930955(0x13c)][_0x930955(0x12f)]],_0x5c144f=[..._0x336180['body']['prod_unit']],_0x3d7139=[..._0x336180['body'][_0x930955(0x1d5)]],_0x40a6f6=[..._0x336180[_0x930955(0x13c)][_0x930955(0x13e)]],_0x39a832=[..._0x336180[_0x930955(0x13c)][_0x930955(0x113)]],_0x26e4b3=[..._0x336180[_0x930955(0x13c)][_0x930955(0x1cf)]],_0x2d24b2=[..._0x336180[_0x930955(0x13c)][_0x930955(0x1a8)]],_0x4fd412=[..._0x336180[_0x930955(0x13c)]['secondary_code']],_0x4c21f1=[..._0x336180[_0x930955(0x13c)][_0x930955(0x1de)]],_0x146a59=[..._0x336180['body'][_0x930955(0x1fa)]],_0x5f19d8=[..._0x336180['body'][_0x930955(0x1f1)]],_0x261294=[..._0x336180['body'][_0x930955(0x1ff)]],_0x11328a=[..._0x336180[_0x930955(0x13c)]['rak']],_0x430b7c=[..._0x336180[_0x930955(0x13c)][_0x930955(0x105)]];const _0x3d77a=_0x189299[_0x930955(0x13f)](_0x3398a1=>{return _0x3398a1={'product_name':_0x3398a1};});_0x1d75ed[_0x930955(0x135)]((_0x46aa1f,_0xee9fe3)=>{_0x3d77a[_0xee9fe3]['product_code']=_0x46aa1f;}),_0x1a2644[_0x930955(0x135)]((_0x54a983,_0x235a55)=>{var _0x246003=_0x930955;_0x3d77a[_0x235a55][_0x246003(0x141)]=_0x54a983;}),_0x5c144f[_0x930955(0x135)]((_0x86331f,_0x1b2672)=>{var _0x9bcd67=_0x930955;_0x3d77a[_0x1b2672][_0x9bcd67(0x180)]=_0x86331f;}),_0x3d7139[_0x930955(0x135)]((_0x4b6dcc,_0x3b77cd)=>{var _0x372042=_0x930955;_0x3d77a[_0x3b77cd][_0x372042(0x12e)]=_0x4b6dcc;}),_0x40a6f6[_0x930955(0x135)]((_0x1053d2,_0x13260d)=>{var _0x5cd7e9=_0x930955;_0x3d77a[_0x13260d][_0x5cd7e9(0x14a)]=_0x1053d2;}),_0x39a832[_0x930955(0x135)]((_0x357b16,_0x18c81b)=>{var _0x233ae6=_0x930955;_0x3d77a[_0x18c81b][_0x233ae6(0x1d7)]=_0x357b16;}),_0x26e4b3[_0x930955(0x135)]((_0x31917d,_0x122bf1)=>{var _0x31ce7e=_0x930955;_0x3d77a[_0x122bf1][_0x31ce7e(0x181)]=_0x31917d;}),_0x2d24b2[_0x930955(0x135)]((_0x564337,_0x5ada4a)=>{var _0x1a046c=_0x930955;_0x3d77a[_0x5ada4a][_0x1a046c(0x1a8)]=_0x564337;}),_0x4fd412['forEach']((_0x127b61,_0x33016b)=>{_0x3d77a[_0x33016b]['secondary_code']=_0x127b61;}),_0x4c21f1[_0x930955(0x135)]((_0x48ca25,_0x586a3e)=>{var _0x1676a9=_0x930955;_0x3d77a[_0x586a3e][_0x1676a9(0xfa)]=_0x48ca25;}),_0x146a59['forEach']((_0x237a81,_0x23ba88)=>{_0x3d77a[_0x23ba88]['batch_code']=_0x237a81;}),_0x5f19d8['forEach']((_0x29a610,_0x1d34dc)=>{var _0x2cc0f1=_0x930955;_0x3d77a[_0x1d34dc][_0x2cc0f1(0x1f1)]=_0x29a610;}),_0x430b7c[_0x930955(0x135)]((_0x148064,_0x41cf1a)=>{var _0x10130a=_0x930955;_0x3d77a[_0x41cf1a][_0x10130a(0x105)]=_0x148064;}),_0x261294[_0x930955(0x135)]((_0x55b0a5,_0xd24b5e)=>{var _0x3244a5=_0x930955;_0x3d77a[_0xd24b5e][_0x3244a5(0x1ff)]=_0x55b0a5;}),_0x11328a[_0x930955(0x135)]((_0x5ca2b9,_0xf12872)=>{var _0x5691de=_0x930955;_0x3d77a[_0xf12872][_0x5691de(0x19e)]=_0x5ca2b9;});const _0x142ea7=_0x3d77a[_0x930955(0x188)](_0x14eec9=>_0x14eec9[_0x930955(0x141)]!=='0'&&_0x14eec9[_0x930955(0x141)]!=='');_0x5f4221[_0x930955(0x134)]=_0x37ddd7,_0x5f4221[_0x930955(0x14d)]=_0x2e03c1,_0x5f4221[_0x930955(0x171)]=_0x16551b,_0x5f4221[_0x930955(0x179)]=_0x5120a6,_0x5f4221[_0x930955(0x17d)]=_0x142ea7,_0x5f4221[_0x930955(0x110)]=_0x7a8bd7,_0x5f4221[_0x930955(0x1ca)]=_0x5eb66a,_0x5f4221['due_amount']=_0x1f7d1a,_0x5f4221[_0x930955(0x1a3)]=_0x126a34,_0x5f4221[_0x930955(0xf9)]=_0x57caba,_0x5f4221[_0x930955(0x167)]=_0x2eddb5;const _0x2ea8e7=await _0x5f4221[_0x930955(0x1ba)](),_0x46fce6=await warehouse[_0x930955(0x1eb)]({'name':_0x336180[_0x930955(0x13c)][_0x930955(0x179)],'room':_0x336180[_0x930955(0x13c)][_0x930955(0x100)]});_0x5f4221[_0x930955(0x17d)][_0x930955(0x135)](_0x3bf624=>{var _0x3f0f2b=_0x930955,_0x4e0207=0x0;const _0x4566e0=_0x46fce6['product_details'][_0x3f0f2b(0x13f)](_0x480588=>{var _0x4ec6ec=_0x3f0f2b;_0x480588[_0x4ec6ec(0x1fc)]==_0x3bf624[_0x4ec6ec(0x1fc)]&&_0x480588[_0x4ec6ec(0x181)]==_0x3bf624[_0x4ec6ec(0x181)]&&_0x480588[_0x4ec6ec(0x105)]==_0x3bf624[_0x4ec6ec(0x105)]&&_0x480588[_0x4ec6ec(0x1d7)]==_0x3bf624['bin']&&_0x480588[_0x4ec6ec(0x14a)]==_0x3bf624[_0x4ec6ec(0x14a)]&&_0x480588['rack']==_0x3bf624[_0x4ec6ec(0x19e)]&&_0x480588[_0x4ec6ec(0x1ff)]==_0x3bf624[_0x4ec6ec(0x1ff)]&&(_0x480588[_0x4ec6ec(0x178)]=parseInt(_0x480588[_0x4ec6ec(0x178)])+parseInt(_0x3bf624[_0x4ec6ec(0x141)]),_0x4e0207++);});_0x4e0207=='0'&&(_0x46fce6[_0x3f0f2b(0x16f)]=_0x46fce6[_0x3f0f2b(0x16f)]['concat']({'product_name':_0x3bf624['product_name'],'product_stock':_0x3bf624['quantity'],'primary_code':_0x3bf624[_0x3f0f2b(0x1a8)],'secondary_code':_0x3bf624[_0x3f0f2b(0x17c)],'product_code':_0x3bf624[_0x3f0f2b(0x195)],'storage':_0x3bf624[_0x3f0f2b(0x1ff)],'rack':_0x3bf624['rack'],'bay':_0x3bf624[_0x3f0f2b(0x14a)],'bin':_0x3bf624[_0x3f0f2b(0x1d7)],'type':_0x3bf624[_0x3f0f2b(0x105)],'floorlevel':_0x3bf624[_0x3f0f2b(0x181)],'maxProducts':_0x3bf624[_0x3f0f2b(0xfa)],'unit':_0x3bf624['standard_unit'],'secondary_unit':_0x3bf624['secondary_unit'],'expiry_date':_0x3bf624[_0x3f0f2b(0x1f1)]}));}),await _0x46fce6[_0x930955(0x1ba)]();const _0x4c4c12=await s_payment_data['findOne']({'invoice':_0x336180[_0x930955(0x13c)][_0x930955(0x134)]});if(_0x4c4c12===null){}else console[_0x930955(0x114)](_0x930955(0x14d),_0x4c4c12,_0x336180[_0x930955(0x13c)]['invoice']),_0x4c4c12[_0x930955(0x14d)]=_0x336180['body']['suppliers'],await _0x4c4c12[_0x930955(0x1ba)]();_0x336180[_0x930955(0x20d)]('success',_0x930955(0x1c0)),_0x2a26b0[_0x930955(0x166)](_0x930955(0x15c));}catch(_0x301fbd){console[_0x930955(0x114)](_0x301fbd);}}),router[a0_0x36fdb1(0x168)](a0_0x36fdb1(0x116),auth,async(_0x3d5924,_0xc7d45d)=>{var _0x48ee1c=a0_0x36fdb1;try{const _0xd79242=_0x3d5924[_0x48ee1c(0x1a4)]['id'],{invoice:_0x306f74,suppliers:_0x5793c9,payable:_0x43c301,due_amount:_0x135da3}=_0x3d5924[_0x48ee1c(0x13c)],_0x4b8298=await purchases[_0x48ee1c(0x10e)](_0xd79242);var _0x24801b=_0x43c301-_0x135da3;_0x4b8298[_0x48ee1c(0x1ca)]=parseFloat(_0x4b8298[_0x48ee1c(0x1ca)])+parseFloat(_0x135da3),_0x4b8298['due_amount']=_0x24801b;const _0x235bb1=await _0x4b8298[_0x48ee1c(0x1ba)]();console[_0x48ee1c(0x114)](_0x235bb1);const _0x2dd9d6=await s_payment_data['findOne']({'invoice':_0x306f74});_0x2dd9d6['amount']=_0x24801b,await _0x2dd9d6[_0x48ee1c(0x1ba)]();let _0xd0a2d6=new Date(),_0x274fc9=('0'+_0xd0a2d6[_0x48ee1c(0x15d)]())[_0x48ee1c(0x11f)](-0x2),_0x1a797b=('0'+(_0xd0a2d6['getMonth']()+0x1))[_0x48ee1c(0x11f)](-0x2),_0x3320d8=_0xd0a2d6[_0x48ee1c(0x147)](),_0x4cf2dc=_0x3320d8+'-'+_0x1a797b+'-'+_0x274fc9;const _0x158f2f=new suppliers_payment({'invoice':_0x306f74,'date':_0x3320d8+'-'+_0x1a797b+'-'+_0x274fc9,'suppliers':_0x5793c9,'reason':_0x48ee1c(0xf6),'amount':_0x135da3}),_0x559036=await _0x158f2f[_0x48ee1c(0x1ba)]();_0x3d5924[_0x48ee1c(0x20d)]('success',_0x48ee1c(0x1bd)),_0xc7d45d['redirect'](_0x48ee1c(0x15c));}catch(_0x4a4e3c){console[_0x48ee1c(0x114)](_0x4a4e3c);}}),router[a0_0x36fdb1(0x20e)](a0_0x36fdb1(0x117),auth,async(_0x56d8d8,_0xc34227)=>{var _0x43e016=a0_0x36fdb1;try{const {username:_0x57e631,email:_0x31c96d,role:_0x4d4e62}=_0x56d8d8[_0x43e016(0x128)],_0xd473ac=_0x56d8d8[_0x43e016(0x128)],_0x58a6d8=await profile[_0x43e016(0x1eb)]({'email':_0xd473ac[_0x43e016(0x1c5)]}),_0x1d41d3=await master_shop['find']();console['log'](_0x43e016(0x142),_0x1d41d3);const _0x2bae4f=_0x56d8d8[_0x43e016(0x1a4)]['id'],_0x6412ff=await purchases[_0x43e016(0x10e)](_0x2bae4f);console[_0x43e016(0x114)](_0x6412ff);const _0x3723a9=await suppliers['findOne']({'name':_0x6412ff[_0x43e016(0x14d)]});console[_0x43e016(0x114)](_0x3723a9);if(_0x1d41d3[0x0][_0x43e016(0x1a0)]==_0x43e016(0x1ac)){var _0x477e2e=users['English'];console[_0x43e016(0x114)](_0x477e2e);}else{if(_0x1d41d3[0x0]['language']==_0x43e016(0x1f6))var _0x477e2e=users['Hindi'];else{if(_0x1d41d3[0x0][_0x43e016(0x1a0)]==_0x43e016(0x126))var _0x477e2e=users[_0x43e016(0x126)];else{if(_0x1d41d3[0x0][_0x43e016(0x1a0)]==_0x43e016(0x13b))var _0x477e2e=users['Spanish'];else{if(_0x1d41d3[0x0]['language']==_0x43e016(0x175))var _0x477e2e=users[_0x43e016(0x175)];else{if(_0x1d41d3[0x0]['language']=='Portuguese\x20(BR)')var _0x477e2e=users[_0x43e016(0x1d4)];else{if(_0x1d41d3[0x0][_0x43e016(0x1a0)]==_0x43e016(0x137))var _0x477e2e=users['Chinese'];else{if(_0x1d41d3[0x0][_0x43e016(0x1a0)]==_0x43e016(0x140))var _0x477e2e=users['Arabic'];}}}}}}}_0xc34227[_0x43e016(0x1d0)](_0x43e016(0x1ef),{'success':_0x56d8d8[_0x43e016(0x20d)](_0x43e016(0x115)),'errors':_0x56d8d8['flash']('errors'),'role':_0xd473ac,'profile':_0x58a6d8,'master_shop':_0x1d41d3,'supplier':_0x3723a9,'purchase':_0x6412ff,'language':_0x477e2e});}catch(_0x50ddfd){console[_0x43e016(0x114)](_0x50ddfd);}}),router[a0_0x36fdb1(0x20e)]('/view/return_purchase/:id',auth,async(_0x4eee02,_0x56627a)=>{var _0x1da058=a0_0x36fdb1;try{const {username:_0x6c110c,email:_0x3c0797,role:_0xcac543}=_0x4eee02[_0x1da058(0x128)],_0x5d22d7=_0x4eee02[_0x1da058(0x128)],_0x28c025=await profile[_0x1da058(0x1eb)]({'email':_0x5d22d7[_0x1da058(0x1c5)]}),_0x2eb239=await master_shop['find']();console['log'](_0x1da058(0x142),_0x2eb239);const _0x2d5982=_0x4eee02[_0x1da058(0x1a4)]['id'];console[_0x1da058(0x114)](_0x2d5982);const _0x4608e0=await purchases['findById'](_0x2d5982);console['log']('user_id',_0x4608e0);const _0x4739d9=await product['find']({}),_0x206dff=await warehouse['aggregate']([{'$match':{'name':_0x4608e0[_0x1da058(0x179)],'room':_0x4608e0[_0x1da058(0x1a3)],'warehouse_category':_0x1da058(0x165)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1da058(0x16b)},'product_stock':{'$first':_0x1da058(0x129)},'bay':{'$first':_0x1da058(0xfc)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1da058(0x19b)},'floorlevel':{'$first':_0x1da058(0x12b)},'primary_code':{'$first':_0x1da058(0x11b)},'secondary_code':{'$first':_0x1da058(0x10f)},'product_code':{'$first':_0x1da058(0x1ee)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1da058(0x1a1)}}}]);warehouse_data=await warehouse[_0x1da058(0x119)]([{'$match':{'status':'Enabled','name':_0x1da058(0x1d3),'warehouse_category':_0x1da058(0x165)}},{'$group':{'_id':'$name','name':{'$first':_0x1da058(0x144)}}},{'$sort':{'name':0x1}}]),console['log'](_0x1da058(0x1b7),_0x206dff);if(_0x2eb239[0x0]['language']==_0x1da058(0x1ac)){var _0x14eee9=users[_0x1da058(0x20f)];console[_0x1da058(0x114)](_0x14eee9);}else{if(_0x2eb239[0x0]['language']=='Hindi')var _0x14eee9=users[_0x1da058(0x1f6)];else{if(_0x2eb239[0x0][_0x1da058(0x1a0)]==_0x1da058(0x126))var _0x14eee9=users[_0x1da058(0x126)];else{if(_0x2eb239[0x0][_0x1da058(0x1a0)]=='Spanish')var _0x14eee9=users[_0x1da058(0x13b)];else{if(_0x2eb239[0x0][_0x1da058(0x1a0)]==_0x1da058(0x175))var _0x14eee9=users[_0x1da058(0x175)];else{if(_0x2eb239[0x0][_0x1da058(0x1a0)]==_0x1da058(0x122))var _0x14eee9=users[_0x1da058(0x1d4)];else{if(_0x2eb239[0x0]['language']=='Chinese')var _0x14eee9=users[_0x1da058(0x137)];else{if(_0x2eb239[0x0]['language']==_0x1da058(0x140))var _0x14eee9=users['Arabic'];}}}}}}}_0x56627a['render'](_0x1da058(0x202),{'success':_0x4eee02[_0x1da058(0x20d)]('success'),'errors':_0x4eee02[_0x1da058(0x20d)](_0x1da058(0x162)),'role':_0x5d22d7,'profile':_0x28c025,'user':_0x4608e0,'stock':_0x206dff,'master_shop':_0x2eb239,'product':_0x4739d9,'language':_0x14eee9,'warehouse':warehouse_data});}catch(_0x24a294){console['log'](_0x24a294);}}),router[a0_0x36fdb1(0x168)](a0_0x36fdb1(0x199),auth,async(_0x5cfd1e,_0x2a6b47)=>{var _0x21559e=a0_0x36fdb1;try{const {invoice:_0x27b6bd,date:_0x524a5c,warehouse_name:_0x48fe1f,Room_name:_0xee1e37,product_name:_0xe245d4,purchase_quantity:_0x1ed370,stocks:_0x16ca12,return_qty:_0xd24533,note:_0x245271,level:_0x35d8be,isle:_0x1bb921,pallet:_0x5179a4,to_warehouse_name:_0x1398ec,to_Room_name:_0x19c8ab}=_0x5cfd1e['body'],_0x1f6a82=await purchases[_0x21559e(0x1eb)]({'_id':_0x5cfd1e[_0x21559e(0x1a4)]['id']}),_0x18c7da=await warehouse['findOne']({'name':_0x48fe1f,'room':_0xee1e37});if(typeof _0xe245d4==_0x21559e(0x1d1))var _0x458a97=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1fc)]],_0x583694=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1cb)]],_0x236ba0=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x209)]],_0x44264a=[_0x5cfd1e['body']['return_qty']],_0x273282=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x12d)]],_0x2b829d=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x163)]],_0x5a7ce7=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1ab)]],_0x4a0b40=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x112)]],_0x516519=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1f2)]],_0x78872a=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x12a)]],_0x5a8a7f=[_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x107)]];else var _0x458a97=[..._0x5cfd1e['body'][_0x21559e(0x1fc)]],_0x583694=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1cb)]],_0x236ba0=[..._0x5cfd1e['body'][_0x21559e(0x209)]],_0x44264a=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1e4)]],_0x273282=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x12d)]],_0x2b829d=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x163)]],_0x5a7ce7=[..._0x5cfd1e[_0x21559e(0x13c)]['pallet']],_0x4a0b40=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x112)]],_0x516519=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x1f2)]],_0x78872a=[..._0x5cfd1e[_0x21559e(0x13c)]['primary_code_hide']],_0x5a8a7f=[..._0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x107)]];const _0x364193=_0x458a97[_0x21559e(0x13f)](_0x4475c7=>{return _0x4475c7={'product_name':_0x4475c7};});_0x583694['forEach']((_0x1ad288,_0x5b00af)=>{_0x364193[_0x5b00af]['purchase_quantity']=_0x1ad288;}),_0x236ba0[_0x21559e(0x135)]((_0x2927cf,_0x179840)=>{var _0x56b30a=_0x21559e;_0x364193[_0x179840][_0x56b30a(0x1e1)]=_0x2927cf;}),_0x44264a['forEach']((_0x3ea5fd,_0x1d22a0)=>{var _0x10719a=_0x21559e;_0x364193[_0x1d22a0][_0x10719a(0x1e4)]=_0x3ea5fd;}),_0x273282['forEach']((_0x139a73,_0x432ca1)=>{var _0xa47fe2=_0x21559e;_0x364193[_0x432ca1][_0xa47fe2(0x14a)]=_0x139a73;}),_0x2b829d[_0x21559e(0x135)]((_0xbe1d11,_0x1bd7dc)=>{var _0x365b22=_0x21559e;_0x364193[_0x1bd7dc][_0x365b22(0x1d7)]=_0xbe1d11;}),_0x5a7ce7[_0x21559e(0x135)]((_0x260b19,_0x449332)=>{var _0x1fc6a2=_0x21559e;_0x364193[_0x449332][_0x1fc6a2(0x181)]=_0x260b19;}),_0x4a0b40[_0x21559e(0x135)]((_0x5a5c20,_0x19fe37)=>{var _0x52d0d1=_0x21559e;_0x364193[_0x19fe37][_0x52d0d1(0x105)]=_0x5a5c20;}),_0x516519[_0x21559e(0x135)]((_0x192ad8,_0x48452e)=>{var _0x4b04a3=_0x21559e;_0x364193[_0x48452e][_0x4b04a3(0x195)]=_0x192ad8;}),_0x78872a[_0x21559e(0x135)]((_0x53787e,_0x2576ab)=>{var _0x2d4c08=_0x21559e;_0x364193[_0x2576ab][_0x2d4c08(0x1a8)]=_0x53787e;}),_0x5a8a7f[_0x21559e(0x135)]((_0x116ff8,_0x2d767c)=>{var _0x3a7771=_0x21559e;_0x364193[_0x2d767c][_0x3a7771(0x17c)]=_0x116ff8;}),_0x1f6a82[_0x21559e(0x17d)][_0x21559e(0x135)](_0x55c94b=>{var _0x405d97=_0x21559e;const _0x14a39c=_0x18c7da['product_details'][_0x405d97(0x13f)](_0x2a4c43=>{var _0xd578a8=_0x405d97;_0x2a4c43[_0xd578a8(0x1fc)]==_0x55c94b[_0xd578a8(0x1fc)]&&_0x2a4c43['floorlevel']==_0x55c94b[_0xd578a8(0x181)]&&_0x2a4c43[_0xd578a8(0x105)]==_0x55c94b[_0xd578a8(0x105)]&&_0x2a4c43[_0xd578a8(0x1d7)]==_0x55c94b[_0xd578a8(0x1d7)]&&_0x2a4c43['bay']==_0x55c94b['bay']&&_0x2a4c43[_0xd578a8(0x19e)]==_0x55c94b[_0xd578a8(0x19e)]&&_0x2a4c43[_0xd578a8(0x1ff)]==_0x55c94b['storage']&&(console[_0xd578a8(0x114)](parseInt(_0x2a4c43['product_stock'])+_0xd578a8(0x145)+parseInt(_0x55c94b[_0xd578a8(0x141)])),_0x2a4c43['product_stock']=parseInt(_0x2a4c43['product_stock'])+parseInt(_0x55c94b['quantity']));});}),await _0x18c7da[_0x21559e(0x1ba)]();const _0x371488=_0x364193[_0x21559e(0x188)](_0x2c191c=>_0x2c191c['return_qty']!=='0'&&_0x2c191c[_0x21559e(0x1e4)]!=='');var _0x43e13a=0x0;_0x371488['forEach'](_0x238457=>{var _0xc97b1b=_0x21559e;console[_0xc97b1b(0x114)](_0xc97b1b(0x194),_0x238457),(parseInt(_0x238457[_0xc97b1b(0x1cb)])<parseInt(_0x238457[_0xc97b1b(0x1e4)])||parseInt(_0x238457[_0xc97b1b(0x1e1)])<parseInt(_0x238457[_0xc97b1b(0x1e4)]))&&_0x43e13a++;});if(_0x43e13a!=0x0)return _0x5cfd1e['flash'](_0x21559e(0x162),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x2a6b47[_0x21559e(0x166)](_0x21559e(0x17b));const _0x230a11=new purchases_return({'invoice':_0x27b6bd,'suppliers':_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x14d)],'date':_0x524a5c,'warehouse_name':_0x48fe1f,'return_product':_0x371488,'note':_0x245271,'room':_0xee1e37,'to_warehouse_name':_0x1398ec,'to_room':_0x19c8ab}),_0xb2281c=await _0x230a11[_0x21559e(0x1ba)]();console[_0x21559e(0x114)](_0x230a11);const _0x22b9bd=await purchases_return[_0x21559e(0x1eb)]({'invoice':_0x27b6bd}),_0xcd8c56=await warehouse[_0x21559e(0x1eb)]({'name':_0x1398ec,'room':_0x19c8ab});_0x22b9bd['return_product'][_0x21559e(0x135)](_0x206aa0=>{var _0x344911=_0x21559e,_0x2ca982=0x0;const _0x2c7625=_0xcd8c56[_0x344911(0x16f)][_0x344911(0x13f)](_0x829794=>{var _0x4178a6=_0x344911;_0x829794[_0x4178a6(0x1fc)]==_0x206aa0['product_name']&&_0x829794[_0x4178a6(0x181)]==_0x206aa0[_0x4178a6(0x181)]&&_0x829794['type']==_0x206aa0[_0x4178a6(0x105)]&&_0x829794[_0x4178a6(0x1d7)]==_0x206aa0[_0x4178a6(0x1d7)]&&_0x829794[_0x4178a6(0x14a)]==_0x206aa0[_0x4178a6(0x14a)]&&(_0x829794[_0x4178a6(0x178)]=parseInt(_0x829794['product_stock'])-parseInt(_0x206aa0[_0x4178a6(0x1e4)]),_0x2ca982++);});_0x2ca982=='0'&&(_0xcd8c56[_0x344911(0x16f)]=_0xcd8c56[_0x344911(0x16f)][_0x344911(0x11e)]({'product_name':_0x206aa0['product_name'],'product_stock':_0x206aa0[_0x344911(0x1e4)],'primary_code':_0x206aa0[_0x344911(0x1a8)],'secondary_code':_0x206aa0['secondary_code'],'product_code':_0x206aa0[_0x344911(0x195)],'storage':_0x206aa0[_0x344911(0x1ff)],'rack':_0x206aa0['rack'],'bay':_0x206aa0[_0x344911(0x14a)],'bin':_0x206aa0[_0x344911(0x1d7)],'type':_0x206aa0['type'],'floorlevel':_0x206aa0[_0x344911(0x181)],'maxProducts':_0x206aa0[_0x344911(0xfa)],'unit':_0x206aa0[_0x344911(0x180)],'secondary_unit':_0x206aa0[_0x344911(0x12e)],'expiry_date':_0x206aa0[_0x344911(0x1f1)]}));}),await _0xcd8c56['save']();const _0x104a4a=await purchases[_0x21559e(0x1eb)]({'invoice':_0x27b6bd});_0x104a4a[_0x21559e(0x125)]=_0x21559e(0x1ec);const _0x114e60=await _0x104a4a[_0x21559e(0x1ba)](),_0x1d29a9=new s_payment_data({'invoice':_0x27b6bd,'suppliers':_0x5cfd1e['body'][_0x21559e(0x14d)],'reason':_0x21559e(0x186)});await _0x1d29a9[_0x21559e(0x1ba)]();const _0x5a14ec=await master_shop[_0x21559e(0x172)]();console[_0x21559e(0x114)]('add\x20post',_0x5a14ec[0x0][_0x21559e(0x1b6)]);const _0x5c1384=await email_settings[_0x21559e(0x1eb)](),_0x1f6b44=await suppliers['findOne']({'name':_0x5cfd1e[_0x21559e(0x13c)][_0x21559e(0x14d)]});console[_0x21559e(0x114)]('suppliers_data',_0x1f6b44);_0x5a14ec[0x0]['currency_placement']==0x1?(right_currency=_0x5a14ec[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5a14ec[0x0][_0x21559e(0x1d8)]);var _0x5f1cfe=_0x458a97,_0x321f28=_0x44264a,_0x51d485='',_0x10ee59;for(_0x10ee59 in _0x5f1cfe){_0x51d485+=_0x21559e(0x1f8)+_0x21559e(0x108)+_0x5f1cfe[_0x10ee59]+_0x21559e(0x10c)+_0x21559e(0x108)+_0x321f28[_0x10ee59]+_0x21559e(0x10c)+_0x21559e(0x1e0);}console[_0x21559e(0x114)]('product_list',_0x51d485);let _0x5b5d74=nodemailer['createTransport']({'service':_0x21559e(0x200),'auth':{'user':_0x5c1384[_0x21559e(0x1c5)],'pass':_0x5c1384[_0x21559e(0x1fe)]}}),_0x3ba1cd={'from':_0x5c1384[_0x21559e(0x1c5)],'to':_0x1f6b44[_0x21559e(0x1c5)],'subject':_0x21559e(0x1cc),'attachments':[{'filename':_0x21559e(0x184),'path':__dirname+_0x21559e(0x101)+_0x21559e(0x121)+_0x5a14ec[0x0]['image'],'cid':_0x21559e(0x208)}],'html':_0x21559e(0x1f0)+_0x21559e(0x16c)+_0x21559e(0x14f)+_0x21559e(0x10b)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x21559e(0xf3)+'</div>'+_0x21559e(0x10b)+_0x21559e(0x130)+_0x5a14ec[0x0][_0x21559e(0x1b4)]+_0x21559e(0x189)+_0x21559e(0x152)+_0x21559e(0x152)+_0x21559e(0x12c)+_0x21559e(0x10b)+_0x21559e(0x1af)+_0x21559e(0x14b)+_0x27b6bd+'\x20'+_0x21559e(0x153)+_0x21559e(0x154)+_0x524a5c+'\x20'+_0x21559e(0x1cd)+_0x21559e(0x169)+'</div>'+_0x21559e(0x161)+_0x21559e(0x174)+_0x21559e(0x1f8)+_0x21559e(0x187)+_0x21559e(0xfd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x21559e(0xf4)+_0x21559e(0x1e0)+_0x21559e(0x1ea)+_0x21559e(0x164)+'\x20'+_0x51d485+'\x20'+_0x21559e(0x19c)+'</table>'+_0x21559e(0x10b)+_0x21559e(0x1ed)+_0x21559e(0x1f5)+_0x5a14ec[0x0][_0x21559e(0x1b4)]+_0x21559e(0x169)+_0x21559e(0x152)+'</div>'+'</body></html>'};_0x5b5d74[_0x21559e(0x20b)](_0x3ba1cd,function(_0x3c842a,_0x34ffda){var _0x29cac6=_0x21559e;_0x3c842a?(console[_0x29cac6(0x114)](_0x3c842a),console[_0x29cac6(0x114)](_0x29cac6(0x15a))):console[_0x29cac6(0x114)](_0x29cac6(0x120));}),_0x5cfd1e[_0x21559e(0x20d)]('success',_0x21559e(0x13d)),_0x2a6b47[_0x21559e(0x166)](_0x21559e(0x15c));}catch(_0x16bb99){console[_0x21559e(0x114)](_0x16bb99),_0x2a6b47[_0x21559e(0x1e2)](0xc8)[_0x21559e(0x1e8)]({'message':_0x16bb99['message']});}}),router[a0_0x36fdb1(0x20e)]('/barcode/:id',auth,async(_0x46e7c7,_0x4e2e87)=>{var _0xb470bb=a0_0x36fdb1;try{const {username:_0x22ee96,email:_0x4ac707,role:_0x7da354}=_0x46e7c7['user'],_0x135275=_0x46e7c7[_0xb470bb(0x128)],_0x1c82c9=await profile[_0xb470bb(0x1eb)]({'email':_0x135275['email']}),_0x357281=await master_shop[_0xb470bb(0x172)](),_0x25602a=_0x46e7c7[_0xb470bb(0x1a4)]['id'],_0x173b76=await purchases[_0xb470bb(0x10e)](_0x25602a);if(_0x357281[0x0][_0xb470bb(0x1a0)]==_0xb470bb(0x1ac))var _0x18a04c=users[_0xb470bb(0x20f)];else{if(_0x357281[0x0][_0xb470bb(0x1a0)]=='Hindi')var _0x18a04c=users[_0xb470bb(0x1f6)];else{if(_0x357281[0x0]['language']==_0xb470bb(0x126))var _0x18a04c=users[_0xb470bb(0x126)];else{if(_0x357281[0x0][_0xb470bb(0x1a0)]==_0xb470bb(0x13b))var _0x18a04c=users[_0xb470bb(0x13b)];else{if(_0x357281[0x0]['language']==_0xb470bb(0x175))var _0x18a04c=users[_0xb470bb(0x175)];else{if(_0x357281[0x0]['language']==_0xb470bb(0x122))var _0x18a04c=users[_0xb470bb(0x1d4)];else{if(_0x357281[0x0][_0xb470bb(0x1a0)]==_0xb470bb(0x137))var _0x18a04c=users[_0xb470bb(0x137)];else{if(_0x357281[0x0]['language']==_0xb470bb(0x140))var _0x18a04c=users[_0xb470bb(0x1f3)];}}}}}}}_0x4e2e87[_0xb470bb(0x1d0)]('all_purchases_barcode',{'success':_0x46e7c7[_0xb470bb(0x20d)]('success'),'errors':_0x46e7c7[_0xb470bb(0x20d)]('errors'),'role':_0x135275,'profile':_0x1c82c9,'alldata':_0x173b76,'master_shop':_0x357281,'language':_0x18a04c}),console[_0xb470bb(0x114)](alldata);}catch(_0x46cc2f){console[_0xb470bb(0x114)](_0x46cc2f);}}),router[a0_0x36fdb1(0x168)]('/barcode_scanner',async(_0x5bb4ba,_0x313f1a)=>{var _0x176263=a0_0x36fdb1;const {product_code:_0x1c14de}=_0x5bb4ba[_0x176263(0x13c)];var _0x2cfe3a;const _0x2e93b3=await product[_0x176263(0x119)]([{'$match':{'primary_code':_0x1c14de,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x176263(0x1dc),'name':{'$first':_0x176263(0x144)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x176263(0x1ae)},'product_code':{'$first':_0x176263(0x111)},'primary_code':{'$first':_0x176263(0x1c1)},'secondary_code':{'$first':_0x176263(0x18d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x176263(0x132)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x176263(0x197)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x218a07=await product[_0x176263(0x119)]([{'$match':{'secondary_code':_0x1c14de,'product_category':_0x176263(0x165)}},{'$group':{'_id':_0x176263(0x1dc),'name':{'$first':_0x176263(0x144)},'category':{'$first':_0x176263(0x1f4)},'brand':{'$first':_0x176263(0x1e9)},'unit':{'$first':_0x176263(0x192)},'alertquantity':{'$first':_0x176263(0x1ae)},'product_code':{'$first':_0x176263(0x111)},'primary_code':{'$first':_0x176263(0x1c1)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x176263(0x103)},'maxProdPerUnit':{'$first':_0x176263(0x132)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x176263(0x197)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2e93b3[_0x176263(0x1a9)]>0x0)_0x2cfe3a=_0x2e93b3;else _0x218a07[_0x176263(0x1a9)]>0x0&&(_0x2cfe3a=_0x218a07);_0x313f1a[_0x176263(0x1e8)](_0x2cfe3a);}),router[a0_0x36fdb1(0x168)]('/CheckingWarehouse',async(_0x27efc8,_0x2a3b14)=>{var _0x3c9835=a0_0x36fdb1;const {primaryCode:_0x3887c2,secondaryCode:_0xbd118,productCode:_0x77e569,bay:_0x2bfd07,bin:_0x49e8b0,types:_0x457044,pallet:_0x263414,warehouses:_0x5ce300,room:_0x4e55d1}=_0x27efc8[_0x3c9835(0x13c)];console[_0x3c9835(0x114)](_0x27efc8[_0x3c9835(0x13c)]);try{const _0x174279=await warehouse['aggregate']([{'$match':{'name':_0x5ce300,'room':_0x4e55d1}},{'$unwind':_0x3c9835(0x124)},{'$match':{'product_details.bay':_0x2bfd07,'product_details.bin':_0x49e8b0,'product_details.type':_0x457044}},{'$group':{'_id':_0x3c9835(0x159),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c9835(0x129)},'level':{'$first':_0x3c9835(0x156)},'isle':{'$first':_0x3c9835(0x11a)},'pallet':{'$first':_0x3c9835(0x205)},'maxProducts':{'$first':_0x3c9835(0x1b3)}}}]);_0x2a3b14['status'](0xc8)['json'](_0x174279);}catch(_0x34698a){_0x2a3b14['status'](0x194)[_0x3c9835(0x1e8)]({'message':_0x34698a['message']});}}),module[a0_0x36fdb1(0x185)]=router;