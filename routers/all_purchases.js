var a0_0x5228a1=a0_0x5c50;(function(_0x179436,_0x5d68db){var _0x51f110=a0_0x5c50,_0x144770=_0x179436();while(!![]){try{var _0x32b908=-parseInt(_0x51f110(0x227))/0x1+parseInt(_0x51f110(0x2a4))/0x2+-parseInt(_0x51f110(0x1b7))/0x3+parseInt(_0x51f110(0x1f9))/0x4*(parseInt(_0x51f110(0x297))/0x5)+parseInt(_0x51f110(0x24a))/0x6+-parseInt(_0x51f110(0x1cc))/0x7+parseInt(_0x51f110(0x1ee))/0x8*(parseInt(_0x51f110(0x26f))/0x9);if(_0x32b908===_0x5d68db)break;else _0x144770['push'](_0x144770['shift']());}catch(_0x294b66){_0x144770['push'](_0x144770['shift']());}}}(a0_0x2529,0x97992));const express=require(a0_0x5228a1(0x1ec)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5228a1(0x232)),nodemailer=require('nodemailer');var ejs=require(a0_0x5228a1(0x1ac));const path=require(a0_0x5228a1(0x267)),users=require('../public/language/languages.json');function a0_0x2529(){var _0x27698d=['Arabic\x20(ae)','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$unit','True','body','type','sendMail','pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$room','back','$secondary_code','product_stock','types','<tr>','secondary_unit','$product.bay','<span\x20style=\x22float:\x20right;\x22>','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_level','$_id','map','Chinese','/view/add_purchases/:id','$finalize','<h5>','RoomAssign','/../public','prod_pallet','$suppliers_docs','$product_details.rack','$product_details.maxProducts','getMonth','name','5ZexSSj','$product_details.bay','Receiving\x20Area','prod_isle','errors','user','max_product_unit','$product_details.bin','language','Purchase\x20data\x20added\x20successfully','prod_primunit','/view/:id','isle','200600rbIqrq','findOne','$note','add_purchases\x20error','host','$product_details.level','$alertquantity','push','$product_details.storage','site_title','actual_qty','<h5\x20style=\x22text-align:\x20left;\x22>','role','$expiry_date','Rack\x20B','$name','<!DOCTYPE\x20html>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','string','INC-','$product_details._id','return_purchase','$maxProdPerUnit','Rack\x20E','product_code_hide','floor','/view','Return\x20Goods','$product_details.secondary_code','find','prod_qty','product_cat','all','</td>','</span>','ejs','invoice','post','gmail','message','Room_name','maxperunit','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Spanish','$product_details.product_name','2732595sjGOci','standard_unit','$product.floorlevel','$product_details.product_stock','</tr>','Purchase\x20Return\x20Mail','product_code','</body></html>','German','\x20<>\x20','createTransport','getFullYear','suppliers','purchase_quantity','log','quantity','prod_invoice','<div>','add\x20post','$product.bin','aggregate','1655619ZLzsdq','delivery_code','<tbody\x20style=\x22text-align:\x20center;\x22>','Rack\x20D','$maxStocks','$suppliers','Floor','image','findById','edit_purchases','$product_details','$due_amount','product','batch_code','/upload/','$warehouse_name','Portuguese','storage','actual_uom','prod_Qty','$product.quantity','production_date','\x20Order\x20Number\x20:\x20','stock_data','$date','alertQTY','</h5>','floorlevel','<hr\x20class=\x22my-3\x22>','suppliers_data','length','Error\x20Occurs','express','master','8YLAyHz','/CheckingWarehouse','level','maxStocks','warehouse','<h2>\x20','MaxStocks_data','Rack\x20C','return_qty','Shelves','/all_purchases/view/','3415876DzgVyg','all_purchases_barcode','return_data','rak','</thead>','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','catch','getDate','prod_secondunit','room','Enclosed','$category','/give_payment/:id','Paid\x20For\x20Purchase','/barcode_scanner','</div>','$batch_code','purchases\x20item\x20return\x20successfull','</table>','redirect','delivery_date','/view/add_purchases','primary_code_hide','forEach','purchase\x20data\x20update\x20successfully','$product_details.product_code','bin','prod_name','padStart','payment\x20successfull','\x20</h2>','warehouse_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_code','Ambient','bay','filter','email','purchase_invoice','currency','due_amount','status','room_name','primary_code','$product','28401CsBTFD','<table\x20style=\x22width:\x20100%\x20!important;\x22>','toString','Hindi','$invoice','Rack\x20A','$secondary_unit','\x20Order\x20Date\x20:\x20','English','French','There\x27s\x20a\x20error\x20in\x20this\x20transaction','../middleware/auth','</head><body>','abs','table\x20page','$product_details.pallet','logo','password','$product_details.primary_code','params','<html><head><title></title>','Raw\x20Materials','$product.room_name','English\x20(US)','staff','success','error','COLD\x20STORAGE','product_name','get','$brand','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','date','expiry_date','Purchase\x20Mail','2658126Hleebc','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$paid_amount','concat','An\x20error\x20occurred.','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','paid_amount','JO_number','/invoice/:id','port','product_details','slice','json','Arabic','secondary_code_hide','$product.type','secondary_code','amount','foreach\x20newproduct','render','then','here','Purchase\x20Return','$product_details.floorlevel','flash','/preview/:id','Portuguese\x20(BR)','DRY\x20STORAGE','/all_purchases/view','path','rack','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$primary_code','stock_quantity','prod_code','Level','3594951RVwqqn','</tbody>','currency_placement'];a0_0x2529=function(){return _0x27698d;};return a0_0x2529();}router[a0_0x5228a1(0x244)](a0_0x5228a1(0x1a3),auth,async(_0x4385d2,_0x424326)=>{var _0x12c078=a0_0x5228a1;try{const {username:_0x1879af,email:_0x2164c4,role:_0xab9825}=_0x4385d2[_0x12c078(0x29c)],_0x1e7e19=_0x4385d2['user'],_0x2adbbf=await profile[_0x12c078(0x2a5)]({'email':_0x1e7e19[_0x12c078(0x21f)]}),_0x1ebe68=await staff['findOne']({'email':_0x1e7e19[_0x12c078(0x21f)]});if(_0x1e7e19[_0x12c078(0x2b0)]==_0x12c078(0x23f)){const _0x5bc7f2=await staff[_0x12c078(0x2a5)]({'email':_0x1e7e19[_0x12c078(0x21f)]});}const _0xb9a5ab=await master_shop[_0x12c078(0x1a6)]();let _0x478e18;if(_0x1e7e19['role']=='staff'){const _0x31500a=await staff[_0x12c078(0x2a5)]({'email':_0x1e7e19[_0x12c078(0x21f)]});_0x478e18=await purchases[_0x12c078(0x1cb)]([{'$match':{'warehouse_name':_0x31500a[_0x12c078(0x1f2)]}},{'$lookup':{'from':_0x12c078(0x1c3),'localField':'suppliers','foreignField':_0x12c078(0x296),'as':'suppliers_docs'}},{'$unwind':_0x12c078(0x292)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x12c078(0x22b)},'suppliers':{'$first':_0x12c078(0x1d1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x12c078(0x1db)},'room':{'$first':_0x12c078(0x27c)},'product':{'$push':'$product'},'note':{'$first':_0x12c078(0x2a6)},'paid_amount':{'$first':_0x12c078(0x24c)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x12c078(0x20a)},'expiry_date':{'$first':_0x12c078(0x2b1)},'suppliers_docs':{'$first':_0x12c078(0x292)},'total_product_quantity':{'$sum':_0x12c078(0x1e0)},'level':{'$addToSet':_0x12c078(0x283)},'isle':{'$addToSet':_0x12c078(0x1ca)},'type':{'$addToSet':_0x12c078(0x259)},'floorlevel':{'$addToSet':_0x12c078(0x1b9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x478e18=await purchases[_0x12c078(0x1cb)]([{'$lookup':{'from':_0x12c078(0x1c3),'localField':_0x12c078(0x1c3),'foreignField':_0x12c078(0x296),'as':'suppliers_docs'}},{'$unwind':_0x12c078(0x292)},{'$unwind':_0x12c078(0x226)},{'$group':{'_id':_0x12c078(0x289),'invoice':{'$first':_0x12c078(0x22b)},'suppliers':{'$first':_0x12c078(0x1d1)},'date':{'$first':_0x12c078(0x1e4)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x12c078(0x23d)},'product':{'$push':_0x12c078(0x226)},'note':{'$first':_0x12c078(0x2a6)},'paid_amount':{'$first':_0x12c078(0x24c)},'due_amount':{'$first':_0x12c078(0x1d7)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x12c078(0x20a)},'expiry_date':{'$first':_0x12c078(0x2b1)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x12c078(0x1e0)},'level':{'$addToSet':_0x12c078(0x283)},'isle':{'$addToSet':_0x12c078(0x1ca)},'type':{'$addToSet':_0x12c078(0x259)},'floorlevel':{'$addToSet':_0x12c078(0x1b9)},'finalize':{'$first':_0x12c078(0x28d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xb9a5ab[0x0]['language']=='English\x20(US)'){var _0x41d1e8=users['English'];console[_0x12c078(0x1c5)](_0x41d1e8);}else{if(_0xb9a5ab[0x0]['language']==_0x12c078(0x22a))var _0x41d1e8=users['Hindi'];else{if(_0xb9a5ab[0x0][_0x12c078(0x29f)]=='German')var _0x41d1e8=users[_0x12c078(0x1bf)];else{if(_0xb9a5ab[0x0][_0x12c078(0x29f)]==_0x12c078(0x1b5))var _0x41d1e8=users[_0x12c078(0x1b5)];else{if(_0xb9a5ab[0x0][_0x12c078(0x29f)]=='French')var _0x41d1e8=users[_0x12c078(0x230)];else{if(_0xb9a5ab[0x0][_0x12c078(0x29f)]==_0x12c078(0x264))var _0x41d1e8=users[_0x12c078(0x1dc)];else{if(_0xb9a5ab[0x0][_0x12c078(0x29f)]==_0x12c078(0x28b))var _0x41d1e8=users[_0x12c078(0x28b)];else{if(_0xb9a5ab[0x0]['language']==_0x12c078(0x272))var _0x41d1e8=users[_0x12c078(0x257)];}}}}}}}_0x424326[_0x12c078(0x25d)]('all_purchases',{'success':_0x4385d2['flash'](_0x12c078(0x240)),'errors':_0x4385d2[_0x12c078(0x262)](_0x12c078(0x29b)),'purchases':_0x478e18,'role':_0x1e7e19,'profile':_0x2adbbf,'master_shop':_0xb9a5ab,'language':_0x41d1e8});}catch(_0x4b6b6b){console['log'](_0x12c078(0x235),_0x4b6b6b),_0x424326[_0x12c078(0x223)](0xc8)[_0x12c078(0x256)]({'message':_0x4b6b6b[_0x12c078(0x1b0)]});}});function a0_0x5c50(_0x23b8c7,_0x4adacf){var _0x25293=a0_0x2529();return a0_0x5c50=function(_0x5c5042,_0x535824){_0x5c5042=_0x5c5042-0x19f;var _0x2a7f85=_0x25293[_0x5c5042];return _0x2a7f85;},a0_0x5c50(_0x23b8c7,_0x4adacf);}function BayBinSelected(_0x1e0698,_0x442feb){var _0x177325=a0_0x5228a1,_0x465f91=[],_0x5eac2f=[],_0x3287d4=[],_0x53823b=[],_0x3a9017=[],_0x500bee=[];let _0x29cbc3=[];if(_0x1e0698==_0x177325(0x265))switch(_0x442feb){case _0x177325(0x22c):_0x465f91=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5eac2f=[0x1,0x2],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x26e),_0x177325(0x1d2)],_0x3a9017=['D'],_0x500bee=['A'];break;case'Rack\x20B':_0x465f91=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5eac2f=[0x1,0x2],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x26e),_0x177325(0x1d2)],_0x3a9017=['D'],_0x500bee=['B'];break;case'Shelves':_0x465f91=[0x0],_0x5eac2f=[0x0],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x1d2)],_0x3a9017=['D'],_0x500bee=['S'];break;case _0x177325(0x299):_0x465f91=[0x0],_0x5eac2f=[0x0],_0x53823b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3287d4=[_0x177325(0x1d2)],_0x3a9017=['D'],_0x500bee=['R'];break;}else{if(_0x1e0698==_0x177325(0x242))switch(_0x442feb){case _0x177325(0x22c):_0x465f91=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5eac2f=['B','F'],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x26e),'Floor'],_0x3a9017=['C'],_0x500bee=['A'];break;case _0x177325(0x2b2):_0x465f91=[0x5,0x4,0x3,0x2,0x1],_0x5eac2f=['F','B','S'],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x26e),_0x177325(0x1d2)],_0x3a9017=['C'],_0x500bee=['B'];break;case _0x177325(0x1f5):_0x465f91=[0x1,0x2,0x3,0x4,0x5],_0x5eac2f=['B','F','S'],_0x53823b=[0x5,0x4,0x3,0x2,0x1],_0x3287d4=[_0x177325(0x26e),_0x177325(0x1d2)],_0x3a9017=['C'],_0x500bee=['C'];break;case _0x177325(0x1cf):_0x465f91=[0x5,0x4,0x3,0x2,0x1],_0x5eac2f=['F','B','S'],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=['Level','Floor'],_0x3a9017=['C'],_0x500bee=['D'];break;case _0x177325(0x1a0):_0x465f91=[0x4,0x3,0x2,0x1],_0x5eac2f=[0x1,0x2],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x26e),_0x177325(0x1d2)],_0x3a9017=['C'],_0x500bee=['E'];break;case'Rack\x20F':_0x465f91=[0x1,0x2,0x3],_0x5eac2f=[0x1,0x2],_0x53823b=[0x1,0x2,0x3,0x4,0x5],_0x3287d4=[_0x177325(0x26e)],_0x3a9017=['C'],_0x500bee=['F'];break;}}return{'levels':_0x465f91,'Isle':_0x5eac2f,'rack':_0x53823b,'type':_0x3287d4,'storage':_0x3a9017,'rak':_0x500bee};}async function getRandom8DigitNumber(){var _0x4eefbd=a0_0x5228a1;const _0x52a548=0x989680,_0x3c4aba=0x5f5e0ff,_0x3ebaee=Math[_0x4eefbd(0x1a2)](Math['random']()*(_0x3c4aba-_0x52a548+0x1))+_0x52a548;var _0x366659;const _0x12aec6=await purchases['findOne']({'invoice':_0x4eefbd(0x2b7)+_0x3ebaee});return _0x12aec6&&_0x12aec6['length']>0x0?_0x366659='INC-'+_0x3ebaee:_0x366659='INC-'+_0x3ebaee,_0x366659;}router[a0_0x5228a1(0x244)](a0_0x5228a1(0x20f),auth,async(_0x3efdc4,_0x6960b1)=>{var _0x410f98=a0_0x5228a1;try{const {username:_0x59a24f,email:_0x447fea,role:_0x1798a9}=_0x3efdc4[_0x410f98(0x29c)],_0xa71e26=_0x3efdc4['user'],_0x310c33=await profile['findOne']({'email':_0xa71e26[_0x410f98(0x21f)]}),_0x565b3e=await master_shop[_0x410f98(0x1a6)](),_0x18dc61=await staff[_0x410f98(0x2a5)]({'email':_0xa71e26[_0x410f98(0x21f)]}),_0x48d4e0=await suppliers[_0x410f98(0x1a6)]({});let _0x500e96;if(_0xa71e26[_0x410f98(0x2b0)]==_0x410f98(0x23f)){const _0x51bd98=await staff[_0x410f98(0x2a5)]({'email':_0xa71e26[_0x410f98(0x21f)]});_0x500e96=await warehouse[_0x410f98(0x1cb)]([{'$match':{'status':_0x410f98(0x269),'name':_0x51bd98[_0x410f98(0x1f2)],'warehouse_category':_0x410f98(0x23c),'name':{'$ne':_0x410f98(0x1a4)}}},{'$group':{'_id':_0x410f98(0x2b3),'name':{'$first':_0x410f98(0x2b3)}}}]);}else _0x500e96=await warehouse[_0x410f98(0x1cb)]([{'$match':{'status':_0x410f98(0x269),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x410f98(0x1a4)}}},{'$group':{'_id':_0x410f98(0x2b3),'name':{'$first':_0x410f98(0x2b3)}}}]);const _0x458e49=await product[_0x410f98(0x1a6)]({}),_0x5ad282=await warehouse[_0x410f98(0x1a6)]({'status':_0x410f98(0x269)}),_0x44c739=await purchases[_0x410f98(0x1a6)]({}),_0x4b44ca=_0x44c739['length']+0x1,_0x24ed28=_0x410f98(0x2b7)+_0x4b44ca[_0x410f98(0x229)]()[_0x410f98(0x216)](0x5,'0');var _0x31c007=[_0x410f98(0x21c),_0x410f98(0x204)];if(_0x565b3e[0x0][_0x410f98(0x29f)]==_0x410f98(0x23e))var _0x595ae4=users[_0x410f98(0x22f)];else{if(_0x565b3e[0x0][_0x410f98(0x29f)]=='Hindi')var _0x595ae4=users[_0x410f98(0x22a)];else{if(_0x565b3e[0x0][_0x410f98(0x29f)]=='German')var _0x595ae4=users[_0x410f98(0x1bf)];else{if(_0x565b3e[0x0]['language']=='Spanish')var _0x595ae4=users[_0x410f98(0x1b5)];else{if(_0x565b3e[0x0][_0x410f98(0x29f)]==_0x410f98(0x230))var _0x595ae4=users[_0x410f98(0x230)];else{if(_0x565b3e[0x0]['language']==_0x410f98(0x264))var _0x595ae4=users[_0x410f98(0x1dc)];else{if(_0x565b3e[0x0]['language']==_0x410f98(0x28b))var _0x595ae4=users[_0x410f98(0x28b)];else{if(_0x565b3e[0x0][_0x410f98(0x29f)]==_0x410f98(0x272))var _0x595ae4=users[_0x410f98(0x257)];}}}}}}}const _0x130261=getRandom8DigitNumber();_0x130261[_0x410f98(0x25e)](_0x3b548d=>{var _0x9f9c42=_0x410f98;_0x6960b1[_0x9f9c42(0x25d)]('add_purchases',{'success':_0x3efdc4[_0x9f9c42(0x262)](_0x9f9c42(0x240)),'errors':_0x3efdc4[_0x9f9c42(0x262)](_0x9f9c42(0x29b)),'role':_0xa71e26,'profile':_0x310c33,'suppliers':_0x48d4e0,'warehouse':_0x500e96,'product':_0x458e49,'invoice':_0x3b548d,'master_shop':_0x565b3e,'language':_0x595ae4,'find_data':_0x5ad282,'rooms_data':_0x31c007});})[_0x410f98(0x200)](_0x3e5234=>{var _0x2f2ea2=_0x410f98;_0x3efdc4[_0x2f2ea2(0x262)](_0x2f2ea2(0x29b),_0x2f2ea2(0x231)),_0x6960b1[_0x2f2ea2(0x20d)](_0x2f2ea2(0x266));});}catch(_0x49b9eb){console[_0x410f98(0x1c5)](_0x49b9eb);}}),router['get'](a0_0x5228a1(0x28c),auth,async(_0x1cfe67,_0xb7fc22)=>{var _0x360400=a0_0x5228a1;try{const _0x1c0168=_0x1cfe67['params']['id'];console['log'](_0x1c0168);const _0x55d846=await master_shop[_0x360400(0x1a6)]();console[_0x360400(0x1c5)]('master',_0x55d846);const _0x458b03=await product['findOne']({'name':_0x1c0168});console[_0x360400(0x1c5)](_0x360400(0x1d8),_0x458b03),_0xb7fc22['status'](0xc8)['json']({'product_data':_0x458b03,'master':_0x55d846});}catch(_0x51b4fa){console['log'](_0x360400(0x2a7),_0x51b4fa);}}),router[a0_0x5228a1(0x1ae)](a0_0x5228a1(0x20f),auth,async(_0x3697ac,_0x151d31)=>{var _0x3fb517=a0_0x5228a1;try{const {invoice:_0x3cd83e,date:_0x31f3ce,warehouse_name:_0x20d110,prod_name:_0x295090,prod_code:_0x566756,prod_qty:_0x502813,prod_unit:_0x29de6d,prod_secondunit:_0x3692e2,prod_level:_0x4867d6,prod_isle:_0x482b1e,prod_pallet:_0x4e22bb,note:_0x199daa,expiry_date:_0x20efc6,batch_code:_0x481b27,payable:_0x2334f9,due_amount:_0x377007,Room_name:_0x230e5b,primary_code:_0x194f47,secondary_code:_0x4c3ee1,MaxStocks_data:_0x3adfe5,PO_number:_0x599710,SCRN:_0x4f2f,JO_number:_0x490c5d}=_0x3697ac[_0x3fb517(0x277)];if(typeof _0x295090==_0x3fb517(0x2b6))var _0x3c7888=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x215)]],_0x5bee69=[_0x3697ac[_0x3fb517(0x277)]['prod_code']],_0x1f7ae1=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1df)]],_0x342aa1=[_0x3697ac['body'][_0x3fb517(0x2a1)]],_0x3debf5=[_0x3697ac[_0x3fb517(0x277)]['prod_secondunit']],_0x35df26=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x288)]],_0x5665b4=[_0x3697ac['body']['primary_code']],_0x5068da=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x25a)]],_0x428381=[_0x3697ac['body'][_0x3fb517(0x1f4)]],_0x20001b=[_0x3697ac['body'][_0x3fb517(0x1d9)]],_0x435317=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x248)]],_0x51ec36=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x29d)]],_0x205167=[_0x3697ac['body']['alertQTY']],_0x45ccb4=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1e1)]],_0x1fc587=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x273)]],_0x313541=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x28f)]],_0x19c33a=[_0x3697ac[_0x3fb517(0x277)]['deliverycode']],_0x52b8df=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1c7)]],_0x3d2a02=[_0x3697ac['body'][_0x3fb517(0x2ae)]],_0x33f27e=[_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1de)]];else var _0x3c7888=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x215)]],_0x5bee69=[..._0x3697ac['body']['prod_code']],_0x1f7ae1=[..._0x3697ac[_0x3fb517(0x277)]['prod_Qty']],_0x342aa1=[..._0x3697ac['body']['prod_primunit']],_0x3debf5=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x202)]],_0x35df26=[..._0x3697ac['body']['prod_level']],_0x5665b4=[..._0x3697ac['body']['primary_code']],_0x5068da=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x25a)]],_0x428381=[..._0x3697ac[_0x3fb517(0x277)]['MaxStocks_data']],_0x20001b=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1d9)]],_0x435317=[..._0x3697ac[_0x3fb517(0x277)]['expiry_date']],_0x51ec36=[..._0x3697ac[_0x3fb517(0x277)]['max_product_unit']],_0x205167=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1e5)]],_0x45ccb4=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1e1)]],_0x1fc587=[..._0x3697ac[_0x3fb517(0x277)]['prod_cat']],_0x313541=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x28f)]],_0x19c33a=[..._0x3697ac[_0x3fb517(0x277)]['deliverycode']],_0x52b8df=[..._0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1c7)]],_0x3d2a02=[..._0x3697ac[_0x3fb517(0x277)]['actual_qty']],_0x33f27e=[..._0x3697ac[_0x3fb517(0x277)]['actual_uom']];const _0x3986c9=_0x3c7888['map'](_0x2364e9=>{return _0x2364e9={'product_name':_0x2364e9};});_0x3d2a02['forEach']((_0x3ed780,_0x562c85)=>{var _0x295c39=_0x3fb517;_0x3986c9[_0x562c85][_0x295c39(0x2ae)]=Math[_0x295c39(0x234)](_0x3ed780);}),_0x33f27e[_0x3fb517(0x211)]((_0x5a4f1f,_0x5aee6c)=>{var _0x763bca=_0x3fb517;_0x3986c9[_0x5aee6c][_0x763bca(0x1de)]=_0x5a4f1f;}),_0x5bee69[_0x3fb517(0x211)]((_0x282c10,_0x37f262)=>{var _0x5efc08=_0x3fb517;_0x3986c9[_0x37f262][_0x5efc08(0x1bd)]=_0x282c10;}),_0x1f7ae1[_0x3fb517(0x211)]((_0xb51d56,_0x30e759)=>{var _0x30622=_0x3fb517;_0x3986c9[_0x30e759][_0x30622(0x1c6)]=Math[_0x30622(0x234)](_0xb51d56);}),_0x342aa1[_0x3fb517(0x211)]((_0x3196ae,_0x1525fa)=>{var _0x44b31e=_0x3fb517;_0x3986c9[_0x1525fa][_0x44b31e(0x1b8)]=_0x3196ae;}),_0x3debf5[_0x3fb517(0x211)]((_0x3c247f,_0x530efc)=>{_0x3986c9[_0x530efc]['secondary_unit']=_0x3c247f;}),_0x35df26[_0x3fb517(0x211)]((_0x2524ad,_0xb380e1)=>{var _0x373fac=_0x3fb517;_0x313541[_0x373fac(0x211)]((_0x218016,_0x3189da)=>{var _0x215b60=_0x373fac;if(_0x218016==_0x215b60(0x299)&&_0xb380e1==_0x3189da){console[_0x215b60(0x1c5)](_0x218016+'\x20<\x20wew\x20>\x20'+_0xb380e1+_0x215b60(0x1c0)+_0x3189da+'\x20<>\x20'+_0x2524ad);var _0x51c345=_0x2524ad[_0x215b60(0x255)](0x3);_0x3986c9[_0xb380e1]['storage']=_0x2524ad[0x0],_0x3986c9[_0xb380e1][_0x215b60(0x268)]=_0x2524ad[0x1],_0x3986c9[_0xb380e1][_0x215b60(0x21d)]=0x0,_0x3986c9[_0xb380e1]['bin']=0x0,_0x3986c9[_0xb380e1][_0x215b60(0x278)]=_0x215b60(0x1d2),_0x3986c9[_0xb380e1][_0x215b60(0x1e7)]=_0x51c345;}else{if(_0x218016==_0x215b60(0x1f7)&&_0xb380e1==_0x3189da){var _0x51c345=_0x2524ad[_0x215b60(0x255)](0x3);_0x3986c9[_0xb380e1][_0x215b60(0x1dd)]=_0x2524ad[0x0],_0x3986c9[_0xb380e1][_0x215b60(0x268)]=_0x2524ad[0x1],_0x3986c9[_0xb380e1][_0x215b60(0x21d)]=0x0,_0x3986c9[_0xb380e1]['bin']=0x0,_0x3986c9[_0xb380e1][_0x215b60(0x278)]=_0x215b60(0x1d2),_0x3986c9[_0xb380e1][_0x215b60(0x1e7)]=_0x2524ad[0x5];}else{if(_0xb380e1==_0x3189da){if(_0x2524ad[0x0]=='A'&&_0x2524ad[0x1]=='L'&&_0x2524ad[0x2]=='L')console[_0x215b60(0x1c5)](_0x218016+_0x215b60(0x1c0)+_0xb380e1+_0x215b60(0x1c0)+_0x3189da+'\x20<>\x20'+_0x2524ad+_0x215b60(0x25f)),_0x3986c9[_0xb380e1][_0x215b60(0x1dd)]=_0x2524ad[0x0],_0x3986c9[_0xb380e1][_0x215b60(0x268)]=_0x2524ad[0x1],_0x3986c9[_0xb380e1]['bay']=0x0,_0x3986c9[_0xb380e1]['bin']=0x0,_0x3986c9[_0xb380e1][_0x215b60(0x278)]=_0x215b60(0x1d2),_0x3986c9[_0xb380e1]['floorlevel']=_0x2524ad[0x3];else{var _0x44a171;if(_0x2524ad[0x4]=='L')_0x44a171=_0x215b60(0x26e);else _0x2524ad[0x4]=='F'&&(_0x44a171=_0x215b60(0x1d2));_0x3986c9[_0xb380e1][_0x215b60(0x1dd)]=_0x2524ad[0x0],_0x3986c9[_0xb380e1]['rack']=_0x2524ad[0x1],_0x3986c9[_0xb380e1]['bay']=_0x2524ad[0x2],_0x3986c9[_0xb380e1]['bin']=_0x2524ad[0x3],_0x3986c9[_0xb380e1]['type']=_0x44a171,_0x3986c9[_0xb380e1][_0x215b60(0x1e7)]=_0x2524ad[0x5];}}}}});}),_0x5665b4[_0x3fb517(0x211)]((_0x350a26,_0x25a022)=>{var _0x2a7f18=_0x3fb517;_0x3986c9[_0x25a022][_0x2a7f18(0x225)]=_0x350a26;}),_0x5068da[_0x3fb517(0x211)]((_0x29bcaa,_0x635cca)=>{var _0x505ac0=_0x3fb517;_0x3986c9[_0x635cca][_0x505ac0(0x25a)]=_0x29bcaa;}),_0x428381[_0x3fb517(0x211)]((_0x816f52,_0x31785a)=>{var _0x41c87a=_0x3fb517;_0x3986c9[_0x31785a][_0x41c87a(0x1f1)]=_0x816f52;}),_0x20001b[_0x3fb517(0x211)]((_0xf997f8,_0x43079a)=>{var _0x17d2fe=_0x3fb517;_0x3986c9[_0x43079a][_0x17d2fe(0x1d9)]=_0xf997f8;}),_0x435317['forEach']((_0x43b5e5,_0x22b4ac)=>{var _0x51952f=_0x3fb517;_0x3986c9[_0x22b4ac][_0x51952f(0x248)]=_0x43b5e5;}),_0x51ec36[_0x3fb517(0x211)]((_0x3ba8b0,_0x2edebd)=>{_0x3986c9[_0x2edebd]['maxperunit']=_0x3ba8b0;}),_0x205167[_0x3fb517(0x211)]((_0x2a4ee8,_0x2f3b8a)=>{_0x3986c9[_0x2f3b8a]['alertQTY']=_0x2a4ee8;}),_0x45ccb4[_0x3fb517(0x211)]((_0x2e0e62,_0x45ff68)=>{var _0xe14b16=_0x3fb517;_0x3986c9[_0x45ff68][_0xe14b16(0x1e1)]=_0x2e0e62;}),_0x1fc587[_0x3fb517(0x211)]((_0xac5d9a,_0x202191)=>{_0x3986c9[_0x202191]['product_cat']=_0xac5d9a;}),_0x313541[_0x3fb517(0x211)]((_0xb2138d,_0x51de1c)=>{var _0xd1b117=_0x3fb517;_0x3986c9[_0x51de1c][_0xd1b117(0x224)]=_0xb2138d;}),_0x19c33a[_0x3fb517(0x211)]((_0x3de119,_0x526971)=>{var _0x1ade7f=_0x3fb517;_0x3986c9[_0x526971][_0x1ade7f(0x1cd)]=_0x3de119;}),_0x52b8df[_0x3fb517(0x211)]((_0x43d208,_0xf59559)=>{_0x3986c9[_0xf59559]['invoice']=_0x43d208;});const _0x34a8d1=_0x313541[_0x3fb517(0x28a)](_0x31ff3d=>{return _0x31ff3d={'room_name':_0x31ff3d};}),_0x38f5b4=_0x3986c9['filter'](_0x384f9f=>_0x384f9f['quantity']!=='0'&&_0x384f9f[_0x3fb517(0x1c6)]!==''),_0x4253d9=new purchases({'invoice':_0x3cd83e,'suppliers':_0x3697ac[_0x3fb517(0x277)][_0x3fb517(0x1c3)],'date':_0x31f3ce,'warehouse_name':_0x20d110,'product':_0x38f5b4,'note':_0x199daa,'due_amount':_0x377007,'POnumber':_0x599710,'SCRN':_0x4f2f,'JO_number':_0x490c5d,'roomList':_0x34a8d1}),_0x390d48=await _0x4253d9[_0x3fb517(0x1fe)](),_0x3f44a5=await purchases[_0x3fb517(0x2a5)]({'invoice':_0x3cd83e}),_0x4e876f=_0x3f44a5[_0x3fb517(0x1d8)][_0x3fb517(0x28a)](async _0x567c2b=>{var _0x36152e=_0x3fb517,_0x3e4001=await warehouse[_0x36152e(0x2a5)]({'name':_0x20d110,'room':_0x567c2b['room_name']}),_0x3adad5=0x0;return _0x3e4001['product_details'][_0x36152e(0x211)](_0x6182c8=>{var _0x460f48=_0x36152e;_0x6182c8[_0x460f48(0x243)]==_0x567c2b[_0x460f48(0x243)]&&_0x6182c8[_0x460f48(0x1e7)]==_0x567c2b[_0x460f48(0x1e7)]&&_0x6182c8[_0x460f48(0x278)]==_0x567c2b[_0x460f48(0x278)]&&_0x6182c8[_0x460f48(0x214)]==_0x567c2b[_0x460f48(0x214)]&&_0x6182c8['bay']==_0x567c2b[_0x460f48(0x21d)]&&_0x6182c8[_0x460f48(0x268)]==_0x567c2b[_0x460f48(0x268)]&&_0x6182c8[_0x460f48(0x1dd)]==_0x567c2b[_0x460f48(0x1dd)]&&_0x6182c8['expiry_date']==_0x567c2b[_0x460f48(0x248)]&&_0x6182c8['batch_code']==_0x567c2b[_0x460f48(0x1d9)]&&_0x6182c8[_0x460f48(0x1e1)]==_0x567c2b[_0x460f48(0x1e1)]&&_0x6182c8[_0x460f48(0x1ad)]==_0x3f44a5[_0x460f48(0x1ad)]&&(_0x6182c8['product_stock']+=Math[_0x460f48(0x234)](_0x567c2b[_0x460f48(0x1c6)]),_0x3adad5++);}),_0x3adad5===0x0&&_0x3e4001['product_details'][_0x36152e(0x2ab)]({'product_name':_0x567c2b[_0x36152e(0x243)],'product_stock':Math['abs'](_0x567c2b[_0x36152e(0x1c6)]),'primary_code':_0x567c2b[_0x36152e(0x225)],'secondary_code':_0x567c2b['secondary_code'],'product_code':_0x567c2b[_0x36152e(0x1bd)],'storage':_0x567c2b[_0x36152e(0x1dd)],'rack':_0x567c2b[_0x36152e(0x268)],'bay':_0x567c2b['bay'],'bin':_0x567c2b['bin'],'type':_0x567c2b[_0x36152e(0x278)],'floorlevel':_0x567c2b[_0x36152e(0x1e7)],'maxProducts':_0x567c2b['maxStocks'],'unit':_0x567c2b['standard_unit'],'secondary_unit':_0x567c2b[_0x36152e(0x282)],'expiry_date':_0x567c2b[_0x36152e(0x248)],'maxPerUnit':_0x567c2b['maxperunit'],'batch_code':_0x567c2b[_0x36152e(0x1d9)],'alertQTY':_0x567c2b[_0x36152e(0x1e5)],'production_date':_0x567c2b[_0x36152e(0x1e1)],'product_cat':_0x567c2b[_0x36152e(0x1a8)],'invoice':_0x567c2b[_0x36152e(0x1ad)],'actual_qty':Math['abs'](_0x567c2b[_0x36152e(0x2ae)]),'actual_uom':_0x567c2b['actual_uom']}),_0x3e4001;});Promise[_0x3fb517(0x1a9)](_0x4e876f)[_0x3fb517(0x25e)](async _0x253af6=>{var _0x46c4a6=_0x3fb517;try{for(const _0x4b5656 of _0x253af6){await _0x4b5656['save']();}const _0x4b26c8=await master_shop[_0x46c4a6(0x1a6)](),_0x2097a4=await email_settings[_0x46c4a6(0x2a5)](),_0x1cd6b3=await supervisor_settings[_0x46c4a6(0x1a6)]();var _0x46d15d=_0x3f44a5[_0x46c4a6(0x1d8)],_0x5af815='',_0x1a94fd;for(_0x1a94fd in _0x46d15d){_0x5af815+=_0x46c4a6(0x281)+_0x46c4a6(0x24f)+_0x46d15d[_0x1a94fd][_0x46c4a6(0x243)]+_0x46c4a6(0x1aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x46d15d[_0x1a94fd][_0x46c4a6(0x1bd)]+_0x46c4a6(0x1aa)+_0x46c4a6(0x24f)+_0x46d15d[_0x1a94fd][_0x46c4a6(0x1c6)]+_0x46c4a6(0x1aa)+_0x46c4a6(0x24f)+_0x46d15d[_0x1a94fd]['standard_unit']+_0x46c4a6(0x1aa)+_0x46c4a6(0x24f)+_0x46d15d[_0x1a94fd]['secondary_unit']+_0x46c4a6(0x1aa)+_0x46c4a6(0x24f)+_0x3f44a5[_0x46c4a6(0x219)]+_0x46c4a6(0x1aa)+_0x46c4a6(0x24f)+_0x46d15d[_0x1a94fd][_0x46c4a6(0x224)]+_0x46c4a6(0x1aa)+_0x46c4a6(0x24f)+_0x46d15d[_0x1a94fd]['storage']+_0x46d15d[_0x1a94fd]['rack']+_0x46d15d[_0x1a94fd][_0x46c4a6(0x21d)]+_0x46d15d[_0x1a94fd][_0x46c4a6(0x214)]+_0x46d15d[_0x1a94fd]['type'][0x0]+_0x46d15d[_0x1a94fd]['floorlevel']+_0x46c4a6(0x1aa),_0x46c4a6(0x1bb);}let _0x51e7fc=nodemailer[_0x46c4a6(0x1c1)]({'host':_0x2097a4[_0x46c4a6(0x2a8)],'port':Number(_0x2097a4[_0x46c4a6(0x253)]),'secure':![],'auth':{'user':_0x2097a4[_0x46c4a6(0x21f)],'pass':_0x2097a4[_0x46c4a6(0x238)]}}),_0x190be8={'from':_0x2097a4[_0x46c4a6(0x21f)],'to':_0x1cd6b3[0x0]['RMSEmail'],'subject':_0x46c4a6(0x249),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x46c4a6(0x1da)+_0x4b26c8[0x0][_0x46c4a6(0x1d3)],'cid':'logo'}],'html':_0x46c4a6(0x2b4)+_0x46c4a6(0x23b)+'</head><body>'+'<div>'+_0x46c4a6(0x24b)+_0x46c4a6(0x1c8)+_0x46c4a6(0x2b5)+_0x46c4a6(0x209)+_0x46c4a6(0x1c8)+_0x46c4a6(0x1f3)+_0x4b26c8[0x0][_0x46c4a6(0x2ad)]+_0x46c4a6(0x218)+_0x46c4a6(0x209)+_0x46c4a6(0x209)+_0x46c4a6(0x1e8)+'<div>'+_0x46c4a6(0x2af)+_0x46c4a6(0x1e2)+_0x3f44a5[_0x46c4a6(0x1ad)]+'\x20'+_0x46c4a6(0x284)+_0x46c4a6(0x22e)+_0x3f44a5[_0x46c4a6(0x247)]+'\x20'+_0x46c4a6(0x1ab)+'</h5>'+'</div>'+_0x46c4a6(0x228)+_0x46c4a6(0x21a)+_0x46c4a6(0x281)+_0x46c4a6(0x287)+_0x46c4a6(0x286)+_0x46c4a6(0x1ff)+_0x46c4a6(0x26a)+_0x46c4a6(0x1b4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x46c4a6(0x27b)+_0x46c4a6(0x274)+_0x46c4a6(0x1bb)+_0x46c4a6(0x1fd)+_0x46c4a6(0x1ce)+'\x20'+_0x5af815+'\x20'+_0x46c4a6(0x270)+_0x46c4a6(0x20c)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x4b26c8[0x0][_0x46c4a6(0x2ad)]+'</h5>'+_0x46c4a6(0x209)+_0x46c4a6(0x209)+'</body></html>'};_0x51e7fc[_0x46c4a6(0x279)](_0x190be8,function(_0xd18016,_0x5e7881){var _0x5d8034=_0x46c4a6;_0xd18016?(console[_0x5d8034(0x1c5)](_0xd18016),console[_0x5d8034(0x1c5)](_0x5d8034(0x1eb))):console[_0x5d8034(0x1c5)]('Email\x20sent\x20successfully');}),_0x3697ac[_0x46c4a6(0x262)](_0x46c4a6(0x240),_0x46c4a6(0x2a0)),_0x151d31[_0x46c4a6(0x20d)](_0x46c4a6(0x1f8));}catch(_0x3daa24){console[_0x46c4a6(0x241)](_0x3daa24),_0x151d31['status'](0x1f4)[_0x46c4a6(0x256)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x57efc0=>{var _0x32d1b4=_0x3fb517;console[_0x32d1b4(0x241)](_0x57efc0),_0x151d31[_0x32d1b4(0x223)](0x1f4)['json']({'error':_0x32d1b4(0x24e)});});}catch(_0x18d631){console[_0x3fb517(0x1c5)](_0x18d631);}}),router['get']('/preview/:id',auth,async(_0xc16d03,_0x29aa15)=>{var _0x5c14c6=a0_0x5228a1;try{const {username:_0x5675a8,email:_0x4c937e,role:_0x88e108}=_0xc16d03[_0x5c14c6(0x29c)],_0xba0edc=_0xc16d03[_0x5c14c6(0x29c)],_0x4fb79e=await profile[_0x5c14c6(0x2a5)]({'email':_0xba0edc[_0x5c14c6(0x21f)]}),_0x12daac=await master_shop[_0x5c14c6(0x1a6)](),_0x2f6bd8=_0xc16d03['params']['id'],_0x1042c2=await purchases[_0x5c14c6(0x1d4)](_0x2f6bd8),_0x59f467=await warehouse[_0x5c14c6(0x1cb)]([{'$match':{'name':_0x1042c2[_0x5c14c6(0x219)],'room':_0x1042c2['room']}},{'$unwind':_0x5c14c6(0x1d6)},{'$group':{'_id':_0x5c14c6(0x2b8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5c14c6(0x1ba)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5c14c6(0x29e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5c14c6(0x261)},'primary_code':{'$first':_0x5c14c6(0x239)},'secondary_code':{'$first':_0x5c14c6(0x1a5)},'product_code':{'$first':_0x5c14c6(0x213)},'storage':{'$first':_0x5c14c6(0x2ac)},'rack':{'$first':_0x5c14c6(0x293)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x4a37f1=await customer[_0x5c14c6(0x1a6)]({});let _0x1049e1;if(_0xba0edc['role']==_0x5c14c6(0x23f)){const _0x5ddaea=await staff['findOne']({'email':_0xba0edc['email']});_0x1049e1=await warehouse[_0x5c14c6(0x1cb)]([{'$match':{'status':_0x5c14c6(0x269),'name':_0x5ddaea[_0x5c14c6(0x1f2)]}},{'$group':{'_id':'$name','name':{'$first':_0x5c14c6(0x2b3)}}}]);}else _0x1049e1=await warehouse['aggregate']([{'$match':{'status':_0x5c14c6(0x269)}},{'$group':{'_id':_0x5c14c6(0x2b3),'name':{'$first':'$name'}}}]);const _0x3b9967=await product['find']({}),_0x4eed9a=await suppliers[_0x5c14c6(0x1a6)]({}),_0x22a745=BayBinSelected(_0x1042c2[_0x5c14c6(0x219)],_0x1042c2[_0x5c14c6(0x203)]);if(_0x12daac[0x0]['language']==_0x5c14c6(0x23e)){var _0x21326e=users[_0x5c14c6(0x22f)];console[_0x5c14c6(0x1c5)](_0x21326e);}else{if(_0x12daac[0x0][_0x5c14c6(0x29f)]==_0x5c14c6(0x22a))var _0x21326e=users['Hindi'];else{if(_0x12daac[0x0]['language']=='German')var _0x21326e=users[_0x5c14c6(0x1bf)];else{if(_0x12daac[0x0][_0x5c14c6(0x29f)]==_0x5c14c6(0x1b5))var _0x21326e=users[_0x5c14c6(0x1b5)];else{if(_0x12daac[0x0]['language']=='French')var _0x21326e=users[_0x5c14c6(0x230)];else{if(_0x12daac[0x0]['language']==_0x5c14c6(0x264))var _0x21326e=users[_0x5c14c6(0x1dc)];else{if(_0x12daac[0x0]['language']=='Chinese')var _0x21326e=users[_0x5c14c6(0x28b)];else{if(_0x12daac[0x0]['language']==_0x5c14c6(0x272))var _0x21326e=users[_0x5c14c6(0x257)];}}}}}}}_0x29aa15['render']('edit_purchases_view',{'success':_0xc16d03[_0x5c14c6(0x262)](_0x5c14c6(0x240)),'errors':_0xc16d03[_0x5c14c6(0x262)](_0x5c14c6(0x29b)),'role':_0xba0edc,'profile':_0x4fb79e,'customer':_0x4a37f1,'warehouse':_0x1049e1,'product':_0x59f467,'user':_0x1042c2,'master_shop':_0x12daac,'unit':_0x3b9967,'language':_0x21326e,'suppliers':_0x4eed9a,'dataSelected':_0x22a745});}catch(_0xf6c1a9){console[_0x5c14c6(0x1c5)](_0xf6c1a9);}}),router['post'](a0_0x5228a1(0x263),auth,async(_0x3086f2,_0x93897b)=>{var _0x47e7ec=a0_0x5228a1;try{const _0x104f25=_0x3086f2[_0x47e7ec(0x23a)]['id'],{invoice:_0x2ff233,warehouse_name:_0x117211,Room_name:_0x23caf9}=_0x3086f2[_0x47e7ec(0x277)],_0x85305e=await warehouse['findOne']({'name':_0x117211,'room':_0x23caf9}),_0x53eb49=await purchases[_0x47e7ec(0x2a5)]({'invoice':_0x2ff233});_0x53eb49[_0x47e7ec(0x1d8)][_0x47e7ec(0x211)](_0x116901=>{var _0x50912e=_0x47e7ec,_0x38f686=0x0;const _0x474d80=_0x85305e[_0x50912e(0x254)][_0x50912e(0x28a)](_0x210874=>{var _0x426c67=_0x50912e;_0x210874['product_name']==_0x116901[_0x426c67(0x243)]&&_0x210874['floorlevel']==_0x116901['floorlevel']&&_0x210874[_0x426c67(0x278)]==_0x116901[_0x426c67(0x278)]&&_0x210874[_0x426c67(0x214)]==_0x116901[_0x426c67(0x214)]&&_0x210874[_0x426c67(0x21d)]==_0x116901[_0x426c67(0x21d)]&&_0x210874[_0x426c67(0x268)]==_0x116901[_0x426c67(0x268)]&&_0x210874[_0x426c67(0x1dd)]==_0x116901['storage']&&_0x210874[_0x426c67(0x248)]==_0x116901['expiry_date']&&_0x210874[_0x426c67(0x1d9)]==_0x116901[_0x426c67(0x1d9)]&&_0x210874[_0x426c67(0x1e1)]==_0x116901['production_date']&&_0x210874[_0x426c67(0x20e)]==_0x116901[_0x426c67(0x20e)]&&_0x210874['delivery_code']==_0x116901[_0x426c67(0x1cd)]&&(_0x210874['product_stock']=parseInt(_0x210874[_0x426c67(0x27f)])+parseInt(_0x116901['quantity']),_0x38f686++);});_0x38f686=='0'&&(_0x85305e[_0x50912e(0x254)]=_0x85305e['product_details'][_0x50912e(0x24d)]({'product_name':_0x116901[_0x50912e(0x243)],'product_stock':_0x116901[_0x50912e(0x1c6)],'primary_code':_0x116901[_0x50912e(0x225)],'secondary_code':_0x116901[_0x50912e(0x25a)],'product_code':_0x116901[_0x50912e(0x1bd)],'storage':_0x116901['storage'],'rack':_0x116901[_0x50912e(0x268)],'bay':_0x116901[_0x50912e(0x21d)],'bin':_0x116901[_0x50912e(0x214)],'type':_0x116901[_0x50912e(0x278)],'floorlevel':_0x116901['floorlevel'],'maxProducts':_0x116901[_0x50912e(0x1f1)],'unit':_0x116901['standard_unit'],'secondary_unit':_0x116901['secondary_unit'],'expiry_date':_0x116901[_0x50912e(0x248)],'maxPerUnit':_0x116901[_0x50912e(0x1b2)],'batch_code':_0x116901[_0x50912e(0x1d9)],'alertQTY':_0x116901[_0x50912e(0x1e5)],'production_date':_0x116901['production_date'],'delivery_date':_0x116901[_0x50912e(0x20e)],'delivery_code':_0x116901[_0x50912e(0x1cd)]}));}),await _0x85305e[_0x47e7ec(0x1fe)](),_0x53eb49['finalize']='True';const _0x198813=await _0x53eb49['save']();_0x3086f2[_0x47e7ec(0x262)]('success','Sales\x20Update\x20successfully'),_0x93897b[_0x47e7ec(0x20d)](_0x47e7ec(0x266));}catch(_0x1e5192){console[_0x47e7ec(0x1c5)](_0x1e5192);}}),router[a0_0x5228a1(0x244)](a0_0x5228a1(0x2a2),auth,async(_0x586a5c,_0x4c34eb)=>{var _0x28a866=a0_0x5228a1;try{const {username:_0x5c3328,email:_0x50fc89,role:_0x1307d5}=_0x586a5c[_0x28a866(0x29c)],_0x32a889=_0x586a5c[_0x28a866(0x29c)],_0x2ffdc7=await profile[_0x28a866(0x2a5)]({'email':_0x32a889[_0x28a866(0x21f)]}),_0x2ca8a5=await master_shop[_0x28a866(0x1a6)](),_0x5b89fc=_0x586a5c['params']['id'],_0x43eac5=await purchases[_0x28a866(0x1d4)](_0x5b89fc),_0x17c9c8=await suppliers[_0x28a866(0x1a6)]({});let _0x1f6863;if(_0x32a889[_0x28a866(0x2b0)]==_0x28a866(0x23f)){const _0x327243=await staff[_0x28a866(0x2a5)]({'email':_0x32a889['email']});_0x1f6863=await warehouse[_0x28a866(0x1a6)]({'status':_0x28a866(0x269),'name':_0x327243[_0x28a866(0x1f2)],'warehouse_category':'Raw\x20Materials'});}else _0x1f6863=await warehouse[_0x28a866(0x1cb)]([{'$match':{'status':'Enabled','warehouse_category':_0x28a866(0x23c)}},{'$group':{'_id':_0x28a866(0x2b3),'name':{'$first':_0x28a866(0x2b3)}}}]);const _0x1d6bdc=await product['find']({}),_0x5ac393=BayBinSelected(_0x43eac5[_0x28a866(0x219)],_0x43eac5[_0x28a866(0x203)]);let _0x4acee2=new Date(_0x43eac5[_0x28a866(0x248)]),_0x306b17=('0'+_0x4acee2[_0x28a866(0x201)]())[_0x28a866(0x255)](-0x2),_0x37400f=('0'+(_0x4acee2[_0x28a866(0x295)]()+0x1))[_0x28a866(0x255)](-0x2),_0x18bbd0=_0x4acee2['getFullYear'](),_0x38e71d=_0x18bbd0+'-'+_0x37400f+'-'+_0x306b17;if(_0x2ca8a5[0x0][_0x28a866(0x29f)]==_0x28a866(0x23e)){var _0x20f3ab=users['English'];console[_0x28a866(0x1c5)](_0x20f3ab);}else{if(_0x2ca8a5[0x0][_0x28a866(0x29f)]==_0x28a866(0x22a))var _0x20f3ab=users[_0x28a866(0x22a)];else{if(_0x2ca8a5[0x0]['language']==_0x28a866(0x1bf))var _0x20f3ab=users[_0x28a866(0x1bf)];else{if(_0x2ca8a5[0x0][_0x28a866(0x29f)]==_0x28a866(0x1b5))var _0x20f3ab=users[_0x28a866(0x1b5)];else{if(_0x2ca8a5[0x0]['language']==_0x28a866(0x230))var _0x20f3ab=users['French'];else{if(_0x2ca8a5[0x0][_0x28a866(0x29f)]==_0x28a866(0x264))var _0x20f3ab=users[_0x28a866(0x1dc)];else{if(_0x2ca8a5[0x0][_0x28a866(0x29f)]==_0x28a866(0x28b))var _0x20f3ab=users[_0x28a866(0x28b)];else{if(_0x2ca8a5[0x0][_0x28a866(0x29f)]==_0x28a866(0x272))var _0x20f3ab=users[_0x28a866(0x257)];}}}}}}}_0x4c34eb[_0x28a866(0x25d)](_0x28a866(0x1d5),{'success':_0x586a5c[_0x28a866(0x262)]('success'),'errors':_0x586a5c['flash'](_0x28a866(0x29b)),'role':_0x32a889,'profile':_0x2ffdc7,'purchases':_0x43eac5,'suppliers':_0x17c9c8,'warehouse':_0x1f6863,'product':_0x1d6bdc,'master_shop':_0x2ca8a5,'language':_0x20f3ab,'ed_fullDate':_0x38e71d,'dataSelected':_0x5ac393});}catch(_0x4f3db1){console[_0x28a866(0x1c5)](_0x4f3db1);}}),router[a0_0x5228a1(0x1ae)]('/view/:id',auth,async(_0x115895,_0x53578d)=>{var _0x502d9b=a0_0x5228a1;try{const _0x2fa921=_0x115895['params']['id'],_0x14bc21=await purchases[_0x502d9b(0x2a5)]({'_id':_0x115895['params']['id']}),_0x18496a=await warehouse[_0x502d9b(0x2a5)]({'name':_0x14bc21[_0x502d9b(0x219)],'room':_0x14bc21[_0x502d9b(0x203)]});_0x14bc21[_0x502d9b(0x1d8)][_0x502d9b(0x211)](_0x53d0e3=>{var _0x4aaf44=_0x502d9b;const _0x3fedf5=_0x18496a[_0x4aaf44(0x254)][_0x4aaf44(0x28a)](_0x5b3cbe=>{var _0x12179c=_0x4aaf44;_0x5b3cbe[_0x12179c(0x243)]==_0x53d0e3[_0x12179c(0x243)]&&_0x5b3cbe[_0x12179c(0x1e7)]==_0x53d0e3[_0x12179c(0x1e7)]&&_0x5b3cbe[_0x12179c(0x278)]==_0x53d0e3[_0x12179c(0x278)]&&_0x5b3cbe[_0x12179c(0x214)]==_0x53d0e3[_0x12179c(0x214)]&&_0x5b3cbe[_0x12179c(0x21d)]==_0x53d0e3[_0x12179c(0x21d)]&&_0x5b3cbe[_0x12179c(0x268)]==_0x53d0e3[_0x12179c(0x268)]&&_0x5b3cbe['storage']==_0x53d0e3['storage']&&(_0x5b3cbe[_0x12179c(0x27f)]=parseInt(_0x5b3cbe[_0x12179c(0x27f)])-parseInt(_0x53d0e3[_0x12179c(0x1c6)]));});}),await _0x18496a[_0x502d9b(0x1fe)]();const {invoice:_0x5d634e,suppliers:_0xeaeef4,date:_0x499ff5,warehouse_name:_0xbd211f,prod_name:_0x207f24,prod_code:_0x166b57,prod_qty:_0x2ede3b,prod_unit:_0x4fa7a2,prod_secondunit:_0x3e09a7,prod_level:_0x509775,prod_isle:_0x4acc1c,prod_pallet:_0x500a07,note:_0x15e50b,expiry_date:_0x2219ea,batch_code:_0x1eae53,paid_amount:_0xdc3f09,due_amount:_0x553de6,Room_name:_0x4c4833,primary_code:_0x4d0b69,secondary_code:_0x239899,PO_number:_0x44a5c5,JO_number:_0x239201}=_0x115895[_0x502d9b(0x277)];if(typeof _0x207f24==_0x502d9b(0x2b6))var _0x418fca=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x215)]],_0x2000a0=[_0x115895['body'][_0x502d9b(0x26d)]],_0x4aa1b4=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1a7)]],_0xb2ed3e=[_0x115895[_0x502d9b(0x277)]['prod_unit']],_0x185d26=[_0x115895[_0x502d9b(0x277)]['prod_secondunit']],_0x2d6f3f=[_0x115895['body'][_0x502d9b(0x288)]],_0x20494d=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x29a)]],_0x52de7e=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x291)]],_0x2f78df=[_0x115895[_0x502d9b(0x277)]['primary_code']],_0x23a453=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x25a)]],_0xbc0a5f=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1f4)]],_0x23ac8a=[_0x115895['body'][_0x502d9b(0x1d9)]],_0x320ece=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x248)]],_0x29b510=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1dd)]],_0x54e8f7=[_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1fc)]],_0x1d91bf=[_0x115895['body'][_0x502d9b(0x278)]];else var _0x418fca=[..._0x115895['body'][_0x502d9b(0x215)]],_0x2000a0=[..._0x115895[_0x502d9b(0x277)]['prod_code']],_0x4aa1b4=[..._0x115895[_0x502d9b(0x277)]['prod_qty']],_0xb2ed3e=[..._0x115895[_0x502d9b(0x277)]['prod_unit']],_0x185d26=[..._0x115895[_0x502d9b(0x277)][_0x502d9b(0x202)]],_0x2d6f3f=[..._0x115895[_0x502d9b(0x277)][_0x502d9b(0x288)]],_0x20494d=[..._0x115895[_0x502d9b(0x277)]['prod_isle']],_0x52de7e=[..._0x115895['body'][_0x502d9b(0x291)]],_0x2f78df=[..._0x115895['body'][_0x502d9b(0x225)]],_0x23a453=[..._0x115895[_0x502d9b(0x277)][_0x502d9b(0x25a)]],_0xbc0a5f=[..._0x115895[_0x502d9b(0x277)]['MaxStocks_data']],_0x23ac8a=[..._0x115895['body'][_0x502d9b(0x1d9)]],_0x320ece=[..._0x115895[_0x502d9b(0x277)][_0x502d9b(0x248)]],_0x29b510=[..._0x115895[_0x502d9b(0x277)][_0x502d9b(0x1dd)]],_0x54e8f7=[..._0x115895[_0x502d9b(0x277)][_0x502d9b(0x1fc)]],_0x1d91bf=[..._0x115895['body'][_0x502d9b(0x278)]];const _0x440ad9=_0x418fca['map'](_0xc4e649=>{return _0xc4e649={'product_name':_0xc4e649};});_0x2000a0[_0x502d9b(0x211)]((_0x1cbfe3,_0x44143f)=>{_0x440ad9[_0x44143f]['product_code']=_0x1cbfe3;}),_0x4aa1b4['forEach']((_0x36a3c,_0x541fc4)=>{var _0x3a2506=_0x502d9b;_0x440ad9[_0x541fc4][_0x3a2506(0x1c6)]=_0x36a3c;}),_0xb2ed3e[_0x502d9b(0x211)]((_0x5506aa,_0x164f8e)=>{var _0x48a633=_0x502d9b;_0x440ad9[_0x164f8e][_0x48a633(0x1b8)]=_0x5506aa;}),_0x185d26[_0x502d9b(0x211)]((_0xa63371,_0x4cafe7)=>{_0x440ad9[_0x4cafe7]['secondary_unit']=_0xa63371;}),_0x2d6f3f['forEach']((_0x31fa63,_0x281a20)=>{var _0x5f11a8=_0x502d9b;_0x440ad9[_0x281a20][_0x5f11a8(0x21d)]=_0x31fa63;}),_0x20494d[_0x502d9b(0x211)]((_0x5debe1,_0x4acac7)=>{_0x440ad9[_0x4acac7]['bin']=_0x5debe1;}),_0x52de7e[_0x502d9b(0x211)]((_0x1156d4,_0xa8c501)=>{_0x440ad9[_0xa8c501]['floorlevel']=_0x1156d4;}),_0x2f78df['forEach']((_0x123195,_0x2f2193)=>{_0x440ad9[_0x2f2193]['primary_code']=_0x123195;}),_0x23a453['forEach']((_0x474ce8,_0x781724)=>{var _0x2d363d=_0x502d9b;_0x440ad9[_0x781724][_0x2d363d(0x25a)]=_0x474ce8;}),_0xbc0a5f[_0x502d9b(0x211)]((_0x34a1d1,_0x4c3429)=>{var _0x5142f3=_0x502d9b;_0x440ad9[_0x4c3429][_0x5142f3(0x1f1)]=_0x34a1d1;}),_0x23ac8a['forEach']((_0x21e8f4,_0x17bb66)=>{_0x440ad9[_0x17bb66]['batch_code']=_0x21e8f4;}),_0x320ece[_0x502d9b(0x211)]((_0x44ef28,_0x2abef6)=>{var _0x36b74b=_0x502d9b;_0x440ad9[_0x2abef6][_0x36b74b(0x248)]=_0x44ef28;}),_0x1d91bf['forEach']((_0x34998b,_0x1ca19d)=>{var _0x2b9fdd=_0x502d9b;_0x440ad9[_0x1ca19d][_0x2b9fdd(0x278)]=_0x34998b;}),_0x29b510['forEach']((_0x258b1d,_0x5a6d5d)=>{var _0x3a8d61=_0x502d9b;_0x440ad9[_0x5a6d5d][_0x3a8d61(0x1dd)]=_0x258b1d;}),_0x54e8f7[_0x502d9b(0x211)]((_0x2aa202,_0xad47b8)=>{var _0x45c344=_0x502d9b;_0x440ad9[_0xad47b8][_0x45c344(0x268)]=_0x2aa202;});const _0x476c22=_0x440ad9['filter'](_0x5db63c=>_0x5db63c['quantity']!=='0'&&_0x5db63c[_0x502d9b(0x1c6)]!=='');_0x14bc21['invoice']=_0x5d634e,_0x14bc21[_0x502d9b(0x1c3)]=_0xeaeef4,_0x14bc21[_0x502d9b(0x247)]=_0x499ff5,_0x14bc21[_0x502d9b(0x219)]=_0xbd211f,_0x14bc21['product']=_0x476c22,_0x14bc21['note']=_0x15e50b,_0x14bc21[_0x502d9b(0x250)]=_0xdc3f09,_0x14bc21['due_amount']=_0x553de6,_0x14bc21['room']=_0x4c4833,_0x14bc21['POnumber']=_0x44a5c5,_0x14bc21[_0x502d9b(0x251)]=_0x239201;const _0x78bd9b=await _0x14bc21['save'](),_0x1b4149=await warehouse[_0x502d9b(0x2a5)]({'name':_0x115895[_0x502d9b(0x277)]['warehouse_name'],'room':_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1b1)]});_0x14bc21[_0x502d9b(0x1d8)][_0x502d9b(0x211)](_0x214542=>{var _0x1b3816=_0x502d9b,_0x51d986=0x0;const _0x532dfe=_0x1b4149[_0x1b3816(0x254)][_0x1b3816(0x28a)](_0x49f701=>{var _0x1a45c0=_0x1b3816;_0x49f701[_0x1a45c0(0x243)]==_0x214542[_0x1a45c0(0x243)]&&_0x49f701[_0x1a45c0(0x1e7)]==_0x214542[_0x1a45c0(0x1e7)]&&_0x49f701[_0x1a45c0(0x278)]==_0x214542['type']&&_0x49f701[_0x1a45c0(0x214)]==_0x214542[_0x1a45c0(0x214)]&&_0x49f701[_0x1a45c0(0x21d)]==_0x214542['bay']&&_0x49f701[_0x1a45c0(0x268)]==_0x214542['rack']&&_0x49f701[_0x1a45c0(0x1dd)]==_0x214542['storage']&&(_0x49f701[_0x1a45c0(0x27f)]=parseInt(_0x49f701[_0x1a45c0(0x27f)])+parseInt(_0x214542[_0x1a45c0(0x1c6)]),_0x51d986++);});_0x51d986=='0'&&(_0x1b4149[_0x1b3816(0x254)]=_0x1b4149[_0x1b3816(0x254)]['concat']({'product_name':_0x214542[_0x1b3816(0x243)],'product_stock':_0x214542[_0x1b3816(0x1c6)],'primary_code':_0x214542['primary_code'],'secondary_code':_0x214542[_0x1b3816(0x25a)],'product_code':_0x214542['product_code'],'storage':_0x214542[_0x1b3816(0x1dd)],'rack':_0x214542['rack'],'bay':_0x214542['bay'],'bin':_0x214542[_0x1b3816(0x214)],'type':_0x214542[_0x1b3816(0x278)],'floorlevel':_0x214542[_0x1b3816(0x1e7)],'maxProducts':_0x214542[_0x1b3816(0x1f1)],'unit':_0x214542[_0x1b3816(0x1b8)],'secondary_unit':_0x214542['secondary_unit'],'expiry_date':_0x214542[_0x1b3816(0x248)]}));}),await _0x1b4149['save']();const _0xe7579f=await s_payment_data[_0x502d9b(0x2a5)]({'invoice':_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1ad)]});if(_0xe7579f===null){}else console[_0x502d9b(0x1c5)](_0x502d9b(0x1c3),_0xe7579f,_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1ad)]),_0xe7579f[_0x502d9b(0x1c3)]=_0x115895[_0x502d9b(0x277)][_0x502d9b(0x1c3)],await _0xe7579f[_0x502d9b(0x1fe)]();_0x115895[_0x502d9b(0x262)](_0x502d9b(0x240),_0x502d9b(0x212)),_0x53578d[_0x502d9b(0x20d)]('/all_purchases/view');}catch(_0x2109a6){console['log'](_0x2109a6);}}),router['post'](a0_0x5228a1(0x206),auth,async(_0x394d2b,_0x462a8a)=>{var _0xb9b846=a0_0x5228a1;try{const _0x3fced1=_0x394d2b[_0xb9b846(0x23a)]['id'],{invoice:_0x17a60c,suppliers:_0x3a48a1,payable:_0x4d6689,due_amount:_0x738161}=_0x394d2b[_0xb9b846(0x277)],_0x2212bc=await purchases[_0xb9b846(0x1d4)](_0x3fced1);var _0x4d3c15=_0x4d6689-_0x738161;_0x2212bc['paid_amount']=parseFloat(_0x2212bc['paid_amount'])+parseFloat(_0x738161),_0x2212bc[_0xb9b846(0x222)]=_0x4d3c15;const _0x34b372=await _0x2212bc['save']();console[_0xb9b846(0x1c5)](_0x34b372);const _0x39f33d=await s_payment_data['findOne']({'invoice':_0x17a60c});_0x39f33d[_0xb9b846(0x25b)]=_0x4d3c15,await _0x39f33d['save']();let _0x1e17ed=new Date(),_0x59324b=('0'+_0x1e17ed[_0xb9b846(0x201)]())['slice'](-0x2),_0x30893a=('0'+(_0x1e17ed['getMonth']()+0x1))['slice'](-0x2),_0x155e4f=_0x1e17ed[_0xb9b846(0x1c2)](),_0x2a76ce=_0x155e4f+'-'+_0x30893a+'-'+_0x59324b;const _0x510858=new suppliers_payment({'invoice':_0x17a60c,'date':_0x155e4f+'-'+_0x30893a+'-'+_0x59324b,'suppliers':_0x3a48a1,'reason':_0xb9b846(0x207),'amount':_0x738161}),_0x3d4d4d=await _0x510858[_0xb9b846(0x1fe)]();_0x394d2b['flash'](_0xb9b846(0x240),_0xb9b846(0x217)),_0x462a8a[_0xb9b846(0x20d)](_0xb9b846(0x266));}catch(_0x3f0df8){console[_0xb9b846(0x1c5)](_0x3f0df8);}}),router[a0_0x5228a1(0x244)](a0_0x5228a1(0x252),auth,async(_0x12e3b0,_0x2236e7)=>{var _0x21b9ea=a0_0x5228a1;try{const {username:_0x46f2c8,email:_0x4cfc10,role:_0x5d90f4}=_0x12e3b0['user'],_0x44d771=_0x12e3b0[_0x21b9ea(0x29c)],_0x4a058f=await profile[_0x21b9ea(0x2a5)]({'email':_0x44d771[_0x21b9ea(0x21f)]}),_0x57ac8c=await master_shop['find']();console[_0x21b9ea(0x1c5)](_0x21b9ea(0x1ed),_0x57ac8c);const _0x50da06=_0x12e3b0[_0x21b9ea(0x23a)]['id'],_0x5d07a7=await purchases[_0x21b9ea(0x1d4)](_0x50da06);console['log'](_0x5d07a7);const _0x4c40e9=await suppliers[_0x21b9ea(0x2a5)]({'name':_0x5d07a7[_0x21b9ea(0x1c3)]});console[_0x21b9ea(0x1c5)](_0x4c40e9);if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]==_0x21b9ea(0x23e)){var _0x59eef6=users['English'];console['log'](_0x59eef6);}else{if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]=='Hindi')var _0x59eef6=users[_0x21b9ea(0x22a)];else{if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]==_0x21b9ea(0x1bf))var _0x59eef6=users[_0x21b9ea(0x1bf)];else{if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]==_0x21b9ea(0x1b5))var _0x59eef6=users[_0x21b9ea(0x1b5)];else{if(_0x57ac8c[0x0]['language']==_0x21b9ea(0x230))var _0x59eef6=users[_0x21b9ea(0x230)];else{if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]==_0x21b9ea(0x264))var _0x59eef6=users[_0x21b9ea(0x1dc)];else{if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]=='Chinese')var _0x59eef6=users['Chinese'];else{if(_0x57ac8c[0x0][_0x21b9ea(0x29f)]=='Arabic\x20(ae)')var _0x59eef6=users[_0x21b9ea(0x257)];}}}}}}}_0x2236e7[_0x21b9ea(0x25d)](_0x21b9ea(0x220),{'success':_0x12e3b0[_0x21b9ea(0x262)](_0x21b9ea(0x240)),'errors':_0x12e3b0[_0x21b9ea(0x262)](_0x21b9ea(0x29b)),'role':_0x44d771,'profile':_0x4a058f,'master_shop':_0x57ac8c,'supplier':_0x4c40e9,'purchase':_0x5d07a7,'language':_0x59eef6});}catch(_0x20a98b){console[_0x21b9ea(0x1c5)](_0x20a98b);}}),router[a0_0x5228a1(0x244)]('/view/return_purchase/:id',auth,async(_0x29444d,_0x54f9fa)=>{var _0x2486d1=a0_0x5228a1;try{const {username:_0x5d9bc8,email:_0xe7a12,role:_0x43c40a}=_0x29444d['user'],_0x2d565c=_0x29444d[_0x2486d1(0x29c)],_0x32ae84=await profile['findOne']({'email':_0x2d565c[_0x2486d1(0x21f)]}),_0x30e6d8=await master_shop[_0x2486d1(0x1a6)]();console[_0x2486d1(0x1c5)](_0x2486d1(0x1ed),_0x30e6d8);const _0x4617c4=_0x29444d[_0x2486d1(0x23a)]['id'];console['log'](_0x4617c4);const _0x580a7b=await purchases[_0x2486d1(0x1d4)](_0x4617c4);console['log']('user_id',_0x580a7b);const _0x400883=await product[_0x2486d1(0x1a6)]({}),_0x5a7189=await warehouse[_0x2486d1(0x1cb)]([{'$match':{'name':_0x580a7b['warehouse_name'],'room':_0x580a7b[_0x2486d1(0x203)],'warehouse_category':_0x2486d1(0x23c)}},{'$unwind':_0x2486d1(0x1d6)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2486d1(0x1b6)},'product_stock':{'$first':_0x2486d1(0x1ba)},'bay':{'$first':_0x2486d1(0x298)},'bin':{'$first':_0x2486d1(0x29e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2486d1(0x261)},'primary_code':{'$first':_0x2486d1(0x239)},'secondary_code':{'$first':_0x2486d1(0x1a5)},'product_code':{'$first':_0x2486d1(0x213)},'storage':{'$first':_0x2486d1(0x2ac)},'rack':{'$first':_0x2486d1(0x293)}}}]);warehouse_data=await warehouse[_0x2486d1(0x1cb)]([{'$match':{'status':_0x2486d1(0x269),'name':_0x2486d1(0x1a4),'warehouse_category':_0x2486d1(0x23c)}},{'$group':{'_id':_0x2486d1(0x2b3),'name':{'$first':_0x2486d1(0x2b3)}}},{'$sort':{'name':0x1}}]),console[_0x2486d1(0x1c5)](_0x2486d1(0x1e3),_0x5a7189);if(_0x30e6d8[0x0][_0x2486d1(0x29f)]==_0x2486d1(0x23e)){var _0x1636a3=users[_0x2486d1(0x22f)];console[_0x2486d1(0x1c5)](_0x1636a3);}else{if(_0x30e6d8[0x0]['language']==_0x2486d1(0x22a))var _0x1636a3=users[_0x2486d1(0x22a)];else{if(_0x30e6d8[0x0][_0x2486d1(0x29f)]==_0x2486d1(0x1bf))var _0x1636a3=users[_0x2486d1(0x1bf)];else{if(_0x30e6d8[0x0][_0x2486d1(0x29f)]==_0x2486d1(0x1b5))var _0x1636a3=users['Spanish'];else{if(_0x30e6d8[0x0][_0x2486d1(0x29f)]==_0x2486d1(0x230))var _0x1636a3=users[_0x2486d1(0x230)];else{if(_0x30e6d8[0x0][_0x2486d1(0x29f)]=='Portuguese\x20(BR)')var _0x1636a3=users[_0x2486d1(0x1dc)];else{if(_0x30e6d8[0x0][_0x2486d1(0x29f)]=='Chinese')var _0x1636a3=users[_0x2486d1(0x28b)];else{if(_0x30e6d8[0x0][_0x2486d1(0x29f)]==_0x2486d1(0x272))var _0x1636a3=users['Arabic'];}}}}}}}_0x54f9fa[_0x2486d1(0x25d)](_0x2486d1(0x2b9),{'success':_0x29444d['flash'](_0x2486d1(0x240)),'errors':_0x29444d[_0x2486d1(0x262)](_0x2486d1(0x29b)),'role':_0x2d565c,'profile':_0x32ae84,'user':_0x580a7b,'stock':_0x5a7189,'master_shop':_0x30e6d8,'product':_0x400883,'language':_0x1636a3,'warehouse':warehouse_data});}catch(_0x1d3123){console[_0x2486d1(0x1c5)](_0x1d3123);}}),router[a0_0x5228a1(0x1ae)]('/view/return_purchase/:id',auth,async(_0x251032,_0x33147f)=>{var _0x5dee34=a0_0x5228a1;try{const {invoice:_0x18b3bb,date:_0x51d4f0,warehouse_name:_0x4e6adb,Room_name:_0x2a8752,product_name:_0x3e9986,purchase_quantity:_0x291cbe,stocks:_0x3cd622,return_qty:_0x5a125f,note:_0x5f55ec,level:_0x37b643,isle:_0x56a12b,pallet:_0x530823,to_warehouse_name:_0x5a0fab,to_Room_name:_0x1d66df}=_0x251032['body'],_0x1563b9=await purchases['findOne']({'_id':_0x251032[_0x5dee34(0x23a)]['id']}),_0x5c2416=await warehouse['findOne']({'name':_0x4e6adb,'room':_0x2a8752});if(typeof _0x3e9986=='string')var _0x38e713=[_0x251032[_0x5dee34(0x277)]['product_name']],_0x292188=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x1c4)]],_0x34b53f=[_0x251032[_0x5dee34(0x277)]['stocks']],_0x3b42f0=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x1f6)]],_0x514323=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x1f0)]],_0x6d6871=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x2a3)]],_0x188eb7=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x27a)]],_0xbefdaf=[_0x251032[_0x5dee34(0x277)]['types']],_0x2dceac=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x1a1)]],_0x3975fb=[_0x251032[_0x5dee34(0x277)][_0x5dee34(0x210)]],_0x56f960=[_0x251032[_0x5dee34(0x277)]['secondary_code_hide']];else var _0x38e713=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x243)]],_0x292188=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x1c4)]],_0x34b53f=[..._0x251032[_0x5dee34(0x277)]['stocks']],_0x3b42f0=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x1f6)]],_0x514323=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x1f0)]],_0x6d6871=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x2a3)]],_0x188eb7=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x27a)]],_0xbefdaf=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x280)]],_0x2dceac=[..._0x251032['body'][_0x5dee34(0x1a1)]],_0x3975fb=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x210)]],_0x56f960=[..._0x251032[_0x5dee34(0x277)][_0x5dee34(0x258)]];const _0x19dedb=_0x38e713[_0x5dee34(0x28a)](_0x47dfd1=>{return _0x47dfd1={'product_name':_0x47dfd1};});_0x292188[_0x5dee34(0x211)]((_0x141157,_0xa7bab)=>{var _0x26529e=_0x5dee34;_0x19dedb[_0xa7bab][_0x26529e(0x1c4)]=_0x141157;}),_0x34b53f['forEach']((_0x4c0ddc,_0x612cc6)=>{_0x19dedb[_0x612cc6]['stock_quantity']=_0x4c0ddc;}),_0x3b42f0[_0x5dee34(0x211)]((_0xe965b3,_0x555743)=>{_0x19dedb[_0x555743]['return_qty']=_0xe965b3;}),_0x514323['forEach']((_0x426fb5,_0x109e55)=>{var _0xd91253=_0x5dee34;_0x19dedb[_0x109e55][_0xd91253(0x21d)]=_0x426fb5;}),_0x6d6871[_0x5dee34(0x211)]((_0x67eee,_0x5d277d)=>{var _0x4dde60=_0x5dee34;_0x19dedb[_0x5d277d][_0x4dde60(0x214)]=_0x67eee;}),_0x188eb7[_0x5dee34(0x211)]((_0x5dc743,_0x2f0843)=>{var _0x5d28d6=_0x5dee34;_0x19dedb[_0x2f0843][_0x5d28d6(0x1e7)]=_0x5dc743;}),_0xbefdaf['forEach']((_0x54a00e,_0x4cfd4e)=>{var _0x2e5219=_0x5dee34;_0x19dedb[_0x4cfd4e][_0x2e5219(0x278)]=_0x54a00e;}),_0x2dceac[_0x5dee34(0x211)]((_0x3a86c9,_0x45f5d5)=>{var _0x388975=_0x5dee34;_0x19dedb[_0x45f5d5][_0x388975(0x1bd)]=_0x3a86c9;}),_0x3975fb[_0x5dee34(0x211)]((_0x4b53e7,_0x523ba6)=>{var _0x5de1a6=_0x5dee34;_0x19dedb[_0x523ba6][_0x5de1a6(0x225)]=_0x4b53e7;}),_0x56f960[_0x5dee34(0x211)]((_0x21627c,_0x516e48)=>{var _0x11e2c9=_0x5dee34;_0x19dedb[_0x516e48][_0x11e2c9(0x25a)]=_0x21627c;}),_0x1563b9['product'][_0x5dee34(0x211)](_0x2ebb01=>{var _0x4dd064=_0x5dee34;const _0x3a86af=_0x5c2416['product_details'][_0x4dd064(0x28a)](_0x23ee82=>{var _0x22ef24=_0x4dd064;_0x23ee82['product_name']==_0x2ebb01[_0x22ef24(0x243)]&&_0x23ee82[_0x22ef24(0x1e7)]==_0x2ebb01[_0x22ef24(0x1e7)]&&_0x23ee82['type']==_0x2ebb01[_0x22ef24(0x278)]&&_0x23ee82[_0x22ef24(0x214)]==_0x2ebb01[_0x22ef24(0x214)]&&_0x23ee82[_0x22ef24(0x21d)]==_0x2ebb01[_0x22ef24(0x21d)]&&_0x23ee82['rack']==_0x2ebb01[_0x22ef24(0x268)]&&_0x23ee82[_0x22ef24(0x1dd)]==_0x2ebb01[_0x22ef24(0x1dd)]&&(console['log'](parseInt(_0x23ee82[_0x22ef24(0x27f)])+_0x22ef24(0x1c0)+parseInt(_0x2ebb01['quantity'])),_0x23ee82['product_stock']=parseInt(_0x23ee82[_0x22ef24(0x27f)])+parseInt(_0x2ebb01['quantity']));});}),await _0x5c2416['save']();const _0x5ccdab=_0x19dedb[_0x5dee34(0x21e)](_0x204082=>_0x204082[_0x5dee34(0x1f6)]!=='0'&&_0x204082[_0x5dee34(0x1f6)]!=='');var _0x5ddfbd=0x0;_0x5ccdab[_0x5dee34(0x211)](_0x368825=>{var _0x5e8f6c=_0x5dee34;console[_0x5e8f6c(0x1c5)](_0x5e8f6c(0x25c),_0x368825),(parseInt(_0x368825['purchase_quantity'])<parseInt(_0x368825[_0x5e8f6c(0x1f6)])||parseInt(_0x368825[_0x5e8f6c(0x26c)])<parseInt(_0x368825['return_qty']))&&_0x5ddfbd++;});if(_0x5ddfbd!=0x0)return _0x251032[_0x5dee34(0x262)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x33147f[_0x5dee34(0x20d)](_0x5dee34(0x27d));const _0x260ac2=new purchases_return({'invoice':_0x18b3bb,'suppliers':_0x251032[_0x5dee34(0x277)][_0x5dee34(0x1c3)],'date':_0x51d4f0,'warehouse_name':_0x4e6adb,'return_product':_0x5ccdab,'note':_0x5f55ec,'room':_0x2a8752,'to_warehouse_name':_0x5a0fab,'to_room':_0x1d66df}),_0x31258b=await _0x260ac2[_0x5dee34(0x1fe)]();console['log'](_0x260ac2);const _0x36fd59=await purchases_return[_0x5dee34(0x2a5)]({'invoice':_0x18b3bb}),_0xb21e69=await warehouse[_0x5dee34(0x2a5)]({'name':_0x5a0fab,'room':_0x1d66df});_0x36fd59['return_product'][_0x5dee34(0x211)](_0x5826a4=>{var _0x38cae7=_0x5dee34,_0xac8c4d=0x0;const _0x4b9c52=_0xb21e69[_0x38cae7(0x254)][_0x38cae7(0x28a)](_0x58cc97=>{var _0x33c318=_0x38cae7;_0x58cc97[_0x33c318(0x243)]==_0x5826a4[_0x33c318(0x243)]&&_0x58cc97[_0x33c318(0x1e7)]==_0x5826a4[_0x33c318(0x1e7)]&&_0x58cc97[_0x33c318(0x278)]==_0x5826a4[_0x33c318(0x278)]&&_0x58cc97[_0x33c318(0x214)]==_0x5826a4['bin']&&_0x58cc97[_0x33c318(0x21d)]==_0x5826a4[_0x33c318(0x21d)]&&(_0x58cc97[_0x33c318(0x27f)]=parseInt(_0x58cc97[_0x33c318(0x27f)])-parseInt(_0x5826a4[_0x33c318(0x1f6)]),_0xac8c4d++);});_0xac8c4d=='0'&&(_0xb21e69['product_details']=_0xb21e69[_0x38cae7(0x254)]['concat']({'product_name':_0x5826a4[_0x38cae7(0x243)],'product_stock':_0x5826a4[_0x38cae7(0x1f6)],'primary_code':_0x5826a4[_0x38cae7(0x225)],'secondary_code':_0x5826a4[_0x38cae7(0x25a)],'product_code':_0x5826a4[_0x38cae7(0x1bd)],'storage':_0x5826a4[_0x38cae7(0x1dd)],'rack':_0x5826a4[_0x38cae7(0x268)],'bay':_0x5826a4['bay'],'bin':_0x5826a4[_0x38cae7(0x214)],'type':_0x5826a4[_0x38cae7(0x278)],'floorlevel':_0x5826a4['floorlevel'],'maxProducts':_0x5826a4[_0x38cae7(0x1f1)],'unit':_0x5826a4['standard_unit'],'secondary_unit':_0x5826a4[_0x38cae7(0x282)],'expiry_date':_0x5826a4[_0x38cae7(0x248)]}));}),await _0xb21e69[_0x5dee34(0x1fe)]();const _0x50bce5=await purchases[_0x5dee34(0x2a5)]({'invoice':_0x18b3bb});_0x50bce5[_0x5dee34(0x1fb)]=_0x5dee34(0x276);const _0x24aefb=await _0x50bce5[_0x5dee34(0x1fe)](),_0x352774=new s_payment_data({'invoice':_0x18b3bb,'suppliers':_0x251032[_0x5dee34(0x277)][_0x5dee34(0x1c3)],'reason':_0x5dee34(0x260)});await _0x352774[_0x5dee34(0x1fe)]();const _0x31c4b9=await master_shop[_0x5dee34(0x1a6)]();console['log'](_0x5dee34(0x1c9),_0x31c4b9[0x0][_0x5dee34(0x1d3)]);const _0x2b17fe=await email_settings[_0x5dee34(0x2a5)](),_0x1b6935=await suppliers[_0x5dee34(0x2a5)]({'name':_0x251032['body'][_0x5dee34(0x1c3)]});console[_0x5dee34(0x1c5)](_0x5dee34(0x1e9),_0x1b6935);_0x31c4b9[0x0][_0x5dee34(0x271)]==0x1?(right_currency=_0x31c4b9[0x0][_0x5dee34(0x221)],left_currency=''):(right_currency='',left_currency=_0x31c4b9[0x0]['currency']);var _0x31a701=_0x38e713,_0x3a2578=_0x3b42f0,_0x189f8c='',_0x3703dd;for(_0x3703dd in _0x31a701){_0x189f8c+=_0x5dee34(0x281)+_0x5dee34(0x24f)+_0x31a701[_0x3703dd]+_0x5dee34(0x1aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a2578[_0x3703dd]+_0x5dee34(0x1aa)+'</tr>';}console[_0x5dee34(0x1c5)](_0x5dee34(0x1b3),_0x189f8c);let _0x586a08=nodemailer[_0x5dee34(0x1c1)]({'service':_0x5dee34(0x1af),'auth':{'user':_0x2b17fe[_0x5dee34(0x21f)],'pass':_0x2b17fe[_0x5dee34(0x238)]}}),_0x3f3024={'from':_0x2b17fe[_0x5dee34(0x21f)],'to':_0x1b6935['email'],'subject':_0x5dee34(0x1bc),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5dee34(0x290)+_0x5dee34(0x1da)+_0x31c4b9[0x0][_0x5dee34(0x1d3)],'cid':_0x5dee34(0x237)}],'html':'<!DOCTYPE\x20html>'+_0x5dee34(0x23b)+_0x5dee34(0x233)+_0x5dee34(0x1c8)+_0x5dee34(0x24b)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x5dee34(0x1c8)+_0x5dee34(0x1f3)+_0x31c4b9[0x0][_0x5dee34(0x2ad)]+_0x5dee34(0x218)+_0x5dee34(0x209)+_0x5dee34(0x209)+'<hr\x20class=\x22my-3\x22>'+_0x5dee34(0x1c8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5dee34(0x1e2)+_0x18b3bb+'\x20'+_0x5dee34(0x284)+_0x5dee34(0x22e)+_0x51d4f0+'\x20'+_0x5dee34(0x1ab)+_0x5dee34(0x1e6)+_0x5dee34(0x209)+_0x5dee34(0x228)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5dee34(0x246)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x5dee34(0x1bb)+_0x5dee34(0x1fd)+_0x5dee34(0x1ce)+'\x20'+_0x189f8c+'\x20'+_0x5dee34(0x270)+_0x5dee34(0x20c)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x5dee34(0x28e)+_0x31c4b9[0x0]['site_title']+_0x5dee34(0x1e6)+_0x5dee34(0x209)+_0x5dee34(0x209)+_0x5dee34(0x1be)};_0x586a08[_0x5dee34(0x279)](_0x3f3024,function(_0x35c64f,_0x4556e9){var _0x27d0a0=_0x5dee34;_0x35c64f?(console['log'](_0x35c64f),console[_0x27d0a0(0x1c5)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x251032['flash']('success',_0x5dee34(0x20b)),_0x33147f[_0x5dee34(0x20d)](_0x5dee34(0x266));}catch(_0x9f9785){console[_0x5dee34(0x1c5)](_0x9f9785),_0x33147f[_0x5dee34(0x223)](0xc8)['json']({'message':_0x9f9785[_0x5dee34(0x1b0)]});}}),router[a0_0x5228a1(0x244)](a0_0x5228a1(0x285),auth,async(_0x1b2a43,_0x22f380)=>{var _0x5e7138=a0_0x5228a1;try{const {username:_0x476413,email:_0x2b86ea,role:_0x12e168}=_0x1b2a43[_0x5e7138(0x29c)],_0x49da5d=_0x1b2a43[_0x5e7138(0x29c)],_0x117622=await profile[_0x5e7138(0x2a5)]({'email':_0x49da5d[_0x5e7138(0x21f)]}),_0x4ce48a=await master_shop[_0x5e7138(0x1a6)](),_0x17c660=_0x1b2a43[_0x5e7138(0x23a)]['id'],_0xf536ca=await purchases[_0x5e7138(0x1d4)](_0x17c660);if(_0x4ce48a[0x0][_0x5e7138(0x29f)]==_0x5e7138(0x23e))var _0x4d1455=users[_0x5e7138(0x22f)];else{if(_0x4ce48a[0x0][_0x5e7138(0x29f)]==_0x5e7138(0x22a))var _0x4d1455=users[_0x5e7138(0x22a)];else{if(_0x4ce48a[0x0][_0x5e7138(0x29f)]==_0x5e7138(0x1bf))var _0x4d1455=users[_0x5e7138(0x1bf)];else{if(_0x4ce48a[0x0][_0x5e7138(0x29f)]==_0x5e7138(0x1b5))var _0x4d1455=users[_0x5e7138(0x1b5)];else{if(_0x4ce48a[0x0]['language']==_0x5e7138(0x230))var _0x4d1455=users['French'];else{if(_0x4ce48a[0x0]['language']=='Portuguese\x20(BR)')var _0x4d1455=users[_0x5e7138(0x1dc)];else{if(_0x4ce48a[0x0][_0x5e7138(0x29f)]==_0x5e7138(0x28b))var _0x4d1455=users[_0x5e7138(0x28b)];else{if(_0x4ce48a[0x0][_0x5e7138(0x29f)]==_0x5e7138(0x272))var _0x4d1455=users[_0x5e7138(0x257)];}}}}}}}_0x22f380[_0x5e7138(0x25d)](_0x5e7138(0x1fa),{'success':_0x1b2a43['flash'](_0x5e7138(0x240)),'errors':_0x1b2a43['flash'](_0x5e7138(0x29b)),'role':_0x49da5d,'profile':_0x117622,'alldata':_0xf536ca,'master_shop':_0x4ce48a,'language':_0x4d1455}),console[_0x5e7138(0x1c5)](alldata);}catch(_0x5144a7){console['log'](_0x5144a7);}}),router[a0_0x5228a1(0x1ae)](a0_0x5228a1(0x208),async(_0x3c07d6,_0x160a48)=>{var _0x205171=a0_0x5228a1;const {product_code:_0xf7e607}=_0x3c07d6[_0x205171(0x277)];var _0x45c346;const _0x340f81=await product[_0x205171(0x1cb)]([{'$match':{'primary_code':_0xf7e607,'product_category':_0x205171(0x23c)}},{'$group':{'_id':'$_id','name':{'$first':_0x205171(0x2b3)},'category':{'$first':_0x205171(0x205)},'brand':{'$first':'$brand'},'unit':{'$first':_0x205171(0x275)},'alertquantity':{'$first':_0x205171(0x2aa)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x205171(0x26b)},'secondary_code':{'$first':_0x205171(0x27e)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x205171(0x19f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x205171(0x22d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x153911=await product['aggregate']([{'$match':{'secondary_code':_0xf7e607,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x205171(0x289),'name':{'$first':'$name'},'category':{'$first':_0x205171(0x205)},'brand':{'$first':_0x205171(0x245)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x205171(0x21b)},'primary_code':{'$first':_0x205171(0x26b)},'secondary_code':{'$first':_0x205171(0x27e)},'maxStocks':{'$first':_0x205171(0x1d0)},'maxProdPerUnit':{'$first':_0x205171(0x19f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x205171(0x22d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x340f81['length']>0x0)_0x45c346=_0x340f81;else _0x153911[_0x205171(0x1ea)]>0x0&&(_0x45c346=_0x153911);_0x160a48[_0x205171(0x256)](_0x45c346);}),router[a0_0x5228a1(0x1ae)](a0_0x5228a1(0x1ef),async(_0x1db6db,_0x4a5764)=>{var _0x885807=a0_0x5228a1;const {primaryCode:_0x2d7d22,secondaryCode:_0x57ffd6,productCode:_0x2dfdb9,bay:_0xb9b993,bin:_0x2a85a2,types:_0x3a1d25,pallet:_0x5d85a3,warehouses:_0x3cfdb9,room:_0x4647f9}=_0x1db6db[_0x885807(0x277)];console[_0x885807(0x1c5)](_0x1db6db[_0x885807(0x277)]);try{const _0x25a948=await warehouse[_0x885807(0x1cb)]([{'$match':{'name':_0x3cfdb9,'room':_0x4647f9}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0xb9b993,'product_details.bin':_0x2a85a2,'product_details.type':_0x3a1d25}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x885807(0x1ba)},'level':{'$first':_0x885807(0x2a9)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x885807(0x236)},'maxProducts':{'$first':_0x885807(0x294)}}}]);_0x4a5764[_0x885807(0x223)](0xc8)[_0x885807(0x256)](_0x25a948);}catch(_0x2cb879){_0x4a5764[_0x885807(0x223)](0x194)[_0x885807(0x256)]({'message':_0x2cb879[_0x885807(0x1b0)]});}}),module['exports']=router;