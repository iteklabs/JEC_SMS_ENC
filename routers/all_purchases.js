var a0_0x28f6a0=a0_0x3273;(function(_0x3892a8,_0x4cb824){var _0x6479c7=a0_0x3273,_0x5ac1dc=_0x3892a8();while(!![]){try{var _0x33fc7d=-parseInt(_0x6479c7(0x1c4))/0x1+parseInt(_0x6479c7(0x215))/0x2+-parseInt(_0x6479c7(0x207))/0x3+-parseInt(_0x6479c7(0x19a))/0x4+parseInt(_0x6479c7(0x27c))/0x5*(-parseInt(_0x6479c7(0x256))/0x6)+-parseInt(_0x6479c7(0x18b))/0x7+parseInt(_0x6479c7(0x166))/0x8;if(_0x33fc7d===_0x4cb824)break;else _0x5ac1dc['push'](_0x5ac1dc['shift']());}catch(_0x3c64b8){_0x5ac1dc['push'](_0x5ac1dc['shift']());}}}(a0_0x2622,0x84a6f));const express=require('express'),app=express(),router=express[a0_0x28f6a0(0x19f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x28f6a0(0x170)),nodemailer=require(a0_0x28f6a0(0x25f));var ejs=require('ejs');function a0_0x3273(_0x3d3ed9,_0x4b171f){var _0x262266=a0_0x2622();return a0_0x3273=function(_0x327332,_0x2636a4){_0x327332=_0x327332-0x162;var _0x5ca845=_0x262266[_0x327332];return _0x5ca845;},a0_0x3273(_0x3d3ed9,_0x4b171f);}const path=require(a0_0x28f6a0(0x1c7)),users=require(a0_0x28f6a0(0x19c));router[a0_0x28f6a0(0x1ed)](a0_0x28f6a0(0x1b7),auth,async(_0x31fcf7,_0x35f667)=>{var _0x2394b6=a0_0x28f6a0;try{const {username:_0x5ebcd5,email:_0xabb05c,role:_0x2283da}=_0x31fcf7[_0x2394b6(0x1af)],_0x7e52f7=_0x31fcf7['user'],_0x23f256=await profile['findOne']({'email':_0x7e52f7[_0x2394b6(0x245)]}),_0x43dc65=await staff[_0x2394b6(0x1d1)]({'email':_0x7e52f7[_0x2394b6(0x245)]});if(_0x7e52f7[_0x2394b6(0x16e)]==_0x2394b6(0x23b)){const _0x1e4a11=await staff[_0x2394b6(0x1d1)]({'email':_0x7e52f7[_0x2394b6(0x245)]});}const _0x5d0eab=await master_shop['find']();let _0x1431bd;if(_0x7e52f7[_0x2394b6(0x16e)]==_0x2394b6(0x23b)){const _0x3d89c7=await staff['findOne']({'email':_0x7e52f7[_0x2394b6(0x245)]});_0x1431bd=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3d89c7[_0x2394b6(0x1be)]}},{'$lookup':{'from':'suppliers','localField':_0x2394b6(0x163),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x2394b6(0x1fe)},{'$group':{'_id':_0x2394b6(0x24c),'invoice':{'$first':_0x2394b6(0x273)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2394b6(0x1a9)},'warehouse_name':{'$first':_0x2394b6(0x1a7)},'room':{'$first':_0x2394b6(0x182)},'product':{'$push':_0x2394b6(0x1fe)},'note':{'$first':_0x2394b6(0x25c)},'paid_amount':{'$first':_0x2394b6(0x252)},'due_amount':{'$first':_0x2394b6(0x241)},'return_data':{'$first':_0x2394b6(0x257)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2394b6(0x17e)},'suppliers_docs':{'$first':_0x2394b6(0x26d)},'total_product_quantity':{'$sum':_0x2394b6(0x1f5)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2394b6(0x1b5)},'type':{'$addToSet':_0x2394b6(0x1b9)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1431bd=await purchases[_0x2394b6(0x23c)]([{'$lookup':{'from':_0x2394b6(0x163),'localField':_0x2394b6(0x163),'foreignField':_0x2394b6(0x173),'as':_0x2394b6(0x218)}},{'$unwind':_0x2394b6(0x26d)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2394b6(0x273)},'suppliers':{'$first':_0x2394b6(0x1a4)},'date':{'$first':_0x2394b6(0x1a9)},'warehouse_name':{'$first':_0x2394b6(0x1a7)},'room':{'$addToSet':_0x2394b6(0x1f3)},'product':{'$push':_0x2394b6(0x1fe)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2394b6(0x252)},'due_amount':{'$first':_0x2394b6(0x241)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x2394b6(0x17c)},'expiry_date':{'$first':_0x2394b6(0x17e)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2394b6(0x280)},'isle':{'$addToSet':_0x2394b6(0x1b5)},'type':{'$addToSet':_0x2394b6(0x1b9)},'floorlevel':{'$addToSet':_0x2394b6(0x20f)},'finalize':{'$first':_0x2394b6(0x253)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5d0eab[0x0][_0x2394b6(0x222)]==_0x2394b6(0x217)){var _0x4b8c08=users[_0x2394b6(0x1d0)];console[_0x2394b6(0x23e)](_0x4b8c08);}else{if(_0x5d0eab[0x0][_0x2394b6(0x222)]==_0x2394b6(0x25e))var _0x4b8c08=users[_0x2394b6(0x25e)];else{if(_0x5d0eab[0x0][_0x2394b6(0x222)]==_0x2394b6(0x276))var _0x4b8c08=users['German'];else{if(_0x5d0eab[0x0][_0x2394b6(0x222)]==_0x2394b6(0x17d))var _0x4b8c08=users[_0x2394b6(0x17d)];else{if(_0x5d0eab[0x0][_0x2394b6(0x222)]==_0x2394b6(0x221))var _0x4b8c08=users[_0x2394b6(0x221)];else{if(_0x5d0eab[0x0][_0x2394b6(0x222)]=='Portuguese\x20(BR)')var _0x4b8c08=users['Portuguese'];else{if(_0x5d0eab[0x0][_0x2394b6(0x222)]=='Chinese')var _0x4b8c08=users[_0x2394b6(0x1b3)];else{if(_0x5d0eab[0x0]['language']==_0x2394b6(0x214))var _0x4b8c08=users[_0x2394b6(0x24e)];}}}}}}}_0x35f667[_0x2394b6(0x1c3)](_0x2394b6(0x21b),{'success':_0x31fcf7[_0x2394b6(0x1c1)](_0x2394b6(0x1f2)),'errors':_0x31fcf7[_0x2394b6(0x1c1)]('errors'),'purchases':_0x1431bd,'role':_0x7e52f7,'profile':_0x23f256,'master_shop':_0x5d0eab,'language':_0x4b8c08});}catch(_0x518a00){console[_0x2394b6(0x23e)]('table\x20page',_0x518a00),_0x35f667[_0x2394b6(0x230)](0xc8)['json']({'message':_0x518a00[_0x2394b6(0x1c6)]});}});function a0_0x2622(){var _0xcfa10=['INC-','stock_data','return_purchase','suppliers_data','/../public','<!DOCTYPE\x20html>','$product','</tbody>','/invoice/:id','\x20<>\x20','alertQTY','here','prod_pallet','stocks','type','3007380bbWhmg','image','<strong>\x20Regards\x20</strong>','/view/:id','MaxStocks_data','\x20</h2>','$product_details.isle','filter','$product.floorlevel','production_date','level','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Arabic\x20(ae)','381480syJSfv','maxperunit','English\x20(US)','suppliers_docs','$product_details','return_data','all_purchases','prod_unit','gmail','Ambient','<div>','Receiving\x20Area','French','language','Paid\x20For\x20Purchase','</h5>','RoomAssign','prod_isle','length','json','$product_details.floorlevel','errors','deliverycode','floor','logo','prod_cat','getMonth','status','prod_code','/upload/','<h5\x20style=\x22text-align:\x20left;\x22>','</table>','paid_amount','/give_payment/:id','finalize','storage','Purchase\x20Mail','$product_details.primary_code','staff','aggregate','standard_unit','log','add_purchases\x20error','currency_placement','$due_amount','findById','</td>','getFullYear','email','invoice','Enclosed','forEach','product_code','$category','then','$_id','floorlevel','Arabic','host','secondary_unit','$secondary_code','$paid_amount','$finalize','/view/add_purchases','DRY\x20STORAGE','110796iaxYWn','$return_data','$product_details.product_name','Return\x20Goods','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Hindi','nodemailer','exports','$product_details.maxProducts','<tr>','prod_level','delivery_code','$product_details.rack','Portuguese\x20(BR)','rack','/all_purchases/view/','max_product_unit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<html><head><title></title>','product_name','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Raw\x20Materials','return_qty','prod_invoice','password','$invoice','all_purchases_barcode','$product_details.bin','German','$primary_code','secondary_code_hide','/view/add_purchases/:id','Enabled','$product_code','25YzpRbA','getDate','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<span\x20style=\x22float:\x20right;\x22>','$product.bay','Level','suppliers','warehouse_name','prod_primunit','19346024eYLexY','padStart','prod_secondunit','primary_code_hide','Rack\x20E','push','$product_details.bay','/preview/:id','role','</head><body>','../middleware/auth','site_title','$alertquantity','name','\x20Order\x20Date\x20:\x20','body','rak','</body></html>','Rack\x20B','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.secondary_code','isle','$batch_code','Spanish','$expiry_date','pallet','bin','actual_qty','$room','sendMail','prod_Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','find','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','purchase_quantity','post','5507159OIUMzD','all','currency','types','room','date','$product_details.level','back','amount','quantity','error','</thead>','payment\x20successfull','product','True','418872pHZgDv','product_stock','../public/language/languages.json','purchase\x20data\x20update\x20successfully','redirect','Router','<h2>\x20','product_details','save','prod_qty','$suppliers','$product_details.type','user_id','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$date','COLD\x20STORAGE','foreach\x20newproduct','/barcode_scanner','product_code_hide','Logo.png','user','primary_code','prod_name','batch_code','Chinese','An\x20error\x20occurred\x20while\x20saving\x20data.','$product.bin','master','/view','$unit','$product.type','Rack\x20D','Shelves','$product_details._id','$product_details.product_stock','warehouse','$product_details.product_code','An\x20error\x20occurred.','flash','product_cat','render','79405UssMHt','toString','message','path','maxStocks','$maxStocks','slice','<tbody\x20style=\x22text-align:\x20center;\x22>','due_amount','Rack\x20A','Floor','abs','English','findOne','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','POnumber','Purchase\x20Return','concat','bay','expiry_date','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$secondary_unit','\x20<\x20wew\x20>\x20','/barcode/:id','</tr>','string','$product_details.storage','/all_purchases/view','params','edit_purchases','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</div>','$brand','JO_number','stock_quantity','purchases\x20item\x20return\x20successfull','RMSEmail','$name','room_name','get','actual_uom','Portuguese','delivery_date','map','success','$product.room_name','secondary_code','$product.quantity','/view/return_purchase/:id','catch'];a0_0x2622=function(){return _0xcfa10;};return a0_0x2622();}function BayBinSelected(_0x44f138,_0x6baec){var _0xf3e2de=a0_0x28f6a0,_0x10f060=[],_0x3d32cd=[],_0xdef2ac=[],_0x13beb6=[],_0x5a0df9=[],_0x3bc07c=[];let _0x25b28e=[];if(_0x44f138==_0xf3e2de(0x255))switch(_0x6baec){case _0xf3e2de(0x1cd):_0x10f060=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x3d32cd=[0x1,0x2],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=['Level',_0xf3e2de(0x1ce)],_0x5a0df9=['D'],_0x3bc07c=['A'];break;case _0xf3e2de(0x178):_0x10f060=[0x6,0x5,0x4,0x3,0x2,0x1],_0x3d32cd=[0x1,0x2],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=[_0xf3e2de(0x162),'Floor'],_0x5a0df9=['D'],_0x3bc07c=['B'];break;case'Shelves':_0x10f060=[0x0],_0x3d32cd=[0x0],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=[_0xf3e2de(0x1ce)],_0x5a0df9=['D'],_0x3bc07c=['S'];break;case _0xf3e2de(0x220):_0x10f060=[0x0],_0x3d32cd=[0x0],_0x13beb6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xdef2ac=[_0xf3e2de(0x1ce)],_0x5a0df9=['D'],_0x3bc07c=['R'];break;}else{if(_0x44f138==_0xf3e2de(0x1aa))switch(_0x6baec){case _0xf3e2de(0x1cd):_0x10f060=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x3d32cd=['B','F'],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=[_0xf3e2de(0x162),_0xf3e2de(0x1ce)],_0x5a0df9=['C'],_0x3bc07c=['A'];break;case'Rack\x20B':_0x10f060=[0x5,0x4,0x3,0x2,0x1],_0x3d32cd=['F','B','S'],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=['Level',_0xf3e2de(0x1ce)],_0x5a0df9=['C'],_0x3bc07c=['B'];break;case'Rack\x20C':_0x10f060=[0x1,0x2,0x3,0x4,0x5],_0x3d32cd=['B','F','S'],_0x13beb6=[0x5,0x4,0x3,0x2,0x1],_0xdef2ac=[_0xf3e2de(0x162),_0xf3e2de(0x1ce)],_0x5a0df9=['C'],_0x3bc07c=['C'];break;case _0xf3e2de(0x1ba):_0x10f060=[0x5,0x4,0x3,0x2,0x1],_0x3d32cd=['F','B','S'],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=[_0xf3e2de(0x162),_0xf3e2de(0x1ce)],_0x5a0df9=['C'],_0x3bc07c=['D'];break;case _0xf3e2de(0x16a):_0x10f060=[0x4,0x3,0x2,0x1],_0x3d32cd=[0x1,0x2],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=[_0xf3e2de(0x162),_0xf3e2de(0x1ce)],_0x5a0df9=['C'],_0x3bc07c=['E'];break;case'Rack\x20F':_0x10f060=[0x1,0x2,0x3],_0x3d32cd=[0x1,0x2],_0x13beb6=[0x1,0x2,0x3,0x4,0x5],_0xdef2ac=[_0xf3e2de(0x162)],_0x5a0df9=['C'],_0x3bc07c=['F'];break;}}return{'levels':_0x10f060,'Isle':_0x3d32cd,'rack':_0x13beb6,'type':_0xdef2ac,'storage':_0x5a0df9,'rak':_0x3bc07c};}async function getRandom8DigitNumber(){var _0x2c0bce=a0_0x28f6a0;const _0x9fec6e=0x989680,_0x2678ad=0x5f5e0ff,_0x5c38f9=Math[_0x2c0bce(0x22c)](Math['random']()*(_0x2678ad-_0x9fec6e+0x1))+_0x9fec6e;var _0x24c681;const _0x5df508=await purchases[_0x2c0bce(0x1d1)]({'invoice':_0x2c0bce(0x1f8)+_0x5c38f9});return _0x5df508&&_0x5df508[_0x2c0bce(0x227)]>0x0?_0x24c681=_0x2c0bce(0x1f8)+_0x5c38f9:_0x24c681=_0x2c0bce(0x1f8)+_0x5c38f9,_0x24c681;}router[a0_0x28f6a0(0x1ed)](a0_0x28f6a0(0x254),auth,async(_0x4879b4,_0x3bcc2e)=>{var _0x58bef5=a0_0x28f6a0;try{const {username:_0x27e6a4,email:_0x19962e,role:_0x61b9a3}=_0x4879b4[_0x58bef5(0x1af)],_0x54fcba=_0x4879b4['user'],_0x5d2191=await profile[_0x58bef5(0x1d1)]({'email':_0x54fcba[_0x58bef5(0x245)]}),_0x18217a=await master_shop[_0x58bef5(0x186)](),_0x47712f=await staff[_0x58bef5(0x1d1)]({'email':_0x54fcba['email']}),_0x53a232=await suppliers['find']({});let _0x3dd52d;if(_0x54fcba[_0x58bef5(0x16e)]==_0x58bef5(0x23b)){const _0xbe2d08=await staff[_0x58bef5(0x1d1)]({'email':_0x54fcba[_0x58bef5(0x245)]});_0x3dd52d=await warehouse[_0x58bef5(0x23c)]([{'$match':{'status':_0x58bef5(0x27a),'name':_0xbe2d08[_0x58bef5(0x1be)],'warehouse_category':_0x58bef5(0x26f),'name':{'$ne':_0x58bef5(0x259)}}},{'$group':{'_id':_0x58bef5(0x1eb),'name':{'$first':_0x58bef5(0x1eb)}}}]);}else _0x3dd52d=await warehouse[_0x58bef5(0x23c)]([{'$match':{'status':_0x58bef5(0x27a),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x58bef5(0x259)}}},{'$group':{'_id':'$name','name':{'$first':_0x58bef5(0x1eb)}}}]);const _0x1cf419=await product[_0x58bef5(0x186)]({}),_0x5e6f0d=await warehouse[_0x58bef5(0x186)]({'status':_0x58bef5(0x27a)}),_0x39bccb=await purchases['find']({}),_0x1575c6=_0x39bccb['length']+0x1,_0x408d02=_0x58bef5(0x1f8)+_0x1575c6[_0x58bef5(0x1c5)]()[_0x58bef5(0x167)](0x5,'0');var _0x8e306f=[_0x58bef5(0x21e),_0x58bef5(0x247)];if(_0x18217a[0x0]['language']==_0x58bef5(0x217))var _0x3de40a=users[_0x58bef5(0x1d0)];else{if(_0x18217a[0x0]['language']==_0x58bef5(0x25e))var _0x3de40a=users['Hindi'];else{if(_0x18217a[0x0][_0x58bef5(0x222)]==_0x58bef5(0x276))var _0x3de40a=users[_0x58bef5(0x276)];else{if(_0x18217a[0x0][_0x58bef5(0x222)]==_0x58bef5(0x17d))var _0x3de40a=users[_0x58bef5(0x17d)];else{if(_0x18217a[0x0]['language']==_0x58bef5(0x221))var _0x3de40a=users[_0x58bef5(0x221)];else{if(_0x18217a[0x0][_0x58bef5(0x222)]=='Portuguese\x20(BR)')var _0x3de40a=users[_0x58bef5(0x1ef)];else{if(_0x18217a[0x0][_0x58bef5(0x222)]==_0x58bef5(0x1b3))var _0x3de40a=users[_0x58bef5(0x1b3)];else{if(_0x18217a[0x0][_0x58bef5(0x222)]==_0x58bef5(0x214))var _0x3de40a=users['Arabic'];}}}}}}}const _0x48f56b=getRandom8DigitNumber();_0x48f56b[_0x58bef5(0x24b)](_0x2e47c1=>{var _0x31aa39=_0x58bef5;_0x3bcc2e[_0x31aa39(0x1c3)]('add_purchases',{'success':_0x4879b4[_0x31aa39(0x1c1)](_0x31aa39(0x1f2)),'errors':_0x4879b4['flash'](_0x31aa39(0x22a)),'role':_0x54fcba,'profile':_0x5d2191,'suppliers':_0x53a232,'warehouse':_0x3dd52d,'product':_0x1cf419,'invoice':_0x2e47c1,'master_shop':_0x18217a,'language':_0x3de40a,'find_data':_0x5e6f0d,'rooms_data':_0x8e306f});})[_0x58bef5(0x1f7)](_0xfb4ba0=>{var _0x251b52=_0x58bef5;_0x4879b4['flash']('errors',_0x251b52(0x1e3)),_0x3bcc2e[_0x251b52(0x19e)](_0x251b52(0x1e0));});}catch(_0x2a3594){console[_0x58bef5(0x23e)](_0x2a3594);}}),router['get'](a0_0x28f6a0(0x279),auth,async(_0x51b57e,_0x301b8e)=>{var _0x5ce27d=a0_0x28f6a0;try{const _0xe88da2=_0x51b57e['params']['id'];console[_0x5ce27d(0x23e)](_0xe88da2);const _0x4c30ed=await master_shop['find']();console[_0x5ce27d(0x23e)](_0x5ce27d(0x1b6),_0x4c30ed);const _0x29b971=await product[_0x5ce27d(0x1d1)]({'name':_0xe88da2});console['log']('product',_0x29b971),_0x301b8e[_0x5ce27d(0x230)](0xc8)[_0x5ce27d(0x228)]({'product_data':_0x29b971,'master':_0x4c30ed});}catch(_0x367f63){console[_0x5ce27d(0x23e)](_0x5ce27d(0x23f),_0x367f63);}}),router[a0_0x28f6a0(0x18a)](a0_0x28f6a0(0x254),auth,async(_0x3fcfce,_0x2fbc78)=>{var _0x1227b6=a0_0x28f6a0;try{const {invoice:_0x4fba4d,date:_0xc505ab,warehouse_name:_0x59c02f,prod_name:_0x2f1ebc,prod_code:_0x35fd1b,prod_qty:_0x156e39,prod_unit:_0x4c0537,prod_secondunit:_0xd3dfe7,prod_level:_0xb095d7,prod_isle:_0x50ab3b,prod_pallet:_0x4dd920,note:_0x377ddc,expiry_date:_0x30f1a2,batch_code:_0x36c6a4,payable:_0x4ebce4,due_amount:_0x566c9e,Room_name:_0x313326,primary_code:_0x279600,secondary_code:_0x635888,MaxStocks_data:_0x1c0092,PO_number:_0x353acd,SCRN:_0x57fa23,JO_number:_0x5d082d}=_0x3fcfce['body'];if(typeof _0x2f1ebc==_0x1227b6(0x1de))var _0x12f3ae=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1b1)]],_0x853317=[_0x3fcfce['body'][_0x1227b6(0x231)]],_0x4a6a13=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x184)]],_0x12fc85=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x165)]],_0x23b0ff=[_0x3fcfce[_0x1227b6(0x175)]['prod_secondunit']],_0x74dec2=[_0x3fcfce[_0x1227b6(0x175)]['prod_level']],_0x3fefc0=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1b0)]],_0x2aec19=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1f4)]],_0x2208e5=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x20b)]],_0x13d9c3=[_0x3fcfce[_0x1227b6(0x175)]['batch_code']],_0x10a9f9=[_0x3fcfce[_0x1227b6(0x175)]['expiry_date']],_0x3d76c4=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x269)]],_0x30e139=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x202)]],_0x536400=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x210)]],_0x38d5c5=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x22e)]],_0x24293a=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x225)]],_0x4baa6e=[_0x3fcfce[_0x1227b6(0x175)]['deliverycode']],_0x255ed7=[_0x3fcfce['body'][_0x1227b6(0x271)]],_0x2b7b12=[_0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x181)]],_0x10771b=[_0x3fcfce['body'][_0x1227b6(0x1ee)]];else var _0x12f3ae=[..._0x3fcfce['body'][_0x1227b6(0x1b1)]],_0x853317=[..._0x3fcfce[_0x1227b6(0x175)]['prod_code']],_0x4a6a13=[..._0x3fcfce[_0x1227b6(0x175)]['prod_Qty']],_0x12fc85=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x165)]],_0x23b0ff=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x168)]],_0x74dec2=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x263)]],_0x3fefc0=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1b0)]],_0x2aec19=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1f4)]],_0x2208e5=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x20b)]],_0x13d9c3=[..._0x3fcfce[_0x1227b6(0x175)]['batch_code']],_0x10a9f9=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1d8)]],_0x3d76c4=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x269)]],_0x30e139=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x202)]],_0x536400=[..._0x3fcfce[_0x1227b6(0x175)]['production_date']],_0x38d5c5=[..._0x3fcfce['body']['prod_cat']],_0x24293a=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x225)]],_0x4baa6e=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x22b)]],_0x255ed7=[..._0x3fcfce[_0x1227b6(0x175)]['prod_invoice']],_0x2b7b12=[..._0x3fcfce['body'][_0x1227b6(0x181)]],_0x10771b=[..._0x3fcfce[_0x1227b6(0x175)][_0x1227b6(0x1ee)]];const _0x2e5cf7=_0x12f3ae[_0x1227b6(0x1f1)](_0x1d7bfa=>{return _0x1d7bfa={'product_name':_0x1d7bfa};});_0x2b7b12['forEach']((_0x21cd40,_0x4a94fc)=>{var _0xbb4ae6=_0x1227b6;_0x2e5cf7[_0x4a94fc][_0xbb4ae6(0x181)]=Math[_0xbb4ae6(0x1cf)](_0x21cd40);}),_0x10771b[_0x1227b6(0x248)]((_0x3c5dfd,_0x526276)=>{_0x2e5cf7[_0x526276]['actual_uom']=_0x3c5dfd;}),_0x853317[_0x1227b6(0x248)]((_0x1763ca,_0x2fdbb3)=>{_0x2e5cf7[_0x2fdbb3]['product_code']=_0x1763ca;}),_0x4a6a13[_0x1227b6(0x248)]((_0x558a31,_0x159deb)=>{var _0x1c4cca=_0x1227b6;_0x2e5cf7[_0x159deb][_0x1c4cca(0x194)]=Math[_0x1c4cca(0x1cf)](_0x558a31);}),_0x12fc85[_0x1227b6(0x248)]((_0x3e945d,_0x3cbaca)=>{var _0x37ff9d=_0x1227b6;_0x2e5cf7[_0x3cbaca][_0x37ff9d(0x23d)]=_0x3e945d;}),_0x23b0ff[_0x1227b6(0x248)]((_0x536b37,_0x1b6b53)=>{var _0x10ffa4=_0x1227b6;_0x2e5cf7[_0x1b6b53][_0x10ffa4(0x250)]=_0x536b37;}),_0x74dec2[_0x1227b6(0x248)]((_0xf4f7f3,_0x15fcca)=>{var _0x45939f=_0x1227b6;_0x24293a[_0x45939f(0x248)]((_0x4443e8,_0x2de92c)=>{var _0x289315=_0x45939f;if(_0x4443e8==_0x289315(0x220)&&_0x15fcca==_0x2de92c){console['log'](_0x4443e8+_0x289315(0x1db)+_0x15fcca+'\x20<>\x20'+_0x2de92c+_0x289315(0x201)+_0xf4f7f3);var _0x8ef782=_0xf4f7f3[_0x289315(0x1ca)](0x3);_0x2e5cf7[_0x15fcca]['storage']=_0xf4f7f3[0x0],_0x2e5cf7[_0x15fcca][_0x289315(0x267)]=_0xf4f7f3[0x1],_0x2e5cf7[_0x15fcca][_0x289315(0x1d7)]=0x0,_0x2e5cf7[_0x15fcca][_0x289315(0x180)]=0x0,_0x2e5cf7[_0x15fcca][_0x289315(0x206)]='Floor',_0x2e5cf7[_0x15fcca][_0x289315(0x24d)]=_0x8ef782;}else{if(_0x4443e8==_0x289315(0x1bb)&&_0x15fcca==_0x2de92c){var _0x8ef782=_0xf4f7f3[_0x289315(0x1ca)](0x3);_0x2e5cf7[_0x15fcca]['storage']=_0xf4f7f3[0x0],_0x2e5cf7[_0x15fcca][_0x289315(0x267)]=_0xf4f7f3[0x1],_0x2e5cf7[_0x15fcca]['bay']=0x0,_0x2e5cf7[_0x15fcca]['bin']=0x0,_0x2e5cf7[_0x15fcca][_0x289315(0x206)]=_0x289315(0x1ce),_0x2e5cf7[_0x15fcca]['floorlevel']=_0xf4f7f3[0x5];}else{if(_0x15fcca==_0x2de92c){if(_0xf4f7f3[0x0]=='A'&&_0xf4f7f3[0x1]=='L'&&_0xf4f7f3[0x2]=='L')console[_0x289315(0x23e)](_0x4443e8+_0x289315(0x201)+_0x15fcca+'\x20<>\x20'+_0x2de92c+_0x289315(0x201)+_0xf4f7f3+_0x289315(0x203)),_0x2e5cf7[_0x15fcca][_0x289315(0x238)]=_0xf4f7f3[0x0],_0x2e5cf7[_0x15fcca]['rack']=_0xf4f7f3[0x1],_0x2e5cf7[_0x15fcca]['bay']=0x0,_0x2e5cf7[_0x15fcca][_0x289315(0x180)]=0x0,_0x2e5cf7[_0x15fcca]['type']=_0x289315(0x1ce),_0x2e5cf7[_0x15fcca][_0x289315(0x24d)]=_0xf4f7f3[0x3];else{var _0x58ee23;if(_0xf4f7f3[0x4]=='L')_0x58ee23=_0x289315(0x162);else _0xf4f7f3[0x4]=='F'&&(_0x58ee23='Floor');_0x2e5cf7[_0x15fcca][_0x289315(0x238)]=_0xf4f7f3[0x0],_0x2e5cf7[_0x15fcca][_0x289315(0x267)]=_0xf4f7f3[0x1],_0x2e5cf7[_0x15fcca][_0x289315(0x1d7)]=_0xf4f7f3[0x2],_0x2e5cf7[_0x15fcca][_0x289315(0x180)]=_0xf4f7f3[0x3],_0x2e5cf7[_0x15fcca][_0x289315(0x206)]=_0x58ee23,_0x2e5cf7[_0x15fcca]['floorlevel']=_0xf4f7f3[0x5];}}}}});}),_0x3fefc0[_0x1227b6(0x248)]((_0x50552c,_0x2e8135)=>{var _0x37af53=_0x1227b6;_0x2e5cf7[_0x2e8135][_0x37af53(0x1b0)]=_0x50552c;}),_0x2aec19[_0x1227b6(0x248)]((_0x23e78d,_0x1c8c80)=>{var _0x499dea=_0x1227b6;_0x2e5cf7[_0x1c8c80][_0x499dea(0x1f4)]=_0x23e78d;}),_0x2208e5[_0x1227b6(0x248)]((_0x14129a,_0x7375e4)=>{var _0x5121ed=_0x1227b6;_0x2e5cf7[_0x7375e4][_0x5121ed(0x1c8)]=_0x14129a;}),_0x13d9c3[_0x1227b6(0x248)]((_0x49f215,_0x3f163c)=>{_0x2e5cf7[_0x3f163c]['batch_code']=_0x49f215;}),_0x10a9f9[_0x1227b6(0x248)]((_0x2b65a4,_0x64ccea)=>{var _0x3c49f9=_0x1227b6;_0x2e5cf7[_0x64ccea][_0x3c49f9(0x1d8)]=_0x2b65a4;}),_0x3d76c4[_0x1227b6(0x248)]((_0x1e7c96,_0xe60b0c)=>{var _0x4116f8=_0x1227b6;_0x2e5cf7[_0xe60b0c][_0x4116f8(0x216)]=_0x1e7c96;}),_0x30e139[_0x1227b6(0x248)]((_0x4fdbe3,_0x43cab9)=>{var _0x3dded8=_0x1227b6;_0x2e5cf7[_0x43cab9][_0x3dded8(0x202)]=_0x4fdbe3;}),_0x536400['forEach']((_0x5f3daf,_0x2f40cc)=>{_0x2e5cf7[_0x2f40cc]['production_date']=_0x5f3daf;}),_0x38d5c5[_0x1227b6(0x248)]((_0x548ea0,_0x115fa4)=>{var _0xa0c359=_0x1227b6;_0x2e5cf7[_0x115fa4][_0xa0c359(0x1c2)]=_0x548ea0;}),_0x24293a[_0x1227b6(0x248)]((_0x5d6d7d,_0x24b8a7)=>{var _0x377915=_0x1227b6;_0x2e5cf7[_0x24b8a7][_0x377915(0x1ec)]=_0x5d6d7d;}),_0x4baa6e['forEach']((_0x558365,_0x2d3de0)=>{_0x2e5cf7[_0x2d3de0]['delivery_code']=_0x558365;}),_0x255ed7[_0x1227b6(0x248)]((_0x397540,_0x586d84)=>{var _0x426fbb=_0x1227b6;_0x2e5cf7[_0x586d84][_0x426fbb(0x246)]=_0x397540;});const _0x3ae4a2=_0x24293a['map'](_0x1e7eee=>{return _0x1e7eee={'room_name':_0x1e7eee};}),_0x498683=_0x2e5cf7[_0x1227b6(0x20e)](_0x155874=>_0x155874[_0x1227b6(0x194)]!=='0'&&_0x155874[_0x1227b6(0x194)]!==''),_0x3a8b5a=new purchases({'invoice':_0x4fba4d,'suppliers':_0x3fcfce['body']['suppliers'],'date':_0xc505ab,'warehouse_name':_0x59c02f,'product':_0x498683,'note':_0x377ddc,'due_amount':_0x566c9e,'POnumber':_0x353acd,'SCRN':_0x57fa23,'JO_number':_0x5d082d,'roomList':_0x3ae4a2}),_0x9b7035=await _0x3a8b5a[_0x1227b6(0x1a2)](),_0x5bf4b7=await purchases[_0x1227b6(0x1d1)]({'invoice':_0x4fba4d}),_0x387890=_0x5bf4b7[_0x1227b6(0x198)][_0x1227b6(0x1f1)](async _0x30e24e=>{var _0x489d0a=_0x1227b6,_0x46c4f8=await warehouse[_0x489d0a(0x1d1)]({'name':_0x59c02f,'room':_0x30e24e['room_name']}),_0x3afb01=0x0;return _0x46c4f8[_0x489d0a(0x1a1)]['forEach'](_0x26a2cc=>{var _0xad4cff=_0x489d0a;_0x26a2cc['product_name']==_0x30e24e[_0xad4cff(0x26c)]&&_0x26a2cc[_0xad4cff(0x24d)]==_0x30e24e['floorlevel']&&_0x26a2cc[_0xad4cff(0x206)]==_0x30e24e[_0xad4cff(0x206)]&&_0x26a2cc[_0xad4cff(0x180)]==_0x30e24e[_0xad4cff(0x180)]&&_0x26a2cc[_0xad4cff(0x1d7)]==_0x30e24e[_0xad4cff(0x1d7)]&&_0x26a2cc[_0xad4cff(0x267)]==_0x30e24e[_0xad4cff(0x267)]&&_0x26a2cc[_0xad4cff(0x238)]==_0x30e24e[_0xad4cff(0x238)]&&_0x26a2cc[_0xad4cff(0x1d8)]==_0x30e24e[_0xad4cff(0x1d8)]&&_0x26a2cc['batch_code']==_0x30e24e[_0xad4cff(0x1b2)]&&_0x26a2cc[_0xad4cff(0x210)]==_0x30e24e[_0xad4cff(0x210)]&&_0x26a2cc[_0xad4cff(0x246)]==_0x5bf4b7['invoice']&&(_0x26a2cc[_0xad4cff(0x19b)]+=Math[_0xad4cff(0x1cf)](_0x30e24e[_0xad4cff(0x194)]),_0x3afb01++);}),_0x3afb01===0x0&&_0x46c4f8[_0x489d0a(0x1a1)][_0x489d0a(0x16b)]({'product_name':_0x30e24e[_0x489d0a(0x26c)],'product_stock':Math[_0x489d0a(0x1cf)](_0x30e24e[_0x489d0a(0x194)]),'primary_code':_0x30e24e[_0x489d0a(0x1b0)],'secondary_code':_0x30e24e[_0x489d0a(0x1f4)],'product_code':_0x30e24e[_0x489d0a(0x249)],'storage':_0x30e24e[_0x489d0a(0x238)],'rack':_0x30e24e[_0x489d0a(0x267)],'bay':_0x30e24e[_0x489d0a(0x1d7)],'bin':_0x30e24e[_0x489d0a(0x180)],'type':_0x30e24e[_0x489d0a(0x206)],'floorlevel':_0x30e24e[_0x489d0a(0x24d)],'maxProducts':_0x30e24e['maxStocks'],'unit':_0x30e24e[_0x489d0a(0x23d)],'secondary_unit':_0x30e24e[_0x489d0a(0x250)],'expiry_date':_0x30e24e[_0x489d0a(0x1d8)],'maxPerUnit':_0x30e24e['maxperunit'],'batch_code':_0x30e24e['batch_code'],'alertQTY':_0x30e24e[_0x489d0a(0x202)],'production_date':_0x30e24e[_0x489d0a(0x210)],'product_cat':_0x30e24e[_0x489d0a(0x1c2)],'invoice':_0x30e24e[_0x489d0a(0x246)],'actual_qty':Math[_0x489d0a(0x1cf)](_0x30e24e['actual_qty']),'actual_uom':_0x30e24e[_0x489d0a(0x1ee)]}),_0x46c4f8;});Promise[_0x1227b6(0x18c)](_0x387890)['then'](async _0x83be36=>{var _0x485dfd=_0x1227b6;try{for(const _0x4ded4e of _0x83be36){await _0x4ded4e[_0x485dfd(0x1a2)]();}const _0x5b8536=await master_shop['find'](),_0x445f24=await email_settings[_0x485dfd(0x1d1)](),_0x282b18=await supervisor_settings[_0x485dfd(0x186)]();var _0x12748b=_0x5bf4b7[_0x485dfd(0x198)],_0x13e0cf='',_0x5aaf36;for(_0x5aaf36 in _0x12748b){_0x13e0cf+=_0x485dfd(0x262)+_0x485dfd(0x25a)+_0x12748b[_0x5aaf36][_0x485dfd(0x26c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12748b[_0x5aaf36]['product_code']+_0x485dfd(0x243)+_0x485dfd(0x25a)+_0x12748b[_0x5aaf36][_0x485dfd(0x194)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12748b[_0x5aaf36][_0x485dfd(0x23d)]+'</td>'+_0x485dfd(0x25a)+_0x12748b[_0x5aaf36][_0x485dfd(0x250)]+_0x485dfd(0x243)+_0x485dfd(0x25a)+_0x5bf4b7['warehouse_name']+'</td>'+_0x485dfd(0x25a)+_0x12748b[_0x5aaf36][_0x485dfd(0x1ec)]+_0x485dfd(0x243)+_0x485dfd(0x25a)+_0x12748b[_0x5aaf36][_0x485dfd(0x238)]+_0x12748b[_0x5aaf36]['rack']+_0x12748b[_0x5aaf36][_0x485dfd(0x1d7)]+_0x12748b[_0x5aaf36][_0x485dfd(0x180)]+_0x12748b[_0x5aaf36][_0x485dfd(0x206)][0x0]+_0x12748b[_0x5aaf36][_0x485dfd(0x24d)]+_0x485dfd(0x243),_0x485dfd(0x1dd);}let _0x12217f=nodemailer['createTransport']({'host':_0x445f24[_0x485dfd(0x24f)],'port':Number(_0x445f24['port']),'secure':![],'auth':{'user':_0x445f24[_0x485dfd(0x245)],'pass':_0x445f24['password']}}),_0x518015={'from':_0x445f24[_0x485dfd(0x245)],'to':_0x282b18[0x0][_0x485dfd(0x1ea)],'subject':_0x485dfd(0x239),'attachments':[{'filename':_0x485dfd(0x1ae),'path':__dirname+_0x485dfd(0x1fc)+_0x485dfd(0x232)+_0x5b8536[0x0][_0x485dfd(0x208)],'cid':_0x485dfd(0x22d)}],'html':_0x485dfd(0x1fd)+_0x485dfd(0x26b)+_0x485dfd(0x16f)+_0x485dfd(0x21f)+_0x485dfd(0x26a)+_0x485dfd(0x21f)+_0x485dfd(0x27e)+_0x485dfd(0x1e5)+_0x485dfd(0x21f)+_0x485dfd(0x1a0)+_0x5b8536[0x0][_0x485dfd(0x171)]+_0x485dfd(0x20c)+'</div>'+_0x485dfd(0x1e5)+_0x485dfd(0x212)+'<div>'+_0x485dfd(0x233)+'\x20Order\x20Number\x20:\x20'+_0x5bf4b7[_0x485dfd(0x246)]+'\x20'+_0x485dfd(0x27f)+_0x485dfd(0x174)+_0x5bf4b7[_0x485dfd(0x190)]+'\x20'+_0x485dfd(0x187)+_0x485dfd(0x224)+_0x485dfd(0x1e5)+_0x485dfd(0x1d2)+_0x485dfd(0x1e4)+_0x485dfd(0x262)+_0x485dfd(0x25b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x485dfd(0x179)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x485dfd(0x213)+_0x485dfd(0x185)+_0x485dfd(0x26e)+_0x485dfd(0x188)+_0x485dfd(0x1dd)+_0x485dfd(0x196)+_0x485dfd(0x1cb)+'\x20'+_0x13e0cf+'\x20'+_0x485dfd(0x1ff)+_0x485dfd(0x234)+'<div>'+_0x485dfd(0x209)+'<h5>'+_0x5b8536[0x0]['site_title']+'</h5>'+'</div>'+'</div>'+_0x485dfd(0x177)};_0x12217f['sendMail'](_0x518015,function(_0xac9625,_0x18a97c){var _0x6a7427=_0x485dfd;_0xac9625?(console[_0x6a7427(0x23e)](_0xac9625),console[_0x6a7427(0x23e)]('Error\x20Occurs')):console[_0x6a7427(0x23e)](_0x6a7427(0x1d3));}),_0x3fcfce['flash'](_0x485dfd(0x1f2),'Purchase\x20data\x20added\x20successfully'),_0x2fbc78[_0x485dfd(0x19e)](_0x485dfd(0x268));}catch(_0x49061d){console[_0x485dfd(0x195)](_0x49061d),_0x2fbc78[_0x485dfd(0x230)](0x1f4)['json']({'error':_0x485dfd(0x1b4)});}})[_0x1227b6(0x1f7)](_0x1286ee=>{var _0x3316ba=_0x1227b6;console[_0x3316ba(0x195)](_0x1286ee),_0x2fbc78[_0x3316ba(0x230)](0x1f4)[_0x3316ba(0x228)]({'error':_0x3316ba(0x1c0)});});}catch(_0x214d5d){console['log'](_0x214d5d);}}),router[a0_0x28f6a0(0x1ed)](a0_0x28f6a0(0x16d),auth,async(_0xd7b418,_0x3c3291)=>{var _0x34f851=a0_0x28f6a0;try{const {username:_0x1423ff,email:_0x24c9bc,role:_0xda5718}=_0xd7b418[_0x34f851(0x1af)],_0x3f709c=_0xd7b418[_0x34f851(0x1af)],_0xc7f86f=await profile[_0x34f851(0x1d1)]({'email':_0x3f709c[_0x34f851(0x245)]}),_0x503ac0=await master_shop[_0x34f851(0x186)](),_0x30315c=_0xd7b418['params']['id'],_0x50019a=await purchases[_0x34f851(0x242)](_0x30315c),_0x2cf9ba=await warehouse[_0x34f851(0x23c)]([{'$match':{'name':_0x50019a[_0x34f851(0x164)],'room':_0x50019a[_0x34f851(0x18f)]}},{'$unwind':_0x34f851(0x219)},{'$group':{'_id':_0x34f851(0x1bc),'name':{'$first':_0x34f851(0x258)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x34f851(0x275)},'type':{'$first':_0x34f851(0x1a5)},'floorlevel':{'$first':_0x34f851(0x229)},'primary_code':{'$first':_0x34f851(0x23a)},'secondary_code':{'$first':_0x34f851(0x17a)},'product_code':{'$first':_0x34f851(0x1bf)},'storage':{'$first':_0x34f851(0x1df)},'rack':{'$first':_0x34f851(0x265)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0xec695=await customer[_0x34f851(0x186)]({});let _0x556ca8;if(_0x3f709c[_0x34f851(0x16e)]=='staff'){const _0x21a1d8=await staff[_0x34f851(0x1d1)]({'email':_0x3f709c[_0x34f851(0x245)]});_0x556ca8=await warehouse[_0x34f851(0x23c)]([{'$match':{'status':_0x34f851(0x27a),'name':_0x21a1d8[_0x34f851(0x1be)]}},{'$group':{'_id':'$name','name':{'$first':_0x34f851(0x1eb)}}}]);}else _0x556ca8=await warehouse[_0x34f851(0x23c)]([{'$match':{'status':_0x34f851(0x27a)}},{'$group':{'_id':_0x34f851(0x1eb),'name':{'$first':'$name'}}}]);const _0x467cc5=await product[_0x34f851(0x186)]({}),_0x12c6a1=await suppliers[_0x34f851(0x186)]({}),_0x1a4363=BayBinSelected(_0x50019a[_0x34f851(0x164)],_0x50019a[_0x34f851(0x18f)]);if(_0x503ac0[0x0][_0x34f851(0x222)]==_0x34f851(0x217)){var _0x4743b9=users[_0x34f851(0x1d0)];console[_0x34f851(0x23e)](_0x4743b9);}else{if(_0x503ac0[0x0][_0x34f851(0x222)]==_0x34f851(0x25e))var _0x4743b9=users[_0x34f851(0x25e)];else{if(_0x503ac0[0x0]['language']==_0x34f851(0x276))var _0x4743b9=users[_0x34f851(0x276)];else{if(_0x503ac0[0x0][_0x34f851(0x222)]==_0x34f851(0x17d))var _0x4743b9=users[_0x34f851(0x17d)];else{if(_0x503ac0[0x0][_0x34f851(0x222)]==_0x34f851(0x221))var _0x4743b9=users[_0x34f851(0x221)];else{if(_0x503ac0[0x0][_0x34f851(0x222)]=='Portuguese\x20(BR)')var _0x4743b9=users[_0x34f851(0x1ef)];else{if(_0x503ac0[0x0][_0x34f851(0x222)]=='Chinese')var _0x4743b9=users[_0x34f851(0x1b3)];else{if(_0x503ac0[0x0]['language']==_0x34f851(0x214))var _0x4743b9=users[_0x34f851(0x24e)];}}}}}}}_0x3c3291[_0x34f851(0x1c3)]('edit_purchases_view',{'success':_0xd7b418[_0x34f851(0x1c1)](_0x34f851(0x1f2)),'errors':_0xd7b418[_0x34f851(0x1c1)]('errors'),'role':_0x3f709c,'profile':_0xc7f86f,'customer':_0xec695,'warehouse':_0x556ca8,'product':_0x2cf9ba,'user':_0x50019a,'master_shop':_0x503ac0,'unit':_0x467cc5,'language':_0x4743b9,'suppliers':_0x12c6a1,'dataSelected':_0x1a4363});}catch(_0x28e3b6){console[_0x34f851(0x23e)](_0x28e3b6);}}),router[a0_0x28f6a0(0x18a)](a0_0x28f6a0(0x16d),auth,async(_0x442ebb,_0x4f5208)=>{var _0xa090c8=a0_0x28f6a0;try{const _0xfb2fd4=_0x442ebb[_0xa090c8(0x1e1)]['id'],{invoice:_0x492a7c,warehouse_name:_0x17dff3,Room_name:_0x2d8d88}=_0x442ebb[_0xa090c8(0x175)],_0x450fb1=await warehouse['findOne']({'name':_0x17dff3,'room':_0x2d8d88}),_0x17af8f=await purchases[_0xa090c8(0x1d1)]({'invoice':_0x492a7c});_0x17af8f['product']['forEach'](_0x417d08=>{var _0x5af52b=_0xa090c8,_0x395b0d=0x0;const _0x6221e7=_0x450fb1[_0x5af52b(0x1a1)]['map'](_0x325201=>{var _0x5228c1=_0x5af52b;_0x325201[_0x5228c1(0x26c)]==_0x417d08[_0x5228c1(0x26c)]&&_0x325201[_0x5228c1(0x24d)]==_0x417d08['floorlevel']&&_0x325201[_0x5228c1(0x206)]==_0x417d08[_0x5228c1(0x206)]&&_0x325201['bin']==_0x417d08['bin']&&_0x325201[_0x5228c1(0x1d7)]==_0x417d08['bay']&&_0x325201[_0x5228c1(0x267)]==_0x417d08['rack']&&_0x325201['storage']==_0x417d08[_0x5228c1(0x238)]&&_0x325201['expiry_date']==_0x417d08['expiry_date']&&_0x325201[_0x5228c1(0x1b2)]==_0x417d08[_0x5228c1(0x1b2)]&&_0x325201['production_date']==_0x417d08['production_date']&&_0x325201['delivery_date']==_0x417d08['delivery_date']&&_0x325201[_0x5228c1(0x264)]==_0x417d08[_0x5228c1(0x264)]&&(_0x325201['product_stock']=parseInt(_0x325201[_0x5228c1(0x19b)])+parseInt(_0x417d08[_0x5228c1(0x194)]),_0x395b0d++);});_0x395b0d=='0'&&(_0x450fb1['product_details']=_0x450fb1[_0x5af52b(0x1a1)][_0x5af52b(0x1d6)]({'product_name':_0x417d08[_0x5af52b(0x26c)],'product_stock':_0x417d08[_0x5af52b(0x194)],'primary_code':_0x417d08[_0x5af52b(0x1b0)],'secondary_code':_0x417d08[_0x5af52b(0x1f4)],'product_code':_0x417d08[_0x5af52b(0x249)],'storage':_0x417d08['storage'],'rack':_0x417d08['rack'],'bay':_0x417d08[_0x5af52b(0x1d7)],'bin':_0x417d08[_0x5af52b(0x180)],'type':_0x417d08['type'],'floorlevel':_0x417d08[_0x5af52b(0x24d)],'maxProducts':_0x417d08[_0x5af52b(0x1c8)],'unit':_0x417d08['standard_unit'],'secondary_unit':_0x417d08[_0x5af52b(0x250)],'expiry_date':_0x417d08[_0x5af52b(0x1d8)],'maxPerUnit':_0x417d08[_0x5af52b(0x216)],'batch_code':_0x417d08[_0x5af52b(0x1b2)],'alertQTY':_0x417d08['alertQTY'],'production_date':_0x417d08[_0x5af52b(0x210)],'delivery_date':_0x417d08[_0x5af52b(0x1f0)],'delivery_code':_0x417d08[_0x5af52b(0x264)]}));}),await _0x450fb1[_0xa090c8(0x1a2)](),_0x17af8f[_0xa090c8(0x237)]=_0xa090c8(0x199);const _0x384210=await _0x17af8f[_0xa090c8(0x1a2)]();_0x442ebb['flash'](_0xa090c8(0x1f2),'Sales\x20Update\x20successfully'),_0x4f5208[_0xa090c8(0x19e)](_0xa090c8(0x1e0));}catch(_0x2cd2e2){console['log'](_0x2cd2e2);}}),router[a0_0x28f6a0(0x1ed)]('/view/:id',auth,async(_0x25bc71,_0x4272ac)=>{var _0x3d3710=a0_0x28f6a0;try{const {username:_0x30c3eb,email:_0x1b1126,role:_0x261d98}=_0x25bc71[_0x3d3710(0x1af)],_0x4a3c7f=_0x25bc71['user'],_0x14e12c=await profile[_0x3d3710(0x1d1)]({'email':_0x4a3c7f['email']}),_0x26d458=await master_shop[_0x3d3710(0x186)](),_0x2bd783=_0x25bc71[_0x3d3710(0x1e1)]['id'],_0x3d4926=await purchases[_0x3d3710(0x242)](_0x2bd783),_0x50bcfa=await suppliers['find']({});let _0x2ee77f;if(_0x4a3c7f['role']==_0x3d3710(0x23b)){const _0x28e619=await staff[_0x3d3710(0x1d1)]({'email':_0x4a3c7f[_0x3d3710(0x245)]});_0x2ee77f=await warehouse[_0x3d3710(0x186)]({'status':_0x3d3710(0x27a),'name':_0x28e619[_0x3d3710(0x1be)],'warehouse_category':_0x3d3710(0x26f)});}else _0x2ee77f=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3d3710(0x26f)}},{'$group':{'_id':_0x3d3710(0x1eb),'name':{'$first':'$name'}}}]);const _0x47d0e1=await product['find']({}),_0xf5eeeb=BayBinSelected(_0x3d4926[_0x3d3710(0x164)],_0x3d4926[_0x3d3710(0x18f)]);let _0x15d499=new Date(_0x3d4926['expiry_date']),_0x93db21=('0'+_0x15d499['getDate']())[_0x3d3710(0x1ca)](-0x2),_0xd001ba=('0'+(_0x15d499[_0x3d3710(0x22f)]()+0x1))['slice'](-0x2),_0x18a675=_0x15d499[_0x3d3710(0x244)](),_0x5b6b6f=_0x18a675+'-'+_0xd001ba+'-'+_0x93db21;if(_0x26d458[0x0][_0x3d3710(0x222)]==_0x3d3710(0x217)){var _0x3468e1=users['English'];console['log'](_0x3468e1);}else{if(_0x26d458[0x0][_0x3d3710(0x222)]=='Hindi')var _0x3468e1=users[_0x3d3710(0x25e)];else{if(_0x26d458[0x0]['language']==_0x3d3710(0x276))var _0x3468e1=users[_0x3d3710(0x276)];else{if(_0x26d458[0x0]['language']==_0x3d3710(0x17d))var _0x3468e1=users[_0x3d3710(0x17d)];else{if(_0x26d458[0x0]['language']==_0x3d3710(0x221))var _0x3468e1=users[_0x3d3710(0x221)];else{if(_0x26d458[0x0]['language']==_0x3d3710(0x266))var _0x3468e1=users[_0x3d3710(0x1ef)];else{if(_0x26d458[0x0][_0x3d3710(0x222)]=='Chinese')var _0x3468e1=users[_0x3d3710(0x1b3)];else{if(_0x26d458[0x0][_0x3d3710(0x222)]==_0x3d3710(0x214))var _0x3468e1=users['Arabic'];}}}}}}}_0x4272ac[_0x3d3710(0x1c3)](_0x3d3710(0x1e2),{'success':_0x25bc71[_0x3d3710(0x1c1)]('success'),'errors':_0x25bc71[_0x3d3710(0x1c1)](_0x3d3710(0x22a)),'role':_0x4a3c7f,'profile':_0x14e12c,'purchases':_0x3d4926,'suppliers':_0x50bcfa,'warehouse':_0x2ee77f,'product':_0x47d0e1,'master_shop':_0x26d458,'language':_0x3468e1,'ed_fullDate':_0x5b6b6f,'dataSelected':_0xf5eeeb});}catch(_0x8115b6){console[_0x3d3710(0x23e)](_0x8115b6);}}),router['post'](a0_0x28f6a0(0x20a),auth,async(_0x47e38a,_0x448125)=>{var _0x4a7e19=a0_0x28f6a0;try{const _0x326244=_0x47e38a[_0x4a7e19(0x1e1)]['id'],_0x2ea44f=await purchases[_0x4a7e19(0x1d1)]({'_id':_0x47e38a[_0x4a7e19(0x1e1)]['id']}),_0x40a2f0=await warehouse[_0x4a7e19(0x1d1)]({'name':_0x2ea44f[_0x4a7e19(0x164)],'room':_0x2ea44f[_0x4a7e19(0x18f)]});_0x2ea44f[_0x4a7e19(0x198)][_0x4a7e19(0x248)](_0x354237=>{const _0x2a937a=_0x40a2f0['product_details']['map'](_0x587a0d=>{var _0x19fa53=a0_0x3273;_0x587a0d['product_name']==_0x354237[_0x19fa53(0x26c)]&&_0x587a0d[_0x19fa53(0x24d)]==_0x354237[_0x19fa53(0x24d)]&&_0x587a0d[_0x19fa53(0x206)]==_0x354237['type']&&_0x587a0d['bin']==_0x354237[_0x19fa53(0x180)]&&_0x587a0d[_0x19fa53(0x1d7)]==_0x354237['bay']&&_0x587a0d['rack']==_0x354237[_0x19fa53(0x267)]&&_0x587a0d['storage']==_0x354237[_0x19fa53(0x238)]&&(_0x587a0d[_0x19fa53(0x19b)]=parseInt(_0x587a0d[_0x19fa53(0x19b)])-parseInt(_0x354237['quantity']));});}),await _0x40a2f0[_0x4a7e19(0x1a2)]();const {invoice:_0x52db82,suppliers:_0x104baa,date:_0x2499ba,warehouse_name:_0x15d802,prod_name:_0x176ee1,prod_code:_0x46a791,prod_qty:_0x2d2a9a,prod_unit:_0x428bf6,prod_secondunit:_0x6ca33e,prod_level:_0xb7e1be,prod_isle:_0x122d49,prod_pallet:_0x277c57,note:_0x559f93,expiry_date:_0x51fbb1,batch_code:_0xed9b3,paid_amount:_0x45f1fd,due_amount:_0x33cf51,Room_name:_0x1dbda5,primary_code:_0x108b6a,secondary_code:_0x40efa5,PO_number:_0xfcb36e,JO_number:_0x539f67}=_0x47e38a[_0x4a7e19(0x175)];if(typeof _0x176ee1==_0x4a7e19(0x1de))var _0x49ee5d=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x1b1)]],_0x158c0b=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x231)]],_0xda9a96=[_0x47e38a[_0x4a7e19(0x175)]['prod_qty']],_0x21a7fd=[_0x47e38a['body']['prod_unit']],_0x4cd6e4=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x168)]],_0x1eb3d8=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x263)]],_0x3d174c=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x226)]],_0x3530f0=[_0x47e38a['body'][_0x4a7e19(0x204)]],_0x1167e1=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x1b0)]],_0x326e45=[_0x47e38a['body'][_0x4a7e19(0x1f4)]],_0x4d4935=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x20b)]],_0xc979a9=[_0x47e38a['body']['batch_code']],_0x485b95=[_0x47e38a['body'][_0x4a7e19(0x1d8)]],_0x4e1631=[_0x47e38a[_0x4a7e19(0x175)]['storage']],_0x46cf24=[_0x47e38a['body'][_0x4a7e19(0x176)]],_0x2e94ef=[_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x206)]];else var _0x49ee5d=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x1b1)]],_0x158c0b=[..._0x47e38a['body'][_0x4a7e19(0x231)]],_0xda9a96=[..._0x47e38a['body'][_0x4a7e19(0x1a3)]],_0x21a7fd=[..._0x47e38a['body'][_0x4a7e19(0x21c)]],_0x4cd6e4=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x168)]],_0x1eb3d8=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x263)]],_0x3d174c=[..._0x47e38a[_0x4a7e19(0x175)]['prod_isle']],_0x3530f0=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x204)]],_0x1167e1=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x1b0)]],_0x326e45=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x1f4)]],_0x4d4935=[..._0x47e38a[_0x4a7e19(0x175)]['MaxStocks_data']],_0xc979a9=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x1b2)]],_0x485b95=[..._0x47e38a['body'][_0x4a7e19(0x1d8)]],_0x4e1631=[..._0x47e38a['body'][_0x4a7e19(0x238)]],_0x46cf24=[..._0x47e38a['body'][_0x4a7e19(0x176)]],_0x2e94ef=[..._0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x206)]];const _0x113e7e=_0x49ee5d[_0x4a7e19(0x1f1)](_0x5ccdcc=>{return _0x5ccdcc={'product_name':_0x5ccdcc};});_0x158c0b[_0x4a7e19(0x248)]((_0x3bb15e,_0x28d14e)=>{_0x113e7e[_0x28d14e]['product_code']=_0x3bb15e;}),_0xda9a96['forEach']((_0x5a66eb,_0x417d78)=>{var _0x9a58bb=_0x4a7e19;_0x113e7e[_0x417d78][_0x9a58bb(0x194)]=_0x5a66eb;}),_0x21a7fd[_0x4a7e19(0x248)]((_0x8739ee,_0x1e7dac)=>{var _0x582a60=_0x4a7e19;_0x113e7e[_0x1e7dac][_0x582a60(0x23d)]=_0x8739ee;}),_0x4cd6e4[_0x4a7e19(0x248)]((_0x35f4ea,_0x4a74d7)=>{var _0x380a02=_0x4a7e19;_0x113e7e[_0x4a74d7][_0x380a02(0x250)]=_0x35f4ea;}),_0x1eb3d8[_0x4a7e19(0x248)]((_0x1054db,_0x5b4ade)=>{_0x113e7e[_0x5b4ade]['bay']=_0x1054db;}),_0x3d174c[_0x4a7e19(0x248)]((_0x3c5d2b,_0x4d64dd)=>{var _0x28d5e8=_0x4a7e19;_0x113e7e[_0x4d64dd][_0x28d5e8(0x180)]=_0x3c5d2b;}),_0x3530f0[_0x4a7e19(0x248)]((_0x19d4fc,_0x3c30eb)=>{var _0x3cb370=_0x4a7e19;_0x113e7e[_0x3c30eb][_0x3cb370(0x24d)]=_0x19d4fc;}),_0x1167e1['forEach']((_0x4eb277,_0x70450f)=>{_0x113e7e[_0x70450f]['primary_code']=_0x4eb277;}),_0x326e45[_0x4a7e19(0x248)]((_0x5bc5af,_0x531f06)=>{var _0x1b7fbd=_0x4a7e19;_0x113e7e[_0x531f06][_0x1b7fbd(0x1f4)]=_0x5bc5af;}),_0x4d4935[_0x4a7e19(0x248)]((_0x4bd3f9,_0x464d2f)=>{_0x113e7e[_0x464d2f]['maxStocks']=_0x4bd3f9;}),_0xc979a9[_0x4a7e19(0x248)]((_0x2e6797,_0x56539c)=>{var _0x597314=_0x4a7e19;_0x113e7e[_0x56539c][_0x597314(0x1b2)]=_0x2e6797;}),_0x485b95[_0x4a7e19(0x248)]((_0x58c629,_0xb660b2)=>{_0x113e7e[_0xb660b2]['expiry_date']=_0x58c629;}),_0x2e94ef[_0x4a7e19(0x248)]((_0x265b35,_0x2c59ca)=>{var _0x2a8a51=_0x4a7e19;_0x113e7e[_0x2c59ca][_0x2a8a51(0x206)]=_0x265b35;}),_0x4e1631[_0x4a7e19(0x248)]((_0x162147,_0x251e25)=>{var _0x58f168=_0x4a7e19;_0x113e7e[_0x251e25][_0x58f168(0x238)]=_0x162147;}),_0x46cf24['forEach']((_0x14ac42,_0x1d0cf3)=>{var _0x1c8c32=_0x4a7e19;_0x113e7e[_0x1d0cf3][_0x1c8c32(0x267)]=_0x14ac42;});const _0x5e1ba6=_0x113e7e['filter'](_0x2270f9=>_0x2270f9[_0x4a7e19(0x194)]!=='0'&&_0x2270f9[_0x4a7e19(0x194)]!=='');_0x2ea44f[_0x4a7e19(0x246)]=_0x52db82,_0x2ea44f[_0x4a7e19(0x163)]=_0x104baa,_0x2ea44f[_0x4a7e19(0x190)]=_0x2499ba,_0x2ea44f['warehouse_name']=_0x15d802,_0x2ea44f[_0x4a7e19(0x198)]=_0x5e1ba6,_0x2ea44f['note']=_0x559f93,_0x2ea44f[_0x4a7e19(0x235)]=_0x45f1fd,_0x2ea44f[_0x4a7e19(0x1cc)]=_0x33cf51,_0x2ea44f[_0x4a7e19(0x18f)]=_0x1dbda5,_0x2ea44f[_0x4a7e19(0x1d4)]=_0xfcb36e,_0x2ea44f[_0x4a7e19(0x1e7)]=_0x539f67;const _0x1138e4=await _0x2ea44f[_0x4a7e19(0x1a2)](),_0xab90dd=await warehouse[_0x4a7e19(0x1d1)]({'name':_0x47e38a['body']['warehouse_name'],'room':_0x47e38a[_0x4a7e19(0x175)]['Room_name']});_0x2ea44f[_0x4a7e19(0x198)][_0x4a7e19(0x248)](_0x345263=>{var _0x8faf7a=_0x4a7e19,_0x1e97fb=0x0;const _0x178f86=_0xab90dd[_0x8faf7a(0x1a1)]['map'](_0x21d1fd=>{var _0x546327=_0x8faf7a;_0x21d1fd['product_name']==_0x345263[_0x546327(0x26c)]&&_0x21d1fd[_0x546327(0x24d)]==_0x345263[_0x546327(0x24d)]&&_0x21d1fd['type']==_0x345263['type']&&_0x21d1fd[_0x546327(0x180)]==_0x345263['bin']&&_0x21d1fd[_0x546327(0x1d7)]==_0x345263['bay']&&_0x21d1fd[_0x546327(0x267)]==_0x345263[_0x546327(0x267)]&&_0x21d1fd[_0x546327(0x238)]==_0x345263[_0x546327(0x238)]&&(_0x21d1fd[_0x546327(0x19b)]=parseInt(_0x21d1fd[_0x546327(0x19b)])+parseInt(_0x345263['quantity']),_0x1e97fb++);});_0x1e97fb=='0'&&(_0xab90dd[_0x8faf7a(0x1a1)]=_0xab90dd[_0x8faf7a(0x1a1)][_0x8faf7a(0x1d6)]({'product_name':_0x345263[_0x8faf7a(0x26c)],'product_stock':_0x345263[_0x8faf7a(0x194)],'primary_code':_0x345263[_0x8faf7a(0x1b0)],'secondary_code':_0x345263[_0x8faf7a(0x1f4)],'product_code':_0x345263[_0x8faf7a(0x249)],'storage':_0x345263[_0x8faf7a(0x238)],'rack':_0x345263[_0x8faf7a(0x267)],'bay':_0x345263[_0x8faf7a(0x1d7)],'bin':_0x345263['bin'],'type':_0x345263[_0x8faf7a(0x206)],'floorlevel':_0x345263[_0x8faf7a(0x24d)],'maxProducts':_0x345263[_0x8faf7a(0x1c8)],'unit':_0x345263[_0x8faf7a(0x23d)],'secondary_unit':_0x345263[_0x8faf7a(0x250)],'expiry_date':_0x345263[_0x8faf7a(0x1d8)]}));}),await _0xab90dd['save']();const _0xc6bc5b=await s_payment_data[_0x4a7e19(0x1d1)]({'invoice':_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x246)]});if(_0xc6bc5b===null){}else console['log'](_0x4a7e19(0x163),_0xc6bc5b,_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x246)]),_0xc6bc5b[_0x4a7e19(0x163)]=_0x47e38a[_0x4a7e19(0x175)][_0x4a7e19(0x163)],await _0xc6bc5b[_0x4a7e19(0x1a2)]();_0x47e38a[_0x4a7e19(0x1c1)](_0x4a7e19(0x1f2),_0x4a7e19(0x19d)),_0x448125[_0x4a7e19(0x19e)](_0x4a7e19(0x1e0));}catch(_0x32843e){console[_0x4a7e19(0x23e)](_0x32843e);}}),router[a0_0x28f6a0(0x18a)](a0_0x28f6a0(0x236),auth,async(_0x1f8c29,_0x2c4eb5)=>{var _0x594982=a0_0x28f6a0;try{const _0x38670b=_0x1f8c29[_0x594982(0x1e1)]['id'],{invoice:_0x468ea6,suppliers:_0x5b68a8,payable:_0x532bec,due_amount:_0x39c4cb}=_0x1f8c29[_0x594982(0x175)],_0x3d9656=await purchases['findById'](_0x38670b);var _0x1a6611=_0x532bec-_0x39c4cb;_0x3d9656[_0x594982(0x235)]=parseFloat(_0x3d9656[_0x594982(0x235)])+parseFloat(_0x39c4cb),_0x3d9656[_0x594982(0x1cc)]=_0x1a6611;const _0x20daaf=await _0x3d9656[_0x594982(0x1a2)]();console[_0x594982(0x23e)](_0x20daaf);const _0x3b4876=await s_payment_data['findOne']({'invoice':_0x468ea6});_0x3b4876[_0x594982(0x193)]=_0x1a6611,await _0x3b4876['save']();let _0x2d7b07=new Date(),_0x4cd8a2=('0'+_0x2d7b07[_0x594982(0x27d)]())['slice'](-0x2),_0x10e1b7=('0'+(_0x2d7b07[_0x594982(0x22f)]()+0x1))[_0x594982(0x1ca)](-0x2),_0x1439c9=_0x2d7b07[_0x594982(0x244)](),_0x5036dc=_0x1439c9+'-'+_0x10e1b7+'-'+_0x4cd8a2;const _0x50f6f7=new suppliers_payment({'invoice':_0x468ea6,'date':_0x1439c9+'-'+_0x10e1b7+'-'+_0x4cd8a2,'suppliers':_0x5b68a8,'reason':_0x594982(0x223),'amount':_0x39c4cb}),_0x3142fd=await _0x50f6f7[_0x594982(0x1a2)]();_0x1f8c29[_0x594982(0x1c1)](_0x594982(0x1f2),_0x594982(0x197)),_0x2c4eb5[_0x594982(0x19e)](_0x594982(0x1e0));}catch(_0x559564){console['log'](_0x559564);}}),router[a0_0x28f6a0(0x1ed)](a0_0x28f6a0(0x200),auth,async(_0x38bc25,_0x470932)=>{var _0x5994e1=a0_0x28f6a0;try{const {username:_0x3bafb3,email:_0x1eb1c2,role:_0x2b4391}=_0x38bc25[_0x5994e1(0x1af)],_0xf57ccf=_0x38bc25[_0x5994e1(0x1af)],_0x138598=await profile[_0x5994e1(0x1d1)]({'email':_0xf57ccf[_0x5994e1(0x245)]}),_0x5ce2d6=await master_shop[_0x5994e1(0x186)]();console['log'](_0x5994e1(0x1b6),_0x5ce2d6);const _0x5ed1bb=_0x38bc25[_0x5994e1(0x1e1)]['id'],_0x205866=await purchases[_0x5994e1(0x242)](_0x5ed1bb);console[_0x5994e1(0x23e)](_0x205866);const _0x2f6206=await suppliers[_0x5994e1(0x1d1)]({'name':_0x205866['suppliers']});console[_0x5994e1(0x23e)](_0x2f6206);if(_0x5ce2d6[0x0]['language']=='English\x20(US)'){var _0xd5ff39=users[_0x5994e1(0x1d0)];console[_0x5994e1(0x23e)](_0xd5ff39);}else{if(_0x5ce2d6[0x0]['language']==_0x5994e1(0x25e))var _0xd5ff39=users[_0x5994e1(0x25e)];else{if(_0x5ce2d6[0x0][_0x5994e1(0x222)]==_0x5994e1(0x276))var _0xd5ff39=users[_0x5994e1(0x276)];else{if(_0x5ce2d6[0x0][_0x5994e1(0x222)]==_0x5994e1(0x17d))var _0xd5ff39=users[_0x5994e1(0x17d)];else{if(_0x5ce2d6[0x0][_0x5994e1(0x222)]==_0x5994e1(0x221))var _0xd5ff39=users[_0x5994e1(0x221)];else{if(_0x5ce2d6[0x0]['language']==_0x5994e1(0x266))var _0xd5ff39=users[_0x5994e1(0x1ef)];else{if(_0x5ce2d6[0x0][_0x5994e1(0x222)]==_0x5994e1(0x1b3))var _0xd5ff39=users['Chinese'];else{if(_0x5ce2d6[0x0][_0x5994e1(0x222)]==_0x5994e1(0x214))var _0xd5ff39=users[_0x5994e1(0x24e)];}}}}}}}_0x470932[_0x5994e1(0x1c3)]('purchase_invoice',{'success':_0x38bc25[_0x5994e1(0x1c1)](_0x5994e1(0x1f2)),'errors':_0x38bc25[_0x5994e1(0x1c1)](_0x5994e1(0x22a)),'role':_0xf57ccf,'profile':_0x138598,'master_shop':_0x5ce2d6,'supplier':_0x2f6206,'purchase':_0x205866,'language':_0xd5ff39});}catch(_0x3c9945){console[_0x5994e1(0x23e)](_0x3c9945);}}),router['get']('/view/return_purchase/:id',auth,async(_0x27e580,_0x196613)=>{var _0x2a48aa=a0_0x28f6a0;try{const {username:_0x4d9ebc,email:_0xea3246,role:_0x26d858}=_0x27e580[_0x2a48aa(0x1af)],_0x5d3062=_0x27e580['user'],_0x38a066=await profile[_0x2a48aa(0x1d1)]({'email':_0x5d3062['email']}),_0x86e3e6=await master_shop[_0x2a48aa(0x186)]();console[_0x2a48aa(0x23e)]('master',_0x86e3e6);const _0x530204=_0x27e580[_0x2a48aa(0x1e1)]['id'];console[_0x2a48aa(0x23e)](_0x530204);const _0x503b9d=await purchases[_0x2a48aa(0x242)](_0x530204);console[_0x2a48aa(0x23e)](_0x2a48aa(0x1a6),_0x503b9d);const _0x7443c3=await product[_0x2a48aa(0x186)]({}),_0x2d2f6f=await warehouse[_0x2a48aa(0x23c)]([{'$match':{'name':_0x503b9d['warehouse_name'],'room':_0x503b9d[_0x2a48aa(0x18f)],'warehouse_category':_0x2a48aa(0x26f)}},{'$unwind':_0x2a48aa(0x219)},{'$group':{'_id':_0x2a48aa(0x1bc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2a48aa(0x1bd)},'bay':{'$first':_0x2a48aa(0x16c)},'bin':{'$first':_0x2a48aa(0x275)},'type':{'$first':_0x2a48aa(0x1a5)},'floorlevel':{'$first':_0x2a48aa(0x229)},'primary_code':{'$first':_0x2a48aa(0x23a)},'secondary_code':{'$first':_0x2a48aa(0x17a)},'product_code':{'$first':_0x2a48aa(0x1bf)},'storage':{'$first':_0x2a48aa(0x1df)},'rack':{'$first':_0x2a48aa(0x265)}}}]);warehouse_data=await warehouse[_0x2a48aa(0x23c)]([{'$match':{'status':_0x2a48aa(0x27a),'name':_0x2a48aa(0x259),'warehouse_category':_0x2a48aa(0x26f)}},{'$group':{'_id':_0x2a48aa(0x1eb),'name':{'$first':_0x2a48aa(0x1eb)}}},{'$sort':{'name':0x1}}]),console['log'](_0x2a48aa(0x1f9),_0x2d2f6f);if(_0x86e3e6[0x0]['language']==_0x2a48aa(0x217)){var _0x365bfa=users[_0x2a48aa(0x1d0)];console[_0x2a48aa(0x23e)](_0x365bfa);}else{if(_0x86e3e6[0x0][_0x2a48aa(0x222)]==_0x2a48aa(0x25e))var _0x365bfa=users[_0x2a48aa(0x25e)];else{if(_0x86e3e6[0x0]['language']=='German')var _0x365bfa=users[_0x2a48aa(0x276)];else{if(_0x86e3e6[0x0][_0x2a48aa(0x222)]==_0x2a48aa(0x17d))var _0x365bfa=users['Spanish'];else{if(_0x86e3e6[0x0][_0x2a48aa(0x222)]==_0x2a48aa(0x221))var _0x365bfa=users[_0x2a48aa(0x221)];else{if(_0x86e3e6[0x0]['language']==_0x2a48aa(0x266))var _0x365bfa=users['Portuguese'];else{if(_0x86e3e6[0x0][_0x2a48aa(0x222)]==_0x2a48aa(0x1b3))var _0x365bfa=users[_0x2a48aa(0x1b3)];else{if(_0x86e3e6[0x0][_0x2a48aa(0x222)]==_0x2a48aa(0x214))var _0x365bfa=users[_0x2a48aa(0x24e)];}}}}}}}_0x196613[_0x2a48aa(0x1c3)](_0x2a48aa(0x1fa),{'success':_0x27e580['flash'](_0x2a48aa(0x1f2)),'errors':_0x27e580['flash'](_0x2a48aa(0x22a)),'role':_0x5d3062,'profile':_0x38a066,'user':_0x503b9d,'stock':_0x2d2f6f,'master_shop':_0x86e3e6,'product':_0x7443c3,'language':_0x365bfa,'warehouse':warehouse_data});}catch(_0x9055dd){console[_0x2a48aa(0x23e)](_0x9055dd);}}),router[a0_0x28f6a0(0x18a)](a0_0x28f6a0(0x1f6),auth,async(_0x2cfe64,_0x5d23f8)=>{var _0x5e2d1b=a0_0x28f6a0;try{const {invoice:_0x5dab59,date:_0x375e33,warehouse_name:_0x3362c1,Room_name:_0x13716e,product_name:_0x5632fc,purchase_quantity:_0x47d469,stocks:_0x535a35,return_qty:_0x548d9d,note:_0x262bef,level:_0x1b5db0,isle:_0x4a35a2,pallet:_0x7bd3db,to_warehouse_name:_0x1c2729,to_Room_name:_0x8b6a8f}=_0x2cfe64[_0x5e2d1b(0x175)],_0x5764cc=await purchases['findOne']({'_id':_0x2cfe64['params']['id']}),_0xe1ae91=await warehouse[_0x5e2d1b(0x1d1)]({'name':_0x3362c1,'room':_0x13716e});if(typeof _0x5632fc==_0x5e2d1b(0x1de))var _0x33967c=[_0x2cfe64[_0x5e2d1b(0x175)]['product_name']],_0x474477=[_0x2cfe64['body'][_0x5e2d1b(0x189)]],_0x6e8d2=[_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x205)]],_0x270fd6=[_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x270)]],_0x56965e=[_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x211)]],_0xe48ed=[_0x2cfe64['body'][_0x5e2d1b(0x17b)]],_0x32cccc=[_0x2cfe64['body'][_0x5e2d1b(0x17f)]],_0x206e30=[_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x18e)]],_0x1a2a7e=[_0x2cfe64['body'][_0x5e2d1b(0x1ad)]],_0x3903d8=[_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x169)]],_0x409722=[_0x2cfe64[_0x5e2d1b(0x175)]['secondary_code_hide']];else var _0x33967c=[..._0x2cfe64['body'][_0x5e2d1b(0x26c)]],_0x474477=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x189)]],_0x6e8d2=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x205)]],_0x270fd6=[..._0x2cfe64[_0x5e2d1b(0x175)]['return_qty']],_0x56965e=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x211)]],_0xe48ed=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x17b)]],_0x32cccc=[..._0x2cfe64['body']['pallet']],_0x206e30=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x18e)]],_0x1a2a7e=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x1ad)]],_0x3903d8=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x169)]],_0x409722=[..._0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x278)]];const _0x240348=_0x33967c[_0x5e2d1b(0x1f1)](_0x1f5845=>{return _0x1f5845={'product_name':_0x1f5845};});_0x474477[_0x5e2d1b(0x248)]((_0x135fd9,_0x3f2f00)=>{var _0x1b5125=_0x5e2d1b;_0x240348[_0x3f2f00][_0x1b5125(0x189)]=_0x135fd9;}),_0x6e8d2[_0x5e2d1b(0x248)]((_0x283beb,_0x51b55d)=>{var _0x129e77=_0x5e2d1b;_0x240348[_0x51b55d][_0x129e77(0x1e8)]=_0x283beb;}),_0x270fd6[_0x5e2d1b(0x248)]((_0x3a54e3,_0x16c217)=>{var _0x331e14=_0x5e2d1b;_0x240348[_0x16c217][_0x331e14(0x270)]=_0x3a54e3;}),_0x56965e[_0x5e2d1b(0x248)]((_0xe715ea,_0x5d80eb)=>{var _0x2ed4f6=_0x5e2d1b;_0x240348[_0x5d80eb][_0x2ed4f6(0x1d7)]=_0xe715ea;}),_0xe48ed[_0x5e2d1b(0x248)]((_0x577c47,_0x12d381)=>{_0x240348[_0x12d381]['bin']=_0x577c47;}),_0x32cccc[_0x5e2d1b(0x248)]((_0x3cc53b,_0x31985b)=>{var _0x559eef=_0x5e2d1b;_0x240348[_0x31985b][_0x559eef(0x24d)]=_0x3cc53b;}),_0x206e30[_0x5e2d1b(0x248)]((_0x50ab38,_0x57032d)=>{_0x240348[_0x57032d]['type']=_0x50ab38;}),_0x1a2a7e[_0x5e2d1b(0x248)]((_0x1dff9b,_0xcde3ef)=>{_0x240348[_0xcde3ef]['product_code']=_0x1dff9b;}),_0x3903d8[_0x5e2d1b(0x248)]((_0x42f439,_0x3e2d76)=>{var _0x2c87db=_0x5e2d1b;_0x240348[_0x3e2d76][_0x2c87db(0x1b0)]=_0x42f439;}),_0x409722[_0x5e2d1b(0x248)]((_0x4a87f5,_0x2cab7e)=>{var _0x47097a=_0x5e2d1b;_0x240348[_0x2cab7e][_0x47097a(0x1f4)]=_0x4a87f5;}),_0x5764cc[_0x5e2d1b(0x198)][_0x5e2d1b(0x248)](_0xe8ba24=>{var _0x1c6547=_0x5e2d1b;const _0x195092=_0xe1ae91[_0x1c6547(0x1a1)][_0x1c6547(0x1f1)](_0x2cd1da=>{var _0x68f7de=_0x1c6547;_0x2cd1da[_0x68f7de(0x26c)]==_0xe8ba24[_0x68f7de(0x26c)]&&_0x2cd1da['floorlevel']==_0xe8ba24['floorlevel']&&_0x2cd1da[_0x68f7de(0x206)]==_0xe8ba24['type']&&_0x2cd1da[_0x68f7de(0x180)]==_0xe8ba24[_0x68f7de(0x180)]&&_0x2cd1da[_0x68f7de(0x1d7)]==_0xe8ba24[_0x68f7de(0x1d7)]&&_0x2cd1da[_0x68f7de(0x267)]==_0xe8ba24[_0x68f7de(0x267)]&&_0x2cd1da['storage']==_0xe8ba24['storage']&&(console[_0x68f7de(0x23e)](parseInt(_0x2cd1da[_0x68f7de(0x19b)])+_0x68f7de(0x201)+parseInt(_0xe8ba24[_0x68f7de(0x194)])),_0x2cd1da[_0x68f7de(0x19b)]=parseInt(_0x2cd1da[_0x68f7de(0x19b)])+parseInt(_0xe8ba24[_0x68f7de(0x194)]));});}),await _0xe1ae91[_0x5e2d1b(0x1a2)]();const _0xfc95fa=_0x240348[_0x5e2d1b(0x20e)](_0x2578b0=>_0x2578b0[_0x5e2d1b(0x270)]!=='0'&&_0x2578b0[_0x5e2d1b(0x270)]!=='');var _0xbde1e3=0x0;_0xfc95fa[_0x5e2d1b(0x248)](_0x434617=>{var _0xa549e=_0x5e2d1b;console[_0xa549e(0x23e)](_0xa549e(0x1ab),_0x434617),(parseInt(_0x434617[_0xa549e(0x189)])<parseInt(_0x434617[_0xa549e(0x270)])||parseInt(_0x434617['stock_quantity'])<parseInt(_0x434617[_0xa549e(0x270)]))&&_0xbde1e3++;});if(_0xbde1e3!=0x0)return _0x2cfe64['flash'](_0x5e2d1b(0x22a),_0x5e2d1b(0x1d9)),_0x5d23f8[_0x5e2d1b(0x19e)](_0x5e2d1b(0x192));const _0x184c85=new purchases_return({'invoice':_0x5dab59,'suppliers':_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x163)],'date':_0x375e33,'warehouse_name':_0x3362c1,'return_product':_0xfc95fa,'note':_0x262bef,'room':_0x13716e,'to_warehouse_name':_0x1c2729,'to_room':_0x8b6a8f}),_0x38d934=await _0x184c85[_0x5e2d1b(0x1a2)]();console[_0x5e2d1b(0x23e)](_0x184c85);const _0x25ed65=await purchases_return[_0x5e2d1b(0x1d1)]({'invoice':_0x5dab59}),_0x140502=await warehouse[_0x5e2d1b(0x1d1)]({'name':_0x1c2729,'room':_0x8b6a8f});_0x25ed65['return_product'][_0x5e2d1b(0x248)](_0x5a1a66=>{var _0x1a09a2=_0x5e2d1b,_0x2cab1f=0x0;const _0x340e1c=_0x140502[_0x1a09a2(0x1a1)][_0x1a09a2(0x1f1)](_0x5dae00=>{var _0x4b47b0=_0x1a09a2;_0x5dae00[_0x4b47b0(0x26c)]==_0x5a1a66[_0x4b47b0(0x26c)]&&_0x5dae00['floorlevel']==_0x5a1a66[_0x4b47b0(0x24d)]&&_0x5dae00[_0x4b47b0(0x206)]==_0x5a1a66[_0x4b47b0(0x206)]&&_0x5dae00[_0x4b47b0(0x180)]==_0x5a1a66['bin']&&_0x5dae00['bay']==_0x5a1a66[_0x4b47b0(0x1d7)]&&(_0x5dae00[_0x4b47b0(0x19b)]=parseInt(_0x5dae00[_0x4b47b0(0x19b)])-parseInt(_0x5a1a66[_0x4b47b0(0x270)]),_0x2cab1f++);});_0x2cab1f=='0'&&(_0x140502['product_details']=_0x140502[_0x1a09a2(0x1a1)][_0x1a09a2(0x1d6)]({'product_name':_0x5a1a66[_0x1a09a2(0x26c)],'product_stock':_0x5a1a66[_0x1a09a2(0x270)],'primary_code':_0x5a1a66[_0x1a09a2(0x1b0)],'secondary_code':_0x5a1a66[_0x1a09a2(0x1f4)],'product_code':_0x5a1a66[_0x1a09a2(0x249)],'storage':_0x5a1a66[_0x1a09a2(0x238)],'rack':_0x5a1a66[_0x1a09a2(0x267)],'bay':_0x5a1a66[_0x1a09a2(0x1d7)],'bin':_0x5a1a66[_0x1a09a2(0x180)],'type':_0x5a1a66['type'],'floorlevel':_0x5a1a66['floorlevel'],'maxProducts':_0x5a1a66[_0x1a09a2(0x1c8)],'unit':_0x5a1a66['standard_unit'],'secondary_unit':_0x5a1a66['secondary_unit'],'expiry_date':_0x5a1a66[_0x1a09a2(0x1d8)]}));}),await _0x140502['save']();const _0x60e447=await purchases[_0x5e2d1b(0x1d1)]({'invoice':_0x5dab59});_0x60e447[_0x5e2d1b(0x21a)]=_0x5e2d1b(0x199);const _0x37e6d2=await _0x60e447['save'](),_0x5d5f99=new s_payment_data({'invoice':_0x5dab59,'suppliers':_0x2cfe64['body'][_0x5e2d1b(0x163)],'reason':_0x5e2d1b(0x1d5)});await _0x5d5f99['save']();const _0xeda8ae=await master_shop[_0x5e2d1b(0x186)]();console['log']('add\x20post',_0xeda8ae[0x0][_0x5e2d1b(0x208)]);const _0x23bbac=await email_settings[_0x5e2d1b(0x1d1)](),_0x52e54e=await suppliers[_0x5e2d1b(0x1d1)]({'name':_0x2cfe64[_0x5e2d1b(0x175)][_0x5e2d1b(0x163)]});console[_0x5e2d1b(0x23e)](_0x5e2d1b(0x1fb),_0x52e54e);_0xeda8ae[0x0][_0x5e2d1b(0x240)]==0x1?(right_currency=_0xeda8ae[0x0][_0x5e2d1b(0x18d)],left_currency=''):(right_currency='',left_currency=_0xeda8ae[0x0][_0x5e2d1b(0x18d)]);var _0x4b29fa=_0x33967c,_0x10820d=_0x270fd6,_0x4e8c14='',_0x3ee424;for(_0x3ee424 in _0x4b29fa){_0x4e8c14+=_0x5e2d1b(0x262)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b29fa[_0x3ee424]+_0x5e2d1b(0x243)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x10820d[_0x3ee424]+_0x5e2d1b(0x243)+_0x5e2d1b(0x1dd);}console[_0x5e2d1b(0x23e)]('product_list',_0x4e8c14);let _0x613c68=nodemailer['createTransport']({'service':_0x5e2d1b(0x21d),'auth':{'user':_0x23bbac[_0x5e2d1b(0x245)],'pass':_0x23bbac[_0x5e2d1b(0x272)]}}),_0x26af2d={'from':_0x23bbac['email'],'to':_0x52e54e[_0x5e2d1b(0x245)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x5e2d1b(0x1ae),'path':__dirname+_0x5e2d1b(0x1fc)+_0x5e2d1b(0x232)+_0xeda8ae[0x0][_0x5e2d1b(0x208)],'cid':_0x5e2d1b(0x22d)}],'html':'<!DOCTYPE\x20html>'+_0x5e2d1b(0x26b)+_0x5e2d1b(0x16f)+_0x5e2d1b(0x21f)+_0x5e2d1b(0x26a)+_0x5e2d1b(0x21f)+_0x5e2d1b(0x27e)+_0x5e2d1b(0x1e5)+_0x5e2d1b(0x21f)+'<h2>\x20'+_0xeda8ae[0x0][_0x5e2d1b(0x171)]+_0x5e2d1b(0x20c)+_0x5e2d1b(0x1e5)+_0x5e2d1b(0x1e5)+_0x5e2d1b(0x212)+_0x5e2d1b(0x21f)+_0x5e2d1b(0x233)+'\x20Order\x20Number\x20:\x20'+_0x5dab59+'\x20'+_0x5e2d1b(0x27f)+_0x5e2d1b(0x174)+_0x375e33+'\x20'+_0x5e2d1b(0x187)+_0x5e2d1b(0x224)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x5e2d1b(0x25b)+_0x5e2d1b(0x1a8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x5e2d1b(0x25d)+_0x5e2d1b(0x1dd)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4e8c14+'\x20'+_0x5e2d1b(0x1ff)+_0x5e2d1b(0x234)+'<div>'+_0x5e2d1b(0x209)+'<h5>'+_0xeda8ae[0x0]['site_title']+_0x5e2d1b(0x224)+_0x5e2d1b(0x1e5)+_0x5e2d1b(0x1e5)+_0x5e2d1b(0x177)};_0x613c68[_0x5e2d1b(0x183)](_0x26af2d,function(_0x4486db,_0x2d9ded){var _0x2e6daf=_0x5e2d1b;_0x4486db?(console[_0x2e6daf(0x23e)](_0x4486db),console[_0x2e6daf(0x23e)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x2cfe64['flash'](_0x5e2d1b(0x1f2),_0x5e2d1b(0x1e9)),_0x5d23f8[_0x5e2d1b(0x19e)](_0x5e2d1b(0x1e0));}catch(_0xc65ad9){console[_0x5e2d1b(0x23e)](_0xc65ad9),_0x5d23f8[_0x5e2d1b(0x230)](0xc8)['json']({'message':_0xc65ad9[_0x5e2d1b(0x1c6)]});}}),router[a0_0x28f6a0(0x1ed)](a0_0x28f6a0(0x1dc),auth,async(_0x21a072,_0x5ea446)=>{var _0x33cac4=a0_0x28f6a0;try{const {username:_0x50d472,email:_0x59bca2,role:_0x5461c2}=_0x21a072[_0x33cac4(0x1af)],_0x427101=_0x21a072[_0x33cac4(0x1af)],_0xcef14c=await profile['findOne']({'email':_0x427101[_0x33cac4(0x245)]}),_0x1ddb84=await master_shop[_0x33cac4(0x186)](),_0x3a1526=_0x21a072['params']['id'],_0x1fc3c2=await purchases[_0x33cac4(0x242)](_0x3a1526);if(_0x1ddb84[0x0][_0x33cac4(0x222)]==_0x33cac4(0x217))var _0x32ac58=users['English'];else{if(_0x1ddb84[0x0]['language']==_0x33cac4(0x25e))var _0x32ac58=users['Hindi'];else{if(_0x1ddb84[0x0][_0x33cac4(0x222)]=='German')var _0x32ac58=users['German'];else{if(_0x1ddb84[0x0][_0x33cac4(0x222)]==_0x33cac4(0x17d))var _0x32ac58=users[_0x33cac4(0x17d)];else{if(_0x1ddb84[0x0][_0x33cac4(0x222)]==_0x33cac4(0x221))var _0x32ac58=users[_0x33cac4(0x221)];else{if(_0x1ddb84[0x0][_0x33cac4(0x222)]==_0x33cac4(0x266))var _0x32ac58=users[_0x33cac4(0x1ef)];else{if(_0x1ddb84[0x0]['language']==_0x33cac4(0x1b3))var _0x32ac58=users[_0x33cac4(0x1b3)];else{if(_0x1ddb84[0x0][_0x33cac4(0x222)]==_0x33cac4(0x214))var _0x32ac58=users[_0x33cac4(0x24e)];}}}}}}}_0x5ea446[_0x33cac4(0x1c3)](_0x33cac4(0x274),{'success':_0x21a072[_0x33cac4(0x1c1)](_0x33cac4(0x1f2)),'errors':_0x21a072[_0x33cac4(0x1c1)](_0x33cac4(0x22a)),'role':_0x427101,'profile':_0xcef14c,'alldata':_0x1fc3c2,'master_shop':_0x1ddb84,'language':_0x32ac58}),console[_0x33cac4(0x23e)](alldata);}catch(_0x42ed05){console[_0x33cac4(0x23e)](_0x42ed05);}}),router[a0_0x28f6a0(0x18a)](a0_0x28f6a0(0x1ac),async(_0x1b8914,_0x20ddb2)=>{var _0x7bc407=a0_0x28f6a0;const {product_code:_0xb0515d}=_0x1b8914[_0x7bc407(0x175)];var _0x156095;const _0x3a015c=await product[_0x7bc407(0x23c)]([{'$match':{'primary_code':_0xb0515d,'product_category':_0x7bc407(0x26f)}},{'$group':{'_id':_0x7bc407(0x24c),'name':{'$first':_0x7bc407(0x1eb)},'category':{'$first':_0x7bc407(0x24a)},'brand':{'$first':'$brand'},'unit':{'$first':_0x7bc407(0x1b8)},'alertquantity':{'$first':_0x7bc407(0x172)},'product_code':{'$first':_0x7bc407(0x27b)},'primary_code':{'$first':_0x7bc407(0x277)},'secondary_code':{'$first':_0x7bc407(0x251)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x7bc407(0x1da)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2722f2=await product[_0x7bc407(0x23c)]([{'$match':{'secondary_code':_0xb0515d,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x7bc407(0x24c),'name':{'$first':'$name'},'category':{'$first':_0x7bc407(0x24a)},'brand':{'$first':_0x7bc407(0x1e6)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x7bc407(0x172)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x7bc407(0x251)},'maxStocks':{'$first':_0x7bc407(0x1c9)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x7bc407(0x1da)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3a015c[_0x7bc407(0x227)]>0x0)_0x156095=_0x3a015c;else _0x2722f2[_0x7bc407(0x227)]>0x0&&(_0x156095=_0x2722f2);_0x20ddb2[_0x7bc407(0x228)](_0x156095);}),router[a0_0x28f6a0(0x18a)]('/CheckingWarehouse',async(_0x61f0ad,_0x223234)=>{var _0x5be5a8=a0_0x28f6a0;const {primaryCode:_0x37f305,secondaryCode:_0x59c11c,productCode:_0x1e23e1,bay:_0x31083b,bin:_0x2c3fe2,types:_0x51f614,pallet:_0x480c84,warehouses:_0x12e77e,room:_0x5349b4}=_0x61f0ad[_0x5be5a8(0x175)];console[_0x5be5a8(0x23e)](_0x61f0ad[_0x5be5a8(0x175)]);try{const _0x5cad70=await warehouse[_0x5be5a8(0x23c)]([{'$match':{'name':_0x12e77e,'room':_0x5349b4}},{'$unwind':_0x5be5a8(0x219)},{'$match':{'product_details.bay':_0x31083b,'product_details.bin':_0x2c3fe2,'product_details.type':_0x51f614}},{'$group':{'_id':_0x5be5a8(0x1bc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5be5a8(0x1bd)},'level':{'$first':_0x5be5a8(0x191)},'isle':{'$first':_0x5be5a8(0x20d)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x5be5a8(0x261)}}}]);_0x223234[_0x5be5a8(0x230)](0xc8)[_0x5be5a8(0x228)](_0x5cad70);}catch(_0x5069bf){_0x223234[_0x5be5a8(0x230)](0x194)[_0x5be5a8(0x228)]({'message':_0x5069bf[_0x5be5a8(0x1c6)]});}}),module[a0_0x28f6a0(0x260)]=router;