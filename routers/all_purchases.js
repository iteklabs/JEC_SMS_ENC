var a0_0x5bff47=a0_0x4893;(function(_0x63273a,_0x43b93e){var _0x1ab6e0=a0_0x4893,_0x8b016a=_0x63273a();while(!![]){try{var _0x11528a=-parseInt(_0x1ab6e0(0x172))/0x1*(-parseInt(_0x1ab6e0(0x18d))/0x2)+-parseInt(_0x1ab6e0(0x1e8))/0x3*(-parseInt(_0x1ab6e0(0x15b))/0x4)+parseInt(_0x1ab6e0(0x213))/0x5+parseInt(_0x1ab6e0(0x154))/0x6*(parseInt(_0x1ab6e0(0x192))/0x7)+-parseInt(_0x1ab6e0(0x1ad))/0x8*(parseInt(_0x1ab6e0(0x190))/0x9)+-parseInt(_0x1ab6e0(0x209))/0xa*(parseInt(_0x1ab6e0(0x23f))/0xb)+parseInt(_0x1ab6e0(0x249))/0xc*(-parseInt(_0x1ab6e0(0x20f))/0xd);if(_0x11528a===_0x43b93e)break;else _0x8b016a['push'](_0x8b016a['shift']());}catch(_0x20be1a){_0x8b016a['push'](_0x8b016a['shift']());}}}(a0_0x178b,0x7ff7b));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x5bff47(0x180)),auth=require(a0_0x5bff47(0x1d1)),nodemailer=require(a0_0x5bff47(0x18f));var ejs=require('ejs');function a0_0x4893(_0x412cb1,_0x2b6820){var _0x178bd7=a0_0x178b();return a0_0x4893=function(_0x4893fe,_0x62431e){_0x4893fe=_0x4893fe-0x14a;var _0x5d81eb=_0x178bd7[_0x4893fe];return _0x5d81eb;},a0_0x4893(_0x412cb1,_0x2b6820);}const path=require(a0_0x5bff47(0x198)),users=require('../public/language/languages.json');router[a0_0x5bff47(0x250)](a0_0x5bff47(0x1f8),auth,async(_0x107462,_0x1ad06a)=>{var _0x4a22a9=a0_0x5bff47;try{const {username:_0x2390dd,email:_0x5b2a81,role:_0x1b337e}=_0x107462[_0x4a22a9(0x189)],_0x3ceb30=_0x107462[_0x4a22a9(0x189)],_0x5ab0f1=await profile[_0x4a22a9(0x19a)]({'email':_0x3ceb30[_0x4a22a9(0x199)]}),_0x5e7c68=await staff[_0x4a22a9(0x19a)]({'email':_0x3ceb30[_0x4a22a9(0x199)]});if(_0x3ceb30[_0x4a22a9(0x258)]==_0x4a22a9(0x1c8)){const _0x4b19ac=await staff[_0x4a22a9(0x19a)]({'email':_0x3ceb30[_0x4a22a9(0x199)]});}const _0x9d659b=await master_shop[_0x4a22a9(0x222)]();let _0x6be4e0;if(_0x3ceb30[_0x4a22a9(0x258)]==_0x4a22a9(0x1c8)){const _0x3c005e=await staff['findOne']({'email':_0x3ceb30['email']});_0x6be4e0=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3c005e['warehouse']}},{'$lookup':{'from':_0x4a22a9(0x233),'localField':'suppliers','foreignField':_0x4a22a9(0x1f7),'as':_0x4a22a9(0x14c)}},{'$unwind':_0x4a22a9(0x1d4)},{'$unwind':_0x4a22a9(0x16b)},{'$group':{'_id':_0x4a22a9(0x1af),'invoice':{'$first':_0x4a22a9(0x201)},'suppliers':{'$first':_0x4a22a9(0x1e6)},'date':{'$first':_0x4a22a9(0x246)},'warehouse_name':{'$first':_0x4a22a9(0x1a5)},'room':{'$first':_0x4a22a9(0x18b)},'product':{'$push':_0x4a22a9(0x16b)},'note':{'$first':_0x4a22a9(0x1f3)},'paid_amount':{'$first':_0x4a22a9(0x236)},'due_amount':{'$first':_0x4a22a9(0x1fd)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4a22a9(0x1b8)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x4a22a9(0x248)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x4a22a9(0x17c)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x6be4e0=await purchases[_0x4a22a9(0x1a1)]([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x4a22a9(0x1f7),'as':_0x4a22a9(0x14c)}},{'$unwind':_0x4a22a9(0x1d4)},{'$unwind':_0x4a22a9(0x16b)},{'$group':{'_id':_0x4a22a9(0x1af),'invoice':{'$first':_0x4a22a9(0x201)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4a22a9(0x246)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x4a22a9(0x16b)},'note':{'$first':_0x4a22a9(0x1f3)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x4a22a9(0x1fd)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4a22a9(0x1b8)},'expiry_date':{'$first':_0x4a22a9(0x1f5)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4a22a9(0x1a6)},'isle':{'$addToSet':_0x4a22a9(0x17c)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x4a22a9(0x202)},'finalize':{'$first':_0x4a22a9(0x16e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x9d659b[0x0]['language']=='English\x20(US)'){var _0x59fbfd=users[_0x4a22a9(0x1a7)];console['log'](_0x59fbfd);}else{if(_0x9d659b[0x0][_0x4a22a9(0x1ab)]==_0x4a22a9(0x21f))var _0x59fbfd=users[_0x4a22a9(0x21f)];else{if(_0x9d659b[0x0][_0x4a22a9(0x1ab)]==_0x4a22a9(0x1c3))var _0x59fbfd=users[_0x4a22a9(0x1c3)];else{if(_0x9d659b[0x0]['language']=='Spanish')var _0x59fbfd=users[_0x4a22a9(0x22e)];else{if(_0x9d659b[0x0][_0x4a22a9(0x1ab)]==_0x4a22a9(0x200))var _0x59fbfd=users['French'];else{if(_0x9d659b[0x0][_0x4a22a9(0x1ab)]==_0x4a22a9(0x25b))var _0x59fbfd=users[_0x4a22a9(0x16a)];else{if(_0x9d659b[0x0][_0x4a22a9(0x1ab)]=='Chinese')var _0x59fbfd=users[_0x4a22a9(0x1b4)];else{if(_0x9d659b[0x0][_0x4a22a9(0x1ab)]==_0x4a22a9(0x205))var _0x59fbfd=users[_0x4a22a9(0x168)];}}}}}}}_0x1ad06a[_0x4a22a9(0x1e5)]('all_purchases',{'success':_0x107462[_0x4a22a9(0x1f6)](_0x4a22a9(0x179)),'errors':_0x107462[_0x4a22a9(0x1f6)]('errors'),'purchases':_0x6be4e0,'role':_0x3ceb30,'profile':_0x5ab0f1,'master_shop':_0x9d659b,'language':_0x59fbfd});}catch(_0x5d54ce){console[_0x4a22a9(0x212)](_0x4a22a9(0x219),_0x5d54ce),_0x1ad06a[_0x4a22a9(0x1c9)](0xc8)[_0x4a22a9(0x188)]({'message':_0x5d54ce[_0x4a22a9(0x1d5)]});}});function BayBinSelected(_0x2612c6,_0x57d5bb){var _0x3ac0fc=a0_0x5bff47,_0x1c6b8f=[],_0x2f6ce5=[],_0x306702=[],_0xd89a9f=[],_0x749042=[],_0x240046=[];let _0xf2163e=[];if(_0x2612c6==_0x3ac0fc(0x232))switch(_0x57d5bb){case _0x3ac0fc(0x226):_0x1c6b8f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2f6ce5=[0x1,0x2],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d),'Floor'],_0x749042=['D'],_0x240046=['A'];break;case _0x3ac0fc(0x1ae):_0x1c6b8f=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2f6ce5=[0x1,0x2],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d),_0x3ac0fc(0x1b9)],_0x749042=['D'],_0x240046=['B'];break;case _0x3ac0fc(0x177):_0x1c6b8f=[0x0],_0x2f6ce5=[0x0],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=['Floor'],_0x749042=['D'],_0x240046=['S'];break;case _0x3ac0fc(0x1a4):_0x1c6b8f=[0x0],_0x2f6ce5=[0x0],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x306702=[_0x3ac0fc(0x1b9)],_0x749042=['D'],_0x240046=['R'];break;}else{if(_0x2612c6=='COLD\x20STORAGE')switch(_0x57d5bb){case _0x3ac0fc(0x226):_0x1c6b8f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2f6ce5=['B','F'],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d),'Floor'],_0x749042=['C'],_0x240046=['A'];break;case _0x3ac0fc(0x1ae):_0x1c6b8f=[0x5,0x4,0x3,0x2,0x1],_0x2f6ce5=['F','B','S'],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d),_0x3ac0fc(0x1b9)],_0x749042=['C'],_0x240046=['B'];break;case _0x3ac0fc(0x254):_0x1c6b8f=[0x1,0x2,0x3,0x4,0x5],_0x2f6ce5=['B','F','S'],_0xd89a9f=[0x5,0x4,0x3,0x2,0x1],_0x306702=[_0x3ac0fc(0x23d),_0x3ac0fc(0x1b9)],_0x749042=['C'],_0x240046=['C'];break;case'Rack\x20D':_0x1c6b8f=[0x5,0x4,0x3,0x2,0x1],_0x2f6ce5=['F','B','S'],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d),_0x3ac0fc(0x1b9)],_0x749042=['C'],_0x240046=['D'];break;case _0x3ac0fc(0x234):_0x1c6b8f=[0x4,0x3,0x2,0x1],_0x2f6ce5=[0x1,0x2],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d),_0x3ac0fc(0x1b9)],_0x749042=['C'],_0x240046=['E'];break;case _0x3ac0fc(0x1fe):_0x1c6b8f=[0x1,0x2,0x3],_0x2f6ce5=[0x1,0x2],_0xd89a9f=[0x1,0x2,0x3,0x4,0x5],_0x306702=[_0x3ac0fc(0x23d)],_0x749042=['C'],_0x240046=['F'];break;}}return{'levels':_0x1c6b8f,'Isle':_0x2f6ce5,'rack':_0xd89a9f,'type':_0x306702,'storage':_0x749042,'rak':_0x240046};}async function getRandom8DigitNumber(){var _0x9923ab=a0_0x5bff47;const _0x2721bc=0x989680,_0x3a3722=0x5f5e0ff,_0x41d414=Math[_0x9923ab(0x220)](Math['random']()*(_0x3a3722-_0x2721bc+0x1))+_0x2721bc;var _0x142a03;const _0x58bd3c=await purchases[_0x9923ab(0x19a)]({'invoice':_0x9923ab(0x1df)+_0x41d414});return _0x58bd3c&&_0x58bd3c['length']>0x0?_0x142a03=_0x9923ab(0x1df)+_0x41d414:_0x142a03=_0x9923ab(0x1df)+_0x41d414,_0x142a03;}function a0_0x178b(){var _0xf712f6=['errors','production_date','$product.bin','$product_details.expiry_date','stock_quantity','redirect','../models/all_models','pallet','return_qty','return_purchase','maxperunit','abs','$product_details.secondary_code','deliverycode','json','user','Error\x20Occurs','$room','/give_payment/:id','2tGqhjn','$product_details.floorlevel','nodemailer','36MtvPMZ','RMSEmail','7rdynld','An\x20error\x20occurred.','filter','RoomAssign','date','MaxStocks_data','path','email','findOne','product_cat','type','alertQTY','</div>','$maxStocks','prod_isle','aggregate','<hr\x20class=\x22my-3\x22>','prod_primunit','Receiving\x20Area','$warehouse_name','$product.bay','English','getDate','\x20<>\x20','prod_qty','language','$secondary_unit','563664SgkADT','Rack\x20B','$_id','max_product_unit','createTransport','purchase_quantity','finalize','Chinese','room','/view/add_purchases','site_title','$batch_code','Floor','$product_details.primary_code','<div>','standard_unit','rak','True','POnumber','<span\x20style=\x22float:\x20right;\x22>','Sales\x20Update\x20successfully','all','German','Paid\x20For\x20Purchase','findById','product_details','forEach','staff','status','<tbody\x20style=\x22text-align:\x20center;\x22>','primary_code','room_name','</tbody>','length','Return\x20Goods','<html><head><title></title>','../middleware/auth','add\x20post','Purchase\x20Return','$suppliers_docs','message','back','$product_code','params','\x20Order\x20Date\x20:\x20','warehouse_name','prod_name','/barcode_scanner','/../public','floorlevel','INC-','purchases\x20item\x20return\x20successfull','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$alertquantity','$product_details.rack','edit_purchases_view','render','$suppliers','$secondary_code','405EIwIyW','post','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','image','/invoice/:id','level','logo','prod_code','$product_details.bin','password','$note','</span>','$expiry_date','flash','name','/view','prod_unit','/upload/','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$due_amount','Rack\x20F','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','French','$invoice','$product.floorlevel','/all_purchases/view','warehouse','Arabic\x20(ae)','<tr>','\x20Order\x20Number\x20:\x20','paid_amount','1785940eLaKTF','</table>','user_id','$product_details._id','then','Email\x20sent\x20successfully','128323xtLgcA','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','log','1108225Alluwt','product_stock','padStart','prod_invoice','sendMail','delivery_code','table\x20page','$unit','product_code_hide','bin','Purchase\x20data\x20added\x20successfully','\x20<\x20wew\x20>\x20','Hindi','floor','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','find','secondary_unit','</body></html>','Purchase\x20Return\x20Mail','Rack\x20A','types','/barcode/:id','$product_details.product_name','$product_details.type','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$category','actual_qty','DRY\x20STORAGE','suppliers','Rack\x20E','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$paid_amount','quantity','product','product_name','master','payment\x20successfull','add_purchases','Level','return_product','33cqmqFH','maxStocks','delivery_date','expiry_date','Raw\x20Materials','prod_pallet','$name','$date','actual_uom','$product.quantity','60NiBygb','getFullYear','secondary_code','/view/:id','</head><body>','map','<h5>','get','toString','</thead>','due_amount','Rack\x20C','concat','getMonth','$product_details','role','Enabled','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Portuguese\x20(BR)','</h5>','prod_Qty','An\x20error\x20occurred\x20while\x20saving\x20data.','rack','suppliers_docs','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','isle','</tr>','$product_details.product_stock','storage','slice','4353708yCKTJX','add_purchases\x20error','catch','primary_code_hide','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','host','$product_details.product_code','8048aWLzoj','secondary_code_hide','prod_cat','<strong>\x20Regards\x20</strong>','here','return_data','string','body','$brand','bay','error','batch_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic','foreach\x20newproduct','Portuguese','$product','<h2>\x20','prod_level','$finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.bay','$primary_code','172241XCIpyT','prod_secondunit','English\x20(US)','product_code','save','Shelves','</td>','success'];a0_0x178b=function(){return _0xf712f6;};return a0_0x178b();}router[a0_0x5bff47(0x250)]('/view/add_purchases',auth,async(_0x1f10f7,_0x548601)=>{var _0x423641=a0_0x5bff47;try{const {username:_0x443b39,email:_0x1a8a61,role:_0x563768}=_0x1f10f7['user'],_0x54ad99=_0x1f10f7[_0x423641(0x189)],_0xac3f5f=await profile[_0x423641(0x19a)]({'email':_0x54ad99[_0x423641(0x199)]}),_0x3f066d=await master_shop[_0x423641(0x222)](),_0x39abda=await staff['findOne']({'email':_0x54ad99['email']}),_0x733eae=await suppliers[_0x423641(0x222)]({});let _0x15e4f5;if(_0x54ad99[_0x423641(0x258)]=='staff'){const _0x3b9317=await staff['findOne']({'email':_0x54ad99[_0x423641(0x199)]});_0x15e4f5=await warehouse[_0x423641(0x1a1)]([{'$match':{'status':_0x423641(0x259),'name':_0x3b9317['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x423641(0x1cf)}}},{'$group':{'_id':_0x423641(0x245),'name':{'$first':'$name'}}}]);}else _0x15e4f5=await warehouse[_0x423641(0x1a1)]([{'$match':{'status':_0x423641(0x259),'warehouse_category':_0x423641(0x243),'name':{'$ne':_0x423641(0x1cf)}}},{'$group':{'_id':_0x423641(0x245),'name':{'$first':'$name'}}}]);const _0x447389=await product[_0x423641(0x222)]({}),_0x66efc1=await warehouse[_0x423641(0x222)]({'status':_0x423641(0x259)}),_0xfbbdf9=await purchases['find']({}),_0x2371dd=_0xfbbdf9[_0x423641(0x1ce)]+0x1,_0x397d97=_0x423641(0x1df)+_0x2371dd[_0x423641(0x251)]()[_0x423641(0x215)](0x5,'0');var _0x3bae2b=[_0x423641(0x1ea),'Enclosed'];if(_0x3f066d[0x0][_0x423641(0x1ab)]=='English\x20(US)')var _0x4fb587=users[_0x423641(0x1a7)];else{if(_0x3f066d[0x0][_0x423641(0x1ab)]=='Hindi')var _0x4fb587=users[_0x423641(0x21f)];else{if(_0x3f066d[0x0]['language']=='German')var _0x4fb587=users[_0x423641(0x1c3)];else{if(_0x3f066d[0x0][_0x423641(0x1ab)]==_0x423641(0x22e))var _0x4fb587=users[_0x423641(0x22e)];else{if(_0x3f066d[0x0][_0x423641(0x1ab)]=='French')var _0x4fb587=users[_0x423641(0x200)];else{if(_0x3f066d[0x0]['language']==_0x423641(0x25b))var _0x4fb587=users[_0x423641(0x16a)];else{if(_0x3f066d[0x0][_0x423641(0x1ab)]==_0x423641(0x1b4))var _0x4fb587=users['Chinese'];else{if(_0x3f066d[0x0]['language']==_0x423641(0x205))var _0x4fb587=users[_0x423641(0x168)];}}}}}}}const _0x31db73=getRandom8DigitNumber();_0x31db73[_0x423641(0x20d)](_0x22ef04=>{var _0x236f1f=_0x423641;_0x548601[_0x236f1f(0x1e5)](_0x236f1f(0x23c),{'success':_0x1f10f7[_0x236f1f(0x1f6)]('success'),'errors':_0x1f10f7[_0x236f1f(0x1f6)]('errors'),'role':_0x54ad99,'profile':_0xac3f5f,'suppliers':_0x733eae,'warehouse':_0x15e4f5,'product':_0x447389,'invoice':_0x22ef04,'master_shop':_0x3f066d,'language':_0x4fb587,'find_data':_0x66efc1,'rooms_data':_0x3bae2b});})[_0x423641(0x156)](_0x12ff22=>{var _0x4ea91a=_0x423641;_0x1f10f7[_0x4ea91a(0x1f6)]('errors',_0x4ea91a(0x235)),_0x548601['redirect'](_0x4ea91a(0x203));});}catch(_0x198393){console[_0x423641(0x212)](_0x198393);}}),router['get']('/view/add_purchases/:id',auth,async(_0x66113a,_0x1e6061)=>{var _0x357edf=a0_0x5bff47;try{const _0x246351=_0x66113a['params']['id'];console[_0x357edf(0x212)](_0x246351);const _0x222a1c=await master_shop[_0x357edf(0x222)]();console[_0x357edf(0x212)]('master',_0x222a1c);const _0xa1f1fc=await product[_0x357edf(0x19a)]({'name':_0x246351});console[_0x357edf(0x212)](_0x357edf(0x238),_0xa1f1fc),_0x1e6061['status'](0xc8)[_0x357edf(0x188)]({'product_data':_0xa1f1fc,'master':_0x222a1c});}catch(_0x59d9f3){console[_0x357edf(0x212)](_0x357edf(0x155),_0x59d9f3);}}),router[a0_0x5bff47(0x1e9)](a0_0x5bff47(0x1b6),auth,async(_0x4b3d91,_0x4d2f7d)=>{var _0x50e90b=a0_0x5bff47;try{const {invoice:_0x5ce3fa,date:_0x1f8478,warehouse_name:_0x4e2611,prod_name:_0x2fc1d1,prod_code:_0x40f4c8,prod_qty:_0x355f98,prod_unit:_0x7b9be6,prod_secondunit:_0xb9d953,prod_level:_0x48865b,prod_isle:_0xf7a7d2,prod_pallet:_0x2ced94,note:_0x5ee8a2,expiry_date:_0x2fbd89,batch_code:_0x450ce0,payable:_0x49acd2,due_amount:_0x4c1f85,Room_name:_0x538468,primary_code:_0x17d5b6,secondary_code:_0x4bb04b,MaxStocks_data:_0x496b25,PO_number:_0xa2ec98,SCRN:_0x142a86,JO_number:_0x5ce868}=_0x4b3d91[_0x50e90b(0x162)];if(typeof _0x2fc1d1=='string')var _0x5324ec=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x1db)]],_0x249294=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x1f0)]],_0x28c546=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x25d)]],_0x574f06=[_0x4b3d91['body'][_0x50e90b(0x1a3)]],_0x5af6b9=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x173)]],_0x30efa4=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x16d)]],_0x130ffa=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x1cb)]],_0xa0082b=[_0x4b3d91[_0x50e90b(0x162)]['secondary_code']],_0x25c87d=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x197)]],_0x12e3a1=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x166)]],_0x2761be=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x242)]],_0x4b1d4c=[_0x4b3d91[_0x50e90b(0x162)]['max_product_unit']],_0x295814=[_0x4b3d91[_0x50e90b(0x162)]['alertQTY']],_0x20e356=[_0x4b3d91['body'][_0x50e90b(0x17b)]],_0x1133ee=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x15d)]],_0x440522=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x195)]],_0x2f1353=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x187)]],_0x2532e6=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x216)]],_0x12590a=[_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x231)]],_0x392957=[_0x4b3d91[_0x50e90b(0x162)]['actual_uom']];else var _0x5324ec=[..._0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x1db)]],_0x249294=[..._0x4b3d91[_0x50e90b(0x162)]['prod_code']],_0x28c546=[..._0x4b3d91['body'][_0x50e90b(0x25d)]],_0x574f06=[..._0x4b3d91['body']['prod_primunit']],_0x5af6b9=[..._0x4b3d91['body'][_0x50e90b(0x173)]],_0x30efa4=[..._0x4b3d91['body'][_0x50e90b(0x16d)]],_0x130ffa=[..._0x4b3d91['body'][_0x50e90b(0x1cb)]],_0xa0082b=[..._0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x24b)]],_0x25c87d=[..._0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x197)]],_0x12e3a1=[..._0x4b3d91[_0x50e90b(0x162)]['batch_code']],_0x2761be=[..._0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x242)]],_0x4b1d4c=[..._0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x1b0)]],_0x295814=[..._0x4b3d91['body'][_0x50e90b(0x19d)]],_0x20e356=[..._0x4b3d91['body']['production_date']],_0x1133ee=[..._0x4b3d91[_0x50e90b(0x162)]['prod_cat']],_0x440522=[..._0x4b3d91[_0x50e90b(0x162)]['RoomAssign']],_0x2f1353=[..._0x4b3d91['body']['deliverycode']],_0x2532e6=[..._0x4b3d91['body'][_0x50e90b(0x216)]],_0x12590a=[..._0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x231)]],_0x392957=[..._0x4b3d91['body'][_0x50e90b(0x247)]];const _0x3dd0b1=_0x5324ec[_0x50e90b(0x24e)](_0x33d2e7=>{return _0x33d2e7={'product_name':_0x33d2e7};});_0x12590a[_0x50e90b(0x1c7)]((_0x361727,_0x2f7dad)=>{var _0x4c6959=_0x50e90b;_0x3dd0b1[_0x2f7dad][_0x4c6959(0x231)]=Math['abs'](_0x361727);}),_0x392957['forEach']((_0x1035e8,_0x43f1c7)=>{_0x3dd0b1[_0x43f1c7]['actual_uom']=_0x1035e8;}),_0x249294['forEach']((_0x2cea7f,_0x5130cc)=>{var _0x31fc9b=_0x50e90b;_0x3dd0b1[_0x5130cc][_0x31fc9b(0x175)]=_0x2cea7f;}),_0x28c546[_0x50e90b(0x1c7)]((_0x2b7e3f,_0x19d528)=>{_0x3dd0b1[_0x19d528]['quantity']=Math['abs'](_0x2b7e3f);}),_0x574f06['forEach']((_0x33c046,_0xd1f634)=>{var _0x331815=_0x50e90b;_0x3dd0b1[_0xd1f634][_0x331815(0x1bc)]=_0x33c046;}),_0x5af6b9[_0x50e90b(0x1c7)]((_0x2901be,_0x2d57ae)=>{var _0x6cc82=_0x50e90b;_0x3dd0b1[_0x2d57ae][_0x6cc82(0x223)]=_0x2901be;}),_0x30efa4[_0x50e90b(0x1c7)]((_0x469a71,_0x2397c6)=>{var _0x325d6a=_0x50e90b;_0x440522[_0x325d6a(0x1c7)]((_0x4b580b,_0x5db039)=>{var _0x5920e6=_0x325d6a;if(_0x4b580b=='Receiving\x20Area'&&_0x2397c6==_0x5db039){console[_0x5920e6(0x212)](_0x4b580b+_0x5920e6(0x21e)+_0x2397c6+_0x5920e6(0x1a9)+_0x5db039+'\x20<>\x20'+_0x469a71);var _0x563dc1=_0x469a71[_0x5920e6(0x153)](0x3);_0x3dd0b1[_0x2397c6][_0x5920e6(0x152)]=_0x469a71[0x0],_0x3dd0b1[_0x2397c6][_0x5920e6(0x14b)]=_0x469a71[0x1],_0x3dd0b1[_0x2397c6]['bay']=0x0,_0x3dd0b1[_0x2397c6][_0x5920e6(0x21c)]=0x0,_0x3dd0b1[_0x2397c6]['type']=_0x5920e6(0x1b9),_0x3dd0b1[_0x2397c6]['floorlevel']=_0x563dc1;}else{if(_0x4b580b=='Shelves'&&_0x2397c6==_0x5db039){var _0x563dc1=_0x469a71[_0x5920e6(0x153)](0x3);_0x3dd0b1[_0x2397c6][_0x5920e6(0x152)]=_0x469a71[0x0],_0x3dd0b1[_0x2397c6]['rack']=_0x469a71[0x1],_0x3dd0b1[_0x2397c6][_0x5920e6(0x164)]=0x0,_0x3dd0b1[_0x2397c6]['bin']=0x0,_0x3dd0b1[_0x2397c6][_0x5920e6(0x19c)]='Floor',_0x3dd0b1[_0x2397c6][_0x5920e6(0x1de)]=_0x469a71[0x5];}else{if(_0x2397c6==_0x5db039){if(_0x469a71[0x0]=='A'&&_0x469a71[0x1]=='L'&&_0x469a71[0x2]=='L')console['log'](_0x4b580b+_0x5920e6(0x1a9)+_0x2397c6+_0x5920e6(0x1a9)+_0x5db039+_0x5920e6(0x1a9)+_0x469a71+_0x5920e6(0x15f)),_0x3dd0b1[_0x2397c6][_0x5920e6(0x152)]=_0x469a71[0x0],_0x3dd0b1[_0x2397c6][_0x5920e6(0x14b)]=_0x469a71[0x1],_0x3dd0b1[_0x2397c6][_0x5920e6(0x164)]=0x0,_0x3dd0b1[_0x2397c6][_0x5920e6(0x21c)]=0x0,_0x3dd0b1[_0x2397c6][_0x5920e6(0x19c)]=_0x5920e6(0x1b9),_0x3dd0b1[_0x2397c6][_0x5920e6(0x1de)]=_0x469a71[0x3];else{var _0x33e57d;if(_0x469a71[0x4]=='L')_0x33e57d=_0x5920e6(0x23d);else _0x469a71[0x4]=='F'&&(_0x33e57d='Floor');_0x3dd0b1[_0x2397c6]['storage']=_0x469a71[0x0],_0x3dd0b1[_0x2397c6][_0x5920e6(0x14b)]=_0x469a71[0x1],_0x3dd0b1[_0x2397c6][_0x5920e6(0x164)]=_0x469a71[0x2],_0x3dd0b1[_0x2397c6][_0x5920e6(0x21c)]=_0x469a71[0x3],_0x3dd0b1[_0x2397c6][_0x5920e6(0x19c)]=_0x33e57d,_0x3dd0b1[_0x2397c6][_0x5920e6(0x1de)]=_0x469a71[0x5];}}}}});}),_0x130ffa[_0x50e90b(0x1c7)]((_0x264223,_0x2d438a)=>{var _0x1fce6b=_0x50e90b;_0x3dd0b1[_0x2d438a][_0x1fce6b(0x1cb)]=_0x264223;}),_0xa0082b[_0x50e90b(0x1c7)]((_0x308332,_0x599079)=>{var _0x40c4d5=_0x50e90b;_0x3dd0b1[_0x599079][_0x40c4d5(0x24b)]=_0x308332;}),_0x25c87d[_0x50e90b(0x1c7)]((_0x254331,_0x141b0d)=>{var _0x379f82=_0x50e90b;_0x3dd0b1[_0x141b0d][_0x379f82(0x240)]=_0x254331;}),_0x12e3a1['forEach']((_0x59aa63,_0x8b089a)=>{var _0x537ed9=_0x50e90b;_0x3dd0b1[_0x8b089a][_0x537ed9(0x166)]=_0x59aa63;}),_0x2761be['forEach']((_0x40ac58,_0x399526)=>{var _0x48be5b=_0x50e90b;_0x3dd0b1[_0x399526][_0x48be5b(0x242)]=_0x40ac58;}),_0x4b1d4c['forEach']((_0x5823b2,_0x18a860)=>{_0x3dd0b1[_0x18a860]['maxperunit']=_0x5823b2;}),_0x295814[_0x50e90b(0x1c7)]((_0x1bdd9c,_0x2d5536)=>{var _0xa633cc=_0x50e90b;_0x3dd0b1[_0x2d5536][_0xa633cc(0x19d)]=_0x1bdd9c;}),_0x20e356['forEach']((_0x18c4c9,_0x43755a)=>{_0x3dd0b1[_0x43755a]['production_date']=_0x18c4c9;}),_0x1133ee[_0x50e90b(0x1c7)]((_0x228ac8,_0x6b5793)=>{var _0x4c42c6=_0x50e90b;_0x3dd0b1[_0x6b5793][_0x4c42c6(0x19b)]=_0x228ac8;}),_0x440522[_0x50e90b(0x1c7)]((_0x495551,_0x88934c)=>{_0x3dd0b1[_0x88934c]['room_name']=_0x495551;}),_0x2f1353[_0x50e90b(0x1c7)]((_0x3862db,_0x255cf0)=>{var _0xc2c37d=_0x50e90b;_0x3dd0b1[_0x255cf0][_0xc2c37d(0x218)]=_0x3862db;}),_0x2532e6['forEach']((_0x42eb6d,_0x5446a1)=>{_0x3dd0b1[_0x5446a1]['invoice']=_0x42eb6d;});const _0x3fdb0f=_0x440522[_0x50e90b(0x24e)](_0x59b712=>{return _0x59b712={'room_name':_0x59b712};}),_0x28f99a=_0x3dd0b1['filter'](_0x4a592e=>_0x4a592e['quantity']!=='0'&&_0x4a592e['quantity']!==''),_0x5e593a=new purchases({'invoice':_0x5ce3fa,'suppliers':_0x4b3d91[_0x50e90b(0x162)][_0x50e90b(0x233)],'date':_0x1f8478,'warehouse_name':_0x4e2611,'product':_0x28f99a,'note':_0x5ee8a2,'due_amount':_0x4c1f85,'POnumber':_0xa2ec98,'SCRN':_0x142a86,'JO_number':_0x5ce868,'roomList':_0x3fdb0f}),_0x25c599=await _0x5e593a[_0x50e90b(0x176)](),_0x17c756=await purchases[_0x50e90b(0x19a)]({'invoice':_0x5ce3fa}),_0xca02d5=_0x17c756[_0x50e90b(0x238)]['map'](async _0xe546f7=>{var _0x1e4e0c=_0x50e90b,_0x59f222=await warehouse[_0x1e4e0c(0x19a)]({'name':_0x4e2611,'room':_0xe546f7[_0x1e4e0c(0x1cc)]}),_0x3a0d16=0x0;return _0x59f222[_0x1e4e0c(0x1c6)][_0x1e4e0c(0x1c7)](_0xab957a=>{var _0x261239=_0x1e4e0c;_0xab957a[_0x261239(0x239)]==_0xe546f7[_0x261239(0x239)]&&_0xab957a[_0x261239(0x1de)]==_0xe546f7[_0x261239(0x1de)]&&_0xab957a[_0x261239(0x19c)]==_0xe546f7[_0x261239(0x19c)]&&_0xab957a[_0x261239(0x21c)]==_0xe546f7['bin']&&_0xab957a[_0x261239(0x164)]==_0xe546f7[_0x261239(0x164)]&&_0xab957a['rack']==_0xe546f7[_0x261239(0x14b)]&&_0xab957a['storage']==_0xe546f7[_0x261239(0x152)]&&_0xab957a[_0x261239(0x242)]==_0xe546f7['expiry_date']&&_0xab957a[_0x261239(0x166)]==_0xe546f7[_0x261239(0x166)]&&_0xab957a[_0x261239(0x17b)]==_0xe546f7[_0x261239(0x17b)]&&_0xab957a['invoice']==_0x17c756[_0x261239(0x14d)]&&(_0xab957a[_0x261239(0x214)]+=Math['abs'](_0xe546f7[_0x261239(0x237)]),_0x3a0d16++);}),_0x3a0d16===0x0&&_0x59f222['product_details']['push']({'product_name':_0xe546f7[_0x1e4e0c(0x239)],'product_stock':Math[_0x1e4e0c(0x185)](_0xe546f7['quantity']),'primary_code':_0xe546f7[_0x1e4e0c(0x1cb)],'secondary_code':_0xe546f7[_0x1e4e0c(0x24b)],'product_code':_0xe546f7[_0x1e4e0c(0x175)],'storage':_0xe546f7[_0x1e4e0c(0x152)],'rack':_0xe546f7[_0x1e4e0c(0x14b)],'bay':_0xe546f7[_0x1e4e0c(0x164)],'bin':_0xe546f7['bin'],'type':_0xe546f7['type'],'floorlevel':_0xe546f7['floorlevel'],'maxProducts':_0xe546f7[_0x1e4e0c(0x240)],'unit':_0xe546f7['standard_unit'],'secondary_unit':_0xe546f7[_0x1e4e0c(0x223)],'expiry_date':_0xe546f7['expiry_date'],'maxPerUnit':_0xe546f7[_0x1e4e0c(0x184)],'batch_code':_0xe546f7[_0x1e4e0c(0x166)],'alertQTY':_0xe546f7[_0x1e4e0c(0x19d)],'production_date':_0xe546f7[_0x1e4e0c(0x17b)],'product_cat':_0xe546f7[_0x1e4e0c(0x19b)],'invoice':_0xe546f7[_0x1e4e0c(0x14d)],'actual_qty':Math[_0x1e4e0c(0x185)](_0xe546f7[_0x1e4e0c(0x231)]),'actual_uom':_0xe546f7[_0x1e4e0c(0x247)]}),_0x59f222;});Promise[_0x50e90b(0x1c2)](_0xca02d5)['then'](async _0x46e177=>{var _0x569481=_0x50e90b;try{for(const _0x10890c of _0x46e177){await _0x10890c[_0x569481(0x176)]();}const _0x2a96f8=await master_shop[_0x569481(0x222)](),_0x602b37=await email_settings['findOne'](),_0x55a3ee=await supervisor_settings[_0x569481(0x222)]();var _0x2299e5=_0x17c756[_0x569481(0x238)],_0x57c514='',_0xdb5107;for(_0xdb5107 in _0x2299e5){_0x57c514+='<tr>'+_0x569481(0x1e1)+_0x2299e5[_0xdb5107][_0x569481(0x239)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2299e5[_0xdb5107][_0x569481(0x175)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2299e5[_0xdb5107][_0x569481(0x237)]+_0x569481(0x178)+_0x569481(0x1e1)+_0x2299e5[_0xdb5107]['standard_unit']+_0x569481(0x178)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2299e5[_0xdb5107][_0x569481(0x223)]+_0x569481(0x178)+_0x569481(0x1e1)+_0x17c756[_0x569481(0x1da)]+_0x569481(0x178)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2299e5[_0xdb5107][_0x569481(0x1cc)]+_0x569481(0x178)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2299e5[_0xdb5107][_0x569481(0x152)]+_0x2299e5[_0xdb5107][_0x569481(0x14b)]+_0x2299e5[_0xdb5107][_0x569481(0x164)]+_0x2299e5[_0xdb5107]['bin']+_0x2299e5[_0xdb5107][_0x569481(0x19c)][0x0]+_0x2299e5[_0xdb5107][_0x569481(0x1de)]+_0x569481(0x178),'</tr>';}let _0x473ce4=nodemailer[_0x569481(0x1b1)]({'host':_0x602b37[_0x569481(0x159)],'port':Number(_0x602b37['port']),'secure':![],'auth':{'user':_0x602b37[_0x569481(0x199)],'pass':_0x602b37[_0x569481(0x1f2)]}}),_0x918fbf={'from':_0x602b37[_0x569481(0x199)],'to':_0x55a3ee[0x0][_0x569481(0x191)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x569481(0x22b),'path':__dirname+'/../public'+_0x569481(0x1fa)+_0x2a96f8[0x0][_0x569481(0x1ec)],'cid':_0x569481(0x1ef)}],'html':_0x569481(0x1fb)+_0x569481(0x1d0)+_0x569481(0x24d)+_0x569481(0x1bb)+_0x569481(0x25a)+_0x569481(0x1bb)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x569481(0x19e)+_0x569481(0x1bb)+_0x569481(0x16c)+_0x2a96f8[0x0][_0x569481(0x1b7)]+'\x20</h2>'+'</div>'+_0x569481(0x19e)+'<hr\x20class=\x22my-3\x22>'+_0x569481(0x1bb)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x569481(0x207)+_0x17c756[_0x569481(0x14d)]+'\x20'+_0x569481(0x1c0)+_0x569481(0x1d9)+_0x17c756[_0x569481(0x196)]+'\x20'+_0x569481(0x1f4)+_0x569481(0x25c)+'</div>'+_0x569481(0x167)+_0x569481(0x16f)+_0x569481(0x206)+_0x569481(0x22f)+_0x569481(0x22d)+_0x569481(0x22c)+_0x569481(0x211)+_0x569481(0x1eb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x569481(0x14e)+_0x569481(0x1ff)+_0x569481(0x150)+_0x569481(0x252)+_0x569481(0x1ca)+'\x20'+_0x57c514+'\x20'+_0x569481(0x1cd)+'</table>'+_0x569481(0x1bb)+_0x569481(0x15e)+_0x569481(0x24f)+_0x2a96f8[0x0][_0x569481(0x1b7)]+_0x569481(0x25c)+_0x569481(0x19e)+_0x569481(0x19e)+_0x569481(0x224)};_0x473ce4[_0x569481(0x217)](_0x918fbf,function(_0x426f45,_0x519574){var _0x43c1b9=_0x569481;_0x426f45?(console[_0x43c1b9(0x212)](_0x426f45),console[_0x43c1b9(0x212)](_0x43c1b9(0x18a))):console[_0x43c1b9(0x212)](_0x43c1b9(0x20e));}),_0x4b3d91['flash'](_0x569481(0x179),_0x569481(0x21d)),_0x4d2f7d[_0x569481(0x17f)]('/all_purchases/view/');}catch(_0x41e0d3){console[_0x569481(0x165)](_0x41e0d3),_0x4d2f7d[_0x569481(0x1c9)](0x1f4)['json']({'error':_0x569481(0x14a)});}})['catch'](_0x626b41=>{var _0x23cf4d=_0x50e90b;console[_0x23cf4d(0x165)](_0x626b41),_0x4d2f7d['status'](0x1f4)[_0x23cf4d(0x188)]({'error':_0x23cf4d(0x193)});});}catch(_0x32cbc4){console[_0x50e90b(0x212)](_0x32cbc4);}}),router[a0_0x5bff47(0x250)]('/preview/:id',auth,async(_0x238817,_0x153195)=>{var _0x1efffb=a0_0x5bff47;try{const {username:_0x46f7c6,email:_0x4afc3e,role:_0x18ab03}=_0x238817[_0x1efffb(0x189)],_0x3cd339=_0x238817[_0x1efffb(0x189)],_0x3bb498=await profile[_0x1efffb(0x19a)]({'email':_0x3cd339[_0x1efffb(0x199)]}),_0x2393aa=await master_shop[_0x1efffb(0x222)](),_0x4a3fea=_0x238817[_0x1efffb(0x1d8)]['id'],_0x37d273=await purchases['findById'](_0x4a3fea),_0x4c2639=await warehouse[_0x1efffb(0x1a1)]([{'$match':{'name':_0x37d273[_0x1efffb(0x1da)],'room':_0x37d273['room']}},{'$unwind':_0x1efffb(0x257)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1efffb(0x151)},'bay':{'$first':_0x1efffb(0x170)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1efffb(0x22a)},'floorlevel':{'$first':_0x1efffb(0x18e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1efffb(0x186)},'product_code':{'$first':_0x1efffb(0x15a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1efffb(0x1e3)},'expiry_date':{'$first':_0x1efffb(0x17d)}}}]),_0x4f6841=await customer[_0x1efffb(0x222)]({});let _0x173fef;if(_0x3cd339[_0x1efffb(0x258)]==_0x1efffb(0x1c8)){const _0x5f26ea=await staff[_0x1efffb(0x19a)]({'email':_0x3cd339['email']});_0x173fef=await warehouse[_0x1efffb(0x1a1)]([{'$match':{'status':_0x1efffb(0x259),'name':_0x5f26ea[_0x1efffb(0x204)]}},{'$group':{'_id':'$name','name':{'$first':_0x1efffb(0x245)}}}]);}else _0x173fef=await warehouse['aggregate']([{'$match':{'status':_0x1efffb(0x259)}},{'$group':{'_id':_0x1efffb(0x245),'name':{'$first':_0x1efffb(0x245)}}}]);const _0x245a1=await product[_0x1efffb(0x222)]({}),_0x257940=await suppliers[_0x1efffb(0x222)]({}),_0x11732b=BayBinSelected(_0x37d273[_0x1efffb(0x1da)],_0x37d273[_0x1efffb(0x1b5)]);if(_0x2393aa[0x0][_0x1efffb(0x1ab)]==_0x1efffb(0x174)){var _0x5f28a6=users[_0x1efffb(0x1a7)];console[_0x1efffb(0x212)](_0x5f28a6);}else{if(_0x2393aa[0x0][_0x1efffb(0x1ab)]==_0x1efffb(0x21f))var _0x5f28a6=users[_0x1efffb(0x21f)];else{if(_0x2393aa[0x0][_0x1efffb(0x1ab)]==_0x1efffb(0x1c3))var _0x5f28a6=users[_0x1efffb(0x1c3)];else{if(_0x2393aa[0x0][_0x1efffb(0x1ab)]=='Spanish')var _0x5f28a6=users[_0x1efffb(0x22e)];else{if(_0x2393aa[0x0]['language']==_0x1efffb(0x200))var _0x5f28a6=users[_0x1efffb(0x200)];else{if(_0x2393aa[0x0][_0x1efffb(0x1ab)]==_0x1efffb(0x25b))var _0x5f28a6=users[_0x1efffb(0x16a)];else{if(_0x2393aa[0x0][_0x1efffb(0x1ab)]==_0x1efffb(0x1b4))var _0x5f28a6=users[_0x1efffb(0x1b4)];else{if(_0x2393aa[0x0]['language']==_0x1efffb(0x205))var _0x5f28a6=users[_0x1efffb(0x168)];}}}}}}}_0x153195[_0x1efffb(0x1e5)](_0x1efffb(0x1e4),{'success':_0x238817['flash'](_0x1efffb(0x179)),'errors':_0x238817[_0x1efffb(0x1f6)](_0x1efffb(0x17a)),'role':_0x3cd339,'profile':_0x3bb498,'customer':_0x4f6841,'warehouse':_0x173fef,'product':_0x4c2639,'user':_0x37d273,'master_shop':_0x2393aa,'unit':_0x245a1,'language':_0x5f28a6,'suppliers':_0x257940,'dataSelected':_0x11732b});}catch(_0x3b3795){console[_0x1efffb(0x212)](_0x3b3795);}}),router[a0_0x5bff47(0x1e9)]('/preview/:id',auth,async(_0x1a97fa,_0x535de6)=>{var _0x5d84bc=a0_0x5bff47;try{const _0xa47466=_0x1a97fa[_0x5d84bc(0x1d8)]['id'],{invoice:_0x2cd81c,warehouse_name:_0x13d1ab,Room_name:_0x21ddbd}=_0x1a97fa[_0x5d84bc(0x162)],_0x36d016=await warehouse['findOne']({'name':_0x13d1ab,'room':_0x21ddbd}),_0x2c02f9=await purchases[_0x5d84bc(0x19a)]({'invoice':_0x2cd81c});_0x2c02f9['product'][_0x5d84bc(0x1c7)](_0x5017cb=>{var _0x573696=_0x5d84bc,_0x19df87=0x0;const _0x43b094=_0x36d016['product_details'][_0x573696(0x24e)](_0x5a2bc8=>{var _0xcdc3d7=_0x573696;_0x5a2bc8[_0xcdc3d7(0x239)]==_0x5017cb[_0xcdc3d7(0x239)]&&_0x5a2bc8[_0xcdc3d7(0x1de)]==_0x5017cb[_0xcdc3d7(0x1de)]&&_0x5a2bc8[_0xcdc3d7(0x19c)]==_0x5017cb[_0xcdc3d7(0x19c)]&&_0x5a2bc8[_0xcdc3d7(0x21c)]==_0x5017cb[_0xcdc3d7(0x21c)]&&_0x5a2bc8[_0xcdc3d7(0x164)]==_0x5017cb[_0xcdc3d7(0x164)]&&_0x5a2bc8[_0xcdc3d7(0x14b)]==_0x5017cb[_0xcdc3d7(0x14b)]&&_0x5a2bc8[_0xcdc3d7(0x152)]==_0x5017cb['storage']&&_0x5a2bc8[_0xcdc3d7(0x242)]==_0x5017cb[_0xcdc3d7(0x242)]&&_0x5a2bc8['batch_code']==_0x5017cb['batch_code']&&_0x5a2bc8[_0xcdc3d7(0x17b)]==_0x5017cb[_0xcdc3d7(0x17b)]&&_0x5a2bc8[_0xcdc3d7(0x241)]==_0x5017cb['delivery_date']&&_0x5a2bc8['delivery_code']==_0x5017cb[_0xcdc3d7(0x218)]&&(_0x5a2bc8[_0xcdc3d7(0x214)]=parseInt(_0x5a2bc8[_0xcdc3d7(0x214)])+parseInt(_0x5017cb[_0xcdc3d7(0x237)]),_0x19df87++);});_0x19df87=='0'&&(_0x36d016[_0x573696(0x1c6)]=_0x36d016['product_details'][_0x573696(0x255)]({'product_name':_0x5017cb['product_name'],'product_stock':_0x5017cb['quantity'],'primary_code':_0x5017cb['primary_code'],'secondary_code':_0x5017cb['secondary_code'],'product_code':_0x5017cb[_0x573696(0x175)],'storage':_0x5017cb[_0x573696(0x152)],'rack':_0x5017cb[_0x573696(0x14b)],'bay':_0x5017cb['bay'],'bin':_0x5017cb[_0x573696(0x21c)],'type':_0x5017cb[_0x573696(0x19c)],'floorlevel':_0x5017cb[_0x573696(0x1de)],'maxProducts':_0x5017cb[_0x573696(0x240)],'unit':_0x5017cb[_0x573696(0x1bc)],'secondary_unit':_0x5017cb[_0x573696(0x223)],'expiry_date':_0x5017cb[_0x573696(0x242)],'maxPerUnit':_0x5017cb[_0x573696(0x184)],'batch_code':_0x5017cb[_0x573696(0x166)],'alertQTY':_0x5017cb[_0x573696(0x19d)],'production_date':_0x5017cb['production_date'],'delivery_date':_0x5017cb[_0x573696(0x241)],'delivery_code':_0x5017cb[_0x573696(0x218)]}));}),await _0x36d016[_0x5d84bc(0x176)](),_0x2c02f9[_0x5d84bc(0x1b3)]=_0x5d84bc(0x1be);const _0x463430=await _0x2c02f9[_0x5d84bc(0x176)]();_0x1a97fa[_0x5d84bc(0x1f6)](_0x5d84bc(0x179),_0x5d84bc(0x1c1)),_0x535de6['redirect']('/all_purchases/view');}catch(_0x896dcc){console[_0x5d84bc(0x212)](_0x896dcc);}}),router['get'](a0_0x5bff47(0x24c),auth,async(_0xc7064e,_0x2d5ab7)=>{var _0x173402=a0_0x5bff47;try{const {username:_0x3e738b,email:_0x394995,role:_0x519660}=_0xc7064e[_0x173402(0x189)],_0x1ccd56=_0xc7064e['user'],_0x175a2a=await profile[_0x173402(0x19a)]({'email':_0x1ccd56['email']}),_0x131eb8=await master_shop[_0x173402(0x222)](),_0xb6b74b=_0xc7064e['params']['id'],_0x403ab1=await purchases[_0x173402(0x1c5)](_0xb6b74b),_0x2fbaf7=await suppliers[_0x173402(0x222)]({});let _0x1430df;if(_0x1ccd56[_0x173402(0x258)]==_0x173402(0x1c8)){const _0x50f0e2=await staff['findOne']({'email':_0x1ccd56['email']});_0x1430df=await warehouse[_0x173402(0x222)]({'status':_0x173402(0x259),'name':_0x50f0e2[_0x173402(0x204)],'warehouse_category':_0x173402(0x243)});}else _0x1430df=await warehouse['aggregate']([{'$match':{'status':_0x173402(0x259),'warehouse_category':_0x173402(0x243)}},{'$group':{'_id':'$name','name':{'$first':_0x173402(0x245)}}}]);const _0x29b45e=await product['find']({}),_0x28ff56=BayBinSelected(_0x403ab1['warehouse_name'],_0x403ab1[_0x173402(0x1b5)]);let _0xde3f78=new Date(_0x403ab1[_0x173402(0x242)]),_0x55d40c=('0'+_0xde3f78[_0x173402(0x1a8)]())[_0x173402(0x153)](-0x2),_0xbdc0dc=('0'+(_0xde3f78['getMonth']()+0x1))[_0x173402(0x153)](-0x2),_0x1bcfb7=_0xde3f78[_0x173402(0x24a)](),_0x2a0975=_0x1bcfb7+'-'+_0xbdc0dc+'-'+_0x55d40c;if(_0x131eb8[0x0][_0x173402(0x1ab)]=='English\x20(US)'){var _0x1f582f=users[_0x173402(0x1a7)];console[_0x173402(0x212)](_0x1f582f);}else{if(_0x131eb8[0x0][_0x173402(0x1ab)]==_0x173402(0x21f))var _0x1f582f=users['Hindi'];else{if(_0x131eb8[0x0][_0x173402(0x1ab)]==_0x173402(0x1c3))var _0x1f582f=users[_0x173402(0x1c3)];else{if(_0x131eb8[0x0]['language']==_0x173402(0x22e))var _0x1f582f=users[_0x173402(0x22e)];else{if(_0x131eb8[0x0][_0x173402(0x1ab)]==_0x173402(0x200))var _0x1f582f=users['French'];else{if(_0x131eb8[0x0][_0x173402(0x1ab)]==_0x173402(0x25b))var _0x1f582f=users['Portuguese'];else{if(_0x131eb8[0x0]['language']==_0x173402(0x1b4))var _0x1f582f=users[_0x173402(0x1b4)];else{if(_0x131eb8[0x0][_0x173402(0x1ab)]==_0x173402(0x205))var _0x1f582f=users[_0x173402(0x168)];}}}}}}}_0x2d5ab7[_0x173402(0x1e5)]('edit_purchases',{'success':_0xc7064e['flash'](_0x173402(0x179)),'errors':_0xc7064e[_0x173402(0x1f6)]('errors'),'role':_0x1ccd56,'profile':_0x175a2a,'purchases':_0x403ab1,'suppliers':_0x2fbaf7,'warehouse':_0x1430df,'product':_0x29b45e,'master_shop':_0x131eb8,'language':_0x1f582f,'ed_fullDate':_0x2a0975,'dataSelected':_0x28ff56});}catch(_0x571000){console[_0x173402(0x212)](_0x571000);}}),router[a0_0x5bff47(0x1e9)]('/view/:id',auth,async(_0x1f7f94,_0x165f01)=>{var _0x211d13=a0_0x5bff47;try{const _0x1862c6=_0x1f7f94['params']['id'],_0x5623cd=await purchases[_0x211d13(0x19a)]({'_id':_0x1f7f94[_0x211d13(0x1d8)]['id']}),_0x24ac52=await warehouse[_0x211d13(0x19a)]({'name':_0x5623cd[_0x211d13(0x1da)],'room':_0x5623cd[_0x211d13(0x1b5)]});_0x5623cd[_0x211d13(0x238)]['forEach'](_0x20ed9d=>{var _0x2f9ff9=_0x211d13;const _0x1c30d1=_0x24ac52[_0x2f9ff9(0x1c6)][_0x2f9ff9(0x24e)](_0xac67e=>{var _0x49c21c=_0x2f9ff9;_0xac67e['product_name']==_0x20ed9d[_0x49c21c(0x239)]&&_0xac67e['floorlevel']==_0x20ed9d[_0x49c21c(0x1de)]&&_0xac67e['type']==_0x20ed9d[_0x49c21c(0x19c)]&&_0xac67e['bin']==_0x20ed9d[_0x49c21c(0x21c)]&&_0xac67e['bay']==_0x20ed9d['bay']&&_0xac67e[_0x49c21c(0x14b)]==_0x20ed9d[_0x49c21c(0x14b)]&&_0xac67e[_0x49c21c(0x152)]==_0x20ed9d['storage']&&(_0xac67e['product_stock']=parseInt(_0xac67e[_0x49c21c(0x214)])-parseInt(_0x20ed9d['quantity']));});}),await _0x24ac52[_0x211d13(0x176)]();const {invoice:_0x126ed2,suppliers:_0x14ec87,date:_0x80958b,warehouse_name:_0x329a75,prod_name:_0x4e6beb,prod_code:_0x11bddb,prod_qty:_0x437397,prod_unit:_0x5d9900,prod_secondunit:_0x6b7fda,prod_level:_0x1a0751,prod_isle:_0x42e3cb,prod_pallet:_0x2ae8d8,note:_0x3333cf,expiry_date:_0xb5078,batch_code:_0x5caa01,paid_amount:_0x4cae5b,due_amount:_0x57fd94,Room_name:_0x51efdd,primary_code:_0x5792e3,secondary_code:_0x412750,PO_number:_0x3d1923,JO_number:_0x2c5485}=_0x1f7f94[_0x211d13(0x162)];if(typeof _0x4e6beb==_0x211d13(0x161))var _0x3d53c8=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1db)]],_0xe2f40=[_0x1f7f94[_0x211d13(0x162)]['prod_code']],_0x2499fe=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1aa)]],_0x2cf2fe=[_0x1f7f94['body'][_0x211d13(0x1f9)]],_0x840eed=[_0x1f7f94['body']['prod_secondunit']],_0x439cb1=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x16d)]],_0x19d6ec=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1a0)]],_0x5d8470=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x244)]],_0xe43ba8=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1cb)]],_0x328f8c=[_0x1f7f94[_0x211d13(0x162)]['secondary_code']],_0x4723c7=[_0x1f7f94['body'][_0x211d13(0x197)]],_0x3ad906=[_0x1f7f94['body'][_0x211d13(0x166)]],_0x5d9539=[_0x1f7f94['body']['expiry_date']],_0x2b67c6=[_0x1f7f94[_0x211d13(0x162)]['storage']],_0x4260d5=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1bd)]],_0x2266f1=[_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x19c)]];else var _0x3d53c8=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1db)]],_0xe2f40=[..._0x1f7f94[_0x211d13(0x162)]['prod_code']],_0x2499fe=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1aa)]],_0x2cf2fe=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1f9)]],_0x840eed=[..._0x1f7f94[_0x211d13(0x162)]['prod_secondunit']],_0x439cb1=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x16d)]],_0x19d6ec=[..._0x1f7f94['body'][_0x211d13(0x1a0)]],_0x5d8470=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x244)]],_0xe43ba8=[..._0x1f7f94['body'][_0x211d13(0x1cb)]],_0x328f8c=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x24b)]],_0x4723c7=[..._0x1f7f94[_0x211d13(0x162)]['MaxStocks_data']],_0x3ad906=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x166)]],_0x5d9539=[..._0x1f7f94[_0x211d13(0x162)][_0x211d13(0x242)]],_0x2b67c6=[..._0x1f7f94[_0x211d13(0x162)]['storage']],_0x4260d5=[..._0x1f7f94[_0x211d13(0x162)]['rak']],_0x2266f1=[..._0x1f7f94['body'][_0x211d13(0x19c)]];const _0x297f56=_0x3d53c8[_0x211d13(0x24e)](_0x3a17e9=>{return _0x3a17e9={'product_name':_0x3a17e9};});_0xe2f40['forEach']((_0x3bfb85,_0x17dffd)=>{var _0x402a70=_0x211d13;_0x297f56[_0x17dffd][_0x402a70(0x175)]=_0x3bfb85;}),_0x2499fe['forEach']((_0x47a608,_0x5369a6)=>{var _0x267dc1=_0x211d13;_0x297f56[_0x5369a6][_0x267dc1(0x237)]=_0x47a608;}),_0x2cf2fe[_0x211d13(0x1c7)]((_0x4b25c2,_0x31e223)=>{_0x297f56[_0x31e223]['standard_unit']=_0x4b25c2;}),_0x840eed[_0x211d13(0x1c7)]((_0x7903b9,_0x3da0c7)=>{var _0x1b5ee9=_0x211d13;_0x297f56[_0x3da0c7][_0x1b5ee9(0x223)]=_0x7903b9;}),_0x439cb1['forEach']((_0x3e593c,_0xe2d87f)=>{var _0xa33cfb=_0x211d13;_0x297f56[_0xe2d87f][_0xa33cfb(0x164)]=_0x3e593c;}),_0x19d6ec[_0x211d13(0x1c7)]((_0x21a4e7,_0x2a242a)=>{var _0x1b1fd6=_0x211d13;_0x297f56[_0x2a242a][_0x1b1fd6(0x21c)]=_0x21a4e7;}),_0x5d8470[_0x211d13(0x1c7)]((_0x2c55b9,_0x4e97f0)=>{var _0x1bf438=_0x211d13;_0x297f56[_0x4e97f0][_0x1bf438(0x1de)]=_0x2c55b9;}),_0xe43ba8[_0x211d13(0x1c7)]((_0x5a3251,_0x2bca1e)=>{_0x297f56[_0x2bca1e]['primary_code']=_0x5a3251;}),_0x328f8c[_0x211d13(0x1c7)]((_0x458c43,_0x504f26)=>{var _0x5360ef=_0x211d13;_0x297f56[_0x504f26][_0x5360ef(0x24b)]=_0x458c43;}),_0x4723c7[_0x211d13(0x1c7)]((_0x229eba,_0x56ec9b)=>{var _0xce3b75=_0x211d13;_0x297f56[_0x56ec9b][_0xce3b75(0x240)]=_0x229eba;}),_0x3ad906[_0x211d13(0x1c7)]((_0x379f32,_0x529d29)=>{var _0x482f88=_0x211d13;_0x297f56[_0x529d29][_0x482f88(0x166)]=_0x379f32;}),_0x5d9539['forEach']((_0x46e01b,_0x518323)=>{var _0x5cf51c=_0x211d13;_0x297f56[_0x518323][_0x5cf51c(0x242)]=_0x46e01b;}),_0x2266f1[_0x211d13(0x1c7)]((_0x3e7412,_0x5ab2b4)=>{var _0x8f9e08=_0x211d13;_0x297f56[_0x5ab2b4][_0x8f9e08(0x19c)]=_0x3e7412;}),_0x2b67c6['forEach']((_0x1acbf2,_0x114951)=>{var _0x29c4e5=_0x211d13;_0x297f56[_0x114951][_0x29c4e5(0x152)]=_0x1acbf2;}),_0x4260d5[_0x211d13(0x1c7)]((_0x309277,_0x56d2cd)=>{var _0x67be33=_0x211d13;_0x297f56[_0x56d2cd][_0x67be33(0x14b)]=_0x309277;});const _0x24b3be=_0x297f56[_0x211d13(0x194)](_0x336dd6=>_0x336dd6[_0x211d13(0x237)]!=='0'&&_0x336dd6[_0x211d13(0x237)]!=='');_0x5623cd['invoice']=_0x126ed2,_0x5623cd[_0x211d13(0x233)]=_0x14ec87,_0x5623cd[_0x211d13(0x196)]=_0x80958b,_0x5623cd[_0x211d13(0x1da)]=_0x329a75,_0x5623cd[_0x211d13(0x238)]=_0x24b3be,_0x5623cd['note']=_0x3333cf,_0x5623cd['paid_amount']=_0x4cae5b,_0x5623cd[_0x211d13(0x253)]=_0x57fd94,_0x5623cd['room']=_0x51efdd,_0x5623cd[_0x211d13(0x1bf)]=_0x3d1923,_0x5623cd['JO_number']=_0x2c5485;const _0x4dde76=await _0x5623cd[_0x211d13(0x176)](),_0x2f2da4=await warehouse[_0x211d13(0x19a)]({'name':_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x1da)],'room':_0x1f7f94[_0x211d13(0x162)]['Room_name']});_0x5623cd[_0x211d13(0x238)][_0x211d13(0x1c7)](_0x5d8b73=>{var _0x47db2c=_0x211d13,_0x522ab7=0x0;const _0x2427e5=_0x2f2da4[_0x47db2c(0x1c6)][_0x47db2c(0x24e)](_0x5ebfe1=>{var _0xb2e91e=_0x47db2c;_0x5ebfe1[_0xb2e91e(0x239)]==_0x5d8b73['product_name']&&_0x5ebfe1[_0xb2e91e(0x1de)]==_0x5d8b73[_0xb2e91e(0x1de)]&&_0x5ebfe1[_0xb2e91e(0x19c)]==_0x5d8b73[_0xb2e91e(0x19c)]&&_0x5ebfe1[_0xb2e91e(0x21c)]==_0x5d8b73['bin']&&_0x5ebfe1[_0xb2e91e(0x164)]==_0x5d8b73[_0xb2e91e(0x164)]&&_0x5ebfe1['rack']==_0x5d8b73['rack']&&_0x5ebfe1['storage']==_0x5d8b73[_0xb2e91e(0x152)]&&(_0x5ebfe1[_0xb2e91e(0x214)]=parseInt(_0x5ebfe1[_0xb2e91e(0x214)])+parseInt(_0x5d8b73[_0xb2e91e(0x237)]),_0x522ab7++);});_0x522ab7=='0'&&(_0x2f2da4[_0x47db2c(0x1c6)]=_0x2f2da4[_0x47db2c(0x1c6)][_0x47db2c(0x255)]({'product_name':_0x5d8b73[_0x47db2c(0x239)],'product_stock':_0x5d8b73['quantity'],'primary_code':_0x5d8b73[_0x47db2c(0x1cb)],'secondary_code':_0x5d8b73['secondary_code'],'product_code':_0x5d8b73[_0x47db2c(0x175)],'storage':_0x5d8b73[_0x47db2c(0x152)],'rack':_0x5d8b73[_0x47db2c(0x14b)],'bay':_0x5d8b73[_0x47db2c(0x164)],'bin':_0x5d8b73['bin'],'type':_0x5d8b73[_0x47db2c(0x19c)],'floorlevel':_0x5d8b73[_0x47db2c(0x1de)],'maxProducts':_0x5d8b73[_0x47db2c(0x240)],'unit':_0x5d8b73[_0x47db2c(0x1bc)],'secondary_unit':_0x5d8b73[_0x47db2c(0x223)],'expiry_date':_0x5d8b73[_0x47db2c(0x242)]}));}),await _0x2f2da4[_0x211d13(0x176)]();const _0x5883b8=await s_payment_data[_0x211d13(0x19a)]({'invoice':_0x1f7f94['body']['invoice']});if(_0x5883b8===null){}else console['log'](_0x211d13(0x233),_0x5883b8,_0x1f7f94['body']['invoice']),_0x5883b8[_0x211d13(0x233)]=_0x1f7f94[_0x211d13(0x162)][_0x211d13(0x233)],await _0x5883b8[_0x211d13(0x176)]();_0x1f7f94['flash'](_0x211d13(0x179),'purchase\x20data\x20update\x20successfully'),_0x165f01[_0x211d13(0x17f)](_0x211d13(0x203));}catch(_0x2f673d){console['log'](_0x2f673d);}}),router[a0_0x5bff47(0x1e9)](a0_0x5bff47(0x18c),auth,async(_0x237e6b,_0xde47d0)=>{var _0x2ba9fa=a0_0x5bff47;try{const _0x1aa381=_0x237e6b[_0x2ba9fa(0x1d8)]['id'],{invoice:_0x46cb9b,suppliers:_0x10156f,payable:_0x3b54a0,due_amount:_0x24d8df}=_0x237e6b[_0x2ba9fa(0x162)],_0xabd62f=await purchases[_0x2ba9fa(0x1c5)](_0x1aa381);var _0x333cff=_0x3b54a0-_0x24d8df;_0xabd62f[_0x2ba9fa(0x208)]=parseFloat(_0xabd62f['paid_amount'])+parseFloat(_0x24d8df),_0xabd62f[_0x2ba9fa(0x253)]=_0x333cff;const _0x16a399=await _0xabd62f['save']();console[_0x2ba9fa(0x212)](_0x16a399);const _0x5f2a73=await s_payment_data[_0x2ba9fa(0x19a)]({'invoice':_0x46cb9b});_0x5f2a73['amount']=_0x333cff,await _0x5f2a73[_0x2ba9fa(0x176)]();let _0x125ef7=new Date(),_0x2b139d=('0'+_0x125ef7[_0x2ba9fa(0x1a8)]())[_0x2ba9fa(0x153)](-0x2),_0x52ae3a=('0'+(_0x125ef7[_0x2ba9fa(0x256)]()+0x1))[_0x2ba9fa(0x153)](-0x2),_0x2dbb0=_0x125ef7[_0x2ba9fa(0x24a)](),_0x593028=_0x2dbb0+'-'+_0x52ae3a+'-'+_0x2b139d;const _0x3e04bc=new suppliers_payment({'invoice':_0x46cb9b,'date':_0x2dbb0+'-'+_0x52ae3a+'-'+_0x2b139d,'suppliers':_0x10156f,'reason':_0x2ba9fa(0x1c4),'amount':_0x24d8df}),_0x20927b=await _0x3e04bc['save']();_0x237e6b[_0x2ba9fa(0x1f6)]('success',_0x2ba9fa(0x23b)),_0xde47d0[_0x2ba9fa(0x17f)](_0x2ba9fa(0x203));}catch(_0x1d2d1e){console['log'](_0x1d2d1e);}}),router[a0_0x5bff47(0x250)](a0_0x5bff47(0x1ed),auth,async(_0x394001,_0x9a3fb3)=>{var _0x2f5feb=a0_0x5bff47;try{const {username:_0x4370f0,email:_0x2e6944,role:_0x5b0035}=_0x394001[_0x2f5feb(0x189)],_0x26d025=_0x394001['user'],_0x570722=await profile[_0x2f5feb(0x19a)]({'email':_0x26d025[_0x2f5feb(0x199)]}),_0x280705=await master_shop[_0x2f5feb(0x222)]();console['log'](_0x2f5feb(0x23a),_0x280705);const _0x553ab6=_0x394001['params']['id'],_0x2fde52=await purchases['findById'](_0x553ab6);console[_0x2f5feb(0x212)](_0x2fde52);const _0x233c92=await suppliers['findOne']({'name':_0x2fde52[_0x2f5feb(0x233)]});console[_0x2f5feb(0x212)](_0x233c92);if(_0x280705[0x0][_0x2f5feb(0x1ab)]==_0x2f5feb(0x174)){var _0x2d8819=users[_0x2f5feb(0x1a7)];console[_0x2f5feb(0x212)](_0x2d8819);}else{if(_0x280705[0x0][_0x2f5feb(0x1ab)]=='Hindi')var _0x2d8819=users['Hindi'];else{if(_0x280705[0x0][_0x2f5feb(0x1ab)]==_0x2f5feb(0x1c3))var _0x2d8819=users['German'];else{if(_0x280705[0x0][_0x2f5feb(0x1ab)]=='Spanish')var _0x2d8819=users[_0x2f5feb(0x22e)];else{if(_0x280705[0x0][_0x2f5feb(0x1ab)]==_0x2f5feb(0x200))var _0x2d8819=users[_0x2f5feb(0x200)];else{if(_0x280705[0x0][_0x2f5feb(0x1ab)]==_0x2f5feb(0x25b))var _0x2d8819=users[_0x2f5feb(0x16a)];else{if(_0x280705[0x0][_0x2f5feb(0x1ab)]==_0x2f5feb(0x1b4))var _0x2d8819=users['Chinese'];else{if(_0x280705[0x0]['language']==_0x2f5feb(0x205))var _0x2d8819=users['Arabic'];}}}}}}}_0x9a3fb3[_0x2f5feb(0x1e5)]('purchase_invoice',{'success':_0x394001['flash'](_0x2f5feb(0x179)),'errors':_0x394001[_0x2f5feb(0x1f6)](_0x2f5feb(0x17a)),'role':_0x26d025,'profile':_0x570722,'master_shop':_0x280705,'supplier':_0x233c92,'purchase':_0x2fde52,'language':_0x2d8819});}catch(_0x3ca953){console[_0x2f5feb(0x212)](_0x3ca953);}}),router[a0_0x5bff47(0x250)]('/view/return_purchase/:id',auth,async(_0x32bf55,_0x2b81ce)=>{var _0x43ac83=a0_0x5bff47;try{const {username:_0x51bfa2,email:_0x34c23b,role:_0x395ba5}=_0x32bf55[_0x43ac83(0x189)],_0x4c80d9=_0x32bf55[_0x43ac83(0x189)],_0x1fff1b=await profile[_0x43ac83(0x19a)]({'email':_0x4c80d9[_0x43ac83(0x199)]}),_0x1f1b97=await master_shop[_0x43ac83(0x222)]();console[_0x43ac83(0x212)]('master',_0x1f1b97);const _0x5c799b=_0x32bf55['params']['id'];console['log'](_0x5c799b);const _0x8b5977=await purchases['findById'](_0x5c799b);console[_0x43ac83(0x212)](_0x43ac83(0x20b),_0x8b5977);const _0x1e709a=await product[_0x43ac83(0x222)]({}),_0x1e0128=await warehouse[_0x43ac83(0x1a1)]([{'$match':{'name':_0x8b5977[_0x43ac83(0x1da)],'room':_0x8b5977[_0x43ac83(0x1b5)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x43ac83(0x257)},{'$group':{'_id':_0x43ac83(0x20c),'name':{'$first':_0x43ac83(0x229)},'product_stock':{'$first':_0x43ac83(0x151)},'bay':{'$first':_0x43ac83(0x170)},'bin':{'$first':_0x43ac83(0x1f1)},'type':{'$first':_0x43ac83(0x22a)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x43ac83(0x1ba)},'secondary_code':{'$first':_0x43ac83(0x186)},'product_code':{'$first':_0x43ac83(0x15a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x43ac83(0x1a1)]([{'$match':{'status':_0x43ac83(0x259),'name':_0x43ac83(0x1cf),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x43ac83(0x245),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x43ac83(0x212)]('stock_data',_0x1e0128);if(_0x1f1b97[0x0]['language']=='English\x20(US)'){var _0x39c97b=users[_0x43ac83(0x1a7)];console[_0x43ac83(0x212)](_0x39c97b);}else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]==_0x43ac83(0x21f))var _0x39c97b=users['Hindi'];else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]==_0x43ac83(0x1c3))var _0x39c97b=users['German'];else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]=='Spanish')var _0x39c97b=users[_0x43ac83(0x22e)];else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]==_0x43ac83(0x200))var _0x39c97b=users[_0x43ac83(0x200)];else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]==_0x43ac83(0x25b))var _0x39c97b=users[_0x43ac83(0x16a)];else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]=='Chinese')var _0x39c97b=users[_0x43ac83(0x1b4)];else{if(_0x1f1b97[0x0][_0x43ac83(0x1ab)]=='Arabic\x20(ae)')var _0x39c97b=users[_0x43ac83(0x168)];}}}}}}}_0x2b81ce[_0x43ac83(0x1e5)](_0x43ac83(0x183),{'success':_0x32bf55[_0x43ac83(0x1f6)](_0x43ac83(0x179)),'errors':_0x32bf55[_0x43ac83(0x1f6)](_0x43ac83(0x17a)),'role':_0x4c80d9,'profile':_0x1fff1b,'user':_0x8b5977,'stock':_0x1e0128,'master_shop':_0x1f1b97,'product':_0x1e709a,'language':_0x39c97b,'warehouse':warehouse_data});}catch(_0x1ffda8){console[_0x43ac83(0x212)](_0x1ffda8);}}),router[a0_0x5bff47(0x1e9)]('/view/return_purchase/:id',auth,async(_0x51c5fa,_0xabcd57)=>{var _0x58fdce=a0_0x5bff47;try{const {invoice:_0x174a12,date:_0x5ab80f,warehouse_name:_0x787abe,Room_name:_0x48528b,product_name:_0x541177,purchase_quantity:_0x7489d9,stocks:_0xa50d4,return_qty:_0x2088cf,note:_0x1b1adf,level:_0x3ec4b2,isle:_0x122ffd,pallet:_0x1eb41e,to_warehouse_name:_0x36bb49,to_Room_name:_0x355945}=_0x51c5fa[_0x58fdce(0x162)],_0x51ea20=await purchases[_0x58fdce(0x19a)]({'_id':_0x51c5fa['params']['id']}),_0x12c64b=await warehouse[_0x58fdce(0x19a)]({'name':_0x787abe,'room':_0x48528b});if(typeof _0x541177==_0x58fdce(0x161))var _0x4b349c=[_0x51c5fa[_0x58fdce(0x162)]['product_name']],_0x1c0882=[_0x51c5fa[_0x58fdce(0x162)]['purchase_quantity']],_0x41776a=[_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x210)]],_0x3a48b6=[_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x182)]],_0x96467b=[_0x51c5fa['body']['level']],_0x27648c=[_0x51c5fa[_0x58fdce(0x162)]['isle']],_0x5383fa=[_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x181)]],_0x4f192d=[_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x227)]],_0x27460c=[_0x51c5fa['body'][_0x58fdce(0x21b)]],_0x4a9df7=[_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x157)]],_0x344b49=[_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x15c)]];else var _0x4b349c=[..._0x51c5fa['body'][_0x58fdce(0x239)]],_0x1c0882=[..._0x51c5fa['body'][_0x58fdce(0x1b2)]],_0x41776a=[..._0x51c5fa[_0x58fdce(0x162)]['stocks']],_0x3a48b6=[..._0x51c5fa[_0x58fdce(0x162)]['return_qty']],_0x96467b=[..._0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x1ee)]],_0x27648c=[..._0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x14f)]],_0x5383fa=[..._0x51c5fa[_0x58fdce(0x162)]['pallet']],_0x4f192d=[..._0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x227)]],_0x27460c=[..._0x51c5fa['body']['product_code_hide']],_0x4a9df7=[..._0x51c5fa['body'][_0x58fdce(0x157)]],_0x344b49=[..._0x51c5fa['body'][_0x58fdce(0x15c)]];const _0x5a6eb3=_0x4b349c[_0x58fdce(0x24e)](_0x19782c=>{return _0x19782c={'product_name':_0x19782c};});_0x1c0882[_0x58fdce(0x1c7)]((_0x4e2722,_0x47871d)=>{_0x5a6eb3[_0x47871d]['purchase_quantity']=_0x4e2722;}),_0x41776a[_0x58fdce(0x1c7)]((_0xe26873,_0x1860f9)=>{var _0x32830b=_0x58fdce;_0x5a6eb3[_0x1860f9][_0x32830b(0x17e)]=_0xe26873;}),_0x3a48b6[_0x58fdce(0x1c7)]((_0x2d599e,_0x2f92c5)=>{var _0x22f002=_0x58fdce;_0x5a6eb3[_0x2f92c5][_0x22f002(0x182)]=_0x2d599e;}),_0x96467b['forEach']((_0x190f2d,_0x329071)=>{var _0x5f0d6c=_0x58fdce;_0x5a6eb3[_0x329071][_0x5f0d6c(0x164)]=_0x190f2d;}),_0x27648c[_0x58fdce(0x1c7)]((_0xcafea,_0x493c01)=>{var _0x508695=_0x58fdce;_0x5a6eb3[_0x493c01][_0x508695(0x21c)]=_0xcafea;}),_0x5383fa[_0x58fdce(0x1c7)]((_0x32ecfb,_0x4f21d0)=>{_0x5a6eb3[_0x4f21d0]['floorlevel']=_0x32ecfb;}),_0x4f192d[_0x58fdce(0x1c7)]((_0x56114b,_0x4ebfa0)=>{var _0x2fd007=_0x58fdce;_0x5a6eb3[_0x4ebfa0][_0x2fd007(0x19c)]=_0x56114b;}),_0x27460c[_0x58fdce(0x1c7)]((_0xd16977,_0x2272db)=>{var _0xc2b00f=_0x58fdce;_0x5a6eb3[_0x2272db][_0xc2b00f(0x175)]=_0xd16977;}),_0x4a9df7['forEach']((_0x575eeb,_0x1855f0)=>{_0x5a6eb3[_0x1855f0]['primary_code']=_0x575eeb;}),_0x344b49[_0x58fdce(0x1c7)]((_0x36fa91,_0x3b7793)=>{var _0xc665e8=_0x58fdce;_0x5a6eb3[_0x3b7793][_0xc665e8(0x24b)]=_0x36fa91;}),_0x51ea20[_0x58fdce(0x238)]['forEach'](_0x579075=>{var _0x3a7bed=_0x58fdce;const _0x4b0b25=_0x12c64b[_0x3a7bed(0x1c6)][_0x3a7bed(0x24e)](_0x46e897=>{var _0x3f8ca6=_0x3a7bed;_0x46e897[_0x3f8ca6(0x239)]==_0x579075[_0x3f8ca6(0x239)]&&_0x46e897[_0x3f8ca6(0x1de)]==_0x579075['floorlevel']&&_0x46e897[_0x3f8ca6(0x19c)]==_0x579075[_0x3f8ca6(0x19c)]&&_0x46e897[_0x3f8ca6(0x21c)]==_0x579075['bin']&&_0x46e897[_0x3f8ca6(0x164)]==_0x579075[_0x3f8ca6(0x164)]&&_0x46e897['rack']==_0x579075['rack']&&_0x46e897['storage']==_0x579075['storage']&&(console[_0x3f8ca6(0x212)](parseInt(_0x46e897[_0x3f8ca6(0x214)])+_0x3f8ca6(0x1a9)+parseInt(_0x579075['quantity'])),_0x46e897[_0x3f8ca6(0x214)]=parseInt(_0x46e897['product_stock'])+parseInt(_0x579075[_0x3f8ca6(0x237)]));});}),await _0x12c64b[_0x58fdce(0x176)]();const _0x3a8989=_0x5a6eb3[_0x58fdce(0x194)](_0x44d192=>_0x44d192[_0x58fdce(0x182)]!=='0'&&_0x44d192['return_qty']!=='');var _0x1a5fda=0x0;_0x3a8989[_0x58fdce(0x1c7)](_0x14df03=>{var _0x4048b4=_0x58fdce;console[_0x4048b4(0x212)](_0x4048b4(0x169),_0x14df03),(parseInt(_0x14df03[_0x4048b4(0x1b2)])<parseInt(_0x14df03[_0x4048b4(0x182)])||parseInt(_0x14df03[_0x4048b4(0x17e)])<parseInt(_0x14df03[_0x4048b4(0x182)]))&&_0x1a5fda++;});if(_0x1a5fda!=0x0)return _0x51c5fa[_0x58fdce(0x1f6)](_0x58fdce(0x17a),_0x58fdce(0x221)),_0xabcd57[_0x58fdce(0x17f)](_0x58fdce(0x1d6));const _0x34f8a3=new purchases_return({'invoice':_0x174a12,'suppliers':_0x51c5fa['body'][_0x58fdce(0x233)],'date':_0x5ab80f,'warehouse_name':_0x787abe,'return_product':_0x3a8989,'note':_0x1b1adf,'room':_0x48528b,'to_warehouse_name':_0x36bb49,'to_room':_0x355945}),_0x560124=await _0x34f8a3[_0x58fdce(0x176)]();console[_0x58fdce(0x212)](_0x34f8a3);const _0x28d1de=await purchases_return[_0x58fdce(0x19a)]({'invoice':_0x174a12}),_0x2cc1ac=await warehouse[_0x58fdce(0x19a)]({'name':_0x36bb49,'room':_0x355945});_0x28d1de[_0x58fdce(0x23e)][_0x58fdce(0x1c7)](_0x14ee91=>{var _0x422754=_0x58fdce,_0x57ce4e=0x0;const _0x105c13=_0x2cc1ac[_0x422754(0x1c6)][_0x422754(0x24e)](_0x640aee=>{var _0x1de686=_0x422754;_0x640aee[_0x1de686(0x239)]==_0x14ee91[_0x1de686(0x239)]&&_0x640aee[_0x1de686(0x1de)]==_0x14ee91[_0x1de686(0x1de)]&&_0x640aee['type']==_0x14ee91[_0x1de686(0x19c)]&&_0x640aee[_0x1de686(0x21c)]==_0x14ee91[_0x1de686(0x21c)]&&_0x640aee[_0x1de686(0x164)]==_0x14ee91[_0x1de686(0x164)]&&(_0x640aee[_0x1de686(0x214)]=parseInt(_0x640aee[_0x1de686(0x214)])-parseInt(_0x14ee91[_0x1de686(0x182)]),_0x57ce4e++);});_0x57ce4e=='0'&&(_0x2cc1ac[_0x422754(0x1c6)]=_0x2cc1ac[_0x422754(0x1c6)][_0x422754(0x255)]({'product_name':_0x14ee91['product_name'],'product_stock':_0x14ee91[_0x422754(0x182)],'primary_code':_0x14ee91['primary_code'],'secondary_code':_0x14ee91[_0x422754(0x24b)],'product_code':_0x14ee91['product_code'],'storage':_0x14ee91[_0x422754(0x152)],'rack':_0x14ee91['rack'],'bay':_0x14ee91[_0x422754(0x164)],'bin':_0x14ee91['bin'],'type':_0x14ee91['type'],'floorlevel':_0x14ee91[_0x422754(0x1de)],'maxProducts':_0x14ee91[_0x422754(0x240)],'unit':_0x14ee91[_0x422754(0x1bc)],'secondary_unit':_0x14ee91['secondary_unit'],'expiry_date':_0x14ee91[_0x422754(0x242)]}));}),await _0x2cc1ac[_0x58fdce(0x176)]();const _0x201d29=await purchases[_0x58fdce(0x19a)]({'invoice':_0x174a12});_0x201d29[_0x58fdce(0x160)]=_0x58fdce(0x1be);const _0x482eb0=await _0x201d29['save'](),_0x3e3885=new s_payment_data({'invoice':_0x174a12,'suppliers':_0x51c5fa[_0x58fdce(0x162)]['suppliers'],'reason':_0x58fdce(0x1d3)});await _0x3e3885[_0x58fdce(0x176)]();const _0x4a07f8=await master_shop['find']();console[_0x58fdce(0x212)](_0x58fdce(0x1d2),_0x4a07f8[0x0]['image']);const _0x327f33=await email_settings['findOne'](),_0x395cb7=await suppliers['findOne']({'name':_0x51c5fa[_0x58fdce(0x162)][_0x58fdce(0x233)]});console[_0x58fdce(0x212)]('suppliers_data',_0x395cb7);_0x4a07f8[0x0]['currency_placement']==0x1?(right_currency=_0x4a07f8[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4a07f8[0x0]['currency']);var _0x1a5708=_0x4b349c,_0xc1cca1=_0x3a48b6,_0x173419='',_0x4da4de;for(_0x4da4de in _0x1a5708){_0x173419+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1a5708[_0x4da4de]+_0x58fdce(0x178)+_0x58fdce(0x1e1)+_0xc1cca1[_0x4da4de]+_0x58fdce(0x178)+_0x58fdce(0x150);}console[_0x58fdce(0x212)]('product_list',_0x173419);let _0xfbe1b2=nodemailer[_0x58fdce(0x1b1)]({'service':'gmail','auth':{'user':_0x327f33[_0x58fdce(0x199)],'pass':_0x327f33[_0x58fdce(0x1f2)]}}),_0x5d5436={'from':_0x327f33['email'],'to':_0x395cb7[_0x58fdce(0x199)],'subject':_0x58fdce(0x225),'attachments':[{'filename':_0x58fdce(0x22b),'path':__dirname+_0x58fdce(0x1dd)+_0x58fdce(0x1fa)+_0x4a07f8[0x0]['image'],'cid':_0x58fdce(0x1ef)}],'html':_0x58fdce(0x1fb)+_0x58fdce(0x1d0)+_0x58fdce(0x24d)+_0x58fdce(0x1bb)+_0x58fdce(0x25a)+_0x58fdce(0x1bb)+_0x58fdce(0x158)+_0x58fdce(0x19e)+_0x58fdce(0x1bb)+_0x58fdce(0x16c)+_0x4a07f8[0x0][_0x58fdce(0x1b7)]+'\x20</h2>'+_0x58fdce(0x19e)+_0x58fdce(0x19e)+_0x58fdce(0x1a2)+_0x58fdce(0x1bb)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x58fdce(0x207)+_0x174a12+'\x20'+_0x58fdce(0x1c0)+_0x58fdce(0x1d9)+_0x5ab80f+'\x20'+'</span>'+_0x58fdce(0x25c)+_0x58fdce(0x19e)+_0x58fdce(0x167)+_0x58fdce(0x16f)+_0x58fdce(0x206)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x58fdce(0x1fc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x58fdce(0x150)+_0x58fdce(0x252)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x173419+'\x20'+'</tbody>'+_0x58fdce(0x20a)+_0x58fdce(0x1bb)+_0x58fdce(0x15e)+_0x58fdce(0x24f)+_0x4a07f8[0x0][_0x58fdce(0x1b7)]+_0x58fdce(0x25c)+'</div>'+_0x58fdce(0x19e)+_0x58fdce(0x224)};_0xfbe1b2['sendMail'](_0x5d5436,function(_0x59a65d,_0x2c9958){var _0x3e4c96=_0x58fdce;_0x59a65d?(console[_0x3e4c96(0x212)](_0x59a65d),console[_0x3e4c96(0x212)](_0x3e4c96(0x18a))):console[_0x3e4c96(0x212)](_0x3e4c96(0x20e));}),_0x51c5fa[_0x58fdce(0x1f6)](_0x58fdce(0x179),_0x58fdce(0x1e0)),_0xabcd57[_0x58fdce(0x17f)](_0x58fdce(0x203));}catch(_0x1214b8){console[_0x58fdce(0x212)](_0x1214b8),_0xabcd57[_0x58fdce(0x1c9)](0xc8)[_0x58fdce(0x188)]({'message':_0x1214b8['message']});}}),router[a0_0x5bff47(0x250)](a0_0x5bff47(0x228),auth,async(_0x1e0ca0,_0x13e171)=>{var _0x3be373=a0_0x5bff47;try{const {username:_0x5376a4,email:_0x318aa6,role:_0x3caec8}=_0x1e0ca0['user'],_0xbb5c2c=_0x1e0ca0[_0x3be373(0x189)],_0x565355=await profile[_0x3be373(0x19a)]({'email':_0xbb5c2c[_0x3be373(0x199)]}),_0x5afe0f=await master_shop['find'](),_0x368c84=_0x1e0ca0[_0x3be373(0x1d8)]['id'],_0x8bd519=await purchases['findById'](_0x368c84);if(_0x5afe0f[0x0][_0x3be373(0x1ab)]==_0x3be373(0x174))var _0x2cd0c7=users[_0x3be373(0x1a7)];else{if(_0x5afe0f[0x0][_0x3be373(0x1ab)]==_0x3be373(0x21f))var _0x2cd0c7=users[_0x3be373(0x21f)];else{if(_0x5afe0f[0x0]['language']=='German')var _0x2cd0c7=users[_0x3be373(0x1c3)];else{if(_0x5afe0f[0x0][_0x3be373(0x1ab)]=='Spanish')var _0x2cd0c7=users[_0x3be373(0x22e)];else{if(_0x5afe0f[0x0][_0x3be373(0x1ab)]==_0x3be373(0x200))var _0x2cd0c7=users['French'];else{if(_0x5afe0f[0x0][_0x3be373(0x1ab)]==_0x3be373(0x25b))var _0x2cd0c7=users[_0x3be373(0x16a)];else{if(_0x5afe0f[0x0]['language']==_0x3be373(0x1b4))var _0x2cd0c7=users[_0x3be373(0x1b4)];else{if(_0x5afe0f[0x0]['language']==_0x3be373(0x205))var _0x2cd0c7=users[_0x3be373(0x168)];}}}}}}}_0x13e171[_0x3be373(0x1e5)]('all_purchases_barcode',{'success':_0x1e0ca0[_0x3be373(0x1f6)](_0x3be373(0x179)),'errors':_0x1e0ca0[_0x3be373(0x1f6)]('errors'),'role':_0xbb5c2c,'profile':_0x565355,'alldata':_0x8bd519,'master_shop':_0x5afe0f,'language':_0x2cd0c7}),console['log'](alldata);}catch(_0x2601ea){console[_0x3be373(0x212)](_0x2601ea);}}),router[a0_0x5bff47(0x1e9)](a0_0x5bff47(0x1dc),async(_0x13884f,_0x1d7a56)=>{var _0x3e6047=a0_0x5bff47;const {product_code:_0x7d90f8}=_0x13884f[_0x3e6047(0x162)];var _0xde407c;const _0x22e170=await product[_0x3e6047(0x1a1)]([{'$match':{'primary_code':_0x7d90f8,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3e6047(0x1af),'name':{'$first':_0x3e6047(0x245)},'category':{'$first':'$category'},'brand':{'$first':_0x3e6047(0x163)},'unit':{'$first':_0x3e6047(0x21a)},'alertquantity':{'$first':_0x3e6047(0x1e2)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x3e6047(0x171)},'secondary_code':{'$first':_0x3e6047(0x1e7)},'maxStocks':{'$first':_0x3e6047(0x19f)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3e6047(0x1ac)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x432b6c=await product[_0x3e6047(0x1a1)]([{'$match':{'secondary_code':_0x7d90f8,'product_category':_0x3e6047(0x243)}},{'$group':{'_id':'$_id','name':{'$first':_0x3e6047(0x245)},'category':{'$first':_0x3e6047(0x230)},'brand':{'$first':_0x3e6047(0x163)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x3e6047(0x1e2)},'product_code':{'$first':_0x3e6047(0x1d7)},'primary_code':{'$first':_0x3e6047(0x171)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3e6047(0x19f)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3e6047(0x1ac)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x22e170[_0x3e6047(0x1ce)]>0x0)_0xde407c=_0x22e170;else _0x432b6c[_0x3e6047(0x1ce)]>0x0&&(_0xde407c=_0x432b6c);_0x1d7a56[_0x3e6047(0x188)](_0xde407c);}),router[a0_0x5bff47(0x1e9)]('/CheckingWarehouse',async(_0x3602ad,_0x50fa3f)=>{var _0x1a7b80=a0_0x5bff47;const {primaryCode:_0x49e7df,secondaryCode:_0x214a7c,productCode:_0x3abb48,bay:_0x36f905,bin:_0x16c459,types:_0x119874,pallet:_0x418a26,warehouses:_0x475886,room:_0x37d77c}=_0x3602ad[_0x1a7b80(0x162)];console[_0x1a7b80(0x212)](_0x3602ad[_0x1a7b80(0x162)]);try{const _0x2aa931=await warehouse['aggregate']([{'$match':{'name':_0x475886,'room':_0x37d77c}},{'$unwind':_0x1a7b80(0x257)},{'$match':{'product_details.bay':_0x36f905,'product_details.bin':_0x16c459,'product_details.type':_0x119874}},{'$group':{'_id':_0x1a7b80(0x20c),'name':{'$first':_0x1a7b80(0x229)},'product_stock':{'$first':_0x1a7b80(0x151)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x50fa3f[_0x1a7b80(0x1c9)](0xc8)[_0x1a7b80(0x188)](_0x2aa931);}catch(_0x2abf56){_0x50fa3f['status'](0x194)[_0x1a7b80(0x188)]({'message':_0x2abf56[_0x1a7b80(0x1d5)]});}}),module['exports']=router;