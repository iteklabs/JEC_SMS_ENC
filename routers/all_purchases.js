function a0_0x1761(){var _0x3a5b03=['$brand','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','rak','note','room_name','secondary_code','/all_purchases/view','$product_details.bay','<strong>\x20Regards\x20</strong>','stock_quantity','Room_name','getDate','French','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','floorlevel','$product_details.product_stock','65692272PSwMBp','Receiving\x20Area','Purchase\x20data\x20added\x20successfully','$due_amount','$return_data','params','getFullYear','warehouse','56474oyvGwx','English','$product.type','catch','$product_details','prod_isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','log','maxStocks','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','An\x20error\x20occurred\x20while\x20saving\x20data.','prod_primunit','$note','filter','concat','floor','expiry_date','/barcode_scanner','$product_details.expiry_date','<html><head><title></title>','body','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','MaxStocks_data','product_name','stock_data','$product_details.floorlevel','product_code','staff','rack','Purchase\x20Mail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','level','logo','$product_details.primary_code','name','$maxProdPerUnit','DRY\x20STORAGE','password','True','Sales\x20Update\x20successfully','$product.floorlevel','due_amount','paid_amount','suppliers','length','$product_details.storage','prod_unit','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<hr\x20class=\x22my-3\x22>','product_details','../models/all_models','finalize','invoice','prod_qty','Portuguese','$date','actual_uom','</div>','post','$invoice','$finalize','here','prod_Qty','<!DOCTYPE\x20html>','all','image','Purchase\x20Return','Rack\x20B','$expiry_date','json','status','Paid\x20For\x20Purchase','quantity','secondary_code_hide','4633175QOrEYg','Ambient','random','all_purchases','/invoice/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','Logo.png','INC-','forEach','</tr>','$warehouse_name','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_code_hide','$product','Arabic','product_cat','English\x20(US)','Chinese','</head><body>','prod_code','<h5\x20style=\x22text-align:\x20left;\x22>','Rack\x20C','aggregate','Floor','batch_code','$product.quantity','redirect','payment\x20successfull','\x20<\x20wew\x20>\x20','$product_details.secondary_code','render','48582OXBjcX','$product_details.level','/give_payment/:id','</table>','</h5>','port','$product_details.rack','email','warehouse_name','RMSEmail','standard_unit','$category','success','master','156SxAatT','back','getMonth','/all_purchases/view/','padStart','/preview/:id','flash','$unit','</tbody>','bay','$product.bay','nodemailer','/upload/','Rack\x20E','29gkyJAG','$product_details.product_name','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$suppliers_docs','room','date','$room','storage','$product_details.type','COLD\x20STORAGE','$secondary_code','/view/return_purchase/:id','add_purchases\x20error','errors','return_qty','prod_cat','prod_invoice','edit_purchases_view','site_title','language','JO_number','Return\x20Goods','\x20</h2>','11891SAklLx','product_list','primary_code_hide','currency','11860WnorcC','save','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Raw\x20Materials','types','edit_purchases','/CheckingWarehouse','../public/language/languages.json','$batch_code','actual_qty','slice','Hindi','$secondary_unit','pallet','purchase\x20data\x20update\x20successfully','suppliers_docs','delivery_code','ejs','<div>','<h2>\x20','/view','stocks','RoomAssign','Rack\x20A','$product_code','get','Spanish','prod_level','1342551MHgfuS','exports','toString','user','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/:id','findById','/view/add_purchases','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','purchases\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','6GTUWtf','\x20Order\x20Number\x20:\x20','/../public','Email\x20sent\x20successfully','message','prod_pallet','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Arabic\x20(ae)','Shelves','$_id','Rack\x20D','suppliers_data','\x20Order\x20Date\x20:\x20','secondary_unit','$product.bin','prod_name','</td>','role','$product_details.isle','../middleware/auth','return_purchase','Level','delivery_date','20187zxuCeE','max_product_unit','$product_details.maxProducts','Purchase\x20Return\x20Mail','$paid_amount','abs','type','Enabled','map','Enclosed','primary_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$name','return_data','isle','<tr>','$product_details._id','table\x20page','purchase_quantity','bin','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','add\x20post','alertQTY','product','\x20<>\x20','then','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.pallet','4136xFeIyX','production_date','POnumber','error','string','Error\x20Occurs','path','express'];a0_0x1761=function(){return _0x3a5b03;};return a0_0x1761();}var a0_0x1d9df1=a0_0x547c;(function(_0x19c1f8,_0x1820e1){var _0x5e9fd9=a0_0x547c,_0x9929d1=_0x19c1f8();while(!![]){try{var _0x509eb6=-parseInt(_0x5e9fd9(0x184))/0x1*(parseInt(_0x5e9fd9(0xfc))/0x2)+-parseInt(_0x5e9fd9(0x168))/0x3*(parseInt(_0x5e9fd9(0x176))/0x4)+parseInt(_0x5e9fd9(0x148))/0x5*(-parseInt(_0x5e9fd9(0xa7))/0x6)+parseInt(_0x5e9fd9(0x9b))/0x7+parseInt(_0x5e9fd9(0xdb))/0x8*(-parseInt(_0x5e9fd9(0xbe))/0x9)+-parseInt(_0x5e9fd9(0x7e))/0xa*(parseInt(_0x5e9fd9(0x7a))/0xb)+parseInt(_0x5e9fd9(0xf4))/0xc;if(_0x509eb6===_0x1820e1)break;else _0x9929d1['push'](_0x9929d1['shift']());}catch(_0x38ec1d){_0x9929d1['push'](_0x9929d1['shift']());}}}(a0_0x1761,0xcee12));const express=require(a0_0x1d9df1(0xe2)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1d9df1(0x130)),auth=require(a0_0x1d9df1(0xba)),nodemailer=require(a0_0x1d9df1(0x181));var ejs=require(a0_0x1d9df1(0x90));const path=require(a0_0x1d9df1(0xe1)),users=require(a0_0x1d9df1(0x86));router[a0_0x1d9df1(0x98)](a0_0x1d9df1(0x93),auth,async(_0x47b0b5,_0x2cd057)=>{var _0x3da06f=a0_0x1d9df1;try{const {username:_0x1d587e,email:_0x549e45,role:_0x112bc8}=_0x47b0b5['user'],_0x6c1d67=_0x47b0b5[_0x3da06f(0x9e)],_0x5b4876=await profile[_0x3da06f(0x12c)]({'email':_0x6c1d67['email']}),_0x4965ef=await staff[_0x3da06f(0x12c)]({'email':_0x6c1d67[_0x3da06f(0x16f)]});if(_0x6c1d67[_0x3da06f(0xb8)]==_0x3da06f(0x118)){const _0xc54203=await staff[_0x3da06f(0x12c)]({'email':_0x6c1d67[_0x3da06f(0x16f)]});}const _0x4b4863=await master_shop[_0x3da06f(0x80)]();let _0x4d5950;if(_0x6c1d67[_0x3da06f(0xb8)]=='staff'){const _0x50446d=await staff[_0x3da06f(0x12c)]({'email':_0x6c1d67[_0x3da06f(0x16f)]});_0x4d5950=await purchases[_0x3da06f(0x15f)]([{'$match':{'warehouse_name':_0x50446d[_0x3da06f(0xfb)]}},{'$lookup':{'from':_0x3da06f(0x128),'localField':_0x3da06f(0x128),'foreignField':_0x3da06f(0x11f),'as':_0x3da06f(0x8e)}},{'$unwind':_0x3da06f(0x188)},{'$unwind':_0x3da06f(0x156)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3da06f(0x139)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3da06f(0x135)},'warehouse_name':{'$first':_0x3da06f(0x152)},'room':{'$first':_0x3da06f(0x69)},'product':{'$push':'$product'},'note':{'$first':_0x3da06f(0x108)},'paid_amount':{'$first':_0x3da06f(0xc2)},'due_amount':{'$first':_0x3da06f(0xf7)},'return_data':{'$first':_0x3da06f(0xf8)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x3da06f(0x142)},'suppliers_docs':{'$first':_0x3da06f(0x188)},'total_product_quantity':{'$sum':_0x3da06f(0x162)},'level':{'$addToSet':_0x3da06f(0x180)},'isle':{'$addToSet':_0x3da06f(0xb5)},'type':{'$addToSet':_0x3da06f(0xfe)},'floorlevel':{'$addToSet':_0x3da06f(0x125)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4d5950=await purchases[_0x3da06f(0x15f)]([{'$lookup':{'from':'suppliers','localField':_0x3da06f(0x128),'foreignField':_0x3da06f(0x11f),'as':'suppliers_docs'}},{'$unwind':_0x3da06f(0x188)},{'$unwind':_0x3da06f(0x156)},{'$group':{'_id':_0x3da06f(0xb0),'invoice':{'$first':_0x3da06f(0x139)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3da06f(0x135)},'warehouse_name':{'$first':_0x3da06f(0x152)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3da06f(0x156)},'note':{'$first':_0x3da06f(0x108)},'paid_amount':{'$first':_0x3da06f(0xc2)},'due_amount':{'$first':_0x3da06f(0xf7)},'return_data':{'$first':_0x3da06f(0xf8)},'batch_code':{'$first':_0x3da06f(0x87)},'expiry_date':{'$first':_0x3da06f(0x142)},'suppliers_docs':{'$first':_0x3da06f(0x188)},'total_product_quantity':{'$sum':_0x3da06f(0x162)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3da06f(0xb5)},'type':{'$addToSet':_0x3da06f(0xfe)},'floorlevel':{'$addToSet':_0x3da06f(0x125)},'finalize':{'$first':_0x3da06f(0x13a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x4b4863[0x0][_0x3da06f(0x76)]=='English\x20(US)'){var _0x123641=users[_0x3da06f(0xfd)];console['log'](_0x123641);}else{if(_0x4b4863[0x0][_0x3da06f(0x76)]==_0x3da06f(0x8a))var _0x123641=users[_0x3da06f(0x8a)];else{if(_0x4b4863[0x0][_0x3da06f(0x76)]=='German')var _0x123641=users['German'];else{if(_0x4b4863[0x0][_0x3da06f(0x76)]==_0x3da06f(0x99))var _0x123641=users[_0x3da06f(0x99)];else{if(_0x4b4863[0x0]['language']==_0x3da06f(0xef))var _0x123641=users[_0x3da06f(0xef)];else{if(_0x4b4863[0x0][_0x3da06f(0x76)]==_0x3da06f(0x186))var _0x123641=users[_0x3da06f(0x134)];else{if(_0x4b4863[0x0][_0x3da06f(0x76)]==_0x3da06f(0x15a))var _0x123641=users['Chinese'];else{if(_0x4b4863[0x0][_0x3da06f(0x76)]=='Arabic\x20(ae)')var _0x123641=users['Arabic'];}}}}}}}_0x2cd057[_0x3da06f(0x167)](_0x3da06f(0x14b),{'success':_0x47b0b5[_0x3da06f(0x17c)]('success'),'errors':_0x47b0b5[_0x3da06f(0x17c)]('errors'),'purchases':_0x4d5950,'role':_0x6c1d67,'profile':_0x5b4876,'master_shop':_0x4b4863,'language':_0x123641});}catch(_0x454a4c){console[_0x3da06f(0x103)](_0x3da06f(0xcf),_0x454a4c),_0x2cd057[_0x3da06f(0x144)](0xc8)[_0x3da06f(0x143)]({'message':_0x454a4c[_0x3da06f(0xab)]});}});function a0_0x547c(_0x68f7d1,_0x665fac){var _0x17611b=a0_0x1761();return a0_0x547c=function(_0x547c46,_0x4b73d1){_0x547c46=_0x547c46-0x67;var _0x213dc4=_0x17611b[_0x547c46];return _0x213dc4;},a0_0x547c(_0x68f7d1,_0x665fac);}function BayBinSelected(_0xcc2d3a,_0x27b065){var _0x236dbb=a0_0x1d9df1,_0x5ca3f5=[],_0x5394cb=[],_0x5c2b94=[],_0x2c0ee4=[],_0x549dee=[],_0x23dc15=[];let _0xebcfaa=[];if(_0xcc2d3a==_0x236dbb(0x121))switch(_0x27b065){case'Rack\x20A':_0x5ca3f5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5394cb=[0x1,0x2],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=['Level',_0x236dbb(0x160)],_0x549dee=['D'],_0x23dc15=['A'];break;case _0x236dbb(0x141):_0x5ca3f5=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5394cb=[0x1,0x2],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=[_0x236dbb(0xbc),_0x236dbb(0x160)],_0x549dee=['D'],_0x23dc15=['B'];break;case _0x236dbb(0xaf):_0x5ca3f5=[0x0],_0x5394cb=[0x0],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=['Floor'],_0x549dee=['D'],_0x23dc15=['S'];break;case'Receiving\x20Area':_0x5ca3f5=[0x0],_0x5394cb=[0x0],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5c2b94=[_0x236dbb(0x160)],_0x549dee=['D'],_0x23dc15=['R'];break;}else{if(_0xcc2d3a==_0x236dbb(0x6c))switch(_0x27b065){case _0x236dbb(0x96):_0x5ca3f5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5394cb=['B','F'],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=[_0x236dbb(0xbc),_0x236dbb(0x160)],_0x549dee=['C'],_0x23dc15=['A'];break;case _0x236dbb(0x141):_0x5ca3f5=[0x5,0x4,0x3,0x2,0x1],_0x5394cb=['F','B','S'],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=['Level',_0x236dbb(0x160)],_0x549dee=['C'],_0x23dc15=['B'];break;case _0x236dbb(0x15e):_0x5ca3f5=[0x1,0x2,0x3,0x4,0x5],_0x5394cb=['B','F','S'],_0x2c0ee4=[0x5,0x4,0x3,0x2,0x1],_0x5c2b94=['Level','Floor'],_0x549dee=['C'],_0x23dc15=['C'];break;case _0x236dbb(0xb1):_0x5ca3f5=[0x5,0x4,0x3,0x2,0x1],_0x5394cb=['F','B','S'],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=[_0x236dbb(0xbc),_0x236dbb(0x160)],_0x549dee=['C'],_0x23dc15=['D'];break;case _0x236dbb(0x183):_0x5ca3f5=[0x4,0x3,0x2,0x1],_0x5394cb=[0x1,0x2],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=[_0x236dbb(0xbc),_0x236dbb(0x160)],_0x549dee=['C'],_0x23dc15=['E'];break;case'Rack\x20F':_0x5ca3f5=[0x1,0x2,0x3],_0x5394cb=[0x1,0x2],_0x2c0ee4=[0x1,0x2,0x3,0x4,0x5],_0x5c2b94=[_0x236dbb(0xbc)],_0x549dee=['C'],_0x23dc15=['F'];break;}}return{'levels':_0x5ca3f5,'Isle':_0x5394cb,'rack':_0x2c0ee4,'type':_0x5c2b94,'storage':_0x549dee,'rak':_0x23dc15};}async function getRandom8DigitNumber(){var _0x5d870=a0_0x1d9df1;const _0x4cf5d9=0x989680,_0x3e63e5=0x5f5e0ff,_0x4db9aa=Math[_0x5d870(0x10b)](Math[_0x5d870(0x14a)]()*(_0x3e63e5-_0x4cf5d9+0x1))+_0x4cf5d9;var _0x32171b;const _0x18406c=await purchases[_0x5d870(0x12c)]({'invoice':_0x5d870(0x14f)+_0x4db9aa});return _0x18406c&&_0x18406c[_0x5d870(0x129)]>0x0?_0x32171b='INC-'+_0x4db9aa:_0x32171b='INC-'+_0x4db9aa,_0x32171b;}router['get'](a0_0x1d9df1(0xa2),auth,async(_0x44bacd,_0x40d987)=>{var _0x5ceb42=a0_0x1d9df1;try{const {username:_0x572c4f,email:_0x24df08,role:_0x216c12}=_0x44bacd[_0x5ceb42(0x9e)],_0x129822=_0x44bacd[_0x5ceb42(0x9e)],_0x17b1f7=await profile[_0x5ceb42(0x12c)]({'email':_0x129822[_0x5ceb42(0x16f)]}),_0x2bd04b=await master_shop['find'](),_0x1e7fdf=await staff['findOne']({'email':_0x129822[_0x5ceb42(0x16f)]}),_0x6781c7=await suppliers[_0x5ceb42(0x80)]({});let _0x55541b;if(_0x129822[_0x5ceb42(0xb8)]==_0x5ceb42(0x118)){const _0x5042b3=await staff[_0x5ceb42(0x12c)]({'email':_0x129822[_0x5ceb42(0x16f)]});_0x55541b=await warehouse['aggregate']([{'$match':{'status':_0x5ceb42(0xc5),'name':_0x5042b3[_0x5ceb42(0xfb)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x5ceb42(0xca),'name':{'$first':_0x5ceb42(0xca)}}}]);}else _0x55541b=await warehouse[_0x5ceb42(0x15f)]([{'$match':{'status':_0x5ceb42(0xc5),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x5ceb42(0x78)}}},{'$group':{'_id':_0x5ceb42(0xca),'name':{'$first':'$name'}}}]);const _0x418835=await product['find']({}),_0x1c5420=await warehouse[_0x5ceb42(0x80)]({'status':_0x5ceb42(0xc5)}),_0x38cc1c=await purchases['find']({}),_0x3642cd=_0x38cc1c[_0x5ceb42(0x129)]+0x1,_0x4bb43b=_0x5ceb42(0x14f)+_0x3642cd[_0x5ceb42(0x9d)]()[_0x5ceb42(0x17a)](0x5,'0');var _0x281c3c=[_0x5ceb42(0x149),_0x5ceb42(0xc7)];if(_0x2bd04b[0x0][_0x5ceb42(0x76)]==_0x5ceb42(0x159))var _0x46d700=users[_0x5ceb42(0xfd)];else{if(_0x2bd04b[0x0][_0x5ceb42(0x76)]==_0x5ceb42(0x8a))var _0x46d700=users['Hindi'];else{if(_0x2bd04b[0x0][_0x5ceb42(0x76)]=='German')var _0x46d700=users['German'];else{if(_0x2bd04b[0x0]['language']==_0x5ceb42(0x99))var _0x46d700=users['Spanish'];else{if(_0x2bd04b[0x0][_0x5ceb42(0x76)]==_0x5ceb42(0xef))var _0x46d700=users[_0x5ceb42(0xef)];else{if(_0x2bd04b[0x0]['language']==_0x5ceb42(0x186))var _0x46d700=users['Portuguese'];else{if(_0x2bd04b[0x0][_0x5ceb42(0x76)]==_0x5ceb42(0x15a))var _0x46d700=users[_0x5ceb42(0x15a)];else{if(_0x2bd04b[0x0][_0x5ceb42(0x76)]=='Arabic\x20(ae)')var _0x46d700=users[_0x5ceb42(0x157)];}}}}}}}const _0x3c3df8=getRandom8DigitNumber();_0x3c3df8[_0x5ceb42(0xd7)](_0x2e8dcf=>{var _0x50b98a=_0x5ceb42;_0x40d987[_0x50b98a(0x167)]('add_purchases',{'success':_0x44bacd[_0x50b98a(0x17c)](_0x50b98a(0x174)),'errors':_0x44bacd[_0x50b98a(0x17c)](_0x50b98a(0x70)),'role':_0x129822,'profile':_0x17b1f7,'suppliers':_0x6781c7,'warehouse':_0x55541b,'product':_0x418835,'invoice':_0x2e8dcf,'master_shop':_0x2bd04b,'language':_0x46d700,'find_data':_0x1c5420,'rooms_data':_0x281c3c});})[_0x5ceb42(0xff)](_0x36df5b=>{var _0x16c4b9=_0x5ceb42;_0x44bacd[_0x16c4b9(0x17c)](_0x16c4b9(0x70),_0x16c4b9(0xad)),_0x40d987[_0x16c4b9(0x163)](_0x16c4b9(0xe9));});}catch(_0x1dbbf8){console[_0x5ceb42(0x103)](_0x1dbbf8);}}),router['get']('/view/add_purchases/:id',auth,async(_0x1210dd,_0x3382be)=>{var _0x1ad201=a0_0x1d9df1;try{const _0x15e1ba=_0x1210dd[_0x1ad201(0xf9)]['id'];console[_0x1ad201(0x103)](_0x15e1ba);const _0x3e4d6a=await master_shop['find']();console[_0x1ad201(0x103)](_0x1ad201(0x175),_0x3e4d6a);const _0x13c674=await product[_0x1ad201(0x12c)]({'name':_0x15e1ba});console['log']('product',_0x13c674),_0x3382be[_0x1ad201(0x144)](0xc8)[_0x1ad201(0x143)]({'product_data':_0x13c674,'master':_0x3e4d6a});}catch(_0x2283d1){console[_0x1ad201(0x103)](_0x1ad201(0x6f),_0x2283d1);}}),router[a0_0x1d9df1(0x138)](a0_0x1d9df1(0xa2),auth,async(_0x4c1b0d,_0x4b2947)=>{var _0x2da7f0=a0_0x1d9df1;try{const {invoice:_0x2c24be,date:_0x4e4260,warehouse_name:_0x1d161a,prod_name:_0x5b75bf,prod_code:_0x279714,prod_qty:_0x56342b,prod_unit:_0x1a37c6,prod_secondunit:_0x31f568,prod_level:_0x38fe94,prod_isle:_0x14c328,prod_pallet:_0x31fab1,note:_0x1a7289,expiry_date:_0x43f82f,batch_code:_0x503ce5,payable:_0xb66523,due_amount:_0x275aee,Room_name:_0x3ebfd6,primary_code:_0x3d2a35,secondary_code:_0x4bc1f1,MaxStocks_data:_0xb6f155,PO_number:_0x3e0604,SCRN:_0x2ce83d,JO_number:_0x4d842a}=_0x4c1b0d['body'];if(typeof _0x5b75bf=='string')var _0x5ecee5=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xb6)]],_0xc17ebf=[_0x4c1b0d['body'][_0x2da7f0(0x15c)]],_0x4fe383=[_0x4c1b0d['body'][_0x2da7f0(0x13c)]],_0x136ae2=[_0x4c1b0d[_0x2da7f0(0x110)]['prod_primunit']],_0x21afe3=[_0x4c1b0d[_0x2da7f0(0x110)]['prod_secondunit']],_0x817ea7=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x9a)]],_0x40e2a8=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xc8)]],_0x113e9c=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xe8)]],_0x14ac8a=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x113)]],_0xc6b9b=[_0x4c1b0d['body'][_0x2da7f0(0x161)]],_0x26cdef=[_0x4c1b0d['body'][_0x2da7f0(0x10c)]],_0x591e23=[_0x4c1b0d['body'][_0x2da7f0(0xbf)]],_0x239507=[_0x4c1b0d['body'][_0x2da7f0(0xd4)]],_0x34cbbf=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xdc)]],_0x13c34f=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x72)]],_0x28d2cb=[_0x4c1b0d['body']['RoomAssign']],_0x5808ba=[_0x4c1b0d['body']['deliverycode']],_0x218b31=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x73)]],_0x2e60ef=[_0x4c1b0d[_0x2da7f0(0x110)]['actual_qty']],_0x40f6b9=[_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x136)]];else var _0x5ecee5=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xb6)]],_0xc17ebf=[..._0x4c1b0d['body'][_0x2da7f0(0x15c)]],_0x4fe383=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x13c)]],_0x136ae2=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x107)]],_0x21afe3=[..._0x4c1b0d[_0x2da7f0(0x110)]['prod_secondunit']],_0x817ea7=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x9a)]],_0x40e2a8=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xc8)]],_0x113e9c=[..._0x4c1b0d['body']['secondary_code']],_0x14ac8a=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x113)]],_0xc6b9b=[..._0x4c1b0d[_0x2da7f0(0x110)]['batch_code']],_0x26cdef=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x10c)]],_0x591e23=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xbf)]],_0x239507=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xd4)]],_0x34cbbf=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0xdc)]],_0x13c34f=[..._0x4c1b0d[_0x2da7f0(0x110)]['prod_cat']],_0x28d2cb=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x95)]],_0x5808ba=[..._0x4c1b0d[_0x2da7f0(0x110)]['deliverycode']],_0x218b31=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x73)]],_0x2e60ef=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x88)]],_0x40f6b9=[..._0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x136)]];const _0x3490d7=_0x5ecee5[_0x2da7f0(0xc6)](_0x27bbff=>{return _0x27bbff={'product_name':_0x27bbff};});_0x2e60ef[_0x2da7f0(0x150)]((_0x4db2aa,_0xa6d590)=>{var _0x212eef=_0x2da7f0;_0x3490d7[_0xa6d590][_0x212eef(0x88)]=Math['abs'](_0x4db2aa);}),_0x40f6b9[_0x2da7f0(0x150)]((_0x533f30,_0x1725e1)=>{_0x3490d7[_0x1725e1]['actual_uom']=_0x533f30;}),_0xc17ebf['forEach']((_0x52b901,_0x44a465)=>{var _0xa44e7b=_0x2da7f0;_0x3490d7[_0x44a465][_0xa44e7b(0x117)]=_0x52b901;}),_0x4fe383[_0x2da7f0(0x150)]((_0x44c82c,_0xae674a)=>{var _0x2adfbc=_0x2da7f0;_0x3490d7[_0xae674a][_0x2adfbc(0x146)]=Math[_0x2adfbc(0xc3)](_0x44c82c);}),_0x136ae2[_0x2da7f0(0x150)]((_0x229587,_0x55d5fd)=>{_0x3490d7[_0x55d5fd]['standard_unit']=_0x229587;}),_0x21afe3[_0x2da7f0(0x150)]((_0x322c82,_0x3351ca)=>{var _0x4b526a=_0x2da7f0;_0x3490d7[_0x3351ca][_0x4b526a(0xb4)]=_0x322c82;}),_0x817ea7[_0x2da7f0(0x150)]((_0x4c8dea,_0x5bfaa4)=>{var _0x3cabf7=_0x2da7f0;_0x28d2cb[_0x3cabf7(0x150)]((_0x35dfb0,_0x33f289)=>{var _0x3a6413=_0x3cabf7;if(_0x35dfb0==_0x3a6413(0xf5)&&_0x5bfaa4==_0x33f289){console['log'](_0x35dfb0+_0x3a6413(0x165)+_0x5bfaa4+'\x20<>\x20'+_0x33f289+'\x20<>\x20'+_0x4c8dea);var _0x30cf2a=_0x4c8dea[_0x3a6413(0x89)](0x3);_0x3490d7[_0x5bfaa4]['storage']=_0x4c8dea[0x0],_0x3490d7[_0x5bfaa4][_0x3a6413(0x119)]=_0x4c8dea[0x1],_0x3490d7[_0x5bfaa4][_0x3a6413(0x17f)]=0x0,_0x3490d7[_0x5bfaa4]['bin']=0x0,_0x3490d7[_0x5bfaa4][_0x3a6413(0xc4)]='Floor',_0x3490d7[_0x5bfaa4][_0x3a6413(0xf2)]=_0x30cf2a;}else{if(_0x35dfb0==_0x3a6413(0xaf)&&_0x5bfaa4==_0x33f289){var _0x30cf2a=_0x4c8dea[_0x3a6413(0x89)](0x3);_0x3490d7[_0x5bfaa4][_0x3a6413(0x6a)]=_0x4c8dea[0x0],_0x3490d7[_0x5bfaa4]['rack']=_0x4c8dea[0x1],_0x3490d7[_0x5bfaa4]['bay']=0x0,_0x3490d7[_0x5bfaa4][_0x3a6413(0xd1)]=0x0,_0x3490d7[_0x5bfaa4]['type']=_0x3a6413(0x160),_0x3490d7[_0x5bfaa4]['floorlevel']=_0x4c8dea[0x5];}else{if(_0x5bfaa4==_0x33f289){if(_0x4c8dea[0x0]=='A'&&_0x4c8dea[0x1]=='L'&&_0x4c8dea[0x2]=='L')console[_0x3a6413(0x103)](_0x35dfb0+_0x3a6413(0xd6)+_0x5bfaa4+_0x3a6413(0xd6)+_0x33f289+_0x3a6413(0xd6)+_0x4c8dea+_0x3a6413(0x13b)),_0x3490d7[_0x5bfaa4][_0x3a6413(0x6a)]=_0x4c8dea[0x0],_0x3490d7[_0x5bfaa4][_0x3a6413(0x119)]=_0x4c8dea[0x1],_0x3490d7[_0x5bfaa4][_0x3a6413(0x17f)]=0x0,_0x3490d7[_0x5bfaa4][_0x3a6413(0xd1)]=0x0,_0x3490d7[_0x5bfaa4][_0x3a6413(0xc4)]='Floor',_0x3490d7[_0x5bfaa4][_0x3a6413(0xf2)]=_0x4c8dea[0x3];else{var _0x2f4ca8;if(_0x4c8dea[0x4]=='L')_0x2f4ca8=_0x3a6413(0xbc);else _0x4c8dea[0x4]=='F'&&(_0x2f4ca8=_0x3a6413(0x160));_0x3490d7[_0x5bfaa4][_0x3a6413(0x6a)]=_0x4c8dea[0x0],_0x3490d7[_0x5bfaa4][_0x3a6413(0x119)]=_0x4c8dea[0x1],_0x3490d7[_0x5bfaa4][_0x3a6413(0x17f)]=_0x4c8dea[0x2],_0x3490d7[_0x5bfaa4][_0x3a6413(0xd1)]=_0x4c8dea[0x3],_0x3490d7[_0x5bfaa4][_0x3a6413(0xc4)]=_0x2f4ca8,_0x3490d7[_0x5bfaa4][_0x3a6413(0xf2)]=_0x4c8dea[0x5];}}}}});}),_0x40e2a8['forEach']((_0x253e2c,_0x474378)=>{_0x3490d7[_0x474378]['primary_code']=_0x253e2c;}),_0x113e9c['forEach']((_0x13db17,_0x1dfacf)=>{var _0x26b947=_0x2da7f0;_0x3490d7[_0x1dfacf][_0x26b947(0xe8)]=_0x13db17;}),_0x14ac8a[_0x2da7f0(0x150)]((_0x1fa462,_0x2293d4)=>{var _0x36ccbf=_0x2da7f0;_0x3490d7[_0x2293d4][_0x36ccbf(0x104)]=_0x1fa462;}),_0xc6b9b[_0x2da7f0(0x150)]((_0x5d2b20,_0x56bada)=>{_0x3490d7[_0x56bada]['batch_code']=_0x5d2b20;}),_0x26cdef[_0x2da7f0(0x150)]((_0x5c9f19,_0x12c074)=>{var _0x55927a=_0x2da7f0;_0x3490d7[_0x12c074][_0x55927a(0x10c)]=_0x5c9f19;}),_0x591e23[_0x2da7f0(0x150)]((_0x5f41bc,_0x438973)=>{_0x3490d7[_0x438973]['maxperunit']=_0x5f41bc;}),_0x239507[_0x2da7f0(0x150)]((_0x14ab37,_0x3feead)=>{var _0x54d913=_0x2da7f0;_0x3490d7[_0x3feead][_0x54d913(0xd4)]=_0x14ab37;}),_0x34cbbf[_0x2da7f0(0x150)]((_0x58ea10,_0x392678)=>{var _0x29eb9c=_0x2da7f0;_0x3490d7[_0x392678][_0x29eb9c(0xdc)]=_0x58ea10;}),_0x13c34f[_0x2da7f0(0x150)]((_0x5d82a9,_0xe8c988)=>{_0x3490d7[_0xe8c988]['product_cat']=_0x5d82a9;}),_0x28d2cb['forEach']((_0x5c2185,_0x55f6f6)=>{var _0x2c89f6=_0x2da7f0;_0x3490d7[_0x55f6f6][_0x2c89f6(0xe7)]=_0x5c2185;}),_0x5808ba[_0x2da7f0(0x150)]((_0x16d758,_0x21f9cd)=>{_0x3490d7[_0x21f9cd]['delivery_code']=_0x16d758;}),_0x218b31[_0x2da7f0(0x150)]((_0x55f634,_0x4318a5)=>{var _0x512e25=_0x2da7f0;_0x3490d7[_0x4318a5][_0x512e25(0x132)]=_0x55f634;});const _0x3f0a71=_0x28d2cb[_0x2da7f0(0xc6)](_0x59c5a4=>{return _0x59c5a4={'room_name':_0x59c5a4};}),_0x39ca59=_0x3490d7[_0x2da7f0(0x109)](_0x5ba279=>_0x5ba279[_0x2da7f0(0x146)]!=='0'&&_0x5ba279[_0x2da7f0(0x146)]!==''),_0x1e280=new purchases({'invoice':_0x2c24be,'suppliers':_0x4c1b0d[_0x2da7f0(0x110)][_0x2da7f0(0x128)],'date':_0x4e4260,'warehouse_name':_0x1d161a,'product':_0x39ca59,'note':_0x1a7289,'due_amount':_0x275aee,'POnumber':_0x3e0604,'SCRN':_0x2ce83d,'JO_number':_0x4d842a,'roomList':_0x3f0a71}),_0x14a216=await _0x1e280[_0x2da7f0(0x7f)](),_0x18b959=await purchases[_0x2da7f0(0x12c)]({'invoice':_0x2c24be}),_0x3eb5eb=_0x18b959['product']['map'](async _0x4b0b5d=>{var _0x3359e2=_0x2da7f0,_0x305040=await warehouse['findOne']({'name':_0x1d161a,'room':_0x4b0b5d[_0x3359e2(0xe7)]}),_0x2e49da=0x0;return _0x305040['product_details'][_0x3359e2(0x150)](_0x3a827b=>{var _0x548715=_0x3359e2;_0x3a827b[_0x548715(0x114)]==_0x4b0b5d['product_name']&&_0x3a827b[_0x548715(0xf2)]==_0x4b0b5d[_0x548715(0xf2)]&&_0x3a827b[_0x548715(0xc4)]==_0x4b0b5d['type']&&_0x3a827b[_0x548715(0xd1)]==_0x4b0b5d[_0x548715(0xd1)]&&_0x3a827b[_0x548715(0x17f)]==_0x4b0b5d[_0x548715(0x17f)]&&_0x3a827b[_0x548715(0x119)]==_0x4b0b5d[_0x548715(0x119)]&&_0x3a827b[_0x548715(0x6a)]==_0x4b0b5d[_0x548715(0x6a)]&&_0x3a827b['expiry_date']==_0x4b0b5d[_0x548715(0x10c)]&&_0x3a827b[_0x548715(0x161)]==_0x4b0b5d[_0x548715(0x161)]&&_0x3a827b['production_date']==_0x4b0b5d[_0x548715(0xdc)]&&_0x3a827b['invoice']==_0x18b959['invoice']&&(_0x3a827b[_0x548715(0xd8)]+=Math[_0x548715(0xc3)](_0x4b0b5d['quantity']),_0x2e49da++);}),_0x2e49da===0x0&&_0x305040[_0x3359e2(0x12f)]['push']({'product_name':_0x4b0b5d['product_name'],'product_stock':Math[_0x3359e2(0xc3)](_0x4b0b5d[_0x3359e2(0x146)]),'primary_code':_0x4b0b5d['primary_code'],'secondary_code':_0x4b0b5d['secondary_code'],'product_code':_0x4b0b5d['product_code'],'storage':_0x4b0b5d[_0x3359e2(0x6a)],'rack':_0x4b0b5d[_0x3359e2(0x119)],'bay':_0x4b0b5d['bay'],'bin':_0x4b0b5d[_0x3359e2(0xd1)],'type':_0x4b0b5d[_0x3359e2(0xc4)],'floorlevel':_0x4b0b5d[_0x3359e2(0xf2)],'maxProducts':_0x4b0b5d[_0x3359e2(0x104)],'unit':_0x4b0b5d[_0x3359e2(0x172)],'secondary_unit':_0x4b0b5d[_0x3359e2(0xb4)],'expiry_date':_0x4b0b5d[_0x3359e2(0x10c)],'maxPerUnit':_0x4b0b5d['maxperunit'],'batch_code':_0x4b0b5d['batch_code'],'alertQTY':_0x4b0b5d[_0x3359e2(0xd4)],'production_date':_0x4b0b5d[_0x3359e2(0xdc)],'product_cat':_0x4b0b5d[_0x3359e2(0x158)],'invoice':_0x4b0b5d[_0x3359e2(0x132)],'actual_qty':Math[_0x3359e2(0xc3)](_0x4b0b5d[_0x3359e2(0x88)]),'actual_uom':_0x4b0b5d[_0x3359e2(0x136)]}),_0x305040;});Promise[_0x2da7f0(0x13e)](_0x3eb5eb)['then'](async _0x1b29b5=>{var _0x10001b=_0x2da7f0;try{for(const _0x44b1a4 of _0x1b29b5){await _0x44b1a4[_0x10001b(0x7f)]();}const _0x3daedc=await master_shop[_0x10001b(0x80)](),_0x82735d=await email_settings[_0x10001b(0x12c)](),_0x5c499f=await supervisor_settings[_0x10001b(0x80)]();var _0x236656=_0x18b959[_0x10001b(0xd5)],_0x467c78='',_0x4b6474;for(_0x4b6474 in _0x236656){_0x467c78+=_0x10001b(0xcd)+_0x10001b(0x9f)+_0x236656[_0x4b6474][_0x10001b(0x114)]+_0x10001b(0xb7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x236656[_0x4b6474][_0x10001b(0x117)]+_0x10001b(0xb7)+_0x10001b(0x9f)+_0x236656[_0x4b6474][_0x10001b(0x146)]+_0x10001b(0xb7)+_0x10001b(0x9f)+_0x236656[_0x4b6474][_0x10001b(0x172)]+_0x10001b(0xb7)+_0x10001b(0x9f)+_0x236656[_0x4b6474][_0x10001b(0xb4)]+'</td>'+_0x10001b(0x9f)+_0x18b959[_0x10001b(0x170)]+_0x10001b(0xb7)+_0x10001b(0x9f)+_0x236656[_0x4b6474][_0x10001b(0xe7)]+_0x10001b(0xb7)+_0x10001b(0x9f)+_0x236656[_0x4b6474][_0x10001b(0x6a)]+_0x236656[_0x4b6474]['rack']+_0x236656[_0x4b6474][_0x10001b(0x17f)]+_0x236656[_0x4b6474][_0x10001b(0xd1)]+_0x236656[_0x4b6474][_0x10001b(0xc4)][0x0]+_0x236656[_0x4b6474][_0x10001b(0xf2)]+_0x10001b(0xb7),'</tr>';}let _0xe7a892=nodemailer['createTransport']({'host':_0x82735d['host'],'port':Number(_0x82735d[_0x10001b(0x16d)]),'secure':![],'auth':{'user':_0x82735d[_0x10001b(0x16f)],'pass':_0x82735d[_0x10001b(0x122)]}}),_0xddf9b1={'from':_0x82735d[_0x10001b(0x16f)],'to':_0x5c499f[0x0][_0x10001b(0x171)],'subject':_0x10001b(0x11a),'attachments':[{'filename':_0x10001b(0x14e),'path':__dirname+_0x10001b(0xa9)+'/upload/'+_0x3daedc[0x0][_0x10001b(0x13f)],'cid':_0x10001b(0x11d)}],'html':_0x10001b(0x13d)+_0x10001b(0x10f)+_0x10001b(0x15b)+_0x10001b(0x91)+_0x10001b(0x105)+_0x10001b(0x91)+_0x10001b(0xc9)+'</div>'+_0x10001b(0x91)+_0x10001b(0x92)+_0x3daedc[0x0]['site_title']+'\x20</h2>'+_0x10001b(0x137)+_0x10001b(0x137)+_0x10001b(0x12e)+_0x10001b(0x91)+_0x10001b(0x15d)+_0x10001b(0xa8)+_0x18b959[_0x10001b(0x132)]+'\x20'+_0x10001b(0x153)+'\x20Order\x20Date\x20:\x20'+_0x18b959['date']+'\x20'+'</span>'+'</h5>'+_0x10001b(0x137)+_0x10001b(0x111)+_0x10001b(0x11b)+_0x10001b(0xcd)+_0x10001b(0x187)+_0x10001b(0x154)+_0x10001b(0x81)+_0x10001b(0x112)+_0x10001b(0xa6)+_0x10001b(0x12d)+_0x10001b(0xa4)+_0x10001b(0xd9)+_0x10001b(0x151)+'</thead>'+_0x10001b(0x14d)+'\x20'+_0x467c78+'\x20'+_0x10001b(0x17e)+_0x10001b(0x16b)+'<div>'+_0x10001b(0xeb)+'<h5>'+_0x3daedc[0x0][_0x10001b(0x75)]+_0x10001b(0x16c)+_0x10001b(0x137)+'</div>'+'</body></html>'};_0xe7a892['sendMail'](_0xddf9b1,function(_0x3a03cb,_0x43958f){var _0x20348f=_0x10001b;_0x3a03cb?(console[_0x20348f(0x103)](_0x3a03cb),console[_0x20348f(0x103)](_0x20348f(0xe0))):console[_0x20348f(0x103)](_0x20348f(0xaa));}),_0x4c1b0d[_0x10001b(0x17c)]('success',_0x10001b(0xf6)),_0x4b2947[_0x10001b(0x163)](_0x10001b(0x179));}catch(_0x34b7d2){console[_0x10001b(0xde)](_0x34b7d2),_0x4b2947['status'](0x1f4)[_0x10001b(0x143)]({'error':_0x10001b(0x106)});}})[_0x2da7f0(0xff)](_0x5cc957=>{var _0x2154b2=_0x2da7f0;console[_0x2154b2(0xde)](_0x5cc957),_0x4b2947[_0x2154b2(0x144)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0xef6411){console['log'](_0xef6411);}}),router[a0_0x1d9df1(0x98)](a0_0x1d9df1(0x17b),auth,async(_0x5a567b,_0x5651c9)=>{var _0x5b5090=a0_0x1d9df1;try{const {username:_0x3b6a76,email:_0x4e861a,role:_0xccd2f2}=_0x5a567b[_0x5b5090(0x9e)],_0x229445=_0x5a567b[_0x5b5090(0x9e)],_0x235a02=await profile[_0x5b5090(0x12c)]({'email':_0x229445[_0x5b5090(0x16f)]}),_0x261311=await master_shop[_0x5b5090(0x80)](),_0x5968e1=_0x5a567b[_0x5b5090(0xf9)]['id'],_0x179f12=await purchases[_0x5b5090(0xa1)](_0x5968e1),_0x3f3e2a=await warehouse[_0x5b5090(0x15f)]([{'$match':{'name':_0x179f12[_0x5b5090(0x170)],'room':_0x179f12[_0x5b5090(0x67)]}},{'$unwind':_0x5b5090(0x100)},{'$group':{'_id':_0x5b5090(0xce),'name':{'$first':_0x5b5090(0x185)},'product_stock':{'$first':_0x5b5090(0xf3)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5b5090(0x6b)},'floorlevel':{'$first':_0x5b5090(0x116)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5b5090(0x166)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5b5090(0x12a)},'rack':{'$first':_0x5b5090(0x16e)},'expiry_date':{'$first':_0x5b5090(0x10e)}}}]),_0x3e6d88=await customer['find']({});let _0x1d16d8;if(_0x229445[_0x5b5090(0xb8)]==_0x5b5090(0x118)){const _0x58e953=await staff['findOne']({'email':_0x229445['email']});_0x1d16d8=await warehouse[_0x5b5090(0x15f)]([{'$match':{'status':'Enabled','name':_0x58e953[_0x5b5090(0xfb)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1d16d8=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x5b5090(0xca),'name':{'$first':_0x5b5090(0xca)}}}]);const _0x2ed71a=await product[_0x5b5090(0x80)]({}),_0x39abb0=await suppliers[_0x5b5090(0x80)]({}),_0x10360a=BayBinSelected(_0x179f12['warehouse_name'],_0x179f12[_0x5b5090(0x67)]);if(_0x261311[0x0][_0x5b5090(0x76)]=='English\x20(US)'){var _0x24e63f=users[_0x5b5090(0xfd)];console['log'](_0x24e63f);}else{if(_0x261311[0x0][_0x5b5090(0x76)]==_0x5b5090(0x8a))var _0x24e63f=users['Hindi'];else{if(_0x261311[0x0]['language']==_0x5b5090(0xf0))var _0x24e63f=users[_0x5b5090(0xf0)];else{if(_0x261311[0x0]['language']==_0x5b5090(0x99))var _0x24e63f=users['Spanish'];else{if(_0x261311[0x0][_0x5b5090(0x76)]==_0x5b5090(0xef))var _0x24e63f=users['French'];else{if(_0x261311[0x0][_0x5b5090(0x76)]==_0x5b5090(0x186))var _0x24e63f=users[_0x5b5090(0x134)];else{if(_0x261311[0x0][_0x5b5090(0x76)]==_0x5b5090(0x15a))var _0x24e63f=users[_0x5b5090(0x15a)];else{if(_0x261311[0x0][_0x5b5090(0x76)]==_0x5b5090(0xae))var _0x24e63f=users[_0x5b5090(0x157)];}}}}}}}_0x5651c9[_0x5b5090(0x167)](_0x5b5090(0x74),{'success':_0x5a567b[_0x5b5090(0x17c)](_0x5b5090(0x174)),'errors':_0x5a567b[_0x5b5090(0x17c)](_0x5b5090(0x70)),'role':_0x229445,'profile':_0x235a02,'customer':_0x3e6d88,'warehouse':_0x1d16d8,'product':_0x3f3e2a,'user':_0x179f12,'master_shop':_0x261311,'unit':_0x2ed71a,'language':_0x24e63f,'suppliers':_0x39abb0,'dataSelected':_0x10360a});}catch(_0x1faa2e){console[_0x5b5090(0x103)](_0x1faa2e);}}),router['post'](a0_0x1d9df1(0x17b),auth,async(_0x382666,_0x53a9f4)=>{var _0x197522=a0_0x1d9df1;try{const _0x2f9ec0=_0x382666['params']['id'],{invoice:_0x4afdc3,warehouse_name:_0x1b8a0e,Room_name:_0x44f2ff}=_0x382666[_0x197522(0x110)],_0x3d2772=await warehouse[_0x197522(0x12c)]({'name':_0x1b8a0e,'room':_0x44f2ff}),_0x4d23a4=await purchases[_0x197522(0x12c)]({'invoice':_0x4afdc3});_0x4d23a4['product'][_0x197522(0x150)](_0x25d6d5=>{var _0x47e636=_0x197522,_0x10334a=0x0;const _0x68b0b4=_0x3d2772[_0x47e636(0x12f)][_0x47e636(0xc6)](_0xd42373=>{var _0x59ed8c=_0x47e636;_0xd42373[_0x59ed8c(0x114)]==_0x25d6d5[_0x59ed8c(0x114)]&&_0xd42373[_0x59ed8c(0xf2)]==_0x25d6d5[_0x59ed8c(0xf2)]&&_0xd42373['type']==_0x25d6d5['type']&&_0xd42373[_0x59ed8c(0xd1)]==_0x25d6d5['bin']&&_0xd42373[_0x59ed8c(0x17f)]==_0x25d6d5[_0x59ed8c(0x17f)]&&_0xd42373[_0x59ed8c(0x119)]==_0x25d6d5[_0x59ed8c(0x119)]&&_0xd42373[_0x59ed8c(0x6a)]==_0x25d6d5[_0x59ed8c(0x6a)]&&_0xd42373['expiry_date']==_0x25d6d5[_0x59ed8c(0x10c)]&&_0xd42373['batch_code']==_0x25d6d5[_0x59ed8c(0x161)]&&_0xd42373[_0x59ed8c(0xdc)]==_0x25d6d5[_0x59ed8c(0xdc)]&&_0xd42373[_0x59ed8c(0xbd)]==_0x25d6d5[_0x59ed8c(0xbd)]&&_0xd42373[_0x59ed8c(0x8f)]==_0x25d6d5[_0x59ed8c(0x8f)]&&(_0xd42373['product_stock']=parseInt(_0xd42373[_0x59ed8c(0xd8)])+parseInt(_0x25d6d5['quantity']),_0x10334a++);});_0x10334a=='0'&&(_0x3d2772[_0x47e636(0x12f)]=_0x3d2772[_0x47e636(0x12f)][_0x47e636(0x10a)]({'product_name':_0x25d6d5['product_name'],'product_stock':_0x25d6d5[_0x47e636(0x146)],'primary_code':_0x25d6d5[_0x47e636(0xc8)],'secondary_code':_0x25d6d5['secondary_code'],'product_code':_0x25d6d5[_0x47e636(0x117)],'storage':_0x25d6d5[_0x47e636(0x6a)],'rack':_0x25d6d5[_0x47e636(0x119)],'bay':_0x25d6d5[_0x47e636(0x17f)],'bin':_0x25d6d5['bin'],'type':_0x25d6d5[_0x47e636(0xc4)],'floorlevel':_0x25d6d5[_0x47e636(0xf2)],'maxProducts':_0x25d6d5[_0x47e636(0x104)],'unit':_0x25d6d5[_0x47e636(0x172)],'secondary_unit':_0x25d6d5[_0x47e636(0xb4)],'expiry_date':_0x25d6d5[_0x47e636(0x10c)],'maxPerUnit':_0x25d6d5['maxperunit'],'batch_code':_0x25d6d5['batch_code'],'alertQTY':_0x25d6d5['alertQTY'],'production_date':_0x25d6d5[_0x47e636(0xdc)],'delivery_date':_0x25d6d5[_0x47e636(0xbd)],'delivery_code':_0x25d6d5[_0x47e636(0x8f)]}));}),await _0x3d2772[_0x197522(0x7f)](),_0x4d23a4[_0x197522(0x131)]='True';const _0x513c38=await _0x4d23a4[_0x197522(0x7f)]();_0x382666[_0x197522(0x17c)]('success',_0x197522(0x124)),_0x53a9f4['redirect'](_0x197522(0xe9));}catch(_0x1b6da0){console[_0x197522(0x103)](_0x1b6da0);}}),router['get'](a0_0x1d9df1(0xa0),auth,async(_0x2dea0b,_0x26bc2e)=>{var _0x39b71b=a0_0x1d9df1;try{const {username:_0x356c8f,email:_0x1852f2,role:_0xd1512c}=_0x2dea0b[_0x39b71b(0x9e)],_0x34bc0b=_0x2dea0b[_0x39b71b(0x9e)],_0x45d437=await profile[_0x39b71b(0x12c)]({'email':_0x34bc0b[_0x39b71b(0x16f)]}),_0x52ea75=await master_shop['find'](),_0x176736=_0x2dea0b[_0x39b71b(0xf9)]['id'],_0x35a2d8=await purchases[_0x39b71b(0xa1)](_0x176736),_0x11f2e4=await suppliers[_0x39b71b(0x80)]({});let _0x33c3c7;if(_0x34bc0b[_0x39b71b(0xb8)]==_0x39b71b(0x118)){const _0xb07189=await staff[_0x39b71b(0x12c)]({'email':_0x34bc0b[_0x39b71b(0x16f)]});_0x33c3c7=await warehouse[_0x39b71b(0x80)]({'status':_0x39b71b(0xc5),'name':_0xb07189[_0x39b71b(0xfb)],'warehouse_category':'Raw\x20Materials'});}else _0x33c3c7=await warehouse[_0x39b71b(0x15f)]([{'$match':{'status':_0x39b71b(0xc5),'warehouse_category':_0x39b71b(0x82)}},{'$group':{'_id':_0x39b71b(0xca),'name':{'$first':_0x39b71b(0xca)}}}]);const _0x16c503=await product[_0x39b71b(0x80)]({}),_0x81a5f9=BayBinSelected(_0x35a2d8[_0x39b71b(0x170)],_0x35a2d8[_0x39b71b(0x67)]);let _0x31e3d5=new Date(_0x35a2d8[_0x39b71b(0x10c)]),_0xa2833=('0'+_0x31e3d5[_0x39b71b(0xee)]())['slice'](-0x2),_0x34bbdd=('0'+(_0x31e3d5[_0x39b71b(0x178)]()+0x1))[_0x39b71b(0x89)](-0x2),_0x2f0562=_0x31e3d5['getFullYear'](),_0x5c3f86=_0x2f0562+'-'+_0x34bbdd+'-'+_0xa2833;if(_0x52ea75[0x0]['language']==_0x39b71b(0x159)){var _0xaa1dd5=users[_0x39b71b(0xfd)];console[_0x39b71b(0x103)](_0xaa1dd5);}else{if(_0x52ea75[0x0][_0x39b71b(0x76)]=='Hindi')var _0xaa1dd5=users[_0x39b71b(0x8a)];else{if(_0x52ea75[0x0]['language']==_0x39b71b(0xf0))var _0xaa1dd5=users[_0x39b71b(0xf0)];else{if(_0x52ea75[0x0][_0x39b71b(0x76)]==_0x39b71b(0x99))var _0xaa1dd5=users[_0x39b71b(0x99)];else{if(_0x52ea75[0x0][_0x39b71b(0x76)]==_0x39b71b(0xef))var _0xaa1dd5=users[_0x39b71b(0xef)];else{if(_0x52ea75[0x0][_0x39b71b(0x76)]==_0x39b71b(0x186))var _0xaa1dd5=users['Portuguese'];else{if(_0x52ea75[0x0]['language']==_0x39b71b(0x15a))var _0xaa1dd5=users['Chinese'];else{if(_0x52ea75[0x0][_0x39b71b(0x76)]==_0x39b71b(0xae))var _0xaa1dd5=users[_0x39b71b(0x157)];}}}}}}}_0x26bc2e[_0x39b71b(0x167)](_0x39b71b(0x84),{'success':_0x2dea0b[_0x39b71b(0x17c)](_0x39b71b(0x174)),'errors':_0x2dea0b[_0x39b71b(0x17c)]('errors'),'role':_0x34bc0b,'profile':_0x45d437,'purchases':_0x35a2d8,'suppliers':_0x11f2e4,'warehouse':_0x33c3c7,'product':_0x16c503,'master_shop':_0x52ea75,'language':_0xaa1dd5,'ed_fullDate':_0x5c3f86,'dataSelected':_0x81a5f9});}catch(_0x53f438){console['log'](_0x53f438);}}),router['post'](a0_0x1d9df1(0xa0),auth,async(_0x318733,_0x3e14e5)=>{var _0x9d86ef=a0_0x1d9df1;try{const _0x331e3a=_0x318733[_0x9d86ef(0xf9)]['id'],_0x5aa3c3=await purchases['findOne']({'_id':_0x318733['params']['id']}),_0x28c7d1=await warehouse[_0x9d86ef(0x12c)]({'name':_0x5aa3c3[_0x9d86ef(0x170)],'room':_0x5aa3c3[_0x9d86ef(0x67)]});_0x5aa3c3[_0x9d86ef(0xd5)][_0x9d86ef(0x150)](_0x54fdf7=>{var _0x33f870=_0x9d86ef;const _0x3073bc=_0x28c7d1['product_details'][_0x33f870(0xc6)](_0x59d209=>{var _0x48d606=_0x33f870;_0x59d209[_0x48d606(0x114)]==_0x54fdf7['product_name']&&_0x59d209[_0x48d606(0xf2)]==_0x54fdf7[_0x48d606(0xf2)]&&_0x59d209['type']==_0x54fdf7[_0x48d606(0xc4)]&&_0x59d209[_0x48d606(0xd1)]==_0x54fdf7[_0x48d606(0xd1)]&&_0x59d209[_0x48d606(0x17f)]==_0x54fdf7[_0x48d606(0x17f)]&&_0x59d209['rack']==_0x54fdf7[_0x48d606(0x119)]&&_0x59d209[_0x48d606(0x6a)]==_0x54fdf7[_0x48d606(0x6a)]&&(_0x59d209[_0x48d606(0xd8)]=parseInt(_0x59d209[_0x48d606(0xd8)])-parseInt(_0x54fdf7['quantity']));});}),await _0x28c7d1[_0x9d86ef(0x7f)]();const {invoice:_0x4e8e30,suppliers:_0x377052,date:_0x216a7e,warehouse_name:_0x190e3b,prod_name:_0x516695,prod_code:_0x4d458a,prod_qty:_0x4a1315,prod_unit:_0x27ada7,prod_secondunit:_0xf337ba,prod_level:_0x1e7ebc,prod_isle:_0x569cf1,prod_pallet:_0x49b711,note:_0x4ad003,expiry_date:_0x43b152,batch_code:_0x5ce977,paid_amount:_0x4c40b2,due_amount:_0x42aeb4,Room_name:_0x2c09e3,primary_code:_0xce5c9b,secondary_code:_0x365ed3,PO_number:_0x3fb858,JO_number:_0x360261}=_0x318733[_0x9d86ef(0x110)];if(typeof _0x516695=='string')var _0x114ce7=[_0x318733['body']['prod_name']],_0x5d1f2a=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x15c)]],_0x499b09=[_0x318733['body'][_0x9d86ef(0x133)]],_0x3945ab=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x12b)]],_0x335db2=[_0x318733['body']['prod_secondunit']],_0x3c8673=[_0x318733['body'][_0x9d86ef(0x9a)]],_0x1c53e4=[_0x318733['body'][_0x9d86ef(0x101)]],_0x1099d4=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xac)]],_0x537b6c=[_0x318733[_0x9d86ef(0x110)]['primary_code']],_0x48e56a=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xe8)]],_0x281d85=[_0x318733['body']['MaxStocks_data']],_0x11cef5=[_0x318733['body'][_0x9d86ef(0x161)]],_0x4c4b35=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x10c)]],_0xa9f79e=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x6a)]],_0x47aa31=[_0x318733['body'][_0x9d86ef(0xe5)]],_0x5e950d=[_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xc4)]];else var _0x114ce7=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xb6)]],_0x5d1f2a=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x15c)]],_0x499b09=[..._0x318733['body']['prod_qty']],_0x3945ab=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x12b)]],_0x335db2=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xa3)]],_0x3c8673=[..._0x318733[_0x9d86ef(0x110)]['prod_level']],_0x1c53e4=[..._0x318733[_0x9d86ef(0x110)]['prod_isle']],_0x1099d4=[..._0x318733[_0x9d86ef(0x110)]['prod_pallet']],_0x537b6c=[..._0x318733[_0x9d86ef(0x110)]['primary_code']],_0x48e56a=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xe8)]],_0x281d85=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x113)]],_0x11cef5=[..._0x318733[_0x9d86ef(0x110)]['batch_code']],_0x4c4b35=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x10c)]],_0xa9f79e=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x6a)]],_0x47aa31=[..._0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xe5)]],_0x5e950d=[..._0x318733['body']['type']];const _0x38d703=_0x114ce7[_0x9d86ef(0xc6)](_0x5b5fa6=>{return _0x5b5fa6={'product_name':_0x5b5fa6};});_0x5d1f2a[_0x9d86ef(0x150)]((_0x58ec51,_0x50721b)=>{_0x38d703[_0x50721b]['product_code']=_0x58ec51;}),_0x499b09[_0x9d86ef(0x150)]((_0x182e70,_0x4eb3ef)=>{_0x38d703[_0x4eb3ef]['quantity']=_0x182e70;}),_0x3945ab['forEach']((_0x8291a5,_0x109d2e)=>{var _0x28a25b=_0x9d86ef;_0x38d703[_0x109d2e][_0x28a25b(0x172)]=_0x8291a5;}),_0x335db2[_0x9d86ef(0x150)]((_0x2b6d44,_0x3f9682)=>{_0x38d703[_0x3f9682]['secondary_unit']=_0x2b6d44;}),_0x3c8673['forEach']((_0x1da505,_0x3fe482)=>{var _0x46965f=_0x9d86ef;_0x38d703[_0x3fe482][_0x46965f(0x17f)]=_0x1da505;}),_0x1c53e4[_0x9d86ef(0x150)]((_0x2335df,_0x16bb16)=>{var _0x44e7e1=_0x9d86ef;_0x38d703[_0x16bb16][_0x44e7e1(0xd1)]=_0x2335df;}),_0x1099d4['forEach']((_0x25e1e8,_0x44889e)=>{var _0x4515b2=_0x9d86ef;_0x38d703[_0x44889e][_0x4515b2(0xf2)]=_0x25e1e8;}),_0x537b6c[_0x9d86ef(0x150)]((_0x33a847,_0x52706b)=>{var _0x426402=_0x9d86ef;_0x38d703[_0x52706b][_0x426402(0xc8)]=_0x33a847;}),_0x48e56a[_0x9d86ef(0x150)]((_0x4fabdc,_0x561b04)=>{var _0x2cfe0e=_0x9d86ef;_0x38d703[_0x561b04][_0x2cfe0e(0xe8)]=_0x4fabdc;}),_0x281d85[_0x9d86ef(0x150)]((_0x521a20,_0x4f3dff)=>{var _0x2ce715=_0x9d86ef;_0x38d703[_0x4f3dff][_0x2ce715(0x104)]=_0x521a20;}),_0x11cef5[_0x9d86ef(0x150)]((_0x5091fb,_0x88fc0d)=>{var _0x36bb5f=_0x9d86ef;_0x38d703[_0x88fc0d][_0x36bb5f(0x161)]=_0x5091fb;}),_0x4c4b35['forEach']((_0x3df0e4,_0x16df15)=>{var _0x15a2d5=_0x9d86ef;_0x38d703[_0x16df15][_0x15a2d5(0x10c)]=_0x3df0e4;}),_0x5e950d[_0x9d86ef(0x150)]((_0x2ae412,_0x1aec29)=>{var _0x2aa004=_0x9d86ef;_0x38d703[_0x1aec29][_0x2aa004(0xc4)]=_0x2ae412;}),_0xa9f79e[_0x9d86ef(0x150)]((_0x1aca59,_0x527592)=>{var _0x2ab4c0=_0x9d86ef;_0x38d703[_0x527592][_0x2ab4c0(0x6a)]=_0x1aca59;}),_0x47aa31[_0x9d86ef(0x150)]((_0x5de036,_0x3e4db8)=>{var _0x4bb8c0=_0x9d86ef;_0x38d703[_0x3e4db8][_0x4bb8c0(0x119)]=_0x5de036;});const _0x2162a0=_0x38d703[_0x9d86ef(0x109)](_0x734f8d=>_0x734f8d[_0x9d86ef(0x146)]!=='0'&&_0x734f8d[_0x9d86ef(0x146)]!=='');_0x5aa3c3[_0x9d86ef(0x132)]=_0x4e8e30,_0x5aa3c3['suppliers']=_0x377052,_0x5aa3c3[_0x9d86ef(0x68)]=_0x216a7e,_0x5aa3c3[_0x9d86ef(0x170)]=_0x190e3b,_0x5aa3c3[_0x9d86ef(0xd5)]=_0x2162a0,_0x5aa3c3[_0x9d86ef(0xe6)]=_0x4ad003,_0x5aa3c3['paid_amount']=_0x4c40b2,_0x5aa3c3[_0x9d86ef(0x126)]=_0x42aeb4,_0x5aa3c3[_0x9d86ef(0x67)]=_0x2c09e3,_0x5aa3c3[_0x9d86ef(0xdd)]=_0x3fb858,_0x5aa3c3[_0x9d86ef(0x77)]=_0x360261;const _0xdd9e7a=await _0x5aa3c3['save'](),_0x57696a=await warehouse[_0x9d86ef(0x12c)]({'name':_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x170)],'room':_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0xed)]});_0x5aa3c3['product'][_0x9d86ef(0x150)](_0x5a1bb2=>{var _0x555499=_0x9d86ef,_0x5f5436=0x0;const _0x254853=_0x57696a[_0x555499(0x12f)][_0x555499(0xc6)](_0x144c89=>{var _0x20a263=_0x555499;_0x144c89[_0x20a263(0x114)]==_0x5a1bb2[_0x20a263(0x114)]&&_0x144c89[_0x20a263(0xf2)]==_0x5a1bb2['floorlevel']&&_0x144c89['type']==_0x5a1bb2[_0x20a263(0xc4)]&&_0x144c89[_0x20a263(0xd1)]==_0x5a1bb2[_0x20a263(0xd1)]&&_0x144c89[_0x20a263(0x17f)]==_0x5a1bb2[_0x20a263(0x17f)]&&_0x144c89['rack']==_0x5a1bb2[_0x20a263(0x119)]&&_0x144c89[_0x20a263(0x6a)]==_0x5a1bb2[_0x20a263(0x6a)]&&(_0x144c89[_0x20a263(0xd8)]=parseInt(_0x144c89[_0x20a263(0xd8)])+parseInt(_0x5a1bb2[_0x20a263(0x146)]),_0x5f5436++);});_0x5f5436=='0'&&(_0x57696a[_0x555499(0x12f)]=_0x57696a[_0x555499(0x12f)][_0x555499(0x10a)]({'product_name':_0x5a1bb2['product_name'],'product_stock':_0x5a1bb2['quantity'],'primary_code':_0x5a1bb2[_0x555499(0xc8)],'secondary_code':_0x5a1bb2['secondary_code'],'product_code':_0x5a1bb2[_0x555499(0x117)],'storage':_0x5a1bb2[_0x555499(0x6a)],'rack':_0x5a1bb2[_0x555499(0x119)],'bay':_0x5a1bb2['bay'],'bin':_0x5a1bb2[_0x555499(0xd1)],'type':_0x5a1bb2[_0x555499(0xc4)],'floorlevel':_0x5a1bb2[_0x555499(0xf2)],'maxProducts':_0x5a1bb2[_0x555499(0x104)],'unit':_0x5a1bb2[_0x555499(0x172)],'secondary_unit':_0x5a1bb2[_0x555499(0xb4)],'expiry_date':_0x5a1bb2[_0x555499(0x10c)]}));}),await _0x57696a[_0x9d86ef(0x7f)]();const _0x497695=await s_payment_data[_0x9d86ef(0x12c)]({'invoice':_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x132)]});if(_0x497695===null){}else console[_0x9d86ef(0x103)](_0x9d86ef(0x128),_0x497695,_0x318733['body'][_0x9d86ef(0x132)]),_0x497695[_0x9d86ef(0x128)]=_0x318733[_0x9d86ef(0x110)][_0x9d86ef(0x128)],await _0x497695['save']();_0x318733['flash']('success',_0x9d86ef(0x8d)),_0x3e14e5[_0x9d86ef(0x163)]('/all_purchases/view');}catch(_0xd71fea){console[_0x9d86ef(0x103)](_0xd71fea);}}),router[a0_0x1d9df1(0x138)](a0_0x1d9df1(0x16a),auth,async(_0xd5ca8e,_0x472b25)=>{var _0x1d294f=a0_0x1d9df1;try{const _0x1cc2de=_0xd5ca8e[_0x1d294f(0xf9)]['id'],{invoice:_0x27c3a2,suppliers:_0x27fbcd,payable:_0x47649c,due_amount:_0x1edcd9}=_0xd5ca8e['body'],_0x189f93=await purchases[_0x1d294f(0xa1)](_0x1cc2de);var _0x8f5c2e=_0x47649c-_0x1edcd9;_0x189f93[_0x1d294f(0x127)]=parseFloat(_0x189f93['paid_amount'])+parseFloat(_0x1edcd9),_0x189f93[_0x1d294f(0x126)]=_0x8f5c2e;const _0x4a2526=await _0x189f93[_0x1d294f(0x7f)]();console[_0x1d294f(0x103)](_0x4a2526);const _0x29f055=await s_payment_data[_0x1d294f(0x12c)]({'invoice':_0x27c3a2});_0x29f055['amount']=_0x8f5c2e,await _0x29f055[_0x1d294f(0x7f)]();let _0x12042c=new Date(),_0x5b4ced=('0'+_0x12042c[_0x1d294f(0xee)]())[_0x1d294f(0x89)](-0x2),_0x21cbac=('0'+(_0x12042c[_0x1d294f(0x178)]()+0x1))[_0x1d294f(0x89)](-0x2),_0x36deb2=_0x12042c[_0x1d294f(0xfa)](),_0x360d14=_0x36deb2+'-'+_0x21cbac+'-'+_0x5b4ced;const _0x31c06b=new suppliers_payment({'invoice':_0x27c3a2,'date':_0x36deb2+'-'+_0x21cbac+'-'+_0x5b4ced,'suppliers':_0x27fbcd,'reason':_0x1d294f(0x145),'amount':_0x1edcd9}),_0x2b7fdc=await _0x31c06b[_0x1d294f(0x7f)]();_0xd5ca8e[_0x1d294f(0x17c)](_0x1d294f(0x174),_0x1d294f(0x164)),_0x472b25[_0x1d294f(0x163)](_0x1d294f(0xe9));}catch(_0x22a2e7){console[_0x1d294f(0x103)](_0x22a2e7);}}),router[a0_0x1d9df1(0x98)](a0_0x1d9df1(0x14c),auth,async(_0x566ca4,_0xe2827e)=>{var _0x31e1e1=a0_0x1d9df1;try{const {username:_0x5ca008,email:_0x2c9e57,role:_0x5eaa2e}=_0x566ca4[_0x31e1e1(0x9e)],_0xccc3ad=_0x566ca4['user'],_0x5a4f39=await profile[_0x31e1e1(0x12c)]({'email':_0xccc3ad[_0x31e1e1(0x16f)]}),_0x52c7c0=await master_shop['find']();console[_0x31e1e1(0x103)](_0x31e1e1(0x175),_0x52c7c0);const _0x5246e3=_0x566ca4[_0x31e1e1(0xf9)]['id'],_0x1835ef=await purchases['findById'](_0x5246e3);console['log'](_0x1835ef);const _0x375968=await suppliers[_0x31e1e1(0x12c)]({'name':_0x1835ef[_0x31e1e1(0x128)]});console[_0x31e1e1(0x103)](_0x375968);if(_0x52c7c0[0x0][_0x31e1e1(0x76)]==_0x31e1e1(0x159)){var _0x199fad=users[_0x31e1e1(0xfd)];console[_0x31e1e1(0x103)](_0x199fad);}else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]==_0x31e1e1(0x8a))var _0x199fad=users[_0x31e1e1(0x8a)];else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]==_0x31e1e1(0xf0))var _0x199fad=users[_0x31e1e1(0xf0)];else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]=='Spanish')var _0x199fad=users[_0x31e1e1(0x99)];else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]=='French')var _0x199fad=users[_0x31e1e1(0xef)];else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]==_0x31e1e1(0x186))var _0x199fad=users[_0x31e1e1(0x134)];else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]==_0x31e1e1(0x15a))var _0x199fad=users['Chinese'];else{if(_0x52c7c0[0x0][_0x31e1e1(0x76)]=='Arabic\x20(ae)')var _0x199fad=users[_0x31e1e1(0x157)];}}}}}}}_0xe2827e['render']('purchase_invoice',{'success':_0x566ca4['flash']('success'),'errors':_0x566ca4['flash'](_0x31e1e1(0x70)),'role':_0xccc3ad,'profile':_0x5a4f39,'master_shop':_0x52c7c0,'supplier':_0x375968,'purchase':_0x1835ef,'language':_0x199fad});}catch(_0x26dca4){console['log'](_0x26dca4);}}),router[a0_0x1d9df1(0x98)](a0_0x1d9df1(0x6e),auth,async(_0x2f8582,_0x15a3bd)=>{var _0x5dc35a=a0_0x1d9df1;try{const {username:_0x4504d5,email:_0x49b66e,role:_0x219f71}=_0x2f8582[_0x5dc35a(0x9e)],_0x22b18f=_0x2f8582['user'],_0x36995f=await profile[_0x5dc35a(0x12c)]({'email':_0x22b18f[_0x5dc35a(0x16f)]}),_0x4006f0=await master_shop['find']();console[_0x5dc35a(0x103)]('master',_0x4006f0);const _0x16201d=_0x2f8582[_0x5dc35a(0xf9)]['id'];console['log'](_0x16201d);const _0x3e677a=await purchases[_0x5dc35a(0xa1)](_0x16201d);console[_0x5dc35a(0x103)]('user_id',_0x3e677a);const _0xd3df6f=await product['find']({}),_0x285348=await warehouse['aggregate']([{'$match':{'name':_0x3e677a[_0x5dc35a(0x170)],'room':_0x3e677a[_0x5dc35a(0x67)],'warehouse_category':_0x5dc35a(0x82)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5dc35a(0xce),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5dc35a(0xf3)},'bay':{'$first':_0x5dc35a(0xea)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5dc35a(0x116)},'primary_code':{'$first':_0x5dc35a(0x11e)},'secondary_code':{'$first':_0x5dc35a(0x166)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5dc35a(0x12a)},'rack':{'$first':_0x5dc35a(0x16e)}}}]);warehouse_data=await warehouse[_0x5dc35a(0x15f)]([{'$match':{'status':_0x5dc35a(0xc5),'name':_0x5dc35a(0x78),'warehouse_category':_0x5dc35a(0x82)}},{'$group':{'_id':_0x5dc35a(0xca),'name':{'$first':_0x5dc35a(0xca)}}},{'$sort':{'name':0x1}}]),console['log'](_0x5dc35a(0x115),_0x285348);if(_0x4006f0[0x0][_0x5dc35a(0x76)]==_0x5dc35a(0x159)){var _0x3ea60e=users[_0x5dc35a(0xfd)];console[_0x5dc35a(0x103)](_0x3ea60e);}else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]==_0x5dc35a(0x8a))var _0x3ea60e=users['Hindi'];else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]==_0x5dc35a(0xf0))var _0x3ea60e=users[_0x5dc35a(0xf0)];else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]==_0x5dc35a(0x99))var _0x3ea60e=users[_0x5dc35a(0x99)];else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]==_0x5dc35a(0xef))var _0x3ea60e=users['French'];else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]=='Portuguese\x20(BR)')var _0x3ea60e=users[_0x5dc35a(0x134)];else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]==_0x5dc35a(0x15a))var _0x3ea60e=users[_0x5dc35a(0x15a)];else{if(_0x4006f0[0x0][_0x5dc35a(0x76)]=='Arabic\x20(ae)')var _0x3ea60e=users[_0x5dc35a(0x157)];}}}}}}}_0x15a3bd[_0x5dc35a(0x167)](_0x5dc35a(0xbb),{'success':_0x2f8582[_0x5dc35a(0x17c)](_0x5dc35a(0x174)),'errors':_0x2f8582[_0x5dc35a(0x17c)](_0x5dc35a(0x70)),'role':_0x22b18f,'profile':_0x36995f,'user':_0x3e677a,'stock':_0x285348,'master_shop':_0x4006f0,'product':_0xd3df6f,'language':_0x3ea60e,'warehouse':warehouse_data});}catch(_0x45c8d7){console[_0x5dc35a(0x103)](_0x45c8d7);}}),router['post'](a0_0x1d9df1(0x6e),auth,async(_0x4dfceb,_0x443bc8)=>{var _0x5c2ada=a0_0x1d9df1;try{const {invoice:_0x3bb26d,date:_0x1f1c6d,warehouse_name:_0xdb67da,Room_name:_0x3e954d,product_name:_0x5f15ab,purchase_quantity:_0x54a6d1,stocks:_0x1a23e3,return_qty:_0x2116e5,note:_0x45966a,level:_0x4c4e53,isle:_0x3317be,pallet:_0x2a9a58,to_warehouse_name:_0x2ab4d6,to_Room_name:_0x56c000}=_0x4dfceb[_0x5c2ada(0x110)],_0x56339b=await purchases[_0x5c2ada(0x12c)]({'_id':_0x4dfceb[_0x5c2ada(0xf9)]['id']}),_0x3f17c3=await warehouse[_0x5c2ada(0x12c)]({'name':_0xdb67da,'room':_0x3e954d});if(typeof _0x5f15ab==_0x5c2ada(0xdf))var _0x15da76=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x114)]],_0x441bc6=[_0x4dfceb['body']['purchase_quantity']],_0x31ac3a=[_0x4dfceb[_0x5c2ada(0x110)]['stocks']],_0x233fe8=[_0x4dfceb['body'][_0x5c2ada(0x71)]],_0x40944c=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x11c)]],_0x4fff04=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0xcc)]],_0x2638d3=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x8c)]],_0x4104ff=[_0x4dfceb['body'][_0x5c2ada(0x83)]],_0x3a669b=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x155)]],_0x57bf1e=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x7c)]],_0x42437e=[_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x147)]];else var _0x15da76=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x114)]],_0x441bc6=[..._0x4dfceb[_0x5c2ada(0x110)]['purchase_quantity']],_0x31ac3a=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x94)]],_0x233fe8=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x71)]],_0x40944c=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x11c)]],_0x4fff04=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0xcc)]],_0x2638d3=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x8c)]],_0x4104ff=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x83)]],_0x3a669b=[..._0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x155)]],_0x57bf1e=[..._0x4dfceb[_0x5c2ada(0x110)]['primary_code_hide']],_0x42437e=[..._0x4dfceb['body'][_0x5c2ada(0x147)]];const _0x424293=_0x15da76[_0x5c2ada(0xc6)](_0x2c98c0=>{return _0x2c98c0={'product_name':_0x2c98c0};});_0x441bc6[_0x5c2ada(0x150)]((_0x1c3d45,_0x461d5a)=>{var _0x4359ca=_0x5c2ada;_0x424293[_0x461d5a][_0x4359ca(0xd0)]=_0x1c3d45;}),_0x31ac3a[_0x5c2ada(0x150)]((_0x5a7902,_0x2b162b)=>{var _0x5781f9=_0x5c2ada;_0x424293[_0x2b162b][_0x5781f9(0xec)]=_0x5a7902;}),_0x233fe8[_0x5c2ada(0x150)]((_0x4b88bf,_0x5614a3)=>{var _0x78a0b7=_0x5c2ada;_0x424293[_0x5614a3][_0x78a0b7(0x71)]=_0x4b88bf;}),_0x40944c[_0x5c2ada(0x150)]((_0x2acb04,_0x4da8b1)=>{var _0x548f50=_0x5c2ada;_0x424293[_0x4da8b1][_0x548f50(0x17f)]=_0x2acb04;}),_0x4fff04[_0x5c2ada(0x150)]((_0x37ed10,_0x2a108f)=>{_0x424293[_0x2a108f]['bin']=_0x37ed10;}),_0x2638d3['forEach']((_0x5f0032,_0x259a1f)=>{var _0x44875b=_0x5c2ada;_0x424293[_0x259a1f][_0x44875b(0xf2)]=_0x5f0032;}),_0x4104ff['forEach']((_0x27fe89,_0x4cb21c)=>{var _0x12c738=_0x5c2ada;_0x424293[_0x4cb21c][_0x12c738(0xc4)]=_0x27fe89;}),_0x3a669b['forEach']((_0x4a10ff,_0xd80262)=>{_0x424293[_0xd80262]['product_code']=_0x4a10ff;}),_0x57bf1e[_0x5c2ada(0x150)]((_0x27f5a6,_0x36e776)=>{var _0x1aa256=_0x5c2ada;_0x424293[_0x36e776][_0x1aa256(0xc8)]=_0x27f5a6;}),_0x42437e[_0x5c2ada(0x150)]((_0x4abe19,_0x573fab)=>{var _0xdebf5f=_0x5c2ada;_0x424293[_0x573fab][_0xdebf5f(0xe8)]=_0x4abe19;}),_0x56339b[_0x5c2ada(0xd5)][_0x5c2ada(0x150)](_0x20d56d=>{var _0x377cf0=_0x5c2ada;const _0xdfd6d0=_0x3f17c3['product_details'][_0x377cf0(0xc6)](_0x5f052c=>{var _0x3ebf05=_0x377cf0;_0x5f052c[_0x3ebf05(0x114)]==_0x20d56d[_0x3ebf05(0x114)]&&_0x5f052c[_0x3ebf05(0xf2)]==_0x20d56d[_0x3ebf05(0xf2)]&&_0x5f052c[_0x3ebf05(0xc4)]==_0x20d56d['type']&&_0x5f052c['bin']==_0x20d56d['bin']&&_0x5f052c[_0x3ebf05(0x17f)]==_0x20d56d['bay']&&_0x5f052c[_0x3ebf05(0x119)]==_0x20d56d[_0x3ebf05(0x119)]&&_0x5f052c[_0x3ebf05(0x6a)]==_0x20d56d['storage']&&(console[_0x3ebf05(0x103)](parseInt(_0x5f052c[_0x3ebf05(0xd8)])+_0x3ebf05(0xd6)+parseInt(_0x20d56d['quantity'])),_0x5f052c[_0x3ebf05(0xd8)]=parseInt(_0x5f052c[_0x3ebf05(0xd8)])+parseInt(_0x20d56d[_0x3ebf05(0x146)]));});}),await _0x3f17c3['save']();const _0x5ddd6c=_0x424293[_0x5c2ada(0x109)](_0x3c3cfb=>_0x3c3cfb['return_qty']!=='0'&&_0x3c3cfb[_0x5c2ada(0x71)]!=='');var _0x1e4eea=0x0;_0x5ddd6c['forEach'](_0x9d5c62=>{var _0x1bb0cd=_0x5c2ada;console[_0x1bb0cd(0x103)]('foreach\x20newproduct',_0x9d5c62),(parseInt(_0x9d5c62[_0x1bb0cd(0xd0)])<parseInt(_0x9d5c62[_0x1bb0cd(0x71)])||parseInt(_0x9d5c62[_0x1bb0cd(0xec)])<parseInt(_0x9d5c62[_0x1bb0cd(0x71)]))&&_0x1e4eea++;});if(_0x1e4eea!=0x0)return _0x4dfceb['flash'](_0x5c2ada(0x70),_0x5c2ada(0xd2)),_0x443bc8[_0x5c2ada(0x163)](_0x5c2ada(0x177));const _0x588a86=new purchases_return({'invoice':_0x3bb26d,'suppliers':_0x4dfceb['body'][_0x5c2ada(0x128)],'date':_0x1f1c6d,'warehouse_name':_0xdb67da,'return_product':_0x5ddd6c,'note':_0x45966a,'room':_0x3e954d,'to_warehouse_name':_0x2ab4d6,'to_room':_0x56c000}),_0x3d80a6=await _0x588a86[_0x5c2ada(0x7f)]();console['log'](_0x588a86);const _0x132fbe=await purchases_return[_0x5c2ada(0x12c)]({'invoice':_0x3bb26d}),_0x22a470=await warehouse['findOne']({'name':_0x2ab4d6,'room':_0x56c000});_0x132fbe['return_product']['forEach'](_0x2cee1c=>{var _0x5eaacb=_0x5c2ada,_0x358f0f=0x0;const _0x3d7b2b=_0x22a470['product_details'][_0x5eaacb(0xc6)](_0x674707=>{var _0x5cc007=_0x5eaacb;_0x674707[_0x5cc007(0x114)]==_0x2cee1c[_0x5cc007(0x114)]&&_0x674707['floorlevel']==_0x2cee1c[_0x5cc007(0xf2)]&&_0x674707[_0x5cc007(0xc4)]==_0x2cee1c[_0x5cc007(0xc4)]&&_0x674707[_0x5cc007(0xd1)]==_0x2cee1c[_0x5cc007(0xd1)]&&_0x674707[_0x5cc007(0x17f)]==_0x2cee1c[_0x5cc007(0x17f)]&&(_0x674707[_0x5cc007(0xd8)]=parseInt(_0x674707[_0x5cc007(0xd8)])-parseInt(_0x2cee1c[_0x5cc007(0x71)]),_0x358f0f++);});_0x358f0f=='0'&&(_0x22a470[_0x5eaacb(0x12f)]=_0x22a470[_0x5eaacb(0x12f)]['concat']({'product_name':_0x2cee1c[_0x5eaacb(0x114)],'product_stock':_0x2cee1c[_0x5eaacb(0x71)],'primary_code':_0x2cee1c[_0x5eaacb(0xc8)],'secondary_code':_0x2cee1c[_0x5eaacb(0xe8)],'product_code':_0x2cee1c[_0x5eaacb(0x117)],'storage':_0x2cee1c[_0x5eaacb(0x6a)],'rack':_0x2cee1c[_0x5eaacb(0x119)],'bay':_0x2cee1c[_0x5eaacb(0x17f)],'bin':_0x2cee1c[_0x5eaacb(0xd1)],'type':_0x2cee1c[_0x5eaacb(0xc4)],'floorlevel':_0x2cee1c[_0x5eaacb(0xf2)],'maxProducts':_0x2cee1c[_0x5eaacb(0x104)],'unit':_0x2cee1c[_0x5eaacb(0x172)],'secondary_unit':_0x2cee1c[_0x5eaacb(0xb4)],'expiry_date':_0x2cee1c[_0x5eaacb(0x10c)]}));}),await _0x22a470[_0x5c2ada(0x7f)]();const _0x2ff650=await purchases['findOne']({'invoice':_0x3bb26d});_0x2ff650[_0x5c2ada(0xcb)]=_0x5c2ada(0x123);const _0x3bdb29=await _0x2ff650[_0x5c2ada(0x7f)](),_0x256312=new s_payment_data({'invoice':_0x3bb26d,'suppliers':_0x4dfceb[_0x5c2ada(0x110)][_0x5c2ada(0x128)],'reason':_0x5c2ada(0x140)});await _0x256312[_0x5c2ada(0x7f)]();const _0x5bd361=await master_shop[_0x5c2ada(0x80)]();console[_0x5c2ada(0x103)](_0x5c2ada(0xd3),_0x5bd361[0x0][_0x5c2ada(0x13f)]);const _0x2ff634=await email_settings[_0x5c2ada(0x12c)](),_0x814496=await suppliers[_0x5c2ada(0x12c)]({'name':_0x4dfceb[_0x5c2ada(0x110)]['suppliers']});console[_0x5c2ada(0x103)](_0x5c2ada(0xb2),_0x814496);_0x5bd361[0x0]['currency_placement']==0x1?(right_currency=_0x5bd361[0x0][_0x5c2ada(0x7d)],left_currency=''):(right_currency='',left_currency=_0x5bd361[0x0]['currency']);var _0x340ca0=_0x15da76,_0x5bec64=_0x233fe8,_0x52f490='',_0x54d0f9;for(_0x54d0f9 in _0x340ca0){_0x52f490+=_0x5c2ada(0xcd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x340ca0[_0x54d0f9]+_0x5c2ada(0xb7)+_0x5c2ada(0x9f)+_0x5bec64[_0x54d0f9]+_0x5c2ada(0xb7)+_0x5c2ada(0x151);}console['log'](_0x5c2ada(0x7b),_0x52f490);let _0x1433b5=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x2ff634['email'],'pass':_0x2ff634[_0x5c2ada(0x122)]}}),_0x381b49={'from':_0x2ff634[_0x5c2ada(0x16f)],'to':_0x814496[_0x5c2ada(0x16f)],'subject':_0x5c2ada(0xc1),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5c2ada(0xa9)+_0x5c2ada(0x182)+_0x5bd361[0x0][_0x5c2ada(0x13f)],'cid':'logo'}],'html':_0x5c2ada(0x13d)+_0x5c2ada(0x10f)+_0x5c2ada(0x15b)+_0x5c2ada(0x91)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5c2ada(0x91)+_0x5c2ada(0xc9)+_0x5c2ada(0x137)+_0x5c2ada(0x91)+'<h2>\x20'+_0x5bd361[0x0][_0x5c2ada(0x75)]+_0x5c2ada(0x79)+'</div>'+_0x5c2ada(0x137)+'<hr\x20class=\x22my-3\x22>'+_0x5c2ada(0x91)+_0x5c2ada(0x15d)+_0x5c2ada(0xa8)+_0x3bb26d+'\x20'+_0x5c2ada(0x153)+_0x5c2ada(0xb3)+_0x1f1c6d+'\x20'+'</span>'+_0x5c2ada(0x16c)+_0x5c2ada(0x137)+_0x5c2ada(0x111)+_0x5c2ada(0x11b)+_0x5c2ada(0xcd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5c2ada(0xe4)+_0x5c2ada(0x102)+_0x5c2ada(0xf1)+_0x5c2ada(0x151)+'</thead>'+_0x5c2ada(0x14d)+'\x20'+_0x52f490+'\x20'+_0x5c2ada(0x17e)+_0x5c2ada(0x16b)+'<div>'+_0x5c2ada(0xeb)+'<h5>'+_0x5bd361[0x0]['site_title']+'</h5>'+_0x5c2ada(0x137)+'</div>'+'</body></html>'};_0x1433b5['sendMail'](_0x381b49,function(_0x1dc54e,_0x1d87b2){var _0x309fb5=_0x5c2ada;_0x1dc54e?(console[_0x309fb5(0x103)](_0x1dc54e),console[_0x309fb5(0x103)](_0x309fb5(0xe0))):console[_0x309fb5(0x103)]('Email\x20sent\x20successfully');}),_0x4dfceb['flash'](_0x5c2ada(0x174),_0x5c2ada(0xa5)),_0x443bc8['redirect']('/all_purchases/view');}catch(_0x3c8e05){console['log'](_0x3c8e05),_0x443bc8['status'](0xc8)[_0x5c2ada(0x143)]({'message':_0x3c8e05[_0x5c2ada(0xab)]});}}),router[a0_0x1d9df1(0x98)]('/barcode/:id',auth,async(_0x49e833,_0x30cc67)=>{var _0x4d6533=a0_0x1d9df1;try{const {username:_0x118f37,email:_0x226954,role:_0x3830e5}=_0x49e833['user'],_0x53c065=_0x49e833[_0x4d6533(0x9e)],_0xf64e7c=await profile[_0x4d6533(0x12c)]({'email':_0x53c065[_0x4d6533(0x16f)]}),_0x10e443=await master_shop[_0x4d6533(0x80)](),_0x2104e9=_0x49e833[_0x4d6533(0xf9)]['id'],_0x203aec=await purchases['findById'](_0x2104e9);if(_0x10e443[0x0]['language']==_0x4d6533(0x159))var _0x24259e=users[_0x4d6533(0xfd)];else{if(_0x10e443[0x0][_0x4d6533(0x76)]=='Hindi')var _0x24259e=users[_0x4d6533(0x8a)];else{if(_0x10e443[0x0][_0x4d6533(0x76)]==_0x4d6533(0xf0))var _0x24259e=users['German'];else{if(_0x10e443[0x0][_0x4d6533(0x76)]==_0x4d6533(0x99))var _0x24259e=users[_0x4d6533(0x99)];else{if(_0x10e443[0x0][_0x4d6533(0x76)]==_0x4d6533(0xef))var _0x24259e=users['French'];else{if(_0x10e443[0x0][_0x4d6533(0x76)]==_0x4d6533(0x186))var _0x24259e=users[_0x4d6533(0x134)];else{if(_0x10e443[0x0][_0x4d6533(0x76)]==_0x4d6533(0x15a))var _0x24259e=users[_0x4d6533(0x15a)];else{if(_0x10e443[0x0][_0x4d6533(0x76)]==_0x4d6533(0xae))var _0x24259e=users[_0x4d6533(0x157)];}}}}}}}_0x30cc67[_0x4d6533(0x167)]('all_purchases_barcode',{'success':_0x49e833[_0x4d6533(0x17c)]('success'),'errors':_0x49e833['flash'](_0x4d6533(0x70)),'role':_0x53c065,'profile':_0xf64e7c,'alldata':_0x203aec,'master_shop':_0x10e443,'language':_0x24259e}),console[_0x4d6533(0x103)](alldata);}catch(_0x1ff1ae){console[_0x4d6533(0x103)](_0x1ff1ae);}}),router[a0_0x1d9df1(0x138)](a0_0x1d9df1(0x10d),async(_0x7b605a,_0x1e4899)=>{var _0x3b2d4a=a0_0x1d9df1;const {product_code:_0x32887e}=_0x7b605a['body'];var _0x35ad6b;const _0x334c27=await product[_0x3b2d4a(0x15f)]([{'$match':{'primary_code':_0x32887e,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x3b2d4a(0xca)},'category':{'$first':_0x3b2d4a(0x173)},'brand':{'$first':_0x3b2d4a(0xe3)},'unit':{'$first':_0x3b2d4a(0x17d)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3b2d4a(0x6d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3b2d4a(0x120)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3b2d4a(0x8b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x872305=await product['aggregate']([{'$match':{'secondary_code':_0x32887e,'product_category':_0x3b2d4a(0x82)}},{'$group':{'_id':'$_id','name':{'$first':_0x3b2d4a(0xca)},'category':{'$first':_0x3b2d4a(0x173)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3b2d4a(0x17d)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3b2d4a(0x97)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3b2d4a(0x6d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3b2d4a(0x120)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3b2d4a(0x8b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x334c27[_0x3b2d4a(0x129)]>0x0)_0x35ad6b=_0x334c27;else _0x872305[_0x3b2d4a(0x129)]>0x0&&(_0x35ad6b=_0x872305);_0x1e4899['json'](_0x35ad6b);}),router[a0_0x1d9df1(0x138)](a0_0x1d9df1(0x85),async(_0x163204,_0x248415)=>{var _0x58fb12=a0_0x1d9df1;const {primaryCode:_0x56a1f7,secondaryCode:_0x58037f,productCode:_0x128b26,bay:_0x27a892,bin:_0x2c124f,types:_0x8e39a1,pallet:_0x2883c5,warehouses:_0x5d9cdb,room:_0x477036}=_0x163204[_0x58fb12(0x110)];console[_0x58fb12(0x103)](_0x163204['body']);try{const _0x4cf542=await warehouse[_0x58fb12(0x15f)]([{'$match':{'name':_0x5d9cdb,'room':_0x477036}},{'$unwind':_0x58fb12(0x100)},{'$match':{'product_details.bay':_0x27a892,'product_details.bin':_0x2c124f,'product_details.type':_0x8e39a1}},{'$group':{'_id':_0x58fb12(0xce),'name':{'$first':_0x58fb12(0x185)},'product_stock':{'$first':_0x58fb12(0xf3)},'level':{'$first':_0x58fb12(0x169)},'isle':{'$first':_0x58fb12(0xb9)},'pallet':{'$first':_0x58fb12(0xda)},'maxProducts':{'$first':_0x58fb12(0xc0)}}}]);_0x248415[_0x58fb12(0x144)](0xc8)['json'](_0x4cf542);}catch(_0x495da2){_0x248415[_0x58fb12(0x144)](0x194)['json']({'message':_0x495da2[_0x58fb12(0xab)]});}}),module[a0_0x1d9df1(0x9c)]=router;