var a0_0x5366ad=a0_0x1dcd;function a0_0x1dcd(_0x50cc6c,_0x355a66){var _0x3b3d5a=a0_0x3b3d();return a0_0x1dcd=function(_0x1dcdff,_0xb8c34f){_0x1dcdff=_0x1dcdff-0x1c0;var _0x3f1ede=_0x3b3d5a[_0x1dcdff];return _0x3f1ede;},a0_0x1dcd(_0x50cc6c,_0x355a66);}(function(_0x2b4d24,_0x326319){var _0x4fc132=a0_0x1dcd,_0x1344c2=_0x2b4d24();while(!![]){try{var _0x14da28=parseInt(_0x4fc132(0x285))/0x1+parseInt(_0x4fc132(0x1d9))/0x2+parseInt(_0x4fc132(0x1dd))/0x3+-parseInt(_0x4fc132(0x20e))/0x4+parseInt(_0x4fc132(0x1c2))/0x5*(-parseInt(_0x4fc132(0x200))/0x6)+parseInt(_0x4fc132(0x2d0))/0x7+parseInt(_0x4fc132(0x27a))/0x8*(-parseInt(_0x4fc132(0x25b))/0x9);if(_0x14da28===_0x326319)break;else _0x1344c2['push'](_0x1344c2['shift']());}catch(_0x278204){_0x1344c2['push'](_0x1344c2['shift']());}}}(a0_0x3b3d,0x29bcf));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x5366ad(0x216)),auth=require(a0_0x5366ad(0x1db)),nodemailer=require(a0_0x5366ad(0x277));function a0_0x3b3d(){var _0x1520c4=['find','/view','prod_primunit','purchases\x20item\x20return\x20successfull','prod_secondunit','staff','</body></html>','user','$category','maxperunit','delivery_code','flash','warehouse','prod_invoice','DRY\x20STORAGE','$product','121010NkjAYA','/view/add_purchases','table\x20page','Rack\x20A','<h5>','An\x20error\x20occurred.','message','Portuguese\x20(BR)','return_product','prod_unit','room','params','currency','findOne','add_purchases','getDate','prod_cat','$product_details._id','<hr\x20class=\x22my-3\x22>','/../public','amount','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','123152UGLleV','quantity','../middleware/auth','name','660480MHcpdE','$product.bay','pallet','push','$alertquantity','$secondary_unit','stock_data','bay','product_name','prod_pallet','$room','purchase_invoice','log','Purchase\x20Return','secondary_code','aggregate','gmail','body','product_cat','master','payment\x20successfull','edit_purchases','maxStocks','$date','string','actual_uom','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.primary_code','$maxProdPerUnit','$product.bin','$product_code','/barcode_scanner','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','secondary_unit','primary_code','24FmftlK','$product_details.product_name','POnumber','map','password','status','$name','$product.floorlevel','production_date','Rack\x20F','English\x20(US)','return_data','$maxStocks','$suppliers_docs','473264iphmlC','catch','COLD\x20STORAGE','all_purchases_barcode','$warehouse_name','/view/add_purchases/:id','$due_amount','/CheckingWarehouse','../models/all_models','add\x20post','<html><head><title></title>','site_title','return_purchase','prod_level','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stocks','$product_details.type','$product_details.level','</td>','</head><body>','$product_details.secondary_code','$product_details.rack','here','<h5\x20style=\x22text-align:\x20left;\x22>','Level','$product_details.bay','Hindi','$product_details.expiry_date','</table>','level','Rack\x20D','rak','Raw\x20Materials','Shelves','/view/return_purchase/:id','$return_data','$brand','/all_purchases/view','$suppliers','batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','random','$product.room_name','getMonth','$expiry_date','Purchase\x20Mail','</tr>','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','RoomAssign','Sales\x20Update\x20successfully','\x20<>\x20','deliverycode','Rack\x20B','Spanish','toString','stock_quantity','user_id','max_product_unit','suppliers','json','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.floorlevel','save','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','purchase_quantity','room_name','</span>','French','<span\x20style=\x22float:\x20right;\x22>','floor','../public/language/languages.json','1622079IPucxu','$primary_code','MaxStocks_data','$paid_amount','return_qty','foreach\x20newproduct','$unit','product_code','Enabled','/all_purchases/view/','Chinese','filter','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','redirect','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','get','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','type','Email\x20sent\x20successfully','suppliers_docs','\x20Order\x20Number\x20:\x20','Ambient','role','Logo.png','Room_name','$note','nodemailer','exports','prod_code','8IZEkZB','then','INC-','$batch_code','types','all_purchases','product_code_hide','storage','product','English','$product_details.storage','55703fDQrQe','host','email','ejs','\x20</h2>','Arabic\x20(ae)','product_stock','$product_details.bin','finalize','rack','currency_placement','errors','standard_unit','add_purchases\x20error','/give_payment/:id','$product.quantity','$product_details.product_code','product_details','post','primary_code_hide','actual_qty','Return\x20Goods','render','bin','note','alertQTY','<table\x20style=\x22width:\x20100%\x20!important;\x22>','date','$product_details.pallet','Floor','warehouse_name','paid_amount','length','</h5>','/view/:id','\x20Order\x20Date\x20:\x20','$product_details.maxProducts','$product_details','forEach','<div>','/upload/','</tbody>','logo','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','prod_name','concat','$product_details.product_stock','/preview/:id','German','abs','prod_isle','$product.type','findById','$invoice','secondary_code_hide','Error\x20Occurs','True','prod_Qty','isle','path','RMSEmail','Purchase\x20Return\x20Mail','delivery_date','floorlevel','$_id','Receiving\x20Area','</thead>','sendMail','Arabic','image','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','success','createTransport','$secondary_code','invoice','1602125aQtonL','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<tr>','suppliers_data','/invoice/:id','<strong>\x20Regards\x20</strong>'];a0_0x3b3d=function(){return _0x1520c4;};return a0_0x3b3d();}var ejs=require(a0_0x5366ad(0x288));const path=require(a0_0x5366ad(0x2c0)),users=require(a0_0x5366ad(0x25a));router[a0_0x5366ad(0x26b)](a0_0x5366ad(0x2d8),auth,async(_0x135b41,_0xe3214b)=>{var _0x535715=a0_0x5366ad;try{const {username:_0x2e5598,email:_0x482c18,role:_0x2f10ad}=_0x135b41[_0x535715(0x2de)],_0x4f9a8f=_0x135b41[_0x535715(0x2de)],_0x38f969=await profile[_0x535715(0x1cf)]({'email':_0x4f9a8f[_0x535715(0x287)]}),_0x2d1a70=await staff[_0x535715(0x1cf)]({'email':_0x4f9a8f[_0x535715(0x287)]});if(_0x4f9a8f[_0x535715(0x273)]==_0x535715(0x2dc)){const _0x3a7dc6=await staff[_0x535715(0x1cf)]({'email':_0x4f9a8f['email']});}const _0x546985=await master_shop[_0x535715(0x2d7)]();let _0x559b82;if(_0x4f9a8f[_0x535715(0x273)]==_0x535715(0x2dc)){const _0x14845d=await staff['findOne']({'email':_0x4f9a8f[_0x535715(0x287)]});_0x559b82=await purchases[_0x535715(0x1ec)]([{'$match':{'warehouse_name':_0x14845d[_0x535715(0x2e3)]}},{'$lookup':{'from':'suppliers','localField':_0x535715(0x24c),'foreignField':_0x535715(0x1dc),'as':_0x535715(0x270)}},{'$unwind':_0x535715(0x20d)},{'$unwind':_0x535715(0x1c1)},{'$group':{'_id':_0x535715(0x2c5),'invoice':{'$first':_0x535715(0x2ba)},'suppliers':{'$first':_0x535715(0x235)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x535715(0x212)},'room':{'$first':_0x535715(0x1e7)},'product':{'$push':_0x535715(0x1c1)},'note':{'$first':_0x535715(0x276)},'paid_amount':{'$first':_0x535715(0x25e)},'due_amount':{'$first':_0x535715(0x214)},'return_data':{'$first':_0x535715(0x232)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x535715(0x20d)},'total_product_quantity':{'$sum':_0x535715(0x294)},'level':{'$addToSet':_0x535715(0x1de)},'isle':{'$addToSet':_0x535715(0x1fa)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x559b82=await purchases[_0x535715(0x1ec)]([{'$lookup':{'from':_0x535715(0x24c),'localField':'suppliers','foreignField':_0x535715(0x1dc),'as':'suppliers_docs'}},{'$unwind':_0x535715(0x20d)},{'$unwind':_0x535715(0x1c1)},{'$group':{'_id':'$_id','invoice':{'$first':_0x535715(0x2ba)},'suppliers':{'$first':_0x535715(0x235)},'date':{'$first':_0x535715(0x1f4)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x535715(0x23b)},'product':{'$push':_0x535715(0x1c1)},'note':{'$first':_0x535715(0x276)},'paid_amount':{'$first':_0x535715(0x25e)},'due_amount':{'$first':_0x535715(0x214)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x535715(0x27d)},'expiry_date':{'$first':_0x535715(0x23d)},'suppliers_docs':{'$first':_0x535715(0x20d)},'total_product_quantity':{'$sum':_0x535715(0x294)},'level':{'$addToSet':_0x535715(0x1de)},'isle':{'$addToSet':_0x535715(0x1fa)},'type':{'$addToSet':_0x535715(0x2b8)},'floorlevel':{'$addToSet':_0x535715(0x207)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x546985[0x0]['language']==_0x535715(0x20a)){var _0x4797b8=users[_0x535715(0x283)];console['log'](_0x4797b8);}else{if(_0x546985[0x0]['language']==_0x535715(0x229))var _0x4797b8=users[_0x535715(0x229)];else{if(_0x546985[0x0]['language']=='German')var _0x4797b8=users[_0x535715(0x2b5)];else{if(_0x546985[0x0]['language']==_0x535715(0x247))var _0x4797b8=users[_0x535715(0x247)];else{if(_0x546985[0x0]['language']==_0x535715(0x257))var _0x4797b8=users['French'];else{if(_0x546985[0x0][_0x535715(0x2d1)]==_0x535715(0x1c9))var _0x4797b8=users[_0x535715(0x24e)];else{if(_0x546985[0x0][_0x535715(0x2d1)]==_0x535715(0x265))var _0x4797b8=users[_0x535715(0x265)];else{if(_0x546985[0x0][_0x535715(0x2d1)]=='Arabic\x20(ae)')var _0x4797b8=users[_0x535715(0x2c9)];}}}}}}}_0xe3214b['render'](_0x535715(0x27f),{'success':_0x135b41[_0x535715(0x2e2)](_0x535715(0x2cc)),'errors':_0x135b41[_0x535715(0x2e2)](_0x535715(0x290)),'purchases':_0x559b82,'role':_0x4f9a8f,'profile':_0x38f969,'master_shop':_0x546985,'language':_0x4797b8});}catch(_0x31b9ca){console[_0x535715(0x1e9)](_0x535715(0x1c4),_0x31b9ca),_0xe3214b[_0x535715(0x205)](0xc8)[_0x535715(0x24d)]({'message':_0x31b9ca[_0x535715(0x1c8)]});}});function BayBinSelected(_0x131697,_0x5b2373){var _0x441636=a0_0x5366ad,_0x3ca340=[],_0x1d41a5=[],_0x31716d=[],_0x4f5616=[],_0x3e2ee6=[],_0x3aed32=[];let _0x8bb5ff=[];if(_0x131697==_0x441636(0x1c0))switch(_0x5b2373){case _0x441636(0x1c5):_0x3ca340=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1d41a5=[0x1,0x2],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=[_0x441636(0x227),_0x441636(0x2a2)],_0x3e2ee6=['D'],_0x3aed32=['A'];break;case _0x441636(0x246):_0x3ca340=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1d41a5=[0x1,0x2],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=[_0x441636(0x227),_0x441636(0x2a2)],_0x3e2ee6=['D'],_0x3aed32=['B'];break;case'Shelves':_0x3ca340=[0x0],_0x1d41a5=[0x0],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=[_0x441636(0x2a2)],_0x3e2ee6=['D'],_0x3aed32=['S'];break;case _0x441636(0x2c6):_0x3ca340=[0x0],_0x1d41a5=[0x0],_0x4f5616=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x31716d=['Floor'],_0x3e2ee6=['D'],_0x3aed32=['R'];break;}else{if(_0x131697==_0x441636(0x210))switch(_0x5b2373){case'Rack\x20A':_0x3ca340=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1d41a5=['B','F'],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=[_0x441636(0x227),'Floor'],_0x3e2ee6=['C'],_0x3aed32=['A'];break;case _0x441636(0x246):_0x3ca340=[0x5,0x4,0x3,0x2,0x1],_0x1d41a5=['F','B','S'],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=['Level',_0x441636(0x2a2)],_0x3e2ee6=['C'],_0x3aed32=['B'];break;case'Rack\x20C':_0x3ca340=[0x1,0x2,0x3,0x4,0x5],_0x1d41a5=['B','F','S'],_0x4f5616=[0x5,0x4,0x3,0x2,0x1],_0x31716d=['Level','Floor'],_0x3e2ee6=['C'],_0x3aed32=['C'];break;case _0x441636(0x22d):_0x3ca340=[0x5,0x4,0x3,0x2,0x1],_0x1d41a5=['F','B','S'],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=['Level',_0x441636(0x2a2)],_0x3e2ee6=['C'],_0x3aed32=['D'];break;case'Rack\x20E':_0x3ca340=[0x4,0x3,0x2,0x1],_0x1d41a5=[0x1,0x2],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=[_0x441636(0x227),'Floor'],_0x3e2ee6=['C'],_0x3aed32=['E'];break;case _0x441636(0x209):_0x3ca340=[0x1,0x2,0x3],_0x1d41a5=[0x1,0x2],_0x4f5616=[0x1,0x2,0x3,0x4,0x5],_0x31716d=['Level'],_0x3e2ee6=['C'],_0x3aed32=['F'];break;}}return{'levels':_0x3ca340,'Isle':_0x1d41a5,'rack':_0x4f5616,'type':_0x31716d,'storage':_0x3e2ee6,'rak':_0x3aed32};}async function getRandom8DigitNumber(){var _0x43996c=a0_0x5366ad;const _0x3b8c99=0x989680,_0x48941c=0x5f5e0ff,_0x49c080=Math[_0x43996c(0x259)](Math[_0x43996c(0x23a)]()*(_0x48941c-_0x3b8c99+0x1))+_0x3b8c99;var _0x47c5e7;const _0x27e8c1=await purchases['findOne']({'invoice':_0x43996c(0x27c)+_0x49c080});return _0x27e8c1&&_0x27e8c1[_0x43996c(0x2a5)]>0x0?_0x47c5e7='INC-'+_0x49c080:_0x47c5e7=_0x43996c(0x27c)+_0x49c080,_0x47c5e7;}router['get'](a0_0x5366ad(0x1c3),auth,async(_0x63331b,_0x3b0e70)=>{var _0x161836=a0_0x5366ad;try{const {username:_0x3647ee,email:_0x3121d9,role:_0x11dfb9}=_0x63331b[_0x161836(0x2de)],_0x4aa5fb=_0x63331b[_0x161836(0x2de)],_0x4bc33e=await profile[_0x161836(0x1cf)]({'email':_0x4aa5fb['email']}),_0x231c06=await master_shop[_0x161836(0x2d7)](),_0x1223d8=await staff[_0x161836(0x1cf)]({'email':_0x4aa5fb['email']}),_0x284b6e=await suppliers[_0x161836(0x2d7)]({});let _0x55898f;if(_0x4aa5fb[_0x161836(0x273)]==_0x161836(0x2dc)){const _0x37c7b4=await staff[_0x161836(0x1cf)]({'email':_0x4aa5fb[_0x161836(0x287)]});_0x55898f=await warehouse[_0x161836(0x1ec)]([{'$match':{'status':_0x161836(0x263),'name':_0x37c7b4[_0x161836(0x2e3)],'warehouse_category':_0x161836(0x22f),'name':{'$ne':_0x161836(0x29a)}}},{'$group':{'_id':'$name','name':{'$first':_0x161836(0x206)}}}]);}else _0x55898f=await warehouse['aggregate']([{'$match':{'status':_0x161836(0x263),'warehouse_category':_0x161836(0x22f),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x161836(0x206),'name':{'$first':_0x161836(0x206)}}}]);const _0x3239ca=await product['find']({}),_0xade08d=await warehouse[_0x161836(0x2d7)]({'status':_0x161836(0x263)}),_0x54c29f=await purchases['find']({}),_0x23c98d=_0x54c29f[_0x161836(0x2a5)]+0x1,_0x9b64eb=_0x161836(0x27c)+_0x23c98d[_0x161836(0x248)]()['padStart'](0x5,'0');var _0x4562e1=[_0x161836(0x272),'Enclosed'];if(_0x231c06[0x0]['language']==_0x161836(0x20a))var _0x122f75=users[_0x161836(0x283)];else{if(_0x231c06[0x0][_0x161836(0x2d1)]==_0x161836(0x229))var _0x122f75=users[_0x161836(0x229)];else{if(_0x231c06[0x0]['language']==_0x161836(0x2b5))var _0x122f75=users[_0x161836(0x2b5)];else{if(_0x231c06[0x0]['language']==_0x161836(0x247))var _0x122f75=users[_0x161836(0x247)];else{if(_0x231c06[0x0][_0x161836(0x2d1)]==_0x161836(0x257))var _0x122f75=users[_0x161836(0x257)];else{if(_0x231c06[0x0][_0x161836(0x2d1)]==_0x161836(0x1c9))var _0x122f75=users['Portuguese'];else{if(_0x231c06[0x0]['language']==_0x161836(0x265))var _0x122f75=users[_0x161836(0x265)];else{if(_0x231c06[0x0][_0x161836(0x2d1)]==_0x161836(0x28a))var _0x122f75=users[_0x161836(0x2c9)];}}}}}}}const _0x487b85=getRandom8DigitNumber();_0x487b85[_0x161836(0x27b)](_0x2a7730=>{var _0x3771f7=_0x161836;_0x3b0e70[_0x3771f7(0x29b)](_0x3771f7(0x1d0),{'success':_0x63331b[_0x3771f7(0x2e2)](_0x3771f7(0x2cc)),'errors':_0x63331b[_0x3771f7(0x2e2)]('errors'),'role':_0x4aa5fb,'profile':_0x4bc33e,'suppliers':_0x284b6e,'warehouse':_0x55898f,'product':_0x3239ca,'invoice':_0x2a7730,'master_shop':_0x231c06,'language':_0x122f75,'find_data':_0xade08d,'rooms_data':_0x4562e1});})[_0x161836(0x20f)](_0x5f3884=>{var _0x42b5b6=_0x161836;_0x63331b[_0x42b5b6(0x2e2)](_0x42b5b6(0x290),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3b0e70[_0x42b5b6(0x268)](_0x42b5b6(0x234));});}catch(_0x1aa4bf){console['log'](_0x1aa4bf);}}),router[a0_0x5366ad(0x26b)](a0_0x5366ad(0x213),auth,async(_0x3d88bb,_0x5e1504)=>{var _0x22078d=a0_0x5366ad;try{const _0x4142fd=_0x3d88bb[_0x22078d(0x1cd)]['id'];console[_0x22078d(0x1e9)](_0x4142fd);const _0x1cead8=await master_shop['find']();console[_0x22078d(0x1e9)](_0x22078d(0x1f0),_0x1cead8);const _0xad05d4=await product['findOne']({'name':_0x4142fd});console[_0x22078d(0x1e9)](_0x22078d(0x282),_0xad05d4),_0x5e1504['status'](0xc8)[_0x22078d(0x24d)]({'product_data':_0xad05d4,'master':_0x1cead8});}catch(_0x9d4112){console[_0x22078d(0x1e9)](_0x22078d(0x292),_0x9d4112);}}),router[a0_0x5366ad(0x297)]('/view/add_purchases',auth,async(_0x54d2dc,_0x2a2d5d)=>{var _0x1d3230=a0_0x5366ad;try{const {invoice:_0x366fcc,date:_0x46585b,warehouse_name:_0x1809cc,prod_name:_0x3707b1,prod_code:_0xf82e1e,prod_qty:_0xb28641,prod_unit:_0x1295b9,prod_secondunit:_0x30ed94,prod_level:_0x30392a,prod_isle:_0x3e9287,prod_pallet:_0x33de90,note:_0x5b8b11,expiry_date:_0x3b3943,batch_code:_0x1fc2f4,payable:_0x5195fe,due_amount:_0x44644f,Room_name:_0x92502a,primary_code:_0x5e9923,secondary_code:_0x161f70,MaxStocks_data:_0x5e3123,PO_number:_0x2f45d1,SCRN:_0x32a2dd,JO_number:_0x2b83b2}=_0x54d2dc[_0x1d3230(0x1ee)];if(typeof _0x3707b1==_0x1d3230(0x1f5))var _0x5652eb=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x2b1)]],_0x888c71=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x279)]],_0x1e4c61=[_0x54d2dc['body']['prod_Qty']],_0x5cad01=[_0x54d2dc[_0x1d3230(0x1ee)]['prod_primunit']],_0x4c6551=[_0x54d2dc[_0x1d3230(0x1ee)]['prod_secondunit']],_0x3e59cf=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x21b)]],_0x5bf699=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1ff)]],_0x21548e=[_0x54d2dc[_0x1d3230(0x1ee)]['secondary_code']],_0x3a1ad4=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x25d)]],_0x504846=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x236)]],_0x5bc865=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1d7)]],_0x1cd797=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x24b)]],_0x5cecf7=[_0x54d2dc[_0x1d3230(0x1ee)]['alertQTY']],_0x13c4f0=[_0x54d2dc[_0x1d3230(0x1ee)]['production_date']],_0x429d4a=[_0x54d2dc[_0x1d3230(0x1ee)]['prod_cat']],_0x2afd12=[_0x54d2dc['body']['RoomAssign']],_0x125c31=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x245)]],_0x324cf5=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x2e4)]],_0x153a1d=[_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x299)]],_0x4a8156=[_0x54d2dc['body'][_0x1d3230(0x1f6)]];else var _0x5652eb=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x2b1)]],_0x888c71=[..._0x54d2dc['body'][_0x1d3230(0x279)]],_0x1e4c61=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x2be)]],_0x5cad01=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x2d9)]],_0x4c6551=[..._0x54d2dc[_0x1d3230(0x1ee)]['prod_secondunit']],_0x3e59cf=[..._0x54d2dc['body'][_0x1d3230(0x21b)]],_0x5bf699=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1ff)]],_0x21548e=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1eb)]],_0x3a1ad4=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x25d)]],_0x504846=[..._0x54d2dc['body'][_0x1d3230(0x236)]],_0x5bc865=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1d7)]],_0x1cd797=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x24b)]],_0x5cecf7=[..._0x54d2dc[_0x1d3230(0x1ee)]['alertQTY']],_0x13c4f0=[..._0x54d2dc['body'][_0x1d3230(0x208)]],_0x429d4a=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1d2)]],_0x2afd12=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x242)]],_0x125c31=[..._0x54d2dc['body']['deliverycode']],_0x324cf5=[..._0x54d2dc['body'][_0x1d3230(0x2e4)]],_0x153a1d=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x299)]],_0x4a8156=[..._0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x1f6)]];const _0x14534a=_0x5652eb[_0x1d3230(0x203)](_0x18a627=>{return _0x18a627={'product_name':_0x18a627};});_0x153a1d['forEach']((_0x5bb163,_0x47749b)=>{var _0x1cb15f=_0x1d3230;_0x14534a[_0x47749b][_0x1cb15f(0x299)]=Math['abs'](_0x5bb163);}),_0x4a8156[_0x1d3230(0x2ab)]((_0x427070,_0x300cb2)=>{var _0x4bc122=_0x1d3230;_0x14534a[_0x300cb2][_0x4bc122(0x1f6)]=_0x427070;}),_0x888c71['forEach']((_0xe99976,_0x109280)=>{var _0x1e5eec=_0x1d3230;_0x14534a[_0x109280][_0x1e5eec(0x262)]=_0xe99976;}),_0x1e4c61[_0x1d3230(0x2ab)]((_0x4412ec,_0x458082)=>{_0x14534a[_0x458082]['quantity']=Math['abs'](_0x4412ec);}),_0x5cad01[_0x1d3230(0x2ab)]((_0x16ca37,_0x5f31f)=>{_0x14534a[_0x5f31f]['standard_unit']=_0x16ca37;}),_0x4c6551['forEach']((_0x53b388,_0x5109cb)=>{var _0x5b1c60=_0x1d3230;_0x14534a[_0x5109cb][_0x5b1c60(0x1fe)]=_0x53b388;}),_0x3e59cf['forEach']((_0x46c579,_0x338011)=>{var _0xaf15e5=_0x1d3230;_0x2afd12[_0xaf15e5(0x2ab)]((_0x17daa4,_0x2bf0fa)=>{var _0x5d5878=_0xaf15e5;if(_0x17daa4==_0x5d5878(0x2c6)&&_0x338011==_0x2bf0fa){console[_0x5d5878(0x1e9)](_0x17daa4+'\x20<\x20wew\x20>\x20'+_0x338011+_0x5d5878(0x244)+_0x2bf0fa+_0x5d5878(0x244)+_0x46c579);var _0x4481e0=_0x46c579[_0x5d5878(0x21c)](0x3);_0x14534a[_0x338011][_0x5d5878(0x281)]=_0x46c579[0x0],_0x14534a[_0x338011][_0x5d5878(0x28e)]=_0x46c579[0x1],_0x14534a[_0x338011][_0x5d5878(0x1e4)]=0x0,_0x14534a[_0x338011][_0x5d5878(0x29c)]=0x0,_0x14534a[_0x338011]['type']=_0x5d5878(0x2a2),_0x14534a[_0x338011][_0x5d5878(0x2c4)]=_0x4481e0;}else{if(_0x17daa4==_0x5d5878(0x230)&&_0x338011==_0x2bf0fa){var _0x4481e0=_0x46c579[_0x5d5878(0x21c)](0x3);_0x14534a[_0x338011][_0x5d5878(0x281)]=_0x46c579[0x0],_0x14534a[_0x338011][_0x5d5878(0x28e)]=_0x46c579[0x1],_0x14534a[_0x338011][_0x5d5878(0x1e4)]=0x0,_0x14534a[_0x338011][_0x5d5878(0x29c)]=0x0,_0x14534a[_0x338011][_0x5d5878(0x26e)]='Floor',_0x14534a[_0x338011][_0x5d5878(0x2c4)]=_0x46c579[0x5];}else{if(_0x338011==_0x2bf0fa){if(_0x46c579[0x0]=='A'&&_0x46c579[0x1]=='L'&&_0x46c579[0x2]=='L')console[_0x5d5878(0x1e9)](_0x17daa4+_0x5d5878(0x244)+_0x338011+'\x20<>\x20'+_0x2bf0fa+'\x20<>\x20'+_0x46c579+_0x5d5878(0x225)),_0x14534a[_0x338011][_0x5d5878(0x281)]=_0x46c579[0x0],_0x14534a[_0x338011][_0x5d5878(0x28e)]=_0x46c579[0x1],_0x14534a[_0x338011][_0x5d5878(0x1e4)]=0x0,_0x14534a[_0x338011][_0x5d5878(0x29c)]=0x0,_0x14534a[_0x338011][_0x5d5878(0x26e)]=_0x5d5878(0x2a2),_0x14534a[_0x338011][_0x5d5878(0x2c4)]=_0x46c579[0x3];else{var _0x450c16;if(_0x46c579[0x4]=='L')_0x450c16='Level';else _0x46c579[0x4]=='F'&&(_0x450c16='Floor');_0x14534a[_0x338011][_0x5d5878(0x281)]=_0x46c579[0x0],_0x14534a[_0x338011][_0x5d5878(0x28e)]=_0x46c579[0x1],_0x14534a[_0x338011][_0x5d5878(0x1e4)]=_0x46c579[0x2],_0x14534a[_0x338011][_0x5d5878(0x29c)]=_0x46c579[0x3],_0x14534a[_0x338011][_0x5d5878(0x26e)]=_0x450c16,_0x14534a[_0x338011][_0x5d5878(0x2c4)]=_0x46c579[0x5];}}}}});}),_0x5bf699[_0x1d3230(0x2ab)]((_0x371eec,_0x1b67d1)=>{var _0x4535d3=_0x1d3230;_0x14534a[_0x1b67d1][_0x4535d3(0x1ff)]=_0x371eec;}),_0x21548e[_0x1d3230(0x2ab)]((_0x39e83a,_0x38a809)=>{_0x14534a[_0x38a809]['secondary_code']=_0x39e83a;}),_0x3a1ad4['forEach']((_0x937a32,_0x5457c0)=>{var _0x4fba5e=_0x1d3230;_0x14534a[_0x5457c0][_0x4fba5e(0x1f3)]=_0x937a32;}),_0x504846['forEach']((_0x565e1d,_0x54a1de)=>{var _0x51eb14=_0x1d3230;_0x14534a[_0x54a1de][_0x51eb14(0x236)]=_0x565e1d;}),_0x5bc865['forEach']((_0x53fd2c,_0x2dcf19)=>{var _0x5b3323=_0x1d3230;_0x14534a[_0x2dcf19][_0x5b3323(0x1d7)]=_0x53fd2c;}),_0x1cd797[_0x1d3230(0x2ab)]((_0x51b09e,_0x1f942a)=>{var _0x5610be=_0x1d3230;_0x14534a[_0x1f942a][_0x5610be(0x2e0)]=_0x51b09e;}),_0x5cecf7[_0x1d3230(0x2ab)]((_0x24d2a6,_0x2efcbc)=>{var _0x270660=_0x1d3230;_0x14534a[_0x2efcbc][_0x270660(0x29e)]=_0x24d2a6;}),_0x13c4f0[_0x1d3230(0x2ab)]((_0x59c0ef,_0x239705)=>{var _0xbcc3dc=_0x1d3230;_0x14534a[_0x239705][_0xbcc3dc(0x208)]=_0x59c0ef;}),_0x429d4a[_0x1d3230(0x2ab)]((_0x55b85b,_0x16c4b5)=>{var _0x25d3c0=_0x1d3230;_0x14534a[_0x16c4b5][_0x25d3c0(0x1ef)]=_0x55b85b;}),_0x2afd12[_0x1d3230(0x2ab)]((_0x426acf,_0x363551)=>{var _0x25c359=_0x1d3230;_0x14534a[_0x363551][_0x25c359(0x255)]=_0x426acf;}),_0x125c31['forEach']((_0x33b467,_0x15f194)=>{var _0x4200ce=_0x1d3230;_0x14534a[_0x15f194][_0x4200ce(0x2e1)]=_0x33b467;}),_0x324cf5['forEach']((_0x3d4483,_0x5aa463)=>{var _0xfac697=_0x1d3230;_0x14534a[_0x5aa463][_0xfac697(0x2cf)]=_0x3d4483;});const _0x3ba0c1=_0x2afd12['map'](_0x4f1476=>{return _0x4f1476={'room_name':_0x4f1476};}),_0x15a655=_0x14534a['filter'](_0x285da1=>_0x285da1['quantity']!=='0'&&_0x285da1[_0x1d3230(0x1da)]!==''),_0x3b0463=new purchases({'invoice':_0x366fcc,'suppliers':_0x54d2dc[_0x1d3230(0x1ee)][_0x1d3230(0x24c)],'date':_0x46585b,'warehouse_name':_0x1809cc,'product':_0x15a655,'note':_0x5b8b11,'due_amount':_0x44644f,'POnumber':_0x2f45d1,'SCRN':_0x32a2dd,'JO_number':_0x2b83b2,'roomList':_0x3ba0c1}),_0x2efd31=await _0x3b0463[_0x1d3230(0x251)](),_0x60ac8=await purchases[_0x1d3230(0x1cf)]({'invoice':_0x366fcc}),_0x1317da=_0x60ac8['product'][_0x1d3230(0x203)](async _0x3308fa=>{var _0x3596ed=_0x1d3230,_0x1b96c0=await warehouse[_0x3596ed(0x1cf)]({'name':_0x1809cc,'room':_0x3308fa[_0x3596ed(0x255)]}),_0x46f3cb=0x0;return _0x1b96c0['product_details'][_0x3596ed(0x2ab)](_0xab18ed=>{var _0xc2ab3e=_0x3596ed;_0xab18ed['product_name']==_0x3308fa[_0xc2ab3e(0x1e5)]&&_0xab18ed[_0xc2ab3e(0x2c4)]==_0x3308fa[_0xc2ab3e(0x2c4)]&&_0xab18ed[_0xc2ab3e(0x26e)]==_0x3308fa[_0xc2ab3e(0x26e)]&&_0xab18ed[_0xc2ab3e(0x29c)]==_0x3308fa[_0xc2ab3e(0x29c)]&&_0xab18ed[_0xc2ab3e(0x1e4)]==_0x3308fa[_0xc2ab3e(0x1e4)]&&_0xab18ed[_0xc2ab3e(0x28e)]==_0x3308fa[_0xc2ab3e(0x28e)]&&_0xab18ed['storage']==_0x3308fa[_0xc2ab3e(0x281)]&&_0xab18ed['expiry_date']==_0x3308fa[_0xc2ab3e(0x1d7)]&&_0xab18ed[_0xc2ab3e(0x236)]==_0x3308fa['batch_code']&&_0xab18ed[_0xc2ab3e(0x208)]==_0x3308fa[_0xc2ab3e(0x208)]&&_0xab18ed[_0xc2ab3e(0x2cf)]==_0x60ac8['invoice']&&(_0xab18ed[_0xc2ab3e(0x28b)]+=Math[_0xc2ab3e(0x2b6)](_0x3308fa[_0xc2ab3e(0x1da)]),_0x46f3cb++);}),_0x46f3cb===0x0&&_0x1b96c0[_0x3596ed(0x296)][_0x3596ed(0x1e0)]({'product_name':_0x3308fa[_0x3596ed(0x1e5)],'product_stock':Math[_0x3596ed(0x2b6)](_0x3308fa[_0x3596ed(0x1da)]),'primary_code':_0x3308fa[_0x3596ed(0x1ff)],'secondary_code':_0x3308fa['secondary_code'],'product_code':_0x3308fa[_0x3596ed(0x262)],'storage':_0x3308fa['storage'],'rack':_0x3308fa[_0x3596ed(0x28e)],'bay':_0x3308fa['bay'],'bin':_0x3308fa[_0x3596ed(0x29c)],'type':_0x3308fa[_0x3596ed(0x26e)],'floorlevel':_0x3308fa[_0x3596ed(0x2c4)],'maxProducts':_0x3308fa['maxStocks'],'unit':_0x3308fa[_0x3596ed(0x291)],'secondary_unit':_0x3308fa[_0x3596ed(0x1fe)],'expiry_date':_0x3308fa[_0x3596ed(0x1d7)],'maxPerUnit':_0x3308fa[_0x3596ed(0x2e0)],'batch_code':_0x3308fa[_0x3596ed(0x236)],'alertQTY':_0x3308fa[_0x3596ed(0x29e)],'production_date':_0x3308fa[_0x3596ed(0x208)],'product_cat':_0x3308fa[_0x3596ed(0x1ef)],'invoice':_0x3308fa[_0x3596ed(0x2cf)],'actual_qty':Math[_0x3596ed(0x2b6)](_0x3308fa[_0x3596ed(0x299)]),'actual_uom':_0x3308fa[_0x3596ed(0x1f6)]}),_0x1b96c0;});Promise['all'](_0x1317da)[_0x1d3230(0x27b)](async _0x20d566=>{var _0x58cbc4=_0x1d3230;try{for(const _0x2bb3b8 of _0x20d566){await _0x2bb3b8[_0x58cbc4(0x251)]();}const _0x5b5069=await master_shop[_0x58cbc4(0x2d7)](),_0x26cbdf=await email_settings[_0x58cbc4(0x1cf)](),_0x2f80a1=await supervisor_settings[_0x58cbc4(0x2d7)]();var _0x222726=_0x60ac8[_0x58cbc4(0x282)],_0x2382d1='',_0x37563c;for(_0x37563c in _0x222726){_0x2382d1+=_0x58cbc4(0x2d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x222726[_0x37563c][_0x58cbc4(0x1e5)]+_0x58cbc4(0x221)+_0x58cbc4(0x1fd)+_0x222726[_0x37563c][_0x58cbc4(0x262)]+_0x58cbc4(0x221)+_0x58cbc4(0x1fd)+_0x222726[_0x37563c]['quantity']+_0x58cbc4(0x221)+_0x58cbc4(0x1fd)+_0x222726[_0x37563c][_0x58cbc4(0x291)]+_0x58cbc4(0x221)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x222726[_0x37563c][_0x58cbc4(0x1fe)]+_0x58cbc4(0x221)+_0x58cbc4(0x1fd)+_0x60ac8[_0x58cbc4(0x2a3)]+_0x58cbc4(0x221)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x222726[_0x37563c][_0x58cbc4(0x255)]+_0x58cbc4(0x221)+_0x58cbc4(0x1fd)+_0x222726[_0x37563c][_0x58cbc4(0x281)]+_0x222726[_0x37563c]['rack']+_0x222726[_0x37563c][_0x58cbc4(0x1e4)]+_0x222726[_0x37563c][_0x58cbc4(0x29c)]+_0x222726[_0x37563c]['type'][0x0]+_0x222726[_0x37563c][_0x58cbc4(0x2c4)]+_0x58cbc4(0x221),_0x58cbc4(0x23f);}let _0x4861af=nodemailer['createTransport']({'host':_0x26cbdf[_0x58cbc4(0x286)],'port':Number(_0x26cbdf['port']),'secure':![],'auth':{'user':_0x26cbdf[_0x58cbc4(0x287)],'pass':_0x26cbdf[_0x58cbc4(0x204)]}}),_0x3a54a3={'from':_0x26cbdf[_0x58cbc4(0x287)],'to':_0x2f80a1[0x0][_0x58cbc4(0x2c1)],'subject':_0x58cbc4(0x23e),'attachments':[{'filename':_0x58cbc4(0x274),'path':__dirname+_0x58cbc4(0x1d5)+_0x58cbc4(0x2ad)+_0x5b5069[0x0][_0x58cbc4(0x2ca)],'cid':_0x58cbc4(0x2af)}],'html':_0x58cbc4(0x269)+'<html><head><title></title>'+'</head><body>'+_0x58cbc4(0x2ac)+_0x58cbc4(0x2cb)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x58cbc4(0x2ac)+'<h2>\x20'+_0x5b5069[0x0]['site_title']+_0x58cbc4(0x289)+_0x58cbc4(0x240)+_0x58cbc4(0x240)+'<hr\x20class=\x22my-3\x22>'+_0x58cbc4(0x2ac)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x58cbc4(0x271)+_0x60ac8[_0x58cbc4(0x2cf)]+'\x20'+_0x58cbc4(0x258)+_0x58cbc4(0x2a8)+_0x60ac8[_0x58cbc4(0x2a0)]+'\x20'+_0x58cbc4(0x256)+_0x58cbc4(0x2a6)+_0x58cbc4(0x240)+_0x58cbc4(0x29f)+_0x58cbc4(0x2b0)+_0x58cbc4(0x2d3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x58cbc4(0x1d8)+_0x58cbc4(0x24f)+_0x58cbc4(0x253)+_0x58cbc4(0x26d)+_0x58cbc4(0x241)+_0x58cbc4(0x21d)+_0x58cbc4(0x239)+'</tr>'+'</thead>'+_0x58cbc4(0x238)+'\x20'+_0x2382d1+'\x20'+_0x58cbc4(0x2ae)+'</table>'+'<div>'+_0x58cbc4(0x2d6)+_0x58cbc4(0x1c6)+_0x5b5069[0x0][_0x58cbc4(0x219)]+_0x58cbc4(0x2a6)+_0x58cbc4(0x240)+_0x58cbc4(0x240)+_0x58cbc4(0x2dd)};_0x4861af[_0x58cbc4(0x2c8)](_0x3a54a3,function(_0x2e53a7,_0x111ff0){var _0x2e706d=_0x58cbc4;_0x2e53a7?(console[_0x2e706d(0x1e9)](_0x2e53a7),console[_0x2e706d(0x1e9)](_0x2e706d(0x2bc))):console['log'](_0x2e706d(0x26f));}),_0x54d2dc[_0x58cbc4(0x2e2)](_0x58cbc4(0x2cc),'Purchase\x20data\x20added\x20successfully'),_0x2a2d5d['redirect'](_0x58cbc4(0x264));}catch(_0x3a3fd0){console['error'](_0x3a3fd0),_0x2a2d5d[_0x58cbc4(0x205)](0x1f4)[_0x58cbc4(0x24d)]({'error':_0x58cbc4(0x237)});}})['catch'](_0x2f2353=>{var _0x2ce5ef=_0x1d3230;console[_0x2ce5ef(0x252)](_0x2f2353),_0x2a2d5d[_0x2ce5ef(0x205)](0x1f4)[_0x2ce5ef(0x24d)]({'error':_0x2ce5ef(0x1c7)});});}catch(_0x3800a9){console[_0x1d3230(0x1e9)](_0x3800a9);}}),router['get'](a0_0x5366ad(0x2b4),auth,async(_0x4daf34,_0x139026)=>{var _0x56c8ca=a0_0x5366ad;try{const {username:_0x24d808,email:_0x670334,role:_0x4ce1c6}=_0x4daf34[_0x56c8ca(0x2de)],_0x4e26ac=_0x4daf34[_0x56c8ca(0x2de)],_0x59c7cd=await profile[_0x56c8ca(0x1cf)]({'email':_0x4e26ac[_0x56c8ca(0x287)]}),_0x1a238e=await master_shop[_0x56c8ca(0x2d7)](),_0x14da44=_0x4daf34['params']['id'],_0x54ffb4=await purchases[_0x56c8ca(0x2b9)](_0x14da44),_0x2d1260=await warehouse[_0x56c8ca(0x1ec)]([{'$match':{'name':_0x54ffb4[_0x56c8ca(0x2a3)],'room':_0x54ffb4[_0x56c8ca(0x1cc)]}},{'$unwind':_0x56c8ca(0x2aa)},{'$group':{'_id':_0x56c8ca(0x1d3),'name':{'$first':_0x56c8ca(0x201)},'product_stock':{'$first':_0x56c8ca(0x2b3)},'bay':{'$first':_0x56c8ca(0x228)},'bin':{'$first':_0x56c8ca(0x28c)},'type':{'$first':_0x56c8ca(0x21f)},'floorlevel':{'$first':_0x56c8ca(0x250)},'primary_code':{'$first':_0x56c8ca(0x1f8)},'secondary_code':{'$first':_0x56c8ca(0x223)},'product_code':{'$first':_0x56c8ca(0x295)},'storage':{'$first':_0x56c8ca(0x284)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x56c8ca(0x22a)}}}]),_0x2c0b4d=await customer[_0x56c8ca(0x2d7)]({});let _0x5dfd83;if(_0x4e26ac[_0x56c8ca(0x273)]==_0x56c8ca(0x2dc)){const _0x3c9038=await staff[_0x56c8ca(0x1cf)]({'email':_0x4e26ac['email']});_0x5dfd83=await warehouse[_0x56c8ca(0x1ec)]([{'$match':{'status':_0x56c8ca(0x263),'name':_0x3c9038[_0x56c8ca(0x2e3)]}},{'$group':{'_id':_0x56c8ca(0x206),'name':{'$first':'$name'}}}]);}else _0x5dfd83=await warehouse[_0x56c8ca(0x1ec)]([{'$match':{'status':_0x56c8ca(0x263)}},{'$group':{'_id':_0x56c8ca(0x206),'name':{'$first':_0x56c8ca(0x206)}}}]);const _0x485f50=await product['find']({}),_0x4ed045=await suppliers['find']({}),_0x277d7e=BayBinSelected(_0x54ffb4[_0x56c8ca(0x2a3)],_0x54ffb4['room']);if(_0x1a238e[0x0]['language']==_0x56c8ca(0x20a)){var _0x40f337=users[_0x56c8ca(0x283)];console[_0x56c8ca(0x1e9)](_0x40f337);}else{if(_0x1a238e[0x0][_0x56c8ca(0x2d1)]==_0x56c8ca(0x229))var _0x40f337=users[_0x56c8ca(0x229)];else{if(_0x1a238e[0x0][_0x56c8ca(0x2d1)]==_0x56c8ca(0x2b5))var _0x40f337=users[_0x56c8ca(0x2b5)];else{if(_0x1a238e[0x0][_0x56c8ca(0x2d1)]==_0x56c8ca(0x247))var _0x40f337=users['Spanish'];else{if(_0x1a238e[0x0][_0x56c8ca(0x2d1)]==_0x56c8ca(0x257))var _0x40f337=users[_0x56c8ca(0x257)];else{if(_0x1a238e[0x0][_0x56c8ca(0x2d1)]==_0x56c8ca(0x1c9))var _0x40f337=users['Portuguese'];else{if(_0x1a238e[0x0]['language']==_0x56c8ca(0x265))var _0x40f337=users[_0x56c8ca(0x265)];else{if(_0x1a238e[0x0][_0x56c8ca(0x2d1)]=='Arabic\x20(ae)')var _0x40f337=users[_0x56c8ca(0x2c9)];}}}}}}}_0x139026[_0x56c8ca(0x29b)]('edit_purchases_view',{'success':_0x4daf34[_0x56c8ca(0x2e2)]('success'),'errors':_0x4daf34[_0x56c8ca(0x2e2)](_0x56c8ca(0x290)),'role':_0x4e26ac,'profile':_0x59c7cd,'customer':_0x2c0b4d,'warehouse':_0x5dfd83,'product':_0x2d1260,'user':_0x54ffb4,'master_shop':_0x1a238e,'unit':_0x485f50,'language':_0x40f337,'suppliers':_0x4ed045,'dataSelected':_0x277d7e});}catch(_0x47e670){console[_0x56c8ca(0x1e9)](_0x47e670);}}),router['post'](a0_0x5366ad(0x2b4),auth,async(_0x1ce894,_0x12806c)=>{var _0x2cf6ce=a0_0x5366ad;try{const _0x3bc0a1=_0x1ce894[_0x2cf6ce(0x1cd)]['id'],{invoice:_0x34d08d,warehouse_name:_0x1339d9,Room_name:_0x550f5e}=_0x1ce894[_0x2cf6ce(0x1ee)],_0x1cbfd0=await warehouse['findOne']({'name':_0x1339d9,'room':_0x550f5e}),_0xf41749=await purchases[_0x2cf6ce(0x1cf)]({'invoice':_0x34d08d});_0xf41749[_0x2cf6ce(0x282)][_0x2cf6ce(0x2ab)](_0x1d0903=>{var _0x1faf8e=_0x2cf6ce,_0x351d5b=0x0;const _0x53008f=_0x1cbfd0['product_details'][_0x1faf8e(0x203)](_0x4e7879=>{var _0x1dbfa0=_0x1faf8e;_0x4e7879[_0x1dbfa0(0x1e5)]==_0x1d0903[_0x1dbfa0(0x1e5)]&&_0x4e7879[_0x1dbfa0(0x2c4)]==_0x1d0903[_0x1dbfa0(0x2c4)]&&_0x4e7879[_0x1dbfa0(0x26e)]==_0x1d0903[_0x1dbfa0(0x26e)]&&_0x4e7879['bin']==_0x1d0903[_0x1dbfa0(0x29c)]&&_0x4e7879[_0x1dbfa0(0x1e4)]==_0x1d0903[_0x1dbfa0(0x1e4)]&&_0x4e7879[_0x1dbfa0(0x28e)]==_0x1d0903[_0x1dbfa0(0x28e)]&&_0x4e7879[_0x1dbfa0(0x281)]==_0x1d0903[_0x1dbfa0(0x281)]&&_0x4e7879[_0x1dbfa0(0x1d7)]==_0x1d0903[_0x1dbfa0(0x1d7)]&&_0x4e7879[_0x1dbfa0(0x236)]==_0x1d0903[_0x1dbfa0(0x236)]&&_0x4e7879[_0x1dbfa0(0x208)]==_0x1d0903[_0x1dbfa0(0x208)]&&_0x4e7879[_0x1dbfa0(0x2c3)]==_0x1d0903[_0x1dbfa0(0x2c3)]&&_0x4e7879[_0x1dbfa0(0x2e1)]==_0x1d0903[_0x1dbfa0(0x2e1)]&&(_0x4e7879[_0x1dbfa0(0x28b)]=parseInt(_0x4e7879[_0x1dbfa0(0x28b)])+parseInt(_0x1d0903[_0x1dbfa0(0x1da)]),_0x351d5b++);});_0x351d5b=='0'&&(_0x1cbfd0[_0x1faf8e(0x296)]=_0x1cbfd0['product_details']['concat']({'product_name':_0x1d0903['product_name'],'product_stock':_0x1d0903[_0x1faf8e(0x1da)],'primary_code':_0x1d0903[_0x1faf8e(0x1ff)],'secondary_code':_0x1d0903[_0x1faf8e(0x1eb)],'product_code':_0x1d0903[_0x1faf8e(0x262)],'storage':_0x1d0903[_0x1faf8e(0x281)],'rack':_0x1d0903['rack'],'bay':_0x1d0903[_0x1faf8e(0x1e4)],'bin':_0x1d0903[_0x1faf8e(0x29c)],'type':_0x1d0903[_0x1faf8e(0x26e)],'floorlevel':_0x1d0903['floorlevel'],'maxProducts':_0x1d0903['maxStocks'],'unit':_0x1d0903[_0x1faf8e(0x291)],'secondary_unit':_0x1d0903[_0x1faf8e(0x1fe)],'expiry_date':_0x1d0903[_0x1faf8e(0x1d7)],'maxPerUnit':_0x1d0903[_0x1faf8e(0x2e0)],'batch_code':_0x1d0903[_0x1faf8e(0x236)],'alertQTY':_0x1d0903[_0x1faf8e(0x29e)],'production_date':_0x1d0903['production_date'],'delivery_date':_0x1d0903['delivery_date'],'delivery_code':_0x1d0903['delivery_code']}));}),await _0x1cbfd0[_0x2cf6ce(0x251)](),_0xf41749[_0x2cf6ce(0x28d)]=_0x2cf6ce(0x2bd);const _0x130ef3=await _0xf41749[_0x2cf6ce(0x251)]();_0x1ce894[_0x2cf6ce(0x2e2)](_0x2cf6ce(0x2cc),_0x2cf6ce(0x243)),_0x12806c[_0x2cf6ce(0x268)]('/all_purchases/view');}catch(_0x4f7d17){console[_0x2cf6ce(0x1e9)](_0x4f7d17);}}),router['get'](a0_0x5366ad(0x2a7),auth,async(_0x5bcb6b,_0x5a0e55)=>{var _0x235f77=a0_0x5366ad;try{const {username:_0x24eb07,email:_0x2e6b93,role:_0x9cea39}=_0x5bcb6b[_0x235f77(0x2de)],_0x49a2d3=_0x5bcb6b[_0x235f77(0x2de)],_0x52dadc=await profile[_0x235f77(0x1cf)]({'email':_0x49a2d3[_0x235f77(0x287)]}),_0x441725=await master_shop['find'](),_0x2874cf=_0x5bcb6b[_0x235f77(0x1cd)]['id'],_0x3da019=await purchases[_0x235f77(0x2b9)](_0x2874cf),_0x1adcdf=await suppliers[_0x235f77(0x2d7)]({});let _0xc6d3c9;if(_0x49a2d3['role']==_0x235f77(0x2dc)){const _0x162c52=await staff[_0x235f77(0x1cf)]({'email':_0x49a2d3['email']});_0xc6d3c9=await warehouse[_0x235f77(0x2d7)]({'status':_0x235f77(0x263),'name':_0x162c52[_0x235f77(0x2e3)],'warehouse_category':_0x235f77(0x22f)});}else _0xc6d3c9=await warehouse['aggregate']([{'$match':{'status':_0x235f77(0x263),'warehouse_category':_0x235f77(0x22f)}},{'$group':{'_id':'$name','name':{'$first':_0x235f77(0x206)}}}]);const _0x12b458=await product['find']({}),_0x21b20d=BayBinSelected(_0x3da019[_0x235f77(0x2a3)],_0x3da019[_0x235f77(0x1cc)]);let _0x5a39bb=new Date(_0x3da019['expiry_date']),_0x503ec9=('0'+_0x5a39bb[_0x235f77(0x1d1)]())[_0x235f77(0x21c)](-0x2),_0x279965=('0'+(_0x5a39bb[_0x235f77(0x23c)]()+0x1))[_0x235f77(0x21c)](-0x2),_0x13329c=_0x5a39bb['getFullYear'](),_0x5eed15=_0x13329c+'-'+_0x279965+'-'+_0x503ec9;if(_0x441725[0x0][_0x235f77(0x2d1)]==_0x235f77(0x20a)){var _0x33a967=users['English'];console['log'](_0x33a967);}else{if(_0x441725[0x0]['language']==_0x235f77(0x229))var _0x33a967=users[_0x235f77(0x229)];else{if(_0x441725[0x0][_0x235f77(0x2d1)]==_0x235f77(0x2b5))var _0x33a967=users[_0x235f77(0x2b5)];else{if(_0x441725[0x0]['language']==_0x235f77(0x247))var _0x33a967=users[_0x235f77(0x247)];else{if(_0x441725[0x0][_0x235f77(0x2d1)]=='French')var _0x33a967=users[_0x235f77(0x257)];else{if(_0x441725[0x0][_0x235f77(0x2d1)]==_0x235f77(0x1c9))var _0x33a967=users[_0x235f77(0x24e)];else{if(_0x441725[0x0][_0x235f77(0x2d1)]==_0x235f77(0x265))var _0x33a967=users[_0x235f77(0x265)];else{if(_0x441725[0x0][_0x235f77(0x2d1)]==_0x235f77(0x28a))var _0x33a967=users[_0x235f77(0x2c9)];}}}}}}}_0x5a0e55[_0x235f77(0x29b)](_0x235f77(0x1f2),{'success':_0x5bcb6b['flash'](_0x235f77(0x2cc)),'errors':_0x5bcb6b['flash'](_0x235f77(0x290)),'role':_0x49a2d3,'profile':_0x52dadc,'purchases':_0x3da019,'suppliers':_0x1adcdf,'warehouse':_0xc6d3c9,'product':_0x12b458,'master_shop':_0x441725,'language':_0x33a967,'ed_fullDate':_0x5eed15,'dataSelected':_0x21b20d});}catch(_0x2f8017){console[_0x235f77(0x1e9)](_0x2f8017);}}),router[a0_0x5366ad(0x297)]('/view/:id',auth,async(_0x3e2242,_0x20ed25)=>{var _0x11d263=a0_0x5366ad;try{const _0x3e3e80=_0x3e2242['params']['id'],_0x27295a=await purchases[_0x11d263(0x1cf)]({'_id':_0x3e2242['params']['id']}),_0xbb73e=await warehouse[_0x11d263(0x1cf)]({'name':_0x27295a[_0x11d263(0x2a3)],'room':_0x27295a[_0x11d263(0x1cc)]});_0x27295a[_0x11d263(0x282)][_0x11d263(0x2ab)](_0x3122f1=>{var _0x2b4f89=_0x11d263;const _0x283c9c=_0xbb73e[_0x2b4f89(0x296)][_0x2b4f89(0x203)](_0x236568=>{var _0x35b720=_0x2b4f89;_0x236568[_0x35b720(0x1e5)]==_0x3122f1[_0x35b720(0x1e5)]&&_0x236568[_0x35b720(0x2c4)]==_0x3122f1['floorlevel']&&_0x236568['type']==_0x3122f1[_0x35b720(0x26e)]&&_0x236568['bin']==_0x3122f1['bin']&&_0x236568[_0x35b720(0x1e4)]==_0x3122f1[_0x35b720(0x1e4)]&&_0x236568[_0x35b720(0x28e)]==_0x3122f1['rack']&&_0x236568[_0x35b720(0x281)]==_0x3122f1['storage']&&(_0x236568['product_stock']=parseInt(_0x236568['product_stock'])-parseInt(_0x3122f1[_0x35b720(0x1da)]));});}),await _0xbb73e['save']();const {invoice:_0x4ffa99,suppliers:_0x4d27f1,date:_0x56a6f7,warehouse_name:_0x30759b,prod_name:_0x15d197,prod_code:_0x4fd6c4,prod_qty:_0x3bb51e,prod_unit:_0x1ef08a,prod_secondunit:_0x7131c7,prod_level:_0x69b73d,prod_isle:_0x10e651,prod_pallet:_0x2fa9e8,note:_0x1c147c,expiry_date:_0x558b5a,batch_code:_0x3d11cd,paid_amount:_0x30b27e,due_amount:_0x2787c9,Room_name:_0x4da33b,primary_code:_0x3e87b6,secondary_code:_0x59969b,PO_number:_0xade271,JO_number:_0x2dea2d}=_0x3e2242[_0x11d263(0x1ee)];if(typeof _0x15d197=='string')var _0x91b1cf=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x2b1)]],_0x48a3f7=[_0x3e2242[_0x11d263(0x1ee)]['prod_code']],_0xcd334c=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x26c)]],_0x4c2777=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x1cb)]],_0x3ed962=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x2db)]],_0x596dc6=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x21b)]],_0x3bba80=[_0x3e2242['body'][_0x11d263(0x2b7)]],_0x24dc77=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x1e6)]],_0x4288dc=[_0x3e2242[_0x11d263(0x1ee)]['primary_code']],_0x934455=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x1eb)]],_0xe8ffa0=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x25d)]],_0x42134d=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x236)]],_0x2bdfbc=[_0x3e2242[_0x11d263(0x1ee)]['expiry_date']],_0x5edf66=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x281)]],_0x2e0099=[_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x22e)]],_0x5ec138=[_0x3e2242[_0x11d263(0x1ee)]['type']];else var _0x91b1cf=[..._0x3e2242['body']['prod_name']],_0x48a3f7=[..._0x3e2242['body'][_0x11d263(0x279)]],_0xcd334c=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x26c)]],_0x4c2777=[..._0x3e2242['body'][_0x11d263(0x1cb)]],_0x3ed962=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x2db)]],_0x596dc6=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x21b)]],_0x3bba80=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x2b7)]],_0x24dc77=[..._0x3e2242['body'][_0x11d263(0x1e6)]],_0x4288dc=[..._0x3e2242['body'][_0x11d263(0x1ff)]],_0x934455=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x1eb)]],_0xe8ffa0=[..._0x3e2242['body'][_0x11d263(0x25d)]],_0x42134d=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x236)]],_0x2bdfbc=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x1d7)]],_0x5edf66=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x281)]],_0x2e0099=[..._0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x22e)]],_0x5ec138=[..._0x3e2242[_0x11d263(0x1ee)]['type']];const _0x28a160=_0x91b1cf[_0x11d263(0x203)](_0x17cd02=>{return _0x17cd02={'product_name':_0x17cd02};});_0x48a3f7['forEach']((_0x36fbc6,_0x5da069)=>{var _0x1515d2=_0x11d263;_0x28a160[_0x5da069][_0x1515d2(0x262)]=_0x36fbc6;}),_0xcd334c[_0x11d263(0x2ab)]((_0x144684,_0x5db312)=>{var _0x46fc24=_0x11d263;_0x28a160[_0x5db312][_0x46fc24(0x1da)]=_0x144684;}),_0x4c2777[_0x11d263(0x2ab)]((_0x4be457,_0x73d5a)=>{var _0x352547=_0x11d263;_0x28a160[_0x73d5a][_0x352547(0x291)]=_0x4be457;}),_0x3ed962['forEach']((_0x19fd11,_0x32b6e9)=>{_0x28a160[_0x32b6e9]['secondary_unit']=_0x19fd11;}),_0x596dc6[_0x11d263(0x2ab)]((_0x48fe95,_0x58b29e)=>{var _0x8865d7=_0x11d263;_0x28a160[_0x58b29e][_0x8865d7(0x1e4)]=_0x48fe95;}),_0x3bba80[_0x11d263(0x2ab)]((_0x52b28a,_0x109a2c)=>{var _0x4e603c=_0x11d263;_0x28a160[_0x109a2c][_0x4e603c(0x29c)]=_0x52b28a;}),_0x24dc77[_0x11d263(0x2ab)]((_0x48eb92,_0x3238c0)=>{var _0x2677f0=_0x11d263;_0x28a160[_0x3238c0][_0x2677f0(0x2c4)]=_0x48eb92;}),_0x4288dc['forEach']((_0x35edde,_0x382ed6)=>{_0x28a160[_0x382ed6]['primary_code']=_0x35edde;}),_0x934455[_0x11d263(0x2ab)]((_0x2d192c,_0x530261)=>{var _0x29a8ef=_0x11d263;_0x28a160[_0x530261][_0x29a8ef(0x1eb)]=_0x2d192c;}),_0xe8ffa0[_0x11d263(0x2ab)]((_0x2cbdf4,_0x3dea11)=>{_0x28a160[_0x3dea11]['maxStocks']=_0x2cbdf4;}),_0x42134d[_0x11d263(0x2ab)]((_0x4870bf,_0x2afdd3)=>{_0x28a160[_0x2afdd3]['batch_code']=_0x4870bf;}),_0x2bdfbc[_0x11d263(0x2ab)]((_0x462a3b,_0x3778c0)=>{var _0x88ba6e=_0x11d263;_0x28a160[_0x3778c0][_0x88ba6e(0x1d7)]=_0x462a3b;}),_0x5ec138[_0x11d263(0x2ab)]((_0x13bef0,_0x574711)=>{var _0x5ab342=_0x11d263;_0x28a160[_0x574711][_0x5ab342(0x26e)]=_0x13bef0;}),_0x5edf66['forEach']((_0x14453d,_0x37fbb2)=>{var _0x16a35a=_0x11d263;_0x28a160[_0x37fbb2][_0x16a35a(0x281)]=_0x14453d;}),_0x2e0099[_0x11d263(0x2ab)]((_0x26b3d1,_0x19fab7)=>{var _0x3bea51=_0x11d263;_0x28a160[_0x19fab7][_0x3bea51(0x28e)]=_0x26b3d1;});const _0xc8e371=_0x28a160[_0x11d263(0x266)](_0x269251=>_0x269251[_0x11d263(0x1da)]!=='0'&&_0x269251[_0x11d263(0x1da)]!=='');_0x27295a['invoice']=_0x4ffa99,_0x27295a[_0x11d263(0x24c)]=_0x4d27f1,_0x27295a['date']=_0x56a6f7,_0x27295a[_0x11d263(0x2a3)]=_0x30759b,_0x27295a[_0x11d263(0x282)]=_0xc8e371,_0x27295a[_0x11d263(0x29d)]=_0x1c147c,_0x27295a['paid_amount']=_0x30b27e,_0x27295a['due_amount']=_0x2787c9,_0x27295a[_0x11d263(0x1cc)]=_0x4da33b,_0x27295a[_0x11d263(0x202)]=_0xade271,_0x27295a['JO_number']=_0x2dea2d;const _0x532f19=await _0x27295a[_0x11d263(0x251)](),_0x5e6f4f=await warehouse['findOne']({'name':_0x3e2242[_0x11d263(0x1ee)]['warehouse_name'],'room':_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x275)]});_0x27295a[_0x11d263(0x282)][_0x11d263(0x2ab)](_0x289956=>{var _0x312368=_0x11d263,_0x306ede=0x0;const _0x13fa5c=_0x5e6f4f[_0x312368(0x296)][_0x312368(0x203)](_0x33667b=>{var _0x1a3eec=_0x312368;_0x33667b['product_name']==_0x289956[_0x1a3eec(0x1e5)]&&_0x33667b['floorlevel']==_0x289956['floorlevel']&&_0x33667b[_0x1a3eec(0x26e)]==_0x289956[_0x1a3eec(0x26e)]&&_0x33667b[_0x1a3eec(0x29c)]==_0x289956[_0x1a3eec(0x29c)]&&_0x33667b['bay']==_0x289956[_0x1a3eec(0x1e4)]&&_0x33667b['rack']==_0x289956[_0x1a3eec(0x28e)]&&_0x33667b[_0x1a3eec(0x281)]==_0x289956[_0x1a3eec(0x281)]&&(_0x33667b[_0x1a3eec(0x28b)]=parseInt(_0x33667b[_0x1a3eec(0x28b)])+parseInt(_0x289956[_0x1a3eec(0x1da)]),_0x306ede++);});_0x306ede=='0'&&(_0x5e6f4f['product_details']=_0x5e6f4f[_0x312368(0x296)][_0x312368(0x2b2)]({'product_name':_0x289956[_0x312368(0x1e5)],'product_stock':_0x289956['quantity'],'primary_code':_0x289956[_0x312368(0x1ff)],'secondary_code':_0x289956[_0x312368(0x1eb)],'product_code':_0x289956[_0x312368(0x262)],'storage':_0x289956[_0x312368(0x281)],'rack':_0x289956[_0x312368(0x28e)],'bay':_0x289956[_0x312368(0x1e4)],'bin':_0x289956[_0x312368(0x29c)],'type':_0x289956[_0x312368(0x26e)],'floorlevel':_0x289956[_0x312368(0x2c4)],'maxProducts':_0x289956[_0x312368(0x1f3)],'unit':_0x289956['standard_unit'],'secondary_unit':_0x289956[_0x312368(0x1fe)],'expiry_date':_0x289956[_0x312368(0x1d7)]}));}),await _0x5e6f4f[_0x11d263(0x251)]();const _0x449837=await s_payment_data[_0x11d263(0x1cf)]({'invoice':_0x3e2242[_0x11d263(0x1ee)][_0x11d263(0x2cf)]});if(_0x449837===null){}else console['log'](_0x11d263(0x24c),_0x449837,_0x3e2242['body'][_0x11d263(0x2cf)]),_0x449837[_0x11d263(0x24c)]=_0x3e2242['body'][_0x11d263(0x24c)],await _0x449837['save']();_0x3e2242[_0x11d263(0x2e2)](_0x11d263(0x2cc),'purchase\x20data\x20update\x20successfully'),_0x20ed25['redirect'](_0x11d263(0x234));}catch(_0x52f5f3){console[_0x11d263(0x1e9)](_0x52f5f3);}}),router[a0_0x5366ad(0x297)](a0_0x5366ad(0x293),auth,async(_0x325675,_0x35f2bd)=>{var _0x4ec613=a0_0x5366ad;try{const _0x3e2dea=_0x325675[_0x4ec613(0x1cd)]['id'],{invoice:_0x63e8c6,suppliers:_0x3025a5,payable:_0x5bf0aa,due_amount:_0x2ddf86}=_0x325675[_0x4ec613(0x1ee)],_0x2d7019=await purchases[_0x4ec613(0x2b9)](_0x3e2dea);var _0x4e92d5=_0x5bf0aa-_0x2ddf86;_0x2d7019[_0x4ec613(0x2a4)]=parseFloat(_0x2d7019[_0x4ec613(0x2a4)])+parseFloat(_0x2ddf86),_0x2d7019['due_amount']=_0x4e92d5;const _0x2deefe=await _0x2d7019[_0x4ec613(0x251)]();console['log'](_0x2deefe);const _0x262895=await s_payment_data[_0x4ec613(0x1cf)]({'invoice':_0x63e8c6});_0x262895[_0x4ec613(0x1d6)]=_0x4e92d5,await _0x262895['save']();let _0x1ccece=new Date(),_0x1c4486=('0'+_0x1ccece[_0x4ec613(0x1d1)]())[_0x4ec613(0x21c)](-0x2),_0x1403e7=('0'+(_0x1ccece[_0x4ec613(0x23c)]()+0x1))[_0x4ec613(0x21c)](-0x2),_0x41e0eb=_0x1ccece['getFullYear'](),_0x27c5b9=_0x41e0eb+'-'+_0x1403e7+'-'+_0x1c4486;const _0x94e10e=new suppliers_payment({'invoice':_0x63e8c6,'date':_0x41e0eb+'-'+_0x1403e7+'-'+_0x1c4486,'suppliers':_0x3025a5,'reason':'Paid\x20For\x20Purchase','amount':_0x2ddf86}),_0x1c7a47=await _0x94e10e[_0x4ec613(0x251)]();_0x325675[_0x4ec613(0x2e2)](_0x4ec613(0x2cc),_0x4ec613(0x1f1)),_0x35f2bd[_0x4ec613(0x268)](_0x4ec613(0x234));}catch(_0x5c9b5e){console['log'](_0x5c9b5e);}}),router['get'](a0_0x5366ad(0x2d5),auth,async(_0x31f91c,_0x25aec4)=>{var _0x3dc3a4=a0_0x5366ad;try{const {username:_0x137ba1,email:_0x224c4a,role:_0xf2681f}=_0x31f91c[_0x3dc3a4(0x2de)],_0x14545c=_0x31f91c['user'],_0x41e003=await profile[_0x3dc3a4(0x1cf)]({'email':_0x14545c[_0x3dc3a4(0x287)]}),_0x291a7b=await master_shop['find']();console[_0x3dc3a4(0x1e9)](_0x3dc3a4(0x1f0),_0x291a7b);const _0x3e4f59=_0x31f91c[_0x3dc3a4(0x1cd)]['id'],_0x5bea51=await purchases[_0x3dc3a4(0x2b9)](_0x3e4f59);console[_0x3dc3a4(0x1e9)](_0x5bea51);const _0x25adef=await suppliers[_0x3dc3a4(0x1cf)]({'name':_0x5bea51[_0x3dc3a4(0x24c)]});console[_0x3dc3a4(0x1e9)](_0x25adef);if(_0x291a7b[0x0]['language']==_0x3dc3a4(0x20a)){var _0x43d9bc=users[_0x3dc3a4(0x283)];console[_0x3dc3a4(0x1e9)](_0x43d9bc);}else{if(_0x291a7b[0x0]['language']=='Hindi')var _0x43d9bc=users[_0x3dc3a4(0x229)];else{if(_0x291a7b[0x0]['language']==_0x3dc3a4(0x2b5))var _0x43d9bc=users['German'];else{if(_0x291a7b[0x0][_0x3dc3a4(0x2d1)]=='Spanish')var _0x43d9bc=users[_0x3dc3a4(0x247)];else{if(_0x291a7b[0x0][_0x3dc3a4(0x2d1)]==_0x3dc3a4(0x257))var _0x43d9bc=users['French'];else{if(_0x291a7b[0x0][_0x3dc3a4(0x2d1)]=='Portuguese\x20(BR)')var _0x43d9bc=users[_0x3dc3a4(0x24e)];else{if(_0x291a7b[0x0][_0x3dc3a4(0x2d1)]=='Chinese')var _0x43d9bc=users[_0x3dc3a4(0x265)];else{if(_0x291a7b[0x0][_0x3dc3a4(0x2d1)]=='Arabic\x20(ae)')var _0x43d9bc=users['Arabic'];}}}}}}}_0x25aec4[_0x3dc3a4(0x29b)](_0x3dc3a4(0x1e8),{'success':_0x31f91c[_0x3dc3a4(0x2e2)](_0x3dc3a4(0x2cc)),'errors':_0x31f91c[_0x3dc3a4(0x2e2)](_0x3dc3a4(0x290)),'role':_0x14545c,'profile':_0x41e003,'master_shop':_0x291a7b,'supplier':_0x25adef,'purchase':_0x5bea51,'language':_0x43d9bc});}catch(_0xbbbdb3){console[_0x3dc3a4(0x1e9)](_0xbbbdb3);}}),router[a0_0x5366ad(0x26b)]('/view/return_purchase/:id',auth,async(_0xeac465,_0x32ce7c)=>{var _0x135406=a0_0x5366ad;try{const {username:_0x3f1f0c,email:_0x646eb9,role:_0x26e69f}=_0xeac465['user'],_0x5504cb=_0xeac465[_0x135406(0x2de)],_0x39f1ca=await profile[_0x135406(0x1cf)]({'email':_0x5504cb[_0x135406(0x287)]}),_0x25c6ea=await master_shop[_0x135406(0x2d7)]();console[_0x135406(0x1e9)]('master',_0x25c6ea);const _0x566278=_0xeac465[_0x135406(0x1cd)]['id'];console[_0x135406(0x1e9)](_0x566278);const _0x2cae2e=await purchases['findById'](_0x566278);console['log'](_0x135406(0x24a),_0x2cae2e);const _0x3875c6=await product[_0x135406(0x2d7)]({}),_0x58eab1=await warehouse[_0x135406(0x1ec)]([{'$match':{'name':_0x2cae2e[_0x135406(0x2a3)],'room':_0x2cae2e[_0x135406(0x1cc)],'warehouse_category':_0x135406(0x22f)}},{'$unwind':_0x135406(0x2aa)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x135406(0x201)},'product_stock':{'$first':_0x135406(0x2b3)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x135406(0x28c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x135406(0x1f8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x135406(0x295)},'storage':{'$first':_0x135406(0x284)},'rack':{'$first':_0x135406(0x224)}}}]);warehouse_data=await warehouse[_0x135406(0x1ec)]([{'$match':{'status':'Enabled','name':_0x135406(0x29a),'warehouse_category':_0x135406(0x22f)}},{'$group':{'_id':'$name','name':{'$first':_0x135406(0x206)}}},{'$sort':{'name':0x1}}]),console[_0x135406(0x1e9)](_0x135406(0x1e3),_0x58eab1);if(_0x25c6ea[0x0]['language']==_0x135406(0x20a)){var _0x123229=users['English'];console[_0x135406(0x1e9)](_0x123229);}else{if(_0x25c6ea[0x0]['language']==_0x135406(0x229))var _0x123229=users[_0x135406(0x229)];else{if(_0x25c6ea[0x0][_0x135406(0x2d1)]==_0x135406(0x2b5))var _0x123229=users['German'];else{if(_0x25c6ea[0x0][_0x135406(0x2d1)]==_0x135406(0x247))var _0x123229=users[_0x135406(0x247)];else{if(_0x25c6ea[0x0][_0x135406(0x2d1)]==_0x135406(0x257))var _0x123229=users['French'];else{if(_0x25c6ea[0x0]['language']==_0x135406(0x1c9))var _0x123229=users[_0x135406(0x24e)];else{if(_0x25c6ea[0x0][_0x135406(0x2d1)]=='Chinese')var _0x123229=users[_0x135406(0x265)];else{if(_0x25c6ea[0x0][_0x135406(0x2d1)]==_0x135406(0x28a))var _0x123229=users['Arabic'];}}}}}}}_0x32ce7c['render'](_0x135406(0x21a),{'success':_0xeac465[_0x135406(0x2e2)](_0x135406(0x2cc)),'errors':_0xeac465[_0x135406(0x2e2)](_0x135406(0x290)),'role':_0x5504cb,'profile':_0x39f1ca,'user':_0x2cae2e,'stock':_0x58eab1,'master_shop':_0x25c6ea,'product':_0x3875c6,'language':_0x123229,'warehouse':warehouse_data});}catch(_0xbe0e9b){console[_0x135406(0x1e9)](_0xbe0e9b);}}),router[a0_0x5366ad(0x297)](a0_0x5366ad(0x231),auth,async(_0x2c2a88,_0x370e03)=>{var _0x55735a=a0_0x5366ad;try{const {invoice:_0x47eb25,date:_0xffce16,warehouse_name:_0x329fa1,Room_name:_0x249d21,product_name:_0x330019,purchase_quantity:_0x3f44e9,stocks:_0x257842,return_qty:_0x1762ef,note:_0x1d3cfd,level:_0x5d3bc8,isle:_0x4652f3,pallet:_0x2d5944,to_warehouse_name:_0x2833eb,to_Room_name:_0x5257a0}=_0x2c2a88[_0x55735a(0x1ee)],_0x229ec7=await purchases[_0x55735a(0x1cf)]({'_id':_0x2c2a88[_0x55735a(0x1cd)]['id']}),_0x382409=await warehouse['findOne']({'name':_0x329fa1,'room':_0x249d21});if(typeof _0x330019==_0x55735a(0x1f5))var _0x1dad83=[_0x2c2a88['body']['product_name']],_0x514408=[_0x2c2a88['body'][_0x55735a(0x254)]],_0x52f8ee=[_0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x21e)]],_0x4268a5=[_0x2c2a88[_0x55735a(0x1ee)]['return_qty']],_0x84d32a=[_0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x22c)]],_0x3c5ffd=[_0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x2bf)]],_0x4e29ef=[_0x2c2a88['body'][_0x55735a(0x1df)]],_0x2d8704=[_0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x27e)]],_0x1aa8cf=[_0x2c2a88['body']['product_code_hide']],_0x243bc8=[_0x2c2a88['body'][_0x55735a(0x298)]],_0x1dd32c=[_0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x2bb)]];else var _0x1dad83=[..._0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x1e5)]],_0x514408=[..._0x2c2a88['body'][_0x55735a(0x254)]],_0x52f8ee=[..._0x2c2a88['body'][_0x55735a(0x21e)]],_0x4268a5=[..._0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x25f)]],_0x84d32a=[..._0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x22c)]],_0x3c5ffd=[..._0x2c2a88['body'][_0x55735a(0x2bf)]],_0x4e29ef=[..._0x2c2a88['body'][_0x55735a(0x1df)]],_0x2d8704=[..._0x2c2a88[_0x55735a(0x1ee)]['types']],_0x1aa8cf=[..._0x2c2a88['body'][_0x55735a(0x280)]],_0x243bc8=[..._0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x298)]],_0x1dd32c=[..._0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x2bb)]];const _0x34a26a=_0x1dad83[_0x55735a(0x203)](_0x129101=>{return _0x129101={'product_name':_0x129101};});_0x514408[_0x55735a(0x2ab)]((_0x37f315,_0x310472)=>{var _0x5d2053=_0x55735a;_0x34a26a[_0x310472][_0x5d2053(0x254)]=_0x37f315;}),_0x52f8ee[_0x55735a(0x2ab)]((_0x14346b,_0x561b74)=>{var _0x221ea4=_0x55735a;_0x34a26a[_0x561b74][_0x221ea4(0x249)]=_0x14346b;}),_0x4268a5[_0x55735a(0x2ab)]((_0x5d1672,_0x59af42)=>{_0x34a26a[_0x59af42]['return_qty']=_0x5d1672;}),_0x84d32a[_0x55735a(0x2ab)]((_0x4ea433,_0x3d5b27)=>{_0x34a26a[_0x3d5b27]['bay']=_0x4ea433;}),_0x3c5ffd[_0x55735a(0x2ab)]((_0x1339cf,_0x3a2072)=>{var _0x46da3f=_0x55735a;_0x34a26a[_0x3a2072][_0x46da3f(0x29c)]=_0x1339cf;}),_0x4e29ef[_0x55735a(0x2ab)]((_0x40399d,_0x123616)=>{var _0x45083a=_0x55735a;_0x34a26a[_0x123616][_0x45083a(0x2c4)]=_0x40399d;}),_0x2d8704[_0x55735a(0x2ab)]((_0x5f32d1,_0x4076b4)=>{var _0x2075c4=_0x55735a;_0x34a26a[_0x4076b4][_0x2075c4(0x26e)]=_0x5f32d1;}),_0x1aa8cf['forEach']((_0x773dea,_0x557bc0)=>{_0x34a26a[_0x557bc0]['product_code']=_0x773dea;}),_0x243bc8[_0x55735a(0x2ab)]((_0x53fc72,_0x20be9e)=>{_0x34a26a[_0x20be9e]['primary_code']=_0x53fc72;}),_0x1dd32c['forEach']((_0xd453f,_0x5693d7)=>{_0x34a26a[_0x5693d7]['secondary_code']=_0xd453f;}),_0x229ec7['product'][_0x55735a(0x2ab)](_0x618dc5=>{var _0x46a890=_0x55735a;const _0x59a358=_0x382409[_0x46a890(0x296)]['map'](_0x1ea424=>{var _0x13eacb=_0x46a890;_0x1ea424[_0x13eacb(0x1e5)]==_0x618dc5[_0x13eacb(0x1e5)]&&_0x1ea424[_0x13eacb(0x2c4)]==_0x618dc5[_0x13eacb(0x2c4)]&&_0x1ea424['type']==_0x618dc5[_0x13eacb(0x26e)]&&_0x1ea424[_0x13eacb(0x29c)]==_0x618dc5[_0x13eacb(0x29c)]&&_0x1ea424[_0x13eacb(0x1e4)]==_0x618dc5['bay']&&_0x1ea424[_0x13eacb(0x28e)]==_0x618dc5[_0x13eacb(0x28e)]&&_0x1ea424[_0x13eacb(0x281)]==_0x618dc5[_0x13eacb(0x281)]&&(console[_0x13eacb(0x1e9)](parseInt(_0x1ea424[_0x13eacb(0x28b)])+_0x13eacb(0x244)+parseInt(_0x618dc5[_0x13eacb(0x1da)])),_0x1ea424[_0x13eacb(0x28b)]=parseInt(_0x1ea424['product_stock'])+parseInt(_0x618dc5[_0x13eacb(0x1da)]));});}),await _0x382409[_0x55735a(0x251)]();const _0x21a899=_0x34a26a[_0x55735a(0x266)](_0x493532=>_0x493532[_0x55735a(0x25f)]!=='0'&&_0x493532[_0x55735a(0x25f)]!=='');var _0x51655b=0x0;_0x21a899[_0x55735a(0x2ab)](_0x540a78=>{var _0x296c58=_0x55735a;console['log'](_0x296c58(0x260),_0x540a78),(parseInt(_0x540a78[_0x296c58(0x254)])<parseInt(_0x540a78['return_qty'])||parseInt(_0x540a78[_0x296c58(0x249)])<parseInt(_0x540a78['return_qty']))&&_0x51655b++;});if(_0x51655b!=0x0)return _0x2c2a88[_0x55735a(0x2e2)](_0x55735a(0x290),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x370e03[_0x55735a(0x268)]('back');const _0x579711=new purchases_return({'invoice':_0x47eb25,'suppliers':_0x2c2a88[_0x55735a(0x1ee)]['suppliers'],'date':_0xffce16,'warehouse_name':_0x329fa1,'return_product':_0x21a899,'note':_0x1d3cfd,'room':_0x249d21,'to_warehouse_name':_0x2833eb,'to_room':_0x5257a0}),_0x4b6143=await _0x579711[_0x55735a(0x251)]();console['log'](_0x579711);const _0x3be4f2=await purchases_return[_0x55735a(0x1cf)]({'invoice':_0x47eb25}),_0x1dad6a=await warehouse['findOne']({'name':_0x2833eb,'room':_0x5257a0});_0x3be4f2[_0x55735a(0x1ca)]['forEach'](_0x415c55=>{var _0xe54d4b=_0x55735a,_0xfbfcd4=0x0;const _0x12feb5=_0x1dad6a[_0xe54d4b(0x296)][_0xe54d4b(0x203)](_0x55e19d=>{var _0x3777c5=_0xe54d4b;_0x55e19d[_0x3777c5(0x1e5)]==_0x415c55[_0x3777c5(0x1e5)]&&_0x55e19d[_0x3777c5(0x2c4)]==_0x415c55[_0x3777c5(0x2c4)]&&_0x55e19d[_0x3777c5(0x26e)]==_0x415c55[_0x3777c5(0x26e)]&&_0x55e19d[_0x3777c5(0x29c)]==_0x415c55['bin']&&_0x55e19d[_0x3777c5(0x1e4)]==_0x415c55[_0x3777c5(0x1e4)]&&(_0x55e19d[_0x3777c5(0x28b)]=parseInt(_0x55e19d['product_stock'])-parseInt(_0x415c55[_0x3777c5(0x25f)]),_0xfbfcd4++);});_0xfbfcd4=='0'&&(_0x1dad6a[_0xe54d4b(0x296)]=_0x1dad6a[_0xe54d4b(0x296)][_0xe54d4b(0x2b2)]({'product_name':_0x415c55['product_name'],'product_stock':_0x415c55[_0xe54d4b(0x25f)],'primary_code':_0x415c55[_0xe54d4b(0x1ff)],'secondary_code':_0x415c55[_0xe54d4b(0x1eb)],'product_code':_0x415c55[_0xe54d4b(0x262)],'storage':_0x415c55[_0xe54d4b(0x281)],'rack':_0x415c55[_0xe54d4b(0x28e)],'bay':_0x415c55[_0xe54d4b(0x1e4)],'bin':_0x415c55[_0xe54d4b(0x29c)],'type':_0x415c55['type'],'floorlevel':_0x415c55[_0xe54d4b(0x2c4)],'maxProducts':_0x415c55['maxStocks'],'unit':_0x415c55[_0xe54d4b(0x291)],'secondary_unit':_0x415c55[_0xe54d4b(0x1fe)],'expiry_date':_0x415c55[_0xe54d4b(0x1d7)]}));}),await _0x1dad6a[_0x55735a(0x251)]();const _0x325fd2=await purchases[_0x55735a(0x1cf)]({'invoice':_0x47eb25});_0x325fd2[_0x55735a(0x20b)]='True';const _0x568284=await _0x325fd2[_0x55735a(0x251)](),_0x2ea349=new s_payment_data({'invoice':_0x47eb25,'suppliers':_0x2c2a88[_0x55735a(0x1ee)][_0x55735a(0x24c)],'reason':_0x55735a(0x1ea)});await _0x2ea349[_0x55735a(0x251)]();const _0x194281=await master_shop[_0x55735a(0x2d7)]();console[_0x55735a(0x1e9)](_0x55735a(0x217),_0x194281[0x0][_0x55735a(0x2ca)]);const _0x594a6e=await email_settings[_0x55735a(0x1cf)](),_0x325e79=await suppliers['findOne']({'name':_0x2c2a88['body'][_0x55735a(0x24c)]});console[_0x55735a(0x1e9)](_0x55735a(0x2d4),_0x325e79);_0x194281[0x0][_0x55735a(0x28f)]==0x1?(right_currency=_0x194281[0x0][_0x55735a(0x1ce)],left_currency=''):(right_currency='',left_currency=_0x194281[0x0][_0x55735a(0x1ce)]);var _0x5b2984=_0x1dad83,_0x3a4600=_0x4268a5,_0x1d41b5='',_0x586d0f;for(_0x586d0f in _0x5b2984){_0x1d41b5+=_0x55735a(0x2d3)+_0x55735a(0x1fd)+_0x5b2984[_0x586d0f]+'</td>'+_0x55735a(0x1fd)+_0x3a4600[_0x586d0f]+_0x55735a(0x221)+_0x55735a(0x23f);}console[_0x55735a(0x1e9)]('product_list',_0x1d41b5);let _0xb36bed=nodemailer[_0x55735a(0x2cd)]({'service':_0x55735a(0x1ed),'auth':{'user':_0x594a6e[_0x55735a(0x287)],'pass':_0x594a6e['password']}}),_0x1ed499={'from':_0x594a6e[_0x55735a(0x287)],'to':_0x325e79[_0x55735a(0x287)],'subject':_0x55735a(0x2c2),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x55735a(0x2ad)+_0x194281[0x0][_0x55735a(0x2ca)],'cid':_0x55735a(0x2af)}],'html':_0x55735a(0x269)+_0x55735a(0x218)+_0x55735a(0x222)+_0x55735a(0x2ac)+_0x55735a(0x2cb)+'<div>'+_0x55735a(0x267)+_0x55735a(0x240)+_0x55735a(0x2ac)+'<h2>\x20'+_0x194281[0x0][_0x55735a(0x219)]+_0x55735a(0x289)+_0x55735a(0x240)+_0x55735a(0x240)+_0x55735a(0x1d4)+_0x55735a(0x2ac)+_0x55735a(0x226)+'\x20Order\x20Number\x20:\x20'+_0x47eb25+'\x20'+_0x55735a(0x258)+_0x55735a(0x2a8)+_0xffce16+'\x20'+_0x55735a(0x256)+_0x55735a(0x2a6)+_0x55735a(0x240)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x55735a(0x2b0)+_0x55735a(0x2d3)+_0x55735a(0x2d2)+_0x55735a(0x26a)+_0x55735a(0x1f7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x55735a(0x23f)+_0x55735a(0x2c7)+_0x55735a(0x238)+'\x20'+_0x1d41b5+'\x20'+_0x55735a(0x2ae)+_0x55735a(0x22b)+_0x55735a(0x2ac)+_0x55735a(0x2d6)+'<h5>'+_0x194281[0x0][_0x55735a(0x219)]+_0x55735a(0x2a6)+_0x55735a(0x240)+_0x55735a(0x240)+_0x55735a(0x2dd)};_0xb36bed[_0x55735a(0x2c8)](_0x1ed499,function(_0x4d25fb,_0x1ae060){var _0x5d5278=_0x55735a;_0x4d25fb?(console['log'](_0x4d25fb),console[_0x5d5278(0x1e9)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x2c2a88['flash'](_0x55735a(0x2cc),_0x55735a(0x2da)),_0x370e03['redirect']('/all_purchases/view');}catch(_0x634e95){console[_0x55735a(0x1e9)](_0x634e95),_0x370e03[_0x55735a(0x205)](0xc8)['json']({'message':_0x634e95[_0x55735a(0x1c8)]});}}),router[a0_0x5366ad(0x26b)]('/barcode/:id',auth,async(_0x4d21a6,_0x5446f1)=>{var _0x3bd0f8=a0_0x5366ad;try{const {username:_0x44a213,email:_0x4a0bc4,role:_0x3ad830}=_0x4d21a6['user'],_0x30b842=_0x4d21a6[_0x3bd0f8(0x2de)],_0x149d41=await profile[_0x3bd0f8(0x1cf)]({'email':_0x30b842['email']}),_0x3bcfa5=await master_shop[_0x3bd0f8(0x2d7)](),_0x10464e=_0x4d21a6[_0x3bd0f8(0x1cd)]['id'],_0x1e8a70=await purchases[_0x3bd0f8(0x2b9)](_0x10464e);if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]=='English\x20(US)')var _0x36cce2=users[_0x3bd0f8(0x283)];else{if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]==_0x3bd0f8(0x229))var _0x36cce2=users['Hindi'];else{if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]==_0x3bd0f8(0x2b5))var _0x36cce2=users[_0x3bd0f8(0x2b5)];else{if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]==_0x3bd0f8(0x247))var _0x36cce2=users[_0x3bd0f8(0x247)];else{if(_0x3bcfa5[0x0]['language']=='French')var _0x36cce2=users[_0x3bd0f8(0x257)];else{if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]==_0x3bd0f8(0x1c9))var _0x36cce2=users['Portuguese'];else{if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]==_0x3bd0f8(0x265))var _0x36cce2=users[_0x3bd0f8(0x265)];else{if(_0x3bcfa5[0x0][_0x3bd0f8(0x2d1)]=='Arabic\x20(ae)')var _0x36cce2=users[_0x3bd0f8(0x2c9)];}}}}}}}_0x5446f1[_0x3bd0f8(0x29b)](_0x3bd0f8(0x211),{'success':_0x4d21a6[_0x3bd0f8(0x2e2)](_0x3bd0f8(0x2cc)),'errors':_0x4d21a6[_0x3bd0f8(0x2e2)](_0x3bd0f8(0x290)),'role':_0x30b842,'profile':_0x149d41,'alldata':_0x1e8a70,'master_shop':_0x3bcfa5,'language':_0x36cce2}),console['log'](alldata);}catch(_0x39bb21){console['log'](_0x39bb21);}}),router[a0_0x5366ad(0x297)](a0_0x5366ad(0x1fc),async(_0x3f1161,_0xadb9db)=>{var _0x36065c=a0_0x5366ad;const {product_code:_0x4b45e1}=_0x3f1161['body'];var _0x411f74;const _0x113cb4=await product[_0x36065c(0x1ec)]([{'$match':{'primary_code':_0x4b45e1,'product_category':_0x36065c(0x22f)}},{'$group':{'_id':_0x36065c(0x2c5),'name':{'$first':_0x36065c(0x206)},'category':{'$first':_0x36065c(0x2df)},'brand':{'$first':_0x36065c(0x233)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x36065c(0x1e1)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x36065c(0x25c)},'secondary_code':{'$first':_0x36065c(0x2ce)},'maxStocks':{'$first':_0x36065c(0x20c)},'maxProdPerUnit':{'$first':_0x36065c(0x1f9)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x36065c(0x1e2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xca88c7=await product[_0x36065c(0x1ec)]([{'$match':{'secondary_code':_0x4b45e1,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x36065c(0x2df)},'brand':{'$first':_0x36065c(0x233)},'unit':{'$first':_0x36065c(0x261)},'alertquantity':{'$first':_0x36065c(0x1e1)},'product_code':{'$first':_0x36065c(0x1fb)},'primary_code':{'$first':_0x36065c(0x25c)},'secondary_code':{'$first':_0x36065c(0x2ce)},'maxStocks':{'$first':_0x36065c(0x20c)},'maxProdPerUnit':{'$first':_0x36065c(0x1f9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x36065c(0x1e2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x113cb4[_0x36065c(0x2a5)]>0x0)_0x411f74=_0x113cb4;else _0xca88c7[_0x36065c(0x2a5)]>0x0&&(_0x411f74=_0xca88c7);_0xadb9db[_0x36065c(0x24d)](_0x411f74);}),router['post'](a0_0x5366ad(0x215),async(_0x5900f1,_0x118aba)=>{var _0xc80a3d=a0_0x5366ad;const {primaryCode:_0x85e65a,secondaryCode:_0x275b24,productCode:_0x16c7a8,bay:_0x1b9c30,bin:_0x4e06ee,types:_0x36d80a,pallet:_0x31cc6f,warehouses:_0x2b1a84,room:_0x292b49}=_0x5900f1[_0xc80a3d(0x1ee)];console[_0xc80a3d(0x1e9)](_0x5900f1[_0xc80a3d(0x1ee)]);try{const _0x4d588a=await warehouse[_0xc80a3d(0x1ec)]([{'$match':{'name':_0x2b1a84,'room':_0x292b49}},{'$unwind':_0xc80a3d(0x2aa)},{'$match':{'product_details.bay':_0x1b9c30,'product_details.bin':_0x4e06ee,'product_details.type':_0x36d80a}},{'$group':{'_id':_0xc80a3d(0x1d3),'name':{'$first':_0xc80a3d(0x201)},'product_stock':{'$first':_0xc80a3d(0x2b3)},'level':{'$first':_0xc80a3d(0x220)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xc80a3d(0x2a1)},'maxProducts':{'$first':_0xc80a3d(0x2a9)}}}]);_0x118aba['status'](0xc8)['json'](_0x4d588a);}catch(_0x5eca3b){_0x118aba[_0xc80a3d(0x205)](0x194)[_0xc80a3d(0x24d)]({'message':_0x5eca3b[_0xc80a3d(0x1c8)]});}}),module[a0_0x5366ad(0x278)]=router;