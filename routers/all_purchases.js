var a0_0xbdd9d4=a0_0x4751;function a0_0xadd8(){var _0x4635ed=['MaxStocks_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','True','secondary_code_hide','$product_details.primary_code','\x20Order\x20Number\x20:\x20','padStart','warehouse','suppliers','$warehouse_name','createTransport','back','Hindi','json','Enabled','prod_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Room_name','3076542zqFbBd','message','room_name','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/../public','An\x20error\x20occurred\x20while\x20saving\x20data.','</h5>','suppliers_docs','503073hHOrPs','exports','primary_code_hide','/all_purchases/view/','Sales\x20Update\x20successfully','<h2>\x20','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.product_stock','</span>','note','$name','post','errors','/barcode_scanner','path','/barcode/:id','Shelves','type','INC-','Paid\x20For\x20Purchase','Portuguese','all_purchases','DRY\x20STORAGE','payment\x20successfull','getFullYear','render','abs','isle','</div>','$product_details.product_code','Arabic','Logo.png','bay','edit_purchases_view','alertQTY','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','port','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','push','$product_details.secondary_code','prod_code','max_product_unit','<!DOCTYPE\x20html>','$batch_code','expiry_date','host','Arabic\x20(ae)','</table>','return_product','actual_uom','50DeZpSN','save','prod_primunit','sendMail','Level','4zmrVuR','64725jGcHSt','Chinese','$product.bay','room','/all_purchases/view','toString','2577STHzBK','types','$note','stocks','aggregate','$maxProdPerUnit','../middleware/auth','/view/return_purchase/:id','$product_details.product_name','standard_unit','foreach\x20newproduct','$suppliers','primary_code','rack','catch','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20</h2>','RoomAssign','redirect','prod_qty','</thead>','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','</tr>','Rack\x20A','$product.bin','return_purchase','$category','<h5\x20style=\x22text-align:\x20left;\x22>','product_code_hide','$product_details.bin','body','length','log','/give_payment/:id','English','$product.type','$due_amount','quantity','delivery_date','prod_secondunit','add\x20post','findOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','language','$maxStocks','storage','secondary_unit','stock_data','purchase_invoice','level','<div>','date','ejs','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.bay','An\x20error\x20occurred.','Spanish','POnumber','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','English\x20(US)','</head><body>','Purchase\x20data\x20added\x20successfully','product_list','Enclosed','$finalize','master','/view','delivery_code','$product_details.level','logo','278246lCqqAZ','$brand','product_name','warehouse_name','getDate','currency','paid_amount','$product_details.rack','<span\x20style=\x22float:\x20right;\x22>','COLD\x20STORAGE','<tr>','password','prod_isle','/preview/:id','forEach','image','edit_purchases','findById','$product','Portuguese\x20(BR)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','rak','$product_details.type','JO_number','$product_details.maxProducts','deliverycode','\x20Order\x20Date\x20:\x20','../public/language/languages.json','$_id','amount','Purchase\x20Return\x20Mail','<strong>\x20Regards\x20</strong>','$alertquantity','$product.quantity','stock_quantity','Rack\x20C','Rack\x20B','filter','product_stock','<tbody\x20style=\x22text-align:\x20center;\x22>','then','all_purchases_barcode','$return_data','get','map','floor','$primary_code','product','$date','purchase_quantity','params','German','add_purchases','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','prod_Qty','$expiry_date','<html><head><title></title>','\x20<>\x20','suppliers_data','<h5>','all','$paid_amount','return_data','secondary_code','product_code','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','random','Return\x20Goods','error','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details._id','user_id','return_qty','Receiving\x20Area','Raw\x20Materials','$suppliers_docs','$product.room_name','maxStocks','user','staff','batch_code','prod_cat','\x20<\x20wew\x20>\x20','Floor','prod_pallet','email','RMSEmail','pallet','floorlevel','126iSqnzJ','slice','getMonth','$product.floorlevel','find','$product_details','status','$product_details.floorlevel','product_cat','flash','concat','Ambient','name','/view/:id','maxperunit','French','$unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','role','Rack\x20E','prod_unit','$secondary_unit','bin','actual_qty','$product_details.pallet','</tbody>','prod_invoice','production_date','$product_code','string','4094184SjNbwx','prod_level','invoice','</body></html>','481603GIreRt'];a0_0xadd8=function(){return _0x4635ed;};return a0_0xadd8();}(function(_0x365991,_0x3bab3f){var _0x4681eb=a0_0x4751,_0x1f98c8=_0x365991();while(!![]){try{var _0x480cb9=-parseInt(_0x4681eb(0x10a))/0x1+-parseInt(_0x4681eb(0x1ae))/0x2+parseInt(_0x4681eb(0x165))/0x3*(parseInt(_0x4681eb(0x15e))/0x4)+parseInt(_0x4681eb(0x15f))/0x5*(parseInt(_0x4681eb(0xe8))/0x6)+parseInt(_0x4681eb(0x11d))/0x7+parseInt(_0x4681eb(0x106))/0x8+parseInt(_0x4681eb(0x126))/0x9*(-parseInt(_0x4681eb(0x159))/0xa);if(_0x480cb9===_0x3bab3f)break;else _0x1f98c8['push'](_0x1f98c8['shift']());}catch(_0x13e953){_0x1f98c8['push'](_0x1f98c8['shift']());}}}(a0_0xadd8,0x4f0bc));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0xbdd9d4(0x16b)),nodemailer=require('nodemailer');var ejs=require(a0_0xbdd9d4(0x19c));const path=require(a0_0xbdd9d4(0x135)),users=require(a0_0xbdd9d4(0xa9));router['get'](a0_0xbdd9d4(0x1aa),auth,async(_0x522bc3,_0x5492f8)=>{var _0x326f6f=a0_0xbdd9d4;try{const {username:_0x4b4abd,email:_0x780b3c,role:_0x5d32ae}=_0x522bc3[_0x326f6f(0xdd)],_0x49dc8b=_0x522bc3[_0x326f6f(0xdd)],_0x10bfd5=await profile[_0x326f6f(0x191)]({'email':_0x49dc8b['email']}),_0xa02706=await staff[_0x326f6f(0x191)]({'email':_0x49dc8b[_0x326f6f(0xe4)]});if(_0x49dc8b[_0x326f6f(0xfa)]==_0x326f6f(0xde)){const _0x5d61c8=await staff['findOne']({'email':_0x49dc8b[_0x326f6f(0xe4)]});}const _0x513123=await master_shop[_0x326f6f(0xec)]();let _0x2c15c4;if(_0x49dc8b[_0x326f6f(0xfa)]==_0x326f6f(0xde)){const _0x177179=await staff[_0x326f6f(0x191)]({'email':_0x49dc8b[_0x326f6f(0xe4)]});_0x2c15c4=await purchases['aggregate']([{'$match':{'warehouse_name':_0x177179[_0x326f6f(0x112)]}},{'$lookup':{'from':_0x326f6f(0x113),'localField':_0x326f6f(0x113),'foreignField':_0x326f6f(0xf4),'as':_0x326f6f(0x125)}},{'$unwind':_0x326f6f(0xda)},{'$unwind':_0x326f6f(0xa0)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x326f6f(0x170)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x326f6f(0x114)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x326f6f(0x167)},'paid_amount':{'$first':_0x326f6f(0xcb)},'due_amount':{'$first':_0x326f6f(0x18c)},'return_data':{'$first':_0x326f6f(0xb8)},'batch_code':{'$first':_0x326f6f(0x152)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x326f6f(0xda)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x326f6f(0x161)},'isle':{'$addToSet':_0x326f6f(0x180)},'type':{'$addToSet':_0x326f6f(0x18b)},'floorlevel':{'$addToSet':_0x326f6f(0xeb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2c15c4=await purchases['aggregate']([{'$lookup':{'from':_0x326f6f(0x113),'localField':_0x326f6f(0x113),'foreignField':_0x326f6f(0xf4),'as':_0x326f6f(0x125)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x326f6f(0xaa),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x326f6f(0x170)},'date':{'$first':_0x326f6f(0xbe)},'warehouse_name':{'$first':_0x326f6f(0x114)},'room':{'$addToSet':_0x326f6f(0xdb)},'product':{'$push':_0x326f6f(0xa0)},'note':{'$first':_0x326f6f(0x167)},'paid_amount':{'$first':_0x326f6f(0xcb)},'due_amount':{'$first':_0x326f6f(0x18c)},'return_data':{'$first':_0x326f6f(0xb8)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x326f6f(0xc5)},'suppliers_docs':{'$first':_0x326f6f(0xda)},'total_product_quantity':{'$sum':_0x326f6f(0xaf)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x326f6f(0x180)},'type':{'$addToSet':_0x326f6f(0x18b)},'floorlevel':{'$addToSet':_0x326f6f(0xeb)},'finalize':{'$first':_0x326f6f(0x1a8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x513123[0x0]['language']==_0x326f6f(0x1a3)){var _0x5da984=users['English'];console['log'](_0x5da984);}else{if(_0x513123[0x0][_0x326f6f(0x193)]==_0x326f6f(0x117))var _0x5da984=users[_0x326f6f(0x117)];else{if(_0x513123[0x0][_0x326f6f(0x193)]=='German')var _0x5da984=users['German'];else{if(_0x513123[0x0][_0x326f6f(0x193)]==_0x326f6f(0x1a0))var _0x5da984=users[_0x326f6f(0x1a0)];else{if(_0x513123[0x0][_0x326f6f(0x193)]==_0x326f6f(0xf7))var _0x5da984=users['French'];else{if(_0x513123[0x0][_0x326f6f(0x193)]==_0x326f6f(0xa1))var _0x5da984=users[_0x326f6f(0x13b)];else{if(_0x513123[0x0][_0x326f6f(0x193)]==_0x326f6f(0x160))var _0x5da984=users[_0x326f6f(0x160)];else{if(_0x513123[0x0][_0x326f6f(0x193)]==_0x326f6f(0x155))var _0x5da984=users[_0x326f6f(0x145)];}}}}}}}_0x5492f8[_0x326f6f(0x140)](_0x326f6f(0x13c),{'success':_0x522bc3[_0x326f6f(0xf1)]('success'),'errors':_0x522bc3['flash'](_0x326f6f(0x133)),'purchases':_0x2c15c4,'role':_0x49dc8b,'profile':_0x10bfd5,'master_shop':_0x513123,'language':_0x5da984});}catch(_0x4bc9df){console[_0x326f6f(0x188)]('table\x20page',_0x4bc9df),_0x5492f8['status'](0xc8)[_0x326f6f(0x118)]({'message':_0x4bc9df['message']});}});function a0_0x4751(_0x4b723f,_0x5be5da){var _0xadd8a6=a0_0xadd8();return a0_0x4751=function(_0x47518b,_0x556eba){_0x47518b=_0x47518b-0x95;var _0x12111f=_0xadd8a6[_0x47518b];return _0x12111f;},a0_0x4751(_0x4b723f,_0x5be5da);}function BayBinSelected(_0x34e6f2,_0x5c5f62){var _0x387ad8=a0_0xbdd9d4,_0x1d4f87=[],_0x1c5f8d=[],_0x46fd56=[],_0x5abafe=[],_0x588802=[],_0xac8a4f=[];let _0x372343=[];if(_0x34e6f2==_0x387ad8(0x13d))switch(_0x5c5f62){case _0x387ad8(0x17f):_0x1d4f87=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1c5f8d=[0x1,0x2],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0x15d),_0x387ad8(0xe2)],_0x588802=['D'],_0xac8a4f=['A'];break;case _0x387ad8(0xb2):_0x1d4f87=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1c5f8d=[0x1,0x2],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0x15d),_0x387ad8(0xe2)],_0x588802=['D'],_0xac8a4f=['B'];break;case _0x387ad8(0x137):_0x1d4f87=[0x0],_0x1c5f8d=[0x0],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0xe2)],_0x588802=['D'],_0xac8a4f=['S'];break;case _0x387ad8(0xd8):_0x1d4f87=[0x0],_0x1c5f8d=[0x0],_0x5abafe=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x46fd56=[_0x387ad8(0xe2)],_0x588802=['D'],_0xac8a4f=['R'];break;}else{if(_0x34e6f2==_0x387ad8(0x97))switch(_0x5c5f62){case'Rack\x20A':_0x1d4f87=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1c5f8d=['B','F'],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=['Level',_0x387ad8(0xe2)],_0x588802=['C'],_0xac8a4f=['A'];break;case _0x387ad8(0xb2):_0x1d4f87=[0x5,0x4,0x3,0x2,0x1],_0x1c5f8d=['F','B','S'],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0x15d),_0x387ad8(0xe2)],_0x588802=['C'],_0xac8a4f=['B'];break;case _0x387ad8(0xb1):_0x1d4f87=[0x1,0x2,0x3,0x4,0x5],_0x1c5f8d=['B','F','S'],_0x5abafe=[0x5,0x4,0x3,0x2,0x1],_0x46fd56=['Level',_0x387ad8(0xe2)],_0x588802=['C'],_0xac8a4f=['C'];break;case'Rack\x20D':_0x1d4f87=[0x5,0x4,0x3,0x2,0x1],_0x1c5f8d=['F','B','S'],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0x15d),_0x387ad8(0xe2)],_0x588802=['C'],_0xac8a4f=['D'];break;case _0x387ad8(0xfb):_0x1d4f87=[0x4,0x3,0x2,0x1],_0x1c5f8d=[0x1,0x2],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0x15d),_0x387ad8(0xe2)],_0x588802=['C'],_0xac8a4f=['E'];break;case'Rack\x20F':_0x1d4f87=[0x1,0x2,0x3],_0x1c5f8d=[0x1,0x2],_0x5abafe=[0x1,0x2,0x3,0x4,0x5],_0x46fd56=[_0x387ad8(0x15d)],_0x588802=['C'],_0xac8a4f=['F'];break;}}return{'levels':_0x1d4f87,'Isle':_0x1c5f8d,'rack':_0x5abafe,'type':_0x46fd56,'storage':_0x588802,'rak':_0xac8a4f};}async function getRandom8DigitNumber(){var _0x3c50d9=a0_0xbdd9d4;const _0x3af37d=0x989680,_0x5dfca8=0x5f5e0ff,_0xe18955=Math[_0x3c50d9(0xbb)](Math[_0x3c50d9(0xd1)]()*(_0x5dfca8-_0x3af37d+0x1))+_0x3af37d;var _0x3cd5a2;const _0xf97a20=await purchases[_0x3c50d9(0x191)]({'invoice':'INC-'+_0xe18955});return _0xf97a20&&_0xf97a20[_0x3c50d9(0x187)]>0x0?_0x3cd5a2='INC-'+_0xe18955:_0x3cd5a2='INC-'+_0xe18955,_0x3cd5a2;}router['get']('/view/add_purchases',auth,async(_0x4e9162,_0x147e8c)=>{var _0x3ac354=a0_0xbdd9d4;try{const {username:_0x4316c6,email:_0x5a8e85,role:_0x307dc9}=_0x4e9162[_0x3ac354(0xdd)],_0x283d3d=_0x4e9162['user'],_0xcc7a3e=await profile[_0x3ac354(0x191)]({'email':_0x283d3d[_0x3ac354(0xe4)]}),_0x5bc39f=await master_shop[_0x3ac354(0xec)](),_0x732be7=await staff[_0x3ac354(0x191)]({'email':_0x283d3d[_0x3ac354(0xe4)]}),_0x485421=await suppliers[_0x3ac354(0xec)]({});let _0x355ad0;if(_0x283d3d['role']==_0x3ac354(0xde)){const _0x116ead=await staff[_0x3ac354(0x191)]({'email':_0x283d3d[_0x3ac354(0xe4)]});_0x355ad0=await warehouse[_0x3ac354(0x169)]([{'$match':{'status':'Enabled','name':_0x116ead[_0x3ac354(0x112)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3ac354(0xd2)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x355ad0=await warehouse[_0x3ac354(0x169)]([{'$match':{'status':'Enabled','warehouse_category':_0x3ac354(0xd9),'name':{'$ne':_0x3ac354(0xd2)}}},{'$group':{'_id':_0x3ac354(0x131),'name':{'$first':_0x3ac354(0x131)}}}]);const _0x610518=await product['find']({}),_0x5ba1cd=await warehouse[_0x3ac354(0xec)]({'status':_0x3ac354(0x119)}),_0x945f40=await purchases[_0x3ac354(0xec)]({}),_0x408c1c=_0x945f40[_0x3ac354(0x187)]+0x1,_0x4f5731=_0x3ac354(0x139)+_0x408c1c[_0x3ac354(0x164)]()[_0x3ac354(0x111)](0x5,'0');var _0x1b5108=[_0x3ac354(0xf3),_0x3ac354(0x1a7)];if(_0x5bc39f[0x0][_0x3ac354(0x193)]==_0x3ac354(0x1a3))var _0x1ab3a0=users['English'];else{if(_0x5bc39f[0x0][_0x3ac354(0x193)]==_0x3ac354(0x117))var _0x1ab3a0=users[_0x3ac354(0x117)];else{if(_0x5bc39f[0x0][_0x3ac354(0x193)]=='German')var _0x1ab3a0=users['German'];else{if(_0x5bc39f[0x0][_0x3ac354(0x193)]=='Spanish')var _0x1ab3a0=users[_0x3ac354(0x1a0)];else{if(_0x5bc39f[0x0][_0x3ac354(0x193)]=='French')var _0x1ab3a0=users[_0x3ac354(0xf7)];else{if(_0x5bc39f[0x0][_0x3ac354(0x193)]==_0x3ac354(0xa1))var _0x1ab3a0=users[_0x3ac354(0x13b)];else{if(_0x5bc39f[0x0][_0x3ac354(0x193)]==_0x3ac354(0x160))var _0x1ab3a0=users[_0x3ac354(0x160)];else{if(_0x5bc39f[0x0]['language']==_0x3ac354(0x155))var _0x1ab3a0=users[_0x3ac354(0x145)];}}}}}}}const _0x2b7791=getRandom8DigitNumber();_0x2b7791[_0x3ac354(0xb6)](_0x413e1d=>{var _0x431c49=_0x3ac354;_0x147e8c[_0x431c49(0x140)](_0x431c49(0xc2),{'success':_0x4e9162['flash']('success'),'errors':_0x4e9162[_0x431c49(0xf1)]('errors'),'role':_0x283d3d,'profile':_0xcc7a3e,'suppliers':_0x485421,'warehouse':_0x355ad0,'product':_0x610518,'invoice':_0x413e1d,'master_shop':_0x5bc39f,'language':_0x1ab3a0,'find_data':_0x5ba1cd,'rooms_data':_0x1b5108});})[_0x3ac354(0x173)](_0x401872=>{var _0x4a866e=_0x3ac354;_0x4e9162[_0x4a866e(0xf1)](_0x4a866e(0x133),_0x4a866e(0x11b)),_0x147e8c[_0x4a866e(0x178)](_0x4a866e(0x163));});}catch(_0x1e76c6){console['log'](_0x1e76c6);}}),router[a0_0xbdd9d4(0xb9)]('/view/add_purchases/:id',auth,async(_0x58557f,_0xad4a29)=>{var _0x2eddc3=a0_0xbdd9d4;try{const _0x3d0ba7=_0x58557f['params']['id'];console['log'](_0x3d0ba7);const _0x5ead31=await master_shop[_0x2eddc3(0xec)]();console[_0x2eddc3(0x188)](_0x2eddc3(0x1a9),_0x5ead31);const _0x57b092=await product[_0x2eddc3(0x191)]({'name':_0x3d0ba7});console[_0x2eddc3(0x188)]('product',_0x57b092),_0xad4a29[_0x2eddc3(0xee)](0xc8)['json']({'product_data':_0x57b092,'master':_0x5ead31});}catch(_0x2be2cf){console[_0x2eddc3(0x188)]('add_purchases\x20error',_0x2be2cf);}}),router['post']('/view/add_purchases',auth,async(_0x315147,_0x50b766)=>{var _0x595e3b=a0_0xbdd9d4;try{const {invoice:_0x554658,date:_0x3a4773,warehouse_name:_0x20a285,prod_name:_0x5f0415,prod_code:_0x468165,prod_qty:_0x6cf769,prod_unit:_0x43867c,prod_secondunit:_0x37b60f,prod_level:_0x3decaf,prod_isle:_0x8904bc,prod_pallet:_0x22b801,note:_0x2905e3,expiry_date:_0x48fb60,batch_code:_0x2c244c,payable:_0x50233a,due_amount:_0x484ca5,Room_name:_0x5bf6bb,primary_code:_0x2d6339,secondary_code:_0x2893dc,MaxStocks_data:_0x5da8d9,PO_number:_0x2a031f,SCRN:_0x43cba1,JO_number:_0xd7b59d}=_0x315147[_0x595e3b(0x186)];if(typeof _0x5f0415=='string')var _0x5ecaf9=[_0x315147['body'][_0x595e3b(0x11a)]],_0x1d4d85=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x14f)]],_0x5ce7f5=[_0x315147[_0x595e3b(0x186)]['prod_Qty']],_0x311b41=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x15b)]],_0x3549ef=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x18f)]],_0x3075a0=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x107)]],_0x2f7945=[_0x315147[_0x595e3b(0x186)]['primary_code']],_0x123a8b=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0xcd)]],_0x5eda9e=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x10b)]],_0x27ccd5=[_0x315147['body'][_0x595e3b(0xdf)]],_0x19482c=[_0x315147['body'][_0x595e3b(0x153)]],_0x1418d5=[_0x315147[_0x595e3b(0x186)]['max_product_unit']],_0x589b0f=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x149)]],_0x4359c1=[_0x315147[_0x595e3b(0x186)]['production_date']],_0x55941d=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0xe0)]],_0x1556b1=[_0x315147['body']['RoomAssign']],_0x4da354=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0xa7)]],_0x344ae8=[_0x315147['body']['prod_invoice']],_0x2a016e=[_0x315147['body'][_0x595e3b(0xff)]],_0x5c0582=[_0x315147[_0x595e3b(0x186)][_0x595e3b(0x158)]];else var _0x5ecaf9=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x11a)]],_0x1d4d85=[..._0x315147[_0x595e3b(0x186)]['prod_code']],_0x5ce7f5=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0xc4)]],_0x311b41=[..._0x315147['body'][_0x595e3b(0x15b)]],_0x3549ef=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x18f)]],_0x3075a0=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x107)]],_0x2f7945=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x171)]],_0x123a8b=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0xcd)]],_0x5eda9e=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x10b)]],_0x27ccd5=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0xdf)]],_0x19482c=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x153)]],_0x1418d5=[..._0x315147['body'][_0x595e3b(0x150)]],_0x589b0f=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x149)]],_0x4359c1=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x103)]],_0x55941d=[..._0x315147['body'][_0x595e3b(0xe0)]],_0x1556b1=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x177)]],_0x4da354=[..._0x315147['body'][_0x595e3b(0xa7)]],_0x344ae8=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x102)]],_0x2a016e=[..._0x315147[_0x595e3b(0x186)]['actual_qty']],_0x5c0582=[..._0x315147[_0x595e3b(0x186)][_0x595e3b(0x158)]];const _0x492048=_0x5ecaf9['map'](_0xce870a=>{return _0xce870a={'product_name':_0xce870a};});_0x2a016e[_0x595e3b(0x9c)]((_0x581d8b,_0x1ee364)=>{var _0x49637b=_0x595e3b;_0x492048[_0x1ee364][_0x49637b(0xff)]=Math[_0x49637b(0x141)](_0x581d8b);}),_0x5c0582[_0x595e3b(0x9c)]((_0x3e84a2,_0x4c3ee5)=>{var _0x517be8=_0x595e3b;_0x492048[_0x4c3ee5][_0x517be8(0x158)]=_0x3e84a2;}),_0x1d4d85[_0x595e3b(0x9c)]((_0x23b564,_0x5bf0b2)=>{var _0x5210b5=_0x595e3b;_0x492048[_0x5bf0b2][_0x5210b5(0xce)]=_0x23b564;}),_0x5ce7f5[_0x595e3b(0x9c)]((_0x5ec309,_0x1b6842)=>{var _0x286294=_0x595e3b;_0x492048[_0x1b6842][_0x286294(0x18d)]=Math[_0x286294(0x141)](_0x5ec309);}),_0x311b41[_0x595e3b(0x9c)]((_0xe46c5,_0x121962)=>{var _0x2ef1d9=_0x595e3b;_0x492048[_0x121962][_0x2ef1d9(0x16e)]=_0xe46c5;}),_0x3549ef['forEach']((_0x596a00,_0x3f96f1)=>{var _0x57c542=_0x595e3b;_0x492048[_0x3f96f1][_0x57c542(0x196)]=_0x596a00;}),_0x3075a0[_0x595e3b(0x9c)]((_0x1eb26f,_0x436a23)=>{var _0x50c2f1=_0x595e3b;_0x1556b1[_0x50c2f1(0x9c)]((_0x134c25,_0x140c45)=>{var _0x2b3a1c=_0x50c2f1;if(_0x134c25==_0x2b3a1c(0xd8)&&_0x436a23==_0x140c45){console['log'](_0x134c25+_0x2b3a1c(0xe1)+_0x436a23+'\x20<>\x20'+_0x140c45+_0x2b3a1c(0xc7)+_0x1eb26f);var _0x48fdbe=_0x1eb26f[_0x2b3a1c(0xe9)](0x3);_0x492048[_0x436a23][_0x2b3a1c(0x195)]=_0x1eb26f[0x0],_0x492048[_0x436a23][_0x2b3a1c(0x172)]=_0x1eb26f[0x1],_0x492048[_0x436a23][_0x2b3a1c(0x147)]=0x0,_0x492048[_0x436a23]['bin']=0x0,_0x492048[_0x436a23][_0x2b3a1c(0x138)]='Floor',_0x492048[_0x436a23]['floorlevel']=_0x48fdbe;}else{if(_0x134c25==_0x2b3a1c(0x137)&&_0x436a23==_0x140c45){var _0x48fdbe=_0x1eb26f[_0x2b3a1c(0xe9)](0x3);_0x492048[_0x436a23][_0x2b3a1c(0x195)]=_0x1eb26f[0x0],_0x492048[_0x436a23]['rack']=_0x1eb26f[0x1],_0x492048[_0x436a23]['bay']=0x0,_0x492048[_0x436a23][_0x2b3a1c(0xfe)]=0x0,_0x492048[_0x436a23][_0x2b3a1c(0x138)]=_0x2b3a1c(0xe2),_0x492048[_0x436a23][_0x2b3a1c(0xe7)]=_0x1eb26f[0x5];}else{if(_0x436a23==_0x140c45){if(_0x1eb26f[0x0]=='A'&&_0x1eb26f[0x1]=='L'&&_0x1eb26f[0x2]=='L')console[_0x2b3a1c(0x188)](_0x134c25+_0x2b3a1c(0xc7)+_0x436a23+_0x2b3a1c(0xc7)+_0x140c45+_0x2b3a1c(0xc7)+_0x1eb26f+'here'),_0x492048[_0x436a23][_0x2b3a1c(0x195)]=_0x1eb26f[0x0],_0x492048[_0x436a23]['rack']=_0x1eb26f[0x1],_0x492048[_0x436a23]['bay']=0x0,_0x492048[_0x436a23]['bin']=0x0,_0x492048[_0x436a23][_0x2b3a1c(0x138)]='Floor',_0x492048[_0x436a23]['floorlevel']=_0x1eb26f[0x3];else{var _0x179c89;if(_0x1eb26f[0x4]=='L')_0x179c89=_0x2b3a1c(0x15d);else _0x1eb26f[0x4]=='F'&&(_0x179c89=_0x2b3a1c(0xe2));_0x492048[_0x436a23][_0x2b3a1c(0x195)]=_0x1eb26f[0x0],_0x492048[_0x436a23][_0x2b3a1c(0x172)]=_0x1eb26f[0x1],_0x492048[_0x436a23][_0x2b3a1c(0x147)]=_0x1eb26f[0x2],_0x492048[_0x436a23]['bin']=_0x1eb26f[0x3],_0x492048[_0x436a23][_0x2b3a1c(0x138)]=_0x179c89,_0x492048[_0x436a23][_0x2b3a1c(0xe7)]=_0x1eb26f[0x5];}}}}});}),_0x2f7945[_0x595e3b(0x9c)]((_0xb294f5,_0x3bcad9)=>{_0x492048[_0x3bcad9]['primary_code']=_0xb294f5;}),_0x123a8b[_0x595e3b(0x9c)]((_0x8d86f3,_0x1d2ac7)=>{_0x492048[_0x1d2ac7]['secondary_code']=_0x8d86f3;}),_0x5eda9e[_0x595e3b(0x9c)]((_0x3317fe,_0x10d3b2)=>{_0x492048[_0x10d3b2]['maxStocks']=_0x3317fe;}),_0x27ccd5[_0x595e3b(0x9c)]((_0x4331df,_0x46adc8)=>{var _0xc72a95=_0x595e3b;_0x492048[_0x46adc8][_0xc72a95(0xdf)]=_0x4331df;}),_0x19482c[_0x595e3b(0x9c)]((_0x584b1e,_0xe96ca2)=>{var _0x2f757a=_0x595e3b;_0x492048[_0xe96ca2][_0x2f757a(0x153)]=_0x584b1e;}),_0x1418d5[_0x595e3b(0x9c)]((_0x4f3c24,_0x53a279)=>{var _0x3ea754=_0x595e3b;_0x492048[_0x53a279][_0x3ea754(0xf6)]=_0x4f3c24;}),_0x589b0f['forEach']((_0x4b791c,_0x51da56)=>{_0x492048[_0x51da56]['alertQTY']=_0x4b791c;}),_0x4359c1['forEach']((_0x1e150c,_0x590182)=>{_0x492048[_0x590182]['production_date']=_0x1e150c;}),_0x55941d[_0x595e3b(0x9c)]((_0x204588,_0x31c843)=>{var _0x1bd4d1=_0x595e3b;_0x492048[_0x31c843][_0x1bd4d1(0xf0)]=_0x204588;}),_0x1556b1[_0x595e3b(0x9c)]((_0x1237d3,_0x1a4a8d)=>{var _0xbbd7e2=_0x595e3b;_0x492048[_0x1a4a8d][_0xbbd7e2(0x11f)]=_0x1237d3;}),_0x4da354[_0x595e3b(0x9c)]((_0x22aa1c,_0x20bec2)=>{var _0x3f0821=_0x595e3b;_0x492048[_0x20bec2][_0x3f0821(0x1ab)]=_0x22aa1c;}),_0x344ae8['forEach']((_0x357a87,_0x2eb30c)=>{_0x492048[_0x2eb30c]['invoice']=_0x357a87;});const _0x36d463=_0x1556b1['map'](_0x17ff71=>{return _0x17ff71={'room_name':_0x17ff71};}),_0x1a950d=_0x492048[_0x595e3b(0xb3)](_0x4026c7=>_0x4026c7[_0x595e3b(0x18d)]!=='0'&&_0x4026c7['quantity']!==''),_0xaa741e=new purchases({'invoice':_0x554658,'suppliers':_0x315147[_0x595e3b(0x186)][_0x595e3b(0x113)],'date':_0x3a4773,'warehouse_name':_0x20a285,'product':_0x1a950d,'note':_0x2905e3,'due_amount':_0x484ca5,'POnumber':_0x2a031f,'SCRN':_0x43cba1,'JO_number':_0xd7b59d,'roomList':_0x36d463}),_0x6b935f=await _0xaa741e[_0x595e3b(0x15a)](),_0x558fc9=await purchases[_0x595e3b(0x191)]({'invoice':_0x554658}),_0xcebe8c=_0x558fc9[_0x595e3b(0xbd)]['map'](async _0xf2ffea=>{var _0xaeb603=_0x595e3b,_0x8da462=await warehouse[_0xaeb603(0x191)]({'name':_0x20a285,'room':_0xf2ffea['room_name']}),_0x34d8fd=0x0;return _0x8da462[_0xaeb603(0x120)][_0xaeb603(0x9c)](_0x3a008e=>{var _0x45dccf=_0xaeb603;_0x3a008e[_0x45dccf(0x1b0)]==_0xf2ffea[_0x45dccf(0x1b0)]&&_0x3a008e[_0x45dccf(0xe7)]==_0xf2ffea[_0x45dccf(0xe7)]&&_0x3a008e['type']==_0xf2ffea[_0x45dccf(0x138)]&&_0x3a008e['bin']==_0xf2ffea['bin']&&_0x3a008e['bay']==_0xf2ffea[_0x45dccf(0x147)]&&_0x3a008e['rack']==_0xf2ffea[_0x45dccf(0x172)]&&_0x3a008e[_0x45dccf(0x195)]==_0xf2ffea[_0x45dccf(0x195)]&&_0x3a008e[_0x45dccf(0x153)]==_0xf2ffea[_0x45dccf(0x153)]&&_0x3a008e[_0x45dccf(0xdf)]==_0xf2ffea['batch_code']&&_0x3a008e['production_date']==_0xf2ffea[_0x45dccf(0x103)]&&_0x3a008e[_0x45dccf(0x108)]==_0x558fc9[_0x45dccf(0x108)]&&(_0x3a008e[_0x45dccf(0xb4)]+=Math[_0x45dccf(0x141)](_0xf2ffea['quantity']),_0x34d8fd++);}),_0x34d8fd===0x0&&_0x8da462[_0xaeb603(0x120)][_0xaeb603(0x14d)]({'product_name':_0xf2ffea[_0xaeb603(0x1b0)],'product_stock':Math[_0xaeb603(0x141)](_0xf2ffea[_0xaeb603(0x18d)]),'primary_code':_0xf2ffea[_0xaeb603(0x171)],'secondary_code':_0xf2ffea[_0xaeb603(0xcd)],'product_code':_0xf2ffea['product_code'],'storage':_0xf2ffea[_0xaeb603(0x195)],'rack':_0xf2ffea[_0xaeb603(0x172)],'bay':_0xf2ffea['bay'],'bin':_0xf2ffea[_0xaeb603(0xfe)],'type':_0xf2ffea['type'],'floorlevel':_0xf2ffea['floorlevel'],'maxProducts':_0xf2ffea[_0xaeb603(0xdc)],'unit':_0xf2ffea['standard_unit'],'secondary_unit':_0xf2ffea[_0xaeb603(0x196)],'expiry_date':_0xf2ffea['expiry_date'],'maxPerUnit':_0xf2ffea[_0xaeb603(0xf6)],'batch_code':_0xf2ffea['batch_code'],'alertQTY':_0xf2ffea[_0xaeb603(0x149)],'production_date':_0xf2ffea[_0xaeb603(0x103)],'product_cat':_0xf2ffea[_0xaeb603(0xf0)],'invoice':_0xf2ffea[_0xaeb603(0x108)],'actual_qty':Math[_0xaeb603(0x141)](_0xf2ffea[_0xaeb603(0xff)]),'actual_uom':_0xf2ffea[_0xaeb603(0x158)]}),_0x8da462;});Promise[_0x595e3b(0xca)](_0xcebe8c)[_0x595e3b(0xb6)](async _0xdc5409=>{var _0x1f0865=_0x595e3b;try{for(const _0x2cfdb1 of _0xdc5409){await _0x2cfdb1[_0x1f0865(0x15a)]();}const _0xc9c724=await master_shop[_0x1f0865(0xec)](),_0x21398b=await email_settings[_0x1f0865(0x191)](),_0x41c638=await supervisor_settings[_0x1f0865(0xec)]();var _0x4c453b=_0x558fc9[_0x1f0865(0xbd)],_0x581a53='',_0x2e318b;for(_0x2e318b in _0x4c453b){_0x581a53+='<tr>'+_0x1f0865(0x19d)+_0x4c453b[_0x2e318b][_0x1f0865(0x1b0)]+_0x1f0865(0x12c)+_0x1f0865(0x19d)+_0x4c453b[_0x2e318b][_0x1f0865(0xce)]+_0x1f0865(0x12c)+_0x1f0865(0x19d)+_0x4c453b[_0x2e318b][_0x1f0865(0x18d)]+_0x1f0865(0x12c)+_0x1f0865(0x19d)+_0x4c453b[_0x2e318b][_0x1f0865(0x16e)]+'</td>'+_0x1f0865(0x19d)+_0x4c453b[_0x2e318b][_0x1f0865(0x196)]+_0x1f0865(0x12c)+_0x1f0865(0x19d)+_0x558fc9[_0x1f0865(0x1b1)]+_0x1f0865(0x12c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c453b[_0x2e318b][_0x1f0865(0x11f)]+_0x1f0865(0x12c)+_0x1f0865(0x19d)+_0x4c453b[_0x2e318b]['storage']+_0x4c453b[_0x2e318b][_0x1f0865(0x172)]+_0x4c453b[_0x2e318b]['bay']+_0x4c453b[_0x2e318b][_0x1f0865(0xfe)]+_0x4c453b[_0x2e318b]['type'][0x0]+_0x4c453b[_0x2e318b][_0x1f0865(0xe7)]+_0x1f0865(0x12c),_0x1f0865(0x17e);}let _0x4d3718=nodemailer[_0x1f0865(0x115)]({'host':_0x21398b[_0x1f0865(0x154)],'port':Number(_0x21398b[_0x1f0865(0x14b)]),'secure':![],'auth':{'user':_0x21398b[_0x1f0865(0xe4)],'pass':_0x21398b[_0x1f0865(0x99)]}}),_0x8ad093={'from':_0x21398b[_0x1f0865(0xe4)],'to':_0x41c638[0x0][_0x1f0865(0xe5)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x1f0865(0x146),'path':__dirname+_0x1f0865(0x122)+_0x1f0865(0x174)+_0xc9c724[0x0][_0x1f0865(0x9d)],'cid':_0x1f0865(0x1ad)}],'html':_0x1f0865(0x151)+_0x1f0865(0xc6)+_0x1f0865(0x1a4)+'<div>'+_0x1f0865(0x192)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1f0865(0x143)+_0x1f0865(0x19a)+_0x1f0865(0x12b)+_0xc9c724[0x0]['site_title']+_0x1f0865(0x176)+'</div>'+_0x1f0865(0x143)+'<hr\x20class=\x22my-3\x22>'+_0x1f0865(0x19a)+_0x1f0865(0x183)+_0x1f0865(0x110)+_0x558fc9['invoice']+'\x20'+_0x1f0865(0x96)+_0x1f0865(0xa8)+_0x558fc9[_0x1f0865(0x19b)]+'\x20'+_0x1f0865(0x12f)+'</h5>'+'</div>'+_0x1f0865(0xd4)+_0x1f0865(0x10c)+_0x1f0865(0x98)+_0x1f0865(0x1a2)+_0x1f0865(0x121)+_0x1f0865(0x175)+_0x1f0865(0xf9)+_0x1f0865(0x17c)+_0x1f0865(0x12d)+_0x1f0865(0xd0)+_0x1f0865(0x14a)+_0x1f0865(0x17e)+_0x1f0865(0x17a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x581a53+'\x20'+'</tbody>'+_0x1f0865(0x156)+_0x1f0865(0x19a)+_0x1f0865(0xad)+_0x1f0865(0xc9)+_0xc9c724[0x0]['site_title']+_0x1f0865(0x124)+_0x1f0865(0x143)+_0x1f0865(0x143)+_0x1f0865(0x109)};_0x4d3718[_0x1f0865(0x15c)](_0x8ad093,function(_0x431146,_0x232777){var _0x128600=_0x1f0865;_0x431146?(console[_0x128600(0x188)](_0x431146),console[_0x128600(0x188)]('Error\x20Occurs')):console[_0x128600(0x188)]('Email\x20sent\x20successfully');}),_0x315147[_0x1f0865(0xf1)](_0x1f0865(0xcf),_0x1f0865(0x1a5)),_0x50b766[_0x1f0865(0x178)](_0x1f0865(0x129));}catch(_0x12a0fe){console[_0x1f0865(0xd3)](_0x12a0fe),_0x50b766['status'](0x1f4)['json']({'error':_0x1f0865(0x123)});}})[_0x595e3b(0x173)](_0xda53d2=>{var _0x4d843d=_0x595e3b;console['error'](_0xda53d2),_0x50b766[_0x4d843d(0xee)](0x1f4)[_0x4d843d(0x118)]({'error':_0x4d843d(0x19f)});});}catch(_0x2a68da){console[_0x595e3b(0x188)](_0x2a68da);}}),router['get'](a0_0xbdd9d4(0x9b),auth,async(_0x2f30d9,_0x5532d7)=>{var _0x359b59=a0_0xbdd9d4;try{const {username:_0x47ce6e,email:_0x356ec8,role:_0x17ca6f}=_0x2f30d9['user'],_0x57377c=_0x2f30d9[_0x359b59(0xdd)],_0x167028=await profile[_0x359b59(0x191)]({'email':_0x57377c[_0x359b59(0xe4)]}),_0x4b2c5f=await master_shop[_0x359b59(0xec)](),_0x5f6686=_0x2f30d9[_0x359b59(0xc0)]['id'],_0x2fb1a6=await purchases[_0x359b59(0x9f)](_0x5f6686),_0x1962c4=await warehouse[_0x359b59(0x169)]([{'$match':{'name':_0x2fb1a6[_0x359b59(0x1b1)],'room':_0x2fb1a6['room']}},{'$unwind':_0x359b59(0xed)},{'$group':{'_id':_0x359b59(0xd5),'name':{'$first':_0x359b59(0x16d)},'product_stock':{'$first':_0x359b59(0x12e)},'bay':{'$first':_0x359b59(0x19e)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x359b59(0xa4)},'floorlevel':{'$first':_0x359b59(0xef)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x359b59(0x14e)},'product_code':{'$first':_0x359b59(0x144)},'storage':{'$first':_0x359b59(0x17b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x12571a=await customer[_0x359b59(0xec)]({});let _0x56888b;if(_0x57377c[_0x359b59(0xfa)]==_0x359b59(0xde)){const _0x31d091=await staff[_0x359b59(0x191)]({'email':_0x57377c[_0x359b59(0xe4)]});_0x56888b=await warehouse[_0x359b59(0x169)]([{'$match':{'status':'Enabled','name':_0x31d091[_0x359b59(0x112)]}},{'$group':{'_id':'$name','name':{'$first':_0x359b59(0x131)}}}]);}else _0x56888b=await warehouse['aggregate']([{'$match':{'status':_0x359b59(0x119)}},{'$group':{'_id':_0x359b59(0x131),'name':{'$first':_0x359b59(0x131)}}}]);const _0x51e999=await product[_0x359b59(0xec)]({}),_0x233565=await suppliers[_0x359b59(0xec)]({}),_0x51401c=BayBinSelected(_0x2fb1a6[_0x359b59(0x1b1)],_0x2fb1a6[_0x359b59(0x162)]);if(_0x4b2c5f[0x0][_0x359b59(0x193)]==_0x359b59(0x1a3)){var _0x13d860=users[_0x359b59(0x18a)];console[_0x359b59(0x188)](_0x13d860);}else{if(_0x4b2c5f[0x0][_0x359b59(0x193)]==_0x359b59(0x117))var _0x13d860=users[_0x359b59(0x117)];else{if(_0x4b2c5f[0x0][_0x359b59(0x193)]==_0x359b59(0xc1))var _0x13d860=users['German'];else{if(_0x4b2c5f[0x0]['language']=='Spanish')var _0x13d860=users[_0x359b59(0x1a0)];else{if(_0x4b2c5f[0x0][_0x359b59(0x193)]=='French')var _0x13d860=users[_0x359b59(0xf7)];else{if(_0x4b2c5f[0x0][_0x359b59(0x193)]=='Portuguese\x20(BR)')var _0x13d860=users['Portuguese'];else{if(_0x4b2c5f[0x0][_0x359b59(0x193)]==_0x359b59(0x160))var _0x13d860=users[_0x359b59(0x160)];else{if(_0x4b2c5f[0x0]['language']=='Arabic\x20(ae)')var _0x13d860=users['Arabic'];}}}}}}}_0x5532d7[_0x359b59(0x140)](_0x359b59(0x148),{'success':_0x2f30d9[_0x359b59(0xf1)](_0x359b59(0xcf)),'errors':_0x2f30d9[_0x359b59(0xf1)](_0x359b59(0x133)),'role':_0x57377c,'profile':_0x167028,'customer':_0x12571a,'warehouse':_0x56888b,'product':_0x1962c4,'user':_0x2fb1a6,'master_shop':_0x4b2c5f,'unit':_0x51e999,'language':_0x13d860,'suppliers':_0x233565,'dataSelected':_0x51401c});}catch(_0x4f7e61){console[_0x359b59(0x188)](_0x4f7e61);}}),router[a0_0xbdd9d4(0x132)]('/preview/:id',auth,async(_0x5aec61,_0x24af8f)=>{var _0x5caf60=a0_0xbdd9d4;try{const _0x11306f=_0x5aec61['params']['id'],{invoice:_0x518bbd,warehouse_name:_0x1d9f4e,Room_name:_0x1c2465}=_0x5aec61[_0x5caf60(0x186)],_0x37ed91=await warehouse[_0x5caf60(0x191)]({'name':_0x1d9f4e,'room':_0x1c2465}),_0x5eed1e=await purchases[_0x5caf60(0x191)]({'invoice':_0x518bbd});_0x5eed1e[_0x5caf60(0xbd)][_0x5caf60(0x9c)](_0x467e1c=>{var _0x29c4b6=_0x5caf60,_0x1ec16a=0x0;const _0x54b451=_0x37ed91[_0x29c4b6(0x120)][_0x29c4b6(0xba)](_0xe2b09=>{var _0x5a3aed=_0x29c4b6;_0xe2b09['product_name']==_0x467e1c[_0x5a3aed(0x1b0)]&&_0xe2b09[_0x5a3aed(0xe7)]==_0x467e1c['floorlevel']&&_0xe2b09[_0x5a3aed(0x138)]==_0x467e1c[_0x5a3aed(0x138)]&&_0xe2b09[_0x5a3aed(0xfe)]==_0x467e1c[_0x5a3aed(0xfe)]&&_0xe2b09['bay']==_0x467e1c[_0x5a3aed(0x147)]&&_0xe2b09['rack']==_0x467e1c[_0x5a3aed(0x172)]&&_0xe2b09[_0x5a3aed(0x195)]==_0x467e1c[_0x5a3aed(0x195)]&&_0xe2b09['expiry_date']==_0x467e1c[_0x5a3aed(0x153)]&&_0xe2b09['batch_code']==_0x467e1c[_0x5a3aed(0xdf)]&&_0xe2b09[_0x5a3aed(0x103)]==_0x467e1c[_0x5a3aed(0x103)]&&_0xe2b09['delivery_date']==_0x467e1c[_0x5a3aed(0x18e)]&&_0xe2b09['delivery_code']==_0x467e1c['delivery_code']&&(_0xe2b09['product_stock']=parseInt(_0xe2b09[_0x5a3aed(0xb4)])+parseInt(_0x467e1c[_0x5a3aed(0x18d)]),_0x1ec16a++);});_0x1ec16a=='0'&&(_0x37ed91[_0x29c4b6(0x120)]=_0x37ed91[_0x29c4b6(0x120)][_0x29c4b6(0xf2)]({'product_name':_0x467e1c[_0x29c4b6(0x1b0)],'product_stock':_0x467e1c[_0x29c4b6(0x18d)],'primary_code':_0x467e1c[_0x29c4b6(0x171)],'secondary_code':_0x467e1c[_0x29c4b6(0xcd)],'product_code':_0x467e1c[_0x29c4b6(0xce)],'storage':_0x467e1c[_0x29c4b6(0x195)],'rack':_0x467e1c[_0x29c4b6(0x172)],'bay':_0x467e1c[_0x29c4b6(0x147)],'bin':_0x467e1c[_0x29c4b6(0xfe)],'type':_0x467e1c[_0x29c4b6(0x138)],'floorlevel':_0x467e1c[_0x29c4b6(0xe7)],'maxProducts':_0x467e1c[_0x29c4b6(0xdc)],'unit':_0x467e1c['standard_unit'],'secondary_unit':_0x467e1c[_0x29c4b6(0x196)],'expiry_date':_0x467e1c[_0x29c4b6(0x153)],'maxPerUnit':_0x467e1c[_0x29c4b6(0xf6)],'batch_code':_0x467e1c[_0x29c4b6(0xdf)],'alertQTY':_0x467e1c[_0x29c4b6(0x149)],'production_date':_0x467e1c['production_date'],'delivery_date':_0x467e1c[_0x29c4b6(0x18e)],'delivery_code':_0x467e1c['delivery_code']}));}),await _0x37ed91['save'](),_0x5eed1e['finalize']='True';const _0x1f91a8=await _0x5eed1e[_0x5caf60(0x15a)]();_0x5aec61[_0x5caf60(0xf1)]('success',_0x5caf60(0x12a)),_0x24af8f[_0x5caf60(0x178)](_0x5caf60(0x163));}catch(_0x4e7714){console[_0x5caf60(0x188)](_0x4e7714);}}),router[a0_0xbdd9d4(0xb9)](a0_0xbdd9d4(0xf5),auth,async(_0x17eaef,_0x4ffd55)=>{var _0x4a680c=a0_0xbdd9d4;try{const {username:_0x55dd95,email:_0x2da0be,role:_0xcc61fb}=_0x17eaef['user'],_0x468cc6=_0x17eaef[_0x4a680c(0xdd)],_0x167e64=await profile['findOne']({'email':_0x468cc6[_0x4a680c(0xe4)]}),_0x212ddd=await master_shop[_0x4a680c(0xec)](),_0x3ff2a5=_0x17eaef[_0x4a680c(0xc0)]['id'],_0x7017e8=await purchases['findById'](_0x3ff2a5),_0x3dd69f=await suppliers[_0x4a680c(0xec)]({});let _0x466986;if(_0x468cc6['role']==_0x4a680c(0xde)){const _0x36bb0f=await staff[_0x4a680c(0x191)]({'email':_0x468cc6[_0x4a680c(0xe4)]});_0x466986=await warehouse[_0x4a680c(0xec)]({'status':_0x4a680c(0x119),'name':_0x36bb0f[_0x4a680c(0x112)],'warehouse_category':_0x4a680c(0xd9)});}else _0x466986=await warehouse[_0x4a680c(0x169)]([{'$match':{'status':_0x4a680c(0x119),'warehouse_category':_0x4a680c(0xd9)}},{'$group':{'_id':_0x4a680c(0x131),'name':{'$first':_0x4a680c(0x131)}}}]);const _0x5e0a0e=await product[_0x4a680c(0xec)]({}),_0x43a989=BayBinSelected(_0x7017e8['warehouse_name'],_0x7017e8[_0x4a680c(0x162)]);let _0x3aafa6=new Date(_0x7017e8[_0x4a680c(0x153)]),_0x3b3223=('0'+_0x3aafa6[_0x4a680c(0x1b2)]())[_0x4a680c(0xe9)](-0x2),_0xe01b2d=('0'+(_0x3aafa6[_0x4a680c(0xea)]()+0x1))[_0x4a680c(0xe9)](-0x2),_0x1d3e8f=_0x3aafa6[_0x4a680c(0x13f)](),_0x3cc85d=_0x1d3e8f+'-'+_0xe01b2d+'-'+_0x3b3223;if(_0x212ddd[0x0][_0x4a680c(0x193)]==_0x4a680c(0x1a3)){var _0x3f0f78=users[_0x4a680c(0x18a)];console[_0x4a680c(0x188)](_0x3f0f78);}else{if(_0x212ddd[0x0]['language']==_0x4a680c(0x117))var _0x3f0f78=users[_0x4a680c(0x117)];else{if(_0x212ddd[0x0][_0x4a680c(0x193)]==_0x4a680c(0xc1))var _0x3f0f78=users[_0x4a680c(0xc1)];else{if(_0x212ddd[0x0][_0x4a680c(0x193)]==_0x4a680c(0x1a0))var _0x3f0f78=users['Spanish'];else{if(_0x212ddd[0x0][_0x4a680c(0x193)]=='French')var _0x3f0f78=users[_0x4a680c(0xf7)];else{if(_0x212ddd[0x0][_0x4a680c(0x193)]==_0x4a680c(0xa1))var _0x3f0f78=users[_0x4a680c(0x13b)];else{if(_0x212ddd[0x0]['language']=='Chinese')var _0x3f0f78=users[_0x4a680c(0x160)];else{if(_0x212ddd[0x0][_0x4a680c(0x193)]=='Arabic\x20(ae)')var _0x3f0f78=users['Arabic'];}}}}}}}_0x4ffd55[_0x4a680c(0x140)](_0x4a680c(0x9e),{'success':_0x17eaef[_0x4a680c(0xf1)]('success'),'errors':_0x17eaef[_0x4a680c(0xf1)]('errors'),'role':_0x468cc6,'profile':_0x167e64,'purchases':_0x7017e8,'suppliers':_0x3dd69f,'warehouse':_0x466986,'product':_0x5e0a0e,'master_shop':_0x212ddd,'language':_0x3f0f78,'ed_fullDate':_0x3cc85d,'dataSelected':_0x43a989});}catch(_0x16ef20){console['log'](_0x16ef20);}}),router[a0_0xbdd9d4(0x132)](a0_0xbdd9d4(0xf5),auth,async(_0x53e9d4,_0x36822a)=>{var _0x56660b=a0_0xbdd9d4;try{const _0x3f43ac=_0x53e9d4[_0x56660b(0xc0)]['id'],_0x4fec2f=await purchases['findOne']({'_id':_0x53e9d4['params']['id']}),_0x37feb9=await warehouse[_0x56660b(0x191)]({'name':_0x4fec2f[_0x56660b(0x1b1)],'room':_0x4fec2f['room']});_0x4fec2f[_0x56660b(0xbd)]['forEach'](_0x258ac1=>{var _0x4b3512=_0x56660b;const _0x43e831=_0x37feb9[_0x4b3512(0x120)]['map'](_0x40f437=>{var _0x47d9ac=_0x4b3512;_0x40f437['product_name']==_0x258ac1[_0x47d9ac(0x1b0)]&&_0x40f437[_0x47d9ac(0xe7)]==_0x258ac1[_0x47d9ac(0xe7)]&&_0x40f437[_0x47d9ac(0x138)]==_0x258ac1[_0x47d9ac(0x138)]&&_0x40f437[_0x47d9ac(0xfe)]==_0x258ac1[_0x47d9ac(0xfe)]&&_0x40f437['bay']==_0x258ac1[_0x47d9ac(0x147)]&&_0x40f437[_0x47d9ac(0x172)]==_0x258ac1['rack']&&_0x40f437['storage']==_0x258ac1['storage']&&(_0x40f437[_0x47d9ac(0xb4)]=parseInt(_0x40f437['product_stock'])-parseInt(_0x258ac1[_0x47d9ac(0x18d)]));});}),await _0x37feb9[_0x56660b(0x15a)]();const {invoice:_0x51d4c7,suppliers:_0x3e44b4,date:_0x432fe0,warehouse_name:_0x3abe4d,prod_name:_0x316b4b,prod_code:_0x38cfe8,prod_qty:_0x3ef986,prod_unit:_0x20c767,prod_secondunit:_0x52a65c,prod_level:_0x4849c3,prod_isle:_0x369599,prod_pallet:_0x12bb9a,note:_0x37eaa7,expiry_date:_0x4f512a,batch_code:_0x1c498b,paid_amount:_0x20f2b0,due_amount:_0x25a1b6,Room_name:_0x4f6ce3,primary_code:_0x3fa713,secondary_code:_0x284ac0,PO_number:_0x5be336,JO_number:_0x5aa759}=_0x53e9d4[_0x56660b(0x186)];if(typeof _0x316b4b=='string')var _0x281153=[_0x53e9d4[_0x56660b(0x186)]['prod_name']],_0x5d68f7=[_0x53e9d4[_0x56660b(0x186)]['prod_code']],_0x410e4a=[_0x53e9d4[_0x56660b(0x186)]['prod_qty']],_0xae8484=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0xfc)]],_0x33bcff=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x18f)]],_0x57053f=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x107)]],_0x1c08cc=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x9a)]],_0x46f7fd=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0xe3)]],_0x35adbc=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x171)]],_0x2dd7ce=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0xcd)]],_0x1da5cc=[_0x53e9d4[_0x56660b(0x186)]['MaxStocks_data']],_0x372fdf=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0xdf)]],_0x2834ea=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x153)]],_0x18c53f=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x195)]],_0x20365a=[_0x53e9d4[_0x56660b(0x186)][_0x56660b(0xa3)]],_0x5b635c=[_0x53e9d4['body'][_0x56660b(0x138)]];else var _0x281153=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x11a)]],_0x5d68f7=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x14f)]],_0x410e4a=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x179)]],_0xae8484=[..._0x53e9d4['body']['prod_unit']],_0x33bcff=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x18f)]],_0x57053f=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x107)]],_0x1c08cc=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x9a)]],_0x46f7fd=[..._0x53e9d4[_0x56660b(0x186)]['prod_pallet']],_0x35adbc=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x171)]],_0x2dd7ce=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0xcd)]],_0x1da5cc=[..._0x53e9d4['body'][_0x56660b(0x10b)]],_0x372fdf=[..._0x53e9d4['body'][_0x56660b(0xdf)]],_0x2834ea=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x153)]],_0x18c53f=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x195)]],_0x20365a=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0xa3)]],_0x5b635c=[..._0x53e9d4[_0x56660b(0x186)][_0x56660b(0x138)]];const _0xe9c2f5=_0x281153[_0x56660b(0xba)](_0x57c6dc=>{return _0x57c6dc={'product_name':_0x57c6dc};});_0x5d68f7['forEach']((_0x5df8e1,_0x39b6bc)=>{_0xe9c2f5[_0x39b6bc]['product_code']=_0x5df8e1;}),_0x410e4a[_0x56660b(0x9c)]((_0x5c4117,_0x27f4b7)=>{var _0x31b27=_0x56660b;_0xe9c2f5[_0x27f4b7][_0x31b27(0x18d)]=_0x5c4117;}),_0xae8484['forEach']((_0x393efc,_0xa1901b)=>{_0xe9c2f5[_0xa1901b]['standard_unit']=_0x393efc;}),_0x33bcff[_0x56660b(0x9c)]((_0x49a789,_0xfc99c3)=>{_0xe9c2f5[_0xfc99c3]['secondary_unit']=_0x49a789;}),_0x57053f[_0x56660b(0x9c)]((_0x8c8a70,_0x3357e5)=>{var _0x51f026=_0x56660b;_0xe9c2f5[_0x3357e5][_0x51f026(0x147)]=_0x8c8a70;}),_0x1c08cc[_0x56660b(0x9c)]((_0xcc0416,_0x1ce124)=>{var _0x84f194=_0x56660b;_0xe9c2f5[_0x1ce124][_0x84f194(0xfe)]=_0xcc0416;}),_0x46f7fd['forEach']((_0x42edd0,_0x1863d6)=>{var _0x22eec2=_0x56660b;_0xe9c2f5[_0x1863d6][_0x22eec2(0xe7)]=_0x42edd0;}),_0x35adbc[_0x56660b(0x9c)]((_0x424e65,_0xb62366)=>{var _0x127450=_0x56660b;_0xe9c2f5[_0xb62366][_0x127450(0x171)]=_0x424e65;}),_0x2dd7ce[_0x56660b(0x9c)]((_0x2f9514,_0x548ca4)=>{var _0x1be99c=_0x56660b;_0xe9c2f5[_0x548ca4][_0x1be99c(0xcd)]=_0x2f9514;}),_0x1da5cc[_0x56660b(0x9c)]((_0x31b667,_0x1c53d8)=>{var _0xd33aa3=_0x56660b;_0xe9c2f5[_0x1c53d8][_0xd33aa3(0xdc)]=_0x31b667;}),_0x372fdf[_0x56660b(0x9c)]((_0x57bc9b,_0x45b3a0)=>{_0xe9c2f5[_0x45b3a0]['batch_code']=_0x57bc9b;}),_0x2834ea[_0x56660b(0x9c)]((_0x52a198,_0x5bf8a0)=>{var _0x13c5ea=_0x56660b;_0xe9c2f5[_0x5bf8a0][_0x13c5ea(0x153)]=_0x52a198;}),_0x5b635c[_0x56660b(0x9c)]((_0x529f9c,_0x508904)=>{var _0xe37377=_0x56660b;_0xe9c2f5[_0x508904][_0xe37377(0x138)]=_0x529f9c;}),_0x18c53f['forEach']((_0x4a947a,_0x566645)=>{_0xe9c2f5[_0x566645]['storage']=_0x4a947a;}),_0x20365a[_0x56660b(0x9c)]((_0x300093,_0x250079)=>{_0xe9c2f5[_0x250079]['rack']=_0x300093;});const _0xc3dc6b=_0xe9c2f5[_0x56660b(0xb3)](_0x2ef317=>_0x2ef317['quantity']!=='0'&&_0x2ef317['quantity']!=='');_0x4fec2f[_0x56660b(0x108)]=_0x51d4c7,_0x4fec2f[_0x56660b(0x113)]=_0x3e44b4,_0x4fec2f[_0x56660b(0x19b)]=_0x432fe0,_0x4fec2f[_0x56660b(0x1b1)]=_0x3abe4d,_0x4fec2f[_0x56660b(0xbd)]=_0xc3dc6b,_0x4fec2f[_0x56660b(0x130)]=_0x37eaa7,_0x4fec2f[_0x56660b(0x1b4)]=_0x20f2b0,_0x4fec2f['due_amount']=_0x25a1b6,_0x4fec2f[_0x56660b(0x162)]=_0x4f6ce3,_0x4fec2f[_0x56660b(0x1a1)]=_0x5be336,_0x4fec2f[_0x56660b(0xa5)]=_0x5aa759;const _0x4cf215=await _0x4fec2f[_0x56660b(0x15a)](),_0x17946e=await warehouse['findOne']({'name':_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x1b1)],'room':_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x11c)]});_0x4fec2f[_0x56660b(0xbd)][_0x56660b(0x9c)](_0x2f5dd5=>{var _0x434ff7=_0x56660b,_0x2d12d6=0x0;const _0x608463=_0x17946e[_0x434ff7(0x120)][_0x434ff7(0xba)](_0x141e61=>{var _0x3aa741=_0x434ff7;_0x141e61[_0x3aa741(0x1b0)]==_0x2f5dd5[_0x3aa741(0x1b0)]&&_0x141e61['floorlevel']==_0x2f5dd5['floorlevel']&&_0x141e61[_0x3aa741(0x138)]==_0x2f5dd5[_0x3aa741(0x138)]&&_0x141e61['bin']==_0x2f5dd5['bin']&&_0x141e61['bay']==_0x2f5dd5[_0x3aa741(0x147)]&&_0x141e61[_0x3aa741(0x172)]==_0x2f5dd5[_0x3aa741(0x172)]&&_0x141e61['storage']==_0x2f5dd5[_0x3aa741(0x195)]&&(_0x141e61[_0x3aa741(0xb4)]=parseInt(_0x141e61['product_stock'])+parseInt(_0x2f5dd5[_0x3aa741(0x18d)]),_0x2d12d6++);});_0x2d12d6=='0'&&(_0x17946e[_0x434ff7(0x120)]=_0x17946e[_0x434ff7(0x120)][_0x434ff7(0xf2)]({'product_name':_0x2f5dd5['product_name'],'product_stock':_0x2f5dd5['quantity'],'primary_code':_0x2f5dd5[_0x434ff7(0x171)],'secondary_code':_0x2f5dd5[_0x434ff7(0xcd)],'product_code':_0x2f5dd5[_0x434ff7(0xce)],'storage':_0x2f5dd5[_0x434ff7(0x195)],'rack':_0x2f5dd5[_0x434ff7(0x172)],'bay':_0x2f5dd5[_0x434ff7(0x147)],'bin':_0x2f5dd5[_0x434ff7(0xfe)],'type':_0x2f5dd5[_0x434ff7(0x138)],'floorlevel':_0x2f5dd5[_0x434ff7(0xe7)],'maxProducts':_0x2f5dd5[_0x434ff7(0xdc)],'unit':_0x2f5dd5[_0x434ff7(0x16e)],'secondary_unit':_0x2f5dd5['secondary_unit'],'expiry_date':_0x2f5dd5[_0x434ff7(0x153)]}));}),await _0x17946e['save']();const _0x4e6df2=await s_payment_data[_0x56660b(0x191)]({'invoice':_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x108)]});if(_0x4e6df2===null){}else console[_0x56660b(0x188)](_0x56660b(0x113),_0x4e6df2,_0x53e9d4['body']['invoice']),_0x4e6df2[_0x56660b(0x113)]=_0x53e9d4[_0x56660b(0x186)][_0x56660b(0x113)],await _0x4e6df2['save']();_0x53e9d4[_0x56660b(0xf1)](_0x56660b(0xcf),'purchase\x20data\x20update\x20successfully'),_0x36822a[_0x56660b(0x178)]('/all_purchases/view');}catch(_0x32d339){console[_0x56660b(0x188)](_0x32d339);}}),router['post'](a0_0xbdd9d4(0x189),auth,async(_0x3989ea,_0x4d14cd)=>{var _0x4e1477=a0_0xbdd9d4;try{const _0x2ec3a7=_0x3989ea[_0x4e1477(0xc0)]['id'],{invoice:_0xdc60b3,suppliers:_0x361557,payable:_0x5449f0,due_amount:_0x8be96a}=_0x3989ea[_0x4e1477(0x186)],_0x293aff=await purchases[_0x4e1477(0x9f)](_0x2ec3a7);var _0x52545a=_0x5449f0-_0x8be96a;_0x293aff[_0x4e1477(0x1b4)]=parseFloat(_0x293aff[_0x4e1477(0x1b4)])+parseFloat(_0x8be96a),_0x293aff['due_amount']=_0x52545a;const _0x39e14a=await _0x293aff[_0x4e1477(0x15a)]();console['log'](_0x39e14a);const _0x23c89b=await s_payment_data['findOne']({'invoice':_0xdc60b3});_0x23c89b[_0x4e1477(0xab)]=_0x52545a,await _0x23c89b[_0x4e1477(0x15a)]();let _0x5ba0bd=new Date(),_0x32c732=('0'+_0x5ba0bd[_0x4e1477(0x1b2)]())[_0x4e1477(0xe9)](-0x2),_0x12be1b=('0'+(_0x5ba0bd[_0x4e1477(0xea)]()+0x1))[_0x4e1477(0xe9)](-0x2),_0x31e286=_0x5ba0bd[_0x4e1477(0x13f)](),_0x4c4a52=_0x31e286+'-'+_0x12be1b+'-'+_0x32c732;const _0x29f999=new suppliers_payment({'invoice':_0xdc60b3,'date':_0x31e286+'-'+_0x12be1b+'-'+_0x32c732,'suppliers':_0x361557,'reason':_0x4e1477(0x13a),'amount':_0x8be96a}),_0xef0dca=await _0x29f999[_0x4e1477(0x15a)]();_0x3989ea[_0x4e1477(0xf1)](_0x4e1477(0xcf),_0x4e1477(0x13e)),_0x4d14cd['redirect'](_0x4e1477(0x163));}catch(_0x525a46){console['log'](_0x525a46);}}),router['get']('/invoice/:id',auth,async(_0x5e2131,_0x4f61d5)=>{var _0xf760ac=a0_0xbdd9d4;try{const {username:_0x580d66,email:_0x3190af,role:_0x20b251}=_0x5e2131[_0xf760ac(0xdd)],_0x17f52e=_0x5e2131[_0xf760ac(0xdd)],_0x2738d3=await profile[_0xf760ac(0x191)]({'email':_0x17f52e[_0xf760ac(0xe4)]}),_0x445b9a=await master_shop[_0xf760ac(0xec)]();console[_0xf760ac(0x188)](_0xf760ac(0x1a9),_0x445b9a);const _0x36590a=_0x5e2131[_0xf760ac(0xc0)]['id'],_0xd28a81=await purchases[_0xf760ac(0x9f)](_0x36590a);console[_0xf760ac(0x188)](_0xd28a81);const _0x532e80=await suppliers[_0xf760ac(0x191)]({'name':_0xd28a81['suppliers']});console[_0xf760ac(0x188)](_0x532e80);if(_0x445b9a[0x0][_0xf760ac(0x193)]==_0xf760ac(0x1a3)){var _0x1b73f5=users[_0xf760ac(0x18a)];console[_0xf760ac(0x188)](_0x1b73f5);}else{if(_0x445b9a[0x0]['language']==_0xf760ac(0x117))var _0x1b73f5=users[_0xf760ac(0x117)];else{if(_0x445b9a[0x0]['language']==_0xf760ac(0xc1))var _0x1b73f5=users['German'];else{if(_0x445b9a[0x0][_0xf760ac(0x193)]==_0xf760ac(0x1a0))var _0x1b73f5=users[_0xf760ac(0x1a0)];else{if(_0x445b9a[0x0][_0xf760ac(0x193)]==_0xf760ac(0xf7))var _0x1b73f5=users[_0xf760ac(0xf7)];else{if(_0x445b9a[0x0]['language']==_0xf760ac(0xa1))var _0x1b73f5=users[_0xf760ac(0x13b)];else{if(_0x445b9a[0x0][_0xf760ac(0x193)]==_0xf760ac(0x160))var _0x1b73f5=users[_0xf760ac(0x160)];else{if(_0x445b9a[0x0][_0xf760ac(0x193)]==_0xf760ac(0x155))var _0x1b73f5=users[_0xf760ac(0x145)];}}}}}}}_0x4f61d5[_0xf760ac(0x140)](_0xf760ac(0x198),{'success':_0x5e2131[_0xf760ac(0xf1)]('success'),'errors':_0x5e2131[_0xf760ac(0xf1)](_0xf760ac(0x133)),'role':_0x17f52e,'profile':_0x2738d3,'master_shop':_0x445b9a,'supplier':_0x532e80,'purchase':_0xd28a81,'language':_0x1b73f5});}catch(_0x274479){console[_0xf760ac(0x188)](_0x274479);}}),router[a0_0xbdd9d4(0xb9)](a0_0xbdd9d4(0x16c),auth,async(_0x2a501e,_0x1599ad)=>{var _0x28aa51=a0_0xbdd9d4;try{const {username:_0x4b7c49,email:_0xa2aaaa,role:_0x43d255}=_0x2a501e['user'],_0x3bc1c9=_0x2a501e['user'],_0x1a9487=await profile['findOne']({'email':_0x3bc1c9['email']}),_0x5034ef=await master_shop[_0x28aa51(0xec)]();console[_0x28aa51(0x188)](_0x28aa51(0x1a9),_0x5034ef);const _0x9e10ce=_0x2a501e[_0x28aa51(0xc0)]['id'];console[_0x28aa51(0x188)](_0x9e10ce);const _0x5b3e81=await purchases[_0x28aa51(0x9f)](_0x9e10ce);console[_0x28aa51(0x188)](_0x28aa51(0xd6),_0x5b3e81);const _0x4603ad=await product[_0x28aa51(0xec)]({}),_0x56da4d=await warehouse[_0x28aa51(0x169)]([{'$match':{'name':_0x5b3e81['warehouse_name'],'room':_0x5b3e81[_0x28aa51(0x162)],'warehouse_category':_0x28aa51(0xd9)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x28aa51(0xd5),'name':{'$first':_0x28aa51(0x16d)},'product_stock':{'$first':_0x28aa51(0x12e)},'bay':{'$first':_0x28aa51(0x19e)},'bin':{'$first':_0x28aa51(0x185)},'type':{'$first':_0x28aa51(0xa4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x28aa51(0x10f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x28aa51(0x144)},'storage':{'$first':_0x28aa51(0x17b)},'rack':{'$first':_0x28aa51(0x95)}}}]);warehouse_data=await warehouse[_0x28aa51(0x169)]([{'$match':{'status':_0x28aa51(0x119),'name':'Return\x20Goods','warehouse_category':_0x28aa51(0xd9)}},{'$group':{'_id':_0x28aa51(0x131),'name':{'$first':_0x28aa51(0x131)}}},{'$sort':{'name':0x1}}]),console[_0x28aa51(0x188)](_0x28aa51(0x197),_0x56da4d);if(_0x5034ef[0x0][_0x28aa51(0x193)]=='English\x20(US)'){var _0x3cc47f=users['English'];console[_0x28aa51(0x188)](_0x3cc47f);}else{if(_0x5034ef[0x0][_0x28aa51(0x193)]=='Hindi')var _0x3cc47f=users[_0x28aa51(0x117)];else{if(_0x5034ef[0x0][_0x28aa51(0x193)]=='German')var _0x3cc47f=users[_0x28aa51(0xc1)];else{if(_0x5034ef[0x0][_0x28aa51(0x193)]==_0x28aa51(0x1a0))var _0x3cc47f=users['Spanish'];else{if(_0x5034ef[0x0][_0x28aa51(0x193)]==_0x28aa51(0xf7))var _0x3cc47f=users[_0x28aa51(0xf7)];else{if(_0x5034ef[0x0][_0x28aa51(0x193)]==_0x28aa51(0xa1))var _0x3cc47f=users[_0x28aa51(0x13b)];else{if(_0x5034ef[0x0][_0x28aa51(0x193)]==_0x28aa51(0x160))var _0x3cc47f=users[_0x28aa51(0x160)];else{if(_0x5034ef[0x0][_0x28aa51(0x193)]==_0x28aa51(0x155))var _0x3cc47f=users[_0x28aa51(0x145)];}}}}}}}_0x1599ad['render'](_0x28aa51(0x181),{'success':_0x2a501e['flash']('success'),'errors':_0x2a501e['flash'](_0x28aa51(0x133)),'role':_0x3bc1c9,'profile':_0x1a9487,'user':_0x5b3e81,'stock':_0x56da4d,'master_shop':_0x5034ef,'product':_0x4603ad,'language':_0x3cc47f,'warehouse':warehouse_data});}catch(_0x11dd7f){console[_0x28aa51(0x188)](_0x11dd7f);}}),router[a0_0xbdd9d4(0x132)](a0_0xbdd9d4(0x16c),auth,async(_0x561903,_0x1a2a55)=>{var _0x4cce3b=a0_0xbdd9d4;try{const {invoice:_0x137b9d,date:_0x468e2d,warehouse_name:_0x49c264,Room_name:_0xdf7da6,product_name:_0x1d973d,purchase_quantity:_0x2bf084,stocks:_0x298809,return_qty:_0x261272,note:_0x157381,level:_0x3e675d,isle:_0x3aeec4,pallet:_0x5cb354,to_warehouse_name:_0x457763,to_Room_name:_0x4f306d}=_0x561903[_0x4cce3b(0x186)],_0x14d1a7=await purchases[_0x4cce3b(0x191)]({'_id':_0x561903[_0x4cce3b(0xc0)]['id']}),_0x27418d=await warehouse[_0x4cce3b(0x191)]({'name':_0x49c264,'room':_0xdf7da6});if(typeof _0x1d973d==_0x4cce3b(0x105))var _0x59c74f=[_0x561903['body'][_0x4cce3b(0x1b0)]],_0x3dae5f=[_0x561903[_0x4cce3b(0x186)]['purchase_quantity']],_0x55f1fb=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x168)]],_0xd3dcea=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0xd7)]],_0x4f87fe=[_0x561903['body'][_0x4cce3b(0x199)]],_0x225229=[_0x561903[_0x4cce3b(0x186)]['isle']],_0x4dadbf=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0xe6)]],_0x57f96b=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x166)]],_0x2c6eaf=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x184)]],_0x39009f=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x128)]],_0x152e2e=[_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x10e)]];else var _0x59c74f=[..._0x561903['body'][_0x4cce3b(0x1b0)]],_0x3dae5f=[..._0x561903[_0x4cce3b(0x186)][_0x4cce3b(0xbf)]],_0x55f1fb=[..._0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x168)]],_0xd3dcea=[..._0x561903[_0x4cce3b(0x186)][_0x4cce3b(0xd7)]],_0x4f87fe=[..._0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x199)]],_0x225229=[..._0x561903['body'][_0x4cce3b(0x142)]],_0x4dadbf=[..._0x561903[_0x4cce3b(0x186)]['pallet']],_0x57f96b=[..._0x561903[_0x4cce3b(0x186)]['types']],_0x2c6eaf=[..._0x561903['body'][_0x4cce3b(0x184)]],_0x39009f=[..._0x561903[_0x4cce3b(0x186)]['primary_code_hide']],_0x152e2e=[..._0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x10e)]];const _0x571a10=_0x59c74f['map'](_0x1b1594=>{return _0x1b1594={'product_name':_0x1b1594};});_0x3dae5f[_0x4cce3b(0x9c)]((_0x3582bc,_0x517c21)=>{var _0x3e4e41=_0x4cce3b;_0x571a10[_0x517c21][_0x3e4e41(0xbf)]=_0x3582bc;}),_0x55f1fb[_0x4cce3b(0x9c)]((_0x467d3a,_0x54765b)=>{var _0x6241cb=_0x4cce3b;_0x571a10[_0x54765b][_0x6241cb(0xb0)]=_0x467d3a;}),_0xd3dcea['forEach']((_0x593be3,_0x5036ad)=>{var _0x4232d1=_0x4cce3b;_0x571a10[_0x5036ad][_0x4232d1(0xd7)]=_0x593be3;}),_0x4f87fe[_0x4cce3b(0x9c)]((_0x4e8e9d,_0x58b0c5)=>{var _0x47013b=_0x4cce3b;_0x571a10[_0x58b0c5][_0x47013b(0x147)]=_0x4e8e9d;}),_0x225229[_0x4cce3b(0x9c)]((_0x4f1b8e,_0x4fa3c6)=>{_0x571a10[_0x4fa3c6]['bin']=_0x4f1b8e;}),_0x4dadbf[_0x4cce3b(0x9c)]((_0x96544f,_0x18468b)=>{var _0x1f8ca1=_0x4cce3b;_0x571a10[_0x18468b][_0x1f8ca1(0xe7)]=_0x96544f;}),_0x57f96b[_0x4cce3b(0x9c)]((_0x350d3d,_0x481034)=>{var _0x35e4f1=_0x4cce3b;_0x571a10[_0x481034][_0x35e4f1(0x138)]=_0x350d3d;}),_0x2c6eaf['forEach']((_0x5c6e3f,_0x25fd78)=>{var _0x3c3467=_0x4cce3b;_0x571a10[_0x25fd78][_0x3c3467(0xce)]=_0x5c6e3f;}),_0x39009f['forEach']((_0x5a6873,_0x188f4f)=>{var _0x4eccdc=_0x4cce3b;_0x571a10[_0x188f4f][_0x4eccdc(0x171)]=_0x5a6873;}),_0x152e2e['forEach']((_0x4800cf,_0x31ef1c)=>{var _0x97ca1c=_0x4cce3b;_0x571a10[_0x31ef1c][_0x97ca1c(0xcd)]=_0x4800cf;}),_0x14d1a7[_0x4cce3b(0xbd)][_0x4cce3b(0x9c)](_0x3a2b6e=>{var _0x488a29=_0x4cce3b;const _0x57b33b=_0x27418d[_0x488a29(0x120)][_0x488a29(0xba)](_0x1ac18c=>{var _0x5f221f=_0x488a29;_0x1ac18c[_0x5f221f(0x1b0)]==_0x3a2b6e[_0x5f221f(0x1b0)]&&_0x1ac18c[_0x5f221f(0xe7)]==_0x3a2b6e[_0x5f221f(0xe7)]&&_0x1ac18c[_0x5f221f(0x138)]==_0x3a2b6e[_0x5f221f(0x138)]&&_0x1ac18c['bin']==_0x3a2b6e[_0x5f221f(0xfe)]&&_0x1ac18c[_0x5f221f(0x147)]==_0x3a2b6e['bay']&&_0x1ac18c[_0x5f221f(0x172)]==_0x3a2b6e[_0x5f221f(0x172)]&&_0x1ac18c[_0x5f221f(0x195)]==_0x3a2b6e['storage']&&(console[_0x5f221f(0x188)](parseInt(_0x1ac18c[_0x5f221f(0xb4)])+_0x5f221f(0xc7)+parseInt(_0x3a2b6e[_0x5f221f(0x18d)])),_0x1ac18c[_0x5f221f(0xb4)]=parseInt(_0x1ac18c[_0x5f221f(0xb4)])+parseInt(_0x3a2b6e[_0x5f221f(0x18d)]));});}),await _0x27418d[_0x4cce3b(0x15a)]();const _0x21b6b2=_0x571a10[_0x4cce3b(0xb3)](_0xc0221a=>_0xc0221a[_0x4cce3b(0xd7)]!=='0'&&_0xc0221a['return_qty']!=='');var _0x115397=0x0;_0x21b6b2[_0x4cce3b(0x9c)](_0x23e553=>{var _0x4d0d02=_0x4cce3b;console[_0x4d0d02(0x188)](_0x4d0d02(0x16f),_0x23e553),(parseInt(_0x23e553[_0x4d0d02(0xbf)])<parseInt(_0x23e553[_0x4d0d02(0xd7)])||parseInt(_0x23e553['stock_quantity'])<parseInt(_0x23e553[_0x4d0d02(0xd7)]))&&_0x115397++;});if(_0x115397!=0x0)return _0x561903[_0x4cce3b(0xf1)](_0x4cce3b(0x133),_0x4cce3b(0xc3)),_0x1a2a55[_0x4cce3b(0x178)](_0x4cce3b(0x116));const _0x224c4a=new purchases_return({'invoice':_0x137b9d,'suppliers':_0x561903['body'][_0x4cce3b(0x113)],'date':_0x468e2d,'warehouse_name':_0x49c264,'return_product':_0x21b6b2,'note':_0x157381,'room':_0xdf7da6,'to_warehouse_name':_0x457763,'to_room':_0x4f306d}),_0x5e41d6=await _0x224c4a[_0x4cce3b(0x15a)]();console[_0x4cce3b(0x188)](_0x224c4a);const _0x4958dc=await purchases_return[_0x4cce3b(0x191)]({'invoice':_0x137b9d}),_0x31be0f=await warehouse[_0x4cce3b(0x191)]({'name':_0x457763,'room':_0x4f306d});_0x4958dc[_0x4cce3b(0x157)][_0x4cce3b(0x9c)](_0x4de2a7=>{var _0x11e51c=_0x4cce3b,_0x7f5517=0x0;const _0xfbc644=_0x31be0f[_0x11e51c(0x120)]['map'](_0x29a699=>{var _0x182df9=_0x11e51c;_0x29a699[_0x182df9(0x1b0)]==_0x4de2a7[_0x182df9(0x1b0)]&&_0x29a699[_0x182df9(0xe7)]==_0x4de2a7[_0x182df9(0xe7)]&&_0x29a699[_0x182df9(0x138)]==_0x4de2a7[_0x182df9(0x138)]&&_0x29a699[_0x182df9(0xfe)]==_0x4de2a7[_0x182df9(0xfe)]&&_0x29a699[_0x182df9(0x147)]==_0x4de2a7[_0x182df9(0x147)]&&(_0x29a699[_0x182df9(0xb4)]=parseInt(_0x29a699[_0x182df9(0xb4)])-parseInt(_0x4de2a7[_0x182df9(0xd7)]),_0x7f5517++);});_0x7f5517=='0'&&(_0x31be0f[_0x11e51c(0x120)]=_0x31be0f[_0x11e51c(0x120)][_0x11e51c(0xf2)]({'product_name':_0x4de2a7[_0x11e51c(0x1b0)],'product_stock':_0x4de2a7[_0x11e51c(0xd7)],'primary_code':_0x4de2a7[_0x11e51c(0x171)],'secondary_code':_0x4de2a7[_0x11e51c(0xcd)],'product_code':_0x4de2a7[_0x11e51c(0xce)],'storage':_0x4de2a7[_0x11e51c(0x195)],'rack':_0x4de2a7['rack'],'bay':_0x4de2a7['bay'],'bin':_0x4de2a7[_0x11e51c(0xfe)],'type':_0x4de2a7['type'],'floorlevel':_0x4de2a7['floorlevel'],'maxProducts':_0x4de2a7[_0x11e51c(0xdc)],'unit':_0x4de2a7['standard_unit'],'secondary_unit':_0x4de2a7[_0x11e51c(0x196)],'expiry_date':_0x4de2a7[_0x11e51c(0x153)]}));}),await _0x31be0f[_0x4cce3b(0x15a)]();const _0x5c4b61=await purchases['findOne']({'invoice':_0x137b9d});_0x5c4b61[_0x4cce3b(0xcc)]=_0x4cce3b(0x10d);const _0x1b1cba=await _0x5c4b61[_0x4cce3b(0x15a)](),_0x1173a3=new s_payment_data({'invoice':_0x137b9d,'suppliers':_0x561903[_0x4cce3b(0x186)]['suppliers'],'reason':'Purchase\x20Return'});await _0x1173a3[_0x4cce3b(0x15a)]();const _0x3ca280=await master_shop['find']();console['log'](_0x4cce3b(0x190),_0x3ca280[0x0][_0x4cce3b(0x9d)]);const _0x24307b=await email_settings[_0x4cce3b(0x191)](),_0x281829=await suppliers['findOne']({'name':_0x561903[_0x4cce3b(0x186)][_0x4cce3b(0x113)]});console['log'](_0x4cce3b(0xc8),_0x281829);_0x3ca280[0x0]['currency_placement']==0x1?(right_currency=_0x3ca280[0x0][_0x4cce3b(0x1b3)],left_currency=''):(right_currency='',left_currency=_0x3ca280[0x0][_0x4cce3b(0x1b3)]);var _0x20837b=_0x59c74f,_0x1414cd=_0xd3dcea,_0x467ac5='',_0x5cfda9;for(_0x5cfda9 in _0x20837b){_0x467ac5+=_0x4cce3b(0x98)+_0x4cce3b(0x19d)+_0x20837b[_0x5cfda9]+_0x4cce3b(0x12c)+_0x4cce3b(0x19d)+_0x1414cd[_0x5cfda9]+_0x4cce3b(0x12c)+_0x4cce3b(0x17e);}console['log'](_0x4cce3b(0x1a6),_0x467ac5);let _0x4ef3a0=nodemailer[_0x4cce3b(0x115)]({'service':'gmail','auth':{'user':_0x24307b[_0x4cce3b(0xe4)],'pass':_0x24307b[_0x4cce3b(0x99)]}}),_0x2f8871={'from':_0x24307b['email'],'to':_0x281829[_0x4cce3b(0xe4)],'subject':_0x4cce3b(0xac),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4cce3b(0x122)+_0x4cce3b(0x174)+_0x3ca280[0x0]['image'],'cid':_0x4cce3b(0x1ad)}],'html':'<!DOCTYPE\x20html>'+_0x4cce3b(0xc6)+_0x4cce3b(0x1a4)+_0x4cce3b(0x19a)+_0x4cce3b(0x192)+_0x4cce3b(0x19a)+_0x4cce3b(0xa2)+_0x4cce3b(0x143)+_0x4cce3b(0x19a)+_0x4cce3b(0x12b)+_0x3ca280[0x0]['site_title']+_0x4cce3b(0x176)+_0x4cce3b(0x143)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x4cce3b(0x19a)+_0x4cce3b(0x183)+_0x4cce3b(0x110)+_0x137b9d+'\x20'+_0x4cce3b(0x96)+'\x20Order\x20Date\x20:\x20'+_0x468e2d+'\x20'+_0x4cce3b(0x12f)+'</h5>'+_0x4cce3b(0x143)+_0x4cce3b(0xd4)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4cce3b(0x98)+_0x4cce3b(0x1a2)+_0x4cce3b(0x14c)+_0x4cce3b(0x17d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4cce3b(0x17e)+_0x4cce3b(0x17a)+_0x4cce3b(0xb5)+'\x20'+_0x467ac5+'\x20'+_0x4cce3b(0x101)+_0x4cce3b(0x156)+_0x4cce3b(0x19a)+'<strong>\x20Regards\x20</strong>'+_0x4cce3b(0xc9)+_0x3ca280[0x0]['site_title']+_0x4cce3b(0x124)+_0x4cce3b(0x143)+_0x4cce3b(0x143)+_0x4cce3b(0x109)};_0x4ef3a0[_0x4cce3b(0x15c)](_0x2f8871,function(_0x6d17f4,_0x3593e1){var _0x171c02=_0x4cce3b;_0x6d17f4?(console['log'](_0x6d17f4),console[_0x171c02(0x188)]('Error\x20Occurs')):console[_0x171c02(0x188)]('Email\x20sent\x20successfully');}),_0x561903['flash'](_0x4cce3b(0xcf),'purchases\x20item\x20return\x20successfull'),_0x1a2a55[_0x4cce3b(0x178)]('/all_purchases/view');}catch(_0x41e150){console[_0x4cce3b(0x188)](_0x41e150),_0x1a2a55[_0x4cce3b(0xee)](0xc8)['json']({'message':_0x41e150[_0x4cce3b(0x11e)]});}}),router[a0_0xbdd9d4(0xb9)](a0_0xbdd9d4(0x136),auth,async(_0x37f49f,_0xceb4ab)=>{var _0x21955b=a0_0xbdd9d4;try{const {username:_0x56d945,email:_0x44b9c5,role:_0x360c06}=_0x37f49f[_0x21955b(0xdd)],_0x52c9b0=_0x37f49f[_0x21955b(0xdd)],_0x526445=await profile[_0x21955b(0x191)]({'email':_0x52c9b0[_0x21955b(0xe4)]}),_0x47b1a2=await master_shop[_0x21955b(0xec)](),_0x132a80=_0x37f49f['params']['id'],_0x46462b=await purchases['findById'](_0x132a80);if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0x1a3))var _0x4bde0e=users[_0x21955b(0x18a)];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0x117))var _0x4bde0e=users['Hindi'];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0xc1))var _0x4bde0e=users[_0x21955b(0xc1)];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0x1a0))var _0x4bde0e=users[_0x21955b(0x1a0)];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0xf7))var _0x4bde0e=users[_0x21955b(0xf7)];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0xa1))var _0x4bde0e=users['Portuguese'];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0x160))var _0x4bde0e=users[_0x21955b(0x160)];else{if(_0x47b1a2[0x0][_0x21955b(0x193)]==_0x21955b(0x155))var _0x4bde0e=users['Arabic'];}}}}}}}_0xceb4ab[_0x21955b(0x140)](_0x21955b(0xb7),{'success':_0x37f49f[_0x21955b(0xf1)](_0x21955b(0xcf)),'errors':_0x37f49f[_0x21955b(0xf1)](_0x21955b(0x133)),'role':_0x52c9b0,'profile':_0x526445,'alldata':_0x46462b,'master_shop':_0x47b1a2,'language':_0x4bde0e}),console[_0x21955b(0x188)](alldata);}catch(_0x10eb1d){console[_0x21955b(0x188)](_0x10eb1d);}}),router[a0_0xbdd9d4(0x132)](a0_0xbdd9d4(0x134),async(_0x37b735,_0x2412d8)=>{var _0x246b8f=a0_0xbdd9d4;const {product_code:_0x45535e}=_0x37b735[_0x246b8f(0x186)];var _0x56617b;const _0x1a0091=await product[_0x246b8f(0x169)]([{'$match':{'primary_code':_0x45535e,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x246b8f(0xaa),'name':{'$first':'$name'},'category':{'$first':_0x246b8f(0x182)},'brand':{'$first':_0x246b8f(0x1af)},'unit':{'$first':_0x246b8f(0xf8)},'alertquantity':{'$first':_0x246b8f(0xae)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x246b8f(0xbc)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x246b8f(0x194)},'maxProdPerUnit':{'$first':_0x246b8f(0x16a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x246b8f(0xfd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x53d7a3=await product['aggregate']([{'$match':{'secondary_code':_0x45535e,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x246b8f(0xaa),'name':{'$first':_0x246b8f(0x131)},'category':{'$first':_0x246b8f(0x182)},'brand':{'$first':_0x246b8f(0x1af)},'unit':{'$first':_0x246b8f(0xf8)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x246b8f(0x104)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x246b8f(0x194)},'maxProdPerUnit':{'$first':_0x246b8f(0x16a)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x246b8f(0xfd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1a0091[_0x246b8f(0x187)]>0x0)_0x56617b=_0x1a0091;else _0x53d7a3[_0x246b8f(0x187)]>0x0&&(_0x56617b=_0x53d7a3);_0x2412d8[_0x246b8f(0x118)](_0x56617b);}),router[a0_0xbdd9d4(0x132)]('/CheckingWarehouse',async(_0x4568eb,_0x2042e5)=>{var _0x16f742=a0_0xbdd9d4;const {primaryCode:_0x1cac95,secondaryCode:_0x4d8a59,productCode:_0x2b4264,bay:_0x425179,bin:_0x516305,types:_0x292659,pallet:_0x5c5b8b,warehouses:_0x58369e,room:_0x5152cb}=_0x4568eb[_0x16f742(0x186)];console['log'](_0x4568eb[_0x16f742(0x186)]);try{const _0x1f9c60=await warehouse[_0x16f742(0x169)]([{'$match':{'name':_0x58369e,'room':_0x5152cb}},{'$unwind':_0x16f742(0xed)},{'$match':{'product_details.bay':_0x425179,'product_details.bin':_0x516305,'product_details.type':_0x292659}},{'$group':{'_id':_0x16f742(0xd5),'name':{'$first':_0x16f742(0x16d)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x16f742(0x1ac)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x16f742(0x100)},'maxProducts':{'$first':_0x16f742(0xa6)}}}]);_0x2042e5[_0x16f742(0xee)](0xc8)[_0x16f742(0x118)](_0x1f9c60);}catch(_0x37698d){_0x2042e5[_0x16f742(0xee)](0x194)[_0x16f742(0x118)]({'message':_0x37698d[_0x16f742(0x11e)]});}}),module[a0_0xbdd9d4(0x127)]=router;