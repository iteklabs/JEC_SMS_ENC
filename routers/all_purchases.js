function a0_0x1304(_0x105d5d,_0x24666d){var _0x46393b=a0_0x4639();return a0_0x1304=function(_0x130447,_0x42afe1){_0x130447=_0x130447-0x1c6;var _0x49cfdb=_0x46393b[_0x130447];return _0x49cfdb;},a0_0x1304(_0x105d5d,_0x24666d);}var a0_0x10d756=a0_0x1304;(function(_0x3fb02c,_0x149bd2){var _0x2dcc6e=a0_0x1304,_0x1b79b6=_0x3fb02c();while(!![]){try{var _0x2f5874=-parseInt(_0x2dcc6e(0x292))/0x1*(-parseInt(_0x2dcc6e(0x20a))/0x2)+parseInt(_0x2dcc6e(0x28c))/0x3+parseInt(_0x2dcc6e(0x1ff))/0x4+-parseInt(_0x2dcc6e(0x28b))/0x5+parseInt(_0x2dcc6e(0x1f6))/0x6*(-parseInt(_0x2dcc6e(0x267))/0x7)+-parseInt(_0x2dcc6e(0x249))/0x8*(-parseInt(_0x2dcc6e(0x296))/0x9)+-parseInt(_0x2dcc6e(0x1ec))/0xa*(parseInt(_0x2dcc6e(0x26f))/0xb);if(_0x2f5874===_0x149bd2)break;else _0x1b79b6['push'](_0x1b79b6['shift']());}catch(_0x300317){_0x1b79b6['push'](_0x1b79b6['shift']());}}}(a0_0x4639,0x9f29d));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x10d756(0x277)),auth=require(a0_0x10d756(0x1cb)),nodemailer=require('nodemailer');var ejs=require(a0_0x10d756(0x22c));function a0_0x4639(){var _0x1605ee=['catch','staff','/all_purchases/view','<hr\x20class=\x22my-3\x22>','$maxStocks','Shelves','secondary_code_hide','Arabic','</span>','port','types','getMonth','product_code','return_product','Floor','prod_qty','then','prod_secondunit','createTransport','$product.floorlevel','$category','actual_qty','$product.bay','back','deliverycode','English','ejs','language','$secondary_code','user','</thead>','maxperunit','Error\x20Occurs','sendMail','$product_details.primary_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.expiry_date','note','$product_details.secondary_code','Rack\x20E','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Rack\x20C','flash','post','$product.quantity','/view','$batch_code','padStart','product','prod_primunit','</tr>','$product.bin','all_purchases_barcode','Enclosed','144784kGHLuq','$_id','$product_code','aggregate','$product_details.isle','concat','$warehouse_name','purchase\x20data\x20update\x20successfully','Purchase\x20Mail','success','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','exports','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','English\x20(US)','/give_payment/:id','here','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','master','currency_placement','primary_code_hide','$due_amount','room','site_title','all_purchases','$maxProdPerUnit','storage','delivery_code','313719TRgYEm','prod_name','<h5>','prod_Qty','type','prod_invoice','$paid_amount','Portuguese','33agAXUL','$name','/all_purchases/view/','push','all','role','Raw\x20Materials','user_id','../models/all_models','level','product_cat','string','abs','RoomAssign','stocks','$return_data','$product_details.product_code','edit_purchases_view','</div>','random','rack','$product_details.maxProducts','Receiving\x20Area','isle','redirect','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.storage','</h5>','2266955YwVAGF','2765430kTuxmx','Email\x20sent\x20successfully','Return\x20Goods','secondary_unit','prod_unit','$invoice','606FrtPRL','Rack\x20B','prod_level','amount','504yZsRaO','</td>','\x20</h2>','standard_unit','COLD\x20STORAGE','purchase_invoice','slice','prod_code','invoice','<span\x20style=\x22float:\x20right;\x22>','warehouse_name','</tbody>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Hindi','stock_quantity','return_data','findOne','email','currency','Rack\x20F','return_purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','toString','Ambient','purchase_quantity','floor','error','actual_uom','$finalize','/view/add_purchases','</table>','name','$product_details.product_name','product_details','product_stock','$note','rak','Chinese','alertQTY','room_name','errors','prod_isle','$product_details.product_stock','<tr>','due_amount','<html><head><title></title>','add_purchases','../public/language/languages.json','$product_details.pallet','edit_purchases','/upload/','\x20<\x20wew\x20>\x20','max_product_unit','expiry_date','INC-','status','suppliers','/invoice/:id','$room','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.floorlevel','$product','primary_code','product_code_hide','finalize','$product.type','forEach','filter','Sales\x20Update\x20successfully','RMSEmail','$date','render','Enabled','stock_data','<div>','find','json','$alertquantity','$product_details.rack','product_name','getFullYear','<tbody\x20style=\x22text-align:\x20center;\x22>','../middleware/auth','German','Portuguese\x20(BR)','bin','pallet','$expiry_date','message','production_date','quantity','Spanish','batch_code','warehouse','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$unit','$product_details.bin','path','save','secondary_code','</body></html>','suppliers_docs','/view/return_purchase/:id','add_purchases\x20error','floorlevel','Level','$product_details.level','/../public','$secondary_unit','image','purchases\x20item\x20return\x20successfull','Logo.png','bay','True','return_qty','4155630xNQRoh','</head><body>','length','$product_details','log','get','Arabic\x20(ae)','password','getDate','$product_details.bay','6VBewpz','delivery_date','$product_details.type','<h2>\x20','/preview/:id','maxStocks','\x20<>\x20','product_list','MaxStocks_data','222048CrIkfn','findById','<!DOCTYPE\x20html>','<strong>\x20Regards\x20</strong>','prod_cat','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','prod_pallet','$brand','/view/:id','Paid\x20For\x20Purchase','Rack\x20A','1340BWCvZS','params','\x20Order\x20Number\x20:\x20','$product_details._id','JO_number','body','$suppliers','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'];a0_0x4639=function(){return _0x1605ee;};return a0_0x4639();}const path=require(a0_0x10d756(0x1da)),users=require(a0_0x10d756(0x2c5));router[a0_0x10d756(0x1f1)](a0_0x10d756(0x240),auth,async(_0x289cc9,_0xf977b1)=>{var _0x530b10=a0_0x10d756;try{const {username:_0x421d35,email:_0x108100,role:_0x457755}=_0x289cc9[_0x530b10(0x22f)],_0xf20a25=_0x289cc9['user'],_0x20bafb=await profile[_0x530b10(0x2a6)]({'email':_0xf20a25['email']}),_0x4f7dc5=await staff[_0x530b10(0x2a6)]({'email':_0xf20a25[_0x530b10(0x2a7)]});if(_0xf20a25[_0x530b10(0x274)]==_0x530b10(0x213)){const _0x256126=await staff[_0x530b10(0x2a6)]({'email':_0xf20a25[_0x530b10(0x2a7)]});}const _0x5123c4=await master_shop['find']();let _0x16e390;if(_0xf20a25[_0x530b10(0x274)]==_0x530b10(0x213)){const _0x28de7f=await staff[_0x530b10(0x2a6)]({'email':_0xf20a25[_0x530b10(0x2a7)]});_0x16e390=await purchases['aggregate']([{'$match':{'warehouse_name':_0x28de7f['warehouse']}},{'$lookup':{'from':_0x530b10(0x2ce),'localField':_0x530b10(0x2ce),'foreignField':_0x530b10(0x2b5),'as':'suppliers_docs'}},{'$unwind':_0x530b10(0x253)},{'$unwind':_0x530b10(0x2d3)},{'$group':{'_id':_0x530b10(0x24a),'invoice':{'$first':_0x530b10(0x291)},'suppliers':{'$first':_0x530b10(0x210)},'date':{'$first':_0x530b10(0x2dc)},'warehouse_name':{'$first':_0x530b10(0x24f)},'room':{'$first':_0x530b10(0x2d0)},'product':{'$push':_0x530b10(0x2d3)},'note':{'$first':_0x530b10(0x2b9)},'paid_amount':{'$first':_0x530b10(0x26d)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x530b10(0x27e)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x530b10(0x253)},'total_product_quantity':{'$sum':_0x530b10(0x23f)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x530b10(0x225)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x16e390=await purchases['aggregate']([{'$lookup':{'from':'suppliers','localField':_0x530b10(0x2ce),'foreignField':_0x530b10(0x2b5),'as':_0x530b10(0x1de)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x530b10(0x24a),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x530b10(0x210)},'date':{'$first':_0x530b10(0x2dc)},'warehouse_name':{'$first':_0x530b10(0x24f)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x530b10(0x2d3)},'note':{'$first':_0x530b10(0x2b9)},'paid_amount':{'$first':_0x530b10(0x26d)},'due_amount':{'$first':_0x530b10(0x260)},'return_data':{'$first':_0x530b10(0x27e)},'batch_code':{'$first':_0x530b10(0x241)},'expiry_date':{'$first':_0x530b10(0x1d0)},'suppliers_docs':{'$first':_0x530b10(0x253)},'total_product_quantity':{'$sum':_0x530b10(0x23f)},'level':{'$addToSet':_0x530b10(0x228)},'isle':{'$addToSet':_0x530b10(0x246)},'type':{'$addToSet':_0x530b10(0x2d7)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x530b10(0x2b2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5123c4[0x0]['language']==_0x530b10(0x258)){var _0x57634f=users[_0x530b10(0x22b)];console[_0x530b10(0x1f0)](_0x57634f);}else{if(_0x5123c4[0x0][_0x530b10(0x22d)]==_0x530b10(0x2a3))var _0x57634f=users[_0x530b10(0x2a3)];else{if(_0x5123c4[0x0]['language']=='German')var _0x57634f=users[_0x530b10(0x1cc)];else{if(_0x5123c4[0x0][_0x530b10(0x22d)]==_0x530b10(0x1d4))var _0x57634f=users[_0x530b10(0x1d4)];else{if(_0x5123c4[0x0][_0x530b10(0x22d)]=='French')var _0x57634f=users[_0x530b10(0x23a)];else{if(_0x5123c4[0x0][_0x530b10(0x22d)]==_0x530b10(0x1cd))var _0x57634f=users[_0x530b10(0x26e)];else{if(_0x5123c4[0x0][_0x530b10(0x22d)]==_0x530b10(0x2bb))var _0x57634f=users[_0x530b10(0x2bb)];else{if(_0x5123c4[0x0][_0x530b10(0x22d)]==_0x530b10(0x1f2))var _0x57634f=users['Arabic'];}}}}}}}_0xf977b1[_0x530b10(0x2dd)](_0x530b10(0x263),{'success':_0x289cc9[_0x530b10(0x23d)](_0x530b10(0x252)),'errors':_0x289cc9[_0x530b10(0x23d)]('errors'),'purchases':_0x16e390,'role':_0xf20a25,'profile':_0x20bafb,'master_shop':_0x5123c4,'language':_0x57634f});}catch(_0x5d2272){console[_0x530b10(0x1f0)]('table\x20page',_0x5d2272),_0xf977b1[_0x530b10(0x2cd)](0xc8)[_0x530b10(0x2e2)]({'message':_0x5d2272[_0x530b10(0x1d1)]});}});function BayBinSelected(_0x5bc8f5,_0xbba26a){var _0x32fe82=a0_0x10d756,_0x1fc5d1=[],_0x5c79fe=[],_0x4eaa03=[],_0x3eaad6=[],_0x58f17f=[],_0x56fbea=[];let _0x280c25=[];if(_0x5bc8f5=='DRY\x20STORAGE')switch(_0xbba26a){case _0x32fe82(0x209):_0x1fc5d1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5c79fe=[0x1,0x2],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=[_0x32fe82(0x1e2),_0x32fe82(0x220)],_0x58f17f=['D'],_0x56fbea=['A'];break;case _0x32fe82(0x293):_0x1fc5d1=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5c79fe=[0x1,0x2],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=['Level','Floor'],_0x58f17f=['D'],_0x56fbea=['B'];break;case'Shelves':_0x1fc5d1=[0x0],_0x5c79fe=[0x0],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=[_0x32fe82(0x220)],_0x58f17f=['D'],_0x56fbea=['S'];break;case _0x32fe82(0x285):_0x1fc5d1=[0x0],_0x5c79fe=[0x0],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4eaa03=[_0x32fe82(0x220)],_0x58f17f=['D'],_0x56fbea=['R'];break;}else{if(_0x5bc8f5==_0x32fe82(0x29a))switch(_0xbba26a){case _0x32fe82(0x209):_0x1fc5d1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5c79fe=['B','F'],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=[_0x32fe82(0x1e2),_0x32fe82(0x220)],_0x58f17f=['C'],_0x56fbea=['A'];break;case _0x32fe82(0x293):_0x1fc5d1=[0x5,0x4,0x3,0x2,0x1],_0x5c79fe=['F','B','S'],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=['Level',_0x32fe82(0x220)],_0x58f17f=['C'],_0x56fbea=['B'];break;case _0x32fe82(0x23c):_0x1fc5d1=[0x1,0x2,0x3,0x4,0x5],_0x5c79fe=['B','F','S'],_0x3eaad6=[0x5,0x4,0x3,0x2,0x1],_0x4eaa03=[_0x32fe82(0x1e2),_0x32fe82(0x220)],_0x58f17f=['C'],_0x56fbea=['C'];break;case'Rack\x20D':_0x1fc5d1=[0x5,0x4,0x3,0x2,0x1],_0x5c79fe=['F','B','S'],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=[_0x32fe82(0x1e2),'Floor'],_0x58f17f=['C'],_0x56fbea=['D'];break;case _0x32fe82(0x239):_0x1fc5d1=[0x4,0x3,0x2,0x1],_0x5c79fe=[0x1,0x2],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=['Level',_0x32fe82(0x220)],_0x58f17f=['C'],_0x56fbea=['E'];break;case _0x32fe82(0x2a9):_0x1fc5d1=[0x1,0x2,0x3],_0x5c79fe=[0x1,0x2],_0x3eaad6=[0x1,0x2,0x3,0x4,0x5],_0x4eaa03=['Level'],_0x58f17f=['C'],_0x56fbea=['F'];break;}}return{'levels':_0x1fc5d1,'Isle':_0x5c79fe,'rack':_0x3eaad6,'type':_0x4eaa03,'storage':_0x58f17f,'rak':_0x56fbea};}async function getRandom8DigitNumber(){var _0x2cb993=a0_0x10d756;const _0x21a40b=0x989680,_0x5a6c0e=0x5f5e0ff,_0x247774=Math[_0x2cb993(0x2af)](Math[_0x2cb993(0x282)]()*(_0x5a6c0e-_0x21a40b+0x1))+_0x21a40b;var _0x54f095;const _0x318b4f=await purchases[_0x2cb993(0x2a6)]({'invoice':_0x2cb993(0x2cc)+_0x247774});return _0x318b4f&&_0x318b4f[_0x2cb993(0x1ee)]>0x0?_0x54f095=_0x2cb993(0x2cc)+_0x247774:_0x54f095=_0x2cb993(0x2cc)+_0x247774,_0x54f095;}router[a0_0x10d756(0x1f1)](a0_0x10d756(0x2b3),auth,async(_0x5a7153,_0x5b1e9a)=>{var _0x3b1bc3=a0_0x10d756;try{const {username:_0x52a3c3,email:_0x3b802d,role:_0x1cba29}=_0x5a7153[_0x3b1bc3(0x22f)],_0x4c576f=_0x5a7153[_0x3b1bc3(0x22f)],_0x3b7e8d=await profile[_0x3b1bc3(0x2a6)]({'email':_0x4c576f[_0x3b1bc3(0x2a7)]}),_0x287b2e=await master_shop[_0x3b1bc3(0x2e1)](),_0x57f014=await staff[_0x3b1bc3(0x2a6)]({'email':_0x4c576f[_0x3b1bc3(0x2a7)]}),_0x38c006=await suppliers[_0x3b1bc3(0x2e1)]({});let _0x3e07b8;if(_0x4c576f[_0x3b1bc3(0x274)]=='staff'){const _0x335d6d=await staff[_0x3b1bc3(0x2a6)]({'email':_0x4c576f[_0x3b1bc3(0x2a7)]});_0x3e07b8=await warehouse[_0x3b1bc3(0x24c)]([{'$match':{'status':_0x3b1bc3(0x2de),'name':_0x335d6d['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x3b1bc3(0x270),'name':{'$first':'$name'}}}]);}else _0x3e07b8=await warehouse['aggregate']([{'$match':{'status':_0x3b1bc3(0x2de),'warehouse_category':_0x3b1bc3(0x275),'name':{'$ne':_0x3b1bc3(0x28e)}}},{'$group':{'_id':_0x3b1bc3(0x270),'name':{'$first':_0x3b1bc3(0x270)}}}]);const _0x1d6b39=await product[_0x3b1bc3(0x2e1)]({}),_0x590969=await warehouse[_0x3b1bc3(0x2e1)]({'status':_0x3b1bc3(0x2de)}),_0xf5c522=await purchases[_0x3b1bc3(0x2e1)]({}),_0x24e894=_0xf5c522[_0x3b1bc3(0x1ee)]+0x1,_0x1bf13f=_0x3b1bc3(0x2cc)+_0x24e894[_0x3b1bc3(0x2ac)]()[_0x3b1bc3(0x242)](0x5,'0');var _0x1bea19=[_0x3b1bc3(0x2ad),_0x3b1bc3(0x248)];if(_0x287b2e[0x0][_0x3b1bc3(0x22d)]==_0x3b1bc3(0x258))var _0x4bf1f6=users[_0x3b1bc3(0x22b)];else{if(_0x287b2e[0x0]['language']=='Hindi')var _0x4bf1f6=users[_0x3b1bc3(0x2a3)];else{if(_0x287b2e[0x0][_0x3b1bc3(0x22d)]==_0x3b1bc3(0x1cc))var _0x4bf1f6=users[_0x3b1bc3(0x1cc)];else{if(_0x287b2e[0x0]['language']==_0x3b1bc3(0x1d4))var _0x4bf1f6=users[_0x3b1bc3(0x1d4)];else{if(_0x287b2e[0x0][_0x3b1bc3(0x22d)]==_0x3b1bc3(0x23a))var _0x4bf1f6=users[_0x3b1bc3(0x23a)];else{if(_0x287b2e[0x0]['language']==_0x3b1bc3(0x1cd))var _0x4bf1f6=users[_0x3b1bc3(0x26e)];else{if(_0x287b2e[0x0]['language']==_0x3b1bc3(0x2bb))var _0x4bf1f6=users[_0x3b1bc3(0x2bb)];else{if(_0x287b2e[0x0][_0x3b1bc3(0x22d)]==_0x3b1bc3(0x1f2))var _0x4bf1f6=users[_0x3b1bc3(0x219)];}}}}}}}const _0x9a37aa=getRandom8DigitNumber();_0x9a37aa[_0x3b1bc3(0x222)](_0x866cd4=>{var _0xa56e8b=_0x3b1bc3;_0x5b1e9a[_0xa56e8b(0x2dd)](_0xa56e8b(0x2c4),{'success':_0x5a7153['flash'](_0xa56e8b(0x252)),'errors':_0x5a7153[_0xa56e8b(0x23d)]('errors'),'role':_0x4c576f,'profile':_0x3b7e8d,'suppliers':_0x38c006,'warehouse':_0x3e07b8,'product':_0x1d6b39,'invoice':_0x866cd4,'master_shop':_0x287b2e,'language':_0x4bf1f6,'find_data':_0x590969,'rooms_data':_0x1bea19});})[_0x3b1bc3(0x212)](_0x3ec1b3=>{var _0x34bbd1=_0x3b1bc3;_0x5a7153[_0x34bbd1(0x23d)](_0x34bbd1(0x2be),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5b1e9a['redirect'](_0x34bbd1(0x214));});}catch(_0x1c6cfa){console[_0x3b1bc3(0x1f0)](_0x1c6cfa);}}),router[a0_0x10d756(0x1f1)]('/view/add_purchases/:id',auth,async(_0x4e38d5,_0x3d1f9d)=>{var _0xc5a012=a0_0x10d756;try{const _0x4ac5c8=_0x4e38d5[_0xc5a012(0x20b)]['id'];console[_0xc5a012(0x1f0)](_0x4ac5c8);const _0x416c22=await master_shop['find']();console[_0xc5a012(0x1f0)](_0xc5a012(0x25d),_0x416c22);const _0xfa93f=await product['findOne']({'name':_0x4ac5c8});console[_0xc5a012(0x1f0)](_0xc5a012(0x243),_0xfa93f),_0x3d1f9d[_0xc5a012(0x2cd)](0xc8)['json']({'product_data':_0xfa93f,'master':_0x416c22});}catch(_0x126495){console[_0xc5a012(0x1f0)](_0xc5a012(0x1e0),_0x126495);}}),router[a0_0x10d756(0x23e)](a0_0x10d756(0x2b3),auth,async(_0x26804a,_0x214b93)=>{var _0x2e6a6b=a0_0x10d756;try{const {invoice:_0x11c9f3,date:_0x153305,warehouse_name:_0x20901c,prod_name:_0x204b37,prod_code:_0x499ea0,prod_qty:_0x2df357,prod_unit:_0x524362,prod_secondunit:_0x5bd0be,prod_level:_0x19b188,prod_isle:_0x59e61b,prod_pallet:_0x43d6f2,note:_0x9a8c9c,expiry_date:_0x280941,batch_code:_0x376d2e,payable:_0x3fce90,due_amount:_0x344f8b,Room_name:_0x5192f1,primary_code:_0x22070f,secondary_code:_0x1b8b9c,MaxStocks_data:_0x3d1fba,PO_number:_0x58ac31,SCRN:_0x2c7d94,JO_number:_0x265b1e}=_0x26804a[_0x2e6a6b(0x20f)];if(typeof _0x204b37==_0x2e6a6b(0x27a))var _0x41cfff=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x268)]],_0x3b6153=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x29d)]],_0x118e06=[_0x26804a['body'][_0x2e6a6b(0x26a)]],_0x215d9f=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x244)]],_0x38d910=[_0x26804a['body'][_0x2e6a6b(0x223)]],_0x323ec8=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x294)]],_0x5a00a0=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2d4)]],_0x1483d9=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x1dc)]],_0x30a9ef=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x1fe)]],_0x2262ba=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x1d5)]],_0x2b1a72=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2cb)]],_0x2a3ebb=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2ca)]],_0x4870ed=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2bc)]],_0x3f49a8=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x1d2)]],_0xf2ce06=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x203)]],_0x546376=[_0x26804a[_0x2e6a6b(0x20f)]['RoomAssign']],_0x103e80=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x22a)]],_0x8dbe74=[_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x26c)]],_0x24bb36=[_0x26804a['body'][_0x2e6a6b(0x227)]],_0x208791=[_0x26804a['body']['actual_uom']];else var _0x41cfff=[..._0x26804a['body'][_0x2e6a6b(0x268)]],_0x3b6153=[..._0x26804a['body']['prod_code']],_0x118e06=[..._0x26804a['body'][_0x2e6a6b(0x26a)]],_0x215d9f=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x244)]],_0x38d910=[..._0x26804a[_0x2e6a6b(0x20f)]['prod_secondunit']],_0x323ec8=[..._0x26804a[_0x2e6a6b(0x20f)]['prod_level']],_0x5a00a0=[..._0x26804a['body']['primary_code']],_0x1483d9=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x1dc)]],_0x30a9ef=[..._0x26804a[_0x2e6a6b(0x20f)]['MaxStocks_data']],_0x2262ba=[..._0x26804a[_0x2e6a6b(0x20f)]['batch_code']],_0x2b1a72=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2cb)]],_0x2a3ebb=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2ca)]],_0x4870ed=[..._0x26804a['body'][_0x2e6a6b(0x2bc)]],_0x3f49a8=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x1d2)]],_0xf2ce06=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x203)]],_0x546376=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x27c)]],_0x103e80=[..._0x26804a['body'][_0x2e6a6b(0x22a)]],_0x8dbe74=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x26c)]],_0x24bb36=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x227)]],_0x208791=[..._0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2b1)]];const _0x32bb98=_0x41cfff[_0x2e6a6b(0x256)](_0x55b63e=>{return _0x55b63e={'product_name':_0x55b63e};});_0x24bb36[_0x2e6a6b(0x2d8)]((_0x1c28f3,_0x57a0ef)=>{var _0x5dc5b9=_0x2e6a6b;_0x32bb98[_0x57a0ef][_0x5dc5b9(0x227)]=Math[_0x5dc5b9(0x27b)](_0x1c28f3);}),_0x208791[_0x2e6a6b(0x2d8)]((_0x1203af,_0x988a5b)=>{var _0x57b728=_0x2e6a6b;_0x32bb98[_0x988a5b][_0x57b728(0x2b1)]=_0x1203af;}),_0x3b6153['forEach']((_0x4e7364,_0x4459f9)=>{var _0x14f474=_0x2e6a6b;_0x32bb98[_0x4459f9][_0x14f474(0x21e)]=_0x4e7364;}),_0x118e06[_0x2e6a6b(0x2d8)]((_0x1a86ea,_0x4c7136)=>{var _0x3c358a=_0x2e6a6b;_0x32bb98[_0x4c7136][_0x3c358a(0x1d3)]=Math[_0x3c358a(0x27b)](_0x1a86ea);}),_0x215d9f[_0x2e6a6b(0x2d8)]((_0x2274de,_0x244e2d)=>{var _0x26cabe=_0x2e6a6b;_0x32bb98[_0x244e2d][_0x26cabe(0x299)]=_0x2274de;}),_0x38d910[_0x2e6a6b(0x2d8)]((_0x4a47ad,_0x59b6d7)=>{var _0x358bff=_0x2e6a6b;_0x32bb98[_0x59b6d7][_0x358bff(0x28f)]=_0x4a47ad;}),_0x323ec8[_0x2e6a6b(0x2d8)]((_0x4aee67,_0x48a5d0)=>{var _0x1fc99d=_0x2e6a6b;_0x546376[_0x1fc99d(0x2d8)]((_0x545385,_0x246539)=>{var _0x3f4021=_0x1fc99d;if(_0x545385==_0x3f4021(0x285)&&_0x48a5d0==_0x246539){console[_0x3f4021(0x1f0)](_0x545385+_0x3f4021(0x2c9)+_0x48a5d0+_0x3f4021(0x1fc)+_0x246539+'\x20<>\x20'+_0x4aee67);var _0x518f6f=_0x4aee67['slice'](0x3);_0x32bb98[_0x48a5d0]['storage']=_0x4aee67[0x0],_0x32bb98[_0x48a5d0][_0x3f4021(0x283)]=_0x4aee67[0x1],_0x32bb98[_0x48a5d0][_0x3f4021(0x1e9)]=0x0,_0x32bb98[_0x48a5d0][_0x3f4021(0x1ce)]=0x0,_0x32bb98[_0x48a5d0]['type']=_0x3f4021(0x220),_0x32bb98[_0x48a5d0][_0x3f4021(0x1e1)]=_0x518f6f;}else{if(_0x545385==_0x3f4021(0x217)&&_0x48a5d0==_0x246539){var _0x518f6f=_0x4aee67[_0x3f4021(0x29c)](0x3);_0x32bb98[_0x48a5d0][_0x3f4021(0x265)]=_0x4aee67[0x0],_0x32bb98[_0x48a5d0][_0x3f4021(0x283)]=_0x4aee67[0x1],_0x32bb98[_0x48a5d0][_0x3f4021(0x1e9)]=0x0,_0x32bb98[_0x48a5d0][_0x3f4021(0x1ce)]=0x0,_0x32bb98[_0x48a5d0][_0x3f4021(0x26b)]='Floor',_0x32bb98[_0x48a5d0][_0x3f4021(0x1e1)]=_0x4aee67[0x5];}else{if(_0x48a5d0==_0x246539){if(_0x4aee67[0x0]=='A'&&_0x4aee67[0x1]=='L'&&_0x4aee67[0x2]=='L')console['log'](_0x545385+_0x3f4021(0x1fc)+_0x48a5d0+'\x20<>\x20'+_0x246539+_0x3f4021(0x1fc)+_0x4aee67+_0x3f4021(0x25a)),_0x32bb98[_0x48a5d0][_0x3f4021(0x265)]=_0x4aee67[0x0],_0x32bb98[_0x48a5d0]['rack']=_0x4aee67[0x1],_0x32bb98[_0x48a5d0][_0x3f4021(0x1e9)]=0x0,_0x32bb98[_0x48a5d0][_0x3f4021(0x1ce)]=0x0,_0x32bb98[_0x48a5d0][_0x3f4021(0x26b)]=_0x3f4021(0x220),_0x32bb98[_0x48a5d0][_0x3f4021(0x1e1)]=_0x4aee67[0x3];else{var _0x54b008;if(_0x4aee67[0x4]=='L')_0x54b008=_0x3f4021(0x1e2);else _0x4aee67[0x4]=='F'&&(_0x54b008='Floor');_0x32bb98[_0x48a5d0][_0x3f4021(0x265)]=_0x4aee67[0x0],_0x32bb98[_0x48a5d0][_0x3f4021(0x283)]=_0x4aee67[0x1],_0x32bb98[_0x48a5d0]['bay']=_0x4aee67[0x2],_0x32bb98[_0x48a5d0][_0x3f4021(0x1ce)]=_0x4aee67[0x3],_0x32bb98[_0x48a5d0][_0x3f4021(0x26b)]=_0x54b008,_0x32bb98[_0x48a5d0][_0x3f4021(0x1e1)]=_0x4aee67[0x5];}}}}});}),_0x5a00a0['forEach']((_0x445d30,_0x338088)=>{var _0x159021=_0x2e6a6b;_0x32bb98[_0x338088][_0x159021(0x2d4)]=_0x445d30;}),_0x1483d9[_0x2e6a6b(0x2d8)]((_0x3480b5,_0xe952fe)=>{var _0x3338d1=_0x2e6a6b;_0x32bb98[_0xe952fe][_0x3338d1(0x1dc)]=_0x3480b5;}),_0x30a9ef[_0x2e6a6b(0x2d8)]((_0x3d10cc,_0xa3cadb)=>{var _0x3f6d94=_0x2e6a6b;_0x32bb98[_0xa3cadb][_0x3f6d94(0x1fb)]=_0x3d10cc;}),_0x2262ba[_0x2e6a6b(0x2d8)]((_0x56a3b1,_0x554487)=>{var _0x2348e5=_0x2e6a6b;_0x32bb98[_0x554487][_0x2348e5(0x1d5)]=_0x56a3b1;}),_0x2b1a72['forEach']((_0x3a6bb9,_0x29968e)=>{_0x32bb98[_0x29968e]['expiry_date']=_0x3a6bb9;}),_0x2a3ebb[_0x2e6a6b(0x2d8)]((_0x597e67,_0x478dbe)=>{var _0x4b5281=_0x2e6a6b;_0x32bb98[_0x478dbe][_0x4b5281(0x231)]=_0x597e67;}),_0x4870ed['forEach']((_0x4368b3,_0x56c06d)=>{var _0x521223=_0x2e6a6b;_0x32bb98[_0x56c06d][_0x521223(0x2bc)]=_0x4368b3;}),_0x3f49a8['forEach']((_0x1d58fa,_0x32ae1d)=>{_0x32bb98[_0x32ae1d]['production_date']=_0x1d58fa;}),_0xf2ce06[_0x2e6a6b(0x2d8)]((_0x5082a2,_0x114749)=>{var _0x100d6a=_0x2e6a6b;_0x32bb98[_0x114749][_0x100d6a(0x279)]=_0x5082a2;}),_0x546376[_0x2e6a6b(0x2d8)]((_0x4e11cd,_0x1f29ca)=>{var _0x203794=_0x2e6a6b;_0x32bb98[_0x1f29ca][_0x203794(0x2bd)]=_0x4e11cd;}),_0x103e80[_0x2e6a6b(0x2d8)]((_0x4ff9c4,_0x56921d)=>{var _0x3e162a=_0x2e6a6b;_0x32bb98[_0x56921d][_0x3e162a(0x266)]=_0x4ff9c4;}),_0x8dbe74['forEach']((_0x1a3fd7,_0xeae2eb)=>{var _0x430ec4=_0x2e6a6b;_0x32bb98[_0xeae2eb][_0x430ec4(0x29e)]=_0x1a3fd7;});const _0x4f8508=_0x546376[_0x2e6a6b(0x256)](_0x35d15d=>{return _0x35d15d={'room_name':_0x35d15d};}),_0x4127c5=_0x32bb98[_0x2e6a6b(0x2d9)](_0x2b2c5a=>_0x2b2c5a[_0x2e6a6b(0x1d3)]!=='0'&&_0x2b2c5a[_0x2e6a6b(0x1d3)]!==''),_0x577ceb=new purchases({'invoice':_0x11c9f3,'suppliers':_0x26804a[_0x2e6a6b(0x20f)][_0x2e6a6b(0x2ce)],'date':_0x153305,'warehouse_name':_0x20901c,'product':_0x4127c5,'note':_0x9a8c9c,'due_amount':_0x344f8b,'POnumber':_0x58ac31,'SCRN':_0x2c7d94,'JO_number':_0x265b1e,'roomList':_0x4f8508}),_0x5f2341=await _0x577ceb['save'](),_0x2524c0=await purchases['findOne']({'invoice':_0x11c9f3}),_0x3d287a=_0x2524c0[_0x2e6a6b(0x243)][_0x2e6a6b(0x256)](async _0x34c2d5=>{var _0x5ae0b7=_0x2e6a6b,_0x7cd2d9=await warehouse['findOne']({'name':_0x20901c,'room':_0x34c2d5[_0x5ae0b7(0x2bd)]}),_0x14e606=0x0;return _0x7cd2d9[_0x5ae0b7(0x2b7)][_0x5ae0b7(0x2d8)](_0x3c0207=>{var _0x40c027=_0x5ae0b7;_0x3c0207['product_name']==_0x34c2d5[_0x40c027(0x1c8)]&&_0x3c0207[_0x40c027(0x1e1)]==_0x34c2d5[_0x40c027(0x1e1)]&&_0x3c0207['type']==_0x34c2d5['type']&&_0x3c0207[_0x40c027(0x1ce)]==_0x34c2d5[_0x40c027(0x1ce)]&&_0x3c0207[_0x40c027(0x1e9)]==_0x34c2d5[_0x40c027(0x1e9)]&&_0x3c0207[_0x40c027(0x283)]==_0x34c2d5[_0x40c027(0x283)]&&_0x3c0207[_0x40c027(0x265)]==_0x34c2d5[_0x40c027(0x265)]&&_0x3c0207[_0x40c027(0x2cb)]==_0x34c2d5[_0x40c027(0x2cb)]&&_0x3c0207[_0x40c027(0x1d5)]==_0x34c2d5['batch_code']&&_0x3c0207[_0x40c027(0x1d2)]==_0x34c2d5[_0x40c027(0x1d2)]&&_0x3c0207[_0x40c027(0x29e)]==_0x2524c0[_0x40c027(0x29e)]&&(_0x3c0207[_0x40c027(0x2b8)]+=Math['abs'](_0x34c2d5[_0x40c027(0x1d3)]),_0x14e606++);}),_0x14e606===0x0&&_0x7cd2d9[_0x5ae0b7(0x2b7)][_0x5ae0b7(0x272)]({'product_name':_0x34c2d5['product_name'],'product_stock':Math[_0x5ae0b7(0x27b)](_0x34c2d5['quantity']),'primary_code':_0x34c2d5[_0x5ae0b7(0x2d4)],'secondary_code':_0x34c2d5['secondary_code'],'product_code':_0x34c2d5['product_code'],'storage':_0x34c2d5[_0x5ae0b7(0x265)],'rack':_0x34c2d5[_0x5ae0b7(0x283)],'bay':_0x34c2d5[_0x5ae0b7(0x1e9)],'bin':_0x34c2d5[_0x5ae0b7(0x1ce)],'type':_0x34c2d5[_0x5ae0b7(0x26b)],'floorlevel':_0x34c2d5[_0x5ae0b7(0x1e1)],'maxProducts':_0x34c2d5['maxStocks'],'unit':_0x34c2d5[_0x5ae0b7(0x299)],'secondary_unit':_0x34c2d5['secondary_unit'],'expiry_date':_0x34c2d5[_0x5ae0b7(0x2cb)],'maxPerUnit':_0x34c2d5[_0x5ae0b7(0x231)],'batch_code':_0x34c2d5[_0x5ae0b7(0x1d5)],'alertQTY':_0x34c2d5[_0x5ae0b7(0x2bc)],'production_date':_0x34c2d5[_0x5ae0b7(0x1d2)],'product_cat':_0x34c2d5[_0x5ae0b7(0x279)],'invoice':_0x34c2d5[_0x5ae0b7(0x29e)],'actual_qty':Math[_0x5ae0b7(0x27b)](_0x34c2d5['actual_qty']),'actual_uom':_0x34c2d5[_0x5ae0b7(0x2b1)]}),_0x7cd2d9;});Promise[_0x2e6a6b(0x273)](_0x3d287a)['then'](async _0x3f3851=>{var _0x5648a0=_0x2e6a6b;try{for(const _0x11c8fe of _0x3f3851){await _0x11c8fe[_0x5648a0(0x1db)]();}const _0xb43cd=await master_shop[_0x5648a0(0x2e1)](),_0x1b1747=await email_settings[_0x5648a0(0x2a6)](),_0x36c9c4=await supervisor_settings[_0x5648a0(0x2e1)]();var _0x4e2685=_0x2524c0[_0x5648a0(0x243)],_0x3e8f90='',_0x1ad9de;for(_0x1ad9de in _0x4e2685){_0x3e8f90+=_0x5648a0(0x2c1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4e2685[_0x1ad9de][_0x5648a0(0x1c8)]+'</td>'+_0x5648a0(0x211)+_0x4e2685[_0x1ad9de][_0x5648a0(0x21e)]+_0x5648a0(0x297)+_0x5648a0(0x211)+_0x4e2685[_0x1ad9de][_0x5648a0(0x1d3)]+'</td>'+_0x5648a0(0x211)+_0x4e2685[_0x1ad9de][_0x5648a0(0x299)]+_0x5648a0(0x297)+_0x5648a0(0x211)+_0x4e2685[_0x1ad9de]['secondary_unit']+'</td>'+_0x5648a0(0x211)+_0x2524c0[_0x5648a0(0x2a0)]+_0x5648a0(0x297)+_0x5648a0(0x211)+_0x4e2685[_0x1ad9de][_0x5648a0(0x2bd)]+_0x5648a0(0x297)+_0x5648a0(0x211)+_0x4e2685[_0x1ad9de]['storage']+_0x4e2685[_0x1ad9de][_0x5648a0(0x283)]+_0x4e2685[_0x1ad9de][_0x5648a0(0x1e9)]+_0x4e2685[_0x1ad9de][_0x5648a0(0x1ce)]+_0x4e2685[_0x1ad9de]['type'][0x0]+_0x4e2685[_0x1ad9de][_0x5648a0(0x1e1)]+_0x5648a0(0x297),_0x5648a0(0x245);}let _0x369142=nodemailer[_0x5648a0(0x224)]({'host':_0x1b1747['host'],'port':Number(_0x1b1747[_0x5648a0(0x21b)]),'secure':![],'auth':{'user':_0x1b1747[_0x5648a0(0x2a7)],'pass':_0x1b1747[_0x5648a0(0x1f3)]}}),_0x5e7132={'from':_0x1b1747[_0x5648a0(0x2a7)],'to':_0x36c9c4[0x0][_0x5648a0(0x2db)],'subject':_0x5648a0(0x251),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x5648a0(0x2c8)+_0xb43cd[0x0][_0x5648a0(0x1e6)],'cid':'logo'}],'html':_0x5648a0(0x201)+_0x5648a0(0x2c3)+_0x5648a0(0x1ed)+'<div>'+_0x5648a0(0x288)+_0x5648a0(0x2e0)+_0x5648a0(0x1d7)+_0x5648a0(0x281)+_0x5648a0(0x2e0)+_0x5648a0(0x1f9)+_0xb43cd[0x0][_0x5648a0(0x262)]+_0x5648a0(0x298)+_0x5648a0(0x281)+_0x5648a0(0x281)+_0x5648a0(0x215)+_0x5648a0(0x2e0)+_0x5648a0(0x2d1)+'\x20Order\x20Number\x20:\x20'+_0x2524c0[_0x5648a0(0x29e)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2524c0['date']+'\x20'+_0x5648a0(0x21a)+'</h5>'+_0x5648a0(0x281)+_0x5648a0(0x2a2)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5648a0(0x2c1)+_0x5648a0(0x2ab)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5648a0(0x257)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5648a0(0x25c)+_0x5648a0(0x23b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5648a0(0x254)+_0x5648a0(0x245)+_0x5648a0(0x230)+_0x5648a0(0x1ca)+'\x20'+_0x3e8f90+'\x20'+'</tbody>'+_0x5648a0(0x2b4)+_0x5648a0(0x2e0)+_0x5648a0(0x202)+_0x5648a0(0x269)+_0xb43cd[0x0][_0x5648a0(0x262)]+_0x5648a0(0x28a)+_0x5648a0(0x281)+_0x5648a0(0x281)+'</body></html>'};_0x369142[_0x5648a0(0x233)](_0x5e7132,function(_0xd0589f,_0x41af80){var _0x16e134=_0x5648a0;_0xd0589f?(console[_0x16e134(0x1f0)](_0xd0589f),console[_0x16e134(0x1f0)](_0x16e134(0x232))):console[_0x16e134(0x1f0)](_0x16e134(0x28d));}),_0x26804a['flash'](_0x5648a0(0x252),'Purchase\x20data\x20added\x20successfully'),_0x214b93[_0x5648a0(0x287)](_0x5648a0(0x271));}catch(_0x4d7aba){console[_0x5648a0(0x2b0)](_0x4d7aba),_0x214b93['status'](0x1f4)[_0x5648a0(0x2e2)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x25f1ff=>{var _0x125eb2=_0x2e6a6b;console[_0x125eb2(0x2b0)](_0x25f1ff),_0x214b93['status'](0x1f4)[_0x125eb2(0x2e2)]({'error':'An\x20error\x20occurred.'});});}catch(_0x6def0d){console[_0x2e6a6b(0x1f0)](_0x6def0d);}}),router['get'](a0_0x10d756(0x1fa),auth,async(_0x342391,_0x23a3a1)=>{var _0x273cf4=a0_0x10d756;try{const {username:_0x56c739,email:_0x40ccfc,role:_0x4e9724}=_0x342391[_0x273cf4(0x22f)],_0x5d0098=_0x342391[_0x273cf4(0x22f)],_0xdbc1a4=await profile[_0x273cf4(0x2a6)]({'email':_0x5d0098[_0x273cf4(0x2a7)]}),_0x17a36a=await master_shop[_0x273cf4(0x2e1)](),_0x1ace9e=_0x342391[_0x273cf4(0x20b)]['id'],_0x292d99=await purchases['findById'](_0x1ace9e),_0x116455=await warehouse[_0x273cf4(0x24c)]([{'$match':{'name':_0x292d99[_0x273cf4(0x2a0)],'room':_0x292d99[_0x273cf4(0x261)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x273cf4(0x20d),'name':{'$first':_0x273cf4(0x2b6)},'product_stock':{'$first':_0x273cf4(0x2c0)},'bay':{'$first':_0x273cf4(0x1f5)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x273cf4(0x1f8)},'floorlevel':{'$first':_0x273cf4(0x2d2)},'primary_code':{'$first':_0x273cf4(0x234)},'secondary_code':{'$first':_0x273cf4(0x238)},'product_code':{'$first':_0x273cf4(0x27f)},'storage':{'$first':_0x273cf4(0x289)},'rack':{'$first':_0x273cf4(0x1c7)},'expiry_date':{'$first':_0x273cf4(0x236)}}}]),_0x355ff8=await customer['find']({});let _0x113afa;if(_0x5d0098[_0x273cf4(0x274)]==_0x273cf4(0x213)){const _0x56a3e9=await staff[_0x273cf4(0x2a6)]({'email':_0x5d0098[_0x273cf4(0x2a7)]});_0x113afa=await warehouse[_0x273cf4(0x24c)]([{'$match':{'status':_0x273cf4(0x2de),'name':_0x56a3e9[_0x273cf4(0x1d6)]}},{'$group':{'_id':_0x273cf4(0x270),'name':{'$first':_0x273cf4(0x270)}}}]);}else _0x113afa=await warehouse[_0x273cf4(0x24c)]([{'$match':{'status':_0x273cf4(0x2de)}},{'$group':{'_id':_0x273cf4(0x270),'name':{'$first':_0x273cf4(0x270)}}}]);const _0x3bf6a0=await product['find']({}),_0x1de996=await suppliers[_0x273cf4(0x2e1)]({}),_0x5cff5c=BayBinSelected(_0x292d99[_0x273cf4(0x2a0)],_0x292d99[_0x273cf4(0x261)]);if(_0x17a36a[0x0]['language']==_0x273cf4(0x258)){var _0x543541=users[_0x273cf4(0x22b)];console['log'](_0x543541);}else{if(_0x17a36a[0x0][_0x273cf4(0x22d)]=='Hindi')var _0x543541=users[_0x273cf4(0x2a3)];else{if(_0x17a36a[0x0][_0x273cf4(0x22d)]=='German')var _0x543541=users['German'];else{if(_0x17a36a[0x0][_0x273cf4(0x22d)]==_0x273cf4(0x1d4))var _0x543541=users['Spanish'];else{if(_0x17a36a[0x0][_0x273cf4(0x22d)]==_0x273cf4(0x23a))var _0x543541=users['French'];else{if(_0x17a36a[0x0]['language']==_0x273cf4(0x1cd))var _0x543541=users[_0x273cf4(0x26e)];else{if(_0x17a36a[0x0][_0x273cf4(0x22d)]==_0x273cf4(0x2bb))var _0x543541=users[_0x273cf4(0x2bb)];else{if(_0x17a36a[0x0][_0x273cf4(0x22d)]=='Arabic\x20(ae)')var _0x543541=users[_0x273cf4(0x219)];}}}}}}}_0x23a3a1[_0x273cf4(0x2dd)](_0x273cf4(0x280),{'success':_0x342391['flash']('success'),'errors':_0x342391[_0x273cf4(0x23d)](_0x273cf4(0x2be)),'role':_0x5d0098,'profile':_0xdbc1a4,'customer':_0x355ff8,'warehouse':_0x113afa,'product':_0x116455,'user':_0x292d99,'master_shop':_0x17a36a,'unit':_0x3bf6a0,'language':_0x543541,'suppliers':_0x1de996,'dataSelected':_0x5cff5c});}catch(_0x10447a){console[_0x273cf4(0x1f0)](_0x10447a);}}),router['post'](a0_0x10d756(0x1fa),auth,async(_0x7a01e,_0xce3a2d)=>{var _0x2e817f=a0_0x10d756;try{const _0x36f687=_0x7a01e[_0x2e817f(0x20b)]['id'],{invoice:_0x20a97e,warehouse_name:_0x312cf4,Room_name:_0x69ff06}=_0x7a01e[_0x2e817f(0x20f)],_0x9f484a=await warehouse['findOne']({'name':_0x312cf4,'room':_0x69ff06}),_0x17ff98=await purchases[_0x2e817f(0x2a6)]({'invoice':_0x20a97e});_0x17ff98['product'][_0x2e817f(0x2d8)](_0x17542c=>{var _0x39697e=_0x2e817f,_0x422902=0x0;const _0x24e85b=_0x9f484a[_0x39697e(0x2b7)][_0x39697e(0x256)](_0x458be6=>{var _0x437c34=_0x39697e;_0x458be6[_0x437c34(0x1c8)]==_0x17542c[_0x437c34(0x1c8)]&&_0x458be6[_0x437c34(0x1e1)]==_0x17542c['floorlevel']&&_0x458be6[_0x437c34(0x26b)]==_0x17542c[_0x437c34(0x26b)]&&_0x458be6['bin']==_0x17542c['bin']&&_0x458be6[_0x437c34(0x1e9)]==_0x17542c[_0x437c34(0x1e9)]&&_0x458be6[_0x437c34(0x283)]==_0x17542c[_0x437c34(0x283)]&&_0x458be6[_0x437c34(0x265)]==_0x17542c[_0x437c34(0x265)]&&_0x458be6[_0x437c34(0x2cb)]==_0x17542c['expiry_date']&&_0x458be6[_0x437c34(0x1d5)]==_0x17542c[_0x437c34(0x1d5)]&&_0x458be6[_0x437c34(0x1d2)]==_0x17542c[_0x437c34(0x1d2)]&&_0x458be6['delivery_date']==_0x17542c[_0x437c34(0x1f7)]&&_0x458be6[_0x437c34(0x266)]==_0x17542c[_0x437c34(0x266)]&&(_0x458be6['product_stock']=parseInt(_0x458be6['product_stock'])+parseInt(_0x17542c[_0x437c34(0x1d3)]),_0x422902++);});_0x422902=='0'&&(_0x9f484a[_0x39697e(0x2b7)]=_0x9f484a[_0x39697e(0x2b7)][_0x39697e(0x24e)]({'product_name':_0x17542c['product_name'],'product_stock':_0x17542c['quantity'],'primary_code':_0x17542c[_0x39697e(0x2d4)],'secondary_code':_0x17542c[_0x39697e(0x1dc)],'product_code':_0x17542c[_0x39697e(0x21e)],'storage':_0x17542c[_0x39697e(0x265)],'rack':_0x17542c[_0x39697e(0x283)],'bay':_0x17542c['bay'],'bin':_0x17542c[_0x39697e(0x1ce)],'type':_0x17542c[_0x39697e(0x26b)],'floorlevel':_0x17542c['floorlevel'],'maxProducts':_0x17542c[_0x39697e(0x1fb)],'unit':_0x17542c[_0x39697e(0x299)],'secondary_unit':_0x17542c[_0x39697e(0x28f)],'expiry_date':_0x17542c[_0x39697e(0x2cb)],'maxPerUnit':_0x17542c[_0x39697e(0x231)],'batch_code':_0x17542c['batch_code'],'alertQTY':_0x17542c['alertQTY'],'production_date':_0x17542c[_0x39697e(0x1d2)],'delivery_date':_0x17542c[_0x39697e(0x1f7)],'delivery_code':_0x17542c[_0x39697e(0x266)]}));}),await _0x9f484a[_0x2e817f(0x1db)](),_0x17ff98[_0x2e817f(0x2d6)]='True';const _0x209ced=await _0x17ff98['save']();_0x7a01e[_0x2e817f(0x23d)](_0x2e817f(0x252),_0x2e817f(0x2da)),_0xce3a2d['redirect'](_0x2e817f(0x214));}catch(_0x2c7a69){console[_0x2e817f(0x1f0)](_0x2c7a69);}}),router[a0_0x10d756(0x1f1)](a0_0x10d756(0x207),auth,async(_0x15e0b7,_0x1a92cb)=>{var _0x57fa6c=a0_0x10d756;try{const {username:_0x3dcccd,email:_0x2eadd4,role:_0x3ae537}=_0x15e0b7[_0x57fa6c(0x22f)],_0x14d792=_0x15e0b7[_0x57fa6c(0x22f)],_0x4b7ba6=await profile['findOne']({'email':_0x14d792[_0x57fa6c(0x2a7)]}),_0x13a48e=await master_shop[_0x57fa6c(0x2e1)](),_0x5e0f36=_0x15e0b7[_0x57fa6c(0x20b)]['id'],_0x594cb5=await purchases[_0x57fa6c(0x200)](_0x5e0f36),_0x2cf72d=await suppliers[_0x57fa6c(0x2e1)]({});let _0x4b8326;if(_0x14d792[_0x57fa6c(0x274)]==_0x57fa6c(0x213)){const _0x343b7b=await staff[_0x57fa6c(0x2a6)]({'email':_0x14d792[_0x57fa6c(0x2a7)]});_0x4b8326=await warehouse[_0x57fa6c(0x2e1)]({'status':_0x57fa6c(0x2de),'name':_0x343b7b[_0x57fa6c(0x1d6)],'warehouse_category':_0x57fa6c(0x275)});}else _0x4b8326=await warehouse[_0x57fa6c(0x24c)]([{'$match':{'status':_0x57fa6c(0x2de),'warehouse_category':_0x57fa6c(0x275)}},{'$group':{'_id':'$name','name':{'$first':_0x57fa6c(0x270)}}}]);const _0x3ea834=await product[_0x57fa6c(0x2e1)]({}),_0x119855=BayBinSelected(_0x594cb5[_0x57fa6c(0x2a0)],_0x594cb5[_0x57fa6c(0x261)]);let _0x5c69a0=new Date(_0x594cb5[_0x57fa6c(0x2cb)]),_0x3aeaed=('0'+_0x5c69a0[_0x57fa6c(0x1f4)]())[_0x57fa6c(0x29c)](-0x2),_0xb65721=('0'+(_0x5c69a0[_0x57fa6c(0x21d)]()+0x1))[_0x57fa6c(0x29c)](-0x2),_0x4cc438=_0x5c69a0[_0x57fa6c(0x1c9)](),_0x545da8=_0x4cc438+'-'+_0xb65721+'-'+_0x3aeaed;if(_0x13a48e[0x0][_0x57fa6c(0x22d)]==_0x57fa6c(0x258)){var _0x47f1aa=users[_0x57fa6c(0x22b)];console['log'](_0x47f1aa);}else{if(_0x13a48e[0x0]['language']==_0x57fa6c(0x2a3))var _0x47f1aa=users['Hindi'];else{if(_0x13a48e[0x0][_0x57fa6c(0x22d)]==_0x57fa6c(0x1cc))var _0x47f1aa=users[_0x57fa6c(0x1cc)];else{if(_0x13a48e[0x0][_0x57fa6c(0x22d)]==_0x57fa6c(0x1d4))var _0x47f1aa=users[_0x57fa6c(0x1d4)];else{if(_0x13a48e[0x0][_0x57fa6c(0x22d)]==_0x57fa6c(0x23a))var _0x47f1aa=users[_0x57fa6c(0x23a)];else{if(_0x13a48e[0x0]['language']==_0x57fa6c(0x1cd))var _0x47f1aa=users[_0x57fa6c(0x26e)];else{if(_0x13a48e[0x0][_0x57fa6c(0x22d)]=='Chinese')var _0x47f1aa=users['Chinese'];else{if(_0x13a48e[0x0][_0x57fa6c(0x22d)]=='Arabic\x20(ae)')var _0x47f1aa=users[_0x57fa6c(0x219)];}}}}}}}_0x1a92cb['render'](_0x57fa6c(0x2c7),{'success':_0x15e0b7[_0x57fa6c(0x23d)](_0x57fa6c(0x252)),'errors':_0x15e0b7[_0x57fa6c(0x23d)](_0x57fa6c(0x2be)),'role':_0x14d792,'profile':_0x4b7ba6,'purchases':_0x594cb5,'suppliers':_0x2cf72d,'warehouse':_0x4b8326,'product':_0x3ea834,'master_shop':_0x13a48e,'language':_0x47f1aa,'ed_fullDate':_0x545da8,'dataSelected':_0x119855});}catch(_0x196a6a){console[_0x57fa6c(0x1f0)](_0x196a6a);}}),router['post']('/view/:id',auth,async(_0x2431be,_0x24044b)=>{var _0x26ead3=a0_0x10d756;try{const _0x5e9801=_0x2431be[_0x26ead3(0x20b)]['id'],_0x2bf963=await purchases[_0x26ead3(0x2a6)]({'_id':_0x2431be[_0x26ead3(0x20b)]['id']}),_0x52df43=await warehouse[_0x26ead3(0x2a6)]({'name':_0x2bf963[_0x26ead3(0x2a0)],'room':_0x2bf963[_0x26ead3(0x261)]});_0x2bf963[_0x26ead3(0x243)][_0x26ead3(0x2d8)](_0x1139d9=>{var _0x962d76=_0x26ead3;const _0x2eada1=_0x52df43[_0x962d76(0x2b7)][_0x962d76(0x256)](_0xbf44=>{var _0x48855d=_0x962d76;_0xbf44[_0x48855d(0x1c8)]==_0x1139d9['product_name']&&_0xbf44[_0x48855d(0x1e1)]==_0x1139d9[_0x48855d(0x1e1)]&&_0xbf44[_0x48855d(0x26b)]==_0x1139d9[_0x48855d(0x26b)]&&_0xbf44['bin']==_0x1139d9[_0x48855d(0x1ce)]&&_0xbf44[_0x48855d(0x1e9)]==_0x1139d9['bay']&&_0xbf44[_0x48855d(0x283)]==_0x1139d9[_0x48855d(0x283)]&&_0xbf44[_0x48855d(0x265)]==_0x1139d9['storage']&&(_0xbf44[_0x48855d(0x2b8)]=parseInt(_0xbf44[_0x48855d(0x2b8)])-parseInt(_0x1139d9[_0x48855d(0x1d3)]));});}),await _0x52df43[_0x26ead3(0x1db)]();const {invoice:_0x1caa89,suppliers:_0x16cd79,date:_0x5e0d1a,warehouse_name:_0x9a11f4,prod_name:_0x5ce9a4,prod_code:_0xf12099,prod_qty:_0x23c62d,prod_unit:_0x4146e6,prod_secondunit:_0x4cdfc3,prod_level:_0x1a118,prod_isle:_0x45abd5,prod_pallet:_0x29c4b8,note:_0x2b20e5,expiry_date:_0x4c561f,batch_code:_0x343ac3,paid_amount:_0x1c877a,due_amount:_0x291f3f,Room_name:_0x51e2d9,primary_code:_0x5a3a0c,secondary_code:_0x3b751b,PO_number:_0x1aa52c,JO_number:_0x165cd4}=_0x2431be[_0x26ead3(0x20f)];if(typeof _0x5ce9a4==_0x26ead3(0x27a))var _0x138250=[_0x2431be['body'][_0x26ead3(0x268)]],_0x2953c9=[_0x2431be['body']['prod_code']],_0x105e23=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x221)]],_0x9137cf=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x290)]],_0x439adc=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x223)]],_0x55a887=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x294)]],_0x23060d=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2bf)]],_0x1609d9=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x205)]],_0x475ffa=[_0x2431be['body'][_0x26ead3(0x2d4)]],_0x49cc78=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x1dc)]],_0x266360=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x1fe)]],_0x5b7c57=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x1d5)]],_0xd621d=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2cb)]],_0x36b52a=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x265)]],_0x49ecc7=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2ba)]],_0x473099=[_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x26b)]];else var _0x138250=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x268)]],_0x2953c9=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x29d)]],_0x105e23=[..._0x2431be[_0x26ead3(0x20f)]['prod_qty']],_0x9137cf=[..._0x2431be['body'][_0x26ead3(0x290)]],_0x439adc=[..._0x2431be['body']['prod_secondunit']],_0x55a887=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x294)]],_0x23060d=[..._0x2431be[_0x26ead3(0x20f)]['prod_isle']],_0x1609d9=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x205)]],_0x475ffa=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2d4)]],_0x49cc78=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x1dc)]],_0x266360=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x1fe)]],_0x5b7c57=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x1d5)]],_0xd621d=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2cb)]],_0x36b52a=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x265)]],_0x49ecc7=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2ba)]],_0x473099=[..._0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x26b)]];const _0x2384f1=_0x138250[_0x26ead3(0x256)](_0x11f3a6=>{return _0x11f3a6={'product_name':_0x11f3a6};});_0x2953c9['forEach']((_0x152c7c,_0x33b337)=>{var _0x53b0a9=_0x26ead3;_0x2384f1[_0x33b337][_0x53b0a9(0x21e)]=_0x152c7c;}),_0x105e23[_0x26ead3(0x2d8)]((_0x473134,_0x8bfff)=>{var _0x43fac1=_0x26ead3;_0x2384f1[_0x8bfff][_0x43fac1(0x1d3)]=_0x473134;}),_0x9137cf[_0x26ead3(0x2d8)]((_0x1a873a,_0x476bf1)=>{var _0x16ddf5=_0x26ead3;_0x2384f1[_0x476bf1][_0x16ddf5(0x299)]=_0x1a873a;}),_0x439adc[_0x26ead3(0x2d8)]((_0x4d0e01,_0x47c659)=>{var _0x5a6a4e=_0x26ead3;_0x2384f1[_0x47c659][_0x5a6a4e(0x28f)]=_0x4d0e01;}),_0x55a887[_0x26ead3(0x2d8)]((_0x5edb0f,_0x4828af)=>{var _0x3e58d0=_0x26ead3;_0x2384f1[_0x4828af][_0x3e58d0(0x1e9)]=_0x5edb0f;}),_0x23060d[_0x26ead3(0x2d8)]((_0x51cde5,_0x484a99)=>{var _0x2e960e=_0x26ead3;_0x2384f1[_0x484a99][_0x2e960e(0x1ce)]=_0x51cde5;}),_0x1609d9[_0x26ead3(0x2d8)]((_0x515c14,_0x106b2d)=>{var _0x48aa87=_0x26ead3;_0x2384f1[_0x106b2d][_0x48aa87(0x1e1)]=_0x515c14;}),_0x475ffa[_0x26ead3(0x2d8)]((_0x44521b,_0x202b48)=>{var _0x560596=_0x26ead3;_0x2384f1[_0x202b48][_0x560596(0x2d4)]=_0x44521b;}),_0x49cc78[_0x26ead3(0x2d8)]((_0x20d8c4,_0x32436f)=>{_0x2384f1[_0x32436f]['secondary_code']=_0x20d8c4;}),_0x266360[_0x26ead3(0x2d8)]((_0x2c0f13,_0x23f3cc)=>{var _0x317f3b=_0x26ead3;_0x2384f1[_0x23f3cc][_0x317f3b(0x1fb)]=_0x2c0f13;}),_0x5b7c57['forEach']((_0x50f94e,_0x5bf2fa)=>{var _0x33e37a=_0x26ead3;_0x2384f1[_0x5bf2fa][_0x33e37a(0x1d5)]=_0x50f94e;}),_0xd621d['forEach']((_0x241249,_0x10cd0e)=>{var _0x4463d9=_0x26ead3;_0x2384f1[_0x10cd0e][_0x4463d9(0x2cb)]=_0x241249;}),_0x473099[_0x26ead3(0x2d8)]((_0x549f2a,_0x42c3dd)=>{_0x2384f1[_0x42c3dd]['type']=_0x549f2a;}),_0x36b52a['forEach']((_0x4cb772,_0x2d6b63)=>{var _0x3d6c54=_0x26ead3;_0x2384f1[_0x2d6b63][_0x3d6c54(0x265)]=_0x4cb772;}),_0x49ecc7[_0x26ead3(0x2d8)]((_0x15417f,_0x13b206)=>{var _0x2e34d5=_0x26ead3;_0x2384f1[_0x13b206][_0x2e34d5(0x283)]=_0x15417f;});const _0x301900=_0x2384f1[_0x26ead3(0x2d9)](_0x168194=>_0x168194['quantity']!=='0'&&_0x168194[_0x26ead3(0x1d3)]!=='');_0x2bf963[_0x26ead3(0x29e)]=_0x1caa89,_0x2bf963['suppliers']=_0x16cd79,_0x2bf963['date']=_0x5e0d1a,_0x2bf963[_0x26ead3(0x2a0)]=_0x9a11f4,_0x2bf963[_0x26ead3(0x243)]=_0x301900,_0x2bf963[_0x26ead3(0x237)]=_0x2b20e5,_0x2bf963['paid_amount']=_0x1c877a,_0x2bf963[_0x26ead3(0x2c2)]=_0x291f3f,_0x2bf963[_0x26ead3(0x261)]=_0x51e2d9,_0x2bf963['POnumber']=_0x1aa52c,_0x2bf963[_0x26ead3(0x20e)]=_0x165cd4;const _0x4be1b8=await _0x2bf963[_0x26ead3(0x1db)](),_0x4f407a=await warehouse['findOne']({'name':_0x2431be['body'][_0x26ead3(0x2a0)],'room':_0x2431be[_0x26ead3(0x20f)]['Room_name']});_0x2bf963[_0x26ead3(0x243)][_0x26ead3(0x2d8)](_0xabf17=>{var _0x2a3779=_0x26ead3,_0xe8c2e5=0x0;const _0x34f52d=_0x4f407a['product_details'][_0x2a3779(0x256)](_0x4b410f=>{var _0x1ca53c=_0x2a3779;_0x4b410f['product_name']==_0xabf17[_0x1ca53c(0x1c8)]&&_0x4b410f['floorlevel']==_0xabf17[_0x1ca53c(0x1e1)]&&_0x4b410f[_0x1ca53c(0x26b)]==_0xabf17[_0x1ca53c(0x26b)]&&_0x4b410f[_0x1ca53c(0x1ce)]==_0xabf17[_0x1ca53c(0x1ce)]&&_0x4b410f[_0x1ca53c(0x1e9)]==_0xabf17['bay']&&_0x4b410f[_0x1ca53c(0x283)]==_0xabf17[_0x1ca53c(0x283)]&&_0x4b410f[_0x1ca53c(0x265)]==_0xabf17['storage']&&(_0x4b410f[_0x1ca53c(0x2b8)]=parseInt(_0x4b410f['product_stock'])+parseInt(_0xabf17[_0x1ca53c(0x1d3)]),_0xe8c2e5++);});_0xe8c2e5=='0'&&(_0x4f407a[_0x2a3779(0x2b7)]=_0x4f407a[_0x2a3779(0x2b7)]['concat']({'product_name':_0xabf17[_0x2a3779(0x1c8)],'product_stock':_0xabf17[_0x2a3779(0x1d3)],'primary_code':_0xabf17['primary_code'],'secondary_code':_0xabf17[_0x2a3779(0x1dc)],'product_code':_0xabf17['product_code'],'storage':_0xabf17[_0x2a3779(0x265)],'rack':_0xabf17[_0x2a3779(0x283)],'bay':_0xabf17[_0x2a3779(0x1e9)],'bin':_0xabf17[_0x2a3779(0x1ce)],'type':_0xabf17[_0x2a3779(0x26b)],'floorlevel':_0xabf17[_0x2a3779(0x1e1)],'maxProducts':_0xabf17[_0x2a3779(0x1fb)],'unit':_0xabf17['standard_unit'],'secondary_unit':_0xabf17[_0x2a3779(0x28f)],'expiry_date':_0xabf17[_0x2a3779(0x2cb)]}));}),await _0x4f407a['save']();const _0x425875=await s_payment_data[_0x26ead3(0x2a6)]({'invoice':_0x2431be['body']['invoice']});if(_0x425875===null){}else console[_0x26ead3(0x1f0)](_0x26ead3(0x2ce),_0x425875,_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x29e)]),_0x425875[_0x26ead3(0x2ce)]=_0x2431be[_0x26ead3(0x20f)][_0x26ead3(0x2ce)],await _0x425875['save']();_0x2431be[_0x26ead3(0x23d)](_0x26ead3(0x252),_0x26ead3(0x250)),_0x24044b[_0x26ead3(0x287)](_0x26ead3(0x214));}catch(_0x304197){console[_0x26ead3(0x1f0)](_0x304197);}}),router[a0_0x10d756(0x23e)](a0_0x10d756(0x259),auth,async(_0x3b1777,_0x4c3c15)=>{var _0x2bb846=a0_0x10d756;try{const _0x309899=_0x3b1777['params']['id'],{invoice:_0x2bd72b,suppliers:_0x4f2b0b,payable:_0x2080b8,due_amount:_0x36c091}=_0x3b1777[_0x2bb846(0x20f)],_0x3f02cb=await purchases[_0x2bb846(0x200)](_0x309899);var _0x598175=_0x2080b8-_0x36c091;_0x3f02cb['paid_amount']=parseFloat(_0x3f02cb['paid_amount'])+parseFloat(_0x36c091),_0x3f02cb['due_amount']=_0x598175;const _0x1aecb7=await _0x3f02cb[_0x2bb846(0x1db)]();console[_0x2bb846(0x1f0)](_0x1aecb7);const _0x5d6783=await s_payment_data['findOne']({'invoice':_0x2bd72b});_0x5d6783[_0x2bb846(0x295)]=_0x598175,await _0x5d6783[_0x2bb846(0x1db)]();let _0x276fd0=new Date(),_0x205a4a=('0'+_0x276fd0[_0x2bb846(0x1f4)]())[_0x2bb846(0x29c)](-0x2),_0x27fc8b=('0'+(_0x276fd0['getMonth']()+0x1))[_0x2bb846(0x29c)](-0x2),_0x3f35f2=_0x276fd0[_0x2bb846(0x1c9)](),_0x21b10e=_0x3f35f2+'-'+_0x27fc8b+'-'+_0x205a4a;const _0x3b061b=new suppliers_payment({'invoice':_0x2bd72b,'date':_0x3f35f2+'-'+_0x27fc8b+'-'+_0x205a4a,'suppliers':_0x4f2b0b,'reason':_0x2bb846(0x208),'amount':_0x36c091}),_0x2301c5=await _0x3b061b[_0x2bb846(0x1db)]();_0x3b1777[_0x2bb846(0x23d)](_0x2bb846(0x252),'payment\x20successfull'),_0x4c3c15['redirect'](_0x2bb846(0x214));}catch(_0x126435){console[_0x2bb846(0x1f0)](_0x126435);}}),router[a0_0x10d756(0x1f1)](a0_0x10d756(0x2cf),auth,async(_0x3e269e,_0x4b6d6e)=>{var _0x5a20f4=a0_0x10d756;try{const {username:_0x598fe9,email:_0x44e10f,role:_0x4254ba}=_0x3e269e['user'],_0x524754=_0x3e269e[_0x5a20f4(0x22f)],_0x1a4582=await profile[_0x5a20f4(0x2a6)]({'email':_0x524754[_0x5a20f4(0x2a7)]}),_0x29a67d=await master_shop[_0x5a20f4(0x2e1)]();console[_0x5a20f4(0x1f0)](_0x5a20f4(0x25d),_0x29a67d);const _0x41b7c5=_0x3e269e[_0x5a20f4(0x20b)]['id'],_0x1d9f86=await purchases[_0x5a20f4(0x200)](_0x41b7c5);console['log'](_0x1d9f86);const _0x2bbf24=await suppliers[_0x5a20f4(0x2a6)]({'name':_0x1d9f86['suppliers']});console[_0x5a20f4(0x1f0)](_0x2bbf24);if(_0x29a67d[0x0]['language']=='English\x20(US)'){var _0x34e195=users[_0x5a20f4(0x22b)];console[_0x5a20f4(0x1f0)](_0x34e195);}else{if(_0x29a67d[0x0]['language']==_0x5a20f4(0x2a3))var _0x34e195=users[_0x5a20f4(0x2a3)];else{if(_0x29a67d[0x0][_0x5a20f4(0x22d)]==_0x5a20f4(0x1cc))var _0x34e195=users[_0x5a20f4(0x1cc)];else{if(_0x29a67d[0x0][_0x5a20f4(0x22d)]==_0x5a20f4(0x1d4))var _0x34e195=users[_0x5a20f4(0x1d4)];else{if(_0x29a67d[0x0][_0x5a20f4(0x22d)]==_0x5a20f4(0x23a))var _0x34e195=users[_0x5a20f4(0x23a)];else{if(_0x29a67d[0x0][_0x5a20f4(0x22d)]==_0x5a20f4(0x1cd))var _0x34e195=users[_0x5a20f4(0x26e)];else{if(_0x29a67d[0x0][_0x5a20f4(0x22d)]==_0x5a20f4(0x2bb))var _0x34e195=users[_0x5a20f4(0x2bb)];else{if(_0x29a67d[0x0]['language']==_0x5a20f4(0x1f2))var _0x34e195=users[_0x5a20f4(0x219)];}}}}}}}_0x4b6d6e['render'](_0x5a20f4(0x29b),{'success':_0x3e269e[_0x5a20f4(0x23d)]('success'),'errors':_0x3e269e[_0x5a20f4(0x23d)](_0x5a20f4(0x2be)),'role':_0x524754,'profile':_0x1a4582,'master_shop':_0x29a67d,'supplier':_0x2bbf24,'purchase':_0x1d9f86,'language':_0x34e195});}catch(_0x219cdf){console[_0x5a20f4(0x1f0)](_0x219cdf);}}),router[a0_0x10d756(0x1f1)](a0_0x10d756(0x1df),auth,async(_0x25bacc,_0x294252)=>{var _0x1eb410=a0_0x10d756;try{const {username:_0x2c72c0,email:_0x46b0d4,role:_0x482c5c}=_0x25bacc[_0x1eb410(0x22f)],_0x24e74c=_0x25bacc[_0x1eb410(0x22f)],_0x4d215a=await profile['findOne']({'email':_0x24e74c['email']}),_0x1d1336=await master_shop[_0x1eb410(0x2e1)]();console[_0x1eb410(0x1f0)](_0x1eb410(0x25d),_0x1d1336);const _0x4c7b6b=_0x25bacc[_0x1eb410(0x20b)]['id'];console['log'](_0x4c7b6b);const _0x34202a=await purchases['findById'](_0x4c7b6b);console['log'](_0x1eb410(0x276),_0x34202a);const _0x44fabe=await product[_0x1eb410(0x2e1)]({}),_0x3debce=await warehouse[_0x1eb410(0x24c)]([{'$match':{'name':_0x34202a[_0x1eb410(0x2a0)],'room':_0x34202a['room'],'warehouse_category':_0x1eb410(0x275)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1eb410(0x20d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1eb410(0x2c0)},'bay':{'$first':_0x1eb410(0x1f5)},'bin':{'$first':_0x1eb410(0x1d9)},'type':{'$first':_0x1eb410(0x1f8)},'floorlevel':{'$first':_0x1eb410(0x2d2)},'primary_code':{'$first':_0x1eb410(0x234)},'secondary_code':{'$first':_0x1eb410(0x238)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1eb410(0x289)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x1eb410(0x24c)]([{'$match':{'status':_0x1eb410(0x2de),'name':_0x1eb410(0x28e),'warehouse_category':_0x1eb410(0x275)}},{'$group':{'_id':'$name','name':{'$first':_0x1eb410(0x270)}}},{'$sort':{'name':0x1}}]),console[_0x1eb410(0x1f0)](_0x1eb410(0x2df),_0x3debce);if(_0x1d1336[0x0][_0x1eb410(0x22d)]==_0x1eb410(0x258)){var _0x3bfc0c=users[_0x1eb410(0x22b)];console[_0x1eb410(0x1f0)](_0x3bfc0c);}else{if(_0x1d1336[0x0][_0x1eb410(0x22d)]==_0x1eb410(0x2a3))var _0x3bfc0c=users[_0x1eb410(0x2a3)];else{if(_0x1d1336[0x0]['language']=='German')var _0x3bfc0c=users[_0x1eb410(0x1cc)];else{if(_0x1d1336[0x0][_0x1eb410(0x22d)]==_0x1eb410(0x1d4))var _0x3bfc0c=users[_0x1eb410(0x1d4)];else{if(_0x1d1336[0x0][_0x1eb410(0x22d)]=='French')var _0x3bfc0c=users[_0x1eb410(0x23a)];else{if(_0x1d1336[0x0]['language']==_0x1eb410(0x1cd))var _0x3bfc0c=users[_0x1eb410(0x26e)];else{if(_0x1d1336[0x0][_0x1eb410(0x22d)]==_0x1eb410(0x2bb))var _0x3bfc0c=users[_0x1eb410(0x2bb)];else{if(_0x1d1336[0x0][_0x1eb410(0x22d)]==_0x1eb410(0x1f2))var _0x3bfc0c=users[_0x1eb410(0x219)];}}}}}}}_0x294252[_0x1eb410(0x2dd)](_0x1eb410(0x2aa),{'success':_0x25bacc[_0x1eb410(0x23d)](_0x1eb410(0x252)),'errors':_0x25bacc[_0x1eb410(0x23d)](_0x1eb410(0x2be)),'role':_0x24e74c,'profile':_0x4d215a,'user':_0x34202a,'stock':_0x3debce,'master_shop':_0x1d1336,'product':_0x44fabe,'language':_0x3bfc0c,'warehouse':warehouse_data});}catch(_0x4b8b6b){console['log'](_0x4b8b6b);}}),router[a0_0x10d756(0x23e)](a0_0x10d756(0x1df),auth,async(_0x567d1a,_0x2ecf91)=>{var _0xff95c=a0_0x10d756;try{const {invoice:_0x362f5c,date:_0x251a33,warehouse_name:_0x8141c7,Room_name:_0x5c877e,product_name:_0x155e8f,purchase_quantity:_0x12b862,stocks:_0xa2ac40,return_qty:_0x1e9076,note:_0x4e1c1d,level:_0xd1ea1d,isle:_0x46e93b,pallet:_0x1500a6,to_warehouse_name:_0x3e346c,to_Room_name:_0x1bafc3}=_0x567d1a[_0xff95c(0x20f)],_0x2d0141=await purchases[_0xff95c(0x2a6)]({'_id':_0x567d1a[_0xff95c(0x20b)]['id']}),_0x45b108=await warehouse[_0xff95c(0x2a6)]({'name':_0x8141c7,'room':_0x5c877e});if(typeof _0x155e8f==_0xff95c(0x27a))var _0x442c10=[_0x567d1a[_0xff95c(0x20f)][_0xff95c(0x1c8)]],_0x3d0b52=[_0x567d1a['body'][_0xff95c(0x2ae)]],_0x13e637=[_0x567d1a[_0xff95c(0x20f)][_0xff95c(0x27d)]],_0x53202e=[_0x567d1a[_0xff95c(0x20f)]['return_qty']],_0x38cbb7=[_0x567d1a[_0xff95c(0x20f)][_0xff95c(0x278)]],_0x124bda=[_0x567d1a[_0xff95c(0x20f)][_0xff95c(0x286)]],_0x5cb577=[_0x567d1a[_0xff95c(0x20f)]['pallet']],_0x584d98=[_0x567d1a[_0xff95c(0x20f)][_0xff95c(0x21c)]],_0x27c426=[_0x567d1a[_0xff95c(0x20f)][_0xff95c(0x2d5)]],_0x223455=[_0x567d1a[_0xff95c(0x20f)]['primary_code_hide']],_0x199038=[_0x567d1a['body'][_0xff95c(0x218)]];else var _0x442c10=[..._0x567d1a[_0xff95c(0x20f)]['product_name']],_0x3d0b52=[..._0x567d1a['body'][_0xff95c(0x2ae)]],_0x13e637=[..._0x567d1a[_0xff95c(0x20f)][_0xff95c(0x27d)]],_0x53202e=[..._0x567d1a['body'][_0xff95c(0x1eb)]],_0x38cbb7=[..._0x567d1a[_0xff95c(0x20f)][_0xff95c(0x278)]],_0x124bda=[..._0x567d1a[_0xff95c(0x20f)]['isle']],_0x5cb577=[..._0x567d1a['body'][_0xff95c(0x1cf)]],_0x584d98=[..._0x567d1a[_0xff95c(0x20f)]['types']],_0x27c426=[..._0x567d1a[_0xff95c(0x20f)][_0xff95c(0x2d5)]],_0x223455=[..._0x567d1a[_0xff95c(0x20f)][_0xff95c(0x25f)]],_0x199038=[..._0x567d1a[_0xff95c(0x20f)][_0xff95c(0x218)]];const _0x1b3f35=_0x442c10[_0xff95c(0x256)](_0x571284=>{return _0x571284={'product_name':_0x571284};});_0x3d0b52[_0xff95c(0x2d8)]((_0x4c49f6,_0xc0a2e8)=>{var _0x29abb8=_0xff95c;_0x1b3f35[_0xc0a2e8][_0x29abb8(0x2ae)]=_0x4c49f6;}),_0x13e637['forEach']((_0x22aaae,_0x107c45)=>{var _0x4f5807=_0xff95c;_0x1b3f35[_0x107c45][_0x4f5807(0x2a4)]=_0x22aaae;}),_0x53202e[_0xff95c(0x2d8)]((_0x56fa36,_0x19d15d)=>{var _0x47b558=_0xff95c;_0x1b3f35[_0x19d15d][_0x47b558(0x1eb)]=_0x56fa36;}),_0x38cbb7['forEach']((_0x1bd19b,_0x5d8e32)=>{var _0x3ed3af=_0xff95c;_0x1b3f35[_0x5d8e32][_0x3ed3af(0x1e9)]=_0x1bd19b;}),_0x124bda['forEach']((_0x33d1c6,_0x2d5ef0)=>{var _0x127b32=_0xff95c;_0x1b3f35[_0x2d5ef0][_0x127b32(0x1ce)]=_0x33d1c6;}),_0x5cb577[_0xff95c(0x2d8)]((_0x1720ee,_0x3d99fc)=>{var _0x57b305=_0xff95c;_0x1b3f35[_0x3d99fc][_0x57b305(0x1e1)]=_0x1720ee;}),_0x584d98[_0xff95c(0x2d8)]((_0x4dc224,_0x40d799)=>{var _0x192617=_0xff95c;_0x1b3f35[_0x40d799][_0x192617(0x26b)]=_0x4dc224;}),_0x27c426['forEach']((_0x49dba9,_0x51d6d2)=>{var _0x2bfd18=_0xff95c;_0x1b3f35[_0x51d6d2][_0x2bfd18(0x21e)]=_0x49dba9;}),_0x223455[_0xff95c(0x2d8)]((_0x4a56b1,_0x5a1f2b)=>{_0x1b3f35[_0x5a1f2b]['primary_code']=_0x4a56b1;}),_0x199038[_0xff95c(0x2d8)]((_0x3dae25,_0x1845e2)=>{_0x1b3f35[_0x1845e2]['secondary_code']=_0x3dae25;}),_0x2d0141[_0xff95c(0x243)]['forEach'](_0x19ed74=>{var _0x4ebae8=_0xff95c;const _0x444563=_0x45b108[_0x4ebae8(0x2b7)]['map'](_0x2edd55=>{var _0x45702c=_0x4ebae8;_0x2edd55[_0x45702c(0x1c8)]==_0x19ed74[_0x45702c(0x1c8)]&&_0x2edd55[_0x45702c(0x1e1)]==_0x19ed74[_0x45702c(0x1e1)]&&_0x2edd55[_0x45702c(0x26b)]==_0x19ed74[_0x45702c(0x26b)]&&_0x2edd55[_0x45702c(0x1ce)]==_0x19ed74[_0x45702c(0x1ce)]&&_0x2edd55[_0x45702c(0x1e9)]==_0x19ed74[_0x45702c(0x1e9)]&&_0x2edd55['rack']==_0x19ed74[_0x45702c(0x283)]&&_0x2edd55[_0x45702c(0x265)]==_0x19ed74[_0x45702c(0x265)]&&(console[_0x45702c(0x1f0)](parseInt(_0x2edd55[_0x45702c(0x2b8)])+'\x20<>\x20'+parseInt(_0x19ed74[_0x45702c(0x1d3)])),_0x2edd55[_0x45702c(0x2b8)]=parseInt(_0x2edd55[_0x45702c(0x2b8)])+parseInt(_0x19ed74[_0x45702c(0x1d3)]));});}),await _0x45b108[_0xff95c(0x1db)]();const _0x5bb1c9=_0x1b3f35[_0xff95c(0x2d9)](_0x3a8602=>_0x3a8602[_0xff95c(0x1eb)]!=='0'&&_0x3a8602['return_qty']!=='');var _0x377d90=0x0;_0x5bb1c9[_0xff95c(0x2d8)](_0x407df0=>{var _0x558bd5=_0xff95c;console['log']('foreach\x20newproduct',_0x407df0),(parseInt(_0x407df0[_0x558bd5(0x2ae)])<parseInt(_0x407df0[_0x558bd5(0x1eb)])||parseInt(_0x407df0[_0x558bd5(0x2a4)])<parseInt(_0x407df0[_0x558bd5(0x1eb)]))&&_0x377d90++;});if(_0x377d90!=0x0)return _0x567d1a[_0xff95c(0x23d)](_0xff95c(0x2be),_0xff95c(0x204)),_0x2ecf91[_0xff95c(0x287)](_0xff95c(0x229));const _0x478645=new purchases_return({'invoice':_0x362f5c,'suppliers':_0x567d1a[_0xff95c(0x20f)]['suppliers'],'date':_0x251a33,'warehouse_name':_0x8141c7,'return_product':_0x5bb1c9,'note':_0x4e1c1d,'room':_0x5c877e,'to_warehouse_name':_0x3e346c,'to_room':_0x1bafc3}),_0x4697bb=await _0x478645[_0xff95c(0x1db)]();console[_0xff95c(0x1f0)](_0x478645);const _0x9a5006=await purchases_return[_0xff95c(0x2a6)]({'invoice':_0x362f5c}),_0x3612b4=await warehouse[_0xff95c(0x2a6)]({'name':_0x3e346c,'room':_0x1bafc3});_0x9a5006[_0xff95c(0x21f)][_0xff95c(0x2d8)](_0x4f6aa8=>{var _0x35edce=_0xff95c,_0x2bc000=0x0;const _0x4043ce=_0x3612b4[_0x35edce(0x2b7)][_0x35edce(0x256)](_0x29a09d=>{var _0x4973a1=_0x35edce;_0x29a09d[_0x4973a1(0x1c8)]==_0x4f6aa8['product_name']&&_0x29a09d['floorlevel']==_0x4f6aa8[_0x4973a1(0x1e1)]&&_0x29a09d[_0x4973a1(0x26b)]==_0x4f6aa8[_0x4973a1(0x26b)]&&_0x29a09d[_0x4973a1(0x1ce)]==_0x4f6aa8[_0x4973a1(0x1ce)]&&_0x29a09d[_0x4973a1(0x1e9)]==_0x4f6aa8[_0x4973a1(0x1e9)]&&(_0x29a09d[_0x4973a1(0x2b8)]=parseInt(_0x29a09d[_0x4973a1(0x2b8)])-parseInt(_0x4f6aa8[_0x4973a1(0x1eb)]),_0x2bc000++);});_0x2bc000=='0'&&(_0x3612b4[_0x35edce(0x2b7)]=_0x3612b4['product_details'][_0x35edce(0x24e)]({'product_name':_0x4f6aa8[_0x35edce(0x1c8)],'product_stock':_0x4f6aa8[_0x35edce(0x1eb)],'primary_code':_0x4f6aa8['primary_code'],'secondary_code':_0x4f6aa8[_0x35edce(0x1dc)],'product_code':_0x4f6aa8[_0x35edce(0x21e)],'storage':_0x4f6aa8[_0x35edce(0x265)],'rack':_0x4f6aa8['rack'],'bay':_0x4f6aa8[_0x35edce(0x1e9)],'bin':_0x4f6aa8[_0x35edce(0x1ce)],'type':_0x4f6aa8[_0x35edce(0x26b)],'floorlevel':_0x4f6aa8[_0x35edce(0x1e1)],'maxProducts':_0x4f6aa8[_0x35edce(0x1fb)],'unit':_0x4f6aa8[_0x35edce(0x299)],'secondary_unit':_0x4f6aa8['secondary_unit'],'expiry_date':_0x4f6aa8[_0x35edce(0x2cb)]}));}),await _0x3612b4[_0xff95c(0x1db)]();const _0x2ba948=await purchases[_0xff95c(0x2a6)]({'invoice':_0x362f5c});_0x2ba948[_0xff95c(0x2a5)]=_0xff95c(0x1ea);const _0xda21db=await _0x2ba948[_0xff95c(0x1db)](),_0x4e6d04=new s_payment_data({'invoice':_0x362f5c,'suppliers':_0x567d1a[_0xff95c(0x20f)]['suppliers'],'reason':'Purchase\x20Return'});await _0x4e6d04[_0xff95c(0x1db)]();const _0x160ccf=await master_shop[_0xff95c(0x2e1)]();console['log']('add\x20post',_0x160ccf[0x0][_0xff95c(0x1e6)]);const _0x5bbfe9=await email_settings[_0xff95c(0x2a6)](),_0x3def17=await suppliers[_0xff95c(0x2a6)]({'name':_0x567d1a[_0xff95c(0x20f)]['suppliers']});console[_0xff95c(0x1f0)]('suppliers_data',_0x3def17);_0x160ccf[0x0][_0xff95c(0x25e)]==0x1?(right_currency=_0x160ccf[0x0][_0xff95c(0x2a8)],left_currency=''):(right_currency='',left_currency=_0x160ccf[0x0][_0xff95c(0x2a8)]);var _0x43faf2=_0x442c10,_0x577da3=_0x53202e,_0x11c009='',_0x119d76;for(_0x119d76 in _0x43faf2){_0x11c009+=_0xff95c(0x2c1)+_0xff95c(0x211)+_0x43faf2[_0x119d76]+_0xff95c(0x297)+_0xff95c(0x211)+_0x577da3[_0x119d76]+_0xff95c(0x297)+_0xff95c(0x245);}console[_0xff95c(0x1f0)](_0xff95c(0x1fd),_0x11c009);let _0x1742d8=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x5bbfe9[_0xff95c(0x2a7)],'pass':_0x5bbfe9[_0xff95c(0x1f3)]}}),_0x32d36c={'from':_0x5bbfe9[_0xff95c(0x2a7)],'to':_0x3def17[_0xff95c(0x2a7)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0xff95c(0x1e8),'path':__dirname+_0xff95c(0x1e4)+_0xff95c(0x2c8)+_0x160ccf[0x0][_0xff95c(0x1e6)],'cid':'logo'}],'html':_0xff95c(0x201)+_0xff95c(0x2c3)+_0xff95c(0x1ed)+'<div>'+_0xff95c(0x288)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xff95c(0x281)+_0xff95c(0x2e0)+_0xff95c(0x1f9)+_0x160ccf[0x0][_0xff95c(0x262)]+_0xff95c(0x298)+_0xff95c(0x281)+_0xff95c(0x281)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0xff95c(0x2d1)+_0xff95c(0x20c)+_0x362f5c+'\x20'+_0xff95c(0x29f)+'\x20Order\x20Date\x20:\x20'+_0x251a33+'\x20'+'</span>'+'</h5>'+_0xff95c(0x281)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xff95c(0x235)+_0xff95c(0x2c1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0xff95c(0x245)+_0xff95c(0x230)+_0xff95c(0x1ca)+'\x20'+_0x11c009+'\x20'+_0xff95c(0x2a1)+_0xff95c(0x2b4)+'<div>'+_0xff95c(0x202)+_0xff95c(0x269)+_0x160ccf[0x0]['site_title']+_0xff95c(0x28a)+'</div>'+_0xff95c(0x281)+_0xff95c(0x1dd)};_0x1742d8['sendMail'](_0x32d36c,function(_0x6cf900,_0x3160f4){var _0x2ca691=_0xff95c;_0x6cf900?(console['log'](_0x6cf900),console[_0x2ca691(0x1f0)](_0x2ca691(0x232))):console['log'](_0x2ca691(0x28d));}),_0x567d1a['flash'](_0xff95c(0x252),_0xff95c(0x1e7)),_0x2ecf91[_0xff95c(0x287)]('/all_purchases/view');}catch(_0x5682f7){console[_0xff95c(0x1f0)](_0x5682f7),_0x2ecf91['status'](0xc8)[_0xff95c(0x2e2)]({'message':_0x5682f7[_0xff95c(0x1d1)]});}}),router['get'](a0_0x10d756(0x25b),auth,async(_0x53b961,_0x42d1e0)=>{var _0x4bebfe=a0_0x10d756;try{const {username:_0xcb70c1,email:_0x48e440,role:_0x525621}=_0x53b961[_0x4bebfe(0x22f)],_0x237888=_0x53b961[_0x4bebfe(0x22f)],_0x330938=await profile[_0x4bebfe(0x2a6)]({'email':_0x237888[_0x4bebfe(0x2a7)]}),_0x4c1909=await master_shop[_0x4bebfe(0x2e1)](),_0x2888c3=_0x53b961[_0x4bebfe(0x20b)]['id'],_0x5ee8fe=await purchases[_0x4bebfe(0x200)](_0x2888c3);if(_0x4c1909[0x0][_0x4bebfe(0x22d)]==_0x4bebfe(0x258))var _0x161570=users['English'];else{if(_0x4c1909[0x0]['language']==_0x4bebfe(0x2a3))var _0x161570=users[_0x4bebfe(0x2a3)];else{if(_0x4c1909[0x0][_0x4bebfe(0x22d)]==_0x4bebfe(0x1cc))var _0x161570=users[_0x4bebfe(0x1cc)];else{if(_0x4c1909[0x0][_0x4bebfe(0x22d)]==_0x4bebfe(0x1d4))var _0x161570=users[_0x4bebfe(0x1d4)];else{if(_0x4c1909[0x0][_0x4bebfe(0x22d)]==_0x4bebfe(0x23a))var _0x161570=users[_0x4bebfe(0x23a)];else{if(_0x4c1909[0x0][_0x4bebfe(0x22d)]=='Portuguese\x20(BR)')var _0x161570=users[_0x4bebfe(0x26e)];else{if(_0x4c1909[0x0][_0x4bebfe(0x22d)]==_0x4bebfe(0x2bb))var _0x161570=users[_0x4bebfe(0x2bb)];else{if(_0x4c1909[0x0][_0x4bebfe(0x22d)]==_0x4bebfe(0x1f2))var _0x161570=users['Arabic'];}}}}}}}_0x42d1e0[_0x4bebfe(0x2dd)](_0x4bebfe(0x247),{'success':_0x53b961[_0x4bebfe(0x23d)](_0x4bebfe(0x252)),'errors':_0x53b961[_0x4bebfe(0x23d)](_0x4bebfe(0x2be)),'role':_0x237888,'profile':_0x330938,'alldata':_0x5ee8fe,'master_shop':_0x4c1909,'language':_0x161570}),console[_0x4bebfe(0x1f0)](alldata);}catch(_0x1b31b1){console['log'](_0x1b31b1);}}),router[a0_0x10d756(0x23e)]('/barcode_scanner',async(_0x1b4e39,_0x564e9b)=>{var _0xc210e7=a0_0x10d756;const {product_code:_0x4d5f71}=_0x1b4e39[_0xc210e7(0x20f)];var _0x3d4f9e;const _0x47e7e6=await product['aggregate']([{'$match':{'primary_code':_0x4d5f71,'product_category':_0xc210e7(0x275)}},{'$group':{'_id':'$_id','name':{'$first':_0xc210e7(0x270)},'category':{'$first':_0xc210e7(0x226)},'brand':{'$first':_0xc210e7(0x206)},'unit':{'$first':_0xc210e7(0x1d8)},'alertquantity':{'$first':_0xc210e7(0x1c6)},'product_code':{'$first':_0xc210e7(0x24b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0xc210e7(0x22e)},'maxStocks':{'$first':_0xc210e7(0x216)},'maxProdPerUnit':{'$first':_0xc210e7(0x264)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xc210e7(0x1e5)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xd4d94e=await product['aggregate']([{'$match':{'secondary_code':_0x4d5f71,'product_category':_0xc210e7(0x275)}},{'$group':{'_id':_0xc210e7(0x24a),'name':{'$first':_0xc210e7(0x270)},'category':{'$first':_0xc210e7(0x226)},'brand':{'$first':_0xc210e7(0x206)},'unit':{'$first':_0xc210e7(0x1d8)},'alertquantity':{'$first':_0xc210e7(0x1c6)},'product_code':{'$first':_0xc210e7(0x24b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0xc210e7(0x22e)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0xc210e7(0x264)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x47e7e6[_0xc210e7(0x1ee)]>0x0)_0x3d4f9e=_0x47e7e6;else _0xd4d94e[_0xc210e7(0x1ee)]>0x0&&(_0x3d4f9e=_0xd4d94e);_0x564e9b['json'](_0x3d4f9e);}),router[a0_0x10d756(0x23e)]('/CheckingWarehouse',async(_0x530e52,_0x3a40e3)=>{var _0x5588a5=a0_0x10d756;const {primaryCode:_0x57dc35,secondaryCode:_0x3bb8fb,productCode:_0x1f46be,bay:_0x3e1088,bin:_0x45e8e1,types:_0x16cbcd,pallet:_0x96e800,warehouses:_0x2d421b,room:_0x223ae6}=_0x530e52[_0x5588a5(0x20f)];console[_0x5588a5(0x1f0)](_0x530e52[_0x5588a5(0x20f)]);try{const _0x4a2e9e=await warehouse['aggregate']([{'$match':{'name':_0x2d421b,'room':_0x223ae6}},{'$unwind':_0x5588a5(0x1ef)},{'$match':{'product_details.bay':_0x3e1088,'product_details.bin':_0x45e8e1,'product_details.type':_0x16cbcd}},{'$group':{'_id':_0x5588a5(0x20d),'name':{'$first':_0x5588a5(0x2b6)},'product_stock':{'$first':_0x5588a5(0x2c0)},'level':{'$first':_0x5588a5(0x1e3)},'isle':{'$first':_0x5588a5(0x24d)},'pallet':{'$first':_0x5588a5(0x2c6)},'maxProducts':{'$first':_0x5588a5(0x284)}}}]);_0x3a40e3[_0x5588a5(0x2cd)](0xc8)[_0x5588a5(0x2e2)](_0x4a2e9e);}catch(_0xd581d5){_0x3a40e3['status'](0x194)[_0x5588a5(0x2e2)]({'message':_0xd581d5['message']});}}),module[a0_0x10d756(0x255)]=router;