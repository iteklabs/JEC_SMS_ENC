var a0_0x223d5f=a0_0xf1fc;(function(_0x3ea557,_0x1b7b7f){var _0xdf6a9=a0_0xf1fc,_0x4f2553=_0x3ea557();while(!![]){try{var _0x67281e=-parseInt(_0xdf6a9(0x18e))/0x1*(parseInt(_0xdf6a9(0x241))/0x2)+parseInt(_0xdf6a9(0x225))/0x3+-parseInt(_0xdf6a9(0x219))/0x4*(parseInt(_0xdf6a9(0x1ae))/0x5)+-parseInt(_0xdf6a9(0x25a))/0x6+-parseInt(_0xdf6a9(0x271))/0x7+-parseInt(_0xdf6a9(0x1d2))/0x8*(-parseInt(_0xdf6a9(0x1ed))/0x9)+-parseInt(_0xdf6a9(0x26e))/0xa*(-parseInt(_0xdf6a9(0x1ea))/0xb);if(_0x67281e===_0x1b7b7f)break;else _0x4f2553['push'](_0x4f2553['shift']());}catch(_0x5829ca){_0x4f2553['push'](_0x4f2553['shift']());}}}(a0_0x3ec2,0x8bfe3));function a0_0xf1fc(_0x16af9d,_0x3f51fe){var _0x3ec20a=a0_0x3ec2();return a0_0xf1fc=function(_0xf1fcb5,_0x562d1f){_0xf1fcb5=_0xf1fcb5-0x17b;var _0xc7599=_0x3ec20a[_0xf1fcb5];return _0xc7599;},a0_0xf1fc(_0x16af9d,_0x3f51fe);}const express=require(a0_0x223d5f(0x282)),app=express(),router=express[a0_0x223d5f(0x289)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x223d5f(0x258)),auth=require('../middleware/auth'),nodemailer=require(a0_0x223d5f(0x23c));var ejs=require(a0_0x223d5f(0x1be));const path=require(a0_0x223d5f(0x1cc)),users=require(a0_0x223d5f(0x1a9));router[a0_0x223d5f(0x277)](a0_0x223d5f(0x248),auth,async(_0x53741e,_0x4552eb)=>{var _0x2ab42c=a0_0x223d5f;try{const {username:_0x2d06e2,email:_0x26cc76,role:_0x26d50b}=_0x53741e[_0x2ab42c(0x1d0)],_0x490207=_0x53741e[_0x2ab42c(0x1d0)],_0xfbc126=await profile['findOne']({'email':_0x490207[_0x2ab42c(0x202)]}),_0x58a171=await staff[_0x2ab42c(0x28c)]({'email':_0x490207[_0x2ab42c(0x202)]});if(_0x490207['role']=='staff'){const _0x402866=await staff[_0x2ab42c(0x28c)]({'email':_0x490207[_0x2ab42c(0x202)]});}const _0xacf9f5=await master_shop['find']();let _0x376dfd;if(_0x490207[_0x2ab42c(0x285)]==_0x2ab42c(0x18d)){const _0x431b71=await staff[_0x2ab42c(0x28c)]({'email':_0x490207[_0x2ab42c(0x202)]});_0x376dfd=await purchases[_0x2ab42c(0x27c)]([{'$match':{'warehouse_name':_0x431b71[_0x2ab42c(0x246)]}},{'$lookup':{'from':'suppliers','localField':_0x2ab42c(0x251),'foreignField':'name','as':_0x2ab42c(0x198)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x2ab42c(0x1cb)},{'$group':{'_id':_0x2ab42c(0x287),'invoice':{'$first':_0x2ab42c(0x1d8)},'suppliers':{'$first':_0x2ab42c(0x27d)},'date':{'$first':_0x2ab42c(0x1ca)},'warehouse_name':{'$first':_0x2ab42c(0x261)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2ab42c(0x1ef)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2ab42c(0x250)},'batch_code':{'$first':_0x2ab42c(0x1bb)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2ab42c(0x23d)},'total_product_quantity':{'$sum':_0x2ab42c(0x269)},'level':{'$addToSet':_0x2ab42c(0x220)},'isle':{'$addToSet':_0x2ab42c(0x231)},'type':{'$addToSet':_0x2ab42c(0x276)},'floorlevel':{'$addToSet':_0x2ab42c(0x228)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x376dfd=await purchases[_0x2ab42c(0x27c)]([{'$lookup':{'from':_0x2ab42c(0x251),'localField':_0x2ab42c(0x251),'foreignField':_0x2ab42c(0x240),'as':_0x2ab42c(0x198)}},{'$unwind':_0x2ab42c(0x23d)},{'$unwind':'$product'},{'$group':{'_id':_0x2ab42c(0x287),'invoice':{'$first':_0x2ab42c(0x1d8)},'suppliers':{'$first':_0x2ab42c(0x27d)},'date':{'$first':_0x2ab42c(0x1ca)},'warehouse_name':{'$first':_0x2ab42c(0x261)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x2ab42c(0x1cb)},'note':{'$first':_0x2ab42c(0x281)},'paid_amount':{'$first':_0x2ab42c(0x1ef)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2ab42c(0x250)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2ab42c(0x292)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2ab42c(0x220)},'isle':{'$addToSet':_0x2ab42c(0x231)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2ab42c(0x228)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]==_0x2ab42c(0x24a)){var _0x3b227e=users[_0x2ab42c(0x25c)];console[_0x2ab42c(0x265)](_0x3b227e);}else{if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]=='Hindi')var _0x3b227e=users[_0x2ab42c(0x187)];else{if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]==_0x2ab42c(0x1c9))var _0x3b227e=users['German'];else{if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]=='Spanish')var _0x3b227e=users[_0x2ab42c(0x25f)];else{if(_0xacf9f5[0x0]['language']==_0x2ab42c(0x25e))var _0x3b227e=users[_0x2ab42c(0x25e)];else{if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]==_0x2ab42c(0x1c5))var _0x3b227e=users[_0x2ab42c(0x1dc)];else{if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]=='Chinese')var _0x3b227e=users['Chinese'];else{if(_0xacf9f5[0x0][_0x2ab42c(0x23a)]=='Arabic\x20(ae)')var _0x3b227e=users['Arabic'];}}}}}}}_0x4552eb[_0x2ab42c(0x208)](_0x2ab42c(0x1f1),{'success':_0x53741e['flash']('success'),'errors':_0x53741e[_0x2ab42c(0x1e6)](_0x2ab42c(0x1c6)),'purchases':_0x376dfd,'role':_0x490207,'profile':_0xfbc126,'master_shop':_0xacf9f5,'language':_0x3b227e});}catch(_0x386971){console[_0x2ab42c(0x265)]('table\x20page',_0x386971),_0x4552eb[_0x2ab42c(0x295)](0xc8)[_0x2ab42c(0x26a)]({'message':_0x386971[_0x2ab42c(0x1ce)]});}});function a0_0x3ec2(){var _0x4881ba=['product_name','foreach\x20newproduct','product_list','prod_cat','$product_details.product_name','bin','return_purchase','return_data','alertQTY','maxStocks','Return\x20Goods','invoice','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','push','Arabic\x20(ae)','Ambient','Enabled','render','edit_purchases','Level','$brand','paid_amount','/view/add_purchases','<hr\x20class=\x22my-3\x22>','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Rack\x20C','prod_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.expiry_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Floor','Rack\x20B','success','12yKyIid','filter','$product_details.bin','quantity','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Rack\x20F','purchase_invoice','$product.bay','/../public','$product_details','stocks','JO_number','781761KeJNhz','maxperunit','stock_quantity','$product.floorlevel','amount','Purchase\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</tbody>','purchase_quantity','product','batch_code','</head><body>','$product.bin','$product_details.rack','redirect','storage','/upload/','COLD\x20STORAGE','product_code','Error\x20Occurs','add_purchases','language','Raw\x20Materials','nodemailer','$suppliers_docs','max_product_unit','due_amount','name','140720LCdrGA','site_title','<!DOCTYPE\x20html>','prod_code','save','warehouse','Room_name','/view','$product_details.storage','English\x20(US)','room_name','concat','secondary_code_hide','$unit','Email\x20sent\x20successfully','$return_data','suppliers','prod_isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<tr>','warehouse_name','types','post','../models/all_models','</div>','1712778apeOnS','note','English','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','French','Spanish','add_purchases\x20error','$warehouse_name','then','Purchase\x20data\x20added\x20successfully','length','log','params','prod_primunit','toString','$product.quantity','json','Rack\x20A','currency','room','20QazBGF','finalize','all_purchases_barcode','4547711jJgCuy','prod_invoice','</tr>','primary_code','Chinese','$product.type','get','deliverycode','MaxStocks_data','$product_details.product_code','prod_level','aggregate','$suppliers','/preview/:id','/view/:id','$product_details.secondary_code','$note','express','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','role','$product_details.bay','$_id','<h2>\x20','Router','</thead>','product_code_hide','findOne','prod_Qty','$maxStocks','</table>','/all_purchases/view','/view/return_purchase/:id','$expiry_date','findById','secondary_code','status','prod_secondunit','/invoice/:id','actual_qty','</h5>','type','DRY\x20STORAGE','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Rack\x20E','\x20<>\x20','createTransport','Logo.png','Arabic','Hindi','prod_pallet','Purchase\x20Return','padStart','$alertquantity','<tbody\x20style=\x22text-align:\x20center;\x22>','staff','2knoHHL','There\x27s\x20a\x20error\x20in\x20this\x20transaction','pallet','$category','getFullYear','An\x20error\x20occurred.','bay','delivery_code','An\x20error\x20occurred\x20while\x20saving\x20data.','product_cat','suppliers_docs','Sales\x20Update\x20successfully','return_qty','product_details','</span>','expiry_date','product_stock','exports','body','</body></html>','error','True','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<div>','date','isle','$primary_code','../public/language/languages.json','gmail','RoomAssign','\x20Order\x20Number\x20:\x20','INC-','903245UFWlVD','currency_placement','$product_details.pallet','return_product','stock_data','master','prod_unit','getMonth','sendMail','actual_uom','find','/give_payment/:id','<span\x20style=\x22float:\x20right;\x22>','$batch_code','\x20Order\x20Date\x20:\x20','port','ejs','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$name','$product_details.floorlevel','logo','delivery_date','Portuguese\x20(BR)','errors','map','/barcode/:id','German','$date','$product','path','purchase\x20data\x20update\x20successfully','message','level','user','floorlevel','4881144JhrKyE','secondary_unit','password','/barcode_scanner','Enclosed','string','$invoice','$maxProdPerUnit','purchases\x20item\x20return\x20successfull','slice','Portuguese','$product_details.level','$secondary_code','catch','rak','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','suppliers_data','</td>','abs','flash','standard_unit','$product_details.primary_code','production_date','7262662fyXQrJ','payment\x20successfull','forEach','9DcwsZM','Receiving\x20Area','$paid_amount','$product_details.type','all_purchases','RMSEmail','Paid\x20For\x20Purchase','<html><head><title></title>','$product_details.product_stock'];a0_0x3ec2=function(){return _0x4881ba;};return a0_0x3ec2();}function BayBinSelected(_0x549fd5,_0x2eb5a9){var _0x358220=a0_0x223d5f,_0x5db9a1=[],_0x483283=[],_0x31ab99=[],_0x1b5aa8=[],_0x30c2f=[],_0x41e688=[];let _0x2ec739=[];if(_0x549fd5==_0x358220(0x180))switch(_0x2eb5a9){case _0x358220(0x26b):_0x5db9a1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x483283=[0x1,0x2],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=['Level',_0x358220(0x216)],_0x30c2f=['D'],_0x41e688=['A'];break;case _0x358220(0x217):_0x5db9a1=[0x6,0x5,0x4,0x3,0x2,0x1],_0x483283=[0x1,0x2],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x20a),_0x358220(0x216)],_0x30c2f=['D'],_0x41e688=['B'];break;case'Shelves':_0x5db9a1=[0x0],_0x483283=[0x0],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x216)],_0x30c2f=['D'],_0x41e688=['S'];break;case'Receiving\x20Area':_0x5db9a1=[0x0],_0x483283=[0x0],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x31ab99=[_0x358220(0x216)],_0x30c2f=['D'],_0x41e688=['R'];break;}else{if(_0x549fd5==_0x358220(0x236))switch(_0x2eb5a9){case _0x358220(0x26b):_0x5db9a1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x483283=['B','F'],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x20a),_0x358220(0x216)],_0x30c2f=['C'],_0x41e688=['A'];break;case _0x358220(0x217):_0x5db9a1=[0x5,0x4,0x3,0x2,0x1],_0x483283=['F','B','S'],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x20a),_0x358220(0x216)],_0x30c2f=['C'],_0x41e688=['B'];break;case _0x358220(0x211):_0x5db9a1=[0x1,0x2,0x3,0x4,0x5],_0x483283=['B','F','S'],_0x1b5aa8=[0x5,0x4,0x3,0x2,0x1],_0x31ab99=['Level',_0x358220(0x216)],_0x30c2f=['C'],_0x41e688=['C'];break;case'Rack\x20D':_0x5db9a1=[0x5,0x4,0x3,0x2,0x1],_0x483283=['F','B','S'],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x20a),_0x358220(0x216)],_0x30c2f=['C'],_0x41e688=['D'];break;case _0x358220(0x182):_0x5db9a1=[0x4,0x3,0x2,0x1],_0x483283=[0x1,0x2],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x20a),_0x358220(0x216)],_0x30c2f=['C'],_0x41e688=['E'];break;case _0x358220(0x21e):_0x5db9a1=[0x1,0x2,0x3],_0x483283=[0x1,0x2],_0x1b5aa8=[0x1,0x2,0x3,0x4,0x5],_0x31ab99=[_0x358220(0x20a)],_0x30c2f=['C'],_0x41e688=['F'];break;}}return{'levels':_0x5db9a1,'Isle':_0x483283,'rack':_0x1b5aa8,'type':_0x31ab99,'storage':_0x30c2f,'rak':_0x41e688};}async function getRandom8DigitNumber(){var _0x3c29b7=a0_0x223d5f;const _0x30383f=0x989680,_0x4575de=0x5f5e0ff,_0x222eac=Math['floor'](Math['random']()*(_0x4575de-_0x30383f+0x1))+_0x30383f;var _0x22a579;const _0x3bc88d=await purchases[_0x3c29b7(0x28c)]({'invoice':_0x3c29b7(0x1ad)+_0x222eac});return _0x3bc88d&&_0x3bc88d['length']>0x0?_0x22a579=_0x3c29b7(0x1ad)+_0x222eac:_0x22a579=_0x3c29b7(0x1ad)+_0x222eac,_0x22a579;}router[a0_0x223d5f(0x277)](a0_0x223d5f(0x20d),auth,async(_0x184446,_0x418590)=>{var _0x435a35=a0_0x223d5f;try{const {username:_0x59b634,email:_0xb8aa5b,role:_0x50fcea}=_0x184446[_0x435a35(0x1d0)],_0x1cd6d0=_0x184446[_0x435a35(0x1d0)],_0x8280fa=await profile[_0x435a35(0x28c)]({'email':_0x1cd6d0[_0x435a35(0x202)]}),_0x1e3406=await master_shop['find'](),_0x1c751f=await staff[_0x435a35(0x28c)]({'email':_0x1cd6d0[_0x435a35(0x202)]}),_0xb6cc1a=await suppliers[_0x435a35(0x1b8)]({});let _0x2caf34;if(_0x1cd6d0[_0x435a35(0x285)]==_0x435a35(0x18d)){const _0x5312dc=await staff[_0x435a35(0x28c)]({'email':_0x1cd6d0['email']});_0x2caf34=await warehouse[_0x435a35(0x27c)]([{'$match':{'status':_0x435a35(0x207),'name':_0x5312dc[_0x435a35(0x246)],'warehouse_category':_0x435a35(0x23b),'name':{'$ne':_0x435a35(0x200)}}},{'$group':{'_id':_0x435a35(0x1c1),'name':{'$first':_0x435a35(0x1c1)}}}]);}else _0x2caf34=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x435a35(0x1c1),'name':{'$first':_0x435a35(0x1c1)}}}]);const _0x1bc00a=await product['find']({}),_0x2d92ee=await warehouse[_0x435a35(0x1b8)]({'status':'Enabled'}),_0x48c844=await purchases[_0x435a35(0x1b8)]({}),_0x6c64b6=_0x48c844[_0x435a35(0x264)]+0x1,_0x568fe7=_0x435a35(0x1ad)+_0x6c64b6[_0x435a35(0x268)]()[_0x435a35(0x18a)](0x5,'0');var _0x3b0514=[_0x435a35(0x206),_0x435a35(0x1d6)];if(_0x1e3406[0x0][_0x435a35(0x23a)]==_0x435a35(0x24a))var _0x4e284c=users['English'];else{if(_0x1e3406[0x0]['language']==_0x435a35(0x187))var _0x4e284c=users[_0x435a35(0x187)];else{if(_0x1e3406[0x0][_0x435a35(0x23a)]==_0x435a35(0x1c9))var _0x4e284c=users[_0x435a35(0x1c9)];else{if(_0x1e3406[0x0][_0x435a35(0x23a)]==_0x435a35(0x25f))var _0x4e284c=users[_0x435a35(0x25f)];else{if(_0x1e3406[0x0][_0x435a35(0x23a)]=='French')var _0x4e284c=users[_0x435a35(0x25e)];else{if(_0x1e3406[0x0][_0x435a35(0x23a)]==_0x435a35(0x1c5))var _0x4e284c=users['Portuguese'];else{if(_0x1e3406[0x0][_0x435a35(0x23a)]==_0x435a35(0x275))var _0x4e284c=users[_0x435a35(0x275)];else{if(_0x1e3406[0x0]['language']==_0x435a35(0x205))var _0x4e284c=users[_0x435a35(0x186)];}}}}}}}const _0x43ef4d=getRandom8DigitNumber();_0x43ef4d[_0x435a35(0x262)](_0x1ff64d=>{var _0x3c6af3=_0x435a35;_0x418590[_0x3c6af3(0x208)](_0x3c6af3(0x239),{'success':_0x184446['flash'](_0x3c6af3(0x218)),'errors':_0x184446[_0x3c6af3(0x1e6)](_0x3c6af3(0x1c6)),'role':_0x1cd6d0,'profile':_0x8280fa,'suppliers':_0xb6cc1a,'warehouse':_0x2caf34,'product':_0x1bc00a,'invoice':_0x1ff64d,'master_shop':_0x1e3406,'language':_0x4e284c,'find_data':_0x2d92ee,'rooms_data':_0x3b0514});})[_0x435a35(0x1df)](_0x283b9d=>{var _0x4b16fc=_0x435a35;_0x184446[_0x4b16fc(0x1e6)](_0x4b16fc(0x1c6),_0x4b16fc(0x18f)),_0x418590[_0x4b16fc(0x233)](_0x4b16fc(0x290));});}catch(_0x3b4a80){console[_0x435a35(0x265)](_0x3b4a80);}}),router[a0_0x223d5f(0x277)]('/view/add_purchases/:id',auth,async(_0x3b6f28,_0x389800)=>{var _0x35f409=a0_0x223d5f;try{const _0x51ba46=_0x3b6f28[_0x35f409(0x266)]['id'];console[_0x35f409(0x265)](_0x51ba46);const _0x47acfc=await master_shop[_0x35f409(0x1b8)]();console['log']('master',_0x47acfc);const _0x22b85e=await product[_0x35f409(0x28c)]({'name':_0x51ba46});console[_0x35f409(0x265)](_0x35f409(0x22e),_0x22b85e),_0x389800[_0x35f409(0x295)](0xc8)[_0x35f409(0x26a)]({'product_data':_0x22b85e,'master':_0x47acfc});}catch(_0x104097){console['log'](_0x35f409(0x260),_0x104097);}}),router[a0_0x223d5f(0x257)](a0_0x223d5f(0x20d),auth,async(_0x467dab,_0x4449c3)=>{var _0x41a5b3=a0_0x223d5f;try{const {invoice:_0x36a38d,date:_0x4e5228,warehouse_name:_0x9e0795,prod_name:_0x390944,prod_code:_0x161d26,prod_qty:_0x532810,prod_unit:_0x576e7d,prod_secondunit:_0x48e3e4,prod_level:_0x524d05,prod_isle:_0x329d5f,prod_pallet:_0x1f20e5,note:_0x4981aa,expiry_date:_0x331ba2,batch_code:_0x5796fd,payable:_0x159631,due_amount:_0x69fcdf,Room_name:_0x1038bd,primary_code:_0x1406e3,secondary_code:_0x28d305,MaxStocks_data:_0x58db57,PO_number:_0xf22729,SCRN:_0x1ae6be,JO_number:_0x492b41}=_0x467dab['body'];if(typeof _0x390944==_0x41a5b3(0x1d7))var _0x255125=[_0x467dab['body']['prod_name']],_0x10b14e=[_0x467dab['body'][_0x41a5b3(0x244)]],_0x350f69=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x28d)]],_0x3fa659=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x267)]],_0x255af3=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x17b)]],_0x2892d4=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x27b)]],_0x420032=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x274)]],_0x2d3e19=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x294)]],_0x227d99=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x279)]],_0x2dda51=[_0x467dab[_0x41a5b3(0x1a0)]['batch_code']],_0x455f3c=[_0x467dab[_0x41a5b3(0x1a0)]['expiry_date']],_0xc807e8=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x23e)]],_0x2e907a=[_0x467dab['body'][_0x41a5b3(0x1fe)]],_0x17115f=[_0x467dab['body'][_0x41a5b3(0x1e9)]],_0x177882=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x1f9)]],_0x449e49=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x1ab)]],_0x31323b=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x278)]],_0x62b1d2=[_0x467dab[_0x41a5b3(0x1a0)]['prod_invoice']],_0x250abd=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x17d)]],_0x406352=[_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x1b7)]];else var _0x255125=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x212)]],_0x10b14e=[..._0x467dab[_0x41a5b3(0x1a0)]['prod_code']],_0x350f69=[..._0x467dab['body']['prod_Qty']],_0x3fa659=[..._0x467dab[_0x41a5b3(0x1a0)]['prod_primunit']],_0x255af3=[..._0x467dab['body'][_0x41a5b3(0x17b)]],_0x2892d4=[..._0x467dab['body'][_0x41a5b3(0x27b)]],_0x420032=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x274)]],_0x2d3e19=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x294)]],_0x227d99=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x279)]],_0x2dda51=[..._0x467dab[_0x41a5b3(0x1a0)]['batch_code']],_0x455f3c=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x19d)]],_0xc807e8=[..._0x467dab[_0x41a5b3(0x1a0)]['max_product_unit']],_0x2e907a=[..._0x467dab[_0x41a5b3(0x1a0)]['alertQTY']],_0x17115f=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x1e9)]],_0x177882=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x1f9)]],_0x449e49=[..._0x467dab[_0x41a5b3(0x1a0)]['RoomAssign']],_0x31323b=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x278)]],_0x62b1d2=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x272)]],_0x250abd=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x17d)]],_0x406352=[..._0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x1b7)]];const _0x1774cf=_0x255125[_0x41a5b3(0x1c7)](_0x27258d=>{return _0x27258d={'product_name':_0x27258d};});_0x250abd[_0x41a5b3(0x1ec)]((_0x33cfb5,_0x19a55b)=>{var _0x538b2f=_0x41a5b3;_0x1774cf[_0x19a55b][_0x538b2f(0x17d)]=Math[_0x538b2f(0x1e5)](_0x33cfb5);}),_0x406352[_0x41a5b3(0x1ec)]((_0x1ae6ff,_0x1605b7)=>{_0x1774cf[_0x1605b7]['actual_uom']=_0x1ae6ff;}),_0x10b14e[_0x41a5b3(0x1ec)]((_0x43dc2c,_0x965ed5)=>{var _0x2eba90=_0x41a5b3;_0x1774cf[_0x965ed5][_0x2eba90(0x237)]=_0x43dc2c;}),_0x350f69[_0x41a5b3(0x1ec)]((_0x20c23b,_0x5f3d69)=>{var _0x3fb8ac=_0x41a5b3;_0x1774cf[_0x5f3d69][_0x3fb8ac(0x21c)]=Math[_0x3fb8ac(0x1e5)](_0x20c23b);}),_0x3fa659[_0x41a5b3(0x1ec)]((_0x481587,_0x2b8c20)=>{var _0x1cf227=_0x41a5b3;_0x1774cf[_0x2b8c20][_0x1cf227(0x1e7)]=_0x481587;}),_0x255af3[_0x41a5b3(0x1ec)]((_0x6b6240,_0xcae868)=>{var _0x2dbffa=_0x41a5b3;_0x1774cf[_0xcae868][_0x2dbffa(0x1d3)]=_0x6b6240;}),_0x2892d4[_0x41a5b3(0x1ec)]((_0x42fb77,_0x7520ba)=>{_0x449e49['forEach']((_0x34844c,_0x5cc79b)=>{var _0x8b53c6=a0_0xf1fc;if(_0x34844c==_0x8b53c6(0x1ee)&&_0x7520ba==_0x5cc79b){console[_0x8b53c6(0x265)](_0x34844c+'\x20<\x20wew\x20>\x20'+_0x7520ba+_0x8b53c6(0x183)+_0x5cc79b+_0x8b53c6(0x183)+_0x42fb77);var _0x83feb8=_0x42fb77['slice'](0x3);_0x1774cf[_0x7520ba][_0x8b53c6(0x234)]=_0x42fb77[0x0],_0x1774cf[_0x7520ba]['rack']=_0x42fb77[0x1],_0x1774cf[_0x7520ba][_0x8b53c6(0x194)]=0x0,_0x1774cf[_0x7520ba][_0x8b53c6(0x1fb)]=0x0,_0x1774cf[_0x7520ba][_0x8b53c6(0x17f)]=_0x8b53c6(0x216),_0x1774cf[_0x7520ba]['floorlevel']=_0x83feb8;}else{if(_0x34844c=='Shelves'&&_0x7520ba==_0x5cc79b){var _0x83feb8=_0x42fb77[_0x8b53c6(0x1db)](0x3);_0x1774cf[_0x7520ba][_0x8b53c6(0x234)]=_0x42fb77[0x0],_0x1774cf[_0x7520ba][_0x8b53c6(0x283)]=_0x42fb77[0x1],_0x1774cf[_0x7520ba][_0x8b53c6(0x194)]=0x0,_0x1774cf[_0x7520ba][_0x8b53c6(0x1fb)]=0x0,_0x1774cf[_0x7520ba]['type']=_0x8b53c6(0x216),_0x1774cf[_0x7520ba][_0x8b53c6(0x1d1)]=_0x42fb77[0x5];}else{if(_0x7520ba==_0x5cc79b){if(_0x42fb77[0x0]=='A'&&_0x42fb77[0x1]=='L'&&_0x42fb77[0x2]=='L')console[_0x8b53c6(0x265)](_0x34844c+_0x8b53c6(0x183)+_0x7520ba+_0x8b53c6(0x183)+_0x5cc79b+_0x8b53c6(0x183)+_0x42fb77+'here'),_0x1774cf[_0x7520ba][_0x8b53c6(0x234)]=_0x42fb77[0x0],_0x1774cf[_0x7520ba][_0x8b53c6(0x283)]=_0x42fb77[0x1],_0x1774cf[_0x7520ba][_0x8b53c6(0x194)]=0x0,_0x1774cf[_0x7520ba][_0x8b53c6(0x1fb)]=0x0,_0x1774cf[_0x7520ba][_0x8b53c6(0x17f)]='Floor',_0x1774cf[_0x7520ba][_0x8b53c6(0x1d1)]=_0x42fb77[0x3];else{var _0x5a3f64;if(_0x42fb77[0x4]=='L')_0x5a3f64=_0x8b53c6(0x20a);else _0x42fb77[0x4]=='F'&&(_0x5a3f64=_0x8b53c6(0x216));_0x1774cf[_0x7520ba][_0x8b53c6(0x234)]=_0x42fb77[0x0],_0x1774cf[_0x7520ba][_0x8b53c6(0x283)]=_0x42fb77[0x1],_0x1774cf[_0x7520ba][_0x8b53c6(0x194)]=_0x42fb77[0x2],_0x1774cf[_0x7520ba][_0x8b53c6(0x1fb)]=_0x42fb77[0x3],_0x1774cf[_0x7520ba][_0x8b53c6(0x17f)]=_0x5a3f64,_0x1774cf[_0x7520ba][_0x8b53c6(0x1d1)]=_0x42fb77[0x5];}}}}});}),_0x420032[_0x41a5b3(0x1ec)]((_0xb2f551,_0x2011f6)=>{_0x1774cf[_0x2011f6]['primary_code']=_0xb2f551;}),_0x2d3e19[_0x41a5b3(0x1ec)]((_0xefbf4e,_0x1e8d31)=>{_0x1774cf[_0x1e8d31]['secondary_code']=_0xefbf4e;}),_0x227d99[_0x41a5b3(0x1ec)]((_0x1a193f,_0xd70464)=>{var _0x4ea497=_0x41a5b3;_0x1774cf[_0xd70464][_0x4ea497(0x1ff)]=_0x1a193f;}),_0x2dda51[_0x41a5b3(0x1ec)]((_0x1c7f19,_0x375e90)=>{var _0x1adb46=_0x41a5b3;_0x1774cf[_0x375e90][_0x1adb46(0x22f)]=_0x1c7f19;}),_0x455f3c[_0x41a5b3(0x1ec)]((_0x2c0d9f,_0x51554b)=>{var _0x3f8220=_0x41a5b3;_0x1774cf[_0x51554b][_0x3f8220(0x19d)]=_0x2c0d9f;}),_0xc807e8[_0x41a5b3(0x1ec)]((_0x4535f1,_0x229d8d)=>{var _0x6fe270=_0x41a5b3;_0x1774cf[_0x229d8d][_0x6fe270(0x226)]=_0x4535f1;}),_0x2e907a['forEach']((_0xdb7393,_0x1d134c)=>{var _0x513cac=_0x41a5b3;_0x1774cf[_0x1d134c][_0x513cac(0x1fe)]=_0xdb7393;}),_0x17115f[_0x41a5b3(0x1ec)]((_0x12cb1d,_0x18394b)=>{var _0x1b05e8=_0x41a5b3;_0x1774cf[_0x18394b][_0x1b05e8(0x1e9)]=_0x12cb1d;}),_0x177882['forEach']((_0x349a91,_0x28ddfc)=>{_0x1774cf[_0x28ddfc]['product_cat']=_0x349a91;}),_0x449e49[_0x41a5b3(0x1ec)]((_0x4f8f27,_0x43a5a9)=>{_0x1774cf[_0x43a5a9]['room_name']=_0x4f8f27;}),_0x31323b[_0x41a5b3(0x1ec)]((_0x23ff08,_0x67a62d)=>{_0x1774cf[_0x67a62d]['delivery_code']=_0x23ff08;}),_0x62b1d2[_0x41a5b3(0x1ec)]((_0x511406,_0x2cae6a)=>{_0x1774cf[_0x2cae6a]['invoice']=_0x511406;});const _0x3ee951=_0x449e49['map'](_0x2524b3=>{return _0x2524b3={'room_name':_0x2524b3};}),_0x5c12a8=_0x1774cf['filter'](_0xa91657=>_0xa91657[_0x41a5b3(0x21c)]!=='0'&&_0xa91657[_0x41a5b3(0x21c)]!==''),_0x349b5e=new purchases({'invoice':_0x36a38d,'suppliers':_0x467dab[_0x41a5b3(0x1a0)][_0x41a5b3(0x251)],'date':_0x4e5228,'warehouse_name':_0x9e0795,'product':_0x5c12a8,'note':_0x4981aa,'due_amount':_0x69fcdf,'POnumber':_0xf22729,'SCRN':_0x1ae6be,'JO_number':_0x492b41,'roomList':_0x3ee951}),_0x2100b7=await _0x349b5e[_0x41a5b3(0x245)](),_0x39d794=await purchases[_0x41a5b3(0x28c)]({'invoice':_0x36a38d}),_0x4a8fdc=_0x39d794['product']['map'](async _0x1442a0=>{var _0x503bae=_0x41a5b3,_0x10b0e1=await warehouse[_0x503bae(0x28c)]({'name':_0x9e0795,'room':_0x1442a0['room_name']}),_0xc84826=0x0;return _0x10b0e1[_0x503bae(0x19b)][_0x503bae(0x1ec)](_0x24ef1d=>{var _0x528f8d=_0x503bae;_0x24ef1d[_0x528f8d(0x1f6)]==_0x1442a0[_0x528f8d(0x1f6)]&&_0x24ef1d[_0x528f8d(0x1d1)]==_0x1442a0[_0x528f8d(0x1d1)]&&_0x24ef1d[_0x528f8d(0x17f)]==_0x1442a0['type']&&_0x24ef1d[_0x528f8d(0x1fb)]==_0x1442a0['bin']&&_0x24ef1d[_0x528f8d(0x194)]==_0x1442a0['bay']&&_0x24ef1d[_0x528f8d(0x283)]==_0x1442a0[_0x528f8d(0x283)]&&_0x24ef1d[_0x528f8d(0x234)]==_0x1442a0[_0x528f8d(0x234)]&&_0x24ef1d[_0x528f8d(0x19d)]==_0x1442a0[_0x528f8d(0x19d)]&&_0x24ef1d[_0x528f8d(0x22f)]==_0x1442a0['batch_code']&&_0x24ef1d['production_date']==_0x1442a0[_0x528f8d(0x1e9)]&&_0x24ef1d['invoice']==_0x39d794['invoice']&&(_0x24ef1d[_0x528f8d(0x19e)]+=Math[_0x528f8d(0x1e5)](_0x1442a0[_0x528f8d(0x21c)]),_0xc84826++);}),_0xc84826===0x0&&_0x10b0e1[_0x503bae(0x19b)][_0x503bae(0x204)]({'product_name':_0x1442a0[_0x503bae(0x1f6)],'product_stock':Math[_0x503bae(0x1e5)](_0x1442a0[_0x503bae(0x21c)]),'primary_code':_0x1442a0['primary_code'],'secondary_code':_0x1442a0[_0x503bae(0x294)],'product_code':_0x1442a0[_0x503bae(0x237)],'storage':_0x1442a0[_0x503bae(0x234)],'rack':_0x1442a0['rack'],'bay':_0x1442a0[_0x503bae(0x194)],'bin':_0x1442a0[_0x503bae(0x1fb)],'type':_0x1442a0[_0x503bae(0x17f)],'floorlevel':_0x1442a0[_0x503bae(0x1d1)],'maxProducts':_0x1442a0[_0x503bae(0x1ff)],'unit':_0x1442a0[_0x503bae(0x1e7)],'secondary_unit':_0x1442a0[_0x503bae(0x1d3)],'expiry_date':_0x1442a0['expiry_date'],'maxPerUnit':_0x1442a0[_0x503bae(0x226)],'batch_code':_0x1442a0['batch_code'],'alertQTY':_0x1442a0['alertQTY'],'production_date':_0x1442a0[_0x503bae(0x1e9)],'product_cat':_0x1442a0[_0x503bae(0x197)],'invoice':_0x1442a0[_0x503bae(0x201)],'actual_qty':Math[_0x503bae(0x1e5)](_0x1442a0['actual_qty']),'actual_uom':_0x1442a0[_0x503bae(0x1b7)]}),_0x10b0e1;});Promise['all'](_0x4a8fdc)[_0x41a5b3(0x262)](async _0x4f0fa7=>{var _0x1ee0cf=_0x41a5b3;try{for(const _0x143e79 of _0x4f0fa7){await _0x143e79[_0x1ee0cf(0x245)]();}const _0x38a559=await master_shop[_0x1ee0cf(0x1b8)](),_0x3d2758=await email_settings['findOne'](),_0x5ac59c=await supervisor_settings[_0x1ee0cf(0x1b8)]();var _0x59ce2a=_0x39d794[_0x1ee0cf(0x22e)],_0x4cd328='',_0x2fc521;for(_0x2fc521 in _0x59ce2a){_0x4cd328+=_0x1ee0cf(0x254)+_0x1ee0cf(0x1a4)+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x1f6)]+'</td>'+_0x1ee0cf(0x1a4)+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x237)]+_0x1ee0cf(0x1e4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x21c)]+_0x1ee0cf(0x1e4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59ce2a[_0x2fc521]['standard_unit']+_0x1ee0cf(0x1e4)+_0x1ee0cf(0x1a4)+_0x59ce2a[_0x2fc521]['secondary_unit']+'</td>'+_0x1ee0cf(0x1a4)+_0x39d794['warehouse_name']+_0x1ee0cf(0x1e4)+_0x1ee0cf(0x1a4)+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x24b)]+_0x1ee0cf(0x1e4)+_0x1ee0cf(0x1a4)+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x234)]+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x283)]+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x194)]+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x1fb)]+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x17f)][0x0]+_0x59ce2a[_0x2fc521][_0x1ee0cf(0x1d1)]+_0x1ee0cf(0x1e4),_0x1ee0cf(0x273);}let _0x4ee7f2=nodemailer[_0x1ee0cf(0x184)]({'host':_0x3d2758['host'],'port':Number(_0x3d2758[_0x1ee0cf(0x1bd)]),'secure':![],'auth':{'user':_0x3d2758[_0x1ee0cf(0x202)],'pass':_0x3d2758[_0x1ee0cf(0x1d4)]}}),_0x3a4ea7={'from':_0x3d2758['email'],'to':_0x5ac59c[0x0][_0x1ee0cf(0x1f2)],'subject':_0x1ee0cf(0x22a),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1ee0cf(0x221)+_0x1ee0cf(0x235)+_0x38a559[0x0][_0x1ee0cf(0x20f)],'cid':'logo'}],'html':_0x1ee0cf(0x243)+_0x1ee0cf(0x1f4)+_0x1ee0cf(0x230)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1ee0cf(0x1a5)+_0x1ee0cf(0x215)+'</div>'+'<div>'+_0x1ee0cf(0x288)+_0x38a559[0x0][_0x1ee0cf(0x242)]+'\x20</h2>'+_0x1ee0cf(0x259)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x1ee0cf(0x1a5)+_0x1ee0cf(0x1bf)+_0x1ee0cf(0x1ac)+_0x39d794['invoice']+'\x20'+_0x1ee0cf(0x1ba)+_0x1ee0cf(0x1bc)+_0x39d794[_0x1ee0cf(0x1a6)]+'\x20'+'</span>'+_0x1ee0cf(0x17e)+_0x1ee0cf(0x259)+_0x1ee0cf(0x181)+_0x1ee0cf(0x213)+_0x1ee0cf(0x254)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1ee0cf(0x203)+_0x1ee0cf(0x1e2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1ee0cf(0x253)+_0x1ee0cf(0x210)+'</tr>'+_0x1ee0cf(0x28a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4cd328+'\x20'+'</tbody>'+_0x1ee0cf(0x28f)+_0x1ee0cf(0x1a5)+_0x1ee0cf(0x1e1)+'<h5>'+_0x38a559[0x0]['site_title']+_0x1ee0cf(0x17e)+_0x1ee0cf(0x259)+_0x1ee0cf(0x259)+_0x1ee0cf(0x1a1)};_0x4ee7f2['sendMail'](_0x3a4ea7,function(_0x374b15,_0x22772e){var _0x3d8507=_0x1ee0cf;_0x374b15?(console[_0x3d8507(0x265)](_0x374b15),console[_0x3d8507(0x265)](_0x3d8507(0x238))):console[_0x3d8507(0x265)](_0x3d8507(0x24f));}),_0x467dab['flash']('success',_0x1ee0cf(0x263)),_0x4449c3['redirect']('/all_purchases/view/');}catch(_0x3bc861){console[_0x1ee0cf(0x1a2)](_0x3bc861),_0x4449c3[_0x1ee0cf(0x295)](0x1f4)[_0x1ee0cf(0x26a)]({'error':_0x1ee0cf(0x196)});}})[_0x41a5b3(0x1df)](_0x4dae96=>{var _0x83b2d7=_0x41a5b3;console[_0x83b2d7(0x1a2)](_0x4dae96),_0x4449c3['status'](0x1f4)[_0x83b2d7(0x26a)]({'error':_0x83b2d7(0x193)});});}catch(_0x5dcd4d){console[_0x41a5b3(0x265)](_0x5dcd4d);}}),router[a0_0x223d5f(0x277)](a0_0x223d5f(0x27e),auth,async(_0xca8f36,_0x4af0b0)=>{var _0xec0c2a=a0_0x223d5f;try{const {username:_0x5f0e31,email:_0x37b5c0,role:_0x28e267}=_0xca8f36[_0xec0c2a(0x1d0)],_0x585bb9=_0xca8f36[_0xec0c2a(0x1d0)],_0x14a78e=await profile[_0xec0c2a(0x28c)]({'email':_0x585bb9[_0xec0c2a(0x202)]}),_0x1a5717=await master_shop['find'](),_0x344bb3=_0xca8f36[_0xec0c2a(0x266)]['id'],_0x205fc3=await purchases[_0xec0c2a(0x293)](_0x344bb3),_0x3366d9=await warehouse[_0xec0c2a(0x27c)]([{'$match':{'name':_0x205fc3['warehouse_name'],'room':_0x205fc3[_0xec0c2a(0x26d)]}},{'$unwind':_0xec0c2a(0x222)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xec0c2a(0x1f5)},'bay':{'$first':_0xec0c2a(0x286)},'bin':{'$first':_0xec0c2a(0x21b)},'type':{'$first':_0xec0c2a(0x1f0)},'floorlevel':{'$first':_0xec0c2a(0x1c2)},'primary_code':{'$first':_0xec0c2a(0x1e8)},'secondary_code':{'$first':_0xec0c2a(0x280)},'product_code':{'$first':_0xec0c2a(0x27a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xec0c2a(0x232)},'expiry_date':{'$first':_0xec0c2a(0x214)}}}]),_0x574f03=await customer[_0xec0c2a(0x1b8)]({});let _0x456096;if(_0x585bb9['role']=='staff'){const _0x41c23d=await staff[_0xec0c2a(0x28c)]({'email':_0x585bb9[_0xec0c2a(0x202)]});_0x456096=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x41c23d[_0xec0c2a(0x246)]}},{'$group':{'_id':_0xec0c2a(0x1c1),'name':{'$first':_0xec0c2a(0x1c1)}}}]);}else _0x456096=await warehouse[_0xec0c2a(0x27c)]([{'$match':{'status':_0xec0c2a(0x207)}},{'$group':{'_id':_0xec0c2a(0x1c1),'name':{'$first':_0xec0c2a(0x1c1)}}}]);const _0x36b706=await product['find']({}),_0x53f05c=await suppliers[_0xec0c2a(0x1b8)]({}),_0x24471f=BayBinSelected(_0x205fc3[_0xec0c2a(0x255)],_0x205fc3[_0xec0c2a(0x26d)]);if(_0x1a5717[0x0][_0xec0c2a(0x23a)]==_0xec0c2a(0x24a)){var _0x7b17ac=users[_0xec0c2a(0x25c)];console[_0xec0c2a(0x265)](_0x7b17ac);}else{if(_0x1a5717[0x0][_0xec0c2a(0x23a)]==_0xec0c2a(0x187))var _0x7b17ac=users[_0xec0c2a(0x187)];else{if(_0x1a5717[0x0][_0xec0c2a(0x23a)]=='German')var _0x7b17ac=users[_0xec0c2a(0x1c9)];else{if(_0x1a5717[0x0][_0xec0c2a(0x23a)]==_0xec0c2a(0x25f))var _0x7b17ac=users[_0xec0c2a(0x25f)];else{if(_0x1a5717[0x0][_0xec0c2a(0x23a)]==_0xec0c2a(0x25e))var _0x7b17ac=users['French'];else{if(_0x1a5717[0x0]['language']==_0xec0c2a(0x1c5))var _0x7b17ac=users[_0xec0c2a(0x1dc)];else{if(_0x1a5717[0x0][_0xec0c2a(0x23a)]==_0xec0c2a(0x275))var _0x7b17ac=users[_0xec0c2a(0x275)];else{if(_0x1a5717[0x0][_0xec0c2a(0x23a)]==_0xec0c2a(0x205))var _0x7b17ac=users[_0xec0c2a(0x186)];}}}}}}}_0x4af0b0[_0xec0c2a(0x208)]('edit_purchases_view',{'success':_0xca8f36[_0xec0c2a(0x1e6)]('success'),'errors':_0xca8f36[_0xec0c2a(0x1e6)]('errors'),'role':_0x585bb9,'profile':_0x14a78e,'customer':_0x574f03,'warehouse':_0x456096,'product':_0x3366d9,'user':_0x205fc3,'master_shop':_0x1a5717,'unit':_0x36b706,'language':_0x7b17ac,'suppliers':_0x53f05c,'dataSelected':_0x24471f});}catch(_0x210120){console[_0xec0c2a(0x265)](_0x210120);}}),router[a0_0x223d5f(0x257)]('/preview/:id',auth,async(_0x4a6161,_0x39e0b3)=>{var _0x5c872f=a0_0x223d5f;try{const _0x46294d=_0x4a6161[_0x5c872f(0x266)]['id'],{invoice:_0x4687ec,warehouse_name:_0x541eca,Room_name:_0x2355f3}=_0x4a6161[_0x5c872f(0x1a0)],_0x45c612=await warehouse['findOne']({'name':_0x541eca,'room':_0x2355f3}),_0x3f7efe=await purchases[_0x5c872f(0x28c)]({'invoice':_0x4687ec});_0x3f7efe[_0x5c872f(0x22e)]['forEach'](_0xe51898=>{var _0x2fc6db=_0x5c872f,_0x32f602=0x0;const _0x41433e=_0x45c612[_0x2fc6db(0x19b)][_0x2fc6db(0x1c7)](_0x55cee2=>{var _0x3dfb98=_0x2fc6db;_0x55cee2[_0x3dfb98(0x1f6)]==_0xe51898[_0x3dfb98(0x1f6)]&&_0x55cee2[_0x3dfb98(0x1d1)]==_0xe51898['floorlevel']&&_0x55cee2[_0x3dfb98(0x17f)]==_0xe51898[_0x3dfb98(0x17f)]&&_0x55cee2[_0x3dfb98(0x1fb)]==_0xe51898[_0x3dfb98(0x1fb)]&&_0x55cee2[_0x3dfb98(0x194)]==_0xe51898[_0x3dfb98(0x194)]&&_0x55cee2[_0x3dfb98(0x283)]==_0xe51898[_0x3dfb98(0x283)]&&_0x55cee2[_0x3dfb98(0x234)]==_0xe51898['storage']&&_0x55cee2[_0x3dfb98(0x19d)]==_0xe51898['expiry_date']&&_0x55cee2[_0x3dfb98(0x22f)]==_0xe51898[_0x3dfb98(0x22f)]&&_0x55cee2[_0x3dfb98(0x1e9)]==_0xe51898[_0x3dfb98(0x1e9)]&&_0x55cee2['delivery_date']==_0xe51898[_0x3dfb98(0x1c4)]&&_0x55cee2['delivery_code']==_0xe51898[_0x3dfb98(0x195)]&&(_0x55cee2[_0x3dfb98(0x19e)]=parseInt(_0x55cee2[_0x3dfb98(0x19e)])+parseInt(_0xe51898[_0x3dfb98(0x21c)]),_0x32f602++);});_0x32f602=='0'&&(_0x45c612[_0x2fc6db(0x19b)]=_0x45c612[_0x2fc6db(0x19b)]['concat']({'product_name':_0xe51898[_0x2fc6db(0x1f6)],'product_stock':_0xe51898['quantity'],'primary_code':_0xe51898[_0x2fc6db(0x274)],'secondary_code':_0xe51898[_0x2fc6db(0x294)],'product_code':_0xe51898[_0x2fc6db(0x237)],'storage':_0xe51898[_0x2fc6db(0x234)],'rack':_0xe51898[_0x2fc6db(0x283)],'bay':_0xe51898[_0x2fc6db(0x194)],'bin':_0xe51898[_0x2fc6db(0x1fb)],'type':_0xe51898[_0x2fc6db(0x17f)],'floorlevel':_0xe51898[_0x2fc6db(0x1d1)],'maxProducts':_0xe51898['maxStocks'],'unit':_0xe51898[_0x2fc6db(0x1e7)],'secondary_unit':_0xe51898['secondary_unit'],'expiry_date':_0xe51898['expiry_date'],'maxPerUnit':_0xe51898[_0x2fc6db(0x226)],'batch_code':_0xe51898[_0x2fc6db(0x22f)],'alertQTY':_0xe51898[_0x2fc6db(0x1fe)],'production_date':_0xe51898[_0x2fc6db(0x1e9)],'delivery_date':_0xe51898[_0x2fc6db(0x1c4)],'delivery_code':_0xe51898[_0x2fc6db(0x195)]}));}),await _0x45c612[_0x5c872f(0x245)](),_0x3f7efe[_0x5c872f(0x26f)]='True';const _0x596b7e=await _0x3f7efe[_0x5c872f(0x245)]();_0x4a6161['flash'](_0x5c872f(0x218),_0x5c872f(0x199)),_0x39e0b3[_0x5c872f(0x233)](_0x5c872f(0x290));}catch(_0x1b595d){console[_0x5c872f(0x265)](_0x1b595d);}}),router['get'](a0_0x223d5f(0x27f),auth,async(_0x512ed9,_0x3948e7)=>{var _0x1fd3eb=a0_0x223d5f;try{const {username:_0x26f49a,email:_0x29177a,role:_0x29df30}=_0x512ed9[_0x1fd3eb(0x1d0)],_0x466231=_0x512ed9[_0x1fd3eb(0x1d0)],_0x22b48d=await profile['findOne']({'email':_0x466231[_0x1fd3eb(0x202)]}),_0x15b008=await master_shop[_0x1fd3eb(0x1b8)](),_0x13612f=_0x512ed9[_0x1fd3eb(0x266)]['id'],_0x328d1b=await purchases['findById'](_0x13612f),_0x4a5d64=await suppliers[_0x1fd3eb(0x1b8)]({});let _0xe2b63d;if(_0x466231[_0x1fd3eb(0x285)]==_0x1fd3eb(0x18d)){const _0x2b7612=await staff['findOne']({'email':_0x466231[_0x1fd3eb(0x202)]});_0xe2b63d=await warehouse[_0x1fd3eb(0x1b8)]({'status':'Enabled','name':_0x2b7612[_0x1fd3eb(0x246)],'warehouse_category':_0x1fd3eb(0x23b)});}else _0xe2b63d=await warehouse[_0x1fd3eb(0x27c)]([{'$match':{'status':'Enabled','warehouse_category':_0x1fd3eb(0x23b)}},{'$group':{'_id':_0x1fd3eb(0x1c1),'name':{'$first':'$name'}}}]);const _0x16c07d=await product[_0x1fd3eb(0x1b8)]({}),_0x2e2ff0=BayBinSelected(_0x328d1b[_0x1fd3eb(0x255)],_0x328d1b[_0x1fd3eb(0x26d)]);let _0x5d0291=new Date(_0x328d1b[_0x1fd3eb(0x19d)]),_0x10481c=('0'+_0x5d0291['getDate']())[_0x1fd3eb(0x1db)](-0x2),_0x5385f7=('0'+(_0x5d0291[_0x1fd3eb(0x1b5)]()+0x1))[_0x1fd3eb(0x1db)](-0x2),_0x11365d=_0x5d0291['getFullYear'](),_0x5bbf9f=_0x11365d+'-'+_0x5385f7+'-'+_0x10481c;if(_0x15b008[0x0][_0x1fd3eb(0x23a)]==_0x1fd3eb(0x24a)){var _0x51ff3e=users[_0x1fd3eb(0x25c)];console[_0x1fd3eb(0x265)](_0x51ff3e);}else{if(_0x15b008[0x0][_0x1fd3eb(0x23a)]==_0x1fd3eb(0x187))var _0x51ff3e=users['Hindi'];else{if(_0x15b008[0x0][_0x1fd3eb(0x23a)]=='German')var _0x51ff3e=users[_0x1fd3eb(0x1c9)];else{if(_0x15b008[0x0][_0x1fd3eb(0x23a)]==_0x1fd3eb(0x25f))var _0x51ff3e=users[_0x1fd3eb(0x25f)];else{if(_0x15b008[0x0][_0x1fd3eb(0x23a)]==_0x1fd3eb(0x25e))var _0x51ff3e=users[_0x1fd3eb(0x25e)];else{if(_0x15b008[0x0][_0x1fd3eb(0x23a)]==_0x1fd3eb(0x1c5))var _0x51ff3e=users[_0x1fd3eb(0x1dc)];else{if(_0x15b008[0x0][_0x1fd3eb(0x23a)]==_0x1fd3eb(0x275))var _0x51ff3e=users[_0x1fd3eb(0x275)];else{if(_0x15b008[0x0]['language']==_0x1fd3eb(0x205))var _0x51ff3e=users[_0x1fd3eb(0x186)];}}}}}}}_0x3948e7[_0x1fd3eb(0x208)](_0x1fd3eb(0x209),{'success':_0x512ed9[_0x1fd3eb(0x1e6)](_0x1fd3eb(0x218)),'errors':_0x512ed9[_0x1fd3eb(0x1e6)]('errors'),'role':_0x466231,'profile':_0x22b48d,'purchases':_0x328d1b,'suppliers':_0x4a5d64,'warehouse':_0xe2b63d,'product':_0x16c07d,'master_shop':_0x15b008,'language':_0x51ff3e,'ed_fullDate':_0x5bbf9f,'dataSelected':_0x2e2ff0});}catch(_0x4d7a32){console['log'](_0x4d7a32);}}),router[a0_0x223d5f(0x257)]('/view/:id',auth,async(_0x3c146a,_0x374679)=>{var _0x19cb8e=a0_0x223d5f;try{const _0x497861=_0x3c146a[_0x19cb8e(0x266)]['id'],_0x2ae389=await purchases[_0x19cb8e(0x28c)]({'_id':_0x3c146a[_0x19cb8e(0x266)]['id']}),_0x55f79b=await warehouse['findOne']({'name':_0x2ae389[_0x19cb8e(0x255)],'room':_0x2ae389[_0x19cb8e(0x26d)]});_0x2ae389['product'][_0x19cb8e(0x1ec)](_0x18a824=>{var _0x20a0d3=_0x19cb8e;const _0x3f90f4=_0x55f79b[_0x20a0d3(0x19b)]['map'](_0x52199b=>{var _0x11cec9=_0x20a0d3;_0x52199b[_0x11cec9(0x1f6)]==_0x18a824[_0x11cec9(0x1f6)]&&_0x52199b[_0x11cec9(0x1d1)]==_0x18a824[_0x11cec9(0x1d1)]&&_0x52199b[_0x11cec9(0x17f)]==_0x18a824[_0x11cec9(0x17f)]&&_0x52199b[_0x11cec9(0x1fb)]==_0x18a824['bin']&&_0x52199b[_0x11cec9(0x194)]==_0x18a824[_0x11cec9(0x194)]&&_0x52199b[_0x11cec9(0x283)]==_0x18a824[_0x11cec9(0x283)]&&_0x52199b[_0x11cec9(0x234)]==_0x18a824[_0x11cec9(0x234)]&&(_0x52199b[_0x11cec9(0x19e)]=parseInt(_0x52199b[_0x11cec9(0x19e)])-parseInt(_0x18a824[_0x11cec9(0x21c)]));});}),await _0x55f79b[_0x19cb8e(0x245)]();const {invoice:_0x540230,suppliers:_0x6cbf41,date:_0x4aa612,warehouse_name:_0x1ddbee,prod_name:_0x407c2d,prod_code:_0x506b01,prod_qty:_0x13ee1b,prod_unit:_0x40331b,prod_secondunit:_0x388d3b,prod_level:_0x5cbd43,prod_isle:_0x53430e,prod_pallet:_0x577e7d,note:_0x35d1d1,expiry_date:_0x327624,batch_code:_0x2547ad,paid_amount:_0x571f89,due_amount:_0x3e7038,Room_name:_0x1df22e,primary_code:_0x340fb5,secondary_code:_0x4e09a0,PO_number:_0xb719ae,JO_number:_0x4e042a}=_0x3c146a[_0x19cb8e(0x1a0)];if(typeof _0x407c2d==_0x19cb8e(0x1d7))var _0x50fb5b=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x212)]],_0x421879=[_0x3c146a['body'][_0x19cb8e(0x244)]],_0x5afcf1=[_0x3c146a[_0x19cb8e(0x1a0)]['prod_qty']],_0x5655af=[_0x3c146a[_0x19cb8e(0x1a0)]['prod_unit']],_0x43cfda=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x17b)]],_0x1e857f=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x27b)]],_0x17dff2=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x252)]],_0x16de02=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x188)]],_0x132ddf=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x274)]],_0x10f19e=[_0x3c146a['body'][_0x19cb8e(0x294)]],_0x488352=[_0x3c146a[_0x19cb8e(0x1a0)]['MaxStocks_data']],_0x5e7336=[_0x3c146a[_0x19cb8e(0x1a0)]['batch_code']],_0x5c1346=[_0x3c146a['body']['expiry_date']],_0x4b4285=[_0x3c146a[_0x19cb8e(0x1a0)]['storage']],_0x3be337=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x1e0)]],_0x20d595=[_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x17f)]];else var _0x50fb5b=[..._0x3c146a[_0x19cb8e(0x1a0)]['prod_name']],_0x421879=[..._0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x244)]],_0x5afcf1=[..._0x3c146a[_0x19cb8e(0x1a0)]['prod_qty']],_0x5655af=[..._0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x1b4)]],_0x43cfda=[..._0x3c146a['body'][_0x19cb8e(0x17b)]],_0x1e857f=[..._0x3c146a['body'][_0x19cb8e(0x27b)]],_0x17dff2=[..._0x3c146a[_0x19cb8e(0x1a0)]['prod_isle']],_0x16de02=[..._0x3c146a[_0x19cb8e(0x1a0)]['prod_pallet']],_0x132ddf=[..._0x3c146a['body'][_0x19cb8e(0x274)]],_0x10f19e=[..._0x3c146a[_0x19cb8e(0x1a0)]['secondary_code']],_0x488352=[..._0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x279)]],_0x5e7336=[..._0x3c146a[_0x19cb8e(0x1a0)]['batch_code']],_0x5c1346=[..._0x3c146a[_0x19cb8e(0x1a0)]['expiry_date']],_0x4b4285=[..._0x3c146a['body']['storage']],_0x3be337=[..._0x3c146a[_0x19cb8e(0x1a0)]['rak']],_0x20d595=[..._0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x17f)]];const _0x5e2a96=_0x50fb5b['map'](_0x1f4154=>{return _0x1f4154={'product_name':_0x1f4154};});_0x421879[_0x19cb8e(0x1ec)]((_0x2b3f46,_0xe9db5b)=>{var _0x150fbd=_0x19cb8e;_0x5e2a96[_0xe9db5b][_0x150fbd(0x237)]=_0x2b3f46;}),_0x5afcf1[_0x19cb8e(0x1ec)]((_0x1f8eef,_0x3fe50b)=>{_0x5e2a96[_0x3fe50b]['quantity']=_0x1f8eef;}),_0x5655af['forEach']((_0x346736,_0x109461)=>{var _0x200163=_0x19cb8e;_0x5e2a96[_0x109461][_0x200163(0x1e7)]=_0x346736;}),_0x43cfda[_0x19cb8e(0x1ec)]((_0x30d9f7,_0x2ab9d4)=>{_0x5e2a96[_0x2ab9d4]['secondary_unit']=_0x30d9f7;}),_0x1e857f['forEach']((_0x58e6a2,_0x216373)=>{var _0x4ce12b=_0x19cb8e;_0x5e2a96[_0x216373][_0x4ce12b(0x194)]=_0x58e6a2;}),_0x17dff2[_0x19cb8e(0x1ec)]((_0x127e01,_0x6e5f85)=>{var _0x425a06=_0x19cb8e;_0x5e2a96[_0x6e5f85][_0x425a06(0x1fb)]=_0x127e01;}),_0x16de02[_0x19cb8e(0x1ec)]((_0x530a8a,_0x19a7e9)=>{var _0x59db8a=_0x19cb8e;_0x5e2a96[_0x19a7e9][_0x59db8a(0x1d1)]=_0x530a8a;}),_0x132ddf[_0x19cb8e(0x1ec)]((_0x2beeb8,_0x1f5fbd)=>{var _0x27d3ba=_0x19cb8e;_0x5e2a96[_0x1f5fbd][_0x27d3ba(0x274)]=_0x2beeb8;}),_0x10f19e[_0x19cb8e(0x1ec)]((_0x356526,_0x44b416)=>{_0x5e2a96[_0x44b416]['secondary_code']=_0x356526;}),_0x488352['forEach']((_0x2b744f,_0x121984)=>{_0x5e2a96[_0x121984]['maxStocks']=_0x2b744f;}),_0x5e7336[_0x19cb8e(0x1ec)]((_0x2273cf,_0x2f0662)=>{_0x5e2a96[_0x2f0662]['batch_code']=_0x2273cf;}),_0x5c1346[_0x19cb8e(0x1ec)]((_0x4b7c5e,_0x33b257)=>{var _0x116fe1=_0x19cb8e;_0x5e2a96[_0x33b257][_0x116fe1(0x19d)]=_0x4b7c5e;}),_0x20d595[_0x19cb8e(0x1ec)]((_0x5e8793,_0x47f28e)=>{var _0x1cfb88=_0x19cb8e;_0x5e2a96[_0x47f28e][_0x1cfb88(0x17f)]=_0x5e8793;}),_0x4b4285['forEach']((_0x2afe1f,_0x4799a1)=>{var _0x36eac1=_0x19cb8e;_0x5e2a96[_0x4799a1][_0x36eac1(0x234)]=_0x2afe1f;}),_0x3be337[_0x19cb8e(0x1ec)]((_0x1bd813,_0x758520)=>{var _0x4b0398=_0x19cb8e;_0x5e2a96[_0x758520][_0x4b0398(0x283)]=_0x1bd813;});const _0x433501=_0x5e2a96[_0x19cb8e(0x21a)](_0x3c326f=>_0x3c326f['quantity']!=='0'&&_0x3c326f[_0x19cb8e(0x21c)]!=='');_0x2ae389[_0x19cb8e(0x201)]=_0x540230,_0x2ae389['suppliers']=_0x6cbf41,_0x2ae389[_0x19cb8e(0x1a6)]=_0x4aa612,_0x2ae389[_0x19cb8e(0x255)]=_0x1ddbee,_0x2ae389[_0x19cb8e(0x22e)]=_0x433501,_0x2ae389[_0x19cb8e(0x25b)]=_0x35d1d1,_0x2ae389[_0x19cb8e(0x20c)]=_0x571f89,_0x2ae389[_0x19cb8e(0x23f)]=_0x3e7038,_0x2ae389[_0x19cb8e(0x26d)]=_0x1df22e,_0x2ae389['POnumber']=_0xb719ae,_0x2ae389[_0x19cb8e(0x224)]=_0x4e042a;const _0x591dfd=await _0x2ae389[_0x19cb8e(0x245)](),_0x543158=await warehouse[_0x19cb8e(0x28c)]({'name':_0x3c146a[_0x19cb8e(0x1a0)]['warehouse_name'],'room':_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x247)]});_0x2ae389[_0x19cb8e(0x22e)][_0x19cb8e(0x1ec)](_0x155900=>{var _0x53a25a=_0x19cb8e,_0x2ac054=0x0;const _0x3e5ef6=_0x543158[_0x53a25a(0x19b)][_0x53a25a(0x1c7)](_0xbcd5fa=>{var _0x3c9b34=_0x53a25a;_0xbcd5fa['product_name']==_0x155900[_0x3c9b34(0x1f6)]&&_0xbcd5fa['floorlevel']==_0x155900[_0x3c9b34(0x1d1)]&&_0xbcd5fa[_0x3c9b34(0x17f)]==_0x155900[_0x3c9b34(0x17f)]&&_0xbcd5fa[_0x3c9b34(0x1fb)]==_0x155900['bin']&&_0xbcd5fa[_0x3c9b34(0x194)]==_0x155900[_0x3c9b34(0x194)]&&_0xbcd5fa['rack']==_0x155900[_0x3c9b34(0x283)]&&_0xbcd5fa[_0x3c9b34(0x234)]==_0x155900[_0x3c9b34(0x234)]&&(_0xbcd5fa[_0x3c9b34(0x19e)]=parseInt(_0xbcd5fa['product_stock'])+parseInt(_0x155900[_0x3c9b34(0x21c)]),_0x2ac054++);});_0x2ac054=='0'&&(_0x543158[_0x53a25a(0x19b)]=_0x543158[_0x53a25a(0x19b)]['concat']({'product_name':_0x155900['product_name'],'product_stock':_0x155900[_0x53a25a(0x21c)],'primary_code':_0x155900['primary_code'],'secondary_code':_0x155900['secondary_code'],'product_code':_0x155900[_0x53a25a(0x237)],'storage':_0x155900[_0x53a25a(0x234)],'rack':_0x155900[_0x53a25a(0x283)],'bay':_0x155900[_0x53a25a(0x194)],'bin':_0x155900[_0x53a25a(0x1fb)],'type':_0x155900[_0x53a25a(0x17f)],'floorlevel':_0x155900[_0x53a25a(0x1d1)],'maxProducts':_0x155900[_0x53a25a(0x1ff)],'unit':_0x155900['standard_unit'],'secondary_unit':_0x155900[_0x53a25a(0x1d3)],'expiry_date':_0x155900[_0x53a25a(0x19d)]}));}),await _0x543158[_0x19cb8e(0x245)]();const _0x4331ea=await s_payment_data['findOne']({'invoice':_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x201)]});if(_0x4331ea===null){}else console['log'](_0x19cb8e(0x251),_0x4331ea,_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x201)]),_0x4331ea[_0x19cb8e(0x251)]=_0x3c146a[_0x19cb8e(0x1a0)][_0x19cb8e(0x251)],await _0x4331ea[_0x19cb8e(0x245)]();_0x3c146a[_0x19cb8e(0x1e6)](_0x19cb8e(0x218),_0x19cb8e(0x1cd)),_0x374679[_0x19cb8e(0x233)]('/all_purchases/view');}catch(_0x5e37bc){console['log'](_0x5e37bc);}}),router[a0_0x223d5f(0x257)](a0_0x223d5f(0x1b9),auth,async(_0x41ebb8,_0x5e8d27)=>{var _0x21fcc6=a0_0x223d5f;try{const _0x5a88ca=_0x41ebb8[_0x21fcc6(0x266)]['id'],{invoice:_0x41b279,suppliers:_0x5ac54a,payable:_0x2482ea,due_amount:_0x5b0852}=_0x41ebb8[_0x21fcc6(0x1a0)],_0x52f20e=await purchases[_0x21fcc6(0x293)](_0x5a88ca);var _0x26c7d8=_0x2482ea-_0x5b0852;_0x52f20e['paid_amount']=parseFloat(_0x52f20e[_0x21fcc6(0x20c)])+parseFloat(_0x5b0852),_0x52f20e['due_amount']=_0x26c7d8;const _0x388650=await _0x52f20e['save']();console[_0x21fcc6(0x265)](_0x388650);const _0x1703dc=await s_payment_data[_0x21fcc6(0x28c)]({'invoice':_0x41b279});_0x1703dc[_0x21fcc6(0x229)]=_0x26c7d8,await _0x1703dc[_0x21fcc6(0x245)]();let _0x399c81=new Date(),_0x3c9fd3=('0'+_0x399c81['getDate']())[_0x21fcc6(0x1db)](-0x2),_0x404e6f=('0'+(_0x399c81[_0x21fcc6(0x1b5)]()+0x1))['slice'](-0x2),_0x4f9d4b=_0x399c81[_0x21fcc6(0x192)](),_0x5e8351=_0x4f9d4b+'-'+_0x404e6f+'-'+_0x3c9fd3;const _0x7606ca=new suppliers_payment({'invoice':_0x41b279,'date':_0x4f9d4b+'-'+_0x404e6f+'-'+_0x3c9fd3,'suppliers':_0x5ac54a,'reason':_0x21fcc6(0x1f3),'amount':_0x5b0852}),_0x18c8ad=await _0x7606ca[_0x21fcc6(0x245)]();_0x41ebb8[_0x21fcc6(0x1e6)](_0x21fcc6(0x218),_0x21fcc6(0x1eb)),_0x5e8d27[_0x21fcc6(0x233)](_0x21fcc6(0x290));}catch(_0x7872bf){console[_0x21fcc6(0x265)](_0x7872bf);}}),router[a0_0x223d5f(0x277)](a0_0x223d5f(0x17c),auth,async(_0x239529,_0x598d11)=>{var _0x5c9667=a0_0x223d5f;try{const {username:_0xd272cb,email:_0x3d2c97,role:_0x304958}=_0x239529[_0x5c9667(0x1d0)],_0x3c38ce=_0x239529['user'],_0x5ef362=await profile[_0x5c9667(0x28c)]({'email':_0x3c38ce[_0x5c9667(0x202)]}),_0x58b8a4=await master_shop['find']();console[_0x5c9667(0x265)]('master',_0x58b8a4);const _0x576aac=_0x239529[_0x5c9667(0x266)]['id'],_0x23edb4=await purchases[_0x5c9667(0x293)](_0x576aac);console[_0x5c9667(0x265)](_0x23edb4);const _0x5a1124=await suppliers[_0x5c9667(0x28c)]({'name':_0x23edb4[_0x5c9667(0x251)]});console[_0x5c9667(0x265)](_0x5a1124);if(_0x58b8a4[0x0]['language']==_0x5c9667(0x24a)){var _0x4e65f6=users['English'];console['log'](_0x4e65f6);}else{if(_0x58b8a4[0x0][_0x5c9667(0x23a)]=='Hindi')var _0x4e65f6=users['Hindi'];else{if(_0x58b8a4[0x0][_0x5c9667(0x23a)]==_0x5c9667(0x1c9))var _0x4e65f6=users[_0x5c9667(0x1c9)];else{if(_0x58b8a4[0x0][_0x5c9667(0x23a)]==_0x5c9667(0x25f))var _0x4e65f6=users[_0x5c9667(0x25f)];else{if(_0x58b8a4[0x0][_0x5c9667(0x23a)]==_0x5c9667(0x25e))var _0x4e65f6=users[_0x5c9667(0x25e)];else{if(_0x58b8a4[0x0][_0x5c9667(0x23a)]==_0x5c9667(0x1c5))var _0x4e65f6=users[_0x5c9667(0x1dc)];else{if(_0x58b8a4[0x0]['language']==_0x5c9667(0x275))var _0x4e65f6=users['Chinese'];else{if(_0x58b8a4[0x0][_0x5c9667(0x23a)]==_0x5c9667(0x205))var _0x4e65f6=users[_0x5c9667(0x186)];}}}}}}}_0x598d11[_0x5c9667(0x208)](_0x5c9667(0x21f),{'success':_0x239529[_0x5c9667(0x1e6)](_0x5c9667(0x218)),'errors':_0x239529[_0x5c9667(0x1e6)](_0x5c9667(0x1c6)),'role':_0x3c38ce,'profile':_0x5ef362,'master_shop':_0x58b8a4,'supplier':_0x5a1124,'purchase':_0x23edb4,'language':_0x4e65f6});}catch(_0x110725){console[_0x5c9667(0x265)](_0x110725);}}),router[a0_0x223d5f(0x277)](a0_0x223d5f(0x291),auth,async(_0x33589b,_0x2a220b)=>{var _0x59abfb=a0_0x223d5f;try{const {username:_0x2d2454,email:_0x19fa2b,role:_0x128aa3}=_0x33589b[_0x59abfb(0x1d0)],_0x1451f2=_0x33589b[_0x59abfb(0x1d0)],_0x4fe46a=await profile[_0x59abfb(0x28c)]({'email':_0x1451f2[_0x59abfb(0x202)]}),_0xb51fdc=await master_shop[_0x59abfb(0x1b8)]();console[_0x59abfb(0x265)](_0x59abfb(0x1b3),_0xb51fdc);const _0xcbd7a1=_0x33589b['params']['id'];console[_0x59abfb(0x265)](_0xcbd7a1);const _0x529bcf=await purchases[_0x59abfb(0x293)](_0xcbd7a1);console[_0x59abfb(0x265)]('user_id',_0x529bcf);const _0x51b09f=await product['find']({}),_0xefd2e1=await warehouse[_0x59abfb(0x27c)]([{'$match':{'name':_0x529bcf['warehouse_name'],'room':_0x529bcf[_0x59abfb(0x26d)],'warehouse_category':_0x59abfb(0x23b)}},{'$unwind':_0x59abfb(0x222)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x59abfb(0x1fa)},'product_stock':{'$first':_0x59abfb(0x1f5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x59abfb(0x1c2)},'primary_code':{'$first':_0x59abfb(0x1e8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x59abfb(0x249)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x59abfb(0x27c)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x59abfb(0x23b)}},{'$group':{'_id':'$name','name':{'$first':_0x59abfb(0x1c1)}}},{'$sort':{'name':0x1}}]),console[_0x59abfb(0x265)](_0x59abfb(0x1b2),_0xefd2e1);if(_0xb51fdc[0x0][_0x59abfb(0x23a)]==_0x59abfb(0x24a)){var _0x1453e7=users[_0x59abfb(0x25c)];console[_0x59abfb(0x265)](_0x1453e7);}else{if(_0xb51fdc[0x0]['language']==_0x59abfb(0x187))var _0x1453e7=users[_0x59abfb(0x187)];else{if(_0xb51fdc[0x0]['language']==_0x59abfb(0x1c9))var _0x1453e7=users[_0x59abfb(0x1c9)];else{if(_0xb51fdc[0x0][_0x59abfb(0x23a)]=='Spanish')var _0x1453e7=users['Spanish'];else{if(_0xb51fdc[0x0][_0x59abfb(0x23a)]=='French')var _0x1453e7=users[_0x59abfb(0x25e)];else{if(_0xb51fdc[0x0][_0x59abfb(0x23a)]==_0x59abfb(0x1c5))var _0x1453e7=users[_0x59abfb(0x1dc)];else{if(_0xb51fdc[0x0][_0x59abfb(0x23a)]=='Chinese')var _0x1453e7=users[_0x59abfb(0x275)];else{if(_0xb51fdc[0x0][_0x59abfb(0x23a)]=='Arabic\x20(ae)')var _0x1453e7=users['Arabic'];}}}}}}}_0x2a220b[_0x59abfb(0x208)](_0x59abfb(0x1fc),{'success':_0x33589b[_0x59abfb(0x1e6)](_0x59abfb(0x218)),'errors':_0x33589b[_0x59abfb(0x1e6)](_0x59abfb(0x1c6)),'role':_0x1451f2,'profile':_0x4fe46a,'user':_0x529bcf,'stock':_0xefd2e1,'master_shop':_0xb51fdc,'product':_0x51b09f,'language':_0x1453e7,'warehouse':warehouse_data});}catch(_0x1cbac9){console[_0x59abfb(0x265)](_0x1cbac9);}}),router[a0_0x223d5f(0x257)](a0_0x223d5f(0x291),auth,async(_0x3d4baf,_0x93b22b)=>{var _0x4777bc=a0_0x223d5f;try{const {invoice:_0x128623,date:_0x1fb16b,warehouse_name:_0x1b3160,Room_name:_0x149432,product_name:_0x186bad,purchase_quantity:_0x1a20c3,stocks:_0x366fdb,return_qty:_0x27427c,note:_0x50e9f3,level:_0x5cf443,isle:_0x3c0ba0,pallet:_0x16b0b1,to_warehouse_name:_0x17f903,to_Room_name:_0x1ab865}=_0x3d4baf[_0x4777bc(0x1a0)],_0x2f6667=await purchases[_0x4777bc(0x28c)]({'_id':_0x3d4baf[_0x4777bc(0x266)]['id']}),_0x3453d1=await warehouse[_0x4777bc(0x28c)]({'name':_0x1b3160,'room':_0x149432});if(typeof _0x186bad==_0x4777bc(0x1d7))var _0x4e2322=[_0x3d4baf[_0x4777bc(0x1a0)]['product_name']],_0x33f99d=[_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x22d)]],_0x4c13c8=[_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x223)]],_0x14b1d1=[_0x3d4baf[_0x4777bc(0x1a0)]['return_qty']],_0x2d59b9=[_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x1cf)]],_0x5e9e21=[_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x1a7)]],_0x209c45=[_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x190)]],_0x46df53=[_0x3d4baf['body'][_0x4777bc(0x256)]],_0x2c6de5=[_0x3d4baf['body'][_0x4777bc(0x28b)]],_0x31f1c9=[_0x3d4baf[_0x4777bc(0x1a0)]['primary_code_hide']],_0x36ce1b=[_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x24d)]];else var _0x4e2322=[..._0x3d4baf['body'][_0x4777bc(0x1f6)]],_0x33f99d=[..._0x3d4baf['body']['purchase_quantity']],_0x4c13c8=[..._0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x223)]],_0x14b1d1=[..._0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x19a)]],_0x2d59b9=[..._0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x1cf)]],_0x5e9e21=[..._0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x1a7)]],_0x209c45=[..._0x3d4baf[_0x4777bc(0x1a0)]['pallet']],_0x46df53=[..._0x3d4baf['body'][_0x4777bc(0x256)]],_0x2c6de5=[..._0x3d4baf[_0x4777bc(0x1a0)]['product_code_hide']],_0x31f1c9=[..._0x3d4baf[_0x4777bc(0x1a0)]['primary_code_hide']],_0x36ce1b=[..._0x3d4baf['body']['secondary_code_hide']];const _0x2f8521=_0x4e2322[_0x4777bc(0x1c7)](_0x91381a=>{return _0x91381a={'product_name':_0x91381a};});_0x33f99d[_0x4777bc(0x1ec)]((_0x1fdd15,_0x3c06d0)=>{var _0x146fb6=_0x4777bc;_0x2f8521[_0x3c06d0][_0x146fb6(0x22d)]=_0x1fdd15;}),_0x4c13c8[_0x4777bc(0x1ec)]((_0x4dd4d4,_0x49dd25)=>{_0x2f8521[_0x49dd25]['stock_quantity']=_0x4dd4d4;}),_0x14b1d1[_0x4777bc(0x1ec)]((_0x14afdb,_0x4f22bc)=>{var _0xa850f8=_0x4777bc;_0x2f8521[_0x4f22bc][_0xa850f8(0x19a)]=_0x14afdb;}),_0x2d59b9[_0x4777bc(0x1ec)]((_0x13dded,_0x63be77)=>{var _0x3c56b2=_0x4777bc;_0x2f8521[_0x63be77][_0x3c56b2(0x194)]=_0x13dded;}),_0x5e9e21[_0x4777bc(0x1ec)]((_0x50a84a,_0x1fdf70)=>{var _0x55cd4e=_0x4777bc;_0x2f8521[_0x1fdf70][_0x55cd4e(0x1fb)]=_0x50a84a;}),_0x209c45[_0x4777bc(0x1ec)]((_0x3eb7e1,_0x465c24)=>{var _0x347b35=_0x4777bc;_0x2f8521[_0x465c24][_0x347b35(0x1d1)]=_0x3eb7e1;}),_0x46df53[_0x4777bc(0x1ec)]((_0x3ef6cf,_0x55edff)=>{var _0x56bc57=_0x4777bc;_0x2f8521[_0x55edff][_0x56bc57(0x17f)]=_0x3ef6cf;}),_0x2c6de5[_0x4777bc(0x1ec)]((_0x48dba9,_0x18e993)=>{var _0x6c96e9=_0x4777bc;_0x2f8521[_0x18e993][_0x6c96e9(0x237)]=_0x48dba9;}),_0x31f1c9[_0x4777bc(0x1ec)]((_0x2da47f,_0x2a61dd)=>{var _0x3b4f60=_0x4777bc;_0x2f8521[_0x2a61dd][_0x3b4f60(0x274)]=_0x2da47f;}),_0x36ce1b[_0x4777bc(0x1ec)]((_0x6736c,_0x5c39d2)=>{var _0x323619=_0x4777bc;_0x2f8521[_0x5c39d2][_0x323619(0x294)]=_0x6736c;}),_0x2f6667['product'][_0x4777bc(0x1ec)](_0x343818=>{var _0x32a681=_0x4777bc;const _0x176e3a=_0x3453d1[_0x32a681(0x19b)][_0x32a681(0x1c7)](_0x3d01f5=>{var _0x4973f6=_0x32a681;_0x3d01f5[_0x4973f6(0x1f6)]==_0x343818['product_name']&&_0x3d01f5[_0x4973f6(0x1d1)]==_0x343818[_0x4973f6(0x1d1)]&&_0x3d01f5[_0x4973f6(0x17f)]==_0x343818[_0x4973f6(0x17f)]&&_0x3d01f5[_0x4973f6(0x1fb)]==_0x343818[_0x4973f6(0x1fb)]&&_0x3d01f5['bay']==_0x343818[_0x4973f6(0x194)]&&_0x3d01f5['rack']==_0x343818['rack']&&_0x3d01f5[_0x4973f6(0x234)]==_0x343818[_0x4973f6(0x234)]&&(console[_0x4973f6(0x265)](parseInt(_0x3d01f5[_0x4973f6(0x19e)])+_0x4973f6(0x183)+parseInt(_0x343818[_0x4973f6(0x21c)])),_0x3d01f5['product_stock']=parseInt(_0x3d01f5[_0x4973f6(0x19e)])+parseInt(_0x343818['quantity']));});}),await _0x3453d1['save']();const _0x2bb3d8=_0x2f8521['filter'](_0x453c1f=>_0x453c1f[_0x4777bc(0x19a)]!=='0'&&_0x453c1f[_0x4777bc(0x19a)]!=='');var _0x5b0873=0x0;_0x2bb3d8['forEach'](_0x170287=>{var _0x1d185a=_0x4777bc;console[_0x1d185a(0x265)](_0x1d185a(0x1f7),_0x170287),(parseInt(_0x170287['purchase_quantity'])<parseInt(_0x170287[_0x1d185a(0x19a)])||parseInt(_0x170287[_0x1d185a(0x227)])<parseInt(_0x170287[_0x1d185a(0x19a)]))&&_0x5b0873++;});if(_0x5b0873!=0x0)return _0x3d4baf['flash']('errors',_0x4777bc(0x21d)),_0x93b22b[_0x4777bc(0x233)]('back');const _0x1d49b5=new purchases_return({'invoice':_0x128623,'suppliers':_0x3d4baf[_0x4777bc(0x1a0)]['suppliers'],'date':_0x1fb16b,'warehouse_name':_0x1b3160,'return_product':_0x2bb3d8,'note':_0x50e9f3,'room':_0x149432,'to_warehouse_name':_0x17f903,'to_room':_0x1ab865}),_0x270713=await _0x1d49b5['save']();console[_0x4777bc(0x265)](_0x1d49b5);const _0x491075=await purchases_return[_0x4777bc(0x28c)]({'invoice':_0x128623}),_0x35aca6=await warehouse[_0x4777bc(0x28c)]({'name':_0x17f903,'room':_0x1ab865});_0x491075[_0x4777bc(0x1b1)][_0x4777bc(0x1ec)](_0x2771eb=>{var _0x6b14dc=_0x4777bc,_0x213297=0x0;const _0x2a1562=_0x35aca6[_0x6b14dc(0x19b)][_0x6b14dc(0x1c7)](_0x3d1c73=>{var _0x5161d8=_0x6b14dc;_0x3d1c73[_0x5161d8(0x1f6)]==_0x2771eb[_0x5161d8(0x1f6)]&&_0x3d1c73['floorlevel']==_0x2771eb[_0x5161d8(0x1d1)]&&_0x3d1c73[_0x5161d8(0x17f)]==_0x2771eb[_0x5161d8(0x17f)]&&_0x3d1c73[_0x5161d8(0x1fb)]==_0x2771eb[_0x5161d8(0x1fb)]&&_0x3d1c73[_0x5161d8(0x194)]==_0x2771eb[_0x5161d8(0x194)]&&(_0x3d1c73[_0x5161d8(0x19e)]=parseInt(_0x3d1c73[_0x5161d8(0x19e)])-parseInt(_0x2771eb[_0x5161d8(0x19a)]),_0x213297++);});_0x213297=='0'&&(_0x35aca6[_0x6b14dc(0x19b)]=_0x35aca6[_0x6b14dc(0x19b)][_0x6b14dc(0x24c)]({'product_name':_0x2771eb['product_name'],'product_stock':_0x2771eb['return_qty'],'primary_code':_0x2771eb[_0x6b14dc(0x274)],'secondary_code':_0x2771eb[_0x6b14dc(0x294)],'product_code':_0x2771eb[_0x6b14dc(0x237)],'storage':_0x2771eb[_0x6b14dc(0x234)],'rack':_0x2771eb[_0x6b14dc(0x283)],'bay':_0x2771eb[_0x6b14dc(0x194)],'bin':_0x2771eb[_0x6b14dc(0x1fb)],'type':_0x2771eb[_0x6b14dc(0x17f)],'floorlevel':_0x2771eb['floorlevel'],'maxProducts':_0x2771eb['maxStocks'],'unit':_0x2771eb[_0x6b14dc(0x1e7)],'secondary_unit':_0x2771eb[_0x6b14dc(0x1d3)],'expiry_date':_0x2771eb[_0x6b14dc(0x19d)]}));}),await _0x35aca6[_0x4777bc(0x245)]();const _0x1dbf59=await purchases[_0x4777bc(0x28c)]({'invoice':_0x128623});_0x1dbf59[_0x4777bc(0x1fd)]=_0x4777bc(0x1a3);const _0x1ada0c=await _0x1dbf59[_0x4777bc(0x245)](),_0x448a18=new s_payment_data({'invoice':_0x128623,'suppliers':_0x3d4baf[_0x4777bc(0x1a0)][_0x4777bc(0x251)],'reason':_0x4777bc(0x189)});await _0x448a18[_0x4777bc(0x245)]();const _0x15a324=await master_shop[_0x4777bc(0x1b8)]();console[_0x4777bc(0x265)]('add\x20post',_0x15a324[0x0][_0x4777bc(0x20f)]);const _0x402028=await email_settings['findOne'](),_0xde6bd2=await suppliers[_0x4777bc(0x28c)]({'name':_0x3d4baf['body'][_0x4777bc(0x251)]});console[_0x4777bc(0x265)](_0x4777bc(0x1e3),_0xde6bd2);_0x15a324[0x0][_0x4777bc(0x1af)]==0x1?(right_currency=_0x15a324[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x15a324[0x0][_0x4777bc(0x26c)]);var _0x1537ef=_0x4e2322,_0x1b0037=_0x14b1d1,_0xb4f867='',_0x42ac26;for(_0x42ac26 in _0x1537ef){_0xb4f867+=_0x4777bc(0x254)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1537ef[_0x42ac26]+_0x4777bc(0x1e4)+_0x4777bc(0x1a4)+_0x1b0037[_0x42ac26]+_0x4777bc(0x1e4)+'</tr>';}console[_0x4777bc(0x265)](_0x4777bc(0x1f8),_0xb4f867);let _0x230fcf=nodemailer[_0x4777bc(0x184)]({'service':_0x4777bc(0x1aa),'auth':{'user':_0x402028[_0x4777bc(0x202)],'pass':_0x402028[_0x4777bc(0x1d4)]}}),_0x1ac3dc={'from':_0x402028['email'],'to':_0xde6bd2[_0x4777bc(0x202)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x4777bc(0x185),'path':__dirname+'/../public'+'/upload/'+_0x15a324[0x0][_0x4777bc(0x20f)],'cid':_0x4777bc(0x1c3)}],'html':_0x4777bc(0x243)+_0x4777bc(0x1f4)+_0x4777bc(0x230)+'<div>'+_0x4777bc(0x25d)+_0x4777bc(0x1a5)+_0x4777bc(0x215)+'</div>'+'<div>'+_0x4777bc(0x288)+_0x15a324[0x0][_0x4777bc(0x242)]+'\x20</h2>'+_0x4777bc(0x259)+_0x4777bc(0x259)+_0x4777bc(0x20e)+_0x4777bc(0x1a5)+_0x4777bc(0x1bf)+_0x4777bc(0x1ac)+_0x128623+'\x20'+_0x4777bc(0x1ba)+_0x4777bc(0x1bc)+_0x1fb16b+'\x20'+_0x4777bc(0x19c)+_0x4777bc(0x17e)+_0x4777bc(0x259)+_0x4777bc(0x181)+_0x4777bc(0x213)+'<tr>'+_0x4777bc(0x284)+_0x4777bc(0x22b)+_0x4777bc(0x1c0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4777bc(0x273)+_0x4777bc(0x28a)+_0x4777bc(0x18c)+'\x20'+_0xb4f867+'\x20'+_0x4777bc(0x22c)+_0x4777bc(0x28f)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x15a324[0x0][_0x4777bc(0x242)]+'</h5>'+_0x4777bc(0x259)+_0x4777bc(0x259)+_0x4777bc(0x1a1)};_0x230fcf[_0x4777bc(0x1b6)](_0x1ac3dc,function(_0x4d0455,_0x400808){var _0x281186=_0x4777bc;_0x4d0455?(console[_0x281186(0x265)](_0x4d0455),console[_0x281186(0x265)](_0x281186(0x238))):console[_0x281186(0x265)]('Email\x20sent\x20successfully');}),_0x3d4baf[_0x4777bc(0x1e6)]('success',_0x4777bc(0x1da)),_0x93b22b[_0x4777bc(0x233)](_0x4777bc(0x290));}catch(_0x3d84c3){console['log'](_0x3d84c3),_0x93b22b['status'](0xc8)[_0x4777bc(0x26a)]({'message':_0x3d84c3[_0x4777bc(0x1ce)]});}}),router[a0_0x223d5f(0x277)](a0_0x223d5f(0x1c8),auth,async(_0x2263ae,_0x5b90c2)=>{var _0xc39b87=a0_0x223d5f;try{const {username:_0x397a8f,email:_0x10933c,role:_0x1dc7bb}=_0x2263ae[_0xc39b87(0x1d0)],_0x566460=_0x2263ae[_0xc39b87(0x1d0)],_0x3cae17=await profile['findOne']({'email':_0x566460[_0xc39b87(0x202)]}),_0x2ef765=await master_shop[_0xc39b87(0x1b8)](),_0x300023=_0x2263ae[_0xc39b87(0x266)]['id'],_0xa30e9e=await purchases['findById'](_0x300023);if(_0x2ef765[0x0][_0xc39b87(0x23a)]=='English\x20(US)')var _0x543486=users['English'];else{if(_0x2ef765[0x0][_0xc39b87(0x23a)]=='Hindi')var _0x543486=users[_0xc39b87(0x187)];else{if(_0x2ef765[0x0]['language']==_0xc39b87(0x1c9))var _0x543486=users[_0xc39b87(0x1c9)];else{if(_0x2ef765[0x0][_0xc39b87(0x23a)]==_0xc39b87(0x25f))var _0x543486=users[_0xc39b87(0x25f)];else{if(_0x2ef765[0x0][_0xc39b87(0x23a)]==_0xc39b87(0x25e))var _0x543486=users['French'];else{if(_0x2ef765[0x0]['language']==_0xc39b87(0x1c5))var _0x543486=users[_0xc39b87(0x1dc)];else{if(_0x2ef765[0x0]['language']==_0xc39b87(0x275))var _0x543486=users['Chinese'];else{if(_0x2ef765[0x0][_0xc39b87(0x23a)]==_0xc39b87(0x205))var _0x543486=users[_0xc39b87(0x186)];}}}}}}}_0x5b90c2[_0xc39b87(0x208)](_0xc39b87(0x270),{'success':_0x2263ae[_0xc39b87(0x1e6)](_0xc39b87(0x218)),'errors':_0x2263ae[_0xc39b87(0x1e6)](_0xc39b87(0x1c6)),'role':_0x566460,'profile':_0x3cae17,'alldata':_0xa30e9e,'master_shop':_0x2ef765,'language':_0x543486}),console['log'](alldata);}catch(_0x412080){console[_0xc39b87(0x265)](_0x412080);}}),router[a0_0x223d5f(0x257)](a0_0x223d5f(0x1d5),async(_0x3fc435,_0x3ef28a)=>{var _0xc00807=a0_0x223d5f;const {product_code:_0x401803}=_0x3fc435[_0xc00807(0x1a0)];var _0x214eae;const _0x23f465=await product[_0xc00807(0x27c)]([{'$match':{'primary_code':_0x401803,'product_category':_0xc00807(0x23b)}},{'$group':{'_id':'$_id','name':{'$first':_0xc00807(0x1c1)},'category':{'$first':'$category'},'brand':{'$first':_0xc00807(0x20b)},'unit':{'$first':_0xc00807(0x24e)},'alertquantity':{'$first':_0xc00807(0x18b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xc00807(0x1a8)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0xc00807(0x28e)},'maxProdPerUnit':{'$first':_0xc00807(0x1d9)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3dc199=await product[_0xc00807(0x27c)]([{'$match':{'secondary_code':_0x401803,'product_category':_0xc00807(0x23b)}},{'$group':{'_id':_0xc00807(0x287),'name':{'$first':_0xc00807(0x1c1)},'category':{'$first':_0xc00807(0x191)},'brand':{'$first':_0xc00807(0x20b)},'unit':{'$first':_0xc00807(0x24e)},'alertquantity':{'$first':_0xc00807(0x18b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xc00807(0x1a8)},'secondary_code':{'$first':_0xc00807(0x1de)},'maxStocks':{'$first':_0xc00807(0x28e)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x23f465[_0xc00807(0x264)]>0x0)_0x214eae=_0x23f465;else _0x3dc199[_0xc00807(0x264)]>0x0&&(_0x214eae=_0x3dc199);_0x3ef28a[_0xc00807(0x26a)](_0x214eae);}),router[a0_0x223d5f(0x257)]('/CheckingWarehouse',async(_0x442793,_0x41865e)=>{var _0x2d9a91=a0_0x223d5f;const {primaryCode:_0x1a6023,secondaryCode:_0x939fba,productCode:_0x168b42,bay:_0x2cc4a2,bin:_0x206713,types:_0x49943e,pallet:_0x8ea637,warehouses:_0x4d6ee1,room:_0x35f447}=_0x442793[_0x2d9a91(0x1a0)];console[_0x2d9a91(0x265)](_0x442793[_0x2d9a91(0x1a0)]);try{const _0x2e2b8b=await warehouse[_0x2d9a91(0x27c)]([{'$match':{'name':_0x4d6ee1,'room':_0x35f447}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x2cc4a2,'product_details.bin':_0x206713,'product_details.type':_0x49943e}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2d9a91(0x1f5)},'level':{'$first':_0x2d9a91(0x1dd)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x2d9a91(0x1b0)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x41865e[_0x2d9a91(0x295)](0xc8)[_0x2d9a91(0x26a)](_0x2e2b8b);}catch(_0x37c4eb){_0x41865e['status'](0x194)[_0x2d9a91(0x26a)]({'message':_0x37c4eb['message']});}}),module[a0_0x223d5f(0x19f)]=router;