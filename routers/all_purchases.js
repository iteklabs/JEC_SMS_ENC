var a0_0x444c49=a0_0x436e;(function(_0x305edb,_0x262c15){var _0x4059b5=a0_0x436e,_0x2de58b=_0x305edb();while(!![]){try{var _0x577d08=parseInt(_0x4059b5(0x201))/0x1*(-parseInt(_0x4059b5(0x182))/0x2)+parseInt(_0x4059b5(0x239))/0x3*(-parseInt(_0x4059b5(0x175))/0x4)+-parseInt(_0x4059b5(0x1dd))/0x5*(parseInt(_0x4059b5(0x150))/0x6)+parseInt(_0x4059b5(0x1e8))/0x7+-parseInt(_0x4059b5(0x190))/0x8*(-parseInt(_0x4059b5(0x18b))/0x9)+parseInt(_0x4059b5(0x231))/0xa*(parseInt(_0x4059b5(0x15c))/0xb)+-parseInt(_0x4059b5(0x120))/0xc*(parseInt(_0x4059b5(0x171))/0xd);if(_0x577d08===_0x262c15)break;else _0x2de58b['push'](_0x2de58b['shift']());}catch(_0x1d637b){_0x2de58b['push'](_0x2de58b['shift']());}}}(a0_0x1ae5,0x6410f));const express=require(a0_0x444c49(0x18e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x444c49(0x148)),auth=require(a0_0x444c49(0x21b)),nodemailer=require(a0_0x444c49(0x164));var ejs=require(a0_0x444c49(0x1e5));const path=require(a0_0x444c49(0x1b5)),users=require(a0_0x444c49(0x1a9));function a0_0x436e(_0x4452f0,_0x37d247){var _0x1ae55f=a0_0x1ae5();return a0_0x436e=function(_0x436e4c,_0x390e63){_0x436e4c=_0x436e4c-0x11f;var _0x33e027=_0x1ae55f[_0x436e4c];return _0x33e027;},a0_0x436e(_0x4452f0,_0x37d247);}router['get']('/view',auth,async(_0x4cd3b3,_0x127130)=>{var _0x125e54=a0_0x444c49;try{const {username:_0xc448fe,email:_0x8693fb,role:_0x44d044}=_0x4cd3b3['user'],_0x2df40d=_0x4cd3b3[_0x125e54(0x1c4)],_0x11ba77=await profile[_0x125e54(0x1f2)]({'email':_0x2df40d[_0x125e54(0x20c)]}),_0x21e13b=await staff[_0x125e54(0x1f2)]({'email':_0x2df40d[_0x125e54(0x20c)]});if(_0x2df40d[_0x125e54(0x14c)]==_0x125e54(0x172)){const _0x3b50fc=await staff[_0x125e54(0x1f2)]({'email':_0x2df40d['email']});}const _0x435d6a=await master_shop[_0x125e54(0x144)]();let _0x445599;if(_0x2df40d[_0x125e54(0x14c)]=='staff'){const _0x169dd8=await staff[_0x125e54(0x1f2)]({'email':_0x2df40d[_0x125e54(0x20c)]});_0x445599=await purchases[_0x125e54(0x12a)]([{'$match':{'warehouse_name':_0x169dd8[_0x125e54(0x19c)]}},{'$lookup':{'from':'suppliers','localField':_0x125e54(0x12b),'foreignField':_0x125e54(0x219),'as':'suppliers_docs'}},{'$unwind':_0x125e54(0x121)},{'$unwind':_0x125e54(0x173)},{'$group':{'_id':_0x125e54(0x13b),'invoice':{'$first':_0x125e54(0x1f9)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x125e54(0x212)},'warehouse_name':{'$first':_0x125e54(0x142)},'room':{'$first':'$room'},'product':{'$push':_0x125e54(0x173)},'note':{'$first':_0x125e54(0x234)},'paid_amount':{'$first':_0x125e54(0x135)},'due_amount':{'$first':_0x125e54(0x1de)},'return_data':{'$first':_0x125e54(0x1d9)},'batch_code':{'$first':_0x125e54(0x152)},'expiry_date':{'$first':_0x125e54(0x199)},'suppliers_docs':{'$first':_0x125e54(0x121)},'total_product_quantity':{'$sum':_0x125e54(0x123)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x125e54(0x1f7)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x445599=await purchases[_0x125e54(0x12a)]([{'$lookup':{'from':_0x125e54(0x12b),'localField':'suppliers','foreignField':_0x125e54(0x219),'as':_0x125e54(0x1ce)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x125e54(0x173)},{'$group':{'_id':'$_id','invoice':{'$first':_0x125e54(0x1f9)},'suppliers':{'$first':_0x125e54(0x15f)},'date':{'$first':_0x125e54(0x212)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x125e54(0x173)},'note':{'$first':_0x125e54(0x234)},'paid_amount':{'$first':_0x125e54(0x135)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x125e54(0x1d9)},'batch_code':{'$first':_0x125e54(0x152)},'expiry_date':{'$first':_0x125e54(0x199)},'suppliers_docs':{'$first':_0x125e54(0x121)},'total_product_quantity':{'$sum':_0x125e54(0x123)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x125e54(0x1c7)},'type':{'$addToSet':_0x125e54(0x1f7)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x125e54(0x16c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x435d6a[0x0][_0x125e54(0x11f)]==_0x125e54(0x13a)){var _0x337354=users['English'];console[_0x125e54(0x1d3)](_0x337354);}else{if(_0x435d6a[0x0][_0x125e54(0x11f)]==_0x125e54(0x13f))var _0x337354=users[_0x125e54(0x13f)];else{if(_0x435d6a[0x0]['language']==_0x125e54(0x206))var _0x337354=users[_0x125e54(0x206)];else{if(_0x435d6a[0x0][_0x125e54(0x11f)]==_0x125e54(0x1ea))var _0x337354=users[_0x125e54(0x1ea)];else{if(_0x435d6a[0x0][_0x125e54(0x11f)]=='French')var _0x337354=users['French'];else{if(_0x435d6a[0x0][_0x125e54(0x11f)]=='Portuguese\x20(BR)')var _0x337354=users['Portuguese'];else{if(_0x435d6a[0x0][_0x125e54(0x11f)]=='Chinese')var _0x337354=users[_0x125e54(0x1a8)];else{if(_0x435d6a[0x0]['language']==_0x125e54(0x177))var _0x337354=users['Arabic'];}}}}}}}_0x127130[_0x125e54(0x188)](_0x125e54(0x143),{'success':_0x4cd3b3['flash'](_0x125e54(0x18c)),'errors':_0x4cd3b3[_0x125e54(0x146)](_0x125e54(0x19b)),'purchases':_0x445599,'role':_0x2df40d,'profile':_0x11ba77,'master_shop':_0x435d6a,'language':_0x337354});}catch(_0x268d19){console[_0x125e54(0x1d3)](_0x125e54(0x133),_0x268d19),_0x127130['status'](0xc8)[_0x125e54(0x224)]({'message':_0x268d19[_0x125e54(0x236)]});}});function BayBinSelected(_0x2cf965,_0x1abbba){var _0x3a61e9=a0_0x444c49,_0x4c7823=[],_0xf0573e=[],_0x237097=[],_0x3879b6=[],_0x5769f9=[],_0x549d49=[];let _0x1d90e8=[];if(_0x2cf965==_0x3a61e9(0x22e))switch(_0x1abbba){case _0x3a61e9(0x1bf):_0x4c7823=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xf0573e=[0x1,0x2],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x18d),_0x3a61e9(0x1cc)],_0x5769f9=['D'],_0x549d49=['A'];break;case _0x3a61e9(0x1d6):_0x4c7823=[0x6,0x5,0x4,0x3,0x2,0x1],_0xf0573e=[0x1,0x2],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x18d),_0x3a61e9(0x1cc)],_0x5769f9=['D'],_0x549d49=['B'];break;case _0x3a61e9(0x1ed):_0x4c7823=[0x0],_0xf0573e=[0x0],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x1cc)],_0x5769f9=['D'],_0x549d49=['S'];break;case'Receiving\x20Area':_0x4c7823=[0x0],_0xf0573e=[0x0],_0x3879b6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x237097=[_0x3a61e9(0x1cc)],_0x5769f9=['D'],_0x549d49=['R'];break;}else{if(_0x2cf965==_0x3a61e9(0x138))switch(_0x1abbba){case'Rack\x20A':_0x4c7823=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xf0573e=['B','F'],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=['Level',_0x3a61e9(0x1cc)],_0x5769f9=['C'],_0x549d49=['A'];break;case _0x3a61e9(0x1d6):_0x4c7823=[0x5,0x4,0x3,0x2,0x1],_0xf0573e=['F','B','S'],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x18d),_0x3a61e9(0x1cc)],_0x5769f9=['C'],_0x549d49=['B'];break;case _0x3a61e9(0x1dc):_0x4c7823=[0x1,0x2,0x3,0x4,0x5],_0xf0573e=['B','F','S'],_0x3879b6=[0x5,0x4,0x3,0x2,0x1],_0x237097=[_0x3a61e9(0x18d),'Floor'],_0x5769f9=['C'],_0x549d49=['C'];break;case'Rack\x20D':_0x4c7823=[0x5,0x4,0x3,0x2,0x1],_0xf0573e=['F','B','S'],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x18d),'Floor'],_0x5769f9=['C'],_0x549d49=['D'];break;case _0x3a61e9(0x20f):_0x4c7823=[0x4,0x3,0x2,0x1],_0xf0573e=[0x1,0x2],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x18d),_0x3a61e9(0x1cc)],_0x5769f9=['C'],_0x549d49=['E'];break;case _0x3a61e9(0x21d):_0x4c7823=[0x1,0x2,0x3],_0xf0573e=[0x1,0x2],_0x3879b6=[0x1,0x2,0x3,0x4,0x5],_0x237097=[_0x3a61e9(0x18d)],_0x5769f9=['C'],_0x549d49=['F'];break;}}return{'levels':_0x4c7823,'Isle':_0xf0573e,'rack':_0x3879b6,'type':_0x237097,'storage':_0x5769f9,'rak':_0x549d49};}async function getRandom8DigitNumber(){var _0x50203f=a0_0x444c49;const _0x3d0893=0x989680,_0x1d40d2=0x5f5e0ff,_0x412b36=Math[_0x50203f(0x213)](Math[_0x50203f(0x1e9)]()*(_0x1d40d2-_0x3d0893+0x1))+_0x3d0893;var _0x232c60;const _0x29119f=await purchases[_0x50203f(0x1f2)]({'invoice':'INC-'+_0x412b36});return _0x29119f&&_0x29119f[_0x50203f(0x15e)]>0x0?_0x232c60=_0x50203f(0x195)+_0x412b36:_0x232c60=_0x50203f(0x195)+_0x412b36,_0x232c60;}function a0_0x1ae5(){var _0x35bbc5=['getFullYear','prod_level','$product_details.bay','sendMail','11TUXLbO','Return\x20Goods','length','$suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','nodemailer','port','findById','exports','$product_details.product_code','add_purchases','$product_details.isle','product_stock','$finalize','$maxProdPerUnit','prod_cat','Enclosed','/preview/:id','2288884xPtzIL','staff','$product','room','44yGANkd','prod_Qty','Arabic\x20(ae)','</table>','body','user_id','/CheckingWarehouse','level','<h2>\x20','$product_details.bin','/upload/','foreach\x20newproduct','/barcode_scanner','2QrEKFI','$product_details.maxProducts','standard_unit','secondary_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','invoice','render','$secondary_code','abs','18QaiYeV','success','Level','express','prod_primunit','2994272suZSFo','purchase\x20data\x20update\x20successfully','save','host','maxperunit','INC-','$primary_code','stock_quantity','$alertquantity','$expiry_date','image','errors','warehouse','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$maxStocks','<html><head><title></title>','Portuguese\x20(BR)','catch','return_product','Error\x20Occurs','$product_code','</tbody>','stocks','Chinese','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Ambient','prod_code','$product_details.type','An\x20error\x20occurred\x20while\x20saving\x20data.','<span\x20style=\x22float:\x20right;\x22>','English','rak','return_purchase','purchase_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','path','prod_isle','$unit','status','forEach','</div>','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','delivery_date','filter','Rack\x20A','post','prod_name','/all_purchases/view','bin','user','French','\x20Order\x20Number\x20:\x20','$product.bin','date','\x20</h2>','room_name','/../public','Floor','all_purchases_barcode','suppliers_docs','amount','<h5>','primary_code','warehouse_name','log','RMSEmail','/view/add_purchases','Rack\x20B','max_product_unit','site_title','$return_data','Arabic','return_data','Rack\x20C','115730xhFVjQ','$due_amount','deliverycode','</span>','Purchase\x20Return\x20Mail','$secondary_unit','Sales\x20Update\x20successfully','type','ejs','edit_purchases_view','createTransport','5671162wicZXr','random','Spanish','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Shelves','storage','isle','Purchase\x20data\x20added\x20successfully','product_code','findOne','$product_details.storage','product','logo','$product_details._id','$product.type','quantity','$invoice','error','/view/:id','\x20<>\x20','product_details','product_cat','$product_details.product_stock','secondary_unit','226387OcESHr','Purchase\x20Return','<h5\x20style=\x22text-align:\x20left;\x22>','currency','/all_purchases/view/','German','$name','return_qty','/give_payment/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','bay','email','$category','Logo.png','Rack\x20E','all','$product_details.level','$date','floor','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</tr>','$product_details.primary_code','product_name','prod_pallet','name','map','../middleware/auth','An\x20error\x20occurred.','Rack\x20F','$product_details.expiry_date','<div>','types','actual_uom','string','\x20Order\x20Date\x20:\x20','json','batch_code','add_purchases\x20error','/view/add_purchases/:id','$product_details.product_name','then','params','add\x20post','currency_placement','</body></html>','DRY\x20STORAGE','<!DOCTYPE\x20html>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','5435690xhQNhX','actual_qty','concat','$note','expiry_date','message','edit_purchases','$product_details.floorlevel','169881nSQrjn','language','48zOoOQG','$suppliers_docs','paid_amount','$product.quantity','<hr\x20class=\x22my-3\x22>','</head><body>','stock_data','prod_unit','MaxStocks_data','floorlevel','aggregate','suppliers','rack','secondary_code_hide','Receiving\x20Area','JO_number','product_code_hide','prod_secondunit','get','table\x20page','primary_code_hide','$paid_amount','slice','toString','COLD\x20STORAGE','Portuguese','English\x20(US)','$_id','</thead>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<tr>','Hindi','master','delivery_code','$warehouse_name','all_purchases','find','getMonth','flash','Raw\x20Materials','../models/all_models','/view/return_purchase/:id','Enabled','</td>','role','$product_details.rack','prod_invoice','production_date','36YZMGBu','redirect','$batch_code','alertQTY','maxStocks','back','getDate','True'];a0_0x1ae5=function(){return _0x35bbc5;};return a0_0x1ae5();}router[a0_0x444c49(0x132)](a0_0x444c49(0x1d5),auth,async(_0x815e1d,_0x194132)=>{var _0x2f4ee2=a0_0x444c49;try{const {username:_0x51bcc5,email:_0x1912da,role:_0x24349a}=_0x815e1d['user'],_0xd32b7b=_0x815e1d['user'],_0x51c7e1=await profile['findOne']({'email':_0xd32b7b['email']}),_0x4e997b=await master_shop[_0x2f4ee2(0x144)](),_0x128c64=await staff[_0x2f4ee2(0x1f2)]({'email':_0xd32b7b['email']}),_0x3b0f69=await suppliers['find']({});let _0x27e640;if(_0xd32b7b[_0x2f4ee2(0x14c)]==_0x2f4ee2(0x172)){const _0x10e207=await staff[_0x2f4ee2(0x1f2)]({'email':_0xd32b7b[_0x2f4ee2(0x20c)]});_0x27e640=await warehouse[_0x2f4ee2(0x12a)]([{'$match':{'status':_0x2f4ee2(0x14a),'name':_0x10e207['warehouse'],'warehouse_category':_0x2f4ee2(0x147),'name':{'$ne':_0x2f4ee2(0x15d)}}},{'$group':{'_id':_0x2f4ee2(0x207),'name':{'$first':'$name'}}}]);}else _0x27e640=await warehouse[_0x2f4ee2(0x12a)]([{'$match':{'status':_0x2f4ee2(0x14a),'warehouse_category':_0x2f4ee2(0x147),'name':{'$ne':_0x2f4ee2(0x15d)}}},{'$group':{'_id':_0x2f4ee2(0x207),'name':{'$first':_0x2f4ee2(0x207)}}}]);const _0x5c5384=await product['find']({}),_0x3de106=await warehouse[_0x2f4ee2(0x144)]({'status':_0x2f4ee2(0x14a)}),_0x2dbb72=await purchases[_0x2f4ee2(0x144)]({}),_0x509b32=_0x2dbb72[_0x2f4ee2(0x15e)]+0x1,_0x4b1b54=_0x2f4ee2(0x195)+_0x509b32[_0x2f4ee2(0x137)]()['padStart'](0x5,'0');var _0x386788=[_0x2f4ee2(0x1ab),_0x2f4ee2(0x16f)];if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]==_0x2f4ee2(0x13a))var _0x16d29d=users[_0x2f4ee2(0x1b0)];else{if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]=='Hindi')var _0x16d29d=users[_0x2f4ee2(0x13f)];else{if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]==_0x2f4ee2(0x206))var _0x16d29d=users[_0x2f4ee2(0x206)];else{if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]==_0x2f4ee2(0x1ea))var _0x16d29d=users[_0x2f4ee2(0x1ea)];else{if(_0x4e997b[0x0]['language']==_0x2f4ee2(0x1c5))var _0x16d29d=users[_0x2f4ee2(0x1c5)];else{if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]==_0x2f4ee2(0x1a1))var _0x16d29d=users[_0x2f4ee2(0x139)];else{if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]=='Chinese')var _0x16d29d=users['Chinese'];else{if(_0x4e997b[0x0][_0x2f4ee2(0x11f)]==_0x2f4ee2(0x177))var _0x16d29d=users['Arabic'];}}}}}}}const _0x319ca4=getRandom8DigitNumber();_0x319ca4['then'](_0x3ef77e=>{var _0x3b914f=_0x2f4ee2;_0x194132['render'](_0x3b914f(0x169),{'success':_0x815e1d['flash'](_0x3b914f(0x18c)),'errors':_0x815e1d[_0x3b914f(0x146)](_0x3b914f(0x19b)),'role':_0xd32b7b,'profile':_0x51c7e1,'suppliers':_0x3b0f69,'warehouse':_0x27e640,'product':_0x5c5384,'invoice':_0x3ef77e,'master_shop':_0x4e997b,'language':_0x16d29d,'find_data':_0x3de106,'rooms_data':_0x386788});})[_0x2f4ee2(0x1a2)](_0x1e0bbb=>{var _0x5ac99c=_0x2f4ee2;_0x815e1d[_0x5ac99c(0x146)](_0x5ac99c(0x19b),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x194132[_0x5ac99c(0x151)](_0x5ac99c(0x1c2));});}catch(_0x3b052e){console[_0x2f4ee2(0x1d3)](_0x3b052e);}}),router['get'](a0_0x444c49(0x227),auth,async(_0x2f3e21,_0x5cc144)=>{var _0x141414=a0_0x444c49;try{const _0x576587=_0x2f3e21[_0x141414(0x22a)]['id'];console[_0x141414(0x1d3)](_0x576587);const _0x5dd315=await master_shop[_0x141414(0x144)]();console[_0x141414(0x1d3)](_0x141414(0x140),_0x5dd315);const _0x4d5747=await product['findOne']({'name':_0x576587});console['log']('product',_0x4d5747),_0x5cc144[_0x141414(0x1b8)](0xc8)[_0x141414(0x224)]({'product_data':_0x4d5747,'master':_0x5dd315});}catch(_0x19d41f){console['log'](_0x141414(0x226),_0x19d41f);}}),router[a0_0x444c49(0x1c0)]('/view/add_purchases',auth,async(_0x31fd2a,_0x47f87f)=>{var _0x1fd032=a0_0x444c49;try{const {invoice:_0x2b4c93,date:_0x2ddabb,warehouse_name:_0x5e7002,prod_name:_0x4b64f2,prod_code:_0x485a18,prod_qty:_0x3eba44,prod_unit:_0x1c0853,prod_secondunit:_0x1a11a8,prod_level:_0x328fc7,prod_isle:_0x1ace30,prod_pallet:_0x448b57,note:_0x2ae0e7,expiry_date:_0x16c4f9,batch_code:_0x174f8b,payable:_0x4001d0,due_amount:_0x24241e,Room_name:_0x3660f6,primary_code:_0x517854,secondary_code:_0x5df82d,MaxStocks_data:_0x21bbc7,PO_number:_0x301cd0,SCRN:_0x49c81c,JO_number:_0x3b73b2}=_0x31fd2a[_0x1fd032(0x179)];if(typeof _0x4b64f2==_0x1fd032(0x222))var _0x5eb3c0=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x1c1)]],_0x19eeda=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x1ac)]],_0x37d05b=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x176)]],_0x53c53a=[_0x31fd2a['body']['prod_primunit']],_0xac5b9e=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x131)]],_0xf2a12b=[_0x31fd2a['body'][_0x1fd032(0x159)]],_0x1fc1dd=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x1d1)]],_0x315a66=[_0x31fd2a[_0x1fd032(0x179)]['secondary_code']],_0x231dc7=[_0x31fd2a[_0x1fd032(0x179)]['MaxStocks_data']],_0x57dc50=[_0x31fd2a['body'][_0x1fd032(0x225)]],_0x1fa706=[_0x31fd2a['body']['expiry_date']],_0xec6176=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x1d7)]],_0x2266ad=[_0x31fd2a[_0x1fd032(0x179)]['alertQTY']],_0x2cf7cd=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x14f)]],_0x35b5a9=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x16e)]],_0x177542=[_0x31fd2a['body']['RoomAssign']],_0x26808b=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x1df)]],_0x4a29b3=[_0x31fd2a['body'][_0x1fd032(0x14e)]],_0x1a659d=[_0x31fd2a['body'][_0x1fd032(0x232)]],_0x2c0c87=[_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x221)]];else var _0x5eb3c0=[..._0x31fd2a['body'][_0x1fd032(0x1c1)]],_0x19eeda=[..._0x31fd2a['body']['prod_code']],_0x37d05b=[..._0x31fd2a['body'][_0x1fd032(0x176)]],_0x53c53a=[..._0x31fd2a['body'][_0x1fd032(0x18f)]],_0xac5b9e=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x131)]],_0xf2a12b=[..._0x31fd2a['body'][_0x1fd032(0x159)]],_0x1fc1dd=[..._0x31fd2a[_0x1fd032(0x179)]['primary_code']],_0x315a66=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x185)]],_0x231dc7=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x128)]],_0x57dc50=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x225)]],_0x1fa706=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x235)]],_0xec6176=[..._0x31fd2a[_0x1fd032(0x179)]['max_product_unit']],_0x2266ad=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x153)]],_0x2cf7cd=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x14f)]],_0x35b5a9=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x16e)]],_0x177542=[..._0x31fd2a[_0x1fd032(0x179)]['RoomAssign']],_0x26808b=[..._0x31fd2a[_0x1fd032(0x179)]['deliverycode']],_0x4a29b3=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x14e)]],_0x1a659d=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x232)]],_0x2c0c87=[..._0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x221)]];const _0x2ee60f=_0x5eb3c0[_0x1fd032(0x21a)](_0x3810b6=>{return _0x3810b6={'product_name':_0x3810b6};});_0x1a659d[_0x1fd032(0x1b9)]((_0x47f78f,_0x498b74)=>{var _0x3882ee=_0x1fd032;_0x2ee60f[_0x498b74][_0x3882ee(0x232)]=Math[_0x3882ee(0x18a)](_0x47f78f);}),_0x2c0c87[_0x1fd032(0x1b9)]((_0x50015f,_0x3a2081)=>{_0x2ee60f[_0x3a2081]['actual_uom']=_0x50015f;}),_0x19eeda[_0x1fd032(0x1b9)]((_0x42cf18,_0x38807f)=>{_0x2ee60f[_0x38807f]['product_code']=_0x42cf18;}),_0x37d05b[_0x1fd032(0x1b9)]((_0x1ac280,_0x462a26)=>{_0x2ee60f[_0x462a26]['quantity']=Math['abs'](_0x1ac280);}),_0x53c53a['forEach']((_0x28447a,_0x1f51c9)=>{_0x2ee60f[_0x1f51c9]['standard_unit']=_0x28447a;}),_0xac5b9e['forEach']((_0x3e9097,_0x24a80c)=>{var _0x4827af=_0x1fd032;_0x2ee60f[_0x24a80c][_0x4827af(0x200)]=_0x3e9097;}),_0xf2a12b[_0x1fd032(0x1b9)]((_0x3784a6,_0x4289a8)=>{var _0x59b019=_0x1fd032;_0x177542[_0x59b019(0x1b9)]((_0x4f1546,_0x420c36)=>{var _0x40eb5e=_0x59b019;if(_0x4f1546==_0x40eb5e(0x12e)&&_0x4289a8==_0x420c36){console['log'](_0x4f1546+'\x20<\x20wew\x20>\x20'+_0x4289a8+_0x40eb5e(0x1fc)+_0x420c36+'\x20<>\x20'+_0x3784a6);var _0x468177=_0x3784a6[_0x40eb5e(0x136)](0x3);_0x2ee60f[_0x4289a8][_0x40eb5e(0x1ee)]=_0x3784a6[0x0],_0x2ee60f[_0x4289a8][_0x40eb5e(0x12c)]=_0x3784a6[0x1],_0x2ee60f[_0x4289a8][_0x40eb5e(0x20b)]=0x0,_0x2ee60f[_0x4289a8][_0x40eb5e(0x1c3)]=0x0,_0x2ee60f[_0x4289a8][_0x40eb5e(0x1e4)]='Floor',_0x2ee60f[_0x4289a8]['floorlevel']=_0x468177;}else{if(_0x4f1546=='Shelves'&&_0x4289a8==_0x420c36){var _0x468177=_0x3784a6[_0x40eb5e(0x136)](0x3);_0x2ee60f[_0x4289a8][_0x40eb5e(0x1ee)]=_0x3784a6[0x0],_0x2ee60f[_0x4289a8][_0x40eb5e(0x12c)]=_0x3784a6[0x1],_0x2ee60f[_0x4289a8][_0x40eb5e(0x20b)]=0x0,_0x2ee60f[_0x4289a8][_0x40eb5e(0x1c3)]=0x0,_0x2ee60f[_0x4289a8][_0x40eb5e(0x1e4)]=_0x40eb5e(0x1cc),_0x2ee60f[_0x4289a8][_0x40eb5e(0x129)]=_0x3784a6[0x5];}else{if(_0x4289a8==_0x420c36){if(_0x3784a6[0x0]=='A'&&_0x3784a6[0x1]=='L'&&_0x3784a6[0x2]=='L')console[_0x40eb5e(0x1d3)](_0x4f1546+_0x40eb5e(0x1fc)+_0x4289a8+_0x40eb5e(0x1fc)+_0x420c36+'\x20<>\x20'+_0x3784a6+'here'),_0x2ee60f[_0x4289a8]['storage']=_0x3784a6[0x0],_0x2ee60f[_0x4289a8][_0x40eb5e(0x12c)]=_0x3784a6[0x1],_0x2ee60f[_0x4289a8][_0x40eb5e(0x20b)]=0x0,_0x2ee60f[_0x4289a8][_0x40eb5e(0x1c3)]=0x0,_0x2ee60f[_0x4289a8][_0x40eb5e(0x1e4)]=_0x40eb5e(0x1cc),_0x2ee60f[_0x4289a8]['floorlevel']=_0x3784a6[0x3];else{var _0xc8d0ac;if(_0x3784a6[0x4]=='L')_0xc8d0ac=_0x40eb5e(0x18d);else _0x3784a6[0x4]=='F'&&(_0xc8d0ac='Floor');_0x2ee60f[_0x4289a8][_0x40eb5e(0x1ee)]=_0x3784a6[0x0],_0x2ee60f[_0x4289a8][_0x40eb5e(0x12c)]=_0x3784a6[0x1],_0x2ee60f[_0x4289a8][_0x40eb5e(0x20b)]=_0x3784a6[0x2],_0x2ee60f[_0x4289a8][_0x40eb5e(0x1c3)]=_0x3784a6[0x3],_0x2ee60f[_0x4289a8][_0x40eb5e(0x1e4)]=_0xc8d0ac,_0x2ee60f[_0x4289a8][_0x40eb5e(0x129)]=_0x3784a6[0x5];}}}}});}),_0x1fc1dd[_0x1fd032(0x1b9)]((_0x1f2769,_0x17cc77)=>{var _0x43af8c=_0x1fd032;_0x2ee60f[_0x17cc77][_0x43af8c(0x1d1)]=_0x1f2769;}),_0x315a66[_0x1fd032(0x1b9)]((_0x5dbc6f,_0x51936f)=>{_0x2ee60f[_0x51936f]['secondary_code']=_0x5dbc6f;}),_0x231dc7[_0x1fd032(0x1b9)]((_0x415fe1,_0x4bd902)=>{var _0x560fa2=_0x1fd032;_0x2ee60f[_0x4bd902][_0x560fa2(0x154)]=_0x415fe1;}),_0x57dc50['forEach']((_0x4b11a8,_0x345fe7)=>{var _0x55019c=_0x1fd032;_0x2ee60f[_0x345fe7][_0x55019c(0x225)]=_0x4b11a8;}),_0x1fa706['forEach']((_0xb0c55,_0x1ea987)=>{var _0xe1ce0a=_0x1fd032;_0x2ee60f[_0x1ea987][_0xe1ce0a(0x235)]=_0xb0c55;}),_0xec6176[_0x1fd032(0x1b9)]((_0x445999,_0x4da3c7)=>{var _0x1e1eca=_0x1fd032;_0x2ee60f[_0x4da3c7][_0x1e1eca(0x194)]=_0x445999;}),_0x2266ad['forEach']((_0x3a720a,_0x4ebdef)=>{_0x2ee60f[_0x4ebdef]['alertQTY']=_0x3a720a;}),_0x2cf7cd[_0x1fd032(0x1b9)]((_0x32828b,_0x2823fb)=>{var _0x313298=_0x1fd032;_0x2ee60f[_0x2823fb][_0x313298(0x14f)]=_0x32828b;}),_0x35b5a9[_0x1fd032(0x1b9)]((_0x444011,_0x5066ea)=>{var _0x43b71a=_0x1fd032;_0x2ee60f[_0x5066ea][_0x43b71a(0x1fe)]=_0x444011;}),_0x177542[_0x1fd032(0x1b9)]((_0x52470e,_0x1754b9)=>{var _0x15583=_0x1fd032;_0x2ee60f[_0x1754b9][_0x15583(0x1ca)]=_0x52470e;}),_0x26808b[_0x1fd032(0x1b9)]((_0x312645,_0x3743c3)=>{var _0x1dc854=_0x1fd032;_0x2ee60f[_0x3743c3][_0x1dc854(0x141)]=_0x312645;}),_0x4a29b3[_0x1fd032(0x1b9)]((_0x4d2e48,_0x54f537)=>{var _0x22ca48=_0x1fd032;_0x2ee60f[_0x54f537][_0x22ca48(0x187)]=_0x4d2e48;});const _0x179701=_0x177542[_0x1fd032(0x21a)](_0x444c18=>{return _0x444c18={'room_name':_0x444c18};}),_0x51c507=_0x2ee60f['filter'](_0x2b168d=>_0x2b168d[_0x1fd032(0x1f8)]!=='0'&&_0x2b168d[_0x1fd032(0x1f8)]!==''),_0x52a77a=new purchases({'invoice':_0x2b4c93,'suppliers':_0x31fd2a[_0x1fd032(0x179)][_0x1fd032(0x12b)],'date':_0x2ddabb,'warehouse_name':_0x5e7002,'product':_0x51c507,'note':_0x2ae0e7,'due_amount':_0x24241e,'POnumber':_0x301cd0,'SCRN':_0x49c81c,'JO_number':_0x3b73b2,'roomList':_0x179701}),_0x1c1ced=await _0x52a77a[_0x1fd032(0x192)](),_0xd37efb=await purchases['findOne']({'invoice':_0x2b4c93}),_0x372aad=_0xd37efb[_0x1fd032(0x1f4)]['map'](async _0x5ae20b=>{var _0x2b9ccc=_0x1fd032,_0x5d8909=await warehouse[_0x2b9ccc(0x1f2)]({'name':_0x5e7002,'room':_0x5ae20b['room_name']}),_0x1e94b2=0x0;return _0x5d8909[_0x2b9ccc(0x1fd)][_0x2b9ccc(0x1b9)](_0x40b97e=>{var _0x5e8e3a=_0x2b9ccc;_0x40b97e[_0x5e8e3a(0x217)]==_0x5ae20b['product_name']&&_0x40b97e['floorlevel']==_0x5ae20b['floorlevel']&&_0x40b97e['type']==_0x5ae20b[_0x5e8e3a(0x1e4)]&&_0x40b97e[_0x5e8e3a(0x1c3)]==_0x5ae20b['bin']&&_0x40b97e[_0x5e8e3a(0x20b)]==_0x5ae20b[_0x5e8e3a(0x20b)]&&_0x40b97e[_0x5e8e3a(0x12c)]==_0x5ae20b['rack']&&_0x40b97e[_0x5e8e3a(0x1ee)]==_0x5ae20b['storage']&&_0x40b97e[_0x5e8e3a(0x235)]==_0x5ae20b[_0x5e8e3a(0x235)]&&_0x40b97e[_0x5e8e3a(0x225)]==_0x5ae20b['batch_code']&&_0x40b97e[_0x5e8e3a(0x14f)]==_0x5ae20b['production_date']&&_0x40b97e['invoice']==_0xd37efb[_0x5e8e3a(0x187)]&&(_0x40b97e[_0x5e8e3a(0x16b)]+=Math[_0x5e8e3a(0x18a)](_0x5ae20b['quantity']),_0x1e94b2++);}),_0x1e94b2===0x0&&_0x5d8909[_0x2b9ccc(0x1fd)]['push']({'product_name':_0x5ae20b[_0x2b9ccc(0x217)],'product_stock':Math[_0x2b9ccc(0x18a)](_0x5ae20b[_0x2b9ccc(0x1f8)]),'primary_code':_0x5ae20b[_0x2b9ccc(0x1d1)],'secondary_code':_0x5ae20b[_0x2b9ccc(0x185)],'product_code':_0x5ae20b[_0x2b9ccc(0x1f1)],'storage':_0x5ae20b[_0x2b9ccc(0x1ee)],'rack':_0x5ae20b[_0x2b9ccc(0x12c)],'bay':_0x5ae20b[_0x2b9ccc(0x20b)],'bin':_0x5ae20b['bin'],'type':_0x5ae20b[_0x2b9ccc(0x1e4)],'floorlevel':_0x5ae20b[_0x2b9ccc(0x129)],'maxProducts':_0x5ae20b[_0x2b9ccc(0x154)],'unit':_0x5ae20b[_0x2b9ccc(0x184)],'secondary_unit':_0x5ae20b[_0x2b9ccc(0x200)],'expiry_date':_0x5ae20b[_0x2b9ccc(0x235)],'maxPerUnit':_0x5ae20b[_0x2b9ccc(0x194)],'batch_code':_0x5ae20b[_0x2b9ccc(0x225)],'alertQTY':_0x5ae20b[_0x2b9ccc(0x153)],'production_date':_0x5ae20b[_0x2b9ccc(0x14f)],'product_cat':_0x5ae20b[_0x2b9ccc(0x1fe)],'invoice':_0x5ae20b[_0x2b9ccc(0x187)],'actual_qty':Math[_0x2b9ccc(0x18a)](_0x5ae20b[_0x2b9ccc(0x232)]),'actual_uom':_0x5ae20b[_0x2b9ccc(0x221)]}),_0x5d8909;});Promise[_0x1fd032(0x210)](_0x372aad)[_0x1fd032(0x229)](async _0x35e1fa=>{var _0x5d9983=_0x1fd032;try{for(const _0x68e24b of _0x35e1fa){await _0x68e24b[_0x5d9983(0x192)]();}const _0xebfb46=await master_shop[_0x5d9983(0x144)](),_0x553ad5=await email_settings[_0x5d9983(0x1f2)](),_0x32e44f=await supervisor_settings['find']();var _0xd25e8e=_0xd37efb['product'],_0x12deeb='',_0xd5d329;for(_0xd5d329 in _0xd25e8e){_0x12deeb+=_0x5d9983(0x13e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd25e8e[_0xd5d329][_0x5d9983(0x217)]+'</td>'+_0x5d9983(0x214)+_0xd25e8e[_0xd5d329][_0x5d9983(0x1f1)]+_0x5d9983(0x14b)+_0x5d9983(0x214)+_0xd25e8e[_0xd5d329][_0x5d9983(0x1f8)]+_0x5d9983(0x14b)+_0x5d9983(0x214)+_0xd25e8e[_0xd5d329]['standard_unit']+_0x5d9983(0x14b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd25e8e[_0xd5d329][_0x5d9983(0x200)]+_0x5d9983(0x14b)+_0x5d9983(0x214)+_0xd37efb[_0x5d9983(0x1d2)]+_0x5d9983(0x14b)+_0x5d9983(0x214)+_0xd25e8e[_0xd5d329][_0x5d9983(0x1ca)]+_0x5d9983(0x14b)+_0x5d9983(0x214)+_0xd25e8e[_0xd5d329]['storage']+_0xd25e8e[_0xd5d329][_0x5d9983(0x12c)]+_0xd25e8e[_0xd5d329]['bay']+_0xd25e8e[_0xd5d329][_0x5d9983(0x1c3)]+_0xd25e8e[_0xd5d329][_0x5d9983(0x1e4)][0x0]+_0xd25e8e[_0xd5d329][_0x5d9983(0x129)]+_0x5d9983(0x14b),'</tr>';}let _0x380fb8=nodemailer[_0x5d9983(0x1e7)]({'host':_0x553ad5[_0x5d9983(0x193)],'port':Number(_0x553ad5[_0x5d9983(0x165)]),'secure':![],'auth':{'user':_0x553ad5[_0x5d9983(0x20c)],'pass':_0x553ad5['password']}}),_0x3a5d20={'from':_0x553ad5[_0x5d9983(0x20c)],'to':_0x32e44f[0x0][_0x5d9983(0x1d4)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x5d9983(0x20e),'path':__dirname+'/../public'+_0x5d9983(0x17f)+_0xebfb46[0x0][_0x5d9983(0x19a)],'cid':_0x5d9983(0x1f5)}],'html':_0x5d9983(0x22f)+_0x5d9983(0x1a0)+'</head><body>'+'<div>'+_0x5d9983(0x186)+_0x5d9983(0x21f)+_0x5d9983(0x162)+_0x5d9983(0x1ba)+_0x5d9983(0x21f)+_0x5d9983(0x17d)+_0xebfb46[0x0]['site_title']+_0x5d9983(0x1c9)+_0x5d9983(0x1ba)+_0x5d9983(0x1ba)+_0x5d9983(0x124)+_0x5d9983(0x21f)+_0x5d9983(0x203)+_0x5d9983(0x1c6)+_0xd37efb[_0x5d9983(0x187)]+'\x20'+_0x5d9983(0x1af)+_0x5d9983(0x223)+_0xd37efb['date']+'\x20'+_0x5d9983(0x1e0)+'</h5>'+_0x5d9983(0x1ba)+_0x5d9983(0x13d)+_0x5d9983(0x20a)+_0x5d9983(0x13e)+_0x5d9983(0x160)+_0x5d9983(0x1b4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5d9983(0x1ec)+_0x5d9983(0x19e)+_0x5d9983(0x1aa)+_0x5d9983(0x1bc)+'</tr>'+_0x5d9983(0x13c)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x12deeb+'\x20'+_0x5d9983(0x1a6)+_0x5d9983(0x178)+_0x5d9983(0x21f)+'<strong>\x20Regards\x20</strong>'+_0x5d9983(0x1d0)+_0xebfb46[0x0][_0x5d9983(0x1d8)]+'</h5>'+'</div>'+_0x5d9983(0x1ba)+_0x5d9983(0x22d)};_0x380fb8[_0x5d9983(0x15b)](_0x3a5d20,function(_0x59aece,_0x59132e){var _0x17b3b6=_0x5d9983;_0x59aece?(console[_0x17b3b6(0x1d3)](_0x59aece),console[_0x17b3b6(0x1d3)](_0x17b3b6(0x1a4))):console[_0x17b3b6(0x1d3)](_0x17b3b6(0x1eb));}),_0x31fd2a[_0x5d9983(0x146)](_0x5d9983(0x18c),_0x5d9983(0x1f0)),_0x47f87f['redirect'](_0x5d9983(0x205));}catch(_0x4e1f82){console[_0x5d9983(0x1fa)](_0x4e1f82),_0x47f87f[_0x5d9983(0x1b8)](0x1f4)[_0x5d9983(0x224)]({'error':_0x5d9983(0x1ae)});}})['catch'](_0x437d1d=>{var _0x118c5e=_0x1fd032;console['error'](_0x437d1d),_0x47f87f[_0x118c5e(0x1b8)](0x1f4)[_0x118c5e(0x224)]({'error':_0x118c5e(0x21c)});});}catch(_0x32ada0){console['log'](_0x32ada0);}}),router['get'](a0_0x444c49(0x170),auth,async(_0x25a503,_0x479dc9)=>{var _0x51adc0=a0_0x444c49;try{const {username:_0x5bffd0,email:_0x289e11,role:_0x5e122c}=_0x25a503[_0x51adc0(0x1c4)],_0x2462c2=_0x25a503[_0x51adc0(0x1c4)],_0x167042=await profile[_0x51adc0(0x1f2)]({'email':_0x2462c2['email']}),_0x12b4e0=await master_shop['find'](),_0x348cab=_0x25a503['params']['id'],_0x1e1ece=await purchases['findById'](_0x348cab),_0x44c11b=await warehouse[_0x51adc0(0x12a)]([{'$match':{'name':_0x1e1ece[_0x51adc0(0x1d2)],'room':_0x1e1ece['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x51adc0(0x1f6),'name':{'$first':_0x51adc0(0x228)},'product_stock':{'$first':_0x51adc0(0x1ff)},'bay':{'$first':_0x51adc0(0x15a)},'bin':{'$first':_0x51adc0(0x17e)},'type':{'$first':_0x51adc0(0x1ad)},'floorlevel':{'$first':_0x51adc0(0x238)},'primary_code':{'$first':_0x51adc0(0x216)},'secondary_code':{'$first':_0x51adc0(0x19d)},'product_code':{'$first':_0x51adc0(0x168)},'storage':{'$first':_0x51adc0(0x1f3)},'rack':{'$first':_0x51adc0(0x14d)},'expiry_date':{'$first':_0x51adc0(0x21e)}}}]),_0x2c1f69=await customer['find']({});let _0x55c161;if(_0x2462c2[_0x51adc0(0x14c)]==_0x51adc0(0x172)){const _0x4685bb=await staff[_0x51adc0(0x1f2)]({'email':_0x2462c2[_0x51adc0(0x20c)]});_0x55c161=await warehouse[_0x51adc0(0x12a)]([{'$match':{'status':'Enabled','name':_0x4685bb[_0x51adc0(0x19c)]}},{'$group':{'_id':_0x51adc0(0x207),'name':{'$first':'$name'}}}]);}else _0x55c161=await warehouse['aggregate']([{'$match':{'status':_0x51adc0(0x14a)}},{'$group':{'_id':_0x51adc0(0x207),'name':{'$first':_0x51adc0(0x207)}}}]);const _0x5dfd72=await product[_0x51adc0(0x144)]({}),_0x1b9c1a=await suppliers['find']({}),_0x3a9701=BayBinSelected(_0x1e1ece[_0x51adc0(0x1d2)],_0x1e1ece[_0x51adc0(0x174)]);if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x13a)){var _0x53b5d4=users[_0x51adc0(0x1b0)];console[_0x51adc0(0x1d3)](_0x53b5d4);}else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x13f))var _0x53b5d4=users['Hindi'];else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x206))var _0x53b5d4=users['German'];else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x1ea))var _0x53b5d4=users[_0x51adc0(0x1ea)];else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x1c5))var _0x53b5d4=users['French'];else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x1a1))var _0x53b5d4=users[_0x51adc0(0x139)];else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x1a8))var _0x53b5d4=users[_0x51adc0(0x1a8)];else{if(_0x12b4e0[0x0][_0x51adc0(0x11f)]==_0x51adc0(0x177))var _0x53b5d4=users[_0x51adc0(0x1da)];}}}}}}}_0x479dc9[_0x51adc0(0x188)](_0x51adc0(0x1e6),{'success':_0x25a503[_0x51adc0(0x146)](_0x51adc0(0x18c)),'errors':_0x25a503['flash'](_0x51adc0(0x19b)),'role':_0x2462c2,'profile':_0x167042,'customer':_0x2c1f69,'warehouse':_0x55c161,'product':_0x44c11b,'user':_0x1e1ece,'master_shop':_0x12b4e0,'unit':_0x5dfd72,'language':_0x53b5d4,'suppliers':_0x1b9c1a,'dataSelected':_0x3a9701});}catch(_0x382d49){console[_0x51adc0(0x1d3)](_0x382d49);}}),router['post'](a0_0x444c49(0x170),auth,async(_0x400a06,_0x5bda59)=>{var _0x449017=a0_0x444c49;try{const _0x2de396=_0x400a06['params']['id'],{invoice:_0x26f98c,warehouse_name:_0x4fb15a,Room_name:_0x4c74bb}=_0x400a06[_0x449017(0x179)],_0x527a2c=await warehouse['findOne']({'name':_0x4fb15a,'room':_0x4c74bb}),_0x534a70=await purchases[_0x449017(0x1f2)]({'invoice':_0x26f98c});_0x534a70[_0x449017(0x1f4)][_0x449017(0x1b9)](_0x112319=>{var _0x4fc665=_0x449017,_0x76a398=0x0;const _0xdd4941=_0x527a2c['product_details'][_0x4fc665(0x21a)](_0xfa049d=>{var _0x5676c7=_0x4fc665;_0xfa049d[_0x5676c7(0x217)]==_0x112319[_0x5676c7(0x217)]&&_0xfa049d[_0x5676c7(0x129)]==_0x112319[_0x5676c7(0x129)]&&_0xfa049d[_0x5676c7(0x1e4)]==_0x112319['type']&&_0xfa049d[_0x5676c7(0x1c3)]==_0x112319['bin']&&_0xfa049d['bay']==_0x112319['bay']&&_0xfa049d[_0x5676c7(0x12c)]==_0x112319[_0x5676c7(0x12c)]&&_0xfa049d[_0x5676c7(0x1ee)]==_0x112319[_0x5676c7(0x1ee)]&&_0xfa049d['expiry_date']==_0x112319['expiry_date']&&_0xfa049d[_0x5676c7(0x225)]==_0x112319[_0x5676c7(0x225)]&&_0xfa049d[_0x5676c7(0x14f)]==_0x112319[_0x5676c7(0x14f)]&&_0xfa049d[_0x5676c7(0x1bd)]==_0x112319['delivery_date']&&_0xfa049d[_0x5676c7(0x141)]==_0x112319[_0x5676c7(0x141)]&&(_0xfa049d[_0x5676c7(0x16b)]=parseInt(_0xfa049d[_0x5676c7(0x16b)])+parseInt(_0x112319[_0x5676c7(0x1f8)]),_0x76a398++);});_0x76a398=='0'&&(_0x527a2c['product_details']=_0x527a2c[_0x4fc665(0x1fd)][_0x4fc665(0x233)]({'product_name':_0x112319['product_name'],'product_stock':_0x112319['quantity'],'primary_code':_0x112319[_0x4fc665(0x1d1)],'secondary_code':_0x112319[_0x4fc665(0x185)],'product_code':_0x112319[_0x4fc665(0x1f1)],'storage':_0x112319['storage'],'rack':_0x112319[_0x4fc665(0x12c)],'bay':_0x112319[_0x4fc665(0x20b)],'bin':_0x112319[_0x4fc665(0x1c3)],'type':_0x112319[_0x4fc665(0x1e4)],'floorlevel':_0x112319[_0x4fc665(0x129)],'maxProducts':_0x112319[_0x4fc665(0x154)],'unit':_0x112319[_0x4fc665(0x184)],'secondary_unit':_0x112319[_0x4fc665(0x200)],'expiry_date':_0x112319[_0x4fc665(0x235)],'maxPerUnit':_0x112319['maxperunit'],'batch_code':_0x112319[_0x4fc665(0x225)],'alertQTY':_0x112319[_0x4fc665(0x153)],'production_date':_0x112319[_0x4fc665(0x14f)],'delivery_date':_0x112319['delivery_date'],'delivery_code':_0x112319[_0x4fc665(0x141)]}));}),await _0x527a2c[_0x449017(0x192)](),_0x534a70['finalize']=_0x449017(0x157);const _0x34ed6e=await _0x534a70['save']();_0x400a06[_0x449017(0x146)]('success',_0x449017(0x1e3)),_0x5bda59[_0x449017(0x151)]('/all_purchases/view');}catch(_0x14d0c9){console[_0x449017(0x1d3)](_0x14d0c9);}}),router[a0_0x444c49(0x132)](a0_0x444c49(0x1fb),auth,async(_0x25daae,_0x1df935)=>{var _0x2e1939=a0_0x444c49;try{const {username:_0xdaca20,email:_0x19b0fc,role:_0x10b17c}=_0x25daae[_0x2e1939(0x1c4)],_0x14c55f=_0x25daae[_0x2e1939(0x1c4)],_0x199f8d=await profile[_0x2e1939(0x1f2)]({'email':_0x14c55f[_0x2e1939(0x20c)]}),_0x52bd83=await master_shop[_0x2e1939(0x144)](),_0x3324e0=_0x25daae['params']['id'],_0x3e3e7d=await purchases['findById'](_0x3324e0),_0x537dd9=await suppliers[_0x2e1939(0x144)]({});let _0x3b684e;if(_0x14c55f['role']==_0x2e1939(0x172)){const _0x11d5f5=await staff[_0x2e1939(0x1f2)]({'email':_0x14c55f[_0x2e1939(0x20c)]});_0x3b684e=await warehouse['find']({'status':_0x2e1939(0x14a),'name':_0x11d5f5['warehouse'],'warehouse_category':'Raw\x20Materials'});}else _0x3b684e=await warehouse[_0x2e1939(0x12a)]([{'$match':{'status':_0x2e1939(0x14a),'warehouse_category':_0x2e1939(0x147)}},{'$group':{'_id':_0x2e1939(0x207),'name':{'$first':'$name'}}}]);const _0x5c467b=await product[_0x2e1939(0x144)]({}),_0x53928e=BayBinSelected(_0x3e3e7d['warehouse_name'],_0x3e3e7d[_0x2e1939(0x174)]);let _0x326dd8=new Date(_0x3e3e7d[_0x2e1939(0x235)]),_0xe0264f=('0'+_0x326dd8[_0x2e1939(0x156)]())[_0x2e1939(0x136)](-0x2),_0x26fed7=('0'+(_0x326dd8[_0x2e1939(0x145)]()+0x1))['slice'](-0x2),_0xafb4ef=_0x326dd8[_0x2e1939(0x158)](),_0x57f095=_0xafb4ef+'-'+_0x26fed7+'-'+_0xe0264f;if(_0x52bd83[0x0][_0x2e1939(0x11f)]==_0x2e1939(0x13a)){var _0x2a5fd7=users[_0x2e1939(0x1b0)];console[_0x2e1939(0x1d3)](_0x2a5fd7);}else{if(_0x52bd83[0x0][_0x2e1939(0x11f)]==_0x2e1939(0x13f))var _0x2a5fd7=users[_0x2e1939(0x13f)];else{if(_0x52bd83[0x0]['language']==_0x2e1939(0x206))var _0x2a5fd7=users[_0x2e1939(0x206)];else{if(_0x52bd83[0x0][_0x2e1939(0x11f)]=='Spanish')var _0x2a5fd7=users['Spanish'];else{if(_0x52bd83[0x0][_0x2e1939(0x11f)]==_0x2e1939(0x1c5))var _0x2a5fd7=users[_0x2e1939(0x1c5)];else{if(_0x52bd83[0x0][_0x2e1939(0x11f)]==_0x2e1939(0x1a1))var _0x2a5fd7=users[_0x2e1939(0x139)];else{if(_0x52bd83[0x0]['language']==_0x2e1939(0x1a8))var _0x2a5fd7=users[_0x2e1939(0x1a8)];else{if(_0x52bd83[0x0]['language']==_0x2e1939(0x177))var _0x2a5fd7=users[_0x2e1939(0x1da)];}}}}}}}_0x1df935['render'](_0x2e1939(0x237),{'success':_0x25daae['flash']('success'),'errors':_0x25daae['flash']('errors'),'role':_0x14c55f,'profile':_0x199f8d,'purchases':_0x3e3e7d,'suppliers':_0x537dd9,'warehouse':_0x3b684e,'product':_0x5c467b,'master_shop':_0x52bd83,'language':_0x2a5fd7,'ed_fullDate':_0x57f095,'dataSelected':_0x53928e});}catch(_0x33c0ba){console[_0x2e1939(0x1d3)](_0x33c0ba);}}),router[a0_0x444c49(0x1c0)](a0_0x444c49(0x1fb),auth,async(_0x29086d,_0x408e60)=>{var _0x3330ac=a0_0x444c49;try{const _0x2db556=_0x29086d[_0x3330ac(0x22a)]['id'],_0x474e2d=await purchases[_0x3330ac(0x1f2)]({'_id':_0x29086d[_0x3330ac(0x22a)]['id']}),_0x9da9f2=await warehouse[_0x3330ac(0x1f2)]({'name':_0x474e2d['warehouse_name'],'room':_0x474e2d[_0x3330ac(0x174)]});_0x474e2d[_0x3330ac(0x1f4)][_0x3330ac(0x1b9)](_0x1c704a=>{var _0x1fc5e5=_0x3330ac;const _0x2348b2=_0x9da9f2[_0x1fc5e5(0x1fd)]['map'](_0x122068=>{var _0x1c2ee3=_0x1fc5e5;_0x122068[_0x1c2ee3(0x217)]==_0x1c704a[_0x1c2ee3(0x217)]&&_0x122068[_0x1c2ee3(0x129)]==_0x1c704a[_0x1c2ee3(0x129)]&&_0x122068[_0x1c2ee3(0x1e4)]==_0x1c704a[_0x1c2ee3(0x1e4)]&&_0x122068[_0x1c2ee3(0x1c3)]==_0x1c704a[_0x1c2ee3(0x1c3)]&&_0x122068[_0x1c2ee3(0x20b)]==_0x1c704a['bay']&&_0x122068[_0x1c2ee3(0x12c)]==_0x1c704a['rack']&&_0x122068[_0x1c2ee3(0x1ee)]==_0x1c704a[_0x1c2ee3(0x1ee)]&&(_0x122068[_0x1c2ee3(0x16b)]=parseInt(_0x122068[_0x1c2ee3(0x16b)])-parseInt(_0x1c704a[_0x1c2ee3(0x1f8)]));});}),await _0x9da9f2[_0x3330ac(0x192)]();const {invoice:_0x29dbc2,suppliers:_0x436ee5,date:_0x4e8e58,warehouse_name:_0x7c43d1,prod_name:_0x23bf4e,prod_code:_0x35d13d,prod_qty:_0x1aab8d,prod_unit:_0x4a2f63,prod_secondunit:_0x849464,prod_level:_0x132b02,prod_isle:_0x514377,prod_pallet:_0x15fd34,note:_0x3b1b7e,expiry_date:_0x5d8fc0,batch_code:_0x43d215,paid_amount:_0x26b601,due_amount:_0x38340f,Room_name:_0x24feed,primary_code:_0x2abcc3,secondary_code:_0x1889bc,PO_number:_0x85573,JO_number:_0x46ccd2}=_0x29086d['body'];if(typeof _0x23bf4e=='string')var _0x176989=[_0x29086d[_0x3330ac(0x179)]['prod_name']],_0x5ed7e5=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1ac)]],_0x4ba009=[_0x29086d[_0x3330ac(0x179)]['prod_qty']],_0x228fbe=[_0x29086d['body'][_0x3330ac(0x127)]],_0x83695=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x131)]],_0x17baa1=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x159)]],_0x1b7088=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1b6)]],_0x2ba6eb=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x218)]],_0x17e7f0=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1d1)]],_0x5e7567=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x185)]],_0x1a5c2e=[_0x29086d['body']['MaxStocks_data']],_0x2e0c52=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x225)]],_0x23ee5e=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x235)]],_0x3a3a85=[_0x29086d['body'][_0x3330ac(0x1ee)]],_0x1f6d2b=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1b1)]],_0x150797=[_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1e4)]];else var _0x176989=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1c1)]],_0x5ed7e5=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1ac)]],_0x4ba009=[..._0x29086d[_0x3330ac(0x179)]['prod_qty']],_0x228fbe=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x127)]],_0x83695=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x131)]],_0x17baa1=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x159)]],_0x1b7088=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1b6)]],_0x2ba6eb=[..._0x29086d['body'][_0x3330ac(0x218)]],_0x17e7f0=[..._0x29086d[_0x3330ac(0x179)]['primary_code']],_0x5e7567=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x185)]],_0x1a5c2e=[..._0x29086d[_0x3330ac(0x179)][_0x3330ac(0x128)]],_0x2e0c52=[..._0x29086d[_0x3330ac(0x179)]['batch_code']],_0x23ee5e=[..._0x29086d['body'][_0x3330ac(0x235)]],_0x3a3a85=[..._0x29086d['body']['storage']],_0x1f6d2b=[..._0x29086d['body'][_0x3330ac(0x1b1)]],_0x150797=[..._0x29086d[_0x3330ac(0x179)]['type']];const _0xe4dd7=_0x176989[_0x3330ac(0x21a)](_0x1d6549=>{return _0x1d6549={'product_name':_0x1d6549};});_0x5ed7e5[_0x3330ac(0x1b9)]((_0x1f32b0,_0x32344e)=>{_0xe4dd7[_0x32344e]['product_code']=_0x1f32b0;}),_0x4ba009[_0x3330ac(0x1b9)]((_0x5bbf4d,_0x2fe61e)=>{var _0xc4888b=_0x3330ac;_0xe4dd7[_0x2fe61e][_0xc4888b(0x1f8)]=_0x5bbf4d;}),_0x228fbe[_0x3330ac(0x1b9)]((_0xcc0687,_0x1de74b)=>{var _0x9e5475=_0x3330ac;_0xe4dd7[_0x1de74b][_0x9e5475(0x184)]=_0xcc0687;}),_0x83695['forEach']((_0xffb089,_0x3905d8)=>{_0xe4dd7[_0x3905d8]['secondary_unit']=_0xffb089;}),_0x17baa1['forEach']((_0x32f65b,_0x4b5ee8)=>{_0xe4dd7[_0x4b5ee8]['bay']=_0x32f65b;}),_0x1b7088[_0x3330ac(0x1b9)]((_0x1b7d5e,_0x153f96)=>{_0xe4dd7[_0x153f96]['bin']=_0x1b7d5e;}),_0x2ba6eb[_0x3330ac(0x1b9)]((_0x23f16f,_0x3706c9)=>{var _0x26f463=_0x3330ac;_0xe4dd7[_0x3706c9][_0x26f463(0x129)]=_0x23f16f;}),_0x17e7f0['forEach']((_0x15f879,_0x1743fa)=>{_0xe4dd7[_0x1743fa]['primary_code']=_0x15f879;}),_0x5e7567[_0x3330ac(0x1b9)]((_0x44a9a6,_0x12f996)=>{var _0x15f72b=_0x3330ac;_0xe4dd7[_0x12f996][_0x15f72b(0x185)]=_0x44a9a6;}),_0x1a5c2e[_0x3330ac(0x1b9)]((_0x4bf37e,_0x311bb6)=>{var _0xc8aa53=_0x3330ac;_0xe4dd7[_0x311bb6][_0xc8aa53(0x154)]=_0x4bf37e;}),_0x2e0c52['forEach']((_0x481a03,_0x47301a)=>{var _0x32a1d1=_0x3330ac;_0xe4dd7[_0x47301a][_0x32a1d1(0x225)]=_0x481a03;}),_0x23ee5e[_0x3330ac(0x1b9)]((_0x31399b,_0x3756c2)=>{_0xe4dd7[_0x3756c2]['expiry_date']=_0x31399b;}),_0x150797[_0x3330ac(0x1b9)]((_0x4e6e1b,_0x53750a)=>{var _0xe31dc8=_0x3330ac;_0xe4dd7[_0x53750a][_0xe31dc8(0x1e4)]=_0x4e6e1b;}),_0x3a3a85[_0x3330ac(0x1b9)]((_0x385a31,_0xa0800c)=>{var _0x1b4cf9=_0x3330ac;_0xe4dd7[_0xa0800c][_0x1b4cf9(0x1ee)]=_0x385a31;}),_0x1f6d2b[_0x3330ac(0x1b9)]((_0x1fee41,_0x2ecd2d)=>{_0xe4dd7[_0x2ecd2d]['rack']=_0x1fee41;});const _0x242d6d=_0xe4dd7['filter'](_0x50e737=>_0x50e737[_0x3330ac(0x1f8)]!=='0'&&_0x50e737['quantity']!=='');_0x474e2d['invoice']=_0x29dbc2,_0x474e2d['suppliers']=_0x436ee5,_0x474e2d[_0x3330ac(0x1c8)]=_0x4e8e58,_0x474e2d[_0x3330ac(0x1d2)]=_0x7c43d1,_0x474e2d['product']=_0x242d6d,_0x474e2d['note']=_0x3b1b7e,_0x474e2d[_0x3330ac(0x122)]=_0x26b601,_0x474e2d['due_amount']=_0x38340f,_0x474e2d[_0x3330ac(0x174)]=_0x24feed,_0x474e2d['POnumber']=_0x85573,_0x474e2d[_0x3330ac(0x12f)]=_0x46ccd2;const _0x1f721b=await _0x474e2d['save'](),_0x139622=await warehouse['findOne']({'name':_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x1d2)],'room':_0x29086d['body']['Room_name']});_0x474e2d[_0x3330ac(0x1f4)][_0x3330ac(0x1b9)](_0x4b2dbb=>{var _0xfc97b8=_0x3330ac,_0x51fc17=0x0;const _0x40c929=_0x139622['product_details']['map'](_0x12cc98=>{var _0x20984e=a0_0x436e;_0x12cc98[_0x20984e(0x217)]==_0x4b2dbb['product_name']&&_0x12cc98[_0x20984e(0x129)]==_0x4b2dbb['floorlevel']&&_0x12cc98[_0x20984e(0x1e4)]==_0x4b2dbb['type']&&_0x12cc98[_0x20984e(0x1c3)]==_0x4b2dbb[_0x20984e(0x1c3)]&&_0x12cc98[_0x20984e(0x20b)]==_0x4b2dbb[_0x20984e(0x20b)]&&_0x12cc98[_0x20984e(0x12c)]==_0x4b2dbb[_0x20984e(0x12c)]&&_0x12cc98[_0x20984e(0x1ee)]==_0x4b2dbb[_0x20984e(0x1ee)]&&(_0x12cc98[_0x20984e(0x16b)]=parseInt(_0x12cc98[_0x20984e(0x16b)])+parseInt(_0x4b2dbb[_0x20984e(0x1f8)]),_0x51fc17++);});_0x51fc17=='0'&&(_0x139622['product_details']=_0x139622[_0xfc97b8(0x1fd)][_0xfc97b8(0x233)]({'product_name':_0x4b2dbb['product_name'],'product_stock':_0x4b2dbb[_0xfc97b8(0x1f8)],'primary_code':_0x4b2dbb[_0xfc97b8(0x1d1)],'secondary_code':_0x4b2dbb['secondary_code'],'product_code':_0x4b2dbb[_0xfc97b8(0x1f1)],'storage':_0x4b2dbb['storage'],'rack':_0x4b2dbb[_0xfc97b8(0x12c)],'bay':_0x4b2dbb['bay'],'bin':_0x4b2dbb['bin'],'type':_0x4b2dbb[_0xfc97b8(0x1e4)],'floorlevel':_0x4b2dbb[_0xfc97b8(0x129)],'maxProducts':_0x4b2dbb[_0xfc97b8(0x154)],'unit':_0x4b2dbb[_0xfc97b8(0x184)],'secondary_unit':_0x4b2dbb[_0xfc97b8(0x200)],'expiry_date':_0x4b2dbb[_0xfc97b8(0x235)]}));}),await _0x139622[_0x3330ac(0x192)]();const _0x5ae957=await s_payment_data[_0x3330ac(0x1f2)]({'invoice':_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x187)]});if(_0x5ae957===null){}else console[_0x3330ac(0x1d3)](_0x3330ac(0x12b),_0x5ae957,_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x187)]),_0x5ae957[_0x3330ac(0x12b)]=_0x29086d[_0x3330ac(0x179)][_0x3330ac(0x12b)],await _0x5ae957[_0x3330ac(0x192)]();_0x29086d['flash'](_0x3330ac(0x18c),_0x3330ac(0x191)),_0x408e60[_0x3330ac(0x151)](_0x3330ac(0x1c2));}catch(_0x34d2b4){console[_0x3330ac(0x1d3)](_0x34d2b4);}}),router[a0_0x444c49(0x1c0)](a0_0x444c49(0x209),auth,async(_0x258964,_0x29cb90)=>{var _0x120bb3=a0_0x444c49;try{const _0x4fbdc6=_0x258964['params']['id'],{invoice:_0x57f75d,suppliers:_0x295817,payable:_0x279398,due_amount:_0x2dc726}=_0x258964[_0x120bb3(0x179)],_0x5006e4=await purchases[_0x120bb3(0x166)](_0x4fbdc6);var _0x2c4731=_0x279398-_0x2dc726;_0x5006e4[_0x120bb3(0x122)]=parseFloat(_0x5006e4['paid_amount'])+parseFloat(_0x2dc726),_0x5006e4['due_amount']=_0x2c4731;const _0x25d200=await _0x5006e4[_0x120bb3(0x192)]();console[_0x120bb3(0x1d3)](_0x25d200);const _0xe03d32=await s_payment_data[_0x120bb3(0x1f2)]({'invoice':_0x57f75d});_0xe03d32[_0x120bb3(0x1cf)]=_0x2c4731,await _0xe03d32['save']();let _0x5be2dd=new Date(),_0x39d8e3=('0'+_0x5be2dd[_0x120bb3(0x156)]())[_0x120bb3(0x136)](-0x2),_0xa78956=('0'+(_0x5be2dd['getMonth']()+0x1))[_0x120bb3(0x136)](-0x2),_0x14a151=_0x5be2dd[_0x120bb3(0x158)](),_0xcb12a5=_0x14a151+'-'+_0xa78956+'-'+_0x39d8e3;const _0x5a0cc9=new suppliers_payment({'invoice':_0x57f75d,'date':_0x14a151+'-'+_0xa78956+'-'+_0x39d8e3,'suppliers':_0x295817,'reason':'Paid\x20For\x20Purchase','amount':_0x2dc726}),_0x3e5489=await _0x5a0cc9[_0x120bb3(0x192)]();_0x258964[_0x120bb3(0x146)](_0x120bb3(0x18c),'payment\x20successfull'),_0x29cb90[_0x120bb3(0x151)](_0x120bb3(0x1c2));}catch(_0x472643){console[_0x120bb3(0x1d3)](_0x472643);}}),router['get']('/invoice/:id',auth,async(_0x587be0,_0x3bb4f6)=>{var _0x15e506=a0_0x444c49;try{const {username:_0x58b42a,email:_0x6bcb83,role:_0x297860}=_0x587be0[_0x15e506(0x1c4)],_0x1eae4e=_0x587be0[_0x15e506(0x1c4)],_0x4852b9=await profile[_0x15e506(0x1f2)]({'email':_0x1eae4e['email']}),_0x4e22d4=await master_shop['find']();console[_0x15e506(0x1d3)](_0x15e506(0x140),_0x4e22d4);const _0x20e73a=_0x587be0[_0x15e506(0x22a)]['id'],_0x3012c3=await purchases[_0x15e506(0x166)](_0x20e73a);console[_0x15e506(0x1d3)](_0x3012c3);const _0x471fb0=await suppliers[_0x15e506(0x1f2)]({'name':_0x3012c3[_0x15e506(0x12b)]});console[_0x15e506(0x1d3)](_0x471fb0);if(_0x4e22d4[0x0][_0x15e506(0x11f)]==_0x15e506(0x13a)){var _0x5380db=users['English'];console[_0x15e506(0x1d3)](_0x5380db);}else{if(_0x4e22d4[0x0]['language']==_0x15e506(0x13f))var _0x5380db=users['Hindi'];else{if(_0x4e22d4[0x0]['language']==_0x15e506(0x206))var _0x5380db=users[_0x15e506(0x206)];else{if(_0x4e22d4[0x0][_0x15e506(0x11f)]==_0x15e506(0x1ea))var _0x5380db=users[_0x15e506(0x1ea)];else{if(_0x4e22d4[0x0][_0x15e506(0x11f)]==_0x15e506(0x1c5))var _0x5380db=users['French'];else{if(_0x4e22d4[0x0][_0x15e506(0x11f)]=='Portuguese\x20(BR)')var _0x5380db=users[_0x15e506(0x139)];else{if(_0x4e22d4[0x0][_0x15e506(0x11f)]==_0x15e506(0x1a8))var _0x5380db=users['Chinese'];else{if(_0x4e22d4[0x0][_0x15e506(0x11f)]==_0x15e506(0x177))var _0x5380db=users[_0x15e506(0x1da)];}}}}}}}_0x3bb4f6['render']('purchase_invoice',{'success':_0x587be0[_0x15e506(0x146)]('success'),'errors':_0x587be0[_0x15e506(0x146)](_0x15e506(0x19b)),'role':_0x1eae4e,'profile':_0x4852b9,'master_shop':_0x4e22d4,'supplier':_0x471fb0,'purchase':_0x3012c3,'language':_0x5380db});}catch(_0x4999fd){console[_0x15e506(0x1d3)](_0x4999fd);}}),router[a0_0x444c49(0x132)](a0_0x444c49(0x149),auth,async(_0x254957,_0x3b18e3)=>{var _0x4dc4b5=a0_0x444c49;try{const {username:_0x49a937,email:_0x518c14,role:_0x194bba}=_0x254957[_0x4dc4b5(0x1c4)],_0x2a4100=_0x254957['user'],_0x4e7bfd=await profile[_0x4dc4b5(0x1f2)]({'email':_0x2a4100[_0x4dc4b5(0x20c)]}),_0x2c0148=await master_shop[_0x4dc4b5(0x144)]();console[_0x4dc4b5(0x1d3)]('master',_0x2c0148);const _0x1b4f71=_0x254957[_0x4dc4b5(0x22a)]['id'];console['log'](_0x1b4f71);const _0x7090b2=await purchases[_0x4dc4b5(0x166)](_0x1b4f71);console['log'](_0x4dc4b5(0x17a),_0x7090b2);const _0x2be603=await product['find']({}),_0x3e6e89=await warehouse[_0x4dc4b5(0x12a)]([{'$match':{'name':_0x7090b2[_0x4dc4b5(0x1d2)],'room':_0x7090b2['room'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x4dc4b5(0x161)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4dc4b5(0x228)},'product_stock':{'$first':_0x4dc4b5(0x1ff)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4dc4b5(0x17e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4dc4b5(0x238)},'primary_code':{'$first':_0x4dc4b5(0x216)},'secondary_code':{'$first':_0x4dc4b5(0x19d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4dc4b5(0x1f3)},'rack':{'$first':_0x4dc4b5(0x14d)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x4dc4b5(0x14a),'name':_0x4dc4b5(0x15d),'warehouse_category':_0x4dc4b5(0x147)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x4dc4b5(0x1d3)](_0x4dc4b5(0x126),_0x3e6e89);if(_0x2c0148[0x0][_0x4dc4b5(0x11f)]==_0x4dc4b5(0x13a)){var _0x2c2fc8=users[_0x4dc4b5(0x1b0)];console['log'](_0x2c2fc8);}else{if(_0x2c0148[0x0][_0x4dc4b5(0x11f)]==_0x4dc4b5(0x13f))var _0x2c2fc8=users[_0x4dc4b5(0x13f)];else{if(_0x2c0148[0x0]['language']=='German')var _0x2c2fc8=users['German'];else{if(_0x2c0148[0x0]['language']=='Spanish')var _0x2c2fc8=users['Spanish'];else{if(_0x2c0148[0x0][_0x4dc4b5(0x11f)]==_0x4dc4b5(0x1c5))var _0x2c2fc8=users[_0x4dc4b5(0x1c5)];else{if(_0x2c0148[0x0][_0x4dc4b5(0x11f)]==_0x4dc4b5(0x1a1))var _0x2c2fc8=users[_0x4dc4b5(0x139)];else{if(_0x2c0148[0x0][_0x4dc4b5(0x11f)]=='Chinese')var _0x2c2fc8=users[_0x4dc4b5(0x1a8)];else{if(_0x2c0148[0x0][_0x4dc4b5(0x11f)]=='Arabic\x20(ae)')var _0x2c2fc8=users[_0x4dc4b5(0x1da)];}}}}}}}_0x3b18e3['render'](_0x4dc4b5(0x1b2),{'success':_0x254957[_0x4dc4b5(0x146)](_0x4dc4b5(0x18c)),'errors':_0x254957[_0x4dc4b5(0x146)]('errors'),'role':_0x2a4100,'profile':_0x4e7bfd,'user':_0x7090b2,'stock':_0x3e6e89,'master_shop':_0x2c0148,'product':_0x2be603,'language':_0x2c2fc8,'warehouse':warehouse_data});}catch(_0x4ee566){console['log'](_0x4ee566);}}),router['post'](a0_0x444c49(0x149),auth,async(_0x51fae7,_0x1d84b0)=>{var _0x5d276e=a0_0x444c49;try{const {invoice:_0x24fdbe,date:_0x20dacc,warehouse_name:_0x34873d,Room_name:_0x34bf82,product_name:_0xc7f0ee,purchase_quantity:_0x4b80dd,stocks:_0x3bb333,return_qty:_0x59033b,note:_0x139fdc,level:_0x206673,isle:_0x2037d5,pallet:_0x9dd65e,to_warehouse_name:_0xc5175,to_Room_name:_0x437c8f}=_0x51fae7['body'],_0x2be29a=await purchases['findOne']({'_id':_0x51fae7['params']['id']}),_0x658be1=await warehouse['findOne']({'name':_0x34873d,'room':_0x34bf82});if(typeof _0xc7f0ee==_0x5d276e(0x222))var _0x23095d=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x217)]],_0x600eda=[_0x51fae7['body'][_0x5d276e(0x1b3)]],_0x3c8769=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x1a7)]],_0x22f735=[_0x51fae7['body'][_0x5d276e(0x208)]],_0x3889de=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x17c)]],_0x2ee16d=[_0x51fae7['body']['isle']],_0x437e03=[_0x51fae7[_0x5d276e(0x179)]['pallet']],_0x54b54d=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x220)]],_0x34643a=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x130)]],_0x14444e=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x134)]],_0x499654=[_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x12d)]];else var _0x23095d=[..._0x51fae7[_0x5d276e(0x179)]['product_name']],_0x600eda=[..._0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x1b3)]],_0x3c8769=[..._0x51fae7[_0x5d276e(0x179)]['stocks']],_0x22f735=[..._0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x208)]],_0x3889de=[..._0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x17c)]],_0x2ee16d=[..._0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x1ef)]],_0x437e03=[..._0x51fae7[_0x5d276e(0x179)]['pallet']],_0x54b54d=[..._0x51fae7[_0x5d276e(0x179)]['types']],_0x34643a=[..._0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x130)]],_0x14444e=[..._0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x134)]],_0x499654=[..._0x51fae7[_0x5d276e(0x179)]['secondary_code_hide']];const _0x3d3c25=_0x23095d[_0x5d276e(0x21a)](_0x44f7f6=>{return _0x44f7f6={'product_name':_0x44f7f6};});_0x600eda['forEach']((_0x233b2c,_0x11e0f6)=>{var _0x28bcde=_0x5d276e;_0x3d3c25[_0x11e0f6][_0x28bcde(0x1b3)]=_0x233b2c;}),_0x3c8769[_0x5d276e(0x1b9)]((_0x1b52e2,_0x42a60d)=>{var _0x38201e=_0x5d276e;_0x3d3c25[_0x42a60d][_0x38201e(0x197)]=_0x1b52e2;}),_0x22f735[_0x5d276e(0x1b9)]((_0x4995a5,_0xe94cc)=>{var _0x1aecbb=_0x5d276e;_0x3d3c25[_0xe94cc][_0x1aecbb(0x208)]=_0x4995a5;}),_0x3889de[_0x5d276e(0x1b9)]((_0x25b0e3,_0x150345)=>{var _0x47fb21=_0x5d276e;_0x3d3c25[_0x150345][_0x47fb21(0x20b)]=_0x25b0e3;}),_0x2ee16d['forEach']((_0x5e23ae,_0x1c9d80)=>{var _0x5c79a0=_0x5d276e;_0x3d3c25[_0x1c9d80][_0x5c79a0(0x1c3)]=_0x5e23ae;}),_0x437e03[_0x5d276e(0x1b9)]((_0x5e1f76,_0x2819a1)=>{_0x3d3c25[_0x2819a1]['floorlevel']=_0x5e1f76;}),_0x54b54d[_0x5d276e(0x1b9)]((_0x4fb119,_0x46bd82)=>{var _0x5319df=_0x5d276e;_0x3d3c25[_0x46bd82][_0x5319df(0x1e4)]=_0x4fb119;}),_0x34643a['forEach']((_0x434c33,_0x3c56ec)=>{_0x3d3c25[_0x3c56ec]['product_code']=_0x434c33;}),_0x14444e[_0x5d276e(0x1b9)]((_0xd0228f,_0x220182)=>{_0x3d3c25[_0x220182]['primary_code']=_0xd0228f;}),_0x499654[_0x5d276e(0x1b9)]((_0x2b3e18,_0x3e570a)=>{var _0x37f404=_0x5d276e;_0x3d3c25[_0x3e570a][_0x37f404(0x185)]=_0x2b3e18;}),_0x2be29a[_0x5d276e(0x1f4)][_0x5d276e(0x1b9)](_0x55742c=>{var _0xd76e70=_0x5d276e;const _0x26aa29=_0x658be1[_0xd76e70(0x1fd)][_0xd76e70(0x21a)](_0x3119df=>{var _0x5809e4=_0xd76e70;_0x3119df['product_name']==_0x55742c[_0x5809e4(0x217)]&&_0x3119df[_0x5809e4(0x129)]==_0x55742c[_0x5809e4(0x129)]&&_0x3119df[_0x5809e4(0x1e4)]==_0x55742c['type']&&_0x3119df['bin']==_0x55742c[_0x5809e4(0x1c3)]&&_0x3119df['bay']==_0x55742c[_0x5809e4(0x20b)]&&_0x3119df[_0x5809e4(0x12c)]==_0x55742c[_0x5809e4(0x12c)]&&_0x3119df[_0x5809e4(0x1ee)]==_0x55742c[_0x5809e4(0x1ee)]&&(console[_0x5809e4(0x1d3)](parseInt(_0x3119df['product_stock'])+_0x5809e4(0x1fc)+parseInt(_0x55742c['quantity'])),_0x3119df[_0x5809e4(0x16b)]=parseInt(_0x3119df[_0x5809e4(0x16b)])+parseInt(_0x55742c['quantity']));});}),await _0x658be1[_0x5d276e(0x192)]();const _0x1cb735=_0x3d3c25[_0x5d276e(0x1be)](_0x452111=>_0x452111['return_qty']!=='0'&&_0x452111[_0x5d276e(0x208)]!=='');var _0x101e0e=0x0;_0x1cb735[_0x5d276e(0x1b9)](_0x28fdaf=>{var _0x514d01=_0x5d276e;console['log'](_0x514d01(0x180),_0x28fdaf),(parseInt(_0x28fdaf[_0x514d01(0x1b3)])<parseInt(_0x28fdaf[_0x514d01(0x208)])||parseInt(_0x28fdaf[_0x514d01(0x197)])<parseInt(_0x28fdaf[_0x514d01(0x208)]))&&_0x101e0e++;});if(_0x101e0e!=0x0)return _0x51fae7['flash'](_0x5d276e(0x19b),_0x5d276e(0x230)),_0x1d84b0[_0x5d276e(0x151)](_0x5d276e(0x155));const _0x33510c=new purchases_return({'invoice':_0x24fdbe,'suppliers':_0x51fae7[_0x5d276e(0x179)][_0x5d276e(0x12b)],'date':_0x20dacc,'warehouse_name':_0x34873d,'return_product':_0x1cb735,'note':_0x139fdc,'room':_0x34bf82,'to_warehouse_name':_0xc5175,'to_room':_0x437c8f}),_0x4aa643=await _0x33510c[_0x5d276e(0x192)]();console[_0x5d276e(0x1d3)](_0x33510c);const _0x276eb2=await purchases_return[_0x5d276e(0x1f2)]({'invoice':_0x24fdbe}),_0x275ac3=await warehouse['findOne']({'name':_0xc5175,'room':_0x437c8f});_0x276eb2[_0x5d276e(0x1a3)][_0x5d276e(0x1b9)](_0x4b9d95=>{var _0x123456=_0x5d276e,_0x1e020b=0x0;const _0x388e6a=_0x275ac3['product_details'][_0x123456(0x21a)](_0x1561fa=>{var _0x5e5b3f=_0x123456;_0x1561fa['product_name']==_0x4b9d95[_0x5e5b3f(0x217)]&&_0x1561fa[_0x5e5b3f(0x129)]==_0x4b9d95[_0x5e5b3f(0x129)]&&_0x1561fa[_0x5e5b3f(0x1e4)]==_0x4b9d95[_0x5e5b3f(0x1e4)]&&_0x1561fa[_0x5e5b3f(0x1c3)]==_0x4b9d95[_0x5e5b3f(0x1c3)]&&_0x1561fa[_0x5e5b3f(0x20b)]==_0x4b9d95[_0x5e5b3f(0x20b)]&&(_0x1561fa[_0x5e5b3f(0x16b)]=parseInt(_0x1561fa[_0x5e5b3f(0x16b)])-parseInt(_0x4b9d95[_0x5e5b3f(0x208)]),_0x1e020b++);});_0x1e020b=='0'&&(_0x275ac3[_0x123456(0x1fd)]=_0x275ac3[_0x123456(0x1fd)][_0x123456(0x233)]({'product_name':_0x4b9d95[_0x123456(0x217)],'product_stock':_0x4b9d95[_0x123456(0x208)],'primary_code':_0x4b9d95[_0x123456(0x1d1)],'secondary_code':_0x4b9d95[_0x123456(0x185)],'product_code':_0x4b9d95['product_code'],'storage':_0x4b9d95['storage'],'rack':_0x4b9d95[_0x123456(0x12c)],'bay':_0x4b9d95[_0x123456(0x20b)],'bin':_0x4b9d95[_0x123456(0x1c3)],'type':_0x4b9d95[_0x123456(0x1e4)],'floorlevel':_0x4b9d95[_0x123456(0x129)],'maxProducts':_0x4b9d95[_0x123456(0x154)],'unit':_0x4b9d95['standard_unit'],'secondary_unit':_0x4b9d95[_0x123456(0x200)],'expiry_date':_0x4b9d95[_0x123456(0x235)]}));}),await _0x275ac3[_0x5d276e(0x192)]();const _0x1c0f40=await purchases[_0x5d276e(0x1f2)]({'invoice':_0x24fdbe});_0x1c0f40[_0x5d276e(0x1db)]=_0x5d276e(0x157);const _0x7e5df0=await _0x1c0f40[_0x5d276e(0x192)](),_0x3fed73=new s_payment_data({'invoice':_0x24fdbe,'suppliers':_0x51fae7['body'][_0x5d276e(0x12b)],'reason':_0x5d276e(0x202)});await _0x3fed73[_0x5d276e(0x192)]();const _0x31ae19=await master_shop['find']();console[_0x5d276e(0x1d3)](_0x5d276e(0x22b),_0x31ae19[0x0][_0x5d276e(0x19a)]);const _0x1dee5a=await email_settings[_0x5d276e(0x1f2)](),_0x1a08a2=await suppliers['findOne']({'name':_0x51fae7['body']['suppliers']});console['log']('suppliers_data',_0x1a08a2);_0x31ae19[0x0][_0x5d276e(0x22c)]==0x1?(right_currency=_0x31ae19[0x0][_0x5d276e(0x204)],left_currency=''):(right_currency='',left_currency=_0x31ae19[0x0][_0x5d276e(0x204)]);var _0x2a2344=_0x23095d,_0x1a742c=_0x22f735,_0x17db2e='',_0x44c00c;for(_0x44c00c in _0x2a2344){_0x17db2e+=_0x5d276e(0x13e)+_0x5d276e(0x214)+_0x2a2344[_0x44c00c]+_0x5d276e(0x14b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1a742c[_0x44c00c]+'</td>'+_0x5d276e(0x215);}console[_0x5d276e(0x1d3)]('product_list',_0x17db2e);let _0x3ff7c3=nodemailer[_0x5d276e(0x1e7)]({'service':'gmail','auth':{'user':_0x1dee5a[_0x5d276e(0x20c)],'pass':_0x1dee5a['password']}}),_0x445757={'from':_0x1dee5a['email'],'to':_0x1a08a2['email'],'subject':_0x5d276e(0x1e1),'attachments':[{'filename':_0x5d276e(0x20e),'path':__dirname+_0x5d276e(0x1cb)+_0x5d276e(0x17f)+_0x31ae19[0x0][_0x5d276e(0x19a)],'cid':'logo'}],'html':_0x5d276e(0x22f)+_0x5d276e(0x1a0)+_0x5d276e(0x125)+_0x5d276e(0x21f)+_0x5d276e(0x186)+_0x5d276e(0x21f)+_0x5d276e(0x162)+_0x5d276e(0x1ba)+_0x5d276e(0x21f)+_0x5d276e(0x17d)+_0x31ae19[0x0]['site_title']+_0x5d276e(0x1c9)+_0x5d276e(0x1ba)+_0x5d276e(0x1ba)+_0x5d276e(0x124)+_0x5d276e(0x21f)+_0x5d276e(0x203)+_0x5d276e(0x1c6)+_0x24fdbe+'\x20'+_0x5d276e(0x1af)+_0x5d276e(0x223)+_0x20dacc+'\x20'+_0x5d276e(0x1e0)+_0x5d276e(0x1bb)+_0x5d276e(0x1ba)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5d276e(0x20a)+_0x5d276e(0x13e)+_0x5d276e(0x160)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5d276e(0x163)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x17db2e+'\x20'+_0x5d276e(0x1a6)+_0x5d276e(0x178)+_0x5d276e(0x21f)+'<strong>\x20Regards\x20</strong>'+_0x5d276e(0x1d0)+_0x31ae19[0x0][_0x5d276e(0x1d8)]+_0x5d276e(0x1bb)+_0x5d276e(0x1ba)+_0x5d276e(0x1ba)+'</body></html>'};_0x3ff7c3[_0x5d276e(0x15b)](_0x445757,function(_0x1eb328,_0x374a10){var _0x1860d6=_0x5d276e;_0x1eb328?(console[_0x1860d6(0x1d3)](_0x1eb328),console[_0x1860d6(0x1d3)](_0x1860d6(0x1a4))):console[_0x1860d6(0x1d3)](_0x1860d6(0x1eb));}),_0x51fae7['flash'](_0x5d276e(0x18c),'purchases\x20item\x20return\x20successfull'),_0x1d84b0[_0x5d276e(0x151)](_0x5d276e(0x1c2));}catch(_0x6375cd){console['log'](_0x6375cd),_0x1d84b0['status'](0xc8)[_0x5d276e(0x224)]({'message':_0x6375cd['message']});}}),router['get']('/barcode/:id',auth,async(_0x1b2720,_0x5bd3b0)=>{var _0x22aec5=a0_0x444c49;try{const {username:_0x38aea8,email:_0x5d0d39,role:_0x2f1719}=_0x1b2720['user'],_0x5cb2d9=_0x1b2720[_0x22aec5(0x1c4)],_0x9ad9f6=await profile['findOne']({'email':_0x5cb2d9[_0x22aec5(0x20c)]}),_0x6ec9da=await master_shop[_0x22aec5(0x144)](),_0x174a1a=_0x1b2720['params']['id'],_0x3e6f46=await purchases[_0x22aec5(0x166)](_0x174a1a);if(_0x6ec9da[0x0][_0x22aec5(0x11f)]==_0x22aec5(0x13a))var _0x12991f=users[_0x22aec5(0x1b0)];else{if(_0x6ec9da[0x0][_0x22aec5(0x11f)]==_0x22aec5(0x13f))var _0x12991f=users[_0x22aec5(0x13f)];else{if(_0x6ec9da[0x0][_0x22aec5(0x11f)]=='German')var _0x12991f=users[_0x22aec5(0x206)];else{if(_0x6ec9da[0x0][_0x22aec5(0x11f)]==_0x22aec5(0x1ea))var _0x12991f=users['Spanish'];else{if(_0x6ec9da[0x0]['language']==_0x22aec5(0x1c5))var _0x12991f=users[_0x22aec5(0x1c5)];else{if(_0x6ec9da[0x0][_0x22aec5(0x11f)]==_0x22aec5(0x1a1))var _0x12991f=users[_0x22aec5(0x139)];else{if(_0x6ec9da[0x0][_0x22aec5(0x11f)]=='Chinese')var _0x12991f=users[_0x22aec5(0x1a8)];else{if(_0x6ec9da[0x0][_0x22aec5(0x11f)]==_0x22aec5(0x177))var _0x12991f=users[_0x22aec5(0x1da)];}}}}}}}_0x5bd3b0[_0x22aec5(0x188)](_0x22aec5(0x1cd),{'success':_0x1b2720[_0x22aec5(0x146)](_0x22aec5(0x18c)),'errors':_0x1b2720[_0x22aec5(0x146)](_0x22aec5(0x19b)),'role':_0x5cb2d9,'profile':_0x9ad9f6,'alldata':_0x3e6f46,'master_shop':_0x6ec9da,'language':_0x12991f}),console[_0x22aec5(0x1d3)](alldata);}catch(_0x1a9bac){console[_0x22aec5(0x1d3)](_0x1a9bac);}}),router['post'](a0_0x444c49(0x181),async(_0x4de031,_0x111ff9)=>{var _0x1e5c0c=a0_0x444c49;const {product_code:_0x25b166}=_0x4de031['body'];var _0x3e696f;const _0x57a74e=await product[_0x1e5c0c(0x12a)]([{'$match':{'primary_code':_0x25b166,'product_category':_0x1e5c0c(0x147)}},{'$group':{'_id':_0x1e5c0c(0x13b),'name':{'$first':_0x1e5c0c(0x207)},'category':{'$first':_0x1e5c0c(0x20d)},'brand':{'$first':'$brand'},'unit':{'$first':_0x1e5c0c(0x1b7)},'alertquantity':{'$first':_0x1e5c0c(0x198)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1e5c0c(0x196)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1e5c0c(0x19f)},'maxProdPerUnit':{'$first':_0x1e5c0c(0x16d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1e5c0c(0x1e2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2e03ca=await product[_0x1e5c0c(0x12a)]([{'$match':{'secondary_code':_0x25b166,'product_category':_0x1e5c0c(0x147)}},{'$group':{'_id':_0x1e5c0c(0x13b),'name':{'$first':_0x1e5c0c(0x207)},'category':{'$first':_0x1e5c0c(0x20d)},'brand':{'$first':'$brand'},'unit':{'$first':_0x1e5c0c(0x1b7)},'alertquantity':{'$first':_0x1e5c0c(0x198)},'product_code':{'$first':_0x1e5c0c(0x1a5)},'primary_code':{'$first':_0x1e5c0c(0x196)},'secondary_code':{'$first':_0x1e5c0c(0x189)},'maxStocks':{'$first':_0x1e5c0c(0x19f)},'maxProdPerUnit':{'$first':_0x1e5c0c(0x16d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1e5c0c(0x1e2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x57a74e['length']>0x0)_0x3e696f=_0x57a74e;else _0x2e03ca[_0x1e5c0c(0x15e)]>0x0&&(_0x3e696f=_0x2e03ca);_0x111ff9[_0x1e5c0c(0x224)](_0x3e696f);}),router[a0_0x444c49(0x1c0)](a0_0x444c49(0x17b),async(_0xa8fc36,_0x19c00b)=>{var _0x20468d=a0_0x444c49;const {primaryCode:_0x5090fa,secondaryCode:_0x55256e,productCode:_0x1b5aa1,bay:_0x3db26c,bin:_0x435313,types:_0x142de1,pallet:_0x59c3a0,warehouses:_0x55a431,room:_0x2acc8c}=_0xa8fc36['body'];console['log'](_0xa8fc36[_0x20468d(0x179)]);try{const _0x15e87b=await warehouse[_0x20468d(0x12a)]([{'$match':{'name':_0x55a431,'room':_0x2acc8c}},{'$unwind':_0x20468d(0x161)},{'$match':{'product_details.bay':_0x3db26c,'product_details.bin':_0x435313,'product_details.type':_0x142de1}},{'$group':{'_id':_0x20468d(0x1f6),'name':{'$first':_0x20468d(0x228)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x20468d(0x211)},'isle':{'$first':_0x20468d(0x16a)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x20468d(0x183)}}}]);_0x19c00b[_0x20468d(0x1b8)](0xc8)[_0x20468d(0x224)](_0x15e87b);}catch(_0x119186){_0x19c00b[_0x20468d(0x1b8)](0x194)[_0x20468d(0x224)]({'message':_0x119186[_0x20468d(0x236)]});}}),module[a0_0x444c49(0x167)]=router;