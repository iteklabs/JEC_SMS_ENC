var a0_0x4630f2=a0_0x3983;(function(_0x3b60c3,_0x54998f){var _0x36ec2c=a0_0x3983,_0x547e8b=_0x3b60c3();while(!![]){try{var _0x304700=parseInt(_0x36ec2c(0x24c))/0x1*(-parseInt(_0x36ec2c(0x22a))/0x2)+parseInt(_0x36ec2c(0x1c3))/0x3*(-parseInt(_0x36ec2c(0x1cb))/0x4)+-parseInt(_0x36ec2c(0x26b))/0x5*(parseInt(_0x36ec2c(0x2df))/0x6)+-parseInt(_0x36ec2c(0x233))/0x7*(parseInt(_0x36ec2c(0x1e3))/0x8)+-parseInt(_0x36ec2c(0x2e2))/0x9*(-parseInt(_0x36ec2c(0x220))/0xa)+-parseInt(_0x36ec2c(0x250))/0xb*(-parseInt(_0x36ec2c(0x26c))/0xc)+parseInt(_0x36ec2c(0x209))/0xd;if(_0x304700===_0x54998f)break;else _0x547e8b['push'](_0x547e8b['shift']());}catch(_0x332fba){_0x547e8b['push'](_0x547e8b['shift']());}}}(a0_0xcea9,0x88a9b));function a0_0x3983(_0x2834bc,_0x4624f8){var _0xcea973=a0_0xcea9();return a0_0x3983=function(_0x398391,_0x269b82){_0x398391=_0x398391-0x1be;var _0x4268d5=_0xcea973[_0x398391];return _0x4268d5;},a0_0x3983(_0x2834bc,_0x4624f8);}const express=require(a0_0x4630f2(0x1ff)),app=express(),router=express[a0_0x4630f2(0x206)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x4630f2(0x2e4)),auth=require(a0_0x4630f2(0x21c)),nodemailer=require(a0_0x4630f2(0x1da));var ejs=require(a0_0x4630f2(0x272));const path=require(a0_0x4630f2(0x1c0)),users=require(a0_0x4630f2(0x281));router['get']('/view',auth,async(_0x44afa3,_0x405293)=>{var _0x468431=a0_0x4630f2;try{const {username:_0xa1beca,email:_0x2789b0,role:_0x678d47}=_0x44afa3[_0x468431(0x2af)],_0x4fa9b9=_0x44afa3['user'],_0x4115a4=await profile[_0x468431(0x2ca)]({'email':_0x4fa9b9[_0x468431(0x24b)]}),_0x4b2f0f=await staff[_0x468431(0x2ca)]({'email':_0x4fa9b9[_0x468431(0x24b)]});if(_0x4fa9b9['role']=='staff'){const _0x5ee396=await staff[_0x468431(0x2ca)]({'email':_0x4fa9b9[_0x468431(0x24b)]});}const _0x58f412=await master_shop[_0x468431(0x1de)]();let _0x382ed1;if(_0x4fa9b9[_0x468431(0x1c4)]=='staff'){const _0x5f45f7=await staff[_0x468431(0x2ca)]({'email':_0x4fa9b9[_0x468431(0x24b)]});_0x382ed1=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5f45f7[_0x468431(0x241)]}},{'$lookup':{'from':_0x468431(0x23e),'localField':_0x468431(0x23e),'foreignField':_0x468431(0x2b9),'as':_0x468431(0x2b6)}},{'$unwind':_0x468431(0x249)},{'$unwind':_0x468431(0x222)},{'$group':{'_id':_0x468431(0x2c6),'invoice':{'$first':_0x468431(0x21f)},'suppliers':{'$first':_0x468431(0x2d2)},'date':{'$first':_0x468431(0x232)},'warehouse_name':{'$first':_0x468431(0x2e1)},'room':{'$first':_0x468431(0x1e4)},'product':{'$push':_0x468431(0x222)},'note':{'$first':_0x468431(0x28e)},'paid_amount':{'$first':_0x468431(0x216)},'due_amount':{'$first':_0x468431(0x24f)},'return_data':{'$first':_0x468431(0x230)},'batch_code':{'$first':_0x468431(0x234)},'expiry_date':{'$first':_0x468431(0x2ba)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x468431(0x25c)},'level':{'$addToSet':_0x468431(0x268)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x382ed1=await purchases[_0x468431(0x289)]([{'$lookup':{'from':_0x468431(0x23e),'localField':_0x468431(0x23e),'foreignField':_0x468431(0x2b9),'as':_0x468431(0x2b6)}},{'$unwind':_0x468431(0x249)},{'$unwind':_0x468431(0x222)},{'$group':{'_id':_0x468431(0x2c6),'invoice':{'$first':_0x468431(0x21f)},'suppliers':{'$first':_0x468431(0x2d2)},'date':{'$first':_0x468431(0x232)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x468431(0x2bc)},'product':{'$push':'$product'},'note':{'$first':_0x468431(0x28e)},'paid_amount':{'$first':_0x468431(0x216)},'due_amount':{'$first':_0x468431(0x24f)},'return_data':{'$first':_0x468431(0x230)},'batch_code':{'$first':_0x468431(0x234)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x468431(0x249)},'total_product_quantity':{'$sum':_0x468431(0x25c)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x468431(0x2a1)},'type':{'$addToSet':_0x468431(0x1ec)},'floorlevel':{'$addToSet':_0x468431(0x235)},'finalize':{'$first':_0x468431(0x225)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x58f412[0x0][_0x468431(0x293)]==_0x468431(0x212)){var _0x402320=users['English'];console[_0x468431(0x257)](_0x402320);}else{if(_0x58f412[0x0]['language']==_0x468431(0x26e))var _0x402320=users[_0x468431(0x26e)];else{if(_0x58f412[0x0][_0x468431(0x293)]==_0x468431(0x1e5))var _0x402320=users[_0x468431(0x1e5)];else{if(_0x58f412[0x0][_0x468431(0x293)]=='Spanish')var _0x402320=users['Spanish'];else{if(_0x58f412[0x0][_0x468431(0x293)]==_0x468431(0x2c9))var _0x402320=users['French'];else{if(_0x58f412[0x0][_0x468431(0x293)]==_0x468431(0x1c1))var _0x402320=users['Portuguese'];else{if(_0x58f412[0x0][_0x468431(0x293)]==_0x468431(0x24e))var _0x402320=users['Chinese'];else{if(_0x58f412[0x0][_0x468431(0x293)]==_0x468431(0x29b))var _0x402320=users['Arabic'];}}}}}}}_0x405293['render'](_0x468431(0x275),{'success':_0x44afa3[_0x468431(0x2d3)](_0x468431(0x210)),'errors':_0x44afa3['flash'](_0x468431(0x260)),'purchases':_0x382ed1,'role':_0x4fa9b9,'profile':_0x4115a4,'master_shop':_0x58f412,'language':_0x402320});}catch(_0x1d47df){console['log'](_0x468431(0x284),_0x1d47df),_0x405293[_0x468431(0x262)](0xc8)[_0x468431(0x2b2)]({'message':_0x1d47df[_0x468431(0x1ea)]});}});function BayBinSelected(_0x1c177d,_0xf0bc97){var _0x5a67b6=a0_0x4630f2,_0x5743dd=[],_0x5cab7f=[],_0x3e77a9=[],_0x4c3b95=[],_0x95a15e=[],_0x5f60e2=[];let _0x53215c=[];if(_0x1c177d==_0x5a67b6(0x2c8))switch(_0xf0bc97){case _0x5a67b6(0x24a):_0x5743dd=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5cab7f=[0x1,0x2],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=[_0x5a67b6(0x2aa),'Floor'],_0x95a15e=['D'],_0x5f60e2=['A'];break;case _0x5a67b6(0x21d):_0x5743dd=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5cab7f=[0x1,0x2],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=['Level',_0x5a67b6(0x2c2)],_0x95a15e=['D'],_0x5f60e2=['B'];break;case _0x5a67b6(0x1e2):_0x5743dd=[0x0],_0x5cab7f=[0x0],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=[_0x5a67b6(0x2c2)],_0x95a15e=['D'],_0x5f60e2=['S'];break;case'Receiving\x20Area':_0x5743dd=[0x0],_0x5cab7f=[0x0],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3e77a9=[_0x5a67b6(0x2c2)],_0x95a15e=['D'],_0x5f60e2=['R'];break;}else{if(_0x1c177d==_0x5a67b6(0x2db))switch(_0xf0bc97){case _0x5a67b6(0x24a):_0x5743dd=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5cab7f=['B','F'],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=[_0x5a67b6(0x2aa),_0x5a67b6(0x2c2)],_0x95a15e=['C'],_0x5f60e2=['A'];break;case _0x5a67b6(0x21d):_0x5743dd=[0x5,0x4,0x3,0x2,0x1],_0x5cab7f=['F','B','S'],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=['Level','Floor'],_0x95a15e=['C'],_0x5f60e2=['B'];break;case'Rack\x20C':_0x5743dd=[0x1,0x2,0x3,0x4,0x5],_0x5cab7f=['B','F','S'],_0x4c3b95=[0x5,0x4,0x3,0x2,0x1],_0x3e77a9=['Level',_0x5a67b6(0x2c2)],_0x95a15e=['C'],_0x5f60e2=['C'];break;case _0x5a67b6(0x28a):_0x5743dd=[0x5,0x4,0x3,0x2,0x1],_0x5cab7f=['F','B','S'],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=[_0x5a67b6(0x2aa),_0x5a67b6(0x2c2)],_0x95a15e=['C'],_0x5f60e2=['D'];break;case'Rack\x20E':_0x5743dd=[0x4,0x3,0x2,0x1],_0x5cab7f=[0x1,0x2],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=['Level',_0x5a67b6(0x2c2)],_0x95a15e=['C'],_0x5f60e2=['E'];break;case _0x5a67b6(0x261):_0x5743dd=[0x1,0x2,0x3],_0x5cab7f=[0x1,0x2],_0x4c3b95=[0x1,0x2,0x3,0x4,0x5],_0x3e77a9=['Level'],_0x95a15e=['C'],_0x5f60e2=['F'];break;}}return{'levels':_0x5743dd,'Isle':_0x5cab7f,'rack':_0x4c3b95,'type':_0x3e77a9,'storage':_0x95a15e,'rak':_0x5f60e2};}async function getRandom8DigitNumber(){var _0x2006ca=a0_0x4630f2;const _0x512ecc=0x989680,_0x35cd89=0x5f5e0ff,_0x377b0e=Math[_0x2006ca(0x1ed)](Math[_0x2006ca(0x247)]()*(_0x35cd89-_0x512ecc+0x1))+_0x512ecc;var _0x1326df;const _0x1267ae=await purchases[_0x2006ca(0x2ca)]({'invoice':_0x2006ca(0x20c)+_0x377b0e});return _0x1267ae&&_0x1267ae[_0x2006ca(0x1ca)]>0x0?_0x1326df=_0x2006ca(0x20c)+_0x377b0e:_0x1326df='INC-'+_0x377b0e,_0x1326df;}function a0_0xcea9(){var _0x21c824=['warehouse','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','add_purchases','forEach','edit_purchases_view','\x20Order\x20Number\x20:\x20','random','slice','$suppliers_docs','Rack\x20A','email','59MEJuzH','<span\x20style=\x22float:\x20right;\x22>','Chinese','$due_amount','15741YZtrhR','actual_uom','batch_code','return_product','$product_details._id','return_qty','$unit','log','then','$product_details.primary_code','Paid\x20For\x20Purchase','alertQTY','$product.quantity','floorlevel','$maxStocks','post','errors','Rack\x20F','status','Purchase\x20Return','$primary_code','room_name','secondary_code','</span>','$product.bay','actual_qty','Spanish','2468345BYgKQS','3600DNnRoB','gmail','Hindi','POnumber','$product_details.pallet','all_purchases_barcode','ejs','Ambient','$product_details','all_purchases','delivery_code','product_name','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','params','createTransport','prod_invoice','get','product_cat','$product_code','</tbody>','../public/language/languages.json','prod_primunit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','table\x20page','$product_details.product_stock','$product_details.level','catch','warehouse_name','aggregate','Rack\x20D','storage','<strong>\x20Regards\x20</strong>','English','$note','delivery_date','logo','True','RoomAssign','language','$secondary_unit','secondary_code_hide','maxStocks','$product_details.storage','port','render','$product_details.maxProducts','Arabic\x20(ae)','staff','save','bin','$product_details.secondary_code','rak','$product.bin','due_amount','<!DOCTYPE\x20html>','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','image','prod_unit','Purchase\x20Return\x20Mail','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Level','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','sendMail','$alertquantity','prod_pallet','user','<html><head><title></title>','$name','json','currency','Email\x20sent\x20successfully','MaxStocks_data','suppliers_docs','production_date','Enclosed','name','$expiry_date','product_code_hide','$product.room_name','$brand','isle','/view/add_purchases/:id','<div>','string','Floor','pallet','maxperunit','prod_secondunit','$_id','prod_isle','DRY\x20STORAGE','French','findOne','$maxProdPerUnit','Portuguese','$secondary_code','type','Enabled','return_data','Room_name','$suppliers','flash','deliverycode','product_list','</div>','getDate','prod_qty','host','edit_purchases','COLD\x20STORAGE','toString','/all_purchases/view','currency_placement','6vvAajH','here','$warehouse_name','9171yfvmCP','product_code','../models/all_models','<h5>','paid_amount','path','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','738237ePtRzH','role','Purchase\x20data\x20added\x20successfully','back','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','password','$product_details.bay','length','8plZhwY','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/invoice/:id','/barcode_scanner','types','amount','level','room','/view/return_purchase/:id','quantity','RMSEmail','Sales\x20Update\x20successfully','/view/:id','prod_level','primary_code','nodemailer','</h5>','JO_number','return_purchase','find','/barcode/:id','product_details','<h5\x20style=\x22text-align:\x20left;\x22>','Shelves','91728LTRkVG','$room','German','findById','$product_details.rack','\x20Order\x20Date\x20:\x20','Return\x20Goods','message','getMonth','$product.type','floor','foreach\x20newproduct','$product_details.bin','date','$product_details.type','padStart','max_product_unit','/all_purchases/view/','prod_cat','Raw\x20Materials','stocks','Error\x20Occurs','abs','An\x20error\x20occurred.','purchase_quantity','finalize','invoice','suppliers_data','express','concat','Purchase\x20Mail','prod_Qty','/view/add_purchases','product','/../public','Router','</thead>','</td>','29049514roaVec','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','secondary_unit','INC-','</table>','standard_unit','Arabic','success','body','English\x20(US)','exports','expiry_date','product_stock','$paid_amount','primary_code_hide','prod_name','\x20<\x20wew\x20>\x20','master','add_purchases\x20error','../middleware/auth','Rack\x20B','Logo.png','$invoice','3110KUdIoU','\x20</h2>','$product','</tr>','map','$finalize','/preview/:id','<h2>\x20','rack','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','32326ulbVSn','payment\x20successfull','stock_quantity','\x20<>\x20','$product_details.product_name','$product_details.floorlevel','$return_data','bay','$date','294pxieUE','$batch_code','$product.floorlevel','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','site_title','prod_code','<hr\x20class=\x22my-3\x22>','Receiving\x20Area','redirect','<table\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers','$category','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'];a0_0xcea9=function(){return _0x21c824;};return a0_0xcea9();}router['get']('/view/add_purchases',auth,async(_0x29fe67,_0x944abe)=>{var _0x8b2317=a0_0x4630f2;try{const {username:_0x27044a,email:_0x11f539,role:_0x452e4a}=_0x29fe67[_0x8b2317(0x2af)],_0x5c2cb0=_0x29fe67[_0x8b2317(0x2af)],_0x1f53ab=await profile[_0x8b2317(0x2ca)]({'email':_0x5c2cb0['email']}),_0xe0e133=await master_shop[_0x8b2317(0x1de)](),_0x45c6aa=await staff[_0x8b2317(0x2ca)]({'email':_0x5c2cb0['email']}),_0x2a679c=await suppliers[_0x8b2317(0x1de)]({});let _0xc622fb;if(_0x5c2cb0[_0x8b2317(0x1c4)]==_0x8b2317(0x29c)){const _0x4ebba7=await staff[_0x8b2317(0x2ca)]({'email':_0x5c2cb0[_0x8b2317(0x24b)]});_0xc622fb=await warehouse[_0x8b2317(0x289)]([{'$match':{'status':_0x8b2317(0x2cf),'name':_0x4ebba7[_0x8b2317(0x241)],'warehouse_category':_0x8b2317(0x1f6),'name':{'$ne':_0x8b2317(0x1e9)}}},{'$group':{'_id':_0x8b2317(0x2b1),'name':{'$first':'$name'}}}]);}else _0xc622fb=await warehouse[_0x8b2317(0x289)]([{'$match':{'status':_0x8b2317(0x2cf),'warehouse_category':_0x8b2317(0x1f6),'name':{'$ne':_0x8b2317(0x1e9)}}},{'$group':{'_id':_0x8b2317(0x2b1),'name':{'$first':_0x8b2317(0x2b1)}}}]);const _0x2fcaa8=await product[_0x8b2317(0x1de)]({}),_0x189779=await warehouse[_0x8b2317(0x1de)]({'status':_0x8b2317(0x2cf)}),_0x450428=await purchases[_0x8b2317(0x1de)]({}),_0x1e1b14=_0x450428[_0x8b2317(0x1ca)]+0x1,_0x3f4bac='INC-'+_0x1e1b14[_0x8b2317(0x2dc)]()[_0x8b2317(0x1f2)](0x5,'0');var _0x11ee0d=[_0x8b2317(0x273),_0x8b2317(0x2b8)];if(_0xe0e133[0x0]['language']=='English\x20(US)')var _0x325974=users[_0x8b2317(0x28d)];else{if(_0xe0e133[0x0][_0x8b2317(0x293)]==_0x8b2317(0x26e))var _0x325974=users[_0x8b2317(0x26e)];else{if(_0xe0e133[0x0][_0x8b2317(0x293)]==_0x8b2317(0x1e5))var _0x325974=users[_0x8b2317(0x1e5)];else{if(_0xe0e133[0x0][_0x8b2317(0x293)]==_0x8b2317(0x26a))var _0x325974=users[_0x8b2317(0x26a)];else{if(_0xe0e133[0x0]['language']=='French')var _0x325974=users[_0x8b2317(0x2c9)];else{if(_0xe0e133[0x0][_0x8b2317(0x293)]==_0x8b2317(0x1c1))var _0x325974=users[_0x8b2317(0x2cc)];else{if(_0xe0e133[0x0][_0x8b2317(0x293)]=='Chinese')var _0x325974=users['Chinese'];else{if(_0xe0e133[0x0][_0x8b2317(0x293)]==_0x8b2317(0x29b))var _0x325974=users['Arabic'];}}}}}}}const _0x5cf05e=getRandom8DigitNumber();_0x5cf05e[_0x8b2317(0x258)](_0x18c084=>{var _0x59679b=_0x8b2317;_0x944abe[_0x59679b(0x299)](_0x59679b(0x243),{'success':_0x29fe67[_0x59679b(0x2d3)](_0x59679b(0x210)),'errors':_0x29fe67['flash']('errors'),'role':_0x5c2cb0,'profile':_0x1f53ab,'suppliers':_0x2a679c,'warehouse':_0xc622fb,'product':_0x2fcaa8,'invoice':_0x18c084,'master_shop':_0xe0e133,'language':_0x325974,'find_data':_0x189779,'rooms_data':_0x11ee0d});})[_0x8b2317(0x287)](_0x4c4621=>{var _0x3c6d3c=_0x8b2317;_0x29fe67[_0x3c6d3c(0x2d3)]('errors',_0x3c6d3c(0x2a9)),_0x944abe[_0x3c6d3c(0x23c)](_0x3c6d3c(0x2dd));});}catch(_0xda9a3){console[_0x8b2317(0x257)](_0xda9a3);}}),router[a0_0x4630f2(0x27d)](a0_0x4630f2(0x2bf),auth,async(_0x34364f,_0x44f2ab)=>{var _0x1de9c2=a0_0x4630f2;try{const _0x1e103f=_0x34364f[_0x1de9c2(0x27a)]['id'];console[_0x1de9c2(0x257)](_0x1e103f);const _0x5b64ca=await master_shop[_0x1de9c2(0x1de)]();console[_0x1de9c2(0x257)](_0x1de9c2(0x21a),_0x5b64ca);const _0xa30d=await product[_0x1de9c2(0x2ca)]({'name':_0x1e103f});console[_0x1de9c2(0x257)](_0x1de9c2(0x204),_0xa30d),_0x44f2ab[_0x1de9c2(0x262)](0xc8)['json']({'product_data':_0xa30d,'master':_0x5b64ca});}catch(_0x201943){console[_0x1de9c2(0x257)](_0x1de9c2(0x21b),_0x201943);}}),router[a0_0x4630f2(0x25f)](a0_0x4630f2(0x203),auth,async(_0x5d62f6,_0x3c92f4)=>{var _0x1dd6bb=a0_0x4630f2;try{const {invoice:_0x2180aa,date:_0x2fae3d,warehouse_name:_0x497ff2,prod_name:_0x2b2860,prod_code:_0x408a47,prod_qty:_0x52f299,prod_unit:_0x306417,prod_secondunit:_0x225693,prod_level:_0x407727,prod_isle:_0x40f9fd,prod_pallet:_0x168cff,note:_0x4fc523,expiry_date:_0x52b22e,batch_code:_0x4e3f8e,payable:_0x46323f,due_amount:_0x58dbe3,Room_name:_0x2a8568,primary_code:_0x4bdca8,secondary_code:_0x22a961,MaxStocks_data:_0x917463,PO_number:_0x3ae5a2,SCRN:_0x1a0da4,JO_number:_0x8399ce}=_0x5d62f6[_0x1dd6bb(0x211)];if(typeof _0x2b2860==_0x1dd6bb(0x2c1))var _0x4b154c=[_0x5d62f6[_0x1dd6bb(0x211)]['prod_name']],_0x45c2da=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x239)]],_0x211d9c=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x202)]],_0x4d120d=[_0x5d62f6['body'][_0x1dd6bb(0x282)]],_0x2b7c08=[_0x5d62f6['body'][_0x1dd6bb(0x2c5)]],_0x503264=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x1d8)]],_0x5e13aa=[_0x5d62f6['body'][_0x1dd6bb(0x1d9)]],_0x31451b=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x266)]],_0x211f1d=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x2b5)]],_0x265989=[_0x5d62f6[_0x1dd6bb(0x211)]['batch_code']],_0x492bc9=[_0x5d62f6[_0x1dd6bb(0x211)]['expiry_date']],_0x19033e=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x1f3)]],_0xf2870d=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x25b)]],_0x3c8ce7=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x2b7)]],_0x28b206=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x1f5)]],_0x12029d=[_0x5d62f6['body'][_0x1dd6bb(0x292)]],_0x2ebf07=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x2d4)]],_0x9e3ca7=[_0x5d62f6[_0x1dd6bb(0x211)]['prod_invoice']],_0x1497a0=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x269)]],_0x1ee6da=[_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x251)]];else var _0x4b154c=[..._0x5d62f6['body'][_0x1dd6bb(0x218)]],_0x45c2da=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x239)]],_0x211d9c=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x202)]],_0x4d120d=[..._0x5d62f6[_0x1dd6bb(0x211)]['prod_primunit']],_0x2b7c08=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x2c5)]],_0x503264=[..._0x5d62f6['body'][_0x1dd6bb(0x1d8)]],_0x5e13aa=[..._0x5d62f6['body'][_0x1dd6bb(0x1d9)]],_0x31451b=[..._0x5d62f6['body'][_0x1dd6bb(0x266)]],_0x211f1d=[..._0x5d62f6[_0x1dd6bb(0x211)]['MaxStocks_data']],_0x265989=[..._0x5d62f6[_0x1dd6bb(0x211)]['batch_code']],_0x492bc9=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x214)]],_0x19033e=[..._0x5d62f6['body'][_0x1dd6bb(0x1f3)]],_0xf2870d=[..._0x5d62f6['body'][_0x1dd6bb(0x25b)]],_0x3c8ce7=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x2b7)]],_0x28b206=[..._0x5d62f6['body'][_0x1dd6bb(0x1f5)]],_0x12029d=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x292)]],_0x2ebf07=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x2d4)]],_0x9e3ca7=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x27c)]],_0x1497a0=[..._0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x269)]],_0x1ee6da=[..._0x5d62f6['body'][_0x1dd6bb(0x251)]];const _0x4f6457=_0x4b154c[_0x1dd6bb(0x224)](_0x46bf85=>{return _0x46bf85={'product_name':_0x46bf85};});_0x1497a0[_0x1dd6bb(0x244)]((_0xee9262,_0x156113)=>{var _0x17485b=_0x1dd6bb;_0x4f6457[_0x156113][_0x17485b(0x269)]=Math[_0x17485b(0x1f9)](_0xee9262);}),_0x1ee6da['forEach']((_0x920f24,_0x1786df)=>{_0x4f6457[_0x1786df]['actual_uom']=_0x920f24;}),_0x45c2da[_0x1dd6bb(0x244)]((_0x46cc12,_0x3b73b0)=>{_0x4f6457[_0x3b73b0]['product_code']=_0x46cc12;}),_0x211d9c['forEach']((_0x3f24a8,_0x511fec)=>{var _0x5b9c2d=_0x1dd6bb;_0x4f6457[_0x511fec][_0x5b9c2d(0x1d4)]=Math['abs'](_0x3f24a8);}),_0x4d120d[_0x1dd6bb(0x244)]((_0x359876,_0x58d5c7)=>{_0x4f6457[_0x58d5c7]['standard_unit']=_0x359876;}),_0x2b7c08['forEach']((_0x2c0ded,_0x10ce57)=>{var _0x4aad37=_0x1dd6bb;_0x4f6457[_0x10ce57][_0x4aad37(0x20b)]=_0x2c0ded;}),_0x503264[_0x1dd6bb(0x244)]((_0x3b976d,_0x52c2fd)=>{var _0x1bb940=_0x1dd6bb;_0x12029d[_0x1bb940(0x244)]((_0x3da0b7,_0x2ea23f)=>{var _0x18e681=_0x1bb940;if(_0x3da0b7==_0x18e681(0x23b)&&_0x52c2fd==_0x2ea23f){console[_0x18e681(0x257)](_0x3da0b7+_0x18e681(0x219)+_0x52c2fd+'\x20<>\x20'+_0x2ea23f+_0x18e681(0x22d)+_0x3b976d);var _0x46b2fc=_0x3b976d[_0x18e681(0x248)](0x3);_0x4f6457[_0x52c2fd][_0x18e681(0x28b)]=_0x3b976d[0x0],_0x4f6457[_0x52c2fd]['rack']=_0x3b976d[0x1],_0x4f6457[_0x52c2fd][_0x18e681(0x231)]=0x0,_0x4f6457[_0x52c2fd][_0x18e681(0x29e)]=0x0,_0x4f6457[_0x52c2fd][_0x18e681(0x2ce)]=_0x18e681(0x2c2),_0x4f6457[_0x52c2fd][_0x18e681(0x25d)]=_0x46b2fc;}else{if(_0x3da0b7==_0x18e681(0x1e2)&&_0x52c2fd==_0x2ea23f){var _0x46b2fc=_0x3b976d[_0x18e681(0x248)](0x3);_0x4f6457[_0x52c2fd]['storage']=_0x3b976d[0x0],_0x4f6457[_0x52c2fd][_0x18e681(0x228)]=_0x3b976d[0x1],_0x4f6457[_0x52c2fd]['bay']=0x0,_0x4f6457[_0x52c2fd][_0x18e681(0x29e)]=0x0,_0x4f6457[_0x52c2fd][_0x18e681(0x2ce)]='Floor',_0x4f6457[_0x52c2fd][_0x18e681(0x25d)]=_0x3b976d[0x5];}else{if(_0x52c2fd==_0x2ea23f){if(_0x3b976d[0x0]=='A'&&_0x3b976d[0x1]=='L'&&_0x3b976d[0x2]=='L')console[_0x18e681(0x257)](_0x3da0b7+'\x20<>\x20'+_0x52c2fd+'\x20<>\x20'+_0x2ea23f+_0x18e681(0x22d)+_0x3b976d+_0x18e681(0x2e0)),_0x4f6457[_0x52c2fd][_0x18e681(0x28b)]=_0x3b976d[0x0],_0x4f6457[_0x52c2fd][_0x18e681(0x228)]=_0x3b976d[0x1],_0x4f6457[_0x52c2fd][_0x18e681(0x231)]=0x0,_0x4f6457[_0x52c2fd][_0x18e681(0x29e)]=0x0,_0x4f6457[_0x52c2fd][_0x18e681(0x2ce)]=_0x18e681(0x2c2),_0x4f6457[_0x52c2fd][_0x18e681(0x25d)]=_0x3b976d[0x3];else{var _0x55f8f3;if(_0x3b976d[0x4]=='L')_0x55f8f3=_0x18e681(0x2aa);else _0x3b976d[0x4]=='F'&&(_0x55f8f3=_0x18e681(0x2c2));_0x4f6457[_0x52c2fd][_0x18e681(0x28b)]=_0x3b976d[0x0],_0x4f6457[_0x52c2fd][_0x18e681(0x228)]=_0x3b976d[0x1],_0x4f6457[_0x52c2fd][_0x18e681(0x231)]=_0x3b976d[0x2],_0x4f6457[_0x52c2fd][_0x18e681(0x29e)]=_0x3b976d[0x3],_0x4f6457[_0x52c2fd][_0x18e681(0x2ce)]=_0x55f8f3,_0x4f6457[_0x52c2fd][_0x18e681(0x25d)]=_0x3b976d[0x5];}}}}});}),_0x5e13aa[_0x1dd6bb(0x244)]((_0x2bb5e4,_0x2638bf)=>{var _0x5105f5=_0x1dd6bb;_0x4f6457[_0x2638bf][_0x5105f5(0x1d9)]=_0x2bb5e4;}),_0x31451b[_0x1dd6bb(0x244)]((_0x4cb60c,_0x18eeb3)=>{_0x4f6457[_0x18eeb3]['secondary_code']=_0x4cb60c;}),_0x211f1d[_0x1dd6bb(0x244)]((_0x1a0102,_0x46284e)=>{var _0x219aa0=_0x1dd6bb;_0x4f6457[_0x46284e][_0x219aa0(0x296)]=_0x1a0102;}),_0x265989['forEach']((_0x334994,_0x3f743c)=>{var _0x3c5418=_0x1dd6bb;_0x4f6457[_0x3f743c][_0x3c5418(0x252)]=_0x334994;}),_0x492bc9[_0x1dd6bb(0x244)]((_0x4d7f02,_0x5c09d8)=>{var _0x1386ce=_0x1dd6bb;_0x4f6457[_0x5c09d8][_0x1386ce(0x214)]=_0x4d7f02;}),_0x19033e[_0x1dd6bb(0x244)]((_0x17310c,_0x3ad5b2)=>{_0x4f6457[_0x3ad5b2]['maxperunit']=_0x17310c;}),_0xf2870d[_0x1dd6bb(0x244)]((_0xc0e60a,_0x2d89f8)=>{var _0xbfbbba=_0x1dd6bb;_0x4f6457[_0x2d89f8][_0xbfbbba(0x25b)]=_0xc0e60a;}),_0x3c8ce7[_0x1dd6bb(0x244)]((_0x3c730c,_0x1331b7)=>{var _0x4d0b23=_0x1dd6bb;_0x4f6457[_0x1331b7][_0x4d0b23(0x2b7)]=_0x3c730c;}),_0x28b206[_0x1dd6bb(0x244)]((_0x5a4b3d,_0x8ce3fc)=>{var _0x5f3e62=_0x1dd6bb;_0x4f6457[_0x8ce3fc][_0x5f3e62(0x27e)]=_0x5a4b3d;}),_0x12029d[_0x1dd6bb(0x244)]((_0x12bacc,_0x3f3bfb)=>{var _0x435c25=_0x1dd6bb;_0x4f6457[_0x3f3bfb][_0x435c25(0x265)]=_0x12bacc;}),_0x2ebf07[_0x1dd6bb(0x244)]((_0x46b1d4,_0x28cb63)=>{var _0x570515=_0x1dd6bb;_0x4f6457[_0x28cb63][_0x570515(0x276)]=_0x46b1d4;}),_0x9e3ca7[_0x1dd6bb(0x244)]((_0x36aecf,_0x524128)=>{var _0x56a304=_0x1dd6bb;_0x4f6457[_0x524128][_0x56a304(0x1fd)]=_0x36aecf;});const _0x5d8fd6=_0x12029d[_0x1dd6bb(0x224)](_0x5b6016=>{return _0x5b6016={'room_name':_0x5b6016};}),_0x4eb901=_0x4f6457['filter'](_0x4eb04e=>_0x4eb04e['quantity']!=='0'&&_0x4eb04e[_0x1dd6bb(0x1d4)]!==''),_0x337c49=new purchases({'invoice':_0x2180aa,'suppliers':_0x5d62f6[_0x1dd6bb(0x211)][_0x1dd6bb(0x23e)],'date':_0x2fae3d,'warehouse_name':_0x497ff2,'product':_0x4eb901,'note':_0x4fc523,'due_amount':_0x58dbe3,'POnumber':_0x3ae5a2,'SCRN':_0x1a0da4,'JO_number':_0x8399ce,'roomList':_0x5d8fd6}),_0xc0d22e=await _0x337c49[_0x1dd6bb(0x29d)](),_0x5d179f=await purchases[_0x1dd6bb(0x2ca)]({'invoice':_0x2180aa}),_0x5ea90c=_0x5d179f['product']['map'](async _0xbe1e5d=>{var _0x302e53=_0x1dd6bb,_0x4e14b2=await warehouse[_0x302e53(0x2ca)]({'name':_0x497ff2,'room':_0xbe1e5d[_0x302e53(0x265)]}),_0x4e382f=0x0;return _0x4e14b2[_0x302e53(0x1e0)]['forEach'](_0x55d491=>{var _0x5f5772=_0x302e53;_0x55d491[_0x5f5772(0x277)]==_0xbe1e5d[_0x5f5772(0x277)]&&_0x55d491['floorlevel']==_0xbe1e5d['floorlevel']&&_0x55d491[_0x5f5772(0x2ce)]==_0xbe1e5d[_0x5f5772(0x2ce)]&&_0x55d491[_0x5f5772(0x29e)]==_0xbe1e5d[_0x5f5772(0x29e)]&&_0x55d491[_0x5f5772(0x231)]==_0xbe1e5d[_0x5f5772(0x231)]&&_0x55d491[_0x5f5772(0x228)]==_0xbe1e5d[_0x5f5772(0x228)]&&_0x55d491['storage']==_0xbe1e5d[_0x5f5772(0x28b)]&&_0x55d491['expiry_date']==_0xbe1e5d[_0x5f5772(0x214)]&&_0x55d491[_0x5f5772(0x252)]==_0xbe1e5d[_0x5f5772(0x252)]&&_0x55d491[_0x5f5772(0x2b7)]==_0xbe1e5d[_0x5f5772(0x2b7)]&&_0x55d491[_0x5f5772(0x1fd)]==_0x5d179f[_0x5f5772(0x1fd)]&&(_0x55d491[_0x5f5772(0x215)]+=Math[_0x5f5772(0x1f9)](_0xbe1e5d['quantity']),_0x4e382f++);}),_0x4e382f===0x0&&_0x4e14b2[_0x302e53(0x1e0)]['push']({'product_name':_0xbe1e5d[_0x302e53(0x277)],'product_stock':Math[_0x302e53(0x1f9)](_0xbe1e5d['quantity']),'primary_code':_0xbe1e5d['primary_code'],'secondary_code':_0xbe1e5d['secondary_code'],'product_code':_0xbe1e5d[_0x302e53(0x2e3)],'storage':_0xbe1e5d['storage'],'rack':_0xbe1e5d[_0x302e53(0x228)],'bay':_0xbe1e5d[_0x302e53(0x231)],'bin':_0xbe1e5d['bin'],'type':_0xbe1e5d[_0x302e53(0x2ce)],'floorlevel':_0xbe1e5d[_0x302e53(0x25d)],'maxProducts':_0xbe1e5d['maxStocks'],'unit':_0xbe1e5d[_0x302e53(0x20e)],'secondary_unit':_0xbe1e5d['secondary_unit'],'expiry_date':_0xbe1e5d['expiry_date'],'maxPerUnit':_0xbe1e5d[_0x302e53(0x2c4)],'batch_code':_0xbe1e5d[_0x302e53(0x252)],'alertQTY':_0xbe1e5d[_0x302e53(0x25b)],'production_date':_0xbe1e5d['production_date'],'product_cat':_0xbe1e5d[_0x302e53(0x27e)],'invoice':_0xbe1e5d['invoice'],'actual_qty':Math[_0x302e53(0x1f9)](_0xbe1e5d[_0x302e53(0x269)]),'actual_uom':_0xbe1e5d[_0x302e53(0x251)]}),_0x4e14b2;});Promise['all'](_0x5ea90c)['then'](async _0x21893d=>{var _0x21e7e6=_0x1dd6bb;try{for(const _0x377a76 of _0x21893d){await _0x377a76['save']();}const _0x455baf=await master_shop['find'](),_0xe9896a=await email_settings[_0x21e7e6(0x2ca)](),_0x2b276a=await supervisor_settings[_0x21e7e6(0x1de)]();var _0x10b518=_0x5d179f[_0x21e7e6(0x204)],_0x29c9ce='',_0x4ca53a;for(_0x4ca53a in _0x10b518){_0x29c9ce+='<tr>'+_0x21e7e6(0x229)+_0x10b518[_0x4ca53a]['product_name']+_0x21e7e6(0x208)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x10b518[_0x4ca53a][_0x21e7e6(0x2e3)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x10b518[_0x4ca53a]['quantity']+_0x21e7e6(0x208)+_0x21e7e6(0x229)+_0x10b518[_0x4ca53a][_0x21e7e6(0x20e)]+'</td>'+_0x21e7e6(0x229)+_0x10b518[_0x4ca53a][_0x21e7e6(0x20b)]+_0x21e7e6(0x208)+_0x21e7e6(0x229)+_0x5d179f['warehouse_name']+_0x21e7e6(0x208)+_0x21e7e6(0x229)+_0x10b518[_0x4ca53a][_0x21e7e6(0x265)]+'</td>'+_0x21e7e6(0x229)+_0x10b518[_0x4ca53a][_0x21e7e6(0x28b)]+_0x10b518[_0x4ca53a][_0x21e7e6(0x228)]+_0x10b518[_0x4ca53a][_0x21e7e6(0x231)]+_0x10b518[_0x4ca53a][_0x21e7e6(0x29e)]+_0x10b518[_0x4ca53a][_0x21e7e6(0x2ce)][0x0]+_0x10b518[_0x4ca53a][_0x21e7e6(0x25d)]+_0x21e7e6(0x208),_0x21e7e6(0x223);}let _0x14274f=nodemailer['createTransport']({'host':_0xe9896a[_0x21e7e6(0x2d9)],'port':Number(_0xe9896a[_0x21e7e6(0x298)]),'secure':![],'auth':{'user':_0xe9896a['email'],'pass':_0xe9896a[_0x21e7e6(0x1c8)]}}),_0x504ab0={'from':_0xe9896a[_0x21e7e6(0x24b)],'to':_0x2b276a[0x0][_0x21e7e6(0x1d5)],'subject':_0x21e7e6(0x201),'attachments':[{'filename':_0x21e7e6(0x21e),'path':__dirname+_0x21e7e6(0x205)+'/upload/'+_0x455baf[0x0]['image'],'cid':_0x21e7e6(0x290)}],'html':'<!DOCTYPE\x20html>'+_0x21e7e6(0x2b0)+'</head><body>'+_0x21e7e6(0x2c0)+_0x21e7e6(0x242)+_0x21e7e6(0x2c0)+_0x21e7e6(0x2ab)+_0x21e7e6(0x2d6)+_0x21e7e6(0x2c0)+'<h2>\x20'+_0x455baf[0x0]['site_title']+'\x20</h2>'+_0x21e7e6(0x2d6)+_0x21e7e6(0x2d6)+_0x21e7e6(0x23a)+_0x21e7e6(0x2c0)+_0x21e7e6(0x1e1)+_0x21e7e6(0x246)+_0x5d179f[_0x21e7e6(0x1fd)]+'\x20'+_0x21e7e6(0x24d)+_0x21e7e6(0x1e8)+_0x5d179f[_0x21e7e6(0x1f0)]+'\x20'+_0x21e7e6(0x267)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x21e7e6(0x1c7)+'<tr>'+_0x21e7e6(0x2a5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x21e7e6(0x1cc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x21e7e6(0x240)+_0x21e7e6(0x1c2)+_0x21e7e6(0x237)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x21e7e6(0x223)+_0x21e7e6(0x207)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x29c9ce+'\x20'+_0x21e7e6(0x280)+_0x21e7e6(0x20d)+_0x21e7e6(0x2c0)+_0x21e7e6(0x28c)+_0x21e7e6(0x1be)+_0x455baf[0x0][_0x21e7e6(0x238)]+_0x21e7e6(0x1db)+_0x21e7e6(0x2d6)+_0x21e7e6(0x2d6)+'</body></html>'};_0x14274f[_0x21e7e6(0x2ac)](_0x504ab0,function(_0xf7277e,_0x405088){var _0x5a9975=_0x21e7e6;_0xf7277e?(console[_0x5a9975(0x257)](_0xf7277e),console['log'](_0x5a9975(0x1f8))):console[_0x5a9975(0x257)](_0x5a9975(0x2b4));}),_0x5d62f6[_0x21e7e6(0x2d3)](_0x21e7e6(0x210),_0x21e7e6(0x1c5)),_0x3c92f4[_0x21e7e6(0x23c)](_0x21e7e6(0x1f4));}catch(_0x11c39){console['error'](_0x11c39),_0x3c92f4[_0x21e7e6(0x262)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1dd6bb(0x287)](_0x2ed8fa=>{var _0x20ed96=_0x1dd6bb;console['error'](_0x2ed8fa),_0x3c92f4['status'](0x1f4)[_0x20ed96(0x2b2)]({'error':_0x20ed96(0x1fa)});});}catch(_0x12c0f8){console[_0x1dd6bb(0x257)](_0x12c0f8);}}),router[a0_0x4630f2(0x27d)](a0_0x4630f2(0x226),auth,async(_0x31fbe4,_0x355c62)=>{var _0x51399a=a0_0x4630f2;try{const {username:_0x3ad218,email:_0xf7b210,role:_0xa80e92}=_0x31fbe4[_0x51399a(0x2af)],_0x43f505=_0x31fbe4[_0x51399a(0x2af)],_0x27c59a=await profile[_0x51399a(0x2ca)]({'email':_0x43f505[_0x51399a(0x24b)]}),_0x1d70a4=await master_shop[_0x51399a(0x1de)](),_0x2a3e52=_0x31fbe4[_0x51399a(0x27a)]['id'],_0x44440a=await purchases[_0x51399a(0x1e6)](_0x2a3e52),_0x586b11=await warehouse[_0x51399a(0x289)]([{'$match':{'name':_0x44440a[_0x51399a(0x288)],'room':_0x44440a['room']}},{'$unwind':_0x51399a(0x274)},{'$group':{'_id':_0x51399a(0x254),'name':{'$first':_0x51399a(0x22e)},'product_stock':{'$first':_0x51399a(0x285)},'bay':{'$first':_0x51399a(0x1c9)},'bin':{'$first':_0x51399a(0x1ef)},'type':{'$first':_0x51399a(0x1f1)},'floorlevel':{'$first':_0x51399a(0x22f)},'primary_code':{'$first':_0x51399a(0x259)},'secondary_code':{'$first':_0x51399a(0x29f)},'product_code':{'$first':_0x51399a(0x236)},'storage':{'$first':_0x51399a(0x297)},'rack':{'$first':_0x51399a(0x1e7)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0xe84fd7=await customer[_0x51399a(0x1de)]({});let _0x518dcc;if(_0x43f505['role']==_0x51399a(0x29c)){const _0x2c26ab=await staff[_0x51399a(0x2ca)]({'email':_0x43f505['email']});_0x518dcc=await warehouse[_0x51399a(0x289)]([{'$match':{'status':_0x51399a(0x2cf),'name':_0x2c26ab['warehouse']}},{'$group':{'_id':_0x51399a(0x2b1),'name':{'$first':_0x51399a(0x2b1)}}}]);}else _0x518dcc=await warehouse[_0x51399a(0x289)]([{'$match':{'status':_0x51399a(0x2cf)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0xe9f94c=await product[_0x51399a(0x1de)]({}),_0xd321de=await suppliers[_0x51399a(0x1de)]({}),_0x115d70=BayBinSelected(_0x44440a[_0x51399a(0x288)],_0x44440a[_0x51399a(0x1d2)]);if(_0x1d70a4[0x0][_0x51399a(0x293)]=='English\x20(US)'){var _0x5ece96=users['English'];console[_0x51399a(0x257)](_0x5ece96);}else{if(_0x1d70a4[0x0]['language']==_0x51399a(0x26e))var _0x5ece96=users['Hindi'];else{if(_0x1d70a4[0x0][_0x51399a(0x293)]==_0x51399a(0x1e5))var _0x5ece96=users[_0x51399a(0x1e5)];else{if(_0x1d70a4[0x0]['language']=='Spanish')var _0x5ece96=users[_0x51399a(0x26a)];else{if(_0x1d70a4[0x0][_0x51399a(0x293)]==_0x51399a(0x2c9))var _0x5ece96=users[_0x51399a(0x2c9)];else{if(_0x1d70a4[0x0][_0x51399a(0x293)]==_0x51399a(0x1c1))var _0x5ece96=users[_0x51399a(0x2cc)];else{if(_0x1d70a4[0x0][_0x51399a(0x293)]==_0x51399a(0x24e))var _0x5ece96=users[_0x51399a(0x24e)];else{if(_0x1d70a4[0x0][_0x51399a(0x293)]==_0x51399a(0x29b))var _0x5ece96=users['Arabic'];}}}}}}}_0x355c62[_0x51399a(0x299)](_0x51399a(0x245),{'success':_0x31fbe4[_0x51399a(0x2d3)](_0x51399a(0x210)),'errors':_0x31fbe4[_0x51399a(0x2d3)](_0x51399a(0x260)),'role':_0x43f505,'profile':_0x27c59a,'customer':_0xe84fd7,'warehouse':_0x518dcc,'product':_0x586b11,'user':_0x44440a,'master_shop':_0x1d70a4,'unit':_0xe9f94c,'language':_0x5ece96,'suppliers':_0xd321de,'dataSelected':_0x115d70});}catch(_0x43ae81){console['log'](_0x43ae81);}}),router[a0_0x4630f2(0x25f)](a0_0x4630f2(0x226),auth,async(_0x40caef,_0xecb6d1)=>{var _0x40e707=a0_0x4630f2;try{const _0x1a83e8=_0x40caef[_0x40e707(0x27a)]['id'],{invoice:_0xfb9d6f,warehouse_name:_0x1aa2a9,Room_name:_0x10dd0a}=_0x40caef[_0x40e707(0x211)],_0x1cf068=await warehouse[_0x40e707(0x2ca)]({'name':_0x1aa2a9,'room':_0x10dd0a}),_0x307c69=await purchases[_0x40e707(0x2ca)]({'invoice':_0xfb9d6f});_0x307c69[_0x40e707(0x204)]['forEach'](_0x18d3f0=>{var _0x28d31f=_0x40e707,_0x11721a=0x0;const _0x1bddd7=_0x1cf068[_0x28d31f(0x1e0)][_0x28d31f(0x224)](_0x5a061c=>{var _0x3d1e96=_0x28d31f;_0x5a061c[_0x3d1e96(0x277)]==_0x18d3f0[_0x3d1e96(0x277)]&&_0x5a061c[_0x3d1e96(0x25d)]==_0x18d3f0[_0x3d1e96(0x25d)]&&_0x5a061c['type']==_0x18d3f0[_0x3d1e96(0x2ce)]&&_0x5a061c[_0x3d1e96(0x29e)]==_0x18d3f0[_0x3d1e96(0x29e)]&&_0x5a061c[_0x3d1e96(0x231)]==_0x18d3f0[_0x3d1e96(0x231)]&&_0x5a061c[_0x3d1e96(0x228)]==_0x18d3f0[_0x3d1e96(0x228)]&&_0x5a061c[_0x3d1e96(0x28b)]==_0x18d3f0[_0x3d1e96(0x28b)]&&_0x5a061c[_0x3d1e96(0x214)]==_0x18d3f0['expiry_date']&&_0x5a061c['batch_code']==_0x18d3f0[_0x3d1e96(0x252)]&&_0x5a061c['production_date']==_0x18d3f0[_0x3d1e96(0x2b7)]&&_0x5a061c[_0x3d1e96(0x28f)]==_0x18d3f0[_0x3d1e96(0x28f)]&&_0x5a061c['delivery_code']==_0x18d3f0['delivery_code']&&(_0x5a061c[_0x3d1e96(0x215)]=parseInt(_0x5a061c[_0x3d1e96(0x215)])+parseInt(_0x18d3f0['quantity']),_0x11721a++);});_0x11721a=='0'&&(_0x1cf068[_0x28d31f(0x1e0)]=_0x1cf068[_0x28d31f(0x1e0)][_0x28d31f(0x200)]({'product_name':_0x18d3f0[_0x28d31f(0x277)],'product_stock':_0x18d3f0[_0x28d31f(0x1d4)],'primary_code':_0x18d3f0[_0x28d31f(0x1d9)],'secondary_code':_0x18d3f0[_0x28d31f(0x266)],'product_code':_0x18d3f0[_0x28d31f(0x2e3)],'storage':_0x18d3f0[_0x28d31f(0x28b)],'rack':_0x18d3f0['rack'],'bay':_0x18d3f0['bay'],'bin':_0x18d3f0[_0x28d31f(0x29e)],'type':_0x18d3f0['type'],'floorlevel':_0x18d3f0['floorlevel'],'maxProducts':_0x18d3f0['maxStocks'],'unit':_0x18d3f0['standard_unit'],'secondary_unit':_0x18d3f0[_0x28d31f(0x20b)],'expiry_date':_0x18d3f0[_0x28d31f(0x214)],'maxPerUnit':_0x18d3f0[_0x28d31f(0x2c4)],'batch_code':_0x18d3f0[_0x28d31f(0x252)],'alertQTY':_0x18d3f0[_0x28d31f(0x25b)],'production_date':_0x18d3f0[_0x28d31f(0x2b7)],'delivery_date':_0x18d3f0[_0x28d31f(0x28f)],'delivery_code':_0x18d3f0[_0x28d31f(0x276)]}));}),await _0x1cf068[_0x40e707(0x29d)](),_0x307c69[_0x40e707(0x1fc)]=_0x40e707(0x291);const _0x39f1ce=await _0x307c69[_0x40e707(0x29d)]();_0x40caef[_0x40e707(0x2d3)](_0x40e707(0x210),_0x40e707(0x1d6)),_0xecb6d1[_0x40e707(0x23c)](_0x40e707(0x2dd));}catch(_0x2d9d38){console[_0x40e707(0x257)](_0x2d9d38);}}),router[a0_0x4630f2(0x27d)](a0_0x4630f2(0x1d7),auth,async(_0x184b80,_0x40c089)=>{var _0x544c6f=a0_0x4630f2;try{const {username:_0x59e416,email:_0x19bd61,role:_0x10c609}=_0x184b80[_0x544c6f(0x2af)],_0x4044a3=_0x184b80[_0x544c6f(0x2af)],_0x225e6b=await profile[_0x544c6f(0x2ca)]({'email':_0x4044a3[_0x544c6f(0x24b)]}),_0x2425dd=await master_shop[_0x544c6f(0x1de)](),_0x536b76=_0x184b80['params']['id'],_0x1f0745=await purchases['findById'](_0x536b76),_0x38b713=await suppliers['find']({});let _0x36dea3;if(_0x4044a3[_0x544c6f(0x1c4)]==_0x544c6f(0x29c)){const _0x452261=await staff['findOne']({'email':_0x4044a3[_0x544c6f(0x24b)]});_0x36dea3=await warehouse[_0x544c6f(0x1de)]({'status':_0x544c6f(0x2cf),'name':_0x452261[_0x544c6f(0x241)],'warehouse_category':'Raw\x20Materials'});}else _0x36dea3=await warehouse[_0x544c6f(0x289)]([{'$match':{'status':_0x544c6f(0x2cf),'warehouse_category':_0x544c6f(0x1f6)}},{'$group':{'_id':_0x544c6f(0x2b1),'name':{'$first':'$name'}}}]);const _0x447122=await product[_0x544c6f(0x1de)]({}),_0x54971e=BayBinSelected(_0x1f0745[_0x544c6f(0x288)],_0x1f0745[_0x544c6f(0x1d2)]);let _0x5c1678=new Date(_0x1f0745['expiry_date']),_0x28e233=('0'+_0x5c1678[_0x544c6f(0x2d7)]())[_0x544c6f(0x248)](-0x2),_0x490c9b=('0'+(_0x5c1678[_0x544c6f(0x1eb)]()+0x1))['slice'](-0x2),_0x7ef14b=_0x5c1678['getFullYear'](),_0xad0755=_0x7ef14b+'-'+_0x490c9b+'-'+_0x28e233;if(_0x2425dd[0x0][_0x544c6f(0x293)]=='English\x20(US)'){var _0x111abb=users[_0x544c6f(0x28d)];console[_0x544c6f(0x257)](_0x111abb);}else{if(_0x2425dd[0x0]['language']==_0x544c6f(0x26e))var _0x111abb=users[_0x544c6f(0x26e)];else{if(_0x2425dd[0x0]['language']==_0x544c6f(0x1e5))var _0x111abb=users['German'];else{if(_0x2425dd[0x0][_0x544c6f(0x293)]==_0x544c6f(0x26a))var _0x111abb=users[_0x544c6f(0x26a)];else{if(_0x2425dd[0x0]['language']==_0x544c6f(0x2c9))var _0x111abb=users[_0x544c6f(0x2c9)];else{if(_0x2425dd[0x0][_0x544c6f(0x293)]==_0x544c6f(0x1c1))var _0x111abb=users[_0x544c6f(0x2cc)];else{if(_0x2425dd[0x0]['language']==_0x544c6f(0x24e))var _0x111abb=users['Chinese'];else{if(_0x2425dd[0x0][_0x544c6f(0x293)]==_0x544c6f(0x29b))var _0x111abb=users['Arabic'];}}}}}}}_0x40c089[_0x544c6f(0x299)](_0x544c6f(0x2da),{'success':_0x184b80[_0x544c6f(0x2d3)](_0x544c6f(0x210)),'errors':_0x184b80[_0x544c6f(0x2d3)]('errors'),'role':_0x4044a3,'profile':_0x225e6b,'purchases':_0x1f0745,'suppliers':_0x38b713,'warehouse':_0x36dea3,'product':_0x447122,'master_shop':_0x2425dd,'language':_0x111abb,'ed_fullDate':_0xad0755,'dataSelected':_0x54971e});}catch(_0x5021b4){console['log'](_0x5021b4);}}),router[a0_0x4630f2(0x25f)](a0_0x4630f2(0x1d7),auth,async(_0x31405c,_0x4d4bfc)=>{var _0x3da7b6=a0_0x4630f2;try{const _0x44f76f=_0x31405c['params']['id'],_0x1104d6=await purchases[_0x3da7b6(0x2ca)]({'_id':_0x31405c['params']['id']}),_0x1e8214=await warehouse[_0x3da7b6(0x2ca)]({'name':_0x1104d6[_0x3da7b6(0x288)],'room':_0x1104d6[_0x3da7b6(0x1d2)]});_0x1104d6['product'][_0x3da7b6(0x244)](_0x10e5f6=>{var _0x309049=_0x3da7b6;const _0x4ffce4=_0x1e8214[_0x309049(0x1e0)][_0x309049(0x224)](_0x2e9369=>{var _0x16acf3=_0x309049;_0x2e9369[_0x16acf3(0x277)]==_0x10e5f6[_0x16acf3(0x277)]&&_0x2e9369[_0x16acf3(0x25d)]==_0x10e5f6[_0x16acf3(0x25d)]&&_0x2e9369['type']==_0x10e5f6[_0x16acf3(0x2ce)]&&_0x2e9369[_0x16acf3(0x29e)]==_0x10e5f6[_0x16acf3(0x29e)]&&_0x2e9369['bay']==_0x10e5f6[_0x16acf3(0x231)]&&_0x2e9369[_0x16acf3(0x228)]==_0x10e5f6[_0x16acf3(0x228)]&&_0x2e9369[_0x16acf3(0x28b)]==_0x10e5f6[_0x16acf3(0x28b)]&&(_0x2e9369[_0x16acf3(0x215)]=parseInt(_0x2e9369[_0x16acf3(0x215)])-parseInt(_0x10e5f6['quantity']));});}),await _0x1e8214[_0x3da7b6(0x29d)]();const {invoice:_0x4ae321,suppliers:_0xa9611f,date:_0x305856,warehouse_name:_0x69fff1,prod_name:_0x44b9b9,prod_code:_0x709572,prod_qty:_0x54a9c5,prod_unit:_0x21b9a4,prod_secondunit:_0x6b8a8d,prod_level:_0xad4fba,prod_isle:_0x1824dc,prod_pallet:_0x459d20,note:_0x699310,expiry_date:_0x152048,batch_code:_0x235fca,paid_amount:_0x3e55bb,due_amount:_0x36dd5d,Room_name:_0x31552c,primary_code:_0x2e09c9,secondary_code:_0x12b46a,PO_number:_0x3ad801,JO_number:_0x2d6469}=_0x31405c[_0x3da7b6(0x211)];if(typeof _0x44b9b9==_0x3da7b6(0x2c1))var _0x5584c0=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x218)]],_0xdbcc31=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x239)]],_0x5a24ce=[_0x31405c['body']['prod_qty']],_0x175194=[_0x31405c[_0x3da7b6(0x211)]['prod_unit']],_0x466952=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2c5)]],_0x522a50=[_0x31405c[_0x3da7b6(0x211)]['prod_level']],_0x3b6c6d=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2c7)]],_0x1382c6=[_0x31405c['body'][_0x3da7b6(0x2ae)]],_0x5d2652=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x1d9)]],_0x459c5a=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x266)]],_0x5e5128=[_0x31405c[_0x3da7b6(0x211)]['MaxStocks_data']],_0x4e6e40=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x252)]],_0x56f419=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x214)]],_0xb3edf9=[_0x31405c['body'][_0x3da7b6(0x28b)]],_0x2454e1=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2a0)]],_0x3d1c76=[_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2ce)]];else var _0x5584c0=[..._0x31405c['body'][_0x3da7b6(0x218)]],_0xdbcc31=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x239)]],_0x5a24ce=[..._0x31405c['body'][_0x3da7b6(0x2d8)]],_0x175194=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2a7)]],_0x466952=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2c5)]],_0x522a50=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x1d8)]],_0x3b6c6d=[..._0x31405c[_0x3da7b6(0x211)]['prod_isle']],_0x1382c6=[..._0x31405c['body'][_0x3da7b6(0x2ae)]],_0x5d2652=[..._0x31405c['body'][_0x3da7b6(0x1d9)]],_0x459c5a=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x266)]],_0x5e5128=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2b5)]],_0x4e6e40=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x252)]],_0x56f419=[..._0x31405c['body'][_0x3da7b6(0x214)]],_0xb3edf9=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x28b)]],_0x2454e1=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2a0)]],_0x3d1c76=[..._0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2ce)]];const _0x249119=_0x5584c0[_0x3da7b6(0x224)](_0x1e9f6e=>{return _0x1e9f6e={'product_name':_0x1e9f6e};});_0xdbcc31[_0x3da7b6(0x244)]((_0x97b022,_0x22d527)=>{_0x249119[_0x22d527]['product_code']=_0x97b022;}),_0x5a24ce[_0x3da7b6(0x244)]((_0x3bf651,_0x34f28e)=>{var _0x11b6ac=_0x3da7b6;_0x249119[_0x34f28e][_0x11b6ac(0x1d4)]=_0x3bf651;}),_0x175194[_0x3da7b6(0x244)]((_0x57db86,_0x1f5baf)=>{var _0x5a3529=_0x3da7b6;_0x249119[_0x1f5baf][_0x5a3529(0x20e)]=_0x57db86;}),_0x466952[_0x3da7b6(0x244)]((_0x59f8c3,_0x50bf36)=>{var _0x299b93=_0x3da7b6;_0x249119[_0x50bf36][_0x299b93(0x20b)]=_0x59f8c3;}),_0x522a50[_0x3da7b6(0x244)]((_0x257fbc,_0x2b1478)=>{var _0x21a8bf=_0x3da7b6;_0x249119[_0x2b1478][_0x21a8bf(0x231)]=_0x257fbc;}),_0x3b6c6d[_0x3da7b6(0x244)]((_0x4d1569,_0x5cafc1)=>{_0x249119[_0x5cafc1]['bin']=_0x4d1569;}),_0x1382c6[_0x3da7b6(0x244)]((_0x3e2a8a,_0x551aa1)=>{var _0x12c122=_0x3da7b6;_0x249119[_0x551aa1][_0x12c122(0x25d)]=_0x3e2a8a;}),_0x5d2652[_0x3da7b6(0x244)]((_0x58b98b,_0xc4d916)=>{var _0x21f0e8=_0x3da7b6;_0x249119[_0xc4d916][_0x21f0e8(0x1d9)]=_0x58b98b;}),_0x459c5a['forEach']((_0x40d7c0,_0x2cd5d6)=>{var _0x3ec7b8=_0x3da7b6;_0x249119[_0x2cd5d6][_0x3ec7b8(0x266)]=_0x40d7c0;}),_0x5e5128[_0x3da7b6(0x244)]((_0x865cf3,_0xf8470d)=>{var _0x158076=_0x3da7b6;_0x249119[_0xf8470d][_0x158076(0x296)]=_0x865cf3;}),_0x4e6e40['forEach']((_0x4fbab3,_0x25247f)=>{var _0x5f4ecd=_0x3da7b6;_0x249119[_0x25247f][_0x5f4ecd(0x252)]=_0x4fbab3;}),_0x56f419[_0x3da7b6(0x244)]((_0x4a68d2,_0x266628)=>{var _0x49eeac=_0x3da7b6;_0x249119[_0x266628][_0x49eeac(0x214)]=_0x4a68d2;}),_0x3d1c76[_0x3da7b6(0x244)]((_0x58fdd7,_0xc09de4)=>{_0x249119[_0xc09de4]['type']=_0x58fdd7;}),_0xb3edf9[_0x3da7b6(0x244)]((_0x3ca70e,_0x2789da)=>{var _0x41c7fd=_0x3da7b6;_0x249119[_0x2789da][_0x41c7fd(0x28b)]=_0x3ca70e;}),_0x2454e1['forEach']((_0x418f70,_0x1e8e46)=>{var _0x2d70cd=_0x3da7b6;_0x249119[_0x1e8e46][_0x2d70cd(0x228)]=_0x418f70;});const _0x85a63=_0x249119[_0x3da7b6(0x2a4)](_0x16e021=>_0x16e021[_0x3da7b6(0x1d4)]!=='0'&&_0x16e021[_0x3da7b6(0x1d4)]!=='');_0x1104d6[_0x3da7b6(0x1fd)]=_0x4ae321,_0x1104d6[_0x3da7b6(0x23e)]=_0xa9611f,_0x1104d6[_0x3da7b6(0x1f0)]=_0x305856,_0x1104d6[_0x3da7b6(0x288)]=_0x69fff1,_0x1104d6['product']=_0x85a63,_0x1104d6['note']=_0x699310,_0x1104d6[_0x3da7b6(0x1bf)]=_0x3e55bb,_0x1104d6[_0x3da7b6(0x2a2)]=_0x36dd5d,_0x1104d6[_0x3da7b6(0x1d2)]=_0x31552c,_0x1104d6[_0x3da7b6(0x26f)]=_0x3ad801,_0x1104d6[_0x3da7b6(0x1dc)]=_0x2d6469;const _0xd0e811=await _0x1104d6[_0x3da7b6(0x29d)](),_0x4a3ff3=await warehouse[_0x3da7b6(0x2ca)]({'name':_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x288)],'room':_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x2d1)]});_0x1104d6[_0x3da7b6(0x204)][_0x3da7b6(0x244)](_0x3e10dc=>{var _0x3eddaf=_0x3da7b6,_0x2f93c3=0x0;const _0x4dd480=_0x4a3ff3['product_details']['map'](_0x306fa9=>{var _0x59d722=a0_0x3983;_0x306fa9[_0x59d722(0x277)]==_0x3e10dc[_0x59d722(0x277)]&&_0x306fa9[_0x59d722(0x25d)]==_0x3e10dc[_0x59d722(0x25d)]&&_0x306fa9[_0x59d722(0x2ce)]==_0x3e10dc[_0x59d722(0x2ce)]&&_0x306fa9['bin']==_0x3e10dc[_0x59d722(0x29e)]&&_0x306fa9['bay']==_0x3e10dc['bay']&&_0x306fa9[_0x59d722(0x228)]==_0x3e10dc[_0x59d722(0x228)]&&_0x306fa9[_0x59d722(0x28b)]==_0x3e10dc[_0x59d722(0x28b)]&&(_0x306fa9['product_stock']=parseInt(_0x306fa9[_0x59d722(0x215)])+parseInt(_0x3e10dc[_0x59d722(0x1d4)]),_0x2f93c3++);});_0x2f93c3=='0'&&(_0x4a3ff3[_0x3eddaf(0x1e0)]=_0x4a3ff3[_0x3eddaf(0x1e0)][_0x3eddaf(0x200)]({'product_name':_0x3e10dc[_0x3eddaf(0x277)],'product_stock':_0x3e10dc[_0x3eddaf(0x1d4)],'primary_code':_0x3e10dc[_0x3eddaf(0x1d9)],'secondary_code':_0x3e10dc[_0x3eddaf(0x266)],'product_code':_0x3e10dc[_0x3eddaf(0x2e3)],'storage':_0x3e10dc[_0x3eddaf(0x28b)],'rack':_0x3e10dc[_0x3eddaf(0x228)],'bay':_0x3e10dc[_0x3eddaf(0x231)],'bin':_0x3e10dc['bin'],'type':_0x3e10dc[_0x3eddaf(0x2ce)],'floorlevel':_0x3e10dc[_0x3eddaf(0x25d)],'maxProducts':_0x3e10dc[_0x3eddaf(0x296)],'unit':_0x3e10dc['standard_unit'],'secondary_unit':_0x3e10dc[_0x3eddaf(0x20b)],'expiry_date':_0x3e10dc[_0x3eddaf(0x214)]}));}),await _0x4a3ff3['save']();const _0x3d0f9c=await s_payment_data['findOne']({'invoice':_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x1fd)]});if(_0x3d0f9c===null){}else console[_0x3da7b6(0x257)](_0x3da7b6(0x23e),_0x3d0f9c,_0x31405c['body'][_0x3da7b6(0x1fd)]),_0x3d0f9c['suppliers']=_0x31405c[_0x3da7b6(0x211)][_0x3da7b6(0x23e)],await _0x3d0f9c['save']();_0x31405c[_0x3da7b6(0x2d3)](_0x3da7b6(0x210),'purchase\x20data\x20update\x20successfully'),_0x4d4bfc['redirect']('/all_purchases/view');}catch(_0x271f85){console['log'](_0x271f85);}}),router[a0_0x4630f2(0x25f)]('/give_payment/:id',auth,async(_0x4ed830,_0xbb6027)=>{var _0x51e0f0=a0_0x4630f2;try{const _0xdd23cf=_0x4ed830[_0x51e0f0(0x27a)]['id'],{invoice:_0x8ce7b1,suppliers:_0x3082f4,payable:_0x2c4f1c,due_amount:_0x38ca7e}=_0x4ed830[_0x51e0f0(0x211)],_0x1570da=await purchases[_0x51e0f0(0x1e6)](_0xdd23cf);var _0x4d5bb3=_0x2c4f1c-_0x38ca7e;_0x1570da[_0x51e0f0(0x1bf)]=parseFloat(_0x1570da[_0x51e0f0(0x1bf)])+parseFloat(_0x38ca7e),_0x1570da[_0x51e0f0(0x2a2)]=_0x4d5bb3;const _0x5c2952=await _0x1570da[_0x51e0f0(0x29d)]();console['log'](_0x5c2952);const _0x836abc=await s_payment_data[_0x51e0f0(0x2ca)]({'invoice':_0x8ce7b1});_0x836abc[_0x51e0f0(0x1d0)]=_0x4d5bb3,await _0x836abc[_0x51e0f0(0x29d)]();let _0x3ec07f=new Date(),_0x28093d=('0'+_0x3ec07f['getDate']())[_0x51e0f0(0x248)](-0x2),_0x4d92b7=('0'+(_0x3ec07f[_0x51e0f0(0x1eb)]()+0x1))['slice'](-0x2),_0x511717=_0x3ec07f['getFullYear'](),_0x47b7eb=_0x511717+'-'+_0x4d92b7+'-'+_0x28093d;const _0x379634=new suppliers_payment({'invoice':_0x8ce7b1,'date':_0x511717+'-'+_0x4d92b7+'-'+_0x28093d,'suppliers':_0x3082f4,'reason':_0x51e0f0(0x25a),'amount':_0x38ca7e}),_0x49d53d=await _0x379634[_0x51e0f0(0x29d)]();_0x4ed830[_0x51e0f0(0x2d3)](_0x51e0f0(0x210),_0x51e0f0(0x22b)),_0xbb6027[_0x51e0f0(0x23c)](_0x51e0f0(0x2dd));}catch(_0x33d7fa){console[_0x51e0f0(0x257)](_0x33d7fa);}}),router[a0_0x4630f2(0x27d)](a0_0x4630f2(0x1cd),auth,async(_0x5c2bab,_0x423d6f)=>{var _0x1af679=a0_0x4630f2;try{const {username:_0x3cfb69,email:_0x5cca59,role:_0x57e5e7}=_0x5c2bab[_0x1af679(0x2af)],_0x42beb4=_0x5c2bab[_0x1af679(0x2af)],_0xd8a32c=await profile['findOne']({'email':_0x42beb4['email']}),_0x476fd2=await master_shop[_0x1af679(0x1de)]();console[_0x1af679(0x257)](_0x1af679(0x21a),_0x476fd2);const _0x3c1a4a=_0x5c2bab[_0x1af679(0x27a)]['id'],_0x2a109b=await purchases[_0x1af679(0x1e6)](_0x3c1a4a);console[_0x1af679(0x257)](_0x2a109b);const _0x260c0d=await suppliers[_0x1af679(0x2ca)]({'name':_0x2a109b['suppliers']});console[_0x1af679(0x257)](_0x260c0d);if(_0x476fd2[0x0][_0x1af679(0x293)]=='English\x20(US)'){var _0x2841ea=users[_0x1af679(0x28d)];console[_0x1af679(0x257)](_0x2841ea);}else{if(_0x476fd2[0x0][_0x1af679(0x293)]==_0x1af679(0x26e))var _0x2841ea=users[_0x1af679(0x26e)];else{if(_0x476fd2[0x0][_0x1af679(0x293)]==_0x1af679(0x1e5))var _0x2841ea=users[_0x1af679(0x1e5)];else{if(_0x476fd2[0x0][_0x1af679(0x293)]=='Spanish')var _0x2841ea=users[_0x1af679(0x26a)];else{if(_0x476fd2[0x0][_0x1af679(0x293)]==_0x1af679(0x2c9))var _0x2841ea=users[_0x1af679(0x2c9)];else{if(_0x476fd2[0x0][_0x1af679(0x293)]==_0x1af679(0x1c1))var _0x2841ea=users[_0x1af679(0x2cc)];else{if(_0x476fd2[0x0][_0x1af679(0x293)]==_0x1af679(0x24e))var _0x2841ea=users['Chinese'];else{if(_0x476fd2[0x0][_0x1af679(0x293)]==_0x1af679(0x29b))var _0x2841ea=users['Arabic'];}}}}}}}_0x423d6f[_0x1af679(0x299)]('purchase_invoice',{'success':_0x5c2bab[_0x1af679(0x2d3)](_0x1af679(0x210)),'errors':_0x5c2bab[_0x1af679(0x2d3)]('errors'),'role':_0x42beb4,'profile':_0xd8a32c,'master_shop':_0x476fd2,'supplier':_0x260c0d,'purchase':_0x2a109b,'language':_0x2841ea});}catch(_0x2d5f6f){console[_0x1af679(0x257)](_0x2d5f6f);}}),router[a0_0x4630f2(0x27d)](a0_0x4630f2(0x1d3),auth,async(_0x3a6ea4,_0x5ab361)=>{var _0x5e727c=a0_0x4630f2;try{const {username:_0x382420,email:_0x2eced4,role:_0x3339d6}=_0x3a6ea4[_0x5e727c(0x2af)],_0x62cbb5=_0x3a6ea4['user'],_0x1bcd80=await profile[_0x5e727c(0x2ca)]({'email':_0x62cbb5['email']}),_0x3d3ece=await master_shop['find']();console['log']('master',_0x3d3ece);const _0x55286f=_0x3a6ea4[_0x5e727c(0x27a)]['id'];console[_0x5e727c(0x257)](_0x55286f);const _0xa28e74=await purchases['findById'](_0x55286f);console[_0x5e727c(0x257)]('user_id',_0xa28e74);const _0x37158c=await product['find']({}),_0x58e26a=await warehouse[_0x5e727c(0x289)]([{'$match':{'name':_0xa28e74[_0x5e727c(0x288)],'room':_0xa28e74[_0x5e727c(0x1d2)],'warehouse_category':_0x5e727c(0x1f6)}},{'$unwind':_0x5e727c(0x274)},{'$group':{'_id':_0x5e727c(0x254),'name':{'$first':_0x5e727c(0x22e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5e727c(0x1c9)},'bin':{'$first':_0x5e727c(0x1ef)},'type':{'$first':_0x5e727c(0x1f1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5e727c(0x259)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5e727c(0x297)},'rack':{'$first':_0x5e727c(0x1e7)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x5e727c(0x1f6)}},{'$group':{'_id':'$name','name':{'$first':_0x5e727c(0x2b1)}}},{'$sort':{'name':0x1}}]),console[_0x5e727c(0x257)]('stock_data',_0x58e26a);if(_0x3d3ece[0x0][_0x5e727c(0x293)]==_0x5e727c(0x212)){var _0x1a1e95=users['English'];console[_0x5e727c(0x257)](_0x1a1e95);}else{if(_0x3d3ece[0x0]['language']==_0x5e727c(0x26e))var _0x1a1e95=users[_0x5e727c(0x26e)];else{if(_0x3d3ece[0x0][_0x5e727c(0x293)]=='German')var _0x1a1e95=users[_0x5e727c(0x1e5)];else{if(_0x3d3ece[0x0][_0x5e727c(0x293)]==_0x5e727c(0x26a))var _0x1a1e95=users[_0x5e727c(0x26a)];else{if(_0x3d3ece[0x0][_0x5e727c(0x293)]=='French')var _0x1a1e95=users[_0x5e727c(0x2c9)];else{if(_0x3d3ece[0x0]['language']==_0x5e727c(0x1c1))var _0x1a1e95=users[_0x5e727c(0x2cc)];else{if(_0x3d3ece[0x0][_0x5e727c(0x293)]==_0x5e727c(0x24e))var _0x1a1e95=users[_0x5e727c(0x24e)];else{if(_0x3d3ece[0x0][_0x5e727c(0x293)]==_0x5e727c(0x29b))var _0x1a1e95=users['Arabic'];}}}}}}}_0x5ab361[_0x5e727c(0x299)](_0x5e727c(0x1dd),{'success':_0x3a6ea4[_0x5e727c(0x2d3)]('success'),'errors':_0x3a6ea4[_0x5e727c(0x2d3)](_0x5e727c(0x260)),'role':_0x62cbb5,'profile':_0x1bcd80,'user':_0xa28e74,'stock':_0x58e26a,'master_shop':_0x3d3ece,'product':_0x37158c,'language':_0x1a1e95,'warehouse':warehouse_data});}catch(_0x24cf0c){console['log'](_0x24cf0c);}}),router['post'](a0_0x4630f2(0x1d3),auth,async(_0x1f05eb,_0x118de4)=>{var _0x5b3e74=a0_0x4630f2;try{const {invoice:_0x260f98,date:_0x386314,warehouse_name:_0x520d00,Room_name:_0x2f7193,product_name:_0x1c6e09,purchase_quantity:_0x264138,stocks:_0x11de7c,return_qty:_0x2a7941,note:_0x398c5b,level:_0x341e39,isle:_0x2fcb74,pallet:_0x1f3216,to_warehouse_name:_0x38d975,to_Room_name:_0xfb25ff}=_0x1f05eb[_0x5b3e74(0x211)],_0x4b083c=await purchases[_0x5b3e74(0x2ca)]({'_id':_0x1f05eb['params']['id']}),_0x1bec32=await warehouse[_0x5b3e74(0x2ca)]({'name':_0x520d00,'room':_0x2f7193});if(typeof _0x1c6e09==_0x5b3e74(0x2c1))var _0x587749=[_0x1f05eb['body'][_0x5b3e74(0x277)]],_0x242bff=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1fb)]],_0x461178=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1f7)]],_0x19c3e0=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x255)]],_0x1155d2=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1d1)]],_0x352c6f=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x2be)]],_0x205d0b=[_0x1f05eb['body'][_0x5b3e74(0x2c3)]],_0x42e303=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1cf)]],_0x2c9a73=[_0x1f05eb['body'][_0x5b3e74(0x2bb)]],_0x4f2bd1=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x217)]],_0x7c5c1f=[_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x295)]];else var _0x587749=[..._0x1f05eb['body'][_0x5b3e74(0x277)]],_0x242bff=[..._0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1fb)]],_0x461178=[..._0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1f7)]],_0x19c3e0=[..._0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x255)]],_0x1155d2=[..._0x1f05eb['body'][_0x5b3e74(0x1d1)]],_0x352c6f=[..._0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x2be)]],_0x205d0b=[..._0x1f05eb[_0x5b3e74(0x211)]['pallet']],_0x42e303=[..._0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x1cf)]],_0x2c9a73=[..._0x1f05eb[_0x5b3e74(0x211)]['product_code_hide']],_0x4f2bd1=[..._0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x217)]],_0x7c5c1f=[..._0x1f05eb['body'][_0x5b3e74(0x295)]];const _0x4e75c4=_0x587749[_0x5b3e74(0x224)](_0x20831c=>{return _0x20831c={'product_name':_0x20831c};});_0x242bff[_0x5b3e74(0x244)]((_0x4d7220,_0x43ce76)=>{_0x4e75c4[_0x43ce76]['purchase_quantity']=_0x4d7220;}),_0x461178[_0x5b3e74(0x244)]((_0x53aaaa,_0x3eb109)=>{var _0x40ffc6=_0x5b3e74;_0x4e75c4[_0x3eb109][_0x40ffc6(0x22c)]=_0x53aaaa;}),_0x19c3e0[_0x5b3e74(0x244)]((_0xc926d2,_0x29b1ba)=>{var _0x22abef=_0x5b3e74;_0x4e75c4[_0x29b1ba][_0x22abef(0x255)]=_0xc926d2;}),_0x1155d2[_0x5b3e74(0x244)]((_0x3f123a,_0x2929bf)=>{var _0x40eeea=_0x5b3e74;_0x4e75c4[_0x2929bf][_0x40eeea(0x231)]=_0x3f123a;}),_0x352c6f[_0x5b3e74(0x244)]((_0x145422,_0x57d1bf)=>{var _0xbc04e2=_0x5b3e74;_0x4e75c4[_0x57d1bf][_0xbc04e2(0x29e)]=_0x145422;}),_0x205d0b[_0x5b3e74(0x244)]((_0x5b530f,_0x5ac150)=>{var _0x48a798=_0x5b3e74;_0x4e75c4[_0x5ac150][_0x48a798(0x25d)]=_0x5b530f;}),_0x42e303[_0x5b3e74(0x244)]((_0x588092,_0x3fa607)=>{var _0x54c400=_0x5b3e74;_0x4e75c4[_0x3fa607][_0x54c400(0x2ce)]=_0x588092;}),_0x2c9a73[_0x5b3e74(0x244)]((_0x3a7b52,_0x5dffc0)=>{_0x4e75c4[_0x5dffc0]['product_code']=_0x3a7b52;}),_0x4f2bd1[_0x5b3e74(0x244)]((_0x229c8b,_0x2f0509)=>{var _0x323f39=_0x5b3e74;_0x4e75c4[_0x2f0509][_0x323f39(0x1d9)]=_0x229c8b;}),_0x7c5c1f[_0x5b3e74(0x244)]((_0x5a6ea1,_0x36d506)=>{var _0x3790c9=_0x5b3e74;_0x4e75c4[_0x36d506][_0x3790c9(0x266)]=_0x5a6ea1;}),_0x4b083c[_0x5b3e74(0x204)][_0x5b3e74(0x244)](_0x239dad=>{var _0x2b710f=_0x5b3e74;const _0x333537=_0x1bec32[_0x2b710f(0x1e0)][_0x2b710f(0x224)](_0xb3e5d8=>{var _0x223ce8=_0x2b710f;_0xb3e5d8[_0x223ce8(0x277)]==_0x239dad[_0x223ce8(0x277)]&&_0xb3e5d8[_0x223ce8(0x25d)]==_0x239dad[_0x223ce8(0x25d)]&&_0xb3e5d8[_0x223ce8(0x2ce)]==_0x239dad[_0x223ce8(0x2ce)]&&_0xb3e5d8[_0x223ce8(0x29e)]==_0x239dad[_0x223ce8(0x29e)]&&_0xb3e5d8[_0x223ce8(0x231)]==_0x239dad[_0x223ce8(0x231)]&&_0xb3e5d8[_0x223ce8(0x228)]==_0x239dad['rack']&&_0xb3e5d8[_0x223ce8(0x28b)]==_0x239dad[_0x223ce8(0x28b)]&&(console[_0x223ce8(0x257)](parseInt(_0xb3e5d8[_0x223ce8(0x215)])+'\x20<>\x20'+parseInt(_0x239dad[_0x223ce8(0x1d4)])),_0xb3e5d8[_0x223ce8(0x215)]=parseInt(_0xb3e5d8[_0x223ce8(0x215)])+parseInt(_0x239dad['quantity']));});}),await _0x1bec32[_0x5b3e74(0x29d)]();const _0x3dbc07=_0x4e75c4[_0x5b3e74(0x2a4)](_0x697ef4=>_0x697ef4['return_qty']!=='0'&&_0x697ef4[_0x5b3e74(0x255)]!=='');var _0x50b5ff=0x0;_0x3dbc07[_0x5b3e74(0x244)](_0x4dcd80=>{var _0x35ccfa=_0x5b3e74;console['log'](_0x35ccfa(0x1ee),_0x4dcd80),(parseInt(_0x4dcd80[_0x35ccfa(0x1fb)])<parseInt(_0x4dcd80['return_qty'])||parseInt(_0x4dcd80[_0x35ccfa(0x22c)])<parseInt(_0x4dcd80[_0x35ccfa(0x255)]))&&_0x50b5ff++;});if(_0x50b5ff!=0x0)return _0x1f05eb[_0x5b3e74(0x2d3)]('errors',_0x5b3e74(0x283)),_0x118de4['redirect'](_0x5b3e74(0x1c6));const _0x1e1b42=new purchases_return({'invoice':_0x260f98,'suppliers':_0x1f05eb[_0x5b3e74(0x211)][_0x5b3e74(0x23e)],'date':_0x386314,'warehouse_name':_0x520d00,'return_product':_0x3dbc07,'note':_0x398c5b,'room':_0x2f7193,'to_warehouse_name':_0x38d975,'to_room':_0xfb25ff}),_0xcf270e=await _0x1e1b42['save']();console[_0x5b3e74(0x257)](_0x1e1b42);const _0x59ca77=await purchases_return[_0x5b3e74(0x2ca)]({'invoice':_0x260f98}),_0x1cccb6=await warehouse[_0x5b3e74(0x2ca)]({'name':_0x38d975,'room':_0xfb25ff});_0x59ca77[_0x5b3e74(0x253)]['forEach'](_0x34eec8=>{var _0x5ae827=_0x5b3e74,_0x439ffd=0x0;const _0x5b2451=_0x1cccb6[_0x5ae827(0x1e0)][_0x5ae827(0x224)](_0xbf71ba=>{var _0xf49c6e=_0x5ae827;_0xbf71ba['product_name']==_0x34eec8[_0xf49c6e(0x277)]&&_0xbf71ba[_0xf49c6e(0x25d)]==_0x34eec8[_0xf49c6e(0x25d)]&&_0xbf71ba['type']==_0x34eec8[_0xf49c6e(0x2ce)]&&_0xbf71ba['bin']==_0x34eec8['bin']&&_0xbf71ba[_0xf49c6e(0x231)]==_0x34eec8['bay']&&(_0xbf71ba[_0xf49c6e(0x215)]=parseInt(_0xbf71ba[_0xf49c6e(0x215)])-parseInt(_0x34eec8[_0xf49c6e(0x255)]),_0x439ffd++);});_0x439ffd=='0'&&(_0x1cccb6[_0x5ae827(0x1e0)]=_0x1cccb6[_0x5ae827(0x1e0)][_0x5ae827(0x200)]({'product_name':_0x34eec8['product_name'],'product_stock':_0x34eec8[_0x5ae827(0x255)],'primary_code':_0x34eec8[_0x5ae827(0x1d9)],'secondary_code':_0x34eec8['secondary_code'],'product_code':_0x34eec8[_0x5ae827(0x2e3)],'storage':_0x34eec8[_0x5ae827(0x28b)],'rack':_0x34eec8[_0x5ae827(0x228)],'bay':_0x34eec8['bay'],'bin':_0x34eec8[_0x5ae827(0x29e)],'type':_0x34eec8[_0x5ae827(0x2ce)],'floorlevel':_0x34eec8[_0x5ae827(0x25d)],'maxProducts':_0x34eec8[_0x5ae827(0x296)],'unit':_0x34eec8['standard_unit'],'secondary_unit':_0x34eec8[_0x5ae827(0x20b)],'expiry_date':_0x34eec8['expiry_date']}));}),await _0x1cccb6[_0x5b3e74(0x29d)]();const _0x508db5=await purchases['findOne']({'invoice':_0x260f98});_0x508db5[_0x5b3e74(0x2d0)]='True';const _0x868393=await _0x508db5[_0x5b3e74(0x29d)](),_0x31dd43=new s_payment_data({'invoice':_0x260f98,'suppliers':_0x1f05eb[_0x5b3e74(0x211)]['suppliers'],'reason':_0x5b3e74(0x263)});await _0x31dd43['save']();const _0xefcb35=await master_shop[_0x5b3e74(0x1de)]();console[_0x5b3e74(0x257)]('add\x20post',_0xefcb35[0x0][_0x5b3e74(0x2a6)]);const _0x3febae=await email_settings[_0x5b3e74(0x2ca)](),_0x12cfb2=await suppliers[_0x5b3e74(0x2ca)]({'name':_0x1f05eb['body']['suppliers']});console[_0x5b3e74(0x257)](_0x5b3e74(0x1fe),_0x12cfb2);_0xefcb35[0x0][_0x5b3e74(0x2de)]==0x1?(right_currency=_0xefcb35[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xefcb35[0x0][_0x5b3e74(0x2b3)]);var _0x1d49a4=_0x587749,_0x1039e9=_0x19c3e0,_0x5c3e18='',_0x224ce2;for(_0x224ce2 in _0x1d49a4){_0x5c3e18+=_0x5b3e74(0x278)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d49a4[_0x224ce2]+_0x5b3e74(0x208)+_0x5b3e74(0x229)+_0x1039e9[_0x224ce2]+_0x5b3e74(0x208)+'</tr>';}console[_0x5b3e74(0x257)](_0x5b3e74(0x2d5),_0x5c3e18);let _0x529006=nodemailer[_0x5b3e74(0x27b)]({'service':_0x5b3e74(0x26d),'auth':{'user':_0x3febae[_0x5b3e74(0x24b)],'pass':_0x3febae['password']}}),_0x37deb5={'from':_0x3febae['email'],'to':_0x12cfb2[_0x5b3e74(0x24b)],'subject':_0x5b3e74(0x2a8),'attachments':[{'filename':_0x5b3e74(0x21e),'path':__dirname+_0x5b3e74(0x205)+'/upload/'+_0xefcb35[0x0][_0x5b3e74(0x2a6)],'cid':_0x5b3e74(0x290)}],'html':_0x5b3e74(0x2a3)+'<html><head><title></title>'+'</head><body>'+_0x5b3e74(0x2c0)+_0x5b3e74(0x242)+_0x5b3e74(0x2c0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x5b3e74(0x227)+_0xefcb35[0x0][_0x5b3e74(0x238)]+_0x5b3e74(0x221)+_0x5b3e74(0x2d6)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x5b3e74(0x1e1)+'\x20Order\x20Number\x20:\x20'+_0x260f98+'\x20'+_0x5b3e74(0x24d)+_0x5b3e74(0x1e8)+_0x386314+'\x20'+_0x5b3e74(0x267)+_0x5b3e74(0x1db)+_0x5b3e74(0x2d6)+_0x5b3e74(0x23d)+_0x5b3e74(0x1c7)+_0x5b3e74(0x278)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5b3e74(0x20a)+_0x5b3e74(0x279)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x5b3e74(0x223)+_0x5b3e74(0x207)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5c3e18+'\x20'+_0x5b3e74(0x280)+_0x5b3e74(0x20d)+_0x5b3e74(0x2c0)+_0x5b3e74(0x28c)+_0x5b3e74(0x1be)+_0xefcb35[0x0][_0x5b3e74(0x238)]+_0x5b3e74(0x1db)+'</div>'+_0x5b3e74(0x2d6)+'</body></html>'};_0x529006['sendMail'](_0x37deb5,function(_0xc326cd,_0x38787a){var _0x444723=_0x5b3e74;_0xc326cd?(console[_0x444723(0x257)](_0xc326cd),console[_0x444723(0x257)](_0x444723(0x1f8))):console[_0x444723(0x257)]('Email\x20sent\x20successfully');}),_0x1f05eb['flash'](_0x5b3e74(0x210),'purchases\x20item\x20return\x20successfull'),_0x118de4[_0x5b3e74(0x23c)]('/all_purchases/view');}catch(_0x50e4d5){console['log'](_0x50e4d5),_0x118de4[_0x5b3e74(0x262)](0xc8)[_0x5b3e74(0x2b2)]({'message':_0x50e4d5['message']});}}),router[a0_0x4630f2(0x27d)](a0_0x4630f2(0x1df),auth,async(_0x57f922,_0x237785)=>{var _0x5b99bf=a0_0x4630f2;try{const {username:_0x4a9c7c,email:_0x2c53c9,role:_0x5222e2}=_0x57f922['user'],_0x1e6762=_0x57f922[_0x5b99bf(0x2af)],_0xea9fee=await profile[_0x5b99bf(0x2ca)]({'email':_0x1e6762[_0x5b99bf(0x24b)]}),_0xd903ce=await master_shop['find'](),_0x1d9feb=_0x57f922[_0x5b99bf(0x27a)]['id'],_0x5c29fb=await purchases[_0x5b99bf(0x1e6)](_0x1d9feb);if(_0xd903ce[0x0][_0x5b99bf(0x293)]==_0x5b99bf(0x212))var _0x2465aa=users['English'];else{if(_0xd903ce[0x0][_0x5b99bf(0x293)]=='Hindi')var _0x2465aa=users[_0x5b99bf(0x26e)];else{if(_0xd903ce[0x0][_0x5b99bf(0x293)]==_0x5b99bf(0x1e5))var _0x2465aa=users[_0x5b99bf(0x1e5)];else{if(_0xd903ce[0x0][_0x5b99bf(0x293)]=='Spanish')var _0x2465aa=users['Spanish'];else{if(_0xd903ce[0x0][_0x5b99bf(0x293)]==_0x5b99bf(0x2c9))var _0x2465aa=users[_0x5b99bf(0x2c9)];else{if(_0xd903ce[0x0]['language']==_0x5b99bf(0x1c1))var _0x2465aa=users['Portuguese'];else{if(_0xd903ce[0x0]['language']==_0x5b99bf(0x24e))var _0x2465aa=users[_0x5b99bf(0x24e)];else{if(_0xd903ce[0x0][_0x5b99bf(0x293)]=='Arabic\x20(ae)')var _0x2465aa=users[_0x5b99bf(0x20f)];}}}}}}}_0x237785['render'](_0x5b99bf(0x271),{'success':_0x57f922['flash']('success'),'errors':_0x57f922[_0x5b99bf(0x2d3)]('errors'),'role':_0x1e6762,'profile':_0xea9fee,'alldata':_0x5c29fb,'master_shop':_0xd903ce,'language':_0x2465aa}),console[_0x5b99bf(0x257)](alldata);}catch(_0x1394f1){console[_0x5b99bf(0x257)](_0x1394f1);}}),router[a0_0x4630f2(0x25f)](a0_0x4630f2(0x1ce),async(_0x162380,_0x549e31)=>{var _0x59d391=a0_0x4630f2;const {product_code:_0x5b40dc}=_0x162380[_0x59d391(0x211)];var _0x5324f8;const _0x3b0850=await product[_0x59d391(0x289)]([{'$match':{'primary_code':_0x5b40dc,'product_category':_0x59d391(0x1f6)}},{'$group':{'_id':'$_id','name':{'$first':_0x59d391(0x2b1)},'category':{'$first':_0x59d391(0x23f)},'brand':{'$first':_0x59d391(0x2bd)},'unit':{'$first':_0x59d391(0x256)},'alertquantity':{'$first':_0x59d391(0x2ad)},'product_code':{'$first':_0x59d391(0x27f)},'primary_code':{'$first':_0x59d391(0x264)},'secondary_code':{'$first':_0x59d391(0x2cd)},'maxStocks':{'$first':_0x59d391(0x25e)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1c092b=await product[_0x59d391(0x289)]([{'$match':{'secondary_code':_0x5b40dc,'product_category':_0x59d391(0x1f6)}},{'$group':{'_id':'$_id','name':{'$first':_0x59d391(0x2b1)},'category':{'$first':_0x59d391(0x23f)},'brand':{'$first':_0x59d391(0x2bd)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x59d391(0x2ad)},'product_code':{'$first':_0x59d391(0x27f)},'primary_code':{'$first':_0x59d391(0x264)},'secondary_code':{'$first':_0x59d391(0x2cd)},'maxStocks':{'$first':_0x59d391(0x25e)},'maxProdPerUnit':{'$first':_0x59d391(0x2cb)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x59d391(0x294)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3b0850[_0x59d391(0x1ca)]>0x0)_0x5324f8=_0x3b0850;else _0x1c092b[_0x59d391(0x1ca)]>0x0&&(_0x5324f8=_0x1c092b);_0x549e31[_0x59d391(0x2b2)](_0x5324f8);}),router['post']('/CheckingWarehouse',async(_0x4a6e4a,_0x2e107b)=>{var _0x4e36d2=a0_0x4630f2;const {primaryCode:_0x5311ca,secondaryCode:_0x31bc11,productCode:_0xe836b1,bay:_0x3076ac,bin:_0x485910,types:_0x494fbc,pallet:_0x16474c,warehouses:_0x39e951,room:_0x2993a8}=_0x4a6e4a[_0x4e36d2(0x211)];console[_0x4e36d2(0x257)](_0x4a6e4a[_0x4e36d2(0x211)]);try{const _0x2697c4=await warehouse[_0x4e36d2(0x289)]([{'$match':{'name':_0x39e951,'room':_0x2993a8}},{'$unwind':_0x4e36d2(0x274)},{'$match':{'product_details.bay':_0x3076ac,'product_details.bin':_0x485910,'product_details.type':_0x494fbc}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4e36d2(0x285)},'level':{'$first':_0x4e36d2(0x286)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4e36d2(0x270)},'maxProducts':{'$first':_0x4e36d2(0x29a)}}}]);_0x2e107b['status'](0xc8)[_0x4e36d2(0x2b2)](_0x2697c4);}catch(_0x240cf5){_0x2e107b[_0x4e36d2(0x262)](0x194)['json']({'message':_0x240cf5[_0x4e36d2(0x1ea)]});}}),module[a0_0x4630f2(0x213)]=router;