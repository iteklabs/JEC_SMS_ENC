var a0_0x2b6326=a0_0x2657;(function(_0x44d67e,_0xddcc6b){var _0x1577c4=a0_0x2657,_0x4e8ce4=_0x44d67e();while(!![]){try{var _0xf56bdb=parseInt(_0x1577c4(0x19e))/0x1*(-parseInt(_0x1577c4(0x18d))/0x2)+-parseInt(_0x1577c4(0x156))/0x3*(parseInt(_0x1577c4(0x1fc))/0x4)+-parseInt(_0x1577c4(0x164))/0x5+-parseInt(_0x1577c4(0x1c6))/0x6*(-parseInt(_0x1577c4(0x170))/0x7)+-parseInt(_0x1577c4(0x1c1))/0x8*(parseInt(_0x1577c4(0x19f))/0x9)+-parseInt(_0x1577c4(0x1e5))/0xa+-parseInt(_0x1577c4(0x1ae))/0xb*(-parseInt(_0x1577c4(0x191))/0xc);if(_0xf56bdb===_0xddcc6b)break;else _0x4e8ce4['push'](_0x4e8ce4['shift']());}catch(_0x3e6758){_0x4e8ce4['push'](_0x4e8ce4['shift']());}}}(a0_0x3c06,0x63444));function a0_0x2657(_0x49d10d,_0x687c6b){var _0x3c0678=a0_0x3c06();return a0_0x2657=function(_0x2657eb,_0x45c9c0){_0x2657eb=_0x2657eb-0x151;var _0x6435c2=_0x3c0678[_0x2657eb];return _0x6435c2;},a0_0x2657(_0x49d10d,_0x687c6b);}const express=require(a0_0x2b6326(0x19d)),app=express(),router=express['Router'](),auth=require(a0_0x2b6326(0x15d)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x2b6326(0x1ba));function a0_0x3c06(){var _0x482475=['</td>','Ambient','warehouse_name','errors','product_name','error','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.product_name','Chinese','$product_details.maxPerUnit','stockBefore','add','$product_details.secondary_code','level','findOne','room_names','adjustment\x20data\x20update\x20successfully','Adjustment\x20Finalize\x20Successfully','expiry_date','get','</tr>','getFullYear','slice','foreach\x20newproduct','padStart','2MxQMGm','edit_adjustment_finished_view','email','maxPerUnit','12JNiQQt','product','$product','$product_details.floorlevel','English\x20(US)','logs','/barcode_scanner','json','$product_details','Arabic\x20(ae)','product_stock','body','express','25379cmoHsR','7255233NtaANr','unit','$finalize','split','Hindi','Secondary_units','$product_details.product_code','role','findById','Portuguese\x20(BR)','Rooms','date','/picking_list/PDF_adjustmentFinal/','user','find','32843811cjMcPr','then','production_date','$product_details.rack','map','/view_logs','/view/add_adjustment','log','$product_details.production_date','types','stock','$product_details.primary_code','nodemailer','string','An\x20error\x20occurred\x20while\x20saving\x20data.','DRY\x20GOODS','adjustment\x20add\x20successfull','adjustment_finished_logs','$name','8iMGKQw','prod_code','batch_code','render','There\x27s\x20a\x20error\x20in\x20this\x20transaction','198nVKDIU','all','LOG-ADJ-','$product_details.level','prod_cat','An\x20error\x20occurred.','$date','finalize','forEach','status','/view/:id','Portuguese','$invoice','Enclosed','push','floor','id_transaction','$product_details.storage','$product_details.expiry_date','German','minus','back','secondary_unit','$product_details.product_stock','prod_name','$product.room_names','flash','success','_id','JO_number','language','6483000IWlqUc','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.maxProducts','exports','filter','$product_details.batch_code','ADJF-','/adjustment_finished/view','invoice_init','warehouse','product_details','match','Enabled','$_id','$room','product_code','Spanish','catch','English','Arabic','New_Qty_Converted_adj','save','$product_details.type','32548nGrAip','purchases_data','French','$product_details._id','Return\x20Rooms','note','message','ADJ-','<tr>','/view/add_adjustment_logs','/preview/:id','285qtMRHM','staff','prod_invoice','toString','master','room','$warehouse_name','../middleware/auth','redirect','/CheckingWarehouse','adjust_qty','New_Qty_Converted','product_date','$product.product_name','3664010SNQtlD','post','new_adjust_qty','True','$product_details.bin','$product_details.invoice','/adjustment/view','bay','invoice','id_transaction_from','Primary_Units','params','86212eowmfv','$product_details.bay','length','aggregate'];a0_0x3c06=function(){return _0x482475;};return a0_0x3c06();}router[a0_0x2b6326(0x187)]('/view',auth,async(_0x617866,_0x5280b4)=>{var _0x2a852d=a0_0x2b6326;try{const {username:_0x3bcd73,email:_0x209379,role:_0x5f5c54}=_0x617866[_0x2a852d(0x1ac)],_0x530719=_0x617866[_0x2a852d(0x1ac)],_0xa2bb0d=await profile[_0x2a852d(0x182)]({'email':_0x530719['email']}),_0x147732=await master_shop[_0x2a852d(0x1ad)]();let _0x110db7;if(_0x530719[_0x2a852d(0x1a6)]=='staff'){const _0x344033=await staff[_0x2a852d(0x182)]({'email':_0x530719['email']});_0x110db7=await warehouse[_0x2a852d(0x1ad)]({'status':_0x2a852d(0x1f1),'name':_0x344033[_0x2a852d(0x1ee)]});}else _0x110db7=await warehouse[_0x2a852d(0x1ad)]({'status':_0x2a852d(0x1f1)});const _0xeb8719=await product[_0x2a852d(0x1ad)]();let _0x5d8a02;if(_0x530719[_0x2a852d(0x1a6)]==_0x2a852d(0x157)){const _0x4f614d=await staff[_0x2a852d(0x182)]({'email':_0x530719['email']});_0x5d8a02=await adjustment_finished[_0x2a852d(0x1ad)]({'warehouse_name':_0x4f614d[_0x2a852d(0x1ee)]});}else _0x5d8a02=await adjustment_finished[_0x2a852d(0x173)]([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0x2a852d(0x193)},{'$group':{'_id':_0x2a852d(0x1f2),'invoice':{'$first':_0x2a852d(0x1d2)},'date':{'$first':_0x2a852d(0x1cc)},'warehouse_name':{'$first':_0x2a852d(0x15c)},'room':{'$addToSet':_0x2a852d(0x1df)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x195)){var _0x222491=users[_0x2a852d(0x1f7)];console[_0x2a852d(0x1b5)](_0x222491);}else{if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x1a3))var _0x222491=users[_0x2a852d(0x1a3)];else{if(_0x147732[0x0][_0x2a852d(0x1e4)]=='German')var _0x222491=users[_0x2a852d(0x1d9)];else{if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x1f5))var _0x222491=users[_0x2a852d(0x1f5)];else{if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x1fe))var _0x222491=users['French'];else{if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x1a8))var _0x222491=users[_0x2a852d(0x1d1)];else{if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x17c))var _0x222491=users['Chinese'];else{if(_0x147732[0x0][_0x2a852d(0x1e4)]==_0x2a852d(0x19a))var _0x222491=users[_0x2a852d(0x1f8)];}}}}}}}_0x5280b4[_0x2a852d(0x1c4)]('adjustment_finished',{'success':_0x617866[_0x2a852d(0x1e0)]('success'),'errors':_0x617866['flash'](_0x2a852d(0x177)),'role':_0x530719,'profile':_0xa2bb0d,'warehouse':_0x110db7,'product':_0xeb8719,'adjustment':_0x5d8a02,'master_shop':_0x147732,'language':_0x222491});}catch(_0x2378e2){console[_0x2a852d(0x1b5)](_0x2378e2);}}),router[a0_0x2b6326(0x187)](a0_0x2b6326(0x1b3),auth,async(_0x48687d,_0x3491fe)=>{var _0x59e2d7=a0_0x2b6326;try{const {username:_0xb9ec28,email:_0x215090,role:_0x202336}=_0x48687d[_0x59e2d7(0x1ac)],_0x406ae8=_0x48687d[_0x59e2d7(0x1ac)],_0x531b2b=await profile['findOne']({'email':_0x406ae8['email']}),_0x26c590=await master_shop[_0x59e2d7(0x1ad)]();let _0x28c074;if(_0x406ae8[_0x59e2d7(0x1a6)]==_0x59e2d7(0x157)){const _0x5bfd18=await staff['findOne']({'email':_0x406ae8['email']});_0x28c074=await warehouse['find']({'status':_0x59e2d7(0x1f1),'name':_0x5bfd18[_0x59e2d7(0x1ee)]});}else _0x28c074=await warehouse['find']({'status':'Enabled'});const _0xda742e=await product[_0x59e2d7(0x1ad)]();let _0x5777b1;if(_0x406ae8[_0x59e2d7(0x1a6)]=='staff'){const _0x29a757=await staff[_0x59e2d7(0x182)]({'email':_0x406ae8[_0x59e2d7(0x18f)]});_0x5777b1=await adjustment_finished['find']({'warehouse_name':_0x29a757['warehouse']});}else _0x5777b1=await adjustment_finished[_0x59e2d7(0x173)]([{'$match':{'type_of_transaction':_0x59e2d7(0x196)}},{'$unwind':_0x59e2d7(0x193)},{'$group':{'_id':_0x59e2d7(0x1f2),'invoice':{'$first':_0x59e2d7(0x1d2)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x59e2d7(0x15c)},'room':{'$addToSet':_0x59e2d7(0x1df)},'finalize':{'$first':_0x59e2d7(0x1a1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x26c590[0x0][_0x59e2d7(0x1e4)]==_0x59e2d7(0x195))var _0x595aff=users[_0x59e2d7(0x1f7)];else{if(_0x26c590[0x0][_0x59e2d7(0x1e4)]==_0x59e2d7(0x1a3))var _0x595aff=users[_0x59e2d7(0x1a3)];else{if(_0x26c590[0x0][_0x59e2d7(0x1e4)]=='German')var _0x595aff=users[_0x59e2d7(0x1d9)];else{if(_0x26c590[0x0]['language']==_0x59e2d7(0x1f5))var _0x595aff=users[_0x59e2d7(0x1f5)];else{if(_0x26c590[0x0][_0x59e2d7(0x1e4)]==_0x59e2d7(0x1fe))var _0x595aff=users[_0x59e2d7(0x1fe)];else{if(_0x26c590[0x0]['language']=='Portuguese\x20(BR)')var _0x595aff=users[_0x59e2d7(0x1d1)];else{if(_0x26c590[0x0]['language']==_0x59e2d7(0x17c))var _0x595aff=users[_0x59e2d7(0x17c)];else{if(_0x26c590[0x0][_0x59e2d7(0x1e4)]==_0x59e2d7(0x19a))var _0x595aff=users['Arabic'];}}}}}}}_0x3491fe[_0x59e2d7(0x1c4)](_0x59e2d7(0x1bf),{'success':_0x48687d[_0x59e2d7(0x1e0)]('success'),'errors':_0x48687d[_0x59e2d7(0x1e0)](_0x59e2d7(0x177)),'role':_0x406ae8,'profile':_0x531b2b,'warehouse':_0x28c074,'product':_0xda742e,'adjustment':_0x5777b1,'master_shop':_0x26c590,'language':_0x595aff});}catch(_0x50d996){console[_0x59e2d7(0x1b5)](_0x50d996);}});async function getRandom8DigitNumber(){var _0x45152a=a0_0x2b6326;const _0x4f6c85=0x989680,_0x4b286a=0x5f5e0ff,_0x3b9f25=Math[_0x45152a(0x1d5)](Math['random']()*(_0x4b286a-_0x4f6c85+0x1))+_0x4f6c85;var _0x120b29;const _0x3ad76c=await adjustment_finished[_0x45152a(0x182)]({'invoice':_0x45152a(0x1eb)+_0x3b9f25});return _0x3ad76c&&_0x3ad76c[_0x45152a(0x172)]>0x0?_0x120b29='ADJF-'+_0x3b9f25:_0x120b29='ADJF-'+_0x3b9f25,_0x120b29;}router[a0_0x2b6326(0x187)](a0_0x2b6326(0x1b4),auth,async(_0x5160e7,_0x47372c)=>{var _0xd92c9f=a0_0x2b6326;try{const {username:_0x3fd59f,email:_0x485026,role:_0x28476d}=_0x5160e7['user'],_0xc6db32=_0x5160e7[_0xd92c9f(0x1ac)],_0x29bb38=await profile[_0xd92c9f(0x182)]({'email':_0xc6db32['email']}),_0xc801a9=await master_shop[_0xd92c9f(0x1ad)]();let _0x8e299d;if(_0xc6db32[_0xd92c9f(0x1a6)]==_0xd92c9f(0x157)){const _0x35d344=await staff[_0xd92c9f(0x182)]({'email':_0xc6db32[_0xd92c9f(0x18f)]});_0x8e299d=await warehouse['aggregate']([{'$match':{'status':_0xd92c9f(0x1f1),'name':_0x35d344['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0xd92c9f(0x1c0)}}}]);}else _0x8e299d=await warehouse['aggregate']([{'$match':{'status':_0xd92c9f(0x1f1)}},{'$group':{'_id':_0xd92c9f(0x1c0),'name':{'$first':_0xd92c9f(0x1c0)}}}]);const _0xca3689=await product[_0xd92c9f(0x1ad)]({}),_0x4460d6=await adjustment_finished[_0xd92c9f(0x1ad)](),_0x267e56=_0x4460d6[_0xd92c9f(0x172)]+0x1,_0x1919bf=_0xd92c9f(0x1eb)+_0x267e56[_0xd92c9f(0x159)]()['padStart'](0x5,'0');var _0x3f3756=['Ambient','Enclosed',_0xd92c9f(0x200)];if(_0xc801a9[0x0]['language']==_0xd92c9f(0x195))var _0x45501e=users[_0xd92c9f(0x1f7)];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]==_0xd92c9f(0x1a3))var _0x45501e=users[_0xd92c9f(0x1a3)];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]=='German')var _0x45501e=users[_0xd92c9f(0x1d9)];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]==_0xd92c9f(0x1f5))var _0x45501e=users['Spanish'];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]==_0xd92c9f(0x1fe))var _0x45501e=users[_0xd92c9f(0x1fe)];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]==_0xd92c9f(0x1a8))var _0x45501e=users[_0xd92c9f(0x1d1)];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]=='Chinese')var _0x45501e=users['Chinese'];else{if(_0xc801a9[0x0][_0xd92c9f(0x1e4)]==_0xd92c9f(0x19a))var _0x45501e=users[_0xd92c9f(0x1f8)];}}}}}}}const _0x5de12a=getRandom8DigitNumber();_0x5de12a['then'](_0x1520b9=>{var _0x211a63=_0xd92c9f;_0x47372c[_0x211a63(0x1c4)]('add_adjustment_finished',{'success':_0x5160e7[_0x211a63(0x1e0)]('success'),'errors':_0x5160e7[_0x211a63(0x1e0)](_0x211a63(0x177)),'role':_0xc6db32,'profile':_0x29bb38,'warehouse':_0x8e299d,'product':_0xca3689,'master_shop':_0xc801a9,'language':_0x45501e,'rooms_data':_0x3f3756,'invoice_no':_0x1520b9});})['catch'](_0x397335=>{var _0x18f0ef=_0xd92c9f;_0x5160e7[_0x18f0ef(0x1e0)](_0x18f0ef(0x177),_0x18f0ef(0x1c5)),_0x47372c[_0x18f0ef(0x15e)]('/adjustment/view');});}catch(_0x5afbf0){console['log'](_0x5afbf0);}}),router['post'](a0_0x2b6326(0x1b4),auth,async(_0x36a180,_0x211337)=>{var _0x4fa152=a0_0x2b6326;try{const {warehouse_name:_0x21b9e6,date:_0x25b567,prod_name:_0x1ce546,level:_0x332a8e,isle:_0x26640c,pallet:_0x2e36e5,stock:_0x4c08b7,types:_0x2554af,adjust_qty:_0x3edf15,new_adjust_qty:_0x5081dd,note:_0x5d2c65,Room_name:_0x2f8d46,JO_number:_0x4cad40,expiry_date:_0x384270,PO_number:_0x8785e5,ReqBy:_0x154178,dateofreq:_0x1c2ca5,typeservicesData:_0x5beeae,destination:_0x1023c1,deliverydate:_0x5158aa,driver:_0x549564,plate:_0xf5ba3d,van:_0x2844cf,DRSI:_0x16674d,typevehicle:_0x36b802,TSU:_0x25a5da,TFU:_0x2035b2}=_0x36a180['body'];if(typeof _0x1ce546==_0x4fa152(0x1bb))var _0x39e510=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1de)]],_0x4d1dcd=[_0x36a180[_0x4fa152(0x19c)]['level']],_0x2cf0eb=[_0x36a180[_0x4fa152(0x19c)]['stock']],_0x203c36=[_0x36a180['body'][_0x4fa152(0x1b7)]],_0x278826=[_0x36a180[_0x4fa152(0x19c)]['New_Qty_Converted_adj']],_0xa8049=[_0x36a180['body'][_0x4fa152(0x161)]],_0x35c104=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x16e)]],_0x29bffe=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1a4)]],_0x4ab7a0=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1c2)]],_0x2eabe9=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1c3)]],_0x5a776=[_0x36a180['body'][_0x4fa152(0x186)]],_0x1fd313=[_0x36a180['body'][_0x4fa152(0x162)]],_0xb606af=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1ca)]],_0x4b0c83=[_0x36a180['body'][_0x4fa152(0x1a9)]],_0x343f4a=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x190)]],_0x3deebe=[_0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x158)]],_0x4367b4=[_0x36a180['body'][_0x4fa152(0x16d)]];else var _0x39e510=[..._0x36a180['body'][_0x4fa152(0x1de)]],_0x4d1dcd=[..._0x36a180['body']['level']],_0x2cf0eb=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1b8)]],_0x203c36=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1b7)]],_0x278826=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1f9)]],_0xa8049=[..._0x36a180[_0x4fa152(0x19c)]['New_Qty_Converted']],_0x35c104=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x16e)]],_0x29bffe=[..._0x36a180[_0x4fa152(0x19c)]['Secondary_units']],_0x4ab7a0=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1c2)]],_0x2eabe9=[..._0x36a180[_0x4fa152(0x19c)]['batch_code']],_0x5a776=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x186)]],_0x1fd313=[..._0x36a180['body'][_0x4fa152(0x162)]],_0xb606af=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1ca)]],_0x4b0c83=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x1a9)]],_0x343f4a=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x190)]],_0x3deebe=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x158)]],_0x4367b4=[..._0x36a180[_0x4fa152(0x19c)][_0x4fa152(0x16d)]];const _0x53ddf9=_0x39e510[_0x4fa152(0x1b2)](_0xe210cd=>{return _0xe210cd={'product_name':_0xe210cd};});_0x4d1dcd[_0x4fa152(0x1ce)]((_0x27121c,_0x4d7b0a)=>{var _0x293511=_0x4fa152,_0x329cf5=_0x27121c[_0x293511(0x1f0)](/[A-Za-z]+/)[0x0],_0x3e22be=parseInt(_0x27121c['match'](/\d+/)[0x0]);_0x53ddf9[_0x4d7b0a][_0x293511(0x181)]=_0x329cf5,_0x53ddf9[_0x4d7b0a][_0x293511(0x16b)]=_0x3e22be;}),_0x4367b4[_0x4fa152(0x1ce)]((_0x1fd005,_0x3064fc)=>{var _0x34c05e=_0x4fa152;_0x53ddf9[_0x3064fc][_0x34c05e(0x1d6)]=_0x1fd005;}),_0x2cf0eb['forEach']((_0x29e3f7,_0x8f2d25)=>{var _0x486270=_0x4fa152;_0x53ddf9[_0x8f2d25][_0x486270(0x17e)]=_0x29e3f7;}),_0x203c36[_0x4fa152(0x1ce)]((_0x23454c,_0x99e5c4)=>{var _0x243f8f=_0x4fa152;_0x53ddf9[_0x99e5c4][_0x243f8f(0x1b7)]=_0x23454c;}),_0x278826['forEach']((_0x38f394,_0x24bd3f)=>{_0x53ddf9[_0x24bd3f]['adjust_qty']=_0x38f394;}),_0xa8049[_0x4fa152(0x1ce)]((_0x374dfc,_0x4be137)=>{var _0x41037e=_0x4fa152;_0x53ddf9[_0x4be137][_0x41037e(0x166)]=_0x374dfc;}),_0x35c104[_0x4fa152(0x1ce)]((_0x5a8ae2,_0x1cc0a8)=>{var _0x55dfad=_0x4fa152;_0x53ddf9[_0x1cc0a8][_0x55dfad(0x1a0)]=_0x5a8ae2;}),_0x29bffe[_0x4fa152(0x1ce)]((_0x33d5cc,_0x502e65)=>{var _0xdf480c=_0x4fa152;_0x53ddf9[_0x502e65][_0xdf480c(0x1dc)]=_0x33d5cc;}),_0x4ab7a0['forEach']((_0x2b7909,_0x58d367)=>{var _0x23bad3=_0x4fa152;_0x53ddf9[_0x58d367][_0x23bad3(0x1f4)]=_0x2b7909;}),_0x2eabe9[_0x4fa152(0x1ce)]((_0x49c873,_0x112da1)=>{var _0x169632=_0x4fa152;_0x53ddf9[_0x112da1][_0x169632(0x1c3)]=_0x49c873;}),_0x5a776[_0x4fa152(0x1ce)]((_0x2be963,_0x53f8e2)=>{var _0x5d7c70=_0x4fa152;_0x53ddf9[_0x53f8e2][_0x5d7c70(0x186)]=_0x2be963;}),_0x1fd313[_0x4fa152(0x1ce)]((_0x1da82b,_0x5dc2ed)=>{_0x53ddf9[_0x5dc2ed]['production_date']=_0x1da82b;}),_0xb606af[_0x4fa152(0x1ce)]((_0x48e8bb,_0x19f6fd)=>{var _0x2a2638=_0x4fa152;_0x53ddf9[_0x19f6fd][_0x2a2638(0x1ca)]=_0x48e8bb;}),_0x4b0c83['forEach']((_0x4a85ed,_0x40a108)=>{_0x53ddf9[_0x40a108]['room_names']=_0x4a85ed;}),_0x343f4a[_0x4fa152(0x1ce)]((_0x42c2d9,_0x5ccc5e)=>{var _0x135e2a=_0x4fa152;_0x53ddf9[_0x5ccc5e][_0x135e2a(0x190)]=_0x42c2d9;}),_0x3deebe[_0x4fa152(0x1ce)]((_0x1e2b7d,_0x27b0ac)=>{var _0x2c867b=_0x4fa152;_0x53ddf9[_0x27b0ac][_0x2c867b(0x16c)]=_0x1e2b7d;});const _0x340651=_0x53ddf9[_0x4fa152(0x1e9)](_0xa22d3e=>_0xa22d3e['adjust_qty']!=='0'&&_0xa22d3e[_0x4fa152(0x160)]!=='');var _0xe45e55=0x0;_0x340651[_0x4fa152(0x1ce)](_0x433e09=>{var _0x192da9=_0x4fa152;console[_0x192da9(0x1b5)](_0x192da9(0x18b),_0x433e09),parseInt(_0x433e09[_0x192da9(0x160)])<=0x0&&_0xe45e55++;});if(_0xe45e55!=0x0)return _0x36a180['flash'](_0x4fa152(0x177),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x211337[_0x4fa152(0x15e)]('back');const _0x310533=new invoice_for_adjustment();await _0x310533[_0x4fa152(0x1fa)]();const _0x4a8dbc=new adjustment_finished({'warehouse_name':_0x21b9e6,'date':_0x25b567,'product':_0x340651,'note':_0x5d2c65,'room':_0x2f8d46,'invoice':_0x4fa152(0x152)+_0x310533['invoice_init'][_0x4fa152(0x159)]()[_0x4fa152(0x18c)](0x8,'0'),'JO_number':_0x4cad40,'expiry_date':_0x384270,'PO_number':_0x8785e5,'RequestedBy':_0x154178,'DateofRequest':_0x1c2ca5,'typeservices':_0x5beeae,'destination':_0x1023c1,'deliverydate':_0x5158aa,'driver':_0x549564,'plate':_0xf5ba3d,'van':_0x2844cf,'DRSI':_0x16674d,'typevehicle':_0x36b802,'TSU':_0x25a5da,'TFU':_0x2035b2}),_0x354f11=await _0x4a8dbc[_0x4fa152(0x1fa)]();_0x36a180[_0x4fa152(0x1e0)](_0x4fa152(0x1e1),'adjustment\x20add\x20successfull'),_0x211337[_0x4fa152(0x15e)]('/adjustment_finished/preview/'+_0x354f11['_id']);}catch(_0x3c70ca){console[_0x4fa152(0x1b5)](_0x3c70ca),_0x211337[_0x4fa152(0x1cf)](0xc8)[_0x4fa152(0x198)]({'message':_0x3c70ca[_0x4fa152(0x151)]});}}),router['get'](a0_0x2b6326(0x154),auth,async(_0x38d36a,_0x48b615)=>{var _0xfa443=a0_0x2b6326;try{const {username:_0x12e3cf,email:_0x461222,role:_0x15ce31}=_0x38d36a[_0xfa443(0x1ac)],_0x4e3683=_0x38d36a['user'],_0xa8241=await profile['findOne']({'email':_0x4e3683[_0xfa443(0x18f)]}),_0x3b718d=await master_shop[_0xfa443(0x1ad)]();let _0x3e8454;if(_0x4e3683[_0xfa443(0x1a6)]==_0xfa443(0x157)){const _0x96e7c9=await staff[_0xfa443(0x182)]({'email':_0x4e3683['email']});_0x3e8454=await warehouse[_0xfa443(0x173)]([{'$match':{'status':_0xfa443(0x1f1),'name':_0x96e7c9['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0xfa443(0x1c0)}}}]);}else _0x3e8454=await warehouse[_0xfa443(0x173)]([{'$match':{'status':_0xfa443(0x1f1)}},{'$group':{'_id':_0xfa443(0x1c0),'name':{'$first':'$name'}}}]);const _0x3478f5=await product[_0xfa443(0x1ad)](),_0x5b697a=await adjustment_finished[_0xfa443(0x1ad)](),_0x136847=_0x5b697a['length']+0x1,_0xd41619=_0xfa443(0x1eb)+_0x136847[_0xfa443(0x159)]()[_0xfa443(0x18c)](0x5,'0');var _0x318aea=[_0xfa443(0x175),'Enclosed',_0xfa443(0x200)];if(_0x3b718d[0x0][_0xfa443(0x1e4)]=='English\x20(US)')var _0x42e298=users[_0xfa443(0x1f7)];else{if(_0x3b718d[0x0]['language']=='Hindi')var _0x42e298=users['Hindi'];else{if(_0x3b718d[0x0][_0xfa443(0x1e4)]=='German')var _0x42e298=users['German'];else{if(_0x3b718d[0x0][_0xfa443(0x1e4)]=='Spanish')var _0x42e298=users['Spanish'];else{if(_0x3b718d[0x0][_0xfa443(0x1e4)]=='French')var _0x42e298=users[_0xfa443(0x1fe)];else{if(_0x3b718d[0x0][_0xfa443(0x1e4)]==_0xfa443(0x1a8))var _0x42e298=users[_0xfa443(0x1d1)];else{if(_0x3b718d[0x0][_0xfa443(0x1e4)]==_0xfa443(0x17c))var _0x42e298=users[_0xfa443(0x17c)];else{if(_0x3b718d[0x0][_0xfa443(0x1e4)]=='Arabic\x20(ae)')var _0x42e298=users['Arabic'];}}}}}}}const _0x55bb21=getRandom8DigitNumber();_0x55bb21[_0xfa443(0x1af)](_0x3b8b1f=>{var _0x47617d=_0xfa443;_0x48b615[_0x47617d(0x1c4)]('add_adjustment_finished_logs',{'success':_0x38d36a[_0x47617d(0x1e0)](_0x47617d(0x1e1)),'errors':_0x38d36a[_0x47617d(0x1e0)](_0x47617d(0x177)),'role':_0x4e3683,'profile':_0xa8241,'warehouse':_0x3e8454,'product':_0x3478f5,'master_shop':_0x3b718d,'language':_0x42e298,'rooms_data':_0x318aea,'invoice_no':_0x3b8b1f});})[_0xfa443(0x1f6)](_0x746cdf=>{var _0x4ac0ff=_0xfa443;_0x38d36a[_0x4ac0ff(0x1e0)](_0x4ac0ff(0x177),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x48b615[_0x4ac0ff(0x15e)](_0x4ac0ff(0x16a));});}catch(_0x248588){console[_0xfa443(0x1b5)](_0x248588);}}),router[a0_0x2b6326(0x165)](a0_0x2b6326(0x154),auth,async(_0x1e6f5c,_0x2d7158)=>{var _0x4207b2=a0_0x2b6326;try{const {warehouse_name:_0x395c0b,date:_0x106d62,prod_name:_0x326c26,level:_0x8cabc5,isle:_0x23c01c,pallet:_0x3c3547,stock:_0x4c82b7,types:_0x6b259f,adjust_qty:_0x1d25e9,new_adjust_qty:_0x558ff2,note:_0x4a1594,Room_name:_0x10e394,JO_number:_0x546088,expiry_date:_0xcb2364,type_of_transaction:_0x4d6432,PO_number:_0x13dd5b,ReqBy:_0x30e79c,dateofreq:_0x308663,typeservicesData:_0x438313,destination:_0x4f145a,deliverydate:_0xaf9b58,driver:_0x5edcb6,plate:_0x3ecad8,van:_0x2c865f,DRSI:_0x229cfa,typevehicle:_0x1c6d79,TSU:_0x5f24f7,TFU:_0xeb94aa}=_0x1e6f5c[_0x4207b2(0x19c)];if(typeof _0x326c26==_0x4207b2(0x1bb))var _0x4d014f=[_0x1e6f5c['body'][_0x4207b2(0x1de)]],_0x1d1f70=[_0x1e6f5c['body'][_0x4207b2(0x181)]],_0x38ec0e=[_0x1e6f5c[_0x4207b2(0x19c)]['stock']],_0x256975=[_0x1e6f5c['body'][_0x4207b2(0x1b7)]],_0x16a55d=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1f9)]],_0x50c7a0=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x161)]],_0x5ef227=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x16e)]],_0x5d2a34=[_0x1e6f5c['body']['Secondary_units']],_0x4c0fd6=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1c2)]],_0x488063=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1c3)]],_0x587b6b=[_0x1e6f5c['body'][_0x4207b2(0x186)]],_0x526bca=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x162)]],_0x3e0aaa=[_0x1e6f5c[_0x4207b2(0x19c)]['prod_cat']],_0x1ed9c2=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1a9)]],_0x3673c6=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x190)]],_0xb21db7=[_0x1e6f5c['body'][_0x4207b2(0x158)]],_0x32656e=[_0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x16d)]];else var _0x4d014f=[..._0x1e6f5c[_0x4207b2(0x19c)]['prod_name']],_0x1d1f70=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x181)]],_0x38ec0e=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1b8)]],_0x256975=[..._0x1e6f5c[_0x4207b2(0x19c)]['types']],_0x16a55d=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1f9)]],_0x50c7a0=[..._0x1e6f5c[_0x4207b2(0x19c)]['New_Qty_Converted']],_0x5ef227=[..._0x1e6f5c['body']['Primary_Units']],_0x5d2a34=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1a4)]],_0x4c0fd6=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1c2)]],_0x488063=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1c3)]],_0x587b6b=[..._0x1e6f5c['body'][_0x4207b2(0x186)]],_0x526bca=[..._0x1e6f5c[_0x4207b2(0x19c)]['product_date']],_0x3e0aaa=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x1ca)]],_0x1ed9c2=[..._0x1e6f5c['body'][_0x4207b2(0x1a9)]],_0x3673c6=[..._0x1e6f5c[_0x4207b2(0x19c)][_0x4207b2(0x190)]],_0xb21db7=[..._0x1e6f5c[_0x4207b2(0x19c)]['prod_invoice']],_0x32656e=[..._0x1e6f5c['body'][_0x4207b2(0x16d)]];const _0x2fb323=_0x4d014f['map'](_0x3b5300=>{return _0x3b5300={'product_name':_0x3b5300};});_0x1d1f70[_0x4207b2(0x1ce)]((_0x1dff72,_0x12bc8c)=>{var _0x3bd3e9=_0x4207b2,_0x1253e8=_0x1dff72['match'](/[A-Za-z]+/)[0x0],_0x4eeee1=parseInt(_0x1dff72[_0x3bd3e9(0x1f0)](/\d+/)[0x0]);_0x2fb323[_0x12bc8c]['level']=_0x1253e8,_0x2fb323[_0x12bc8c][_0x3bd3e9(0x16b)]=_0x4eeee1;}),_0x32656e[_0x4207b2(0x1ce)]((_0x3056b6,_0x4244f1)=>{_0x2fb323[_0x4244f1]['id_transaction']=_0x3056b6;}),_0x38ec0e[_0x4207b2(0x1ce)]((_0x45f428,_0x3b35fe)=>{var _0x5018aa=_0x4207b2;_0x2fb323[_0x3b35fe][_0x5018aa(0x17e)]=_0x45f428;}),_0x256975[_0x4207b2(0x1ce)]((_0x3a3c15,_0x42631d)=>{var _0x4ffb6d=_0x4207b2;_0x2fb323[_0x42631d][_0x4ffb6d(0x1b7)]=_0x3a3c15;}),_0x16a55d[_0x4207b2(0x1ce)]((_0x1a292a,_0x222829)=>{var _0x4bd5b5=_0x4207b2;_0x2fb323[_0x222829][_0x4bd5b5(0x160)]=_0x1a292a;}),_0x50c7a0[_0x4207b2(0x1ce)]((_0x24671c,_0x4f7016)=>{var _0x1f612b=_0x4207b2;_0x2fb323[_0x4f7016][_0x1f612b(0x166)]=_0x24671c;}),_0x5ef227['forEach']((_0xb5714f,_0xd2779e)=>{var _0x186379=_0x4207b2;_0x2fb323[_0xd2779e][_0x186379(0x1a0)]=_0xb5714f;}),_0x5d2a34['forEach']((_0x347dbd,_0x15876b)=>{var _0x1a7815=_0x4207b2;_0x2fb323[_0x15876b][_0x1a7815(0x1dc)]=_0x347dbd;}),_0x4c0fd6[_0x4207b2(0x1ce)]((_0xe55e57,_0x223beb)=>{var _0xcb23f9=_0x4207b2;_0x2fb323[_0x223beb][_0xcb23f9(0x1f4)]=_0xe55e57;}),_0x488063[_0x4207b2(0x1ce)]((_0x1d43a4,_0x576367)=>{var _0x40e72c=_0x4207b2;_0x2fb323[_0x576367][_0x40e72c(0x1c3)]=_0x1d43a4;}),_0x587b6b[_0x4207b2(0x1ce)]((_0x1786df,_0x2a8294)=>{var _0x16fc20=_0x4207b2;_0x2fb323[_0x2a8294][_0x16fc20(0x186)]=_0x1786df;}),_0x526bca[_0x4207b2(0x1ce)]((_0x363390,_0x2e0786)=>{var _0x5e0128=_0x4207b2;_0x2fb323[_0x2e0786][_0x5e0128(0x1b0)]=_0x363390;}),_0x3e0aaa['forEach']((_0x168a70,_0x43004f)=>{var _0x1e1687=_0x4207b2;_0x2fb323[_0x43004f][_0x1e1687(0x1ca)]=_0x168a70;}),_0x1ed9c2[_0x4207b2(0x1ce)]((_0x6fff4f,_0x56ebaf)=>{var _0x526f5e=_0x4207b2;_0x2fb323[_0x56ebaf][_0x526f5e(0x183)]=_0x6fff4f;}),_0x3673c6[_0x4207b2(0x1ce)]((_0x31a464,_0x222fb2)=>{var _0xd8f21e=_0x4207b2;_0x2fb323[_0x222fb2][_0xd8f21e(0x190)]=_0x31a464;}),_0xb21db7[_0x4207b2(0x1ce)]((_0x1b8a64,_0x49438a)=>{var _0x41319b=_0x4207b2;_0x2fb323[_0x49438a][_0x41319b(0x16c)]=_0x1b8a64;});const _0x212092=_0x2fb323[_0x4207b2(0x1e9)](_0x3e004c=>_0x3e004c[_0x4207b2(0x160)]!=='0'&&_0x3e004c['adjust_qty']!=='');var _0x480230=0x0;_0x212092[_0x4207b2(0x1ce)](_0x16b253=>{var _0x25f10=_0x4207b2;console[_0x25f10(0x1b5)](_0x25f10(0x18b),_0x16b253),parseInt(_0x16b253[_0x25f10(0x160)])<=0x0&&_0x480230++;});if(_0x480230!=0x0)return _0x1e6f5c[_0x4207b2(0x1e0)](_0x4207b2(0x177),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x2d7158['redirect'](_0x4207b2(0x1db));const _0x388892=new adjustment_logs();await _0x388892[_0x4207b2(0x1fa)]();const _0x1fd2a5=new adjustment_finished({'warehouse_name':_0x395c0b,'date':_0x106d62,'product':_0x212092,'note':_0x4a1594,'room':_0x10e394,'invoice':_0x4207b2(0x1c8)+_0x388892[_0x4207b2(0x1ed)][_0x4207b2(0x159)]()[_0x4207b2(0x18c)](0x8,'0'),'JO_number':_0x546088,'expiry_date':_0xcb2364,'type_of_transaction':_0x4d6432,'PO_number':_0x13dd5b,'RequestedBy':_0x30e79c,'DateofRequest':_0x308663,'typeservices':_0x438313,'destination':_0x4f145a,'deliverydate':_0xaf9b58,'driver':_0x5edcb6,'plate':_0x3ecad8,'van':_0x2c865f,'DRSI':_0x229cfa,'typevehicle':_0x1c6d79,'TSU':_0x5f24f7,'TFU':_0xeb94aa}),_0x13c5c5=await _0x1fd2a5[_0x4207b2(0x1fa)]();_0x1e6f5c[_0x4207b2(0x1e0)](_0x4207b2(0x1e1),_0x4207b2(0x1be)),_0x2d7158[_0x4207b2(0x15e)]('/adjustment_finished/preview/'+_0x13c5c5[_0x4207b2(0x1e2)]);}catch(_0x547203){console[_0x4207b2(0x1b5)](_0x547203),_0x2d7158[_0x4207b2(0x1cf)](0xc8)[_0x4207b2(0x198)]({'message':_0x547203[_0x4207b2(0x151)]});}}),router[a0_0x2b6326(0x187)](a0_0x2b6326(0x155),auth,async(_0x8ee6ab,_0x6f2e74)=>{var _0x511990=a0_0x2b6326;try{const {username:_0x1c55ca,email:_0x3f4af5,role:_0x59c548}=_0x8ee6ab[_0x511990(0x1ac)],_0xd62aa9=_0x8ee6ab[_0x511990(0x1ac)],_0x5d8200=await profile[_0x511990(0x182)]({'email':_0xd62aa9[_0x511990(0x18f)]}),_0x355bdf=await master_shop['find'](),_0x5c603b=_0x8ee6ab[_0x511990(0x16f)]['id'],_0x1439a8=await adjustment_finished[_0x511990(0x1a7)]({'_id':_0x5c603b}),_0x352b93=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1439a8['warehouse_name']}},{'$unwind':_0x511990(0x193)},{'$group':{'_id':_0x511990(0x163)}}]);console[_0x511990(0x1b5)](_0x511990(0x1fd),_0x352b93);const _0x42c2e9=await product[_0x511990(0x1ad)]({}),_0x307223=await warehouse[_0x511990(0x173)]([{'$match':{'name':_0x1439a8['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x511990(0x1ff),'name':{'$first':_0x511990(0x17b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x511990(0x171)},'bin':{'$first':_0x511990(0x168)},'type':{'$first':_0x511990(0x1fb)},'floorlevel':{'$first':_0x511990(0x194)},'primary_code':{'$first':_0x511990(0x1b9)},'secondary_code':{'$first':_0x511990(0x180)},'product_code':{'$first':_0x511990(0x1a5)},'storage':{'$first':_0x511990(0x1d7)},'rack':{'$first':_0x511990(0x1b1)},'expiry_date':{'$first':_0x511990(0x1d8)},'production_date':{'$first':_0x511990(0x1b6)},'batch_code':{'$first':_0x511990(0x1ea)},'maxPerUnit':{'$first':_0x511990(0x17d)},'room':{'$first':_0x511990(0x1f3)}}}]);if(_0x355bdf[0x0][_0x511990(0x1e4)]=='English\x20(US)'){var _0x54636c=users['English'];console[_0x511990(0x1b5)](_0x54636c);}else{if(_0x355bdf[0x0][_0x511990(0x1e4)]==_0x511990(0x1a3))var _0x54636c=users[_0x511990(0x1a3)];else{if(_0x355bdf[0x0]['language']=='German')var _0x54636c=users['German'];else{if(_0x355bdf[0x0][_0x511990(0x1e4)]=='Spanish')var _0x54636c=users[_0x511990(0x1f5)];else{if(_0x355bdf[0x0]['language']=='French')var _0x54636c=users['French'];else{if(_0x355bdf[0x0]['language']==_0x511990(0x1a8))var _0x54636c=users[_0x511990(0x1d1)];else{if(_0x355bdf[0x0][_0x511990(0x1e4)]==_0x511990(0x17c))var _0x54636c=users[_0x511990(0x17c)];else{if(_0x355bdf[0x0][_0x511990(0x1e4)]=='Arabic\x20(ae)')var _0x54636c=users[_0x511990(0x1f8)];}}}}}}}_0x6f2e74[_0x511990(0x1c4)](_0x511990(0x18e),{'success':_0x8ee6ab[_0x511990(0x1e0)](_0x511990(0x1e1)),'errors':_0x8ee6ab[_0x511990(0x1e0)](_0x511990(0x177)),'role':_0xd62aa9,'profile':_0x5d8200,'adjustment':_0x1439a8,'stock':_0x307223,'master_shop':_0x355bdf,'warehouse_name':_0x352b93,'unit':_0x42c2e9,'language':_0x54636c});}catch(_0x42d17f){console[_0x511990(0x1b5)](_0x42d17f),_0x6f2e74['status'](0xc8)[_0x511990(0x198)]({'message':_0x42d17f[_0x511990(0x151)]});}}),router[a0_0x2b6326(0x165)](a0_0x2b6326(0x155),auth,async(_0x26e436,_0xa8bf35)=>{var _0x4c9373=a0_0x2b6326;try{const {invoice:_0x955e6a,warehouse_name:_0x26286f,Room_name:_0x1d21e0}=_0x26e436[_0x4c9373(0x19c)],_0x2dda87=_0x26e436[_0x4c9373(0x16f)]['id'],_0x3b5070=await adjustment_finished[_0x4c9373(0x1a7)]({'_id':_0x2dda87});var _0x489429;const _0x28be3a=_0x3b5070[_0x4c9373(0x192)][_0x4c9373(0x1b2)](async _0xf64299=>{var _0x5aa651=_0x4c9373;if(_0xf64299[_0x5aa651(0x160)]>0x0){_0x489429=await warehouse[_0x5aa651(0x182)]({'name':_0x26286f,'room':_0xf64299[_0x5aa651(0x183)]});const _0x350c9f=_0x489429[_0x5aa651(0x1ef)]['map'](_0xf0c150=>{var _0x4155a9=_0x5aa651;console['log'](_0xf64299[_0x4155a9(0x1b7)]);if(_0xf64299['types']==_0x4155a9(0x1da))_0xf0c150[_0x4155a9(0x1e2)]==_0xf64299[_0x4155a9(0x1d6)]&&(_0xf0c150[_0x4155a9(0x19b)]=_0xf0c150[_0x4155a9(0x19b)]-_0xf64299[_0x4155a9(0x160)]);else _0xf64299[_0x4155a9(0x1b7)]==_0x4155a9(0x17f)&&(_0xf0c150[_0x4155a9(0x1e2)]==_0xf64299[_0x4155a9(0x1d6)]&&(_0xf0c150[_0x4155a9(0x19b)]=_0xf0c150['product_stock']+_0xf64299[_0x4155a9(0x160)]));});}return _0x489429;});Promise[_0x4c9373(0x1c7)](_0x28be3a)[_0x4c9373(0x1af)](async _0x3b8966=>{var _0x157c61=_0x4c9373;try{for(const _0x2f71c1 of _0x3b8966){await _0x2f71c1[_0x157c61(0x1fa)]();}_0x3b5070[_0x157c61(0x1cd)]=_0x157c61(0x167);const _0x2ff59b=await _0x3b5070[_0x157c61(0x1fa)](),_0x842800=await master_shop[_0x157c61(0x1ad)](),_0x5175af=await email_settings['findOne'](),_0xe0a895=await supervisor_settings[_0x157c61(0x1ad)]();var _0x3ec36e=_0x3b5070[_0x157c61(0x192)],_0x26d372='',_0x18389d;for(_0x18389d in _0x3ec36e){var _0xe7be5a='FG';_0x3b5070[_0x157c61(0x176)]==_0x157c61(0x1bd)&&(_0xe7be5a='DG'),_0x26d372+=_0x157c61(0x153)+_0x157c61(0x1e6)+_0x3ec36e[_0x18389d][_0x157c61(0x178)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ec36e[_0x18389d][_0x157c61(0x1f4)]+_0x157c61(0x174)+_0x157c61(0x1e6)+_0x3ec36e[_0x18389d][_0x157c61(0x160)]+_0x157c61(0x174)+_0x157c61(0x1e6)+_0x3ec36e[_0x18389d][_0x157c61(0x1a0)]+_0x157c61(0x174)+_0x157c61(0x1e6)+_0x3ec36e[_0x18389d][_0x157c61(0x1dc)]+_0x157c61(0x174)+_0x157c61(0x1e6)+_0x3b5070[_0x157c61(0x176)]+_0x157c61(0x174)+_0x157c61(0x1e6)+_0x3ec36e[_0x18389d][_0x157c61(0x183)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xe7be5a+_0x3ec36e[_0x18389d][_0x157c61(0x16b)]+_0x157c61(0x174)+_0x157c61(0x188);}_0x26e436[_0x157c61(0x1e0)]('success',_0x157c61(0x185)),_0xa8bf35[_0x157c61(0x15e)](_0x157c61(0x1ab)+_0x2ff59b[_0x157c61(0x1e2)]);}catch(_0x486690){console['error'](_0x486690),_0xa8bf35[_0x157c61(0x1cf)](0x1f4)[_0x157c61(0x198)]({'error':_0x157c61(0x1bc)});}})[_0x4c9373(0x1f6)](_0x19dac4=>{var _0x1710ca=_0x4c9373;console[_0x1710ca(0x179)](_0x19dac4),_0xa8bf35['status'](0x1f4)[_0x1710ca(0x198)]({'error':_0x1710ca(0x1cb)});});}catch(_0x5a20c5){_0xa8bf35[_0x4c9373(0x198)]({'message':_0x5a20c5[_0x4c9373(0x151)]});}}),router[a0_0x2b6326(0x187)](a0_0x2b6326(0x1d0),auth,async(_0x48af7f,_0x2db7ad)=>{var _0x26c6ca=a0_0x2b6326;try{const {username:_0x5dceec,email:_0x2b942e,role:_0x96f49e}=_0x48af7f[_0x26c6ca(0x1ac)],_0xfdc0ef=_0x48af7f[_0x26c6ca(0x1ac)],_0x4a2d8a=await profile[_0x26c6ca(0x182)]({'email':_0xfdc0ef[_0x26c6ca(0x18f)]}),_0x39fe04=await master_shop[_0x26c6ca(0x1ad)]();console[_0x26c6ca(0x1b5)](_0x26c6ca(0x15a),_0x39fe04);const _0x27d978=_0x48af7f[_0x26c6ca(0x16f)]['id'],_0x4f5b5d=await adjustment_finished[_0x26c6ca(0x1a7)]({'_id':_0x27d978});let _0xaff22c=new Date(_0x4f5b5d[_0x26c6ca(0x186)]),_0x1fa454=('0'+_0xaff22c['getDate']())[_0x26c6ca(0x18a)](-0x2),_0x23d7a9=('0'+(_0xaff22c['getMonth']()+0x1))[_0x26c6ca(0x18a)](-0x2),_0x380aed=_0xaff22c[_0x26c6ca(0x189)](),_0x1b7863=_0x380aed+'-'+_0x23d7a9+'-'+_0x1fa454;var _0x50f7a2=[_0x26c6ca(0x175),_0x26c6ca(0x1d3),_0x26c6ca(0x200)];const _0x50aaf0=await purchases[_0x26c6ca(0x173)]([{'$match':{'warehouse_name':_0x4f5b5d[_0x26c6ca(0x176)]}},{'$unwind':_0x26c6ca(0x193)},{'$group':{'_id':_0x26c6ca(0x163)}}]);console[_0x26c6ca(0x1b5)](_0x26c6ca(0x1fd),_0x50aaf0);const _0x2c278e=await product[_0x26c6ca(0x1ad)]({}),_0x2d5da5=await warehouse[_0x26c6ca(0x173)]([{'$match':{'name':_0x4f5b5d['warehouse_name'],'room':_0x4f5b5d[_0x26c6ca(0x15b)]}},{'$unwind':_0x26c6ca(0x199)},{'$group':{'_id':_0x26c6ca(0x1ff),'name':{'$first':_0x26c6ca(0x17b)},'product_stock':{'$first':_0x26c6ca(0x1dd)},'bay':{'$first':_0x26c6ca(0x171)},'bin':{'$first':_0x26c6ca(0x168)},'type':{'$first':_0x26c6ca(0x1fb)},'floorlevel':{'$first':_0x26c6ca(0x194)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x26c6ca(0x180)},'product_code':{'$first':_0x26c6ca(0x1a5)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);if(_0x39fe04[0x0][_0x26c6ca(0x1e4)]==_0x26c6ca(0x195)){var _0xe02506=users[_0x26c6ca(0x1f7)];console[_0x26c6ca(0x1b5)](_0xe02506);}else{if(_0x39fe04[0x0][_0x26c6ca(0x1e4)]==_0x26c6ca(0x1a3))var _0xe02506=users[_0x26c6ca(0x1a3)];else{if(_0x39fe04[0x0][_0x26c6ca(0x1e4)]==_0x26c6ca(0x1d9))var _0xe02506=users['German'];else{if(_0x39fe04[0x0][_0x26c6ca(0x1e4)]==_0x26c6ca(0x1f5))var _0xe02506=users[_0x26c6ca(0x1f5)];else{if(_0x39fe04[0x0][_0x26c6ca(0x1e4)]=='French')var _0xe02506=users[_0x26c6ca(0x1fe)];else{if(_0x39fe04[0x0]['language']==_0x26c6ca(0x1a8))var _0xe02506=users['Portuguese'];else{if(_0x39fe04[0x0]['language']=='Chinese')var _0xe02506=users['Chinese'];else{if(_0x39fe04[0x0]['language']=='Arabic\x20(ae)')var _0xe02506=users[_0x26c6ca(0x1f8)];}}}}}}}_0x2db7ad[_0x26c6ca(0x1c4)]('edit_adjustment_finished',{'success':_0x48af7f['flash']('success'),'errors':_0x48af7f[_0x26c6ca(0x1e0)](_0x26c6ca(0x177)),'role':_0xfdc0ef,'profile':_0x4a2d8a,'adjustment':_0x4f5b5d,'stock':_0x2d5da5,'master_shop':_0x39fe04,'warehouse_name':_0x50aaf0,'unit':_0x2c278e,'language':_0xe02506,'rooms_data':_0x50f7a2,'ed_fullDate':_0x1b7863});}catch(_0x3eb9c4){console[_0x26c6ca(0x1b5)](_0x3eb9c4),_0x2db7ad['status'](0xc8)[_0x26c6ca(0x198)]({'message':_0x3eb9c4['message']});}}),router[a0_0x2b6326(0x165)](a0_0x2b6326(0x1d0),auth,async(_0x3248ca,_0x5a85bd)=>{var _0x51cd86=a0_0x2b6326;try{const _0x2a85e6=_0x3248ca[_0x51cd86(0x16f)]['id'],_0x2464de=await adjustment_finished[_0x51cd86(0x1a7)]({'_id':_0x2a85e6}),_0x5e1bec=await warehouse[_0x51cd86(0x182)]({'name':_0x2464de[_0x51cd86(0x176)],'room':_0x2464de['room']}),{warehouse_name:_0x3e6bd0,date:_0x51b536,prod_name:_0x12f258,level:_0xb24f35,isle:_0x590ec7,pallet:_0x4892da,stock:_0x54b242,types:_0x55cbcb,adjust_qty:_0xd74a1c,new_adjust_qty:_0x3f304b,note:_0x1a766f,Room_name:_0x1f8d89,invoice:_0x385288,JO_number:_0x46694b}=_0x3248ca[_0x51cd86(0x19c)];if(typeof _0x12f258==_0x51cd86(0x1bb))var _0x5e4c3f=[_0x3248ca['body']['prod_name']],_0x4621be=[_0x3248ca[_0x51cd86(0x19c)]['level']],_0x108db4=[_0x3248ca[_0x51cd86(0x19c)]['stock']],_0x4e4bbb=[_0x3248ca[_0x51cd86(0x19c)]['types']],_0xa816a1=[_0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x160)]],_0x44c504=[_0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x166)]],_0x37e9af=[_0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1c2)]],_0x2292e7=[_0x3248ca['body'][_0x51cd86(0x1a0)]],_0x42c704=[_0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1a4)]],_0x3c464d=[_0x3248ca['body'][_0x51cd86(0x1c3)]],_0x111294=[_0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x186)]];else var _0x5e4c3f=[..._0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1de)]],_0x4621be=[..._0x3248ca['body'][_0x51cd86(0x181)]],_0x108db4=[..._0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1b8)]],_0x4e4bbb=[..._0x3248ca[_0x51cd86(0x19c)]['types']],_0xa816a1=[..._0x3248ca[_0x51cd86(0x19c)]['adjust_qty']],_0x44c504=[..._0x3248ca[_0x51cd86(0x19c)]['new_adjust_qty']],_0x37e9af=[..._0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1c2)]],_0x2292e7=[..._0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1a0)]],_0x42c704=[..._0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x1a4)]],_0x3c464d=[..._0x3248ca['body']['batch_code']],_0x111294=[..._0x3248ca[_0x51cd86(0x19c)][_0x51cd86(0x186)]];const _0x2ba5ff=_0x5e4c3f[_0x51cd86(0x1b2)](_0x55bb80=>{return _0x55bb80={'product_name':_0x55bb80};});_0x4621be[_0x51cd86(0x1ce)]((_0x583bbe,_0x1d3dc7)=>{var _0x3eead4=_0x51cd86;_0x2ba5ff[_0x1d3dc7][_0x3eead4(0x16b)]=_0x583bbe;}),_0x108db4[_0x51cd86(0x1ce)]((_0x587d37,_0x12f4c2)=>{var _0x121b93=_0x51cd86;_0x2ba5ff[_0x12f4c2][_0x121b93(0x17e)]=_0x587d37;}),_0x4e4bbb[_0x51cd86(0x1ce)]((_0x5da5bb,_0x15a964)=>{_0x2ba5ff[_0x15a964]['types']=_0x5da5bb;}),_0xa816a1[_0x51cd86(0x1ce)]((_0x805871,_0x2484ae)=>{var _0x1f7abe=_0x51cd86;_0x2ba5ff[_0x2484ae][_0x1f7abe(0x160)]=_0x805871;}),_0x44c504[_0x51cd86(0x1ce)]((_0x398a9f,_0x4dc79e)=>{var _0xf51534=_0x51cd86;_0x2ba5ff[_0x4dc79e][_0xf51534(0x166)]=_0x398a9f;}),_0x2292e7['forEach']((_0x488681,_0x3f1946)=>{_0x2ba5ff[_0x3f1946]['unit']=_0x488681;}),_0x42c704[_0x51cd86(0x1ce)]((_0x2d4086,_0x1a21c7)=>{var _0x901b16=_0x51cd86;_0x2ba5ff[_0x1a21c7][_0x901b16(0x1dc)]=_0x2d4086;}),_0x37e9af[_0x51cd86(0x1ce)]((_0x3bfdee,_0x2d5e8a)=>{var _0xe39a77=_0x51cd86;_0x2ba5ff[_0x2d5e8a][_0xe39a77(0x1f4)]=_0x3bfdee;}),_0x3c464d[_0x51cd86(0x1ce)]((_0x5ac135,_0x5f439f)=>{var _0x538f8d=_0x51cd86;_0x2ba5ff[_0x5f439f][_0x538f8d(0x1c3)]=_0x5ac135;}),_0x111294['forEach']((_0x36ea66,_0x5bee47)=>{var _0x50e053=_0x51cd86;_0x2ba5ff[_0x5bee47][_0x50e053(0x186)]=_0x36ea66;});const _0x55129d=_0x2ba5ff[_0x51cd86(0x1e9)](_0xf3bb28=>_0xf3bb28['adjust_qty']!=='0'&&_0xf3bb28[_0x51cd86(0x160)]!=='');var _0x2ef49d=0x0;_0x55129d[_0x51cd86(0x1ce)](_0x47dec4=>{var _0x4e3366=_0x51cd86;console[_0x4e3366(0x1b5)](_0x4e3366(0x18b),_0x47dec4),parseInt(_0x47dec4[_0x4e3366(0x160)])<=0x0&&_0x2ef49d++;});if(_0x2ef49d!=0x0)return _0x3248ca[_0x51cd86(0x1e0)](_0x51cd86(0x177),_0x51cd86(0x17a)),_0x5a85bd[_0x51cd86(0x15e)]('back');_0x2464de[_0x51cd86(0x176)]=_0x3e6bd0,_0x2464de[_0x51cd86(0x1aa)]=_0x51b536,_0x2464de[_0x51cd86(0x192)]=_0x55129d,_0x2464de[_0x51cd86(0x201)]=_0x1a766f,_0x2464de[_0x51cd86(0x15b)]=_0x1f8d89,_0x2464de['invoice']=_0x385288,_0x2464de[_0x51cd86(0x1e3)]=_0x46694b;const _0x294deb=await _0x2464de[_0x51cd86(0x1fa)](),_0x10585e=await warehouse['findOne']({'name':_0x3e6bd0,'room':_0x1f8d89});_0x294deb['product'][_0x51cd86(0x1ce)](_0x3624a3=>{var _0x51e611=_0x51cd86;const _0xe5fcf8=_0x10585e[_0x51e611(0x1ef)][_0x51e611(0x1b2)](_0x3c099f=>{var _0x4a7a95=_0x51e611;_0x3624a3['types']==_0x4a7a95(0x1da)?_0x3c099f[_0x4a7a95(0x178)]==_0x3624a3[_0x4a7a95(0x178)]&&_0x3c099f[_0x4a7a95(0x16b)]==_0x3624a3[_0x4a7a95(0x16b)]&&(_0x3c099f['product_stock']=parseInt(_0x3c099f['product_stock'])-parseInt(_0x3624a3[_0x4a7a95(0x160)])):_0x3c099f[_0x4a7a95(0x178)]==_0x3624a3['product_name']&&_0x3c099f[_0x4a7a95(0x16b)]==_0x3624a3[_0x4a7a95(0x16b)]&&(_0x3c099f['product_stock']=parseInt(_0x3c099f[_0x4a7a95(0x19b)])+parseInt(_0x3624a3[_0x4a7a95(0x160)]));});}),await _0x10585e[_0x51cd86(0x1fa)](),_0x3248ca[_0x51cd86(0x1e0)]('success',_0x51cd86(0x184)),_0x5a85bd[_0x51cd86(0x15e)](_0x51cd86(0x1ec));}catch(_0x449058){console[_0x51cd86(0x1b5)](_0x449058);}}),router[a0_0x2b6326(0x165)](a0_0x2b6326(0x197),async(_0x4cbfea,_0x15af96)=>{var _0xffa981=a0_0x2b6326;const {primary_code:_0x3495bb,warehouse_data:_0x56bd78,rooms_data:_0x22f06c,Roomslist:_0x35289a}=_0x4cbfea['body'],_0x13fef7=_0x35289a[_0xffa981(0x1a2)](','),_0x48e55c=[];async function _0x3f9cb1(_0x43704b){var _0x3a5cb5=_0xffa981;const _0x5e6adc=await warehouse[_0x3a5cb5(0x173)]([{'$match':{'name':_0x56bd78,'room':_0x43704b}},{'$unwind':_0x3a5cb5(0x199)},{'$match':{'product_details.primary_code':_0x3495bb}},{'$group':{'_id':_0x3a5cb5(0x1ff),'name':{'$first':_0x3a5cb5(0x17b)},'product_stock':{'$first':_0x3a5cb5(0x1dd)},'primary_code':{'$first':_0x3a5cb5(0x1b9)},'secondary_code':{'$first':_0x3a5cb5(0x180)},'product_code':{'$first':_0x3a5cb5(0x1a5)},'level':{'$first':_0x3a5cb5(0x1c9)},'bay':{'$first':_0x3a5cb5(0x171)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3a5cb5(0x1d7)},'rack':{'$first':_0x3a5cb5(0x1b1)},'expiry_date':{'$first':_0x3a5cb5(0x1d8)},'production_date':{'$first':_0x3a5cb5(0x1b6)},'batch_code':{'$first':_0x3a5cb5(0x1ea)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x3a5cb5(0x17d)},'roomNamed':{'$first':_0x3a5cb5(0x1f3)},'invoice':{'$first':_0x3a5cb5(0x169)}}}]),_0x1bc798=await warehouse[_0x3a5cb5(0x173)]([{'$match':{'name':_0x56bd78,'room':_0x43704b}},{'$unwind':_0x3a5cb5(0x199)},{'$match':{'product_details.secondary_code':_0x3495bb}},{'$group':{'_id':_0x3a5cb5(0x1ff),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3a5cb5(0x1dd)},'primary_code':{'$first':_0x3a5cb5(0x1b9)},'secondary_code':{'$first':_0x3a5cb5(0x180)},'product_code':{'$first':_0x3a5cb5(0x1a5)},'level':{'$first':_0x3a5cb5(0x1c9)},'bay':{'$first':_0x3a5cb5(0x171)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3a5cb5(0x194)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3a5cb5(0x1b1)},'expiry_date':{'$first':_0x3a5cb5(0x1d8)},'production_date':{'$first':_0x3a5cb5(0x1b6)},'batch_code':{'$first':_0x3a5cb5(0x1ea)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x3a5cb5(0x17d)},'roomNamed':{'$first':_0x3a5cb5(0x1f3)},'invoice':{'$first':_0x3a5cb5(0x169)}}}]);if(_0x5e6adc[_0x3a5cb5(0x172)]>0x0)_0x48e55c[_0x3a5cb5(0x1d4)](_0x5e6adc);else _0x1bc798[_0x3a5cb5(0x172)]>0x0&&_0x48e55c[_0x3a5cb5(0x1d4)](_0x1bc798);}const _0x470c1c=_0x13fef7[_0xffa981(0x1b2)](_0xf17bd2=>_0x3f9cb1(_0xf17bd2));await Promise[_0xffa981(0x1c7)](_0x470c1c),_0x15af96[_0xffa981(0x198)](_0x48e55c);}),router[a0_0x2b6326(0x165)](a0_0x2b6326(0x15f),async(_0x40fdd0,_0x24237f)=>{var _0x2a365d=a0_0x2b6326;const {productCode:_0x4fa285,bay:_0x5841c6,warehouses:_0x4e5784,room:_0x420ea2}=_0x40fdd0['body'];console['log'](_0x40fdd0[_0x2a365d(0x19c)]);try{const _0x4e516c=await warehouse[_0x2a365d(0x173)]([{'$match':{'name':_0x4e5784,'room':_0x420ea2}},{'$unwind':_0x2a365d(0x199)},{'$match':{'product_details.bay':parseInt(_0x5841c6)}},{'$group':{'_id':_0x2a365d(0x1ff),'name':{'$first':_0x2a365d(0x17b)},'product_stock':{'$first':_0x2a365d(0x1dd)},'bay':{'$first':_0x2a365d(0x171)},'maxProducts':{'$first':_0x2a365d(0x1e7)}}}]);_0x24237f[_0x2a365d(0x1cf)](0xc8)[_0x2a365d(0x198)](_0x4e516c);}catch(_0x22772a){_0x24237f[_0x2a365d(0x1cf)](0x194)['json']({'message':_0x22772a[_0x2a365d(0x151)]});}}),module[a0_0x2b6326(0x1e8)]=router;