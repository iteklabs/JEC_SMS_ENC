function a0_0x4fe6(_0x430e55,_0x523d58){var _0x2ba466=a0_0x2ba4();return a0_0x4fe6=function(_0x4fe622,_0x323b5c){_0x4fe622=_0x4fe622-0x192;var _0x235bea=_0x2ba466[_0x4fe622];return _0x235bea;},a0_0x4fe6(_0x430e55,_0x523d58);}function a0_0x2ba4(){var _0x38d02c=['True','3075520SBpoNc','filter','$product_details.product_stock','padStart','adjustment_finished','Hindi','room_names','nodemailer','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','Chinese','$invoice','success','$product_details.secondary_unit','Portuguese','split','Primary_Units','$product_details.level','/view/add_adjustment','aggregate','body','error','bay','batch_code','stock','<tr>','$product_details.floorlevel','$product_details.expiry_date','slice','forEach','/barcode_scanner','foreach\x20newproduct','new_adjust_qty','_id','purchases_data','user','adjustment\x20add\x20successfull','maxPerUnit','162vAqzRw','There\x27s\x20a\x20error\x20in\x20this\x20transaction','New_Qty_Converted','$product_details.maxPerUnit','level','date','product_stock','/adjustment_finished/preview/','product_name','master','$product_details.production_date','New_Qty_Converted_adj','4365112timMvz','minus','product','36981TOXest','Adjustment\x20Finalize\x20Successfully','then','$product_details.bin','catch','$product_details.batch_code','staff','match','/picking_list/PDF_adjustmentFinal/','email','French','DRY\x20GOODS','LOG-ADJ-','invoice_init','getFullYear','id_transaction_from','$product.product_name','express','warehouse','Enclosed','warehouse_name','floor','room','get','$date','language','length','getMonth','$product_details.secondary_code','json','params','ADJ-','back','$product_details.invoice','render','English','/preview/:id','Enabled','Arabic','Rooms','production_date','$name','types','string','/adjustment/view','11qgZKvk','flash','$finalize','prod_name','exports','expiry_date','$product_details.primary_code','../models/all_models','prod_invoice','1687772ffxBui','find','prod_code','47594TlgJco','$product_details.rack','$product_details.storage','log','findOne','English\x20(US)','redirect','Portuguese\x20(BR)','</tr>','</td>','../middleware/auth','$product_details.unit','secondary_unit','role','4096530HzrIkn','add','$product_details.product_name','getDate','Router','logs','adjust_qty','$product_details.product_code','$warehouse_name','product_code','9COGNdw','push','prod_cat','unit','product_details','../public/language/languages.json','post','id_transaction','product_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','edit_adjustment_finished_view','Spanish','map','Ambient','$product','715616YOonWP','stockBefore','$_id','$product_details','errors','invoice','$product_details.type','/view/add_adjustment_logs','Arabic\x20(ae)','Return\x20Rooms','random','message','/view_logs','ADJF-','save','edit_adjustment_finished','adjustment_finished_logs','findById','toString','German','status','JO_number','21vwhrpf','$product.room_names','$product_details.bay','$room','An\x20error\x20occurred.','Secondary_units','all','note','/view','$product_details._id'];a0_0x2ba4=function(){return _0x38d02c;};return a0_0x2ba4();}var a0_0x1c6f14=a0_0x4fe6;(function(_0x3692d6,_0x283796){var _0x1c113c=a0_0x4fe6,_0x8383a2=_0x3692d6();while(!![]){try{var _0x5ba807=-parseInt(_0x1c113c(0x1a0))/0x1+-parseInt(_0x1c113c(0x22e))/0x2*(-parseInt(_0x1c113c(0x1b6))/0x3)+parseInt(_0x1c113c(0x22b))/0x4+parseInt(_0x1c113c(0x1c1))/0x5+-parseInt(_0x1c113c(0x1e6))/0x6*(-parseInt(_0x1c113c(0x1f5))/0x7)+parseInt(_0x1c113c(0x1f2))/0x8*(-parseInt(_0x1c113c(0x246))/0x9)+parseInt(_0x1c113c(0x23c))/0xa*(parseInt(_0x1c113c(0x222))/0xb);if(_0x5ba807===_0x283796)break;else _0x8383a2['push'](_0x8383a2['shift']());}catch(_0xcfc690){_0x8383a2['push'](_0x8383a2['shift']());}}}(a0_0x2ba4,0x78c49));const express=require(a0_0x1c6f14(0x206)),app=express(),router=express[a0_0x1c6f14(0x240)](),auth=require(a0_0x1c6f14(0x238)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x1c6f14(0x229)),users=require(a0_0x1c6f14(0x196)),nodemailer=require(a0_0x1c6f14(0x1c8));router['get'](a0_0x1c6f14(0x1be),auth,async(_0x473f2e,_0x237f6c)=>{var _0xa7e90a=a0_0x1c6f14;try{const {username:_0x574266,email:_0x13ed9,role:_0x132bdf}=_0x473f2e[_0xa7e90a(0x1e3)],_0x164925=_0x473f2e[_0xa7e90a(0x1e3)],_0x3e912a=await profile[_0xa7e90a(0x232)]({'email':_0x164925[_0xa7e90a(0x1fe)]}),_0x2d4683=await master_shop[_0xa7e90a(0x22c)]();let _0x222aba;if(_0x164925['role']==_0xa7e90a(0x1fb)){const _0xdb255=await staff['findOne']({'email':_0x164925[_0xa7e90a(0x1fe)]});_0x222aba=await warehouse[_0xa7e90a(0x22c)]({'status':'Enabled','name':_0xdb255['warehouse']});}else _0x222aba=await warehouse[_0xa7e90a(0x22c)]({'status':'Enabled'});const _0x40c38e=await product['find']();let _0x19983a;if(_0x164925[_0xa7e90a(0x23b)]==_0xa7e90a(0x1fb)){const _0x39a759=await staff[_0xa7e90a(0x232)]({'email':_0x164925[_0xa7e90a(0x1fe)]});_0x19983a=await adjustment_finished[_0xa7e90a(0x22c)]({'warehouse_name':_0x39a759['warehouse']});}else _0x19983a=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0xa7e90a(0x19f)},{'$group':{'_id':_0xa7e90a(0x1a2),'invoice':{'$first':_0xa7e90a(0x1cb)},'date':{'$first':_0xa7e90a(0x20d)},'warehouse_name':{'$first':_0xa7e90a(0x244)},'room':{'$addToSet':_0xa7e90a(0x1b7)},'finalize':{'$first':_0xa7e90a(0x224)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2d4683[0x0]['language']==_0xa7e90a(0x233)){var _0x599eaa=users[_0xa7e90a(0x218)];console[_0xa7e90a(0x231)](_0x599eaa);}else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]==_0xa7e90a(0x1c6))var _0x599eaa=users[_0xa7e90a(0x1c6)];else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]==_0xa7e90a(0x1b3))var _0x599eaa=users[_0xa7e90a(0x1b3)];else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]=='Spanish')var _0x599eaa=users[_0xa7e90a(0x19c)];else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]==_0xa7e90a(0x1ff))var _0x599eaa=users[_0xa7e90a(0x1ff)];else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]==_0xa7e90a(0x235))var _0x599eaa=users[_0xa7e90a(0x1ce)];else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]=='Chinese')var _0x599eaa=users[_0xa7e90a(0x1ca)];else{if(_0x2d4683[0x0][_0xa7e90a(0x20e)]==_0xa7e90a(0x1a8))var _0x599eaa=users['Arabic'];}}}}}}}_0x237f6c[_0xa7e90a(0x217)](_0xa7e90a(0x1c5),{'success':_0x473f2e['flash'](_0xa7e90a(0x1cc)),'errors':_0x473f2e['flash']('errors'),'role':_0x164925,'profile':_0x3e912a,'warehouse':_0x222aba,'product':_0x40c38e,'adjustment':_0x19983a,'master_shop':_0x2d4683,'language':_0x599eaa});}catch(_0x41cfe2){console['log'](_0x41cfe2);}}),router['get'](a0_0x1c6f14(0x1ac),auth,async(_0x5ee294,_0x57c835)=>{var _0x4bcf3c=a0_0x1c6f14;try{const {username:_0x48a810,email:_0x3c4c8c,role:_0x3ee5a6}=_0x5ee294[_0x4bcf3c(0x1e3)],_0x4ef866=_0x5ee294[_0x4bcf3c(0x1e3)],_0x2260c9=await profile[_0x4bcf3c(0x232)]({'email':_0x4ef866[_0x4bcf3c(0x1fe)]}),_0x20386e=await master_shop[_0x4bcf3c(0x22c)]();let _0x28b26f;if(_0x4ef866[_0x4bcf3c(0x23b)]==_0x4bcf3c(0x1fb)){const _0x4ef07e=await staff[_0x4bcf3c(0x232)]({'email':_0x4ef866[_0x4bcf3c(0x1fe)]});_0x28b26f=await warehouse[_0x4bcf3c(0x22c)]({'status':'Enabled','name':_0x4ef07e[_0x4bcf3c(0x207)]});}else _0x28b26f=await warehouse[_0x4bcf3c(0x22c)]({'status':_0x4bcf3c(0x21a)});const _0x1bf0f4=await product[_0x4bcf3c(0x22c)]();let _0x26bac8;if(_0x4ef866['role']==_0x4bcf3c(0x1fb)){const _0x477cab=await staff[_0x4bcf3c(0x232)]({'email':_0x4ef866[_0x4bcf3c(0x1fe)]});_0x26bac8=await adjustment_finished[_0x4bcf3c(0x22c)]({'warehouse_name':_0x477cab[_0x4bcf3c(0x207)]});}else _0x26bac8=await adjustment_finished[_0x4bcf3c(0x1d3)]([{'$match':{'type_of_transaction':_0x4bcf3c(0x241)}},{'$unwind':_0x4bcf3c(0x19f)},{'$group':{'_id':_0x4bcf3c(0x1a2),'invoice':{'$first':_0x4bcf3c(0x1cb)},'date':{'$first':_0x4bcf3c(0x20d)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x4bcf3c(0x1b7)},'finalize':{'$first':_0x4bcf3c(0x224)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x20386e[0x0][_0x4bcf3c(0x20e)]==_0x4bcf3c(0x233))var _0x500a7c=users['English'];else{if(_0x20386e[0x0][_0x4bcf3c(0x20e)]==_0x4bcf3c(0x1c6))var _0x500a7c=users[_0x4bcf3c(0x1c6)];else{if(_0x20386e[0x0][_0x4bcf3c(0x20e)]=='German')var _0x500a7c=users['German'];else{if(_0x20386e[0x0][_0x4bcf3c(0x20e)]==_0x4bcf3c(0x19c))var _0x500a7c=users[_0x4bcf3c(0x19c)];else{if(_0x20386e[0x0][_0x4bcf3c(0x20e)]=='French')var _0x500a7c=users[_0x4bcf3c(0x1ff)];else{if(_0x20386e[0x0]['language']=='Portuguese\x20(BR)')var _0x500a7c=users['Portuguese'];else{if(_0x20386e[0x0][_0x4bcf3c(0x20e)]=='Chinese')var _0x500a7c=users['Chinese'];else{if(_0x20386e[0x0][_0x4bcf3c(0x20e)]==_0x4bcf3c(0x1a8))var _0x500a7c=users[_0x4bcf3c(0x21b)];}}}}}}}_0x57c835[_0x4bcf3c(0x217)](_0x4bcf3c(0x1b0),{'success':_0x5ee294[_0x4bcf3c(0x223)]('success'),'errors':_0x5ee294[_0x4bcf3c(0x223)](_0x4bcf3c(0x1a4)),'role':_0x4ef866,'profile':_0x2260c9,'warehouse':_0x28b26f,'product':_0x1bf0f4,'adjustment':_0x26bac8,'master_shop':_0x20386e,'language':_0x500a7c});}catch(_0x3641b4){console[_0x4bcf3c(0x231)](_0x3641b4);}});async function getRandom8DigitNumber(){var _0x13da34=a0_0x1c6f14;const _0x5a4f77=0x989680,_0xeaefce=0x5f5e0ff,_0xfb509a=Math[_0x13da34(0x20a)](Math[_0x13da34(0x1aa)]()*(_0xeaefce-_0x5a4f77+0x1))+_0x5a4f77;var _0x421e87;const _0x4b1452=await adjustment_finished['findOne']({'invoice':_0x13da34(0x1ad)+_0xfb509a});return _0x4b1452&&_0x4b1452['length']>0x0?_0x421e87=_0x13da34(0x1ad)+_0xfb509a:_0x421e87=_0x13da34(0x1ad)+_0xfb509a,_0x421e87;}router[a0_0x1c6f14(0x20c)](a0_0x1c6f14(0x1d2),auth,async(_0x2bba39,_0x5f5683)=>{var _0x35c91c=a0_0x1c6f14;try{const {username:_0x1bc497,email:_0x326dd8,role:_0x36ca9e}=_0x2bba39['user'],_0x53a04a=_0x2bba39[_0x35c91c(0x1e3)],_0x469cb7=await profile[_0x35c91c(0x232)]({'email':_0x53a04a[_0x35c91c(0x1fe)]}),_0x4ba513=await master_shop['find']();let _0x450165;if(_0x53a04a[_0x35c91c(0x23b)]==_0x35c91c(0x1fb)){const _0x3d1a4c=await staff[_0x35c91c(0x232)]({'email':_0x53a04a['email']});_0x450165=await warehouse[_0x35c91c(0x1d3)]([{'$match':{'status':_0x35c91c(0x21a),'name':_0x3d1a4c['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x35c91c(0x21e)}}}]);}else _0x450165=await warehouse[_0x35c91c(0x1d3)]([{'$match':{'status':_0x35c91c(0x21a)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x35c498=await product['find']({}),_0x1e2c89=await adjustment_finished[_0x35c91c(0x22c)](),_0x18fabc=_0x1e2c89[_0x35c91c(0x20f)]+0x1,_0x38dc5b=_0x35c91c(0x1ad)+_0x18fabc[_0x35c91c(0x1b2)]()[_0x35c91c(0x1c4)](0x5,'0');var _0x172bc1=[_0x35c91c(0x19e),_0x35c91c(0x208),_0x35c91c(0x1a9)];if(_0x4ba513[0x0][_0x35c91c(0x20e)]==_0x35c91c(0x233))var _0x41b599=users['English'];else{if(_0x4ba513[0x0]['language']==_0x35c91c(0x1c6))var _0x41b599=users[_0x35c91c(0x1c6)];else{if(_0x4ba513[0x0]['language']==_0x35c91c(0x1b3))var _0x41b599=users[_0x35c91c(0x1b3)];else{if(_0x4ba513[0x0][_0x35c91c(0x20e)]=='Spanish')var _0x41b599=users[_0x35c91c(0x19c)];else{if(_0x4ba513[0x0][_0x35c91c(0x20e)]==_0x35c91c(0x1ff))var _0x41b599=users[_0x35c91c(0x1ff)];else{if(_0x4ba513[0x0][_0x35c91c(0x20e)]=='Portuguese\x20(BR)')var _0x41b599=users[_0x35c91c(0x1ce)];else{if(_0x4ba513[0x0][_0x35c91c(0x20e)]==_0x35c91c(0x1ca))var _0x41b599=users[_0x35c91c(0x1ca)];else{if(_0x4ba513[0x0]['language']==_0x35c91c(0x1a8))var _0x41b599=users['Arabic'];}}}}}}}const _0x5901fc=getRandom8DigitNumber();_0x5901fc[_0x35c91c(0x1f7)](_0x3b6f57=>{var _0x5f2c1d=_0x35c91c;_0x5f5683[_0x5f2c1d(0x217)]('add_adjustment_finished',{'success':_0x2bba39['flash']('success'),'errors':_0x2bba39[_0x5f2c1d(0x223)](_0x5f2c1d(0x1a4)),'role':_0x53a04a,'profile':_0x469cb7,'warehouse':_0x450165,'product':_0x35c498,'master_shop':_0x4ba513,'language':_0x41b599,'rooms_data':_0x172bc1,'invoice_no':_0x3b6f57});})['catch'](_0x2c35eb=>{var _0x26c8f5=_0x35c91c;_0x2bba39[_0x26c8f5(0x223)](_0x26c8f5(0x1a4),_0x26c8f5(0x1e7)),_0x5f5683[_0x26c8f5(0x234)](_0x26c8f5(0x221));});}catch(_0x420570){console[_0x35c91c(0x231)](_0x420570);}}),router[a0_0x1c6f14(0x197)](a0_0x1c6f14(0x1d2),auth,async(_0x30b672,_0x14575b)=>{var _0x4db899=a0_0x1c6f14;try{const {warehouse_name:_0x2d0d2c,date:_0x9a5b30,prod_name:_0xfe80e2,level:_0x45863e,isle:_0x588dee,pallet:_0x4b7ef0,stock:_0x4d4b59,types:_0x3da8eb,adjust_qty:_0x1f2f0d,new_adjust_qty:_0x575331,note:_0x1db65b,Room_name:_0x4eb594,JO_number:_0x192a36,expiry_date:_0x43f0aa,PO_number:_0x25f2c8,ReqBy:_0x4a2455,dateofreq:_0x4e67e0,typeservicesData:_0x1aee5e,destination:_0x16522d,deliverydate:_0x2cbc6f,driver:_0x13872b,plate:_0x2712f5,van:_0x3ca4b6,DRSI:_0x25ec7f,typevehicle:_0x36b082,TSU:_0x4584b8,TFU:_0x850889}=_0x30b672[_0x4db899(0x1d4)];if(typeof _0xfe80e2==_0x4db899(0x220))var _0x483a28=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x225)]],_0x11c309=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1ea)]],_0x3c6ba2=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1d8)]],_0x2cda4b=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x21f)]],_0x4b2f54=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1f1)]],_0x38e22e=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1e8)]],_0x410289=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1d0)]],_0x2fe45f=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1bb)]],_0x254ee2=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x22d)]],_0x4c5102=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1d7)]],_0x1d3da8=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x227)]],_0xd90d59=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x199)]],_0x15797d=[_0x30b672['body']['prod_cat']],_0x2d6b05=[_0x30b672['body'][_0x4db899(0x21c)]],_0x4a0504=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1e5)]],_0xd6eef8=[_0x30b672['body'][_0x4db899(0x22a)]],_0x3eeb10=[_0x30b672[_0x4db899(0x1d4)][_0x4db899(0x204)]];else var _0x483a28=[..._0x30b672[_0x4db899(0x1d4)][_0x4db899(0x225)]],_0x11c309=[..._0x30b672['body'][_0x4db899(0x1ea)]],_0x3c6ba2=[..._0x30b672[_0x4db899(0x1d4)]['stock']],_0x2cda4b=[..._0x30b672[_0x4db899(0x1d4)]['types']],_0x4b2f54=[..._0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1f1)]],_0x38e22e=[..._0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1e8)]],_0x410289=[..._0x30b672[_0x4db899(0x1d4)]['Primary_Units']],_0x2fe45f=[..._0x30b672[_0x4db899(0x1d4)][_0x4db899(0x1bb)]],_0x254ee2=[..._0x30b672[_0x4db899(0x1d4)][_0x4db899(0x22d)]],_0x4c5102=[..._0x30b672['body']['batch_code']],_0x1d3da8=[..._0x30b672[_0x4db899(0x1d4)]['expiry_date']],_0xd90d59=[..._0x30b672[_0x4db899(0x1d4)]['product_date']],_0x15797d=[..._0x30b672[_0x4db899(0x1d4)][_0x4db899(0x193)]],_0x2d6b05=[..._0x30b672['body'][_0x4db899(0x21c)]],_0x4a0504=[..._0x30b672[_0x4db899(0x1d4)]['maxPerUnit']],_0xd6eef8=[..._0x30b672['body'][_0x4db899(0x22a)]],_0x3eeb10=[..._0x30b672['body']['id_transaction_from']];const _0xe59a95=_0x483a28[_0x4db899(0x19d)](_0x4c4697=>{return _0x4c4697={'product_name':_0x4c4697};});_0x11c309[_0x4db899(0x1dd)]((_0x229871,_0x581030)=>{var _0x58ec03=_0x4db899,_0x5b0739=_0x229871['match'](/[A-Za-z]+/)[0x0],_0x9be77f=parseInt(_0x229871['match'](/\d+/)[0x0]);_0xe59a95[_0x581030]['level']=_0x5b0739,_0xe59a95[_0x581030][_0x58ec03(0x1d6)]=_0x9be77f;}),_0x3eeb10['forEach']((_0x57e29a,_0xd3cd9b)=>{var _0x29ae5e=_0x4db899;_0xe59a95[_0xd3cd9b][_0x29ae5e(0x198)]=_0x57e29a;}),_0x3c6ba2[_0x4db899(0x1dd)]((_0xb3b10d,_0x5e9dea)=>{_0xe59a95[_0x5e9dea]['stockBefore']=_0xb3b10d;}),_0x2cda4b['forEach']((_0x239c01,_0x59371)=>{var _0x3337c9=_0x4db899;_0xe59a95[_0x59371][_0x3337c9(0x21f)]=_0x239c01;}),_0x4b2f54[_0x4db899(0x1dd)]((_0x598a4c,_0x528eb3)=>{var _0x444fbc=_0x4db899;_0xe59a95[_0x528eb3][_0x444fbc(0x242)]=_0x598a4c;}),_0x38e22e[_0x4db899(0x1dd)]((_0xb22c4b,_0x252330)=>{_0xe59a95[_0x252330]['new_adjust_qty']=_0xb22c4b;}),_0x410289['forEach']((_0x5c25e0,_0x217469)=>{var _0x3a7790=_0x4db899;_0xe59a95[_0x217469][_0x3a7790(0x194)]=_0x5c25e0;}),_0x2fe45f[_0x4db899(0x1dd)]((_0x267f5b,_0x1086de)=>{var _0x28e33f=_0x4db899;_0xe59a95[_0x1086de][_0x28e33f(0x23a)]=_0x267f5b;}),_0x254ee2[_0x4db899(0x1dd)]((_0x259310,_0x319860)=>{var _0x93c62f=_0x4db899;_0xe59a95[_0x319860][_0x93c62f(0x245)]=_0x259310;}),_0x4c5102['forEach']((_0x1f7beb,_0x1b84a8)=>{_0xe59a95[_0x1b84a8]['batch_code']=_0x1f7beb;}),_0x1d3da8[_0x4db899(0x1dd)]((_0x130a6f,_0x1416df)=>{var _0x5f46ae=_0x4db899;_0xe59a95[_0x1416df][_0x5f46ae(0x227)]=_0x130a6f;}),_0xd90d59[_0x4db899(0x1dd)]((_0x54e863,_0x53cd7)=>{var _0xf86276=_0x4db899;_0xe59a95[_0x53cd7][_0xf86276(0x21d)]=_0x54e863;}),_0x15797d[_0x4db899(0x1dd)]((_0x1ff368,_0x28bddd)=>{var _0x122d95=_0x4db899;_0xe59a95[_0x28bddd][_0x122d95(0x193)]=_0x1ff368;}),_0x2d6b05[_0x4db899(0x1dd)]((_0x47e446,_0x5ae17d)=>{var _0x306f10=_0x4db899;_0xe59a95[_0x5ae17d][_0x306f10(0x1c7)]=_0x47e446;}),_0x4a0504[_0x4db899(0x1dd)]((_0x38bf93,_0x194179)=>{var _0x13f66f=_0x4db899;_0xe59a95[_0x194179][_0x13f66f(0x1e5)]=_0x38bf93;}),_0xd6eef8['forEach']((_0xc795df,_0x372b10)=>{var _0x4b472b=_0x4db899;_0xe59a95[_0x372b10][_0x4b472b(0x1a5)]=_0xc795df;});const _0x26dc2f=_0xe59a95[_0x4db899(0x1c2)](_0x3db5a5=>_0x3db5a5[_0x4db899(0x242)]!=='0'&&_0x3db5a5[_0x4db899(0x242)]!=='');var _0x5d754b=0x0;_0x26dc2f['forEach'](_0x4749f=>{var _0x58a077=_0x4db899;console[_0x58a077(0x231)](_0x58a077(0x1df),_0x4749f),parseInt(_0x4749f[_0x58a077(0x242)])<=0x0&&_0x5d754b++;});if(_0x5d754b!=0x0)return _0x30b672[_0x4db899(0x223)](_0x4db899(0x1a4),_0x4db899(0x1c9)),_0x14575b['redirect'](_0x4db899(0x215));const _0x5b4144=new invoice_for_adjustment();await _0x5b4144['save']();const _0x2a5880=new adjustment_finished({'warehouse_name':_0x2d0d2c,'date':_0x9a5b30,'product':_0x26dc2f,'note':_0x1db65b,'room':_0x4eb594,'invoice':_0x4db899(0x214)+_0x5b4144[_0x4db899(0x202)]['toString']()['padStart'](0x8,'0'),'JO_number':_0x192a36,'expiry_date':_0x43f0aa,'PO_number':_0x25f2c8,'RequestedBy':_0x4a2455,'DateofRequest':_0x4e67e0,'typeservices':_0x1aee5e,'destination':_0x16522d,'deliverydate':_0x2cbc6f,'driver':_0x13872b,'plate':_0x2712f5,'van':_0x3ca4b6,'DRSI':_0x25ec7f,'typevehicle':_0x36b082,'TSU':_0x4584b8,'TFU':_0x850889}),_0x5d4f72=await _0x2a5880[_0x4db899(0x1ae)]();_0x30b672[_0x4db899(0x223)](_0x4db899(0x1cc),_0x4db899(0x1e4)),_0x14575b['redirect'](_0x4db899(0x1ed)+_0x5d4f72[_0x4db899(0x1e1)]);}catch(_0x1945ea){console[_0x4db899(0x231)](_0x1945ea),_0x14575b[_0x4db899(0x1b4)](0xc8)[_0x4db899(0x212)]({'message':_0x1945ea[_0x4db899(0x1ab)]});}}),router['get']('/view/add_adjustment_logs',auth,async(_0x41d00c,_0x474819)=>{var _0x34cb26=a0_0x1c6f14;try{const {username:_0x1ee23c,email:_0x3718ba,role:_0xe85ec2}=_0x41d00c[_0x34cb26(0x1e3)],_0x132252=_0x41d00c['user'],_0x59b9b5=await profile[_0x34cb26(0x232)]({'email':_0x132252['email']}),_0x4f8861=await master_shop[_0x34cb26(0x22c)]();let _0x21e9d8;if(_0x132252[_0x34cb26(0x23b)]==_0x34cb26(0x1fb)){const _0x3b7a2c=await staff['findOne']({'email':_0x132252[_0x34cb26(0x1fe)]});_0x21e9d8=await warehouse[_0x34cb26(0x1d3)]([{'$match':{'status':_0x34cb26(0x21a),'name':_0x3b7a2c[_0x34cb26(0x207)]}},{'$group':{'_id':_0x34cb26(0x21e),'name':{'$first':_0x34cb26(0x21e)}}}]);}else _0x21e9d8=await warehouse[_0x34cb26(0x1d3)]([{'$match':{'status':_0x34cb26(0x21a)}},{'$group':{'_id':_0x34cb26(0x21e),'name':{'$first':'$name'}}}]);const _0xacdfa2=await product[_0x34cb26(0x22c)](),_0x16fff5=await adjustment_finished[_0x34cb26(0x22c)](),_0x8954c9=_0x16fff5[_0x34cb26(0x20f)]+0x1,_0x147e1c=_0x34cb26(0x1ad)+_0x8954c9[_0x34cb26(0x1b2)]()['padStart'](0x5,'0');var _0x9d1323=[_0x34cb26(0x19e),_0x34cb26(0x208),_0x34cb26(0x1a9)];if(_0x4f8861[0x0][_0x34cb26(0x20e)]=='English\x20(US)')var _0x1c9029=users[_0x34cb26(0x218)];else{if(_0x4f8861[0x0]['language']==_0x34cb26(0x1c6))var _0x1c9029=users[_0x34cb26(0x1c6)];else{if(_0x4f8861[0x0][_0x34cb26(0x20e)]=='German')var _0x1c9029=users[_0x34cb26(0x1b3)];else{if(_0x4f8861[0x0][_0x34cb26(0x20e)]==_0x34cb26(0x19c))var _0x1c9029=users['Spanish'];else{if(_0x4f8861[0x0]['language']==_0x34cb26(0x1ff))var _0x1c9029=users['French'];else{if(_0x4f8861[0x0][_0x34cb26(0x20e)]=='Portuguese\x20(BR)')var _0x1c9029=users[_0x34cb26(0x1ce)];else{if(_0x4f8861[0x0][_0x34cb26(0x20e)]=='Chinese')var _0x1c9029=users[_0x34cb26(0x1ca)];else{if(_0x4f8861[0x0]['language']==_0x34cb26(0x1a8))var _0x1c9029=users[_0x34cb26(0x21b)];}}}}}}}const _0x205b0f=getRandom8DigitNumber();_0x205b0f['then'](_0x59c575=>{var _0x48eb40=_0x34cb26;_0x474819['render']('add_adjustment_finished_logs',{'success':_0x41d00c[_0x48eb40(0x223)](_0x48eb40(0x1cc)),'errors':_0x41d00c[_0x48eb40(0x223)](_0x48eb40(0x1a4)),'role':_0x132252,'profile':_0x59b9b5,'warehouse':_0x21e9d8,'product':_0xacdfa2,'master_shop':_0x4f8861,'language':_0x1c9029,'rooms_data':_0x9d1323,'invoice_no':_0x59c575});})[_0x34cb26(0x1f9)](_0x30f252=>{var _0x354f25=_0x34cb26;_0x41d00c['flash'](_0x354f25(0x1a4),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x474819[_0x354f25(0x234)](_0x354f25(0x221));});}catch(_0xc24125){console['log'](_0xc24125);}}),router[a0_0x1c6f14(0x197)](a0_0x1c6f14(0x1a7),auth,async(_0x3ae7a5,_0x5e7183)=>{var _0x26eddb=a0_0x1c6f14;try{const {warehouse_name:_0x2836d1,date:_0x581d0f,prod_name:_0x1bc614,level:_0x40ca6d,isle:_0x310766,pallet:_0x3ba7e3,stock:_0x53ecfe,types:_0x117d11,adjust_qty:_0x55a4ea,new_adjust_qty:_0x2ccd8d,note:_0x71c68f,Room_name:_0x47a5a8,JO_number:_0x2050fd,expiry_date:_0x2b8a96,type_of_transaction:_0x5ab8c3,PO_number:_0x3a066e,ReqBy:_0x54d9ee,dateofreq:_0x5ca180,typeservicesData:_0x17b901,destination:_0xe976c2,deliverydate:_0x3326cf,driver:_0x2d0272,plate:_0x31f03b,van:_0x5e7384,DRSI:_0x4d09d3,typevehicle:_0x45f035,TSU:_0xfba9a,TFU:_0x1853a0}=_0x3ae7a5[_0x26eddb(0x1d4)];if(typeof _0x1bc614=='string')var _0x538ba7=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x225)]],_0x476785=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1ea)]],_0x2858a8=[_0x3ae7a5['body'][_0x26eddb(0x1d8)]],_0x195f7e=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x21f)]],_0x1e815a=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1f1)]],_0x39c357=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1e8)]],_0x56cffe=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1d0)]],_0x2c8b41=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1bb)]],_0x5ac63c=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x22d)]],_0x420425=[_0x3ae7a5[_0x26eddb(0x1d4)]['batch_code']],_0x1ef2ce=[_0x3ae7a5[_0x26eddb(0x1d4)]['expiry_date']],_0x5ee286=[_0x3ae7a5[_0x26eddb(0x1d4)]['product_date']],_0x23cc19=[_0x3ae7a5['body'][_0x26eddb(0x193)]],_0x530fe7=[_0x3ae7a5['body'][_0x26eddb(0x21c)]],_0x3ffd4b=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1e5)]],_0x498474=[_0x3ae7a5['body'][_0x26eddb(0x22a)]],_0x217181=[_0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x204)]];else var _0x538ba7=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x225)]],_0x476785=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1ea)]],_0x2858a8=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1d8)]],_0x195f7e=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x21f)]],_0x1e815a=[..._0x3ae7a5['body'][_0x26eddb(0x1f1)]],_0x39c357=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1e8)]],_0x56cffe=[..._0x3ae7a5['body'][_0x26eddb(0x1d0)]],_0x2c8b41=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1bb)]],_0x5ac63c=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x22d)]],_0x420425=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1d7)]],_0x1ef2ce=[..._0x3ae7a5['body']['expiry_date']],_0x5ee286=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x199)]],_0x23cc19=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x193)]],_0x530fe7=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x21c)]],_0x3ffd4b=[..._0x3ae7a5[_0x26eddb(0x1d4)][_0x26eddb(0x1e5)]],_0x498474=[..._0x3ae7a5['body'][_0x26eddb(0x22a)]],_0x217181=[..._0x3ae7a5['body'][_0x26eddb(0x204)]];const _0x549876=_0x538ba7[_0x26eddb(0x19d)](_0x20328c=>{return _0x20328c={'product_name':_0x20328c};});_0x476785[_0x26eddb(0x1dd)]((_0x214de5,_0x4a730a)=>{var _0x110bae=_0x26eddb,_0x198c3b=_0x214de5['match'](/[A-Za-z]+/)[0x0],_0xf3cc30=parseInt(_0x214de5[_0x110bae(0x1fc)](/\d+/)[0x0]);_0x549876[_0x4a730a][_0x110bae(0x1ea)]=_0x198c3b,_0x549876[_0x4a730a][_0x110bae(0x1d6)]=_0xf3cc30;}),_0x217181[_0x26eddb(0x1dd)]((_0x19e210,_0x5dc7f5)=>{var _0x1c669e=_0x26eddb;_0x549876[_0x5dc7f5][_0x1c669e(0x198)]=_0x19e210;}),_0x2858a8['forEach']((_0x1f50a8,_0x502639)=>{var _0x52799e=_0x26eddb;_0x549876[_0x502639][_0x52799e(0x1a1)]=_0x1f50a8;}),_0x195f7e[_0x26eddb(0x1dd)]((_0x36fcf0,_0x4e70b9)=>{var _0x494e4e=_0x26eddb;_0x549876[_0x4e70b9][_0x494e4e(0x21f)]=_0x36fcf0;}),_0x1e815a[_0x26eddb(0x1dd)]((_0x28b016,_0xbfce68)=>{var _0x224f5e=_0x26eddb;_0x549876[_0xbfce68][_0x224f5e(0x242)]=_0x28b016;}),_0x39c357['forEach']((_0x39934c,_0x3b1e36)=>{var _0x24b3db=_0x26eddb;_0x549876[_0x3b1e36][_0x24b3db(0x1e0)]=_0x39934c;}),_0x56cffe[_0x26eddb(0x1dd)]((_0xa2c18,_0x4b98c2)=>{var _0x362c7b=_0x26eddb;_0x549876[_0x4b98c2][_0x362c7b(0x194)]=_0xa2c18;}),_0x2c8b41[_0x26eddb(0x1dd)]((_0x21aa4a,_0x55e8ee)=>{var _0x572b94=_0x26eddb;_0x549876[_0x55e8ee][_0x572b94(0x23a)]=_0x21aa4a;}),_0x5ac63c[_0x26eddb(0x1dd)]((_0x166c8c,_0x3895d9)=>{var _0x4336c4=_0x26eddb;_0x549876[_0x3895d9][_0x4336c4(0x245)]=_0x166c8c;}),_0x420425[_0x26eddb(0x1dd)]((_0x3e209a,_0x3118a5)=>{var _0x2fdb2b=_0x26eddb;_0x549876[_0x3118a5][_0x2fdb2b(0x1d7)]=_0x3e209a;}),_0x1ef2ce['forEach']((_0x44c1ef,_0x20b18b)=>{var _0x59ee39=_0x26eddb;_0x549876[_0x20b18b][_0x59ee39(0x227)]=_0x44c1ef;}),_0x5ee286[_0x26eddb(0x1dd)]((_0x538289,_0x29d699)=>{_0x549876[_0x29d699]['production_date']=_0x538289;}),_0x23cc19[_0x26eddb(0x1dd)]((_0x152a20,_0x2f3845)=>{var _0x60e645=_0x26eddb;_0x549876[_0x2f3845][_0x60e645(0x193)]=_0x152a20;}),_0x530fe7[_0x26eddb(0x1dd)]((_0x1372c6,_0x606277)=>{var _0xb87873=_0x26eddb;_0x549876[_0x606277][_0xb87873(0x1c7)]=_0x1372c6;}),_0x3ffd4b[_0x26eddb(0x1dd)]((_0x5d8d62,_0x4d9283)=>{var _0x5a5567=_0x26eddb;_0x549876[_0x4d9283][_0x5a5567(0x1e5)]=_0x5d8d62;}),_0x498474[_0x26eddb(0x1dd)]((_0x29d40d,_0x1c076b)=>{var _0x34c8a1=_0x26eddb;_0x549876[_0x1c076b][_0x34c8a1(0x1a5)]=_0x29d40d;});const _0x547f6f=_0x549876[_0x26eddb(0x1c2)](_0x54d677=>_0x54d677['adjust_qty']!=='0'&&_0x54d677['adjust_qty']!=='');var _0x2f7911=0x0;_0x547f6f[_0x26eddb(0x1dd)](_0x222228=>{var _0xf9efc7=_0x26eddb;console['log'](_0xf9efc7(0x1df),_0x222228),parseInt(_0x222228[_0xf9efc7(0x242)])<=0x0&&_0x2f7911++;});if(_0x2f7911!=0x0)return _0x3ae7a5['flash'](_0x26eddb(0x1a4),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x5e7183['redirect'](_0x26eddb(0x215));const _0x421b5d=new adjustment_logs();await _0x421b5d['save']();const _0x2fc93a=new adjustment_finished({'warehouse_name':_0x2836d1,'date':_0x581d0f,'product':_0x547f6f,'note':_0x71c68f,'room':_0x47a5a8,'invoice':_0x26eddb(0x201)+_0x421b5d[_0x26eddb(0x202)]['toString']()['padStart'](0x8,'0'),'JO_number':_0x2050fd,'expiry_date':_0x2b8a96,'type_of_transaction':_0x5ab8c3,'PO_number':_0x3a066e,'RequestedBy':_0x54d9ee,'DateofRequest':_0x5ca180,'typeservices':_0x17b901,'destination':_0xe976c2,'deliverydate':_0x3326cf,'driver':_0x2d0272,'plate':_0x31f03b,'van':_0x5e7384,'DRSI':_0x4d09d3,'typevehicle':_0x45f035,'TSU':_0xfba9a,'TFU':_0x1853a0}),_0x420299=await _0x2fc93a[_0x26eddb(0x1ae)]();_0x3ae7a5['flash']('success',_0x26eddb(0x1e4)),_0x5e7183[_0x26eddb(0x234)](_0x26eddb(0x1ed)+_0x420299['_id']);}catch(_0x12494c){console[_0x26eddb(0x231)](_0x12494c),_0x5e7183[_0x26eddb(0x1b4)](0xc8)[_0x26eddb(0x212)]({'message':_0x12494c[_0x26eddb(0x1ab)]});}}),router[a0_0x1c6f14(0x20c)](a0_0x1c6f14(0x219),auth,async(_0x406bdb,_0x407693)=>{var _0x516d9b=a0_0x1c6f14;try{const {username:_0x39145f,email:_0x5488f3,role:_0xf3229a}=_0x406bdb['user'],_0xc3580e=_0x406bdb[_0x516d9b(0x1e3)],_0x42dd8d=await profile['findOne']({'email':_0xc3580e[_0x516d9b(0x1fe)]}),_0x277b3b=await master_shop['find'](),_0xccf76e=_0x406bdb[_0x516d9b(0x213)]['id'],_0x140272=await adjustment_finished[_0x516d9b(0x1b1)]({'_id':_0xccf76e}),_0x392c69=await purchases['aggregate']([{'$match':{'warehouse_name':_0x140272[_0x516d9b(0x209)]}},{'$unwind':_0x516d9b(0x19f)},{'$group':{'_id':_0x516d9b(0x205)}}]);console[_0x516d9b(0x231)](_0x516d9b(0x1e2),_0x392c69);const _0x585feb=await product[_0x516d9b(0x22c)]({}),_0x5836e5=await warehouse['aggregate']([{'$match':{'name':_0x140272['warehouse_name']}},{'$unwind':_0x516d9b(0x1a3)},{'$group':{'_id':_0x516d9b(0x1bf),'name':{'$first':_0x516d9b(0x23e)},'product_stock':{'$first':_0x516d9b(0x1c3)},'bay':{'$first':_0x516d9b(0x1b8)},'bin':{'$first':_0x516d9b(0x1f8)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x516d9b(0x1da)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x516d9b(0x211)},'product_code':{'$first':_0x516d9b(0x243)},'storage':{'$first':_0x516d9b(0x230)},'rack':{'$first':_0x516d9b(0x22f)},'expiry_date':{'$first':_0x516d9b(0x1db)},'production_date':{'$first':_0x516d9b(0x1f0)},'batch_code':{'$first':_0x516d9b(0x1fa)},'maxPerUnit':{'$first':_0x516d9b(0x1e9)},'room':{'$first':_0x516d9b(0x1b9)}}}]);if(_0x277b3b[0x0][_0x516d9b(0x20e)]==_0x516d9b(0x233)){var _0x65e370=users[_0x516d9b(0x218)];console[_0x516d9b(0x231)](_0x65e370);}else{if(_0x277b3b[0x0]['language']==_0x516d9b(0x1c6))var _0x65e370=users[_0x516d9b(0x1c6)];else{if(_0x277b3b[0x0][_0x516d9b(0x20e)]=='German')var _0x65e370=users[_0x516d9b(0x1b3)];else{if(_0x277b3b[0x0][_0x516d9b(0x20e)]==_0x516d9b(0x19c))var _0x65e370=users[_0x516d9b(0x19c)];else{if(_0x277b3b[0x0][_0x516d9b(0x20e)]==_0x516d9b(0x1ff))var _0x65e370=users[_0x516d9b(0x1ff)];else{if(_0x277b3b[0x0][_0x516d9b(0x20e)]==_0x516d9b(0x235))var _0x65e370=users[_0x516d9b(0x1ce)];else{if(_0x277b3b[0x0][_0x516d9b(0x20e)]==_0x516d9b(0x1ca))var _0x65e370=users[_0x516d9b(0x1ca)];else{if(_0x277b3b[0x0][_0x516d9b(0x20e)]==_0x516d9b(0x1a8))var _0x65e370=users[_0x516d9b(0x21b)];}}}}}}}_0x407693['render'](_0x516d9b(0x19b),{'success':_0x406bdb['flash']('success'),'errors':_0x406bdb[_0x516d9b(0x223)](_0x516d9b(0x1a4)),'role':_0xc3580e,'profile':_0x42dd8d,'adjustment':_0x140272,'stock':_0x5836e5,'master_shop':_0x277b3b,'warehouse_name':_0x392c69,'unit':_0x585feb,'language':_0x65e370});}catch(_0x7f54a){console[_0x516d9b(0x231)](_0x7f54a),_0x407693['status'](0xc8)[_0x516d9b(0x212)]({'message':_0x7f54a['message']});}}),router[a0_0x1c6f14(0x197)]('/preview/:id',auth,async(_0x2cfe01,_0x270dd5)=>{var _0x2f0629=a0_0x1c6f14;try{const {invoice:_0x178365,warehouse_name:_0x3f6bc6,Room_name:_0x417e03}=_0x2cfe01[_0x2f0629(0x1d4)],_0x2943ce=_0x2cfe01['params']['id'],_0x29e060=await adjustment_finished[_0x2f0629(0x1b1)]({'_id':_0x2943ce});var _0x12971e;const _0x27b768=_0x29e060[_0x2f0629(0x1f4)][_0x2f0629(0x19d)](async _0x55ade0=>{var _0x56f19a=_0x2f0629;if(_0x55ade0['adjust_qty']>0x0){_0x12971e=await warehouse['findOne']({'name':_0x3f6bc6,'room':_0x55ade0[_0x56f19a(0x1c7)]});const _0x5ab00a=_0x12971e[_0x56f19a(0x195)][_0x56f19a(0x19d)](_0x1945c2=>{var _0x27e8ce=_0x56f19a;console[_0x27e8ce(0x231)](_0x55ade0[_0x27e8ce(0x21f)]);if(_0x55ade0[_0x27e8ce(0x21f)]==_0x27e8ce(0x1f3))_0x1945c2[_0x27e8ce(0x1e1)]==_0x55ade0['id_transaction']&&(_0x1945c2[_0x27e8ce(0x1ec)]=_0x1945c2['product_stock']-_0x55ade0[_0x27e8ce(0x242)]);else _0x55ade0[_0x27e8ce(0x21f)]==_0x27e8ce(0x23d)&&(_0x1945c2['_id']==_0x55ade0[_0x27e8ce(0x198)]&&(_0x1945c2[_0x27e8ce(0x1ec)]=_0x1945c2[_0x27e8ce(0x1ec)]+_0x55ade0[_0x27e8ce(0x242)]));});}return _0x12971e;});Promise[_0x2f0629(0x1bc)](_0x27b768)[_0x2f0629(0x1f7)](async _0x12e5af=>{var _0xd2de76=_0x2f0629;try{for(const _0x2e1253 of _0x12e5af){await _0x2e1253[_0xd2de76(0x1ae)]();}_0x29e060['finalize']=_0xd2de76(0x1c0);const _0x41e10d=await _0x29e060[_0xd2de76(0x1ae)](),_0x3a295a=await master_shop['find'](),_0x30d0b0=await email_settings[_0xd2de76(0x232)](),_0x3bdc1d=await supervisor_settings['find']();var _0x1549b0=_0x29e060[_0xd2de76(0x1f4)],_0x55690e='',_0x4f7a4a;for(_0x4f7a4a in _0x1549b0){var _0x38a877='FG';_0x29e060[_0xd2de76(0x209)]==_0xd2de76(0x200)&&(_0x38a877='DG'),_0x55690e+=_0xd2de76(0x1d9)+_0xd2de76(0x19a)+_0x1549b0[_0x4f7a4a][_0xd2de76(0x1ee)]+_0xd2de76(0x237)+_0xd2de76(0x19a)+_0x1549b0[_0x4f7a4a]['product_code']+_0xd2de76(0x237)+_0xd2de76(0x19a)+_0x1549b0[_0x4f7a4a][_0xd2de76(0x242)]+_0xd2de76(0x237)+_0xd2de76(0x19a)+_0x1549b0[_0x4f7a4a][_0xd2de76(0x194)]+'</td>'+_0xd2de76(0x19a)+_0x1549b0[_0x4f7a4a]['secondary_unit']+_0xd2de76(0x237)+_0xd2de76(0x19a)+_0x29e060[_0xd2de76(0x209)]+_0xd2de76(0x237)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1549b0[_0x4f7a4a]['room_names']+'</td>'+_0xd2de76(0x19a)+_0x38a877+_0x1549b0[_0x4f7a4a]['bay']+_0xd2de76(0x237)+_0xd2de76(0x236);}_0x2cfe01[_0xd2de76(0x223)](_0xd2de76(0x1cc),_0xd2de76(0x1f6)),_0x270dd5[_0xd2de76(0x234)](_0xd2de76(0x1fd)+_0x41e10d[_0xd2de76(0x1e1)]);}catch(_0x1d1392){console[_0xd2de76(0x1d5)](_0x1d1392),_0x270dd5[_0xd2de76(0x1b4)](0x1f4)[_0xd2de76(0x212)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x2f0629(0x1f9)](_0xfe3b28=>{var _0x491cbd=_0x2f0629;console[_0x491cbd(0x1d5)](_0xfe3b28),_0x270dd5[_0x491cbd(0x1b4)](0x1f4)[_0x491cbd(0x212)]({'error':_0x491cbd(0x1ba)});});}catch(_0x133f96){_0x270dd5['json']({'message':_0x133f96[_0x2f0629(0x1ab)]});}}),router[a0_0x1c6f14(0x20c)]('/view/:id',auth,async(_0x1390f8,_0x2ad488)=>{var _0x93b937=a0_0x1c6f14;try{const {username:_0x106db0,email:_0x1b240c,role:_0x26d415}=_0x1390f8[_0x93b937(0x1e3)],_0x265f4e=_0x1390f8[_0x93b937(0x1e3)],_0x184fe2=await profile[_0x93b937(0x232)]({'email':_0x265f4e[_0x93b937(0x1fe)]}),_0x3c6b74=await master_shop[_0x93b937(0x22c)]();console[_0x93b937(0x231)](_0x93b937(0x1ef),_0x3c6b74);const _0x4346f3=_0x1390f8['params']['id'],_0x473594=await adjustment_finished[_0x93b937(0x1b1)]({'_id':_0x4346f3});let _0x3cb4a0=new Date(_0x473594[_0x93b937(0x227)]),_0x3db89a=('0'+_0x3cb4a0[_0x93b937(0x23f)]())[_0x93b937(0x1dc)](-0x2),_0x3a0aa6=('0'+(_0x3cb4a0[_0x93b937(0x210)]()+0x1))[_0x93b937(0x1dc)](-0x2),_0x1f9ce3=_0x3cb4a0[_0x93b937(0x203)](),_0x33c884=_0x1f9ce3+'-'+_0x3a0aa6+'-'+_0x3db89a;var _0x1ad374=[_0x93b937(0x19e),_0x93b937(0x208),_0x93b937(0x1a9)];const _0x28523a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x473594['warehouse_name']}},{'$unwind':_0x93b937(0x19f)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x93b937(0x1e2),_0x28523a);const _0x5ebd84=await product[_0x93b937(0x22c)]({}),_0x4b6cf7=await warehouse[_0x93b937(0x1d3)]([{'$match':{'name':_0x473594[_0x93b937(0x209)],'room':_0x473594[_0x93b937(0x20b)]}},{'$unwind':_0x93b937(0x1a3)},{'$group':{'_id':_0x93b937(0x1bf),'name':{'$first':_0x93b937(0x23e)},'product_stock':{'$first':_0x93b937(0x1c3)},'bay':{'$first':_0x93b937(0x1b8)},'bin':{'$first':_0x93b937(0x1f8)},'type':{'$first':_0x93b937(0x1a6)},'floorlevel':{'$first':_0x93b937(0x1da)},'primary_code':{'$first':_0x93b937(0x228)},'secondary_code':{'$first':_0x93b937(0x211)},'product_code':{'$first':_0x93b937(0x243)},'storage':{'$first':_0x93b937(0x230)},'rack':{'$first':_0x93b937(0x22f)}}}]);if(_0x3c6b74[0x0][_0x93b937(0x20e)]==_0x93b937(0x233)){var _0x27fe83=users['English'];console[_0x93b937(0x231)](_0x27fe83);}else{if(_0x3c6b74[0x0]['language']==_0x93b937(0x1c6))var _0x27fe83=users[_0x93b937(0x1c6)];else{if(_0x3c6b74[0x0][_0x93b937(0x20e)]==_0x93b937(0x1b3))var _0x27fe83=users[_0x93b937(0x1b3)];else{if(_0x3c6b74[0x0][_0x93b937(0x20e)]==_0x93b937(0x19c))var _0x27fe83=users[_0x93b937(0x19c)];else{if(_0x3c6b74[0x0][_0x93b937(0x20e)]=='French')var _0x27fe83=users[_0x93b937(0x1ff)];else{if(_0x3c6b74[0x0][_0x93b937(0x20e)]==_0x93b937(0x235))var _0x27fe83=users['Portuguese'];else{if(_0x3c6b74[0x0]['language']==_0x93b937(0x1ca))var _0x27fe83=users[_0x93b937(0x1ca)];else{if(_0x3c6b74[0x0][_0x93b937(0x20e)]==_0x93b937(0x1a8))var _0x27fe83=users[_0x93b937(0x21b)];}}}}}}}_0x2ad488[_0x93b937(0x217)](_0x93b937(0x1af),{'success':_0x1390f8['flash'](_0x93b937(0x1cc)),'errors':_0x1390f8[_0x93b937(0x223)](_0x93b937(0x1a4)),'role':_0x265f4e,'profile':_0x184fe2,'adjustment':_0x473594,'stock':_0x4b6cf7,'master_shop':_0x3c6b74,'warehouse_name':_0x28523a,'unit':_0x5ebd84,'language':_0x27fe83,'rooms_data':_0x1ad374,'ed_fullDate':_0x33c884});}catch(_0x1a679f){console[_0x93b937(0x231)](_0x1a679f),_0x2ad488['status'](0xc8)[_0x93b937(0x212)]({'message':_0x1a679f[_0x93b937(0x1ab)]});}}),router[a0_0x1c6f14(0x197)]('/view/:id',auth,async(_0x6f4821,_0x378a2c)=>{var _0x37dab2=a0_0x1c6f14;try{const _0x1fce55=_0x6f4821[_0x37dab2(0x213)]['id'],_0x12f41f=await adjustment_finished[_0x37dab2(0x1b1)]({'_id':_0x1fce55}),_0x433801=await warehouse[_0x37dab2(0x232)]({'name':_0x12f41f['warehouse_name'],'room':_0x12f41f[_0x37dab2(0x20b)]}),{warehouse_name:_0x1673d4,date:_0x4dca57,prod_name:_0x3ee541,level:_0x50cfe6,isle:_0x6eab52,pallet:_0x9e4221,stock:_0x59f444,types:_0x409b21,adjust_qty:_0x52f7b5,new_adjust_qty:_0x52d3c2,note:_0x3e8a45,Room_name:_0x2779cf,invoice:_0x7880e,JO_number:_0x2b46da}=_0x6f4821['body'];if(typeof _0x3ee541==_0x37dab2(0x220))var _0x19ea0b=[_0x6f4821['body'][_0x37dab2(0x225)]],_0x31774f=[_0x6f4821[_0x37dab2(0x1d4)]['level']],_0x3f9bc3=[_0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x1d8)]],_0x3bf8e1=[_0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x21f)]],_0x2ce5a8=[_0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x242)]],_0x48c542=[_0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x1e0)]],_0x5228d2=[_0x6f4821[_0x37dab2(0x1d4)]['prod_code']],_0x868259=[_0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x194)]],_0x24f200=[_0x6f4821['body']['Secondary_units']],_0x596918=[_0x6f4821['body'][_0x37dab2(0x1d7)]],_0x210240=[_0x6f4821[_0x37dab2(0x1d4)]['expiry_date']];else var _0x19ea0b=[..._0x6f4821['body'][_0x37dab2(0x225)]],_0x31774f=[..._0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x1ea)]],_0x3f9bc3=[..._0x6f4821['body'][_0x37dab2(0x1d8)]],_0x3bf8e1=[..._0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x21f)]],_0x2ce5a8=[..._0x6f4821['body'][_0x37dab2(0x242)]],_0x48c542=[..._0x6f4821[_0x37dab2(0x1d4)]['new_adjust_qty']],_0x5228d2=[..._0x6f4821[_0x37dab2(0x1d4)][_0x37dab2(0x22d)]],_0x868259=[..._0x6f4821[_0x37dab2(0x1d4)]['unit']],_0x24f200=[..._0x6f4821['body'][_0x37dab2(0x1bb)]],_0x596918=[..._0x6f4821['body'][_0x37dab2(0x1d7)]],_0x210240=[..._0x6f4821['body'][_0x37dab2(0x227)]];const _0x44d1cf=_0x19ea0b[_0x37dab2(0x19d)](_0x886504=>{return _0x886504={'product_name':_0x886504};});_0x31774f[_0x37dab2(0x1dd)]((_0x386aea,_0x8d8ded)=>{_0x44d1cf[_0x8d8ded]['bay']=_0x386aea;}),_0x3f9bc3[_0x37dab2(0x1dd)]((_0x44105d,_0x3c74b0)=>{var _0x467455=_0x37dab2;_0x44d1cf[_0x3c74b0][_0x467455(0x1a1)]=_0x44105d;}),_0x3bf8e1[_0x37dab2(0x1dd)]((_0x430f95,_0x51df9e)=>{_0x44d1cf[_0x51df9e]['types']=_0x430f95;}),_0x2ce5a8[_0x37dab2(0x1dd)]((_0x529d2c,_0x2ddf7d)=>{var _0xbf2fb1=_0x37dab2;_0x44d1cf[_0x2ddf7d][_0xbf2fb1(0x242)]=_0x529d2c;}),_0x48c542[_0x37dab2(0x1dd)]((_0x5e87f1,_0x79363d)=>{var _0x17b2c3=_0x37dab2;_0x44d1cf[_0x79363d][_0x17b2c3(0x1e0)]=_0x5e87f1;}),_0x868259[_0x37dab2(0x1dd)]((_0x2a4bd3,_0x4722f1)=>{var _0x21e197=_0x37dab2;_0x44d1cf[_0x4722f1][_0x21e197(0x194)]=_0x2a4bd3;}),_0x24f200[_0x37dab2(0x1dd)]((_0xee5202,_0x26e244)=>{_0x44d1cf[_0x26e244]['secondary_unit']=_0xee5202;}),_0x5228d2[_0x37dab2(0x1dd)]((_0xc0c842,_0x2bb5f7)=>{var _0x3e5de6=_0x37dab2;_0x44d1cf[_0x2bb5f7][_0x3e5de6(0x245)]=_0xc0c842;}),_0x596918['forEach']((_0x30a0f8,_0x3301b8)=>{_0x44d1cf[_0x3301b8]['batch_code']=_0x30a0f8;}),_0x210240['forEach']((_0x3097ba,_0x389535)=>{_0x44d1cf[_0x389535]['expiry_date']=_0x3097ba;});const _0x5d9697=_0x44d1cf[_0x37dab2(0x1c2)](_0x524fbb=>_0x524fbb[_0x37dab2(0x242)]!=='0'&&_0x524fbb[_0x37dab2(0x242)]!=='');var _0x2e04bf=0x0;_0x5d9697[_0x37dab2(0x1dd)](_0x194b83=>{var _0x12b916=_0x37dab2;console[_0x12b916(0x231)](_0x12b916(0x1df),_0x194b83),parseInt(_0x194b83[_0x12b916(0x242)])<=0x0&&_0x2e04bf++;});if(_0x2e04bf!=0x0)return _0x6f4821[_0x37dab2(0x223)]('errors',_0x37dab2(0x1c9)),_0x378a2c[_0x37dab2(0x234)](_0x37dab2(0x215));_0x12f41f[_0x37dab2(0x209)]=_0x1673d4,_0x12f41f[_0x37dab2(0x1eb)]=_0x4dca57,_0x12f41f['product']=_0x5d9697,_0x12f41f[_0x37dab2(0x1bd)]=_0x3e8a45,_0x12f41f['room']=_0x2779cf,_0x12f41f[_0x37dab2(0x1a5)]=_0x7880e,_0x12f41f[_0x37dab2(0x1b5)]=_0x2b46da;const _0x5ef2fd=await _0x12f41f[_0x37dab2(0x1ae)](),_0x1ba0f5=await warehouse[_0x37dab2(0x232)]({'name':_0x1673d4,'room':_0x2779cf});_0x5ef2fd[_0x37dab2(0x1f4)][_0x37dab2(0x1dd)](_0x431f96=>{var _0x5a242a=_0x37dab2;const _0x1f1564=_0x1ba0f5[_0x5a242a(0x195)][_0x5a242a(0x19d)](_0x3d0689=>{var _0x16bc77=_0x5a242a;_0x431f96['types']=='minus'?_0x3d0689[_0x16bc77(0x1ee)]==_0x431f96[_0x16bc77(0x1ee)]&&_0x3d0689['bay']==_0x431f96['bay']&&(_0x3d0689['product_stock']=parseInt(_0x3d0689[_0x16bc77(0x1ec)])-parseInt(_0x431f96[_0x16bc77(0x242)])):_0x3d0689[_0x16bc77(0x1ee)]==_0x431f96[_0x16bc77(0x1ee)]&&_0x3d0689[_0x16bc77(0x1d6)]==_0x431f96['bay']&&(_0x3d0689[_0x16bc77(0x1ec)]=parseInt(_0x3d0689[_0x16bc77(0x1ec)])+parseInt(_0x431f96[_0x16bc77(0x242)]));});}),await _0x1ba0f5[_0x37dab2(0x1ae)](),_0x6f4821['flash'](_0x37dab2(0x1cc),'adjustment\x20data\x20update\x20successfully'),_0x378a2c['redirect']('/adjustment_finished/view');}catch(_0x18021e){console['log'](_0x18021e);}}),router[a0_0x1c6f14(0x197)](a0_0x1c6f14(0x1de),async(_0x9109cb,_0x4f257a)=>{var _0x434894=a0_0x1c6f14;const {primary_code:_0x3cac9f,warehouse_data:_0x4384a9,rooms_data:_0x36c388,Roomslist:_0x197dee}=_0x9109cb['body'],_0x47b5ca=_0x197dee[_0x434894(0x1cf)](','),_0x15f383=[];async function _0x5b1c1a(_0x233fa3){var _0x40368b=_0x434894;const _0x340027=await warehouse[_0x40368b(0x1d3)]([{'$match':{'name':_0x4384a9,'room':_0x233fa3}},{'$unwind':_0x40368b(0x1a3)},{'$match':{'product_details.primary_code':_0x3cac9f}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x40368b(0x1c3)},'primary_code':{'$first':_0x40368b(0x228)},'secondary_code':{'$first':_0x40368b(0x211)},'product_code':{'$first':_0x40368b(0x243)},'level':{'$first':_0x40368b(0x1d1)},'bay':{'$first':_0x40368b(0x1b8)},'type':{'$first':_0x40368b(0x1a6)},'pallet':{'$first':_0x40368b(0x1da)},'unit':{'$first':_0x40368b(0x239)},'secondary_unit':{'$first':_0x40368b(0x1cd)},'storage':{'$first':_0x40368b(0x230)},'rack':{'$first':_0x40368b(0x22f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x40368b(0x216)}}}]),_0x4c5496=await warehouse[_0x40368b(0x1d3)]([{'$match':{'name':_0x4384a9,'room':_0x233fa3}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3cac9f}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x40368b(0x23e)},'product_stock':{'$first':_0x40368b(0x1c3)},'primary_code':{'$first':_0x40368b(0x228)},'secondary_code':{'$first':_0x40368b(0x211)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x40368b(0x1d1)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x40368b(0x1a6)},'pallet':{'$first':_0x40368b(0x1da)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x40368b(0x1cd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x40368b(0x22f)},'expiry_date':{'$first':_0x40368b(0x1db)},'production_date':{'$first':_0x40368b(0x1f0)},'batch_code':{'$first':_0x40368b(0x1fa)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x40368b(0x1e9)},'roomNamed':{'$first':_0x40368b(0x1b9)},'invoice':{'$first':_0x40368b(0x216)}}}]);if(_0x340027[_0x40368b(0x20f)]>0x0)_0x15f383[_0x40368b(0x192)](_0x340027);else _0x4c5496[_0x40368b(0x20f)]>0x0&&_0x15f383['push'](_0x4c5496);}const _0x1d2bbb=_0x47b5ca[_0x434894(0x19d)](_0x7b23e3=>_0x5b1c1a(_0x7b23e3));await Promise[_0x434894(0x1bc)](_0x1d2bbb),_0x4f257a['json'](_0x15f383);}),router[a0_0x1c6f14(0x197)]('/CheckingWarehouse',async(_0x2d6551,_0x1abb98)=>{var _0x49432a=a0_0x1c6f14;const {productCode:_0x232130,bay:_0xacdb8c,warehouses:_0x4e1144,room:_0x56bb99}=_0x2d6551[_0x49432a(0x1d4)];console[_0x49432a(0x231)](_0x2d6551[_0x49432a(0x1d4)]);try{const _0x5374bc=await warehouse[_0x49432a(0x1d3)]([{'$match':{'name':_0x4e1144,'room':_0x56bb99}},{'$unwind':_0x49432a(0x1a3)},{'$match':{'product_details.bay':parseInt(_0xacdb8c)}},{'$group':{'_id':_0x49432a(0x1bf),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1abb98[_0x49432a(0x1b4)](0xc8)[_0x49432a(0x212)](_0x5374bc);}catch(_0x48c320){_0x1abb98[_0x49432a(0x1b4)](0x194)[_0x49432a(0x212)]({'message':_0x48c320[_0x49432a(0x1ab)]});}}),module[a0_0x1c6f14(0x226)]=router;