var a0_0x5efb4a=a0_0x4bff;(function(_0x5ca980,_0x475477){var _0x2c2ce3=a0_0x4bff,_0xde349d=_0x5ca980();while(!![]){try{var _0xf48a89=-parseInt(_0x2c2ce3(0x105))/0x1+-parseInt(_0x2c2ce3(0x171))/0x2*(-parseInt(_0x2c2ce3(0x123))/0x3)+-parseInt(_0x2c2ce3(0x11d))/0x4+parseInt(_0x2c2ce3(0x109))/0x5*(parseInt(_0x2c2ce3(0x199))/0x6)+-parseInt(_0x2c2ce3(0x131))/0x7+-parseInt(_0x2c2ce3(0x18b))/0x8+parseInt(_0x2c2ce3(0x15e))/0x9;if(_0xf48a89===_0x475477)break;else _0xde349d['push'](_0xde349d['shift']());}catch(_0x567577){_0xde349d['push'](_0xde349d['shift']());}}}(a0_0x2e1b,0x918eb));const express=require(a0_0x5efb4a(0x168)),app=express(),router=express['Router'](),auth=require(a0_0x5efb4a(0x198)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require('nodemailer');function a0_0x2e1b(){var _0x20cdb2=['Secondary_units','/CheckingWarehouse','master','prod_invoice','5932912eQCJRc','$product_details.storage','DRY\x20GOODS','length','Enclosed','/adjustment_finished/preview/','own','all','logs','/view_logs','language','$product_details.secondary_unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../middleware/auth','3430236aNoxqV','prod_code','Arabic\x20(ae)','Hindi','$product_details.rack','Ambient','/barcode_scanner','$date','English','add','Primary_Units','unit','$product','$product_details.production_date','/view/:id','edit_adjustment_finished_view','ADJF-','user','errors','$product_details.bin','adjustment_finished','padStart','map','$product.product_name','flash','product_name','820645dPvYrK','add_adjustment_finished_logs','forEach','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','10kJOLAU','production_date','invoice_init','English\x20(US)','/adjustment/view','$product_details.invoice','New_Qty_Converted_adj','An\x20error\x20occurred\x20while\x20saving\x20data.','foreach\x20newproduct','adjustment\x20data\x20update\x20successfully','batch_code','then','getMonth','types','floor','$name','$product_details.bay','$_id','JO_number','adjustment\x20add\x20successfull','2581584nlcAeB','render','toString','$product_details','string','find','2845347BRvdFZ','post','There\x27s\x20a\x20error\x20in\x20this\x20transaction','split','json','stockBefore','role','back','$finalize','warehouse','$product_details.floorlevel','Spanish','findById','adjustment_finished_logs','7532448GAnoMR','match','expiry_date','$invoice','findOne','new_adjust_qty','purchases_data','product_details','redirect','True','$product_details.unit','$product_details.product_stock','$product_details.product_name','LOG-ADJ-','New_Qty_Converted','minus','_id','<tr>','push','status','$product_details.batch_code','log','id_transaction','/adjustment_finished/view','id_transaction_from','invoice','adjust_qty','bay','params','level','add_adjustment_finished','$product.room_names','Return\x20Rooms','stock','Arabic','prod_cat','product_code','/picking_list/PDF_adjustmentFinal/','catch','$product_details._id','German','Portuguese\x20(BR)','French','Enabled','error','16092549NLsyTh','Chinese','$product_details.primary_code','maxPerUnit','$warehouse_name','product_stock','/view','</td>','filter','body','express','email','/view/add_adjustment_logs','room','secondary_unit','$product_details.product_code','get','$product_details.expiry_date','$product_details.maxPerUnit','2FJANfU','$room','prod_name','/preview/:id','date','product_date','message','/view/add_adjustment','success','$product_details.level','$product_details.secondary_code','Adjustment\x20Finalize\x20Successfully','aggregate','$product_details.type','save','room_names','Portuguese','exports','product','staff','Rooms','warehouse_name'];a0_0x2e1b=function(){return _0x20cdb2;};return a0_0x2e1b();}router['get'](a0_0x5efb4a(0x164),auth,async(_0x479dbc,_0x38513f)=>{var _0x1b06a4=a0_0x5efb4a;try{const {username:_0x554694,email:_0xfd99b7,role:_0x3cda02}=_0x479dbc[_0x1b06a4(0xfc)],_0x392169=_0x479dbc[_0x1b06a4(0xfc)],_0x37b056=await profile[_0x1b06a4(0x135)]({'email':_0x392169['email']}),_0x4bdf3d=await master_shop['find']();let _0x89fabd;if(_0x392169[_0x1b06a4(0x129)]=='staff'){const _0x3ec15a=await staff[_0x1b06a4(0x135)]({'email':_0x392169[_0x1b06a4(0x169)]});_0x89fabd=await warehouse[_0x1b06a4(0x122)]({'status':_0x1b06a4(0x15c),'name':_0x3ec15a['warehouse']});}else _0x89fabd=await warehouse[_0x1b06a4(0x122)]({'status':_0x1b06a4(0x15c)});const _0x393b0b=await product[_0x1b06a4(0x122)]();let _0x1f14e4;if(_0x392169[_0x1b06a4(0x129)]=='staff'){const _0x5bc68a=await staff[_0x1b06a4(0x135)]({'email':_0x392169[_0x1b06a4(0x169)]});_0x1f14e4=await adjustment_finished[_0x1b06a4(0x122)]({'warehouse_name':_0x5bc68a[_0x1b06a4(0x12c)]});}else _0x1f14e4=await adjustment_finished[_0x1b06a4(0x17d)]([{'$match':{'type_of_transaction':_0x1b06a4(0x191)}},{'$unwind':_0x1b06a4(0x1a5)},{'$group':{'_id':_0x1b06a4(0x11a),'invoice':{'$first':_0x1b06a4(0x134)},'date':{'$first':_0x1b06a4(0x1a0)},'warehouse_name':{'$first':_0x1b06a4(0x162)},'room':{'$addToSet':_0x1b06a4(0x150)},'finalize':{'$first':_0x1b06a4(0x12b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4bdf3d[0x0][_0x1b06a4(0x195)]==_0x1b06a4(0x10c)){var _0x432a30=users['English'];console[_0x1b06a4(0x146)](_0x432a30);}else{if(_0x4bdf3d[0x0][_0x1b06a4(0x195)]==_0x1b06a4(0x19c))var _0x432a30=users[_0x1b06a4(0x19c)];else{if(_0x4bdf3d[0x0]['language']==_0x1b06a4(0x159))var _0x432a30=users[_0x1b06a4(0x159)];else{if(_0x4bdf3d[0x0]['language']==_0x1b06a4(0x12e))var _0x432a30=users[_0x1b06a4(0x12e)];else{if(_0x4bdf3d[0x0][_0x1b06a4(0x195)]==_0x1b06a4(0x15b))var _0x432a30=users['French'];else{if(_0x4bdf3d[0x0][_0x1b06a4(0x195)]==_0x1b06a4(0x15a))var _0x432a30=users[_0x1b06a4(0x181)];else{if(_0x4bdf3d[0x0][_0x1b06a4(0x195)]==_0x1b06a4(0x15f))var _0x432a30=users[_0x1b06a4(0x15f)];else{if(_0x4bdf3d[0x0][_0x1b06a4(0x195)]==_0x1b06a4(0x19b))var _0x432a30=users[_0x1b06a4(0x153)];}}}}}}}_0x38513f[_0x1b06a4(0x11e)](_0x1b06a4(0xff),{'success':_0x479dbc[_0x1b06a4(0x103)]('success'),'errors':_0x479dbc[_0x1b06a4(0x103)](_0x1b06a4(0xfd)),'role':_0x392169,'profile':_0x37b056,'warehouse':_0x89fabd,'product':_0x393b0b,'adjustment':_0x1f14e4,'master_shop':_0x4bdf3d,'language':_0x432a30});}catch(_0x5cc60f){console[_0x1b06a4(0x146)](_0x5cc60f);}}),router[a0_0x5efb4a(0x16e)](a0_0x5efb4a(0x194),auth,async(_0x50d1a7,_0x52cbab)=>{var _0x5cdb63=a0_0x5efb4a;try{const {username:_0x390675,email:_0x28891f,role:_0x6f066d}=_0x50d1a7['user'],_0x3f05ff=_0x50d1a7[_0x5cdb63(0xfc)],_0x371cf0=await profile[_0x5cdb63(0x135)]({'email':_0x3f05ff[_0x5cdb63(0x169)]}),_0x3ebd67=await master_shop[_0x5cdb63(0x122)]();let _0x2e3e39;if(_0x3f05ff[_0x5cdb63(0x129)]==_0x5cdb63(0x184)){const _0xb781d=await staff[_0x5cdb63(0x135)]({'email':_0x3f05ff[_0x5cdb63(0x169)]});_0x2e3e39=await warehouse[_0x5cdb63(0x122)]({'status':_0x5cdb63(0x15c),'name':_0xb781d['warehouse']});}else _0x2e3e39=await warehouse[_0x5cdb63(0x122)]({'status':'Enabled'});const _0x2ced12=await product[_0x5cdb63(0x122)]();let _0xf82af3;if(_0x3f05ff['role']==_0x5cdb63(0x184)){const _0x266dc8=await staff[_0x5cdb63(0x135)]({'email':_0x3f05ff[_0x5cdb63(0x169)]});_0xf82af3=await adjustment_finished[_0x5cdb63(0x122)]({'warehouse_name':_0x266dc8[_0x5cdb63(0x12c)]});}else _0xf82af3=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x5cdb63(0x193)}},{'$unwind':_0x5cdb63(0x1a5)},{'$group':{'_id':_0x5cdb63(0x11a),'invoice':{'$first':_0x5cdb63(0x134)},'date':{'$first':_0x5cdb63(0x1a0)},'warehouse_name':{'$first':_0x5cdb63(0x162)},'room':{'$addToSet':_0x5cdb63(0x150)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x3ebd67[0x0][_0x5cdb63(0x195)]==_0x5cdb63(0x10c))var _0xf89eab=users[_0x5cdb63(0x1a1)];else{if(_0x3ebd67[0x0][_0x5cdb63(0x195)]==_0x5cdb63(0x19c))var _0xf89eab=users[_0x5cdb63(0x19c)];else{if(_0x3ebd67[0x0][_0x5cdb63(0x195)]==_0x5cdb63(0x159))var _0xf89eab=users['German'];else{if(_0x3ebd67[0x0][_0x5cdb63(0x195)]==_0x5cdb63(0x12e))var _0xf89eab=users[_0x5cdb63(0x12e)];else{if(_0x3ebd67[0x0]['language']==_0x5cdb63(0x15b))var _0xf89eab=users[_0x5cdb63(0x15b)];else{if(_0x3ebd67[0x0][_0x5cdb63(0x195)]==_0x5cdb63(0x15a))var _0xf89eab=users[_0x5cdb63(0x181)];else{if(_0x3ebd67[0x0]['language']==_0x5cdb63(0x15f))var _0xf89eab=users[_0x5cdb63(0x15f)];else{if(_0x3ebd67[0x0][_0x5cdb63(0x195)]=='Arabic\x20(ae)')var _0xf89eab=users[_0x5cdb63(0x153)];}}}}}}}_0x52cbab[_0x5cdb63(0x11e)](_0x5cdb63(0x130),{'success':_0x50d1a7[_0x5cdb63(0x103)](_0x5cdb63(0x179)),'errors':_0x50d1a7['flash'](_0x5cdb63(0xfd)),'role':_0x3f05ff,'profile':_0x371cf0,'warehouse':_0x2e3e39,'product':_0x2ced12,'adjustment':_0xf82af3,'master_shop':_0x3ebd67,'language':_0xf89eab});}catch(_0x183319){console[_0x5cdb63(0x146)](_0x183319);}});async function getRandom8DigitNumber(){var _0x337c4e=a0_0x5efb4a;const _0x57cc1e=0x989680,_0x2b3a56=0x5f5e0ff,_0x53097c=Math[_0x337c4e(0x117)](Math['random']()*(_0x2b3a56-_0x57cc1e+0x1))+_0x57cc1e;var _0x1493fc;const _0x2107ad=await adjustment_finished['findOne']({'invoice':_0x337c4e(0xfb)+_0x53097c});return _0x2107ad&&_0x2107ad[_0x337c4e(0x18e)]>0x0?_0x1493fc='ADJF-'+_0x53097c:_0x1493fc=_0x337c4e(0xfb)+_0x53097c,_0x1493fc;}function a0_0x4bff(_0x2458d9,_0x3ad86c){var _0x2e1b3e=a0_0x2e1b();return a0_0x4bff=function(_0x4bffc3,_0x5a3c65){_0x4bffc3=_0x4bffc3-0xf8;var _0xf6f66f=_0x2e1b3e[_0x4bffc3];return _0xf6f66f;},a0_0x4bff(_0x2458d9,_0x3ad86c);}router[a0_0x5efb4a(0x16e)](a0_0x5efb4a(0x178),auth,async(_0x18ee45,_0x52b14d)=>{var _0x164424=a0_0x5efb4a;try{const {username:_0x20eae1,email:_0x9b6555,role:_0x3f8fa7}=_0x18ee45['user'],_0x60c46e=_0x18ee45[_0x164424(0xfc)],_0x4d2a37=await profile[_0x164424(0x135)]({'email':_0x60c46e[_0x164424(0x169)]}),_0x52d27e=await master_shop[_0x164424(0x122)]();let _0x531edd;if(_0x60c46e['role']==_0x164424(0x184)){const _0x3df13c=await staff[_0x164424(0x135)]({'email':_0x60c46e[_0x164424(0x169)]});_0x531edd=await warehouse[_0x164424(0x17d)]([{'$match':{'status':_0x164424(0x15c),'name':_0x3df13c[_0x164424(0x12c)]}},{'$group':{'_id':_0x164424(0x118),'name':{'$first':_0x164424(0x118)}}}]);}else _0x531edd=await warehouse[_0x164424(0x17d)]([{'$match':{'status':_0x164424(0x15c)}},{'$group':{'_id':_0x164424(0x118),'name':{'$first':'$name'}}}]);const _0x5e277e=await product[_0x164424(0x122)]({}),_0x20c7d7=await adjustment_finished[_0x164424(0x122)](),_0x43ec72=_0x20c7d7[_0x164424(0x18e)]+0x1,_0x5cb50b='ADJF-'+_0x43ec72['toString']()['padStart'](0x5,'0');var _0x5aef88=[_0x164424(0x19e),'Enclosed',_0x164424(0x151)];if(_0x52d27e[0x0][_0x164424(0x195)]=='English\x20(US)')var _0x59364a=users[_0x164424(0x1a1)];else{if(_0x52d27e[0x0]['language']==_0x164424(0x19c))var _0x59364a=users[_0x164424(0x19c)];else{if(_0x52d27e[0x0][_0x164424(0x195)]=='German')var _0x59364a=users[_0x164424(0x159)];else{if(_0x52d27e[0x0][_0x164424(0x195)]==_0x164424(0x12e))var _0x59364a=users['Spanish'];else{if(_0x52d27e[0x0][_0x164424(0x195)]==_0x164424(0x15b))var _0x59364a=users[_0x164424(0x15b)];else{if(_0x52d27e[0x0][_0x164424(0x195)]==_0x164424(0x15a))var _0x59364a=users['Portuguese'];else{if(_0x52d27e[0x0][_0x164424(0x195)]==_0x164424(0x15f))var _0x59364a=users['Chinese'];else{if(_0x52d27e[0x0][_0x164424(0x195)]=='Arabic\x20(ae)')var _0x59364a=users[_0x164424(0x153)];}}}}}}}const _0x2a3a31=getRandom8DigitNumber();_0x2a3a31[_0x164424(0x114)](_0xc273fb=>{var _0x14081a=_0x164424;_0x52b14d['render'](_0x14081a(0x14f),{'success':_0x18ee45[_0x14081a(0x103)]('success'),'errors':_0x18ee45[_0x14081a(0x103)]('errors'),'role':_0x60c46e,'profile':_0x4d2a37,'warehouse':_0x531edd,'product':_0x5e277e,'master_shop':_0x52d27e,'language':_0x59364a,'rooms_data':_0x5aef88,'invoice_no':_0xc273fb});})[_0x164424(0x157)](_0x2511cb=>{var _0xc31795=_0x164424;_0x18ee45[_0xc31795(0x103)](_0xc31795(0xfd),_0xc31795(0x125)),_0x52b14d[_0xc31795(0x139)](_0xc31795(0x10d));});}catch(_0x573d9a){console[_0x164424(0x146)](_0x573d9a);}}),router[a0_0x5efb4a(0x124)]('/view/add_adjustment',auth,async(_0x59114c,_0x537f0c)=>{var _0x4df87d=a0_0x5efb4a;try{const {warehouse_name:_0xfc37bd,date:_0x14e651,prod_name:_0x38351d,level:_0x3c99f5,isle:_0x315661,pallet:_0x370f15,stock:_0x99524,types:_0x2d8167,adjust_qty:_0x203d29,new_adjust_qty:_0x236df9,note:_0x5a7089,Room_name:_0x1dbc3c,JO_number:_0x5c79cd,expiry_date:_0x3cd290,PO_number:_0x307943,ReqBy:_0x489296,dateofreq:_0xdc21b,typeservicesData:_0x2b0415,destination:_0x36f994,deliverydate:_0xda78a5,driver:_0x54a23d,plate:_0x3d3832,van:_0x2d9369,DRSI:_0x58b32d,typevehicle:_0x383d2b,TSU:_0x1d5efb,TFU:_0x536011}=_0x59114c[_0x4df87d(0x167)];if(typeof _0x38351d==_0x4df87d(0x121))var _0xe92c26=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x173)]],_0x1eeea3=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x14e)]],_0x1e5f7d=[_0x59114c[_0x4df87d(0x167)]['stock']],_0x543e8b=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x116)]],_0x23b509=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x10f)]],_0x10d5ce=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x13f)]],_0x496018=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x1a3)]],_0x5eec7f=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x187)]],_0x416803=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x19a)]],_0x1f240d=[_0x59114c['body'][_0x4df87d(0x113)]],_0x214a3f=[_0x59114c[_0x4df87d(0x167)]['expiry_date']],_0x393f2e=[_0x59114c[_0x4df87d(0x167)]['product_date']],_0x7e4f8d=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x154)]],_0x5365ab=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x185)]],_0x15d8c2=[_0x59114c['body']['maxPerUnit']],_0x192fa4=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x18a)]],_0x274f7f=[_0x59114c[_0x4df87d(0x167)][_0x4df87d(0x149)]];else var _0xe92c26=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x173)]],_0x1eeea3=[..._0x59114c[_0x4df87d(0x167)]['level']],_0x1e5f7d=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x152)]],_0x543e8b=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x116)]],_0x23b509=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x10f)]],_0x10d5ce=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x13f)]],_0x496018=[..._0x59114c[_0x4df87d(0x167)]['Primary_Units']],_0x5eec7f=[..._0x59114c[_0x4df87d(0x167)]['Secondary_units']],_0x416803=[..._0x59114c[_0x4df87d(0x167)]['prod_code']],_0x1f240d=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x113)]],_0x214a3f=[..._0x59114c[_0x4df87d(0x167)]['expiry_date']],_0x393f2e=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x176)]],_0x7e4f8d=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x154)]],_0x5365ab=[..._0x59114c[_0x4df87d(0x167)]['Rooms']],_0x15d8c2=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x161)]],_0x192fa4=[..._0x59114c['body'][_0x4df87d(0x18a)]],_0x274f7f=[..._0x59114c[_0x4df87d(0x167)][_0x4df87d(0x149)]];const _0x1b2670=_0xe92c26[_0x4df87d(0x101)](_0x174746=>{return _0x174746={'product_name':_0x174746};});_0x1eeea3[_0x4df87d(0x107)]((_0x665972,_0x27a458)=>{var _0x468c5e=_0x4df87d,_0xcf2006=_0x665972[_0x468c5e(0x132)](/[A-Za-z]+/)[0x0],_0x2daa48=parseInt(_0x665972[_0x468c5e(0x132)](/\d+/)[0x0]);_0x1b2670[_0x27a458]['level']=_0xcf2006,_0x1b2670[_0x27a458][_0x468c5e(0x14c)]=_0x2daa48;}),_0x274f7f[_0x4df87d(0x107)]((_0x9d9b27,_0x49b0df)=>{var _0x373e97=_0x4df87d;_0x1b2670[_0x49b0df][_0x373e97(0x147)]=_0x9d9b27;}),_0x1e5f7d['forEach']((_0x22532a,_0x113d3e)=>{_0x1b2670[_0x113d3e]['stockBefore']=_0x22532a;}),_0x543e8b[_0x4df87d(0x107)]((_0x15cf1b,_0x4a60ee)=>{var _0xe827e=_0x4df87d;_0x1b2670[_0x4a60ee][_0xe827e(0x116)]=_0x15cf1b;}),_0x23b509[_0x4df87d(0x107)]((_0x1f3ba5,_0x12ec4e)=>{var _0x4e2822=_0x4df87d;_0x1b2670[_0x12ec4e][_0x4e2822(0x14b)]=_0x1f3ba5;}),_0x10d5ce[_0x4df87d(0x107)]((_0x5e73f5,_0x168fb6)=>{var _0x30f707=_0x4df87d;_0x1b2670[_0x168fb6][_0x30f707(0x136)]=_0x5e73f5;}),_0x496018[_0x4df87d(0x107)]((_0x38ba90,_0x341a05)=>{var _0x3cd488=_0x4df87d;_0x1b2670[_0x341a05][_0x3cd488(0x1a4)]=_0x38ba90;}),_0x5eec7f[_0x4df87d(0x107)]((_0x42e3da,_0x4e3fdc)=>{_0x1b2670[_0x4e3fdc]['secondary_unit']=_0x42e3da;}),_0x416803[_0x4df87d(0x107)]((_0x7a21c,_0x1fc348)=>{var _0x19c582=_0x4df87d;_0x1b2670[_0x1fc348][_0x19c582(0x155)]=_0x7a21c;}),_0x1f240d[_0x4df87d(0x107)]((_0x27ff53,_0x16cae3)=>{var _0x58bdd1=_0x4df87d;_0x1b2670[_0x16cae3][_0x58bdd1(0x113)]=_0x27ff53;}),_0x214a3f[_0x4df87d(0x107)]((_0x4fdf40,_0x32ddcd)=>{_0x1b2670[_0x32ddcd]['expiry_date']=_0x4fdf40;}),_0x393f2e[_0x4df87d(0x107)]((_0xfbc115,_0x1eb936)=>{_0x1b2670[_0x1eb936]['production_date']=_0xfbc115;}),_0x7e4f8d[_0x4df87d(0x107)]((_0x4f87d1,_0x36e6df)=>{_0x1b2670[_0x36e6df]['prod_cat']=_0x4f87d1;}),_0x5365ab[_0x4df87d(0x107)]((_0x10eaa3,_0x3d5967)=>{_0x1b2670[_0x3d5967]['room_names']=_0x10eaa3;}),_0x15d8c2[_0x4df87d(0x107)]((_0x5a234a,_0x1e5f25)=>{_0x1b2670[_0x1e5f25]['maxPerUnit']=_0x5a234a;}),_0x192fa4[_0x4df87d(0x107)]((_0x43c17f,_0x1717c4)=>{_0x1b2670[_0x1717c4]['invoice']=_0x43c17f;});const _0x548fdd=_0x1b2670[_0x4df87d(0x166)](_0x2f310c=>_0x2f310c[_0x4df87d(0x14b)]!=='0'&&_0x2f310c['adjust_qty']!=='');var _0x4884ff=0x0;_0x548fdd[_0x4df87d(0x107)](_0x341b12=>{var _0x4c0f91=_0x4df87d;console[_0x4c0f91(0x146)]('foreach\x20newproduct',_0x341b12),parseInt(_0x341b12[_0x4c0f91(0x14b)])<=0x0&&_0x4884ff++;});if(_0x4884ff!=0x0)return _0x59114c[_0x4df87d(0x103)](_0x4df87d(0xfd),_0x4df87d(0x108)),_0x537f0c[_0x4df87d(0x139)]('back');const _0x4437e1=new invoice_for_adjustment();await _0x4437e1[_0x4df87d(0x17f)]();const _0x46ab48=new adjustment_finished({'warehouse_name':_0xfc37bd,'date':_0x14e651,'product':_0x548fdd,'note':_0x5a7089,'room':_0x1dbc3c,'invoice':'ADJ-'+_0x4437e1[_0x4df87d(0x10b)][_0x4df87d(0x11f)]()[_0x4df87d(0x100)](0x8,'0'),'JO_number':_0x5c79cd,'expiry_date':_0x3cd290,'PO_number':_0x307943,'RequestedBy':_0x489296,'DateofRequest':_0xdc21b,'typeservices':_0x2b0415,'destination':_0x36f994,'deliverydate':_0xda78a5,'driver':_0x54a23d,'plate':_0x3d3832,'van':_0x2d9369,'DRSI':_0x58b32d,'typevehicle':_0x383d2b,'TSU':_0x1d5efb,'TFU':_0x536011}),_0x5ace01=await _0x46ab48[_0x4df87d(0x17f)]();_0x59114c[_0x4df87d(0x103)](_0x4df87d(0x179),_0x4df87d(0x11c)),_0x537f0c[_0x4df87d(0x139)]('/adjustment_finished/preview/'+_0x5ace01[_0x4df87d(0x141)]);}catch(_0x51c90e){console[_0x4df87d(0x146)](_0x51c90e),_0x537f0c['status'](0xc8)[_0x4df87d(0x127)]({'message':_0x51c90e[_0x4df87d(0x177)]});}}),router['get'](a0_0x5efb4a(0x16a),auth,async(_0x173de5,_0x1ef234)=>{var _0x3a7d5d=a0_0x5efb4a;try{const {username:_0x15aba7,email:_0x265283,role:_0x2b70b6}=_0x173de5[_0x3a7d5d(0xfc)],_0x5681bd=_0x173de5[_0x3a7d5d(0xfc)],_0x20c935=await profile[_0x3a7d5d(0x135)]({'email':_0x5681bd[_0x3a7d5d(0x169)]}),_0xa7adbc=await master_shop['find']();let _0x108882;if(_0x5681bd['role']==_0x3a7d5d(0x184)){const _0x18387b=await staff[_0x3a7d5d(0x135)]({'email':_0x5681bd[_0x3a7d5d(0x169)]});_0x108882=await warehouse['aggregate']([{'$match':{'status':_0x3a7d5d(0x15c),'name':_0x18387b[_0x3a7d5d(0x12c)]}},{'$group':{'_id':'$name','name':{'$first':_0x3a7d5d(0x118)}}}]);}else _0x108882=await warehouse[_0x3a7d5d(0x17d)]([{'$match':{'status':_0x3a7d5d(0x15c)}},{'$group':{'_id':_0x3a7d5d(0x118),'name':{'$first':_0x3a7d5d(0x118)}}}]);const _0x3dc591=await product[_0x3a7d5d(0x122)](),_0x3ec221=await adjustment_finished['find'](),_0x40372b=_0x3ec221[_0x3a7d5d(0x18e)]+0x1,_0x44bad6=_0x3a7d5d(0xfb)+_0x40372b[_0x3a7d5d(0x11f)]()[_0x3a7d5d(0x100)](0x5,'0');var _0x516305=[_0x3a7d5d(0x19e),_0x3a7d5d(0x18f),'Return\x20Rooms'];if(_0xa7adbc[0x0]['language']==_0x3a7d5d(0x10c))var _0x3a5c7f=users[_0x3a7d5d(0x1a1)];else{if(_0xa7adbc[0x0][_0x3a7d5d(0x195)]==_0x3a7d5d(0x19c))var _0x3a5c7f=users['Hindi'];else{if(_0xa7adbc[0x0][_0x3a7d5d(0x195)]==_0x3a7d5d(0x159))var _0x3a5c7f=users['German'];else{if(_0xa7adbc[0x0][_0x3a7d5d(0x195)]==_0x3a7d5d(0x12e))var _0x3a5c7f=users['Spanish'];else{if(_0xa7adbc[0x0]['language']==_0x3a7d5d(0x15b))var _0x3a5c7f=users['French'];else{if(_0xa7adbc[0x0][_0x3a7d5d(0x195)]==_0x3a7d5d(0x15a))var _0x3a5c7f=users[_0x3a7d5d(0x181)];else{if(_0xa7adbc[0x0]['language']==_0x3a7d5d(0x15f))var _0x3a5c7f=users['Chinese'];else{if(_0xa7adbc[0x0][_0x3a7d5d(0x195)]=='Arabic\x20(ae)')var _0x3a5c7f=users['Arabic'];}}}}}}}const _0x20026a=getRandom8DigitNumber();_0x20026a[_0x3a7d5d(0x114)](_0xdcc950=>{var _0x1ef4fb=_0x3a7d5d;_0x1ef234[_0x1ef4fb(0x11e)](_0x1ef4fb(0x106),{'success':_0x173de5[_0x1ef4fb(0x103)](_0x1ef4fb(0x179)),'errors':_0x173de5[_0x1ef4fb(0x103)](_0x1ef4fb(0xfd)),'role':_0x5681bd,'profile':_0x20c935,'warehouse':_0x108882,'product':_0x3dc591,'master_shop':_0xa7adbc,'language':_0x3a5c7f,'rooms_data':_0x516305,'invoice_no':_0xdcc950});})['catch'](_0x36f537=>{var _0x59d01f=_0x3a7d5d;_0x173de5[_0x59d01f(0x103)](_0x59d01f(0xfd),_0x59d01f(0x125)),_0x1ef234[_0x59d01f(0x139)](_0x59d01f(0x10d));});}catch(_0x3ba3e4){console['log'](_0x3ba3e4);}}),router[a0_0x5efb4a(0x124)](a0_0x5efb4a(0x16a),auth,async(_0x5e6bbc,_0x54abcf)=>{var _0x2b70d3=a0_0x5efb4a;try{const {warehouse_name:_0x3a55a2,date:_0x57127b,prod_name:_0x14e397,level:_0x28f275,isle:_0x72e78e,pallet:_0x2a6f6b,stock:_0x18abb7,types:_0x2a8623,adjust_qty:_0x528152,new_adjust_qty:_0x1a535b,note:_0x87168,Room_name:_0x5940c6,JO_number:_0x49ec94,expiry_date:_0x3709d4,type_of_transaction:_0x31ed4e,PO_number:_0x1eaf9c,ReqBy:_0x3d41be,dateofreq:_0x527870,typeservicesData:_0x1bbf36,destination:_0x582bfd,deliverydate:_0x3b76ab,driver:_0x318126,plate:_0x3a5186,van:_0x566d13,DRSI:_0x202fc3,typevehicle:_0xf9bde0,TSU:_0x5b7615,TFU:_0x412fc4}=_0x5e6bbc[_0x2b70d3(0x167)];if(typeof _0x14e397==_0x2b70d3(0x121))var _0x618490=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x173)]],_0x1c2b51=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x14e)]],_0x39af90=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x152)]],_0x14e5f0=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x116)]],_0x25eb28=[_0x5e6bbc['body']['New_Qty_Converted_adj']],_0x513755=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x13f)]],_0x4e7c4d=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x1a3)]],_0x15217f=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x187)]],_0x4e8f6c=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x19a)]],_0x42d933=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x113)]],_0x46b16c=[_0x5e6bbc['body'][_0x2b70d3(0x133)]],_0x889577=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x176)]],_0x364810=[_0x5e6bbc['body'][_0x2b70d3(0x154)]],_0x562b52=[_0x5e6bbc['body'][_0x2b70d3(0x185)]],_0x5cdec1=[_0x5e6bbc['body'][_0x2b70d3(0x161)]],_0x3f25b9=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x18a)]],_0x3df9b1=[_0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x149)]];else var _0x618490=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x173)]],_0x1c2b51=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x14e)]],_0x39af90=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x152)]],_0x14e5f0=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x116)]],_0x25eb28=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x10f)]],_0x513755=[..._0x5e6bbc['body'][_0x2b70d3(0x13f)]],_0x4e7c4d=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x1a3)]],_0x15217f=[..._0x5e6bbc['body'][_0x2b70d3(0x187)]],_0x4e8f6c=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x19a)]],_0x42d933=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x113)]],_0x46b16c=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x133)]],_0x889577=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x176)]],_0x364810=[..._0x5e6bbc[_0x2b70d3(0x167)]['prod_cat']],_0x562b52=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x185)]],_0x5cdec1=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x161)]],_0x3f25b9=[..._0x5e6bbc[_0x2b70d3(0x167)][_0x2b70d3(0x18a)]],_0x3df9b1=[..._0x5e6bbc['body'][_0x2b70d3(0x149)]];const _0x256cb6=_0x618490[_0x2b70d3(0x101)](_0x28ea79=>{return _0x28ea79={'product_name':_0x28ea79};});_0x1c2b51[_0x2b70d3(0x107)]((_0x1055ac,_0x3a6021)=>{var _0x5d0e54=_0x2b70d3,_0x2fc53a=_0x1055ac[_0x5d0e54(0x132)](/[A-Za-z]+/)[0x0],_0x1ad52b=parseInt(_0x1055ac[_0x5d0e54(0x132)](/\d+/)[0x0]);_0x256cb6[_0x3a6021][_0x5d0e54(0x14e)]=_0x2fc53a,_0x256cb6[_0x3a6021][_0x5d0e54(0x14c)]=_0x1ad52b;}),_0x3df9b1[_0x2b70d3(0x107)]((_0x535196,_0x5820fd)=>{var _0x28fce4=_0x2b70d3;_0x256cb6[_0x5820fd][_0x28fce4(0x147)]=_0x535196;}),_0x39af90[_0x2b70d3(0x107)]((_0x590e9e,_0x38acc8)=>{var _0x40b98f=_0x2b70d3;_0x256cb6[_0x38acc8][_0x40b98f(0x128)]=_0x590e9e;}),_0x14e5f0[_0x2b70d3(0x107)]((_0x546fc1,_0xcb1352)=>{var _0x2d6614=_0x2b70d3;_0x256cb6[_0xcb1352][_0x2d6614(0x116)]=_0x546fc1;}),_0x25eb28[_0x2b70d3(0x107)]((_0x23c7f4,_0x20f6f8)=>{var _0x11259b=_0x2b70d3;_0x256cb6[_0x20f6f8][_0x11259b(0x14b)]=_0x23c7f4;}),_0x513755[_0x2b70d3(0x107)]((_0x4b1f75,_0x45fabf)=>{var _0x261ca2=_0x2b70d3;_0x256cb6[_0x45fabf][_0x261ca2(0x136)]=_0x4b1f75;}),_0x4e7c4d[_0x2b70d3(0x107)]((_0xc35226,_0x2b7c08)=>{var _0x4f7bb3=_0x2b70d3;_0x256cb6[_0x2b7c08][_0x4f7bb3(0x1a4)]=_0xc35226;}),_0x15217f[_0x2b70d3(0x107)]((_0x44b286,_0x400913)=>{var _0x40e592=_0x2b70d3;_0x256cb6[_0x400913][_0x40e592(0x16c)]=_0x44b286;}),_0x4e8f6c[_0x2b70d3(0x107)]((_0xb162,_0x4bb38b)=>{var _0x82be3f=_0x2b70d3;_0x256cb6[_0x4bb38b][_0x82be3f(0x155)]=_0xb162;}),_0x42d933[_0x2b70d3(0x107)]((_0x1469f3,_0x239d49)=>{var _0x2de524=_0x2b70d3;_0x256cb6[_0x239d49][_0x2de524(0x113)]=_0x1469f3;}),_0x46b16c[_0x2b70d3(0x107)]((_0x2f4a32,_0x3c3529)=>{_0x256cb6[_0x3c3529]['expiry_date']=_0x2f4a32;}),_0x889577[_0x2b70d3(0x107)]((_0xcbdb53,_0x4fe9db)=>{var _0x41201e=_0x2b70d3;_0x256cb6[_0x4fe9db][_0x41201e(0x10a)]=_0xcbdb53;}),_0x364810[_0x2b70d3(0x107)]((_0x714fae,_0x2ea801)=>{var _0x1bc183=_0x2b70d3;_0x256cb6[_0x2ea801][_0x1bc183(0x154)]=_0x714fae;}),_0x562b52[_0x2b70d3(0x107)]((_0x464a96,_0x3e7622)=>{var _0x309203=_0x2b70d3;_0x256cb6[_0x3e7622][_0x309203(0x180)]=_0x464a96;}),_0x5cdec1['forEach']((_0x1fc12a,_0x2cc9f2)=>{_0x256cb6[_0x2cc9f2]['maxPerUnit']=_0x1fc12a;}),_0x3f25b9[_0x2b70d3(0x107)]((_0x141c87,_0xe3e15e)=>{_0x256cb6[_0xe3e15e]['invoice']=_0x141c87;});const _0x279aba=_0x256cb6[_0x2b70d3(0x166)](_0x4210a4=>_0x4210a4[_0x2b70d3(0x14b)]!=='0'&&_0x4210a4[_0x2b70d3(0x14b)]!=='');var _0x516a96=0x0;_0x279aba[_0x2b70d3(0x107)](_0x44d4b3=>{var _0x2456e5=_0x2b70d3;console[_0x2456e5(0x146)](_0x2456e5(0x111),_0x44d4b3),parseInt(_0x44d4b3[_0x2456e5(0x14b)])<=0x0&&_0x516a96++;});if(_0x516a96!=0x0)return _0x5e6bbc['flash'](_0x2b70d3(0xfd),_0x2b70d3(0x108)),_0x54abcf[_0x2b70d3(0x139)](_0x2b70d3(0x12a));const _0xa901a4=new adjustment_logs();await _0xa901a4[_0x2b70d3(0x17f)]();const _0x8c9fd=new adjustment_finished({'warehouse_name':_0x3a55a2,'date':_0x57127b,'product':_0x279aba,'note':_0x87168,'room':_0x5940c6,'invoice':_0x2b70d3(0x13e)+_0xa901a4[_0x2b70d3(0x10b)][_0x2b70d3(0x11f)]()[_0x2b70d3(0x100)](0x8,'0'),'JO_number':_0x49ec94,'expiry_date':_0x3709d4,'type_of_transaction':_0x31ed4e,'PO_number':_0x1eaf9c,'RequestedBy':_0x3d41be,'DateofRequest':_0x527870,'typeservices':_0x1bbf36,'destination':_0x582bfd,'deliverydate':_0x3b76ab,'driver':_0x318126,'plate':_0x3a5186,'van':_0x566d13,'DRSI':_0x202fc3,'typevehicle':_0xf9bde0,'TSU':_0x5b7615,'TFU':_0x412fc4}),_0x2f70a9=await _0x8c9fd['save']();_0x5e6bbc['flash'](_0x2b70d3(0x179),_0x2b70d3(0x11c)),_0x54abcf[_0x2b70d3(0x139)](_0x2b70d3(0x190)+_0x2f70a9[_0x2b70d3(0x141)]);}catch(_0x286607){console['log'](_0x286607),_0x54abcf[_0x2b70d3(0x144)](0xc8)[_0x2b70d3(0x127)]({'message':_0x286607[_0x2b70d3(0x177)]});}}),router[a0_0x5efb4a(0x16e)]('/preview/:id',auth,async(_0x27b059,_0xb588b1)=>{var _0x296dae=a0_0x5efb4a;try{const {username:_0xf40121,email:_0x1bb97e,role:_0x55637f}=_0x27b059[_0x296dae(0xfc)],_0x318de9=_0x27b059['user'],_0x138a0c=await profile[_0x296dae(0x135)]({'email':_0x318de9[_0x296dae(0x169)]}),_0x312c8a=await master_shop[_0x296dae(0x122)](),_0x5eab68=_0x27b059[_0x296dae(0x14d)]['id'],_0xf16b70=await adjustment_finished[_0x296dae(0x12f)]({'_id':_0x5eab68}),_0x487bfe=await purchases['aggregate']([{'$match':{'warehouse_name':_0xf16b70[_0x296dae(0x186)]}},{'$unwind':_0x296dae(0x1a5)},{'$group':{'_id':_0x296dae(0x102)}}]);console[_0x296dae(0x146)]('purchases_data',_0x487bfe);const _0x167007=await product[_0x296dae(0x122)]({}),_0x57eac7=await warehouse[_0x296dae(0x17d)]([{'$match':{'name':_0xf16b70['warehouse_name']}},{'$unwind':_0x296dae(0x120)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x296dae(0x13d)},'product_stock':{'$first':_0x296dae(0x13c)},'bay':{'$first':_0x296dae(0x119)},'bin':{'$first':_0x296dae(0xfe)},'type':{'$first':_0x296dae(0x17e)},'floorlevel':{'$first':_0x296dae(0x12d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x296dae(0x19d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x296dae(0xf8)},'batch_code':{'$first':_0x296dae(0x145)},'maxPerUnit':{'$first':_0x296dae(0x170)},'room':{'$first':'$room'}}}]);if(_0x312c8a[0x0]['language']==_0x296dae(0x10c)){var _0x40255e=users[_0x296dae(0x1a1)];console['log'](_0x40255e);}else{if(_0x312c8a[0x0]['language']==_0x296dae(0x19c))var _0x40255e=users[_0x296dae(0x19c)];else{if(_0x312c8a[0x0][_0x296dae(0x195)]==_0x296dae(0x159))var _0x40255e=users['German'];else{if(_0x312c8a[0x0][_0x296dae(0x195)]==_0x296dae(0x12e))var _0x40255e=users[_0x296dae(0x12e)];else{if(_0x312c8a[0x0][_0x296dae(0x195)]==_0x296dae(0x15b))var _0x40255e=users['French'];else{if(_0x312c8a[0x0]['language']==_0x296dae(0x15a))var _0x40255e=users[_0x296dae(0x181)];else{if(_0x312c8a[0x0][_0x296dae(0x195)]==_0x296dae(0x15f))var _0x40255e=users['Chinese'];else{if(_0x312c8a[0x0]['language']==_0x296dae(0x19b))var _0x40255e=users[_0x296dae(0x153)];}}}}}}}_0xb588b1[_0x296dae(0x11e)](_0x296dae(0xfa),{'success':_0x27b059['flash'](_0x296dae(0x179)),'errors':_0x27b059[_0x296dae(0x103)](_0x296dae(0xfd)),'role':_0x318de9,'profile':_0x138a0c,'adjustment':_0xf16b70,'stock':_0x57eac7,'master_shop':_0x312c8a,'warehouse_name':_0x487bfe,'unit':_0x167007,'language':_0x40255e});}catch(_0x1fcf94){console[_0x296dae(0x146)](_0x1fcf94),_0xb588b1['status'](0xc8)[_0x296dae(0x127)]({'message':_0x1fcf94[_0x296dae(0x177)]});}}),router['post'](a0_0x5efb4a(0x174),auth,async(_0x5e1e46,_0x37773d)=>{var _0x1737d2=a0_0x5efb4a;try{const {invoice:_0x3c3d08,warehouse_name:_0x15b91d,Room_name:_0x28de74}=_0x5e1e46[_0x1737d2(0x167)],_0x11a48e=_0x5e1e46[_0x1737d2(0x14d)]['id'],_0x11394b=await adjustment_finished['findById']({'_id':_0x11a48e});var _0x3a74b0;const _0x4c0784=_0x11394b['product']['map'](async _0x42b63a=>{var _0x1294f3=_0x1737d2;if(_0x42b63a[_0x1294f3(0x14b)]>0x0){_0x3a74b0=await warehouse[_0x1294f3(0x135)]({'name':_0x15b91d,'room':_0x42b63a['room_names']});const _0x4ee1f6=_0x3a74b0['product_details'][_0x1294f3(0x101)](_0x253b43=>{var _0x18117d=_0x1294f3;console[_0x18117d(0x146)](_0x42b63a[_0x18117d(0x116)]);if(_0x42b63a['types']==_0x18117d(0x140))_0x253b43[_0x18117d(0x141)]==_0x42b63a[_0x18117d(0x147)]&&(_0x253b43['product_stock']=_0x253b43[_0x18117d(0x163)]-_0x42b63a['adjust_qty']);else _0x42b63a[_0x18117d(0x116)]==_0x18117d(0x1a2)&&(_0x253b43['_id']==_0x42b63a[_0x18117d(0x147)]&&(_0x253b43[_0x18117d(0x163)]=_0x253b43[_0x18117d(0x163)]+_0x42b63a[_0x18117d(0x14b)]));});}return _0x3a74b0;});Promise[_0x1737d2(0x192)](_0x4c0784)[_0x1737d2(0x114)](async _0x18c5f0=>{var _0xf4021a=_0x1737d2;try{for(const _0xdea1ed of _0x18c5f0){await _0xdea1ed[_0xf4021a(0x17f)]();}_0x11394b['finalize']=_0xf4021a(0x13a);const _0x4b9881=await _0x11394b[_0xf4021a(0x17f)](),_0xad41ae=await master_shop[_0xf4021a(0x122)](),_0x4d0c7f=await email_settings[_0xf4021a(0x135)](),_0x47fc90=await supervisor_settings['find']();var _0x50c397=_0x11394b['product'],_0x38c604='',_0x670864;for(_0x670864 in _0x50c397){var _0x59eca3='FG';_0x11394b[_0xf4021a(0x186)]==_0xf4021a(0x18d)&&(_0x59eca3='DG'),_0x38c604+=_0xf4021a(0x142)+_0xf4021a(0x197)+_0x50c397[_0x670864][_0xf4021a(0x104)]+_0xf4021a(0x165)+_0xf4021a(0x197)+_0x50c397[_0x670864]['product_code']+_0xf4021a(0x165)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50c397[_0x670864][_0xf4021a(0x14b)]+_0xf4021a(0x165)+_0xf4021a(0x197)+_0x50c397[_0x670864][_0xf4021a(0x1a4)]+_0xf4021a(0x165)+_0xf4021a(0x197)+_0x50c397[_0x670864][_0xf4021a(0x16c)]+'</td>'+_0xf4021a(0x197)+_0x11394b[_0xf4021a(0x186)]+_0xf4021a(0x165)+_0xf4021a(0x197)+_0x50c397[_0x670864][_0xf4021a(0x180)]+'</td>'+_0xf4021a(0x197)+_0x59eca3+_0x50c397[_0x670864][_0xf4021a(0x14c)]+'</td>'+'</tr>';}_0x5e1e46[_0xf4021a(0x103)]('success',_0xf4021a(0x17c)),_0x37773d[_0xf4021a(0x139)](_0xf4021a(0x156)+_0x4b9881['_id']);}catch(_0x28d876){console['error'](_0x28d876),_0x37773d['status'](0x1f4)['json']({'error':_0xf4021a(0x110)});}})['catch'](_0x2713eb=>{var _0x2536d7=_0x1737d2;console[_0x2536d7(0x15d)](_0x2713eb),_0x37773d[_0x2536d7(0x144)](0x1f4)[_0x2536d7(0x127)]({'error':'An\x20error\x20occurred.'});});}catch(_0x51bcfc){_0x37773d[_0x1737d2(0x127)]({'message':_0x51bcfc[_0x1737d2(0x177)]});}}),router['get']('/view/:id',auth,async(_0x31522f,_0x5be42b)=>{var _0x5a0409=a0_0x5efb4a;try{const {username:_0x2c872d,email:_0x2a1822,role:_0x194913}=_0x31522f[_0x5a0409(0xfc)],_0x4e4b6e=_0x31522f['user'],_0x150831=await profile[_0x5a0409(0x135)]({'email':_0x4e4b6e[_0x5a0409(0x169)]}),_0x2fbf12=await master_shop[_0x5a0409(0x122)]();console['log'](_0x5a0409(0x189),_0x2fbf12);const _0x309242=_0x31522f[_0x5a0409(0x14d)]['id'],_0xf368d1=await adjustment_finished[_0x5a0409(0x12f)]({'_id':_0x309242});let _0x43edb5=new Date(_0xf368d1['expiry_date']),_0x1b2823=('0'+_0x43edb5['getDate']())['slice'](-0x2),_0x4fcae4=('0'+(_0x43edb5[_0x5a0409(0x115)]()+0x1))['slice'](-0x2),_0x278698=_0x43edb5['getFullYear'](),_0x48f51b=_0x278698+'-'+_0x4fcae4+'-'+_0x1b2823;var _0xb81d18=['Ambient',_0x5a0409(0x18f),_0x5a0409(0x151)];const _0xf65210=await purchases['aggregate']([{'$match':{'warehouse_name':_0xf368d1[_0x5a0409(0x186)]}},{'$unwind':_0x5a0409(0x1a5)},{'$group':{'_id':_0x5a0409(0x102)}}]);console[_0x5a0409(0x146)](_0x5a0409(0x137),_0xf65210);const _0x434e02=await product['find']({}),_0xc891bc=await warehouse[_0x5a0409(0x17d)]([{'$match':{'name':_0xf368d1[_0x5a0409(0x186)],'room':_0xf368d1[_0x5a0409(0x16b)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5a0409(0x13d)},'product_stock':{'$first':_0x5a0409(0x13c)},'bay':{'$first':_0x5a0409(0x119)},'bin':{'$first':_0x5a0409(0xfe)},'type':{'$first':_0x5a0409(0x17e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5a0409(0x160)},'secondary_code':{'$first':_0x5a0409(0x17b)},'product_code':{'$first':_0x5a0409(0x16d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5a0409(0x19d)}}}]);if(_0x2fbf12[0x0]['language']==_0x5a0409(0x10c)){var _0x702a91=users[_0x5a0409(0x1a1)];console[_0x5a0409(0x146)](_0x702a91);}else{if(_0x2fbf12[0x0][_0x5a0409(0x195)]==_0x5a0409(0x19c))var _0x702a91=users[_0x5a0409(0x19c)];else{if(_0x2fbf12[0x0][_0x5a0409(0x195)]==_0x5a0409(0x159))var _0x702a91=users[_0x5a0409(0x159)];else{if(_0x2fbf12[0x0]['language']=='Spanish')var _0x702a91=users[_0x5a0409(0x12e)];else{if(_0x2fbf12[0x0][_0x5a0409(0x195)]=='French')var _0x702a91=users[_0x5a0409(0x15b)];else{if(_0x2fbf12[0x0]['language']==_0x5a0409(0x15a))var _0x702a91=users[_0x5a0409(0x181)];else{if(_0x2fbf12[0x0][_0x5a0409(0x195)]==_0x5a0409(0x15f))var _0x702a91=users[_0x5a0409(0x15f)];else{if(_0x2fbf12[0x0][_0x5a0409(0x195)]==_0x5a0409(0x19b))var _0x702a91=users[_0x5a0409(0x153)];}}}}}}}_0x5be42b[_0x5a0409(0x11e)]('edit_adjustment_finished',{'success':_0x31522f['flash'](_0x5a0409(0x179)),'errors':_0x31522f[_0x5a0409(0x103)]('errors'),'role':_0x4e4b6e,'profile':_0x150831,'adjustment':_0xf368d1,'stock':_0xc891bc,'master_shop':_0x2fbf12,'warehouse_name':_0xf65210,'unit':_0x434e02,'language':_0x702a91,'rooms_data':_0xb81d18,'ed_fullDate':_0x48f51b});}catch(_0xf64ee9){console[_0x5a0409(0x146)](_0xf64ee9),_0x5be42b[_0x5a0409(0x144)](0xc8)[_0x5a0409(0x127)]({'message':_0xf64ee9[_0x5a0409(0x177)]});}}),router[a0_0x5efb4a(0x124)](a0_0x5efb4a(0xf9),auth,async(_0x50036c,_0x5d3b15)=>{var _0x37eaea=a0_0x5efb4a;try{const _0x2ce588=_0x50036c[_0x37eaea(0x14d)]['id'],_0xf5989c=await adjustment_finished[_0x37eaea(0x12f)]({'_id':_0x2ce588}),_0x5923f3=await warehouse[_0x37eaea(0x135)]({'name':_0xf5989c['warehouse_name'],'room':_0xf5989c[_0x37eaea(0x16b)]}),{warehouse_name:_0x2dc817,date:_0x970e40,prod_name:_0x4989c5,level:_0x47a9e5,isle:_0x3b5172,pallet:_0x1755ef,stock:_0x51a8ac,types:_0x11d8ad,adjust_qty:_0x54f7eb,new_adjust_qty:_0x4120a9,note:_0x5d3e1e,Room_name:_0xf02c75,invoice:_0x39ce72,JO_number:_0xed5476}=_0x50036c[_0x37eaea(0x167)];if(typeof _0x4989c5=='string')var _0x1a6b67=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x173)]],_0x283d98=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x14e)]],_0x5709ba=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x152)]],_0x23e790=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x116)]],_0x397f28=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x14b)]],_0x10c33a=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x136)]],_0x428e63=[_0x50036c['body'][_0x37eaea(0x19a)]],_0x21b68d=[_0x50036c['body'][_0x37eaea(0x1a4)]],_0x58f0de=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x187)]],_0x1c8a17=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x113)]],_0x51b265=[_0x50036c[_0x37eaea(0x167)][_0x37eaea(0x133)]];else var _0x1a6b67=[..._0x50036c['body']['prod_name']],_0x283d98=[..._0x50036c['body'][_0x37eaea(0x14e)]],_0x5709ba=[..._0x50036c['body'][_0x37eaea(0x152)]],_0x23e790=[..._0x50036c[_0x37eaea(0x167)][_0x37eaea(0x116)]],_0x397f28=[..._0x50036c['body'][_0x37eaea(0x14b)]],_0x10c33a=[..._0x50036c[_0x37eaea(0x167)][_0x37eaea(0x136)]],_0x428e63=[..._0x50036c[_0x37eaea(0x167)][_0x37eaea(0x19a)]],_0x21b68d=[..._0x50036c['body'][_0x37eaea(0x1a4)]],_0x58f0de=[..._0x50036c[_0x37eaea(0x167)][_0x37eaea(0x187)]],_0x1c8a17=[..._0x50036c[_0x37eaea(0x167)][_0x37eaea(0x113)]],_0x51b265=[..._0x50036c[_0x37eaea(0x167)][_0x37eaea(0x133)]];const _0xe5c185=_0x1a6b67[_0x37eaea(0x101)](_0x2f5e7d=>{return _0x2f5e7d={'product_name':_0x2f5e7d};});_0x283d98[_0x37eaea(0x107)]((_0x38d425,_0x230f4b)=>{var _0x407fcd=_0x37eaea;_0xe5c185[_0x230f4b][_0x407fcd(0x14c)]=_0x38d425;}),_0x5709ba[_0x37eaea(0x107)]((_0xacb093,_0x4b7240)=>{var _0x2b65ce=_0x37eaea;_0xe5c185[_0x4b7240][_0x2b65ce(0x128)]=_0xacb093;}),_0x23e790[_0x37eaea(0x107)]((_0xb055f,_0x102bb6)=>{var _0x5571e7=_0x37eaea;_0xe5c185[_0x102bb6][_0x5571e7(0x116)]=_0xb055f;}),_0x397f28[_0x37eaea(0x107)]((_0x51d0a2,_0x5a404d)=>{_0xe5c185[_0x5a404d]['adjust_qty']=_0x51d0a2;}),_0x10c33a['forEach']((_0x55e2c6,_0x4793c6)=>{_0xe5c185[_0x4793c6]['new_adjust_qty']=_0x55e2c6;}),_0x21b68d[_0x37eaea(0x107)]((_0x1b3abc,_0x171666)=>{_0xe5c185[_0x171666]['unit']=_0x1b3abc;}),_0x58f0de[_0x37eaea(0x107)]((_0x409db9,_0x13a6df)=>{_0xe5c185[_0x13a6df]['secondary_unit']=_0x409db9;}),_0x428e63[_0x37eaea(0x107)]((_0xbed91,_0x2bdd1b)=>{var _0x4ce170=_0x37eaea;_0xe5c185[_0x2bdd1b][_0x4ce170(0x155)]=_0xbed91;}),_0x1c8a17[_0x37eaea(0x107)]((_0x4b83e9,_0x4024c8)=>{_0xe5c185[_0x4024c8]['batch_code']=_0x4b83e9;}),_0x51b265[_0x37eaea(0x107)]((_0x436679,_0x489c35)=>{var _0xeb5949=_0x37eaea;_0xe5c185[_0x489c35][_0xeb5949(0x133)]=_0x436679;});const _0x3e34cf=_0xe5c185[_0x37eaea(0x166)](_0x4373ed=>_0x4373ed[_0x37eaea(0x14b)]!=='0'&&_0x4373ed[_0x37eaea(0x14b)]!=='');var _0x39aaf6=0x0;_0x3e34cf[_0x37eaea(0x107)](_0x13408a=>{var _0x181e1f=_0x37eaea;console[_0x181e1f(0x146)](_0x181e1f(0x111),_0x13408a),parseInt(_0x13408a[_0x181e1f(0x14b)])<=0x0&&_0x39aaf6++;});if(_0x39aaf6!=0x0)return _0x50036c[_0x37eaea(0x103)](_0x37eaea(0xfd),_0x37eaea(0x108)),_0x5d3b15['redirect'](_0x37eaea(0x12a));_0xf5989c[_0x37eaea(0x186)]=_0x2dc817,_0xf5989c[_0x37eaea(0x175)]=_0x970e40,_0xf5989c[_0x37eaea(0x183)]=_0x3e34cf,_0xf5989c['note']=_0x5d3e1e,_0xf5989c[_0x37eaea(0x16b)]=_0xf02c75,_0xf5989c[_0x37eaea(0x14a)]=_0x39ce72,_0xf5989c[_0x37eaea(0x11b)]=_0xed5476;const _0x48b86c=await _0xf5989c['save'](),_0x2f55d8=await warehouse[_0x37eaea(0x135)]({'name':_0x2dc817,'room':_0xf02c75});_0x48b86c[_0x37eaea(0x183)][_0x37eaea(0x107)](_0x24aad4=>{var _0x5391ee=_0x37eaea;const _0x39328e=_0x2f55d8[_0x5391ee(0x138)][_0x5391ee(0x101)](_0x13b86e=>{var _0x4a064b=_0x5391ee;_0x24aad4[_0x4a064b(0x116)]==_0x4a064b(0x140)?_0x13b86e[_0x4a064b(0x104)]==_0x24aad4[_0x4a064b(0x104)]&&_0x13b86e['bay']==_0x24aad4[_0x4a064b(0x14c)]&&(_0x13b86e[_0x4a064b(0x163)]=parseInt(_0x13b86e['product_stock'])-parseInt(_0x24aad4[_0x4a064b(0x14b)])):_0x13b86e[_0x4a064b(0x104)]==_0x24aad4[_0x4a064b(0x104)]&&_0x13b86e['bay']==_0x24aad4[_0x4a064b(0x14c)]&&(_0x13b86e[_0x4a064b(0x163)]=parseInt(_0x13b86e['product_stock'])+parseInt(_0x24aad4[_0x4a064b(0x14b)]));});}),await _0x2f55d8[_0x37eaea(0x17f)](),_0x50036c['flash']('success',_0x37eaea(0x112)),_0x5d3b15[_0x37eaea(0x139)](_0x37eaea(0x148));}catch(_0x5a228e){console[_0x37eaea(0x146)](_0x5a228e);}}),router[a0_0x5efb4a(0x124)](a0_0x5efb4a(0x19f),async(_0x32b8a1,_0x26ddf2)=>{var _0x457593=a0_0x5efb4a;const {primary_code:_0x9f37cd,warehouse_data:_0x2c2988,rooms_data:_0x5d44a4,Roomslist:_0x501cf3}=_0x32b8a1[_0x457593(0x167)],_0xbef07d=_0x501cf3[_0x457593(0x126)](','),_0x9ef8ac=[];async function _0x2d40af(_0x3f2937){var _0x1ecc3b=_0x457593;const _0x587493=await warehouse[_0x1ecc3b(0x17d)]([{'$match':{'name':_0x2c2988,'room':_0x3f2937}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x9f37cd}},{'$group':{'_id':_0x1ecc3b(0x158),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1ecc3b(0x160)},'secondary_code':{'$first':_0x1ecc3b(0x17b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1ecc3b(0x17a)},'bay':{'$first':_0x1ecc3b(0x119)},'type':{'$first':_0x1ecc3b(0x17e)},'pallet':{'$first':_0x1ecc3b(0x12d)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1ecc3b(0x196)},'storage':{'$first':_0x1ecc3b(0x18c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1ecc3b(0x16f)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1ecc3b(0x145)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x1ecc3b(0x170)},'roomNamed':{'$first':_0x1ecc3b(0x172)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x1cb9da=await warehouse[_0x1ecc3b(0x17d)]([{'$match':{'name':_0x2c2988,'room':_0x3f2937}},{'$unwind':_0x1ecc3b(0x120)},{'$match':{'product_details.secondary_code':_0x9f37cd}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1ecc3b(0x13d)},'product_stock':{'$first':_0x1ecc3b(0x13c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1ecc3b(0x17b)},'product_code':{'$first':_0x1ecc3b(0x16d)},'level':{'$first':_0x1ecc3b(0x17a)},'bay':{'$first':_0x1ecc3b(0x119)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1ecc3b(0x12d)},'unit':{'$first':_0x1ecc3b(0x13b)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1ecc3b(0x18c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1ecc3b(0xf8)},'batch_code':{'$first':_0x1ecc3b(0x145)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x1ecc3b(0x170)},'roomNamed':{'$first':_0x1ecc3b(0x172)},'invoice':{'$first':_0x1ecc3b(0x10e)}}}]);if(_0x587493['length']>0x0)_0x9ef8ac[_0x1ecc3b(0x143)](_0x587493);else _0x1cb9da[_0x1ecc3b(0x18e)]>0x0&&_0x9ef8ac['push'](_0x1cb9da);}const _0x550915=_0xbef07d[_0x457593(0x101)](_0x4a6a21=>_0x2d40af(_0x4a6a21));await Promise[_0x457593(0x192)](_0x550915),_0x26ddf2[_0x457593(0x127)](_0x9ef8ac);}),router['post'](a0_0x5efb4a(0x188),async(_0x5ac7e8,_0x25a157)=>{var _0x46fe47=a0_0x5efb4a;const {productCode:_0x357787,bay:_0x3f7c3e,warehouses:_0x5d0fbc,room:_0x1e5f12}=_0x5ac7e8[_0x46fe47(0x167)];console['log'](_0x5ac7e8['body']);try{const _0x531da3=await warehouse[_0x46fe47(0x17d)]([{'$match':{'name':_0x5d0fbc,'room':_0x1e5f12}},{'$unwind':_0x46fe47(0x120)},{'$match':{'product_details.bay':parseInt(_0x3f7c3e)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x46fe47(0x13d)},'product_stock':{'$first':_0x46fe47(0x13c)},'bay':{'$first':_0x46fe47(0x119)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x25a157['status'](0xc8)[_0x46fe47(0x127)](_0x531da3);}catch(_0x304929){_0x25a157[_0x46fe47(0x144)](0x194)[_0x46fe47(0x127)]({'message':_0x304929[_0x46fe47(0x177)]});}}),module[a0_0x5efb4a(0x182)]=router;