function a0_0x596a(){var _0x5e435a=['35aDQdSh','match','success','product_code','body','Rooms','Spanish','email','../middleware/auth','$room','117704BpDLHt','/barcode_scanner','New_Qty_Converted','product_name','batch_code','$product_details.product_name','stockBefore','error','secondary_unit','../public/language/languages.json','2388722rGuZIR','stock','aggregate','18hfYCvb','bay','json','catch','product_date','$product_details.product_code','new_adjust_qty','production_date','Adjustment\x20Finalize\x20Successfully','Portuguese\x20(BR)','split','Portuguese','$product_details._id','New_Qty_Converted_adj','flash','$product_details.level','/view_logs','length','Arabic\x20(ae)','message','$product_details.expiry_date','Secondary_units','staff','$product_details.rack','$product_details.bay','invoice','$product_details.production_date','redirect','slice','user','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.product_name','</tr>','ADJF-','foreach\x20newproduct','minus','own','$product_details.storage','log','prod_name','$product_details.maxPerUnit','$product.room_names','product_details','Enabled','add_adjustment_finished','all','render','adjustment\x20add\x20successfull','An\x20error\x20occurred.','product_stock','get','id_transaction_from','</td>','$date','unit','$product_details.product_stock','Ambient','nodemailer','post','ADJ-','$product_details.bin','$product','room','findOne','back','map','/adjustment_finished/view','/CheckingWarehouse','maxPerUnit','1506894xOKJne','add','$product_details.invoice','Primary_Units','random','_id','23782XZdpBF','648104MOBAZq','$product_details.batch_code','Hindi','$product_details.type','warehouse_name','$product_details.secondary_unit','True','types','save','English\x20(US)','getFullYear','prod_cat','$product_details.secondary_code','3234540uJUEUf','filter','prod_invoice','/view','adjustment_finished','44ebHkIb','prod_code','getDate','There\x27s\x20a\x20error\x20in\x20this\x20transaction','English','$_id','LOG-ADJ-','level','find','errors','$product_details.primary_code','edit_adjustment_finished','$product_details.floorlevel','$name','padStart','product','note','findById','floor','$invoice','/adjustment_finished/preview/','invoice_init','../models/all_models','exports','/picking_list/PDF_adjustmentFinal/','status','French','adjust_qty','push','Chinese','warehouse','forEach','/preview/:id','Arabic','add_adjustment_finished_logs','German','/view/add_adjustment','/adjustment/view','getMonth','$warehouse_name','5157140nGkMLM','Enclosed','params','$product_details.unit','id_transaction','role','$product_details','/view/:id','room_names','expiry_date','language','toString','Return\x20Rooms','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'];a0_0x596a=function(){return _0x5e435a;};return a0_0x596a();}var a0_0x1b5823=a0_0xf42d;(function(_0x2b49e7,_0x568c5d){var _0x286a66=a0_0xf42d,_0x25e71e=_0x2b49e7();while(!![]){try{var _0x11ca0b=parseInt(_0x286a66(0x1f3))/0x1*(parseInt(_0x286a66(0x1e0))/0x2)+-parseInt(_0x286a66(0x1da))/0x3+-parseInt(_0x286a66(0x233))/0x4*(parseInt(_0x286a66(0x229))/0x5)+parseInt(_0x286a66(0x1ee))/0x6+-parseInt(_0x286a66(0x23d))/0x7+-parseInt(_0x286a66(0x1e1))/0x8*(parseInt(_0x286a66(0x240))/0x9)+parseInt(_0x286a66(0x21b))/0xa;if(_0x11ca0b===_0x568c5d)break;else _0x25e71e['push'](_0x25e71e['shift']());}catch(_0x3cfc7a){_0x25e71e['push'](_0x25e71e['shift']());}}}(a0_0x596a,0x59778));const express=require('express'),app=express(),router=express['Router'](),auth=require(a0_0x1b5823(0x231)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x1b5823(0x209)),users=require(a0_0x1b5823(0x23c)),nodemailer=require(a0_0x1b5823(0x1ce));router[a0_0x1b5823(0x1c7)](a0_0x1b5823(0x1f1),auth,async(_0x5b3a8b,_0x957ab8)=>{var _0x546b66=a0_0x1b5823;try{const {username:_0x1d88c3,email:_0x56d332,role:_0x348555}=_0x5b3a8b[_0x546b66(0x25d)],_0x437f4a=_0x5b3a8b[_0x546b66(0x25d)],_0x1a28dd=await profile[_0x546b66(0x1d4)]({'email':_0x437f4a[_0x546b66(0x230)]}),_0xa40639=await master_shop[_0x546b66(0x1fb)]();let _0x298e25;if(_0x437f4a[_0x546b66(0x220)]=='staff'){const _0x543fa1=await staff[_0x546b66(0x1d4)]({'email':_0x437f4a[_0x546b66(0x230)]});_0x298e25=await warehouse[_0x546b66(0x1fb)]({'status':_0x546b66(0x1c0),'name':_0x543fa1[_0x546b66(0x211)]});}else _0x298e25=await warehouse[_0x546b66(0x1fb)]({'status':_0x546b66(0x1c0)});const _0x3fac10=await product['find']();let _0x5c4905;if(_0x437f4a[_0x546b66(0x220)]==_0x546b66(0x256)){const _0x1440e3=await staff['findOne']({'email':_0x437f4a[_0x546b66(0x230)]});_0x5c4905=await adjustment_finished[_0x546b66(0x1fb)]({'warehouse_name':_0x1440e3['warehouse']});}else _0x5c4905=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x546b66(0x1b9)}},{'$unwind':_0x546b66(0x1d2)},{'$group':{'_id':_0x546b66(0x1f8),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x546b66(0x21a)},'room':{'$addToSet':_0x546b66(0x1be)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xa40639[0x0][_0x546b66(0x225)]==_0x546b66(0x1ea)){var _0xcd157e=users[_0x546b66(0x1f7)];console['log'](_0xcd157e);}else{if(_0xa40639[0x0]['language']==_0x546b66(0x1e3))var _0xcd157e=users[_0x546b66(0x1e3)];else{if(_0xa40639[0x0]['language']==_0x546b66(0x216))var _0xcd157e=users[_0x546b66(0x216)];else{if(_0xa40639[0x0][_0x546b66(0x225)]==_0x546b66(0x22f))var _0xcd157e=users[_0x546b66(0x22f)];else{if(_0xa40639[0x0][_0x546b66(0x225)]==_0x546b66(0x20d))var _0xcd157e=users[_0x546b66(0x20d)];else{if(_0xa40639[0x0][_0x546b66(0x225)]=='Portuguese\x20(BR)')var _0xcd157e=users['Portuguese'];else{if(_0xa40639[0x0][_0x546b66(0x225)]==_0x546b66(0x210))var _0xcd157e=users[_0x546b66(0x210)];else{if(_0xa40639[0x0][_0x546b66(0x225)]==_0x546b66(0x252))var _0xcd157e=users[_0x546b66(0x214)];}}}}}}}_0x957ab8['render'](_0x546b66(0x1f2),{'success':_0x5b3a8b[_0x546b66(0x24e)](_0x546b66(0x22b)),'errors':_0x5b3a8b['flash'](_0x546b66(0x1fc)),'role':_0x437f4a,'profile':_0x1a28dd,'warehouse':_0x298e25,'product':_0x3fac10,'adjustment':_0x5c4905,'master_shop':_0xa40639,'language':_0xcd157e});}catch(_0x368b0e){console[_0x546b66(0x1bb)](_0x368b0e);}}),router[a0_0x1b5823(0x1c7)](a0_0x1b5823(0x250),auth,async(_0x4a5737,_0x544744)=>{var _0x5ba774=a0_0x1b5823;try{const {username:_0x5f017e,email:_0x136e61,role:_0x5f30f2}=_0x4a5737[_0x5ba774(0x25d)],_0x32a4c6=_0x4a5737['user'],_0x439789=await profile[_0x5ba774(0x1d4)]({'email':_0x32a4c6[_0x5ba774(0x230)]}),_0x8bfca0=await master_shop[_0x5ba774(0x1fb)]();let _0x26e1c8;if(_0x32a4c6[_0x5ba774(0x220)]==_0x5ba774(0x256)){const _0x228cd8=await staff[_0x5ba774(0x1d4)]({'email':_0x32a4c6[_0x5ba774(0x230)]});_0x26e1c8=await warehouse[_0x5ba774(0x1fb)]({'status':_0x5ba774(0x1c0),'name':_0x228cd8[_0x5ba774(0x211)]});}else _0x26e1c8=await warehouse[_0x5ba774(0x1fb)]({'status':_0x5ba774(0x1c0)});const _0x1a57d5=await product[_0x5ba774(0x1fb)]();let _0x426b4e;if(_0x32a4c6[_0x5ba774(0x220)]==_0x5ba774(0x256)){const _0x126bfd=await staff[_0x5ba774(0x1d4)]({'email':_0x32a4c6[_0x5ba774(0x230)]});_0x426b4e=await adjustment_finished[_0x5ba774(0x1fb)]({'warehouse_name':_0x126bfd[_0x5ba774(0x211)]});}else _0x426b4e=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':'logs'}},{'$unwind':_0x5ba774(0x1d2)},{'$group':{'_id':_0x5ba774(0x1f8),'invoice':{'$first':_0x5ba774(0x206)},'date':{'$first':_0x5ba774(0x1ca)},'warehouse_name':{'$first':_0x5ba774(0x21a)},'room':{'$addToSet':_0x5ba774(0x1be)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x1ea))var _0x1bec6f=users[_0x5ba774(0x1f7)];else{if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x1e3))var _0x1bec6f=users[_0x5ba774(0x1e3)];else{if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x216))var _0x1bec6f=users[_0x5ba774(0x216)];else{if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x22f))var _0x1bec6f=users[_0x5ba774(0x22f)];else{if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x20d))var _0x1bec6f=users[_0x5ba774(0x20d)];else{if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x249))var _0x1bec6f=users['Portuguese'];else{if(_0x8bfca0[0x0][_0x5ba774(0x225)]==_0x5ba774(0x210))var _0x1bec6f=users['Chinese'];else{if(_0x8bfca0[0x0]['language']==_0x5ba774(0x252))var _0x1bec6f=users['Arabic'];}}}}}}}_0x544744[_0x5ba774(0x1c3)]('adjustment_finished_logs',{'success':_0x4a5737['flash'](_0x5ba774(0x22b)),'errors':_0x4a5737[_0x5ba774(0x24e)]('errors'),'role':_0x32a4c6,'profile':_0x439789,'warehouse':_0x26e1c8,'product':_0x1a57d5,'adjustment':_0x426b4e,'master_shop':_0x8bfca0,'language':_0x1bec6f});}catch(_0x4f5be0){console[_0x5ba774(0x1bb)](_0x4f5be0);}});async function getRandom8DigitNumber(){var _0xc55950=a0_0x1b5823;const _0x464d4b=0x989680,_0x4f390b=0x5f5e0ff,_0x1ba81d=Math[_0xc55950(0x205)](Math[_0xc55950(0x1de)]()*(_0x4f390b-_0x464d4b+0x1))+_0x464d4b;var _0x1d971b;const _0x85f717=await adjustment_finished['findOne']({'invoice':_0xc55950(0x261)+_0x1ba81d});return _0x85f717&&_0x85f717[_0xc55950(0x251)]>0x0?_0x1d971b=_0xc55950(0x261)+_0x1ba81d:_0x1d971b=_0xc55950(0x261)+_0x1ba81d,_0x1d971b;}function a0_0xf42d(_0x37fee3,_0x34592c){var _0x596a40=a0_0x596a();return a0_0xf42d=function(_0xf42d04,_0x17c9b8){_0xf42d04=_0xf42d04-0x1b7;var _0x462c81=_0x596a40[_0xf42d04];return _0x462c81;},a0_0xf42d(_0x37fee3,_0x34592c);}router[a0_0x1b5823(0x1c7)](a0_0x1b5823(0x217),auth,async(_0x544034,_0x38b29f)=>{var _0x3dac86=a0_0x1b5823;try{const {username:_0x5379ec,email:_0x48378b,role:_0x508734}=_0x544034[_0x3dac86(0x25d)],_0x5839d8=_0x544034[_0x3dac86(0x25d)],_0x655d7b=await profile[_0x3dac86(0x1d4)]({'email':_0x5839d8['email']}),_0x184453=await master_shop[_0x3dac86(0x1fb)]();let _0xc042e7;if(_0x5839d8[_0x3dac86(0x220)]==_0x3dac86(0x256)){const _0x34a136=await staff[_0x3dac86(0x1d4)]({'email':_0x5839d8['email']});_0xc042e7=await warehouse[_0x3dac86(0x23f)]([{'$match':{'status':'Enabled','name':_0x34a136[_0x3dac86(0x211)]}},{'$group':{'_id':_0x3dac86(0x200),'name':{'$first':_0x3dac86(0x200)}}}]);}else _0xc042e7=await warehouse[_0x3dac86(0x23f)]([{'$match':{'status':_0x3dac86(0x1c0)}},{'$group':{'_id':_0x3dac86(0x200),'name':{'$first':'$name'}}}]);const _0xbc6527=await product[_0x3dac86(0x1fb)]({}),_0x1b663f=await adjustment_finished[_0x3dac86(0x1fb)](),_0x53e1a2=_0x1b663f[_0x3dac86(0x251)]+0x1,_0x663453=_0x3dac86(0x261)+_0x53e1a2[_0x3dac86(0x226)]()[_0x3dac86(0x201)](0x5,'0');var _0x21cf33=[_0x3dac86(0x1cd),_0x3dac86(0x21c),'Return\x20Rooms'];if(_0x184453[0x0]['language']==_0x3dac86(0x1ea))var _0x72c509=users[_0x3dac86(0x1f7)];else{if(_0x184453[0x0][_0x3dac86(0x225)]==_0x3dac86(0x1e3))var _0x72c509=users['Hindi'];else{if(_0x184453[0x0][_0x3dac86(0x225)]=='German')var _0x72c509=users[_0x3dac86(0x216)];else{if(_0x184453[0x0][_0x3dac86(0x225)]=='Spanish')var _0x72c509=users[_0x3dac86(0x22f)];else{if(_0x184453[0x0][_0x3dac86(0x225)]==_0x3dac86(0x20d))var _0x72c509=users[_0x3dac86(0x20d)];else{if(_0x184453[0x0]['language']==_0x3dac86(0x249))var _0x72c509=users['Portuguese'];else{if(_0x184453[0x0][_0x3dac86(0x225)]==_0x3dac86(0x210))var _0x72c509=users[_0x3dac86(0x210)];else{if(_0x184453[0x0][_0x3dac86(0x225)]==_0x3dac86(0x252))var _0x72c509=users[_0x3dac86(0x214)];}}}}}}}const _0x57073e=getRandom8DigitNumber();_0x57073e['then'](_0x4e30b6=>{var _0x6a826c=_0x3dac86;_0x38b29f[_0x6a826c(0x1c3)](_0x6a826c(0x1c1),{'success':_0x544034[_0x6a826c(0x24e)](_0x6a826c(0x22b)),'errors':_0x544034[_0x6a826c(0x24e)](_0x6a826c(0x1fc)),'role':_0x5839d8,'profile':_0x655d7b,'warehouse':_0xc042e7,'product':_0xbc6527,'master_shop':_0x184453,'language':_0x72c509,'rooms_data':_0x21cf33,'invoice_no':_0x4e30b6});})['catch'](_0x39d2d9=>{var _0x5e9b46=_0x3dac86;_0x544034[_0x5e9b46(0x24e)](_0x5e9b46(0x1fc),_0x5e9b46(0x1f6)),_0x38b29f[_0x5e9b46(0x25b)]('/adjustment/view');});}catch(_0x1f2698){console[_0x3dac86(0x1bb)](_0x1f2698);}}),router[a0_0x1b5823(0x1cf)]('/view/add_adjustment',auth,async(_0x4aaf9e,_0x2f6e3f)=>{var _0x546dbf=a0_0x1b5823;try{const {warehouse_name:_0x1d730c,date:_0x1a64be,prod_name:_0x447e03,level:_0x256887,isle:_0x461949,pallet:_0x2f6637,stock:_0x4f1e18,types:_0x4457c1,adjust_qty:_0x587b85,new_adjust_qty:_0x208fc8,note:_0x269f07,Room_name:_0x2811e2,JO_number:_0x4f4b06,expiry_date:_0x1d9d65,PO_number:_0x38a9d5,ReqBy:_0x7787b7,dateofreq:_0x307d17,typeservicesData:_0x22debc,destination:_0x4b2590,deliverydate:_0x8374e7,driver:_0x1be5a7,plate:_0x37e87d,van:_0xe33eda,DRSI:_0x39c63c,typevehicle:_0x985a76,TSU:_0x562f3c,TFU:_0x2027de}=_0x4aaf9e[_0x546dbf(0x22d)];if(typeof _0x447e03=='string')var _0x1c10e1=[_0x4aaf9e[_0x546dbf(0x22d)]['prod_name']],_0x489083=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1fa)]],_0x2ec98c=[_0x4aaf9e[_0x546dbf(0x22d)]['stock']],_0x53ebbf=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1e8)]],_0x3b2568=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x24d)]],_0x33d80e=[_0x4aaf9e['body'][_0x546dbf(0x235)]],_0x1d76f7=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1dd)]],_0x562ed2=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x255)]],_0x533355=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1f4)]],_0x3ed31f=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x237)]],_0x5ec55b=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x224)]],_0x15b921=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x244)]],_0x3c0f38=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1ec)]],_0xc70f4d=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x22e)]],_0x53ef2a=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1d9)]],_0xdf49e0=[_0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1f0)]],_0x3517ff=[_0x4aaf9e['body']['id_transaction_from']];else var _0x1c10e1=[..._0x4aaf9e[_0x546dbf(0x22d)]['prod_name']],_0x489083=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1fa)]],_0x2ec98c=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x23e)]],_0x53ebbf=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1e8)]],_0x3b2568=[..._0x4aaf9e[_0x546dbf(0x22d)]['New_Qty_Converted_adj']],_0x33d80e=[..._0x4aaf9e['body'][_0x546dbf(0x235)]],_0x1d76f7=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1dd)]],_0x562ed2=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x255)]],_0x533355=[..._0x4aaf9e[_0x546dbf(0x22d)]['prod_code']],_0x3ed31f=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x237)]],_0x5ec55b=[..._0x4aaf9e['body']['expiry_date']],_0x15b921=[..._0x4aaf9e[_0x546dbf(0x22d)]['product_date']],_0x3c0f38=[..._0x4aaf9e['body']['prod_cat']],_0xc70f4d=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x22e)]],_0x53ef2a=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1d9)]],_0xdf49e0=[..._0x4aaf9e[_0x546dbf(0x22d)][_0x546dbf(0x1f0)]],_0x3517ff=[..._0x4aaf9e['body'][_0x546dbf(0x1c8)]];const _0x1efd41=_0x1c10e1[_0x546dbf(0x1d6)](_0x623a76=>{return _0x623a76={'product_name':_0x623a76};});_0x489083[_0x546dbf(0x212)]((_0x1debef,_0xe14193)=>{var _0x1b4452=_0x546dbf,_0x1a0930=_0x1debef[_0x1b4452(0x22a)](/[A-Za-z]+/)[0x0],_0x40033a=parseInt(_0x1debef[_0x1b4452(0x22a)](/\d+/)[0x0]);_0x1efd41[_0xe14193]['level']=_0x1a0930,_0x1efd41[_0xe14193]['bay']=_0x40033a;}),_0x3517ff[_0x546dbf(0x212)]((_0x1c5c7c,_0x2368b0)=>{var _0x2b1ae3=_0x546dbf;_0x1efd41[_0x2368b0][_0x2b1ae3(0x21f)]=_0x1c5c7c;}),_0x2ec98c[_0x546dbf(0x212)]((_0x1b7627,_0x2215f3)=>{var _0x1eadf5=_0x546dbf;_0x1efd41[_0x2215f3][_0x1eadf5(0x239)]=_0x1b7627;}),_0x53ebbf['forEach']((_0x256d42,_0x218c67)=>{var _0x413f7d=_0x546dbf;_0x1efd41[_0x218c67][_0x413f7d(0x1e8)]=_0x256d42;}),_0x3b2568[_0x546dbf(0x212)]((_0x258824,_0x2c25fa)=>{var _0x2a667c=_0x546dbf;_0x1efd41[_0x2c25fa][_0x2a667c(0x20e)]=_0x258824;}),_0x33d80e[_0x546dbf(0x212)]((_0x4d0324,_0x2e38f1)=>{var _0x2775a6=_0x546dbf;_0x1efd41[_0x2e38f1][_0x2775a6(0x246)]=_0x4d0324;}),_0x1d76f7[_0x546dbf(0x212)]((_0x49e21a,_0x1a015b)=>{var _0x326f37=_0x546dbf;_0x1efd41[_0x1a015b][_0x326f37(0x1cb)]=_0x49e21a;}),_0x562ed2[_0x546dbf(0x212)]((_0x371223,_0x1d18f6)=>{var _0x2c008f=_0x546dbf;_0x1efd41[_0x1d18f6][_0x2c008f(0x23b)]=_0x371223;}),_0x533355[_0x546dbf(0x212)]((_0x4a9a36,_0xef6db2)=>{var _0x4da4ac=_0x546dbf;_0x1efd41[_0xef6db2][_0x4da4ac(0x22c)]=_0x4a9a36;}),_0x3ed31f[_0x546dbf(0x212)]((_0x5dc187,_0x4f856d)=>{var _0x1a9bd9=_0x546dbf;_0x1efd41[_0x4f856d][_0x1a9bd9(0x237)]=_0x5dc187;}),_0x5ec55b[_0x546dbf(0x212)]((_0x11e805,_0x17f6da)=>{_0x1efd41[_0x17f6da]['expiry_date']=_0x11e805;}),_0x15b921[_0x546dbf(0x212)]((_0x4160db,_0x28b719)=>{var _0x51c0db=_0x546dbf;_0x1efd41[_0x28b719][_0x51c0db(0x247)]=_0x4160db;}),_0x3c0f38[_0x546dbf(0x212)]((_0x3e568f,_0x5276d2)=>{var _0x4255e0=_0x546dbf;_0x1efd41[_0x5276d2][_0x4255e0(0x1ec)]=_0x3e568f;}),_0xc70f4d[_0x546dbf(0x212)]((_0x1cee49,_0x209eba)=>{_0x1efd41[_0x209eba]['room_names']=_0x1cee49;}),_0x53ef2a['forEach']((_0xf33981,_0x2b6368)=>{var _0x2f668a=_0x546dbf;_0x1efd41[_0x2b6368][_0x2f668a(0x1d9)]=_0xf33981;}),_0xdf49e0['forEach']((_0x184e27,_0x59211d)=>{_0x1efd41[_0x59211d]['invoice']=_0x184e27;});const _0x266705=_0x1efd41[_0x546dbf(0x1ef)](_0xd95e5b=>_0xd95e5b[_0x546dbf(0x20e)]!=='0'&&_0xd95e5b[_0x546dbf(0x20e)]!=='');var _0x4ad968=0x0;_0x266705[_0x546dbf(0x212)](_0x3bb60d=>{var _0x5255c6=_0x546dbf;console[_0x5255c6(0x1bb)](_0x5255c6(0x1b7),_0x3bb60d),parseInt(_0x3bb60d['adjust_qty'])<=0x0&&_0x4ad968++;});if(_0x4ad968!=0x0)return _0x4aaf9e[_0x546dbf(0x24e)](_0x546dbf(0x1fc),_0x546dbf(0x228)),_0x2f6e3f[_0x546dbf(0x25b)]('back');const _0x397d0c=new invoice_for_adjustment();await _0x397d0c[_0x546dbf(0x1e9)]();const _0x22b061=new adjustment_finished({'warehouse_name':_0x1d730c,'date':_0x1a64be,'product':_0x266705,'note':_0x269f07,'room':_0x2811e2,'invoice':_0x546dbf(0x1d0)+_0x397d0c[_0x546dbf(0x208)][_0x546dbf(0x226)]()[_0x546dbf(0x201)](0x8,'0'),'JO_number':_0x4f4b06,'expiry_date':_0x1d9d65,'PO_number':_0x38a9d5,'RequestedBy':_0x7787b7,'DateofRequest':_0x307d17,'typeservices':_0x22debc,'destination':_0x4b2590,'deliverydate':_0x8374e7,'driver':_0x1be5a7,'plate':_0x37e87d,'van':_0xe33eda,'DRSI':_0x39c63c,'typevehicle':_0x985a76,'TSU':_0x562f3c,'TFU':_0x2027de}),_0x1d7b49=await _0x22b061[_0x546dbf(0x1e9)]();_0x4aaf9e['flash'](_0x546dbf(0x22b),_0x546dbf(0x1c4)),_0x2f6e3f[_0x546dbf(0x25b)](_0x546dbf(0x207)+_0x1d7b49[_0x546dbf(0x1df)]);}catch(_0x4e7db5){console[_0x546dbf(0x1bb)](_0x4e7db5),_0x2f6e3f[_0x546dbf(0x20c)](0xc8)['json']({'message':_0x4e7db5[_0x546dbf(0x253)]});}}),router[a0_0x1b5823(0x1c7)]('/view/add_adjustment_logs',auth,async(_0x1d0859,_0x2fae3b)=>{var _0x4fcd5e=a0_0x1b5823;try{const {username:_0x97dde6,email:_0xe35299,role:_0x5638bc}=_0x1d0859['user'],_0x7b44c4=_0x1d0859[_0x4fcd5e(0x25d)],_0x298e47=await profile[_0x4fcd5e(0x1d4)]({'email':_0x7b44c4['email']}),_0x420bff=await master_shop['find']();let _0x4d8c53;if(_0x7b44c4[_0x4fcd5e(0x220)]=='staff'){const _0x36055a=await staff[_0x4fcd5e(0x1d4)]({'email':_0x7b44c4[_0x4fcd5e(0x230)]});_0x4d8c53=await warehouse[_0x4fcd5e(0x23f)]([{'$match':{'status':_0x4fcd5e(0x1c0),'name':_0x36055a[_0x4fcd5e(0x211)]}},{'$group':{'_id':_0x4fcd5e(0x200),'name':{'$first':'$name'}}}]);}else _0x4d8c53=await warehouse[_0x4fcd5e(0x23f)]([{'$match':{'status':_0x4fcd5e(0x1c0)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0xc1586c=await product[_0x4fcd5e(0x1fb)](),_0x2448c3=await adjustment_finished[_0x4fcd5e(0x1fb)](),_0x2ad9bc=_0x2448c3['length']+0x1,_0x7404db='ADJF-'+_0x2ad9bc[_0x4fcd5e(0x226)]()[_0x4fcd5e(0x201)](0x5,'0');var _0x1a913d=[_0x4fcd5e(0x1cd),'Enclosed',_0x4fcd5e(0x227)];if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x1ea))var _0x2f69d1=users[_0x4fcd5e(0x1f7)];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x1e3))var _0x2f69d1=users[_0x4fcd5e(0x1e3)];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x216))var _0x2f69d1=users[_0x4fcd5e(0x216)];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]=='Spanish')var _0x2f69d1=users[_0x4fcd5e(0x22f)];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x20d))var _0x2f69d1=users['French'];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x249))var _0x2f69d1=users[_0x4fcd5e(0x24b)];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x210))var _0x2f69d1=users['Chinese'];else{if(_0x420bff[0x0][_0x4fcd5e(0x225)]==_0x4fcd5e(0x252))var _0x2f69d1=users[_0x4fcd5e(0x214)];}}}}}}}const _0x1bfd77=getRandom8DigitNumber();_0x1bfd77['then'](_0x2bdbf5=>{var _0x1e25df=_0x4fcd5e;_0x2fae3b['render'](_0x1e25df(0x215),{'success':_0x1d0859[_0x1e25df(0x24e)]('success'),'errors':_0x1d0859[_0x1e25df(0x24e)](_0x1e25df(0x1fc)),'role':_0x7b44c4,'profile':_0x298e47,'warehouse':_0x4d8c53,'product':_0xc1586c,'master_shop':_0x420bff,'language':_0x2f69d1,'rooms_data':_0x1a913d,'invoice_no':_0x2bdbf5});})[_0x4fcd5e(0x243)](_0xd58e35=>{var _0x15abba=_0x4fcd5e;_0x1d0859[_0x15abba(0x24e)](_0x15abba(0x1fc),_0x15abba(0x1f6)),_0x2fae3b[_0x15abba(0x25b)](_0x15abba(0x218));});}catch(_0x111dd4){console['log'](_0x111dd4);}}),router[a0_0x1b5823(0x1cf)]('/view/add_adjustment_logs',auth,async(_0xf3ba14,_0x19f0e1)=>{var _0x48466d=a0_0x1b5823;try{const {warehouse_name:_0x23076f,date:_0xed54ae,prod_name:_0x4993f8,level:_0x19c6ca,isle:_0x327d32,pallet:_0x20c1d3,stock:_0x274c8c,types:_0x487b68,adjust_qty:_0x579b59,new_adjust_qty:_0x1da8d8,note:_0x37ee57,Room_name:_0x5736eb,JO_number:_0x24f042,expiry_date:_0x3e3cf6,type_of_transaction:_0x2c40d9,PO_number:_0x44c15c,ReqBy:_0x165c55,dateofreq:_0x5126ca,typeservicesData:_0x564a1b,destination:_0x1d2452,deliverydate:_0x316bda,driver:_0x288fa4,plate:_0x26e635,van:_0x393b7b,DRSI:_0x36efc6,typevehicle:_0x42f1b2,TSU:_0x319f03,TFU:_0x2c5e21}=_0xf3ba14[_0x48466d(0x22d)];if(typeof _0x4993f8=='string')var _0x392e34=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1bc)]],_0x5a99c4=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1fa)]],_0x5827a8=[_0xf3ba14[_0x48466d(0x22d)]['stock']],_0x2b3dee=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1e8)]],_0x2fb889=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x24d)]],_0x26f4fb=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x235)]],_0x191360=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1dd)]],_0x4f9dc4=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x255)]],_0x682a57=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1f4)]],_0x4365f3=[_0xf3ba14[_0x48466d(0x22d)]['batch_code']],_0x16ba2f=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x224)]],_0x380987=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x244)]],_0x10394e=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1ec)]],_0x59dfe2=[_0xf3ba14[_0x48466d(0x22d)]['Rooms']],_0x1d886d=[_0xf3ba14['body'][_0x48466d(0x1d9)]],_0x38cb74=[_0xf3ba14[_0x48466d(0x22d)]['prod_invoice']],_0x177c65=[_0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1c8)]];else var _0x392e34=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1bc)]],_0x5a99c4=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1fa)]],_0x5827a8=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x23e)]],_0x2b3dee=[..._0xf3ba14['body'][_0x48466d(0x1e8)]],_0x2fb889=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x24d)]],_0x26f4fb=[..._0xf3ba14['body'][_0x48466d(0x235)]],_0x191360=[..._0xf3ba14[_0x48466d(0x22d)]['Primary_Units']],_0x4f9dc4=[..._0xf3ba14['body'][_0x48466d(0x255)]],_0x682a57=[..._0xf3ba14[_0x48466d(0x22d)]['prod_code']],_0x4365f3=[..._0xf3ba14[_0x48466d(0x22d)]['batch_code']],_0x16ba2f=[..._0xf3ba14[_0x48466d(0x22d)]['expiry_date']],_0x380987=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x244)]],_0x10394e=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1ec)]],_0x59dfe2=[..._0xf3ba14['body'][_0x48466d(0x22e)]],_0x1d886d=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1d9)]],_0x38cb74=[..._0xf3ba14[_0x48466d(0x22d)][_0x48466d(0x1f0)]],_0x177c65=[..._0xf3ba14['body'][_0x48466d(0x1c8)]];const _0x516f41=_0x392e34['map'](_0x4aaeb1=>{return _0x4aaeb1={'product_name':_0x4aaeb1};});_0x5a99c4['forEach']((_0x11a28e,_0x822c6a)=>{var _0x5b711e=_0x48466d,_0x1771b1=_0x11a28e[_0x5b711e(0x22a)](/[A-Za-z]+/)[0x0],_0x575d3d=parseInt(_0x11a28e['match'](/\d+/)[0x0]);_0x516f41[_0x822c6a]['level']=_0x1771b1,_0x516f41[_0x822c6a][_0x5b711e(0x241)]=_0x575d3d;}),_0x177c65[_0x48466d(0x212)]((_0x32341b,_0x56cd18)=>{var _0x5b558c=_0x48466d;_0x516f41[_0x56cd18][_0x5b558c(0x21f)]=_0x32341b;}),_0x5827a8[_0x48466d(0x212)]((_0x2dda14,_0x120fb2)=>{var _0x4e59ff=_0x48466d;_0x516f41[_0x120fb2][_0x4e59ff(0x239)]=_0x2dda14;}),_0x2b3dee[_0x48466d(0x212)]((_0x4bd16e,_0x3040fd)=>{var _0x591ca1=_0x48466d;_0x516f41[_0x3040fd][_0x591ca1(0x1e8)]=_0x4bd16e;}),_0x2fb889[_0x48466d(0x212)]((_0x2d3689,_0x566c0c)=>{var _0x4ee78d=_0x48466d;_0x516f41[_0x566c0c][_0x4ee78d(0x20e)]=_0x2d3689;}),_0x26f4fb[_0x48466d(0x212)]((_0x48ffab,_0x13c0eb)=>{_0x516f41[_0x13c0eb]['new_adjust_qty']=_0x48ffab;}),_0x191360[_0x48466d(0x212)]((_0x40034e,_0x5c3993)=>{_0x516f41[_0x5c3993]['unit']=_0x40034e;}),_0x4f9dc4[_0x48466d(0x212)]((_0x3e378f,_0x29a2f9)=>{var _0x2bb7a4=_0x48466d;_0x516f41[_0x29a2f9][_0x2bb7a4(0x23b)]=_0x3e378f;}),_0x682a57['forEach']((_0x8c2a1d,_0x3c9095)=>{var _0x3398f0=_0x48466d;_0x516f41[_0x3c9095][_0x3398f0(0x22c)]=_0x8c2a1d;}),_0x4365f3[_0x48466d(0x212)]((_0xc3ecf2,_0x5b13ed)=>{_0x516f41[_0x5b13ed]['batch_code']=_0xc3ecf2;}),_0x16ba2f[_0x48466d(0x212)]((_0x4441a4,_0x2b1e8d)=>{var _0x4ba7a1=_0x48466d;_0x516f41[_0x2b1e8d][_0x4ba7a1(0x224)]=_0x4441a4;}),_0x380987[_0x48466d(0x212)]((_0x5c598e,_0x923fb6)=>{_0x516f41[_0x923fb6]['production_date']=_0x5c598e;}),_0x10394e[_0x48466d(0x212)]((_0x477f67,_0x1aba8f)=>{var _0x482f1a=_0x48466d;_0x516f41[_0x1aba8f][_0x482f1a(0x1ec)]=_0x477f67;}),_0x59dfe2['forEach']((_0x3a442f,_0xc8ec25)=>{var _0x47c8ab=_0x48466d;_0x516f41[_0xc8ec25][_0x47c8ab(0x223)]=_0x3a442f;}),_0x1d886d['forEach']((_0x37cd5e,_0xec719a)=>{var _0x325b76=_0x48466d;_0x516f41[_0xec719a][_0x325b76(0x1d9)]=_0x37cd5e;}),_0x38cb74['forEach']((_0xcda88f,_0x38369a)=>{var _0x4a4508=_0x48466d;_0x516f41[_0x38369a][_0x4a4508(0x259)]=_0xcda88f;});const _0x389bbf=_0x516f41[_0x48466d(0x1ef)](_0x39063c=>_0x39063c['adjust_qty']!=='0'&&_0x39063c[_0x48466d(0x20e)]!=='');var _0xd741b8=0x0;_0x389bbf[_0x48466d(0x212)](_0x17fffa=>{var _0x38dfe6=_0x48466d;console[_0x38dfe6(0x1bb)](_0x38dfe6(0x1b7),_0x17fffa),parseInt(_0x17fffa[_0x38dfe6(0x20e)])<=0x0&&_0xd741b8++;});if(_0xd741b8!=0x0)return _0xf3ba14['flash'](_0x48466d(0x1fc),_0x48466d(0x228)),_0x19f0e1['redirect'](_0x48466d(0x1d5));const _0x2d7b70=new adjustment_logs();await _0x2d7b70['save']();const _0x12b401=new adjustment_finished({'warehouse_name':_0x23076f,'date':_0xed54ae,'product':_0x389bbf,'note':_0x37ee57,'room':_0x5736eb,'invoice':_0x48466d(0x1f9)+_0x2d7b70['invoice_init'][_0x48466d(0x226)]()[_0x48466d(0x201)](0x8,'0'),'JO_number':_0x24f042,'expiry_date':_0x3e3cf6,'type_of_transaction':_0x2c40d9,'PO_number':_0x44c15c,'RequestedBy':_0x165c55,'DateofRequest':_0x5126ca,'typeservices':_0x564a1b,'destination':_0x1d2452,'deliverydate':_0x316bda,'driver':_0x288fa4,'plate':_0x26e635,'van':_0x393b7b,'DRSI':_0x36efc6,'typevehicle':_0x42f1b2,'TSU':_0x319f03,'TFU':_0x2c5e21}),_0x1a99dc=await _0x12b401[_0x48466d(0x1e9)]();_0xf3ba14[_0x48466d(0x24e)](_0x48466d(0x22b),_0x48466d(0x1c4)),_0x19f0e1[_0x48466d(0x25b)](_0x48466d(0x207)+_0x1a99dc[_0x48466d(0x1df)]);}catch(_0x21957e){console[_0x48466d(0x1bb)](_0x21957e),_0x19f0e1[_0x48466d(0x20c)](0xc8)['json']({'message':_0x21957e[_0x48466d(0x253)]});}}),router[a0_0x1b5823(0x1c7)](a0_0x1b5823(0x213),auth,async(_0x1df3e9,_0x23da08)=>{var _0x1c7001=a0_0x1b5823;try{const {username:_0xcf5612,email:_0x2f95e9,role:_0x4ca606}=_0x1df3e9[_0x1c7001(0x25d)],_0x3869b0=_0x1df3e9[_0x1c7001(0x25d)],_0x109392=await profile['findOne']({'email':_0x3869b0['email']}),_0x47be3f=await master_shop[_0x1c7001(0x1fb)](),_0x44a7b3=_0x1df3e9['params']['id'],_0x38fca6=await adjustment_finished[_0x1c7001(0x204)]({'_id':_0x44a7b3}),_0x466508=await purchases['aggregate']([{'$match':{'warehouse_name':_0x38fca6[_0x1c7001(0x1e5)]}},{'$unwind':_0x1c7001(0x1d2)},{'$group':{'_id':_0x1c7001(0x25f)}}]);console[_0x1c7001(0x1bb)]('purchases_data',_0x466508);const _0x242d36=await product[_0x1c7001(0x1fb)]({}),_0x3d25cd=await warehouse[_0x1c7001(0x23f)]([{'$match':{'name':_0x38fca6[_0x1c7001(0x1e5)]}},{'$unwind':_0x1c7001(0x221)},{'$group':{'_id':_0x1c7001(0x24c),'name':{'$first':_0x1c7001(0x238)},'product_stock':{'$first':_0x1c7001(0x1cc)},'bay':{'$first':_0x1c7001(0x258)},'bin':{'$first':_0x1c7001(0x1d1)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1c7001(0x1ff)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1c7001(0x1ed)},'product_code':{'$first':_0x1c7001(0x245)},'storage':{'$first':_0x1c7001(0x1ba)},'rack':{'$first':_0x1c7001(0x257)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1c7001(0x25a)},'batch_code':{'$first':_0x1c7001(0x1e2)},'maxPerUnit':{'$first':_0x1c7001(0x1bd)},'room':{'$first':_0x1c7001(0x232)}}}]);if(_0x47be3f[0x0]['language']=='English\x20(US)'){var _0x246860=users['English'];console['log'](_0x246860);}else{if(_0x47be3f[0x0]['language']=='Hindi')var _0x246860=users[_0x1c7001(0x1e3)];else{if(_0x47be3f[0x0][_0x1c7001(0x225)]==_0x1c7001(0x216))var _0x246860=users['German'];else{if(_0x47be3f[0x0][_0x1c7001(0x225)]==_0x1c7001(0x22f))var _0x246860=users[_0x1c7001(0x22f)];else{if(_0x47be3f[0x0][_0x1c7001(0x225)]==_0x1c7001(0x20d))var _0x246860=users[_0x1c7001(0x20d)];else{if(_0x47be3f[0x0][_0x1c7001(0x225)]==_0x1c7001(0x249))var _0x246860=users[_0x1c7001(0x24b)];else{if(_0x47be3f[0x0]['language']==_0x1c7001(0x210))var _0x246860=users['Chinese'];else{if(_0x47be3f[0x0]['language']==_0x1c7001(0x252))var _0x246860=users[_0x1c7001(0x214)];}}}}}}}_0x23da08[_0x1c7001(0x1c3)]('edit_adjustment_finished_view',{'success':_0x1df3e9['flash'](_0x1c7001(0x22b)),'errors':_0x1df3e9['flash'](_0x1c7001(0x1fc)),'role':_0x3869b0,'profile':_0x109392,'adjustment':_0x38fca6,'stock':_0x3d25cd,'master_shop':_0x47be3f,'warehouse_name':_0x466508,'unit':_0x242d36,'language':_0x246860});}catch(_0x1b2625){console[_0x1c7001(0x1bb)](_0x1b2625),_0x23da08['status'](0xc8)['json']({'message':_0x1b2625[_0x1c7001(0x253)]});}}),router[a0_0x1b5823(0x1cf)]('/preview/:id',auth,async(_0x135f4e,_0xe6b87d)=>{var _0x3bb8a8=a0_0x1b5823;try{const {invoice:_0x1fe4db,warehouse_name:_0x27b4e0,Room_name:_0x5d9ea5}=_0x135f4e['body'],_0x5b7847=_0x135f4e[_0x3bb8a8(0x21d)]['id'],_0x573409=await adjustment_finished[_0x3bb8a8(0x204)]({'_id':_0x5b7847});var _0x191de8;const _0x22d0a3=_0x573409['product'][_0x3bb8a8(0x1d6)](async _0x41b589=>{var _0x28217a=_0x3bb8a8;if(_0x41b589[_0x28217a(0x20e)]>0x0){_0x191de8=await warehouse['findOne']({'name':_0x27b4e0,'room':_0x41b589[_0x28217a(0x223)]});const _0x142769=_0x191de8[_0x28217a(0x1bf)]['map'](_0x2a5d2f=>{var _0x3f525f=_0x28217a;console[_0x3f525f(0x1bb)](_0x41b589[_0x3f525f(0x1e8)]);if(_0x41b589[_0x3f525f(0x1e8)]==_0x3f525f(0x1b8))_0x2a5d2f[_0x3f525f(0x1df)]==_0x41b589['id_transaction']&&(_0x2a5d2f[_0x3f525f(0x1c6)]=_0x2a5d2f[_0x3f525f(0x1c6)]-_0x41b589[_0x3f525f(0x20e)]);else _0x41b589['types']==_0x3f525f(0x1db)&&(_0x2a5d2f[_0x3f525f(0x1df)]==_0x41b589[_0x3f525f(0x21f)]&&(_0x2a5d2f[_0x3f525f(0x1c6)]=_0x2a5d2f[_0x3f525f(0x1c6)]+_0x41b589[_0x3f525f(0x20e)]));});}return _0x191de8;});Promise[_0x3bb8a8(0x1c2)](_0x22d0a3)['then'](async _0x28c4f1=>{var _0x198ca4=_0x3bb8a8;try{for(const _0x245958 of _0x28c4f1){await _0x245958['save']();}_0x573409['finalize']=_0x198ca4(0x1e7);const _0x56fc6e=await _0x573409[_0x198ca4(0x1e9)](),_0x4ae6aa=await master_shop[_0x198ca4(0x1fb)](),_0x5da1da=await email_settings[_0x198ca4(0x1d4)](),_0x4f996e=await supervisor_settings[_0x198ca4(0x1fb)]();var _0x5b5996=_0x573409[_0x198ca4(0x202)],_0x51b575='',_0x3b2874;for(_0x3b2874 in _0x5b5996){var _0x1ad68a='FG';_0x573409[_0x198ca4(0x1e5)]=='DRY\x20GOODS'&&(_0x1ad68a='DG'),_0x51b575+='<tr>'+_0x198ca4(0x25e)+_0x5b5996[_0x3b2874][_0x198ca4(0x236)]+_0x198ca4(0x1c9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b5996[_0x3b2874]['product_code']+_0x198ca4(0x1c9)+_0x198ca4(0x25e)+_0x5b5996[_0x3b2874][_0x198ca4(0x20e)]+_0x198ca4(0x1c9)+_0x198ca4(0x25e)+_0x5b5996[_0x3b2874]['unit']+_0x198ca4(0x1c9)+_0x198ca4(0x25e)+_0x5b5996[_0x3b2874][_0x198ca4(0x23b)]+_0x198ca4(0x1c9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x573409[_0x198ca4(0x1e5)]+_0x198ca4(0x1c9)+_0x198ca4(0x25e)+_0x5b5996[_0x3b2874]['room_names']+'</td>'+_0x198ca4(0x25e)+_0x1ad68a+_0x5b5996[_0x3b2874][_0x198ca4(0x241)]+'</td>'+_0x198ca4(0x260);}_0x135f4e[_0x198ca4(0x24e)]('success',_0x198ca4(0x248)),_0xe6b87d[_0x198ca4(0x25b)](_0x198ca4(0x20b)+_0x56fc6e[_0x198ca4(0x1df)]);}catch(_0x782865){console[_0x198ca4(0x23a)](_0x782865),_0xe6b87d[_0x198ca4(0x20c)](0x1f4)[_0x198ca4(0x242)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x2663b2=>{var _0x5d99df=_0x3bb8a8;console[_0x5d99df(0x23a)](_0x2663b2),_0xe6b87d['status'](0x1f4)[_0x5d99df(0x242)]({'error':_0x5d99df(0x1c5)});});}catch(_0x322d05){_0xe6b87d[_0x3bb8a8(0x242)]({'message':_0x322d05[_0x3bb8a8(0x253)]});}}),router['get']('/view/:id',auth,async(_0x2cf897,_0x18f9ad)=>{var _0xad919b=a0_0x1b5823;try{const {username:_0x222d69,email:_0x446eba,role:_0xe0d3d5}=_0x2cf897['user'],_0x36fffe=_0x2cf897[_0xad919b(0x25d)],_0x4ed950=await profile[_0xad919b(0x1d4)]({'email':_0x36fffe[_0xad919b(0x230)]}),_0x1f92ae=await master_shop[_0xad919b(0x1fb)]();console[_0xad919b(0x1bb)]('master',_0x1f92ae);const _0x204339=_0x2cf897['params']['id'],_0x38c9d8=await adjustment_finished[_0xad919b(0x204)]({'_id':_0x204339});let _0x1868b1=new Date(_0x38c9d8['expiry_date']),_0x51b0ef=('0'+_0x1868b1[_0xad919b(0x1f5)]())[_0xad919b(0x25c)](-0x2),_0x387772=('0'+(_0x1868b1[_0xad919b(0x219)]()+0x1))['slice'](-0x2),_0x3f0e4c=_0x1868b1[_0xad919b(0x1eb)](),_0x3d2f4c=_0x3f0e4c+'-'+_0x387772+'-'+_0x51b0ef;var _0x1a1720=[_0xad919b(0x1cd),_0xad919b(0x21c),_0xad919b(0x227)];const _0x33643e=await purchases[_0xad919b(0x23f)]([{'$match':{'warehouse_name':_0x38c9d8[_0xad919b(0x1e5)]}},{'$unwind':_0xad919b(0x1d2)},{'$group':{'_id':_0xad919b(0x25f)}}]);console[_0xad919b(0x1bb)]('purchases_data',_0x33643e);const _0x4a6b57=await product['find']({}),_0x1824ff=await warehouse['aggregate']([{'$match':{'name':_0x38c9d8[_0xad919b(0x1e5)],'room':_0x38c9d8[_0xad919b(0x1d3)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xad919b(0x24c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xad919b(0x1cc)},'bay':{'$first':_0xad919b(0x258)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xad919b(0x1e4)},'floorlevel':{'$first':_0xad919b(0x1ff)},'primary_code':{'$first':_0xad919b(0x1fd)},'secondary_code':{'$first':_0xad919b(0x1ed)},'product_code':{'$first':_0xad919b(0x245)},'storage':{'$first':_0xad919b(0x1ba)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x1f92ae[0x0][_0xad919b(0x225)]=='English\x20(US)'){var _0x3cb07a=users['English'];console['log'](_0x3cb07a);}else{if(_0x1f92ae[0x0]['language']==_0xad919b(0x1e3))var _0x3cb07a=users['Hindi'];else{if(_0x1f92ae[0x0][_0xad919b(0x225)]==_0xad919b(0x216))var _0x3cb07a=users[_0xad919b(0x216)];else{if(_0x1f92ae[0x0][_0xad919b(0x225)]==_0xad919b(0x22f))var _0x3cb07a=users[_0xad919b(0x22f)];else{if(_0x1f92ae[0x0][_0xad919b(0x225)]=='French')var _0x3cb07a=users['French'];else{if(_0x1f92ae[0x0]['language']==_0xad919b(0x249))var _0x3cb07a=users[_0xad919b(0x24b)];else{if(_0x1f92ae[0x0][_0xad919b(0x225)]==_0xad919b(0x210))var _0x3cb07a=users[_0xad919b(0x210)];else{if(_0x1f92ae[0x0][_0xad919b(0x225)]==_0xad919b(0x252))var _0x3cb07a=users[_0xad919b(0x214)];}}}}}}}_0x18f9ad[_0xad919b(0x1c3)](_0xad919b(0x1fe),{'success':_0x2cf897[_0xad919b(0x24e)](_0xad919b(0x22b)),'errors':_0x2cf897[_0xad919b(0x24e)](_0xad919b(0x1fc)),'role':_0x36fffe,'profile':_0x4ed950,'adjustment':_0x38c9d8,'stock':_0x1824ff,'master_shop':_0x1f92ae,'warehouse_name':_0x33643e,'unit':_0x4a6b57,'language':_0x3cb07a,'rooms_data':_0x1a1720,'ed_fullDate':_0x3d2f4c});}catch(_0x12fa82){console[_0xad919b(0x1bb)](_0x12fa82),_0x18f9ad[_0xad919b(0x20c)](0xc8)[_0xad919b(0x242)]({'message':_0x12fa82[_0xad919b(0x253)]});}}),router[a0_0x1b5823(0x1cf)](a0_0x1b5823(0x222),auth,async(_0x8c1531,_0x40051d)=>{var _0x554f1d=a0_0x1b5823;try{const _0x3fbd05=_0x8c1531['params']['id'],_0x45a19b=await adjustment_finished[_0x554f1d(0x204)]({'_id':_0x3fbd05}),_0x1bb4fa=await warehouse['findOne']({'name':_0x45a19b['warehouse_name'],'room':_0x45a19b['room']}),{warehouse_name:_0xd60ea1,date:_0x2fc076,prod_name:_0x4e7bd7,level:_0x3624fc,isle:_0x3957f4,pallet:_0x3694b8,stock:_0x2abcf6,types:_0x102854,adjust_qty:_0xc29de4,new_adjust_qty:_0x368c68,note:_0x94e020,Room_name:_0x30457b,invoice:_0x596923,JO_number:_0x384f42}=_0x8c1531['body'];if(typeof _0x4e7bd7=='string')var _0x260171=[_0x8c1531['body'][_0x554f1d(0x1bc)]],_0x2a66a8=[_0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x1fa)]],_0x493992=[_0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x23e)]],_0x4d7541=[_0x8c1531[_0x554f1d(0x22d)]['types']],_0x24f95e=[_0x8c1531[_0x554f1d(0x22d)]['adjust_qty']],_0x1b92d7=[_0x8c1531['body'][_0x554f1d(0x246)]],_0x66b6b6=[_0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x1f4)]],_0x3a1c87=[_0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x1cb)]],_0x47cd20=[_0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x255)]],_0x8a0104=[_0x8c1531[_0x554f1d(0x22d)]['batch_code']],_0x13f897=[_0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x224)]];else var _0x260171=[..._0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x1bc)]],_0x2a66a8=[..._0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x1fa)]],_0x493992=[..._0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x23e)]],_0x4d7541=[..._0x8c1531['body']['types']],_0x24f95e=[..._0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x20e)]],_0x1b92d7=[..._0x8c1531['body'][_0x554f1d(0x246)]],_0x66b6b6=[..._0x8c1531['body'][_0x554f1d(0x1f4)]],_0x3a1c87=[..._0x8c1531[_0x554f1d(0x22d)]['unit']],_0x47cd20=[..._0x8c1531['body'][_0x554f1d(0x255)]],_0x8a0104=[..._0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x237)]],_0x13f897=[..._0x8c1531[_0x554f1d(0x22d)][_0x554f1d(0x224)]];const _0x594956=_0x260171['map'](_0xbb17f3=>{return _0xbb17f3={'product_name':_0xbb17f3};});_0x2a66a8[_0x554f1d(0x212)]((_0x4429c7,_0x150fc2)=>{_0x594956[_0x150fc2]['bay']=_0x4429c7;}),_0x493992[_0x554f1d(0x212)]((_0xa84e83,_0x3592e1)=>{_0x594956[_0x3592e1]['stockBefore']=_0xa84e83;}),_0x4d7541[_0x554f1d(0x212)]((_0x5c6a47,_0x31f0c3)=>{_0x594956[_0x31f0c3]['types']=_0x5c6a47;}),_0x24f95e[_0x554f1d(0x212)]((_0x322ca3,_0x11870f)=>{_0x594956[_0x11870f]['adjust_qty']=_0x322ca3;}),_0x1b92d7[_0x554f1d(0x212)]((_0x2661be,_0x2b2764)=>{var _0x169ad0=_0x554f1d;_0x594956[_0x2b2764][_0x169ad0(0x246)]=_0x2661be;}),_0x3a1c87[_0x554f1d(0x212)]((_0x29d8f0,_0x6f8475)=>{var _0x2ca608=_0x554f1d;_0x594956[_0x6f8475][_0x2ca608(0x1cb)]=_0x29d8f0;}),_0x47cd20[_0x554f1d(0x212)]((_0x33a809,_0x357133)=>{var _0x32423c=_0x554f1d;_0x594956[_0x357133][_0x32423c(0x23b)]=_0x33a809;}),_0x66b6b6[_0x554f1d(0x212)]((_0x2eb26c,_0x28c80c)=>{var _0x136fba=_0x554f1d;_0x594956[_0x28c80c][_0x136fba(0x22c)]=_0x2eb26c;}),_0x8a0104[_0x554f1d(0x212)]((_0x7210d7,_0x2db17f)=>{var _0x8ad8c1=_0x554f1d;_0x594956[_0x2db17f][_0x8ad8c1(0x237)]=_0x7210d7;}),_0x13f897[_0x554f1d(0x212)]((_0x1fad8d,_0x2bf378)=>{var _0x1ec621=_0x554f1d;_0x594956[_0x2bf378][_0x1ec621(0x224)]=_0x1fad8d;});const _0x101e16=_0x594956[_0x554f1d(0x1ef)](_0x3900e9=>_0x3900e9['adjust_qty']!=='0'&&_0x3900e9[_0x554f1d(0x20e)]!=='');var _0x531dd1=0x0;_0x101e16[_0x554f1d(0x212)](_0xa41919=>{var _0x432071=_0x554f1d;console[_0x432071(0x1bb)]('foreach\x20newproduct',_0xa41919),parseInt(_0xa41919[_0x432071(0x20e)])<=0x0&&_0x531dd1++;});if(_0x531dd1!=0x0)return _0x8c1531['flash'](_0x554f1d(0x1fc),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x40051d[_0x554f1d(0x25b)](_0x554f1d(0x1d5));_0x45a19b[_0x554f1d(0x1e5)]=_0xd60ea1,_0x45a19b['date']=_0x2fc076,_0x45a19b['product']=_0x101e16,_0x45a19b[_0x554f1d(0x203)]=_0x94e020,_0x45a19b[_0x554f1d(0x1d3)]=_0x30457b,_0x45a19b[_0x554f1d(0x259)]=_0x596923,_0x45a19b['JO_number']=_0x384f42;const _0x3545c0=await _0x45a19b[_0x554f1d(0x1e9)](),_0x239b2a=await warehouse[_0x554f1d(0x1d4)]({'name':_0xd60ea1,'room':_0x30457b});_0x3545c0[_0x554f1d(0x202)][_0x554f1d(0x212)](_0x2de1a3=>{var _0x539d13=_0x554f1d;const _0x215f42=_0x239b2a[_0x539d13(0x1bf)][_0x539d13(0x1d6)](_0x29ee48=>{var _0x24679d=_0x539d13;_0x2de1a3[_0x24679d(0x1e8)]==_0x24679d(0x1b8)?_0x29ee48[_0x24679d(0x236)]==_0x2de1a3['product_name']&&_0x29ee48[_0x24679d(0x241)]==_0x2de1a3[_0x24679d(0x241)]&&(_0x29ee48[_0x24679d(0x1c6)]=parseInt(_0x29ee48[_0x24679d(0x1c6)])-parseInt(_0x2de1a3[_0x24679d(0x20e)])):_0x29ee48[_0x24679d(0x236)]==_0x2de1a3[_0x24679d(0x236)]&&_0x29ee48[_0x24679d(0x241)]==_0x2de1a3[_0x24679d(0x241)]&&(_0x29ee48['product_stock']=parseInt(_0x29ee48['product_stock'])+parseInt(_0x2de1a3[_0x24679d(0x20e)]));});}),await _0x239b2a['save'](),_0x8c1531[_0x554f1d(0x24e)](_0x554f1d(0x22b),'adjustment\x20data\x20update\x20successfully'),_0x40051d[_0x554f1d(0x25b)](_0x554f1d(0x1d7));}catch(_0x612e7c){console[_0x554f1d(0x1bb)](_0x612e7c);}}),router['post'](a0_0x1b5823(0x234),async(_0x1b04c3,_0x3f7da6)=>{var _0x27f28e=a0_0x1b5823;const {primary_code:_0x129301,warehouse_data:_0x2a08da,rooms_data:_0x59bbe6,Roomslist:_0x22d985}=_0x1b04c3['body'],_0x3dd4e8=_0x22d985[_0x27f28e(0x24a)](','),_0x2a5a25=[];async function _0x2f2fbf(_0x2e25b3){var _0x16cbe2=_0x27f28e;const _0x4ee490=await warehouse[_0x16cbe2(0x23f)]([{'$match':{'name':_0x2a08da,'room':_0x2e25b3}},{'$unwind':_0x16cbe2(0x221)},{'$match':{'product_details.primary_code':_0x129301}},{'$group':{'_id':_0x16cbe2(0x24c),'name':{'$first':_0x16cbe2(0x238)},'product_stock':{'$first':_0x16cbe2(0x1cc)},'primary_code':{'$first':_0x16cbe2(0x1fd)},'secondary_code':{'$first':_0x16cbe2(0x1ed)},'product_code':{'$first':_0x16cbe2(0x245)},'level':{'$first':_0x16cbe2(0x24f)},'bay':{'$first':_0x16cbe2(0x258)},'type':{'$first':_0x16cbe2(0x1e4)},'pallet':{'$first':_0x16cbe2(0x1ff)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x16cbe2(0x257)},'expiry_date':{'$first':_0x16cbe2(0x254)},'production_date':{'$first':_0x16cbe2(0x25a)},'batch_code':{'$first':_0x16cbe2(0x1e2)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x16cbe2(0x1bd)},'roomNamed':{'$first':_0x16cbe2(0x232)},'invoice':{'$first':_0x16cbe2(0x1dc)}}}]),_0x513775=await warehouse['aggregate']([{'$match':{'name':_0x2a08da,'room':_0x2e25b3}},{'$unwind':_0x16cbe2(0x221)},{'$match':{'product_details.secondary_code':_0x129301}},{'$group':{'_id':_0x16cbe2(0x24c),'name':{'$first':_0x16cbe2(0x238)},'product_stock':{'$first':_0x16cbe2(0x1cc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x16cbe2(0x1ed)},'product_code':{'$first':_0x16cbe2(0x245)},'level':{'$first':_0x16cbe2(0x24f)},'bay':{'$first':_0x16cbe2(0x258)},'type':{'$first':_0x16cbe2(0x1e4)},'pallet':{'$first':_0x16cbe2(0x1ff)},'unit':{'$first':_0x16cbe2(0x21e)},'secondary_unit':{'$first':_0x16cbe2(0x1e6)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x16cbe2(0x257)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x16cbe2(0x1e2)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x16cbe2(0x1bd)},'roomNamed':{'$first':_0x16cbe2(0x232)},'invoice':{'$first':_0x16cbe2(0x1dc)}}}]);if(_0x4ee490[_0x16cbe2(0x251)]>0x0)_0x2a5a25['push'](_0x4ee490);else _0x513775[_0x16cbe2(0x251)]>0x0&&_0x2a5a25[_0x16cbe2(0x20f)](_0x513775);}const _0x448969=_0x3dd4e8[_0x27f28e(0x1d6)](_0x343d48=>_0x2f2fbf(_0x343d48));await Promise['all'](_0x448969),_0x3f7da6[_0x27f28e(0x242)](_0x2a5a25);}),router['post'](a0_0x1b5823(0x1d8),async(_0x16a366,_0xe932fe)=>{var _0x5aa7f9=a0_0x1b5823;const {productCode:_0x543c86,bay:_0x379e3f,warehouses:_0x3f1e30,room:_0x417072}=_0x16a366[_0x5aa7f9(0x22d)];console[_0x5aa7f9(0x1bb)](_0x16a366[_0x5aa7f9(0x22d)]);try{const _0x53f685=await warehouse[_0x5aa7f9(0x23f)]([{'$match':{'name':_0x3f1e30,'room':_0x417072}},{'$unwind':_0x5aa7f9(0x221)},{'$match':{'product_details.bay':parseInt(_0x379e3f)}},{'$group':{'_id':_0x5aa7f9(0x24c),'name':{'$first':_0x5aa7f9(0x238)},'product_stock':{'$first':_0x5aa7f9(0x1cc)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xe932fe[_0x5aa7f9(0x20c)](0xc8)['json'](_0x53f685);}catch(_0x3379f4){_0xe932fe[_0x5aa7f9(0x20c)](0x194)['json']({'message':_0x3379f4[_0x5aa7f9(0x253)]});}}),module[a0_0x1b5823(0x20a)]=router;