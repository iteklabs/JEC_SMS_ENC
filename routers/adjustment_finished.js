var a0_0x4452f7=a0_0x1086;(function(_0x4d64c5,_0x52aae3){var _0x480c9b=a0_0x1086,_0x335ea7=_0x4d64c5();while(!![]){try{var _0xd82271=parseInt(_0x480c9b(0xf8))/0x1*(-parseInt(_0x480c9b(0xf7))/0x2)+-parseInt(_0x480c9b(0x163))/0x3*(-parseInt(_0x480c9b(0xf3))/0x4)+-parseInt(_0x480c9b(0xdb))/0x5+parseInt(_0x480c9b(0xf1))/0x6+-parseInt(_0x480c9b(0x124))/0x7*(parseInt(_0x480c9b(0xfd))/0x8)+-parseInt(_0x480c9b(0xef))/0x9+parseInt(_0x480c9b(0x17d))/0xa;if(_0xd82271===_0x52aae3)break;else _0x335ea7['push'](_0x335ea7['shift']());}catch(_0x349a63){_0x335ea7['push'](_0x335ea7['shift']());}}}(a0_0x402c,0x5c99b));const express=require(a0_0x4452f7(0x15d)),app=express(),router=express['Router'](),auth=require(a0_0x4452f7(0x120)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require(a0_0x4452f7(0x107)),nodemailer=require('nodemailer');router[a0_0x4452f7(0x113)](a0_0x4452f7(0xed),auth,async(_0x43b46b,_0x2f7c2a)=>{var _0x557d15=a0_0x4452f7;try{const {username:_0x2c01aa,email:_0x43e849,role:_0x39aed4}=_0x43b46b[_0x557d15(0x10d)],_0x19753c=_0x43b46b[_0x557d15(0x10d)],_0x40bc30=await profile[_0x557d15(0xfb)]({'email':_0x19753c['email']}),_0x3b08e3=await master_shop[_0x557d15(0x11e)]();let _0x223447;if(_0x19753c[_0x557d15(0x17f)]==_0x557d15(0x16e)){const _0x336266=await staff[_0x557d15(0xfb)]({'email':_0x19753c[_0x557d15(0x172)]});_0x223447=await warehouse['find']({'status':'Enabled','name':_0x336266['warehouse']});}else _0x223447=await warehouse[_0x557d15(0x11e)]({'status':_0x557d15(0x17c)});const _0x57a0d7=await product[_0x557d15(0x11e)]();let _0x5a2ba4;if(_0x19753c['role']==_0x557d15(0x16e)){const _0x2caff0=await staff[_0x557d15(0xfb)]({'email':_0x19753c['email']});_0x5a2ba4=await adjustment_finished[_0x557d15(0x11e)]({'warehouse_name':_0x2caff0[_0x557d15(0x15c)]});}else _0x5a2ba4=await adjustment_finished[_0x557d15(0x148)]([{'$match':{'type_of_transaction':_0x557d15(0x165)}},{'$unwind':_0x557d15(0x102)},{'$group':{'_id':'$_id','invoice':{'$first':_0x557d15(0xf2)},'date':{'$first':_0x557d15(0x183)},'warehouse_name':{'$first':_0x557d15(0x108)},'room':{'$addToSet':_0x557d15(0x164)},'finalize':{'$first':_0x557d15(0x14a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x3b08e3[0x0][_0x557d15(0x142)]=='English\x20(US)'){var _0x3b479b=users[_0x557d15(0x168)];console[_0x557d15(0x12a)](_0x3b479b);}else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0x156))var _0x3b479b=users[_0x557d15(0x156)];else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0xe1))var _0x3b479b=users[_0x557d15(0xe1)];else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0xe2))var _0x3b479b=users[_0x557d15(0xe2)];else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0x12f))var _0x3b479b=users[_0x557d15(0x12f)];else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0x14f))var _0x3b479b=users[_0x557d15(0x151)];else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0x131))var _0x3b479b=users[_0x557d15(0x131)];else{if(_0x3b08e3[0x0][_0x557d15(0x142)]==_0x557d15(0xda))var _0x3b479b=users['Arabic'];}}}}}}}_0x2f7c2a['render']('adjustment_finished',{'success':_0x43b46b[_0x557d15(0xf0)](_0x557d15(0xf4)),'errors':_0x43b46b['flash'](_0x557d15(0x174)),'role':_0x19753c,'profile':_0x40bc30,'warehouse':_0x223447,'product':_0x57a0d7,'adjustment':_0x5a2ba4,'master_shop':_0x3b08e3,'language':_0x3b479b});}catch(_0x3c0821){console[_0x557d15(0x12a)](_0x3c0821);}}),router[a0_0x4452f7(0x113)](a0_0x4452f7(0xe0),auth,async(_0xd32743,_0x59fabc)=>{var _0x2c2807=a0_0x4452f7;try{const {username:_0x499648,email:_0x2567a9,role:_0x19fe0b}=_0xd32743['user'],_0x2c4d70=_0xd32743[_0x2c2807(0x10d)],_0x2cb777=await profile[_0x2c2807(0xfb)]({'email':_0x2c4d70[_0x2c2807(0x172)]}),_0x2b5d45=await master_shop[_0x2c2807(0x11e)]();let _0x1dddd5;if(_0x2c4d70[_0x2c2807(0x17f)]=='staff'){const _0x222fd8=await staff[_0x2c2807(0xfb)]({'email':_0x2c4d70[_0x2c2807(0x172)]});_0x1dddd5=await warehouse['find']({'status':_0x2c2807(0x17c),'name':_0x222fd8[_0x2c2807(0x15c)]});}else _0x1dddd5=await warehouse['find']({'status':_0x2c2807(0x17c)});const _0x4a7805=await product[_0x2c2807(0x11e)]();let _0x45f382;if(_0x2c4d70[_0x2c2807(0x17f)]==_0x2c2807(0x16e)){const _0x5bac1a=await staff[_0x2c2807(0xfb)]({'email':_0x2c4d70['email']});_0x45f382=await adjustment_finished['find']({'warehouse_name':_0x5bac1a[_0x2c2807(0x15c)]});}else _0x45f382=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x2c2807(0x116)}},{'$unwind':_0x2c2807(0x102)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2c2807(0xf2)},'date':{'$first':_0x2c2807(0x183)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x2c2807(0x164)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2b5d45[0x0]['language']==_0x2c2807(0x13c))var _0x31001f=users['English'];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]==_0x2c2807(0x156))var _0x31001f=users['Hindi'];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]==_0x2c2807(0xe1))var _0x31001f=users[_0x2c2807(0xe1)];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]=='Spanish')var _0x31001f=users[_0x2c2807(0xe2)];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]==_0x2c2807(0x12f))var _0x31001f=users[_0x2c2807(0x12f)];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]==_0x2c2807(0x14f))var _0x31001f=users['Portuguese'];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]==_0x2c2807(0x131))var _0x31001f=users[_0x2c2807(0x131)];else{if(_0x2b5d45[0x0][_0x2c2807(0x142)]=='Arabic\x20(ae)')var _0x31001f=users['Arabic'];}}}}}}}_0x59fabc[_0x2c2807(0x115)](_0x2c2807(0xec),{'success':_0xd32743['flash'](_0x2c2807(0xf4)),'errors':_0xd32743[_0x2c2807(0xf0)](_0x2c2807(0x174)),'role':_0x2c4d70,'profile':_0x2cb777,'warehouse':_0x1dddd5,'product':_0x4a7805,'adjustment':_0x45f382,'master_shop':_0x2b5d45,'language':_0x31001f});}catch(_0x235d59){console[_0x2c2807(0x12a)](_0x235d59);}});function a0_0x1086(_0x40ed34,_0x19c13b){var _0x402c73=a0_0x402c();return a0_0x1086=function(_0x1086ba,_0x7fc1df){_0x1086ba=_0x1086ba-0xd8;var _0x44902d=_0x402c73[_0x1086ba];return _0x44902d;},a0_0x1086(_0x40ed34,_0x19c13b);}async function getRandom8DigitNumber(){var _0x55289b=a0_0x4452f7;const _0x3fd04d=0x989680,_0x56f80c=0x5f5e0ff,_0x1b16bb=Math[_0x55289b(0x13f)](Math[_0x55289b(0xfe)]()*(_0x56f80c-_0x3fd04d+0x1))+_0x3fd04d;var _0x1b1125;const _0x31fc07=await adjustment_finished[_0x55289b(0xfb)]({'invoice':_0x55289b(0x111)+_0x1b16bb});return _0x31fc07&&_0x31fc07[_0x55289b(0x11f)]>0x0?_0x1b1125='ADJF-'+_0x1b16bb:_0x1b1125=_0x55289b(0x111)+_0x1b16bb,_0x1b1125;}router[a0_0x4452f7(0x113)](a0_0x4452f7(0xe6),auth,async(_0x21b3d,_0xc61e9f)=>{var _0x285e76=a0_0x4452f7;try{const {username:_0x27058e,email:_0x104df9,role:_0x28f038}=_0x21b3d[_0x285e76(0x10d)],_0x579066=_0x21b3d[_0x285e76(0x10d)],_0xb7f7db=await profile['findOne']({'email':_0x579066[_0x285e76(0x172)]}),_0xdcc782=await master_shop[_0x285e76(0x11e)]();let _0xb4b29e;if(_0x579066[_0x285e76(0x17f)]==_0x285e76(0x16e)){const _0x1496af=await staff[_0x285e76(0xfb)]({'email':_0x579066[_0x285e76(0x172)]});_0xb4b29e=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x1496af[_0x285e76(0x15c)]}},{'$group':{'_id':_0x285e76(0x173),'name':{'$first':_0x285e76(0x173)}}}]);}else _0xb4b29e=await warehouse[_0x285e76(0x148)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x285e76(0x173),'name':{'$first':_0x285e76(0x173)}}}]);const _0x540e7d=await product[_0x285e76(0x11e)]({}),_0x3cb087=await adjustment_finished[_0x285e76(0x11e)](),_0x49392d=_0x3cb087[_0x285e76(0x11f)]+0x1,_0x50e88b=_0x285e76(0x111)+_0x49392d[_0x285e76(0x15a)]()['padStart'](0x5,'0');var _0x14612a=['Ambient','Enclosed',_0x285e76(0x154)];if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0x13c))var _0x5d8e64=users['English'];else{if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0x156))var _0x5d8e64=users['Hindi'];else{if(_0xdcc782[0x0][_0x285e76(0x142)]=='German')var _0x5d8e64=users[_0x285e76(0xe1)];else{if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0xe2))var _0x5d8e64=users[_0x285e76(0xe2)];else{if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0x12f))var _0x5d8e64=users[_0x285e76(0x12f)];else{if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0x14f))var _0x5d8e64=users['Portuguese'];else{if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0x131))var _0x5d8e64=users[_0x285e76(0x131)];else{if(_0xdcc782[0x0][_0x285e76(0x142)]==_0x285e76(0xda))var _0x5d8e64=users[_0x285e76(0xe4)];}}}}}}}const _0x3e65eb=getRandom8DigitNumber();_0x3e65eb['then'](_0x409b52=>{var _0xbd9f2c=_0x285e76;_0xc61e9f[_0xbd9f2c(0x115)](_0xbd9f2c(0x12d),{'success':_0x21b3d[_0xbd9f2c(0xf0)](_0xbd9f2c(0xf4)),'errors':_0x21b3d[_0xbd9f2c(0xf0)](_0xbd9f2c(0x174)),'role':_0x579066,'profile':_0xb7f7db,'warehouse':_0xb4b29e,'product':_0x540e7d,'master_shop':_0xdcc782,'language':_0x5d8e64,'rooms_data':_0x14612a,'invoice_no':_0x409b52});})['catch'](_0x4e7d3a=>{var _0x1716de=_0x285e76;_0x21b3d[_0x1716de(0xf0)](_0x1716de(0x174),_0x1716de(0xdd)),_0xc61e9f[_0x1716de(0x144)](_0x1716de(0x123));});}catch(_0x4783fa){console['log'](_0x4783fa);}}),router[a0_0x4452f7(0xdc)](a0_0x4452f7(0xe6),auth,async(_0x35fff8,_0x1dce66)=>{var _0x3ff353=a0_0x4452f7;try{const {warehouse_name:_0x21ad06,date:_0x917d70,prod_name:_0x3feacb,level:_0x4a9b94,isle:_0x2edb59,pallet:_0x21b78c,stock:_0xc122a3,types:_0xf381b4,adjust_qty:_0x4ed0f9,new_adjust_qty:_0x2222bc,note:_0x44dbfe,Room_name:_0x192006,JO_number:_0x264ad7,expiry_date:_0x4f4dea,PO_number:_0x3012d7,ReqBy:_0x22a7a3,dateofreq:_0x30e545,typeservicesData:_0x46bb85,destination:_0x3b9f23,deliverydate:_0x588484,driver:_0x34b354,plate:_0x2d073e,van:_0x1ca33d,DRSI:_0x40225e,typevehicle:_0x50aff7,TSU:_0x45fda1,TFU:_0xd92061}=_0x35fff8[_0x3ff353(0x17b)];if(typeof _0x3feacb=='string')var _0x3c820d=[_0x35fff8['body'][_0x3ff353(0xf9)]],_0x178d47=[_0x35fff8['body'][_0x3ff353(0x10c)]],_0x43b637=[_0x35fff8[_0x3ff353(0x17b)]['stock']],_0x4994fa=[_0x35fff8[_0x3ff353(0x17b)]['types']],_0xc5b9b4=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x182)]],_0x4ba3e3=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x167)]],_0x4c8ce9=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x12e)]],_0x49fb7d=[_0x35fff8[_0x3ff353(0x17b)]['Secondary_units']],_0x5efdc1=[_0x35fff8['body'][_0x3ff353(0x11b)]],_0x57f659=[_0x35fff8['body'][_0x3ff353(0x16c)]],_0x3962c3=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x152)]],_0x58f624=[_0x35fff8[_0x3ff353(0x17b)]['product_date']],_0x1e95f5=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x177)]],_0x150829=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x14d)]],_0x3d8a9e=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x10e)]],_0x40a34c=[_0x35fff8[_0x3ff353(0x17b)]['prod_invoice']],_0xff0e2b=[_0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x13a)]];else var _0x3c820d=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0xf9)]],_0x178d47=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x10c)]],_0x43b637=[..._0x35fff8['body'][_0x3ff353(0x134)]],_0x4994fa=[..._0x35fff8['body']['types']],_0xc5b9b4=[..._0x35fff8[_0x3ff353(0x17b)]['New_Qty_Converted_adj']],_0x4ba3e3=[..._0x35fff8['body']['New_Qty_Converted']],_0x4c8ce9=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x12e)]],_0x49fb7d=[..._0x35fff8['body']['Secondary_units']],_0x5efdc1=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x11b)]],_0x57f659=[..._0x35fff8['body'][_0x3ff353(0x16c)]],_0x3962c3=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x152)]],_0x58f624=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x155)]],_0x1e95f5=[..._0x35fff8[_0x3ff353(0x17b)]['prod_cat']],_0x150829=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x14d)]],_0x3d8a9e=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x10e)]],_0x40a34c=[..._0x35fff8[_0x3ff353(0x17b)][_0x3ff353(0x14b)]],_0xff0e2b=[..._0x35fff8[_0x3ff353(0x17b)]['id_transaction_from']];const _0xc714b8=_0x3c820d[_0x3ff353(0x139)](_0x2f147f=>{return _0x2f147f={'product_name':_0x2f147f};});_0x178d47[_0x3ff353(0x15f)]((_0xeb6597,_0x1ceedd)=>{var _0x3bd155=_0x3ff353,_0x1e12fa=_0xeb6597[_0x3bd155(0x138)](/[A-Za-z]+/)[0x0],_0x30491a=parseInt(_0xeb6597[_0x3bd155(0x138)](/\d+/)[0x0]);_0xc714b8[_0x1ceedd][_0x3bd155(0x10c)]=_0x1e12fa,_0xc714b8[_0x1ceedd]['bay']=_0x30491a;}),_0xff0e2b['forEach']((_0x1e8ee8,_0x185d22)=>{var _0x5e3ab3=_0x3ff353;_0xc714b8[_0x185d22][_0x5e3ab3(0x104)]=_0x1e8ee8;}),_0x43b637[_0x3ff353(0x15f)]((_0x3e2f8c,_0x475dd5)=>{var _0x55ef15=_0x3ff353;_0xc714b8[_0x475dd5][_0x55ef15(0x112)]=_0x3e2f8c;}),_0x4994fa[_0x3ff353(0x15f)]((_0x40777c,_0xbea846)=>{var _0xb82385=_0x3ff353;_0xc714b8[_0xbea846][_0xb82385(0xeb)]=_0x40777c;}),_0xc5b9b4[_0x3ff353(0x15f)]((_0x179389,_0x327dee)=>{_0xc714b8[_0x327dee]['adjust_qty']=_0x179389;}),_0x4ba3e3[_0x3ff353(0x15f)]((_0x45c4b1,_0x33e44d)=>{var _0xd1b541=_0x3ff353;_0xc714b8[_0x33e44d][_0xd1b541(0xee)]=_0x45c4b1;}),_0x4c8ce9[_0x3ff353(0x15f)]((_0x50bb38,_0x377087)=>{var _0x18e8ec=_0x3ff353;_0xc714b8[_0x377087][_0x18e8ec(0xe7)]=_0x50bb38;}),_0x49fb7d[_0x3ff353(0x15f)]((_0x2ad123,_0x255e92)=>{var _0x4f5c06=_0x3ff353;_0xc714b8[_0x255e92][_0x4f5c06(0x103)]=_0x2ad123;}),_0x5efdc1[_0x3ff353(0x15f)]((_0x4fbbd4,_0x22c517)=>{var _0x429d84=_0x3ff353;_0xc714b8[_0x22c517][_0x429d84(0xe9)]=_0x4fbbd4;}),_0x57f659[_0x3ff353(0x15f)]((_0x3c2eb7,_0x1578b5)=>{_0xc714b8[_0x1578b5]['batch_code']=_0x3c2eb7;}),_0x3962c3[_0x3ff353(0x15f)]((_0x3e9c76,_0x1b0f6a)=>{var _0x41061d=_0x3ff353;_0xc714b8[_0x1b0f6a][_0x41061d(0x152)]=_0x3e9c76;}),_0x58f624['forEach']((_0x31a3d9,_0x5d4b4c)=>{var _0x2efaf6=_0x3ff353;_0xc714b8[_0x5d4b4c][_0x2efaf6(0xfc)]=_0x31a3d9;}),_0x1e95f5[_0x3ff353(0x15f)]((_0xe03d85,_0x22849f)=>{var _0x57b6b2=_0x3ff353;_0xc714b8[_0x22849f][_0x57b6b2(0x177)]=_0xe03d85;}),_0x150829[_0x3ff353(0x15f)]((_0x1cfe05,_0x567099)=>{var _0x13b75a=_0x3ff353;_0xc714b8[_0x567099][_0x13b75a(0x117)]=_0x1cfe05;}),_0x3d8a9e[_0x3ff353(0x15f)]((_0x28dd50,_0x1c055b)=>{var _0x1901f1=_0x3ff353;_0xc714b8[_0x1c055b][_0x1901f1(0x10e)]=_0x28dd50;}),_0x40a34c['forEach']((_0x698fee,_0xdce4dc)=>{var _0x212bcd=_0x3ff353;_0xc714b8[_0xdce4dc][_0x212bcd(0xe8)]=_0x698fee;});const _0x548f15=_0xc714b8[_0x3ff353(0x175)](_0x287af7=>_0x287af7['adjust_qty']!=='0'&&_0x287af7[_0x3ff353(0x11c)]!=='');var _0x3d3b21=0x0;_0x548f15[_0x3ff353(0x15f)](_0x1fa488=>{var _0x4b0041=_0x3ff353;console['log'](_0x4b0041(0x119),_0x1fa488),parseInt(_0x1fa488['adjust_qty'])<=0x0&&_0x3d3b21++;});if(_0x3d3b21!=0x0)return _0x35fff8['flash'](_0x3ff353(0x174),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x1dce66['redirect'](_0x3ff353(0x157));const _0xf4b479=new invoice_for_adjustment();await _0xf4b479[_0x3ff353(0x143)]();const _0xcdccc3=new adjustment_finished({'warehouse_name':_0x21ad06,'date':_0x917d70,'product':_0x548f15,'note':_0x44dbfe,'room':_0x192006,'invoice':_0x3ff353(0x166)+_0xf4b479['invoice_init'][_0x3ff353(0x15a)]()['padStart'](0x8,'0'),'JO_number':_0x264ad7,'expiry_date':_0x4f4dea,'PO_number':_0x3012d7,'RequestedBy':_0x22a7a3,'DateofRequest':_0x30e545,'typeservices':_0x46bb85,'destination':_0x3b9f23,'deliverydate':_0x588484,'driver':_0x34b354,'plate':_0x2d073e,'van':_0x1ca33d,'DRSI':_0x40225e,'typevehicle':_0x50aff7,'TSU':_0x45fda1,'TFU':_0xd92061}),_0x357018=await _0xcdccc3[_0x3ff353(0x143)]();_0x35fff8[_0x3ff353(0xf0)](_0x3ff353(0xf4),_0x3ff353(0x176)),_0x1dce66['redirect'](_0x3ff353(0x114)+_0x357018[_0x3ff353(0x101)]);}catch(_0x567423){console[_0x3ff353(0x12a)](_0x567423),_0x1dce66['status'](0xc8)[_0x3ff353(0x10f)]({'message':_0x567423[_0x3ff353(0x121)]});}}),router[a0_0x4452f7(0x113)](a0_0x4452f7(0x153),auth,async(_0xdb7c4b,_0x5354da)=>{var _0x3b88f3=a0_0x4452f7;try{const {username:_0x499ef8,email:_0x1b1baa,role:_0x48b5ab}=_0xdb7c4b[_0x3b88f3(0x10d)],_0x5816c3=_0xdb7c4b[_0x3b88f3(0x10d)],_0xaec509=await profile['findOne']({'email':_0x5816c3['email']}),_0x134ede=await master_shop[_0x3b88f3(0x11e)]();let _0x1c24eb;if(_0x5816c3[_0x3b88f3(0x17f)]=='staff'){const _0x1382b3=await staff[_0x3b88f3(0xfb)]({'email':_0x5816c3['email']});_0x1c24eb=await warehouse[_0x3b88f3(0x148)]([{'$match':{'status':_0x3b88f3(0x17c),'name':_0x1382b3[_0x3b88f3(0x15c)]}},{'$group':{'_id':_0x3b88f3(0x173),'name':{'$first':_0x3b88f3(0x173)}}}]);}else _0x1c24eb=await warehouse[_0x3b88f3(0x148)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x3b88f3(0x173)}}}]);const _0xd2cdd7=await product[_0x3b88f3(0x11e)](),_0x13c143=await adjustment_finished[_0x3b88f3(0x11e)](),_0x937c8c=_0x13c143[_0x3b88f3(0x11f)]+0x1,_0x38f68c='ADJF-'+_0x937c8c[_0x3b88f3(0x15a)]()[_0x3b88f3(0x16b)](0x5,'0');var _0x404938=['Ambient',_0x3b88f3(0x118),_0x3b88f3(0x154)];if(_0x134ede[0x0][_0x3b88f3(0x142)]=='English\x20(US)')var _0x36aa51=users[_0x3b88f3(0x168)];else{if(_0x134ede[0x0][_0x3b88f3(0x142)]==_0x3b88f3(0x156))var _0x36aa51=users['Hindi'];else{if(_0x134ede[0x0]['language']==_0x3b88f3(0xe1))var _0x36aa51=users[_0x3b88f3(0xe1)];else{if(_0x134ede[0x0][_0x3b88f3(0x142)]=='Spanish')var _0x36aa51=users['Spanish'];else{if(_0x134ede[0x0][_0x3b88f3(0x142)]=='French')var _0x36aa51=users[_0x3b88f3(0x12f)];else{if(_0x134ede[0x0][_0x3b88f3(0x142)]==_0x3b88f3(0x14f))var _0x36aa51=users[_0x3b88f3(0x151)];else{if(_0x134ede[0x0][_0x3b88f3(0x142)]==_0x3b88f3(0x131))var _0x36aa51=users[_0x3b88f3(0x131)];else{if(_0x134ede[0x0][_0x3b88f3(0x142)]=='Arabic\x20(ae)')var _0x36aa51=users[_0x3b88f3(0xe4)];}}}}}}}const _0x2d36cd=getRandom8DigitNumber();_0x2d36cd['then'](_0xb463e3=>{var _0x17ff01=_0x3b88f3;_0x5354da[_0x17ff01(0x115)]('add_adjustment_finished_logs',{'success':_0xdb7c4b['flash']('success'),'errors':_0xdb7c4b[_0x17ff01(0xf0)](_0x17ff01(0x174)),'role':_0x5816c3,'profile':_0xaec509,'warehouse':_0x1c24eb,'product':_0xd2cdd7,'master_shop':_0x134ede,'language':_0x36aa51,'rooms_data':_0x404938,'invoice_no':_0xb463e3});})[_0x3b88f3(0x106)](_0x32f6fe=>{var _0x5ee194=_0x3b88f3;_0xdb7c4b['flash'](_0x5ee194(0x174),_0x5ee194(0xdd)),_0x5354da['redirect'](_0x5ee194(0x123));});}catch(_0x1d2d34){console['log'](_0x1d2d34);}}),router[a0_0x4452f7(0xdc)]('/view/add_adjustment_logs',auth,async(_0x31e2d0,_0x4b15d0)=>{var _0xead207=a0_0x4452f7;try{const {warehouse_name:_0x2fc818,date:_0x1ac65c,prod_name:_0x159736,level:_0x111cc9,isle:_0x1980ad,pallet:_0x12fa5f,stock:_0x3196cd,types:_0xe4f946,adjust_qty:_0x2c88b9,new_adjust_qty:_0x150a4e,note:_0xcd5a6,Room_name:_0x1bae4c,JO_number:_0x1218d9,expiry_date:_0x3a6ac6,type_of_transaction:_0x3a992c,PO_number:_0x508172,ReqBy:_0x2abdd5,dateofreq:_0x278082,typeservicesData:_0x110ea0,destination:_0x4bb5b4,deliverydate:_0x4923f8,driver:_0x25c426,plate:_0x316a4f,van:_0x5d9569,DRSI:_0x59af6f,typevehicle:_0x3ec721,TSU:_0x208cf7,TFU:_0x513eec}=_0x31e2d0[_0xead207(0x17b)];if(typeof _0x159736=='string')var _0x5f1d58=[_0x31e2d0['body'][_0xead207(0xf9)]],_0x524d85=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x10c)]],_0x1683eb=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x134)]],_0x3bf01b=[_0x31e2d0['body'][_0xead207(0xeb)]],_0x53c284=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x182)]],_0x4a5673=[_0x31e2d0[_0xead207(0x17b)]['New_Qty_Converted']],_0x14a47a=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x12e)]],_0x1f4eb2=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0xe5)]],_0x15219b=[_0x31e2d0['body'][_0xead207(0x11b)]],_0x154883=[_0x31e2d0['body'][_0xead207(0x16c)]],_0x2e5717=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x152)]],_0x16ab62=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x155)]],_0x2e1594=[_0x31e2d0['body']['prod_cat']],_0x1da42a=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x14d)]],_0x3d04b6=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x10e)]],_0x43c250=[_0x31e2d0[_0xead207(0x17b)][_0xead207(0x14b)]],_0x1e1cb8=[_0x31e2d0['body'][_0xead207(0x13a)]];else var _0x5f1d58=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0xf9)]],_0x524d85=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x10c)]],_0x1683eb=[..._0x31e2d0['body'][_0xead207(0x134)]],_0x3bf01b=[..._0x31e2d0[_0xead207(0x17b)]['types']],_0x53c284=[..._0x31e2d0[_0xead207(0x17b)]['New_Qty_Converted_adj']],_0x4a5673=[..._0x31e2d0[_0xead207(0x17b)]['New_Qty_Converted']],_0x14a47a=[..._0x31e2d0[_0xead207(0x17b)]['Primary_Units']],_0x1f4eb2=[..._0x31e2d0['body'][_0xead207(0xe5)]],_0x15219b=[..._0x31e2d0['body'][_0xead207(0x11b)]],_0x154883=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x16c)]],_0x2e5717=[..._0x31e2d0[_0xead207(0x17b)]['expiry_date']],_0x16ab62=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x155)]],_0x2e1594=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x177)]],_0x1da42a=[..._0x31e2d0['body'][_0xead207(0x14d)]],_0x3d04b6=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x10e)]],_0x43c250=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x14b)]],_0x1e1cb8=[..._0x31e2d0[_0xead207(0x17b)][_0xead207(0x13a)]];const _0x1338a6=_0x5f1d58['map'](_0x4fd85a=>{return _0x4fd85a={'product_name':_0x4fd85a};});_0x524d85[_0xead207(0x15f)]((_0x6204c5,_0x26c7e7)=>{var _0x157e5b=_0xead207,_0x29b1de=_0x6204c5[_0x157e5b(0x138)](/[A-Za-z]+/)[0x0],_0x39c179=parseInt(_0x6204c5[_0x157e5b(0x138)](/\d+/)[0x0]);_0x1338a6[_0x26c7e7][_0x157e5b(0x10c)]=_0x29b1de,_0x1338a6[_0x26c7e7][_0x157e5b(0x14e)]=_0x39c179;}),_0x1e1cb8[_0xead207(0x15f)]((_0x5e21c9,_0x43f749)=>{var _0x3567f7=_0xead207;_0x1338a6[_0x43f749][_0x3567f7(0x104)]=_0x5e21c9;}),_0x1683eb[_0xead207(0x15f)]((_0x3546b3,_0x74e603)=>{var _0x3681db=_0xead207;_0x1338a6[_0x74e603][_0x3681db(0x112)]=_0x3546b3;}),_0x3bf01b['forEach']((_0x55b19a,_0x2afd02)=>{var _0xde8b39=_0xead207;_0x1338a6[_0x2afd02][_0xde8b39(0xeb)]=_0x55b19a;}),_0x53c284[_0xead207(0x15f)]((_0x5d18e9,_0x5b1407)=>{_0x1338a6[_0x5b1407]['adjust_qty']=_0x5d18e9;}),_0x4a5673[_0xead207(0x15f)]((_0x4ffed8,_0x336484)=>{var _0xf738da=_0xead207;_0x1338a6[_0x336484][_0xf738da(0xee)]=_0x4ffed8;}),_0x14a47a[_0xead207(0x15f)]((_0x2ecae8,_0x227e70)=>{var _0x3f7f30=_0xead207;_0x1338a6[_0x227e70][_0x3f7f30(0xe7)]=_0x2ecae8;}),_0x1f4eb2[_0xead207(0x15f)]((_0x12e309,_0x453b43)=>{var _0x14159e=_0xead207;_0x1338a6[_0x453b43][_0x14159e(0x103)]=_0x12e309;}),_0x15219b[_0xead207(0x15f)]((_0x1bc0a2,_0x5b4d04)=>{_0x1338a6[_0x5b4d04]['product_code']=_0x1bc0a2;}),_0x154883[_0xead207(0x15f)]((_0x5bbec7,_0x26ed2d)=>{var _0x359645=_0xead207;_0x1338a6[_0x26ed2d][_0x359645(0x16c)]=_0x5bbec7;}),_0x2e5717[_0xead207(0x15f)]((_0x5b8e61,_0x468e35)=>{_0x1338a6[_0x468e35]['expiry_date']=_0x5b8e61;}),_0x16ab62[_0xead207(0x15f)]((_0x2cc5ca,_0x4e19a8)=>{var _0x1b263d=_0xead207;_0x1338a6[_0x4e19a8][_0x1b263d(0xfc)]=_0x2cc5ca;}),_0x2e1594[_0xead207(0x15f)]((_0x1380d0,_0x31426f)=>{var _0xdd743d=_0xead207;_0x1338a6[_0x31426f][_0xdd743d(0x177)]=_0x1380d0;}),_0x1da42a[_0xead207(0x15f)]((_0x4cb188,_0x215936)=>{var _0x330655=_0xead207;_0x1338a6[_0x215936][_0x330655(0x117)]=_0x4cb188;}),_0x3d04b6['forEach']((_0x238ac3,_0x5e826f)=>{var _0x1dddd9=_0xead207;_0x1338a6[_0x5e826f][_0x1dddd9(0x10e)]=_0x238ac3;}),_0x43c250[_0xead207(0x15f)]((_0x3ae67d,_0x3f61a9)=>{var _0x41eb83=_0xead207;_0x1338a6[_0x3f61a9][_0x41eb83(0xe8)]=_0x3ae67d;});const _0x5d5d76=_0x1338a6['filter'](_0x155599=>_0x155599[_0xead207(0x11c)]!=='0'&&_0x155599['adjust_qty']!=='');var _0x159ee7=0x0;_0x5d5d76[_0xead207(0x15f)](_0x286ee7=>{var _0x4901ce=_0xead207;console[_0x4901ce(0x12a)]('foreach\x20newproduct',_0x286ee7),parseInt(_0x286ee7[_0x4901ce(0x11c)])<=0x0&&_0x159ee7++;});if(_0x159ee7!=0x0)return _0x31e2d0[_0xead207(0xf0)](_0xead207(0x174),_0xead207(0x127)),_0x4b15d0[_0xead207(0x144)](_0xead207(0x157));const _0x35e34f=new adjustment_logs();await _0x35e34f[_0xead207(0x143)]();const _0x3f44c3=new adjustment_finished({'warehouse_name':_0x2fc818,'date':_0x1ac65c,'product':_0x5d5d76,'note':_0xcd5a6,'room':_0x1bae4c,'invoice':_0xead207(0xff)+_0x35e34f[_0xead207(0xde)][_0xead207(0x15a)]()[_0xead207(0x16b)](0x8,'0'),'JO_number':_0x1218d9,'expiry_date':_0x3a6ac6,'type_of_transaction':_0x3a992c,'PO_number':_0x508172,'RequestedBy':_0x2abdd5,'DateofRequest':_0x278082,'typeservices':_0x110ea0,'destination':_0x4bb5b4,'deliverydate':_0x4923f8,'driver':_0x25c426,'plate':_0x316a4f,'van':_0x5d9569,'DRSI':_0x59af6f,'typevehicle':_0x3ec721,'TSU':_0x208cf7,'TFU':_0x513eec}),_0x31d431=await _0x3f44c3['save']();_0x31e2d0[_0xead207(0xf0)](_0xead207(0xf4),_0xead207(0x176)),_0x4b15d0[_0xead207(0x144)]('/adjustment_finished/preview/'+_0x31d431[_0xead207(0x101)]);}catch(_0x1f957e){console[_0xead207(0x12a)](_0x1f957e),_0x4b15d0[_0xead207(0x180)](0xc8)[_0xead207(0x10f)]({'message':_0x1f957e[_0xead207(0x121)]});}}),router[a0_0x4452f7(0x113)]('/preview/:id',auth,async(_0x5afa9a,_0xd83a63)=>{var _0x10e5dd=a0_0x4452f7;try{const {username:_0x3b5295,email:_0x2f06fe,role:_0x183833}=_0x5afa9a['user'],_0x389c7f=_0x5afa9a[_0x10e5dd(0x10d)],_0x214ea6=await profile[_0x10e5dd(0xfb)]({'email':_0x389c7f[_0x10e5dd(0x172)]}),_0x39f2f9=await master_shop[_0x10e5dd(0x11e)](),_0x24bcd1=_0x5afa9a[_0x10e5dd(0xf6)]['id'],_0x20ed1e=await adjustment_finished['findById']({'_id':_0x24bcd1}),_0x5f1f67=await purchases[_0x10e5dd(0x148)]([{'$match':{'warehouse_name':_0x20ed1e['warehouse_name']}},{'$unwind':_0x10e5dd(0x102)},{'$group':{'_id':_0x10e5dd(0x136)}}]);console[_0x10e5dd(0x12a)](_0x10e5dd(0x16a),_0x5f1f67);const _0x4fc5c1=await product[_0x10e5dd(0x11e)]({}),_0x11c1e9=await warehouse[_0x10e5dd(0x148)]([{'$match':{'name':_0x20ed1e[_0x10e5dd(0x13e)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x10e5dd(0x150)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x10e5dd(0x135)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x10e5dd(0x17a)},'floorlevel':{'$first':_0x10e5dd(0x10b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10e5dd(0x147)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x10e5dd(0x12c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x10e5dd(0x160)},'batch_code':{'$first':_0x10e5dd(0xfa)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':'$room'}}}]);if(_0x39f2f9[0x0][_0x10e5dd(0x142)]==_0x10e5dd(0x13c)){var _0x5ea203=users[_0x10e5dd(0x168)];console[_0x10e5dd(0x12a)](_0x5ea203);}else{if(_0x39f2f9[0x0][_0x10e5dd(0x142)]==_0x10e5dd(0x156))var _0x5ea203=users[_0x10e5dd(0x156)];else{if(_0x39f2f9[0x0]['language']==_0x10e5dd(0xe1))var _0x5ea203=users[_0x10e5dd(0xe1)];else{if(_0x39f2f9[0x0][_0x10e5dd(0x142)]==_0x10e5dd(0xe2))var _0x5ea203=users[_0x10e5dd(0xe2)];else{if(_0x39f2f9[0x0]['language']=='French')var _0x5ea203=users[_0x10e5dd(0x12f)];else{if(_0x39f2f9[0x0][_0x10e5dd(0x142)]==_0x10e5dd(0x14f))var _0x5ea203=users[_0x10e5dd(0x151)];else{if(_0x39f2f9[0x0]['language']=='Chinese')var _0x5ea203=users['Chinese'];else{if(_0x39f2f9[0x0][_0x10e5dd(0x142)]==_0x10e5dd(0xda))var _0x5ea203=users['Arabic'];}}}}}}}_0xd83a63['render'](_0x10e5dd(0x149),{'success':_0x5afa9a['flash']('success'),'errors':_0x5afa9a[_0x10e5dd(0xf0)](_0x10e5dd(0x174)),'role':_0x389c7f,'profile':_0x214ea6,'adjustment':_0x20ed1e,'stock':_0x11c1e9,'master_shop':_0x39f2f9,'warehouse_name':_0x5f1f67,'unit':_0x4fc5c1,'language':_0x5ea203});}catch(_0x4bea78){console[_0x10e5dd(0x12a)](_0x4bea78),_0xd83a63[_0x10e5dd(0x180)](0xc8)[_0x10e5dd(0x10f)]({'message':_0x4bea78[_0x10e5dd(0x121)]});}}),router[a0_0x4452f7(0xdc)]('/preview/:id',auth,async(_0x4c36fb,_0x5c66b7)=>{var _0x449b69=a0_0x4452f7;try{const {invoice:_0x2737fe,warehouse_name:_0x276339,Room_name:_0x4b970f}=_0x4c36fb[_0x449b69(0x17b)],_0x109d25=_0x4c36fb['params']['id'],_0x33ed2a=await adjustment_finished['findById']({'_id':_0x109d25});var _0x5940dd;const _0x49dce0=_0x33ed2a['product'][_0x449b69(0x139)](async _0x27b2dc=>{var _0x554ec1=_0x449b69;if(_0x27b2dc[_0x554ec1(0x11c)]>0x0){_0x5940dd=await warehouse[_0x554ec1(0xfb)]({'name':_0x276339,'room':_0x27b2dc['room_names']});const _0x53243c=_0x5940dd[_0x554ec1(0x140)][_0x554ec1(0x139)](_0x59396d=>{var _0x5bcff7=_0x554ec1;console[_0x5bcff7(0x12a)](_0x27b2dc[_0x5bcff7(0xeb)]);if(_0x27b2dc[_0x5bcff7(0xeb)]==_0x5bcff7(0x158))_0x59396d[_0x5bcff7(0x101)]==_0x27b2dc[_0x5bcff7(0x104)]&&(_0x59396d[_0x5bcff7(0x133)]=_0x59396d[_0x5bcff7(0x133)]-_0x27b2dc[_0x5bcff7(0x11c)]);else _0x27b2dc['types']=='add'&&(_0x59396d['_id']==_0x27b2dc[_0x5bcff7(0x104)]&&(_0x59396d[_0x5bcff7(0x133)]=_0x59396d[_0x5bcff7(0x133)]+_0x27b2dc[_0x5bcff7(0x11c)]));});}return _0x5940dd;});Promise[_0x449b69(0xe3)](_0x49dce0)['then'](async _0x3dce45=>{var _0x2865f4=_0x449b69;try{for(const _0x3214e1 of _0x3dce45){await _0x3214e1[_0x2865f4(0x143)]();}_0x33ed2a[_0x2865f4(0x15b)]=_0x2865f4(0x169);const _0x2f1b93=await _0x33ed2a[_0x2865f4(0x143)](),_0x27834e=await master_shop[_0x2865f4(0x11e)](),_0x530a6b=await email_settings['findOne'](),_0x368477=await supervisor_settings[_0x2865f4(0x11e)]();var _0x2f6d32=_0x33ed2a[_0x2865f4(0x146)],_0x13429d='',_0x5c0b34;for(_0x5c0b34 in _0x2f6d32){var _0x273702='FG';_0x33ed2a[_0x2865f4(0x13e)]==_0x2865f4(0x11a)&&(_0x273702='DG'),_0x13429d+=_0x2865f4(0x179)+_0x2865f4(0x125)+_0x2f6d32[_0x5c0b34][_0x2865f4(0x105)]+_0x2865f4(0x161)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f6d32[_0x5c0b34][_0x2865f4(0xe9)]+_0x2865f4(0x161)+_0x2865f4(0x125)+_0x2f6d32[_0x5c0b34]['adjust_qty']+_0x2865f4(0x161)+_0x2865f4(0x125)+_0x2f6d32[_0x5c0b34][_0x2865f4(0xe7)]+_0x2865f4(0x161)+_0x2865f4(0x125)+_0x2f6d32[_0x5c0b34][_0x2865f4(0x103)]+_0x2865f4(0x161)+_0x2865f4(0x125)+_0x33ed2a[_0x2865f4(0x13e)]+_0x2865f4(0x161)+_0x2865f4(0x125)+_0x2f6d32[_0x5c0b34][_0x2865f4(0x117)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x273702+_0x2f6d32[_0x5c0b34][_0x2865f4(0x14e)]+_0x2865f4(0x161)+_0x2865f4(0x13d);}_0x4c36fb[_0x2865f4(0xf0)]('success','Adjustment\x20Finalize\x20Successfully'),_0x5c66b7[_0x2865f4(0x144)](_0x2865f4(0x137)+_0x2f1b93[_0x2865f4(0x101)]);}catch(_0x228fb5){console['error'](_0x228fb5),_0x5c66b7[_0x2865f4(0x180)](0x1f4)[_0x2865f4(0x10f)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0xd90ce8=>{var _0x4591a8=_0x449b69;console[_0x4591a8(0x12b)](_0xd90ce8),_0x5c66b7[_0x4591a8(0x180)](0x1f4)[_0x4591a8(0x10f)]({'error':_0x4591a8(0x16f)});});}catch(_0x5838a7){_0x5c66b7['json']({'message':_0x5838a7[_0x449b69(0x121)]});}}),router[a0_0x4452f7(0x113)](a0_0x4452f7(0x141),auth,async(_0x474b4a,_0x3beb71)=>{var _0x5651c7=a0_0x4452f7;try{const {username:_0x20b471,email:_0x1d97e5,role:_0x18f202}=_0x474b4a[_0x5651c7(0x10d)],_0xa565df=_0x474b4a[_0x5651c7(0x10d)],_0x31be00=await profile[_0x5651c7(0xfb)]({'email':_0xa565df['email']}),_0x4c7e67=await master_shop[_0x5651c7(0x11e)]();console[_0x5651c7(0x12a)]('master',_0x4c7e67);const _0x2e481d=_0x474b4a[_0x5651c7(0xf6)]['id'],_0x4b9f99=await adjustment_finished[_0x5651c7(0x126)]({'_id':_0x2e481d});let _0x171771=new Date(_0x4b9f99[_0x5651c7(0x152)]),_0xb4c0d2=('0'+_0x171771[_0x5651c7(0x162)]())[_0x5651c7(0x171)](-0x2),_0x2cc93a=('0'+(_0x171771[_0x5651c7(0xd9)]()+0x1))['slice'](-0x2),_0x5db696=_0x171771['getFullYear'](),_0x348003=_0x5db696+'-'+_0x2cc93a+'-'+_0xb4c0d2;var _0xa7ddb1=[_0x5651c7(0x110),_0x5651c7(0x118),_0x5651c7(0x154)];const _0x11c03d=await purchases[_0x5651c7(0x148)]([{'$match':{'warehouse_name':_0x4b9f99[_0x5651c7(0x13e)]}},{'$unwind':'$product'},{'$group':{'_id':_0x5651c7(0x136)}}]);console[_0x5651c7(0x12a)]('purchases_data',_0x11c03d);const _0x1216f1=await product[_0x5651c7(0x11e)]({}),_0x72a169=await warehouse[_0x5651c7(0x148)]([{'$match':{'name':_0x4b9f99['warehouse_name'],'room':_0x4b9f99['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5651c7(0x145),'name':{'$first':_0x5651c7(0x150)},'product_stock':{'$first':_0x5651c7(0xea)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5651c7(0x130)},'type':{'$first':_0x5651c7(0x17a)},'floorlevel':{'$first':_0x5651c7(0x10b)},'primary_code':{'$first':_0x5651c7(0x16d)},'secondary_code':{'$first':_0x5651c7(0x147)},'product_code':{'$first':_0x5651c7(0x178)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5651c7(0xdf)}}}]);if(_0x4c7e67[0x0]['language']==_0x5651c7(0x13c)){var _0x5f210b=users[_0x5651c7(0x168)];console[_0x5651c7(0x12a)](_0x5f210b);}else{if(_0x4c7e67[0x0][_0x5651c7(0x142)]==_0x5651c7(0x156))var _0x5f210b=users['Hindi'];else{if(_0x4c7e67[0x0]['language']==_0x5651c7(0xe1))var _0x5f210b=users[_0x5651c7(0xe1)];else{if(_0x4c7e67[0x0][_0x5651c7(0x142)]==_0x5651c7(0xe2))var _0x5f210b=users[_0x5651c7(0xe2)];else{if(_0x4c7e67[0x0]['language']==_0x5651c7(0x12f))var _0x5f210b=users[_0x5651c7(0x12f)];else{if(_0x4c7e67[0x0]['language']==_0x5651c7(0x14f))var _0x5f210b=users[_0x5651c7(0x151)];else{if(_0x4c7e67[0x0]['language']==_0x5651c7(0x131))var _0x5f210b=users['Chinese'];else{if(_0x4c7e67[0x0]['language']==_0x5651c7(0xda))var _0x5f210b=users['Arabic'];}}}}}}}_0x3beb71['render'](_0x5651c7(0x132),{'success':_0x474b4a[_0x5651c7(0xf0)](_0x5651c7(0xf4)),'errors':_0x474b4a[_0x5651c7(0xf0)](_0x5651c7(0x174)),'role':_0xa565df,'profile':_0x31be00,'adjustment':_0x4b9f99,'stock':_0x72a169,'master_shop':_0x4c7e67,'warehouse_name':_0x11c03d,'unit':_0x1216f1,'language':_0x5f210b,'rooms_data':_0xa7ddb1,'ed_fullDate':_0x348003});}catch(_0x1cc67d){console[_0x5651c7(0x12a)](_0x1cc67d),_0x3beb71[_0x5651c7(0x180)](0xc8)[_0x5651c7(0x10f)]({'message':_0x1cc67d[_0x5651c7(0x121)]});}}),router[a0_0x4452f7(0xdc)](a0_0x4452f7(0x141),auth,async(_0x328c20,_0xbb9269)=>{var _0x12ee13=a0_0x4452f7;try{const _0x3840ba=_0x328c20[_0x12ee13(0xf6)]['id'],_0x19247e=await adjustment_finished[_0x12ee13(0x126)]({'_id':_0x3840ba}),_0x1033b0=await warehouse[_0x12ee13(0xfb)]({'name':_0x19247e[_0x12ee13(0x13e)],'room':_0x19247e[_0x12ee13(0x109)]}),{warehouse_name:_0x4034c7,date:_0x12714a,prod_name:_0x29bb10,level:_0x259cf9,isle:_0x5c65ea,pallet:_0x2d5d42,stock:_0x4f345f,types:_0x570366,adjust_qty:_0x481ceb,new_adjust_qty:_0x18c6ac,note:_0x325e52,Room_name:_0x3f68a3,invoice:_0x473252,JO_number:_0x224da5}=_0x328c20['body'];if(typeof _0x29bb10==_0x12ee13(0x181))var _0x5680a4=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xf9)]],_0x579c61=[_0x328c20['body'][_0x12ee13(0x10c)]],_0x2c8e05=[_0x328c20['body'][_0x12ee13(0x134)]],_0x32c7d6=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xeb)]],_0x5833dd=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0x11c)]],_0x402499=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xee)]],_0xf8e81a=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0x11b)]],_0x472ef9=[_0x328c20['body'][_0x12ee13(0xe7)]],_0x1e09ee=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xe5)]],_0x1e4b4a=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0x16c)]],_0x2b81ee=[_0x328c20[_0x12ee13(0x17b)][_0x12ee13(0x152)]];else var _0x5680a4=[..._0x328c20['body']['prod_name']],_0x579c61=[..._0x328c20[_0x12ee13(0x17b)]['level']],_0x2c8e05=[..._0x328c20[_0x12ee13(0x17b)][_0x12ee13(0x134)]],_0x32c7d6=[..._0x328c20[_0x12ee13(0x17b)]['types']],_0x5833dd=[..._0x328c20['body'][_0x12ee13(0x11c)]],_0x402499=[..._0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xee)]],_0xf8e81a=[..._0x328c20['body'][_0x12ee13(0x11b)]],_0x472ef9=[..._0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xe7)]],_0x1e09ee=[..._0x328c20[_0x12ee13(0x17b)][_0x12ee13(0xe5)]],_0x1e4b4a=[..._0x328c20[_0x12ee13(0x17b)][_0x12ee13(0x16c)]],_0x2b81ee=[..._0x328c20[_0x12ee13(0x17b)]['expiry_date']];const _0x5829c8=_0x5680a4[_0x12ee13(0x139)](_0x361769=>{return _0x361769={'product_name':_0x361769};});_0x579c61['forEach']((_0x4f2063,_0x3145f9)=>{var _0x2f00bb=_0x12ee13;_0x5829c8[_0x3145f9][_0x2f00bb(0x14e)]=_0x4f2063;}),_0x2c8e05[_0x12ee13(0x15f)]((_0x83e484,_0x42a44e)=>{_0x5829c8[_0x42a44e]['stockBefore']=_0x83e484;}),_0x32c7d6[_0x12ee13(0x15f)]((_0x382c60,_0x69cc55)=>{_0x5829c8[_0x69cc55]['types']=_0x382c60;}),_0x5833dd['forEach']((_0x412be9,_0x42ab14)=>{var _0x224e0b=_0x12ee13;_0x5829c8[_0x42ab14][_0x224e0b(0x11c)]=_0x412be9;}),_0x402499[_0x12ee13(0x15f)]((_0x232adb,_0x4b5ecf)=>{var _0x42e658=_0x12ee13;_0x5829c8[_0x4b5ecf][_0x42e658(0xee)]=_0x232adb;}),_0x472ef9[_0x12ee13(0x15f)]((_0x497aac,_0x38b57e)=>{_0x5829c8[_0x38b57e]['unit']=_0x497aac;}),_0x1e09ee[_0x12ee13(0x15f)]((_0x355bab,_0x307044)=>{var _0x31a83a=_0x12ee13;_0x5829c8[_0x307044][_0x31a83a(0x103)]=_0x355bab;}),_0xf8e81a[_0x12ee13(0x15f)]((_0x3656a6,_0x2f6844)=>{_0x5829c8[_0x2f6844]['product_code']=_0x3656a6;}),_0x1e4b4a[_0x12ee13(0x15f)]((_0x3f3d45,_0x717512)=>{_0x5829c8[_0x717512]['batch_code']=_0x3f3d45;}),_0x2b81ee[_0x12ee13(0x15f)]((_0x281cc6,_0x254a38)=>{var _0x3cd0c1=_0x12ee13;_0x5829c8[_0x254a38][_0x3cd0c1(0x152)]=_0x281cc6;});const _0x496239=_0x5829c8[_0x12ee13(0x175)](_0x5f0a91=>_0x5f0a91['adjust_qty']!=='0'&&_0x5f0a91[_0x12ee13(0x11c)]!=='');var _0x40b675=0x0;_0x496239[_0x12ee13(0x15f)](_0x5ca6e5=>{var _0x2e87ef=_0x12ee13;console[_0x2e87ef(0x12a)](_0x2e87ef(0x119),_0x5ca6e5),parseInt(_0x5ca6e5[_0x2e87ef(0x11c)])<=0x0&&_0x40b675++;});if(_0x40b675!=0x0)return _0x328c20[_0x12ee13(0xf0)](_0x12ee13(0x174),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0xbb9269[_0x12ee13(0x144)](_0x12ee13(0x157));_0x19247e[_0x12ee13(0x13e)]=_0x4034c7,_0x19247e['date']=_0x12714a,_0x19247e[_0x12ee13(0x146)]=_0x496239,_0x19247e['note']=_0x325e52,_0x19247e[_0x12ee13(0x109)]=_0x3f68a3,_0x19247e[_0x12ee13(0xe8)]=_0x473252,_0x19247e[_0x12ee13(0x15e)]=_0x224da5;const _0xe7f24c=await _0x19247e[_0x12ee13(0x143)](),_0x2e1020=await warehouse[_0x12ee13(0xfb)]({'name':_0x4034c7,'room':_0x3f68a3});_0xe7f24c[_0x12ee13(0x146)][_0x12ee13(0x15f)](_0xe144f8=>{const _0x5960e0=_0x2e1020['product_details']['map'](_0x1266bf=>{var _0x5264c5=a0_0x1086;_0xe144f8[_0x5264c5(0xeb)]==_0x5264c5(0x158)?_0x1266bf[_0x5264c5(0x105)]==_0xe144f8[_0x5264c5(0x105)]&&_0x1266bf[_0x5264c5(0x14e)]==_0xe144f8[_0x5264c5(0x14e)]&&(_0x1266bf[_0x5264c5(0x133)]=parseInt(_0x1266bf[_0x5264c5(0x133)])-parseInt(_0xe144f8[_0x5264c5(0x11c)])):_0x1266bf[_0x5264c5(0x105)]==_0xe144f8[_0x5264c5(0x105)]&&_0x1266bf[_0x5264c5(0x14e)]==_0xe144f8[_0x5264c5(0x14e)]&&(_0x1266bf['product_stock']=parseInt(_0x1266bf[_0x5264c5(0x133)])+parseInt(_0xe144f8[_0x5264c5(0x11c)]));});}),await _0x2e1020['save'](),_0x328c20[_0x12ee13(0xf0)](_0x12ee13(0xf4),_0x12ee13(0x159)),_0xbb9269['redirect']('/adjustment_finished/view');}catch(_0x3fa0ff){console[_0x12ee13(0x12a)](_0x3fa0ff);}}),router[a0_0x4452f7(0xdc)](a0_0x4452f7(0x170),async(_0x1549b7,_0x530ad0)=>{var _0x263ca4=a0_0x4452f7;const {primary_code:_0x1a07de,warehouse_data:_0x235681,rooms_data:_0x43e5d5,Roomslist:_0x2a6a8d}=_0x1549b7['body'],_0x41c34c=_0x2a6a8d[_0x263ca4(0x17e)](','),_0x523c11=[];async function _0xfca021(_0x7e7810){var _0x5a8071=_0x263ca4;const _0x3046b4=await warehouse[_0x5a8071(0x148)]([{'$match':{'name':_0x235681,'room':_0x7e7810}},{'$unwind':_0x5a8071(0xd8)},{'$match':{'product_details.primary_code':_0x1a07de}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5a8071(0x150)},'product_stock':{'$first':_0x5a8071(0xea)},'primary_code':{'$first':_0x5a8071(0x16d)},'secondary_code':{'$first':_0x5a8071(0x147)},'product_code':{'$first':_0x5a8071(0x178)},'level':{'$first':_0x5a8071(0x129)},'bay':{'$first':_0x5a8071(0x135)},'type':{'$first':_0x5a8071(0x17a)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x5a8071(0x100)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x5a8071(0x12c)},'rack':{'$first':_0x5a8071(0xdf)},'expiry_date':{'$first':_0x5a8071(0x10a)},'production_date':{'$first':_0x5a8071(0x160)},'batch_code':{'$first':_0x5a8071(0xfa)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x5a8071(0x128)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x141d9a=await warehouse[_0x5a8071(0x148)]([{'$match':{'name':_0x235681,'room':_0x7e7810}},{'$unwind':_0x5a8071(0xd8)},{'$match':{'product_details.secondary_code':_0x1a07de}},{'$group':{'_id':_0x5a8071(0x145),'name':{'$first':_0x5a8071(0x150)},'product_stock':{'$first':_0x5a8071(0xea)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5a8071(0x147)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5a8071(0x129)},'bay':{'$first':_0x5a8071(0x135)},'type':{'$first':_0x5a8071(0x17a)},'pallet':{'$first':_0x5a8071(0x10b)},'unit':{'$first':_0x5a8071(0x100)},'secondary_unit':{'$first':_0x5a8071(0x11d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5a8071(0xdf)},'expiry_date':{'$first':_0x5a8071(0x10a)},'production_date':{'$first':_0x5a8071(0x160)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5a8071(0x128)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x5a8071(0x122)}}}]);if(_0x3046b4[_0x5a8071(0x11f)]>0x0)_0x523c11[_0x5a8071(0xf5)](_0x3046b4);else _0x141d9a['length']>0x0&&_0x523c11[_0x5a8071(0xf5)](_0x141d9a);}const _0x2baea6=_0x41c34c['map'](_0x2c3097=>_0xfca021(_0x2c3097));await Promise['all'](_0x2baea6),_0x530ad0[_0x263ca4(0x10f)](_0x523c11);}),router[a0_0x4452f7(0xdc)](a0_0x4452f7(0x13b),async(_0xc9d33f,_0xfd07e9)=>{var _0x923b9c=a0_0x4452f7;const {productCode:_0x2c5edb,bay:_0x266079,warehouses:_0x3f4c47,room:_0x59755b}=_0xc9d33f['body'];console[_0x923b9c(0x12a)](_0xc9d33f['body']);try{const _0x38334d=await warehouse[_0x923b9c(0x148)]([{'$match':{'name':_0x3f4c47,'room':_0x59755b}},{'$unwind':_0x923b9c(0xd8)},{'$match':{'product_details.bay':parseInt(_0x266079)}},{'$group':{'_id':_0x923b9c(0x145),'name':{'$first':_0x923b9c(0x150)},'product_stock':{'$first':_0x923b9c(0xea)},'bay':{'$first':_0x923b9c(0x135)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xfd07e9[_0x923b9c(0x180)](0xc8)[_0x923b9c(0x10f)](_0x38334d);}catch(_0x4a0ae6){_0xfd07e9[_0x923b9c(0x180)](0x194)[_0x923b9c(0x10f)]({'message':_0x4a0ae6[_0x923b9c(0x121)]});}}),module[a0_0x4452f7(0x14c)]=router;function a0_0x402c(){var _0x1ca4aa=['product_code','$product_details.product_stock','types','adjustment_finished_logs','/view','new_adjust_qty','2056662uHwPJp','flash','2822892NATiHO','$invoice','10532CAkUKO','success','push','params','497274YCTmJr','1yTBcbX','prod_name','$product_details.batch_code','findOne','production_date','32208FfwTEs','random','LOG-ADJ-','$product_details.unit','_id','$product','secondary_unit','id_transaction','product_name','catch','../public/language/languages.json','$warehouse_name','room','$product_details.expiry_date','$product_details.floorlevel','level','user','maxPerUnit','json','Ambient','ADJF-','stockBefore','get','/adjustment_finished/preview/','render','logs','room_names','Enclosed','foreach\x20newproduct','DRY\x20GOODS','prod_code','adjust_qty','$product_details.secondary_unit','find','length','../middleware/auth','message','$product_details.invoice','/adjustment/view','833kTSaRR','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','findById','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.maxPerUnit','$product_details.level','log','error','$product_details.storage','add_adjustment_finished','Primary_Units','French','$product_details.bin','Chinese','edit_adjustment_finished','product_stock','stock','$product_details.bay','$product.product_name','/picking_list/PDF_adjustmentFinal/','match','map','id_transaction_from','/CheckingWarehouse','English\x20(US)','</tr>','warehouse_name','floor','product_details','/view/:id','language','save','redirect','$product_details._id','product','$product_details.secondary_code','aggregate','edit_adjustment_finished_view','$finalize','prod_invoice','exports','Rooms','bay','Portuguese\x20(BR)','$product_details.product_name','Portuguese','expiry_date','/view/add_adjustment_logs','Return\x20Rooms','product_date','Hindi','back','minus','adjustment\x20data\x20update\x20successfully','toString','finalize','warehouse','express','JO_number','forEach','$product_details.production_date','</td>','getDate','525JfWEdu','$product.room_names','own','ADJ-','New_Qty_Converted','English','True','purchases_data','padStart','batch_code','$product_details.primary_code','staff','An\x20error\x20occurred.','/barcode_scanner','slice','email','$name','errors','filter','adjustment\x20add\x20successfull','prod_cat','$product_details.product_code','<tr>','$product_details.type','body','Enabled','5988620YlRnKu','split','role','status','string','New_Qty_Converted_adj','$date','$product_details','getMonth','Arabic\x20(ae)','972895bzVxyr','post','There\x27s\x20a\x20error\x20in\x20this\x20transaction','invoice_init','$product_details.rack','/view_logs','German','Spanish','all','Arabic','Secondary_units','/view/add_adjustment','unit','invoice'];a0_0x402c=function(){return _0x1ca4aa;};return a0_0x402c();}