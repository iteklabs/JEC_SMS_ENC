var a0_0x4addaf=a0_0x1386;function a0_0x1fae(){var _0x247602=['staff','post','add_adjustment_finished','Primary_Units','invoice','Arabic\x20(ae)','Hindi','email','$warehouse_name','errors','DRY\x20GOODS','307nmvDKa','map','$product_details._id','render','$product_details.secondary_code','match','get','product_date','2971929uzxans','error','New_Qty_Converted_adj','$product_details.maxProducts','2670975tIlMIM','prod_name','redirect','<tr>','adjustment\x20data\x20update\x20successfully','Rooms','findOne','user','string','566757RUUhmz','$invoice','product_name','$date','</td>','getFullYear','save','Chinese','types','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','_id','foreach\x20newproduct','adjust_qty','warehouse_name','26364llcKyg','Portuguese','Arabic','room','adjustment_finished','$product_details.product_name','$product_details.storage','findById','An\x20error\x20occurred.','then','padStart','nodemailer','log','catch','$product_details.secondary_unit','id_transaction_from','new_adjust_qty','ADJ-','/preview/:id','length','4iySLSL','bay','add','invoice_init','prod_code','room_names','unit','New_Qty_Converted','$product_details.bay','own','Secondary_units','forEach','getDate','product_details','Ambient','Enclosed','secondary_unit','adjustment\x20add\x20successfull','$product_details.primary_code','German','message','$product_details.invoice','purchases_data','product_code','find','Enabled','back','json','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','English','True','130062efjoRq','toString','$product_details.batch_code','aggregate','$product.product_name','Portuguese\x20(BR)','161YVqRnt','stock','role','$product_details.bin','/adjustment_finished/view','$room','There\x27s\x20a\x20error\x20in\x20this\x20transaction','logs','An\x20error\x20occurred\x20while\x20saving\x20data.','minus','/adjustment/view','warehouse','filter','Spanish','$product_details.unit','/view/add_adjustment','4458WlINco','5349032MIkSQe','batch_code','success','$product','master','push','prod_invoice','express','production_date','edit_adjustment_finished_view','English\x20(US)','expiry_date','$product_details','body','note','params','slice','maxPerUnit','id_transaction','/barcode_scanner','$product_details.product_stock','language','add_adjustment_finished_logs','</tr>','product_stock','$product_details.type','$product_details.maxPerUnit','$product_details.expiry_date','flash','10505DrdsBh','$product_details.product_code','adjustment_finished_logs','/picking_list/PDF_adjustmentFinal/','$finalize','status','/view/add_adjustment_logs','$product_details.floorlevel','getMonth','../middleware/auth','ADJF-','/view','random','$name','/CheckingWarehouse','prod_cat','90HGqrjV','level','all','$product_details.rack','product','edit_adjustment_finished','French'];a0_0x1fae=function(){return _0x247602;};return a0_0x1fae();}(function(_0x3628f4,_0x4ff48c){var _0x23635b=a0_0x1386,_0x1720db=_0x3628f4();while(!![]){try{var _0x2bbbb7=parseInt(_0x23635b(0xbb))/0x1*(parseInt(_0x23635b(0x127))/0x2)+-parseInt(_0x23635b(0xc3))/0x3*(parseInt(_0x23635b(0xf2))/0x4)+-parseInt(_0x23635b(0xc7))/0x5+-parseInt(_0x23635b(0x111))/0x6*(-parseInt(_0x23635b(0x117))/0x7)+-parseInt(_0x23635b(0x128))/0x8+parseInt(_0x23635b(0xd0))/0x9*(-parseInt(_0x23635b(0xa9))/0xa)+parseInt(_0x23635b(0x99))/0xb*(parseInt(_0x23635b(0xde))/0xc);if(_0x2bbbb7===_0x4ff48c)break;else _0x1720db['push'](_0x1720db['shift']());}catch(_0x255d28){_0x1720db['push'](_0x1720db['shift']());}}}(a0_0x1fae,0x7f251));function a0_0x1386(_0x586bc3,_0x46432e){var _0x1fae56=a0_0x1fae();return a0_0x1386=function(_0x13861f,_0x50f758){_0x13861f=_0x13861f-0x91;var _0x488c59=_0x1fae56[_0x13861f];return _0x488c59;},a0_0x1386(_0x586bc3,_0x46432e);}const express=require(a0_0x4addaf(0x12f)),app=express(),router=express['Router'](),auth=require(a0_0x4addaf(0xa2)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x4addaf(0xe9));router[a0_0x4addaf(0xc1)](a0_0x4addaf(0xa4),auth,async(_0x128a02,_0x25fb5a)=>{var _0x596b99=a0_0x4addaf;try{const {username:_0x5e96d9,email:_0x39d4c6,role:_0x2b0200}=_0x128a02[_0x596b99(0xce)],_0x12fad4=_0x128a02['user'],_0x2e6590=await profile[_0x596b99(0xcd)]({'email':_0x12fad4[_0x596b99(0xb7)]}),_0x24943d=await master_shop[_0x596b99(0x10a)]();let _0x2b5d50;if(_0x12fad4[_0x596b99(0x119)]=='staff'){const _0x1a9969=await staff[_0x596b99(0xcd)]({'email':_0x12fad4[_0x596b99(0xb7)]});_0x2b5d50=await warehouse[_0x596b99(0x10a)]({'status':_0x596b99(0x10b),'name':_0x1a9969[_0x596b99(0x122)]});}else _0x2b5d50=await warehouse['find']({'status':_0x596b99(0x10b)});const _0x2a720a=await product['find']();let _0x58979d;if(_0x12fad4[_0x596b99(0x119)]==_0x596b99(0xb0)){const _0x54acbd=await staff[_0x596b99(0xcd)]({'email':_0x12fad4['email']});_0x58979d=await adjustment_finished[_0x596b99(0x10a)]({'warehouse_name':_0x54acbd['warehouse']});}else _0x58979d=await adjustment_finished[_0x596b99(0x114)]([{'$match':{'type_of_transaction':_0x596b99(0xfb)}},{'$unwind':_0x596b99(0x12b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x596b99(0xd1)},'date':{'$first':_0x596b99(0xd3)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x596b99(0x9d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x24943d[0x0][_0x596b99(0x91)]==_0x596b99(0x132)){var _0x161954=users[_0x596b99(0x10f)];console['log'](_0x161954);}else{if(_0x24943d[0x0][_0x596b99(0x91)]==_0x596b99(0xb6))var _0x161954=users['Hindi'];else{if(_0x24943d[0x0][_0x596b99(0x91)]=='German')var _0x161954=users[_0x596b99(0x105)];else{if(_0x24943d[0x0][_0x596b99(0x91)]==_0x596b99(0x124))var _0x161954=users['Spanish'];else{if(_0x24943d[0x0]['language']==_0x596b99(0xaf))var _0x161954=users[_0x596b99(0xaf)];else{if(_0x24943d[0x0][_0x596b99(0x91)]=='Portuguese\x20(BR)')var _0x161954=users[_0x596b99(0xdf)];else{if(_0x24943d[0x0][_0x596b99(0x91)]=='Chinese')var _0x161954=users[_0x596b99(0xd7)];else{if(_0x24943d[0x0][_0x596b99(0x91)]==_0x596b99(0xb5))var _0x161954=users[_0x596b99(0xe0)];}}}}}}}_0x25fb5a[_0x596b99(0xbe)](_0x596b99(0xe2),{'success':_0x128a02['flash'](_0x596b99(0x12a)),'errors':_0x128a02['flash'](_0x596b99(0xb9)),'role':_0x12fad4,'profile':_0x2e6590,'warehouse':_0x2b5d50,'product':_0x2a720a,'adjustment':_0x58979d,'master_shop':_0x24943d,'language':_0x161954});}catch(_0x131d25){console['log'](_0x131d25);}}),router[a0_0x4addaf(0xc1)]('/view_logs',auth,async(_0x1e5d91,_0x52de7e)=>{var _0x25d568=a0_0x4addaf;try{const {username:_0x5c1cf7,email:_0x387ece,role:_0x22c0a9}=_0x1e5d91[_0x25d568(0xce)],_0x3f6836=_0x1e5d91[_0x25d568(0xce)],_0x34d38e=await profile['findOne']({'email':_0x3f6836[_0x25d568(0xb7)]}),_0x38964e=await master_shop[_0x25d568(0x10a)]();let _0x518ad8;if(_0x3f6836['role']==_0x25d568(0xb0)){const _0x43fb90=await staff[_0x25d568(0xcd)]({'email':_0x3f6836[_0x25d568(0xb7)]});_0x518ad8=await warehouse[_0x25d568(0x10a)]({'status':_0x25d568(0x10b),'name':_0x43fb90[_0x25d568(0x122)]});}else _0x518ad8=await warehouse[_0x25d568(0x10a)]({'status':_0x25d568(0x10b)});const _0x49eee6=await product[_0x25d568(0x10a)]();let _0x1b37f2;if(_0x3f6836['role']=='staff'){const _0x48e6a0=await staff['findOne']({'email':_0x3f6836[_0x25d568(0xb7)]});_0x1b37f2=await adjustment_finished[_0x25d568(0x10a)]({'warehouse_name':_0x48e6a0[_0x25d568(0x122)]});}else _0x1b37f2=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x25d568(0x11e)}},{'$unwind':_0x25d568(0x12b)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x25d568(0xd3)},'warehouse_name':{'$first':_0x25d568(0xb8)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x38964e[0x0][_0x25d568(0x91)]==_0x25d568(0x132))var _0x50cdb9=users[_0x25d568(0x10f)];else{if(_0x38964e[0x0]['language']=='Hindi')var _0x50cdb9=users['Hindi'];else{if(_0x38964e[0x0][_0x25d568(0x91)]=='German')var _0x50cdb9=users[_0x25d568(0x105)];else{if(_0x38964e[0x0][_0x25d568(0x91)]=='Spanish')var _0x50cdb9=users[_0x25d568(0x124)];else{if(_0x38964e[0x0]['language']=='French')var _0x50cdb9=users['French'];else{if(_0x38964e[0x0][_0x25d568(0x91)]=='Portuguese\x20(BR)')var _0x50cdb9=users[_0x25d568(0xdf)];else{if(_0x38964e[0x0][_0x25d568(0x91)]==_0x25d568(0xd7))var _0x50cdb9=users[_0x25d568(0xd7)];else{if(_0x38964e[0x0][_0x25d568(0x91)]=='Arabic\x20(ae)')var _0x50cdb9=users[_0x25d568(0xe0)];}}}}}}}_0x52de7e[_0x25d568(0xbe)](_0x25d568(0x9b),{'success':_0x1e5d91['flash'](_0x25d568(0x12a)),'errors':_0x1e5d91['flash']('errors'),'role':_0x3f6836,'profile':_0x34d38e,'warehouse':_0x518ad8,'product':_0x49eee6,'adjustment':_0x1b37f2,'master_shop':_0x38964e,'language':_0x50cdb9});}catch(_0x25864d){console[_0x25d568(0xea)](_0x25864d);}});async function getRandom8DigitNumber(){var _0x145963=a0_0x4addaf;const _0x394ee5=0x989680,_0x40cd62=0x5f5e0ff,_0x1250bb=Math['floor'](Math[_0x145963(0xa5)]()*(_0x40cd62-_0x394ee5+0x1))+_0x394ee5;var _0x51552c;const _0x52a6c4=await adjustment_finished[_0x145963(0xcd)]({'invoice':_0x145963(0xa3)+_0x1250bb});return _0x52a6c4&&_0x52a6c4[_0x145963(0xf1)]>0x0?_0x51552c=_0x145963(0xa3)+_0x1250bb:_0x51552c=_0x145963(0xa3)+_0x1250bb,_0x51552c;}router[a0_0x4addaf(0xc1)]('/view/add_adjustment',auth,async(_0x81090b,_0xe27ecb)=>{var _0xa902a3=a0_0x4addaf;try{const {username:_0x56f4d3,email:_0x130a6c,role:_0x5c39bb}=_0x81090b[_0xa902a3(0xce)],_0x4492d3=_0x81090b[_0xa902a3(0xce)],_0x560581=await profile['findOne']({'email':_0x4492d3[_0xa902a3(0xb7)]}),_0x46a082=await master_shop[_0xa902a3(0x10a)]();let _0x122e29;if(_0x4492d3[_0xa902a3(0x119)]==_0xa902a3(0xb0)){const _0x3712f0=await staff[_0xa902a3(0xcd)]({'email':_0x4492d3['email']});_0x122e29=await warehouse[_0xa902a3(0x114)]([{'$match':{'status':_0xa902a3(0x10b),'name':_0x3712f0[_0xa902a3(0x122)]}},{'$group':{'_id':_0xa902a3(0xa6),'name':{'$first':_0xa902a3(0xa6)}}}]);}else _0x122e29=await warehouse['aggregate']([{'$match':{'status':_0xa902a3(0x10b)}},{'$group':{'_id':'$name','name':{'$first':_0xa902a3(0xa6)}}}]);const _0x143e9c=await product['find']({}),_0x4e0e00=await adjustment_finished[_0xa902a3(0x10a)](),_0xa677db=_0x4e0e00[_0xa902a3(0xf1)]+0x1,_0x3fb965=_0xa902a3(0xa3)+_0xa677db[_0xa902a3(0x112)]()['padStart'](0x5,'0');var _0x2c97ef=[_0xa902a3(0x100),_0xa902a3(0x101),'Return\x20Rooms'];if(_0x46a082[0x0]['language']=='English\x20(US)')var _0x378fa4=users['English'];else{if(_0x46a082[0x0][_0xa902a3(0x91)]==_0xa902a3(0xb6))var _0x378fa4=users[_0xa902a3(0xb6)];else{if(_0x46a082[0x0][_0xa902a3(0x91)]=='German')var _0x378fa4=users[_0xa902a3(0x105)];else{if(_0x46a082[0x0][_0xa902a3(0x91)]=='Spanish')var _0x378fa4=users[_0xa902a3(0x124)];else{if(_0x46a082[0x0][_0xa902a3(0x91)]==_0xa902a3(0xaf))var _0x378fa4=users[_0xa902a3(0xaf)];else{if(_0x46a082[0x0][_0xa902a3(0x91)]==_0xa902a3(0x116))var _0x378fa4=users[_0xa902a3(0xdf)];else{if(_0x46a082[0x0][_0xa902a3(0x91)]=='Chinese')var _0x378fa4=users[_0xa902a3(0xd7)];else{if(_0x46a082[0x0][_0xa902a3(0x91)]==_0xa902a3(0xb5))var _0x378fa4=users[_0xa902a3(0xe0)];}}}}}}}const _0x28a1e5=getRandom8DigitNumber();_0x28a1e5['then'](_0xce7ee0=>{var _0x195845=_0xa902a3;_0xe27ecb['render'](_0x195845(0xb2),{'success':_0x81090b['flash']('success'),'errors':_0x81090b[_0x195845(0x98)](_0x195845(0xb9)),'role':_0x4492d3,'profile':_0x560581,'warehouse':_0x122e29,'product':_0x143e9c,'master_shop':_0x46a082,'language':_0x378fa4,'rooms_data':_0x2c97ef,'invoice_no':_0xce7ee0});})['catch'](_0x3b9827=>{var _0x1456c3=_0xa902a3;_0x81090b[_0x1456c3(0x98)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xe27ecb['redirect'](_0x1456c3(0x121));});}catch(_0x4fcc01){console['log'](_0x4fcc01);}}),router[a0_0x4addaf(0xb1)](a0_0x4addaf(0x126),auth,async(_0x222eb9,_0x4c3d22)=>{var _0x4c3986=a0_0x4addaf;try{const {warehouse_name:_0x274341,date:_0x3be94b,prod_name:_0x32e31f,level:_0xe1ad0c,isle:_0x656c05,pallet:_0x2ec777,stock:_0x28cf6e,types:_0x3cda0d,adjust_qty:_0x5a7eb7,new_adjust_qty:_0x2f198c,note:_0x5818d9,Room_name:_0x4925ed,JO_number:_0x501ee4,expiry_date:_0x32911c,PO_number:_0x5e3dd6,ReqBy:_0x328a77,dateofreq:_0x20819c,typeservicesData:_0x23caaa,destination:_0x3229c1,deliverydate:_0x1e999,driver:_0x452d7b,plate:_0xe23752,van:_0x39f213,DRSI:_0x3e1298,typevehicle:_0x1724d2,TSU:_0x50b1b0,TFU:_0x2f36a0}=_0x222eb9[_0x4c3986(0x135)];if(typeof _0x32e31f==_0x4c3986(0xcf))var _0x1ee00c=[_0x222eb9['body'][_0x4c3986(0xc8)]],_0x68e2e2=[_0x222eb9[_0x4c3986(0x135)]['level']],_0x50cda9=[_0x222eb9['body']['stock']],_0x1f3539=[_0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xd8)]],_0x487fe2=[_0x222eb9['body'][_0x4c3986(0xc5)]],_0x5067f8=[_0x222eb9[_0x4c3986(0x135)]['New_Qty_Converted']],_0x5550fa=[_0x222eb9[_0x4c3986(0x135)]['Primary_Units']],_0x5e5af1=[_0x222eb9[_0x4c3986(0x135)]['Secondary_units']],_0x56d1cb=[_0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xf6)]],_0x57f12f=[_0x222eb9['body'][_0x4c3986(0x129)]],_0x3e314c=[_0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x133)]],_0x51189a=[_0x222eb9['body'][_0x4c3986(0xc2)]],_0x4dc892=[_0x222eb9['body'][_0x4c3986(0xa8)]],_0x43c231=[_0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xcc)]],_0x202857=[_0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x139)]],_0xe6df87=[_0x222eb9[_0x4c3986(0x135)]['prod_invoice']],_0x1c21e8=[_0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xed)]];else var _0x1ee00c=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xc8)]],_0x68e2e2=[..._0x222eb9['body']['level']],_0x50cda9=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x118)]],_0x1f3539=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xd8)]],_0x487fe2=[..._0x222eb9['body'][_0x4c3986(0xc5)]],_0x5067f8=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xf9)]],_0x5550fa=[..._0x222eb9[_0x4c3986(0x135)]['Primary_Units']],_0x5e5af1=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xfc)]],_0x56d1cb=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xf6)]],_0x57f12f=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x129)]],_0x3e314c=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x133)]],_0x51189a=[..._0x222eb9[_0x4c3986(0x135)]['product_date']],_0x4dc892=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xa8)]],_0x43c231=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xcc)]],_0x202857=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x139)]],_0xe6df87=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0x12e)]],_0x1c21e8=[..._0x222eb9[_0x4c3986(0x135)][_0x4c3986(0xed)]];const _0x1259bd=_0x1ee00c[_0x4c3986(0xbc)](_0x1685c2=>{return _0x1685c2={'product_name':_0x1685c2};});_0x68e2e2['forEach']((_0x22cca9,_0x2a9a81)=>{var _0x1afed1=_0x4c3986,_0x10b109=_0x22cca9[_0x1afed1(0xc0)](/[A-Za-z]+/)[0x0],_0x56fb78=parseInt(_0x22cca9[_0x1afed1(0xc0)](/\d+/)[0x0]);_0x1259bd[_0x2a9a81]['level']=_0x10b109,_0x1259bd[_0x2a9a81][_0x1afed1(0xf3)]=_0x56fb78;}),_0x1c21e8[_0x4c3986(0xfd)]((_0x1365d3,_0x3b5957)=>{var _0x4ab679=_0x4c3986;_0x1259bd[_0x3b5957][_0x4ab679(0x13a)]=_0x1365d3;}),_0x50cda9[_0x4c3986(0xfd)]((_0x3f1e2c,_0x311bf0)=>{_0x1259bd[_0x311bf0]['stockBefore']=_0x3f1e2c;}),_0x1f3539[_0x4c3986(0xfd)]((_0x539a01,_0x2c57e3)=>{_0x1259bd[_0x2c57e3]['types']=_0x539a01;}),_0x487fe2[_0x4c3986(0xfd)]((_0x4ebd48,_0x462ffe)=>{var _0xc25b2=_0x4c3986;_0x1259bd[_0x462ffe][_0xc25b2(0xdc)]=_0x4ebd48;}),_0x5067f8[_0x4c3986(0xfd)]((_0x14529f,_0x3787a4)=>{_0x1259bd[_0x3787a4]['new_adjust_qty']=_0x14529f;}),_0x5550fa[_0x4c3986(0xfd)]((_0x54e8b9,_0x1d5ae8)=>{var _0x57b945=_0x4c3986;_0x1259bd[_0x1d5ae8][_0x57b945(0xf8)]=_0x54e8b9;}),_0x5e5af1['forEach']((_0x2f123e,_0x227b22)=>{var _0x2a995a=_0x4c3986;_0x1259bd[_0x227b22][_0x2a995a(0x102)]=_0x2f123e;}),_0x56d1cb[_0x4c3986(0xfd)]((_0x545e9f,_0x4ebb28)=>{_0x1259bd[_0x4ebb28]['product_code']=_0x545e9f;}),_0x57f12f[_0x4c3986(0xfd)]((_0x11c839,_0x2cf144)=>{var _0x179ef3=_0x4c3986;_0x1259bd[_0x2cf144][_0x179ef3(0x129)]=_0x11c839;}),_0x3e314c['forEach']((_0x4ec603,_0xf08f3b)=>{var _0x1e6206=_0x4c3986;_0x1259bd[_0xf08f3b][_0x1e6206(0x133)]=_0x4ec603;}),_0x51189a[_0x4c3986(0xfd)]((_0x36268a,_0x21827e)=>{var _0x6a02f3=_0x4c3986;_0x1259bd[_0x21827e][_0x6a02f3(0x130)]=_0x36268a;}),_0x4dc892[_0x4c3986(0xfd)]((_0xcccaf1,_0x342812)=>{var _0x4397cb=_0x4c3986;_0x1259bd[_0x342812][_0x4397cb(0xa8)]=_0xcccaf1;}),_0x43c231[_0x4c3986(0xfd)]((_0x462f69,_0x2f4257)=>{var _0x358080=_0x4c3986;_0x1259bd[_0x2f4257][_0x358080(0xf7)]=_0x462f69;}),_0x202857[_0x4c3986(0xfd)]((_0x363b38,_0x5d75a6)=>{var _0x46a2b2=_0x4c3986;_0x1259bd[_0x5d75a6][_0x46a2b2(0x139)]=_0x363b38;}),_0xe6df87[_0x4c3986(0xfd)]((_0x24da0c,_0x59f58a)=>{var _0x201688=_0x4c3986;_0x1259bd[_0x59f58a][_0x201688(0xb4)]=_0x24da0c;});const _0x126039=_0x1259bd['filter'](_0x528b42=>_0x528b42[_0x4c3986(0xdc)]!=='0'&&_0x528b42[_0x4c3986(0xdc)]!=='');var _0x4e52b9=0x0;_0x126039[_0x4c3986(0xfd)](_0x165690=>{var _0x154f15=_0x4c3986;console[_0x154f15(0xea)]('foreach\x20newproduct',_0x165690),parseInt(_0x165690[_0x154f15(0xdc)])<=0x0&&_0x4e52b9++;});if(_0x4e52b9!=0x0)return _0x222eb9[_0x4c3986(0x98)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x4c3d22[_0x4c3986(0xc9)](_0x4c3986(0x10c));const _0x36a94f=new invoice_for_adjustment();await _0x36a94f[_0x4c3986(0xd6)]();const _0x1f7244=new adjustment_finished({'warehouse_name':_0x274341,'date':_0x3be94b,'product':_0x126039,'note':_0x5818d9,'room':_0x4925ed,'invoice':_0x4c3986(0xef)+_0x36a94f['invoice_init'][_0x4c3986(0x112)]()[_0x4c3986(0xe8)](0x8,'0'),'JO_number':_0x501ee4,'expiry_date':_0x32911c,'PO_number':_0x5e3dd6,'RequestedBy':_0x328a77,'DateofRequest':_0x20819c,'typeservices':_0x23caaa,'destination':_0x3229c1,'deliverydate':_0x1e999,'driver':_0x452d7b,'plate':_0xe23752,'van':_0x39f213,'DRSI':_0x3e1298,'typevehicle':_0x1724d2,'TSU':_0x50b1b0,'TFU':_0x2f36a0}),_0x347221=await _0x1f7244[_0x4c3986(0xd6)]();_0x222eb9[_0x4c3986(0x98)](_0x4c3986(0x12a),'adjustment\x20add\x20successfull'),_0x4c3d22[_0x4c3986(0xc9)]('/adjustment_finished/preview/'+_0x347221[_0x4c3986(0xda)]);}catch(_0x4e8b06){console['log'](_0x4e8b06),_0x4c3d22[_0x4c3986(0x9e)](0xc8)['json']({'message':_0x4e8b06[_0x4c3986(0x106)]});}}),router['get'](a0_0x4addaf(0x9f),auth,async(_0x71c924,_0xcd46ec)=>{var _0x57ea91=a0_0x4addaf;try{const {username:_0x355ec1,email:_0x530fb6,role:_0x425477}=_0x71c924[_0x57ea91(0xce)],_0x5b6c7c=_0x71c924[_0x57ea91(0xce)],_0x44f616=await profile[_0x57ea91(0xcd)]({'email':_0x5b6c7c[_0x57ea91(0xb7)]}),_0x19b10a=await master_shop[_0x57ea91(0x10a)]();let _0x277f08;if(_0x5b6c7c[_0x57ea91(0x119)]==_0x57ea91(0xb0)){const _0x4d1e0a=await staff[_0x57ea91(0xcd)]({'email':_0x5b6c7c[_0x57ea91(0xb7)]});_0x277f08=await warehouse[_0x57ea91(0x114)]([{'$match':{'status':_0x57ea91(0x10b),'name':_0x4d1e0a['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x57ea91(0xa6)}}}]);}else _0x277f08=await warehouse[_0x57ea91(0x114)]([{'$match':{'status':_0x57ea91(0x10b)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x2157fd=await product['find'](),_0x170d34=await adjustment_finished[_0x57ea91(0x10a)](),_0x130b8a=_0x170d34[_0x57ea91(0xf1)]+0x1,_0x17203a=_0x57ea91(0xa3)+_0x130b8a['toString']()[_0x57ea91(0xe8)](0x5,'0');var _0x1052b1=['Ambient',_0x57ea91(0x101),'Return\x20Rooms'];if(_0x19b10a[0x0][_0x57ea91(0x91)]==_0x57ea91(0x132))var _0x4fff27=users[_0x57ea91(0x10f)];else{if(_0x19b10a[0x0]['language']==_0x57ea91(0xb6))var _0x4fff27=users['Hindi'];else{if(_0x19b10a[0x0][_0x57ea91(0x91)]==_0x57ea91(0x105))var _0x4fff27=users[_0x57ea91(0x105)];else{if(_0x19b10a[0x0][_0x57ea91(0x91)]=='Spanish')var _0x4fff27=users[_0x57ea91(0x124)];else{if(_0x19b10a[0x0][_0x57ea91(0x91)]==_0x57ea91(0xaf))var _0x4fff27=users[_0x57ea91(0xaf)];else{if(_0x19b10a[0x0][_0x57ea91(0x91)]==_0x57ea91(0x116))var _0x4fff27=users[_0x57ea91(0xdf)];else{if(_0x19b10a[0x0][_0x57ea91(0x91)]==_0x57ea91(0xd7))var _0x4fff27=users[_0x57ea91(0xd7)];else{if(_0x19b10a[0x0][_0x57ea91(0x91)]==_0x57ea91(0xb5))var _0x4fff27=users[_0x57ea91(0xe0)];}}}}}}}const _0x4e5a51=getRandom8DigitNumber();_0x4e5a51[_0x57ea91(0xe7)](_0x36ecd2=>{var _0x2dc443=_0x57ea91;_0xcd46ec[_0x2dc443(0xbe)](_0x2dc443(0x92),{'success':_0x71c924[_0x2dc443(0x98)](_0x2dc443(0x12a)),'errors':_0x71c924['flash']('errors'),'role':_0x5b6c7c,'profile':_0x44f616,'warehouse':_0x277f08,'product':_0x2157fd,'master_shop':_0x19b10a,'language':_0x4fff27,'rooms_data':_0x1052b1,'invoice_no':_0x36ecd2});})[_0x57ea91(0xeb)](_0x2276c1=>{var _0x586657=_0x57ea91;_0x71c924['flash']('errors',_0x586657(0x11d)),_0xcd46ec[_0x586657(0xc9)]('/adjustment/view');});}catch(_0xad1174){console[_0x57ea91(0xea)](_0xad1174);}}),router['post'](a0_0x4addaf(0x9f),auth,async(_0x146a20,_0x197ea6)=>{var _0x337c69=a0_0x4addaf;try{const {warehouse_name:_0x46934b,date:_0x3a958b,prod_name:_0x4cf6b6,level:_0x588db0,isle:_0x46e98f,pallet:_0x54e530,stock:_0x29c210,types:_0x27e8ac,adjust_qty:_0x41ecb9,new_adjust_qty:_0x56bec0,note:_0x2536cb,Room_name:_0x35ef9c,JO_number:_0x47e093,expiry_date:_0x4694fd,type_of_transaction:_0x3d2ca4,PO_number:_0x130330,ReqBy:_0x2dd2cf,dateofreq:_0x5517ff,typeservicesData:_0x44fd05,destination:_0x2775f6,deliverydate:_0x4d46e0,driver:_0x1de22a,plate:_0x305e57,van:_0x1a97c7,DRSI:_0x5bda91,typevehicle:_0x242fdf,TSU:_0x1dbeee,TFU:_0x3834e3}=_0x146a20[_0x337c69(0x135)];if(typeof _0x4cf6b6==_0x337c69(0xcf))var _0x374d47=[_0x146a20['body'][_0x337c69(0xc8)]],_0x3c7baa=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xaa)]],_0x9d058a=[_0x146a20[_0x337c69(0x135)]['stock']],_0x1b3155=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xd8)]],_0x5c2ecc=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xc5)]],_0x1af64f=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xf9)]],_0x28c694=[_0x146a20['body'][_0x337c69(0xb3)]],_0x3bb79e=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xfc)]],_0x16f6ee=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xf6)]],_0x42f901=[_0x146a20[_0x337c69(0x135)]['batch_code']],_0x5da272=[_0x146a20['body'][_0x337c69(0x133)]],_0x41ee71=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xc2)]],_0x247632=[_0x146a20[_0x337c69(0x135)][_0x337c69(0xa8)]],_0xc3ad6a=[_0x146a20['body'][_0x337c69(0xcc)]],_0x46d6d6=[_0x146a20[_0x337c69(0x135)][_0x337c69(0x139)]],_0x5a89a8=[_0x146a20[_0x337c69(0x135)][_0x337c69(0x12e)]],_0x82e060=[_0x146a20[_0x337c69(0x135)]['id_transaction_from']];else var _0x374d47=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xc8)]],_0x3c7baa=[..._0x146a20['body']['level']],_0x9d058a=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0x118)]],_0x1b3155=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xd8)]],_0x5c2ecc=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xc5)]],_0x1af64f=[..._0x146a20[_0x337c69(0x135)]['New_Qty_Converted']],_0x28c694=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xb3)]],_0x3bb79e=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xfc)]],_0x16f6ee=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xf6)]],_0x42f901=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0x129)]],_0x5da272=[..._0x146a20['body'][_0x337c69(0x133)]],_0x41ee71=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xc2)]],_0x247632=[..._0x146a20['body'][_0x337c69(0xa8)]],_0xc3ad6a=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xcc)]],_0x46d6d6=[..._0x146a20['body'][_0x337c69(0x139)]],_0x5a89a8=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0x12e)]],_0x82e060=[..._0x146a20[_0x337c69(0x135)][_0x337c69(0xed)]];const _0x439b64=_0x374d47[_0x337c69(0xbc)](_0x36c4be=>{return _0x36c4be={'product_name':_0x36c4be};});_0x3c7baa[_0x337c69(0xfd)]((_0x1443a7,_0x162a08)=>{var _0x37357c=_0x337c69,_0x127598=_0x1443a7['match'](/[A-Za-z]+/)[0x0],_0x2a2cab=parseInt(_0x1443a7[_0x37357c(0xc0)](/\d+/)[0x0]);_0x439b64[_0x162a08]['level']=_0x127598,_0x439b64[_0x162a08][_0x37357c(0xf3)]=_0x2a2cab;}),_0x82e060[_0x337c69(0xfd)]((_0x2ee8bb,_0x3f4d93)=>{_0x439b64[_0x3f4d93]['id_transaction']=_0x2ee8bb;}),_0x9d058a['forEach']((_0xca9f9b,_0x398399)=>{_0x439b64[_0x398399]['stockBefore']=_0xca9f9b;}),_0x1b3155[_0x337c69(0xfd)]((_0x2048d7,_0x45b042)=>{var _0x48f845=_0x337c69;_0x439b64[_0x45b042][_0x48f845(0xd8)]=_0x2048d7;}),_0x5c2ecc[_0x337c69(0xfd)]((_0xc9c66a,_0x830bf5)=>{_0x439b64[_0x830bf5]['adjust_qty']=_0xc9c66a;}),_0x1af64f['forEach']((_0x447207,_0x380efa)=>{var _0x290625=_0x337c69;_0x439b64[_0x380efa][_0x290625(0xee)]=_0x447207;}),_0x28c694[_0x337c69(0xfd)]((_0x217656,_0x26ecfa)=>{var _0x20731b=_0x337c69;_0x439b64[_0x26ecfa][_0x20731b(0xf8)]=_0x217656;}),_0x3bb79e[_0x337c69(0xfd)]((_0x3a4c37,_0x173496)=>{var _0x2caf2e=_0x337c69;_0x439b64[_0x173496][_0x2caf2e(0x102)]=_0x3a4c37;}),_0x16f6ee['forEach']((_0x32810d,_0x43b05f)=>{var _0x211709=_0x337c69;_0x439b64[_0x43b05f][_0x211709(0x109)]=_0x32810d;}),_0x42f901[_0x337c69(0xfd)]((_0x65135,_0x3c506d)=>{_0x439b64[_0x3c506d]['batch_code']=_0x65135;}),_0x5da272[_0x337c69(0xfd)]((_0xe555b2,_0x56ee75)=>{_0x439b64[_0x56ee75]['expiry_date']=_0xe555b2;}),_0x41ee71['forEach']((_0x25db3e,_0x58d846)=>{var _0x47d760=_0x337c69;_0x439b64[_0x58d846][_0x47d760(0x130)]=_0x25db3e;}),_0x247632['forEach']((_0x630417,_0x1eaab9)=>{var _0x7c5554=_0x337c69;_0x439b64[_0x1eaab9][_0x7c5554(0xa8)]=_0x630417;}),_0xc3ad6a[_0x337c69(0xfd)]((_0x387dd5,_0x145850)=>{var _0x5b562c=_0x337c69;_0x439b64[_0x145850][_0x5b562c(0xf7)]=_0x387dd5;}),_0x46d6d6[_0x337c69(0xfd)]((_0x36016b,_0x3095ec)=>{var _0x3da030=_0x337c69;_0x439b64[_0x3095ec][_0x3da030(0x139)]=_0x36016b;}),_0x5a89a8['forEach']((_0x53c611,_0x9aed95)=>{var _0x5228ef=_0x337c69;_0x439b64[_0x9aed95][_0x5228ef(0xb4)]=_0x53c611;});const _0x3e5790=_0x439b64[_0x337c69(0x123)](_0x404628=>_0x404628[_0x337c69(0xdc)]!=='0'&&_0x404628[_0x337c69(0xdc)]!=='');var _0x2bc6af=0x0;_0x3e5790[_0x337c69(0xfd)](_0x1b1fd5=>{var _0x5c216b=_0x337c69;console[_0x5c216b(0xea)]('foreach\x20newproduct',_0x1b1fd5),parseInt(_0x1b1fd5[_0x5c216b(0xdc)])<=0x0&&_0x2bc6af++;});if(_0x2bc6af!=0x0)return _0x146a20['flash'](_0x337c69(0xb9),_0x337c69(0x10e)),_0x197ea6['redirect'](_0x337c69(0x10c));const _0x5e30c6=new adjustment_logs();await _0x5e30c6[_0x337c69(0xd6)]();const _0x3dda18=new adjustment_finished({'warehouse_name':_0x46934b,'date':_0x3a958b,'product':_0x3e5790,'note':_0x2536cb,'room':_0x35ef9c,'invoice':'LOG-ADJ-'+_0x5e30c6[_0x337c69(0xf5)][_0x337c69(0x112)]()['padStart'](0x8,'0'),'JO_number':_0x47e093,'expiry_date':_0x4694fd,'type_of_transaction':_0x3d2ca4,'PO_number':_0x130330,'RequestedBy':_0x2dd2cf,'DateofRequest':_0x5517ff,'typeservices':_0x44fd05,'destination':_0x2775f6,'deliverydate':_0x4d46e0,'driver':_0x1de22a,'plate':_0x305e57,'van':_0x1a97c7,'DRSI':_0x5bda91,'typevehicle':_0x242fdf,'TSU':_0x1dbeee,'TFU':_0x3834e3}),_0x15f25c=await _0x3dda18['save']();_0x146a20[_0x337c69(0x98)]('success',_0x337c69(0x103)),_0x197ea6[_0x337c69(0xc9)]('/adjustment_finished/preview/'+_0x15f25c[_0x337c69(0xda)]);}catch(_0x4bc85e){console[_0x337c69(0xea)](_0x4bc85e),_0x197ea6[_0x337c69(0x9e)](0xc8)[_0x337c69(0x10d)]({'message':_0x4bc85e[_0x337c69(0x106)]});}}),router[a0_0x4addaf(0xc1)](a0_0x4addaf(0xf0),auth,async(_0x449513,_0x38b8e0)=>{var _0x242eda=a0_0x4addaf;try{const {username:_0x33da4a,email:_0x2f8b25,role:_0x359046}=_0x449513['user'],_0xabf769=_0x449513[_0x242eda(0xce)],_0x510d9e=await profile['findOne']({'email':_0xabf769[_0x242eda(0xb7)]}),_0x4e1e55=await master_shop[_0x242eda(0x10a)](),_0x3ba86f=_0x449513[_0x242eda(0x137)]['id'],_0x47bc36=await adjustment_finished['findById']({'_id':_0x3ba86f}),_0x36772d=await purchases[_0x242eda(0x114)]([{'$match':{'warehouse_name':_0x47bc36[_0x242eda(0xdd)]}},{'$unwind':_0x242eda(0x12b)},{'$group':{'_id':_0x242eda(0x115)}}]);console[_0x242eda(0xea)]('purchases_data',_0x36772d);const _0x267b8a=await product['find']({}),_0x5be66c=await warehouse[_0x242eda(0x114)]([{'$match':{'name':_0x47bc36[_0x242eda(0xdd)]}},{'$unwind':_0x242eda(0x134)},{'$group':{'_id':_0x242eda(0xbd),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x242eda(0xfa)},'bin':{'$first':_0x242eda(0x11a)},'type':{'$first':_0x242eda(0x95)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x242eda(0x104)},'secondary_code':{'$first':_0x242eda(0xbf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x242eda(0xe4)},'rack':{'$first':_0x242eda(0xac)},'expiry_date':{'$first':_0x242eda(0x97)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x242eda(0x113)},'maxPerUnit':{'$first':_0x242eda(0x96)},'room':{'$first':'$room'}}}]);if(_0x4e1e55[0x0]['language']==_0x242eda(0x132)){var _0x3afba9=users[_0x242eda(0x10f)];console[_0x242eda(0xea)](_0x3afba9);}else{if(_0x4e1e55[0x0]['language']==_0x242eda(0xb6))var _0x3afba9=users[_0x242eda(0xb6)];else{if(_0x4e1e55[0x0]['language']==_0x242eda(0x105))var _0x3afba9=users['German'];else{if(_0x4e1e55[0x0][_0x242eda(0x91)]==_0x242eda(0x124))var _0x3afba9=users[_0x242eda(0x124)];else{if(_0x4e1e55[0x0][_0x242eda(0x91)]=='French')var _0x3afba9=users['French'];else{if(_0x4e1e55[0x0]['language']==_0x242eda(0x116))var _0x3afba9=users['Portuguese'];else{if(_0x4e1e55[0x0][_0x242eda(0x91)]=='Chinese')var _0x3afba9=users[_0x242eda(0xd7)];else{if(_0x4e1e55[0x0][_0x242eda(0x91)]==_0x242eda(0xb5))var _0x3afba9=users[_0x242eda(0xe0)];}}}}}}}_0x38b8e0[_0x242eda(0xbe)](_0x242eda(0x131),{'success':_0x449513[_0x242eda(0x98)](_0x242eda(0x12a)),'errors':_0x449513[_0x242eda(0x98)](_0x242eda(0xb9)),'role':_0xabf769,'profile':_0x510d9e,'adjustment':_0x47bc36,'stock':_0x5be66c,'master_shop':_0x4e1e55,'warehouse_name':_0x36772d,'unit':_0x267b8a,'language':_0x3afba9});}catch(_0x27f950){console[_0x242eda(0xea)](_0x27f950),_0x38b8e0['status'](0xc8)['json']({'message':_0x27f950[_0x242eda(0x106)]});}}),router['post'](a0_0x4addaf(0xf0),auth,async(_0x4d50f0,_0x449b0a)=>{var _0x3a138d=a0_0x4addaf;try{const {invoice:_0x228f6b,warehouse_name:_0x4e8bf4,Room_name:_0x415330}=_0x4d50f0[_0x3a138d(0x135)],_0xbb0a75=_0x4d50f0[_0x3a138d(0x137)]['id'],_0x271377=await adjustment_finished[_0x3a138d(0xe5)]({'_id':_0xbb0a75});var _0x56a8d2;const _0x31958c=_0x271377[_0x3a138d(0xad)]['map'](async _0x83a228=>{var _0x5b9246=_0x3a138d;if(_0x83a228['adjust_qty']>0x0){_0x56a8d2=await warehouse[_0x5b9246(0xcd)]({'name':_0x4e8bf4,'room':_0x83a228[_0x5b9246(0xf7)]});const _0x492066=_0x56a8d2[_0x5b9246(0xff)][_0x5b9246(0xbc)](_0x51fdb0=>{var _0xf7cbca=_0x5b9246;console[_0xf7cbca(0xea)](_0x83a228['types']);if(_0x83a228[_0xf7cbca(0xd8)]==_0xf7cbca(0x120))_0x51fdb0[_0xf7cbca(0xda)]==_0x83a228[_0xf7cbca(0x13a)]&&(_0x51fdb0[_0xf7cbca(0x94)]=_0x51fdb0[_0xf7cbca(0x94)]-_0x83a228[_0xf7cbca(0xdc)]);else _0x83a228['types']==_0xf7cbca(0xf4)&&(_0x51fdb0[_0xf7cbca(0xda)]==_0x83a228[_0xf7cbca(0x13a)]&&(_0x51fdb0[_0xf7cbca(0x94)]=_0x51fdb0[_0xf7cbca(0x94)]+_0x83a228[_0xf7cbca(0xdc)]));});}return _0x56a8d2;});Promise[_0x3a138d(0xab)](_0x31958c)[_0x3a138d(0xe7)](async _0x23771c=>{var _0x3c36c2=_0x3a138d;try{for(const _0x3dbc92 of _0x23771c){await _0x3dbc92['save']();}_0x271377['finalize']=_0x3c36c2(0x110);const _0x2f3317=await _0x271377[_0x3c36c2(0xd6)](),_0x4959e5=await master_shop[_0x3c36c2(0x10a)](),_0x13463c=await email_settings['findOne'](),_0x36dc59=await supervisor_settings[_0x3c36c2(0x10a)]();var _0x22d828=_0x271377[_0x3c36c2(0xad)],_0x2023b5='',_0x3751c2;for(_0x3751c2 in _0x22d828){var _0x45f53c='FG';_0x271377[_0x3c36c2(0xdd)]==_0x3c36c2(0xba)&&(_0x45f53c='DG'),_0x2023b5+=_0x3c36c2(0xca)+_0x3c36c2(0xd9)+_0x22d828[_0x3751c2][_0x3c36c2(0xd2)]+_0x3c36c2(0xd4)+_0x3c36c2(0xd9)+_0x22d828[_0x3751c2][_0x3c36c2(0x109)]+_0x3c36c2(0xd4)+_0x3c36c2(0xd9)+_0x22d828[_0x3751c2][_0x3c36c2(0xdc)]+_0x3c36c2(0xd4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22d828[_0x3751c2][_0x3c36c2(0xf8)]+'</td>'+_0x3c36c2(0xd9)+_0x22d828[_0x3751c2][_0x3c36c2(0x102)]+_0x3c36c2(0xd4)+_0x3c36c2(0xd9)+_0x271377['warehouse_name']+_0x3c36c2(0xd4)+_0x3c36c2(0xd9)+_0x22d828[_0x3751c2][_0x3c36c2(0xf7)]+'</td>'+_0x3c36c2(0xd9)+_0x45f53c+_0x22d828[_0x3751c2][_0x3c36c2(0xf3)]+_0x3c36c2(0xd4)+_0x3c36c2(0x93);}_0x4d50f0[_0x3c36c2(0x98)](_0x3c36c2(0x12a),'Adjustment\x20Finalize\x20Successfully'),_0x449b0a[_0x3c36c2(0xc9)](_0x3c36c2(0x9c)+_0x2f3317['_id']);}catch(_0x56be39){console['error'](_0x56be39),_0x449b0a[_0x3c36c2(0x9e)](0x1f4)[_0x3c36c2(0x10d)]({'error':_0x3c36c2(0x11f)});}})['catch'](_0x767f9f=>{var _0x3f021d=_0x3a138d;console[_0x3f021d(0xc4)](_0x767f9f),_0x449b0a[_0x3f021d(0x9e)](0x1f4)[_0x3f021d(0x10d)]({'error':_0x3f021d(0xe6)});});}catch(_0x1c4c59){_0x449b0a['json']({'message':_0x1c4c59[_0x3a138d(0x106)]});}}),router['get']('/view/:id',auth,async(_0x3ed813,_0x53e0d8)=>{var _0x56df00=a0_0x4addaf;try{const {username:_0x50b2ac,email:_0x31ab68,role:_0x20a24c}=_0x3ed813[_0x56df00(0xce)],_0x1ab03d=_0x3ed813[_0x56df00(0xce)],_0x4199e8=await profile[_0x56df00(0xcd)]({'email':_0x1ab03d[_0x56df00(0xb7)]}),_0x46e4bb=await master_shop[_0x56df00(0x10a)]();console[_0x56df00(0xea)](_0x56df00(0x12c),_0x46e4bb);const _0x3c83c5=_0x3ed813[_0x56df00(0x137)]['id'],_0x18abc7=await adjustment_finished[_0x56df00(0xe5)]({'_id':_0x3c83c5});let _0x53fad7=new Date(_0x18abc7[_0x56df00(0x133)]),_0x143328=('0'+_0x53fad7[_0x56df00(0xfe)]())['slice'](-0x2),_0x230916=('0'+(_0x53fad7[_0x56df00(0xa1)]()+0x1))[_0x56df00(0x138)](-0x2),_0x4df14c=_0x53fad7[_0x56df00(0xd5)](),_0x495a1e=_0x4df14c+'-'+_0x230916+'-'+_0x143328;var _0x2fe74c=[_0x56df00(0x100),_0x56df00(0x101),'Return\x20Rooms'];const _0x457d2a=await purchases[_0x56df00(0x114)]([{'$match':{'warehouse_name':_0x18abc7[_0x56df00(0xdd)]}},{'$unwind':_0x56df00(0x12b)},{'$group':{'_id':_0x56df00(0x115)}}]);console[_0x56df00(0xea)](_0x56df00(0x108),_0x457d2a);const _0x3b47fb=await product[_0x56df00(0x10a)]({}),_0x2b2772=await warehouse[_0x56df00(0x114)]([{'$match':{'name':_0x18abc7[_0x56df00(0xdd)],'room':_0x18abc7[_0x56df00(0xe1)]}},{'$unwind':_0x56df00(0x134)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x56df00(0xe3)},'product_stock':{'$first':_0x56df00(0x13c)},'bay':{'$first':_0x56df00(0xfa)},'bin':{'$first':_0x56df00(0x11a)},'type':{'$first':_0x56df00(0x95)},'floorlevel':{'$first':_0x56df00(0xa0)},'primary_code':{'$first':_0x56df00(0x104)},'secondary_code':{'$first':_0x56df00(0xbf)},'product_code':{'$first':_0x56df00(0x9a)},'storage':{'$first':_0x56df00(0xe4)},'rack':{'$first':_0x56df00(0xac)}}}]);if(_0x46e4bb[0x0][_0x56df00(0x91)]==_0x56df00(0x132)){var _0x3478fa=users[_0x56df00(0x10f)];console[_0x56df00(0xea)](_0x3478fa);}else{if(_0x46e4bb[0x0][_0x56df00(0x91)]==_0x56df00(0xb6))var _0x3478fa=users[_0x56df00(0xb6)];else{if(_0x46e4bb[0x0]['language']==_0x56df00(0x105))var _0x3478fa=users['German'];else{if(_0x46e4bb[0x0][_0x56df00(0x91)]==_0x56df00(0x124))var _0x3478fa=users[_0x56df00(0x124)];else{if(_0x46e4bb[0x0]['language']=='French')var _0x3478fa=users['French'];else{if(_0x46e4bb[0x0]['language']==_0x56df00(0x116))var _0x3478fa=users[_0x56df00(0xdf)];else{if(_0x46e4bb[0x0][_0x56df00(0x91)]=='Chinese')var _0x3478fa=users['Chinese'];else{if(_0x46e4bb[0x0]['language']==_0x56df00(0xb5))var _0x3478fa=users[_0x56df00(0xe0)];}}}}}}}_0x53e0d8[_0x56df00(0xbe)](_0x56df00(0xae),{'success':_0x3ed813[_0x56df00(0x98)]('success'),'errors':_0x3ed813[_0x56df00(0x98)](_0x56df00(0xb9)),'role':_0x1ab03d,'profile':_0x4199e8,'adjustment':_0x18abc7,'stock':_0x2b2772,'master_shop':_0x46e4bb,'warehouse_name':_0x457d2a,'unit':_0x3b47fb,'language':_0x3478fa,'rooms_data':_0x2fe74c,'ed_fullDate':_0x495a1e});}catch(_0x28287d){console[_0x56df00(0xea)](_0x28287d),_0x53e0d8['status'](0xc8)['json']({'message':_0x28287d[_0x56df00(0x106)]});}}),router[a0_0x4addaf(0xb1)]('/view/:id',auth,async(_0x5e3f6c,_0x22ad20)=>{var _0x112b82=a0_0x4addaf;try{const _0x301c10=_0x5e3f6c[_0x112b82(0x137)]['id'],_0x1487ee=await adjustment_finished[_0x112b82(0xe5)]({'_id':_0x301c10}),_0x132106=await warehouse[_0x112b82(0xcd)]({'name':_0x1487ee[_0x112b82(0xdd)],'room':_0x1487ee[_0x112b82(0xe1)]}),{warehouse_name:_0x5d8403,date:_0x51e2a4,prod_name:_0x57b35e,level:_0x37dfb2,isle:_0x2190e0,pallet:_0x918511,stock:_0x100250,types:_0x572935,adjust_qty:_0x57a198,new_adjust_qty:_0x455765,note:_0x506d36,Room_name:_0x57b75b,invoice:_0x19a394,JO_number:_0x939885}=_0x5e3f6c[_0x112b82(0x135)];if(typeof _0x57b35e=='string')var _0x427e4b=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xc8)]],_0x516148=[_0x5e3f6c['body'][_0x112b82(0xaa)]],_0x5491f2=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0x118)]],_0x6e77=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xd8)]],_0x46aac0=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xdc)]],_0x2e831c=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xee)]],_0x2caf2b=[_0x5e3f6c['body'][_0x112b82(0xf6)]],_0x5b7b29=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xf8)]],_0x43bc5d=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xfc)]],_0x7959da=[_0x5e3f6c['body'][_0x112b82(0x129)]],_0x4f2e43=[_0x5e3f6c[_0x112b82(0x135)][_0x112b82(0x133)]];else var _0x427e4b=[..._0x5e3f6c['body']['prod_name']],_0x516148=[..._0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xaa)]],_0x5491f2=[..._0x5e3f6c[_0x112b82(0x135)]['stock']],_0x6e77=[..._0x5e3f6c['body']['types']],_0x46aac0=[..._0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xdc)]],_0x2e831c=[..._0x5e3f6c['body']['new_adjust_qty']],_0x2caf2b=[..._0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xf6)]],_0x5b7b29=[..._0x5e3f6c[_0x112b82(0x135)]['unit']],_0x43bc5d=[..._0x5e3f6c[_0x112b82(0x135)][_0x112b82(0xfc)]],_0x7959da=[..._0x5e3f6c[_0x112b82(0x135)][_0x112b82(0x129)]],_0x4f2e43=[..._0x5e3f6c['body'][_0x112b82(0x133)]];const _0x2b5bfa=_0x427e4b['map'](_0x2e820c=>{return _0x2e820c={'product_name':_0x2e820c};});_0x516148['forEach']((_0x1388a4,_0x3d8add)=>{_0x2b5bfa[_0x3d8add]['bay']=_0x1388a4;}),_0x5491f2[_0x112b82(0xfd)]((_0x5ca68a,_0x2eb8f3)=>{_0x2b5bfa[_0x2eb8f3]['stockBefore']=_0x5ca68a;}),_0x6e77[_0x112b82(0xfd)]((_0x5aba99,_0x1fec89)=>{_0x2b5bfa[_0x1fec89]['types']=_0x5aba99;}),_0x46aac0[_0x112b82(0xfd)]((_0x138318,_0x3b281a)=>{var _0x4f586c=_0x112b82;_0x2b5bfa[_0x3b281a][_0x4f586c(0xdc)]=_0x138318;}),_0x2e831c[_0x112b82(0xfd)]((_0x28f1ff,_0x3ee554)=>{var _0x424c54=_0x112b82;_0x2b5bfa[_0x3ee554][_0x424c54(0xee)]=_0x28f1ff;}),_0x5b7b29[_0x112b82(0xfd)]((_0x5117a9,_0x3d8491)=>{_0x2b5bfa[_0x3d8491]['unit']=_0x5117a9;}),_0x43bc5d[_0x112b82(0xfd)]((_0x50dc1d,_0x2b83e0)=>{_0x2b5bfa[_0x2b83e0]['secondary_unit']=_0x50dc1d;}),_0x2caf2b[_0x112b82(0xfd)]((_0x55754a,_0x430725)=>{var _0x2af970=_0x112b82;_0x2b5bfa[_0x430725][_0x2af970(0x109)]=_0x55754a;}),_0x7959da[_0x112b82(0xfd)]((_0x59b1a2,_0x4ed89a)=>{var _0x1fc32a=_0x112b82;_0x2b5bfa[_0x4ed89a][_0x1fc32a(0x129)]=_0x59b1a2;}),_0x4f2e43[_0x112b82(0xfd)]((_0x115eb9,_0x13d1e9)=>{var _0x18d043=_0x112b82;_0x2b5bfa[_0x13d1e9][_0x18d043(0x133)]=_0x115eb9;});const _0x17be0e=_0x2b5bfa[_0x112b82(0x123)](_0xf0737a=>_0xf0737a['adjust_qty']!=='0'&&_0xf0737a['adjust_qty']!=='');var _0x52188f=0x0;_0x17be0e[_0x112b82(0xfd)](_0x153fac=>{var _0x545b41=_0x112b82;console['log'](_0x545b41(0xdb),_0x153fac),parseInt(_0x153fac['adjust_qty'])<=0x0&&_0x52188f++;});if(_0x52188f!=0x0)return _0x5e3f6c[_0x112b82(0x98)](_0x112b82(0xb9),_0x112b82(0x10e)),_0x22ad20['redirect'](_0x112b82(0x10c));_0x1487ee[_0x112b82(0xdd)]=_0x5d8403,_0x1487ee['date']=_0x51e2a4,_0x1487ee[_0x112b82(0xad)]=_0x17be0e,_0x1487ee[_0x112b82(0x136)]=_0x506d36,_0x1487ee['room']=_0x57b75b,_0x1487ee[_0x112b82(0xb4)]=_0x19a394,_0x1487ee['JO_number']=_0x939885;const _0xb1628e=await _0x1487ee[_0x112b82(0xd6)](),_0x2b477e=await warehouse[_0x112b82(0xcd)]({'name':_0x5d8403,'room':_0x57b75b});_0xb1628e[_0x112b82(0xad)]['forEach'](_0x5c96c6=>{var _0x22aa89=_0x112b82;const _0x19595c=_0x2b477e[_0x22aa89(0xff)]['map'](_0x5165f5=>{var _0x472824=_0x22aa89;_0x5c96c6[_0x472824(0xd8)]==_0x472824(0x120)?_0x5165f5['product_name']==_0x5c96c6['product_name']&&_0x5165f5[_0x472824(0xf3)]==_0x5c96c6[_0x472824(0xf3)]&&(_0x5165f5[_0x472824(0x94)]=parseInt(_0x5165f5['product_stock'])-parseInt(_0x5c96c6[_0x472824(0xdc)])):_0x5165f5['product_name']==_0x5c96c6['product_name']&&_0x5165f5['bay']==_0x5c96c6[_0x472824(0xf3)]&&(_0x5165f5[_0x472824(0x94)]=parseInt(_0x5165f5[_0x472824(0x94)])+parseInt(_0x5c96c6['adjust_qty']));});}),await _0x2b477e['save'](),_0x5e3f6c['flash']('success',_0x112b82(0xcb)),_0x22ad20[_0x112b82(0xc9)](_0x112b82(0x11b));}catch(_0x21f8b2){console[_0x112b82(0xea)](_0x21f8b2);}}),router[a0_0x4addaf(0xb1)](a0_0x4addaf(0x13b),async(_0xfaa458,_0x26ce69)=>{var _0x4abdf5=a0_0x4addaf;const {primary_code:_0x495bdc,warehouse_data:_0x3b4879,rooms_data:_0x1e38bf,Roomslist:_0x2ffe66}=_0xfaa458[_0x4abdf5(0x135)],_0x4042f2=_0x2ffe66['split'](','),_0x432f85=[];async function _0x312bca(_0xa76e44){var _0x5a8847=_0x4abdf5;const _0x4f4870=await warehouse[_0x5a8847(0x114)]([{'$match':{'name':_0x3b4879,'room':_0xa76e44}},{'$unwind':_0x5a8847(0x134)},{'$match':{'product_details.primary_code':_0x495bdc}},{'$group':{'_id':_0x5a8847(0xbd),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x5a8847(0x104)},'secondary_code':{'$first':_0x5a8847(0xbf)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x5a8847(0xfa)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x5a8847(0xa0)},'unit':{'$first':_0x5a8847(0x125)},'secondary_unit':{'$first':_0x5a8847(0xec)},'storage':{'$first':_0x5a8847(0xe4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5a8847(0x97)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x5a8847(0x113)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x5a8847(0x96)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x34ffbe=await warehouse['aggregate']([{'$match':{'name':_0x3b4879,'room':_0xa76e44}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x495bdc}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5a8847(0x13c)},'primary_code':{'$first':_0x5a8847(0x104)},'secondary_code':{'$first':_0x5a8847(0xbf)},'product_code':{'$first':_0x5a8847(0x9a)},'level':{'$first':'$product_details.level'},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x5a8847(0x95)},'pallet':{'$first':_0x5a8847(0xa0)},'unit':{'$first':_0x5a8847(0x125)},'secondary_unit':{'$first':_0x5a8847(0xec)},'storage':{'$first':_0x5a8847(0xe4)},'rack':{'$first':_0x5a8847(0xac)},'expiry_date':{'$first':_0x5a8847(0x97)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x5a8847(0x113)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5a8847(0x96)},'roomNamed':{'$first':_0x5a8847(0x11c)},'invoice':{'$first':_0x5a8847(0x107)}}}]);if(_0x4f4870[_0x5a8847(0xf1)]>0x0)_0x432f85[_0x5a8847(0x12d)](_0x4f4870);else _0x34ffbe[_0x5a8847(0xf1)]>0x0&&_0x432f85[_0x5a8847(0x12d)](_0x34ffbe);}const _0x5d37e2=_0x4042f2['map'](_0x221317=>_0x312bca(_0x221317));await Promise['all'](_0x5d37e2),_0x26ce69[_0x4abdf5(0x10d)](_0x432f85);}),router[a0_0x4addaf(0xb1)](a0_0x4addaf(0xa7),async(_0x3f0b89,_0x5446ad)=>{var _0x170dc4=a0_0x4addaf;const {productCode:_0x11b326,bay:_0x210b3f,warehouses:_0x539fea,room:_0x5875a2}=_0x3f0b89[_0x170dc4(0x135)];console[_0x170dc4(0xea)](_0x3f0b89[_0x170dc4(0x135)]);try{const _0x92eccf=await warehouse[_0x170dc4(0x114)]([{'$match':{'name':_0x539fea,'room':_0x5875a2}},{'$unwind':_0x170dc4(0x134)},{'$match':{'product_details.bay':parseInt(_0x210b3f)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x170dc4(0xfa)},'maxProducts':{'$first':_0x170dc4(0xc6)}}}]);_0x5446ad['status'](0xc8)['json'](_0x92eccf);}catch(_0x356dbe){_0x5446ad[_0x170dc4(0x9e)](0x194)[_0x170dc4(0x10d)]({'message':_0x356dbe['message']});}}),module['exports']=router;