var a0_0x1df68d=a0_0x28ea;(function(_0x40241c,_0x200c5b){var _0x23ad93=a0_0x28ea,_0x4491c2=_0x40241c();while(!![]){try{var _0x570c32=-parseInt(_0x23ad93(0x1d3))/0x1+parseInt(_0x23ad93(0x17e))/0x2+parseInt(_0x23ad93(0x1a0))/0x3*(-parseInt(_0x23ad93(0x157))/0x4)+-parseInt(_0x23ad93(0x1b1))/0x5+parseInt(_0x23ad93(0x12d))/0x6*(-parseInt(_0x23ad93(0x15e))/0x7)+parseInt(_0x23ad93(0x161))/0x8*(parseInt(_0x23ad93(0x1ba))/0x9)+-parseInt(_0x23ad93(0x172))/0xa*(-parseInt(_0x23ad93(0x13b))/0xb);if(_0x570c32===_0x200c5b)break;else _0x4491c2['push'](_0x4491c2['shift']());}catch(_0x332d47){_0x4491c2['push'](_0x4491c2['shift']());}}}(a0_0x14f7,0xef0b8));function a0_0x28ea(_0xca0c9c,_0x333ea3){var _0x14f723=a0_0x14f7();return a0_0x28ea=function(_0x28ea5a,_0x2d74f0){_0x28ea5a=_0x28ea5a-0x12b;var _0x7582fe=_0x14f723[_0x28ea5a];return _0x7582fe;},a0_0x28ea(_0xca0c9c,_0x333ea3);}const express=require(a0_0x1df68d(0x198)),app=express(),router=express[a0_0x1df68d(0x187)](),auth=require(a0_0x1df68d(0x180)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require(a0_0x1df68d(0x1ab)),nodemailer=require('nodemailer');router[a0_0x1df68d(0x171)](a0_0x1df68d(0x18c),auth,async(_0x16767e,_0x30e4db)=>{var _0x112aa5=a0_0x1df68d;try{const {username:_0x401f6d,email:_0x2f787e,role:_0x5028f4}=_0x16767e[_0x112aa5(0x18b)],_0x3efbe0=_0x16767e['user'],_0x39b353=await profile[_0x112aa5(0x17f)]({'email':_0x3efbe0[_0x112aa5(0x1be)]}),_0x192f11=await master_shop[_0x112aa5(0x1cd)]();let _0x2f7ec6;if(_0x3efbe0[_0x112aa5(0x1c2)]==_0x112aa5(0x1a2)){const _0x167874=await staff['findOne']({'email':_0x3efbe0[_0x112aa5(0x1be)]});_0x2f7ec6=await warehouse[_0x112aa5(0x1cd)]({'status':_0x112aa5(0x13c),'name':_0x167874[_0x112aa5(0x141)]});}else _0x2f7ec6=await warehouse['find']({'status':_0x112aa5(0x13c)});const _0x3aedc4=await product[_0x112aa5(0x1cd)]();let _0x39f486;if(_0x3efbe0[_0x112aa5(0x1c2)]==_0x112aa5(0x1a2)){const _0x486814=await staff[_0x112aa5(0x17f)]({'email':_0x3efbe0[_0x112aa5(0x1be)]});_0x39f486=await adjustment_finished['find']({'warehouse_name':_0x486814[_0x112aa5(0x141)]});}else _0x39f486=await adjustment_finished[_0x112aa5(0x164)]([{'$match':{'type_of_transaction':_0x112aa5(0x1c0)}},{'$unwind':'$product'},{'$group':{'_id':_0x112aa5(0x186),'invoice':{'$first':_0x112aa5(0x1d6)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x112aa5(0x147)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x192f11[0x0]['language']==_0x112aa5(0x17c)){var _0x1ef886=users[_0x112aa5(0x158)];console['log'](_0x1ef886);}else{if(_0x192f11[0x0]['language']==_0x112aa5(0x160))var _0x1ef886=users[_0x112aa5(0x160)];else{if(_0x192f11[0x0][_0x112aa5(0x153)]==_0x112aa5(0x1c3))var _0x1ef886=users[_0x112aa5(0x1c3)];else{if(_0x192f11[0x0][_0x112aa5(0x153)]==_0x112aa5(0x188))var _0x1ef886=users['Spanish'];else{if(_0x192f11[0x0][_0x112aa5(0x153)]=='French')var _0x1ef886=users['French'];else{if(_0x192f11[0x0][_0x112aa5(0x153)]==_0x112aa5(0x165))var _0x1ef886=users[_0x112aa5(0x196)];else{if(_0x192f11[0x0][_0x112aa5(0x153)]==_0x112aa5(0x190))var _0x1ef886=users[_0x112aa5(0x190)];else{if(_0x192f11[0x0][_0x112aa5(0x153)]==_0x112aa5(0x155))var _0x1ef886=users[_0x112aa5(0x1b7)];}}}}}}}_0x30e4db[_0x112aa5(0x1b9)](_0x112aa5(0x177),{'success':_0x16767e['flash'](_0x112aa5(0x14d)),'errors':_0x16767e['flash'](_0x112aa5(0x149)),'role':_0x3efbe0,'profile':_0x39b353,'warehouse':_0x2f7ec6,'product':_0x3aedc4,'adjustment':_0x39f486,'master_shop':_0x192f11,'language':_0x1ef886});}catch(_0xd04feb){console[_0x112aa5(0x1a7)](_0xd04feb);}}),router[a0_0x1df68d(0x171)](a0_0x1df68d(0x1a3),auth,async(_0x397886,_0x246083)=>{var _0x41a50f=a0_0x1df68d;try{const {username:_0x4f2a1f,email:_0xec065d,role:_0x16c575}=_0x397886[_0x41a50f(0x18b)],_0x15a463=_0x397886[_0x41a50f(0x18b)],_0xaa9dc0=await profile[_0x41a50f(0x17f)]({'email':_0x15a463['email']}),_0x4081f8=await master_shop[_0x41a50f(0x1cd)]();let _0x31cfd0;if(_0x15a463[_0x41a50f(0x1c2)]==_0x41a50f(0x1a2)){const _0x179ce0=await staff[_0x41a50f(0x17f)]({'email':_0x15a463[_0x41a50f(0x1be)]});_0x31cfd0=await warehouse[_0x41a50f(0x1cd)]({'status':'Enabled','name':_0x179ce0['warehouse']});}else _0x31cfd0=await warehouse[_0x41a50f(0x1cd)]({'status':_0x41a50f(0x13c)});const _0x1ca02b=await product[_0x41a50f(0x1cd)]();let _0x2b2eaf;if(_0x15a463['role']==_0x41a50f(0x1a2)){const _0x5cb1c7=await staff['findOne']({'email':_0x15a463[_0x41a50f(0x1be)]});_0x2b2eaf=await adjustment_finished[_0x41a50f(0x1cd)]({'warehouse_name':_0x5cb1c7[_0x41a50f(0x141)]});}else _0x2b2eaf=await adjustment_finished[_0x41a50f(0x164)]([{'$match':{'type_of_transaction':_0x41a50f(0x1bf)}},{'$unwind':_0x41a50f(0x1cf)},{'$group':{'_id':_0x41a50f(0x186),'invoice':{'$first':_0x41a50f(0x1d6)},'date':{'$first':_0x41a50f(0x15f)},'warehouse_name':{'$first':_0x41a50f(0x140)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x41a50f(0x1bb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4081f8[0x0][_0x41a50f(0x153)]=='English\x20(US)')var _0x2e2f91=users[_0x41a50f(0x158)];else{if(_0x4081f8[0x0]['language']==_0x41a50f(0x160))var _0x2e2f91=users[_0x41a50f(0x160)];else{if(_0x4081f8[0x0][_0x41a50f(0x153)]=='German')var _0x2e2f91=users[_0x41a50f(0x1c3)];else{if(_0x4081f8[0x0]['language']==_0x41a50f(0x188))var _0x2e2f91=users[_0x41a50f(0x188)];else{if(_0x4081f8[0x0][_0x41a50f(0x153)]==_0x41a50f(0x191))var _0x2e2f91=users[_0x41a50f(0x191)];else{if(_0x4081f8[0x0][_0x41a50f(0x153)]==_0x41a50f(0x165))var _0x2e2f91=users['Portuguese'];else{if(_0x4081f8[0x0]['language']==_0x41a50f(0x190))var _0x2e2f91=users[_0x41a50f(0x190)];else{if(_0x4081f8[0x0][_0x41a50f(0x153)]=='Arabic\x20(ae)')var _0x2e2f91=users['Arabic'];}}}}}}}_0x246083['render'](_0x41a50f(0x169),{'success':_0x397886[_0x41a50f(0x1d5)](_0x41a50f(0x14d)),'errors':_0x397886['flash'](_0x41a50f(0x149)),'role':_0x15a463,'profile':_0xaa9dc0,'warehouse':_0x31cfd0,'product':_0x1ca02b,'adjustment':_0x2b2eaf,'master_shop':_0x4081f8,'language':_0x2e2f91});}catch(_0x585b9b){console[_0x41a50f(0x1a7)](_0x585b9b);}});function a0_0x14f7(){var _0x54167b=['New_Qty_Converted','exports','room','2169132UxyZNA','$date','Hindi','24jmRivo','$product_details._id','warehouse_name','aggregate','Portuguese\x20(BR)','bay','toString','id_transaction_from','adjustment_finished_logs','$product_details.bay','LOG-ADJ-','getDate','master','map','$product_details.batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','get','13710UtyjNX','/adjustment/view','$product_details.floorlevel','$product_details.rack','$product_details.product_stock','adjustment_finished','prod_cat','status','$product_details','params','English\x20(US)','all','3179108kPXIkA','findOne','../middleware/auth','floor','adjustment\x20add\x20successfull','product_code','$product_details.production_date','/adjustment_finished/view','$_id','Router','Spanish','$product_details.unit','Return\x20Rooms','user','/view','invoice_init','$product_details.maxProducts','$product_details.expiry_date','Chinese','French','add_adjustment_finished_logs','$product.product_name','product_name','post','Portuguese','add_adjustment_finished','express','$product_details.maxPerUnit','/preview/:id','$product_details.primary_code','Secondary_units','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.product_name','new_adjust_qty','3OjVlNV','forEach','staff','/view_logs','room_names','product','$room','log','/barcode_scanner','getMonth','/view/add_adjustment','../public/language/languages.json','finalize','product_stock','match','prod_invoice','redirect','9204530GCcUOp','error','getFullYear','body','$product_details.storage','findById','Arabic','filter','render','2410011mJAwtM','$finalize','</td>','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','email','logs','own','Primary_Units','role','German','secondary_unit','level','split','save','expiry_date','minus','batch_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/adjustment_finished/preview/','find','slice','$product','invoice','JO_number','$name','486353NsLVbc','stockBefore','flash','$invoice','foreach\x20newproduct','prod_name','prod_code','add','Ambient','$product_details.bin','6PRxqnY','id_transaction','padStart','Enclosed','types','$product_details.level','/CheckingWarehouse','catch','$product_details.invoice','Rooms','product_details','then','string','message','12034qydtEz','Enabled','/view/add_adjustment_logs','back','<tr>','$warehouse_name','warehouse','json','maxPerUnit','unit','_id','$product_details.product_code','$product.room_names','ADJF-','errors','$product_details.secondary_unit','length','product_date','success','adjust_qty','edit_adjustment_finished_view','ADJ-','stock','$product_details.type','language','push','Arabic\x20(ae)','$product_details.secondary_code','1106008rXZimG','English','edit_adjustment_finished','New_Qty_Converted_adj'];a0_0x14f7=function(){return _0x54167b;};return a0_0x14f7();}async function getRandom8DigitNumber(){var _0x3332a6=a0_0x1df68d;const _0x47adb4=0x989680,_0x44ffb3=0x5f5e0ff,_0x4b2fa7=Math[_0x3332a6(0x181)](Math['random']()*(_0x44ffb3-_0x47adb4+0x1))+_0x47adb4;var _0x5c957c;const _0x481ca5=await adjustment_finished[_0x3332a6(0x17f)]({'invoice':_0x3332a6(0x148)+_0x4b2fa7});return _0x481ca5&&_0x481ca5[_0x3332a6(0x14b)]>0x0?_0x5c957c=_0x3332a6(0x148)+_0x4b2fa7:_0x5c957c=_0x3332a6(0x148)+_0x4b2fa7,_0x5c957c;}router['get'](a0_0x1df68d(0x1aa),auth,async(_0x244bf9,_0x5d14cf)=>{var _0x5edfe4=a0_0x1df68d;try{const {username:_0x1b9a07,email:_0x4d1046,role:_0x1fbe8c}=_0x244bf9[_0x5edfe4(0x18b)],_0x4593b1=_0x244bf9[_0x5edfe4(0x18b)],_0x3c905a=await profile['findOne']({'email':_0x4593b1[_0x5edfe4(0x1be)]}),_0x25efce=await master_shop[_0x5edfe4(0x1cd)]();let _0x4ea34b;if(_0x4593b1['role']=='staff'){const _0x228565=await staff['findOne']({'email':_0x4593b1[_0x5edfe4(0x1be)]});_0x4ea34b=await warehouse[_0x5edfe4(0x164)]([{'$match':{'status':_0x5edfe4(0x13c),'name':_0x228565[_0x5edfe4(0x141)]}},{'$group':{'_id':_0x5edfe4(0x1d2),'name':{'$first':_0x5edfe4(0x1d2)}}}]);}else _0x4ea34b=await warehouse[_0x5edfe4(0x164)]([{'$match':{'status':_0x5edfe4(0x13c)}},{'$group':{'_id':_0x5edfe4(0x1d2),'name':{'$first':_0x5edfe4(0x1d2)}}}]);const _0x5d16d9=await product[_0x5edfe4(0x1cd)]({}),_0x27f9da=await adjustment_finished['find'](),_0x2239ad=_0x27f9da[_0x5edfe4(0x14b)]+0x1,_0x464d0b='ADJF-'+_0x2239ad[_0x5edfe4(0x167)]()[_0x5edfe4(0x12f)](0x5,'0');var _0x3eb592=[_0x5edfe4(0x12b),'Enclosed',_0x5edfe4(0x18a)];if(_0x25efce[0x0][_0x5edfe4(0x153)]==_0x5edfe4(0x17c))var _0x5cfeb1=users[_0x5edfe4(0x158)];else{if(_0x25efce[0x0]['language']==_0x5edfe4(0x160))var _0x5cfeb1=users[_0x5edfe4(0x160)];else{if(_0x25efce[0x0]['language']=='German')var _0x5cfeb1=users[_0x5edfe4(0x1c3)];else{if(_0x25efce[0x0]['language']==_0x5edfe4(0x188))var _0x5cfeb1=users[_0x5edfe4(0x188)];else{if(_0x25efce[0x0]['language']==_0x5edfe4(0x191))var _0x5cfeb1=users[_0x5edfe4(0x191)];else{if(_0x25efce[0x0][_0x5edfe4(0x153)]==_0x5edfe4(0x165))var _0x5cfeb1=users['Portuguese'];else{if(_0x25efce[0x0]['language']=='Chinese')var _0x5cfeb1=users[_0x5edfe4(0x190)];else{if(_0x25efce[0x0][_0x5edfe4(0x153)]=='Arabic\x20(ae)')var _0x5cfeb1=users[_0x5edfe4(0x1b7)];}}}}}}}const _0x2bbbdc=getRandom8DigitNumber();_0x2bbbdc[_0x5edfe4(0x138)](_0x1e529c=>{var _0xdd9704=_0x5edfe4;_0x5d14cf['render'](_0xdd9704(0x197),{'success':_0x244bf9['flash'](_0xdd9704(0x14d)),'errors':_0x244bf9['flash'](_0xdd9704(0x149)),'role':_0x4593b1,'profile':_0x3c905a,'warehouse':_0x4ea34b,'product':_0x5d16d9,'master_shop':_0x25efce,'language':_0x5cfeb1,'rooms_data':_0x3eb592,'invoice_no':_0x1e529c});})[_0x5edfe4(0x134)](_0x56ec4b=>{var _0x1dc75e=_0x5edfe4;_0x244bf9[_0x1dc75e(0x1d5)]('errors',_0x1dc75e(0x19d)),_0x5d14cf[_0x1dc75e(0x1b0)](_0x1dc75e(0x173));});}catch(_0x3c14a5){console[_0x5edfe4(0x1a7)](_0x3c14a5);}}),router['post'](a0_0x1df68d(0x1aa),auth,async(_0x1c780d,_0xcd7058)=>{var _0x5bba1b=a0_0x1df68d;try{const {warehouse_name:_0x54eb3e,date:_0x4bedbe,prod_name:_0xe3ea36,level:_0x598c53,isle:_0x1f16b8,pallet:_0xfae56c,stock:_0x3e72d0,types:_0x2147d7,adjust_qty:_0x5d02ca,new_adjust_qty:_0x195c6c,note:_0x31e843,Room_name:_0x39ac0a,JO_number:_0x5a0686,expiry_date:_0x4c5f98,PO_number:_0x2753f5,ReqBy:_0xd9277a,dateofreq:_0x4becb9,typeservicesData:_0x349c9a,destination:_0x180173,deliverydate:_0xc1305b,driver:_0x3fa27a,plate:_0x522e2b,van:_0x4a800c,DRSI:_0x44a1fa,typevehicle:_0x17ec4d,TSU:_0x10d4d7,TFU:_0x2a9979}=_0x1c780d['body'];if(typeof _0xe3ea36==_0x5bba1b(0x139))var _0x198ec8=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1d8)]],_0x237154=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1c5)]],_0x4303c3=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x151)]],_0x42f340=[_0x1c780d['body'][_0x5bba1b(0x131)]],_0x57e979=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x15a)]],_0x4c6151=[_0x1c780d[_0x5bba1b(0x1b4)]['New_Qty_Converted']],_0x4a8f69=[_0x1c780d['body'][_0x5bba1b(0x1c1)]],_0x98127d=[_0x1c780d['body']['Secondary_units']],_0x105f86=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1d9)]],_0x473e89=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1ca)]],_0x25ae87=[_0x1c780d['body'][_0x5bba1b(0x1c8)]],_0x4b185b=[_0x1c780d['body']['product_date']],_0x2ea058=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x178)]],_0x554592=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x136)]],_0xae4309=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x143)]],_0x4b8f8b=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1af)]],_0x4cc8fa=[_0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x168)]];else var _0x198ec8=[..._0x1c780d[_0x5bba1b(0x1b4)]['prod_name']],_0x237154=[..._0x1c780d[_0x5bba1b(0x1b4)]['level']],_0x4303c3=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x151)]],_0x42f340=[..._0x1c780d[_0x5bba1b(0x1b4)]['types']],_0x57e979=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x15a)]],_0x4c6151=[..._0x1c780d['body'][_0x5bba1b(0x15b)]],_0x4a8f69=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1c1)]],_0x98127d=[..._0x1c780d['body']['Secondary_units']],_0x105f86=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1d9)]],_0x473e89=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1ca)]],_0x25ae87=[..._0x1c780d[_0x5bba1b(0x1b4)]['expiry_date']],_0x4b185b=[..._0x1c780d['body'][_0x5bba1b(0x14c)]],_0x2ea058=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x178)]],_0x554592=[..._0x1c780d[_0x5bba1b(0x1b4)]['Rooms']],_0xae4309=[..._0x1c780d['body'][_0x5bba1b(0x143)]],_0x4b8f8b=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x1af)]],_0x4cc8fa=[..._0x1c780d[_0x5bba1b(0x1b4)][_0x5bba1b(0x168)]];const _0x553bcc=_0x198ec8['map'](_0xe5fb4b=>{return _0xe5fb4b={'product_name':_0xe5fb4b};});_0x237154[_0x5bba1b(0x1a1)]((_0x129bdb,_0x38e4a8)=>{var _0x1957a3=_0x5bba1b,_0x1f0673=_0x129bdb[_0x1957a3(0x1ae)](/[A-Za-z]+/)[0x0],_0x491f84=parseInt(_0x129bdb['match'](/\d+/)[0x0]);_0x553bcc[_0x38e4a8][_0x1957a3(0x1c5)]=_0x1f0673,_0x553bcc[_0x38e4a8]['bay']=_0x491f84;}),_0x4cc8fa[_0x5bba1b(0x1a1)]((_0x4f5d4f,_0x4fc8e4)=>{var _0x27aec5=_0x5bba1b;_0x553bcc[_0x4fc8e4][_0x27aec5(0x12e)]=_0x4f5d4f;}),_0x4303c3['forEach']((_0x23d19d,_0x1442a2)=>{var _0x257a82=_0x5bba1b;_0x553bcc[_0x1442a2][_0x257a82(0x1d4)]=_0x23d19d;}),_0x42f340[_0x5bba1b(0x1a1)]((_0x5749bc,_0x3533e0)=>{_0x553bcc[_0x3533e0]['types']=_0x5749bc;}),_0x57e979['forEach']((_0x1cae51,_0x56a7f7)=>{var _0x4320de=_0x5bba1b;_0x553bcc[_0x56a7f7][_0x4320de(0x14e)]=_0x1cae51;}),_0x4c6151['forEach']((_0x201124,_0x129ba5)=>{var _0x3728cc=_0x5bba1b;_0x553bcc[_0x129ba5][_0x3728cc(0x19f)]=_0x201124;}),_0x4a8f69[_0x5bba1b(0x1a1)]((_0x41ec97,_0x371be8)=>{var _0x643f1f=_0x5bba1b;_0x553bcc[_0x371be8][_0x643f1f(0x144)]=_0x41ec97;}),_0x98127d[_0x5bba1b(0x1a1)]((_0x460772,_0x15aea5)=>{var _0x332767=_0x5bba1b;_0x553bcc[_0x15aea5][_0x332767(0x1c4)]=_0x460772;}),_0x105f86[_0x5bba1b(0x1a1)]((_0x38fe3d,_0x342063)=>{_0x553bcc[_0x342063]['product_code']=_0x38fe3d;}),_0x473e89[_0x5bba1b(0x1a1)]((_0x1b21b9,_0x412346)=>{var _0x5017f5=_0x5bba1b;_0x553bcc[_0x412346][_0x5017f5(0x1ca)]=_0x1b21b9;}),_0x25ae87[_0x5bba1b(0x1a1)]((_0x3421bb,_0x3aac93)=>{var _0x4cbed4=_0x5bba1b;_0x553bcc[_0x3aac93][_0x4cbed4(0x1c8)]=_0x3421bb;}),_0x4b185b[_0x5bba1b(0x1a1)]((_0x1e4491,_0x4ee183)=>{_0x553bcc[_0x4ee183]['production_date']=_0x1e4491;}),_0x2ea058[_0x5bba1b(0x1a1)]((_0x50f43d,_0x4a0541)=>{var _0x165e4e=_0x5bba1b;_0x553bcc[_0x4a0541][_0x165e4e(0x178)]=_0x50f43d;}),_0x554592[_0x5bba1b(0x1a1)]((_0x155a1d,_0x37e55f)=>{var _0x75c0a7=_0x5bba1b;_0x553bcc[_0x37e55f][_0x75c0a7(0x1a4)]=_0x155a1d;}),_0xae4309['forEach']((_0x52b618,_0x3b9542)=>{_0x553bcc[_0x3b9542]['maxPerUnit']=_0x52b618;}),_0x4b8f8b['forEach']((_0x41c149,_0x55b459)=>{var _0x424fb3=_0x5bba1b;_0x553bcc[_0x55b459][_0x424fb3(0x1d0)]=_0x41c149;});const _0x3536fa=_0x553bcc['filter'](_0xa7c5c7=>_0xa7c5c7[_0x5bba1b(0x14e)]!=='0'&&_0xa7c5c7[_0x5bba1b(0x14e)]!=='');var _0x2ed78a=0x0;_0x3536fa['forEach'](_0x957497=>{var _0x2d84bc=_0x5bba1b;console[_0x2d84bc(0x1a7)]('foreach\x20newproduct',_0x957497),parseInt(_0x957497[_0x2d84bc(0x14e)])<=0x0&&_0x2ed78a++;});if(_0x2ed78a!=0x0)return _0x1c780d[_0x5bba1b(0x1d5)](_0x5bba1b(0x149),_0x5bba1b(0x1bd)),_0xcd7058[_0x5bba1b(0x1b0)](_0x5bba1b(0x13e));const _0x14dfdb=new invoice_for_adjustment();await _0x14dfdb[_0x5bba1b(0x1c7)]();const _0x2f75f7=new adjustment_finished({'warehouse_name':_0x54eb3e,'date':_0x4bedbe,'product':_0x3536fa,'note':_0x31e843,'room':_0x39ac0a,'invoice':_0x5bba1b(0x150)+_0x14dfdb[_0x5bba1b(0x18d)][_0x5bba1b(0x167)]()[_0x5bba1b(0x12f)](0x8,'0'),'JO_number':_0x5a0686,'expiry_date':_0x4c5f98,'PO_number':_0x2753f5,'RequestedBy':_0xd9277a,'DateofRequest':_0x4becb9,'typeservices':_0x349c9a,'destination':_0x180173,'deliverydate':_0xc1305b,'driver':_0x3fa27a,'plate':_0x522e2b,'van':_0x4a800c,'DRSI':_0x44a1fa,'typevehicle':_0x17ec4d,'TSU':_0x10d4d7,'TFU':_0x2a9979}),_0x1d4411=await _0x2f75f7['save']();_0x1c780d[_0x5bba1b(0x1d5)](_0x5bba1b(0x14d),_0x5bba1b(0x182)),_0xcd7058[_0x5bba1b(0x1b0)](_0x5bba1b(0x1cc)+_0x1d4411[_0x5bba1b(0x145)]);}catch(_0xf8f70e){console[_0x5bba1b(0x1a7)](_0xf8f70e),_0xcd7058[_0x5bba1b(0x179)](0xc8)['json']({'message':_0xf8f70e[_0x5bba1b(0x13a)]});}}),router[a0_0x1df68d(0x171)](a0_0x1df68d(0x13d),auth,async(_0x243f66,_0x436992)=>{var _0x4c2150=a0_0x1df68d;try{const {username:_0x4fd777,email:_0x5580c3,role:_0x236b9a}=_0x243f66['user'],_0x212fd6=_0x243f66[_0x4c2150(0x18b)],_0x383aa3=await profile[_0x4c2150(0x17f)]({'email':_0x212fd6['email']}),_0x1efa97=await master_shop[_0x4c2150(0x1cd)]();let _0x2d0aca;if(_0x212fd6[_0x4c2150(0x1c2)]=='staff'){const _0x29a43a=await staff[_0x4c2150(0x17f)]({'email':_0x212fd6[_0x4c2150(0x1be)]});_0x2d0aca=await warehouse[_0x4c2150(0x164)]([{'$match':{'status':_0x4c2150(0x13c),'name':_0x29a43a[_0x4c2150(0x141)]}},{'$group':{'_id':_0x4c2150(0x1d2),'name':{'$first':_0x4c2150(0x1d2)}}}]);}else _0x2d0aca=await warehouse[_0x4c2150(0x164)]([{'$match':{'status':_0x4c2150(0x13c)}},{'$group':{'_id':_0x4c2150(0x1d2),'name':{'$first':_0x4c2150(0x1d2)}}}]);const _0x37f836=await product[_0x4c2150(0x1cd)](),_0x59865f=await adjustment_finished['find'](),_0x442480=_0x59865f['length']+0x1,_0xe9aa41='ADJF-'+_0x442480['toString']()[_0x4c2150(0x12f)](0x5,'0');var _0x244943=[_0x4c2150(0x12b),_0x4c2150(0x130),_0x4c2150(0x18a)];if(_0x1efa97[0x0][_0x4c2150(0x153)]==_0x4c2150(0x17c))var _0x41d2eb=users[_0x4c2150(0x158)];else{if(_0x1efa97[0x0][_0x4c2150(0x153)]==_0x4c2150(0x160))var _0x41d2eb=users[_0x4c2150(0x160)];else{if(_0x1efa97[0x0]['language']==_0x4c2150(0x1c3))var _0x41d2eb=users['German'];else{if(_0x1efa97[0x0][_0x4c2150(0x153)]==_0x4c2150(0x188))var _0x41d2eb=users['Spanish'];else{if(_0x1efa97[0x0]['language']==_0x4c2150(0x191))var _0x41d2eb=users[_0x4c2150(0x191)];else{if(_0x1efa97[0x0]['language']=='Portuguese\x20(BR)')var _0x41d2eb=users[_0x4c2150(0x196)];else{if(_0x1efa97[0x0][_0x4c2150(0x153)]==_0x4c2150(0x190))var _0x41d2eb=users['Chinese'];else{if(_0x1efa97[0x0][_0x4c2150(0x153)]=='Arabic\x20(ae)')var _0x41d2eb=users[_0x4c2150(0x1b7)];}}}}}}}const _0x53de1b=getRandom8DigitNumber();_0x53de1b[_0x4c2150(0x138)](_0x25bbc0=>{var _0x4ede13=_0x4c2150;_0x436992['render'](_0x4ede13(0x192),{'success':_0x243f66['flash'](_0x4ede13(0x14d)),'errors':_0x243f66['flash']('errors'),'role':_0x212fd6,'profile':_0x383aa3,'warehouse':_0x2d0aca,'product':_0x37f836,'master_shop':_0x1efa97,'language':_0x41d2eb,'rooms_data':_0x244943,'invoice_no':_0x25bbc0});})[_0x4c2150(0x134)](_0x4f2974=>{var _0x560921=_0x4c2150;_0x243f66['flash'](_0x560921(0x149),_0x560921(0x19d)),_0x436992[_0x560921(0x1b0)](_0x560921(0x173));});}catch(_0xbbda6e){console[_0x4c2150(0x1a7)](_0xbbda6e);}}),router[a0_0x1df68d(0x195)]('/view/add_adjustment_logs',auth,async(_0x547b99,_0x39151e)=>{var _0x287839=a0_0x1df68d;try{const {warehouse_name:_0x749ec0,date:_0x4703a6,prod_name:_0x3fb44b,level:_0x4750cf,isle:_0x4b7a74,pallet:_0x5c5dd1,stock:_0x1e7759,types:_0x37ddc9,adjust_qty:_0x5093d2,new_adjust_qty:_0x3d492d,note:_0x54bdc6,Room_name:_0x5c0eab,JO_number:_0x7b4b05,expiry_date:_0x213994,type_of_transaction:_0x86fa19,PO_number:_0xa1710,ReqBy:_0x2aa5fe,dateofreq:_0x3131de,typeservicesData:_0x10e13e,destination:_0x2a7c2b,deliverydate:_0x4bd8a1,driver:_0xfc10de,plate:_0x4773c5,van:_0x2a5bcb,DRSI:_0x75fd0e,typevehicle:_0x5297e6,TSU:_0x266d9d,TFU:_0x5b3691}=_0x547b99[_0x287839(0x1b4)];if(typeof _0x3fb44b==_0x287839(0x139))var _0x3fc638=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x1d8)]],_0xeb8072=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x1c5)]],_0x2a7a52=[_0x547b99[_0x287839(0x1b4)]['stock']],_0x4f9800=[_0x547b99[_0x287839(0x1b4)]['types']],_0x137236=[_0x547b99['body'][_0x287839(0x15a)]],_0x473b45=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x15b)]],_0x5a236d=[_0x547b99['body'][_0x287839(0x1c1)]],_0x8f208c=[_0x547b99[_0x287839(0x1b4)]['Secondary_units']],_0x49c5a8=[_0x547b99['body'][_0x287839(0x1d9)]],_0x3c1aea=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x1ca)]],_0x5274ec=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x1c8)]],_0x156af4=[_0x547b99[_0x287839(0x1b4)]['product_date']],_0x2eac2f=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x178)]],_0x2bf8e0=[_0x547b99['body'][_0x287839(0x136)]],_0x74e35c=[_0x547b99['body']['maxPerUnit']],_0x452afe=[_0x547b99[_0x287839(0x1b4)][_0x287839(0x1af)]],_0x53cbdb=[_0x547b99[_0x287839(0x1b4)]['id_transaction_from']];else var _0x3fc638=[..._0x547b99['body'][_0x287839(0x1d8)]],_0xeb8072=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x1c5)]],_0x2a7a52=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x151)]],_0x4f9800=[..._0x547b99[_0x287839(0x1b4)]['types']],_0x137236=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x15a)]],_0x473b45=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x15b)]],_0x5a236d=[..._0x547b99['body'][_0x287839(0x1c1)]],_0x8f208c=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x19c)]],_0x49c5a8=[..._0x547b99['body'][_0x287839(0x1d9)]],_0x3c1aea=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x1ca)]],_0x5274ec=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x1c8)]],_0x156af4=[..._0x547b99['body'][_0x287839(0x14c)]],_0x2eac2f=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x178)]],_0x2bf8e0=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x136)]],_0x74e35c=[..._0x547b99['body'][_0x287839(0x143)]],_0x452afe=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x1af)]],_0x53cbdb=[..._0x547b99[_0x287839(0x1b4)][_0x287839(0x168)]];const _0x4716a1=_0x3fc638[_0x287839(0x16e)](_0x46d481=>{return _0x46d481={'product_name':_0x46d481};});_0xeb8072[_0x287839(0x1a1)]((_0x1a8f61,_0xdd9a82)=>{var _0x4e9c60=_0x287839,_0x24c851=_0x1a8f61[_0x4e9c60(0x1ae)](/[A-Za-z]+/)[0x0],_0x566fb6=parseInt(_0x1a8f61[_0x4e9c60(0x1ae)](/\d+/)[0x0]);_0x4716a1[_0xdd9a82][_0x4e9c60(0x1c5)]=_0x24c851,_0x4716a1[_0xdd9a82][_0x4e9c60(0x166)]=_0x566fb6;}),_0x53cbdb[_0x287839(0x1a1)]((_0x32f390,_0x33e81a)=>{var _0xdf22b2=_0x287839;_0x4716a1[_0x33e81a][_0xdf22b2(0x12e)]=_0x32f390;}),_0x2a7a52[_0x287839(0x1a1)]((_0x5e9a49,_0x43dc61)=>{var _0x1f6aaf=_0x287839;_0x4716a1[_0x43dc61][_0x1f6aaf(0x1d4)]=_0x5e9a49;}),_0x4f9800['forEach']((_0x255526,_0x310860)=>{_0x4716a1[_0x310860]['types']=_0x255526;}),_0x137236['forEach']((_0x54ed7b,_0x38ce22)=>{var _0x2ed93d=_0x287839;_0x4716a1[_0x38ce22][_0x2ed93d(0x14e)]=_0x54ed7b;}),_0x473b45[_0x287839(0x1a1)]((_0x5745ea,_0x1f9a7f)=>{var _0x5ec553=_0x287839;_0x4716a1[_0x1f9a7f][_0x5ec553(0x19f)]=_0x5745ea;}),_0x5a236d['forEach']((_0x10d092,_0x55ee77)=>{var _0x107c97=_0x287839;_0x4716a1[_0x55ee77][_0x107c97(0x144)]=_0x10d092;}),_0x8f208c[_0x287839(0x1a1)]((_0x1eba16,_0x538fec)=>{var _0x579a3d=_0x287839;_0x4716a1[_0x538fec][_0x579a3d(0x1c4)]=_0x1eba16;}),_0x49c5a8[_0x287839(0x1a1)]((_0x12909b,_0x12a7db)=>{_0x4716a1[_0x12a7db]['product_code']=_0x12909b;}),_0x3c1aea['forEach']((_0x294b65,_0x4931f2)=>{var _0x5a018e=_0x287839;_0x4716a1[_0x4931f2][_0x5a018e(0x1ca)]=_0x294b65;}),_0x5274ec[_0x287839(0x1a1)]((_0x45657d,_0x58dd0e)=>{var _0x1c4a00=_0x287839;_0x4716a1[_0x58dd0e][_0x1c4a00(0x1c8)]=_0x45657d;}),_0x156af4[_0x287839(0x1a1)]((_0x1202da,_0x3c3482)=>{_0x4716a1[_0x3c3482]['production_date']=_0x1202da;}),_0x2eac2f[_0x287839(0x1a1)]((_0x5af917,_0x1576cc)=>{var _0x316196=_0x287839;_0x4716a1[_0x1576cc][_0x316196(0x178)]=_0x5af917;}),_0x2bf8e0['forEach']((_0x2da576,_0x5e4dd5)=>{_0x4716a1[_0x5e4dd5]['room_names']=_0x2da576;}),_0x74e35c[_0x287839(0x1a1)]((_0x2fa4d9,_0x2b757e)=>{var _0x4278c5=_0x287839;_0x4716a1[_0x2b757e][_0x4278c5(0x143)]=_0x2fa4d9;}),_0x452afe[_0x287839(0x1a1)]((_0x5dbb61,_0x547fe0)=>{_0x4716a1[_0x547fe0]['invoice']=_0x5dbb61;});const _0x160e10=_0x4716a1['filter'](_0x12140f=>_0x12140f[_0x287839(0x14e)]!=='0'&&_0x12140f['adjust_qty']!=='');var _0x200a5d=0x0;_0x160e10[_0x287839(0x1a1)](_0xde22bb=>{var _0x1874f3=_0x287839;console['log'](_0x1874f3(0x1d7),_0xde22bb),parseInt(_0xde22bb[_0x1874f3(0x14e)])<=0x0&&_0x200a5d++;});if(_0x200a5d!=0x0)return _0x547b99[_0x287839(0x1d5)](_0x287839(0x149),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x39151e[_0x287839(0x1b0)](_0x287839(0x13e));const _0x5def75=new adjustment_logs();await _0x5def75[_0x287839(0x1c7)]();const _0x4eb426=new adjustment_finished({'warehouse_name':_0x749ec0,'date':_0x4703a6,'product':_0x160e10,'note':_0x54bdc6,'room':_0x5c0eab,'invoice':_0x287839(0x16b)+_0x5def75[_0x287839(0x18d)][_0x287839(0x167)]()['padStart'](0x8,'0'),'JO_number':_0x7b4b05,'expiry_date':_0x213994,'type_of_transaction':_0x86fa19,'PO_number':_0xa1710,'RequestedBy':_0x2aa5fe,'DateofRequest':_0x3131de,'typeservices':_0x10e13e,'destination':_0x2a7c2b,'deliverydate':_0x4bd8a1,'driver':_0xfc10de,'plate':_0x4773c5,'van':_0x2a5bcb,'DRSI':_0x75fd0e,'typevehicle':_0x5297e6,'TSU':_0x266d9d,'TFU':_0x5b3691}),_0x225c91=await _0x4eb426['save']();_0x547b99[_0x287839(0x1d5)]('success',_0x287839(0x182)),_0x39151e[_0x287839(0x1b0)]('/adjustment_finished/preview/'+_0x225c91[_0x287839(0x145)]);}catch(_0x2b1140){console['log'](_0x2b1140),_0x39151e[_0x287839(0x179)](0xc8)[_0x287839(0x142)]({'message':_0x2b1140[_0x287839(0x13a)]});}}),router['get'](a0_0x1df68d(0x19a),auth,async(_0x377a5e,_0x4b67f8)=>{var _0x43e6c1=a0_0x1df68d;try{const {username:_0x23f8e6,email:_0x142b53,role:_0xa1c515}=_0x377a5e[_0x43e6c1(0x18b)],_0x540dc8=_0x377a5e['user'],_0x426d11=await profile[_0x43e6c1(0x17f)]({'email':_0x540dc8[_0x43e6c1(0x1be)]}),_0x1500a0=await master_shop[_0x43e6c1(0x1cd)](),_0x354b4a=_0x377a5e['params']['id'],_0x3bee94=await adjustment_finished['findById']({'_id':_0x354b4a}),_0x2565e0=await purchases[_0x43e6c1(0x164)]([{'$match':{'warehouse_name':_0x3bee94[_0x43e6c1(0x163)]}},{'$unwind':'$product'},{'$group':{'_id':_0x43e6c1(0x193)}}]);console['log']('purchases_data',_0x2565e0);const _0x216570=await product[_0x43e6c1(0x1cd)]({}),_0x4b991e=await warehouse['aggregate']([{'$match':{'name':_0x3bee94[_0x43e6c1(0x163)]}},{'$unwind':_0x43e6c1(0x17a)},{'$group':{'_id':_0x43e6c1(0x162),'name':{'$first':_0x43e6c1(0x19e)},'product_stock':{'$first':_0x43e6c1(0x176)},'bay':{'$first':_0x43e6c1(0x16a)},'bin':{'$first':_0x43e6c1(0x12c)},'type':{'$first':_0x43e6c1(0x152)},'floorlevel':{'$first':_0x43e6c1(0x174)},'primary_code':{'$first':_0x43e6c1(0x19b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x43e6c1(0x1b5)},'rack':{'$first':_0x43e6c1(0x175)},'expiry_date':{'$first':_0x43e6c1(0x18f)},'production_date':{'$first':_0x43e6c1(0x184)},'batch_code':{'$first':_0x43e6c1(0x16f)},'maxPerUnit':{'$first':_0x43e6c1(0x199)},'room':{'$first':_0x43e6c1(0x1a6)}}}]);if(_0x1500a0[0x0][_0x43e6c1(0x153)]==_0x43e6c1(0x17c)){var _0x12b4f6=users['English'];console['log'](_0x12b4f6);}else{if(_0x1500a0[0x0][_0x43e6c1(0x153)]=='Hindi')var _0x12b4f6=users[_0x43e6c1(0x160)];else{if(_0x1500a0[0x0][_0x43e6c1(0x153)]==_0x43e6c1(0x1c3))var _0x12b4f6=users[_0x43e6c1(0x1c3)];else{if(_0x1500a0[0x0][_0x43e6c1(0x153)]==_0x43e6c1(0x188))var _0x12b4f6=users[_0x43e6c1(0x188)];else{if(_0x1500a0[0x0]['language']==_0x43e6c1(0x191))var _0x12b4f6=users['French'];else{if(_0x1500a0[0x0][_0x43e6c1(0x153)]=='Portuguese\x20(BR)')var _0x12b4f6=users[_0x43e6c1(0x196)];else{if(_0x1500a0[0x0][_0x43e6c1(0x153)]==_0x43e6c1(0x190))var _0x12b4f6=users[_0x43e6c1(0x190)];else{if(_0x1500a0[0x0][_0x43e6c1(0x153)]=='Arabic\x20(ae)')var _0x12b4f6=users[_0x43e6c1(0x1b7)];}}}}}}}_0x4b67f8[_0x43e6c1(0x1b9)](_0x43e6c1(0x14f),{'success':_0x377a5e['flash'](_0x43e6c1(0x14d)),'errors':_0x377a5e[_0x43e6c1(0x1d5)](_0x43e6c1(0x149)),'role':_0x540dc8,'profile':_0x426d11,'adjustment':_0x3bee94,'stock':_0x4b991e,'master_shop':_0x1500a0,'warehouse_name':_0x2565e0,'unit':_0x216570,'language':_0x12b4f6});}catch(_0x1c5a14){console[_0x43e6c1(0x1a7)](_0x1c5a14),_0x4b67f8[_0x43e6c1(0x179)](0xc8)[_0x43e6c1(0x142)]({'message':_0x1c5a14['message']});}}),router['post']('/preview/:id',auth,async(_0x386886,_0x556a7a)=>{var _0x589387=a0_0x1df68d;try{const {invoice:_0x50112e,warehouse_name:_0x26328c,Room_name:_0x45e88b}=_0x386886['body'],_0x127e53=_0x386886['params']['id'],_0x336b27=await adjustment_finished[_0x589387(0x1b6)]({'_id':_0x127e53});var _0x476b37;const _0x3812af=_0x336b27[_0x589387(0x1a5)]['map'](async _0x4df352=>{var _0x3b0c52=_0x589387;if(_0x4df352['adjust_qty']>0x0){_0x476b37=await warehouse[_0x3b0c52(0x17f)]({'name':_0x26328c,'room':_0x4df352[_0x3b0c52(0x1a4)]});const _0xa2bf90=_0x476b37['product_details'][_0x3b0c52(0x16e)](_0x474f88=>{var _0xdc2adf=_0x3b0c52;console[_0xdc2adf(0x1a7)](_0x4df352['types']);if(_0x4df352[_0xdc2adf(0x131)]==_0xdc2adf(0x1c9))_0x474f88[_0xdc2adf(0x145)]==_0x4df352[_0xdc2adf(0x12e)]&&(_0x474f88['product_stock']=_0x474f88[_0xdc2adf(0x1ad)]-_0x4df352['adjust_qty']);else _0x4df352['types']==_0xdc2adf(0x1da)&&(_0x474f88[_0xdc2adf(0x145)]==_0x4df352['id_transaction']&&(_0x474f88[_0xdc2adf(0x1ad)]=_0x474f88[_0xdc2adf(0x1ad)]+_0x4df352[_0xdc2adf(0x14e)]));});}return _0x476b37;});Promise['all'](_0x3812af)[_0x589387(0x138)](async _0x4b8869=>{var _0x9a2f96=_0x589387;try{for(const _0x4f9c76 of _0x4b8869){await _0x4f9c76[_0x9a2f96(0x1c7)]();}_0x336b27[_0x9a2f96(0x1ac)]='True';const _0x303124=await _0x336b27['save'](),_0x22f004=await master_shop[_0x9a2f96(0x1cd)](),_0x19abe1=await email_settings[_0x9a2f96(0x17f)](),_0x172c1a=await supervisor_settings[_0x9a2f96(0x1cd)]();var _0x45e2d4=_0x336b27[_0x9a2f96(0x1a5)],_0x5ba720='',_0xcf2ba0;for(_0xcf2ba0 in _0x45e2d4){var _0x191c3b='FG';_0x336b27['warehouse_name']=='DRY\x20GOODS'&&(_0x191c3b='DG'),_0x5ba720+=_0x9a2f96(0x13f)+_0x9a2f96(0x1cb)+_0x45e2d4[_0xcf2ba0]['product_name']+'</td>'+_0x9a2f96(0x1cb)+_0x45e2d4[_0xcf2ba0][_0x9a2f96(0x183)]+_0x9a2f96(0x1bc)+_0x9a2f96(0x1cb)+_0x45e2d4[_0xcf2ba0][_0x9a2f96(0x14e)]+_0x9a2f96(0x1bc)+_0x9a2f96(0x1cb)+_0x45e2d4[_0xcf2ba0][_0x9a2f96(0x144)]+_0x9a2f96(0x1bc)+_0x9a2f96(0x1cb)+_0x45e2d4[_0xcf2ba0]['secondary_unit']+_0x9a2f96(0x1bc)+_0x9a2f96(0x1cb)+_0x336b27[_0x9a2f96(0x163)]+'</td>'+_0x9a2f96(0x1cb)+_0x45e2d4[_0xcf2ba0][_0x9a2f96(0x1a4)]+_0x9a2f96(0x1bc)+_0x9a2f96(0x1cb)+_0x191c3b+_0x45e2d4[_0xcf2ba0][_0x9a2f96(0x166)]+_0x9a2f96(0x1bc)+'</tr>';}_0x386886[_0x9a2f96(0x1d5)](_0x9a2f96(0x14d),'Adjustment\x20Finalize\x20Successfully'),_0x556a7a[_0x9a2f96(0x1b0)]('/picking_list/PDF_adjustmentFinal/'+_0x303124[_0x9a2f96(0x145)]);}catch(_0x501749){console[_0x9a2f96(0x1b2)](_0x501749),_0x556a7a[_0x9a2f96(0x179)](0x1f4)['json']({'error':_0x9a2f96(0x170)});}})[_0x589387(0x134)](_0x11d440=>{var _0x10c2f7=_0x589387;console[_0x10c2f7(0x1b2)](_0x11d440),_0x556a7a['status'](0x1f4)[_0x10c2f7(0x142)]({'error':'An\x20error\x20occurred.'});});}catch(_0x404a16){_0x556a7a[_0x589387(0x142)]({'message':_0x404a16[_0x589387(0x13a)]});}}),router[a0_0x1df68d(0x171)]('/view/:id',auth,async(_0x53fea7,_0x2e9399)=>{var _0x353cb3=a0_0x1df68d;try{const {username:_0x1b7f2b,email:_0xdfc6d,role:_0x3c18d4}=_0x53fea7[_0x353cb3(0x18b)],_0x354cc0=_0x53fea7['user'],_0x5f2d78=await profile[_0x353cb3(0x17f)]({'email':_0x354cc0[_0x353cb3(0x1be)]}),_0xe7a103=await master_shop['find']();console['log'](_0x353cb3(0x16d),_0xe7a103);const _0x490796=_0x53fea7[_0x353cb3(0x17b)]['id'],_0x3fcbf1=await adjustment_finished[_0x353cb3(0x1b6)]({'_id':_0x490796});let _0x65819b=new Date(_0x3fcbf1[_0x353cb3(0x1c8)]),_0x456515=('0'+_0x65819b[_0x353cb3(0x16c)]())[_0x353cb3(0x1ce)](-0x2),_0x3d18b1=('0'+(_0x65819b[_0x353cb3(0x1a9)]()+0x1))[_0x353cb3(0x1ce)](-0x2),_0x34c7fd=_0x65819b[_0x353cb3(0x1b3)](),_0x257cb2=_0x34c7fd+'-'+_0x3d18b1+'-'+_0x456515;var _0x3c5fb5=[_0x353cb3(0x12b),_0x353cb3(0x130),'Return\x20Rooms'];const _0x21812f=await purchases[_0x353cb3(0x164)]([{'$match':{'warehouse_name':_0x3fcbf1['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0x353cb3(0x193)}}]);console[_0x353cb3(0x1a7)]('purchases_data',_0x21812f);const _0x9d62c4=await product[_0x353cb3(0x1cd)]({}),_0x1dc169=await warehouse[_0x353cb3(0x164)]([{'$match':{'name':_0x3fcbf1[_0x353cb3(0x163)],'room':_0x3fcbf1[_0x353cb3(0x15d)]}},{'$unwind':_0x353cb3(0x17a)},{'$group':{'_id':_0x353cb3(0x162),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x353cb3(0x176)},'bay':{'$first':_0x353cb3(0x16a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x353cb3(0x152)},'floorlevel':{'$first':_0x353cb3(0x174)},'primary_code':{'$first':_0x353cb3(0x19b)},'secondary_code':{'$first':_0x353cb3(0x156)},'product_code':{'$first':_0x353cb3(0x146)},'storage':{'$first':_0x353cb3(0x1b5)},'rack':{'$first':_0x353cb3(0x175)}}}]);if(_0xe7a103[0x0][_0x353cb3(0x153)]=='English\x20(US)'){var _0x58ac60=users[_0x353cb3(0x158)];console['log'](_0x58ac60);}else{if(_0xe7a103[0x0][_0x353cb3(0x153)]==_0x353cb3(0x160))var _0x58ac60=users[_0x353cb3(0x160)];else{if(_0xe7a103[0x0][_0x353cb3(0x153)]==_0x353cb3(0x1c3))var _0x58ac60=users[_0x353cb3(0x1c3)];else{if(_0xe7a103[0x0][_0x353cb3(0x153)]==_0x353cb3(0x188))var _0x58ac60=users[_0x353cb3(0x188)];else{if(_0xe7a103[0x0][_0x353cb3(0x153)]==_0x353cb3(0x191))var _0x58ac60=users[_0x353cb3(0x191)];else{if(_0xe7a103[0x0]['language']==_0x353cb3(0x165))var _0x58ac60=users[_0x353cb3(0x196)];else{if(_0xe7a103[0x0][_0x353cb3(0x153)]=='Chinese')var _0x58ac60=users[_0x353cb3(0x190)];else{if(_0xe7a103[0x0]['language']=='Arabic\x20(ae)')var _0x58ac60=users[_0x353cb3(0x1b7)];}}}}}}}_0x2e9399[_0x353cb3(0x1b9)](_0x353cb3(0x159),{'success':_0x53fea7[_0x353cb3(0x1d5)](_0x353cb3(0x14d)),'errors':_0x53fea7['flash']('errors'),'role':_0x354cc0,'profile':_0x5f2d78,'adjustment':_0x3fcbf1,'stock':_0x1dc169,'master_shop':_0xe7a103,'warehouse_name':_0x21812f,'unit':_0x9d62c4,'language':_0x58ac60,'rooms_data':_0x3c5fb5,'ed_fullDate':_0x257cb2});}catch(_0x435547){console[_0x353cb3(0x1a7)](_0x435547),_0x2e9399[_0x353cb3(0x179)](0xc8)[_0x353cb3(0x142)]({'message':_0x435547[_0x353cb3(0x13a)]});}}),router['post']('/view/:id',auth,async(_0x211f65,_0x298a2d)=>{var _0x85aeef=a0_0x1df68d;try{const _0xd9cbeb=_0x211f65[_0x85aeef(0x17b)]['id'],_0x91cb4b=await adjustment_finished[_0x85aeef(0x1b6)]({'_id':_0xd9cbeb}),_0x3a3c5c=await warehouse[_0x85aeef(0x17f)]({'name':_0x91cb4b[_0x85aeef(0x163)],'room':_0x91cb4b['room']}),{warehouse_name:_0x318f4e,date:_0xb30a91,prod_name:_0x32ca75,level:_0x26a581,isle:_0x10f439,pallet:_0xf48617,stock:_0x52df88,types:_0x3de373,adjust_qty:_0x5eda7d,new_adjust_qty:_0x4412aa,note:_0x1b4c9e,Room_name:_0x4561d8,invoice:_0x29aa83,JO_number:_0x3587ac}=_0x211f65[_0x85aeef(0x1b4)];if(typeof _0x32ca75==_0x85aeef(0x139))var _0x5dc6db=[_0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x1d8)]],_0x193947=[_0x211f65['body'][_0x85aeef(0x1c5)]],_0x5e25d4=[_0x211f65['body'][_0x85aeef(0x151)]],_0x20b9aa=[_0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x131)]],_0x13d792=[_0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x14e)]],_0x594a2b=[_0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x19f)]],_0x58dbc8=[_0x211f65[_0x85aeef(0x1b4)]['prod_code']],_0x52e126=[_0x211f65[_0x85aeef(0x1b4)]['unit']],_0x2f69ef=[_0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x19c)]],_0x54caa8=[_0x211f65[_0x85aeef(0x1b4)]['batch_code']],_0x46b2de=[_0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x1c8)]];else var _0x5dc6db=[..._0x211f65['body'][_0x85aeef(0x1d8)]],_0x193947=[..._0x211f65['body'][_0x85aeef(0x1c5)]],_0x5e25d4=[..._0x211f65[_0x85aeef(0x1b4)]['stock']],_0x20b9aa=[..._0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x131)]],_0x13d792=[..._0x211f65['body'][_0x85aeef(0x14e)]],_0x594a2b=[..._0x211f65['body'][_0x85aeef(0x19f)]],_0x58dbc8=[..._0x211f65['body'][_0x85aeef(0x1d9)]],_0x52e126=[..._0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x144)]],_0x2f69ef=[..._0x211f65['body'][_0x85aeef(0x19c)]],_0x54caa8=[..._0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x1ca)]],_0x46b2de=[..._0x211f65[_0x85aeef(0x1b4)][_0x85aeef(0x1c8)]];const _0x39f7ac=_0x5dc6db[_0x85aeef(0x16e)](_0x3a8907=>{return _0x3a8907={'product_name':_0x3a8907};});_0x193947[_0x85aeef(0x1a1)]((_0x42fa55,_0x4d2f28)=>{var _0x5585a4=_0x85aeef;_0x39f7ac[_0x4d2f28][_0x5585a4(0x166)]=_0x42fa55;}),_0x5e25d4['forEach']((_0x214ef1,_0x4996f9)=>{_0x39f7ac[_0x4996f9]['stockBefore']=_0x214ef1;}),_0x20b9aa[_0x85aeef(0x1a1)]((_0x515e5d,_0x2018b1)=>{var _0x52a6ed=_0x85aeef;_0x39f7ac[_0x2018b1][_0x52a6ed(0x131)]=_0x515e5d;}),_0x13d792[_0x85aeef(0x1a1)]((_0x183507,_0xc19220)=>{var _0x51e332=_0x85aeef;_0x39f7ac[_0xc19220][_0x51e332(0x14e)]=_0x183507;}),_0x594a2b[_0x85aeef(0x1a1)]((_0x2224ea,_0xce319a)=>{var _0x2441c3=_0x85aeef;_0x39f7ac[_0xce319a][_0x2441c3(0x19f)]=_0x2224ea;}),_0x52e126[_0x85aeef(0x1a1)]((_0x4328b5,_0x5efb6f)=>{_0x39f7ac[_0x5efb6f]['unit']=_0x4328b5;}),_0x2f69ef['forEach']((_0x426770,_0x10f154)=>{var _0x43252c=_0x85aeef;_0x39f7ac[_0x10f154][_0x43252c(0x1c4)]=_0x426770;}),_0x58dbc8[_0x85aeef(0x1a1)]((_0x540a73,_0x3c681b)=>{_0x39f7ac[_0x3c681b]['product_code']=_0x540a73;}),_0x54caa8[_0x85aeef(0x1a1)]((_0x1493af,_0x980245)=>{var _0x11cc7c=_0x85aeef;_0x39f7ac[_0x980245][_0x11cc7c(0x1ca)]=_0x1493af;}),_0x46b2de['forEach']((_0x1059e3,_0x50f6cb)=>{var _0x32e445=_0x85aeef;_0x39f7ac[_0x50f6cb][_0x32e445(0x1c8)]=_0x1059e3;});const _0x88b581=_0x39f7ac[_0x85aeef(0x1b8)](_0x9ffb38=>_0x9ffb38[_0x85aeef(0x14e)]!=='0'&&_0x9ffb38[_0x85aeef(0x14e)]!=='');var _0x521b59=0x0;_0x88b581['forEach'](_0x333afc=>{var _0x33ed12=_0x85aeef;console['log']('foreach\x20newproduct',_0x333afc),parseInt(_0x333afc[_0x33ed12(0x14e)])<=0x0&&_0x521b59++;});if(_0x521b59!=0x0)return _0x211f65[_0x85aeef(0x1d5)](_0x85aeef(0x149),_0x85aeef(0x1bd)),_0x298a2d[_0x85aeef(0x1b0)](_0x85aeef(0x13e));_0x91cb4b[_0x85aeef(0x163)]=_0x318f4e,_0x91cb4b['date']=_0xb30a91,_0x91cb4b['product']=_0x88b581,_0x91cb4b['note']=_0x1b4c9e,_0x91cb4b['room']=_0x4561d8,_0x91cb4b['invoice']=_0x29aa83,_0x91cb4b[_0x85aeef(0x1d1)]=_0x3587ac;const _0x223893=await _0x91cb4b[_0x85aeef(0x1c7)](),_0x1063bd=await warehouse[_0x85aeef(0x17f)]({'name':_0x318f4e,'room':_0x4561d8});_0x223893[_0x85aeef(0x1a5)]['forEach'](_0x568bcc=>{var _0x23a358=_0x85aeef;const _0x1b451e=_0x1063bd[_0x23a358(0x137)]['map'](_0x355e8f=>{var _0x1b6711=_0x23a358;_0x568bcc[_0x1b6711(0x131)]==_0x1b6711(0x1c9)?_0x355e8f[_0x1b6711(0x194)]==_0x568bcc[_0x1b6711(0x194)]&&_0x355e8f[_0x1b6711(0x166)]==_0x568bcc[_0x1b6711(0x166)]&&(_0x355e8f[_0x1b6711(0x1ad)]=parseInt(_0x355e8f[_0x1b6711(0x1ad)])-parseInt(_0x568bcc[_0x1b6711(0x14e)])):_0x355e8f[_0x1b6711(0x194)]==_0x568bcc[_0x1b6711(0x194)]&&_0x355e8f[_0x1b6711(0x166)]==_0x568bcc[_0x1b6711(0x166)]&&(_0x355e8f[_0x1b6711(0x1ad)]=parseInt(_0x355e8f[_0x1b6711(0x1ad)])+parseInt(_0x568bcc[_0x1b6711(0x14e)]));});}),await _0x1063bd[_0x85aeef(0x1c7)](),_0x211f65[_0x85aeef(0x1d5)]('success','adjustment\x20data\x20update\x20successfully'),_0x298a2d[_0x85aeef(0x1b0)](_0x85aeef(0x185));}catch(_0x26c7c9){console[_0x85aeef(0x1a7)](_0x26c7c9);}}),router['post'](a0_0x1df68d(0x1a8),async(_0x5ea32b,_0x508cf7)=>{var _0x1447c2=a0_0x1df68d;const {primary_code:_0x5a00cc,warehouse_data:_0x128de0,rooms_data:_0x252c05,Roomslist:_0x533a72}=_0x5ea32b['body'],_0x55ce6a=_0x533a72[_0x1447c2(0x1c6)](','),_0x2ad809=[];async function _0x15cf17(_0x19a39c){var _0x2ede89=_0x1447c2;const _0xbf6c8b=await warehouse[_0x2ede89(0x164)]([{'$match':{'name':_0x128de0,'room':_0x19a39c}},{'$unwind':_0x2ede89(0x17a)},{'$match':{'product_details.primary_code':_0x5a00cc}},{'$group':{'_id':_0x2ede89(0x162),'name':{'$first':_0x2ede89(0x19e)},'product_stock':{'$first':_0x2ede89(0x176)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2ede89(0x156)},'product_code':{'$first':_0x2ede89(0x146)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x2ede89(0x16a)},'type':{'$first':_0x2ede89(0x152)},'pallet':{'$first':_0x2ede89(0x174)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2ede89(0x14a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2ede89(0x18f)},'production_date':{'$first':_0x2ede89(0x184)},'batch_code':{'$first':_0x2ede89(0x16f)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2ede89(0x135)}}}]),_0x147e14=await warehouse[_0x2ede89(0x164)]([{'$match':{'name':_0x128de0,'room':_0x19a39c}},{'$unwind':_0x2ede89(0x17a)},{'$match':{'product_details.secondary_code':_0x5a00cc}},{'$group':{'_id':_0x2ede89(0x162),'name':{'$first':_0x2ede89(0x19e)},'product_stock':{'$first':_0x2ede89(0x176)},'primary_code':{'$first':_0x2ede89(0x19b)},'secondary_code':{'$first':_0x2ede89(0x156)},'product_code':{'$first':_0x2ede89(0x146)},'level':{'$first':_0x2ede89(0x132)},'bay':{'$first':_0x2ede89(0x16a)},'type':{'$first':_0x2ede89(0x152)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2ede89(0x189)},'secondary_unit':{'$first':_0x2ede89(0x14a)},'storage':{'$first':_0x2ede89(0x1b5)},'rack':{'$first':_0x2ede89(0x175)},'expiry_date':{'$first':_0x2ede89(0x18f)},'production_date':{'$first':_0x2ede89(0x184)},'batch_code':{'$first':_0x2ede89(0x16f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x2ede89(0x1a6)},'invoice':{'$first':_0x2ede89(0x135)}}}]);if(_0xbf6c8b[_0x2ede89(0x14b)]>0x0)_0x2ad809['push'](_0xbf6c8b);else _0x147e14[_0x2ede89(0x14b)]>0x0&&_0x2ad809[_0x2ede89(0x154)](_0x147e14);}const _0x4ed037=_0x55ce6a[_0x1447c2(0x16e)](_0x3eed08=>_0x15cf17(_0x3eed08));await Promise[_0x1447c2(0x17d)](_0x4ed037),_0x508cf7[_0x1447c2(0x142)](_0x2ad809);}),router[a0_0x1df68d(0x195)](a0_0x1df68d(0x133),async(_0x5c5917,_0x43df4b)=>{var _0x3565d4=a0_0x1df68d;const {productCode:_0xeb8e44,bay:_0x22255d,warehouses:_0x2bd8e5,room:_0x4507e9}=_0x5c5917[_0x3565d4(0x1b4)];console[_0x3565d4(0x1a7)](_0x5c5917[_0x3565d4(0x1b4)]);try{const _0x5e926c=await warehouse[_0x3565d4(0x164)]([{'$match':{'name':_0x2bd8e5,'room':_0x4507e9}},{'$unwind':_0x3565d4(0x17a)},{'$match':{'product_details.bay':parseInt(_0x22255d)}},{'$group':{'_id':_0x3565d4(0x162),'name':{'$first':_0x3565d4(0x19e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3565d4(0x16a)},'maxProducts':{'$first':_0x3565d4(0x18e)}}}]);_0x43df4b[_0x3565d4(0x179)](0xc8)[_0x3565d4(0x142)](_0x5e926c);}catch(_0x92f374){_0x43df4b['status'](0x194)['json']({'message':_0x92f374['message']});}}),module[a0_0x1df68d(0x15c)]=router;