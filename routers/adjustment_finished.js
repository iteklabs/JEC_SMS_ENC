var a0_0x34df75=a0_0x2c30;(function(_0x4b6872,_0x323ee9){var _0x559e08=a0_0x2c30,_0x371d76=_0x4b6872();while(!![]){try{var _0x57541d=parseInt(_0x559e08(0x20d))/0x1+parseInt(_0x559e08(0x203))/0x2*(parseInt(_0x559e08(0x1af))/0x3)+parseInt(_0x559e08(0x1f6))/0x4+parseInt(_0x559e08(0x16c))/0x5+parseInt(_0x559e08(0x1c0))/0x6+parseInt(_0x559e08(0x1d3))/0x7+-parseInt(_0x559e08(0x1a7))/0x8*(parseInt(_0x559e08(0x1fe))/0x9);if(_0x57541d===_0x323ee9)break;else _0x371d76['push'](_0x371d76['shift']());}catch(_0x2ebef3){_0x371d76['push'](_0x371d76['shift']());}}}(a0_0x33b4,0xb2968));function a0_0x33b4(){var _0x201e95=['You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','room','get','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.product_name','/view_logs','stockBefore','email','edit_adjustment_finished','True','$product_details.storage','An\x20error\x20occurred\x20while\x20saving\x20data.','invoice','Enclosed','New_Qty_Converted_adj','Portuguese','unit','/adjustment_finished/view','$product_details.primary_code','log','product_name','save','../models/all_models','JO_number','error','foreach\x20newproduct','user','$product_details.batch_code','stock','warehouse_name','role','add_adjustment_finished_logs','split','New_Qty_Converted','post','secondary_unit','body','$_id','1329496ACtWFl','/view/add_adjustment','Spanish','adjustment\x20data\x20update\x20successfully','/preview/:id','French','json','Return\x20Rooms','96963PsXVYs','prod_cat','$product_details.invoice','Portuguese\x20(BR)','LOG-ADJ-','finalize','message','slice','string','</tr>','$product.room_names','German','errors','floor','match','getDate','master','3432444yqHzML','Ambient','product','$product_details.type','../public/language/languages.json','$product_details.secondary_unit','push','_id','nodemailer','adjustment\x20add\x20successfull','English\x20(US)','$product_details._id','ADJ-','getMonth','success','Primary_Units','Hindi','$name','add_adjustment_finished','3854011IUmqfd','$product_details.product_stock','Enabled','map','id_transaction','$warehouse_name','Arabic','types','product_stock','staff','forEach','adjustment_finished','random','purchases_data','$product_details.product_code','all','findById','An\x20error\x20occurred.','level','$product_details.maxProducts','/view/:id','warehouse','</td>','redirect','$product_details.rack','aggregate','production_date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','language','room_names','../middleware/auth','Secondary_units','prod_invoice','catch','date','1960312RsWVuv','product_code','$product_details.level','/CheckingWarehouse','DRY\x20GOODS','$room','new_adjust_qty','/adjustment/view','171NdMgvR','id_transaction_from','filter','expiry_date','$product_details.product_name','74vLPkML','product_details','/view/add_adjustment_logs','Chinese','$product_details.production_date','$product_details','/view','params','prod_name','back','311731LnmKGs','/adjustment_finished/preview/','findOne','Arabic\x20(ae)','$product_details.secondary_code','padStart','product_date','find','Router','$product_details.expiry_date','$invoice','$product_details.floorlevel','Rooms','adjust_qty','3843580EmYRTL','ADJF-','status','maxPerUnit','$date','bay','then','$product_details.bay','$product_details.maxPerUnit','toString','adjustment_finished_logs','prod_code','invoice_init','$product','$product_details.unit','flash','English','batch_code','render','length','Adjustment\x20Finalize\x20Successfully'];a0_0x33b4=function(){return _0x201e95;};return a0_0x33b4();}function a0_0x2c30(_0x246b29,_0x472a4b){var _0x33b42b=a0_0x33b4();return a0_0x2c30=function(_0x2c3092,_0x192ced){_0x2c3092=_0x2c3092-0x161;var _0x20d504=_0x33b42b[_0x2c3092];return _0x20d504;},a0_0x2c30(_0x246b29,_0x472a4b);}const express=require('express'),app=express(),router=express[a0_0x34df75(0x166)](),auth=require(a0_0x34df75(0x1f1)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x34df75(0x197)),users=require(a0_0x34df75(0x1c4)),nodemailer=require(a0_0x34df75(0x1c8));router['get'](a0_0x34df75(0x209),auth,async(_0xd81ee2,_0x2fc316)=>{var _0x2c78df=a0_0x34df75;try{const {username:_0x17646d,email:_0x596d70,role:_0x400629}=_0xd81ee2[_0x2c78df(0x19b)],_0x55096f=_0xd81ee2['user'],_0x376084=await profile['findOne']({'email':_0x55096f['email']}),_0x250401=await master_shop[_0x2c78df(0x165)]();let _0x26a2e0;if(_0x55096f[_0x2c78df(0x19f)]=='staff'){const _0x7ad3f3=await staff['findOne']({'email':_0x55096f[_0x2c78df(0x188)]});_0x26a2e0=await warehouse[_0x2c78df(0x165)]({'status':_0x2c78df(0x1d5),'name':_0x7ad3f3[_0x2c78df(0x1e8)]});}else _0x26a2e0=await warehouse['find']({'status':'Enabled'});const _0x578bbb=await product[_0x2c78df(0x165)]();let _0x332115;if(_0x55096f[_0x2c78df(0x19f)]=='staff'){const _0x1e4d3b=await staff['findOne']({'email':_0x55096f['email']});_0x332115=await adjustment_finished[_0x2c78df(0x165)]({'warehouse_name':_0x1e4d3b['warehouse']});}else _0x332115=await adjustment_finished[_0x2c78df(0x1ec)]([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0x2c78df(0x179)},{'$group':{'_id':_0x2c78df(0x1a6),'invoice':{'$first':_0x2c78df(0x168)},'date':{'$first':_0x2c78df(0x170)},'warehouse_name':{'$first':_0x2c78df(0x1d8)},'room':{'$addToSet':_0x2c78df(0x1b9)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x250401[0x0][_0x2c78df(0x1ef)]==_0x2c78df(0x1ca)){var _0x348524=users['English'];console[_0x2c78df(0x194)](_0x348524);}else{if(_0x250401[0x0][_0x2c78df(0x1ef)]=='Hindi')var _0x348524=users[_0x2c78df(0x1d0)];else{if(_0x250401[0x0][_0x2c78df(0x1ef)]==_0x2c78df(0x1ba))var _0x348524=users[_0x2c78df(0x1ba)];else{if(_0x250401[0x0]['language']==_0x2c78df(0x1a9))var _0x348524=users[_0x2c78df(0x1a9)];else{if(_0x250401[0x0][_0x2c78df(0x1ef)]=='French')var _0x348524=users[_0x2c78df(0x1ac)];else{if(_0x250401[0x0]['language']=='Portuguese\x20(BR)')var _0x348524=users[_0x2c78df(0x190)];else{if(_0x250401[0x0][_0x2c78df(0x1ef)]==_0x2c78df(0x206))var _0x348524=users[_0x2c78df(0x206)];else{if(_0x250401[0x0][_0x2c78df(0x1ef)]==_0x2c78df(0x161))var _0x348524=users[_0x2c78df(0x1d9)];}}}}}}}_0x2fc316[_0x2c78df(0x17e)](_0x2c78df(0x1de),{'success':_0xd81ee2['flash'](_0x2c78df(0x1ce)),'errors':_0xd81ee2[_0x2c78df(0x17b)](_0x2c78df(0x1bb)),'role':_0x55096f,'profile':_0x376084,'warehouse':_0x26a2e0,'product':_0x578bbb,'adjustment':_0x332115,'master_shop':_0x250401,'language':_0x348524});}catch(_0x34a997){console[_0x2c78df(0x194)](_0x34a997);}}),router[a0_0x34df75(0x183)](a0_0x34df75(0x186),auth,async(_0x259661,_0x4f9ce4)=>{var _0x38bb5a=a0_0x34df75;try{const {username:_0x4b4c2e,email:_0x4a28e7,role:_0x1ab1a8}=_0x259661[_0x38bb5a(0x19b)],_0x196a5b=_0x259661['user'],_0x1824ba=await profile[_0x38bb5a(0x20f)]({'email':_0x196a5b[_0x38bb5a(0x188)]}),_0x43d100=await master_shop[_0x38bb5a(0x165)]();let _0xd6af98;if(_0x196a5b[_0x38bb5a(0x19f)]==_0x38bb5a(0x1dc)){const _0x4ffdf7=await staff[_0x38bb5a(0x20f)]({'email':_0x196a5b['email']});_0xd6af98=await warehouse['find']({'status':'Enabled','name':_0x4ffdf7[_0x38bb5a(0x1e8)]});}else _0xd6af98=await warehouse['find']({'status':_0x38bb5a(0x1d5)});const _0x4fe19f=await product['find']();let _0x409221;if(_0x196a5b[_0x38bb5a(0x19f)]=='staff'){const _0x42466f=await staff['findOne']({'email':_0x196a5b['email']});_0x409221=await adjustment_finished[_0x38bb5a(0x165)]({'warehouse_name':_0x42466f[_0x38bb5a(0x1e8)]});}else _0x409221=await adjustment_finished[_0x38bb5a(0x1ec)]([{'$match':{'type_of_transaction':'logs'}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x38bb5a(0x170)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x38bb5a(0x1b9)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x43d100[0x0][_0x38bb5a(0x1ef)]==_0x38bb5a(0x1ca))var _0x23326b=users[_0x38bb5a(0x17c)];else{if(_0x43d100[0x0][_0x38bb5a(0x1ef)]=='Hindi')var _0x23326b=users[_0x38bb5a(0x1d0)];else{if(_0x43d100[0x0]['language']==_0x38bb5a(0x1ba))var _0x23326b=users['German'];else{if(_0x43d100[0x0]['language']==_0x38bb5a(0x1a9))var _0x23326b=users[_0x38bb5a(0x1a9)];else{if(_0x43d100[0x0][_0x38bb5a(0x1ef)]=='French')var _0x23326b=users['French'];else{if(_0x43d100[0x0]['language']==_0x38bb5a(0x1b2))var _0x23326b=users[_0x38bb5a(0x190)];else{if(_0x43d100[0x0]['language']=='Chinese')var _0x23326b=users[_0x38bb5a(0x206)];else{if(_0x43d100[0x0][_0x38bb5a(0x1ef)]==_0x38bb5a(0x161))var _0x23326b=users[_0x38bb5a(0x1d9)];}}}}}}}_0x4f9ce4[_0x38bb5a(0x17e)](_0x38bb5a(0x176),{'success':_0x259661['flash'](_0x38bb5a(0x1ce)),'errors':_0x259661['flash'](_0x38bb5a(0x1bb)),'role':_0x196a5b,'profile':_0x1824ba,'warehouse':_0xd6af98,'product':_0x4fe19f,'adjustment':_0x409221,'master_shop':_0x43d100,'language':_0x23326b});}catch(_0x19c24d){console[_0x38bb5a(0x194)](_0x19c24d);}});async function getRandom8DigitNumber(){var _0x1c1e90=a0_0x34df75;const _0x568388=0x989680,_0x5e6a93=0x5f5e0ff,_0x377631=Math[_0x1c1e90(0x1bc)](Math[_0x1c1e90(0x1df)]()*(_0x5e6a93-_0x568388+0x1))+_0x568388;var _0x3e1ddf;const _0x5c93a8=await adjustment_finished[_0x1c1e90(0x20f)]({'invoice':_0x1c1e90(0x16d)+_0x377631});return _0x5c93a8&&_0x5c93a8[_0x1c1e90(0x17f)]>0x0?_0x3e1ddf=_0x1c1e90(0x16d)+_0x377631:_0x3e1ddf='ADJF-'+_0x377631,_0x3e1ddf;}router['get']('/view/add_adjustment',auth,async(_0x132045,_0x219b81)=>{var _0xe2a1b7=a0_0x34df75;try{const {username:_0x4f5bf3,email:_0x3535d1,role:_0x497c25}=_0x132045[_0xe2a1b7(0x19b)],_0x56ec0e=_0x132045['user'],_0x5023a1=await profile[_0xe2a1b7(0x20f)]({'email':_0x56ec0e['email']}),_0x5d69ed=await master_shop[_0xe2a1b7(0x165)]();let _0x129d22;if(_0x56ec0e[_0xe2a1b7(0x19f)]=='staff'){const _0x411b8d=await staff[_0xe2a1b7(0x20f)]({'email':_0x56ec0e[_0xe2a1b7(0x188)]});_0x129d22=await warehouse[_0xe2a1b7(0x1ec)]([{'$match':{'status':_0xe2a1b7(0x1d5),'name':_0x411b8d[_0xe2a1b7(0x1e8)]}},{'$group':{'_id':_0xe2a1b7(0x1d1),'name':{'$first':'$name'}}}]);}else _0x129d22=await warehouse['aggregate']([{'$match':{'status':_0xe2a1b7(0x1d5)}},{'$group':{'_id':_0xe2a1b7(0x1d1),'name':{'$first':_0xe2a1b7(0x1d1)}}}]);const _0x389c53=await product[_0xe2a1b7(0x165)]({}),_0x4a771a=await adjustment_finished['find'](),_0x49536d=_0x4a771a[_0xe2a1b7(0x17f)]+0x1,_0x302ff4=_0xe2a1b7(0x16d)+_0x49536d[_0xe2a1b7(0x175)]()[_0xe2a1b7(0x163)](0x5,'0');var _0x439776=[_0xe2a1b7(0x1c1),_0xe2a1b7(0x18e),_0xe2a1b7(0x1ae)];if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]=='English\x20(US)')var _0x5de653=users[_0xe2a1b7(0x17c)];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]==_0xe2a1b7(0x1d0))var _0x5de653=users[_0xe2a1b7(0x1d0)];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]=='German')var _0x5de653=users[_0xe2a1b7(0x1ba)];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]==_0xe2a1b7(0x1a9))var _0x5de653=users[_0xe2a1b7(0x1a9)];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]==_0xe2a1b7(0x1ac))var _0x5de653=users[_0xe2a1b7(0x1ac)];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]==_0xe2a1b7(0x1b2))var _0x5de653=users['Portuguese'];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]==_0xe2a1b7(0x206))var _0x5de653=users[_0xe2a1b7(0x206)];else{if(_0x5d69ed[0x0][_0xe2a1b7(0x1ef)]==_0xe2a1b7(0x161))var _0x5de653=users[_0xe2a1b7(0x1d9)];}}}}}}}const _0x474bd4=getRandom8DigitNumber();_0x474bd4['then'](_0x178413=>{var _0x3ac4e1=_0xe2a1b7;_0x219b81[_0x3ac4e1(0x17e)](_0x3ac4e1(0x1d2),{'success':_0x132045[_0x3ac4e1(0x17b)](_0x3ac4e1(0x1ce)),'errors':_0x132045[_0x3ac4e1(0x17b)](_0x3ac4e1(0x1bb)),'role':_0x56ec0e,'profile':_0x5023a1,'warehouse':_0x129d22,'product':_0x389c53,'master_shop':_0x5d69ed,'language':_0x5de653,'rooms_data':_0x439776,'invoice_no':_0x178413});})[_0xe2a1b7(0x1f4)](_0x1fb637=>{var _0x21f9a2=_0xe2a1b7;_0x132045['flash'](_0x21f9a2(0x1bb),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x219b81[_0x21f9a2(0x1ea)](_0x21f9a2(0x1fd));});}catch(_0x9a5090){console[_0xe2a1b7(0x194)](_0x9a5090);}}),router['post'](a0_0x34df75(0x1a8),auth,async(_0x1adaf5,_0x3a5f79)=>{var _0x3a4081=a0_0x34df75;try{const {warehouse_name:_0x1fe818,date:_0x282236,prod_name:_0x4e178e,level:_0x2c6e04,isle:_0x477393,pallet:_0x51a323,stock:_0x66a2ea,types:_0xd3b984,adjust_qty:_0x1616c4,new_adjust_qty:_0x1fdb2d,note:_0x5d1ea6,Room_name:_0x61a209,JO_number:_0x3e0849,expiry_date:_0x553092,PO_number:_0x53b0f5,ReqBy:_0x32f574,dateofreq:_0x1ead5e,typeservicesData:_0xefa156,destination:_0xe4739,deliverydate:_0x3366c0,driver:_0x2bf4db,plate:_0x1f86cc,van:_0x3cd45b,DRSI:_0x2c324c,typevehicle:_0x26a028,TSU:_0x2423af,TFU:_0xf7bc30}=_0x1adaf5[_0x3a4081(0x1a5)];if(typeof _0x4e178e==_0x3a4081(0x1b7))var _0x39b780=[_0x1adaf5[_0x3a4081(0x1a5)]['prod_name']],_0x1cac10=[_0x1adaf5['body'][_0x3a4081(0x1e5)]],_0x1c8762=[_0x1adaf5['body'][_0x3a4081(0x19d)]],_0x1fe27d=[_0x1adaf5[_0x3a4081(0x1a5)]['types']],_0x2de4c5=[_0x1adaf5['body'][_0x3a4081(0x18f)]],_0xee3a6c=[_0x1adaf5[_0x3a4081(0x1a5)]['New_Qty_Converted']],_0xaac1ca=[_0x1adaf5[_0x3a4081(0x1a5)]['Primary_Units']],_0x4de1da=[_0x1adaf5['body'][_0x3a4081(0x1f2)]],_0x44e9b1=[_0x1adaf5['body'][_0x3a4081(0x177)]],_0x21d535=[_0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x17d)]],_0x117dbc=[_0x1adaf5['body']['expiry_date']],_0x4ac633=[_0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x164)]],_0x1c2151=[_0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1b0)]],_0x7863d3=[_0x1adaf5['body'][_0x3a4081(0x16a)]],_0x2e6657=[_0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x16f)]],_0x8626a9=[_0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1f3)]],_0x445990=[_0x1adaf5['body']['id_transaction_from']];else var _0x39b780=[..._0x1adaf5[_0x3a4081(0x1a5)]['prod_name']],_0x1cac10=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1e5)]],_0x1c8762=[..._0x1adaf5['body']['stock']],_0x1fe27d=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1da)]],_0x2de4c5=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x18f)]],_0xee3a6c=[..._0x1adaf5[_0x3a4081(0x1a5)]['New_Qty_Converted']],_0xaac1ca=[..._0x1adaf5['body'][_0x3a4081(0x1cf)]],_0x4de1da=[..._0x1adaf5['body'][_0x3a4081(0x1f2)]],_0x44e9b1=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x177)]],_0x21d535=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x17d)]],_0x117dbc=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x201)]],_0x4ac633=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x164)]],_0x1c2151=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1b0)]],_0x7863d3=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x16a)]],_0x2e6657=[..._0x1adaf5[_0x3a4081(0x1a5)]['maxPerUnit']],_0x8626a9=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1f3)]],_0x445990=[..._0x1adaf5[_0x3a4081(0x1a5)][_0x3a4081(0x1ff)]];const _0x56b509=_0x39b780[_0x3a4081(0x1d6)](_0x42a920=>{return _0x42a920={'product_name':_0x42a920};});_0x1cac10[_0x3a4081(0x1dd)]((_0xdf8985,_0x1388cf)=>{var _0x21b91d=_0x3a4081,_0x90db47=_0xdf8985[_0x21b91d(0x1bd)](/[A-Za-z]+/)[0x0],_0x42fef6=parseInt(_0xdf8985['match'](/\d+/)[0x0]);_0x56b509[_0x1388cf]['level']=_0x90db47,_0x56b509[_0x1388cf]['bay']=_0x42fef6;}),_0x445990[_0x3a4081(0x1dd)]((_0x200a50,_0x55108e)=>{var _0x3628fe=_0x3a4081;_0x56b509[_0x55108e][_0x3628fe(0x1d7)]=_0x200a50;}),_0x1c8762[_0x3a4081(0x1dd)]((_0x5e7844,_0x2530b6)=>{var _0x41df77=_0x3a4081;_0x56b509[_0x2530b6][_0x41df77(0x187)]=_0x5e7844;}),_0x1fe27d[_0x3a4081(0x1dd)]((_0x1527f7,_0x5717e1)=>{var _0xe45b27=_0x3a4081;_0x56b509[_0x5717e1][_0xe45b27(0x1da)]=_0x1527f7;}),_0x2de4c5['forEach']((_0x2b24fd,_0x4be320)=>{var _0xf3ad13=_0x3a4081;_0x56b509[_0x4be320][_0xf3ad13(0x16b)]=_0x2b24fd;}),_0xee3a6c[_0x3a4081(0x1dd)]((_0x221a6a,_0x12d873)=>{var _0x2831d2=_0x3a4081;_0x56b509[_0x12d873][_0x2831d2(0x1fc)]=_0x221a6a;}),_0xaac1ca[_0x3a4081(0x1dd)]((_0x184cc3,_0x42c546)=>{var _0x389fa8=_0x3a4081;_0x56b509[_0x42c546][_0x389fa8(0x191)]=_0x184cc3;}),_0x4de1da[_0x3a4081(0x1dd)]((_0x568bc6,_0x520158)=>{var _0x3a6968=_0x3a4081;_0x56b509[_0x520158][_0x3a6968(0x1a4)]=_0x568bc6;}),_0x44e9b1['forEach']((_0x29eb3b,_0xe5bf5b)=>{var _0x4505eb=_0x3a4081;_0x56b509[_0xe5bf5b][_0x4505eb(0x1f7)]=_0x29eb3b;}),_0x21d535[_0x3a4081(0x1dd)]((_0x117923,_0x3bf39f)=>{_0x56b509[_0x3bf39f]['batch_code']=_0x117923;}),_0x117dbc[_0x3a4081(0x1dd)]((_0x3135bd,_0x53b845)=>{var _0x3653ea=_0x3a4081;_0x56b509[_0x53b845][_0x3653ea(0x201)]=_0x3135bd;}),_0x4ac633[_0x3a4081(0x1dd)]((_0x1cb3bc,_0x499c07)=>{var _0x38a6ae=_0x3a4081;_0x56b509[_0x499c07][_0x38a6ae(0x1ed)]=_0x1cb3bc;}),_0x1c2151[_0x3a4081(0x1dd)]((_0x27b578,_0x5ee298)=>{var _0x15c962=_0x3a4081;_0x56b509[_0x5ee298][_0x15c962(0x1b0)]=_0x27b578;}),_0x7863d3['forEach']((_0x4d9240,_0x8626f2)=>{var _0x3b5c87=_0x3a4081;_0x56b509[_0x8626f2][_0x3b5c87(0x1f0)]=_0x4d9240;}),_0x2e6657[_0x3a4081(0x1dd)]((_0x691101,_0x458805)=>{var _0x4684d6=_0x3a4081;_0x56b509[_0x458805][_0x4684d6(0x16f)]=_0x691101;}),_0x8626a9[_0x3a4081(0x1dd)]((_0x20099e,_0x48d0e4)=>{var _0x3e3763=_0x3a4081;_0x56b509[_0x48d0e4][_0x3e3763(0x18d)]=_0x20099e;});const _0x1342d0=_0x56b509[_0x3a4081(0x200)](_0x2b06ec=>_0x2b06ec[_0x3a4081(0x16b)]!=='0'&&_0x2b06ec['adjust_qty']!=='');var _0x4e4f67=0x0;_0x1342d0[_0x3a4081(0x1dd)](_0x40a03a=>{var _0x5a16b2=_0x3a4081;console[_0x5a16b2(0x194)](_0x5a16b2(0x19a),_0x40a03a),parseInt(_0x40a03a[_0x5a16b2(0x16b)])<=0x0&&_0x4e4f67++;});if(_0x4e4f67!=0x0)return _0x1adaf5['flash'](_0x3a4081(0x1bb),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x3a5f79[_0x3a4081(0x1ea)]('back');const _0x173bd8=new invoice_for_adjustment();await _0x173bd8[_0x3a4081(0x196)]();const _0x391a40=new adjustment_finished({'warehouse_name':_0x1fe818,'date':_0x282236,'product':_0x1342d0,'note':_0x5d1ea6,'room':_0x61a209,'invoice':_0x3a4081(0x1cc)+_0x173bd8[_0x3a4081(0x178)][_0x3a4081(0x175)]()[_0x3a4081(0x163)](0x8,'0'),'JO_number':_0x3e0849,'expiry_date':_0x553092,'PO_number':_0x53b0f5,'RequestedBy':_0x32f574,'DateofRequest':_0x1ead5e,'typeservices':_0xefa156,'destination':_0xe4739,'deliverydate':_0x3366c0,'driver':_0x2bf4db,'plate':_0x1f86cc,'van':_0x3cd45b,'DRSI':_0x2c324c,'typevehicle':_0x26a028,'TSU':_0x2423af,'TFU':_0xf7bc30}),_0x3e4cce=await _0x391a40[_0x3a4081(0x196)]();_0x1adaf5[_0x3a4081(0x17b)]('success',_0x3a4081(0x1c9)),_0x3a5f79[_0x3a4081(0x1ea)](_0x3a4081(0x20e)+_0x3e4cce[_0x3a4081(0x1c7)]);}catch(_0x3a1f31){console[_0x3a4081(0x194)](_0x3a1f31),_0x3a5f79[_0x3a4081(0x16e)](0xc8)['json']({'message':_0x3a1f31[_0x3a4081(0x1b5)]});}}),router[a0_0x34df75(0x183)]('/view/add_adjustment_logs',auth,async(_0x18ee8e,_0x33561a)=>{var _0xa94cc6=a0_0x34df75;try{const {username:_0xf02ed1,email:_0x1f11af,role:_0xdbce1}=_0x18ee8e[_0xa94cc6(0x19b)],_0x318d9f=_0x18ee8e[_0xa94cc6(0x19b)],_0x552276=await profile[_0xa94cc6(0x20f)]({'email':_0x318d9f['email']}),_0x353aaa=await master_shop['find']();let _0x5f1f30;if(_0x318d9f[_0xa94cc6(0x19f)]==_0xa94cc6(0x1dc)){const _0x1a5ea4=await staff[_0xa94cc6(0x20f)]({'email':_0x318d9f[_0xa94cc6(0x188)]});_0x5f1f30=await warehouse[_0xa94cc6(0x1ec)]([{'$match':{'status':'Enabled','name':_0x1a5ea4['warehouse']}},{'$group':{'_id':_0xa94cc6(0x1d1),'name':{'$first':_0xa94cc6(0x1d1)}}}]);}else _0x5f1f30=await warehouse[_0xa94cc6(0x1ec)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xa94cc6(0x1d1),'name':{'$first':_0xa94cc6(0x1d1)}}}]);const _0x1aab81=await product[_0xa94cc6(0x165)](),_0x34dfc8=await adjustment_finished[_0xa94cc6(0x165)](),_0x1dff8b=_0x34dfc8[_0xa94cc6(0x17f)]+0x1,_0x40ce18='ADJF-'+_0x1dff8b[_0xa94cc6(0x175)]()[_0xa94cc6(0x163)](0x5,'0');var _0x421e59=['Ambient',_0xa94cc6(0x18e),_0xa94cc6(0x1ae)];if(_0x353aaa[0x0][_0xa94cc6(0x1ef)]==_0xa94cc6(0x1ca))var _0xe3716f=users[_0xa94cc6(0x17c)];else{if(_0x353aaa[0x0]['language']=='Hindi')var _0xe3716f=users[_0xa94cc6(0x1d0)];else{if(_0x353aaa[0x0]['language']==_0xa94cc6(0x1ba))var _0xe3716f=users['German'];else{if(_0x353aaa[0x0][_0xa94cc6(0x1ef)]=='Spanish')var _0xe3716f=users[_0xa94cc6(0x1a9)];else{if(_0x353aaa[0x0][_0xa94cc6(0x1ef)]==_0xa94cc6(0x1ac))var _0xe3716f=users[_0xa94cc6(0x1ac)];else{if(_0x353aaa[0x0][_0xa94cc6(0x1ef)]=='Portuguese\x20(BR)')var _0xe3716f=users['Portuguese'];else{if(_0x353aaa[0x0][_0xa94cc6(0x1ef)]==_0xa94cc6(0x206))var _0xe3716f=users[_0xa94cc6(0x206)];else{if(_0x353aaa[0x0][_0xa94cc6(0x1ef)]==_0xa94cc6(0x161))var _0xe3716f=users['Arabic'];}}}}}}}const _0xc5f1c=getRandom8DigitNumber();_0xc5f1c['then'](_0x53def9=>{var _0x1bdee4=_0xa94cc6;_0x33561a[_0x1bdee4(0x17e)](_0x1bdee4(0x1a0),{'success':_0x18ee8e[_0x1bdee4(0x17b)]('success'),'errors':_0x18ee8e[_0x1bdee4(0x17b)](_0x1bdee4(0x1bb)),'role':_0x318d9f,'profile':_0x552276,'warehouse':_0x5f1f30,'product':_0x1aab81,'master_shop':_0x353aaa,'language':_0xe3716f,'rooms_data':_0x421e59,'invoice_no':_0x53def9});})[_0xa94cc6(0x1f4)](_0x10baca=>{var _0x3ee1e4=_0xa94cc6;_0x18ee8e[_0x3ee1e4(0x17b)](_0x3ee1e4(0x1bb),_0x3ee1e4(0x1ee)),_0x33561a['redirect'](_0x3ee1e4(0x1fd));});}catch(_0x23d1a1){console[_0xa94cc6(0x194)](_0x23d1a1);}}),router[a0_0x34df75(0x1a3)](a0_0x34df75(0x205),auth,async(_0x1c503e,_0x46ec9a)=>{var _0xf4f8de=a0_0x34df75;try{const {warehouse_name:_0x25f9ca,date:_0x30264f,prod_name:_0x21f33b,level:_0x4878d6,isle:_0x3922af,pallet:_0x84cd7c,stock:_0x10e9e9,types:_0xcfc499,adjust_qty:_0x3817eb,new_adjust_qty:_0x324f53,note:_0x133ed5,Room_name:_0x2af9ff,JO_number:_0x1858dd,expiry_date:_0xb04c97,type_of_transaction:_0x5791af,PO_number:_0x62b8c9,ReqBy:_0x1444e6,dateofreq:_0x9ea86c,typeservicesData:_0x3f94aa,destination:_0x367432,deliverydate:_0x272700,driver:_0x1e8efa,plate:_0x76fe44,van:_0x573a3e,DRSI:_0x3d0d27,typevehicle:_0x55e806,TSU:_0x5761a2,TFU:_0x17584c}=_0x1c503e['body'];if(typeof _0x21f33b==_0xf4f8de(0x1b7))var _0x3c4a2b=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x20b)]],_0x396b6b=[_0x1c503e['body']['level']],_0x34079a=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x19d)]],_0x13f68a=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1da)]],_0x9c1d21=[_0x1c503e['body'][_0xf4f8de(0x18f)]],_0x2082af=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1a2)]],_0x2276f4=[_0x1c503e['body'][_0xf4f8de(0x1cf)]],_0x32e6a0=[_0x1c503e['body'][_0xf4f8de(0x1f2)]],_0x53e4f0=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x177)]],_0x96e3d2=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x17d)]],_0x5d221b=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x201)]],_0x21ac57=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x164)]],_0x3c67a4=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1b0)]],_0x5e138d=[_0x1c503e[_0xf4f8de(0x1a5)]['Rooms']],_0x27075b=[_0x1c503e['body'][_0xf4f8de(0x16f)]],_0x1f7599=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1f3)]],_0x3aa927=[_0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1ff)]];else var _0x3c4a2b=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x20b)]],_0x396b6b=[..._0x1c503e[_0xf4f8de(0x1a5)]['level']],_0x34079a=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x19d)]],_0x13f68a=[..._0x1c503e[_0xf4f8de(0x1a5)]['types']],_0x9c1d21=[..._0x1c503e['body'][_0xf4f8de(0x18f)]],_0x2082af=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1a2)]],_0x2276f4=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1cf)]],_0x32e6a0=[..._0x1c503e[_0xf4f8de(0x1a5)]['Secondary_units']],_0x53e4f0=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x177)]],_0x96e3d2=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x17d)]],_0x5d221b=[..._0x1c503e[_0xf4f8de(0x1a5)]['expiry_date']],_0x21ac57=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x164)]],_0x3c67a4=[..._0x1c503e['body'][_0xf4f8de(0x1b0)]],_0x5e138d=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x16a)]],_0x27075b=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x16f)]],_0x1f7599=[..._0x1c503e[_0xf4f8de(0x1a5)][_0xf4f8de(0x1f3)]],_0x3aa927=[..._0x1c503e[_0xf4f8de(0x1a5)]['id_transaction_from']];const _0x3ca8a0=_0x3c4a2b[_0xf4f8de(0x1d6)](_0xb04eee=>{return _0xb04eee={'product_name':_0xb04eee};});_0x396b6b[_0xf4f8de(0x1dd)]((_0x181daf,_0xda96c4)=>{var _0x54f27b=_0xf4f8de,_0x453519=_0x181daf['match'](/[A-Za-z]+/)[0x0],_0x58d004=parseInt(_0x181daf[_0x54f27b(0x1bd)](/\d+/)[0x0]);_0x3ca8a0[_0xda96c4][_0x54f27b(0x1e5)]=_0x453519,_0x3ca8a0[_0xda96c4][_0x54f27b(0x171)]=_0x58d004;}),_0x3aa927['forEach']((_0x2db065,_0x52ff1c)=>{var _0xeaa4a4=_0xf4f8de;_0x3ca8a0[_0x52ff1c][_0xeaa4a4(0x1d7)]=_0x2db065;}),_0x34079a[_0xf4f8de(0x1dd)]((_0x3ba088,_0x4d256b)=>{var _0x42c914=_0xf4f8de;_0x3ca8a0[_0x4d256b][_0x42c914(0x187)]=_0x3ba088;}),_0x13f68a[_0xf4f8de(0x1dd)]((_0x458807,_0x3aa858)=>{var _0x409f60=_0xf4f8de;_0x3ca8a0[_0x3aa858][_0x409f60(0x1da)]=_0x458807;}),_0x9c1d21[_0xf4f8de(0x1dd)]((_0x5847fe,_0x59fe09)=>{var _0x32b2c4=_0xf4f8de;_0x3ca8a0[_0x59fe09][_0x32b2c4(0x16b)]=_0x5847fe;}),_0x2082af[_0xf4f8de(0x1dd)]((_0x4a37ba,_0x58be29)=>{_0x3ca8a0[_0x58be29]['new_adjust_qty']=_0x4a37ba;}),_0x2276f4[_0xf4f8de(0x1dd)]((_0x43cd62,_0x176001)=>{var _0xa5ce4=_0xf4f8de;_0x3ca8a0[_0x176001][_0xa5ce4(0x191)]=_0x43cd62;}),_0x32e6a0['forEach']((_0x13066d,_0x2724e7)=>{var _0x370723=_0xf4f8de;_0x3ca8a0[_0x2724e7][_0x370723(0x1a4)]=_0x13066d;}),_0x53e4f0[_0xf4f8de(0x1dd)]((_0x98416d,_0x148ce5)=>{_0x3ca8a0[_0x148ce5]['product_code']=_0x98416d;}),_0x96e3d2[_0xf4f8de(0x1dd)]((_0x2c4737,_0x141416)=>{var _0x266756=_0xf4f8de;_0x3ca8a0[_0x141416][_0x266756(0x17d)]=_0x2c4737;}),_0x5d221b[_0xf4f8de(0x1dd)]((_0xbf0314,_0x11a36c)=>{var _0x4f0199=_0xf4f8de;_0x3ca8a0[_0x11a36c][_0x4f0199(0x201)]=_0xbf0314;}),_0x21ac57['forEach']((_0x3d1ef3,_0x237f78)=>{var _0x4511c5=_0xf4f8de;_0x3ca8a0[_0x237f78][_0x4511c5(0x1ed)]=_0x3d1ef3;}),_0x3c67a4[_0xf4f8de(0x1dd)]((_0x4c55d5,_0x5a0da0)=>{_0x3ca8a0[_0x5a0da0]['prod_cat']=_0x4c55d5;}),_0x5e138d[_0xf4f8de(0x1dd)]((_0x201968,_0x490773)=>{var _0x310576=_0xf4f8de;_0x3ca8a0[_0x490773][_0x310576(0x1f0)]=_0x201968;}),_0x27075b['forEach']((_0x433f62,_0xddc843)=>{var _0x4621dd=_0xf4f8de;_0x3ca8a0[_0xddc843][_0x4621dd(0x16f)]=_0x433f62;}),_0x1f7599[_0xf4f8de(0x1dd)]((_0x205c88,_0x50fa25)=>{var _0x4cc4d5=_0xf4f8de;_0x3ca8a0[_0x50fa25][_0x4cc4d5(0x18d)]=_0x205c88;});const _0x355238=_0x3ca8a0[_0xf4f8de(0x200)](_0x2319dd=>_0x2319dd[_0xf4f8de(0x16b)]!=='0'&&_0x2319dd[_0xf4f8de(0x16b)]!=='');var _0x330605=0x0;_0x355238[_0xf4f8de(0x1dd)](_0x5d976c=>{var _0x44f5cd=_0xf4f8de;console[_0x44f5cd(0x194)]('foreach\x20newproduct',_0x5d976c),parseInt(_0x5d976c[_0x44f5cd(0x16b)])<=0x0&&_0x330605++;});if(_0x330605!=0x0)return _0x1c503e['flash'](_0xf4f8de(0x1bb),_0xf4f8de(0x181)),_0x46ec9a[_0xf4f8de(0x1ea)](_0xf4f8de(0x20c));const _0x179b61=new adjustment_logs();await _0x179b61[_0xf4f8de(0x196)]();const _0x53aebb=new adjustment_finished({'warehouse_name':_0x25f9ca,'date':_0x30264f,'product':_0x355238,'note':_0x133ed5,'room':_0x2af9ff,'invoice':_0xf4f8de(0x1b3)+_0x179b61[_0xf4f8de(0x178)][_0xf4f8de(0x175)]()['padStart'](0x8,'0'),'JO_number':_0x1858dd,'expiry_date':_0xb04c97,'type_of_transaction':_0x5791af,'PO_number':_0x62b8c9,'RequestedBy':_0x1444e6,'DateofRequest':_0x9ea86c,'typeservices':_0x3f94aa,'destination':_0x367432,'deliverydate':_0x272700,'driver':_0x1e8efa,'plate':_0x76fe44,'van':_0x573a3e,'DRSI':_0x3d0d27,'typevehicle':_0x55e806,'TSU':_0x5761a2,'TFU':_0x17584c}),_0x213735=await _0x53aebb[_0xf4f8de(0x196)]();_0x1c503e[_0xf4f8de(0x17b)](_0xf4f8de(0x1ce),_0xf4f8de(0x1c9)),_0x46ec9a['redirect'](_0xf4f8de(0x20e)+_0x213735[_0xf4f8de(0x1c7)]);}catch(_0x21625d){console[_0xf4f8de(0x194)](_0x21625d),_0x46ec9a[_0xf4f8de(0x16e)](0xc8)[_0xf4f8de(0x1ad)]({'message':_0x21625d[_0xf4f8de(0x1b5)]});}}),router[a0_0x34df75(0x183)](a0_0x34df75(0x1ab),auth,async(_0x589157,_0x476562)=>{var _0x2a5f95=a0_0x34df75;try{const {username:_0xb9224f,email:_0x332502,role:_0x3f3ac6}=_0x589157[_0x2a5f95(0x19b)],_0x1eed10=_0x589157[_0x2a5f95(0x19b)],_0x4bee44=await profile[_0x2a5f95(0x20f)]({'email':_0x1eed10['email']}),_0x52d556=await master_shop[_0x2a5f95(0x165)](),_0x14756e=_0x589157['params']['id'],_0x40519c=await adjustment_finished['findById']({'_id':_0x14756e}),_0x22d1de=await purchases[_0x2a5f95(0x1ec)]([{'$match':{'warehouse_name':_0x40519c[_0x2a5f95(0x19e)]}},{'$unwind':_0x2a5f95(0x179)},{'$group':{'_id':_0x2a5f95(0x185)}}]);console[_0x2a5f95(0x194)](_0x2a5f95(0x1e0),_0x22d1de);const _0x322f9b=await product[_0x2a5f95(0x165)]({}),_0x128882=await warehouse['aggregate']([{'$match':{'name':_0x40519c['warehouse_name']}},{'$unwind':_0x2a5f95(0x208)},{'$group':{'_id':_0x2a5f95(0x1cb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2a5f95(0x1d4)},'bay':{'$first':_0x2a5f95(0x173)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2a5f95(0x1c3)},'floorlevel':{'$first':_0x2a5f95(0x169)},'primary_code':{'$first':_0x2a5f95(0x193)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2a5f95(0x1e1)},'storage':{'$first':_0x2a5f95(0x18b)},'rack':{'$first':_0x2a5f95(0x1eb)},'expiry_date':{'$first':_0x2a5f95(0x167)},'production_date':{'$first':_0x2a5f95(0x207)},'batch_code':{'$first':_0x2a5f95(0x19c)},'maxPerUnit':{'$first':_0x2a5f95(0x174)},'room':{'$first':_0x2a5f95(0x1fb)}}}]);if(_0x52d556[0x0][_0x2a5f95(0x1ef)]==_0x2a5f95(0x1ca)){var _0x7f13db=users[_0x2a5f95(0x17c)];console['log'](_0x7f13db);}else{if(_0x52d556[0x0][_0x2a5f95(0x1ef)]==_0x2a5f95(0x1d0))var _0x7f13db=users['Hindi'];else{if(_0x52d556[0x0]['language']==_0x2a5f95(0x1ba))var _0x7f13db=users[_0x2a5f95(0x1ba)];else{if(_0x52d556[0x0][_0x2a5f95(0x1ef)]==_0x2a5f95(0x1a9))var _0x7f13db=users[_0x2a5f95(0x1a9)];else{if(_0x52d556[0x0][_0x2a5f95(0x1ef)]==_0x2a5f95(0x1ac))var _0x7f13db=users['French'];else{if(_0x52d556[0x0]['language']=='Portuguese\x20(BR)')var _0x7f13db=users[_0x2a5f95(0x190)];else{if(_0x52d556[0x0][_0x2a5f95(0x1ef)]==_0x2a5f95(0x206))var _0x7f13db=users['Chinese'];else{if(_0x52d556[0x0][_0x2a5f95(0x1ef)]==_0x2a5f95(0x161))var _0x7f13db=users['Arabic'];}}}}}}}_0x476562[_0x2a5f95(0x17e)]('edit_adjustment_finished_view',{'success':_0x589157['flash'](_0x2a5f95(0x1ce)),'errors':_0x589157[_0x2a5f95(0x17b)](_0x2a5f95(0x1bb)),'role':_0x1eed10,'profile':_0x4bee44,'adjustment':_0x40519c,'stock':_0x128882,'master_shop':_0x52d556,'warehouse_name':_0x22d1de,'unit':_0x322f9b,'language':_0x7f13db});}catch(_0x157065){console[_0x2a5f95(0x194)](_0x157065),_0x476562[_0x2a5f95(0x16e)](0xc8)[_0x2a5f95(0x1ad)]({'message':_0x157065['message']});}}),router[a0_0x34df75(0x1a3)](a0_0x34df75(0x1ab),auth,async(_0xc47ac0,_0x34a1f2)=>{var _0x5495d9=a0_0x34df75;try{const {invoice:_0x272c12,warehouse_name:_0x190778,Room_name:_0x517d7c}=_0xc47ac0[_0x5495d9(0x1a5)],_0x1e6d34=_0xc47ac0[_0x5495d9(0x20a)]['id'],_0x5f041e=await adjustment_finished[_0x5495d9(0x1e3)]({'_id':_0x1e6d34});var _0xa7641e;const _0x2b2ae4=_0x5f041e[_0x5495d9(0x1c2)]['map'](async _0x4c1c35=>{var _0x30cfea=_0x5495d9;if(_0x4c1c35[_0x30cfea(0x16b)]>0x0){_0xa7641e=await warehouse['findOne']({'name':_0x190778,'room':_0x4c1c35[_0x30cfea(0x1f0)]});const _0x56dfbf=_0xa7641e[_0x30cfea(0x204)][_0x30cfea(0x1d6)](_0x30cc00=>{var _0x3d4b98=_0x30cfea;console[_0x3d4b98(0x194)](_0x4c1c35['types']);if(_0x4c1c35['types']=='minus')_0x30cc00[_0x3d4b98(0x1c7)]==_0x4c1c35[_0x3d4b98(0x1d7)]&&(_0x30cc00[_0x3d4b98(0x1db)]=_0x30cc00['product_stock']-_0x4c1c35['adjust_qty']);else _0x4c1c35['types']=='add'&&(_0x30cc00['_id']==_0x4c1c35['id_transaction']&&(_0x30cc00[_0x3d4b98(0x1db)]=_0x30cc00[_0x3d4b98(0x1db)]+_0x4c1c35['adjust_qty']));});}return _0xa7641e;});Promise[_0x5495d9(0x1e2)](_0x2b2ae4)[_0x5495d9(0x172)](async _0x3343a4=>{var _0x429c00=_0x5495d9;try{for(const _0x6e10d8 of _0x3343a4){await _0x6e10d8[_0x429c00(0x196)]();}_0x5f041e[_0x429c00(0x1b4)]=_0x429c00(0x18a);const _0x3e253d=await _0x5f041e[_0x429c00(0x196)](),_0x59305a=await master_shop[_0x429c00(0x165)](),_0x58ab8b=await email_settings[_0x429c00(0x20f)](),_0x136a8d=await supervisor_settings['find']();var _0x27fbe8=_0x5f041e[_0x429c00(0x1c2)],_0x4a0c08='',_0x1a6c54;for(_0x1a6c54 in _0x27fbe8){var _0xcfbf32='FG';_0x5f041e[_0x429c00(0x19e)]==_0x429c00(0x1fa)&&(_0xcfbf32='DG'),_0x4a0c08+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x27fbe8[_0x1a6c54][_0x429c00(0x195)]+_0x429c00(0x1e9)+_0x429c00(0x184)+_0x27fbe8[_0x1a6c54]['product_code']+_0x429c00(0x1e9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x27fbe8[_0x1a6c54][_0x429c00(0x16b)]+_0x429c00(0x1e9)+_0x429c00(0x184)+_0x27fbe8[_0x1a6c54][_0x429c00(0x191)]+_0x429c00(0x1e9)+_0x429c00(0x184)+_0x27fbe8[_0x1a6c54]['secondary_unit']+_0x429c00(0x1e9)+_0x429c00(0x184)+_0x5f041e['warehouse_name']+_0x429c00(0x1e9)+_0x429c00(0x184)+_0x27fbe8[_0x1a6c54][_0x429c00(0x1f0)]+'</td>'+_0x429c00(0x184)+_0xcfbf32+_0x27fbe8[_0x1a6c54]['bay']+'</td>'+_0x429c00(0x1b8);}_0xc47ac0['flash']('success',_0x429c00(0x180)),_0x34a1f2[_0x429c00(0x1ea)]('/picking_list/PDF_adjustmentFinal/'+_0x3e253d[_0x429c00(0x1c7)]);}catch(_0x822c92){console[_0x429c00(0x199)](_0x822c92),_0x34a1f2[_0x429c00(0x16e)](0x1f4)[_0x429c00(0x1ad)]({'error':_0x429c00(0x18c)});}})[_0x5495d9(0x1f4)](_0x12fa0c=>{var _0x51d7c2=_0x5495d9;console[_0x51d7c2(0x199)](_0x12fa0c),_0x34a1f2[_0x51d7c2(0x16e)](0x1f4)[_0x51d7c2(0x1ad)]({'error':_0x51d7c2(0x1e4)});});}catch(_0xb170ec){_0x34a1f2[_0x5495d9(0x1ad)]({'message':_0xb170ec[_0x5495d9(0x1b5)]});}}),router[a0_0x34df75(0x183)]('/view/:id',auth,async(_0x434e6e,_0x4e1ee1)=>{var _0x3c1616=a0_0x34df75;try{const {username:_0x53e7d5,email:_0x169c25,role:_0x2a0eb6}=_0x434e6e['user'],_0x3ed4e8=_0x434e6e[_0x3c1616(0x19b)],_0x661349=await profile[_0x3c1616(0x20f)]({'email':_0x3ed4e8[_0x3c1616(0x188)]}),_0x5ebf8e=await master_shop[_0x3c1616(0x165)]();console[_0x3c1616(0x194)](_0x3c1616(0x1bf),_0x5ebf8e);const _0x1b686e=_0x434e6e[_0x3c1616(0x20a)]['id'],_0x4f9fc7=await adjustment_finished[_0x3c1616(0x1e3)]({'_id':_0x1b686e});let _0x3ae252=new Date(_0x4f9fc7[_0x3c1616(0x201)]),_0x5c4366=('0'+_0x3ae252[_0x3c1616(0x1be)]())[_0x3c1616(0x1b6)](-0x2),_0x1508ab=('0'+(_0x3ae252[_0x3c1616(0x1cd)]()+0x1))[_0x3c1616(0x1b6)](-0x2),_0x5eba07=_0x3ae252['getFullYear'](),_0x56d51f=_0x5eba07+'-'+_0x1508ab+'-'+_0x5c4366;var _0xa8a02c=[_0x3c1616(0x1c1),_0x3c1616(0x18e),_0x3c1616(0x1ae)];const _0x2d67f4=await purchases[_0x3c1616(0x1ec)]([{'$match':{'warehouse_name':_0x4f9fc7[_0x3c1616(0x19e)]}},{'$unwind':_0x3c1616(0x179)},{'$group':{'_id':_0x3c1616(0x185)}}]);console[_0x3c1616(0x194)](_0x3c1616(0x1e0),_0x2d67f4);const _0x428af3=await product[_0x3c1616(0x165)]({}),_0x397781=await warehouse[_0x3c1616(0x1ec)]([{'$match':{'name':_0x4f9fc7['warehouse_name'],'room':_0x4f9fc7['room']}},{'$unwind':_0x3c1616(0x208)},{'$group':{'_id':_0x3c1616(0x1cb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c1616(0x1d4)},'bay':{'$first':_0x3c1616(0x173)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3c1616(0x1c3)},'floorlevel':{'$first':_0x3c1616(0x169)},'primary_code':{'$first':_0x3c1616(0x193)},'secondary_code':{'$first':_0x3c1616(0x162)},'product_code':{'$first':_0x3c1616(0x1e1)},'storage':{'$first':_0x3c1616(0x18b)},'rack':{'$first':_0x3c1616(0x1eb)}}}]);if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x1ca)){var _0x40d4ae=users['English'];console[_0x3c1616(0x194)](_0x40d4ae);}else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x1d0))var _0x40d4ae=users[_0x3c1616(0x1d0)];else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x1ba))var _0x40d4ae=users[_0x3c1616(0x1ba)];else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x1a9))var _0x40d4ae=users[_0x3c1616(0x1a9)];else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x1ac))var _0x40d4ae=users[_0x3c1616(0x1ac)];else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x1b2))var _0x40d4ae=users[_0x3c1616(0x190)];else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]=='Chinese')var _0x40d4ae=users['Chinese'];else{if(_0x5ebf8e[0x0][_0x3c1616(0x1ef)]==_0x3c1616(0x161))var _0x40d4ae=users['Arabic'];}}}}}}}_0x4e1ee1[_0x3c1616(0x17e)](_0x3c1616(0x189),{'success':_0x434e6e['flash'](_0x3c1616(0x1ce)),'errors':_0x434e6e[_0x3c1616(0x17b)](_0x3c1616(0x1bb)),'role':_0x3ed4e8,'profile':_0x661349,'adjustment':_0x4f9fc7,'stock':_0x397781,'master_shop':_0x5ebf8e,'warehouse_name':_0x2d67f4,'unit':_0x428af3,'language':_0x40d4ae,'rooms_data':_0xa8a02c,'ed_fullDate':_0x56d51f});}catch(_0xb330dd){console[_0x3c1616(0x194)](_0xb330dd),_0x4e1ee1[_0x3c1616(0x16e)](0xc8)[_0x3c1616(0x1ad)]({'message':_0xb330dd[_0x3c1616(0x1b5)]});}}),router[a0_0x34df75(0x1a3)](a0_0x34df75(0x1e7),auth,async(_0x25b35e,_0x15c7b7)=>{var _0xc5746c=a0_0x34df75;try{const _0x3ce8fa=_0x25b35e['params']['id'],_0xe18b62=await adjustment_finished['findById']({'_id':_0x3ce8fa}),_0x12b0a6=await warehouse['findOne']({'name':_0xe18b62[_0xc5746c(0x19e)],'room':_0xe18b62['room']}),{warehouse_name:_0x459d80,date:_0x48ae55,prod_name:_0xb1ac78,level:_0x5a63d4,isle:_0x54f000,pallet:_0x42fe0d,stock:_0x3d83e,types:_0x452bdc,adjust_qty:_0x2f1640,new_adjust_qty:_0x1ec905,note:_0x424253,Room_name:_0x502ad1,invoice:_0x4f682c,JO_number:_0x5220f2}=_0x25b35e['body'];if(typeof _0xb1ac78=='string')var _0x33bc7c=[_0x25b35e['body'][_0xc5746c(0x20b)]],_0x2c39ea=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x1e5)]],_0x10c0f1=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x19d)]],_0x38eae8=[_0x25b35e[_0xc5746c(0x1a5)]['types']],_0x5855ce=[_0x25b35e['body'][_0xc5746c(0x16b)]],_0x126936=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x1fc)]],_0x29a3ad=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x177)]],_0x5d92c8=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x191)]],_0x1f06ad=[_0x25b35e[_0xc5746c(0x1a5)]['Secondary_units']],_0x4970f3=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x17d)]],_0x4bb272=[_0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x201)]];else var _0x33bc7c=[..._0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x20b)]],_0x2c39ea=[..._0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x1e5)]],_0x10c0f1=[..._0x25b35e[_0xc5746c(0x1a5)]['stock']],_0x38eae8=[..._0x25b35e['body']['types']],_0x5855ce=[..._0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x16b)]],_0x126936=[..._0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x1fc)]],_0x29a3ad=[..._0x25b35e['body'][_0xc5746c(0x177)]],_0x5d92c8=[..._0x25b35e['body'][_0xc5746c(0x191)]],_0x1f06ad=[..._0x25b35e['body'][_0xc5746c(0x1f2)]],_0x4970f3=[..._0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x17d)]],_0x4bb272=[..._0x25b35e[_0xc5746c(0x1a5)][_0xc5746c(0x201)]];const _0x25c026=_0x33bc7c[_0xc5746c(0x1d6)](_0x251727=>{return _0x251727={'product_name':_0x251727};});_0x2c39ea['forEach']((_0x4e0340,_0x10ca5e)=>{_0x25c026[_0x10ca5e]['bay']=_0x4e0340;}),_0x10c0f1[_0xc5746c(0x1dd)]((_0x4cb337,_0x41faba)=>{var _0x105362=_0xc5746c;_0x25c026[_0x41faba][_0x105362(0x187)]=_0x4cb337;}),_0x38eae8[_0xc5746c(0x1dd)]((_0x3b42f3,_0x1b25e7)=>{_0x25c026[_0x1b25e7]['types']=_0x3b42f3;}),_0x5855ce['forEach']((_0x1041be,_0xb63479)=>{var _0x1770bd=_0xc5746c;_0x25c026[_0xb63479][_0x1770bd(0x16b)]=_0x1041be;}),_0x126936[_0xc5746c(0x1dd)]((_0x2aa36f,_0x3b70fc)=>{_0x25c026[_0x3b70fc]['new_adjust_qty']=_0x2aa36f;}),_0x5d92c8['forEach']((_0x2ccaee,_0x5c66e2)=>{_0x25c026[_0x5c66e2]['unit']=_0x2ccaee;}),_0x1f06ad['forEach']((_0x45b39e,_0x29d86b)=>{var _0x268518=_0xc5746c;_0x25c026[_0x29d86b][_0x268518(0x1a4)]=_0x45b39e;}),_0x29a3ad['forEach']((_0x5a9ee4,_0x526554)=>{var _0x3fa8c9=_0xc5746c;_0x25c026[_0x526554][_0x3fa8c9(0x1f7)]=_0x5a9ee4;}),_0x4970f3[_0xc5746c(0x1dd)]((_0x3bc54b,_0x4f786f)=>{_0x25c026[_0x4f786f]['batch_code']=_0x3bc54b;}),_0x4bb272[_0xc5746c(0x1dd)]((_0x2a30c3,_0x566c46)=>{var _0x49852b=_0xc5746c;_0x25c026[_0x566c46][_0x49852b(0x201)]=_0x2a30c3;});const _0x253db1=_0x25c026[_0xc5746c(0x200)](_0x2d4eed=>_0x2d4eed[_0xc5746c(0x16b)]!=='0'&&_0x2d4eed[_0xc5746c(0x16b)]!=='');var _0xf8626a=0x0;_0x253db1[_0xc5746c(0x1dd)](_0x4d899c=>{var _0x544d4a=_0xc5746c;console['log'](_0x544d4a(0x19a),_0x4d899c),parseInt(_0x4d899c['adjust_qty'])<=0x0&&_0xf8626a++;});if(_0xf8626a!=0x0)return _0x25b35e[_0xc5746c(0x17b)](_0xc5746c(0x1bb),_0xc5746c(0x181)),_0x15c7b7['redirect']('back');_0xe18b62['warehouse_name']=_0x459d80,_0xe18b62[_0xc5746c(0x1f5)]=_0x48ae55,_0xe18b62[_0xc5746c(0x1c2)]=_0x253db1,_0xe18b62['note']=_0x424253,_0xe18b62[_0xc5746c(0x182)]=_0x502ad1,_0xe18b62[_0xc5746c(0x18d)]=_0x4f682c,_0xe18b62[_0xc5746c(0x198)]=_0x5220f2;const _0x1f5ec7=await _0xe18b62[_0xc5746c(0x196)](),_0x4d75b5=await warehouse['findOne']({'name':_0x459d80,'room':_0x502ad1});_0x1f5ec7['product']['forEach'](_0x1d7def=>{var _0x5bc58d=_0xc5746c;const _0x7dc3ea=_0x4d75b5[_0x5bc58d(0x204)][_0x5bc58d(0x1d6)](_0x34a675=>{var _0x1c6bb4=_0x5bc58d;_0x1d7def[_0x1c6bb4(0x1da)]=='minus'?_0x34a675[_0x1c6bb4(0x195)]==_0x1d7def[_0x1c6bb4(0x195)]&&_0x34a675[_0x1c6bb4(0x171)]==_0x1d7def[_0x1c6bb4(0x171)]&&(_0x34a675['product_stock']=parseInt(_0x34a675['product_stock'])-parseInt(_0x1d7def[_0x1c6bb4(0x16b)])):_0x34a675['product_name']==_0x1d7def[_0x1c6bb4(0x195)]&&_0x34a675[_0x1c6bb4(0x171)]==_0x1d7def['bay']&&(_0x34a675[_0x1c6bb4(0x1db)]=parseInt(_0x34a675['product_stock'])+parseInt(_0x1d7def['adjust_qty']));});}),await _0x4d75b5[_0xc5746c(0x196)](),_0x25b35e[_0xc5746c(0x17b)](_0xc5746c(0x1ce),_0xc5746c(0x1aa)),_0x15c7b7['redirect'](_0xc5746c(0x192));}catch(_0x26669d){console[_0xc5746c(0x194)](_0x26669d);}}),router[a0_0x34df75(0x1a3)]('/barcode_scanner',async(_0x5249a8,_0xac5a6c)=>{var _0x49584d=a0_0x34df75;const {primary_code:_0x38f40e,warehouse_data:_0x2187f1,rooms_data:_0x3a595d,Roomslist:_0x326e51}=_0x5249a8['body'],_0x1bbc3a=_0x326e51[_0x49584d(0x1a1)](','),_0x84d0dc=[];async function _0x1b249c(_0x217b1f){var _0x5a904b=_0x49584d;const _0x5759e5=await warehouse[_0x5a904b(0x1ec)]([{'$match':{'name':_0x2187f1,'room':_0x217b1f}},{'$unwind':_0x5a904b(0x208)},{'$match':{'product_details.primary_code':_0x38f40e}},{'$group':{'_id':_0x5a904b(0x1cb),'name':{'$first':_0x5a904b(0x202)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x5a904b(0x193)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5a904b(0x1e1)},'level':{'$first':_0x5a904b(0x1f8)},'bay':{'$first':_0x5a904b(0x173)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x5a904b(0x169)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5a904b(0x1eb)},'expiry_date':{'$first':_0x5a904b(0x167)},'production_date':{'$first':_0x5a904b(0x207)},'batch_code':{'$first':_0x5a904b(0x19c)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x5a904b(0x174)},'roomNamed':{'$first':_0x5a904b(0x1fb)},'invoice':{'$first':_0x5a904b(0x1b1)}}}]),_0x250522=await warehouse[_0x5a904b(0x1ec)]([{'$match':{'name':_0x2187f1,'room':_0x217b1f}},{'$unwind':_0x5a904b(0x208)},{'$match':{'product_details.secondary_code':_0x38f40e}},{'$group':{'_id':_0x5a904b(0x1cb),'name':{'$first':_0x5a904b(0x202)},'product_stock':{'$first':_0x5a904b(0x1d4)},'primary_code':{'$first':_0x5a904b(0x193)},'secondary_code':{'$first':_0x5a904b(0x162)},'product_code':{'$first':_0x5a904b(0x1e1)},'level':{'$first':_0x5a904b(0x1f8)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x5a904b(0x1c3)},'pallet':{'$first':_0x5a904b(0x169)},'unit':{'$first':_0x5a904b(0x17a)},'secondary_unit':{'$first':_0x5a904b(0x1c5)},'storage':{'$first':_0x5a904b(0x18b)},'rack':{'$first':_0x5a904b(0x1eb)},'expiry_date':{'$first':_0x5a904b(0x167)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x5a904b(0x19c)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5a904b(0x174)},'roomNamed':{'$first':_0x5a904b(0x1fb)},'invoice':{'$first':_0x5a904b(0x1b1)}}}]);if(_0x5759e5[_0x5a904b(0x17f)]>0x0)_0x84d0dc['push'](_0x5759e5);else _0x250522['length']>0x0&&_0x84d0dc[_0x5a904b(0x1c6)](_0x250522);}const _0x17efa4=_0x1bbc3a[_0x49584d(0x1d6)](_0x2a0910=>_0x1b249c(_0x2a0910));await Promise['all'](_0x17efa4),_0xac5a6c[_0x49584d(0x1ad)](_0x84d0dc);}),router[a0_0x34df75(0x1a3)](a0_0x34df75(0x1f9),async(_0x2e620c,_0x29f4c4)=>{var _0x824e55=a0_0x34df75;const {productCode:_0x4f2124,bay:_0x5c442d,warehouses:_0x16deab,room:_0x506296}=_0x2e620c['body'];console['log'](_0x2e620c[_0x824e55(0x1a5)]);try{const _0x1c0f8f=await warehouse[_0x824e55(0x1ec)]([{'$match':{'name':_0x16deab,'room':_0x506296}},{'$unwind':_0x824e55(0x208)},{'$match':{'product_details.bay':parseInt(_0x5c442d)}},{'$group':{'_id':_0x824e55(0x1cb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x824e55(0x1d4)},'bay':{'$first':_0x824e55(0x173)},'maxProducts':{'$first':_0x824e55(0x1e6)}}}]);_0x29f4c4['status'](0xc8)[_0x824e55(0x1ad)](_0x1c0f8f);}catch(_0x2477b1){_0x29f4c4['status'](0x194)[_0x824e55(0x1ad)]({'message':_0x2477b1['message']});}}),module['exports']=router;