var a0_0x27e0ed=a0_0x56e3;function a0_0x5dca(){var _0x38ee01=['There\x27s\x20a\x20error\x20in\x20this\x20transaction','stockBefore','post','Rooms','getFullYear','English','LOG-ADJ-','exports','new_adjust_qty','/adjustment/view','flash','secondary_unit','Return\x20Rooms','own','3700755GnXDLG','stock','2196348iUbios','staff','express','master','$product_details.rack','English\x20(US)','prod_cat','id_transaction_from','json','$product_details.storage','push','ADJ-','then','/preview/:id','36RtTRDi','New_Qty_Converted','/barcode_scanner','4140504xvqosS','$date','/adjustment_finished/view','$product_details.unit','Chinese','logs','product_stock','$product_details.production_date','$finalize','New_Qty_Converted_adj','$product_details.product_name','An\x20error\x20occurred\x20while\x20saving\x20data.','<tr>','ADJF-','$product.product_name','back','match','invoice_init','French','3ceeSuk','foreach\x20newproduct','adjustment_finished_logs','error','Ambient','$product_details.type','/adjustment_finished/preview/','edit_adjustment_finished','German','Spanish','params','product_details','6781072mshDGe','room','all','warehouse_name','$product_details.level','True','add_adjustment_finished','edit_adjustment_finished_view','id_transaction','Portuguese','Primary_Units','1313908xgJDEj','/view_logs','production_date','level','filter','save','message','$product.room_names','/view/add_adjustment','product_code','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','adjustment\x20add\x20successfull','$product_details.bin','padStart','Portuguese\x20(BR)','prod_code','prod_name','render','redirect','maxPerUnit','language','9408161uNdWKI','_id','warehouse','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_invoice','Arabic\x20(ae)','Hindi','types','role','Enabled','Router','purchases_data','findOne','Enclosed','JO_number','../public/language/languages.json','length','$product_details.floorlevel','find','batch_code','$product_details','catch','$product','log','product_name','/view/:id','forEach','$product_details.secondary_code','/view','$_id','errors','/picking_list/PDF_adjustmentFinal/','split','aggregate','$product_details.product_stock','expiry_date','status','/CheckingWarehouse','$product_details._id','slice','/view/add_adjustment_logs','</td>','$product_details.primary_code','$product_details.maxPerUnit','product','toString','$product_details.product_code','$product_details.secondary_unit','string','$name','nodemailer','$invoice','body','$room','email','$product_details.invoice','date','Secondary_units','$product_details.bay','../middleware/auth','get','finalize','Adjustment\x20Finalize\x20Successfully','minus','random','1356520SpYEnd','$product_details.batch_code','$warehouse_name','floor','success','map','bay','$product_details.expiry_date','unit','user','findById','DRY\x20GOODS','</tr>','room_names','Arabic','invoice','product_date','adjust_qty','../models/all_models','add'];a0_0x5dca=function(){return _0x38ee01;};return a0_0x5dca();}(function(_0x4c3617,_0x1d21a8){var _0x594133=a0_0x56e3,_0x47cb84=_0x4c3617();while(!![]){try{var _0x2c4e95=-parseInt(_0x594133(0xe6))/0x1+parseInt(_0x594133(0xab))/0x2+-parseInt(_0x594133(0xcf))/0x3*(-parseInt(_0x594133(0x87))/0x4)+-parseInt(_0x594133(0xa9))/0x5+-parseInt(_0x594133(0xbc))/0x6+-parseInt(_0x594133(0xfb))/0x7+parseInt(_0x594133(0xdb))/0x8*(parseInt(_0x594133(0xb9))/0x9);if(_0x2c4e95===_0x1d21a8)break;else _0x47cb84['push'](_0x47cb84['shift']());}catch(_0x551bfe){_0x47cb84['push'](_0x47cb84['shift']());}}}(a0_0x5dca,0xb495a));const express=require(a0_0x27e0ed(0xad)),app=express(),router=express[a0_0x27e0ed(0x105)](),auth=require(a0_0x27e0ed(0x81)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x27e0ed(0x99)),users=require(a0_0x27e0ed(0x10a)),nodemailer=require(a0_0x27e0ed(0x78));router['get'](a0_0x27e0ed(0x117),auth,async(_0x1a3281,_0x32a12d)=>{var _0x4d8aeb=a0_0x27e0ed;try{const {username:_0x4c2a23,email:_0x130e06,role:_0x51d15e}=_0x1a3281[_0x4d8aeb(0x90)],_0x115470=_0x1a3281[_0x4d8aeb(0x90)],_0x3f85e9=await profile['findOne']({'email':_0x115470['email']}),_0xc80d0d=await master_shop[_0x4d8aeb(0x10d)]();let _0x36b80d;if(_0x115470['role']==_0x4d8aeb(0xac)){const _0x370523=await staff[_0x4d8aeb(0x107)]({'email':_0x115470['email']});_0x36b80d=await warehouse[_0x4d8aeb(0x10d)]({'status':_0x4d8aeb(0x104),'name':_0x370523['warehouse']});}else _0x36b80d=await warehouse[_0x4d8aeb(0x10d)]({'status':_0x4d8aeb(0x104)});const _0x49e37f=await product[_0x4d8aeb(0x10d)]();let _0x5f2296;if(_0x115470[_0x4d8aeb(0x103)]==_0x4d8aeb(0xac)){const _0x475259=await staff[_0x4d8aeb(0x107)]({'email':_0x115470[_0x4d8aeb(0x7c)]});_0x5f2296=await adjustment_finished[_0x4d8aeb(0x10d)]({'warehouse_name':_0x475259['warehouse']});}else _0x5f2296=await adjustment_finished[_0x4d8aeb(0x67)]([{'$match':{'type_of_transaction':_0x4d8aeb(0xa8)}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x4d8aeb(0x79)},'date':{'$first':_0x4d8aeb(0xbd)},'warehouse_name':{'$first':_0x4d8aeb(0x89)},'room':{'$addToSet':_0x4d8aeb(0xed)},'finalize':{'$first':_0x4d8aeb(0xc4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xc80d0d[0x0]['language']==_0x4d8aeb(0xb0)){var _0x5df6e3=users[_0x4d8aeb(0xa0)];console[_0x4d8aeb(0x112)](_0x5df6e3);}else{if(_0xc80d0d[0x0][_0x4d8aeb(0xfa)]==_0x4d8aeb(0x101))var _0x5df6e3=users[_0x4d8aeb(0x101)];else{if(_0xc80d0d[0x0][_0x4d8aeb(0xfa)]==_0x4d8aeb(0xd7))var _0x5df6e3=users[_0x4d8aeb(0xd7)];else{if(_0xc80d0d[0x0][_0x4d8aeb(0xfa)]==_0x4d8aeb(0xd8))var _0x5df6e3=users[_0x4d8aeb(0xd8)];else{if(_0xc80d0d[0x0][_0x4d8aeb(0xfa)]==_0x4d8aeb(0xce))var _0x5df6e3=users[_0x4d8aeb(0xce)];else{if(_0xc80d0d[0x0][_0x4d8aeb(0xfa)]=='Portuguese\x20(BR)')var _0x5df6e3=users['Portuguese'];else{if(_0xc80d0d[0x0][_0x4d8aeb(0xfa)]==_0x4d8aeb(0xc0))var _0x5df6e3=users['Chinese'];else{if(_0xc80d0d[0x0]['language']==_0x4d8aeb(0x100))var _0x5df6e3=users[_0x4d8aeb(0x95)];}}}}}}}_0x32a12d[_0x4d8aeb(0xf7)]('adjustment_finished',{'success':_0x1a3281[_0x4d8aeb(0xa5)](_0x4d8aeb(0x8b)),'errors':_0x1a3281[_0x4d8aeb(0xa5)]('errors'),'role':_0x115470,'profile':_0x3f85e9,'warehouse':_0x36b80d,'product':_0x49e37f,'adjustment':_0x5f2296,'master_shop':_0xc80d0d,'language':_0x5df6e3});}catch(_0x2319df){console[_0x4d8aeb(0x112)](_0x2319df);}}),router['get'](a0_0x27e0ed(0xe7),auth,async(_0x12722c,_0x71c265)=>{var _0x38728a=a0_0x27e0ed;try{const {username:_0x1f04d5,email:_0x44e660,role:_0x27b63d}=_0x12722c[_0x38728a(0x90)],_0x2626b0=_0x12722c['user'],_0x81734=await profile[_0x38728a(0x107)]({'email':_0x2626b0['email']}),_0x223a37=await master_shop[_0x38728a(0x10d)]();let _0x22008a;if(_0x2626b0[_0x38728a(0x103)]==_0x38728a(0xac)){const _0x18cbed=await staff['findOne']({'email':_0x2626b0['email']});_0x22008a=await warehouse[_0x38728a(0x10d)]({'status':'Enabled','name':_0x18cbed[_0x38728a(0xfd)]});}else _0x22008a=await warehouse['find']({'status':_0x38728a(0x104)});const _0x5ec1af=await product[_0x38728a(0x10d)]();let _0x5a3018;if(_0x2626b0['role']==_0x38728a(0xac)){const _0x4fea1b=await staff[_0x38728a(0x107)]({'email':_0x2626b0['email']});_0x5a3018=await adjustment_finished[_0x38728a(0x10d)]({'warehouse_name':_0x4fea1b['warehouse']});}else _0x5a3018=await adjustment_finished[_0x38728a(0x67)]([{'$match':{'type_of_transaction':_0x38728a(0xc1)}},{'$unwind':_0x38728a(0x111)},{'$group':{'_id':_0x38728a(0x118),'invoice':{'$first':'$invoice'},'date':{'$first':_0x38728a(0xbd)},'warehouse_name':{'$first':_0x38728a(0x89)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x38728a(0xc4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x223a37[0x0][_0x38728a(0xfa)]==_0x38728a(0xb0))var _0x47ad9a=users[_0x38728a(0xa0)];else{if(_0x223a37[0x0]['language']=='Hindi')var _0x47ad9a=users[_0x38728a(0x101)];else{if(_0x223a37[0x0][_0x38728a(0xfa)]==_0x38728a(0xd7))var _0x47ad9a=users[_0x38728a(0xd7)];else{if(_0x223a37[0x0][_0x38728a(0xfa)]==_0x38728a(0xd8))var _0x47ad9a=users[_0x38728a(0xd8)];else{if(_0x223a37[0x0][_0x38728a(0xfa)]=='French')var _0x47ad9a=users[_0x38728a(0xce)];else{if(_0x223a37[0x0]['language']==_0x38728a(0xf4))var _0x47ad9a=users[_0x38728a(0xe4)];else{if(_0x223a37[0x0]['language']==_0x38728a(0xc0))var _0x47ad9a=users[_0x38728a(0xc0)];else{if(_0x223a37[0x0][_0x38728a(0xfa)]==_0x38728a(0x100))var _0x47ad9a=users[_0x38728a(0x95)];}}}}}}}_0x71c265[_0x38728a(0xf7)](_0x38728a(0xd1),{'success':_0x12722c[_0x38728a(0xa5)](_0x38728a(0x8b)),'errors':_0x12722c[_0x38728a(0xa5)](_0x38728a(0x64)),'role':_0x2626b0,'profile':_0x81734,'warehouse':_0x22008a,'product':_0x5ec1af,'adjustment':_0x5a3018,'master_shop':_0x223a37,'language':_0x47ad9a});}catch(_0x5bfd32){console[_0x38728a(0x112)](_0x5bfd32);}});async function getRandom8DigitNumber(){var _0x5af7f3=a0_0x27e0ed;const _0xeb96e5=0x989680,_0x18fac3=0x5f5e0ff,_0x216b43=Math[_0x5af7f3(0x8a)](Math[_0x5af7f3(0x86)]()*(_0x18fac3-_0xeb96e5+0x1))+_0xeb96e5;var _0x3e7ae5;const _0x5484a6=await adjustment_finished[_0x5af7f3(0x107)]({'invoice':_0x5af7f3(0xc9)+_0x216b43});return _0x5484a6&&_0x5484a6[_0x5af7f3(0x10b)]>0x0?_0x3e7ae5=_0x5af7f3(0xc9)+_0x216b43:_0x3e7ae5=_0x5af7f3(0xc9)+_0x216b43,_0x3e7ae5;}function a0_0x56e3(_0x59535a,_0x27eddd){var _0x5dcaa7=a0_0x5dca();return a0_0x56e3=function(_0x56e3bb,_0x5e9bc2){_0x56e3bb=_0x56e3bb-0x64;var _0xfd189e=_0x5dcaa7[_0x56e3bb];return _0xfd189e;},a0_0x56e3(_0x59535a,_0x27eddd);}router['get']('/view/add_adjustment',auth,async(_0x12bcf1,_0x3e4741)=>{var _0x427e2a=a0_0x27e0ed;try{const {username:_0x326ac8,email:_0x1439a0,role:_0x5eb2f8}=_0x12bcf1['user'],_0x4d7e8d=_0x12bcf1[_0x427e2a(0x90)],_0xf332a7=await profile['findOne']({'email':_0x4d7e8d[_0x427e2a(0x7c)]}),_0x320b55=await master_shop[_0x427e2a(0x10d)]();let _0x52a3f5;if(_0x4d7e8d[_0x427e2a(0x103)]=='staff'){const _0x291569=await staff['findOne']({'email':_0x4d7e8d[_0x427e2a(0x7c)]});_0x52a3f5=await warehouse[_0x427e2a(0x67)]([{'$match':{'status':_0x427e2a(0x104),'name':_0x291569['warehouse']}},{'$group':{'_id':_0x427e2a(0x77),'name':{'$first':_0x427e2a(0x77)}}}]);}else _0x52a3f5=await warehouse['aggregate']([{'$match':{'status':_0x427e2a(0x104)}},{'$group':{'_id':_0x427e2a(0x77),'name':{'$first':_0x427e2a(0x77)}}}]);const _0x12d902=await product[_0x427e2a(0x10d)]({}),_0x50d375=await adjustment_finished[_0x427e2a(0x10d)](),_0x261598=_0x50d375['length']+0x1,_0x46c280=_0x427e2a(0xc9)+_0x261598[_0x427e2a(0x73)]()['padStart'](0x5,'0');var _0x5121b2=[_0x427e2a(0xd3),_0x427e2a(0x108),'Return\x20Rooms'];if(_0x320b55[0x0]['language']==_0x427e2a(0xb0))var _0x3f2b97=users[_0x427e2a(0xa0)];else{if(_0x320b55[0x0]['language']==_0x427e2a(0x101))var _0x3f2b97=users[_0x427e2a(0x101)];else{if(_0x320b55[0x0][_0x427e2a(0xfa)]==_0x427e2a(0xd7))var _0x3f2b97=users['German'];else{if(_0x320b55[0x0]['language']=='Spanish')var _0x3f2b97=users[_0x427e2a(0xd8)];else{if(_0x320b55[0x0][_0x427e2a(0xfa)]=='French')var _0x3f2b97=users[_0x427e2a(0xce)];else{if(_0x320b55[0x0][_0x427e2a(0xfa)]==_0x427e2a(0xf4))var _0x3f2b97=users[_0x427e2a(0xe4)];else{if(_0x320b55[0x0][_0x427e2a(0xfa)]==_0x427e2a(0xc0))var _0x3f2b97=users['Chinese'];else{if(_0x320b55[0x0][_0x427e2a(0xfa)]==_0x427e2a(0x100))var _0x3f2b97=users[_0x427e2a(0x95)];}}}}}}}const _0x23db95=getRandom8DigitNumber();_0x23db95[_0x427e2a(0xb7)](_0x5d26f5=>{var _0x287638=_0x427e2a;_0x3e4741[_0x287638(0xf7)](_0x287638(0xe1),{'success':_0x12bcf1[_0x287638(0xa5)](_0x287638(0x8b)),'errors':_0x12bcf1[_0x287638(0xa5)](_0x287638(0x64)),'role':_0x4d7e8d,'profile':_0xf332a7,'warehouse':_0x52a3f5,'product':_0x12d902,'master_shop':_0x320b55,'language':_0x3f2b97,'rooms_data':_0x5121b2,'invoice_no':_0x5d26f5});})['catch'](_0x5549e9=>{var _0x2c5617=_0x427e2a;_0x12bcf1[_0x2c5617(0xa5)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3e4741[_0x2c5617(0xf8)]('/adjustment/view');});}catch(_0x1ac518){console[_0x427e2a(0x112)](_0x1ac518);}}),router[a0_0x27e0ed(0x9d)](a0_0x27e0ed(0xee),auth,async(_0x1f7512,_0x346dcd)=>{var _0x3a3d49=a0_0x27e0ed;try{const {warehouse_name:_0x9195d3,date:_0x3efef0,prod_name:_0x1427db,level:_0x5cee6e,isle:_0x54af69,pallet:_0x19d811,stock:_0x5d9cbb,types:_0x2cdd3d,adjust_qty:_0x6527c4,new_adjust_qty:_0x33614c,note:_0xae6234,Room_name:_0x37877d,JO_number:_0x52e3e3,expiry_date:_0x37f96c,PO_number:_0x1189ca,ReqBy:_0x179e01,dateofreq:_0x4a57aa,typeservicesData:_0x287d88,destination:_0x4668d6,deliverydate:_0x3e8aca,driver:_0x5a48e5,plate:_0x37d76e,van:_0x5cee72,DRSI:_0x5476f1,typevehicle:_0x3792a9,TSU:_0x520202,TFU:_0x38d597}=_0x1f7512[_0x3a3d49(0x7a)];if(typeof _0x1427db=='string')var _0x5db1a3=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xf6)]],_0x3f7d72=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xe9)]],_0x67a2c2=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xaa)]],_0x1ecbf7=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x102)]],_0x1bb9d9=[_0x1f7512['body'][_0x3a3d49(0xc5)]],_0x40d979=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xba)]],_0x517bd8=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xe5)]],_0x3b974e=[_0x1f7512['body']['Secondary_units']],_0x21b4b2=[_0x1f7512['body'][_0x3a3d49(0xf5)]],_0x1b730a=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x10e)]],_0x198fb9=[_0x1f7512[_0x3a3d49(0x7a)]['expiry_date']],_0x21388d=[_0x1f7512['body']['product_date']],_0x4d302=[_0x1f7512[_0x3a3d49(0x7a)]['prod_cat']],_0x194a32=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x9e)]],_0x2b1899=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xf9)]],_0x481151=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xff)]],_0x4a5dea=[_0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xb2)]];else var _0x5db1a3=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xf6)]],_0x3f7d72=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xe9)]],_0x67a2c2=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xaa)]],_0x1ecbf7=[..._0x1f7512[_0x3a3d49(0x7a)]['types']],_0x1bb9d9=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xc5)]],_0x40d979=[..._0x1f7512['body'][_0x3a3d49(0xba)]],_0x517bd8=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xe5)]],_0x3b974e=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x7f)]],_0x21b4b2=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xf5)]],_0x1b730a=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x10e)]],_0x198fb9=[..._0x1f7512['body'][_0x3a3d49(0x69)]],_0x21388d=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x97)]],_0x4d302=[..._0x1f7512['body'][_0x3a3d49(0xb1)]],_0x194a32=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0x9e)]],_0x2b1899=[..._0x1f7512['body'][_0x3a3d49(0xf9)]],_0x481151=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xff)]],_0x4a5dea=[..._0x1f7512[_0x3a3d49(0x7a)][_0x3a3d49(0xb2)]];const _0xbeb06c=_0x5db1a3[_0x3a3d49(0x8c)](_0x1ce363=>{return _0x1ce363={'product_name':_0x1ce363};});_0x3f7d72[_0x3a3d49(0x115)]((_0x36dc55,_0x58fc16)=>{var _0x5448d5=_0x3a3d49,_0x525034=_0x36dc55[_0x5448d5(0xcc)](/[A-Za-z]+/)[0x0],_0x252d75=parseInt(_0x36dc55[_0x5448d5(0xcc)](/\d+/)[0x0]);_0xbeb06c[_0x58fc16][_0x5448d5(0xe9)]=_0x525034,_0xbeb06c[_0x58fc16]['bay']=_0x252d75;}),_0x4a5dea[_0x3a3d49(0x115)]((_0x11f6d8,_0x1313cf)=>{var _0x2c2cbc=_0x3a3d49;_0xbeb06c[_0x1313cf][_0x2c2cbc(0xe3)]=_0x11f6d8;}),_0x67a2c2['forEach']((_0x52ebfc,_0x55b4b3)=>{_0xbeb06c[_0x55b4b3]['stockBefore']=_0x52ebfc;}),_0x1ecbf7['forEach']((_0x34a7af,_0x437c70)=>{var _0x4fca32=_0x3a3d49;_0xbeb06c[_0x437c70][_0x4fca32(0x102)]=_0x34a7af;}),_0x1bb9d9[_0x3a3d49(0x115)]((_0x2b103c,_0x3612bc)=>{var _0x264eb9=_0x3a3d49;_0xbeb06c[_0x3612bc][_0x264eb9(0x98)]=_0x2b103c;}),_0x40d979[_0x3a3d49(0x115)]((_0x21535e,_0x30d58a)=>{_0xbeb06c[_0x30d58a]['new_adjust_qty']=_0x21535e;}),_0x517bd8['forEach']((_0x1cc9a3,_0x28ab63)=>{var _0x18ab22=_0x3a3d49;_0xbeb06c[_0x28ab63][_0x18ab22(0x8f)]=_0x1cc9a3;}),_0x3b974e[_0x3a3d49(0x115)]((_0x25e0f0,_0x55c26a)=>{_0xbeb06c[_0x55c26a]['secondary_unit']=_0x25e0f0;}),_0x21b4b2['forEach']((_0x28eb6d,_0x49833b)=>{var _0x1bffee=_0x3a3d49;_0xbeb06c[_0x49833b][_0x1bffee(0xef)]=_0x28eb6d;}),_0x1b730a[_0x3a3d49(0x115)]((_0x586090,_0x3e2f2c)=>{var _0x3ab265=_0x3a3d49;_0xbeb06c[_0x3e2f2c][_0x3ab265(0x10e)]=_0x586090;}),_0x198fb9[_0x3a3d49(0x115)]((_0x3b5516,_0x2b5db)=>{var _0x50a0de=_0x3a3d49;_0xbeb06c[_0x2b5db][_0x50a0de(0x69)]=_0x3b5516;}),_0x21388d['forEach']((_0x45f5e9,_0x4dd96d)=>{var _0x302da4=_0x3a3d49;_0xbeb06c[_0x4dd96d][_0x302da4(0xe8)]=_0x45f5e9;}),_0x4d302[_0x3a3d49(0x115)]((_0x5d9cd4,_0x284511)=>{var _0xa33973=_0x3a3d49;_0xbeb06c[_0x284511][_0xa33973(0xb1)]=_0x5d9cd4;}),_0x194a32['forEach']((_0x14c641,_0x59bb5a)=>{var _0x5c9d65=_0x3a3d49;_0xbeb06c[_0x59bb5a][_0x5c9d65(0x94)]=_0x14c641;}),_0x2b1899[_0x3a3d49(0x115)]((_0x47ec41,_0x597895)=>{var _0x307de8=_0x3a3d49;_0xbeb06c[_0x597895][_0x307de8(0xf9)]=_0x47ec41;}),_0x481151['forEach']((_0x370243,_0x17eab5)=>{_0xbeb06c[_0x17eab5]['invoice']=_0x370243;});const _0x117561=_0xbeb06c[_0x3a3d49(0xea)](_0x577674=>_0x577674[_0x3a3d49(0x98)]!=='0'&&_0x577674[_0x3a3d49(0x98)]!=='');var _0x1ba42e=0x0;_0x117561[_0x3a3d49(0x115)](_0x13bb28=>{var _0x3ea723=_0x3a3d49;console[_0x3ea723(0x112)](_0x3ea723(0xd0),_0x13bb28),parseInt(_0x13bb28['adjust_qty'])<=0x0&&_0x1ba42e++;});if(_0x1ba42e!=0x0)return _0x1f7512[_0x3a3d49(0xa5)](_0x3a3d49(0x64),_0x3a3d49(0xf0)),_0x346dcd[_0x3a3d49(0xf8)](_0x3a3d49(0xcb));const _0x42bfaa=new invoice_for_adjustment();await _0x42bfaa[_0x3a3d49(0xeb)]();const _0x543233=new adjustment_finished({'warehouse_name':_0x9195d3,'date':_0x3efef0,'product':_0x117561,'note':_0xae6234,'room':_0x37877d,'invoice':_0x3a3d49(0xb6)+_0x42bfaa[_0x3a3d49(0xcd)]['toString']()[_0x3a3d49(0xf3)](0x8,'0'),'JO_number':_0x52e3e3,'expiry_date':_0x37f96c,'PO_number':_0x1189ca,'RequestedBy':_0x179e01,'DateofRequest':_0x4a57aa,'typeservices':_0x287d88,'destination':_0x4668d6,'deliverydate':_0x3e8aca,'driver':_0x5a48e5,'plate':_0x37d76e,'van':_0x5cee72,'DRSI':_0x5476f1,'typevehicle':_0x3792a9,'TSU':_0x520202,'TFU':_0x38d597}),_0x33cf42=await _0x543233[_0x3a3d49(0xeb)]();_0x1f7512['flash'](_0x3a3d49(0x8b),_0x3a3d49(0xf1)),_0x346dcd[_0x3a3d49(0xf8)](_0x3a3d49(0xd5)+_0x33cf42[_0x3a3d49(0xfc)]);}catch(_0x4a15e4){console[_0x3a3d49(0x112)](_0x4a15e4),_0x346dcd[_0x3a3d49(0x6a)](0xc8)[_0x3a3d49(0xb3)]({'message':_0x4a15e4[_0x3a3d49(0xec)]});}}),router[a0_0x27e0ed(0x82)](a0_0x27e0ed(0x6e),auth,async(_0x49a4a8,_0x5f2b22)=>{var _0x159df6=a0_0x27e0ed;try{const {username:_0x24bcd6,email:_0x681381,role:_0x5a85ce}=_0x49a4a8[_0x159df6(0x90)],_0x383e6b=_0x49a4a8[_0x159df6(0x90)],_0x18e602=await profile[_0x159df6(0x107)]({'email':_0x383e6b[_0x159df6(0x7c)]}),_0x6c413e=await master_shop[_0x159df6(0x10d)]();let _0x4a6960;if(_0x383e6b[_0x159df6(0x103)]==_0x159df6(0xac)){const _0x33bc3d=await staff[_0x159df6(0x107)]({'email':_0x383e6b[_0x159df6(0x7c)]});_0x4a6960=await warehouse[_0x159df6(0x67)]([{'$match':{'status':_0x159df6(0x104),'name':_0x33bc3d[_0x159df6(0xfd)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x4a6960=await warehouse[_0x159df6(0x67)]([{'$match':{'status':_0x159df6(0x104)}},{'$group':{'_id':_0x159df6(0x77),'name':{'$first':_0x159df6(0x77)}}}]);const _0x5a5825=await product[_0x159df6(0x10d)](),_0x618166=await adjustment_finished[_0x159df6(0x10d)](),_0x4867cc=_0x618166[_0x159df6(0x10b)]+0x1,_0x3acf85=_0x159df6(0xc9)+_0x4867cc[_0x159df6(0x73)]()['padStart'](0x5,'0');var _0x63b336=['Ambient',_0x159df6(0x108),_0x159df6(0xa7)];if(_0x6c413e[0x0][_0x159df6(0xfa)]==_0x159df6(0xb0))var _0x31b069=users[_0x159df6(0xa0)];else{if(_0x6c413e[0x0][_0x159df6(0xfa)]==_0x159df6(0x101))var _0x31b069=users[_0x159df6(0x101)];else{if(_0x6c413e[0x0][_0x159df6(0xfa)]==_0x159df6(0xd7))var _0x31b069=users[_0x159df6(0xd7)];else{if(_0x6c413e[0x0][_0x159df6(0xfa)]=='Spanish')var _0x31b069=users[_0x159df6(0xd8)];else{if(_0x6c413e[0x0][_0x159df6(0xfa)]==_0x159df6(0xce))var _0x31b069=users['French'];else{if(_0x6c413e[0x0]['language']==_0x159df6(0xf4))var _0x31b069=users[_0x159df6(0xe4)];else{if(_0x6c413e[0x0]['language']==_0x159df6(0xc0))var _0x31b069=users[_0x159df6(0xc0)];else{if(_0x6c413e[0x0]['language']==_0x159df6(0x100))var _0x31b069=users['Arabic'];}}}}}}}const _0x548ea5=getRandom8DigitNumber();_0x548ea5[_0x159df6(0xb7)](_0xae779b=>{var _0x5e538a=_0x159df6;_0x5f2b22[_0x5e538a(0xf7)]('add_adjustment_finished_logs',{'success':_0x49a4a8[_0x5e538a(0xa5)](_0x5e538a(0x8b)),'errors':_0x49a4a8[_0x5e538a(0xa5)](_0x5e538a(0x64)),'role':_0x383e6b,'profile':_0x18e602,'warehouse':_0x4a6960,'product':_0x5a5825,'master_shop':_0x6c413e,'language':_0x31b069,'rooms_data':_0x63b336,'invoice_no':_0xae779b});})['catch'](_0x24c9a0=>{var _0x390a0e=_0x159df6;_0x49a4a8[_0x390a0e(0xa5)](_0x390a0e(0x64),_0x390a0e(0x9b)),_0x5f2b22[_0x390a0e(0xf8)](_0x390a0e(0xa4));});}catch(_0xa6747f){console[_0x159df6(0x112)](_0xa6747f);}}),router[a0_0x27e0ed(0x9d)](a0_0x27e0ed(0x6e),auth,async(_0x229b06,_0x49157d)=>{var _0x5539c8=a0_0x27e0ed;try{const {warehouse_name:_0x2145d5,date:_0x966e69,prod_name:_0x3ccd36,level:_0x448b0c,isle:_0x1fff48,pallet:_0xc0606d,stock:_0x294699,types:_0x1b2304,adjust_qty:_0x453c22,new_adjust_qty:_0x1b4a3d,note:_0x36c5ce,Room_name:_0x59db9d,JO_number:_0x331e44,expiry_date:_0x4af9d8,type_of_transaction:_0x22f8f7,PO_number:_0x47bade,ReqBy:_0x3d595f,dateofreq:_0x1d130f,typeservicesData:_0xb14dd2,destination:_0x5da995,deliverydate:_0x284c0e,driver:_0x56749d,plate:_0x5e6ef2,van:_0x12a2b6,DRSI:_0x426846,typevehicle:_0x2cf407,TSU:_0x2a8f45,TFU:_0x1fc854}=_0x229b06[_0x5539c8(0x7a)];if(typeof _0x3ccd36==_0x5539c8(0x76))var _0x15685f=[_0x229b06[_0x5539c8(0x7a)]['prod_name']],_0x1bf7c9=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xe9)]],_0x3f4e00=[_0x229b06['body']['stock']],_0x51701f=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x102)]],_0x3a935f=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xc5)]],_0x2893f2=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xba)]],_0x4cc88a=[_0x229b06[_0x5539c8(0x7a)]['Primary_Units']],_0x31ba48=[_0x229b06[_0x5539c8(0x7a)]['Secondary_units']],_0x51c81b=[_0x229b06['body'][_0x5539c8(0xf5)]],_0x1f9f7d=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x10e)]],_0x33dfd0=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x69)]],_0x19737b=[_0x229b06['body'][_0x5539c8(0x97)]],_0x49d981=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xb1)]],_0x491fa6=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x9e)]],_0x204449=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xf9)]],_0x2fa70d=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xff)]],_0x23933a=[_0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xb2)]];else var _0x15685f=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xf6)]],_0x1bf7c9=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xe9)]],_0x3f4e00=[..._0x229b06['body'][_0x5539c8(0xaa)]],_0x51701f=[..._0x229b06[_0x5539c8(0x7a)]['types']],_0x3a935f=[..._0x229b06['body'][_0x5539c8(0xc5)]],_0x2893f2=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xba)]],_0x4cc88a=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xe5)]],_0x31ba48=[..._0x229b06['body']['Secondary_units']],_0x51c81b=[..._0x229b06['body'][_0x5539c8(0xf5)]],_0x1f9f7d=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x10e)]],_0x33dfd0=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x69)]],_0x19737b=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x97)]],_0x49d981=[..._0x229b06[_0x5539c8(0x7a)]['prod_cat']],_0x491fa6=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0x9e)]],_0x204449=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xf9)]],_0x2fa70d=[..._0x229b06['body'][_0x5539c8(0xff)]],_0x23933a=[..._0x229b06[_0x5539c8(0x7a)][_0x5539c8(0xb2)]];const _0x4f4f46=_0x15685f['map'](_0x4374b3=>{return _0x4374b3={'product_name':_0x4374b3};});_0x1bf7c9[_0x5539c8(0x115)]((_0x10b15a,_0x33492a)=>{var _0x424e7e=_0x5539c8,_0xd25618=_0x10b15a[_0x424e7e(0xcc)](/[A-Za-z]+/)[0x0],_0x5c7834=parseInt(_0x10b15a[_0x424e7e(0xcc)](/\d+/)[0x0]);_0x4f4f46[_0x33492a][_0x424e7e(0xe9)]=_0xd25618,_0x4f4f46[_0x33492a][_0x424e7e(0x8d)]=_0x5c7834;}),_0x23933a[_0x5539c8(0x115)]((_0x13949f,_0x1431fa)=>{var _0x46b503=_0x5539c8;_0x4f4f46[_0x1431fa][_0x46b503(0xe3)]=_0x13949f;}),_0x3f4e00[_0x5539c8(0x115)]((_0x6e6fca,_0x2feef4)=>{var _0x1e3a76=_0x5539c8;_0x4f4f46[_0x2feef4][_0x1e3a76(0x9c)]=_0x6e6fca;}),_0x51701f['forEach']((_0x472f19,_0x19e3f4)=>{var _0x13ffdb=_0x5539c8;_0x4f4f46[_0x19e3f4][_0x13ffdb(0x102)]=_0x472f19;}),_0x3a935f[_0x5539c8(0x115)]((_0x577ff2,_0x117256)=>{_0x4f4f46[_0x117256]['adjust_qty']=_0x577ff2;}),_0x2893f2[_0x5539c8(0x115)]((_0x1bb81f,_0x44ceaa)=>{var _0xb1a6a0=_0x5539c8;_0x4f4f46[_0x44ceaa][_0xb1a6a0(0xa3)]=_0x1bb81f;}),_0x4cc88a[_0x5539c8(0x115)]((_0x44211c,_0x284efa)=>{var _0x7b07d3=_0x5539c8;_0x4f4f46[_0x284efa][_0x7b07d3(0x8f)]=_0x44211c;}),_0x31ba48[_0x5539c8(0x115)]((_0x49aaf0,_0x1cfeb4)=>{_0x4f4f46[_0x1cfeb4]['secondary_unit']=_0x49aaf0;}),_0x51c81b[_0x5539c8(0x115)]((_0x2f1b4b,_0x50d556)=>{var _0x25b692=_0x5539c8;_0x4f4f46[_0x50d556][_0x25b692(0xef)]=_0x2f1b4b;}),_0x1f9f7d[_0x5539c8(0x115)]((_0x3c629e,_0x23c96f)=>{_0x4f4f46[_0x23c96f]['batch_code']=_0x3c629e;}),_0x33dfd0[_0x5539c8(0x115)]((_0x26794c,_0x50617f)=>{_0x4f4f46[_0x50617f]['expiry_date']=_0x26794c;}),_0x19737b[_0x5539c8(0x115)]((_0x57c80d,_0x47bd4b)=>{_0x4f4f46[_0x47bd4b]['production_date']=_0x57c80d;}),_0x49d981[_0x5539c8(0x115)]((_0x39d57f,_0x4fd4f2)=>{_0x4f4f46[_0x4fd4f2]['prod_cat']=_0x39d57f;}),_0x491fa6[_0x5539c8(0x115)]((_0x2623bb,_0x582888)=>{var _0x418833=_0x5539c8;_0x4f4f46[_0x582888][_0x418833(0x94)]=_0x2623bb;}),_0x204449[_0x5539c8(0x115)]((_0xa1e9d8,_0x1b64b5)=>{var _0x329dac=_0x5539c8;_0x4f4f46[_0x1b64b5][_0x329dac(0xf9)]=_0xa1e9d8;}),_0x2fa70d[_0x5539c8(0x115)]((_0x6a1174,_0xb4d8d6)=>{var _0x3f81dd=_0x5539c8;_0x4f4f46[_0xb4d8d6][_0x3f81dd(0x96)]=_0x6a1174;});const _0x2007d6=_0x4f4f46[_0x5539c8(0xea)](_0x88ee6f=>_0x88ee6f['adjust_qty']!=='0'&&_0x88ee6f[_0x5539c8(0x98)]!=='');var _0x2c306f=0x0;_0x2007d6['forEach'](_0x3e2dc3=>{var _0x4b1945=_0x5539c8;console[_0x4b1945(0x112)]('foreach\x20newproduct',_0x3e2dc3),parseInt(_0x3e2dc3[_0x4b1945(0x98)])<=0x0&&_0x2c306f++;});if(_0x2c306f!=0x0)return _0x229b06[_0x5539c8(0xa5)](_0x5539c8(0x64),_0x5539c8(0xf0)),_0x49157d[_0x5539c8(0xf8)](_0x5539c8(0xcb));const _0x605ec=new adjustment_logs();await _0x605ec['save']();const _0x375420=new adjustment_finished({'warehouse_name':_0x2145d5,'date':_0x966e69,'product':_0x2007d6,'note':_0x36c5ce,'room':_0x59db9d,'invoice':_0x5539c8(0xa1)+_0x605ec[_0x5539c8(0xcd)][_0x5539c8(0x73)]()[_0x5539c8(0xf3)](0x8,'0'),'JO_number':_0x331e44,'expiry_date':_0x4af9d8,'type_of_transaction':_0x22f8f7,'PO_number':_0x47bade,'RequestedBy':_0x3d595f,'DateofRequest':_0x1d130f,'typeservices':_0xb14dd2,'destination':_0x5da995,'deliverydate':_0x284c0e,'driver':_0x56749d,'plate':_0x5e6ef2,'van':_0x12a2b6,'DRSI':_0x426846,'typevehicle':_0x2cf407,'TSU':_0x2a8f45,'TFU':_0x1fc854}),_0x291af1=await _0x375420['save']();_0x229b06['flash'](_0x5539c8(0x8b),'adjustment\x20add\x20successfull'),_0x49157d[_0x5539c8(0xf8)](_0x5539c8(0xd5)+_0x291af1[_0x5539c8(0xfc)]);}catch(_0x2054dc){console[_0x5539c8(0x112)](_0x2054dc),_0x49157d['status'](0xc8)['json']({'message':_0x2054dc[_0x5539c8(0xec)]});}}),router[a0_0x27e0ed(0x82)](a0_0x27e0ed(0xb8),auth,async(_0x508846,_0x80e91c)=>{var _0xb55c22=a0_0x27e0ed;try{const {username:_0xde61f9,email:_0x34c783,role:_0x445cfc}=_0x508846[_0xb55c22(0x90)],_0x1d75ee=_0x508846[_0xb55c22(0x90)],_0x5277ac=await profile[_0xb55c22(0x107)]({'email':_0x1d75ee[_0xb55c22(0x7c)]}),_0x4d8793=await master_shop['find'](),_0x53241f=_0x508846[_0xb55c22(0xd9)]['id'],_0x1b5989=await adjustment_finished[_0xb55c22(0x91)]({'_id':_0x53241f}),_0x859e1a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1b5989[_0xb55c22(0xde)]}},{'$unwind':_0xb55c22(0x111)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0xb55c22(0x106),_0x859e1a);const _0x515a78=await product['find']({}),_0x2ddf56=await warehouse[_0xb55c22(0x67)]([{'$match':{'name':_0x1b5989[_0xb55c22(0xde)]}},{'$unwind':_0xb55c22(0x10f)},{'$group':{'_id':_0xb55c22(0x6c),'name':{'$first':_0xb55c22(0xc6)},'product_stock':{'$first':_0xb55c22(0x68)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xb55c22(0xf2)},'type':{'$first':_0xb55c22(0xd4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xb55c22(0x70)},'secondary_code':{'$first':_0xb55c22(0x116)},'product_code':{'$first':_0xb55c22(0x74)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xb55c22(0xaf)},'expiry_date':{'$first':_0xb55c22(0x8e)},'production_date':{'$first':_0xb55c22(0xc3)},'batch_code':{'$first':_0xb55c22(0x88)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0xb55c22(0x7b)}}}]);if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0xb0)){var _0x3b8df0=users[_0xb55c22(0xa0)];console[_0xb55c22(0x112)](_0x3b8df0);}else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0x101))var _0x3b8df0=users[_0xb55c22(0x101)];else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0xd7))var _0x3b8df0=users[_0xb55c22(0xd7)];else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0xd8))var _0x3b8df0=users[_0xb55c22(0xd8)];else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0xce))var _0x3b8df0=users[_0xb55c22(0xce)];else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0xf4))var _0x3b8df0=users[_0xb55c22(0xe4)];else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0xc0))var _0x3b8df0=users[_0xb55c22(0xc0)];else{if(_0x4d8793[0x0][_0xb55c22(0xfa)]==_0xb55c22(0x100))var _0x3b8df0=users[_0xb55c22(0x95)];}}}}}}}_0x80e91c[_0xb55c22(0xf7)](_0xb55c22(0xe2),{'success':_0x508846[_0xb55c22(0xa5)]('success'),'errors':_0x508846[_0xb55c22(0xa5)]('errors'),'role':_0x1d75ee,'profile':_0x5277ac,'adjustment':_0x1b5989,'stock':_0x2ddf56,'master_shop':_0x4d8793,'warehouse_name':_0x859e1a,'unit':_0x515a78,'language':_0x3b8df0});}catch(_0x43ff41){console[_0xb55c22(0x112)](_0x43ff41),_0x80e91c[_0xb55c22(0x6a)](0xc8)[_0xb55c22(0xb3)]({'message':_0x43ff41[_0xb55c22(0xec)]});}}),router[a0_0x27e0ed(0x9d)]('/preview/:id',auth,async(_0x6d2c3e,_0x13c99c)=>{var _0x52524b=a0_0x27e0ed;try{const {invoice:_0x1acc41,warehouse_name:_0x5da537,Room_name:_0x9327c8}=_0x6d2c3e[_0x52524b(0x7a)],_0x382340=_0x6d2c3e[_0x52524b(0xd9)]['id'],_0xaf4aaf=await adjustment_finished[_0x52524b(0x91)]({'_id':_0x382340});var _0x2ad3ed;const _0x1325e6=_0xaf4aaf['product'][_0x52524b(0x8c)](async _0x5b9ec5=>{var _0x1726ac=_0x52524b;if(_0x5b9ec5['adjust_qty']>0x0){_0x2ad3ed=await warehouse['findOne']({'name':_0x5da537,'room':_0x5b9ec5['room_names']});const _0x4c32cc=_0x2ad3ed[_0x1726ac(0xda)][_0x1726ac(0x8c)](_0x1580bf=>{var _0x4a9764=_0x1726ac;console[_0x4a9764(0x112)](_0x5b9ec5[_0x4a9764(0x102)]);if(_0x5b9ec5[_0x4a9764(0x102)]==_0x4a9764(0x85))_0x1580bf[_0x4a9764(0xfc)]==_0x5b9ec5['id_transaction']&&(_0x1580bf['product_stock']=_0x1580bf[_0x4a9764(0xc2)]-_0x5b9ec5['adjust_qty']);else _0x5b9ec5[_0x4a9764(0x102)]==_0x4a9764(0x9a)&&(_0x1580bf[_0x4a9764(0xfc)]==_0x5b9ec5[_0x4a9764(0xe3)]&&(_0x1580bf[_0x4a9764(0xc2)]=_0x1580bf['product_stock']+_0x5b9ec5[_0x4a9764(0x98)]));});}return _0x2ad3ed;});Promise['all'](_0x1325e6)[_0x52524b(0xb7)](async _0x4377a0=>{var _0x4f755b=_0x52524b;try{for(const _0x372357 of _0x4377a0){await _0x372357['save']();}_0xaf4aaf[_0x4f755b(0x83)]=_0x4f755b(0xe0);const _0xb3e5ae=await _0xaf4aaf[_0x4f755b(0xeb)](),_0x3cf08a=await master_shop[_0x4f755b(0x10d)](),_0x10d902=await email_settings[_0x4f755b(0x107)](),_0x4810a0=await supervisor_settings[_0x4f755b(0x10d)]();var _0x163a77=_0xaf4aaf['product'],_0x360e70='',_0x303944;for(_0x303944 in _0x163a77){var _0x57b2ea='FG';_0xaf4aaf[_0x4f755b(0xde)]==_0x4f755b(0x92)&&(_0x57b2ea='DG'),_0x360e70+=_0x4f755b(0xc8)+_0x4f755b(0xfe)+_0x163a77[_0x303944]['product_name']+_0x4f755b(0x6f)+_0x4f755b(0xfe)+_0x163a77[_0x303944][_0x4f755b(0xef)]+'</td>'+_0x4f755b(0xfe)+_0x163a77[_0x303944][_0x4f755b(0x98)]+_0x4f755b(0x6f)+_0x4f755b(0xfe)+_0x163a77[_0x303944][_0x4f755b(0x8f)]+_0x4f755b(0x6f)+_0x4f755b(0xfe)+_0x163a77[_0x303944]['secondary_unit']+'</td>'+_0x4f755b(0xfe)+_0xaf4aaf[_0x4f755b(0xde)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x163a77[_0x303944][_0x4f755b(0x94)]+_0x4f755b(0x6f)+_0x4f755b(0xfe)+_0x57b2ea+_0x163a77[_0x303944][_0x4f755b(0x8d)]+_0x4f755b(0x6f)+_0x4f755b(0x93);}_0x6d2c3e[_0x4f755b(0xa5)](_0x4f755b(0x8b),_0x4f755b(0x84)),_0x13c99c[_0x4f755b(0xf8)](_0x4f755b(0x65)+_0xb3e5ae[_0x4f755b(0xfc)]);}catch(_0x57e2db){console[_0x4f755b(0xd2)](_0x57e2db),_0x13c99c['status'](0x1f4)[_0x4f755b(0xb3)]({'error':_0x4f755b(0xc7)});}})[_0x52524b(0x110)](_0x2d4ad7=>{var _0x22bf5d=_0x52524b;console[_0x22bf5d(0xd2)](_0x2d4ad7),_0x13c99c[_0x22bf5d(0x6a)](0x1f4)[_0x22bf5d(0xb3)]({'error':'An\x20error\x20occurred.'});});}catch(_0x5cbe68){_0x13c99c[_0x52524b(0xb3)]({'message':_0x5cbe68[_0x52524b(0xec)]});}}),router['get']('/view/:id',auth,async(_0x1f86dd,_0x41f645)=>{var _0x1760e5=a0_0x27e0ed;try{const {username:_0x4ce7fc,email:_0x5f3595,role:_0x2c6d2a}=_0x1f86dd[_0x1760e5(0x90)],_0x594688=_0x1f86dd['user'],_0x1ef2ce=await profile[_0x1760e5(0x107)]({'email':_0x594688[_0x1760e5(0x7c)]}),_0x894404=await master_shop[_0x1760e5(0x10d)]();console['log'](_0x1760e5(0xae),_0x894404);const _0x369f5a=_0x1f86dd[_0x1760e5(0xd9)]['id'],_0x319852=await adjustment_finished[_0x1760e5(0x91)]({'_id':_0x369f5a});let _0x3063ed=new Date(_0x319852[_0x1760e5(0x69)]),_0x5e2b19=('0'+_0x3063ed['getDate']())[_0x1760e5(0x6d)](-0x2),_0x33ec6e=('0'+(_0x3063ed['getMonth']()+0x1))[_0x1760e5(0x6d)](-0x2),_0x241114=_0x3063ed[_0x1760e5(0x9f)](),_0x1f2ca6=_0x241114+'-'+_0x33ec6e+'-'+_0x5e2b19;var _0x3b4493=[_0x1760e5(0xd3),_0x1760e5(0x108),_0x1760e5(0xa7)];const _0x3ef490=await purchases['aggregate']([{'$match':{'warehouse_name':_0x319852[_0x1760e5(0xde)]}},{'$unwind':'$product'},{'$group':{'_id':_0x1760e5(0xca)}}]);console[_0x1760e5(0x112)](_0x1760e5(0x106),_0x3ef490);const _0x15cd59=await product['find']({}),_0x1ce051=await warehouse[_0x1760e5(0x67)]([{'$match':{'name':_0x319852[_0x1760e5(0xde)],'room':_0x319852['room']}},{'$unwind':_0x1760e5(0x10f)},{'$group':{'_id':_0x1760e5(0x6c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1760e5(0x80)},'bin':{'$first':_0x1760e5(0xf2)},'type':{'$first':_0x1760e5(0xd4)},'floorlevel':{'$first':_0x1760e5(0x10c)},'primary_code':{'$first':_0x1760e5(0x70)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1760e5(0x74)},'storage':{'$first':_0x1760e5(0xb4)},'rack':{'$first':_0x1760e5(0xaf)}}}]);if(_0x894404[0x0][_0x1760e5(0xfa)]=='English\x20(US)'){var _0x4c0a1b=users[_0x1760e5(0xa0)];console['log'](_0x4c0a1b);}else{if(_0x894404[0x0][_0x1760e5(0xfa)]==_0x1760e5(0x101))var _0x4c0a1b=users[_0x1760e5(0x101)];else{if(_0x894404[0x0][_0x1760e5(0xfa)]==_0x1760e5(0xd7))var _0x4c0a1b=users[_0x1760e5(0xd7)];else{if(_0x894404[0x0][_0x1760e5(0xfa)]==_0x1760e5(0xd8))var _0x4c0a1b=users[_0x1760e5(0xd8)];else{if(_0x894404[0x0][_0x1760e5(0xfa)]==_0x1760e5(0xce))var _0x4c0a1b=users[_0x1760e5(0xce)];else{if(_0x894404[0x0][_0x1760e5(0xfa)]==_0x1760e5(0xf4))var _0x4c0a1b=users[_0x1760e5(0xe4)];else{if(_0x894404[0x0][_0x1760e5(0xfa)]=='Chinese')var _0x4c0a1b=users[_0x1760e5(0xc0)];else{if(_0x894404[0x0]['language']==_0x1760e5(0x100))var _0x4c0a1b=users[_0x1760e5(0x95)];}}}}}}}_0x41f645[_0x1760e5(0xf7)](_0x1760e5(0xd6),{'success':_0x1f86dd[_0x1760e5(0xa5)](_0x1760e5(0x8b)),'errors':_0x1f86dd[_0x1760e5(0xa5)](_0x1760e5(0x64)),'role':_0x594688,'profile':_0x1ef2ce,'adjustment':_0x319852,'stock':_0x1ce051,'master_shop':_0x894404,'warehouse_name':_0x3ef490,'unit':_0x15cd59,'language':_0x4c0a1b,'rooms_data':_0x3b4493,'ed_fullDate':_0x1f2ca6});}catch(_0x733e34){console['log'](_0x733e34),_0x41f645[_0x1760e5(0x6a)](0xc8)['json']({'message':_0x733e34[_0x1760e5(0xec)]});}}),router[a0_0x27e0ed(0x9d)](a0_0x27e0ed(0x114),auth,async(_0x5aafd8,_0xe0b08f)=>{var _0x48cf2e=a0_0x27e0ed;try{const _0x3eb578=_0x5aafd8[_0x48cf2e(0xd9)]['id'],_0x5c1606=await adjustment_finished[_0x48cf2e(0x91)]({'_id':_0x3eb578}),_0x10a5c3=await warehouse['findOne']({'name':_0x5c1606[_0x48cf2e(0xde)],'room':_0x5c1606[_0x48cf2e(0xdc)]}),{warehouse_name:_0x1ecdb0,date:_0x1f830c,prod_name:_0x53e4f1,level:_0xac1c48,isle:_0x506857,pallet:_0x5614e5,stock:_0x2874ce,types:_0x5ea078,adjust_qty:_0x42e6a2,new_adjust_qty:_0x7bbcce,note:_0x53c8c0,Room_name:_0x47cd38,invoice:_0x12d79f,JO_number:_0x4b1066}=_0x5aafd8[_0x48cf2e(0x7a)];if(typeof _0x53e4f1==_0x48cf2e(0x76))var _0x2cef12=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0xf6)]],_0x4fbf6f=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0xe9)]],_0x20ae75=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0xaa)]],_0x2cefca=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x102)]],_0x48186b=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x98)]],_0x5b34b8=[_0x5aafd8['body'][_0x48cf2e(0xa3)]],_0x33346f=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0xf5)]],_0x5e6ad1=[_0x5aafd8['body'][_0x48cf2e(0x8f)]],_0x32ae71=[_0x5aafd8['body']['Secondary_units']],_0x4bbde7=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x10e)]],_0x2c1970=[_0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x69)]];else var _0x2cef12=[..._0x5aafd8[_0x48cf2e(0x7a)]['prod_name']],_0x4fbf6f=[..._0x5aafd8[_0x48cf2e(0x7a)]['level']],_0x20ae75=[..._0x5aafd8['body'][_0x48cf2e(0xaa)]],_0x2cefca=[..._0x5aafd8['body'][_0x48cf2e(0x102)]],_0x48186b=[..._0x5aafd8[_0x48cf2e(0x7a)]['adjust_qty']],_0x5b34b8=[..._0x5aafd8['body'][_0x48cf2e(0xa3)]],_0x33346f=[..._0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0xf5)]],_0x5e6ad1=[..._0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x8f)]],_0x32ae71=[..._0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x7f)]],_0x4bbde7=[..._0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x10e)]],_0x2c1970=[..._0x5aafd8[_0x48cf2e(0x7a)][_0x48cf2e(0x69)]];const _0x50f31f=_0x2cef12[_0x48cf2e(0x8c)](_0x246952=>{return _0x246952={'product_name':_0x246952};});_0x4fbf6f['forEach']((_0xfb4eb4,_0x21633f)=>{_0x50f31f[_0x21633f]['bay']=_0xfb4eb4;}),_0x20ae75[_0x48cf2e(0x115)]((_0x32782c,_0x83a6c4)=>{var _0x5670a3=_0x48cf2e;_0x50f31f[_0x83a6c4][_0x5670a3(0x9c)]=_0x32782c;}),_0x2cefca[_0x48cf2e(0x115)]((_0x53cb84,_0x1e545e)=>{var _0x540e08=_0x48cf2e;_0x50f31f[_0x1e545e][_0x540e08(0x102)]=_0x53cb84;}),_0x48186b[_0x48cf2e(0x115)]((_0x549ac2,_0x14cd5f)=>{_0x50f31f[_0x14cd5f]['adjust_qty']=_0x549ac2;}),_0x5b34b8[_0x48cf2e(0x115)]((_0x382557,_0x1c1416)=>{var _0x1d4b80=_0x48cf2e;_0x50f31f[_0x1c1416][_0x1d4b80(0xa3)]=_0x382557;}),_0x5e6ad1[_0x48cf2e(0x115)]((_0x3c4bf2,_0xe0ca50)=>{var _0x371dae=_0x48cf2e;_0x50f31f[_0xe0ca50][_0x371dae(0x8f)]=_0x3c4bf2;}),_0x32ae71[_0x48cf2e(0x115)]((_0x6e9e42,_0x54577d)=>{var _0x489ec0=_0x48cf2e;_0x50f31f[_0x54577d][_0x489ec0(0xa6)]=_0x6e9e42;}),_0x33346f[_0x48cf2e(0x115)]((_0x892fd0,_0x5840de)=>{var _0x57a119=_0x48cf2e;_0x50f31f[_0x5840de][_0x57a119(0xef)]=_0x892fd0;}),_0x4bbde7[_0x48cf2e(0x115)]((_0x5857f9,_0x467119)=>{var _0x57529d=_0x48cf2e;_0x50f31f[_0x467119][_0x57529d(0x10e)]=_0x5857f9;}),_0x2c1970[_0x48cf2e(0x115)]((_0x5ac9ad,_0x47f235)=>{var _0xad4b64=_0x48cf2e;_0x50f31f[_0x47f235][_0xad4b64(0x69)]=_0x5ac9ad;});const _0x33f058=_0x50f31f['filter'](_0x1993b6=>_0x1993b6[_0x48cf2e(0x98)]!=='0'&&_0x1993b6['adjust_qty']!=='');var _0x37906f=0x0;_0x33f058[_0x48cf2e(0x115)](_0x5830e6=>{var _0x181ce0=_0x48cf2e;console[_0x181ce0(0x112)](_0x181ce0(0xd0),_0x5830e6),parseInt(_0x5830e6[_0x181ce0(0x98)])<=0x0&&_0x37906f++;});if(_0x37906f!=0x0)return _0x5aafd8[_0x48cf2e(0xa5)]('errors',_0x48cf2e(0xf0)),_0xe0b08f[_0x48cf2e(0xf8)]('back');_0x5c1606[_0x48cf2e(0xde)]=_0x1ecdb0,_0x5c1606[_0x48cf2e(0x7e)]=_0x1f830c,_0x5c1606[_0x48cf2e(0x72)]=_0x33f058,_0x5c1606['note']=_0x53c8c0,_0x5c1606[_0x48cf2e(0xdc)]=_0x47cd38,_0x5c1606[_0x48cf2e(0x96)]=_0x12d79f,_0x5c1606[_0x48cf2e(0x109)]=_0x4b1066;const _0x1ac738=await _0x5c1606[_0x48cf2e(0xeb)](),_0x4be113=await warehouse[_0x48cf2e(0x107)]({'name':_0x1ecdb0,'room':_0x47cd38});_0x1ac738[_0x48cf2e(0x72)]['forEach'](_0x5dd761=>{var _0x353657=_0x48cf2e;const _0x2095ae=_0x4be113['product_details'][_0x353657(0x8c)](_0x1c2f49=>{var _0x19441f=_0x353657;_0x5dd761[_0x19441f(0x102)]==_0x19441f(0x85)?_0x1c2f49[_0x19441f(0x113)]==_0x5dd761['product_name']&&_0x1c2f49[_0x19441f(0x8d)]==_0x5dd761['bay']&&(_0x1c2f49['product_stock']=parseInt(_0x1c2f49[_0x19441f(0xc2)])-parseInt(_0x5dd761[_0x19441f(0x98)])):_0x1c2f49[_0x19441f(0x113)]==_0x5dd761[_0x19441f(0x113)]&&_0x1c2f49[_0x19441f(0x8d)]==_0x5dd761[_0x19441f(0x8d)]&&(_0x1c2f49[_0x19441f(0xc2)]=parseInt(_0x1c2f49[_0x19441f(0xc2)])+parseInt(_0x5dd761['adjust_qty']));});}),await _0x4be113['save'](),_0x5aafd8[_0x48cf2e(0xa5)]('success','adjustment\x20data\x20update\x20successfully'),_0xe0b08f[_0x48cf2e(0xf8)](_0x48cf2e(0xbe));}catch(_0x507fb1){console[_0x48cf2e(0x112)](_0x507fb1);}}),router[a0_0x27e0ed(0x9d)](a0_0x27e0ed(0xbb),async(_0x587838,_0x3cacec)=>{var _0x4044b8=a0_0x27e0ed;const {primary_code:_0x2f8480,warehouse_data:_0x87044f,rooms_data:_0x4fca08,Roomslist:_0x10573e}=_0x587838[_0x4044b8(0x7a)],_0x248046=_0x10573e[_0x4044b8(0x66)](','),_0x11eef1=[];async function _0x5db3d5(_0x159aeb){var _0x2dd427=_0x4044b8;const _0x566441=await warehouse[_0x2dd427(0x67)]([{'$match':{'name':_0x87044f,'room':_0x159aeb}},{'$unwind':_0x2dd427(0x10f)},{'$match':{'product_details.primary_code':_0x2f8480}},{'$group':{'_id':_0x2dd427(0x6c),'name':{'$first':_0x2dd427(0xc6)},'product_stock':{'$first':_0x2dd427(0x68)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2dd427(0x116)},'product_code':{'$first':_0x2dd427(0x74)},'level':{'$first':_0x2dd427(0xdf)},'bay':{'$first':_0x2dd427(0x80)},'type':{'$first':_0x2dd427(0xd4)},'pallet':{'$first':_0x2dd427(0x10c)},'unit':{'$first':_0x2dd427(0xbf)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2dd427(0xb4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2dd427(0x71)},'roomNamed':{'$first':_0x2dd427(0x7b)},'invoice':{'$first':_0x2dd427(0x7d)}}}]),_0x4a551f=await warehouse[_0x2dd427(0x67)]([{'$match':{'name':_0x87044f,'room':_0x159aeb}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x2f8480}},{'$group':{'_id':_0x2dd427(0x6c),'name':{'$first':_0x2dd427(0xc6)},'product_stock':{'$first':_0x2dd427(0x68)},'primary_code':{'$first':_0x2dd427(0x70)},'secondary_code':{'$first':_0x2dd427(0x116)},'product_code':{'$first':_0x2dd427(0x74)},'level':{'$first':'$product_details.level'},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x2dd427(0xd4)},'pallet':{'$first':_0x2dd427(0x10c)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2dd427(0x75)},'storage':{'$first':_0x2dd427(0xb4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2dd427(0x8e)},'production_date':{'$first':_0x2dd427(0xc3)},'batch_code':{'$first':_0x2dd427(0x88)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x2dd427(0x71)},'roomNamed':{'$first':_0x2dd427(0x7b)},'invoice':{'$first':_0x2dd427(0x7d)}}}]);if(_0x566441[_0x2dd427(0x10b)]>0x0)_0x11eef1['push'](_0x566441);else _0x4a551f[_0x2dd427(0x10b)]>0x0&&_0x11eef1[_0x2dd427(0xb5)](_0x4a551f);}const _0x3a9803=_0x248046[_0x4044b8(0x8c)](_0x497191=>_0x5db3d5(_0x497191));await Promise[_0x4044b8(0xdd)](_0x3a9803),_0x3cacec[_0x4044b8(0xb3)](_0x11eef1);}),router['post'](a0_0x27e0ed(0x6b),async(_0x236d52,_0x3b826c)=>{var _0x6a77be=a0_0x27e0ed;const {productCode:_0x463f6c,bay:_0x30adfd,warehouses:_0xa3bbb5,room:_0x5a963a}=_0x236d52['body'];console[_0x6a77be(0x112)](_0x236d52['body']);try{const _0x14e91f=await warehouse[_0x6a77be(0x67)]([{'$match':{'name':_0xa3bbb5,'room':_0x5a963a}},{'$unwind':_0x6a77be(0x10f)},{'$match':{'product_details.bay':parseInt(_0x30adfd)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x6a77be(0x68)},'bay':{'$first':_0x6a77be(0x80)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3b826c['status'](0xc8)['json'](_0x14e91f);}catch(_0x57cb75){_0x3b826c[_0x6a77be(0x6a)](0x194)[_0x6a77be(0xb3)]({'message':_0x57cb75[_0x6a77be(0xec)]});}}),module[a0_0x27e0ed(0xa2)]=router;