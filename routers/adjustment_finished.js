var a0_0x29f58b=a0_0x4faa;(function(_0xc3cd82,_0x386fd7){var _0x3bd503=a0_0x4faa,_0x51edd0=_0xc3cd82();while(!![]){try{var _0x332c8d=parseInt(_0x3bd503(0x10c))/0x1+-parseInt(_0x3bd503(0xf6))/0x2*(-parseInt(_0x3bd503(0xf8))/0x3)+parseInt(_0x3bd503(0xd5))/0x4+-parseInt(_0x3bd503(0x179))/0x5*(-parseInt(_0x3bd503(0x10b))/0x6)+-parseInt(_0x3bd503(0x137))/0x7*(-parseInt(_0x3bd503(0x112))/0x8)+-parseInt(_0x3bd503(0x11b))/0x9*(-parseInt(_0x3bd503(0xde))/0xa)+-parseInt(_0x3bd503(0x15e))/0xb;if(_0x332c8d===_0x386fd7)break;else _0x51edd0['push'](_0x51edd0['shift']());}catch(_0x3a6f95){_0x51edd0['push'](_0x51edd0['shift']());}}}(a0_0x55e5,0xde70a));const express=require(a0_0x29f58b(0x148)),app=express(),router=express[a0_0x29f58b(0x17d)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x29f58b(0x16a)),users=require(a0_0x29f58b(0x17b)),nodemailer=require('nodemailer');router[a0_0x29f58b(0x101)](a0_0x29f58b(0x17c),auth,async(_0x153120,_0x5e0b80)=>{var _0x1ac259=a0_0x29f58b;try{const {username:_0x2a40bb,email:_0x2e8b8c,role:_0x278883}=_0x153120[_0x1ac259(0x180)],_0x207938=_0x153120[_0x1ac259(0x180)],_0x24e4d8=await profile['findOne']({'email':_0x207938[_0x1ac259(0x157)]}),_0xa908ea=await master_shop[_0x1ac259(0x121)]();let _0x156a3d;if(_0x207938[_0x1ac259(0x154)]==_0x1ac259(0xdb)){const _0x1a2c4c=await staff[_0x1ac259(0x147)]({'email':_0x207938[_0x1ac259(0x157)]});_0x156a3d=await warehouse[_0x1ac259(0x121)]({'status':_0x1ac259(0x13e),'name':_0x1a2c4c['warehouse']});}else _0x156a3d=await warehouse[_0x1ac259(0x121)]({'status':'Enabled'});const _0x3891a8=await product['find']();let _0x1a0811;if(_0x207938[_0x1ac259(0x154)]==_0x1ac259(0xdb)){const _0x77f4eb=await staff[_0x1ac259(0x147)]({'email':_0x207938[_0x1ac259(0x157)]});_0x1a0811=await adjustment_finished[_0x1ac259(0x121)]({'warehouse_name':_0x77f4eb[_0x1ac259(0x134)]});}else _0x1a0811=await adjustment_finished[_0x1ac259(0xd3)]([{'$match':{'type_of_transaction':_0x1ac259(0xdf)}},{'$unwind':_0x1ac259(0xf9)},{'$group':{'_id':_0x1ac259(0x114),'invoice':{'$first':_0x1ac259(0xed)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1ac259(0x15f)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x1ac259(0x12b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xa908ea[0x0]['language']==_0x1ac259(0x153)){var _0x13bf5a=users['English'];console['log'](_0x13bf5a);}else{if(_0xa908ea[0x0][_0x1ac259(0x10e)]==_0x1ac259(0xfe))var _0x13bf5a=users[_0x1ac259(0xfe)];else{if(_0xa908ea[0x0][_0x1ac259(0x10e)]==_0x1ac259(0xf4))var _0x13bf5a=users[_0x1ac259(0xf4)];else{if(_0xa908ea[0x0][_0x1ac259(0x10e)]==_0x1ac259(0x15d))var _0x13bf5a=users['Spanish'];else{if(_0xa908ea[0x0]['language']==_0x1ac259(0x16e))var _0x13bf5a=users[_0x1ac259(0x16e)];else{if(_0xa908ea[0x0]['language']==_0x1ac259(0x136))var _0x13bf5a=users[_0x1ac259(0xf5)];else{if(_0xa908ea[0x0][_0x1ac259(0x10e)]=='Chinese')var _0x13bf5a=users['Chinese'];else{if(_0xa908ea[0x0][_0x1ac259(0x10e)]=='Arabic\x20(ae)')var _0x13bf5a=users[_0x1ac259(0x161)];}}}}}}}_0x5e0b80['render'](_0x1ac259(0x152),{'success':_0x153120[_0x1ac259(0x17e)](_0x1ac259(0x177)),'errors':_0x153120[_0x1ac259(0x17e)](_0x1ac259(0x126)),'role':_0x207938,'profile':_0x24e4d8,'warehouse':_0x156a3d,'product':_0x3891a8,'adjustment':_0x1a0811,'master_shop':_0xa908ea,'language':_0x13bf5a});}catch(_0x4fc535){console['log'](_0x4fc535);}}),router[a0_0x29f58b(0x101)]('/view_logs',auth,async(_0x30e6d1,_0x1a125f)=>{var _0x2369d0=a0_0x29f58b;try{const {username:_0x4085c4,email:_0x34676d,role:_0x39f808}=_0x30e6d1[_0x2369d0(0x180)],_0x373595=_0x30e6d1[_0x2369d0(0x180)],_0x3b9fe1=await profile[_0x2369d0(0x147)]({'email':_0x373595[_0x2369d0(0x157)]}),_0x1ce69b=await master_shop[_0x2369d0(0x121)]();let _0x40c7ab;if(_0x373595[_0x2369d0(0x154)]==_0x2369d0(0xdb)){const _0x1a5003=await staff['findOne']({'email':_0x373595[_0x2369d0(0x157)]});_0x40c7ab=await warehouse['find']({'status':_0x2369d0(0x13e),'name':_0x1a5003[_0x2369d0(0x134)]});}else _0x40c7ab=await warehouse[_0x2369d0(0x121)]({'status':_0x2369d0(0x13e)});const _0x431ef6=await product[_0x2369d0(0x121)]();let _0x27a59b;if(_0x373595[_0x2369d0(0x154)]==_0x2369d0(0xdb)){const _0x446c2b=await staff[_0x2369d0(0x147)]({'email':_0x373595[_0x2369d0(0x157)]});_0x27a59b=await adjustment_finished['find']({'warehouse_name':_0x446c2b['warehouse']});}else _0x27a59b=await adjustment_finished[_0x2369d0(0xd3)]([{'$match':{'type_of_transaction':_0x2369d0(0x16c)}},{'$unwind':_0x2369d0(0xf9)},{'$group':{'_id':_0x2369d0(0x114),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2369d0(0x15f)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x2369d0(0x12b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0x153))var _0x15eac8=users[_0x2369d0(0x16b)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0xfe))var _0x15eac8=users[_0x2369d0(0xfe)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0xf4))var _0x15eac8=users[_0x2369d0(0xf4)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]=='Spanish')var _0x15eac8=users[_0x2369d0(0x15d)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0x16e))var _0x15eac8=users[_0x2369d0(0x16e)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0x136))var _0x15eac8=users[_0x2369d0(0xf5)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0xdd))var _0x15eac8=users[_0x2369d0(0xdd)];else{if(_0x1ce69b[0x0][_0x2369d0(0x10e)]==_0x2369d0(0x14e))var _0x15eac8=users[_0x2369d0(0x161)];}}}}}}}_0x1a125f[_0x2369d0(0x119)](_0x2369d0(0xfc),{'success':_0x30e6d1[_0x2369d0(0x17e)]('success'),'errors':_0x30e6d1[_0x2369d0(0x17e)]('errors'),'role':_0x373595,'profile':_0x3b9fe1,'warehouse':_0x40c7ab,'product':_0x431ef6,'adjustment':_0x27a59b,'master_shop':_0x1ce69b,'language':_0x15eac8});}catch(_0x46b4f9){console[_0x2369d0(0x145)](_0x46b4f9);}});function a0_0x4faa(_0x355b3e,_0x2a54bd){var _0x55e572=a0_0x55e5();return a0_0x4faa=function(_0x4faa6a,_0x39b8ca){_0x4faa6a=_0x4faa6a-0xd0;var _0x4c86ab=_0x55e572[_0x4faa6a];return _0x4c86ab;},a0_0x4faa(_0x355b3e,_0x2a54bd);}function a0_0x55e5(){var _0x1090aa=['/preview/:id','redirect','/barcode_scanner','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','json','$invoice','/view/add_adjustment_logs','add','ADJ-','$product_details.secondary_code','post','True','German','Portuguese','421138GvrydG','getDate','3hrqDkG','$product','exports','split','adjustment_finished_logs','padStart','Hindi','edit_adjustment_finished','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','$product_details.secondary_unit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','back','toString','$product_details.type','$product_details.expiry_date','$name','push','product_name','6ozfLjP','1696047HnhmrY','product_code','language','Secondary_units','prod_name','/view/:id','88zJjfvS','/picking_list/PDF_adjustmentFinal/','$_id','$product_details.product_code','$product_details','purchases_data','map','render','Ambient','117mZYNGP','minus','level','stock','product_date','edit_adjustment_finished_view','find','$product_details.rack','invoice','findById','_id','errors','</td>','$product_details.level','then','body','$finalize','/adjustment/view','id_transaction','string','warehouse_name','master','$product_details.primary_code','foreach\x20newproduct','$product_details.storage','warehouse','$product_details.product_stock','Portuguese\x20(BR)','261086ROuWCS','catch','$product_details.bay','$product_details.maxPerUnit','$product_details.unit','$product.product_name','ADJF-','Enabled','params','batch_code','getFullYear','DRY\x20GOODS','prod_code','/adjustment_finished/view','log','message','findOne','express','maxPerUnit','new_adjust_qty','Rooms','filter','JO_number','Arabic\x20(ae)','add_adjustment_finished','forEach','adjustment\x20add\x20successfull','adjustment_finished','English\x20(US)','role','error','save','email','expiry_date','/view/add_adjustment','all','adjust_qty','Primary_Units','Spanish','57357850IndPMW','$warehouse_name','prod_cat','Arabic','production_date','id_transaction_from','$product_details.invoice','bay','invoice_init','date','$product_details.floorlevel','$product_details.production_date','../models/all_models','English','logs','New_Qty_Converted_adj','French','Enclosed','product','add_adjustment_finished_logs','getMonth','Adjustment\x20Finalize\x20Successfully','</tr>','floor','finalize','success','types','7446910XQIiQO','length','../public/language/languages.json','/view','Router','flash','New_Qty_Converted','user','room_names','/adjustment_finished/preview/','$product_details.product_name','aggregate','product_stock','7220100niWhEh','stockBefore','match','secondary_unit','room','An\x20error\x20occurred.','staff','product_details','Chinese','395510AZosGI','own','adjustment\x20data\x20update\x20successfully','$product_details._id','unit','$room','LOG-ADJ-','status','Return\x20Rooms','prod_invoice'];a0_0x55e5=function(){return _0x1090aa;};return a0_0x55e5();}async function getRandom8DigitNumber(){var _0x772e08=a0_0x29f58b;const _0x29efaa=0x989680,_0x25ebb4=0x5f5e0ff,_0x2fde87=Math[_0x772e08(0x175)](Math['random']()*(_0x25ebb4-_0x29efaa+0x1))+_0x29efaa;var _0xd115b2;const _0x3d6dd5=await adjustment_finished[_0x772e08(0x147)]({'invoice':_0x772e08(0x13d)+_0x2fde87});return _0x3d6dd5&&_0x3d6dd5[_0x772e08(0x17a)]>0x0?_0xd115b2=_0x772e08(0x13d)+_0x2fde87:_0xd115b2=_0x772e08(0x13d)+_0x2fde87,_0xd115b2;}router['get']('/view/add_adjustment',auth,async(_0x9996ad,_0x5ac3fc)=>{var _0x5b58ee=a0_0x29f58b;try{const {username:_0x41749d,email:_0x41bb36,role:_0x4295e9}=_0x9996ad[_0x5b58ee(0x180)],_0x41f298=_0x9996ad[_0x5b58ee(0x180)],_0x37aee2=await profile[_0x5b58ee(0x147)]({'email':_0x41f298[_0x5b58ee(0x157)]}),_0x26dae2=await master_shop[_0x5b58ee(0x121)]();let _0x25ee18;if(_0x41f298[_0x5b58ee(0x154)]==_0x5b58ee(0xdb)){const _0xdb0d62=await staff[_0x5b58ee(0x147)]({'email':_0x41f298['email']});_0x25ee18=await warehouse[_0x5b58ee(0xd3)]([{'$match':{'status':_0x5b58ee(0x13e),'name':_0xdb0d62[_0x5b58ee(0x134)]}},{'$group':{'_id':_0x5b58ee(0x108),'name':{'$first':_0x5b58ee(0x108)}}}]);}else _0x25ee18=await warehouse['aggregate']([{'$match':{'status':_0x5b58ee(0x13e)}},{'$group':{'_id':_0x5b58ee(0x108),'name':{'$first':'$name'}}}]);const _0xa7b840=await product['find']({}),_0x179c8c=await adjustment_finished[_0x5b58ee(0x121)](),_0x30ecf0=_0x179c8c[_0x5b58ee(0x17a)]+0x1,_0x2fc61c=_0x5b58ee(0x13d)+_0x30ecf0['toString']()[_0x5b58ee(0xfd)](0x5,'0');var _0x4fab9c=[_0x5b58ee(0x11a),'Enclosed',_0x5b58ee(0xe6)];if(_0x26dae2[0x0][_0x5b58ee(0x10e)]==_0x5b58ee(0x153))var _0x3a2b08=users[_0x5b58ee(0x16b)];else{if(_0x26dae2[0x0]['language']==_0x5b58ee(0xfe))var _0x3a2b08=users['Hindi'];else{if(_0x26dae2[0x0]['language']==_0x5b58ee(0xf4))var _0x3a2b08=users[_0x5b58ee(0xf4)];else{if(_0x26dae2[0x0][_0x5b58ee(0x10e)]==_0x5b58ee(0x15d))var _0x3a2b08=users[_0x5b58ee(0x15d)];else{if(_0x26dae2[0x0][_0x5b58ee(0x10e)]==_0x5b58ee(0x16e))var _0x3a2b08=users['French'];else{if(_0x26dae2[0x0][_0x5b58ee(0x10e)]=='Portuguese\x20(BR)')var _0x3a2b08=users[_0x5b58ee(0xf5)];else{if(_0x26dae2[0x0]['language']=='Chinese')var _0x3a2b08=users[_0x5b58ee(0xdd)];else{if(_0x26dae2[0x0][_0x5b58ee(0x10e)]=='Arabic\x20(ae)')var _0x3a2b08=users['Arabic'];}}}}}}}const _0x5ac361=getRandom8DigitNumber();_0x5ac361[_0x5b58ee(0x129)](_0x1ca2f6=>{var _0x1f4f77=_0x5b58ee;_0x5ac3fc[_0x1f4f77(0x119)](_0x1f4f77(0x14f),{'success':_0x9996ad[_0x1f4f77(0x17e)](_0x1f4f77(0x177)),'errors':_0x9996ad[_0x1f4f77(0x17e)](_0x1f4f77(0x126)),'role':_0x41f298,'profile':_0x37aee2,'warehouse':_0x25ee18,'product':_0xa7b840,'master_shop':_0x26dae2,'language':_0x3a2b08,'rooms_data':_0x4fab9c,'invoice_no':_0x1ca2f6});})['catch'](_0x333db=>{var _0x22f64b=_0x5b58ee;_0x9996ad[_0x22f64b(0x17e)](_0x22f64b(0x126),_0x22f64b(0x103)),_0x5ac3fc[_0x22f64b(0xe9)]('/adjustment/view');});}catch(_0x279f40){console[_0x5b58ee(0x145)](_0x279f40);}}),router[a0_0x29f58b(0xf2)](a0_0x29f58b(0x159),auth,async(_0x55ac34,_0x2cc7e4)=>{var _0x29562e=a0_0x29f58b;try{const {warehouse_name:_0x2e0900,date:_0x4f2a2d,prod_name:_0x6c0aa,level:_0x161784,isle:_0xd918a7,pallet:_0x1d748d,stock:_0x2f1907,types:_0x1b4c2d,adjust_qty:_0xf74c6b,new_adjust_qty:_0x3e765f,note:_0x1ac95a,Room_name:_0x1638ad,JO_number:_0x4d71b8,expiry_date:_0x1c43ff,PO_number:_0xabe7fb,ReqBy:_0x536d33,dateofreq:_0x8a2d6e,typeservicesData:_0x4a128b,destination:_0x2dd4c2,deliverydate:_0x4cdabb,driver:_0x3ebfc9,plate:_0x39eb32,van:_0x3719ff,DRSI:_0x20f615,typevehicle:_0x1e7fd1,TSU:_0x560f6a,TFU:_0x2cd13a}=_0x55ac34[_0x29562e(0x12a)];if(typeof _0x6c0aa==_0x29562e(0x12e))var _0x2971f1=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x110)]],_0x9c2508=[_0x55ac34['body']['level']],_0x43a1cd=[_0x55ac34['body']['stock']],_0x39c77d=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x178)]],_0x1d2698=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x16d)]],_0x439367=[_0x55ac34[_0x29562e(0x12a)]['New_Qty_Converted']],_0x533fa1=[_0x55ac34['body']['Primary_Units']],_0x5b8dea=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x10f)]],_0x869888=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x143)]],_0x40de1d=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x140)]],_0x4edca5=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x158)]],_0x28e934=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x11f)]],_0x8555e=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x160)]],_0x192253=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x14b)]],_0x113fef=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x149)]],_0x54642a=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0xe7)]],_0x30ad14=[_0x55ac34[_0x29562e(0x12a)][_0x29562e(0x163)]];else var _0x2971f1=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x110)]],_0x9c2508=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x11d)]],_0x43a1cd=[..._0x55ac34['body'][_0x29562e(0x11e)]],_0x39c77d=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x178)]],_0x1d2698=[..._0x55ac34['body'][_0x29562e(0x16d)]],_0x439367=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x17f)]],_0x533fa1=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x15c)]],_0x5b8dea=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x10f)]],_0x869888=[..._0x55ac34['body'][_0x29562e(0x143)]],_0x40de1d=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x140)]],_0x4edca5=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x158)]],_0x28e934=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x11f)]],_0x8555e=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x160)]],_0x192253=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x14b)]],_0x113fef=[..._0x55ac34[_0x29562e(0x12a)]['maxPerUnit']],_0x54642a=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0xe7)]],_0x30ad14=[..._0x55ac34[_0x29562e(0x12a)][_0x29562e(0x163)]];const _0x388f28=_0x2971f1['map'](_0x2c95e9=>{return _0x2c95e9={'product_name':_0x2c95e9};});_0x9c2508['forEach']((_0x21d06b,_0x3ee680)=>{var _0x1a3aa9=_0x29562e,_0x30d6f2=_0x21d06b['match'](/[A-Za-z]+/)[0x0],_0x4723fc=parseInt(_0x21d06b[_0x1a3aa9(0xd7)](/\d+/)[0x0]);_0x388f28[_0x3ee680][_0x1a3aa9(0x11d)]=_0x30d6f2,_0x388f28[_0x3ee680][_0x1a3aa9(0x165)]=_0x4723fc;}),_0x30ad14['forEach']((_0x941c24,_0xe150a5)=>{var _0x9b565f=_0x29562e;_0x388f28[_0xe150a5][_0x9b565f(0x12d)]=_0x941c24;}),_0x43a1cd[_0x29562e(0x150)]((_0x10e293,_0x1c2dce)=>{var _0x5627fa=_0x29562e;_0x388f28[_0x1c2dce][_0x5627fa(0xd6)]=_0x10e293;}),_0x39c77d[_0x29562e(0x150)]((_0x51c1ba,_0x1cc8d9)=>{_0x388f28[_0x1cc8d9]['types']=_0x51c1ba;}),_0x1d2698['forEach']((_0x10153f,_0xa8f8c6)=>{var _0x9802d7=_0x29562e;_0x388f28[_0xa8f8c6][_0x9802d7(0x15b)]=_0x10153f;}),_0x439367[_0x29562e(0x150)]((_0x37e502,_0x2cc42c)=>{var _0x8e0257=_0x29562e;_0x388f28[_0x2cc42c][_0x8e0257(0x14a)]=_0x37e502;}),_0x533fa1[_0x29562e(0x150)]((_0x1c0cb9,_0x20464a)=>{var _0x1ff26e=_0x29562e;_0x388f28[_0x20464a][_0x1ff26e(0xe2)]=_0x1c0cb9;}),_0x5b8dea['forEach']((_0x596015,_0x15a36f)=>{var _0x570bd=_0x29562e;_0x388f28[_0x15a36f][_0x570bd(0xd8)]=_0x596015;}),_0x869888[_0x29562e(0x150)]((_0x2f915a,_0x2556f8)=>{_0x388f28[_0x2556f8]['product_code']=_0x2f915a;}),_0x40de1d[_0x29562e(0x150)]((_0x3a5b40,_0x40ba97)=>{var _0x5a0f88=_0x29562e;_0x388f28[_0x40ba97][_0x5a0f88(0x140)]=_0x3a5b40;}),_0x4edca5[_0x29562e(0x150)]((_0x7a4d39,_0x5262ee)=>{var _0x5db0ed=_0x29562e;_0x388f28[_0x5262ee][_0x5db0ed(0x158)]=_0x7a4d39;}),_0x28e934['forEach']((_0x50d38a,_0x3f8745)=>{_0x388f28[_0x3f8745]['production_date']=_0x50d38a;}),_0x8555e[_0x29562e(0x150)]((_0x4b5eb7,_0x2c195a)=>{var _0x9c2902=_0x29562e;_0x388f28[_0x2c195a][_0x9c2902(0x160)]=_0x4b5eb7;}),_0x192253['forEach']((_0x20937c,_0x5bddc6)=>{_0x388f28[_0x5bddc6]['room_names']=_0x20937c;}),_0x113fef[_0x29562e(0x150)]((_0x323779,_0x5b431f)=>{var _0x468f4e=_0x29562e;_0x388f28[_0x5b431f][_0x468f4e(0x149)]=_0x323779;}),_0x54642a['forEach']((_0x441fce,_0x476aa4)=>{_0x388f28[_0x476aa4]['invoice']=_0x441fce;});const _0x686c22=_0x388f28['filter'](_0x5c1fb8=>_0x5c1fb8[_0x29562e(0x15b)]!=='0'&&_0x5c1fb8[_0x29562e(0x15b)]!=='');var _0x45d0d3=0x0;_0x686c22[_0x29562e(0x150)](_0x4af6f6=>{var _0x1e0135=_0x29562e;console[_0x1e0135(0x145)](_0x1e0135(0x132),_0x4af6f6),parseInt(_0x4af6f6['adjust_qty'])<=0x0&&_0x45d0d3++;});if(_0x45d0d3!=0x0)return _0x55ac34[_0x29562e(0x17e)](_0x29562e(0x126),_0x29562e(0xeb)),_0x2cc7e4[_0x29562e(0xe9)]('back');const _0x4ba6c6=new invoice_for_adjustment();await _0x4ba6c6[_0x29562e(0x156)]();const _0x5b35aa=new adjustment_finished({'warehouse_name':_0x2e0900,'date':_0x4f2a2d,'product':_0x686c22,'note':_0x1ac95a,'room':_0x1638ad,'invoice':_0x29562e(0xf0)+_0x4ba6c6[_0x29562e(0x166)][_0x29562e(0x105)]()[_0x29562e(0xfd)](0x8,'0'),'JO_number':_0x4d71b8,'expiry_date':_0x1c43ff,'PO_number':_0xabe7fb,'RequestedBy':_0x536d33,'DateofRequest':_0x8a2d6e,'typeservices':_0x4a128b,'destination':_0x2dd4c2,'deliverydate':_0x4cdabb,'driver':_0x3ebfc9,'plate':_0x39eb32,'van':_0x3719ff,'DRSI':_0x20f615,'typevehicle':_0x1e7fd1,'TSU':_0x560f6a,'TFU':_0x2cd13a}),_0x4fdcad=await _0x5b35aa[_0x29562e(0x156)]();_0x55ac34['flash'](_0x29562e(0x177),_0x29562e(0x151)),_0x2cc7e4[_0x29562e(0xe9)](_0x29562e(0xd1)+_0x4fdcad[_0x29562e(0x125)]);}catch(_0x5e1106){console['log'](_0x5e1106),_0x2cc7e4[_0x29562e(0xe5)](0xc8)['json']({'message':_0x5e1106[_0x29562e(0x146)]});}}),router[a0_0x29f58b(0x101)](a0_0x29f58b(0xee),auth,async(_0x3625f0,_0x988c85)=>{var _0x3b1bb7=a0_0x29f58b;try{const {username:_0x2531b2,email:_0x33cc62,role:_0x420532}=_0x3625f0[_0x3b1bb7(0x180)],_0x1e5883=_0x3625f0[_0x3b1bb7(0x180)],_0x53b3c9=await profile['findOne']({'email':_0x1e5883[_0x3b1bb7(0x157)]}),_0x585c5e=await master_shop['find']();let _0x5238ed;if(_0x1e5883[_0x3b1bb7(0x154)]==_0x3b1bb7(0xdb)){const _0x207524=await staff[_0x3b1bb7(0x147)]({'email':_0x1e5883[_0x3b1bb7(0x157)]});_0x5238ed=await warehouse[_0x3b1bb7(0xd3)]([{'$match':{'status':_0x3b1bb7(0x13e),'name':_0x207524['warehouse']}},{'$group':{'_id':_0x3b1bb7(0x108),'name':{'$first':'$name'}}}]);}else _0x5238ed=await warehouse[_0x3b1bb7(0xd3)]([{'$match':{'status':_0x3b1bb7(0x13e)}},{'$group':{'_id':_0x3b1bb7(0x108),'name':{'$first':_0x3b1bb7(0x108)}}}]);const _0x1f4295=await product[_0x3b1bb7(0x121)](),_0x43a9cf=await adjustment_finished['find'](),_0x107be5=_0x43a9cf[_0x3b1bb7(0x17a)]+0x1,_0x256ee9=_0x3b1bb7(0x13d)+_0x107be5[_0x3b1bb7(0x105)]()[_0x3b1bb7(0xfd)](0x5,'0');var _0x5619e1=['Ambient',_0x3b1bb7(0x16f),_0x3b1bb7(0xe6)];if(_0x585c5e[0x0][_0x3b1bb7(0x10e)]==_0x3b1bb7(0x153))var _0x828ceb=users[_0x3b1bb7(0x16b)];else{if(_0x585c5e[0x0][_0x3b1bb7(0x10e)]==_0x3b1bb7(0xfe))var _0x828ceb=users[_0x3b1bb7(0xfe)];else{if(_0x585c5e[0x0][_0x3b1bb7(0x10e)]==_0x3b1bb7(0xf4))var _0x828ceb=users[_0x3b1bb7(0xf4)];else{if(_0x585c5e[0x0][_0x3b1bb7(0x10e)]=='Spanish')var _0x828ceb=users[_0x3b1bb7(0x15d)];else{if(_0x585c5e[0x0]['language']=='French')var _0x828ceb=users['French'];else{if(_0x585c5e[0x0][_0x3b1bb7(0x10e)]==_0x3b1bb7(0x136))var _0x828ceb=users[_0x3b1bb7(0xf5)];else{if(_0x585c5e[0x0][_0x3b1bb7(0x10e)]=='Chinese')var _0x828ceb=users[_0x3b1bb7(0xdd)];else{if(_0x585c5e[0x0]['language']==_0x3b1bb7(0x14e))var _0x828ceb=users[_0x3b1bb7(0x161)];}}}}}}}const _0x47bc54=getRandom8DigitNumber();_0x47bc54[_0x3b1bb7(0x129)](_0x58d464=>{var _0x456405=_0x3b1bb7;_0x988c85[_0x456405(0x119)](_0x456405(0x171),{'success':_0x3625f0[_0x456405(0x17e)]('success'),'errors':_0x3625f0['flash']('errors'),'role':_0x1e5883,'profile':_0x53b3c9,'warehouse':_0x5238ed,'product':_0x1f4295,'master_shop':_0x585c5e,'language':_0x828ceb,'rooms_data':_0x5619e1,'invoice_no':_0x58d464});})[_0x3b1bb7(0x138)](_0x19977e=>{var _0x52607b=_0x3b1bb7;_0x3625f0[_0x52607b(0x17e)](_0x52607b(0x126),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x988c85[_0x52607b(0xe9)](_0x52607b(0x12c));});}catch(_0x9dca4d){console[_0x3b1bb7(0x145)](_0x9dca4d);}}),router[a0_0x29f58b(0xf2)](a0_0x29f58b(0xee),auth,async(_0x2a049f,_0x35477c)=>{var _0x41f1b2=a0_0x29f58b;try{const {warehouse_name:_0x44b1d2,date:_0x2f6970,prod_name:_0x585ad6,level:_0xc29855,isle:_0x3c3600,pallet:_0x499598,stock:_0xa4d1a7,types:_0x5cbfe9,adjust_qty:_0x5b6450,new_adjust_qty:_0x100d23,note:_0x1bbbff,Room_name:_0x4446e0,JO_number:_0x3a9cff,expiry_date:_0x2ca9c5,type_of_transaction:_0xf3968b,PO_number:_0x356aaa,ReqBy:_0x3c3ff1,dateofreq:_0x58326a,typeservicesData:_0x3c27ab,destination:_0x38d6e4,deliverydate:_0x3231f1,driver:_0x303398,plate:_0x232567,van:_0x3020e8,DRSI:_0x4e7a26,typevehicle:_0xf260d2,TSU:_0x5f1d55,TFU:_0x8646f7}=_0x2a049f[_0x41f1b2(0x12a)];if(typeof _0x585ad6==_0x41f1b2(0x12e))var _0x15787b=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x110)]],_0xc7d789=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x11d)]],_0x30e56f=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x11e)]],_0x281c9c=[_0x2a049f['body']['types']],_0x5883a9=[_0x2a049f[_0x41f1b2(0x12a)]['New_Qty_Converted_adj']],_0xbb7c07=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x17f)]],_0x595b82=[_0x2a049f[_0x41f1b2(0x12a)]['Primary_Units']],_0x210093=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x10f)]],_0x30f5a9=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x143)]],_0x5da4f9=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x140)]],_0x44e608=[_0x2a049f['body']['expiry_date']],_0x31a8cf=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x11f)]],_0x1b117a=[_0x2a049f['body'][_0x41f1b2(0x160)]],_0x1d48f1=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x14b)]],_0x409d5d=[_0x2a049f['body'][_0x41f1b2(0x149)]],_0x4ad753=[_0x2a049f['body'][_0x41f1b2(0xe7)]],_0x102a72=[_0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x163)]];else var _0x15787b=[..._0x2a049f['body']['prod_name']],_0xc7d789=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x11d)]],_0x30e56f=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x11e)]],_0x281c9c=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x178)]],_0x5883a9=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x16d)]],_0xbb7c07=[..._0x2a049f['body'][_0x41f1b2(0x17f)]],_0x595b82=[..._0x2a049f['body'][_0x41f1b2(0x15c)]],_0x210093=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x10f)]],_0x30f5a9=[..._0x2a049f['body'][_0x41f1b2(0x143)]],_0x5da4f9=[..._0x2a049f[_0x41f1b2(0x12a)]['batch_code']],_0x44e608=[..._0x2a049f['body'][_0x41f1b2(0x158)]],_0x31a8cf=[..._0x2a049f[_0x41f1b2(0x12a)]['product_date']],_0x1b117a=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x160)]],_0x1d48f1=[..._0x2a049f[_0x41f1b2(0x12a)]['Rooms']],_0x409d5d=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x149)]],_0x4ad753=[..._0x2a049f[_0x41f1b2(0x12a)]['prod_invoice']],_0x102a72=[..._0x2a049f[_0x41f1b2(0x12a)][_0x41f1b2(0x163)]];const _0x18ab1c=_0x15787b['map'](_0x3ce1bf=>{return _0x3ce1bf={'product_name':_0x3ce1bf};});_0xc7d789['forEach']((_0x2841c1,_0x400a8d)=>{var _0x506732=_0x41f1b2,_0x4b3c06=_0x2841c1[_0x506732(0xd7)](/[A-Za-z]+/)[0x0],_0x9be2e=parseInt(_0x2841c1[_0x506732(0xd7)](/\d+/)[0x0]);_0x18ab1c[_0x400a8d]['level']=_0x4b3c06,_0x18ab1c[_0x400a8d][_0x506732(0x165)]=_0x9be2e;}),_0x102a72[_0x41f1b2(0x150)]((_0x5c508f,_0x385dfb)=>{var _0x4e9ae0=_0x41f1b2;_0x18ab1c[_0x385dfb][_0x4e9ae0(0x12d)]=_0x5c508f;}),_0x30e56f[_0x41f1b2(0x150)]((_0x42d2b5,_0x51b31f)=>{_0x18ab1c[_0x51b31f]['stockBefore']=_0x42d2b5;}),_0x281c9c['forEach']((_0x4ab166,_0x23fc8e)=>{var _0x1c224c=_0x41f1b2;_0x18ab1c[_0x23fc8e][_0x1c224c(0x178)]=_0x4ab166;}),_0x5883a9[_0x41f1b2(0x150)]((_0x5c7d83,_0x1e69b6)=>{var _0x3da96d=_0x41f1b2;_0x18ab1c[_0x1e69b6][_0x3da96d(0x15b)]=_0x5c7d83;}),_0xbb7c07[_0x41f1b2(0x150)]((_0x5d4060,_0x2a0ce4)=>{var _0x492088=_0x41f1b2;_0x18ab1c[_0x2a0ce4][_0x492088(0x14a)]=_0x5d4060;}),_0x595b82[_0x41f1b2(0x150)]((_0x3dd37c,_0x445653)=>{var _0x2e9cda=_0x41f1b2;_0x18ab1c[_0x445653][_0x2e9cda(0xe2)]=_0x3dd37c;}),_0x210093[_0x41f1b2(0x150)]((_0x28b25a,_0x371a57)=>{_0x18ab1c[_0x371a57]['secondary_unit']=_0x28b25a;}),_0x30f5a9[_0x41f1b2(0x150)]((_0x5bb20d,_0x14cc35)=>{var _0x222d75=_0x41f1b2;_0x18ab1c[_0x14cc35][_0x222d75(0x10d)]=_0x5bb20d;}),_0x5da4f9[_0x41f1b2(0x150)]((_0x4bed1c,_0x5e2dd6)=>{var _0xfb0dc8=_0x41f1b2;_0x18ab1c[_0x5e2dd6][_0xfb0dc8(0x140)]=_0x4bed1c;}),_0x44e608[_0x41f1b2(0x150)]((_0x314ec2,_0x3e6c78)=>{var _0x355f07=_0x41f1b2;_0x18ab1c[_0x3e6c78][_0x355f07(0x158)]=_0x314ec2;}),_0x31a8cf[_0x41f1b2(0x150)]((_0x334207,_0x110cca)=>{var _0x59fe4e=_0x41f1b2;_0x18ab1c[_0x110cca][_0x59fe4e(0x162)]=_0x334207;}),_0x1b117a[_0x41f1b2(0x150)]((_0x1add3f,_0x82ef18)=>{var _0x25e0cc=_0x41f1b2;_0x18ab1c[_0x82ef18][_0x25e0cc(0x160)]=_0x1add3f;}),_0x1d48f1[_0x41f1b2(0x150)]((_0xcc6e91,_0x4ad1fe)=>{_0x18ab1c[_0x4ad1fe]['room_names']=_0xcc6e91;}),_0x409d5d[_0x41f1b2(0x150)]((_0x2980ff,_0x4f3d91)=>{var _0x33c068=_0x41f1b2;_0x18ab1c[_0x4f3d91][_0x33c068(0x149)]=_0x2980ff;}),_0x4ad753[_0x41f1b2(0x150)]((_0x3f80a0,_0x2149cb)=>{var _0x3e64ec=_0x41f1b2;_0x18ab1c[_0x2149cb][_0x3e64ec(0x123)]=_0x3f80a0;});const _0x443d83=_0x18ab1c[_0x41f1b2(0x14c)](_0xfcc748=>_0xfcc748['adjust_qty']!=='0'&&_0xfcc748[_0x41f1b2(0x15b)]!=='');var _0x3142d8=0x0;_0x443d83[_0x41f1b2(0x150)](_0x5db80c=>{var _0x5575a8=_0x41f1b2;console[_0x5575a8(0x145)](_0x5575a8(0x132),_0x5db80c),parseInt(_0x5db80c[_0x5575a8(0x15b)])<=0x0&&_0x3142d8++;});if(_0x3142d8!=0x0)return _0x2a049f[_0x41f1b2(0x17e)]('errors',_0x41f1b2(0xeb)),_0x35477c['redirect'](_0x41f1b2(0x104));const _0xc6cf2d=new adjustment_logs();await _0xc6cf2d[_0x41f1b2(0x156)]();const _0x45d4f3=new adjustment_finished({'warehouse_name':_0x44b1d2,'date':_0x2f6970,'product':_0x443d83,'note':_0x1bbbff,'room':_0x4446e0,'invoice':_0x41f1b2(0xe4)+_0xc6cf2d[_0x41f1b2(0x166)][_0x41f1b2(0x105)]()[_0x41f1b2(0xfd)](0x8,'0'),'JO_number':_0x3a9cff,'expiry_date':_0x2ca9c5,'type_of_transaction':_0xf3968b,'PO_number':_0x356aaa,'RequestedBy':_0x3c3ff1,'DateofRequest':_0x58326a,'typeservices':_0x3c27ab,'destination':_0x38d6e4,'deliverydate':_0x3231f1,'driver':_0x303398,'plate':_0x232567,'van':_0x3020e8,'DRSI':_0x4e7a26,'typevehicle':_0xf260d2,'TSU':_0x5f1d55,'TFU':_0x8646f7}),_0x125511=await _0x45d4f3[_0x41f1b2(0x156)]();_0x2a049f[_0x41f1b2(0x17e)](_0x41f1b2(0x177),_0x41f1b2(0x151)),_0x35477c[_0x41f1b2(0xe9)](_0x41f1b2(0xd1)+_0x125511[_0x41f1b2(0x125)]);}catch(_0x3b9a0f){console[_0x41f1b2(0x145)](_0x3b9a0f),_0x35477c['status'](0xc8)[_0x41f1b2(0xec)]({'message':_0x3b9a0f['message']});}}),router[a0_0x29f58b(0x101)](a0_0x29f58b(0xe8),auth,async(_0x2c402c,_0x22cdc9)=>{var _0x2b7eea=a0_0x29f58b;try{const {username:_0x309a01,email:_0x10fd89,role:_0x315a36}=_0x2c402c[_0x2b7eea(0x180)],_0x49c9ab=_0x2c402c[_0x2b7eea(0x180)],_0x53e892=await profile[_0x2b7eea(0x147)]({'email':_0x49c9ab[_0x2b7eea(0x157)]}),_0x2eceb2=await master_shop[_0x2b7eea(0x121)](),_0x36cb00=_0x2c402c['params']['id'],_0x318066=await adjustment_finished[_0x2b7eea(0x124)]({'_id':_0x36cb00}),_0x587b7f=await purchases[_0x2b7eea(0xd3)]([{'$match':{'warehouse_name':_0x318066[_0x2b7eea(0x12f)]}},{'$unwind':_0x2b7eea(0xf9)},{'$group':{'_id':_0x2b7eea(0x13c)}}]);console[_0x2b7eea(0x145)](_0x2b7eea(0x117),_0x587b7f);const _0x1a1553=await product[_0x2b7eea(0x121)]({}),_0x2bfe06=await warehouse[_0x2b7eea(0xd3)]([{'$match':{'name':_0x318066[_0x2b7eea(0x12f)]}},{'$unwind':_0x2b7eea(0x116)},{'$group':{'_id':_0x2b7eea(0xe1),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2b7eea(0x135)},'bay':{'$first':_0x2b7eea(0x139)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2b7eea(0x106)},'floorlevel':{'$first':_0x2b7eea(0x168)},'primary_code':{'$first':_0x2b7eea(0x131)},'secondary_code':{'$first':_0x2b7eea(0xf1)},'product_code':{'$first':_0x2b7eea(0x115)},'storage':{'$first':_0x2b7eea(0x133)},'rack':{'$first':_0x2b7eea(0x122)},'expiry_date':{'$first':_0x2b7eea(0x107)},'production_date':{'$first':_0x2b7eea(0x169)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x2b7eea(0x13a)},'room':{'$first':_0x2b7eea(0xe3)}}}]);if(_0x2eceb2[0x0]['language']==_0x2b7eea(0x153)){var _0x2e26d0=users[_0x2b7eea(0x16b)];console[_0x2b7eea(0x145)](_0x2e26d0);}else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]==_0x2b7eea(0xfe))var _0x2e26d0=users['Hindi'];else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]==_0x2b7eea(0xf4))var _0x2e26d0=users['German'];else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]=='Spanish')var _0x2e26d0=users['Spanish'];else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]==_0x2b7eea(0x16e))var _0x2e26d0=users[_0x2b7eea(0x16e)];else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]==_0x2b7eea(0x136))var _0x2e26d0=users[_0x2b7eea(0xf5)];else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]==_0x2b7eea(0xdd))var _0x2e26d0=users['Chinese'];else{if(_0x2eceb2[0x0][_0x2b7eea(0x10e)]==_0x2b7eea(0x14e))var _0x2e26d0=users['Arabic'];}}}}}}}_0x22cdc9[_0x2b7eea(0x119)](_0x2b7eea(0x120),{'success':_0x2c402c[_0x2b7eea(0x17e)](_0x2b7eea(0x177)),'errors':_0x2c402c[_0x2b7eea(0x17e)]('errors'),'role':_0x49c9ab,'profile':_0x53e892,'adjustment':_0x318066,'stock':_0x2bfe06,'master_shop':_0x2eceb2,'warehouse_name':_0x587b7f,'unit':_0x1a1553,'language':_0x2e26d0});}catch(_0x3522d8){console[_0x2b7eea(0x145)](_0x3522d8),_0x22cdc9['status'](0xc8)['json']({'message':_0x3522d8[_0x2b7eea(0x146)]});}}),router[a0_0x29f58b(0xf2)](a0_0x29f58b(0xe8),auth,async(_0x5c77ea,_0xe5aa89)=>{var _0x4c6877=a0_0x29f58b;try{const {invoice:_0x4825b8,warehouse_name:_0x3e353f,Room_name:_0x27c5cb}=_0x5c77ea[_0x4c6877(0x12a)],_0x117ef0=_0x5c77ea[_0x4c6877(0x13f)]['id'],_0xa5f46a=await adjustment_finished['findById']({'_id':_0x117ef0});var _0x208a8a;const _0x296461=_0xa5f46a['product']['map'](async _0xe1b428=>{var _0x2b7a2f=_0x4c6877;if(_0xe1b428[_0x2b7a2f(0x15b)]>0x0){_0x208a8a=await warehouse['findOne']({'name':_0x3e353f,'room':_0xe1b428[_0x2b7a2f(0xd0)]});const _0x46fe25=_0x208a8a[_0x2b7a2f(0xdc)][_0x2b7a2f(0x118)](_0x24e0bd=>{var _0x5be780=_0x2b7a2f;console['log'](_0xe1b428[_0x5be780(0x178)]);if(_0xe1b428[_0x5be780(0x178)]==_0x5be780(0x11c))_0x24e0bd[_0x5be780(0x125)]==_0xe1b428[_0x5be780(0x12d)]&&(_0x24e0bd[_0x5be780(0xd4)]=_0x24e0bd[_0x5be780(0xd4)]-_0xe1b428[_0x5be780(0x15b)]);else _0xe1b428[_0x5be780(0x178)]==_0x5be780(0xef)&&(_0x24e0bd[_0x5be780(0x125)]==_0xe1b428['id_transaction']&&(_0x24e0bd[_0x5be780(0xd4)]=_0x24e0bd[_0x5be780(0xd4)]+_0xe1b428['adjust_qty']));});}return _0x208a8a;});Promise[_0x4c6877(0x15a)](_0x296461)[_0x4c6877(0x129)](async _0x2d38b1=>{var _0x464380=_0x4c6877;try{for(const _0x38e5d5 of _0x2d38b1){await _0x38e5d5[_0x464380(0x156)]();}_0xa5f46a[_0x464380(0x176)]=_0x464380(0xf3);const _0x21487a=await _0xa5f46a[_0x464380(0x156)](),_0x4df6c3=await master_shop[_0x464380(0x121)](),_0x1f0536=await email_settings[_0x464380(0x147)](),_0x45ff11=await supervisor_settings['find']();var _0x13a143=_0xa5f46a['product'],_0x3ec487='',_0x1207d2;for(_0x1207d2 in _0x13a143){var _0x88e549='FG';_0xa5f46a[_0x464380(0x12f)]==_0x464380(0x142)&&(_0x88e549='DG'),_0x3ec487+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13a143[_0x1207d2][_0x464380(0x10a)]+'</td>'+_0x464380(0x100)+_0x13a143[_0x1207d2][_0x464380(0x10d)]+'</td>'+_0x464380(0x100)+_0x13a143[_0x1207d2][_0x464380(0x15b)]+_0x464380(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13a143[_0x1207d2][_0x464380(0xe2)]+_0x464380(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13a143[_0x1207d2][_0x464380(0xd8)]+_0x464380(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa5f46a[_0x464380(0x12f)]+'</td>'+_0x464380(0x100)+_0x13a143[_0x1207d2][_0x464380(0xd0)]+_0x464380(0x127)+_0x464380(0x100)+_0x88e549+_0x13a143[_0x1207d2]['bay']+_0x464380(0x127)+_0x464380(0x174);}_0x5c77ea[_0x464380(0x17e)](_0x464380(0x177),_0x464380(0x173)),_0xe5aa89[_0x464380(0xe9)](_0x464380(0x113)+_0x21487a['_id']);}catch(_0x18f49f){console[_0x464380(0x155)](_0x18f49f),_0xe5aa89[_0x464380(0xe5)](0x1f4)[_0x464380(0xec)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4c6877(0x138)](_0x370321=>{var _0x29545e=_0x4c6877;console[_0x29545e(0x155)](_0x370321),_0xe5aa89['status'](0x1f4)[_0x29545e(0xec)]({'error':_0x29545e(0xda)});});}catch(_0x47106c){_0xe5aa89[_0x4c6877(0xec)]({'message':_0x47106c[_0x4c6877(0x146)]});}}),router['get'](a0_0x29f58b(0x111),auth,async(_0xa7aab5,_0xe04f07)=>{var _0x1d2f54=a0_0x29f58b;try{const {username:_0x5b2c98,email:_0x232c3d,role:_0x303a22}=_0xa7aab5[_0x1d2f54(0x180)],_0x4588fb=_0xa7aab5[_0x1d2f54(0x180)],_0xe16412=await profile[_0x1d2f54(0x147)]({'email':_0x4588fb[_0x1d2f54(0x157)]}),_0x5ece6a=await master_shop['find']();console['log'](_0x1d2f54(0x130),_0x5ece6a);const _0x5dd256=_0xa7aab5[_0x1d2f54(0x13f)]['id'],_0x896b46=await adjustment_finished['findById']({'_id':_0x5dd256});let _0x4ce429=new Date(_0x896b46['expiry_date']),_0x6892af=('0'+_0x4ce429[_0x1d2f54(0xf7)]())['slice'](-0x2),_0x27ea2e=('0'+(_0x4ce429[_0x1d2f54(0x172)]()+0x1))['slice'](-0x2),_0x4dd7d4=_0x4ce429[_0x1d2f54(0x141)](),_0x3f5426=_0x4dd7d4+'-'+_0x27ea2e+'-'+_0x6892af;var _0x5ae3dd=['Ambient',_0x1d2f54(0x16f),_0x1d2f54(0xe6)];const _0x2328c6=await purchases[_0x1d2f54(0xd3)]([{'$match':{'warehouse_name':_0x896b46[_0x1d2f54(0x12f)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x1d2f54(0x145)](_0x1d2f54(0x117),_0x2328c6);const _0x3f2271=await product[_0x1d2f54(0x121)]({}),_0x242990=await warehouse[_0x1d2f54(0xd3)]([{'$match':{'name':_0x896b46[_0x1d2f54(0x12f)],'room':_0x896b46[_0x1d2f54(0xd9)]}},{'$unwind':_0x1d2f54(0x116)},{'$group':{'_id':_0x1d2f54(0xe1),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1d2f54(0x139)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1d2f54(0x106)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1d2f54(0x131)},'secondary_code':{'$first':_0x1d2f54(0xf1)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1d2f54(0x133)},'rack':{'$first':_0x1d2f54(0x122)}}}]);if(_0x5ece6a[0x0]['language']==_0x1d2f54(0x153)){var _0x4bf07d=users[_0x1d2f54(0x16b)];console[_0x1d2f54(0x145)](_0x4bf07d);}else{if(_0x5ece6a[0x0][_0x1d2f54(0x10e)]==_0x1d2f54(0xfe))var _0x4bf07d=users[_0x1d2f54(0xfe)];else{if(_0x5ece6a[0x0]['language']==_0x1d2f54(0xf4))var _0x4bf07d=users[_0x1d2f54(0xf4)];else{if(_0x5ece6a[0x0]['language']==_0x1d2f54(0x15d))var _0x4bf07d=users['Spanish'];else{if(_0x5ece6a[0x0][_0x1d2f54(0x10e)]==_0x1d2f54(0x16e))var _0x4bf07d=users[_0x1d2f54(0x16e)];else{if(_0x5ece6a[0x0][_0x1d2f54(0x10e)]==_0x1d2f54(0x136))var _0x4bf07d=users['Portuguese'];else{if(_0x5ece6a[0x0][_0x1d2f54(0x10e)]==_0x1d2f54(0xdd))var _0x4bf07d=users[_0x1d2f54(0xdd)];else{if(_0x5ece6a[0x0][_0x1d2f54(0x10e)]==_0x1d2f54(0x14e))var _0x4bf07d=users[_0x1d2f54(0x161)];}}}}}}}_0xe04f07[_0x1d2f54(0x119)](_0x1d2f54(0xff),{'success':_0xa7aab5[_0x1d2f54(0x17e)](_0x1d2f54(0x177)),'errors':_0xa7aab5[_0x1d2f54(0x17e)](_0x1d2f54(0x126)),'role':_0x4588fb,'profile':_0xe16412,'adjustment':_0x896b46,'stock':_0x242990,'master_shop':_0x5ece6a,'warehouse_name':_0x2328c6,'unit':_0x3f2271,'language':_0x4bf07d,'rooms_data':_0x5ae3dd,'ed_fullDate':_0x3f5426});}catch(_0x320bae){console['log'](_0x320bae),_0xe04f07['status'](0xc8)[_0x1d2f54(0xec)]({'message':_0x320bae[_0x1d2f54(0x146)]});}}),router[a0_0x29f58b(0xf2)](a0_0x29f58b(0x111),auth,async(_0x2501d2,_0x1e8bdc)=>{var _0x422666=a0_0x29f58b;try{const _0x1833b5=_0x2501d2[_0x422666(0x13f)]['id'],_0x5cccc4=await adjustment_finished[_0x422666(0x124)]({'_id':_0x1833b5}),_0x291237=await warehouse['findOne']({'name':_0x5cccc4[_0x422666(0x12f)],'room':_0x5cccc4['room']}),{warehouse_name:_0x13fa0a,date:_0x52c185,prod_name:_0x143874,level:_0x25ae76,isle:_0x3b2556,pallet:_0x1bf784,stock:_0x46ce5c,types:_0x4c2aa7,adjust_qty:_0x52c321,new_adjust_qty:_0x5205c2,note:_0x3d28ce,Room_name:_0x6bd57d,invoice:_0x44d3d0,JO_number:_0x5e891a}=_0x2501d2[_0x422666(0x12a)];if(typeof _0x143874==_0x422666(0x12e))var _0x2025da=[_0x2501d2['body'][_0x422666(0x110)]],_0x5a5aea=[_0x2501d2['body'][_0x422666(0x11d)]],_0x16a842=[_0x2501d2[_0x422666(0x12a)][_0x422666(0x11e)]],_0xf61dec=[_0x2501d2[_0x422666(0x12a)][_0x422666(0x178)]],_0x3999cc=[_0x2501d2[_0x422666(0x12a)][_0x422666(0x15b)]],_0x56b267=[_0x2501d2[_0x422666(0x12a)]['new_adjust_qty']],_0x1fc1ce=[_0x2501d2[_0x422666(0x12a)][_0x422666(0x143)]],_0x2dc2c5=[_0x2501d2[_0x422666(0x12a)]['unit']],_0x5c45d9=[_0x2501d2['body']['Secondary_units']],_0x45c4ae=[_0x2501d2[_0x422666(0x12a)][_0x422666(0x140)]],_0x154691=[_0x2501d2[_0x422666(0x12a)][_0x422666(0x158)]];else var _0x2025da=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0x110)]],_0x5a5aea=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0x11d)]],_0x16a842=[..._0x2501d2['body'][_0x422666(0x11e)]],_0xf61dec=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0x178)]],_0x3999cc=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0x15b)]],_0x56b267=[..._0x2501d2['body'][_0x422666(0x14a)]],_0x1fc1ce=[..._0x2501d2['body'][_0x422666(0x143)]],_0x2dc2c5=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0xe2)]],_0x5c45d9=[..._0x2501d2[_0x422666(0x12a)]['Secondary_units']],_0x45c4ae=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0x140)]],_0x154691=[..._0x2501d2[_0x422666(0x12a)][_0x422666(0x158)]];const _0x2e133a=_0x2025da[_0x422666(0x118)](_0x3bf2ef=>{return _0x3bf2ef={'product_name':_0x3bf2ef};});_0x5a5aea[_0x422666(0x150)]((_0x59d80f,_0x471339)=>{_0x2e133a[_0x471339]['bay']=_0x59d80f;}),_0x16a842[_0x422666(0x150)]((_0x2849ac,_0x35a1d7)=>{var _0x1cf6f9=_0x422666;_0x2e133a[_0x35a1d7][_0x1cf6f9(0xd6)]=_0x2849ac;}),_0xf61dec[_0x422666(0x150)]((_0x1c222b,_0x4ea5da)=>{_0x2e133a[_0x4ea5da]['types']=_0x1c222b;}),_0x3999cc['forEach']((_0x18d340,_0x176fc3)=>{var _0x549a27=_0x422666;_0x2e133a[_0x176fc3][_0x549a27(0x15b)]=_0x18d340;}),_0x56b267[_0x422666(0x150)]((_0x27ccfc,_0xfccb32)=>{var _0x480236=_0x422666;_0x2e133a[_0xfccb32][_0x480236(0x14a)]=_0x27ccfc;}),_0x2dc2c5[_0x422666(0x150)]((_0x4341f3,_0x1d90b3)=>{var _0x581a2d=_0x422666;_0x2e133a[_0x1d90b3][_0x581a2d(0xe2)]=_0x4341f3;}),_0x5c45d9['forEach']((_0x2ec25b,_0x5268c7)=>{var _0x57bd35=_0x422666;_0x2e133a[_0x5268c7][_0x57bd35(0xd8)]=_0x2ec25b;}),_0x1fc1ce[_0x422666(0x150)]((_0x236a4d,_0x413c52)=>{var _0x5ec051=_0x422666;_0x2e133a[_0x413c52][_0x5ec051(0x10d)]=_0x236a4d;}),_0x45c4ae[_0x422666(0x150)]((_0x5d74c4,_0x534b60)=>{var _0x98cb4a=_0x422666;_0x2e133a[_0x534b60][_0x98cb4a(0x140)]=_0x5d74c4;}),_0x154691[_0x422666(0x150)]((_0x3b017d,_0x3e9e4c)=>{var _0x58eb97=_0x422666;_0x2e133a[_0x3e9e4c][_0x58eb97(0x158)]=_0x3b017d;});const _0x2f3f96=_0x2e133a[_0x422666(0x14c)](_0xd24c04=>_0xd24c04[_0x422666(0x15b)]!=='0'&&_0xd24c04['adjust_qty']!=='');var _0x1f68e0=0x0;_0x2f3f96['forEach'](_0x38e83e=>{var _0x1b05b8=_0x422666;console[_0x1b05b8(0x145)](_0x1b05b8(0x132),_0x38e83e),parseInt(_0x38e83e['adjust_qty'])<=0x0&&_0x1f68e0++;});if(_0x1f68e0!=0x0)return _0x2501d2[_0x422666(0x17e)](_0x422666(0x126),_0x422666(0xeb)),_0x1e8bdc[_0x422666(0xe9)](_0x422666(0x104));_0x5cccc4[_0x422666(0x12f)]=_0x13fa0a,_0x5cccc4[_0x422666(0x167)]=_0x52c185,_0x5cccc4[_0x422666(0x170)]=_0x2f3f96,_0x5cccc4['note']=_0x3d28ce,_0x5cccc4['room']=_0x6bd57d,_0x5cccc4[_0x422666(0x123)]=_0x44d3d0,_0x5cccc4[_0x422666(0x14d)]=_0x5e891a;const _0x39dc3d=await _0x5cccc4[_0x422666(0x156)](),_0x2cfc28=await warehouse[_0x422666(0x147)]({'name':_0x13fa0a,'room':_0x6bd57d});_0x39dc3d[_0x422666(0x170)][_0x422666(0x150)](_0x356643=>{var _0x3c96bf=_0x422666;const _0x38a3b1=_0x2cfc28[_0x3c96bf(0xdc)]['map'](_0xcb814=>{var _0x181231=_0x3c96bf;_0x356643[_0x181231(0x178)]==_0x181231(0x11c)?_0xcb814[_0x181231(0x10a)]==_0x356643[_0x181231(0x10a)]&&_0xcb814[_0x181231(0x165)]==_0x356643[_0x181231(0x165)]&&(_0xcb814['product_stock']=parseInt(_0xcb814[_0x181231(0xd4)])-parseInt(_0x356643[_0x181231(0x15b)])):_0xcb814['product_name']==_0x356643[_0x181231(0x10a)]&&_0xcb814['bay']==_0x356643['bay']&&(_0xcb814[_0x181231(0xd4)]=parseInt(_0xcb814[_0x181231(0xd4)])+parseInt(_0x356643[_0x181231(0x15b)]));});}),await _0x2cfc28['save'](),_0x2501d2[_0x422666(0x17e)](_0x422666(0x177),_0x422666(0xe0)),_0x1e8bdc[_0x422666(0xe9)](_0x422666(0x144));}catch(_0x5e9ae1){console[_0x422666(0x145)](_0x5e9ae1);}}),router['post'](a0_0x29f58b(0xea),async(_0x2c4be2,_0x152840)=>{var _0x3efe1e=a0_0x29f58b;const {primary_code:_0x224f08,warehouse_data:_0xd4e3b5,rooms_data:_0x3de914,Roomslist:_0x2f4a36}=_0x2c4be2[_0x3efe1e(0x12a)],_0x38bd00=_0x2f4a36[_0x3efe1e(0xfb)](','),_0x1ae84f=[];async function _0x554b3b(_0x2a17b4){var _0x1d6de0=_0x3efe1e;const _0x4925a9=await warehouse[_0x1d6de0(0xd3)]([{'$match':{'name':_0xd4e3b5,'room':_0x2a17b4}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x224f08}},{'$group':{'_id':_0x1d6de0(0xe1),'name':{'$first':_0x1d6de0(0xd2)},'product_stock':{'$first':_0x1d6de0(0x135)},'primary_code':{'$first':_0x1d6de0(0x131)},'secondary_code':{'$first':_0x1d6de0(0xf1)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1d6de0(0x128)},'bay':{'$first':_0x1d6de0(0x139)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1d6de0(0x13b)},'secondary_unit':{'$first':_0x1d6de0(0x102)},'storage':{'$first':_0x1d6de0(0x133)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1d6de0(0x107)},'production_date':{'$first':_0x1d6de0(0x169)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x1d6de0(0x13a)},'roomNamed':{'$first':_0x1d6de0(0xe3)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2ab06b=await warehouse[_0x1d6de0(0xd3)]([{'$match':{'name':_0xd4e3b5,'room':_0x2a17b4}},{'$unwind':_0x1d6de0(0x116)},{'$match':{'product_details.secondary_code':_0x224f08}},{'$group':{'_id':_0x1d6de0(0xe1),'name':{'$first':_0x1d6de0(0xd2)},'product_stock':{'$first':_0x1d6de0(0x135)},'primary_code':{'$first':_0x1d6de0(0x131)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1d6de0(0x128)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x1d6de0(0x106)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1d6de0(0x13b)},'secondary_unit':{'$first':_0x1d6de0(0x102)},'storage':{'$first':_0x1d6de0(0x133)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1d6de0(0x107)},'production_date':{'$first':_0x1d6de0(0x169)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x1d6de0(0x13a)},'roomNamed':{'$first':_0x1d6de0(0xe3)},'invoice':{'$first':_0x1d6de0(0x164)}}}]);if(_0x4925a9[_0x1d6de0(0x17a)]>0x0)_0x1ae84f[_0x1d6de0(0x109)](_0x4925a9);else _0x2ab06b[_0x1d6de0(0x17a)]>0x0&&_0x1ae84f[_0x1d6de0(0x109)](_0x2ab06b);}const _0x49e05d=_0x38bd00[_0x3efe1e(0x118)](_0x5e2429=>_0x554b3b(_0x5e2429));await Promise[_0x3efe1e(0x15a)](_0x49e05d),_0x152840['json'](_0x1ae84f);}),router[a0_0x29f58b(0xf2)]('/CheckingWarehouse',async(_0x2ef829,_0x3960f5)=>{var _0x2b58b3=a0_0x29f58b;const {productCode:_0x1a8b3b,bay:_0x25e98d,warehouses:_0x875908,room:_0x484ac8}=_0x2ef829[_0x2b58b3(0x12a)];console['log'](_0x2ef829['body']);try{const _0x2dac8c=await warehouse[_0x2b58b3(0xd3)]([{'$match':{'name':_0x875908,'room':_0x484ac8}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x25e98d)}},{'$group':{'_id':_0x2b58b3(0xe1),'name':{'$first':_0x2b58b3(0xd2)},'product_stock':{'$first':_0x2b58b3(0x135)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3960f5['status'](0xc8)[_0x2b58b3(0xec)](_0x2dac8c);}catch(_0x707cbe){_0x3960f5['status'](0x194)[_0x2b58b3(0xec)]({'message':_0x707cbe[_0x2b58b3(0x146)]});}}),module[a0_0x29f58b(0xfa)]=router;