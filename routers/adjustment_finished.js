var a0_0x1951f2=a0_0x5a24;(function(_0x45d75a,_0x5e108f){var _0x462f05=a0_0x5a24,_0x52e147=_0x45d75a();while(!![]){try{var _0x553d0f=parseInt(_0x462f05(0x193))/0x1+parseInt(_0x462f05(0x213))/0x2+parseInt(_0x462f05(0x21e))/0x3+-parseInt(_0x462f05(0x1da))/0x4*(parseInt(_0x462f05(0x1f9))/0x5)+parseInt(_0x462f05(0x1b4))/0x6*(parseInt(_0x462f05(0x1fa))/0x7)+-parseInt(_0x462f05(0x219))/0x8+parseInt(_0x462f05(0x224))/0x9;if(_0x553d0f===_0x5e108f)break;else _0x52e147['push'](_0x52e147['shift']());}catch(_0x55f167){_0x52e147['push'](_0x52e147['shift']());}}}(a0_0xdd40,0xb4b8c));const express=require('express'),app=express(),router=express[a0_0x1951f2(0x1cd)](),auth=require(a0_0x1951f2(0x1c5)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x1951f2(0x226)),users=require(a0_0x1951f2(0x1b2)),nodemailer=require(a0_0x1951f2(0x19e));function a0_0x5a24(_0x53f15c,_0x30b21d){var _0xdd40e1=a0_0xdd40();return a0_0x5a24=function(_0x5a2447,_0x581055){_0x5a2447=_0x5a2447-0x18b;var _0x2da99b=_0xdd40e1[_0x5a2447];return _0x2da99b;},a0_0x5a24(_0x53f15c,_0x30b21d);}router[a0_0x1951f2(0x195)](a0_0x1951f2(0x20e),auth,async(_0x2e7d4b,_0x2d222a)=>{var _0x162e19=a0_0x1951f2;try{const {username:_0x4df787,email:_0x112f68,role:_0x46795a}=_0x2e7d4b[_0x162e19(0x18b)],_0x32437f=_0x2e7d4b[_0x162e19(0x18b)],_0x1d768a=await profile[_0x162e19(0x223)]({'email':_0x32437f['email']}),_0x56d090=await master_shop[_0x162e19(0x20d)]();let _0x2fee28;if(_0x32437f['role']=='staff'){const _0x17f018=await staff['findOne']({'email':_0x32437f[_0x162e19(0x205)]});_0x2fee28=await warehouse[_0x162e19(0x20d)]({'status':_0x162e19(0x1b1),'name':_0x17f018[_0x162e19(0x218)]});}else _0x2fee28=await warehouse[_0x162e19(0x20d)]({'status':_0x162e19(0x1b1)});const _0x4af5c0=await product['find']();let _0x3fb89b;if(_0x32437f[_0x162e19(0x200)]==_0x162e19(0x1f0)){const _0x11dc20=await staff[_0x162e19(0x223)]({'email':_0x32437f[_0x162e19(0x205)]});_0x3fb89b=await adjustment_finished[_0x162e19(0x20d)]({'warehouse_name':_0x11dc20[_0x162e19(0x218)]});}else _0x3fb89b=await adjustment_finished[_0x162e19(0x18d)]([{'$match':{'type_of_transaction':_0x162e19(0x21a)}},{'$unwind':_0x162e19(0x222)},{'$group':{'_id':_0x162e19(0x21d),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x162e19(0x1b7)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x56d090[0x0][_0x162e19(0x1ff)]=='English\x20(US)'){var _0x57e762=users[_0x162e19(0x1d5)];console[_0x162e19(0x1c2)](_0x57e762);}else{if(_0x56d090[0x0][_0x162e19(0x1ff)]=='Hindi')var _0x57e762=users['Hindi'];else{if(_0x56d090[0x0][_0x162e19(0x1ff)]=='German')var _0x57e762=users[_0x162e19(0x1aa)];else{if(_0x56d090[0x0]['language']==_0x162e19(0x237))var _0x57e762=users[_0x162e19(0x237)];else{if(_0x56d090[0x0][_0x162e19(0x1ff)]==_0x162e19(0x196))var _0x57e762=users[_0x162e19(0x196)];else{if(_0x56d090[0x0]['language']=='Portuguese\x20(BR)')var _0x57e762=users[_0x162e19(0x1eb)];else{if(_0x56d090[0x0]['language']=='Chinese')var _0x57e762=users[_0x162e19(0x1bb)];else{if(_0x56d090[0x0][_0x162e19(0x1ff)]==_0x162e19(0x1ea))var _0x57e762=users[_0x162e19(0x1f5)];}}}}}}}_0x2d222a['render']('adjustment_finished',{'success':_0x2e7d4b['flash'](_0x162e19(0x1f8)),'errors':_0x2e7d4b[_0x162e19(0x1e1)](_0x162e19(0x1b6)),'role':_0x32437f,'profile':_0x1d768a,'warehouse':_0x2fee28,'product':_0x4af5c0,'adjustment':_0x3fb89b,'master_shop':_0x56d090,'language':_0x57e762});}catch(_0x5a2cf9){console[_0x162e19(0x1c2)](_0x5a2cf9);}}),router['get']('/view_logs',auth,async(_0x457f84,_0x410975)=>{var _0x199775=a0_0x1951f2;try{const {username:_0x5d8ef9,email:_0x2af784,role:_0x2190e6}=_0x457f84['user'],_0x52de05=_0x457f84[_0x199775(0x18b)],_0x3a9ff0=await profile[_0x199775(0x223)]({'email':_0x52de05[_0x199775(0x205)]}),_0x83f259=await master_shop[_0x199775(0x20d)]();let _0x8cc3e5;if(_0x52de05[_0x199775(0x200)]==_0x199775(0x1f0)){const _0x231748=await staff[_0x199775(0x223)]({'email':_0x52de05[_0x199775(0x205)]});_0x8cc3e5=await warehouse['find']({'status':_0x199775(0x1b1),'name':_0x231748[_0x199775(0x218)]});}else _0x8cc3e5=await warehouse[_0x199775(0x20d)]({'status':_0x199775(0x1b1)});const _0x1f883e=await product[_0x199775(0x20d)]();let _0x2da9c3;if(_0x52de05[_0x199775(0x200)]=='staff'){const _0x32692f=await staff[_0x199775(0x223)]({'email':_0x52de05['email']});_0x2da9c3=await adjustment_finished['find']({'warehouse_name':_0x32692f[_0x199775(0x218)]});}else _0x2da9c3=await adjustment_finished[_0x199775(0x18d)]([{'$match':{'type_of_transaction':'logs'}},{'$unwind':_0x199775(0x222)},{'$group':{'_id':'$_id','invoice':{'$first':_0x199775(0x22e)},'date':{'$first':_0x199775(0x192)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x199775(0x1b7)},'finalize':{'$first':_0x199775(0x1ec)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x1e7))var _0x2c7887=users[_0x199775(0x1d5)];else{if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x1b9))var _0x2c7887=users['Hindi'];else{if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x1aa))var _0x2c7887=users[_0x199775(0x1aa)];else{if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x237))var _0x2c7887=users[_0x199775(0x237)];else{if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x196))var _0x2c7887=users[_0x199775(0x196)];else{if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x1e2))var _0x2c7887=users[_0x199775(0x1eb)];else{if(_0x83f259[0x0][_0x199775(0x1ff)]=='Chinese')var _0x2c7887=users['Chinese'];else{if(_0x83f259[0x0][_0x199775(0x1ff)]==_0x199775(0x1ea))var _0x2c7887=users[_0x199775(0x1f5)];}}}}}}}_0x410975['render'](_0x199775(0x191),{'success':_0x457f84['flash']('success'),'errors':_0x457f84[_0x199775(0x1e1)](_0x199775(0x1b6)),'role':_0x52de05,'profile':_0x3a9ff0,'warehouse':_0x8cc3e5,'product':_0x1f883e,'adjustment':_0x2da9c3,'master_shop':_0x83f259,'language':_0x2c7887});}catch(_0x264154){console['log'](_0x264154);}});async function getRandom8DigitNumber(){var _0x2590c7=a0_0x1951f2;const _0x410f3a=0x989680,_0x464f0e=0x5f5e0ff,_0x351324=Math[_0x2590c7(0x199)](Math[_0x2590c7(0x238)]()*(_0x464f0e-_0x410f3a+0x1))+_0x410f3a;var _0x3a524c;const _0x5cc0e0=await adjustment_finished[_0x2590c7(0x223)]({'invoice':_0x2590c7(0x1d9)+_0x351324});return _0x5cc0e0&&_0x5cc0e0[_0x2590c7(0x1d2)]>0x0?_0x3a524c=_0x2590c7(0x1d9)+_0x351324:_0x3a524c=_0x2590c7(0x1d9)+_0x351324,_0x3a524c;}function a0_0xdd40(){var _0x8083e1=['invoice_init','$product_details.level','warehouse','8156408wMLiBA','own','secondary_unit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$_id','938208UzmDny','add','$product_details.production_date','add_adjustment_finished_logs','$product','findOne','16436430XvfNnW','adjust_qty','../models/all_models','json','stock','An\x20error\x20occurred\x20while\x20saving\x20data.','$product.product_name','forEach','prod_code','body','$invoice','params','production_date','warehouse_name','finalize','padStart','LOG-ADJ-','filter','save','Spanish','random','$name','user','product_code','aggregate','True','getMonth','types','adjustment_finished_logs','$date','126511SQaDTM','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','French','/preview/:id','/CheckingWarehouse','floor','$product_details.type','$product_details.secondary_unit','catch','match','nodemailer','add_adjustment_finished','$product_details.bin','$product_details.floorlevel','/view/add_adjustment_logs','$product_details.expiry_date','_id','bay','product_details','$product_details.rack','prod_name','purchases_data','German','then','/view/add_adjustment','string','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','New_Qty_Converted','render','Enabled','../public/language/languages.json','/view/:id','591960nAvEnP','invoice','errors','$product.room_names','maxPerUnit','Hindi','expiry_date','Chinese','product_stock','foreach\x20newproduct','slice','post','adjustment\x20data\x20update\x20successfully','unit','log','/adjustment/view','$product_details.maxPerUnit','../middleware/auth','date','$product_details.unit','Secondary_units','product','back','level','Enclosed','Router','$product_details.product_code','toString','map','/adjustment_finished/view','length','An\x20error\x20occurred.','new_adjust_qty','English','$product_details.product_stock','exports','Rooms','ADJF-','8AribIj','$room','room_names','<tr>','product_name','$product_details.primary_code','$product_details.invoice','flash','Portuguese\x20(BR)','$product_details','message','master','redirect','English\x20(US)','id_transaction','/picking_list/PDF_adjustmentFinal/','Arabic\x20(ae)','Portuguese','$finalize','stockBefore','product_date','$product_details.storage','staff','Ambient','ADJ-','prod_invoice','</td>','Arabic','batch_code','$product_details.secondary_code','success','2007170AlyPJZ','21zOnabJ','$product_details._id','New_Qty_Converted_adj','Primary_Units','JO_number','language','role','error','adjustment\x20add\x20successfull','$product_details.product_name','status','email','$product_details.batch_code','findById','id_transaction_from','getFullYear','Adjustment\x20Finalize\x20Successfully','prod_cat','room','find','/view','all','$product_details.bay','/adjustment_finished/preview/','Return\x20Rooms','2316bknzPF','</tr>','minus'];a0_0xdd40=function(){return _0x8083e1;};return a0_0xdd40();}router['get']('/view/add_adjustment',auth,async(_0xe9bb0f,_0x25aa13)=>{var _0x5717be=a0_0x1951f2;try{const {username:_0x5f3d6c,email:_0xc68e,role:_0x3be0b7}=_0xe9bb0f[_0x5717be(0x18b)],_0x1599d0=_0xe9bb0f[_0x5717be(0x18b)],_0x1026f1=await profile[_0x5717be(0x223)]({'email':_0x1599d0[_0x5717be(0x205)]}),_0x399c1b=await master_shop[_0x5717be(0x20d)]();let _0x196cfc;if(_0x1599d0[_0x5717be(0x200)]==_0x5717be(0x1f0)){const _0x1e3d2d=await staff[_0x5717be(0x223)]({'email':_0x1599d0[_0x5717be(0x205)]});_0x196cfc=await warehouse[_0x5717be(0x18d)]([{'$match':{'status':_0x5717be(0x1b1),'name':_0x1e3d2d[_0x5717be(0x218)]}},{'$group':{'_id':_0x5717be(0x239),'name':{'$first':_0x5717be(0x239)}}}]);}else _0x196cfc=await warehouse['aggregate']([{'$match':{'status':_0x5717be(0x1b1)}},{'$group':{'_id':_0x5717be(0x239),'name':{'$first':'$name'}}}]);const _0x563b37=await product[_0x5717be(0x20d)]({}),_0x51c9c6=await adjustment_finished[_0x5717be(0x20d)](),_0x321ccf=_0x51c9c6[_0x5717be(0x1d2)]+0x1,_0x35b5a1='ADJF-'+_0x321ccf[_0x5717be(0x1cf)]()['padStart'](0x5,'0');var _0x15af1c=[_0x5717be(0x1f1),_0x5717be(0x1cc),'Return\x20Rooms'];if(_0x399c1b[0x0][_0x5717be(0x1ff)]==_0x5717be(0x1e7))var _0x3c1a08=users['English'];else{if(_0x399c1b[0x0][_0x5717be(0x1ff)]==_0x5717be(0x1b9))var _0x3c1a08=users[_0x5717be(0x1b9)];else{if(_0x399c1b[0x0]['language']==_0x5717be(0x1aa))var _0x3c1a08=users[_0x5717be(0x1aa)];else{if(_0x399c1b[0x0][_0x5717be(0x1ff)]==_0x5717be(0x237))var _0x3c1a08=users[_0x5717be(0x237)];else{if(_0x399c1b[0x0][_0x5717be(0x1ff)]==_0x5717be(0x196))var _0x3c1a08=users[_0x5717be(0x196)];else{if(_0x399c1b[0x0]['language']==_0x5717be(0x1e2))var _0x3c1a08=users[_0x5717be(0x1eb)];else{if(_0x399c1b[0x0]['language']==_0x5717be(0x1bb))var _0x3c1a08=users['Chinese'];else{if(_0x399c1b[0x0][_0x5717be(0x1ff)]=='Arabic\x20(ae)')var _0x3c1a08=users[_0x5717be(0x1f5)];}}}}}}}const _0x433764=getRandom8DigitNumber();_0x433764[_0x5717be(0x1ab)](_0x25d868=>{var _0x30b534=_0x5717be;_0x25aa13['render'](_0x30b534(0x19f),{'success':_0xe9bb0f[_0x30b534(0x1e1)](_0x30b534(0x1f8)),'errors':_0xe9bb0f[_0x30b534(0x1e1)](_0x30b534(0x1b6)),'role':_0x1599d0,'profile':_0x1026f1,'warehouse':_0x196cfc,'product':_0x563b37,'master_shop':_0x399c1b,'language':_0x3c1a08,'rooms_data':_0x15af1c,'invoice_no':_0x25d868});})['catch'](_0x512276=>{var _0x13185a=_0x5717be;_0xe9bb0f['flash']('errors',_0x13185a(0x21c)),_0x25aa13[_0x13185a(0x1e6)](_0x13185a(0x1c3));});}catch(_0xc316b2){console['log'](_0xc316b2);}}),router[a0_0x1951f2(0x1bf)](a0_0x1951f2(0x1ac),auth,async(_0x45701d,_0x44da94)=>{var _0x341d81=a0_0x1951f2;try{const {warehouse_name:_0x3b2517,date:_0x94d95,prod_name:_0x281fee,level:_0x4a2ee5,isle:_0x48a611,pallet:_0x2a74ab,stock:_0x358f3e,types:_0xd5e6d4,adjust_qty:_0x54d391,new_adjust_qty:_0x47356f,note:_0x2cda74,Room_name:_0x4ed024,JO_number:_0x237907,expiry_date:_0x277bc2,PO_number:_0x512ae2,ReqBy:_0x1f3894,dateofreq:_0x449b78,typeservicesData:_0x1f65f8,destination:_0x47e6b2,deliverydate:_0x40345d,driver:_0x2b4985,plate:_0x51a881,van:_0x2590f8,DRSI:_0x1d9a91,typevehicle:_0x19285d,TSU:_0x1e091e,TFU:_0x120c1e}=_0x45701d[_0x341d81(0x22d)];if(typeof _0x281fee==_0x341d81(0x1ad))var _0x4a0de8=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1a8)]],_0xdffe2=[_0x45701d['body'][_0x341d81(0x1cb)]],_0x95c058=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x228)]],_0x38b00f=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x190)]],_0x3a24f1=[_0x45701d[_0x341d81(0x22d)]['New_Qty_Converted_adj']],_0x2fd7b3=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1af)]],_0x16a105=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1fd)]],_0x3c0b0c=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1c8)]],_0x534b97=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x22c)]],_0x4a89d6=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1f6)]],_0x3daf2d=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1ba)]],_0x55a765=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1ee)]],_0x2ca715=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x20b)]],_0x53603e=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1d8)]],_0x2ceba6=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1b8)]],_0x39856c=[_0x45701d[_0x341d81(0x22d)][_0x341d81(0x1f3)]],_0x563063=[_0x45701d['body'][_0x341d81(0x208)]];else var _0x4a0de8=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x1a8)]],_0xdffe2=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x1cb)]],_0x95c058=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x228)]],_0x38b00f=[..._0x45701d['body'][_0x341d81(0x190)]],_0x3a24f1=[..._0x45701d['body'][_0x341d81(0x1fc)]],_0x2fd7b3=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x1af)]],_0x16a105=[..._0x45701d[_0x341d81(0x22d)]['Primary_Units']],_0x3c0b0c=[..._0x45701d['body'][_0x341d81(0x1c8)]],_0x534b97=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x22c)]],_0x4a89d6=[..._0x45701d['body'][_0x341d81(0x1f6)]],_0x3daf2d=[..._0x45701d['body'][_0x341d81(0x1ba)]],_0x55a765=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x1ee)]],_0x2ca715=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x20b)]],_0x53603e=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x1d8)]],_0x2ceba6=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x1b8)]],_0x39856c=[..._0x45701d[_0x341d81(0x22d)]['prod_invoice']],_0x563063=[..._0x45701d[_0x341d81(0x22d)][_0x341d81(0x208)]];const _0x4ac2d5=_0x4a0de8[_0x341d81(0x1d0)](_0x5ecab8=>{return _0x5ecab8={'product_name':_0x5ecab8};});_0xdffe2[_0x341d81(0x22b)]((_0x750a6f,_0x5004c6)=>{var _0x3ce5ce=_0x341d81,_0x221250=_0x750a6f[_0x3ce5ce(0x19d)](/[A-Za-z]+/)[0x0],_0x2bc909=parseInt(_0x750a6f[_0x3ce5ce(0x19d)](/\d+/)[0x0]);_0x4ac2d5[_0x5004c6][_0x3ce5ce(0x1cb)]=_0x221250,_0x4ac2d5[_0x5004c6][_0x3ce5ce(0x1a5)]=_0x2bc909;}),_0x563063['forEach']((_0x4ca9a4,_0x370290)=>{var _0x331d00=_0x341d81;_0x4ac2d5[_0x370290][_0x331d00(0x1e8)]=_0x4ca9a4;}),_0x95c058['forEach']((_0x791595,_0x493d01)=>{_0x4ac2d5[_0x493d01]['stockBefore']=_0x791595;}),_0x38b00f['forEach']((_0x2c4753,_0xe027db)=>{var _0x5d53db=_0x341d81;_0x4ac2d5[_0xe027db][_0x5d53db(0x190)]=_0x2c4753;}),_0x3a24f1['forEach']((_0x3b505e,_0xb14132)=>{_0x4ac2d5[_0xb14132]['adjust_qty']=_0x3b505e;}),_0x2fd7b3['forEach']((_0x456da2,_0x4eab7a)=>{var _0x15872b=_0x341d81;_0x4ac2d5[_0x4eab7a][_0x15872b(0x1d4)]=_0x456da2;}),_0x16a105[_0x341d81(0x22b)]((_0x55d8c4,_0x54c73f)=>{var _0x353599=_0x341d81;_0x4ac2d5[_0x54c73f][_0x353599(0x1c1)]=_0x55d8c4;}),_0x3c0b0c[_0x341d81(0x22b)]((_0xeb2d6e,_0x540235)=>{var _0x20bfcf=_0x341d81;_0x4ac2d5[_0x540235][_0x20bfcf(0x21b)]=_0xeb2d6e;}),_0x534b97[_0x341d81(0x22b)]((_0x19c86e,_0x4ec87d)=>{_0x4ac2d5[_0x4ec87d]['product_code']=_0x19c86e;}),_0x4a89d6['forEach']((_0x5bf824,_0x1ca319)=>{var _0x617b97=_0x341d81;_0x4ac2d5[_0x1ca319][_0x617b97(0x1f6)]=_0x5bf824;}),_0x3daf2d[_0x341d81(0x22b)]((_0x5affc8,_0x417bb5)=>{_0x4ac2d5[_0x417bb5]['expiry_date']=_0x5affc8;}),_0x55a765[_0x341d81(0x22b)]((_0x52dc44,_0x356c60)=>{_0x4ac2d5[_0x356c60]['production_date']=_0x52dc44;}),_0x2ca715[_0x341d81(0x22b)]((_0x4efecd,_0x30d417)=>{var _0xa4f61b=_0x341d81;_0x4ac2d5[_0x30d417][_0xa4f61b(0x20b)]=_0x4efecd;}),_0x53603e['forEach']((_0x338b23,_0x1df444)=>{var _0x5cff4a=_0x341d81;_0x4ac2d5[_0x1df444][_0x5cff4a(0x1dc)]=_0x338b23;}),_0x2ceba6[_0x341d81(0x22b)]((_0x550224,_0x58f5d1)=>{var _0x4232ca=_0x341d81;_0x4ac2d5[_0x58f5d1][_0x4232ca(0x1b8)]=_0x550224;}),_0x39856c[_0x341d81(0x22b)]((_0x14e039,_0x33817a)=>{var _0x285766=_0x341d81;_0x4ac2d5[_0x33817a][_0x285766(0x1b5)]=_0x14e039;});const _0x473420=_0x4ac2d5[_0x341d81(0x235)](_0x2c6e2c=>_0x2c6e2c[_0x341d81(0x225)]!=='0'&&_0x2c6e2c['adjust_qty']!=='');var _0x14bc1d=0x0;_0x473420[_0x341d81(0x22b)](_0x5c83a2=>{var _0x1cfce8=_0x341d81;console[_0x1cfce8(0x1c2)](_0x1cfce8(0x1bd),_0x5c83a2),parseInt(_0x5c83a2['adjust_qty'])<=0x0&&_0x14bc1d++;});if(_0x14bc1d!=0x0)return _0x45701d[_0x341d81(0x1e1)](_0x341d81(0x1b6),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x44da94[_0x341d81(0x1e6)]('back');const _0x3e31ad=new invoice_for_adjustment();await _0x3e31ad['save']();const _0x47655f=new adjustment_finished({'warehouse_name':_0x3b2517,'date':_0x94d95,'product':_0x473420,'note':_0x2cda74,'room':_0x4ed024,'invoice':_0x341d81(0x1f2)+_0x3e31ad[_0x341d81(0x216)][_0x341d81(0x1cf)]()[_0x341d81(0x233)](0x8,'0'),'JO_number':_0x237907,'expiry_date':_0x277bc2,'PO_number':_0x512ae2,'RequestedBy':_0x1f3894,'DateofRequest':_0x449b78,'typeservices':_0x1f65f8,'destination':_0x47e6b2,'deliverydate':_0x40345d,'driver':_0x2b4985,'plate':_0x51a881,'van':_0x2590f8,'DRSI':_0x1d9a91,'typevehicle':_0x19285d,'TSU':_0x1e091e,'TFU':_0x120c1e}),_0x3a401e=await _0x47655f[_0x341d81(0x236)]();_0x45701d[_0x341d81(0x1e1)](_0x341d81(0x1f8),_0x341d81(0x202)),_0x44da94['redirect'](_0x341d81(0x211)+_0x3a401e['_id']);}catch(_0x4f8310){console['log'](_0x4f8310),_0x44da94[_0x341d81(0x204)](0xc8)[_0x341d81(0x227)]({'message':_0x4f8310[_0x341d81(0x1e4)]});}}),router[a0_0x1951f2(0x195)](a0_0x1951f2(0x1a2),auth,async(_0x9f175d,_0x467dce)=>{var _0x44c0b5=a0_0x1951f2;try{const {username:_0x381357,email:_0x1683c9,role:_0x2f6243}=_0x9f175d[_0x44c0b5(0x18b)],_0x323b2d=_0x9f175d[_0x44c0b5(0x18b)],_0x1ebac3=await profile['findOne']({'email':_0x323b2d[_0x44c0b5(0x205)]}),_0xfedf0b=await master_shop[_0x44c0b5(0x20d)]();let _0x4bdb94;if(_0x323b2d[_0x44c0b5(0x200)]==_0x44c0b5(0x1f0)){const _0x3805ea=await staff[_0x44c0b5(0x223)]({'email':_0x323b2d['email']});_0x4bdb94=await warehouse[_0x44c0b5(0x18d)]([{'$match':{'status':_0x44c0b5(0x1b1),'name':_0x3805ea[_0x44c0b5(0x218)]}},{'$group':{'_id':_0x44c0b5(0x239),'name':{'$first':_0x44c0b5(0x239)}}}]);}else _0x4bdb94=await warehouse[_0x44c0b5(0x18d)]([{'$match':{'status':_0x44c0b5(0x1b1)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x18bfde=await product[_0x44c0b5(0x20d)](),_0x1aabd8=await adjustment_finished[_0x44c0b5(0x20d)](),_0x330ad0=_0x1aabd8[_0x44c0b5(0x1d2)]+0x1,_0x3cc706='ADJF-'+_0x330ad0[_0x44c0b5(0x1cf)]()['padStart'](0x5,'0');var _0x4b4ba6=[_0x44c0b5(0x1f1),_0x44c0b5(0x1cc),_0x44c0b5(0x212)];if(_0xfedf0b[0x0][_0x44c0b5(0x1ff)]==_0x44c0b5(0x1e7))var _0x3033a1=users[_0x44c0b5(0x1d5)];else{if(_0xfedf0b[0x0][_0x44c0b5(0x1ff)]=='Hindi')var _0x3033a1=users[_0x44c0b5(0x1b9)];else{if(_0xfedf0b[0x0][_0x44c0b5(0x1ff)]==_0x44c0b5(0x1aa))var _0x3033a1=users[_0x44c0b5(0x1aa)];else{if(_0xfedf0b[0x0]['language']==_0x44c0b5(0x237))var _0x3033a1=users['Spanish'];else{if(_0xfedf0b[0x0][_0x44c0b5(0x1ff)]==_0x44c0b5(0x196))var _0x3033a1=users[_0x44c0b5(0x196)];else{if(_0xfedf0b[0x0][_0x44c0b5(0x1ff)]=='Portuguese\x20(BR)')var _0x3033a1=users[_0x44c0b5(0x1eb)];else{if(_0xfedf0b[0x0]['language']==_0x44c0b5(0x1bb))var _0x3033a1=users[_0x44c0b5(0x1bb)];else{if(_0xfedf0b[0x0][_0x44c0b5(0x1ff)]=='Arabic\x20(ae)')var _0x3033a1=users[_0x44c0b5(0x1f5)];}}}}}}}const _0x30e09d=getRandom8DigitNumber();_0x30e09d[_0x44c0b5(0x1ab)](_0x291b31=>{var _0x289ccc=_0x44c0b5;_0x467dce[_0x289ccc(0x1b0)](_0x289ccc(0x221),{'success':_0x9f175d[_0x289ccc(0x1e1)]('success'),'errors':_0x9f175d[_0x289ccc(0x1e1)](_0x289ccc(0x1b6)),'role':_0x323b2d,'profile':_0x1ebac3,'warehouse':_0x4bdb94,'product':_0x18bfde,'master_shop':_0xfedf0b,'language':_0x3033a1,'rooms_data':_0x4b4ba6,'invoice_no':_0x291b31});})['catch'](_0x26ad44=>{var _0xf41d9d=_0x44c0b5;_0x9f175d[_0xf41d9d(0x1e1)](_0xf41d9d(0x1b6),_0xf41d9d(0x21c)),_0x467dce[_0xf41d9d(0x1e6)](_0xf41d9d(0x1c3));});}catch(_0x367aea){console[_0x44c0b5(0x1c2)](_0x367aea);}}),router['post'](a0_0x1951f2(0x1a2),auth,async(_0x1d71be,_0x4eec1f)=>{var _0x1f742e=a0_0x1951f2;try{const {warehouse_name:_0x4b489b,date:_0x3a5d55,prod_name:_0x17cf95,level:_0x38cf3e,isle:_0x573abe,pallet:_0x1b2977,stock:_0x59aaa0,types:_0x1e4e13,adjust_qty:_0x598bcc,new_adjust_qty:_0x26d622,note:_0x8fee74,Room_name:_0x1ff187,JO_number:_0x2033fd,expiry_date:_0x24b368,type_of_transaction:_0xd6eecb,PO_number:_0x1ae683,ReqBy:_0x38704c,dateofreq:_0x573316,typeservicesData:_0x9e2905,destination:_0x148da5,deliverydate:_0x3e53a6,driver:_0x24c222,plate:_0x338796,van:_0x39db63,DRSI:_0x33a20f,typevehicle:_0x26ab17,TSU:_0x4cc00c,TFU:_0x41fe8a}=_0x1d71be['body'];if(typeof _0x17cf95==_0x1f742e(0x1ad))var _0x2b2d2a=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1a8)]],_0x3677d4=[_0x1d71be['body']['level']],_0x34e676=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x228)]],_0x5112aa=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x190)]],_0x2e3c06=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1fc)]],_0x2a2ff2=[_0x1d71be[_0x1f742e(0x22d)]['New_Qty_Converted']],_0x402f0f=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1fd)]],_0x4f6b10=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1c8)]],_0x1103e5=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x22c)]],_0x49387e=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1f6)]],_0x3be017=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1ba)]],_0x11d2ba=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1ee)]],_0x4f731b=[_0x1d71be[_0x1f742e(0x22d)]['prod_cat']],_0x5ec785=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1d8)]],_0x4e52dd=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1b8)]],_0x1dc41d=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1f3)]],_0x1a647b=[_0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x208)]];else var _0x2b2d2a=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1a8)]],_0x3677d4=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1cb)]],_0x34e676=[..._0x1d71be[_0x1f742e(0x22d)]['stock']],_0x5112aa=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x190)]],_0x2e3c06=[..._0x1d71be['body'][_0x1f742e(0x1fc)]],_0x2a2ff2=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1af)]],_0x402f0f=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1fd)]],_0x4f6b10=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1c8)]],_0x1103e5=[..._0x1d71be[_0x1f742e(0x22d)]['prod_code']],_0x49387e=[..._0x1d71be['body'][_0x1f742e(0x1f6)]],_0x3be017=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1ba)]],_0x11d2ba=[..._0x1d71be['body'][_0x1f742e(0x1ee)]],_0x4f731b=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x20b)]],_0x5ec785=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1d8)]],_0x4e52dd=[..._0x1d71be['body'][_0x1f742e(0x1b8)]],_0x1dc41d=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x1f3)]],_0x1a647b=[..._0x1d71be[_0x1f742e(0x22d)][_0x1f742e(0x208)]];const _0x4d34c6=_0x2b2d2a['map'](_0x4209a6=>{return _0x4209a6={'product_name':_0x4209a6};});_0x3677d4[_0x1f742e(0x22b)]((_0x5d5e25,_0x36d142)=>{var _0x44e5e1=_0x1f742e,_0x27f90f=_0x5d5e25['match'](/[A-Za-z]+/)[0x0],_0x2d397c=parseInt(_0x5d5e25[_0x44e5e1(0x19d)](/\d+/)[0x0]);_0x4d34c6[_0x36d142][_0x44e5e1(0x1cb)]=_0x27f90f,_0x4d34c6[_0x36d142]['bay']=_0x2d397c;}),_0x1a647b[_0x1f742e(0x22b)]((_0x5dad63,_0x42ab33)=>{var _0x1a8051=_0x1f742e;_0x4d34c6[_0x42ab33][_0x1a8051(0x1e8)]=_0x5dad63;}),_0x34e676['forEach']((_0x3ef1de,_0x250c76)=>{var _0x39deb0=_0x1f742e;_0x4d34c6[_0x250c76][_0x39deb0(0x1ed)]=_0x3ef1de;}),_0x5112aa[_0x1f742e(0x22b)]((_0x43f264,_0x11b9c4)=>{_0x4d34c6[_0x11b9c4]['types']=_0x43f264;}),_0x2e3c06[_0x1f742e(0x22b)]((_0x21b498,_0x4f90f5)=>{var _0x390b33=_0x1f742e;_0x4d34c6[_0x4f90f5][_0x390b33(0x225)]=_0x21b498;}),_0x2a2ff2['forEach']((_0x32b6ac,_0x29fbde)=>{var _0x501b65=_0x1f742e;_0x4d34c6[_0x29fbde][_0x501b65(0x1d4)]=_0x32b6ac;}),_0x402f0f[_0x1f742e(0x22b)]((_0x370f25,_0x3ae008)=>{_0x4d34c6[_0x3ae008]['unit']=_0x370f25;}),_0x4f6b10[_0x1f742e(0x22b)]((_0x2dd186,_0x2a6487)=>{var _0x146166=_0x1f742e;_0x4d34c6[_0x2a6487][_0x146166(0x21b)]=_0x2dd186;}),_0x1103e5[_0x1f742e(0x22b)]((_0x35bec9,_0x2c16ad)=>{_0x4d34c6[_0x2c16ad]['product_code']=_0x35bec9;}),_0x49387e[_0x1f742e(0x22b)]((_0x3aac87,_0x374fed)=>{var _0x5149f4=_0x1f742e;_0x4d34c6[_0x374fed][_0x5149f4(0x1f6)]=_0x3aac87;}),_0x3be017[_0x1f742e(0x22b)]((_0x21c6f7,_0x649d51)=>{var _0x4047ed=_0x1f742e;_0x4d34c6[_0x649d51][_0x4047ed(0x1ba)]=_0x21c6f7;}),_0x11d2ba[_0x1f742e(0x22b)]((_0x3c51d8,_0x4039bd)=>{var _0x7e5b45=_0x1f742e;_0x4d34c6[_0x4039bd][_0x7e5b45(0x230)]=_0x3c51d8;}),_0x4f731b[_0x1f742e(0x22b)]((_0x516fa5,_0x13f597)=>{var _0xa5729d=_0x1f742e;_0x4d34c6[_0x13f597][_0xa5729d(0x20b)]=_0x516fa5;}),_0x5ec785[_0x1f742e(0x22b)]((_0x55afb5,_0xae530f)=>{var _0xeb3c4d=_0x1f742e;_0x4d34c6[_0xae530f][_0xeb3c4d(0x1dc)]=_0x55afb5;}),_0x4e52dd[_0x1f742e(0x22b)]((_0x26c664,_0xc99c32)=>{var _0x4f4fe8=_0x1f742e;_0x4d34c6[_0xc99c32][_0x4f4fe8(0x1b8)]=_0x26c664;}),_0x1dc41d[_0x1f742e(0x22b)]((_0x5a8741,_0x268699)=>{_0x4d34c6[_0x268699]['invoice']=_0x5a8741;});const _0x2fc17f=_0x4d34c6[_0x1f742e(0x235)](_0x3d1595=>_0x3d1595['adjust_qty']!=='0'&&_0x3d1595[_0x1f742e(0x225)]!=='');var _0x574a71=0x0;_0x2fc17f['forEach'](_0x19cc4b=>{var _0x5f5a37=_0x1f742e;console[_0x5f5a37(0x1c2)](_0x5f5a37(0x1bd),_0x19cc4b),parseInt(_0x19cc4b[_0x5f5a37(0x225)])<=0x0&&_0x574a71++;});if(_0x574a71!=0x0)return _0x1d71be[_0x1f742e(0x1e1)](_0x1f742e(0x1b6),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x4eec1f[_0x1f742e(0x1e6)](_0x1f742e(0x1ca));const _0x40641f=new adjustment_logs();await _0x40641f[_0x1f742e(0x236)]();const _0x2237a5=new adjustment_finished({'warehouse_name':_0x4b489b,'date':_0x3a5d55,'product':_0x2fc17f,'note':_0x8fee74,'room':_0x1ff187,'invoice':_0x1f742e(0x234)+_0x40641f['invoice_init'][_0x1f742e(0x1cf)]()[_0x1f742e(0x233)](0x8,'0'),'JO_number':_0x2033fd,'expiry_date':_0x24b368,'type_of_transaction':_0xd6eecb,'PO_number':_0x1ae683,'RequestedBy':_0x38704c,'DateofRequest':_0x573316,'typeservices':_0x9e2905,'destination':_0x148da5,'deliverydate':_0x3e53a6,'driver':_0x24c222,'plate':_0x338796,'van':_0x39db63,'DRSI':_0x33a20f,'typevehicle':_0x26ab17,'TSU':_0x4cc00c,'TFU':_0x41fe8a}),_0x5a6570=await _0x2237a5['save']();_0x1d71be[_0x1f742e(0x1e1)](_0x1f742e(0x1f8),_0x1f742e(0x202)),_0x4eec1f[_0x1f742e(0x1e6)](_0x1f742e(0x211)+_0x5a6570[_0x1f742e(0x1a4)]);}catch(_0x3c4aa0){console[_0x1f742e(0x1c2)](_0x3c4aa0),_0x4eec1f[_0x1f742e(0x204)](0xc8)[_0x1f742e(0x227)]({'message':_0x3c4aa0[_0x1f742e(0x1e4)]});}}),router[a0_0x1951f2(0x195)](a0_0x1951f2(0x197),auth,async(_0x2b44d7,_0x30aca3)=>{var _0x3b337d=a0_0x1951f2;try{const {username:_0x17c633,email:_0x292c68,role:_0x21f97b}=_0x2b44d7['user'],_0x73d068=_0x2b44d7[_0x3b337d(0x18b)],_0x3ac287=await profile[_0x3b337d(0x223)]({'email':_0x73d068[_0x3b337d(0x205)]}),_0x594d2f=await master_shop[_0x3b337d(0x20d)](),_0x16fb9f=_0x2b44d7[_0x3b337d(0x22f)]['id'],_0x5c69a3=await adjustment_finished[_0x3b337d(0x207)]({'_id':_0x16fb9f}),_0x48dc60=await purchases[_0x3b337d(0x18d)]([{'$match':{'warehouse_name':_0x5c69a3[_0x3b337d(0x231)]}},{'$unwind':_0x3b337d(0x222)},{'$group':{'_id':'$product.product_name'}}]);console[_0x3b337d(0x1c2)](_0x3b337d(0x1a9),_0x48dc60);const _0x1542ee=await product['find']({}),_0x389984=await warehouse[_0x3b337d(0x18d)]([{'$match':{'name':_0x5c69a3[_0x3b337d(0x231)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3b337d(0x1fb),'name':{'$first':_0x3b337d(0x203)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3b337d(0x210)},'bin':{'$first':_0x3b337d(0x1a0)},'type':{'$first':_0x3b337d(0x19a)},'floorlevel':{'$first':_0x3b337d(0x1a1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3b337d(0x1f7)},'product_code':{'$first':_0x3b337d(0x1ce)},'storage':{'$first':_0x3b337d(0x1ef)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3b337d(0x220)},'batch_code':{'$first':_0x3b337d(0x206)},'maxPerUnit':{'$first':_0x3b337d(0x1c4)},'room':{'$first':'$room'}}}]);if(_0x594d2f[0x0][_0x3b337d(0x1ff)]==_0x3b337d(0x1e7)){var _0x4b02ce=users[_0x3b337d(0x1d5)];console['log'](_0x4b02ce);}else{if(_0x594d2f[0x0]['language']==_0x3b337d(0x1b9))var _0x4b02ce=users[_0x3b337d(0x1b9)];else{if(_0x594d2f[0x0][_0x3b337d(0x1ff)]==_0x3b337d(0x1aa))var _0x4b02ce=users['German'];else{if(_0x594d2f[0x0][_0x3b337d(0x1ff)]==_0x3b337d(0x237))var _0x4b02ce=users['Spanish'];else{if(_0x594d2f[0x0]['language']==_0x3b337d(0x196))var _0x4b02ce=users['French'];else{if(_0x594d2f[0x0][_0x3b337d(0x1ff)]==_0x3b337d(0x1e2))var _0x4b02ce=users[_0x3b337d(0x1eb)];else{if(_0x594d2f[0x0][_0x3b337d(0x1ff)]==_0x3b337d(0x1bb))var _0x4b02ce=users['Chinese'];else{if(_0x594d2f[0x0][_0x3b337d(0x1ff)]==_0x3b337d(0x1ea))var _0x4b02ce=users[_0x3b337d(0x1f5)];}}}}}}}_0x30aca3[_0x3b337d(0x1b0)]('edit_adjustment_finished_view',{'success':_0x2b44d7[_0x3b337d(0x1e1)](_0x3b337d(0x1f8)),'errors':_0x2b44d7[_0x3b337d(0x1e1)]('errors'),'role':_0x73d068,'profile':_0x3ac287,'adjustment':_0x5c69a3,'stock':_0x389984,'master_shop':_0x594d2f,'warehouse_name':_0x48dc60,'unit':_0x1542ee,'language':_0x4b02ce});}catch(_0x53cfc1){console[_0x3b337d(0x1c2)](_0x53cfc1),_0x30aca3['status'](0xc8)[_0x3b337d(0x227)]({'message':_0x53cfc1['message']});}}),router[a0_0x1951f2(0x1bf)](a0_0x1951f2(0x197),auth,async(_0x47ecaf,_0x5fb5ab)=>{var _0x1c128f=a0_0x1951f2;try{const {invoice:_0x11bb94,warehouse_name:_0x706cd8,Room_name:_0x41a613}=_0x47ecaf[_0x1c128f(0x22d)],_0x5acfba=_0x47ecaf[_0x1c128f(0x22f)]['id'],_0x56ea69=await adjustment_finished['findById']({'_id':_0x5acfba});var _0x57dd2e;const _0x11d55b=_0x56ea69[_0x1c128f(0x1c9)][_0x1c128f(0x1d0)](async _0x577a05=>{var _0x199a59=_0x1c128f;if(_0x577a05[_0x199a59(0x225)]>0x0){_0x57dd2e=await warehouse[_0x199a59(0x223)]({'name':_0x706cd8,'room':_0x577a05[_0x199a59(0x1dc)]});const _0x459b5e=_0x57dd2e[_0x199a59(0x1a6)][_0x199a59(0x1d0)](_0xa0da6c=>{var _0x1a55e5=_0x199a59;console[_0x1a55e5(0x1c2)](_0x577a05[_0x1a55e5(0x190)]);if(_0x577a05['types']==_0x1a55e5(0x215))_0xa0da6c[_0x1a55e5(0x1a4)]==_0x577a05[_0x1a55e5(0x1e8)]&&(_0xa0da6c['product_stock']=_0xa0da6c[_0x1a55e5(0x1bc)]-_0x577a05[_0x1a55e5(0x225)]);else _0x577a05['types']==_0x1a55e5(0x21f)&&(_0xa0da6c[_0x1a55e5(0x1a4)]==_0x577a05[_0x1a55e5(0x1e8)]&&(_0xa0da6c[_0x1a55e5(0x1bc)]=_0xa0da6c[_0x1a55e5(0x1bc)]+_0x577a05[_0x1a55e5(0x225)]));});}return _0x57dd2e;});Promise[_0x1c128f(0x20f)](_0x11d55b)[_0x1c128f(0x1ab)](async _0x37a576=>{var _0x135cfb=_0x1c128f;try{for(const _0x4fc612 of _0x37a576){await _0x4fc612[_0x135cfb(0x236)]();}_0x56ea69[_0x135cfb(0x232)]=_0x135cfb(0x18e);const _0x237bba=await _0x56ea69[_0x135cfb(0x236)](),_0x4ba002=await master_shop['find'](),_0x1bb6b6=await email_settings[_0x135cfb(0x223)](),_0x2804cc=await supervisor_settings[_0x135cfb(0x20d)]();var _0x44475b=_0x56ea69[_0x135cfb(0x1c9)],_0x3196fd='',_0x568adc;for(_0x568adc in _0x44475b){var _0x192562='FG';_0x56ea69[_0x135cfb(0x231)]=='DRY\x20GOODS'&&(_0x192562='DG'),_0x3196fd+=_0x135cfb(0x1dd)+_0x135cfb(0x194)+_0x44475b[_0x568adc][_0x135cfb(0x1de)]+_0x135cfb(0x1f4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44475b[_0x568adc][_0x135cfb(0x18c)]+_0x135cfb(0x1f4)+_0x135cfb(0x194)+_0x44475b[_0x568adc][_0x135cfb(0x225)]+_0x135cfb(0x1f4)+_0x135cfb(0x194)+_0x44475b[_0x568adc][_0x135cfb(0x1c1)]+_0x135cfb(0x1f4)+_0x135cfb(0x194)+_0x44475b[_0x568adc]['secondary_unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56ea69[_0x135cfb(0x231)]+_0x135cfb(0x1f4)+_0x135cfb(0x194)+_0x44475b[_0x568adc][_0x135cfb(0x1dc)]+_0x135cfb(0x1f4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x192562+_0x44475b[_0x568adc][_0x135cfb(0x1a5)]+_0x135cfb(0x1f4)+_0x135cfb(0x214);}_0x47ecaf[_0x135cfb(0x1e1)](_0x135cfb(0x1f8),_0x135cfb(0x20a)),_0x5fb5ab[_0x135cfb(0x1e6)](_0x135cfb(0x1e9)+_0x237bba['_id']);}catch(_0x3afa77){console['error'](_0x3afa77),_0x5fb5ab[_0x135cfb(0x204)](0x1f4)[_0x135cfb(0x227)]({'error':_0x135cfb(0x229)});}})[_0x1c128f(0x19c)](_0x2e3bfb=>{var _0xaa382a=_0x1c128f;console[_0xaa382a(0x201)](_0x2e3bfb),_0x5fb5ab[_0xaa382a(0x204)](0x1f4)['json']({'error':_0xaa382a(0x1d3)});});}catch(_0x311ff7){_0x5fb5ab[_0x1c128f(0x227)]({'message':_0x311ff7[_0x1c128f(0x1e4)]});}}),router['get'](a0_0x1951f2(0x1b3),auth,async(_0x2b7d57,_0x1a4cdd)=>{var _0x2e32c0=a0_0x1951f2;try{const {username:_0x5783e4,email:_0x9626ff,role:_0x5b90b9}=_0x2b7d57[_0x2e32c0(0x18b)],_0x2f4b1e=_0x2b7d57[_0x2e32c0(0x18b)],_0x31a4ff=await profile[_0x2e32c0(0x223)]({'email':_0x2f4b1e[_0x2e32c0(0x205)]}),_0x4539bb=await master_shop[_0x2e32c0(0x20d)]();console[_0x2e32c0(0x1c2)](_0x2e32c0(0x1e5),_0x4539bb);const _0x25844c=_0x2b7d57['params']['id'],_0x184783=await adjustment_finished['findById']({'_id':_0x25844c});let _0x535439=new Date(_0x184783['expiry_date']),_0x4bc95f=('0'+_0x535439['getDate']())[_0x2e32c0(0x1be)](-0x2),_0x4ff409=('0'+(_0x535439[_0x2e32c0(0x18f)]()+0x1))[_0x2e32c0(0x1be)](-0x2),_0x1eb470=_0x535439[_0x2e32c0(0x209)](),_0x49d4d2=_0x1eb470+'-'+_0x4ff409+'-'+_0x4bc95f;var _0x44b86f=[_0x2e32c0(0x1f1),_0x2e32c0(0x1cc),'Return\x20Rooms'];const _0x4fe819=await purchases[_0x2e32c0(0x18d)]([{'$match':{'warehouse_name':_0x184783['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0x2e32c0(0x22a)}}]);console[_0x2e32c0(0x1c2)](_0x2e32c0(0x1a9),_0x4fe819);const _0x4f568c=await product[_0x2e32c0(0x20d)]({}),_0x4c2957=await warehouse['aggregate']([{'$match':{'name':_0x184783['warehouse_name'],'room':_0x184783[_0x2e32c0(0x20c)]}},{'$unwind':_0x2e32c0(0x1e3)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2e32c0(0x203)},'product_stock':{'$first':_0x2e32c0(0x1d6)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2e32c0(0x1a0)},'type':{'$first':_0x2e32c0(0x19a)},'floorlevel':{'$first':_0x2e32c0(0x1a1)},'primary_code':{'$first':_0x2e32c0(0x1df)},'secondary_code':{'$first':_0x2e32c0(0x1f7)},'product_code':{'$first':_0x2e32c0(0x1ce)},'storage':{'$first':_0x2e32c0(0x1ef)},'rack':{'$first':_0x2e32c0(0x1a7)}}}]);if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x1e7)){var _0x1ec999=users[_0x2e32c0(0x1d5)];console[_0x2e32c0(0x1c2)](_0x1ec999);}else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x1b9))var _0x1ec999=users[_0x2e32c0(0x1b9)];else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]=='German')var _0x1ec999=users[_0x2e32c0(0x1aa)];else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x237))var _0x1ec999=users[_0x2e32c0(0x237)];else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x196))var _0x1ec999=users[_0x2e32c0(0x196)];else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x1e2))var _0x1ec999=users['Portuguese'];else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x1bb))var _0x1ec999=users[_0x2e32c0(0x1bb)];else{if(_0x4539bb[0x0][_0x2e32c0(0x1ff)]==_0x2e32c0(0x1ea))var _0x1ec999=users[_0x2e32c0(0x1f5)];}}}}}}}_0x1a4cdd[_0x2e32c0(0x1b0)]('edit_adjustment_finished',{'success':_0x2b7d57[_0x2e32c0(0x1e1)](_0x2e32c0(0x1f8)),'errors':_0x2b7d57[_0x2e32c0(0x1e1)](_0x2e32c0(0x1b6)),'role':_0x2f4b1e,'profile':_0x31a4ff,'adjustment':_0x184783,'stock':_0x4c2957,'master_shop':_0x4539bb,'warehouse_name':_0x4fe819,'unit':_0x4f568c,'language':_0x1ec999,'rooms_data':_0x44b86f,'ed_fullDate':_0x49d4d2});}catch(_0x279103){console[_0x2e32c0(0x1c2)](_0x279103),_0x1a4cdd['status'](0xc8)['json']({'message':_0x279103['message']});}}),router[a0_0x1951f2(0x1bf)](a0_0x1951f2(0x1b3),auth,async(_0x4e6aab,_0x693a12)=>{var _0x3a6f76=a0_0x1951f2;try{const _0x2ab463=_0x4e6aab[_0x3a6f76(0x22f)]['id'],_0x5030a7=await adjustment_finished[_0x3a6f76(0x207)]({'_id':_0x2ab463}),_0x479423=await warehouse[_0x3a6f76(0x223)]({'name':_0x5030a7[_0x3a6f76(0x231)],'room':_0x5030a7[_0x3a6f76(0x20c)]}),{warehouse_name:_0x17f620,date:_0x545fc1,prod_name:_0x597818,level:_0x5cc8ca,isle:_0xb0b739,pallet:_0x569998,stock:_0x53e0f3,types:_0x2a4649,adjust_qty:_0xadac0f,new_adjust_qty:_0x461def,note:_0x53f804,Room_name:_0x452871,invoice:_0x105750,JO_number:_0x58c187}=_0x4e6aab['body'];if(typeof _0x597818==_0x3a6f76(0x1ad))var _0x2ac8fa=[_0x4e6aab[_0x3a6f76(0x22d)]['prod_name']],_0x4cfa07=[_0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1cb)]],_0x4e48a5=[_0x4e6aab['body'][_0x3a6f76(0x228)]],_0x327ffa=[_0x4e6aab['body'][_0x3a6f76(0x190)]],_0x4bac1a=[_0x4e6aab['body']['adjust_qty']],_0x2d8d50=[_0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1d4)]],_0x42ef44=[_0x4e6aab[_0x3a6f76(0x22d)]['prod_code']],_0xc1334f=[_0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1c1)]],_0x212930=[_0x4e6aab[_0x3a6f76(0x22d)]['Secondary_units']],_0x53f296=[_0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1f6)]],_0x2fbf08=[_0x4e6aab['body'][_0x3a6f76(0x1ba)]];else var _0x2ac8fa=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1a8)]],_0x4cfa07=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1cb)]],_0x4e48a5=[..._0x4e6aab[_0x3a6f76(0x22d)]['stock']],_0x327ffa=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x190)]],_0x4bac1a=[..._0x4e6aab['body'][_0x3a6f76(0x225)]],_0x2d8d50=[..._0x4e6aab[_0x3a6f76(0x22d)]['new_adjust_qty']],_0x42ef44=[..._0x4e6aab[_0x3a6f76(0x22d)]['prod_code']],_0xc1334f=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1c1)]],_0x212930=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1c8)]],_0x53f296=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1f6)]],_0x2fbf08=[..._0x4e6aab[_0x3a6f76(0x22d)][_0x3a6f76(0x1ba)]];const _0x2592c9=_0x2ac8fa[_0x3a6f76(0x1d0)](_0x2817ac=>{return _0x2817ac={'product_name':_0x2817ac};});_0x4cfa07[_0x3a6f76(0x22b)]((_0xeb20a8,_0x1438d9)=>{var _0x21b86b=_0x3a6f76;_0x2592c9[_0x1438d9][_0x21b86b(0x1a5)]=_0xeb20a8;}),_0x4e48a5[_0x3a6f76(0x22b)]((_0x30a80c,_0x188513)=>{var _0x1bd8e7=_0x3a6f76;_0x2592c9[_0x188513][_0x1bd8e7(0x1ed)]=_0x30a80c;}),_0x327ffa[_0x3a6f76(0x22b)]((_0xa61f62,_0x5443bd)=>{var _0x495186=_0x3a6f76;_0x2592c9[_0x5443bd][_0x495186(0x190)]=_0xa61f62;}),_0x4bac1a[_0x3a6f76(0x22b)]((_0x1ce944,_0x256873)=>{var _0x28fc6d=_0x3a6f76;_0x2592c9[_0x256873][_0x28fc6d(0x225)]=_0x1ce944;}),_0x2d8d50[_0x3a6f76(0x22b)]((_0x56e27f,_0x3158b1)=>{var _0x51a8c5=_0x3a6f76;_0x2592c9[_0x3158b1][_0x51a8c5(0x1d4)]=_0x56e27f;}),_0xc1334f[_0x3a6f76(0x22b)]((_0x2e4918,_0x459d12)=>{_0x2592c9[_0x459d12]['unit']=_0x2e4918;}),_0x212930['forEach']((_0x2eb9ee,_0x51dc16)=>{var _0x379d97=_0x3a6f76;_0x2592c9[_0x51dc16][_0x379d97(0x21b)]=_0x2eb9ee;}),_0x42ef44[_0x3a6f76(0x22b)]((_0x44b7d0,_0x49207b)=>{var _0x18010b=_0x3a6f76;_0x2592c9[_0x49207b][_0x18010b(0x18c)]=_0x44b7d0;}),_0x53f296[_0x3a6f76(0x22b)]((_0x4677fc,_0x4207ed)=>{var _0x2def87=_0x3a6f76;_0x2592c9[_0x4207ed][_0x2def87(0x1f6)]=_0x4677fc;}),_0x2fbf08['forEach']((_0x4b6ccb,_0x28a74c)=>{var _0x104ee2=_0x3a6f76;_0x2592c9[_0x28a74c][_0x104ee2(0x1ba)]=_0x4b6ccb;});const _0x425311=_0x2592c9['filter'](_0x397a68=>_0x397a68[_0x3a6f76(0x225)]!=='0'&&_0x397a68['adjust_qty']!=='');var _0x5c6921=0x0;_0x425311['forEach'](_0x20708e=>{var _0x5b6db=_0x3a6f76;console['log'](_0x5b6db(0x1bd),_0x20708e),parseInt(_0x20708e[_0x5b6db(0x225)])<=0x0&&_0x5c6921++;});if(_0x5c6921!=0x0)return _0x4e6aab[_0x3a6f76(0x1e1)]('errors',_0x3a6f76(0x1ae)),_0x693a12[_0x3a6f76(0x1e6)]('back');_0x5030a7[_0x3a6f76(0x231)]=_0x17f620,_0x5030a7[_0x3a6f76(0x1c6)]=_0x545fc1,_0x5030a7[_0x3a6f76(0x1c9)]=_0x425311,_0x5030a7['note']=_0x53f804,_0x5030a7['room']=_0x452871,_0x5030a7['invoice']=_0x105750,_0x5030a7[_0x3a6f76(0x1fe)]=_0x58c187;const _0x213508=await _0x5030a7[_0x3a6f76(0x236)](),_0x521643=await warehouse[_0x3a6f76(0x223)]({'name':_0x17f620,'room':_0x452871});_0x213508['product'][_0x3a6f76(0x22b)](_0x17d1bb=>{var _0x2917e7=_0x3a6f76;const _0x119ddb=_0x521643[_0x2917e7(0x1a6)][_0x2917e7(0x1d0)](_0x347046=>{var _0x36753b=_0x2917e7;_0x17d1bb[_0x36753b(0x190)]=='minus'?_0x347046['product_name']==_0x17d1bb[_0x36753b(0x1de)]&&_0x347046[_0x36753b(0x1a5)]==_0x17d1bb[_0x36753b(0x1a5)]&&(_0x347046[_0x36753b(0x1bc)]=parseInt(_0x347046[_0x36753b(0x1bc)])-parseInt(_0x17d1bb[_0x36753b(0x225)])):_0x347046[_0x36753b(0x1de)]==_0x17d1bb[_0x36753b(0x1de)]&&_0x347046[_0x36753b(0x1a5)]==_0x17d1bb[_0x36753b(0x1a5)]&&(_0x347046[_0x36753b(0x1bc)]=parseInt(_0x347046[_0x36753b(0x1bc)])+parseInt(_0x17d1bb[_0x36753b(0x225)]));});}),await _0x521643[_0x3a6f76(0x236)](),_0x4e6aab[_0x3a6f76(0x1e1)]('success',_0x3a6f76(0x1c0)),_0x693a12['redirect'](_0x3a6f76(0x1d1));}catch(_0x1cb02a){console['log'](_0x1cb02a);}}),router[a0_0x1951f2(0x1bf)]('/barcode_scanner',async(_0x3d3f10,_0x21d64a)=>{var _0x3e3b75=a0_0x1951f2;const {primary_code:_0x14d404,warehouse_data:_0x2d24db,rooms_data:_0x413f85,Roomslist:_0x30cc72}=_0x3d3f10['body'],_0x3410fe=_0x30cc72['split'](','),_0xd52da1=[];async function _0x11927e(_0x5589b8){var _0x3bae84=a0_0x5a24;const _0x168277=await warehouse[_0x3bae84(0x18d)]([{'$match':{'name':_0x2d24db,'room':_0x5589b8}},{'$unwind':_0x3bae84(0x1e3)},{'$match':{'product_details.primary_code':_0x14d404}},{'$group':{'_id':_0x3bae84(0x1fb),'name':{'$first':_0x3bae84(0x203)},'product_stock':{'$first':_0x3bae84(0x1d6)},'primary_code':{'$first':_0x3bae84(0x1df)},'secondary_code':{'$first':_0x3bae84(0x1f7)},'product_code':{'$first':_0x3bae84(0x1ce)},'level':{'$first':_0x3bae84(0x217)},'bay':{'$first':_0x3bae84(0x210)},'type':{'$first':_0x3bae84(0x19a)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3bae84(0x1ef)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3bae84(0x1a3)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x3bae84(0x206)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x3bae84(0x1db)},'invoice':{'$first':_0x3bae84(0x1e0)}}}]),_0x2381fa=await warehouse[_0x3bae84(0x18d)]([{'$match':{'name':_0x2d24db,'room':_0x5589b8}},{'$unwind':_0x3bae84(0x1e3)},{'$match':{'product_details.secondary_code':_0x14d404}},{'$group':{'_id':_0x3bae84(0x1fb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3bae84(0x1d6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3bae84(0x1f7)},'product_code':{'$first':_0x3bae84(0x1ce)},'level':{'$first':_0x3bae84(0x217)},'bay':{'$first':_0x3bae84(0x210)},'type':{'$first':_0x3bae84(0x19a)},'pallet':{'$first':_0x3bae84(0x1a1)},'unit':{'$first':_0x3bae84(0x1c7)},'secondary_unit':{'$first':_0x3bae84(0x19b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3bae84(0x1a7)},'expiry_date':{'$first':_0x3bae84(0x1a3)},'production_date':{'$first':_0x3bae84(0x220)},'batch_code':{'$first':_0x3bae84(0x206)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x3bae84(0x1c4)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3bae84(0x1e0)}}}]);if(_0x168277[_0x3bae84(0x1d2)]>0x0)_0xd52da1['push'](_0x168277);else _0x2381fa['length']>0x0&&_0xd52da1['push'](_0x2381fa);}const _0x45462c=_0x3410fe[_0x3e3b75(0x1d0)](_0x2d8c9a=>_0x11927e(_0x2d8c9a));await Promise[_0x3e3b75(0x20f)](_0x45462c),_0x21d64a[_0x3e3b75(0x227)](_0xd52da1);}),router[a0_0x1951f2(0x1bf)](a0_0x1951f2(0x198),async(_0x403c0f,_0x4c5337)=>{var _0x1e5911=a0_0x1951f2;const {productCode:_0x42e3ff,bay:_0x140b29,warehouses:_0x73e55a,room:_0xfb6882}=_0x403c0f[_0x1e5911(0x22d)];console[_0x1e5911(0x1c2)](_0x403c0f['body']);try{const _0x47b8ed=await warehouse['aggregate']([{'$match':{'name':_0x73e55a,'room':_0xfb6882}},{'$unwind':_0x1e5911(0x1e3)},{'$match':{'product_details.bay':parseInt(_0x140b29)}},{'$group':{'_id':_0x1e5911(0x1fb),'name':{'$first':_0x1e5911(0x203)},'product_stock':{'$first':_0x1e5911(0x1d6)},'bay':{'$first':_0x1e5911(0x210)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4c5337['status'](0xc8)[_0x1e5911(0x227)](_0x47b8ed);}catch(_0x576997){_0x4c5337[_0x1e5911(0x204)](0x194)[_0x1e5911(0x227)]({'message':_0x576997[_0x1e5911(0x1e4)]});}}),module[a0_0x1951f2(0x1d7)]=router;