var a0_0x58e896=a0_0x50d6;(function(_0x28b719,_0x5e007c){var _0x233d07=a0_0x50d6,_0x25fae5=_0x28b719();while(!![]){try{var _0x814de7=-parseInt(_0x233d07(0x26f))/0x1*(parseInt(_0x233d07(0x22c))/0x2)+parseInt(_0x233d07(0x229))/0x3+-parseInt(_0x233d07(0x25d))/0x4*(parseInt(_0x233d07(0x236))/0x5)+-parseInt(_0x233d07(0x216))/0x6+parseInt(_0x233d07(0x21e))/0x7+-parseInt(_0x233d07(0x217))/0x8+parseInt(_0x233d07(0x1f9))/0x9;if(_0x814de7===_0x5e007c)break;else _0x25fae5['push'](_0x25fae5['shift']());}catch(_0x25a455){_0x25fae5['push'](_0x25fae5['shift']());}}}(a0_0x26b0,0x59c3a));const express=require(a0_0x58e896(0x219)),app=express(),router=express['Router'](),auth=require(a0_0x58e896(0x21f)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x58e896(0x25c)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x58e896(0x28a));router[a0_0x58e896(0x228)]('/view',auth,async(_0x236b02,_0x226f10)=>{var _0x37f58a=a0_0x58e896;try{const {username:_0x47669a,email:_0x7f682,role:_0x42e7fe}=_0x236b02['user'],_0x528de2=_0x236b02[_0x37f58a(0x261)],_0x3173e5=await profile[_0x37f58a(0x23f)]({'email':_0x528de2[_0x37f58a(0x23a)]}),_0x4d6365=await master_shop[_0x37f58a(0x201)]();let _0x377384;if(_0x528de2[_0x37f58a(0x218)]==_0x37f58a(0x27a)){const _0x40ad47=await staff['findOne']({'email':_0x528de2[_0x37f58a(0x23a)]});_0x377384=await warehouse[_0x37f58a(0x201)]({'status':'Enabled','name':_0x40ad47[_0x37f58a(0x233)]});}else _0x377384=await warehouse['find']({'status':_0x37f58a(0x24b)});const _0x3543f5=await product[_0x37f58a(0x201)]();let _0x3b4326;if(_0x528de2[_0x37f58a(0x218)]==_0x37f58a(0x27a)){const _0x5abaab=await staff[_0x37f58a(0x23f)]({'email':_0x528de2[_0x37f58a(0x23a)]});_0x3b4326=await adjustment_finished[_0x37f58a(0x201)]({'warehouse_name':_0x5abaab['warehouse']});}else _0x3b4326=await adjustment_finished[_0x37f58a(0x1f7)]([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0x37f58a(0x213)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x37f58a(0x298)},'warehouse_name':{'$first':_0x37f58a(0x222)},'room':{'$addToSet':_0x37f58a(0x254)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4d6365[0x0][_0x37f58a(0x274)]=='English\x20(US)'){var _0x2be10c=users[_0x37f58a(0x204)];console[_0x37f58a(0x296)](_0x2be10c);}else{if(_0x4d6365[0x0][_0x37f58a(0x274)]==_0x37f58a(0x235))var _0x2be10c=users[_0x37f58a(0x235)];else{if(_0x4d6365[0x0]['language']==_0x37f58a(0x20a))var _0x2be10c=users[_0x37f58a(0x20a)];else{if(_0x4d6365[0x0]['language']=='Spanish')var _0x2be10c=users['Spanish'];else{if(_0x4d6365[0x0][_0x37f58a(0x274)]=='French')var _0x2be10c=users[_0x37f58a(0x205)];else{if(_0x4d6365[0x0][_0x37f58a(0x274)]=='Portuguese\x20(BR)')var _0x2be10c=users[_0x37f58a(0x257)];else{if(_0x4d6365[0x0][_0x37f58a(0x274)]==_0x37f58a(0x208))var _0x2be10c=users[_0x37f58a(0x208)];else{if(_0x4d6365[0x0]['language']==_0x37f58a(0x220))var _0x2be10c=users['Arabic'];}}}}}}}_0x226f10[_0x37f58a(0x240)](_0x37f58a(0x290),{'success':_0x236b02[_0x37f58a(0x284)]('success'),'errors':_0x236b02['flash'](_0x37f58a(0x1fd)),'role':_0x528de2,'profile':_0x3173e5,'warehouse':_0x377384,'product':_0x3543f5,'adjustment':_0x3b4326,'master_shop':_0x4d6365,'language':_0x2be10c});}catch(_0x3e37d7){console[_0x37f58a(0x296)](_0x3e37d7);}}),router[a0_0x58e896(0x228)]('/view_logs',auth,async(_0x2bf007,_0x4d1828)=>{var _0x380254=a0_0x58e896;try{const {username:_0x475b67,email:_0x27a19a,role:_0x2d5fa5}=_0x2bf007[_0x380254(0x261)],_0x192d74=_0x2bf007[_0x380254(0x261)],_0x10f03b=await profile[_0x380254(0x23f)]({'email':_0x192d74[_0x380254(0x23a)]}),_0x4de9a4=await master_shop[_0x380254(0x201)]();let _0x327f7d;if(_0x192d74[_0x380254(0x218)]==_0x380254(0x27a)){const _0x29ea1f=await staff[_0x380254(0x23f)]({'email':_0x192d74['email']});_0x327f7d=await warehouse[_0x380254(0x201)]({'status':_0x380254(0x24b),'name':_0x29ea1f['warehouse']});}else _0x327f7d=await warehouse[_0x380254(0x201)]({'status':_0x380254(0x24b)});const _0x579ea2=await product[_0x380254(0x201)]();let _0x4c36ab;if(_0x192d74['role']=='staff'){const _0x977853=await staff[_0x380254(0x23f)]({'email':_0x192d74[_0x380254(0x23a)]});_0x4c36ab=await adjustment_finished[_0x380254(0x201)]({'warehouse_name':_0x977853['warehouse']});}else _0x4c36ab=await adjustment_finished[_0x380254(0x1f7)]([{'$match':{'type_of_transaction':_0x380254(0x283)}},{'$unwind':_0x380254(0x213)},{'$group':{'_id':'$_id','invoice':{'$first':_0x380254(0x271)},'date':{'$first':_0x380254(0x298)},'warehouse_name':{'$first':_0x380254(0x222)},'room':{'$addToSet':_0x380254(0x254)},'finalize':{'$first':_0x380254(0x287)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4de9a4[0x0][_0x380254(0x274)]==_0x380254(0x276))var _0x17baf5=users[_0x380254(0x204)];else{if(_0x4de9a4[0x0][_0x380254(0x274)]==_0x380254(0x235))var _0x17baf5=users[_0x380254(0x235)];else{if(_0x4de9a4[0x0][_0x380254(0x274)]==_0x380254(0x20a))var _0x17baf5=users[_0x380254(0x20a)];else{if(_0x4de9a4[0x0][_0x380254(0x274)]=='Spanish')var _0x17baf5=users[_0x380254(0x263)];else{if(_0x4de9a4[0x0][_0x380254(0x274)]=='French')var _0x17baf5=users[_0x380254(0x205)];else{if(_0x4de9a4[0x0][_0x380254(0x274)]==_0x380254(0x295))var _0x17baf5=users['Portuguese'];else{if(_0x4de9a4[0x0]['language']==_0x380254(0x208))var _0x17baf5=users['Chinese'];else{if(_0x4de9a4[0x0][_0x380254(0x274)]==_0x380254(0x220))var _0x17baf5=users['Arabic'];}}}}}}}_0x4d1828[_0x380254(0x240)](_0x380254(0x25a),{'success':_0x2bf007[_0x380254(0x284)](_0x380254(0x1fa)),'errors':_0x2bf007[_0x380254(0x284)](_0x380254(0x1fd)),'role':_0x192d74,'profile':_0x10f03b,'warehouse':_0x327f7d,'product':_0x579ea2,'adjustment':_0x4c36ab,'master_shop':_0x4de9a4,'language':_0x17baf5});}catch(_0x430017){console['log'](_0x430017);}});function a0_0x50d6(_0x30c1a4,_0x3647db){var _0x26b0c3=a0_0x26b0();return a0_0x50d6=function(_0x50d6b1,_0x4cfdb7){_0x50d6b1=_0x50d6b1-0x1ed;var _0x3558e0=_0x26b0c3[_0x50d6b1];return _0x3558e0;},a0_0x50d6(_0x30c1a4,_0x3647db);}async function getRandom8DigitNumber(){var _0x58cfcd=a0_0x58e896;const _0x37288a=0x989680,_0x408f92=0x5f5e0ff,_0x551a31=Math[_0x58cfcd(0x245)](Math[_0x58cfcd(0x285)]()*(_0x408f92-_0x37288a+0x1))+_0x37288a;var _0x2b1d3c;const _0x16bf66=await adjustment_finished['findOne']({'invoice':_0x58cfcd(0x293)+_0x551a31});return _0x16bf66&&_0x16bf66[_0x58cfcd(0x28f)]>0x0?_0x2b1d3c='ADJF-'+_0x551a31:_0x2b1d3c='ADJF-'+_0x551a31,_0x2b1d3c;}router[a0_0x58e896(0x228)](a0_0x58e896(0x250),auth,async(_0x22578c,_0x5527ae)=>{var _0x45ad04=a0_0x58e896;try{const {username:_0x14e8ea,email:_0xcd7bd7,role:_0x2989ca}=_0x22578c[_0x45ad04(0x261)],_0x24d074=_0x22578c[_0x45ad04(0x261)],_0x5cebb1=await profile[_0x45ad04(0x23f)]({'email':_0x24d074[_0x45ad04(0x23a)]}),_0x7475e1=await master_shop[_0x45ad04(0x201)]();let _0x16c3b4;if(_0x24d074[_0x45ad04(0x218)]=='staff'){const _0x2b891c=await staff[_0x45ad04(0x23f)]({'email':_0x24d074[_0x45ad04(0x23a)]});_0x16c3b4=await warehouse[_0x45ad04(0x1f7)]([{'$match':{'status':'Enabled','name':_0x2b891c['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x45ad04(0x281)}}}]);}else _0x16c3b4=await warehouse[_0x45ad04(0x1f7)]([{'$match':{'status':_0x45ad04(0x24b)}},{'$group':{'_id':'$name','name':{'$first':_0x45ad04(0x281)}}}]);const _0x30098b=await product[_0x45ad04(0x201)]({}),_0x51592c=await adjustment_finished[_0x45ad04(0x201)](),_0x439b8c=_0x51592c[_0x45ad04(0x28f)]+0x1,_0x289138=_0x45ad04(0x293)+_0x439b8c[_0x45ad04(0x24a)]()[_0x45ad04(0x267)](0x5,'0');var _0x566f5a=['Ambient','Enclosed','Return\x20Rooms'];if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x276))var _0x199a45=users[_0x45ad04(0x204)];else{if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x235))var _0x199a45=users[_0x45ad04(0x235)];else{if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x20a))var _0x199a45=users[_0x45ad04(0x20a)];else{if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x263))var _0x199a45=users['Spanish'];else{if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x205))var _0x199a45=users[_0x45ad04(0x205)];else{if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x295))var _0x199a45=users[_0x45ad04(0x257)];else{if(_0x7475e1[0x0][_0x45ad04(0x274)]==_0x45ad04(0x208))var _0x199a45=users[_0x45ad04(0x208)];else{if(_0x7475e1[0x0]['language']==_0x45ad04(0x220))var _0x199a45=users[_0x45ad04(0x26d)];}}}}}}}const _0x1262c8=getRandom8DigitNumber();_0x1262c8[_0x45ad04(0x272)](_0x3cb82e=>{var _0x528db4=_0x45ad04;_0x5527ae[_0x528db4(0x240)]('add_adjustment_finished',{'success':_0x22578c[_0x528db4(0x284)](_0x528db4(0x1fa)),'errors':_0x22578c[_0x528db4(0x284)](_0x528db4(0x1fd)),'role':_0x24d074,'profile':_0x5cebb1,'warehouse':_0x16c3b4,'product':_0x30098b,'master_shop':_0x7475e1,'language':_0x199a45,'rooms_data':_0x566f5a,'invoice_no':_0x3cb82e});})['catch'](_0xf0edd7=>{var _0xdeca99=_0x45ad04;_0x22578c[_0xdeca99(0x284)](_0xdeca99(0x1fd),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5527ae[_0xdeca99(0x242)]('/adjustment/view');});}catch(_0x3a95aa){console[_0x45ad04(0x296)](_0x3a95aa);}}),router[a0_0x58e896(0x1ed)](a0_0x58e896(0x250),auth,async(_0x1a4aec,_0x48a3e6)=>{var _0x54e7d1=a0_0x58e896;try{const {warehouse_name:_0x141471,date:_0x37470f,prod_name:_0x4a0983,level:_0x16070c,isle:_0x45741a,pallet:_0x2b8270,stock:_0x2a4da5,types:_0x419a00,adjust_qty:_0x225d7a,new_adjust_qty:_0x41c7d7,note:_0x4695ea,Room_name:_0x16d848,JO_number:_0x6c253c,expiry_date:_0x2ed423,PO_number:_0x136635,ReqBy:_0x2e5ec1,dateofreq:_0x58c478,typeservicesData:_0x4da454,destination:_0x550473,deliverydate:_0x4a65aa,driver:_0x3d7d1e,plate:_0x23c98e,van:_0x4fa4b6,DRSI:_0x581ae8,typevehicle:_0x595dca,TSU:_0x41527a,TFU:_0x36ca0e}=_0x1a4aec[_0x54e7d1(0x210)];if(typeof _0x4a0983==_0x54e7d1(0x232))var _0x1ed5b6=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x259)]],_0xdc9906=[_0x1a4aec[_0x54e7d1(0x210)]['level']],_0x235a41=[_0x1a4aec[_0x54e7d1(0x210)]['stock']],_0x5d97af=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x22d)]],_0x4dc9c0=[_0x1a4aec[_0x54e7d1(0x210)]['New_Qty_Converted_adj']],_0x1ab8d7=[_0x1a4aec['body'][_0x54e7d1(0x27b)]],_0x327a28=[_0x1a4aec['body'][_0x54e7d1(0x294)]],_0x26ca73=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x280)]],_0x1a677e=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x299)]],_0x5df5df=[_0x1a4aec[_0x54e7d1(0x210)]['batch_code']],_0x2b811a=[_0x1a4aec[_0x54e7d1(0x210)]['expiry_date']],_0x421beb=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x1fb)]],_0x378f0c=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x246)]],_0x4d1203=[_0x1a4aec[_0x54e7d1(0x210)]['Rooms']],_0x41af89=[_0x1a4aec['body'][_0x54e7d1(0x269)]],_0x32f225=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x1ef)]],_0xcbb503=[_0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x211)]];else var _0x1ed5b6=[..._0x1a4aec['body']['prod_name']],_0xdc9906=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x237)]],_0x235a41=[..._0x1a4aec['body'][_0x54e7d1(0x231)]],_0x5d97af=[..._0x1a4aec[_0x54e7d1(0x210)]['types']],_0x4dc9c0=[..._0x1a4aec[_0x54e7d1(0x210)]['New_Qty_Converted_adj']],_0x1ab8d7=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x27b)]],_0x327a28=[..._0x1a4aec['body'][_0x54e7d1(0x294)]],_0x26ca73=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x280)]],_0x1a677e=[..._0x1a4aec[_0x54e7d1(0x210)]['prod_code']],_0x5df5df=[..._0x1a4aec['body'][_0x54e7d1(0x251)]],_0x2b811a=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x21a)]],_0x421beb=[..._0x1a4aec['body'][_0x54e7d1(0x1fb)]],_0x378f0c=[..._0x1a4aec['body']['prod_cat']],_0x4d1203=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x253)]],_0x41af89=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x269)]],_0x32f225=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x1ef)]],_0xcbb503=[..._0x1a4aec[_0x54e7d1(0x210)][_0x54e7d1(0x211)]];const _0x330a6c=_0x1ed5b6[_0x54e7d1(0x27f)](_0x2f2b32=>{return _0x2f2b32={'product_name':_0x2f2b32};});_0xdc9906[_0x54e7d1(0x27c)]((_0x142306,_0x435213)=>{var _0x31b1d5=_0x54e7d1,_0x4606a7=_0x142306[_0x31b1d5(0x21d)](/[A-Za-z]+/)[0x0],_0x56b0ab=parseInt(_0x142306[_0x31b1d5(0x21d)](/\d+/)[0x0]);_0x330a6c[_0x435213]['level']=_0x4606a7,_0x330a6c[_0x435213][_0x31b1d5(0x202)]=_0x56b0ab;}),_0xcbb503[_0x54e7d1(0x27c)]((_0x36ad92,_0x262eb9)=>{var _0x593945=_0x54e7d1;_0x330a6c[_0x262eb9][_0x593945(0x239)]=_0x36ad92;}),_0x235a41[_0x54e7d1(0x27c)]((_0x307267,_0x57c279)=>{var _0x177f1b=_0x54e7d1;_0x330a6c[_0x57c279][_0x177f1b(0x279)]=_0x307267;}),_0x5d97af[_0x54e7d1(0x27c)]((_0x5c9ef5,_0x18bae9)=>{var _0x20f890=_0x54e7d1;_0x330a6c[_0x18bae9][_0x20f890(0x22d)]=_0x5c9ef5;}),_0x4dc9c0[_0x54e7d1(0x27c)]((_0x7b4d40,_0x3ca3ff)=>{_0x330a6c[_0x3ca3ff]['adjust_qty']=_0x7b4d40;}),_0x1ab8d7[_0x54e7d1(0x27c)]((_0x1b8362,_0x2fd091)=>{var _0x3afa1b=_0x54e7d1;_0x330a6c[_0x2fd091][_0x3afa1b(0x25f)]=_0x1b8362;}),_0x327a28['forEach']((_0x230d31,_0x3bf69a)=>{var _0x232bb4=_0x54e7d1;_0x330a6c[_0x3bf69a][_0x232bb4(0x1ff)]=_0x230d31;}),_0x26ca73[_0x54e7d1(0x27c)]((_0x4b953c,_0x236e5c)=>{var _0x1d4d23=_0x54e7d1;_0x330a6c[_0x236e5c][_0x1d4d23(0x25e)]=_0x4b953c;}),_0x1a677e[_0x54e7d1(0x27c)]((_0xac788c,_0x58fb4c)=>{var _0x47b2c5=_0x54e7d1;_0x330a6c[_0x58fb4c][_0x47b2c5(0x260)]=_0xac788c;}),_0x5df5df[_0x54e7d1(0x27c)]((_0x407f10,_0x184419)=>{var _0x35b3f5=_0x54e7d1;_0x330a6c[_0x184419][_0x35b3f5(0x251)]=_0x407f10;}),_0x2b811a[_0x54e7d1(0x27c)]((_0x123460,_0x4dfe9c)=>{var _0x110771=_0x54e7d1;_0x330a6c[_0x4dfe9c][_0x110771(0x21a)]=_0x123460;}),_0x421beb[_0x54e7d1(0x27c)]((_0x582d57,_0x233bd2)=>{var _0x375876=_0x54e7d1;_0x330a6c[_0x233bd2][_0x375876(0x20b)]=_0x582d57;}),_0x378f0c[_0x54e7d1(0x27c)]((_0x1f930d,_0x4b0a86)=>{_0x330a6c[_0x4b0a86]['prod_cat']=_0x1f930d;}),_0x4d1203[_0x54e7d1(0x27c)]((_0x1e52d0,_0x39cfec)=>{_0x330a6c[_0x39cfec]['room_names']=_0x1e52d0;}),_0x41af89[_0x54e7d1(0x27c)]((_0x1f0039,_0xce9067)=>{var _0x5783ab=_0x54e7d1;_0x330a6c[_0xce9067][_0x5783ab(0x269)]=_0x1f0039;}),_0x32f225[_0x54e7d1(0x27c)]((_0xfac376,_0xcf7f18)=>{_0x330a6c[_0xcf7f18]['invoice']=_0xfac376;});const _0x5f0810=_0x330a6c['filter'](_0x2d25ab=>_0x2d25ab[_0x54e7d1(0x28c)]!=='0'&&_0x2d25ab['adjust_qty']!=='');var _0x8651fa=0x0;_0x5f0810['forEach'](_0x414bf2=>{var _0x579708=_0x54e7d1;console['log'](_0x579708(0x29b),_0x414bf2),parseInt(_0x414bf2['adjust_qty'])<=0x0&&_0x8651fa++;});if(_0x8651fa!=0x0)return _0x1a4aec[_0x54e7d1(0x284)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x48a3e6[_0x54e7d1(0x242)](_0x54e7d1(0x266));const _0x84f8b5=new invoice_for_adjustment();await _0x84f8b5[_0x54e7d1(0x212)]();const _0x2090ea=new adjustment_finished({'warehouse_name':_0x141471,'date':_0x37470f,'product':_0x5f0810,'note':_0x4695ea,'room':_0x16d848,'invoice':'ADJ-'+_0x84f8b5[_0x54e7d1(0x224)][_0x54e7d1(0x24a)]()[_0x54e7d1(0x267)](0x8,'0'),'JO_number':_0x6c253c,'expiry_date':_0x2ed423,'PO_number':_0x136635,'RequestedBy':_0x2e5ec1,'DateofRequest':_0x58c478,'typeservices':_0x4da454,'destination':_0x550473,'deliverydate':_0x4a65aa,'driver':_0x3d7d1e,'plate':_0x23c98e,'van':_0x4fa4b6,'DRSI':_0x581ae8,'typevehicle':_0x595dca,'TSU':_0x41527a,'TFU':_0x36ca0e}),_0x39f292=await _0x2090ea[_0x54e7d1(0x212)]();_0x1a4aec[_0x54e7d1(0x284)](_0x54e7d1(0x1fa),_0x54e7d1(0x26e)),_0x48a3e6[_0x54e7d1(0x242)]('/adjustment_finished/preview/'+_0x39f292['_id']);}catch(_0x33804f){console['log'](_0x33804f),_0x48a3e6[_0x54e7d1(0x247)](0xc8)['json']({'message':_0x33804f[_0x54e7d1(0x26c)]});}}),router[a0_0x58e896(0x228)](a0_0x58e896(0x24e),auth,async(_0x468768,_0x40c9e9)=>{var _0x42e5fe=a0_0x58e896;try{const {username:_0x2c8c1f,email:_0x2a275c,role:_0x39459a}=_0x468768['user'],_0x472eb7=_0x468768[_0x42e5fe(0x261)],_0x5b8155=await profile[_0x42e5fe(0x23f)]({'email':_0x472eb7[_0x42e5fe(0x23a)]}),_0x508210=await master_shop[_0x42e5fe(0x201)]();let _0x25c56b;if(_0x472eb7[_0x42e5fe(0x218)]==_0x42e5fe(0x27a)){const _0x21a903=await staff['findOne']({'email':_0x472eb7[_0x42e5fe(0x23a)]});_0x25c56b=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x21a903['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x42e5fe(0x281)}}}]);}else _0x25c56b=await warehouse[_0x42e5fe(0x1f7)]([{'$match':{'status':_0x42e5fe(0x24b)}},{'$group':{'_id':'$name','name':{'$first':_0x42e5fe(0x281)}}}]);const _0xe84b59=await product[_0x42e5fe(0x201)](),_0x13fc86=await adjustment_finished[_0x42e5fe(0x201)](),_0x5ed887=_0x13fc86['length']+0x1,_0x98cb06='ADJF-'+_0x5ed887['toString']()['padStart'](0x5,'0');var _0x1deb3c=['Ambient','Enclosed','Return\x20Rooms'];if(_0x508210[0x0][_0x42e5fe(0x274)]==_0x42e5fe(0x276))var _0x38efd3=users['English'];else{if(_0x508210[0x0][_0x42e5fe(0x274)]==_0x42e5fe(0x235))var _0x38efd3=users[_0x42e5fe(0x235)];else{if(_0x508210[0x0][_0x42e5fe(0x274)]==_0x42e5fe(0x20a))var _0x38efd3=users[_0x42e5fe(0x20a)];else{if(_0x508210[0x0][_0x42e5fe(0x274)]==_0x42e5fe(0x263))var _0x38efd3=users[_0x42e5fe(0x263)];else{if(_0x508210[0x0]['language']=='French')var _0x38efd3=users[_0x42e5fe(0x205)];else{if(_0x508210[0x0][_0x42e5fe(0x274)]=='Portuguese\x20(BR)')var _0x38efd3=users['Portuguese'];else{if(_0x508210[0x0]['language']==_0x42e5fe(0x208))var _0x38efd3=users['Chinese'];else{if(_0x508210[0x0][_0x42e5fe(0x274)]=='Arabic\x20(ae)')var _0x38efd3=users[_0x42e5fe(0x26d)];}}}}}}}const _0x282132=getRandom8DigitNumber();_0x282132[_0x42e5fe(0x272)](_0x5cef2a=>{var _0x245263=_0x42e5fe;_0x40c9e9[_0x245263(0x240)](_0x245263(0x277),{'success':_0x468768[_0x245263(0x284)](_0x245263(0x1fa)),'errors':_0x468768['flash'](_0x245263(0x1fd)),'role':_0x472eb7,'profile':_0x5b8155,'warehouse':_0x25c56b,'product':_0xe84b59,'master_shop':_0x508210,'language':_0x38efd3,'rooms_data':_0x1deb3c,'invoice_no':_0x5cef2a});})[_0x42e5fe(0x214)](_0xe261d7=>{var _0x3acc32=_0x42e5fe;_0x468768[_0x3acc32(0x284)](_0x3acc32(0x1fd),_0x3acc32(0x1f3)),_0x40c9e9[_0x3acc32(0x242)](_0x3acc32(0x252));});}catch(_0x208281){console[_0x42e5fe(0x296)](_0x208281);}}),router[a0_0x58e896(0x1ed)](a0_0x58e896(0x24e),auth,async(_0x2f4e3b,_0x4a779a)=>{var _0x3873f5=a0_0x58e896;try{const {warehouse_name:_0x80992b,date:_0x4a64ac,prod_name:_0x47e59f,level:_0x13696c,isle:_0x2b88b9,pallet:_0x1eda0d,stock:_0x43f867,types:_0x5531c5,adjust_qty:_0x2561f7,new_adjust_qty:_0x398262,note:_0x3fc4c3,Room_name:_0x2c8f04,JO_number:_0x31a980,expiry_date:_0x1ef2f9,type_of_transaction:_0x291baa,PO_number:_0x261ed7,ReqBy:_0x16b1fa,dateofreq:_0x5a2374,typeservicesData:_0x255581,destination:_0x5f43ff,deliverydate:_0x4e9c95,driver:_0x5f0e6b,plate:_0x477715,van:_0xb54e55,DRSI:_0x3976c8,typevehicle:_0x19e596,TSU:_0x4473c3,TFU:_0x13598d}=_0x2f4e3b[_0x3873f5(0x210)];if(typeof _0x47e59f=='string')var _0xecc0dc=[_0x2f4e3b[_0x3873f5(0x210)]['prod_name']],_0x2a709b=[_0x2f4e3b[_0x3873f5(0x210)]['level']],_0x17a9ac=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x231)]],_0x30a8e2=[_0x2f4e3b['body'][_0x3873f5(0x22d)]],_0xd9b15d=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x230)]],_0x31fdbb=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x27b)]],_0x30c245=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x294)]],_0x2c03f5=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x280)]],_0x263b64=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x299)]],_0x5ae557=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x251)]],_0x24f036=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x21a)]],_0x43cd41=[_0x2f4e3b[_0x3873f5(0x210)]['product_date']],_0x655424=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x246)]],_0x158075=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x253)]],_0xa90b4c=[_0x2f4e3b['body'][_0x3873f5(0x269)]],_0x24562e=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x1ef)]],_0x5b87b3=[_0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x211)]];else var _0xecc0dc=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x259)]],_0x2a709b=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x237)]],_0x17a9ac=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x231)]],_0x30a8e2=[..._0x2f4e3b[_0x3873f5(0x210)]['types']],_0xd9b15d=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x230)]],_0x31fdbb=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x27b)]],_0x30c245=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x294)]],_0x2c03f5=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x280)]],_0x263b64=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x299)]],_0x5ae557=[..._0x2f4e3b[_0x3873f5(0x210)]['batch_code']],_0x24f036=[..._0x2f4e3b['body'][_0x3873f5(0x21a)]],_0x43cd41=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x1fb)]],_0x655424=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x246)]],_0x158075=[..._0x2f4e3b['body'][_0x3873f5(0x253)]],_0xa90b4c=[..._0x2f4e3b[_0x3873f5(0x210)]['maxPerUnit']],_0x24562e=[..._0x2f4e3b[_0x3873f5(0x210)]['prod_invoice']],_0x5b87b3=[..._0x2f4e3b[_0x3873f5(0x210)][_0x3873f5(0x211)]];const _0xab2d9a=_0xecc0dc[_0x3873f5(0x27f)](_0x83adae=>{return _0x83adae={'product_name':_0x83adae};});_0x2a709b['forEach']((_0x25bcf0,_0x7dcc60)=>{var _0x2a0162=_0x3873f5,_0x4d414c=_0x25bcf0[_0x2a0162(0x21d)](/[A-Za-z]+/)[0x0],_0x50270b=parseInt(_0x25bcf0['match'](/\d+/)[0x0]);_0xab2d9a[_0x7dcc60][_0x2a0162(0x237)]=_0x4d414c,_0xab2d9a[_0x7dcc60][_0x2a0162(0x202)]=_0x50270b;}),_0x5b87b3[_0x3873f5(0x27c)]((_0x2e036a,_0x54661f)=>{var _0x3bd61e=_0x3873f5;_0xab2d9a[_0x54661f][_0x3bd61e(0x239)]=_0x2e036a;}),_0x17a9ac[_0x3873f5(0x27c)]((_0x28983f,_0x8f381f)=>{var _0xab6052=_0x3873f5;_0xab2d9a[_0x8f381f][_0xab6052(0x279)]=_0x28983f;}),_0x30a8e2[_0x3873f5(0x27c)]((_0x5cd418,_0x5631e8)=>{var _0x4c96f0=_0x3873f5;_0xab2d9a[_0x5631e8][_0x4c96f0(0x22d)]=_0x5cd418;}),_0xd9b15d[_0x3873f5(0x27c)]((_0x5ce8df,_0x1c593a)=>{var _0x192cf7=_0x3873f5;_0xab2d9a[_0x1c593a][_0x192cf7(0x28c)]=_0x5ce8df;}),_0x31fdbb['forEach']((_0x759c86,_0x3f91b5)=>{var _0xe8beee=_0x3873f5;_0xab2d9a[_0x3f91b5][_0xe8beee(0x25f)]=_0x759c86;}),_0x30c245[_0x3873f5(0x27c)]((_0x39bd41,_0xcc313a)=>{_0xab2d9a[_0xcc313a]['unit']=_0x39bd41;}),_0x2c03f5['forEach']((_0x4263bf,_0x50e5ed)=>{var _0xd5fcea=_0x3873f5;_0xab2d9a[_0x50e5ed][_0xd5fcea(0x25e)]=_0x4263bf;}),_0x263b64[_0x3873f5(0x27c)]((_0x20aede,_0x643483)=>{var _0x30d4be=_0x3873f5;_0xab2d9a[_0x643483][_0x30d4be(0x260)]=_0x20aede;}),_0x5ae557[_0x3873f5(0x27c)]((_0x32a895,_0x5a8174)=>{var _0x5d9112=_0x3873f5;_0xab2d9a[_0x5a8174][_0x5d9112(0x251)]=_0x32a895;}),_0x24f036[_0x3873f5(0x27c)]((_0x4fd11a,_0x2a82a7)=>{_0xab2d9a[_0x2a82a7]['expiry_date']=_0x4fd11a;}),_0x43cd41['forEach']((_0x3efc60,_0x4354d0)=>{var _0x5b3adc=_0x3873f5;_0xab2d9a[_0x4354d0][_0x5b3adc(0x20b)]=_0x3efc60;}),_0x655424[_0x3873f5(0x27c)]((_0x3d1f3a,_0x49e005)=>{_0xab2d9a[_0x49e005]['prod_cat']=_0x3d1f3a;}),_0x158075[_0x3873f5(0x27c)]((_0xef96dc,_0x4b28a4)=>{_0xab2d9a[_0x4b28a4]['room_names']=_0xef96dc;}),_0xa90b4c[_0x3873f5(0x27c)]((_0x327b8f,_0x2a0de0)=>{var _0x1a22a3=_0x3873f5;_0xab2d9a[_0x2a0de0][_0x1a22a3(0x269)]=_0x327b8f;}),_0x24562e[_0x3873f5(0x27c)]((_0x533411,_0x42dee2)=>{_0xab2d9a[_0x42dee2]['invoice']=_0x533411;});const _0x1ef571=_0xab2d9a[_0x3873f5(0x286)](_0x2d6d17=>_0x2d6d17[_0x3873f5(0x28c)]!=='0'&&_0x2d6d17[_0x3873f5(0x28c)]!=='');var _0x5c5d99=0x0;_0x1ef571[_0x3873f5(0x27c)](_0x59446d=>{var _0x3354ac=_0x3873f5;console['log'](_0x3354ac(0x29b),_0x59446d),parseInt(_0x59446d[_0x3354ac(0x28c)])<=0x0&&_0x5c5d99++;});if(_0x5c5d99!=0x0)return _0x2f4e3b[_0x3873f5(0x284)](_0x3873f5(0x1fd),_0x3873f5(0x203)),_0x4a779a[_0x3873f5(0x242)](_0x3873f5(0x266));const _0x48a1c4=new adjustment_logs();await _0x48a1c4[_0x3873f5(0x212)]();const _0x22920c=new adjustment_finished({'warehouse_name':_0x80992b,'date':_0x4a64ac,'product':_0x1ef571,'note':_0x3fc4c3,'room':_0x2c8f04,'invoice':_0x3873f5(0x225)+_0x48a1c4[_0x3873f5(0x224)][_0x3873f5(0x24a)]()[_0x3873f5(0x267)](0x8,'0'),'JO_number':_0x31a980,'expiry_date':_0x1ef2f9,'type_of_transaction':_0x291baa,'PO_number':_0x261ed7,'RequestedBy':_0x16b1fa,'DateofRequest':_0x5a2374,'typeservices':_0x255581,'destination':_0x5f43ff,'deliverydate':_0x4e9c95,'driver':_0x5f0e6b,'plate':_0x477715,'van':_0xb54e55,'DRSI':_0x3976c8,'typevehicle':_0x19e596,'TSU':_0x4473c3,'TFU':_0x13598d}),_0x431621=await _0x22920c[_0x3873f5(0x212)]();_0x2f4e3b['flash'](_0x3873f5(0x1fa),'adjustment\x20add\x20successfull'),_0x4a779a[_0x3873f5(0x242)]('/adjustment_finished/preview/'+_0x431621[_0x3873f5(0x20e)]);}catch(_0x22781b){console[_0x3873f5(0x296)](_0x22781b),_0x4a779a['status'](0xc8)[_0x3873f5(0x226)]({'message':_0x22781b['message']});}}),router[a0_0x58e896(0x228)](a0_0x58e896(0x268),auth,async(_0x87107,_0x42919f)=>{var _0xc51907=a0_0x58e896;try{const {username:_0xe27c8a,email:_0x4bfddf,role:_0x459f25}=_0x87107[_0xc51907(0x261)],_0x5aede3=_0x87107['user'],_0x494e0a=await profile[_0xc51907(0x23f)]({'email':_0x5aede3[_0xc51907(0x23a)]}),_0x202922=await master_shop[_0xc51907(0x201)](),_0x2bfa77=_0x87107[_0xc51907(0x265)]['id'],_0x2ce089=await adjustment_finished['findById']({'_id':_0x2bfa77}),_0x2f7387=await purchases[_0xc51907(0x1f7)]([{'$match':{'warehouse_name':_0x2ce089[_0xc51907(0x241)]}},{'$unwind':_0xc51907(0x213)},{'$group':{'_id':_0xc51907(0x275)}}]);console['log'](_0xc51907(0x282),_0x2f7387);const _0x1d0996=await product['find']({}),_0x23b35f=await warehouse[_0xc51907(0x1f7)]([{'$match':{'name':_0x2ce089[_0xc51907(0x241)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xc51907(0x1fc),'name':{'$first':_0xc51907(0x256)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xc51907(0x221)},'bin':{'$first':_0xc51907(0x270)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0xc51907(0x23b)},'primary_code':{'$first':_0xc51907(0x234)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xc51907(0x24f)},'storage':{'$first':_0xc51907(0x28d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xc51907(0x288)},'production_date':{'$first':_0xc51907(0x21b)},'batch_code':{'$first':_0xc51907(0x29a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0xc51907(0x206)}}}]);if(_0x202922[0x0][_0xc51907(0x274)]==_0xc51907(0x276)){var _0x4418cc=users[_0xc51907(0x204)];console[_0xc51907(0x296)](_0x4418cc);}else{if(_0x202922[0x0][_0xc51907(0x274)]==_0xc51907(0x235))var _0x4418cc=users['Hindi'];else{if(_0x202922[0x0]['language']=='German')var _0x4418cc=users['German'];else{if(_0x202922[0x0][_0xc51907(0x274)]=='Spanish')var _0x4418cc=users[_0xc51907(0x263)];else{if(_0x202922[0x0]['language']==_0xc51907(0x205))var _0x4418cc=users[_0xc51907(0x205)];else{if(_0x202922[0x0][_0xc51907(0x274)]==_0xc51907(0x295))var _0x4418cc=users['Portuguese'];else{if(_0x202922[0x0]['language']=='Chinese')var _0x4418cc=users[_0xc51907(0x208)];else{if(_0x202922[0x0]['language']==_0xc51907(0x220))var _0x4418cc=users['Arabic'];}}}}}}}_0x42919f[_0xc51907(0x240)](_0xc51907(0x227),{'success':_0x87107['flash'](_0xc51907(0x1fa)),'errors':_0x87107[_0xc51907(0x284)](_0xc51907(0x1fd)),'role':_0x5aede3,'profile':_0x494e0a,'adjustment':_0x2ce089,'stock':_0x23b35f,'master_shop':_0x202922,'warehouse_name':_0x2f7387,'unit':_0x1d0996,'language':_0x4418cc});}catch(_0x384553){console[_0xc51907(0x296)](_0x384553),_0x42919f[_0xc51907(0x247)](0xc8)[_0xc51907(0x226)]({'message':_0x384553[_0xc51907(0x26c)]});}}),router[a0_0x58e896(0x1ed)]('/preview/:id',auth,async(_0x316470,_0x5a01f7)=>{var _0x4824e7=a0_0x58e896;try{const {invoice:_0x1a24b4,warehouse_name:_0x1b95c8,Room_name:_0x424512}=_0x316470[_0x4824e7(0x210)],_0x28ab7e=_0x316470[_0x4824e7(0x265)]['id'],_0x528bd6=await adjustment_finished[_0x4824e7(0x28b)]({'_id':_0x28ab7e});var _0xd262da;const _0x1a107e=_0x528bd6['product'][_0x4824e7(0x27f)](async _0x4601b3=>{var _0x508dde=_0x4824e7;if(_0x4601b3[_0x508dde(0x28c)]>0x0){_0xd262da=await warehouse['findOne']({'name':_0x1b95c8,'room':_0x4601b3[_0x508dde(0x289)]});const _0x412161=_0xd262da[_0x508dde(0x223)]['map'](_0x7b4e5c=>{var _0x231bc9=_0x508dde;console[_0x231bc9(0x296)](_0x4601b3[_0x231bc9(0x22d)]);if(_0x4601b3[_0x231bc9(0x22d)]==_0x231bc9(0x22a))_0x7b4e5c[_0x231bc9(0x20e)]==_0x4601b3[_0x231bc9(0x239)]&&(_0x7b4e5c[_0x231bc9(0x26a)]=_0x7b4e5c[_0x231bc9(0x26a)]-_0x4601b3[_0x231bc9(0x28c)]);else _0x4601b3['types']==_0x231bc9(0x238)&&(_0x7b4e5c[_0x231bc9(0x20e)]==_0x4601b3[_0x231bc9(0x239)]&&(_0x7b4e5c[_0x231bc9(0x26a)]=_0x7b4e5c[_0x231bc9(0x26a)]+_0x4601b3[_0x231bc9(0x28c)]));});}return _0xd262da;});Promise['all'](_0x1a107e)[_0x4824e7(0x272)](async _0x2d506d=>{var _0x298113=_0x4824e7;try{for(const _0x565b99 of _0x2d506d){await _0x565b99[_0x298113(0x212)]();}_0x528bd6[_0x298113(0x291)]='True';const _0x18edb6=await _0x528bd6[_0x298113(0x212)](),_0x10d1b6=await master_shop[_0x298113(0x201)](),_0x3f604e=await email_settings[_0x298113(0x23f)](),_0x3e7199=await supervisor_settings[_0x298113(0x201)]();var _0x2d2bb9=_0x528bd6[_0x298113(0x26b)],_0x58636b='',_0x29df57;for(_0x29df57 in _0x2d2bb9){var _0x3870cd='FG';_0x528bd6[_0x298113(0x241)]==_0x298113(0x292)&&(_0x3870cd='DG'),_0x58636b+=_0x298113(0x297)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d2bb9[_0x29df57]['product_name']+_0x298113(0x1f1)+_0x298113(0x249)+_0x2d2bb9[_0x29df57][_0x298113(0x260)]+_0x298113(0x1f1)+_0x298113(0x249)+_0x2d2bb9[_0x29df57]['adjust_qty']+'</td>'+_0x298113(0x249)+_0x2d2bb9[_0x29df57]['unit']+_0x298113(0x1f1)+_0x298113(0x249)+_0x2d2bb9[_0x29df57]['secondary_unit']+_0x298113(0x1f1)+_0x298113(0x249)+_0x528bd6['warehouse_name']+_0x298113(0x1f1)+_0x298113(0x249)+_0x2d2bb9[_0x29df57]['room_names']+_0x298113(0x1f1)+_0x298113(0x249)+_0x3870cd+_0x2d2bb9[_0x29df57][_0x298113(0x202)]+'</td>'+_0x298113(0x22e);}_0x316470[_0x298113(0x284)](_0x298113(0x1fa),_0x298113(0x207)),_0x5a01f7[_0x298113(0x242)](_0x298113(0x24d)+_0x18edb6[_0x298113(0x20e)]);}catch(_0x1185c9){console[_0x298113(0x20d)](_0x1185c9),_0x5a01f7[_0x298113(0x247)](0x1f4)[_0x298113(0x226)]({'error':_0x298113(0x22b)});}})['catch'](_0x2347c3=>{var _0x1a96a6=_0x4824e7;console['error'](_0x2347c3),_0x5a01f7[_0x1a96a6(0x247)](0x1f4)['json']({'error':_0x1a96a6(0x27e)});});}catch(_0x4e0b1f){_0x5a01f7[_0x4824e7(0x226)]({'message':_0x4e0b1f[_0x4824e7(0x26c)]});}}),router['get'](a0_0x58e896(0x1f8),auth,async(_0x3669a8,_0x1ce4b0)=>{var _0x2f818b=a0_0x58e896;try{const {username:_0x2510bf,email:_0x5aa0f0,role:_0x5d7ddd}=_0x3669a8['user'],_0x140bbf=_0x3669a8[_0x2f818b(0x261)],_0x16107e=await profile['findOne']({'email':_0x140bbf[_0x2f818b(0x23a)]}),_0x3fa469=await master_shop[_0x2f818b(0x201)]();console[_0x2f818b(0x296)](_0x2f818b(0x1ee),_0x3fa469);const _0x578ca4=_0x3669a8[_0x2f818b(0x265)]['id'],_0x230448=await adjustment_finished[_0x2f818b(0x28b)]({'_id':_0x578ca4});let _0x46018d=new Date(_0x230448[_0x2f818b(0x21a)]),_0xc60f9f=('0'+_0x46018d[_0x2f818b(0x21c)]())[_0x2f818b(0x1f4)](-0x2),_0xbb53b5=('0'+(_0x46018d[_0x2f818b(0x243)]()+0x1))[_0x2f818b(0x1f4)](-0x2),_0xb1525c=_0x46018d[_0x2f818b(0x278)](),_0x392058=_0xb1525c+'-'+_0xbb53b5+'-'+_0xc60f9f;var _0x507fd7=['Ambient',_0x2f818b(0x1fe),_0x2f818b(0x28e)];const _0x32ea8c=await purchases[_0x2f818b(0x1f7)]([{'$match':{'warehouse_name':_0x230448[_0x2f818b(0x241)]}},{'$unwind':_0x2f818b(0x213)},{'$group':{'_id':_0x2f818b(0x275)}}]);console[_0x2f818b(0x296)](_0x2f818b(0x282),_0x32ea8c);const _0x360c9e=await product[_0x2f818b(0x201)]({}),_0x260c40=await warehouse['aggregate']([{'$match':{'name':_0x230448[_0x2f818b(0x241)],'room':_0x230448['room']}},{'$unwind':_0x2f818b(0x1f2)},{'$group':{'_id':_0x2f818b(0x1fc),'name':{'$first':_0x2f818b(0x256)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x2f818b(0x221)},'bin':{'$first':_0x2f818b(0x270)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2f818b(0x23b)},'primary_code':{'$first':_0x2f818b(0x234)},'secondary_code':{'$first':_0x2f818b(0x258)},'product_code':{'$first':_0x2f818b(0x24f)},'storage':{'$first':_0x2f818b(0x28d)},'rack':{'$first':_0x2f818b(0x22f)}}}]);if(_0x3fa469[0x0]['language']==_0x2f818b(0x276)){var _0x123ad5=users[_0x2f818b(0x204)];console['log'](_0x123ad5);}else{if(_0x3fa469[0x0][_0x2f818b(0x274)]==_0x2f818b(0x235))var _0x123ad5=users[_0x2f818b(0x235)];else{if(_0x3fa469[0x0][_0x2f818b(0x274)]==_0x2f818b(0x20a))var _0x123ad5=users[_0x2f818b(0x20a)];else{if(_0x3fa469[0x0]['language']==_0x2f818b(0x263))var _0x123ad5=users[_0x2f818b(0x263)];else{if(_0x3fa469[0x0][_0x2f818b(0x274)]==_0x2f818b(0x205))var _0x123ad5=users[_0x2f818b(0x205)];else{if(_0x3fa469[0x0][_0x2f818b(0x274)]==_0x2f818b(0x295))var _0x123ad5=users[_0x2f818b(0x257)];else{if(_0x3fa469[0x0]['language']==_0x2f818b(0x208))var _0x123ad5=users['Chinese'];else{if(_0x3fa469[0x0]['language']==_0x2f818b(0x220))var _0x123ad5=users[_0x2f818b(0x26d)];}}}}}}}_0x1ce4b0[_0x2f818b(0x240)](_0x2f818b(0x27d),{'success':_0x3669a8[_0x2f818b(0x284)](_0x2f818b(0x1fa)),'errors':_0x3669a8[_0x2f818b(0x284)](_0x2f818b(0x1fd)),'role':_0x140bbf,'profile':_0x16107e,'adjustment':_0x230448,'stock':_0x260c40,'master_shop':_0x3fa469,'warehouse_name':_0x32ea8c,'unit':_0x360c9e,'language':_0x123ad5,'rooms_data':_0x507fd7,'ed_fullDate':_0x392058});}catch(_0x3b0c16){console[_0x2f818b(0x296)](_0x3b0c16),_0x1ce4b0['status'](0xc8)[_0x2f818b(0x226)]({'message':_0x3b0c16['message']});}}),router[a0_0x58e896(0x1ed)](a0_0x58e896(0x1f8),auth,async(_0x56c9da,_0x137c34)=>{var _0x4486e5=a0_0x58e896;try{const _0x516567=_0x56c9da[_0x4486e5(0x265)]['id'],_0x37c459=await adjustment_finished[_0x4486e5(0x28b)]({'_id':_0x516567}),_0x325c2f=await warehouse['findOne']({'name':_0x37c459[_0x4486e5(0x241)],'room':_0x37c459[_0x4486e5(0x262)]}),{warehouse_name:_0x52f9af,date:_0x4a6899,prod_name:_0x5591d7,level:_0x5271a9,isle:_0x3509fd,pallet:_0x36ded2,stock:_0x599d03,types:_0x5ae8d8,adjust_qty:_0x1b074d,new_adjust_qty:_0x1e3974,note:_0x4a0495,Room_name:_0x3f1723,invoice:_0x3fdc8e,JO_number:_0x4b0959}=_0x56c9da['body'];if(typeof _0x5591d7==_0x4486e5(0x232))var _0x3cb2b0=[_0x56c9da['body'][_0x4486e5(0x259)]],_0x36e306=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x237)]],_0x46ad8c=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x231)]],_0x27be12=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x22d)]],_0x1302c3=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x28c)]],_0x222a18=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x25f)]],_0x2a08bc=[_0x56c9da[_0x4486e5(0x210)]['prod_code']],_0x3b7f1a=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x1ff)]],_0xb4c0c8=[_0x56c9da[_0x4486e5(0x210)]['Secondary_units']],_0x29708c=[_0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x251)]],_0x42788f=[_0x56c9da['body'][_0x4486e5(0x21a)]];else var _0x3cb2b0=[..._0x56c9da['body'][_0x4486e5(0x259)]],_0x36e306=[..._0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x237)]],_0x46ad8c=[..._0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x231)]],_0x27be12=[..._0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x22d)]],_0x1302c3=[..._0x56c9da['body'][_0x4486e5(0x28c)]],_0x222a18=[..._0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x25f)]],_0x2a08bc=[..._0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x299)]],_0x3b7f1a=[..._0x56c9da[_0x4486e5(0x210)][_0x4486e5(0x1ff)]],_0xb4c0c8=[..._0x56c9da['body'][_0x4486e5(0x280)]],_0x29708c=[..._0x56c9da[_0x4486e5(0x210)]['batch_code']],_0x42788f=[..._0x56c9da['body'][_0x4486e5(0x21a)]];const _0x187523=_0x3cb2b0[_0x4486e5(0x27f)](_0x46e30c=>{return _0x46e30c={'product_name':_0x46e30c};});_0x36e306[_0x4486e5(0x27c)]((_0x551982,_0x425d49)=>{_0x187523[_0x425d49]['bay']=_0x551982;}),_0x46ad8c[_0x4486e5(0x27c)]((_0x454828,_0x1a69de)=>{_0x187523[_0x1a69de]['stockBefore']=_0x454828;}),_0x27be12[_0x4486e5(0x27c)]((_0x12f7a8,_0x2a955e)=>{var _0x28ac5d=_0x4486e5;_0x187523[_0x2a955e][_0x28ac5d(0x22d)]=_0x12f7a8;}),_0x1302c3['forEach']((_0xfa4208,_0x5431aa)=>{var _0x809435=_0x4486e5;_0x187523[_0x5431aa][_0x809435(0x28c)]=_0xfa4208;}),_0x222a18['forEach']((_0x1c7bbf,_0x3d1829)=>{_0x187523[_0x3d1829]['new_adjust_qty']=_0x1c7bbf;}),_0x3b7f1a[_0x4486e5(0x27c)]((_0x50ff44,_0x54fe84)=>{var _0x15f5dd=_0x4486e5;_0x187523[_0x54fe84][_0x15f5dd(0x1ff)]=_0x50ff44;}),_0xb4c0c8[_0x4486e5(0x27c)]((_0x64df53,_0x3c3abf)=>{_0x187523[_0x3c3abf]['secondary_unit']=_0x64df53;}),_0x2a08bc[_0x4486e5(0x27c)]((_0x562bd7,_0x4303ab)=>{_0x187523[_0x4303ab]['product_code']=_0x562bd7;}),_0x29708c['forEach']((_0x3660ce,_0x28b6db)=>{var _0x3002ad=_0x4486e5;_0x187523[_0x28b6db][_0x3002ad(0x251)]=_0x3660ce;}),_0x42788f['forEach']((_0x19de49,_0x1f3d0c)=>{_0x187523[_0x1f3d0c]['expiry_date']=_0x19de49;});const _0x1bf92b=_0x187523[_0x4486e5(0x286)](_0x5b092d=>_0x5b092d['adjust_qty']!=='0'&&_0x5b092d[_0x4486e5(0x28c)]!=='');var _0x20aada=0x0;_0x1bf92b[_0x4486e5(0x27c)](_0x2d8e47=>{var _0x44530e=_0x4486e5;console[_0x44530e(0x296)](_0x44530e(0x29b),_0x2d8e47),parseInt(_0x2d8e47[_0x44530e(0x28c)])<=0x0&&_0x20aada++;});if(_0x20aada!=0x0)return _0x56c9da[_0x4486e5(0x284)](_0x4486e5(0x1fd),_0x4486e5(0x203)),_0x137c34[_0x4486e5(0x242)](_0x4486e5(0x266));_0x37c459['warehouse_name']=_0x52f9af,_0x37c459['date']=_0x4a6899,_0x37c459[_0x4486e5(0x26b)]=_0x1bf92b,_0x37c459[_0x4486e5(0x29c)]=_0x4a0495,_0x37c459[_0x4486e5(0x262)]=_0x3f1723,_0x37c459['invoice']=_0x3fdc8e,_0x37c459[_0x4486e5(0x244)]=_0x4b0959;const _0x443340=await _0x37c459[_0x4486e5(0x212)](),_0x481332=await warehouse[_0x4486e5(0x23f)]({'name':_0x52f9af,'room':_0x3f1723});_0x443340[_0x4486e5(0x26b)][_0x4486e5(0x27c)](_0x5c1062=>{var _0x2f104b=_0x4486e5;const _0xfe3fc3=_0x481332[_0x2f104b(0x223)][_0x2f104b(0x27f)](_0x4e0f74=>{var _0x1a55a7=_0x2f104b;_0x5c1062[_0x1a55a7(0x22d)]==_0x1a55a7(0x22a)?_0x4e0f74[_0x1a55a7(0x1f5)]==_0x5c1062[_0x1a55a7(0x1f5)]&&_0x4e0f74[_0x1a55a7(0x202)]==_0x5c1062[_0x1a55a7(0x202)]&&(_0x4e0f74[_0x1a55a7(0x26a)]=parseInt(_0x4e0f74['product_stock'])-parseInt(_0x5c1062[_0x1a55a7(0x28c)])):_0x4e0f74[_0x1a55a7(0x1f5)]==_0x5c1062[_0x1a55a7(0x1f5)]&&_0x4e0f74['bay']==_0x5c1062['bay']&&(_0x4e0f74[_0x1a55a7(0x26a)]=parseInt(_0x4e0f74[_0x1a55a7(0x26a)])+parseInt(_0x5c1062[_0x1a55a7(0x28c)]));});}),await _0x481332[_0x4486e5(0x212)](),_0x56c9da[_0x4486e5(0x284)](_0x4486e5(0x1fa),_0x4486e5(0x23e)),_0x137c34[_0x4486e5(0x242)](_0x4486e5(0x24c));}catch(_0x4b3888){console['log'](_0x4b3888);}}),router['post'](a0_0x58e896(0x215),async(_0x4e7f92,_0x83982)=>{var _0x310c5e=a0_0x58e896;const {primary_code:_0x2250a8,warehouse_data:_0x2ec25a,rooms_data:_0x44c8d0,Roomslist:_0x59b345}=_0x4e7f92[_0x310c5e(0x210)],_0x1a5f71=_0x59b345[_0x310c5e(0x248)](','),_0x23f4f1=[];async function _0x447a64(_0x3e512d){var _0x5d456a=_0x310c5e;const _0x35dbbc=await warehouse[_0x5d456a(0x1f7)]([{'$match':{'name':_0x2ec25a,'room':_0x3e512d}},{'$unwind':_0x5d456a(0x1f2)},{'$match':{'product_details.primary_code':_0x2250a8}},{'$group':{'_id':_0x5d456a(0x1fc),'name':{'$first':_0x5d456a(0x256)},'product_stock':{'$first':_0x5d456a(0x23d)},'primary_code':{'$first':_0x5d456a(0x234)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5d456a(0x24f)},'level':{'$first':_0x5d456a(0x209)},'bay':{'$first':_0x5d456a(0x221)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x5d456a(0x255)},'secondary_unit':{'$first':_0x5d456a(0x20f)},'storage':{'$first':_0x5d456a(0x28d)},'rack':{'$first':_0x5d456a(0x22f)},'expiry_date':{'$first':_0x5d456a(0x288)},'production_date':{'$first':_0x5d456a(0x21b)},'batch_code':{'$first':_0x5d456a(0x29a)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x5d456a(0x206)},'invoice':{'$first':_0x5d456a(0x273)}}}]),_0x1f54ed=await warehouse[_0x5d456a(0x1f7)]([{'$match':{'name':_0x2ec25a,'room':_0x3e512d}},{'$unwind':_0x5d456a(0x1f2)},{'$match':{'product_details.secondary_code':_0x2250a8}},{'$group':{'_id':_0x5d456a(0x1fc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5d456a(0x23d)},'primary_code':{'$first':_0x5d456a(0x234)},'secondary_code':{'$first':_0x5d456a(0x258)},'product_code':{'$first':_0x5d456a(0x24f)},'level':{'$first':_0x5d456a(0x209)},'bay':{'$first':_0x5d456a(0x221)},'type':{'$first':_0x5d456a(0x20c)},'pallet':{'$first':_0x5d456a(0x23b)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x5d456a(0x20f)},'storage':{'$first':_0x5d456a(0x28d)},'rack':{'$first':_0x5d456a(0x22f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5d456a(0x21b)},'batch_code':{'$first':_0x5d456a(0x29a)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5d456a(0x1f6)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x5d456a(0x273)}}}]);if(_0x35dbbc['length']>0x0)_0x23f4f1['push'](_0x35dbbc);else _0x1f54ed[_0x5d456a(0x28f)]>0x0&&_0x23f4f1[_0x5d456a(0x25b)](_0x1f54ed);}const _0x309793=_0x1a5f71[_0x310c5e(0x27f)](_0x55f65e=>_0x447a64(_0x55f65e));await Promise[_0x310c5e(0x1f0)](_0x309793),_0x83982[_0x310c5e(0x226)](_0x23f4f1);}),router[a0_0x58e896(0x1ed)](a0_0x58e896(0x264),async(_0x323eeb,_0x52e9e4)=>{var _0x17605c=a0_0x58e896;const {productCode:_0x4a8345,bay:_0x11d4f1,warehouses:_0x29a0ef,room:_0xfa6538}=_0x323eeb[_0x17605c(0x210)];console[_0x17605c(0x296)](_0x323eeb[_0x17605c(0x210)]);try{const _0x4575b7=await warehouse[_0x17605c(0x1f7)]([{'$match':{'name':_0x29a0ef,'room':_0xfa6538}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x11d4f1)}},{'$group':{'_id':_0x17605c(0x1fc),'name':{'$first':_0x17605c(0x256)},'product_stock':{'$first':_0x17605c(0x23d)},'bay':{'$first':_0x17605c(0x221)},'maxProducts':{'$first':_0x17605c(0x200)}}}]);_0x52e9e4['status'](0xc8)[_0x17605c(0x226)](_0x4575b7);}catch(_0x2595a7){_0x52e9e4[_0x17605c(0x247)](0x194)[_0x17605c(0x226)]({'message':_0x2595a7['message']});}}),module[a0_0x58e896(0x23c)]=router;function a0_0x26b0(){var _0x52d0e3=['stock','string','warehouse','$product_details.primary_code','Hindi','394835NioWEa','level','add','id_transaction','email','$product_details.floorlevel','exports','$product_details.product_stock','adjustment\x20data\x20update\x20successfully','findOne','render','warehouse_name','redirect','getMonth','JO_number','floor','prod_cat','status','split','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','toString','Enabled','/adjustment_finished/view','/picking_list/PDF_adjustmentFinal/','/view/add_adjustment_logs','$product_details.product_code','/view/add_adjustment','batch_code','/adjustment/view','Rooms','$product.room_names','$product_details.unit','$product_details.product_name','Portuguese','$product_details.secondary_code','prod_name','adjustment_finished_logs','push','../models/all_models','4EoCTaJ','secondary_unit','new_adjust_qty','product_code','user','room','Spanish','/CheckingWarehouse','params','back','padStart','/preview/:id','maxPerUnit','product_stock','product','message','Arabic','adjustment\x20add\x20successfull','175843dxNeNP','$product_details.bin','$invoice','then','$product_details.invoice','language','$product.product_name','English\x20(US)','add_adjustment_finished_logs','getFullYear','stockBefore','staff','New_Qty_Converted','forEach','edit_adjustment_finished','An\x20error\x20occurred.','map','Secondary_units','$name','purchases_data','logs','flash','random','filter','$finalize','$product_details.expiry_date','room_names','nodemailer','findById','adjust_qty','$product_details.storage','Return\x20Rooms','length','adjustment_finished','finalize','DRY\x20GOODS','ADJF-','Primary_Units','Portuguese\x20(BR)','log','<tr>','$date','prod_code','$product_details.batch_code','foreach\x20newproduct','note','post','master','prod_invoice','all','</td>','$product_details','There\x27s\x20a\x20error\x20in\x20this\x20transaction','slice','product_name','$product_details.maxPerUnit','aggregate','/view/:id','13720140BwmvvL','success','product_date','$product_details._id','errors','Enclosed','unit','$product_details.maxProducts','find','bay','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','English','French','$room','Adjustment\x20Finalize\x20Successfully','Chinese','$product_details.level','German','production_date','$product_details.type','error','_id','$product_details.secondary_unit','body','id_transaction_from','save','$product','catch','/barcode_scanner','3909600YolTRw','4597224VQbImJ','role','express','expiry_date','$product_details.production_date','getDate','match','2003253fVTEzB','../middleware/auth','Arabic\x20(ae)','$product_details.bay','$warehouse_name','product_details','invoice_init','LOG-ADJ-','json','edit_adjustment_finished_view','get','641823GrqIhN','minus','An\x20error\x20occurred\x20while\x20saving\x20data.','4hWaFIe','types','</tr>','$product_details.rack','New_Qty_Converted_adj'];a0_0x26b0=function(){return _0x52d0e3;};return a0_0x26b0();}