var a0_0x35eb13=a0_0x5487;(function(_0x283b71,_0x517610){var _0x1305bc=a0_0x5487,_0x5e6a45=_0x283b71();while(!![]){try{var _0x38df8f=parseInt(_0x1305bc(0xe7))/0x1+-parseInt(_0x1305bc(0x143))/0x2+parseInt(_0x1305bc(0x101))/0x3+parseInt(_0x1305bc(0x15d))/0x4*(parseInt(_0x1305bc(0x125))/0x5)+-parseInt(_0x1305bc(0x13d))/0x6+parseInt(_0x1305bc(0x117))/0x7+-parseInt(_0x1305bc(0x159))/0x8*(-parseInt(_0x1305bc(0x140))/0x9);if(_0x38df8f===_0x517610)break;else _0x5e6a45['push'](_0x5e6a45['shift']());}catch(_0x4b21f3){_0x5e6a45['push'](_0x5e6a45['shift']());}}}(a0_0x248e,0x8a520));const express=require(a0_0x35eb13(0x123)),app=express(),router=express[a0_0x35eb13(0xf0)](),auth=require(a0_0x35eb13(0x110)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x35eb13(0xfd)),users=require(a0_0x35eb13(0x114)),nodemailer=require(a0_0x35eb13(0x17e));router[a0_0x35eb13(0xe6)](a0_0x35eb13(0x153),auth,async(_0x4621c3,_0x3dc5c9)=>{var _0x27c2ad=a0_0x35eb13;try{const {username:_0x236227,email:_0x428684,role:_0x2ba4d4}=_0x4621c3[_0x27c2ad(0x13c)],_0x308945=_0x4621c3[_0x27c2ad(0x13c)],_0x4e328a=await profile['findOne']({'email':_0x308945[_0x27c2ad(0x12f)]}),_0x39ff41=await master_shop[_0x27c2ad(0x135)]();let _0x5cca97;if(_0x308945[_0x27c2ad(0x136)]==_0x27c2ad(0x13f)){const _0x10f4b3=await staff[_0x27c2ad(0x15e)]({'email':_0x308945['email']});_0x5cca97=await warehouse[_0x27c2ad(0x135)]({'status':_0x27c2ad(0x156),'name':_0x10f4b3[_0x27c2ad(0x10d)]});}else _0x5cca97=await warehouse[_0x27c2ad(0x135)]({'status':_0x27c2ad(0x156)});const _0xa5f832=await product[_0x27c2ad(0x135)]();let _0x37d880;if(_0x308945[_0x27c2ad(0x136)]==_0x27c2ad(0x13f)){const _0x52fb32=await staff[_0x27c2ad(0x15e)]({'email':_0x308945[_0x27c2ad(0x12f)]});_0x37d880=await adjustment_finished[_0x27c2ad(0x135)]({'warehouse_name':_0x52fb32[_0x27c2ad(0x10d)]});}else _0x37d880=await adjustment_finished[_0x27c2ad(0x112)]([{'$match':{'type_of_transaction':_0x27c2ad(0x15b)}},{'$unwind':_0x27c2ad(0x176)},{'$group':{'_id':_0x27c2ad(0xec),'invoice':{'$first':_0x27c2ad(0x15a)},'date':{'$first':_0x27c2ad(0x11c)},'warehouse_name':{'$first':_0x27c2ad(0x173)},'room':{'$addToSet':_0x27c2ad(0x165)},'finalize':{'$first':_0x27c2ad(0xf5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0x151)){var _0x34d9ba=users[_0x27c2ad(0x139)];console['log'](_0x34d9ba);}else{if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0x152))var _0x34d9ba=users[_0x27c2ad(0x152)];else{if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0xf7))var _0x34d9ba=users[_0x27c2ad(0xf7)];else{if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0x174))var _0x34d9ba=users['Spanish'];else{if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0x108))var _0x34d9ba=users[_0x27c2ad(0x108)];else{if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0x155))var _0x34d9ba=users['Portuguese'];else{if(_0x39ff41[0x0]['language']=='Chinese')var _0x34d9ba=users[_0x27c2ad(0x10f)];else{if(_0x39ff41[0x0][_0x27c2ad(0x107)]==_0x27c2ad(0x134))var _0x34d9ba=users[_0x27c2ad(0x14d)];}}}}}}}_0x3dc5c9[_0x27c2ad(0xe8)](_0x27c2ad(0x137),{'success':_0x4621c3[_0x27c2ad(0x129)](_0x27c2ad(0x15f)),'errors':_0x4621c3[_0x27c2ad(0x129)](_0x27c2ad(0xdf)),'role':_0x308945,'profile':_0x4e328a,'warehouse':_0x5cca97,'product':_0xa5f832,'adjustment':_0x37d880,'master_shop':_0x39ff41,'language':_0x34d9ba});}catch(_0x570b07){console['log'](_0x570b07);}}),router['get'](a0_0x35eb13(0x189),auth,async(_0x3ec3da,_0x316620)=>{var _0x590081=a0_0x35eb13;try{const {username:_0x4ff295,email:_0x305dd0,role:_0x152c9d}=_0x3ec3da[_0x590081(0x13c)],_0x4792e1=_0x3ec3da[_0x590081(0x13c)],_0x5a03a5=await profile[_0x590081(0x15e)]({'email':_0x4792e1['email']}),_0x2ce73a=await master_shop[_0x590081(0x135)]();let _0x294374;if(_0x4792e1[_0x590081(0x136)]==_0x590081(0x13f)){const _0xa69c5=await staff['findOne']({'email':_0x4792e1[_0x590081(0x12f)]});_0x294374=await warehouse[_0x590081(0x135)]({'status':_0x590081(0x156),'name':_0xa69c5[_0x590081(0x10d)]});}else _0x294374=await warehouse[_0x590081(0x135)]({'status':'Enabled'});const _0x1278c3=await product['find']();let _0x5a9ebf;if(_0x4792e1[_0x590081(0x136)]=='staff'){const _0x16144f=await staff[_0x590081(0x15e)]({'email':_0x4792e1[_0x590081(0x12f)]});_0x5a9ebf=await adjustment_finished[_0x590081(0x135)]({'warehouse_name':_0x16144f[_0x590081(0x10d)]});}else _0x5a9ebf=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x590081(0x183)}},{'$unwind':_0x590081(0x176)},{'$group':{'_id':_0x590081(0xec),'invoice':{'$first':_0x590081(0x15a)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x590081(0x165)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0x151))var _0x128297=users[_0x590081(0x139)];else{if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0x152))var _0x128297=users['Hindi'];else{if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0xf7))var _0x128297=users['German'];else{if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0x174))var _0x128297=users[_0x590081(0x174)];else{if(_0x2ce73a[0x0][_0x590081(0x107)]=='French')var _0x128297=users[_0x590081(0x108)];else{if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0x155))var _0x128297=users['Portuguese'];else{if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0x10f))var _0x128297=users[_0x590081(0x10f)];else{if(_0x2ce73a[0x0][_0x590081(0x107)]==_0x590081(0x134))var _0x128297=users['Arabic'];}}}}}}}_0x316620[_0x590081(0xe8)](_0x590081(0x147),{'success':_0x3ec3da[_0x590081(0x129)]('success'),'errors':_0x3ec3da[_0x590081(0x129)](_0x590081(0xdf)),'role':_0x4792e1,'profile':_0x5a03a5,'warehouse':_0x294374,'product':_0x1278c3,'adjustment':_0x5a9ebf,'master_shop':_0x2ce73a,'language':_0x128297});}catch(_0x30cd59){console[_0x590081(0xf2)](_0x30cd59);}});function a0_0x248e(){var _0x266b10=['ADJF-','$product_details.batch_code','adjust_qty','$product_details.bin','_id','$warehouse_name','Spanish','stock','$product','edit_adjustment_finished','$product_details.level','redirect','invoice','level','add','$product_details.unit','nodemailer','product_code','forEach','edit_adjustment_finished_view','id_transaction','logs','adjustment\x20data\x20update\x20successfully','/view/:id','</td>','product_name','all','/view_logs','toString','product_date','$product_details.primary_code','$product_details._id','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','production_date','/picking_list/PDF_adjustmentFinal/','/adjustment_finished/preview/','errors','product_stock','room','JO_number','purchases_data','Return\x20Rooms','master','get','344120xRbQon','render','New_Qty_Converted','match','An\x20error\x20occurred.','$_id','prod_name','prod_invoice','Ambient','Router','prod_cat','log','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','slice','$finalize','length','German','product','$product_details.type','adjustment\x20add\x20successfull','True','new_adjust_qty','../models/all_models','maxPerUnit','DRY\x20GOODS','Rooms','1684134xWbQEJ','minus','product_details','$product_details.storage','message','warehouse_name','language','French','unit','getMonth','finalize','getDate','warehouse','add_adjustment_finished_logs','Chinese','../middleware/auth','body','aggregate','</tr>','../public/language/languages.json','back','Portuguese','833490wBfnsQ','$product_details.secondary_code','string','Primary_Units','params','$date','$product_details.maxPerUnit','secondary_unit','findById','error','$product_details.product_stock','note','express','save','2092600qkjBjH','exports','bay','$room','flash','filter','/barcode_scanner','invoice_init','$product_details','/view/add_adjustment','email','<tr>','id_transaction_from','ADJ-','random','Arabic\x20(ae)','find','role','adjustment_finished','push','English','$product_details.invoice','$product_details.expiry_date','user','3943338sBmPyZ','Enclosed','staff','9tWBmRg','then','/adjustment_finished/view','1952120MhTLyA','$name','/view/add_adjustment_logs','post','adjustment_finished_logs','$product_details.bay','$product_details.floorlevel','batch_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','status','Arabic','map','padStart','date','English\x20(US)','Hindi','/view','/adjustment/view','Portuguese\x20(BR)','Enabled','room_names','catch','2705880taDfxR','$invoice','own','$product_details.rack','8brofsr','findOne','success','prod_code','json','Adjustment\x20Finalize\x20Successfully','add_adjustment_finished','types','$product.room_names','$product_details.secondary_unit','stockBefore','$product_details.product_name','expiry_date','New_Qty_Converted_adj','$product_details.product_code','Secondary_units','$product_details.production_date'];a0_0x248e=function(){return _0x266b10;};return a0_0x248e();}function a0_0x5487(_0x4b08e5,_0x15b796){var _0x248e16=a0_0x248e();return a0_0x5487=function(_0x54876f,_0x1011bb){_0x54876f=_0x54876f-0xdf;var _0x3a1d38=_0x248e16[_0x54876f];return _0x3a1d38;},a0_0x5487(_0x4b08e5,_0x15b796);}async function getRandom8DigitNumber(){var _0x2bd50e=a0_0x35eb13;const _0x2f9fa2=0x989680,_0x189991=0x5f5e0ff,_0x5778d3=Math['floor'](Math[_0x2bd50e(0x133)]()*(_0x189991-_0x2f9fa2+0x1))+_0x2f9fa2;var _0x1d1046;const _0x5a6610=await adjustment_finished['findOne']({'invoice':_0x2bd50e(0x16e)+_0x5778d3});return _0x5a6610&&_0x5a6610['length']>0x0?_0x1d1046=_0x2bd50e(0x16e)+_0x5778d3:_0x1d1046=_0x2bd50e(0x16e)+_0x5778d3,_0x1d1046;}router[a0_0x35eb13(0xe6)](a0_0x35eb13(0x12e),auth,async(_0x35aab4,_0x22f83f)=>{var _0x47f825=a0_0x35eb13;try{const {username:_0x353170,email:_0x3c3c37,role:_0x3ef42d}=_0x35aab4[_0x47f825(0x13c)],_0x590b04=_0x35aab4[_0x47f825(0x13c)],_0x20a62f=await profile[_0x47f825(0x15e)]({'email':_0x590b04[_0x47f825(0x12f)]}),_0x479d18=await master_shop['find']();let _0x1adcec;if(_0x590b04[_0x47f825(0x136)]=='staff'){const _0x66fdc1=await staff[_0x47f825(0x15e)]({'email':_0x590b04[_0x47f825(0x12f)]});_0x1adcec=await warehouse[_0x47f825(0x112)]([{'$match':{'status':_0x47f825(0x156),'name':_0x66fdc1[_0x47f825(0x10d)]}},{'$group':{'_id':_0x47f825(0x144),'name':{'$first':_0x47f825(0x144)}}}]);}else _0x1adcec=await warehouse['aggregate']([{'$match':{'status':_0x47f825(0x156)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x509ca1=await product['find']({}),_0x51e0b9=await adjustment_finished[_0x47f825(0x135)](),_0x1218ee=_0x51e0b9[_0x47f825(0xf6)]+0x1,_0x4fb242=_0x47f825(0x16e)+_0x1218ee['toString']()[_0x47f825(0x14f)](0x5,'0');var _0x4b7e02=[_0x47f825(0xef),_0x47f825(0x13e),'Return\x20Rooms'];if(_0x479d18[0x0]['language']==_0x47f825(0x151))var _0x4aff10=users[_0x47f825(0x139)];else{if(_0x479d18[0x0][_0x47f825(0x107)]==_0x47f825(0x152))var _0x4aff10=users['Hindi'];else{if(_0x479d18[0x0]['language']==_0x47f825(0xf7))var _0x4aff10=users[_0x47f825(0xf7)];else{if(_0x479d18[0x0][_0x47f825(0x107)]==_0x47f825(0x174))var _0x4aff10=users[_0x47f825(0x174)];else{if(_0x479d18[0x0][_0x47f825(0x107)]=='French')var _0x4aff10=users[_0x47f825(0x108)];else{if(_0x479d18[0x0][_0x47f825(0x107)]==_0x47f825(0x155))var _0x4aff10=users[_0x47f825(0x116)];else{if(_0x479d18[0x0][_0x47f825(0x107)]=='Chinese')var _0x4aff10=users[_0x47f825(0x10f)];else{if(_0x479d18[0x0][_0x47f825(0x107)]=='Arabic\x20(ae)')var _0x4aff10=users['Arabic'];}}}}}}}const _0x439cab=getRandom8DigitNumber();_0x439cab[_0x47f825(0x141)](_0x4abe76=>{var _0x23f387=_0x47f825;_0x22f83f[_0x23f387(0xe8)](_0x23f387(0x163),{'success':_0x35aab4[_0x23f387(0x129)]('success'),'errors':_0x35aab4[_0x23f387(0x129)](_0x23f387(0xdf)),'role':_0x590b04,'profile':_0x20a62f,'warehouse':_0x1adcec,'product':_0x509ca1,'master_shop':_0x479d18,'language':_0x4aff10,'rooms_data':_0x4b7e02,'invoice_no':_0x4abe76});})[_0x47f825(0x158)](_0x55fc1d=>{var _0x1f6e59=_0x47f825;_0x35aab4[_0x1f6e59(0x129)](_0x1f6e59(0xdf),_0x1f6e59(0x14b)),_0x22f83f[_0x1f6e59(0x179)]('/adjustment/view');});}catch(_0x47bd4b){console[_0x47f825(0xf2)](_0x47bd4b);}}),router[a0_0x35eb13(0x146)](a0_0x35eb13(0x12e),auth,async(_0x4f6db8,_0x4b151d)=>{var _0x18e3eb=a0_0x35eb13;try{const {warehouse_name:_0x53416f,date:_0x1aeb86,prod_name:_0x8e9a17,level:_0x195d3c,isle:_0x29d9c3,pallet:_0xab6114,stock:_0x826e71,types:_0x4f4fcb,adjust_qty:_0x114f6a,new_adjust_qty:_0x4a7607,note:_0x2b3477,Room_name:_0x24f4eb,JO_number:_0x2f4d86,expiry_date:_0x1b1958,PO_number:_0x5e5bff,ReqBy:_0x12e48f,dateofreq:_0x2a32ce,typeservicesData:_0x4540ab,destination:_0x11138b,deliverydate:_0x52457a,driver:_0x1c76ba,plate:_0x2047f3,van:_0x597975,DRSI:_0x24fd48,typevehicle:_0xc63cfa,TSU:_0x51cece,TFU:_0x4bbf6d}=_0x4f6db8[_0x18e3eb(0x111)];if(typeof _0x8e9a17==_0x18e3eb(0x119))var _0x23e6df=[_0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0xed)]],_0x4214bf=[_0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x17b)]],_0x213934=[_0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x175)]],_0x5a98de=[_0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x164)]],_0x111efe=[_0x4f6db8[_0x18e3eb(0x111)]['New_Qty_Converted_adj']],_0x51478c=[_0x4f6db8[_0x18e3eb(0x111)]['New_Qty_Converted']],_0x5d1d87=[_0x4f6db8['body'][_0x18e3eb(0x11a)]],_0x376c5b=[_0x4f6db8[_0x18e3eb(0x111)]['Secondary_units']],_0x4176da=[_0x4f6db8[_0x18e3eb(0x111)]['prod_code']],_0x57943d=[_0x4f6db8['body'][_0x18e3eb(0x14a)]],_0x118eb3=[_0x4f6db8['body'][_0x18e3eb(0x169)]],_0x109ccd=[_0x4f6db8[_0x18e3eb(0x111)]['product_date']],_0x39fa92=[_0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0xf1)]],_0x1c1414=[_0x4f6db8['body']['Rooms']],_0x93177e=[_0x4f6db8[_0x18e3eb(0x111)]['maxPerUnit']],_0x53c099=[_0x4f6db8['body'][_0x18e3eb(0xee)]],_0x592bbf=[_0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x131)]];else var _0x23e6df=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0xed)]],_0x4214bf=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x17b)]],_0x213934=[..._0x4f6db8[_0x18e3eb(0x111)]['stock']],_0x5a98de=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x164)]],_0x111efe=[..._0x4f6db8['body'][_0x18e3eb(0x16a)]],_0x51478c=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0xe9)]],_0x5d1d87=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x11a)]],_0x376c5b=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x16c)]],_0x4176da=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x160)]],_0x57943d=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x14a)]],_0x118eb3=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x169)]],_0x109ccd=[..._0x4f6db8[_0x18e3eb(0x111)]['product_date']],_0x39fa92=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0xf1)]],_0x1c1414=[..._0x4f6db8[_0x18e3eb(0x111)]['Rooms']],_0x93177e=[..._0x4f6db8[_0x18e3eb(0x111)]['maxPerUnit']],_0x53c099=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0xee)]],_0x592bbf=[..._0x4f6db8[_0x18e3eb(0x111)][_0x18e3eb(0x131)]];const _0x384970=_0x23e6df[_0x18e3eb(0x14e)](_0x47dfb5=>{return _0x47dfb5={'product_name':_0x47dfb5};});_0x4214bf[_0x18e3eb(0x180)]((_0xbe6378,_0x5ddc96)=>{var _0x2ac8a8=_0x18e3eb,_0x26cb85=_0xbe6378['match'](/[A-Za-z]+/)[0x0],_0x5dd049=parseInt(_0xbe6378[_0x2ac8a8(0xea)](/\d+/)[0x0]);_0x384970[_0x5ddc96][_0x2ac8a8(0x17b)]=_0x26cb85,_0x384970[_0x5ddc96][_0x2ac8a8(0x127)]=_0x5dd049;}),_0x592bbf[_0x18e3eb(0x180)]((_0x395631,_0x39ddbc)=>{_0x384970[_0x39ddbc]['id_transaction']=_0x395631;}),_0x213934[_0x18e3eb(0x180)]((_0x51b6ad,_0xd0fe02)=>{var _0x40dc98=_0x18e3eb;_0x384970[_0xd0fe02][_0x40dc98(0x167)]=_0x51b6ad;}),_0x5a98de[_0x18e3eb(0x180)]((_0x9405a6,_0x52e572)=>{var _0x2eab6c=_0x18e3eb;_0x384970[_0x52e572][_0x2eab6c(0x164)]=_0x9405a6;}),_0x111efe[_0x18e3eb(0x180)]((_0x441041,_0x2e9a67)=>{var _0x858a7b=_0x18e3eb;_0x384970[_0x2e9a67][_0x858a7b(0x170)]=_0x441041;}),_0x51478c[_0x18e3eb(0x180)]((_0xd2c4cd,_0xc6ab7)=>{var _0x4dbba4=_0x18e3eb;_0x384970[_0xc6ab7][_0x4dbba4(0xfc)]=_0xd2c4cd;}),_0x5d1d87['forEach']((_0x2cbfa5,_0x3ef8ea)=>{_0x384970[_0x3ef8ea]['unit']=_0x2cbfa5;}),_0x376c5b['forEach']((_0x3a8a0a,_0x388d2d)=>{var _0x55b5c2=_0x18e3eb;_0x384970[_0x388d2d][_0x55b5c2(0x11e)]=_0x3a8a0a;}),_0x4176da[_0x18e3eb(0x180)]((_0x68320b,_0x215609)=>{var _0x19dcc3=_0x18e3eb;_0x384970[_0x215609][_0x19dcc3(0x17f)]=_0x68320b;}),_0x57943d[_0x18e3eb(0x180)]((_0x2363ae,_0x5576f0)=>{var _0x24cc46=_0x18e3eb;_0x384970[_0x5576f0][_0x24cc46(0x14a)]=_0x2363ae;}),_0x118eb3['forEach']((_0x1f2ffe,_0x1ba721)=>{var _0x3cff06=_0x18e3eb;_0x384970[_0x1ba721][_0x3cff06(0x169)]=_0x1f2ffe;}),_0x109ccd[_0x18e3eb(0x180)]((_0x538b00,_0x287537)=>{var _0x1ee3f9=_0x18e3eb;_0x384970[_0x287537][_0x1ee3f9(0x18f)]=_0x538b00;}),_0x39fa92[_0x18e3eb(0x180)]((_0x19ff53,_0x1b0a90)=>{var _0x2fcbea=_0x18e3eb;_0x384970[_0x1b0a90][_0x2fcbea(0xf1)]=_0x19ff53;}),_0x1c1414[_0x18e3eb(0x180)]((_0x300860,_0x33c114)=>{_0x384970[_0x33c114]['room_names']=_0x300860;}),_0x93177e[_0x18e3eb(0x180)]((_0x52e3b0,_0x41956b)=>{var _0x5278ab=_0x18e3eb;_0x384970[_0x41956b][_0x5278ab(0xfe)]=_0x52e3b0;}),_0x53c099[_0x18e3eb(0x180)]((_0xbfcf52,_0x20caea)=>{_0x384970[_0x20caea]['invoice']=_0xbfcf52;});const _0x3a042d=_0x384970['filter'](_0x23e937=>_0x23e937[_0x18e3eb(0x170)]!=='0'&&_0x23e937[_0x18e3eb(0x170)]!=='');var _0x126e5b=0x0;_0x3a042d[_0x18e3eb(0x180)](_0x4ab163=>{var _0x13c31b=_0x18e3eb;console[_0x13c31b(0xf2)]('foreach\x20newproduct',_0x4ab163),parseInt(_0x4ab163['adjust_qty'])<=0x0&&_0x126e5b++;});if(_0x126e5b!=0x0)return _0x4f6db8[_0x18e3eb(0x129)](_0x18e3eb(0xdf),_0x18e3eb(0x18e)),_0x4b151d[_0x18e3eb(0x179)](_0x18e3eb(0x115));const _0x292197=new invoice_for_adjustment();await _0x292197['save']();const _0x590d09=new adjustment_finished({'warehouse_name':_0x53416f,'date':_0x1aeb86,'product':_0x3a042d,'note':_0x2b3477,'room':_0x24f4eb,'invoice':_0x18e3eb(0x132)+_0x292197[_0x18e3eb(0x12c)]['toString']()['padStart'](0x8,'0'),'JO_number':_0x2f4d86,'expiry_date':_0x1b1958,'PO_number':_0x5e5bff,'RequestedBy':_0x12e48f,'DateofRequest':_0x2a32ce,'typeservices':_0x4540ab,'destination':_0x11138b,'deliverydate':_0x52457a,'driver':_0x1c76ba,'plate':_0x2047f3,'van':_0x597975,'DRSI':_0x24fd48,'typevehicle':_0xc63cfa,'TSU':_0x51cece,'TFU':_0x4bbf6d}),_0x2279c0=await _0x590d09[_0x18e3eb(0x124)]();_0x4f6db8['flash'](_0x18e3eb(0x15f),_0x18e3eb(0xfa)),_0x4b151d[_0x18e3eb(0x179)](_0x18e3eb(0x191)+_0x2279c0[_0x18e3eb(0x172)]);}catch(_0x32e699){console[_0x18e3eb(0xf2)](_0x32e699),_0x4b151d[_0x18e3eb(0x14c)](0xc8)[_0x18e3eb(0x161)]({'message':_0x32e699[_0x18e3eb(0x105)]});}}),router[a0_0x35eb13(0xe6)](a0_0x35eb13(0x145),auth,async(_0x3d8d53,_0x163b93)=>{var _0x3e6c92=a0_0x35eb13;try{const {username:_0x17894e,email:_0xb31050,role:_0x5eb0bc}=_0x3d8d53[_0x3e6c92(0x13c)],_0x209081=_0x3d8d53[_0x3e6c92(0x13c)],_0x17b3da=await profile[_0x3e6c92(0x15e)]({'email':_0x209081['email']}),_0x441694=await master_shop[_0x3e6c92(0x135)]();let _0x297c26;if(_0x209081['role']=='staff'){const _0x4ce5fa=await staff[_0x3e6c92(0x15e)]({'email':_0x209081[_0x3e6c92(0x12f)]});_0x297c26=await warehouse[_0x3e6c92(0x112)]([{'$match':{'status':'Enabled','name':_0x4ce5fa[_0x3e6c92(0x10d)]}},{'$group':{'_id':_0x3e6c92(0x144),'name':{'$first':'$name'}}}]);}else _0x297c26=await warehouse['aggregate']([{'$match':{'status':_0x3e6c92(0x156)}},{'$group':{'_id':_0x3e6c92(0x144),'name':{'$first':_0x3e6c92(0x144)}}}]);const _0x3897fa=await product[_0x3e6c92(0x135)](),_0x5b100c=await adjustment_finished[_0x3e6c92(0x135)](),_0x1be701=_0x5b100c[_0x3e6c92(0xf6)]+0x1,_0x405e73=_0x3e6c92(0x16e)+_0x1be701[_0x3e6c92(0x18a)]()[_0x3e6c92(0x14f)](0x5,'0');var _0xaa984f=[_0x3e6c92(0xef),_0x3e6c92(0x13e),_0x3e6c92(0xe4)];if(_0x441694[0x0][_0x3e6c92(0x107)]==_0x3e6c92(0x151))var _0xa78335=users['English'];else{if(_0x441694[0x0][_0x3e6c92(0x107)]==_0x3e6c92(0x152))var _0xa78335=users[_0x3e6c92(0x152)];else{if(_0x441694[0x0][_0x3e6c92(0x107)]==_0x3e6c92(0xf7))var _0xa78335=users[_0x3e6c92(0xf7)];else{if(_0x441694[0x0]['language']==_0x3e6c92(0x174))var _0xa78335=users['Spanish'];else{if(_0x441694[0x0][_0x3e6c92(0x107)]==_0x3e6c92(0x108))var _0xa78335=users[_0x3e6c92(0x108)];else{if(_0x441694[0x0][_0x3e6c92(0x107)]==_0x3e6c92(0x155))var _0xa78335=users[_0x3e6c92(0x116)];else{if(_0x441694[0x0][_0x3e6c92(0x107)]==_0x3e6c92(0x10f))var _0xa78335=users[_0x3e6c92(0x10f)];else{if(_0x441694[0x0]['language']=='Arabic\x20(ae)')var _0xa78335=users[_0x3e6c92(0x14d)];}}}}}}}const _0x27ce8f=getRandom8DigitNumber();_0x27ce8f['then'](_0x2c9fe8=>{var _0xed3ee7=_0x3e6c92;_0x163b93['render'](_0xed3ee7(0x10e),{'success':_0x3d8d53[_0xed3ee7(0x129)]('success'),'errors':_0x3d8d53[_0xed3ee7(0x129)](_0xed3ee7(0xdf)),'role':_0x209081,'profile':_0x17b3da,'warehouse':_0x297c26,'product':_0x3897fa,'master_shop':_0x441694,'language':_0xa78335,'rooms_data':_0xaa984f,'invoice_no':_0x2c9fe8});})[_0x3e6c92(0x158)](_0x3a8939=>{var _0x2d6835=_0x3e6c92;_0x3d8d53[_0x2d6835(0x129)](_0x2d6835(0xdf),_0x2d6835(0x14b)),_0x163b93[_0x2d6835(0x179)](_0x2d6835(0x154));});}catch(_0x1c172d){console[_0x3e6c92(0xf2)](_0x1c172d);}}),router[a0_0x35eb13(0x146)](a0_0x35eb13(0x145),auth,async(_0x2cb9fd,_0x90a156)=>{var _0x11b1a9=a0_0x35eb13;try{const {warehouse_name:_0x2f8fa5,date:_0x288d2c,prod_name:_0x2e317b,level:_0x1907d0,isle:_0x33a67f,pallet:_0x267f4e,stock:_0x5a793e,types:_0x2aaaa7,adjust_qty:_0x3a5a95,new_adjust_qty:_0x47dfd1,note:_0x55d910,Room_name:_0xa9d18f,JO_number:_0x20ebc4,expiry_date:_0xe58b0e,type_of_transaction:_0x1466a4,PO_number:_0x3dceb7,ReqBy:_0x5d9930,dateofreq:_0x5ced6c,typeservicesData:_0x24c834,destination:_0x46d8d4,deliverydate:_0x4fa528,driver:_0x4a1fe8,plate:_0x45bb3e,van:_0x2593db,DRSI:_0x3baf2c,typevehicle:_0x3f68de,TSU:_0x100a42,TFU:_0x3c57b8}=_0x2cb9fd[_0x11b1a9(0x111)];if(typeof _0x2e317b=='string')var _0x2c427f=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0xed)]],_0x58bf46=[_0x2cb9fd[_0x11b1a9(0x111)]['level']],_0x3dd3ac=[_0x2cb9fd['body'][_0x11b1a9(0x175)]],_0x5a729e=[_0x2cb9fd['body'][_0x11b1a9(0x164)]],_0x5abd11=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x16a)]],_0x22790c=[_0x2cb9fd[_0x11b1a9(0x111)]['New_Qty_Converted']],_0x3a2dfd=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x11a)]],_0x4c4780=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x16c)]],_0x3414e4=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x160)]],_0x14c97e=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x14a)]],_0x3e99d3=[_0x2cb9fd['body'][_0x11b1a9(0x169)]],_0x43e124=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x18b)]],_0x306181=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0xf1)]],_0x483003=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x100)]],_0x5d5c31=[_0x2cb9fd['body'][_0x11b1a9(0xfe)]],_0x398aa0=[_0x2cb9fd['body'][_0x11b1a9(0xee)]],_0x46bf85=[_0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x131)]];else var _0x2c427f=[..._0x2cb9fd['body'][_0x11b1a9(0xed)]],_0x58bf46=[..._0x2cb9fd['body']['level']],_0x3dd3ac=[..._0x2cb9fd[_0x11b1a9(0x111)]['stock']],_0x5a729e=[..._0x2cb9fd[_0x11b1a9(0x111)]['types']],_0x5abd11=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x16a)]],_0x22790c=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0xe9)]],_0x3a2dfd=[..._0x2cb9fd['body'][_0x11b1a9(0x11a)]],_0x4c4780=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x16c)]],_0x3414e4=[..._0x2cb9fd['body'][_0x11b1a9(0x160)]],_0x14c97e=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x14a)]],_0x3e99d3=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x169)]],_0x43e124=[..._0x2cb9fd['body']['product_date']],_0x306181=[..._0x2cb9fd[_0x11b1a9(0x111)]['prod_cat']],_0x483003=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x100)]],_0x5d5c31=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0xfe)]],_0x398aa0=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0xee)]],_0x46bf85=[..._0x2cb9fd[_0x11b1a9(0x111)][_0x11b1a9(0x131)]];const _0x38a6a5=_0x2c427f[_0x11b1a9(0x14e)](_0x319154=>{return _0x319154={'product_name':_0x319154};});_0x58bf46['forEach']((_0x3045b6,_0x513f0a)=>{var _0x1994aa=_0x11b1a9,_0x3ee346=_0x3045b6[_0x1994aa(0xea)](/[A-Za-z]+/)[0x0],_0x329144=parseInt(_0x3045b6['match'](/\d+/)[0x0]);_0x38a6a5[_0x513f0a]['level']=_0x3ee346,_0x38a6a5[_0x513f0a]['bay']=_0x329144;}),_0x46bf85[_0x11b1a9(0x180)]((_0x42cd25,_0x1fb1b2)=>{_0x38a6a5[_0x1fb1b2]['id_transaction']=_0x42cd25;}),_0x3dd3ac['forEach']((_0x45ca83,_0x5d3175)=>{_0x38a6a5[_0x5d3175]['stockBefore']=_0x45ca83;}),_0x5a729e[_0x11b1a9(0x180)]((_0x377bb0,_0x4a91dd)=>{var _0x4054aa=_0x11b1a9;_0x38a6a5[_0x4a91dd][_0x4054aa(0x164)]=_0x377bb0;}),_0x5abd11[_0x11b1a9(0x180)]((_0x250cbd,_0x2b7d1f)=>{var _0x5054f9=_0x11b1a9;_0x38a6a5[_0x2b7d1f][_0x5054f9(0x170)]=_0x250cbd;}),_0x22790c[_0x11b1a9(0x180)]((_0x22cce4,_0x2b01f0)=>{var _0x5bfa02=_0x11b1a9;_0x38a6a5[_0x2b01f0][_0x5bfa02(0xfc)]=_0x22cce4;}),_0x3a2dfd[_0x11b1a9(0x180)]((_0x3ab7a2,_0x3ff73a)=>{var _0x38aaea=_0x11b1a9;_0x38a6a5[_0x3ff73a][_0x38aaea(0x109)]=_0x3ab7a2;}),_0x4c4780[_0x11b1a9(0x180)]((_0x2403a6,_0x4fd5d3)=>{var _0xaa9c8a=_0x11b1a9;_0x38a6a5[_0x4fd5d3][_0xaa9c8a(0x11e)]=_0x2403a6;}),_0x3414e4['forEach']((_0x38390e,_0x15a740)=>{var _0x1b862f=_0x11b1a9;_0x38a6a5[_0x15a740][_0x1b862f(0x17f)]=_0x38390e;}),_0x14c97e['forEach']((_0x1ccbf1,_0x4dffa3)=>{var _0x10704c=_0x11b1a9;_0x38a6a5[_0x4dffa3][_0x10704c(0x14a)]=_0x1ccbf1;}),_0x3e99d3[_0x11b1a9(0x180)]((_0x38a293,_0x4a54cb)=>{var _0x1d0ff1=_0x11b1a9;_0x38a6a5[_0x4a54cb][_0x1d0ff1(0x169)]=_0x38a293;}),_0x43e124[_0x11b1a9(0x180)]((_0x40250e,_0x588caa)=>{var _0x35e97b=_0x11b1a9;_0x38a6a5[_0x588caa][_0x35e97b(0x18f)]=_0x40250e;}),_0x306181['forEach']((_0x504585,_0x39ef43)=>{var _0x52d8a6=_0x11b1a9;_0x38a6a5[_0x39ef43][_0x52d8a6(0xf1)]=_0x504585;}),_0x483003[_0x11b1a9(0x180)]((_0x5b25c3,_0xd9e7e7)=>{var _0x1ff9f8=_0x11b1a9;_0x38a6a5[_0xd9e7e7][_0x1ff9f8(0x157)]=_0x5b25c3;}),_0x5d5c31['forEach']((_0x5eebfb,_0x38583f)=>{var _0x50517e=_0x11b1a9;_0x38a6a5[_0x38583f][_0x50517e(0xfe)]=_0x5eebfb;}),_0x398aa0[_0x11b1a9(0x180)]((_0x44f873,_0x443ab5)=>{_0x38a6a5[_0x443ab5]['invoice']=_0x44f873;});const _0x2f6ffd=_0x38a6a5['filter'](_0x2c0cd4=>_0x2c0cd4['adjust_qty']!=='0'&&_0x2c0cd4[_0x11b1a9(0x170)]!=='');var _0x30ca27=0x0;_0x2f6ffd['forEach'](_0x36fd2c=>{var _0x8a0463=_0x11b1a9;console[_0x8a0463(0xf2)]('foreach\x20newproduct',_0x36fd2c),parseInt(_0x36fd2c['adjust_qty'])<=0x0&&_0x30ca27++;});if(_0x30ca27!=0x0)return _0x2cb9fd[_0x11b1a9(0x129)](_0x11b1a9(0xdf),_0x11b1a9(0x18e)),_0x90a156[_0x11b1a9(0x179)](_0x11b1a9(0x115));const _0x151f91=new adjustment_logs();await _0x151f91[_0x11b1a9(0x124)]();const _0x3c3c52=new adjustment_finished({'warehouse_name':_0x2f8fa5,'date':_0x288d2c,'product':_0x2f6ffd,'note':_0x55d910,'room':_0xa9d18f,'invoice':'LOG-ADJ-'+_0x151f91[_0x11b1a9(0x12c)]['toString']()['padStart'](0x8,'0'),'JO_number':_0x20ebc4,'expiry_date':_0xe58b0e,'type_of_transaction':_0x1466a4,'PO_number':_0x3dceb7,'RequestedBy':_0x5d9930,'DateofRequest':_0x5ced6c,'typeservices':_0x24c834,'destination':_0x46d8d4,'deliverydate':_0x4fa528,'driver':_0x4a1fe8,'plate':_0x45bb3e,'van':_0x2593db,'DRSI':_0x3baf2c,'typevehicle':_0x3f68de,'TSU':_0x100a42,'TFU':_0x3c57b8}),_0x2992fa=await _0x3c3c52['save']();_0x2cb9fd[_0x11b1a9(0x129)](_0x11b1a9(0x15f),_0x11b1a9(0xfa)),_0x90a156[_0x11b1a9(0x179)](_0x11b1a9(0x191)+_0x2992fa[_0x11b1a9(0x172)]);}catch(_0x4442ff){console[_0x11b1a9(0xf2)](_0x4442ff),_0x90a156[_0x11b1a9(0x14c)](0xc8)['json']({'message':_0x4442ff['message']});}}),router['get']('/preview/:id',auth,async(_0x37d98b,_0x13e3f6)=>{var _0x5a0f4f=a0_0x35eb13;try{const {username:_0x22a71c,email:_0x569258,role:_0x1c7030}=_0x37d98b['user'],_0x4a246d=_0x37d98b[_0x5a0f4f(0x13c)],_0x236d04=await profile[_0x5a0f4f(0x15e)]({'email':_0x4a246d['email']}),_0x5d4b6c=await master_shop[_0x5a0f4f(0x135)](),_0x5dc125=_0x37d98b[_0x5a0f4f(0x11b)]['id'],_0x1eb229=await adjustment_finished[_0x5a0f4f(0x11f)]({'_id':_0x5dc125}),_0x36abdd=await purchases[_0x5a0f4f(0x112)]([{'$match':{'warehouse_name':_0x1eb229['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x5a0f4f(0xe3),_0x36abdd);const _0x546a1b=await product[_0x5a0f4f(0x135)]({}),_0x139125=await warehouse[_0x5a0f4f(0x112)]([{'$match':{'name':_0x1eb229[_0x5a0f4f(0x106)]}},{'$unwind':_0x5a0f4f(0x12d)},{'$group':{'_id':_0x5a0f4f(0x18d),'name':{'$first':_0x5a0f4f(0x168)},'product_stock':{'$first':_0x5a0f4f(0x121)},'bay':{'$first':_0x5a0f4f(0x148)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5a0f4f(0xf9)},'floorlevel':{'$first':_0x5a0f4f(0x149)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5a0f4f(0x118)},'product_code':{'$first':_0x5a0f4f(0x16b)},'storage':{'$first':_0x5a0f4f(0x104)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5a0f4f(0x13b)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x5a0f4f(0x128)}}}]);if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]=='English\x20(US)'){var _0x34fb2a=users['English'];console['log'](_0x34fb2a);}else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0x152))var _0x34fb2a=users['Hindi'];else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0xf7))var _0x34fb2a=users[_0x5a0f4f(0xf7)];else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0x174))var _0x34fb2a=users['Spanish'];else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0x108))var _0x34fb2a=users[_0x5a0f4f(0x108)];else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0x155))var _0x34fb2a=users[_0x5a0f4f(0x116)];else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0x10f))var _0x34fb2a=users[_0x5a0f4f(0x10f)];else{if(_0x5d4b6c[0x0][_0x5a0f4f(0x107)]==_0x5a0f4f(0x134))var _0x34fb2a=users['Arabic'];}}}}}}}_0x13e3f6[_0x5a0f4f(0xe8)](_0x5a0f4f(0x181),{'success':_0x37d98b['flash'](_0x5a0f4f(0x15f)),'errors':_0x37d98b['flash']('errors'),'role':_0x4a246d,'profile':_0x236d04,'adjustment':_0x1eb229,'stock':_0x139125,'master_shop':_0x5d4b6c,'warehouse_name':_0x36abdd,'unit':_0x546a1b,'language':_0x34fb2a});}catch(_0x34676c){console[_0x5a0f4f(0xf2)](_0x34676c),_0x13e3f6[_0x5a0f4f(0x14c)](0xc8)['json']({'message':_0x34676c[_0x5a0f4f(0x105)]});}}),router[a0_0x35eb13(0x146)]('/preview/:id',auth,async(_0x3ff653,_0x13b44c)=>{var _0x144961=a0_0x35eb13;try{const {invoice:_0x377761,warehouse_name:_0x4f4825,Room_name:_0x4076f3}=_0x3ff653[_0x144961(0x111)],_0x1cf183=_0x3ff653[_0x144961(0x11b)]['id'],_0x5e235c=await adjustment_finished[_0x144961(0x11f)]({'_id':_0x1cf183});var _0x2fad4c;const _0x2cc019=_0x5e235c[_0x144961(0xf8)][_0x144961(0x14e)](async _0x405191=>{var _0x58d022=_0x144961;if(_0x405191[_0x58d022(0x170)]>0x0){_0x2fad4c=await warehouse[_0x58d022(0x15e)]({'name':_0x4f4825,'room':_0x405191[_0x58d022(0x157)]});const _0x4d4d6a=_0x2fad4c['product_details']['map'](_0xe04e4=>{var _0x23f5f2=_0x58d022;console['log'](_0x405191[_0x23f5f2(0x164)]);if(_0x405191[_0x23f5f2(0x164)]==_0x23f5f2(0x102))_0xe04e4[_0x23f5f2(0x172)]==_0x405191['id_transaction']&&(_0xe04e4[_0x23f5f2(0xe0)]=_0xe04e4[_0x23f5f2(0xe0)]-_0x405191['adjust_qty']);else _0x405191[_0x23f5f2(0x164)]==_0x23f5f2(0x17c)&&(_0xe04e4['_id']==_0x405191[_0x23f5f2(0x182)]&&(_0xe04e4[_0x23f5f2(0xe0)]=_0xe04e4[_0x23f5f2(0xe0)]+_0x405191['adjust_qty']));});}return _0x2fad4c;});Promise[_0x144961(0x188)](_0x2cc019)[_0x144961(0x141)](async _0x1b1924=>{var _0x4a4711=_0x144961;try{for(const _0x485e17 of _0x1b1924){await _0x485e17[_0x4a4711(0x124)]();}_0x5e235c[_0x4a4711(0x10b)]=_0x4a4711(0xfb);const _0x13efc4=await _0x5e235c[_0x4a4711(0x124)](),_0x3a5f9e=await master_shop['find'](),_0x3a4aa0=await email_settings[_0x4a4711(0x15e)](),_0x36d8de=await supervisor_settings[_0x4a4711(0x135)]();var _0x52e327=_0x5e235c['product'],_0x16dbf1='',_0x14913e;for(_0x14913e in _0x52e327){var _0x18b9b7='FG';_0x5e235c[_0x4a4711(0x106)]==_0x4a4711(0xff)&&(_0x18b9b7='DG'),_0x16dbf1+=_0x4a4711(0x130)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x52e327[_0x14913e][_0x4a4711(0x187)]+_0x4a4711(0x186)+_0x4a4711(0xf3)+_0x52e327[_0x14913e][_0x4a4711(0x17f)]+_0x4a4711(0x186)+_0x4a4711(0xf3)+_0x52e327[_0x14913e][_0x4a4711(0x170)]+_0x4a4711(0x186)+_0x4a4711(0xf3)+_0x52e327[_0x14913e]['unit']+_0x4a4711(0x186)+_0x4a4711(0xf3)+_0x52e327[_0x14913e][_0x4a4711(0x11e)]+'</td>'+_0x4a4711(0xf3)+_0x5e235c[_0x4a4711(0x106)]+_0x4a4711(0x186)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x52e327[_0x14913e][_0x4a4711(0x157)]+'</td>'+_0x4a4711(0xf3)+_0x18b9b7+_0x52e327[_0x14913e][_0x4a4711(0x127)]+'</td>'+_0x4a4711(0x113);}_0x3ff653['flash'](_0x4a4711(0x15f),_0x4a4711(0x162)),_0x13b44c[_0x4a4711(0x179)](_0x4a4711(0x190)+_0x13efc4['_id']);}catch(_0x4c0ae6){console['error'](_0x4c0ae6),_0x13b44c[_0x4a4711(0x14c)](0x1f4)[_0x4a4711(0x161)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x144961(0x158)](_0x3b41d1=>{var _0x333204=_0x144961;console[_0x333204(0x120)](_0x3b41d1),_0x13b44c[_0x333204(0x14c)](0x1f4)['json']({'error':_0x333204(0xeb)});});}catch(_0xe2d782){_0x13b44c[_0x144961(0x161)]({'message':_0xe2d782[_0x144961(0x105)]});}}),router[a0_0x35eb13(0xe6)](a0_0x35eb13(0x185),auth,async(_0x2aef3c,_0x31ad99)=>{var _0x4f15aa=a0_0x35eb13;try{const {username:_0x57b134,email:_0x479bae,role:_0x408456}=_0x2aef3c[_0x4f15aa(0x13c)],_0x5ad5fc=_0x2aef3c['user'],_0x4198f1=await profile[_0x4f15aa(0x15e)]({'email':_0x5ad5fc[_0x4f15aa(0x12f)]}),_0x18eaf9=await master_shop['find']();console['log'](_0x4f15aa(0xe5),_0x18eaf9);const _0xbafdce=_0x2aef3c[_0x4f15aa(0x11b)]['id'],_0x511689=await adjustment_finished[_0x4f15aa(0x11f)]({'_id':_0xbafdce});let _0x48b251=new Date(_0x511689[_0x4f15aa(0x169)]),_0x27a95e=('0'+_0x48b251[_0x4f15aa(0x10c)]())[_0x4f15aa(0xf4)](-0x2),_0x6be811=('0'+(_0x48b251[_0x4f15aa(0x10a)]()+0x1))[_0x4f15aa(0xf4)](-0x2),_0x4454fe=_0x48b251['getFullYear'](),_0xcd2749=_0x4454fe+'-'+_0x6be811+'-'+_0x27a95e;var _0x4ef026=[_0x4f15aa(0xef),_0x4f15aa(0x13e),_0x4f15aa(0xe4)];const _0x15cc9a=await purchases[_0x4f15aa(0x112)]([{'$match':{'warehouse_name':_0x511689[_0x4f15aa(0x106)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x4f15aa(0xf2)]('purchases_data',_0x15cc9a);const _0x263bba=await product['find']({}),_0x121b7b=await warehouse[_0x4f15aa(0x112)]([{'$match':{'name':_0x511689[_0x4f15aa(0x106)],'room':_0x511689['room']}},{'$unwind':_0x4f15aa(0x12d)},{'$group':{'_id':_0x4f15aa(0x18d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4f15aa(0x121)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4f15aa(0x171)},'type':{'$first':_0x4f15aa(0xf9)},'floorlevel':{'$first':_0x4f15aa(0x149)},'primary_code':{'$first':_0x4f15aa(0x18c)},'secondary_code':{'$first':_0x4f15aa(0x118)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4f15aa(0x15c)}}}]);if(_0x18eaf9[0x0]['language']==_0x4f15aa(0x151)){var _0x329a6c=users[_0x4f15aa(0x139)];console[_0x4f15aa(0xf2)](_0x329a6c);}else{if(_0x18eaf9[0x0][_0x4f15aa(0x107)]==_0x4f15aa(0x152))var _0x329a6c=users[_0x4f15aa(0x152)];else{if(_0x18eaf9[0x0][_0x4f15aa(0x107)]==_0x4f15aa(0xf7))var _0x329a6c=users['German'];else{if(_0x18eaf9[0x0][_0x4f15aa(0x107)]==_0x4f15aa(0x174))var _0x329a6c=users['Spanish'];else{if(_0x18eaf9[0x0][_0x4f15aa(0x107)]==_0x4f15aa(0x108))var _0x329a6c=users['French'];else{if(_0x18eaf9[0x0]['language']==_0x4f15aa(0x155))var _0x329a6c=users[_0x4f15aa(0x116)];else{if(_0x18eaf9[0x0][_0x4f15aa(0x107)]==_0x4f15aa(0x10f))var _0x329a6c=users[_0x4f15aa(0x10f)];else{if(_0x18eaf9[0x0][_0x4f15aa(0x107)]==_0x4f15aa(0x134))var _0x329a6c=users[_0x4f15aa(0x14d)];}}}}}}}_0x31ad99[_0x4f15aa(0xe8)](_0x4f15aa(0x177),{'success':_0x2aef3c[_0x4f15aa(0x129)](_0x4f15aa(0x15f)),'errors':_0x2aef3c[_0x4f15aa(0x129)](_0x4f15aa(0xdf)),'role':_0x5ad5fc,'profile':_0x4198f1,'adjustment':_0x511689,'stock':_0x121b7b,'master_shop':_0x18eaf9,'warehouse_name':_0x15cc9a,'unit':_0x263bba,'language':_0x329a6c,'rooms_data':_0x4ef026,'ed_fullDate':_0xcd2749});}catch(_0x4aa770){console[_0x4f15aa(0xf2)](_0x4aa770),_0x31ad99[_0x4f15aa(0x14c)](0xc8)[_0x4f15aa(0x161)]({'message':_0x4aa770[_0x4f15aa(0x105)]});}}),router[a0_0x35eb13(0x146)]('/view/:id',auth,async(_0x472680,_0xc5dca)=>{var _0x48ec25=a0_0x35eb13;try{const _0x3c4f72=_0x472680[_0x48ec25(0x11b)]['id'],_0x26b639=await adjustment_finished[_0x48ec25(0x11f)]({'_id':_0x3c4f72}),_0x2b59fa=await warehouse['findOne']({'name':_0x26b639[_0x48ec25(0x106)],'room':_0x26b639[_0x48ec25(0xe1)]}),{warehouse_name:_0x570897,date:_0x2ca16a,prod_name:_0x32c239,level:_0x422cf2,isle:_0x3e01d3,pallet:_0x560d41,stock:_0x61eac7,types:_0x3192a4,adjust_qty:_0x2447f7,new_adjust_qty:_0x1c3e52,note:_0x4bbbbb,Room_name:_0x4b8fa4,invoice:_0x2023e1,JO_number:_0x1c201b}=_0x472680[_0x48ec25(0x111)];if(typeof _0x32c239==_0x48ec25(0x119))var _0x1093cf=[_0x472680['body'][_0x48ec25(0xed)]],_0x5a9df1=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x17b)]],_0x4cc34b=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x175)]],_0x1b9b47=[_0x472680[_0x48ec25(0x111)]['types']],_0x143b12=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x170)]],_0x3c2e0e=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0xfc)]],_0x14ebaf=[_0x472680['body']['prod_code']],_0x30e4eb=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x109)]],_0x1d5910=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x16c)]],_0x442f1f=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x14a)]],_0x65ddc5=[_0x472680[_0x48ec25(0x111)][_0x48ec25(0x169)]];else var _0x1093cf=[..._0x472680['body'][_0x48ec25(0xed)]],_0x5a9df1=[..._0x472680[_0x48ec25(0x111)][_0x48ec25(0x17b)]],_0x4cc34b=[..._0x472680['body']['stock']],_0x1b9b47=[..._0x472680[_0x48ec25(0x111)][_0x48ec25(0x164)]],_0x143b12=[..._0x472680[_0x48ec25(0x111)][_0x48ec25(0x170)]],_0x3c2e0e=[..._0x472680['body'][_0x48ec25(0xfc)]],_0x14ebaf=[..._0x472680['body'][_0x48ec25(0x160)]],_0x30e4eb=[..._0x472680['body'][_0x48ec25(0x109)]],_0x1d5910=[..._0x472680[_0x48ec25(0x111)][_0x48ec25(0x16c)]],_0x442f1f=[..._0x472680[_0x48ec25(0x111)][_0x48ec25(0x14a)]],_0x65ddc5=[..._0x472680[_0x48ec25(0x111)][_0x48ec25(0x169)]];const _0x2c515b=_0x1093cf[_0x48ec25(0x14e)](_0x3ae733=>{return _0x3ae733={'product_name':_0x3ae733};});_0x5a9df1[_0x48ec25(0x180)]((_0x455153,_0x6e851f)=>{var _0x13dee6=_0x48ec25;_0x2c515b[_0x6e851f][_0x13dee6(0x127)]=_0x455153;}),_0x4cc34b[_0x48ec25(0x180)]((_0x5f413b,_0x4a51eb)=>{var _0x2f8128=_0x48ec25;_0x2c515b[_0x4a51eb][_0x2f8128(0x167)]=_0x5f413b;}),_0x1b9b47[_0x48ec25(0x180)]((_0x444ca7,_0xc73368)=>{var _0x545d95=_0x48ec25;_0x2c515b[_0xc73368][_0x545d95(0x164)]=_0x444ca7;}),_0x143b12[_0x48ec25(0x180)]((_0x165a8d,_0x1ea40d)=>{_0x2c515b[_0x1ea40d]['adjust_qty']=_0x165a8d;}),_0x3c2e0e[_0x48ec25(0x180)]((_0x3cf659,_0x45d706)=>{var _0x5423d1=_0x48ec25;_0x2c515b[_0x45d706][_0x5423d1(0xfc)]=_0x3cf659;}),_0x30e4eb[_0x48ec25(0x180)]((_0x5ed2c4,_0x44e8b1)=>{var _0x2413ca=_0x48ec25;_0x2c515b[_0x44e8b1][_0x2413ca(0x109)]=_0x5ed2c4;}),_0x1d5910['forEach']((_0x355fa4,_0x49513a)=>{var _0x4ebf9e=_0x48ec25;_0x2c515b[_0x49513a][_0x4ebf9e(0x11e)]=_0x355fa4;}),_0x14ebaf[_0x48ec25(0x180)]((_0x1037af,_0x561d61)=>{var _0x4f15d0=_0x48ec25;_0x2c515b[_0x561d61][_0x4f15d0(0x17f)]=_0x1037af;}),_0x442f1f[_0x48ec25(0x180)]((_0x236c49,_0x231bb2)=>{var _0x7ed4b8=_0x48ec25;_0x2c515b[_0x231bb2][_0x7ed4b8(0x14a)]=_0x236c49;}),_0x65ddc5['forEach']((_0x555121,_0x2db4ac)=>{var _0x4df738=_0x48ec25;_0x2c515b[_0x2db4ac][_0x4df738(0x169)]=_0x555121;});const _0x1eb7c2=_0x2c515b[_0x48ec25(0x12a)](_0x100e30=>_0x100e30[_0x48ec25(0x170)]!=='0'&&_0x100e30['adjust_qty']!=='');var _0x44cffa=0x0;_0x1eb7c2['forEach'](_0x59ef1c=>{var _0x22e9cb=_0x48ec25;console[_0x22e9cb(0xf2)]('foreach\x20newproduct',_0x59ef1c),parseInt(_0x59ef1c[_0x22e9cb(0x170)])<=0x0&&_0x44cffa++;});if(_0x44cffa!=0x0)return _0x472680['flash'](_0x48ec25(0xdf),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0xc5dca[_0x48ec25(0x179)](_0x48ec25(0x115));_0x26b639['warehouse_name']=_0x570897,_0x26b639[_0x48ec25(0x150)]=_0x2ca16a,_0x26b639['product']=_0x1eb7c2,_0x26b639[_0x48ec25(0x122)]=_0x4bbbbb,_0x26b639[_0x48ec25(0xe1)]=_0x4b8fa4,_0x26b639[_0x48ec25(0x17a)]=_0x2023e1,_0x26b639[_0x48ec25(0xe2)]=_0x1c201b;const _0x1bf13f=await _0x26b639[_0x48ec25(0x124)](),_0x25f02f=await warehouse[_0x48ec25(0x15e)]({'name':_0x570897,'room':_0x4b8fa4});_0x1bf13f[_0x48ec25(0xf8)][_0x48ec25(0x180)](_0x10bea1=>{var _0x1bbe1b=_0x48ec25;const _0x1488d2=_0x25f02f[_0x1bbe1b(0x103)][_0x1bbe1b(0x14e)](_0x463bd2=>{var _0x5d5458=_0x1bbe1b;_0x10bea1[_0x5d5458(0x164)]==_0x5d5458(0x102)?_0x463bd2[_0x5d5458(0x187)]==_0x10bea1['product_name']&&_0x463bd2['bay']==_0x10bea1[_0x5d5458(0x127)]&&(_0x463bd2[_0x5d5458(0xe0)]=parseInt(_0x463bd2[_0x5d5458(0xe0)])-parseInt(_0x10bea1[_0x5d5458(0x170)])):_0x463bd2[_0x5d5458(0x187)]==_0x10bea1[_0x5d5458(0x187)]&&_0x463bd2[_0x5d5458(0x127)]==_0x10bea1[_0x5d5458(0x127)]&&(_0x463bd2[_0x5d5458(0xe0)]=parseInt(_0x463bd2[_0x5d5458(0xe0)])+parseInt(_0x10bea1[_0x5d5458(0x170)]));});}),await _0x25f02f[_0x48ec25(0x124)](),_0x472680[_0x48ec25(0x129)]('success',_0x48ec25(0x184)),_0xc5dca[_0x48ec25(0x179)](_0x48ec25(0x142));}catch(_0x402488){console[_0x48ec25(0xf2)](_0x402488);}}),router['post'](a0_0x35eb13(0x12b),async(_0x27dfcd,_0x133cf4)=>{var _0x5e587a=a0_0x35eb13;const {primary_code:_0x5e30db,warehouse_data:_0x620def,rooms_data:_0x5f2c20,Roomslist:_0x299cd9}=_0x27dfcd['body'],_0x544f04=_0x299cd9['split'](','),_0x3954e4=[];async function _0x2d43f9(_0x492f01){var _0x5c4885=a0_0x5487;const _0x34df1f=await warehouse['aggregate']([{'$match':{'name':_0x620def,'room':_0x492f01}},{'$unwind':_0x5c4885(0x12d)},{'$match':{'product_details.primary_code':_0x5e30db}},{'$group':{'_id':_0x5c4885(0x18d),'name':{'$first':_0x5c4885(0x168)},'product_stock':{'$first':_0x5c4885(0x121)},'primary_code':{'$first':_0x5c4885(0x18c)},'secondary_code':{'$first':_0x5c4885(0x118)},'product_code':{'$first':_0x5c4885(0x16b)},'level':{'$first':_0x5c4885(0x178)},'bay':{'$first':_0x5c4885(0x148)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x5c4885(0x149)},'unit':{'$first':_0x5c4885(0x17d)},'secondary_unit':{'$first':_0x5c4885(0x166)},'storage':{'$first':_0x5c4885(0x104)},'rack':{'$first':_0x5c4885(0x15c)},'expiry_date':{'$first':_0x5c4885(0x13b)},'production_date':{'$first':_0x5c4885(0x16d)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x5c4885(0x11d)},'roomNamed':{'$first':_0x5c4885(0x128)},'invoice':{'$first':_0x5c4885(0x13a)}}}]),_0x51b1da=await warehouse[_0x5c4885(0x112)]([{'$match':{'name':_0x620def,'room':_0x492f01}},{'$unwind':_0x5c4885(0x12d)},{'$match':{'product_details.secondary_code':_0x5e30db}},{'$group':{'_id':_0x5c4885(0x18d),'name':{'$first':_0x5c4885(0x168)},'product_stock':{'$first':_0x5c4885(0x121)},'primary_code':{'$first':_0x5c4885(0x18c)},'secondary_code':{'$first':_0x5c4885(0x118)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5c4885(0x178)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x5c4885(0xf9)},'pallet':{'$first':_0x5c4885(0x149)},'unit':{'$first':_0x5c4885(0x17d)},'secondary_unit':{'$first':_0x5c4885(0x166)},'storage':{'$first':_0x5c4885(0x104)},'rack':{'$first':_0x5c4885(0x15c)},'expiry_date':{'$first':_0x5c4885(0x13b)},'production_date':{'$first':_0x5c4885(0x16d)},'batch_code':{'$first':_0x5c4885(0x16f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5c4885(0x11d)},'roomNamed':{'$first':_0x5c4885(0x128)},'invoice':{'$first':_0x5c4885(0x13a)}}}]);if(_0x34df1f['length']>0x0)_0x3954e4[_0x5c4885(0x138)](_0x34df1f);else _0x51b1da[_0x5c4885(0xf6)]>0x0&&_0x3954e4['push'](_0x51b1da);}const _0x4e0dd8=_0x544f04[_0x5e587a(0x14e)](_0x2380bc=>_0x2d43f9(_0x2380bc));await Promise[_0x5e587a(0x188)](_0x4e0dd8),_0x133cf4[_0x5e587a(0x161)](_0x3954e4);}),router['post']('/CheckingWarehouse',async(_0x1fae04,_0x15a6a7)=>{var _0x4eec9c=a0_0x35eb13;const {productCode:_0x511a2a,bay:_0x4cb10c,warehouses:_0x2a21f2,room:_0x172411}=_0x1fae04[_0x4eec9c(0x111)];console[_0x4eec9c(0xf2)](_0x1fae04[_0x4eec9c(0x111)]);try{const _0x453b94=await warehouse[_0x4eec9c(0x112)]([{'$match':{'name':_0x2a21f2,'room':_0x172411}},{'$unwind':_0x4eec9c(0x12d)},{'$match':{'product_details.bay':parseInt(_0x4cb10c)}},{'$group':{'_id':_0x4eec9c(0x18d),'name':{'$first':_0x4eec9c(0x168)},'product_stock':{'$first':_0x4eec9c(0x121)},'bay':{'$first':_0x4eec9c(0x148)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x15a6a7[_0x4eec9c(0x14c)](0xc8)[_0x4eec9c(0x161)](_0x453b94);}catch(_0x433838){_0x15a6a7['status'](0x194)['json']({'message':_0x433838[_0x4eec9c(0x105)]});}}),module[a0_0x35eb13(0x126)]=router;