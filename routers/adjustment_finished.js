var a0_0x1abeb9=a0_0x35a5;(function(_0x20ea09,_0x330fde){var _0x40e53f=a0_0x35a5,_0x2f05d9=_0x20ea09();while(!![]){try{var _0x5c8024=-parseInt(_0x40e53f(0xfa))/0x1+-parseInt(_0x40e53f(0x115))/0x2+-parseInt(_0x40e53f(0xf4))/0x3+parseInt(_0x40e53f(0x11a))/0x4+-parseInt(_0x40e53f(0x125))/0x5+-parseInt(_0x40e53f(0x104))/0x6+parseInt(_0x40e53f(0x135))/0x7;if(_0x5c8024===_0x330fde)break;else _0x2f05d9['push'](_0x2f05d9['shift']());}catch(_0x4e26db){_0x2f05d9['push'](_0x2f05d9['shift']());}}}(a0_0xacea,0x8ecde));const express=require(a0_0x1abeb9(0xdd)),app=express(),router=express['Router'](),auth=require(a0_0x1abeb9(0x14b)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x1abeb9(0x11f)),users=require(a0_0x1abeb9(0xc5)),nodemailer=require(a0_0x1abeb9(0x110));router[a0_0x1abeb9(0x113)](a0_0x1abeb9(0xcd),auth,async(_0x37e6ed,_0x208bde)=>{var _0x5261aa=a0_0x1abeb9;try{const {username:_0x533e50,email:_0x4cbd05,role:_0x27e804}=_0x37e6ed[_0x5261aa(0x109)],_0x1de848=_0x37e6ed[_0x5261aa(0x109)],_0x36e40e=await profile['findOne']({'email':_0x1de848[_0x5261aa(0x130)]}),_0x41fa95=await master_shop[_0x5261aa(0xc1)]();let _0x3dfa60;if(_0x1de848['role']==_0x5261aa(0xef)){const _0x59daf3=await staff[_0x5261aa(0xe6)]({'email':_0x1de848[_0x5261aa(0x130)]});_0x3dfa60=await warehouse['find']({'status':'Enabled','name':_0x59daf3[_0x5261aa(0x144)]});}else _0x3dfa60=await warehouse[_0x5261aa(0xc1)]({'status':_0x5261aa(0xd8)});const _0x58e5f7=await product['find']();let _0x33382e;if(_0x1de848[_0x5261aa(0x14a)]=='staff'){const _0x41e920=await staff[_0x5261aa(0xe6)]({'email':_0x1de848[_0x5261aa(0x130)]});_0x33382e=await adjustment_finished[_0x5261aa(0xc1)]({'warehouse_name':_0x41e920[_0x5261aa(0x144)]});}else _0x33382e=await adjustment_finished[_0x5261aa(0xe7)]([{'$match':{'type_of_transaction':_0x5261aa(0xf6)}},{'$unwind':_0x5261aa(0x134)},{'$group':{'_id':_0x5261aa(0xc6),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5261aa(0xc0)},'room':{'$addToSet':_0x5261aa(0x14d)},'finalize':{'$first':_0x5261aa(0xa1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x41fa95[0x0][_0x5261aa(0x12e)]==_0x5261aa(0xfd)){var _0x4c473a=users[_0x5261aa(0xab)];console[_0x5261aa(0xc3)](_0x4c473a);}else{if(_0x41fa95[0x0]['language']==_0x5261aa(0xa5))var _0x4c473a=users[_0x5261aa(0xa5)];else{if(_0x41fa95[0x0][_0x5261aa(0x12e)]==_0x5261aa(0x10f))var _0x4c473a=users[_0x5261aa(0x10f)];else{if(_0x41fa95[0x0][_0x5261aa(0x12e)]=='Spanish')var _0x4c473a=users[_0x5261aa(0xe4)];else{if(_0x41fa95[0x0]['language']==_0x5261aa(0xad))var _0x4c473a=users[_0x5261aa(0xad)];else{if(_0x41fa95[0x0][_0x5261aa(0x12e)]=='Portuguese\x20(BR)')var _0x4c473a=users[_0x5261aa(0x13c)];else{if(_0x41fa95[0x0]['language']==_0x5261aa(0x12b))var _0x4c473a=users[_0x5261aa(0x12b)];else{if(_0x41fa95[0x0]['language']==_0x5261aa(0xb5))var _0x4c473a=users[_0x5261aa(0x12f)];}}}}}}}_0x208bde[_0x5261aa(0xd9)](_0x5261aa(0x12d),{'success':_0x37e6ed[_0x5261aa(0xca)](_0x5261aa(0x149)),'errors':_0x37e6ed['flash'](_0x5261aa(0xc8)),'role':_0x1de848,'profile':_0x36e40e,'warehouse':_0x3dfa60,'product':_0x58e5f7,'adjustment':_0x33382e,'master_shop':_0x41fa95,'language':_0x4c473a});}catch(_0x34343a){console['log'](_0x34343a);}}),router['get'](a0_0x1abeb9(0x106),auth,async(_0x4d46ae,_0x5c09bc)=>{var _0x5b3583=a0_0x1abeb9;try{const {username:_0x87f121,email:_0x2fb33a,role:_0x30563c}=_0x4d46ae[_0x5b3583(0x109)],_0x4bbc61=_0x4d46ae['user'],_0x54b8e3=await profile[_0x5b3583(0xe6)]({'email':_0x4bbc61['email']}),_0x111f65=await master_shop[_0x5b3583(0xc1)]();let _0x1fd2b7;if(_0x4bbc61[_0x5b3583(0x14a)]==_0x5b3583(0xef)){const _0x3ea9be=await staff[_0x5b3583(0xe6)]({'email':_0x4bbc61['email']});_0x1fd2b7=await warehouse[_0x5b3583(0xc1)]({'status':_0x5b3583(0xd8),'name':_0x3ea9be[_0x5b3583(0x144)]});}else _0x1fd2b7=await warehouse['find']({'status':'Enabled'});const _0x4a78ee=await product['find']();let _0x5f153e;if(_0x4bbc61[_0x5b3583(0x14a)]==_0x5b3583(0xef)){const _0x14687b=await staff[_0x5b3583(0xe6)]({'email':_0x4bbc61[_0x5b3583(0x130)]});_0x5f153e=await adjustment_finished[_0x5b3583(0xc1)]({'warehouse_name':_0x14687b[_0x5b3583(0x144)]});}else _0x5f153e=await adjustment_finished[_0x5b3583(0xe7)]([{'$match':{'type_of_transaction':_0x5b3583(0xaf)}},{'$unwind':'$product'},{'$group':{'_id':_0x5b3583(0xc6),'invoice':{'$first':_0x5b3583(0xf5)},'date':{'$first':_0x5b3583(0x13d)},'warehouse_name':{'$first':_0x5b3583(0xc0)},'room':{'$addToSet':_0x5b3583(0x14d)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x111f65[0x0][_0x5b3583(0x12e)]=='English\x20(US)')var _0x1f5fb3=users['English'];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]==_0x5b3583(0xa5))var _0x1f5fb3=users['Hindi'];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]==_0x5b3583(0x10f))var _0x1f5fb3=users[_0x5b3583(0x10f)];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]==_0x5b3583(0xe4))var _0x1f5fb3=users[_0x5b3583(0xe4)];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]==_0x5b3583(0xad))var _0x1f5fb3=users['French'];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]=='Portuguese\x20(BR)')var _0x1f5fb3=users[_0x5b3583(0x13c)];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]==_0x5b3583(0x12b))var _0x1f5fb3=users[_0x5b3583(0x12b)];else{if(_0x111f65[0x0][_0x5b3583(0x12e)]=='Arabic\x20(ae)')var _0x1f5fb3=users[_0x5b3583(0x12f)];}}}}}}}_0x5c09bc[_0x5b3583(0xd9)](_0x5b3583(0xc4),{'success':_0x4d46ae[_0x5b3583(0xca)](_0x5b3583(0x149)),'errors':_0x4d46ae[_0x5b3583(0xca)](_0x5b3583(0xc8)),'role':_0x4bbc61,'profile':_0x54b8e3,'warehouse':_0x1fd2b7,'product':_0x4a78ee,'adjustment':_0x5f153e,'master_shop':_0x111f65,'language':_0x1f5fb3});}catch(_0x569a18){console[_0x5b3583(0xc3)](_0x569a18);}});function a0_0x35a5(_0x3e9205,_0x5b7d62){var _0xacea03=a0_0xacea();return a0_0x35a5=function(_0x35a56e,_0x5d7933){_0x35a56e=_0x35a56e-0xa1;var _0x5e89c1=_0xacea03[_0x35a56e];return _0x5e89c1;},a0_0x35a5(_0x3e9205,_0x5b7d62);}async function getRandom8DigitNumber(){var _0x5d0c1a=a0_0x1abeb9;const _0x6ada89=0x989680,_0x2bb3b0=0x5f5e0ff,_0x5c9417=Math[_0x5d0c1a(0x10e)](Math[_0x5d0c1a(0x128)]()*(_0x2bb3b0-_0x6ada89+0x1))+_0x6ada89;var _0x57293d;const _0x20070c=await adjustment_finished['findOne']({'invoice':'ADJF-'+_0x5c9417});return _0x20070c&&_0x20070c[_0x5d0c1a(0x11e)]>0x0?_0x57293d=_0x5d0c1a(0x12a)+_0x5c9417:_0x57293d=_0x5d0c1a(0x12a)+_0x5c9417,_0x57293d;}function a0_0xacea(){var _0x2b8311=['Portuguese\x20(BR)','warehouse','foreach\x20newproduct','JO_number','invoice','prod_cat','success','role','../middleware/auth','/view/add_adjustment_logs','$product.room_names','An\x20error\x20occurred\x20while\x20saving\x20data.','split','date','$product_details.rack','$finalize','warehouse_name','$product_details.production_date','room_names','Hindi','minus','new_adjust_qty','all','slice','$product_details._id','English','</td>','French','True','logs','Ambient','$room','/view/add_adjustment','string','findById','Arabic\x20(ae)','invoice_init','adjustment\x20data\x20update\x20successfully','stockBefore','note','unit','New_Qty_Converted_adj','$product_details.level','$product_details.bin','/view/:id','maxPerUnit','$warehouse_name','find','prod_code','log','adjustment_finished_logs','../public/language/languages.json','$_id','json','errors','level','flash','product','toString','/view','id_transaction_from','New_Qty_Converted','bay','product_date','$product_details.invoice','then','padStart','Secondary_units','product_details','filter','Enabled','render','finalize','$product_details.batch_code','</tr>','express','$name','getMonth','save','$product_details.storage','$product_details','$product.product_name','Spanish','add','findOne','aggregate','An\x20error\x20occurred.','room','product_code','/barcode_scanner','adjustment\x20add\x20successfull','DRY\x20GOODS','$product_details.product_stock','staff','Rooms','product_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/adjustment_finished/preview/','1004400yDOxMQ','$invoice','own','<tr>','$product_details.bay','_id','796318atBTqC','forEach','back','English\x20(US)','$product_details.product_code','map','$product_details.secondary_unit','post','Return\x20Rooms','adjust_qty','1857828RDsIgF','/preview/:id','/view_logs','$product_details.secondary_code','LOG-ADJ-','user','batch_code','secondary_unit','stock','expiry_date','floor','German','nodemailer','$product_details.unit','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','get','$product_details.primary_code','51524mIbFzg','master','Adjustment\x20Finalize\x20Successfully','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.expiry_date','2564020lYCtkH','redirect','edit_adjustment_finished_view','purchases_data','length','../models/all_models','production_date','product_stock','id_transaction','Primary_Units','error','2823070xCdBbo','Enclosed','prod_name','random','/CheckingWarehouse','ADJF-','Chinese','$product_details.product_name','adjustment_finished','language','Arabic','email','types','$product_details.maxPerUnit','$product_details.type','$product','13825371ywMyJG','catch','params','push','prod_invoice','match','body','Portuguese','$date','add_adjustment_finished','$product_details.floorlevel','status','$product_details.maxProducts','message'];a0_0xacea=function(){return _0x2b8311;};return a0_0xacea();}router[a0_0x1abeb9(0x113)](a0_0x1abeb9(0xb2),auth,async(_0x371d04,_0x3f6258)=>{var _0x2ed4f2=a0_0x1abeb9;try{const {username:_0x25f00a,email:_0x2a3cc1,role:_0x8923b2}=_0x371d04[_0x2ed4f2(0x109)],_0x106ce5=_0x371d04[_0x2ed4f2(0x109)],_0x18c080=await profile[_0x2ed4f2(0xe6)]({'email':_0x106ce5['email']}),_0x3dd56f=await master_shop[_0x2ed4f2(0xc1)]();let _0x46dd49;if(_0x106ce5[_0x2ed4f2(0x14a)]=='staff'){const _0x17bf60=await staff[_0x2ed4f2(0xe6)]({'email':_0x106ce5[_0x2ed4f2(0x130)]});_0x46dd49=await warehouse['aggregate']([{'$match':{'status':_0x2ed4f2(0xd8),'name':_0x17bf60['warehouse']}},{'$group':{'_id':_0x2ed4f2(0xde),'name':{'$first':'$name'}}}]);}else _0x46dd49=await warehouse[_0x2ed4f2(0xe7)]([{'$match':{'status':_0x2ed4f2(0xd8)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x40c0c1=await product[_0x2ed4f2(0xc1)]({}),_0x5ab692=await adjustment_finished[_0x2ed4f2(0xc1)](),_0x4110cf=_0x5ab692[_0x2ed4f2(0x11e)]+0x1,_0x5cb0f8='ADJF-'+_0x4110cf[_0x2ed4f2(0xcc)]()[_0x2ed4f2(0xd4)](0x5,'0');var _0x25cd90=[_0x2ed4f2(0xb0),_0x2ed4f2(0x126),_0x2ed4f2(0x102)];if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]==_0x2ed4f2(0xfd))var _0x24033a=users[_0x2ed4f2(0xab)];else{if(_0x3dd56f[0x0]['language']=='Hindi')var _0x24033a=users[_0x2ed4f2(0xa5)];else{if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]==_0x2ed4f2(0x10f))var _0x24033a=users['German'];else{if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]==_0x2ed4f2(0xe4))var _0x24033a=users[_0x2ed4f2(0xe4)];else{if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]=='French')var _0x24033a=users[_0x2ed4f2(0xad)];else{if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]==_0x2ed4f2(0x143))var _0x24033a=users['Portuguese'];else{if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]==_0x2ed4f2(0x12b))var _0x24033a=users['Chinese'];else{if(_0x3dd56f[0x0][_0x2ed4f2(0x12e)]==_0x2ed4f2(0xb5))var _0x24033a=users['Arabic'];}}}}}}}const _0x399150=getRandom8DigitNumber();_0x399150[_0x2ed4f2(0xd3)](_0x53beeb=>{var _0x1415fe=_0x2ed4f2;_0x3f6258[_0x1415fe(0xd9)](_0x1415fe(0x13e),{'success':_0x371d04[_0x1415fe(0xca)](_0x1415fe(0x149)),'errors':_0x371d04['flash']('errors'),'role':_0x106ce5,'profile':_0x18c080,'warehouse':_0x46dd49,'product':_0x40c0c1,'master_shop':_0x3dd56f,'language':_0x24033a,'rooms_data':_0x25cd90,'invoice_no':_0x53beeb});})[_0x2ed4f2(0x136)](_0x102819=>{var _0x4dfb20=_0x2ed4f2;_0x371d04[_0x4dfb20(0xca)](_0x4dfb20(0xc8),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3f6258[_0x4dfb20(0x11b)]('/adjustment/view');});}catch(_0x471de7){console[_0x2ed4f2(0xc3)](_0x471de7);}}),router[a0_0x1abeb9(0x101)](a0_0x1abeb9(0xb2),auth,async(_0x2986ef,_0x5c46bf)=>{var _0xf0a2c2=a0_0x1abeb9;try{const {warehouse_name:_0xda8228,date:_0x2c010d,prod_name:_0x386c6a,level:_0x4ed3b6,isle:_0x200a95,pallet:_0xa083c1,stock:_0x4931f0,types:_0x49d7ba,adjust_qty:_0x159f68,new_adjust_qty:_0x1df095,note:_0x1e86ec,Room_name:_0x218ed2,JO_number:_0x43ae1d,expiry_date:_0xa16f96,PO_number:_0x2dda35,ReqBy:_0xbd4de5,dateofreq:_0x3adf43,typeservicesData:_0x5515d7,destination:_0x2c7c49,deliverydate:_0x3cd051,driver:_0x248449,plate:_0x3ffd7c,van:_0x497df9,DRSI:_0x45eb05,typevehicle:_0x43a3bf,TSU:_0x2e73e6,TFU:_0x4d4bc2}=_0x2986ef[_0xf0a2c2(0x13b)];if(typeof _0x386c6a==_0xf0a2c2(0xb3))var _0x2f1164=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x127)]],_0x6b393=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xc9)]],_0x1b15e8=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x10c)]],_0x1f667c=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x131)]],_0x352f44=[_0x2986ef[_0xf0a2c2(0x13b)]['New_Qty_Converted_adj']],_0x436589=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xcf)]],_0xc760ab=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x123)]],_0x1ca9e8=[_0x2986ef[_0xf0a2c2(0x13b)]['Secondary_units']],_0x1ec03d=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xc2)]],_0x7acb0d=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x10a)]],_0xa8af4a=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x10d)]],_0x1a6fcb=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xd1)]],_0x230879=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x148)]],_0x532d0f=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xf0)]],_0x1afeb4=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xbf)]],_0x5cffe3=[_0x2986ef[_0xf0a2c2(0x13b)]['prod_invoice']],_0x94aa66=[_0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xce)]];else var _0x2f1164=[..._0x2986ef['body'][_0xf0a2c2(0x127)]],_0x6b393=[..._0x2986ef[_0xf0a2c2(0x13b)]['level']],_0x1b15e8=[..._0x2986ef[_0xf0a2c2(0x13b)]['stock']],_0x1f667c=[..._0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x131)]],_0x352f44=[..._0x2986ef['body'][_0xf0a2c2(0xbb)]],_0x436589=[..._0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xcf)]],_0xc760ab=[..._0x2986ef[_0xf0a2c2(0x13b)]['Primary_Units']],_0x1ca9e8=[..._0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xd5)]],_0x1ec03d=[..._0x2986ef[_0xf0a2c2(0x13b)]['prod_code']],_0x7acb0d=[..._0x2986ef[_0xf0a2c2(0x13b)]['batch_code']],_0xa8af4a=[..._0x2986ef[_0xf0a2c2(0x13b)]['expiry_date']],_0x1a6fcb=[..._0x2986ef[_0xf0a2c2(0x13b)]['product_date']],_0x230879=[..._0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0x148)]],_0x532d0f=[..._0x2986ef[_0xf0a2c2(0x13b)][_0xf0a2c2(0xf0)]],_0x1afeb4=[..._0x2986ef['body'][_0xf0a2c2(0xbf)]],_0x5cffe3=[..._0x2986ef[_0xf0a2c2(0x13b)]['prod_invoice']],_0x94aa66=[..._0x2986ef['body'][_0xf0a2c2(0xce)]];const _0x1a6cd4=_0x2f1164[_0xf0a2c2(0xff)](_0x19eb27=>{return _0x19eb27={'product_name':_0x19eb27};});_0x6b393[_0xf0a2c2(0xfb)]((_0x66837c,_0x53b04f)=>{var _0x5ed552=_0xf0a2c2,_0x2ff172=_0x66837c['match'](/[A-Za-z]+/)[0x0],_0x497b40=parseInt(_0x66837c[_0x5ed552(0x13a)](/\d+/)[0x0]);_0x1a6cd4[_0x53b04f][_0x5ed552(0xc9)]=_0x2ff172,_0x1a6cd4[_0x53b04f]['bay']=_0x497b40;}),_0x94aa66[_0xf0a2c2(0xfb)]((_0xd9f980,_0xfc23df)=>{var _0x3b219b=_0xf0a2c2;_0x1a6cd4[_0xfc23df][_0x3b219b(0x122)]=_0xd9f980;}),_0x1b15e8['forEach']((_0x50a053,_0x2f7ad2)=>{var _0x1e8bb4=_0xf0a2c2;_0x1a6cd4[_0x2f7ad2][_0x1e8bb4(0xb8)]=_0x50a053;}),_0x1f667c[_0xf0a2c2(0xfb)]((_0x561d33,_0x3c862e)=>{_0x1a6cd4[_0x3c862e]['types']=_0x561d33;}),_0x352f44[_0xf0a2c2(0xfb)]((_0x4d32ad,_0x476afa)=>{var _0xedf95c=_0xf0a2c2;_0x1a6cd4[_0x476afa][_0xedf95c(0x103)]=_0x4d32ad;}),_0x436589[_0xf0a2c2(0xfb)]((_0x642601,_0x1aa6e1)=>{var _0x1f917d=_0xf0a2c2;_0x1a6cd4[_0x1aa6e1][_0x1f917d(0xa7)]=_0x642601;}),_0xc760ab['forEach']((_0x959ab6,_0x456708)=>{var _0x384486=_0xf0a2c2;_0x1a6cd4[_0x456708][_0x384486(0xba)]=_0x959ab6;}),_0x1ca9e8[_0xf0a2c2(0xfb)]((_0x1cb150,_0x406aa3)=>{var _0x2f6ab5=_0xf0a2c2;_0x1a6cd4[_0x406aa3][_0x2f6ab5(0x10b)]=_0x1cb150;}),_0x1ec03d[_0xf0a2c2(0xfb)]((_0x6a6558,_0x56e890)=>{var _0x278021=_0xf0a2c2;_0x1a6cd4[_0x56e890][_0x278021(0xea)]=_0x6a6558;}),_0x7acb0d['forEach']((_0x4621c1,_0x39a480)=>{var _0x402f12=_0xf0a2c2;_0x1a6cd4[_0x39a480][_0x402f12(0x10a)]=_0x4621c1;}),_0xa8af4a[_0xf0a2c2(0xfb)]((_0x1f2876,_0x1bfa81)=>{_0x1a6cd4[_0x1bfa81]['expiry_date']=_0x1f2876;}),_0x1a6fcb[_0xf0a2c2(0xfb)]((_0x1cdda8,_0x1202bb)=>{var _0x406f22=_0xf0a2c2;_0x1a6cd4[_0x1202bb][_0x406f22(0x120)]=_0x1cdda8;}),_0x230879[_0xf0a2c2(0xfb)]((_0x2683b0,_0x450960)=>{var _0x72d2c3=_0xf0a2c2;_0x1a6cd4[_0x450960][_0x72d2c3(0x148)]=_0x2683b0;}),_0x532d0f[_0xf0a2c2(0xfb)]((_0x5b7707,_0x12444a)=>{var _0x728f43=_0xf0a2c2;_0x1a6cd4[_0x12444a][_0x728f43(0xa4)]=_0x5b7707;}),_0x1afeb4[_0xf0a2c2(0xfb)]((_0x46635e,_0x4ab93f)=>{var _0x36778c=_0xf0a2c2;_0x1a6cd4[_0x4ab93f][_0x36778c(0xbf)]=_0x46635e;}),_0x5cffe3[_0xf0a2c2(0xfb)]((_0x4e0731,_0x346b3d)=>{_0x1a6cd4[_0x346b3d]['invoice']=_0x4e0731;});const _0x1c0cb6=_0x1a6cd4[_0xf0a2c2(0xd7)](_0x375f83=>_0x375f83[_0xf0a2c2(0x103)]!=='0'&&_0x375f83[_0xf0a2c2(0x103)]!=='');var _0x527e95=0x0;_0x1c0cb6[_0xf0a2c2(0xfb)](_0x5b911e=>{var _0x2b0ccb=_0xf0a2c2;console[_0x2b0ccb(0xc3)](_0x2b0ccb(0x145),_0x5b911e),parseInt(_0x5b911e['adjust_qty'])<=0x0&&_0x527e95++;});if(_0x527e95!=0x0)return _0x2986ef[_0xf0a2c2(0xca)](_0xf0a2c2(0xc8),_0xf0a2c2(0x112)),_0x5c46bf['redirect'](_0xf0a2c2(0xfc));const _0x51aa36=new invoice_for_adjustment();await _0x51aa36[_0xf0a2c2(0xe0)]();const _0x4eba6d=new adjustment_finished({'warehouse_name':_0xda8228,'date':_0x2c010d,'product':_0x1c0cb6,'note':_0x1e86ec,'room':_0x218ed2,'invoice':'ADJ-'+_0x51aa36['invoice_init'][_0xf0a2c2(0xcc)]()['padStart'](0x8,'0'),'JO_number':_0x43ae1d,'expiry_date':_0xa16f96,'PO_number':_0x2dda35,'RequestedBy':_0xbd4de5,'DateofRequest':_0x3adf43,'typeservices':_0x5515d7,'destination':_0x2c7c49,'deliverydate':_0x3cd051,'driver':_0x248449,'plate':_0x3ffd7c,'van':_0x497df9,'DRSI':_0x45eb05,'typevehicle':_0x43a3bf,'TSU':_0x2e73e6,'TFU':_0x4d4bc2}),_0x4d9d6f=await _0x4eba6d[_0xf0a2c2(0xe0)]();_0x2986ef['flash'](_0xf0a2c2(0x149),_0xf0a2c2(0xec)),_0x5c46bf[_0xf0a2c2(0x11b)](_0xf0a2c2(0xf3)+_0x4d9d6f[_0xf0a2c2(0xf9)]);}catch(_0xf23396){console[_0xf0a2c2(0xc3)](_0xf23396),_0x5c46bf['status'](0xc8)[_0xf0a2c2(0xc7)]({'message':_0xf23396[_0xf0a2c2(0x142)]});}}),router['get'](a0_0x1abeb9(0x14c),auth,async(_0x1d2b8c,_0x39ad20)=>{var _0x29e517=a0_0x1abeb9;try{const {username:_0x4c59b5,email:_0x571948,role:_0x5cc0eb}=_0x1d2b8c[_0x29e517(0x109)],_0x258a0b=_0x1d2b8c['user'],_0x464992=await profile[_0x29e517(0xe6)]({'email':_0x258a0b[_0x29e517(0x130)]}),_0x36116d=await master_shop[_0x29e517(0xc1)]();let _0x1bcf07;if(_0x258a0b[_0x29e517(0x14a)]==_0x29e517(0xef)){const _0x406544=await staff[_0x29e517(0xe6)]({'email':_0x258a0b[_0x29e517(0x130)]});_0x1bcf07=await warehouse['aggregate']([{'$match':{'status':_0x29e517(0xd8),'name':_0x406544[_0x29e517(0x144)]}},{'$group':{'_id':_0x29e517(0xde),'name':{'$first':'$name'}}}]);}else _0x1bcf07=await warehouse[_0x29e517(0xe7)]([{'$match':{'status':_0x29e517(0xd8)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x597ad2=await product['find'](),_0x27fa9c=await adjustment_finished[_0x29e517(0xc1)](),_0x4923ce=_0x27fa9c[_0x29e517(0x11e)]+0x1,_0x11e601='ADJF-'+_0x4923ce[_0x29e517(0xcc)]()[_0x29e517(0xd4)](0x5,'0');var _0x1eca30=[_0x29e517(0xb0),'Enclosed',_0x29e517(0x102)];if(_0x36116d[0x0][_0x29e517(0x12e)]==_0x29e517(0xfd))var _0x72b688=users[_0x29e517(0xab)];else{if(_0x36116d[0x0]['language']==_0x29e517(0xa5))var _0x72b688=users[_0x29e517(0xa5)];else{if(_0x36116d[0x0][_0x29e517(0x12e)]=='German')var _0x72b688=users[_0x29e517(0x10f)];else{if(_0x36116d[0x0][_0x29e517(0x12e)]=='Spanish')var _0x72b688=users[_0x29e517(0xe4)];else{if(_0x36116d[0x0][_0x29e517(0x12e)]=='French')var _0x72b688=users[_0x29e517(0xad)];else{if(_0x36116d[0x0]['language']==_0x29e517(0x143))var _0x72b688=users[_0x29e517(0x13c)];else{if(_0x36116d[0x0]['language']==_0x29e517(0x12b))var _0x72b688=users[_0x29e517(0x12b)];else{if(_0x36116d[0x0][_0x29e517(0x12e)]==_0x29e517(0xb5))var _0x72b688=users[_0x29e517(0x12f)];}}}}}}}const _0x41e273=getRandom8DigitNumber();_0x41e273['then'](_0x280252=>{var _0x2a7e4e=_0x29e517;_0x39ad20[_0x2a7e4e(0xd9)]('add_adjustment_finished_logs',{'success':_0x1d2b8c[_0x2a7e4e(0xca)](_0x2a7e4e(0x149)),'errors':_0x1d2b8c[_0x2a7e4e(0xca)]('errors'),'role':_0x258a0b,'profile':_0x464992,'warehouse':_0x1bcf07,'product':_0x597ad2,'master_shop':_0x36116d,'language':_0x72b688,'rooms_data':_0x1eca30,'invoice_no':_0x280252});})[_0x29e517(0x136)](_0x11b86d=>{var _0x3e7194=_0x29e517;_0x1d2b8c[_0x3e7194(0xca)]('errors',_0x3e7194(0xf2)),_0x39ad20[_0x3e7194(0x11b)]('/adjustment/view');});}catch(_0x4369ca){console[_0x29e517(0xc3)](_0x4369ca);}}),router[a0_0x1abeb9(0x101)](a0_0x1abeb9(0x14c),auth,async(_0x404cfa,_0x148f9b)=>{var _0x1e2d0c=a0_0x1abeb9;try{const {warehouse_name:_0x41a698,date:_0x1b452c,prod_name:_0x29d901,level:_0x88a97d,isle:_0x3ac196,pallet:_0x287854,stock:_0xcb632e,types:_0x5d1fac,adjust_qty:_0x51bb7d,new_adjust_qty:_0x385cf2,note:_0x10a017,Room_name:_0x39fd67,JO_number:_0x1e6368,expiry_date:_0xdc4f6c,type_of_transaction:_0x1815b1,PO_number:_0x4ff27e,ReqBy:_0x4c4db6,dateofreq:_0x57ff60,typeservicesData:_0x32e669,destination:_0x279130,deliverydate:_0x1b9004,driver:_0x5e64f4,plate:_0x35dac3,van:_0x51e6c0,DRSI:_0x7f41d2,typevehicle:_0x288142,TSU:_0x26e9e9,TFU:_0x1ac160}=_0x404cfa['body'];if(typeof _0x29d901==_0x1e2d0c(0xb3))var _0x343566=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x127)]],_0x3e24f4=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xc9)]],_0x4bf092=[_0x404cfa['body'][_0x1e2d0c(0x10c)]],_0x4907c0=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x131)]],_0x2300c9=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xbb)]],_0x4d6a1c=[_0x404cfa['body'][_0x1e2d0c(0xcf)]],_0x434737=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x123)]],_0x6561a0=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xd5)]],_0x4996d5=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xc2)]],_0x5c8f4c=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x10a)]],_0x91ddec=[_0x404cfa['body'][_0x1e2d0c(0x10d)]],_0x5b7715=[_0x404cfa['body'][_0x1e2d0c(0xd1)]],_0x4c9aea=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x148)]],_0x36f164=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xf0)]],_0x2edfee=[_0x404cfa['body']['maxPerUnit']],_0x20fd5e=[_0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x139)]],_0xd9737c=[_0x404cfa[_0x1e2d0c(0x13b)]['id_transaction_from']];else var _0x343566=[..._0x404cfa['body'][_0x1e2d0c(0x127)]],_0x3e24f4=[..._0x404cfa['body'][_0x1e2d0c(0xc9)]],_0x4bf092=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x10c)]],_0x4907c0=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x131)]],_0x2300c9=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xbb)]],_0x4d6a1c=[..._0x404cfa['body']['New_Qty_Converted']],_0x434737=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x123)]],_0x6561a0=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xd5)]],_0x4996d5=[..._0x404cfa['body'][_0x1e2d0c(0xc2)]],_0x5c8f4c=[..._0x404cfa['body'][_0x1e2d0c(0x10a)]],_0x91ddec=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x10d)]],_0x5b7715=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xd1)]],_0x4c9aea=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0x148)]],_0x36f164=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xf0)]],_0x2edfee=[..._0x404cfa['body'][_0x1e2d0c(0xbf)]],_0x20fd5e=[..._0x404cfa['body'][_0x1e2d0c(0x139)]],_0xd9737c=[..._0x404cfa[_0x1e2d0c(0x13b)][_0x1e2d0c(0xce)]];const _0x109f56=_0x343566[_0x1e2d0c(0xff)](_0x49cd9e=>{return _0x49cd9e={'product_name':_0x49cd9e};});_0x3e24f4[_0x1e2d0c(0xfb)]((_0x297507,_0x4705b6)=>{var _0x5efa86=_0x1e2d0c,_0x5b08cf=_0x297507['match'](/[A-Za-z]+/)[0x0],_0x3f3c23=parseInt(_0x297507[_0x5efa86(0x13a)](/\d+/)[0x0]);_0x109f56[_0x4705b6][_0x5efa86(0xc9)]=_0x5b08cf,_0x109f56[_0x4705b6]['bay']=_0x3f3c23;}),_0xd9737c[_0x1e2d0c(0xfb)]((_0x150e12,_0x271403)=>{var _0x582810=_0x1e2d0c;_0x109f56[_0x271403][_0x582810(0x122)]=_0x150e12;}),_0x4bf092[_0x1e2d0c(0xfb)]((_0x1a2377,_0xa1c79f)=>{var _0x1964d2=_0x1e2d0c;_0x109f56[_0xa1c79f][_0x1964d2(0xb8)]=_0x1a2377;}),_0x4907c0['forEach']((_0x544cc3,_0x34be77)=>{var _0x3405c3=_0x1e2d0c;_0x109f56[_0x34be77][_0x3405c3(0x131)]=_0x544cc3;}),_0x2300c9[_0x1e2d0c(0xfb)]((_0xabda49,_0x4b89ab)=>{var _0x194ff9=_0x1e2d0c;_0x109f56[_0x4b89ab][_0x194ff9(0x103)]=_0xabda49;}),_0x4d6a1c['forEach']((_0x147f1,_0x127d9f)=>{_0x109f56[_0x127d9f]['new_adjust_qty']=_0x147f1;}),_0x434737['forEach']((_0xa6246a,_0x2a5f0d)=>{var _0x413929=_0x1e2d0c;_0x109f56[_0x2a5f0d][_0x413929(0xba)]=_0xa6246a;}),_0x6561a0[_0x1e2d0c(0xfb)]((_0x2192cb,_0x4c14bb)=>{var _0x559343=_0x1e2d0c;_0x109f56[_0x4c14bb][_0x559343(0x10b)]=_0x2192cb;}),_0x4996d5[_0x1e2d0c(0xfb)]((_0x55cdf0,_0x2ffc37)=>{var _0x1d1adf=_0x1e2d0c;_0x109f56[_0x2ffc37][_0x1d1adf(0xea)]=_0x55cdf0;}),_0x5c8f4c[_0x1e2d0c(0xfb)]((_0x2cf0d9,_0x15c266)=>{var _0x4a59f9=_0x1e2d0c;_0x109f56[_0x15c266][_0x4a59f9(0x10a)]=_0x2cf0d9;}),_0x91ddec[_0x1e2d0c(0xfb)]((_0x458e64,_0x3eee11)=>{var _0x470143=_0x1e2d0c;_0x109f56[_0x3eee11][_0x470143(0x10d)]=_0x458e64;}),_0x5b7715['forEach']((_0x26bdc8,_0x4cc1f8)=>{var _0x32a09d=_0x1e2d0c;_0x109f56[_0x4cc1f8][_0x32a09d(0x120)]=_0x26bdc8;}),_0x4c9aea[_0x1e2d0c(0xfb)]((_0x303b9d,_0x40d196)=>{var _0x4fdb59=_0x1e2d0c;_0x109f56[_0x40d196][_0x4fdb59(0x148)]=_0x303b9d;}),_0x36f164[_0x1e2d0c(0xfb)]((_0x57aad1,_0x4ac150)=>{_0x109f56[_0x4ac150]['room_names']=_0x57aad1;}),_0x2edfee[_0x1e2d0c(0xfb)]((_0x2a9ef9,_0x5ef28b)=>{var _0x158a9d=_0x1e2d0c;_0x109f56[_0x5ef28b][_0x158a9d(0xbf)]=_0x2a9ef9;}),_0x20fd5e[_0x1e2d0c(0xfb)]((_0x34423d,_0x37a18b)=>{var _0x59e562=_0x1e2d0c;_0x109f56[_0x37a18b][_0x59e562(0x147)]=_0x34423d;});const _0xc9cd37=_0x109f56['filter'](_0x2b1c55=>_0x2b1c55[_0x1e2d0c(0x103)]!=='0'&&_0x2b1c55[_0x1e2d0c(0x103)]!=='');var _0x46fb17=0x0;_0xc9cd37[_0x1e2d0c(0xfb)](_0x102b80=>{var _0x4d1946=_0x1e2d0c;console[_0x4d1946(0xc3)](_0x4d1946(0x145),_0x102b80),parseInt(_0x102b80[_0x4d1946(0x103)])<=0x0&&_0x46fb17++;});if(_0x46fb17!=0x0)return _0x404cfa[_0x1e2d0c(0xca)](_0x1e2d0c(0xc8),_0x1e2d0c(0x112)),_0x148f9b[_0x1e2d0c(0x11b)](_0x1e2d0c(0xfc));const _0xd32953=new adjustment_logs();await _0xd32953[_0x1e2d0c(0xe0)]();const _0x5da979=new adjustment_finished({'warehouse_name':_0x41a698,'date':_0x1b452c,'product':_0xc9cd37,'note':_0x10a017,'room':_0x39fd67,'invoice':_0x1e2d0c(0x108)+_0xd32953[_0x1e2d0c(0xb6)][_0x1e2d0c(0xcc)]()[_0x1e2d0c(0xd4)](0x8,'0'),'JO_number':_0x1e6368,'expiry_date':_0xdc4f6c,'type_of_transaction':_0x1815b1,'PO_number':_0x4ff27e,'RequestedBy':_0x4c4db6,'DateofRequest':_0x57ff60,'typeservices':_0x32e669,'destination':_0x279130,'deliverydate':_0x1b9004,'driver':_0x5e64f4,'plate':_0x35dac3,'van':_0x51e6c0,'DRSI':_0x7f41d2,'typevehicle':_0x288142,'TSU':_0x26e9e9,'TFU':_0x1ac160}),_0x10229e=await _0x5da979[_0x1e2d0c(0xe0)]();_0x404cfa['flash'](_0x1e2d0c(0x149),_0x1e2d0c(0xec)),_0x148f9b['redirect'](_0x1e2d0c(0xf3)+_0x10229e[_0x1e2d0c(0xf9)]);}catch(_0x219ed6){console[_0x1e2d0c(0xc3)](_0x219ed6),_0x148f9b['status'](0xc8)[_0x1e2d0c(0xc7)]({'message':_0x219ed6['message']});}}),router['get'](a0_0x1abeb9(0x105),auth,async(_0x14b3f2,_0x3a8141)=>{var _0xcf2e22=a0_0x1abeb9;try{const {username:_0x1cce86,email:_0x51694d,role:_0x1dd14e}=_0x14b3f2[_0xcf2e22(0x109)],_0x4022df=_0x14b3f2['user'],_0x50db4e=await profile[_0xcf2e22(0xe6)]({'email':_0x4022df[_0xcf2e22(0x130)]}),_0x32857f=await master_shop[_0xcf2e22(0xc1)](),_0x379067=_0x14b3f2['params']['id'],_0x212174=await adjustment_finished[_0xcf2e22(0xb4)]({'_id':_0x379067}),_0x539705=await purchases['aggregate']([{'$match':{'warehouse_name':_0x212174[_0xcf2e22(0xa2)]}},{'$unwind':_0xcf2e22(0x134)},{'$group':{'_id':_0xcf2e22(0xe3)}}]);console[_0xcf2e22(0xc3)](_0xcf2e22(0x11d),_0x539705);const _0x4356c0=await product[_0xcf2e22(0xc1)]({}),_0xbd3031=await warehouse[_0xcf2e22(0xe7)]([{'$match':{'name':_0x212174['warehouse_name']}},{'$unwind':_0xcf2e22(0xe2)},{'$group':{'_id':_0xcf2e22(0xaa),'name':{'$first':_0xcf2e22(0x12c)},'product_stock':{'$first':_0xcf2e22(0xee)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xcf2e22(0xbd)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xcf2e22(0x114)},'secondary_code':{'$first':_0xcf2e22(0x107)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xcf2e22(0xe1)},'rack':{'$first':_0xcf2e22(0x151)},'expiry_date':{'$first':_0xcf2e22(0x119)},'production_date':{'$first':_0xcf2e22(0xa3)},'batch_code':{'$first':_0xcf2e22(0xdb)},'maxPerUnit':{'$first':_0xcf2e22(0x132)},'room':{'$first':'$room'}}}]);if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0xfd)){var _0x1c1059=users[_0xcf2e22(0xab)];console['log'](_0x1c1059);}else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0xa5))var _0x1c1059=users[_0xcf2e22(0xa5)];else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0x10f))var _0x1c1059=users[_0xcf2e22(0x10f)];else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0xe4))var _0x1c1059=users[_0xcf2e22(0xe4)];else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0xad))var _0x1c1059=users['French'];else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0x143))var _0x1c1059=users[_0xcf2e22(0x13c)];else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0x12b))var _0x1c1059=users[_0xcf2e22(0x12b)];else{if(_0x32857f[0x0][_0xcf2e22(0x12e)]==_0xcf2e22(0xb5))var _0x1c1059=users[_0xcf2e22(0x12f)];}}}}}}}_0x3a8141[_0xcf2e22(0xd9)](_0xcf2e22(0x11c),{'success':_0x14b3f2[_0xcf2e22(0xca)](_0xcf2e22(0x149)),'errors':_0x14b3f2['flash'](_0xcf2e22(0xc8)),'role':_0x4022df,'profile':_0x50db4e,'adjustment':_0x212174,'stock':_0xbd3031,'master_shop':_0x32857f,'warehouse_name':_0x539705,'unit':_0x4356c0,'language':_0x1c1059});}catch(_0x3b96d5){console[_0xcf2e22(0xc3)](_0x3b96d5),_0x3a8141[_0xcf2e22(0x140)](0xc8)['json']({'message':_0x3b96d5[_0xcf2e22(0x142)]});}}),router[a0_0x1abeb9(0x101)](a0_0x1abeb9(0x105),auth,async(_0x38eab2,_0x486841)=>{var _0xd3bfe3=a0_0x1abeb9;try{const {invoice:_0x5aed61,warehouse_name:_0x40f3e4,Room_name:_0x5db735}=_0x38eab2['body'],_0x33f08e=_0x38eab2[_0xd3bfe3(0x137)]['id'],_0x30b0de=await adjustment_finished[_0xd3bfe3(0xb4)]({'_id':_0x33f08e});var _0x96b1ad;const _0x272721=_0x30b0de['product']['map'](async _0x57fa2e=>{var _0x14898e=_0xd3bfe3;if(_0x57fa2e[_0x14898e(0x103)]>0x0){_0x96b1ad=await warehouse[_0x14898e(0xe6)]({'name':_0x40f3e4,'room':_0x57fa2e[_0x14898e(0xa4)]});const _0x36a1ae=_0x96b1ad[_0x14898e(0xd6)][_0x14898e(0xff)](_0x54cb4a=>{var _0x1d13e1=_0x14898e;console['log'](_0x57fa2e[_0x1d13e1(0x131)]);if(_0x57fa2e[_0x1d13e1(0x131)]=='minus')_0x54cb4a[_0x1d13e1(0xf9)]==_0x57fa2e['id_transaction']&&(_0x54cb4a[_0x1d13e1(0x121)]=_0x54cb4a[_0x1d13e1(0x121)]-_0x57fa2e['adjust_qty']);else _0x57fa2e[_0x1d13e1(0x131)]==_0x1d13e1(0xe5)&&(_0x54cb4a[_0x1d13e1(0xf9)]==_0x57fa2e[_0x1d13e1(0x122)]&&(_0x54cb4a['product_stock']=_0x54cb4a['product_stock']+_0x57fa2e[_0x1d13e1(0x103)]));});}return _0x96b1ad;});Promise[_0xd3bfe3(0xa8)](_0x272721)[_0xd3bfe3(0xd3)](async _0x2cfad6=>{var _0x12c549=_0xd3bfe3;try{for(const _0x2fae03 of _0x2cfad6){await _0x2fae03['save']();}_0x30b0de[_0x12c549(0xda)]=_0x12c549(0xae);const _0x23b5df=await _0x30b0de[_0x12c549(0xe0)](),_0x2c3b08=await master_shop['find'](),_0x4e50c7=await email_settings[_0x12c549(0xe6)](),_0x4a1627=await supervisor_settings[_0x12c549(0xc1)]();var _0x4dfc92=_0x30b0de[_0x12c549(0xcb)],_0x28e50c='',_0x287805;for(_0x287805 in _0x4dfc92){var _0x341611='FG';_0x30b0de[_0x12c549(0xa2)]==_0x12c549(0xed)&&(_0x341611='DG'),_0x28e50c+=_0x12c549(0xf7)+_0x12c549(0x118)+_0x4dfc92[_0x287805][_0x12c549(0xf1)]+'</td>'+_0x12c549(0x118)+_0x4dfc92[_0x287805]['product_code']+'</td>'+_0x12c549(0x118)+_0x4dfc92[_0x287805]['adjust_qty']+_0x12c549(0xac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4dfc92[_0x287805][_0x12c549(0xba)]+_0x12c549(0xac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4dfc92[_0x287805][_0x12c549(0x10b)]+_0x12c549(0xac)+_0x12c549(0x118)+_0x30b0de[_0x12c549(0xa2)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4dfc92[_0x287805][_0x12c549(0xa4)]+'</td>'+_0x12c549(0x118)+_0x341611+_0x4dfc92[_0x287805][_0x12c549(0xd0)]+_0x12c549(0xac)+_0x12c549(0xdc);}_0x38eab2[_0x12c549(0xca)](_0x12c549(0x149),_0x12c549(0x117)),_0x486841[_0x12c549(0x11b)]('/picking_list/PDF_adjustmentFinal/'+_0x23b5df[_0x12c549(0xf9)]);}catch(_0x38c088){console[_0x12c549(0x124)](_0x38c088),_0x486841[_0x12c549(0x140)](0x1f4)[_0x12c549(0xc7)]({'error':_0x12c549(0x14e)});}})[_0xd3bfe3(0x136)](_0x989ed3=>{var _0x4426f1=_0xd3bfe3;console[_0x4426f1(0x124)](_0x989ed3),_0x486841[_0x4426f1(0x140)](0x1f4)['json']({'error':_0x4426f1(0xe8)});});}catch(_0x139240){_0x486841[_0xd3bfe3(0xc7)]({'message':_0x139240['message']});}}),router[a0_0x1abeb9(0x113)](a0_0x1abeb9(0xbe),auth,async(_0x15833f,_0x40b654)=>{var _0x389670=a0_0x1abeb9;try{const {username:_0x57b45c,email:_0x398709,role:_0x336f0f}=_0x15833f['user'],_0x52aa10=_0x15833f['user'],_0x10f5c3=await profile['findOne']({'email':_0x52aa10['email']}),_0x262652=await master_shop['find']();console[_0x389670(0xc3)](_0x389670(0x116),_0x262652);const _0x12c965=_0x15833f['params']['id'],_0x5075f7=await adjustment_finished[_0x389670(0xb4)]({'_id':_0x12c965});let _0x420515=new Date(_0x5075f7[_0x389670(0x10d)]),_0x343a95=('0'+_0x420515['getDate']())[_0x389670(0xa9)](-0x2),_0x232262=('0'+(_0x420515[_0x389670(0xdf)]()+0x1))['slice'](-0x2),_0x4cf8cd=_0x420515['getFullYear'](),_0x29f235=_0x4cf8cd+'-'+_0x232262+'-'+_0x343a95;var _0x328e17=[_0x389670(0xb0),_0x389670(0x126),_0x389670(0x102)];const _0x231aa8=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5075f7['warehouse_name']}},{'$unwind':_0x389670(0x134)},{'$group':{'_id':'$product.product_name'}}]);console[_0x389670(0xc3)]('purchases_data',_0x231aa8);const _0x1d4119=await product[_0x389670(0xc1)]({}),_0x2fcd4f=await warehouse[_0x389670(0xe7)]([{'$match':{'name':_0x5075f7[_0x389670(0xa2)],'room':_0x5075f7[_0x389670(0xe9)]}},{'$unwind':_0x389670(0xe2)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x389670(0xee)},'bay':{'$first':_0x389670(0xf8)},'bin':{'$first':_0x389670(0xbd)},'type':{'$first':_0x389670(0x133)},'floorlevel':{'$first':_0x389670(0x13f)},'primary_code':{'$first':_0x389670(0x114)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x389670(0x151)}}}]);if(_0x262652[0x0]['language']==_0x389670(0xfd)){var _0x21b44b=users[_0x389670(0xab)];console[_0x389670(0xc3)](_0x21b44b);}else{if(_0x262652[0x0][_0x389670(0x12e)]==_0x389670(0xa5))var _0x21b44b=users[_0x389670(0xa5)];else{if(_0x262652[0x0][_0x389670(0x12e)]==_0x389670(0x10f))var _0x21b44b=users[_0x389670(0x10f)];else{if(_0x262652[0x0][_0x389670(0x12e)]=='Spanish')var _0x21b44b=users[_0x389670(0xe4)];else{if(_0x262652[0x0][_0x389670(0x12e)]==_0x389670(0xad))var _0x21b44b=users['French'];else{if(_0x262652[0x0][_0x389670(0x12e)]=='Portuguese\x20(BR)')var _0x21b44b=users[_0x389670(0x13c)];else{if(_0x262652[0x0][_0x389670(0x12e)]==_0x389670(0x12b))var _0x21b44b=users[_0x389670(0x12b)];else{if(_0x262652[0x0][_0x389670(0x12e)]==_0x389670(0xb5))var _0x21b44b=users[_0x389670(0x12f)];}}}}}}}_0x40b654[_0x389670(0xd9)]('edit_adjustment_finished',{'success':_0x15833f['flash'](_0x389670(0x149)),'errors':_0x15833f[_0x389670(0xca)](_0x389670(0xc8)),'role':_0x52aa10,'profile':_0x10f5c3,'adjustment':_0x5075f7,'stock':_0x2fcd4f,'master_shop':_0x262652,'warehouse_name':_0x231aa8,'unit':_0x1d4119,'language':_0x21b44b,'rooms_data':_0x328e17,'ed_fullDate':_0x29f235});}catch(_0xe1e643){console['log'](_0xe1e643),_0x40b654[_0x389670(0x140)](0xc8)[_0x389670(0xc7)]({'message':_0xe1e643[_0x389670(0x142)]});}}),router['post']('/view/:id',auth,async(_0x2ac9a3,_0x343485)=>{var _0x771f49=a0_0x1abeb9;try{const _0x2a6911=_0x2ac9a3[_0x771f49(0x137)]['id'],_0x171379=await adjustment_finished[_0x771f49(0xb4)]({'_id':_0x2a6911}),_0x4253f6=await warehouse['findOne']({'name':_0x171379['warehouse_name'],'room':_0x171379[_0x771f49(0xe9)]}),{warehouse_name:_0x346ec8,date:_0x404e97,prod_name:_0x48eeb,level:_0x455ad6,isle:_0x2af4de,pallet:_0x512be6,stock:_0x291d4d,types:_0x141603,adjust_qty:_0xdb360c,new_adjust_qty:_0x2e7f35,note:_0x57d518,Room_name:_0x3a338f,invoice:_0x46313b,JO_number:_0x39140e}=_0x2ac9a3[_0x771f49(0x13b)];if(typeof _0x48eeb==_0x771f49(0xb3))var _0x1eff7e=[_0x2ac9a3[_0x771f49(0x13b)]['prod_name']],_0x4a1f0d=[_0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0xc9)]],_0x371dc9=[_0x2ac9a3['body'][_0x771f49(0x10c)]],_0x1d9bda=[_0x2ac9a3['body'][_0x771f49(0x131)]],_0x418953=[_0x2ac9a3['body'][_0x771f49(0x103)]],_0x56dd6b=[_0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0xa7)]],_0x560843=[_0x2ac9a3[_0x771f49(0x13b)]['prod_code']],_0x36e9f4=[_0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0xba)]],_0x166675=[_0x2ac9a3[_0x771f49(0x13b)]['Secondary_units']],_0x3a7e93=[_0x2ac9a3[_0x771f49(0x13b)]['batch_code']],_0x13fd11=[_0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0x10d)]];else var _0x1eff7e=[..._0x2ac9a3[_0x771f49(0x13b)]['prod_name']],_0x4a1f0d=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0xc9)]],_0x371dc9=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0x10c)]],_0x1d9bda=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0x131)]],_0x418953=[..._0x2ac9a3['body'][_0x771f49(0x103)]],_0x56dd6b=[..._0x2ac9a3[_0x771f49(0x13b)]['new_adjust_qty']],_0x560843=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0xc2)]],_0x36e9f4=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0xba)]],_0x166675=[..._0x2ac9a3[_0x771f49(0x13b)]['Secondary_units']],_0x3a7e93=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0x10a)]],_0x13fd11=[..._0x2ac9a3[_0x771f49(0x13b)][_0x771f49(0x10d)]];const _0x3f8872=_0x1eff7e[_0x771f49(0xff)](_0xc225ca=>{return _0xc225ca={'product_name':_0xc225ca};});_0x4a1f0d[_0x771f49(0xfb)]((_0x17f94a,_0x25a7d5)=>{var _0x4ef074=_0x771f49;_0x3f8872[_0x25a7d5][_0x4ef074(0xd0)]=_0x17f94a;}),_0x371dc9[_0x771f49(0xfb)]((_0x24051b,_0x1c9c70)=>{_0x3f8872[_0x1c9c70]['stockBefore']=_0x24051b;}),_0x1d9bda[_0x771f49(0xfb)]((_0x32a708,_0x29d888)=>{_0x3f8872[_0x29d888]['types']=_0x32a708;}),_0x418953[_0x771f49(0xfb)]((_0x4e9afe,_0x599772)=>{_0x3f8872[_0x599772]['adjust_qty']=_0x4e9afe;}),_0x56dd6b['forEach']((_0x1000cd,_0x16bdf2)=>{var _0x186d07=_0x771f49;_0x3f8872[_0x16bdf2][_0x186d07(0xa7)]=_0x1000cd;}),_0x36e9f4['forEach']((_0x40754c,_0x357f17)=>{var _0x4d13b4=_0x771f49;_0x3f8872[_0x357f17][_0x4d13b4(0xba)]=_0x40754c;}),_0x166675['forEach']((_0x481efe,_0x419d60)=>{var _0x5331f2=_0x771f49;_0x3f8872[_0x419d60][_0x5331f2(0x10b)]=_0x481efe;}),_0x560843[_0x771f49(0xfb)]((_0x53d2f8,_0x4c1e7d)=>{var _0x4ee946=_0x771f49;_0x3f8872[_0x4c1e7d][_0x4ee946(0xea)]=_0x53d2f8;}),_0x3a7e93['forEach']((_0x37de5d,_0x5eaa82)=>{var _0x17d26a=_0x771f49;_0x3f8872[_0x5eaa82][_0x17d26a(0x10a)]=_0x37de5d;}),_0x13fd11[_0x771f49(0xfb)]((_0x2f5386,_0x46b44f)=>{_0x3f8872[_0x46b44f]['expiry_date']=_0x2f5386;});const _0x1bae2a=_0x3f8872[_0x771f49(0xd7)](_0x1e9eda=>_0x1e9eda['adjust_qty']!=='0'&&_0x1e9eda[_0x771f49(0x103)]!=='');var _0x30bffb=0x0;_0x1bae2a[_0x771f49(0xfb)](_0x25a218=>{var _0x8ab27b=_0x771f49;console[_0x8ab27b(0xc3)](_0x8ab27b(0x145),_0x25a218),parseInt(_0x25a218[_0x8ab27b(0x103)])<=0x0&&_0x30bffb++;});if(_0x30bffb!=0x0)return _0x2ac9a3['flash'](_0x771f49(0xc8),_0x771f49(0x112)),_0x343485[_0x771f49(0x11b)]('back');_0x171379['warehouse_name']=_0x346ec8,_0x171379[_0x771f49(0x150)]=_0x404e97,_0x171379[_0x771f49(0xcb)]=_0x1bae2a,_0x171379[_0x771f49(0xb9)]=_0x57d518,_0x171379['room']=_0x3a338f,_0x171379['invoice']=_0x46313b,_0x171379[_0x771f49(0x146)]=_0x39140e;const _0x46b37e=await _0x171379[_0x771f49(0xe0)](),_0xed8b09=await warehouse[_0x771f49(0xe6)]({'name':_0x346ec8,'room':_0x3a338f});_0x46b37e[_0x771f49(0xcb)][_0x771f49(0xfb)](_0x4284cd=>{var _0xb7ffbf=_0x771f49;const _0x28d1b2=_0xed8b09[_0xb7ffbf(0xd6)]['map'](_0x132573=>{var _0x2cef7e=_0xb7ffbf;_0x4284cd[_0x2cef7e(0x131)]==_0x2cef7e(0xa6)?_0x132573[_0x2cef7e(0xf1)]==_0x4284cd['product_name']&&_0x132573[_0x2cef7e(0xd0)]==_0x4284cd[_0x2cef7e(0xd0)]&&(_0x132573[_0x2cef7e(0x121)]=parseInt(_0x132573['product_stock'])-parseInt(_0x4284cd[_0x2cef7e(0x103)])):_0x132573['product_name']==_0x4284cd[_0x2cef7e(0xf1)]&&_0x132573['bay']==_0x4284cd[_0x2cef7e(0xd0)]&&(_0x132573[_0x2cef7e(0x121)]=parseInt(_0x132573['product_stock'])+parseInt(_0x4284cd[_0x2cef7e(0x103)]));});}),await _0xed8b09[_0x771f49(0xe0)](),_0x2ac9a3[_0x771f49(0xca)]('success',_0x771f49(0xb7)),_0x343485['redirect']('/adjustment_finished/view');}catch(_0x5cfabb){console['log'](_0x5cfabb);}}),router[a0_0x1abeb9(0x101)](a0_0x1abeb9(0xeb),async(_0x489f81,_0x546cbe)=>{var _0x433b02=a0_0x1abeb9;const {primary_code:_0x35505d,warehouse_data:_0x4483bf,rooms_data:_0x952e80,Roomslist:_0x17f3d0}=_0x489f81[_0x433b02(0x13b)],_0x858ff4=_0x17f3d0[_0x433b02(0x14f)](','),_0x2b5c01=[];async function _0x2848c7(_0x274dc6){var _0x2950fd=_0x433b02;const _0x3bf4a6=await warehouse['aggregate']([{'$match':{'name':_0x4483bf,'room':_0x274dc6}},{'$unwind':_0x2950fd(0xe2)},{'$match':{'product_details.primary_code':_0x35505d}},{'$group':{'_id':_0x2950fd(0xaa),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2950fd(0xee)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2950fd(0x107)},'product_code':{'$first':_0x2950fd(0xfe)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x2950fd(0xf8)},'type':{'$first':_0x2950fd(0x133)},'pallet':{'$first':_0x2950fd(0x13f)},'unit':{'$first':_0x2950fd(0x111)},'secondary_unit':{'$first':_0x2950fd(0x100)},'storage':{'$first':_0x2950fd(0xe1)},'rack':{'$first':_0x2950fd(0x151)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2950fd(0xa3)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2950fd(0x132)},'roomNamed':{'$first':_0x2950fd(0xb1)},'invoice':{'$first':_0x2950fd(0xd2)}}}]),_0x5fb792=await warehouse[_0x2950fd(0xe7)]([{'$match':{'name':_0x4483bf,'room':_0x274dc6}},{'$unwind':_0x2950fd(0xe2)},{'$match':{'product_details.secondary_code':_0x35505d}},{'$group':{'_id':_0x2950fd(0xaa),'name':{'$first':_0x2950fd(0x12c)},'product_stock':{'$first':_0x2950fd(0xee)},'primary_code':{'$first':_0x2950fd(0x114)},'secondary_code':{'$first':_0x2950fd(0x107)},'product_code':{'$first':_0x2950fd(0xfe)},'level':{'$first':_0x2950fd(0xbc)},'bay':{'$first':_0x2950fd(0xf8)},'type':{'$first':_0x2950fd(0x133)},'pallet':{'$first':_0x2950fd(0x13f)},'unit':{'$first':_0x2950fd(0x111)},'secondary_unit':{'$first':_0x2950fd(0x100)},'storage':{'$first':_0x2950fd(0xe1)},'rack':{'$first':_0x2950fd(0x151)},'expiry_date':{'$first':_0x2950fd(0x119)},'production_date':{'$first':_0x2950fd(0xa3)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x2950fd(0x132)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2950fd(0xd2)}}}]);if(_0x3bf4a6['length']>0x0)_0x2b5c01[_0x2950fd(0x138)](_0x3bf4a6);else _0x5fb792[_0x2950fd(0x11e)]>0x0&&_0x2b5c01[_0x2950fd(0x138)](_0x5fb792);}const _0x1c0cfd=_0x858ff4[_0x433b02(0xff)](_0x1e689b=>_0x2848c7(_0x1e689b));await Promise[_0x433b02(0xa8)](_0x1c0cfd),_0x546cbe['json'](_0x2b5c01);}),router['post'](a0_0x1abeb9(0x129),async(_0x4b2872,_0x296a10)=>{var _0x5270c0=a0_0x1abeb9;const {productCode:_0x3eaea3,bay:_0x2562cc,warehouses:_0x3048e5,room:_0x5dbd6f}=_0x4b2872[_0x5270c0(0x13b)];console[_0x5270c0(0xc3)](_0x4b2872[_0x5270c0(0x13b)]);try{const _0x330c66=await warehouse[_0x5270c0(0xe7)]([{'$match':{'name':_0x3048e5,'room':_0x5dbd6f}},{'$unwind':_0x5270c0(0xe2)},{'$match':{'product_details.bay':parseInt(_0x2562cc)}},{'$group':{'_id':_0x5270c0(0xaa),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5270c0(0xee)},'bay':{'$first':_0x5270c0(0xf8)},'maxProducts':{'$first':_0x5270c0(0x141)}}}]);_0x296a10[_0x5270c0(0x140)](0xc8)['json'](_0x330c66);}catch(_0x4b4cdf){_0x296a10[_0x5270c0(0x140)](0x194)[_0x5270c0(0xc7)]({'message':_0x4b4cdf['message']});}}),module['exports']=router;