function a0_0x5c12(){var _0x26965b=['English','180171BhCpUr','$product_details.bay','types','Ambient','note','edit_adjustment_finished_view','email','findById','$warehouse_name','maxPerUnit','floor','$product_details.expiry_date','174006bHsFJT','181272xIZIeJ','room_names','</td>','/adjustment_finished/view','Primary_Units','$product_details.storage','product_code','purchases_data','175RmGfbc','Portuguese\x20(BR)','$_id','$name','then','$product','log','production_date','$product_details.product_name','product_date','/picking_list/PDF_adjustmentFinal/','$product.product_name','params','staff','$product_details.primary_code','Secondary_units','toString','101944BRyZYj','finalize','add_adjustment_finished_logs','Return\x20Rooms','There\x27s\x20a\x20error\x20in\x20this\x20transaction','adjustment\x20data\x20update\x20successfully','find','$product_details.secondary_code','New_Qty_Converted','master','German','$product.room_names','errors','/adjustment_finished/preview/','Enabled','Router','$finalize','$product_details.bin','nodemailer','$product_details.product_stock','stockBefore','string','id_transaction_from','41760xvQNhg','message','minus','/view/:id','warehouse','logs','role','status','Rooms','/preview/:id','$product_details.level','ADJ-','Arabic','success','French','An\x20error\x20occurred\x20while\x20saving\x20data.','11598yatCvT','save','flash','$product_details.unit','$room','secondary_unit','exports','product_name','$product_details.batch_code','product_stock','</tr>','id_transaction','room','render','post','JO_number','Hindi','Portuguese','expiry_date','prod_name','$product_details.maxPerUnit','Enclosed','English\x20(US)','$product_details.floorlevel','665mXETiK','body','adjust_qty','add','/view_logs','adjustment\x20add\x20successfull','adjustment_finished_logs','New_Qty_Converted_adj','/barcode_scanner','back','$product_details._id','/adjustment/view','add_adjustment_finished','level','filter','length','edit_adjustment_finished','findOne','prod_cat','<tr>','user','prod_invoice','_id','product','product_details','get','stock','express','language','ADJF-','/view/add_adjustment','$product_details.product_code','invoice_init','$product_details.invoice','$product_details.maxProducts','$product_details.type','adjustment_finished','790WeJdoW','Spanish','all','catch','getDate','Chinese','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','aggregate','Arabic\x20(ae)','foreach\x20newproduct','date','forEach','An\x20error\x20occurred.','push','json','new_adjust_qty','warehouse_name','error','/CheckingWarehouse','getMonth','batch_code','$product_details.rack','$product_details.production_date','434044nSakyI','bay','prod_code','redirect','DRY\x20GOODS','map','padStart','$date','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','invoice','match','getFullYear','$invoice','$product_details','unit'];a0_0x5c12=function(){return _0x26965b;};return a0_0x5c12();}var a0_0x19f13e=a0_0x39ee;(function(_0x4edaad,_0xdc681d){var _0x8d9492=a0_0x39ee,_0x308886=_0x4edaad();while(!![]){try{var _0x1d35b1=-parseInt(_0x8d9492(0x16d))/0x1+parseInt(_0x8d9492(0x179))/0x2+-parseInt(_0x8d9492(0x17a))/0x3+-parseInt(_0x8d9492(0x15d))/0x4+-parseInt(_0x8d9492(0x121))/0x5*(parseInt(_0x8d9492(0x1ba))/0x6)+-parseInt(_0x8d9492(0x182))/0x7*(-parseInt(_0x8d9492(0x193))/0x8)+parseInt(_0x8d9492(0x1aa))/0x9*(parseInt(_0x8d9492(0x146))/0xa);if(_0x1d35b1===_0xdc681d)break;else _0x308886['push'](_0x308886['shift']());}catch(_0xad4309){_0x308886['push'](_0x308886['shift']());}}}(a0_0x5c12,0x28837));const express=require(a0_0x19f13e(0x13c)),app=express(),router=express[a0_0x19f13e(0x1a2)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x19f13e(0x1a5));router[a0_0x19f13e(0x13a)]('/view',auth,async(_0x3f96ee,_0x163c05)=>{var _0x137954=a0_0x19f13e;try{const {username:_0x381f38,email:_0x23ece0,role:_0x2875e0}=_0x3f96ee['user'],_0x19c5d7=_0x3f96ee[_0x137954(0x135)],_0x27668f=await profile[_0x137954(0x132)]({'email':_0x19c5d7[_0x137954(0x173)]}),_0x76fc42=await master_shop[_0x137954(0x199)]();let _0x466a8e;if(_0x19c5d7[_0x137954(0x1b0)]==_0x137954(0x18f)){const _0x3e7d77=await staff[_0x137954(0x132)]({'email':_0x19c5d7[_0x137954(0x173)]});_0x466a8e=await warehouse[_0x137954(0x199)]({'status':_0x137954(0x1a1),'name':_0x3e7d77['warehouse']});}else _0x466a8e=await warehouse[_0x137954(0x199)]({'status':_0x137954(0x1a1)});const _0x4064fe=await product[_0x137954(0x199)]();let _0x62563;if(_0x19c5d7[_0x137954(0x1b0)]==_0x137954(0x18f)){const _0x17b7d5=await staff['findOne']({'email':_0x19c5d7[_0x137954(0x173)]});_0x62563=await adjustment_finished['find']({'warehouse_name':_0x17b7d5['warehouse']});}else _0x62563=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0x137954(0x187)},{'$group':{'_id':_0x137954(0x184),'invoice':{'$first':_0x137954(0x169)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x137954(0x175)},'room':{'$addToSet':_0x137954(0x19e)},'finalize':{'$first':_0x137954(0x1a3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x76fc42[0x0][_0x137954(0x13d)]==_0x137954(0x11f)){var _0x3ff318=users[_0x137954(0x16c)];console[_0x137954(0x188)](_0x3ff318);}else{if(_0x76fc42[0x0][_0x137954(0x13d)]==_0x137954(0x1ca))var _0x3ff318=users[_0x137954(0x1ca)];else{if(_0x76fc42[0x0][_0x137954(0x13d)]==_0x137954(0x19d))var _0x3ff318=users[_0x137954(0x19d)];else{if(_0x76fc42[0x0][_0x137954(0x13d)]==_0x137954(0x147))var _0x3ff318=users['Spanish'];else{if(_0x76fc42[0x0][_0x137954(0x13d)]=='French')var _0x3ff318=users[_0x137954(0x1b8)];else{if(_0x76fc42[0x0][_0x137954(0x13d)]=='Portuguese\x20(BR)')var _0x3ff318=users['Portuguese'];else{if(_0x76fc42[0x0][_0x137954(0x13d)]==_0x137954(0x14b))var _0x3ff318=users[_0x137954(0x14b)];else{if(_0x76fc42[0x0][_0x137954(0x13d)]=='Arabic\x20(ae)')var _0x3ff318=users[_0x137954(0x1b6)];}}}}}}}_0x163c05['render'](_0x137954(0x145),{'success':_0x3f96ee[_0x137954(0x1bc)](_0x137954(0x1b7)),'errors':_0x3f96ee[_0x137954(0x1bc)](_0x137954(0x19f)),'role':_0x19c5d7,'profile':_0x27668f,'warehouse':_0x466a8e,'product':_0x4064fe,'adjustment':_0x62563,'master_shop':_0x76fc42,'language':_0x3ff318});}catch(_0x5e99bf){console[_0x137954(0x188)](_0x5e99bf);}}),router[a0_0x19f13e(0x13a)](a0_0x19f13e(0x125),auth,async(_0x1bd9c3,_0x48de17)=>{var _0x5e4158=a0_0x19f13e;try{const {username:_0x3a9d7f,email:_0x5c3167,role:_0x342467}=_0x1bd9c3[_0x5e4158(0x135)],_0x54c2a4=_0x1bd9c3['user'],_0x37bd28=await profile[_0x5e4158(0x132)]({'email':_0x54c2a4[_0x5e4158(0x173)]}),_0x4f5163=await master_shop['find']();let _0x2ba562;if(_0x54c2a4['role']=='staff'){const _0x2542db=await staff[_0x5e4158(0x132)]({'email':_0x54c2a4['email']});_0x2ba562=await warehouse[_0x5e4158(0x199)]({'status':_0x5e4158(0x1a1),'name':_0x2542db[_0x5e4158(0x1ae)]});}else _0x2ba562=await warehouse[_0x5e4158(0x199)]({'status':'Enabled'});const _0x58a52b=await product[_0x5e4158(0x199)]();let _0x372b7c;if(_0x54c2a4[_0x5e4158(0x1b0)]=='staff'){const _0x4232dd=await staff['findOne']({'email':_0x54c2a4['email']});_0x372b7c=await adjustment_finished[_0x5e4158(0x199)]({'warehouse_name':_0x4232dd[_0x5e4158(0x1ae)]});}else _0x372b7c=await adjustment_finished[_0x5e4158(0x14d)]([{'$match':{'type_of_transaction':_0x5e4158(0x1af)}},{'$unwind':_0x5e4158(0x187)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x5e4158(0x164)},'warehouse_name':{'$first':_0x5e4158(0x175)},'room':{'$addToSet':_0x5e4158(0x19e)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4f5163[0x0][_0x5e4158(0x13d)]=='English\x20(US)')var _0xc1d42b=users['English'];else{if(_0x4f5163[0x0][_0x5e4158(0x13d)]==_0x5e4158(0x1ca))var _0xc1d42b=users[_0x5e4158(0x1ca)];else{if(_0x4f5163[0x0][_0x5e4158(0x13d)]==_0x5e4158(0x19d))var _0xc1d42b=users[_0x5e4158(0x19d)];else{if(_0x4f5163[0x0][_0x5e4158(0x13d)]==_0x5e4158(0x147))var _0xc1d42b=users[_0x5e4158(0x147)];else{if(_0x4f5163[0x0][_0x5e4158(0x13d)]==_0x5e4158(0x1b8))var _0xc1d42b=users[_0x5e4158(0x1b8)];else{if(_0x4f5163[0x0]['language']==_0x5e4158(0x183))var _0xc1d42b=users['Portuguese'];else{if(_0x4f5163[0x0][_0x5e4158(0x13d)]==_0x5e4158(0x14b))var _0xc1d42b=users['Chinese'];else{if(_0x4f5163[0x0]['language']=='Arabic\x20(ae)')var _0xc1d42b=users['Arabic'];}}}}}}}_0x48de17[_0x5e4158(0x1c7)](_0x5e4158(0x127),{'success':_0x1bd9c3[_0x5e4158(0x1bc)](_0x5e4158(0x1b7)),'errors':_0x1bd9c3['flash']('errors'),'role':_0x54c2a4,'profile':_0x37bd28,'warehouse':_0x2ba562,'product':_0x58a52b,'adjustment':_0x372b7c,'master_shop':_0x4f5163,'language':_0xc1d42b});}catch(_0x497e98){console[_0x5e4158(0x188)](_0x497e98);}});function a0_0x39ee(_0xa649d7,_0x5600df){var _0x5c125d=a0_0x5c12();return a0_0x39ee=function(_0x39ee2f,_0x23ffa7){_0x39ee2f=_0x39ee2f-0x11d;var _0x2c0992=_0x5c125d[_0x39ee2f];return _0x2c0992;},a0_0x39ee(_0xa649d7,_0x5600df);}async function getRandom8DigitNumber(){var _0x2d8604=a0_0x19f13e;const _0x1304a9=0x989680,_0x2e8a9b=0x5f5e0ff,_0x365bb7=Math[_0x2d8604(0x177)](Math['random']()*(_0x2e8a9b-_0x1304a9+0x1))+_0x1304a9;var _0x2969f5;const _0x43059e=await adjustment_finished['findOne']({'invoice':_0x2d8604(0x13e)+_0x365bb7});return _0x43059e&&_0x43059e[_0x2d8604(0x130)]>0x0?_0x2969f5=_0x2d8604(0x13e)+_0x365bb7:_0x2969f5=_0x2d8604(0x13e)+_0x365bb7,_0x2969f5;}router['get']('/view/add_adjustment',auth,async(_0x3dae56,_0x309423)=>{var _0x1fdf75=a0_0x19f13e;try{const {username:_0xfa44a9,email:_0xcd9588,role:_0x467e5a}=_0x3dae56['user'],_0x1ddc8e=_0x3dae56[_0x1fdf75(0x135)],_0x1c06e2=await profile[_0x1fdf75(0x132)]({'email':_0x1ddc8e[_0x1fdf75(0x173)]}),_0x50d9b7=await master_shop[_0x1fdf75(0x199)]();let _0x3adbb8;if(_0x1ddc8e[_0x1fdf75(0x1b0)]==_0x1fdf75(0x18f)){const _0x39e039=await staff[_0x1fdf75(0x132)]({'email':_0x1ddc8e[_0x1fdf75(0x173)]});_0x3adbb8=await warehouse['aggregate']([{'$match':{'status':_0x1fdf75(0x1a1),'name':_0x39e039['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x1fdf75(0x185)}}}]);}else _0x3adbb8=await warehouse['aggregate']([{'$match':{'status':_0x1fdf75(0x1a1)}},{'$group':{'_id':_0x1fdf75(0x185),'name':{'$first':_0x1fdf75(0x185)}}}]);const _0x59f302=await product[_0x1fdf75(0x199)]({}),_0x4fdc13=await adjustment_finished[_0x1fdf75(0x199)](),_0x4cc8d5=_0x4fdc13[_0x1fdf75(0x130)]+0x1,_0x1322f1=_0x1fdf75(0x13e)+_0x4cc8d5[_0x1fdf75(0x192)]()['padStart'](0x5,'0');var _0x1b7fef=[_0x1fdf75(0x170),_0x1fdf75(0x11e),'Return\x20Rooms'];if(_0x50d9b7[0x0]['language']=='English\x20(US)')var _0x11a650=users[_0x1fdf75(0x16c)];else{if(_0x50d9b7[0x0][_0x1fdf75(0x13d)]==_0x1fdf75(0x1ca))var _0x11a650=users[_0x1fdf75(0x1ca)];else{if(_0x50d9b7[0x0][_0x1fdf75(0x13d)]==_0x1fdf75(0x19d))var _0x11a650=users['German'];else{if(_0x50d9b7[0x0][_0x1fdf75(0x13d)]==_0x1fdf75(0x147))var _0x11a650=users[_0x1fdf75(0x147)];else{if(_0x50d9b7[0x0]['language']==_0x1fdf75(0x1b8))var _0x11a650=users[_0x1fdf75(0x1b8)];else{if(_0x50d9b7[0x0][_0x1fdf75(0x13d)]==_0x1fdf75(0x183))var _0x11a650=users[_0x1fdf75(0x1cb)];else{if(_0x50d9b7[0x0][_0x1fdf75(0x13d)]==_0x1fdf75(0x14b))var _0x11a650=users[_0x1fdf75(0x14b)];else{if(_0x50d9b7[0x0]['language']=='Arabic\x20(ae)')var _0x11a650=users[_0x1fdf75(0x1b6)];}}}}}}}const _0x8e9311=getRandom8DigitNumber();_0x8e9311[_0x1fdf75(0x186)](_0x54e574=>{var _0x57fd18=_0x1fdf75;_0x309423[_0x57fd18(0x1c7)](_0x57fd18(0x12d),{'success':_0x3dae56[_0x57fd18(0x1bc)](_0x57fd18(0x1b7)),'errors':_0x3dae56[_0x57fd18(0x1bc)](_0x57fd18(0x19f)),'role':_0x1ddc8e,'profile':_0x1c06e2,'warehouse':_0x3adbb8,'product':_0x59f302,'master_shop':_0x50d9b7,'language':_0x11a650,'rooms_data':_0x1b7fef,'invoice_no':_0x54e574});})[_0x1fdf75(0x149)](_0xd5627c=>{var _0x5d9ee7=_0x1fdf75;_0x3dae56[_0x5d9ee7(0x1bc)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x309423['redirect'](_0x5d9ee7(0x12c));});}catch(_0x10086a){console['log'](_0x10086a);}}),router[a0_0x19f13e(0x1c8)](a0_0x19f13e(0x13f),auth,async(_0x588f7e,_0x58d15e)=>{var _0x3b315f=a0_0x19f13e;try{const {warehouse_name:_0x17bd11,date:_0x5a55b5,prod_name:_0x3e43ae,level:_0xa642af,isle:_0x157392,pallet:_0xec32c,stock:_0x5a8138,types:_0x22c170,adjust_qty:_0x25f7fa,new_adjust_qty:_0x48a9ce,note:_0x25456d,Room_name:_0x50fded,JO_number:_0x1ba6fa,expiry_date:_0x350178,PO_number:_0x2946e7,ReqBy:_0x87ac02,dateofreq:_0x3fa4c3,typeservicesData:_0x33adc1,destination:_0x5c1d3c,deliverydate:_0x7447e5,driver:_0x5b9038,plate:_0x119cb9,van:_0x37c5d8,DRSI:_0x42da00,typevehicle:_0x36d75d,TSU:_0x236fa7,TFU:_0x28c66d}=_0x588f7e['body'];if(typeof _0x3e43ae==_0x3b315f(0x1a8))var _0x26401c=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x1cd)]],_0x2eea04=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x12e)]],_0x44a16e=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x13b)]],_0x58e272=[_0x588f7e['body'][_0x3b315f(0x16f)]],_0x8dc7c6=[_0x588f7e['body'][_0x3b315f(0x128)]],_0x25c7fc=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x19b)]],_0x1b04c6=[_0x588f7e[_0x3b315f(0x122)]['Primary_Units']],_0x24e3bf=[_0x588f7e[_0x3b315f(0x122)]['Secondary_units']],_0x176a69=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x15f)]],_0x52c220=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x15a)]],_0x211ca9=[_0x588f7e[_0x3b315f(0x122)]['expiry_date']],_0x4b7102=[_0x588f7e['body'][_0x3b315f(0x18b)]],_0x559d0a=[_0x588f7e[_0x3b315f(0x122)]['prod_cat']],_0x355c07=[_0x588f7e['body'][_0x3b315f(0x1b2)]],_0x332815=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x176)]],_0x5a852b=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x136)]],_0x5d64d8=[_0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x1a9)]];else var _0x26401c=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x1cd)]],_0x2eea04=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x12e)]],_0x44a16e=[..._0x588f7e[_0x3b315f(0x122)]['stock']],_0x58e272=[..._0x588f7e['body']['types']],_0x8dc7c6=[..._0x588f7e['body'][_0x3b315f(0x128)]],_0x25c7fc=[..._0x588f7e[_0x3b315f(0x122)]['New_Qty_Converted']],_0x1b04c6=[..._0x588f7e['body'][_0x3b315f(0x17e)]],_0x24e3bf=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x191)]],_0x176a69=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x15f)]],_0x52c220=[..._0x588f7e['body'][_0x3b315f(0x15a)]],_0x211ca9=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x1cc)]],_0x4b7102=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x18b)]],_0x559d0a=[..._0x588f7e['body'][_0x3b315f(0x133)]],_0x355c07=[..._0x588f7e['body'][_0x3b315f(0x1b2)]],_0x332815=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x176)]],_0x5a852b=[..._0x588f7e[_0x3b315f(0x122)][_0x3b315f(0x136)]],_0x5d64d8=[..._0x588f7e[_0x3b315f(0x122)]['id_transaction_from']];const _0x2b7acb=_0x26401c[_0x3b315f(0x162)](_0x596745=>{return _0x596745={'product_name':_0x596745};});_0x2eea04[_0x3b315f(0x151)]((_0x1f7cc2,_0x75f177)=>{var _0x286ed7=_0x3b315f,_0x1ba95f=_0x1f7cc2[_0x286ed7(0x167)](/[A-Za-z]+/)[0x0],_0x9abcbb=parseInt(_0x1f7cc2[_0x286ed7(0x167)](/\d+/)[0x0]);_0x2b7acb[_0x75f177][_0x286ed7(0x12e)]=_0x1ba95f,_0x2b7acb[_0x75f177][_0x286ed7(0x15e)]=_0x9abcbb;}),_0x5d64d8[_0x3b315f(0x151)]((_0xe7b41d,_0x162a81)=>{var _0x4d5f9e=_0x3b315f;_0x2b7acb[_0x162a81][_0x4d5f9e(0x1c5)]=_0xe7b41d;}),_0x44a16e[_0x3b315f(0x151)]((_0x225326,_0x409736)=>{var _0x49fb32=_0x3b315f;_0x2b7acb[_0x409736][_0x49fb32(0x1a7)]=_0x225326;}),_0x58e272[_0x3b315f(0x151)]((_0x51e167,_0x23adb4)=>{var _0xba844a=_0x3b315f;_0x2b7acb[_0x23adb4][_0xba844a(0x16f)]=_0x51e167;}),_0x8dc7c6['forEach']((_0x4f3d84,_0xefcf26)=>{_0x2b7acb[_0xefcf26]['adjust_qty']=_0x4f3d84;}),_0x25c7fc[_0x3b315f(0x151)]((_0x35babe,_0x8eb0f3)=>{var _0xa7370e=_0x3b315f;_0x2b7acb[_0x8eb0f3][_0xa7370e(0x155)]=_0x35babe;}),_0x1b04c6[_0x3b315f(0x151)]((_0x248409,_0x311233)=>{var _0x2d6add=_0x3b315f;_0x2b7acb[_0x311233][_0x2d6add(0x16b)]=_0x248409;}),_0x24e3bf[_0x3b315f(0x151)]((_0x10daf6,_0x42e264)=>{_0x2b7acb[_0x42e264]['secondary_unit']=_0x10daf6;}),_0x176a69['forEach']((_0x42b439,_0x95ff91)=>{var _0x13bd90=_0x3b315f;_0x2b7acb[_0x95ff91][_0x13bd90(0x180)]=_0x42b439;}),_0x52c220['forEach']((_0x2500a5,_0x409147)=>{var _0x19ee0d=_0x3b315f;_0x2b7acb[_0x409147][_0x19ee0d(0x15a)]=_0x2500a5;}),_0x211ca9[_0x3b315f(0x151)]((_0xbcf75c,_0x46f046)=>{var _0x6a55b1=_0x3b315f;_0x2b7acb[_0x46f046][_0x6a55b1(0x1cc)]=_0xbcf75c;}),_0x4b7102[_0x3b315f(0x151)]((_0x4dbf48,_0x516ebd)=>{var _0x43c4b2=_0x3b315f;_0x2b7acb[_0x516ebd][_0x43c4b2(0x189)]=_0x4dbf48;}),_0x559d0a[_0x3b315f(0x151)]((_0x1aa110,_0x358ff8)=>{var _0x521e67=_0x3b315f;_0x2b7acb[_0x358ff8][_0x521e67(0x133)]=_0x1aa110;}),_0x355c07[_0x3b315f(0x151)]((_0x20a4e4,_0x53a0ab)=>{var _0x26fb60=_0x3b315f;_0x2b7acb[_0x53a0ab][_0x26fb60(0x17b)]=_0x20a4e4;}),_0x332815[_0x3b315f(0x151)]((_0x416d67,_0x17343d)=>{_0x2b7acb[_0x17343d]['maxPerUnit']=_0x416d67;}),_0x5a852b[_0x3b315f(0x151)]((_0x350c82,_0x3d86a6)=>{var _0x26bac9=_0x3b315f;_0x2b7acb[_0x3d86a6][_0x26bac9(0x166)]=_0x350c82;});const _0x36fc04=_0x2b7acb[_0x3b315f(0x12f)](_0x11fcc7=>_0x11fcc7[_0x3b315f(0x123)]!=='0'&&_0x11fcc7[_0x3b315f(0x123)]!=='');var _0x4dec72=0x0;_0x36fc04[_0x3b315f(0x151)](_0x52b46a=>{var _0x2fd47a=_0x3b315f;console[_0x2fd47a(0x188)]('foreach\x20newproduct',_0x52b46a),parseInt(_0x52b46a[_0x2fd47a(0x123)])<=0x0&&_0x4dec72++;});if(_0x4dec72!=0x0)return _0x588f7e['flash'](_0x3b315f(0x19f),_0x3b315f(0x165)),_0x58d15e[_0x3b315f(0x160)](_0x3b315f(0x12a));const _0x3a1b01=new invoice_for_adjustment();await _0x3a1b01['save']();const _0x1f5518=new adjustment_finished({'warehouse_name':_0x17bd11,'date':_0x5a55b5,'product':_0x36fc04,'note':_0x25456d,'room':_0x50fded,'invoice':_0x3b315f(0x1b5)+_0x3a1b01[_0x3b315f(0x141)][_0x3b315f(0x192)]()['padStart'](0x8,'0'),'JO_number':_0x1ba6fa,'expiry_date':_0x350178,'PO_number':_0x2946e7,'RequestedBy':_0x87ac02,'DateofRequest':_0x3fa4c3,'typeservices':_0x33adc1,'destination':_0x5c1d3c,'deliverydate':_0x7447e5,'driver':_0x5b9038,'plate':_0x119cb9,'van':_0x37c5d8,'DRSI':_0x42da00,'typevehicle':_0x36d75d,'TSU':_0x236fa7,'TFU':_0x28c66d}),_0x5ddbe4=await _0x1f5518['save']();_0x588f7e[_0x3b315f(0x1bc)]('success',_0x3b315f(0x126)),_0x58d15e[_0x3b315f(0x160)](_0x3b315f(0x1a0)+_0x5ddbe4['_id']);}catch(_0x3ab43e){console[_0x3b315f(0x188)](_0x3ab43e),_0x58d15e['status'](0xc8)[_0x3b315f(0x154)]({'message':_0x3ab43e[_0x3b315f(0x1ab)]});}}),router['get']('/view/add_adjustment_logs',auth,async(_0x583791,_0x279334)=>{var _0x388360=a0_0x19f13e;try{const {username:_0x1fea17,email:_0x32cdf4,role:_0xfd8c5c}=_0x583791['user'],_0x509d84=_0x583791['user'],_0x4f9e37=await profile['findOne']({'email':_0x509d84[_0x388360(0x173)]}),_0x156a28=await master_shop[_0x388360(0x199)]();let _0x157d46;if(_0x509d84['role']==_0x388360(0x18f)){const _0xd231ba=await staff[_0x388360(0x132)]({'email':_0x509d84[_0x388360(0x173)]});_0x157d46=await warehouse[_0x388360(0x14d)]([{'$match':{'status':_0x388360(0x1a1),'name':_0xd231ba[_0x388360(0x1ae)]}},{'$group':{'_id':'$name','name':{'$first':_0x388360(0x185)}}}]);}else _0x157d46=await warehouse[_0x388360(0x14d)]([{'$match':{'status':_0x388360(0x1a1)}},{'$group':{'_id':'$name','name':{'$first':_0x388360(0x185)}}}]);const _0x1f1bd0=await product[_0x388360(0x199)](),_0x16ac0c=await adjustment_finished[_0x388360(0x199)](),_0x174d0e=_0x16ac0c[_0x388360(0x130)]+0x1,_0x34151c=_0x388360(0x13e)+_0x174d0e['toString']()[_0x388360(0x163)](0x5,'0');var _0x2d7f3e=['Ambient',_0x388360(0x11e),'Return\x20Rooms'];if(_0x156a28[0x0][_0x388360(0x13d)]==_0x388360(0x11f))var _0x3ca973=users[_0x388360(0x16c)];else{if(_0x156a28[0x0][_0x388360(0x13d)]=='Hindi')var _0x3ca973=users[_0x388360(0x1ca)];else{if(_0x156a28[0x0]['language']==_0x388360(0x19d))var _0x3ca973=users[_0x388360(0x19d)];else{if(_0x156a28[0x0][_0x388360(0x13d)]=='Spanish')var _0x3ca973=users[_0x388360(0x147)];else{if(_0x156a28[0x0][_0x388360(0x13d)]=='French')var _0x3ca973=users[_0x388360(0x1b8)];else{if(_0x156a28[0x0]['language']==_0x388360(0x183))var _0x3ca973=users[_0x388360(0x1cb)];else{if(_0x156a28[0x0]['language']==_0x388360(0x14b))var _0x3ca973=users[_0x388360(0x14b)];else{if(_0x156a28[0x0][_0x388360(0x13d)]=='Arabic\x20(ae)')var _0x3ca973=users[_0x388360(0x1b6)];}}}}}}}const _0x15e5d=getRandom8DigitNumber();_0x15e5d[_0x388360(0x186)](_0x32a645=>{var _0xe46dbc=_0x388360;_0x279334[_0xe46dbc(0x1c7)](_0xe46dbc(0x195),{'success':_0x583791['flash']('success'),'errors':_0x583791['flash'](_0xe46dbc(0x19f)),'role':_0x509d84,'profile':_0x4f9e37,'warehouse':_0x157d46,'product':_0x1f1bd0,'master_shop':_0x156a28,'language':_0x3ca973,'rooms_data':_0x2d7f3e,'invoice_no':_0x32a645});})[_0x388360(0x149)](_0x334a0f=>{var _0x141eaf=_0x388360;_0x583791[_0x141eaf(0x1bc)](_0x141eaf(0x19f),_0x141eaf(0x197)),_0x279334[_0x141eaf(0x160)]('/adjustment/view');});}catch(_0x5301c5){console[_0x388360(0x188)](_0x5301c5);}}),router[a0_0x19f13e(0x1c8)]('/view/add_adjustment_logs',auth,async(_0x490c06,_0x5c0101)=>{var _0x16225a=a0_0x19f13e;try{const {warehouse_name:_0x39a8fb,date:_0x4de46e,prod_name:_0x3b78f5,level:_0x2d8d06,isle:_0x5a72b7,pallet:_0x83d393,stock:_0x13b5cd,types:_0x22203e,adjust_qty:_0x109473,new_adjust_qty:_0x2d689a,note:_0x386a8d,Room_name:_0x30439a,JO_number:_0x1565f2,expiry_date:_0x557c82,type_of_transaction:_0x4fdb75,PO_number:_0x203560,ReqBy:_0x35142c,dateofreq:_0x161514,typeservicesData:_0x344174,destination:_0x496710,deliverydate:_0xef5318,driver:_0x1ad4ba,plate:_0x297951,van:_0x56056b,DRSI:_0x3426f6,typevehicle:_0x3c22f8,TSU:_0x1f981a,TFU:_0xf33385}=_0x490c06[_0x16225a(0x122)];if(typeof _0x3b78f5==_0x16225a(0x1a8))var _0x2bcb65=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x1cd)]],_0x25a278=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x12e)]],_0x323e0f=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x13b)]],_0x1bfb2f=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x16f)]],_0x240bba=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x128)]],_0x235702=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x19b)]],_0x330f60=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x17e)]],_0x54af11=[_0x490c06['body'][_0x16225a(0x191)]],_0x2b960c=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x15f)]],_0x5ca17b=[_0x490c06['body'][_0x16225a(0x15a)]],_0x449450=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x1cc)]],_0x544422=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x18b)]],_0x1cbf13=[_0x490c06['body'][_0x16225a(0x133)]],_0x4b9582=[_0x490c06['body'][_0x16225a(0x1b2)]],_0x532108=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x176)]],_0x573fac=[_0x490c06[_0x16225a(0x122)][_0x16225a(0x136)]],_0x56cf3e=[_0x490c06['body']['id_transaction_from']];else var _0x2bcb65=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x1cd)]],_0x25a278=[..._0x490c06['body'][_0x16225a(0x12e)]],_0x323e0f=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x13b)]],_0x1bfb2f=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x16f)]],_0x240bba=[..._0x490c06['body'][_0x16225a(0x128)]],_0x235702=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x19b)]],_0x330f60=[..._0x490c06[_0x16225a(0x122)]['Primary_Units']],_0x54af11=[..._0x490c06['body'][_0x16225a(0x191)]],_0x2b960c=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x15f)]],_0x5ca17b=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x15a)]],_0x449450=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x1cc)]],_0x544422=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x18b)]],_0x1cbf13=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x133)]],_0x4b9582=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x1b2)]],_0x532108=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x176)]],_0x573fac=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x136)]],_0x56cf3e=[..._0x490c06[_0x16225a(0x122)][_0x16225a(0x1a9)]];const _0x3bd646=_0x2bcb65[_0x16225a(0x162)](_0x1ba6dc=>{return _0x1ba6dc={'product_name':_0x1ba6dc};});_0x25a278[_0x16225a(0x151)]((_0x185007,_0x4a1154)=>{var _0x5090f0=_0x16225a,_0x26b603=_0x185007[_0x5090f0(0x167)](/[A-Za-z]+/)[0x0],_0x478b30=parseInt(_0x185007[_0x5090f0(0x167)](/\d+/)[0x0]);_0x3bd646[_0x4a1154][_0x5090f0(0x12e)]=_0x26b603,_0x3bd646[_0x4a1154]['bay']=_0x478b30;}),_0x56cf3e[_0x16225a(0x151)]((_0x1c5eb3,_0x55b1e9)=>{var _0x2646a5=_0x16225a;_0x3bd646[_0x55b1e9][_0x2646a5(0x1c5)]=_0x1c5eb3;}),_0x323e0f[_0x16225a(0x151)]((_0x1e3e6a,_0x141b9d)=>{var _0x225898=_0x16225a;_0x3bd646[_0x141b9d][_0x225898(0x1a7)]=_0x1e3e6a;}),_0x1bfb2f['forEach']((_0x93a12f,_0x1bfc96)=>{_0x3bd646[_0x1bfc96]['types']=_0x93a12f;}),_0x240bba[_0x16225a(0x151)]((_0x15cfdd,_0x4dfa6e)=>{_0x3bd646[_0x4dfa6e]['adjust_qty']=_0x15cfdd;}),_0x235702[_0x16225a(0x151)]((_0x39f336,_0x2b3e4e)=>{var _0x527bfc=_0x16225a;_0x3bd646[_0x2b3e4e][_0x527bfc(0x155)]=_0x39f336;}),_0x330f60[_0x16225a(0x151)]((_0x4034c0,_0x50113f)=>{var _0x34750e=_0x16225a;_0x3bd646[_0x50113f][_0x34750e(0x16b)]=_0x4034c0;}),_0x54af11[_0x16225a(0x151)]((_0x32d281,_0x1dcd7b)=>{var _0x5cea35=_0x16225a;_0x3bd646[_0x1dcd7b][_0x5cea35(0x1bf)]=_0x32d281;}),_0x2b960c[_0x16225a(0x151)]((_0x4444fc,_0x4d0d10)=>{var _0x422454=_0x16225a;_0x3bd646[_0x4d0d10][_0x422454(0x180)]=_0x4444fc;}),_0x5ca17b[_0x16225a(0x151)]((_0x18781e,_0x3b766e)=>{var _0x3a689a=_0x16225a;_0x3bd646[_0x3b766e][_0x3a689a(0x15a)]=_0x18781e;}),_0x449450['forEach']((_0x5003a0,_0x26b316)=>{var _0x1b6915=_0x16225a;_0x3bd646[_0x26b316][_0x1b6915(0x1cc)]=_0x5003a0;}),_0x544422[_0x16225a(0x151)]((_0x491fcd,_0x1ea70e)=>{var _0x53ecfa=_0x16225a;_0x3bd646[_0x1ea70e][_0x53ecfa(0x189)]=_0x491fcd;}),_0x1cbf13[_0x16225a(0x151)]((_0x476c3e,_0x1dcd27)=>{var _0x499484=_0x16225a;_0x3bd646[_0x1dcd27][_0x499484(0x133)]=_0x476c3e;}),_0x4b9582['forEach']((_0x231582,_0x1d3a89)=>{_0x3bd646[_0x1d3a89]['room_names']=_0x231582;}),_0x532108[_0x16225a(0x151)]((_0x43ca38,_0x1f52ec)=>{var _0x2829ae=_0x16225a;_0x3bd646[_0x1f52ec][_0x2829ae(0x176)]=_0x43ca38;}),_0x573fac[_0x16225a(0x151)]((_0x3351b6,_0x304f46)=>{var _0x42a9c7=_0x16225a;_0x3bd646[_0x304f46][_0x42a9c7(0x166)]=_0x3351b6;});const _0x121cef=_0x3bd646[_0x16225a(0x12f)](_0x1f72d6=>_0x1f72d6[_0x16225a(0x123)]!=='0'&&_0x1f72d6[_0x16225a(0x123)]!=='');var _0x402d5a=0x0;_0x121cef['forEach'](_0x10a275=>{var _0x1a173e=_0x16225a;console[_0x1a173e(0x188)](_0x1a173e(0x14f),_0x10a275),parseInt(_0x10a275[_0x1a173e(0x123)])<=0x0&&_0x402d5a++;});if(_0x402d5a!=0x0)return _0x490c06['flash'](_0x16225a(0x19f),_0x16225a(0x165)),_0x5c0101['redirect'](_0x16225a(0x12a));const _0x3fe71d=new adjustment_logs();await _0x3fe71d[_0x16225a(0x1bb)]();const _0x2be889=new adjustment_finished({'warehouse_name':_0x39a8fb,'date':_0x4de46e,'product':_0x121cef,'note':_0x386a8d,'room':_0x30439a,'invoice':'LOG-ADJ-'+_0x3fe71d[_0x16225a(0x141)][_0x16225a(0x192)]()[_0x16225a(0x163)](0x8,'0'),'JO_number':_0x1565f2,'expiry_date':_0x557c82,'type_of_transaction':_0x4fdb75,'PO_number':_0x203560,'RequestedBy':_0x35142c,'DateofRequest':_0x161514,'typeservices':_0x344174,'destination':_0x496710,'deliverydate':_0xef5318,'driver':_0x1ad4ba,'plate':_0x297951,'van':_0x56056b,'DRSI':_0x3426f6,'typevehicle':_0x3c22f8,'TSU':_0x1f981a,'TFU':_0xf33385}),_0x1f3559=await _0x2be889[_0x16225a(0x1bb)]();_0x490c06[_0x16225a(0x1bc)](_0x16225a(0x1b7),_0x16225a(0x126)),_0x5c0101['redirect'](_0x16225a(0x1a0)+_0x1f3559[_0x16225a(0x137)]);}catch(_0x5c48b8){console['log'](_0x5c48b8),_0x5c0101[_0x16225a(0x1b1)](0xc8)['json']({'message':_0x5c48b8[_0x16225a(0x1ab)]});}}),router[a0_0x19f13e(0x13a)](a0_0x19f13e(0x1b3),auth,async(_0x1a8e1f,_0x1a35c0)=>{var _0x5bbb3f=a0_0x19f13e;try{const {username:_0x165b62,email:_0x2addf6,role:_0x1671e6}=_0x1a8e1f[_0x5bbb3f(0x135)],_0x428c5f=_0x1a8e1f['user'],_0x15dc29=await profile[_0x5bbb3f(0x132)]({'email':_0x428c5f[_0x5bbb3f(0x173)]}),_0x24b6f4=await master_shop['find'](),_0x66826a=_0x1a8e1f['params']['id'],_0x550214=await adjustment_finished[_0x5bbb3f(0x174)]({'_id':_0x66826a}),_0x3bd1da=await purchases[_0x5bbb3f(0x14d)]([{'$match':{'warehouse_name':_0x550214[_0x5bbb3f(0x156)]}},{'$unwind':_0x5bbb3f(0x187)},{'$group':{'_id':_0x5bbb3f(0x18d)}}]);console['log'](_0x5bbb3f(0x181),_0x3bd1da);const _0x2be67b=await product[_0x5bbb3f(0x199)]({}),_0x8c1c17=await warehouse[_0x5bbb3f(0x14d)]([{'$match':{'name':_0x550214[_0x5bbb3f(0x156)]}},{'$unwind':_0x5bbb3f(0x16a)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5bbb3f(0x18a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5bbb3f(0x16e)},'bin':{'$first':_0x5bbb3f(0x1a4)},'type':{'$first':_0x5bbb3f(0x144)},'floorlevel':{'$first':_0x5bbb3f(0x120)},'primary_code':{'$first':_0x5bbb3f(0x190)},'secondary_code':{'$first':_0x5bbb3f(0x19a)},'product_code':{'$first':_0x5bbb3f(0x140)},'storage':{'$first':_0x5bbb3f(0x17f)},'rack':{'$first':_0x5bbb3f(0x15b)},'expiry_date':{'$first':_0x5bbb3f(0x178)},'production_date':{'$first':_0x5bbb3f(0x15c)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x5bbb3f(0x11d)},'room':{'$first':_0x5bbb3f(0x1be)}}}]);if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x11f)){var _0x1f7fa6=users[_0x5bbb3f(0x16c)];console[_0x5bbb3f(0x188)](_0x1f7fa6);}else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x1ca))var _0x1f7fa6=users[_0x5bbb3f(0x1ca)];else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x19d))var _0x1f7fa6=users[_0x5bbb3f(0x19d)];else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x147))var _0x1f7fa6=users[_0x5bbb3f(0x147)];else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x1b8))var _0x1f7fa6=users['French'];else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x183))var _0x1f7fa6=users[_0x5bbb3f(0x1cb)];else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]==_0x5bbb3f(0x14b))var _0x1f7fa6=users['Chinese'];else{if(_0x24b6f4[0x0][_0x5bbb3f(0x13d)]=='Arabic\x20(ae)')var _0x1f7fa6=users[_0x5bbb3f(0x1b6)];}}}}}}}_0x1a35c0[_0x5bbb3f(0x1c7)](_0x5bbb3f(0x172),{'success':_0x1a8e1f[_0x5bbb3f(0x1bc)](_0x5bbb3f(0x1b7)),'errors':_0x1a8e1f[_0x5bbb3f(0x1bc)](_0x5bbb3f(0x19f)),'role':_0x428c5f,'profile':_0x15dc29,'adjustment':_0x550214,'stock':_0x8c1c17,'master_shop':_0x24b6f4,'warehouse_name':_0x3bd1da,'unit':_0x2be67b,'language':_0x1f7fa6});}catch(_0x3278fb){console[_0x5bbb3f(0x188)](_0x3278fb),_0x1a35c0[_0x5bbb3f(0x1b1)](0xc8)[_0x5bbb3f(0x154)]({'message':_0x3278fb[_0x5bbb3f(0x1ab)]});}}),router[a0_0x19f13e(0x1c8)](a0_0x19f13e(0x1b3),auth,async(_0x3a5998,_0x4e6d77)=>{var _0x5d5d23=a0_0x19f13e;try{const {invoice:_0x23b96b,warehouse_name:_0x9e9016,Room_name:_0x57f5fd}=_0x3a5998[_0x5d5d23(0x122)],_0x401397=_0x3a5998[_0x5d5d23(0x18e)]['id'],_0x188420=await adjustment_finished[_0x5d5d23(0x174)]({'_id':_0x401397});var _0x8fb2a;const _0x31a3ae=_0x188420[_0x5d5d23(0x138)][_0x5d5d23(0x162)](async _0x593fa7=>{var _0x1e3bab=_0x5d5d23;if(_0x593fa7['adjust_qty']>0x0){_0x8fb2a=await warehouse[_0x1e3bab(0x132)]({'name':_0x9e9016,'room':_0x593fa7[_0x1e3bab(0x17b)]});const _0x4d3e14=_0x8fb2a['product_details']['map'](_0x206946=>{var _0x3ba5a9=_0x1e3bab;console['log'](_0x593fa7[_0x3ba5a9(0x16f)]);if(_0x593fa7[_0x3ba5a9(0x16f)]==_0x3ba5a9(0x1ac))_0x206946[_0x3ba5a9(0x137)]==_0x593fa7[_0x3ba5a9(0x1c5)]&&(_0x206946['product_stock']=_0x206946[_0x3ba5a9(0x1c3)]-_0x593fa7[_0x3ba5a9(0x123)]);else _0x593fa7[_0x3ba5a9(0x16f)]==_0x3ba5a9(0x124)&&(_0x206946[_0x3ba5a9(0x137)]==_0x593fa7[_0x3ba5a9(0x1c5)]&&(_0x206946[_0x3ba5a9(0x1c3)]=_0x206946[_0x3ba5a9(0x1c3)]+_0x593fa7['adjust_qty']));});}return _0x8fb2a;});Promise['all'](_0x31a3ae)[_0x5d5d23(0x186)](async _0x1ce4c7=>{var _0x265438=_0x5d5d23;try{for(const _0x2f116d of _0x1ce4c7){await _0x2f116d['save']();}_0x188420[_0x265438(0x194)]='True';const _0x2346df=await _0x188420['save'](),_0x25248d=await master_shop[_0x265438(0x199)](),_0x4ae752=await email_settings[_0x265438(0x132)](),_0x22f516=await supervisor_settings[_0x265438(0x199)]();var _0x578a44=_0x188420[_0x265438(0x138)],_0x992a7d='',_0x5b3455;for(_0x5b3455 in _0x578a44){var _0x56df13='FG';_0x188420[_0x265438(0x156)]==_0x265438(0x161)&&(_0x56df13='DG'),_0x992a7d+=_0x265438(0x134)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578a44[_0x5b3455][_0x265438(0x1c1)]+_0x265438(0x17c)+_0x265438(0x14c)+_0x578a44[_0x5b3455][_0x265438(0x180)]+_0x265438(0x17c)+_0x265438(0x14c)+_0x578a44[_0x5b3455][_0x265438(0x123)]+_0x265438(0x17c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578a44[_0x5b3455][_0x265438(0x16b)]+_0x265438(0x17c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578a44[_0x5b3455]['secondary_unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x188420[_0x265438(0x156)]+_0x265438(0x17c)+_0x265438(0x14c)+_0x578a44[_0x5b3455][_0x265438(0x17b)]+_0x265438(0x17c)+_0x265438(0x14c)+_0x56df13+_0x578a44[_0x5b3455][_0x265438(0x15e)]+_0x265438(0x17c)+_0x265438(0x1c4);}_0x3a5998[_0x265438(0x1bc)]('success','Adjustment\x20Finalize\x20Successfully'),_0x4e6d77[_0x265438(0x160)](_0x265438(0x18c)+_0x2346df['_id']);}catch(_0x5cf350){console['error'](_0x5cf350),_0x4e6d77['status'](0x1f4)[_0x265438(0x154)]({'error':_0x265438(0x1b9)});}})['catch'](_0x4769f3=>{var _0x43f91a=_0x5d5d23;console[_0x43f91a(0x157)](_0x4769f3),_0x4e6d77[_0x43f91a(0x1b1)](0x1f4)[_0x43f91a(0x154)]({'error':_0x43f91a(0x152)});});}catch(_0xf25dc){_0x4e6d77[_0x5d5d23(0x154)]({'message':_0xf25dc[_0x5d5d23(0x1ab)]});}}),router[a0_0x19f13e(0x13a)](a0_0x19f13e(0x1ad),auth,async(_0x3bfe5d,_0x39faa8)=>{var _0x42ee72=a0_0x19f13e;try{const {username:_0x20dbea,email:_0x2f3402,role:_0xa99b26}=_0x3bfe5d['user'],_0x24acde=_0x3bfe5d['user'],_0x436a6f=await profile[_0x42ee72(0x132)]({'email':_0x24acde['email']}),_0x240f34=await master_shop['find']();console[_0x42ee72(0x188)](_0x42ee72(0x19c),_0x240f34);const _0x2ea009=_0x3bfe5d[_0x42ee72(0x18e)]['id'],_0x369d13=await adjustment_finished[_0x42ee72(0x174)]({'_id':_0x2ea009});let _0x30df20=new Date(_0x369d13['expiry_date']),_0x2e56a0=('0'+_0x30df20[_0x42ee72(0x14a)]())['slice'](-0x2),_0x54b2d1=('0'+(_0x30df20[_0x42ee72(0x159)]()+0x1))['slice'](-0x2),_0x443378=_0x30df20[_0x42ee72(0x168)](),_0x28eadb=_0x443378+'-'+_0x54b2d1+'-'+_0x2e56a0;var _0x44bf7a=[_0x42ee72(0x170),_0x42ee72(0x11e),_0x42ee72(0x196)];const _0x1f2567=await purchases[_0x42ee72(0x14d)]([{'$match':{'warehouse_name':_0x369d13['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x42ee72(0x188)](_0x42ee72(0x181),_0x1f2567);const _0x1e96f5=await product[_0x42ee72(0x199)]({}),_0x177048=await warehouse['aggregate']([{'$match':{'name':_0x369d13[_0x42ee72(0x156)],'room':_0x369d13[_0x42ee72(0x1c6)]}},{'$unwind':_0x42ee72(0x16a)},{'$group':{'_id':_0x42ee72(0x12b),'name':{'$first':_0x42ee72(0x18a)},'product_stock':{'$first':_0x42ee72(0x1a6)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x42ee72(0x1a4)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x42ee72(0x120)},'primary_code':{'$first':_0x42ee72(0x190)},'secondary_code':{'$first':_0x42ee72(0x19a)},'product_code':{'$first':_0x42ee72(0x140)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);if(_0x240f34[0x0][_0x42ee72(0x13d)]==_0x42ee72(0x11f)){var _0x5e78b8=users[_0x42ee72(0x16c)];console['log'](_0x5e78b8);}else{if(_0x240f34[0x0][_0x42ee72(0x13d)]==_0x42ee72(0x1ca))var _0x5e78b8=users[_0x42ee72(0x1ca)];else{if(_0x240f34[0x0][_0x42ee72(0x13d)]==_0x42ee72(0x19d))var _0x5e78b8=users[_0x42ee72(0x19d)];else{if(_0x240f34[0x0][_0x42ee72(0x13d)]==_0x42ee72(0x147))var _0x5e78b8=users[_0x42ee72(0x147)];else{if(_0x240f34[0x0][_0x42ee72(0x13d)]==_0x42ee72(0x1b8))var _0x5e78b8=users[_0x42ee72(0x1b8)];else{if(_0x240f34[0x0]['language']==_0x42ee72(0x183))var _0x5e78b8=users[_0x42ee72(0x1cb)];else{if(_0x240f34[0x0][_0x42ee72(0x13d)]==_0x42ee72(0x14b))var _0x5e78b8=users['Chinese'];else{if(_0x240f34[0x0]['language']==_0x42ee72(0x14e))var _0x5e78b8=users['Arabic'];}}}}}}}_0x39faa8[_0x42ee72(0x1c7)](_0x42ee72(0x131),{'success':_0x3bfe5d['flash'](_0x42ee72(0x1b7)),'errors':_0x3bfe5d[_0x42ee72(0x1bc)]('errors'),'role':_0x24acde,'profile':_0x436a6f,'adjustment':_0x369d13,'stock':_0x177048,'master_shop':_0x240f34,'warehouse_name':_0x1f2567,'unit':_0x1e96f5,'language':_0x5e78b8,'rooms_data':_0x44bf7a,'ed_fullDate':_0x28eadb});}catch(_0x5cfb95){console[_0x42ee72(0x188)](_0x5cfb95),_0x39faa8[_0x42ee72(0x1b1)](0xc8)[_0x42ee72(0x154)]({'message':_0x5cfb95[_0x42ee72(0x1ab)]});}}),router[a0_0x19f13e(0x1c8)](a0_0x19f13e(0x1ad),auth,async(_0x5f3497,_0x558304)=>{var _0x377f2d=a0_0x19f13e;try{const _0x1e62c4=_0x5f3497['params']['id'],_0x413101=await adjustment_finished[_0x377f2d(0x174)]({'_id':_0x1e62c4}),_0x3e4fd8=await warehouse[_0x377f2d(0x132)]({'name':_0x413101[_0x377f2d(0x156)],'room':_0x413101[_0x377f2d(0x1c6)]}),{warehouse_name:_0x1d226f,date:_0x2abb94,prod_name:_0x58d3bf,level:_0x1d63fc,isle:_0x4460b3,pallet:_0x562ae1,stock:_0x105d60,types:_0x5df8dd,adjust_qty:_0x2539a0,new_adjust_qty:_0x2d6802,note:_0x3c8f7c,Room_name:_0x1e0e35,invoice:_0x4652e1,JO_number:_0xcc892}=_0x5f3497[_0x377f2d(0x122)];if(typeof _0x58d3bf=='string')var _0xf872d0=[_0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x1cd)]],_0x17fe8=[_0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x12e)]],_0x16e044=[_0x5f3497[_0x377f2d(0x122)]['stock']],_0x520cff=[_0x5f3497[_0x377f2d(0x122)]['types']],_0x2abcd1=[_0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x123)]],_0x9856b1=[_0x5f3497['body']['new_adjust_qty']],_0xea12df=[_0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x15f)]],_0x4a4e3f=[_0x5f3497['body'][_0x377f2d(0x16b)]],_0x103a96=[_0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x191)]],_0x3378c9=[_0x5f3497['body']['batch_code']],_0x53ba85=[_0x5f3497[_0x377f2d(0x122)]['expiry_date']];else var _0xf872d0=[..._0x5f3497[_0x377f2d(0x122)]['prod_name']],_0x17fe8=[..._0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x12e)]],_0x16e044=[..._0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x13b)]],_0x520cff=[..._0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x16f)]],_0x2abcd1=[..._0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x123)]],_0x9856b1=[..._0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x155)]],_0xea12df=[..._0x5f3497['body'][_0x377f2d(0x15f)]],_0x4a4e3f=[..._0x5f3497['body'][_0x377f2d(0x16b)]],_0x103a96=[..._0x5f3497[_0x377f2d(0x122)][_0x377f2d(0x191)]],_0x3378c9=[..._0x5f3497['body']['batch_code']],_0x53ba85=[..._0x5f3497['body'][_0x377f2d(0x1cc)]];const _0x1cedef=_0xf872d0['map'](_0x561458=>{return _0x561458={'product_name':_0x561458};});_0x17fe8['forEach']((_0x3fb5e6,_0x15ebf9)=>{var _0xd49100=_0x377f2d;_0x1cedef[_0x15ebf9][_0xd49100(0x15e)]=_0x3fb5e6;}),_0x16e044[_0x377f2d(0x151)]((_0x33dbbf,_0x1cfb54)=>{var _0x1fabc2=_0x377f2d;_0x1cedef[_0x1cfb54][_0x1fabc2(0x1a7)]=_0x33dbbf;}),_0x520cff[_0x377f2d(0x151)]((_0x43793a,_0x425199)=>{_0x1cedef[_0x425199]['types']=_0x43793a;}),_0x2abcd1[_0x377f2d(0x151)]((_0x2133d1,_0x18bfc0)=>{var _0x4259ee=_0x377f2d;_0x1cedef[_0x18bfc0][_0x4259ee(0x123)]=_0x2133d1;}),_0x9856b1[_0x377f2d(0x151)]((_0x21df6f,_0x446b6b)=>{var _0x326cd0=_0x377f2d;_0x1cedef[_0x446b6b][_0x326cd0(0x155)]=_0x21df6f;}),_0x4a4e3f[_0x377f2d(0x151)]((_0x33c565,_0x94a94)=>{_0x1cedef[_0x94a94]['unit']=_0x33c565;}),_0x103a96[_0x377f2d(0x151)]((_0x27c393,_0x171cab)=>{var _0x2a88d5=_0x377f2d;_0x1cedef[_0x171cab][_0x2a88d5(0x1bf)]=_0x27c393;}),_0xea12df[_0x377f2d(0x151)]((_0x4c870c,_0x23d849)=>{_0x1cedef[_0x23d849]['product_code']=_0x4c870c;}),_0x3378c9[_0x377f2d(0x151)]((_0x42f991,_0x30582f)=>{var _0x896dde=_0x377f2d;_0x1cedef[_0x30582f][_0x896dde(0x15a)]=_0x42f991;}),_0x53ba85['forEach']((_0x523134,_0x153a72)=>{var _0x4ddb7d=_0x377f2d;_0x1cedef[_0x153a72][_0x4ddb7d(0x1cc)]=_0x523134;});const _0x407b80=_0x1cedef[_0x377f2d(0x12f)](_0x4cef48=>_0x4cef48[_0x377f2d(0x123)]!=='0'&&_0x4cef48[_0x377f2d(0x123)]!=='');var _0x58a304=0x0;_0x407b80[_0x377f2d(0x151)](_0x366b46=>{var _0x529da8=_0x377f2d;console[_0x529da8(0x188)](_0x529da8(0x14f),_0x366b46),parseInt(_0x366b46['adjust_qty'])<=0x0&&_0x58a304++;});if(_0x58a304!=0x0)return _0x5f3497[_0x377f2d(0x1bc)]('errors',_0x377f2d(0x165)),_0x558304[_0x377f2d(0x160)](_0x377f2d(0x12a));_0x413101['warehouse_name']=_0x1d226f,_0x413101[_0x377f2d(0x150)]=_0x2abb94,_0x413101[_0x377f2d(0x138)]=_0x407b80,_0x413101[_0x377f2d(0x171)]=_0x3c8f7c,_0x413101[_0x377f2d(0x1c6)]=_0x1e0e35,_0x413101[_0x377f2d(0x166)]=_0x4652e1,_0x413101[_0x377f2d(0x1c9)]=_0xcc892;const _0x4c9c4d=await _0x413101[_0x377f2d(0x1bb)](),_0x2db571=await warehouse[_0x377f2d(0x132)]({'name':_0x1d226f,'room':_0x1e0e35});_0x4c9c4d['product']['forEach'](_0x32b58f=>{var _0x16a70a=_0x377f2d;const _0x17cf9b=_0x2db571[_0x16a70a(0x139)][_0x16a70a(0x162)](_0x3163e3=>{var _0x3840df=_0x16a70a;_0x32b58f[_0x3840df(0x16f)]==_0x3840df(0x1ac)?_0x3163e3[_0x3840df(0x1c1)]==_0x32b58f[_0x3840df(0x1c1)]&&_0x3163e3[_0x3840df(0x15e)]==_0x32b58f[_0x3840df(0x15e)]&&(_0x3163e3['product_stock']=parseInt(_0x3163e3[_0x3840df(0x1c3)])-parseInt(_0x32b58f[_0x3840df(0x123)])):_0x3163e3['product_name']==_0x32b58f[_0x3840df(0x1c1)]&&_0x3163e3['bay']==_0x32b58f[_0x3840df(0x15e)]&&(_0x3163e3[_0x3840df(0x1c3)]=parseInt(_0x3163e3[_0x3840df(0x1c3)])+parseInt(_0x32b58f[_0x3840df(0x123)]));});}),await _0x2db571['save'](),_0x5f3497[_0x377f2d(0x1bc)](_0x377f2d(0x1b7),_0x377f2d(0x198)),_0x558304[_0x377f2d(0x160)](_0x377f2d(0x17d));}catch(_0x1aabac){console[_0x377f2d(0x188)](_0x1aabac);}}),router[a0_0x19f13e(0x1c8)](a0_0x19f13e(0x129),async(_0x267ed4,_0x3edd6a)=>{var _0x500225=a0_0x19f13e;const {primary_code:_0x2b76fb,warehouse_data:_0x29086c,rooms_data:_0x34938d,Roomslist:_0x20e329}=_0x267ed4[_0x500225(0x122)],_0x8bf865=_0x20e329['split'](','),_0x282bd7=[];async function _0x1c9d9a(_0x8ce89c){var _0x352d9e=_0x500225;const _0x530531=await warehouse['aggregate']([{'$match':{'name':_0x29086c,'room':_0x8ce89c}},{'$unwind':_0x352d9e(0x16a)},{'$match':{'product_details.primary_code':_0x2b76fb}},{'$group':{'_id':_0x352d9e(0x12b),'name':{'$first':_0x352d9e(0x18a)},'product_stock':{'$first':_0x352d9e(0x1a6)},'primary_code':{'$first':_0x352d9e(0x190)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x352d9e(0x140)},'level':{'$first':_0x352d9e(0x1b4)},'bay':{'$first':_0x352d9e(0x16e)},'type':{'$first':_0x352d9e(0x144)},'pallet':{'$first':_0x352d9e(0x120)},'unit':{'$first':_0x352d9e(0x1bd)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x352d9e(0x15b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x352d9e(0x15c)},'batch_code':{'$first':_0x352d9e(0x1c2)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x352d9e(0x11d)},'roomNamed':{'$first':_0x352d9e(0x1be)},'invoice':{'$first':_0x352d9e(0x142)}}}]),_0x235ab5=await warehouse['aggregate']([{'$match':{'name':_0x29086c,'room':_0x8ce89c}},{'$unwind':_0x352d9e(0x16a)},{'$match':{'product_details.secondary_code':_0x2b76fb}},{'$group':{'_id':_0x352d9e(0x12b),'name':{'$first':_0x352d9e(0x18a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x352d9e(0x190)},'secondary_code':{'$first':_0x352d9e(0x19a)},'product_code':{'$first':_0x352d9e(0x140)},'level':{'$first':_0x352d9e(0x1b4)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x352d9e(0x144)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x352d9e(0x1bd)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x352d9e(0x17f)},'rack':{'$first':_0x352d9e(0x15b)},'expiry_date':{'$first':_0x352d9e(0x178)},'production_date':{'$first':_0x352d9e(0x15c)},'batch_code':{'$first':_0x352d9e(0x1c2)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x352d9e(0x11d)},'roomNamed':{'$first':_0x352d9e(0x1be)},'invoice':{'$first':_0x352d9e(0x142)}}}]);if(_0x530531[_0x352d9e(0x130)]>0x0)_0x282bd7[_0x352d9e(0x153)](_0x530531);else _0x235ab5[_0x352d9e(0x130)]>0x0&&_0x282bd7[_0x352d9e(0x153)](_0x235ab5);}const _0x1d9b58=_0x8bf865[_0x500225(0x162)](_0x4f7400=>_0x1c9d9a(_0x4f7400));await Promise[_0x500225(0x148)](_0x1d9b58),_0x3edd6a['json'](_0x282bd7);}),router[a0_0x19f13e(0x1c8)](a0_0x19f13e(0x158),async(_0x52b6ab,_0x478703)=>{var _0x63363d=a0_0x19f13e;const {productCode:_0x2b3251,bay:_0x435589,warehouses:_0x888eb,room:_0x2cd245}=_0x52b6ab[_0x63363d(0x122)];console[_0x63363d(0x188)](_0x52b6ab[_0x63363d(0x122)]);try{const _0x28a724=await warehouse[_0x63363d(0x14d)]([{'$match':{'name':_0x888eb,'room':_0x2cd245}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x435589)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x63363d(0x18a)},'product_stock':{'$first':_0x63363d(0x1a6)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x63363d(0x143)}}}]);_0x478703[_0x63363d(0x1b1)](0xc8)[_0x63363d(0x154)](_0x28a724);}catch(_0x249112){_0x478703[_0x63363d(0x1b1)](0x194)['json']({'message':_0x249112['message']});}}),module[a0_0x19f13e(0x1c0)]=router;