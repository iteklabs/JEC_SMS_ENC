var a0_0x400f44=a0_0x41d8;(function(_0x1a5245,_0x20a2b9){var _0xd4e312=a0_0x41d8,_0x4a32e6=_0x1a5245();while(!![]){try{var _0x24ae54=parseInt(_0xd4e312(0x150))/0x1+-parseInt(_0xd4e312(0x15f))/0x2+parseInt(_0xd4e312(0x153))/0x3+-parseInt(_0xd4e312(0x13b))/0x4*(-parseInt(_0xd4e312(0x14e))/0x5)+parseInt(_0xd4e312(0x132))/0x6+-parseInt(_0xd4e312(0x10d))/0x7*(-parseInt(_0xd4e312(0xd8))/0x8)+-parseInt(_0xd4e312(0x102))/0x9*(parseInt(_0xd4e312(0x109))/0xa);if(_0x24ae54===_0x20a2b9)break;else _0x4a32e6['push'](_0x4a32e6['shift']());}catch(_0x384cb5){_0x4a32e6['push'](_0x4a32e6['shift']());}}}(a0_0x4763,0x39c18));const express=require(a0_0x400f44(0x107)),app=express(),router=express['Router'](),auth=require(a0_0x400f44(0xf1)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x400f44(0xf4)),users=require(a0_0x400f44(0xc5)),nodemailer=require('nodemailer');router[a0_0x400f44(0x163)](a0_0x400f44(0x103),auth,async(_0x4f1108,_0xd5c3aa)=>{var _0x3e68f3=a0_0x400f44;try{const {username:_0x24d6e3,email:_0x17241f,role:_0x572b86}=_0x4f1108[_0x3e68f3(0xed)],_0x242362=_0x4f1108[_0x3e68f3(0xed)],_0x24f213=await profile['findOne']({'email':_0x242362[_0x3e68f3(0x169)]}),_0x16727e=await master_shop[_0x3e68f3(0x101)]();let _0x199cc8;if(_0x242362[_0x3e68f3(0x148)]==_0x3e68f3(0x167)){const _0x3b1170=await staff[_0x3e68f3(0x135)]({'email':_0x242362['email']});_0x199cc8=await warehouse[_0x3e68f3(0x101)]({'status':_0x3e68f3(0x136),'name':_0x3b1170[_0x3e68f3(0x165)]});}else _0x199cc8=await warehouse[_0x3e68f3(0x101)]({'status':_0x3e68f3(0x136)});const _0x1993aa=await product[_0x3e68f3(0x101)]();let _0x247ebe;if(_0x242362[_0x3e68f3(0x148)]==_0x3e68f3(0x167)){const _0xa1c471=await staff[_0x3e68f3(0x135)]({'email':_0x242362[_0x3e68f3(0x169)]});_0x247ebe=await adjustment_finished[_0x3e68f3(0x101)]({'warehouse_name':_0xa1c471['warehouse']});}else _0x247ebe=await adjustment_finished[_0x3e68f3(0xcd)]([{'$match':{'type_of_transaction':_0x3e68f3(0xdf)}},{'$unwind':_0x3e68f3(0x11a)},{'$group':{'_id':_0x3e68f3(0x134),'invoice':{'$first':_0x3e68f3(0x14f)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x3e68f3(0xff)},'finalize':{'$first':_0x3e68f3(0xf3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0xe8)){var _0x2f55bb=users['English'];console[_0x3e68f3(0xd7)](_0x2f55bb);}else{if(_0x16727e[0x0]['language']==_0x3e68f3(0x112))var _0x2f55bb=users['Hindi'];else{if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0x15b))var _0x2f55bb=users['German'];else{if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0xe1))var _0x2f55bb=users[_0x3e68f3(0xe1)];else{if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0xd3))var _0x2f55bb=users[_0x3e68f3(0xd3)];else{if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0xea))var _0x2f55bb=users['Portuguese'];else{if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0x125))var _0x2f55bb=users['Chinese'];else{if(_0x16727e[0x0][_0x3e68f3(0xd9)]==_0x3e68f3(0x11f))var _0x2f55bb=users[_0x3e68f3(0x154)];}}}}}}}_0xd5c3aa[_0x3e68f3(0x124)](_0x3e68f3(0xcf),{'success':_0x4f1108[_0x3e68f3(0xe5)](_0x3e68f3(0x13f)),'errors':_0x4f1108[_0x3e68f3(0xe5)]('errors'),'role':_0x242362,'profile':_0x24f213,'warehouse':_0x199cc8,'product':_0x1993aa,'adjustment':_0x247ebe,'master_shop':_0x16727e,'language':_0x2f55bb});}catch(_0x379e7d){console[_0x3e68f3(0xd7)](_0x379e7d);}}),router[a0_0x400f44(0x163)]('/view_logs',auth,async(_0x1a3309,_0x26b9cc)=>{var _0x2c55b8=a0_0x400f44;try{const {username:_0x57c259,email:_0x34db92,role:_0x593d44}=_0x1a3309['user'],_0x37ced8=_0x1a3309[_0x2c55b8(0xed)],_0x178e64=await profile[_0x2c55b8(0x135)]({'email':_0x37ced8['email']}),_0x27ce59=await master_shop[_0x2c55b8(0x101)]();let _0x1de4ff;if(_0x37ced8['role']=='staff'){const _0x58419f=await staff[_0x2c55b8(0x135)]({'email':_0x37ced8[_0x2c55b8(0x169)]});_0x1de4ff=await warehouse[_0x2c55b8(0x101)]({'status':_0x2c55b8(0x136),'name':_0x58419f[_0x2c55b8(0x165)]});}else _0x1de4ff=await warehouse[_0x2c55b8(0x101)]({'status':_0x2c55b8(0x136)});const _0x38b873=await product[_0x2c55b8(0x101)]();let _0x1e37a5;if(_0x37ced8[_0x2c55b8(0x148)]=='staff'){const _0x22c6cd=await staff[_0x2c55b8(0x135)]({'email':_0x37ced8[_0x2c55b8(0x169)]});_0x1e37a5=await adjustment_finished['find']({'warehouse_name':_0x22c6cd['warehouse']});}else _0x1e37a5=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':'logs'}},{'$unwind':_0x2c55b8(0x11a)},{'$group':{'_id':_0x2c55b8(0x134),'invoice':{'$first':_0x2c55b8(0x14f)},'date':{'$first':_0x2c55b8(0xfd)},'warehouse_name':{'$first':_0x2c55b8(0x157)},'room':{'$addToSet':_0x2c55b8(0xff)},'finalize':{'$first':_0x2c55b8(0xf3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x27ce59[0x0][_0x2c55b8(0xd9)]==_0x2c55b8(0xe8))var _0x27d8c3=users[_0x2c55b8(0xdc)];else{if(_0x27ce59[0x0]['language']==_0x2c55b8(0x112))var _0x27d8c3=users[_0x2c55b8(0x112)];else{if(_0x27ce59[0x0][_0x2c55b8(0xd9)]=='German')var _0x27d8c3=users[_0x2c55b8(0x15b)];else{if(_0x27ce59[0x0][_0x2c55b8(0xd9)]==_0x2c55b8(0xe1))var _0x27d8c3=users[_0x2c55b8(0xe1)];else{if(_0x27ce59[0x0]['language']==_0x2c55b8(0xd3))var _0x27d8c3=users['French'];else{if(_0x27ce59[0x0][_0x2c55b8(0xd9)]==_0x2c55b8(0xea))var _0x27d8c3=users[_0x2c55b8(0xfb)];else{if(_0x27ce59[0x0][_0x2c55b8(0xd9)]==_0x2c55b8(0x125))var _0x27d8c3=users['Chinese'];else{if(_0x27ce59[0x0][_0x2c55b8(0xd9)]=='Arabic\x20(ae)')var _0x27d8c3=users[_0x2c55b8(0x154)];}}}}}}}_0x26b9cc[_0x2c55b8(0x124)](_0x2c55b8(0xd4),{'success':_0x1a3309[_0x2c55b8(0xe5)](_0x2c55b8(0x13f)),'errors':_0x1a3309[_0x2c55b8(0xe5)](_0x2c55b8(0x15c)),'role':_0x37ced8,'profile':_0x178e64,'warehouse':_0x1de4ff,'product':_0x38b873,'adjustment':_0x1e37a5,'master_shop':_0x27ce59,'language':_0x27d8c3});}catch(_0xa86afe){console[_0x2c55b8(0xd7)](_0xa86afe);}});function a0_0x41d8(_0x32b4c5,_0x57980c){var _0x4763e6=a0_0x4763();return a0_0x41d8=function(_0x41d83a,_0x25bcc3){_0x41d83a=_0x41d83a-0xc1;var _0xcb4ec5=_0x4763e6[_0x41d83a];return _0xcb4ec5;},a0_0x41d8(_0x32b4c5,_0x57980c);}function a0_0x4763(){var _0x2a6ef3=['</tr>','../public/language/languages.json','$product_details.secondary_code','product_details','$product_details.product_name','$product_details.floorlevel','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','room_names','$room','aggregate','post','adjustment_finished','$product_details.bay','invoice','/barcode_scanner','French','adjustment_finished_logs','secondary_unit','$product_details.maxProducts','log','424baRVuc','language','adjust_qty','$product_details.primary_code','English','<tr>','JO_number','own','Rooms','Spanish','toString','prod_cat','New_Qty_Converted','flash','/view/add_adjustment_logs','LOG-ADJ-','English\x20(US)','$product_details.expiry_date','Portuguese\x20(BR)','forEach','$product_details.production_date','user','product_code','Secondary_units','$product_details.invoice','../middleware/auth','then','$finalize','../models/all_models','True','ADJF-','adjustment\x20data\x20update\x20successfully','back','redirect','json','Portuguese','prod_name','$date','Primary_Units','$product.room_names','floor','find','8328861kZSAmd','/view','$product_details.storage','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.product_code','express','</td>','10RrzevS','/CheckingWarehouse','Enclosed','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','11249IGyjwD','stock','warehouse_name','product','$product_details','Hindi','ADJ-','new_adjust_qty','DRY\x20GOODS','padStart','New_Qty_Converted_adj','expiry_date','string','$product','stockBefore','Adjustment\x20Finalize\x20Successfully','/adjustment_finished/view','product_date','Arabic\x20(ae)','id_transaction_from','$product_details._id','$product_details.type','unit','render','Chinese','An\x20error\x20occurred.','$product_details.level','length','save','$product_details.unit','getFullYear','purchases_data','prod_code','master','message','product_stock','adjustment\x20add\x20successfull','1274592LuWJLg','edit_adjustment_finished','$_id','findOne','Enabled','batch_code','/adjustment_finished/preview/','product_name','random','2408aKnWvw','maxPerUnit','findById','$product_details.bin','success','error','filter','push','$product_details.maxPerUnit','$name','_id','catch','add','role','body','id_transaction','params','getMonth','production_date','1465lXNrkz','$invoice','354981fTADWu','$product_details.secondary_unit','prod_invoice','1133811qLXLuS','Arabic','Return\x20Rooms','minus','$warehouse_name','foreach\x20newproduct','level','map','German','errors','match','types','89820JCfbqZ','$product_details.rack','bay','slice','get','$product_details.batch_code','warehouse','all','staff','/adjustment/view','email','edit_adjustment_finished_view','room','$product_details.product_stock','$product.product_name','status'];a0_0x4763=function(){return _0x2a6ef3;};return a0_0x4763();}async function getRandom8DigitNumber(){var _0x4d68f2=a0_0x400f44;const _0x5cc267=0x989680,_0x2afd22=0x5f5e0ff,_0x1ca81e=Math[_0x4d68f2(0x100)](Math[_0x4d68f2(0x13a)]()*(_0x2afd22-_0x5cc267+0x1))+_0x5cc267;var _0x496cd9;const _0x32523a=await adjustment_finished[_0x4d68f2(0x135)]({'invoice':'ADJF-'+_0x1ca81e});return _0x32523a&&_0x32523a['length']>0x0?_0x496cd9=_0x4d68f2(0xf6)+_0x1ca81e:_0x496cd9=_0x4d68f2(0xf6)+_0x1ca81e,_0x496cd9;}router['get']('/view/add_adjustment',auth,async(_0x5e7aaa,_0x584433)=>{var _0x211e45=a0_0x400f44;try{const {username:_0x448969,email:_0x3dee79,role:_0x46fbf3}=_0x5e7aaa['user'],_0x16a3f6=_0x5e7aaa[_0x211e45(0xed)],_0x2195cf=await profile['findOne']({'email':_0x16a3f6[_0x211e45(0x169)]}),_0x57b341=await master_shop[_0x211e45(0x101)]();let _0x30379a;if(_0x16a3f6[_0x211e45(0x148)]==_0x211e45(0x167)){const _0x2af99c=await staff[_0x211e45(0x135)]({'email':_0x16a3f6['email']});_0x30379a=await warehouse[_0x211e45(0xcd)]([{'$match':{'status':'Enabled','name':_0x2af99c[_0x211e45(0x165)]}},{'$group':{'_id':_0x211e45(0x144),'name':{'$first':_0x211e45(0x144)}}}]);}else _0x30379a=await warehouse[_0x211e45(0xcd)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x19b2c8=await product[_0x211e45(0x101)]({}),_0x2c541b=await adjustment_finished[_0x211e45(0x101)](),_0xef51bf=_0x2c541b['length']+0x1,_0x4912d1=_0x211e45(0xf6)+_0xef51bf['toString']()[_0x211e45(0x116)](0x5,'0');var _0x32a89c=['Ambient',_0x211e45(0x10b),_0x211e45(0x155)];if(_0x57b341[0x0][_0x211e45(0xd9)]==_0x211e45(0xe8))var _0x1ed078=users[_0x211e45(0xdc)];else{if(_0x57b341[0x0]['language']=='Hindi')var _0x1ed078=users[_0x211e45(0x112)];else{if(_0x57b341[0x0][_0x211e45(0xd9)]==_0x211e45(0x15b))var _0x1ed078=users['German'];else{if(_0x57b341[0x0]['language']==_0x211e45(0xe1))var _0x1ed078=users[_0x211e45(0xe1)];else{if(_0x57b341[0x0]['language']==_0x211e45(0xd3))var _0x1ed078=users['French'];else{if(_0x57b341[0x0][_0x211e45(0xd9)]==_0x211e45(0xea))var _0x1ed078=users[_0x211e45(0xfb)];else{if(_0x57b341[0x0][_0x211e45(0xd9)]==_0x211e45(0x125))var _0x1ed078=users['Chinese'];else{if(_0x57b341[0x0]['language']=='Arabic\x20(ae)')var _0x1ed078=users[_0x211e45(0x154)];}}}}}}}const _0x1c778a=getRandom8DigitNumber();_0x1c778a[_0x211e45(0xf2)](_0x5bed7a=>{var _0x221651=_0x211e45;_0x584433[_0x221651(0x124)]('add_adjustment_finished',{'success':_0x5e7aaa[_0x221651(0xe5)]('success'),'errors':_0x5e7aaa['flash'](_0x221651(0x15c)),'role':_0x16a3f6,'profile':_0x2195cf,'warehouse':_0x30379a,'product':_0x19b2c8,'master_shop':_0x57b341,'language':_0x1ed078,'rooms_data':_0x32a89c,'invoice_no':_0x5bed7a});})[_0x211e45(0x146)](_0x59abce=>{var _0x1f134c=_0x211e45;_0x5e7aaa[_0x1f134c(0xe5)](_0x1f134c(0x15c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x584433[_0x1f134c(0xf9)](_0x1f134c(0x168));});}catch(_0xc26f42){console[_0x211e45(0xd7)](_0xc26f42);}}),router['post']('/view/add_adjustment',auth,async(_0x4a27b0,_0x57d046)=>{var _0x2fad34=a0_0x400f44;try{const {warehouse_name:_0x38990f,date:_0x34663a,prod_name:_0xdd7747,level:_0x103edf,isle:_0x15630e,pallet:_0x4cc513,stock:_0x5397cd,types:_0x417975,adjust_qty:_0xc3d3ad,new_adjust_qty:_0x27d355,note:_0x38e8cb,Room_name:_0x534f67,JO_number:_0x3b36db,expiry_date:_0x38f23d,PO_number:_0x382cf5,ReqBy:_0x1a477f,dateofreq:_0x376ac5,typeservicesData:_0x34bec3,destination:_0x4153e4,deliverydate:_0x5b7a56,driver:_0x2d1615,plate:_0x469616,van:_0x4169d3,DRSI:_0xb6621a,typevehicle:_0x588e17,TSU:_0x951b13,TFU:_0x17566e}=_0x4a27b0[_0x2fad34(0x149)];if(typeof _0xdd7747==_0x2fad34(0x119))var _0x1c5f28=[_0x4a27b0[_0x2fad34(0x149)]['prod_name']],_0x1d1ac1=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x159)]],_0x14cd28=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x10e)]],_0x193b18=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x15e)]],_0x121f06=[_0x4a27b0[_0x2fad34(0x149)]['New_Qty_Converted_adj']],_0x143228=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xe4)]],_0x587ade=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xfe)]],_0x2e0ed7=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xef)]],_0x1a807d=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x12d)]],_0x1f49f3=[_0x4a27b0[_0x2fad34(0x149)]['batch_code']],_0x3793d9=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x118)]],_0x3665b0=[_0x4a27b0['body'][_0x2fad34(0x11e)]],_0x359f9d=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xe3)]],_0x1bf60a=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xe0)]],_0x349c5e=[_0x4a27b0['body'][_0x2fad34(0x13c)]],_0x3d48ab=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x152)]],_0x4dacbd=[_0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x120)]];else var _0x1c5f28=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xfc)]],_0x1d1ac1=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x159)]],_0x14cd28=[..._0x4a27b0['body']['stock']],_0x193b18=[..._0x4a27b0['body'][_0x2fad34(0x15e)]],_0x121f06=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x117)]],_0x143228=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xe4)]],_0x587ade=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xfe)]],_0x2e0ed7=[..._0x4a27b0['body'][_0x2fad34(0xef)]],_0x1a807d=[..._0x4a27b0['body'][_0x2fad34(0x12d)]],_0x1f49f3=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x137)]],_0x3793d9=[..._0x4a27b0[_0x2fad34(0x149)]['expiry_date']],_0x3665b0=[..._0x4a27b0[_0x2fad34(0x149)]['product_date']],_0x359f9d=[..._0x4a27b0['body'][_0x2fad34(0xe3)]],_0x1bf60a=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0xe0)]],_0x349c5e=[..._0x4a27b0[_0x2fad34(0x149)][_0x2fad34(0x13c)]],_0x3d48ab=[..._0x4a27b0['body'][_0x2fad34(0x152)]],_0x4dacbd=[..._0x4a27b0[_0x2fad34(0x149)]['id_transaction_from']];const _0x37c509=_0x1c5f28[_0x2fad34(0x15a)](_0x4109ca=>{return _0x4109ca={'product_name':_0x4109ca};});_0x1d1ac1['forEach']((_0x1d882f,_0x54eb7f)=>{var _0x3c4de2=_0x2fad34,_0x30a3de=_0x1d882f[_0x3c4de2(0x15d)](/[A-Za-z]+/)[0x0],_0x2a1e4c=parseInt(_0x1d882f[_0x3c4de2(0x15d)](/\d+/)[0x0]);_0x37c509[_0x54eb7f][_0x3c4de2(0x159)]=_0x30a3de,_0x37c509[_0x54eb7f]['bay']=_0x2a1e4c;}),_0x4dacbd[_0x2fad34(0xeb)]((_0x5f28b2,_0xe44c7b)=>{var _0x433354=_0x2fad34;_0x37c509[_0xe44c7b][_0x433354(0x14a)]=_0x5f28b2;}),_0x14cd28['forEach']((_0x3813e9,_0x23abcc)=>{_0x37c509[_0x23abcc]['stockBefore']=_0x3813e9;}),_0x193b18[_0x2fad34(0xeb)]((_0x10166a,_0x327e36)=>{_0x37c509[_0x327e36]['types']=_0x10166a;}),_0x121f06[_0x2fad34(0xeb)]((_0x2c056c,_0x11d3a3)=>{var _0x1d7ea8=_0x2fad34;_0x37c509[_0x11d3a3][_0x1d7ea8(0xda)]=_0x2c056c;}),_0x143228[_0x2fad34(0xeb)]((_0x28aa7b,_0x17d2e6)=>{var _0x5aca17=_0x2fad34;_0x37c509[_0x17d2e6][_0x5aca17(0x114)]=_0x28aa7b;}),_0x587ade[_0x2fad34(0xeb)]((_0x244cff,_0x1921a3)=>{var _0x1777f9=_0x2fad34;_0x37c509[_0x1921a3][_0x1777f9(0x123)]=_0x244cff;}),_0x2e0ed7[_0x2fad34(0xeb)]((_0x3eae8b,_0xa05f30)=>{_0x37c509[_0xa05f30]['secondary_unit']=_0x3eae8b;}),_0x1a807d['forEach']((_0x22b3f1,_0x26c680)=>{_0x37c509[_0x26c680]['product_code']=_0x22b3f1;}),_0x1f49f3[_0x2fad34(0xeb)]((_0x36e71e,_0x709069)=>{var _0x4d9107=_0x2fad34;_0x37c509[_0x709069][_0x4d9107(0x137)]=_0x36e71e;}),_0x3793d9['forEach']((_0x46a070,_0x1d1a61)=>{_0x37c509[_0x1d1a61]['expiry_date']=_0x46a070;}),_0x3665b0['forEach']((_0x4c9315,_0x50ed1f)=>{var _0x46e5ec=_0x2fad34;_0x37c509[_0x50ed1f][_0x46e5ec(0x14d)]=_0x4c9315;}),_0x359f9d[_0x2fad34(0xeb)]((_0x5b1064,_0x3ba4d7)=>{var _0x43ff43=_0x2fad34;_0x37c509[_0x3ba4d7][_0x43ff43(0xe3)]=_0x5b1064;}),_0x1bf60a[_0x2fad34(0xeb)]((_0x459a10,_0x46d907)=>{var _0x1a9f99=_0x2fad34;_0x37c509[_0x46d907][_0x1a9f99(0xcb)]=_0x459a10;}),_0x349c5e['forEach']((_0x2f83cc,_0x4b3b01)=>{var _0x5482b2=_0x2fad34;_0x37c509[_0x4b3b01][_0x5482b2(0x13c)]=_0x2f83cc;}),_0x3d48ab['forEach']((_0x5af13b,_0x5dce08)=>{var _0xaf91d7=_0x2fad34;_0x37c509[_0x5dce08][_0xaf91d7(0xd1)]=_0x5af13b;});const _0x13e826=_0x37c509[_0x2fad34(0x141)](_0x4d0df3=>_0x4d0df3[_0x2fad34(0xda)]!=='0'&&_0x4d0df3[_0x2fad34(0xda)]!=='');var _0x1d4ef0=0x0;_0x13e826[_0x2fad34(0xeb)](_0x248966=>{var _0x372cdb=_0x2fad34;console[_0x372cdb(0xd7)](_0x372cdb(0x158),_0x248966),parseInt(_0x248966[_0x372cdb(0xda)])<=0x0&&_0x1d4ef0++;});if(_0x1d4ef0!=0x0)return _0x4a27b0['flash'](_0x2fad34(0x15c),_0x2fad34(0x10c)),_0x57d046[_0x2fad34(0xf9)](_0x2fad34(0xf8));const _0xeee488=new invoice_for_adjustment();await _0xeee488[_0x2fad34(0x129)]();const _0x3558e1=new adjustment_finished({'warehouse_name':_0x38990f,'date':_0x34663a,'product':_0x13e826,'note':_0x38e8cb,'room':_0x534f67,'invoice':_0x2fad34(0x113)+_0xeee488['invoice_init']['toString']()[_0x2fad34(0x116)](0x8,'0'),'JO_number':_0x3b36db,'expiry_date':_0x38f23d,'PO_number':_0x382cf5,'RequestedBy':_0x1a477f,'DateofRequest':_0x376ac5,'typeservices':_0x34bec3,'destination':_0x4153e4,'deliverydate':_0x5b7a56,'driver':_0x2d1615,'plate':_0x469616,'van':_0x4169d3,'DRSI':_0xb6621a,'typevehicle':_0x588e17,'TSU':_0x951b13,'TFU':_0x17566e}),_0x3ae15a=await _0x3558e1[_0x2fad34(0x129)]();_0x4a27b0[_0x2fad34(0xe5)]('success',_0x2fad34(0x131)),_0x57d046[_0x2fad34(0xf9)]('/adjustment_finished/preview/'+_0x3ae15a['_id']);}catch(_0x26a978){console[_0x2fad34(0xd7)](_0x26a978),_0x57d046[_0x2fad34(0xc3)](0xc8)['json']({'message':_0x26a978[_0x2fad34(0x12f)]});}}),router[a0_0x400f44(0x163)]('/view/add_adjustment_logs',auth,async(_0x179f7a,_0x186771)=>{var _0x30e7df=a0_0x400f44;try{const {username:_0x5e1059,email:_0x23a414,role:_0x10c618}=_0x179f7a[_0x30e7df(0xed)],_0x568f6c=_0x179f7a[_0x30e7df(0xed)],_0x573963=await profile[_0x30e7df(0x135)]({'email':_0x568f6c[_0x30e7df(0x169)]}),_0x3107b3=await master_shop[_0x30e7df(0x101)]();let _0x1e1bd4;if(_0x568f6c[_0x30e7df(0x148)]=='staff'){const _0x477cbf=await staff[_0x30e7df(0x135)]({'email':_0x568f6c[_0x30e7df(0x169)]});_0x1e1bd4=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x477cbf[_0x30e7df(0x165)]}},{'$group':{'_id':_0x30e7df(0x144),'name':{'$first':_0x30e7df(0x144)}}}]);}else _0x1e1bd4=await warehouse[_0x30e7df(0xcd)]([{'$match':{'status':_0x30e7df(0x136)}},{'$group':{'_id':_0x30e7df(0x144),'name':{'$first':_0x30e7df(0x144)}}}]);const _0x58b598=await product[_0x30e7df(0x101)](),_0x3b253d=await adjustment_finished[_0x30e7df(0x101)](),_0x491446=_0x3b253d['length']+0x1,_0x320909=_0x30e7df(0xf6)+_0x491446[_0x30e7df(0xe2)]()[_0x30e7df(0x116)](0x5,'0');var _0x252075=['Ambient',_0x30e7df(0x10b),'Return\x20Rooms'];if(_0x3107b3[0x0][_0x30e7df(0xd9)]==_0x30e7df(0xe8))var _0x4dcb42=users[_0x30e7df(0xdc)];else{if(_0x3107b3[0x0][_0x30e7df(0xd9)]==_0x30e7df(0x112))var _0x4dcb42=users[_0x30e7df(0x112)];else{if(_0x3107b3[0x0][_0x30e7df(0xd9)]==_0x30e7df(0x15b))var _0x4dcb42=users['German'];else{if(_0x3107b3[0x0]['language']==_0x30e7df(0xe1))var _0x4dcb42=users[_0x30e7df(0xe1)];else{if(_0x3107b3[0x0][_0x30e7df(0xd9)]=='French')var _0x4dcb42=users['French'];else{if(_0x3107b3[0x0][_0x30e7df(0xd9)]==_0x30e7df(0xea))var _0x4dcb42=users['Portuguese'];else{if(_0x3107b3[0x0][_0x30e7df(0xd9)]==_0x30e7df(0x125))var _0x4dcb42=users[_0x30e7df(0x125)];else{if(_0x3107b3[0x0][_0x30e7df(0xd9)]==_0x30e7df(0x11f))var _0x4dcb42=users[_0x30e7df(0x154)];}}}}}}}const _0x1582d5=getRandom8DigitNumber();_0x1582d5['then'](_0x501c31=>{var _0x3e0524=_0x30e7df;_0x186771[_0x3e0524(0x124)]('add_adjustment_finished_logs',{'success':_0x179f7a[_0x3e0524(0xe5)](_0x3e0524(0x13f)),'errors':_0x179f7a['flash'](_0x3e0524(0x15c)),'role':_0x568f6c,'profile':_0x573963,'warehouse':_0x1e1bd4,'product':_0x58b598,'master_shop':_0x3107b3,'language':_0x4dcb42,'rooms_data':_0x252075,'invoice_no':_0x501c31});})[_0x30e7df(0x146)](_0x84efc0=>{var _0x4be62a=_0x30e7df;_0x179f7a['flash'](_0x4be62a(0x15c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x186771['redirect'](_0x4be62a(0x168));});}catch(_0x586121){console[_0x30e7df(0xd7)](_0x586121);}}),router['post'](a0_0x400f44(0xe6),auth,async(_0x37a306,_0x1c410d)=>{var _0x281d44=a0_0x400f44;try{const {warehouse_name:_0x32eb1e,date:_0x1576a9,prod_name:_0x31aa31,level:_0x3b3a76,isle:_0xc7dc3c,pallet:_0x9eb088,stock:_0x35bf60,types:_0x3242ff,adjust_qty:_0x3d0123,new_adjust_qty:_0x3d6794,note:_0x51f2b0,Room_name:_0x4e14a7,JO_number:_0x3af68a,expiry_date:_0x2448b0,type_of_transaction:_0x4c38c5,PO_number:_0x287369,ReqBy:_0xedc074,dateofreq:_0x277c95,typeservicesData:_0x3857ea,destination:_0x3235ee,deliverydate:_0x1566e9,driver:_0x2ee640,plate:_0x49e570,van:_0x5d5787,DRSI:_0x166b4f,typevehicle:_0x33b8b5,TSU:_0x34735b,TFU:_0x3ff2e5}=_0x37a306[_0x281d44(0x149)];if(typeof _0x31aa31==_0x281d44(0x119))var _0x5a03cd=[_0x37a306[_0x281d44(0x149)][_0x281d44(0xfc)]],_0x43578e=[_0x37a306[_0x281d44(0x149)][_0x281d44(0x159)]],_0x3d895d=[_0x37a306[_0x281d44(0x149)]['stock']],_0x10e82f=[_0x37a306[_0x281d44(0x149)][_0x281d44(0x15e)]],_0x3a8e2e=[_0x37a306[_0x281d44(0x149)][_0x281d44(0x117)]],_0x285f8b=[_0x37a306[_0x281d44(0x149)][_0x281d44(0xe4)]],_0xe8843b=[_0x37a306['body'][_0x281d44(0xfe)]],_0x4458f4=[_0x37a306[_0x281d44(0x149)][_0x281d44(0xef)]],_0x18e55a=[_0x37a306[_0x281d44(0x149)]['prod_code']],_0x1b0b85=[_0x37a306[_0x281d44(0x149)][_0x281d44(0x137)]],_0x2829f8=[_0x37a306['body'][_0x281d44(0x118)]],_0x4a4066=[_0x37a306[_0x281d44(0x149)][_0x281d44(0x11e)]],_0x454dcc=[_0x37a306[_0x281d44(0x149)]['prod_cat']],_0x96d443=[_0x37a306[_0x281d44(0x149)]['Rooms']],_0x44d8f1=[_0x37a306['body'][_0x281d44(0x13c)]],_0x486859=[_0x37a306['body'][_0x281d44(0x152)]],_0x28139c=[_0x37a306[_0x281d44(0x149)]['id_transaction_from']];else var _0x5a03cd=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0xfc)]],_0x43578e=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x159)]],_0x3d895d=[..._0x37a306['body'][_0x281d44(0x10e)]],_0x10e82f=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x15e)]],_0x3a8e2e=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x117)]],_0x285f8b=[..._0x37a306[_0x281d44(0x149)]['New_Qty_Converted']],_0xe8843b=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0xfe)]],_0x4458f4=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0xef)]],_0x18e55a=[..._0x37a306['body']['prod_code']],_0x1b0b85=[..._0x37a306['body']['batch_code']],_0x2829f8=[..._0x37a306['body'][_0x281d44(0x118)]],_0x4a4066=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x11e)]],_0x454dcc=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0xe3)]],_0x96d443=[..._0x37a306['body'][_0x281d44(0xe0)]],_0x44d8f1=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x13c)]],_0x486859=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x152)]],_0x28139c=[..._0x37a306[_0x281d44(0x149)][_0x281d44(0x120)]];const _0x542e95=_0x5a03cd['map'](_0x371f76=>{return _0x371f76={'product_name':_0x371f76};});_0x43578e[_0x281d44(0xeb)]((_0x130915,_0x524884)=>{var _0x311d78=_0x281d44,_0x1883fd=_0x130915[_0x311d78(0x15d)](/[A-Za-z]+/)[0x0],_0x4707ab=parseInt(_0x130915[_0x311d78(0x15d)](/\d+/)[0x0]);_0x542e95[_0x524884][_0x311d78(0x159)]=_0x1883fd,_0x542e95[_0x524884]['bay']=_0x4707ab;}),_0x28139c[_0x281d44(0xeb)]((_0x441d28,_0x56d2fe)=>{_0x542e95[_0x56d2fe]['id_transaction']=_0x441d28;}),_0x3d895d['forEach']((_0x302e50,_0x224639)=>{var _0x555b3c=_0x281d44;_0x542e95[_0x224639][_0x555b3c(0x11b)]=_0x302e50;}),_0x10e82f[_0x281d44(0xeb)]((_0x3f1bf1,_0x518b52)=>{var _0x13ff15=_0x281d44;_0x542e95[_0x518b52][_0x13ff15(0x15e)]=_0x3f1bf1;}),_0x3a8e2e[_0x281d44(0xeb)]((_0x417d7c,_0x3e90ca)=>{var _0x7b3477=_0x281d44;_0x542e95[_0x3e90ca][_0x7b3477(0xda)]=_0x417d7c;}),_0x285f8b[_0x281d44(0xeb)]((_0x272dbb,_0x4b9dd5)=>{var _0x13f43b=_0x281d44;_0x542e95[_0x4b9dd5][_0x13f43b(0x114)]=_0x272dbb;}),_0xe8843b[_0x281d44(0xeb)]((_0xda318e,_0x944b4e)=>{var _0x52ce0b=_0x281d44;_0x542e95[_0x944b4e][_0x52ce0b(0x123)]=_0xda318e;}),_0x4458f4[_0x281d44(0xeb)]((_0x35904f,_0x15118c)=>{var _0x4b511d=_0x281d44;_0x542e95[_0x15118c][_0x4b511d(0xd5)]=_0x35904f;}),_0x18e55a['forEach']((_0x539b8f,_0x4ead54)=>{var _0x2eec86=_0x281d44;_0x542e95[_0x4ead54][_0x2eec86(0xee)]=_0x539b8f;}),_0x1b0b85[_0x281d44(0xeb)]((_0x489b05,_0x56da12)=>{var _0x1060ed=_0x281d44;_0x542e95[_0x56da12][_0x1060ed(0x137)]=_0x489b05;}),_0x2829f8[_0x281d44(0xeb)]((_0x5329cb,_0x2875f6)=>{var _0x534333=_0x281d44;_0x542e95[_0x2875f6][_0x534333(0x118)]=_0x5329cb;}),_0x4a4066[_0x281d44(0xeb)]((_0x3834f2,_0x248014)=>{var _0x1ae9e4=_0x281d44;_0x542e95[_0x248014][_0x1ae9e4(0x14d)]=_0x3834f2;}),_0x454dcc[_0x281d44(0xeb)]((_0x22e2d9,_0x3ff74d)=>{_0x542e95[_0x3ff74d]['prod_cat']=_0x22e2d9;}),_0x96d443[_0x281d44(0xeb)]((_0x3354cb,_0x3fe5b6)=>{_0x542e95[_0x3fe5b6]['room_names']=_0x3354cb;}),_0x44d8f1[_0x281d44(0xeb)]((_0x51d709,_0x423be9)=>{var _0x4d7747=_0x281d44;_0x542e95[_0x423be9][_0x4d7747(0x13c)]=_0x51d709;}),_0x486859['forEach']((_0x1657ca,_0x580d9b)=>{var _0x1de984=_0x281d44;_0x542e95[_0x580d9b][_0x1de984(0xd1)]=_0x1657ca;});const _0x5c4f26=_0x542e95[_0x281d44(0x141)](_0x3441f8=>_0x3441f8[_0x281d44(0xda)]!=='0'&&_0x3441f8[_0x281d44(0xda)]!=='');var _0x4a9ef7=0x0;_0x5c4f26[_0x281d44(0xeb)](_0x345333=>{var _0x626e57=_0x281d44;console[_0x626e57(0xd7)](_0x626e57(0x158),_0x345333),parseInt(_0x345333[_0x626e57(0xda)])<=0x0&&_0x4a9ef7++;});if(_0x4a9ef7!=0x0)return _0x37a306[_0x281d44(0xe5)]('errors',_0x281d44(0x10c)),_0x1c410d[_0x281d44(0xf9)](_0x281d44(0xf8));const _0x2cec0a=new adjustment_logs();await _0x2cec0a[_0x281d44(0x129)]();const _0x5a4e4c=new adjustment_finished({'warehouse_name':_0x32eb1e,'date':_0x1576a9,'product':_0x5c4f26,'note':_0x51f2b0,'room':_0x4e14a7,'invoice':_0x281d44(0xe7)+_0x2cec0a['invoice_init'][_0x281d44(0xe2)]()[_0x281d44(0x116)](0x8,'0'),'JO_number':_0x3af68a,'expiry_date':_0x2448b0,'type_of_transaction':_0x4c38c5,'PO_number':_0x287369,'RequestedBy':_0xedc074,'DateofRequest':_0x277c95,'typeservices':_0x3857ea,'destination':_0x3235ee,'deliverydate':_0x1566e9,'driver':_0x2ee640,'plate':_0x49e570,'van':_0x5d5787,'DRSI':_0x166b4f,'typevehicle':_0x33b8b5,'TSU':_0x34735b,'TFU':_0x3ff2e5}),_0x1424bf=await _0x5a4e4c[_0x281d44(0x129)]();_0x37a306['flash'](_0x281d44(0x13f),_0x281d44(0x131)),_0x1c410d['redirect'](_0x281d44(0x138)+_0x1424bf['_id']);}catch(_0x11666b){console[_0x281d44(0xd7)](_0x11666b),_0x1c410d['status'](0xc8)['json']({'message':_0x11666b['message']});}}),router['get']('/preview/:id',auth,async(_0x164bf4,_0x59e731)=>{var _0x88cece=a0_0x400f44;try{const {username:_0x32c4e9,email:_0x3f95a6,role:_0x3e6d85}=_0x164bf4[_0x88cece(0xed)],_0x212d0f=_0x164bf4[_0x88cece(0xed)],_0x1237bf=await profile[_0x88cece(0x135)]({'email':_0x212d0f[_0x88cece(0x169)]}),_0x58d482=await master_shop[_0x88cece(0x101)](),_0x276730=_0x164bf4[_0x88cece(0x14b)]['id'],_0x14cf69=await adjustment_finished[_0x88cece(0x13d)]({'_id':_0x276730}),_0x28c209=await purchases[_0x88cece(0xcd)]([{'$match':{'warehouse_name':_0x14cf69[_0x88cece(0x10f)]}},{'$unwind':'$product'},{'$group':{'_id':_0x88cece(0xc2)}}]);console[_0x88cece(0xd7)]('purchases_data',_0x28c209);const _0x51eebf=await product[_0x88cece(0x101)]({}),_0x21549b=await warehouse[_0x88cece(0xcd)]([{'$match':{'name':_0x14cf69[_0x88cece(0x10f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x88cece(0x121),'name':{'$first':_0x88cece(0xc8)},'product_stock':{'$first':_0x88cece(0xc1)},'bay':{'$first':_0x88cece(0xd0)},'bin':{'$first':_0x88cece(0x13e)},'type':{'$first':_0x88cece(0x122)},'floorlevel':{'$first':_0x88cece(0xc9)},'primary_code':{'$first':_0x88cece(0xdb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x88cece(0x106)},'storage':{'$first':_0x88cece(0x104)},'rack':{'$first':_0x88cece(0x160)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x88cece(0xec)},'batch_code':{'$first':_0x88cece(0x164)},'maxPerUnit':{'$first':_0x88cece(0x143)},'room':{'$first':_0x88cece(0xcc)}}}]);if(_0x58d482[0x0][_0x88cece(0xd9)]==_0x88cece(0xe8)){var _0x1b1342=users[_0x88cece(0xdc)];console[_0x88cece(0xd7)](_0x1b1342);}else{if(_0x58d482[0x0]['language']==_0x88cece(0x112))var _0x1b1342=users[_0x88cece(0x112)];else{if(_0x58d482[0x0]['language']=='German')var _0x1b1342=users[_0x88cece(0x15b)];else{if(_0x58d482[0x0]['language']==_0x88cece(0xe1))var _0x1b1342=users[_0x88cece(0xe1)];else{if(_0x58d482[0x0][_0x88cece(0xd9)]==_0x88cece(0xd3))var _0x1b1342=users[_0x88cece(0xd3)];else{if(_0x58d482[0x0][_0x88cece(0xd9)]==_0x88cece(0xea))var _0x1b1342=users[_0x88cece(0xfb)];else{if(_0x58d482[0x0]['language']=='Chinese')var _0x1b1342=users[_0x88cece(0x125)];else{if(_0x58d482[0x0][_0x88cece(0xd9)]==_0x88cece(0x11f))var _0x1b1342=users['Arabic'];}}}}}}}_0x59e731[_0x88cece(0x124)](_0x88cece(0x16a),{'success':_0x164bf4[_0x88cece(0xe5)](_0x88cece(0x13f)),'errors':_0x164bf4['flash'](_0x88cece(0x15c)),'role':_0x212d0f,'profile':_0x1237bf,'adjustment':_0x14cf69,'stock':_0x21549b,'master_shop':_0x58d482,'warehouse_name':_0x28c209,'unit':_0x51eebf,'language':_0x1b1342});}catch(_0x44df94){console['log'](_0x44df94),_0x59e731[_0x88cece(0xc3)](0xc8)['json']({'message':_0x44df94[_0x88cece(0x12f)]});}}),router[a0_0x400f44(0xce)]('/preview/:id',auth,async(_0xd9d4d1,_0x40c341)=>{var _0x4081b3=a0_0x400f44;try{const {invoice:_0x3bd820,warehouse_name:_0x4e63f4,Room_name:_0x5cf925}=_0xd9d4d1[_0x4081b3(0x149)],_0x5d999c=_0xd9d4d1[_0x4081b3(0x14b)]['id'],_0x18c7ac=await adjustment_finished[_0x4081b3(0x13d)]({'_id':_0x5d999c});var _0x14772d;const _0x2f0859=_0x18c7ac[_0x4081b3(0x110)][_0x4081b3(0x15a)](async _0x46087c=>{var _0x5c09b9=_0x4081b3;if(_0x46087c['adjust_qty']>0x0){_0x14772d=await warehouse[_0x5c09b9(0x135)]({'name':_0x4e63f4,'room':_0x46087c['room_names']});const _0x55c0a6=_0x14772d[_0x5c09b9(0xc7)]['map'](_0xf71065=>{var _0x56750e=_0x5c09b9;console[_0x56750e(0xd7)](_0x46087c[_0x56750e(0x15e)]);if(_0x46087c[_0x56750e(0x15e)]==_0x56750e(0x156))_0xf71065['_id']==_0x46087c[_0x56750e(0x14a)]&&(_0xf71065[_0x56750e(0x130)]=_0xf71065['product_stock']-_0x46087c[_0x56750e(0xda)]);else _0x46087c[_0x56750e(0x15e)]==_0x56750e(0x147)&&(_0xf71065['_id']==_0x46087c[_0x56750e(0x14a)]&&(_0xf71065[_0x56750e(0x130)]=_0xf71065['product_stock']+_0x46087c[_0x56750e(0xda)]));});}return _0x14772d;});Promise['all'](_0x2f0859)[_0x4081b3(0xf2)](async _0x864ab2=>{var _0x5a126c=_0x4081b3;try{for(const _0x192cd8 of _0x864ab2){await _0x192cd8['save']();}_0x18c7ac['finalize']=_0x5a126c(0xf5);const _0x54efa3=await _0x18c7ac['save'](),_0x48926f=await master_shop[_0x5a126c(0x101)](),_0x43354e=await email_settings['findOne'](),_0x4a8a59=await supervisor_settings['find']();var _0xfb6578=_0x18c7ac['product'],_0x46cd2b='',_0x3d7a97;for(_0x3d7a97 in _0xfb6578){var _0x298a53='FG';_0x18c7ac['warehouse_name']==_0x5a126c(0x115)&&(_0x298a53='DG'),_0x46cd2b+=_0x5a126c(0xdd)+_0x5a126c(0xca)+_0xfb6578[_0x3d7a97]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xfb6578[_0x3d7a97]['product_code']+'</td>'+_0x5a126c(0xca)+_0xfb6578[_0x3d7a97][_0x5a126c(0xda)]+_0x5a126c(0x108)+_0x5a126c(0xca)+_0xfb6578[_0x3d7a97][_0x5a126c(0x123)]+_0x5a126c(0x108)+_0x5a126c(0xca)+_0xfb6578[_0x3d7a97][_0x5a126c(0xd5)]+_0x5a126c(0x108)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x18c7ac[_0x5a126c(0x10f)]+_0x5a126c(0x108)+_0x5a126c(0xca)+_0xfb6578[_0x3d7a97][_0x5a126c(0xcb)]+_0x5a126c(0x108)+_0x5a126c(0xca)+_0x298a53+_0xfb6578[_0x3d7a97][_0x5a126c(0x161)]+_0x5a126c(0x108)+_0x5a126c(0xc4);}_0xd9d4d1[_0x5a126c(0xe5)](_0x5a126c(0x13f),_0x5a126c(0x11c)),_0x40c341[_0x5a126c(0xf9)]('/picking_list/PDF_adjustmentFinal/'+_0x54efa3[_0x5a126c(0x145)]);}catch(_0x37fccd){console[_0x5a126c(0x140)](_0x37fccd),_0x40c341[_0x5a126c(0xc3)](0x1f4)[_0x5a126c(0xfa)]({'error':_0x5a126c(0x105)});}})['catch'](_0x4b6d0b=>{var _0x3e3584=_0x4081b3;console[_0x3e3584(0x140)](_0x4b6d0b),_0x40c341[_0x3e3584(0xc3)](0x1f4)[_0x3e3584(0xfa)]({'error':_0x3e3584(0x126)});});}catch(_0x1c63fe){_0x40c341[_0x4081b3(0xfa)]({'message':_0x1c63fe['message']});}}),router['get']('/view/:id',auth,async(_0x431eea,_0x2d25c4)=>{var _0x1e5c88=a0_0x400f44;try{const {username:_0x3a5ede,email:_0x21bebc,role:_0x5647cf}=_0x431eea['user'],_0x54b73c=_0x431eea[_0x1e5c88(0xed)],_0x277a74=await profile[_0x1e5c88(0x135)]({'email':_0x54b73c[_0x1e5c88(0x169)]}),_0x53b3c1=await master_shop['find']();console[_0x1e5c88(0xd7)](_0x1e5c88(0x12e),_0x53b3c1);const _0x3bdc19=_0x431eea[_0x1e5c88(0x14b)]['id'],_0x3e457f=await adjustment_finished[_0x1e5c88(0x13d)]({'_id':_0x3bdc19});let _0xc98973=new Date(_0x3e457f[_0x1e5c88(0x118)]),_0xb1b24=('0'+_0xc98973['getDate']())[_0x1e5c88(0x162)](-0x2),_0x3f1bb3=('0'+(_0xc98973[_0x1e5c88(0x14c)]()+0x1))[_0x1e5c88(0x162)](-0x2),_0x17d040=_0xc98973[_0x1e5c88(0x12b)](),_0x153fcf=_0x17d040+'-'+_0x3f1bb3+'-'+_0xb1b24;var _0x3fefe6=['Ambient',_0x1e5c88(0x10b),'Return\x20Rooms'];const _0x60d0f5=await purchases[_0x1e5c88(0xcd)]([{'$match':{'warehouse_name':_0x3e457f['warehouse_name']}},{'$unwind':_0x1e5c88(0x11a)},{'$group':{'_id':'$product.product_name'}}]);console[_0x1e5c88(0xd7)](_0x1e5c88(0x12c),_0x60d0f5);const _0x41342b=await product[_0x1e5c88(0x101)]({}),_0x549044=await warehouse[_0x1e5c88(0xcd)]([{'$match':{'name':_0x3e457f['warehouse_name'],'room':_0x3e457f[_0x1e5c88(0x16b)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1e5c88(0x121),'name':{'$first':_0x1e5c88(0xc8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1e5c88(0xd0)},'bin':{'$first':_0x1e5c88(0x13e)},'type':{'$first':_0x1e5c88(0x122)},'floorlevel':{'$first':_0x1e5c88(0xc9)},'primary_code':{'$first':_0x1e5c88(0xdb)},'secondary_code':{'$first':_0x1e5c88(0xc6)},'product_code':{'$first':_0x1e5c88(0x106)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1e5c88(0x160)}}}]);if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0xe8)){var _0xc980a3=users['English'];console[_0x1e5c88(0xd7)](_0xc980a3);}else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0x112))var _0xc980a3=users['Hindi'];else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]=='German')var _0xc980a3=users[_0x1e5c88(0x15b)];else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0xe1))var _0xc980a3=users['Spanish'];else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0xd3))var _0xc980a3=users[_0x1e5c88(0xd3)];else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0xea))var _0xc980a3=users[_0x1e5c88(0xfb)];else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0x125))var _0xc980a3=users[_0x1e5c88(0x125)];else{if(_0x53b3c1[0x0][_0x1e5c88(0xd9)]==_0x1e5c88(0x11f))var _0xc980a3=users[_0x1e5c88(0x154)];}}}}}}}_0x2d25c4['render'](_0x1e5c88(0x133),{'success':_0x431eea['flash'](_0x1e5c88(0x13f)),'errors':_0x431eea[_0x1e5c88(0xe5)](_0x1e5c88(0x15c)),'role':_0x54b73c,'profile':_0x277a74,'adjustment':_0x3e457f,'stock':_0x549044,'master_shop':_0x53b3c1,'warehouse_name':_0x60d0f5,'unit':_0x41342b,'language':_0xc980a3,'rooms_data':_0x3fefe6,'ed_fullDate':_0x153fcf});}catch(_0x16ec5e){console[_0x1e5c88(0xd7)](_0x16ec5e),_0x2d25c4[_0x1e5c88(0xc3)](0xc8)['json']({'message':_0x16ec5e['message']});}}),router[a0_0x400f44(0xce)]('/view/:id',auth,async(_0x47421d,_0xfaee49)=>{var _0x23f29a=a0_0x400f44;try{const _0x33b417=_0x47421d[_0x23f29a(0x14b)]['id'],_0x59c136=await adjustment_finished[_0x23f29a(0x13d)]({'_id':_0x33b417}),_0x497ba2=await warehouse[_0x23f29a(0x135)]({'name':_0x59c136[_0x23f29a(0x10f)],'room':_0x59c136[_0x23f29a(0x16b)]}),{warehouse_name:_0x2ef86f,date:_0x39c013,prod_name:_0xde535e,level:_0x2b8274,isle:_0x161f33,pallet:_0x5cd62d,stock:_0xd6acd6,types:_0x2e79e4,adjust_qty:_0x3c96a2,new_adjust_qty:_0x1f3e8a,note:_0x351d9a,Room_name:_0x1331bc,invoice:_0x4b4688,JO_number:_0x2d7396}=_0x47421d['body'];if(typeof _0xde535e=='string')var _0x45b817=[_0x47421d['body']['prod_name']],_0x18e2bb=[_0x47421d['body'][_0x23f29a(0x159)]],_0x42d0db=[_0x47421d[_0x23f29a(0x149)][_0x23f29a(0x10e)]],_0x1b1299=[_0x47421d[_0x23f29a(0x149)][_0x23f29a(0x15e)]],_0x5daaee=[_0x47421d[_0x23f29a(0x149)][_0x23f29a(0xda)]],_0x4907c2=[_0x47421d['body']['new_adjust_qty']],_0x1d5e03=[_0x47421d[_0x23f29a(0x149)]['prod_code']],_0x138027=[_0x47421d[_0x23f29a(0x149)]['unit']],_0x561948=[_0x47421d[_0x23f29a(0x149)][_0x23f29a(0xef)]],_0x39ca70=[_0x47421d[_0x23f29a(0x149)][_0x23f29a(0x137)]],_0x1f6308=[_0x47421d[_0x23f29a(0x149)]['expiry_date']];else var _0x45b817=[..._0x47421d['body'][_0x23f29a(0xfc)]],_0x18e2bb=[..._0x47421d[_0x23f29a(0x149)][_0x23f29a(0x159)]],_0x42d0db=[..._0x47421d[_0x23f29a(0x149)]['stock']],_0x1b1299=[..._0x47421d[_0x23f29a(0x149)][_0x23f29a(0x15e)]],_0x5daaee=[..._0x47421d['body'][_0x23f29a(0xda)]],_0x4907c2=[..._0x47421d[_0x23f29a(0x149)]['new_adjust_qty']],_0x1d5e03=[..._0x47421d[_0x23f29a(0x149)][_0x23f29a(0x12d)]],_0x138027=[..._0x47421d[_0x23f29a(0x149)][_0x23f29a(0x123)]],_0x561948=[..._0x47421d[_0x23f29a(0x149)][_0x23f29a(0xef)]],_0x39ca70=[..._0x47421d['body'][_0x23f29a(0x137)]],_0x1f6308=[..._0x47421d[_0x23f29a(0x149)][_0x23f29a(0x118)]];const _0x356091=_0x45b817[_0x23f29a(0x15a)](_0x5eacc1=>{return _0x5eacc1={'product_name':_0x5eacc1};});_0x18e2bb['forEach']((_0xfae4ce,_0x2ad356)=>{var _0x4280f7=_0x23f29a;_0x356091[_0x2ad356][_0x4280f7(0x161)]=_0xfae4ce;}),_0x42d0db[_0x23f29a(0xeb)]((_0x440536,_0x467a63)=>{var _0x54cc1e=_0x23f29a;_0x356091[_0x467a63][_0x54cc1e(0x11b)]=_0x440536;}),_0x1b1299[_0x23f29a(0xeb)]((_0x5e2b34,_0x30d188)=>{var _0x3f478c=_0x23f29a;_0x356091[_0x30d188][_0x3f478c(0x15e)]=_0x5e2b34;}),_0x5daaee['forEach']((_0x1a6773,_0x319f3e)=>{var _0x37e0f9=_0x23f29a;_0x356091[_0x319f3e][_0x37e0f9(0xda)]=_0x1a6773;}),_0x4907c2['forEach']((_0x5c6fb3,_0xff7e72)=>{var _0x493f70=_0x23f29a;_0x356091[_0xff7e72][_0x493f70(0x114)]=_0x5c6fb3;}),_0x138027['forEach']((_0x4a998e,_0x214c0f)=>{var _0xf47dc8=_0x23f29a;_0x356091[_0x214c0f][_0xf47dc8(0x123)]=_0x4a998e;}),_0x561948['forEach']((_0x380707,_0x1e2b83)=>{var _0x50a493=_0x23f29a;_0x356091[_0x1e2b83][_0x50a493(0xd5)]=_0x380707;}),_0x1d5e03[_0x23f29a(0xeb)]((_0x2d4813,_0x177f15)=>{var _0x5386ce=_0x23f29a;_0x356091[_0x177f15][_0x5386ce(0xee)]=_0x2d4813;}),_0x39ca70[_0x23f29a(0xeb)]((_0xfbe12c,_0x203637)=>{var _0x314b41=_0x23f29a;_0x356091[_0x203637][_0x314b41(0x137)]=_0xfbe12c;}),_0x1f6308[_0x23f29a(0xeb)]((_0x51f7b8,_0x4f5470)=>{_0x356091[_0x4f5470]['expiry_date']=_0x51f7b8;});const _0x46d43c=_0x356091[_0x23f29a(0x141)](_0x583289=>_0x583289[_0x23f29a(0xda)]!=='0'&&_0x583289[_0x23f29a(0xda)]!=='');var _0x4bb386=0x0;_0x46d43c[_0x23f29a(0xeb)](_0x28bd17=>{var _0x166932=_0x23f29a;console[_0x166932(0xd7)](_0x166932(0x158),_0x28bd17),parseInt(_0x28bd17['adjust_qty'])<=0x0&&_0x4bb386++;});if(_0x4bb386!=0x0)return _0x47421d[_0x23f29a(0xe5)](_0x23f29a(0x15c),_0x23f29a(0x10c)),_0xfaee49[_0x23f29a(0xf9)](_0x23f29a(0xf8));_0x59c136[_0x23f29a(0x10f)]=_0x2ef86f,_0x59c136['date']=_0x39c013,_0x59c136['product']=_0x46d43c,_0x59c136['note']=_0x351d9a,_0x59c136[_0x23f29a(0x16b)]=_0x1331bc,_0x59c136[_0x23f29a(0xd1)]=_0x4b4688,_0x59c136[_0x23f29a(0xde)]=_0x2d7396;const _0x4e86b4=await _0x59c136[_0x23f29a(0x129)](),_0x3e5220=await warehouse['findOne']({'name':_0x2ef86f,'room':_0x1331bc});_0x4e86b4['product'][_0x23f29a(0xeb)](_0x168a55=>{var _0x53b6f1=_0x23f29a;const _0x421010=_0x3e5220[_0x53b6f1(0xc7)][_0x53b6f1(0x15a)](_0xd770b2=>{var _0x3d1573=_0x53b6f1;_0x168a55[_0x3d1573(0x15e)]==_0x3d1573(0x156)?_0xd770b2[_0x3d1573(0x139)]==_0x168a55['product_name']&&_0xd770b2[_0x3d1573(0x161)]==_0x168a55[_0x3d1573(0x161)]&&(_0xd770b2[_0x3d1573(0x130)]=parseInt(_0xd770b2[_0x3d1573(0x130)])-parseInt(_0x168a55['adjust_qty'])):_0xd770b2[_0x3d1573(0x139)]==_0x168a55['product_name']&&_0xd770b2[_0x3d1573(0x161)]==_0x168a55[_0x3d1573(0x161)]&&(_0xd770b2[_0x3d1573(0x130)]=parseInt(_0xd770b2[_0x3d1573(0x130)])+parseInt(_0x168a55['adjust_qty']));});}),await _0x3e5220['save'](),_0x47421d[_0x23f29a(0xe5)](_0x23f29a(0x13f),_0x23f29a(0xf7)),_0xfaee49[_0x23f29a(0xf9)](_0x23f29a(0x11d));}catch(_0x21ab31){console[_0x23f29a(0xd7)](_0x21ab31);}}),router[a0_0x400f44(0xce)](a0_0x400f44(0xd2),async(_0x4b1a27,_0x165c31)=>{var _0x297dbd=a0_0x400f44;const {primary_code:_0x1a9e12,warehouse_data:_0xd5bc77,rooms_data:_0x2c622d,Roomslist:_0x1f09a2}=_0x4b1a27[_0x297dbd(0x149)],_0x75ccab=_0x1f09a2['split'](','),_0x2c7ea0=[];async function _0x3f72e3(_0xa85d2){var _0x437472=_0x297dbd;const _0x4a20b5=await warehouse[_0x437472(0xcd)]([{'$match':{'name':_0xd5bc77,'room':_0xa85d2}},{'$unwind':_0x437472(0x111)},{'$match':{'product_details.primary_code':_0x1a9e12}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x437472(0xc8)},'product_stock':{'$first':_0x437472(0xc1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x437472(0x106)},'level':{'$first':_0x437472(0x127)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x437472(0x122)},'pallet':{'$first':_0x437472(0xc9)},'unit':{'$first':_0x437472(0x12a)},'secondary_unit':{'$first':_0x437472(0x151)},'storage':{'$first':_0x437472(0x104)},'rack':{'$first':_0x437472(0x160)},'expiry_date':{'$first':_0x437472(0xe9)},'production_date':{'$first':_0x437472(0xec)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x437472(0x143)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x437472(0xf0)}}}]),_0xf0090e=await warehouse[_0x437472(0xcd)]([{'$match':{'name':_0xd5bc77,'room':_0xa85d2}},{'$unwind':_0x437472(0x111)},{'$match':{'product_details.secondary_code':_0x1a9e12}},{'$group':{'_id':_0x437472(0x121),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x437472(0xc1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x437472(0x106)},'level':{'$first':_0x437472(0x127)},'bay':{'$first':_0x437472(0xd0)},'type':{'$first':_0x437472(0x122)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x437472(0x12a)},'secondary_unit':{'$first':_0x437472(0x151)},'storage':{'$first':_0x437472(0x104)},'rack':{'$first':_0x437472(0x160)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x437472(0xec)},'batch_code':{'$first':_0x437472(0x164)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x437472(0xf0)}}}]);if(_0x4a20b5[_0x437472(0x128)]>0x0)_0x2c7ea0[_0x437472(0x142)](_0x4a20b5);else _0xf0090e[_0x437472(0x128)]>0x0&&_0x2c7ea0['push'](_0xf0090e);}const _0x30dd78=_0x75ccab[_0x297dbd(0x15a)](_0x3ca9c5=>_0x3f72e3(_0x3ca9c5));await Promise[_0x297dbd(0x166)](_0x30dd78),_0x165c31['json'](_0x2c7ea0);}),router['post'](a0_0x400f44(0x10a),async(_0x46c106,_0x3cf8f6)=>{var _0x21b946=a0_0x400f44;const {productCode:_0x376f5f,bay:_0x1873d8,warehouses:_0x3fd624,room:_0x5f499c}=_0x46c106[_0x21b946(0x149)];console[_0x21b946(0xd7)](_0x46c106[_0x21b946(0x149)]);try{const _0xec2744=await warehouse[_0x21b946(0xcd)]([{'$match':{'name':_0x3fd624,'room':_0x5f499c}},{'$unwind':_0x21b946(0x111)},{'$match':{'product_details.bay':parseInt(_0x1873d8)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x21b946(0xc8)},'product_stock':{'$first':_0x21b946(0xc1)},'bay':{'$first':_0x21b946(0xd0)},'maxProducts':{'$first':_0x21b946(0xd6)}}}]);_0x3cf8f6['status'](0xc8)[_0x21b946(0xfa)](_0xec2744);}catch(_0x417351){_0x3cf8f6['status'](0x194)[_0x21b946(0xfa)]({'message':_0x417351['message']});}}),module['exports']=router;