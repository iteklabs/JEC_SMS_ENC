var a0_0x2bea79=a0_0x2418;(function(_0x1dfd00,_0x21f847){var _0x11a017=a0_0x2418,_0x3d939b=_0x1dfd00();while(!![]){try{var _0x52bd5f=parseInt(_0x11a017(0x159))/0x1*(parseInt(_0x11a017(0x18a))/0x2)+-parseInt(_0x11a017(0x193))/0x3*(-parseInt(_0x11a017(0x1e0))/0x4)+-parseInt(_0x11a017(0x170))/0x5*(-parseInt(_0x11a017(0x183))/0x6)+-parseInt(_0x11a017(0x1bc))/0x7+parseInt(_0x11a017(0x1d8))/0x8+-parseInt(_0x11a017(0x1b2))/0x9+parseInt(_0x11a017(0x17a))/0xa*(-parseInt(_0x11a017(0x1d7))/0xb);if(_0x52bd5f===_0x21f847)break;else _0x3d939b['push'](_0x3d939b['shift']());}catch(_0x5dd134){_0x3d939b['push'](_0x3d939b['shift']());}}}(a0_0x1b5c,0xf0a0b));const express=require(a0_0x2bea79(0x177)),app=express(),router=express[a0_0x2bea79(0x1e7)](),auth=require(a0_0x2bea79(0x1f4)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x2bea79(0x150)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x2bea79(0x1a4));router[a0_0x2bea79(0x1ca)]('/view',auth,async(_0x276468,_0x2d88dc)=>{var _0x232bd1=a0_0x2bea79;try{const {username:_0x4eaa82,email:_0x15110f,role:_0x13021e}=_0x276468[_0x232bd1(0x15f)],_0x1c0102=_0x276468[_0x232bd1(0x15f)],_0x1db0e3=await profile[_0x232bd1(0x1f7)]({'email':_0x1c0102[_0x232bd1(0x1da)]}),_0x4ff4e0=await master_shop[_0x232bd1(0x180)]();let _0x50f6d5;if(_0x1c0102[_0x232bd1(0x16c)]==_0x232bd1(0x1c0)){const _0x592da6=await staff[_0x232bd1(0x1f7)]({'email':_0x1c0102['email']});_0x50f6d5=await warehouse['find']({'status':_0x232bd1(0x171),'name':_0x592da6['warehouse']});}else _0x50f6d5=await warehouse[_0x232bd1(0x180)]({'status':'Enabled'});const _0x260348=await product[_0x232bd1(0x180)]();let _0x56ad68;if(_0x1c0102['role']==_0x232bd1(0x1c0)){const _0x2a90ab=await staff[_0x232bd1(0x1f7)]({'email':_0x1c0102[_0x232bd1(0x1da)]});_0x56ad68=await adjustment_finished[_0x232bd1(0x180)]({'warehouse_name':_0x2a90ab[_0x232bd1(0x1db)]});}else _0x56ad68=await adjustment_finished[_0x232bd1(0x19d)]([{'$match':{'type_of_transaction':_0x232bd1(0x14f)}},{'$unwind':_0x232bd1(0x189)},{'$group':{'_id':'$_id','invoice':{'$first':_0x232bd1(0x1d0)},'date':{'$first':_0x232bd1(0x1ad)},'warehouse_name':{'$first':_0x232bd1(0x1b5)},'room':{'$addToSet':_0x232bd1(0x1cb)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4ff4e0[0x0][_0x232bd1(0x1c7)]==_0x232bd1(0x161)){var _0x20f146=users[_0x232bd1(0x1e3)];console[_0x232bd1(0x1f0)](_0x20f146);}else{if(_0x4ff4e0[0x0][_0x232bd1(0x1c7)]==_0x232bd1(0x1c2))var _0x20f146=users[_0x232bd1(0x1c2)];else{if(_0x4ff4e0[0x0][_0x232bd1(0x1c7)]==_0x232bd1(0x157))var _0x20f146=users['German'];else{if(_0x4ff4e0[0x0][_0x232bd1(0x1c7)]==_0x232bd1(0x158))var _0x20f146=users['Spanish'];else{if(_0x4ff4e0[0x0]['language']==_0x232bd1(0x15a))var _0x20f146=users[_0x232bd1(0x15a)];else{if(_0x4ff4e0[0x0][_0x232bd1(0x1c7)]==_0x232bd1(0x160))var _0x20f146=users[_0x232bd1(0x1d3)];else{if(_0x4ff4e0[0x0]['language']==_0x232bd1(0x195))var _0x20f146=users[_0x232bd1(0x195)];else{if(_0x4ff4e0[0x0][_0x232bd1(0x1c7)]=='Arabic\x20(ae)')var _0x20f146=users['Arabic'];}}}}}}}_0x2d88dc[_0x232bd1(0x15d)]('adjustment_finished',{'success':_0x276468['flash'](_0x232bd1(0x1d2)),'errors':_0x276468[_0x232bd1(0x1ea)]('errors'),'role':_0x1c0102,'profile':_0x1db0e3,'warehouse':_0x50f6d5,'product':_0x260348,'adjustment':_0x56ad68,'master_shop':_0x4ff4e0,'language':_0x20f146});}catch(_0x4587aa){console[_0x232bd1(0x1f0)](_0x4587aa);}}),router[a0_0x2bea79(0x1ca)]('/view_logs',auth,async(_0x37602b,_0x2c9c37)=>{var _0x2ff756=a0_0x2bea79;try{const {username:_0x3e46c2,email:_0x5a0b63,role:_0x1e1612}=_0x37602b[_0x2ff756(0x15f)],_0x42732d=_0x37602b['user'],_0x14d97b=await profile[_0x2ff756(0x1f7)]({'email':_0x42732d['email']}),_0x1bf1f7=await master_shop[_0x2ff756(0x180)]();let _0x53f066;if(_0x42732d['role']==_0x2ff756(0x1c0)){const _0x3cfd94=await staff[_0x2ff756(0x1f7)]({'email':_0x42732d['email']});_0x53f066=await warehouse[_0x2ff756(0x180)]({'status':'Enabled','name':_0x3cfd94[_0x2ff756(0x1db)]});}else _0x53f066=await warehouse[_0x2ff756(0x180)]({'status':_0x2ff756(0x171)});const _0x590839=await product[_0x2ff756(0x180)]();let _0x1bdda1;if(_0x42732d[_0x2ff756(0x16c)]==_0x2ff756(0x1c0)){const _0x22db0f=await staff['findOne']({'email':_0x42732d['email']});_0x1bdda1=await adjustment_finished['find']({'warehouse_name':_0x22db0f['warehouse']});}else _0x1bdda1=await adjustment_finished[_0x2ff756(0x19d)]([{'$match':{'type_of_transaction':'logs'}},{'$unwind':_0x2ff756(0x189)},{'$group':{'_id':_0x2ff756(0x1c5),'invoice':{'$first':_0x2ff756(0x1d0)},'date':{'$first':_0x2ff756(0x1ad)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x2ff756(0x1cb)},'finalize':{'$first':_0x2ff756(0x1a0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1bf1f7[0x0][_0x2ff756(0x1c7)]==_0x2ff756(0x161))var _0x1bb294=users[_0x2ff756(0x1e3)];else{if(_0x1bf1f7[0x0]['language']==_0x2ff756(0x1c2))var _0x1bb294=users[_0x2ff756(0x1c2)];else{if(_0x1bf1f7[0x0][_0x2ff756(0x1c7)]==_0x2ff756(0x157))var _0x1bb294=users[_0x2ff756(0x157)];else{if(_0x1bf1f7[0x0][_0x2ff756(0x1c7)]==_0x2ff756(0x158))var _0x1bb294=users['Spanish'];else{if(_0x1bf1f7[0x0][_0x2ff756(0x1c7)]==_0x2ff756(0x15a))var _0x1bb294=users[_0x2ff756(0x15a)];else{if(_0x1bf1f7[0x0][_0x2ff756(0x1c7)]==_0x2ff756(0x160))var _0x1bb294=users[_0x2ff756(0x1d3)];else{if(_0x1bf1f7[0x0][_0x2ff756(0x1c7)]==_0x2ff756(0x195))var _0x1bb294=users[_0x2ff756(0x195)];else{if(_0x1bf1f7[0x0]['language']==_0x2ff756(0x1dd))var _0x1bb294=users[_0x2ff756(0x1b6)];}}}}}}}_0x2c9c37[_0x2ff756(0x15d)](_0x2ff756(0x1e4),{'success':_0x37602b[_0x2ff756(0x1ea)]('success'),'errors':_0x37602b[_0x2ff756(0x1ea)](_0x2ff756(0x1d9)),'role':_0x42732d,'profile':_0x14d97b,'warehouse':_0x53f066,'product':_0x590839,'adjustment':_0x1bdda1,'master_shop':_0x1bf1f7,'language':_0x1bb294});}catch(_0x16a1ad){console[_0x2ff756(0x1f0)](_0x16a1ad);}});function a0_0x2418(_0x5dd406,_0x47ca11){var _0x1b5c1b=a0_0x1b5c();return a0_0x2418=function(_0x2418cf,_0x5f33a8){_0x2418cf=_0x2418cf-0x147;var _0x26a76e=_0x1b5c1b[_0x2418cf];return _0x26a76e;},a0_0x2418(_0x5dd406,_0x47ca11);}async function getRandom8DigitNumber(){var _0x5ea477=a0_0x2bea79;const _0x834b84=0x989680,_0x12032c=0x5f5e0ff,_0x66287b=Math[_0x5ea477(0x18b)](Math['random']()*(_0x12032c-_0x834b84+0x1))+_0x834b84;var _0xe777fc;const _0x16f74b=await adjustment_finished[_0x5ea477(0x1f7)]({'invoice':'ADJF-'+_0x66287b});return _0x16f74b&&_0x16f74b[_0x5ea477(0x1b0)]>0x0?_0xe777fc=_0x5ea477(0x1c6)+_0x66287b:_0xe777fc=_0x5ea477(0x1c6)+_0x66287b,_0xe777fc;}function a0_0x1b5c(){var _0x29b558=['5487816ymuXFT','errors','email','warehouse','$product_details.primary_code','Arabic\x20(ae)','True','adjustment\x20add\x20successfull','4SfVKuh','product_date','string','English','adjustment_finished_logs','bay','$product_details.secondary_code','Router','</td>','invoice','flash','product_details','$product_details.floorlevel','filter','$product_details.unit','$product_details.maxProducts','log','exports','expiry_date','finalize','../middleware/auth','split','There\x27s\x20a\x20error\x20in\x20this\x20transaction','findOne','_id','status','level','product_name','getDate','findById','match','Secondary_units','add_adjustment_finished','add_adjustment_finished_logs','own','../models/all_models','Rooms','minus','date','/picking_list/PDF_adjustmentFinal/','Primary_Units','body','German','Spanish','47DbKaoL','French','$product_details.batch_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','render','/preview/:id','user','Portuguese\x20(BR)','English\x20(US)','unit','</tr>','forEach','id_transaction','$product_details.storage','getMonth','$room','types','master','$product_details.type','role','/view/:id','/view/add_adjustment_logs','adjust_qty','1236735hmsHuS','Enabled','message','JO_number','$product_details.maxPerUnit','foreach\x20newproduct','DRY\x20GOODS','express','ADJ-','/adjustment_finished/view','90zYmpSR','/view/add_adjustment','json','stock','prod_code','toString','find','$product_details','$product_details.secondary_unit','12tsXgUc','$product_details.rack','/adjustment_finished/preview/','/adjustment/view','room_names','edit_adjustment_finished_view','$product','36106JyOjPt','floor','$product_details.invoice','prod_cat','map','all','note','params','An\x20error\x20occurred.','5364993oHuRwH','Return\x20Rooms','Chinese','post','warehouse_name','catch','redirect','product_stock','$name','$product_details.product_stock','aggregate','Enclosed','New_Qty_Converted_adj','$finalize','production_date','prod_name','padStart','nodemailer','Ambient','then','product','back','new_adjust_qty','/barcode_scanner','product_code','error','$date','secondary_unit','$product_details.bin','length','stockBefore','327627Rhchbx','$product_details.product_name','purchases_data','$warehouse_name','Arabic','Adjustment\x20Finalize\x20Successfully','New_Qty_Converted','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.product_code','prod_invoice','5693044cLxVzG','save','invoice_init','adjustment\x20data\x20update\x20successfully','staff','add','Hindi','id_transaction_from','push','$_id','ADJF-','language','$product.product_name','room','get','$product.room_names','$product_details.production_date','$product_details.expiry_date','$product_details._id','slice','$invoice','/CheckingWarehouse','success','Portuguese','$product_details.bay','batch_code','maxPerUnit','2422673xbvyUE'];a0_0x1b5c=function(){return _0x29b558;};return a0_0x1b5c();}router[a0_0x2bea79(0x1ca)](a0_0x2bea79(0x17b),auth,async(_0x37ce44,_0x5d1d4d)=>{var _0x252d50=a0_0x2bea79;try{const {username:_0x268f80,email:_0xca8e20,role:_0x5ca29a}=_0x37ce44[_0x252d50(0x15f)],_0x808258=_0x37ce44[_0x252d50(0x15f)],_0x1aef5f=await profile['findOne']({'email':_0x808258[_0x252d50(0x1da)]}),_0x2a0e8b=await master_shop['find']();let _0x5cbe50;if(_0x808258[_0x252d50(0x16c)]==_0x252d50(0x1c0)){const _0x3c7ca8=await staff['findOne']({'email':_0x808258['email']});_0x5cbe50=await warehouse[_0x252d50(0x19d)]([{'$match':{'status':_0x252d50(0x171),'name':_0x3c7ca8[_0x252d50(0x1db)]}},{'$group':{'_id':_0x252d50(0x19b),'name':{'$first':_0x252d50(0x19b)}}}]);}else _0x5cbe50=await warehouse['aggregate']([{'$match':{'status':_0x252d50(0x171)}},{'$group':{'_id':_0x252d50(0x19b),'name':{'$first':'$name'}}}]);const _0x2e151f=await product['find']({}),_0x2c448d=await adjustment_finished['find'](),_0x512510=_0x2c448d['length']+0x1,_0x2998ec=_0x252d50(0x1c6)+_0x512510[_0x252d50(0x17f)]()[_0x252d50(0x1a3)](0x5,'0');var _0x34d3da=[_0x252d50(0x1a5),_0x252d50(0x19e),_0x252d50(0x194)];if(_0x2a0e8b[0x0]['language']==_0x252d50(0x161))var _0x359fcf=users[_0x252d50(0x1e3)];else{if(_0x2a0e8b[0x0][_0x252d50(0x1c7)]=='Hindi')var _0x359fcf=users['Hindi'];else{if(_0x2a0e8b[0x0]['language']==_0x252d50(0x157))var _0x359fcf=users[_0x252d50(0x157)];else{if(_0x2a0e8b[0x0][_0x252d50(0x1c7)]==_0x252d50(0x158))var _0x359fcf=users[_0x252d50(0x158)];else{if(_0x2a0e8b[0x0][_0x252d50(0x1c7)]==_0x252d50(0x15a))var _0x359fcf=users[_0x252d50(0x15a)];else{if(_0x2a0e8b[0x0][_0x252d50(0x1c7)]==_0x252d50(0x160))var _0x359fcf=users[_0x252d50(0x1d3)];else{if(_0x2a0e8b[0x0][_0x252d50(0x1c7)]==_0x252d50(0x195))var _0x359fcf=users[_0x252d50(0x195)];else{if(_0x2a0e8b[0x0][_0x252d50(0x1c7)]==_0x252d50(0x1dd))var _0x359fcf=users[_0x252d50(0x1b6)];}}}}}}}const _0x176dd0=getRandom8DigitNumber();_0x176dd0[_0x252d50(0x1a6)](_0x360b85=>{var _0xe0f546=_0x252d50;_0x5d1d4d[_0xe0f546(0x15d)](_0xe0f546(0x14d),{'success':_0x37ce44[_0xe0f546(0x1ea)]('success'),'errors':_0x37ce44[_0xe0f546(0x1ea)](_0xe0f546(0x1d9)),'role':_0x808258,'profile':_0x1aef5f,'warehouse':_0x5cbe50,'product':_0x2e151f,'master_shop':_0x2a0e8b,'language':_0x359fcf,'rooms_data':_0x34d3da,'invoice_no':_0x360b85});})[_0x252d50(0x198)](_0x14de30=>{var _0x4e5c18=_0x252d50;_0x37ce44[_0x4e5c18(0x1ea)](_0x4e5c18(0x1d9),_0x4e5c18(0x1f6)),_0x5d1d4d[_0x4e5c18(0x199)]('/adjustment/view');});}catch(_0x462fe7){console[_0x252d50(0x1f0)](_0x462fe7);}}),router[a0_0x2bea79(0x196)](a0_0x2bea79(0x17b),auth,async(_0x13f87f,_0x95bc54)=>{var _0x4c982d=a0_0x2bea79;try{const {warehouse_name:_0xa16e0c,date:_0x1ef4bf,prod_name:_0x3a3e0b,level:_0x211ffc,isle:_0x2f4642,pallet:_0x17426f,stock:_0x49530b,types:_0x68e330,adjust_qty:_0x7a8009,new_adjust_qty:_0x55db83,note:_0xb45864,Room_name:_0x46a188,JO_number:_0x11b3ba,expiry_date:_0x1d4341,PO_number:_0x13ef02,ReqBy:_0x40aea1,dateofreq:_0x147336,typeservicesData:_0x475072,destination:_0x5b0538,deliverydate:_0x5b7d00,driver:_0x3ed387,plate:_0x1535ba,van:_0x509214,DRSI:_0x2b166b,typevehicle:_0x1df1a2,TSU:_0x236001,TFU:_0x41050e}=_0x13f87f[_0x4c982d(0x156)];if(typeof _0x3a3e0b==_0x4c982d(0x1e2))var _0x4d60c5=[_0x13f87f['body'][_0x4c982d(0x1a2)]],_0x1e87d8=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x147)]],_0x521421=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x17d)]],_0x5bbcf6=[_0x13f87f['body'][_0x4c982d(0x169)]],_0xfc2a9b=[_0x13f87f['body'][_0x4c982d(0x19f)]],_0x468d04=[_0x13f87f[_0x4c982d(0x156)]['New_Qty_Converted']],_0x273218=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x155)]],_0x41cd55=[_0x13f87f['body'][_0x4c982d(0x14c)]],_0x3c1173=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x17e)]],_0xdc7f3b=[_0x13f87f['body'][_0x4c982d(0x1d5)]],_0x43d589=[_0x13f87f[_0x4c982d(0x156)]['expiry_date']],_0x1bb631=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x1e1)]],_0x519547=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x18d)]],_0x3eca4c=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x151)]],_0x1fe23e=[_0x13f87f['body']['maxPerUnit']],_0x381b07=[_0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x1bb)]],_0x427429=[_0x13f87f['body'][_0x4c982d(0x1c3)]];else var _0x4d60c5=[..._0x13f87f['body']['prod_name']],_0x1e87d8=[..._0x13f87f['body'][_0x4c982d(0x147)]],_0x521421=[..._0x13f87f['body']['stock']],_0x5bbcf6=[..._0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x169)]],_0xfc2a9b=[..._0x13f87f['body'][_0x4c982d(0x19f)]],_0x468d04=[..._0x13f87f['body'][_0x4c982d(0x1b8)]],_0x273218=[..._0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x155)]],_0x41cd55=[..._0x13f87f['body'][_0x4c982d(0x14c)]],_0x3c1173=[..._0x13f87f[_0x4c982d(0x156)]['prod_code']],_0xdc7f3b=[..._0x13f87f[_0x4c982d(0x156)]['batch_code']],_0x43d589=[..._0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x1f2)]],_0x1bb631=[..._0x13f87f['body'][_0x4c982d(0x1e1)]],_0x519547=[..._0x13f87f['body'][_0x4c982d(0x18d)]],_0x3eca4c=[..._0x13f87f[_0x4c982d(0x156)]['Rooms']],_0x1fe23e=[..._0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x1d6)]],_0x381b07=[..._0x13f87f[_0x4c982d(0x156)][_0x4c982d(0x1bb)]],_0x427429=[..._0x13f87f['body']['id_transaction_from']];const _0x2a64b1=_0x4d60c5['map'](_0x991198=>{return _0x991198={'product_name':_0x991198};});_0x1e87d8[_0x4c982d(0x164)]((_0x35ec0b,_0x150c2d)=>{var _0x2f5505=_0x4c982d,_0x277017=_0x35ec0b['match'](/[A-Za-z]+/)[0x0],_0x4b2630=parseInt(_0x35ec0b[_0x2f5505(0x14b)](/\d+/)[0x0]);_0x2a64b1[_0x150c2d]['level']=_0x277017,_0x2a64b1[_0x150c2d][_0x2f5505(0x1e5)]=_0x4b2630;}),_0x427429[_0x4c982d(0x164)]((_0x51659c,_0x2d7053)=>{var _0x3d41b5=_0x4c982d;_0x2a64b1[_0x2d7053][_0x3d41b5(0x165)]=_0x51659c;}),_0x521421[_0x4c982d(0x164)]((_0x35e221,_0x57ec36)=>{var _0xade09=_0x4c982d;_0x2a64b1[_0x57ec36][_0xade09(0x1b1)]=_0x35e221;}),_0x5bbcf6[_0x4c982d(0x164)]((_0x176f43,_0xb9e0a9)=>{var _0x2def37=_0x4c982d;_0x2a64b1[_0xb9e0a9][_0x2def37(0x169)]=_0x176f43;}),_0xfc2a9b[_0x4c982d(0x164)]((_0x5c651a,_0x12a220)=>{_0x2a64b1[_0x12a220]['adjust_qty']=_0x5c651a;}),_0x468d04[_0x4c982d(0x164)]((_0xcd743d,_0x4517d2)=>{var _0x4d4b6c=_0x4c982d;_0x2a64b1[_0x4517d2][_0x4d4b6c(0x1a9)]=_0xcd743d;}),_0x273218[_0x4c982d(0x164)]((_0x2faa53,_0x3e6a8b)=>{var _0x177d76=_0x4c982d;_0x2a64b1[_0x3e6a8b][_0x177d76(0x162)]=_0x2faa53;}),_0x41cd55[_0x4c982d(0x164)]((_0x1e4c9c,_0x4041ee)=>{var _0x401a94=_0x4c982d;_0x2a64b1[_0x4041ee][_0x401a94(0x1ae)]=_0x1e4c9c;}),_0x3c1173[_0x4c982d(0x164)]((_0x35bb7f,_0x507d4b)=>{var _0x38d09c=_0x4c982d;_0x2a64b1[_0x507d4b][_0x38d09c(0x1ab)]=_0x35bb7f;}),_0xdc7f3b['forEach']((_0x59cca3,_0x50d332)=>{var _0x4c5a44=_0x4c982d;_0x2a64b1[_0x50d332][_0x4c5a44(0x1d5)]=_0x59cca3;}),_0x43d589[_0x4c982d(0x164)]((_0x120c1b,_0x589394)=>{_0x2a64b1[_0x589394]['expiry_date']=_0x120c1b;}),_0x1bb631[_0x4c982d(0x164)]((_0x1c26fb,_0x27b187)=>{_0x2a64b1[_0x27b187]['production_date']=_0x1c26fb;}),_0x519547[_0x4c982d(0x164)]((_0x43a120,_0x47b738)=>{var _0x428559=_0x4c982d;_0x2a64b1[_0x47b738][_0x428559(0x18d)]=_0x43a120;}),_0x3eca4c['forEach']((_0x9f8035,_0xbad882)=>{var _0x1be23a=_0x4c982d;_0x2a64b1[_0xbad882][_0x1be23a(0x187)]=_0x9f8035;}),_0x1fe23e[_0x4c982d(0x164)]((_0xdf7123,_0x3273f8)=>{var _0x45599b=_0x4c982d;_0x2a64b1[_0x3273f8][_0x45599b(0x1d6)]=_0xdf7123;}),_0x381b07['forEach']((_0x3dc308,_0x1ba049)=>{var _0x30eaf4=_0x4c982d;_0x2a64b1[_0x1ba049][_0x30eaf4(0x1e9)]=_0x3dc308;});const _0x25260c=_0x2a64b1[_0x4c982d(0x1ed)](_0x280187=>_0x280187[_0x4c982d(0x16f)]!=='0'&&_0x280187[_0x4c982d(0x16f)]!=='');var _0x53f376=0x0;_0x25260c[_0x4c982d(0x164)](_0x49c2f6=>{var _0x4246af=_0x4c982d;console[_0x4246af(0x1f0)](_0x4246af(0x175),_0x49c2f6),parseInt(_0x49c2f6[_0x4246af(0x16f)])<=0x0&&_0x53f376++;});if(_0x53f376!=0x0)return _0x13f87f['flash'](_0x4c982d(0x1d9),_0x4c982d(0x1b9)),_0x95bc54[_0x4c982d(0x199)](_0x4c982d(0x1a8));const _0x527646=new invoice_for_adjustment();await _0x527646[_0x4c982d(0x1bd)]();const _0x354457=new adjustment_finished({'warehouse_name':_0xa16e0c,'date':_0x1ef4bf,'product':_0x25260c,'note':_0xb45864,'room':_0x46a188,'invoice':_0x4c982d(0x178)+_0x527646[_0x4c982d(0x1be)]['toString']()[_0x4c982d(0x1a3)](0x8,'0'),'JO_number':_0x11b3ba,'expiry_date':_0x1d4341,'PO_number':_0x13ef02,'RequestedBy':_0x40aea1,'DateofRequest':_0x147336,'typeservices':_0x475072,'destination':_0x5b0538,'deliverydate':_0x5b7d00,'driver':_0x3ed387,'plate':_0x1535ba,'van':_0x509214,'DRSI':_0x2b166b,'typevehicle':_0x1df1a2,'TSU':_0x236001,'TFU':_0x41050e}),_0x393c75=await _0x354457['save']();_0x13f87f['flash'](_0x4c982d(0x1d2),_0x4c982d(0x1df)),_0x95bc54[_0x4c982d(0x199)](_0x4c982d(0x185)+_0x393c75[_0x4c982d(0x1f8)]);}catch(_0x54d6b1){console[_0x4c982d(0x1f0)](_0x54d6b1),_0x95bc54[_0x4c982d(0x1f9)](0xc8)['json']({'message':_0x54d6b1[_0x4c982d(0x172)]});}}),router['get'](a0_0x2bea79(0x16e),auth,async(_0x5e2dc7,_0x356122)=>{var _0x4d5143=a0_0x2bea79;try{const {username:_0x4f5f7d,email:_0x2e652b,role:_0x421770}=_0x5e2dc7[_0x4d5143(0x15f)],_0x34f8e4=_0x5e2dc7[_0x4d5143(0x15f)],_0x4a39ac=await profile['findOne']({'email':_0x34f8e4['email']}),_0x433beb=await master_shop[_0x4d5143(0x180)]();let _0x31e804;if(_0x34f8e4['role']==_0x4d5143(0x1c0)){const _0x18b64b=await staff[_0x4d5143(0x1f7)]({'email':_0x34f8e4[_0x4d5143(0x1da)]});_0x31e804=await warehouse[_0x4d5143(0x19d)]([{'$match':{'status':'Enabled','name':_0x18b64b[_0x4d5143(0x1db)]}},{'$group':{'_id':_0x4d5143(0x19b),'name':{'$first':_0x4d5143(0x19b)}}}]);}else _0x31e804=await warehouse[_0x4d5143(0x19d)]([{'$match':{'status':_0x4d5143(0x171)}},{'$group':{'_id':'$name','name':{'$first':_0x4d5143(0x19b)}}}]);const _0x5586d3=await product[_0x4d5143(0x180)](),_0x1adda5=await adjustment_finished[_0x4d5143(0x180)](),_0x560f82=_0x1adda5[_0x4d5143(0x1b0)]+0x1,_0x523a00='ADJF-'+_0x560f82[_0x4d5143(0x17f)]()[_0x4d5143(0x1a3)](0x5,'0');var _0x3593fb=['Ambient',_0x4d5143(0x19e),'Return\x20Rooms'];if(_0x433beb[0x0][_0x4d5143(0x1c7)]==_0x4d5143(0x161))var _0xd6ee7=users[_0x4d5143(0x1e3)];else{if(_0x433beb[0x0]['language']==_0x4d5143(0x1c2))var _0xd6ee7=users[_0x4d5143(0x1c2)];else{if(_0x433beb[0x0]['language']=='German')var _0xd6ee7=users[_0x4d5143(0x157)];else{if(_0x433beb[0x0][_0x4d5143(0x1c7)]=='Spanish')var _0xd6ee7=users[_0x4d5143(0x158)];else{if(_0x433beb[0x0]['language']==_0x4d5143(0x15a))var _0xd6ee7=users[_0x4d5143(0x15a)];else{if(_0x433beb[0x0][_0x4d5143(0x1c7)]==_0x4d5143(0x160))var _0xd6ee7=users[_0x4d5143(0x1d3)];else{if(_0x433beb[0x0][_0x4d5143(0x1c7)]=='Chinese')var _0xd6ee7=users['Chinese'];else{if(_0x433beb[0x0][_0x4d5143(0x1c7)]=='Arabic\x20(ae)')var _0xd6ee7=users['Arabic'];}}}}}}}const _0x1e6787=getRandom8DigitNumber();_0x1e6787['then'](_0x5154e3=>{var _0x4395fe=_0x4d5143;_0x356122['render'](_0x4395fe(0x14e),{'success':_0x5e2dc7[_0x4395fe(0x1ea)](_0x4395fe(0x1d2)),'errors':_0x5e2dc7[_0x4395fe(0x1ea)](_0x4395fe(0x1d9)),'role':_0x34f8e4,'profile':_0x4a39ac,'warehouse':_0x31e804,'product':_0x5586d3,'master_shop':_0x433beb,'language':_0xd6ee7,'rooms_data':_0x3593fb,'invoice_no':_0x5154e3});})[_0x4d5143(0x198)](_0x31a489=>{var _0x451de7=_0x4d5143;_0x5e2dc7[_0x451de7(0x1ea)]('errors',_0x451de7(0x1f6)),_0x356122['redirect'](_0x451de7(0x186));});}catch(_0x2595cd){console[_0x4d5143(0x1f0)](_0x2595cd);}}),router[a0_0x2bea79(0x196)](a0_0x2bea79(0x16e),auth,async(_0x1d27dc,_0x427c12)=>{var _0x466fe7=a0_0x2bea79;try{const {warehouse_name:_0x257517,date:_0x4938bb,prod_name:_0x3889ca,level:_0x3c570d,isle:_0x521438,pallet:_0x5b5709,stock:_0x24efdb,types:_0x4c6d2b,adjust_qty:_0x1321e6,new_adjust_qty:_0x4115be,note:_0x236ec8,Room_name:_0x54477e,JO_number:_0x2d2dc0,expiry_date:_0x354566,type_of_transaction:_0x1828bf,PO_number:_0x3897d8,ReqBy:_0x434176,dateofreq:_0x4dd8dd,typeservicesData:_0x545a37,destination:_0x4fa208,deliverydate:_0x18216a,driver:_0x508066,plate:_0x4b77ac,van:_0x5271df,DRSI:_0x5667a0,typevehicle:_0x417c25,TSU:_0x536a95,TFU:_0x2d0d29}=_0x1d27dc['body'];if(typeof _0x3889ca==_0x466fe7(0x1e2))var _0x148613=[_0x1d27dc[_0x466fe7(0x156)]['prod_name']],_0x3c2dd8=[_0x1d27dc['body']['level']],_0x120a38=[_0x1d27dc[_0x466fe7(0x156)]['stock']],_0x294a9a=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x169)]],_0x37183c=[_0x1d27dc[_0x466fe7(0x156)]['New_Qty_Converted_adj']],_0x4cf77f=[_0x1d27dc['body'][_0x466fe7(0x1b8)]],_0x3b2c95=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x155)]],_0x5056e6=[_0x1d27dc[_0x466fe7(0x156)]['Secondary_units']],_0x22493d=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x17e)]],_0x3e5e27=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1d5)]],_0x5f128c=[_0x1d27dc['body']['expiry_date']],_0x579887=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1e1)]],_0x35c715=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x18d)]],_0x44410d=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x151)]],_0x42a049=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1d6)]],_0x17622a=[_0x1d27dc['body']['prod_invoice']],_0x252aa9=[_0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1c3)]];else var _0x148613=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1a2)]],_0x3c2dd8=[..._0x1d27dc['body']['level']],_0x120a38=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x17d)]],_0x294a9a=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x169)]],_0x37183c=[..._0x1d27dc[_0x466fe7(0x156)]['New_Qty_Converted_adj']],_0x4cf77f=[..._0x1d27dc[_0x466fe7(0x156)]['New_Qty_Converted']],_0x3b2c95=[..._0x1d27dc[_0x466fe7(0x156)]['Primary_Units']],_0x5056e6=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x14c)]],_0x22493d=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x17e)]],_0x3e5e27=[..._0x1d27dc[_0x466fe7(0x156)]['batch_code']],_0x5f128c=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1f2)]],_0x579887=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1e1)]],_0x35c715=[..._0x1d27dc[_0x466fe7(0x156)]['prod_cat']],_0x44410d=[..._0x1d27dc['body'][_0x466fe7(0x151)]],_0x42a049=[..._0x1d27dc['body']['maxPerUnit']],_0x17622a=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1bb)]],_0x252aa9=[..._0x1d27dc[_0x466fe7(0x156)][_0x466fe7(0x1c3)]];const _0x4b7fa3=_0x148613[_0x466fe7(0x18e)](_0x4482f0=>{return _0x4482f0={'product_name':_0x4482f0};});_0x3c2dd8['forEach']((_0xe08cec,_0x2ca5d6)=>{var _0x448969=_0x466fe7,_0x665637=_0xe08cec[_0x448969(0x14b)](/[A-Za-z]+/)[0x0],_0x22b31b=parseInt(_0xe08cec[_0x448969(0x14b)](/\d+/)[0x0]);_0x4b7fa3[_0x2ca5d6]['level']=_0x665637,_0x4b7fa3[_0x2ca5d6]['bay']=_0x22b31b;}),_0x252aa9[_0x466fe7(0x164)]((_0x1309a4,_0x45ef55)=>{_0x4b7fa3[_0x45ef55]['id_transaction']=_0x1309a4;}),_0x120a38[_0x466fe7(0x164)]((_0x4b7fee,_0x2cdb26)=>{var _0x4532cf=_0x466fe7;_0x4b7fa3[_0x2cdb26][_0x4532cf(0x1b1)]=_0x4b7fee;}),_0x294a9a[_0x466fe7(0x164)]((_0x587b7b,_0x1341c8)=>{var _0x2b59e6=_0x466fe7;_0x4b7fa3[_0x1341c8][_0x2b59e6(0x169)]=_0x587b7b;}),_0x37183c['forEach']((_0x3bbb26,_0x31fc42)=>{_0x4b7fa3[_0x31fc42]['adjust_qty']=_0x3bbb26;}),_0x4cf77f['forEach']((_0x28d40c,_0x370783)=>{var _0x173fd0=_0x466fe7;_0x4b7fa3[_0x370783][_0x173fd0(0x1a9)]=_0x28d40c;}),_0x3b2c95[_0x466fe7(0x164)]((_0x503626,_0x2a12b7)=>{_0x4b7fa3[_0x2a12b7]['unit']=_0x503626;}),_0x5056e6['forEach']((_0x2e6ea7,_0x19fc7d)=>{var _0x1c5e1f=_0x466fe7;_0x4b7fa3[_0x19fc7d][_0x1c5e1f(0x1ae)]=_0x2e6ea7;}),_0x22493d[_0x466fe7(0x164)]((_0x10725a,_0x1b02da)=>{_0x4b7fa3[_0x1b02da]['product_code']=_0x10725a;}),_0x3e5e27[_0x466fe7(0x164)]((_0x1625b1,_0xab6c15)=>{_0x4b7fa3[_0xab6c15]['batch_code']=_0x1625b1;}),_0x5f128c[_0x466fe7(0x164)]((_0x2b5b5c,_0x2deb98)=>{var _0xe6589d=_0x466fe7;_0x4b7fa3[_0x2deb98][_0xe6589d(0x1f2)]=_0x2b5b5c;}),_0x579887[_0x466fe7(0x164)]((_0x8e5e70,_0x52d633)=>{var _0x5e0ead=_0x466fe7;_0x4b7fa3[_0x52d633][_0x5e0ead(0x1a1)]=_0x8e5e70;}),_0x35c715['forEach']((_0x53223e,_0x42e7cd)=>{_0x4b7fa3[_0x42e7cd]['prod_cat']=_0x53223e;}),_0x44410d[_0x466fe7(0x164)]((_0x19dd4c,_0x3533b4)=>{_0x4b7fa3[_0x3533b4]['room_names']=_0x19dd4c;}),_0x42a049[_0x466fe7(0x164)]((_0x223708,_0x5c7790)=>{var _0x1016a3=_0x466fe7;_0x4b7fa3[_0x5c7790][_0x1016a3(0x1d6)]=_0x223708;}),_0x17622a[_0x466fe7(0x164)]((_0x2aa5b6,_0x10b505)=>{var _0x5ce2b2=_0x466fe7;_0x4b7fa3[_0x10b505][_0x5ce2b2(0x1e9)]=_0x2aa5b6;});const _0x17e42c=_0x4b7fa3[_0x466fe7(0x1ed)](_0x4f16fd=>_0x4f16fd[_0x466fe7(0x16f)]!=='0'&&_0x4f16fd['adjust_qty']!=='');var _0x269ba7=0x0;_0x17e42c[_0x466fe7(0x164)](_0x1ef23e=>{var _0x5147c7=_0x466fe7;console[_0x5147c7(0x1f0)](_0x5147c7(0x175),_0x1ef23e),parseInt(_0x1ef23e[_0x5147c7(0x16f)])<=0x0&&_0x269ba7++;});if(_0x269ba7!=0x0)return _0x1d27dc['flash'](_0x466fe7(0x1d9),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x427c12[_0x466fe7(0x199)](_0x466fe7(0x1a8));const _0x3837d0=new adjustment_logs();await _0x3837d0[_0x466fe7(0x1bd)]();const _0x83f101=new adjustment_finished({'warehouse_name':_0x257517,'date':_0x4938bb,'product':_0x17e42c,'note':_0x236ec8,'room':_0x54477e,'invoice':'LOG-ADJ-'+_0x3837d0['invoice_init']['toString']()[_0x466fe7(0x1a3)](0x8,'0'),'JO_number':_0x2d2dc0,'expiry_date':_0x354566,'type_of_transaction':_0x1828bf,'PO_number':_0x3897d8,'RequestedBy':_0x434176,'DateofRequest':_0x4dd8dd,'typeservices':_0x545a37,'destination':_0x4fa208,'deliverydate':_0x18216a,'driver':_0x508066,'plate':_0x4b77ac,'van':_0x5271df,'DRSI':_0x5667a0,'typevehicle':_0x417c25,'TSU':_0x536a95,'TFU':_0x2d0d29}),_0x214e44=await _0x83f101[_0x466fe7(0x1bd)]();_0x1d27dc[_0x466fe7(0x1ea)](_0x466fe7(0x1d2),'adjustment\x20add\x20successfull'),_0x427c12[_0x466fe7(0x199)](_0x466fe7(0x185)+_0x214e44[_0x466fe7(0x1f8)]);}catch(_0x46cf14){console['log'](_0x46cf14),_0x427c12['status'](0xc8)[_0x466fe7(0x17c)]({'message':_0x46cf14[_0x466fe7(0x172)]});}}),router[a0_0x2bea79(0x1ca)](a0_0x2bea79(0x15e),auth,async(_0x19093a,_0x179c18)=>{var _0x4b8560=a0_0x2bea79;try{const {username:_0x1d7be9,email:_0x4d5232,role:_0xdab6ce}=_0x19093a['user'],_0x2a4929=_0x19093a[_0x4b8560(0x15f)],_0x1091ed=await profile[_0x4b8560(0x1f7)]({'email':_0x2a4929[_0x4b8560(0x1da)]}),_0x5bbc8a=await master_shop['find'](),_0x12a497=_0x19093a[_0x4b8560(0x191)]['id'],_0x2a1e24=await adjustment_finished['findById']({'_id':_0x12a497}),_0x5822ce=await purchases[_0x4b8560(0x19d)]([{'$match':{'warehouse_name':_0x2a1e24[_0x4b8560(0x197)]}},{'$unwind':_0x4b8560(0x189)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x4b8560(0x1b4),_0x5822ce);const _0x290fb5=await product['find']({}),_0x4407cc=await warehouse[_0x4b8560(0x19d)]([{'$match':{'name':_0x2a1e24[_0x4b8560(0x197)]}},{'$unwind':_0x4b8560(0x181)},{'$group':{'_id':_0x4b8560(0x1ce),'name':{'$first':_0x4b8560(0x1b3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4b8560(0x1d4)},'bin':{'$first':_0x4b8560(0x1af)},'type':{'$first':_0x4b8560(0x16b)},'floorlevel':{'$first':_0x4b8560(0x1ec)},'primary_code':{'$first':_0x4b8560(0x1dc)},'secondary_code':{'$first':_0x4b8560(0x1e6)},'product_code':{'$first':_0x4b8560(0x1ba)},'storage':{'$first':_0x4b8560(0x166)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4b8560(0x1cd)},'production_date':{'$first':_0x4b8560(0x1cc)},'batch_code':{'$first':_0x4b8560(0x15b)},'maxPerUnit':{'$first':_0x4b8560(0x174)},'room':{'$first':_0x4b8560(0x168)}}}]);if(_0x5bbc8a[0x0][_0x4b8560(0x1c7)]==_0x4b8560(0x161)){var _0x544752=users[_0x4b8560(0x1e3)];console['log'](_0x544752);}else{if(_0x5bbc8a[0x0]['language']==_0x4b8560(0x1c2))var _0x544752=users[_0x4b8560(0x1c2)];else{if(_0x5bbc8a[0x0]['language']==_0x4b8560(0x157))var _0x544752=users[_0x4b8560(0x157)];else{if(_0x5bbc8a[0x0][_0x4b8560(0x1c7)]=='Spanish')var _0x544752=users[_0x4b8560(0x158)];else{if(_0x5bbc8a[0x0][_0x4b8560(0x1c7)]=='French')var _0x544752=users['French'];else{if(_0x5bbc8a[0x0][_0x4b8560(0x1c7)]==_0x4b8560(0x160))var _0x544752=users[_0x4b8560(0x1d3)];else{if(_0x5bbc8a[0x0][_0x4b8560(0x1c7)]=='Chinese')var _0x544752=users[_0x4b8560(0x195)];else{if(_0x5bbc8a[0x0][_0x4b8560(0x1c7)]==_0x4b8560(0x1dd))var _0x544752=users[_0x4b8560(0x1b6)];}}}}}}}_0x179c18[_0x4b8560(0x15d)](_0x4b8560(0x188),{'success':_0x19093a[_0x4b8560(0x1ea)](_0x4b8560(0x1d2)),'errors':_0x19093a[_0x4b8560(0x1ea)]('errors'),'role':_0x2a4929,'profile':_0x1091ed,'adjustment':_0x2a1e24,'stock':_0x4407cc,'master_shop':_0x5bbc8a,'warehouse_name':_0x5822ce,'unit':_0x290fb5,'language':_0x544752});}catch(_0x1996fe){console['log'](_0x1996fe),_0x179c18['status'](0xc8)['json']({'message':_0x1996fe[_0x4b8560(0x172)]});}}),router[a0_0x2bea79(0x196)](a0_0x2bea79(0x15e),auth,async(_0x3e708f,_0x47cdfa)=>{var _0x34bc83=a0_0x2bea79;try{const {invoice:_0xd01be3,warehouse_name:_0x436883,Room_name:_0x832994}=_0x3e708f[_0x34bc83(0x156)],_0x471101=_0x3e708f[_0x34bc83(0x191)]['id'],_0x38acf0=await adjustment_finished[_0x34bc83(0x14a)]({'_id':_0x471101});var _0x39391b;const _0x323fdd=_0x38acf0[_0x34bc83(0x1a7)][_0x34bc83(0x18e)](async _0x3aa8c4=>{var _0xb51af0=_0x34bc83;if(_0x3aa8c4[_0xb51af0(0x16f)]>0x0){_0x39391b=await warehouse[_0xb51af0(0x1f7)]({'name':_0x436883,'room':_0x3aa8c4[_0xb51af0(0x187)]});const _0x51fc94=_0x39391b['product_details']['map'](_0x54b23d=>{var _0xcff833=_0xb51af0;console[_0xcff833(0x1f0)](_0x3aa8c4[_0xcff833(0x169)]);if(_0x3aa8c4[_0xcff833(0x169)]==_0xcff833(0x152))_0x54b23d[_0xcff833(0x1f8)]==_0x3aa8c4[_0xcff833(0x165)]&&(_0x54b23d['product_stock']=_0x54b23d[_0xcff833(0x19a)]-_0x3aa8c4[_0xcff833(0x16f)]);else _0x3aa8c4[_0xcff833(0x169)]==_0xcff833(0x1c1)&&(_0x54b23d['_id']==_0x3aa8c4['id_transaction']&&(_0x54b23d['product_stock']=_0x54b23d[_0xcff833(0x19a)]+_0x3aa8c4[_0xcff833(0x16f)]));});}return _0x39391b;});Promise[_0x34bc83(0x18f)](_0x323fdd)[_0x34bc83(0x1a6)](async _0x3ddbdb=>{var _0x5d9d0d=_0x34bc83;try{for(const _0x56e268 of _0x3ddbdb){await _0x56e268['save']();}_0x38acf0[_0x5d9d0d(0x1f3)]=_0x5d9d0d(0x1de);const _0x1a0bdc=await _0x38acf0[_0x5d9d0d(0x1bd)](),_0x4d457d=await master_shop[_0x5d9d0d(0x180)](),_0x41e73a=await email_settings['findOne'](),_0x8d0625=await supervisor_settings['find']();var _0x3493f1=_0x38acf0['product'],_0x30329e='',_0x44241b;for(_0x44241b in _0x3493f1){var _0x37e889='FG';_0x38acf0[_0x5d9d0d(0x197)]==_0x5d9d0d(0x176)&&(_0x37e889='DG'),_0x30329e+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3493f1[_0x44241b][_0x5d9d0d(0x148)]+_0x5d9d0d(0x1e8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3493f1[_0x44241b]['product_code']+'</td>'+_0x5d9d0d(0x15c)+_0x3493f1[_0x44241b][_0x5d9d0d(0x16f)]+_0x5d9d0d(0x1e8)+_0x5d9d0d(0x15c)+_0x3493f1[_0x44241b][_0x5d9d0d(0x162)]+'</td>'+_0x5d9d0d(0x15c)+_0x3493f1[_0x44241b][_0x5d9d0d(0x1ae)]+_0x5d9d0d(0x1e8)+_0x5d9d0d(0x15c)+_0x38acf0['warehouse_name']+'</td>'+_0x5d9d0d(0x15c)+_0x3493f1[_0x44241b][_0x5d9d0d(0x187)]+_0x5d9d0d(0x1e8)+_0x5d9d0d(0x15c)+_0x37e889+_0x3493f1[_0x44241b][_0x5d9d0d(0x1e5)]+'</td>'+_0x5d9d0d(0x163);}_0x3e708f[_0x5d9d0d(0x1ea)](_0x5d9d0d(0x1d2),_0x5d9d0d(0x1b7)),_0x47cdfa[_0x5d9d0d(0x199)](_0x5d9d0d(0x154)+_0x1a0bdc[_0x5d9d0d(0x1f8)]);}catch(_0x440696){console['error'](_0x440696),_0x47cdfa[_0x5d9d0d(0x1f9)](0x1f4)[_0x5d9d0d(0x17c)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x3d224b=>{var _0x12835a=_0x34bc83;console[_0x12835a(0x1ac)](_0x3d224b),_0x47cdfa[_0x12835a(0x1f9)](0x1f4)['json']({'error':_0x12835a(0x192)});});}catch(_0x11bb72){_0x47cdfa[_0x34bc83(0x17c)]({'message':_0x11bb72[_0x34bc83(0x172)]});}}),router[a0_0x2bea79(0x1ca)](a0_0x2bea79(0x16d),auth,async(_0x1bc885,_0x1f27c8)=>{var _0x5bcda0=a0_0x2bea79;try{const {username:_0x19a497,email:_0x527784,role:_0x135d7d}=_0x1bc885[_0x5bcda0(0x15f)],_0x5fd0e=_0x1bc885[_0x5bcda0(0x15f)],_0x4dd975=await profile[_0x5bcda0(0x1f7)]({'email':_0x5fd0e[_0x5bcda0(0x1da)]}),_0x3f48c2=await master_shop['find']();console[_0x5bcda0(0x1f0)](_0x5bcda0(0x16a),_0x3f48c2);const _0x2ce3ae=_0x1bc885[_0x5bcda0(0x191)]['id'],_0x30a87e=await adjustment_finished['findById']({'_id':_0x2ce3ae});let _0x30fd02=new Date(_0x30a87e[_0x5bcda0(0x1f2)]),_0x16643f=('0'+_0x30fd02[_0x5bcda0(0x149)]())[_0x5bcda0(0x1cf)](-0x2),_0x311161=('0'+(_0x30fd02[_0x5bcda0(0x167)]()+0x1))['slice'](-0x2),_0x49929f=_0x30fd02['getFullYear'](),_0x2f39=_0x49929f+'-'+_0x311161+'-'+_0x16643f;var _0x206efb=[_0x5bcda0(0x1a5),_0x5bcda0(0x19e),'Return\x20Rooms'];const _0x6fc1a7=await purchases['aggregate']([{'$match':{'warehouse_name':_0x30a87e[_0x5bcda0(0x197)]}},{'$unwind':_0x5bcda0(0x189)},{'$group':{'_id':_0x5bcda0(0x1c8)}}]);console[_0x5bcda0(0x1f0)](_0x5bcda0(0x1b4),_0x6fc1a7);const _0x254ddc=await product['find']({}),_0x2a49b8=await warehouse[_0x5bcda0(0x19d)]([{'$match':{'name':_0x30a87e[_0x5bcda0(0x197)],'room':_0x30a87e[_0x5bcda0(0x1c9)]}},{'$unwind':_0x5bcda0(0x181)},{'$group':{'_id':_0x5bcda0(0x1ce),'name':{'$first':_0x5bcda0(0x1b3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5bcda0(0x1d4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5bcda0(0x16b)},'floorlevel':{'$first':_0x5bcda0(0x1ec)},'primary_code':{'$first':_0x5bcda0(0x1dc)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5bcda0(0x166)},'rack':{'$first':_0x5bcda0(0x184)}}}]);if(_0x3f48c2[0x0]['language']=='English\x20(US)'){var _0x223a0d=users[_0x5bcda0(0x1e3)];console[_0x5bcda0(0x1f0)](_0x223a0d);}else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x1c2))var _0x223a0d=users[_0x5bcda0(0x1c2)];else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x157))var _0x223a0d=users[_0x5bcda0(0x157)];else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x158))var _0x223a0d=users['Spanish'];else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x15a))var _0x223a0d=users[_0x5bcda0(0x15a)];else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x160))var _0x223a0d=users[_0x5bcda0(0x1d3)];else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x195))var _0x223a0d=users['Chinese'];else{if(_0x3f48c2[0x0][_0x5bcda0(0x1c7)]==_0x5bcda0(0x1dd))var _0x223a0d=users[_0x5bcda0(0x1b6)];}}}}}}}_0x1f27c8[_0x5bcda0(0x15d)]('edit_adjustment_finished',{'success':_0x1bc885[_0x5bcda0(0x1ea)](_0x5bcda0(0x1d2)),'errors':_0x1bc885[_0x5bcda0(0x1ea)]('errors'),'role':_0x5fd0e,'profile':_0x4dd975,'adjustment':_0x30a87e,'stock':_0x2a49b8,'master_shop':_0x3f48c2,'warehouse_name':_0x6fc1a7,'unit':_0x254ddc,'language':_0x223a0d,'rooms_data':_0x206efb,'ed_fullDate':_0x2f39});}catch(_0xbd18c3){console[_0x5bcda0(0x1f0)](_0xbd18c3),_0x1f27c8[_0x5bcda0(0x1f9)](0xc8)[_0x5bcda0(0x17c)]({'message':_0xbd18c3[_0x5bcda0(0x172)]});}}),router[a0_0x2bea79(0x196)]('/view/:id',auth,async(_0x5e9066,_0x186344)=>{var _0x5dcc0a=a0_0x2bea79;try{const _0x4704f0=_0x5e9066[_0x5dcc0a(0x191)]['id'],_0xa38252=await adjustment_finished[_0x5dcc0a(0x14a)]({'_id':_0x4704f0}),_0x49f73a=await warehouse[_0x5dcc0a(0x1f7)]({'name':_0xa38252[_0x5dcc0a(0x197)],'room':_0xa38252['room']}),{warehouse_name:_0x1b7463,date:_0x1319b0,prod_name:_0x5286a4,level:_0x13a048,isle:_0x28596e,pallet:_0xba2c20,stock:_0x2646f4,types:_0x33c4e0,adjust_qty:_0x3fab87,new_adjust_qty:_0x359189,note:_0x45c6a7,Room_name:_0x5e58d8,invoice:_0xbbb916,JO_number:_0x142c8d}=_0x5e9066[_0x5dcc0a(0x156)];if(typeof _0x5286a4==_0x5dcc0a(0x1e2))var _0x1f336c=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x1a2)]],_0x2fe3d1=[_0x5e9066[_0x5dcc0a(0x156)]['level']],_0x2cd98a=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x17d)]],_0x48dbc2=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x169)]],_0x4bada3=[_0x5e9066[_0x5dcc0a(0x156)]['adjust_qty']],_0x222308=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x1a9)]],_0xb3364e=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x17e)]],_0x252cb7=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x162)]],_0x595e9b=[_0x5e9066[_0x5dcc0a(0x156)]['Secondary_units']],_0x38f129=[_0x5e9066['body']['batch_code']],_0x58caab=[_0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x1f2)]];else var _0x1f336c=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x1a2)]],_0x2fe3d1=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x147)]],_0x2cd98a=[..._0x5e9066[_0x5dcc0a(0x156)]['stock']],_0x48dbc2=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x169)]],_0x4bada3=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x16f)]],_0x222308=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x1a9)]],_0xb3364e=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x17e)]],_0x252cb7=[..._0x5e9066[_0x5dcc0a(0x156)]['unit']],_0x595e9b=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x14c)]],_0x38f129=[..._0x5e9066[_0x5dcc0a(0x156)][_0x5dcc0a(0x1d5)]],_0x58caab=[..._0x5e9066['body'][_0x5dcc0a(0x1f2)]];const _0x22aa24=_0x1f336c[_0x5dcc0a(0x18e)](_0x217332=>{return _0x217332={'product_name':_0x217332};});_0x2fe3d1['forEach']((_0x1f2947,_0x16f639)=>{var _0x469ec4=_0x5dcc0a;_0x22aa24[_0x16f639][_0x469ec4(0x1e5)]=_0x1f2947;}),_0x2cd98a[_0x5dcc0a(0x164)]((_0x3a4a66,_0x26ddb8)=>{var _0x233798=_0x5dcc0a;_0x22aa24[_0x26ddb8][_0x233798(0x1b1)]=_0x3a4a66;}),_0x48dbc2[_0x5dcc0a(0x164)]((_0x4e352d,_0x46bbf5)=>{var _0x35aef4=_0x5dcc0a;_0x22aa24[_0x46bbf5][_0x35aef4(0x169)]=_0x4e352d;}),_0x4bada3[_0x5dcc0a(0x164)]((_0x525eb4,_0x58bee0)=>{_0x22aa24[_0x58bee0]['adjust_qty']=_0x525eb4;}),_0x222308[_0x5dcc0a(0x164)]((_0x5a9eac,_0x45381b)=>{var _0x54fbaf=_0x5dcc0a;_0x22aa24[_0x45381b][_0x54fbaf(0x1a9)]=_0x5a9eac;}),_0x252cb7['forEach']((_0x56537d,_0x32b171)=>{_0x22aa24[_0x32b171]['unit']=_0x56537d;}),_0x595e9b[_0x5dcc0a(0x164)]((_0x52a178,_0x489441)=>{_0x22aa24[_0x489441]['secondary_unit']=_0x52a178;}),_0xb3364e[_0x5dcc0a(0x164)]((_0x876e9f,_0x58aaad)=>{_0x22aa24[_0x58aaad]['product_code']=_0x876e9f;}),_0x38f129[_0x5dcc0a(0x164)]((_0x13725a,_0x1bcb57)=>{var _0x5ddcbf=_0x5dcc0a;_0x22aa24[_0x1bcb57][_0x5ddcbf(0x1d5)]=_0x13725a;}),_0x58caab['forEach']((_0x4dac51,_0x509709)=>{var _0x3d7884=_0x5dcc0a;_0x22aa24[_0x509709][_0x3d7884(0x1f2)]=_0x4dac51;});const _0x46bac7=_0x22aa24[_0x5dcc0a(0x1ed)](_0x3d4e91=>_0x3d4e91[_0x5dcc0a(0x16f)]!=='0'&&_0x3d4e91[_0x5dcc0a(0x16f)]!=='');var _0x3c5232=0x0;_0x46bac7[_0x5dcc0a(0x164)](_0x5038e5=>{var _0xf11d76=_0x5dcc0a;console['log'](_0xf11d76(0x175),_0x5038e5),parseInt(_0x5038e5[_0xf11d76(0x16f)])<=0x0&&_0x3c5232++;});if(_0x3c5232!=0x0)return _0x5e9066[_0x5dcc0a(0x1ea)](_0x5dcc0a(0x1d9),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x186344[_0x5dcc0a(0x199)](_0x5dcc0a(0x1a8));_0xa38252[_0x5dcc0a(0x197)]=_0x1b7463,_0xa38252[_0x5dcc0a(0x153)]=_0x1319b0,_0xa38252[_0x5dcc0a(0x1a7)]=_0x46bac7,_0xa38252[_0x5dcc0a(0x190)]=_0x45c6a7,_0xa38252[_0x5dcc0a(0x1c9)]=_0x5e58d8,_0xa38252[_0x5dcc0a(0x1e9)]=_0xbbb916,_0xa38252[_0x5dcc0a(0x173)]=_0x142c8d;const _0x1793e6=await _0xa38252[_0x5dcc0a(0x1bd)](),_0xdbcae5=await warehouse[_0x5dcc0a(0x1f7)]({'name':_0x1b7463,'room':_0x5e58d8});_0x1793e6[_0x5dcc0a(0x1a7)][_0x5dcc0a(0x164)](_0x393e86=>{var _0x2be29c=_0x5dcc0a;const _0x285259=_0xdbcae5[_0x2be29c(0x1eb)][_0x2be29c(0x18e)](_0x510a89=>{var _0x577695=_0x2be29c;_0x393e86[_0x577695(0x169)]==_0x577695(0x152)?_0x510a89['product_name']==_0x393e86[_0x577695(0x148)]&&_0x510a89[_0x577695(0x1e5)]==_0x393e86[_0x577695(0x1e5)]&&(_0x510a89['product_stock']=parseInt(_0x510a89[_0x577695(0x19a)])-parseInt(_0x393e86[_0x577695(0x16f)])):_0x510a89[_0x577695(0x148)]==_0x393e86[_0x577695(0x148)]&&_0x510a89[_0x577695(0x1e5)]==_0x393e86[_0x577695(0x1e5)]&&(_0x510a89[_0x577695(0x19a)]=parseInt(_0x510a89[_0x577695(0x19a)])+parseInt(_0x393e86[_0x577695(0x16f)]));});}),await _0xdbcae5[_0x5dcc0a(0x1bd)](),_0x5e9066['flash'](_0x5dcc0a(0x1d2),_0x5dcc0a(0x1bf)),_0x186344['redirect'](_0x5dcc0a(0x179));}catch(_0x100ef8){console[_0x5dcc0a(0x1f0)](_0x100ef8);}}),router[a0_0x2bea79(0x196)](a0_0x2bea79(0x1aa),async(_0x3ca509,_0x24062e)=>{var _0x359d11=a0_0x2bea79;const {primary_code:_0x3dbb5d,warehouse_data:_0x3d64da,rooms_data:_0x2f08ad,Roomslist:_0xc2d920}=_0x3ca509['body'],_0xc49cdd=_0xc2d920[_0x359d11(0x1f5)](','),_0x24ed80=[];async function _0x507302(_0x51ae1b){var _0x238b6e=_0x359d11;const _0xfecb14=await warehouse[_0x238b6e(0x19d)]([{'$match':{'name':_0x3d64da,'room':_0x51ae1b}},{'$unwind':_0x238b6e(0x181)},{'$match':{'product_details.primary_code':_0x3dbb5d}},{'$group':{'_id':_0x238b6e(0x1ce),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x238b6e(0x19c)},'primary_code':{'$first':_0x238b6e(0x1dc)},'secondary_code':{'$first':_0x238b6e(0x1e6)},'product_code':{'$first':_0x238b6e(0x1ba)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x238b6e(0x1d4)},'type':{'$first':_0x238b6e(0x16b)},'pallet':{'$first':_0x238b6e(0x1ec)},'unit':{'$first':_0x238b6e(0x1ee)},'secondary_unit':{'$first':_0x238b6e(0x182)},'storage':{'$first':_0x238b6e(0x166)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x238b6e(0x1cd)},'production_date':{'$first':_0x238b6e(0x1cc)},'batch_code':{'$first':_0x238b6e(0x15b)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x238b6e(0x174)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x238b6e(0x18c)}}}]),_0x35d5a1=await warehouse[_0x238b6e(0x19d)]([{'$match':{'name':_0x3d64da,'room':_0x51ae1b}},{'$unwind':_0x238b6e(0x181)},{'$match':{'product_details.secondary_code':_0x3dbb5d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x238b6e(0x1b3)},'product_stock':{'$first':_0x238b6e(0x19c)},'primary_code':{'$first':_0x238b6e(0x1dc)},'secondary_code':{'$first':_0x238b6e(0x1e6)},'product_code':{'$first':_0x238b6e(0x1ba)},'level':{'$first':'$product_details.level'},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x238b6e(0x16b)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x238b6e(0x1ee)},'secondary_unit':{'$first':_0x238b6e(0x182)},'storage':{'$first':_0x238b6e(0x166)},'rack':{'$first':_0x238b6e(0x184)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x238b6e(0x1cc)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x238b6e(0x174)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0xfecb14[_0x238b6e(0x1b0)]>0x0)_0x24ed80[_0x238b6e(0x1c4)](_0xfecb14);else _0x35d5a1[_0x238b6e(0x1b0)]>0x0&&_0x24ed80[_0x238b6e(0x1c4)](_0x35d5a1);}const _0x14bfb6=_0xc49cdd[_0x359d11(0x18e)](_0x456cbd=>_0x507302(_0x456cbd));await Promise['all'](_0x14bfb6),_0x24062e['json'](_0x24ed80);}),router['post'](a0_0x2bea79(0x1d1),async(_0xfa628b,_0x4881ed)=>{var _0x313af2=a0_0x2bea79;const {productCode:_0x27da34,bay:_0x280871,warehouses:_0x32fed7,room:_0x272d58}=_0xfa628b[_0x313af2(0x156)];console[_0x313af2(0x1f0)](_0xfa628b['body']);try{const _0x205e9d=await warehouse[_0x313af2(0x19d)]([{'$match':{'name':_0x32fed7,'room':_0x272d58}},{'$unwind':_0x313af2(0x181)},{'$match':{'product_details.bay':parseInt(_0x280871)}},{'$group':{'_id':_0x313af2(0x1ce),'name':{'$first':_0x313af2(0x1b3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x313af2(0x1d4)},'maxProducts':{'$first':_0x313af2(0x1ef)}}}]);_0x4881ed[_0x313af2(0x1f9)](0xc8)['json'](_0x205e9d);}catch(_0x298622){_0x4881ed[_0x313af2(0x1f9)](0x194)[_0x313af2(0x17c)]({'message':_0x298622[_0x313af2(0x172)]});}}),module[a0_0x2bea79(0x1f1)]=router;