var a0_0xf14bb3=a0_0x5e83;function a0_0x306a(){var _0x52eeaa=['_id','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','foreach\x20newproduct','maxPerUnit','$product_details._id','Hindi','error','Return\x20Rooms','edit_adjustment_finished_view','Enclosed','$product_details.invoice','$room','forEach','types','/view/add_adjustment_logs','new_adjust_qty','get','body','padStart','prod_invoice','redirect','True','There\x27s\x20a\x20error\x20in\x20this\x20transaction','status','$product_details.bin','string','role','$product_details.secondary_unit','expiry_date','match','invoice','language','staff','$product_details.batch_code','$product_details.storage','findOne','1046FrTxlx','$product_details.unit','add_adjustment_finished_logs','$product_details.production_date','Chinese','/adjustment_finished/preview/','JO_number','product_name','message','aggregate','floor','prod_name','$date','flash','Enabled','room_names','length','prod_code','/view/add_adjustment','German','getFullYear','product_stock','user','log','14044824WFgfyi','adjustment\x20data\x20update\x20successfully','/picking_list/PDF_adjustmentFinal/','Ambient','then','New_Qty_Converted','An\x20error\x20occurred.','/CheckingWarehouse','product','ADJ-','email','$_id','push','invoice_init','/preview/:id','bay','production_date','$product_details.primary_code','$product_details.bay','538083SYTkoM','1850631StUIhc','product_details','master','toString','An\x20error\x20occurred\x20while\x20saving\x20data.','New_Qty_Converted_adj','$product_details.product_name','$name','product_code','Portuguese','English\x20(US)','purchases_data','English','stock','$product_details.floorlevel','Arabic','adjustment\x20add\x20successfull','../middleware/auth','success','$finalize','$product.product_name','level','58258872SCBuHF','DRY\x20GOODS','Primary_Units','slice','split','back','Adjustment\x20Finalize\x20Successfully','minus','unit','stockBefore','Arabic\x20(ae)','Spanish','json','findById','batch_code','add_adjustment_finished','French','$product_details.secondary_code','map','room','$product_details.product_code','824682tTevGQ','50ynutsd','$product','$warehouse_name','</td>','getDate','id_transaction','note','adjust_qty','/view_logs','add','$product_details.rack','$product_details.maxProducts','date','ADJF-','warehouse_name','all','Rooms','$product_details.type','random','save','$product_details.product_stock','id_transaction_from','Secondary_units','/view/:id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.room_names','params','$invoice','6249084kUsFkn','$product_details.expiry_date','product_date','logs','errors','exports','filter','find','Portuguese\x20(BR)','warehouse','post','catch','$product_details.level','Router','9474cHViCD','render','$product_details','prod_cat'];a0_0x306a=function(){return _0x52eeaa;};return a0_0x306a();}(function(_0x66bb5d,_0x1da438){var _0x25c1d8=a0_0x5e83,_0x230bf8=_0x66bb5d();while(!![]){try{var _0x3de899=-parseInt(_0x25c1d8(0x193))/0x1+parseInt(_0x25c1d8(0x167))/0x2*(-parseInt(_0x25c1d8(0x1e9))/0x3)+-parseInt(_0x25c1d8(0x1db))/0x4+parseInt(_0x25c1d8(0x1bf))/0x5*(parseInt(_0x25c1d8(0x1be))/0x6)+-parseInt(_0x25c1d8(0x192))/0x7+-parseInt(_0x25c1d8(0x17f))/0x8+parseInt(_0x25c1d8(0x1a9))/0x9;if(_0x3de899===_0x1da438)break;else _0x230bf8['push'](_0x230bf8['shift']());}catch(_0x347eb5){_0x230bf8['push'](_0x230bf8['shift']());}}}(a0_0x306a,0xe818e));const express=require('express'),app=express(),router=express[a0_0xf14bb3(0x1e8)](),auth=require(a0_0xf14bb3(0x1a4)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require('nodemailer');router[a0_0xf14bb3(0x153)]('/view',auth,async(_0xd69763,_0x38fe20)=>{var _0x5112f7=a0_0xf14bb3;try{const {username:_0x3afe4d,email:_0x3880d,role:_0x3f57f0}=_0xd69763[_0x5112f7(0x17d)],_0x23b894=_0xd69763['user'],_0xd3ea97=await profile[_0x5112f7(0x166)]({'email':_0x23b894[_0x5112f7(0x189)]}),_0x2d3092=await master_shop[_0x5112f7(0x1e2)]();let _0x29564d;if(_0x23b894[_0x5112f7(0x15d)]==_0x5112f7(0x163)){const _0x54a3bc=await staff['findOne']({'email':_0x23b894[_0x5112f7(0x189)]});_0x29564d=await warehouse[_0x5112f7(0x1e2)]({'status':_0x5112f7(0x175),'name':_0x54a3bc['warehouse']});}else _0x29564d=await warehouse[_0x5112f7(0x1e2)]({'status':_0x5112f7(0x175)});const _0x55a56f=await product['find']();let _0x220743;if(_0x23b894[_0x5112f7(0x15d)]=='staff'){const _0x575840=await staff[_0x5112f7(0x166)]({'email':_0x23b894[_0x5112f7(0x189)]});_0x220743=await adjustment_finished['find']({'warehouse_name':_0x575840[_0x5112f7(0x1e4)]});}else _0x220743=await adjustment_finished[_0x5112f7(0x170)]([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0x5112f7(0x1c0)},{'$group':{'_id':_0x5112f7(0x18a),'invoice':{'$first':_0x5112f7(0x1da)},'date':{'$first':_0x5112f7(0x173)},'warehouse_name':{'$first':_0x5112f7(0x1c1)},'room':{'$addToSet':_0x5112f7(0x1d8)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2d3092[0x0][_0x5112f7(0x162)]==_0x5112f7(0x19d)){var _0x52b7fe=users[_0x5112f7(0x19f)];console['log'](_0x52b7fe);}else{if(_0x2d3092[0x0]['language']=='Hindi')var _0x52b7fe=users[_0x5112f7(0x1f2)];else{if(_0x2d3092[0x0][_0x5112f7(0x162)]=='German')var _0x52b7fe=users[_0x5112f7(0x17a)];else{if(_0x2d3092[0x0]['language']=='Spanish')var _0x52b7fe=users[_0x5112f7(0x1b4)];else{if(_0x2d3092[0x0]['language']==_0x5112f7(0x1b9))var _0x52b7fe=users[_0x5112f7(0x1b9)];else{if(_0x2d3092[0x0][_0x5112f7(0x162)]==_0x5112f7(0x1e3))var _0x52b7fe=users['Portuguese'];else{if(_0x2d3092[0x0][_0x5112f7(0x162)]==_0x5112f7(0x16b))var _0x52b7fe=users['Chinese'];else{if(_0x2d3092[0x0][_0x5112f7(0x162)]=='Arabic\x20(ae)')var _0x52b7fe=users[_0x5112f7(0x1a2)];}}}}}}}_0x38fe20[_0x5112f7(0x1ea)]('adjustment_finished',{'success':_0xd69763[_0x5112f7(0x174)](_0x5112f7(0x1a5)),'errors':_0xd69763['flash']('errors'),'role':_0x23b894,'profile':_0xd3ea97,'warehouse':_0x29564d,'product':_0x55a56f,'adjustment':_0x220743,'master_shop':_0x2d3092,'language':_0x52b7fe});}catch(_0x223f58){console[_0x5112f7(0x17e)](_0x223f58);}}),router['get'](a0_0xf14bb3(0x1c7),auth,async(_0x2126a7,_0x3f9c75)=>{var _0x1dcf27=a0_0xf14bb3;try{const {username:_0xd20352,email:_0x466e3a,role:_0x5db0be}=_0x2126a7[_0x1dcf27(0x17d)],_0x20adcd=_0x2126a7['user'],_0x428ca4=await profile[_0x1dcf27(0x166)]({'email':_0x20adcd[_0x1dcf27(0x189)]}),_0x2a0478=await master_shop[_0x1dcf27(0x1e2)]();let _0x6d7d95;if(_0x20adcd[_0x1dcf27(0x15d)]==_0x1dcf27(0x163)){const _0x5dd54f=await staff[_0x1dcf27(0x166)]({'email':_0x20adcd[_0x1dcf27(0x189)]});_0x6d7d95=await warehouse['find']({'status':'Enabled','name':_0x5dd54f[_0x1dcf27(0x1e4)]});}else _0x6d7d95=await warehouse[_0x1dcf27(0x1e2)]({'status':'Enabled'});const _0x33fbec=await product[_0x1dcf27(0x1e2)]();let _0x5db3dc;if(_0x20adcd[_0x1dcf27(0x15d)]==_0x1dcf27(0x163)){const _0x319dcd=await staff[_0x1dcf27(0x166)]({'email':_0x20adcd[_0x1dcf27(0x189)]});_0x5db3dc=await adjustment_finished[_0x1dcf27(0x1e2)]({'warehouse_name':_0x319dcd[_0x1dcf27(0x1e4)]});}else _0x5db3dc=await adjustment_finished[_0x1dcf27(0x170)]([{'$match':{'type_of_transaction':_0x1dcf27(0x1de)}},{'$unwind':_0x1dcf27(0x1c0)},{'$group':{'_id':_0x1dcf27(0x18a),'invoice':{'$first':_0x1dcf27(0x1da)},'date':{'$first':_0x1dcf27(0x173)},'warehouse_name':{'$first':_0x1dcf27(0x1c1)},'room':{'$addToSet':_0x1dcf27(0x1d8)},'finalize':{'$first':_0x1dcf27(0x1a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2a0478[0x0][_0x1dcf27(0x162)]=='English\x20(US)')var _0x3f0a90=users[_0x1dcf27(0x19f)];else{if(_0x2a0478[0x0]['language']==_0x1dcf27(0x1f2))var _0x3f0a90=users[_0x1dcf27(0x1f2)];else{if(_0x2a0478[0x0][_0x1dcf27(0x162)]==_0x1dcf27(0x17a))var _0x3f0a90=users[_0x1dcf27(0x17a)];else{if(_0x2a0478[0x0][_0x1dcf27(0x162)]=='Spanish')var _0x3f0a90=users[_0x1dcf27(0x1b4)];else{if(_0x2a0478[0x0][_0x1dcf27(0x162)]=='French')var _0x3f0a90=users[_0x1dcf27(0x1b9)];else{if(_0x2a0478[0x0][_0x1dcf27(0x162)]==_0x1dcf27(0x1e3))var _0x3f0a90=users[_0x1dcf27(0x19c)];else{if(_0x2a0478[0x0]['language']=='Chinese')var _0x3f0a90=users[_0x1dcf27(0x16b)];else{if(_0x2a0478[0x0][_0x1dcf27(0x162)]=='Arabic\x20(ae)')var _0x3f0a90=users['Arabic'];}}}}}}}_0x3f9c75[_0x1dcf27(0x1ea)]('adjustment_finished_logs',{'success':_0x2126a7[_0x1dcf27(0x174)]('success'),'errors':_0x2126a7[_0x1dcf27(0x174)](_0x1dcf27(0x1df)),'role':_0x20adcd,'profile':_0x428ca4,'warehouse':_0x6d7d95,'product':_0x33fbec,'adjustment':_0x5db3dc,'master_shop':_0x2a0478,'language':_0x3f0a90});}catch(_0x3d7312){console[_0x1dcf27(0x17e)](_0x3d7312);}});async function getRandom8DigitNumber(){var _0x1b25ba=a0_0xf14bb3;const _0x38e218=0x989680,_0x11d9fd=0x5f5e0ff,_0x543b77=Math[_0x1b25ba(0x171)](Math[_0x1b25ba(0x1d1)]()*(_0x11d9fd-_0x38e218+0x1))+_0x38e218;var _0x5c0dcd;const _0x339039=await adjustment_finished['findOne']({'invoice':_0x1b25ba(0x1cc)+_0x543b77});return _0x339039&&_0x339039[_0x1b25ba(0x177)]>0x0?_0x5c0dcd=_0x1b25ba(0x1cc)+_0x543b77:_0x5c0dcd=_0x1b25ba(0x1cc)+_0x543b77,_0x5c0dcd;}function a0_0x5e83(_0x560b9c,_0x235108){var _0x306af6=a0_0x306a();return a0_0x5e83=function(_0x5e83d0,_0x1ec3d3){_0x5e83d0=_0x5e83d0-0x14e;var _0x378014=_0x306af6[_0x5e83d0];return _0x378014;},a0_0x5e83(_0x560b9c,_0x235108);}router[a0_0xf14bb3(0x153)]('/view/add_adjustment',auth,async(_0x18004a,_0x4ce9b)=>{var _0xf6ea7a=a0_0xf14bb3;try{const {username:_0x25d4c2,email:_0xdb60f5,role:_0x4e7621}=_0x18004a[_0xf6ea7a(0x17d)],_0x42c77d=_0x18004a['user'],_0x16e316=await profile[_0xf6ea7a(0x166)]({'email':_0x42c77d[_0xf6ea7a(0x189)]}),_0x5e480d=await master_shop[_0xf6ea7a(0x1e2)]();let _0x3eb2c3;if(_0x42c77d[_0xf6ea7a(0x15d)]=='staff'){const _0x1e852a=await staff[_0xf6ea7a(0x166)]({'email':_0x42c77d['email']});_0x3eb2c3=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x1e852a[_0xf6ea7a(0x1e4)]}},{'$group':{'_id':'$name','name':{'$first':_0xf6ea7a(0x19a)}}}]);}else _0x3eb2c3=await warehouse[_0xf6ea7a(0x170)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xf6ea7a(0x19a),'name':{'$first':_0xf6ea7a(0x19a)}}}]);const _0x3008cc=await product[_0xf6ea7a(0x1e2)]({}),_0x19215e=await adjustment_finished[_0xf6ea7a(0x1e2)](),_0x35b420=_0x19215e[_0xf6ea7a(0x177)]+0x1,_0x5208eb=_0xf6ea7a(0x1cc)+_0x35b420[_0xf6ea7a(0x196)]()[_0xf6ea7a(0x155)](0x5,'0');var _0x58ec58=[_0xf6ea7a(0x182),_0xf6ea7a(0x1f6),_0xf6ea7a(0x1f4)];if(_0x5e480d[0x0]['language']=='English\x20(US)')var _0x6b9a03=users[_0xf6ea7a(0x19f)];else{if(_0x5e480d[0x0][_0xf6ea7a(0x162)]==_0xf6ea7a(0x1f2))var _0x6b9a03=users[_0xf6ea7a(0x1f2)];else{if(_0x5e480d[0x0]['language']==_0xf6ea7a(0x17a))var _0x6b9a03=users['German'];else{if(_0x5e480d[0x0]['language']==_0xf6ea7a(0x1b4))var _0x6b9a03=users[_0xf6ea7a(0x1b4)];else{if(_0x5e480d[0x0][_0xf6ea7a(0x162)]==_0xf6ea7a(0x1b9))var _0x6b9a03=users[_0xf6ea7a(0x1b9)];else{if(_0x5e480d[0x0][_0xf6ea7a(0x162)]==_0xf6ea7a(0x1e3))var _0x6b9a03=users[_0xf6ea7a(0x19c)];else{if(_0x5e480d[0x0][_0xf6ea7a(0x162)]==_0xf6ea7a(0x16b))var _0x6b9a03=users['Chinese'];else{if(_0x5e480d[0x0][_0xf6ea7a(0x162)]==_0xf6ea7a(0x1b3))var _0x6b9a03=users[_0xf6ea7a(0x1a2)];}}}}}}}const _0xd63e58=getRandom8DigitNumber();_0xd63e58[_0xf6ea7a(0x183)](_0x384997=>{var _0x910fac=_0xf6ea7a;_0x4ce9b[_0x910fac(0x1ea)](_0x910fac(0x1b8),{'success':_0x18004a[_0x910fac(0x174)]('success'),'errors':_0x18004a[_0x910fac(0x174)](_0x910fac(0x1df)),'role':_0x42c77d,'profile':_0x16e316,'warehouse':_0x3eb2c3,'product':_0x3008cc,'master_shop':_0x5e480d,'language':_0x6b9a03,'rooms_data':_0x58ec58,'invoice_no':_0x384997});})[_0xf6ea7a(0x1e6)](_0x378333=>{var _0x4f16c0=_0xf6ea7a;_0x18004a[_0x4f16c0(0x174)](_0x4f16c0(0x1df),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4ce9b[_0x4f16c0(0x157)]('/adjustment/view');});}catch(_0x3e776e){console[_0xf6ea7a(0x17e)](_0x3e776e);}}),router['post'](a0_0xf14bb3(0x179),auth,async(_0x4d4076,_0x4b5ba4)=>{var _0x504367=a0_0xf14bb3;try{const {warehouse_name:_0x10aa63,date:_0x7f3a19,prod_name:_0x278134,level:_0x16f1c1,isle:_0x595d4f,pallet:_0x58b8a4,stock:_0x3ce1c3,types:_0xa5424f,adjust_qty:_0x3b4cfa,new_adjust_qty:_0xaef083,note:_0x3c30e3,Room_name:_0x8dcfe2,JO_number:_0x4fb67b,expiry_date:_0x58540e,PO_number:_0x15628b,ReqBy:_0x502b04,dateofreq:_0x42322f,typeservicesData:_0x2b6517,destination:_0x433d56,deliverydate:_0x2eb622,driver:_0x1bb15e,plate:_0x42b75e,van:_0x47604d,DRSI:_0x4b1300,typevehicle:_0x2500a9,TSU:_0x3cbe9d,TFU:_0x23f724}=_0x4d4076[_0x504367(0x154)];if(typeof _0x278134=='string')var _0x3b888f=[_0x4d4076['body'][_0x504367(0x172)]],_0x4e15e7=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1a8)]],_0x15f876=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1a0)]],_0x4213da=[_0x4d4076[_0x504367(0x154)]['types']],_0x17fa19=[_0x4d4076[_0x504367(0x154)][_0x504367(0x198)]],_0x240027=[_0x4d4076[_0x504367(0x154)][_0x504367(0x184)]],_0x3e34af=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1ab)]],_0xff533f=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1d5)]],_0x58e00f=[_0x4d4076['body']['prod_code']],_0x2e16af=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1b7)]],_0x89b4ea=[_0x4d4076[_0x504367(0x154)][_0x504367(0x15f)]],_0x60b6df=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1dd)]],_0x2f52cd=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1ec)]],_0x20c978=[_0x4d4076['body']['Rooms']],_0x5d0f27=[_0x4d4076[_0x504367(0x154)]['maxPerUnit']],_0x2042e9=[_0x4d4076[_0x504367(0x154)]['prod_invoice']],_0x145ae8=[_0x4d4076[_0x504367(0x154)][_0x504367(0x1d4)]];else var _0x3b888f=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x172)]],_0x4e15e7=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x1a8)]],_0x15f876=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x1a0)]],_0x4213da=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x150)]],_0x17fa19=[..._0x4d4076[_0x504367(0x154)]['New_Qty_Converted_adj']],_0x240027=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x184)]],_0x3e34af=[..._0x4d4076[_0x504367(0x154)]['Primary_Units']],_0xff533f=[..._0x4d4076[_0x504367(0x154)]['Secondary_units']],_0x58e00f=[..._0x4d4076['body'][_0x504367(0x178)]],_0x2e16af=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x1b7)]],_0x89b4ea=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x15f)]],_0x60b6df=[..._0x4d4076[_0x504367(0x154)]['product_date']],_0x2f52cd=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x1ec)]],_0x20c978=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x1cf)]],_0x5d0f27=[..._0x4d4076['body']['maxPerUnit']],_0x2042e9=[..._0x4d4076[_0x504367(0x154)][_0x504367(0x156)]],_0x145ae8=[..._0x4d4076['body'][_0x504367(0x1d4)]];const _0x2ee0a5=_0x3b888f['map'](_0x3b4e89=>{return _0x3b4e89={'product_name':_0x3b4e89};});_0x4e15e7[_0x504367(0x14f)]((_0x15e29b,_0x948003)=>{var _0x327b83=_0x504367,_0x1d1997=_0x15e29b['match'](/[A-Za-z]+/)[0x0],_0xb3da5a=parseInt(_0x15e29b[_0x327b83(0x160)](/\d+/)[0x0]);_0x2ee0a5[_0x948003]['level']=_0x1d1997,_0x2ee0a5[_0x948003][_0x327b83(0x18e)]=_0xb3da5a;}),_0x145ae8[_0x504367(0x14f)]((_0x4827d3,_0x2d7601)=>{var _0x31d43d=_0x504367;_0x2ee0a5[_0x2d7601][_0x31d43d(0x1c4)]=_0x4827d3;}),_0x15f876[_0x504367(0x14f)]((_0xbfb90b,_0x170ba0)=>{var _0x9e3eb0=_0x504367;_0x2ee0a5[_0x170ba0][_0x9e3eb0(0x1b2)]=_0xbfb90b;}),_0x4213da[_0x504367(0x14f)]((_0x42228d,_0x30a0c9)=>{_0x2ee0a5[_0x30a0c9]['types']=_0x42228d;}),_0x17fa19[_0x504367(0x14f)]((_0x32d3be,_0x478ca7)=>{var _0x3be6e0=_0x504367;_0x2ee0a5[_0x478ca7][_0x3be6e0(0x1c6)]=_0x32d3be;}),_0x240027[_0x504367(0x14f)]((_0x2a0390,_0x1e4db8)=>{var _0x4c02fa=_0x504367;_0x2ee0a5[_0x1e4db8][_0x4c02fa(0x152)]=_0x2a0390;}),_0x3e34af['forEach']((_0x5003b4,_0x214602)=>{var _0xc8cb3e=_0x504367;_0x2ee0a5[_0x214602][_0xc8cb3e(0x1b1)]=_0x5003b4;}),_0xff533f['forEach']((_0x1cc4e5,_0x388012)=>{_0x2ee0a5[_0x388012]['secondary_unit']=_0x1cc4e5;}),_0x58e00f[_0x504367(0x14f)]((_0xc5a942,_0x49dee7)=>{var _0x183851=_0x504367;_0x2ee0a5[_0x49dee7][_0x183851(0x19b)]=_0xc5a942;}),_0x2e16af[_0x504367(0x14f)]((_0x2af3d5,_0x11e979)=>{var _0x191376=_0x504367;_0x2ee0a5[_0x11e979][_0x191376(0x1b7)]=_0x2af3d5;}),_0x89b4ea['forEach']((_0x4a6639,_0x3ef25d)=>{_0x2ee0a5[_0x3ef25d]['expiry_date']=_0x4a6639;}),_0x60b6df[_0x504367(0x14f)]((_0x4d7dc1,_0x512e36)=>{var _0x5e3615=_0x504367;_0x2ee0a5[_0x512e36][_0x5e3615(0x18f)]=_0x4d7dc1;}),_0x2f52cd[_0x504367(0x14f)]((_0x161118,_0x4f0398)=>{_0x2ee0a5[_0x4f0398]['prod_cat']=_0x161118;}),_0x20c978[_0x504367(0x14f)]((_0x16629c,_0x444c28)=>{var _0xb49655=_0x504367;_0x2ee0a5[_0x444c28][_0xb49655(0x176)]=_0x16629c;}),_0x5d0f27[_0x504367(0x14f)]((_0xcad429,_0x7ce766)=>{var _0x44fa7c=_0x504367;_0x2ee0a5[_0x7ce766][_0x44fa7c(0x1f0)]=_0xcad429;}),_0x2042e9[_0x504367(0x14f)]((_0x4a002a,_0x4a1a16)=>{var _0x534059=_0x504367;_0x2ee0a5[_0x4a1a16][_0x534059(0x161)]=_0x4a002a;});const _0x590799=_0x2ee0a5[_0x504367(0x1e1)](_0x1381bc=>_0x1381bc[_0x504367(0x1c6)]!=='0'&&_0x1381bc[_0x504367(0x1c6)]!=='');var _0x3976a1=0x0;_0x590799[_0x504367(0x14f)](_0x136ad6=>{var _0x3c7c88=_0x504367;console['log'](_0x3c7c88(0x1ef),_0x136ad6),parseInt(_0x136ad6[_0x3c7c88(0x1c6)])<=0x0&&_0x3976a1++;});if(_0x3976a1!=0x0)return _0x4d4076[_0x504367(0x174)](_0x504367(0x1df),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x4b5ba4[_0x504367(0x157)](_0x504367(0x1ae));const _0xe51033=new invoice_for_adjustment();await _0xe51033[_0x504367(0x1d2)]();const _0x466e6b=new adjustment_finished({'warehouse_name':_0x10aa63,'date':_0x7f3a19,'product':_0x590799,'note':_0x3c30e3,'room':_0x8dcfe2,'invoice':_0x504367(0x188)+_0xe51033['invoice_init'][_0x504367(0x196)]()[_0x504367(0x155)](0x8,'0'),'JO_number':_0x4fb67b,'expiry_date':_0x58540e,'PO_number':_0x15628b,'RequestedBy':_0x502b04,'DateofRequest':_0x42322f,'typeservices':_0x2b6517,'destination':_0x433d56,'deliverydate':_0x2eb622,'driver':_0x1bb15e,'plate':_0x42b75e,'van':_0x47604d,'DRSI':_0x4b1300,'typevehicle':_0x2500a9,'TSU':_0x3cbe9d,'TFU':_0x23f724}),_0x2c7e5c=await _0x466e6b[_0x504367(0x1d2)]();_0x4d4076[_0x504367(0x174)](_0x504367(0x1a5),_0x504367(0x1a3)),_0x4b5ba4[_0x504367(0x157)](_0x504367(0x16c)+_0x2c7e5c[_0x504367(0x1ed)]);}catch(_0x3a3d87){console['log'](_0x3a3d87),_0x4b5ba4[_0x504367(0x15a)](0xc8)['json']({'message':_0x3a3d87[_0x504367(0x16f)]});}}),router[a0_0xf14bb3(0x153)](a0_0xf14bb3(0x151),auth,async(_0x11f946,_0x59c4f7)=>{var _0x4b5559=a0_0xf14bb3;try{const {username:_0x558304,email:_0x5b9aa4,role:_0x2b9266}=_0x11f946['user'],_0x3bc405=_0x11f946[_0x4b5559(0x17d)],_0x42ff49=await profile[_0x4b5559(0x166)]({'email':_0x3bc405['email']}),_0xa27f6=await master_shop[_0x4b5559(0x1e2)]();let _0x29616c;if(_0x3bc405[_0x4b5559(0x15d)]==_0x4b5559(0x163)){const _0x4d46a5=await staff[_0x4b5559(0x166)]({'email':_0x3bc405[_0x4b5559(0x189)]});_0x29616c=await warehouse[_0x4b5559(0x170)]([{'$match':{'status':_0x4b5559(0x175),'name':_0x4d46a5[_0x4b5559(0x1e4)]}},{'$group':{'_id':_0x4b5559(0x19a),'name':{'$first':_0x4b5559(0x19a)}}}]);}else _0x29616c=await warehouse['aggregate']([{'$match':{'status':_0x4b5559(0x175)}},{'$group':{'_id':'$name','name':{'$first':_0x4b5559(0x19a)}}}]);const _0x34d8db=await product[_0x4b5559(0x1e2)](),_0x21c4c7=await adjustment_finished[_0x4b5559(0x1e2)](),_0x337461=_0x21c4c7[_0x4b5559(0x177)]+0x1,_0x111827='ADJF-'+_0x337461[_0x4b5559(0x196)]()[_0x4b5559(0x155)](0x5,'0');var _0x5bb019=[_0x4b5559(0x182),'Enclosed',_0x4b5559(0x1f4)];if(_0xa27f6[0x0][_0x4b5559(0x162)]==_0x4b5559(0x19d))var _0x55ddab=users[_0x4b5559(0x19f)];else{if(_0xa27f6[0x0]['language']==_0x4b5559(0x1f2))var _0x55ddab=users['Hindi'];else{if(_0xa27f6[0x0][_0x4b5559(0x162)]=='German')var _0x55ddab=users[_0x4b5559(0x17a)];else{if(_0xa27f6[0x0]['language']==_0x4b5559(0x1b4))var _0x55ddab=users[_0x4b5559(0x1b4)];else{if(_0xa27f6[0x0][_0x4b5559(0x162)]==_0x4b5559(0x1b9))var _0x55ddab=users[_0x4b5559(0x1b9)];else{if(_0xa27f6[0x0]['language']==_0x4b5559(0x1e3))var _0x55ddab=users[_0x4b5559(0x19c)];else{if(_0xa27f6[0x0][_0x4b5559(0x162)]=='Chinese')var _0x55ddab=users[_0x4b5559(0x16b)];else{if(_0xa27f6[0x0][_0x4b5559(0x162)]==_0x4b5559(0x1b3))var _0x55ddab=users['Arabic'];}}}}}}}const _0x31d8dc=getRandom8DigitNumber();_0x31d8dc[_0x4b5559(0x183)](_0x3fcb1c=>{var _0x4b6c58=_0x4b5559;_0x59c4f7[_0x4b6c58(0x1ea)](_0x4b6c58(0x169),{'success':_0x11f946['flash']('success'),'errors':_0x11f946[_0x4b6c58(0x174)]('errors'),'role':_0x3bc405,'profile':_0x42ff49,'warehouse':_0x29616c,'product':_0x34d8db,'master_shop':_0xa27f6,'language':_0x55ddab,'rooms_data':_0x5bb019,'invoice_no':_0x3fcb1c});})['catch'](_0x271d7=>{var _0x4e4d55=_0x4b5559;_0x11f946[_0x4e4d55(0x174)](_0x4e4d55(0x1df),_0x4e4d55(0x159)),_0x59c4f7['redirect']('/adjustment/view');});}catch(_0x368b13){console['log'](_0x368b13);}}),router[a0_0xf14bb3(0x1e5)](a0_0xf14bb3(0x151),auth,async(_0x1418f2,_0x5107d0)=>{var _0xaa00ab=a0_0xf14bb3;try{const {warehouse_name:_0x2d198d,date:_0x1bc013,prod_name:_0x192091,level:_0x2fb02d,isle:_0x2d4dcb,pallet:_0x541b91,stock:_0x3dd6d9,types:_0x29e3ff,adjust_qty:_0x58b554,new_adjust_qty:_0x4c8072,note:_0x2ddc10,Room_name:_0x4b257a,JO_number:_0x160244,expiry_date:_0x3fcb0b,type_of_transaction:_0x127f1e,PO_number:_0x4ed98a,ReqBy:_0x11d6d2,dateofreq:_0x5836bd,typeservicesData:_0x22d381,destination:_0x33714d,deliverydate:_0x32ab6e,driver:_0x2955f1,plate:_0x2654d2,van:_0x4eab3c,DRSI:_0x54bdfc,typevehicle:_0x3ba099,TSU:_0x309a3e,TFU:_0x585dd5}=_0x1418f2['body'];if(typeof _0x192091==_0xaa00ab(0x15c))var _0x50b83b=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x172)]],_0x5a9048=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1a8)]],_0x5edc38=[_0x1418f2[_0xaa00ab(0x154)]['stock']],_0x1ea32e=[_0x1418f2[_0xaa00ab(0x154)]['types']],_0x2bbcc0=[_0x1418f2['body'][_0xaa00ab(0x198)]],_0x44bec8=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x184)]],_0x5df4b0=[_0x1418f2['body']['Primary_Units']],_0x3aab37=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1d5)]],_0x448a88=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x178)]],_0x183d01=[_0x1418f2[_0xaa00ab(0x154)]['batch_code']],_0x597df4=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x15f)]],_0x50c486=[_0x1418f2[_0xaa00ab(0x154)]['product_date']],_0x507ce7=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1ec)]],_0xff8346=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1cf)]],_0x399859=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1f0)]],_0x3148a9=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x156)]],_0x2578f1=[_0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1d4)]];else var _0x50b83b=[..._0x1418f2['body'][_0xaa00ab(0x172)]],_0x5a9048=[..._0x1418f2[_0xaa00ab(0x154)]['level']],_0x5edc38=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1a0)]],_0x1ea32e=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x150)]],_0x2bbcc0=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x198)]],_0x44bec8=[..._0x1418f2['body']['New_Qty_Converted']],_0x5df4b0=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1ab)]],_0x3aab37=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1d5)]],_0x448a88=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x178)]],_0x183d01=[..._0x1418f2[_0xaa00ab(0x154)]['batch_code']],_0x597df4=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x15f)]],_0x50c486=[..._0x1418f2['body'][_0xaa00ab(0x1dd)]],_0x507ce7=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1ec)]],_0xff8346=[..._0x1418f2[_0xaa00ab(0x154)]['Rooms']],_0x399859=[..._0x1418f2[_0xaa00ab(0x154)]['maxPerUnit']],_0x3148a9=[..._0x1418f2[_0xaa00ab(0x154)]['prod_invoice']],_0x2578f1=[..._0x1418f2[_0xaa00ab(0x154)][_0xaa00ab(0x1d4)]];const _0x1f4499=_0x50b83b[_0xaa00ab(0x1bb)](_0x36bfb8=>{return _0x36bfb8={'product_name':_0x36bfb8};});_0x5a9048['forEach']((_0x3ffb4b,_0x156d43)=>{var _0xcf99e4=_0xaa00ab,_0x1bab9a=_0x3ffb4b[_0xcf99e4(0x160)](/[A-Za-z]+/)[0x0],_0x31a61f=parseInt(_0x3ffb4b['match'](/\d+/)[0x0]);_0x1f4499[_0x156d43][_0xcf99e4(0x1a8)]=_0x1bab9a,_0x1f4499[_0x156d43][_0xcf99e4(0x18e)]=_0x31a61f;}),_0x2578f1[_0xaa00ab(0x14f)]((_0x5958cb,_0x44c7cd)=>{_0x1f4499[_0x44c7cd]['id_transaction']=_0x5958cb;}),_0x5edc38['forEach']((_0xa8f8e8,_0x52cbd3)=>{_0x1f4499[_0x52cbd3]['stockBefore']=_0xa8f8e8;}),_0x1ea32e[_0xaa00ab(0x14f)]((_0x24ec8a,_0x4599ea)=>{var _0x3ce372=_0xaa00ab;_0x1f4499[_0x4599ea][_0x3ce372(0x150)]=_0x24ec8a;}),_0x2bbcc0[_0xaa00ab(0x14f)]((_0x377499,_0x5408fc)=>{var _0x3a431a=_0xaa00ab;_0x1f4499[_0x5408fc][_0x3a431a(0x1c6)]=_0x377499;}),_0x44bec8['forEach']((_0x1763ef,_0x241594)=>{_0x1f4499[_0x241594]['new_adjust_qty']=_0x1763ef;}),_0x5df4b0['forEach']((_0x5ce3ac,_0x1fbf55)=>{var _0x7cc4c4=_0xaa00ab;_0x1f4499[_0x1fbf55][_0x7cc4c4(0x1b1)]=_0x5ce3ac;}),_0x3aab37[_0xaa00ab(0x14f)]((_0x5c9167,_0x454f8f)=>{_0x1f4499[_0x454f8f]['secondary_unit']=_0x5c9167;}),_0x448a88['forEach']((_0x55bf1c,_0x4a6567)=>{var _0x443f30=_0xaa00ab;_0x1f4499[_0x4a6567][_0x443f30(0x19b)]=_0x55bf1c;}),_0x183d01['forEach']((_0x213865,_0x22452b)=>{var _0xf0a90c=_0xaa00ab;_0x1f4499[_0x22452b][_0xf0a90c(0x1b7)]=_0x213865;}),_0x597df4[_0xaa00ab(0x14f)]((_0x2198ba,_0x116538)=>{_0x1f4499[_0x116538]['expiry_date']=_0x2198ba;}),_0x50c486[_0xaa00ab(0x14f)]((_0x39af0e,_0x4e1348)=>{var _0x41bc10=_0xaa00ab;_0x1f4499[_0x4e1348][_0x41bc10(0x18f)]=_0x39af0e;}),_0x507ce7[_0xaa00ab(0x14f)]((_0x4acf2e,_0x1b009d)=>{_0x1f4499[_0x1b009d]['prod_cat']=_0x4acf2e;}),_0xff8346[_0xaa00ab(0x14f)]((_0x96e647,_0x2e28fc)=>{_0x1f4499[_0x2e28fc]['room_names']=_0x96e647;}),_0x399859[_0xaa00ab(0x14f)]((_0x2859fc,_0x513a65)=>{var _0x3446ee=_0xaa00ab;_0x1f4499[_0x513a65][_0x3446ee(0x1f0)]=_0x2859fc;}),_0x3148a9[_0xaa00ab(0x14f)]((_0x5285fe,_0x461469)=>{var _0xc62fcd=_0xaa00ab;_0x1f4499[_0x461469][_0xc62fcd(0x161)]=_0x5285fe;});const _0x30b5ff=_0x1f4499[_0xaa00ab(0x1e1)](_0x4a037e=>_0x4a037e[_0xaa00ab(0x1c6)]!=='0'&&_0x4a037e['adjust_qty']!=='');var _0x45e8a0=0x0;_0x30b5ff[_0xaa00ab(0x14f)](_0x34ed5f=>{var _0x86e90e=_0xaa00ab;console[_0x86e90e(0x17e)](_0x86e90e(0x1ef),_0x34ed5f),parseInt(_0x34ed5f[_0x86e90e(0x1c6)])<=0x0&&_0x45e8a0++;});if(_0x45e8a0!=0x0)return _0x1418f2[_0xaa00ab(0x174)](_0xaa00ab(0x1df),_0xaa00ab(0x1ee)),_0x5107d0['redirect']('back');const _0x37856e=new adjustment_logs();await _0x37856e[_0xaa00ab(0x1d2)]();const _0x1896c5=new adjustment_finished({'warehouse_name':_0x2d198d,'date':_0x1bc013,'product':_0x30b5ff,'note':_0x2ddc10,'room':_0x4b257a,'invoice':'LOG-ADJ-'+_0x37856e[_0xaa00ab(0x18c)][_0xaa00ab(0x196)]()[_0xaa00ab(0x155)](0x8,'0'),'JO_number':_0x160244,'expiry_date':_0x3fcb0b,'type_of_transaction':_0x127f1e,'PO_number':_0x4ed98a,'RequestedBy':_0x11d6d2,'DateofRequest':_0x5836bd,'typeservices':_0x22d381,'destination':_0x33714d,'deliverydate':_0x32ab6e,'driver':_0x2955f1,'plate':_0x2654d2,'van':_0x4eab3c,'DRSI':_0x54bdfc,'typevehicle':_0x3ba099,'TSU':_0x309a3e,'TFU':_0x585dd5}),_0x52bd76=await _0x1896c5[_0xaa00ab(0x1d2)]();_0x1418f2[_0xaa00ab(0x174)]('success',_0xaa00ab(0x1a3)),_0x5107d0['redirect'](_0xaa00ab(0x16c)+_0x52bd76['_id']);}catch(_0x4897fc){console[_0xaa00ab(0x17e)](_0x4897fc),_0x5107d0[_0xaa00ab(0x15a)](0xc8)['json']({'message':_0x4897fc[_0xaa00ab(0x16f)]});}}),router[a0_0xf14bb3(0x153)](a0_0xf14bb3(0x18d),auth,async(_0x86cbda,_0x20e5c3)=>{var _0x177f78=a0_0xf14bb3;try{const {username:_0x19e930,email:_0x4e9331,role:_0x4a875b}=_0x86cbda[_0x177f78(0x17d)],_0x5b46ba=_0x86cbda['user'],_0x566f2e=await profile[_0x177f78(0x166)]({'email':_0x5b46ba[_0x177f78(0x189)]}),_0x44a568=await master_shop[_0x177f78(0x1e2)](),_0x111287=_0x86cbda['params']['id'],_0x5a59e5=await adjustment_finished[_0x177f78(0x1b6)]({'_id':_0x111287}),_0x511586=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5a59e5['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0x177f78(0x1a7)}}]);console[_0x177f78(0x17e)](_0x177f78(0x19e),_0x511586);const _0x4f2430=await product['find']({}),_0x5479d2=await warehouse[_0x177f78(0x170)]([{'$match':{'name':_0x5a59e5[_0x177f78(0x1cd)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x177f78(0x1f1),'name':{'$first':_0x177f78(0x199)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x177f78(0x191)},'bin':{'$first':_0x177f78(0x15b)},'type':{'$first':_0x177f78(0x1d0)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x177f78(0x190)},'secondary_code':{'$first':_0x177f78(0x1ba)},'product_code':{'$first':_0x177f78(0x1bd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x177f78(0x1c9)},'expiry_date':{'$first':_0x177f78(0x1dc)},'production_date':{'$first':_0x177f78(0x16a)},'batch_code':{'$first':_0x177f78(0x164)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':'$room'}}}]);if(_0x44a568[0x0][_0x177f78(0x162)]==_0x177f78(0x19d)){var _0x9db5fd=users['English'];console['log'](_0x9db5fd);}else{if(_0x44a568[0x0][_0x177f78(0x162)]=='Hindi')var _0x9db5fd=users['Hindi'];else{if(_0x44a568[0x0][_0x177f78(0x162)]==_0x177f78(0x17a))var _0x9db5fd=users[_0x177f78(0x17a)];else{if(_0x44a568[0x0]['language']==_0x177f78(0x1b4))var _0x9db5fd=users['Spanish'];else{if(_0x44a568[0x0][_0x177f78(0x162)]==_0x177f78(0x1b9))var _0x9db5fd=users['French'];else{if(_0x44a568[0x0][_0x177f78(0x162)]=='Portuguese\x20(BR)')var _0x9db5fd=users[_0x177f78(0x19c)];else{if(_0x44a568[0x0]['language']==_0x177f78(0x16b))var _0x9db5fd=users['Chinese'];else{if(_0x44a568[0x0][_0x177f78(0x162)]==_0x177f78(0x1b3))var _0x9db5fd=users[_0x177f78(0x1a2)];}}}}}}}_0x20e5c3[_0x177f78(0x1ea)](_0x177f78(0x1f5),{'success':_0x86cbda['flash'](_0x177f78(0x1a5)),'errors':_0x86cbda[_0x177f78(0x174)](_0x177f78(0x1df)),'role':_0x5b46ba,'profile':_0x566f2e,'adjustment':_0x5a59e5,'stock':_0x5479d2,'master_shop':_0x44a568,'warehouse_name':_0x511586,'unit':_0x4f2430,'language':_0x9db5fd});}catch(_0x487c33){console[_0x177f78(0x17e)](_0x487c33),_0x20e5c3[_0x177f78(0x15a)](0xc8)[_0x177f78(0x1b5)]({'message':_0x487c33['message']});}}),router[a0_0xf14bb3(0x1e5)](a0_0xf14bb3(0x18d),auth,async(_0x5c7498,_0x95e681)=>{var _0x2b4d00=a0_0xf14bb3;try{const {invoice:_0x506e73,warehouse_name:_0x4297bc,Room_name:_0x224bf3}=_0x5c7498[_0x2b4d00(0x154)],_0x5ad47d=_0x5c7498[_0x2b4d00(0x1d9)]['id'],_0xdeccee=await adjustment_finished['findById']({'_id':_0x5ad47d});var _0x2171f7;const _0x48477a=_0xdeccee['product'][_0x2b4d00(0x1bb)](async _0x4eb670=>{var _0x54309c=_0x2b4d00;if(_0x4eb670[_0x54309c(0x1c6)]>0x0){_0x2171f7=await warehouse[_0x54309c(0x166)]({'name':_0x4297bc,'room':_0x4eb670['room_names']});const _0x3f671d=_0x2171f7[_0x54309c(0x194)]['map'](_0x51aca1=>{var _0x55e1f7=_0x54309c;console[_0x55e1f7(0x17e)](_0x4eb670['types']);if(_0x4eb670[_0x55e1f7(0x150)]==_0x55e1f7(0x1b0))_0x51aca1[_0x55e1f7(0x1ed)]==_0x4eb670[_0x55e1f7(0x1c4)]&&(_0x51aca1[_0x55e1f7(0x17c)]=_0x51aca1['product_stock']-_0x4eb670['adjust_qty']);else _0x4eb670[_0x55e1f7(0x150)]==_0x55e1f7(0x1c8)&&(_0x51aca1['_id']==_0x4eb670[_0x55e1f7(0x1c4)]&&(_0x51aca1[_0x55e1f7(0x17c)]=_0x51aca1['product_stock']+_0x4eb670[_0x55e1f7(0x1c6)]));});}return _0x2171f7;});Promise[_0x2b4d00(0x1ce)](_0x48477a)[_0x2b4d00(0x183)](async _0xf437d9=>{var _0x3e012b=_0x2b4d00;try{for(const _0x142352 of _0xf437d9){await _0x142352[_0x3e012b(0x1d2)]();}_0xdeccee['finalize']=_0x3e012b(0x158);const _0x56db0a=await _0xdeccee[_0x3e012b(0x1d2)](),_0x24d8f5=await master_shop[_0x3e012b(0x1e2)](),_0x5c08d7=await email_settings[_0x3e012b(0x166)](),_0xd3dc38=await supervisor_settings[_0x3e012b(0x1e2)]();var _0x2dcce9=_0xdeccee['product'],_0x5904ba='',_0x5d1332;for(_0x5d1332 in _0x2dcce9){var _0x4e5f11='FG';_0xdeccee[_0x3e012b(0x1cd)]==_0x3e012b(0x1aa)&&(_0x4e5f11='DG'),_0x5904ba+='<tr>'+_0x3e012b(0x1d7)+_0x2dcce9[_0x5d1332][_0x3e012b(0x16e)]+'</td>'+_0x3e012b(0x1d7)+_0x2dcce9[_0x5d1332][_0x3e012b(0x19b)]+_0x3e012b(0x1c2)+_0x3e012b(0x1d7)+_0x2dcce9[_0x5d1332][_0x3e012b(0x1c6)]+_0x3e012b(0x1c2)+_0x3e012b(0x1d7)+_0x2dcce9[_0x5d1332][_0x3e012b(0x1b1)]+'</td>'+_0x3e012b(0x1d7)+_0x2dcce9[_0x5d1332]['secondary_unit']+_0x3e012b(0x1c2)+_0x3e012b(0x1d7)+_0xdeccee[_0x3e012b(0x1cd)]+'</td>'+_0x3e012b(0x1d7)+_0x2dcce9[_0x5d1332][_0x3e012b(0x176)]+_0x3e012b(0x1c2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4e5f11+_0x2dcce9[_0x5d1332][_0x3e012b(0x18e)]+_0x3e012b(0x1c2)+'</tr>';}_0x5c7498[_0x3e012b(0x174)](_0x3e012b(0x1a5),_0x3e012b(0x1af)),_0x95e681['redirect'](_0x3e012b(0x181)+_0x56db0a['_id']);}catch(_0x155437){console['error'](_0x155437),_0x95e681[_0x3e012b(0x15a)](0x1f4)[_0x3e012b(0x1b5)]({'error':_0x3e012b(0x197)});}})[_0x2b4d00(0x1e6)](_0x4448ca=>{var _0x456648=_0x2b4d00;console[_0x456648(0x1f3)](_0x4448ca),_0x95e681['status'](0x1f4)[_0x456648(0x1b5)]({'error':_0x456648(0x185)});});}catch(_0x3eb905){_0x95e681[_0x2b4d00(0x1b5)]({'message':_0x3eb905[_0x2b4d00(0x16f)]});}}),router[a0_0xf14bb3(0x153)](a0_0xf14bb3(0x1d6),auth,async(_0x534fb7,_0x388422)=>{var _0x4dd457=a0_0xf14bb3;try{const {username:_0x26169a,email:_0x505cd0,role:_0x4e77dd}=_0x534fb7['user'],_0xfb2d71=_0x534fb7[_0x4dd457(0x17d)],_0x54be1a=await profile[_0x4dd457(0x166)]({'email':_0xfb2d71[_0x4dd457(0x189)]}),_0x5215d7=await master_shop[_0x4dd457(0x1e2)]();console[_0x4dd457(0x17e)](_0x4dd457(0x195),_0x5215d7);const _0x1e82ce=_0x534fb7[_0x4dd457(0x1d9)]['id'],_0x361977=await adjustment_finished[_0x4dd457(0x1b6)]({'_id':_0x1e82ce});let _0x2e0d94=new Date(_0x361977[_0x4dd457(0x15f)]),_0x36e6f5=('0'+_0x2e0d94[_0x4dd457(0x1c3)]())['slice'](-0x2),_0x1ad44d=('0'+(_0x2e0d94['getMonth']()+0x1))[_0x4dd457(0x1ac)](-0x2),_0x38b3de=_0x2e0d94[_0x4dd457(0x17b)](),_0x170e45=_0x38b3de+'-'+_0x1ad44d+'-'+_0x36e6f5;var _0x185744=['Ambient',_0x4dd457(0x1f6),_0x4dd457(0x1f4)];const _0x39351=await purchases['aggregate']([{'$match':{'warehouse_name':_0x361977['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0x4dd457(0x1a7)}}]);console[_0x4dd457(0x17e)](_0x4dd457(0x19e),_0x39351);const _0x4ac418=await product[_0x4dd457(0x1e2)]({}),_0x57ef05=await warehouse[_0x4dd457(0x170)]([{'$match':{'name':_0x361977['warehouse_name'],'room':_0x361977[_0x4dd457(0x1bc)]}},{'$unwind':_0x4dd457(0x1eb)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4dd457(0x199)},'product_stock':{'$first':_0x4dd457(0x1d3)},'bay':{'$first':_0x4dd457(0x191)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4dd457(0x1d0)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4dd457(0x190)},'secondary_code':{'$first':_0x4dd457(0x1ba)},'product_code':{'$first':_0x4dd457(0x1bd)},'storage':{'$first':_0x4dd457(0x165)},'rack':{'$first':_0x4dd457(0x1c9)}}}]);if(_0x5215d7[0x0][_0x4dd457(0x162)]==_0x4dd457(0x19d)){var _0x2424bb=users[_0x4dd457(0x19f)];console[_0x4dd457(0x17e)](_0x2424bb);}else{if(_0x5215d7[0x0][_0x4dd457(0x162)]==_0x4dd457(0x1f2))var _0x2424bb=users[_0x4dd457(0x1f2)];else{if(_0x5215d7[0x0][_0x4dd457(0x162)]==_0x4dd457(0x17a))var _0x2424bb=users['German'];else{if(_0x5215d7[0x0][_0x4dd457(0x162)]=='Spanish')var _0x2424bb=users[_0x4dd457(0x1b4)];else{if(_0x5215d7[0x0][_0x4dd457(0x162)]==_0x4dd457(0x1b9))var _0x2424bb=users[_0x4dd457(0x1b9)];else{if(_0x5215d7[0x0][_0x4dd457(0x162)]=='Portuguese\x20(BR)')var _0x2424bb=users['Portuguese'];else{if(_0x5215d7[0x0][_0x4dd457(0x162)]=='Chinese')var _0x2424bb=users[_0x4dd457(0x16b)];else{if(_0x5215d7[0x0][_0x4dd457(0x162)]==_0x4dd457(0x1b3))var _0x2424bb=users[_0x4dd457(0x1a2)];}}}}}}}_0x388422[_0x4dd457(0x1ea)]('edit_adjustment_finished',{'success':_0x534fb7[_0x4dd457(0x174)](_0x4dd457(0x1a5)),'errors':_0x534fb7[_0x4dd457(0x174)](_0x4dd457(0x1df)),'role':_0xfb2d71,'profile':_0x54be1a,'adjustment':_0x361977,'stock':_0x57ef05,'master_shop':_0x5215d7,'warehouse_name':_0x39351,'unit':_0x4ac418,'language':_0x2424bb,'rooms_data':_0x185744,'ed_fullDate':_0x170e45});}catch(_0x20f149){console['log'](_0x20f149),_0x388422['status'](0xc8)[_0x4dd457(0x1b5)]({'message':_0x20f149[_0x4dd457(0x16f)]});}}),router[a0_0xf14bb3(0x1e5)](a0_0xf14bb3(0x1d6),auth,async(_0x3af65b,_0x2433b9)=>{var _0x3b541c=a0_0xf14bb3;try{const _0x469d01=_0x3af65b[_0x3b541c(0x1d9)]['id'],_0x46def8=await adjustment_finished[_0x3b541c(0x1b6)]({'_id':_0x469d01}),_0x5038d0=await warehouse[_0x3b541c(0x166)]({'name':_0x46def8['warehouse_name'],'room':_0x46def8['room']}),{warehouse_name:_0x5e0e50,date:_0x1c06e9,prod_name:_0x19063f,level:_0x45fc27,isle:_0x194714,pallet:_0xc2dc1f,stock:_0x556013,types:_0x373aa2,adjust_qty:_0x44b9b1,new_adjust_qty:_0x2cb317,note:_0x5edb84,Room_name:_0x83e591,invoice:_0x2a9dc3,JO_number:_0x2217b5}=_0x3af65b[_0x3b541c(0x154)];if(typeof _0x19063f=='string')var _0x21df96=[_0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x172)]],_0xcb7276=[_0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x1a8)]],_0x46747a=[_0x3af65b[_0x3b541c(0x154)]['stock']],_0x4d7dfe=[_0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x150)]],_0x3fc5e2=[_0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x1c6)]],_0x1ca501=[_0x3af65b['body']['new_adjust_qty']],_0x37a5df=[_0x3af65b['body']['prod_code']],_0x4cbc5b=[_0x3af65b[_0x3b541c(0x154)]['unit']],_0x177a61=[_0x3af65b['body'][_0x3b541c(0x1d5)]],_0x27a909=[_0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x1b7)]],_0x1b59d1=[_0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x15f)]];else var _0x21df96=[..._0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x172)]],_0xcb7276=[..._0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x1a8)]],_0x46747a=[..._0x3af65b[_0x3b541c(0x154)]['stock']],_0x4d7dfe=[..._0x3af65b['body'][_0x3b541c(0x150)]],_0x3fc5e2=[..._0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x1c6)]],_0x1ca501=[..._0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x152)]],_0x37a5df=[..._0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x178)]],_0x4cbc5b=[..._0x3af65b[_0x3b541c(0x154)][_0x3b541c(0x1b1)]],_0x177a61=[..._0x3af65b['body'][_0x3b541c(0x1d5)]],_0x27a909=[..._0x3af65b[_0x3b541c(0x154)]['batch_code']],_0x1b59d1=[..._0x3af65b['body'][_0x3b541c(0x15f)]];const _0x35a36c=_0x21df96[_0x3b541c(0x1bb)](_0x247213=>{return _0x247213={'product_name':_0x247213};});_0xcb7276[_0x3b541c(0x14f)]((_0x1a0835,_0x1ab943)=>{var _0x4dd9f4=_0x3b541c;_0x35a36c[_0x1ab943][_0x4dd9f4(0x18e)]=_0x1a0835;}),_0x46747a['forEach']((_0x2948ef,_0x5b70c4)=>{_0x35a36c[_0x5b70c4]['stockBefore']=_0x2948ef;}),_0x4d7dfe['forEach']((_0x5ae6e7,_0x2dd7ae)=>{var _0x12b75e=_0x3b541c;_0x35a36c[_0x2dd7ae][_0x12b75e(0x150)]=_0x5ae6e7;}),_0x3fc5e2[_0x3b541c(0x14f)]((_0x47603b,_0x49b458)=>{var _0x22bc80=_0x3b541c;_0x35a36c[_0x49b458][_0x22bc80(0x1c6)]=_0x47603b;}),_0x1ca501['forEach']((_0x4c051f,_0x1d600c)=>{var _0x4f9b9c=_0x3b541c;_0x35a36c[_0x1d600c][_0x4f9b9c(0x152)]=_0x4c051f;}),_0x4cbc5b[_0x3b541c(0x14f)]((_0x33caf3,_0x50399f)=>{var _0x34b6ae=_0x3b541c;_0x35a36c[_0x50399f][_0x34b6ae(0x1b1)]=_0x33caf3;}),_0x177a61[_0x3b541c(0x14f)]((_0x54b33f,_0x12b012)=>{_0x35a36c[_0x12b012]['secondary_unit']=_0x54b33f;}),_0x37a5df['forEach']((_0x1b7249,_0x54c7f4)=>{var _0x3be078=_0x3b541c;_0x35a36c[_0x54c7f4][_0x3be078(0x19b)]=_0x1b7249;}),_0x27a909[_0x3b541c(0x14f)]((_0x28be43,_0x58ab04)=>{var _0x581eb0=_0x3b541c;_0x35a36c[_0x58ab04][_0x581eb0(0x1b7)]=_0x28be43;}),_0x1b59d1[_0x3b541c(0x14f)]((_0x3b9753,_0x4b7a3d)=>{var _0x1d37ae=_0x3b541c;_0x35a36c[_0x4b7a3d][_0x1d37ae(0x15f)]=_0x3b9753;});const _0x3c69a3=_0x35a36c[_0x3b541c(0x1e1)](_0x1f192c=>_0x1f192c[_0x3b541c(0x1c6)]!=='0'&&_0x1f192c[_0x3b541c(0x1c6)]!=='');var _0x54a0f8=0x0;_0x3c69a3[_0x3b541c(0x14f)](_0x1a1bd=>{var _0x2c8939=_0x3b541c;console[_0x2c8939(0x17e)](_0x2c8939(0x1ef),_0x1a1bd),parseInt(_0x1a1bd[_0x2c8939(0x1c6)])<=0x0&&_0x54a0f8++;});if(_0x54a0f8!=0x0)return _0x3af65b[_0x3b541c(0x174)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x2433b9[_0x3b541c(0x157)](_0x3b541c(0x1ae));_0x46def8[_0x3b541c(0x1cd)]=_0x5e0e50,_0x46def8[_0x3b541c(0x1cb)]=_0x1c06e9,_0x46def8[_0x3b541c(0x187)]=_0x3c69a3,_0x46def8[_0x3b541c(0x1c5)]=_0x5edb84,_0x46def8[_0x3b541c(0x1bc)]=_0x83e591,_0x46def8[_0x3b541c(0x161)]=_0x2a9dc3,_0x46def8[_0x3b541c(0x16d)]=_0x2217b5;const _0x543ae1=await _0x46def8['save'](),_0x7fa5e2=await warehouse[_0x3b541c(0x166)]({'name':_0x5e0e50,'room':_0x83e591});_0x543ae1[_0x3b541c(0x187)][_0x3b541c(0x14f)](_0x5e8661=>{var _0xc606ce=_0x3b541c;const _0x46e446=_0x7fa5e2[_0xc606ce(0x194)][_0xc606ce(0x1bb)](_0x464130=>{var _0x2eae36=_0xc606ce;_0x5e8661[_0x2eae36(0x150)]==_0x2eae36(0x1b0)?_0x464130[_0x2eae36(0x16e)]==_0x5e8661[_0x2eae36(0x16e)]&&_0x464130['bay']==_0x5e8661[_0x2eae36(0x18e)]&&(_0x464130[_0x2eae36(0x17c)]=parseInt(_0x464130['product_stock'])-parseInt(_0x5e8661[_0x2eae36(0x1c6)])):_0x464130[_0x2eae36(0x16e)]==_0x5e8661['product_name']&&_0x464130[_0x2eae36(0x18e)]==_0x5e8661[_0x2eae36(0x18e)]&&(_0x464130['product_stock']=parseInt(_0x464130[_0x2eae36(0x17c)])+parseInt(_0x5e8661[_0x2eae36(0x1c6)]));});}),await _0x7fa5e2['save'](),_0x3af65b[_0x3b541c(0x174)](_0x3b541c(0x1a5),_0x3b541c(0x180)),_0x2433b9[_0x3b541c(0x157)]('/adjustment_finished/view');}catch(_0x4e3a7d){console[_0x3b541c(0x17e)](_0x4e3a7d);}}),router['post']('/barcode_scanner',async(_0x3c9b09,_0x185698)=>{var _0x55dda7=a0_0xf14bb3;const {primary_code:_0x44d2f3,warehouse_data:_0x252f2e,rooms_data:_0x58c458,Roomslist:_0x581fc8}=_0x3c9b09[_0x55dda7(0x154)],_0x6023fc=_0x581fc8[_0x55dda7(0x1ad)](','),_0x198999=[];async function _0x56f142(_0x35afa1){var _0x3a1650=_0x55dda7;const _0x5328df=await warehouse[_0x3a1650(0x170)]([{'$match':{'name':_0x252f2e,'room':_0x35afa1}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x44d2f3}},{'$group':{'_id':_0x3a1650(0x1f1),'name':{'$first':_0x3a1650(0x199)},'product_stock':{'$first':_0x3a1650(0x1d3)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3a1650(0x1ba)},'product_code':{'$first':_0x3a1650(0x1bd)},'level':{'$first':_0x3a1650(0x1e7)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x3a1650(0x1d0)},'pallet':{'$first':_0x3a1650(0x1a1)},'unit':{'$first':_0x3a1650(0x168)},'secondary_unit':{'$first':_0x3a1650(0x15e)},'storage':{'$first':_0x3a1650(0x165)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3a1650(0x1dc)},'production_date':{'$first':_0x3a1650(0x16a)},'batch_code':{'$first':_0x3a1650(0x164)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x360f4d=await warehouse[_0x3a1650(0x170)]([{'$match':{'name':_0x252f2e,'room':_0x35afa1}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x44d2f3}},{'$group':{'_id':_0x3a1650(0x1f1),'name':{'$first':_0x3a1650(0x199)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3a1650(0x190)},'secondary_code':{'$first':_0x3a1650(0x1ba)},'product_code':{'$first':_0x3a1650(0x1bd)},'level':{'$first':_0x3a1650(0x1e7)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x3a1650(0x1d0)},'pallet':{'$first':_0x3a1650(0x1a1)},'unit':{'$first':_0x3a1650(0x168)},'secondary_unit':{'$first':_0x3a1650(0x15e)},'storage':{'$first':_0x3a1650(0x165)},'rack':{'$first':_0x3a1650(0x1c9)},'expiry_date':{'$first':_0x3a1650(0x1dc)},'production_date':{'$first':_0x3a1650(0x16a)},'batch_code':{'$first':_0x3a1650(0x164)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x3a1650(0x14e)},'invoice':{'$first':_0x3a1650(0x1f7)}}}]);if(_0x5328df[_0x3a1650(0x177)]>0x0)_0x198999[_0x3a1650(0x18b)](_0x5328df);else _0x360f4d[_0x3a1650(0x177)]>0x0&&_0x198999[_0x3a1650(0x18b)](_0x360f4d);}const _0x2c0018=_0x6023fc[_0x55dda7(0x1bb)](_0x3ee865=>_0x56f142(_0x3ee865));await Promise['all'](_0x2c0018),_0x185698[_0x55dda7(0x1b5)](_0x198999);}),router[a0_0xf14bb3(0x1e5)](a0_0xf14bb3(0x186),async(_0x22bd2c,_0x18faad)=>{var _0x1c4502=a0_0xf14bb3;const {productCode:_0x449b67,bay:_0x15244d,warehouses:_0x19a932,room:_0x58f779}=_0x22bd2c[_0x1c4502(0x154)];console[_0x1c4502(0x17e)](_0x22bd2c[_0x1c4502(0x154)]);try{const _0x59b23d=await warehouse['aggregate']([{'$match':{'name':_0x19a932,'room':_0x58f779}},{'$unwind':_0x1c4502(0x1eb)},{'$match':{'product_details.bay':parseInt(_0x15244d)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1c4502(0x199)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1c4502(0x191)},'maxProducts':{'$first':_0x1c4502(0x1ca)}}}]);_0x18faad['status'](0xc8)['json'](_0x59b23d);}catch(_0x111d2a){_0x18faad[_0x1c4502(0x15a)](0x194)[_0x1c4502(0x1b5)]({'message':_0x111d2a['message']});}}),module[a0_0xf14bb3(0x1e0)]=router;