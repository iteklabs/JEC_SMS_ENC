var a0_0x509be3=a0_0x164d;(function(_0x476fbf,_0x1c07ff){var _0x54fa0f=a0_0x164d,_0x52d2c9=_0x476fbf();while(!![]){try{var _0x352bf2=parseInt(_0x54fa0f(0x1b0))/0x1+parseInt(_0x54fa0f(0x1f6))/0x2+parseInt(_0x54fa0f(0x1b6))/0x3*(parseInt(_0x54fa0f(0x1fb))/0x4)+parseInt(_0x54fa0f(0x1d0))/0x5*(-parseInt(_0x54fa0f(0x21b))/0x6)+parseInt(_0x54fa0f(0x1f9))/0x7+parseInt(_0x54fa0f(0x214))/0x8*(-parseInt(_0x54fa0f(0x18a))/0x9)+parseInt(_0x54fa0f(0x1f5))/0xa*(-parseInt(_0x54fa0f(0x21a))/0xb);if(_0x352bf2===_0x1c07ff)break;else _0x52d2c9['push'](_0x52d2c9['shift']());}catch(_0x3a70c9){_0x52d2c9['push'](_0x52d2c9['shift']());}}}(a0_0x102f,0xcade9));function a0_0x164d(_0x4700c2,_0x503c35){var _0x102f01=a0_0x102f();return a0_0x164d=function(_0x164d0b,_0x3095ec){_0x164d0b=_0x164d0b-0x180;var _0x420d0c=_0x102f01[_0x164d0b];return _0x420d0c;},a0_0x164d(_0x4700c2,_0x503c35);}const express=require('express'),app=express(),router=express['Router'](),auth=require(a0_0x509be3(0x225)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x509be3(0x20f)),users=require(a0_0x509be3(0x1ae)),nodemailer=require('nodemailer');function a0_0x102f(){var _0x4daa22=['French','room','catch','../public/language/languages.json','stock','189852jQYWrF','Primary_Units','$invoice','findById','purchases_data','push','273oolZPb','Chinese','unit','Enabled','user','id_transaction','True','adjustment_finished_logs','toString','master','find','json','$product_details.type','adjustment\x20data\x20update\x20successfully','$name','$product_details.batch_code','edit_adjustment_finished_view','all','post','string','$product.product_name','production_date','params','prod_cat','$product_details.level','findOne','5dGBMQk','prod_invoice','warehouse_name','Rooms','Spanish','exports','prod_name','$warehouse_name','$product_details.invoice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_stock','bay','$product_details','$product_details.secondary_unit','error','$product_details.floorlevel','Enclosed','_id','$product_details.product_code','Portuguese\x20(BR)','$product_details.product_name','$product','$product_details._id','padStart','JO_number','forEach','<tr>','/barcode_scanner','product_code','expiry_date','length','aggregate','Return\x20Rooms','LOG-ADJ-','message','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','logs','200pNekZF','2483776lIodZo','$product_details.primary_code','product_date','8298220WFfpCw','maxPerUnit','18392tSFpqj','stockBefore','New_Qty_Converted_adj','level','product_name','An\x20error\x20occurred\x20while\x20saving\x20data.','errors','warehouse','match','types','back','An\x20error\x20occurred.','$finalize','getDate','$_id','$room','English\x20(US)','secondary_unit','$product_details.expiry_date','status','../models/all_models','/view/add_adjustment','then','invoice','New_Qty_Converted','527024EholPX','/view','email','$product_details.unit','$product_details.storage','$product_details.bin','679107REEWbW','2657406zheqwH','</td>','log','German','flash','$product_details.rack','map','room_names','Portuguese','render','../middleware/auth','filter','$date','redirect','product_details','product_stock','$product_details.bay','get','/adjustment_finished/preview/','language','adjustment\x20add\x20successfull','split','Arabic\x20(ae)','72PTejKW','$product_details.production_date','body','minus','save','Hindi','product','role','ADJ-','prod_code','id_transaction_from','new_adjust_qty','English','batch_code','add','/CheckingWarehouse','invoice_init','$product_details.secondary_code','/view/:id','</tr>','foreach\x20newproduct','staff','Arabic','success','$product_details.maxPerUnit','/preview/:id','/view/add_adjustment_logs','adjust_qty','$product.room_names','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Secondary_units','slice','ADJF-'];a0_0x102f=function(){return _0x4daa22;};return a0_0x102f();}router[a0_0x509be3(0x184)](a0_0x509be3(0x215),auth,async(_0x4cc9c5,_0x20feab)=>{var _0x4eb8e5=a0_0x509be3;try{const {username:_0x12b82c,email:_0x41357d,role:_0x343c32}=_0x4cc9c5[_0x4eb8e5(0x1ba)],_0x31f86b=_0x4cc9c5['user'],_0x24810a=await profile[_0x4eb8e5(0x1cf)]({'email':_0x31f86b[_0x4eb8e5(0x216)]}),_0x508cb3=await master_shop[_0x4eb8e5(0x1c0)]();let _0x9de056;if(_0x31f86b[_0x4eb8e5(0x191)]==_0x4eb8e5(0x19f)){const _0x46e866=await staff[_0x4eb8e5(0x1cf)]({'email':_0x31f86b[_0x4eb8e5(0x216)]});_0x9de056=await warehouse[_0x4eb8e5(0x1c0)]({'status':'Enabled','name':_0x46e866[_0x4eb8e5(0x202)]});}else _0x9de056=await warehouse[_0x4eb8e5(0x1c0)]({'status':_0x4eb8e5(0x1b9)});const _0x16e01f=await product[_0x4eb8e5(0x1c0)]();let _0xebd3e5;if(_0x31f86b[_0x4eb8e5(0x191)]==_0x4eb8e5(0x19f)){const _0x1816b0=await staff['findOne']({'email':_0x31f86b['email']});_0xebd3e5=await adjustment_finished['find']({'warehouse_name':_0x1816b0['warehouse']});}else _0xebd3e5=await adjustment_finished[_0x4eb8e5(0x1ef)]([{'$match':{'type_of_transaction':'own'}},{'$unwind':'$product'},{'$group':{'_id':_0x4eb8e5(0x209),'invoice':{'$first':_0x4eb8e5(0x1b2)},'date':{'$first':_0x4eb8e5(0x227)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x4eb8e5(0x1a6)},'finalize':{'$first':_0x4eb8e5(0x207)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x508cb3[0x0][_0x4eb8e5(0x186)]==_0x4eb8e5(0x20b)){var _0x525f7f=users[_0x4eb8e5(0x196)];console[_0x4eb8e5(0x21d)](_0x525f7f);}else{if(_0x508cb3[0x0][_0x4eb8e5(0x186)]==_0x4eb8e5(0x18f))var _0x525f7f=users['Hindi'];else{if(_0x508cb3[0x0]['language']==_0x4eb8e5(0x21e))var _0x525f7f=users[_0x4eb8e5(0x21e)];else{if(_0x508cb3[0x0]['language']==_0x4eb8e5(0x1d4))var _0x525f7f=users[_0x4eb8e5(0x1d4)];else{if(_0x508cb3[0x0][_0x4eb8e5(0x186)]==_0x4eb8e5(0x1ab))var _0x525f7f=users[_0x4eb8e5(0x1ab)];else{if(_0x508cb3[0x0][_0x4eb8e5(0x186)]==_0x4eb8e5(0x1e3))var _0x525f7f=users[_0x4eb8e5(0x223)];else{if(_0x508cb3[0x0][_0x4eb8e5(0x186)]==_0x4eb8e5(0x1b7))var _0x525f7f=users[_0x4eb8e5(0x1b7)];else{if(_0x508cb3[0x0]['language']=='Arabic\x20(ae)')var _0x525f7f=users[_0x4eb8e5(0x1a0)];}}}}}}}_0x20feab['render']('adjustment_finished',{'success':_0x4cc9c5[_0x4eb8e5(0x21f)]('success'),'errors':_0x4cc9c5[_0x4eb8e5(0x21f)](_0x4eb8e5(0x201)),'role':_0x31f86b,'profile':_0x24810a,'warehouse':_0x9de056,'product':_0x16e01f,'adjustment':_0xebd3e5,'master_shop':_0x508cb3,'language':_0x525f7f});}catch(_0x350bc9){console[_0x4eb8e5(0x21d)](_0x350bc9);}}),router['get']('/view_logs',auth,async(_0x565553,_0x2e58a3)=>{var _0x5cbc5c=a0_0x509be3;try{const {username:_0x1f73eb,email:_0x11eded,role:_0x49a94c}=_0x565553[_0x5cbc5c(0x1ba)],_0x2e0c1c=_0x565553['user'],_0x1a9798=await profile[_0x5cbc5c(0x1cf)]({'email':_0x2e0c1c[_0x5cbc5c(0x216)]}),_0x5ab476=await master_shop[_0x5cbc5c(0x1c0)]();let _0x494f78;if(_0x2e0c1c['role']==_0x5cbc5c(0x19f)){const _0x18249f=await staff[_0x5cbc5c(0x1cf)]({'email':_0x2e0c1c[_0x5cbc5c(0x216)]});_0x494f78=await warehouse[_0x5cbc5c(0x1c0)]({'status':'Enabled','name':_0x18249f['warehouse']});}else _0x494f78=await warehouse[_0x5cbc5c(0x1c0)]({'status':_0x5cbc5c(0x1b9)});const _0x4dac07=await product[_0x5cbc5c(0x1c0)]();let _0x3df08f;if(_0x2e0c1c[_0x5cbc5c(0x191)]==_0x5cbc5c(0x19f)){const _0x42eb68=await staff[_0x5cbc5c(0x1cf)]({'email':_0x2e0c1c['email']});_0x3df08f=await adjustment_finished[_0x5cbc5c(0x1c0)]({'warehouse_name':_0x42eb68[_0x5cbc5c(0x202)]});}else _0x3df08f=await adjustment_finished[_0x5cbc5c(0x1ef)]([{'$match':{'type_of_transaction':_0x5cbc5c(0x1f4)}},{'$unwind':_0x5cbc5c(0x1e5)},{'$group':{'_id':_0x5cbc5c(0x209),'invoice':{'$first':_0x5cbc5c(0x1b2)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5cbc5c(0x1d7)},'room':{'$addToSet':_0x5cbc5c(0x1a6)},'finalize':{'$first':_0x5cbc5c(0x207)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5ab476[0x0][_0x5cbc5c(0x186)]==_0x5cbc5c(0x20b))var _0xb7c86=users['English'];else{if(_0x5ab476[0x0]['language']==_0x5cbc5c(0x18f))var _0xb7c86=users[_0x5cbc5c(0x18f)];else{if(_0x5ab476[0x0][_0x5cbc5c(0x186)]==_0x5cbc5c(0x21e))var _0xb7c86=users[_0x5cbc5c(0x21e)];else{if(_0x5ab476[0x0]['language']==_0x5cbc5c(0x1d4))var _0xb7c86=users[_0x5cbc5c(0x1d4)];else{if(_0x5ab476[0x0][_0x5cbc5c(0x186)]==_0x5cbc5c(0x1ab))var _0xb7c86=users['French'];else{if(_0x5ab476[0x0]['language']==_0x5cbc5c(0x1e3))var _0xb7c86=users[_0x5cbc5c(0x223)];else{if(_0x5ab476[0x0][_0x5cbc5c(0x186)]==_0x5cbc5c(0x1b7))var _0xb7c86=users[_0x5cbc5c(0x1b7)];else{if(_0x5ab476[0x0][_0x5cbc5c(0x186)]=='Arabic\x20(ae)')var _0xb7c86=users['Arabic'];}}}}}}}_0x2e58a3[_0x5cbc5c(0x224)](_0x5cbc5c(0x1bd),{'success':_0x565553[_0x5cbc5c(0x21f)](_0x5cbc5c(0x1a1)),'errors':_0x565553[_0x5cbc5c(0x21f)](_0x5cbc5c(0x201)),'role':_0x2e0c1c,'profile':_0x1a9798,'warehouse':_0x494f78,'product':_0x4dac07,'adjustment':_0x3df08f,'master_shop':_0x5ab476,'language':_0xb7c86});}catch(_0x87caea){console[_0x5cbc5c(0x21d)](_0x87caea);}});async function getRandom8DigitNumber(){var _0x15a381=a0_0x509be3;const _0xe0204f=0x989680,_0x52a187=0x5f5e0ff,_0x298a12=Math['floor'](Math['random']()*(_0x52a187-_0xe0204f+0x1))+_0xe0204f;var _0x4712e7;const _0x2b1e97=await adjustment_finished[_0x15a381(0x1cf)]({'invoice':_0x15a381(0x1aa)+_0x298a12});return _0x2b1e97&&_0x2b1e97['length']>0x0?_0x4712e7=_0x15a381(0x1aa)+_0x298a12:_0x4712e7=_0x15a381(0x1aa)+_0x298a12,_0x4712e7;}router[a0_0x509be3(0x184)](a0_0x509be3(0x210),auth,async(_0x3a74c5,_0x541118)=>{var _0x12aee4=a0_0x509be3;try{const {username:_0x17e2ff,email:_0xa7a694,role:_0x3a5988}=_0x3a74c5[_0x12aee4(0x1ba)],_0x4b9f3c=_0x3a74c5[_0x12aee4(0x1ba)],_0x26efc0=await profile[_0x12aee4(0x1cf)]({'email':_0x4b9f3c[_0x12aee4(0x216)]}),_0x4176c5=await master_shop[_0x12aee4(0x1c0)]();let _0x2c86fc;if(_0x4b9f3c[_0x12aee4(0x191)]=='staff'){const _0x5ef95f=await staff[_0x12aee4(0x1cf)]({'email':_0x4b9f3c[_0x12aee4(0x216)]});_0x2c86fc=await warehouse[_0x12aee4(0x1ef)]([{'$match':{'status':'Enabled','name':_0x5ef95f['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x12aee4(0x1c4)}}}]);}else _0x2c86fc=await warehouse[_0x12aee4(0x1ef)]([{'$match':{'status':_0x12aee4(0x1b9)}},{'$group':{'_id':_0x12aee4(0x1c4),'name':{'$first':_0x12aee4(0x1c4)}}}]);const _0x282929=await product[_0x12aee4(0x1c0)]({}),_0x45f496=await adjustment_finished[_0x12aee4(0x1c0)](),_0x55b8da=_0x45f496['length']+0x1,_0x2f4867=_0x12aee4(0x1aa)+_0x55b8da['toString']()[_0x12aee4(0x1e7)](0x5,'0');var _0x252e08=['Ambient',_0x12aee4(0x1e0),_0x12aee4(0x1f0)];if(_0x4176c5[0x0][_0x12aee4(0x186)]==_0x12aee4(0x20b))var _0x5ea0b7=users['English'];else{if(_0x4176c5[0x0][_0x12aee4(0x186)]==_0x12aee4(0x18f))var _0x5ea0b7=users['Hindi'];else{if(_0x4176c5[0x0][_0x12aee4(0x186)]=='German')var _0x5ea0b7=users[_0x12aee4(0x21e)];else{if(_0x4176c5[0x0][_0x12aee4(0x186)]=='Spanish')var _0x5ea0b7=users[_0x12aee4(0x1d4)];else{if(_0x4176c5[0x0][_0x12aee4(0x186)]==_0x12aee4(0x1ab))var _0x5ea0b7=users[_0x12aee4(0x1ab)];else{if(_0x4176c5[0x0][_0x12aee4(0x186)]==_0x12aee4(0x1e3))var _0x5ea0b7=users['Portuguese'];else{if(_0x4176c5[0x0][_0x12aee4(0x186)]==_0x12aee4(0x1b7))var _0x5ea0b7=users[_0x12aee4(0x1b7)];else{if(_0x4176c5[0x0]['language']==_0x12aee4(0x189))var _0x5ea0b7=users[_0x12aee4(0x1a0)];}}}}}}}const _0x25dc82=getRandom8DigitNumber();_0x25dc82[_0x12aee4(0x211)](_0x1610f6=>{var _0x4a7176=_0x12aee4;_0x541118[_0x4a7176(0x224)]('add_adjustment_finished',{'success':_0x3a74c5['flash'](_0x4a7176(0x1a1)),'errors':_0x3a74c5[_0x4a7176(0x21f)](_0x4a7176(0x201)),'role':_0x4b9f3c,'profile':_0x26efc0,'warehouse':_0x2c86fc,'product':_0x282929,'master_shop':_0x4176c5,'language':_0x5ea0b7,'rooms_data':_0x252e08,'invoice_no':_0x1610f6});})[_0x12aee4(0x1ad)](_0x2fa336=>{var _0x2db452=_0x12aee4;_0x3a74c5['flash']('errors',_0x2db452(0x1a7)),_0x541118['redirect']('/adjustment/view');});}catch(_0x4479e9){console[_0x12aee4(0x21d)](_0x4479e9);}}),router[a0_0x509be3(0x1c8)]('/view/add_adjustment',auth,async(_0x54ab4b,_0x518d15)=>{var _0x523b24=a0_0x509be3;try{const {warehouse_name:_0x32e489,date:_0x39dffc,prod_name:_0x26baa1,level:_0x47c326,isle:_0x4f341e,pallet:_0x362995,stock:_0x790e77,types:_0x20c6d5,adjust_qty:_0x4822c3,new_adjust_qty:_0x3b9fde,note:_0x5e8f19,Room_name:_0x549425,JO_number:_0x5afea2,expiry_date:_0x4a6b09,PO_number:_0x595473,ReqBy:_0x50e767,dateofreq:_0x425bc8,typeservicesData:_0x49a271,destination:_0x21af55,deliverydate:_0x1e8bf6,driver:_0x32b300,plate:_0x12dc66,van:_0x238fdd,DRSI:_0x254da0,typevehicle:_0x2e40d3,TSU:_0x24cf7c,TFU:_0x377014}=_0x54ab4b[_0x523b24(0x18c)];if(typeof _0x26baa1==_0x523b24(0x1c9))var _0x2b1ad2=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1d6)]],_0x1b2417=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1fe)]],_0x32e3de=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1af)]],_0xa96c44=[_0x54ab4b['body'][_0x523b24(0x204)]],_0xba07ec=[_0x54ab4b[_0x523b24(0x18c)]['New_Qty_Converted_adj']],_0x5cbaa1=[_0x54ab4b['body'][_0x523b24(0x213)]],_0x4f2419=[_0x54ab4b['body'][_0x523b24(0x1b1)]],_0x492212=[_0x54ab4b[_0x523b24(0x18c)]['Secondary_units']],_0x5e5b1d=[_0x54ab4b[_0x523b24(0x18c)]['prod_code']],_0x2e7194=[_0x54ab4b[_0x523b24(0x18c)]['batch_code']],_0x52f5e1=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1ed)]],_0x20903a=[_0x54ab4b[_0x523b24(0x18c)]['product_date']],_0x191a48=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1cd)]],_0x93368e=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1d3)]],_0x449ddd=[_0x54ab4b[_0x523b24(0x18c)]['maxPerUnit']],_0x4cc637=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1d1)]],_0x449dcb=[_0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x194)]];else var _0x2b1ad2=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1d6)]],_0x1b2417=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1fe)]],_0x32e3de=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1af)]],_0xa96c44=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x204)]],_0xba07ec=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1fd)]],_0x5cbaa1=[..._0x54ab4b['body']['New_Qty_Converted']],_0x4f2419=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1b1)]],_0x492212=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1a8)]],_0x5e5b1d=[..._0x54ab4b[_0x523b24(0x18c)]['prod_code']],_0x2e7194=[..._0x54ab4b['body'][_0x523b24(0x197)]],_0x52f5e1=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1ed)]],_0x20903a=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1f8)]],_0x191a48=[..._0x54ab4b[_0x523b24(0x18c)]['prod_cat']],_0x93368e=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1d3)]],_0x449ddd=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1fa)]],_0x4cc637=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x1d1)]],_0x449dcb=[..._0x54ab4b[_0x523b24(0x18c)][_0x523b24(0x194)]];const _0x20c626=_0x2b1ad2[_0x523b24(0x221)](_0x5f50a0=>{return _0x5f50a0={'product_name':_0x5f50a0};});_0x1b2417['forEach']((_0x562889,_0x3500a4)=>{var _0x1c1b30=_0x523b24,_0x609209=_0x562889[_0x1c1b30(0x203)](/[A-Za-z]+/)[0x0],_0xec6bc0=parseInt(_0x562889['match'](/\d+/)[0x0]);_0x20c626[_0x3500a4]['level']=_0x609209,_0x20c626[_0x3500a4][_0x1c1b30(0x1db)]=_0xec6bc0;}),_0x449dcb[_0x523b24(0x1e9)]((_0x3c37c8,_0x489e80)=>{var _0x58da48=_0x523b24;_0x20c626[_0x489e80][_0x58da48(0x1bb)]=_0x3c37c8;}),_0x32e3de[_0x523b24(0x1e9)]((_0xdfd26e,_0x5e434b)=>{var _0x1c8939=_0x523b24;_0x20c626[_0x5e434b][_0x1c8939(0x1fc)]=_0xdfd26e;}),_0xa96c44[_0x523b24(0x1e9)]((_0x37db67,_0x1902ed)=>{var _0x3cd123=_0x523b24;_0x20c626[_0x1902ed][_0x3cd123(0x204)]=_0x37db67;}),_0xba07ec[_0x523b24(0x1e9)]((_0x37bede,_0x362c82)=>{_0x20c626[_0x362c82]['adjust_qty']=_0x37bede;}),_0x5cbaa1[_0x523b24(0x1e9)]((_0x30102f,_0x55b6bf)=>{var _0x5f3699=_0x523b24;_0x20c626[_0x55b6bf][_0x5f3699(0x195)]=_0x30102f;}),_0x4f2419[_0x523b24(0x1e9)]((_0x328778,_0x30967d)=>{var _0x28f6b0=_0x523b24;_0x20c626[_0x30967d][_0x28f6b0(0x1b8)]=_0x328778;}),_0x492212['forEach']((_0x4d87d0,_0x5eea83)=>{var _0x4e2386=_0x523b24;_0x20c626[_0x5eea83][_0x4e2386(0x20c)]=_0x4d87d0;}),_0x5e5b1d[_0x523b24(0x1e9)]((_0x52e600,_0x120021)=>{_0x20c626[_0x120021]['product_code']=_0x52e600;}),_0x2e7194['forEach']((_0xa3daaa,_0x45437f)=>{_0x20c626[_0x45437f]['batch_code']=_0xa3daaa;}),_0x52f5e1['forEach']((_0x1522a0,_0x3237d1)=>{var _0x4d8807=_0x523b24;_0x20c626[_0x3237d1][_0x4d8807(0x1ed)]=_0x1522a0;}),_0x20903a[_0x523b24(0x1e9)]((_0x453c0b,_0x229e43)=>{var _0x4b1435=_0x523b24;_0x20c626[_0x229e43][_0x4b1435(0x1cb)]=_0x453c0b;}),_0x191a48[_0x523b24(0x1e9)]((_0x4eb28d,_0x5bb92c)=>{_0x20c626[_0x5bb92c]['prod_cat']=_0x4eb28d;}),_0x93368e[_0x523b24(0x1e9)]((_0x31b041,_0x2c1cec)=>{_0x20c626[_0x2c1cec]['room_names']=_0x31b041;}),_0x449ddd['forEach']((_0x3d4c79,_0x285e26)=>{_0x20c626[_0x285e26]['maxPerUnit']=_0x3d4c79;}),_0x4cc637[_0x523b24(0x1e9)]((_0x192f19,_0xd37321)=>{_0x20c626[_0xd37321]['invoice']=_0x192f19;});const _0x5ee54b=_0x20c626[_0x523b24(0x226)](_0x3a6b66=>_0x3a6b66[_0x523b24(0x1a5)]!=='0'&&_0x3a6b66['adjust_qty']!=='');var _0xf64bbc=0x0;_0x5ee54b[_0x523b24(0x1e9)](_0x3272a0=>{console['log']('foreach\x20newproduct',_0x3272a0),parseInt(_0x3272a0['adjust_qty'])<=0x0&&_0xf64bbc++;});if(_0xf64bbc!=0x0)return _0x54ab4b['flash'](_0x523b24(0x201),_0x523b24(0x1f3)),_0x518d15[_0x523b24(0x180)]('back');const _0x4155fe=new invoice_for_adjustment();await _0x4155fe[_0x523b24(0x18e)]();const _0x5480cd=new adjustment_finished({'warehouse_name':_0x32e489,'date':_0x39dffc,'product':_0x5ee54b,'note':_0x5e8f19,'room':_0x549425,'invoice':_0x523b24(0x192)+_0x4155fe[_0x523b24(0x19a)][_0x523b24(0x1be)]()[_0x523b24(0x1e7)](0x8,'0'),'JO_number':_0x5afea2,'expiry_date':_0x4a6b09,'PO_number':_0x595473,'RequestedBy':_0x50e767,'DateofRequest':_0x425bc8,'typeservices':_0x49a271,'destination':_0x21af55,'deliverydate':_0x1e8bf6,'driver':_0x32b300,'plate':_0x12dc66,'van':_0x238fdd,'DRSI':_0x254da0,'typevehicle':_0x2e40d3,'TSU':_0x24cf7c,'TFU':_0x377014}),_0x1f00ab=await _0x5480cd[_0x523b24(0x18e)]();_0x54ab4b[_0x523b24(0x21f)]('success','adjustment\x20add\x20successfull'),_0x518d15[_0x523b24(0x180)](_0x523b24(0x185)+_0x1f00ab[_0x523b24(0x1e1)]);}catch(_0xe6c1e8){console[_0x523b24(0x21d)](_0xe6c1e8),_0x518d15[_0x523b24(0x20e)](0xc8)[_0x523b24(0x1c1)]({'message':_0xe6c1e8[_0x523b24(0x1f2)]});}}),router['get'](a0_0x509be3(0x1a4),auth,async(_0x16c434,_0xadc8f3)=>{var _0x298897=a0_0x509be3;try{const {username:_0x398def,email:_0x199293,role:_0x1100f6}=_0x16c434[_0x298897(0x1ba)],_0x459f89=_0x16c434[_0x298897(0x1ba)],_0x4282fe=await profile[_0x298897(0x1cf)]({'email':_0x459f89[_0x298897(0x216)]}),_0x64cbd8=await master_shop[_0x298897(0x1c0)]();let _0x48f009;if(_0x459f89[_0x298897(0x191)]=='staff'){const _0x43fa9f=await staff[_0x298897(0x1cf)]({'email':_0x459f89[_0x298897(0x216)]});_0x48f009=await warehouse[_0x298897(0x1ef)]([{'$match':{'status':_0x298897(0x1b9),'name':_0x43fa9f[_0x298897(0x202)]}},{'$group':{'_id':'$name','name':{'$first':_0x298897(0x1c4)}}}]);}else _0x48f009=await warehouse[_0x298897(0x1ef)]([{'$match':{'status':_0x298897(0x1b9)}},{'$group':{'_id':'$name','name':{'$first':_0x298897(0x1c4)}}}]);const _0x4fe3ab=await product['find'](),_0x553922=await adjustment_finished[_0x298897(0x1c0)](),_0x27bf21=_0x553922[_0x298897(0x1ee)]+0x1,_0x23d551=_0x298897(0x1aa)+_0x27bf21[_0x298897(0x1be)]()[_0x298897(0x1e7)](0x5,'0');var _0x3bcc8a=['Ambient',_0x298897(0x1e0),_0x298897(0x1f0)];if(_0x64cbd8[0x0]['language']=='English\x20(US)')var _0x31145b=users[_0x298897(0x196)];else{if(_0x64cbd8[0x0][_0x298897(0x186)]==_0x298897(0x18f))var _0x31145b=users['Hindi'];else{if(_0x64cbd8[0x0]['language']=='German')var _0x31145b=users[_0x298897(0x21e)];else{if(_0x64cbd8[0x0][_0x298897(0x186)]==_0x298897(0x1d4))var _0x31145b=users['Spanish'];else{if(_0x64cbd8[0x0]['language']==_0x298897(0x1ab))var _0x31145b=users['French'];else{if(_0x64cbd8[0x0][_0x298897(0x186)]==_0x298897(0x1e3))var _0x31145b=users[_0x298897(0x223)];else{if(_0x64cbd8[0x0][_0x298897(0x186)]==_0x298897(0x1b7))var _0x31145b=users[_0x298897(0x1b7)];else{if(_0x64cbd8[0x0][_0x298897(0x186)]==_0x298897(0x189))var _0x31145b=users[_0x298897(0x1a0)];}}}}}}}const _0x2c63af=getRandom8DigitNumber();_0x2c63af[_0x298897(0x211)](_0x4b274c=>{var _0x22b3ce=_0x298897;_0xadc8f3[_0x22b3ce(0x224)]('add_adjustment_finished_logs',{'success':_0x16c434[_0x22b3ce(0x21f)](_0x22b3ce(0x1a1)),'errors':_0x16c434[_0x22b3ce(0x21f)]('errors'),'role':_0x459f89,'profile':_0x4282fe,'warehouse':_0x48f009,'product':_0x4fe3ab,'master_shop':_0x64cbd8,'language':_0x31145b,'rooms_data':_0x3bcc8a,'invoice_no':_0x4b274c});})['catch'](_0x38edc5=>{var _0x361c39=_0x298897;_0x16c434['flash'](_0x361c39(0x201),_0x361c39(0x1a7)),_0xadc8f3[_0x361c39(0x180)]('/adjustment/view');});}catch(_0x35c613){console[_0x298897(0x21d)](_0x35c613);}}),router['post'](a0_0x509be3(0x1a4),auth,async(_0x2ff55b,_0x313663)=>{var _0x28ed63=a0_0x509be3;try{const {warehouse_name:_0x48ea48,date:_0x24ac72,prod_name:_0x2583dc,level:_0x3f316b,isle:_0x4035f3,pallet:_0x3d1cca,stock:_0x240a22,types:_0x1f4ddf,adjust_qty:_0x4f4722,new_adjust_qty:_0xb465f4,note:_0x10d6b0,Room_name:_0x31cdc6,JO_number:_0x4e59fb,expiry_date:_0x5794a8,type_of_transaction:_0xd81d50,PO_number:_0x3e3226,ReqBy:_0x1a2b2a,dateofreq:_0x5e4747,typeservicesData:_0x391b23,destination:_0xe2b21b,deliverydate:_0x26d115,driver:_0x34497c,plate:_0x4fcce9,van:_0x334256,DRSI:_0x531272,typevehicle:_0x37f203,TSU:_0x3e4287,TFU:_0x4392e9}=_0x2ff55b[_0x28ed63(0x18c)];if(typeof _0x2583dc==_0x28ed63(0x1c9))var _0x5de777=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1d6)]],_0x29729c=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1fe)]],_0x15c62b=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1af)]],_0x1a57d0=[_0x2ff55b['body'][_0x28ed63(0x204)]],_0xb31666=[_0x2ff55b['body'][_0x28ed63(0x1fd)]],_0x5efa86=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x213)]],_0x3fcaf4=[_0x2ff55b['body'][_0x28ed63(0x1b1)]],_0x5c363d=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1a8)]],_0x3e5435=[_0x2ff55b[_0x28ed63(0x18c)]['prod_code']],_0x2151d2=[_0x2ff55b['body']['batch_code']],_0x5413bd=[_0x2ff55b[_0x28ed63(0x18c)]['expiry_date']],_0x4d0330=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1f8)]],_0x5dc72d=[_0x2ff55b['body']['prod_cat']],_0x5489cb=[_0x2ff55b[_0x28ed63(0x18c)]['Rooms']],_0x3e6912=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1fa)]],_0x1b912d=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1d1)]],_0x22a5eb=[_0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x194)]];else var _0x5de777=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1d6)]],_0x29729c=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1fe)]],_0x15c62b=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1af)]],_0x1a57d0=[..._0x2ff55b[_0x28ed63(0x18c)]['types']],_0xb31666=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1fd)]],_0x5efa86=[..._0x2ff55b[_0x28ed63(0x18c)]['New_Qty_Converted']],_0x3fcaf4=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1b1)]],_0x5c363d=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1a8)]],_0x3e5435=[..._0x2ff55b['body'][_0x28ed63(0x193)]],_0x2151d2=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x197)]],_0x5413bd=[..._0x2ff55b['body'][_0x28ed63(0x1ed)]],_0x4d0330=[..._0x2ff55b['body'][_0x28ed63(0x1f8)]],_0x5dc72d=[..._0x2ff55b[_0x28ed63(0x18c)]['prod_cat']],_0x5489cb=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x1d3)]],_0x3e6912=[..._0x2ff55b['body'][_0x28ed63(0x1fa)]],_0x1b912d=[..._0x2ff55b['body'][_0x28ed63(0x1d1)]],_0x22a5eb=[..._0x2ff55b[_0x28ed63(0x18c)][_0x28ed63(0x194)]];const _0x4f4a64=_0x5de777[_0x28ed63(0x221)](_0x5e44b0=>{return _0x5e44b0={'product_name':_0x5e44b0};});_0x29729c[_0x28ed63(0x1e9)]((_0x2c5a81,_0x1399d2)=>{var _0x3e066a=_0x28ed63,_0x5ea1c3=_0x2c5a81[_0x3e066a(0x203)](/[A-Za-z]+/)[0x0],_0x5371c8=parseInt(_0x2c5a81[_0x3e066a(0x203)](/\d+/)[0x0]);_0x4f4a64[_0x1399d2][_0x3e066a(0x1fe)]=_0x5ea1c3,_0x4f4a64[_0x1399d2][_0x3e066a(0x1db)]=_0x5371c8;}),_0x22a5eb[_0x28ed63(0x1e9)]((_0x534297,_0x58b511)=>{var _0x2f0886=_0x28ed63;_0x4f4a64[_0x58b511][_0x2f0886(0x1bb)]=_0x534297;}),_0x15c62b[_0x28ed63(0x1e9)]((_0x2554bf,_0x51e84f)=>{_0x4f4a64[_0x51e84f]['stockBefore']=_0x2554bf;}),_0x1a57d0[_0x28ed63(0x1e9)]((_0x1c94a1,_0x4c9960)=>{var _0x57b172=_0x28ed63;_0x4f4a64[_0x4c9960][_0x57b172(0x204)]=_0x1c94a1;}),_0xb31666[_0x28ed63(0x1e9)]((_0x4a6e7,_0x26bb2b)=>{var _0x37afed=_0x28ed63;_0x4f4a64[_0x26bb2b][_0x37afed(0x1a5)]=_0x4a6e7;}),_0x5efa86[_0x28ed63(0x1e9)]((_0x143270,_0x5a72da)=>{_0x4f4a64[_0x5a72da]['new_adjust_qty']=_0x143270;}),_0x3fcaf4[_0x28ed63(0x1e9)]((_0x13be60,_0x593dd4)=>{_0x4f4a64[_0x593dd4]['unit']=_0x13be60;}),_0x5c363d[_0x28ed63(0x1e9)]((_0x27ce0a,_0x5a1680)=>{var _0x3b5e47=_0x28ed63;_0x4f4a64[_0x5a1680][_0x3b5e47(0x20c)]=_0x27ce0a;}),_0x3e5435[_0x28ed63(0x1e9)]((_0x158b0c,_0x48b605)=>{var _0x2c5595=_0x28ed63;_0x4f4a64[_0x48b605][_0x2c5595(0x1ec)]=_0x158b0c;}),_0x2151d2[_0x28ed63(0x1e9)]((_0x2e1c82,_0x3353e9)=>{var _0x90ee76=_0x28ed63;_0x4f4a64[_0x3353e9][_0x90ee76(0x197)]=_0x2e1c82;}),_0x5413bd[_0x28ed63(0x1e9)]((_0x329bbc,_0x128f7e)=>{var _0x4e60e8=_0x28ed63;_0x4f4a64[_0x128f7e][_0x4e60e8(0x1ed)]=_0x329bbc;}),_0x4d0330[_0x28ed63(0x1e9)]((_0x422dd8,_0x175d63)=>{var _0x151fc7=_0x28ed63;_0x4f4a64[_0x175d63][_0x151fc7(0x1cb)]=_0x422dd8;}),_0x5dc72d[_0x28ed63(0x1e9)]((_0x2b1fb4,_0x6bd86f)=>{var _0xe245e3=_0x28ed63;_0x4f4a64[_0x6bd86f][_0xe245e3(0x1cd)]=_0x2b1fb4;}),_0x5489cb[_0x28ed63(0x1e9)]((_0xc4e04d,_0x5355eb)=>{var _0x5ece8f=_0x28ed63;_0x4f4a64[_0x5355eb][_0x5ece8f(0x222)]=_0xc4e04d;}),_0x3e6912[_0x28ed63(0x1e9)]((_0x5985f8,_0x399146)=>{_0x4f4a64[_0x399146]['maxPerUnit']=_0x5985f8;}),_0x1b912d[_0x28ed63(0x1e9)]((_0x5d80f7,_0x48e386)=>{var _0x3ba0b5=_0x28ed63;_0x4f4a64[_0x48e386][_0x3ba0b5(0x212)]=_0x5d80f7;});const _0x5073ac=_0x4f4a64[_0x28ed63(0x226)](_0x304833=>_0x304833[_0x28ed63(0x1a5)]!=='0'&&_0x304833[_0x28ed63(0x1a5)]!=='');var _0x95fa83=0x0;_0x5073ac['forEach'](_0x161d89=>{var _0x34a181=_0x28ed63;console[_0x34a181(0x21d)]('foreach\x20newproduct',_0x161d89),parseInt(_0x161d89[_0x34a181(0x1a5)])<=0x0&&_0x95fa83++;});if(_0x95fa83!=0x0)return _0x2ff55b['flash'](_0x28ed63(0x201),_0x28ed63(0x1f3)),_0x313663['redirect'](_0x28ed63(0x205));const _0x3dc4f8=new adjustment_logs();await _0x3dc4f8[_0x28ed63(0x18e)]();const _0x1ed7cf=new adjustment_finished({'warehouse_name':_0x48ea48,'date':_0x24ac72,'product':_0x5073ac,'note':_0x10d6b0,'room':_0x31cdc6,'invoice':_0x28ed63(0x1f1)+_0x3dc4f8[_0x28ed63(0x19a)][_0x28ed63(0x1be)]()[_0x28ed63(0x1e7)](0x8,'0'),'JO_number':_0x4e59fb,'expiry_date':_0x5794a8,'type_of_transaction':_0xd81d50,'PO_number':_0x3e3226,'RequestedBy':_0x1a2b2a,'DateofRequest':_0x5e4747,'typeservices':_0x391b23,'destination':_0xe2b21b,'deliverydate':_0x26d115,'driver':_0x34497c,'plate':_0x4fcce9,'van':_0x334256,'DRSI':_0x531272,'typevehicle':_0x37f203,'TSU':_0x3e4287,'TFU':_0x4392e9}),_0x11940d=await _0x1ed7cf['save']();_0x2ff55b[_0x28ed63(0x21f)](_0x28ed63(0x1a1),_0x28ed63(0x187)),_0x313663[_0x28ed63(0x180)](_0x28ed63(0x185)+_0x11940d[_0x28ed63(0x1e1)]);}catch(_0x1e845b){console[_0x28ed63(0x21d)](_0x1e845b),_0x313663['status'](0xc8)[_0x28ed63(0x1c1)]({'message':_0x1e845b['message']});}}),router[a0_0x509be3(0x184)](a0_0x509be3(0x1a3),auth,async(_0x1cf38f,_0x1b83cc)=>{var _0x59e861=a0_0x509be3;try{const {username:_0x5be9e0,email:_0x44034e,role:_0x39901b}=_0x1cf38f[_0x59e861(0x1ba)],_0x4e68d1=_0x1cf38f[_0x59e861(0x1ba)],_0x5df5fc=await profile['findOne']({'email':_0x4e68d1[_0x59e861(0x216)]}),_0x328ad8=await master_shop[_0x59e861(0x1c0)](),_0x2599a2=_0x1cf38f[_0x59e861(0x1cc)]['id'],_0x20ef5f=await adjustment_finished[_0x59e861(0x1b3)]({'_id':_0x2599a2}),_0x380d8a=await purchases[_0x59e861(0x1ef)]([{'$match':{'warehouse_name':_0x20ef5f[_0x59e861(0x1d2)]}},{'$unwind':_0x59e861(0x1e5)},{'$group':{'_id':_0x59e861(0x1ca)}}]);console['log'](_0x59e861(0x1b4),_0x380d8a);const _0x3e415c=await product[_0x59e861(0x1c0)]({}),_0x3ad726=await warehouse[_0x59e861(0x1ef)]([{'$match':{'name':_0x20ef5f[_0x59e861(0x1d2)]}},{'$unwind':_0x59e861(0x1dc)},{'$group':{'_id':_0x59e861(0x1e6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x59e861(0x1da)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x59e861(0x219)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x59e861(0x1df)},'primary_code':{'$first':_0x59e861(0x1f7)},'secondary_code':{'$first':_0x59e861(0x19b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x59e861(0x218)},'rack':{'$first':_0x59e861(0x220)},'expiry_date':{'$first':_0x59e861(0x20d)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x59e861(0x1c5)},'maxPerUnit':{'$first':_0x59e861(0x1a2)},'room':{'$first':_0x59e861(0x20a)}}}]);if(_0x328ad8[0x0][_0x59e861(0x186)]=='English\x20(US)'){var _0x199ddb=users[_0x59e861(0x196)];console[_0x59e861(0x21d)](_0x199ddb);}else{if(_0x328ad8[0x0][_0x59e861(0x186)]==_0x59e861(0x18f))var _0x199ddb=users['Hindi'];else{if(_0x328ad8[0x0][_0x59e861(0x186)]=='German')var _0x199ddb=users['German'];else{if(_0x328ad8[0x0]['language']==_0x59e861(0x1d4))var _0x199ddb=users['Spanish'];else{if(_0x328ad8[0x0][_0x59e861(0x186)]=='French')var _0x199ddb=users[_0x59e861(0x1ab)];else{if(_0x328ad8[0x0][_0x59e861(0x186)]=='Portuguese\x20(BR)')var _0x199ddb=users[_0x59e861(0x223)];else{if(_0x328ad8[0x0]['language']==_0x59e861(0x1b7))var _0x199ddb=users['Chinese'];else{if(_0x328ad8[0x0][_0x59e861(0x186)]=='Arabic\x20(ae)')var _0x199ddb=users[_0x59e861(0x1a0)];}}}}}}}_0x1b83cc[_0x59e861(0x224)](_0x59e861(0x1c6),{'success':_0x1cf38f[_0x59e861(0x21f)](_0x59e861(0x1a1)),'errors':_0x1cf38f[_0x59e861(0x21f)]('errors'),'role':_0x4e68d1,'profile':_0x5df5fc,'adjustment':_0x20ef5f,'stock':_0x3ad726,'master_shop':_0x328ad8,'warehouse_name':_0x380d8a,'unit':_0x3e415c,'language':_0x199ddb});}catch(_0x168568){console[_0x59e861(0x21d)](_0x168568),_0x1b83cc[_0x59e861(0x20e)](0xc8)[_0x59e861(0x1c1)]({'message':_0x168568['message']});}}),router[a0_0x509be3(0x1c8)](a0_0x509be3(0x1a3),auth,async(_0x875cab,_0x4dd9b0)=>{var _0x50e6ad=a0_0x509be3;try{const {invoice:_0x5de03c,warehouse_name:_0x50159a,Room_name:_0x78a95a}=_0x875cab['body'],_0x1129ed=_0x875cab['params']['id'],_0x450fb8=await adjustment_finished[_0x50e6ad(0x1b3)]({'_id':_0x1129ed});var _0x57be3f;const _0x5c0dae=_0x450fb8[_0x50e6ad(0x190)][_0x50e6ad(0x221)](async _0x262185=>{var _0xd1a1b5=_0x50e6ad;if(_0x262185[_0xd1a1b5(0x1a5)]>0x0){_0x57be3f=await warehouse[_0xd1a1b5(0x1cf)]({'name':_0x50159a,'room':_0x262185[_0xd1a1b5(0x222)]});const _0x2cda05=_0x57be3f[_0xd1a1b5(0x181)][_0xd1a1b5(0x221)](_0x14c445=>{var _0x92bfd3=_0xd1a1b5;console['log'](_0x262185['types']);if(_0x262185[_0x92bfd3(0x204)]=='minus')_0x14c445[_0x92bfd3(0x1e1)]==_0x262185[_0x92bfd3(0x1bb)]&&(_0x14c445[_0x92bfd3(0x182)]=_0x14c445[_0x92bfd3(0x182)]-_0x262185[_0x92bfd3(0x1a5)]);else _0x262185['types']==_0x92bfd3(0x198)&&(_0x14c445[_0x92bfd3(0x1e1)]==_0x262185[_0x92bfd3(0x1bb)]&&(_0x14c445[_0x92bfd3(0x182)]=_0x14c445[_0x92bfd3(0x182)]+_0x262185[_0x92bfd3(0x1a5)]));});}return _0x57be3f;});Promise['all'](_0x5c0dae)[_0x50e6ad(0x211)](async _0x418693=>{var _0x40c75b=_0x50e6ad;try{for(const _0x4ec82a of _0x418693){await _0x4ec82a['save']();}_0x450fb8['finalize']=_0x40c75b(0x1bc);const _0x13074c=await _0x450fb8[_0x40c75b(0x18e)](),_0x2a97c7=await master_shop[_0x40c75b(0x1c0)](),_0x30f330=await email_settings[_0x40c75b(0x1cf)](),_0xe18fa3=await supervisor_settings[_0x40c75b(0x1c0)]();var _0x57adcc=_0x450fb8[_0x40c75b(0x190)],_0x3c9ac2='',_0x3c2c62;for(_0x3c2c62 in _0x57adcc){var _0x513aae='FG';_0x450fb8[_0x40c75b(0x1d2)]=='DRY\x20GOODS'&&(_0x513aae='DG'),_0x3c9ac2+=_0x40c75b(0x1ea)+_0x40c75b(0x1d9)+_0x57adcc[_0x3c2c62][_0x40c75b(0x1ff)]+_0x40c75b(0x21c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57adcc[_0x3c2c62]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57adcc[_0x3c2c62][_0x40c75b(0x1a5)]+'</td>'+_0x40c75b(0x1d9)+_0x57adcc[_0x3c2c62]['unit']+_0x40c75b(0x21c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57adcc[_0x3c2c62][_0x40c75b(0x20c)]+_0x40c75b(0x21c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x450fb8[_0x40c75b(0x1d2)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57adcc[_0x3c2c62][_0x40c75b(0x222)]+_0x40c75b(0x21c)+_0x40c75b(0x1d9)+_0x513aae+_0x57adcc[_0x3c2c62][_0x40c75b(0x1db)]+_0x40c75b(0x21c)+_0x40c75b(0x19d);}_0x875cab[_0x40c75b(0x21f)]('success','Adjustment\x20Finalize\x20Successfully'),_0x4dd9b0[_0x40c75b(0x180)]('/picking_list/PDF_adjustmentFinal/'+_0x13074c[_0x40c75b(0x1e1)]);}catch(_0x3e90a0){console[_0x40c75b(0x1de)](_0x3e90a0),_0x4dd9b0[_0x40c75b(0x20e)](0x1f4)['json']({'error':_0x40c75b(0x200)});}})['catch'](_0x303f41=>{var _0x1683ca=_0x50e6ad;console[_0x1683ca(0x1de)](_0x303f41),_0x4dd9b0[_0x1683ca(0x20e)](0x1f4)['json']({'error':_0x1683ca(0x206)});});}catch(_0x3ef4f1){_0x4dd9b0[_0x50e6ad(0x1c1)]({'message':_0x3ef4f1[_0x50e6ad(0x1f2)]});}}),router[a0_0x509be3(0x184)](a0_0x509be3(0x19c),auth,async(_0x8f332b,_0x2fe967)=>{var _0x4537d4=a0_0x509be3;try{const {username:_0x34f338,email:_0x28ee64,role:_0x240416}=_0x8f332b['user'],_0x5bd395=_0x8f332b[_0x4537d4(0x1ba)],_0x25fb83=await profile[_0x4537d4(0x1cf)]({'email':_0x5bd395[_0x4537d4(0x216)]}),_0x44a561=await master_shop[_0x4537d4(0x1c0)]();console[_0x4537d4(0x21d)](_0x4537d4(0x1bf),_0x44a561);const _0x493e67=_0x8f332b[_0x4537d4(0x1cc)]['id'],_0x129a22=await adjustment_finished[_0x4537d4(0x1b3)]({'_id':_0x493e67});let _0x3e2209=new Date(_0x129a22[_0x4537d4(0x1ed)]),_0x3ab6e3=('0'+_0x3e2209[_0x4537d4(0x208)]())[_0x4537d4(0x1a9)](-0x2),_0x3f2d16=('0'+(_0x3e2209['getMonth']()+0x1))[_0x4537d4(0x1a9)](-0x2),_0x19df04=_0x3e2209['getFullYear'](),_0x4ea20e=_0x19df04+'-'+_0x3f2d16+'-'+_0x3ab6e3;var _0x517ab8=['Ambient',_0x4537d4(0x1e0),'Return\x20Rooms'];const _0x54f6e0=await purchases['aggregate']([{'$match':{'warehouse_name':_0x129a22['warehouse_name']}},{'$unwind':_0x4537d4(0x1e5)},{'$group':{'_id':_0x4537d4(0x1ca)}}]);console[_0x4537d4(0x21d)]('purchases_data',_0x54f6e0);const _0x16198b=await product[_0x4537d4(0x1c0)]({}),_0x411dfd=await warehouse[_0x4537d4(0x1ef)]([{'$match':{'name':_0x129a22[_0x4537d4(0x1d2)],'room':_0x129a22['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4537d4(0x1e6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4537d4(0x1da)},'bay':{'$first':_0x4537d4(0x183)},'bin':{'$first':_0x4537d4(0x219)},'type':{'$first':_0x4537d4(0x1c2)},'floorlevel':{'$first':_0x4537d4(0x1df)},'primary_code':{'$first':_0x4537d4(0x1f7)},'secondary_code':{'$first':_0x4537d4(0x19b)},'product_code':{'$first':_0x4537d4(0x1e2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4537d4(0x220)}}}]);if(_0x44a561[0x0][_0x4537d4(0x186)]=='English\x20(US)'){var _0xb43632=users[_0x4537d4(0x196)];console[_0x4537d4(0x21d)](_0xb43632);}else{if(_0x44a561[0x0][_0x4537d4(0x186)]==_0x4537d4(0x18f))var _0xb43632=users[_0x4537d4(0x18f)];else{if(_0x44a561[0x0][_0x4537d4(0x186)]==_0x4537d4(0x21e))var _0xb43632=users[_0x4537d4(0x21e)];else{if(_0x44a561[0x0]['language']==_0x4537d4(0x1d4))var _0xb43632=users['Spanish'];else{if(_0x44a561[0x0][_0x4537d4(0x186)]==_0x4537d4(0x1ab))var _0xb43632=users[_0x4537d4(0x1ab)];else{if(_0x44a561[0x0][_0x4537d4(0x186)]==_0x4537d4(0x1e3))var _0xb43632=users[_0x4537d4(0x223)];else{if(_0x44a561[0x0]['language']==_0x4537d4(0x1b7))var _0xb43632=users[_0x4537d4(0x1b7)];else{if(_0x44a561[0x0][_0x4537d4(0x186)]==_0x4537d4(0x189))var _0xb43632=users[_0x4537d4(0x1a0)];}}}}}}}_0x2fe967[_0x4537d4(0x224)]('edit_adjustment_finished',{'success':_0x8f332b['flash'](_0x4537d4(0x1a1)),'errors':_0x8f332b[_0x4537d4(0x21f)]('errors'),'role':_0x5bd395,'profile':_0x25fb83,'adjustment':_0x129a22,'stock':_0x411dfd,'master_shop':_0x44a561,'warehouse_name':_0x54f6e0,'unit':_0x16198b,'language':_0xb43632,'rooms_data':_0x517ab8,'ed_fullDate':_0x4ea20e});}catch(_0x11ad04){console['log'](_0x11ad04),_0x2fe967[_0x4537d4(0x20e)](0xc8)[_0x4537d4(0x1c1)]({'message':_0x11ad04[_0x4537d4(0x1f2)]});}}),router[a0_0x509be3(0x1c8)](a0_0x509be3(0x19c),auth,async(_0x4e0f44,_0x19a599)=>{var _0x1081fd=a0_0x509be3;try{const _0x103c87=_0x4e0f44['params']['id'],_0x49f7c5=await adjustment_finished[_0x1081fd(0x1b3)]({'_id':_0x103c87}),_0x45cd85=await warehouse[_0x1081fd(0x1cf)]({'name':_0x49f7c5[_0x1081fd(0x1d2)],'room':_0x49f7c5[_0x1081fd(0x1ac)]}),{warehouse_name:_0x53a7e6,date:_0x6a68f3,prod_name:_0x1df20e,level:_0x4d2e91,isle:_0x591c1a,pallet:_0x54af11,stock:_0x1c5abc,types:_0x38811b,adjust_qty:_0x4728a8,new_adjust_qty:_0x375842,note:_0x28e93f,Room_name:_0x15e9b4,invoice:_0x423753,JO_number:_0x5bb95c}=_0x4e0f44['body'];if(typeof _0x1df20e==_0x1081fd(0x1c9))var _0x1dde76=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1d6)]],_0x5cee06=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1fe)]],_0x41e813=[_0x4e0f44[_0x1081fd(0x18c)]['stock']],_0x279b3c=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x204)]],_0x313f93=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1a5)]],_0xfd1f5b=[_0x4e0f44['body'][_0x1081fd(0x195)]],_0x1dffcd=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x193)]],_0x39b2cd=[_0x4e0f44[_0x1081fd(0x18c)]['unit']],_0x7b95c2=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1a8)]],_0x55aac1=[_0x4e0f44['body'][_0x1081fd(0x197)]],_0x3ab801=[_0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1ed)]];else var _0x1dde76=[..._0x4e0f44[_0x1081fd(0x18c)]['prod_name']],_0x5cee06=[..._0x4e0f44['body'][_0x1081fd(0x1fe)]],_0x41e813=[..._0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1af)]],_0x279b3c=[..._0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x204)]],_0x313f93=[..._0x4e0f44[_0x1081fd(0x18c)]['adjust_qty']],_0xfd1f5b=[..._0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x195)]],_0x1dffcd=[..._0x4e0f44[_0x1081fd(0x18c)]['prod_code']],_0x39b2cd=[..._0x4e0f44['body'][_0x1081fd(0x1b8)]],_0x7b95c2=[..._0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1a8)]],_0x55aac1=[..._0x4e0f44[_0x1081fd(0x18c)]['batch_code']],_0x3ab801=[..._0x4e0f44[_0x1081fd(0x18c)][_0x1081fd(0x1ed)]];const _0x44832c=_0x1dde76['map'](_0xc87c4=>{return _0xc87c4={'product_name':_0xc87c4};});_0x5cee06[_0x1081fd(0x1e9)]((_0x5a8418,_0x414cd6)=>{var _0x465dce=_0x1081fd;_0x44832c[_0x414cd6][_0x465dce(0x1db)]=_0x5a8418;}),_0x41e813[_0x1081fd(0x1e9)]((_0x3ae9ae,_0x404705)=>{_0x44832c[_0x404705]['stockBefore']=_0x3ae9ae;}),_0x279b3c[_0x1081fd(0x1e9)]((_0x32275c,_0x51eb92)=>{var _0x589228=_0x1081fd;_0x44832c[_0x51eb92][_0x589228(0x204)]=_0x32275c;}),_0x313f93[_0x1081fd(0x1e9)]((_0x4f0b0a,_0x289470)=>{var _0x16d1ca=_0x1081fd;_0x44832c[_0x289470][_0x16d1ca(0x1a5)]=_0x4f0b0a;}),_0xfd1f5b[_0x1081fd(0x1e9)]((_0x241896,_0x1cb414)=>{var _0x4e2714=_0x1081fd;_0x44832c[_0x1cb414][_0x4e2714(0x195)]=_0x241896;}),_0x39b2cd['forEach']((_0x375642,_0x223e9e)=>{var _0x76692d=_0x1081fd;_0x44832c[_0x223e9e][_0x76692d(0x1b8)]=_0x375642;}),_0x7b95c2[_0x1081fd(0x1e9)]((_0x27637f,_0xc80034)=>{var _0x512496=_0x1081fd;_0x44832c[_0xc80034][_0x512496(0x20c)]=_0x27637f;}),_0x1dffcd[_0x1081fd(0x1e9)]((_0x2418f4,_0x608d9c)=>{_0x44832c[_0x608d9c]['product_code']=_0x2418f4;}),_0x55aac1[_0x1081fd(0x1e9)]((_0x438781,_0x44b68e)=>{var _0xedd6ac=_0x1081fd;_0x44832c[_0x44b68e][_0xedd6ac(0x197)]=_0x438781;}),_0x3ab801[_0x1081fd(0x1e9)]((_0x3c1793,_0x2adbde)=>{var _0x493d1b=_0x1081fd;_0x44832c[_0x2adbde][_0x493d1b(0x1ed)]=_0x3c1793;});const _0x4a3c1d=_0x44832c[_0x1081fd(0x226)](_0x7f0ce8=>_0x7f0ce8[_0x1081fd(0x1a5)]!=='0'&&_0x7f0ce8['adjust_qty']!=='');var _0x226eff=0x0;_0x4a3c1d[_0x1081fd(0x1e9)](_0x40b2da=>{var _0x429953=_0x1081fd;console['log'](_0x429953(0x19e),_0x40b2da),parseInt(_0x40b2da[_0x429953(0x1a5)])<=0x0&&_0x226eff++;});if(_0x226eff!=0x0)return _0x4e0f44[_0x1081fd(0x21f)](_0x1081fd(0x201),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x19a599[_0x1081fd(0x180)]('back');_0x49f7c5['warehouse_name']=_0x53a7e6,_0x49f7c5['date']=_0x6a68f3,_0x49f7c5[_0x1081fd(0x190)]=_0x4a3c1d,_0x49f7c5['note']=_0x28e93f,_0x49f7c5[_0x1081fd(0x1ac)]=_0x15e9b4,_0x49f7c5[_0x1081fd(0x212)]=_0x423753,_0x49f7c5[_0x1081fd(0x1e8)]=_0x5bb95c;const _0x3a5e6d=await _0x49f7c5[_0x1081fd(0x18e)](),_0x4d0b59=await warehouse[_0x1081fd(0x1cf)]({'name':_0x53a7e6,'room':_0x15e9b4});_0x3a5e6d[_0x1081fd(0x190)]['forEach'](_0x27acb7=>{const _0x5d86f1=_0x4d0b59['product_details']['map'](_0x3f8640=>{var _0x3c4af5=a0_0x164d;_0x27acb7['types']==_0x3c4af5(0x18d)?_0x3f8640[_0x3c4af5(0x1ff)]==_0x27acb7['product_name']&&_0x3f8640[_0x3c4af5(0x1db)]==_0x27acb7[_0x3c4af5(0x1db)]&&(_0x3f8640[_0x3c4af5(0x182)]=parseInt(_0x3f8640[_0x3c4af5(0x182)])-parseInt(_0x27acb7[_0x3c4af5(0x1a5)])):_0x3f8640['product_name']==_0x27acb7[_0x3c4af5(0x1ff)]&&_0x3f8640[_0x3c4af5(0x1db)]==_0x27acb7[_0x3c4af5(0x1db)]&&(_0x3f8640[_0x3c4af5(0x182)]=parseInt(_0x3f8640[_0x3c4af5(0x182)])+parseInt(_0x27acb7[_0x3c4af5(0x1a5)]));});}),await _0x4d0b59[_0x1081fd(0x18e)](),_0x4e0f44[_0x1081fd(0x21f)]('success',_0x1081fd(0x1c3)),_0x19a599['redirect']('/adjustment_finished/view');}catch(_0x45f089){console[_0x1081fd(0x21d)](_0x45f089);}}),router[a0_0x509be3(0x1c8)](a0_0x509be3(0x1eb),async(_0x25a088,_0x371461)=>{var _0x1eca36=a0_0x509be3;const {primary_code:_0xeb16ad,warehouse_data:_0x5983e8,rooms_data:_0x348b69,Roomslist:_0xdae24b}=_0x25a088[_0x1eca36(0x18c)],_0x59dcd7=_0xdae24b[_0x1eca36(0x188)](','),_0xa23631=[];async function _0x3a7c6d(_0x2bfc1b){var _0x81efe2=_0x1eca36;const _0x1c2ee9=await warehouse[_0x81efe2(0x1ef)]([{'$match':{'name':_0x5983e8,'room':_0x2bfc1b}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0xeb16ad}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x81efe2(0x1e4)},'product_stock':{'$first':_0x81efe2(0x1da)},'primary_code':{'$first':_0x81efe2(0x1f7)},'secondary_code':{'$first':_0x81efe2(0x19b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x81efe2(0x1ce)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x81efe2(0x1c2)},'pallet':{'$first':_0x81efe2(0x1df)},'unit':{'$first':_0x81efe2(0x217)},'secondary_unit':{'$first':_0x81efe2(0x1dd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x81efe2(0x220)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x81efe2(0x1c5)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x81efe2(0x1a2)},'roomNamed':{'$first':_0x81efe2(0x20a)},'invoice':{'$first':_0x81efe2(0x1d8)}}}]),_0x1bc363=await warehouse[_0x81efe2(0x1ef)]([{'$match':{'name':_0x5983e8,'room':_0x2bfc1b}},{'$unwind':_0x81efe2(0x1dc)},{'$match':{'product_details.secondary_code':_0xeb16ad}},{'$group':{'_id':_0x81efe2(0x1e6),'name':{'$first':_0x81efe2(0x1e4)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x81efe2(0x1f7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x81efe2(0x1e2)},'level':{'$first':_0x81efe2(0x1ce)},'bay':{'$first':_0x81efe2(0x183)},'type':{'$first':_0x81efe2(0x1c2)},'pallet':{'$first':_0x81efe2(0x1df)},'unit':{'$first':_0x81efe2(0x217)},'secondary_unit':{'$first':_0x81efe2(0x1dd)},'storage':{'$first':_0x81efe2(0x218)},'rack':{'$first':_0x81efe2(0x220)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x81efe2(0x18b)},'batch_code':{'$first':_0x81efe2(0x1c5)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x81efe2(0x1a2)},'roomNamed':{'$first':_0x81efe2(0x20a)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x1c2ee9[_0x81efe2(0x1ee)]>0x0)_0xa23631[_0x81efe2(0x1b5)](_0x1c2ee9);else _0x1bc363[_0x81efe2(0x1ee)]>0x0&&_0xa23631['push'](_0x1bc363);}const _0x1ae00d=_0x59dcd7[_0x1eca36(0x221)](_0x11d33e=>_0x3a7c6d(_0x11d33e));await Promise[_0x1eca36(0x1c7)](_0x1ae00d),_0x371461[_0x1eca36(0x1c1)](_0xa23631);}),router[a0_0x509be3(0x1c8)](a0_0x509be3(0x199),async(_0x51d7c2,_0x2cf97a)=>{var _0x36aa08=a0_0x509be3;const {productCode:_0x17062e,bay:_0x3405d3,warehouses:_0x395451,room:_0x155137}=_0x51d7c2[_0x36aa08(0x18c)];console[_0x36aa08(0x21d)](_0x51d7c2[_0x36aa08(0x18c)]);try{const _0x411ac4=await warehouse[_0x36aa08(0x1ef)]([{'$match':{'name':_0x395451,'room':_0x155137}},{'$unwind':_0x36aa08(0x1dc)},{'$match':{'product_details.bay':parseInt(_0x3405d3)}},{'$group':{'_id':_0x36aa08(0x1e6),'name':{'$first':_0x36aa08(0x1e4)},'product_stock':{'$first':_0x36aa08(0x1da)},'bay':{'$first':_0x36aa08(0x183)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x2cf97a[_0x36aa08(0x20e)](0xc8)[_0x36aa08(0x1c1)](_0x411ac4);}catch(_0x51cb79){_0x2cf97a[_0x36aa08(0x20e)](0x194)[_0x36aa08(0x1c1)]({'message':_0x51cb79['message']});}}),module[a0_0x509be3(0x1d5)]=router;