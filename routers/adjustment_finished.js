var a0_0x31613e=a0_0x935b;(function(_0xcb012f,_0x11fb43){var _0x4f9562=a0_0x935b,_0x3f4946=_0xcb012f();while(!![]){try{var _0x2a8362=parseInt(_0x4f9562(0x234))/0x1+-parseInt(_0x4f9562(0x26d))/0x2+-parseInt(_0x4f9562(0x25d))/0x3*(parseInt(_0x4f9562(0x1f1))/0x4)+parseInt(_0x4f9562(0x1ed))/0x5+-parseInt(_0x4f9562(0x1d3))/0x6*(parseInt(_0x4f9562(0x278))/0x7)+parseInt(_0x4f9562(0x255))/0x8+parseInt(_0x4f9562(0x1eb))/0x9;if(_0x2a8362===_0x11fb43)break;else _0x3f4946['push'](_0x3f4946['shift']());}catch(_0x32ac4c){_0x3f4946['push'](_0x3f4946['shift']());}}}(a0_0x2837,0x21ad5));const express=require(a0_0x31613e(0x21e)),app=express(),router=express['Router'](),auth=require(a0_0x31613e(0x23b)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x31613e(0x27a)),users=require(a0_0x31613e(0x282)),nodemailer=require(a0_0x31613e(0x1dd));router[a0_0x31613e(0x1d8)](a0_0x31613e(0x1e0),auth,async(_0x48c80f,_0xb87714)=>{var _0x41bdaf=a0_0x31613e;try{const {username:_0x1acf33,email:_0xa8201f,role:_0x2f0da6}=_0x48c80f[_0x41bdaf(0x20b)],_0x2b6732=_0x48c80f[_0x41bdaf(0x20b)],_0xc9c3c2=await profile['findOne']({'email':_0x2b6732[_0x41bdaf(0x20e)]}),_0x28fab4=await master_shop[_0x41bdaf(0x1f7)]();let _0x295f4e;if(_0x2b6732[_0x41bdaf(0x240)]==_0x41bdaf(0x1d5)){const _0x490941=await staff[_0x41bdaf(0x241)]({'email':_0x2b6732[_0x41bdaf(0x20e)]});_0x295f4e=await warehouse[_0x41bdaf(0x1f7)]({'status':_0x41bdaf(0x22d),'name':_0x490941[_0x41bdaf(0x224)]});}else _0x295f4e=await warehouse['find']({'status':_0x41bdaf(0x22d)});const _0x130d7a=await product['find']();let _0x21a586;if(_0x2b6732[_0x41bdaf(0x240)]==_0x41bdaf(0x1d5)){const _0x21919a=await staff['findOne']({'email':_0x2b6732['email']});_0x21a586=await adjustment_finished[_0x41bdaf(0x1f7)]({'warehouse_name':_0x21919a[_0x41bdaf(0x224)]});}else _0x21a586=await adjustment_finished[_0x41bdaf(0x1fd)]([{'$match':{'type_of_transaction':_0x41bdaf(0x1fb)}},{'$unwind':_0x41bdaf(0x1f3)},{'$group':{'_id':'$_id','invoice':{'$first':_0x41bdaf(0x1db)},'date':{'$first':_0x41bdaf(0x223)},'warehouse_name':{'$first':_0x41bdaf(0x1d1)},'room':{'$addToSet':_0x41bdaf(0x276)},'finalize':{'$first':_0x41bdaf(0x24e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x28fab4[0x0][_0x41bdaf(0x239)]==_0x41bdaf(0x23e)){var _0x394c08=users[_0x41bdaf(0x1fe)];console[_0x41bdaf(0x27b)](_0x394c08);}else{if(_0x28fab4[0x0]['language']==_0x41bdaf(0x212))var _0x394c08=users[_0x41bdaf(0x212)];else{if(_0x28fab4[0x0][_0x41bdaf(0x239)]==_0x41bdaf(0x24a))var _0x394c08=users[_0x41bdaf(0x24a)];else{if(_0x28fab4[0x0][_0x41bdaf(0x239)]=='Spanish')var _0x394c08=users['Spanish'];else{if(_0x28fab4[0x0]['language']==_0x41bdaf(0x25a))var _0x394c08=users['French'];else{if(_0x28fab4[0x0]['language']==_0x41bdaf(0x262))var _0x394c08=users['Portuguese'];else{if(_0x28fab4[0x0][_0x41bdaf(0x239)]==_0x41bdaf(0x249))var _0x394c08=users['Chinese'];else{if(_0x28fab4[0x0][_0x41bdaf(0x239)]==_0x41bdaf(0x22c))var _0x394c08=users['Arabic'];}}}}}}}_0xb87714['render'](_0x41bdaf(0x1f8),{'success':_0x48c80f[_0x41bdaf(0x219)]('success'),'errors':_0x48c80f[_0x41bdaf(0x219)](_0x41bdaf(0x21d)),'role':_0x2b6732,'profile':_0xc9c3c2,'warehouse':_0x295f4e,'product':_0x130d7a,'adjustment':_0x21a586,'master_shop':_0x28fab4,'language':_0x394c08});}catch(_0x2a687f){console['log'](_0x2a687f);}}),router[a0_0x31613e(0x1d8)](a0_0x31613e(0x1e2),auth,async(_0x4a88fa,_0x529d6f)=>{var _0xcc3327=a0_0x31613e;try{const {username:_0x4b8a36,email:_0x55a56d,role:_0x12a990}=_0x4a88fa[_0xcc3327(0x20b)],_0x5d03aa=_0x4a88fa[_0xcc3327(0x20b)],_0x3e11dc=await profile[_0xcc3327(0x241)]({'email':_0x5d03aa['email']}),_0x1f41dc=await master_shop['find']();let _0x1c2e19;if(_0x5d03aa['role']==_0xcc3327(0x1d5)){const _0x1be950=await staff[_0xcc3327(0x241)]({'email':_0x5d03aa[_0xcc3327(0x20e)]});_0x1c2e19=await warehouse[_0xcc3327(0x1f7)]({'status':_0xcc3327(0x22d),'name':_0x1be950[_0xcc3327(0x224)]});}else _0x1c2e19=await warehouse[_0xcc3327(0x1f7)]({'status':_0xcc3327(0x22d)});const _0x6a1ad9=await product[_0xcc3327(0x1f7)]();let _0x1179df;if(_0x5d03aa[_0xcc3327(0x240)]==_0xcc3327(0x1d5)){const _0x1f951b=await staff[_0xcc3327(0x241)]({'email':_0x5d03aa[_0xcc3327(0x20e)]});_0x1179df=await adjustment_finished[_0xcc3327(0x1f7)]({'warehouse_name':_0x1f951b[_0xcc3327(0x224)]});}else _0x1179df=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0xcc3327(0x1e5)}},{'$unwind':_0xcc3327(0x1f3)},{'$group':{'_id':_0xcc3327(0x210),'invoice':{'$first':_0xcc3327(0x1db)},'date':{'$first':_0xcc3327(0x223)},'warehouse_name':{'$first':_0xcc3327(0x1d1)},'room':{'$addToSet':_0xcc3327(0x276)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1f41dc[0x0][_0xcc3327(0x239)]==_0xcc3327(0x23e))var _0x10a7aa=users[_0xcc3327(0x1fe)];else{if(_0x1f41dc[0x0][_0xcc3327(0x239)]=='Hindi')var _0x10a7aa=users['Hindi'];else{if(_0x1f41dc[0x0]['language']=='German')var _0x10a7aa=users['German'];else{if(_0x1f41dc[0x0]['language']==_0xcc3327(0x233))var _0x10a7aa=users[_0xcc3327(0x233)];else{if(_0x1f41dc[0x0][_0xcc3327(0x239)]==_0xcc3327(0x25a))var _0x10a7aa=users[_0xcc3327(0x25a)];else{if(_0x1f41dc[0x0][_0xcc3327(0x239)]==_0xcc3327(0x262))var _0x10a7aa=users[_0xcc3327(0x204)];else{if(_0x1f41dc[0x0][_0xcc3327(0x239)]==_0xcc3327(0x249))var _0x10a7aa=users['Chinese'];else{if(_0x1f41dc[0x0][_0xcc3327(0x239)]==_0xcc3327(0x22c))var _0x10a7aa=users[_0xcc3327(0x208)];}}}}}}}_0x529d6f[_0xcc3327(0x1f9)]('adjustment_finished_logs',{'success':_0x4a88fa[_0xcc3327(0x219)](_0xcc3327(0x1d7)),'errors':_0x4a88fa[_0xcc3327(0x219)](_0xcc3327(0x21d)),'role':_0x5d03aa,'profile':_0x3e11dc,'warehouse':_0x1c2e19,'product':_0x6a1ad9,'adjustment':_0x1179df,'master_shop':_0x1f41dc,'language':_0x10a7aa});}catch(_0x543a1b){console['log'](_0x543a1b);}});async function getRandom8DigitNumber(){var _0x1611e2=a0_0x31613e;const _0x838d92=0x989680,_0x177c62=0x5f5e0ff,_0x5af7d9=Math[_0x1611e2(0x1f5)](Math['random']()*(_0x177c62-_0x838d92+0x1))+_0x838d92;var _0x3d2201;const _0x3bddf2=await adjustment_finished[_0x1611e2(0x241)]({'invoice':'ADJF-'+_0x5af7d9});return _0x3bddf2&&_0x3bddf2[_0x1611e2(0x25f)]>0x0?_0x3d2201=_0x1611e2(0x279)+_0x5af7d9:_0x3d2201=_0x1611e2(0x279)+_0x5af7d9,_0x3d2201;}function a0_0x935b(_0x3eb5ae,_0x1529dc){var _0x283757=a0_0x2837();return a0_0x935b=function(_0x935b5d,_0x4b7e71){_0x935b5d=_0x935b5d-0x1d1;var _0x1f84f9=_0x283757[_0x935b5d];return _0x1f84f9;},a0_0x935b(_0x3eb5ae,_0x1529dc);}router[a0_0x31613e(0x1d8)](a0_0x31613e(0x263),auth,async(_0x991e35,_0x11eae3)=>{var _0x4df861=a0_0x31613e;try{const {username:_0x3162ae,email:_0xa6125f,role:_0x4b9e65}=_0x991e35[_0x4df861(0x20b)],_0x11176b=_0x991e35[_0x4df861(0x20b)],_0x5cf05a=await profile[_0x4df861(0x241)]({'email':_0x11176b[_0x4df861(0x20e)]}),_0x19fb9e=await master_shop[_0x4df861(0x1f7)]();let _0x5a0ba9;if(_0x11176b[_0x4df861(0x240)]=='staff'){const _0x5f4315=await staff[_0x4df861(0x241)]({'email':_0x11176b[_0x4df861(0x20e)]});_0x5a0ba9=await warehouse[_0x4df861(0x1fd)]([{'$match':{'status':_0x4df861(0x22d),'name':_0x5f4315[_0x4df861(0x224)]}},{'$group':{'_id':_0x4df861(0x273),'name':{'$first':_0x4df861(0x273)}}}]);}else _0x5a0ba9=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4df861(0x273),'name':{'$first':_0x4df861(0x273)}}}]);const _0x4e8675=await product[_0x4df861(0x1f7)]({}),_0x286f90=await adjustment_finished[_0x4df861(0x1f7)](),_0x37af8c=_0x286f90['length']+0x1,_0x432b8c='ADJF-'+_0x37af8c[_0x4df861(0x21b)]()['padStart'](0x5,'0');var _0x2157f9=[_0x4df861(0x1ee),_0x4df861(0x230),_0x4df861(0x22b)];if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x23e))var _0x4ace76=users[_0x4df861(0x1fe)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x212))var _0x4ace76=users[_0x4df861(0x212)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x24a))var _0x4ace76=users[_0x4df861(0x24a)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x233))var _0x4ace76=users[_0x4df861(0x233)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x25a))var _0x4ace76=users[_0x4df861(0x25a)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x262))var _0x4ace76=users[_0x4df861(0x204)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x249))var _0x4ace76=users[_0x4df861(0x249)];else{if(_0x19fb9e[0x0][_0x4df861(0x239)]==_0x4df861(0x22c))var _0x4ace76=users[_0x4df861(0x208)];}}}}}}}const _0x4d0eeb=getRandom8DigitNumber();_0x4d0eeb[_0x4df861(0x228)](_0x1fb34d=>{var _0x45a8=_0x4df861;_0x11eae3[_0x45a8(0x1f9)]('add_adjustment_finished',{'success':_0x991e35[_0x45a8(0x219)]('success'),'errors':_0x991e35[_0x45a8(0x219)](_0x45a8(0x21d)),'role':_0x11176b,'profile':_0x5cf05a,'warehouse':_0x5a0ba9,'product':_0x4e8675,'master_shop':_0x19fb9e,'language':_0x4ace76,'rooms_data':_0x2157f9,'invoice_no':_0x1fb34d});})['catch'](_0x3ef7f5=>{var _0x5705d0=_0x4df861;_0x991e35['flash'](_0x5705d0(0x21d),_0x5705d0(0x277)),_0x11eae3[_0x5705d0(0x222)](_0x5705d0(0x274));});}catch(_0xc0bac9){console[_0x4df861(0x27b)](_0xc0bac9);}}),router['post'](a0_0x31613e(0x263),auth,async(_0x59115b,_0x159e65)=>{var _0xfda517=a0_0x31613e;try{const {warehouse_name:_0x503142,date:_0x155800,prod_name:_0x58fdbf,level:_0x44d2bf,isle:_0x4ff5fc,pallet:_0x1e721a,stock:_0x54650f,types:_0x5b142b,adjust_qty:_0x3b7a4f,new_adjust_qty:_0x415a81,note:_0x322e6f,Room_name:_0x23cbe0,JO_number:_0x11cfe6,expiry_date:_0x1deb10,PO_number:_0x4a59b3,ReqBy:_0x45211e,dateofreq:_0x51597f,typeservicesData:_0x5c6fa8,destination:_0x495833,deliverydate:_0x138a79,driver:_0x14bca0,plate:_0x4a204c,van:_0x4aaa6c,DRSI:_0xd50db4,typevehicle:_0x53caf8,TSU:_0x900e95,TFU:_0x55893d}=_0x59115b[_0xfda517(0x218)];if(typeof _0x58fdbf==_0xfda517(0x254))var _0x13b059=[_0x59115b['body'][_0xfda517(0x24c)]],_0x29bc7c=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x23f)]],_0x228e48=[_0x59115b['body']['stock']],_0x128cbc=[_0x59115b[_0xfda517(0x218)]['types']],_0x446f90=[_0x59115b['body'][_0xfda517(0x22a)]],_0x360cd5=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x1f4)]],_0x5b298f=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x20d)]],_0xeef4e0=[_0x59115b[_0xfda517(0x218)]['Secondary_units']],_0x4c179c=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x205)]],_0xa0704c=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x1df)]],_0x5e5830=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x25b)]],_0x53d5af=[_0x59115b['body'][_0xfda517(0x284)]],_0x33277b=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x244)]],_0x1884fa=[_0x59115b[_0xfda517(0x218)]['Rooms']],_0x1853dc=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x1ff)]],_0x5a1b01=[_0x59115b[_0xfda517(0x218)][_0xfda517(0x21c)]],_0x5823e3=[_0x59115b['body']['id_transaction_from']];else var _0x13b059=[..._0x59115b['body'][_0xfda517(0x24c)]],_0x29bc7c=[..._0x59115b['body']['level']],_0x228e48=[..._0x59115b[_0xfda517(0x218)]['stock']],_0x128cbc=[..._0x59115b[_0xfda517(0x218)][_0xfda517(0x247)]],_0x446f90=[..._0x59115b[_0xfda517(0x218)][_0xfda517(0x22a)]],_0x360cd5=[..._0x59115b['body']['New_Qty_Converted']],_0x5b298f=[..._0x59115b[_0xfda517(0x218)][_0xfda517(0x20d)]],_0xeef4e0=[..._0x59115b['body'][_0xfda517(0x1da)]],_0x4c179c=[..._0x59115b[_0xfda517(0x218)][_0xfda517(0x205)]],_0xa0704c=[..._0x59115b['body'][_0xfda517(0x1df)]],_0x5e5830=[..._0x59115b[_0xfda517(0x218)]['expiry_date']],_0x53d5af=[..._0x59115b[_0xfda517(0x218)]['product_date']],_0x33277b=[..._0x59115b[_0xfda517(0x218)][_0xfda517(0x244)]],_0x1884fa=[..._0x59115b[_0xfda517(0x218)][_0xfda517(0x203)]],_0x1853dc=[..._0x59115b['body']['maxPerUnit']],_0x5a1b01=[..._0x59115b[_0xfda517(0x218)]['prod_invoice']],_0x5823e3=[..._0x59115b[_0xfda517(0x218)]['id_transaction_from']];const _0x4f6732=_0x13b059[_0xfda517(0x26c)](_0x34e552=>{return _0x34e552={'product_name':_0x34e552};});_0x29bc7c[_0xfda517(0x27e)]((_0x79a688,_0x5a1a51)=>{var _0x1c1bfb=_0xfda517,_0x1bf04e=_0x79a688['match'](/[A-Za-z]+/)[0x0],_0x434722=parseInt(_0x79a688[_0x1c1bfb(0x267)](/\d+/)[0x0]);_0x4f6732[_0x5a1a51][_0x1c1bfb(0x23f)]=_0x1bf04e,_0x4f6732[_0x5a1a51]['bay']=_0x434722;}),_0x5823e3[_0xfda517(0x27e)]((_0x523fcf,_0x38ee0f)=>{var _0x2f6905=_0xfda517;_0x4f6732[_0x38ee0f][_0x2f6905(0x1d2)]=_0x523fcf;}),_0x228e48['forEach']((_0x2175b0,_0x869380)=>{var _0x4c099c=_0xfda517;_0x4f6732[_0x869380][_0x4c099c(0x226)]=_0x2175b0;}),_0x128cbc['forEach']((_0x32e778,_0x4e7bce)=>{var _0x1781ca=_0xfda517;_0x4f6732[_0x4e7bce][_0x1781ca(0x247)]=_0x32e778;}),_0x446f90['forEach']((_0x1d9fe6,_0x325d23)=>{var _0x2bde09=_0xfda517;_0x4f6732[_0x325d23][_0x2bde09(0x238)]=_0x1d9fe6;}),_0x360cd5['forEach']((_0x4ff242,_0xe92a9a)=>{var _0x3cf3f3=_0xfda517;_0x4f6732[_0xe92a9a][_0x3cf3f3(0x260)]=_0x4ff242;}),_0x5b298f[_0xfda517(0x27e)]((_0xbb7a48,_0x29bbc2)=>{_0x4f6732[_0x29bbc2]['unit']=_0xbb7a48;}),_0xeef4e0['forEach']((_0x348ad2,_0x3953c2)=>{var _0x121281=_0xfda517;_0x4f6732[_0x3953c2][_0x121281(0x27f)]=_0x348ad2;}),_0x4c179c['forEach']((_0x239f8b,_0x1a1728)=>{var _0x581cdc=_0xfda517;_0x4f6732[_0x1a1728][_0x581cdc(0x1d4)]=_0x239f8b;}),_0xa0704c[_0xfda517(0x27e)]((_0x1dd469,_0x41df8f)=>{var _0x58d5db=_0xfda517;_0x4f6732[_0x41df8f][_0x58d5db(0x1df)]=_0x1dd469;}),_0x5e5830[_0xfda517(0x27e)]((_0x42baac,_0x4aafe7)=>{var _0x359c18=_0xfda517;_0x4f6732[_0x4aafe7][_0x359c18(0x25b)]=_0x42baac;}),_0x53d5af[_0xfda517(0x27e)]((_0x69aec2,_0x184910)=>{var _0x53e792=_0xfda517;_0x4f6732[_0x184910][_0x53e792(0x24b)]=_0x69aec2;}),_0x33277b[_0xfda517(0x27e)]((_0x232da6,_0x4c6b9f)=>{var _0x25d7d4=_0xfda517;_0x4f6732[_0x4c6b9f][_0x25d7d4(0x244)]=_0x232da6;}),_0x1884fa['forEach']((_0x2032d5,_0x28d91d)=>{_0x4f6732[_0x28d91d]['room_names']=_0x2032d5;}),_0x1853dc[_0xfda517(0x27e)]((_0x38035a,_0x2a5ae8)=>{var _0x24419d=_0xfda517;_0x4f6732[_0x2a5ae8][_0x24419d(0x1ff)]=_0x38035a;}),_0x5a1b01[_0xfda517(0x27e)]((_0xdacab2,_0x5b7e32)=>{var _0x1e5d09=_0xfda517;_0x4f6732[_0x5b7e32][_0x1e5d09(0x201)]=_0xdacab2;});const _0x73643b=_0x4f6732[_0xfda517(0x245)](_0x256547=>_0x256547[_0xfda517(0x238)]!=='0'&&_0x256547['adjust_qty']!=='');var _0x5839ca=0x0;_0x73643b[_0xfda517(0x27e)](_0x54f76b=>{var _0x41c5ef=_0xfda517;console[_0x41c5ef(0x27b)]('foreach\x20newproduct',_0x54f76b),parseInt(_0x54f76b[_0x41c5ef(0x238)])<=0x0&&_0x5839ca++;});if(_0x5839ca!=0x0)return _0x59115b[_0xfda517(0x219)](_0xfda517(0x21d),_0xfda517(0x275)),_0x159e65[_0xfda517(0x222)](_0xfda517(0x285));const _0x5b8af5=new invoice_for_adjustment();await _0x5b8af5[_0xfda517(0x20c)]();const _0x4f2068=new adjustment_finished({'warehouse_name':_0x503142,'date':_0x155800,'product':_0x73643b,'note':_0x322e6f,'room':_0x23cbe0,'invoice':_0xfda517(0x243)+_0x5b8af5[_0xfda517(0x271)][_0xfda517(0x21b)]()[_0xfda517(0x1d9)](0x8,'0'),'JO_number':_0x11cfe6,'expiry_date':_0x1deb10,'PO_number':_0x4a59b3,'RequestedBy':_0x45211e,'DateofRequest':_0x51597f,'typeservices':_0x5c6fa8,'destination':_0x495833,'deliverydate':_0x138a79,'driver':_0x14bca0,'plate':_0x4a204c,'van':_0x4aaa6c,'DRSI':_0xd50db4,'typevehicle':_0x53caf8,'TSU':_0x900e95,'TFU':_0x55893d}),_0x3e0bac=await _0x4f2068[_0xfda517(0x20c)]();_0x59115b[_0xfda517(0x219)]('success',_0xfda517(0x26f)),_0x159e65[_0xfda517(0x222)](_0xfda517(0x283)+_0x3e0bac[_0xfda517(0x216)]);}catch(_0x48e5ad){console[_0xfda517(0x27b)](_0x48e5ad),_0x159e65[_0xfda517(0x21a)](0xc8)[_0xfda517(0x280)]({'message':_0x48e5ad['message']});}}),router[a0_0x31613e(0x1d8)](a0_0x31613e(0x215),auth,async(_0x2ea6ae,_0x48193f)=>{var _0x3ed82b=a0_0x31613e;try{const {username:_0x598e66,email:_0x4f0f91,role:_0x29add0}=_0x2ea6ae['user'],_0x19ccd5=_0x2ea6ae['user'],_0x2d4bfc=await profile[_0x3ed82b(0x241)]({'email':_0x19ccd5[_0x3ed82b(0x20e)]}),_0x491e85=await master_shop[_0x3ed82b(0x1f7)]();let _0x5575d4;if(_0x19ccd5[_0x3ed82b(0x240)]==_0x3ed82b(0x1d5)){const _0x349b53=await staff[_0x3ed82b(0x241)]({'email':_0x19ccd5[_0x3ed82b(0x20e)]});_0x5575d4=await warehouse['aggregate']([{'$match':{'status':_0x3ed82b(0x22d),'name':_0x349b53[_0x3ed82b(0x224)]}},{'$group':{'_id':_0x3ed82b(0x273),'name':{'$first':'$name'}}}]);}else _0x5575d4=await warehouse[_0x3ed82b(0x1fd)]([{'$match':{'status':_0x3ed82b(0x22d)}},{'$group':{'_id':_0x3ed82b(0x273),'name':{'$first':_0x3ed82b(0x273)}}}]);const _0x2cdb0d=await product[_0x3ed82b(0x1f7)](),_0x56c44d=await adjustment_finished[_0x3ed82b(0x1f7)](),_0x50b1a8=_0x56c44d['length']+0x1,_0x32d1df='ADJF-'+_0x50b1a8[_0x3ed82b(0x21b)]()[_0x3ed82b(0x1d9)](0x5,'0');var _0x309625=[_0x3ed82b(0x1ee),'Enclosed',_0x3ed82b(0x22b)];if(_0x491e85[0x0]['language']==_0x3ed82b(0x23e))var _0x389d06=users[_0x3ed82b(0x1fe)];else{if(_0x491e85[0x0][_0x3ed82b(0x239)]==_0x3ed82b(0x212))var _0x389d06=users['Hindi'];else{if(_0x491e85[0x0][_0x3ed82b(0x239)]=='German')var _0x389d06=users[_0x3ed82b(0x24a)];else{if(_0x491e85[0x0]['language']==_0x3ed82b(0x233))var _0x389d06=users[_0x3ed82b(0x233)];else{if(_0x491e85[0x0]['language']==_0x3ed82b(0x25a))var _0x389d06=users[_0x3ed82b(0x25a)];else{if(_0x491e85[0x0][_0x3ed82b(0x239)]==_0x3ed82b(0x262))var _0x389d06=users['Portuguese'];else{if(_0x491e85[0x0][_0x3ed82b(0x239)]=='Chinese')var _0x389d06=users[_0x3ed82b(0x249)];else{if(_0x491e85[0x0][_0x3ed82b(0x239)]==_0x3ed82b(0x22c))var _0x389d06=users['Arabic'];}}}}}}}const _0x3c6d29=getRandom8DigitNumber();_0x3c6d29[_0x3ed82b(0x228)](_0x1cec5e=>{var _0x1de93b=_0x3ed82b;_0x48193f[_0x1de93b(0x1f9)](_0x1de93b(0x23a),{'success':_0x2ea6ae['flash']('success'),'errors':_0x2ea6ae['flash'](_0x1de93b(0x21d)),'role':_0x19ccd5,'profile':_0x2d4bfc,'warehouse':_0x5575d4,'product':_0x2cdb0d,'master_shop':_0x491e85,'language':_0x389d06,'rooms_data':_0x309625,'invoice_no':_0x1cec5e});})[_0x3ed82b(0x22e)](_0x59ef08=>{var _0x525457=_0x3ed82b;_0x2ea6ae[_0x525457(0x219)](_0x525457(0x21d),_0x525457(0x277)),_0x48193f[_0x525457(0x222)]('/adjustment/view');});}catch(_0x1b24ba){console[_0x3ed82b(0x27b)](_0x1b24ba);}}),router[a0_0x31613e(0x209)](a0_0x31613e(0x215),auth,async(_0xbe77fe,_0x7ddfe6)=>{var _0x1b9011=a0_0x31613e;try{const {warehouse_name:_0x127edf,date:_0x461504,prod_name:_0x48d885,level:_0x4f901c,isle:_0x3ab1b9,pallet:_0x47b4f0,stock:_0x3fd0a2,types:_0x522631,adjust_qty:_0x2cf8c7,new_adjust_qty:_0x45cf74,note:_0x392aad,Room_name:_0x418a0e,JO_number:_0x2b2e0e,expiry_date:_0x2935ab,type_of_transaction:_0x347c9d,PO_number:_0x2da7e6,ReqBy:_0x34337c,dateofreq:_0x4d9972,typeservicesData:_0x5cb1b8,destination:_0x307e8a,deliverydate:_0x38ab1b,driver:_0x27460f,plate:_0x25d1fa,van:_0x1382d1,DRSI:_0x3d3bca,typevehicle:_0x532b91,TSU:_0x3d01ec,TFU:_0x3e3751}=_0xbe77fe['body'];if(typeof _0x48d885==_0x1b9011(0x254))var _0x56d4d5=[_0xbe77fe['body']['prod_name']],_0xf9f11a=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x23f)]],_0x4b05de=[_0xbe77fe[_0x1b9011(0x218)]['stock']],_0x15af9d=[_0xbe77fe[_0x1b9011(0x218)]['types']],_0x68e9ea=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x22a)]],_0x4b8f1e=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x1f4)]],_0x10b991=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x20d)]],_0x214715=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x1da)]],_0xe0348b=[_0xbe77fe[_0x1b9011(0x218)]['prod_code']],_0x27851a=[_0xbe77fe[_0x1b9011(0x218)]['batch_code']],_0x5a0995=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x25b)]],_0x743f24=[_0xbe77fe['body'][_0x1b9011(0x284)]],_0x2356c4=[_0xbe77fe['body'][_0x1b9011(0x244)]],_0x24dd56=[_0xbe77fe['body'][_0x1b9011(0x203)]],_0x5b0b94=[_0xbe77fe[_0x1b9011(0x218)]['maxPerUnit']],_0x583de0=[_0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x21c)]],_0x1faec8=[_0xbe77fe['body'][_0x1b9011(0x1e4)]];else var _0x56d4d5=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x24c)]],_0xf9f11a=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x23f)]],_0x4b05de=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x207)]],_0x15af9d=[..._0xbe77fe[_0x1b9011(0x218)]['types']],_0x68e9ea=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x22a)]],_0x4b8f1e=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x1f4)]],_0x10b991=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x20d)]],_0x214715=[..._0xbe77fe['body']['Secondary_units']],_0xe0348b=[..._0xbe77fe['body'][_0x1b9011(0x205)]],_0x27851a=[..._0xbe77fe['body'][_0x1b9011(0x1df)]],_0x5a0995=[..._0xbe77fe['body'][_0x1b9011(0x25b)]],_0x743f24=[..._0xbe77fe[_0x1b9011(0x218)]['product_date']],_0x2356c4=[..._0xbe77fe[_0x1b9011(0x218)]['prod_cat']],_0x24dd56=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x203)]],_0x5b0b94=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x1ff)]],_0x583de0=[..._0xbe77fe[_0x1b9011(0x218)]['prod_invoice']],_0x1faec8=[..._0xbe77fe[_0x1b9011(0x218)][_0x1b9011(0x1e4)]];const _0x3abbf4=_0x56d4d5[_0x1b9011(0x26c)](_0x3488f6=>{return _0x3488f6={'product_name':_0x3488f6};});_0xf9f11a[_0x1b9011(0x27e)]((_0x4f2091,_0x56da2f)=>{var _0x4ca8de=_0x1b9011,_0x4eed59=_0x4f2091[_0x4ca8de(0x267)](/[A-Za-z]+/)[0x0],_0x257482=parseInt(_0x4f2091[_0x4ca8de(0x267)](/\d+/)[0x0]);_0x3abbf4[_0x56da2f][_0x4ca8de(0x23f)]=_0x4eed59,_0x3abbf4[_0x56da2f]['bay']=_0x257482;}),_0x1faec8['forEach']((_0x7ca53f,_0x1d04d2)=>{var _0x337fe8=_0x1b9011;_0x3abbf4[_0x1d04d2][_0x337fe8(0x1d2)]=_0x7ca53f;}),_0x4b05de[_0x1b9011(0x27e)]((_0x206398,_0x3e685c)=>{var _0x47d357=_0x1b9011;_0x3abbf4[_0x3e685c][_0x47d357(0x226)]=_0x206398;}),_0x15af9d[_0x1b9011(0x27e)]((_0xd2bf33,_0x5b2849)=>{var _0x35d850=_0x1b9011;_0x3abbf4[_0x5b2849][_0x35d850(0x247)]=_0xd2bf33;}),_0x68e9ea[_0x1b9011(0x27e)]((_0x2bed03,_0x366953)=>{var _0x12fa10=_0x1b9011;_0x3abbf4[_0x366953][_0x12fa10(0x238)]=_0x2bed03;}),_0x4b8f1e[_0x1b9011(0x27e)]((_0x4069ab,_0x4edff7)=>{var _0x3a1459=_0x1b9011;_0x3abbf4[_0x4edff7][_0x3a1459(0x260)]=_0x4069ab;}),_0x10b991[_0x1b9011(0x27e)]((_0x500137,_0x1ca1d2)=>{_0x3abbf4[_0x1ca1d2]['unit']=_0x500137;}),_0x214715[_0x1b9011(0x27e)]((_0x2a96ec,_0x3b07c7)=>{var _0x324016=_0x1b9011;_0x3abbf4[_0x3b07c7][_0x324016(0x27f)]=_0x2a96ec;}),_0xe0348b[_0x1b9011(0x27e)]((_0x4d050d,_0x6a020c)=>{var _0x347379=_0x1b9011;_0x3abbf4[_0x6a020c][_0x347379(0x1d4)]=_0x4d050d;}),_0x27851a[_0x1b9011(0x27e)]((_0x47ad1c,_0x26a179)=>{var _0x2f7009=_0x1b9011;_0x3abbf4[_0x26a179][_0x2f7009(0x1df)]=_0x47ad1c;}),_0x5a0995[_0x1b9011(0x27e)]((_0x3cd34c,_0x526b02)=>{var _0x438b58=_0x1b9011;_0x3abbf4[_0x526b02][_0x438b58(0x25b)]=_0x3cd34c;}),_0x743f24[_0x1b9011(0x27e)]((_0x236998,_0x3c2923)=>{var _0x45552f=_0x1b9011;_0x3abbf4[_0x3c2923][_0x45552f(0x24b)]=_0x236998;}),_0x2356c4[_0x1b9011(0x27e)]((_0x62be92,_0xba7357)=>{_0x3abbf4[_0xba7357]['prod_cat']=_0x62be92;}),_0x24dd56[_0x1b9011(0x27e)]((_0x414b47,_0x134c25)=>{var _0x484645=_0x1b9011;_0x3abbf4[_0x134c25][_0x484645(0x251)]=_0x414b47;}),_0x5b0b94[_0x1b9011(0x27e)]((_0x3edeff,_0x5affbe)=>{var _0x505f0f=_0x1b9011;_0x3abbf4[_0x5affbe][_0x505f0f(0x1ff)]=_0x3edeff;}),_0x583de0[_0x1b9011(0x27e)]((_0x250392,_0x5bccaa)=>{var _0x51eb14=_0x1b9011;_0x3abbf4[_0x5bccaa][_0x51eb14(0x201)]=_0x250392;});const _0x39c3e4=_0x3abbf4[_0x1b9011(0x245)](_0x23abd0=>_0x23abd0['adjust_qty']!=='0'&&_0x23abd0['adjust_qty']!=='');var _0xcd7be=0x0;_0x39c3e4[_0x1b9011(0x27e)](_0x42bc73=>{var _0x2ce886=_0x1b9011;console[_0x2ce886(0x27b)](_0x2ce886(0x20f),_0x42bc73),parseInt(_0x42bc73[_0x2ce886(0x238)])<=0x0&&_0xcd7be++;});if(_0xcd7be!=0x0)return _0xbe77fe[_0x1b9011(0x219)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x7ddfe6[_0x1b9011(0x222)](_0x1b9011(0x285));const _0x596f53=new adjustment_logs();await _0x596f53[_0x1b9011(0x20c)]();const _0xcd6675=new adjustment_finished({'warehouse_name':_0x127edf,'date':_0x461504,'product':_0x39c3e4,'note':_0x392aad,'room':_0x418a0e,'invoice':_0x1b9011(0x1e6)+_0x596f53[_0x1b9011(0x271)][_0x1b9011(0x21b)]()[_0x1b9011(0x1d9)](0x8,'0'),'JO_number':_0x2b2e0e,'expiry_date':_0x2935ab,'type_of_transaction':_0x347c9d,'PO_number':_0x2da7e6,'RequestedBy':_0x34337c,'DateofRequest':_0x4d9972,'typeservices':_0x5cb1b8,'destination':_0x307e8a,'deliverydate':_0x38ab1b,'driver':_0x27460f,'plate':_0x25d1fa,'van':_0x1382d1,'DRSI':_0x3d3bca,'typevehicle':_0x532b91,'TSU':_0x3d01ec,'TFU':_0x3e3751}),_0x3d636b=await _0xcd6675[_0x1b9011(0x20c)]();_0xbe77fe[_0x1b9011(0x219)](_0x1b9011(0x1d7),_0x1b9011(0x26f)),_0x7ddfe6[_0x1b9011(0x222)](_0x1b9011(0x283)+_0x3d636b['_id']);}catch(_0x37cbfa){console['log'](_0x37cbfa),_0x7ddfe6[_0x1b9011(0x21a)](0xc8)[_0x1b9011(0x280)]({'message':_0x37cbfa[_0x1b9011(0x1e7)]});}}),router[a0_0x31613e(0x1d8)](a0_0x31613e(0x217),auth,async(_0x804aaf,_0xdea8eb)=>{var _0x15dac2=a0_0x31613e;try{const {username:_0x58edf2,email:_0x5b8124,role:_0xaaffd7}=_0x804aaf[_0x15dac2(0x20b)],_0x5c1e90=_0x804aaf[_0x15dac2(0x20b)],_0x2a7545=await profile['findOne']({'email':_0x5c1e90[_0x15dac2(0x20e)]}),_0x17b3b3=await master_shop[_0x15dac2(0x1f7)](),_0x4358e3=_0x804aaf['params']['id'],_0x5ce4ff=await adjustment_finished['findById']({'_id':_0x4358e3}),_0x826fb0=await purchases[_0x15dac2(0x1fd)]([{'$match':{'warehouse_name':_0x5ce4ff['warehouse_name']}},{'$unwind':_0x15dac2(0x1f3)},{'$group':{'_id':_0x15dac2(0x268)}}]);console[_0x15dac2(0x27b)](_0x15dac2(0x269),_0x826fb0);const _0x2cadaa=await product[_0x15dac2(0x1f7)]({}),_0x4b6027=await warehouse[_0x15dac2(0x1fd)]([{'$match':{'name':_0x5ce4ff[_0x15dac2(0x24f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x15dac2(0x1ec),'name':{'$first':_0x15dac2(0x281)},'product_stock':{'$first':_0x15dac2(0x26e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x15dac2(0x252)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x15dac2(0x21f)},'secondary_code':{'$first':_0x15dac2(0x1d6)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x15dac2(0x220)},'rack':{'$first':_0x15dac2(0x1ef)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x15dac2(0x265)},'batch_code':{'$first':_0x15dac2(0x229)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x15dac2(0x200)}}}]);if(_0x17b3b3[0x0][_0x15dac2(0x239)]==_0x15dac2(0x23e)){var _0x20c6f4=users['English'];console['log'](_0x20c6f4);}else{if(_0x17b3b3[0x0][_0x15dac2(0x239)]==_0x15dac2(0x212))var _0x20c6f4=users[_0x15dac2(0x212)];else{if(_0x17b3b3[0x0]['language']==_0x15dac2(0x24a))var _0x20c6f4=users[_0x15dac2(0x24a)];else{if(_0x17b3b3[0x0]['language']=='Spanish')var _0x20c6f4=users[_0x15dac2(0x233)];else{if(_0x17b3b3[0x0]['language']==_0x15dac2(0x25a))var _0x20c6f4=users[_0x15dac2(0x25a)];else{if(_0x17b3b3[0x0][_0x15dac2(0x239)]==_0x15dac2(0x262))var _0x20c6f4=users['Portuguese'];else{if(_0x17b3b3[0x0]['language']==_0x15dac2(0x249))var _0x20c6f4=users[_0x15dac2(0x249)];else{if(_0x17b3b3[0x0][_0x15dac2(0x239)]==_0x15dac2(0x22c))var _0x20c6f4=users[_0x15dac2(0x208)];}}}}}}}_0xdea8eb['render'](_0x15dac2(0x26b),{'success':_0x804aaf['flash']('success'),'errors':_0x804aaf[_0x15dac2(0x219)](_0x15dac2(0x21d)),'role':_0x5c1e90,'profile':_0x2a7545,'adjustment':_0x5ce4ff,'stock':_0x4b6027,'master_shop':_0x17b3b3,'warehouse_name':_0x826fb0,'unit':_0x2cadaa,'language':_0x20c6f4});}catch(_0x5f1019){console[_0x15dac2(0x27b)](_0x5f1019),_0xdea8eb[_0x15dac2(0x21a)](0xc8)[_0x15dac2(0x280)]({'message':_0x5f1019[_0x15dac2(0x1e7)]});}}),router[a0_0x31613e(0x209)](a0_0x31613e(0x217),auth,async(_0x846697,_0x8792a1)=>{var _0x5f2e82=a0_0x31613e;try{const {invoice:_0x1eb18b,warehouse_name:_0x16115b,Room_name:_0x429408}=_0x846697[_0x5f2e82(0x218)],_0x14edef=_0x846697['params']['id'],_0x4027d5=await adjustment_finished['findById']({'_id':_0x14edef});var _0x4ee655;const _0x284de9=_0x4027d5['product'][_0x5f2e82(0x26c)](async _0x4d169d=>{var _0x53c242=_0x5f2e82;if(_0x4d169d['adjust_qty']>0x0){_0x4ee655=await warehouse[_0x53c242(0x241)]({'name':_0x16115b,'room':_0x4d169d['room_names']});const _0x2fa6b4=_0x4ee655[_0x53c242(0x221)][_0x53c242(0x26c)](_0x531c37=>{var _0x2b3b6a=_0x53c242;console['log'](_0x4d169d[_0x2b3b6a(0x247)]);if(_0x4d169d['types']=='minus')_0x531c37[_0x2b3b6a(0x216)]==_0x4d169d['id_transaction']&&(_0x531c37['product_stock']=_0x531c37[_0x2b3b6a(0x227)]-_0x4d169d[_0x2b3b6a(0x238)]);else _0x4d169d[_0x2b3b6a(0x247)]==_0x2b3b6a(0x25e)&&(_0x531c37[_0x2b3b6a(0x216)]==_0x4d169d['id_transaction']&&(_0x531c37['product_stock']=_0x531c37['product_stock']+_0x4d169d[_0x2b3b6a(0x238)]));});}return _0x4ee655;});Promise[_0x5f2e82(0x1f2)](_0x284de9)[_0x5f2e82(0x228)](async _0x1d6290=>{var _0x27384c=_0x5f2e82;try{for(const _0x173719 of _0x1d6290){await _0x173719[_0x27384c(0x20c)]();}_0x4027d5[_0x27384c(0x20a)]=_0x27384c(0x256);const _0x2bf41b=await _0x4027d5[_0x27384c(0x20c)](),_0x280ba4=await master_shop[_0x27384c(0x1f7)](),_0x101579=await email_settings[_0x27384c(0x241)](),_0x1c29dc=await supervisor_settings['find']();var _0x3b4c0c=_0x4027d5['product'],_0x40d215='',_0x2d0911;for(_0x2d0911 in _0x3b4c0c){var _0x119325='FG';_0x4027d5[_0x27384c(0x24f)]==_0x27384c(0x1e8)&&(_0x119325='DG'),_0x40d215+=_0x27384c(0x202)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b4c0c[_0x2d0911][_0x27384c(0x258)]+_0x27384c(0x22f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b4c0c[_0x2d0911][_0x27384c(0x1d4)]+'</td>'+_0x27384c(0x257)+_0x3b4c0c[_0x2d0911][_0x27384c(0x238)]+_0x27384c(0x22f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b4c0c[_0x2d0911]['unit']+_0x27384c(0x22f)+_0x27384c(0x257)+_0x3b4c0c[_0x2d0911]['secondary_unit']+'</td>'+_0x27384c(0x257)+_0x4027d5[_0x27384c(0x24f)]+_0x27384c(0x22f)+_0x27384c(0x257)+_0x3b4c0c[_0x2d0911]['room_names']+'</td>'+_0x27384c(0x257)+_0x119325+_0x3b4c0c[_0x2d0911][_0x27384c(0x213)]+_0x27384c(0x22f)+_0x27384c(0x272);}_0x846697[_0x27384c(0x219)]('success',_0x27384c(0x1f6)),_0x8792a1['redirect'](_0x27384c(0x235)+_0x2bf41b['_id']);}catch(_0x37e9f2){console[_0x27384c(0x232)](_0x37e9f2),_0x8792a1[_0x27384c(0x21a)](0x1f4)[_0x27384c(0x280)]({'error':_0x27384c(0x1e9)});}})[_0x5f2e82(0x22e)](_0x5437e2=>{var _0x5da04a=_0x5f2e82;console['error'](_0x5437e2),_0x8792a1[_0x5da04a(0x21a)](0x1f4)[_0x5da04a(0x280)]({'error':_0x5da04a(0x236)});});}catch(_0x816f0){_0x8792a1[_0x5f2e82(0x280)]({'message':_0x816f0[_0x5f2e82(0x1e7)]});}}),router['get'](a0_0x31613e(0x225),auth,async(_0x432af9,_0x14f822)=>{var _0x5f0a80=a0_0x31613e;try{const {username:_0x3eef40,email:_0x9f0983,role:_0xff411b}=_0x432af9['user'],_0x3795d4=_0x432af9['user'],_0x57ed1a=await profile[_0x5f0a80(0x241)]({'email':_0x3795d4[_0x5f0a80(0x20e)]}),_0x1ee87c=await master_shop['find']();console[_0x5f0a80(0x27b)](_0x5f0a80(0x259),_0x1ee87c);const _0x1dca36=_0x432af9[_0x5f0a80(0x261)]['id'],_0x58520b=await adjustment_finished[_0x5f0a80(0x1fa)]({'_id':_0x1dca36});let _0x2e6bf7=new Date(_0x58520b[_0x5f0a80(0x25b)]),_0x582d94=('0'+_0x2e6bf7['getDate']())[_0x5f0a80(0x266)](-0x2),_0x75da68=('0'+(_0x2e6bf7[_0x5f0a80(0x25c)]()+0x1))[_0x5f0a80(0x266)](-0x2),_0x37fa6d=_0x2e6bf7['getFullYear'](),_0xe60182=_0x37fa6d+'-'+_0x75da68+'-'+_0x582d94;var _0x2f2400=['Ambient',_0x5f0a80(0x230),_0x5f0a80(0x22b)];const _0x358aaa=await purchases[_0x5f0a80(0x1fd)]([{'$match':{'warehouse_name':_0x58520b[_0x5f0a80(0x24f)]}},{'$unwind':_0x5f0a80(0x1f3)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x358aaa);const _0x64a9be=await product[_0x5f0a80(0x1f7)]({}),_0x38e509=await warehouse[_0x5f0a80(0x1fd)]([{'$match':{'name':_0x58520b[_0x5f0a80(0x24f)],'room':_0x58520b[_0x5f0a80(0x211)]}},{'$unwind':_0x5f0a80(0x26a)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5f0a80(0x250)},'bin':{'$first':_0x5f0a80(0x252)},'type':{'$first':_0x5f0a80(0x270)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5f0a80(0x21f)},'secondary_code':{'$first':_0x5f0a80(0x1d6)},'product_code':{'$first':_0x5f0a80(0x242)},'storage':{'$first':_0x5f0a80(0x220)},'rack':{'$first':_0x5f0a80(0x1ef)}}}]);if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x23e)){var _0xfd29b9=users['English'];console[_0x5f0a80(0x27b)](_0xfd29b9);}else{if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x212))var _0xfd29b9=users[_0x5f0a80(0x212)];else{if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x24a))var _0xfd29b9=users['German'];else{if(_0x1ee87c[0x0]['language']==_0x5f0a80(0x233))var _0xfd29b9=users[_0x5f0a80(0x233)];else{if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x25a))var _0xfd29b9=users[_0x5f0a80(0x25a)];else{if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x262))var _0xfd29b9=users[_0x5f0a80(0x204)];else{if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x249))var _0xfd29b9=users[_0x5f0a80(0x249)];else{if(_0x1ee87c[0x0][_0x5f0a80(0x239)]==_0x5f0a80(0x22c))var _0xfd29b9=users[_0x5f0a80(0x208)];}}}}}}}_0x14f822[_0x5f0a80(0x1f9)](_0x5f0a80(0x1ea),{'success':_0x432af9[_0x5f0a80(0x219)](_0x5f0a80(0x1d7)),'errors':_0x432af9[_0x5f0a80(0x219)](_0x5f0a80(0x21d)),'role':_0x3795d4,'profile':_0x57ed1a,'adjustment':_0x58520b,'stock':_0x38e509,'master_shop':_0x1ee87c,'warehouse_name':_0x358aaa,'unit':_0x64a9be,'language':_0xfd29b9,'rooms_data':_0x2f2400,'ed_fullDate':_0xe60182});}catch(_0x198580){console[_0x5f0a80(0x27b)](_0x198580),_0x14f822[_0x5f0a80(0x21a)](0xc8)[_0x5f0a80(0x280)]({'message':_0x198580[_0x5f0a80(0x1e7)]});}}),router['post']('/view/:id',auth,async(_0x4779f9,_0x120aaa)=>{var _0x1012ce=a0_0x31613e;try{const _0x3a5860=_0x4779f9[_0x1012ce(0x261)]['id'],_0x2b9d6d=await adjustment_finished[_0x1012ce(0x1fa)]({'_id':_0x3a5860}),_0x4d2254=await warehouse[_0x1012ce(0x241)]({'name':_0x2b9d6d[_0x1012ce(0x24f)],'room':_0x2b9d6d['room']}),{warehouse_name:_0x50cab7,date:_0x31acb0,prod_name:_0xe0c32,level:_0x494ebc,isle:_0x3d0f6d,pallet:_0x309f69,stock:_0x407760,types:_0x33f772,adjust_qty:_0xb1ccc2,new_adjust_qty:_0x4a5641,note:_0x2956d5,Room_name:_0x1e0cc1,invoice:_0x5de2e4,JO_number:_0x1d08e4}=_0x4779f9[_0x1012ce(0x218)];if(typeof _0xe0c32=='string')var _0x2027f2=[_0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x24c)]],_0x120f7b=[_0x4779f9['body'][_0x1012ce(0x23f)]],_0xad3dc4=[_0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x207)]],_0x1cd782=[_0x4779f9['body'][_0x1012ce(0x247)]],_0x37c62b=[_0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x238)]],_0x255a05=[_0x4779f9['body'][_0x1012ce(0x260)]],_0x11a221=[_0x4779f9[_0x1012ce(0x218)]['prod_code']],_0x2d08e6=[_0x4779f9[_0x1012ce(0x218)]['unit']],_0x44605d=[_0x4779f9['body'][_0x1012ce(0x1da)]],_0x5663d5=[_0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x1df)]],_0x4257c2=[_0x4779f9['body'][_0x1012ce(0x25b)]];else var _0x2027f2=[..._0x4779f9['body'][_0x1012ce(0x24c)]],_0x120f7b=[..._0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x23f)]],_0xad3dc4=[..._0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x207)]],_0x1cd782=[..._0x4779f9[_0x1012ce(0x218)]['types']],_0x37c62b=[..._0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x238)]],_0x255a05=[..._0x4779f9[_0x1012ce(0x218)]['new_adjust_qty']],_0x11a221=[..._0x4779f9['body'][_0x1012ce(0x205)]],_0x2d08e6=[..._0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x206)]],_0x44605d=[..._0x4779f9[_0x1012ce(0x218)][_0x1012ce(0x1da)]],_0x5663d5=[..._0x4779f9[_0x1012ce(0x218)]['batch_code']],_0x4257c2=[..._0x4779f9[_0x1012ce(0x218)]['expiry_date']];const _0x5b57e3=_0x2027f2[_0x1012ce(0x26c)](_0x4d0ef9=>{return _0x4d0ef9={'product_name':_0x4d0ef9};});_0x120f7b[_0x1012ce(0x27e)]((_0xf582c8,_0x4179f5)=>{_0x5b57e3[_0x4179f5]['bay']=_0xf582c8;}),_0xad3dc4[_0x1012ce(0x27e)]((_0x4079cd,_0x24c58e)=>{var _0x5587a7=_0x1012ce;_0x5b57e3[_0x24c58e][_0x5587a7(0x226)]=_0x4079cd;}),_0x1cd782[_0x1012ce(0x27e)]((_0x1bc90f,_0x385f64)=>{var _0x48a02d=_0x1012ce;_0x5b57e3[_0x385f64][_0x48a02d(0x247)]=_0x1bc90f;}),_0x37c62b[_0x1012ce(0x27e)]((_0x50d06f,_0x29aeb7)=>{var _0x3ed24b=_0x1012ce;_0x5b57e3[_0x29aeb7][_0x3ed24b(0x238)]=_0x50d06f;}),_0x255a05[_0x1012ce(0x27e)]((_0x432bc9,_0x405333)=>{var _0x1ca833=_0x1012ce;_0x5b57e3[_0x405333][_0x1ca833(0x260)]=_0x432bc9;}),_0x2d08e6[_0x1012ce(0x27e)]((_0x4a3e0f,_0x47f53a)=>{var _0x274fab=_0x1012ce;_0x5b57e3[_0x47f53a][_0x274fab(0x206)]=_0x4a3e0f;}),_0x44605d[_0x1012ce(0x27e)]((_0x3f3612,_0x36d424)=>{_0x5b57e3[_0x36d424]['secondary_unit']=_0x3f3612;}),_0x11a221[_0x1012ce(0x27e)]((_0x5c3402,_0x590a7d)=>{_0x5b57e3[_0x590a7d]['product_code']=_0x5c3402;}),_0x5663d5[_0x1012ce(0x27e)]((_0x388652,_0x490115)=>{_0x5b57e3[_0x490115]['batch_code']=_0x388652;}),_0x4257c2[_0x1012ce(0x27e)]((_0x2d0bb6,_0x5d6951)=>{var _0x5695e3=_0x1012ce;_0x5b57e3[_0x5d6951][_0x5695e3(0x25b)]=_0x2d0bb6;});const _0x21911c=_0x5b57e3[_0x1012ce(0x245)](_0x102476=>_0x102476[_0x1012ce(0x238)]!=='0'&&_0x102476[_0x1012ce(0x238)]!=='');var _0xcddd2b=0x0;_0x21911c[_0x1012ce(0x27e)](_0x42591b=>{var _0xcdab2e=_0x1012ce;console[_0xcdab2e(0x27b)]('foreach\x20newproduct',_0x42591b),parseInt(_0x42591b[_0xcdab2e(0x238)])<=0x0&&_0xcddd2b++;});if(_0xcddd2b!=0x0)return _0x4779f9[_0x1012ce(0x219)]('errors',_0x1012ce(0x275)),_0x120aaa['redirect'](_0x1012ce(0x285));_0x2b9d6d['warehouse_name']=_0x50cab7,_0x2b9d6d['date']=_0x31acb0,_0x2b9d6d['product']=_0x21911c,_0x2b9d6d[_0x1012ce(0x1de)]=_0x2956d5,_0x2b9d6d['room']=_0x1e0cc1,_0x2b9d6d[_0x1012ce(0x201)]=_0x5de2e4,_0x2b9d6d[_0x1012ce(0x231)]=_0x1d08e4;const _0x5543a5=await _0x2b9d6d[_0x1012ce(0x20c)](),_0x50fe6c=await warehouse[_0x1012ce(0x241)]({'name':_0x50cab7,'room':_0x1e0cc1});_0x5543a5[_0x1012ce(0x253)][_0x1012ce(0x27e)](_0x181333=>{var _0x4d6f12=_0x1012ce;const _0x1e34d7=_0x50fe6c[_0x4d6f12(0x221)]['map'](_0x52ab18=>{var _0x1f2dd0=_0x4d6f12;_0x181333[_0x1f2dd0(0x247)]=='minus'?_0x52ab18[_0x1f2dd0(0x258)]==_0x181333[_0x1f2dd0(0x258)]&&_0x52ab18[_0x1f2dd0(0x213)]==_0x181333[_0x1f2dd0(0x213)]&&(_0x52ab18[_0x1f2dd0(0x227)]=parseInt(_0x52ab18[_0x1f2dd0(0x227)])-parseInt(_0x181333['adjust_qty'])):_0x52ab18[_0x1f2dd0(0x258)]==_0x181333[_0x1f2dd0(0x258)]&&_0x52ab18['bay']==_0x181333['bay']&&(_0x52ab18['product_stock']=parseInt(_0x52ab18[_0x1f2dd0(0x227)])+parseInt(_0x181333[_0x1f2dd0(0x238)]));});}),await _0x50fe6c['save'](),_0x4779f9[_0x1012ce(0x219)](_0x1012ce(0x1d7),_0x1012ce(0x27c)),_0x120aaa[_0x1012ce(0x222)](_0x1012ce(0x246));}catch(_0x189625){console[_0x1012ce(0x27b)](_0x189625);}}),router[a0_0x31613e(0x209)](a0_0x31613e(0x24d),async(_0x44c956,_0x35c2b6)=>{var _0x2b831f=a0_0x31613e;const {primary_code:_0x22b9d,warehouse_data:_0x23adb1,rooms_data:_0x1f7aa3,Roomslist:_0x370a09}=_0x44c956['body'],_0x2c1597=_0x370a09[_0x2b831f(0x1dc)](','),_0x5a609f=[];async function _0x5c591(_0x573c2e){var _0x3bf00c=_0x2b831f;const _0x4e08fd=await warehouse[_0x3bf00c(0x1fd)]([{'$match':{'name':_0x23adb1,'room':_0x573c2e}},{'$unwind':_0x3bf00c(0x26a)},{'$match':{'product_details.primary_code':_0x22b9d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3bf00c(0x281)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3bf00c(0x1d6)},'product_code':{'$first':_0x3bf00c(0x242)},'level':{'$first':_0x3bf00c(0x1f0)},'bay':{'$first':_0x3bf00c(0x250)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3bf00c(0x214)},'secondary_unit':{'$first':_0x3bf00c(0x1fc)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3bf00c(0x1ef)},'expiry_date':{'$first':_0x3bf00c(0x1e1)},'production_date':{'$first':_0x3bf00c(0x265)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x3bf00c(0x200)},'invoice':{'$first':_0x3bf00c(0x1e3)}}}]),_0x31f688=await warehouse['aggregate']([{'$match':{'name':_0x23adb1,'room':_0x573c2e}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x22b9d}},{'$group':{'_id':_0x3bf00c(0x1ec),'name':{'$first':_0x3bf00c(0x281)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3bf00c(0x21f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3bf00c(0x242)},'level':{'$first':_0x3bf00c(0x1f0)},'bay':{'$first':_0x3bf00c(0x250)},'type':{'$first':_0x3bf00c(0x270)},'pallet':{'$first':_0x3bf00c(0x27d)},'unit':{'$first':_0x3bf00c(0x214)},'secondary_unit':{'$first':_0x3bf00c(0x1fc)},'storage':{'$first':_0x3bf00c(0x220)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3bf00c(0x1e1)},'production_date':{'$first':_0x3bf00c(0x265)},'batch_code':{'$first':_0x3bf00c(0x229)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x3bf00c(0x23d)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x4e08fd[_0x3bf00c(0x25f)]>0x0)_0x5a609f[_0x3bf00c(0x264)](_0x4e08fd);else _0x31f688['length']>0x0&&_0x5a609f[_0x3bf00c(0x264)](_0x31f688);}const _0x2f97ed=_0x2c1597[_0x2b831f(0x26c)](_0x382f5f=>_0x5c591(_0x382f5f));await Promise['all'](_0x2f97ed),_0x35c2b6[_0x2b831f(0x280)](_0x5a609f);}),router[a0_0x31613e(0x209)](a0_0x31613e(0x237),async(_0x5ba509,_0x4c6195)=>{var _0xd9d557=a0_0x31613e;const {productCode:_0x41248a,bay:_0x336873,warehouses:_0x1e6da3,room:_0x50828c}=_0x5ba509[_0xd9d557(0x218)];console['log'](_0x5ba509['body']);try{const _0x142899=await warehouse[_0xd9d557(0x1fd)]([{'$match':{'name':_0x1e6da3,'room':_0x50828c}},{'$unwind':_0xd9d557(0x26a)},{'$match':{'product_details.bay':parseInt(_0x336873)}},{'$group':{'_id':_0xd9d557(0x1ec),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xd9d557(0x26e)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0xd9d557(0x23c)}}}]);_0x4c6195[_0xd9d557(0x21a)](0xc8)[_0xd9d557(0x280)](_0x142899);}catch(_0x260a04){_0x4c6195[_0xd9d557(0x21a)](0x194)[_0xd9d557(0x280)]({'message':_0x260a04['message']});}}),module[a0_0x31613e(0x248)]=router;function a0_0x2837(){var _0x42de10=['/adjustment/view','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product.room_names','There\x27s\x20a\x20error\x20in\x20this\x20transaction','7zWsVoC','ADJF-','../models/all_models','log','adjustment\x20data\x20update\x20successfully','$product_details.floorlevel','forEach','secondary_unit','json','$product_details.product_name','../public/language/languages.json','/adjustment_finished/preview/','product_date','back','$warehouse_name','id_transaction','1306686ckrFcs','product_code','staff','$product_details.secondary_code','success','get','padStart','Secondary_units','$invoice','split','nodemailer','note','batch_code','/view','$product_details.expiry_date','/view_logs','$product_details.invoice','id_transaction_from','logs','LOG-ADJ-','message','DRY\x20GOODS','An\x20error\x20occurred\x20while\x20saving\x20data.','edit_adjustment_finished','3870648cwrdbr','$product_details._id','759740dbkwpn','Ambient','$product_details.rack','$product_details.level','404PvlMPT','all','$product','New_Qty_Converted','floor','Adjustment\x20Finalize\x20Successfully','find','adjustment_finished','render','findById','own','$product_details.secondary_unit','aggregate','English','maxPerUnit','$room','invoice','<tr>','Rooms','Portuguese','prod_code','unit','stock','Arabic','post','finalize','user','save','Primary_Units','email','foreach\x20newproduct','$_id','room','Hindi','bay','$product_details.unit','/view/add_adjustment_logs','_id','/preview/:id','body','flash','status','toString','prod_invoice','errors','express','$product_details.primary_code','$product_details.storage','product_details','redirect','$date','warehouse','/view/:id','stockBefore','product_stock','then','$product_details.batch_code','New_Qty_Converted_adj','Return\x20Rooms','Arabic\x20(ae)','Enabled','catch','</td>','Enclosed','JO_number','error','Spanish','101869FhPuFr','/picking_list/PDF_adjustmentFinal/','An\x20error\x20occurred.','/CheckingWarehouse','adjust_qty','language','add_adjustment_finished_logs','../middleware/auth','$product_details.maxProducts','$product_details.maxPerUnit','English\x20(US)','level','role','findOne','$product_details.product_code','ADJ-','prod_cat','filter','/adjustment_finished/view','types','exports','Chinese','German','production_date','prod_name','/barcode_scanner','$finalize','warehouse_name','$product_details.bay','room_names','$product_details.bin','product','string','1592744kLsUPY','True','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_name','master','French','expiry_date','getMonth','8193kmddwX','add','length','new_adjust_qty','params','Portuguese\x20(BR)','/view/add_adjustment','push','$product_details.production_date','slice','match','$product.product_name','purchases_data','$product_details','edit_adjustment_finished_view','map','502858NncMfF','$product_details.product_stock','adjustment\x20add\x20successfull','$product_details.type','invoice_init','</tr>','$name'];a0_0x2837=function(){return _0x42de10;};return a0_0x2837();}