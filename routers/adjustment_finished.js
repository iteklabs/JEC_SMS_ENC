var a0_0x1fc31c=a0_0x73b9;(function(_0x27d455,_0x1d9f3d){var _0x35a635=a0_0x73b9,_0x4a87cc=_0x27d455();while(!![]){try{var _0x12e7fb=parseInt(_0x35a635(0x1cb))/0x1+-parseInt(_0x35a635(0x1d6))/0x2*(-parseInt(_0x35a635(0x236))/0x3)+-parseInt(_0x35a635(0x19b))/0x4+-parseInt(_0x35a635(0x1cc))/0x5*(-parseInt(_0x35a635(0x21b))/0x6)+parseInt(_0x35a635(0x184))/0x7*(-parseInt(_0x35a635(0x22c))/0x8)+-parseInt(_0x35a635(0x1c0))/0x9+-parseInt(_0x35a635(0x1e6))/0xa*(-parseInt(_0x35a635(0x1a2))/0xb);if(_0x12e7fb===_0x1d9f3d)break;else _0x4a87cc['push'](_0x4a87cc['shift']());}catch(_0x552531){_0x4a87cc['push'](_0x4a87cc['shift']());}}}(a0_0x1561,0x43986));function a0_0x73b9(_0x2096e8,_0x41e632){var _0x15619a=a0_0x1561();return a0_0x73b9=function(_0x73b9d8,_0x20f8d9){_0x73b9d8=_0x73b9d8-0x184;var _0x617ab7=_0x15619a[_0x73b9d8];return _0x617ab7;},a0_0x73b9(_0x2096e8,_0x41e632);}const express=require(a0_0x1fc31c(0x191)),app=express(),router=express['Router'](),auth=require(a0_0x1fc31c(0x227)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x1fc31c(0x1e8)),users=require(a0_0x1fc31c(0x1f1)),nodemailer=require(a0_0x1fc31c(0x20d));function a0_0x1561(){var _0x49fadc=['date','filter','$room','$product_details.invoice','prod_code','prod_name','batch_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Rooms','/view/add_adjustment','add','express','aggregate','status','product_code','bay','/barcode_scanner','/view/add_adjustment_logs','<tr>','/view/:id','$product_details.type','2019488XImyJw','role','back','Arabic\x20(ae)','find','add_adjustment_finished_logs','purchases_data','985765wqLwYE','$product_details.product_name','level','slice','/CheckingWarehouse','$product.product_name','Secondary_units','email','all','errors','Spanish','ADJF-','invoice','$product_details.level','Primary_Units','message','$product_details.bay','then','log','user','product_details','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details','prod_invoice','ADJ-','stock','adjustment_finished','English\x20(US)','catch','LOG-ADJ-','3471012kqFBVI','English','prod_cat','German','post','string','Adjustment\x20Finalize\x20Successfully','An\x20error\x20occurred\x20while\x20saving\x20data.','Enabled','$product_details.unit','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','175499uHefFR','413225ucbBPu','padStart','$product_details.floorlevel','add_adjustment_finished','</td>','$product_details.storage','DRY\x20GOODS','match','finalize','Portuguese','2090dcFcFi','/preview/:id','Return\x20Rooms','$product.room_names','product_stock','$product_details.maxProducts','Chinese','$warehouse_name','room','master','foreach\x20newproduct','success','$_id','Arabic','params','/picking_list/PDF_adjustmentFinal/','50WaYVez','save','../models/all_models','random','json','product','invoice_init','_id','Ambient','$product_details.product_code','adjustment\x20data\x20update\x20successfully','../public/language/languages.json','forEach','new_adjust_qty','An\x20error\x20occurred.','split','warehouse','stockBefore','get','$product_details.secondary_unit','/view','minus','warehouse_name','findOne','body','/view_logs','$product_details.production_date','Portuguese\x20(BR)','French','$product','Hindi','product_name','flash','maxPerUnit','$product_details.secondary_code','error','room_names','$product_details.product_stock','secondary_unit','nodemailer','staff','push','$product_details.bin','render','$name','$invoice','expiry_date','$product_details.batch_code','adjustment_finished_logs','map','product_date','$product_details.rack','adjust_qty','30ipqBRM','exports','New_Qty_Converted_adj','edit_adjustment_finished_view','length','Enclosed','$product_details.maxPerUnit','types','True','/adjustment/view','$finalize','language','../middleware/auth','$product_details.primary_code','</tr>','$product_details.expiry_date','own','12568PPSNaY','unit','id_transaction','note','$product_details._id','/adjustment_finished/preview/','redirect','New_Qty_Converted','findById','toString','393qJkkqr','id_transaction_from','adjustment\x20add\x20successfull','28NeCvkc','JO_number'];a0_0x1561=function(){return _0x49fadc;};return a0_0x1561();}router[a0_0x1fc31c(0x1f8)](a0_0x1fc31c(0x1fa),auth,async(_0x5e55dc,_0x5bdc45)=>{var _0x310f1b=a0_0x1fc31c;try{const {username:_0x10c8f0,email:_0x11e07e,role:_0x1b87de}=_0x5e55dc['user'],_0x971213=_0x5e55dc[_0x310f1b(0x1b5)],_0xf5d573=await profile[_0x310f1b(0x1fd)]({'email':_0x971213[_0x310f1b(0x1a9)]}),_0x5eb44f=await master_shop[_0x310f1b(0x19f)]();let _0x3a010e;if(_0x971213[_0x310f1b(0x19c)]==_0x310f1b(0x20e)){const _0x4f223d=await staff[_0x310f1b(0x1fd)]({'email':_0x971213['email']});_0x3a010e=await warehouse['find']({'status':_0x310f1b(0x1c8),'name':_0x4f223d[_0x310f1b(0x1f6)]});}else _0x3a010e=await warehouse['find']({'status':_0x310f1b(0x1c8)});const _0x67f637=await product[_0x310f1b(0x19f)]();let _0x51330c;if(_0x971213[_0x310f1b(0x19c)]==_0x310f1b(0x20e)){const _0x49aac1=await staff[_0x310f1b(0x1fd)]({'email':_0x971213[_0x310f1b(0x1a9)]});_0x51330c=await adjustment_finished[_0x310f1b(0x19f)]({'warehouse_name':_0x49aac1['warehouse']});}else _0x51330c=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x310f1b(0x22b)}},{'$unwind':_0x310f1b(0x203)},{'$group':{'_id':'$_id','invoice':{'$first':_0x310f1b(0x213)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x310f1b(0x1dd)},'room':{'$addToSet':_0x310f1b(0x1d9)},'finalize':{'$first':_0x310f1b(0x225)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5eb44f[0x0]['language']==_0x310f1b(0x1bd)){var _0x2ab379=users['English'];console[_0x310f1b(0x1b4)](_0x2ab379);}else{if(_0x5eb44f[0x0][_0x310f1b(0x226)]==_0x310f1b(0x204))var _0x2ab379=users[_0x310f1b(0x204)];else{if(_0x5eb44f[0x0]['language']==_0x310f1b(0x1c3))var _0x2ab379=users[_0x310f1b(0x1c3)];else{if(_0x5eb44f[0x0][_0x310f1b(0x226)]==_0x310f1b(0x1ac))var _0x2ab379=users['Spanish'];else{if(_0x5eb44f[0x0][_0x310f1b(0x226)]==_0x310f1b(0x202))var _0x2ab379=users[_0x310f1b(0x202)];else{if(_0x5eb44f[0x0][_0x310f1b(0x226)]==_0x310f1b(0x201))var _0x2ab379=users[_0x310f1b(0x1d5)];else{if(_0x5eb44f[0x0][_0x310f1b(0x226)]==_0x310f1b(0x1dc))var _0x2ab379=users[_0x310f1b(0x1dc)];else{if(_0x5eb44f[0x0][_0x310f1b(0x226)]==_0x310f1b(0x19e))var _0x2ab379=users['Arabic'];}}}}}}}_0x5bdc45[_0x310f1b(0x211)](_0x310f1b(0x1bc),{'success':_0x5e55dc[_0x310f1b(0x206)]('success'),'errors':_0x5e55dc[_0x310f1b(0x206)](_0x310f1b(0x1ab)),'role':_0x971213,'profile':_0xf5d573,'warehouse':_0x3a010e,'product':_0x67f637,'adjustment':_0x51330c,'master_shop':_0x5eb44f,'language':_0x2ab379});}catch(_0x447032){console[_0x310f1b(0x1b4)](_0x447032);}}),router[a0_0x1fc31c(0x1f8)](a0_0x1fc31c(0x1ff),auth,async(_0x18d73b,_0xe83626)=>{var _0x39b583=a0_0x1fc31c;try{const {username:_0x4fafbf,email:_0x30473,role:_0xe74696}=_0x18d73b[_0x39b583(0x1b5)],_0x68aa1b=_0x18d73b['user'],_0x1fe70d=await profile[_0x39b583(0x1fd)]({'email':_0x68aa1b['email']}),_0xe17ad5=await master_shop[_0x39b583(0x19f)]();let _0x4a0979;if(_0x68aa1b['role']==_0x39b583(0x20e)){const _0x409df5=await staff[_0x39b583(0x1fd)]({'email':_0x68aa1b[_0x39b583(0x1a9)]});_0x4a0979=await warehouse['find']({'status':_0x39b583(0x1c8),'name':_0x409df5[_0x39b583(0x1f6)]});}else _0x4a0979=await warehouse[_0x39b583(0x19f)]({'status':_0x39b583(0x1c8)});const _0x56849c=await product[_0x39b583(0x19f)]();let _0x1a5e4c;if(_0x68aa1b[_0x39b583(0x19c)]==_0x39b583(0x20e)){const _0x3269e2=await staff[_0x39b583(0x1fd)]({'email':_0x68aa1b[_0x39b583(0x1a9)]});_0x1a5e4c=await adjustment_finished[_0x39b583(0x19f)]({'warehouse_name':_0x3269e2[_0x39b583(0x1f6)]});}else _0x1a5e4c=await adjustment_finished[_0x39b583(0x192)]([{'$match':{'type_of_transaction':'logs'}},{'$unwind':_0x39b583(0x203)},{'$group':{'_id':_0x39b583(0x1e2),'invoice':{'$first':_0x39b583(0x213)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x39b583(0x1dd)},'room':{'$addToSet':_0x39b583(0x1d9)},'finalize':{'$first':_0x39b583(0x225)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xe17ad5[0x0]['language']==_0x39b583(0x1bd))var _0x174ddf=users[_0x39b583(0x1c1)];else{if(_0xe17ad5[0x0]['language']==_0x39b583(0x204))var _0x174ddf=users[_0x39b583(0x204)];else{if(_0xe17ad5[0x0][_0x39b583(0x226)]==_0x39b583(0x1c3))var _0x174ddf=users[_0x39b583(0x1c3)];else{if(_0xe17ad5[0x0]['language']==_0x39b583(0x1ac))var _0x174ddf=users[_0x39b583(0x1ac)];else{if(_0xe17ad5[0x0]['language']==_0x39b583(0x202))var _0x174ddf=users[_0x39b583(0x202)];else{if(_0xe17ad5[0x0]['language']==_0x39b583(0x201))var _0x174ddf=users[_0x39b583(0x1d5)];else{if(_0xe17ad5[0x0]['language']==_0x39b583(0x1dc))var _0x174ddf=users[_0x39b583(0x1dc)];else{if(_0xe17ad5[0x0][_0x39b583(0x226)]=='Arabic\x20(ae)')var _0x174ddf=users[_0x39b583(0x1e3)];}}}}}}}_0xe83626[_0x39b583(0x211)](_0x39b583(0x216),{'success':_0x18d73b[_0x39b583(0x206)](_0x39b583(0x1e1)),'errors':_0x18d73b[_0x39b583(0x206)](_0x39b583(0x1ab)),'role':_0x68aa1b,'profile':_0x1fe70d,'warehouse':_0x4a0979,'product':_0x56849c,'adjustment':_0x1a5e4c,'master_shop':_0xe17ad5,'language':_0x174ddf});}catch(_0x5e002b){console[_0x39b583(0x1b4)](_0x5e002b);}});async function getRandom8DigitNumber(){var _0x515d72=a0_0x1fc31c;const _0x585fab=0x989680,_0x408385=0x5f5e0ff,_0x130512=Math['floor'](Math[_0x515d72(0x1e9)]()*(_0x408385-_0x585fab+0x1))+_0x585fab;var _0x547b48;const _0x32c8f3=await adjustment_finished[_0x515d72(0x1fd)]({'invoice':'ADJF-'+_0x130512});return _0x32c8f3&&_0x32c8f3[_0x515d72(0x21f)]>0x0?_0x547b48=_0x515d72(0x1ad)+_0x130512:_0x547b48=_0x515d72(0x1ad)+_0x130512,_0x547b48;}router['get'](a0_0x1fc31c(0x18f),auth,async(_0x3d163f,_0x14aa4c)=>{var _0x56afb7=a0_0x1fc31c;try{const {username:_0x2c8bf5,email:_0x41bc3b,role:_0x45ba6a}=_0x3d163f[_0x56afb7(0x1b5)],_0x2a4250=_0x3d163f[_0x56afb7(0x1b5)],_0x4c7928=await profile['findOne']({'email':_0x2a4250['email']}),_0x511630=await master_shop[_0x56afb7(0x19f)]();let _0x20c466;if(_0x2a4250['role']==_0x56afb7(0x20e)){const _0x4bf286=await staff[_0x56afb7(0x1fd)]({'email':_0x2a4250[_0x56afb7(0x1a9)]});_0x20c466=await warehouse[_0x56afb7(0x192)]([{'$match':{'status':'Enabled','name':_0x4bf286[_0x56afb7(0x1f6)]}},{'$group':{'_id':_0x56afb7(0x212),'name':{'$first':_0x56afb7(0x212)}}}]);}else _0x20c466=await warehouse['aggregate']([{'$match':{'status':_0x56afb7(0x1c8)}},{'$group':{'_id':_0x56afb7(0x212),'name':{'$first':_0x56afb7(0x212)}}}]);const _0x2b816a=await product[_0x56afb7(0x19f)]({}),_0x596870=await adjustment_finished['find'](),_0x35bcae=_0x596870[_0x56afb7(0x21f)]+0x1,_0x146cf6=_0x56afb7(0x1ad)+_0x35bcae['toString']()[_0x56afb7(0x1cd)](0x5,'0');var _0x3e53fd=[_0x56afb7(0x1ee),_0x56afb7(0x220),_0x56afb7(0x1d8)];if(_0x511630[0x0]['language']==_0x56afb7(0x1bd))var _0x4d7a9b=users[_0x56afb7(0x1c1)];else{if(_0x511630[0x0][_0x56afb7(0x226)]==_0x56afb7(0x204))var _0x4d7a9b=users['Hindi'];else{if(_0x511630[0x0][_0x56afb7(0x226)]==_0x56afb7(0x1c3))var _0x4d7a9b=users['German'];else{if(_0x511630[0x0][_0x56afb7(0x226)]=='Spanish')var _0x4d7a9b=users[_0x56afb7(0x1ac)];else{if(_0x511630[0x0][_0x56afb7(0x226)]==_0x56afb7(0x202))var _0x4d7a9b=users[_0x56afb7(0x202)];else{if(_0x511630[0x0][_0x56afb7(0x226)]=='Portuguese\x20(BR)')var _0x4d7a9b=users[_0x56afb7(0x1d5)];else{if(_0x511630[0x0][_0x56afb7(0x226)]==_0x56afb7(0x1dc))var _0x4d7a9b=users[_0x56afb7(0x1dc)];else{if(_0x511630[0x0][_0x56afb7(0x226)]==_0x56afb7(0x19e))var _0x4d7a9b=users['Arabic'];}}}}}}}const _0x1418e2=getRandom8DigitNumber();_0x1418e2[_0x56afb7(0x1b3)](_0x5ded1c=>{var _0x6b8eae=_0x56afb7;_0x14aa4c['render'](_0x6b8eae(0x1cf),{'success':_0x3d163f[_0x6b8eae(0x206)](_0x6b8eae(0x1e1)),'errors':_0x3d163f[_0x6b8eae(0x206)](_0x6b8eae(0x1ab)),'role':_0x2a4250,'profile':_0x4c7928,'warehouse':_0x20c466,'product':_0x2b816a,'master_shop':_0x511630,'language':_0x4d7a9b,'rooms_data':_0x3e53fd,'invoice_no':_0x5ded1c});})[_0x56afb7(0x1be)](_0x28f965=>{var _0x6a3756=_0x56afb7;_0x3d163f[_0x6a3756(0x206)](_0x6a3756(0x1ab),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x14aa4c[_0x6a3756(0x232)](_0x6a3756(0x224));});}catch(_0x19ff35){console[_0x56afb7(0x1b4)](_0x19ff35);}}),router['post'](a0_0x1fc31c(0x18f),auth,async(_0x174cd8,_0x2a3c96)=>{var _0x557cdc=a0_0x1fc31c;try{const {warehouse_name:_0x4bd440,date:_0x15ce63,prod_name:_0x280aa4,level:_0x281975,isle:_0x462639,pallet:_0x1fabfd,stock:_0x21acb1,types:_0x550c8f,adjust_qty:_0x575225,new_adjust_qty:_0x51aaed,note:_0x1e3db6,Room_name:_0x5ca9aa,JO_number:_0xe4216,expiry_date:_0x2672e2,PO_number:_0x5a70b9,ReqBy:_0x458a5f,dateofreq:_0x2062ee,typeservicesData:_0x4b7146,destination:_0x1316e7,deliverydate:_0x5520f4,driver:_0x13a29f,plate:_0x5cef8f,van:_0x12b0ce,DRSI:_0x3eef60,typevehicle:_0x362840,TSU:_0x30ff03,TFU:_0x5df8b7}=_0x174cd8['body'];if(typeof _0x280aa4==_0x557cdc(0x1c5))var _0x30f21d=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x18b)]],_0x4c30d1=[_0x174cd8['body'][_0x557cdc(0x1a4)]],_0x56b768=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1bb)]],_0x581902=[_0x174cd8['body']['types']],_0x13b39e=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x21d)]],_0x1312b3=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x233)]],_0x38465d=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1b0)]],_0x1c4589=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1a8)]],_0xe74a8=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x18a)]],_0x39ef7c=[_0x174cd8[_0x557cdc(0x1fe)]['batch_code']],_0x360651=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x214)]],_0xc0326d=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x218)]],_0x4e54a9=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1c2)]],_0x471099=[_0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x18e)]],_0x59e44b=[_0x174cd8[_0x557cdc(0x1fe)]['maxPerUnit']],_0x43866b=[_0x174cd8['body']['prod_invoice']],_0x12e89d=[_0x174cd8[_0x557cdc(0x1fe)]['id_transaction_from']];else var _0x30f21d=[..._0x174cd8['body'][_0x557cdc(0x18b)]],_0x4c30d1=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1a4)]],_0x56b768=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1bb)]],_0x581902=[..._0x174cd8['body']['types']],_0x13b39e=[..._0x174cd8['body'][_0x557cdc(0x21d)]],_0x1312b3=[..._0x174cd8[_0x557cdc(0x1fe)]['New_Qty_Converted']],_0x38465d=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1b0)]],_0x1c4589=[..._0x174cd8['body']['Secondary_units']],_0xe74a8=[..._0x174cd8[_0x557cdc(0x1fe)]['prod_code']],_0x39ef7c=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x18c)]],_0x360651=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x214)]],_0xc0326d=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x218)]],_0x4e54a9=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x1c2)]],_0x471099=[..._0x174cd8[_0x557cdc(0x1fe)]['Rooms']],_0x59e44b=[..._0x174cd8['body'][_0x557cdc(0x207)]],_0x43866b=[..._0x174cd8['body']['prod_invoice']],_0x12e89d=[..._0x174cd8[_0x557cdc(0x1fe)][_0x557cdc(0x237)]];const _0x2bafb9=_0x30f21d['map'](_0x4e752e=>{return _0x4e752e={'product_name':_0x4e752e};});_0x4c30d1[_0x557cdc(0x1f2)]((_0x2b93d3,_0x3665b6)=>{var _0x1d76d1=_0x557cdc,_0x2bd5bc=_0x2b93d3[_0x1d76d1(0x1d3)](/[A-Za-z]+/)[0x0],_0x285962=parseInt(_0x2b93d3[_0x1d76d1(0x1d3)](/\d+/)[0x0]);_0x2bafb9[_0x3665b6]['level']=_0x2bd5bc,_0x2bafb9[_0x3665b6][_0x1d76d1(0x195)]=_0x285962;}),_0x12e89d[_0x557cdc(0x1f2)]((_0xd85251,_0x2fdfff)=>{var _0x2a16e9=_0x557cdc;_0x2bafb9[_0x2fdfff][_0x2a16e9(0x22e)]=_0xd85251;}),_0x56b768[_0x557cdc(0x1f2)]((_0x2b8f4a,_0x49d511)=>{var _0x25328a=_0x557cdc;_0x2bafb9[_0x49d511][_0x25328a(0x1f7)]=_0x2b8f4a;}),_0x581902[_0x557cdc(0x1f2)]((_0x49377b,_0xad40bb)=>{var _0xaf4f9=_0x557cdc;_0x2bafb9[_0xad40bb][_0xaf4f9(0x222)]=_0x49377b;}),_0x13b39e[_0x557cdc(0x1f2)]((_0x2e9fcd,_0x22f3d2)=>{var _0x417b72=_0x557cdc;_0x2bafb9[_0x22f3d2][_0x417b72(0x21a)]=_0x2e9fcd;}),_0x1312b3[_0x557cdc(0x1f2)]((_0x293d6d,_0x36c85a)=>{_0x2bafb9[_0x36c85a]['new_adjust_qty']=_0x293d6d;}),_0x38465d[_0x557cdc(0x1f2)]((_0xb63e63,_0x43a496)=>{var _0x17b24b=_0x557cdc;_0x2bafb9[_0x43a496][_0x17b24b(0x22d)]=_0xb63e63;}),_0x1c4589[_0x557cdc(0x1f2)]((_0xa139bf,_0x440d37)=>{_0x2bafb9[_0x440d37]['secondary_unit']=_0xa139bf;}),_0xe74a8['forEach']((_0x5eaa02,_0x4e6d82)=>{var _0x844620=_0x557cdc;_0x2bafb9[_0x4e6d82][_0x844620(0x194)]=_0x5eaa02;}),_0x39ef7c[_0x557cdc(0x1f2)]((_0xb4d74f,_0x28c125)=>{_0x2bafb9[_0x28c125]['batch_code']=_0xb4d74f;}),_0x360651[_0x557cdc(0x1f2)]((_0x1ae2ca,_0x12c357)=>{_0x2bafb9[_0x12c357]['expiry_date']=_0x1ae2ca;}),_0xc0326d[_0x557cdc(0x1f2)]((_0x1d9bdc,_0x55b7e3)=>{_0x2bafb9[_0x55b7e3]['production_date']=_0x1d9bdc;}),_0x4e54a9['forEach']((_0x25c78e,_0x24afa5)=>{var _0x307c14=_0x557cdc;_0x2bafb9[_0x24afa5][_0x307c14(0x1c2)]=_0x25c78e;}),_0x471099['forEach']((_0xf540a4,_0x54acf2)=>{var _0x21efef=_0x557cdc;_0x2bafb9[_0x54acf2][_0x21efef(0x20a)]=_0xf540a4;}),_0x59e44b[_0x557cdc(0x1f2)]((_0x4e5dbf,_0x484efb)=>{var _0x3c7fff=_0x557cdc;_0x2bafb9[_0x484efb][_0x3c7fff(0x207)]=_0x4e5dbf;}),_0x43866b[_0x557cdc(0x1f2)]((_0x2b7cc8,_0x31eeee)=>{var _0x52b363=_0x557cdc;_0x2bafb9[_0x31eeee][_0x52b363(0x1ae)]=_0x2b7cc8;});const _0x1171af=_0x2bafb9['filter'](_0xe74cca=>_0xe74cca[_0x557cdc(0x21a)]!=='0'&&_0xe74cca[_0x557cdc(0x21a)]!=='');var _0x128a12=0x0;_0x1171af[_0x557cdc(0x1f2)](_0x2d1c5c=>{var _0x364ea8=_0x557cdc;console[_0x364ea8(0x1b4)]('foreach\x20newproduct',_0x2d1c5c),parseInt(_0x2d1c5c[_0x364ea8(0x21a)])<=0x0&&_0x128a12++;});if(_0x128a12!=0x0)return _0x174cd8[_0x557cdc(0x206)](_0x557cdc(0x1ab),_0x557cdc(0x1ca)),_0x2a3c96['redirect'](_0x557cdc(0x19d));const _0x32a8bd=new invoice_for_adjustment();await _0x32a8bd[_0x557cdc(0x1e7)]();const _0x13debd=new adjustment_finished({'warehouse_name':_0x4bd440,'date':_0x15ce63,'product':_0x1171af,'note':_0x1e3db6,'room':_0x5ca9aa,'invoice':_0x557cdc(0x1ba)+_0x32a8bd[_0x557cdc(0x1ec)][_0x557cdc(0x235)]()[_0x557cdc(0x1cd)](0x8,'0'),'JO_number':_0xe4216,'expiry_date':_0x2672e2,'PO_number':_0x5a70b9,'RequestedBy':_0x458a5f,'DateofRequest':_0x2062ee,'typeservices':_0x4b7146,'destination':_0x1316e7,'deliverydate':_0x5520f4,'driver':_0x13a29f,'plate':_0x5cef8f,'van':_0x12b0ce,'DRSI':_0x3eef60,'typevehicle':_0x362840,'TSU':_0x30ff03,'TFU':_0x5df8b7}),_0x4fc0b0=await _0x13debd[_0x557cdc(0x1e7)]();_0x174cd8[_0x557cdc(0x206)](_0x557cdc(0x1e1),_0x557cdc(0x238)),_0x2a3c96['redirect'](_0x557cdc(0x231)+_0x4fc0b0['_id']);}catch(_0xe966c7){console['log'](_0xe966c7),_0x2a3c96[_0x557cdc(0x193)](0xc8)['json']({'message':_0xe966c7[_0x557cdc(0x1b1)]});}}),router[a0_0x1fc31c(0x1f8)](a0_0x1fc31c(0x197),auth,async(_0x2ba989,_0x4f5694)=>{var _0x38c262=a0_0x1fc31c;try{const {username:_0x41061e,email:_0x4f964d,role:_0x36c885}=_0x2ba989[_0x38c262(0x1b5)],_0x87a316=_0x2ba989[_0x38c262(0x1b5)],_0x2d4577=await profile[_0x38c262(0x1fd)]({'email':_0x87a316['email']}),_0x48f480=await master_shop[_0x38c262(0x19f)]();let _0x4dc4d6;if(_0x87a316['role']==_0x38c262(0x20e)){const _0x44b01c=await staff[_0x38c262(0x1fd)]({'email':_0x87a316[_0x38c262(0x1a9)]});_0x4dc4d6=await warehouse[_0x38c262(0x192)]([{'$match':{'status':_0x38c262(0x1c8),'name':_0x44b01c[_0x38c262(0x1f6)]}},{'$group':{'_id':_0x38c262(0x212),'name':{'$first':_0x38c262(0x212)}}}]);}else _0x4dc4d6=await warehouse[_0x38c262(0x192)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x38c262(0x212),'name':{'$first':_0x38c262(0x212)}}}]);const _0x2d1b91=await product[_0x38c262(0x19f)](),_0xfd0864=await adjustment_finished[_0x38c262(0x19f)](),_0xd138d5=_0xfd0864[_0x38c262(0x21f)]+0x1,_0x256ee8='ADJF-'+_0xd138d5['toString']()[_0x38c262(0x1cd)](0x5,'0');var _0x28c144=['Ambient',_0x38c262(0x220),'Return\x20Rooms'];if(_0x48f480[0x0][_0x38c262(0x226)]==_0x38c262(0x1bd))var _0x2c1842=users[_0x38c262(0x1c1)];else{if(_0x48f480[0x0]['language']==_0x38c262(0x204))var _0x2c1842=users[_0x38c262(0x204)];else{if(_0x48f480[0x0][_0x38c262(0x226)]==_0x38c262(0x1c3))var _0x2c1842=users['German'];else{if(_0x48f480[0x0][_0x38c262(0x226)]==_0x38c262(0x1ac))var _0x2c1842=users[_0x38c262(0x1ac)];else{if(_0x48f480[0x0][_0x38c262(0x226)]==_0x38c262(0x202))var _0x2c1842=users[_0x38c262(0x202)];else{if(_0x48f480[0x0]['language']=='Portuguese\x20(BR)')var _0x2c1842=users[_0x38c262(0x1d5)];else{if(_0x48f480[0x0][_0x38c262(0x226)]==_0x38c262(0x1dc))var _0x2c1842=users[_0x38c262(0x1dc)];else{if(_0x48f480[0x0][_0x38c262(0x226)]==_0x38c262(0x19e))var _0x2c1842=users[_0x38c262(0x1e3)];}}}}}}}const _0x2c9601=getRandom8DigitNumber();_0x2c9601[_0x38c262(0x1b3)](_0x27e203=>{var _0x3722e9=_0x38c262;_0x4f5694[_0x3722e9(0x211)](_0x3722e9(0x1a0),{'success':_0x2ba989[_0x3722e9(0x206)](_0x3722e9(0x1e1)),'errors':_0x2ba989[_0x3722e9(0x206)](_0x3722e9(0x1ab)),'role':_0x87a316,'profile':_0x2d4577,'warehouse':_0x4dc4d6,'product':_0x2d1b91,'master_shop':_0x48f480,'language':_0x2c1842,'rooms_data':_0x28c144,'invoice_no':_0x27e203});})[_0x38c262(0x1be)](_0x4ba94a=>{var _0x4fcde7=_0x38c262;_0x2ba989['flash'](_0x4fcde7(0x1ab),_0x4fcde7(0x18d)),_0x4f5694[_0x4fcde7(0x232)]('/adjustment/view');});}catch(_0x302f93){console['log'](_0x302f93);}}),router['post'](a0_0x1fc31c(0x197),auth,async(_0x203553,_0x2b70e5)=>{var _0x5879bd=a0_0x1fc31c;try{const {warehouse_name:_0x400c29,date:_0x2779f8,prod_name:_0x5f1c26,level:_0x4f32c4,isle:_0x11b600,pallet:_0x4d357a,stock:_0x4e328d,types:_0x149963,adjust_qty:_0x58ab66,new_adjust_qty:_0x254320,note:_0x1a0c0d,Room_name:_0x2c1515,JO_number:_0x2d613f,expiry_date:_0x7f79f1,type_of_transaction:_0x314c42,PO_number:_0x5a4f9a,ReqBy:_0x5d9eed,dateofreq:_0x42e9d9,typeservicesData:_0x1c82f4,destination:_0x33f683,deliverydate:_0x10666e,driver:_0x1c6f66,plate:_0x1b1c60,van:_0x43f3a9,DRSI:_0x4a29b5,typevehicle:_0x26ede3,TSU:_0x34a985,TFU:_0x525546}=_0x203553[_0x5879bd(0x1fe)];if(typeof _0x5f1c26==_0x5879bd(0x1c5))var _0x25b5ef=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x18b)]],_0x286e97=[_0x203553[_0x5879bd(0x1fe)]['level']],_0x57d226=[_0x203553[_0x5879bd(0x1fe)]['stock']],_0xbc5dac=[_0x203553[_0x5879bd(0x1fe)]['types']],_0x1e67b6=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x21d)]],_0x19c37e=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x233)]],_0x5fd8cf=[_0x203553['body'][_0x5879bd(0x1b0)]],_0x5372bc=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1a8)]],_0x45c6e7=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x18a)]],_0xc73146=[_0x203553[_0x5879bd(0x1fe)]['batch_code']],_0x193fb7=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x214)]],_0x2376d1=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x218)]],_0x4a536c=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1c2)]],_0x4f9aa4=[_0x203553[_0x5879bd(0x1fe)]['Rooms']],_0x3d1eb4=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x207)]],_0x8cbe93=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1b9)]],_0x9f48b0=[_0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x237)]];else var _0x25b5ef=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x18b)]],_0x286e97=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1a4)]],_0x57d226=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1bb)]],_0xbc5dac=[..._0x203553['body']['types']],_0x1e67b6=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x21d)]],_0x19c37e=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x233)]],_0x5fd8cf=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1b0)]],_0x5372bc=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x1a8)]],_0x45c6e7=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x18a)]],_0xc73146=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x18c)]],_0x193fb7=[..._0x203553['body'][_0x5879bd(0x214)]],_0x2376d1=[..._0x203553[_0x5879bd(0x1fe)][_0x5879bd(0x218)]],_0x4a536c=[..._0x203553[_0x5879bd(0x1fe)]['prod_cat']],_0x4f9aa4=[..._0x203553['body']['Rooms']],_0x3d1eb4=[..._0x203553['body']['maxPerUnit']],_0x8cbe93=[..._0x203553[_0x5879bd(0x1fe)]['prod_invoice']],_0x9f48b0=[..._0x203553['body'][_0x5879bd(0x237)]];const _0x17d5ca=_0x25b5ef[_0x5879bd(0x217)](_0x15e9ba=>{return _0x15e9ba={'product_name':_0x15e9ba};});_0x286e97['forEach']((_0x950f61,_0x675c8f)=>{var _0x604e5=_0x5879bd,_0x212132=_0x950f61['match'](/[A-Za-z]+/)[0x0],_0x32e473=parseInt(_0x950f61[_0x604e5(0x1d3)](/\d+/)[0x0]);_0x17d5ca[_0x675c8f][_0x604e5(0x1a4)]=_0x212132,_0x17d5ca[_0x675c8f][_0x604e5(0x195)]=_0x32e473;}),_0x9f48b0[_0x5879bd(0x1f2)]((_0x372bd8,_0x460c8a)=>{var _0x1a72e3=_0x5879bd;_0x17d5ca[_0x460c8a][_0x1a72e3(0x22e)]=_0x372bd8;}),_0x57d226[_0x5879bd(0x1f2)]((_0x5d8cf9,_0x11eca5)=>{var _0x3a3e1d=_0x5879bd;_0x17d5ca[_0x11eca5][_0x3a3e1d(0x1f7)]=_0x5d8cf9;}),_0xbc5dac[_0x5879bd(0x1f2)]((_0x17d09a,_0x1a1262)=>{_0x17d5ca[_0x1a1262]['types']=_0x17d09a;}),_0x1e67b6['forEach']((_0x4dfb7f,_0x5134a5)=>{var _0x2beb7b=_0x5879bd;_0x17d5ca[_0x5134a5][_0x2beb7b(0x21a)]=_0x4dfb7f;}),_0x19c37e[_0x5879bd(0x1f2)]((_0x3c314d,_0x1d94f1)=>{var _0xc160fc=_0x5879bd;_0x17d5ca[_0x1d94f1][_0xc160fc(0x1f3)]=_0x3c314d;}),_0x5fd8cf[_0x5879bd(0x1f2)]((_0x41247a,_0x54c1b3)=>{var _0x28fe43=_0x5879bd;_0x17d5ca[_0x54c1b3][_0x28fe43(0x22d)]=_0x41247a;}),_0x5372bc[_0x5879bd(0x1f2)]((_0x41be99,_0x3694af)=>{var _0x3fa784=_0x5879bd;_0x17d5ca[_0x3694af][_0x3fa784(0x20c)]=_0x41be99;}),_0x45c6e7[_0x5879bd(0x1f2)]((_0x42f7da,_0x3243ff)=>{_0x17d5ca[_0x3243ff]['product_code']=_0x42f7da;}),_0xc73146[_0x5879bd(0x1f2)]((_0x4ae30d,_0x3e9b20)=>{_0x17d5ca[_0x3e9b20]['batch_code']=_0x4ae30d;}),_0x193fb7[_0x5879bd(0x1f2)]((_0x33b988,_0x58e82e)=>{var _0xfc415b=_0x5879bd;_0x17d5ca[_0x58e82e][_0xfc415b(0x214)]=_0x33b988;}),_0x2376d1[_0x5879bd(0x1f2)]((_0x4a2d97,_0x57aaed)=>{_0x17d5ca[_0x57aaed]['production_date']=_0x4a2d97;}),_0x4a536c[_0x5879bd(0x1f2)]((_0x577b04,_0x7d3f4b)=>{var _0x42fc7c=_0x5879bd;_0x17d5ca[_0x7d3f4b][_0x42fc7c(0x1c2)]=_0x577b04;}),_0x4f9aa4[_0x5879bd(0x1f2)]((_0x423848,_0x517449)=>{_0x17d5ca[_0x517449]['room_names']=_0x423848;}),_0x3d1eb4[_0x5879bd(0x1f2)]((_0x47d6fa,_0x3a64fb)=>{var _0x10e314=_0x5879bd;_0x17d5ca[_0x3a64fb][_0x10e314(0x207)]=_0x47d6fa;}),_0x8cbe93[_0x5879bd(0x1f2)]((_0x1c264a,_0x4dd731)=>{var _0xad2656=_0x5879bd;_0x17d5ca[_0x4dd731][_0xad2656(0x1ae)]=_0x1c264a;});const _0x21ca7a=_0x17d5ca[_0x5879bd(0x187)](_0x1f8ef2=>_0x1f8ef2[_0x5879bd(0x21a)]!=='0'&&_0x1f8ef2[_0x5879bd(0x21a)]!=='');var _0x16b509=0x0;_0x21ca7a[_0x5879bd(0x1f2)](_0x24622f=>{var _0x50e5c7=_0x5879bd;console[_0x50e5c7(0x1b4)]('foreach\x20newproduct',_0x24622f),parseInt(_0x24622f[_0x50e5c7(0x21a)])<=0x0&&_0x16b509++;});if(_0x16b509!=0x0)return _0x203553[_0x5879bd(0x206)](_0x5879bd(0x1ab),_0x5879bd(0x1ca)),_0x2b70e5[_0x5879bd(0x232)]('back');const _0x578903=new adjustment_logs();await _0x578903[_0x5879bd(0x1e7)]();const _0x31b323=new adjustment_finished({'warehouse_name':_0x400c29,'date':_0x2779f8,'product':_0x21ca7a,'note':_0x1a0c0d,'room':_0x2c1515,'invoice':_0x5879bd(0x1bf)+_0x578903[_0x5879bd(0x1ec)]['toString']()[_0x5879bd(0x1cd)](0x8,'0'),'JO_number':_0x2d613f,'expiry_date':_0x7f79f1,'type_of_transaction':_0x314c42,'PO_number':_0x5a4f9a,'RequestedBy':_0x5d9eed,'DateofRequest':_0x42e9d9,'typeservices':_0x1c82f4,'destination':_0x33f683,'deliverydate':_0x10666e,'driver':_0x1c6f66,'plate':_0x1b1c60,'van':_0x43f3a9,'DRSI':_0x4a29b5,'typevehicle':_0x26ede3,'TSU':_0x34a985,'TFU':_0x525546}),_0x2e0d9f=await _0x31b323['save']();_0x203553[_0x5879bd(0x206)](_0x5879bd(0x1e1),'adjustment\x20add\x20successfull'),_0x2b70e5[_0x5879bd(0x232)]('/adjustment_finished/preview/'+_0x2e0d9f[_0x5879bd(0x1ed)]);}catch(_0x3daf2c){console['log'](_0x3daf2c),_0x2b70e5['status'](0xc8)[_0x5879bd(0x1ea)]({'message':_0x3daf2c[_0x5879bd(0x1b1)]});}}),router['get']('/preview/:id',auth,async(_0x5123b2,_0x1edc5d)=>{var _0x4a3d31=a0_0x1fc31c;try{const {username:_0x3cfafb,email:_0x1b7355,role:_0x16a710}=_0x5123b2[_0x4a3d31(0x1b5)],_0x403fe3=_0x5123b2[_0x4a3d31(0x1b5)],_0x16fedf=await profile[_0x4a3d31(0x1fd)]({'email':_0x403fe3[_0x4a3d31(0x1a9)]}),_0x5b001a=await master_shop[_0x4a3d31(0x19f)](),_0x5f0aa3=_0x5123b2['params']['id'],_0x5b8d3c=await adjustment_finished['findById']({'_id':_0x5f0aa3}),_0x53c27d=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5b8d3c[_0x4a3d31(0x1fc)]}},{'$unwind':'$product'},{'$group':{'_id':_0x4a3d31(0x1a7)}}]);console['log'](_0x4a3d31(0x1a1),_0x53c27d);const _0x28037d=await product['find']({}),_0x20d178=await warehouse[_0x4a3d31(0x192)]([{'$match':{'name':_0x5b8d3c['warehouse_name']}},{'$unwind':_0x4a3d31(0x1b8)},{'$group':{'_id':_0x4a3d31(0x230),'name':{'$first':_0x4a3d31(0x1a3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4a3d31(0x19a)},'floorlevel':{'$first':_0x4a3d31(0x1ce)},'primary_code':{'$first':_0x4a3d31(0x228)},'secondary_code':{'$first':_0x4a3d31(0x208)},'product_code':{'$first':_0x4a3d31(0x1ef)},'storage':{'$first':_0x4a3d31(0x1d1)},'rack':{'$first':_0x4a3d31(0x219)},'expiry_date':{'$first':_0x4a3d31(0x22a)},'production_date':{'$first':_0x4a3d31(0x200)},'batch_code':{'$first':_0x4a3d31(0x215)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':'$room'}}}]);if(_0x5b001a[0x0]['language']==_0x4a3d31(0x1bd)){var _0x3bf3a9=users[_0x4a3d31(0x1c1)];console[_0x4a3d31(0x1b4)](_0x3bf3a9);}else{if(_0x5b001a[0x0][_0x4a3d31(0x226)]==_0x4a3d31(0x204))var _0x3bf3a9=users[_0x4a3d31(0x204)];else{if(_0x5b001a[0x0]['language']==_0x4a3d31(0x1c3))var _0x3bf3a9=users[_0x4a3d31(0x1c3)];else{if(_0x5b001a[0x0]['language']==_0x4a3d31(0x1ac))var _0x3bf3a9=users[_0x4a3d31(0x1ac)];else{if(_0x5b001a[0x0]['language']==_0x4a3d31(0x202))var _0x3bf3a9=users[_0x4a3d31(0x202)];else{if(_0x5b001a[0x0][_0x4a3d31(0x226)]=='Portuguese\x20(BR)')var _0x3bf3a9=users[_0x4a3d31(0x1d5)];else{if(_0x5b001a[0x0][_0x4a3d31(0x226)]==_0x4a3d31(0x1dc))var _0x3bf3a9=users[_0x4a3d31(0x1dc)];else{if(_0x5b001a[0x0][_0x4a3d31(0x226)]=='Arabic\x20(ae)')var _0x3bf3a9=users[_0x4a3d31(0x1e3)];}}}}}}}_0x1edc5d[_0x4a3d31(0x211)](_0x4a3d31(0x21e),{'success':_0x5123b2[_0x4a3d31(0x206)](_0x4a3d31(0x1e1)),'errors':_0x5123b2[_0x4a3d31(0x206)]('errors'),'role':_0x403fe3,'profile':_0x16fedf,'adjustment':_0x5b8d3c,'stock':_0x20d178,'master_shop':_0x5b001a,'warehouse_name':_0x53c27d,'unit':_0x28037d,'language':_0x3bf3a9});}catch(_0x2b2568){console['log'](_0x2b2568),_0x1edc5d[_0x4a3d31(0x193)](0xc8)['json']({'message':_0x2b2568[_0x4a3d31(0x1b1)]});}}),router['post'](a0_0x1fc31c(0x1d7),auth,async(_0x252033,_0x4932cd)=>{var _0x36a72a=a0_0x1fc31c;try{const {invoice:_0x122d0d,warehouse_name:_0x3dcaeb,Room_name:_0x44a229}=_0x252033[_0x36a72a(0x1fe)],_0x4455b4=_0x252033['params']['id'],_0xc41d5c=await adjustment_finished[_0x36a72a(0x234)]({'_id':_0x4455b4});var _0x781f94;const _0x45ad9b=_0xc41d5c[_0x36a72a(0x1eb)]['map'](async _0x3c7442=>{var _0x2e5169=_0x36a72a;if(_0x3c7442[_0x2e5169(0x21a)]>0x0){_0x781f94=await warehouse[_0x2e5169(0x1fd)]({'name':_0x3dcaeb,'room':_0x3c7442[_0x2e5169(0x20a)]});const _0x531061=_0x781f94['product_details'][_0x2e5169(0x217)](_0x52e70c=>{var _0x3eb179=_0x2e5169;console[_0x3eb179(0x1b4)](_0x3c7442[_0x3eb179(0x222)]);if(_0x3c7442[_0x3eb179(0x222)]==_0x3eb179(0x1fb))_0x52e70c[_0x3eb179(0x1ed)]==_0x3c7442[_0x3eb179(0x22e)]&&(_0x52e70c['product_stock']=_0x52e70c['product_stock']-_0x3c7442['adjust_qty']);else _0x3c7442['types']==_0x3eb179(0x190)&&(_0x52e70c[_0x3eb179(0x1ed)]==_0x3c7442[_0x3eb179(0x22e)]&&(_0x52e70c[_0x3eb179(0x1da)]=_0x52e70c[_0x3eb179(0x1da)]+_0x3c7442['adjust_qty']));});}return _0x781f94;});Promise['all'](_0x45ad9b)['then'](async _0x387820=>{var _0x36de30=_0x36a72a;try{for(const _0x15a95c of _0x387820){await _0x15a95c['save']();}_0xc41d5c[_0x36de30(0x1d4)]=_0x36de30(0x223);const _0x23d6f6=await _0xc41d5c[_0x36de30(0x1e7)](),_0x54c89b=await master_shop[_0x36de30(0x19f)](),_0x205667=await email_settings[_0x36de30(0x1fd)](),_0x57a55c=await supervisor_settings['find']();var _0x1f7e67=_0xc41d5c[_0x36de30(0x1eb)],_0x4c534b='',_0x3d9fa5;for(_0x3d9fa5 in _0x1f7e67){var _0x2440b9='FG';_0xc41d5c[_0x36de30(0x1fc)]==_0x36de30(0x1d2)&&(_0x2440b9='DG'),_0x4c534b+=_0x36de30(0x198)+_0x36de30(0x1b7)+_0x1f7e67[_0x3d9fa5][_0x36de30(0x205)]+_0x36de30(0x1d0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f7e67[_0x3d9fa5][_0x36de30(0x194)]+'</td>'+_0x36de30(0x1b7)+_0x1f7e67[_0x3d9fa5][_0x36de30(0x21a)]+_0x36de30(0x1d0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f7e67[_0x3d9fa5]['unit']+_0x36de30(0x1d0)+_0x36de30(0x1b7)+_0x1f7e67[_0x3d9fa5][_0x36de30(0x20c)]+_0x36de30(0x1d0)+_0x36de30(0x1b7)+_0xc41d5c[_0x36de30(0x1fc)]+_0x36de30(0x1d0)+_0x36de30(0x1b7)+_0x1f7e67[_0x3d9fa5][_0x36de30(0x20a)]+_0x36de30(0x1d0)+_0x36de30(0x1b7)+_0x2440b9+_0x1f7e67[_0x3d9fa5][_0x36de30(0x195)]+_0x36de30(0x1d0)+_0x36de30(0x229);}_0x252033[_0x36de30(0x206)]('success',_0x36de30(0x1c6)),_0x4932cd[_0x36de30(0x232)](_0x36de30(0x1e5)+_0x23d6f6[_0x36de30(0x1ed)]);}catch(_0x4711c5){console[_0x36de30(0x209)](_0x4711c5),_0x4932cd[_0x36de30(0x193)](0x1f4)[_0x36de30(0x1ea)]({'error':_0x36de30(0x1c7)});}})[_0x36a72a(0x1be)](_0x1253d6=>{var _0x1dbc5c=_0x36a72a;console['error'](_0x1253d6),_0x4932cd['status'](0x1f4)['json']({'error':_0x1dbc5c(0x1f4)});});}catch(_0x3d45e2){_0x4932cd[_0x36a72a(0x1ea)]({'message':_0x3d45e2['message']});}}),router['get']('/view/:id',auth,async(_0x3e5b5b,_0x5326e1)=>{var _0x5b16c0=a0_0x1fc31c;try{const {username:_0x55e413,email:_0x2f4d94,role:_0x2f6a55}=_0x3e5b5b[_0x5b16c0(0x1b5)],_0x476b61=_0x3e5b5b['user'],_0xceb4ff=await profile[_0x5b16c0(0x1fd)]({'email':_0x476b61[_0x5b16c0(0x1a9)]}),_0x480e23=await master_shop[_0x5b16c0(0x19f)]();console['log'](_0x5b16c0(0x1df),_0x480e23);const _0x4cb90f=_0x3e5b5b[_0x5b16c0(0x1e4)]['id'],_0xc6323e=await adjustment_finished[_0x5b16c0(0x234)]({'_id':_0x4cb90f});let _0x1e356f=new Date(_0xc6323e[_0x5b16c0(0x214)]),_0x16f440=('0'+_0x1e356f['getDate']())[_0x5b16c0(0x1a5)](-0x2),_0x13cdc0=('0'+(_0x1e356f['getMonth']()+0x1))[_0x5b16c0(0x1a5)](-0x2),_0x1475c5=_0x1e356f['getFullYear'](),_0x161946=_0x1475c5+'-'+_0x13cdc0+'-'+_0x16f440;var _0x27a64d=[_0x5b16c0(0x1ee),'Enclosed',_0x5b16c0(0x1d8)];const _0x3a89bc=await purchases[_0x5b16c0(0x192)]([{'$match':{'warehouse_name':_0xc6323e[_0x5b16c0(0x1fc)]}},{'$unwind':_0x5b16c0(0x203)},{'$group':{'_id':_0x5b16c0(0x1a7)}}]);console[_0x5b16c0(0x1b4)](_0x5b16c0(0x1a1),_0x3a89bc);const _0x291ffc=await product['find']({}),_0xda3101=await warehouse[_0x5b16c0(0x192)]([{'$match':{'name':_0xc6323e[_0x5b16c0(0x1fc)],'room':_0xc6323e[_0x5b16c0(0x1de)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5b16c0(0x230),'name':{'$first':_0x5b16c0(0x1a3)},'product_stock':{'$first':_0x5b16c0(0x20b)},'bay':{'$first':_0x5b16c0(0x1b2)},'bin':{'$first':_0x5b16c0(0x210)},'type':{'$first':_0x5b16c0(0x19a)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5b16c0(0x228)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5b16c0(0x1ef)},'storage':{'$first':_0x5b16c0(0x1d1)},'rack':{'$first':_0x5b16c0(0x219)}}}]);if(_0x480e23[0x0]['language']==_0x5b16c0(0x1bd)){var _0x29af8a=users[_0x5b16c0(0x1c1)];console[_0x5b16c0(0x1b4)](_0x29af8a);}else{if(_0x480e23[0x0][_0x5b16c0(0x226)]=='Hindi')var _0x29af8a=users[_0x5b16c0(0x204)];else{if(_0x480e23[0x0][_0x5b16c0(0x226)]==_0x5b16c0(0x1c3))var _0x29af8a=users['German'];else{if(_0x480e23[0x0][_0x5b16c0(0x226)]==_0x5b16c0(0x1ac))var _0x29af8a=users[_0x5b16c0(0x1ac)];else{if(_0x480e23[0x0][_0x5b16c0(0x226)]==_0x5b16c0(0x202))var _0x29af8a=users[_0x5b16c0(0x202)];else{if(_0x480e23[0x0][_0x5b16c0(0x226)]==_0x5b16c0(0x201))var _0x29af8a=users[_0x5b16c0(0x1d5)];else{if(_0x480e23[0x0][_0x5b16c0(0x226)]==_0x5b16c0(0x1dc))var _0x29af8a=users['Chinese'];else{if(_0x480e23[0x0][_0x5b16c0(0x226)]=='Arabic\x20(ae)')var _0x29af8a=users[_0x5b16c0(0x1e3)];}}}}}}}_0x5326e1[_0x5b16c0(0x211)]('edit_adjustment_finished',{'success':_0x3e5b5b[_0x5b16c0(0x206)](_0x5b16c0(0x1e1)),'errors':_0x3e5b5b[_0x5b16c0(0x206)](_0x5b16c0(0x1ab)),'role':_0x476b61,'profile':_0xceb4ff,'adjustment':_0xc6323e,'stock':_0xda3101,'master_shop':_0x480e23,'warehouse_name':_0x3a89bc,'unit':_0x291ffc,'language':_0x29af8a,'rooms_data':_0x27a64d,'ed_fullDate':_0x161946});}catch(_0x346d32){console[_0x5b16c0(0x1b4)](_0x346d32),_0x5326e1['status'](0xc8)['json']({'message':_0x346d32[_0x5b16c0(0x1b1)]});}}),router['post'](a0_0x1fc31c(0x199),auth,async(_0x58f940,_0x11a021)=>{var _0x46d8de=a0_0x1fc31c;try{const _0x4d9694=_0x58f940[_0x46d8de(0x1e4)]['id'],_0x5c0ea3=await adjustment_finished['findById']({'_id':_0x4d9694}),_0x29c0e3=await warehouse['findOne']({'name':_0x5c0ea3[_0x46d8de(0x1fc)],'room':_0x5c0ea3[_0x46d8de(0x1de)]}),{warehouse_name:_0x39a9e1,date:_0x4fef63,prod_name:_0xdbed11,level:_0x1e9344,isle:_0x174b53,pallet:_0x33d17f,stock:_0x272f87,types:_0x3ffdc8,adjust_qty:_0x40b323,new_adjust_qty:_0x2c8de0,note:_0x4790a0,Room_name:_0x483588,invoice:_0x30a551,JO_number:_0x54854a}=_0x58f940[_0x46d8de(0x1fe)];if(typeof _0xdbed11=='string')var _0x33d222=[_0x58f940['body'][_0x46d8de(0x18b)]],_0x269cc0=[_0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x1a4)]],_0x2620a9=[_0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x1bb)]],_0x2c3567=[_0x58f940['body'][_0x46d8de(0x222)]],_0x1547ce=[_0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x21a)]],_0x7a5a88=[_0x58f940[_0x46d8de(0x1fe)]['new_adjust_qty']],_0x30c352=[_0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x18a)]],_0x5ec52b=[_0x58f940['body'][_0x46d8de(0x22d)]],_0x2bbbe7=[_0x58f940['body'][_0x46d8de(0x1a8)]],_0x54514a=[_0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x18c)]],_0x46b11d=[_0x58f940['body']['expiry_date']];else var _0x33d222=[..._0x58f940[_0x46d8de(0x1fe)]['prod_name']],_0x269cc0=[..._0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x1a4)]],_0x2620a9=[..._0x58f940['body'][_0x46d8de(0x1bb)]],_0x2c3567=[..._0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x222)]],_0x1547ce=[..._0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x21a)]],_0x7a5a88=[..._0x58f940['body'][_0x46d8de(0x1f3)]],_0x30c352=[..._0x58f940['body'][_0x46d8de(0x18a)]],_0x5ec52b=[..._0x58f940['body'][_0x46d8de(0x22d)]],_0x2bbbe7=[..._0x58f940[_0x46d8de(0x1fe)]['Secondary_units']],_0x54514a=[..._0x58f940[_0x46d8de(0x1fe)][_0x46d8de(0x18c)]],_0x46b11d=[..._0x58f940['body'][_0x46d8de(0x214)]];const _0x296cb8=_0x33d222[_0x46d8de(0x217)](_0xee69cd=>{return _0xee69cd={'product_name':_0xee69cd};});_0x269cc0['forEach']((_0x466dcc,_0x47d364)=>{var _0x2482ba=_0x46d8de;_0x296cb8[_0x47d364][_0x2482ba(0x195)]=_0x466dcc;}),_0x2620a9['forEach']((_0x4cf2d9,_0x3293a8)=>{_0x296cb8[_0x3293a8]['stockBefore']=_0x4cf2d9;}),_0x2c3567[_0x46d8de(0x1f2)]((_0x12efc0,_0x49368c)=>{_0x296cb8[_0x49368c]['types']=_0x12efc0;}),_0x1547ce[_0x46d8de(0x1f2)]((_0x938bd7,_0x202a26)=>{_0x296cb8[_0x202a26]['adjust_qty']=_0x938bd7;}),_0x7a5a88[_0x46d8de(0x1f2)]((_0xc3b62c,_0x36402c)=>{_0x296cb8[_0x36402c]['new_adjust_qty']=_0xc3b62c;}),_0x5ec52b[_0x46d8de(0x1f2)]((_0x24a836,_0x45b155)=>{var _0x1d1600=_0x46d8de;_0x296cb8[_0x45b155][_0x1d1600(0x22d)]=_0x24a836;}),_0x2bbbe7[_0x46d8de(0x1f2)]((_0x58d61f,_0x331c38)=>{var _0x4b29fe=_0x46d8de;_0x296cb8[_0x331c38][_0x4b29fe(0x20c)]=_0x58d61f;}),_0x30c352[_0x46d8de(0x1f2)]((_0x3510bf,_0x561a41)=>{var _0x2eea66=_0x46d8de;_0x296cb8[_0x561a41][_0x2eea66(0x194)]=_0x3510bf;}),_0x54514a[_0x46d8de(0x1f2)]((_0x43121a,_0x2c42d3)=>{var _0x1a7635=_0x46d8de;_0x296cb8[_0x2c42d3][_0x1a7635(0x18c)]=_0x43121a;}),_0x46b11d['forEach']((_0x229f40,_0x8bdd86)=>{var _0x4bd2a9=_0x46d8de;_0x296cb8[_0x8bdd86][_0x4bd2a9(0x214)]=_0x229f40;});const _0x3efdad=_0x296cb8['filter'](_0x2d4269=>_0x2d4269['adjust_qty']!=='0'&&_0x2d4269[_0x46d8de(0x21a)]!=='');var _0x12ef32=0x0;_0x3efdad[_0x46d8de(0x1f2)](_0x52ec77=>{var _0x13970f=_0x46d8de;console[_0x13970f(0x1b4)](_0x13970f(0x1e0),_0x52ec77),parseInt(_0x52ec77[_0x13970f(0x21a)])<=0x0&&_0x12ef32++;});if(_0x12ef32!=0x0)return _0x58f940[_0x46d8de(0x206)](_0x46d8de(0x1ab),_0x46d8de(0x1ca)),_0x11a021[_0x46d8de(0x232)](_0x46d8de(0x19d));_0x5c0ea3[_0x46d8de(0x1fc)]=_0x39a9e1,_0x5c0ea3[_0x46d8de(0x186)]=_0x4fef63,_0x5c0ea3['product']=_0x3efdad,_0x5c0ea3[_0x46d8de(0x22f)]=_0x4790a0,_0x5c0ea3[_0x46d8de(0x1de)]=_0x483588,_0x5c0ea3[_0x46d8de(0x1ae)]=_0x30a551,_0x5c0ea3[_0x46d8de(0x185)]=_0x54854a;const _0x2b3df7=await _0x5c0ea3[_0x46d8de(0x1e7)](),_0x3209d4=await warehouse[_0x46d8de(0x1fd)]({'name':_0x39a9e1,'room':_0x483588});_0x2b3df7[_0x46d8de(0x1eb)][_0x46d8de(0x1f2)](_0x5b0088=>{var _0x2f8e65=_0x46d8de;const _0x19f38f=_0x3209d4[_0x2f8e65(0x1b6)][_0x2f8e65(0x217)](_0xb522f7=>{var _0x287eb0=_0x2f8e65;_0x5b0088[_0x287eb0(0x222)]==_0x287eb0(0x1fb)?_0xb522f7[_0x287eb0(0x205)]==_0x5b0088[_0x287eb0(0x205)]&&_0xb522f7['bay']==_0x5b0088[_0x287eb0(0x195)]&&(_0xb522f7[_0x287eb0(0x1da)]=parseInt(_0xb522f7['product_stock'])-parseInt(_0x5b0088[_0x287eb0(0x21a)])):_0xb522f7[_0x287eb0(0x205)]==_0x5b0088[_0x287eb0(0x205)]&&_0xb522f7['bay']==_0x5b0088[_0x287eb0(0x195)]&&(_0xb522f7[_0x287eb0(0x1da)]=parseInt(_0xb522f7[_0x287eb0(0x1da)])+parseInt(_0x5b0088[_0x287eb0(0x21a)]));});}),await _0x3209d4['save'](),_0x58f940[_0x46d8de(0x206)](_0x46d8de(0x1e1),_0x46d8de(0x1f0)),_0x11a021['redirect']('/adjustment_finished/view');}catch(_0x47c8f5){console[_0x46d8de(0x1b4)](_0x47c8f5);}}),router[a0_0x1fc31c(0x1c4)](a0_0x1fc31c(0x196),async(_0x1f49a7,_0x46303c)=>{var _0x5732bd=a0_0x1fc31c;const {primary_code:_0xd177e,warehouse_data:_0x5bf7b1,rooms_data:_0x28d4ba,Roomslist:_0x35738a}=_0x1f49a7[_0x5732bd(0x1fe)],_0x3f80cd=_0x35738a[_0x5732bd(0x1f5)](','),_0x18e9b7=[];async function _0x421d74(_0x28d449){var _0x49194a=_0x5732bd;const _0x3bab33=await warehouse[_0x49194a(0x192)]([{'$match':{'name':_0x5bf7b1,'room':_0x28d449}},{'$unwind':_0x49194a(0x1b8)},{'$match':{'product_details.primary_code':_0xd177e}},{'$group':{'_id':_0x49194a(0x230),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x49194a(0x20b)},'primary_code':{'$first':_0x49194a(0x228)},'secondary_code':{'$first':_0x49194a(0x208)},'product_code':{'$first':_0x49194a(0x1ef)},'level':{'$first':_0x49194a(0x1af)},'bay':{'$first':_0x49194a(0x1b2)},'type':{'$first':_0x49194a(0x19a)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x49194a(0x1c9)},'secondary_unit':{'$first':_0x49194a(0x1f9)},'storage':{'$first':_0x49194a(0x1d1)},'rack':{'$first':_0x49194a(0x219)},'expiry_date':{'$first':_0x49194a(0x22a)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x49194a(0x215)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x49194a(0x221)},'roomNamed':{'$first':_0x49194a(0x188)},'invoice':{'$first':_0x49194a(0x189)}}}]),_0x54d851=await warehouse[_0x49194a(0x192)]([{'$match':{'name':_0x5bf7b1,'room':_0x28d449}},{'$unwind':_0x49194a(0x1b8)},{'$match':{'product_details.secondary_code':_0xd177e}},{'$group':{'_id':_0x49194a(0x230),'name':{'$first':_0x49194a(0x1a3)},'product_stock':{'$first':_0x49194a(0x20b)},'primary_code':{'$first':_0x49194a(0x228)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x49194a(0x1ef)},'level':{'$first':_0x49194a(0x1af)},'bay':{'$first':'$product_details.bay'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x49194a(0x1ce)},'unit':{'$first':_0x49194a(0x1c9)},'secondary_unit':{'$first':_0x49194a(0x1f9)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x49194a(0x219)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x49194a(0x200)},'batch_code':{'$first':_0x49194a(0x215)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x49194a(0x221)},'roomNamed':{'$first':_0x49194a(0x188)},'invoice':{'$first':_0x49194a(0x189)}}}]);if(_0x3bab33[_0x49194a(0x21f)]>0x0)_0x18e9b7[_0x49194a(0x20f)](_0x3bab33);else _0x54d851[_0x49194a(0x21f)]>0x0&&_0x18e9b7['push'](_0x54d851);}const _0x1eb62e=_0x3f80cd[_0x5732bd(0x217)](_0x3c7a12=>_0x421d74(_0x3c7a12));await Promise[_0x5732bd(0x1aa)](_0x1eb62e),_0x46303c[_0x5732bd(0x1ea)](_0x18e9b7);}),router[a0_0x1fc31c(0x1c4)](a0_0x1fc31c(0x1a6),async(_0x3c99a8,_0x23e1c2)=>{var _0x16f313=a0_0x1fc31c;const {productCode:_0x9a8eef,bay:_0x501bfe,warehouses:_0x8f9174,room:_0x241bce}=_0x3c99a8[_0x16f313(0x1fe)];console[_0x16f313(0x1b4)](_0x3c99a8[_0x16f313(0x1fe)]);try{const _0x2e8568=await warehouse[_0x16f313(0x192)]([{'$match':{'name':_0x8f9174,'room':_0x241bce}},{'$unwind':_0x16f313(0x1b8)},{'$match':{'product_details.bay':parseInt(_0x501bfe)}},{'$group':{'_id':_0x16f313(0x230),'name':{'$first':_0x16f313(0x1a3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x16f313(0x1db)}}}]);_0x23e1c2[_0x16f313(0x193)](0xc8)[_0x16f313(0x1ea)](_0x2e8568);}catch(_0xbc08ac){_0x23e1c2['status'](0x194)[_0x16f313(0x1ea)]({'message':_0xbc08ac[_0x16f313(0x1b1)]});}}),module[a0_0x1fc31c(0x21c)]=router;