var a0_0x1783f4=a0_0x19f0;function a0_0x19f0(_0x3fe248,_0x32f1c8){var _0x512b40=a0_0x512b();return a0_0x19f0=function(_0x19f0b2,_0xd3d2d1){_0x19f0b2=_0x19f0b2-0xdd;var _0x20a059=_0x512b40[_0x19f0b2];return _0x20a059;},a0_0x19f0(_0x3fe248,_0x32f1c8);}(function(_0x36b29f,_0x287c72){var _0xe68ac5=a0_0x19f0,_0x4674ce=_0x36b29f();while(!![]){try{var _0x5ebfab=parseInt(_0xe68ac5(0x143))/0x1+parseInt(_0xe68ac5(0xea))/0x2*(parseInt(_0xe68ac5(0x14c))/0x3)+-parseInt(_0xe68ac5(0x185))/0x4*(-parseInt(_0xe68ac5(0x12b))/0x5)+parseInt(_0xe68ac5(0x14e))/0x6+parseInt(_0xe68ac5(0x159))/0x7*(-parseInt(_0xe68ac5(0x149))/0x8)+-parseInt(_0xe68ac5(0x176))/0x9+-parseInt(_0xe68ac5(0x110))/0xa*(parseInt(_0xe68ac5(0x16d))/0xb);if(_0x5ebfab===_0x287c72)break;else _0x4674ce['push'](_0x4674ce['shift']());}catch(_0x3cba12){_0x4674ce['push'](_0x4674ce['shift']());}}}(a0_0x512b,0x9b07e));const express=require(a0_0x1783f4(0x130)),app=express(),router=express[a0_0x1783f4(0x168)](),auth=require(a0_0x1783f4(0x158)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require(a0_0x1783f4(0x17e)),users=require(a0_0x1783f4(0x10a)),nodemailer=require(a0_0x1783f4(0x163));router[a0_0x1783f4(0xf1)](a0_0x1783f4(0x18e),auth,async(_0x5ac759,_0x5a87f5)=>{var _0xc2cd85=a0_0x1783f4;try{const {username:_0x5a29f5,email:_0x2322fe,role:_0x2ccf25}=_0x5ac759[_0xc2cd85(0x136)],_0x5c8b38=_0x5ac759[_0xc2cd85(0x136)],_0x3730db=await profile[_0xc2cd85(0x15e)]({'email':_0x5c8b38[_0xc2cd85(0xdf)]}),_0x228e21=await master_shop['find']();let _0x1c8345;if(_0x5c8b38['role']==_0xc2cd85(0xe6)){const _0x4c6b74=await staff[_0xc2cd85(0x15e)]({'email':_0x5c8b38['email']});_0x1c8345=await warehouse[_0xc2cd85(0x177)]({'status':'Enabled','name':_0x4c6b74[_0xc2cd85(0x13c)]});}else _0x1c8345=await warehouse['find']({'status':'Enabled'});const _0x35a31e=await product[_0xc2cd85(0x177)]();let _0x22e41d;if(_0x5c8b38[_0xc2cd85(0x122)]==_0xc2cd85(0xe6)){const _0x1f3691=await staff[_0xc2cd85(0x15e)]({'email':_0x5c8b38['email']});_0x22e41d=await adjustment_finished[_0xc2cd85(0x177)]({'warehouse_name':_0x1f3691['warehouse']});}else _0x22e41d=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0xc2cd85(0xf6)}},{'$unwind':_0xc2cd85(0x123)},{'$group':{'_id':_0xc2cd85(0x111),'invoice':{'$first':_0xc2cd85(0xfe)},'date':{'$first':_0xc2cd85(0x175)},'warehouse_name':{'$first':_0xc2cd85(0x124)},'room':{'$addToSet':_0xc2cd85(0xe7)},'finalize':{'$first':_0xc2cd85(0x154)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x228e21[0x0][_0xc2cd85(0x11d)]==_0xc2cd85(0x151)){var _0x363635=users[_0xc2cd85(0x13e)];console['log'](_0x363635);}else{if(_0x228e21[0x0][_0xc2cd85(0x11d)]==_0xc2cd85(0x145))var _0x363635=users['Hindi'];else{if(_0x228e21[0x0][_0xc2cd85(0x11d)]==_0xc2cd85(0x183))var _0x363635=users[_0xc2cd85(0x183)];else{if(_0x228e21[0x0][_0xc2cd85(0x11d)]==_0xc2cd85(0xe5))var _0x363635=users[_0xc2cd85(0xe5)];else{if(_0x228e21[0x0][_0xc2cd85(0x11d)]==_0xc2cd85(0x169))var _0x363635=users[_0xc2cd85(0x169)];else{if(_0x228e21[0x0][_0xc2cd85(0x11d)]==_0xc2cd85(0x17a))var _0x363635=users[_0xc2cd85(0x113)];else{if(_0x228e21[0x0]['language']=='Chinese')var _0x363635=users[_0xc2cd85(0x17f)];else{if(_0x228e21[0x0][_0xc2cd85(0x11d)]=='Arabic\x20(ae)')var _0x363635=users[_0xc2cd85(0xe8)];}}}}}}}_0x5a87f5['render'](_0xc2cd85(0x14d),{'success':_0x5ac759[_0xc2cd85(0x129)](_0xc2cd85(0x13f)),'errors':_0x5ac759[_0xc2cd85(0x129)]('errors'),'role':_0x5c8b38,'profile':_0x3730db,'warehouse':_0x1c8345,'product':_0x35a31e,'adjustment':_0x22e41d,'master_shop':_0x228e21,'language':_0x363635});}catch(_0x5cca38){console[_0xc2cd85(0x186)](_0x5cca38);}}),router[a0_0x1783f4(0xf1)](a0_0x1783f4(0x115),auth,async(_0x59d03b,_0x385244)=>{var _0x14250a=a0_0x1783f4;try{const {username:_0x252230,email:_0x57aeab,role:_0x14968d}=_0x59d03b[_0x14250a(0x136)],_0x1af45c=_0x59d03b[_0x14250a(0x136)],_0x427bcb=await profile[_0x14250a(0x15e)]({'email':_0x1af45c[_0x14250a(0xdf)]}),_0x27ef88=await master_shop['find']();let _0x5f45f0;if(_0x1af45c[_0x14250a(0x122)]==_0x14250a(0xe6)){const _0x33e3b1=await staff[_0x14250a(0x15e)]({'email':_0x1af45c[_0x14250a(0xdf)]});_0x5f45f0=await warehouse[_0x14250a(0x177)]({'status':'Enabled','name':_0x33e3b1[_0x14250a(0x13c)]});}else _0x5f45f0=await warehouse[_0x14250a(0x177)]({'status':'Enabled'});const _0x246df1=await product[_0x14250a(0x177)]();let _0x14d2de;if(_0x1af45c[_0x14250a(0x122)]=='staff'){const _0x5c1504=await staff['findOne']({'email':_0x1af45c[_0x14250a(0xdf)]});_0x14d2de=await adjustment_finished[_0x14250a(0x177)]({'warehouse_name':_0x5c1504[_0x14250a(0x13c)]});}else _0x14d2de=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x14250a(0x120)}},{'$unwind':_0x14250a(0x123)},{'$group':{'_id':_0x14250a(0x111),'invoice':{'$first':_0x14250a(0xfe)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x14250a(0xe7)},'finalize':{'$first':_0x14250a(0x154)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x27ef88[0x0][_0x14250a(0x11d)]=='English\x20(US)')var _0x33072a=users[_0x14250a(0x13e)];else{if(_0x27ef88[0x0][_0x14250a(0x11d)]==_0x14250a(0x145))var _0x33072a=users[_0x14250a(0x145)];else{if(_0x27ef88[0x0]['language']==_0x14250a(0x183))var _0x33072a=users[_0x14250a(0x183)];else{if(_0x27ef88[0x0]['language']==_0x14250a(0xe5))var _0x33072a=users[_0x14250a(0xe5)];else{if(_0x27ef88[0x0][_0x14250a(0x11d)]=='French')var _0x33072a=users[_0x14250a(0x169)];else{if(_0x27ef88[0x0][_0x14250a(0x11d)]=='Portuguese\x20(BR)')var _0x33072a=users['Portuguese'];else{if(_0x27ef88[0x0][_0x14250a(0x11d)]=='Chinese')var _0x33072a=users['Chinese'];else{if(_0x27ef88[0x0][_0x14250a(0x11d)]=='Arabic\x20(ae)')var _0x33072a=users[_0x14250a(0xe8)];}}}}}}}_0x385244['render'](_0x14250a(0xf9),{'success':_0x59d03b[_0x14250a(0x129)](_0x14250a(0x13f)),'errors':_0x59d03b[_0x14250a(0x129)](_0x14250a(0x11c)),'role':_0x1af45c,'profile':_0x427bcb,'warehouse':_0x5f45f0,'product':_0x246df1,'adjustment':_0x14d2de,'master_shop':_0x27ef88,'language':_0x33072a});}catch(_0x35e05c){console['log'](_0x35e05c);}});async function getRandom8DigitNumber(){var _0x4f69ab=a0_0x1783f4;const _0xf519ea=0x989680,_0x1a34c2=0x5f5e0ff,_0x427c4a=Math[_0x4f69ab(0x189)](Math[_0x4f69ab(0x144)]()*(_0x1a34c2-_0xf519ea+0x1))+_0xf519ea;var _0xd3f4e3;const _0x2bfb9f=await adjustment_finished[_0x4f69ab(0x15e)]({'invoice':'ADJF-'+_0x427c4a});return _0x2bfb9f&&_0x2bfb9f[_0x4f69ab(0x10b)]>0x0?_0xd3f4e3='ADJF-'+_0x427c4a:_0xd3f4e3=_0x4f69ab(0x127)+_0x427c4a,_0xd3f4e3;}function a0_0x512b(){var _0x235c6d=['$product_details.maxPerUnit','product_date','errors','language','level','redirect','logs','string','role','$product','$warehouse_name','message','stock','ADJF-','edit_adjustment_finished_view','flash','adjustment\x20data\x20update\x20successfully','23510HiwsFO','secondary_unit','params','catch','split','express','forEach','match','minus','expiry_date','$product_details.production_date','user','id_transaction','$product_details.unit','$product_details.type','padStart','$product_details.expiry_date','warehouse','getMonth','English','success','/adjustment_finished/view','/adjustment/view','$product_details','277757xuQTwA','random','Hindi','note','Enclosed','add_adjustment_finished_logs','3871640MPRmHk','$product_details.secondary_unit','New_Qty_Converted_adj','90CqVaxQ','adjustment_finished','7056336tWyOBf','status','purchases_data','English\x20(US)','$room','</td>','$finalize','$product.product_name','New_Qty_Converted','/CheckingWarehouse','../middleware/auth','7KLlhMD','maxPerUnit','product_details','$product_details.invoice','$product_details.rack','findOne','findById','map','production_date','$name','nodemailer','/adjustment_finished/preview/','$product_details.primary_code','_id','types','Router','French','warehouse_name','$product_details.storage','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','22iuNOWC','Rooms','Arabic\x20(ae)','render','JO_number','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','product_name','product','$date','350676PxRuIp','find','Enabled','back','Portuguese\x20(BR)','add_adjustment_finished','date','Secondary_units','../models/all_models','Chinese','invoice','adjustment\x20add\x20successfull','getDate','German','bay','12rsUOdO','log','Adjustment\x20Finalize\x20Successfully','slice','floor','$product_details._id','$product_details.secondary_code','/view/add_adjustment_logs','Primary_Units','/view','finalize','Return\x20Rooms','save','product_code','email','add','prod_code','getFullYear','$product_details.level','prod_name','Spanish','staff','$product.room_names','Arabic','unit','34288FGUcjA','push','$product_details.bin','room_names','DRY\x20GOODS','foreach\x20newproduct','aggregate','get','stockBefore','$product_details.floorlevel','new_adjust_qty','There\x27s\x20a\x20error\x20in\x20this\x20transaction','own','prod_invoice','/view/:id','adjustment_finished_logs','adjust_qty','exports','Ambient','/preview/:id','$invoice','filter','prod_cat','$product_details.bay','$product_details.batch_code','$product_details.product_code','$product_details.product_stock','batch_code','then','$product_details.product_name','all','id_transaction_from','../public/language/languages.json','length','product_stock','body','$product_details.maxProducts','/barcode_scanner','4121570jGCatK','$_id','toString','Portuguese','True','/view_logs','post','json','room','error'];a0_0x512b=function(){return _0x235c6d;};return a0_0x512b();}router[a0_0x1783f4(0xf1)]('/view/add_adjustment',auth,async(_0x296982,_0x2ab623)=>{var _0x25ba9b=a0_0x1783f4;try{const {username:_0x4bbf80,email:_0x381435,role:_0x214451}=_0x296982['user'],_0x421be5=_0x296982[_0x25ba9b(0x136)],_0x5b31d6=await profile[_0x25ba9b(0x15e)]({'email':_0x421be5[_0x25ba9b(0xdf)]}),_0x33e19d=await master_shop['find']();let _0x1c7125;if(_0x421be5[_0x25ba9b(0x122)]==_0x25ba9b(0xe6)){const _0x840ace=await staff[_0x25ba9b(0x15e)]({'email':_0x421be5[_0x25ba9b(0xdf)]});_0x1c7125=await warehouse[_0x25ba9b(0xf0)]([{'$match':{'status':_0x25ba9b(0x178),'name':_0x840ace['warehouse']}},{'$group':{'_id':_0x25ba9b(0x162),'name':{'$first':_0x25ba9b(0x162)}}}]);}else _0x1c7125=await warehouse['aggregate']([{'$match':{'status':_0x25ba9b(0x178)}},{'$group':{'_id':'$name','name':{'$first':_0x25ba9b(0x162)}}}]);const _0x2d79cd=await product['find']({}),_0x5154c2=await adjustment_finished['find'](),_0x3ee2aa=_0x5154c2[_0x25ba9b(0x10b)]+0x1,_0x277971=_0x25ba9b(0x127)+_0x3ee2aa['toString']()[_0x25ba9b(0x13a)](0x5,'0');var _0x24dd5d=['Ambient',_0x25ba9b(0x147),_0x25ba9b(0x190)];if(_0x33e19d[0x0][_0x25ba9b(0x11d)]==_0x25ba9b(0x151))var _0x2f1732=users['English'];else{if(_0x33e19d[0x0]['language']=='Hindi')var _0x2f1732=users['Hindi'];else{if(_0x33e19d[0x0][_0x25ba9b(0x11d)]=='German')var _0x2f1732=users[_0x25ba9b(0x183)];else{if(_0x33e19d[0x0][_0x25ba9b(0x11d)]==_0x25ba9b(0xe5))var _0x2f1732=users[_0x25ba9b(0xe5)];else{if(_0x33e19d[0x0][_0x25ba9b(0x11d)]==_0x25ba9b(0x169))var _0x2f1732=users['French'];else{if(_0x33e19d[0x0]['language']==_0x25ba9b(0x17a))var _0x2f1732=users[_0x25ba9b(0x113)];else{if(_0x33e19d[0x0][_0x25ba9b(0x11d)]=='Chinese')var _0x2f1732=users[_0x25ba9b(0x17f)];else{if(_0x33e19d[0x0][_0x25ba9b(0x11d)]=='Arabic\x20(ae)')var _0x2f1732=users[_0x25ba9b(0xe8)];}}}}}}}const _0x5be952=getRandom8DigitNumber();_0x5be952[_0x25ba9b(0x106)](_0x5a36ad=>{var _0x4dba98=_0x25ba9b;_0x2ab623[_0x4dba98(0x170)](_0x4dba98(0x17b),{'success':_0x296982['flash'](_0x4dba98(0x13f)),'errors':_0x296982[_0x4dba98(0x129)]('errors'),'role':_0x421be5,'profile':_0x5b31d6,'warehouse':_0x1c7125,'product':_0x2d79cd,'master_shop':_0x33e19d,'language':_0x2f1732,'rooms_data':_0x24dd5d,'invoice_no':_0x5a36ad});})[_0x25ba9b(0x12e)](_0x42982a=>{var _0x47dc8a=_0x25ba9b;_0x296982[_0x47dc8a(0x129)](_0x47dc8a(0x11c),_0x47dc8a(0xf5)),_0x2ab623[_0x47dc8a(0x11f)]('/adjustment/view');});}catch(_0x19dce2){console['log'](_0x19dce2);}}),router['post']('/view/add_adjustment',auth,async(_0x3cf1d4,_0x52f360)=>{var _0x27a829=a0_0x1783f4;try{const {warehouse_name:_0x3cf9b9,date:_0x2728c4,prod_name:_0x3cb1c1,level:_0x246a5e,isle:_0x458b2f,pallet:_0x47a240,stock:_0x29ec47,types:_0x17e16c,adjust_qty:_0x465837,new_adjust_qty:_0x24fefa,note:_0x4cfc00,Room_name:_0x1e3e78,JO_number:_0x2acf52,expiry_date:_0x5cf986,PO_number:_0x23ba0f,ReqBy:_0x25842e,dateofreq:_0x30d1aa,typeservicesData:_0x9f8c55,destination:_0x36a9fd,deliverydate:_0x32aa2c,driver:_0x444def,plate:_0x59f093,van:_0xe5bb93,DRSI:_0xf25522,typevehicle:_0x1757ce,TSU:_0x38efc5,TFU:_0x37c948}=_0x3cf1d4[_0x27a829(0x10d)];if(typeof _0x3cb1c1=='string')var _0x36cfa9=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0xe4)]],_0x573d40=[_0x3cf1d4['body'][_0x27a829(0x11e)]],_0x1a0623=[_0x3cf1d4['body']['stock']],_0x2a1580=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x167)]],_0xf80bec=[_0x3cf1d4[_0x27a829(0x10d)]['New_Qty_Converted_adj']],_0x313d59=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x156)]],_0x2a0662=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x18d)]],_0x13d035=[_0x3cf1d4['body'][_0x27a829(0x17d)]],_0x390ca2=[_0x3cf1d4[_0x27a829(0x10d)]['prod_code']],_0x3afff6=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x105)]],_0x54117b=[_0x3cf1d4['body'][_0x27a829(0x134)]],_0x436e75=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x11b)]],_0xfbfcf2=[_0x3cf1d4[_0x27a829(0x10d)]['prod_cat']],_0x1a83c9=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x16e)]],_0x42b12e=[_0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x15a)]],_0x28ba32=[_0x3cf1d4['body'][_0x27a829(0xf7)]],_0x4e88d7=[_0x3cf1d4['body'][_0x27a829(0x109)]];else var _0x36cfa9=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0xe4)]],_0x573d40=[..._0x3cf1d4['body'][_0x27a829(0x11e)]],_0x1a0623=[..._0x3cf1d4['body'][_0x27a829(0x126)]],_0x2a1580=[..._0x3cf1d4['body'][_0x27a829(0x167)]],_0xf80bec=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x14b)]],_0x313d59=[..._0x3cf1d4[_0x27a829(0x10d)]['New_Qty_Converted']],_0x2a0662=[..._0x3cf1d4[_0x27a829(0x10d)]['Primary_Units']],_0x13d035=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x17d)]],_0x390ca2=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0xe1)]],_0x3afff6=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x105)]],_0x54117b=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x134)]],_0x436e75=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x11b)]],_0xfbfcf2=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x100)]],_0x1a83c9=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x16e)]],_0x42b12e=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x15a)]],_0x28ba32=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0xf7)]],_0x4e88d7=[..._0x3cf1d4[_0x27a829(0x10d)][_0x27a829(0x109)]];const _0xe6dc47=_0x36cfa9[_0x27a829(0x160)](_0x3c288d=>{return _0x3c288d={'product_name':_0x3c288d};});_0x573d40['forEach']((_0x3f9e60,_0x54e5a9)=>{var _0x118f29=_0x27a829,_0x1e4743=_0x3f9e60[_0x118f29(0x132)](/[A-Za-z]+/)[0x0],_0x3688c8=parseInt(_0x3f9e60[_0x118f29(0x132)](/\d+/)[0x0]);_0xe6dc47[_0x54e5a9][_0x118f29(0x11e)]=_0x1e4743,_0xe6dc47[_0x54e5a9][_0x118f29(0x184)]=_0x3688c8;}),_0x4e88d7[_0x27a829(0x131)]((_0x24af95,_0x2c186d)=>{var _0x4e6f11=_0x27a829;_0xe6dc47[_0x2c186d][_0x4e6f11(0x137)]=_0x24af95;}),_0x1a0623[_0x27a829(0x131)]((_0xe4d41e,_0x307852)=>{var _0x2b9cc7=_0x27a829;_0xe6dc47[_0x307852][_0x2b9cc7(0xf2)]=_0xe4d41e;}),_0x2a1580[_0x27a829(0x131)]((_0x374039,_0x2330a2)=>{var _0x2b2385=_0x27a829;_0xe6dc47[_0x2330a2][_0x2b2385(0x167)]=_0x374039;}),_0xf80bec[_0x27a829(0x131)]((_0x4a4425,_0x316b77)=>{_0xe6dc47[_0x316b77]['adjust_qty']=_0x4a4425;}),_0x313d59['forEach']((_0x3130cf,_0x640aff)=>{var _0xbd83be=_0x27a829;_0xe6dc47[_0x640aff][_0xbd83be(0xf4)]=_0x3130cf;}),_0x2a0662[_0x27a829(0x131)]((_0x578cb1,_0x4a6e62)=>{_0xe6dc47[_0x4a6e62]['unit']=_0x578cb1;}),_0x13d035['forEach']((_0x2b903c,_0x1ccbd0)=>{var _0x2eb9c8=_0x27a829;_0xe6dc47[_0x1ccbd0][_0x2eb9c8(0x12c)]=_0x2b903c;}),_0x390ca2[_0x27a829(0x131)]((_0x13c86b,_0x265989)=>{var _0x29a83a=_0x27a829;_0xe6dc47[_0x265989][_0x29a83a(0xde)]=_0x13c86b;}),_0x3afff6[_0x27a829(0x131)]((_0x14799d,_0x281899)=>{var _0x5ab65a=_0x27a829;_0xe6dc47[_0x281899][_0x5ab65a(0x105)]=_0x14799d;}),_0x54117b['forEach']((_0x53c904,_0x330c56)=>{var _0x2489e4=_0x27a829;_0xe6dc47[_0x330c56][_0x2489e4(0x134)]=_0x53c904;}),_0x436e75[_0x27a829(0x131)]((_0x5ef6c8,_0x1f6270)=>{var _0x288339=_0x27a829;_0xe6dc47[_0x1f6270][_0x288339(0x161)]=_0x5ef6c8;}),_0xfbfcf2['forEach']((_0x13df90,_0x39c7d1)=>{var _0x2662fb=_0x27a829;_0xe6dc47[_0x39c7d1][_0x2662fb(0x100)]=_0x13df90;}),_0x1a83c9[_0x27a829(0x131)]((_0xa6a31a,_0x1690ce)=>{_0xe6dc47[_0x1690ce]['room_names']=_0xa6a31a;}),_0x42b12e[_0x27a829(0x131)]((_0x44cfc9,_0x6e48fd)=>{var _0x12579f=_0x27a829;_0xe6dc47[_0x6e48fd][_0x12579f(0x15a)]=_0x44cfc9;}),_0x28ba32[_0x27a829(0x131)]((_0x4972bc,_0x490313)=>{_0xe6dc47[_0x490313]['invoice']=_0x4972bc;});const _0x3f440f=_0xe6dc47[_0x27a829(0xff)](_0x30d0fb=>_0x30d0fb['adjust_qty']!=='0'&&_0x30d0fb[_0x27a829(0xfa)]!=='');var _0x53975c=0x0;_0x3f440f['forEach'](_0x528c95=>{var _0xdd35c5=_0x27a829;console[_0xdd35c5(0x186)]('foreach\x20newproduct',_0x528c95),parseInt(_0x528c95['adjust_qty'])<=0x0&&_0x53975c++;});if(_0x53975c!=0x0)return _0x3cf1d4['flash'](_0x27a829(0x11c),_0x27a829(0x172)),_0x52f360[_0x27a829(0x11f)](_0x27a829(0x179));const _0x4a9b88=new invoice_for_adjustment();await _0x4a9b88[_0x27a829(0xdd)]();const _0x1167ec=new adjustment_finished({'warehouse_name':_0x3cf9b9,'date':_0x2728c4,'product':_0x3f440f,'note':_0x4cfc00,'room':_0x1e3e78,'invoice':'ADJ-'+_0x4a9b88['invoice_init'][_0x27a829(0x112)]()['padStart'](0x8,'0'),'JO_number':_0x2acf52,'expiry_date':_0x5cf986,'PO_number':_0x23ba0f,'RequestedBy':_0x25842e,'DateofRequest':_0x30d1aa,'typeservices':_0x9f8c55,'destination':_0x36a9fd,'deliverydate':_0x32aa2c,'driver':_0x444def,'plate':_0x59f093,'van':_0xe5bb93,'DRSI':_0xf25522,'typevehicle':_0x1757ce,'TSU':_0x38efc5,'TFU':_0x37c948}),_0x558a76=await _0x1167ec['save']();_0x3cf1d4[_0x27a829(0x129)](_0x27a829(0x13f),_0x27a829(0x181)),_0x52f360[_0x27a829(0x11f)](_0x27a829(0x164)+_0x558a76[_0x27a829(0x166)]);}catch(_0x10f5b8){console[_0x27a829(0x186)](_0x10f5b8),_0x52f360[_0x27a829(0x14f)](0xc8)[_0x27a829(0x117)]({'message':_0x10f5b8[_0x27a829(0x125)]});}}),router[a0_0x1783f4(0xf1)](a0_0x1783f4(0x18c),auth,async(_0x53f2cd,_0xcd671)=>{var _0x28f52d=a0_0x1783f4;try{const {username:_0x5aeb04,email:_0x30fe48,role:_0x581cac}=_0x53f2cd[_0x28f52d(0x136)],_0x3df7ad=_0x53f2cd['user'],_0x2698d3=await profile['findOne']({'email':_0x3df7ad['email']}),_0x3f594a=await master_shop[_0x28f52d(0x177)]();let _0x15b5ed;if(_0x3df7ad[_0x28f52d(0x122)]==_0x28f52d(0xe6)){const _0x22ae8c=await staff['findOne']({'email':_0x3df7ad[_0x28f52d(0xdf)]});_0x15b5ed=await warehouse[_0x28f52d(0xf0)]([{'$match':{'status':_0x28f52d(0x178),'name':_0x22ae8c[_0x28f52d(0x13c)]}},{'$group':{'_id':_0x28f52d(0x162),'name':{'$first':'$name'}}}]);}else _0x15b5ed=await warehouse['aggregate']([{'$match':{'status':_0x28f52d(0x178)}},{'$group':{'_id':'$name','name':{'$first':_0x28f52d(0x162)}}}]);const _0x4a1265=await product['find'](),_0x16e879=await adjustment_finished[_0x28f52d(0x177)](),_0x3ae690=_0x16e879[_0x28f52d(0x10b)]+0x1,_0x4cb04a='ADJF-'+_0x3ae690['toString']()[_0x28f52d(0x13a)](0x5,'0');var _0x1f89c7=[_0x28f52d(0xfc),_0x28f52d(0x147),'Return\x20Rooms'];if(_0x3f594a[0x0][_0x28f52d(0x11d)]==_0x28f52d(0x151))var _0x1b7639=users[_0x28f52d(0x13e)];else{if(_0x3f594a[0x0][_0x28f52d(0x11d)]==_0x28f52d(0x145))var _0x1b7639=users['Hindi'];else{if(_0x3f594a[0x0]['language']==_0x28f52d(0x183))var _0x1b7639=users[_0x28f52d(0x183)];else{if(_0x3f594a[0x0]['language']==_0x28f52d(0xe5))var _0x1b7639=users[_0x28f52d(0xe5)];else{if(_0x3f594a[0x0][_0x28f52d(0x11d)]=='French')var _0x1b7639=users['French'];else{if(_0x3f594a[0x0][_0x28f52d(0x11d)]==_0x28f52d(0x17a))var _0x1b7639=users['Portuguese'];else{if(_0x3f594a[0x0][_0x28f52d(0x11d)]==_0x28f52d(0x17f))var _0x1b7639=users[_0x28f52d(0x17f)];else{if(_0x3f594a[0x0]['language']==_0x28f52d(0x16f))var _0x1b7639=users['Arabic'];}}}}}}}const _0x5cd167=getRandom8DigitNumber();_0x5cd167[_0x28f52d(0x106)](_0x554ad1=>{var _0x490a30=_0x28f52d;_0xcd671[_0x490a30(0x170)](_0x490a30(0x148),{'success':_0x53f2cd[_0x490a30(0x129)](_0x490a30(0x13f)),'errors':_0x53f2cd['flash'](_0x490a30(0x11c)),'role':_0x3df7ad,'profile':_0x2698d3,'warehouse':_0x15b5ed,'product':_0x4a1265,'master_shop':_0x3f594a,'language':_0x1b7639,'rooms_data':_0x1f89c7,'invoice_no':_0x554ad1});})[_0x28f52d(0x12e)](_0x162702=>{var _0x484c4a=_0x28f52d;_0x53f2cd[_0x484c4a(0x129)](_0x484c4a(0x11c),_0x484c4a(0xf5)),_0xcd671[_0x484c4a(0x11f)](_0x484c4a(0x141));});}catch(_0x3f648f){console[_0x28f52d(0x186)](_0x3f648f);}}),router[a0_0x1783f4(0x116)]('/view/add_adjustment_logs',auth,async(_0x2be4f6,_0xae5013)=>{var _0x17e402=a0_0x1783f4;try{const {warehouse_name:_0x5757c5,date:_0x2beffa,prod_name:_0x1dc44d,level:_0x136639,isle:_0x67a9ea,pallet:_0x2b69ee,stock:_0x2339d5,types:_0x53c8f,adjust_qty:_0x26cd35,new_adjust_qty:_0x279232,note:_0x4c1b98,Room_name:_0xf067b0,JO_number:_0x49aca7,expiry_date:_0x4a5c16,type_of_transaction:_0x248f52,PO_number:_0x1bc2fb,ReqBy:_0x4c7357,dateofreq:_0x52cb03,typeservicesData:_0x254003,destination:_0x889710,deliverydate:_0x507ba3,driver:_0xe7f7e7,plate:_0x4c2ea9,van:_0x24139a,DRSI:_0x552d15,typevehicle:_0x24f856,TSU:_0x20b9cf,TFU:_0x361c94}=_0x2be4f6[_0x17e402(0x10d)];if(typeof _0x1dc44d==_0x17e402(0x121))var _0x4ff0be=[_0x2be4f6['body'][_0x17e402(0xe4)]],_0x5ab38=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x11e)]],_0x2a62e2=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x126)]],_0x2ebc82=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x167)]],_0x21768e=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x14b)]],_0x1c2fa7=[_0x2be4f6[_0x17e402(0x10d)]['New_Qty_Converted']],_0x44a4ce=[_0x2be4f6['body'][_0x17e402(0x18d)]],_0x152714=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x17d)]],_0x1053fd=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0xe1)]],_0xf3f6ec=[_0x2be4f6[_0x17e402(0x10d)]['batch_code']],_0x5ac574=[_0x2be4f6[_0x17e402(0x10d)]['expiry_date']],_0x5b41bc=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x11b)]],_0x185e95=[_0x2be4f6[_0x17e402(0x10d)]['prod_cat']],_0x4f40a0=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x16e)]],_0x5e8bf3=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x15a)]],_0x46e6fc=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0xf7)]],_0x3f2ec6=[_0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x109)]];else var _0x4ff0be=[..._0x2be4f6['body']['prod_name']],_0x5ab38=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x11e)]],_0x2a62e2=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x126)]],_0x2ebc82=[..._0x2be4f6['body'][_0x17e402(0x167)]],_0x21768e=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x14b)]],_0x1c2fa7=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x156)]],_0x44a4ce=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x18d)]],_0x152714=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x17d)]],_0x1053fd=[..._0x2be4f6[_0x17e402(0x10d)]['prod_code']],_0xf3f6ec=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x105)]],_0x5ac574=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x134)]],_0x5b41bc=[..._0x2be4f6['body'][_0x17e402(0x11b)]],_0x185e95=[..._0x2be4f6[_0x17e402(0x10d)]['prod_cat']],_0x4f40a0=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x16e)]],_0x5e8bf3=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x15a)]],_0x46e6fc=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0xf7)]],_0x3f2ec6=[..._0x2be4f6[_0x17e402(0x10d)][_0x17e402(0x109)]];const _0x2190fd=_0x4ff0be[_0x17e402(0x160)](_0x5ec95f=>{return _0x5ec95f={'product_name':_0x5ec95f};});_0x5ab38[_0x17e402(0x131)]((_0x50f884,_0x4a5944)=>{var _0x33b386=_0x17e402,_0x4dc118=_0x50f884['match'](/[A-Za-z]+/)[0x0],_0x207594=parseInt(_0x50f884[_0x33b386(0x132)](/\d+/)[0x0]);_0x2190fd[_0x4a5944][_0x33b386(0x11e)]=_0x4dc118,_0x2190fd[_0x4a5944][_0x33b386(0x184)]=_0x207594;}),_0x3f2ec6[_0x17e402(0x131)]((_0x253695,_0x34fb23)=>{var _0xd6fdd8=_0x17e402;_0x2190fd[_0x34fb23][_0xd6fdd8(0x137)]=_0x253695;}),_0x2a62e2[_0x17e402(0x131)]((_0x270df2,_0x43746a)=>{_0x2190fd[_0x43746a]['stockBefore']=_0x270df2;}),_0x2ebc82[_0x17e402(0x131)]((_0x211372,_0x484c12)=>{var _0x26b35c=_0x17e402;_0x2190fd[_0x484c12][_0x26b35c(0x167)]=_0x211372;}),_0x21768e[_0x17e402(0x131)]((_0x384ce6,_0x1faa0c)=>{var _0xfc718d=_0x17e402;_0x2190fd[_0x1faa0c][_0xfc718d(0xfa)]=_0x384ce6;}),_0x1c2fa7[_0x17e402(0x131)]((_0x1dec20,_0x319f00)=>{var _0xc29f55=_0x17e402;_0x2190fd[_0x319f00][_0xc29f55(0xf4)]=_0x1dec20;}),_0x44a4ce[_0x17e402(0x131)]((_0x1963f1,_0x76ff8f)=>{var _0x182b2e=_0x17e402;_0x2190fd[_0x76ff8f][_0x182b2e(0xe9)]=_0x1963f1;}),_0x152714[_0x17e402(0x131)]((_0x248a39,_0x289da7)=>{var _0x40ec17=_0x17e402;_0x2190fd[_0x289da7][_0x40ec17(0x12c)]=_0x248a39;}),_0x1053fd[_0x17e402(0x131)]((_0x3454f6,_0x5c5f27)=>{_0x2190fd[_0x5c5f27]['product_code']=_0x3454f6;}),_0xf3f6ec[_0x17e402(0x131)]((_0x16df36,_0xb9cb79)=>{var _0x5ebde6=_0x17e402;_0x2190fd[_0xb9cb79][_0x5ebde6(0x105)]=_0x16df36;}),_0x5ac574[_0x17e402(0x131)]((_0x2c4244,_0x1adffe)=>{var _0x399029=_0x17e402;_0x2190fd[_0x1adffe][_0x399029(0x134)]=_0x2c4244;}),_0x5b41bc[_0x17e402(0x131)]((_0x5da24e,_0x463d79)=>{var _0x29a1de=_0x17e402;_0x2190fd[_0x463d79][_0x29a1de(0x161)]=_0x5da24e;}),_0x185e95['forEach']((_0x51f788,_0x1cc9f8)=>{var _0x19b756=_0x17e402;_0x2190fd[_0x1cc9f8][_0x19b756(0x100)]=_0x51f788;}),_0x4f40a0[_0x17e402(0x131)]((_0x529607,_0x357606)=>{var _0x5767f4=_0x17e402;_0x2190fd[_0x357606][_0x5767f4(0xed)]=_0x529607;}),_0x5e8bf3[_0x17e402(0x131)]((_0x25ddbd,_0x4381e0)=>{var _0x2ef51e=_0x17e402;_0x2190fd[_0x4381e0][_0x2ef51e(0x15a)]=_0x25ddbd;}),_0x46e6fc[_0x17e402(0x131)]((_0x5ce9c2,_0x200bcf)=>{var _0x3f0975=_0x17e402;_0x2190fd[_0x200bcf][_0x3f0975(0x180)]=_0x5ce9c2;});const _0x13758d=_0x2190fd[_0x17e402(0xff)](_0x1c326e=>_0x1c326e[_0x17e402(0xfa)]!=='0'&&_0x1c326e['adjust_qty']!=='');var _0x3a64da=0x0;_0x13758d[_0x17e402(0x131)](_0x447797=>{var _0x45deff=_0x17e402;console[_0x45deff(0x186)](_0x45deff(0xef),_0x447797),parseInt(_0x447797['adjust_qty'])<=0x0&&_0x3a64da++;});if(_0x3a64da!=0x0)return _0x2be4f6['flash'](_0x17e402(0x11c),_0x17e402(0x172)),_0xae5013[_0x17e402(0x11f)](_0x17e402(0x179));const _0x1c8e23=new adjustment_logs();await _0x1c8e23[_0x17e402(0xdd)]();const _0x2b4342=new adjustment_finished({'warehouse_name':_0x5757c5,'date':_0x2beffa,'product':_0x13758d,'note':_0x4c1b98,'room':_0xf067b0,'invoice':'LOG-ADJ-'+_0x1c8e23['invoice_init'][_0x17e402(0x112)]()[_0x17e402(0x13a)](0x8,'0'),'JO_number':_0x49aca7,'expiry_date':_0x4a5c16,'type_of_transaction':_0x248f52,'PO_number':_0x1bc2fb,'RequestedBy':_0x4c7357,'DateofRequest':_0x52cb03,'typeservices':_0x254003,'destination':_0x889710,'deliverydate':_0x507ba3,'driver':_0xe7f7e7,'plate':_0x4c2ea9,'van':_0x24139a,'DRSI':_0x552d15,'typevehicle':_0x24f856,'TSU':_0x20b9cf,'TFU':_0x361c94}),_0xcfc577=await _0x2b4342[_0x17e402(0xdd)]();_0x2be4f6['flash'](_0x17e402(0x13f),_0x17e402(0x181)),_0xae5013[_0x17e402(0x11f)](_0x17e402(0x164)+_0xcfc577[_0x17e402(0x166)]);}catch(_0x597d03){console['log'](_0x597d03),_0xae5013[_0x17e402(0x14f)](0xc8)['json']({'message':_0x597d03[_0x17e402(0x125)]});}}),router[a0_0x1783f4(0xf1)](a0_0x1783f4(0xfd),auth,async(_0x2cb98c,_0x1acf2d)=>{var _0x1ca5e8=a0_0x1783f4;try{const {username:_0x22dcd0,email:_0x43b212,role:_0x4c92dd}=_0x2cb98c[_0x1ca5e8(0x136)],_0x4075bc=_0x2cb98c['user'],_0x2c4362=await profile[_0x1ca5e8(0x15e)]({'email':_0x4075bc['email']}),_0x319c1a=await master_shop[_0x1ca5e8(0x177)](),_0xf65883=_0x2cb98c[_0x1ca5e8(0x12d)]['id'],_0x1ca95c=await adjustment_finished[_0x1ca5e8(0x15f)]({'_id':_0xf65883}),_0x1d66f4=await purchases[_0x1ca5e8(0xf0)]([{'$match':{'warehouse_name':_0x1ca95c[_0x1ca5e8(0x16a)]}},{'$unwind':_0x1ca5e8(0x123)},{'$group':{'_id':'$product.product_name'}}]);console[_0x1ca5e8(0x186)]('purchases_data',_0x1d66f4);const _0x42a75f=await product[_0x1ca5e8(0x177)]({}),_0xc5eb2b=await warehouse[_0x1ca5e8(0xf0)]([{'$match':{'name':_0x1ca95c['warehouse_name']}},{'$unwind':_0x1ca5e8(0x142)},{'$group':{'_id':_0x1ca5e8(0x18a),'name':{'$first':_0x1ca5e8(0x107)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1ca5e8(0xec)},'type':{'$first':_0x1ca5e8(0x139)},'floorlevel':{'$first':_0x1ca5e8(0xf3)},'primary_code':{'$first':_0x1ca5e8(0x165)},'secondary_code':{'$first':_0x1ca5e8(0x18b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1ca5e8(0x16b)},'rack':{'$first':_0x1ca5e8(0x15d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1ca5e8(0x135)},'batch_code':{'$first':_0x1ca5e8(0x102)},'maxPerUnit':{'$first':_0x1ca5e8(0x11a)},'room':{'$first':_0x1ca5e8(0x152)}}}]);if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]==_0x1ca5e8(0x151)){var _0x160fb9=users[_0x1ca5e8(0x13e)];console[_0x1ca5e8(0x186)](_0x160fb9);}else{if(_0x319c1a[0x0]['language']==_0x1ca5e8(0x145))var _0x160fb9=users['Hindi'];else{if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]=='German')var _0x160fb9=users[_0x1ca5e8(0x183)];else{if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]=='Spanish')var _0x160fb9=users['Spanish'];else{if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]=='French')var _0x160fb9=users['French'];else{if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]==_0x1ca5e8(0x17a))var _0x160fb9=users['Portuguese'];else{if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]==_0x1ca5e8(0x17f))var _0x160fb9=users[_0x1ca5e8(0x17f)];else{if(_0x319c1a[0x0][_0x1ca5e8(0x11d)]==_0x1ca5e8(0x16f))var _0x160fb9=users[_0x1ca5e8(0xe8)];}}}}}}}_0x1acf2d[_0x1ca5e8(0x170)](_0x1ca5e8(0x128),{'success':_0x2cb98c['flash'](_0x1ca5e8(0x13f)),'errors':_0x2cb98c[_0x1ca5e8(0x129)](_0x1ca5e8(0x11c)),'role':_0x4075bc,'profile':_0x2c4362,'adjustment':_0x1ca95c,'stock':_0xc5eb2b,'master_shop':_0x319c1a,'warehouse_name':_0x1d66f4,'unit':_0x42a75f,'language':_0x160fb9});}catch(_0x529c1a){console[_0x1ca5e8(0x186)](_0x529c1a),_0x1acf2d[_0x1ca5e8(0x14f)](0xc8)[_0x1ca5e8(0x117)]({'message':_0x529c1a[_0x1ca5e8(0x125)]});}}),router['post'](a0_0x1783f4(0xfd),auth,async(_0xc47168,_0x433cd7)=>{var _0x1fc3f9=a0_0x1783f4;try{const {invoice:_0x1d5689,warehouse_name:_0x1a64c9,Room_name:_0x2fef12}=_0xc47168[_0x1fc3f9(0x10d)],_0x6080c8=_0xc47168[_0x1fc3f9(0x12d)]['id'],_0x4689cb=await adjustment_finished[_0x1fc3f9(0x15f)]({'_id':_0x6080c8});var _0x404650;const _0x1161e6=_0x4689cb[_0x1fc3f9(0x174)][_0x1fc3f9(0x160)](async _0x4b0fb3=>{var _0x254fc6=_0x1fc3f9;if(_0x4b0fb3[_0x254fc6(0xfa)]>0x0){_0x404650=await warehouse[_0x254fc6(0x15e)]({'name':_0x1a64c9,'room':_0x4b0fb3[_0x254fc6(0xed)]});const _0x5cdaa8=_0x404650[_0x254fc6(0x15b)]['map'](_0x695cb3=>{var _0x54c0b7=_0x254fc6;console[_0x54c0b7(0x186)](_0x4b0fb3[_0x54c0b7(0x167)]);if(_0x4b0fb3['types']=='minus')_0x695cb3[_0x54c0b7(0x166)]==_0x4b0fb3[_0x54c0b7(0x137)]&&(_0x695cb3[_0x54c0b7(0x10c)]=_0x695cb3[_0x54c0b7(0x10c)]-_0x4b0fb3['adjust_qty']);else _0x4b0fb3['types']==_0x54c0b7(0xe0)&&(_0x695cb3[_0x54c0b7(0x166)]==_0x4b0fb3[_0x54c0b7(0x137)]&&(_0x695cb3[_0x54c0b7(0x10c)]=_0x695cb3[_0x54c0b7(0x10c)]+_0x4b0fb3[_0x54c0b7(0xfa)]));});}return _0x404650;});Promise[_0x1fc3f9(0x108)](_0x1161e6)[_0x1fc3f9(0x106)](async _0x17c978=>{var _0x18c9c7=_0x1fc3f9;try{for(const _0x383762 of _0x17c978){await _0x383762[_0x18c9c7(0xdd)]();}_0x4689cb[_0x18c9c7(0x18f)]=_0x18c9c7(0x114);const _0xc3c253=await _0x4689cb[_0x18c9c7(0xdd)](),_0x669aa=await master_shop[_0x18c9c7(0x177)](),_0x7dda25=await email_settings[_0x18c9c7(0x15e)](),_0x503ce9=await supervisor_settings[_0x18c9c7(0x177)]();var _0x149d09=_0x4689cb[_0x18c9c7(0x174)],_0x4620ee='',_0x494ee4;for(_0x494ee4 in _0x149d09){var _0x2a2533='FG';_0x4689cb['warehouse_name']==_0x18c9c7(0xee)&&(_0x2a2533='DG'),_0x4620ee+='<tr>'+_0x18c9c7(0x16c)+_0x149d09[_0x494ee4][_0x18c9c7(0x173)]+_0x18c9c7(0x153)+_0x18c9c7(0x16c)+_0x149d09[_0x494ee4][_0x18c9c7(0xde)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x149d09[_0x494ee4]['adjust_qty']+_0x18c9c7(0x153)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x149d09[_0x494ee4][_0x18c9c7(0xe9)]+_0x18c9c7(0x153)+_0x18c9c7(0x16c)+_0x149d09[_0x494ee4][_0x18c9c7(0x12c)]+_0x18c9c7(0x153)+_0x18c9c7(0x16c)+_0x4689cb['warehouse_name']+_0x18c9c7(0x153)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x149d09[_0x494ee4]['room_names']+'</td>'+_0x18c9c7(0x16c)+_0x2a2533+_0x149d09[_0x494ee4][_0x18c9c7(0x184)]+_0x18c9c7(0x153)+'</tr>';}_0xc47168[_0x18c9c7(0x129)]('success',_0x18c9c7(0x187)),_0x433cd7['redirect']('/picking_list/PDF_adjustmentFinal/'+_0xc3c253[_0x18c9c7(0x166)]);}catch(_0x5238b3){console[_0x18c9c7(0x119)](_0x5238b3),_0x433cd7[_0x18c9c7(0x14f)](0x1f4)[_0x18c9c7(0x117)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x1d804b=>{var _0xee3019=_0x1fc3f9;console[_0xee3019(0x119)](_0x1d804b),_0x433cd7[_0xee3019(0x14f)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x1a6961){_0x433cd7[_0x1fc3f9(0x117)]({'message':_0x1a6961['message']});}}),router['get'](a0_0x1783f4(0xf8),auth,async(_0x34f2f1,_0x4144)=>{var _0x320513=a0_0x1783f4;try{const {username:_0x1cb3b3,email:_0x244bb7,role:_0x2b7171}=_0x34f2f1['user'],_0x104dec=_0x34f2f1[_0x320513(0x136)],_0x5e54d8=await profile[_0x320513(0x15e)]({'email':_0x104dec[_0x320513(0xdf)]}),_0xe469d1=await master_shop['find']();console[_0x320513(0x186)]('master',_0xe469d1);const _0x509014=_0x34f2f1[_0x320513(0x12d)]['id'],_0x5a4a43=await adjustment_finished['findById']({'_id':_0x509014});let _0x4ff64e=new Date(_0x5a4a43[_0x320513(0x134)]),_0x1c231e=('0'+_0x4ff64e[_0x320513(0x182)]())[_0x320513(0x188)](-0x2),_0x8ee508=('0'+(_0x4ff64e[_0x320513(0x13d)]()+0x1))[_0x320513(0x188)](-0x2),_0x22d6f6=_0x4ff64e[_0x320513(0xe2)](),_0xf998be=_0x22d6f6+'-'+_0x8ee508+'-'+_0x1c231e;var _0x434040=[_0x320513(0xfc),_0x320513(0x147),_0x320513(0x190)];const _0x5857b5=await purchases[_0x320513(0xf0)]([{'$match':{'warehouse_name':_0x5a4a43[_0x320513(0x16a)]}},{'$unwind':_0x320513(0x123)},{'$group':{'_id':_0x320513(0x155)}}]);console[_0x320513(0x186)](_0x320513(0x150),_0x5857b5);const _0x5130ac=await product[_0x320513(0x177)]({}),_0x42270f=await warehouse['aggregate']([{'$match':{'name':_0x5a4a43[_0x320513(0x16a)],'room':_0x5a4a43[_0x320513(0x118)]}},{'$unwind':_0x320513(0x142)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x320513(0x107)},'product_stock':{'$first':_0x320513(0x104)},'bay':{'$first':_0x320513(0x101)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x320513(0xf3)},'primary_code':{'$first':_0x320513(0x165)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x320513(0x103)},'storage':{'$first':_0x320513(0x16b)},'rack':{'$first':'$product_details.rack'}}}]);if(_0xe469d1[0x0]['language']==_0x320513(0x151)){var _0x58b911=users[_0x320513(0x13e)];console[_0x320513(0x186)](_0x58b911);}else{if(_0xe469d1[0x0][_0x320513(0x11d)]==_0x320513(0x145))var _0x58b911=users[_0x320513(0x145)];else{if(_0xe469d1[0x0]['language']=='German')var _0x58b911=users[_0x320513(0x183)];else{if(_0xe469d1[0x0][_0x320513(0x11d)]==_0x320513(0xe5))var _0x58b911=users[_0x320513(0xe5)];else{if(_0xe469d1[0x0][_0x320513(0x11d)]==_0x320513(0x169))var _0x58b911=users[_0x320513(0x169)];else{if(_0xe469d1[0x0][_0x320513(0x11d)]=='Portuguese\x20(BR)')var _0x58b911=users['Portuguese'];else{if(_0xe469d1[0x0][_0x320513(0x11d)]=='Chinese')var _0x58b911=users['Chinese'];else{if(_0xe469d1[0x0]['language']=='Arabic\x20(ae)')var _0x58b911=users['Arabic'];}}}}}}}_0x4144[_0x320513(0x170)]('edit_adjustment_finished',{'success':_0x34f2f1[_0x320513(0x129)](_0x320513(0x13f)),'errors':_0x34f2f1[_0x320513(0x129)](_0x320513(0x11c)),'role':_0x104dec,'profile':_0x5e54d8,'adjustment':_0x5a4a43,'stock':_0x42270f,'master_shop':_0xe469d1,'warehouse_name':_0x5857b5,'unit':_0x5130ac,'language':_0x58b911,'rooms_data':_0x434040,'ed_fullDate':_0xf998be});}catch(_0xdc776b){console[_0x320513(0x186)](_0xdc776b),_0x4144[_0x320513(0x14f)](0xc8)[_0x320513(0x117)]({'message':_0xdc776b['message']});}}),router[a0_0x1783f4(0x116)](a0_0x1783f4(0xf8),auth,async(_0x20d690,_0x2d128c)=>{var _0x23a2ed=a0_0x1783f4;try{const _0xe72766=_0x20d690['params']['id'],_0xfd4c19=await adjustment_finished[_0x23a2ed(0x15f)]({'_id':_0xe72766}),_0x1524b1=await warehouse[_0x23a2ed(0x15e)]({'name':_0xfd4c19[_0x23a2ed(0x16a)],'room':_0xfd4c19['room']}),{warehouse_name:_0x58f994,date:_0x1c503a,prod_name:_0x8eef2b,level:_0x4b84f4,isle:_0xfaff86,pallet:_0x23a58d,stock:_0x24dd60,types:_0x221ca9,adjust_qty:_0x53e490,new_adjust_qty:_0x13924e,note:_0x2a1aee,Room_name:_0x5622f1,invoice:_0x3ab7c4,JO_number:_0x398269}=_0x20d690['body'];if(typeof _0x8eef2b==_0x23a2ed(0x121))var _0x346c2f=[_0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0xe4)]],_0x3ed8c9=[_0x20d690[_0x23a2ed(0x10d)]['level']],_0x3d575c=[_0x20d690[_0x23a2ed(0x10d)]['stock']],_0x4483bb=[_0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0x167)]],_0x2dfb10=[_0x20d690[_0x23a2ed(0x10d)]['adjust_qty']],_0x20dc44=[_0x20d690['body']['new_adjust_qty']],_0x3e62f6=[_0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0xe1)]],_0x4d8351=[_0x20d690[_0x23a2ed(0x10d)]['unit']],_0x4885a4=[_0x20d690['body'][_0x23a2ed(0x17d)]],_0x4b7a52=[_0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0x105)]],_0xa514f5=[_0x20d690[_0x23a2ed(0x10d)]['expiry_date']];else var _0x346c2f=[..._0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0xe4)]],_0x3ed8c9=[..._0x20d690[_0x23a2ed(0x10d)]['level']],_0x3d575c=[..._0x20d690[_0x23a2ed(0x10d)]['stock']],_0x4483bb=[..._0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0x167)]],_0x2dfb10=[..._0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0xfa)]],_0x20dc44=[..._0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0xf4)]],_0x3e62f6=[..._0x20d690[_0x23a2ed(0x10d)]['prod_code']],_0x4d8351=[..._0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0xe9)]],_0x4885a4=[..._0x20d690[_0x23a2ed(0x10d)]['Secondary_units']],_0x4b7a52=[..._0x20d690[_0x23a2ed(0x10d)][_0x23a2ed(0x105)]],_0xa514f5=[..._0x20d690['body']['expiry_date']];const _0xf9031b=_0x346c2f[_0x23a2ed(0x160)](_0x5c63fb=>{return _0x5c63fb={'product_name':_0x5c63fb};});_0x3ed8c9[_0x23a2ed(0x131)]((_0x3049d1,_0x4a3408)=>{_0xf9031b[_0x4a3408]['bay']=_0x3049d1;}),_0x3d575c[_0x23a2ed(0x131)]((_0x27f038,_0x5cc1d1)=>{var _0x375ca0=_0x23a2ed;_0xf9031b[_0x5cc1d1][_0x375ca0(0xf2)]=_0x27f038;}),_0x4483bb[_0x23a2ed(0x131)]((_0x42bb25,_0x237d2d)=>{_0xf9031b[_0x237d2d]['types']=_0x42bb25;}),_0x2dfb10[_0x23a2ed(0x131)]((_0x357176,_0x1a20a0)=>{var _0x489402=_0x23a2ed;_0xf9031b[_0x1a20a0][_0x489402(0xfa)]=_0x357176;}),_0x20dc44[_0x23a2ed(0x131)]((_0x4279c6,_0x252c2f)=>{_0xf9031b[_0x252c2f]['new_adjust_qty']=_0x4279c6;}),_0x4d8351[_0x23a2ed(0x131)]((_0x328013,_0x1cb3e9)=>{var _0xfab39e=_0x23a2ed;_0xf9031b[_0x1cb3e9][_0xfab39e(0xe9)]=_0x328013;}),_0x4885a4[_0x23a2ed(0x131)]((_0x1649fd,_0x3a8632)=>{_0xf9031b[_0x3a8632]['secondary_unit']=_0x1649fd;}),_0x3e62f6[_0x23a2ed(0x131)]((_0x32b524,_0x1f24a8)=>{_0xf9031b[_0x1f24a8]['product_code']=_0x32b524;}),_0x4b7a52[_0x23a2ed(0x131)]((_0x193320,_0x16819d)=>{_0xf9031b[_0x16819d]['batch_code']=_0x193320;}),_0xa514f5[_0x23a2ed(0x131)]((_0x41b3f4,_0x886b0b)=>{_0xf9031b[_0x886b0b]['expiry_date']=_0x41b3f4;});const _0x5b79de=_0xf9031b[_0x23a2ed(0xff)](_0x3cec30=>_0x3cec30[_0x23a2ed(0xfa)]!=='0'&&_0x3cec30[_0x23a2ed(0xfa)]!=='');var _0x4ece74=0x0;_0x5b79de[_0x23a2ed(0x131)](_0x52573e=>{var _0x502591=_0x23a2ed;console['log'](_0x502591(0xef),_0x52573e),parseInt(_0x52573e[_0x502591(0xfa)])<=0x0&&_0x4ece74++;});if(_0x4ece74!=0x0)return _0x20d690['flash'](_0x23a2ed(0x11c),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x2d128c[_0x23a2ed(0x11f)](_0x23a2ed(0x179));_0xfd4c19[_0x23a2ed(0x16a)]=_0x58f994,_0xfd4c19[_0x23a2ed(0x17c)]=_0x1c503a,_0xfd4c19['product']=_0x5b79de,_0xfd4c19[_0x23a2ed(0x146)]=_0x2a1aee,_0xfd4c19[_0x23a2ed(0x118)]=_0x5622f1,_0xfd4c19[_0x23a2ed(0x180)]=_0x3ab7c4,_0xfd4c19[_0x23a2ed(0x171)]=_0x398269;const _0x18e380=await _0xfd4c19[_0x23a2ed(0xdd)](),_0xde1060=await warehouse['findOne']({'name':_0x58f994,'room':_0x5622f1});_0x18e380['product'][_0x23a2ed(0x131)](_0x9d6d84=>{var _0x9f4fa1=_0x23a2ed;const _0x3da93c=_0xde1060[_0x9f4fa1(0x15b)][_0x9f4fa1(0x160)](_0xb5d025=>{var _0x4cf2c0=_0x9f4fa1;_0x9d6d84[_0x4cf2c0(0x167)]==_0x4cf2c0(0x133)?_0xb5d025[_0x4cf2c0(0x173)]==_0x9d6d84[_0x4cf2c0(0x173)]&&_0xb5d025['bay']==_0x9d6d84[_0x4cf2c0(0x184)]&&(_0xb5d025[_0x4cf2c0(0x10c)]=parseInt(_0xb5d025[_0x4cf2c0(0x10c)])-parseInt(_0x9d6d84[_0x4cf2c0(0xfa)])):_0xb5d025[_0x4cf2c0(0x173)]==_0x9d6d84[_0x4cf2c0(0x173)]&&_0xb5d025[_0x4cf2c0(0x184)]==_0x9d6d84['bay']&&(_0xb5d025[_0x4cf2c0(0x10c)]=parseInt(_0xb5d025['product_stock'])+parseInt(_0x9d6d84[_0x4cf2c0(0xfa)]));});}),await _0xde1060[_0x23a2ed(0xdd)](),_0x20d690['flash'](_0x23a2ed(0x13f),_0x23a2ed(0x12a)),_0x2d128c[_0x23a2ed(0x11f)](_0x23a2ed(0x140));}catch(_0x2a3c28){console['log'](_0x2a3c28);}}),router[a0_0x1783f4(0x116)](a0_0x1783f4(0x10f),async(_0x4e3349,_0x391865)=>{var _0x2ced03=a0_0x1783f4;const {primary_code:_0x8ce323,warehouse_data:_0x5665f7,rooms_data:_0x425dfb,Roomslist:_0x2a1e50}=_0x4e3349[_0x2ced03(0x10d)],_0x511d4c=_0x2a1e50[_0x2ced03(0x12f)](','),_0x455baa=[];async function _0x3cad7b(_0x146420){var _0x3532e7=_0x2ced03;const _0x365e08=await warehouse[_0x3532e7(0xf0)]([{'$match':{'name':_0x5665f7,'room':_0x146420}},{'$unwind':_0x3532e7(0x142)},{'$match':{'product_details.primary_code':_0x8ce323}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3532e7(0x107)},'product_stock':{'$first':_0x3532e7(0x104)},'primary_code':{'$first':_0x3532e7(0x165)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3532e7(0x103)},'level':{'$first':_0x3532e7(0xe3)},'bay':{'$first':'$product_details.bay'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3532e7(0x138)},'secondary_unit':{'$first':_0x3532e7(0x14a)},'storage':{'$first':_0x3532e7(0x16b)},'rack':{'$first':_0x3532e7(0x15d)},'expiry_date':{'$first':_0x3532e7(0x13b)},'production_date':{'$first':_0x3532e7(0x135)},'batch_code':{'$first':_0x3532e7(0x102)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x3532e7(0x11a)},'roomNamed':{'$first':_0x3532e7(0x152)},'invoice':{'$first':_0x3532e7(0x15c)}}}]),_0x204da4=await warehouse[_0x3532e7(0xf0)]([{'$match':{'name':_0x5665f7,'room':_0x146420}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x8ce323}},{'$group':{'_id':_0x3532e7(0x18a),'name':{'$first':_0x3532e7(0x107)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3532e7(0x18b)},'product_code':{'$first':_0x3532e7(0x103)},'level':{'$first':_0x3532e7(0xe3)},'bay':{'$first':_0x3532e7(0x101)},'type':{'$first':_0x3532e7(0x139)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3532e7(0x138)},'secondary_unit':{'$first':_0x3532e7(0x14a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3532e7(0x15d)},'expiry_date':{'$first':_0x3532e7(0x13b)},'production_date':{'$first':_0x3532e7(0x135)},'batch_code':{'$first':_0x3532e7(0x102)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3532e7(0x15c)}}}]);if(_0x365e08['length']>0x0)_0x455baa['push'](_0x365e08);else _0x204da4[_0x3532e7(0x10b)]>0x0&&_0x455baa[_0x3532e7(0xeb)](_0x204da4);}const _0x7ba0e1=_0x511d4c[_0x2ced03(0x160)](_0x5ee18d=>_0x3cad7b(_0x5ee18d));await Promise[_0x2ced03(0x108)](_0x7ba0e1),_0x391865[_0x2ced03(0x117)](_0x455baa);}),router[a0_0x1783f4(0x116)](a0_0x1783f4(0x157),async(_0x5c15a0,_0xa068f7)=>{var _0x564413=a0_0x1783f4;const {productCode:_0x4231d9,bay:_0x31c70d,warehouses:_0xeaa87,room:_0x1a1872}=_0x5c15a0[_0x564413(0x10d)];console[_0x564413(0x186)](_0x5c15a0['body']);try{const _0x107835=await warehouse[_0x564413(0xf0)]([{'$match':{'name':_0xeaa87,'room':_0x1a1872}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x31c70d)}},{'$group':{'_id':_0x564413(0x18a),'name':{'$first':_0x564413(0x107)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x564413(0x10e)}}}]);_0xa068f7['status'](0xc8)['json'](_0x107835);}catch(_0x118bed){_0xa068f7[_0x564413(0x14f)](0x194)[_0x564413(0x117)]({'message':_0x118bed[_0x564413(0x125)]});}}),module[a0_0x1783f4(0xfb)]=router;