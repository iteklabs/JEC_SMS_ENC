function a0_0x3a19(){var _0x233dfb=['toString','$product_details.product_name','LOG-ADJ-','batch_code','/view','An\x20error\x20occurred.','adjustment_finished_logs','$product_details.primary_code','$warehouse_name','Router','product_details','/view/:id','Chinese','$product_details.product_code','match','prod_name','Arabic\x20(ae)','maxPerUnit','Adjustment\x20Finalize\x20Successfully','user','stockBefore','status','Ambient','DRY\x20GOODS','forEach','$product_details.product_stock','$product_details.bin','_id','edit_adjustment_finished_view','back','minus','ADJF-','foreach\x20newproduct','invoice','filter','product','purchases_data','$product_details.production_date','$invoice','Spanish','length','$_id','/CheckingWarehouse','$product_details.bay','$product_details.batch_code','German','adjust_qty','warehouse','../middleware/auth','find','room','catch','findById','prod_cat','all','English','role','master','random','$product_details.level','$name','New_Qty_Converted_adj','findOne','staff','/adjustment/view','Hindi','5721432AXLmNX','body','58906QUvkeu','note','nodemailer','/preview/:id','add_adjustment_finished','aggregate','success','4OdUhtD','render','French','types','post','</td>','English\x20(US)','/adjustment_finished/preview/','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Return\x20Rooms','language','split','$product.product_name','secondary_unit','$room','error','5910002qbIOLc','Primary_Units','stock','push','$product_details.unit','slice','getMonth','$product_details.floorlevel','id_transaction','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.storage','room_names','$product_details.secondary_code','adjustment_finished','date','$product_details.expiry_date','product_stock','get','/picking_list/PDF_adjustmentFinal/','string','level','$product_details.type','unit','getFullYear','Rooms','Arabic','errors','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.invoice','62103jGjoQa','Enabled','Secondary_units','/barcode_scanner','$product_details._id','log','add_adjustment_finished_logs','prod_invoice','product_code','1360554JqqztU','id_transaction_from','Portuguese\x20(BR)','product_date','<tr>','Enclosed','$date','product_name','then','adjustment\x20add\x20successfull','/view/add_adjustment_logs','1843060LULpDk','$product.room_names','invoice_init','$product_details.rack','expiry_date','Portuguese','$product_details.secondary_unit','message','$product','redirect','map','padStart','flash','warehouse_name','$product_details.maxPerUnit','edit_adjustment_finished','email','$finalize','prod_code','params','$product_details','New_Qty_Converted','new_adjust_qty','json','floor','/view/add_adjustment','4201704gwzlvD','production_date','bay','save'];a0_0x3a19=function(){return _0x233dfb;};return a0_0x3a19();}var a0_0x1ab2ad=a0_0x22b0;(function(_0x5e8a22,_0xfddb7b){var _0x4af6f7=a0_0x22b0,_0x57d2e1=_0x5e8a22();while(!![]){try{var _0x1b5f26=-parseInt(_0x4af6f7(0x155))/0x1+-parseInt(_0x4af6f7(0xe8))/0x2+-parseInt(_0x4af6f7(0x189))/0x3*(-parseInt(_0x4af6f7(0x15c))/0x4)+parseInt(_0x4af6f7(0xf3))/0x5+parseInt(_0x4af6f7(0x10d))/0x6+parseInt(_0x4af6f7(0x16c))/0x7+-parseInt(_0x4af6f7(0x153))/0x8;if(_0x1b5f26===_0xfddb7b)break;else _0x57d2e1['push'](_0x57d2e1['shift']());}catch(_0x21c84f){_0x57d2e1['push'](_0x57d2e1['shift']());}}}(a0_0x3a19,0x75121));function a0_0x22b0(_0x395ccd,_0x474f5b){var _0x3a1970=a0_0x3a19();return a0_0x22b0=function(_0x22b018,_0x3db1f8){_0x22b018=_0x22b018-0xe1;var _0x245da5=_0x3a1970[_0x22b018];return _0x245da5;},a0_0x22b0(_0x395ccd,_0x474f5b);}const express=require('express'),app=express(),router=express[a0_0x1ab2ad(0x11a)](),auth=require(a0_0x1ab2ad(0x141)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x1ab2ad(0x157));router[a0_0x1ab2ad(0x17d)](a0_0x1ab2ad(0x115),auth,async(_0x1877ed,_0xd46ece)=>{var _0x39cc7b=a0_0x1ab2ad;try{const {username:_0x46c78e,email:_0x314e67,role:_0x1880f7}=_0x1877ed[_0x39cc7b(0x124)],_0x26e0a7=_0x1877ed[_0x39cc7b(0x124)],_0x945f7f=await profile[_0x39cc7b(0x14f)]({'email':_0x26e0a7[_0x39cc7b(0x103)]}),_0x42e8a2=await master_shop['find']();let _0xb5c36f;if(_0x26e0a7['role']=='staff'){const _0x5c5287=await staff['findOne']({'email':_0x26e0a7[_0x39cc7b(0x103)]});_0xb5c36f=await warehouse['find']({'status':_0x39cc7b(0x18a),'name':_0x5c5287['warehouse']});}else _0xb5c36f=await warehouse['find']({'status':_0x39cc7b(0x18a)});const _0x156f05=await product[_0x39cc7b(0x142)]();let _0x1611dc;if(_0x26e0a7[_0x39cc7b(0x149)]==_0x39cc7b(0x150)){const _0x167827=await staff[_0x39cc7b(0x14f)]({'email':_0x26e0a7[_0x39cc7b(0x103)]});_0x1611dc=await adjustment_finished[_0x39cc7b(0x142)]({'warehouse_name':_0x167827[_0x39cc7b(0x140)]});}else _0x1611dc=await adjustment_finished[_0x39cc7b(0x15a)]([{'$match':{'type_of_transaction':'own'}},{'$unwind':_0x39cc7b(0xfb)},{'$group':{'_id':_0x39cc7b(0x13a),'invoice':{'$first':_0x39cc7b(0x137)},'date':{'$first':_0x39cc7b(0xee)},'warehouse_name':{'$first':_0x39cc7b(0x119)},'room':{'$addToSet':_0x39cc7b(0xf4)},'finalize':{'$first':_0x39cc7b(0x104)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x42e8a2[0x0][_0x39cc7b(0x166)]==_0x39cc7b(0x162)){var _0x40b992=users[_0x39cc7b(0x148)];console[_0x39cc7b(0xe4)](_0x40b992);}else{if(_0x42e8a2[0x0][_0x39cc7b(0x166)]==_0x39cc7b(0x152))var _0x40b992=users[_0x39cc7b(0x152)];else{if(_0x42e8a2[0x0]['language']=='German')var _0x40b992=users[_0x39cc7b(0x13e)];else{if(_0x42e8a2[0x0][_0x39cc7b(0x166)]=='Spanish')var _0x40b992=users[_0x39cc7b(0x138)];else{if(_0x42e8a2[0x0][_0x39cc7b(0x166)]==_0x39cc7b(0x15e))var _0x40b992=users[_0x39cc7b(0x15e)];else{if(_0x42e8a2[0x0][_0x39cc7b(0x166)]==_0x39cc7b(0xea))var _0x40b992=users['Portuguese'];else{if(_0x42e8a2[0x0][_0x39cc7b(0x166)]==_0x39cc7b(0x11d))var _0x40b992=users[_0x39cc7b(0x11d)];else{if(_0x42e8a2[0x0][_0x39cc7b(0x166)]==_0x39cc7b(0x121))var _0x40b992=users[_0x39cc7b(0x185)];}}}}}}}_0xd46ece[_0x39cc7b(0x15d)](_0x39cc7b(0x179),{'success':_0x1877ed[_0x39cc7b(0xff)](_0x39cc7b(0x15b)),'errors':_0x1877ed[_0x39cc7b(0xff)](_0x39cc7b(0x186)),'role':_0x26e0a7,'profile':_0x945f7f,'warehouse':_0xb5c36f,'product':_0x156f05,'adjustment':_0x1611dc,'master_shop':_0x42e8a2,'language':_0x40b992});}catch(_0x7f3616){console['log'](_0x7f3616);}}),router[a0_0x1ab2ad(0x17d)]('/view_logs',auth,async(_0x1acfa4,_0x12530b)=>{var _0x229ead=a0_0x1ab2ad;try{const {username:_0xca87a6,email:_0x5168fa,role:_0x46b983}=_0x1acfa4[_0x229ead(0x124)],_0x25add5=_0x1acfa4[_0x229ead(0x124)],_0x552c21=await profile[_0x229ead(0x14f)]({'email':_0x25add5['email']}),_0x1d617a=await master_shop[_0x229ead(0x142)]();let _0x48dc70;if(_0x25add5[_0x229ead(0x149)]==_0x229ead(0x150)){const _0x3d0096=await staff['findOne']({'email':_0x25add5[_0x229ead(0x103)]});_0x48dc70=await warehouse['find']({'status':'Enabled','name':_0x3d0096[_0x229ead(0x140)]});}else _0x48dc70=await warehouse[_0x229ead(0x142)]({'status':_0x229ead(0x18a)});const _0x419957=await product[_0x229ead(0x142)]();let _0x2e127b;if(_0x25add5[_0x229ead(0x149)]==_0x229ead(0x150)){const _0x26b252=await staff[_0x229ead(0x14f)]({'email':_0x25add5['email']});_0x2e127b=await adjustment_finished['find']({'warehouse_name':_0x26b252['warehouse']});}else _0x2e127b=await adjustment_finished[_0x229ead(0x15a)]([{'$match':{'type_of_transaction':'logs'}},{'$unwind':_0x229ead(0xfb)},{'$group':{'_id':_0x229ead(0x13a),'invoice':{'$first':_0x229ead(0x137)},'date':{'$first':_0x229ead(0xee)},'warehouse_name':{'$first':_0x229ead(0x119)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x229ead(0x104)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1d617a[0x0]['language']==_0x229ead(0x162))var _0x35edd5=users[_0x229ead(0x148)];else{if(_0x1d617a[0x0]['language']==_0x229ead(0x152))var _0x35edd5=users[_0x229ead(0x152)];else{if(_0x1d617a[0x0][_0x229ead(0x166)]==_0x229ead(0x13e))var _0x35edd5=users[_0x229ead(0x13e)];else{if(_0x1d617a[0x0][_0x229ead(0x166)]==_0x229ead(0x138))var _0x35edd5=users[_0x229ead(0x138)];else{if(_0x1d617a[0x0]['language']=='French')var _0x35edd5=users[_0x229ead(0x15e)];else{if(_0x1d617a[0x0]['language']==_0x229ead(0xea))var _0x35edd5=users[_0x229ead(0xf8)];else{if(_0x1d617a[0x0][_0x229ead(0x166)]==_0x229ead(0x11d))var _0x35edd5=users[_0x229ead(0x11d)];else{if(_0x1d617a[0x0]['language']=='Arabic\x20(ae)')var _0x35edd5=users[_0x229ead(0x185)];}}}}}}}_0x12530b[_0x229ead(0x15d)](_0x229ead(0x117),{'success':_0x1acfa4['flash']('success'),'errors':_0x1acfa4['flash']('errors'),'role':_0x25add5,'profile':_0x552c21,'warehouse':_0x48dc70,'product':_0x419957,'adjustment':_0x2e127b,'master_shop':_0x1d617a,'language':_0x35edd5});}catch(_0x4f3732){console[_0x229ead(0xe4)](_0x4f3732);}});async function getRandom8DigitNumber(){var _0x815c35=a0_0x1ab2ad;const _0x393137=0x989680,_0xc0a9e3=0x5f5e0ff,_0x59c8ea=Math[_0x815c35(0x10b)](Math[_0x815c35(0x14b)]()*(_0xc0a9e3-_0x393137+0x1))+_0x393137;var _0x4b06b8;const _0x5561c1=await adjustment_finished[_0x815c35(0x14f)]({'invoice':_0x815c35(0x130)+_0x59c8ea});return _0x5561c1&&_0x5561c1[_0x815c35(0x139)]>0x0?_0x4b06b8=_0x815c35(0x130)+_0x59c8ea:_0x4b06b8=_0x815c35(0x130)+_0x59c8ea,_0x4b06b8;}router[a0_0x1ab2ad(0x17d)](a0_0x1ab2ad(0x10c),auth,async(_0x2bf8ec,_0x14ea2e)=>{var _0x321849=a0_0x1ab2ad;try{const {username:_0x294211,email:_0x2657a2,role:_0x34850d}=_0x2bf8ec[_0x321849(0x124)],_0x286deb=_0x2bf8ec[_0x321849(0x124)],_0x2bc4e8=await profile[_0x321849(0x14f)]({'email':_0x286deb[_0x321849(0x103)]}),_0x22fcac=await master_shop[_0x321849(0x142)]();let _0x59fe1e;if(_0x286deb[_0x321849(0x149)]=='staff'){const _0x57f34c=await staff[_0x321849(0x14f)]({'email':_0x286deb['email']});_0x59fe1e=await warehouse[_0x321849(0x15a)]([{'$match':{'status':'Enabled','name':_0x57f34c['warehouse']}},{'$group':{'_id':_0x321849(0x14d),'name':{'$first':_0x321849(0x14d)}}}]);}else _0x59fe1e=await warehouse[_0x321849(0x15a)]([{'$match':{'status':_0x321849(0x18a)}},{'$group':{'_id':_0x321849(0x14d),'name':{'$first':_0x321849(0x14d)}}}]);const _0x3fce6a=await product[_0x321849(0x142)]({}),_0x112750=await adjustment_finished[_0x321849(0x142)](),_0x2eb462=_0x112750[_0x321849(0x139)]+0x1,_0x52a8d6='ADJF-'+_0x2eb462[_0x321849(0x111)]()[_0x321849(0xfe)](0x5,'0');var _0x3d683b=[_0x321849(0x127),_0x321849(0xed),_0x321849(0x165)];if(_0x22fcac[0x0]['language']=='English\x20(US)')var _0x2e39e0=users[_0x321849(0x148)];else{if(_0x22fcac[0x0][_0x321849(0x166)]==_0x321849(0x152))var _0x2e39e0=users['Hindi'];else{if(_0x22fcac[0x0][_0x321849(0x166)]==_0x321849(0x13e))var _0x2e39e0=users[_0x321849(0x13e)];else{if(_0x22fcac[0x0][_0x321849(0x166)]==_0x321849(0x138))var _0x2e39e0=users[_0x321849(0x138)];else{if(_0x22fcac[0x0]['language']=='French')var _0x2e39e0=users[_0x321849(0x15e)];else{if(_0x22fcac[0x0][_0x321849(0x166)]=='Portuguese\x20(BR)')var _0x2e39e0=users[_0x321849(0xf8)];else{if(_0x22fcac[0x0][_0x321849(0x166)]==_0x321849(0x11d))var _0x2e39e0=users[_0x321849(0x11d)];else{if(_0x22fcac[0x0][_0x321849(0x166)]==_0x321849(0x121))var _0x2e39e0=users[_0x321849(0x185)];}}}}}}}const _0x47bd76=getRandom8DigitNumber();_0x47bd76[_0x321849(0xf0)](_0x5baa7d=>{var _0x52583b=_0x321849;_0x14ea2e[_0x52583b(0x15d)](_0x52583b(0x159),{'success':_0x2bf8ec[_0x52583b(0xff)](_0x52583b(0x15b)),'errors':_0x2bf8ec['flash'](_0x52583b(0x186)),'role':_0x286deb,'profile':_0x2bc4e8,'warehouse':_0x59fe1e,'product':_0x3fce6a,'master_shop':_0x22fcac,'language':_0x2e39e0,'rooms_data':_0x3d683b,'invoice_no':_0x5baa7d});})[_0x321849(0x144)](_0x4f5d9f=>{var _0x1aa979=_0x321849;_0x2bf8ec[_0x1aa979(0xff)](_0x1aa979(0x186),_0x1aa979(0x164)),_0x14ea2e[_0x1aa979(0xfc)](_0x1aa979(0x151));});}catch(_0x3111ac){console[_0x321849(0xe4)](_0x3111ac);}}),router[a0_0x1ab2ad(0x160)](a0_0x1ab2ad(0x10c),auth,async(_0x6c9cfb,_0x1b7ea1)=>{var _0x201ba1=a0_0x1ab2ad;try{const {warehouse_name:_0x3af866,date:_0x36e948,prod_name:_0x59bdea,level:_0x53b4ef,isle:_0x1e5c37,pallet:_0xf7ede0,stock:_0x5e2ecf,types:_0x91e3a0,adjust_qty:_0x204986,new_adjust_qty:_0x900507,note:_0x429f7d,Room_name:_0x5b4fb1,JO_number:_0x483001,expiry_date:_0xf7dc93,PO_number:_0x477081,ReqBy:_0x12b94c,dateofreq:_0x31da5f,typeservicesData:_0x4c694d,destination:_0x37abe1,deliverydate:_0x527caf,driver:_0x5f7904,plate:_0x63e147,van:_0x3282cb,DRSI:_0x1c7934,typevehicle:_0x803ca1,TSU:_0x45810e,TFU:_0x264de8}=_0x6c9cfb[_0x201ba1(0x154)];if(typeof _0x59bdea==_0x201ba1(0x17f))var _0x3423f8=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x120)]],_0x31c6c4=[_0x6c9cfb['body'][_0x201ba1(0x180)]],_0x44865a=[_0x6c9cfb['body'][_0x201ba1(0x16e)]],_0x5f421f=[_0x6c9cfb['body'][_0x201ba1(0x15f)]],_0x4ec3e8=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x14e)]],_0x1a1a74=[_0x6c9cfb['body']['New_Qty_Converted']],_0x5bc38a=[_0x6c9cfb['body'][_0x201ba1(0x16d)]],_0x4b8ac3=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0xe1)]],_0x106c29=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x105)]],_0x3a731f=[_0x6c9cfb['body'][_0x201ba1(0x114)]],_0x2cc779=[_0x6c9cfb[_0x201ba1(0x154)]['expiry_date']],_0x4be0ae=[_0x6c9cfb['body']['product_date']],_0x3ae59a=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x146)]],_0x55a2f2=[_0x6c9cfb[_0x201ba1(0x154)]['Rooms']],_0x21d76a=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x122)]],_0x61433d=[_0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0xe6)]],_0x13bf98=[_0x6c9cfb[_0x201ba1(0x154)]['id_transaction_from']];else var _0x3423f8=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x120)]],_0x31c6c4=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x180)]],_0x44865a=[..._0x6c9cfb['body'][_0x201ba1(0x16e)]],_0x5f421f=[..._0x6c9cfb[_0x201ba1(0x154)]['types']],_0x4ec3e8=[..._0x6c9cfb[_0x201ba1(0x154)]['New_Qty_Converted_adj']],_0x1a1a74=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x108)]],_0x5bc38a=[..._0x6c9cfb[_0x201ba1(0x154)]['Primary_Units']],_0x4b8ac3=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0xe1)]],_0x106c29=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x105)]],_0x3a731f=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x114)]],_0x2cc779=[..._0x6c9cfb[_0x201ba1(0x154)]['expiry_date']],_0x4be0ae=[..._0x6c9cfb['body'][_0x201ba1(0xeb)]],_0x3ae59a=[..._0x6c9cfb['body'][_0x201ba1(0x146)]],_0x55a2f2=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0x184)]],_0x21d76a=[..._0x6c9cfb['body'][_0x201ba1(0x122)]],_0x61433d=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0xe6)]],_0x13bf98=[..._0x6c9cfb[_0x201ba1(0x154)][_0x201ba1(0xe9)]];const _0x3da58d=_0x3423f8[_0x201ba1(0xfd)](_0x3bb6aa=>{return _0x3bb6aa={'product_name':_0x3bb6aa};});_0x31c6c4[_0x201ba1(0x129)]((_0x1a4ef9,_0x86843a)=>{var _0x1a7a4a=_0x201ba1,_0x13f132=_0x1a4ef9[_0x1a7a4a(0x11f)](/[A-Za-z]+/)[0x0],_0xc014b5=parseInt(_0x1a4ef9[_0x1a7a4a(0x11f)](/\d+/)[0x0]);_0x3da58d[_0x86843a][_0x1a7a4a(0x180)]=_0x13f132,_0x3da58d[_0x86843a][_0x1a7a4a(0x10f)]=_0xc014b5;}),_0x13bf98['forEach']((_0x19d2b3,_0x3ceb64)=>{_0x3da58d[_0x3ceb64]['id_transaction']=_0x19d2b3;}),_0x44865a[_0x201ba1(0x129)]((_0x71e133,_0xcbdf84)=>{var _0x493a72=_0x201ba1;_0x3da58d[_0xcbdf84][_0x493a72(0x125)]=_0x71e133;}),_0x5f421f['forEach']((_0x1cbb50,_0x3f5c9d)=>{var _0x20bc99=_0x201ba1;_0x3da58d[_0x3f5c9d][_0x20bc99(0x15f)]=_0x1cbb50;}),_0x4ec3e8[_0x201ba1(0x129)]((_0x5000d5,_0x3e0808)=>{var _0x491534=_0x201ba1;_0x3da58d[_0x3e0808][_0x491534(0x13f)]=_0x5000d5;}),_0x1a1a74[_0x201ba1(0x129)]((_0x19f255,_0x92388a)=>{var _0x479fe6=_0x201ba1;_0x3da58d[_0x92388a][_0x479fe6(0x109)]=_0x19f255;}),_0x5bc38a['forEach']((_0x3c614b,_0x41728f)=>{var _0x16ca1a=_0x201ba1;_0x3da58d[_0x41728f][_0x16ca1a(0x182)]=_0x3c614b;}),_0x4b8ac3[_0x201ba1(0x129)]((_0x4f0d6c,_0x126f26)=>{var _0xef776b=_0x201ba1;_0x3da58d[_0x126f26][_0xef776b(0x169)]=_0x4f0d6c;}),_0x106c29[_0x201ba1(0x129)]((_0x38d987,_0xb42df6)=>{var _0x2099a0=_0x201ba1;_0x3da58d[_0xb42df6][_0x2099a0(0xe7)]=_0x38d987;}),_0x3a731f['forEach']((_0x1285fd,_0x2d2595)=>{var _0x20417c=_0x201ba1;_0x3da58d[_0x2d2595][_0x20417c(0x114)]=_0x1285fd;}),_0x2cc779[_0x201ba1(0x129)]((_0x39cb44,_0x332792)=>{var _0x21a8b4=_0x201ba1;_0x3da58d[_0x332792][_0x21a8b4(0xf7)]=_0x39cb44;}),_0x4be0ae[_0x201ba1(0x129)]((_0xa95a5d,_0x4a8d8c)=>{var _0x3c34e3=_0x201ba1;_0x3da58d[_0x4a8d8c][_0x3c34e3(0x10e)]=_0xa95a5d;}),_0x3ae59a[_0x201ba1(0x129)]((_0x5df342,_0x451116)=>{var _0x44c440=_0x201ba1;_0x3da58d[_0x451116][_0x44c440(0x146)]=_0x5df342;}),_0x55a2f2[_0x201ba1(0x129)]((_0x5bc4d7,_0x3b4bbd)=>{var _0x3b6444=_0x201ba1;_0x3da58d[_0x3b4bbd][_0x3b6444(0x177)]=_0x5bc4d7;}),_0x21d76a[_0x201ba1(0x129)]((_0x412917,_0x13186f)=>{var _0x3518fb=_0x201ba1;_0x3da58d[_0x13186f][_0x3518fb(0x122)]=_0x412917;}),_0x61433d[_0x201ba1(0x129)]((_0x29d8dd,_0x24f919)=>{var _0x1beb5c=_0x201ba1;_0x3da58d[_0x24f919][_0x1beb5c(0x132)]=_0x29d8dd;});const _0x119617=_0x3da58d['filter'](_0x24f2d1=>_0x24f2d1[_0x201ba1(0x13f)]!=='0'&&_0x24f2d1[_0x201ba1(0x13f)]!=='');var _0x563c15=0x0;_0x119617['forEach'](_0x1ebd0f=>{var _0xc3dcde=_0x201ba1;console['log'](_0xc3dcde(0x131),_0x1ebd0f),parseInt(_0x1ebd0f[_0xc3dcde(0x13f)])<=0x0&&_0x563c15++;});if(_0x563c15!=0x0)return _0x6c9cfb[_0x201ba1(0xff)](_0x201ba1(0x186),_0x201ba1(0x175)),_0x1b7ea1[_0x201ba1(0xfc)]('back');const _0x35f17a=new invoice_for_adjustment();await _0x35f17a[_0x201ba1(0x110)]();const _0x4d806f=new adjustment_finished({'warehouse_name':_0x3af866,'date':_0x36e948,'product':_0x119617,'note':_0x429f7d,'room':_0x5b4fb1,'invoice':'ADJ-'+_0x35f17a['invoice_init']['toString']()[_0x201ba1(0xfe)](0x8,'0'),'JO_number':_0x483001,'expiry_date':_0xf7dc93,'PO_number':_0x477081,'RequestedBy':_0x12b94c,'DateofRequest':_0x31da5f,'typeservices':_0x4c694d,'destination':_0x37abe1,'deliverydate':_0x527caf,'driver':_0x5f7904,'plate':_0x63e147,'van':_0x3282cb,'DRSI':_0x1c7934,'typevehicle':_0x803ca1,'TSU':_0x45810e,'TFU':_0x264de8}),_0x2bf5b0=await _0x4d806f['save']();_0x6c9cfb[_0x201ba1(0xff)](_0x201ba1(0x15b),'adjustment\x20add\x20successfull'),_0x1b7ea1[_0x201ba1(0xfc)]('/adjustment_finished/preview/'+_0x2bf5b0[_0x201ba1(0x12c)]);}catch(_0x259d98){console['log'](_0x259d98),_0x1b7ea1['status'](0xc8)[_0x201ba1(0x10a)]({'message':_0x259d98['message']});}}),router['get'](a0_0x1ab2ad(0xf2),auth,async(_0x2dd72f,_0x30e6db)=>{var _0x25ed28=a0_0x1ab2ad;try{const {username:_0x3f1eed,email:_0xc4255f,role:_0x26305e}=_0x2dd72f[_0x25ed28(0x124)],_0x4666ca=_0x2dd72f['user'],_0x17ebfb=await profile[_0x25ed28(0x14f)]({'email':_0x4666ca[_0x25ed28(0x103)]}),_0x4d63c2=await master_shop['find']();let _0x3eae58;if(_0x4666ca[_0x25ed28(0x149)]==_0x25ed28(0x150)){const _0x5102a6=await staff[_0x25ed28(0x14f)]({'email':_0x4666ca[_0x25ed28(0x103)]});_0x3eae58=await warehouse[_0x25ed28(0x15a)]([{'$match':{'status':_0x25ed28(0x18a),'name':_0x5102a6[_0x25ed28(0x140)]}},{'$group':{'_id':_0x25ed28(0x14d),'name':{'$first':_0x25ed28(0x14d)}}}]);}else _0x3eae58=await warehouse[_0x25ed28(0x15a)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x25ed28(0x14d),'name':{'$first':_0x25ed28(0x14d)}}}]);const _0x27616d=await product[_0x25ed28(0x142)](),_0x4242a4=await adjustment_finished[_0x25ed28(0x142)](),_0x1b60d4=_0x4242a4[_0x25ed28(0x139)]+0x1,_0x39f4e2=_0x25ed28(0x130)+_0x1b60d4[_0x25ed28(0x111)]()['padStart'](0x5,'0');var _0x18a85c=[_0x25ed28(0x127),_0x25ed28(0xed),_0x25ed28(0x165)];if(_0x4d63c2[0x0][_0x25ed28(0x166)]==_0x25ed28(0x162))var _0x17fcbf=users[_0x25ed28(0x148)];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]==_0x25ed28(0x152))var _0x17fcbf=users[_0x25ed28(0x152)];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]==_0x25ed28(0x13e))var _0x17fcbf=users['German'];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]=='Spanish')var _0x17fcbf=users[_0x25ed28(0x138)];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]=='French')var _0x17fcbf=users[_0x25ed28(0x15e)];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]==_0x25ed28(0xea))var _0x17fcbf=users[_0x25ed28(0xf8)];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]=='Chinese')var _0x17fcbf=users[_0x25ed28(0x11d)];else{if(_0x4d63c2[0x0][_0x25ed28(0x166)]==_0x25ed28(0x121))var _0x17fcbf=users[_0x25ed28(0x185)];}}}}}}}const _0x3ddb97=getRandom8DigitNumber();_0x3ddb97['then'](_0x151b9c=>{var _0x1cb15d=_0x25ed28;_0x30e6db[_0x1cb15d(0x15d)](_0x1cb15d(0xe5),{'success':_0x2dd72f[_0x1cb15d(0xff)]('success'),'errors':_0x2dd72f[_0x1cb15d(0xff)](_0x1cb15d(0x186)),'role':_0x4666ca,'profile':_0x17ebfb,'warehouse':_0x3eae58,'product':_0x27616d,'master_shop':_0x4d63c2,'language':_0x17fcbf,'rooms_data':_0x18a85c,'invoice_no':_0x151b9c});})[_0x25ed28(0x144)](_0x4e01ff=>{var _0xf4dad=_0x25ed28;_0x2dd72f[_0xf4dad(0xff)]('errors',_0xf4dad(0x164)),_0x30e6db['redirect']('/adjustment/view');});}catch(_0x27f60a){console[_0x25ed28(0xe4)](_0x27f60a);}}),router[a0_0x1ab2ad(0x160)]('/view/add_adjustment_logs',auth,async(_0x25776,_0x26cbd8)=>{var _0x38673d=a0_0x1ab2ad;try{const {warehouse_name:_0x237a10,date:_0xa727ff,prod_name:_0x39eba4,level:_0x376f78,isle:_0x24fb8e,pallet:_0x2e0efb,stock:_0xd4864b,types:_0x1d075b,adjust_qty:_0x48380a,new_adjust_qty:_0x2ee289,note:_0x160b83,Room_name:_0x402701,JO_number:_0x3c52c8,expiry_date:_0xeebbc3,type_of_transaction:_0x3dc047,PO_number:_0x35aed0,ReqBy:_0x587e07,dateofreq:_0x5350ca,typeservicesData:_0x2e4044,destination:_0x3a015d,deliverydate:_0x44ec30,driver:_0x40cf54,plate:_0x1b3e82,van:_0x49f0c3,DRSI:_0x34880a,typevehicle:_0x2bf2e9,TSU:_0x32a0b9,TFU:_0x2167f3}=_0x25776[_0x38673d(0x154)];if(typeof _0x39eba4==_0x38673d(0x17f))var _0x3dcbc0=[_0x25776['body'][_0x38673d(0x120)]],_0x37ef13=[_0x25776['body'][_0x38673d(0x180)]],_0x1b3033=[_0x25776[_0x38673d(0x154)][_0x38673d(0x16e)]],_0x7f42f2=[_0x25776[_0x38673d(0x154)][_0x38673d(0x15f)]],_0x4b5346=[_0x25776[_0x38673d(0x154)][_0x38673d(0x14e)]],_0x47ece4=[_0x25776[_0x38673d(0x154)][_0x38673d(0x108)]],_0x4c1be4=[_0x25776['body'][_0x38673d(0x16d)]],_0x2b317e=[_0x25776[_0x38673d(0x154)][_0x38673d(0xe1)]],_0x1b13ab=[_0x25776[_0x38673d(0x154)]['prod_code']],_0x28840f=[_0x25776[_0x38673d(0x154)][_0x38673d(0x114)]],_0x229844=[_0x25776[_0x38673d(0x154)][_0x38673d(0xf7)]],_0x512998=[_0x25776[_0x38673d(0x154)][_0x38673d(0xeb)]],_0x599934=[_0x25776['body']['prod_cat']],_0x5308b2=[_0x25776[_0x38673d(0x154)][_0x38673d(0x184)]],_0x4dad45=[_0x25776['body'][_0x38673d(0x122)]],_0xb9bbfc=[_0x25776['body'][_0x38673d(0xe6)]],_0x5d0691=[_0x25776[_0x38673d(0x154)]['id_transaction_from']];else var _0x3dcbc0=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x120)]],_0x37ef13=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x180)]],_0x1b3033=[..._0x25776[_0x38673d(0x154)]['stock']],_0x7f42f2=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x15f)]],_0x4b5346=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x14e)]],_0x47ece4=[..._0x25776['body'][_0x38673d(0x108)]],_0x4c1be4=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x16d)]],_0x2b317e=[..._0x25776[_0x38673d(0x154)]['Secondary_units']],_0x1b13ab=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x105)]],_0x28840f=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x114)]],_0x229844=[..._0x25776['body'][_0x38673d(0xf7)]],_0x512998=[..._0x25776['body'][_0x38673d(0xeb)]],_0x599934=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x146)]],_0x5308b2=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x184)]],_0x4dad45=[..._0x25776[_0x38673d(0x154)][_0x38673d(0x122)]],_0xb9bbfc=[..._0x25776[_0x38673d(0x154)][_0x38673d(0xe6)]],_0x5d0691=[..._0x25776['body']['id_transaction_from']];const _0x553bed=_0x3dcbc0[_0x38673d(0xfd)](_0x292874=>{return _0x292874={'product_name':_0x292874};});_0x37ef13[_0x38673d(0x129)]((_0x219b8c,_0x46948c)=>{var _0x2c0794=_0x38673d,_0x51b0f3=_0x219b8c[_0x2c0794(0x11f)](/[A-Za-z]+/)[0x0],_0x5686d1=parseInt(_0x219b8c[_0x2c0794(0x11f)](/\d+/)[0x0]);_0x553bed[_0x46948c][_0x2c0794(0x180)]=_0x51b0f3,_0x553bed[_0x46948c][_0x2c0794(0x10f)]=_0x5686d1;}),_0x5d0691['forEach']((_0x5b5216,_0x2d27fe)=>{var _0x544488=_0x38673d;_0x553bed[_0x2d27fe][_0x544488(0x174)]=_0x5b5216;}),_0x1b3033['forEach']((_0xb88a07,_0x2dc378)=>{var _0x41b3d7=_0x38673d;_0x553bed[_0x2dc378][_0x41b3d7(0x125)]=_0xb88a07;}),_0x7f42f2['forEach']((_0x15bfb5,_0x166123)=>{var _0xee11b0=_0x38673d;_0x553bed[_0x166123][_0xee11b0(0x15f)]=_0x15bfb5;}),_0x4b5346[_0x38673d(0x129)]((_0x3b9149,_0x97cc81)=>{var _0x3a7232=_0x38673d;_0x553bed[_0x97cc81][_0x3a7232(0x13f)]=_0x3b9149;}),_0x47ece4['forEach']((_0x576da8,_0x318cf7)=>{var _0x538e40=_0x38673d;_0x553bed[_0x318cf7][_0x538e40(0x109)]=_0x576da8;}),_0x4c1be4[_0x38673d(0x129)]((_0x412df3,_0x1257ae)=>{var _0x33cafb=_0x38673d;_0x553bed[_0x1257ae][_0x33cafb(0x182)]=_0x412df3;}),_0x2b317e[_0x38673d(0x129)]((_0xfa5656,_0x2b43b5)=>{_0x553bed[_0x2b43b5]['secondary_unit']=_0xfa5656;}),_0x1b13ab['forEach']((_0x54caba,_0x3d0c3d)=>{var _0x3b3d09=_0x38673d;_0x553bed[_0x3d0c3d][_0x3b3d09(0xe7)]=_0x54caba;}),_0x28840f[_0x38673d(0x129)]((_0x5a216a,_0x5ac60b)=>{var _0x32b303=_0x38673d;_0x553bed[_0x5ac60b][_0x32b303(0x114)]=_0x5a216a;}),_0x229844['forEach']((_0x42850f,_0x355a08)=>{var _0x1829ac=_0x38673d;_0x553bed[_0x355a08][_0x1829ac(0xf7)]=_0x42850f;}),_0x512998['forEach']((_0x540b94,_0x4de5b5)=>{var _0x5e86c0=_0x38673d;_0x553bed[_0x4de5b5][_0x5e86c0(0x10e)]=_0x540b94;}),_0x599934['forEach']((_0x29fd2b,_0x4b367a)=>{_0x553bed[_0x4b367a]['prod_cat']=_0x29fd2b;}),_0x5308b2[_0x38673d(0x129)]((_0x55b6a8,_0x408565)=>{_0x553bed[_0x408565]['room_names']=_0x55b6a8;}),_0x4dad45[_0x38673d(0x129)]((_0x848e01,_0xfa473f)=>{var _0xc36434=_0x38673d;_0x553bed[_0xfa473f][_0xc36434(0x122)]=_0x848e01;}),_0xb9bbfc[_0x38673d(0x129)]((_0x182cd3,_0x56da29)=>{var _0xe55497=_0x38673d;_0x553bed[_0x56da29][_0xe55497(0x132)]=_0x182cd3;});const _0x2a62e1=_0x553bed[_0x38673d(0x133)](_0x2ef07f=>_0x2ef07f[_0x38673d(0x13f)]!=='0'&&_0x2ef07f[_0x38673d(0x13f)]!=='');var _0x1288c2=0x0;_0x2a62e1['forEach'](_0x158a37=>{var _0x3f2c67=_0x38673d;console[_0x3f2c67(0xe4)](_0x3f2c67(0x131),_0x158a37),parseInt(_0x158a37['adjust_qty'])<=0x0&&_0x1288c2++;});if(_0x1288c2!=0x0)return _0x25776[_0x38673d(0xff)](_0x38673d(0x186),_0x38673d(0x175)),_0x26cbd8['redirect'](_0x38673d(0x12e));const _0x17202d=new adjustment_logs();await _0x17202d[_0x38673d(0x110)]();const _0x53c2fb=new adjustment_finished({'warehouse_name':_0x237a10,'date':_0xa727ff,'product':_0x2a62e1,'note':_0x160b83,'room':_0x402701,'invoice':_0x38673d(0x113)+_0x17202d[_0x38673d(0xf5)][_0x38673d(0x111)]()[_0x38673d(0xfe)](0x8,'0'),'JO_number':_0x3c52c8,'expiry_date':_0xeebbc3,'type_of_transaction':_0x3dc047,'PO_number':_0x35aed0,'RequestedBy':_0x587e07,'DateofRequest':_0x5350ca,'typeservices':_0x2e4044,'destination':_0x3a015d,'deliverydate':_0x44ec30,'driver':_0x40cf54,'plate':_0x1b3e82,'van':_0x49f0c3,'DRSI':_0x34880a,'typevehicle':_0x2bf2e9,'TSU':_0x32a0b9,'TFU':_0x2167f3}),_0x1f4ac4=await _0x53c2fb[_0x38673d(0x110)]();_0x25776[_0x38673d(0xff)](_0x38673d(0x15b),_0x38673d(0xf1)),_0x26cbd8[_0x38673d(0xfc)](_0x38673d(0x163)+_0x1f4ac4['_id']);}catch(_0x985f69){console[_0x38673d(0xe4)](_0x985f69),_0x26cbd8[_0x38673d(0x126)](0xc8)[_0x38673d(0x10a)]({'message':_0x985f69[_0x38673d(0xfa)]});}}),router[a0_0x1ab2ad(0x17d)](a0_0x1ab2ad(0x158),auth,async(_0x292812,_0x1b570c)=>{var _0x1786e8=a0_0x1ab2ad;try{const {username:_0x3d0ca3,email:_0x30e683,role:_0x420d71}=_0x292812[_0x1786e8(0x124)],_0x48f18c=_0x292812[_0x1786e8(0x124)],_0x497ff7=await profile[_0x1786e8(0x14f)]({'email':_0x48f18c[_0x1786e8(0x103)]}),_0x58f87b=await master_shop['find'](),_0x2a3aa1=_0x292812[_0x1786e8(0x106)]['id'],_0x3fd5be=await adjustment_finished['findById']({'_id':_0x2a3aa1}),_0x273331=await purchases[_0x1786e8(0x15a)]([{'$match':{'warehouse_name':_0x3fd5be['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0x1786e8(0x168)}}]);console[_0x1786e8(0xe4)](_0x1786e8(0x135),_0x273331);const _0x1f4621=await product['find']({}),_0x789150=await warehouse[_0x1786e8(0x15a)]([{'$match':{'name':_0x3fd5be[_0x1786e8(0x100)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1786e8(0x112)},'product_stock':{'$first':_0x1786e8(0x12a)},'bay':{'$first':_0x1786e8(0x13c)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1786e8(0x173)},'primary_code':{'$first':_0x1786e8(0x118)},'secondary_code':{'$first':_0x1786e8(0x178)},'product_code':{'$first':_0x1786e8(0x11e)},'storage':{'$first':_0x1786e8(0x176)},'rack':{'$first':_0x1786e8(0xf6)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1786e8(0x136)},'batch_code':{'$first':_0x1786e8(0x13d)},'maxPerUnit':{'$first':_0x1786e8(0x101)},'room':{'$first':_0x1786e8(0x16a)}}}]);if(_0x58f87b[0x0][_0x1786e8(0x166)]==_0x1786e8(0x162)){var _0x4693af=users['English'];console[_0x1786e8(0xe4)](_0x4693af);}else{if(_0x58f87b[0x0][_0x1786e8(0x166)]==_0x1786e8(0x152))var _0x4693af=users[_0x1786e8(0x152)];else{if(_0x58f87b[0x0][_0x1786e8(0x166)]==_0x1786e8(0x13e))var _0x4693af=users[_0x1786e8(0x13e)];else{if(_0x58f87b[0x0][_0x1786e8(0x166)]==_0x1786e8(0x138))var _0x4693af=users[_0x1786e8(0x138)];else{if(_0x58f87b[0x0]['language']==_0x1786e8(0x15e))var _0x4693af=users[_0x1786e8(0x15e)];else{if(_0x58f87b[0x0][_0x1786e8(0x166)]==_0x1786e8(0xea))var _0x4693af=users['Portuguese'];else{if(_0x58f87b[0x0][_0x1786e8(0x166)]==_0x1786e8(0x11d))var _0x4693af=users[_0x1786e8(0x11d)];else{if(_0x58f87b[0x0]['language']=='Arabic\x20(ae)')var _0x4693af=users['Arabic'];}}}}}}}_0x1b570c[_0x1786e8(0x15d)](_0x1786e8(0x12d),{'success':_0x292812[_0x1786e8(0xff)](_0x1786e8(0x15b)),'errors':_0x292812['flash'](_0x1786e8(0x186)),'role':_0x48f18c,'profile':_0x497ff7,'adjustment':_0x3fd5be,'stock':_0x789150,'master_shop':_0x58f87b,'warehouse_name':_0x273331,'unit':_0x1f4621,'language':_0x4693af});}catch(_0x4003b7){console['log'](_0x4003b7),_0x1b570c[_0x1786e8(0x126)](0xc8)[_0x1786e8(0x10a)]({'message':_0x4003b7[_0x1786e8(0xfa)]});}}),router[a0_0x1ab2ad(0x160)]('/preview/:id',auth,async(_0x410a01,_0xf58106)=>{var _0x495557=a0_0x1ab2ad;try{const {invoice:_0x1d04f3,warehouse_name:_0x250d06,Room_name:_0x504dc5}=_0x410a01[_0x495557(0x154)],_0x21be8b=_0x410a01[_0x495557(0x106)]['id'],_0x4e5172=await adjustment_finished['findById']({'_id':_0x21be8b});var _0x4cf721;const _0x527f6b=_0x4e5172['product'][_0x495557(0xfd)](async _0xfec816=>{var _0x40ceb3=_0x495557;if(_0xfec816[_0x40ceb3(0x13f)]>0x0){_0x4cf721=await warehouse[_0x40ceb3(0x14f)]({'name':_0x250d06,'room':_0xfec816[_0x40ceb3(0x177)]});const _0x318aab=_0x4cf721[_0x40ceb3(0x11b)][_0x40ceb3(0xfd)](_0x4d720b=>{var _0x375dc3=_0x40ceb3;console[_0x375dc3(0xe4)](_0xfec816[_0x375dc3(0x15f)]);if(_0xfec816[_0x375dc3(0x15f)]==_0x375dc3(0x12f))_0x4d720b[_0x375dc3(0x12c)]==_0xfec816[_0x375dc3(0x174)]&&(_0x4d720b[_0x375dc3(0x17c)]=_0x4d720b[_0x375dc3(0x17c)]-_0xfec816[_0x375dc3(0x13f)]);else _0xfec816[_0x375dc3(0x15f)]=='add'&&(_0x4d720b[_0x375dc3(0x12c)]==_0xfec816['id_transaction']&&(_0x4d720b['product_stock']=_0x4d720b['product_stock']+_0xfec816[_0x375dc3(0x13f)]));});}return _0x4cf721;});Promise[_0x495557(0x147)](_0x527f6b)[_0x495557(0xf0)](async _0x49a99b=>{var _0xe99751=_0x495557;try{for(const _0x3221ff of _0x49a99b){await _0x3221ff[_0xe99751(0x110)]();}_0x4e5172['finalize']='True';const _0x4a2224=await _0x4e5172[_0xe99751(0x110)](),_0x9bd70a=await master_shop[_0xe99751(0x142)](),_0x58e283=await email_settings[_0xe99751(0x14f)](),_0x583ee7=await supervisor_settings[_0xe99751(0x142)]();var _0x2f6592=_0x4e5172['product'],_0x392e48='',_0x149696;for(_0x149696 in _0x2f6592){var _0x2167a5='FG';_0x4e5172['warehouse_name']==_0xe99751(0x128)&&(_0x2167a5='DG'),_0x392e48+=_0xe99751(0xec)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f6592[_0x149696][_0xe99751(0xef)]+_0xe99751(0x161)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f6592[_0x149696]['product_code']+_0xe99751(0x161)+_0xe99751(0x187)+_0x2f6592[_0x149696][_0xe99751(0x13f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f6592[_0x149696]['unit']+_0xe99751(0x161)+_0xe99751(0x187)+_0x2f6592[_0x149696]['secondary_unit']+_0xe99751(0x161)+_0xe99751(0x187)+_0x4e5172[_0xe99751(0x100)]+_0xe99751(0x161)+_0xe99751(0x187)+_0x2f6592[_0x149696]['room_names']+_0xe99751(0x161)+_0xe99751(0x187)+_0x2167a5+_0x2f6592[_0x149696][_0xe99751(0x10f)]+_0xe99751(0x161)+'</tr>';}_0x410a01[_0xe99751(0xff)](_0xe99751(0x15b),_0xe99751(0x123)),_0xf58106[_0xe99751(0xfc)](_0xe99751(0x17e)+_0x4a2224['_id']);}catch(_0xca5f5b){console['error'](_0xca5f5b),_0xf58106[_0xe99751(0x126)](0x1f4)[_0xe99751(0x10a)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x495557(0x144)](_0x568cad=>{var _0x25cecc=_0x495557;console[_0x25cecc(0x16b)](_0x568cad),_0xf58106['status'](0x1f4)[_0x25cecc(0x10a)]({'error':_0x25cecc(0x116)});});}catch(_0x3feea7){_0xf58106[_0x495557(0x10a)]({'message':_0x3feea7['message']});}}),router['get'](a0_0x1ab2ad(0x11c),auth,async(_0x5ebfa9,_0x500b2c)=>{var _0x5c7a11=a0_0x1ab2ad;try{const {username:_0x42c140,email:_0x49a9d7,role:_0x4226ce}=_0x5ebfa9[_0x5c7a11(0x124)],_0x3e86bb=_0x5ebfa9['user'],_0x1132d2=await profile[_0x5c7a11(0x14f)]({'email':_0x3e86bb['email']}),_0x5dbc6b=await master_shop[_0x5c7a11(0x142)]();console[_0x5c7a11(0xe4)](_0x5c7a11(0x14a),_0x5dbc6b);const _0xea1e6f=_0x5ebfa9[_0x5c7a11(0x106)]['id'],_0x1cd585=await adjustment_finished['findById']({'_id':_0xea1e6f});let _0x2dad48=new Date(_0x1cd585['expiry_date']),_0x3f1c5d=('0'+_0x2dad48['getDate']())[_0x5c7a11(0x171)](-0x2),_0x8389d8=('0'+(_0x2dad48[_0x5c7a11(0x172)]()+0x1))[_0x5c7a11(0x171)](-0x2),_0x259f74=_0x2dad48[_0x5c7a11(0x183)](),_0x41478b=_0x259f74+'-'+_0x8389d8+'-'+_0x3f1c5d;var _0x17b641=[_0x5c7a11(0x127),_0x5c7a11(0xed),_0x5c7a11(0x165)];const _0x145eea=await purchases[_0x5c7a11(0x15a)]([{'$match':{'warehouse_name':_0x1cd585[_0x5c7a11(0x100)]}},{'$unwind':_0x5c7a11(0xfb)},{'$group':{'_id':_0x5c7a11(0x168)}}]);console[_0x5c7a11(0xe4)]('purchases_data',_0x145eea);const _0x4df138=await product['find']({}),_0x3bb2b7=await warehouse['aggregate']([{'$match':{'name':_0x1cd585['warehouse_name'],'room':_0x1cd585['room']}},{'$unwind':_0x5c7a11(0x107)},{'$group':{'_id':_0x5c7a11(0xe3),'name':{'$first':_0x5c7a11(0x112)},'product_stock':{'$first':_0x5c7a11(0x12a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5c7a11(0x12b)},'type':{'$first':_0x5c7a11(0x181)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5c7a11(0x118)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5c7a11(0xf6)}}}]);if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]==_0x5c7a11(0x162)){var _0x10510e=users[_0x5c7a11(0x148)];console[_0x5c7a11(0xe4)](_0x10510e);}else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]==_0x5c7a11(0x152))var _0x10510e=users[_0x5c7a11(0x152)];else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]=='German')var _0x10510e=users[_0x5c7a11(0x13e)];else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]==_0x5c7a11(0x138))var _0x10510e=users[_0x5c7a11(0x138)];else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]==_0x5c7a11(0x15e))var _0x10510e=users[_0x5c7a11(0x15e)];else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]==_0x5c7a11(0xea))var _0x10510e=users[_0x5c7a11(0xf8)];else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]=='Chinese')var _0x10510e=users[_0x5c7a11(0x11d)];else{if(_0x5dbc6b[0x0][_0x5c7a11(0x166)]==_0x5c7a11(0x121))var _0x10510e=users[_0x5c7a11(0x185)];}}}}}}}_0x500b2c['render'](_0x5c7a11(0x102),{'success':_0x5ebfa9[_0x5c7a11(0xff)]('success'),'errors':_0x5ebfa9[_0x5c7a11(0xff)](_0x5c7a11(0x186)),'role':_0x3e86bb,'profile':_0x1132d2,'adjustment':_0x1cd585,'stock':_0x3bb2b7,'master_shop':_0x5dbc6b,'warehouse_name':_0x145eea,'unit':_0x4df138,'language':_0x10510e,'rooms_data':_0x17b641,'ed_fullDate':_0x41478b});}catch(_0x20e39d){console[_0x5c7a11(0xe4)](_0x20e39d),_0x500b2c['status'](0xc8)[_0x5c7a11(0x10a)]({'message':_0x20e39d['message']});}}),router['post'](a0_0x1ab2ad(0x11c),auth,async(_0x8c6033,_0x28a641)=>{var _0x34c5e9=a0_0x1ab2ad;try{const _0x4fa9e4=_0x8c6033['params']['id'],_0x2bde7b=await adjustment_finished[_0x34c5e9(0x145)]({'_id':_0x4fa9e4}),_0x2d0feb=await warehouse['findOne']({'name':_0x2bde7b['warehouse_name'],'room':_0x2bde7b[_0x34c5e9(0x143)]}),{warehouse_name:_0x5a468c,date:_0x49d3c3,prod_name:_0x18ee0c,level:_0x336f36,isle:_0x386cb1,pallet:_0x435907,stock:_0x39e42d,types:_0x11decf,adjust_qty:_0x582a26,new_adjust_qty:_0x12533a,note:_0x45b344,Room_name:_0x2a3ecc,invoice:_0x5c273e,JO_number:_0x5c5c7a}=_0x8c6033[_0x34c5e9(0x154)];if(typeof _0x18ee0c==_0x34c5e9(0x17f))var _0x4c664b=[_0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x120)]],_0x28ad63=[_0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x180)]],_0x3a1738=[_0x8c6033['body'][_0x34c5e9(0x16e)]],_0x399ca7=[_0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x15f)]],_0x1af3ec=[_0x8c6033['body'][_0x34c5e9(0x13f)]],_0x2fde17=[_0x8c6033['body'][_0x34c5e9(0x109)]],_0x25faec=[_0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x105)]],_0x211538=[_0x8c6033[_0x34c5e9(0x154)]['unit']],_0x32f23f=[_0x8c6033[_0x34c5e9(0x154)]['Secondary_units']],_0x29806b=[_0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x114)]],_0x3b108e=[_0x8c6033['body']['expiry_date']];else var _0x4c664b=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x120)]],_0x28ad63=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x180)]],_0x3a1738=[..._0x8c6033[_0x34c5e9(0x154)]['stock']],_0x399ca7=[..._0x8c6033[_0x34c5e9(0x154)]['types']],_0x1af3ec=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x13f)]],_0x2fde17=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x109)]],_0x25faec=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x105)]],_0x211538=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0x182)]],_0x32f23f=[..._0x8c6033[_0x34c5e9(0x154)][_0x34c5e9(0xe1)]],_0x29806b=[..._0x8c6033['body'][_0x34c5e9(0x114)]],_0x3b108e=[..._0x8c6033[_0x34c5e9(0x154)]['expiry_date']];const _0xd72e00=_0x4c664b[_0x34c5e9(0xfd)](_0x57a8e8=>{return _0x57a8e8={'product_name':_0x57a8e8};});_0x28ad63[_0x34c5e9(0x129)]((_0x3e249a,_0x915720)=>{var _0x1d82cb=_0x34c5e9;_0xd72e00[_0x915720][_0x1d82cb(0x10f)]=_0x3e249a;}),_0x3a1738[_0x34c5e9(0x129)]((_0xa5fd75,_0xf9cd27)=>{var _0x330c01=_0x34c5e9;_0xd72e00[_0xf9cd27][_0x330c01(0x125)]=_0xa5fd75;}),_0x399ca7['forEach']((_0xdaa222,_0x552fb5)=>{_0xd72e00[_0x552fb5]['types']=_0xdaa222;}),_0x1af3ec[_0x34c5e9(0x129)]((_0x21bd91,_0x47e2d7)=>{var _0x2bcbfc=_0x34c5e9;_0xd72e00[_0x47e2d7][_0x2bcbfc(0x13f)]=_0x21bd91;}),_0x2fde17[_0x34c5e9(0x129)]((_0x2f5a95,_0x3b50b8)=>{_0xd72e00[_0x3b50b8]['new_adjust_qty']=_0x2f5a95;}),_0x211538[_0x34c5e9(0x129)]((_0x1ee97d,_0x5507ff)=>{_0xd72e00[_0x5507ff]['unit']=_0x1ee97d;}),_0x32f23f['forEach']((_0x57fec1,_0x46844b)=>{var _0x2f7c91=_0x34c5e9;_0xd72e00[_0x46844b][_0x2f7c91(0x169)]=_0x57fec1;}),_0x25faec[_0x34c5e9(0x129)]((_0x3b4597,_0x9b9b05)=>{var _0x3618cb=_0x34c5e9;_0xd72e00[_0x9b9b05][_0x3618cb(0xe7)]=_0x3b4597;}),_0x29806b[_0x34c5e9(0x129)]((_0x262d39,_0x4d90bf)=>{var _0x51a89b=_0x34c5e9;_0xd72e00[_0x4d90bf][_0x51a89b(0x114)]=_0x262d39;}),_0x3b108e[_0x34c5e9(0x129)]((_0x365c07,_0x3fd756)=>{_0xd72e00[_0x3fd756]['expiry_date']=_0x365c07;});const _0x2f2df0=_0xd72e00['filter'](_0x39b305=>_0x39b305[_0x34c5e9(0x13f)]!=='0'&&_0x39b305[_0x34c5e9(0x13f)]!=='');var _0x2852f4=0x0;_0x2f2df0[_0x34c5e9(0x129)](_0x26c7b7=>{var _0xc4f714=_0x34c5e9;console[_0xc4f714(0xe4)](_0xc4f714(0x131),_0x26c7b7),parseInt(_0x26c7b7[_0xc4f714(0x13f)])<=0x0&&_0x2852f4++;});if(_0x2852f4!=0x0)return _0x8c6033[_0x34c5e9(0xff)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x28a641[_0x34c5e9(0xfc)](_0x34c5e9(0x12e));_0x2bde7b[_0x34c5e9(0x100)]=_0x5a468c,_0x2bde7b[_0x34c5e9(0x17a)]=_0x49d3c3,_0x2bde7b[_0x34c5e9(0x134)]=_0x2f2df0,_0x2bde7b[_0x34c5e9(0x156)]=_0x45b344,_0x2bde7b[_0x34c5e9(0x143)]=_0x2a3ecc,_0x2bde7b[_0x34c5e9(0x132)]=_0x5c273e,_0x2bde7b['JO_number']=_0x5c5c7a;const _0x14fe60=await _0x2bde7b['save'](),_0x836a41=await warehouse['findOne']({'name':_0x5a468c,'room':_0x2a3ecc});_0x14fe60[_0x34c5e9(0x134)][_0x34c5e9(0x129)](_0x299d2c=>{var _0x5a5cfb=_0x34c5e9;const _0x53a316=_0x836a41[_0x5a5cfb(0x11b)]['map'](_0x3ee97c=>{var _0x52168d=_0x5a5cfb;_0x299d2c['types']==_0x52168d(0x12f)?_0x3ee97c['product_name']==_0x299d2c['product_name']&&_0x3ee97c[_0x52168d(0x10f)]==_0x299d2c[_0x52168d(0x10f)]&&(_0x3ee97c[_0x52168d(0x17c)]=parseInt(_0x3ee97c[_0x52168d(0x17c)])-parseInt(_0x299d2c[_0x52168d(0x13f)])):_0x3ee97c[_0x52168d(0xef)]==_0x299d2c[_0x52168d(0xef)]&&_0x3ee97c[_0x52168d(0x10f)]==_0x299d2c[_0x52168d(0x10f)]&&(_0x3ee97c[_0x52168d(0x17c)]=parseInt(_0x3ee97c[_0x52168d(0x17c)])+parseInt(_0x299d2c[_0x52168d(0x13f)]));});}),await _0x836a41[_0x34c5e9(0x110)](),_0x8c6033['flash'](_0x34c5e9(0x15b),'adjustment\x20data\x20update\x20successfully'),_0x28a641[_0x34c5e9(0xfc)]('/adjustment_finished/view');}catch(_0x55349f){console[_0x34c5e9(0xe4)](_0x55349f);}}),router[a0_0x1ab2ad(0x160)](a0_0x1ab2ad(0xe2),async(_0x1e6a76,_0x5cb452)=>{var _0x3931f0=a0_0x1ab2ad;const {primary_code:_0x386a76,warehouse_data:_0x9682ff,rooms_data:_0x210d09,Roomslist:_0x9b3be6}=_0x1e6a76[_0x3931f0(0x154)],_0x398103=_0x9b3be6[_0x3931f0(0x167)](','),_0x5c61f4=[];async function _0x3ec394(_0x58ff6b){var _0x56c502=_0x3931f0;const _0x13a97d=await warehouse[_0x56c502(0x15a)]([{'$match':{'name':_0x9682ff,'room':_0x58ff6b}},{'$unwind':_0x56c502(0x107)},{'$match':{'product_details.primary_code':_0x386a76}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x56c502(0x12a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x56c502(0x11e)},'level':{'$first':_0x56c502(0x14c)},'bay':{'$first':_0x56c502(0x13c)},'type':{'$first':_0x56c502(0x181)},'pallet':{'$first':_0x56c502(0x173)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x56c502(0xf9)},'storage':{'$first':_0x56c502(0x176)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x56c502(0x17b)},'production_date':{'$first':_0x56c502(0x136)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x56c502(0x101)},'roomNamed':{'$first':_0x56c502(0x16a)},'invoice':{'$first':_0x56c502(0x188)}}}]),_0x4f24be=await warehouse[_0x56c502(0x15a)]([{'$match':{'name':_0x9682ff,'room':_0x58ff6b}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x386a76}},{'$group':{'_id':_0x56c502(0xe3),'name':{'$first':_0x56c502(0x112)},'product_stock':{'$first':_0x56c502(0x12a)},'primary_code':{'$first':_0x56c502(0x118)},'secondary_code':{'$first':_0x56c502(0x178)},'product_code':{'$first':_0x56c502(0x11e)},'level':{'$first':_0x56c502(0x14c)},'bay':{'$first':'$product_details.bay'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x56c502(0x173)},'unit':{'$first':_0x56c502(0x170)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x56c502(0x176)},'rack':{'$first':_0x56c502(0xf6)},'expiry_date':{'$first':_0x56c502(0x17b)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x56c502(0x13d)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x56c502(0x101)},'roomNamed':{'$first':_0x56c502(0x16a)},'invoice':{'$first':_0x56c502(0x188)}}}]);if(_0x13a97d[_0x56c502(0x139)]>0x0)_0x5c61f4[_0x56c502(0x16f)](_0x13a97d);else _0x4f24be[_0x56c502(0x139)]>0x0&&_0x5c61f4[_0x56c502(0x16f)](_0x4f24be);}const _0x41cc4c=_0x398103[_0x3931f0(0xfd)](_0x16fa38=>_0x3ec394(_0x16fa38));await Promise[_0x3931f0(0x147)](_0x41cc4c),_0x5cb452[_0x3931f0(0x10a)](_0x5c61f4);}),router[a0_0x1ab2ad(0x160)](a0_0x1ab2ad(0x13b),async(_0x324305,_0x5261c5)=>{var _0x20bd67=a0_0x1ab2ad;const {productCode:_0x5475e1,bay:_0x7e6dbc,warehouses:_0x4dfc4e,room:_0x2fc17e}=_0x324305[_0x20bd67(0x154)];console[_0x20bd67(0xe4)](_0x324305[_0x20bd67(0x154)]);try{const _0x49c3c8=await warehouse[_0x20bd67(0x15a)]([{'$match':{'name':_0x4dfc4e,'room':_0x2fc17e}},{'$unwind':_0x20bd67(0x107)},{'$match':{'product_details.bay':parseInt(_0x7e6dbc)}},{'$group':{'_id':_0x20bd67(0xe3),'name':{'$first':_0x20bd67(0x112)},'product_stock':{'$first':_0x20bd67(0x12a)},'bay':{'$first':_0x20bd67(0x13c)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x5261c5[_0x20bd67(0x126)](0xc8)[_0x20bd67(0x10a)](_0x49c3c8);}catch(_0x4241f4){_0x5261c5[_0x20bd67(0x126)](0x194)[_0x20bd67(0x10a)]({'message':_0x4241f4[_0x20bd67(0xfa)]});}}),module['exports']=router;