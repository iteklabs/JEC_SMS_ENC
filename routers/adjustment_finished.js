var a0_0x2caa7d=a0_0x3928;(function(_0x46771e,_0x4ccc42){var _0xffae1=a0_0x3928,_0x40d2f3=_0x46771e();while(!![]){try{var _0x1f0a1c=-parseInt(_0xffae1(0x213))/0x1+parseInt(_0xffae1(0x253))/0x2*(parseInt(_0xffae1(0x221))/0x3)+-parseInt(_0xffae1(0x1b1))/0x4*(-parseInt(_0xffae1(0x220))/0x5)+parseInt(_0xffae1(0x23e))/0x6+parseInt(_0xffae1(0x1fd))/0x7*(parseInt(_0xffae1(0x260))/0x8)+-parseInt(_0xffae1(0x249))/0x9+-parseInt(_0xffae1(0x1bb))/0xa*(parseInt(_0xffae1(0x1f2))/0xb);if(_0x1f0a1c===_0x4ccc42)break;else _0x40d2f3['push'](_0x40d2f3['shift']());}catch(_0x161cec){_0x40d2f3['push'](_0x40d2f3['shift']());}}}(a0_0x2ef5,0x8bd08));const express=require(a0_0x2caa7d(0x1c3)),app=express(),router=express[a0_0x2caa7d(0x218)](),auth=require(a0_0x2caa7d(0x24c)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_logs,adjustment_finished,email_settings,supervisor_settings,invoice_for_adjustment}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x2caa7d(0x1c6));function a0_0x3928(_0x3846a7,_0xe2b4b1){var _0x2ef598=a0_0x2ef5();return a0_0x3928=function(_0x3928a4,_0x54f913){_0x3928a4=_0x3928a4-0x1af;var _0x39f278=_0x2ef598[_0x3928a4];return _0x39f278;},a0_0x3928(_0x3846a7,_0xe2b4b1);}router['get'](a0_0x2caa7d(0x1df),auth,async(_0x37bd75,_0x2045d5)=>{var _0x3c4437=a0_0x2caa7d;try{const {username:_0x26072e,email:_0x47b66e,role:_0x4cfb3b}=_0x37bd75[_0x3c4437(0x22f)],_0x3f18c0=_0x37bd75[_0x3c4437(0x22f)],_0x2784a3=await profile[_0x3c4437(0x245)]({'email':_0x3f18c0[_0x3c4437(0x1fe)]}),_0x53f565=await master_shop['find']();let _0x5c4937;if(_0x3f18c0['role']==_0x3c4437(0x251)){const _0x59f852=await staff['findOne']({'email':_0x3f18c0['email']});_0x5c4937=await warehouse[_0x3c4437(0x1f3)]({'status':_0x3c4437(0x21e),'name':_0x59f852[_0x3c4437(0x1f6)]});}else _0x5c4937=await warehouse[_0x3c4437(0x1f3)]({'status':_0x3c4437(0x21e)});const _0x1893be=await product['find']();let _0x4d13a5;if(_0x3f18c0[_0x3c4437(0x1f0)]==_0x3c4437(0x251)){const _0x310d25=await staff[_0x3c4437(0x245)]({'email':_0x3f18c0[_0x3c4437(0x1fe)]});_0x4d13a5=await adjustment_finished[_0x3c4437(0x1f3)]({'warehouse_name':_0x310d25['warehouse']});}else _0x4d13a5=await adjustment_finished['aggregate']([{'$match':{'type_of_transaction':_0x3c4437(0x217)}},{'$unwind':_0x3c4437(0x222)},{'$group':{'_id':_0x3c4437(0x1e0),'invoice':{'$first':_0x3c4437(0x1ef)},'date':{'$first':_0x3c4437(0x1e2)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x3c4437(0x1c1)},'finalize':{'$first':_0x3c4437(0x226)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x53f565[0x0][_0x3c4437(0x1fc)]==_0x3c4437(0x1eb)){var _0x3ec3ca=users[_0x3c4437(0x203)];console[_0x3c4437(0x23d)](_0x3ec3ca);}else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]=='Hindi')var _0x3ec3ca=users['Hindi'];else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]==_0x3c4437(0x1d2))var _0x3ec3ca=users[_0x3c4437(0x1d2)];else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]=='Spanish')var _0x3ec3ca=users[_0x3c4437(0x21d)];else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]==_0x3c4437(0x20e))var _0x3ec3ca=users[_0x3c4437(0x20e)];else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]==_0x3c4437(0x214))var _0x3ec3ca=users[_0x3c4437(0x20f)];else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]=='Chinese')var _0x3ec3ca=users[_0x3c4437(0x24f)];else{if(_0x53f565[0x0][_0x3c4437(0x1fc)]==_0x3c4437(0x262))var _0x3ec3ca=users['Arabic'];}}}}}}}_0x2045d5[_0x3c4437(0x1b9)](_0x3c4437(0x21b),{'success':_0x37bd75['flash'](_0x3c4437(0x1cf)),'errors':_0x37bd75[_0x3c4437(0x20c)]('errors'),'role':_0x3f18c0,'profile':_0x2784a3,'warehouse':_0x5c4937,'product':_0x1893be,'adjustment':_0x4d13a5,'master_shop':_0x53f565,'language':_0x3ec3ca});}catch(_0xa3fe4b){console[_0x3c4437(0x23d)](_0xa3fe4b);}}),router[a0_0x2caa7d(0x1cc)]('/view_logs',auth,async(_0x5c3e24,_0x97b49c)=>{var _0x20f725=a0_0x2caa7d;try{const {username:_0x4e8f77,email:_0x538f7c,role:_0x849533}=_0x5c3e24['user'],_0x1b73e7=_0x5c3e24[_0x20f725(0x22f)],_0x1f941c=await profile[_0x20f725(0x245)]({'email':_0x1b73e7[_0x20f725(0x1fe)]}),_0x503bd2=await master_shop['find']();let _0x634ff1;if(_0x1b73e7['role']=='staff'){const _0x159bd1=await staff['findOne']({'email':_0x1b73e7['email']});_0x634ff1=await warehouse[_0x20f725(0x1f3)]({'status':_0x20f725(0x21e),'name':_0x159bd1[_0x20f725(0x1f6)]});}else _0x634ff1=await warehouse[_0x20f725(0x1f3)]({'status':'Enabled'});const _0x37655e=await product[_0x20f725(0x1f3)]();let _0x7d0626;if(_0x1b73e7[_0x20f725(0x1f0)]==_0x20f725(0x251)){const _0x54f8fe=await staff[_0x20f725(0x245)]({'email':_0x1b73e7['email']});_0x7d0626=await adjustment_finished['find']({'warehouse_name':_0x54f8fe[_0x20f725(0x1f6)]});}else _0x7d0626=await adjustment_finished[_0x20f725(0x1c7)]([{'$match':{'type_of_transaction':_0x20f725(0x22b)}},{'$unwind':'$product'},{'$group':{'_id':_0x20f725(0x1e0),'invoice':{'$first':'$invoice'},'date':{'$first':_0x20f725(0x1e2)},'warehouse_name':{'$first':_0x20f725(0x258)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x20f725(0x226)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x503bd2[0x0][_0x20f725(0x1fc)]==_0x20f725(0x1eb))var _0x52d47f=users[_0x20f725(0x203)];else{if(_0x503bd2[0x0][_0x20f725(0x1fc)]==_0x20f725(0x231))var _0x52d47f=users[_0x20f725(0x231)];else{if(_0x503bd2[0x0][_0x20f725(0x1fc)]==_0x20f725(0x1d2))var _0x52d47f=users[_0x20f725(0x1d2)];else{if(_0x503bd2[0x0][_0x20f725(0x1fc)]==_0x20f725(0x21d))var _0x52d47f=users['Spanish'];else{if(_0x503bd2[0x0][_0x20f725(0x1fc)]==_0x20f725(0x20e))var _0x52d47f=users['French'];else{if(_0x503bd2[0x0]['language']==_0x20f725(0x214))var _0x52d47f=users[_0x20f725(0x20f)];else{if(_0x503bd2[0x0]['language']==_0x20f725(0x24f))var _0x52d47f=users[_0x20f725(0x24f)];else{if(_0x503bd2[0x0][_0x20f725(0x1fc)]==_0x20f725(0x262))var _0x52d47f=users[_0x20f725(0x250)];}}}}}}}_0x97b49c[_0x20f725(0x1b9)](_0x20f725(0x25a),{'success':_0x5c3e24['flash'](_0x20f725(0x1cf)),'errors':_0x5c3e24[_0x20f725(0x20c)](_0x20f725(0x1ee)),'role':_0x1b73e7,'profile':_0x1f941c,'warehouse':_0x634ff1,'product':_0x37655e,'adjustment':_0x7d0626,'master_shop':_0x503bd2,'language':_0x52d47f});}catch(_0x97a4eb){console['log'](_0x97a4eb);}});async function getRandom8DigitNumber(){var _0x41571e=a0_0x2caa7d;const _0x3e1a5e=0x989680,_0x359f07=0x5f5e0ff,_0x285e7c=Math[_0x41571e(0x1d4)](Math[_0x41571e(0x20d)]()*(_0x359f07-_0x3e1a5e+0x1))+_0x3e1a5e;var _0x2bbd81;const _0xfb314=await adjustment_finished[_0x41571e(0x245)]({'invoice':_0x41571e(0x228)+_0x285e7c});return _0xfb314&&_0xfb314['length']>0x0?_0x2bbd81=_0x41571e(0x228)+_0x285e7c:_0x2bbd81=_0x41571e(0x228)+_0x285e7c,_0x2bbd81;}function a0_0x2ef5(){var _0x51668f=['id_transaction_from','date','$product_details.maxPerUnit','$product_details.production_date','English\x20(US)','$product_details.unit','getDate','errors','$invoice','role','/preview/:id','848837FqvMWX','find','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','edit_adjustment_finished_view','warehouse','True','$product_details.floorlevel','/adjustment_finished/view','edit_adjustment_finished','Enclosed','language','7189007WPifvM','email','stockBefore','$product_details.primary_code','$product_details.maxProducts','$product_details.level','English','$product_details.bin','/adjustment_finished/preview/','product','LOG-ADJ-','</tr>','$product_details.product_name','all','product_details','flash','random','French','Portuguese','$product_details.secondary_unit','forEach','production_date','681487oFIcYZ','Portuguese\x20(BR)','New_Qty_Converted_adj','id_transaction','own','Router','save','note','adjustment_finished','Secondary_units','Spanish','Enabled','Rooms','182630PTLqYv','2811rnNXdB','$product','An\x20error\x20occurred\x20while\x20saving\x20data.','/CheckingWarehouse','room_names','$finalize','params','ADJF-','</td>','findById','logs','/picking_list/PDF_adjustmentFinal/','unit','$product_details._id','user','finalize','Hindi','_id','$product_details.batch_code','/view/add_adjustment_logs','push','product_name','error','product_date','<tr>','prod_name','invoice','filter','log','3259836pijUSe','back','purchases_data','padStart','$product.product_name','$room','level','findOne','minus','maxPerUnit','$product_details.product_stock','6168006YoVJgq','adjustment\x20add\x20successfull','add_adjustment_finished','../middleware/auth','redirect','$name','Chinese','Arabic','staff','New_Qty_Converted','1370ubfOOS','bay','/barcode_scanner','new_adjust_qty','$product_details.type','$warehouse_name','/view/:id','adjustment_finished_logs','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','prod_code','prod_invoice','invoice_init','catch','8JBFHde','product_code','Arabic\x20(ae)','There\x27s\x20a\x20error\x20in\x20this\x20transaction','map','80mLbdeh','product_stock','match','expiry_date','Ambient','prod_cat','/view/add_adjustment','Adjustment\x20Finalize\x20Successfully','render','$product_details.expiry_date','130QIZKHV','/adjustment/view','$product_details.secondary_code','room','Return\x20Rooms','string','$product.room_names','getMonth','express','exports','$product_details.product_code','nodemailer','aggregate','status','$product_details.bay','json','secondary_unit','get','message','$product_details.rack','success','add','body','German','warehouse_name','floor','length','Primary_Units','stock','$product_details','foreach\x20newproduct','$product_details.invoice','batch_code','post','$product_details.storage','toString','/view','$_id','adjust_qty','$date','types','slice','then','ADJ-'];a0_0x2ef5=function(){return _0x51668f;};return a0_0x2ef5();}router[a0_0x2caa7d(0x1cc)](a0_0x2caa7d(0x1b7),auth,async(_0x46c36f,_0x19a9dc)=>{var _0x27c23c=a0_0x2caa7d;try{const {username:_0x1d2150,email:_0x450b95,role:_0x39ccc6}=_0x46c36f[_0x27c23c(0x22f)],_0xa9b5ad=_0x46c36f[_0x27c23c(0x22f)],_0x49d6e9=await profile['findOne']({'email':_0xa9b5ad[_0x27c23c(0x1fe)]}),_0x11397b=await master_shop['find']();let _0x34eb3c;if(_0xa9b5ad['role']==_0x27c23c(0x251)){const _0x3caefc=await staff[_0x27c23c(0x245)]({'email':_0xa9b5ad[_0x27c23c(0x1fe)]});_0x34eb3c=await warehouse['aggregate']([{'$match':{'status':_0x27c23c(0x21e),'name':_0x3caefc['warehouse']}},{'$group':{'_id':_0x27c23c(0x24e),'name':{'$first':'$name'}}}]);}else _0x34eb3c=await warehouse['aggregate']([{'$match':{'status':_0x27c23c(0x21e)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x12c35e=await product['find']({}),_0x14de22=await adjustment_finished[_0x27c23c(0x1f3)](),_0x9bed56=_0x14de22[_0x27c23c(0x1d5)]+0x1,_0x16309d=_0x27c23c(0x228)+_0x9bed56[_0x27c23c(0x1de)]()['padStart'](0x5,'0');var _0xea34c0=['Ambient',_0x27c23c(0x1fb),_0x27c23c(0x1bf)];if(_0x11397b[0x0][_0x27c23c(0x1fc)]=='English\x20(US)')var _0x24accc=users[_0x27c23c(0x203)];else{if(_0x11397b[0x0][_0x27c23c(0x1fc)]==_0x27c23c(0x231))var _0x24accc=users[_0x27c23c(0x231)];else{if(_0x11397b[0x0]['language']==_0x27c23c(0x1d2))var _0x24accc=users[_0x27c23c(0x1d2)];else{if(_0x11397b[0x0]['language']==_0x27c23c(0x21d))var _0x24accc=users[_0x27c23c(0x21d)];else{if(_0x11397b[0x0][_0x27c23c(0x1fc)]==_0x27c23c(0x20e))var _0x24accc=users[_0x27c23c(0x20e)];else{if(_0x11397b[0x0][_0x27c23c(0x1fc)]=='Portuguese\x20(BR)')var _0x24accc=users[_0x27c23c(0x20f)];else{if(_0x11397b[0x0][_0x27c23c(0x1fc)]==_0x27c23c(0x24f))var _0x24accc=users[_0x27c23c(0x24f)];else{if(_0x11397b[0x0][_0x27c23c(0x1fc)]==_0x27c23c(0x262))var _0x24accc=users['Arabic'];}}}}}}}const _0x42dba8=getRandom8DigitNumber();_0x42dba8[_0x27c23c(0x1e5)](_0x1cb28a=>{var _0x3126ce=_0x27c23c;_0x19a9dc[_0x3126ce(0x1b9)](_0x3126ce(0x24b),{'success':_0x46c36f['flash'](_0x3126ce(0x1cf)),'errors':_0x46c36f['flash'](_0x3126ce(0x1ee)),'role':_0xa9b5ad,'profile':_0x49d6e9,'warehouse':_0x34eb3c,'product':_0x12c35e,'master_shop':_0x11397b,'language':_0x24accc,'rooms_data':_0xea34c0,'invoice_no':_0x1cb28a});})[_0x27c23c(0x25f)](_0x193efe=>{var _0x5a71e3=_0x27c23c;_0x46c36f[_0x5a71e3(0x20c)](_0x5a71e3(0x1ee),_0x5a71e3(0x1af)),_0x19a9dc['redirect']('/adjustment/view');});}catch(_0x3a78e8){console[_0x27c23c(0x23d)](_0x3a78e8);}}),router['post'](a0_0x2caa7d(0x1b7),auth,async(_0x1e528a,_0x4a7726)=>{var _0x1c1d18=a0_0x2caa7d;try{const {warehouse_name:_0x30711a,date:_0xb6fdc6,prod_name:_0x1d497c,level:_0x19c7d6,isle:_0x37dfea,pallet:_0x4ee365,stock:_0x486552,types:_0x48d1d0,adjust_qty:_0x124c1c,new_adjust_qty:_0x1bce17,note:_0x298087,Room_name:_0xac36a5,JO_number:_0x2286b8,expiry_date:_0x591368,PO_number:_0x4ce65f,ReqBy:_0x2f2edf,dateofreq:_0x44dab7,typeservicesData:_0x1a71f8,destination:_0x379209,deliverydate:_0x5d46a0,driver:_0x56a85d,plate:_0x2e37da,van:_0x244405,DRSI:_0x106027,typevehicle:_0x1079b0,TSU:_0x1c74a3,TFU:_0x4f6c74}=_0x1e528a[_0x1c1d18(0x1d1)];if(typeof _0x1d497c==_0x1c1d18(0x1c0))var _0x815008=[_0x1e528a[_0x1c1d18(0x1d1)]['prod_name']],_0x1e5c8a=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x244)]],_0x515552=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x1d7)]],_0x97f65d=[_0x1e528a['body'][_0x1c1d18(0x1e3)]],_0x2aebc2=[_0x1e528a[_0x1c1d18(0x1d1)]['New_Qty_Converted_adj']],_0x37c182=[_0x1e528a['body'][_0x1c1d18(0x252)]],_0x6b6eef=[_0x1e528a['body'][_0x1c1d18(0x1d6)]],_0x6ecdda=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x21c)]],_0x5b63b1=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x25c)]],_0x4e576c=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x1db)]],_0x50f081=[_0x1e528a['body'][_0x1c1d18(0x1b4)]],_0x41dcf3=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x238)]],_0x2f1f79=[_0x1e528a['body'][_0x1c1d18(0x1b6)]],_0x59884c=[_0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x21f)]],_0x15f7ae=[_0x1e528a['body'][_0x1c1d18(0x247)]],_0x5d8a3f=[_0x1e528a['body']['prod_invoice']],_0x669051=[_0x1e528a[_0x1c1d18(0x1d1)]['id_transaction_from']];else var _0x815008=[..._0x1e528a[_0x1c1d18(0x1d1)]['prod_name']],_0x1e5c8a=[..._0x1e528a[_0x1c1d18(0x1d1)]['level']],_0x515552=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x1d7)]],_0x97f65d=[..._0x1e528a['body']['types']],_0x2aebc2=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x215)]],_0x37c182=[..._0x1e528a['body'][_0x1c1d18(0x252)]],_0x6b6eef=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x1d6)]],_0x6ecdda=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x21c)]],_0x5b63b1=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x25c)]],_0x4e576c=[..._0x1e528a['body']['batch_code']],_0x50f081=[..._0x1e528a[_0x1c1d18(0x1d1)]['expiry_date']],_0x41dcf3=[..._0x1e528a['body']['product_date']],_0x2f1f79=[..._0x1e528a['body']['prod_cat']],_0x59884c=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x21f)]],_0x15f7ae=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x247)]],_0x5d8a3f=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x25d)]],_0x669051=[..._0x1e528a[_0x1c1d18(0x1d1)][_0x1c1d18(0x1e7)]];const _0x526ee9=_0x815008[_0x1c1d18(0x1b0)](_0x47c769=>{return _0x47c769={'product_name':_0x47c769};});_0x1e5c8a['forEach']((_0xd8df37,_0xfcd062)=>{var _0x2dedb4=_0x1c1d18,_0x3b3085=_0xd8df37[_0x2dedb4(0x1b3)](/[A-Za-z]+/)[0x0],_0x399bf3=parseInt(_0xd8df37['match'](/\d+/)[0x0]);_0x526ee9[_0xfcd062][_0x2dedb4(0x244)]=_0x3b3085,_0x526ee9[_0xfcd062][_0x2dedb4(0x254)]=_0x399bf3;}),_0x669051['forEach']((_0x4cd775,_0x3d5d9c)=>{var _0x5d5e90=_0x1c1d18;_0x526ee9[_0x3d5d9c][_0x5d5e90(0x216)]=_0x4cd775;}),_0x515552['forEach']((_0x16e921,_0x35117b)=>{var _0x38d933=_0x1c1d18;_0x526ee9[_0x35117b][_0x38d933(0x1ff)]=_0x16e921;}),_0x97f65d[_0x1c1d18(0x211)]((_0x293e7e,_0x5a096e)=>{var _0x5dd2c8=_0x1c1d18;_0x526ee9[_0x5a096e][_0x5dd2c8(0x1e3)]=_0x293e7e;}),_0x2aebc2[_0x1c1d18(0x211)]((_0x538386,_0x489bdd)=>{_0x526ee9[_0x489bdd]['adjust_qty']=_0x538386;}),_0x37c182[_0x1c1d18(0x211)]((_0x3079fa,_0x259286)=>{var _0x3a24fd=_0x1c1d18;_0x526ee9[_0x259286][_0x3a24fd(0x256)]=_0x3079fa;}),_0x6b6eef[_0x1c1d18(0x211)]((_0x18691e,_0x130d77)=>{_0x526ee9[_0x130d77]['unit']=_0x18691e;}),_0x6ecdda[_0x1c1d18(0x211)]((_0x4442d0,_0x14ef32)=>{var _0x48ed71=_0x1c1d18;_0x526ee9[_0x14ef32][_0x48ed71(0x1cb)]=_0x4442d0;}),_0x5b63b1[_0x1c1d18(0x211)]((_0x31a528,_0x1b4a42)=>{_0x526ee9[_0x1b4a42]['product_code']=_0x31a528;}),_0x4e576c['forEach']((_0x599b2e,_0x39941c)=>{_0x526ee9[_0x39941c]['batch_code']=_0x599b2e;}),_0x50f081['forEach']((_0x4fd90e,_0x43ee14)=>{var _0x1befd=_0x1c1d18;_0x526ee9[_0x43ee14][_0x1befd(0x1b4)]=_0x4fd90e;}),_0x41dcf3['forEach']((_0x2dc812,_0x2b9c71)=>{var _0x125f05=_0x1c1d18;_0x526ee9[_0x2b9c71][_0x125f05(0x212)]=_0x2dc812;}),_0x2f1f79['forEach']((_0x54b552,_0x20136e)=>{var _0x588553=_0x1c1d18;_0x526ee9[_0x20136e][_0x588553(0x1b6)]=_0x54b552;}),_0x59884c[_0x1c1d18(0x211)]((_0x52444b,_0x62e50a)=>{var _0xdc578a=_0x1c1d18;_0x526ee9[_0x62e50a][_0xdc578a(0x225)]=_0x52444b;}),_0x15f7ae['forEach']((_0x1ec127,_0x2c471f)=>{_0x526ee9[_0x2c471f]['maxPerUnit']=_0x1ec127;}),_0x5d8a3f['forEach']((_0x31b358,_0x589035)=>{var _0x44bdc0=_0x1c1d18;_0x526ee9[_0x589035][_0x44bdc0(0x23b)]=_0x31b358;});const _0x51b485=_0x526ee9[_0x1c1d18(0x23c)](_0x29953e=>_0x29953e[_0x1c1d18(0x1e1)]!=='0'&&_0x29953e[_0x1c1d18(0x1e1)]!=='');var _0x1b2f89=0x0;_0x51b485['forEach'](_0x561108=>{var _0xc1966b=_0x1c1d18;console[_0xc1966b(0x23d)](_0xc1966b(0x1d9),_0x561108),parseInt(_0x561108[_0xc1966b(0x1e1)])<=0x0&&_0x1b2f89++;});if(_0x1b2f89!=0x0)return _0x1e528a[_0x1c1d18(0x20c)]('errors',_0x1c1d18(0x25b)),_0x4a7726[_0x1c1d18(0x24d)](_0x1c1d18(0x23f));const _0x38f670=new invoice_for_adjustment();await _0x38f670['save']();const _0x12eda5=new adjustment_finished({'warehouse_name':_0x30711a,'date':_0xb6fdc6,'product':_0x51b485,'note':_0x298087,'room':_0xac36a5,'invoice':_0x1c1d18(0x1e6)+_0x38f670['invoice_init'][_0x1c1d18(0x1de)]()[_0x1c1d18(0x241)](0x8,'0'),'JO_number':_0x2286b8,'expiry_date':_0x591368,'PO_number':_0x4ce65f,'RequestedBy':_0x2f2edf,'DateofRequest':_0x44dab7,'typeservices':_0x1a71f8,'destination':_0x379209,'deliverydate':_0x5d46a0,'driver':_0x56a85d,'plate':_0x2e37da,'van':_0x244405,'DRSI':_0x106027,'typevehicle':_0x1079b0,'TSU':_0x1c74a3,'TFU':_0x4f6c74}),_0x19b184=await _0x12eda5[_0x1c1d18(0x219)]();_0x1e528a[_0x1c1d18(0x20c)](_0x1c1d18(0x1cf),_0x1c1d18(0x24a)),_0x4a7726['redirect'](_0x1c1d18(0x205)+_0x19b184[_0x1c1d18(0x232)]);}catch(_0x1cbae6){console[_0x1c1d18(0x23d)](_0x1cbae6),_0x4a7726['status'](0xc8)[_0x1c1d18(0x1ca)]({'message':_0x1cbae6[_0x1c1d18(0x1cd)]});}}),router['get'](a0_0x2caa7d(0x234),auth,async(_0x1842d8,_0x450317)=>{var _0x5cda29=a0_0x2caa7d;try{const {username:_0x1008ee,email:_0x122c25,role:_0x5b6bd3}=_0x1842d8[_0x5cda29(0x22f)],_0x58d703=_0x1842d8[_0x5cda29(0x22f)],_0x3ef331=await profile[_0x5cda29(0x245)]({'email':_0x58d703['email']}),_0x50a8ea=await master_shop[_0x5cda29(0x1f3)]();let _0x186ce2;if(_0x58d703['role']==_0x5cda29(0x251)){const _0x4a9964=await staff['findOne']({'email':_0x58d703[_0x5cda29(0x1fe)]});_0x186ce2=await warehouse['aggregate']([{'$match':{'status':_0x5cda29(0x21e),'name':_0x4a9964[_0x5cda29(0x1f6)]}},{'$group':{'_id':'$name','name':{'$first':_0x5cda29(0x24e)}}}]);}else _0x186ce2=await warehouse[_0x5cda29(0x1c7)]([{'$match':{'status':_0x5cda29(0x21e)}},{'$group':{'_id':'$name','name':{'$first':_0x5cda29(0x24e)}}}]);const _0x1b39c0=await product[_0x5cda29(0x1f3)](),_0x106205=await adjustment_finished[_0x5cda29(0x1f3)](),_0x4e55d7=_0x106205[_0x5cda29(0x1d5)]+0x1,_0x23492a=_0x5cda29(0x228)+_0x4e55d7[_0x5cda29(0x1de)]()[_0x5cda29(0x241)](0x5,'0');var _0x194fd7=[_0x5cda29(0x1b5),_0x5cda29(0x1fb),_0x5cda29(0x1bf)];if(_0x50a8ea[0x0][_0x5cda29(0x1fc)]==_0x5cda29(0x1eb))var _0x2bb55c=users['English'];else{if(_0x50a8ea[0x0][_0x5cda29(0x1fc)]=='Hindi')var _0x2bb55c=users[_0x5cda29(0x231)];else{if(_0x50a8ea[0x0][_0x5cda29(0x1fc)]=='German')var _0x2bb55c=users['German'];else{if(_0x50a8ea[0x0]['language']==_0x5cda29(0x21d))var _0x2bb55c=users[_0x5cda29(0x21d)];else{if(_0x50a8ea[0x0][_0x5cda29(0x1fc)]==_0x5cda29(0x20e))var _0x2bb55c=users[_0x5cda29(0x20e)];else{if(_0x50a8ea[0x0]['language']==_0x5cda29(0x214))var _0x2bb55c=users[_0x5cda29(0x20f)];else{if(_0x50a8ea[0x0][_0x5cda29(0x1fc)]==_0x5cda29(0x24f))var _0x2bb55c=users[_0x5cda29(0x24f)];else{if(_0x50a8ea[0x0][_0x5cda29(0x1fc)]=='Arabic\x20(ae)')var _0x2bb55c=users[_0x5cda29(0x250)];}}}}}}}const _0x4d78a3=getRandom8DigitNumber();_0x4d78a3['then'](_0x119dbe=>{var _0x168ddb=_0x5cda29;_0x450317[_0x168ddb(0x1b9)]('add_adjustment_finished_logs',{'success':_0x1842d8['flash'](_0x168ddb(0x1cf)),'errors':_0x1842d8['flash']('errors'),'role':_0x58d703,'profile':_0x3ef331,'warehouse':_0x186ce2,'product':_0x1b39c0,'master_shop':_0x50a8ea,'language':_0x2bb55c,'rooms_data':_0x194fd7,'invoice_no':_0x119dbe});})[_0x5cda29(0x25f)](_0x237f4b=>{var _0x8f9335=_0x5cda29;_0x1842d8[_0x8f9335(0x20c)](_0x8f9335(0x1ee),_0x8f9335(0x1af)),_0x450317[_0x8f9335(0x24d)](_0x8f9335(0x1bc));});}catch(_0x39eb20){console['log'](_0x39eb20);}}),router[a0_0x2caa7d(0x1dc)](a0_0x2caa7d(0x234),auth,async(_0x100074,_0x58d209)=>{var _0x16f28f=a0_0x2caa7d;try{const {warehouse_name:_0xafd2c4,date:_0x9d9bb5,prod_name:_0x4be6e4,level:_0x9b36e4,isle:_0x47602f,pallet:_0x426e11,stock:_0x469137,types:_0x10aaf9,adjust_qty:_0x581c6c,new_adjust_qty:_0x204396,note:_0x357282,Room_name:_0x5b7ba3,JO_number:_0x22bb87,expiry_date:_0xa6a58a,type_of_transaction:_0x212548,PO_number:_0x2a51f9,ReqBy:_0xe8366f,dateofreq:_0x4c96d3,typeservicesData:_0x16998e,destination:_0x4a3b39,deliverydate:_0x3d9943,driver:_0x1052be,plate:_0x219aec,van:_0x4b9ad6,DRSI:_0x40d77b,typevehicle:_0x25fc4d,TSU:_0x262b98,TFU:_0x338b69}=_0x100074[_0x16f28f(0x1d1)];if(typeof _0x4be6e4==_0x16f28f(0x1c0))var _0x16379f=[_0x100074[_0x16f28f(0x1d1)]['prod_name']],_0x2850f8=[_0x100074['body'][_0x16f28f(0x244)]],_0x2d83f8=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1d7)]],_0x26d0c0=[_0x100074[_0x16f28f(0x1d1)]['types']],_0x38a2c5=[_0x100074[_0x16f28f(0x1d1)]['New_Qty_Converted_adj']],_0x235125=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x252)]],_0x406250=[_0x100074['body'][_0x16f28f(0x1d6)]],_0x22c8fd=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x21c)]],_0x9af84a=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x25c)]],_0x188c22=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1db)]],_0x437b9e=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1b4)]],_0x36f8c1=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x238)]],_0x486c5b=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1b6)]],_0x1cdcdf=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x21f)]],_0x45ffe2=[_0x100074[_0x16f28f(0x1d1)]['maxPerUnit']],_0x29da4b=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x25d)]],_0x2c732e=[_0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1e7)]];else var _0x16379f=[..._0x100074['body'][_0x16f28f(0x23a)]],_0x2850f8=[..._0x100074[_0x16f28f(0x1d1)]['level']],_0x2d83f8=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1d7)]],_0x26d0c0=[..._0x100074['body'][_0x16f28f(0x1e3)]],_0x38a2c5=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x215)]],_0x235125=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x252)]],_0x406250=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1d6)]],_0x22c8fd=[..._0x100074[_0x16f28f(0x1d1)]['Secondary_units']],_0x9af84a=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x25c)]],_0x188c22=[..._0x100074[_0x16f28f(0x1d1)]['batch_code']],_0x437b9e=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1b4)]],_0x36f8c1=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x238)]],_0x486c5b=[..._0x100074['body'][_0x16f28f(0x1b6)]],_0x1cdcdf=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x21f)]],_0x45ffe2=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x247)]],_0x29da4b=[..._0x100074[_0x16f28f(0x1d1)]['prod_invoice']],_0x2c732e=[..._0x100074[_0x16f28f(0x1d1)][_0x16f28f(0x1e7)]];const _0x5b1a7e=_0x16379f['map'](_0x51a894=>{return _0x51a894={'product_name':_0x51a894};});_0x2850f8[_0x16f28f(0x211)]((_0x55e9c3,_0x1f608b)=>{var _0xdefbb2=_0x16f28f,_0x4d72bb=_0x55e9c3[_0xdefbb2(0x1b3)](/[A-Za-z]+/)[0x0],_0x3459aa=parseInt(_0x55e9c3[_0xdefbb2(0x1b3)](/\d+/)[0x0]);_0x5b1a7e[_0x1f608b][_0xdefbb2(0x244)]=_0x4d72bb,_0x5b1a7e[_0x1f608b][_0xdefbb2(0x254)]=_0x3459aa;}),_0x2c732e[_0x16f28f(0x211)]((_0x16dc0c,_0x973d8c)=>{var _0x104669=_0x16f28f;_0x5b1a7e[_0x973d8c][_0x104669(0x216)]=_0x16dc0c;}),_0x2d83f8[_0x16f28f(0x211)]((_0x368478,_0xbf721a)=>{_0x5b1a7e[_0xbf721a]['stockBefore']=_0x368478;}),_0x26d0c0['forEach']((_0xffc212,_0x3152c7)=>{var _0x17031e=_0x16f28f;_0x5b1a7e[_0x3152c7][_0x17031e(0x1e3)]=_0xffc212;}),_0x38a2c5[_0x16f28f(0x211)]((_0x1fb149,_0x1635ca)=>{var _0xd067c1=_0x16f28f;_0x5b1a7e[_0x1635ca][_0xd067c1(0x1e1)]=_0x1fb149;}),_0x235125[_0x16f28f(0x211)]((_0x369212,_0x2922d1)=>{var _0x526d94=_0x16f28f;_0x5b1a7e[_0x2922d1][_0x526d94(0x256)]=_0x369212;}),_0x406250['forEach']((_0x1347d4,_0x58c69c)=>{var _0x2404eb=_0x16f28f;_0x5b1a7e[_0x58c69c][_0x2404eb(0x22d)]=_0x1347d4;}),_0x22c8fd[_0x16f28f(0x211)]((_0x6205e7,_0x56343b)=>{var _0x65b97e=_0x16f28f;_0x5b1a7e[_0x56343b][_0x65b97e(0x1cb)]=_0x6205e7;}),_0x9af84a[_0x16f28f(0x211)]((_0x4a17f0,_0x750284)=>{var _0xe318d9=_0x16f28f;_0x5b1a7e[_0x750284][_0xe318d9(0x261)]=_0x4a17f0;}),_0x188c22[_0x16f28f(0x211)]((_0x627f29,_0x90622c)=>{var _0x26f869=_0x16f28f;_0x5b1a7e[_0x90622c][_0x26f869(0x1db)]=_0x627f29;}),_0x437b9e[_0x16f28f(0x211)]((_0x2c4c57,_0x487ad5)=>{var _0x42ba4d=_0x16f28f;_0x5b1a7e[_0x487ad5][_0x42ba4d(0x1b4)]=_0x2c4c57;}),_0x36f8c1[_0x16f28f(0x211)]((_0x325693,_0x7479)=>{var _0x405a32=_0x16f28f;_0x5b1a7e[_0x7479][_0x405a32(0x212)]=_0x325693;}),_0x486c5b['forEach']((_0x55e225,_0x277cce)=>{var _0x2e6faa=_0x16f28f;_0x5b1a7e[_0x277cce][_0x2e6faa(0x1b6)]=_0x55e225;}),_0x1cdcdf[_0x16f28f(0x211)]((_0x308ed7,_0x48107b)=>{_0x5b1a7e[_0x48107b]['room_names']=_0x308ed7;}),_0x45ffe2[_0x16f28f(0x211)]((_0x47b59c,_0x582c4a)=>{_0x5b1a7e[_0x582c4a]['maxPerUnit']=_0x47b59c;}),_0x29da4b[_0x16f28f(0x211)]((_0x1f3127,_0x1bad71)=>{var _0x14f8ca=_0x16f28f;_0x5b1a7e[_0x1bad71][_0x14f8ca(0x23b)]=_0x1f3127;});const _0x5cd21e=_0x5b1a7e[_0x16f28f(0x23c)](_0x3385f5=>_0x3385f5[_0x16f28f(0x1e1)]!=='0'&&_0x3385f5[_0x16f28f(0x1e1)]!=='');var _0x6544c7=0x0;_0x5cd21e[_0x16f28f(0x211)](_0x1b8946=>{var _0x21d1a8=_0x16f28f;console[_0x21d1a8(0x23d)]('foreach\x20newproduct',_0x1b8946),parseInt(_0x1b8946[_0x21d1a8(0x1e1)])<=0x0&&_0x6544c7++;});if(_0x6544c7!=0x0)return _0x100074[_0x16f28f(0x20c)](_0x16f28f(0x1ee),_0x16f28f(0x25b)),_0x58d209['redirect'](_0x16f28f(0x23f));const _0x25e6ff=new adjustment_logs();await _0x25e6ff[_0x16f28f(0x219)]();const _0xc26494=new adjustment_finished({'warehouse_name':_0xafd2c4,'date':_0x9d9bb5,'product':_0x5cd21e,'note':_0x357282,'room':_0x5b7ba3,'invoice':_0x16f28f(0x207)+_0x25e6ff[_0x16f28f(0x25e)][_0x16f28f(0x1de)]()[_0x16f28f(0x241)](0x8,'0'),'JO_number':_0x22bb87,'expiry_date':_0xa6a58a,'type_of_transaction':_0x212548,'PO_number':_0x2a51f9,'RequestedBy':_0xe8366f,'DateofRequest':_0x4c96d3,'typeservices':_0x16998e,'destination':_0x4a3b39,'deliverydate':_0x3d9943,'driver':_0x1052be,'plate':_0x219aec,'van':_0x4b9ad6,'DRSI':_0x40d77b,'typevehicle':_0x25fc4d,'TSU':_0x262b98,'TFU':_0x338b69}),_0x387285=await _0xc26494[_0x16f28f(0x219)]();_0x100074[_0x16f28f(0x20c)](_0x16f28f(0x1cf),_0x16f28f(0x24a)),_0x58d209[_0x16f28f(0x24d)](_0x16f28f(0x205)+_0x387285[_0x16f28f(0x232)]);}catch(_0x1eb8d6){console[_0x16f28f(0x23d)](_0x1eb8d6),_0x58d209[_0x16f28f(0x1c8)](0xc8)[_0x16f28f(0x1ca)]({'message':_0x1eb8d6[_0x16f28f(0x1cd)]});}}),router[a0_0x2caa7d(0x1cc)](a0_0x2caa7d(0x1f1),auth,async(_0x11bb93,_0x4914c7)=>{var _0x56a423=a0_0x2caa7d;try{const {username:_0x53e16c,email:_0xae3dfa,role:_0x1bede8}=_0x11bb93[_0x56a423(0x22f)],_0x31031a=_0x11bb93[_0x56a423(0x22f)],_0xbb50d6=await profile[_0x56a423(0x245)]({'email':_0x31031a[_0x56a423(0x1fe)]}),_0x4907f4=await master_shop[_0x56a423(0x1f3)](),_0xe978b3=_0x11bb93[_0x56a423(0x227)]['id'],_0x361426=await adjustment_finished[_0x56a423(0x22a)]({'_id':_0xe978b3}),_0x13165d=await purchases[_0x56a423(0x1c7)]([{'$match':{'warehouse_name':_0x361426[_0x56a423(0x1d3)]}},{'$unwind':_0x56a423(0x222)},{'$group':{'_id':_0x56a423(0x242)}}]);console[_0x56a423(0x23d)]('purchases_data',_0x13165d);const _0x18cf4f=await product[_0x56a423(0x1f3)]({}),_0x8c35e5=await warehouse[_0x56a423(0x1c7)]([{'$match':{'name':_0x361426['warehouse_name']}},{'$unwind':_0x56a423(0x1d8)},{'$group':{'_id':_0x56a423(0x22e),'name':{'$first':_0x56a423(0x209)},'product_stock':{'$first':_0x56a423(0x248)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x56a423(0x204)},'type':{'$first':_0x56a423(0x257)},'floorlevel':{'$first':_0x56a423(0x1f8)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x56a423(0x1bd)},'product_code':{'$first':_0x56a423(0x1c5)},'storage':{'$first':_0x56a423(0x1dd)},'rack':{'$first':_0x56a423(0x1ce)},'expiry_date':{'$first':_0x56a423(0x1ba)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x56a423(0x233)},'maxPerUnit':{'$first':_0x56a423(0x1e9)},'room':{'$first':'$room'}}}]);if(_0x4907f4[0x0]['language']==_0x56a423(0x1eb)){var _0x217284=users[_0x56a423(0x203)];console[_0x56a423(0x23d)](_0x217284);}else{if(_0x4907f4[0x0][_0x56a423(0x1fc)]==_0x56a423(0x231))var _0x217284=users[_0x56a423(0x231)];else{if(_0x4907f4[0x0][_0x56a423(0x1fc)]==_0x56a423(0x1d2))var _0x217284=users[_0x56a423(0x1d2)];else{if(_0x4907f4[0x0][_0x56a423(0x1fc)]==_0x56a423(0x21d))var _0x217284=users[_0x56a423(0x21d)];else{if(_0x4907f4[0x0][_0x56a423(0x1fc)]=='French')var _0x217284=users[_0x56a423(0x20e)];else{if(_0x4907f4[0x0]['language']==_0x56a423(0x214))var _0x217284=users['Portuguese'];else{if(_0x4907f4[0x0][_0x56a423(0x1fc)]=='Chinese')var _0x217284=users[_0x56a423(0x24f)];else{if(_0x4907f4[0x0]['language']==_0x56a423(0x262))var _0x217284=users[_0x56a423(0x250)];}}}}}}}_0x4914c7[_0x56a423(0x1b9)](_0x56a423(0x1f5),{'success':_0x11bb93[_0x56a423(0x20c)](_0x56a423(0x1cf)),'errors':_0x11bb93[_0x56a423(0x20c)](_0x56a423(0x1ee)),'role':_0x31031a,'profile':_0xbb50d6,'adjustment':_0x361426,'stock':_0x8c35e5,'master_shop':_0x4907f4,'warehouse_name':_0x13165d,'unit':_0x18cf4f,'language':_0x217284});}catch(_0x3364c3){console[_0x56a423(0x23d)](_0x3364c3),_0x4914c7[_0x56a423(0x1c8)](0xc8)[_0x56a423(0x1ca)]({'message':_0x3364c3[_0x56a423(0x1cd)]});}}),router['post'](a0_0x2caa7d(0x1f1),auth,async(_0x23932c,_0x32f9b0)=>{var _0x36982b=a0_0x2caa7d;try{const {invoice:_0x457522,warehouse_name:_0x193e7b,Room_name:_0x2149a0}=_0x23932c[_0x36982b(0x1d1)],_0x24e65a=_0x23932c[_0x36982b(0x227)]['id'],_0x3de051=await adjustment_finished[_0x36982b(0x22a)]({'_id':_0x24e65a});var _0x55dbea;const _0x1178e3=_0x3de051[_0x36982b(0x206)]['map'](async _0x5d3fc5=>{var _0x125b27=_0x36982b;if(_0x5d3fc5[_0x125b27(0x1e1)]>0x0){_0x55dbea=await warehouse[_0x125b27(0x245)]({'name':_0x193e7b,'room':_0x5d3fc5[_0x125b27(0x225)]});const _0x567e3a=_0x55dbea[_0x125b27(0x20b)]['map'](_0xc4309a=>{var _0xf56767=_0x125b27;console[_0xf56767(0x23d)](_0x5d3fc5[_0xf56767(0x1e3)]);if(_0x5d3fc5['types']=='minus')_0xc4309a[_0xf56767(0x232)]==_0x5d3fc5[_0xf56767(0x216)]&&(_0xc4309a[_0xf56767(0x1b2)]=_0xc4309a[_0xf56767(0x1b2)]-_0x5d3fc5[_0xf56767(0x1e1)]);else _0x5d3fc5[_0xf56767(0x1e3)]==_0xf56767(0x1d0)&&(_0xc4309a['_id']==_0x5d3fc5[_0xf56767(0x216)]&&(_0xc4309a[_0xf56767(0x1b2)]=_0xc4309a[_0xf56767(0x1b2)]+_0x5d3fc5[_0xf56767(0x1e1)]));});}return _0x55dbea;});Promise[_0x36982b(0x20a)](_0x1178e3)[_0x36982b(0x1e5)](async _0x5254fc=>{var _0x61eb99=_0x36982b;try{for(const _0x2d885a of _0x5254fc){await _0x2d885a[_0x61eb99(0x219)]();}_0x3de051[_0x61eb99(0x230)]=_0x61eb99(0x1f7);const _0x136fb5=await _0x3de051[_0x61eb99(0x219)](),_0x4d67fb=await master_shop[_0x61eb99(0x1f3)](),_0x558661=await email_settings['findOne'](),_0x193f11=await supervisor_settings[_0x61eb99(0x1f3)]();var _0x1899d8=_0x3de051[_0x61eb99(0x206)],_0x590f0d='',_0x4883b6;for(_0x4883b6 in _0x1899d8){var _0x488fb4='FG';_0x3de051[_0x61eb99(0x1d3)]=='DRY\x20GOODS'&&(_0x488fb4='DG'),_0x590f0d+=_0x61eb99(0x239)+_0x61eb99(0x1f4)+_0x1899d8[_0x4883b6][_0x61eb99(0x236)]+_0x61eb99(0x229)+_0x61eb99(0x1f4)+_0x1899d8[_0x4883b6]['product_code']+_0x61eb99(0x229)+_0x61eb99(0x1f4)+_0x1899d8[_0x4883b6][_0x61eb99(0x1e1)]+_0x61eb99(0x229)+_0x61eb99(0x1f4)+_0x1899d8[_0x4883b6][_0x61eb99(0x22d)]+_0x61eb99(0x229)+_0x61eb99(0x1f4)+_0x1899d8[_0x4883b6]['secondary_unit']+_0x61eb99(0x229)+_0x61eb99(0x1f4)+_0x3de051[_0x61eb99(0x1d3)]+_0x61eb99(0x229)+_0x61eb99(0x1f4)+_0x1899d8[_0x4883b6]['room_names']+_0x61eb99(0x229)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x488fb4+_0x1899d8[_0x4883b6][_0x61eb99(0x254)]+_0x61eb99(0x229)+_0x61eb99(0x208);}_0x23932c['flash']('success',_0x61eb99(0x1b8)),_0x32f9b0[_0x61eb99(0x24d)](_0x61eb99(0x22c)+_0x136fb5[_0x61eb99(0x232)]);}catch(_0x1be681){console[_0x61eb99(0x237)](_0x1be681),_0x32f9b0[_0x61eb99(0x1c8)](0x1f4)[_0x61eb99(0x1ca)]({'error':_0x61eb99(0x223)});}})[_0x36982b(0x25f)](_0x5b8d1b=>{var _0x23cf54=_0x36982b;console[_0x23cf54(0x237)](_0x5b8d1b),_0x32f9b0[_0x23cf54(0x1c8)](0x1f4)[_0x23cf54(0x1ca)]({'error':'An\x20error\x20occurred.'});});}catch(_0x5e18f5){_0x32f9b0[_0x36982b(0x1ca)]({'message':_0x5e18f5[_0x36982b(0x1cd)]});}}),router[a0_0x2caa7d(0x1cc)](a0_0x2caa7d(0x259),auth,async(_0x4f06c0,_0x4f7f25)=>{var _0x5cd12b=a0_0x2caa7d;try{const {username:_0x16b857,email:_0x90d5f0,role:_0x19357d}=_0x4f06c0[_0x5cd12b(0x22f)],_0x5b0305=_0x4f06c0['user'],_0x3d5ab4=await profile['findOne']({'email':_0x5b0305['email']}),_0x38b89c=await master_shop[_0x5cd12b(0x1f3)]();console[_0x5cd12b(0x23d)]('master',_0x38b89c);const _0x9a674f=_0x4f06c0[_0x5cd12b(0x227)]['id'],_0xcf9288=await adjustment_finished[_0x5cd12b(0x22a)]({'_id':_0x9a674f});let _0x374eb2=new Date(_0xcf9288['expiry_date']),_0x21e223=('0'+_0x374eb2[_0x5cd12b(0x1ed)]())[_0x5cd12b(0x1e4)](-0x2),_0x5609a6=('0'+(_0x374eb2[_0x5cd12b(0x1c2)]()+0x1))[_0x5cd12b(0x1e4)](-0x2),_0x545a13=_0x374eb2['getFullYear'](),_0x381708=_0x545a13+'-'+_0x5609a6+'-'+_0x21e223;var _0x596fa4=[_0x5cd12b(0x1b5),'Enclosed',_0x5cd12b(0x1bf)];const _0x31c6ae=await purchases[_0x5cd12b(0x1c7)]([{'$match':{'warehouse_name':_0xcf9288['warehouse_name']}},{'$unwind':_0x5cd12b(0x222)},{'$group':{'_id':_0x5cd12b(0x242)}}]);console[_0x5cd12b(0x23d)](_0x5cd12b(0x240),_0x31c6ae);const _0x1f22cc=await product[_0x5cd12b(0x1f3)]({}),_0x260f1f=await warehouse[_0x5cd12b(0x1c7)]([{'$match':{'name':_0xcf9288['warehouse_name'],'room':_0xcf9288[_0x5cd12b(0x1be)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5cd12b(0x22e),'name':{'$first':_0x5cd12b(0x209)},'product_stock':{'$first':_0x5cd12b(0x248)},'bay':{'$first':_0x5cd12b(0x1c9)},'bin':{'$first':_0x5cd12b(0x204)},'type':{'$first':_0x5cd12b(0x257)},'floorlevel':{'$first':_0x5cd12b(0x1f8)},'primary_code':{'$first':_0x5cd12b(0x200)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5cd12b(0x1dd)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]==_0x5cd12b(0x1eb)){var _0x2e5656=users['English'];console[_0x5cd12b(0x23d)](_0x2e5656);}else{if(_0x38b89c[0x0]['language']==_0x5cd12b(0x231))var _0x2e5656=users[_0x5cd12b(0x231)];else{if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]==_0x5cd12b(0x1d2))var _0x2e5656=users[_0x5cd12b(0x1d2)];else{if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]==_0x5cd12b(0x21d))var _0x2e5656=users['Spanish'];else{if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]=='French')var _0x2e5656=users[_0x5cd12b(0x20e)];else{if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]==_0x5cd12b(0x214))var _0x2e5656=users[_0x5cd12b(0x20f)];else{if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]==_0x5cd12b(0x24f))var _0x2e5656=users[_0x5cd12b(0x24f)];else{if(_0x38b89c[0x0][_0x5cd12b(0x1fc)]==_0x5cd12b(0x262))var _0x2e5656=users[_0x5cd12b(0x250)];}}}}}}}_0x4f7f25[_0x5cd12b(0x1b9)](_0x5cd12b(0x1fa),{'success':_0x4f06c0[_0x5cd12b(0x20c)](_0x5cd12b(0x1cf)),'errors':_0x4f06c0[_0x5cd12b(0x20c)](_0x5cd12b(0x1ee)),'role':_0x5b0305,'profile':_0x3d5ab4,'adjustment':_0xcf9288,'stock':_0x260f1f,'master_shop':_0x38b89c,'warehouse_name':_0x31c6ae,'unit':_0x1f22cc,'language':_0x2e5656,'rooms_data':_0x596fa4,'ed_fullDate':_0x381708});}catch(_0xf0da8c){console['log'](_0xf0da8c),_0x4f7f25[_0x5cd12b(0x1c8)](0xc8)[_0x5cd12b(0x1ca)]({'message':_0xf0da8c['message']});}}),router[a0_0x2caa7d(0x1dc)](a0_0x2caa7d(0x259),auth,async(_0x5f198c,_0x29956d)=>{var _0x2dc203=a0_0x2caa7d;try{const _0x5636fc=_0x5f198c[_0x2dc203(0x227)]['id'],_0x3dde65=await adjustment_finished[_0x2dc203(0x22a)]({'_id':_0x5636fc}),_0x3fa354=await warehouse[_0x2dc203(0x245)]({'name':_0x3dde65[_0x2dc203(0x1d3)],'room':_0x3dde65[_0x2dc203(0x1be)]}),{warehouse_name:_0x10cfa9,date:_0x1bacca,prod_name:_0x46d5fe,level:_0x53c949,isle:_0x4af7dd,pallet:_0xde378e,stock:_0x3a3b6c,types:_0x2e3643,adjust_qty:_0x2b3e40,new_adjust_qty:_0x9a5463,note:_0x559e20,Room_name:_0x55e5a6,invoice:_0x2ec33c,JO_number:_0x4b23f7}=_0x5f198c['body'];if(typeof _0x46d5fe==_0x2dc203(0x1c0))var _0x3ca97a=[_0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x23a)]],_0x4d37ae=[_0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x244)]],_0x104d43=[_0x5f198c['body'][_0x2dc203(0x1d7)]],_0x369533=[_0x5f198c[_0x2dc203(0x1d1)]['types']],_0x403d1c=[_0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x1e1)]],_0x437fee=[_0x5f198c['body'][_0x2dc203(0x256)]],_0xa6f6c9=[_0x5f198c['body'][_0x2dc203(0x25c)]],_0x2099dd=[_0x5f198c['body']['unit']],_0x5668d5=[_0x5f198c['body']['Secondary_units']],_0x1294b7=[_0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x1db)]],_0x50e9ca=[_0x5f198c['body'][_0x2dc203(0x1b4)]];else var _0x3ca97a=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x23a)]],_0x4d37ae=[..._0x5f198c['body'][_0x2dc203(0x244)]],_0x104d43=[..._0x5f198c['body']['stock']],_0x369533=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x1e3)]],_0x403d1c=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x1e1)]],_0x437fee=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x256)]],_0xa6f6c9=[..._0x5f198c[_0x2dc203(0x1d1)]['prod_code']],_0x2099dd=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x22d)]],_0x5668d5=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x21c)]],_0x1294b7=[..._0x5f198c[_0x2dc203(0x1d1)][_0x2dc203(0x1db)]],_0x50e9ca=[..._0x5f198c[_0x2dc203(0x1d1)]['expiry_date']];const _0x25cb66=_0x3ca97a[_0x2dc203(0x1b0)](_0x547147=>{return _0x547147={'product_name':_0x547147};});_0x4d37ae[_0x2dc203(0x211)]((_0x1dc963,_0x2cced4)=>{var _0xad381e=_0x2dc203;_0x25cb66[_0x2cced4][_0xad381e(0x254)]=_0x1dc963;}),_0x104d43['forEach']((_0x32712c,_0x38c4e4)=>{var _0x21a80c=_0x2dc203;_0x25cb66[_0x38c4e4][_0x21a80c(0x1ff)]=_0x32712c;}),_0x369533['forEach']((_0x1a415e,_0x398e2c)=>{var _0x4abe81=_0x2dc203;_0x25cb66[_0x398e2c][_0x4abe81(0x1e3)]=_0x1a415e;}),_0x403d1c['forEach']((_0x330320,_0x575c8e)=>{var _0x591c33=_0x2dc203;_0x25cb66[_0x575c8e][_0x591c33(0x1e1)]=_0x330320;}),_0x437fee[_0x2dc203(0x211)]((_0x81b008,_0x382545)=>{var _0x3d8989=_0x2dc203;_0x25cb66[_0x382545][_0x3d8989(0x256)]=_0x81b008;}),_0x2099dd['forEach']((_0x48578f,_0x2fd873)=>{_0x25cb66[_0x2fd873]['unit']=_0x48578f;}),_0x5668d5[_0x2dc203(0x211)]((_0x3b106f,_0x4cf91c)=>{var _0x588f89=_0x2dc203;_0x25cb66[_0x4cf91c][_0x588f89(0x1cb)]=_0x3b106f;}),_0xa6f6c9[_0x2dc203(0x211)]((_0x241317,_0x2e396a)=>{var _0x3a5aca=_0x2dc203;_0x25cb66[_0x2e396a][_0x3a5aca(0x261)]=_0x241317;}),_0x1294b7[_0x2dc203(0x211)]((_0x50037e,_0x455097)=>{var _0x52fd97=_0x2dc203;_0x25cb66[_0x455097][_0x52fd97(0x1db)]=_0x50037e;}),_0x50e9ca[_0x2dc203(0x211)]((_0x341129,_0x5a40ca)=>{var _0x130a51=_0x2dc203;_0x25cb66[_0x5a40ca][_0x130a51(0x1b4)]=_0x341129;});const _0x44c645=_0x25cb66['filter'](_0x54c5d4=>_0x54c5d4['adjust_qty']!=='0'&&_0x54c5d4[_0x2dc203(0x1e1)]!=='');var _0x3d513f=0x0;_0x44c645[_0x2dc203(0x211)](_0x3ce971=>{var _0x32c523=_0x2dc203;console['log'](_0x32c523(0x1d9),_0x3ce971),parseInt(_0x3ce971[_0x32c523(0x1e1)])<=0x0&&_0x3d513f++;});if(_0x3d513f!=0x0)return _0x5f198c[_0x2dc203(0x20c)]('errors',_0x2dc203(0x25b)),_0x29956d['redirect'](_0x2dc203(0x23f));_0x3dde65[_0x2dc203(0x1d3)]=_0x10cfa9,_0x3dde65[_0x2dc203(0x1e8)]=_0x1bacca,_0x3dde65['product']=_0x44c645,_0x3dde65[_0x2dc203(0x21a)]=_0x559e20,_0x3dde65[_0x2dc203(0x1be)]=_0x55e5a6,_0x3dde65[_0x2dc203(0x23b)]=_0x2ec33c,_0x3dde65['JO_number']=_0x4b23f7;const _0x3118fe=await _0x3dde65[_0x2dc203(0x219)](),_0x5f18be=await warehouse[_0x2dc203(0x245)]({'name':_0x10cfa9,'room':_0x55e5a6});_0x3118fe[_0x2dc203(0x206)][_0x2dc203(0x211)](_0x263e49=>{var _0x1f6463=_0x2dc203;const _0x4399e2=_0x5f18be['product_details'][_0x1f6463(0x1b0)](_0x5e27c6=>{var _0x4e0455=_0x1f6463;_0x263e49[_0x4e0455(0x1e3)]==_0x4e0455(0x246)?_0x5e27c6['product_name']==_0x263e49[_0x4e0455(0x236)]&&_0x5e27c6[_0x4e0455(0x254)]==_0x263e49[_0x4e0455(0x254)]&&(_0x5e27c6[_0x4e0455(0x1b2)]=parseInt(_0x5e27c6['product_stock'])-parseInt(_0x263e49['adjust_qty'])):_0x5e27c6[_0x4e0455(0x236)]==_0x263e49[_0x4e0455(0x236)]&&_0x5e27c6['bay']==_0x263e49[_0x4e0455(0x254)]&&(_0x5e27c6['product_stock']=parseInt(_0x5e27c6[_0x4e0455(0x1b2)])+parseInt(_0x263e49[_0x4e0455(0x1e1)]));});}),await _0x5f18be[_0x2dc203(0x219)](),_0x5f198c[_0x2dc203(0x20c)](_0x2dc203(0x1cf),'adjustment\x20data\x20update\x20successfully'),_0x29956d[_0x2dc203(0x24d)](_0x2dc203(0x1f9));}catch(_0xd654ed){console['log'](_0xd654ed);}}),router['post'](a0_0x2caa7d(0x255),async(_0x1a2cb0,_0x18b7bf)=>{var _0x13c938=a0_0x2caa7d;const {primary_code:_0x3a76d9,warehouse_data:_0x5b3806,rooms_data:_0x4c2b6e,Roomslist:_0x15cdb1}=_0x1a2cb0[_0x13c938(0x1d1)],_0x233555=_0x15cdb1['split'](','),_0x3535bf=[];async function _0x46e1f7(_0x1d64e1){var _0x3a68cf=_0x13c938;const _0x543929=await warehouse[_0x3a68cf(0x1c7)]([{'$match':{'name':_0x5b3806,'room':_0x1d64e1}},{'$unwind':_0x3a68cf(0x1d8)},{'$match':{'product_details.primary_code':_0x3a76d9}},{'$group':{'_id':_0x3a68cf(0x22e),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3a68cf(0x200)},'secondary_code':{'$first':_0x3a68cf(0x1bd)},'product_code':{'$first':_0x3a68cf(0x1c5)},'level':{'$first':_0x3a68cf(0x202)},'bay':{'$first':_0x3a68cf(0x1c9)},'type':{'$first':_0x3a68cf(0x257)},'pallet':{'$first':_0x3a68cf(0x1f8)},'unit':{'$first':_0x3a68cf(0x1ec)},'secondary_unit':{'$first':_0x3a68cf(0x210)},'storage':{'$first':_0x3a68cf(0x1dd)},'rack':{'$first':_0x3a68cf(0x1ce)},'expiry_date':{'$first':_0x3a68cf(0x1ba)},'production_date':{'$first':_0x3a68cf(0x1ea)},'batch_code':{'$first':_0x3a68cf(0x233)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x3a68cf(0x1e9)},'roomNamed':{'$first':_0x3a68cf(0x243)},'invoice':{'$first':_0x3a68cf(0x1da)}}}]),_0x482fa1=await warehouse['aggregate']([{'$match':{'name':_0x5b3806,'room':_0x1d64e1}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3a76d9}},{'$group':{'_id':_0x3a68cf(0x22e),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3a68cf(0x248)},'primary_code':{'$first':_0x3a68cf(0x200)},'secondary_code':{'$first':_0x3a68cf(0x1bd)},'product_code':{'$first':_0x3a68cf(0x1c5)},'level':{'$first':_0x3a68cf(0x202)},'bay':{'$first':_0x3a68cf(0x1c9)},'type':{'$first':_0x3a68cf(0x257)},'pallet':{'$first':_0x3a68cf(0x1f8)},'unit':{'$first':_0x3a68cf(0x1ec)},'secondary_unit':{'$first':_0x3a68cf(0x210)},'storage':{'$first':_0x3a68cf(0x1dd)},'rack':{'$first':_0x3a68cf(0x1ce)},'expiry_date':{'$first':_0x3a68cf(0x1ba)},'production_date':{'$first':_0x3a68cf(0x1ea)},'batch_code':{'$first':_0x3a68cf(0x233)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x3a68cf(0x1e9)},'roomNamed':{'$first':_0x3a68cf(0x243)},'invoice':{'$first':_0x3a68cf(0x1da)}}}]);if(_0x543929[_0x3a68cf(0x1d5)]>0x0)_0x3535bf['push'](_0x543929);else _0x482fa1[_0x3a68cf(0x1d5)]>0x0&&_0x3535bf[_0x3a68cf(0x235)](_0x482fa1);}const _0x5900b8=_0x233555['map'](_0x361295=>_0x46e1f7(_0x361295));await Promise[_0x13c938(0x20a)](_0x5900b8),_0x18b7bf[_0x13c938(0x1ca)](_0x3535bf);}),router[a0_0x2caa7d(0x1dc)](a0_0x2caa7d(0x224),async(_0x569d1d,_0x423d5a)=>{var _0x56b6d4=a0_0x2caa7d;const {productCode:_0x2bd1ba,bay:_0x1a8a46,warehouses:_0x4cc08b,room:_0x7d58b5}=_0x569d1d[_0x56b6d4(0x1d1)];console[_0x56b6d4(0x23d)](_0x569d1d[_0x56b6d4(0x1d1)]);try{const _0xd62714=await warehouse[_0x56b6d4(0x1c7)]([{'$match':{'name':_0x4cc08b,'room':_0x7d58b5}},{'$unwind':_0x56b6d4(0x1d8)},{'$match':{'product_details.bay':parseInt(_0x1a8a46)}},{'$group':{'_id':_0x56b6d4(0x22e),'name':{'$first':_0x56b6d4(0x209)},'product_stock':{'$first':_0x56b6d4(0x248)},'bay':{'$first':_0x56b6d4(0x1c9)},'maxProducts':{'$first':_0x56b6d4(0x201)}}}]);_0x423d5a[_0x56b6d4(0x1c8)](0xc8)[_0x56b6d4(0x1ca)](_0xd62714);}catch(_0x321d3f){_0x423d5a['status'](0x194)[_0x56b6d4(0x1ca)]({'message':_0x321d3f[_0x56b6d4(0x1cd)]});}}),module[a0_0x2caa7d(0x1c4)]=router;