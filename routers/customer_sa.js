const a0_0xa45cf=a0_0x20a2;(function(_0x415f37,_0x4b92fa){const _0x1f4303=a0_0x20a2,_0x543c4d=_0x415f37();while(!![]){try{const _0x3227ab=parseInt(_0x1f4303(0x146))/0x1*(parseInt(_0x1f4303(0x162))/0x2)+parseInt(_0x1f4303(0x168))/0x3+-parseInt(_0x1f4303(0x163))/0x4+-parseInt(_0x1f4303(0x139))/0x5*(-parseInt(_0x1f4303(0x16f))/0x6)+-parseInt(_0x1f4303(0x184))/0x7+-parseInt(_0x1f4303(0x15e))/0x8+parseInt(_0x1f4303(0x128))/0x9;if(_0x3227ab===_0x4b92fa)break;else _0x543c4d['push'](_0x543c4d['shift']());}catch(_0x2a7eab){_0x543c4d['push'](_0x543c4d['shift']());}}}(a0_0x53c9,0x75290));const express=require(a0_0xa45cf(0x165)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0xa45cf(0x15c)),users=require(a0_0xa45cf(0x132)),excelJS=require(a0_0xa45cf(0x11f)),xlsx=require('xlsx'),multer=require(a0_0xa45cf(0x178));router[a0_0xa45cf(0x15d)](a0_0xa45cf(0x153),auth,async(_0x2846ca,_0x511125)=>{const _0x15309b=a0_0xa45cf;try{const {username:_0xea55a4,email:_0x530018,role:_0x5180f6}=_0x2846ca['user'],_0x21355e=_0x2846ca[_0x15309b(0x134)],_0x5bd8bc=await profile[_0x15309b(0x181)]({'email':_0x21355e[_0x15309b(0x122)]}),_0x235faf=await master_shop[_0x15309b(0x160)](),_0x35fa33=await staff[_0x15309b(0x181)]({'email':_0x21355e[_0x15309b(0x122)]}),_0x1f72a0=await customer[_0x15309b(0x160)]({'agent_id':_0x35fa33['_id']}),_0x2e3ced=await customer[_0x15309b(0x156)]([{'$match':{'agent_id':_0x35fa33['_id']['valueOf']()}},{'$lookup':{'from':'c_payments','localField':_0x15309b(0x151),'foreignField':_0x15309b(0x11e),'as':'customer_docs'}}]),_0xd18035=_0x2e3ced[_0x15309b(0x150)](_0x43b8fe=>{const _0x1f7a78=_0x15309b;console[_0x1f7a78(0x12a)]('data',_0x43b8fe);var _0x369ec4=0x0,_0x23525b=0x0;return _0x43b8fe[_0x1f7a78(0x171)][_0x1f7a78(0x17f)](_0x30bed1=>{const _0x31b3a6=_0x1f7a78;console[_0x31b3a6(0x12a)](_0x31b3a6(0x12b),_0x30bed1),_0x30bed1[_0x31b3a6(0x161)]==_0x31b3a6(0x17d)?_0x369ec4+=_0x30bed1[_0x31b3a6(0x173)]:_0x23525b+=_0x30bed1[_0x31b3a6(0x173)];}),_0x43b8fe['sale']=parseFloat(_0x369ec4)+0x0,_0x43b8fe[_0x1f7a78(0x187)]=parseFloat(_0x23525b)+0x0,_0x43b8fe;});if(_0x235faf[0x0]['language']==_0x15309b(0x144)){var _0x1212d5=users['English'];console[_0x15309b(0x12a)](_0x1212d5);}else{if(_0x235faf[0x0]['language']==_0x15309b(0x155))var _0x1212d5=users['Hindi'];else{if(_0x235faf[0x0][_0x15309b(0x136)]==_0x15309b(0x13f))var _0x1212d5=users[_0x15309b(0x13f)];else{if(_0x235faf[0x0]['language']==_0x15309b(0x147))var _0x1212d5=users[_0x15309b(0x147)];else{if(_0x235faf[0x0][_0x15309b(0x136)]=='French')var _0x1212d5=users[_0x15309b(0x182)];else{if(_0x235faf[0x0][_0x15309b(0x136)]==_0x15309b(0x17e))var _0x1212d5=users[_0x15309b(0x131)];else{if(_0x235faf[0x0][_0x15309b(0x136)]==_0x15309b(0x14f))var _0x1212d5=users[_0x15309b(0x14f)];else{if(_0x235faf[0x0]['language']=='Arabic\x20(ae)')var _0x1212d5=users[_0x15309b(0x154)];}}}}}}}_0x511125[_0x15309b(0x185)](_0x15309b(0x179),{'success':_0x2846ca['flash'](_0x15309b(0x16d)),'errors':_0x2846ca[_0x15309b(0x17a)](_0x15309b(0x125)),'user':_0x1f72a0,'role':_0x21355e,'profile':_0x5bd8bc,'master_shop':_0x235faf,'language':_0x1212d5,'agent_id':_0x35fa33[_0x15309b(0x143)],'payment':_0xd18035,'staff_arr':_0x35fa33});}catch(_0x2aece3){console[_0x15309b(0x12a)](_0x2aece3);}}),router['post'](a0_0xa45cf(0x153),auth,async(_0x2fbc65,_0x56607d)=>{const _0x5c4c58=a0_0xa45cf;try{const {name:_0x5aa205,address:_0x5b2a19,mobile:_0x4d6f39,email:_0x5c1082,receivable:_0xfee1a7,payable:_0x244fbb,contactperson:_0x52d655,landline:_0x587a28,agent_id:_0x5cf717,less_percent:_0x54d533,type_org:_0x83dea2,res_address:_0x40142b,business_start_year:_0x348603,credit_limit:_0x3892f3,term_pay:_0x538d62}=_0x2fbc65[_0x5c4c58(0x140)];if(typeof _0x54d533==_0x5c4c58(0x16b))var _0x18428c=[_0x2fbc65[_0x5c4c58(0x140)][_0x5c4c58(0x15a)]];else var _0x18428c=[..._0x2fbc65[_0x5c4c58(0x140)][_0x5c4c58(0x15a)]];const _0x55e5c7=_0x18428c[_0x5c4c58(0x150)](_0x28086d=>{return _0x28086d={'less':_0x28086d};}),_0x4766ed=new customer({'name':_0x5aa205,'address':_0x5b2a19,'mobile':_0x4d6f39,'email':_0x5c1082,'receivable':_0xfee1a7,'payable':_0x244fbb,'customer_discount':_0x55e5c7,'contactperson':_0x52d655,'landline':_0x587a28,'agent_id':_0x5cf717,'res_address':_0x40142b,'type_organization':_0x83dea2,'business_start_year':_0x348603,'credit_limit':_0x3892f3,'terms_of_payments':_0x538d62}),_0x555554=await _0x4766ed['save']();_0x2fbc65['flash'](_0x5c4c58(0x16d),'customer\x20add\x20successfully'),_0x56607d['redirect'](_0x5c4c58(0x13c));}catch(_0x6db656){console[_0x5c4c58(0x12a)](_0x6db656);}}),router['get'](a0_0xa45cf(0x14e),auth,async(_0x34a52b,_0x207c21)=>{const _0x580604=a0_0xa45cf;try{const {username:_0x5a039e,email:_0x15238a,role:_0x478c26}=_0x34a52b[_0x580604(0x134)],_0xf42fe0=_0x34a52b[_0x580604(0x134)],_0x1f6f11=await profile['findOne']({'email':_0xf42fe0[_0x580604(0x122)]}),_0x56adbf=await master_shop[_0x580604(0x160)]();console[_0x580604(0x12a)]('master',_0x56adbf);const _0x454ada=_0x34a52b[_0x580604(0x120)]['id'],_0x463ae5=await customer[_0x580604(0x138)](_0x454ada);console['log'](_0x463ae5);if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x144)){var _0xa1105b=users[_0x580604(0x17c)];console[_0x580604(0x12a)](_0xa1105b);}else{if(_0x56adbf[0x0]['language']=='Hindi')var _0xa1105b=users[_0x580604(0x155)];else{if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x13f))var _0xa1105b=users['German'];else{if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x147))var _0xa1105b=users[_0x580604(0x147)];else{if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x182))var _0xa1105b=users[_0x580604(0x182)];else{if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x17e))var _0xa1105b=users[_0x580604(0x131)];else{if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x14f))var _0xa1105b=users[_0x580604(0x14f)];else{if(_0x56adbf[0x0][_0x580604(0x136)]==_0x580604(0x166))var _0xa1105b=users[_0x580604(0x154)];}}}}}}}_0x207c21[_0x580604(0x185)](_0x580604(0x179),{'success':_0x34a52b['flash'](_0x580604(0x16d)),'errors':_0x34a52b[_0x580604(0x17a)]('errors'),'role':_0xf42fe0,'profile':_0x1f6f11,'user':_0x463ae5,'master_shop':_0x56adbf,'language':_0xa1105b});}catch(_0x18b31d){console[_0x580604(0x12a)](_0x18b31d);}}),router[a0_0xa45cf(0x11d)](a0_0xa45cf(0x14e),auth,async(_0x495c03,_0x5456e1)=>{const _0x351201=a0_0xa45cf;try{const _0x46791a=_0x495c03[_0x351201(0x120)]['id'],_0x4ea86a=await customer[_0x351201(0x138)](_0x46791a),{name:_0x122a38,address:_0x4d566a,mobile:_0x37001c,email:_0x137752,receivable:_0x34350c,payable:_0x4f03c3,contactperson:_0x1a0039,landline:_0x468413,less_percent_edit:_0x3acb50,edit_type_org:_0x1e5903,edit_res_address:_0x1ae8b8,edit_business_start_year:_0x5731f6,edit_credit_limit:_0x3c05e6,edit_term_pay:_0x21d6ce}=_0x495c03[_0x351201(0x140)];if(typeof _0x3acb50==_0x351201(0x16b))var _0x4b48fb=[_0x495c03[_0x351201(0x140)][_0x351201(0x159)]];else var _0x4b48fb=[..._0x495c03[_0x351201(0x140)][_0x351201(0x159)]];const _0x4b2e05=_0x4b48fb[_0x351201(0x150)](_0x3623fa=>{return _0x3623fa={'less':_0x3623fa};});_0x4ea86a[_0x351201(0x151)]=_0x122a38,_0x4ea86a[_0x351201(0x12c)]=_0x4d566a,_0x4ea86a[_0x351201(0x170)]=_0x37001c,_0x4ea86a[_0x351201(0x122)]=_0x137752,_0x4ea86a[_0x351201(0x180)]=_0x34350c,_0x4ea86a['payable']=_0x4f03c3,_0x4ea86a[_0x351201(0x130)]=_0x1a0039,_0x4ea86a[_0x351201(0x129)]=_0x468413,_0x4ea86a['customer_discount']=_0x4b2e05,_0x4ea86a[_0x351201(0x186)]=_0x1e5903,_0x4ea86a[_0x351201(0x149)]=_0x5731f6,_0x4ea86a[_0x351201(0x11b)]=_0x3c05e6,_0x4ea86a['terms_of_payments']=_0x21d6ce,_0x4ea86a[_0x351201(0x119)]=_0x1ae8b8;const _0x800730=await _0x4ea86a['save']();_0x495c03[_0x351201(0x17a)](_0x351201(0x16d),'customer\x20update\x20successfully'),_0x5456e1[_0x351201(0x15b)](_0x351201(0x13c));}catch(_0x4f2615){console[_0x351201(0x12a)](_0x4f2615);}}),router[a0_0xa45cf(0x15d)]('/view/payment/:id',auth,async(_0xd7db6b,_0x382850)=>{const _0x58ded0=a0_0xa45cf;try{const {username:_0x5d9fba,email:_0x59fe07,role:_0x5097a0}=_0xd7db6b[_0x58ded0(0x134)],_0x500e9d=_0xd7db6b[_0x58ded0(0x134)],_0x3a2cf9=await profile[_0x58ded0(0x181)]({'email':_0x500e9d['email']}),_0x333d50=await master_shop[_0x58ded0(0x160)]();console[_0x58ded0(0x12a)](_0x58ded0(0x13a),_0x333d50),console[_0x58ded0(0x12a)](_0xd7db6b['params']['id']);const _0x41abf6=await customer[_0x58ded0(0x181)]({'_id':_0xd7db6b[_0x58ded0(0x120)]['id']});console[_0x58ded0(0x12a)](_0x58ded0(0x11a),_0x41abf6);const _0xb44b40=await c_payment_data[_0x58ded0(0x160)]({'customer':_0x41abf6[_0x58ded0(0x151)]});console[_0x58ded0(0x12a)](_0xb44b40);const _0x4d47d8=await c_payment_data['aggregate']([{'$match':{'customer':_0x41abf6[_0x58ded0(0x151)]}},{'$match':{'reason':_0x58ded0(0x17d)}},{'$group':{'_id':_0x58ded0(0x137),'sum':{'$sum':'$amount'}}}]);console[_0x58ded0(0x12a)]('payable_sum',_0x4d47d8);const _0x4c0828=await c_payment_data[_0x58ded0(0x156)]([{'$match':{'customer':_0x41abf6[_0x58ded0(0x151)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x58ded0(0x137),'sum':{'$sum':_0x58ded0(0x174)}}}]);console[_0x58ded0(0x12a)](_0x58ded0(0x14a),_0x4c0828);if(_0x333d50[0x0]['language']==_0x58ded0(0x144)){var _0x35a5de=users[_0x58ded0(0x17c)];console[_0x58ded0(0x12a)](_0x35a5de);}else{if(_0x333d50[0x0]['language']==_0x58ded0(0x155))var _0x35a5de=users['Hindi'];else{if(_0x333d50[0x0][_0x58ded0(0x136)]==_0x58ded0(0x13f))var _0x35a5de=users['German'];else{if(_0x333d50[0x0]['language']=='Spanish')var _0x35a5de=users[_0x58ded0(0x147)];else{if(_0x333d50[0x0][_0x58ded0(0x136)]=='French')var _0x35a5de=users[_0x58ded0(0x182)];else{if(_0x333d50[0x0][_0x58ded0(0x136)]==_0x58ded0(0x17e))var _0x35a5de=users[_0x58ded0(0x131)];else{if(_0x333d50[0x0][_0x58ded0(0x136)]=='Chinese')var _0x35a5de=users[_0x58ded0(0x14f)];else{if(_0x333d50[0x0][_0x58ded0(0x136)]==_0x58ded0(0x166))var _0x35a5de=users[_0x58ded0(0x154)];}}}}}}}_0x382850[_0x58ded0(0x185)](_0x58ded0(0x126),{'success':_0xd7db6b[_0x58ded0(0x17a)]('success'),'errors':_0xd7db6b[_0x58ded0(0x17a)]('errors'),'role':_0x500e9d,'profile':_0x3a2cf9,'payment':_0xb44b40,'payable':_0x4d47d8,'receivable':_0x4c0828,'master_shop':_0x333d50,'language':_0x35a5de});}catch(_0x4bda0d){console[_0x58ded0(0x12a)](_0x4bda0d);}}),router[a0_0xa45cf(0x15d)](a0_0xa45cf(0x17b),auth,async(_0xf0eaf0,_0xcbfeba)=>{const _0x466baa=a0_0xa45cf;try{const _0x4f84c9=new excelJS[(_0x466baa(0x177))](),_0x3dde23=_0x4f84c9[_0x466baa(0x16a)]('Customers');return _0x3dde23[_0x466baa(0x169)]=[{'header':'ID','key':_0x466baa(0x11c),'width':0xa},{'header':_0x466baa(0x141),'key':'PBrands','width':0xa},{'header':_0x466baa(0x124),'key':_0x466baa(0x152),'width':0xa},{'header':_0x466baa(0x13b),'key':_0x466baa(0x13b),'width':0xa},{'header':_0x466baa(0x12c),'key':_0x466baa(0x12c),'width':0xa},{'header':_0x466baa(0x170),'key':_0x466baa(0x170),'width':0xa},{'header':_0x466baa(0x122),'key':_0x466baa(0x122),'width':0xa}],_0xcbfeba['setHeader'](_0x466baa(0x15f),_0x466baa(0x14b)),_0xcbfeba[_0x466baa(0x167)](_0x466baa(0x189),_0x466baa(0x12d)),_0x4f84c9[_0x466baa(0x172)][_0x466baa(0x14c)](_0xcbfeba)[_0x466baa(0x157)](()=>{const _0x449a19=_0x466baa;_0xcbfeba[_0x449a19(0x183)](0xc8);});}catch(_0x2ba2d6){_0xcbfeba[_0x466baa(0x183)](0x190)[_0x466baa(0x12f)]({'errors':_0x2ba2d6['message']});}});const storage1=multer[a0_0xa45cf(0x158)]({'destination':(_0x368e8b,_0xb5c1bd,_0x51ab79)=>{_0x51ab79(null,'public/Migration');},'filename':(_0x49c949,_0x534b73,_0x599759)=>{const _0x8f8e57=a0_0xa45cf;_0x599759(null,Date[_0x8f8e57(0x12e)]()+_0x534b73[_0x8f8e57(0x145)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x20a2(_0x345b1d,_0xa29ed4){const _0x53c9a5=a0_0x53c9();return a0_0x20a2=function(_0x20a221,_0x5d4e13){_0x20a221=_0x20a221-0x119;let _0x1c1612=_0x53c9a5[_0x20a221];return _0x1c1612;},a0_0x20a2(_0x345b1d,_0xa29ed4);}function a0_0x53c9(){const _0x772484=['Content-Disposition','res_address','customer_data','credit_limit','PName','post','customer','exceljs','params','single','email','file','SalesmanCode','errors','customer_payment','public/Migration/','5495796UowOFa','landline','log','element','address','attachment;\x20filename=customer_Migration_File.xlsx','now','send','contactperson','Portuguese','../public/language/languages.json','utils','user','/customer_import_migrate_file','language','$reason','findById','2164795TmHuWB','master','SalesmanName','/customer_sa/view','Sheets','exports','German','body','Name','save','_id','English\x20(US)','originalname','28301Bqvice','Spanish','filename','business_start_year','receivable_sum','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','write','customer_product_fule','/view/:id','Chinese','map','name','PUnits','/view','Arabic','Hindi','aggregate','then','diskStorage','less_percent_edit','less_percent','redirect','../middleware/auth','get','69888JtBpLD','Content-Type','find','reason','50PNgIYO','2836900kLnLcg','\x20Failed','express','Arabic\x20(ae)','setHeader','314757rKZdKA','columns','addWorksheet','string','sheet_to_json','success','SheetNames','6HuVYbx','mobile','customer_docs','xlsx','amount','$amount','readFile','error','Workbook','multer','customer_sa','flash','/products_export_migrate_file','English','Sale','Portuguese\x20(BR)','forEach','receivable','findOne','French','status','4607386ZQovwZ','render','type_organization','sale_return','json'];a0_0x53c9=function(){return _0x772484;};return a0_0x53c9();}router[a0_0xa45cf(0x11d)](a0_0xa45cf(0x135),auth,uploadMigrate[a0_0xa45cf(0x121)](a0_0xa45cf(0x14d)),async(_0xcaf33b,_0x6bf85b)=>{const _0x2a1872=a0_0xa45cf,_0xcebd6d=_0xcaf33b[_0x2a1872(0x123)][_0x2a1872(0x148)],_0x1d1760=await xlsx[_0x2a1872(0x175)](_0x2a1872(0x127)+_0xcebd6d);let _0x3b1aff=_0x1d1760[_0x2a1872(0x16e)],_0x4a6eb8=xlsx[_0x2a1872(0x133)][_0x2a1872(0x16c)](_0x1d1760[_0x2a1872(0x13d)][_0x3b1aff[0x0]]);for(const _0x20de4d of _0x4a6eb8){const _0x1ce877=_0x20de4d['ID'],_0x3dad8c=_0x20de4d[_0x2a1872(0x141)],_0x4f38e2=_0x20de4d[_0x2a1872(0x124)],_0x525997=_0x20de4d[_0x2a1872(0x13b)],_0x2fc848=_0x20de4d['address'],_0x5c82e3=_0x20de4d[_0x2a1872(0x170)],_0x53ae65=_0x20de4d[_0x2a1872(0x122)];try{let _0x1c4ec5=await customer[_0x2a1872(0x181)]({'name':_0x3dad8c});if(!_0x1c4ec5){const _0x2c7a36=new customer({'name':_0x3dad8c,'ID':_0x1ce877,'SalesmanCode':_0x4f38e2,'SalesmanName':_0x525997,'address':_0x2fc848,'mobile':_0x5c82e3,'email':_0x53ae65});_0x1c4ec5=await _0x2c7a36[_0x2a1872(0x142)](),_0xcaf33b[_0x2a1872(0x17a)](_0x2a1872(0x16d),_0x3dad8c+'\x20added\x20successfully');}else _0xcaf33b[_0x2a1872(0x17a)](_0x2a1872(0x176),_0x3dad8c+_0x2a1872(0x164));}catch(_0x528741){_0x6bf85b[_0x2a1872(0x183)](0x1f4)[_0x2a1872(0x188)]({'proderror':_0x528741['message'],'aproduct':ProductName});}}_0x6bf85b['redirect']('/customer_sa/view');}),module[a0_0xa45cf(0x13e)]=router;