const a0_0x4ec2cf=a0_0x531e;function a0_0x4985(){const _0x4d4962=['_id','render','exceljs','findById','PName','public/Migration/','Workbook','xlsx','status','multer','file','Arabic\x20(ae)','Spanish','2615604LPsMdj','name','French','4MRVXFs','aggregate','/customer_sa/view','less_percent_edit','then','4387860dOuJww','address','Content-Type','508737vgToEo','map','customer\x20add\x20successfully','forEach','find','business_start_year','express','SalesmanCode','Customers','PBrands','success','Portuguese\x20(BR)','save','SheetNames','mobile','attachment;\x20filename=customer_Migration_File.xlsx','Sale\x20Return','readFile','customer_sa','Arabic','Sheets','Name','\x20Failed','res_address','filename','$reason','post','flash','receivable_sum','log','error','3iBFIAI','exports','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','/view/:id','6399468lUVDmS','master','customer_discount','string','user','reason','originalname','sale','$amount','message','body','/view','amount','columns','../middleware/auth','redirect','landline','diskStorage','6971076ikqEfF','Content-Disposition','Hindi','errors','Sale','now','6949715ywLpao','email','Portuguese','data','/view/payment/:id','customer_product_fule','customer_data','110544xEfbYi','English','addWorksheet','Chinese','valueOf','single','sale_return','findOne','setHeader','public/Migration','\x20added\x20successfully','Router','credit_limit','params','terms_of_payments','PUnits','less_percent','German','get','contactperson','language','sheet_to_json','type_organization','SalesmanName','English\x20(US)','payable','receivable','customer_payment'];a0_0x4985=function(){return _0x4d4962;};return a0_0x4985();}(function(_0x39e111,_0x5e3cde){const _0x395a27=a0_0x531e,_0x4f2c8d=_0x39e111();while(!![]){try{const _0x4dc8dc=-parseInt(_0x395a27(0x1ec))/0x1*(-parseInt(_0x395a27(0x1e4))/0x2)+parseInt(_0x395a27(0x195))/0x3*(-parseInt(_0x395a27(0x199))/0x4)+parseInt(_0x395a27(0x1b1))/0x5+-parseInt(_0x395a27(0x1e1))/0x6+parseInt(_0x395a27(0x1ab))/0x7+-parseInt(_0x395a27(0x1b8))/0x8+-parseInt(_0x395a27(0x1e9))/0x9;if(_0x4dc8dc===_0x5e3cde)break;else _0x4f2c8d['push'](_0x4f2c8d['shift']());}catch(_0x50cb58){_0x4f2c8d['push'](_0x4f2c8d['shift']());}}}(a0_0x4985,0xd374e));function a0_0x531e(_0x59dd1f,_0x4949fb){const _0x49858b=a0_0x4985();return a0_0x531e=function(_0x531e86,_0x2a2dd5){_0x531e86=_0x531e86-0x180;let _0x485211=_0x49858b[_0x531e86];return _0x485211;},a0_0x531e(_0x59dd1f,_0x4949fb);}const express=require(a0_0x4ec2cf(0x1f2)),app=express(),router=express[a0_0x4ec2cf(0x1c3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x4ec2cf(0x1a7)),users=require('../public/language/languages.json'),excelJS=require(a0_0x4ec2cf(0x1d6)),xlsx=require(a0_0x4ec2cf(0x1db)),multer=require(a0_0x4ec2cf(0x1dd));router[a0_0x4ec2cf(0x1ca)](a0_0x4ec2cf(0x1a4),auth,async(_0x5361a8,_0x318811)=>{const _0x1ee4cd=a0_0x4ec2cf;try{const {username:_0x37425c,email:_0x3a4394,role:_0x11e346}=_0x5361a8[_0x1ee4cd(0x19d)],_0x34f441=_0x5361a8[_0x1ee4cd(0x19d)],_0x15994e=await profile[_0x1ee4cd(0x1bf)]({'email':_0x34f441['email']}),_0x80613a=await master_shop['find'](),_0x46b046=await staff[_0x1ee4cd(0x1bf)]({'email':_0x34f441[_0x1ee4cd(0x1b2)]}),_0x3e0914=await customer['find']({'agent_id':_0x46b046[_0x1ee4cd(0x1d4)]}),_0x2ce0ef=await customer[_0x1ee4cd(0x1e5)]([{'$match':{'agent_id':_0x46b046[_0x1ee4cd(0x1d4)][_0x1ee4cd(0x1bc)]()}},{'$lookup':{'from':'c_payments','localField':_0x1ee4cd(0x1e2),'foreignField':'customer','as':'customer_docs'}}]),_0x341d35=_0x2ce0ef[_0x1ee4cd(0x1ed)](_0x3ec713=>{const _0x77ae9f=_0x1ee4cd;console[_0x77ae9f(0x193)](_0x77ae9f(0x1b4),_0x3ec713);var _0x47302a=0x0,_0x5e74e4=0x0;return _0x3ec713['customer_docs'][_0x77ae9f(0x1ef)](_0x5c8a70=>{const _0x22ae6f=_0x77ae9f;console[_0x22ae6f(0x193)]('element',_0x5c8a70),_0x5c8a70[_0x22ae6f(0x19e)]==_0x22ae6f(0x1af)?_0x47302a+=_0x5c8a70[_0x22ae6f(0x1a5)]:_0x5e74e4+=_0x5c8a70['amount'];}),_0x3ec713[_0x77ae9f(0x1a0)]=parseFloat(_0x47302a)+0x0,_0x3ec713[_0x77ae9f(0x1be)]=parseFloat(_0x5e74e4)+0x0,_0x3ec713;});if(_0x80613a[0x0]['language']==_0x1ee4cd(0x1d0)){var _0x33bd79=users[_0x1ee4cd(0x1b9)];console['log'](_0x33bd79);}else{if(_0x80613a[0x0][_0x1ee4cd(0x1cc)]==_0x1ee4cd(0x1ad))var _0x33bd79=users['Hindi'];else{if(_0x80613a[0x0]['language']==_0x1ee4cd(0x1c9))var _0x33bd79=users[_0x1ee4cd(0x1c9)];else{if(_0x80613a[0x0][_0x1ee4cd(0x1cc)]==_0x1ee4cd(0x1e0))var _0x33bd79=users[_0x1ee4cd(0x1e0)];else{if(_0x80613a[0x0][_0x1ee4cd(0x1cc)]=='French')var _0x33bd79=users[_0x1ee4cd(0x1e3)];else{if(_0x80613a[0x0][_0x1ee4cd(0x1cc)]==_0x1ee4cd(0x181))var _0x33bd79=users[_0x1ee4cd(0x1b3)];else{if(_0x80613a[0x0][_0x1ee4cd(0x1cc)]==_0x1ee4cd(0x1bb))var _0x33bd79=users[_0x1ee4cd(0x1bb)];else{if(_0x80613a[0x0][_0x1ee4cd(0x1cc)]==_0x1ee4cd(0x1df))var _0x33bd79=users[_0x1ee4cd(0x189)];}}}}}}}_0x318811['render'](_0x1ee4cd(0x188),{'success':_0x5361a8['flash']('success'),'errors':_0x5361a8[_0x1ee4cd(0x191)]('errors'),'user':_0x3e0914,'role':_0x34f441,'profile':_0x15994e,'master_shop':_0x80613a,'language':_0x33bd79,'agent_id':_0x46b046[_0x1ee4cd(0x1d4)],'payment':_0x341d35,'staff_arr':_0x46b046});}catch(_0x19f7fa){console[_0x1ee4cd(0x193)](_0x19f7fa);}}),router[a0_0x4ec2cf(0x190)](a0_0x4ec2cf(0x1a4),auth,async(_0x49ec19,_0x5b259c)=>{const _0x451fb1=a0_0x4ec2cf;try{const {name:_0x5075c1,address:_0x495873,mobile:_0x4ec75f,email:_0x400b9f,receivable:_0xcfd3cf,payable:_0x42b7e7,contactperson:_0xa9ac7f,landline:_0x376491,agent_id:_0x2952c9,less_percent:_0x567c8f,type_org:_0x28f575,res_address:_0xd06e09,business_start_year:_0x48b523,credit_limit:_0xca82d1,term_pay:_0x1b967c}=_0x49ec19[_0x451fb1(0x1a3)];if(typeof _0x567c8f==_0x451fb1(0x19c))var _0xad4af9=[_0x49ec19[_0x451fb1(0x1a3)][_0x451fb1(0x1c8)]];else var _0xad4af9=[..._0x49ec19[_0x451fb1(0x1a3)]['less_percent']];const _0x1e687f=_0xad4af9[_0x451fb1(0x1ed)](_0x474188=>{return _0x474188={'less':_0x474188};}),_0x489a05=new customer({'name':_0x5075c1,'address':_0x495873,'mobile':_0x4ec75f,'email':_0x400b9f,'receivable':_0xcfd3cf,'payable':_0x42b7e7,'customer_discount':_0x1e687f,'contactperson':_0xa9ac7f,'landline':_0x376491,'agent_id':_0x2952c9,'res_address':_0xd06e09,'type_organization':_0x28f575,'business_start_year':_0x48b523,'credit_limit':_0xca82d1,'terms_of_payments':_0x1b967c}),_0x3932b0=await _0x489a05[_0x451fb1(0x182)]();_0x49ec19['flash']('success',_0x451fb1(0x1ee)),_0x5b259c['redirect'](_0x451fb1(0x1e6));}catch(_0x3f3c6e){console[_0x451fb1(0x193)](_0x3f3c6e);}}),router[a0_0x4ec2cf(0x1ca)](a0_0x4ec2cf(0x198),auth,async(_0x2fd2de,_0x42b5ad)=>{const _0x2dd864=a0_0x4ec2cf;try{const {username:_0x2551ea,email:_0x2be506,role:_0x625e1}=_0x2fd2de[_0x2dd864(0x19d)],_0xd53900=_0x2fd2de[_0x2dd864(0x19d)],_0x59cfab=await profile[_0x2dd864(0x1bf)]({'email':_0xd53900[_0x2dd864(0x1b2)]}),_0x3f9cf5=await master_shop[_0x2dd864(0x1f0)]();console['log'](_0x2dd864(0x19a),_0x3f9cf5);const _0x4a9b14=_0x2fd2de['params']['id'],_0xaee8e1=await customer['findById'](_0x4a9b14);console[_0x2dd864(0x193)](_0xaee8e1);if(_0x3f9cf5[0x0][_0x2dd864(0x1cc)]==_0x2dd864(0x1d0)){var _0x42b86a=users[_0x2dd864(0x1b9)];console[_0x2dd864(0x193)](_0x42b86a);}else{if(_0x3f9cf5[0x0]['language']==_0x2dd864(0x1ad))var _0x42b86a=users[_0x2dd864(0x1ad)];else{if(_0x3f9cf5[0x0]['language']=='German')var _0x42b86a=users[_0x2dd864(0x1c9)];else{if(_0x3f9cf5[0x0][_0x2dd864(0x1cc)]=='Spanish')var _0x42b86a=users['Spanish'];else{if(_0x3f9cf5[0x0][_0x2dd864(0x1cc)]==_0x2dd864(0x1e3))var _0x42b86a=users['French'];else{if(_0x3f9cf5[0x0][_0x2dd864(0x1cc)]==_0x2dd864(0x181))var _0x42b86a=users[_0x2dd864(0x1b3)];else{if(_0x3f9cf5[0x0]['language']==_0x2dd864(0x1bb))var _0x42b86a=users['Chinese'];else{if(_0x3f9cf5[0x0]['language']==_0x2dd864(0x1df))var _0x42b86a=users[_0x2dd864(0x189)];}}}}}}}_0x42b5ad['render'](_0x2dd864(0x188),{'success':_0x2fd2de[_0x2dd864(0x191)](_0x2dd864(0x180)),'errors':_0x2fd2de[_0x2dd864(0x191)](_0x2dd864(0x1ae)),'role':_0xd53900,'profile':_0x59cfab,'user':_0xaee8e1,'master_shop':_0x3f9cf5,'language':_0x42b86a});}catch(_0x100dfb){console[_0x2dd864(0x193)](_0x100dfb);}}),router[a0_0x4ec2cf(0x190)](a0_0x4ec2cf(0x198),auth,async(_0x58538c,_0x31e561)=>{const _0x52cf57=a0_0x4ec2cf;try{const _0x182c56=_0x58538c[_0x52cf57(0x1c5)]['id'],_0x407b81=await customer[_0x52cf57(0x1d7)](_0x182c56),{name:_0x1f99fb,address:_0x25c21a,mobile:_0x5c8038,email:_0x11c1f0,receivable:_0x4bb32e,payable:_0x587385,contactperson:_0x2c5c01,landline:_0x50ee76,less_percent_edit:_0x590407,edit_type_org:_0x506e8b,edit_res_address:_0x4d4b7e,edit_business_start_year:_0x275acb,edit_credit_limit:_0x671af7,edit_term_pay:_0x1af3db}=_0x58538c[_0x52cf57(0x1a3)];if(typeof _0x590407==_0x52cf57(0x19c))var _0x14a16e=[_0x58538c['body'][_0x52cf57(0x1e7)]];else var _0x14a16e=[..._0x58538c['body'][_0x52cf57(0x1e7)]];const _0x32bba2=_0x14a16e[_0x52cf57(0x1ed)](_0xbc308c=>{return _0xbc308c={'less':_0xbc308c};});_0x407b81[_0x52cf57(0x1e2)]=_0x1f99fb,_0x407b81[_0x52cf57(0x1ea)]=_0x25c21a,_0x407b81[_0x52cf57(0x184)]=_0x5c8038,_0x407b81['email']=_0x11c1f0,_0x407b81[_0x52cf57(0x1d2)]=_0x4bb32e,_0x407b81[_0x52cf57(0x1d1)]=_0x587385,_0x407b81[_0x52cf57(0x1cb)]=_0x2c5c01,_0x407b81[_0x52cf57(0x1a9)]=_0x50ee76,_0x407b81[_0x52cf57(0x19b)]=_0x32bba2,_0x407b81[_0x52cf57(0x1ce)]=_0x506e8b,_0x407b81[_0x52cf57(0x1f1)]=_0x275acb,_0x407b81[_0x52cf57(0x1c4)]=_0x671af7,_0x407b81[_0x52cf57(0x1c6)]=_0x1af3db,_0x407b81[_0x52cf57(0x18d)]=_0x4d4b7e;const _0x3bb601=await _0x407b81[_0x52cf57(0x182)]();_0x58538c[_0x52cf57(0x191)](_0x52cf57(0x180),'customer\x20update\x20successfully'),_0x31e561[_0x52cf57(0x1a8)]('/customer_sa/view');}catch(_0x49b4cd){console['log'](_0x49b4cd);}}),router[a0_0x4ec2cf(0x1ca)](a0_0x4ec2cf(0x1b5),auth,async(_0x334319,_0x1ef1e0)=>{const _0x38a7a6=a0_0x4ec2cf;try{const {username:_0x13aa29,email:_0x2f0ad5,role:_0x431a1b}=_0x334319[_0x38a7a6(0x19d)],_0x4c3d43=_0x334319[_0x38a7a6(0x19d)],_0x370a8a=await profile[_0x38a7a6(0x1bf)]({'email':_0x4c3d43['email']}),_0x379c6d=await master_shop['find']();console['log'](_0x38a7a6(0x19a),_0x379c6d),console[_0x38a7a6(0x193)](_0x334319[_0x38a7a6(0x1c5)]['id']);const _0x5d29a4=await customer['findOne']({'_id':_0x334319[_0x38a7a6(0x1c5)]['id']});console[_0x38a7a6(0x193)](_0x38a7a6(0x1b7),_0x5d29a4);const _0x4a0fb8=await c_payment_data[_0x38a7a6(0x1f0)]({'customer':_0x5d29a4[_0x38a7a6(0x1e2)]});console[_0x38a7a6(0x193)](_0x4a0fb8);const _0x2916a6=await c_payment_data[_0x38a7a6(0x1e5)]([{'$match':{'customer':_0x5d29a4[_0x38a7a6(0x1e2)]}},{'$match':{'reason':_0x38a7a6(0x1af)}},{'$group':{'_id':_0x38a7a6(0x18f),'sum':{'$sum':_0x38a7a6(0x1a1)}}}]);console[_0x38a7a6(0x193)]('payable_sum',_0x2916a6);const _0x5bd328=await c_payment_data['aggregate']([{'$match':{'customer':_0x5d29a4[_0x38a7a6(0x1e2)]}},{'$match':{'reason':_0x38a7a6(0x186)}},{'$group':{'_id':_0x38a7a6(0x18f),'sum':{'$sum':_0x38a7a6(0x1a1)}}}]);console[_0x38a7a6(0x193)](_0x38a7a6(0x192),_0x5bd328);if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]==_0x38a7a6(0x1d0)){var _0x1552ef=users[_0x38a7a6(0x1b9)];console[_0x38a7a6(0x193)](_0x1552ef);}else{if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]==_0x38a7a6(0x1ad))var _0x1552ef=users[_0x38a7a6(0x1ad)];else{if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]==_0x38a7a6(0x1c9))var _0x1552ef=users[_0x38a7a6(0x1c9)];else{if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]=='Spanish')var _0x1552ef=users[_0x38a7a6(0x1e0)];else{if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]==_0x38a7a6(0x1e3))var _0x1552ef=users['French'];else{if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]=='Portuguese\x20(BR)')var _0x1552ef=users[_0x38a7a6(0x1b3)];else{if(_0x379c6d[0x0]['language']==_0x38a7a6(0x1bb))var _0x1552ef=users[_0x38a7a6(0x1bb)];else{if(_0x379c6d[0x0][_0x38a7a6(0x1cc)]==_0x38a7a6(0x1df))var _0x1552ef=users[_0x38a7a6(0x189)];}}}}}}}_0x1ef1e0[_0x38a7a6(0x1d5)](_0x38a7a6(0x1d3),{'success':_0x334319[_0x38a7a6(0x191)](_0x38a7a6(0x180)),'errors':_0x334319[_0x38a7a6(0x191)](_0x38a7a6(0x1ae)),'role':_0x4c3d43,'profile':_0x370a8a,'payment':_0x4a0fb8,'payable':_0x2916a6,'receivable':_0x5bd328,'master_shop':_0x379c6d,'language':_0x1552ef});}catch(_0x180bcf){console[_0x38a7a6(0x193)](_0x180bcf);}}),router['get']('/products_export_migrate_file',auth,async(_0x1781bc,_0x1ed8d5)=>{const _0x3dc4bd=a0_0x4ec2cf;try{const _0x2b0e4b=new excelJS[(_0x3dc4bd(0x1da))](),_0x386e2a=_0x2b0e4b[_0x3dc4bd(0x1ba)](_0x3dc4bd(0x1f4));return _0x386e2a[_0x3dc4bd(0x1a6)]=[{'header':'ID','key':_0x3dc4bd(0x1d8),'width':0xa},{'header':'Name','key':_0x3dc4bd(0x1f5),'width':0xa},{'header':_0x3dc4bd(0x1f3),'key':_0x3dc4bd(0x1c7),'width':0xa},{'header':_0x3dc4bd(0x1cf),'key':_0x3dc4bd(0x1cf),'width':0xa},{'header':_0x3dc4bd(0x1ea),'key':_0x3dc4bd(0x1ea),'width':0xa},{'header':_0x3dc4bd(0x184),'key':_0x3dc4bd(0x184),'width':0xa},{'header':_0x3dc4bd(0x1b2),'key':'email','width':0xa}],_0x1ed8d5['setHeader'](_0x3dc4bd(0x1eb),_0x3dc4bd(0x197)),_0x1ed8d5[_0x3dc4bd(0x1c0)](_0x3dc4bd(0x1ac),_0x3dc4bd(0x185)),_0x2b0e4b[_0x3dc4bd(0x1db)]['write'](_0x1ed8d5)[_0x3dc4bd(0x1e8)](()=>{const _0x2d0af1=_0x3dc4bd;_0x1ed8d5[_0x2d0af1(0x1dc)](0xc8);});}catch(_0x20eecd){_0x1ed8d5[_0x3dc4bd(0x1dc)](0x190)['send']({'errors':_0x20eecd[_0x3dc4bd(0x1a2)]});}});const storage1=multer[a0_0x4ec2cf(0x1aa)]({'destination':(_0x34ffd0,_0x4fbd9c,_0x11d173)=>{const _0x4bec4f=a0_0x4ec2cf;_0x11d173(null,_0x4bec4f(0x1c1));},'filename':(_0x24712d,_0x191452,_0x172ce4)=>{const _0x146291=a0_0x4ec2cf;_0x172ce4(null,Date[_0x146291(0x1b0)]()+_0x191452[_0x146291(0x19f)]);}}),uploadMigrate=multer({'storage':storage1});router['post']('/customer_import_migrate_file',auth,uploadMigrate[a0_0x4ec2cf(0x1bd)](a0_0x4ec2cf(0x1b6)),async(_0x2366c9,_0x4785b9)=>{const _0x261eaf=a0_0x4ec2cf,_0x168167=_0x2366c9[_0x261eaf(0x1de)][_0x261eaf(0x18e)],_0x165b29=await xlsx[_0x261eaf(0x187)](_0x261eaf(0x1d9)+_0x168167);let _0x189914=_0x165b29[_0x261eaf(0x183)],_0x58aa38=xlsx['utils'][_0x261eaf(0x1cd)](_0x165b29[_0x261eaf(0x18a)][_0x189914[0x0]]);for(const _0x3ded08 of _0x58aa38){const _0x1fd5d9=_0x3ded08['ID'],_0x524569=_0x3ded08[_0x261eaf(0x18b)],_0x1b2c80=_0x3ded08[_0x261eaf(0x1f3)],_0x3a7e42=_0x3ded08[_0x261eaf(0x1cf)],_0x23e6a6=_0x3ded08['address'],_0x1e2feb=_0x3ded08[_0x261eaf(0x184)],_0x40dd5a=_0x3ded08[_0x261eaf(0x1b2)];try{let _0x3fbb42=await customer[_0x261eaf(0x1bf)]({'name':_0x524569});if(!_0x3fbb42){const _0x23def7=new customer({'name':_0x524569,'ID':_0x1fd5d9,'SalesmanCode':_0x1b2c80,'SalesmanName':_0x3a7e42,'address':_0x23e6a6,'mobile':_0x1e2feb,'email':_0x40dd5a});_0x3fbb42=await _0x23def7[_0x261eaf(0x182)](),_0x2366c9[_0x261eaf(0x191)](_0x261eaf(0x180),_0x524569+_0x261eaf(0x1c2));}else _0x2366c9[_0x261eaf(0x191)](_0x261eaf(0x194),_0x524569+_0x261eaf(0x18c));}catch(_0x10982b){_0x4785b9['status'](0x1f4)['json']({'proderror':_0x10982b[_0x261eaf(0x1a2)],'aproduct':ProductName});}}_0x4785b9[_0x261eaf(0x1a8)](_0x261eaf(0x1e6));}),module[a0_0x4ec2cf(0x196)]=router;