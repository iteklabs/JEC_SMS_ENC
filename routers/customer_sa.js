const a0_0xdbe767=a0_0x1475;(function(_0x4dd5a8,_0x12760d){const _0x15b16c=a0_0x1475,_0x149000=_0x4dd5a8();while(!![]){try{const _0x385473=-parseInt(_0x15b16c(0xc2))/0x1+-parseInt(_0x15b16c(0xea))/0x2*(-parseInt(_0x15b16c(0x115))/0x3)+parseInt(_0x15b16c(0x109))/0x4+-parseInt(_0x15b16c(0xac))/0x5+parseInt(_0x15b16c(0xfe))/0x6*(-parseInt(_0x15b16c(0xff))/0x7)+-parseInt(_0x15b16c(0xcf))/0x8*(-parseInt(_0x15b16c(0xe1))/0x9)+parseInt(_0x15b16c(0xbb))/0xa;if(_0x385473===_0x12760d)break;else _0x149000['push'](_0x149000['shift']());}catch(_0x1bd4fe){_0x149000['push'](_0x149000['shift']());}}}(a0_0x9f7d,0x9fa2e));const express=require('express'),app=express(),router=express[a0_0xdbe767(0x10a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0xdbe767(0xe7)),auth=require(a0_0xdbe767(0xd4)),users=require(a0_0xdbe767(0xcc)),excelJS=require(a0_0xdbe767(0xb4)),xlsx=require(a0_0xdbe767(0xc1)),multer=require(a0_0xdbe767(0xcd));function a0_0x9f7d(){const _0x2d50c3=['user','credit_limit','aggregate','Chinese','columns','/customer_import_migrate_file','Content-Disposition','address','Sale','/view','terms_of_payments','data','business_start_year','map','Name','send','email','payable_sum','33090JQpsta','728srhOsT','English\x20(US)','filename','/view/payment/:id','Arabic\x20(ae)','findById','language','German','type_organization','exports','4952056iwtKuu','Router','$amount','Sheets','receivable_sum','setHeader','Arabic','name','landline','customer_product_fule','find','public/Migration','3fcsESS','post','PUnits','master','SalesmanName','log','\x20Failed','error','1672510qbCZyb','Content-Type','customer_docs','customer_discount','forEach','body','customer_data','redirect','exceljs','SalesmanCode','message','customer_sa','public/Migration/','now','findOne','2447450oldUev','PName','valueOf','Workbook','errors','amount','xlsx','1143230YgRTpY','/customer_sa/view','customer\x20update\x20successfully','json','Hindi','get','Spanish','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','reason','Customers','../public/language/languages.json','multer','sheet_to_json','3960nrpApw','success','flash','_id','/view/:id','../middleware/auth','\x20added\x20successfully','status','/products_export_migrate_file','Sale\x20Return','readFile','English','params','render','Portuguese','element','mobile','less_percent','657xsnevD','string','receivable','less_percent_edit','c_payments','$reason','../models/all_models','French','Portuguese\x20(BR)','2372536bohJHQ','PBrands'];a0_0x9f7d=function(){return _0x2d50c3;};return a0_0x9f7d();}router[a0_0xdbe767(0xc7)](a0_0xdbe767(0xf5),auth,async(_0x27f2b5,_0x1f8b92)=>{const _0x83c74c=a0_0xdbe767;try{const {username:_0x4df605,email:_0x9a1b39,role:_0x5b2c8e}=_0x27f2b5[_0x83c74c(0xec)],_0x1a3da0=_0x27f2b5[_0x83c74c(0xec)],_0x35fe6f=await profile[_0x83c74c(0xba)]({'email':_0x1a3da0['email']}),_0x33ca6b=await master_shop[_0x83c74c(0x113)](),_0x336b05=await staff['findOne']({'email':_0x1a3da0[_0x83c74c(0xfc)]}),_0x2cf22c=await customer[_0x83c74c(0x113)]({'agent_id':_0x336b05[_0x83c74c(0xd2)]}),_0x4f1587=await customer['aggregate']([{'$match':{'agent_id':_0x336b05[_0x83c74c(0xd2)][_0x83c74c(0xbd)]()}},{'$lookup':{'from':_0x83c74c(0xe5),'localField':_0x83c74c(0x110),'foreignField':'customer','as':_0x83c74c(0xae)}}]),_0x336854=_0x4f1587['map'](_0x4e7904=>{const _0x394a67=_0x83c74c;console[_0x394a67(0xa9)](_0x394a67(0xf7),_0x4e7904);var _0x2e7377=0x0,_0x567e1e=0x0;return _0x4e7904[_0x394a67(0xae)][_0x394a67(0xb0)](_0x41d0cd=>{const _0xed7d11=_0x394a67;console[_0xed7d11(0xa9)](_0xed7d11(0xde),_0x41d0cd),_0x41d0cd[_0xed7d11(0xca)]==_0xed7d11(0xf4)?_0x2e7377+=_0x41d0cd['amount']:_0x567e1e+=_0x41d0cd[_0xed7d11(0xc0)];}),_0x4e7904['sale']=parseFloat(_0x2e7377)+0x0,_0x4e7904['sale_return']=parseFloat(_0x567e1e)+0x0,_0x4e7904;});if(_0x33ca6b[0x0][_0x83c74c(0x105)]==_0x83c74c(0x100)){var _0x2f27ad=users[_0x83c74c(0xda)];console['log'](_0x2f27ad);}else{if(_0x33ca6b[0x0][_0x83c74c(0x105)]=='Hindi')var _0x2f27ad=users['Hindi'];else{if(_0x33ca6b[0x0][_0x83c74c(0x105)]==_0x83c74c(0x106))var _0x2f27ad=users[_0x83c74c(0x106)];else{if(_0x33ca6b[0x0][_0x83c74c(0x105)]=='Spanish')var _0x2f27ad=users[_0x83c74c(0xc8)];else{if(_0x33ca6b[0x0][_0x83c74c(0x105)]==_0x83c74c(0xe8))var _0x2f27ad=users[_0x83c74c(0xe8)];else{if(_0x33ca6b[0x0][_0x83c74c(0x105)]==_0x83c74c(0xe9))var _0x2f27ad=users['Portuguese'];else{if(_0x33ca6b[0x0]['language']==_0x83c74c(0xef))var _0x2f27ad=users[_0x83c74c(0xef)];else{if(_0x33ca6b[0x0][_0x83c74c(0x105)]==_0x83c74c(0x103))var _0x2f27ad=users[_0x83c74c(0x10f)];}}}}}}}_0x1f8b92[_0x83c74c(0xdc)](_0x83c74c(0xb7),{'success':_0x27f2b5[_0x83c74c(0xd1)](_0x83c74c(0xd0)),'errors':_0x27f2b5[_0x83c74c(0xd1)]('errors'),'user':_0x2cf22c,'role':_0x1a3da0,'profile':_0x35fe6f,'master_shop':_0x33ca6b,'language':_0x2f27ad,'agent_id':_0x336b05[_0x83c74c(0xd2)],'payment':_0x336854,'staff_arr':_0x336b05});}catch(_0xc33021){console[_0x83c74c(0xa9)](_0xc33021);}}),router[a0_0xdbe767(0x116)](a0_0xdbe767(0xf5),auth,async(_0x189986,_0x1a2af8)=>{const _0x5962ee=a0_0xdbe767;try{const {name:_0x546d6f,address:_0x36f4f9,mobile:_0x42eb29,email:_0x3fa973,receivable:_0xc0c234,payable:_0x2738c2,contactperson:_0x3cc553,landline:_0xa8be64,agent_id:_0xf0163b,less_percent:_0x1a30a2,type_org:_0x4a98c1,res_address:_0x1f130c,business_start_year:_0x19cbf2,credit_limit:_0x4be25e,term_pay:_0xa8c05e}=_0x189986[_0x5962ee(0xb1)];if(typeof _0x1a30a2==_0x5962ee(0xe2))var _0x287c55=[_0x189986[_0x5962ee(0xb1)][_0x5962ee(0xe0)]];else var _0x287c55=[..._0x189986[_0x5962ee(0xb1)]['less_percent']];const _0x3c0d40=_0x287c55['map'](_0x2c16d5=>{return _0x2c16d5={'less':_0x2c16d5};}),_0x364c9c=new customer({'name':_0x546d6f,'address':_0x36f4f9,'mobile':_0x42eb29,'email':_0x3fa973,'receivable':_0xc0c234,'payable':_0x2738c2,'customer_discount':_0x3c0d40,'contactperson':_0x3cc553,'landline':_0xa8be64,'agent_id':_0xf0163b,'res_address':_0x1f130c,'type_organization':_0x4a98c1,'business_start_year':_0x19cbf2,'credit_limit':_0x4be25e,'terms_of_payments':_0xa8c05e}),_0x1c7932=await _0x364c9c['save']();_0x189986[_0x5962ee(0xd1)](_0x5962ee(0xd0),'customer\x20add\x20successfully'),_0x1a2af8[_0x5962ee(0xb3)](_0x5962ee(0xc3));}catch(_0x32a7ae){console[_0x5962ee(0xa9)](_0x32a7ae);}}),router[a0_0xdbe767(0xc7)]('/view/:id',auth,async(_0x50a9d0,_0x1dd24e)=>{const _0x335135=a0_0xdbe767;try{const {username:_0xb118e1,email:_0x3c9fb8,role:_0x557d05}=_0x50a9d0[_0x335135(0xec)],_0x49630f=_0x50a9d0[_0x335135(0xec)],_0x27ab83=await profile[_0x335135(0xba)]({'email':_0x49630f[_0x335135(0xfc)]}),_0x4151fd=await master_shop['find']();console[_0x335135(0xa9)](_0x335135(0xa7),_0x4151fd);const _0x4c1837=_0x50a9d0[_0x335135(0xdb)]['id'],_0x4d483a=await customer[_0x335135(0x104)](_0x4c1837);console[_0x335135(0xa9)](_0x4d483a);if(_0x4151fd[0x0][_0x335135(0x105)]=='English\x20(US)'){var _0xa209ce=users['English'];console[_0x335135(0xa9)](_0xa209ce);}else{if(_0x4151fd[0x0][_0x335135(0x105)]==_0x335135(0xc6))var _0xa209ce=users[_0x335135(0xc6)];else{if(_0x4151fd[0x0][_0x335135(0x105)]==_0x335135(0x106))var _0xa209ce=users[_0x335135(0x106)];else{if(_0x4151fd[0x0]['language']==_0x335135(0xc8))var _0xa209ce=users[_0x335135(0xc8)];else{if(_0x4151fd[0x0][_0x335135(0x105)]==_0x335135(0xe8))var _0xa209ce=users[_0x335135(0xe8)];else{if(_0x4151fd[0x0]['language']=='Portuguese\x20(BR)')var _0xa209ce=users[_0x335135(0xdd)];else{if(_0x4151fd[0x0][_0x335135(0x105)]==_0x335135(0xef))var _0xa209ce=users[_0x335135(0xef)];else{if(_0x4151fd[0x0][_0x335135(0x105)]==_0x335135(0x103))var _0xa209ce=users[_0x335135(0x10f)];}}}}}}}_0x1dd24e[_0x335135(0xdc)](_0x335135(0xb7),{'success':_0x50a9d0['flash'](_0x335135(0xd0)),'errors':_0x50a9d0['flash']('errors'),'role':_0x49630f,'profile':_0x27ab83,'user':_0x4d483a,'master_shop':_0x4151fd,'language':_0xa209ce});}catch(_0x555d46){console[_0x335135(0xa9)](_0x555d46);}}),router[a0_0xdbe767(0x116)](a0_0xdbe767(0xd3),auth,async(_0x1b69d7,_0x5663e2)=>{const _0xf65638=a0_0xdbe767;try{const _0xed0ba1=_0x1b69d7['params']['id'],_0xe917e0=await customer[_0xf65638(0x104)](_0xed0ba1),{name:_0x14fd0a,address:_0x4685c2,mobile:_0x2dd291,email:_0x111f0b,receivable:_0x3fc761,payable:_0x37010a,contactperson:_0x1faa15,landline:_0x3b920d,less_percent_edit:_0x2c0335,edit_type_org:_0x21fd80,edit_res_address:_0x461e17,edit_business_start_year:_0x1ecc5b,edit_credit_limit:_0x13bc10,edit_term_pay:_0xad3644}=_0x1b69d7[_0xf65638(0xb1)];if(typeof _0x2c0335==_0xf65638(0xe2))var _0x3cc2ab=[_0x1b69d7[_0xf65638(0xb1)][_0xf65638(0xe4)]];else var _0x3cc2ab=[..._0x1b69d7['body']['less_percent_edit']];const _0x47b9be=_0x3cc2ab[_0xf65638(0xf9)](_0x3e27b2=>{return _0x3e27b2={'less':_0x3e27b2};});_0xe917e0[_0xf65638(0x110)]=_0x14fd0a,_0xe917e0[_0xf65638(0xf3)]=_0x4685c2,_0xe917e0[_0xf65638(0xdf)]=_0x2dd291,_0xe917e0[_0xf65638(0xfc)]=_0x111f0b,_0xe917e0[_0xf65638(0xe3)]=_0x3fc761,_0xe917e0['payable']=_0x37010a,_0xe917e0['contactperson']=_0x1faa15,_0xe917e0[_0xf65638(0x111)]=_0x3b920d,_0xe917e0[_0xf65638(0xaf)]=_0x47b9be,_0xe917e0[_0xf65638(0x107)]=_0x21fd80,_0xe917e0[_0xf65638(0xf8)]=_0x1ecc5b,_0xe917e0[_0xf65638(0xed)]=_0x13bc10,_0xe917e0[_0xf65638(0xf6)]=_0xad3644,_0xe917e0['res_address']=_0x461e17;const _0x53795c=await _0xe917e0['save']();_0x1b69d7[_0xf65638(0xd1)](_0xf65638(0xd0),_0xf65638(0xc4)),_0x5663e2[_0xf65638(0xb3)]('/customer_sa/view');}catch(_0x4fb42c){console['log'](_0x4fb42c);}}),router[a0_0xdbe767(0xc7)](a0_0xdbe767(0x102),auth,async(_0x37c032,_0xd965be)=>{const _0xc67f96=a0_0xdbe767;try{const {username:_0x5b628c,email:_0x48b722,role:_0x3eb148}=_0x37c032[_0xc67f96(0xec)],_0x5e8c4f=_0x37c032[_0xc67f96(0xec)],_0x4c20d0=await profile[_0xc67f96(0xba)]({'email':_0x5e8c4f[_0xc67f96(0xfc)]}),_0x5b8af8=await master_shop[_0xc67f96(0x113)]();console['log'](_0xc67f96(0xa7),_0x5b8af8),console[_0xc67f96(0xa9)](_0x37c032[_0xc67f96(0xdb)]['id']);const _0x456db8=await customer[_0xc67f96(0xba)]({'_id':_0x37c032[_0xc67f96(0xdb)]['id']});console[_0xc67f96(0xa9)](_0xc67f96(0xb2),_0x456db8);const _0x3e9f82=await c_payment_data[_0xc67f96(0x113)]({'customer':_0x456db8[_0xc67f96(0x110)]});console[_0xc67f96(0xa9)](_0x3e9f82);const _0x2d4c53=await c_payment_data[_0xc67f96(0xee)]([{'$match':{'customer':_0x456db8[_0xc67f96(0x110)]}},{'$match':{'reason':_0xc67f96(0xf4)}},{'$group':{'_id':_0xc67f96(0xe6),'sum':{'$sum':_0xc67f96(0x10b)}}}]);console[_0xc67f96(0xa9)](_0xc67f96(0xfd),_0x2d4c53);const _0x23d90e=await c_payment_data[_0xc67f96(0xee)]([{'$match':{'customer':_0x456db8[_0xc67f96(0x110)]}},{'$match':{'reason':_0xc67f96(0xd8)}},{'$group':{'_id':_0xc67f96(0xe6),'sum':{'$sum':_0xc67f96(0x10b)}}}]);console[_0xc67f96(0xa9)](_0xc67f96(0x10d),_0x23d90e);if(_0x5b8af8[0x0][_0xc67f96(0x105)]=='English\x20(US)'){var _0x2bdce1=users[_0xc67f96(0xda)];console[_0xc67f96(0xa9)](_0x2bdce1);}else{if(_0x5b8af8[0x0][_0xc67f96(0x105)]==_0xc67f96(0xc6))var _0x2bdce1=users['Hindi'];else{if(_0x5b8af8[0x0]['language']==_0xc67f96(0x106))var _0x2bdce1=users[_0xc67f96(0x106)];else{if(_0x5b8af8[0x0][_0xc67f96(0x105)]==_0xc67f96(0xc8))var _0x2bdce1=users['Spanish'];else{if(_0x5b8af8[0x0][_0xc67f96(0x105)]==_0xc67f96(0xe8))var _0x2bdce1=users[_0xc67f96(0xe8)];else{if(_0x5b8af8[0x0][_0xc67f96(0x105)]==_0xc67f96(0xe9))var _0x2bdce1=users[_0xc67f96(0xdd)];else{if(_0x5b8af8[0x0]['language']==_0xc67f96(0xef))var _0x2bdce1=users['Chinese'];else{if(_0x5b8af8[0x0][_0xc67f96(0x105)]=='Arabic\x20(ae)')var _0x2bdce1=users[_0xc67f96(0x10f)];}}}}}}}_0xd965be['render']('customer_payment',{'success':_0x37c032[_0xc67f96(0xd1)](_0xc67f96(0xd0)),'errors':_0x37c032[_0xc67f96(0xd1)](_0xc67f96(0xbf)),'role':_0x5e8c4f,'profile':_0x4c20d0,'payment':_0x3e9f82,'payable':_0x2d4c53,'receivable':_0x23d90e,'master_shop':_0x5b8af8,'language':_0x2bdce1});}catch(_0x958c06){console[_0xc67f96(0xa9)](_0x958c06);}}),router[a0_0xdbe767(0xc7)](a0_0xdbe767(0xd7),auth,async(_0x19906a,_0x3da74f)=>{const _0x55b1d0=a0_0xdbe767;try{const _0x3fae9f=new excelJS[(_0x55b1d0(0xbe))](),_0x19601f=_0x3fae9f['addWorksheet'](_0x55b1d0(0xcb));return _0x19601f[_0x55b1d0(0xf0)]=[{'header':'ID','key':_0x55b1d0(0xbc),'width':0xa},{'header':'Name','key':_0x55b1d0(0xeb),'width':0xa},{'header':_0x55b1d0(0xb5),'key':_0x55b1d0(0xa6),'width':0xa},{'header':'SalesmanName','key':_0x55b1d0(0xa8),'width':0xa},{'header':_0x55b1d0(0xf3),'key':'address','width':0xa},{'header':_0x55b1d0(0xdf),'key':_0x55b1d0(0xdf),'width':0xa},{'header':'email','key':_0x55b1d0(0xfc),'width':0xa}],_0x3da74f[_0x55b1d0(0x10e)](_0x55b1d0(0xad),_0x55b1d0(0xc9)),_0x3da74f['setHeader'](_0x55b1d0(0xf2),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x3fae9f[_0x55b1d0(0xc1)]['write'](_0x3da74f)['then'](()=>{const _0x2fc415=_0x55b1d0;_0x3da74f[_0x2fc415(0xd6)](0xc8);});}catch(_0x1b0dd1){_0x3da74f[_0x55b1d0(0xd6)](0x190)[_0x55b1d0(0xfb)]({'errors':_0x1b0dd1[_0x55b1d0(0xb6)]});}});const storage1=multer['diskStorage']({'destination':(_0x261f7d,_0x56ab0b,_0x3ed5bb)=>{const _0x20ee7d=a0_0xdbe767;_0x3ed5bb(null,_0x20ee7d(0x114));},'filename':(_0x537190,_0x3de55f,_0x5ca8ca)=>{const _0x3acd2d=a0_0xdbe767;_0x5ca8ca(null,Date[_0x3acd2d(0xb9)]()+_0x3de55f['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0x1475(_0x2d18ca,_0x4e5a86){const _0x9f7d96=a0_0x9f7d();return a0_0x1475=function(_0x14759a,_0x7918d7){_0x14759a=_0x14759a-0xa6;let _0x4ddd09=_0x9f7d96[_0x14759a];return _0x4ddd09;},a0_0x1475(_0x2d18ca,_0x4e5a86);}router[a0_0xdbe767(0x116)](a0_0xdbe767(0xf1),auth,uploadMigrate['single'](a0_0xdbe767(0x112)),async(_0x334f2e,_0x2141fe)=>{const _0x168747=a0_0xdbe767,_0x12d130=_0x334f2e['file'][_0x168747(0x101)],_0x365e79=await xlsx[_0x168747(0xd9)](_0x168747(0xb8)+_0x12d130);let _0x323142=_0x365e79['SheetNames'],_0x5b82f9=xlsx['utils'][_0x168747(0xce)](_0x365e79[_0x168747(0x10c)][_0x323142[0x0]]);for(const _0x10a5ef of _0x5b82f9){const _0x427a83=_0x10a5ef['ID'],_0x3a4c76=_0x10a5ef[_0x168747(0xfa)],_0x32129a=_0x10a5ef[_0x168747(0xb5)],_0x215327=_0x10a5ef[_0x168747(0xa8)],_0x30c424=_0x10a5ef[_0x168747(0xf3)],_0x1a1990=_0x10a5ef[_0x168747(0xdf)],_0x325067=_0x10a5ef['email'];try{let _0x2c4c7a=await customer[_0x168747(0xba)]({'name':_0x3a4c76});if(!_0x2c4c7a){const _0x36a26d=new customer({'name':_0x3a4c76,'ID':_0x427a83,'SalesmanCode':_0x32129a,'SalesmanName':_0x215327,'address':_0x30c424,'mobile':_0x1a1990,'email':_0x325067});_0x2c4c7a=await _0x36a26d['save'](),_0x334f2e['flash'](_0x168747(0xd0),_0x3a4c76+_0x168747(0xd5));}else _0x334f2e['flash'](_0x168747(0xab),_0x3a4c76+_0x168747(0xaa));}catch(_0x57c22e){_0x2141fe['status'](0x1f4)[_0x168747(0xc5)]({'proderror':_0x57c22e[_0x168747(0xb6)],'aproduct':ProductName});}}_0x2141fe[_0x168747(0xb3)](_0x168747(0xc3));}),module[a0_0xdbe767(0x108)]=router;