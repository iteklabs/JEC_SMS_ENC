const a0_0x3415a0=a0_0x2546;(function(_0x5e308d,_0x1ca03b){const _0x547133=a0_0x2546,_0xd9118c=_0x5e308d();while(!![]){try{const _0x30ef48=-parseInt(_0x547133(0xa5))/0x1+-parseInt(_0x547133(0x7c))/0x2*(-parseInt(_0x547133(0x7e))/0x3)+parseInt(_0x547133(0x71))/0x4*(parseInt(_0x547133(0x9f))/0x5)+-parseInt(_0x547133(0x98))/0x6*(parseInt(_0x547133(0x77))/0x7)+parseInt(_0x547133(0xae))/0x8+-parseInt(_0x547133(0xa1))/0x9+parseInt(_0x547133(0x72))/0xa;if(_0x30ef48===_0x1ca03b)break;else _0xd9118c['push'](_0xd9118c['shift']());}catch(_0xfb152e){_0xd9118c['push'](_0xd9118c['shift']());}}}(a0_0x4f4a,0x85e46));const express=require(a0_0x3415a0(0x7f)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x3415a0(0x7a)),auth=require('../middleware/auth'),users=require(a0_0x3415a0(0x73)),excelJS=require(a0_0x3415a0(0xbc)),xlsx=require('xlsx'),multer=require(a0_0x3415a0(0xac));function a0_0x4f4a(){const _0x134868=['sale_return','filename','get','SalesmanCode','type_organization','customer\x20add\x20successfully','columns','/view/:id','PUnits','log','find','Content-Disposition','address','payable','json','utils','Sheets','errors','SalesmanName','contactperson','landline','sheet_to_json','4nwZRQO','1289860gpsgfs','../public/language/languages.json','\x20added\x20successfully','/view/payment/:id','Arabic\x20(ae)','7LrqTOZ','credit_limit','render','../models/all_models','receivable','988OdmXLX','language','3432CwJZHg','express','redirect','message','Workbook','customer','name','element','terms_of_payments','Content-Type','mobile','Hindi','readFile','German','findOne','now','public/Migration','PBrands','body','Portuguese','forEach','string','post','write','less_percent','customer_sa','2800344ZwTNnL','Arabic','PName','data','Sale','SheetNames','status','1259390EbNXsA','save','2004318MaXGyB','master','less_percent_edit','Name','31325uSdyJF','$amount','setHeader','sale','res_address','/view','xlsx','multer','customer_data','2585384UEOYYR','French','flash','Portuguese\x20(BR)','send','payable_sum','English','Spanish','customer_discount','error','file','customer_product_fule','aggregate','reason','exceljs','params','$reason','/customer_sa/view','map','success','receivable_sum','amount','email','_id','user','customer_docs','Chinese','attachment;\x20filename=customer_Migration_File.xlsx','findById','Sale\x20Return'];a0_0x4f4a=function(){return _0x134868;};return a0_0x4f4a();}router[a0_0x3415a0(0xce)](a0_0x3415a0(0xaa),auth,async(_0x29b968,_0x1c3785)=>{const _0x35c0f9=a0_0x3415a0;try{const {username:_0x49f22a,email:_0x40063c,role:_0x339fb5}=_0x29b968[_0x35c0f9(0xc6)],_0x52da49=_0x29b968['user'],_0x55fbf4=await profile[_0x35c0f9(0x8c)]({'email':_0x52da49['email']}),_0x4c3268=await master_shop[_0x35c0f9(0xd6)](),_0x3b9ed8=await staff[_0x35c0f9(0x8c)]({'email':_0x52da49[_0x35c0f9(0xc4)]}),_0x3c2e2e=await customer[_0x35c0f9(0xd6)]({'agent_id':_0x3b9ed8[_0x35c0f9(0xc5)]}),_0x5a55ea=await customer[_0x35c0f9(0xba)]([{'$match':{'agent_id':_0x3b9ed8[_0x35c0f9(0xc5)]['valueOf']()}},{'$lookup':{'from':'c_payments','localField':'name','foreignField':_0x35c0f9(0x83),'as':_0x35c0f9(0xc7)}}]),_0x2f4726=_0x5a55ea[_0x35c0f9(0xc0)](_0x5ae6e7=>{const _0x45cd05=_0x35c0f9;console[_0x45cd05(0xd5)](_0x45cd05(0x9b),_0x5ae6e7);var _0x479903=0x0,_0x5761c6=0x0;return _0x5ae6e7[_0x45cd05(0xc7)][_0x45cd05(0x92)](_0xc64317=>{const _0x2b02a3=_0x45cd05;console[_0x2b02a3(0xd5)](_0x2b02a3(0x85),_0xc64317),_0xc64317[_0x2b02a3(0xbb)]==_0x2b02a3(0x9c)?_0x479903+=_0xc64317[_0x2b02a3(0xc3)]:_0x5761c6+=_0xc64317[_0x2b02a3(0xc3)];}),_0x5ae6e7[_0x45cd05(0xa8)]=parseFloat(_0x479903)+0x0,_0x5ae6e7[_0x45cd05(0xcc)]=parseFloat(_0x5761c6)+0x0,_0x5ae6e7;});if(_0x4c3268[0x0]['language']=='English\x20(US)'){var _0xa7f11d=users['English'];console['log'](_0xa7f11d);}else{if(_0x4c3268[0x0][_0x35c0f9(0x7d)]==_0x35c0f9(0x89))var _0xa7f11d=users[_0x35c0f9(0x89)];else{if(_0x4c3268[0x0][_0x35c0f9(0x7d)]=='German')var _0xa7f11d=users[_0x35c0f9(0x8b)];else{if(_0x4c3268[0x0][_0x35c0f9(0x7d)]==_0x35c0f9(0xb5))var _0xa7f11d=users[_0x35c0f9(0xb5)];else{if(_0x4c3268[0x0][_0x35c0f9(0x7d)]==_0x35c0f9(0xaf))var _0xa7f11d=users[_0x35c0f9(0xaf)];else{if(_0x4c3268[0x0][_0x35c0f9(0x7d)]==_0x35c0f9(0xb1))var _0xa7f11d=users[_0x35c0f9(0x91)];else{if(_0x4c3268[0x0][_0x35c0f9(0x7d)]==_0x35c0f9(0xc8))var _0xa7f11d=users['Chinese'];else{if(_0x4c3268[0x0]['language']==_0x35c0f9(0x76))var _0xa7f11d=users[_0x35c0f9(0x99)];}}}}}}}_0x1c3785[_0x35c0f9(0x79)](_0x35c0f9(0x97),{'success':_0x29b968[_0x35c0f9(0xb0)](_0x35c0f9(0xc1)),'errors':_0x29b968[_0x35c0f9(0xb0)](_0x35c0f9(0x6c)),'user':_0x3c2e2e,'role':_0x52da49,'profile':_0x55fbf4,'master_shop':_0x4c3268,'language':_0xa7f11d,'agent_id':_0x3b9ed8[_0x35c0f9(0xc5)],'payment':_0x2f4726,'staff_arr':_0x3b9ed8});}catch(_0x33b195){console[_0x35c0f9(0xd5)](_0x33b195);}}),router[a0_0x3415a0(0x94)](a0_0x3415a0(0xaa),auth,async(_0x137b27,_0x43fb00)=>{const _0x396937=a0_0x3415a0;try{const {name:_0x59bb68,address:_0x1095b5,mobile:_0x2e34b7,email:_0x369987,receivable:_0x33ff48,payable:_0x25757e,contactperson:_0x1787fc,landline:_0x266cb2,agent_id:_0x2958c3,less_percent:_0x17ed44,type_org:_0xe62801,res_address:_0x37c2bd,business_start_year:_0x295634,credit_limit:_0x5f27ba,term_pay:_0x54031b}=_0x137b27[_0x396937(0x90)];if(typeof _0x17ed44==_0x396937(0x93))var _0x13d2e8=[_0x137b27[_0x396937(0x90)][_0x396937(0x96)]];else var _0x13d2e8=[..._0x137b27[_0x396937(0x90)]['less_percent']];const _0x4c6f32=_0x13d2e8[_0x396937(0xc0)](_0x15f444=>{return _0x15f444={'less':_0x15f444};}),_0x50e378=new customer({'name':_0x59bb68,'address':_0x1095b5,'mobile':_0x2e34b7,'email':_0x369987,'receivable':_0x33ff48,'payable':_0x25757e,'customer_discount':_0x4c6f32,'contactperson':_0x1787fc,'landline':_0x266cb2,'agent_id':_0x2958c3,'res_address':_0x37c2bd,'type_organization':_0xe62801,'business_start_year':_0x295634,'credit_limit':_0x5f27ba,'terms_of_payments':_0x54031b}),_0x5a9020=await _0x50e378[_0x396937(0xa0)]();_0x137b27['flash'](_0x396937(0xc1),_0x396937(0xd1)),_0x43fb00[_0x396937(0x80)](_0x396937(0xbf));}catch(_0xbdee49){console[_0x396937(0xd5)](_0xbdee49);}}),router[a0_0x3415a0(0xce)](a0_0x3415a0(0xd3),auth,async(_0x2c01ed,_0x48ca15)=>{const _0x5f2c23=a0_0x3415a0;try{const {username:_0x6d0561,email:_0x2db2c6,role:_0x1bac7c}=_0x2c01ed['user'],_0x52fa44=_0x2c01ed[_0x5f2c23(0xc6)],_0x300389=await profile[_0x5f2c23(0x8c)]({'email':_0x52fa44[_0x5f2c23(0xc4)]}),_0x13670b=await master_shop[_0x5f2c23(0xd6)]();console[_0x5f2c23(0xd5)](_0x5f2c23(0xa2),_0x13670b);const _0x1c52bc=_0x2c01ed[_0x5f2c23(0xbd)]['id'],_0x7e0e88=await customer['findById'](_0x1c52bc);console['log'](_0x7e0e88);if(_0x13670b[0x0][_0x5f2c23(0x7d)]=='English\x20(US)'){var _0x1cd54f=users[_0x5f2c23(0xb4)];console[_0x5f2c23(0xd5)](_0x1cd54f);}else{if(_0x13670b[0x0][_0x5f2c23(0x7d)]==_0x5f2c23(0x89))var _0x1cd54f=users['Hindi'];else{if(_0x13670b[0x0][_0x5f2c23(0x7d)]=='German')var _0x1cd54f=users[_0x5f2c23(0x8b)];else{if(_0x13670b[0x0][_0x5f2c23(0x7d)]==_0x5f2c23(0xb5))var _0x1cd54f=users[_0x5f2c23(0xb5)];else{if(_0x13670b[0x0][_0x5f2c23(0x7d)]==_0x5f2c23(0xaf))var _0x1cd54f=users[_0x5f2c23(0xaf)];else{if(_0x13670b[0x0]['language']==_0x5f2c23(0xb1))var _0x1cd54f=users[_0x5f2c23(0x91)];else{if(_0x13670b[0x0][_0x5f2c23(0x7d)]=='Chinese')var _0x1cd54f=users[_0x5f2c23(0xc8)];else{if(_0x13670b[0x0]['language']==_0x5f2c23(0x76))var _0x1cd54f=users[_0x5f2c23(0x99)];}}}}}}}_0x48ca15[_0x5f2c23(0x79)](_0x5f2c23(0x97),{'success':_0x2c01ed[_0x5f2c23(0xb0)](_0x5f2c23(0xc1)),'errors':_0x2c01ed[_0x5f2c23(0xb0)](_0x5f2c23(0x6c)),'role':_0x52fa44,'profile':_0x300389,'user':_0x7e0e88,'master_shop':_0x13670b,'language':_0x1cd54f});}catch(_0x20fa9b){console['log'](_0x20fa9b);}}),router['post']('/view/:id',auth,async(_0x16c1ac,_0x421f13)=>{const _0x13f818=a0_0x3415a0;try{const _0xc3e605=_0x16c1ac[_0x13f818(0xbd)]['id'],_0x38f40e=await customer[_0x13f818(0xca)](_0xc3e605),{name:_0x4accce,address:_0x5f1bfa,mobile:_0x50b41d,email:_0x1c9ead,receivable:_0x596caf,payable:_0x460394,contactperson:_0x18c9c3,landline:_0xbc8c45,less_percent_edit:_0x2e307e,edit_type_org:_0x2655c2,edit_res_address:_0x50c005,edit_business_start_year:_0x224911,edit_credit_limit:_0x154c90,edit_term_pay:_0x9bb152}=_0x16c1ac[_0x13f818(0x90)];if(typeof _0x2e307e==_0x13f818(0x93))var _0x477044=[_0x16c1ac[_0x13f818(0x90)][_0x13f818(0xa3)]];else var _0x477044=[..._0x16c1ac[_0x13f818(0x90)][_0x13f818(0xa3)]];const _0x35a156=_0x477044[_0x13f818(0xc0)](_0x151736=>{return _0x151736={'less':_0x151736};});_0x38f40e[_0x13f818(0x84)]=_0x4accce,_0x38f40e[_0x13f818(0xd8)]=_0x5f1bfa,_0x38f40e[_0x13f818(0x88)]=_0x50b41d,_0x38f40e[_0x13f818(0xc4)]=_0x1c9ead,_0x38f40e[_0x13f818(0x7b)]=_0x596caf,_0x38f40e[_0x13f818(0xd9)]=_0x460394,_0x38f40e[_0x13f818(0x6e)]=_0x18c9c3,_0x38f40e[_0x13f818(0x6f)]=_0xbc8c45,_0x38f40e[_0x13f818(0xb6)]=_0x35a156,_0x38f40e[_0x13f818(0xd0)]=_0x2655c2,_0x38f40e['business_start_year']=_0x224911,_0x38f40e[_0x13f818(0x78)]=_0x154c90,_0x38f40e[_0x13f818(0x86)]=_0x9bb152,_0x38f40e[_0x13f818(0xa9)]=_0x50c005;const _0x3a3d59=await _0x38f40e[_0x13f818(0xa0)]();_0x16c1ac[_0x13f818(0xb0)](_0x13f818(0xc1),'customer\x20update\x20successfully'),_0x421f13[_0x13f818(0x80)](_0x13f818(0xbf));}catch(_0x159f14){console[_0x13f818(0xd5)](_0x159f14);}}),router['get'](a0_0x3415a0(0x75),auth,async(_0x5b6eb1,_0x7e378c)=>{const _0x4a15c5=a0_0x3415a0;try{const {username:_0x129ced,email:_0x34c264,role:_0x50f8e8}=_0x5b6eb1['user'],_0x25bc96=_0x5b6eb1[_0x4a15c5(0xc6)],_0x1cfcbd=await profile[_0x4a15c5(0x8c)]({'email':_0x25bc96[_0x4a15c5(0xc4)]}),_0x6d73df=await master_shop[_0x4a15c5(0xd6)]();console[_0x4a15c5(0xd5)]('master',_0x6d73df),console[_0x4a15c5(0xd5)](_0x5b6eb1[_0x4a15c5(0xbd)]['id']);const _0x1d3842=await customer[_0x4a15c5(0x8c)]({'_id':_0x5b6eb1[_0x4a15c5(0xbd)]['id']});console[_0x4a15c5(0xd5)](_0x4a15c5(0xad),_0x1d3842);const _0x3a70cf=await c_payment_data[_0x4a15c5(0xd6)]({'customer':_0x1d3842[_0x4a15c5(0x84)]});console['log'](_0x3a70cf);const _0x24222b=await c_payment_data['aggregate']([{'$match':{'customer':_0x1d3842[_0x4a15c5(0x84)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x4a15c5(0xbe),'sum':{'$sum':_0x4a15c5(0xa6)}}}]);console[_0x4a15c5(0xd5)](_0x4a15c5(0xb3),_0x24222b);const _0x20ffec=await c_payment_data[_0x4a15c5(0xba)]([{'$match':{'customer':_0x1d3842['name']}},{'$match':{'reason':_0x4a15c5(0xcb)}},{'$group':{'_id':_0x4a15c5(0xbe),'sum':{'$sum':_0x4a15c5(0xa6)}}}]);console['log'](_0x4a15c5(0xc2),_0x20ffec);if(_0x6d73df[0x0]['language']=='English\x20(US)'){var _0x1b49a5=users[_0x4a15c5(0xb4)];console[_0x4a15c5(0xd5)](_0x1b49a5);}else{if(_0x6d73df[0x0][_0x4a15c5(0x7d)]==_0x4a15c5(0x89))var _0x1b49a5=users[_0x4a15c5(0x89)];else{if(_0x6d73df[0x0][_0x4a15c5(0x7d)]=='German')var _0x1b49a5=users[_0x4a15c5(0x8b)];else{if(_0x6d73df[0x0][_0x4a15c5(0x7d)]==_0x4a15c5(0xb5))var _0x1b49a5=users[_0x4a15c5(0xb5)];else{if(_0x6d73df[0x0]['language']==_0x4a15c5(0xaf))var _0x1b49a5=users[_0x4a15c5(0xaf)];else{if(_0x6d73df[0x0][_0x4a15c5(0x7d)]==_0x4a15c5(0xb1))var _0x1b49a5=users[_0x4a15c5(0x91)];else{if(_0x6d73df[0x0][_0x4a15c5(0x7d)]==_0x4a15c5(0xc8))var _0x1b49a5=users[_0x4a15c5(0xc8)];else{if(_0x6d73df[0x0][_0x4a15c5(0x7d)]=='Arabic\x20(ae)')var _0x1b49a5=users['Arabic'];}}}}}}}_0x7e378c[_0x4a15c5(0x79)]('customer_payment',{'success':_0x5b6eb1[_0x4a15c5(0xb0)](_0x4a15c5(0xc1)),'errors':_0x5b6eb1[_0x4a15c5(0xb0)](_0x4a15c5(0x6c)),'role':_0x25bc96,'profile':_0x1cfcbd,'payment':_0x3a70cf,'payable':_0x24222b,'receivable':_0x20ffec,'master_shop':_0x6d73df,'language':_0x1b49a5});}catch(_0x1b2345){console[_0x4a15c5(0xd5)](_0x1b2345);}}),router[a0_0x3415a0(0xce)]('/products_export_migrate_file',auth,async(_0x2ab62b,_0x13643e)=>{const _0x1c140b=a0_0x3415a0;try{const _0x2ac74d=new excelJS[(_0x1c140b(0x82))](),_0x2893e4=_0x2ac74d['addWorksheet']('Customers');return _0x2893e4[_0x1c140b(0xd2)]=[{'header':'ID','key':_0x1c140b(0x9a),'width':0xa},{'header':_0x1c140b(0xa4),'key':_0x1c140b(0x8f),'width':0xa},{'header':_0x1c140b(0xcf),'key':_0x1c140b(0xd4),'width':0xa},{'header':'SalesmanName','key':_0x1c140b(0x6d),'width':0xa},{'header':_0x1c140b(0xd8),'key':_0x1c140b(0xd8),'width':0xa},{'header':_0x1c140b(0x88),'key':_0x1c140b(0x88),'width':0xa},{'header':_0x1c140b(0xc4),'key':_0x1c140b(0xc4),'width':0xa}],_0x13643e[_0x1c140b(0xa7)](_0x1c140b(0x87),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x13643e[_0x1c140b(0xa7)](_0x1c140b(0xd7),_0x1c140b(0xc9)),_0x2ac74d[_0x1c140b(0xab)][_0x1c140b(0x95)](_0x13643e)['then'](()=>{_0x13643e['status'](0xc8);});}catch(_0x3e9a0d){_0x13643e[_0x1c140b(0x9e)](0x190)[_0x1c140b(0xb2)]({'errors':_0x3e9a0d['message']});}});function a0_0x2546(_0x751cc7,_0x3ab50c){const _0x4f4a4c=a0_0x4f4a();return a0_0x2546=function(_0x254672,_0x2844e8){_0x254672=_0x254672-0x69;let _0x2f75dc=_0x4f4a4c[_0x254672];return _0x2f75dc;},a0_0x2546(_0x751cc7,_0x3ab50c);}const storage1=multer['diskStorage']({'destination':(_0x5ea1cf,_0xf123c8,_0x2db86e)=>{const _0x555b83=a0_0x3415a0;_0x2db86e(null,_0x555b83(0x8e));},'filename':(_0x5044c5,_0x4470b0,_0x20d10d)=>{const _0x5d9b89=a0_0x3415a0;_0x20d10d(null,Date[_0x5d9b89(0x8d)]()+_0x4470b0['originalname']);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x3415a0(0x94)]('/customer_import_migrate_file',auth,uploadMigrate['single'](a0_0x3415a0(0xb9)),async(_0x4613f4,_0x2c4e1e)=>{const _0x3895a4=a0_0x3415a0,_0x1ffe36=_0x4613f4[_0x3895a4(0xb8)][_0x3895a4(0xcd)],_0x22bf1a=await xlsx[_0x3895a4(0x8a)]('public/Migration/'+_0x1ffe36);let _0x34f4b5=_0x22bf1a[_0x3895a4(0x9d)],_0x25d037=xlsx[_0x3895a4(0x6a)][_0x3895a4(0x70)](_0x22bf1a[_0x3895a4(0x6b)][_0x34f4b5[0x0]]);for(const _0x2c5cc1 of _0x25d037){const _0x3a2350=_0x2c5cc1['ID'],_0x3f86d0=_0x2c5cc1[_0x3895a4(0xa4)],_0x386a71=_0x2c5cc1[_0x3895a4(0xcf)],_0xbea76a=_0x2c5cc1['SalesmanName'],_0x47c3cb=_0x2c5cc1['address'],_0x2eae4e=_0x2c5cc1[_0x3895a4(0x88)],_0x503f60=_0x2c5cc1['email'];try{let _0x188c02=await customer[_0x3895a4(0x8c)]({'name':_0x3f86d0});if(!_0x188c02){const _0x49dde7=new customer({'name':_0x3f86d0,'ID':_0x3a2350,'SalesmanCode':_0x386a71,'SalesmanName':_0xbea76a,'address':_0x47c3cb,'mobile':_0x2eae4e,'email':_0x503f60});_0x188c02=await _0x49dde7[_0x3895a4(0xa0)](),_0x4613f4[_0x3895a4(0xb0)](_0x3895a4(0xc1),_0x3f86d0+_0x3895a4(0x74));}else _0x4613f4[_0x3895a4(0xb0)](_0x3895a4(0xb7),_0x3f86d0+'\x20Failed');}catch(_0xceb57e){_0x2c4e1e['status'](0x1f4)[_0x3895a4(0x69)]({'proderror':_0xceb57e[_0x3895a4(0x81)],'aproduct':ProductName});}}_0x2c4e1e[_0x3895a4(0x80)](_0x3895a4(0xbf));}),module['exports']=router;