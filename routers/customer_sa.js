const a0_0x4057af=a0_0x5c50;(function(_0x5ddd86,_0x4d815d){const _0x53f909=a0_0x5c50,_0x3f7046=_0x5ddd86();while(!![]){try{const _0x3140f3=parseInt(_0x53f909(0xc9))/0x1*(-parseInt(_0x53f909(0xd7))/0x2)+parseInt(_0x53f909(0xf2))/0x3*(parseInt(_0x53f909(0x101))/0x4)+-parseInt(_0x53f909(0xb3))/0x5+parseInt(_0x53f909(0xfa))/0x6+-parseInt(_0x53f909(0xb2))/0x7*(parseInt(_0x53f909(0xf3))/0x8)+parseInt(_0x53f909(0x106))/0x9+parseInt(_0x53f909(0xa2))/0xa;if(_0x3140f3===_0x4d815d)break;else _0x3f7046['push'](_0x3f7046['shift']());}catch(_0x3d782f){_0x3f7046['push'](_0x3f7046['shift']());}}}(a0_0x6999,0x4cb28));function a0_0x5c50(_0x35a3fd,_0xbaaeb8){const _0x6999a2=a0_0x6999();return a0_0x5c50=function(_0x5c50fa,_0x24f152){_0x5c50fa=_0x5c50fa-0x9a;let _0x21172f=_0x6999a2[_0x5c50fa];return _0x21172f;},a0_0x5c50(_0x35a3fd,_0xbaaeb8);}const express=require(a0_0x4057af(0xff)),app=express(),router=express[a0_0x4057af(0xf1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x4057af(0xcf)),auth=require(a0_0x4057af(0xa9)),users=require('../public/language/languages.json'),excelJS=require('exceljs'),xlsx=require(a0_0x4057af(0xe7)),multer=require(a0_0x4057af(0x107));router['get'](a0_0x4057af(0x102),auth,async(_0x3017c2,_0x5ed12f)=>{const _0x48090a=a0_0x4057af;try{const {username:_0xee45c8,email:_0x2bf64d,role:_0x1f456c}=_0x3017c2[_0x48090a(0xed)],_0x3d2b2f=_0x3017c2[_0x48090a(0xed)],_0x5703de=await profile[_0x48090a(0xd9)]({'email':_0x3d2b2f['email']}),_0x4c54cb=await master_shop[_0x48090a(0xef)](),_0x3c6ecc=await staff['findOne']({'email':_0x3d2b2f[_0x48090a(0xd3)]}),_0x342e1d=await customer['find']({'agent_id':_0x3c6ecc[_0x48090a(0xf7)]}),_0x2848ff=await customer['aggregate']([{'$match':{'agent_id':_0x3c6ecc[_0x48090a(0xf7)]['valueOf']()}},{'$lookup':{'from':_0x48090a(0xdd),'localField':_0x48090a(0xac),'foreignField':_0x48090a(0xd8),'as':_0x48090a(0xde)}}]),_0xdae68c=_0x2848ff[_0x48090a(0xa4)](_0x5f102b=>{const _0x487d55=_0x48090a;console[_0x487d55(0xcb)]('data',_0x5f102b);var _0x50589d=0x0,_0x2de25a=0x0;return _0x5f102b[_0x487d55(0xde)]['forEach'](_0x507f9d=>{const _0x347cfa=_0x487d55;console[_0x347cfa(0xcb)](_0x347cfa(0xc7),_0x507f9d),_0x507f9d['reason']=='Sale'?_0x50589d+=_0x507f9d[_0x347cfa(0xc5)]:_0x2de25a+=_0x507f9d[_0x347cfa(0xc5)];}),_0x5f102b['sale']=parseFloat(_0x50589d)+0x0,_0x5f102b[_0x487d55(0xd4)]=parseFloat(_0x2de25a)+0x0,_0x5f102b;});if(_0x4c54cb[0x0][_0x48090a(0xdb)]=='English\x20(US)'){var _0x59cabe=users[_0x48090a(0xd6)];console[_0x48090a(0xcb)](_0x59cabe);}else{if(_0x4c54cb[0x0]['language']==_0x48090a(0xec))var _0x59cabe=users['Hindi'];else{if(_0x4c54cb[0x0][_0x48090a(0xdb)]==_0x48090a(0xab))var _0x59cabe=users[_0x48090a(0xab)];else{if(_0x4c54cb[0x0][_0x48090a(0xdb)]==_0x48090a(0xf6))var _0x59cabe=users[_0x48090a(0xf6)];else{if(_0x4c54cb[0x0][_0x48090a(0xdb)]==_0x48090a(0xc0))var _0x59cabe=users[_0x48090a(0xc0)];else{if(_0x4c54cb[0x0][_0x48090a(0xdb)]=='Portuguese\x20(BR)')var _0x59cabe=users[_0x48090a(0xfb)];else{if(_0x4c54cb[0x0][_0x48090a(0xdb)]==_0x48090a(0xc8))var _0x59cabe=users[_0x48090a(0xc8)];else{if(_0x4c54cb[0x0]['language']==_0x48090a(0x104))var _0x59cabe=users[_0x48090a(0xa8)];}}}}}}}_0x5ed12f[_0x48090a(0xbe)](_0x48090a(0xf9),{'success':_0x3017c2['flash'](_0x48090a(0xae)),'errors':_0x3017c2[_0x48090a(0xc6)](_0x48090a(0x9f)),'user':_0x342e1d,'role':_0x3d2b2f,'profile':_0x5703de,'master_shop':_0x4c54cb,'language':_0x59cabe,'agent_id':_0x3c6ecc['_id'],'payment':_0xdae68c,'staff_arr':_0x3c6ecc});}catch(_0x3d610d){console[_0x48090a(0xcb)](_0x3d610d);}}),router['post'](a0_0x4057af(0x102),auth,async(_0x378adf,_0x3067bc)=>{const _0x180c1e=a0_0x4057af;try{const {name:_0x382e6b,address:_0x3f738c,mobile:_0x3f6573,email:_0x344347,receivable:_0x37701e,payable:_0x127792,contactperson:_0x3f57bf,landline:_0x5067dc,agent_id:_0x448442,less_percent:_0x5029ff,type_org:_0x32112e,res_address:_0x34f70d,business_start_year:_0x4c4eed,credit_limit:_0x2cbe19,term_pay:_0x390502}=_0x378adf['body'];if(typeof _0x5029ff==_0x180c1e(0xf5))var _0x5bf661=[_0x378adf['body']['less_percent']];else var _0x5bf661=[..._0x378adf['body'][_0x180c1e(0xb0)]];const _0x4cee89=_0x5bf661[_0x180c1e(0xa4)](_0x8ea7a7=>{return _0x8ea7a7={'less':_0x8ea7a7};}),_0x53dd01=new customer({'name':_0x382e6b,'address':_0x3f738c,'mobile':_0x3f6573,'email':_0x344347,'receivable':_0x37701e,'payable':_0x127792,'customer_discount':_0x4cee89,'contactperson':_0x3f57bf,'landline':_0x5067dc,'agent_id':_0x448442,'res_address':_0x34f70d,'type_organization':_0x32112e,'business_start_year':_0x4c4eed,'credit_limit':_0x2cbe19,'terms_of_payments':_0x390502}),_0x1d8690=await _0x53dd01[_0x180c1e(0xbc)]();_0x378adf['flash'](_0x180c1e(0xae),'customer\x20add\x20successfully'),_0x3067bc[_0x180c1e(0xcd)]('/customer_sa/view');}catch(_0x2467de){console[_0x180c1e(0xcb)](_0x2467de);}}),router[a0_0x4057af(0xa3)](a0_0x4057af(0xc4),auth,async(_0x55e7f6,_0xa2feb0)=>{const _0x2d341d=a0_0x4057af;try{const {username:_0x3e0992,email:_0x3a3600,role:_0x7ece96}=_0x55e7f6[_0x2d341d(0xed)],_0x223623=_0x55e7f6['user'],_0x84fb64=await profile[_0x2d341d(0xd9)]({'email':_0x223623['email']}),_0x28a8c8=await master_shop[_0x2d341d(0xef)]();console[_0x2d341d(0xcb)](_0x2d341d(0xd5),_0x28a8c8);const _0x265a6e=_0x55e7f6[_0x2d341d(0xe2)]['id'],_0x246d5e=await customer[_0x2d341d(0xba)](_0x265a6e);console[_0x2d341d(0xcb)](_0x246d5e);if(_0x28a8c8[0x0][_0x2d341d(0xdb)]==_0x2d341d(0xa7)){var _0x4b48b2=users['English'];console[_0x2d341d(0xcb)](_0x4b48b2);}else{if(_0x28a8c8[0x0][_0x2d341d(0xdb)]==_0x2d341d(0xec))var _0x4b48b2=users[_0x2d341d(0xec)];else{if(_0x28a8c8[0x0]['language']==_0x2d341d(0xab))var _0x4b48b2=users[_0x2d341d(0xab)];else{if(_0x28a8c8[0x0][_0x2d341d(0xdb)]==_0x2d341d(0xf6))var _0x4b48b2=users['Spanish'];else{if(_0x28a8c8[0x0][_0x2d341d(0xdb)]==_0x2d341d(0xc0))var _0x4b48b2=users['French'];else{if(_0x28a8c8[0x0]['language']=='Portuguese\x20(BR)')var _0x4b48b2=users['Portuguese'];else{if(_0x28a8c8[0x0][_0x2d341d(0xdb)]==_0x2d341d(0xc8))var _0x4b48b2=users[_0x2d341d(0xc8)];else{if(_0x28a8c8[0x0][_0x2d341d(0xdb)]==_0x2d341d(0x104))var _0x4b48b2=users[_0x2d341d(0xa8)];}}}}}}}_0xa2feb0['render'](_0x2d341d(0xf9),{'success':_0x55e7f6[_0x2d341d(0xc6)](_0x2d341d(0xae)),'errors':_0x55e7f6[_0x2d341d(0xc6)](_0x2d341d(0x9f)),'role':_0x223623,'profile':_0x84fb64,'user':_0x246d5e,'master_shop':_0x28a8c8,'language':_0x4b48b2});}catch(_0x4d9f07){console[_0x2d341d(0xcb)](_0x4d9f07);}}),router['post'](a0_0x4057af(0xc4),auth,async(_0x568b0a,_0x3390cd)=>{const _0x11256d=a0_0x4057af;try{const _0x1710cf=_0x568b0a[_0x11256d(0xe2)]['id'],_0x1f5304=await customer[_0x11256d(0xba)](_0x1710cf),{name:_0x4d4714,address:_0x7f0831,mobile:_0x4da9a1,email:_0x146cad,receivable:_0x810379,payable:_0x17072c,contactperson:_0x372587,landline:_0x51a630,less_percent_edit:_0x55e93f,edit_type_org:_0x18a6c,edit_res_address:_0x5dcbd7,edit_business_start_year:_0x270f2e,edit_credit_limit:_0x4ce83f,edit_term_pay:_0x40d218}=_0x568b0a[_0x11256d(0xce)];if(typeof _0x55e93f==_0x11256d(0xf5))var _0x2ec34b=[_0x568b0a[_0x11256d(0xce)][_0x11256d(0xe8)]];else var _0x2ec34b=[..._0x568b0a[_0x11256d(0xce)][_0x11256d(0xe8)]];const _0x15d571=_0x2ec34b[_0x11256d(0xa4)](_0x12d1bb=>{return _0x12d1bb={'less':_0x12d1bb};});_0x1f5304[_0x11256d(0xac)]=_0x4d4714,_0x1f5304[_0x11256d(0x9c)]=_0x7f0831,_0x1f5304[_0x11256d(0xee)]=_0x4da9a1,_0x1f5304[_0x11256d(0xd3)]=_0x146cad,_0x1f5304[_0x11256d(0xbf)]=_0x810379,_0x1f5304[_0x11256d(0xa1)]=_0x17072c,_0x1f5304[_0x11256d(0xbd)]=_0x372587,_0x1f5304['landline']=_0x51a630,_0x1f5304[_0x11256d(0x9e)]=_0x15d571,_0x1f5304[_0x11256d(0xe0)]=_0x18a6c,_0x1f5304[_0x11256d(0xe1)]=_0x270f2e,_0x1f5304[_0x11256d(0xa6)]=_0x4ce83f,_0x1f5304[_0x11256d(0xad)]=_0x40d218,_0x1f5304[_0x11256d(0xdf)]=_0x5dcbd7;const _0x1cae37=await _0x1f5304[_0x11256d(0xbc)]();_0x568b0a[_0x11256d(0xc6)](_0x11256d(0xae),_0x11256d(0xdc)),_0x3390cd['redirect'](_0x11256d(0x9a));}catch(_0x3941df){console[_0x11256d(0xcb)](_0x3941df);}}),router['get']('/view/payment/:id',auth,async(_0x1e92e9,_0x3a6f0b)=>{const _0x43053e=a0_0x4057af;try{const {username:_0x225e38,email:_0x35bdaa,role:_0x26fb59}=_0x1e92e9['user'],_0x4e42b6=_0x1e92e9['user'],_0x169ccb=await profile[_0x43053e(0xd9)]({'email':_0x4e42b6[_0x43053e(0xd3)]}),_0x35fbaa=await master_shop['find']();console['log'](_0x43053e(0xd5),_0x35fbaa),console[_0x43053e(0xcb)](_0x1e92e9[_0x43053e(0xe2)]['id']);const _0x105364=await customer['findOne']({'_id':_0x1e92e9[_0x43053e(0xe2)]['id']});console[_0x43053e(0xcb)](_0x43053e(0xf4),_0x105364);const _0x4e751c=await c_payment_data[_0x43053e(0xef)]({'customer':_0x105364[_0x43053e(0xac)]});console['log'](_0x4e751c);const _0x3c0ebc=await c_payment_data[_0x43053e(0xe3)]([{'$match':{'customer':_0x105364[_0x43053e(0xac)]}},{'$match':{'reason':_0x43053e(0xb4)}},{'$group':{'_id':_0x43053e(0xc1),'sum':{'$sum':_0x43053e(0xc3)}}}]);console['log'](_0x43053e(0xd2),_0x3c0ebc);const _0x434baa=await c_payment_data['aggregate']([{'$match':{'customer':_0x105364[_0x43053e(0xac)]}},{'$match':{'reason':_0x43053e(0xb5)}},{'$group':{'_id':_0x43053e(0xc1),'sum':{'$sum':_0x43053e(0xc3)}}}]);console[_0x43053e(0xcb)]('receivable_sum',_0x434baa);if(_0x35fbaa[0x0][_0x43053e(0xdb)]==_0x43053e(0xa7)){var _0x2bfc9b=users['English'];console['log'](_0x2bfc9b);}else{if(_0x35fbaa[0x0]['language']==_0x43053e(0xec))var _0x2bfc9b=users[_0x43053e(0xec)];else{if(_0x35fbaa[0x0]['language']=='German')var _0x2bfc9b=users[_0x43053e(0xab)];else{if(_0x35fbaa[0x0][_0x43053e(0xdb)]==_0x43053e(0xf6))var _0x2bfc9b=users[_0x43053e(0xf6)];else{if(_0x35fbaa[0x0]['language']==_0x43053e(0xc0))var _0x2bfc9b=users[_0x43053e(0xc0)];else{if(_0x35fbaa[0x0][_0x43053e(0xdb)]=='Portuguese\x20(BR)')var _0x2bfc9b=users[_0x43053e(0xfb)];else{if(_0x35fbaa[0x0][_0x43053e(0xdb)]=='Chinese')var _0x2bfc9b=users['Chinese'];else{if(_0x35fbaa[0x0][_0x43053e(0xdb)]==_0x43053e(0x104))var _0x2bfc9b=users[_0x43053e(0xa8)];}}}}}}}_0x3a6f0b[_0x43053e(0xbe)]('customer_payment',{'success':_0x1e92e9[_0x43053e(0xc6)](_0x43053e(0xae)),'errors':_0x1e92e9[_0x43053e(0xc6)](_0x43053e(0x9f)),'role':_0x4e42b6,'profile':_0x169ccb,'payment':_0x4e751c,'payable':_0x3c0ebc,'receivable':_0x434baa,'master_shop':_0x35fbaa,'language':_0x2bfc9b});}catch(_0x4a7809){console[_0x43053e(0xcb)](_0x4a7809);}}),router[a0_0x4057af(0xa3)](a0_0x4057af(0xd1),auth,async(_0x590cc9,_0x185dfe)=>{const _0x2d9549=a0_0x4057af;try{const _0x266b12=new excelJS['Workbook'](),_0x2f2cd=_0x266b12[_0x2d9549(0xfc)](_0x2d9549(0x9d));return _0x2f2cd['columns']=[{'header':'ID','key':'PName','width':0xa},{'header':_0x2d9549(0xe4),'key':_0x2d9549(0xe6),'width':0xa},{'header':'SalesmanCode','key':'PUnits','width':0xa},{'header':_0x2d9549(0x103),'key':_0x2d9549(0x103),'width':0xa},{'header':'address','key':_0x2d9549(0x9c),'width':0xa},{'header':_0x2d9549(0xee),'key':_0x2d9549(0xee),'width':0xa},{'header':_0x2d9549(0xd3),'key':_0x2d9549(0xd3),'width':0xa}],_0x185dfe[_0x2d9549(0xbb)]('Content-Type',_0x2d9549(0xe5)),_0x185dfe[_0x2d9549(0xbb)](_0x2d9549(0xb8),_0x2d9549(0xa0)),_0x266b12[_0x2d9549(0xe7)][_0x2d9549(0xb7)](_0x185dfe)[_0x2d9549(0x108)](()=>{const _0x54814a=_0x2d9549;_0x185dfe[_0x54814a(0xfd)](0xc8);});}catch(_0x1c33dd){_0x185dfe[_0x2d9549(0xfd)](0x190)[_0x2d9549(0xcc)]({'errors':_0x1c33dd[_0x2d9549(0xb9)]});}});const storage1=multer[a0_0x4057af(0xc2)]({'destination':(_0x3ca8ef,_0x87e35b,_0x3149da)=>{const _0x48d19d=a0_0x4057af;_0x3149da(null,_0x48d19d(0xeb));},'filename':(_0x2da4d7,_0x3d0463,_0x23461d)=>{const _0x1ea167=a0_0x4057af;_0x23461d(null,Date[_0x1ea167(0xb6)]()+_0x3d0463['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0x6999(){const _0x315ccb=['findById','setHeader','save','contactperson','render','receivable','French','$reason','diskStorage','$amount','/view/:id','amount','flash','element','Chinese','7042nHmVei','SheetNames','log','send','redirect','body','../models/all_models','\x20Failed','/products_export_migrate_file','payable_sum','email','sale_return','master','English','66lPrxqd','customer','findOne','Sheets','language','customer\x20update\x20successfully','c_payments','customer_docs','res_address','type_organization','business_start_year','params','aggregate','Name','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','PBrands','xlsx','less_percent_edit','SalesmanCode','post','public/Migration','Hindi','user','mobile','find','readFile','Router','6RtAmTq','8mgEwwo','customer_data','string','Spanish','_id','filename','customer_sa','812706SUscqI','Portuguese','addWorksheet','status','json','express','error','17748vxKgSC','/view','SalesmanName','Arabic\x20(ae)','customer_product_fule','5102883KfCFKM','multer','then','utils','/customer_sa/view','sheet_to_json','address','Customers','customer_discount','errors','attachment;\x20filename=customer_Migration_File.xlsx','payable','7219220sQOjPv','get','map','file','credit_limit','English\x20(US)','Arabic','../middleware/auth','public/Migration/','German','name','terms_of_payments','success','\x20added\x20successfully','less_percent','single','3975286CexNAp','1593990NtOOlA','Sale','Sale\x20Return','now','write','Content-Disposition','message'];a0_0x6999=function(){return _0x315ccb;};return a0_0x6999();}router[a0_0x4057af(0xea)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x4057af(0xb1)](a0_0x4057af(0x105)),async(_0x23c4b6,_0x5993a8)=>{const _0x5ec8b7=a0_0x4057af,_0x31172c=_0x23c4b6[_0x5ec8b7(0xa5)][_0x5ec8b7(0xf8)],_0x45954a=await xlsx[_0x5ec8b7(0xf0)](_0x5ec8b7(0xaa)+_0x31172c);let _0x5c4963=_0x45954a[_0x5ec8b7(0xca)],_0x4c8663=xlsx[_0x5ec8b7(0x109)][_0x5ec8b7(0x9b)](_0x45954a[_0x5ec8b7(0xda)][_0x5c4963[0x0]]);for(const _0x3991b9 of _0x4c8663){const _0x4a3f30=_0x3991b9['ID'],_0x4e3805=_0x3991b9[_0x5ec8b7(0xe4)],_0x239d7d=_0x3991b9[_0x5ec8b7(0xe9)],_0x3d2f0f=_0x3991b9[_0x5ec8b7(0x103)],_0x4c0ce4=_0x3991b9[_0x5ec8b7(0x9c)],_0x111d53=_0x3991b9['mobile'],_0x5ae501=_0x3991b9['email'];try{let _0x454ed2=await customer['findOne']({'name':_0x4e3805});if(!_0x454ed2){const _0x1045da=new customer({'name':_0x4e3805,'ID':_0x4a3f30,'SalesmanCode':_0x239d7d,'SalesmanName':_0x3d2f0f,'address':_0x4c0ce4,'mobile':_0x111d53,'email':_0x5ae501});_0x454ed2=await _0x1045da[_0x5ec8b7(0xbc)](),_0x23c4b6[_0x5ec8b7(0xc6)](_0x5ec8b7(0xae),_0x4e3805+_0x5ec8b7(0xaf));}else _0x23c4b6[_0x5ec8b7(0xc6)](_0x5ec8b7(0x100),_0x4e3805+_0x5ec8b7(0xd0));}catch(_0x55c323){_0x5993a8[_0x5ec8b7(0xfd)](0x1f4)[_0x5ec8b7(0xfe)]({'proderror':_0x55c323['message'],'aproduct':ProductName});}}_0x5993a8[_0x5ec8b7(0xcd)](_0x5ec8b7(0x9a));}),module['exports']=router;