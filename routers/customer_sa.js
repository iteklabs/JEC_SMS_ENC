const a0_0xec23c4=a0_0x27ca;(function(_0x554eaa,_0x10ef2a){const _0x8b11c4=a0_0x27ca,_0x2a9d1c=_0x554eaa();while(!![]){try{const _0x257e0=-parseInt(_0x8b11c4(0x149))/0x1*(parseInt(_0x8b11c4(0x1a7))/0x2)+parseInt(_0x8b11c4(0x198))/0x3+parseInt(_0x8b11c4(0x180))/0x4*(-parseInt(_0x8b11c4(0x17b))/0x5)+parseInt(_0x8b11c4(0x1a3))/0x6*(parseInt(_0x8b11c4(0x1ab))/0x7)+parseInt(_0x8b11c4(0x185))/0x8+parseInt(_0x8b11c4(0x17f))/0x9+-parseInt(_0x8b11c4(0x187))/0xa*(parseInt(_0x8b11c4(0x168))/0xb);if(_0x257e0===_0x10ef2a)break;else _0x2a9d1c['push'](_0x2a9d1c['shift']());}catch(_0x5134d4){_0x2a9d1c['push'](_0x2a9d1c['shift']());}}}(a0_0xdc83,0x4c364));const express=require(a0_0xec23c4(0x19e)),app=express(),router=express[a0_0xec23c4(0x15c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0xec23c4(0x1b6)),excelJS=require('exceljs'),xlsx=require(a0_0xec23c4(0x164)),multer=require(a0_0xec23c4(0x170));function a0_0x27ca(_0x14ce91,_0x1ab84c){const _0xdc836c=a0_0xdc83();return a0_0x27ca=function(_0x27ca96,_0x18f66e){_0x27ca96=_0x27ca96-0x148;let _0x4f4450=_0xdc836c[_0x27ca96];return _0x4f4450;},a0_0x27ca(_0x14ce91,_0x1ab84c);}router[a0_0xec23c4(0x190)](a0_0xec23c4(0x16f),auth,async(_0x2a58ad,_0x473cb2)=>{const _0x27f4d9=a0_0xec23c4;try{const {username:_0x44de8b,email:_0x7a889e,role:_0x406029}=_0x2a58ad[_0x27f4d9(0x1ad)],_0x4b2f69=_0x2a58ad[_0x27f4d9(0x1ad)],_0x2189ef=await profile[_0x27f4d9(0x15e)]({'email':_0x4b2f69[_0x27f4d9(0x156)]}),_0x1ff02d=await master_shop[_0x27f4d9(0x161)](),_0x68363d=await staff[_0x27f4d9(0x15e)]({'email':_0x4b2f69[_0x27f4d9(0x156)]}),_0x455e5d=await customer[_0x27f4d9(0x161)]({'agent_id':_0x68363d['_id']}),_0x90c28b=await customer[_0x27f4d9(0x176)]([{'$match':{'agent_id':_0x68363d['_id'][_0x27f4d9(0x19b)]()}},{'$lookup':{'from':_0x27f4d9(0x1b1),'localField':_0x27f4d9(0x18f),'foreignField':'customer','as':'customer_docs'}}]),_0x3a5647=_0x90c28b[_0x27f4d9(0x151)](_0xa0290d=>{const _0x104cef=_0x27f4d9;console[_0x104cef(0x196)](_0x104cef(0x1a6),_0xa0290d);var _0x404130=0x0,_0xed398b=0x0;return _0xa0290d[_0x104cef(0x15f)][_0x104cef(0x1b2)](_0x4899a6=>{const _0x2de87f=_0x104cef;console[_0x2de87f(0x196)](_0x2de87f(0x191),_0x4899a6),_0x4899a6['reason']=='Sale'?_0x404130+=_0x4899a6[_0x2de87f(0x1a1)]:_0xed398b+=_0x4899a6['amount'];}),_0xa0290d[_0x104cef(0x157)]=parseFloat(_0x404130)+0x0,_0xa0290d[_0x104cef(0x166)]=parseFloat(_0xed398b)+0x0,_0xa0290d;});if(_0x1ff02d[0x0][_0x27f4d9(0x165)]==_0x27f4d9(0x14f)){var _0x432747=users['English'];console[_0x27f4d9(0x196)](_0x432747);}else{if(_0x1ff02d[0x0][_0x27f4d9(0x165)]=='Hindi')var _0x432747=users[_0x27f4d9(0x14d)];else{if(_0x1ff02d[0x0]['language']==_0x27f4d9(0x172))var _0x432747=users[_0x27f4d9(0x172)];else{if(_0x1ff02d[0x0][_0x27f4d9(0x165)]==_0x27f4d9(0x194))var _0x432747=users[_0x27f4d9(0x194)];else{if(_0x1ff02d[0x0][_0x27f4d9(0x165)]==_0x27f4d9(0x15a))var _0x432747=users[_0x27f4d9(0x15a)];else{if(_0x1ff02d[0x0]['language']==_0x27f4d9(0x16c))var _0x432747=users[_0x27f4d9(0x15b)];else{if(_0x1ff02d[0x0][_0x27f4d9(0x165)]==_0x27f4d9(0x19c))var _0x432747=users[_0x27f4d9(0x19c)];else{if(_0x1ff02d[0x0]['language']==_0x27f4d9(0x1aa))var _0x432747=users['Arabic'];}}}}}}}_0x473cb2['render'](_0x27f4d9(0x16b),{'success':_0x2a58ad['flash'](_0x27f4d9(0x181)),'errors':_0x2a58ad['flash'](_0x27f4d9(0x184)),'user':_0x455e5d,'role':_0x4b2f69,'profile':_0x2189ef,'master_shop':_0x1ff02d,'language':_0x432747,'agent_id':_0x68363d['_id'],'payment':_0x3a5647,'staff_arr':_0x68363d});}catch(_0xb12ee7){console['log'](_0xb12ee7);}}),router[a0_0xec23c4(0x17a)](a0_0xec23c4(0x16f),auth,async(_0x1ef286,_0x235ab4)=>{const _0x4bfc06=a0_0xec23c4;try{const {name:_0xbe060a,address:_0x48fa96,mobile:_0x12f129,email:_0x405aea,receivable:_0x45e5b2,payable:_0x2edb2a,contactperson:_0x39b09e,landline:_0x433f85,agent_id:_0x1d6bd0,less_percent:_0x398d27,type_org:_0x54b32f,res_address:_0x3f0308,business_start_year:_0x4fa799,credit_limit:_0xfd7f81,term_pay:_0x1218ef}=_0x1ef286[_0x4bfc06(0x182)];if(typeof _0x398d27==_0x4bfc06(0x167))var _0x472bb7=[_0x1ef286[_0x4bfc06(0x182)]['less_percent']];else var _0x472bb7=[..._0x1ef286['body'][_0x4bfc06(0x1af)]];const _0xcbd339=_0x472bb7[_0x4bfc06(0x151)](_0x2708d3=>{return _0x2708d3={'less':_0x2708d3};}),_0x7f5308=new customer({'name':_0xbe060a,'address':_0x48fa96,'mobile':_0x12f129,'email':_0x405aea,'receivable':_0x45e5b2,'payable':_0x2edb2a,'customer_discount':_0xcbd339,'contactperson':_0x39b09e,'landline':_0x433f85,'agent_id':_0x1d6bd0,'res_address':_0x3f0308,'type_organization':_0x54b32f,'business_start_year':_0x4fa799,'credit_limit':_0xfd7f81,'terms_of_payments':_0x1218ef}),_0x4fd7dc=await _0x7f5308[_0x4bfc06(0x160)]();_0x1ef286['flash']('success','customer\x20add\x20successfully'),_0x235ab4[_0x4bfc06(0x175)](_0x4bfc06(0x15d));}catch(_0x24cced){console[_0x4bfc06(0x196)](_0x24cced);}}),router[a0_0xec23c4(0x190)](a0_0xec23c4(0x159),auth,async(_0x5af46b,_0x57d6ea)=>{const _0x52fcd3=a0_0xec23c4;try{const {username:_0xb5306c,email:_0xc57e77,role:_0x48ba57}=_0x5af46b[_0x52fcd3(0x1ad)],_0xb0932c=_0x5af46b['user'],_0x4e0520=await profile[_0x52fcd3(0x15e)]({'email':_0xb0932c[_0x52fcd3(0x156)]}),_0xca17c7=await master_shop[_0x52fcd3(0x161)]();console[_0x52fcd3(0x196)](_0x52fcd3(0x178),_0xca17c7);const _0xd6341=_0x5af46b[_0x52fcd3(0x18c)]['id'],_0x26d6a4=await customer['findById'](_0xd6341);console[_0x52fcd3(0x196)](_0x26d6a4);if(_0xca17c7[0x0]['language']==_0x52fcd3(0x14f)){var _0x56d5d2=users['English'];console[_0x52fcd3(0x196)](_0x56d5d2);}else{if(_0xca17c7[0x0][_0x52fcd3(0x165)]==_0x52fcd3(0x14d))var _0x56d5d2=users['Hindi'];else{if(_0xca17c7[0x0][_0x52fcd3(0x165)]==_0x52fcd3(0x172))var _0x56d5d2=users[_0x52fcd3(0x172)];else{if(_0xca17c7[0x0][_0x52fcd3(0x165)]==_0x52fcd3(0x194))var _0x56d5d2=users[_0x52fcd3(0x194)];else{if(_0xca17c7[0x0]['language']=='French')var _0x56d5d2=users[_0x52fcd3(0x15a)];else{if(_0xca17c7[0x0]['language']==_0x52fcd3(0x16c))var _0x56d5d2=users[_0x52fcd3(0x15b)];else{if(_0xca17c7[0x0][_0x52fcd3(0x165)]==_0x52fcd3(0x19c))var _0x56d5d2=users[_0x52fcd3(0x19c)];else{if(_0xca17c7[0x0][_0x52fcd3(0x165)]==_0x52fcd3(0x1aa))var _0x56d5d2=users[_0x52fcd3(0x158)];}}}}}}}_0x57d6ea['render'](_0x52fcd3(0x16b),{'success':_0x5af46b[_0x52fcd3(0x1a9)](_0x52fcd3(0x181)),'errors':_0x5af46b['flash'](_0x52fcd3(0x184)),'role':_0xb0932c,'profile':_0x4e0520,'user':_0x26d6a4,'master_shop':_0xca17c7,'language':_0x56d5d2});}catch(_0x482eb9){console[_0x52fcd3(0x196)](_0x482eb9);}}),router[a0_0xec23c4(0x17a)](a0_0xec23c4(0x159),auth,async(_0x2b85a4,_0x2fd447)=>{const _0xb5d604=a0_0xec23c4;try{const _0x11bd93=_0x2b85a4[_0xb5d604(0x18c)]['id'],_0x36e6a7=await customer[_0xb5d604(0x177)](_0x11bd93),{name:_0x502b8f,address:_0x1d322f,mobile:_0x325ce4,email:_0x8374b9,receivable:_0x531dd2,payable:_0x3d9c36,contactperson:_0x2a87b5,landline:_0x35f2d6,less_percent_edit:_0x5d7516,edit_type_org:_0x29e4b7,edit_res_address:_0x10fe92,edit_business_start_year:_0x1be2c0,edit_credit_limit:_0x17e607,edit_term_pay:_0x61ebb6}=_0x2b85a4[_0xb5d604(0x182)];if(typeof _0x5d7516==_0xb5d604(0x167))var _0x26fc61=[_0x2b85a4['body'][_0xb5d604(0x17d)]];else var _0x26fc61=[..._0x2b85a4[_0xb5d604(0x182)]['less_percent_edit']];const _0x32ee6e=_0x26fc61[_0xb5d604(0x151)](_0x2f46a7=>{return _0x2f46a7={'less':_0x2f46a7};});_0x36e6a7[_0xb5d604(0x18f)]=_0x502b8f,_0x36e6a7[_0xb5d604(0x186)]=_0x1d322f,_0x36e6a7[_0xb5d604(0x1b5)]=_0x325ce4,_0x36e6a7[_0xb5d604(0x156)]=_0x8374b9,_0x36e6a7[_0xb5d604(0x179)]=_0x531dd2,_0x36e6a7[_0xb5d604(0x1a4)]=_0x3d9c36,_0x36e6a7['contactperson']=_0x2a87b5,_0x36e6a7['landline']=_0x35f2d6,_0x36e6a7[_0xb5d604(0x19f)]=_0x32ee6e,_0x36e6a7[_0xb5d604(0x162)]=_0x29e4b7,_0x36e6a7[_0xb5d604(0x189)]=_0x1be2c0,_0x36e6a7['credit_limit']=_0x17e607,_0x36e6a7['terms_of_payments']=_0x61ebb6,_0x36e6a7[_0xb5d604(0x14b)]=_0x10fe92;const _0x4b768d=await _0x36e6a7[_0xb5d604(0x160)]();_0x2b85a4[_0xb5d604(0x1a9)](_0xb5d604(0x181),_0xb5d604(0x174)),_0x2fd447[_0xb5d604(0x175)]('/customer_sa/view');}catch(_0x6e2cba){console[_0xb5d604(0x196)](_0x6e2cba);}}),router['get']('/view/payment/:id',auth,async(_0x4d95ea,_0x4524c4)=>{const _0x1f58a3=a0_0xec23c4;try{const {username:_0x314e5a,email:_0xbde1e,role:_0x306318}=_0x4d95ea[_0x1f58a3(0x1ad)],_0x144d9f=_0x4d95ea[_0x1f58a3(0x1ad)],_0x41fbb1=await profile[_0x1f58a3(0x15e)]({'email':_0x144d9f[_0x1f58a3(0x156)]}),_0x36052a=await master_shop[_0x1f58a3(0x161)]();console[_0x1f58a3(0x196)]('master',_0x36052a),console['log'](_0x4d95ea[_0x1f58a3(0x18c)]['id']);const _0x4abe8d=await customer[_0x1f58a3(0x15e)]({'_id':_0x4d95ea[_0x1f58a3(0x18c)]['id']});console['log']('customer_data',_0x4abe8d);const _0x1af6f8=await c_payment_data[_0x1f58a3(0x161)]({'customer':_0x4abe8d[_0x1f58a3(0x18f)]});console[_0x1f58a3(0x196)](_0x1af6f8);const _0x685af0=await c_payment_data['aggregate']([{'$match':{'customer':_0x4abe8d[_0x1f58a3(0x18f)]}},{'$match':{'reason':_0x1f58a3(0x1b0)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x1f58a3(0x1ac)}}}]);console[_0x1f58a3(0x196)](_0x1f58a3(0x1b7),_0x685af0);const _0x583814=await c_payment_data[_0x1f58a3(0x176)]([{'$match':{'customer':_0x4abe8d[_0x1f58a3(0x18f)]}},{'$match':{'reason':_0x1f58a3(0x16d)}},{'$group':{'_id':_0x1f58a3(0x195),'sum':{'$sum':_0x1f58a3(0x1ac)}}}]);console[_0x1f58a3(0x196)](_0x1f58a3(0x148),_0x583814);if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x14f)){var _0x163d3c=users[_0x1f58a3(0x152)];console['log'](_0x163d3c);}else{if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x14d))var _0x163d3c=users[_0x1f58a3(0x14d)];else{if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x172))var _0x163d3c=users[_0x1f58a3(0x172)];else{if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x194))var _0x163d3c=users['Spanish'];else{if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x15a))var _0x163d3c=users[_0x1f58a3(0x15a)];else{if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x16c))var _0x163d3c=users[_0x1f58a3(0x15b)];else{if(_0x36052a[0x0]['language']=='Chinese')var _0x163d3c=users['Chinese'];else{if(_0x36052a[0x0][_0x1f58a3(0x165)]==_0x1f58a3(0x1aa))var _0x163d3c=users[_0x1f58a3(0x158)];}}}}}}}_0x4524c4[_0x1f58a3(0x173)](_0x1f58a3(0x14e),{'success':_0x4d95ea['flash']('success'),'errors':_0x4d95ea[_0x1f58a3(0x1a9)](_0x1f58a3(0x184)),'role':_0x144d9f,'profile':_0x41fbb1,'payment':_0x1af6f8,'payable':_0x685af0,'receivable':_0x583814,'master_shop':_0x36052a,'language':_0x163d3c});}catch(_0x34d52d){console[_0x1f58a3(0x196)](_0x34d52d);}}),router[a0_0xec23c4(0x190)](a0_0xec23c4(0x18d),auth,async(_0x103b1e,_0x1074e8)=>{const _0x2346ed=a0_0xec23c4;try{const _0x4bacc0=new excelJS[(_0x2346ed(0x19a))](),_0xe7a0c6=_0x4bacc0[_0x2346ed(0x199)](_0x2346ed(0x18e));return _0xe7a0c6['columns']=[{'header':'ID','key':_0x2346ed(0x188),'width':0xa},{'header':_0x2346ed(0x16e),'key':_0x2346ed(0x153),'width':0xa},{'header':_0x2346ed(0x14a),'key':_0x2346ed(0x1b4),'width':0xa},{'header':_0x2346ed(0x169),'key':'SalesmanName','width':0xa},{'header':'address','key':_0x2346ed(0x186),'width':0xa},{'header':'mobile','key':_0x2346ed(0x1b5),'width':0xa},{'header':_0x2346ed(0x156),'key':_0x2346ed(0x156),'width':0xa}],_0x1074e8[_0x2346ed(0x1a5)]('Content-Type',_0x2346ed(0x17e)),_0x1074e8[_0x2346ed(0x1a5)](_0x2346ed(0x14c),_0x2346ed(0x1b8)),_0x4bacc0['xlsx']['write'](_0x1074e8)['then'](()=>{const _0x52030f=_0x2346ed;_0x1074e8[_0x52030f(0x18a)](0xc8);});}catch(_0x238ec0){_0x1074e8[_0x2346ed(0x18a)](0x190)[_0x2346ed(0x150)]({'errors':_0x238ec0[_0x2346ed(0x16a)]});}});const storage1=multer[a0_0xec23c4(0x171)]({'destination':(_0x436798,_0x483231,_0x4dc868)=>{const _0x47eca8=a0_0xec23c4;_0x4dc868(null,_0x47eca8(0x1a0));},'filename':(_0x26a0e4,_0x4283de,_0x3fdd13)=>{const _0x5acfbe=a0_0xec23c4;_0x3fdd13(null,Date[_0x5acfbe(0x1a8)]()+_0x4283de[_0x5acfbe(0x1a2)]);}}),uploadMigrate=multer({'storage':storage1});router['post']('/customer_import_migrate_file',auth,uploadMigrate['single'](a0_0xec23c4(0x197)),async(_0x324fb5,_0x2ab554)=>{const _0x239bf5=a0_0xec23c4,_0x368c60=_0x324fb5[_0x239bf5(0x154)][_0x239bf5(0x193)],_0x2659d1=await xlsx[_0x239bf5(0x18b)](_0x239bf5(0x155)+_0x368c60);let _0x41cc44=_0x2659d1[_0x239bf5(0x1ae)],_0x460fde=xlsx[_0x239bf5(0x192)][_0x239bf5(0x163)](_0x2659d1[_0x239bf5(0x19d)][_0x41cc44[0x0]]);for(const _0x33e564 of _0x460fde){const _0x2e469e=_0x33e564['ID'],_0xfdb036=_0x33e564[_0x239bf5(0x16e)],_0x68ea2c=_0x33e564[_0x239bf5(0x14a)],_0x345a8f=_0x33e564[_0x239bf5(0x169)],_0x1cc3f2=_0x33e564[_0x239bf5(0x186)],_0x23c9a5=_0x33e564[_0x239bf5(0x1b5)],_0x672086=_0x33e564[_0x239bf5(0x156)];try{let _0x4b3e14=await customer[_0x239bf5(0x15e)]({'name':_0xfdb036});if(!_0x4b3e14){const _0x351007=new customer({'name':_0xfdb036,'ID':_0x2e469e,'SalesmanCode':_0x68ea2c,'SalesmanName':_0x345a8f,'address':_0x1cc3f2,'mobile':_0x23c9a5,'email':_0x672086});_0x4b3e14=await _0x351007[_0x239bf5(0x160)](),_0x324fb5['flash'](_0x239bf5(0x181),_0xfdb036+_0x239bf5(0x1b3));}else _0x324fb5[_0x239bf5(0x1a9)](_0x239bf5(0x17c),_0xfdb036+_0x239bf5(0x183));}catch(_0x5e07a4){_0x2ab554[_0x239bf5(0x18a)](0x1f4)['json']({'proderror':_0x5e07a4[_0x239bf5(0x16a)],'aproduct':ProductName});}}_0x2ab554[_0x239bf5(0x175)](_0x239bf5(0x15d));}),module[a0_0xec23c4(0x1b9)]=router;function a0_0xdc83(){const _0x4ee222=['customer_product_fule','1013328VASzrh','addWorksheet','Workbook','valueOf','Chinese','Sheets','express','customer_discount','public/Migration','amount','originalname','1524itEizC','payable','setHeader','data','441690tmfsVU','now','flash','Arabic\x20(ae)','3514DpBndF','$amount','user','SheetNames','less_percent','Sale','c_payments','forEach','\x20added\x20successfully','PUnits','mobile','../public/language/languages.json','payable_sum','attachment;\x20filename=customer_Migration_File.xlsx','exports','receivable_sum','1ZJcYTJ','SalesmanCode','res_address','Content-Disposition','Hindi','customer_payment','English\x20(US)','send','map','English','PBrands','file','public/Migration/','email','sale','Arabic','/view/:id','French','Portuguese','Router','/customer_sa/view','findOne','customer_docs','save','find','type_organization','sheet_to_json','xlsx','language','sale_return','string','4983SlQkbE','SalesmanName','message','customer_sa','Portuguese\x20(BR)','Sale\x20Return','Name','/view','multer','diskStorage','German','render','customer\x20update\x20successfully','redirect','aggregate','findById','master','receivable','post','396475JwALaR','error','less_percent_edit','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','272808YsxUyj','8iHyQLq','success','body','\x20Failed','errors','3347408wnuXny','address','4910yMWMex','PName','business_start_year','status','readFile','params','/products_export_migrate_file','Customers','name','get','element','utils','filename','Spanish','$reason','log'];a0_0xdc83=function(){return _0x4ee222;};return a0_0xdc83();}