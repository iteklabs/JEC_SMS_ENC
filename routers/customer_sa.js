const a0_0x24b08f=a0_0x5cd3;(function(_0x23d95c,_0xdba32d){const _0x200218=a0_0x5cd3,_0x396293=_0x23d95c();while(!![]){try{const _0x19f362=-parseInt(_0x200218(0x119))/0x1+parseInt(_0x200218(0x14e))/0x2*(parseInt(_0x200218(0x122))/0x3)+-parseInt(_0x200218(0x10d))/0x4+parseInt(_0x200218(0x164))/0x5*(parseInt(_0x200218(0x107))/0x6)+-parseInt(_0x200218(0x124))/0x7*(-parseInt(_0x200218(0x16f))/0x8)+-parseInt(_0x200218(0x149))/0x9+parseInt(_0x200218(0x115))/0xa;if(_0x19f362===_0xdba32d)break;else _0x396293['push'](_0x396293['shift']());}catch(_0x471819){_0x396293['push'](_0x396293['shift']());}}}(a0_0x1bb2,0xeb432));const express=require(a0_0x24b08f(0x155)),app=express(),router=express[a0_0x24b08f(0x13b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x24b08f(0x158)),users=require('../public/language/languages.json'),excelJS=require(a0_0x24b08f(0x166)),xlsx=require(a0_0x24b08f(0x141)),multer=require(a0_0x24b08f(0x11f));function a0_0x5cd3(_0x25460c,_0x3c8574){const _0x1bb2b3=a0_0x1bb2();return a0_0x5cd3=function(_0x5cd303,_0x521ced){_0x5cd303=_0x5cd303-0x104;let _0x20bc9b=_0x1bb2b3[_0x5cd303];return _0x20bc9b;},a0_0x5cd3(_0x25460c,_0x3c8574);}router[a0_0x24b08f(0x126)]('/view',auth,async(_0x13decb,_0x149321)=>{const _0x3fd90d=a0_0x24b08f;try{const {username:_0x1dfcd7,email:_0x150812,role:_0x4ba51c}=_0x13decb[_0x3fd90d(0x105)],_0x3e7358=_0x13decb[_0x3fd90d(0x105)],_0x5aab8a=await profile[_0x3fd90d(0x11a)]({'email':_0x3e7358[_0x3fd90d(0x133)]}),_0x40cb61=await master_shop['find'](),_0x4b661a=await staff['findOne']({'email':_0x3e7358[_0x3fd90d(0x133)]}),_0x152bd2=await customer[_0x3fd90d(0x12c)]({'agent_id':_0x4b661a['_id']}),_0x4193df=await customer['aggregate']([{'$match':{'agent_id':_0x4b661a['_id'][_0x3fd90d(0x142)]()}},{'$lookup':{'from':_0x3fd90d(0x174),'localField':'name','foreignField':_0x3fd90d(0x159),'as':_0x3fd90d(0x14c)}}]),_0x3dc038=_0x4193df[_0x3fd90d(0x128)](_0xed493=>{const _0x576a3d=_0x3fd90d;console['log'](_0x576a3d(0x131),_0xed493);var _0x521972=0x0,_0x1645be=0x0;return _0xed493[_0x576a3d(0x14c)][_0x576a3d(0x163)](_0x36c3d1=>{const _0x346c27=_0x576a3d;console['log'](_0x346c27(0x156),_0x36c3d1),_0x36c3d1[_0x346c27(0x135)]==_0x346c27(0x148)?_0x521972+=_0x36c3d1[_0x346c27(0x15e)]:_0x1645be+=_0x36c3d1[_0x346c27(0x15e)];}),_0xed493[_0x576a3d(0x12a)]=parseFloat(_0x521972)+0x0,_0xed493[_0x576a3d(0x171)]=parseFloat(_0x1645be)+0x0,_0xed493;});if(_0x40cb61[0x0]['language']==_0x3fd90d(0x15d)){var _0x181f36=users[_0x3fd90d(0x165)];console['log'](_0x181f36);}else{if(_0x40cb61[0x0]['language']==_0x3fd90d(0x151))var _0x181f36=users[_0x3fd90d(0x151)];else{if(_0x40cb61[0x0]['language']=='German')var _0x181f36=users['German'];else{if(_0x40cb61[0x0]['language']==_0x3fd90d(0x111))var _0x181f36=users[_0x3fd90d(0x111)];else{if(_0x40cb61[0x0][_0x3fd90d(0x108)]==_0x3fd90d(0x10e))var _0x181f36=users[_0x3fd90d(0x10e)];else{if(_0x40cb61[0x0][_0x3fd90d(0x108)]=='Portuguese\x20(BR)')var _0x181f36=users['Portuguese'];else{if(_0x40cb61[0x0]['language']==_0x3fd90d(0x104))var _0x181f36=users[_0x3fd90d(0x104)];else{if(_0x40cb61[0x0]['language']==_0x3fd90d(0x160))var _0x181f36=users[_0x3fd90d(0x15b)];}}}}}}}_0x149321[_0x3fd90d(0x147)](_0x3fd90d(0x12d),{'success':_0x13decb[_0x3fd90d(0x11d)]('success'),'errors':_0x13decb['flash'](_0x3fd90d(0x113)),'user':_0x152bd2,'role':_0x3e7358,'profile':_0x5aab8a,'master_shop':_0x40cb61,'language':_0x181f36,'agent_id':_0x4b661a[_0x3fd90d(0x10b)],'payment':_0x3dc038,'staff_arr':_0x4b661a});}catch(_0x3d6349){console[_0x3fd90d(0x153)](_0x3d6349);}}),router[a0_0x24b08f(0x170)]('/view',auth,async(_0x5cc624,_0x47f572)=>{const _0x117a38=a0_0x24b08f;try{const {name:_0x27a51b,address:_0x36bb2d,mobile:_0xd1d2fb,email:_0x1b33f7,receivable:_0x58eb18,payable:_0x310fd6,contactperson:_0x122c8c,landline:_0x461853,agent_id:_0x33ba61,less_percent:_0x45908c,type_org:_0x4c1770,res_address:_0x577e76,business_start_year:_0x2c8163,credit_limit:_0x46bb13,term_pay:_0x379a5f}=_0x5cc624[_0x117a38(0x109)];if(typeof _0x45908c==_0x117a38(0x121))var _0x53cea8=[_0x5cc624['body'][_0x117a38(0x106)]];else var _0x53cea8=[..._0x5cc624[_0x117a38(0x109)]['less_percent']];const _0x43b94a=_0x53cea8[_0x117a38(0x128)](_0x5da2dc=>{return _0x5da2dc={'less':_0x5da2dc};}),_0x52478f=new customer({'name':_0x27a51b,'address':_0x36bb2d,'mobile':_0xd1d2fb,'email':_0x1b33f7,'receivable':_0x58eb18,'payable':_0x310fd6,'customer_discount':_0x43b94a,'contactperson':_0x122c8c,'landline':_0x461853,'agent_id':_0x33ba61,'res_address':_0x577e76,'type_organization':_0x4c1770,'business_start_year':_0x2c8163,'credit_limit':_0x46bb13,'terms_of_payments':_0x379a5f}),_0x5038f4=await _0x52478f[_0x117a38(0x16b)]();_0x5cc624[_0x117a38(0x11d)](_0x117a38(0x118),'customer\x20add\x20successfully'),_0x47f572[_0x117a38(0x167)](_0x117a38(0x12b));}catch(_0x4a1bd7){console[_0x117a38(0x153)](_0x4a1bd7);}}),router[a0_0x24b08f(0x126)](a0_0x24b08f(0x16c),auth,async(_0x6a7534,_0x30877e)=>{const _0x48a1b1=a0_0x24b08f;try{const {username:_0x114c90,email:_0x282001,role:_0x3c5d29}=_0x6a7534[_0x48a1b1(0x105)],_0xe93a63=_0x6a7534[_0x48a1b1(0x105)],_0x591aa4=await profile[_0x48a1b1(0x11a)]({'email':_0xe93a63[_0x48a1b1(0x133)]}),_0x487a9d=await master_shop[_0x48a1b1(0x12c)]();console[_0x48a1b1(0x153)](_0x48a1b1(0x152),_0x487a9d);const _0x533102=_0x6a7534['params']['id'],_0xd06f37=await customer['findById'](_0x533102);console[_0x48a1b1(0x153)](_0xd06f37);if(_0x487a9d[0x0][_0x48a1b1(0x108)]==_0x48a1b1(0x15d)){var _0x3186d5=users[_0x48a1b1(0x165)];console[_0x48a1b1(0x153)](_0x3186d5);}else{if(_0x487a9d[0x0]['language']==_0x48a1b1(0x151))var _0x3186d5=users[_0x48a1b1(0x151)];else{if(_0x487a9d[0x0][_0x48a1b1(0x108)]==_0x48a1b1(0x154))var _0x3186d5=users[_0x48a1b1(0x154)];else{if(_0x487a9d[0x0]['language']==_0x48a1b1(0x111))var _0x3186d5=users['Spanish'];else{if(_0x487a9d[0x0]['language']==_0x48a1b1(0x10e))var _0x3186d5=users[_0x48a1b1(0x10e)];else{if(_0x487a9d[0x0][_0x48a1b1(0x108)]=='Portuguese\x20(BR)')var _0x3186d5=users['Portuguese'];else{if(_0x487a9d[0x0][_0x48a1b1(0x108)]=='Chinese')var _0x3186d5=users[_0x48a1b1(0x104)];else{if(_0x487a9d[0x0]['language']==_0x48a1b1(0x160))var _0x3186d5=users[_0x48a1b1(0x15b)];}}}}}}}_0x30877e[_0x48a1b1(0x147)](_0x48a1b1(0x12d),{'success':_0x6a7534[_0x48a1b1(0x11d)](_0x48a1b1(0x118)),'errors':_0x6a7534[_0x48a1b1(0x11d)](_0x48a1b1(0x113)),'role':_0xe93a63,'profile':_0x591aa4,'user':_0xd06f37,'master_shop':_0x487a9d,'language':_0x3186d5});}catch(_0x418636){console[_0x48a1b1(0x153)](_0x418636);}}),router['post'](a0_0x24b08f(0x16c),auth,async(_0x48ecda,_0x197674)=>{const _0x12ce65=a0_0x24b08f;try{const _0x82d7c3=_0x48ecda[_0x12ce65(0x140)]['id'],_0x581abb=await customer['findById'](_0x82d7c3),{name:_0x50a238,address:_0x5cecf8,mobile:_0x1809ca,email:_0xa6cb78,receivable:_0x4c9722,payable:_0x1d1c17,contactperson:_0x35c9eb,landline:_0x55d0e3,less_percent_edit:_0x5dc8fa,edit_type_org:_0x3bfe54,edit_res_address:_0x648908,edit_business_start_year:_0x4ea4be,edit_credit_limit:_0x14d1f5,edit_term_pay:_0x3fd003}=_0x48ecda[_0x12ce65(0x109)];if(typeof _0x5dc8fa=='string')var _0x36d844=[_0x48ecda[_0x12ce65(0x109)]['less_percent_edit']];else var _0x36d844=[..._0x48ecda[_0x12ce65(0x109)][_0x12ce65(0x157)]];const _0x498b6e=_0x36d844['map'](_0x5a8d6e=>{return _0x5a8d6e={'less':_0x5a8d6e};});_0x581abb['name']=_0x50a238,_0x581abb['address']=_0x5cecf8,_0x581abb[_0x12ce65(0x114)]=_0x1809ca,_0x581abb[_0x12ce65(0x133)]=_0xa6cb78,_0x581abb[_0x12ce65(0x169)]=_0x4c9722,_0x581abb[_0x12ce65(0x11b)]=_0x1d1c17,_0x581abb[_0x12ce65(0x117)]=_0x35c9eb,_0x581abb[_0x12ce65(0x145)]=_0x55d0e3,_0x581abb[_0x12ce65(0x150)]=_0x498b6e,_0x581abb[_0x12ce65(0x13f)]=_0x3bfe54,_0x581abb[_0x12ce65(0x129)]=_0x4ea4be,_0x581abb[_0x12ce65(0x13e)]=_0x14d1f5,_0x581abb[_0x12ce65(0x132)]=_0x3fd003,_0x581abb[_0x12ce65(0x144)]=_0x648908;const _0x455054=await _0x581abb[_0x12ce65(0x16b)]();_0x48ecda[_0x12ce65(0x11d)]('success',_0x12ce65(0x116)),_0x197674[_0x12ce65(0x167)](_0x12ce65(0x12b));}catch(_0x3ee10e){console[_0x12ce65(0x153)](_0x3ee10e);}}),router[a0_0x24b08f(0x126)](a0_0x24b08f(0x13a),auth,async(_0x133c85,_0x210c47)=>{const _0x3dfd30=a0_0x24b08f;try{const {username:_0x4c95a7,email:_0x1514ee,role:_0x94bbe3}=_0x133c85[_0x3dfd30(0x105)],_0x25d91d=_0x133c85['user'],_0xd474ba=await profile[_0x3dfd30(0x11a)]({'email':_0x25d91d['email']}),_0x3ac6bd=await master_shop[_0x3dfd30(0x12c)]();console[_0x3dfd30(0x153)](_0x3dfd30(0x152),_0x3ac6bd),console[_0x3dfd30(0x153)](_0x133c85['params']['id']);const _0x2782b9=await customer[_0x3dfd30(0x11a)]({'_id':_0x133c85['params']['id']});console[_0x3dfd30(0x153)]('customer_data',_0x2782b9);const _0x409e5e=await c_payment_data[_0x3dfd30(0x12c)]({'customer':_0x2782b9[_0x3dfd30(0x13c)]});console[_0x3dfd30(0x153)](_0x409e5e);const _0x413711=await c_payment_data[_0x3dfd30(0x125)]([{'$match':{'customer':_0x2782b9[_0x3dfd30(0x13c)]}},{'$match':{'reason':_0x3dfd30(0x148)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x3dfd30(0x161)}}}]);console[_0x3dfd30(0x153)](_0x3dfd30(0x12f),_0x413711);const _0x2d65f9=await c_payment_data['aggregate']([{'$match':{'customer':_0x2782b9[_0x3dfd30(0x13c)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x3dfd30(0x14a),'sum':{'$sum':_0x3dfd30(0x161)}}}]);console[_0x3dfd30(0x153)](_0x3dfd30(0x172),_0x2d65f9);if(_0x3ac6bd[0x0]['language']==_0x3dfd30(0x15d)){var _0x59d8c2=users['English'];console['log'](_0x59d8c2);}else{if(_0x3ac6bd[0x0][_0x3dfd30(0x108)]==_0x3dfd30(0x151))var _0x59d8c2=users[_0x3dfd30(0x151)];else{if(_0x3ac6bd[0x0][_0x3dfd30(0x108)]==_0x3dfd30(0x154))var _0x59d8c2=users[_0x3dfd30(0x154)];else{if(_0x3ac6bd[0x0][_0x3dfd30(0x108)]==_0x3dfd30(0x111))var _0x59d8c2=users[_0x3dfd30(0x111)];else{if(_0x3ac6bd[0x0][_0x3dfd30(0x108)]==_0x3dfd30(0x10e))var _0x59d8c2=users[_0x3dfd30(0x10e)];else{if(_0x3ac6bd[0x0][_0x3dfd30(0x108)]==_0x3dfd30(0x10a))var _0x59d8c2=users[_0x3dfd30(0x16a)];else{if(_0x3ac6bd[0x0]['language']==_0x3dfd30(0x104))var _0x59d8c2=users['Chinese'];else{if(_0x3ac6bd[0x0]['language']==_0x3dfd30(0x160))var _0x59d8c2=users['Arabic'];}}}}}}}_0x210c47[_0x3dfd30(0x147)]('customer_payment',{'success':_0x133c85[_0x3dfd30(0x11d)](_0x3dfd30(0x118)),'errors':_0x133c85[_0x3dfd30(0x11d)](_0x3dfd30(0x113)),'role':_0x25d91d,'profile':_0xd474ba,'payment':_0x409e5e,'payable':_0x413711,'receivable':_0x2d65f9,'master_shop':_0x3ac6bd,'language':_0x59d8c2});}catch(_0x393001){console['log'](_0x393001);}}),router[a0_0x24b08f(0x126)](a0_0x24b08f(0x134),auth,async(_0x3ef1b6,_0x999992)=>{const _0x5e1498=a0_0x24b08f;try{const _0x230630=new excelJS['Workbook'](),_0x3faf8e=_0x230630[_0x5e1498(0x11e)]('Customers');return _0x3faf8e['columns']=[{'header':'ID','key':_0x5e1498(0x168),'width':0xa},{'header':_0x5e1498(0x10f),'key':'PBrands','width':0xa},{'header':_0x5e1498(0x15f),'key':_0x5e1498(0x139),'width':0xa},{'header':_0x5e1498(0x143),'key':_0x5e1498(0x143),'width':0xa},{'header':_0x5e1498(0x15a),'key':_0x5e1498(0x15a),'width':0xa},{'header':_0x5e1498(0x114),'key':_0x5e1498(0x114),'width':0xa},{'header':_0x5e1498(0x133),'key':'email','width':0xa}],_0x999992['setHeader'](_0x5e1498(0x14d),_0x5e1498(0x14f)),_0x999992['setHeader'](_0x5e1498(0x127),_0x5e1498(0x10c)),_0x230630[_0x5e1498(0x141)][_0x5e1498(0x12e)](_0x999992)[_0x5e1498(0x173)](()=>{const _0x310375=_0x5e1498;_0x999992[_0x310375(0x15c)](0xc8);});}catch(_0x392fb7){_0x999992['status'](0x190)[_0x5e1498(0x14b)]({'errors':_0x392fb7['message']});}});const storage1=multer[a0_0x24b08f(0x137)]({'destination':(_0x3400d0,_0x30e092,_0x130e41)=>{const _0x547fc2=a0_0x24b08f;_0x130e41(null,_0x547fc2(0x11c));},'filename':(_0x17cafc,_0x3d8b25,_0x3a1860)=>{const _0xca84cb=a0_0x24b08f;_0x3a1860(null,Date[_0xca84cb(0x162)]()+_0x3d8b25[_0xca84cb(0x138)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x24b08f(0x170)](a0_0x24b08f(0x130),auth,uploadMigrate['single'](a0_0x24b08f(0x110)),async(_0x396e80,_0x2fe3f6)=>{const _0x4c2b34=a0_0x24b08f,_0x209b3b=_0x396e80[_0x4c2b34(0x120)]['filename'],_0x338da1=await xlsx['readFile']('public/Migration/'+_0x209b3b);let _0x10c819=_0x338da1['SheetNames'],_0xe176b4=xlsx['utils'][_0x4c2b34(0x112)](_0x338da1[_0x4c2b34(0x123)][_0x10c819[0x0]]);for(const _0x6a5e4f of _0xe176b4){const _0x59d0ce=_0x6a5e4f['ID'],_0x4fea7b=_0x6a5e4f['Name'],_0x3737f4=_0x6a5e4f[_0x4c2b34(0x15f)],_0x27ba11=_0x6a5e4f[_0x4c2b34(0x143)],_0x88d70e=_0x6a5e4f[_0x4c2b34(0x15a)],_0x4f645a=_0x6a5e4f[_0x4c2b34(0x114)],_0x308c73=_0x6a5e4f['email'];try{let _0x59f50c=await customer[_0x4c2b34(0x11a)]({'name':_0x4fea7b});if(!_0x59f50c){const _0x23c718=new customer({'name':_0x4fea7b,'ID':_0x59d0ce,'SalesmanCode':_0x3737f4,'SalesmanName':_0x27ba11,'address':_0x88d70e,'mobile':_0x4f645a,'email':_0x308c73});_0x59f50c=await _0x23c718[_0x4c2b34(0x16b)](),_0x396e80[_0x4c2b34(0x11d)](_0x4c2b34(0x118),_0x4fea7b+_0x4c2b34(0x13d));}else _0x396e80['flash'](_0x4c2b34(0x136),_0x4fea7b+_0x4c2b34(0x146));}catch(_0x475567){_0x2fe3f6[_0x4c2b34(0x15c)](0x1f4)[_0x4c2b34(0x16d)]({'proderror':_0x475567['message'],'aproduct':ProductName});}}_0x2fe3f6[_0x4c2b34(0x167)](_0x4c2b34(0x12b));}),module[a0_0x24b08f(0x16e)]=router;function a0_0x1bb2(){const _0x1f08c2=['456371zhMEBR','findOne','payable','public/Migration','flash','addWorksheet','multer','file','string','1116609peXTBb','Sheets','30737ESzHac','aggregate','get','Content-Disposition','map','business_start_year','sale','/customer_sa/view','find','customer_sa','write','payable_sum','/customer_import_migrate_file','data','terms_of_payments','email','/products_export_migrate_file','reason','error','diskStorage','originalname','PUnits','/view/payment/:id','Router','name','\x20added\x20successfully','credit_limit','type_organization','params','xlsx','valueOf','SalesmanName','res_address','landline','\x20Failed','render','Sale','15346089dHnHZo','$reason','send','customer_docs','Content-Type','2eZBoeE','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','customer_discount','Hindi','master','log','German','express','element','less_percent_edit','../middleware/auth','customer','address','Arabic','status','English\x20(US)','amount','SalesmanCode','Arabic\x20(ae)','$amount','now','forEach','1638420OYUWRG','English','exceljs','redirect','PName','receivable','Portuguese','save','/view/:id','json','exports','2536FRoKfp','post','sale_return','receivable_sum','then','c_payments','Chinese','user','less_percent','6buoWzQ','language','body','Portuguese\x20(BR)','_id','attachment;\x20filename=customer_Migration_File.xlsx','4050276yODiVN','French','Name','customer_product_fule','Spanish','sheet_to_json','errors','mobile','20458610pXupiS','customer\x20update\x20successfully','contactperson','success'];a0_0x1bb2=function(){return _0x1f08c2;};return a0_0x1bb2();}