const a0_0x134850=a0_0x5d24;(function(_0x15bcaa,_0x249297){const _0x3839e7=a0_0x5d24,_0x37cca1=_0x15bcaa();while(!![]){try{const _0x1000cb=-parseInt(_0x3839e7(0xb6))/0x1*(-parseInt(_0x3839e7(0xe2))/0x2)+-parseInt(_0x3839e7(0xcc))/0x3+parseInt(_0x3839e7(0xa2))/0x4+parseInt(_0x3839e7(0xba))/0x5+-parseInt(_0x3839e7(0xa8))/0x6*(-parseInt(_0x3839e7(0xc3))/0x7)+parseInt(_0x3839e7(0xac))/0x8*(parseInt(_0x3839e7(0xf7))/0x9)+-parseInt(_0x3839e7(0xd6))/0xa;if(_0x1000cb===_0x249297)break;else _0x37cca1['push'](_0x37cca1['shift']());}catch(_0x3fb983){_0x37cca1['push'](_0x37cca1['shift']());}}}(a0_0x162d,0xe059c));const express=require(a0_0x134850(0xb8)),app=express(),router=express[a0_0x134850(0xea)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0x134850(0xc7)),excelJS=require(a0_0x134850(0xed)),xlsx=require(a0_0x134850(0xaa)),multer=require(a0_0x134850(0xee));router[a0_0x134850(0xec)](a0_0x134850(0xe4),auth,async(_0x564954,_0x4327a4)=>{const _0x40fe51=a0_0x134850;try{const {username:_0x2f3132,email:_0x37a348,role:_0x56c406}=_0x564954[_0x40fe51(0xad)],_0x372b0d=_0x564954['user'],_0x1effdf=await profile[_0x40fe51(0x102)]({'email':_0x372b0d[_0x40fe51(0xfa)]}),_0x65c176=await master_shop[_0x40fe51(0xf2)](),_0x1a6a5c=await staff[_0x40fe51(0x102)]({'email':_0x372b0d[_0x40fe51(0xfa)]}),_0x3ec7ad=await customer['find']({'agent_id':_0x1a6a5c[_0x40fe51(0xff)]}),_0x180241=await customer[_0x40fe51(0xe6)]([{'$match':{'agent_id':_0x1a6a5c[_0x40fe51(0xff)][_0x40fe51(0xca)]()}},{'$lookup':{'from':'c_payments','localField':_0x40fe51(0xaf),'foreignField':_0x40fe51(0xfd),'as':_0x40fe51(0xa9)}}]),_0x22e703=_0x180241[_0x40fe51(0x101)](_0x30aa34=>{const _0x16f685=_0x40fe51;console[_0x16f685(0xc2)](_0x16f685(0x10b),_0x30aa34);var _0x2fc039=0x0,_0x57d3ec=0x0;return _0x30aa34[_0x16f685(0xa9)][_0x16f685(0x109)](_0x53c977=>{const _0x4c9d9=_0x16f685;console[_0x4c9d9(0xc2)](_0x4c9d9(0xe1),_0x53c977),_0x53c977[_0x4c9d9(0xf8)]==_0x4c9d9(0xb9)?_0x2fc039+=_0x53c977[_0x4c9d9(0x9c)]:_0x57d3ec+=_0x53c977['amount'];}),_0x30aa34[_0x16f685(0xcb)]=parseFloat(_0x2fc039)+0x0,_0x30aa34[_0x16f685(0x105)]=parseFloat(_0x57d3ec)+0x0,_0x30aa34;});if(_0x65c176[0x0][_0x40fe51(0xb0)]==_0x40fe51(0xe0)){var _0x460cc3=users[_0x40fe51(0xd5)];console['log'](_0x460cc3);}else{if(_0x65c176[0x0]['language']==_0x40fe51(0xcd))var _0x460cc3=users[_0x40fe51(0xcd)];else{if(_0x65c176[0x0][_0x40fe51(0xb0)]==_0x40fe51(0x10a))var _0x460cc3=users[_0x40fe51(0x10a)];else{if(_0x65c176[0x0][_0x40fe51(0xb0)]==_0x40fe51(0xbe))var _0x460cc3=users['Spanish'];else{if(_0x65c176[0x0][_0x40fe51(0xb0)]=='French')var _0x460cc3=users['French'];else{if(_0x65c176[0x0][_0x40fe51(0xb0)]==_0x40fe51(0xe5))var _0x460cc3=users[_0x40fe51(0x9b)];else{if(_0x65c176[0x0][_0x40fe51(0xb0)]==_0x40fe51(0xc0))var _0x460cc3=users['Chinese'];else{if(_0x65c176[0x0][_0x40fe51(0xb0)]==_0x40fe51(0xdc))var _0x460cc3=users[_0x40fe51(0xdd)];}}}}}}}_0x4327a4[_0x40fe51(0xd3)]('customer_sa',{'success':_0x564954['flash'](_0x40fe51(0xf5)),'errors':_0x564954[_0x40fe51(0xfe)](_0x40fe51(0x108)),'user':_0x3ec7ad,'role':_0x372b0d,'profile':_0x1effdf,'master_shop':_0x65c176,'language':_0x460cc3,'agent_id':_0x1a6a5c[_0x40fe51(0xff)],'payment':_0x22e703,'staff_arr':_0x1a6a5c});}catch(_0x16d924){console[_0x40fe51(0xc2)](_0x16d924);}}),router[a0_0x134850(0xc6)](a0_0x134850(0xe4),auth,async(_0x4990c7,_0x3b9569)=>{const _0x203719=a0_0x134850;try{const {name:_0x759f19,address:_0x5b03eb,mobile:_0x4b7c98,email:_0x29c702,receivable:_0x48eaa4,payable:_0x22758f,contactperson:_0x2ed3f0,landline:_0x4a37ba,agent_id:_0x35b16e,less_percent:_0x487e86,type_org:_0x10f4b1,res_address:_0x16ea9e,business_start_year:_0x38dc94,credit_limit:_0x2bda07,term_pay:_0x16d669}=_0x4990c7[_0x203719(0xc5)];if(typeof _0x487e86=='string')var _0x23ad9e=[_0x4990c7[_0x203719(0xc5)][_0x203719(0xb7)]];else var _0x23ad9e=[..._0x4990c7['body']['less_percent']];const _0x27b547=_0x23ad9e[_0x203719(0x101)](_0x556c32=>{return _0x556c32={'less':_0x556c32};}),_0x528eb9=new customer({'name':_0x759f19,'address':_0x5b03eb,'mobile':_0x4b7c98,'email':_0x29c702,'receivable':_0x48eaa4,'payable':_0x22758f,'customer_discount':_0x27b547,'contactperson':_0x2ed3f0,'landline':_0x4a37ba,'agent_id':_0x35b16e,'res_address':_0x16ea9e,'type_organization':_0x10f4b1,'business_start_year':_0x38dc94,'credit_limit':_0x2bda07,'terms_of_payments':_0x16d669}),_0x3fa53d=await _0x528eb9['save']();_0x4990c7[_0x203719(0xfe)](_0x203719(0xf5),_0x203719(0xe7)),_0x3b9569[_0x203719(0x10d)](_0x203719(0x9d));}catch(_0x4b4fe7){console['log'](_0x4b4fe7);}}),router[a0_0x134850(0xec)]('/view/:id',auth,async(_0x2522a,_0x133441)=>{const _0x257b94=a0_0x134850;try{const {username:_0x23d854,email:_0x333be8,role:_0xcbf150}=_0x2522a[_0x257b94(0xad)],_0x31ea98=_0x2522a[_0x257b94(0xad)],_0x3912e9=await profile[_0x257b94(0x102)]({'email':_0x31ea98[_0x257b94(0xfa)]}),_0x4e12f1=await master_shop[_0x257b94(0xf2)]();console[_0x257b94(0xc2)](_0x257b94(0xa0),_0x4e12f1);const _0x3ac1e7=_0x2522a[_0x257b94(0xb5)]['id'],_0x5cdf14=await customer[_0x257b94(0xd7)](_0x3ac1e7);console[_0x257b94(0xc2)](_0x5cdf14);if(_0x4e12f1[0x0][_0x257b94(0xb0)]==_0x257b94(0xe0)){var _0x279b13=users[_0x257b94(0xd5)];console['log'](_0x279b13);}else{if(_0x4e12f1[0x0]['language']==_0x257b94(0xcd))var _0x279b13=users[_0x257b94(0xcd)];else{if(_0x4e12f1[0x0][_0x257b94(0xb0)]==_0x257b94(0x10a))var _0x279b13=users[_0x257b94(0x10a)];else{if(_0x4e12f1[0x0][_0x257b94(0xb0)]==_0x257b94(0xbe))var _0x279b13=users[_0x257b94(0xbe)];else{if(_0x4e12f1[0x0]['language']=='French')var _0x279b13=users[_0x257b94(0xbc)];else{if(_0x4e12f1[0x0]['language']==_0x257b94(0xe5))var _0x279b13=users['Portuguese'];else{if(_0x4e12f1[0x0]['language']==_0x257b94(0xc0))var _0x279b13=users[_0x257b94(0xc0)];else{if(_0x4e12f1[0x0]['language']==_0x257b94(0xdc))var _0x279b13=users[_0x257b94(0xdd)];}}}}}}}_0x133441[_0x257b94(0xd3)]('customer_sa',{'success':_0x2522a[_0x257b94(0xfe)]('success'),'errors':_0x2522a[_0x257b94(0xfe)](_0x257b94(0x108)),'role':_0x31ea98,'profile':_0x3912e9,'user':_0x5cdf14,'master_shop':_0x4e12f1,'language':_0x279b13});}catch(_0x1be021){console[_0x257b94(0xc2)](_0x1be021);}}),router[a0_0x134850(0xc6)](a0_0x134850(0xfb),auth,async(_0x571ad5,_0x44ae86)=>{const _0x123fa8=a0_0x134850;try{const _0x5bb21d=_0x571ad5[_0x123fa8(0xb5)]['id'],_0x214f37=await customer['findById'](_0x5bb21d),{name:_0x5b84c3,address:_0x25456b,mobile:_0xdc5cb9,email:_0x1b7374,receivable:_0xc0bb46,payable:_0x2e01ce,contactperson:_0x2148af,landline:_0xbbcb68,less_percent_edit:_0x50bf19,edit_type_org:_0x504146,edit_res_address:_0x4c880d,edit_business_start_year:_0x18fa70,edit_credit_limit:_0x131e36,edit_term_pay:_0x4c783e}=_0x571ad5[_0x123fa8(0xc5)];if(typeof _0x50bf19=='string')var _0x2d15c9=[_0x571ad5[_0x123fa8(0xc5)]['less_percent_edit']];else var _0x2d15c9=[..._0x571ad5[_0x123fa8(0xc5)][_0x123fa8(0xbf)]];const _0x4204f3=_0x2d15c9[_0x123fa8(0x101)](_0x1dbd4b=>{return _0x1dbd4b={'less':_0x1dbd4b};});_0x214f37[_0x123fa8(0xaf)]=_0x5b84c3,_0x214f37['address']=_0x25456b,_0x214f37[_0x123fa8(0xd1)]=_0xdc5cb9,_0x214f37['email']=_0x1b7374,_0x214f37[_0x123fa8(0xf3)]=_0xc0bb46,_0x214f37['payable']=_0x2e01ce,_0x214f37[_0x123fa8(0x107)]=_0x2148af,_0x214f37['landline']=_0xbbcb68,_0x214f37[_0x123fa8(0x100)]=_0x4204f3,_0x214f37[_0x123fa8(0xd2)]=_0x504146,_0x214f37[_0x123fa8(0xc9)]=_0x18fa70,_0x214f37['credit_limit']=_0x131e36,_0x214f37[_0x123fa8(0xc8)]=_0x4c783e,_0x214f37[_0x123fa8(0xf9)]=_0x4c880d;const _0x208b52=await _0x214f37[_0x123fa8(0xf4)]();_0x571ad5[_0x123fa8(0xfe)](_0x123fa8(0xf5),'customer\x20update\x20successfully'),_0x44ae86[_0x123fa8(0x10d)](_0x123fa8(0x9d));}catch(_0x1c0584){console[_0x123fa8(0xc2)](_0x1c0584);}}),router[a0_0x134850(0xec)](a0_0x134850(0xd0),auth,async(_0x55d744,_0x2b5c2c)=>{const _0x44d81a=a0_0x134850;try{const {username:_0x4c6009,email:_0x192433,role:_0xf17396}=_0x55d744[_0x44d81a(0xad)],_0x359b0b=_0x55d744[_0x44d81a(0xad)],_0x5393ae=await profile['findOne']({'email':_0x359b0b[_0x44d81a(0xfa)]}),_0x550a0b=await master_shop[_0x44d81a(0xf2)]();console['log'](_0x44d81a(0xa0),_0x550a0b),console[_0x44d81a(0xc2)](_0x55d744[_0x44d81a(0xb5)]['id']);const _0xe6eeb2=await customer[_0x44d81a(0x102)]({'_id':_0x55d744[_0x44d81a(0xb5)]['id']});console[_0x44d81a(0xc2)](_0x44d81a(0xf6),_0xe6eeb2);const _0x2c3cc2=await c_payment_data[_0x44d81a(0xf2)]({'customer':_0xe6eeb2[_0x44d81a(0xaf)]});console[_0x44d81a(0xc2)](_0x2c3cc2);const _0x314d8b=await c_payment_data[_0x44d81a(0xe6)]([{'$match':{'customer':_0xe6eeb2[_0x44d81a(0xaf)]}},{'$match':{'reason':_0x44d81a(0xb9)}},{'$group':{'_id':_0x44d81a(0xe8),'sum':{'$sum':_0x44d81a(0xa6)}}}]);console[_0x44d81a(0xc2)]('payable_sum',_0x314d8b);const _0x145742=await c_payment_data[_0x44d81a(0xe6)]([{'$match':{'customer':_0xe6eeb2[_0x44d81a(0xaf)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x44d81a(0xe8),'sum':{'$sum':_0x44d81a(0xa6)}}}]);console['log'](_0x44d81a(0xf1),_0x145742);if(_0x550a0b[0x0][_0x44d81a(0xb0)]==_0x44d81a(0xe0)){var _0x1bf279=users[_0x44d81a(0xd5)];console['log'](_0x1bf279);}else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]==_0x44d81a(0xcd))var _0x1bf279=users[_0x44d81a(0xcd)];else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]==_0x44d81a(0x10a))var _0x1bf279=users[_0x44d81a(0x10a)];else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]=='Spanish')var _0x1bf279=users['Spanish'];else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]=='French')var _0x1bf279=users[_0x44d81a(0xbc)];else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]==_0x44d81a(0xe5))var _0x1bf279=users[_0x44d81a(0x9b)];else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]=='Chinese')var _0x1bf279=users[_0x44d81a(0xc0)];else{if(_0x550a0b[0x0][_0x44d81a(0xb0)]=='Arabic\x20(ae)')var _0x1bf279=users['Arabic'];}}}}}}}_0x2b5c2c[_0x44d81a(0xd3)]('customer_payment',{'success':_0x55d744['flash'](_0x44d81a(0xf5)),'errors':_0x55d744['flash']('errors'),'role':_0x359b0b,'profile':_0x5393ae,'payment':_0x2c3cc2,'payable':_0x314d8b,'receivable':_0x145742,'master_shop':_0x550a0b,'language':_0x1bf279});}catch(_0xb770f3){console[_0x44d81a(0xc2)](_0xb770f3);}}),router[a0_0x134850(0xec)](a0_0x134850(0xb4),auth,async(_0x3dc327,_0x397e34)=>{const _0x4dcb22=a0_0x134850;try{const _0x8ccfc8=new excelJS[(_0x4dcb22(0xdb))](),_0xf5f20d=_0x8ccfc8[_0x4dcb22(0xa5)]('Customers');return _0xf5f20d[_0x4dcb22(0xc4)]=[{'header':'ID','key':_0x4dcb22(0xb1),'width':0xa},{'header':_0x4dcb22(0x10c),'key':_0x4dcb22(0x9f),'width':0xa},{'header':_0x4dcb22(0xdf),'key':_0x4dcb22(0xce),'width':0xa},{'header':_0x4dcb22(0xae),'key':'SalesmanName','width':0xa},{'header':_0x4dcb22(0xf0),'key':_0x4dcb22(0xf0),'width':0xa},{'header':_0x4dcb22(0xd1),'key':_0x4dcb22(0xd1),'width':0xa},{'header':_0x4dcb22(0xfa),'key':_0x4dcb22(0xfa),'width':0xa}],_0x397e34[_0x4dcb22(0x106)](_0x4dcb22(0xe3),_0x4dcb22(0x9e)),_0x397e34[_0x4dcb22(0x106)](_0x4dcb22(0xbd),_0x4dcb22(0x103)),_0x8ccfc8[_0x4dcb22(0xaa)][_0x4dcb22(0x104)](_0x397e34)[_0x4dcb22(0xde)](()=>{const _0x254177=_0x4dcb22;_0x397e34[_0x254177(0xd9)](0xc8);});}catch(_0x11c5b4){_0x397e34['status'](0x190)['send']({'errors':_0x11c5b4['message']});}});const storage1=multer[a0_0x134850(0xc1)]({'destination':(_0x4b4767,_0x1bd440,_0x3475d2)=>{const _0xbfc3f4=a0_0x134850;_0x3475d2(null,_0xbfc3f4(0xa1));},'filename':(_0x279e23,_0x20fb79,_0x185b46)=>{const _0x429df8=a0_0x134850;_0x185b46(null,Date[_0x429df8(0xfc)]()+_0x20fb79[_0x429df8(0xd8)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x5d24(_0x994620,_0x558c91){const _0x162d30=a0_0x162d();return a0_0x5d24=function(_0x5d2457,_0x593382){_0x5d2457=_0x5d2457-0x9a;let _0x3e7dcc=_0x162d30[_0x5d2457];return _0x3e7dcc;},a0_0x5d24(_0x994620,_0x558c91);}function a0_0x162d(){const _0x63c24c=['Router','exports','get','exceljs','multer','file','address','receivable_sum','find','receivable','save','success','customer_data','1224BVpHDP','reason','res_address','email','/view/:id','now','customer','flash','_id','customer_discount','map','findOne','attachment;\x20filename=customer_Migration_File.xlsx','write','sale_return','setHeader','contactperson','errors','forEach','German','data','Name','redirect','SheetNames','Portuguese','amount','/customer_sa/view','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','PBrands','master','public/Migration','3706016RvaBMT','sheet_to_json','message','addWorksheet','$amount','single','6xsTAZN','customer_docs','xlsx','readFile','27168tzlZbb','user','SalesmanName','name','language','PName','Sheets','json','/products_export_migrate_file','params','1788533tJSOAd','less_percent','express','Sale','6761060dqeRvN','\x20added\x20successfully','French','Content-Disposition','Spanish','less_percent_edit','Chinese','diskStorage','log','4958338EnNXod','columns','body','post','../public/language/languages.json','terms_of_payments','business_start_year','valueOf','sale','4878180ijcLUm','Hindi','PUnits','customer_product_fule','/view/payment/:id','mobile','type_organization','render','\x20Failed','English','26924390pjlmmh','findById','originalname','status','utils','Workbook','Arabic\x20(ae)','Arabic','then','SalesmanCode','English\x20(US)','element','2kWYeId','Content-Type','/view','Portuguese\x20(BR)','aggregate','customer\x20add\x20successfully','$reason','public/Migration/'];a0_0x162d=function(){return _0x63c24c;};return a0_0x162d();}router[a0_0x134850(0xc6)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x134850(0xa7)](a0_0x134850(0xcf)),async(_0x21b710,_0x5fa9ff)=>{const _0x1bdf6c=a0_0x134850,_0x5edc27=_0x21b710[_0x1bdf6c(0xef)]['filename'],_0xfd88b=await xlsx[_0x1bdf6c(0xab)](_0x1bdf6c(0xe9)+_0x5edc27);let _0x1fd409=_0xfd88b[_0x1bdf6c(0x9a)],_0x291a3e=xlsx[_0x1bdf6c(0xda)][_0x1bdf6c(0xa3)](_0xfd88b[_0x1bdf6c(0xb2)][_0x1fd409[0x0]]);for(const _0x309a7c of _0x291a3e){const _0x5cc427=_0x309a7c['ID'],_0x3ea666=_0x309a7c[_0x1bdf6c(0x10c)],_0x37f0ff=_0x309a7c[_0x1bdf6c(0xdf)],_0xb5a206=_0x309a7c[_0x1bdf6c(0xae)],_0x5014a8=_0x309a7c[_0x1bdf6c(0xf0)],_0x253858=_0x309a7c[_0x1bdf6c(0xd1)],_0x4cb1fe=_0x309a7c[_0x1bdf6c(0xfa)];try{let _0x2de789=await customer[_0x1bdf6c(0x102)]({'name':_0x3ea666});if(!_0x2de789){const _0x55bc05=new customer({'name':_0x3ea666,'ID':_0x5cc427,'SalesmanCode':_0x37f0ff,'SalesmanName':_0xb5a206,'address':_0x5014a8,'mobile':_0x253858,'email':_0x4cb1fe});_0x2de789=await _0x55bc05[_0x1bdf6c(0xf4)](),_0x21b710[_0x1bdf6c(0xfe)]('success',_0x3ea666+_0x1bdf6c(0xbb));}else _0x21b710['flash']('error',_0x3ea666+_0x1bdf6c(0xd4));}catch(_0x3b6a57){_0x5fa9ff[_0x1bdf6c(0xd9)](0x1f4)[_0x1bdf6c(0xb3)]({'proderror':_0x3b6a57[_0x1bdf6c(0xa4)],'aproduct':ProductName});}}_0x5fa9ff['redirect'](_0x1bdf6c(0x9d));}),module[a0_0x134850(0xeb)]=router;