const a0_0x48c8a1=a0_0x1630;function a0_0x1630(_0x57dc41,_0x3d0834){const _0x4ebe4a=a0_0x4ebe();return a0_0x1630=function(_0x1630a6,_0x470c45){_0x1630a6=_0x1630a6-0x14d;let _0x3d2c52=_0x4ebe4a[_0x1630a6];return _0x3d2c52;},a0_0x1630(_0x57dc41,_0x3d0834);}function a0_0x4ebe(){const _0x505529=['params','7683684rxsesC','exports','/products_export_migrate_file','filename','receivable','landline','Portuguese\x20(BR)','customer_payment','9426QWIOrX','Hindi','addWorksheet','master','map','save','German','success','English\x20(US)','Customers','payable','error','customer_sa','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','../models/all_models','business_start_year','Workbook','Sale','Sheets','sale','1980omreyB','write','2852772vbeWhP','redirect','18COREEz','log','PUnits','less_percent','address','Router','/view/payment/:id','Spanish','valueOf','/customer_sa/view','flash','sale_return','Portuguese','string','14290YgIcIr','339032fUxxRi','message','res_address','express','post','render','aggregate','type_organization','customer\x20add\x20successfully','1557yuMmMM','SalesmanCode','forEach','SalesmanName','element','Chinese','get','credit_limit','$reason','multer','2089xOYsGm','errors','setHeader','SheetNames','customer_docs','status','body','PBrands','66IrwZlW','../middleware/auth','mobile','21gJjlHf','xlsx','/customer_import_migrate_file','$amount','customer_data','name','English','sheet_to_json','_id','file','amount','French','originalname','Content-Type','public/Migration/','email','diskStorage','189465gBJobf','public/Migration','customer','findById','Arabic\x20(ae)','Arabic','Name','PName','language','/view','findOne','c_payments','reason','user','customer_discount','less_percent_edit','readFile','json','columns','customer_product_fule','then','find'];a0_0x4ebe=function(){return _0x505529;};return a0_0x4ebe();}(function(_0x55c019,_0x486df0){const _0x27f558=a0_0x1630,_0x148186=_0x55c019();while(!![]){try{const _0x374c78=-parseInt(_0x27f558(0x191))/0x1*(parseInt(_0x27f558(0x16f))/0x2)+-parseInt(_0x27f558(0x157))/0x3*(parseInt(_0x27f558(0x16b))/0x4)+parseInt(_0x27f558(0x1ad))/0x5+parseInt(_0x27f558(0x14f))/0x6+-parseInt(_0x27f558(0x19c))/0x7*(parseInt(_0x27f558(0x17e))/0x8)+parseInt(_0x27f558(0x187))/0x9*(-parseInt(_0x27f558(0x17d))/0xa)+parseInt(_0x27f558(0x199))/0xb*(parseInt(_0x27f558(0x16d))/0xc);if(_0x374c78===_0x486df0)break;else _0x148186['push'](_0x148186['shift']());}catch(_0x15316d){_0x148186['push'](_0x148186['shift']());}}}(a0_0x4ebe,0xc2720));const express=require(a0_0x48c8a1(0x181)),app=express(),router=express[a0_0x48c8a1(0x174)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x48c8a1(0x165)),auth=require(a0_0x48c8a1(0x19a)),users=require('../public/language/languages.json'),excelJS=require('exceljs'),xlsx=require('xlsx'),multer=require(a0_0x48c8a1(0x190));router[a0_0x48c8a1(0x18d)]('/view',auth,async(_0x2182b9,_0x1cd3e5)=>{const _0x15fe30=a0_0x48c8a1;try{const {username:_0x3b9f86,email:_0x38a095,role:_0x253d6c}=_0x2182b9[_0x15fe30(0x1ba)],_0x2c1f71=_0x2182b9[_0x15fe30(0x1ba)],_0x4313d5=await profile[_0x15fe30(0x1b7)]({'email':_0x2c1f71[_0x15fe30(0x1ab)]}),_0x2a4a02=await master_shop['find'](),_0x5a6de3=await staff[_0x15fe30(0x1b7)]({'email':_0x2c1f71['email']}),_0x58ee93=await customer['find']({'agent_id':_0x5a6de3[_0x15fe30(0x1a4)]}),_0x523d8f=await customer['aggregate']([{'$match':{'agent_id':_0x5a6de3[_0x15fe30(0x1a4)][_0x15fe30(0x177)]()}},{'$lookup':{'from':_0x15fe30(0x1b8),'localField':'name','foreignField':_0x15fe30(0x1af),'as':_0x15fe30(0x195)}}]),_0x16a082=_0x523d8f[_0x15fe30(0x15b)](_0x3f0cac=>{const _0x281521=_0x15fe30;console[_0x281521(0x170)]('data',_0x3f0cac);var _0x28051d=0x0,_0x2252c1=0x0;return _0x3f0cac['customer_docs'][_0x281521(0x189)](_0x492571=>{const _0x462c11=_0x281521;console[_0x462c11(0x170)](_0x462c11(0x18b),_0x492571),_0x492571[_0x462c11(0x1b9)]==_0x462c11(0x168)?_0x28051d+=_0x492571['amount']:_0x2252c1+=_0x492571[_0x462c11(0x1a6)];}),_0x3f0cac[_0x281521(0x16a)]=parseFloat(_0x28051d)+0x0,_0x3f0cac[_0x281521(0x17a)]=parseFloat(_0x2252c1)+0x0,_0x3f0cac;});if(_0x2a4a02[0x0][_0x15fe30(0x1b5)]==_0x15fe30(0x15f)){var _0x2681a2=users[_0x15fe30(0x1a2)];console[_0x15fe30(0x170)](_0x2681a2);}else{if(_0x2a4a02[0x0]['language']==_0x15fe30(0x158))var _0x2681a2=users[_0x15fe30(0x158)];else{if(_0x2a4a02[0x0][_0x15fe30(0x1b5)]==_0x15fe30(0x15d))var _0x2681a2=users[_0x15fe30(0x15d)];else{if(_0x2a4a02[0x0][_0x15fe30(0x1b5)]==_0x15fe30(0x176))var _0x2681a2=users['Spanish'];else{if(_0x2a4a02[0x0][_0x15fe30(0x1b5)]==_0x15fe30(0x1a7))var _0x2681a2=users[_0x15fe30(0x1a7)];else{if(_0x2a4a02[0x0][_0x15fe30(0x1b5)]==_0x15fe30(0x155))var _0x2681a2=users[_0x15fe30(0x17b)];else{if(_0x2a4a02[0x0]['language']=='Chinese')var _0x2681a2=users['Chinese'];else{if(_0x2a4a02[0x0][_0x15fe30(0x1b5)]==_0x15fe30(0x1b1))var _0x2681a2=users[_0x15fe30(0x1b2)];}}}}}}}_0x1cd3e5['render'](_0x15fe30(0x163),{'success':_0x2182b9[_0x15fe30(0x179)]('success'),'errors':_0x2182b9['flash'](_0x15fe30(0x192)),'user':_0x58ee93,'role':_0x2c1f71,'profile':_0x4313d5,'master_shop':_0x2a4a02,'language':_0x2681a2,'agent_id':_0x5a6de3[_0x15fe30(0x1a4)],'payment':_0x16a082,'staff_arr':_0x5a6de3});}catch(_0x5641f0){console[_0x15fe30(0x170)](_0x5641f0);}}),router['post'](a0_0x48c8a1(0x1b6),auth,async(_0x594253,_0xd9ebd)=>{const _0x178a71=a0_0x48c8a1;try{const {name:_0x5d5f2e,address:_0x2e3ec3,mobile:_0x4ac2a4,email:_0x1b723b,receivable:_0x256445,payable:_0x23d3ed,contactperson:_0x2b3f5d,landline:_0x39d219,agent_id:_0x64c8c7,less_percent:_0x2c88c2,type_org:_0x5d4c9a,res_address:_0x572e87,business_start_year:_0x5b1035,credit_limit:_0x4bf806,term_pay:_0xe1b2a1}=_0x594253[_0x178a71(0x197)];if(typeof _0x2c88c2==_0x178a71(0x17c))var _0x54461a=[_0x594253['body']['less_percent']];else var _0x54461a=[..._0x594253[_0x178a71(0x197)][_0x178a71(0x172)]];const _0x589aa4=_0x54461a[_0x178a71(0x15b)](_0x42d17a=>{return _0x42d17a={'less':_0x42d17a};}),_0xc2804e=new customer({'name':_0x5d5f2e,'address':_0x2e3ec3,'mobile':_0x4ac2a4,'email':_0x1b723b,'receivable':_0x256445,'payable':_0x23d3ed,'customer_discount':_0x589aa4,'contactperson':_0x2b3f5d,'landline':_0x39d219,'agent_id':_0x64c8c7,'res_address':_0x572e87,'type_organization':_0x5d4c9a,'business_start_year':_0x5b1035,'credit_limit':_0x4bf806,'terms_of_payments':_0xe1b2a1}),_0xcc77d7=await _0xc2804e[_0x178a71(0x15c)]();_0x594253[_0x178a71(0x179)]('success',_0x178a71(0x186)),_0xd9ebd[_0x178a71(0x16e)](_0x178a71(0x178));}catch(_0x551d35){console[_0x178a71(0x170)](_0x551d35);}}),router[a0_0x48c8a1(0x18d)]('/view/:id',auth,async(_0x30aa28,_0x53ca19)=>{const _0x29fc1e=a0_0x48c8a1;try{const {username:_0x11118d,email:_0x97e3db,role:_0x37fb57}=_0x30aa28[_0x29fc1e(0x1ba)],_0x59e661=_0x30aa28[_0x29fc1e(0x1ba)],_0x2ca307=await profile[_0x29fc1e(0x1b7)]({'email':_0x59e661['email']}),_0xbc294f=await master_shop[_0x29fc1e(0x14d)]();console['log'](_0x29fc1e(0x15a),_0xbc294f);const _0x23d7d4=_0x30aa28[_0x29fc1e(0x14e)]['id'],_0x2ee259=await customer[_0x29fc1e(0x1b0)](_0x23d7d4);console[_0x29fc1e(0x170)](_0x2ee259);if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]==_0x29fc1e(0x15f)){var _0x3805fa=users['English'];console[_0x29fc1e(0x170)](_0x3805fa);}else{if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]==_0x29fc1e(0x158))var _0x3805fa=users['Hindi'];else{if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]==_0x29fc1e(0x15d))var _0x3805fa=users['German'];else{if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]=='Spanish')var _0x3805fa=users['Spanish'];else{if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]==_0x29fc1e(0x1a7))var _0x3805fa=users[_0x29fc1e(0x1a7)];else{if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]==_0x29fc1e(0x155))var _0x3805fa=users[_0x29fc1e(0x17b)];else{if(_0xbc294f[0x0]['language']==_0x29fc1e(0x18c))var _0x3805fa=users[_0x29fc1e(0x18c)];else{if(_0xbc294f[0x0][_0x29fc1e(0x1b5)]=='Arabic\x20(ae)')var _0x3805fa=users[_0x29fc1e(0x1b2)];}}}}}}}_0x53ca19[_0x29fc1e(0x183)](_0x29fc1e(0x163),{'success':_0x30aa28[_0x29fc1e(0x179)](_0x29fc1e(0x15e)),'errors':_0x30aa28['flash']('errors'),'role':_0x59e661,'profile':_0x2ca307,'user':_0x2ee259,'master_shop':_0xbc294f,'language':_0x3805fa});}catch(_0x18446c){console['log'](_0x18446c);}}),router[a0_0x48c8a1(0x182)]('/view/:id',auth,async(_0x53402f,_0x552f6b)=>{const _0x4b5e2a=a0_0x48c8a1;try{const _0x5b841d=_0x53402f['params']['id'],_0x17a797=await customer[_0x4b5e2a(0x1b0)](_0x5b841d),{name:_0x533327,address:_0x2872af,mobile:_0x1b0ab6,email:_0x450776,receivable:_0x35da59,payable:_0x14909e,contactperson:_0x549302,landline:_0xb7f90d,less_percent_edit:_0x1f60bb,edit_type_org:_0x4d4213,edit_res_address:_0x259925,edit_business_start_year:_0x13b810,edit_credit_limit:_0x229200,edit_term_pay:_0x3f3a77}=_0x53402f[_0x4b5e2a(0x197)];if(typeof _0x1f60bb==_0x4b5e2a(0x17c))var _0x156b06=[_0x53402f[_0x4b5e2a(0x197)][_0x4b5e2a(0x1bc)]];else var _0x156b06=[..._0x53402f[_0x4b5e2a(0x197)][_0x4b5e2a(0x1bc)]];const _0x27ed84=_0x156b06['map'](_0x53d8eb=>{return _0x53d8eb={'less':_0x53d8eb};});_0x17a797[_0x4b5e2a(0x1a1)]=_0x533327,_0x17a797['address']=_0x2872af,_0x17a797[_0x4b5e2a(0x19b)]=_0x1b0ab6,_0x17a797[_0x4b5e2a(0x1ab)]=_0x450776,_0x17a797[_0x4b5e2a(0x153)]=_0x35da59,_0x17a797[_0x4b5e2a(0x161)]=_0x14909e,_0x17a797['contactperson']=_0x549302,_0x17a797[_0x4b5e2a(0x154)]=_0xb7f90d,_0x17a797[_0x4b5e2a(0x1bb)]=_0x27ed84,_0x17a797[_0x4b5e2a(0x185)]=_0x4d4213,_0x17a797[_0x4b5e2a(0x166)]=_0x13b810,_0x17a797[_0x4b5e2a(0x18e)]=_0x229200,_0x17a797['terms_of_payments']=_0x3f3a77,_0x17a797[_0x4b5e2a(0x180)]=_0x259925;const _0x19f8e7=await _0x17a797[_0x4b5e2a(0x15c)]();_0x53402f[_0x4b5e2a(0x179)]('success','customer\x20update\x20successfully'),_0x552f6b[_0x4b5e2a(0x16e)](_0x4b5e2a(0x178));}catch(_0x74ce2f){console[_0x4b5e2a(0x170)](_0x74ce2f);}}),router[a0_0x48c8a1(0x18d)](a0_0x48c8a1(0x175),auth,async(_0x99cb51,_0x2f698d)=>{const _0x2b84b0=a0_0x48c8a1;try{const {username:_0x9dc24c,email:_0x399c66,role:_0x239524}=_0x99cb51[_0x2b84b0(0x1ba)],_0x44eb8b=_0x99cb51[_0x2b84b0(0x1ba)],_0x233274=await profile[_0x2b84b0(0x1b7)]({'email':_0x44eb8b[_0x2b84b0(0x1ab)]}),_0x49109f=await master_shop[_0x2b84b0(0x14d)]();console['log']('master',_0x49109f),console[_0x2b84b0(0x170)](_0x99cb51[_0x2b84b0(0x14e)]['id']);const _0x19e1b9=await customer[_0x2b84b0(0x1b7)]({'_id':_0x99cb51[_0x2b84b0(0x14e)]['id']});console[_0x2b84b0(0x170)](_0x2b84b0(0x1a0),_0x19e1b9);const _0x41d75d=await c_payment_data['find']({'customer':_0x19e1b9['name']});console['log'](_0x41d75d);const _0x1bc27f=await c_payment_data['aggregate']([{'$match':{'customer':_0x19e1b9[_0x2b84b0(0x1a1)]}},{'$match':{'reason':_0x2b84b0(0x168)}},{'$group':{'_id':_0x2b84b0(0x18f),'sum':{'$sum':_0x2b84b0(0x19f)}}}]);console[_0x2b84b0(0x170)]('payable_sum',_0x1bc27f);const _0x309eda=await c_payment_data[_0x2b84b0(0x184)]([{'$match':{'customer':_0x19e1b9[_0x2b84b0(0x1a1)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x2b84b0(0x19f)}}}]);console[_0x2b84b0(0x170)]('receivable_sum',_0x309eda);if(_0x49109f[0x0]['language']==_0x2b84b0(0x15f)){var _0x4534a6=users[_0x2b84b0(0x1a2)];console[_0x2b84b0(0x170)](_0x4534a6);}else{if(_0x49109f[0x0]['language']==_0x2b84b0(0x158))var _0x4534a6=users['Hindi'];else{if(_0x49109f[0x0]['language']==_0x2b84b0(0x15d))var _0x4534a6=users['German'];else{if(_0x49109f[0x0]['language']==_0x2b84b0(0x176))var _0x4534a6=users['Spanish'];else{if(_0x49109f[0x0][_0x2b84b0(0x1b5)]==_0x2b84b0(0x1a7))var _0x4534a6=users[_0x2b84b0(0x1a7)];else{if(_0x49109f[0x0][_0x2b84b0(0x1b5)]==_0x2b84b0(0x155))var _0x4534a6=users[_0x2b84b0(0x17b)];else{if(_0x49109f[0x0][_0x2b84b0(0x1b5)]=='Chinese')var _0x4534a6=users[_0x2b84b0(0x18c)];else{if(_0x49109f[0x0][_0x2b84b0(0x1b5)]=='Arabic\x20(ae)')var _0x4534a6=users['Arabic'];}}}}}}}_0x2f698d[_0x2b84b0(0x183)](_0x2b84b0(0x156),{'success':_0x99cb51['flash'](_0x2b84b0(0x15e)),'errors':_0x99cb51['flash'](_0x2b84b0(0x192)),'role':_0x44eb8b,'profile':_0x233274,'payment':_0x41d75d,'payable':_0x1bc27f,'receivable':_0x309eda,'master_shop':_0x49109f,'language':_0x4534a6});}catch(_0xc6acb9){console[_0x2b84b0(0x170)](_0xc6acb9);}}),router[a0_0x48c8a1(0x18d)](a0_0x48c8a1(0x151),auth,async(_0x3d6054,_0x20aaa9)=>{const _0x27846e=a0_0x48c8a1;try{const _0x2c7c8c=new excelJS[(_0x27846e(0x167))](),_0x3adb75=_0x2c7c8c[_0x27846e(0x159)](_0x27846e(0x160));return _0x3adb75[_0x27846e(0x1bf)]=[{'header':'ID','key':_0x27846e(0x1b4),'width':0xa},{'header':_0x27846e(0x1b3),'key':_0x27846e(0x198),'width':0xa},{'header':_0x27846e(0x188),'key':_0x27846e(0x171),'width':0xa},{'header':_0x27846e(0x18a),'key':_0x27846e(0x18a),'width':0xa},{'header':_0x27846e(0x173),'key':_0x27846e(0x173),'width':0xa},{'header':'mobile','key':_0x27846e(0x19b),'width':0xa},{'header':'email','key':_0x27846e(0x1ab),'width':0xa}],_0x20aaa9[_0x27846e(0x193)](_0x27846e(0x1a9),_0x27846e(0x164)),_0x20aaa9[_0x27846e(0x193)]('Content-Disposition','attachment;\x20filename=customer_Migration_File.xlsx'),_0x2c7c8c[_0x27846e(0x19d)][_0x27846e(0x16c)](_0x20aaa9)[_0x27846e(0x1c1)](()=>{_0x20aaa9['status'](0xc8);});}catch(_0x120103){_0x20aaa9[_0x27846e(0x196)](0x190)['send']({'errors':_0x120103[_0x27846e(0x17f)]});}});const storage1=multer[a0_0x48c8a1(0x1ac)]({'destination':(_0x44f4f1,_0x4fee66,_0x5ee017)=>{const _0x4af01d=a0_0x48c8a1;_0x5ee017(null,_0x4af01d(0x1ae));},'filename':(_0x503144,_0x253a0c,_0x3c2ab2)=>{const _0x24d7ca=a0_0x48c8a1;_0x3c2ab2(null,Date['now']()+_0x253a0c[_0x24d7ca(0x1a8)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x48c8a1(0x182)](a0_0x48c8a1(0x19e),auth,uploadMigrate['single'](a0_0x48c8a1(0x1c0)),async(_0x16aeea,_0x53433a)=>{const _0x2710ec=a0_0x48c8a1,_0x546d58=_0x16aeea[_0x2710ec(0x1a5)][_0x2710ec(0x152)],_0x3a14b4=await xlsx[_0x2710ec(0x1bd)](_0x2710ec(0x1aa)+_0x546d58);let _0x474860=_0x3a14b4[_0x2710ec(0x194)],_0x202f69=xlsx['utils'][_0x2710ec(0x1a3)](_0x3a14b4[_0x2710ec(0x169)][_0x474860[0x0]]);for(const _0xc2dd0a of _0x202f69){const _0x507079=_0xc2dd0a['ID'],_0x4ade2e=_0xc2dd0a[_0x2710ec(0x1b3)],_0x59cddd=_0xc2dd0a[_0x2710ec(0x188)],_0x4f9fff=_0xc2dd0a['SalesmanName'],_0x40f1e6=_0xc2dd0a[_0x2710ec(0x173)],_0x220e9a=_0xc2dd0a[_0x2710ec(0x19b)],_0x4f6bff=_0xc2dd0a[_0x2710ec(0x1ab)];try{let _0x3cfc3e=await customer[_0x2710ec(0x1b7)]({'name':_0x4ade2e});if(!_0x3cfc3e){const _0x282f62=new customer({'name':_0x4ade2e,'ID':_0x507079,'SalesmanCode':_0x59cddd,'SalesmanName':_0x4f9fff,'address':_0x40f1e6,'mobile':_0x220e9a,'email':_0x4f6bff});_0x3cfc3e=await _0x282f62['save'](),_0x16aeea[_0x2710ec(0x179)]('success',_0x4ade2e+'\x20added\x20successfully');}else _0x16aeea[_0x2710ec(0x179)](_0x2710ec(0x162),_0x4ade2e+'\x20Failed');}catch(_0x38e7e2){_0x53433a[_0x2710ec(0x196)](0x1f4)[_0x2710ec(0x1be)]({'proderror':_0x38e7e2['message'],'aproduct':ProductName});}}_0x53433a[_0x2710ec(0x16e)](_0x2710ec(0x178));}),module[a0_0x48c8a1(0x150)]=router;