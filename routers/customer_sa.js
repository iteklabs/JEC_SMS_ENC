const a0_0x331436=a0_0x7a6b;(function(_0x4561ae,_0x259141){const _0x48b733=a0_0x7a6b,_0x54ef64=_0x4561ae();while(!![]){try{const _0x5ccb2b=parseInt(_0x48b733(0x155))/0x1+-parseInt(_0x48b733(0x150))/0x2*(-parseInt(_0x48b733(0x157))/0x3)+-parseInt(_0x48b733(0x125))/0x4*(parseInt(_0x48b733(0x109))/0x5)+parseInt(_0x48b733(0x14c))/0x6+parseInt(_0x48b733(0x149))/0x7*(-parseInt(_0x48b733(0x124))/0x8)+-parseInt(_0x48b733(0x11e))/0x9+-parseInt(_0x48b733(0x162))/0xa;if(_0x5ccb2b===_0x259141)break;else _0x54ef64['push'](_0x54ef64['shift']());}catch(_0x3efe07){_0x54ef64['push'](_0x54ef64['shift']());}}}(a0_0x5495,0x3a22c));const express=require(a0_0x331436(0x121)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x331436(0x142)),auth=require(a0_0x331436(0x148)),users=require(a0_0x331436(0x146)),excelJS=require(a0_0x331436(0xfd)),xlsx=require('xlsx'),multer=require(a0_0x331436(0x13c));router[a0_0x331436(0x12a)](a0_0x331436(0x167),auth,async(_0x3b8bcf,_0x536e61)=>{const _0x2ecbf9=a0_0x331436;try{const {username:_0x1ba711,email:_0x5eabc2,role:_0x4b237a}=_0x3b8bcf['user'],_0x2edfa5=_0x3b8bcf['user'],_0x487447=await profile[_0x2ecbf9(0x160)]({'email':_0x2edfa5[_0x2ecbf9(0x122)]}),_0x358bc8=await master_shop[_0x2ecbf9(0x11c)](),_0x440336=await staff[_0x2ecbf9(0x160)]({'email':_0x2edfa5[_0x2ecbf9(0x122)]}),_0x3f0c69=await customer[_0x2ecbf9(0x11c)]({'agent_id':_0x440336[_0x2ecbf9(0x113)]}),_0x2bf082=await customer['aggregate']([{'$match':{'agent_id':_0x440336[_0x2ecbf9(0x113)][_0x2ecbf9(0x16a)]()}},{'$lookup':{'from':_0x2ecbf9(0x131),'localField':_0x2ecbf9(0x11f),'foreignField':_0x2ecbf9(0x13a),'as':_0x2ecbf9(0x14d)}}]),_0x153aa8=_0x2bf082['map'](_0x5e9c83=>{const _0x21f65f=_0x2ecbf9;console[_0x21f65f(0x10f)](_0x21f65f(0xfa),_0x5e9c83);var _0x5ba578=0x0,_0x3ecc75=0x0;return _0x5e9c83[_0x21f65f(0x14d)][_0x21f65f(0x135)](_0x4c112d=>{const _0x571af0=_0x21f65f;console[_0x571af0(0x10f)](_0x571af0(0x168),_0x4c112d),_0x4c112d[_0x571af0(0x140)]=='Sale'?_0x5ba578+=_0x4c112d[_0x571af0(0x169)]:_0x3ecc75+=_0x4c112d[_0x571af0(0x169)];}),_0x5e9c83['sale']=parseFloat(_0x5ba578)+0x0,_0x5e9c83[_0x21f65f(0x14b)]=parseFloat(_0x3ecc75)+0x0,_0x5e9c83;});if(_0x358bc8[0x0][_0x2ecbf9(0x137)]==_0x2ecbf9(0x143)){var _0x190c7c=users[_0x2ecbf9(0x11b)];console[_0x2ecbf9(0x10f)](_0x190c7c);}else{if(_0x358bc8[0x0][_0x2ecbf9(0x137)]==_0x2ecbf9(0x102))var _0x190c7c=users['Hindi'];else{if(_0x358bc8[0x0][_0x2ecbf9(0x137)]=='German')var _0x190c7c=users[_0x2ecbf9(0x110)];else{if(_0x358bc8[0x0][_0x2ecbf9(0x137)]=='Spanish')var _0x190c7c=users[_0x2ecbf9(0x133)];else{if(_0x358bc8[0x0]['language']==_0x2ecbf9(0x132))var _0x190c7c=users['French'];else{if(_0x358bc8[0x0][_0x2ecbf9(0x137)]==_0x2ecbf9(0x138))var _0x190c7c=users[_0x2ecbf9(0x13f)];else{if(_0x358bc8[0x0]['language']==_0x2ecbf9(0x107))var _0x190c7c=users['Chinese'];else{if(_0x358bc8[0x0]['language']==_0x2ecbf9(0x10a))var _0x190c7c=users[_0x2ecbf9(0x10e)];}}}}}}}_0x536e61[_0x2ecbf9(0x117)](_0x2ecbf9(0x100),{'success':_0x3b8bcf[_0x2ecbf9(0x12f)](_0x2ecbf9(0x144)),'errors':_0x3b8bcf[_0x2ecbf9(0x12f)]('errors'),'user':_0x3f0c69,'role':_0x2edfa5,'profile':_0x487447,'master_shop':_0x358bc8,'language':_0x190c7c,'agent_id':_0x440336[_0x2ecbf9(0x113)],'payment':_0x153aa8,'staff_arr':_0x440336});}catch(_0x135754){console[_0x2ecbf9(0x10f)](_0x135754);}}),router['post']('/view',auth,async(_0x28a8f1,_0x36a6df)=>{const _0x390ec1=a0_0x331436;try{const {name:_0x332e24,address:_0x7beafe,mobile:_0x47ab4d,email:_0x115e7f,receivable:_0x7e6cf8,payable:_0x3e76cb,contactperson:_0x6bbfbd,landline:_0x4fc57c,agent_id:_0x2cb8dc,less_percent:_0x23c59b,type_org:_0xfcebf6,res_address:_0x1756ba,business_start_year:_0x3d1cce,credit_limit:_0x512399,term_pay:_0x17e2ea}=_0x28a8f1[_0x390ec1(0x11a)];if(typeof _0x23c59b==_0x390ec1(0x111))var _0x4c450e=[_0x28a8f1[_0x390ec1(0x11a)][_0x390ec1(0x163)]];else var _0x4c450e=[..._0x28a8f1['body'][_0x390ec1(0x163)]];const _0x3c1447=_0x4c450e[_0x390ec1(0x145)](_0x39e08c=>{return _0x39e08c={'less':_0x39e08c};}),_0x309d3f=new customer({'name':_0x332e24,'address':_0x7beafe,'mobile':_0x47ab4d,'email':_0x115e7f,'receivable':_0x7e6cf8,'payable':_0x3e76cb,'customer_discount':_0x3c1447,'contactperson':_0x6bbfbd,'landline':_0x4fc57c,'agent_id':_0x2cb8dc,'res_address':_0x1756ba,'type_organization':_0xfcebf6,'business_start_year':_0x3d1cce,'credit_limit':_0x512399,'terms_of_payments':_0x17e2ea}),_0x5dc791=await _0x309d3f['save']();_0x28a8f1[_0x390ec1(0x12f)](_0x390ec1(0x144),'customer\x20add\x20successfully'),_0x36a6df[_0x390ec1(0x156)](_0x390ec1(0x106));}catch(_0x16ffdd){console[_0x390ec1(0x10f)](_0x16ffdd);}}),router[a0_0x331436(0x12a)](a0_0x331436(0x15b),auth,async(_0x23d9d3,_0x1f268d)=>{const _0x2be8a7=a0_0x331436;try{const {username:_0x21dcab,email:_0x3850c4,role:_0x336119}=_0x23d9d3[_0x2be8a7(0x101)],_0xaa26f9=_0x23d9d3['user'],_0x1cf2d7=await profile[_0x2be8a7(0x160)]({'email':_0xaa26f9[_0x2be8a7(0x122)]}),_0x3dd356=await master_shop[_0x2be8a7(0x11c)]();console[_0x2be8a7(0x10f)](_0x2be8a7(0x166),_0x3dd356);const _0x5b03a1=_0x23d9d3['params']['id'],_0xf0a4bf=await customer[_0x2be8a7(0x12e)](_0x5b03a1);console[_0x2be8a7(0x10f)](_0xf0a4bf);if(_0x3dd356[0x0]['language']==_0x2be8a7(0x143)){var _0x237632=users[_0x2be8a7(0x11b)];console[_0x2be8a7(0x10f)](_0x237632);}else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]==_0x2be8a7(0x102))var _0x237632=users[_0x2be8a7(0x102)];else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]==_0x2be8a7(0x110))var _0x237632=users['German'];else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]==_0x2be8a7(0x133))var _0x237632=users['Spanish'];else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]=='French')var _0x237632=users[_0x2be8a7(0x132)];else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]==_0x2be8a7(0x138))var _0x237632=users[_0x2be8a7(0x13f)];else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]=='Chinese')var _0x237632=users[_0x2be8a7(0x107)];else{if(_0x3dd356[0x0][_0x2be8a7(0x137)]==_0x2be8a7(0x10a))var _0x237632=users['Arabic'];}}}}}}}_0x1f268d[_0x2be8a7(0x117)](_0x2be8a7(0x100),{'success':_0x23d9d3[_0x2be8a7(0x12f)]('success'),'errors':_0x23d9d3[_0x2be8a7(0x12f)]('errors'),'role':_0xaa26f9,'profile':_0x1cf2d7,'user':_0xf0a4bf,'master_shop':_0x3dd356,'language':_0x237632});}catch(_0x463b42){console['log'](_0x463b42);}}),router[a0_0x331436(0x116)]('/view/:id',auth,async(_0x4bef39,_0x28411e)=>{const _0x35e78e=a0_0x331436;try{const _0x479d18=_0x4bef39['params']['id'],_0x34435e=await customer[_0x35e78e(0x12e)](_0x479d18),{name:_0x140b2c,address:_0xb23095,mobile:_0x5f2021,email:_0x45b4c5,receivable:_0x5d923a,payable:_0x406cc5,contactperson:_0x64b62c,landline:_0xd7fddc,less_percent_edit:_0x7cfb61,edit_type_org:_0x31042f,edit_res_address:_0x2144c7,edit_business_start_year:_0x38ba0e,edit_credit_limit:_0x2a401d,edit_term_pay:_0x401693}=_0x4bef39[_0x35e78e(0x11a)];if(typeof _0x7cfb61==_0x35e78e(0x111))var _0x72448=[_0x4bef39[_0x35e78e(0x11a)][_0x35e78e(0x112)]];else var _0x72448=[..._0x4bef39[_0x35e78e(0x11a)][_0x35e78e(0x112)]];const _0x4bd3c8=_0x72448[_0x35e78e(0x145)](_0x169ee6=>{return _0x169ee6={'less':_0x169ee6};});_0x34435e[_0x35e78e(0x11f)]=_0x140b2c,_0x34435e[_0x35e78e(0x120)]=_0xb23095,_0x34435e['mobile']=_0x5f2021,_0x34435e['email']=_0x45b4c5,_0x34435e['receivable']=_0x5d923a,_0x34435e[_0x35e78e(0x136)]=_0x406cc5,_0x34435e[_0x35e78e(0x154)]=_0x64b62c,_0x34435e['landline']=_0xd7fddc,_0x34435e[_0x35e78e(0x153)]=_0x4bd3c8,_0x34435e[_0x35e78e(0x14e)]=_0x31042f,_0x34435e[_0x35e78e(0x128)]=_0x38ba0e,_0x34435e['credit_limit']=_0x2a401d,_0x34435e['terms_of_payments']=_0x401693,_0x34435e[_0x35e78e(0x15c)]=_0x2144c7;const _0x4c44f8=await _0x34435e['save']();_0x4bef39[_0x35e78e(0x12f)]('success',_0x35e78e(0x108)),_0x28411e['redirect'](_0x35e78e(0x106));}catch(_0x546d12){console['log'](_0x546d12);}}),router[a0_0x331436(0x12a)](a0_0x331436(0x10c),auth,async(_0x39014e,_0x2491e9)=>{const _0x1b007a=a0_0x331436;try{const {username:_0x502bc8,email:_0x1ddd15,role:_0x28613f}=_0x39014e[_0x1b007a(0x101)],_0x27beb6=_0x39014e[_0x1b007a(0x101)],_0x1dd6ae=await profile['findOne']({'email':_0x27beb6[_0x1b007a(0x122)]}),_0x4e7f95=await master_shop[_0x1b007a(0x11c)]();console[_0x1b007a(0x10f)]('master',_0x4e7f95),console[_0x1b007a(0x10f)](_0x39014e['params']['id']);const _0x5f229c=await customer[_0x1b007a(0x160)]({'_id':_0x39014e['params']['id']});console['log'](_0x1b007a(0x152),_0x5f229c);const _0x57617d=await c_payment_data[_0x1b007a(0x11c)]({'customer':_0x5f229c[_0x1b007a(0x11f)]});console[_0x1b007a(0x10f)](_0x57617d);const _0xd969a0=await c_payment_data[_0x1b007a(0x159)]([{'$match':{'customer':_0x5f229c[_0x1b007a(0x11f)]}},{'$match':{'reason':_0x1b007a(0x13e)}},{'$group':{'_id':_0x1b007a(0x15f),'sum':{'$sum':_0x1b007a(0x12d)}}}]);console[_0x1b007a(0x10f)](_0x1b007a(0x15e),_0xd969a0);const _0x591598=await c_payment_data[_0x1b007a(0x159)]([{'$match':{'customer':_0x5f229c['name']}},{'$match':{'reason':_0x1b007a(0x115)}},{'$group':{'_id':_0x1b007a(0x15f),'sum':{'$sum':_0x1b007a(0x12d)}}}]);console['log'](_0x1b007a(0x130),_0x591598);if(_0x4e7f95[0x0]['language']=='English\x20(US)'){var _0x438b93=users[_0x1b007a(0x11b)];console[_0x1b007a(0x10f)](_0x438b93);}else{if(_0x4e7f95[0x0][_0x1b007a(0x137)]==_0x1b007a(0x102))var _0x438b93=users['Hindi'];else{if(_0x4e7f95[0x0][_0x1b007a(0x137)]=='German')var _0x438b93=users[_0x1b007a(0x110)];else{if(_0x4e7f95[0x0]['language']==_0x1b007a(0x133))var _0x438b93=users[_0x1b007a(0x133)];else{if(_0x4e7f95[0x0]['language']=='French')var _0x438b93=users[_0x1b007a(0x132)];else{if(_0x4e7f95[0x0][_0x1b007a(0x137)]==_0x1b007a(0x138))var _0x438b93=users[_0x1b007a(0x13f)];else{if(_0x4e7f95[0x0][_0x1b007a(0x137)]==_0x1b007a(0x107))var _0x438b93=users['Chinese'];else{if(_0x4e7f95[0x0]['language']=='Arabic\x20(ae)')var _0x438b93=users[_0x1b007a(0x10e)];}}}}}}}_0x2491e9['render'](_0x1b007a(0x139),{'success':_0x39014e[_0x1b007a(0x12f)](_0x1b007a(0x144)),'errors':_0x39014e['flash'](_0x1b007a(0x164)),'role':_0x27beb6,'profile':_0x1dd6ae,'payment':_0x57617d,'payable':_0xd969a0,'receivable':_0x591598,'master_shop':_0x4e7f95,'language':_0x438b93});}catch(_0xab12){console[_0x1b007a(0x10f)](_0xab12);}}),router[a0_0x331436(0x12a)]('/products_export_migrate_file',auth,async(_0x2a8883,_0x41009)=>{const _0x4f15b3=a0_0x331436;try{const _0x3c79f9=new excelJS['Workbook'](),_0x28d094=_0x3c79f9['addWorksheet'](_0x4f15b3(0x10b));return _0x28d094[_0x4f15b3(0x147)]=[{'header':'ID','key':_0x4f15b3(0x123),'width':0xa},{'header':_0x4f15b3(0x14f),'key':_0x4f15b3(0x161),'width':0xa},{'header':_0x4f15b3(0x151),'key':_0x4f15b3(0xff),'width':0xa},{'header':_0x4f15b3(0xfc),'key':_0x4f15b3(0xfc),'width':0xa},{'header':'address','key':_0x4f15b3(0x120),'width':0xa},{'header':_0x4f15b3(0xfb),'key':_0x4f15b3(0xfb),'width':0xa},{'header':'email','key':_0x4f15b3(0x122),'width':0xa}],_0x41009['setHeader'](_0x4f15b3(0x105),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x41009[_0x4f15b3(0x158)]('Content-Disposition',_0x4f15b3(0x127)),_0x3c79f9['xlsx'][_0x4f15b3(0x141)](_0x41009)[_0x4f15b3(0x15a)](()=>{const _0x1fe0b0=_0x4f15b3;_0x41009[_0x1fe0b0(0x10d)](0xc8);});}catch(_0x4e097f){_0x41009[_0x4f15b3(0x10d)](0x190)[_0x4f15b3(0xf9)]({'errors':_0x4e097f[_0x4f15b3(0xfe)]});}});function a0_0x7a6b(_0x4c983b,_0x17c1f9){const _0x549598=a0_0x5495();return a0_0x7a6b=function(_0x7a6b2e,_0x1d37a4){_0x7a6b2e=_0x7a6b2e-0xf9;let _0x579ac7=_0x549598[_0x7a6b2e];return _0x579ac7;},a0_0x7a6b(_0x4c983b,_0x17c1f9);}const storage1=multer[a0_0x331436(0x114)]({'destination':(_0xf99a2a,_0x14dd7d,_0x67f0f4)=>{const _0x3ce514=a0_0x331436;_0x67f0f4(null,_0x3ce514(0x12c));},'filename':(_0x5436ac,_0x2a657f,_0x1ba2f8)=>{const _0x14a2d4=a0_0x331436;_0x1ba2f8(null,Date['now']()+_0x2a657f[_0x14a2d4(0x129)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x331436(0x116)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x331436(0x165)](a0_0x331436(0x119)),async(_0x2d8ccf,_0x4f03f0)=>{const _0x24fd75=a0_0x331436,_0x5a542d=_0x2d8ccf[_0x24fd75(0x14a)][_0x24fd75(0x134)],_0xc1a2a4=await xlsx[_0x24fd75(0x118)](_0x24fd75(0x103)+_0x5a542d);let _0x2acf13=_0xc1a2a4['SheetNames'],_0x27e303=xlsx[_0x24fd75(0x11d)][_0x24fd75(0x12b)](_0xc1a2a4[_0x24fd75(0x13b)][_0x2acf13[0x0]]);for(const _0x575a1f of _0x27e303){const _0x496890=_0x575a1f['ID'],_0x37d5fc=_0x575a1f['Name'],_0x4a7915=_0x575a1f[_0x24fd75(0x151)],_0x1853ae=_0x575a1f[_0x24fd75(0xfc)],_0xfb215c=_0x575a1f[_0x24fd75(0x120)],_0x37e91e=_0x575a1f[_0x24fd75(0xfb)],_0x5708cc=_0x575a1f[_0x24fd75(0x122)];try{let _0x2f3f30=await customer['findOne']({'name':_0x37d5fc});if(!_0x2f3f30){const _0x391786=new customer({'name':_0x37d5fc,'ID':_0x496890,'SalesmanCode':_0x4a7915,'SalesmanName':_0x1853ae,'address':_0xfb215c,'mobile':_0x37e91e,'email':_0x5708cc});_0x2f3f30=await _0x391786['save'](),_0x2d8ccf[_0x24fd75(0x12f)]('success',_0x37d5fc+'\x20added\x20successfully');}else _0x2d8ccf[_0x24fd75(0x12f)](_0x24fd75(0x13d),_0x37d5fc+_0x24fd75(0x126));}catch(_0x518421){_0x4f03f0[_0x24fd75(0x10d)](0x1f4)[_0x24fd75(0x15d)]({'proderror':_0x518421[_0x24fd75(0xfe)],'aproduct':ProductName});}}_0x4f03f0[_0x24fd75(0x156)](_0x24fd75(0x106));}),module[a0_0x331436(0x104)]=router;function a0_0x5495(){const _0x555c46=['errors','single','master','/view','element','amount','valueOf','send','data','mobile','SalesmanName','exceljs','message','PUnits','customer_sa','user','Hindi','public/Migration/','exports','Content-Type','/customer_sa/view','Chinese','customer\x20update\x20successfully','5pANVbf','Arabic\x20(ae)','Customers','/view/payment/:id','status','Arabic','log','German','string','less_percent_edit','_id','diskStorage','Sale\x20Return','post','render','readFile','customer_product_fule','body','English','find','utils','670329QkPwHz','name','address','express','email','PName','152qysJtg','1125588LISkqb','\x20Failed','attachment;\x20filename=customer_Migration_File.xlsx','business_start_year','originalname','get','sheet_to_json','public/Migration','$amount','findById','flash','receivable_sum','c_payments','French','Spanish','filename','forEach','payable','language','Portuguese\x20(BR)','customer_payment','customer','Sheets','multer','error','Sale','Portuguese','reason','write','../models/all_models','English\x20(US)','success','map','../public/language/languages.json','columns','../middleware/auth','50834VpNgxl','file','sale_return','2615514ekFwKJ','customer_docs','type_organization','Name','24ICMseE','SalesmanCode','customer_data','customer_discount','contactperson','277336FPexcW','redirect','82371aLeSTD','setHeader','aggregate','then','/view/:id','res_address','json','payable_sum','$reason','findOne','PBrands','3107590varPOl','less_percent'];a0_0x5495=function(){return _0x555c46;};return a0_0x5495();}