const a0_0x433bcf=a0_0x1c2f;(function(_0x4a7bb5,_0x4a41dc){const _0x2a174e=a0_0x1c2f,_0x9d5a70=_0x4a7bb5();while(!![]){try{const _0xa83288=parseInt(_0x2a174e(0xdd))/0x1+-parseInt(_0x2a174e(0x120))/0x2*(parseInt(_0x2a174e(0x131))/0x3)+parseInt(_0x2a174e(0x124))/0x4*(-parseInt(_0x2a174e(0x10b))/0x5)+parseInt(_0x2a174e(0xe3))/0x6+-parseInt(_0x2a174e(0x135))/0x7*(-parseInt(_0x2a174e(0xfc))/0x8)+parseInt(_0x2a174e(0x129))/0x9+-parseInt(_0x2a174e(0x11c))/0xa;if(_0xa83288===_0x4a41dc)break;else _0x9d5a70['push'](_0x9d5a70['shift']());}catch(_0x342b89){_0x9d5a70['push'](_0x9d5a70['shift']());}}}(a0_0x563c,0x3bc23));const express=require(a0_0x433bcf(0x12f)),app=express(),router=express[a0_0x433bcf(0x128)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x433bcf(0x112)),auth=require(a0_0x433bcf(0x123)),users=require(a0_0x433bcf(0xd0)),excelJS=require(a0_0x433bcf(0xcd)),xlsx=require('xlsx'),multer=require(a0_0x433bcf(0xfd));function a0_0x1c2f(_0x2facc5,_0x1ece71){const _0x563c89=a0_0x563c();return a0_0x1c2f=function(_0x1c2fbd,_0x3d670e){_0x1c2fbd=_0x1c2fbd-0xc4;let _0x56a42b=_0x563c89[_0x1c2fbd];return _0x56a42b;},a0_0x1c2f(_0x2facc5,_0x1ece71);}router[a0_0x433bcf(0xce)](a0_0x433bcf(0xeb),auth,async(_0x343bf6,_0x2448ab)=>{const _0x5a4ce3=a0_0x433bcf;try{const {username:_0x2c8b3b,email:_0x50e8ea,role:_0x1152e9}=_0x343bf6[_0x5a4ce3(0xf9)],_0x554693=_0x343bf6[_0x5a4ce3(0xf9)],_0x507e4d=await profile[_0x5a4ce3(0xfe)]({'email':_0x554693[_0x5a4ce3(0xf3)]}),_0x18610e=await master_shop[_0x5a4ce3(0x114)](),_0x506efd=await staff['findOne']({'email':_0x554693[_0x5a4ce3(0xf3)]}),_0x3be983=await customer['find']({'agent_id':_0x506efd[_0x5a4ce3(0xe4)]}),_0x3dc551=await customer['aggregate']([{'$match':{'agent_id':_0x506efd[_0x5a4ce3(0xe4)][_0x5a4ce3(0xc4)]()}},{'$lookup':{'from':_0x5a4ce3(0x102),'localField':_0x5a4ce3(0xc8),'foreignField':_0x5a4ce3(0xf4),'as':_0x5a4ce3(0x10c)}}]),_0x183f4e=_0x3dc551[_0x5a4ce3(0x109)](_0x4117fd=>{const _0x1d78f3=_0x5a4ce3;console[_0x1d78f3(0x107)]('data',_0x4117fd);var _0x15595d=0x0,_0x10771f=0x0;return _0x4117fd[_0x1d78f3(0x10c)][_0x1d78f3(0xd3)](_0x5ae3fc=>{const _0x25d612=_0x1d78f3;console['log'](_0x25d612(0xd6),_0x5ae3fc),_0x5ae3fc['reason']==_0x25d612(0xd8)?_0x15595d+=_0x5ae3fc[_0x25d612(0xc7)]:_0x10771f+=_0x5ae3fc['amount'];}),_0x4117fd[_0x1d78f3(0xc6)]=parseFloat(_0x15595d)+0x0,_0x4117fd[_0x1d78f3(0xcf)]=parseFloat(_0x10771f)+0x0,_0x4117fd;});if(_0x18610e[0x0][_0x5a4ce3(0xed)]==_0x5a4ce3(0xee)){var _0x3314ad=users[_0x5a4ce3(0x132)];console[_0x5a4ce3(0x107)](_0x3314ad);}else{if(_0x18610e[0x0][_0x5a4ce3(0xed)]==_0x5a4ce3(0xef))var _0x3314ad=users[_0x5a4ce3(0xef)];else{if(_0x18610e[0x0][_0x5a4ce3(0xed)]==_0x5a4ce3(0xe2))var _0x3314ad=users[_0x5a4ce3(0xe2)];else{if(_0x18610e[0x0][_0x5a4ce3(0xed)]=='Spanish')var _0x3314ad=users[_0x5a4ce3(0x118)];else{if(_0x18610e[0x0][_0x5a4ce3(0xed)]==_0x5a4ce3(0x12c))var _0x3314ad=users[_0x5a4ce3(0x12c)];else{if(_0x18610e[0x0]['language']==_0x5a4ce3(0xff))var _0x3314ad=users['Portuguese'];else{if(_0x18610e[0x0]['language']=='Chinese')var _0x3314ad=users[_0x5a4ce3(0x10f)];else{if(_0x18610e[0x0]['language']==_0x5a4ce3(0x121))var _0x3314ad=users[_0x5a4ce3(0x110)];}}}}}}}_0x2448ab[_0x5a4ce3(0xe0)]('customer_sa',{'success':_0x343bf6[_0x5a4ce3(0xcc)](_0x5a4ce3(0xd4)),'errors':_0x343bf6[_0x5a4ce3(0xcc)](_0x5a4ce3(0xd2)),'user':_0x3be983,'role':_0x554693,'profile':_0x507e4d,'master_shop':_0x18610e,'language':_0x3314ad,'agent_id':_0x506efd[_0x5a4ce3(0xe4)],'payment':_0x183f4e,'staff_arr':_0x506efd});}catch(_0x365f4d){console[_0x5a4ce3(0x107)](_0x365f4d);}}),router[a0_0x433bcf(0x137)](a0_0x433bcf(0xeb),auth,async(_0x54fe6b,_0x6683cf)=>{const _0x55bb46=a0_0x433bcf;try{const {name:_0x3b0efd,address:_0x3f6d29,mobile:_0x343265,email:_0x3d0cc3,receivable:_0x45d786,payable:_0x4d9eed,contactperson:_0x4b3362,landline:_0x4db7a9,agent_id:_0x126925,less_percent:_0x35b216,type_org:_0xcec74c,res_address:_0x5d649f,business_start_year:_0x2a6d3e,credit_limit:_0x3318e1,term_pay:_0x38c313}=_0x54fe6b[_0x55bb46(0x119)];if(typeof _0x35b216==_0x55bb46(0xec))var _0x52307c=[_0x54fe6b[_0x55bb46(0x119)][_0x55bb46(0x12b)]];else var _0x52307c=[..._0x54fe6b[_0x55bb46(0x119)][_0x55bb46(0x12b)]];const _0x3695ce=_0x52307c[_0x55bb46(0x109)](_0x5b2991=>{return _0x5b2991={'less':_0x5b2991};}),_0x3bc542=new customer({'name':_0x3b0efd,'address':_0x3f6d29,'mobile':_0x343265,'email':_0x3d0cc3,'receivable':_0x45d786,'payable':_0x4d9eed,'customer_discount':_0x3695ce,'contactperson':_0x4b3362,'landline':_0x4db7a9,'agent_id':_0x126925,'res_address':_0x5d649f,'type_organization':_0xcec74c,'business_start_year':_0x2a6d3e,'credit_limit':_0x3318e1,'terms_of_payments':_0x38c313}),_0x31cd5=await _0x3bc542[_0x55bb46(0xcb)]();_0x54fe6b[_0x55bb46(0xcc)](_0x55bb46(0xd4),'customer\x20add\x20successfully'),_0x6683cf[_0x55bb46(0x10d)]('/customer_sa/view');}catch(_0x18b028){console[_0x55bb46(0x107)](_0x18b028);}}),router[a0_0x433bcf(0xce)](a0_0x433bcf(0xe8),auth,async(_0x520b82,_0x4cf0f4)=>{const _0x4b69d2=a0_0x433bcf;try{const {username:_0x1fa2e1,email:_0x19879d,role:_0x69b917}=_0x520b82[_0x4b69d2(0xf9)],_0x1e0cbd=_0x520b82['user'],_0x4dbff1=await profile[_0x4b69d2(0xfe)]({'email':_0x1e0cbd[_0x4b69d2(0xf3)]}),_0xa39710=await master_shop[_0x4b69d2(0x114)]();console['log']('master',_0xa39710);const _0x258454=_0x520b82[_0x4b69d2(0xd5)]['id'],_0x3f8f79=await customer['findById'](_0x258454);console[_0x4b69d2(0x107)](_0x3f8f79);if(_0xa39710[0x0][_0x4b69d2(0xed)]=='English\x20(US)'){var _0x140326=users[_0x4b69d2(0x132)];console[_0x4b69d2(0x107)](_0x140326);}else{if(_0xa39710[0x0][_0x4b69d2(0xed)]==_0x4b69d2(0xef))var _0x140326=users['Hindi'];else{if(_0xa39710[0x0]['language']==_0x4b69d2(0xe2))var _0x140326=users[_0x4b69d2(0xe2)];else{if(_0xa39710[0x0][_0x4b69d2(0xed)]==_0x4b69d2(0x118))var _0x140326=users[_0x4b69d2(0x118)];else{if(_0xa39710[0x0][_0x4b69d2(0xed)]==_0x4b69d2(0x12c))var _0x140326=users[_0x4b69d2(0x12c)];else{if(_0xa39710[0x0]['language']=='Portuguese\x20(BR)')var _0x140326=users['Portuguese'];else{if(_0xa39710[0x0][_0x4b69d2(0xed)]==_0x4b69d2(0x10f))var _0x140326=users[_0x4b69d2(0x10f)];else{if(_0xa39710[0x0][_0x4b69d2(0xed)]==_0x4b69d2(0x121))var _0x140326=users[_0x4b69d2(0x110)];}}}}}}}_0x4cf0f4['render'](_0x4b69d2(0x104),{'success':_0x520b82['flash']('success'),'errors':_0x520b82[_0x4b69d2(0xcc)](_0x4b69d2(0xd2)),'role':_0x1e0cbd,'profile':_0x4dbff1,'user':_0x3f8f79,'master_shop':_0xa39710,'language':_0x140326});}catch(_0xdd8f5b){console['log'](_0xdd8f5b);}}),router[a0_0x433bcf(0x137)](a0_0x433bcf(0xe8),auth,async(_0x173749,_0x9a1b1)=>{const _0x44344a=a0_0x433bcf;try{const _0x57fdb9=_0x173749['params']['id'],_0x5994e0=await customer[_0x44344a(0xf6)](_0x57fdb9),{name:_0x24be06,address:_0x5af41f,mobile:_0x1c684c,email:_0x44f62d,receivable:_0x59e86b,payable:_0x29bd84,contactperson:_0x2d3643,landline:_0x34dd89,less_percent_edit:_0x300663,edit_type_org:_0x2e9fb8,edit_res_address:_0xfad23f,edit_business_start_year:_0x2f2afc,edit_credit_limit:_0x5d2882,edit_term_pay:_0x4c58a8}=_0x173749[_0x44344a(0x119)];if(typeof _0x300663==_0x44344a(0xec))var _0x56b25a=[_0x173749[_0x44344a(0x119)][_0x44344a(0x133)]];else var _0x56b25a=[..._0x173749[_0x44344a(0x119)]['less_percent_edit']];const _0x412288=_0x56b25a[_0x44344a(0x109)](_0x4ebf56=>{return _0x4ebf56={'less':_0x4ebf56};});_0x5994e0[_0x44344a(0xc8)]=_0x24be06,_0x5994e0[_0x44344a(0xe7)]=_0x5af41f,_0x5994e0[_0x44344a(0x116)]=_0x1c684c,_0x5994e0[_0x44344a(0xf3)]=_0x44f62d,_0x5994e0[_0x44344a(0x111)]=_0x59e86b,_0x5994e0[_0x44344a(0xea)]=_0x29bd84,_0x5994e0['contactperson']=_0x2d3643,_0x5994e0[_0x44344a(0x11d)]=_0x34dd89,_0x5994e0[_0x44344a(0x12d)]=_0x412288,_0x5994e0['type_organization']=_0x2e9fb8,_0x5994e0[_0x44344a(0x130)]=_0x2f2afc,_0x5994e0[_0x44344a(0xfb)]=_0x5d2882,_0x5994e0['terms_of_payments']=_0x4c58a8,_0x5994e0[_0x44344a(0xd9)]=_0xfad23f;const _0x35f081=await _0x5994e0[_0x44344a(0xcb)]();_0x173749[_0x44344a(0xcc)]('success',_0x44344a(0xf0)),_0x9a1b1['redirect'](_0x44344a(0xc9));}catch(_0x4b5cca){console[_0x44344a(0x107)](_0x4b5cca);}}),router[a0_0x433bcf(0xce)]('/view/payment/:id',auth,async(_0x2f0350,_0x4cf833)=>{const _0x59dd04=a0_0x433bcf;try{const {username:_0x5c5b0c,email:_0x143d91,role:_0x2f76d7}=_0x2f0350[_0x59dd04(0xf9)],_0x417fd2=_0x2f0350[_0x59dd04(0xf9)],_0x1ab0be=await profile[_0x59dd04(0xfe)]({'email':_0x417fd2[_0x59dd04(0xf3)]}),_0x3594b3=await master_shop[_0x59dd04(0x114)]();console[_0x59dd04(0x107)](_0x59dd04(0x108),_0x3594b3),console[_0x59dd04(0x107)](_0x2f0350[_0x59dd04(0xd5)]['id']);const _0x484f15=await customer['findOne']({'_id':_0x2f0350[_0x59dd04(0xd5)]['id']});console['log'](_0x59dd04(0x103),_0x484f15);const _0x37710d=await c_payment_data[_0x59dd04(0x114)]({'customer':_0x484f15[_0x59dd04(0xc8)]});console['log'](_0x37710d);const _0xb41eef=await c_payment_data[_0x59dd04(0xe6)]([{'$match':{'customer':_0x484f15['name']}},{'$match':{'reason':_0x59dd04(0xd8)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x59dd04(0x106)}}}]);console['log']('payable_sum',_0xb41eef);const _0x9340bd=await c_payment_data[_0x59dd04(0xe6)]([{'$match':{'customer':_0x484f15[_0x59dd04(0xc8)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x59dd04(0xc5),'sum':{'$sum':_0x59dd04(0x106)}}}]);console['log'](_0x59dd04(0xdf),_0x9340bd);if(_0x3594b3[0x0]['language']==_0x59dd04(0xee)){var _0x378541=users[_0x59dd04(0x132)];console[_0x59dd04(0x107)](_0x378541);}else{if(_0x3594b3[0x0]['language']==_0x59dd04(0xef))var _0x378541=users[_0x59dd04(0xef)];else{if(_0x3594b3[0x0]['language']==_0x59dd04(0xe2))var _0x378541=users[_0x59dd04(0xe2)];else{if(_0x3594b3[0x0]['language']==_0x59dd04(0x118))var _0x378541=users[_0x59dd04(0x118)];else{if(_0x3594b3[0x0][_0x59dd04(0xed)]=='French')var _0x378541=users[_0x59dd04(0x12c)];else{if(_0x3594b3[0x0][_0x59dd04(0xed)]==_0x59dd04(0xff))var _0x378541=users[_0x59dd04(0xf7)];else{if(_0x3594b3[0x0][_0x59dd04(0xed)]==_0x59dd04(0x10f))var _0x378541=users[_0x59dd04(0x10f)];else{if(_0x3594b3[0x0]['language']=='Arabic\x20(ae)')var _0x378541=users[_0x59dd04(0x110)];}}}}}}}_0x4cf833['render'](_0x59dd04(0x12e),{'success':_0x2f0350['flash'](_0x59dd04(0xd4)),'errors':_0x2f0350['flash'](_0x59dd04(0xd2)),'role':_0x417fd2,'profile':_0x1ab0be,'payment':_0x37710d,'payable':_0xb41eef,'receivable':_0x9340bd,'master_shop':_0x3594b3,'language':_0x378541});}catch(_0x346791){console['log'](_0x346791);}}),router['get'](a0_0x433bcf(0xd1),auth,async(_0x210f4f,_0x51f23b)=>{const _0x7188bb=a0_0x433bcf;try{const _0x523be6=new excelJS[(_0x7188bb(0x100))](),_0x34cedb=_0x523be6[_0x7188bb(0xdb)](_0x7188bb(0x125));return _0x34cedb[_0x7188bb(0xde)]=[{'header':'ID','key':_0x7188bb(0x10e),'width':0xa},{'header':'Name','key':_0x7188bb(0x136),'width':0xa},{'header':_0x7188bb(0x12a),'key':_0x7188bb(0x126),'width':0xa},{'header':'SalesmanName','key':'SalesmanName','width':0xa},{'header':'address','key':'address','width':0xa},{'header':_0x7188bb(0x116),'key':_0x7188bb(0x116),'width':0xa},{'header':_0x7188bb(0xf3),'key':_0x7188bb(0xf3),'width':0xa}],_0x51f23b['setHeader'](_0x7188bb(0x113),_0x7188bb(0x10a)),_0x51f23b['setHeader'](_0x7188bb(0x115),_0x7188bb(0xe5)),_0x523be6[_0x7188bb(0x127)][_0x7188bb(0xca)](_0x51f23b)[_0x7188bb(0xdc)](()=>{const _0x552970=_0x7188bb;_0x51f23b[_0x552970(0xda)](0xc8);});}catch(_0x312cc4){_0x51f23b[_0x7188bb(0xda)](0x190)[_0x7188bb(0x11a)]({'errors':_0x312cc4['message']});}});const storage1=multer[a0_0x433bcf(0xe1)]({'destination':(_0x57e148,_0x14e7a2,_0x1171e1)=>{const _0x3519a2=a0_0x433bcf;_0x1171e1(null,_0x3519a2(0xf5));},'filename':(_0x44b634,_0xb7e17d,_0x235272)=>{const _0x24daf5=a0_0x433bcf;_0x235272(null,Date['now']()+_0xb7e17d[_0x24daf5(0xf2)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x563c(){const _0x1815f0=['credit_limit','8EybkJQ','multer','findOne','Portuguese\x20(BR)','Workbook','readFile','c_payments','customer_data','customer_sa','exports','$amount','log','master','map','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','20ZpjSEz','customer_docs','redirect','PName','Chinese','Arabic','receivable','../models/all_models','Content-Type','find','Content-Disposition','mobile','sheet_to_json','Spanish','body','send','utils','569080kAVRsE','landline','public/Migration/','/customer_import_migrate_file','10346WTPAcm','Arabic\x20(ae)','file','../middleware/auth','177052kYOqxx','Customers','PUnits','xlsx','Router','3390399plosLY','SalesmanCode','less_percent','French','customer_discount','customer_payment','express','business_start_year','282qAjvnT','English','less_percent_edit','message','307811IfiseB','PBrands','post','valueOf','$reason','sale','amount','name','/customer_sa/view','write','save','flash','exceljs','get','sale_return','../public/language/languages.json','/products_export_migrate_file','errors','forEach','success','params','element','customer_product_fule','Sale','res_address','status','addWorksheet','then','409413ChBLuT','columns','receivable_sum','render','diskStorage','German','809376GfQCmy','_id','attachment;\x20filename=customer_Migration_File.xlsx','aggregate','address','/view/:id','json','payable','/view','string','language','English\x20(US)','Hindi','customer\x20update\x20successfully','SalesmanName','originalname','email','customer','public/Migration','findById','Portuguese','\x20added\x20successfully','user','error'];a0_0x563c=function(){return _0x1815f0;};return a0_0x563c();}router[a0_0x433bcf(0x137)](a0_0x433bcf(0x11f),auth,uploadMigrate['single'](a0_0x433bcf(0xd7)),async(_0x569a48,_0x4d251e)=>{const _0x171275=a0_0x433bcf,_0x24f595=_0x569a48[_0x171275(0x122)]['filename'],_0x2ca5ce=await xlsx[_0x171275(0x101)](_0x171275(0x11e)+_0x24f595);let _0x492962=_0x2ca5ce['SheetNames'],_0x2643d5=xlsx[_0x171275(0x11b)][_0x171275(0x117)](_0x2ca5ce['Sheets'][_0x492962[0x0]]);for(const _0x34c4d2 of _0x2643d5){const _0x3f65b0=_0x34c4d2['ID'],_0x2fe73a=_0x34c4d2['Name'],_0xdcf3b4=_0x34c4d2[_0x171275(0x12a)],_0x52782b=_0x34c4d2[_0x171275(0xf1)],_0x30153c=_0x34c4d2[_0x171275(0xe7)],_0x564024=_0x34c4d2[_0x171275(0x116)],_0x4be7d8=_0x34c4d2[_0x171275(0xf3)];try{let _0x2f0ca3=await customer[_0x171275(0xfe)]({'name':_0x2fe73a});if(!_0x2f0ca3){const _0x41ba41=new customer({'name':_0x2fe73a,'ID':_0x3f65b0,'SalesmanCode':_0xdcf3b4,'SalesmanName':_0x52782b,'address':_0x30153c,'mobile':_0x564024,'email':_0x4be7d8});_0x2f0ca3=await _0x41ba41[_0x171275(0xcb)](),_0x569a48['flash'](_0x171275(0xd4),_0x2fe73a+_0x171275(0xf8));}else _0x569a48[_0x171275(0xcc)](_0x171275(0xfa),_0x2fe73a+'\x20Failed');}catch(_0x2378f5){_0x4d251e[_0x171275(0xda)](0x1f4)[_0x171275(0xe9)]({'proderror':_0x2378f5[_0x171275(0x134)],'aproduct':ProductName});}}_0x4d251e[_0x171275(0x10d)](_0x171275(0xc9));}),module[a0_0x433bcf(0x105)]=router;