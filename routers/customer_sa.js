const a0_0x1e9da3=a0_0x32a6;(function(_0xc606e7,_0x293220){const _0x2a63da=a0_0x32a6,_0x130fc1=_0xc606e7();while(!![]){try{const _0x3d8cb2=parseInt(_0x2a63da(0xcf))/0x1+-parseInt(_0x2a63da(0xf0))/0x2*(parseInt(_0x2a63da(0xf9))/0x3)+-parseInt(_0x2a63da(0x11e))/0x4*(-parseInt(_0x2a63da(0xb9))/0x5)+-parseInt(_0x2a63da(0xfb))/0x6*(parseInt(_0x2a63da(0xcb))/0x7)+parseInt(_0x2a63da(0x10b))/0x8+parseInt(_0x2a63da(0xd7))/0x9+-parseInt(_0x2a63da(0xbd))/0xa*(parseInt(_0x2a63da(0xed))/0xb);if(_0x3d8cb2===_0x293220)break;else _0x130fc1['push'](_0x130fc1['shift']());}catch(_0x206a2e){_0x130fc1['push'](_0x130fc1['shift']());}}}(a0_0x4087,0x6bf63));const express=require('express'),app=express(),router=express[a0_0x1e9da3(0x109)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x1e9da3(0xbe)),users=require(a0_0x1e9da3(0xdd)),excelJS=require(a0_0x1e9da3(0xb0)),xlsx=require(a0_0x1e9da3(0x101)),multer=require(a0_0x1e9da3(0x115));router[a0_0x1e9da3(0xf4)](a0_0x1e9da3(0xe1),auth,async(_0x5d1397,_0x5ddf97)=>{const _0x1470b2=a0_0x1e9da3;try{const {username:_0x525c8c,email:_0x2d19bf,role:_0x19acf9}=_0x5d1397[_0x1470b2(0xdc)],_0x34c512=_0x5d1397[_0x1470b2(0xdc)],_0x16c139=await profile[_0x1470b2(0xd0)]({'email':_0x34c512['email']}),_0x3b6be0=await master_shop[_0x1470b2(0x10c)](),_0x4b448c=await staff[_0x1470b2(0xd0)]({'email':_0x34c512[_0x1470b2(0xd4)]}),_0x3223bf=await customer[_0x1470b2(0x10c)]({'agent_id':_0x4b448c[_0x1470b2(0xf2)]}),_0x2dee76=await customer['aggregate']([{'$match':{'agent_id':_0x4b448c['_id'][_0x1470b2(0xc3)]()}},{'$lookup':{'from':_0x1470b2(0xf8),'localField':'name','foreignField':_0x1470b2(0x106),'as':_0x1470b2(0xc0)}}]),_0x2845c8=_0x2dee76['map'](_0x281034=>{const _0xe8c4d0=_0x1470b2;console[_0xe8c4d0(0x11a)](_0xe8c4d0(0xca),_0x281034);var _0x336ec8=0x0,_0x4f3824=0x0;return _0x281034[_0xe8c4d0(0xc0)][_0xe8c4d0(0x10f)](_0x5d0f64=>{const _0x4f619a=_0xe8c4d0;console[_0x4f619a(0x11a)]('element',_0x5d0f64),_0x5d0f64['reason']==_0x4f619a(0xbf)?_0x336ec8+=_0x5d0f64[_0x4f619a(0x122)]:_0x4f3824+=_0x5d0f64[_0x4f619a(0x122)];}),_0x281034[_0xe8c4d0(0xe4)]=parseFloat(_0x336ec8)+0x0,_0x281034[_0xe8c4d0(0x11d)]=parseFloat(_0x4f3824)+0x0,_0x281034;});if(_0x3b6be0[0x0][_0x1470b2(0xcd)]=='English\x20(US)'){var _0x1cb37b=users['English'];console[_0x1470b2(0x11a)](_0x1cb37b);}else{if(_0x3b6be0[0x0][_0x1470b2(0xcd)]==_0x1470b2(0x114))var _0x1cb37b=users[_0x1470b2(0x114)];else{if(_0x3b6be0[0x0]['language']==_0x1470b2(0xfa))var _0x1cb37b=users['German'];else{if(_0x3b6be0[0x0]['language']=='Spanish')var _0x1cb37b=users['Spanish'];else{if(_0x3b6be0[0x0][_0x1470b2(0xcd)]==_0x1470b2(0x103))var _0x1cb37b=users[_0x1470b2(0x103)];else{if(_0x3b6be0[0x0][_0x1470b2(0xcd)]==_0x1470b2(0xe3))var _0x1cb37b=users[_0x1470b2(0xe0)];else{if(_0x3b6be0[0x0][_0x1470b2(0xcd)]==_0x1470b2(0x112))var _0x1cb37b=users['Chinese'];else{if(_0x3b6be0[0x0][_0x1470b2(0xcd)]==_0x1470b2(0xc2))var _0x1cb37b=users['Arabic'];}}}}}}}_0x5ddf97[_0x1470b2(0xac)](_0x1470b2(0xf1),{'success':_0x5d1397[_0x1470b2(0xe2)]('success'),'errors':_0x5d1397[_0x1470b2(0xe2)](_0x1470b2(0x123)),'user':_0x3223bf,'role':_0x34c512,'profile':_0x16c139,'master_shop':_0x3b6be0,'language':_0x1cb37b,'agent_id':_0x4b448c[_0x1470b2(0xf2)],'payment':_0x2845c8,'staff_arr':_0x4b448c});}catch(_0x57e6f4){console[_0x1470b2(0x11a)](_0x57e6f4);}}),router[a0_0x1e9da3(0xd9)]('/view',auth,async(_0x5ce5ff,_0x973792)=>{const _0x557273=a0_0x1e9da3;try{const {name:_0x535404,address:_0x15625f,mobile:_0x15379a,email:_0x1226f5,receivable:_0x4bd6e8,payable:_0x46a621,contactperson:_0x5aca08,landline:_0x59e834,agent_id:_0x3e0e56,less_percent:_0x2ff01e,type_org:_0x1caca3,res_address:_0x4de9b6,business_start_year:_0x231196,credit_limit:_0x4697dd,term_pay:_0x171ce4}=_0x5ce5ff[_0x557273(0xd2)];if(typeof _0x2ff01e==_0x557273(0xd3))var _0x435dbf=[_0x5ce5ff[_0x557273(0xd2)][_0x557273(0xdb)]];else var _0x435dbf=[..._0x5ce5ff[_0x557273(0xd2)][_0x557273(0xdb)]];const _0x509eb3=_0x435dbf[_0x557273(0xff)](_0x29c583=>{return _0x29c583={'less':_0x29c583};}),_0x34c35d=new customer({'name':_0x535404,'address':_0x15625f,'mobile':_0x15379a,'email':_0x1226f5,'receivable':_0x4bd6e8,'payable':_0x46a621,'customer_discount':_0x509eb3,'contactperson':_0x5aca08,'landline':_0x59e834,'agent_id':_0x3e0e56,'res_address':_0x4de9b6,'type_organization':_0x1caca3,'business_start_year':_0x231196,'credit_limit':_0x4697dd,'terms_of_payments':_0x171ce4}),_0x454113=await _0x34c35d['save']();_0x5ce5ff[_0x557273(0xe2)](_0x557273(0xe9),_0x557273(0xc7)),_0x973792[_0x557273(0x108)]('/customer_sa/view');}catch(_0x4c35c9){console[_0x557273(0x11a)](_0x4c35c9);}}),router[a0_0x1e9da3(0xf4)](a0_0x1e9da3(0x11f),auth,async(_0x1e7c0f,_0x4dda54)=>{const _0x45a195=a0_0x1e9da3;try{const {username:_0x8479e8,email:_0x2926af,role:_0x29f8db}=_0x1e7c0f['user'],_0x32f901=_0x1e7c0f[_0x45a195(0xdc)],_0x4a0005=await profile['findOne']({'email':_0x32f901['email']}),_0x234c13=await master_shop[_0x45a195(0x10c)]();console[_0x45a195(0x11a)](_0x45a195(0xb6),_0x234c13);const _0x3d27c6=_0x1e7c0f[_0x45a195(0xc4)]['id'],_0x728511=await customer[_0x45a195(0xb3)](_0x3d27c6);console['log'](_0x728511);if(_0x234c13[0x0]['language']==_0x45a195(0xfd)){var _0x320b93=users[_0x45a195(0xf6)];console[_0x45a195(0x11a)](_0x320b93);}else{if(_0x234c13[0x0][_0x45a195(0xcd)]=='Hindi')var _0x320b93=users[_0x45a195(0x114)];else{if(_0x234c13[0x0][_0x45a195(0xcd)]=='German')var _0x320b93=users[_0x45a195(0xfa)];else{if(_0x234c13[0x0][_0x45a195(0xcd)]==_0x45a195(0x107))var _0x320b93=users['Spanish'];else{if(_0x234c13[0x0][_0x45a195(0xcd)]==_0x45a195(0x103))var _0x320b93=users[_0x45a195(0x103)];else{if(_0x234c13[0x0]['language']==_0x45a195(0xe3))var _0x320b93=users['Portuguese'];else{if(_0x234c13[0x0][_0x45a195(0xcd)]==_0x45a195(0x112))var _0x320b93=users[_0x45a195(0x112)];else{if(_0x234c13[0x0][_0x45a195(0xcd)]==_0x45a195(0xc2))var _0x320b93=users[_0x45a195(0xb1)];}}}}}}}_0x4dda54['render']('customer_sa',{'success':_0x1e7c0f[_0x45a195(0xe2)](_0x45a195(0xe9)),'errors':_0x1e7c0f['flash'](_0x45a195(0x123)),'role':_0x32f901,'profile':_0x4a0005,'user':_0x728511,'master_shop':_0x234c13,'language':_0x320b93});}catch(_0x17e05f){console['log'](_0x17e05f);}}),router[a0_0x1e9da3(0xd9)](a0_0x1e9da3(0x11f),auth,async(_0x2b326f,_0x2d0908)=>{const _0xe38c31=a0_0x1e9da3;try{const _0x2928a5=_0x2b326f[_0xe38c31(0xc4)]['id'],_0x580499=await customer['findById'](_0x2928a5),{name:_0x4e6ebc,address:_0x5ac81a,mobile:_0x594099,email:_0x1fd5f0,receivable:_0x1c0b0e,payable:_0x9a3e07,contactperson:_0x2de5ec,landline:_0x2ceb19,less_percent_edit:_0x29f961,edit_type_org:_0x32d9a5,edit_res_address:_0x80bcbc,edit_business_start_year:_0x2bc576,edit_credit_limit:_0x5a6295,edit_term_pay:_0x48660e}=_0x2b326f['body'];if(typeof _0x29f961==_0xe38c31(0xd3))var _0xffb8fb=[_0x2b326f[_0xe38c31(0xd2)][_0xe38c31(0xfe)]];else var _0xffb8fb=[..._0x2b326f[_0xe38c31(0xd2)][_0xe38c31(0xfe)]];const _0x230938=_0xffb8fb[_0xe38c31(0xff)](_0x3be4b8=>{return _0x3be4b8={'less':_0x3be4b8};});_0x580499['name']=_0x4e6ebc,_0x580499['address']=_0x5ac81a,_0x580499[_0xe38c31(0xbb)]=_0x594099,_0x580499[_0xe38c31(0xd4)]=_0x1fd5f0,_0x580499[_0xe38c31(0x10d)]=_0x1c0b0e,_0x580499[_0xe38c31(0xde)]=_0x9a3e07,_0x580499[_0xe38c31(0xee)]=_0x2de5ec,_0x580499[_0xe38c31(0xba)]=_0x2ceb19,_0x580499[_0xe38c31(0xd8)]=_0x230938,_0x580499[_0xe38c31(0x10a)]=_0x32d9a5,_0x580499[_0xe38c31(0xce)]=_0x2bc576,_0x580499[_0xe38c31(0xf7)]=_0x5a6295,_0x580499[_0xe38c31(0xb4)]=_0x48660e,_0x580499[_0xe38c31(0xbc)]=_0x80bcbc;const _0x3c9a03=await _0x580499[_0xe38c31(0xad)]();_0x2b326f[_0xe38c31(0xe2)](_0xe38c31(0xe9),'customer\x20update\x20successfully'),_0x2d0908[_0xe38c31(0x108)](_0xe38c31(0xea));}catch(_0x1a9950){console['log'](_0x1a9950);}}),router[a0_0x1e9da3(0xf4)]('/view/payment/:id',auth,async(_0x385e6c,_0x4739bf)=>{const _0x270116=a0_0x1e9da3;try{const {username:_0xf29940,email:_0x293d08,role:_0x54bf88}=_0x385e6c[_0x270116(0xdc)],_0x486b9c=_0x385e6c[_0x270116(0xdc)],_0x238d9f=await profile[_0x270116(0xd0)]({'email':_0x486b9c[_0x270116(0xd4)]}),_0x21dd38=await master_shop[_0x270116(0x10c)]();console[_0x270116(0x11a)]('master',_0x21dd38),console['log'](_0x385e6c[_0x270116(0xc4)]['id']);const _0x26e87f=await customer[_0x270116(0xd0)]({'_id':_0x385e6c[_0x270116(0xc4)]['id']});console[_0x270116(0x11a)](_0x270116(0xd1),_0x26e87f);const _0xcdacfe=await c_payment_data['find']({'customer':_0x26e87f[_0x270116(0xaf)]});console[_0x270116(0x11a)](_0xcdacfe);const _0x1e9750=await c_payment_data['aggregate']([{'$match':{'customer':_0x26e87f[_0x270116(0xaf)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x270116(0xb7),'sum':{'$sum':'$amount'}}}]);console[_0x270116(0x11a)](_0x270116(0xe6),_0x1e9750);const _0x412fa9=await c_payment_data[_0x270116(0xc6)]([{'$match':{'customer':_0x26e87f['name']}},{'$match':{'reason':_0x270116(0xb2)}},{'$group':{'_id':_0x270116(0xb7),'sum':{'$sum':_0x270116(0xf5)}}}]);console[_0x270116(0x11a)](_0x270116(0xf3),_0x412fa9);if(_0x21dd38[0x0][_0x270116(0xcd)]==_0x270116(0xfd)){var _0xdb4deb=users['English'];console['log'](_0xdb4deb);}else{if(_0x21dd38[0x0]['language']==_0x270116(0x114))var _0xdb4deb=users['Hindi'];else{if(_0x21dd38[0x0][_0x270116(0xcd)]==_0x270116(0xfa))var _0xdb4deb=users[_0x270116(0xfa)];else{if(_0x21dd38[0x0][_0x270116(0xcd)]=='Spanish')var _0xdb4deb=users['Spanish'];else{if(_0x21dd38[0x0][_0x270116(0xcd)]==_0x270116(0x103))var _0xdb4deb=users[_0x270116(0x103)];else{if(_0x21dd38[0x0][_0x270116(0xcd)]==_0x270116(0xe3))var _0xdb4deb=users[_0x270116(0xe0)];else{if(_0x21dd38[0x0]['language']==_0x270116(0x112))var _0xdb4deb=users['Chinese'];else{if(_0x21dd38[0x0][_0x270116(0xcd)]==_0x270116(0xc2))var _0xdb4deb=users[_0x270116(0xb1)];}}}}}}}_0x4739bf[_0x270116(0xac)]('customer_payment',{'success':_0x385e6c[_0x270116(0xe2)](_0x270116(0xe9)),'errors':_0x385e6c['flash']('errors'),'role':_0x486b9c,'profile':_0x238d9f,'payment':_0xcdacfe,'payable':_0x1e9750,'receivable':_0x412fa9,'master_shop':_0x21dd38,'language':_0xdb4deb});}catch(_0x3d5cc3){console[_0x270116(0x11a)](_0x3d5cc3);}}),router[a0_0x1e9da3(0xf4)]('/products_export_migrate_file',auth,async(_0x22312c,_0x32fa7a)=>{const _0x218ae7=a0_0x1e9da3;try{const _0x518731=new excelJS[(_0x218ae7(0xc8))](),_0x1dea97=_0x518731['addWorksheet'](_0x218ae7(0x100));return _0x1dea97[_0x218ae7(0xe5)]=[{'header':'ID','key':_0x218ae7(0x11b),'width':0xa},{'header':'Name','key':'PBrands','width':0xa},{'header':_0x218ae7(0xcc),'key':_0x218ae7(0xd5),'width':0xa},{'header':_0x218ae7(0x120),'key':_0x218ae7(0x120),'width':0xa},{'header':_0x218ae7(0x104),'key':_0x218ae7(0x104),'width':0xa},{'header':_0x218ae7(0xbb),'key':_0x218ae7(0xbb),'width':0xa},{'header':_0x218ae7(0xd4),'key':_0x218ae7(0xd4),'width':0xa}],_0x32fa7a[_0x218ae7(0xd6)]('Content-Type',_0x218ae7(0xae)),_0x32fa7a[_0x218ae7(0xd6)](_0x218ae7(0x113),_0x218ae7(0xef)),_0x518731['xlsx']['write'](_0x32fa7a)[_0x218ae7(0x121)](()=>{const _0x4a266=_0x218ae7;_0x32fa7a[_0x4a266(0x117)](0xc8);});}catch(_0x1245b1){_0x32fa7a['status'](0x190)[_0x218ae7(0xda)]({'errors':_0x1245b1['message']});}});const storage1=multer[a0_0x1e9da3(0xdf)]({'destination':(_0x27f6ff,_0x2c6410,_0x3cf252)=>{const _0x3a7329=a0_0x1e9da3;_0x3cf252(null,_0x3a7329(0xc5));},'filename':(_0x60955,_0x16dfc7,_0x171fe2)=>{const _0x4c7107=a0_0x1e9da3;_0x171fe2(null,Date[_0x4c7107(0xb5)]()+_0x16dfc7['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0x32a6(_0x55d08b,_0xfd7165){const _0x4087e0=a0_0x4087();return a0_0x32a6=function(_0x32a60c,_0x4582b3){_0x32a60c=_0x32a60c-0xac;let _0x3c8d3f=_0x4087e0[_0x32a60c];return _0x3c8d3f;},a0_0x32a6(_0x55d08b,_0xfd7165);}function a0_0x4087(){const _0x958329=['business_start_year','658164TjWBLw','findOne','customer_data','body','string','email','PUnits','setHeader','5573205kBREna','customer_discount','post','send','less_percent','user','../public/language/languages.json','payable','diskStorage','Portuguese','/view','flash','Portuguese\x20(BR)','sale','columns','payable_sum','Sheets','Name','success','/customer_sa/view','error','/customer_import_migrate_file','15940397QrOgnt','contactperson','attachment;\x20filename=customer_Migration_File.xlsx','43288QFlAcz','customer_sa','_id','receivable_sum','get','$amount','English','credit_limit','c_payments','12HVZHRA','German','48KxasnR','json','English\x20(US)','less_percent_edit','map','Customers','xlsx','SheetNames','French','address','customer_product_fule','customer','Spanish','redirect','Router','type_organization','1468320RvSCCy','find','receivable','public/Migration/','forEach','exports','utils','Chinese','Content-Disposition','Hindi','multer','single','status','\x20added\x20successfully','file','log','PName','sheet_to_json','sale_return','12ltxuLw','/view/:id','SalesmanName','then','amount','errors','render','save','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','name','exceljs','Arabic','Sale\x20Return','findById','terms_of_payments','now','master','$reason','\x20Failed','1022555RLZlCI','landline','mobile','res_address','10TeaQav','../middleware/auth','Sale','customer_docs','message','Arabic\x20(ae)','valueOf','params','public/Migration','aggregate','customer\x20add\x20successfully','Workbook','readFile','data','84497vqwVZx','SalesmanCode','language'];a0_0x4087=function(){return _0x958329;};return a0_0x4087();}router['post'](a0_0x1e9da3(0xec),auth,uploadMigrate[a0_0x1e9da3(0x116)](a0_0x1e9da3(0x105)),async(_0x362e70,_0x16b4f1)=>{const _0x4c96ab=a0_0x1e9da3,_0x573be9=_0x362e70[_0x4c96ab(0x119)]['filename'],_0x170e8d=await xlsx[_0x4c96ab(0xc9)](_0x4c96ab(0x10e)+_0x573be9);let _0x12c765=_0x170e8d[_0x4c96ab(0x102)],_0x501216=xlsx[_0x4c96ab(0x111)][_0x4c96ab(0x11c)](_0x170e8d[_0x4c96ab(0xe7)][_0x12c765[0x0]]);for(const _0x5b8ea5 of _0x501216){const _0x2ef0a6=_0x5b8ea5['ID'],_0x4354df=_0x5b8ea5[_0x4c96ab(0xe8)],_0x230675=_0x5b8ea5[_0x4c96ab(0xcc)],_0x20db94=_0x5b8ea5[_0x4c96ab(0x120)],_0x3da1e=_0x5b8ea5[_0x4c96ab(0x104)],_0x1fa5fe=_0x5b8ea5[_0x4c96ab(0xbb)],_0x1379b0=_0x5b8ea5[_0x4c96ab(0xd4)];try{let _0x5a4aa8=await customer[_0x4c96ab(0xd0)]({'name':_0x4354df});if(!_0x5a4aa8){const _0x1f6f07=new customer({'name':_0x4354df,'ID':_0x2ef0a6,'SalesmanCode':_0x230675,'SalesmanName':_0x20db94,'address':_0x3da1e,'mobile':_0x1fa5fe,'email':_0x1379b0});_0x5a4aa8=await _0x1f6f07[_0x4c96ab(0xad)](),_0x362e70[_0x4c96ab(0xe2)]('success',_0x4354df+_0x4c96ab(0x118));}else _0x362e70[_0x4c96ab(0xe2)](_0x4c96ab(0xeb),_0x4354df+_0x4c96ab(0xb8));}catch(_0x3d06ee){_0x16b4f1[_0x4c96ab(0x117)](0x1f4)[_0x4c96ab(0xfc)]({'proderror':_0x3d06ee[_0x4c96ab(0xc1)],'aproduct':ProductName});}}_0x16b4f1[_0x4c96ab(0x108)](_0x4c96ab(0xea));}),module[a0_0x1e9da3(0x110)]=router;