const a0_0x5d23c4=a0_0x1124;function a0_0x1124(_0xd08a4a,_0x3cfeb1){const _0x287b85=a0_0x287b();return a0_0x1124=function(_0x1124da,_0x31385c){_0x1124da=_0x1124da-0x74;let _0x17bbe7=_0x287b85[_0x1124da];return _0x17bbe7;},a0_0x1124(_0xd08a4a,_0x3cfeb1);}(function(_0x2fad55,_0x5b0f70){const _0x4a5b56=a0_0x1124,_0x173e8f=_0x2fad55();while(!![]){try{const _0x380a02=-parseInt(_0x4a5b56(0xc9))/0x1*(-parseInt(_0x4a5b56(0xde))/0x2)+-parseInt(_0x4a5b56(0x78))/0x3*(-parseInt(_0x4a5b56(0x84))/0x4)+-parseInt(_0x4a5b56(0xb6))/0x5+parseInt(_0x4a5b56(0x7a))/0x6*(parseInt(_0x4a5b56(0x9a))/0x7)+parseInt(_0x4a5b56(0x75))/0x8+-parseInt(_0x4a5b56(0xd2))/0x9+-parseInt(_0x4a5b56(0x7f))/0xa;if(_0x380a02===_0x5b0f70)break;else _0x173e8f['push'](_0x173e8f['shift']());}catch(_0x202b7f){_0x173e8f['push'](_0x173e8f['shift']());}}}(a0_0x287b,0x27cb2));const express=require(a0_0x5d23c4(0xcd)),app=express(),router=express[a0_0x5d23c4(0xbe)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x5d23c4(0x88)),users=require(a0_0x5d23c4(0xbd)),excelJS=require('exceljs'),xlsx=require('xlsx'),multer=require('multer');router['get'](a0_0x5d23c4(0xb3),auth,async(_0x9f897a,_0x1778b9)=>{const _0x25d3a2=a0_0x5d23c4;try{const {username:_0x37b5ab,email:_0x20eed8,role:_0x1f10d5}=_0x9f897a['user'],_0x52a756=_0x9f897a[_0x25d3a2(0xbb)],_0x1be4bf=await profile['findOne']({'email':_0x52a756[_0x25d3a2(0xd6)]}),_0x118023=await master_shop['find'](),_0x239bc8=await staff[_0x25d3a2(0x95)]({'email':_0x52a756[_0x25d3a2(0xd6)]}),_0x1ec6a6=await customer[_0x25d3a2(0x7b)]({'agent_id':_0x239bc8[_0x25d3a2(0x8f)]}),_0x231c85=await customer['aggregate']([{'$match':{'agent_id':_0x239bc8['_id'][_0x25d3a2(0xa7)]()}},{'$lookup':{'from':_0x25d3a2(0xe3),'localField':_0x25d3a2(0xa5),'foreignField':_0x25d3a2(0x8d),'as':'customer_docs'}}]),_0x39d03c=_0x231c85[_0x25d3a2(0xb5)](_0x5f2dd2=>{const _0x1532a8=_0x25d3a2;console[_0x1532a8(0x77)](_0x1532a8(0xe1),_0x5f2dd2);var _0xf9e724=0x0,_0x192196=0x0;return _0x5f2dd2[_0x1532a8(0x8e)][_0x1532a8(0x9e)](_0x2e3b24=>{const _0x103019=_0x1532a8;console[_0x103019(0x77)](_0x103019(0x86),_0x2e3b24),_0x2e3b24[_0x103019(0xcc)]=='Sale'?_0xf9e724+=_0x2e3b24['amount']:_0x192196+=_0x2e3b24[_0x103019(0xbc)];}),_0x5f2dd2[_0x1532a8(0xd9)]=parseFloat(_0xf9e724)+0x0,_0x5f2dd2['sale_return']=parseFloat(_0x192196)+0x0,_0x5f2dd2;});if(_0x118023[0x0]['language']==_0x25d3a2(0x97)){var _0x13e9d7=users[_0x25d3a2(0x7d)];console[_0x25d3a2(0x77)](_0x13e9d7);}else{if(_0x118023[0x0]['language']=='Hindi')var _0x13e9d7=users['Hindi'];else{if(_0x118023[0x0][_0x25d3a2(0xb9)]==_0x25d3a2(0x8a))var _0x13e9d7=users[_0x25d3a2(0x8a)];else{if(_0x118023[0x0][_0x25d3a2(0xb9)]==_0x25d3a2(0xaa))var _0x13e9d7=users[_0x25d3a2(0xaa)];else{if(_0x118023[0x0][_0x25d3a2(0xb9)]==_0x25d3a2(0xdb))var _0x13e9d7=users[_0x25d3a2(0xdb)];else{if(_0x118023[0x0][_0x25d3a2(0xb9)]==_0x25d3a2(0xb0))var _0x13e9d7=users['Portuguese'];else{if(_0x118023[0x0][_0x25d3a2(0xb9)]==_0x25d3a2(0xc8))var _0x13e9d7=users['Chinese'];else{if(_0x118023[0x0][_0x25d3a2(0xb9)]=='Arabic\x20(ae)')var _0x13e9d7=users[_0x25d3a2(0xa3)];}}}}}}}_0x1778b9[_0x25d3a2(0xc2)](_0x25d3a2(0x94),{'success':_0x9f897a[_0x25d3a2(0xda)](_0x25d3a2(0xd4)),'errors':_0x9f897a[_0x25d3a2(0xda)]('errors'),'user':_0x1ec6a6,'role':_0x52a756,'profile':_0x1be4bf,'master_shop':_0x118023,'language':_0x13e9d7,'agent_id':_0x239bc8[_0x25d3a2(0x8f)],'payment':_0x39d03c,'staff_arr':_0x239bc8});}catch(_0x11b785){console[_0x25d3a2(0x77)](_0x11b785);}}),router[a0_0x5d23c4(0xb1)]('/view',auth,async(_0x5e6280,_0x5d3e08)=>{const _0x12e15b=a0_0x5d23c4;try{const {name:_0x1286d4,address:_0x3cb8d8,mobile:_0x3d2cba,email:_0x2570e4,receivable:_0x238a94,payable:_0xbf844,contactperson:_0x5958a6,landline:_0x3ac5e0,agent_id:_0x3acbe2,less_percent:_0x57a175,type_org:_0x5b088c,res_address:_0x55131b,business_start_year:_0x56c34f,credit_limit:_0x649a9f,term_pay:_0x15e17f}=_0x5e6280[_0x12e15b(0x91)];if(typeof _0x57a175==_0x12e15b(0xb4))var _0x9a4307=[_0x5e6280[_0x12e15b(0x91)][_0x12e15b(0xdd)]];else var _0x9a4307=[..._0x5e6280[_0x12e15b(0x91)][_0x12e15b(0xdd)]];const _0xd160a7=_0x9a4307['map'](_0x35271e=>{return _0x35271e={'less':_0x35271e};}),_0x22202c=new customer({'name':_0x1286d4,'address':_0x3cb8d8,'mobile':_0x3d2cba,'email':_0x2570e4,'receivable':_0x238a94,'payable':_0xbf844,'customer_discount':_0xd160a7,'contactperson':_0x5958a6,'landline':_0x3ac5e0,'agent_id':_0x3acbe2,'res_address':_0x55131b,'type_organization':_0x5b088c,'business_start_year':_0x56c34f,'credit_limit':_0x649a9f,'terms_of_payments':_0x15e17f}),_0x181adc=await _0x22202c[_0x12e15b(0xbf)]();_0x5e6280[_0x12e15b(0xda)]('success',_0x12e15b(0xd0)),_0x5d3e08['redirect'](_0x12e15b(0xca));}catch(_0x3fbf62){console[_0x12e15b(0x77)](_0x3fbf62);}}),router[a0_0x5d23c4(0x80)](a0_0x5d23c4(0xc7),auth,async(_0x4336fc,_0xbeb2f1)=>{const _0x4c623f=a0_0x5d23c4;try{const {username:_0x388cd5,email:_0x28d3cc,role:_0x466778}=_0x4336fc[_0x4c623f(0xbb)],_0x16df61=_0x4336fc[_0x4c623f(0xbb)],_0x2521ea=await profile[_0x4c623f(0x95)]({'email':_0x16df61[_0x4c623f(0xd6)]}),_0x2d3667=await master_shop[_0x4c623f(0x7b)]();console['log']('master',_0x2d3667);const _0x4498a8=_0x4336fc[_0x4c623f(0xdc)]['id'],_0x1be84d=await customer[_0x4c623f(0xc0)](_0x4498a8);console[_0x4c623f(0x77)](_0x1be84d);if(_0x2d3667[0x0][_0x4c623f(0xb9)]==_0x4c623f(0x97)){var _0x52678d=users['English'];console[_0x4c623f(0x77)](_0x52678d);}else{if(_0x2d3667[0x0][_0x4c623f(0xb9)]==_0x4c623f(0xc5))var _0x52678d=users[_0x4c623f(0xc5)];else{if(_0x2d3667[0x0][_0x4c623f(0xb9)]=='German')var _0x52678d=users[_0x4c623f(0x8a)];else{if(_0x2d3667[0x0][_0x4c623f(0xb9)]==_0x4c623f(0xaa))var _0x52678d=users['Spanish'];else{if(_0x2d3667[0x0][_0x4c623f(0xb9)]==_0x4c623f(0xdb))var _0x52678d=users['French'];else{if(_0x2d3667[0x0]['language']==_0x4c623f(0xb0))var _0x52678d=users['Portuguese'];else{if(_0x2d3667[0x0][_0x4c623f(0xb9)]==_0x4c623f(0xc8))var _0x52678d=users[_0x4c623f(0xc8)];else{if(_0x2d3667[0x0][_0x4c623f(0xb9)]==_0x4c623f(0xc1))var _0x52678d=users['Arabic'];}}}}}}}_0xbeb2f1[_0x4c623f(0xc2)](_0x4c623f(0x94),{'success':_0x4336fc['flash']('success'),'errors':_0x4336fc['flash'](_0x4c623f(0xa0)),'role':_0x16df61,'profile':_0x2521ea,'user':_0x1be84d,'master_shop':_0x2d3667,'language':_0x52678d});}catch(_0x50087a){console[_0x4c623f(0x77)](_0x50087a);}}),router['post'](a0_0x5d23c4(0xc7),auth,async(_0x4b42d9,_0x2e25dd)=>{const _0x106f91=a0_0x5d23c4;try{const _0x4e0c3c=_0x4b42d9[_0x106f91(0xdc)]['id'],_0xa647e7=await customer['findById'](_0x4e0c3c),{name:_0x1f6dd7,address:_0x16c79b,mobile:_0x424697,email:_0x8d652c,receivable:_0x235b93,payable:_0x31d41e,contactperson:_0xde9003,landline:_0x1a8a03,less_percent_edit:_0x83db17,edit_type_org:_0x49fbc3,edit_res_address:_0x3e6323,edit_business_start_year:_0x5d6467,edit_credit_limit:_0x5d358e,edit_term_pay:_0xce9bbc}=_0x4b42d9[_0x106f91(0x91)];if(typeof _0x83db17==_0x106f91(0xb4))var _0x19adb2=[_0x4b42d9[_0x106f91(0x91)][_0x106f91(0x9f)]];else var _0x19adb2=[..._0x4b42d9[_0x106f91(0x91)][_0x106f91(0x9f)]];const _0x3a34ce=_0x19adb2[_0x106f91(0xb5)](_0x57ac=>{return _0x57ac={'less':_0x57ac};});_0xa647e7[_0x106f91(0xa5)]=_0x1f6dd7,_0xa647e7[_0x106f91(0xa1)]=_0x16c79b,_0xa647e7[_0x106f91(0x90)]=_0x424697,_0xa647e7['email']=_0x8d652c,_0xa647e7['receivable']=_0x235b93,_0xa647e7[_0x106f91(0xa4)]=_0x31d41e,_0xa647e7[_0x106f91(0x8c)]=_0xde9003,_0xa647e7['landline']=_0x1a8a03,_0xa647e7[_0x106f91(0x76)]=_0x3a34ce,_0xa647e7[_0x106f91(0x7e)]=_0x49fbc3,_0xa647e7[_0x106f91(0xe2)]=_0x5d6467,_0xa647e7['credit_limit']=_0x5d358e,_0xa647e7[_0x106f91(0xb8)]=_0xce9bbc,_0xa647e7[_0x106f91(0x89)]=_0x3e6323;const _0x3505fc=await _0xa647e7[_0x106f91(0xbf)]();_0x4b42d9[_0x106f91(0xda)]('success','customer\x20update\x20successfully'),_0x2e25dd['redirect'](_0x106f91(0xca));}catch(_0x5634c0){console[_0x106f91(0x77)](_0x5634c0);}}),router[a0_0x5d23c4(0x80)]('/view/payment/:id',auth,async(_0x59e5a3,_0x4dc8b9)=>{const _0x368166=a0_0x5d23c4;try{const {username:_0x2668e4,email:_0x10bc25,role:_0x219c14}=_0x59e5a3[_0x368166(0xbb)],_0x33be53=_0x59e5a3[_0x368166(0xbb)],_0x1acfb3=await profile[_0x368166(0x95)]({'email':_0x33be53[_0x368166(0xd6)]}),_0x50dc38=await master_shop[_0x368166(0x7b)]();console[_0x368166(0x77)]('master',_0x50dc38),console[_0x368166(0x77)](_0x59e5a3[_0x368166(0xdc)]['id']);const _0x37e955=await customer[_0x368166(0x95)]({'_id':_0x59e5a3[_0x368166(0xdc)]['id']});console[_0x368166(0x77)](_0x368166(0xa8),_0x37e955);const _0x248e8d=await c_payment_data[_0x368166(0x7b)]({'customer':_0x37e955[_0x368166(0xa5)]});console[_0x368166(0x77)](_0x248e8d);const _0x3a8595=await c_payment_data['aggregate']([{'$match':{'customer':_0x37e955[_0x368166(0xa5)]}},{'$match':{'reason':_0x368166(0xdf)}},{'$group':{'_id':_0x368166(0xb2),'sum':{'$sum':'$amount'}}}]);console[_0x368166(0x77)](_0x368166(0xcb),_0x3a8595);const _0x560bb9=await c_payment_data[_0x368166(0xae)]([{'$match':{'customer':_0x37e955[_0x368166(0xa5)]}},{'$match':{'reason':_0x368166(0xa6)}},{'$group':{'_id':_0x368166(0xb2),'sum':{'$sum':_0x368166(0xba)}}}]);console['log'](_0x368166(0xd5),_0x560bb9);if(_0x50dc38[0x0]['language']==_0x368166(0x97)){var _0x25e6bf=users[_0x368166(0x7d)];console[_0x368166(0x77)](_0x25e6bf);}else{if(_0x50dc38[0x0][_0x368166(0xb9)]==_0x368166(0xc5))var _0x25e6bf=users[_0x368166(0xc5)];else{if(_0x50dc38[0x0][_0x368166(0xb9)]=='German')var _0x25e6bf=users[_0x368166(0x8a)];else{if(_0x50dc38[0x0][_0x368166(0xb9)]==_0x368166(0xaa))var _0x25e6bf=users[_0x368166(0xaa)];else{if(_0x50dc38[0x0][_0x368166(0xb9)]=='French')var _0x25e6bf=users[_0x368166(0xdb)];else{if(_0x50dc38[0x0][_0x368166(0xb9)]==_0x368166(0xb0))var _0x25e6bf=users[_0x368166(0x81)];else{if(_0x50dc38[0x0][_0x368166(0xb9)]==_0x368166(0xc8))var _0x25e6bf=users[_0x368166(0xc8)];else{if(_0x50dc38[0x0][_0x368166(0xb9)]==_0x368166(0xc1))var _0x25e6bf=users['Arabic'];}}}}}}}_0x4dc8b9[_0x368166(0xc2)](_0x368166(0xaf),{'success':_0x59e5a3[_0x368166(0xda)](_0x368166(0xd4)),'errors':_0x59e5a3[_0x368166(0xda)](_0x368166(0xa0)),'role':_0x33be53,'profile':_0x1acfb3,'payment':_0x248e8d,'payable':_0x3a8595,'receivable':_0x560bb9,'master_shop':_0x50dc38,'language':_0x25e6bf});}catch(_0x1685e5){console['log'](_0x1685e5);}}),router['get'](a0_0x5d23c4(0xad),auth,async(_0x283f5e,_0x5c4e5b)=>{const _0x2e950e=a0_0x5d23c4;try{const _0x4e024e=new excelJS['Workbook'](),_0x1f8dec=_0x4e024e[_0x2e950e(0xb7)](_0x2e950e(0x74));return _0x1f8dec[_0x2e950e(0x7c)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x2e950e(0xa2),'key':_0x2e950e(0xce),'width':0xa},{'header':'SalesmanCode','key':_0x2e950e(0xac),'width':0xa},{'header':_0x2e950e(0xe0),'key':_0x2e950e(0xe0),'width':0xa},{'header':_0x2e950e(0xa1),'key':_0x2e950e(0xa1),'width':0xa},{'header':_0x2e950e(0x90),'key':_0x2e950e(0x90),'width':0xa},{'header':_0x2e950e(0xd6),'key':'email','width':0xa}],_0x5c4e5b['setHeader'](_0x2e950e(0xc6),_0x2e950e(0x99)),_0x5c4e5b['setHeader'](_0x2e950e(0xab),_0x2e950e(0x92)),_0x4e024e['xlsx'][_0x2e950e(0xc4)](_0x5c4e5b)['then'](()=>{const _0x583221=_0x2e950e;_0x5c4e5b[_0x583221(0x85)](0xc8);});}catch(_0x2f3677){_0x5c4e5b[_0x2e950e(0x85)](0x190)[_0x2e950e(0x87)]({'errors':_0x2f3677[_0x2e950e(0x9c)]});}});const storage1=multer[a0_0x5d23c4(0xd8)]({'destination':(_0x42baff,_0x4e977d,_0x3c9952)=>{const _0x2bd36c=a0_0x5d23c4;_0x3c9952(null,_0x2bd36c(0xc3));},'filename':(_0x2b6afc,_0x59e4b7,_0x79a30c)=>{const _0x51acac=a0_0x5d23c4;_0x79a30c(null,Date[_0x51acac(0x83)]()+_0x59e4b7[_0x51acac(0x98)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x5d23c4(0xb1)](a0_0x5d23c4(0xcf),auth,uploadMigrate[a0_0x5d23c4(0xd7)](a0_0x5d23c4(0xa9)),async(_0x238ee0,_0x4a219a)=>{const _0x1f430b=a0_0x5d23c4,_0x5441d9=_0x238ee0[_0x1f430b(0x82)]['filename'],_0x33d63c=await xlsx['readFile']('public/Migration/'+_0x5441d9);let _0x44456a=_0x33d63c['SheetNames'],_0x3ad8d7=xlsx[_0x1f430b(0xe4)][_0x1f430b(0x93)](_0x33d63c[_0x1f430b(0x8b)][_0x44456a[0x0]]);for(const _0x3f683f of _0x3ad8d7){const _0x59839d=_0x3f683f['ID'],_0xc8fbeb=_0x3f683f[_0x1f430b(0xa2)],_0x3ff7d0=_0x3f683f[_0x1f430b(0x96)],_0x4e22c1=_0x3f683f[_0x1f430b(0xe0)],_0x32835b=_0x3f683f[_0x1f430b(0xa1)],_0x153e72=_0x3f683f['mobile'],_0xe7a1ac=_0x3f683f[_0x1f430b(0xd6)];try{let _0x167140=await customer['findOne']({'name':_0xc8fbeb});if(!_0x167140){const _0x22afba=new customer({'name':_0xc8fbeb,'ID':_0x59839d,'SalesmanCode':_0x3ff7d0,'SalesmanName':_0x4e22c1,'address':_0x32835b,'mobile':_0x153e72,'email':_0xe7a1ac});_0x167140=await _0x22afba['save'](),_0x238ee0[_0x1f430b(0xda)](_0x1f430b(0xd4),_0xc8fbeb+_0x1f430b(0x9b));}else _0x238ee0[_0x1f430b(0xda)](_0x1f430b(0x9d),_0xc8fbeb+_0x1f430b(0x79));}catch(_0x4363a2){_0x4a219a['status'](0x1f4)['json']({'proderror':_0x4363a2[_0x1f430b(0x9c)],'aproduct':ProductName});}}_0x4a219a[_0x1f430b(0xd1)]('/customer_sa/view');}),module[a0_0x5d23c4(0xd3)]=router;function a0_0x287b(){const _0x4b338d=['485730JWbhaE','\x20Failed','1842OOBMlV','find','columns','English','type_organization','4672430byjYHg','get','Portuguese','file','now','8UJnwzq','status','element','send','../middleware/auth','res_address','German','Sheets','contactperson','customer','customer_docs','_id','mobile','body','attachment;\x20filename=customer_Migration_File.xlsx','sheet_to_json','customer_sa','findOne','SalesmanCode','English\x20(US)','originalname','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','1981wuktyk','\x20added\x20successfully','message','error','forEach','less_percent_edit','errors','address','Name','Arabic','payable','name','Sale\x20Return','valueOf','customer_data','customer_product_fule','Spanish','Content-Disposition','PUnits','/products_export_migrate_file','aggregate','customer_payment','Portuguese\x20(BR)','post','$reason','/view','string','map','832625AQEJon','addWorksheet','terms_of_payments','language','$amount','user','amount','../public/language/languages.json','Router','save','findById','Arabic\x20(ae)','render','public/Migration','write','Hindi','Content-Type','/view/:id','Chinese','62374kBncUy','/customer_sa/view','payable_sum','reason','express','PBrands','/customer_import_migrate_file','customer\x20add\x20successfully','redirect','402174qqICem','exports','success','receivable_sum','email','single','diskStorage','sale','flash','French','params','less_percent','8TadJQB','Sale','SalesmanName','data','business_start_year','c_payments','utils','Customers','1450008FnzheG','customer_discount','log'];a0_0x287b=function(){return _0x4b338d;};return a0_0x287b();}