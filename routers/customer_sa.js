const a0_0x57aa93=a0_0x4caa;(function(_0x45a931,_0x12ba88){const _0xca054f=a0_0x4caa,_0x396b16=_0x45a931();while(!![]){try{const _0x489447=parseInt(_0xca054f(0xc7))/0x1*(parseInt(_0xca054f(0xb9))/0x2)+-parseInt(_0xca054f(0xca))/0x3+parseInt(_0xca054f(0xd0))/0x4+parseInt(_0xca054f(0x87))/0x5+-parseInt(_0xca054f(0x82))/0x6+-parseInt(_0xca054f(0x9e))/0x7*(-parseInt(_0xca054f(0x96))/0x8)+-parseInt(_0xca054f(0x91))/0x9;if(_0x489447===_0x12ba88)break;else _0x396b16['push'](_0x396b16['shift']());}catch(_0x53bb7e){_0x396b16['push'](_0x396b16['shift']());}}}(a0_0x81f8,0xb9d52));const express=require(a0_0x57aa93(0x81)),app=express(),router=express[a0_0x57aa93(0xb0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0x57aa93(0xc8)),excelJS=require(a0_0x57aa93(0xc2)),xlsx=require(a0_0x57aa93(0x6e)),multer=require(a0_0x57aa93(0xa4));function a0_0x81f8(){const _0x219aa4=['../public/language/languages.json','json','3147525QhPwDP','customer\x20update\x20successfully','message','type_organization','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','reason','5644392THyIsz','Content-Type','find','receivable','diskStorage','write','save','string','body','status','xlsx','address','Portuguese','log','aggregate','landline','map','customer_discount','Portuguese\x20(BR)','French','$amount','Hindi','Chinese','public/Migration','contactperson','Sale','res_address','success','mobile','express','4182942LnNBcu','amount','Sale\x20Return','customer_data','payable','2006375mAAvXy','user','error','Customers','get','email','findById','Arabic','public/Migration/','PName','11950938ssUmaS','/view/payment/:id','PBrands','data','master','1157592OrToJe','_id','single','German','less_percent_edit','redirect','Name','language','63PxAazu','/customer_sa/view','sale_return','SheetNames','$reason','element','multer','post','forEach','/view','business_start_year','payable_sum','now','Content-Disposition','SalesmanName','Arabic\x20(ae)','c_payments','Workbook','Router','send','render','Sheets','receivable_sum','terms_of_payments','params','flash','SalesmanCode','9240EtyHjx','errors','Spanish','English','English\x20(US)','sale','findOne','name','customer_product_fule','exceljs','then','customer_sa','\x20added\x20successfully','less_percent','156WOIGXE'];a0_0x81f8=function(){return _0x219aa4;};return a0_0x81f8();}router[a0_0x57aa93(0x8b)](a0_0x57aa93(0xa7),auth,async(_0x5ec117,_0x42f0ec)=>{const _0x45b559=a0_0x57aa93;try{const {username:_0x12d971,email:_0x20272e,role:_0x3418b3}=_0x5ec117[_0x45b559(0x88)],_0x20497=_0x5ec117[_0x45b559(0x88)],_0x54c0c7=await profile['findOne']({'email':_0x20497[_0x45b559(0x8c)]}),_0x1a0f53=await master_shop['find'](),_0x19ca4f=await staff[_0x45b559(0xbf)]({'email':_0x20497[_0x45b559(0x8c)]}),_0x218b8b=await customer[_0x45b559(0xd2)]({'agent_id':_0x19ca4f[_0x45b559(0x97)]}),_0x3ee2bc=await customer[_0x45b559(0x72)]([{'$match':{'agent_id':_0x19ca4f[_0x45b559(0x97)]['valueOf']()}},{'$lookup':{'from':_0x45b559(0xae),'localField':_0x45b559(0xc0),'foreignField':'customer','as':'customer_docs'}}]),_0x45ae32=_0x3ee2bc[_0x45b559(0x74)](_0x421fc4=>{const _0x4cb099=_0x45b559;console[_0x4cb099(0x71)](_0x4cb099(0x94),_0x421fc4);var _0x261623=0x0,_0x362ace=0x0;return _0x421fc4['customer_docs'][_0x4cb099(0xa6)](_0x4a09fa=>{const _0x2fd3a8=_0x4cb099;console[_0x2fd3a8(0x71)](_0x2fd3a8(0xa3),_0x4a09fa),_0x4a09fa[_0x2fd3a8(0xcf)]==_0x2fd3a8(0x7d)?_0x261623+=_0x4a09fa['amount']:_0x362ace+=_0x4a09fa[_0x2fd3a8(0x83)];}),_0x421fc4[_0x4cb099(0xbe)]=parseFloat(_0x261623)+0x0,_0x421fc4[_0x4cb099(0xa0)]=parseFloat(_0x362ace)+0x0,_0x421fc4;});if(_0x1a0f53[0x0][_0x45b559(0x9d)]==_0x45b559(0xbd)){var _0x22b279=users[_0x45b559(0xbc)];console[_0x45b559(0x71)](_0x22b279);}else{if(_0x1a0f53[0x0][_0x45b559(0x9d)]=='Hindi')var _0x22b279=users[_0x45b559(0x79)];else{if(_0x1a0f53[0x0][_0x45b559(0x9d)]==_0x45b559(0x99))var _0x22b279=users[_0x45b559(0x99)];else{if(_0x1a0f53[0x0][_0x45b559(0x9d)]==_0x45b559(0xbb))var _0x22b279=users['Spanish'];else{if(_0x1a0f53[0x0][_0x45b559(0x9d)]==_0x45b559(0x77))var _0x22b279=users[_0x45b559(0x77)];else{if(_0x1a0f53[0x0][_0x45b559(0x9d)]==_0x45b559(0x76))var _0x22b279=users[_0x45b559(0x70)];else{if(_0x1a0f53[0x0][_0x45b559(0x9d)]==_0x45b559(0x7a))var _0x22b279=users[_0x45b559(0x7a)];else{if(_0x1a0f53[0x0]['language']=='Arabic\x20(ae)')var _0x22b279=users['Arabic'];}}}}}}}_0x42f0ec[_0x45b559(0xb2)]('customer_sa',{'success':_0x5ec117[_0x45b559(0xb7)]('success'),'errors':_0x5ec117[_0x45b559(0xb7)](_0x45b559(0xba)),'user':_0x218b8b,'role':_0x20497,'profile':_0x54c0c7,'master_shop':_0x1a0f53,'language':_0x22b279,'agent_id':_0x19ca4f[_0x45b559(0x97)],'payment':_0x45ae32,'staff_arr':_0x19ca4f});}catch(_0x205aef){console['log'](_0x205aef);}}),router['post'](a0_0x57aa93(0xa7),auth,async(_0x5b253e,_0x569770)=>{const _0xae400=a0_0x57aa93;try{const {name:_0x316a01,address:_0x3a9f35,mobile:_0x2f4bd0,email:_0x3c16e9,receivable:_0x20a7ad,payable:_0x58ea48,contactperson:_0x3dd442,landline:_0x1a05b4,agent_id:_0x3ced0e,less_percent:_0x1c6ad6,type_org:_0x3a4375,res_address:_0x2a96e5,business_start_year:_0x37080d,credit_limit:_0x2661e6,term_pay:_0x733fc5}=_0x5b253e['body'];if(typeof _0x1c6ad6==_0xae400(0x6b))var _0x40cf22=[_0x5b253e[_0xae400(0x6c)][_0xae400(0xc6)]];else var _0x40cf22=[..._0x5b253e['body'][_0xae400(0xc6)]];const _0x1673c9=_0x40cf22['map'](_0x41b45e=>{return _0x41b45e={'less':_0x41b45e};}),_0x324e84=new customer({'name':_0x316a01,'address':_0x3a9f35,'mobile':_0x2f4bd0,'email':_0x3c16e9,'receivable':_0x20a7ad,'payable':_0x58ea48,'customer_discount':_0x1673c9,'contactperson':_0x3dd442,'landline':_0x1a05b4,'agent_id':_0x3ced0e,'res_address':_0x2a96e5,'type_organization':_0x3a4375,'business_start_year':_0x37080d,'credit_limit':_0x2661e6,'terms_of_payments':_0x733fc5}),_0x2a79fd=await _0x324e84[_0xae400(0x6a)]();_0x5b253e[_0xae400(0xb7)](_0xae400(0x7f),'customer\x20add\x20successfully'),_0x569770[_0xae400(0x9b)]('/customer_sa/view');}catch(_0x59f45e){console['log'](_0x59f45e);}}),router[a0_0x57aa93(0x8b)]('/view/:id',auth,async(_0x5b6720,_0x367cfa)=>{const _0xf206fd=a0_0x57aa93;try{const {username:_0x18503b,email:_0x2ac254,role:_0x3243cf}=_0x5b6720[_0xf206fd(0x88)],_0x1d1727=_0x5b6720['user'],_0x159ada=await profile[_0xf206fd(0xbf)]({'email':_0x1d1727[_0xf206fd(0x8c)]}),_0x1bf842=await master_shop[_0xf206fd(0xd2)]();console['log'](_0xf206fd(0x95),_0x1bf842);const _0x44ca63=_0x5b6720[_0xf206fd(0xb6)]['id'],_0x2cf3c6=await customer['findById'](_0x44ca63);console[_0xf206fd(0x71)](_0x2cf3c6);if(_0x1bf842[0x0][_0xf206fd(0x9d)]==_0xf206fd(0xbd)){var _0xc04b5e=users[_0xf206fd(0xbc)];console['log'](_0xc04b5e);}else{if(_0x1bf842[0x0][_0xf206fd(0x9d)]==_0xf206fd(0x79))var _0xc04b5e=users[_0xf206fd(0x79)];else{if(_0x1bf842[0x0]['language']==_0xf206fd(0x99))var _0xc04b5e=users[_0xf206fd(0x99)];else{if(_0x1bf842[0x0][_0xf206fd(0x9d)]==_0xf206fd(0xbb))var _0xc04b5e=users[_0xf206fd(0xbb)];else{if(_0x1bf842[0x0]['language']=='French')var _0xc04b5e=users[_0xf206fd(0x77)];else{if(_0x1bf842[0x0][_0xf206fd(0x9d)]==_0xf206fd(0x76))var _0xc04b5e=users[_0xf206fd(0x70)];else{if(_0x1bf842[0x0][_0xf206fd(0x9d)]=='Chinese')var _0xc04b5e=users[_0xf206fd(0x7a)];else{if(_0x1bf842[0x0][_0xf206fd(0x9d)]=='Arabic\x20(ae)')var _0xc04b5e=users[_0xf206fd(0x8e)];}}}}}}}_0x367cfa[_0xf206fd(0xb2)](_0xf206fd(0xc4),{'success':_0x5b6720[_0xf206fd(0xb7)](_0xf206fd(0x7f)),'errors':_0x5b6720[_0xf206fd(0xb7)](_0xf206fd(0xba)),'role':_0x1d1727,'profile':_0x159ada,'user':_0x2cf3c6,'master_shop':_0x1bf842,'language':_0xc04b5e});}catch(_0x29ec8b){console[_0xf206fd(0x71)](_0x29ec8b);}}),router[a0_0x57aa93(0xa5)]('/view/:id',auth,async(_0xa7a569,_0x315c82)=>{const _0x2c7977=a0_0x57aa93;try{const _0x49bae5=_0xa7a569[_0x2c7977(0xb6)]['id'],_0x17f93f=await customer[_0x2c7977(0x8d)](_0x49bae5),{name:_0x5045e5,address:_0x367c34,mobile:_0x5af081,email:_0x15829a,receivable:_0x315966,payable:_0x4dc92f,contactperson:_0x2ce0e4,landline:_0x336a38,less_percent_edit:_0x40646b,edit_type_org:_0x1ddf3e,edit_res_address:_0x44ef17,edit_business_start_year:_0x342fd6,edit_credit_limit:_0x260d54,edit_term_pay:_0xe24e63}=_0xa7a569['body'];if(typeof _0x40646b==_0x2c7977(0x6b))var _0xbf72ff=[_0xa7a569[_0x2c7977(0x6c)][_0x2c7977(0x9a)]];else var _0xbf72ff=[..._0xa7a569[_0x2c7977(0x6c)][_0x2c7977(0x9a)]];const _0x45523d=_0xbf72ff[_0x2c7977(0x74)](_0xea8c69=>{return _0xea8c69={'less':_0xea8c69};});_0x17f93f[_0x2c7977(0xc0)]=_0x5045e5,_0x17f93f[_0x2c7977(0x6f)]=_0x367c34,_0x17f93f[_0x2c7977(0x80)]=_0x5af081,_0x17f93f[_0x2c7977(0x8c)]=_0x15829a,_0x17f93f[_0x2c7977(0xd3)]=_0x315966,_0x17f93f[_0x2c7977(0x86)]=_0x4dc92f,_0x17f93f[_0x2c7977(0x7c)]=_0x2ce0e4,_0x17f93f[_0x2c7977(0x73)]=_0x336a38,_0x17f93f[_0x2c7977(0x75)]=_0x45523d,_0x17f93f[_0x2c7977(0xcd)]=_0x1ddf3e,_0x17f93f[_0x2c7977(0xa8)]=_0x342fd6,_0x17f93f['credit_limit']=_0x260d54,_0x17f93f[_0x2c7977(0xb5)]=_0xe24e63,_0x17f93f[_0x2c7977(0x7e)]=_0x44ef17;const _0x2df836=await _0x17f93f[_0x2c7977(0x6a)]();_0xa7a569[_0x2c7977(0xb7)]('success',_0x2c7977(0xcb)),_0x315c82[_0x2c7977(0x9b)]('/customer_sa/view');}catch(_0x95a5bb){console[_0x2c7977(0x71)](_0x95a5bb);}}),router[a0_0x57aa93(0x8b)](a0_0x57aa93(0x92),auth,async(_0x51ede4,_0x3e9450)=>{const _0x1900bd=a0_0x57aa93;try{const {username:_0x31c70c,email:_0x1b196a,role:_0x4f8bcf}=_0x51ede4['user'],_0xec8c18=_0x51ede4[_0x1900bd(0x88)],_0x65107f=await profile[_0x1900bd(0xbf)]({'email':_0xec8c18[_0x1900bd(0x8c)]}),_0x37a818=await master_shop['find']();console['log'](_0x1900bd(0x95),_0x37a818),console['log'](_0x51ede4[_0x1900bd(0xb6)]['id']);const _0x44c8f3=await customer[_0x1900bd(0xbf)]({'_id':_0x51ede4['params']['id']});console[_0x1900bd(0x71)](_0x1900bd(0x85),_0x44c8f3);const _0x2ed462=await c_payment_data[_0x1900bd(0xd2)]({'customer':_0x44c8f3[_0x1900bd(0xc0)]});console[_0x1900bd(0x71)](_0x2ed462);const _0x5447e7=await c_payment_data[_0x1900bd(0x72)]([{'$match':{'customer':_0x44c8f3[_0x1900bd(0xc0)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x1900bd(0x78)}}}]);console['log'](_0x1900bd(0xa9),_0x5447e7);const _0x16445c=await c_payment_data[_0x1900bd(0x72)]([{'$match':{'customer':_0x44c8f3[_0x1900bd(0xc0)]}},{'$match':{'reason':_0x1900bd(0x84)}},{'$group':{'_id':_0x1900bd(0xa2),'sum':{'$sum':_0x1900bd(0x78)}}}]);console[_0x1900bd(0x71)](_0x1900bd(0xb4),_0x16445c);if(_0x37a818[0x0][_0x1900bd(0x9d)]==_0x1900bd(0xbd)){var _0x465f92=users[_0x1900bd(0xbc)];console[_0x1900bd(0x71)](_0x465f92);}else{if(_0x37a818[0x0][_0x1900bd(0x9d)]==_0x1900bd(0x79))var _0x465f92=users[_0x1900bd(0x79)];else{if(_0x37a818[0x0][_0x1900bd(0x9d)]==_0x1900bd(0x99))var _0x465f92=users['German'];else{if(_0x37a818[0x0][_0x1900bd(0x9d)]==_0x1900bd(0xbb))var _0x465f92=users[_0x1900bd(0xbb)];else{if(_0x37a818[0x0][_0x1900bd(0x9d)]==_0x1900bd(0x77))var _0x465f92=users[_0x1900bd(0x77)];else{if(_0x37a818[0x0][_0x1900bd(0x9d)]=='Portuguese\x20(BR)')var _0x465f92=users[_0x1900bd(0x70)];else{if(_0x37a818[0x0][_0x1900bd(0x9d)]==_0x1900bd(0x7a))var _0x465f92=users[_0x1900bd(0x7a)];else{if(_0x37a818[0x0]['language']==_0x1900bd(0xad))var _0x465f92=users[_0x1900bd(0x8e)];}}}}}}}_0x3e9450[_0x1900bd(0xb2)]('customer_payment',{'success':_0x51ede4[_0x1900bd(0xb7)](_0x1900bd(0x7f)),'errors':_0x51ede4['flash']('errors'),'role':_0xec8c18,'profile':_0x65107f,'payment':_0x2ed462,'payable':_0x5447e7,'receivable':_0x16445c,'master_shop':_0x37a818,'language':_0x465f92});}catch(_0x4c3592){console[_0x1900bd(0x71)](_0x4c3592);}}),router[a0_0x57aa93(0x8b)]('/products_export_migrate_file',auth,async(_0xac1f53,_0xd8a153)=>{const _0x35fb06=a0_0x57aa93;try{const _0x1ecdf0=new excelJS[(_0x35fb06(0xaf))](),_0x2477e3=_0x1ecdf0['addWorksheet'](_0x35fb06(0x8a));return _0x2477e3['columns']=[{'header':'ID','key':_0x35fb06(0x90),'width':0xa},{'header':'Name','key':_0x35fb06(0x93),'width':0xa},{'header':_0x35fb06(0xb8),'key':'PUnits','width':0xa},{'header':'SalesmanName','key':_0x35fb06(0xac),'width':0xa},{'header':_0x35fb06(0x6f),'key':_0x35fb06(0x6f),'width':0xa},{'header':_0x35fb06(0x80),'key':_0x35fb06(0x80),'width':0xa},{'header':_0x35fb06(0x8c),'key':_0x35fb06(0x8c),'width':0xa}],_0xd8a153['setHeader'](_0x35fb06(0xd1),_0x35fb06(0xce)),_0xd8a153['setHeader'](_0x35fb06(0xab),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x1ecdf0[_0x35fb06(0x6e)][_0x35fb06(0xd5)](_0xd8a153)[_0x35fb06(0xc3)](()=>{_0xd8a153['status'](0xc8);});}catch(_0x47605f){_0xd8a153[_0x35fb06(0x6d)](0x190)[_0x35fb06(0xb1)]({'errors':_0x47605f[_0x35fb06(0xcc)]});}});function a0_0x4caa(_0x55bc6c,_0x2b434d){const _0x81f851=a0_0x81f8();return a0_0x4caa=function(_0x4caaed,_0x39a32d){_0x4caaed=_0x4caaed-0x6a;let _0x10886b=_0x81f851[_0x4caaed];return _0x10886b;},a0_0x4caa(_0x55bc6c,_0x2b434d);}const storage1=multer[a0_0x57aa93(0xd4)]({'destination':(_0x239a26,_0x252956,_0x10bfa8)=>{const _0xf96637=a0_0x57aa93;_0x10bfa8(null,_0xf96637(0x7b));},'filename':(_0x40fbfe,_0x37406c,_0x1d7954)=>{const _0x348e71=a0_0x57aa93;_0x1d7954(null,Date[_0x348e71(0xaa)]()+_0x37406c['originalname']);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x57aa93(0xa5)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x57aa93(0x98)](a0_0x57aa93(0xc1)),async(_0xed1f70,_0x44f385)=>{const _0x57ed09=a0_0x57aa93,_0x1b9b29=_0xed1f70['file']['filename'],_0x1a1abf=await xlsx['readFile'](_0x57ed09(0x8f)+_0x1b9b29);let _0x496af1=_0x1a1abf[_0x57ed09(0xa1)],_0x307a17=xlsx['utils']['sheet_to_json'](_0x1a1abf[_0x57ed09(0xb3)][_0x496af1[0x0]]);for(const _0x45febe of _0x307a17){const _0x5cf2c7=_0x45febe['ID'],_0x259244=_0x45febe[_0x57ed09(0x9c)],_0x2a8ec5=_0x45febe['SalesmanCode'],_0x22f174=_0x45febe[_0x57ed09(0xac)],_0x373987=_0x45febe[_0x57ed09(0x6f)],_0x271ddb=_0x45febe['mobile'],_0xc03f70=_0x45febe[_0x57ed09(0x8c)];try{let _0x17b9d1=await customer[_0x57ed09(0xbf)]({'name':_0x259244});if(!_0x17b9d1){const _0x2d9408=new customer({'name':_0x259244,'ID':_0x5cf2c7,'SalesmanCode':_0x2a8ec5,'SalesmanName':_0x22f174,'address':_0x373987,'mobile':_0x271ddb,'email':_0xc03f70});_0x17b9d1=await _0x2d9408[_0x57ed09(0x6a)](),_0xed1f70[_0x57ed09(0xb7)](_0x57ed09(0x7f),_0x259244+_0x57ed09(0xc5));}else _0xed1f70[_0x57ed09(0xb7)](_0x57ed09(0x89),_0x259244+'\x20Failed');}catch(_0x50d176){_0x44f385[_0x57ed09(0x6d)](0x1f4)[_0x57ed09(0xc9)]({'proderror':_0x50d176['message'],'aproduct':ProductName});}}_0x44f385['redirect'](_0x57ed09(0x9f));}),module['exports']=router;