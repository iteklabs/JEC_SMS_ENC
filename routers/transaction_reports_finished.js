var a0_0x20b3e1=a0_0x363b;(function(_0x4f0e9a,_0x54b10d){var _0x29ea04=a0_0x363b,_0x5f31ed=_0x4f0e9a();while(!![]){try{var _0x1f7826=-parseInt(_0x29ea04(0x228))/0x1+parseInt(_0x29ea04(0x1f0))/0x2+-parseInt(_0x29ea04(0x239))/0x3*(parseInt(_0x29ea04(0x227))/0x4)+parseInt(_0x29ea04(0x1df))/0x5+parseInt(_0x29ea04(0x1ec))/0x6+parseInt(_0x29ea04(0x1fe))/0x7+parseInt(_0x29ea04(0x211))/0x8*(parseInt(_0x29ea04(0x206))/0x9);if(_0x1f7826===_0x54b10d)break;else _0x5f31ed['push'](_0x5f31ed['shift']());}catch(_0x26aa8f){_0x5f31ed['push'](_0x5f31ed['shift']());}}}(a0_0x4f36,0x74e74));function a0_0x4f36(){var _0x3a266d=['1427050CbbyVX','view_table','user','$product_details.expiry_date','length','_id','$date','$sale_product','$product.new_adjust_qty','map','success','$product.room_names','$product_details.invoice','Arabic\x20(ae)','255801TSHpRo','../public/language/languages.json','../middleware/auth','flash','language','Portuguese\x20(BR)','Spanish','$warehouse_name','80757lVlKDc','/viewdata_tf_fg/:id','Chinese','find','$invoice','$product.product_name','$product_details.product_stock','findOne','data_adjustment','/viewdata_inc_fg/:id','$sale_product.product_code','848rJUJdb','data_sales','warehouses','data_transfer','$product.id_transaction_id','$product.invoice','$name','$sale_product._id','English','Raw\x20Materials','/reports','$product_details.product_name','$product_details.product_code','push','$product._id','$product.id_transaction_from','$$invoice','warehouse_data','body','$sale_product.expiry_date','findById','$sale_product.room_name','6744QJjXAB','701645OtDxKx','$product.to_quantity','transaction_finished','json','German','Enabled','$sale_product.production_date','$product_details._id','errors','$product.id_transaction','Hindi','English\x20(US)','view_og_table','$product.expiry_date','invoice','express','Portuguese','1419xGBiKb','$product_details.production_date','Router','exports','view_tf_table','$sale_product.id_transaction_from','$product.product_code','$product.to_room_name','email','French','$sale_product.quantity','render','get','all','$product','$product_details.unit','1283260SXMerc','$room','$product.production_date','$sale_product.product_name','/viewdata_og_fg/:id','log','$sale_product.invoice','Arabic','$product.unit','aggregate','params','valueOf','$product_details','120606tYTHFl','$to_warehouse','post','$sale_product.unit'];a0_0x4f36=function(){return _0x3a266d;};return a0_0x4f36();}function a0_0x363b(_0x54fd71,_0x510836){var _0x4f363f=a0_0x4f36();return a0_0x363b=function(_0x363b69,_0x2a69b6){_0x363b69=_0x363b69-0x1dd;var _0x329c26=_0x4f363f[_0x363b69];return _0x329c26;},a0_0x363b(_0x54fd71,_0x510836);}const express=require(a0_0x20b3e1(0x237)),app=express(),router=express[a0_0x20b3e1(0x23b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_finished,sales,sales_finished,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings,adjustment_finished,adjustment}=require('../models/all_models'),auth=require(a0_0x20b3e1(0x200)),users=require(a0_0x20b3e1(0x1ff)),nodemailer=require('nodemailer');router[a0_0x20b3e1(0x245)]('/view',auth,async(_0x15b397,_0x5d9d84)=>{var _0x279bd7=a0_0x20b3e1;try{const {username:_0x32a277,email:_0x25c582,role:_0x274001}=_0x15b397[_0x279bd7(0x1f2)],_0x58988b=_0x15b397['user'],_0xad8369=await profile[_0x279bd7(0x20d)]({'email':_0x58988b['email']}),_0x202a95=await master_shop[_0x279bd7(0x209)](),_0x4448a2=await warehouse['aggregate']([{'$match':{'status':_0x279bd7(0x22d),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x279bd7(0x217),'name':{'$first':_0x279bd7(0x217)}}}]);if(_0x202a95[0x0][_0x279bd7(0x202)]==_0x279bd7(0x233))var _0x32bda0=users[_0x279bd7(0x219)];else{if(_0x202a95[0x0]['language']=='Hindi')var _0x32bda0=users[_0x279bd7(0x232)];else{if(_0x202a95[0x0]['language']=='German')var _0x32bda0=users[_0x279bd7(0x22c)];else{if(_0x202a95[0x0][_0x279bd7(0x202)]==_0x279bd7(0x204))var _0x32bda0=users['Spanish'];else{if(_0x202a95[0x0][_0x279bd7(0x202)]=='French')var _0x32bda0=users[_0x279bd7(0x242)];else{if(_0x202a95[0x0][_0x279bd7(0x202)]==_0x279bd7(0x203))var _0x32bda0=users[_0x279bd7(0x238)];else{if(_0x202a95[0x0][_0x279bd7(0x202)]==_0x279bd7(0x208))var _0x32bda0=users[_0x279bd7(0x208)];else{if(_0x202a95[0x0][_0x279bd7(0x202)]==_0x279bd7(0x1fd))var _0x32bda0=users[_0x279bd7(0x1e6)];}}}}}}}_0x5d9d84[_0x279bd7(0x244)](_0x279bd7(0x22a),{'success':_0x15b397[_0x279bd7(0x201)](_0x279bd7(0x1fa)),'errors':_0x15b397['flash'](_0x279bd7(0x230)),'role':_0x58988b,'profile':_0xad8369,'master_shop':_0x202a95,'dataProcess':_0x4448a2,'language':_0x32bda0});}catch(_0x37ef70){console[_0x279bd7(0x1e4)](_0x37ef70);}}),router[a0_0x20b3e1(0x1ee)](a0_0x20b3e1(0x21b),auth,async(_0x27ed6c,_0x1b5547)=>{var _0x3d85f4=a0_0x20b3e1;const {product_category:_0x8fa101,transaction_category:_0x19efb7,transaction_date_from:_0x2e65a4,transaction_date_to:_0x540142,warehouse_category:_0x38bfb8,item_code:_0x2e628}=_0x27ed6c[_0x3d85f4(0x223)];console[_0x3d85f4(0x1e4)](_0x38bfb8);if(_0x8fa101=='rm'){if(_0x38bfb8==_0x3d85f4(0x246)){var _0x15139c=await purchases[_0x3d85f4(0x1e8)]([{'$match':{'date':{'$gte':_0x2e65a4,'$lte':_0x540142}}},{'$lookup':{'from':_0x3d85f4(0x213),'let':{'invoice':'$invoice'},'pipeline':[{'$unwind':_0x3d85f4(0x1eb)},{'$match':{'$expr':{'$eq':[_0x3d85f4(0x221),_0x3d85f4(0x1fc)]}}},{'$project':{'_id':_0x3d85f4(0x22f),'product_name':_0x3d85f4(0x21c),'product_code':_0x3d85f4(0x21d),'quantity_available':_0x3d85f4(0x20c),'warehouse_name':_0x3d85f4(0x217),'warehouse_room':_0x3d85f4(0x1e0),'invoice':'$product_details.invoice','production_date':_0x3d85f4(0x23a),'expiry_date':_0x3d85f4(0x1f3),'UOM':_0x3d85f4(0x1de)}}],'as':'warehouse_data'}}]);_0x15139c['data_sales']={},await Promise[_0x3d85f4(0x246)](_0x15139c['map'](async _0x33e0b5=>{var _0x51419b=_0x3d85f4;_0x15139c[_0x51419b(0x212)][_0x33e0b5['invoice']]=[],await Promise['all'](_0x33e0b5['warehouse_data']['map'](async _0x503c8c=>{var _0x31acd4=_0x51419b;const _0x4ef127=await sales[_0x31acd4(0x1e8)]([{'$unwind':'$sale_product'},{'$match':{'sale_product.id_transaction_from':_0x503c8c[_0x31acd4(0x1f5)][_0x31acd4(0x1ea)](),'sale_product.invoice':_0x503c8c[_0x31acd4(0x236)]}},{'$project':{'_id':'$sale_product._id','product_name':'$sale_product.product_name','product_code':_0x31acd4(0x210),'quantity_available':_0x31acd4(0x243),'warehouse_name':'$warehouse_name','warehouse_room':_0x31acd4(0x226),'product_invoice':_0x31acd4(0x1e5),'invoice':'$invoice','id_transaction_from':_0x31acd4(0x23e),'date':_0x31acd4(0x1f6),'production_date':'$sale_product.production_date','expiry_date':_0x31acd4(0x224),'UOM':_0x31acd4(0x1ef)}}]);_0x4ef127[_0x31acd4(0x1f4)]>0x0&&_0x15139c['data_sales'][_0x33e0b5['invoice']]['push'](..._0x4ef127);}));})),_0x15139c[_0x3d85f4(0x212)]=_0x15139c[_0x3d85f4(0x212)],_0x15139c['data_adjustment']={},await Promise[_0x3d85f4(0x246)](_0x15139c['map'](async _0x250031=>{var _0x36eb68=_0x3d85f4;_0x15139c[_0x36eb68(0x20e)][_0x250031[_0x36eb68(0x236)]]=[],await Promise[_0x36eb68(0x246)](_0x250031[_0x36eb68(0x222)][_0x36eb68(0x1f9)](async _0x379118=>{var _0x110f2e=_0x36eb68;const _0xf0e44=await adjustment[_0x110f2e(0x1e8)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_from':_0x379118[_0x110f2e(0x1f5)][_0x110f2e(0x1ea)](),'product.invoice':_0x379118['invoice']}},{'$project':{'_id':_0x110f2e(0x21f),'product_name':_0x110f2e(0x20b),'product_code':'$product.product_code','quantity_available':_0x110f2e(0x1f8),'warehouse_name':_0x110f2e(0x205),'warehouse_room':_0x110f2e(0x1fb),'product_invoice':_0x110f2e(0x216),'invoice':_0x110f2e(0x20a),'id_transaction_from':_0x110f2e(0x220),'date':'$date','production_date':'$product.production_date','expiry_date':_0x110f2e(0x235),'UOM':_0x110f2e(0x1e7)}}]);_0xf0e44[_0x110f2e(0x1f4)]>0x0&&_0x15139c[_0x110f2e(0x20e)][_0x250031[_0x110f2e(0x236)]][_0x110f2e(0x21e)](..._0xf0e44);}));})),_0x15139c[_0x3d85f4(0x214)]={},await Promise[_0x3d85f4(0x246)](_0x15139c[_0x3d85f4(0x1f9)](async _0x300260=>{var _0x33147b=_0x3d85f4;_0x15139c['data_transfer'][_0x300260[_0x33147b(0x236)]]=[],await Promise[_0x33147b(0x246)](_0x300260[_0x33147b(0x222)][_0x33147b(0x1f9)](async _0x3d3e7e=>{var _0x1229c5=_0x33147b;const _0x395af7=await transfers[_0x1229c5(0x1e8)]([{'$unwind':_0x1229c5(0x1dd)},{'$match':{'product.id_transaction_id':_0x3d3e7e[_0x1229c5(0x1f5)][_0x1229c5(0x1ea)](),'product.To_invoice':_0x3d3e7e[_0x1229c5(0x236)]}},{'$project':{'_id':_0x1229c5(0x21f),'product_name':_0x1229c5(0x20b),'product_code':_0x1229c5(0x23f),'quantity_available':_0x1229c5(0x229),'warehouse_name':_0x1229c5(0x1ed),'warehouse_room':_0x1229c5(0x1fb),'product_invoice':_0x1229c5(0x240),'invoice':_0x1229c5(0x20a),'id_transaction_from':'$product.id_transaction_id','date':'$date','production_date':_0x1229c5(0x1e1),'expiry_date':_0x1229c5(0x235),'UOM':_0x1229c5(0x1e7)}}]);_0x395af7[_0x1229c5(0x1f4)]>0x0&&_0x15139c[_0x1229c5(0x214)][_0x300260[_0x1229c5(0x236)]][_0x1229c5(0x21e)](..._0x395af7);}));})),_0x1b5547[_0x3d85f4(0x22b)]({'purchases_warehouse':_0x15139c,'data_sales':_0x15139c['data_sales'],'data_adjustment':_0x15139c[_0x3d85f4(0x20e)],'data_transfer':_0x15139c[_0x3d85f4(0x214)]});}else{var _0x15139c=await purchases['aggregate']([{'$match':{'warehouse_name':_0x38bfb8,'date':{'$gte':_0x2e65a4,'$lte':_0x540142}}},{'$lookup':{'from':_0x3d85f4(0x213),'let':{'invoice':'$invoice'},'pipeline':[{'$unwind':_0x3d85f4(0x1eb)},{'$match':{'$expr':{'$eq':[_0x3d85f4(0x221),'$product_details.invoice']}}},{'$project':{'_id':'$product_details._id','product_name':_0x3d85f4(0x21c),'product_code':'$product_details.product_code','quantity_available':_0x3d85f4(0x20c),'warehouse_name':_0x3d85f4(0x217),'warehouse_room':'$room','invoice':_0x3d85f4(0x1fc),'production_date':_0x3d85f4(0x23a),'expiry_date':'$product_details.expiry_date','UOM':_0x3d85f4(0x1de)}}],'as':_0x3d85f4(0x222)}}]);_0x15139c[_0x3d85f4(0x212)]={},await Promise[_0x3d85f4(0x246)](_0x15139c['map'](async _0xf63955=>{var _0xcc776d=_0x3d85f4;_0x15139c['data_sales'][_0xf63955['invoice']]=[],await Promise[_0xcc776d(0x246)](_0xf63955[_0xcc776d(0x222)][_0xcc776d(0x1f9)](async _0x51431d=>{var _0x45375d=_0xcc776d;const _0x197301=await sales[_0x45375d(0x1e8)]([{'$unwind':_0x45375d(0x1f7)},{'$match':{'sale_product.id_transaction_from':_0x51431d[_0x45375d(0x1f5)][_0x45375d(0x1ea)](),'sale_product.invoice':_0x51431d[_0x45375d(0x236)]}},{'$project':{'_id':_0x45375d(0x218),'product_name':'$sale_product.product_name','product_code':_0x45375d(0x210),'quantity_available':_0x45375d(0x243),'warehouse_name':_0x45375d(0x205),'warehouse_room':'$sale_product.room_name','product_invoice':_0x45375d(0x1e5),'invoice':_0x45375d(0x20a),'id_transaction_from':'$sale_product.id_transaction_from','date':_0x45375d(0x1f6),'production_date':_0x45375d(0x22e),'expiry_date':_0x45375d(0x224),'UOM':_0x45375d(0x1ef)}}]);_0x197301['length']>0x0&&_0x15139c[_0x45375d(0x212)][_0xf63955[_0x45375d(0x236)]][_0x45375d(0x21e)](..._0x197301);}));})),_0x15139c[_0x3d85f4(0x212)]=_0x15139c[_0x3d85f4(0x212)],_0x15139c['data_adjustment']={},await Promise[_0x3d85f4(0x246)](_0x15139c[_0x3d85f4(0x1f9)](async _0x4b3905=>{var _0x12dd3e=_0x3d85f4;_0x15139c[_0x12dd3e(0x20e)][_0x4b3905['invoice']]=[],await Promise[_0x12dd3e(0x246)](_0x4b3905[_0x12dd3e(0x222)]['map'](async _0x31a2de=>{var _0x5d0bf2=_0x12dd3e;const _0x34fc91=await adjustment[_0x5d0bf2(0x1e8)]([{'$unwind':_0x5d0bf2(0x1dd)},{'$match':{'product.id_transaction_from':_0x31a2de[_0x5d0bf2(0x1f5)][_0x5d0bf2(0x1ea)](),'product.invoice':_0x31a2de[_0x5d0bf2(0x236)]}},{'$project':{'_id':_0x5d0bf2(0x21f),'product_name':'$product.product_name','product_code':_0x5d0bf2(0x23f),'quantity_available':_0x5d0bf2(0x1f8),'warehouse_name':'$warehouse_name','warehouse_room':_0x5d0bf2(0x1fb),'product_invoice':_0x5d0bf2(0x216),'invoice':_0x5d0bf2(0x20a),'id_transaction_from':_0x5d0bf2(0x220),'date':_0x5d0bf2(0x1f6),'production_date':_0x5d0bf2(0x1e1),'expiry_date':_0x5d0bf2(0x235),'UOM':_0x5d0bf2(0x1e7)}}]);_0x34fc91[_0x5d0bf2(0x1f4)]>0x0&&_0x15139c[_0x5d0bf2(0x20e)][_0x4b3905['invoice']]['push'](..._0x34fc91);}));})),_0x15139c[_0x3d85f4(0x214)]={},await Promise[_0x3d85f4(0x246)](_0x15139c[_0x3d85f4(0x1f9)](async _0x4028ab=>{var _0x2d3e96=_0x3d85f4;_0x15139c[_0x2d3e96(0x214)][_0x4028ab[_0x2d3e96(0x236)]]=[],await Promise[_0x2d3e96(0x246)](_0x4028ab[_0x2d3e96(0x222)]['map'](async _0x40e737=>{var _0xedc647=_0x2d3e96;const _0x20ed79=await transfers[_0xedc647(0x1e8)]([{'$unwind':_0xedc647(0x1dd)},{'$match':{'product.id_transaction_id':_0x40e737[_0xedc647(0x1f5)][_0xedc647(0x1ea)](),'product.To_invoice':_0x40e737[_0xedc647(0x236)]}},{'$project':{'_id':_0xedc647(0x21f),'product_name':_0xedc647(0x20b),'product_code':'$product.product_code','quantity_available':_0xedc647(0x229),'warehouse_name':'$to_warehouse','warehouse_room':_0xedc647(0x1fb),'product_invoice':_0xedc647(0x240),'invoice':_0xedc647(0x20a),'id_transaction_from':_0xedc647(0x215),'date':_0xedc647(0x1f6),'production_date':_0xedc647(0x1e1),'expiry_date':_0xedc647(0x235),'UOM':_0xedc647(0x1e7)}}]);_0x20ed79[_0xedc647(0x1f4)]>0x0&&_0x15139c['data_transfer'][_0x4028ab[_0xedc647(0x236)]]['push'](..._0x20ed79);}));})),_0x1b5547['json']({'purchases_warehouse':_0x15139c,'data_sales':_0x15139c['data_sales'],'data_adjustment':_0x15139c[_0x3d85f4(0x20e)],'data_transfer':_0x15139c[_0x3d85f4(0x214)]});}}else{if(_0x38bfb8==_0x3d85f4(0x246)){var _0x15139c=await purchases_finished[_0x3d85f4(0x1e8)]([{'$match':{'date':{'$gte':_0x2e65a4,'$lte':_0x540142}}},{'$lookup':{'from':_0x3d85f4(0x213),'let':{'invoice':_0x3d85f4(0x20a)},'pipeline':[{'$unwind':_0x3d85f4(0x1eb)},{'$match':{'$expr':{'$eq':[_0x3d85f4(0x221),_0x3d85f4(0x1fc)]}}},{'$project':{'_id':_0x3d85f4(0x22f),'product_name':'$product_details.product_name','product_code':_0x3d85f4(0x21d),'quantity_available':_0x3d85f4(0x20c),'warehouse_name':_0x3d85f4(0x217),'warehouse_room':_0x3d85f4(0x1e0),'invoice':_0x3d85f4(0x1fc),'production_date':'$product_details.production_date','expiry_date':_0x3d85f4(0x1f3),'UOM':_0x3d85f4(0x1de)}}],'as':_0x3d85f4(0x222)}}]);_0x15139c[_0x3d85f4(0x212)]={},await Promise[_0x3d85f4(0x246)](_0x15139c[_0x3d85f4(0x1f9)](async _0x51cee6=>{var _0x58d47b=_0x3d85f4;_0x15139c[_0x58d47b(0x212)][_0x51cee6[_0x58d47b(0x236)]]=[],await Promise[_0x58d47b(0x246)](_0x51cee6[_0x58d47b(0x222)]['map'](async _0x3b0caf=>{var _0x112f46=_0x58d47b;const _0x1ef879=await sales_finished[_0x112f46(0x1e8)]([{'$unwind':_0x112f46(0x1f7)},{'$match':{'sale_product.id_transaction_from':_0x3b0caf['_id'][_0x112f46(0x1ea)](),'sale_product.invoice':_0x3b0caf['invoice']}},{'$project':{'_id':_0x112f46(0x218),'product_name':_0x112f46(0x1e2),'product_code':_0x112f46(0x210),'quantity_available':_0x112f46(0x243),'warehouse_name':_0x112f46(0x205),'warehouse_room':_0x112f46(0x226),'product_invoice':_0x112f46(0x1e5),'invoice':_0x112f46(0x20a),'id_transaction_from':_0x112f46(0x23e),'date':_0x112f46(0x1f6),'production_date':_0x112f46(0x22e),'expiry_date':_0x112f46(0x224),'UOM':'$sale_product.unit'}}]);_0x1ef879[_0x112f46(0x1f4)]>0x0&&_0x15139c[_0x112f46(0x212)][_0x51cee6[_0x112f46(0x236)]]['push'](..._0x1ef879);}));})),_0x15139c[_0x3d85f4(0x212)]=_0x15139c[_0x3d85f4(0x212)],_0x15139c[_0x3d85f4(0x20e)]={},await Promise[_0x3d85f4(0x246)](_0x15139c['map'](async _0x3efb94=>{var _0x4aa0d3=_0x3d85f4;_0x15139c['data_adjustment'][_0x3efb94[_0x4aa0d3(0x236)]]=[],await Promise['all'](_0x3efb94[_0x4aa0d3(0x222)][_0x4aa0d3(0x1f9)](async _0x590af1=>{var _0x406c42=_0x4aa0d3;const _0x4b229e=await adjustment_finished[_0x406c42(0x1e8)]([{'$unwind':_0x406c42(0x1dd)},{'$match':{'product.id_transaction_from':_0x590af1['_id'][_0x406c42(0x1ea)](),'product.invoice':_0x590af1[_0x406c42(0x236)]}},{'$project':{'_id':'$product._id','product_name':_0x406c42(0x20b),'product_code':_0x406c42(0x23f),'quantity_available':_0x406c42(0x1f8),'warehouse_name':'$warehouse_name','warehouse_room':_0x406c42(0x1fb),'product_invoice':_0x406c42(0x216),'invoice':_0x406c42(0x20a),'id_transaction_from':_0x406c42(0x220),'date':_0x406c42(0x1f6),'production_date':_0x406c42(0x1e1),'expiry_date':'$product.expiry_date','UOM':_0x406c42(0x1e7)}}]);_0x4b229e[_0x406c42(0x1f4)]>0x0&&_0x15139c[_0x406c42(0x20e)][_0x3efb94[_0x406c42(0x236)]][_0x406c42(0x21e)](..._0x4b229e);}));})),_0x15139c['data_transfer']={},await Promise[_0x3d85f4(0x246)](_0x15139c['map'](async _0x4fd725=>{var _0x45ccbe=_0x3d85f4;_0x15139c[_0x45ccbe(0x214)][_0x4fd725['invoice']]=[],await Promise[_0x45ccbe(0x246)](_0x4fd725[_0x45ccbe(0x222)]['map'](async _0x385be8=>{var _0x5082db=_0x45ccbe;const _0x668519=await transfers_finished[_0x5082db(0x1e8)]([{'$unwind':_0x5082db(0x1dd)},{'$match':{'product.id_transaction':_0x385be8['_id']['valueOf'](),'product.from_invoice':_0x385be8[_0x5082db(0x236)]}},{'$project':{'_id':_0x5082db(0x21f),'product_name':'$product.product_name','product_code':_0x5082db(0x23f),'quantity_available':_0x5082db(0x229),'warehouse_name':'$to_warehouse','warehouse_room':_0x5082db(0x1fb),'product_invoice':'$product.to_room_name','invoice':_0x5082db(0x20a),'id_transaction_from':_0x5082db(0x231),'date':_0x5082db(0x1f6),'production_date':'$product.production_date','expiry_date':_0x5082db(0x235),'UOM':_0x5082db(0x1e7)}}]);_0x668519[_0x5082db(0x1f4)]>0x0&&_0x15139c[_0x5082db(0x214)][_0x4fd725['invoice']]['push'](..._0x668519);}));})),_0x1b5547['json']({'purchases_warehouse':_0x15139c,'data_sales':_0x15139c['data_sales'],'data_adjustment':_0x15139c[_0x3d85f4(0x20e)],'data_transfer':_0x15139c[_0x3d85f4(0x214)]});}else{var _0x15139c=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x38bfb8,'date':{'$gte':_0x2e65a4,'$lte':_0x540142}}},{'$lookup':{'from':_0x3d85f4(0x213),'let':{'invoice':_0x3d85f4(0x20a)},'pipeline':[{'$unwind':_0x3d85f4(0x1eb)},{'$match':{'$expr':{'$eq':[_0x3d85f4(0x221),_0x3d85f4(0x1fc)]}}},{'$project':{'_id':_0x3d85f4(0x22f),'product_name':_0x3d85f4(0x21c),'product_code':_0x3d85f4(0x21d),'quantity_available':_0x3d85f4(0x20c),'warehouse_name':_0x3d85f4(0x217),'warehouse_room':'$room','invoice':'$product_details.invoice','production_date':_0x3d85f4(0x23a),'expiry_date':_0x3d85f4(0x1f3),'UOM':_0x3d85f4(0x1de)}}],'as':_0x3d85f4(0x222)}}]);_0x15139c['data_sales']={},await Promise['all'](_0x15139c[_0x3d85f4(0x1f9)](async _0x44f26a=>{var _0x57e1c7=_0x3d85f4;_0x15139c[_0x57e1c7(0x212)][_0x44f26a['invoice']]=[],await Promise['all'](_0x44f26a[_0x57e1c7(0x222)][_0x57e1c7(0x1f9)](async _0x23c34c=>{var _0xfc0a16=_0x57e1c7;const _0x5a2fb3=await sales_finished['aggregate']([{'$unwind':_0xfc0a16(0x1f7)},{'$match':{'sale_product.id_transaction_from':_0x23c34c[_0xfc0a16(0x1f5)][_0xfc0a16(0x1ea)](),'sale_product.invoice':_0x23c34c['invoice']}},{'$project':{'_id':_0xfc0a16(0x218),'product_name':_0xfc0a16(0x1e2),'product_code':_0xfc0a16(0x210),'quantity_available':_0xfc0a16(0x243),'warehouse_name':_0xfc0a16(0x205),'warehouse_room':_0xfc0a16(0x226),'product_invoice':_0xfc0a16(0x1e5),'invoice':_0xfc0a16(0x20a),'id_transaction_from':'$sale_product.id_transaction_from','date':_0xfc0a16(0x1f6),'production_date':'$sale_product.production_date','expiry_date':_0xfc0a16(0x224),'UOM':_0xfc0a16(0x1ef)}}]);_0x5a2fb3[_0xfc0a16(0x1f4)]>0x0&&_0x15139c['data_sales'][_0x44f26a['invoice']][_0xfc0a16(0x21e)](..._0x5a2fb3);}));})),_0x15139c[_0x3d85f4(0x212)]=_0x15139c['data_sales'],_0x15139c[_0x3d85f4(0x20e)]={},await Promise[_0x3d85f4(0x246)](_0x15139c['map'](async _0x1ceb17=>{var _0x2ab413=_0x3d85f4;_0x15139c[_0x2ab413(0x20e)][_0x1ceb17['invoice']]=[],await Promise[_0x2ab413(0x246)](_0x1ceb17[_0x2ab413(0x222)][_0x2ab413(0x1f9)](async _0x5a83ef=>{var _0x2dcaae=_0x2ab413;const _0x76f72a=await adjustment_finished[_0x2dcaae(0x1e8)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_from':_0x5a83ef[_0x2dcaae(0x1f5)][_0x2dcaae(0x1ea)](),'product.invoice':_0x5a83ef[_0x2dcaae(0x236)]}},{'$project':{'_id':_0x2dcaae(0x21f),'product_name':_0x2dcaae(0x20b),'product_code':_0x2dcaae(0x23f),'quantity_available':'$product.new_adjust_qty','warehouse_name':_0x2dcaae(0x205),'warehouse_room':'$product.room_names','product_invoice':_0x2dcaae(0x216),'invoice':_0x2dcaae(0x20a),'id_transaction_from':_0x2dcaae(0x220),'date':_0x2dcaae(0x1f6),'production_date':_0x2dcaae(0x1e1),'expiry_date':_0x2dcaae(0x235),'UOM':'$product.unit'}}]);_0x76f72a[_0x2dcaae(0x1f4)]>0x0&&_0x15139c[_0x2dcaae(0x20e)][_0x1ceb17['invoice']]['push'](..._0x76f72a);}));})),_0x15139c[_0x3d85f4(0x214)]={},await Promise[_0x3d85f4(0x246)](_0x15139c[_0x3d85f4(0x1f9)](async _0x1ba99b=>{var _0x284d24=_0x3d85f4;_0x15139c[_0x284d24(0x214)][_0x1ba99b[_0x284d24(0x236)]]=[],await Promise[_0x284d24(0x246)](_0x1ba99b[_0x284d24(0x222)]['map'](async _0x4cca29=>{var _0x3245a0=_0x284d24;const _0x2fffb6=await transfers_finished[_0x3245a0(0x1e8)]([{'$unwind':_0x3245a0(0x1dd)},{'$match':{'product.id_transaction':_0x4cca29['_id'][_0x3245a0(0x1ea)](),'product.from_invoice':_0x4cca29['invoice']}},{'$project':{'_id':_0x3245a0(0x21f),'product_name':_0x3245a0(0x20b),'product_code':'$product.product_code','quantity_available':_0x3245a0(0x229),'warehouse_name':_0x3245a0(0x1ed),'warehouse_room':_0x3245a0(0x1fb),'product_invoice':'$product.to_room_name','invoice':_0x3245a0(0x20a),'id_transaction_from':_0x3245a0(0x231),'date':'$date','production_date':_0x3245a0(0x1e1),'expiry_date':_0x3245a0(0x235),'UOM':'$product.unit'}}]);_0x2fffb6[_0x3245a0(0x1f4)]>0x0&&_0x15139c[_0x3245a0(0x214)][_0x1ba99b[_0x3245a0(0x236)]][_0x3245a0(0x21e)](..._0x2fffb6);}));})),_0x1b5547[_0x3d85f4(0x22b)]({'purchases_warehouse':_0x15139c,'data_sales':_0x15139c[_0x3d85f4(0x212)],'data_adjustment':_0x15139c[_0x3d85f4(0x20e)],'data_transfer':_0x15139c['data_transfer']});}}}),router[a0_0x20b3e1(0x245)](a0_0x20b3e1(0x20f),auth,async(_0xef8744,_0x2b4d09)=>{var _0x3a54df=a0_0x20b3e1;try{const _0x26ff58=_0xef8744[_0x3a54df(0x1e9)]['id'];var _0x52ada0=await purchases_finished[_0x3a54df(0x225)](_0x26ff58);const _0x3b9a70=await master_shop['find'](),_0x353c0b=_0xef8744['user'],_0xa70e24=await profile[_0x3a54df(0x20d)]({'email':_0x353c0b[_0x3a54df(0x241)]});if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x233))var _0x463d04=users[_0x3a54df(0x219)];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x232))var _0x463d04=users[_0x3a54df(0x232)];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x22c))var _0x463d04=users['German'];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x204))var _0x463d04=users['Spanish'];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x242))var _0x463d04=users[_0x3a54df(0x242)];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x203))var _0x463d04=users[_0x3a54df(0x238)];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x208))var _0x463d04=users['Chinese'];else{if(_0x3b9a70[0x0][_0x3a54df(0x202)]==_0x3a54df(0x1fd))var _0x463d04=users[_0x3a54df(0x1e6)];}}}}}}}_0x2b4d09[_0x3a54df(0x244)](_0x3a54df(0x1f1),{'success':_0xef8744[_0x3a54df(0x201)]('success'),'errors':_0xef8744['flash'](_0x3a54df(0x230)),'master_shop':_0x3b9a70,'profile':_0xa70e24,'role':_0x353c0b,'language':_0x463d04,'data':_0x52ada0});}catch(_0x2dd742){_0x2b4d09[_0x3a54df(0x22b)](_0x2dd742);}}),router['get'](a0_0x20b3e1(0x1e3),auth,async(_0xfecb6b,_0x22d160)=>{var _0x494c49=a0_0x20b3e1;try{const _0x5934cb=_0xfecb6b['params']['id'];var _0x1a8c05=await sales_finished[_0x494c49(0x225)](_0x5934cb);const _0x3672f1=await master_shop['find'](),_0x310f37=_0xfecb6b[_0x494c49(0x1f2)],_0x383cd6=await profile['findOne']({'email':_0x310f37[_0x494c49(0x241)]});if(_0x3672f1[0x0][_0x494c49(0x202)]==_0x494c49(0x233))var _0x4e3195=users[_0x494c49(0x219)];else{if(_0x3672f1[0x0][_0x494c49(0x202)]==_0x494c49(0x232))var _0x4e3195=users[_0x494c49(0x232)];else{if(_0x3672f1[0x0][_0x494c49(0x202)]==_0x494c49(0x22c))var _0x4e3195=users[_0x494c49(0x22c)];else{if(_0x3672f1[0x0][_0x494c49(0x202)]=='Spanish')var _0x4e3195=users['Spanish'];else{if(_0x3672f1[0x0][_0x494c49(0x202)]=='French')var _0x4e3195=users[_0x494c49(0x242)];else{if(_0x3672f1[0x0][_0x494c49(0x202)]==_0x494c49(0x203))var _0x4e3195=users[_0x494c49(0x238)];else{if(_0x3672f1[0x0][_0x494c49(0x202)]=='Chinese')var _0x4e3195=users['Chinese'];else{if(_0x3672f1[0x0][_0x494c49(0x202)]==_0x494c49(0x1fd))var _0x4e3195=users[_0x494c49(0x1e6)];}}}}}}}_0x22d160['render'](_0x494c49(0x234),{'success':_0xfecb6b['flash'](_0x494c49(0x1fa)),'errors':_0xfecb6b[_0x494c49(0x201)](_0x494c49(0x230)),'master_shop':_0x3672f1,'profile':_0x383cd6,'role':_0x310f37,'language':_0x4e3195,'data':_0x1a8c05});}catch(_0x5e98c2){_0x22d160[_0x494c49(0x22b)](_0x5e98c2);}}),router[a0_0x20b3e1(0x245)](a0_0x20b3e1(0x207),auth,async(_0x4bf373,_0x58f9cb)=>{var _0x5d46b8=a0_0x20b3e1;try{const _0x44155d=_0x4bf373[_0x5d46b8(0x1e9)]['id'];var _0x4128ba=await transfers_finished[_0x5d46b8(0x225)](_0x44155d);const _0xc84a57=await master_shop[_0x5d46b8(0x209)](),_0x3e4660=_0x4bf373[_0x5d46b8(0x1f2)],_0x1bbc7a=await profile['findOne']({'email':_0x3e4660['email']});if(_0xc84a57[0x0]['language']==_0x5d46b8(0x233))var _0x178b81=users[_0x5d46b8(0x219)];else{if(_0xc84a57[0x0][_0x5d46b8(0x202)]==_0x5d46b8(0x232))var _0x178b81=users[_0x5d46b8(0x232)];else{if(_0xc84a57[0x0][_0x5d46b8(0x202)]==_0x5d46b8(0x22c))var _0x178b81=users[_0x5d46b8(0x22c)];else{if(_0xc84a57[0x0][_0x5d46b8(0x202)]==_0x5d46b8(0x204))var _0x178b81=users[_0x5d46b8(0x204)];else{if(_0xc84a57[0x0]['language']==_0x5d46b8(0x242))var _0x178b81=users['French'];else{if(_0xc84a57[0x0][_0x5d46b8(0x202)]==_0x5d46b8(0x203))var _0x178b81=users['Portuguese'];else{if(_0xc84a57[0x0][_0x5d46b8(0x202)]==_0x5d46b8(0x208))var _0x178b81=users[_0x5d46b8(0x208)];else{if(_0xc84a57[0x0]['language']=='Arabic\x20(ae)')var _0x178b81=users['Arabic'];}}}}}}}_0x58f9cb['render'](_0x5d46b8(0x23d),{'success':_0x4bf373['flash'](_0x5d46b8(0x1fa)),'errors':_0x4bf373[_0x5d46b8(0x201)](_0x5d46b8(0x230)),'master_shop':_0xc84a57,'profile':_0x1bbc7a,'role':_0x3e4660,'language':_0x178b81,'data':_0x4128ba});}catch(_0x2e57ba){_0x58f9cb[_0x5d46b8(0x22b)](_0x2e57ba);}}),router[a0_0x20b3e1(0x245)]('/viewFG',auth,async(_0xa6f45a,_0x49f874)=>{var _0x454648=a0_0x20b3e1;try{const {username:_0x11144d,email:_0x24b873,role:_0x5476b2}=_0xa6f45a[_0x454648(0x1f2)],_0x466a72=_0xa6f45a[_0x454648(0x1f2)],_0x443535=await profile['findOne']({'email':_0x466a72[_0x454648(0x241)]}),_0x47b71b=await master_shop[_0x454648(0x209)](),_0x3604a8=await warehouse[_0x454648(0x1e8)]([{'$match':{'status':_0x454648(0x22d),'warehouse_category':_0x454648(0x21a)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);if(_0x47b71b[0x0][_0x454648(0x202)]==_0x454648(0x233))var _0x59b143=users['English'];else{if(_0x47b71b[0x0][_0x454648(0x202)]==_0x454648(0x232))var _0x59b143=users[_0x454648(0x232)];else{if(_0x47b71b[0x0][_0x454648(0x202)]=='German')var _0x59b143=users[_0x454648(0x22c)];else{if(_0x47b71b[0x0]['language']==_0x454648(0x204))var _0x59b143=users[_0x454648(0x204)];else{if(_0x47b71b[0x0][_0x454648(0x202)]==_0x454648(0x242))var _0x59b143=users['French'];else{if(_0x47b71b[0x0][_0x454648(0x202)]=='Portuguese\x20(BR)')var _0x59b143=users['Portuguese'];else{if(_0x47b71b[0x0][_0x454648(0x202)]==_0x454648(0x208))var _0x59b143=users[_0x454648(0x208)];else{if(_0x47b71b[0x0][_0x454648(0x202)]==_0x454648(0x1fd))var _0x59b143=users[_0x454648(0x1e6)];}}}}}}}_0x49f874[_0x454648(0x244)]('transaction_finished_raw',{'success':_0xa6f45a['flash'](_0x454648(0x1fa)),'errors':_0xa6f45a['flash']('errors'),'role':_0x466a72,'profile':_0x443535,'master_shop':_0x47b71b,'dataProcess':_0x3604a8,'language':_0x59b143});}catch(_0x1d00e3){console['log'](_0x1d00e3);}}),module[a0_0x20b3e1(0x23c)]=router;