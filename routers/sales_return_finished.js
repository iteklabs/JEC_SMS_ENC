var a0_0x6b5a82=a0_0x190b;(function(_0x42f647,_0x3b13cd){var _0x265a71=a0_0x190b,_0x304902=_0x42f647();while(!![]){try{var _0x1075c4=-parseInt(_0x265a71(0x12f))/0x1+-parseInt(_0x265a71(0x159))/0x2*(-parseInt(_0x265a71(0x170))/0x3)+-parseInt(_0x265a71(0x19b))/0x4*(parseInt(_0x265a71(0x18f))/0x5)+parseInt(_0x265a71(0x144))/0x6+parseInt(_0x265a71(0x139))/0x7*(-parseInt(_0x265a71(0x157))/0x8)+parseInt(_0x265a71(0x131))/0x9*(-parseInt(_0x265a71(0x162))/0xa)+-parseInt(_0x265a71(0x16c))/0xb*(-parseInt(_0x265a71(0x188))/0xc);if(_0x1075c4===_0x3b13cd)break;else _0x304902['push'](_0x304902['shift']());}catch(_0x9b65cb){_0x304902['push'](_0x304902['shift']());}}}(a0_0xcbc0,0x4c3b9));function a0_0x190b(_0x10f8f6,_0x2685f1){var _0xcbc02b=a0_0xcbc0();return a0_0x190b=function(_0x190b2d,_0x380b2f){_0x190b2d=_0x190b2d-0x12f;var _0x49b752=_0xcbc02b[_0x190b2d];return _0x49b752;},a0_0x190b(_0x10f8f6,_0x2685f1);}const express=require('express'),app=express(),router=express[a0_0x6b5a82(0x13f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data,sales_return_finished}=require(a0_0x6b5a82(0x16d)),auth=require('../middleware/auth'),users=require(a0_0x6b5a82(0x175));router[a0_0x6b5a82(0x13b)](a0_0x6b5a82(0x164),auth,async(_0x1b7936,_0x4d6c74)=>{var _0x102df1=a0_0x6b5a82;try{const {username:_0x5c6263,email:_0x33332c,role:_0x24a2f1}=_0x1b7936[_0x102df1(0x17b)],_0x34d2e1=_0x1b7936[_0x102df1(0x17b)],_0x1de262=await profile[_0x102df1(0x1a0)]({'email':_0x34d2e1[_0x102df1(0x17e)]}),_0x10b3e5=await master_shop[_0x102df1(0x13a)](),_0x19e850=await sales_return_finished['aggregate']([{'$lookup':{'from':'customers','localField':_0x102df1(0x19d),'foreignField':_0x102df1(0x138),'as':_0x102df1(0x141)}},{'$unwind':_0x102df1(0x15e)}]);if(_0x10b3e5[0x0]['language']==_0x102df1(0x165)){var _0x8f923=users[_0x102df1(0x1a2)];console[_0x102df1(0x169)](_0x8f923);}else{if(_0x10b3e5[0x0][_0x102df1(0x140)]==_0x102df1(0x199))var _0x8f923=users[_0x102df1(0x199)];else{if(_0x10b3e5[0x0][_0x102df1(0x140)]==_0x102df1(0x16f))var _0x8f923=users[_0x102df1(0x16f)];else{if(_0x10b3e5[0x0][_0x102df1(0x140)]==_0x102df1(0x16a))var _0x8f923=users[_0x102df1(0x16a)];else{if(_0x10b3e5[0x0]['language']==_0x102df1(0x147))var _0x8f923=users[_0x102df1(0x147)];else{if(_0x10b3e5[0x0][_0x102df1(0x140)]=='Portuguese\x20(BR)')var _0x8f923=users[_0x102df1(0x19a)];else{if(_0x10b3e5[0x0][_0x102df1(0x140)]==_0x102df1(0x154))var _0x8f923=users[_0x102df1(0x154)];else{if(_0x10b3e5[0x0][_0x102df1(0x140)]==_0x102df1(0x177))var _0x8f923=users[_0x102df1(0x184)];}}}}}}}_0x4d6c74[_0x102df1(0x133)]('sales_return_finished',{'success':_0x1b7936[_0x102df1(0x198)](_0x102df1(0x18d)),'errors':_0x1b7936[_0x102df1(0x198)]('errors'),'role':_0x34d2e1,'profile':_0x1de262,'master_shop':_0x10b3e5,'user':_0x19e850,'language':_0x8f923});}catch(_0x4d7210){console[_0x102df1(0x169)](_0x4d7210);}}),router[a0_0x6b5a82(0x13b)](a0_0x6b5a82(0x19c),auth,async(_0x3c8cc9,_0x529305)=>{var _0x8160d1=a0_0x6b5a82;try{const {username:_0x38ebea,email:_0x5b8dd9,role:_0x559800}=_0x3c8cc9[_0x8160d1(0x17b)],_0x427af4=_0x3c8cc9[_0x8160d1(0x17b)],_0x35027a=await profile[_0x8160d1(0x1a0)]({'email':_0x427af4[_0x8160d1(0x17e)]}),_0x4877ad=await master_shop['find']();console[_0x8160d1(0x169)]('master',_0x4877ad);const _0x521d69=_0x3c8cc9[_0x8160d1(0x155)]['id'];console[_0x8160d1(0x169)](_0x521d69);var _0x56ebd3=['Return\x20Rooms'];const _0x4331ba=await sales_return_finished['findById'](_0x521d69),_0xb1e1e0=await warehouse[_0x8160d1(0x18b)]([{'$match':{'name':_0x4331ba[_0x8160d1(0x134)],'room':_0x4331ba[_0x8160d1(0x137)]}},{'$unwind':_0x8160d1(0x1a3)},{'$group':{'_id':_0x8160d1(0x167),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x8160d1(0x171)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x8160d1(0x160)},'type':{'$first':_0x8160d1(0x148)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x8160d1(0x194)},'product_code':{'$first':_0x8160d1(0x182)},'storage':{'$first':_0x8160d1(0x145)},'rack':{'$first':_0x8160d1(0x15b)}}}]);console[_0x8160d1(0x169)](_0xb1e1e0);const _0x1155bb=await warehouse[_0x8160d1(0x18b)]([{'$match':{'status':_0x8160d1(0x153),'warehouse_category':_0x8160d1(0x17f)}},{'$group':{'_id':'$name','name':{'$first':_0x8160d1(0x161)}}},{'$sort':{'name':0x1}}]),_0x1fc868=await warehouse['aggregate']([{'$match':{'status':_0x8160d1(0x153),'name':'QA\x20Warehouse'}},{'$group':{'_id':_0x8160d1(0x161),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),_0x52bf14=await product['find']({});if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x165)){var _0x4e1a45=users['English'];console[_0x8160d1(0x169)](_0x4e1a45);}else{if(_0x4877ad[0x0]['language']==_0x8160d1(0x199))var _0x4e1a45=users[_0x8160d1(0x199)];else{if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x16f))var _0x4e1a45=users[_0x8160d1(0x16f)];else{if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x16a))var _0x4e1a45=users[_0x8160d1(0x16a)];else{if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x147))var _0x4e1a45=users[_0x8160d1(0x147)];else{if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x1a1))var _0x4e1a45=users[_0x8160d1(0x19a)];else{if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x154))var _0x4e1a45=users['Chinese'];else{if(_0x4877ad[0x0][_0x8160d1(0x140)]==_0x8160d1(0x177))var _0x4e1a45=users[_0x8160d1(0x184)];}}}}}}}_0x529305[_0x8160d1(0x133)](_0x8160d1(0x156),{'success':_0x3c8cc9['flash']('success'),'errors':_0x3c8cc9[_0x8160d1(0x198)](_0x8160d1(0x173)),'role':_0x427af4,'profile':_0x35027a,'master_shop':_0x4877ad,'user':_0x4331ba,'stock':_0xb1e1e0,'unit':_0x52bf14,'language':_0x4e1a45,'warehouses':_0x1155bb,'rooms':_0x56ebd3,'warehouse_QA':_0x1fc868});}catch(_0x38887d){console[_0x8160d1(0x169)](_0x38887d);}}),router[a0_0x6b5a82(0x168)](a0_0x6b5a82(0x19c),auth,async(_0x38f0cb,_0x1c6058)=>{var _0x4d96ee=a0_0x6b5a82;if(_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x174)]=='QA')try{const _0x2c1acd=_0x38f0cb[_0x4d96ee(0x155)]['id'],_0x5afdbb=await sales_return[_0x4d96ee(0x1a0)]({'invoice':_0x38f0cb[_0x4d96ee(0x146)]['invoice']}),_0x5ea07a=await warehouse[_0x4d96ee(0x1a0)]({'name':_0x5afdbb['ToWarehouse'],'room':_0x5afdbb['ToRoom']}),{invoice:_0x26498a,customer:_0x10b1b0,date:_0x2a8ac5,warehouse_name:_0x5e8072,product_name:_0xf1113b,primary_code:_0x403183,secondary_code:_0x5dba45,product_code:_0x3c2ad9,sales_quantity:_0x1c592d,stocks:_0x3b3958,return_qty:_0xfd25f5,note:_0x827c17,to_warehouse_name_QA:_0x12077e,to_Room_name_QA:_0x535a07}=_0x38f0cb[_0x4d96ee(0x146)];if(typeof product_name_QA==_0x4d96ee(0x19f))var _0x595f50=[_0x38f0cb[_0x4d96ee(0x146)]['product_name_QA']],_0x58bab0=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x130)]],_0x456245=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x136)]],_0x272fb7=[_0x38f0cb['body'][_0x4d96ee(0x17a)]],_0x2b7982=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x152)]],_0x20a925=[_0x38f0cb[_0x4d96ee(0x146)]['stocks_QA']],_0x22ab60=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x158)]];else var _0x595f50=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x14c)]],_0x58bab0=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x130)]],_0x456245=[..._0x38f0cb[_0x4d96ee(0x146)]['secondary_code_QA']],_0x272fb7=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x17a)]],_0x2b7982=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x152)]],_0x20a925=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x15d)]],_0x22ab60=[..._0x38f0cb['body'][_0x4d96ee(0x158)]];const _0x267f68=_0x595f50[_0x4d96ee(0x149)](_0x393919=>{return _0x393919={'product_name':_0x393919};});_0x58bab0[_0x4d96ee(0x181)]((_0x3fbe28,_0x395fb5)=>{_0x267f68[_0x395fb5]['primary_code']=_0x3fbe28;}),_0x456245['forEach']((_0x5242ce,_0x1d68f8)=>{var _0x185bbe=_0x4d96ee;_0x267f68[_0x1d68f8][_0x185bbe(0x195)]=_0x5242ce;}),_0x272fb7[_0x4d96ee(0x181)]((_0x43cb55,_0x33cea0)=>{var _0x40d566=_0x4d96ee;_0x267f68[_0x33cea0][_0x40d566(0x166)]=_0x43cb55;}),_0x2b7982['forEach']((_0x348e95,_0x15e865)=>{_0x267f68[_0x15e865]['sale_qty']=_0x348e95;}),_0x20a925[_0x4d96ee(0x181)]((_0x4412aa,_0x4b1991)=>{var _0x168f92=_0x4d96ee;_0x267f68[_0x4b1991][_0x168f92(0x187)]=_0x4412aa;}),_0x22ab60[_0x4d96ee(0x181)]((_0x328faf,_0x5f967c)=>{var _0x3aae1e=_0x4d96ee;_0x267f68[_0x5f967c][_0x3aae1e(0x19e)]=_0x328faf;}),_0x5afdbb['return_sale_QA'][_0x4d96ee(0x181)](_0xc1cf2a=>{var _0x1102bd=_0x4d96ee;const _0x2038a6=_0x5ea07a[_0x1102bd(0x14f)]['map'](_0x4da9ab=>{var _0x97f61d=_0x1102bd;_0x4da9ab[_0x97f61d(0x13c)]==_0xc1cf2a[_0x97f61d(0x13c)]&&(_0x4da9ab[_0x97f61d(0x14b)]=parseInt(_0x4da9ab[_0x97f61d(0x14b)])+parseInt(_0xc1cf2a[_0x97f61d(0x19e)]));});}),await _0x5ea07a[_0x4d96ee(0x14e)](),_0x5afdbb['invoice']=_0x26498a,_0x5afdbb[_0x4d96ee(0x19d)]=_0x10b1b0,_0x5afdbb['date']=_0x2a8ac5,_0x5afdbb['warehouse_name']=_0x5e8072,_0x5afdbb['return_sale_QA']=_0x267f68,_0x5afdbb[_0x4d96ee(0x15c)]=_0x827c17,_0x5afdbb[_0x4d96ee(0x134)]=_0x12077e,_0x5afdbb[_0x4d96ee(0x137)]=_0x535a07;const _0x48b291=await _0x5afdbb['save'](),_0x314df5=await c_payment_data[_0x4d96ee(0x1a0)]({'invoice':_0x38f0cb[_0x4d96ee(0x146)]['invoice'],'reason':_0x4d96ee(0x151)});_0x314df5['suppliers']=_0x38f0cb['body'][_0x4d96ee(0x18c)],_0x314df5[_0x4d96ee(0x17d)]=_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x17d)],await _0x314df5[_0x4d96ee(0x14e)](),_0x38f0cb[_0x4d96ee(0x198)](_0x4d96ee(0x18d),_0x4d96ee(0x13e)),_0x1c6058[_0x4d96ee(0x176)](_0x4d96ee(0x142));}catch(_0x359f23){console[_0x4d96ee(0x169)](_0x359f23),_0x1c6058['status'](0xc8)['json']({'message':_0x359f23[_0x4d96ee(0x189)]});}else try{const _0x103ba5=_0x38f0cb['params']['id'];console[_0x4d96ee(0x169)](_0x103ba5);const _0x2b8722=await sales_return['findOne']({'invoice':_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x135)]});console['log'](_0x4d96ee(0x14a),_0x2b8722);const _0x5101ff=await warehouse[_0x4d96ee(0x1a0)]({'name':_0x2b8722[_0x4d96ee(0x134)],'room':_0x2b8722[_0x4d96ee(0x137)]});console[_0x4d96ee(0x169)](_0x4d96ee(0x183),_0x5101ff);const {invoice:_0x17fe63,customer:_0x5198b9,date:_0x2c18c8,warehouse_name:_0xcb0aa8,product_name:_0x15d741,primary_code:_0x16c78d,secondary_code:_0x489cdf,product_code:_0x58caa7,sales_quantity:_0x292191,stocks:_0x8e892a,return_qty:_0x3b323e,note:_0x207021,to_warehouse_name:_0x2c22e2,to_Room_name:_0x231689}=_0x38f0cb[_0x4d96ee(0x146)];console[_0x4d96ee(0x169)](_0x38f0cb[_0x4d96ee(0x146)]);if(typeof _0x15d741==_0x4d96ee(0x19f))var _0x595f50=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x13c)]],_0x58bab0=[_0x38f0cb[_0x4d96ee(0x146)]['primary_code']],_0x456245=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x195)]],_0x272fb7=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x166)]],_0x2b7982=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x1a4)]],_0x20a925=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x16b)]],_0x22ab60=[_0x38f0cb['body']['return_qty']],_0x354c9a=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x150)]],_0x44c687=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x191)]],_0x3e1bf1=[_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x143)]],_0x226994=[_0x38f0cb['body'][_0x4d96ee(0x185)]];else var _0x595f50=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x13c)]],_0x58bab0=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x163)]],_0x456245=[..._0x38f0cb[_0x4d96ee(0x146)]['secondary_code']],_0x272fb7=[..._0x38f0cb[_0x4d96ee(0x146)]['product_code']],_0x2b7982=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x1a4)]],_0x20a925=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x16b)]],_0x22ab60=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x19e)]],_0x354c9a=[..._0x38f0cb[_0x4d96ee(0x146)]['bay']],_0x44c687=[..._0x38f0cb[_0x4d96ee(0x146)]['bin']],_0x3e1bf1=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x143)]],_0x226994=[..._0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x185)]];const _0x9f189f=_0x595f50['map'](_0x1e157f=>{return _0x1e157f={'product_name':_0x1e157f};});_0x58bab0[_0x4d96ee(0x181)]((_0x24fc6a,_0x135dad)=>{_0x9f189f[_0x135dad]['primary_code']=_0x24fc6a;}),_0x456245['forEach']((_0x5e3ced,_0x1dca9c)=>{var _0x4302c6=_0x4d96ee;_0x9f189f[_0x1dca9c][_0x4302c6(0x195)]=_0x5e3ced;}),_0x272fb7[_0x4d96ee(0x181)]((_0x503972,_0x54430c)=>{var _0x57af98=_0x4d96ee;_0x9f189f[_0x54430c][_0x57af98(0x166)]=_0x503972;}),_0x2b7982[_0x4d96ee(0x181)]((_0x4d8f24,_0x2edbb3)=>{_0x9f189f[_0x2edbb3]['sale_qty']=_0x4d8f24;}),_0x20a925[_0x4d96ee(0x181)]((_0x239333,_0x312ac3)=>{var _0x461bf2=_0x4d96ee;_0x9f189f[_0x312ac3][_0x461bf2(0x187)]=_0x239333;}),_0x22ab60[_0x4d96ee(0x181)]((_0x144c59,_0x443eb2)=>{var _0x423dce=_0x4d96ee;_0x9f189f[_0x443eb2][_0x423dce(0x19e)]=_0x144c59;}),_0x354c9a[_0x4d96ee(0x181)]((_0x175503,_0x4d0f65)=>{var _0x2ebb75=_0x4d96ee;_0x9f189f[_0x4d0f65][_0x2ebb75(0x150)]=_0x175503;}),_0x44c687[_0x4d96ee(0x181)]((_0x3603fd,_0x2497c5)=>{var _0x13376c=_0x4d96ee;_0x9f189f[_0x2497c5][_0x13376c(0x191)]=_0x3603fd;}),_0x3e1bf1[_0x4d96ee(0x181)]((_0x26f8ee,_0x4ea92e)=>{var _0x444f67=_0x4d96ee;_0x9f189f[_0x4ea92e][_0x444f67(0x179)]=_0x26f8ee;}),_0x226994[_0x4d96ee(0x181)]((_0x3a942f,_0x555564)=>{var _0x1e9143=_0x4d96ee;_0x9f189f[_0x555564][_0x1e9143(0x185)]=_0x3a942f;});var _0x28c6f6=0x0;_0x9f189f['forEach'](_0x1cfeac=>{var _0x46bb87=_0x4d96ee;console[_0x46bb87(0x169)](_0x46bb87(0x16e),_0x1cfeac),(parseInt(_0x1cfeac[_0x46bb87(0x178)])<parseInt(_0x1cfeac[_0x46bb87(0x19e)])||parseInt(_0x1cfeac[_0x46bb87(0x187)])<parseInt(_0x1cfeac[_0x46bb87(0x19e)])&&parseInt(_0x1cfeac['sale_qty'])>parseInt(_0x1cfeac[_0x46bb87(0x19e)])||parseInt(_0x1cfeac['return_qty'])==0x0)&&_0x28c6f6++;});if(_0x28c6f6!=0x0)return _0x38f0cb[_0x4d96ee(0x198)]('errors',_0x4d96ee(0x18a)),_0x1c6058[_0x4d96ee(0x176)](_0x4d96ee(0x14d));_0x2b8722[_0x4d96ee(0x192)][_0x4d96ee(0x181)](_0x177940=>{var _0x481b8f=_0x4d96ee;const _0x3553eb=_0x5101ff[_0x481b8f(0x14f)][_0x481b8f(0x149)](_0x250149=>{var _0x560223=_0x481b8f;_0x250149[_0x560223(0x13c)]==_0x177940['product_name']&&_0x250149[_0x560223(0x185)]==_0x177940[_0x560223(0x185)]&&_0x250149[_0x560223(0x179)]==_0x177940[_0x560223(0x179)]&&_0x250149[_0x560223(0x191)]==_0x177940['bin']&&_0x250149[_0x560223(0x150)]==_0x177940[_0x560223(0x150)]&&(_0x250149[_0x560223(0x14b)]=parseInt(_0x250149['product_stock'])+parseInt(_0x177940[_0x560223(0x19e)]));});}),console[_0x4d96ee(0x169)](_0x4d96ee(0x183),_0x5101ff),await _0x5101ff[_0x4d96ee(0x14e)](),_0x2b8722[_0x4d96ee(0x135)]=_0x17fe63,_0x2b8722[_0x4d96ee(0x19d)]=_0x5198b9,_0x2b8722[_0x4d96ee(0x17d)]=_0x2c18c8,_0x2b8722[_0x4d96ee(0x180)]=_0xcb0aa8,_0x2b8722['return_sale']=_0x9f189f,_0x2b8722[_0x4d96ee(0x15c)]=_0x207021,_0x2b8722[_0x4d96ee(0x134)]=_0x2c22e2,_0x2b8722['ToRoom']=_0x231689;const _0x2b35f6=await _0x2b8722[_0x4d96ee(0x14e)]();console[_0x4d96ee(0x169)]('new\x20new_data',_0x2b35f6);const _0x7d4bcb=await c_payment_data[_0x4d96ee(0x1a0)]({'invoice':_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x135)],'reason':_0x4d96ee(0x151)});_0x7d4bcb['suppliers']=_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x18c)],_0x7d4bcb[_0x4d96ee(0x17d)]=_0x38f0cb[_0x4d96ee(0x146)][_0x4d96ee(0x17d)],await _0x7d4bcb[_0x4d96ee(0x14e)](),_0x38f0cb[_0x4d96ee(0x198)](_0x4d96ee(0x18d),_0x4d96ee(0x13e)),_0x1c6058[_0x4d96ee(0x176)](_0x4d96ee(0x132));}catch(_0x1405f3){console[_0x4d96ee(0x169)](_0x1405f3),_0x1c6058[_0x4d96ee(0x15a)](0xc8)[_0x4d96ee(0x186)]({'message':_0x1405f3['message']});}}),router['post'](a0_0x6b5a82(0x15f),auth,async(_0x1ec0f1,_0x3234f5)=>{var _0x4525ca=a0_0x6b5a82;try{const _0x14de3e=_0x1ec0f1[_0x4525ca(0x155)]['id'],{invoice:_0x23ccfd,customer:_0x26da13,payable_to_customer:_0x5a388d,paid_amount:_0x414c9a}=_0x1ec0f1['body'],_0xfb43b3=await sales_return['findById'](_0x14de3e);console[_0x4525ca(0x169)](_0x4525ca(0x193),_0xfb43b3),console[_0x4525ca(0x169)](_0x5a388d),console['log'](_0x414c9a);var _0x1074cd=_0x5a388d-_0x414c9a;console[_0x4525ca(0x169)]('subtract',_0x1074cd),_0xfb43b3['paid_amount']=parseFloat(_0x414c9a)+parseFloat(_0xfb43b3['paid_amount']),_0xfb43b3['due_amount']=_0x1074cd,console[_0x4525ca(0x169)](_0xfb43b3);const _0x25183f=await _0xfb43b3[_0x4525ca(0x14e)]();console['log'](0x1b207);const _0x5324c1=await c_payment_data[_0x4525ca(0x1a0)]({'invoice':_0x1ec0f1[_0x4525ca(0x146)][_0x4525ca(0x135)],'reason':_0x4525ca(0x151)});console[_0x4525ca(0x169)]('c_payment',_0x5324c1),_0x5324c1['amount']=_0x1074cd,await _0x5324c1[_0x4525ca(0x14e)]();let _0x25af3f=new Date(),_0x464b07=('0'+_0x25af3f['getDate']())[_0x4525ca(0x13d)](-0x2),_0x308be1=('0'+(_0x25af3f[_0x4525ca(0x172)]()+0x1))[_0x4525ca(0x13d)](-0x2),_0x45d403=_0x25af3f[_0x4525ca(0x190)](),_0x480b77=_0x45d403+'-'+_0x308be1+'-'+_0x464b07;const _0x48b891=new customer_payment({'invoice':_0x23ccfd,'date':_0x45d403+'-'+_0x308be1+'-'+_0x464b07,'customer':_0x26da13,'reason':'Returned\x20Payment\x20For\x20Sale\x20Return','amount':_0x414c9a}),_0xd1c831=await _0x48b891[_0x4525ca(0x14e)]();_0x1ec0f1[_0x4525ca(0x198)](_0x4525ca(0x18d),_0x4525ca(0x197)),_0x3234f5[_0x4525ca(0x176)](_0x4525ca(0x132));}catch(_0x2dab24){console[_0x4525ca(0x169)](_0x2dab24);}}),router[a0_0x6b5a82(0x13b)]('/invoice/:id',auth,async(_0x125983,_0x375937)=>{var _0x4a431f=a0_0x6b5a82;try{const {username:_0x5294b2,email:_0x24e520,role:_0x4f64a4}=_0x125983[_0x4a431f(0x17b)],_0x40e72=_0x125983[_0x4a431f(0x17b)],_0x1e52e2=await profile[_0x4a431f(0x1a0)]({'email':_0x40e72[_0x4a431f(0x17e)]}),_0x5b27e5=await master_shop[_0x4a431f(0x13a)]();console['log'](_0x4a431f(0x196),_0x5b27e5);const _0xee1d16=_0x125983['params']['id'],_0x36d775=await sales_return[_0x4a431f(0x18e)](_0xee1d16);console['log'](_0x36d775);const _0x13c670=await customer['findOne']({'name':_0x36d775[_0x4a431f(0x19d)]});console[_0x4a431f(0x169)](_0x13c670);if(_0x5b27e5[0x0]['language']=='English\x20(US)'){var _0x3bb271=users[_0x4a431f(0x1a2)];console[_0x4a431f(0x169)](_0x3bb271);}else{if(_0x5b27e5[0x0][_0x4a431f(0x140)]==_0x4a431f(0x199))var _0x3bb271=users[_0x4a431f(0x199)];else{if(_0x5b27e5[0x0][_0x4a431f(0x140)]==_0x4a431f(0x16f))var _0x3bb271=users[_0x4a431f(0x16f)];else{if(_0x5b27e5[0x0][_0x4a431f(0x140)]==_0x4a431f(0x16a))var _0x3bb271=users['Spanish'];else{if(_0x5b27e5[0x0][_0x4a431f(0x140)]==_0x4a431f(0x147))var _0x3bb271=users[_0x4a431f(0x147)];else{if(_0x5b27e5[0x0]['language']==_0x4a431f(0x1a1))var _0x3bb271=users['Portuguese'];else{if(_0x5b27e5[0x0][_0x4a431f(0x140)]==_0x4a431f(0x154))var _0x3bb271=users[_0x4a431f(0x154)];else{if(_0x5b27e5[0x0][_0x4a431f(0x140)]==_0x4a431f(0x177))var _0x3bb271=users[_0x4a431f(0x184)];}}}}}}}_0x375937[_0x4a431f(0x133)](_0x4a431f(0x17c),{'success':_0x125983[_0x4a431f(0x198)](_0x4a431f(0x18d)),'errors':_0x125983[_0x4a431f(0x198)]('errors'),'role':_0x40e72,'profile':_0x1e52e2,'master_shop':_0x5b27e5,'customers':_0x13c670,'sales':_0x36d775,'language':_0x3bb271});}catch(_0x43f4f1){console[_0x4a431f(0x169)](_0x43f4f1);}}),module['exports']=router;function a0_0xcbc0(){var _0x4448e4=['data','$product_details.secondary_code','secondary_code','master','payment\x20successfull','flash','Hindi','Portuguese','4ypeQmL','/view/:id','customer','return_qty','string','findOne','Portuguese\x20(BR)','English','$product_details','sales_quantity','193231XrPmPZ','primary_code_QA','9BPNzbm','/sales_return/view','render','ToWarehouse','invoice','secondary_code_QA','ToRoom','name','11872JnsGUX','find','get','product_name','slice','purchase\x20return\x20successfully','Router','language','customer_docs','/sales_return_finished/view','types','2068638tNQxUo','$product_details.storage','body','French','$product_details.type','map','old_data','product_stock','product_name_QA','back','save','product_details','bay','Sale\x20Return','sales_quantity_QA','Enabled','Chinese','params','return_sale_edit_finished','1640zINjIN','return_qty_QA','12evqFvE','status','$product_details.rack','note','stocks_QA','$customer_docs','/give_payment/:id','$product_details.bin','$name','1554370yukUZf','primary_code','/view','English\x20(US)','product_code','$product_details._id','post','log','Spanish','stocks','11KaQmWm','../models/all_models','foreach\x20newproduct','German','33567cSCaqT','$product_details.product_stock','getMonth','errors','for_categorize','../public/language/languages.json','redirect','Arabic\x20(ae)','sale_qty','type','product_code_QA','user','sales_return_invoice','date','email','Finished\x20Goods','warehouse_name','forEach','$product_details.product_code','old_warehouse_data','Arabic','floorlevel','json','stock','10765596tqXetE','message','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','aggregate','suppliers','success','findById','1502215bUIWex','getFullYear','bin','return_sale'];a0_0xcbc0=function(){return _0x4448e4;};return a0_0xcbc0();}