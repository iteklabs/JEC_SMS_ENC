const a0_0x335adb=a0_0x1c8b;(function(_0x4c5d72,_0x57128a){const _0x187a78=a0_0x1c8b,_0x367f5f=_0x4c5d72();while(!![]){try{const _0x33d8c3=-parseInt(_0x187a78(0x143))/0x1+-parseInt(_0x187a78(0x10d))/0x2*(-parseInt(_0x187a78(0x137))/0x3)+-parseInt(_0x187a78(0x146))/0x4+-parseInt(_0x187a78(0x14e))/0x5+-parseInt(_0x187a78(0x10f))/0x6+-parseInt(_0x187a78(0x176))/0x7+parseInt(_0x187a78(0x13b))/0x8;if(_0x33d8c3===_0x57128a)break;else _0x367f5f['push'](_0x367f5f['shift']());}catch(_0x23a7f2){_0x367f5f['push'](_0x367f5f['shift']());}}}(a0_0x4bca,0x811c3));const express=require(a0_0x335adb(0x14d)),app=express(),router=express[a0_0x335adb(0x11a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x335adb(0x144)),auth=require(a0_0x335adb(0x11c)),users=require(a0_0x335adb(0x157));function a0_0x1c8b(_0x4c616d,_0xc20526){const _0x4bca9c=a0_0x4bca();return a0_0x1c8b=function(_0x1c8bde,_0x5ebab9){_0x1c8bde=_0x1c8bde-0x106;let _0x513673=_0x4bca9c[_0x1c8bde];return _0x513673;},a0_0x1c8b(_0x4c616d,_0xc20526);}router[a0_0x335adb(0x12c)]('/view',auth,async(_0x4d04c5,_0x563efa)=>{const _0x1ebacf=a0_0x335adb;try{const {username:_0x1e620b,email:_0x37ac26,role:_0x4a44cf}=_0x4d04c5[_0x1ebacf(0x12f)],_0x40c5d8=_0x4d04c5[_0x1ebacf(0x12f)],_0x4d3084=await profile['findOne']({'email':_0x40c5d8[_0x1ebacf(0x109)]}),_0x23c899=await master_shop[_0x1ebacf(0x11d)]();console[_0x1ebacf(0x154)](_0x1ebacf(0x178),_0x23c899);const _0x1d3cf6=await purchases_return_finished[_0x1ebacf(0x152)]([{'$lookup':{'from':'suppliers','localField':_0x1ebacf(0x149),'foreignField':_0x1ebacf(0x158),'as':_0x1ebacf(0x179)}},{'$unwind':_0x1ebacf(0x106)},{'$unwind':_0x1ebacf(0x113)},{'$group':{'_id':_0x1ebacf(0x127),'invoice':{'$first':_0x1ebacf(0x170)},'date':{'$first':_0x1ebacf(0x128)},'suppliers':{'$first':'$suppliers'},'warehouse_name':{'$first':_0x1ebacf(0x111)},'product_name':{'$first':'$return_product.product_name'},'return_qty':{'$first':_0x1ebacf(0x110)},'price':{'$first':_0x1ebacf(0x123)},'total':{'$sum':_0x1ebacf(0x125)},'note':{'$first':_0x1ebacf(0x132)},'total_amount':{'$first':'$total_amount'},'discount':{'$first':_0x1ebacf(0x117)},'receivable':{'$first':_0x1ebacf(0x145)},'received':{'$first':_0x1ebacf(0x166)},'due_amount':{'$first':_0x1ebacf(0x165)},'mobile':{'$first':_0x1ebacf(0x15a)},'email':{'$first':'$supplier_docs.email'},'address':{'$first':'$supplier_docs.address'},'return_sum_qty':{'$sum':_0x1ebacf(0x110)}}}]);console[_0x1ebacf(0x154)](_0x1d3cf6);if(_0x23c899[0x0]['language']=='English\x20(US)'){var _0x306c6f=users[_0x1ebacf(0x12a)];console[_0x1ebacf(0x154)](_0x306c6f);}else{if(_0x23c899[0x0][_0x1ebacf(0x13d)]==_0x1ebacf(0x141))var _0x306c6f=users[_0x1ebacf(0x141)];else{if(_0x23c899[0x0]['language']==_0x1ebacf(0x11e))var _0x306c6f=users[_0x1ebacf(0x11e)];else{if(_0x23c899[0x0][_0x1ebacf(0x13d)]==_0x1ebacf(0x161))var _0x306c6f=users[_0x1ebacf(0x161)];else{if(_0x23c899[0x0][_0x1ebacf(0x13d)]==_0x1ebacf(0x14c))var _0x306c6f=users[_0x1ebacf(0x14c)];else{if(_0x23c899[0x0][_0x1ebacf(0x13d)]=='Portuguese\x20(BR)')var _0x306c6f=users[_0x1ebacf(0x15c)];else{if(_0x23c899[0x0][_0x1ebacf(0x13d)]=='Chinese')var _0x306c6f=users[_0x1ebacf(0x107)];else{if(_0x23c899[0x0][_0x1ebacf(0x13d)]==_0x1ebacf(0x16d))var _0x306c6f=users['Arabic'];}}}}}}}_0x563efa[_0x1ebacf(0x114)](_0x1ebacf(0x108),{'success':_0x4d04c5['flash'](_0x1ebacf(0x16c)),'errors':_0x4d04c5[_0x1ebacf(0x174)](_0x1ebacf(0x12d)),'role':_0x40c5d8,'profile':_0x4d3084,'master_shop':_0x23c899,'user':_0x1d3cf6,'language':_0x306c6f});}catch(_0x8fb003){console[_0x1ebacf(0x154)](_0x8fb003);}}),router[a0_0x335adb(0x12c)](a0_0x335adb(0x169),auth,async(_0x13843c,_0xbb9284)=>{const _0x1d646d=a0_0x335adb;try{const {username:_0x23ee72,email:_0x34a653,role:_0x3f14a3}=_0x13843c[_0x1d646d(0x12f)],_0x533593=_0x13843c[_0x1d646d(0x12f)],_0x4de228=await profile['findOne']({'email':_0x533593['email']}),_0x37760e=await product[_0x1d646d(0x11d)]({}),_0x568c94=await master_shop[_0x1d646d(0x11d)](),_0xf9e441=_0x13843c[_0x1d646d(0x150)]['id'],_0xeeb9f0=await purchases_return_finished['findById'](_0xf9e441),_0x1b7578=await warehouse['aggregate']([{'$match':{'name':_0xeeb9f0[_0x1d646d(0x16f)],'room':_0xeeb9f0[_0x1d646d(0x12b)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x1d646d(0x16e)},{'$group':{'_id':_0x1d646d(0x126),'name':{'$first':_0x1d646d(0x129)},'product_stock':{'$first':_0x1d646d(0x17b)},'bay':{'$first':_0x1d646d(0x171)},'bin':{'$first':_0x1d646d(0x112)},'type':{'$first':_0x1d646d(0x124)},'floorlevel':{'$first':_0x1d646d(0x135)},'primary_code':{'$first':_0x1d646d(0x12e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1d646d(0x16a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1d646d(0x164)}}}]);warehouse_data=await warehouse[_0x1d646d(0x152)]([{'$match':{'status':_0x1d646d(0x13c),'name':_0x1d646d(0x156),'warehouse_category':_0x1d646d(0x120)}},{'$group':{'_id':_0x1d646d(0x14a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x1d646d(0x154)](_0x1d646d(0x167),_0x1b7578);if(_0x568c94[0x0][_0x1d646d(0x13d)]==_0x1d646d(0x15f)){var _0x1bfba2=users[_0x1d646d(0x12a)];console['log'](_0x1bfba2);}else{if(_0x568c94[0x0][_0x1d646d(0x13d)]==_0x1d646d(0x141))var _0x1bfba2=users['Hindi'];else{if(_0x568c94[0x0]['language']=='German')var _0x1bfba2=users[_0x1d646d(0x11e)];else{if(_0x568c94[0x0]['language']==_0x1d646d(0x161))var _0x1bfba2=users[_0x1d646d(0x161)];else{if(_0x568c94[0x0][_0x1d646d(0x13d)]==_0x1d646d(0x14c))var _0x1bfba2=users[_0x1d646d(0x14c)];else{if(_0x568c94[0x0][_0x1d646d(0x13d)]==_0x1d646d(0x17c))var _0x1bfba2=users[_0x1d646d(0x15c)];else{if(_0x568c94[0x0][_0x1d646d(0x13d)]==_0x1d646d(0x107))var _0x1bfba2=users[_0x1d646d(0x107)];else{if(_0x568c94[0x0][_0x1d646d(0x13d)]==_0x1d646d(0x16d))var _0x1bfba2=users[_0x1d646d(0x134)];}}}}}}}_0xbb9284[_0x1d646d(0x114)](_0x1d646d(0x177),{'success':_0x13843c[_0x1d646d(0x174)](_0x1d646d(0x16c)),'errors':_0x13843c[_0x1d646d(0x174)](_0x1d646d(0x12d)),'role':_0x533593,'master_shop':_0x568c94,'profile':_0x4de228,'user':_0xeeb9f0,'stock':_0x1b7578,'product':_0x37760e,'language':_0x1bfba2,'warehouse':warehouse_data});}catch(_0x9ec5e3){console[_0x1d646d(0x154)](_0x9ec5e3);}}),router['post'](a0_0x335adb(0x169),auth,async(_0x1155b8,_0x206e5f)=>{const _0x281958=a0_0x335adb;try{const _0x7f6c34=_0x1155b8[_0x281958(0x150)]['id'],_0x58393d=await purchases_return_finished[_0x281958(0x130)]({'invoice':_0x1155b8[_0x281958(0x17e)][_0x281958(0x168)]}),_0x41fddd=await warehouse[_0x281958(0x130)]({'name':_0x58393d['to_warehouse_name'],'room':_0x58393d[_0x281958(0x133)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x4c075f,suppliers:_0x594d12,date:_0x4bc289,warehouse_name:_0x21a163,product_name:_0x54bffe,purchase_quantity:_0x5520f9,stocks:_0x49bc6f,return_qty:_0x361069,note:_0x5c55a2,Room_name:_0x510314,level:_0x302790,isle:_0x4c99ce,pallet:_0x2073fb,to_warehouse_name:_0x48e09c,to_Room_name:_0x51c762}=_0x1155b8[_0x281958(0x17e)];if(typeof _0x54bffe=='string')var _0x2a4298=[_0x1155b8[_0x281958(0x17e)]['product_name']],_0x24de7e=[_0x1155b8[_0x281958(0x17e)][_0x281958(0x163)]],_0x28a42f=[_0x1155b8[_0x281958(0x17e)]['stocks']],_0x586178=[_0x1155b8['body'][_0x281958(0x173)]],_0x436ff6=[_0x1155b8['body'][_0x281958(0x175)]],_0x4c8274=[_0x1155b8[_0x281958(0x17e)][_0x281958(0x11b)]],_0x5d88e8=[_0x1155b8[_0x281958(0x17e)][_0x281958(0x115)]],_0x2f3b74=[_0x1155b8['body'][_0x281958(0x148)]];else var _0x2a4298=[..._0x1155b8[_0x281958(0x17e)][_0x281958(0x153)]],_0x24de7e=[..._0x1155b8[_0x281958(0x17e)]['purchase_quantity']],_0x28a42f=[..._0x1155b8['body'][_0x281958(0x122)]],_0x586178=[..._0x1155b8['body'][_0x281958(0x173)]],_0x436ff6=[..._0x1155b8[_0x281958(0x17e)][_0x281958(0x175)]],_0x4c8274=[..._0x1155b8['body'][_0x281958(0x11b)]],_0x5d88e8=[..._0x1155b8['body'][_0x281958(0x115)]],_0x2f3b74=[..._0x1155b8[_0x281958(0x17e)][_0x281958(0x148)]];const _0x2503ad=_0x2a4298[_0x281958(0x17d)](_0x2e7e3d=>{return _0x2e7e3d={'product_name':_0x2e7e3d};});_0x24de7e[_0x281958(0x118)]((_0xda5aca,_0x3011b0)=>{const _0x2d6cad=_0x281958;_0x2503ad[_0x3011b0][_0x2d6cad(0x163)]=_0xda5aca;}),_0x28a42f['forEach']((_0x4690cb,_0xe61176)=>{_0x2503ad[_0xe61176]['stock_quantity']=_0x4690cb;}),_0x586178[_0x281958(0x118)]((_0x22b7c2,_0x165f32)=>{const _0x195aa5=_0x281958;_0x2503ad[_0x165f32][_0x195aa5(0x173)]=_0x22b7c2;}),_0x436ff6[_0x281958(0x118)]((_0x5f4744,_0x63f57e)=>{_0x2503ad[_0x63f57e]['bay']=_0x5f4744;}),_0x4c8274[_0x281958(0x118)]((_0x127cbf,_0x1ade89)=>{const _0x17e44b=_0x281958;_0x2503ad[_0x1ade89][_0x17e44b(0x172)]=_0x127cbf;}),_0x5d88e8[_0x281958(0x118)]((_0x20f9b4,_0x3acf61)=>{const _0x3f91e9=_0x281958;_0x2503ad[_0x3acf61][_0x3f91e9(0x119)]=_0x20f9b4;}),_0x2f3b74[_0x281958(0x118)]((_0x1bcfd6,_0x4b2ee7)=>{const _0x5d47c5=_0x281958;_0x2503ad[_0x4b2ee7][_0x5d47c5(0x10e)]=_0x1bcfd6;});var _0x295985=0x0;_0x2503ad[_0x281958(0x118)](_0x4e0082=>{const _0x5bb786=_0x281958;(parseInt(_0x4e0082[_0x5bb786(0x163)])<parseInt(_0x4e0082['return_qty'])||parseInt(_0x4e0082['stock_quantity'])<parseInt(_0x4e0082[_0x5bb786(0x173)]))&&_0x295985++;});if(_0x295985!=0x0)return _0x1155b8[_0x281958(0x174)](_0x281958(0x12d),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x206e5f['redirect'](_0x281958(0x16b));_0x58393d['return_product']['forEach'](_0x2f14d8=>{const _0x45d3cf=_0x281958;if(_0x2f14d8['return_qty']>0x0){const _0x37b325=_0x41fddd[_0x45d3cf(0x14f)]['map'](_0x487524=>{const _0x446147=_0x45d3cf;_0x487524[_0x446147(0x153)]==_0x2f14d8['product_name']&&_0x487524[_0x446147(0x136)]==_0x2f14d8['bay']&&(_0x487524[_0x446147(0x10b)]=parseInt(_0x487524[_0x446147(0x10b)])+parseInt(_0x2f14d8[_0x446147(0x173)]));});}}),await _0x41fddd[_0x281958(0x13e)](),_0x58393d['invoice']=_0x4c075f,_0x58393d[_0x281958(0x149)]=_0x594d12,_0x58393d[_0x281958(0x116)]=_0x4bc289,_0x58393d['warehouse_name']=_0x21a163,_0x58393d['return_product']=_0x2503ad,_0x58393d[_0x281958(0x138)]=_0x5c55a2,_0x58393d[_0x281958(0x12b)]=_0x510314,_0x58393d[_0x281958(0x131)]=_0x48e09c,_0x58393d[_0x281958(0x133)]=_0x51c762;const _0x4b77e4=await _0x58393d[_0x281958(0x13e)](),_0x4be36d=await purchases_return_finished[_0x281958(0x130)]({'invoice':_0x1155b8[_0x281958(0x17e)]['invoice']}),_0x580c58=await warehouse[_0x281958(0x130)]({'name':_0x1155b8[_0x281958(0x17e)][_0x281958(0x131)],'room':_0x1155b8['body']['to_Room_name'],'warehouse_category':'Finished\x20Goods'});_0x4be36d['return_product'][_0x281958(0x118)](_0x58fd36=>{const _0x52126a=_0x281958;_0x580c58[_0x52126a(0x14f)][_0x52126a(0x17d)](_0x27cb15=>{const _0x22c4d6=_0x52126a;_0x27cb15[_0x22c4d6(0x153)]==_0x58fd36['product_name']&&_0x27cb15[_0x22c4d6(0x136)]==_0x58fd36[_0x22c4d6(0x136)]&&(_0x27cb15['product_stock']=parseInt(_0x27cb15['product_stock'])-parseInt(_0x58fd36['return_qty']));});}),await _0x580c58[_0x281958(0x13e)]();const _0x369116=await s_payment_data[_0x281958(0x130)]({'invoice':_0x1155b8['body'][_0x281958(0x168)],'reason':_0x281958(0x159)});await _0x369116[_0x281958(0x13e)](),_0x1155b8[_0x281958(0x174)](_0x281958(0x16c),_0x281958(0x11f)),_0x206e5f[_0x281958(0x10a)](_0x281958(0x162));}catch(_0x7630f7){console[_0x281958(0x154)](_0x7630f7),_0x206e5f[_0x281958(0x151)](0xc8)[_0x281958(0x155)]({'message':_0x7630f7[_0x281958(0x142)]});}}),router[a0_0x335adb(0x12c)]('/invoice/:id',auth,async(_0x789874,_0x208977)=>{const _0xfb9cda=a0_0x335adb;try{const {username:_0x37db81,email:_0x11b236,role:_0xe61cf6}=_0x789874[_0xfb9cda(0x12f)],_0x914f9b=_0x789874[_0xfb9cda(0x12f)],_0x58e10a=await profile['findOne']({'email':_0x914f9b[_0xfb9cda(0x109)]}),_0x37ea42=await master_shop['find']();console[_0xfb9cda(0x154)]('master',_0x37ea42);const _0x3578d4=_0x789874[_0xfb9cda(0x150)]['id'],_0x124931=await purchases_return[_0xfb9cda(0x13f)](_0x3578d4);console['log'](_0x124931);const _0x321f6f=await suppliers[_0xfb9cda(0x130)]({'name':_0x124931[_0xfb9cda(0x149)]});console['log'](_0x321f6f);if(_0x37ea42[0x0]['language']=='English\x20(US)'){var _0x1f1546=users[_0xfb9cda(0x12a)];console[_0xfb9cda(0x154)](_0x1f1546);}else{if(_0x37ea42[0x0][_0xfb9cda(0x13d)]==_0xfb9cda(0x141))var _0x1f1546=users[_0xfb9cda(0x141)];else{if(_0x37ea42[0x0][_0xfb9cda(0x13d)]=='German')var _0x1f1546=users[_0xfb9cda(0x11e)];else{if(_0x37ea42[0x0]['language']==_0xfb9cda(0x161))var _0x1f1546=users[_0xfb9cda(0x161)];else{if(_0x37ea42[0x0][_0xfb9cda(0x13d)]==_0xfb9cda(0x14c))var _0x1f1546=users[_0xfb9cda(0x14c)];else{if(_0x37ea42[0x0][_0xfb9cda(0x13d)]==_0xfb9cda(0x17c))var _0x1f1546=users['Portuguese'];else{if(_0x37ea42[0x0][_0xfb9cda(0x13d)]=='Chinese')var _0x1f1546=users['Chinese'];else{if(_0x37ea42[0x0][_0xfb9cda(0x13d)]==_0xfb9cda(0x16d))var _0x1f1546=users[_0xfb9cda(0x134)];}}}}}}}_0x208977['render'](_0xfb9cda(0x140),{'success':_0x789874[_0xfb9cda(0x174)](_0xfb9cda(0x16c)),'errors':_0x789874['flash'](_0xfb9cda(0x12d)),'role':_0x914f9b,'profile':_0x58e10a,'master_shop':_0x37ea42,'supplier':_0x321f6f,'purchase':_0x124931,'language':_0x1f1546});}catch(_0x593b3d){console['log'](_0x593b3d);}}),router[a0_0x335adb(0x15b)](a0_0x335adb(0x15e),auth,async(_0x14fded,_0x1e818a)=>{const _0x560c0d=a0_0x335adb;try{const _0x4f8926=_0x14fded[_0x560c0d(0x150)]['id'],{invoice:_0x20528c,suppliers:_0x57fdbe,receivable_amount:_0x3e5510,received_amount:_0x3b41a6}=_0x14fded[_0x560c0d(0x17e)],_0x50ed22=await purchases_return[_0x560c0d(0x13f)](_0x4f8926);console[_0x560c0d(0x154)](_0x50ed22);var _0x34ced2=_0x3e5510-_0x3b41a6;console['log'](_0x3b41a6),_0x50ed22['received']=parseFloat(_0x3b41a6)+parseFloat(_0x50ed22[_0x560c0d(0x15d)]),_0x50ed22['due_amount']=_0x34ced2,console[_0x560c0d(0x154)](_0x50ed22);const _0xe4424f=await _0x50ed22[_0x560c0d(0x13e)](),_0x355daa=await s_payment_data[_0x560c0d(0x130)]({'invoice':_0x14fded[_0x560c0d(0x17e)][_0x560c0d(0x168)],'reason':_0x560c0d(0x159)});_0x355daa['amount']=_0x34ced2,await _0x355daa[_0x560c0d(0x13e)]();let _0x3c54be=new Date(),_0x169211=('0'+_0x3c54be[_0x560c0d(0x139)]())[_0x560c0d(0x13a)](-0x2),_0x38f284=('0'+(_0x3c54be[_0x560c0d(0x17a)]()+0x1))[_0x560c0d(0x13a)](-0x2),_0x543cd7=_0x3c54be[_0x560c0d(0x121)](),_0x8895c4=_0x543cd7+'-'+_0x38f284+'-'+_0x169211;const _0x280209=new suppliers_payment({'invoice':_0x20528c,'date':_0x543cd7+'-'+_0x38f284+'-'+_0x169211,'suppliers':_0x57fdbe,'reason':_0x560c0d(0x10c),'amount':_0x3b41a6}),_0x4048f7=await _0x280209['save']();_0x14fded[_0x560c0d(0x174)](_0x560c0d(0x16c),_0x560c0d(0x14b)),_0x1e818a['redirect'](_0x560c0d(0x147));}catch(_0x1a2ddc){console[_0x560c0d(0x154)](_0x1a2ddc);}}),module[a0_0x335adb(0x160)]=router;function a0_0x4bca(){const _0x5699ff=['return_purchase_edit_finished','master','supplier_docs','getMonth','$product_details.product_stock','Portuguese\x20(BR)','map','body','$return_product','Chinese','purchases_return_finished','email','redirect','product_stock','Received\x20For\x20Purchase\x20Return','6wjQQOd','secondary_code','266610tBleuc','$return_product.return_qty','$warehouse_name','$product_details.bin','$supplier_docs','render','primary_code_hide','date','$discount','forEach','primary_code','Router','product_code_hide','../middleware/auth','find','German','purchase\x20return\x20successfully','Finished\x20Goods','getFullYear','stocks','$return_product.price','$product_details.type','$return_product.total','$product_details._id','$_id','$date','$product_details.product_name','English','room','get','errors','$product_details.primary_code','user','findOne','to_warehouse_name','$note','to_room','Arabic','$product_details.floorlevel','bay','374217MdkKXu','note','getDate','slice','15740160XqNZWM','Enabled','language','save','findById','return_purchase_invoice','Hindi','message','475815lHlHtc','../models/all_models','$receivable','2242056gtQmVz','/purchases_return/view','secondary_code_hide','suppliers','$name','payment\x20successfull','French','express','3113305GlcCvF','product_details','params','status','aggregate','product_name','log','json','Return\x20Goods','../public/language/languages.json','name','Purchase\x20Return','$supplier_docs.mobile','post','Portuguese','received','/receive_payment/:id','English\x20(US)','exports','Spanish','/purchases_return_finished/view','purchase_quantity','$product_details.rack','$due_amount','$received','stock_data','invoice','/view/:id','$product_details.product_code','back','success','Arabic\x20(ae)','$product_details','warehouse_name','$invoice','$product_details.bay','product_code','return_qty','flash','level','766339lueITh'];a0_0x4bca=function(){return _0x5699ff;};return a0_0x4bca();}