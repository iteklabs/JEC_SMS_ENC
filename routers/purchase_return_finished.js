const a0_0x463fec=a0_0x32e2;function a0_0x32e2(_0x2e03c6,_0x505d0a){const _0x1a50ec=a0_0x1a50();return a0_0x32e2=function(_0x32e2d1,_0x108972){_0x32e2d1=_0x32e2d1-0xc7;let _0x596b30=_0x1a50ec[_0x32e2d1];return _0x596b30;},a0_0x32e2(_0x2e03c6,_0x505d0a);}(function(_0xe089c3,_0x6e801){const _0x318429=a0_0x32e2,_0x26f7fb=_0xe089c3();while(!![]){try{const _0x4b205b=-parseInt(_0x318429(0xe9))/0x1*(parseInt(_0x318429(0xee))/0x2)+-parseInt(_0x318429(0x119))/0x3*(parseInt(_0x318429(0x12d))/0x4)+parseInt(_0x318429(0xf2))/0x5*(parseInt(_0x318429(0xd0))/0x6)+parseInt(_0x318429(0xdf))/0x7*(-parseInt(_0x318429(0xf7))/0x8)+parseInt(_0x318429(0x129))/0x9+parseInt(_0x318429(0x118))/0xa+parseInt(_0x318429(0x12b))/0xb*(-parseInt(_0x318429(0xfe))/0xc);if(_0x4b205b===_0x6e801)break;else _0x26f7fb['push'](_0x26f7fb['shift']());}catch(_0x571bd4){_0x26f7fb['push'](_0x26f7fb['shift']());}}}(a0_0x1a50,0x2a0e1));const express=require(a0_0x463fec(0x111)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require('../models/all_models'),auth=require(a0_0x463fec(0xcd)),users=require('../public/language/languages.json');router['get'](a0_0x463fec(0xeb),auth,async(_0x4fc35e,_0x3f2f4e)=>{const _0x37b981=a0_0x463fec;try{const {username:_0x4a8854,email:_0x2f244b,role:_0x8f361a}=_0x4fc35e['user'],_0x4388c2=_0x4fc35e[_0x37b981(0xf0)],_0x461cc7=await profile[_0x37b981(0x10a)]({'email':_0x4388c2[_0x37b981(0xf1)]}),_0x5658f1=await master_shop['find']();console[_0x37b981(0x11a)](_0x37b981(0x109),_0x5658f1);const _0x2eaf18=await purchases_return_finished[_0x37b981(0x10f)]([{'$lookup':{'from':_0x37b981(0xd7),'localField':'suppliers','foreignField':'name','as':_0x37b981(0x11b)}},{'$unwind':_0x37b981(0xea)},{'$unwind':_0x37b981(0x103)},{'$group':{'_id':_0x37b981(0xff),'invoice':{'$first':_0x37b981(0x136)},'date':{'$first':'$date'},'suppliers':{'$first':_0x37b981(0xdb)},'warehouse_name':{'$first':'$warehouse_name'},'product_name':{'$first':'$return_product.product_name'},'return_qty':{'$first':_0x37b981(0xcb)},'price':{'$first':_0x37b981(0x101)},'total':{'$sum':_0x37b981(0x110)},'note':{'$first':_0x37b981(0x10e)},'total_amount':{'$first':_0x37b981(0x104)},'discount':{'$first':_0x37b981(0xf6)},'receivable':{'$first':_0x37b981(0x131)},'received':{'$first':_0x37b981(0x123)},'due_amount':{'$first':_0x37b981(0xe0)},'mobile':{'$first':'$supplier_docs.mobile'},'email':{'$first':_0x37b981(0x139)},'address':{'$first':_0x37b981(0x132)},'return_sum_qty':{'$sum':'$return_product.return_qty'}}}]);console[_0x37b981(0x11a)](_0x2eaf18);if(_0x5658f1[0x0][_0x37b981(0xf5)]==_0x37b981(0xfc)){var _0x282685=users[_0x37b981(0xda)];console['log'](_0x282685);}else{if(_0x5658f1[0x0]['language']==_0x37b981(0xc9))var _0x282685=users[_0x37b981(0xc9)];else{if(_0x5658f1[0x0][_0x37b981(0xf5)]==_0x37b981(0xe4))var _0x282685=users[_0x37b981(0xe4)];else{if(_0x5658f1[0x0][_0x37b981(0xf5)]=='Spanish')var _0x282685=users[_0x37b981(0xd3)];else{if(_0x5658f1[0x0][_0x37b981(0xf5)]==_0x37b981(0xed))var _0x282685=users['French'];else{if(_0x5658f1[0x0]['language']==_0x37b981(0xc7))var _0x282685=users['Portuguese'];else{if(_0x5658f1[0x0][_0x37b981(0xf5)]==_0x37b981(0x120))var _0x282685=users[_0x37b981(0x120)];else{if(_0x5658f1[0x0]['language']==_0x37b981(0x10d))var _0x282685=users[_0x37b981(0x130)];}}}}}}}_0x3f2f4e[_0x37b981(0xe6)]('purchases_return_finished',{'success':_0x4fc35e[_0x37b981(0xf9)]('success'),'errors':_0x4fc35e[_0x37b981(0xf9)](_0x37b981(0x10b)),'role':_0x4388c2,'profile':_0x461cc7,'master_shop':_0x5658f1,'user':_0x2eaf18,'language':_0x282685});}catch(_0x158198){console['log'](_0x158198);}}),router[a0_0x463fec(0x127)](a0_0x463fec(0x108),auth,async(_0x13ca66,_0x963dff)=>{const _0x137d34=a0_0x463fec;try{const {username:_0x20557a,email:_0x36a506,role:_0x2c0504}=_0x13ca66[_0x137d34(0xf0)],_0x264013=_0x13ca66[_0x137d34(0xf0)],_0x53d05a=await profile[_0x137d34(0x10a)]({'email':_0x264013['email']}),_0x1ff0d8=await product[_0x137d34(0x135)]({}),_0x35dba0=await master_shop[_0x137d34(0x135)](),_0x2013c6=_0x13ca66[_0x137d34(0x122)]['id'],_0x128ff5=await purchases_return_finished[_0x137d34(0x10c)](_0x2013c6),_0x32e76e=await warehouse[_0x137d34(0x10f)]([{'$match':{'name':_0x128ff5[_0x137d34(0xfa)],'room':_0x128ff5['room'],'warehouse_category':'Finished\x20Goods'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x137d34(0xe5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x137d34(0xd2)},'bay':{'$first':_0x137d34(0x106)},'bin':{'$first':_0x137d34(0x11d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x137d34(0xf3)},'secondary_code':{'$first':_0x137d34(0xfd)},'product_code':{'$first':_0x137d34(0x11c)},'storage':{'$first':_0x137d34(0xc8)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x137d34(0x10f)]([{'$match':{'status':_0x137d34(0x128),'name':_0x137d34(0x13b),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x137d34(0xcc),'name':{'$first':_0x137d34(0xcc)}}},{'$sort':{'name':0x1}}]),console['log'](_0x137d34(0x13c),_0x32e76e);if(_0x35dba0[0x0]['language']==_0x137d34(0xfc)){var _0x444eec=users['English'];console['log'](_0x444eec);}else{if(_0x35dba0[0x0][_0x137d34(0xf5)]=='Hindi')var _0x444eec=users[_0x137d34(0xc9)];else{if(_0x35dba0[0x0]['language']==_0x137d34(0xe4))var _0x444eec=users['German'];else{if(_0x35dba0[0x0][_0x137d34(0xf5)]==_0x137d34(0xd3))var _0x444eec=users['Spanish'];else{if(_0x35dba0[0x0]['language']==_0x137d34(0xed))var _0x444eec=users[_0x137d34(0xed)];else{if(_0x35dba0[0x0][_0x137d34(0xf5)]==_0x137d34(0xc7))var _0x444eec=users[_0x137d34(0xd4)];else{if(_0x35dba0[0x0][_0x137d34(0xf5)]==_0x137d34(0x120))var _0x444eec=users[_0x137d34(0x120)];else{if(_0x35dba0[0x0]['language']==_0x137d34(0x10d))var _0x444eec=users[_0x137d34(0x130)];}}}}}}}_0x963dff[_0x137d34(0xe6)]('return_purchase_edit_finished',{'success':_0x13ca66[_0x137d34(0xf9)](_0x137d34(0xe7)),'errors':_0x13ca66[_0x137d34(0xf9)](_0x137d34(0x10b)),'role':_0x264013,'master_shop':_0x35dba0,'profile':_0x53d05a,'user':_0x128ff5,'stock':_0x32e76e,'product':_0x1ff0d8,'language':_0x444eec,'warehouse':warehouse_data});}catch(_0x3f1735){console['log'](_0x3f1735);}}),router[a0_0x463fec(0x133)]('/view/:id',auth,async(_0x5f0a1a,_0x55c987)=>{const _0x3141fa=a0_0x463fec;try{const _0x3aac8a=_0x5f0a1a[_0x3141fa(0x122)]['id'],_0xeb137b=await purchases_return_finished['findOne']({'invoice':_0x5f0a1a['body'][_0x3141fa(0xfb)]}),_0x44a911=await warehouse[_0x3141fa(0x10a)]({'name':_0xeb137b['to_warehouse_name'],'room':_0xeb137b[_0x3141fa(0x105)],'warehouse_category':_0x3141fa(0xde)}),{invoice:_0x180d8b,suppliers:_0x55462d,date:_0x1b753a,warehouse_name:_0x436e3d,product_name:_0xccb495,purchase_quantity:_0x1a6cf,stocks:_0x2849cc,return_qty:_0x39307f,note:_0x3e1aff,Room_name:_0x5cc18d,level:_0xe4a17e,isle:_0x113748,pallet:_0x2b1888,to_warehouse_name:_0x4246a2,to_Room_name:_0x4a2a98}=_0x5f0a1a[_0x3141fa(0xef)];if(typeof _0xccb495==_0x3141fa(0x11e))var _0x4e3046=[_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xe1)]],_0x4d9140=[_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xf4)]],_0x1b8d74=[_0x5f0a1a[_0x3141fa(0xef)]['stocks']],_0x59d44f=[_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0x13a)]],_0x3404f8=[_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xe8)]],_0x3301af=[_0x5f0a1a['body'][_0x3141fa(0x124)]],_0x465d57=[_0x5f0a1a[_0x3141fa(0xef)]['primary_code_hide']],_0x3a48b4=[_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xd9)]];else var _0x4e3046=[..._0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xe1)]],_0x4d9140=[..._0x5f0a1a['body'][_0x3141fa(0xf4)]],_0x1b8d74=[..._0x5f0a1a['body'][_0x3141fa(0xd5)]],_0x59d44f=[..._0x5f0a1a[_0x3141fa(0xef)]['return_qty']],_0x3404f8=[..._0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xe8)]],_0x3301af=[..._0x5f0a1a['body'][_0x3141fa(0x124)]],_0x465d57=[..._0x5f0a1a['body'][_0x3141fa(0xe2)]],_0x3a48b4=[..._0x5f0a1a[_0x3141fa(0xef)]['secondary_code_hide']];const _0x539a6d=_0x4e3046['map'](_0x46f571=>{return _0x46f571={'product_name':_0x46f571};});_0x4d9140['forEach']((_0x2a5160,_0x351690)=>{const _0x3b84fa=_0x3141fa;_0x539a6d[_0x351690][_0x3b84fa(0xf4)]=_0x2a5160;}),_0x1b8d74[_0x3141fa(0xdc)]((_0x2930bf,_0x1d68f9)=>{const _0x4c0c86=_0x3141fa;_0x539a6d[_0x1d68f9][_0x4c0c86(0x11f)]=_0x2930bf;}),_0x59d44f[_0x3141fa(0xdc)]((_0x3d15b1,_0x4261d8)=>{const _0x52311e=_0x3141fa;_0x539a6d[_0x4261d8][_0x52311e(0x13a)]=_0x3d15b1;}),_0x3404f8[_0x3141fa(0xdc)]((_0x521be0,_0x2c223a)=>{const _0x4f1fc1=_0x3141fa;_0x539a6d[_0x2c223a][_0x4f1fc1(0x138)]=_0x521be0;}),_0x3301af['forEach']((_0x351303,_0x3a719f)=>{const _0x2e0f05=_0x3141fa;_0x539a6d[_0x3a719f][_0x2e0f05(0xce)]=_0x351303;}),_0x465d57['forEach']((_0x584521,_0x318a5f)=>{_0x539a6d[_0x318a5f]['primary_code']=_0x584521;}),_0x3a48b4[_0x3141fa(0xdc)]((_0x5c00f9,_0x40d194)=>{const _0x557cd0=_0x3141fa;_0x539a6d[_0x40d194][_0x557cd0(0x134)]=_0x5c00f9;});var _0x291fb1=0x0;_0x539a6d[_0x3141fa(0xdc)](_0x2210cc=>{const _0x38adf8=_0x3141fa;(parseInt(_0x2210cc['purchase_quantity'])<parseInt(_0x2210cc['return_qty'])||parseInt(_0x2210cc[_0x38adf8(0x11f)])<parseInt(_0x2210cc['return_qty']))&&_0x291fb1++;});if(_0x291fb1!=0x0)return _0x5f0a1a['flash'](_0x3141fa(0x10b),_0x3141fa(0x102)),_0x55c987[_0x3141fa(0x12c)](_0x3141fa(0x113));_0xeb137b[_0x3141fa(0x125)][_0x3141fa(0xdc)](_0x27340c=>{const _0x59344c=_0x3141fa;if(_0x27340c[_0x59344c(0x13a)]>0x0){const _0x5330fd=_0x44a911[_0x59344c(0xcf)]['map'](_0x473518=>{const _0x2936e6=_0x59344c;_0x473518[_0x2936e6(0xe1)]==_0x27340c[_0x2936e6(0xe1)]&&_0x473518[_0x2936e6(0x138)]==_0x27340c[_0x2936e6(0x138)]&&(_0x473518[_0x2936e6(0x116)]=parseInt(_0x473518[_0x2936e6(0x116)])+parseInt(_0x27340c[_0x2936e6(0x13a)]));});}}),await _0x44a911['save'](),_0xeb137b['invoice']=_0x180d8b,_0xeb137b[_0x3141fa(0xd7)]=_0x55462d,_0xeb137b['date']=_0x1b753a,_0xeb137b[_0x3141fa(0xfa)]=_0x436e3d,_0xeb137b['return_product']=_0x539a6d,_0xeb137b[_0x3141fa(0x115)]=_0x3e1aff,_0xeb137b[_0x3141fa(0x12a)]=_0x5cc18d,_0xeb137b[_0x3141fa(0x117)]=_0x4246a2,_0xeb137b['to_room']=_0x4a2a98;const _0x483fe3=await _0xeb137b[_0x3141fa(0x12e)](),_0x383ff0=await purchases_return_finished['findOne']({'invoice':_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0xfb)]}),_0x31989f=await warehouse['findOne']({'name':_0x5f0a1a[_0x3141fa(0xef)][_0x3141fa(0x117)],'room':_0x5f0a1a['body']['to_Room_name'],'warehouse_category':_0x3141fa(0xde)});_0x383ff0['return_product'][_0x3141fa(0xdc)](_0x3b8210=>{const _0x57931b=_0x3141fa;_0x31989f['product_details'][_0x57931b(0x12f)](_0x22c97c=>{const _0x242030=_0x57931b;_0x22c97c[_0x242030(0xe1)]==_0x3b8210['product_name']&&_0x22c97c[_0x242030(0x138)]==_0x3b8210[_0x242030(0x138)]&&(_0x22c97c[_0x242030(0x116)]=parseInt(_0x22c97c[_0x242030(0x116)])-parseInt(_0x3b8210[_0x242030(0x13a)]));});}),await _0x31989f['save']();const _0x4e4bdf=await s_payment_data[_0x3141fa(0x10a)]({'invoice':_0x5f0a1a['body'][_0x3141fa(0xfb)],'reason':_0x3141fa(0xec)});await _0x4e4bdf[_0x3141fa(0x12e)](),_0x5f0a1a[_0x3141fa(0xf9)]('success',_0x3141fa(0x137)),_0x55c987['redirect'](_0x3141fa(0xd1));}catch(_0x3126df){console[_0x3141fa(0x11a)](_0x3126df),_0x55c987[_0x3141fa(0xe3)](0xc8)[_0x3141fa(0x107)]({'message':_0x3126df[_0x3141fa(0xf8)]});}}),router[a0_0x463fec(0x127)]('/invoice/:id',auth,async(_0x479336,_0x2ab6d2)=>{const _0x3addb4=a0_0x463fec;try{const {username:_0x36673b,email:_0x15b5bb,role:_0x45a8b1}=_0x479336[_0x3addb4(0xf0)],_0xa24ab1=_0x479336[_0x3addb4(0xf0)],_0x1afda4=await profile['findOne']({'email':_0xa24ab1['email']}),_0x16bdc9=await master_shop[_0x3addb4(0x135)]();console[_0x3addb4(0x11a)]('master',_0x16bdc9);const _0x356b2b=_0x479336['params']['id'],_0x5c7f39=await purchases_return[_0x3addb4(0x10c)](_0x356b2b);console[_0x3addb4(0x11a)](_0x5c7f39);const _0x2104d6=await suppliers['findOne']({'name':_0x5c7f39[_0x3addb4(0xd7)]});console[_0x3addb4(0x11a)](_0x2104d6);if(_0x16bdc9[0x0][_0x3addb4(0xf5)]==_0x3addb4(0xfc)){var _0x4e1636=users['English'];console[_0x3addb4(0x11a)](_0x4e1636);}else{if(_0x16bdc9[0x0][_0x3addb4(0xf5)]=='Hindi')var _0x4e1636=users['Hindi'];else{if(_0x16bdc9[0x0][_0x3addb4(0xf5)]==_0x3addb4(0xe4))var _0x4e1636=users[_0x3addb4(0xe4)];else{if(_0x16bdc9[0x0]['language']==_0x3addb4(0xd3))var _0x4e1636=users[_0x3addb4(0xd3)];else{if(_0x16bdc9[0x0][_0x3addb4(0xf5)]==_0x3addb4(0xed))var _0x4e1636=users[_0x3addb4(0xed)];else{if(_0x16bdc9[0x0][_0x3addb4(0xf5)]==_0x3addb4(0xc7))var _0x4e1636=users[_0x3addb4(0xd4)];else{if(_0x16bdc9[0x0][_0x3addb4(0xf5)]==_0x3addb4(0x120))var _0x4e1636=users['Chinese'];else{if(_0x16bdc9[0x0][_0x3addb4(0xf5)]==_0x3addb4(0x10d))var _0x4e1636=users['Arabic'];}}}}}}}_0x2ab6d2[_0x3addb4(0xe6)](_0x3addb4(0x114),{'success':_0x479336['flash'](_0x3addb4(0xe7)),'errors':_0x479336[_0x3addb4(0xf9)](_0x3addb4(0x10b)),'role':_0xa24ab1,'profile':_0x1afda4,'master_shop':_0x16bdc9,'supplier':_0x2104d6,'purchase':_0x5c7f39,'language':_0x4e1636});}catch(_0xcceeda){console[_0x3addb4(0x11a)](_0xcceeda);}}),router[a0_0x463fec(0x133)](a0_0x463fec(0xd8),auth,async(_0x30e6d3,_0x5b5a6e)=>{const _0x38f3fe=a0_0x463fec;try{const _0x56bb2b=_0x30e6d3['params']['id'],{invoice:_0x92913,suppliers:_0x558d29,receivable_amount:_0x3a5ac2,received_amount:_0x1b8f25}=_0x30e6d3[_0x38f3fe(0xef)],_0x3d3c9c=await purchases_return[_0x38f3fe(0x10c)](_0x56bb2b);console['log'](_0x3d3c9c);var _0x4f6331=_0x3a5ac2-_0x1b8f25;console['log'](_0x1b8f25),_0x3d3c9c['received']=parseFloat(_0x1b8f25)+parseFloat(_0x3d3c9c[_0x38f3fe(0x121)]),_0x3d3c9c[_0x38f3fe(0xca)]=_0x4f6331,console[_0x38f3fe(0x11a)](_0x3d3c9c);const _0x3659e5=await _0x3d3c9c['save'](),_0x248148=await s_payment_data[_0x38f3fe(0x10a)]({'invoice':_0x30e6d3[_0x38f3fe(0xef)]['invoice'],'reason':_0x38f3fe(0xec)});_0x248148[_0x38f3fe(0x100)]=_0x4f6331,await _0x248148['save']();let _0x1f73fc=new Date(),_0x2a30eb=('0'+_0x1f73fc[_0x38f3fe(0xd6)]())[_0x38f3fe(0x126)](-0x2),_0x56ccd1=('0'+(_0x1f73fc['getMonth']()+0x1))[_0x38f3fe(0x126)](-0x2),_0x4fbc95=_0x1f73fc['getFullYear'](),_0x1711ce=_0x4fbc95+'-'+_0x56ccd1+'-'+_0x2a30eb;const _0x5752d8=new suppliers_payment({'invoice':_0x92913,'date':_0x4fbc95+'-'+_0x56ccd1+'-'+_0x2a30eb,'suppliers':_0x558d29,'reason':_0x38f3fe(0x112),'amount':_0x1b8f25}),_0x345bc5=await _0x5752d8[_0x38f3fe(0x12e)]();_0x30e6d3['flash'](_0x38f3fe(0xe7),'payment\x20successfull'),_0x5b5a6e['redirect'](_0x38f3fe(0xdd));}catch(_0xae2ee2){console[_0x38f3fe(0x11a)](_0xae2ee2);}}),module['exports']=router;function a0_0x1a50(){const _0x2f4496=['flash','warehouse_name','invoice','English\x20(US)','$product_details.secondary_code','2876376RAcvsP','$_id','amount','$return_product.price','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$supplier_docs','$total_amount','to_room','$product_details.bay','json','/view/:id','master','findOne','errors','findById','Arabic\x20(ae)','$note','aggregate','$return_product.total','express','Received\x20For\x20Purchase\x20Return','back','return_purchase_invoice','note','product_stock','to_warehouse_name','1993160zKcVXT','51297uDmKGg','log','supplier_docs','$product_details.product_code','$product_details.bin','string','stock_quantity','Chinese','received','params','$received','product_code_hide','return_product','slice','get','Enabled','1662534zRSqkJ','room','11ZMJXww','redirect','60WmFLiM','save','map','Arabic','$receivable','$supplier_docs.address','post','secondary_code','find','$invoice','purchase\x20return\x20successfully','bay','$supplier_docs.email','return_qty','Return\x20Goods','stock_data','Portuguese\x20(BR)','$product_details.storage','Hindi','due_amount','$return_product.return_qty','$name','../middleware/auth','product_code','product_details','265458cVQRxM','/purchases_return_finished/view','$product_details.product_stock','Spanish','Portuguese','stocks','getDate','suppliers','/receive_payment/:id','secondary_code_hide','English','$suppliers','forEach','/purchases_return/view','Finished\x20Goods','763NTIJUo','$due_amount','product_name','primary_code_hide','status','German','$product_details._id','render','success','level','1500HaVzlV','$return_product','/view','Purchase\x20Return','French','24hypNFI','body','user','email','35vKLoZq','$product_details.primary_code','purchase_quantity','language','$discount','536depINh','message'];a0_0x1a50=function(){return _0x2f4496;};return a0_0x1a50();}