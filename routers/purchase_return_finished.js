const a0_0x29ccc8=a0_0x1d69;function a0_0x1d69(_0x1c7472,_0x202739){const _0x3b4cc8=a0_0x3b4c();return a0_0x1d69=function(_0x1d6923,_0x497d12){_0x1d6923=_0x1d6923-0x12b;let _0x2a57e4=_0x3b4cc8[_0x1d6923];return _0x2a57e4;},a0_0x1d69(_0x1c7472,_0x202739);}(function(_0x3781bb,_0x3ebffe){const _0x53a69a=a0_0x1d69,_0xc35b6c=_0x3781bb();while(!![]){try{const _0x467a1f=-parseInt(_0x53a69a(0x12c))/0x1+-parseInt(_0x53a69a(0x17c))/0x2+parseInt(_0x53a69a(0x168))/0x3+parseInt(_0x53a69a(0x199))/0x4*(-parseInt(_0x53a69a(0x17d))/0x5)+-parseInt(_0x53a69a(0x131))/0x6*(parseInt(_0x53a69a(0x14b))/0x7)+parseInt(_0x53a69a(0x18a))/0x8*(-parseInt(_0x53a69a(0x133))/0x9)+parseInt(_0x53a69a(0x195))/0xa*(parseInt(_0x53a69a(0x13d))/0xb);if(_0x467a1f===_0x3ebffe)break;else _0xc35b6c['push'](_0xc35b6c['shift']());}catch(_0x1fbae9){_0xc35b6c['push'](_0xc35b6c['shift']());}}}(a0_0x3b4c,0x709f9));function a0_0x3b4c(){const _0x54dbd1=['product_name','$note','German','suppliers','invoice','map','$suppliers','$return_product.return_qty','findOne','return_qty','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','purchases_return_finished','Portuguese\x20(BR)','primary_code','Finished\x20Goods','Router','1741680mHDFcW','success','$product_details.product_code','note','post','Chinese','$product_details.type','$product_details.bin','/view/:id','$product_details.primary_code','getDate','stocks','log','$warehouse_name','flash','Spanish','warehouse_name','to_room','$return_product.product_name','date','535164jUUHYE','1135sHqAFX','$return_product.price','$total_amount','aggregate','supplier_docs','secondary_code','secondary_code_hide','primary_code_hide','redirect','getFullYear','purchase_quantity','bay','payment\x20successfull','904imvDhf','$product_details.storage','due_amount','errors','Hindi','message','Return\x20Goods','$receivable','$date','$supplier_docs.mobile','string','30BNVkyc','slice','render','$supplier_docs','9124xazVzm','getMonth','received','$product_details','product_stock','room','name','$product_details.rack','English','French','$product_details.product_name','263327rDIrzi','back','../public/language/languages.json','language','English\x20(US)','2535978mjfOzM','exports','9513QQbIVN','save','master','json','Purchase\x20Return','amount','purchase\x20return\x20successfully','to_warehouse_name','$product_details.bay','express','5395665ulOoot','params','level','Enabled','$supplier_docs.address','product_code_hide','stock_data','return_product','get','Portuguese','status','findById','body','find','7qJgfuv','/purchases_return_finished/view','email','$product_details.secondary_code','to_Room_name','../middleware/auth','Arabic\x20(ae)','Arabic','forEach','$_id','return_purchase_invoice','user','/receive_payment/:id'];a0_0x3b4c=function(){return _0x54dbd1;};return a0_0x3b4c();}const express=require(a0_0x29ccc8(0x13c)),app=express(),router=express[a0_0x29ccc8(0x167)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require('../models/all_models'),auth=require(a0_0x29ccc8(0x150)),users=require(a0_0x29ccc8(0x12e));router[a0_0x29ccc8(0x145)]('/view',auth,async(_0x191ff0,_0x4b6fee)=>{const _0x5ad186=a0_0x29ccc8;try{const {username:_0x185020,email:_0xbe75fa,role:_0x56a39c}=_0x191ff0[_0x5ad186(0x156)],_0x456ddf=_0x191ff0[_0x5ad186(0x156)],_0x2c7fe7=await profile[_0x5ad186(0x160)]({'email':_0x456ddf[_0x5ad186(0x14d)]}),_0x1ae524=await master_shop['find']();console[_0x5ad186(0x174)](_0x5ad186(0x135),_0x1ae524);const _0x2e5290=await purchases_return_finished[_0x5ad186(0x180)]([{'$lookup':{'from':_0x5ad186(0x15b),'localField':_0x5ad186(0x15b),'foreignField':_0x5ad186(0x19f),'as':_0x5ad186(0x181)}},{'$unwind':'$return_product'},{'$unwind':_0x5ad186(0x198)},{'$group':{'_id':_0x5ad186(0x154),'invoice':{'$first':'$invoice'},'date':{'$first':_0x5ad186(0x192)},'suppliers':{'$first':_0x5ad186(0x15e)},'warehouse_name':{'$first':_0x5ad186(0x175)},'product_name':{'$first':_0x5ad186(0x17a)},'return_qty':{'$first':_0x5ad186(0x15f)},'price':{'$first':_0x5ad186(0x17e)},'total':{'$sum':'$return_product.total'},'note':{'$first':_0x5ad186(0x159)},'total_amount':{'$first':_0x5ad186(0x17f)},'discount':{'$first':'$discount'},'receivable':{'$first':_0x5ad186(0x191)},'received':{'$first':'$received'},'due_amount':{'$first':'$due_amount'},'mobile':{'$first':_0x5ad186(0x193)},'email':{'$first':'$supplier_docs.email'},'address':{'$first':_0x5ad186(0x141)},'return_sum_qty':{'$sum':_0x5ad186(0x15f)}}}]);console[_0x5ad186(0x174)](_0x2e5290);if(_0x1ae524[0x0]['language']=='English\x20(US)'){var _0xe7d066=users[_0x5ad186(0x1a1)];console[_0x5ad186(0x174)](_0xe7d066);}else{if(_0x1ae524[0x0][_0x5ad186(0x12f)]==_0x5ad186(0x18e))var _0xe7d066=users['Hindi'];else{if(_0x1ae524[0x0]['language']==_0x5ad186(0x15a))var _0xe7d066=users[_0x5ad186(0x15a)];else{if(_0x1ae524[0x0][_0x5ad186(0x12f)]=='Spanish')var _0xe7d066=users['Spanish'];else{if(_0x1ae524[0x0][_0x5ad186(0x12f)]=='French')var _0xe7d066=users[_0x5ad186(0x1a2)];else{if(_0x1ae524[0x0][_0x5ad186(0x12f)]=='Portuguese\x20(BR)')var _0xe7d066=users[_0x5ad186(0x146)];else{if(_0x1ae524[0x0][_0x5ad186(0x12f)]==_0x5ad186(0x16d))var _0xe7d066=users[_0x5ad186(0x16d)];else{if(_0x1ae524[0x0][_0x5ad186(0x12f)]==_0x5ad186(0x151))var _0xe7d066=users[_0x5ad186(0x152)];}}}}}}}_0x4b6fee[_0x5ad186(0x197)](_0x5ad186(0x163),{'success':_0x191ff0[_0x5ad186(0x176)](_0x5ad186(0x169)),'errors':_0x191ff0[_0x5ad186(0x176)]('errors'),'role':_0x456ddf,'profile':_0x2c7fe7,'master_shop':_0x1ae524,'user':_0x2e5290,'language':_0xe7d066});}catch(_0x33dfd7){console['log'](_0x33dfd7);}}),router['get'](a0_0x29ccc8(0x170),auth,async(_0x133daf,_0x7f6f81)=>{const _0x3d3886=a0_0x29ccc8;try{const {username:_0x5ca596,email:_0x3937d9,role:_0x424f22}=_0x133daf['user'],_0x5e5fef=_0x133daf[_0x3d3886(0x156)],_0xd3ba69=await profile[_0x3d3886(0x160)]({'email':_0x5e5fef['email']}),_0x27159e=await product['find']({}),_0x37293c=await master_shop[_0x3d3886(0x14a)](),_0x5d81f1=_0x133daf[_0x3d3886(0x13e)]['id'],_0x401193=await purchases_return_finished[_0x3d3886(0x148)](_0x5d81f1),_0x52c222=await warehouse[_0x3d3886(0x180)]([{'$match':{'name':_0x401193['warehouse_name'],'room':_0x401193[_0x3d3886(0x19e)],'warehouse_category':_0x3d3886(0x166)}},{'$unwind':_0x3d3886(0x19c)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3d3886(0x12b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3d3886(0x13b)},'bin':{'$first':_0x3d3886(0x16f)},'type':{'$first':_0x3d3886(0x16e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3d3886(0x171)},'secondary_code':{'$first':_0x3d3886(0x14e)},'product_code':{'$first':_0x3d3886(0x16a)},'storage':{'$first':_0x3d3886(0x18b)},'rack':{'$first':_0x3d3886(0x1a0)}}}]);warehouse_data=await warehouse[_0x3d3886(0x180)]([{'$match':{'status':_0x3d3886(0x140),'name':_0x3d3886(0x190),'warehouse_category':_0x3d3886(0x166)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x3d3886(0x143),_0x52c222);if(_0x37293c[0x0]['language']==_0x3d3886(0x130)){var _0x581bc3=users[_0x3d3886(0x1a1)];console['log'](_0x581bc3);}else{if(_0x37293c[0x0][_0x3d3886(0x12f)]=='Hindi')var _0x581bc3=users[_0x3d3886(0x18e)];else{if(_0x37293c[0x0]['language']==_0x3d3886(0x15a))var _0x581bc3=users[_0x3d3886(0x15a)];else{if(_0x37293c[0x0][_0x3d3886(0x12f)]==_0x3d3886(0x177))var _0x581bc3=users[_0x3d3886(0x177)];else{if(_0x37293c[0x0][_0x3d3886(0x12f)]==_0x3d3886(0x1a2))var _0x581bc3=users[_0x3d3886(0x1a2)];else{if(_0x37293c[0x0][_0x3d3886(0x12f)]==_0x3d3886(0x164))var _0x581bc3=users[_0x3d3886(0x146)];else{if(_0x37293c[0x0]['language']=='Chinese')var _0x581bc3=users[_0x3d3886(0x16d)];else{if(_0x37293c[0x0][_0x3d3886(0x12f)]==_0x3d3886(0x151))var _0x581bc3=users['Arabic'];}}}}}}}_0x7f6f81[_0x3d3886(0x197)]('return_purchase_edit_finished',{'success':_0x133daf['flash']('success'),'errors':_0x133daf['flash'](_0x3d3886(0x18d)),'role':_0x5e5fef,'master_shop':_0x37293c,'profile':_0xd3ba69,'user':_0x401193,'stock':_0x52c222,'product':_0x27159e,'language':_0x581bc3,'warehouse':warehouse_data});}catch(_0x2f479b){console[_0x3d3886(0x174)](_0x2f479b);}}),router[a0_0x29ccc8(0x16c)]('/view/:id',auth,async(_0x1d101f,_0x5d6772)=>{const _0x1aab27=a0_0x29ccc8;try{const _0x34ba25=_0x1d101f['params']['id'],_0x1425fe=await purchases_return_finished['findOne']({'invoice':_0x1d101f['body']['invoice']}),_0x3cdcd2=await warehouse[_0x1aab27(0x160)]({'name':_0x1425fe[_0x1aab27(0x13a)],'room':_0x1425fe[_0x1aab27(0x179)],'warehouse_category':_0x1aab27(0x166)}),{invoice:_0x58cb2a,suppliers:_0xd4081f,date:_0x148eb3,warehouse_name:_0x57996b,product_name:_0x43d7d5,purchase_quantity:_0x5af845,stocks:_0x4cd3d6,return_qty:_0x1aab6a,note:_0x446c4d,Room_name:_0x46acf7,level:_0x4b75ed,isle:_0x164a6e,pallet:_0xa2f01c,to_warehouse_name:_0x32cd0e,to_Room_name:_0x1f1cff}=_0x1d101f['body'];if(typeof _0x43d7d5==_0x1aab27(0x194))var _0x3074fb=[_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x158)]],_0x28019b=[_0x1d101f['body']['purchase_quantity']],_0x27252c=[_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x173)]],_0x4dccf3=[_0x1d101f[_0x1aab27(0x149)]['return_qty']],_0x31ce44=[_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x13f)]],_0x1363eb=[_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x142)]],_0x5ebaf2=[_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x184)]],_0x5e18d5=[_0x1d101f[_0x1aab27(0x149)]['secondary_code_hide']];else var _0x3074fb=[..._0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x158)]],_0x28019b=[..._0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x187)]],_0x27252c=[..._0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x173)]],_0x4dccf3=[..._0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x161)]],_0x31ce44=[..._0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x13f)]],_0x1363eb=[..._0x1d101f['body'][_0x1aab27(0x142)]],_0x5ebaf2=[..._0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x184)]],_0x5e18d5=[..._0x1d101f['body'][_0x1aab27(0x183)]];const _0x2cfcee=_0x3074fb['map'](_0x3d581e=>{return _0x3d581e={'product_name':_0x3d581e};});_0x28019b[_0x1aab27(0x153)]((_0xfcc5e0,_0x445d6d)=>{const _0x2ea8a7=_0x1aab27;_0x2cfcee[_0x445d6d][_0x2ea8a7(0x187)]=_0xfcc5e0;}),_0x27252c[_0x1aab27(0x153)]((_0x1bd728,_0x5cffd7)=>{_0x2cfcee[_0x5cffd7]['stock_quantity']=_0x1bd728;}),_0x4dccf3[_0x1aab27(0x153)]((_0x59345d,_0x359d90)=>{_0x2cfcee[_0x359d90]['return_qty']=_0x59345d;}),_0x31ce44[_0x1aab27(0x153)]((_0x3dae61,_0x1761af)=>{_0x2cfcee[_0x1761af]['bay']=_0x3dae61;}),_0x1363eb[_0x1aab27(0x153)]((_0x17a088,_0x3f5d86)=>{_0x2cfcee[_0x3f5d86]['product_code']=_0x17a088;}),_0x5ebaf2[_0x1aab27(0x153)]((_0x10412a,_0x374166)=>{const _0x1f392f=_0x1aab27;_0x2cfcee[_0x374166][_0x1f392f(0x165)]=_0x10412a;}),_0x5e18d5[_0x1aab27(0x153)]((_0x380756,_0x4e70a8)=>{const _0x3098e9=_0x1aab27;_0x2cfcee[_0x4e70a8][_0x3098e9(0x182)]=_0x380756;});var _0x422115=0x0;_0x2cfcee['forEach'](_0x2f21c1=>{const _0x56ae4c=_0x1aab27;(parseInt(_0x2f21c1[_0x56ae4c(0x187)])<parseInt(_0x2f21c1[_0x56ae4c(0x161)])||parseInt(_0x2f21c1['stock_quantity'])<parseInt(_0x2f21c1[_0x56ae4c(0x161)]))&&_0x422115++;});if(_0x422115!=0x0)return _0x1d101f[_0x1aab27(0x176)](_0x1aab27(0x18d),_0x1aab27(0x162)),_0x5d6772[_0x1aab27(0x185)](_0x1aab27(0x12d));_0x1425fe['return_product'][_0x1aab27(0x153)](_0x2ca6d6=>{const _0x5c0798=_0x1aab27;if(_0x2ca6d6[_0x5c0798(0x161)]>0x0){const _0x56b2e8=_0x3cdcd2['product_details']['map'](_0x1d3e4d=>{const _0x497535=_0x5c0798;_0x1d3e4d[_0x497535(0x158)]==_0x2ca6d6[_0x497535(0x158)]&&_0x1d3e4d[_0x497535(0x188)]==_0x2ca6d6['bay']&&(_0x1d3e4d[_0x497535(0x19d)]=parseInt(_0x1d3e4d[_0x497535(0x19d)])+parseInt(_0x2ca6d6[_0x497535(0x161)]));});}}),await _0x3cdcd2['save'](),_0x1425fe[_0x1aab27(0x15c)]=_0x58cb2a,_0x1425fe[_0x1aab27(0x15b)]=_0xd4081f,_0x1425fe[_0x1aab27(0x17b)]=_0x148eb3,_0x1425fe[_0x1aab27(0x178)]=_0x57996b,_0x1425fe[_0x1aab27(0x144)]=_0x2cfcee,_0x1425fe[_0x1aab27(0x16b)]=_0x446c4d,_0x1425fe[_0x1aab27(0x19e)]=_0x46acf7,_0x1425fe[_0x1aab27(0x13a)]=_0x32cd0e,_0x1425fe[_0x1aab27(0x179)]=_0x1f1cff;const _0x4c1534=await _0x1425fe[_0x1aab27(0x134)](),_0x2b5584=await purchases_return_finished[_0x1aab27(0x160)]({'invoice':_0x1d101f['body']['invoice']}),_0x2cf258=await warehouse['findOne']({'name':_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x13a)],'room':_0x1d101f[_0x1aab27(0x149)][_0x1aab27(0x14f)],'warehouse_category':_0x1aab27(0x166)});_0x2b5584['return_product']['forEach'](_0x5b9c44=>{const _0x56e330=_0x1aab27;_0x2cf258['product_details'][_0x56e330(0x15d)](_0x5daa1e=>{const _0x12c2b4=_0x56e330;_0x5daa1e[_0x12c2b4(0x158)]==_0x5b9c44['product_name']&&_0x5daa1e['bay']==_0x5b9c44[_0x12c2b4(0x188)]&&(_0x5daa1e['product_stock']=parseInt(_0x5daa1e[_0x12c2b4(0x19d)])-parseInt(_0x5b9c44[_0x12c2b4(0x161)]));});}),await _0x2cf258[_0x1aab27(0x134)]();const _0x49b007=await s_payment_data[_0x1aab27(0x160)]({'invoice':_0x1d101f[_0x1aab27(0x149)]['invoice'],'reason':_0x1aab27(0x137)});await _0x49b007[_0x1aab27(0x134)](),_0x1d101f[_0x1aab27(0x176)]('success',_0x1aab27(0x139)),_0x5d6772[_0x1aab27(0x185)](_0x1aab27(0x14c));}catch(_0x330c08){console['log'](_0x330c08),_0x5d6772[_0x1aab27(0x147)](0xc8)[_0x1aab27(0x136)]({'message':_0x330c08[_0x1aab27(0x18f)]});}}),router[a0_0x29ccc8(0x145)]('/invoice/:id',auth,async(_0x5335ae,_0x417d5d)=>{const _0x3716b0=a0_0x29ccc8;try{const {username:_0xb6e0e3,email:_0x269b97,role:_0x140b7b}=_0x5335ae[_0x3716b0(0x156)],_0x3c3737=_0x5335ae[_0x3716b0(0x156)],_0x10afc6=await profile['findOne']({'email':_0x3c3737['email']}),_0x377d08=await master_shop[_0x3716b0(0x14a)]();console[_0x3716b0(0x174)]('master',_0x377d08);const _0x15b88d=_0x5335ae[_0x3716b0(0x13e)]['id'],_0x4fab14=await purchases_return[_0x3716b0(0x148)](_0x15b88d);console[_0x3716b0(0x174)](_0x4fab14);const _0x1e64be=await suppliers['findOne']({'name':_0x4fab14[_0x3716b0(0x15b)]});console[_0x3716b0(0x174)](_0x1e64be);if(_0x377d08[0x0]['language']==_0x3716b0(0x130)){var _0x578bbb=users['English'];console[_0x3716b0(0x174)](_0x578bbb);}else{if(_0x377d08[0x0][_0x3716b0(0x12f)]==_0x3716b0(0x18e))var _0x578bbb=users[_0x3716b0(0x18e)];else{if(_0x377d08[0x0]['language']=='German')var _0x578bbb=users[_0x3716b0(0x15a)];else{if(_0x377d08[0x0]['language']=='Spanish')var _0x578bbb=users[_0x3716b0(0x177)];else{if(_0x377d08[0x0]['language']==_0x3716b0(0x1a2))var _0x578bbb=users['French'];else{if(_0x377d08[0x0]['language']==_0x3716b0(0x164))var _0x578bbb=users[_0x3716b0(0x146)];else{if(_0x377d08[0x0][_0x3716b0(0x12f)]==_0x3716b0(0x16d))var _0x578bbb=users[_0x3716b0(0x16d)];else{if(_0x377d08[0x0][_0x3716b0(0x12f)]==_0x3716b0(0x151))var _0x578bbb=users['Arabic'];}}}}}}}_0x417d5d[_0x3716b0(0x197)](_0x3716b0(0x155),{'success':_0x5335ae['flash'](_0x3716b0(0x169)),'errors':_0x5335ae[_0x3716b0(0x176)](_0x3716b0(0x18d)),'role':_0x3c3737,'profile':_0x10afc6,'master_shop':_0x377d08,'supplier':_0x1e64be,'purchase':_0x4fab14,'language':_0x578bbb});}catch(_0xad4438){console[_0x3716b0(0x174)](_0xad4438);}}),router['post'](a0_0x29ccc8(0x157),auth,async(_0x183379,_0xeb051e)=>{const _0x11c223=a0_0x29ccc8;try{const _0x548017=_0x183379[_0x11c223(0x13e)]['id'],{invoice:_0x297b51,suppliers:_0x9d44c9,receivable_amount:_0x4f0b7f,received_amount:_0x5204bc}=_0x183379[_0x11c223(0x149)],_0x4df338=await purchases_return[_0x11c223(0x148)](_0x548017);console[_0x11c223(0x174)](_0x4df338);var _0x475b2d=_0x4f0b7f-_0x5204bc;console[_0x11c223(0x174)](_0x5204bc),_0x4df338[_0x11c223(0x19b)]=parseFloat(_0x5204bc)+parseFloat(_0x4df338[_0x11c223(0x19b)]),_0x4df338[_0x11c223(0x18c)]=_0x475b2d,console[_0x11c223(0x174)](_0x4df338);const _0x5db1a2=await _0x4df338[_0x11c223(0x134)](),_0x3a88ec=await s_payment_data[_0x11c223(0x160)]({'invoice':_0x183379[_0x11c223(0x149)][_0x11c223(0x15c)],'reason':_0x11c223(0x137)});_0x3a88ec[_0x11c223(0x138)]=_0x475b2d,await _0x3a88ec[_0x11c223(0x134)]();let _0x3a6244=new Date(),_0x1270d5=('0'+_0x3a6244[_0x11c223(0x172)]())[_0x11c223(0x196)](-0x2),_0x594bd1=('0'+(_0x3a6244[_0x11c223(0x19a)]()+0x1))[_0x11c223(0x196)](-0x2),_0x2c80ca=_0x3a6244[_0x11c223(0x186)](),_0x1029f7=_0x2c80ca+'-'+_0x594bd1+'-'+_0x1270d5;const _0x2265b6=new suppliers_payment({'invoice':_0x297b51,'date':_0x2c80ca+'-'+_0x594bd1+'-'+_0x1270d5,'suppliers':_0x9d44c9,'reason':'Received\x20For\x20Purchase\x20Return','amount':_0x5204bc}),_0x582d3d=await _0x2265b6[_0x11c223(0x134)]();_0x183379['flash'](_0x11c223(0x169),_0x11c223(0x189)),_0xeb051e[_0x11c223(0x185)]('/purchases_return/view');}catch(_0x29dff3){console[_0x11c223(0x174)](_0x29dff3);}}),module[a0_0x29ccc8(0x132)]=router;