const a0_0x31b197=a0_0x13ba;function a0_0x13ba(_0x590662,_0x370446){const _0x1ddc13=a0_0x1ddc();return a0_0x13ba=function(_0x13ba69,_0xa16490){_0x13ba69=_0x13ba69-0x105;let _0x591b46=_0x1ddc13[_0x13ba69];return _0x591b46;},a0_0x13ba(_0x590662,_0x370446);}(function(_0x4c4483,_0x53924d){const _0x5d9b0d=a0_0x13ba,_0x52cad6=_0x4c4483();while(!![]){try{const _0x1aaec5=parseInt(_0x5d9b0d(0x15c))/0x1+parseInt(_0x5d9b0d(0x126))/0x2*(parseInt(_0x5d9b0d(0x161))/0x3)+-parseInt(_0x5d9b0d(0x130))/0x4+-parseInt(_0x5d9b0d(0x12b))/0x5+-parseInt(_0x5d9b0d(0x110))/0x6+parseInt(_0x5d9b0d(0x113))/0x7*(-parseInt(_0x5d9b0d(0x168))/0x8)+parseInt(_0x5d9b0d(0x155))/0x9;if(_0x1aaec5===_0x53924d)break;else _0x52cad6['push'](_0x52cad6['shift']());}catch(_0x584018){_0x52cad6['push'](_0x52cad6['shift']());}}}(a0_0x1ddc,0x99db3));const express=require(a0_0x31b197(0x136)),app=express(),router=express[a0_0x31b197(0x167)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x31b197(0x177)),auth=require(a0_0x31b197(0x11b)),users=require(a0_0x31b197(0x178));function a0_0x1ddc(){const _0x5ee7ea=['Spanish','exports','../middleware/auth','primary_code','/purchases_return/view','German','return_purchase_invoice','return_qty','findOne','body','language','aggregate','$_id','2EEMlLk','flash','$receivable','$received','$product_details.bin','3212580fojdys','string','Hindi','success','purchase_quantity','1570728ClqyoN','$supplier_docs','to_room','$due_amount','Return\x20Goods','Arabic\x20(ae)','express','to_Room_name','stock_data','$name','/view/:id','post','$supplier_docs.mobile','render','name','Chinese','/invoice/:id','message','/purchases_return_finished/view','status','$product_details.product_code','$supplier_docs.email','getDate','Portuguese\x20(BR)','$warehouse_name','user','forEach','find','payment\x20successfull','product_stock','level','redirect','product_details','warehouse_name','$product_details.type','stock_quantity','suppliers','20856762vNHWoN','master','due_amount','$product_details.bay','$product_details.secondary_code','json','purchases_return_finished','590741sZHLyu','slice','params','$discount','$suppliers','364701evBIjy','Enabled','bay','$note','$return_product.return_qty','log','Router','611752zcyFkc','$product_details.rack','to_warehouse_name','email','$return_product','findById','Arabic','$product_details.product_name','/view','product_code_hide','French','secondary_code_hide','Finished\x20Goods','$product_details','received','../models/all_models','../public/language/languages.json','date','primary_code_hide','save','product_name','$return_product.product_name','$date','errors','Portuguese','Received\x20For\x20Purchase\x20Return','English','product_code','back','return_purchase_edit_finished','get','$product_details.storage','stocks','3139044VCzcfF','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$supplier_docs.address','77JqpFGX','invoice','/receive_payment/:id','amount','return_product','room'];a0_0x1ddc=function(){return _0x5ee7ea;};return a0_0x1ddc();}router[a0_0x31b197(0x10d)](a0_0x31b197(0x170),auth,async(_0x5aa9ac,_0xc6416d)=>{const _0x275079=a0_0x31b197;try{const {username:_0x2f3ffc,email:_0x3dc80d,role:_0x48066f}=_0x5aa9ac['user'],_0x54dae2=_0x5aa9ac[_0x275079(0x149)],_0x179e77=await profile[_0x275079(0x121)]({'email':_0x54dae2[_0x275079(0x16b)]}),_0x4fe085=await master_shop[_0x275079(0x14b)]();console[_0x275079(0x166)](_0x275079(0x156),_0x4fe085);const _0xd37d14=await purchases_return_finished['aggregate']([{'$lookup':{'from':'suppliers','localField':_0x275079(0x154),'foreignField':_0x275079(0x13e),'as':'supplier_docs'}},{'$unwind':_0x275079(0x16c)},{'$unwind':_0x275079(0x131)},{'$group':{'_id':_0x275079(0x125),'invoice':{'$first':'$invoice'},'date':{'$first':_0x275079(0x105)},'suppliers':{'$first':_0x275079(0x160)},'warehouse_name':{'$first':_0x275079(0x148)},'product_name':{'$first':_0x275079(0x17d)},'return_qty':{'$first':'$return_product.return_qty'},'price':{'$first':'$return_product.price'},'total':{'$sum':'$return_product.total'},'note':{'$first':_0x275079(0x164)},'total_amount':{'$first':'$total_amount'},'discount':{'$first':_0x275079(0x15f)},'receivable':{'$first':_0x275079(0x128)},'received':{'$first':_0x275079(0x129)},'due_amount':{'$first':_0x275079(0x133)},'mobile':{'$first':_0x275079(0x13c)},'email':{'$first':_0x275079(0x145)},'address':{'$first':_0x275079(0x112)},'return_sum_qty':{'$sum':_0x275079(0x165)}}}]);console[_0x275079(0x166)](_0xd37d14);if(_0x4fe085[0x0][_0x275079(0x123)]=='English\x20(US)'){var _0x57cc3b=users[_0x275079(0x109)];console[_0x275079(0x166)](_0x57cc3b);}else{if(_0x4fe085[0x0][_0x275079(0x123)]==_0x275079(0x12d))var _0x57cc3b=users[_0x275079(0x12d)];else{if(_0x4fe085[0x0][_0x275079(0x123)]==_0x275079(0x11e))var _0x57cc3b=users[_0x275079(0x11e)];else{if(_0x4fe085[0x0]['language']==_0x275079(0x119))var _0x57cc3b=users[_0x275079(0x119)];else{if(_0x4fe085[0x0][_0x275079(0x123)]==_0x275079(0x172))var _0x57cc3b=users['French'];else{if(_0x4fe085[0x0]['language']==_0x275079(0x147))var _0x57cc3b=users[_0x275079(0x107)];else{if(_0x4fe085[0x0][_0x275079(0x123)]=='Chinese')var _0x57cc3b=users[_0x275079(0x13f)];else{if(_0x4fe085[0x0][_0x275079(0x123)]==_0x275079(0x135))var _0x57cc3b=users[_0x275079(0x16e)];}}}}}}}_0xc6416d['render'](_0x275079(0x15b),{'success':_0x5aa9ac[_0x275079(0x127)](_0x275079(0x12e)),'errors':_0x5aa9ac['flash'](_0x275079(0x106)),'role':_0x54dae2,'profile':_0x179e77,'master_shop':_0x4fe085,'user':_0xd37d14,'language':_0x57cc3b});}catch(_0x2fe25e){console[_0x275079(0x166)](_0x2fe25e);}}),router[a0_0x31b197(0x10d)](a0_0x31b197(0x13a),auth,async(_0x2f8550,_0x6a0721)=>{const _0x1912f8=a0_0x31b197;try{const {username:_0x531fbb,email:_0x536937,role:_0x32e085}=_0x2f8550[_0x1912f8(0x149)],_0x5689ca=_0x2f8550[_0x1912f8(0x149)],_0x47303c=await profile[_0x1912f8(0x121)]({'email':_0x5689ca[_0x1912f8(0x16b)]}),_0x438c16=await product['find']({}),_0x14d0a7=await master_shop[_0x1912f8(0x14b)](),_0x373c7c=_0x2f8550[_0x1912f8(0x15e)]['id'],_0x1bd06a=await purchases_return_finished[_0x1912f8(0x16d)](_0x373c7c),_0x12f482=await warehouse['aggregate']([{'$match':{'name':_0x1bd06a['warehouse_name'],'room':_0x1bd06a[_0x1912f8(0x118)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x1912f8(0x175)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1912f8(0x16f)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1912f8(0x158)},'bin':{'$first':_0x1912f8(0x12a)},'type':{'$first':_0x1912f8(0x152)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1912f8(0x159)},'product_code':{'$first':_0x1912f8(0x144)},'storage':{'$first':_0x1912f8(0x10e)},'rack':{'$first':_0x1912f8(0x169)}}}]);warehouse_data=await warehouse[_0x1912f8(0x124)]([{'$match':{'status':_0x1912f8(0x162),'name':_0x1912f8(0x134),'warehouse_category':_0x1912f8(0x174)}},{'$group':{'_id':_0x1912f8(0x139),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x1912f8(0x138),_0x12f482);if(_0x14d0a7[0x0][_0x1912f8(0x123)]=='English\x20(US)'){var _0x4f02e5=users[_0x1912f8(0x109)];console[_0x1912f8(0x166)](_0x4f02e5);}else{if(_0x14d0a7[0x0][_0x1912f8(0x123)]==_0x1912f8(0x12d))var _0x4f02e5=users['Hindi'];else{if(_0x14d0a7[0x0][_0x1912f8(0x123)]==_0x1912f8(0x11e))var _0x4f02e5=users[_0x1912f8(0x11e)];else{if(_0x14d0a7[0x0][_0x1912f8(0x123)]==_0x1912f8(0x119))var _0x4f02e5=users[_0x1912f8(0x119)];else{if(_0x14d0a7[0x0][_0x1912f8(0x123)]==_0x1912f8(0x172))var _0x4f02e5=users['French'];else{if(_0x14d0a7[0x0]['language']==_0x1912f8(0x147))var _0x4f02e5=users[_0x1912f8(0x107)];else{if(_0x14d0a7[0x0]['language']==_0x1912f8(0x13f))var _0x4f02e5=users[_0x1912f8(0x13f)];else{if(_0x14d0a7[0x0][_0x1912f8(0x123)]==_0x1912f8(0x135))var _0x4f02e5=users['Arabic'];}}}}}}}_0x6a0721[_0x1912f8(0x13d)](_0x1912f8(0x10c),{'success':_0x2f8550['flash']('success'),'errors':_0x2f8550[_0x1912f8(0x127)](_0x1912f8(0x106)),'role':_0x5689ca,'master_shop':_0x14d0a7,'profile':_0x47303c,'user':_0x1bd06a,'stock':_0x12f482,'product':_0x438c16,'language':_0x4f02e5,'warehouse':warehouse_data});}catch(_0x543c4c){console['log'](_0x543c4c);}}),router[a0_0x31b197(0x13b)](a0_0x31b197(0x13a),auth,async(_0x4d0ab2,_0x40b62d)=>{const _0x351fff=a0_0x31b197;try{const _0x4e1ff2=_0x4d0ab2[_0x351fff(0x15e)]['id'],_0x29e074=await purchases_return_finished[_0x351fff(0x121)]({'invoice':_0x4d0ab2[_0x351fff(0x122)]['invoice']}),_0x3a3a5f=await warehouse[_0x351fff(0x121)]({'name':_0x29e074[_0x351fff(0x16a)],'room':_0x29e074[_0x351fff(0x132)],'warehouse_category':_0x351fff(0x174)}),{invoice:_0x40731d,suppliers:_0x33ea2b,date:_0x1cdacc,warehouse_name:_0xc1642a,product_name:_0x4c906c,purchase_quantity:_0x1385c1,stocks:_0xc543a,return_qty:_0x4b9223,note:_0x450e25,Room_name:_0x16c7dd,level:_0x5ed929,isle:_0x8b4be2,pallet:_0x59534b,to_warehouse_name:_0x444deb,to_Room_name:_0x48e50a}=_0x4d0ab2[_0x351fff(0x122)];if(typeof _0x4c906c==_0x351fff(0x12c))var _0x44a2cb=[_0x4d0ab2[_0x351fff(0x122)]['product_name']],_0x5c15d8=[_0x4d0ab2[_0x351fff(0x122)]['purchase_quantity']],_0xb78a1a=[_0x4d0ab2[_0x351fff(0x122)]['stocks']],_0x3982b2=[_0x4d0ab2[_0x351fff(0x122)]['return_qty']],_0x40485c=[_0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x14e)]],_0x2c49c6=[_0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x171)]],_0x14f67b=[_0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x17a)]],_0x2d3a4c=[_0x4d0ab2[_0x351fff(0x122)]['secondary_code_hide']];else var _0x44a2cb=[..._0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x17c)]],_0x5c15d8=[..._0x4d0ab2['body'][_0x351fff(0x12f)]],_0xb78a1a=[..._0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x10f)]],_0x3982b2=[..._0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x120)]],_0x40485c=[..._0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x14e)]],_0x2c49c6=[..._0x4d0ab2[_0x351fff(0x122)]['product_code_hide']],_0x14f67b=[..._0x4d0ab2['body'][_0x351fff(0x17a)]],_0x2d3a4c=[..._0x4d0ab2['body'][_0x351fff(0x173)]];const _0x5add15=_0x44a2cb['map'](_0xf2858a=>{return _0xf2858a={'product_name':_0xf2858a};});_0x5c15d8['forEach']((_0xc25bd8,_0x4df7db)=>{const _0xef9da6=_0x351fff;_0x5add15[_0x4df7db][_0xef9da6(0x12f)]=_0xc25bd8;}),_0xb78a1a['forEach']((_0x1239ee,_0x1df5bd)=>{const _0xc160ac=_0x351fff;_0x5add15[_0x1df5bd][_0xc160ac(0x153)]=_0x1239ee;}),_0x3982b2['forEach']((_0x546c64,_0x59b390)=>{const _0x157c06=_0x351fff;_0x5add15[_0x59b390][_0x157c06(0x120)]=_0x546c64;}),_0x40485c[_0x351fff(0x14a)]((_0x37274f,_0x7df826)=>{const _0x2ccb49=_0x351fff;_0x5add15[_0x7df826][_0x2ccb49(0x163)]=_0x37274f;}),_0x2c49c6[_0x351fff(0x14a)]((_0x11cc0c,_0x3b934e)=>{const _0x2e28f5=_0x351fff;_0x5add15[_0x3b934e][_0x2e28f5(0x10a)]=_0x11cc0c;}),_0x14f67b[_0x351fff(0x14a)]((_0x1800ba,_0x5f50ad)=>{const _0x47d403=_0x351fff;_0x5add15[_0x5f50ad][_0x47d403(0x11c)]=_0x1800ba;}),_0x2d3a4c[_0x351fff(0x14a)]((_0x4ed045,_0x16b76f)=>{_0x5add15[_0x16b76f]['secondary_code']=_0x4ed045;});var _0x30e7df=0x0;_0x5add15[_0x351fff(0x14a)](_0x159285=>{const _0x44a2d6=_0x351fff;(parseInt(_0x159285[_0x44a2d6(0x12f)])<parseInt(_0x159285[_0x44a2d6(0x120)])||parseInt(_0x159285[_0x44a2d6(0x153)])<parseInt(_0x159285[_0x44a2d6(0x120)]))&&_0x30e7df++;});if(_0x30e7df!=0x0)return _0x4d0ab2['flash'](_0x351fff(0x106),_0x351fff(0x111)),_0x40b62d[_0x351fff(0x14f)](_0x351fff(0x10b));_0x29e074[_0x351fff(0x117)][_0x351fff(0x14a)](_0x33f4cc=>{const _0x4f4556=_0x351fff;if(_0x33f4cc[_0x4f4556(0x120)]>0x0){const _0x1c6d2b=_0x3a3a5f[_0x4f4556(0x150)]['map'](_0x48a31b=>{const _0x9cf415=_0x4f4556;_0x48a31b[_0x9cf415(0x17c)]==_0x33f4cc['product_name']&&_0x48a31b[_0x9cf415(0x163)]==_0x33f4cc['bay']&&(_0x48a31b[_0x9cf415(0x14d)]=parseInt(_0x48a31b[_0x9cf415(0x14d)])+parseInt(_0x33f4cc[_0x9cf415(0x120)]));});}}),await _0x3a3a5f[_0x351fff(0x17b)](),_0x29e074[_0x351fff(0x114)]=_0x40731d,_0x29e074[_0x351fff(0x154)]=_0x33ea2b,_0x29e074[_0x351fff(0x179)]=_0x1cdacc,_0x29e074[_0x351fff(0x151)]=_0xc1642a,_0x29e074[_0x351fff(0x117)]=_0x5add15,_0x29e074['note']=_0x450e25,_0x29e074[_0x351fff(0x118)]=_0x16c7dd,_0x29e074['to_warehouse_name']=_0x444deb,_0x29e074[_0x351fff(0x132)]=_0x48e50a;const _0x4c9fac=await _0x29e074[_0x351fff(0x17b)](),_0x42cfe7=await purchases_return_finished[_0x351fff(0x121)]({'invoice':_0x4d0ab2[_0x351fff(0x122)]['invoice']}),_0x352301=await warehouse[_0x351fff(0x121)]({'name':_0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x16a)],'room':_0x4d0ab2['body'][_0x351fff(0x137)],'warehouse_category':_0x351fff(0x174)});_0x42cfe7[_0x351fff(0x117)]['forEach'](_0x1ce8a5=>{const _0x4fac09=_0x351fff;_0x352301[_0x4fac09(0x150)]['map'](_0x5e60f2=>{const _0xf82d73=_0x4fac09;_0x5e60f2[_0xf82d73(0x17c)]==_0x1ce8a5[_0xf82d73(0x17c)]&&_0x5e60f2[_0xf82d73(0x163)]==_0x1ce8a5[_0xf82d73(0x163)]&&(_0x5e60f2[_0xf82d73(0x14d)]=parseInt(_0x5e60f2['product_stock'])-parseInt(_0x1ce8a5[_0xf82d73(0x120)]));});}),await _0x352301[_0x351fff(0x17b)]();const _0x4c7d8c=await s_payment_data[_0x351fff(0x121)]({'invoice':_0x4d0ab2[_0x351fff(0x122)][_0x351fff(0x114)],'reason':'Purchase\x20Return'});await _0x4c7d8c[_0x351fff(0x17b)](),_0x4d0ab2[_0x351fff(0x127)]('success','purchase\x20return\x20successfully'),_0x40b62d['redirect'](_0x351fff(0x142));}catch(_0x2d7dfa){console['log'](_0x2d7dfa),_0x40b62d[_0x351fff(0x143)](0xc8)[_0x351fff(0x15a)]({'message':_0x2d7dfa[_0x351fff(0x141)]});}}),router[a0_0x31b197(0x10d)](a0_0x31b197(0x140),auth,async(_0x497623,_0x3d6b20)=>{const _0x29d7f1=a0_0x31b197;try{const {username:_0x172477,email:_0x197a65,role:_0x346e78}=_0x497623[_0x29d7f1(0x149)],_0xd3b053=_0x497623[_0x29d7f1(0x149)],_0x56d554=await profile[_0x29d7f1(0x121)]({'email':_0xd3b053[_0x29d7f1(0x16b)]}),_0x206d4a=await master_shop['find']();console[_0x29d7f1(0x166)](_0x29d7f1(0x156),_0x206d4a);const _0x54439b=_0x497623[_0x29d7f1(0x15e)]['id'],_0x1f1daa=await purchases_return[_0x29d7f1(0x16d)](_0x54439b);console[_0x29d7f1(0x166)](_0x1f1daa);const _0x16e41f=await suppliers['findOne']({'name':_0x1f1daa[_0x29d7f1(0x154)]});console['log'](_0x16e41f);if(_0x206d4a[0x0][_0x29d7f1(0x123)]=='English\x20(US)'){var _0xbdcb40=users[_0x29d7f1(0x109)];console[_0x29d7f1(0x166)](_0xbdcb40);}else{if(_0x206d4a[0x0]['language']=='Hindi')var _0xbdcb40=users[_0x29d7f1(0x12d)];else{if(_0x206d4a[0x0][_0x29d7f1(0x123)]==_0x29d7f1(0x11e))var _0xbdcb40=users[_0x29d7f1(0x11e)];else{if(_0x206d4a[0x0][_0x29d7f1(0x123)]=='Spanish')var _0xbdcb40=users[_0x29d7f1(0x119)];else{if(_0x206d4a[0x0][_0x29d7f1(0x123)]==_0x29d7f1(0x172))var _0xbdcb40=users[_0x29d7f1(0x172)];else{if(_0x206d4a[0x0][_0x29d7f1(0x123)]==_0x29d7f1(0x147))var _0xbdcb40=users['Portuguese'];else{if(_0x206d4a[0x0][_0x29d7f1(0x123)]==_0x29d7f1(0x13f))var _0xbdcb40=users['Chinese'];else{if(_0x206d4a[0x0][_0x29d7f1(0x123)]==_0x29d7f1(0x135))var _0xbdcb40=users[_0x29d7f1(0x16e)];}}}}}}}_0x3d6b20[_0x29d7f1(0x13d)](_0x29d7f1(0x11f),{'success':_0x497623[_0x29d7f1(0x127)](_0x29d7f1(0x12e)),'errors':_0x497623['flash']('errors'),'role':_0xd3b053,'profile':_0x56d554,'master_shop':_0x206d4a,'supplier':_0x16e41f,'purchase':_0x1f1daa,'language':_0xbdcb40});}catch(_0x1c1613){console[_0x29d7f1(0x166)](_0x1c1613);}}),router[a0_0x31b197(0x13b)](a0_0x31b197(0x115),auth,async(_0x541a37,_0x300a3d)=>{const _0x452613=a0_0x31b197;try{const _0x5d65d0=_0x541a37[_0x452613(0x15e)]['id'],{invoice:_0x3dec37,suppliers:_0x5daa55,receivable_amount:_0x2c5aea,received_amount:_0x59c3c1}=_0x541a37[_0x452613(0x122)],_0xa46174=await purchases_return[_0x452613(0x16d)](_0x5d65d0);console['log'](_0xa46174);var _0x50192a=_0x2c5aea-_0x59c3c1;console[_0x452613(0x166)](_0x59c3c1),_0xa46174['received']=parseFloat(_0x59c3c1)+parseFloat(_0xa46174[_0x452613(0x176)]),_0xa46174[_0x452613(0x157)]=_0x50192a,console[_0x452613(0x166)](_0xa46174);const _0x1ca3e2=await _0xa46174['save'](),_0x2ba88f=await s_payment_data[_0x452613(0x121)]({'invoice':_0x541a37[_0x452613(0x122)]['invoice'],'reason':'Purchase\x20Return'});_0x2ba88f[_0x452613(0x116)]=_0x50192a,await _0x2ba88f[_0x452613(0x17b)]();let _0x4eb039=new Date(),_0x40bdb1=('0'+_0x4eb039[_0x452613(0x146)]())['slice'](-0x2),_0xcd394e=('0'+(_0x4eb039['getMonth']()+0x1))[_0x452613(0x15d)](-0x2),_0x484012=_0x4eb039['getFullYear'](),_0x30ed0f=_0x484012+'-'+_0xcd394e+'-'+_0x40bdb1;const _0x3275dd=new suppliers_payment({'invoice':_0x3dec37,'date':_0x484012+'-'+_0xcd394e+'-'+_0x40bdb1,'suppliers':_0x5daa55,'reason':_0x452613(0x108),'amount':_0x59c3c1}),_0x4dcfdc=await _0x3275dd[_0x452613(0x17b)]();_0x541a37[_0x452613(0x127)](_0x452613(0x12e),_0x452613(0x14c)),_0x300a3d[_0x452613(0x14f)](_0x452613(0x11d));}catch(_0x365e5e){console[_0x452613(0x166)](_0x365e5e);}}),module[a0_0x31b197(0x11a)]=router;