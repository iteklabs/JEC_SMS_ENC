var a0_0x580021=a0_0x1093;(function(_0x59743b,_0x37e1ce){var _0x971c8a=a0_0x1093,_0x1aa7f2=_0x59743b();while(!![]){try{var _0x54d58c=-parseInt(_0x971c8a(0x15d))/0x1+-parseInt(_0x971c8a(0x184))/0x2+-parseInt(_0x971c8a(0xdd))/0x3+-parseInt(_0x971c8a(0xee))/0x4*(parseInt(_0x971c8a(0x144))/0x5)+parseInt(_0x971c8a(0x137))/0x6+parseInt(_0x971c8a(0x163))/0x7+parseInt(_0x971c8a(0x12f))/0x8*(parseInt(_0x971c8a(0x10e))/0x9);if(_0x54d58c===_0x37e1ce)break;else _0x1aa7f2['push'](_0x1aa7f2['shift']());}catch(_0x534ce8){_0x1aa7f2['push'](_0x1aa7f2['shift']());}}}(a0_0x22f4,0x7453a));const express=require('express'),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,supervisor_settings,email_settings}=require(a0_0x580021(0x191)),users=require(a0_0x580021(0x10a)),nodemailer=require('nodemailer');router[a0_0x580021(0x1a9)](a0_0x580021(0x14d),auth,async(_0x5ef8ff,_0x57e469)=>{var _0xe15a0a=a0_0x580021;try{const {username:_0xca1995,email:_0x493dfd,role:_0x597385}=_0x5ef8ff[_0xe15a0a(0x197)],_0x292e6d=_0x5ef8ff[_0xe15a0a(0x197)],_0x467964=await profile[_0xe15a0a(0x1a5)]({'email':_0x292e6d[_0xe15a0a(0x122)]}),_0x4fbc21=await master_shop[_0xe15a0a(0x15a)]();console[_0xe15a0a(0x12a)](_0xe15a0a(0xdf),_0x4fbc21);let _0x3331d0;if(_0x292e6d[_0xe15a0a(0x141)]==_0xe15a0a(0xfd)){const _0x231c15=await staff[_0xe15a0a(0x1a5)]({'email':_0x292e6d['email']});_0x3331d0=await warehouse[_0xe15a0a(0x15a)]({'status':'Enabled','name':_0x231c15[_0xe15a0a(0x120)]});}else _0x3331d0=await warehouse[_0xe15a0a(0x15a)]({'status':_0xe15a0a(0x174)});const _0x53cbff=await product[_0xe15a0a(0x15a)]();let _0x28257f;if(_0x292e6d['role']=='staff'){const _0x30a9ea=await staff[_0xe15a0a(0x1a5)]({'email':_0x292e6d['email']});_0x28257f=await adjustment[_0xe15a0a(0x15a)]({'warehouse_name':_0x30a9ea[_0xe15a0a(0x120)]});}else _0x28257f=await adjustment[_0xe15a0a(0xe3)]([{'$unwind':_0xe15a0a(0x130)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xe15a0a(0x115)},'room':{'$addToSet':_0xe15a0a(0xeb)},'finalize':{'$first':_0xe15a0a(0x16a)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x4fbc21[0x0][_0xe15a0a(0x109)]==_0xe15a0a(0xf9)){var _0x2e13b0=users[_0xe15a0a(0xf1)];console[_0xe15a0a(0x12a)](_0x2e13b0);}else{if(_0x4fbc21[0x0]['language']==_0xe15a0a(0x118))var _0x2e13b0=users[_0xe15a0a(0x118)];else{if(_0x4fbc21[0x0][_0xe15a0a(0x109)]==_0xe15a0a(0x1a6))var _0x2e13b0=users[_0xe15a0a(0x1a6)];else{if(_0x4fbc21[0x0][_0xe15a0a(0x109)]==_0xe15a0a(0x132))var _0x2e13b0=users[_0xe15a0a(0x132)];else{if(_0x4fbc21[0x0]['language']==_0xe15a0a(0x110))var _0x2e13b0=users[_0xe15a0a(0x110)];else{if(_0x4fbc21[0x0]['language']==_0xe15a0a(0x16b))var _0x2e13b0=users['Portuguese'];else{if(_0x4fbc21[0x0][_0xe15a0a(0x109)]==_0xe15a0a(0x167))var _0x2e13b0=users[_0xe15a0a(0x167)];else{if(_0x4fbc21[0x0][_0xe15a0a(0x109)]==_0xe15a0a(0x13d))var _0x2e13b0=users[_0xe15a0a(0xde)];}}}}}}}_0x57e469[_0xe15a0a(0x14c)]('adjustment',{'success':_0x5ef8ff[_0xe15a0a(0x143)]('success'),'errors':_0x5ef8ff['flash'](_0xe15a0a(0x154)),'role':_0x292e6d,'profile':_0x467964,'warehouse':_0x3331d0,'product':_0x53cbff,'adjustment':_0x28257f,'master_shop':_0x4fbc21,'language':_0x2e13b0});}catch(_0xa25487){console[_0xe15a0a(0x12a)](_0xa25487);}});function a0_0x1093(_0x1f3e29,_0x5e6609){var _0x22f492=a0_0x22f4();return a0_0x1093=function(_0x10935d,_0x7ea9a5){_0x10935d=_0x10935d-0xdb;var _0x47d2f3=_0x22f492[_0x10935d];return _0x47d2f3;},a0_0x1093(_0x1f3e29,_0x5e6609);}function a0_0x22f4(){var _0x1cae87=['$product_details.isle','Ambient','1166325PKqHcT','Arabic','master','invoice','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.secondary_code','aggregate','floorlevel','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.floorlevel','product','add_adjustment','Raw\x20Materials','Return\x20Rooms','$product.room_names','createTransport','message','4RTXWUb','maxperunit','Receiving\x20Area','English','secondary_code','/view/:id','exports','room_names','length','stock','catch','English\x20(US)','$product_details.bin','secondary_unit','$product_details.product_name','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','back','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</td>','Portuguese','New_Qty_Converted','\x20<>\x20','$product_details.batch_code','$product_details.production_date','success','language','../public/language/languages.json','$product_details.maxPerUnit','adjustment\x20data\x20update\x20successfully','$product_details.storage','10233315maVnYv','status','French','<table\x20style=\x22width:\x20100%\x20!important;\x22>','date','map','edit_adjustment_view','$warehouse_name','/../public','$product_details.product_stock','Hindi','$product.product_name','<span\x20style=\x22float:\x20right;\x22>','forEach','findById','minus','$product_details.bay','Shelves','warehouse','type','email','$product_details.type','$product_details.expiry_date','$name','/adjustment/view','Level','</table>','unit','log','<h2>\x20','filter','ADJ-','/adjustment/preview/','8lIaIVC','$product','</h5>','Spanish','True','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','image','An\x20error\x20occurred.','4204278fFoOvs','random','prod_name','<hr\x20class=\x22my-3\x22>','False','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Arabic\x20(ae)','<tr>','second1','rack','role','/barcode_scanner','flash','3419030YrAcQG','product_name','site_title','$product_details.product_code','RMSEmail','\x20Order\x20Number\x20:\x20','There\x27s\x20a\x20error\x20in\x20this\x20transaction','finalize','render','/view','<div>','types','/picking_list/PDF_adjustment_rm/','room','Secondary_units','floor','errors','storage','host','post','Floor','</div>','find','port','max_per_unit','353168VDPNAS','<html><head><title></title>','params','\x20</h2>','toString','split','6116782sVIVOF','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','bay','prime1','Chinese','$product_details.primary_code','then','$finalize','Portuguese\x20(BR)','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','error','id_transaction_from','isAllowEdit','$product_details._id','body','push','$product_details.invoice','Enabled','save','product_code','<!DOCTYPE\x20html>','$product_details.unit','level','sendMail','New_Qty_Converted_adj','$room','prod_cat','prod_code','Rooms','$product_details.product_cat','batch_code','Email\x20sent\x20successfully','Primary_Units','1618702RPTixL','id_transaction','$product_details','expiry_date','prod_invoice','logo','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.pallet','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','product_details','foreach\x20newproduct','json','../models/all_models','$product_details.secondary_unit','_id','string','stockBefore','production_date','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','redirect','product_stock','edit_adjustment','/preview/:id','</body></html>','$product_details.rack','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','warehouse_name','slice','</thead>','adjustment\x20Finalized\x20successfully','$product_details.level','findOne','German','bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','get','\x20Order\x20Date\x20:\x20','Return\x20Goods','new_adjust_qty','adjust_qty','/view/add_adjustment'];a0_0x22f4=function(){return _0x1cae87;};return a0_0x22f4();}async function getRandom8DigitNumber(){var _0x1d34f6=a0_0x580021;const _0x4d9529=0x989680,_0x1cf3a6=0x5f5e0ff,_0x16f41b=Math[_0x1d34f6(0x153)](Math[_0x1d34f6(0x138)]()*(_0x1cf3a6-_0x4d9529+0x1))+_0x4d9529;var _0x3f3dae;const _0x255139=await adjustment[_0x1d34f6(0x1a5)]({'invoice':_0x1d34f6(0x12d)+_0x16f41b});return _0x255139&&_0x255139[_0x1d34f6(0xf6)]>0x0?_0x3f3dae='ADJ-'+_0x16f41b:_0x3f3dae=_0x1d34f6(0x12d)+_0x16f41b,_0x3f3dae;}router[a0_0x580021(0x1a9)](a0_0x580021(0x1ae),auth,async(_0x2fd7a1,_0x18a723)=>{var _0x5f5219=a0_0x580021;try{const {username:_0x3289d2,email:_0x4fd993,role:_0x316d17}=_0x2fd7a1['user'],_0x473c11=_0x2fd7a1[_0x5f5219(0x197)],_0x2c2433=await profile[_0x5f5219(0x1a5)]({'email':_0x473c11[_0x5f5219(0x122)]}),_0x53216a=await master_shop[_0x5f5219(0x15a)]();let _0x3f39ed;if(_0x473c11['role']==_0x5f5219(0xfd)){const _0x3ed9ad=await staff[_0x5f5219(0x1a5)]({'email':_0x473c11[_0x5f5219(0x122)]});_0x3f39ed=await warehouse[_0x5f5219(0xe3)]([{'$match':{'status':_0x5f5219(0x174),'name':_0x3ed9ad[_0x5f5219(0x120)],'warehouse_category':_0x5f5219(0xe9),'name':{'$ne':_0x5f5219(0x1ab)}}},{'$group':{'_id':_0x5f5219(0x125),'name':{'$first':'$name'}}}]);}else _0x3f39ed=await warehouse['aggregate']([{'$match':{'status':_0x5f5219(0x174),'warehouse_category':_0x5f5219(0xe9),'name':{'$ne':_0x5f5219(0x1ab)}}},{'$group':{'_id':'$name','name':{'$first':_0x5f5219(0x125)}}}]);const _0x47edba=await product['find']({}),_0x5dc82c=await adjustment[_0x5f5219(0x15a)]({}),_0x145d59=_0x5dc82c[_0x5f5219(0xf6)]+0x1,_0x10e3e3='ADJ-'+_0x145d59[_0x5f5219(0x161)]()['padStart'](0x5,'0');var _0xcb31bb=[_0x5f5219(0xdc),'Enclosed',_0x5f5219(0xea)];if(_0x53216a[0x0][_0x5f5219(0x109)]==_0x5f5219(0xf9))var _0x4f169e=users[_0x5f5219(0xf1)];else{if(_0x53216a[0x0]['language']==_0x5f5219(0x118))var _0x4f169e=users[_0x5f5219(0x118)];else{if(_0x53216a[0x0]['language']=='German')var _0x4f169e=users[_0x5f5219(0x1a6)];else{if(_0x53216a[0x0][_0x5f5219(0x109)]==_0x5f5219(0x132))var _0x4f169e=users['Spanish'];else{if(_0x53216a[0x0][_0x5f5219(0x109)]=='French')var _0x4f169e=users[_0x5f5219(0x110)];else{if(_0x53216a[0x0][_0x5f5219(0x109)]==_0x5f5219(0x16b))var _0x4f169e=users[_0x5f5219(0x103)];else{if(_0x53216a[0x0][_0x5f5219(0x109)]==_0x5f5219(0x167))var _0x4f169e=users[_0x5f5219(0x167)];else{if(_0x53216a[0x0][_0x5f5219(0x109)]==_0x5f5219(0x13d))var _0x4f169e=users['Arabic'];}}}}}}}const _0x1f0845=getRandom8DigitNumber();_0x1f0845['then'](_0x123407=>{var _0x1f86e2=_0x5f5219;_0x18a723[_0x1f86e2(0x14c)](_0x1f86e2(0xe8),{'success':_0x2fd7a1[_0x1f86e2(0x143)](_0x1f86e2(0x108)),'errors':_0x2fd7a1[_0x1f86e2(0x143)](_0x1f86e2(0x154)),'role':_0x473c11,'profile':_0x2c2433,'warehouse':_0x3f39ed,'product':_0x47edba,'master_shop':_0x53216a,'language':_0x4f169e,'rooms_data':_0xcb31bb,'invoice_no':_0x123407});})[_0x5f5219(0xf8)](_0x470fdd=>{var _0x775472=_0x5f5219;_0x2fd7a1[_0x775472(0x143)]('errors',_0x775472(0x14a)),_0x18a723[_0x775472(0x199)](_0x775472(0x126));});}catch(_0x204b3a){console[_0x5f5219(0x12a)](_0x204b3a);}}),router[a0_0x580021(0x157)]('/view/add_adjustment',auth,async(_0xf5ec4b,_0x5cfd9f)=>{var _0x5a7e18=a0_0x580021;try{const {warehouse_name:_0x4f1731,date:_0x19dc0d,prod_name:_0x35b9a8,level:_0x3c69db,isle:_0x3c370c,pallet:_0x2b99c1,stock:_0x177a76,types:_0x1c3c96,adjust_qty:_0xbad004,new_adjust_qty:_0x5a14a6,note:_0x1c3f3d,Room_name:_0x3917ef,invoice:_0x39547d,JO_number:_0x153160,expiry_date:_0x1ac105}=_0xf5ec4b[_0x5a7e18(0x171)];if(typeof _0x35b9a8==_0x5a7e18(0x194))var _0x306c06=[_0xf5ec4b['body'][_0x5a7e18(0x139)]],_0x2fe3d3=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x179)]],_0x2e3dd6=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0xf7)]],_0xa30da7=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x14f)]],_0x1d65d2=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x17b)]],_0x546c22=[_0xf5ec4b['body'][_0x5a7e18(0x104)]],_0x995f7e=[_0xf5ec4b[_0x5a7e18(0x171)]['Primary_Units']],_0x57840a=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x152)]],_0x4a540d=[_0xf5ec4b[_0x5a7e18(0x171)]['prod_code']],_0x31057c=[_0xf5ec4b['body']['batch_code']],_0x30522f=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x187)]],_0x483971=[_0xf5ec4b['body']['max_per_unit']],_0x4836b1=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x196)]],_0x583bf8=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x17d)]],_0x2e8e5e=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x17f)]],_0x3f6d64=[_0xf5ec4b['body'][_0x5a7e18(0x166)]],_0x16168f=[_0xf5ec4b['body']['second1']],_0x346c53=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x188)]],_0x240dc1=[_0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x185)]];else var _0x306c06=[..._0xf5ec4b[_0x5a7e18(0x171)]['prod_name']],_0x2fe3d3=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x179)]],_0x2e3dd6=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0xf7)]],_0xa30da7=[..._0xf5ec4b['body'][_0x5a7e18(0x14f)]],_0x1d65d2=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x17b)]],_0x546c22=[..._0xf5ec4b['body'][_0x5a7e18(0x104)]],_0x995f7e=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x129)]],_0x57840a=[..._0xf5ec4b[_0x5a7e18(0x171)]['Secondary_units']],_0x4a540d=[..._0xf5ec4b[_0x5a7e18(0x171)]['prod_code']],_0x31057c=[..._0xf5ec4b['body'][_0x5a7e18(0x181)]],_0x30522f=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x187)]],_0x483971=[..._0xf5ec4b['body'][_0x5a7e18(0x15c)]],_0x4836b1=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x196)]],_0x583bf8=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x17d)]],_0x2e8e5e=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x17f)]],_0x3f6d64=[..._0xf5ec4b['body'][_0x5a7e18(0x166)]],_0x16168f=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x13f)]],_0x346c53=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x188)]],_0x240dc1=[..._0xf5ec4b[_0x5a7e18(0x171)][_0x5a7e18(0x185)]];const _0x5ecb51=_0x306c06['map'](_0x38bbed=>{return _0x38bbed={'product_name':_0x38bbed};});_0x2fe3d3[_0x5a7e18(0x11b)]((_0x2413ce,_0x1d37ba)=>{_0x2e8e5e['forEach']((_0xd01b47,_0x479867)=>{var _0x9e406d=a0_0x1093;if(_0xd01b47==_0x9e406d(0xf0)&&_0x1d37ba==_0x479867){var _0x5b0acc=_0x2413ce['slice'](0x3);_0x5ecb51[_0x1d37ba][_0x9e406d(0x155)]=_0x2413ce[0x0],_0x5ecb51[_0x1d37ba][_0x9e406d(0x140)]=_0x2413ce[0x1],_0x5ecb51[_0x1d37ba]['bay']=0x0,_0x5ecb51[_0x1d37ba]['bin']=0x0,_0x5ecb51[_0x1d37ba][_0x9e406d(0x121)]='Floor',_0x5ecb51[_0x1d37ba]['floorlevel']=_0x5b0acc;}else{if(_0xd01b47==_0x9e406d(0x11f)&&_0x1d37ba==_0x479867){var _0x5b0acc=_0x2413ce[_0x9e406d(0x1a1)](0x3);_0x5ecb51[_0x1d37ba]['storage']=_0x2413ce[0x0],_0x5ecb51[_0x1d37ba][_0x9e406d(0x140)]=_0x2413ce[0x1],_0x5ecb51[_0x1d37ba][_0x9e406d(0x165)]=0x0,_0x5ecb51[_0x1d37ba][_0x9e406d(0x1a7)]=0x0,_0x5ecb51[_0x1d37ba][_0x9e406d(0x121)]=_0x9e406d(0x158),_0x5ecb51[_0x1d37ba][_0x9e406d(0xe4)]=_0x2413ce[0x5];}else{if(_0x1d37ba==_0x479867){var _0x2bc4e4;if(_0x2413ce[0x4]=='L')_0x2bc4e4=_0x9e406d(0x127);else _0x2413ce[0x4]=='F'&&(_0x2bc4e4='Floor');_0x5ecb51[_0x1d37ba][_0x9e406d(0x155)]=_0x2413ce[0x0],_0x5ecb51[_0x1d37ba][_0x9e406d(0x140)]=_0x2413ce[0x1],_0x5ecb51[_0x1d37ba][_0x9e406d(0x165)]=_0x2413ce[0x2],_0x5ecb51[_0x1d37ba]['bin']=_0x2413ce[0x3],_0x5ecb51[_0x1d37ba][_0x9e406d(0x121)]=_0x2bc4e4,_0x5ecb51[_0x1d37ba][_0x9e406d(0xe4)]=_0x2413ce[0x5];}}}});}),_0x2e3dd6[_0x5a7e18(0x11b)]((_0x52dc67,_0xa20304)=>{var _0x7903bb=_0x5a7e18;_0x5ecb51[_0xa20304][_0x7903bb(0x195)]=_0x52dc67;}),_0x240dc1[_0x5a7e18(0x11b)]((_0x4ea98e,_0x2523a9)=>{var _0x2a503c=_0x5a7e18;_0x5ecb51[_0x2523a9][_0x2a503c(0x16e)]=_0x4ea98e;}),_0xa30da7[_0x5a7e18(0x11b)]((_0x16de96,_0x403e38)=>{var _0x2fadc9=_0x5a7e18;_0x5ecb51[_0x403e38][_0x2fadc9(0x14f)]=_0x16de96;}),_0x1d65d2[_0x5a7e18(0x11b)]((_0x356729,_0x1a1768)=>{var _0x26677c=_0x5a7e18;_0x5ecb51[_0x1a1768][_0x26677c(0x1ad)]=_0x356729;}),_0x546c22[_0x5a7e18(0x11b)]((_0xe2671c,_0x5e7578)=>{var _0xb587d4=_0x5a7e18;_0x5ecb51[_0x5e7578][_0xb587d4(0x1ac)]=_0xe2671c;}),_0x995f7e[_0x5a7e18(0x11b)]((_0x152472,_0x3dda10)=>{var _0x3484a8=_0x5a7e18;_0x5ecb51[_0x3dda10][_0x3484a8(0x129)]=_0x152472;}),_0x57840a[_0x5a7e18(0x11b)]((_0x1a6936,_0x201bca)=>{var _0x5aee88=_0x5a7e18;_0x5ecb51[_0x201bca][_0x5aee88(0xfb)]=_0x1a6936;}),_0x4a540d['forEach']((_0x2305b1,_0x237a37)=>{var _0x44ed2=_0x5a7e18;_0x5ecb51[_0x237a37][_0x44ed2(0x176)]=_0x2305b1;}),_0x31057c['forEach']((_0xb2d865,_0x17c52f)=>{var _0x261f6c=_0x5a7e18;_0x5ecb51[_0x17c52f][_0x261f6c(0x181)]=_0xb2d865;}),_0x30522f[_0x5a7e18(0x11b)]((_0x217774,_0x1dd284)=>{var _0x54aa64=_0x5a7e18;_0x5ecb51[_0x1dd284][_0x54aa64(0x187)]=_0x217774;}),_0x483971[_0x5a7e18(0x11b)]((_0x370efc,_0x2edb2a)=>{var _0x1ae203=_0x5a7e18;_0x5ecb51[_0x2edb2a][_0x1ae203(0xef)]=_0x370efc;}),_0x4836b1[_0x5a7e18(0x11b)]((_0x244e09,_0x2719e1)=>{_0x5ecb51[_0x2719e1]['production_date']=_0x244e09;}),_0x583bf8[_0x5a7e18(0x11b)]((_0x255e92,_0x446bd6)=>{_0x5ecb51[_0x446bd6]['prod_cat']=_0x255e92;}),_0x2e8e5e[_0x5a7e18(0x11b)]((_0x55b8f0,_0x9958eb)=>{var _0x7a8fe1=_0x5a7e18;_0x5ecb51[_0x9958eb][_0x7a8fe1(0xf5)]=_0x55b8f0;}),_0x3f6d64['forEach']((_0x2b4995,_0x4fcb70)=>{_0x5ecb51[_0x4fcb70]['primary_code']=_0x2b4995;}),_0x16168f[_0x5a7e18(0x11b)]((_0x4c2707,_0x2135bb)=>{var _0x5777b1=_0x5a7e18;_0x5ecb51[_0x2135bb][_0x5777b1(0xf2)]=_0x4c2707;}),_0x346c53[_0x5a7e18(0x11b)]((_0x46fba7,_0x48cd9c)=>{var _0x191f1e=_0x5a7e18;_0x5ecb51[_0x48cd9c][_0x191f1e(0xe0)]=_0x46fba7;});const _0x223ff9=_0x5ecb51[_0x5a7e18(0x12c)](_0x17170d=>_0x17170d[_0x5a7e18(0x1ad)]!=='0'&&_0x17170d[_0x5a7e18(0x1ad)]!=='');var _0x265b19=0x0;_0x223ff9[_0x5a7e18(0x11b)](_0x527192=>{var _0x3e1af7=_0x5a7e18;console[_0x3e1af7(0x12a)](_0x3e1af7(0x18f),_0x527192),parseInt(_0x527192['adjust_qty'])<=0x0&&_0x265b19++;});if(_0x265b19!=0x0)return _0xf5ec4b[_0x5a7e18(0x143)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x5cfd9f[_0x5a7e18(0x199)](_0x5a7e18(0xff));const _0x5760be=new adjustment({'warehouse_name':_0x4f1731,'date':_0x19dc0d,'product':_0x223ff9,'note':_0x1c3f3d,'room':_0x3917ef,'invoice':_0x39547d,'JO_number':_0x153160,'expiry_date':_0x1ac105}),_0x50945c=await _0x5760be[_0x5a7e18(0x175)]();_0xf5ec4b[_0x5a7e18(0x143)]('success','adjustment\x20add\x20successfull'),_0x5cfd9f[_0x5a7e18(0x199)](_0x5a7e18(0x12e)+_0x50945c['_id']);}catch(_0x18aec3){console[_0x5a7e18(0x12a)](_0x18aec3),_0x5cfd9f['status'](0xc8)[_0x5a7e18(0x190)]({'message':_0x18aec3[_0x5a7e18(0xed)]});}}),router[a0_0x580021(0x1a9)](a0_0x580021(0x19c),auth,async(_0x41f902,_0x5f256a)=>{var _0xc7564e=a0_0x580021;try{const {username:_0x4e4663,email:_0x4cd744,role:_0x53a7f5}=_0x41f902[_0xc7564e(0x197)],_0x34c7b1=_0x41f902['user'],_0x55f774=await profile['findOne']({'email':_0x34c7b1['email']}),_0x3c7c5a=await master_shop[_0xc7564e(0x15a)](),_0x555892=_0x41f902[_0xc7564e(0x15f)]['id'],_0xe2ee26=await adjustment[_0xc7564e(0x11c)]({'_id':_0x555892}),_0x521231=await purchases[_0xc7564e(0xe3)]([{'$match':{'warehouse_name':_0xe2ee26['warehouse_name']}},{'$unwind':_0xc7564e(0x130)},{'$group':{'_id':'$product.product_name'}}]),_0x33416e=await product[_0xc7564e(0x15a)]({}),_0x3856c0=await warehouse['aggregate']([{'$match':{'name':_0xe2ee26[_0xc7564e(0x1a0)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xc7564e(0x170),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xc7564e(0x11e)},'bin':{'$first':_0xc7564e(0xfa)},'type':{'$first':_0xc7564e(0x123)},'floorlevel':{'$first':_0xc7564e(0xe6)},'primary_code':{'$first':_0xc7564e(0x168)},'secondary_code':{'$first':_0xc7564e(0xe2)},'product_code':{'$first':_0xc7564e(0x147)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xc7564e(0x19e)},'maxPerUnit':{'$first':_0xc7564e(0x10b)},'expiry_date':{'$first':_0xc7564e(0x124)},'production_date':{'$first':_0xc7564e(0x107)},'batch_code':{'$first':_0xc7564e(0x106)},'room':{'$first':_0xc7564e(0x17c)}}}]);if(_0x3c7c5a[0x0][_0xc7564e(0x109)]==_0xc7564e(0xf9)){var _0x340584=users[_0xc7564e(0xf1)];console[_0xc7564e(0x12a)](_0x340584);}else{if(_0x3c7c5a[0x0]['language']==_0xc7564e(0x118))var _0x340584=users['Hindi'];else{if(_0x3c7c5a[0x0][_0xc7564e(0x109)]==_0xc7564e(0x1a6))var _0x340584=users[_0xc7564e(0x1a6)];else{if(_0x3c7c5a[0x0][_0xc7564e(0x109)]=='Spanish')var _0x340584=users[_0xc7564e(0x132)];else{if(_0x3c7c5a[0x0]['language']==_0xc7564e(0x110))var _0x340584=users[_0xc7564e(0x110)];else{if(_0x3c7c5a[0x0][_0xc7564e(0x109)]==_0xc7564e(0x16b))var _0x340584=users[_0xc7564e(0x103)];else{if(_0x3c7c5a[0x0][_0xc7564e(0x109)]=='Chinese')var _0x340584=users[_0xc7564e(0x167)];else{if(_0x3c7c5a[0x0][_0xc7564e(0x109)]==_0xc7564e(0x13d))var _0x340584=users[_0xc7564e(0xde)];}}}}}}}_0x5f256a[_0xc7564e(0x14c)](_0xc7564e(0x114),{'success':_0x41f902['flash'](_0xc7564e(0x108)),'errors':_0x41f902[_0xc7564e(0x143)]('errors'),'role':_0x34c7b1,'profile':_0x55f774,'adjustment':_0xe2ee26,'stock':_0x3856c0,'master_shop':_0x3c7c5a,'warehouse_name':_0x521231,'unit':_0x33416e,'language':_0x340584});}catch(_0x3e06cf){console['log'](_0x3e06cf),_0x5f256a[_0xc7564e(0x10f)](0xc8)[_0xc7564e(0x190)]({'message':_0x3e06cf[_0xc7564e(0xed)]});}}),router[a0_0x580021(0x157)]('/preview/:id',auth,async(_0x56ba04,_0x5bae8a)=>{var _0x1bbca3=a0_0x580021;try{const _0x55bc35=_0x56ba04['params']['id'],{warehouse_name:_0x24f039,Room_name:_0x2c9005}=_0x56ba04['body'],_0x551289=await adjustment[_0x1bbca3(0x11c)]({'_id':_0x55bc35}),_0x590262=_0x551289[_0x1bbca3(0xe7)][_0x1bbca3(0x113)](async _0xbd0fe4=>{var _0x1688b1=_0x1bbca3;if(_0xbd0fe4[_0x1688b1(0x1ad)]>0x0){var _0x92f5cf=await warehouse[_0x1688b1(0x1a5)]({'name':_0x24f039,'room':_0xbd0fe4[_0x1688b1(0xf5)],'warehouse_category':_0x1688b1(0xe9)});const _0x5132c1=_0x92f5cf[_0x1688b1(0x18e)][_0x1688b1(0x113)](_0x1c6bf2=>{var _0x21ab57=_0x1688b1;console['log'](_0xbd0fe4[_0x21ab57(0x14f)]+_0x21ab57(0x105));if(_0xbd0fe4['types']==_0x21ab57(0x11d)){if(_0x1c6bf2[_0x21ab57(0x145)]==_0xbd0fe4['product_name']&&_0x1c6bf2['floorlevel']==_0xbd0fe4['floorlevel']&&_0x1c6bf2['type']==_0xbd0fe4[_0x21ab57(0x121)]&&_0x1c6bf2['bin']==_0xbd0fe4[_0x21ab57(0x1a7)]&&_0x1c6bf2[_0x21ab57(0x165)]==_0xbd0fe4['bay']&&_0x1c6bf2[_0x21ab57(0x140)]==_0xbd0fe4[_0x21ab57(0x140)]&&_0x1c6bf2[_0x21ab57(0x155)]==_0xbd0fe4[_0x21ab57(0x155)]&&_0x1c6bf2['expiry_date']==_0xbd0fe4[_0x21ab57(0x187)]&&_0x1c6bf2['batch_code']==_0xbd0fe4[_0x21ab57(0x181)]&&_0x1c6bf2[_0x21ab57(0x196)]==_0xbd0fe4['production_date']&&_0x1c6bf2['invoice']==_0xbd0fe4[_0x21ab57(0xe0)]&&_0x1c6bf2[_0x21ab57(0x193)]==_0xbd0fe4[_0x21ab57(0x16e)]){var _0x58dc61;_0x58dc61=_0xbd0fe4[_0x21ab57(0x1ad)],_0xbd0fe4[_0x21ab57(0x17d)]=='S'&&(_0x58dc61=_0xbd0fe4[_0x21ab57(0x1ad)]),_0x1c6bf2['product_stock']=_0x1c6bf2[_0x21ab57(0x19a)]-_0x58dc61;}}else{if(_0x1c6bf2['product_name']==_0xbd0fe4[_0x21ab57(0x145)]&&_0x1c6bf2[_0x21ab57(0xe4)]==_0xbd0fe4[_0x21ab57(0xe4)]&&_0x1c6bf2[_0x21ab57(0x121)]==_0xbd0fe4[_0x21ab57(0x121)]&&_0x1c6bf2['bin']==_0xbd0fe4['bin']&&_0x1c6bf2['bay']==_0xbd0fe4[_0x21ab57(0x165)]&&_0x1c6bf2[_0x21ab57(0x140)]==_0xbd0fe4[_0x21ab57(0x140)]&&_0x1c6bf2[_0x21ab57(0x155)]==_0xbd0fe4[_0x21ab57(0x155)]&&_0x1c6bf2['expiry_date']==_0xbd0fe4[_0x21ab57(0x187)]&&_0x1c6bf2[_0x21ab57(0x181)]==_0xbd0fe4[_0x21ab57(0x181)]&&_0x1c6bf2['production_date']==_0xbd0fe4['production_date']&&_0x1c6bf2[_0x21ab57(0xe0)]==_0xbd0fe4['invoice']&&_0x1c6bf2[_0x21ab57(0x193)]==_0xbd0fe4[_0x21ab57(0x16e)]){console[_0x21ab57(0x12a)](_0xbd0fe4);var _0x58dc61;_0x58dc61=_0xbd0fe4['adjust_qty'],_0xbd0fe4[_0x21ab57(0x17d)]=='S'&&(_0x58dc61=_0xbd0fe4['adjust_qty']),_0x1c6bf2[_0x21ab57(0x19a)]=_0x1c6bf2[_0x21ab57(0x19a)]+_0x58dc61;}}});}return _0x92f5cf;});Promise['all'](_0x590262)[_0x1bbca3(0x169)](async _0x5a6d33=>{var _0x118345=_0x1bbca3;try{for(const _0x116c6c of _0x5a6d33){await _0x116c6c[_0x118345(0x175)]();}_0x551289[_0x118345(0x14b)]=_0x118345(0x133);const _0x1a2c88=await _0x551289[_0x118345(0x175)](),_0x3d93e2=await master_shop[_0x118345(0x15a)](),_0x3e3474=await email_settings[_0x118345(0x1a5)](),_0x3390ca=await supervisor_settings[_0x118345(0x15a)]();var _0x77db6e=_0x551289[_0x118345(0xe7)],_0x1f14f1='',_0x2b3687;for(_0x2b3687 in _0x77db6e){_0x1f14f1+=_0x118345(0x13e)+_0x118345(0x19f)+_0x77db6e[_0x2b3687][_0x118345(0x145)]+_0x118345(0x102)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x77db6e[_0x2b3687][_0x118345(0x176)]+'</td>'+_0x118345(0x19f)+_0x77db6e[_0x2b3687]['adjust_qty']+_0x118345(0x102)+_0x118345(0x19f)+_0x77db6e[_0x2b3687][_0x118345(0x129)]+_0x118345(0x102)+_0x118345(0x19f)+_0x77db6e[_0x2b3687]['secondary_unit']+_0x118345(0x102)+_0x118345(0x19f)+_0x551289['warehouse_name']+_0x118345(0x102)+_0x118345(0x19f)+_0x77db6e[_0x2b3687][_0x118345(0xf5)]+_0x118345(0x102)+_0x118345(0x19f)+_0x77db6e[_0x2b3687][_0x118345(0x155)]+_0x77db6e[_0x2b3687][_0x118345(0x140)]+_0x77db6e[_0x2b3687][_0x118345(0x165)]+_0x77db6e[_0x2b3687][_0x118345(0x1a7)]+_0x77db6e[_0x2b3687]['type'][0x0]+_0x77db6e[_0x2b3687][_0x118345(0xe4)]+_0x118345(0x102),'</tr>';}let _0x5d7132=nodemailer[_0x118345(0xec)]({'host':_0x3e3474[_0x118345(0x156)],'port':Number(_0x3e3474[_0x118345(0x15b)]),'secure':![],'auth':{'user':_0x3e3474[_0x118345(0x122)],'pass':_0x3e3474['password']}}),_0x5cb35f={'from':_0x3e3474[_0x118345(0x122)],'to':_0x3390ca[0x0][_0x118345(0x148)],'subject':'Adjustment\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x118345(0x116)+'/upload/'+_0x3d93e2[0x0][_0x118345(0x135)],'cid':_0x118345(0x189)}],'html':_0x118345(0x177)+_0x118345(0x15e)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x118345(0x14e)+_0x118345(0x134)+_0x118345(0x159)+'<div>'+_0x118345(0x12b)+_0x3d93e2[0x0][_0x118345(0x146)]+_0x118345(0x160)+_0x118345(0x159)+'</div>'+_0x118345(0x13a)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x118345(0x149)+_0x551289[_0x118345(0xe0)]+'\x20'+_0x118345(0x11a)+_0x118345(0x1aa)+_0x551289[_0x118345(0x112)]+'\x20'+'</span>'+_0x118345(0x131)+_0x118345(0x159)+_0x118345(0x111)+_0x118345(0x16c)+_0x118345(0x13e)+_0x118345(0x198)+_0x118345(0x101)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x118345(0x164)+_0x118345(0x1a8)+_0x118345(0xfe)+_0x118345(0x13c)+_0x118345(0x18d)+'</tr>'+_0x118345(0x1a2)+_0x118345(0xe1)+'\x20'+_0x1f14f1+'\x20'+_0x118345(0x100)+_0x118345(0x128)+_0x118345(0x14e)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3d93e2[0x0][_0x118345(0x146)]+'</h5>'+_0x118345(0x159)+_0x118345(0x159)+_0x118345(0x19d)};_0x5d7132[_0x118345(0x17a)](_0x5cb35f,function(_0x3d44d9,_0x264767){var _0x334c03=_0x118345;_0x3d44d9?(console[_0x334c03(0x12a)](_0x3d44d9),console[_0x334c03(0x12a)]('Error\x20Occurs')):console[_0x334c03(0x12a)](_0x334c03(0x182));}),_0x56ba04['flash'](_0x118345(0x108),_0x118345(0x1a3)),_0x5bae8a[_0x118345(0x199)](_0x118345(0x150)+_0x1a2c88[_0x118345(0x193)]);}catch(_0x540796){console[_0x118345(0x16d)](_0x540796),_0x5bae8a[_0x118345(0x10f)](0x1f4)[_0x118345(0x190)]({'error':_0x118345(0xe5)});}})[_0x1bbca3(0xf8)](_0xa68ff=>{var _0x1da248=_0x1bbca3;console[_0x1da248(0x16d)](_0xa68ff),_0x5bae8a[_0x1da248(0x10f)](0x1f4)['json']({'error':_0x1da248(0x136)});});}catch(_0x1f51a8){console[_0x1bbca3(0x12a)](_0x1f51a8),_0x5bae8a[_0x1bbca3(0x10f)](0xc8)[_0x1bbca3(0x190)]({'message':_0x1f51a8[_0x1bbca3(0xed)]});}}),router[a0_0x580021(0x1a9)]('/view/:id',auth,async(_0x45f0a7,_0x595cef)=>{var _0x7da598=a0_0x580021;try{const {username:_0x2a83e9,email:_0x36d21c,role:_0x99b6de}=_0x45f0a7[_0x7da598(0x197)],_0x5f25c2=_0x45f0a7[_0x7da598(0x197)],_0x469f64=await profile[_0x7da598(0x1a5)]({'email':_0x5f25c2[_0x7da598(0x122)]}),_0x280bd2=await master_shop[_0x7da598(0x15a)](),_0x9eea6e=_0x45f0a7[_0x7da598(0x15f)]['id'],_0x7d2baa=await adjustment[_0x7da598(0x11c)]({'_id':_0x9eea6e}),_0x533fc0=await purchases[_0x7da598(0xe3)]([{'$match':{'warehouse_name':_0x7d2baa[_0x7da598(0x1a0)]}},{'$unwind':_0x7da598(0x130)},{'$group':{'_id':_0x7da598(0x119)}}]),_0x306746=await product[_0x7da598(0x15a)]({}),_0x3211e1=await warehouse[_0x7da598(0xe3)]([{'$match':{'name':_0x7d2baa['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x7da598(0x170),'name':{'$first':_0x7da598(0xfc)},'product_stock':{'$first':_0x7da598(0x117)},'bay':{'$first':_0x7da598(0x11e)},'bin':{'$first':_0x7da598(0xfa)},'type':{'$first':_0x7da598(0x123)},'floorlevel':{'$first':_0x7da598(0xe6)},'primary_code':{'$first':_0x7da598(0x168)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x7da598(0x10d)},'rack':{'$first':'$product_details.rack'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x7da598(0x17c)}}}]);let _0x1fa275;if(_0x5f25c2[_0x7da598(0x141)]==_0x7da598(0xfd)){const _0x58f621=await staff[_0x7da598(0x1a5)]({'email':_0x5f25c2[_0x7da598(0x122)]});_0x1fa275=await warehouse[_0x7da598(0xe3)]([{'$match':{'status':_0x7da598(0x174),'name':_0x58f621[_0x7da598(0x120)],'warehouse_category':_0x7da598(0xe9),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x7da598(0x125),'name':{'$first':_0x7da598(0x125)}}}]);}else _0x1fa275=await warehouse[_0x7da598(0xe3)]([{'$match':{'status':_0x7da598(0x174),'warehouse_category':_0x7da598(0xe9),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x7da598(0x125),'name':{'$first':'$name'}}}]);if(_0x280bd2[0x0][_0x7da598(0x109)]=='English\x20(US)'){var _0x4a2acc=users['English'];console[_0x7da598(0x12a)](_0x4a2acc);}else{if(_0x280bd2[0x0][_0x7da598(0x109)]==_0x7da598(0x118))var _0x4a2acc=users[_0x7da598(0x118)];else{if(_0x280bd2[0x0][_0x7da598(0x109)]=='German')var _0x4a2acc=users[_0x7da598(0x1a6)];else{if(_0x280bd2[0x0][_0x7da598(0x109)]==_0x7da598(0x132))var _0x4a2acc=users[_0x7da598(0x132)];else{if(_0x280bd2[0x0][_0x7da598(0x109)]==_0x7da598(0x110))var _0x4a2acc=users[_0x7da598(0x110)];else{if(_0x280bd2[0x0][_0x7da598(0x109)]==_0x7da598(0x16b))var _0x4a2acc=users[_0x7da598(0x103)];else{if(_0x280bd2[0x0][_0x7da598(0x109)]==_0x7da598(0x167))var _0x4a2acc=users['Chinese'];else{if(_0x280bd2[0x0]['language']=='Arabic\x20(ae)')var _0x4a2acc=users[_0x7da598(0xde)];}}}}}}}_0x595cef[_0x7da598(0x14c)](_0x7da598(0x19b),{'success':_0x45f0a7[_0x7da598(0x143)](_0x7da598(0x108)),'errors':_0x45f0a7['flash'](_0x7da598(0x154)),'role':_0x5f25c2,'profile':_0x469f64,'adjustment':_0x7d2baa,'stock':_0x3211e1,'master_shop':_0x280bd2,'warehouse_name':_0x533fc0,'unit':_0x306746,'language':_0x4a2acc,'warehouse':_0x1fa275});}catch(_0x1bd2cb){console['log'](_0x1bd2cb),_0x595cef[_0x7da598(0x10f)](0xc8)[_0x7da598(0x190)]({'message':_0x1bd2cb[_0x7da598(0xed)]});}}),router['post'](a0_0x580021(0xf3),auth,async(_0x472044,_0x270d22)=>{var _0x2f2eed=a0_0x580021;try{const _0x4f94a4=_0x472044['params']['id'],_0x39e99c=await adjustment[_0x2f2eed(0x11c)]({'_id':_0x4f94a4}),_0x126a33=await warehouse[_0x2f2eed(0x1a5)]({'name':_0x39e99c[_0x2f2eed(0x1a0)],'room':_0x39e99c[_0x2f2eed(0x151)]}),{warehouse_name:_0x906980,date:_0x24926f,prod_name:_0x1f39ac,level:_0x1216a6,isle:_0x33a646,pallet:_0x3c882c,stock:_0x30608b,types:_0x433f79,adjust_qty:_0x58863f,new_adjust_qty:_0x55ee3e,note:_0x2a2028,Room_name:_0x5c123d,invoice:_0x53e565,JO_number:_0x5d3517,expiry_date:_0x15cdb8}=_0x472044[_0x2f2eed(0x171)];if(typeof _0x1f39ac==_0x2f2eed(0x194))var _0x1e67fc=[_0x472044['body'][_0x2f2eed(0x139)]],_0x411860=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x179)]],_0x4596ce=[_0x472044['body']['stock']],_0x7ba916=[_0x472044['body']['types']],_0x3f3fee=[_0x472044['body'][_0x2f2eed(0x17b)]],_0x3fb5cb=[_0x472044['body'][_0x2f2eed(0x104)]],_0x57c507=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x183)]],_0x3b2801=[_0x472044['body']['Secondary_units']],_0xa93b20=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x17e)]],_0x10a4a5=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x181)]],_0x2d47d4=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x187)]],_0x4d5f25=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x15c)]],_0x32d6fa=[_0x472044['body'][_0x2f2eed(0x196)]],_0x3d1a44=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x17d)]],_0x1cd2e6=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x17f)]],_0x3cdc1b=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x166)]],_0x50998b=[_0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x13f)]];else var _0x1e67fc=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x139)]],_0x411860=[..._0x472044[_0x2f2eed(0x171)]['level']],_0x4596ce=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0xf7)]],_0x7ba916=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x14f)]],_0x3f3fee=[..._0x472044[_0x2f2eed(0x171)]['New_Qty_Converted_adj']],_0x3fb5cb=[..._0x472044['body'][_0x2f2eed(0x104)]],_0x57c507=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x129)]],_0x3b2801=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x152)]],_0xa93b20=[..._0x472044['body'][_0x2f2eed(0x17e)]],_0x10a4a5=[..._0x472044[_0x2f2eed(0x171)]['batch_code']],_0x2d47d4=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x187)]],_0x4d5f25=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x15c)]],_0x32d6fa=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x196)]],_0x3d1a44=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x17d)]],_0x1cd2e6=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x17f)]],_0x3cdc1b=[..._0x472044[_0x2f2eed(0x171)][_0x2f2eed(0x166)]],_0x50998b=[..._0x472044['body'][_0x2f2eed(0x13f)]];const _0x5c61d5=_0x1e67fc['map'](_0x5c8b7e=>{return _0x5c8b7e={'product_name':_0x5c8b7e};});_0x411860['forEach']((_0x306e13,_0x22a026)=>{var _0xdcf0dc=_0x2f2eed;_0x1cd2e6[_0xdcf0dc(0x11b)]((_0x4fb5b1,_0x5e5326)=>{var _0x2a84cc=_0xdcf0dc;if(_0x4fb5b1=='Receiving\x20Area'&&_0x22a026==_0x5e5326){var _0x3d3ce8=_0x306e13[_0x2a84cc(0x1a1)](0x3);_0x5c61d5[_0x22a026]['storage']=_0x306e13[0x0],_0x5c61d5[_0x22a026][_0x2a84cc(0x140)]=_0x306e13[0x1],_0x5c61d5[_0x22a026][_0x2a84cc(0x165)]=0x0,_0x5c61d5[_0x22a026][_0x2a84cc(0x1a7)]=0x0,_0x5c61d5[_0x22a026][_0x2a84cc(0x121)]='Floor',_0x5c61d5[_0x22a026][_0x2a84cc(0xe4)]=_0x3d3ce8;}else{if(_0x4fb5b1==_0x2a84cc(0x11f)&&_0x22a026==_0x5e5326){var _0x3d3ce8=_0x306e13[_0x2a84cc(0x1a1)](0x3);_0x5c61d5[_0x22a026][_0x2a84cc(0x155)]=_0x306e13[0x0],_0x5c61d5[_0x22a026]['rack']=_0x306e13[0x1],_0x5c61d5[_0x22a026][_0x2a84cc(0x165)]=0x0,_0x5c61d5[_0x22a026]['bin']=0x0,_0x5c61d5[_0x22a026]['type']='Floor',_0x5c61d5[_0x22a026][_0x2a84cc(0xe4)]=_0x306e13[0x5];}else{if(_0x22a026==_0x5e5326){var _0x1c3941;if(_0x306e13[0x4]=='L')_0x1c3941=_0x2a84cc(0x127);else _0x306e13[0x4]=='F'&&(_0x1c3941=_0x2a84cc(0x158));_0x5c61d5[_0x22a026]['storage']=_0x306e13[0x0],_0x5c61d5[_0x22a026][_0x2a84cc(0x140)]=_0x306e13[0x1],_0x5c61d5[_0x22a026][_0x2a84cc(0x165)]=_0x306e13[0x2],_0x5c61d5[_0x22a026][_0x2a84cc(0x1a7)]=_0x306e13[0x3],_0x5c61d5[_0x22a026][_0x2a84cc(0x121)]=_0x1c3941,_0x5c61d5[_0x22a026]['floorlevel']=_0x306e13[0x5];}}}});}),_0x4596ce['forEach']((_0x138006,_0x18806e)=>{var _0x2c8624=_0x2f2eed;_0x5c61d5[_0x18806e][_0x2c8624(0x195)]=_0x138006;}),_0x7ba916[_0x2f2eed(0x11b)]((_0x227f73,_0x17457f)=>{var _0x123b9a=_0x2f2eed;_0x5c61d5[_0x17457f][_0x123b9a(0x14f)]=_0x227f73;}),_0x3f3fee[_0x2f2eed(0x11b)]((_0x3ca93c,_0xfbc649)=>{var _0x443d2a=_0x2f2eed;_0x5c61d5[_0xfbc649][_0x443d2a(0x1ad)]=_0x3ca93c;}),_0x3fb5cb[_0x2f2eed(0x11b)]((_0x1bf64d,_0x5f1ea0)=>{var _0x55daa7=_0x2f2eed;_0x5c61d5[_0x5f1ea0][_0x55daa7(0x1ac)]=_0x1bf64d;}),_0x57c507[_0x2f2eed(0x11b)]((_0x4c704a,_0x2141f7)=>{var _0x31fabd=_0x2f2eed;_0x5c61d5[_0x2141f7][_0x31fabd(0x129)]=_0x4c704a;}),_0x3b2801[_0x2f2eed(0x11b)]((_0x4afc3d,_0x1560d3)=>{var _0x26048b=_0x2f2eed;_0x5c61d5[_0x1560d3][_0x26048b(0xfb)]=_0x4afc3d;}),_0xa93b20[_0x2f2eed(0x11b)]((_0x15d776,_0x4ead78)=>{_0x5c61d5[_0x4ead78]['product_code']=_0x15d776;}),_0x10a4a5['forEach']((_0x3b8884,_0x26041e)=>{var _0xfb9ce5=_0x2f2eed;_0x5c61d5[_0x26041e][_0xfb9ce5(0x181)]=_0x3b8884;}),_0x2d47d4[_0x2f2eed(0x11b)]((_0x43ed7f,_0x34bd14)=>{_0x5c61d5[_0x34bd14]['expiry_date']=_0x43ed7f;}),_0x4d5f25[_0x2f2eed(0x11b)]((_0x290d1b,_0x561cff)=>{_0x5c61d5[_0x561cff]['maxperunit']=_0x290d1b;}),_0x32d6fa['forEach']((_0x5f08c8,_0x3e8ce1)=>{var _0x263eac=_0x2f2eed;_0x5c61d5[_0x3e8ce1][_0x263eac(0x196)]=_0x5f08c8;}),_0x3d1a44['forEach']((_0x4fcc7a,_0x1e9d96)=>{var _0xb14b9a=_0x2f2eed;_0x5c61d5[_0x1e9d96][_0xb14b9a(0x17d)]=_0x4fcc7a;}),_0x1cd2e6[_0x2f2eed(0x11b)]((_0x32e5e8,_0x393865)=>{var _0x18833b=_0x2f2eed;_0x5c61d5[_0x393865][_0x18833b(0xf5)]=_0x32e5e8;}),_0x3cdc1b['forEach']((_0x2cbbf6,_0xe55642)=>{_0x5c61d5[_0xe55642]['primary_code']=_0x2cbbf6;}),_0x50998b[_0x2f2eed(0x11b)]((_0x259692,_0x436901)=>{var _0x111aef=_0x2f2eed;_0x5c61d5[_0x436901][_0x111aef(0xf2)]=_0x259692;});const _0x28bfe2=_0x5c61d5['filter'](_0x232ca1=>_0x232ca1[_0x2f2eed(0x1ad)]!=='0'&&_0x232ca1[_0x2f2eed(0x1ad)]!=='');var _0x1a3c2b=0x0;_0x28bfe2[_0x2f2eed(0x11b)](_0x149d61=>{var _0x57de92=_0x2f2eed;console[_0x57de92(0x12a)](_0x57de92(0x18f),_0x149d61),parseInt(_0x149d61[_0x57de92(0x1ad)])<=0x0&&_0x1a3c2b++;});if(_0x1a3c2b!=0x0)return _0x472044[_0x2f2eed(0x143)](_0x2f2eed(0x154),_0x2f2eed(0x18a)),_0x270d22[_0x2f2eed(0x199)](_0x2f2eed(0xff));_0x39e99c['warehouse_name']=_0x906980,_0x39e99c[_0x2f2eed(0x112)]=_0x24926f,_0x39e99c[_0x2f2eed(0xe7)]=_0x28bfe2,_0x39e99c[_0x2f2eed(0x18c)]=_0x2a2028,_0x39e99c['invoice']=_0x53e565,_0x39e99c[_0x2f2eed(0x16f)]=_0x2f2eed(0x13b);const _0x2858dd=await _0x39e99c[_0x2f2eed(0x175)]();_0x472044[_0x2f2eed(0x143)](_0x2f2eed(0x108),_0x2f2eed(0x10c)),_0x270d22[_0x2f2eed(0x199)](_0x2f2eed(0x126));}catch(_0x570e7c){console['log'](_0x570e7c);}}),router['post'](a0_0x580021(0x142),async(_0x155183,_0x54249c)=>{var _0x202dcc=a0_0x580021;const {primary_code:_0x813661,warehouse_data:_0x256e76,rooms_data:_0x3eb3da,Roomslist:_0x5c9082}=_0x155183[_0x202dcc(0x171)],_0x4e0ab7=_0x5c9082[_0x202dcc(0x162)](','),_0x23edbe=[];async function _0x207fec(_0x5b35ea){var _0x56aa17=_0x202dcc;const _0x565a0f=await warehouse['aggregate']([{'$match':{'name':_0x256e76,'room':_0x5b35ea}},{'$unwind':_0x56aa17(0x186)},{'$match':{'product_details.primary_code':_0x813661}},{'$group':{'_id':_0x56aa17(0x170),'name':{'$first':_0x56aa17(0xfc)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x56aa17(0x168)},'secondary_code':{'$first':_0x56aa17(0xe2)},'product_code':{'$first':_0x56aa17(0x147)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x56aa17(0xfa)},'type':{'$first':_0x56aa17(0x123)},'pallet':{'$first':_0x56aa17(0xe6)},'unit':{'$first':_0x56aa17(0x178)},'secondary_unit':{'$first':_0x56aa17(0x192)},'storage':{'$first':_0x56aa17(0x10d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x56aa17(0x124)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x56aa17(0x180)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x56aa17(0x17c)},'invoice':{'$first':_0x56aa17(0x173)}}}]),_0x477e8b=await warehouse[_0x56aa17(0xe3)]([{'$match':{'name':_0x256e76,'room':_0x5b35ea}},{'$unwind':_0x56aa17(0x186)},{'$match':{'product_details.secondary_code':_0x813661}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x56aa17(0x117)},'primary_code':{'$first':_0x56aa17(0x168)},'secondary_code':{'$first':_0x56aa17(0xe2)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x56aa17(0x11e)},'isle':{'$first':_0x56aa17(0xfa)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x56aa17(0xe6)},'unit':{'$first':_0x56aa17(0x178)},'secondary_unit':{'$first':_0x56aa17(0x192)},'storage':{'$first':_0x56aa17(0x10d)},'rack':{'$first':_0x56aa17(0x19e)},'expiry_date':{'$first':_0x56aa17(0x124)},'production_date':{'$first':_0x56aa17(0x107)},'maxPerUnit':{'$first':_0x56aa17(0x10b)},'batch_code':{'$first':_0x56aa17(0x106)},'product_cat':{'$first':_0x56aa17(0x180)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x56aa17(0x17c)}}}]);if(_0x565a0f['length']>0x0)_0x23edbe[_0x56aa17(0x172)](_0x565a0f);else _0x477e8b[_0x56aa17(0xf6)]>0x0&&_0x23edbe[_0x56aa17(0x172)](_0x477e8b);}const _0xfc5d0d=_0x4e0ab7['map'](_0x734a08=>_0x207fec(_0x734a08));await Promise['all'](_0xfc5d0d),_0x54249c[_0x202dcc(0x190)](_0x23edbe);}),router[a0_0x580021(0x157)]('/CheckingWarehouse',async(_0x2de8c6,_0x31f810)=>{var _0x1dd41e=a0_0x580021;const {primaryCode:_0x44193c,secondaryCode:_0x1def72,productCode:_0x3a853f,level:_0x4b497c,isle:_0x1291ba,pallet:_0x333c3b,warehouses:_0x17ec4a,room:_0x43b0cd}=_0x2de8c6[_0x1dd41e(0x171)];try{const _0xe4f703=await warehouse[_0x1dd41e(0xe3)]([{'$match':{'name':_0x17ec4a,'room':_0x43b0cd}},{'$unwind':'$product_details'},{'$match':{'product_details.level':parseInt(_0x4b497c),'product_details.isle':_0x1291ba,'product_details.pallet':parseInt(_0x333c3b)}},{'$group':{'_id':_0x1dd41e(0x170),'name':{'$first':_0x1dd41e(0xfc)},'product_stock':{'$first':_0x1dd41e(0x117)},'level':{'$first':_0x1dd41e(0x1a4)},'isle':{'$first':_0x1dd41e(0xdb)},'pallet':{'$first':_0x1dd41e(0x18b)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x31f810['status'](0xc8)[_0x1dd41e(0x190)](_0xe4f703);}catch(_0x247832){_0x31f810['status'](0x194)[_0x1dd41e(0x190)]({'message':_0x247832[_0x1dd41e(0xed)]});}}),module[a0_0x580021(0xf4)]=router;