const a0_0x34f7d5=a0_0x4d44;(function(_0x2937e4,_0x2527bd){const _0x1a0ebc=a0_0x4d44,_0x4d5b15=_0x2937e4();while(!![]){try{const _0x26ad54=parseInt(_0x1a0ebc(0xee))/0x1+parseInt(_0x1a0ebc(0x10c))/0x2+parseInt(_0x1a0ebc(0x110))/0x3+parseInt(_0x1a0ebc(0x12b))/0x4+-parseInt(_0x1a0ebc(0xf6))/0x5*(parseInt(_0x1a0ebc(0x101))/0x6)+parseInt(_0x1a0ebc(0xde))/0x7*(-parseInt(_0x1a0ebc(0x11a))/0x8)+-parseInt(_0x1a0ebc(0x10f))/0x9;if(_0x26ad54===_0x2527bd)break;else _0x4d5b15['push'](_0x4d5b15['shift']());}catch(_0x429884){_0x4d5b15['push'](_0x4d5b15['shift']());}}}(a0_0x9ee5,0xade6b));function a0_0x4d44(_0x217c34,_0x246980){const _0x9ee597=a0_0x9ee5();return a0_0x4d44=function(_0x4d445c,_0xb1d6ba){_0x4d445c=_0x4d445c-0xd8;let _0x19b961=_0x9ee597[_0x4d445c];return _0x19b961;},a0_0x4d44(_0x217c34,_0x246980);}function a0_0x9ee5(){const _0x3c41dc=['../public/language/languages.json','12AHeTpL','redirect','user','adj_discount','body','view_sales_sa','express','originalname','product_name','prod_name','English\x20(US)','650744icqBUE','Types','id_transaction','4868541SLkjWx','545418BEMxUc','prod_code','/product_data_id','Arabic\x20(ae)','map','Chinese','German','/add_sales','conversion_unit','save','4829176qlDgIs','params','exceljs','price','Arabic','./public/sales_invoice','Portuguese\x20(BR)','quantity','/getProductData','filename','secondary_unit','$product_list','padStart','unit','../models/all_models','aggregate','English','19924ylsLOl','Hindi','success','Spanish','exports','French','diskStorage','true','flash','/product_data','toString','get','mongoose','7IIksuw','totalPrice','isFG','find','Portuguese','string','post','language','single','findOne','errors','now','Router','tmpisFG','forEach','invoice_starts','1393738pphvXb','email','/product_list','valueOf','findById','add_sales_sa','_id','/volume_setup','122505ATubQn','getPrimUnitNo','log','/sales_sa/view_sales/','json','all_sales_sa','render','/view_sales/:id','primary_code','Sales\x20add\x20successfully'];a0_0x9ee5=function(){return _0x3c41dc;};return a0_0x9ee5();}const express=require(a0_0x34f7d5(0x107)),app=express(),router=express[a0_0x34f7d5(0xea)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up,invoice_sa,sales_sa,discount_volume_db}=require(a0_0x34f7d5(0x128)),auth=require('../middleware/auth'),users=require(a0_0x34f7d5(0x100)),excelJS=require(a0_0x34f7d5(0x11c)),xlsx=require('xlsx'),mongoose=require(a0_0x34f7d5(0xdd)),multer=require('multer'),storage=multer[a0_0x34f7d5(0x131)]({'destination':(_0x19e7fe,_0x1b6bce,_0x35eb7c)=>{const _0xd5ec44=a0_0x34f7d5;_0x35eb7c(null,_0xd5ec44(0x11f));},'filename':(_0x591a8e,_0x1f21fb,_0x33c585)=>{const _0x168e2e=a0_0x34f7d5;_0x33c585(null,Date[_0x168e2e(0xe9)]()+'~'+_0x1f21fb[_0x168e2e(0x108)]);}}),upload=multer({'storage':storage});router['get']('/',auth,async(_0x2c6787,_0x4c639d)=>{const _0x3f7536=a0_0x34f7d5;try{const _0x46330b=await master_shop[_0x3f7536(0xe1)](),_0x111d8e=_0x2c6787[_0x3f7536(0x103)],_0x3a4c3a=await profile[_0x3f7536(0xe7)]({'email':_0x111d8e[_0x3f7536(0xef)]}),_0x476cbe=await staff[_0x3f7536(0xe7)]({'email':_0x111d8e[_0x3f7536(0xef)]}),_0x38add7=await sales_sa['find']({'sales_staff_id':_0x476cbe[_0x3f7536(0xf4)]});if(_0x46330b[0x0]['language']==_0x3f7536(0x10b))var _0x429366=users[_0x3f7536(0x12a)];else{if(_0x46330b[0x0][_0x3f7536(0xe5)]==_0x3f7536(0x12c))var _0x429366=users[_0x3f7536(0x12c)];else{if(_0x46330b[0x0]['language']==_0x3f7536(0x116))var _0x429366=users[_0x3f7536(0x116)];else{if(_0x46330b[0x0][_0x3f7536(0xe5)]=='Spanish')var _0x429366=users['Spanish'];else{if(_0x46330b[0x0][_0x3f7536(0xe5)]==_0x3f7536(0x130))var _0x429366=users['French'];else{if(_0x46330b[0x0][_0x3f7536(0xe5)]=='Portuguese\x20(BR)')var _0x429366=users[_0x3f7536(0xe2)];else{if(_0x46330b[0x0][_0x3f7536(0xe5)]==_0x3f7536(0x115))var _0x429366=users[_0x3f7536(0x115)];else{if(_0x46330b[0x0][_0x3f7536(0xe5)]=='Arabic\x20(ae)')var _0x429366=users[_0x3f7536(0x11e)];}}}}}}}_0x4c639d['render'](_0x3f7536(0xfb),{'success':_0x2c6787['flash']('success'),'errors':_0x2c6787[_0x3f7536(0xd9)](_0x3f7536(0xe8)),'master_shop':_0x46330b,'profile':_0x3a4c3a,'role':_0x111d8e,'language':_0x429366,'product_list':_0x476cbe['product_list'],'sales_mine':_0x38add7,'staff_arr':_0x476cbe});}catch(_0x3f70f8){console[_0x3f7536(0xf8)](_0x3f70f8);}}),router[a0_0x34f7d5(0xdc)]('/add_sales',auth,async(_0xa76b49,_0x5739d6)=>{const _0x3a0b0d=a0_0x34f7d5;try{const _0x43bb80=await master_shop['find'](),_0x418fa9=_0xa76b49[_0x3a0b0d(0x103)],_0x3472c1=await profile[_0x3a0b0d(0xe7)]({'email':_0x418fa9[_0x3a0b0d(0xef)]}),_0x11ff92=await staff[_0x3a0b0d(0xe7)]({'email':_0x418fa9[_0x3a0b0d(0xef)]}),_0x42700e=await customer[_0x3a0b0d(0xe1)]({'agent_id':_0x11ff92[_0x3a0b0d(0xf4)]});if(_0x43bb80[0x0]['language']==_0x3a0b0d(0x10b))var _0x51a903=users[_0x3a0b0d(0x12a)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]==_0x3a0b0d(0x12c))var _0x51a903=users[_0x3a0b0d(0x12c)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]==_0x3a0b0d(0x116))var _0x51a903=users[_0x3a0b0d(0x116)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]==_0x3a0b0d(0x12e))var _0x51a903=users[_0x3a0b0d(0x12e)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]=='French')var _0x51a903=users[_0x3a0b0d(0x130)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]==_0x3a0b0d(0x120))var _0x51a903=users[_0x3a0b0d(0xe2)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]==_0x3a0b0d(0x115))var _0x51a903=users[_0x3a0b0d(0x115)];else{if(_0x43bb80[0x0][_0x3a0b0d(0xe5)]==_0x3a0b0d(0x113))var _0x51a903=users[_0x3a0b0d(0x11e)];}}}}}}}_0x5739d6[_0x3a0b0d(0xfc)](_0x3a0b0d(0xf3),{'success':_0xa76b49[_0x3a0b0d(0xd9)]('success'),'errors':_0xa76b49[_0x3a0b0d(0xd9)](_0x3a0b0d(0xe8)),'master_shop':_0x43bb80,'profile':_0x3472c1,'role':_0x418fa9,'language':_0x51a903,'customer':_0x42700e,'staff_arr':_0x11ff92});}catch(_0x2aeb40){console['log'](_0x2aeb40);}}),router[a0_0x34f7d5(0xdc)](a0_0x34f7d5(0xfd),auth,async(_0x1e947a,_0x2749e6)=>{const _0x418101=a0_0x34f7d5;try{const _0x5257c7=await master_shop[_0x418101(0xe1)](),_0x11e753=_0x1e947a[_0x418101(0x103)],_0x2d00ae=await profile[_0x418101(0xe7)]({'email':_0x11e753[_0x418101(0xef)]}),_0x103a5f=await staff['findOne']({'email':_0x11e753[_0x418101(0xef)]}),_0x5b2bc6=await customer[_0x418101(0xe1)]({'agent_id':_0x103a5f[_0x418101(0xf4)]}),_0x4b0b74=_0x1e947a[_0x418101(0x11b)]['id'],_0x279c41=await sales_sa[_0x418101(0xf2)](_0x4b0b74);if(_0x5257c7[0x0][_0x418101(0xe5)]=='English\x20(US)')var _0x26a8a9=users[_0x418101(0x12a)];else{if(_0x5257c7[0x0][_0x418101(0xe5)]==_0x418101(0x12c))var _0x26a8a9=users[_0x418101(0x12c)];else{if(_0x5257c7[0x0]['language']=='German')var _0x26a8a9=users[_0x418101(0x116)];else{if(_0x5257c7[0x0][_0x418101(0xe5)]==_0x418101(0x12e))var _0x26a8a9=users[_0x418101(0x12e)];else{if(_0x5257c7[0x0][_0x418101(0xe5)]==_0x418101(0x130))var _0x26a8a9=users[_0x418101(0x130)];else{if(_0x5257c7[0x0][_0x418101(0xe5)]==_0x418101(0x120))var _0x26a8a9=users[_0x418101(0xe2)];else{if(_0x5257c7[0x0][_0x418101(0xe5)]=='Chinese')var _0x26a8a9=users[_0x418101(0x115)];else{if(_0x5257c7[0x0][_0x418101(0xe5)]==_0x418101(0x113))var _0x26a8a9=users['Arabic'];}}}}}}}_0x2749e6[_0x418101(0xfc)](_0x418101(0x106),{'success':_0x1e947a[_0x418101(0xd9)](_0x418101(0x12d)),'errors':_0x1e947a[_0x418101(0xd9)](_0x418101(0xe8)),'master_shop':_0x5257c7,'profile':_0x2d00ae,'role':_0x11e753,'language':_0x26a8a9,'customer':_0x5b2bc6,'sales_sa':_0x279c41,'staff_arr':_0x103a5f});}catch(_0x17aa0b){console['log'](_0x17aa0b);}}),router[a0_0x34f7d5(0xe4)](a0_0x34f7d5(0x117),auth,upload[a0_0x34f7d5(0xe6)]('image'),async(_0x4e0125,_0x20ea97)=>{const _0x24f567=a0_0x34f7d5;try{const {customer:_0x253998,date:_0xf1a1b4,prod_code:_0x23b7e9,note:_0x419c99,paid_status:_0x44243f,DSI:_0x222f35,cash_amount:_0x26b0d9,amount_data:_0x3088bb,bank_data:_0x1771f8,check_no:_0x256404,due_date:_0x3cb358}=_0x4e0125['body'],_0x5d47d8=_0x4e0125['file'][_0x24f567(0x123)];if(typeof _0x23b7e9==_0x24f567(0xe3))var _0x2cd625=[_0x4e0125['body'][_0x24f567(0x111)]],_0xd3540e=[_0x4e0125['body'][_0x24f567(0x10a)]],_0x18f5ce=[_0x4e0125[_0x24f567(0x105)][_0x24f567(0xfe)]],_0x317e7a=[_0x4e0125[_0x24f567(0x105)]['quantity']],_0x5b4123=[_0x4e0125[_0x24f567(0x105)][_0x24f567(0x127)]],_0x573835=[_0x4e0125[_0x24f567(0x105)][_0x24f567(0x11d)]],_0x42a1b5=[_0x4e0125[_0x24f567(0x105)]['totalPrice']],_0x35ee28=[_0x4e0125[_0x24f567(0x105)][_0x24f567(0x10e)]],_0x5dc312=[_0x4e0125[_0x24f567(0x105)]['adj_dicount_price']],_0x3767ee=[_0x4e0125[_0x24f567(0x105)][_0x24f567(0xeb)]],_0x228826=[_0x4e0125[_0x24f567(0x105)]['no_per_unit']],_0x56a776=[_0x4e0125[_0x24f567(0x105)]['getPrimUnitNo']],_0x9051b8=[_0x4e0125[_0x24f567(0x105)]['prod_cat']],_0x17879=[_0x4e0125['body'][_0x24f567(0x124)]],_0x438281=[_0x4e0125[_0x24f567(0x105)][_0x24f567(0x118)]];else var _0x2cd625=[..._0x4e0125[_0x24f567(0x105)]['prod_code']],_0xd3540e=[..._0x4e0125['body'][_0x24f567(0x10a)]],_0x18f5ce=[..._0x4e0125[_0x24f567(0x105)][_0x24f567(0xfe)]],_0x317e7a=[..._0x4e0125[_0x24f567(0x105)][_0x24f567(0x121)]],_0x5b4123=[..._0x4e0125[_0x24f567(0x105)][_0x24f567(0x127)]],_0x573835=[..._0x4e0125[_0x24f567(0x105)][_0x24f567(0x11d)]],_0x42a1b5=[..._0x4e0125['body'][_0x24f567(0xdf)]],_0x35ee28=[..._0x4e0125[_0x24f567(0x105)]['id_transaction']],_0x5dc312=[..._0x4e0125[_0x24f567(0x105)]['adj_dicount_price']],_0x3767ee=[..._0x4e0125['body'][_0x24f567(0xeb)]],_0x228826=[..._0x4e0125[_0x24f567(0x105)]['no_per_unit']],_0x56a776=[..._0x4e0125[_0x24f567(0x105)][_0x24f567(0xf7)]],_0x9051b8=[..._0x4e0125[_0x24f567(0x105)]['prod_cat']],_0x17879=[..._0x4e0125[_0x24f567(0x105)][_0x24f567(0x124)]],_0x438281=[..._0x4e0125['body'][_0x24f567(0x118)]];const _0x125e9c=_0x2cd625[_0x24f567(0x114)](_0x58d95e=>{return _0x58d95e={'product_code':_0x58d95e};});_0xd3540e[_0x24f567(0xec)]((_0x191aab,_0x152bbf)=>{const _0x218a6a=_0x24f567;_0x125e9c[_0x152bbf][_0x218a6a(0x109)]=_0x191aab;}),_0x18f5ce[_0x24f567(0xec)]((_0x4c7e62,_0x358134)=>{const _0xe7d431=_0x24f567;_0x125e9c[_0x358134][_0xe7d431(0xfe)]=_0x4c7e62;}),_0x228826[_0x24f567(0xec)]((_0x3155de,_0x5d5720)=>{_0x125e9c[_0x5d5720]['no_per_unit']=_0x3155de;}),_0x317e7a[_0x24f567(0xec)]((_0x565a4a,_0xe9fd83)=>{const _0x58955a=_0x24f567;_0x125e9c[_0xe9fd83][_0x58955a(0x121)]=_0x565a4a;}),_0x5b4123[_0x24f567(0xec)]((_0x50b82d,_0x2d69f0)=>{_0x125e9c[_0x2d69f0]['unit']=_0x50b82d;}),_0x573835[_0x24f567(0xec)]((_0x28b7e1,_0x13d06a)=>{_0x125e9c[_0x13d06a]['price']=_0x28b7e1;}),_0x42a1b5[_0x24f567(0xec)]((_0x2ea715,_0x35f261)=>{_0x125e9c[_0x35f261]['totalprice']=_0x2ea715;}),_0x35ee28['forEach']((_0x1dbdfe,_0x126b73)=>{_0x125e9c[_0x126b73]['id_transaction_from']=_0x1dbdfe;}),_0x5dc312['forEach']((_0x4a5c21,_0x2484b6)=>{const _0x13c515=_0x24f567;_0x125e9c[_0x2484b6][_0x13c515(0x104)]=_0x4a5c21;}),_0x3767ee[_0x24f567(0xec)]((_0x4a95a3,_0x5490b5)=>{const _0x4416bc=_0x24f567;_0x125e9c[_0x5490b5][_0x4416bc(0xe0)]=_0x4a95a3;}),_0x17879['forEach']((_0x4d8694,_0x404ff9)=>{const _0x119604=_0x24f567;_0x125e9c[_0x404ff9][_0x119604(0x124)]=_0x4d8694;}),_0x56a776[_0x24f567(0xec)]((_0x36977d,_0x100521)=>{_0x125e9c[_0x100521]['real_qty_unit_val']=_0x36977d;}),_0x9051b8[_0x24f567(0xec)]((_0x40d551,_0x367898)=>{_0x125e9c[_0x367898]['prod_cat']=_0x40d551;}),_0x438281['forEach']((_0x5ecac0,_0x2221bd)=>{_0x125e9c[_0x2221bd]['conversion_data']=_0x5ecac0;});const _0x349752=new invoice_sa();await _0x349752['save']();const _0x3853e0=_0x4e0125[_0x24f567(0x103)],_0x290efa=await staff[_0x24f567(0xe7)]({'email':_0x3853e0['email']}),_0x35e1eb=new sales_sa({'invoice':_0x349752[_0x24f567(0xed)]['toString']()[_0x24f567(0x126)](0x8,'0'),'customer':_0x253998,'file':_0x5d47d8,'date':_0xf1a1b4,'sale_product':_0x125e9c,'note':_0x419c99,'sales_staff_id':_0x290efa[_0x24f567(0xf4)][_0x24f567(0xf1)](),'paid':_0x44243f,'dsi':_0x222f35,'cash':_0x26b0d9,'amount':_0x3088bb,'bank':_0x1771f8,'check_no':_0x256404,'due_date':_0x3cb358}),_0x6fc8f7=await _0x35e1eb[_0x24f567(0x119)]();console[_0x24f567(0xf8)]('Invoice\x20created\x20with\x20incremented\x20start\x20value:',_0x349752[_0x24f567(0xed)][_0x24f567(0xdb)]()[_0x24f567(0x126)](0x8,'0'));const _0x5eca5d=mongoose[_0x24f567(0x10d)]['ObjectId'];_0x4e0125['flash'](_0x24f567(0x12d),_0x24f567(0xff)),_0x20ea97[_0x24f567(0x102)](_0x24f567(0xf9)+_0x6fc8f7[_0x24f567(0xf4)]);}catch(_0x56ee4b){console[_0x24f567(0xf8)](_0x56ee4b);}}),router['post']('/add_sales_notes',auth,async(_0x17098b,_0x51b789)=>{const _0x16f086=a0_0x34f7d5;try{const {date_data:_0x1c479c,note_data:_0x5e46e7,status_data:_0x4d872b}=_0x17098b[_0x16f086(0x105)],_0x3f35b8=new invoice_sa();await _0x3f35b8[_0x16f086(0x119)]();const _0x11f60a=_0x17098b[_0x16f086(0x103)],_0x348f9f=await staff['findOne']({'email':_0x11f60a['email']}),_0x4bbf0e=new sales_sa({'invoice':_0x3f35b8[_0x16f086(0xed)]['toString']()[_0x16f086(0x126)](0x8,'0'),'status_data':_0x4d872b,'date':_0x1c479c,'note':_0x5e46e7,'sales_staff_id':_0x348f9f[_0x16f086(0xf4)][_0x16f086(0xf1)]()}),_0x17a669=await _0x4bbf0e['save']();console[_0x16f086(0xf8)]('Invoice\x20created\x20with\x20incremented\x20start\x20value:',_0x3f35b8[_0x16f086(0xed)][_0x16f086(0xdb)]()[_0x16f086(0x126)](0x8,'0'));const _0x4f614b=mongoose['Types']['ObjectId'];_0x17098b[_0x16f086(0xd9)](_0x16f086(0x12d),_0x16f086(0xff)),_0x51b789[_0x16f086(0x102)]('/sales_sa/view_sales/'+_0x17a669[_0x16f086(0xf4)]);}catch(_0x12e6d4){console[_0x16f086(0xf8)](_0x12e6d4);}}),router[a0_0x34f7d5(0xe4)](a0_0x34f7d5(0xf0),auth,async(_0x226046,_0xb66de3)=>{const _0x2d1bcc=a0_0x34f7d5;try{const _0x4ee655=_0x226046[_0x2d1bcc(0x103)],_0x570b40=await profile[_0x2d1bcc(0xe7)]({'email':_0x4ee655['email']}),_0xce5086=await staff[_0x2d1bcc(0x129)]([{'$match':{'email':_0x4ee655[_0x2d1bcc(0xef)]}},{'$unwind':'$product_list'},{'$match':{'product_list.isConfirm':'true'}}]);_0xb66de3[_0x2d1bcc(0xfa)](_0xce5086);}catch(_0x39030f){}}),router[a0_0x34f7d5(0xe4)]('/customer_data',auth,async(_0x502cd2,_0x5b961c)=>{const _0x10c6c3=a0_0x34f7d5;try{const {customer_name:_0x38c3cf}=_0x502cd2['body'],_0x33c014=await customer[_0x10c6c3(0xe7)]({'name':_0x38c3cf});_0x5b961c['json'](_0x33c014);}catch(_0x179a71){}}),router[a0_0x34f7d5(0xe4)](a0_0x34f7d5(0xda),auth,async(_0x3a3551,_0x26e75c)=>{const _0x1d3ffc=a0_0x34f7d5;try{const _0x1bbbc5=_0x3a3551[_0x1d3ffc(0x103)],{id_data:_0x10299d}=_0x3a3551[_0x1d3ffc(0x105)],_0x56c2d=await profile['findOne']({'email':_0x1bbbc5[_0x1d3ffc(0xef)]}),_0x17db17=mongoose[_0x1d3ffc(0x10d)]['ObjectId'];console[_0x1d3ffc(0xf8)](_0x17db17(_0x10299d));var _0x12d45e=_0x17db17(_0x10299d);const _0x2f7044=await staff[_0x1d3ffc(0x129)]([{'$match':{'email':_0x1bbbc5['email']}},{'$unwind':_0x1d3ffc(0x125)},{'$match':{'product_list.isConfirm':_0x1d3ffc(0xd8),'product_list._id':_0x12d45e}}]);_0x26e75c[_0x1d3ffc(0xfa)](_0x2f7044);}catch(_0x103f75){}}),router[a0_0x34f7d5(0xe4)](a0_0x34f7d5(0xf5),auth,async(_0x3e7c28,_0x94df3c)=>{const _0x4cdc45=a0_0x34f7d5;try{const _0xc028e0=await discount_volume_db[_0x4cdc45(0xe7)]();_0x94df3c['json'](_0xc028e0);}catch(_0x1a52a0){}}),router['post'](a0_0x34f7d5(0x122),auth,async(_0x583cb1,_0x2e47c2)=>{const _0x30b4b9=a0_0x34f7d5;try{const _0x4f863a=await product[_0x30b4b9(0xe1)]();_0x2e47c2['json'](_0x4f863a);}catch(_0x29559d){}}),router[a0_0x34f7d5(0xe4)](a0_0x34f7d5(0x112),auth,async(_0x30c67c,_0xcd2cc7)=>{const _0x3d6506=a0_0x34f7d5;try{const {id_data:_0x56a2dd}=_0x30c67c[_0x3d6506(0x105)],_0x2600ce=await product[_0x3d6506(0xf2)](_0x56a2dd);_0xcd2cc7[_0x3d6506(0xfa)](_0x2600ce);}catch(_0xc775fc){}}),module[a0_0x34f7d5(0x12f)]=router;