const a0_0x1b8d20=a0_0x169a;function a0_0x169a(_0x88b7e9,_0x41f30d){const _0x32ba90=a0_0x32ba();return a0_0x169a=function(_0x169a32,_0x5cc198){_0x169a32=_0x169a32-0x15b;let _0x34004d=_0x32ba90[_0x169a32];return _0x34004d;},a0_0x169a(_0x88b7e9,_0x41f30d);}(function(_0x46c816,_0xe283e6){const _0x5e6c97=a0_0x169a,_0x1ea058=_0x46c816();while(!![]){try{const _0x59fbec=parseInt(_0x5e6c97(0x1a7))/0x1+-parseInt(_0x5e6c97(0x1ab))/0x2+parseInt(_0x5e6c97(0x1a5))/0x3+-parseInt(_0x5e6c97(0x197))/0x4+parseInt(_0x5e6c97(0x15c))/0x5+-parseInt(_0x5e6c97(0x15d))/0x6*(parseInt(_0x5e6c97(0x160))/0x7)+parseInt(_0x5e6c97(0x1a3))/0x8;if(_0x59fbec===_0xe283e6)break;else _0x1ea058['push'](_0x1ea058['shift']());}catch(_0x5c34d3){_0x1ea058['push'](_0x1ea058['shift']());}}}(a0_0x32ba,0xd0b2e));const express=require(a0_0x1b8d20(0x193)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up,invoice_sa,sales_sa,discount_volume_db}=require(a0_0x1b8d20(0x19c)),auth=require(a0_0x1b8d20(0x1a4)),users=require(a0_0x1b8d20(0x178)),excelJS=require('exceljs'),xlsx=require('xlsx'),mongoose=require(a0_0x1b8d20(0x17b)),multer=require(a0_0x1b8d20(0x173)),storage=multer[a0_0x1b8d20(0x186)]({'destination':(_0x408909,_0x2fee45,_0x4a66d4)=>{const _0x5bce7c=a0_0x1b8d20;_0x4a66d4(null,_0x5bce7c(0x166));},'filename':(_0x52b2e8,_0x6fc5d0,_0x4bba28)=>{const _0x1d369e=a0_0x1b8d20;_0x4bba28(null,Date[_0x1d369e(0x18b)]()+'~'+_0x6fc5d0[_0x1d369e(0x16d)]);}}),upload=multer({'storage':storage});function a0_0x32ba(){const _0x3e6a01=['/product_data_id','body','multer','padStart','redirect','/view_sales/:id','/add_sales','../public/language/languages.json','findById','id_transaction','mongoose','product_list','save','Portuguese\x20(BR)','params','secondary_unit','/sales_sa/view_sales/','/product_list','isFG','getPrimUnitNo','price','diskStorage','valueOf','/product_data','no_per_unit','render','now','$product_list','add_sales_sa','German','Invoice\x20created\x20with\x20incremented\x20start\x20value:','success','quantity','French','express','errors','totalPrice','Types','6791548vSodpC','/volume_setup','forEach','find','prod_name','../models/all_models','tmpisFG','ObjectId','/getProductData','_id','primary_code','real_qty_unit_val','12801280ObDKgk','../middleware/auth','2100975FlWQsV','aggregate','376185YlxmWO','filename','findOne','json','3041724CvrKEG','single','email','Arabic\x20(ae)','invoice_starts','flash','user','Portuguese','id_transaction_from','language','true','Spanish','English','prod_cat','/add_sales_notes','English\x20(US)','7605085rGAJTN','852YKgnCM','log','adj_dicount_price','6118dRuFoa','conversion_data','Hindi','unit','exports','product_name','./public/sales_invoice','Chinese','conversion_unit','view_sales_sa','get','prod_code','post','originalname','Arabic','/customer_data','toString'];a0_0x32ba=function(){return _0x3e6a01;};return a0_0x32ba();}router['get']('/',auth,async(_0x4b738d,_0x30faf7)=>{const _0x185fdb=a0_0x1b8d20;try{const _0x4c4c18=await master_shop[_0x185fdb(0x19a)](),_0x850997=_0x4b738d[_0x185fdb(0x1b1)],_0xbdcd49=await profile[_0x185fdb(0x1a9)]({'email':_0x850997[_0x185fdb(0x1ad)]}),_0x4289f2=await staff['findOne']({'email':_0x850997['email']}),_0x502085=await sales_sa[_0x185fdb(0x19a)]({'sales_staff_id':_0x4289f2[_0x185fdb(0x1a0)]});if(_0x4c4c18[0x0]['language']==_0x185fdb(0x15b))var _0x5e90f6=users[_0x185fdb(0x1b7)];else{if(_0x4c4c18[0x0][_0x185fdb(0x1b4)]==_0x185fdb(0x162))var _0x5e90f6=users[_0x185fdb(0x162)];else{if(_0x4c4c18[0x0]['language']=='German')var _0x5e90f6=users[_0x185fdb(0x18e)];else{if(_0x4c4c18[0x0][_0x185fdb(0x1b4)]=='Spanish')var _0x5e90f6=users[_0x185fdb(0x1b6)];else{if(_0x4c4c18[0x0][_0x185fdb(0x1b4)]=='French')var _0x5e90f6=users['French'];else{if(_0x4c4c18[0x0][_0x185fdb(0x1b4)]==_0x185fdb(0x17e))var _0x5e90f6=users['Portuguese'];else{if(_0x4c4c18[0x0][_0x185fdb(0x1b4)]=='Chinese')var _0x5e90f6=users['Chinese'];else{if(_0x4c4c18[0x0]['language']=='Arabic\x20(ae)')var _0x5e90f6=users[_0x185fdb(0x16e)];}}}}}}}_0x30faf7['render']('all_sales_sa',{'success':_0x4b738d[_0x185fdb(0x1b0)]('success'),'errors':_0x4b738d[_0x185fdb(0x1b0)]('errors'),'master_shop':_0x4c4c18,'profile':_0xbdcd49,'role':_0x850997,'language':_0x5e90f6,'product_list':_0x4289f2[_0x185fdb(0x17c)],'sales_mine':_0x502085,'staff_arr':_0x4289f2});}catch(_0x3d2442){console[_0x185fdb(0x15e)](_0x3d2442);}}),router['get'](a0_0x1b8d20(0x177),auth,async(_0x5dadd6,_0x2be198)=>{const _0x5dd457=a0_0x1b8d20;try{const _0x17435c=await master_shop[_0x5dd457(0x19a)](),_0x55145a=_0x5dadd6['user'],_0x3bb8b9=await profile[_0x5dd457(0x1a9)]({'email':_0x55145a['email']}),_0x1ace53=await staff[_0x5dd457(0x1a9)]({'email':_0x55145a[_0x5dd457(0x1ad)]}),_0x5ba86a=await customer[_0x5dd457(0x19a)]({'agent_id':_0x1ace53[_0x5dd457(0x1a0)]});if(_0x17435c[0x0]['language']==_0x5dd457(0x15b))var _0x465054=users[_0x5dd457(0x1b7)];else{if(_0x17435c[0x0][_0x5dd457(0x1b4)]=='Hindi')var _0x465054=users[_0x5dd457(0x162)];else{if(_0x17435c[0x0][_0x5dd457(0x1b4)]=='German')var _0x465054=users[_0x5dd457(0x18e)];else{if(_0x17435c[0x0][_0x5dd457(0x1b4)]==_0x5dd457(0x1b6))var _0x465054=users['Spanish'];else{if(_0x17435c[0x0]['language']==_0x5dd457(0x192))var _0x465054=users['French'];else{if(_0x17435c[0x0][_0x5dd457(0x1b4)]==_0x5dd457(0x17e))var _0x465054=users[_0x5dd457(0x1b2)];else{if(_0x17435c[0x0][_0x5dd457(0x1b4)]==_0x5dd457(0x167))var _0x465054=users[_0x5dd457(0x167)];else{if(_0x17435c[0x0][_0x5dd457(0x1b4)]==_0x5dd457(0x1ae))var _0x465054=users[_0x5dd457(0x16e)];}}}}}}}_0x2be198[_0x5dd457(0x18a)](_0x5dd457(0x18d),{'success':_0x5dadd6['flash'](_0x5dd457(0x190)),'errors':_0x5dadd6['flash'](_0x5dd457(0x194)),'master_shop':_0x17435c,'profile':_0x3bb8b9,'role':_0x55145a,'language':_0x465054,'customer':_0x5ba86a,'staff_arr':_0x1ace53});}catch(_0x2f1863){console['log'](_0x2f1863);}}),router[a0_0x1b8d20(0x16a)](a0_0x1b8d20(0x176),auth,async(_0x35c272,_0x5ecea4)=>{const _0x3a0a2e=a0_0x1b8d20;try{const _0x9d2999=await master_shop[_0x3a0a2e(0x19a)](),_0x1c17c3=_0x35c272[_0x3a0a2e(0x1b1)],_0x4960f4=await profile[_0x3a0a2e(0x1a9)]({'email':_0x1c17c3[_0x3a0a2e(0x1ad)]}),_0x2fa204=await staff['findOne']({'email':_0x1c17c3[_0x3a0a2e(0x1ad)]}),_0x1fd2b9=await customer[_0x3a0a2e(0x19a)]({'agent_id':_0x2fa204['_id']}),_0x57ea46=_0x35c272[_0x3a0a2e(0x17f)]['id'],_0x5c7bf8=await sales_sa[_0x3a0a2e(0x179)](_0x57ea46);if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]==_0x3a0a2e(0x15b))var _0x201069=users[_0x3a0a2e(0x1b7)];else{if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]==_0x3a0a2e(0x162))var _0x201069=users[_0x3a0a2e(0x162)];else{if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]=='German')var _0x201069=users['German'];else{if(_0x9d2999[0x0]['language']=='Spanish')var _0x201069=users[_0x3a0a2e(0x1b6)];else{if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]==_0x3a0a2e(0x192))var _0x201069=users[_0x3a0a2e(0x192)];else{if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]==_0x3a0a2e(0x17e))var _0x201069=users['Portuguese'];else{if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]=='Chinese')var _0x201069=users['Chinese'];else{if(_0x9d2999[0x0][_0x3a0a2e(0x1b4)]==_0x3a0a2e(0x1ae))var _0x201069=users[_0x3a0a2e(0x16e)];}}}}}}}_0x5ecea4['render'](_0x3a0a2e(0x169),{'success':_0x35c272[_0x3a0a2e(0x1b0)](_0x3a0a2e(0x190)),'errors':_0x35c272[_0x3a0a2e(0x1b0)](_0x3a0a2e(0x194)),'master_shop':_0x9d2999,'profile':_0x4960f4,'role':_0x1c17c3,'language':_0x201069,'customer':_0x1fd2b9,'sales_sa':_0x5c7bf8,'staff_arr':_0x2fa204});}catch(_0x470636){console[_0x3a0a2e(0x15e)](_0x470636);}}),router[a0_0x1b8d20(0x16c)](a0_0x1b8d20(0x177),auth,upload[a0_0x1b8d20(0x1ac)]('image'),async(_0x517a40,_0x5eb4b9)=>{const _0x49895e=a0_0x1b8d20;try{const {customer:_0x434a13,date:_0x2baab0,prod_code:_0x6ef9da,note:_0x453857,paid_status:_0x278570,DSI:_0x1d2904,cash_amount:_0x4ebb8d,amount_data:_0x3867cc,bank_data:_0x14c87a,check_no:_0x240ff7,due_date:_0x2bd7ff}=_0x517a40[_0x49895e(0x172)],_0x548b45=_0x517a40['file'][_0x49895e(0x1a8)];if(typeof _0x6ef9da=='string')var _0x55984d=[_0x517a40['body'][_0x49895e(0x16b)]],_0x1df207=[_0x517a40[_0x49895e(0x172)]['prod_name']],_0x3f8eab=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x1a1)]],_0x135a31=[_0x517a40['body'][_0x49895e(0x191)]],_0x4b7f44=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x163)]],_0x57b625=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x185)]],_0x399bb8=[_0x517a40[_0x49895e(0x172)]['totalPrice']],_0x220964=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x17a)]],_0x483234=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x15f)]],_0x278dc3=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x19d)]],_0x3dc766=[_0x517a40[_0x49895e(0x172)][_0x49895e(0x189)]],_0x447239=[_0x517a40[_0x49895e(0x172)]['getPrimUnitNo']],_0x25f0b4=[_0x517a40['body']['prod_cat']],_0x524c83=[_0x517a40[_0x49895e(0x172)]['secondary_unit']],_0x6ebed0=[_0x517a40['body'][_0x49895e(0x168)]];else var _0x55984d=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x16b)]],_0x1df207=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x19b)]],_0x3f8eab=[..._0x517a40['body'][_0x49895e(0x1a1)]],_0x135a31=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x191)]],_0x4b7f44=[..._0x517a40['body'][_0x49895e(0x163)]],_0x57b625=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x185)]],_0x399bb8=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x195)]],_0x220964=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x17a)]],_0x483234=[..._0x517a40[_0x49895e(0x172)]['adj_dicount_price']],_0x278dc3=[..._0x517a40[_0x49895e(0x172)]['tmpisFG']],_0x3dc766=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x189)]],_0x447239=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x184)]],_0x25f0b4=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x1b8)]],_0x524c83=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x180)]],_0x6ebed0=[..._0x517a40[_0x49895e(0x172)][_0x49895e(0x168)]];const _0x6b1522=_0x55984d['map'](_0x260198=>{return _0x260198={'product_code':_0x260198};});_0x1df207[_0x49895e(0x199)]((_0x14c15c,_0x5633a7)=>{const _0x2798e6=_0x49895e;_0x6b1522[_0x5633a7][_0x2798e6(0x165)]=_0x14c15c;}),_0x3f8eab[_0x49895e(0x199)]((_0x5944a5,_0x4bf44e)=>{const _0x22ac97=_0x49895e;_0x6b1522[_0x4bf44e][_0x22ac97(0x1a1)]=_0x5944a5;}),_0x3dc766[_0x49895e(0x199)]((_0x18a7e9,_0x57b74b)=>{_0x6b1522[_0x57b74b]['no_per_unit']=_0x18a7e9;}),_0x135a31[_0x49895e(0x199)]((_0x3a05ff,_0xbc0886)=>{const _0x49aa61=_0x49895e;_0x6b1522[_0xbc0886][_0x49aa61(0x191)]=_0x3a05ff;}),_0x4b7f44[_0x49895e(0x199)]((_0x329abf,_0x4462da)=>{_0x6b1522[_0x4462da]['unit']=_0x329abf;}),_0x57b625['forEach']((_0x31aa16,_0x5ba533)=>{const _0x6722de=_0x49895e;_0x6b1522[_0x5ba533][_0x6722de(0x185)]=_0x31aa16;}),_0x399bb8['forEach']((_0x303340,_0x4645e8)=>{_0x6b1522[_0x4645e8]['totalprice']=_0x303340;}),_0x220964[_0x49895e(0x199)]((_0x23dd71,_0x531e94)=>{const _0x5e9932=_0x49895e;_0x6b1522[_0x531e94][_0x5e9932(0x1b3)]=_0x23dd71;}),_0x483234[_0x49895e(0x199)]((_0x2e0beb,_0x5a75de)=>{_0x6b1522[_0x5a75de]['adj_discount']=_0x2e0beb;}),_0x278dc3['forEach']((_0x56a281,_0x2abd94)=>{const _0x5726a0=_0x49895e;_0x6b1522[_0x2abd94][_0x5726a0(0x183)]=_0x56a281;}),_0x524c83[_0x49895e(0x199)]((_0x18cbc8,_0x42bfb7)=>{_0x6b1522[_0x42bfb7]['secondary_unit']=_0x18cbc8;}),_0x447239[_0x49895e(0x199)]((_0x155d8c,_0x3e2f22)=>{const _0x12695e=_0x49895e;_0x6b1522[_0x3e2f22][_0x12695e(0x1a2)]=_0x155d8c;}),_0x25f0b4[_0x49895e(0x199)]((_0xe40b42,_0x6974d7)=>{_0x6b1522[_0x6974d7]['prod_cat']=_0xe40b42;}),_0x6ebed0[_0x49895e(0x199)]((_0xec1c49,_0x319d1f)=>{const _0x4df304=_0x49895e;_0x6b1522[_0x319d1f][_0x4df304(0x161)]=_0xec1c49;});const _0x1ef642=new invoice_sa();await _0x1ef642[_0x49895e(0x17d)]();const _0x301cb5=_0x517a40[_0x49895e(0x1b1)],_0x3403b0=await staff['findOne']({'email':_0x301cb5[_0x49895e(0x1ad)]}),_0x3bdc4f=new sales_sa({'invoice':_0x1ef642[_0x49895e(0x1af)][_0x49895e(0x170)]()[_0x49895e(0x174)](0x8,'0'),'customer':_0x434a13,'file':_0x548b45,'date':_0x2baab0,'sale_product':_0x6b1522,'note':_0x453857,'sales_staff_id':_0x3403b0[_0x49895e(0x1a0)]['valueOf'](),'paid':_0x278570,'dsi':_0x1d2904,'cash':_0x4ebb8d,'amount':_0x3867cc,'bank':_0x14c87a,'check_no':_0x240ff7,'due_date':_0x2bd7ff}),_0x56d11d=await _0x3bdc4f[_0x49895e(0x17d)]();console['log']('Invoice\x20created\x20with\x20incremented\x20start\x20value:',_0x1ef642[_0x49895e(0x1af)][_0x49895e(0x170)]()[_0x49895e(0x174)](0x8,'0'));const _0x2596b0=mongoose[_0x49895e(0x196)]['ObjectId'];_0x517a40[_0x49895e(0x1b0)](_0x49895e(0x190),'Sales\x20add\x20successfully'),_0x5eb4b9[_0x49895e(0x175)](_0x49895e(0x181)+_0x56d11d[_0x49895e(0x1a0)]);}catch(_0x1b1f6b){console[_0x49895e(0x15e)](_0x1b1f6b);}}),router[a0_0x1b8d20(0x16c)](a0_0x1b8d20(0x1b9),auth,async(_0x40219c,_0x2be195)=>{const _0x1ca679=a0_0x1b8d20;try{const {date_data:_0x1a8d37,note_data:_0x1c40f2,status_data:_0x430f6a}=_0x40219c[_0x1ca679(0x172)],_0x3e3103=new invoice_sa();await _0x3e3103['save']();const _0x2eca5e=_0x40219c[_0x1ca679(0x1b1)],_0x5de58f=await staff['findOne']({'email':_0x2eca5e[_0x1ca679(0x1ad)]}),_0x5d2332=new sales_sa({'invoice':_0x3e3103[_0x1ca679(0x1af)]['toString']()[_0x1ca679(0x174)](0x8,'0'),'status_data':_0x430f6a,'date':_0x1a8d37,'note':_0x1c40f2,'sales_staff_id':_0x5de58f['_id'][_0x1ca679(0x187)]()}),_0x64a4a0=await _0x5d2332[_0x1ca679(0x17d)]();console[_0x1ca679(0x15e)](_0x1ca679(0x18f),_0x3e3103[_0x1ca679(0x1af)][_0x1ca679(0x170)]()[_0x1ca679(0x174)](0x8,'0'));const _0x51e6a2=mongoose['Types'][_0x1ca679(0x19e)];_0x40219c['flash'](_0x1ca679(0x190),'Sales\x20add\x20successfully'),_0x2be195[_0x1ca679(0x175)](_0x1ca679(0x181)+_0x64a4a0['_id']);}catch(_0x11f606){console[_0x1ca679(0x15e)](_0x11f606);}}),router['post'](a0_0x1b8d20(0x182),auth,async(_0x19006a,_0x5efd65)=>{const _0x151233=a0_0x1b8d20;try{const _0x2d3114=_0x19006a['user'],_0x42bc41=await profile[_0x151233(0x1a9)]({'email':_0x2d3114[_0x151233(0x1ad)]}),_0x2b8852=await staff[_0x151233(0x1a6)]([{'$match':{'email':_0x2d3114[_0x151233(0x1ad)]}},{'$unwind':_0x151233(0x18c)},{'$match':{'product_list.isConfirm':'true'}}]);_0x5efd65[_0x151233(0x1aa)](_0x2b8852);}catch(_0xde727d){}}),router[a0_0x1b8d20(0x16c)](a0_0x1b8d20(0x16f),auth,async(_0x469ff9,_0x2b1c41)=>{const _0x32ff6d=a0_0x1b8d20;try{const {customer_name:_0xb54d64}=_0x469ff9[_0x32ff6d(0x172)],_0x18fb49=await customer['findOne']({'name':_0xb54d64});_0x2b1c41['json'](_0x18fb49);}catch(_0x404909){}}),router['post'](a0_0x1b8d20(0x188),auth,async(_0x13ff1e,_0x31b419)=>{const _0x56fdfc=a0_0x1b8d20;try{const _0x21aea5=_0x13ff1e['user'],{id_data:_0x3e1ea2}=_0x13ff1e[_0x56fdfc(0x172)],_0x18e596=await profile[_0x56fdfc(0x1a9)]({'email':_0x21aea5[_0x56fdfc(0x1ad)]}),_0x347e3e=mongoose[_0x56fdfc(0x196)][_0x56fdfc(0x19e)];console[_0x56fdfc(0x15e)](_0x347e3e(_0x3e1ea2));var _0x96b19=_0x347e3e(_0x3e1ea2);const _0x281a68=await staff[_0x56fdfc(0x1a6)]([{'$match':{'email':_0x21aea5[_0x56fdfc(0x1ad)]}},{'$unwind':_0x56fdfc(0x18c)},{'$match':{'product_list.isConfirm':_0x56fdfc(0x1b5),'product_list._id':_0x96b19}}]);_0x31b419[_0x56fdfc(0x1aa)](_0x281a68);}catch(_0x7239b4){}}),router[a0_0x1b8d20(0x16c)](a0_0x1b8d20(0x198),auth,async(_0xee5fee,_0x455dfc)=>{const _0x476426=a0_0x1b8d20;try{const _0x15fc8d=await discount_volume_db[_0x476426(0x1a9)]();_0x455dfc['json'](_0x15fc8d);}catch(_0x575efc){}}),router[a0_0x1b8d20(0x16c)](a0_0x1b8d20(0x19f),auth,async(_0x44dedf,_0x55b6c7)=>{const _0x30810a=a0_0x1b8d20;try{const _0x43faa2=await product[_0x30810a(0x19a)]();_0x55b6c7['json'](_0x43faa2);}catch(_0x319560){}}),router[a0_0x1b8d20(0x16c)](a0_0x1b8d20(0x171),auth,async(_0x4ffaa6,_0x9a1b10)=>{const _0x364f8c=a0_0x1b8d20;try{const {id_data:_0x3c8d97}=_0x4ffaa6[_0x364f8c(0x172)],_0x19ec96=await product[_0x364f8c(0x179)](_0x3c8d97);_0x9a1b10[_0x364f8c(0x1aa)](_0x19ec96);}catch(_0x29c90f){}}),module[a0_0x1b8d20(0x164)]=router;