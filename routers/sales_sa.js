const a0_0x465282=a0_0x1323;(function(_0x33bbbf,_0x4e50eb){const _0x2ab6d8=a0_0x1323,_0x172e5e=_0x33bbbf();while(!![]){try{const _0x537754=parseInt(_0x2ab6d8(0x14e))/0x1+-parseInt(_0x2ab6d8(0x161))/0x2*(parseInt(_0x2ab6d8(0x12c))/0x3)+-parseInt(_0x2ab6d8(0x146))/0x4*(parseInt(_0x2ab6d8(0x129))/0x5)+parseInt(_0x2ab6d8(0x12f))/0x6+parseInt(_0x2ab6d8(0x180))/0x7+-parseInt(_0x2ab6d8(0x127))/0x8+parseInt(_0x2ab6d8(0x13e))/0x9;if(_0x537754===_0x4e50eb)break;else _0x172e5e['push'](_0x172e5e['shift']());}catch(_0x48b13d){_0x172e5e['push'](_0x172e5e['shift']());}}}(a0_0x3fb5,0xa9afd));function a0_0x3fb5(){const _0x28c50b=['Sales\x20add\x20successfully','39908hXZIwC','$product_list','view_sales_sa','valueOf','quantity','diskStorage','Spanish','/product_data','189367kTjHiL','adj_dicount_price','toString','all_sales_sa','flash','/customer_data','findOne','Portuguese\x20(BR)','string','no_per_unit','real_qty_unit_val','primary_code','user','prod_code','../middleware/auth','success','forEach','../models/all_models','exports','54HLjUkK','/product_list','ObjectId','totalPrice','prod_name','Portuguese','body','Invoice\x20created\x20with\x20incremented\x20start\x20value:','French','Router','filename','aggregate','add_sales_sa','English\x20(US)','id_transaction','Hindi','/sales_sa/view_sales/','conversion_data','post','unit','Arabic','log','./public/sales_invoice','find','true','adj_discount','/product_data_id','errors','price','render','redirect','136948PFrspR','file','padStart','Chinese','Arabic\x20(ae)','259088yxLPml','German','375OAljZe','get','invoice_starts','75279qcrdgE','/getProductData','map','1815390oVoDZL','secondary_unit','json','_id','email','Types','findById','isFG','getPrimUnitNo','product_list','conversion_unit','totalprice','../public/language/languages.json','save','now','14775417aDqwGP','English','prod_cat','id_transaction_from','tmpisFG','language','product_name'];a0_0x3fb5=function(){return _0x28c50b;};return a0_0x3fb5();}function a0_0x1323(_0x5c9fa4,_0x440a83){const _0x3fb5e4=a0_0x3fb5();return a0_0x1323=function(_0x13235d,_0x45267f){_0x13235d=_0x13235d-0x127;let _0x4a4c15=_0x3fb5e4[_0x13235d];return _0x4a4c15;},a0_0x1323(_0x5c9fa4,_0x440a83);}const express=require('express'),app=express(),router=express[a0_0x465282(0x16a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up,invoice_sa,sales_sa,discount_volume_db}=require(a0_0x465282(0x15f)),auth=require(a0_0x465282(0x15c)),users=require(a0_0x465282(0x13b)),excelJS=require('exceljs'),xlsx=require('xlsx'),mongoose=require('mongoose'),multer=require('multer'),storage=multer[a0_0x465282(0x14b)]({'destination':(_0x45a023,_0x3261f3,_0x16fb19)=>{const _0x192b7a=a0_0x465282;_0x16fb19(null,_0x192b7a(0x177));},'filename':(_0x3cdef0,_0x346198,_0x2f66d8)=>{const _0x37b6bf=a0_0x465282;_0x2f66d8(null,Date[_0x37b6bf(0x13d)]()+'~'+_0x346198['originalname']);}}),upload=multer({'storage':storage});router[a0_0x465282(0x12a)]('/',auth,async(_0x4a7c2b,_0x4ed482)=>{const _0x43799b=a0_0x465282;try{const _0xcd27f8=await master_shop[_0x43799b(0x178)](),_0x169351=_0x4a7c2b['user'],_0x483d75=await profile['findOne']({'email':_0x169351[_0x43799b(0x133)]}),_0x12c0af=await staff[_0x43799b(0x154)]({'email':_0x169351['email']}),_0x10ad56=await sales_sa['find']({'sales_staff_id':_0x12c0af[_0x43799b(0x132)]});if(_0xcd27f8[0x0][_0x43799b(0x143)]==_0x43799b(0x16e))var _0x1155ea=users[_0x43799b(0x13f)];else{if(_0xcd27f8[0x0]['language']==_0x43799b(0x170))var _0x1155ea=users['Hindi'];else{if(_0xcd27f8[0x0]['language']==_0x43799b(0x128))var _0x1155ea=users['German'];else{if(_0xcd27f8[0x0][_0x43799b(0x143)]==_0x43799b(0x14c))var _0x1155ea=users['Spanish'];else{if(_0xcd27f8[0x0][_0x43799b(0x143)]==_0x43799b(0x169))var _0x1155ea=users['French'];else{if(_0xcd27f8[0x0][_0x43799b(0x143)]==_0x43799b(0x155))var _0x1155ea=users[_0x43799b(0x166)];else{if(_0xcd27f8[0x0][_0x43799b(0x143)]=='Chinese')var _0x1155ea=users['Chinese'];else{if(_0xcd27f8[0x0][_0x43799b(0x143)]=='Arabic\x20(ae)')var _0x1155ea=users[_0x43799b(0x175)];}}}}}}}_0x4ed482['render'](_0x43799b(0x151),{'success':_0x4a7c2b['flash']('success'),'errors':_0x4a7c2b[_0x43799b(0x152)](_0x43799b(0x17c)),'master_shop':_0xcd27f8,'profile':_0x483d75,'role':_0x169351,'language':_0x1155ea,'product_list':_0x12c0af[_0x43799b(0x138)],'sales_mine':_0x10ad56,'staff_arr':_0x12c0af});}catch(_0x27d6c7){console[_0x43799b(0x176)](_0x27d6c7);}}),router[a0_0x465282(0x12a)]('/add_sales',auth,async(_0x4bc9aa,_0x4f89f0)=>{const _0x133107=a0_0x465282;try{const _0x7b1100=await master_shop['find'](),_0x1073e8=_0x4bc9aa[_0x133107(0x15a)],_0x2c414f=await profile[_0x133107(0x154)]({'email':_0x1073e8[_0x133107(0x133)]}),_0x5bcb72=await staff['findOne']({'email':_0x1073e8[_0x133107(0x133)]}),_0x25d0d5=await customer['find']({'agent_id':_0x5bcb72[_0x133107(0x132)]});if(_0x7b1100[0x0][_0x133107(0x143)]==_0x133107(0x16e))var _0x42b2c9=users[_0x133107(0x13f)];else{if(_0x7b1100[0x0][_0x133107(0x143)]==_0x133107(0x170))var _0x42b2c9=users[_0x133107(0x170)];else{if(_0x7b1100[0x0]['language']==_0x133107(0x128))var _0x42b2c9=users['German'];else{if(_0x7b1100[0x0][_0x133107(0x143)]==_0x133107(0x14c))var _0x42b2c9=users['Spanish'];else{if(_0x7b1100[0x0][_0x133107(0x143)]==_0x133107(0x169))var _0x42b2c9=users['French'];else{if(_0x7b1100[0x0]['language']==_0x133107(0x155))var _0x42b2c9=users[_0x133107(0x166)];else{if(_0x7b1100[0x0][_0x133107(0x143)]==_0x133107(0x183))var _0x42b2c9=users['Chinese'];else{if(_0x7b1100[0x0]['language']==_0x133107(0x184))var _0x42b2c9=users[_0x133107(0x175)];}}}}}}}_0x4f89f0['render'](_0x133107(0x16d),{'success':_0x4bc9aa['flash'](_0x133107(0x15d)),'errors':_0x4bc9aa[_0x133107(0x152)](_0x133107(0x17c)),'master_shop':_0x7b1100,'profile':_0x2c414f,'role':_0x1073e8,'language':_0x42b2c9,'customer':_0x25d0d5,'staff_arr':_0x5bcb72});}catch(_0x187210){console['log'](_0x187210);}}),router[a0_0x465282(0x12a)]('/view_sales/:id',auth,async(_0x351770,_0x17857d)=>{const _0x35209a=a0_0x465282;try{const _0x4adff8=await master_shop[_0x35209a(0x178)](),_0x1428d9=_0x351770[_0x35209a(0x15a)],_0x5d4110=await profile[_0x35209a(0x154)]({'email':_0x1428d9[_0x35209a(0x133)]}),_0x587e74=await staff['findOne']({'email':_0x1428d9[_0x35209a(0x133)]}),_0x201a45=await customer['find']({'agent_id':_0x587e74['_id']}),_0x1e1f51=_0x351770['params']['id'],_0x1173ab=await sales_sa[_0x35209a(0x135)](_0x1e1f51);if(_0x4adff8[0x0]['language']==_0x35209a(0x16e))var _0x6840a9=users[_0x35209a(0x13f)];else{if(_0x4adff8[0x0]['language']==_0x35209a(0x170))var _0x6840a9=users[_0x35209a(0x170)];else{if(_0x4adff8[0x0][_0x35209a(0x143)]=='German')var _0x6840a9=users['German'];else{if(_0x4adff8[0x0]['language']==_0x35209a(0x14c))var _0x6840a9=users[_0x35209a(0x14c)];else{if(_0x4adff8[0x0][_0x35209a(0x143)]==_0x35209a(0x169))var _0x6840a9=users[_0x35209a(0x169)];else{if(_0x4adff8[0x0][_0x35209a(0x143)]==_0x35209a(0x155))var _0x6840a9=users['Portuguese'];else{if(_0x4adff8[0x0][_0x35209a(0x143)]==_0x35209a(0x183))var _0x6840a9=users['Chinese'];else{if(_0x4adff8[0x0][_0x35209a(0x143)]=='Arabic\x20(ae)')var _0x6840a9=users['Arabic'];}}}}}}}_0x17857d[_0x35209a(0x17e)](_0x35209a(0x148),{'success':_0x351770['flash']('success'),'errors':_0x351770[_0x35209a(0x152)](_0x35209a(0x17c)),'master_shop':_0x4adff8,'profile':_0x5d4110,'role':_0x1428d9,'language':_0x6840a9,'customer':_0x201a45,'sales_sa':_0x1173ab,'staff_arr':_0x587e74});}catch(_0x479e4b){console[_0x35209a(0x176)](_0x479e4b);}}),router[a0_0x465282(0x173)]('/add_sales',auth,upload['single']('image'),async(_0x7d50ee,_0x1da145)=>{const _0x4d67a8=a0_0x465282;try{const {customer:_0x33c9e9,date:_0x51cacd,prod_code:_0x4f55e0,note:_0x1d3339,paid_status:_0x5ed87d,DSI:_0x34d20d,cash_amount:_0x1875f9,amount_data:_0x1ea383,bank_data:_0x2961a3,check_no:_0x3f8969,due_date:_0x23a689}=_0x7d50ee[_0x4d67a8(0x167)],_0x397016=_0x7d50ee[_0x4d67a8(0x181)][_0x4d67a8(0x16b)];if(typeof _0x4f55e0==_0x4d67a8(0x156))var _0x20cc30=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x15b)]],_0x29484c=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x165)]],_0x2b76e6=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x159)]],_0x22aeab=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x14a)]],_0x2c9ef6=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x174)]],_0x3cd28a=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x17d)]],_0x54efd7=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x164)]],_0x18737a=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x16f)]],_0x1d3d4b=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x14f)]],_0x53bcb7=[_0x7d50ee['body'][_0x4d67a8(0x142)]],_0x1d7cc1=[_0x7d50ee[_0x4d67a8(0x167)]['no_per_unit']],_0x451c73=[_0x7d50ee[_0x4d67a8(0x167)]['getPrimUnitNo']],_0x53941c=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x140)]],_0x341fb4=[_0x7d50ee[_0x4d67a8(0x167)]['secondary_unit']],_0x44c30f=[_0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x139)]];else var _0x20cc30=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x15b)]],_0x29484c=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x165)]],_0x2b76e6=[..._0x7d50ee[_0x4d67a8(0x167)]['primary_code']],_0x22aeab=[..._0x7d50ee[_0x4d67a8(0x167)]['quantity']],_0x2c9ef6=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x174)]],_0x3cd28a=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x17d)]],_0x54efd7=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x164)]],_0x18737a=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x16f)]],_0x1d3d4b=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x14f)]],_0x53bcb7=[..._0x7d50ee['body'][_0x4d67a8(0x142)]],_0x1d7cc1=[..._0x7d50ee['body'][_0x4d67a8(0x157)]],_0x451c73=[..._0x7d50ee['body'][_0x4d67a8(0x137)]],_0x53941c=[..._0x7d50ee[_0x4d67a8(0x167)][_0x4d67a8(0x140)]],_0x341fb4=[..._0x7d50ee['body'][_0x4d67a8(0x130)]],_0x44c30f=[..._0x7d50ee['body']['conversion_unit']];const _0x3a50ed=_0x20cc30[_0x4d67a8(0x12e)](_0x2522fd=>{return _0x2522fd={'product_code':_0x2522fd};});_0x29484c['forEach']((_0x291c2b,_0x173855)=>{const _0x11b176=_0x4d67a8;_0x3a50ed[_0x173855][_0x11b176(0x144)]=_0x291c2b;}),_0x2b76e6[_0x4d67a8(0x15e)]((_0x5632d0,_0x33ba85)=>{const _0x1b5ba9=_0x4d67a8;_0x3a50ed[_0x33ba85][_0x1b5ba9(0x159)]=_0x5632d0;}),_0x1d7cc1[_0x4d67a8(0x15e)]((_0x41fd38,_0x51ce67)=>{const _0x418665=_0x4d67a8;_0x3a50ed[_0x51ce67][_0x418665(0x157)]=_0x41fd38;}),_0x22aeab[_0x4d67a8(0x15e)]((_0x1fbb64,_0xee2f3e)=>{const _0x2225f2=_0x4d67a8;_0x3a50ed[_0xee2f3e][_0x2225f2(0x14a)]=_0x1fbb64;}),_0x2c9ef6['forEach']((_0x5ec497,_0x8237a5)=>{const _0x3b23be=_0x4d67a8;_0x3a50ed[_0x8237a5][_0x3b23be(0x174)]=_0x5ec497;}),_0x3cd28a[_0x4d67a8(0x15e)]((_0x2390a0,_0x3ff0f2)=>{const _0x250776=_0x4d67a8;_0x3a50ed[_0x3ff0f2][_0x250776(0x17d)]=_0x2390a0;}),_0x54efd7['forEach']((_0x45985b,_0x2ba5d0)=>{const _0x2c0d28=_0x4d67a8;_0x3a50ed[_0x2ba5d0][_0x2c0d28(0x13a)]=_0x45985b;}),_0x18737a['forEach']((_0x333f38,_0x9b234e)=>{const _0x5df183=_0x4d67a8;_0x3a50ed[_0x9b234e][_0x5df183(0x141)]=_0x333f38;}),_0x1d3d4b[_0x4d67a8(0x15e)]((_0x5098d3,_0x38e65c)=>{const _0x49f6e2=_0x4d67a8;_0x3a50ed[_0x38e65c][_0x49f6e2(0x17a)]=_0x5098d3;}),_0x53bcb7[_0x4d67a8(0x15e)]((_0x285ad7,_0x5e7bf7)=>{const _0x5610d4=_0x4d67a8;_0x3a50ed[_0x5e7bf7][_0x5610d4(0x136)]=_0x285ad7;}),_0x341fb4[_0x4d67a8(0x15e)]((_0x3d1035,_0x404eef)=>{const _0x273d82=_0x4d67a8;_0x3a50ed[_0x404eef][_0x273d82(0x130)]=_0x3d1035;}),_0x451c73[_0x4d67a8(0x15e)]((_0x514f81,_0x450da7)=>{const _0x2b6be2=_0x4d67a8;_0x3a50ed[_0x450da7][_0x2b6be2(0x158)]=_0x514f81;}),_0x53941c[_0x4d67a8(0x15e)]((_0x3e44cc,_0x36de9a)=>{const _0x365df9=_0x4d67a8;_0x3a50ed[_0x36de9a][_0x365df9(0x140)]=_0x3e44cc;}),_0x44c30f[_0x4d67a8(0x15e)]((_0x39dd35,_0x2b5078)=>{const _0x1032e9=_0x4d67a8;_0x3a50ed[_0x2b5078][_0x1032e9(0x172)]=_0x39dd35;});const _0x56e591=new invoice_sa();await _0x56e591[_0x4d67a8(0x13c)]();const _0x3c22f6=_0x7d50ee[_0x4d67a8(0x15a)],_0x2800fb=await staff['findOne']({'email':_0x3c22f6['email']}),_0x3148ed=new sales_sa({'invoice':_0x56e591[_0x4d67a8(0x12b)][_0x4d67a8(0x150)]()['padStart'](0x8,'0'),'customer':_0x33c9e9,'file':_0x397016,'date':_0x51cacd,'sale_product':_0x3a50ed,'note':_0x1d3339,'sales_staff_id':_0x2800fb[_0x4d67a8(0x132)][_0x4d67a8(0x149)](),'paid':_0x5ed87d,'dsi':_0x34d20d,'cash':_0x1875f9,'amount':_0x1ea383,'bank':_0x2961a3,'check_no':_0x3f8969,'due_date':_0x23a689}),_0x368bf7=await _0x3148ed['save']();console[_0x4d67a8(0x176)](_0x4d67a8(0x168),_0x56e591[_0x4d67a8(0x12b)][_0x4d67a8(0x150)]()[_0x4d67a8(0x182)](0x8,'0'));const _0x269268=mongoose[_0x4d67a8(0x134)]['ObjectId'];_0x7d50ee[_0x4d67a8(0x152)](_0x4d67a8(0x15d),_0x4d67a8(0x145)),_0x1da145[_0x4d67a8(0x17f)](_0x4d67a8(0x171)+_0x368bf7['_id']);}catch(_0x2dfeaa){console[_0x4d67a8(0x176)](_0x2dfeaa);}}),router['post']('/add_sales_notes',auth,async(_0x1ef61d,_0x1928e3)=>{const _0x1f56dd=a0_0x465282;try{const {date_data:_0x403f33,note_data:_0x3e338d,status_data:_0x9e73c}=_0x1ef61d['body'],_0x569e52=new invoice_sa();await _0x569e52[_0x1f56dd(0x13c)]();const _0x50e0d2=_0x1ef61d[_0x1f56dd(0x15a)],_0x5909bf=await staff[_0x1f56dd(0x154)]({'email':_0x50e0d2['email']}),_0x2ba3c1=new sales_sa({'invoice':_0x569e52[_0x1f56dd(0x12b)][_0x1f56dd(0x150)]()[_0x1f56dd(0x182)](0x8,'0'),'status_data':_0x9e73c,'date':_0x403f33,'note':_0x3e338d,'sales_staff_id':_0x5909bf[_0x1f56dd(0x132)][_0x1f56dd(0x149)]()}),_0x3a3c75=await _0x2ba3c1['save']();console[_0x1f56dd(0x176)]('Invoice\x20created\x20with\x20incremented\x20start\x20value:',_0x569e52[_0x1f56dd(0x12b)][_0x1f56dd(0x150)]()['padStart'](0x8,'0'));const _0x5de305=mongoose[_0x1f56dd(0x134)][_0x1f56dd(0x163)];_0x1ef61d[_0x1f56dd(0x152)](_0x1f56dd(0x15d),'Sales\x20add\x20successfully'),_0x1928e3[_0x1f56dd(0x17f)](_0x1f56dd(0x171)+_0x3a3c75[_0x1f56dd(0x132)]);}catch(_0x3359ac){console[_0x1f56dd(0x176)](_0x3359ac);}}),router[a0_0x465282(0x173)](a0_0x465282(0x162),auth,async(_0x4fd094,_0x122840)=>{const _0x449d44=a0_0x465282;try{const _0x2ed890=_0x4fd094['user'],_0x398e62=await profile[_0x449d44(0x154)]({'email':_0x2ed890[_0x449d44(0x133)]}),_0x1bf452=await staff[_0x449d44(0x16c)]([{'$match':{'email':_0x2ed890['email']}},{'$unwind':_0x449d44(0x147)},{'$match':{'product_list.isConfirm':_0x449d44(0x179)}}]);_0x122840['json'](_0x1bf452);}catch(_0x260080){}}),router[a0_0x465282(0x173)](a0_0x465282(0x153),auth,async(_0x3a3508,_0x325402)=>{const _0x18bcd9=a0_0x465282;try{const {customer_name:_0x1c750d}=_0x3a3508[_0x18bcd9(0x167)],_0x2e6d06=await customer[_0x18bcd9(0x154)]({'name':_0x1c750d});_0x325402[_0x18bcd9(0x131)](_0x2e6d06);}catch(_0x2e8547){}}),router[a0_0x465282(0x173)](a0_0x465282(0x14d),auth,async(_0x1cd20b,_0x56563b)=>{const _0x2f1edc=a0_0x465282;try{const _0x37f98d=_0x1cd20b[_0x2f1edc(0x15a)],{id_data:_0x490eef}=_0x1cd20b['body'],_0x2d9ed8=await profile['findOne']({'email':_0x37f98d[_0x2f1edc(0x133)]}),_0x51079c=mongoose[_0x2f1edc(0x134)][_0x2f1edc(0x163)];console[_0x2f1edc(0x176)](_0x51079c(_0x490eef));var _0x266266=_0x51079c(_0x490eef);const _0x9e1c3c=await staff['aggregate']([{'$match':{'email':_0x37f98d[_0x2f1edc(0x133)]}},{'$unwind':_0x2f1edc(0x147)},{'$match':{'product_list.isConfirm':_0x2f1edc(0x179),'product_list._id':_0x266266}}]);_0x56563b[_0x2f1edc(0x131)](_0x9e1c3c);}catch(_0x2ee0ea){}}),router[a0_0x465282(0x173)]('/volume_setup',auth,async(_0x2cf086,_0x9490c6)=>{const _0x2b33f1=a0_0x465282;try{const _0x3bea09=await discount_volume_db[_0x2b33f1(0x154)]();_0x9490c6['json'](_0x3bea09);}catch(_0x510ea9){}}),router[a0_0x465282(0x173)](a0_0x465282(0x12d),auth,async(_0x42d1cd,_0x11bfdc)=>{const _0x30fbec=a0_0x465282;try{const _0x2f4c22=await product[_0x30fbec(0x178)]();_0x11bfdc[_0x30fbec(0x131)](_0x2f4c22);}catch(_0x21c7ea){}}),router['post'](a0_0x465282(0x17b),auth,async(_0x3e4945,_0x2b2f6c)=>{const _0x50ef67=a0_0x465282;try{const {id_data:_0x5f402c}=_0x3e4945['body'],_0x1f8824=await product['findById'](_0x5f402c);_0x2b2f6c[_0x50ef67(0x131)](_0x1f8824);}catch(_0x9ff140){}}),module[a0_0x465282(0x160)]=router;