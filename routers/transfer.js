var a0_0x1fc6e1=a0_0x2d52;(function(_0x5e99e0,_0x4721f7){var _0x5d7ffa=a0_0x2d52,_0x7f44f=_0x5e99e0();while(!![]){try{var _0x48ee25=-parseInt(_0x5d7ffa(0x18e))/0x1+-parseInt(_0x5d7ffa(0x176))/0x2*(-parseInt(_0x5d7ffa(0x217))/0x3)+parseInt(_0x5d7ffa(0x1fc))/0x4*(-parseInt(_0x5d7ffa(0x1c9))/0x5)+-parseInt(_0x5d7ffa(0x1e0))/0x6+-parseInt(_0x5d7ffa(0x144))/0x7*(-parseInt(_0x5d7ffa(0x1d2))/0x8)+-parseInt(_0x5d7ffa(0x196))/0x9*(-parseInt(_0x5d7ffa(0x1bd))/0xa)+parseInt(_0x5d7ffa(0x1a3))/0xb;if(_0x48ee25===_0x4721f7)break;else _0x7f44f['push'](_0x7f44f['shift']());}catch(_0x472175){_0x7f44f['push'](_0x7f44f['shift']());}}}(a0_0x40fc,0x57e9b));function a0_0x2d52(_0x5cee2e,_0x32fb36){var _0x40fc79=a0_0x40fc();return a0_0x2d52=function(_0x2d52fe,_0x2fbcb3){_0x2d52fe=_0x2d52fe-0x144;var _0xf2c7f7=_0x40fc79[_0x2d52fe];return _0xf2c7f7;},a0_0x2d52(_0x5cee2e,_0x32fb36);}const express=require(a0_0x1fc6e1(0x198)),app=express(),router=express[a0_0x1fc6e1(0x1af)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1fc6e1(0x15d)),users=require(a0_0x1fc6e1(0x1e1)),nodemailer=require(a0_0x1fc6e1(0x160));router[a0_0x1fc6e1(0x151)]('/view',auth,async(_0x34b33d,_0x2b1c0e)=>{var _0x188030=a0_0x1fc6e1;try{const {username:_0x244b82,email:_0x5483c9,role:_0x2e5884}=_0x34b33d['user'],_0x1b40b2=_0x34b33d[_0x188030(0x1cd)],_0x411616=await profile['findOne']({'email':_0x1b40b2[_0x188030(0x1b5)]}),_0xe33d99=await master_shop[_0x188030(0x1a1)]();console[_0x188030(0x1d9)]('master',_0xe33d99);let _0x2ec2a0;if(_0x1b40b2[_0x188030(0x1ae)]==_0x188030(0x161)){const _0x36c442=await staff[_0x188030(0x1b1)]({'email':_0x1b40b2['email']});_0x2ec2a0=await transfers['find']({'from_warehouse':_0x36c442[_0x188030(0x178)]});}else _0x2ec2a0=await transfers[_0x188030(0x1f7)]([{'$unwind':_0x188030(0x1e9)},{'$group':{'_id':_0x188030(0x1bb),'invoice':{'$first':_0x188030(0x154)},'date':{'$first':_0x188030(0x1ec)},'from_warehouse':{'$first':_0x188030(0x1ab)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x188030(0x216)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0xe33d99[0x0][_0x188030(0x221)]==_0x188030(0x1a9)){var _0x44207d=users[_0x188030(0x1dd)];console['log'](_0x44207d);}else{if(_0xe33d99[0x0][_0x188030(0x221)]=='Hindi')var _0x44207d=users[_0x188030(0x16d)];else{if(_0xe33d99[0x0][_0x188030(0x221)]==_0x188030(0x173))var _0x44207d=users[_0x188030(0x173)];else{if(_0xe33d99[0x0]['language']==_0x188030(0x194))var _0x44207d=users['Spanish'];else{if(_0xe33d99[0x0][_0x188030(0x221)]==_0x188030(0x203))var _0x44207d=users[_0x188030(0x203)];else{if(_0xe33d99[0x0][_0x188030(0x221)]==_0x188030(0x1cc))var _0x44207d=users['Portuguese'];else{if(_0xe33d99[0x0][_0x188030(0x221)]==_0x188030(0x1e6))var _0x44207d=users[_0x188030(0x1e6)];else{if(_0xe33d99[0x0][_0x188030(0x221)]==_0x188030(0x22c))var _0x44207d=users[_0x188030(0x1d3)];}}}}}}}_0x2b1c0e[_0x188030(0x1c0)]('transfer',{'success':_0x34b33d[_0x188030(0x152)](_0x188030(0x21c)),'errors':_0x34b33d[_0x188030(0x152)](_0x188030(0x15c)),'role':_0x1b40b2,'profile':_0x411616,'master_shop':_0xe33d99,'transfer':_0x2ec2a0,'language':_0x44207d});}catch(_0x164c7a){console[_0x188030(0x1d9)](_0x164c7a);}});function a0_0x40fc(){var _0x4c2ba8=['$product_details.secondary_unit','$product_details.maxProducts','prod_name','$product_details.level','from_room','$product_details','Email\x20sent\x20successfully','$product_details.production_date','to_prod_pallet','$product_details.product_stock','add_transfer','Rack\x20F','$product_details.invoice','<h5>','push','site_title','$product_details.bin','649711PtScrC','</tr>','to_types','$product_details.type','<hr\x20class=\x22my-3\x22>','logo','Spanish','getMonth','1161dwpewH','to_quantity','express','exports','to_room','<h5\x20style=\x22text-align:\x20left;\x22>','primary_code','Enabled','$product_details.isle','product_stock','from_floorlevel','find','Transfer\x20Edit\x20Successfully','6677352yxbNUV','save','Rack\x20D','/view/add_transfer','To_invoice','secondary_unit','English\x20(US)','$product_details.pallet','$from_warehouse','True','to_prod_level','role','Router','product_code','findOne','secondary_code','/barcode_scanner','$product_details.product_code','email','error','$product_details.batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','bay','/view/:id','$_id','to_room_name','26020HOvzQm','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','render','$name','post','Receiving\x20Area','COLD\x20STORAGE','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.storage','ToRoomAssigned','findById','910810ROtwMW','to_bin','back','Portuguese\x20(BR)','user','MaxStocks_data2','<html><head><title></title>','$product_details.product_name','/transfer/view','65440gTGQCl','Arabic','filter','\x20</h2>','all','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','log','message','$product_details.bay','<tr>','English','from_rak','catch','1072932KvaDay','../public/language/languages.json','</td>','sendMail','date','id_transaction','Chinese','maxperunit','from_quantity','$product','slice','Raw\x20Materials','$date','$product_details.secondary_code','<strong>\x20Regards\x20</strong>','rak','product_details','from_prod_pallet','from_warehouse','concat','Logo.png','to_bay','here','aggregate','/preview/:id','rack','$product_details.rack','updateOne','12gSECMN','Shelves','unit','<h2>\x20','from_bin','floor','to_prod_isle','French','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_code3','$product_details._id','map','from_prod_qty','json','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','then','Rack\x20A','max_per_unit','\x20Order\x20Date\x20:\x20','\x20Order\x20Number\x20:\x20','TRF-','production_date','storage','params','/barcode_scanner3','<div>','$product.to_room_name','42PqjkYI','to_invoice','type','Enclosed','to_floorlevel','success','expiry_date','length','from_prod_isle','<table\x20style=\x22width:\x20100%\x20!important;\x22>','language','DRY\x20STORAGE','$product_details.unit','$room','string','RoomAssigned','/transfer/preview/','bin','redirect','createTransport','$product_details.floorlevel','Arabic\x20(ae)','525BaqyBu','from_rack','status','</h5>','Error\x20Occurs','<span\x20style=\x22float:\x20right;\x22>','split','from_types','from_invoice','$product_details.maxPerUnit','New_Qty_Converted','</tbody>','\x20<>\x20','get','flash','batch_code','$invoice','body','forEach','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product','to_warehouse','host','errors','../middleware/auth','Return\x20Rooms','to_prod_qty','nodemailer','staff','RMSEmail','from_room_name','from_prod_level','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_name','Floor','Level','</body></html>','Portuguese','master','Hindi','$product_details.primary_code','</div>','password','Product\x20Transfer\x20successfully','maxProducts','German','from_bay','from_storage','25560GiZjmh','id_transaction_id','warehouse','invoice','floorlevel','</head><body>','_id'];a0_0x40fc=function(){return _0x4c2ba8;};return a0_0x40fc();}async function getRandom8DigitNumber(){var _0x292dc4=a0_0x1fc6e1;const _0x241aba=0x989680,_0x76b325=0x5f5e0ff,_0x4f10cb=Math[_0x292dc4(0x201)](Math['random']()*(_0x76b325-_0x241aba+0x1))+_0x241aba;var _0x29d3ba;const _0x4dffbf=await transfers[_0x292dc4(0x1b1)]({'invoice':_0x292dc4(0x210)+_0x4f10cb});return _0x4dffbf&&_0x4dffbf[_0x292dc4(0x21e)]>0x0?_0x29d3ba='TRF-'+_0x4f10cb:_0x29d3ba='TRF-'+_0x4f10cb,_0x29d3ba;}router[a0_0x1fc6e1(0x151)](a0_0x1fc6e1(0x1a6),auth,async(_0x106b28,_0xe3ae39)=>{var _0xd0b853=a0_0x1fc6e1;try{const {username:_0x104b3a,email:_0x4cd8c0,role:_0x2e86a5}=_0x106b28[_0xd0b853(0x1cd)],_0x50bc8d=_0x106b28[_0xd0b853(0x1cd)],_0xafa2b3=await profile[_0xd0b853(0x1b1)]({'email':_0x50bc8d[_0xd0b853(0x1b5)]}),_0xb4c933=await master_shop[_0xd0b853(0x1a1)]();console[_0xd0b853(0x1d9)](_0xd0b853(0x16c),_0xb4c933);let _0x3a966a;if(_0x50bc8d[_0xd0b853(0x1ae)]==_0xd0b853(0x161)){const _0x1dd024=await staff['findOne']({'email':_0x50bc8d['email']});_0x3a966a=await warehouse['aggregate']([{'$match':{'status':_0xd0b853(0x19d),'name':_0x1dd024[_0xd0b853(0x178)],'warehouse_category':_0xd0b853(0x1eb)}},{'$group':{'_id':_0xd0b853(0x1c1),'name':{'$first':_0xd0b853(0x1c1)}}}]);}else _0x3a966a=await warehouse[_0xd0b853(0x1f7)]([{'$match':{'status':_0xd0b853(0x19d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0xd0b853(0x1c1)}}}]);var _0x2f1651=['Ambient',_0xd0b853(0x21a),_0xd0b853(0x15e)];const _0x2631c8=await transfers[_0xd0b853(0x1a1)]({}),_0x5bccc9=_0x2631c8[_0xd0b853(0x21e)]+0x1,_0x2e1a32=_0xd0b853(0x210)+_0x5bccc9['toString']()['padStart'](0x5,'0');if(_0xb4c933[0x0][_0xd0b853(0x221)]==_0xd0b853(0x1a9)){var _0x4a15a4=users[_0xd0b853(0x1dd)];console[_0xd0b853(0x1d9)](_0x4a15a4);}else{if(_0xb4c933[0x0][_0xd0b853(0x221)]==_0xd0b853(0x16d))var _0x4a15a4=users[_0xd0b853(0x16d)];else{if(_0xb4c933[0x0][_0xd0b853(0x221)]=='German')var _0x4a15a4=users['German'];else{if(_0xb4c933[0x0][_0xd0b853(0x221)]=='Spanish')var _0x4a15a4=users[_0xd0b853(0x194)];else{if(_0xb4c933[0x0][_0xd0b853(0x221)]=='French')var _0x4a15a4=users[_0xd0b853(0x203)];else{if(_0xb4c933[0x0][_0xd0b853(0x221)]==_0xd0b853(0x1cc))var _0x4a15a4=users['Portuguese'];else{if(_0xb4c933[0x0][_0xd0b853(0x221)]==_0xd0b853(0x1e6))var _0x4a15a4=users[_0xd0b853(0x1e6)];else{if(_0xb4c933[0x0]['language']==_0xd0b853(0x22c))var _0x4a15a4=users[_0xd0b853(0x1d3)];}}}}}}}const _0x822f92=getRandom8DigitNumber();_0x822f92[_0xd0b853(0x20b)](_0x3a349b=>{var _0x4139f6=_0xd0b853;_0xe3ae39[_0x4139f6(0x1c0)](_0x4139f6(0x187),{'success':_0x106b28['flash'](_0x4139f6(0x21c)),'errors':_0x106b28[_0x4139f6(0x152)](_0x4139f6(0x15c)),'role':_0x50bc8d,'profile':_0xafa2b3,'master_shop':_0xb4c933,'warehouse':_0x3a966a,'language':_0x4a15a4,'rooms_data':_0x2f1651,'invoice':_0x3a349b});})[_0xd0b853(0x1df)](_0x3aee0f=>{var _0x52c55e=_0xd0b853;_0x106b28[_0x52c55e(0x152)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xe3ae39[_0x52c55e(0x229)](_0x52c55e(0x1d1));});}catch(_0x412e78){console[_0xd0b853(0x1d9)](_0x412e78);}}),router[a0_0x1fc6e1(0x1c2)]('/view/add_transfer',auth,async(_0x2dc177,_0x4ffdaa)=>{var _0x536281=a0_0x1fc6e1;try{console['log'](_0x2dc177[_0x536281(0x155)]);const {date:_0x36c953,from_warehouse:_0x362b4a,FromRoom_name:_0x34007b,to_warehouse:_0x214e43,ToRoom_name:_0x50953b,prod_name:_0x4b4e56,from_prod_qty:_0x13b1db,from_prod_level:_0x11c0fd,from_prod_isle:_0x32386a,from_prod_pallet:_0x28bec4,to_prod_qty:_0x5117ba,to_prod_level:_0x3d20ce,to_prod_isle:_0x14cdeb,to_prod_pallet:_0x1f0050,primary_code:_0x2281c5,secondary_code:_0x415210,product_code3:_0x2810a9,note:_0x31bd8a,MaxStocks_data2:_0x7f0323,invoice:_0x38436f,expiry_date:_0x9a63c1}=_0x2dc177[_0x536281(0x155)];if(typeof _0x4b4e56==_0x536281(0x225))var _0x27ff29=[_0x2dc177[_0x536281(0x155)][_0x536281(0x17f)]],_0x12f457=[_0x2dc177[_0x536281(0x155)]['from_prod_qty']],_0x2b151e=[_0x2dc177[_0x536281(0x155)][_0x536281(0x164)]],_0x1a71af=[_0x2dc177[_0x536281(0x155)][_0x536281(0x14e)]],_0x25c406=[_0x2dc177[_0x536281(0x155)][_0x536281(0x1ad)]],_0x5c3624=[_0x2dc177[_0x536281(0x155)][_0x536281(0x19c)]],_0x4799b7=[_0x2dc177[_0x536281(0x155)][_0x536281(0x1b2)]],_0x4b3f18=[_0x2dc177['body'][_0x536281(0x205)]],_0x4d1d1e=[_0x2dc177[_0x536281(0x155)][_0x536281(0x1ce)]],_0x357555=[_0x2dc177[_0x536281(0x155)]['primary_unit']],_0x56b38d=[_0x2dc177['body'][_0x536281(0x1a8)]],_0x2c3c33=[_0x2dc177[_0x536281(0x155)][_0x536281(0x153)]],_0x3ac53e=[_0x2dc177[_0x536281(0x155)]['expiry_date']],_0x3cee01=[_0x2dc177[_0x536281(0x155)][_0x536281(0x20d)]],_0x17a5b1=[_0x2dc177[_0x536281(0x155)][_0x536281(0x211)]],_0x43206c=[_0x2dc177[_0x536281(0x155)][_0x536281(0x1d7)]],_0x56bb04=[_0x2dc177[_0x536281(0x155)][_0x536281(0x226)]],_0x5840cb=[_0x2dc177[_0x536281(0x155)][_0x536281(0x1c7)]],_0x44a22f=[_0x2dc177[_0x536281(0x155)][_0x536281(0x14c)]],_0x2af7ef=[_0x2dc177['body'][_0x536281(0x218)]],_0x243c78=[_0x2dc177['body'][_0x536281(0x1e5)]];else var _0x27ff29=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x17f)]],_0x12f457=[..._0x2dc177['body']['from_prod_qty']],_0x2b151e=[..._0x2dc177['body'][_0x536281(0x164)]],_0x1a71af=[..._0x2dc177[_0x536281(0x155)]['New_Qty_Converted']],_0x25c406=[..._0x2dc177['body'][_0x536281(0x1ad)]],_0x5c3624=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x19c)]],_0x4799b7=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x1b2)]],_0x4b3f18=[..._0x2dc177['body']['product_code3']],_0x4d1d1e=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x1ce)]],_0x357555=[..._0x2dc177[_0x536281(0x155)]['primary_unit']],_0x56b38d=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x1a8)]],_0x2c3c33=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x153)]],_0x3ac53e=[..._0x2dc177[_0x536281(0x155)]['expiry_date']],_0x3cee01=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x20d)]],_0x17a5b1=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x211)]],_0x43206c=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x1d7)]],_0x56bb04=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x226)]],_0x5840cb=[..._0x2dc177['body'][_0x536281(0x1c7)]],_0x44a22f=[..._0x2dc177[_0x536281(0x155)][_0x536281(0x14c)]],_0x2af7ef=[..._0x2dc177[_0x536281(0x155)]['to_invoice']],_0x243c78=[..._0x2dc177['body'][_0x536281(0x1e5)]];const _0xa56d85=_0x27ff29[_0x536281(0x207)](_0x331bc4=>{return _0x331bc4={'product_name':_0x331bc4};});_0x12f457[_0x536281(0x156)]((_0x388688,_0x4f1794)=>{_0xa56d85[_0x4f1794]['from_quantity']=_0x388688;}),_0x44a22f[_0x536281(0x156)]((_0x5ad9d2,_0x2cb5a8)=>{var _0x1c1893=_0x536281;_0xa56d85[_0x2cb5a8][_0x1c1893(0x14c)]=_0x5ad9d2;}),_0x2af7ef[_0x536281(0x156)]((_0x1ee2ab,_0x4fce57)=>{var _0x4716c0=_0x536281;_0xa56d85[_0x4fce57][_0x4716c0(0x1a7)]=_0x1ee2ab;}),_0x243c78[_0x536281(0x156)]((_0x368321,_0x3ad325)=>{var _0x47bec3=_0x536281;_0xa56d85[_0x3ad325][_0x47bec3(0x177)]=_0x368321;}),_0x2b151e[_0x536281(0x156)]((_0x114064,_0x44b454)=>{var _0x397b1f=_0x536281;_0x56bb04[_0x397b1f(0x156)]((_0x4cb9f8,_0x31fa2e)=>{var _0x16d6f4=_0x397b1f;if(_0x4cb9f8==_0x16d6f4(0x1c3)&&_0x44b454==_0x31fa2e){var _0x26d8c0=_0x114064[_0x16d6f4(0x1ea)](0x3);_0xa56d85[_0x44b454][_0x16d6f4(0x175)]=_0x114064[0x0],_0xa56d85[_0x44b454]['from_rack']=_0x114064[0x1],_0xa56d85[_0x44b454]['from_bay']=0x0,_0xa56d85[_0x44b454]['from_bin']=0x0,_0xa56d85[_0x44b454]['from_types']=_0x16d6f4(0x168),_0xa56d85[_0x44b454][_0x16d6f4(0x1a0)]=_0x26d8c0;}else{if(_0x4cb9f8==_0x16d6f4(0x1fd)&&_0x44b454==_0x31fa2e){var _0x26d8c0=_0x114064[_0x16d6f4(0x1ea)](0x3);_0xa56d85[_0x44b454][_0x16d6f4(0x175)]=_0x114064[0x0],_0xa56d85[_0x44b454][_0x16d6f4(0x145)]=_0x114064[0x1],_0xa56d85[_0x44b454][_0x16d6f4(0x174)]=0x0,_0xa56d85[_0x44b454][_0x16d6f4(0x200)]=0x0,_0xa56d85[_0x44b454][_0x16d6f4(0x14b)]=_0x16d6f4(0x168),_0xa56d85[_0x44b454][_0x16d6f4(0x1a0)]=_0x114064[0x5];}else{if(_0x44b454==_0x31fa2e){if(_0x114064[0x0]=='A'&&_0x114064[0x1]=='L'&&_0x114064[0x2]=='L')console[_0x16d6f4(0x1d9)](_0x4cb9f8+'\x20<>\x20'+_0x44b454+_0x16d6f4(0x150)+_0x31fa2e+_0x16d6f4(0x150)+_0x114064+_0x16d6f4(0x1f6)),_0xa56d85[_0x44b454][_0x16d6f4(0x175)]=_0x114064[0x0],_0xa56d85[_0x44b454][_0x16d6f4(0x145)]=_0x114064[0x1],_0xa56d85[_0x44b454][_0x16d6f4(0x174)]=0x0,_0xa56d85[_0x44b454]['from_bin']=0x0,_0xa56d85[_0x44b454][_0x16d6f4(0x14b)]=_0x16d6f4(0x168),_0xa56d85[_0x44b454][_0x16d6f4(0x1a0)]=_0x114064[0x3];else{var _0x41ef30;if(_0x114064[0x4]=='L')_0x41ef30=_0x16d6f4(0x169);else _0x114064[0x4]=='F'&&(_0x41ef30=_0x16d6f4(0x168));_0xa56d85[_0x44b454]['from_storage']=_0x114064[0x0],_0xa56d85[_0x44b454]['from_rack']=_0x114064[0x1],_0xa56d85[_0x44b454][_0x16d6f4(0x174)]=_0x114064[0x2],_0xa56d85[_0x44b454][_0x16d6f4(0x200)]=_0x114064[0x3],_0xa56d85[_0x44b454][_0x16d6f4(0x14b)]=_0x41ef30,_0xa56d85[_0x44b454][_0x16d6f4(0x1a0)]=_0x114064[0x5];}}}}});}),_0x1a71af[_0x536281(0x156)]((_0x41c47a,_0x57489d)=>{var _0x296dab=_0x536281;_0xa56d85[_0x57489d][_0x296dab(0x197)]=_0x41c47a;}),_0x25c406[_0x536281(0x156)]((_0x32a055,_0x466f35)=>{_0x5840cb['forEach']((_0x1a676d,_0x10f6e1)=>{var _0x4403d1=a0_0x2d52;if(_0x1a676d==_0x4403d1(0x1c3)&&_0x466f35==_0x10f6e1){var _0x2b065d=_0x32a055[_0x4403d1(0x1ea)](0x3);_0xa56d85[_0x466f35][_0x4403d1(0x212)]=_0x32a055[0x0],_0xa56d85[_0x466f35][_0x4403d1(0x1f9)]=_0x32a055[0x1],_0xa56d85[_0x466f35][_0x4403d1(0x1f5)]=0x0,_0xa56d85[_0x466f35][_0x4403d1(0x1ca)]=0x0,_0xa56d85[_0x466f35][_0x4403d1(0x190)]='Floor',_0xa56d85[_0x466f35][_0x4403d1(0x21b)]=_0x2b065d;}else{if(_0x1a676d==_0x4403d1(0x1fd)&&_0x466f35==_0x10f6e1){var _0x2b065d=_0x32a055[_0x4403d1(0x1ea)](0x3);_0xa56d85[_0x466f35][_0x4403d1(0x212)]=_0x32a055[0x0],_0xa56d85[_0x466f35][_0x4403d1(0x1f9)]=_0x32a055[0x1],_0xa56d85[_0x466f35][_0x4403d1(0x1f5)]=0x0,_0xa56d85[_0x466f35][_0x4403d1(0x1ca)]=0x0,_0xa56d85[_0x466f35][_0x4403d1(0x190)]=_0x4403d1(0x168),_0xa56d85[_0x466f35][_0x4403d1(0x21b)]=_0x32a055[0x5];}else{if(_0x466f35==_0x10f6e1){if(_0x32a055[0x0]=='A'&&_0x32a055[0x1]=='L'&&_0x32a055[0x2]=='L')console[_0x4403d1(0x1d9)](_0x1a676d+'\x20<>\x20'+_0x466f35+_0x4403d1(0x150)+_0x10f6e1+'\x20<>\x20'+_0x32a055+'here'),_0xa56d85[_0x466f35][_0x4403d1(0x212)]=_0x32a055[0x0],_0xa56d85[_0x466f35][_0x4403d1(0x1f9)]=_0x32a055[0x1],_0xa56d85[_0x466f35][_0x4403d1(0x1f5)]=0x0,_0xa56d85[_0x466f35][_0x4403d1(0x1ca)]=0x0,_0xa56d85[_0x466f35][_0x4403d1(0x190)]=_0x4403d1(0x168),_0xa56d85[_0x466f35][_0x4403d1(0x21b)]=_0x32a055[0x3];else{var _0x17ae26;if(_0x32a055[0x4]=='L')_0x17ae26=_0x4403d1(0x169);else _0x32a055[0x4]=='F'&&(_0x17ae26='Floor');_0xa56d85[_0x466f35][_0x4403d1(0x212)]=_0x32a055[0x0],_0xa56d85[_0x466f35][_0x4403d1(0x1f9)]=_0x32a055[0x1],_0xa56d85[_0x466f35][_0x4403d1(0x1f5)]=_0x32a055[0x2],_0xa56d85[_0x466f35]['to_bin']=_0x32a055[0x3],_0xa56d85[_0x466f35][_0x4403d1(0x190)]=_0x17ae26,_0xa56d85[_0x466f35][_0x4403d1(0x21b)]=_0x32a055[0x5];}}}}});}),_0x5c3624[_0x536281(0x156)]((_0x17cb23,_0x1fa291)=>{_0xa56d85[_0x1fa291]['primary_code']=_0x17cb23;}),_0x4799b7[_0x536281(0x156)]((_0x418152,_0x54d35c)=>{var _0x15a211=_0x536281;_0xa56d85[_0x54d35c][_0x15a211(0x1b2)]=_0x418152;}),_0x4b3f18[_0x536281(0x156)]((_0x2ba693,_0x58f5e0)=>{var _0x43152=_0x536281;_0xa56d85[_0x58f5e0][_0x43152(0x1b0)]=_0x2ba693;}),_0x4d1d1e[_0x536281(0x156)]((_0x1a68b2,_0x3e76aa)=>{var _0x57fd54=_0x536281;_0xa56d85[_0x3e76aa][_0x57fd54(0x172)]=_0x1a68b2;}),_0x357555[_0x536281(0x156)]((_0x360cd8,_0x455297)=>{var _0x4d2576=_0x536281;_0xa56d85[_0x455297][_0x4d2576(0x1fe)]=_0x360cd8;}),_0x56b38d[_0x536281(0x156)]((_0x4e0e29,_0x1b1555)=>{var _0x46918a=_0x536281;_0xa56d85[_0x1b1555][_0x46918a(0x1a8)]=_0x4e0e29;}),_0x2c3c33['forEach']((_0xc56653,_0x2ec6ec)=>{var _0x43b1a8=_0x536281;_0xa56d85[_0x2ec6ec][_0x43b1a8(0x153)]=_0xc56653;}),_0x3ac53e[_0x536281(0x156)]((_0x2cdf08,_0x20cc2d)=>{var _0x4b49fe=_0x536281;_0xa56d85[_0x20cc2d][_0x4b49fe(0x21d)]=_0x2cdf08;}),_0x3cee01[_0x536281(0x156)]((_0x283b72,_0x4b8b0f)=>{var _0x5a7865=_0x536281;_0xa56d85[_0x4b8b0f][_0x5a7865(0x1e7)]=_0x283b72;}),_0x17a5b1[_0x536281(0x156)]((_0x1b34fc,_0x474546)=>{var _0x59cee1=_0x536281;_0xa56d85[_0x474546][_0x59cee1(0x211)]=_0x1b34fc;}),_0x43206c[_0x536281(0x156)]((_0x2bf549,_0x15ebbb)=>{_0xa56d85[_0x15ebbb]['prod_cat']=_0x2bf549;}),_0x56bb04[_0x536281(0x156)]((_0x388ad7,_0x4d4c56)=>{var _0x1cfb37=_0x536281;_0xa56d85[_0x4d4c56][_0x1cfb37(0x163)]=_0x388ad7;}),_0x5840cb['forEach']((_0x20821f,_0x434d80)=>{var _0xacbe29=_0x536281;_0xa56d85[_0x434d80][_0xacbe29(0x1bc)]=_0x20821f;});const _0x29ef3c=_0xa56d85[_0x536281(0x1d4)](_0x5ef9bc=>_0x5ef9bc[_0x536281(0x197)]!=='0'&&_0x5ef9bc['to_quantity']!==''||_0x5ef9bc[_0x536281(0x21b)]!=='0'&&_0x5ef9bc['to_floorlevel']!==''),_0x2c129c=new transfers({'date':_0x36c953,'from_warehouse':_0x362b4a,'to_warehouse':_0x214e43,'product':_0x29ef3c,'note':_0x31bd8a,'invoice':_0x38436f}),_0x2c1435=await _0x2c129c[_0x536281(0x1a4)]();_0x2dc177['flash']('success',_0x536281(0x171)),_0x4ffdaa['redirect'](_0x536281(0x227)+_0x2c1435['_id']);}catch(_0xddda41){console[_0x536281(0x1d9)](_0xddda41),_0x4ffdaa[_0x536281(0x146)](0xc8)[_0x536281(0x209)]({'errorMessage':_0xddda41[_0x536281(0x1da)]});}}),router[a0_0x1fc6e1(0x151)](a0_0x1fc6e1(0x1f8),auth,async(_0xa82ecc,_0x396369)=>{var _0x1e287c=a0_0x1fc6e1;try{const {username:_0x206bbc,email:_0x395572,role:_0x124ba2}=_0xa82ecc[_0x1e287c(0x1cd)],_0x10b845=_0xa82ecc[_0x1e287c(0x1cd)],_0x2e19d8=await profile[_0x1e287c(0x1b1)]({'email':_0x10b845[_0x1e287c(0x1b5)]}),_0x391d90=await master_shop[_0x1e287c(0x1a1)]();console[_0x1e287c(0x1d9)](_0x1e287c(0x16c),_0x391d90);const _0xfc3475=await transfers[_0x1e287c(0x1c8)](_0xa82ecc[_0x1e287c(0x213)]['id']);let _0x523ac5=new Date(_0xfc3475[_0x1e287c(0x21d)]),_0xe6be3f=('0'+_0x523ac5['getDate']())[_0x1e287c(0x1ea)](-0x2),_0x93bc2e=('0'+(_0x523ac5[_0x1e287c(0x195)]()+0x1))['slice'](-0x2),_0x4e91e8=_0x523ac5[_0x1e287c(0x1be)](),_0x21bbfb=_0x4e91e8+'-'+_0x93bc2e+'-'+_0xe6be3f,_0xf3e3e1;if(_0x10b845[_0x1e287c(0x1ae)]=='staff'){const _0x51bdbc=await staff['findOne']({'email':_0x10b845['email']});_0xf3e3e1=await warehouse['find']({'status':_0x1e287c(0x19d),'name':_0x51bdbc[_0x1e287c(0x178)],'warehouse_category':_0x1e287c(0x1eb)});}else _0xf3e3e1=await warehouse[_0x1e287c(0x1a1)]({'status':'Enabled','warehouse_category':_0x1e287c(0x1eb)});const _0x95f414=await warehouse[_0x1e287c(0x1f7)]([{'$match':{'name':_0xfc3475[_0x1e287c(0x1f2)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1e287c(0x206),'name':{'$first':_0x1e287c(0x1d0)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1e287c(0x18d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1e287c(0x16e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1e287c(0x1b4)},'storage':{'$first':_0x1e287c(0x1c6)},'rack':{'$first':_0x1e287c(0x1fa)},'expiry_date':{'$first':_0x1e287c(0x157)},'production_date':{'$first':_0x1e287c(0x184)},'room':{'$first':_0x1e287c(0x224)}}}]);if(_0x391d90[0x0]['language']==_0x1e287c(0x1a9)){var _0x2f1542=users[_0x1e287c(0x1dd)];console[_0x1e287c(0x1d9)](_0x2f1542);}else{if(_0x391d90[0x0]['language']=='Hindi')var _0x2f1542=users[_0x1e287c(0x16d)];else{if(_0x391d90[0x0][_0x1e287c(0x221)]=='German')var _0x2f1542=users[_0x1e287c(0x173)];else{if(_0x391d90[0x0][_0x1e287c(0x221)]==_0x1e287c(0x194))var _0x2f1542=users['Spanish'];else{if(_0x391d90[0x0][_0x1e287c(0x221)]==_0x1e287c(0x203))var _0x2f1542=users['French'];else{if(_0x391d90[0x0]['language']==_0x1e287c(0x1cc))var _0x2f1542=users[_0x1e287c(0x16b)];else{if(_0x391d90[0x0][_0x1e287c(0x221)]==_0x1e287c(0x1e6))var _0x2f1542=users[_0x1e287c(0x1e6)];else{if(_0x391d90[0x0][_0x1e287c(0x221)]=='Arabic\x20(ae)')var _0x2f1542=users[_0x1e287c(0x1d3)];}}}}}}}_0x396369[_0x1e287c(0x1c0)]('edit_transfer_view',{'success':_0xa82ecc[_0x1e287c(0x152)]('success'),'errors':_0xa82ecc[_0x1e287c(0x152)](_0x1e287c(0x15c)),'role':_0x10b845,'profile':_0x2e19d8,'master_shop':_0x391d90,'warehouse':_0xf3e3e1,'transfer':_0xfc3475,'stock':_0x95f414,'language':_0x2f1542});}catch(_0x1427ab){console[_0x1e287c(0x1d9)](_0x1427ab);}}),router[a0_0x1fc6e1(0x1c2)](a0_0x1fc6e1(0x1f8),auth,async(_0x139810,_0x35d98b)=>{var _0x3efb41=a0_0x1fc6e1;try{const _0x660dc4=_0x139810[_0x3efb41(0x213)]['id'],{from_warehouse:_0x3e2329,FromRoom_name:_0x411526,to_warehouse:_0x12cff9,ToRoom_name:_0x5961c0}=_0x139810[_0x3efb41(0x155)],_0x32e9a1=await transfers[_0x3efb41(0x1c8)]({'_id':_0x660dc4}),_0x26988b=_0x32e9a1[_0x3efb41(0x159)][_0x3efb41(0x207)](async _0x3d40e8=>{var _0x2890f4=_0x3efb41;if(_0x3d40e8[_0x2890f4(0x197)]>0x0){var _0x150160=await warehouse[_0x2890f4(0x1b1)]({'name':_0x32e9a1[_0x2890f4(0x1f2)],'room':_0x3d40e8[_0x2890f4(0x163)],'warehouse_category':_0x2890f4(0x1eb)});const _0x349d8f=_0x150160[_0x2890f4(0x1f0)][_0x2890f4(0x207)](_0x4f2f64=>{var _0x2e5e2c=_0x2890f4;_0x4f2f64[_0x2e5e2c(0x167)]==_0x3d40e8[_0x2e5e2c(0x167)]&&_0x4f2f64[_0x2e5e2c(0x17a)]==_0x3d40e8[_0x2e5e2c(0x1a0)]&&_0x4f2f64[_0x2e5e2c(0x219)]==_0x3d40e8[_0x2e5e2c(0x14b)]&&_0x4f2f64[_0x2e5e2c(0x228)]==_0x3d40e8['from_bin']&&_0x4f2f64[_0x2e5e2c(0x1b9)]==_0x3d40e8[_0x2e5e2c(0x174)]&&_0x4f2f64[_0x2e5e2c(0x1f9)]==_0x3d40e8[_0x2e5e2c(0x145)]&&_0x4f2f64[_0x2e5e2c(0x212)]==_0x3d40e8['from_storage']&&_0x4f2f64[_0x2e5e2c(0x21d)]==_0x3d40e8['expiry_date']&&_0x4f2f64['batch_code']==_0x3d40e8[_0x2e5e2c(0x153)]&&_0x4f2f64[_0x2e5e2c(0x211)]==_0x3d40e8[_0x2e5e2c(0x211)]&&_0x4f2f64[_0x2e5e2c(0x179)]==_0x3d40e8[_0x2e5e2c(0x14c)]&&_0x4f2f64['_id']==_0x3d40e8[_0x2e5e2c(0x177)]&&(_0x4f2f64[_0x2e5e2c(0x19f)]=_0x4f2f64['product_stock']-_0x3d40e8[_0x2e5e2c(0x197)]);});}return _0x150160;});Promise[_0x3efb41(0x1d6)](_0x26988b)['then'](async _0x51f2cf=>{var _0x1d01f7=_0x3efb41;try{for(const _0xc3cc65 of _0x51f2cf){await _0xc3cc65[_0x1d01f7(0x1a4)]();}try{const _0x2e287b=_0x32e9a1[_0x1d01f7(0x159)][_0x1d01f7(0x207)](async _0x38d032=>{var _0x21bf10=_0x1d01f7;if(_0x38d032[_0x21bf10(0x197)]>0x0){var _0x5e3ad6=await warehouse['findOne']({'name':_0x32e9a1[_0x21bf10(0x15a)],'room':_0x38d032['to_room_name'],'warehouse_category':'Raw\x20Materials'}),_0x3ba648=0x0;const _0x15749e=_0x5e3ad6[_0x21bf10(0x1f0)]['map'](_0x19e4e4=>{var _0x300881=_0x21bf10;_0x19e4e4[_0x300881(0x167)]==_0x38d032[_0x300881(0x167)]&&_0x19e4e4[_0x300881(0x17a)]==_0x38d032[_0x300881(0x21b)]&&_0x19e4e4[_0x300881(0x219)]==_0x38d032[_0x300881(0x190)]&&_0x19e4e4[_0x300881(0x228)]==_0x38d032['to_bin']&&_0x19e4e4[_0x300881(0x1b9)]==_0x38d032[_0x300881(0x1f5)]&&_0x19e4e4['rack']==_0x38d032[_0x300881(0x1f9)]&&_0x19e4e4[_0x300881(0x212)]==_0x38d032[_0x300881(0x212)]&&_0x19e4e4[_0x300881(0x21d)]==_0x38d032[_0x300881(0x21d)]&&_0x19e4e4[_0x300881(0x153)]==_0x38d032['batch_code']&&_0x19e4e4[_0x300881(0x211)]==_0x38d032[_0x300881(0x211)]&&_0x19e4e4['invoice']==_0x38d032[_0x300881(0x1a7)]&&(_0x19e4e4[_0x300881(0x19f)]=_0x19e4e4[_0x300881(0x19f)]+_0x38d032['to_quantity'],_0x3ba648++);});_0x3ba648=='0'&&(_0x5e3ad6['product_details']=_0x5e3ad6['product_details']['concat']({'product_name':_0x38d032[_0x21bf10(0x167)],'product_stock':_0x38d032[_0x21bf10(0x197)],'bay':_0x38d032[_0x21bf10(0x1f5)],'bin':_0x38d032[_0x21bf10(0x1ca)],'type':_0x38d032[_0x21bf10(0x190)],'floorlevel':_0x38d032['to_floorlevel'],'storage':_0x38d032[_0x21bf10(0x212)],'rack':_0x38d032[_0x21bf10(0x1f9)],'product_code':_0x38d032[_0x21bf10(0x1b0)],'primary_code':_0x38d032['primary_code'],'secondary_code':_0x38d032[_0x21bf10(0x1b2)],'maxProducts':_0x38d032['maxProducts'],'storage':_0x38d032[_0x21bf10(0x212)],'rack':_0x38d032['rack'],'expiry_date':_0x38d032[_0x21bf10(0x21d)],'maxPerUnit':_0x38d032[_0x21bf10(0x1e7)],'batch_code':_0x38d032[_0x21bf10(0x153)],'production_date':_0x38d032[_0x21bf10(0x211)]}));}return _0x5e3ad6;});Promise[_0x1d01f7(0x1d6)](_0x2e287b)[_0x1d01f7(0x20b)](async _0x482b60=>{var _0x49e093=_0x1d01f7;try{for(const _0x1003e7 of _0x482b60){await warehouse[_0x49e093(0x1fb)]({'_id':_0x1003e7[_0x49e093(0x17c)]},{'$addToSet':{'product_details':{'$each':_0x1003e7[_0x49e093(0x1f0)]}}});}_0x32e9a1['finalize']=_0x49e093(0x1ac);const _0x4442cf=await _0x32e9a1[_0x49e093(0x1a4)](),_0x5c0ca9=await master_shop['find'](),_0x3317d9=await email_settings[_0x49e093(0x1b1)](),_0x313c56=await supervisor_settings['find']();var _0xac3fa9=_0x32e9a1[_0x49e093(0x159)],_0x1e06ab='',_0x5abe0f;for(_0x5abe0f in _0xac3fa9){_0x1e06ab+=_0x49e093(0x1dc)+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x167)]+'</td>'+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x1b0)]+_0x49e093(0x1e2)+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x197)]+_0x49e093(0x1e2)+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x1fe)]+_0x49e093(0x1e2)+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x1a8)]+_0x49e093(0x1e2)+_0x49e093(0x20a)+_0x32e9a1['to_warehouse']+_0x49e093(0x1e2)+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x1bc)]+'</td>'+_0x49e093(0x20a)+_0xac3fa9[_0x5abe0f][_0x49e093(0x212)]+_0xac3fa9[_0x5abe0f][_0x49e093(0x1f9)]+_0xac3fa9[_0x5abe0f][_0x49e093(0x1f5)]+_0xac3fa9[_0x5abe0f][_0x49e093(0x1ca)]+_0xac3fa9[_0x5abe0f]['to_types'][0x0]+_0xac3fa9[_0x5abe0f][_0x49e093(0x21b)]+_0x49e093(0x1e2),'</tr>';}let _0xb1bf2a=nodemailer[_0x49e093(0x22a)]({'host':_0x3317d9[_0x49e093(0x15b)],'port':Number(_0x3317d9['port']),'secure':![],'auth':{'user':_0x3317d9[_0x49e093(0x1b5)],'pass':_0x3317d9[_0x49e093(0x170)]}}),_0xfee717={'from':_0x3317d9['email'],'to':_0x313c56[0x0][_0x49e093(0x162)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x49e093(0x1f4),'path':__dirname+_0x49e093(0x165)+'/upload/'+_0x5c0ca9[0x0]['image'],'cid':_0x49e093(0x193)}],'html':'<!DOCTYPE\x20html>'+_0x49e093(0x1cf)+_0x49e093(0x17b)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x49e093(0x215)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x49e093(0x1ff)+_0x5c0ca9[0x0][_0x49e093(0x18c)]+_0x49e093(0x1d5)+_0x49e093(0x16f)+'</div>'+_0x49e093(0x192)+_0x49e093(0x215)+_0x49e093(0x19b)+_0x49e093(0x20f)+_0x32e9a1[_0x49e093(0x179)]+'\x20'+_0x49e093(0x149)+_0x49e093(0x20e)+_0x32e9a1['date']+'\x20'+'</span>'+_0x49e093(0x147)+_0x49e093(0x16f)+_0x49e093(0x220)+_0x49e093(0x204)+_0x49e093(0x1dc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x49e093(0x158)+_0x49e093(0x1bf)+_0x49e093(0x166)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x49e093(0x1d8)+_0x49e093(0x1c5)+_0x49e093(0x18f)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1e06ab+'\x20'+_0x49e093(0x14f)+'</table>'+_0x49e093(0x215)+_0x49e093(0x1ee)+_0x49e093(0x18a)+_0x5c0ca9[0x0]['site_title']+_0x49e093(0x147)+_0x49e093(0x16f)+'</div>'+_0x49e093(0x16a)};_0xb1bf2a[_0x49e093(0x1e3)](_0xfee717,function(_0x4b3ef7,_0x58c4bc){var _0x70a8e6=_0x49e093;_0x4b3ef7?(console[_0x70a8e6(0x1d9)](_0x4b3ef7),console[_0x70a8e6(0x1d9)](_0x70a8e6(0x148))):console[_0x70a8e6(0x1d9)](_0x70a8e6(0x183));}),_0x139810['flash'](_0x49e093(0x21c),'Transfer\x20Finalize\x20Successfully'),_0x35d98b[_0x49e093(0x229)]('/picking_list/PDF_transfer_rm/'+_0x4442cf[_0x49e093(0x17c)]);}catch(_0x566c95){console[_0x49e093(0x1b6)](_0x566c95),_0x35d98b[_0x49e093(0x146)](0x1f4)[_0x49e093(0x209)]({'Perror':_0x49e093(0x1b8),'message':_0x566c95['message']});}})['catch'](_0xce55da=>{var _0x335f23=_0x1d01f7;console[_0x335f23(0x1b6)](_0xce55da),_0x35d98b['status'](0x1f4)[_0x335f23(0x209)]({'Perror':'An\x20error\x20occurred.'});});}catch(_0x127840){_0x35d98b[_0x1d01f7(0x209)](_0x127840);}}catch(_0x25f65a){console['error'](_0x25f65a),_0x35d98b[_0x1d01f7(0x146)](0x1f4)['json']({'Merror':_0x1d01f7(0x1b8),'Message':_0x25f65a[_0x1d01f7(0x1da)]});}})[_0x3efb41(0x1df)](_0x1bc897=>{var _0x331527=_0x3efb41;console[_0x331527(0x1b6)](_0x1bc897),_0x35d98b['status'](0x1f4)[_0x331527(0x209)]({'Merror':'An\x20error\x20occurred.'});});}catch(_0x4bd2ca){console[_0x3efb41(0x1d9)](_0x4bd2ca);}});function BayBinSelected(_0x3ebe7b,_0x785403){var _0x526747=a0_0x1fc6e1,_0xad6291=[],_0x182769=[],_0x5412af=[],_0x3f8222=[],_0x3d478e=[],_0x481400=[];let _0x2c6616=[];if(_0x3ebe7b==_0x526747(0x222))switch(_0x785403){case'Rack\x20A':_0xad6291=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x182769=[0x1,0x2],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169),_0x526747(0x168)],_0x3d478e=['D'],_0x481400=['A'];break;case'Rack\x20B':_0xad6291=[0x6,0x5,0x4,0x3,0x2,0x1],_0x182769=[0x1,0x2],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169),_0x526747(0x168)],_0x3d478e=['D'],_0x481400=['B'];break;case _0x526747(0x1fd):_0xad6291=[0x0],_0x182769=[0x0],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x168)],_0x3d478e=['D'],_0x481400=['S'];break;case _0x526747(0x1c3):_0xad6291=[0x0],_0x182769=[0x0],_0x3f8222=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5412af=[_0x526747(0x168)],_0x3d478e=['D'],_0x481400=['R'];break;}else{if(_0x3ebe7b==_0x526747(0x1c4))switch(_0x785403){case _0x526747(0x20c):_0xad6291=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x182769=['B','F'],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169),_0x526747(0x168)],_0x3d478e=['C'],_0x481400=['A'];break;case'Rack\x20B':_0xad6291=[0x5,0x4,0x3,0x2,0x1],_0x182769=['F','B','S'],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169),_0x526747(0x168)],_0x3d478e=['C'],_0x481400=['B'];break;case'Rack\x20C':_0xad6291=[0x1,0x2,0x3,0x4,0x5],_0x182769=['B','F','S'],_0x3f8222=[0x5,0x4,0x3,0x2,0x1],_0x5412af=[_0x526747(0x169),_0x526747(0x168)],_0x3d478e=['C'],_0x481400=['C'];break;case _0x526747(0x1a5):_0xad6291=[0x5,0x4,0x3,0x2,0x1],_0x182769=['F','B','S'],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169),'Floor'],_0x3d478e=['C'],_0x481400=['D'];break;case'Rack\x20E':_0xad6291=[0x4,0x3,0x2,0x1],_0x182769=[0x1,0x2],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169),_0x526747(0x168)],_0x3d478e=['C'],_0x481400=['E'];break;case _0x526747(0x188):_0xad6291=[0x1,0x2,0x3],_0x182769=[0x1,0x2],_0x3f8222=[0x1,0x2,0x3,0x4,0x5],_0x5412af=[_0x526747(0x169)],_0x3d478e=['C'],_0x481400=['F'];break;}}return{'levels':_0xad6291,'Isle':_0x182769,'rack':_0x3f8222,'type':_0x5412af,'storage':_0x3d478e,'rak':_0x481400};}router['get'](a0_0x1fc6e1(0x1ba),auth,async(_0x17425b,_0x43a272)=>{var _0x32d64c=a0_0x1fc6e1;try{const {username:_0x3e2689,email:_0x49e027,role:_0x379432}=_0x17425b[_0x32d64c(0x1cd)],_0x5b2fc1=_0x17425b[_0x32d64c(0x1cd)],_0x3ea914=await profile['findOne']({'email':_0x5b2fc1['email']}),_0x8d41e5=await master_shop[_0x32d64c(0x1a1)](),_0x2a20e5=await transfers[_0x32d64c(0x1c8)](_0x17425b[_0x32d64c(0x213)]['id']);let _0x268ac4;if(_0x5b2fc1[_0x32d64c(0x1ae)]==_0x32d64c(0x161)){const _0x80748d=await staff[_0x32d64c(0x1b1)]({'email':_0x5b2fc1[_0x32d64c(0x1b5)]});_0x268ac4=await warehouse[_0x32d64c(0x1f7)]([{'$match':{'status':_0x32d64c(0x19d),'name':_0x80748d[_0x32d64c(0x178)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x32d64c(0x1c1)}}}]);}else _0x268ac4=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x32d64c(0x1c1),'name':{'$first':'$name'}}}]);const _0xcc94d8=await warehouse[_0x32d64c(0x1f7)]([{'$match':{'name':_0x2a20e5['from_warehouse'],'warehouse_category':_0x32d64c(0x1eb)}},{'$unwind':_0x32d64c(0x182)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x32d64c(0x186)},'bay':{'$first':_0x32d64c(0x1db)},'bin':{'$first':_0x32d64c(0x18d)},'type':{'$first':_0x32d64c(0x191)},'floorlevel':{'$first':_0x32d64c(0x22b)},'primary_code':{'$first':_0x32d64c(0x16e)},'secondary_code':{'$first':_0x32d64c(0x1ed)},'product_code':{'$first':_0x32d64c(0x1b4)},'storage':{'$first':_0x32d64c(0x1c6)},'rack':{'$first':_0x32d64c(0x1fa)},'expiry_date':{'$first':_0x32d64c(0x157)},'production_date':{'$first':_0x32d64c(0x184)},'room':{'$first':_0x32d64c(0x224)}}}]),_0x478962=await product['find']({}),_0x2ee35e=BayBinSelected(_0x2a20e5[_0x32d64c(0x15a)],_0x2a20e5[_0x32d64c(0x19a)]);if(_0x8d41e5[0x0][_0x32d64c(0x221)]==_0x32d64c(0x1a9)){var _0x53732b=users[_0x32d64c(0x1dd)];console[_0x32d64c(0x1d9)](_0x53732b);}else{if(_0x8d41e5[0x0][_0x32d64c(0x221)]==_0x32d64c(0x16d))var _0x53732b=users[_0x32d64c(0x16d)];else{if(_0x8d41e5[0x0]['language']=='German')var _0x53732b=users[_0x32d64c(0x173)];else{if(_0x8d41e5[0x0]['language']==_0x32d64c(0x194))var _0x53732b=users['Spanish'];else{if(_0x8d41e5[0x0][_0x32d64c(0x221)]==_0x32d64c(0x203))var _0x53732b=users[_0x32d64c(0x203)];else{if(_0x8d41e5[0x0][_0x32d64c(0x221)]==_0x32d64c(0x1cc))var _0x53732b=users[_0x32d64c(0x16b)];else{if(_0x8d41e5[0x0][_0x32d64c(0x221)]==_0x32d64c(0x1e6))var _0x53732b=users[_0x32d64c(0x1e6)];else{if(_0x8d41e5[0x0]['language']=='Arabic\x20(ae)')var _0x53732b=users[_0x32d64c(0x1d3)];}}}}}}}_0x43a272[_0x32d64c(0x1c0)]('edit_transfer',{'success':_0x17425b[_0x32d64c(0x152)](_0x32d64c(0x21c)),'errors':_0x17425b[_0x32d64c(0x152)]('errors'),'role':_0x5b2fc1,'profile':_0x3ea914,'master_shop':_0x8d41e5,'warehouse':_0x268ac4,'transfer':_0x2a20e5,'stock':_0xcc94d8,'unit':_0x478962,'language':_0x53732b});}catch(_0x549f12){console[_0x32d64c(0x1d9)](_0x549f12);}}),router[a0_0x1fc6e1(0x1c2)](a0_0x1fc6e1(0x1ba),auth,async(_0x588881,_0x2580bb)=>{var _0x15ac2f=a0_0x1fc6e1;try{const _0x9da214=_0x588881[_0x15ac2f(0x213)]['id'],_0x2be89f=await transfers['findById'](_0x9da214);_0x2580bb['json'](_0x588881[_0x15ac2f(0x155)]);return;const {date:_0x5ad278,from_warehouse:_0x334fa5,FromRoom_name:_0x60716b,to_warehouse:_0xbe171f,ToRoom_name:_0x29618d,prod_name:_0xf03931,from_prod_qty:_0x192232,from_prod_level:_0x3a0418,from_prod_isle:_0x3182c9,from_prod_pallet:_0x843454,to_prod_qty:_0x450920,to_prod_level:_0x507e85,to_prod_isle:_0x59f3bf,to_prod_pallet:_0x1744ea,primary_code:_0x547f56,secondary_code:_0x3b7402,product_code3:_0x336c5e,note:_0x2dc397,invoice:_0x1db687,expiry_date:_0x5c2048}=_0x588881[_0x15ac2f(0x155)];if(typeof _0xf03931==_0x15ac2f(0x225))var _0x410abf=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x17f)]],_0x583f47=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x208)]],_0x5db732=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x164)]],_0x120e5b=[_0x588881['body'][_0x15ac2f(0x21f)]],_0x19b7c2=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1f1)]],_0x30625c=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x14b)]],_0x28e1ee=[_0x588881['body'][_0x15ac2f(0x15f)]],_0x3f133b=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1ad)]],_0x3388f4=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x202)]],_0x69ae61=[_0x588881[_0x15ac2f(0x155)]['to_prod_pallet']],_0x4d8bc5=[_0x588881['body']['to_types']],_0x15b600=[_0x588881[_0x15ac2f(0x155)]['storage']],_0x719a36=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1ef)]],_0x158373=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x19c)]],_0x2156c9=[_0x588881['body'][_0x15ac2f(0x1b2)]],_0x26d6ed=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x205)]],_0x5957ad=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1ce)]],_0x1d0e25=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1fe)]],_0x559dc0=[_0x588881['body']['secondary_unit']],_0x6bf781=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x153)]],_0x46f244=[_0x588881['body']['expiry_date']],_0x30b3c9=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x175)]],_0x5616ba=[_0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1de)]];else var _0x410abf=[..._0x588881['body'][_0x15ac2f(0x17f)]],_0x15b600=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x212)]],_0x719a36=[..._0x588881['body'][_0x15ac2f(0x1ef)]],_0x30625c=[..._0x588881[_0x15ac2f(0x155)]['from_types']],_0x4d8bc5=[..._0x588881['body']['to_types']],_0x583f47=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x208)]],_0x5db732=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x164)]],_0x120e5b=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x21f)]],_0x19b7c2=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1f1)]],_0x28e1ee=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x15f)]],_0x3f133b=[..._0x588881[_0x15ac2f(0x155)]['to_prod_level']],_0x3388f4=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x202)]],_0x69ae61=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x185)]],_0x158373=[..._0x588881[_0x15ac2f(0x155)]['primary_code']],_0x2156c9=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1b2)]],_0x26d6ed=[..._0x588881['body'][_0x15ac2f(0x205)]],_0x5957ad=[..._0x588881['body'][_0x15ac2f(0x1ce)]],_0x1d0e25=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1fe)]],_0x559dc0=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x1a8)]],_0x6bf781=[..._0x588881[_0x15ac2f(0x155)][_0x15ac2f(0x153)]],_0x46f244=[..._0x588881['body']['expiry_date']],_0x30b3c9=[..._0x588881[_0x15ac2f(0x155)]['from_storage']],_0x5616ba=[..._0x588881['body'][_0x15ac2f(0x1de)]];const _0xb0fffa=_0x410abf[_0x15ac2f(0x207)](_0x17a7fc=>{return _0x17a7fc={'product_name':_0x17a7fc};});_0x583f47[_0x15ac2f(0x156)]((_0x2770c7,_0x5c187f)=>{_0xb0fffa[_0x5c187f]['from_quantity']=_0x2770c7;}),_0x5db732[_0x15ac2f(0x156)]((_0x28370c,_0x3c6f56)=>{var _0x464395=_0x15ac2f;_0xb0fffa[_0x3c6f56][_0x464395(0x174)]=_0x28370c;}),_0x120e5b[_0x15ac2f(0x156)]((_0x37d1a8,_0x24317c)=>{var _0x1e0846=_0x15ac2f;_0xb0fffa[_0x24317c][_0x1e0846(0x200)]=_0x37d1a8;}),_0x19b7c2[_0x15ac2f(0x156)]((_0x532d22,_0x4b4ff5)=>{var _0x5c385c=_0x15ac2f;_0xb0fffa[_0x4b4ff5][_0x5c385c(0x1a0)]=_0x532d22;}),_0x28e1ee['forEach']((_0x4c4227,_0x4fe174)=>{var _0x452f55=_0x15ac2f;_0xb0fffa[_0x4fe174][_0x452f55(0x197)]=_0x4c4227;}),_0x3f133b[_0x15ac2f(0x156)]((_0xaa79ac,_0x589454)=>{_0xb0fffa[_0x589454]['to_bay']=_0xaa79ac;}),_0x3388f4[_0x15ac2f(0x156)]((_0xe6d5d1,_0xa90e7e)=>{_0xb0fffa[_0xa90e7e]['to_bin']=_0xe6d5d1;}),_0x69ae61[_0x15ac2f(0x156)]((_0x2a63c3,_0x5d3e2a)=>{_0xb0fffa[_0x5d3e2a]['to_floorlevel']=_0x2a63c3;}),_0x158373[_0x15ac2f(0x156)]((_0x1a1831,_0x43ae8b)=>{var _0x18f065=_0x15ac2f;_0xb0fffa[_0x43ae8b][_0x18f065(0x19c)]=_0x1a1831;}),_0x2156c9[_0x15ac2f(0x156)]((_0x1cce79,_0x10acdd)=>{var _0x20e3f5=_0x15ac2f;_0xb0fffa[_0x10acdd][_0x20e3f5(0x1b2)]=_0x1cce79;}),_0x26d6ed['forEach']((_0x253b80,_0x5cf884)=>{_0xb0fffa[_0x5cf884]['product_code']=_0x253b80;}),_0x5957ad[_0x15ac2f(0x156)]((_0xd2be8a,_0x1dcee5)=>{_0xb0fffa[_0x1dcee5]['maxProducts']=_0xd2be8a;}),_0x1d0e25[_0x15ac2f(0x156)]((_0x48a0c6,_0x444c47)=>{var _0x44ed85=_0x15ac2f;_0xb0fffa[_0x444c47][_0x44ed85(0x1fe)]=_0x48a0c6;}),_0x559dc0['forEach']((_0x5c6232,_0x57581f)=>{_0xb0fffa[_0x57581f]['secondary_unit']=_0x5c6232;}),_0x6bf781[_0x15ac2f(0x156)]((_0x4bc80d,_0x5be819)=>{var _0x38ea03=_0x15ac2f;_0xb0fffa[_0x5be819][_0x38ea03(0x153)]=_0x4bc80d;}),_0x46f244['forEach']((_0x2b97b4,_0x20dc48)=>{var _0x40636d=_0x15ac2f;_0xb0fffa[_0x20dc48][_0x40636d(0x21d)]=_0x2b97b4;}),_0x15b600[_0x15ac2f(0x156)]((_0x34a1d6,_0x55d26a)=>{var _0x589737=_0x15ac2f;_0xb0fffa[_0x55d26a][_0x589737(0x212)]=_0x34a1d6;}),_0x719a36['forEach']((_0x217347,_0xb298e7)=>{var _0x2075ff=_0x15ac2f;_0xb0fffa[_0xb298e7][_0x2075ff(0x1f9)]=_0x217347;}),_0x30625c[_0x15ac2f(0x156)]((_0x37bb4f,_0x189d42)=>{var _0xec2a45=_0x15ac2f;_0xb0fffa[_0x189d42][_0xec2a45(0x14b)]=_0x37bb4f;}),_0x4d8bc5[_0x15ac2f(0x156)]((_0x1a8110,_0x358fb4)=>{var _0x9a82af=_0x15ac2f;_0xb0fffa[_0x358fb4][_0x9a82af(0x190)]=_0x1a8110;}),_0x30b3c9[_0x15ac2f(0x156)]((_0x2f829f,_0x9b5d26)=>{_0xb0fffa[_0x9b5d26]['from_storage']=_0x2f829f;}),_0x5616ba[_0x15ac2f(0x156)]((_0x1dd536,_0x35129f)=>{_0xb0fffa[_0x35129f]['from_rack']=_0x1dd536;});const _0x2dbf23=_0xb0fffa['filter'](_0x4f12c9=>_0x4f12c9[_0x15ac2f(0x197)]!=='0'&&_0x4f12c9['to_quantity']!==''||_0x4f12c9[_0x15ac2f(0x21b)]!=='0'&&_0x4f12c9[_0x15ac2f(0x21b)]!=='');var _0x30aaa5=0x0;_0x2dbf23[_0x15ac2f(0x156)](_0xaa7324=>{var _0x561a9f=_0x15ac2f;parseInt(_0xaa7324[_0x561a9f(0x1e8)])<parseInt(_0xaa7324[_0x561a9f(0x197)])&&_0x30aaa5++;});if(_0x30aaa5!=0x0)return _0x588881[_0x15ac2f(0x152)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x2580bb[_0x15ac2f(0x229)](_0x15ac2f(0x1cb));const _0x33327b=await warehouse['findOne']({'name':_0x2be89f[_0x15ac2f(0x1f2)],'room':_0x2be89f[_0x15ac2f(0x181)]});_0x2be89f[_0x15ac2f(0x159)][_0x15ac2f(0x156)](_0x2bf90c=>{var _0x4fbcc8=_0x15ac2f;if(_0x2bf90c[_0x4fbcc8(0x197)]>0x0){const _0x26805f=_0x33327b[_0x4fbcc8(0x1f0)][_0x4fbcc8(0x207)](_0xd77f75=>{var _0xf59ce3=_0x4fbcc8;_0xd77f75[_0xf59ce3(0x167)]==_0x2bf90c['product_name']&&_0xd77f75[_0xf59ce3(0x17a)]==_0x2bf90c[_0xf59ce3(0x1a0)]&&_0xd77f75[_0xf59ce3(0x219)]==_0x2bf90c[_0xf59ce3(0x14b)]&&_0xd77f75[_0xf59ce3(0x228)]==_0x2bf90c[_0xf59ce3(0x200)]&&_0xd77f75[_0xf59ce3(0x1b9)]==_0x2bf90c[_0xf59ce3(0x174)]&&_0xd77f75['rack']==_0x2bf90c['from_rack']&&_0xd77f75[_0xf59ce3(0x212)]==_0x2bf90c[_0xf59ce3(0x175)]&&(_0xd77f75[_0xf59ce3(0x19f)]=parseInt(_0xd77f75['product_stock'])+parseInt(_0x2bf90c[_0xf59ce3(0x197)]));});}}),await _0x33327b[_0x15ac2f(0x1a4)]();const _0x45b405=await warehouse[_0x15ac2f(0x1b1)]({'name':_0x2be89f[_0x15ac2f(0x15a)],'room':_0x2be89f[_0x15ac2f(0x19a)]});_0x2be89f[_0x15ac2f(0x159)][_0x15ac2f(0x156)](_0x1b368e=>{var _0x554224=_0x15ac2f;if(_0x1b368e['to_quantity']>0x0){const _0xa21cce=_0x45b405['product_details'][_0x554224(0x207)](_0x54e64b=>{var _0x45cf63=_0x554224;_0x54e64b[_0x45cf63(0x167)]==_0x1b368e[_0x45cf63(0x167)]&&_0x54e64b['floorlevel']==_0x1b368e[_0x45cf63(0x21b)]&&_0x54e64b[_0x45cf63(0x219)]==_0x1b368e[_0x45cf63(0x190)]&&_0x54e64b[_0x45cf63(0x228)]==_0x1b368e[_0x45cf63(0x1ca)]&&_0x54e64b[_0x45cf63(0x1b9)]==_0x1b368e['to_bay']&&_0x54e64b[_0x45cf63(0x1f9)]==_0x1b368e[_0x45cf63(0x1f9)]&&_0x54e64b['storage']==_0x1b368e['storage']&&(_0x54e64b['product_stock']=parseInt(_0x54e64b['product_stock'])-parseInt(_0x1b368e['to_quantity']));});}}),await _0x45b405[_0x15ac2f(0x1a4)](),_0x2be89f[_0x15ac2f(0x1e4)]=_0x5ad278,_0x2be89f[_0x15ac2f(0x1f2)]=_0x334fa5,_0x2be89f[_0x15ac2f(0x15a)]=_0xbe171f,_0x2be89f['product']=_0x2dbf23,_0x2be89f['note']=_0x2dc397,_0x2be89f[_0x15ac2f(0x179)]=_0x1db687;const _0x4c227d=await _0x2be89f['save']();console[_0x15ac2f(0x1d9)](_0x4c227d);const _0x1354fe=await warehouse[_0x15ac2f(0x1b1)]({'name':_0x334fa5,'room':_0x60716b});_0x4c227d['product'][_0x15ac2f(0x156)](_0x33b878=>{var _0x59736f=_0x15ac2f;if(_0x33b878[_0x59736f(0x197)]>0x0){const _0x352e81=_0x1354fe[_0x59736f(0x1f0)][_0x59736f(0x207)](_0x419614=>{var _0x30e53d=_0x59736f;_0x419614[_0x30e53d(0x167)]==_0x33b878[_0x30e53d(0x167)]&&_0x419614[_0x30e53d(0x17a)]==_0x33b878[_0x30e53d(0x1a0)]&&_0x419614[_0x30e53d(0x219)]==_0x33b878[_0x30e53d(0x14b)]&&_0x419614[_0x30e53d(0x228)]==_0x33b878['from_bin']&&_0x419614['bay']==_0x33b878['from_bay']&&_0x419614[_0x30e53d(0x1f9)]==_0x33b878[_0x30e53d(0x145)]&&_0x419614[_0x30e53d(0x212)]==_0x33b878[_0x30e53d(0x175)]&&(_0x419614[_0x30e53d(0x19f)]=parseInt(_0x419614[_0x30e53d(0x19f)])-parseInt(_0x33b878['to_quantity']));});}}),await _0x1354fe[_0x15ac2f(0x1a4)]();const _0x104df2=await warehouse[_0x15ac2f(0x1b1)]({'name':_0xbe171f,'room':_0x29618d});_0x4c227d[_0x15ac2f(0x159)][_0x15ac2f(0x156)](_0x2e6a18=>{var _0xc1d4eb=_0x15ac2f;if(_0x2e6a18[_0xc1d4eb(0x197)]>0x0){var _0x3b7367=0x0;const _0x11b0ad=_0x104df2[_0xc1d4eb(0x1f0)][_0xc1d4eb(0x207)](_0x2198cb=>{var _0x46082a=_0xc1d4eb;_0x2198cb[_0x46082a(0x167)]==_0x2e6a18[_0x46082a(0x167)]&&_0x2198cb[_0x46082a(0x17a)]==_0x2e6a18['to_floorlevel']&&_0x2198cb[_0x46082a(0x219)]==_0x2e6a18[_0x46082a(0x190)]&&_0x2198cb[_0x46082a(0x228)]==_0x2e6a18[_0x46082a(0x1ca)]&&_0x2198cb[_0x46082a(0x1b9)]==_0x2e6a18[_0x46082a(0x1f5)]&&_0x2198cb[_0x46082a(0x1f9)]==_0x2e6a18[_0x46082a(0x1f9)]&&_0x2198cb['storage']==_0x2e6a18['storage']&&(_0x2198cb['product_stock']=parseInt(_0x2198cb[_0x46082a(0x19f)])+parseInt(_0x2e6a18[_0x46082a(0x197)]),_0x3b7367++);});_0x3b7367=='0'&&(_0x104df2[_0xc1d4eb(0x1f0)]=_0x104df2['product_details'][_0xc1d4eb(0x1f3)]({'product_name':_0x2e6a18['product_name'],'product_stock':_0x2e6a18['to_quantity'],'bay':_0x2e6a18[_0xc1d4eb(0x1f5)],'bin':_0x2e6a18[_0xc1d4eb(0x1ca)],'type':_0x2e6a18['to_types'],'floorlevel':_0x2e6a18[_0xc1d4eb(0x21b)],'storage':_0x2e6a18[_0xc1d4eb(0x212)],'rack':_0x2e6a18['rack'],'product_code':_0x2e6a18[_0xc1d4eb(0x1b0)],'primary_code':_0x2e6a18[_0xc1d4eb(0x19c)],'secondary_code':_0x2e6a18['secondary_code'],'maxProducts':_0x2e6a18[_0xc1d4eb(0x172)],'storage':_0x2e6a18[_0xc1d4eb(0x212)],'rack':_0x2e6a18[_0xc1d4eb(0x1f9)]}));}}),await _0x104df2['save'](),_0x588881[_0x15ac2f(0x152)](_0x15ac2f(0x21c),_0x15ac2f(0x1a2)),_0x2580bb[_0x15ac2f(0x229)](_0x15ac2f(0x1d1));}catch(_0x281940){console[_0x15ac2f(0x1d9)](_0x281940);}}),router['post'](a0_0x1fc6e1(0x1b3),async(_0x211847,_0x2b2bf3)=>{var _0x201d7f=a0_0x1fc6e1;const {FromWareHouse:_0x361450,FromRoom:_0x39bf9a,ToWarehouse:_0x157ec7,ToRoom:_0x37a007,primary_code:_0x3d19f2,Roomslist:_0x1104f7}=_0x211847[_0x201d7f(0x155)],_0x43f72e=_0x1104f7[_0x201d7f(0x14a)](','),_0x2558da=[];async function _0x36c0d6(_0x3820d3){var _0x4a4cce=_0x201d7f;const _0x18085a=await warehouse[_0x4a4cce(0x1f7)]([{'$match':{'name':_0x361450,'room':_0x3820d3}},{'$unwind':_0x4a4cce(0x182)},{'$match':{'product_details.primary_code':_0x3d19f2}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x4a4cce(0x186)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4a4cce(0x1ed)},'product_code':{'$first':_0x4a4cce(0x1b4)},'level':{'$first':_0x4a4cce(0x1db)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x4a4cce(0x22b)},'unit':{'$first':_0x4a4cce(0x223)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4a4cce(0x1c6)},'rack':{'$first':_0x4a4cce(0x1fa)},'expiry_date':{'$first':_0x4a4cce(0x157)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x4a4cce(0x1b7)},'maxPerUnit':{'$first':_0x4a4cce(0x14d)},'prod_cat':{'$first':'P'},'roomNamed':{'$first':_0x4a4cce(0x224)},'maxProducts':{'$first':_0x4a4cce(0x17e)},'invoice_product':{'$first':_0x4a4cce(0x189)}}}]),_0x2844d5=await warehouse['aggregate']([{'$match':{'name':_0x361450,'room':_0x3820d3}},{'$unwind':_0x4a4cce(0x182)},{'$match':{'product_details.secondary_code':_0x3d19f2}},{'$group':{'_id':_0x4a4cce(0x206),'name':{'$first':'$product_details.product_name'},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4a4cce(0x16e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4a4cce(0x1b4)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4a4cce(0x18d)},'type':{'$first':_0x4a4cce(0x191)},'pallet':{'$first':_0x4a4cce(0x22b)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4a4cce(0x17d)},'storage':{'$first':_0x4a4cce(0x1c6)},'rack':{'$first':_0x4a4cce(0x1fa)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4a4cce(0x184)},'batch_code':{'$first':_0x4a4cce(0x1b7)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'prod_cat':{'$first':'S'},'roomNamed':{'$first':_0x4a4cce(0x224)},'maxProducts':{'$first':_0x4a4cce(0x17e)},'invoice_product':{'$first':'$product_details.invoice'}}}]);if(_0x18085a[_0x4a4cce(0x21e)]>0x0)_0x2558da[_0x4a4cce(0x18b)](_0x18085a);else _0x2844d5[_0x4a4cce(0x21e)]>0x0&&_0x2558da['push'](_0x2844d5);}const _0x297d9e=_0x43f72e[_0x201d7f(0x207)](_0x193b0c=>_0x36c0d6(_0x193b0c));await Promise['all'](_0x297d9e),_0x2b2bf3[_0x201d7f(0x209)](_0x2558da);}),router[a0_0x1fc6e1(0x1c2)]('/barcode_scanner2',async(_0x561123,_0x231898)=>{var _0x16abc2=a0_0x1fc6e1;try{const {FromWareHouse:_0x176206,FromRoom:_0x296253,ToWarehouse:_0xcc3141,ToRoom:_0x7cfc22,secondary_code:_0x30bab2}=_0x561123[_0x16abc2(0x155)],_0x4fd87e=await warehouse[_0x16abc2(0x1f7)]([{'$match':{'name':_0x176206}},{'$unwind':_0x16abc2(0x182)},{'$match':{'product_details.secondary_code':_0x30bab2}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x16abc2(0x1d0)},'primary_code':{'$first':_0x16abc2(0x16e)},'secondary_code':{'$first':_0x16abc2(0x1ed)},'product_code':{'$first':_0x16abc2(0x1b4)},'instock':{'$first':_0x16abc2(0x186)},'warehouse':{'$first':'$name'},'level':{'$first':_0x16abc2(0x180)},'isle':{'$first':_0x16abc2(0x19e)},'pallet':{'$first':_0x16abc2(0x1aa)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x16abc2(0x223)}}}]);_0x231898[_0x16abc2(0x146)](0xc8)['json'](_0x4fd87e);}catch(_0x50858c){_0x231898['status'](0x194)['json']({'message':_0x50858c[_0x16abc2(0x1da)]});}}),router[a0_0x1fc6e1(0x1c2)](a0_0x1fc6e1(0x214),async(_0x537ce5,_0xfd2fe7)=>{var _0x434a39=a0_0x1fc6e1;try{const {FromWareHouse:_0x38f1ea,FromRoom:_0x1d467b,ToWarehouse:_0x17a7a3,ToRoom:_0x4ac4f2,product_code:_0x457606}=_0x537ce5[_0x434a39(0x155)],_0x2f26de=await warehouse[_0x434a39(0x1f7)]([{'$match':{'name':_0x38f1ea}},{'$unwind':_0x434a39(0x182)},{'$match':{'product_details.product_code':_0x457606}},{'$group':{'_id':_0x434a39(0x206),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x434a39(0x16e)},'secondary_code':{'$first':_0x434a39(0x1ed)},'product_code':{'$first':_0x434a39(0x1b4)},'instock':{'$first':_0x434a39(0x186)},'warehouse':{'$first':'$name'},'level':{'$first':_0x434a39(0x180)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x434a39(0x17e)},'unit':{'$first':'$product_details.unit'}}}]);_0xfd2fe7[_0x434a39(0x146)](0xc8)[_0x434a39(0x209)](_0x2f26de);}catch(_0x10a5c1){_0xfd2fe7[_0x434a39(0x146)](0x194)[_0x434a39(0x209)]({'message':_0x10a5c1[_0x434a39(0x1da)]});}}),router['post']('/CheckingWarehouse',async(_0x1087f4,_0x1f97db)=>{var _0x4725eb=a0_0x1fc6e1;const {level:_0x50e5a0,isle:_0x239b6b,pallet:_0x65c594,warehouses:_0x32a7b4,room:_0x149db3}=_0x1087f4['body'];try{const _0xc501a2=await warehouse[_0x4725eb(0x1f7)]([{'$match':{'name':_0x32a7b4,'room':_0x149db3}},{'$unwind':_0x4725eb(0x182)},{'$match':{'product_details.level':parseInt(_0x50e5a0),'product_details.isle':_0x239b6b,'product_details.pallet':parseInt(_0x65c594)}},{'$group':{'_id':_0x4725eb(0x206),'name':{'$first':_0x4725eb(0x1d0)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x4725eb(0x180)},'isle':{'$first':_0x4725eb(0x19e)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x4725eb(0x17e)}}}]);_0x1f97db[_0x4725eb(0x146)](0xc8)['json'](_0xc501a2);}catch(_0x3321d5){_0x1f97db[_0x4725eb(0x146)](0x194)['json']({'message':_0x3321d5['message']});}}),module[a0_0x1fc6e1(0x199)]=router;