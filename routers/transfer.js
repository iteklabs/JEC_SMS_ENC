var a0_0x1e15cd=a0_0x5eea;(function(_0x3abdd8,_0x2bd311){var _0x8fb002=a0_0x5eea,_0x417d71=_0x3abdd8();while(!![]){try{var _0x4f5b5a=-parseInt(_0x8fb002(0x20d))/0x1*(-parseInt(_0x8fb002(0x16a))/0x2)+-parseInt(_0x8fb002(0x1b2))/0x3*(-parseInt(_0x8fb002(0x1b1))/0x4)+-parseInt(_0x8fb002(0x245))/0x5+parseInt(_0x8fb002(0x18f))/0x6+parseInt(_0x8fb002(0x15f))/0x7+parseInt(_0x8fb002(0x152))/0x8+-parseInt(_0x8fb002(0x1c5))/0x9;if(_0x4f5b5a===_0x2bd311)break;else _0x417d71['push'](_0x417d71['shift']());}catch(_0x284ae3){_0x417d71['push'](_0x417d71['shift']());}}}(a0_0x3602,0x5ea82));const express=require(a0_0x1e15cd(0x195)),app=express(),router=express[a0_0x1e15cd(0x17b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,email_settings,supervisor_settings}=require(a0_0x1e15cd(0x19b)),auth=require(a0_0x1e15cd(0x208)),users=require(a0_0x1e15cd(0x160)),nodemailer=require(a0_0x1e15cd(0x1a2));function a0_0x5eea(_0x3c32f8,_0x311d5b){var _0x360271=a0_0x3602();return a0_0x5eea=function(_0x5eeab0,_0x2960b9){_0x5eeab0=_0x5eeab0-0x152;var _0x43f234=_0x360271[_0x5eeab0];return _0x43f234;},a0_0x5eea(_0x3c32f8,_0x311d5b);}router[a0_0x1e15cd(0x17a)]('/view',auth,async(_0x189813,_0x1f3c5b)=>{var _0x34422e=a0_0x1e15cd;try{const {username:_0xa342d0,email:_0x1f115,role:_0x5ac331}=_0x189813[_0x34422e(0x21d)],_0x5639db=_0x189813[_0x34422e(0x21d)],_0x234e0d=await profile[_0x34422e(0x206)]({'email':_0x5639db[_0x34422e(0x1d1)]}),_0x397909=await master_shop[_0x34422e(0x15a)]();console['log'](_0x34422e(0x19d),_0x397909);let _0x26e00c;if(_0x5639db[_0x34422e(0x225)]==_0x34422e(0x20c)){const _0x2a7de3=await staff[_0x34422e(0x206)]({'email':_0x5639db['email']});_0x26e00c=await transfers[_0x34422e(0x15a)]({'from_warehouse':_0x2a7de3[_0x34422e(0x1ce)]});}else _0x26e00c=await transfers[_0x34422e(0x24a)]([{'$unwind':_0x34422e(0x1ee)},{'$group':{'_id':_0x34422e(0x1e0),'invoice':{'$first':'$invoice'},'date':{'$first':_0x34422e(0x1b0)},'from_warehouse':{'$first':_0x34422e(0x18b)},'to_warehouse':{'$first':_0x34422e(0x1c4)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x34422e(0x157)},'finalize':{'$first':_0x34422e(0x154)},'isAllowEdit':{'$first':_0x34422e(0x169)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x397909[0x0][_0x34422e(0x1ad)]==_0x34422e(0x235)){var _0x2bc7fc=users[_0x34422e(0x173)];console[_0x34422e(0x1e1)](_0x2bc7fc);}else{if(_0x397909[0x0]['language']=='Hindi')var _0x2bc7fc=users[_0x34422e(0x1bf)];else{if(_0x397909[0x0][_0x34422e(0x1ad)]=='German')var _0x2bc7fc=users[_0x34422e(0x23a)];else{if(_0x397909[0x0][_0x34422e(0x1ad)]==_0x34422e(0x23b))var _0x2bc7fc=users[_0x34422e(0x23b)];else{if(_0x397909[0x0]['language']==_0x34422e(0x1ba))var _0x2bc7fc=users['French'];else{if(_0x397909[0x0]['language']==_0x34422e(0x1e7))var _0x2bc7fc=users['Portuguese'];else{if(_0x397909[0x0][_0x34422e(0x1ad)]=='Chinese')var _0x2bc7fc=users[_0x34422e(0x159)];else{if(_0x397909[0x0][_0x34422e(0x1ad)]=='Arabic\x20(ae)')var _0x2bc7fc=users['Arabic'];}}}}}}}_0x1f3c5b['render'](_0x34422e(0x232),{'success':_0x189813['flash'](_0x34422e(0x241)),'errors':_0x189813[_0x34422e(0x20a)](_0x34422e(0x178)),'role':_0x5639db,'profile':_0x234e0d,'master_shop':_0x397909,'transfer':_0x26e00c,'language':_0x2bc7fc});}catch(_0x1a6d90){console[_0x34422e(0x1e1)](_0x1a6d90);}});async function getRandom8DigitNumber(){var _0x22a1e6=a0_0x1e15cd;const _0x99e0cb=0x989680,_0x28b11d=0x5f5e0ff,_0x1dac8b=Math['floor'](Math[_0x22a1e6(0x1e2)]()*(_0x28b11d-_0x99e0cb+0x1))+_0x99e0cb;var _0x1d24cc;const _0x1e0017=await transfers[_0x22a1e6(0x206)]({'invoice':_0x22a1e6(0x175)+_0x1dac8b});return _0x1e0017&&_0x1e0017[_0x22a1e6(0x213)]>0x0?_0x1d24cc=_0x22a1e6(0x175)+_0x1dac8b:_0x1d24cc=_0x22a1e6(0x175)+_0x1dac8b,_0x1d24cc;}function a0_0x3602(){var _0x16038b=['product','$to_warehouse','9067059QrqUdy','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.product_stock','$product_details.unit','bin','post','getMonth','product_code','edit_transfer','warehouse','DRY\x20STORAGE','\x20<>\x20','email','to_room_name','to_room','body','edit_transfer_view','$product_details._id','slice','Transfer\x20Mail','to_types','/barcode_scanner','production_date','to_prod_pallet','$room','New_Qty_Converted','from_rack','$_id','log','random','/barcode_scanner3','note','$product_details.level','</span>','Portuguese\x20(BR)','from_quantity','product_stock','Shelves','$name','<tr>','Raw\x20Materials','$product','Level','split','$product_details.bay','$product_details.maxPerUnit','Rack\x20D','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','to_prod_qty','batch_code','</tr>','</div>','from_warehouse','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.rack','from_invoice','$product_details.secondary_code','$product_details.primary_code','to_prod_isle','concat','date','secondary_code','Arabic\x20(ae)','</td>','/preview/:id','findOne','<div>','../middleware/auth','password','flash','type','staff','293LskfFU','$product_details.isle','id_transaction','$product_details.pallet','from_bay','RMSEmail','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.storage','Receiving\x20Area','<html><head><title></title>','Error\x20Occurs','unit','status','Return\x20Rooms','Enclosed','user','$product_details.type','render','invoice','save','\x20Order\x20Number\x20:\x20','to_bin','rak','role','toString','secondary_unit','port','product_code3','Logo.png','from_room_name','primary_unit','/barcode_scanner2','createTransport','bay','to_quantity','maxProducts','transfer','getDate','logo','English\x20(US)','$product_details.batch_code','/picking_list/PDF_transfer_rm/','prod_name','from_prod_qty','German','Spanish','from_bin','<h5\x20style=\x22text-align:\x20left;\x22>','to_prod_level','<!DOCTYPE\x20html>','map','success','\x20</h2>','Portuguese','expiry_date','3192600sXJozV','primary_code','<span\x20style=\x22float:\x20right;\x22>','\x20Order\x20Date\x20:\x20','catch','aggregate','4786056NmElOw','$product_details.bin','$finalize','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product.to_room_name','to_bay','Chinese','find','product_details','Rack\x20E','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','json','2640092PNYFwQ','../public/language/languages.json','to_floorlevel','id_transaction_id','string','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Rack\x20B','To_invoice','$product_details.secondary_unit','$isAllowEdit','2980BFXjHV','ToRoomAssigned','from_floorlevel','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Floor','</tbody>','$product_details.product_name','prod_cat','English','from_storage','TRF-','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','errors','Enabled','get','Router','Ambient','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</thead>','from_prod_level','/view/:id','</h5>','$product_details.expiry_date','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','_id','from_room','then','sendMail','product_name','$product_details','site_title','$from_warehouse','/CheckingWarehouse','to_warehouse','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','3112920RiKZae','error','storage','from_types','Rack\x20A','/transfer/preview/','express','all','from_prod_pallet','Rack\x20F','rack','params','../models/all_models','Transfer\x20Finalize\x20Successfully','master','padStart','max_per_unit','$product_details.product_code','$product_details.floorlevel','nodemailer','forEach','back','image','<h5>','getFullYear','redirect','to_invoice','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.invoice','push','language','from_prod_isle','findById','$date','312VANoMy','3957tGCSjj','RoomAssigned','here','Arabic','/view/add_transfer','maxperunit','/../public','/transfer/view','French','An\x20error\x20occurred.','floorlevel','</table>','<tbody\x20style=\x22text-align:\x20center;\x22>','Hindi','$product_details.maxProducts','filter','MaxStocks_data2'];a0_0x3602=function(){return _0x16038b;};return a0_0x3602();}router[a0_0x1e15cd(0x17a)](a0_0x1e15cd(0x1b6),auth,async(_0x154c27,_0x1f7722)=>{var _0x3c815f=a0_0x1e15cd;try{const {username:_0x105532,email:_0x1c9715,role:_0x6a0e6d}=_0x154c27[_0x3c815f(0x21d)],_0x3e0536=_0x154c27[_0x3c815f(0x21d)],_0x403d3d=await profile[_0x3c815f(0x206)]({'email':_0x3e0536['email']}),_0x5db9c4=await master_shop[_0x3c815f(0x15a)]();console[_0x3c815f(0x1e1)]('master',_0x5db9c4);let _0x22454b;if(_0x3e0536[_0x3c815f(0x225)]==_0x3c815f(0x20c)){const _0x2e8ebe=await staff[_0x3c815f(0x206)]({'email':_0x3e0536[_0x3c815f(0x1d1)]});_0x22454b=await warehouse['aggregate']([{'$match':{'status':_0x3c815f(0x179),'name':_0x2e8ebe[_0x3c815f(0x1ce)],'warehouse_category':_0x3c815f(0x1ed)}},{'$group':{'_id':_0x3c815f(0x1eb),'name':{'$first':_0x3c815f(0x1eb)}}}]);}else _0x22454b=await warehouse[_0x3c815f(0x24a)]([{'$match':{'status':_0x3c815f(0x179),'warehouse_category':_0x3c815f(0x1ed)}},{'$group':{'_id':_0x3c815f(0x1eb),'name':{'$first':_0x3c815f(0x1eb)}}}]);var _0x238019=[_0x3c815f(0x17c),_0x3c815f(0x21c),_0x3c815f(0x21b)];const _0x3368cd=await transfers[_0x3c815f(0x15a)]({}),_0x12c948=_0x3368cd[_0x3c815f(0x213)]+0x1,_0x33139b='TRF-'+_0x12c948[_0x3c815f(0x226)]()[_0x3c815f(0x19e)](0x5,'0');if(_0x5db9c4[0x0][_0x3c815f(0x1ad)]=='English\x20(US)'){var _0xd1c1e5=users[_0x3c815f(0x173)];console[_0x3c815f(0x1e1)](_0xd1c1e5);}else{if(_0x5db9c4[0x0][_0x3c815f(0x1ad)]==_0x3c815f(0x1bf))var _0xd1c1e5=users[_0x3c815f(0x1bf)];else{if(_0x5db9c4[0x0][_0x3c815f(0x1ad)]=='German')var _0xd1c1e5=users['German'];else{if(_0x5db9c4[0x0]['language']==_0x3c815f(0x23b))var _0xd1c1e5=users[_0x3c815f(0x23b)];else{if(_0x5db9c4[0x0]['language']==_0x3c815f(0x1ba))var _0xd1c1e5=users[_0x3c815f(0x1ba)];else{if(_0x5db9c4[0x0][_0x3c815f(0x1ad)]=='Portuguese\x20(BR)')var _0xd1c1e5=users[_0x3c815f(0x243)];else{if(_0x5db9c4[0x0][_0x3c815f(0x1ad)]==_0x3c815f(0x159))var _0xd1c1e5=users[_0x3c815f(0x159)];else{if(_0x5db9c4[0x0]['language']==_0x3c815f(0x203))var _0xd1c1e5=users[_0x3c815f(0x1b5)];}}}}}}}const _0x3e0ca1=getRandom8DigitNumber();_0x3e0ca1[_0x3c815f(0x186)](_0x5718e5=>{var _0x5a82a7=_0x3c815f;_0x1f7722['render']('add_transfer',{'success':_0x154c27[_0x5a82a7(0x20a)](_0x5a82a7(0x241)),'errors':_0x154c27[_0x5a82a7(0x20a)](_0x5a82a7(0x178)),'role':_0x3e0536,'profile':_0x403d3d,'master_shop':_0x5db9c4,'warehouse':_0x22454b,'language':_0xd1c1e5,'rooms_data':_0x238019,'invoice':_0x5718e5});})[_0x3c815f(0x249)](_0xee5cd=>{var _0x275ace=_0x3c815f;_0x154c27['flash'](_0x275ace(0x178),_0x275ace(0x1c6)),_0x1f7722['redirect'](_0x275ace(0x1b9));});}catch(_0x24dfea){console[_0x3c815f(0x1e1)](_0x24dfea);}}),router[a0_0x1e15cd(0x1ca)]('/view/add_transfer',auth,async(_0xd6b1f6,_0x129e77)=>{var _0x14cb98=a0_0x1e15cd;try{console['log'](_0xd6b1f6['body']);const {date:_0x4eb7e,from_warehouse:_0x3bcd51,FromRoom_name:_0x246e73,to_warehouse:_0x36bf2f,ToRoom_name:_0x5fce22,prod_name:_0x5978a1,from_prod_qty:_0x2db139,from_prod_level:_0xa406aa,from_prod_isle:_0x554676,from_prod_pallet:_0x3abe8f,to_prod_qty:_0x4b1a88,to_prod_level:_0x3c37a9,to_prod_isle:_0xa28a16,to_prod_pallet:_0x4f279d,primary_code:_0x548d30,secondary_code:_0x46fb2a,product_code3:_0x3e2724,note:_0x5a9da9,MaxStocks_data2:_0x35bf29,invoice:_0x42489f,expiry_date:_0x1aaf2e}=_0xd6b1f6['body'];if(typeof _0x5978a1==_0x14cb98(0x163))var _0x4c8669=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x238)]],_0x5eb60f=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x239)]],_0x49cc2b=[_0xd6b1f6[_0x14cb98(0x1d4)]['from_prod_level']],_0xa1c40e=[_0xd6b1f6[_0x14cb98(0x1d4)]['New_Qty_Converted']],_0xabfda0=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x23e)]],_0x51e144=[_0xd6b1f6[_0x14cb98(0x1d4)]['primary_code']],_0x2a9915=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x202)]],_0x49855c=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x229)]],_0x36dc7f=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1c2)]],_0x282260=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x22c)]],_0xdddbe0=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x227)]],_0x471218=[_0xd6b1f6[_0x14cb98(0x1d4)]['batch_code']],_0x4e5121=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x244)]],_0x34406a=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x19f)]],_0x2c4890=[_0xd6b1f6['body'][_0x14cb98(0x1db)]],_0x5837cd=[_0xd6b1f6['body'][_0x14cb98(0x172)]],_0x3c7ed=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1b3)]],_0x12e58a=[_0xd6b1f6['body'][_0x14cb98(0x16b)]],_0x1eaff9=[_0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1fc)]],_0x5c377d=[_0xd6b1f6[_0x14cb98(0x1d4)]['to_invoice']],_0xf5239d=[_0xd6b1f6['body'][_0x14cb98(0x20f)]];else var _0x4c8669=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x238)]],_0x5eb60f=[..._0xd6b1f6[_0x14cb98(0x1d4)]['from_prod_qty']],_0x49cc2b=[..._0xd6b1f6[_0x14cb98(0x1d4)]['from_prod_level']],_0xa1c40e=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1de)]],_0xabfda0=[..._0xd6b1f6[_0x14cb98(0x1d4)]['to_prod_level']],_0x51e144=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x246)]],_0x2a9915=[..._0xd6b1f6[_0x14cb98(0x1d4)]['secondary_code']],_0x49855c=[..._0xd6b1f6['body'][_0x14cb98(0x229)]],_0x36dc7f=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1c2)]],_0x282260=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x22c)]],_0xdddbe0=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x227)]],_0x471218=[..._0xd6b1f6['body']['batch_code']],_0x4e5121=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x244)]],_0x34406a=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x19f)]],_0x2c4890=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1db)]],_0x5837cd=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x172)]],_0x3c7ed=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1b3)]],_0x12e58a=[..._0xd6b1f6['body'][_0x14cb98(0x16b)]],_0x1eaff9=[..._0xd6b1f6[_0x14cb98(0x1d4)]['from_invoice']],_0x5c377d=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x1a9)]],_0xf5239d=[..._0xd6b1f6[_0x14cb98(0x1d4)][_0x14cb98(0x20f)]];const _0x279ff2=_0x4c8669['map'](_0xec74a7=>{return _0xec74a7={'product_name':_0xec74a7};});_0x5eb60f[_0x14cb98(0x1a3)]((_0x215d6b,_0x2a7898)=>{var _0x41376e=_0x14cb98;_0x279ff2[_0x2a7898][_0x41376e(0x1e8)]=_0x215d6b;}),_0x1eaff9[_0x14cb98(0x1a3)]((_0x12fc18,_0x3b83f3)=>{var _0x25488f=_0x14cb98;_0x279ff2[_0x3b83f3][_0x25488f(0x1fc)]=_0x12fc18;}),_0x5c377d['forEach']((_0xdc10e0,_0x5ce3a3)=>{_0x279ff2[_0x5ce3a3]['To_invoice']=_0xdc10e0;}),_0xf5239d[_0x14cb98(0x1a3)]((_0xb49b96,_0x27b0b8)=>{var _0x252670=_0x14cb98;_0x279ff2[_0x27b0b8][_0x252670(0x162)]=_0xb49b96;}),_0x49cc2b[_0x14cb98(0x1a3)]((_0x4d1b1d,_0x4a8849)=>{var _0x423b90=_0x14cb98;_0x3c7ed[_0x423b90(0x1a3)]((_0x47d676,_0x38c837)=>{var _0x14c1e5=_0x423b90;if(_0x47d676==_0x14c1e5(0x216)&&_0x4a8849==_0x38c837){var _0x463f8e=_0x4d1b1d[_0x14c1e5(0x1d7)](0x3);_0x279ff2[_0x4a8849][_0x14c1e5(0x174)]=_0x4d1b1d[0x0],_0x279ff2[_0x4a8849][_0x14c1e5(0x1df)]=_0x4d1b1d[0x1],_0x279ff2[_0x4a8849][_0x14c1e5(0x211)]=0x0,_0x279ff2[_0x4a8849][_0x14c1e5(0x23c)]=0x0,_0x279ff2[_0x4a8849]['from_types']=_0x14c1e5(0x16f),_0x279ff2[_0x4a8849][_0x14c1e5(0x16c)]=_0x463f8e;}else{if(_0x47d676==_0x14c1e5(0x1ea)&&_0x4a8849==_0x38c837){var _0x463f8e=_0x4d1b1d['slice'](0x3);_0x279ff2[_0x4a8849]['from_storage']=_0x4d1b1d[0x0],_0x279ff2[_0x4a8849][_0x14c1e5(0x1df)]=_0x4d1b1d[0x1],_0x279ff2[_0x4a8849]['from_bay']=0x0,_0x279ff2[_0x4a8849][_0x14c1e5(0x23c)]=0x0,_0x279ff2[_0x4a8849][_0x14c1e5(0x192)]=_0x14c1e5(0x16f),_0x279ff2[_0x4a8849][_0x14c1e5(0x16c)]=_0x4d1b1d[0x5];}else{if(_0x4a8849==_0x38c837){if(_0x4d1b1d[0x0]=='A'&&_0x4d1b1d[0x1]=='L'&&_0x4d1b1d[0x2]=='L')console['log'](_0x47d676+_0x14c1e5(0x1d0)+_0x4a8849+'\x20<>\x20'+_0x38c837+_0x14c1e5(0x1d0)+_0x4d1b1d+_0x14c1e5(0x1b4)),_0x279ff2[_0x4a8849]['from_storage']=_0x4d1b1d[0x0],_0x279ff2[_0x4a8849][_0x14c1e5(0x1df)]=_0x4d1b1d[0x1],_0x279ff2[_0x4a8849][_0x14c1e5(0x211)]=0x0,_0x279ff2[_0x4a8849][_0x14c1e5(0x23c)]=0x0,_0x279ff2[_0x4a8849][_0x14c1e5(0x192)]=_0x14c1e5(0x16f),_0x279ff2[_0x4a8849][_0x14c1e5(0x16c)]=_0x4d1b1d[0x3];else{var _0x3b260f;if(_0x4d1b1d[0x4]=='L')_0x3b260f=_0x14c1e5(0x1ef);else _0x4d1b1d[0x4]=='F'&&(_0x3b260f=_0x14c1e5(0x16f));_0x279ff2[_0x4a8849]['from_storage']=_0x4d1b1d[0x0],_0x279ff2[_0x4a8849][_0x14c1e5(0x1df)]=_0x4d1b1d[0x1],_0x279ff2[_0x4a8849][_0x14c1e5(0x211)]=_0x4d1b1d[0x2],_0x279ff2[_0x4a8849]['from_bin']=_0x4d1b1d[0x3],_0x279ff2[_0x4a8849][_0x14c1e5(0x192)]=_0x3b260f,_0x279ff2[_0x4a8849]['from_floorlevel']=_0x4d1b1d[0x5];}}}}});}),_0xa1c40e[_0x14cb98(0x1a3)]((_0x10e7fc,_0x530705)=>{var _0x1a6816=_0x14cb98;_0x279ff2[_0x530705][_0x1a6816(0x230)]=_0x10e7fc;}),_0xabfda0['forEach']((_0x11063a,_0x1dbd31)=>{var _0x83af99=_0x14cb98;_0x12e58a[_0x83af99(0x1a3)]((_0x317f1c,_0x294ce8)=>{var _0x22c181=_0x83af99;if(_0x317f1c=='Receiving\x20Area'&&_0x1dbd31==_0x294ce8){var _0x3db0cd=_0x11063a[_0x22c181(0x1d7)](0x3);_0x279ff2[_0x1dbd31][_0x22c181(0x191)]=_0x11063a[0x0],_0x279ff2[_0x1dbd31]['rack']=_0x11063a[0x1],_0x279ff2[_0x1dbd31]['to_bay']=0x0,_0x279ff2[_0x1dbd31][_0x22c181(0x223)]=0x0,_0x279ff2[_0x1dbd31][_0x22c181(0x1d9)]='Floor',_0x279ff2[_0x1dbd31]['to_floorlevel']=_0x3db0cd;}else{if(_0x317f1c==_0x22c181(0x1ea)&&_0x1dbd31==_0x294ce8){var _0x3db0cd=_0x11063a[_0x22c181(0x1d7)](0x3);_0x279ff2[_0x1dbd31][_0x22c181(0x191)]=_0x11063a[0x0],_0x279ff2[_0x1dbd31][_0x22c181(0x199)]=_0x11063a[0x1],_0x279ff2[_0x1dbd31][_0x22c181(0x158)]=0x0,_0x279ff2[_0x1dbd31][_0x22c181(0x223)]=0x0,_0x279ff2[_0x1dbd31]['to_types']=_0x22c181(0x16f),_0x279ff2[_0x1dbd31][_0x22c181(0x161)]=_0x11063a[0x5];}else{if(_0x1dbd31==_0x294ce8){if(_0x11063a[0x0]=='A'&&_0x11063a[0x1]=='L'&&_0x11063a[0x2]=='L')console[_0x22c181(0x1e1)](_0x317f1c+_0x22c181(0x1d0)+_0x1dbd31+'\x20<>\x20'+_0x294ce8+_0x22c181(0x1d0)+_0x11063a+_0x22c181(0x1b4)),_0x279ff2[_0x1dbd31][_0x22c181(0x191)]=_0x11063a[0x0],_0x279ff2[_0x1dbd31][_0x22c181(0x199)]=_0x11063a[0x1],_0x279ff2[_0x1dbd31][_0x22c181(0x158)]=0x0,_0x279ff2[_0x1dbd31][_0x22c181(0x223)]=0x0,_0x279ff2[_0x1dbd31][_0x22c181(0x1d9)]=_0x22c181(0x16f),_0x279ff2[_0x1dbd31][_0x22c181(0x161)]=_0x11063a[0x3];else{var _0x9bce92;if(_0x11063a[0x4]=='L')_0x9bce92='Level';else _0x11063a[0x4]=='F'&&(_0x9bce92=_0x22c181(0x16f));_0x279ff2[_0x1dbd31][_0x22c181(0x191)]=_0x11063a[0x0],_0x279ff2[_0x1dbd31][_0x22c181(0x199)]=_0x11063a[0x1],_0x279ff2[_0x1dbd31][_0x22c181(0x158)]=_0x11063a[0x2],_0x279ff2[_0x1dbd31][_0x22c181(0x223)]=_0x11063a[0x3],_0x279ff2[_0x1dbd31]['to_types']=_0x9bce92,_0x279ff2[_0x1dbd31][_0x22c181(0x161)]=_0x11063a[0x5];}}}}});}),_0x51e144[_0x14cb98(0x1a3)]((_0x311589,_0x45341b)=>{var _0x2bc9b9=_0x14cb98;_0x279ff2[_0x45341b][_0x2bc9b9(0x246)]=_0x311589;}),_0x2a9915[_0x14cb98(0x1a3)]((_0x2e4710,_0x46bf2d)=>{var _0x251e84=_0x14cb98;_0x279ff2[_0x46bf2d][_0x251e84(0x202)]=_0x2e4710;}),_0x49855c['forEach']((_0x153269,_0x445b01)=>{var _0x13af54=_0x14cb98;_0x279ff2[_0x445b01][_0x13af54(0x1cc)]=_0x153269;}),_0x36dc7f['forEach']((_0x37a70a,_0x187a72)=>{_0x279ff2[_0x187a72]['maxProducts']=_0x37a70a;}),_0x282260[_0x14cb98(0x1a3)]((_0x2e29f8,_0x181fef)=>{_0x279ff2[_0x181fef]['unit']=_0x2e29f8;}),_0xdddbe0['forEach']((_0x201806,_0x52358c)=>{var _0x5d6c1c=_0x14cb98;_0x279ff2[_0x52358c][_0x5d6c1c(0x227)]=_0x201806;}),_0x471218[_0x14cb98(0x1a3)]((_0x5d9cc5,_0x315f6a)=>{var _0x225221=_0x14cb98;_0x279ff2[_0x315f6a][_0x225221(0x1f6)]=_0x5d9cc5;}),_0x4e5121[_0x14cb98(0x1a3)]((_0x17d787,_0x2cbf59)=>{var _0x55d0a5=_0x14cb98;_0x279ff2[_0x2cbf59][_0x55d0a5(0x244)]=_0x17d787;}),_0x34406a[_0x14cb98(0x1a3)]((_0x5dd542,_0x26c032)=>{var _0x5630c6=_0x14cb98;_0x279ff2[_0x26c032][_0x5630c6(0x1b7)]=_0x5dd542;}),_0x2c4890[_0x14cb98(0x1a3)]((_0x3a8366,_0x13340a)=>{var _0x218a1e=_0x14cb98;_0x279ff2[_0x13340a][_0x218a1e(0x1db)]=_0x3a8366;}),_0x5837cd[_0x14cb98(0x1a3)]((_0x435277,_0xf2ec2d)=>{_0x279ff2[_0xf2ec2d]['prod_cat']=_0x435277;}),_0x3c7ed[_0x14cb98(0x1a3)]((_0x3d2b83,_0x4f678f)=>{var _0x3bf5a6=_0x14cb98;_0x279ff2[_0x4f678f][_0x3bf5a6(0x22b)]=_0x3d2b83;}),_0x12e58a[_0x14cb98(0x1a3)]((_0x4a0e05,_0x3e42c0)=>{var _0x16a2fc=_0x14cb98;_0x279ff2[_0x3e42c0][_0x16a2fc(0x1d2)]=_0x4a0e05;});const _0x598e2f=_0x279ff2[_0x14cb98(0x1c1)](_0xa5ac8b=>_0xa5ac8b[_0x14cb98(0x230)]!=='0'&&_0xa5ac8b[_0x14cb98(0x230)]!==''||_0xa5ac8b['to_floorlevel']!=='0'&&_0xa5ac8b['to_floorlevel']!==''),_0x2b45ba=new transfers({'date':_0x4eb7e,'from_warehouse':_0x3bcd51,'to_warehouse':_0x36bf2f,'product':_0x598e2f,'note':_0x5a9da9,'invoice':_0x42489f}),_0x3aae2a=await _0x2b45ba[_0x14cb98(0x221)]();_0xd6b1f6[_0x14cb98(0x20a)](_0x14cb98(0x241),'Product\x20Transfer\x20successfully'),_0x129e77['redirect'](_0x14cb98(0x194)+_0x3aae2a[_0x14cb98(0x184)]);}catch(_0xcef0bd){console[_0x14cb98(0x1e1)](_0xcef0bd),_0x129e77[_0x14cb98(0x21a)](0xc8)['json']({'errorMessage':_0xcef0bd[_0x14cb98(0x164)]});}}),router[a0_0x1e15cd(0x17a)](a0_0x1e15cd(0x205),auth,async(_0x8b8ab5,_0x161c2c)=>{var _0x2626ad=a0_0x1e15cd;try{const {username:_0xbb3061,email:_0x384f99,role:_0x4adc1d}=_0x8b8ab5['user'],_0x5b33ab=_0x8b8ab5[_0x2626ad(0x21d)],_0x314f48=await profile[_0x2626ad(0x206)]({'email':_0x5b33ab[_0x2626ad(0x1d1)]}),_0x23d292=await master_shop[_0x2626ad(0x15a)]();console['log'](_0x2626ad(0x19d),_0x23d292);const _0x13b938=await transfers['findById'](_0x8b8ab5['params']['id']);let _0x18d852=new Date(_0x13b938[_0x2626ad(0x244)]),_0x35c359=('0'+_0x18d852[_0x2626ad(0x233)]())[_0x2626ad(0x1d7)](-0x2),_0x1bf4ed=('0'+(_0x18d852[_0x2626ad(0x1cb)]()+0x1))[_0x2626ad(0x1d7)](-0x2),_0x336286=_0x18d852[_0x2626ad(0x1a7)](),_0x183152=_0x336286+'-'+_0x1bf4ed+'-'+_0x35c359,_0x151e49;if(_0x5b33ab['role']==_0x2626ad(0x20c)){const _0x33ab94=await staff['findOne']({'email':_0x5b33ab[_0x2626ad(0x1d1)]});_0x151e49=await warehouse['find']({'status':'Enabled','name':_0x33ab94[_0x2626ad(0x1ce)],'warehouse_category':_0x2626ad(0x1ed)});}else _0x151e49=await warehouse[_0x2626ad(0x15a)]({'status':'Enabled','warehouse_category':_0x2626ad(0x1ed)});const _0x13a313=await warehouse['aggregate']([{'$match':{'name':_0x13b938['from_warehouse']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2626ad(0x1d6),'name':{'$first':_0x2626ad(0x171)},'product_stock':{'$first':_0x2626ad(0x1c7)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2626ad(0x153)},'type':{'$first':_0x2626ad(0x21e)},'floorlevel':{'$first':_0x2626ad(0x1a1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2626ad(0x1fd)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2626ad(0x215)},'rack':{'$first':_0x2626ad(0x1fb)},'expiry_date':{'$first':_0x2626ad(0x182)},'production_date':{'$first':_0x2626ad(0x16d)},'room':{'$first':_0x2626ad(0x1dd)}}}]);if(_0x23d292[0x0]['language']==_0x2626ad(0x235)){var _0x4643d1=users[_0x2626ad(0x173)];console[_0x2626ad(0x1e1)](_0x4643d1);}else{if(_0x23d292[0x0][_0x2626ad(0x1ad)]==_0x2626ad(0x1bf))var _0x4643d1=users[_0x2626ad(0x1bf)];else{if(_0x23d292[0x0][_0x2626ad(0x1ad)]==_0x2626ad(0x23a))var _0x4643d1=users[_0x2626ad(0x23a)];else{if(_0x23d292[0x0][_0x2626ad(0x1ad)]==_0x2626ad(0x23b))var _0x4643d1=users['Spanish'];else{if(_0x23d292[0x0][_0x2626ad(0x1ad)]==_0x2626ad(0x1ba))var _0x4643d1=users['French'];else{if(_0x23d292[0x0][_0x2626ad(0x1ad)]==_0x2626ad(0x1e7))var _0x4643d1=users[_0x2626ad(0x243)];else{if(_0x23d292[0x0]['language']=='Chinese')var _0x4643d1=users[_0x2626ad(0x159)];else{if(_0x23d292[0x0]['language']==_0x2626ad(0x203))var _0x4643d1=users[_0x2626ad(0x1b5)];}}}}}}}_0x161c2c[_0x2626ad(0x21f)](_0x2626ad(0x1d5),{'success':_0x8b8ab5['flash'](_0x2626ad(0x241)),'errors':_0x8b8ab5[_0x2626ad(0x20a)](_0x2626ad(0x178)),'role':_0x5b33ab,'profile':_0x314f48,'master_shop':_0x23d292,'warehouse':_0x151e49,'transfer':_0x13b938,'stock':_0x13a313,'language':_0x4643d1});}catch(_0x2b1024){console[_0x2626ad(0x1e1)](_0x2b1024);}}),router[a0_0x1e15cd(0x1ca)]('/preview/:id',auth,async(_0x41f7bd,_0x4989e8)=>{var _0x23df34=a0_0x1e15cd;try{const _0x10627d=_0x41f7bd['params']['id'],{from_warehouse:_0x2c1537,FromRoom_name:_0x49d79c,to_warehouse:_0x174357,ToRoom_name:_0x48adb3}=_0x41f7bd[_0x23df34(0x1d4)],_0x4171f3=await transfers[_0x23df34(0x1af)]({'_id':_0x10627d}),_0x1f9014=_0x4171f3[_0x23df34(0x1c3)][_0x23df34(0x240)](async _0x446959=>{var _0x124c4e=_0x23df34;if(_0x446959[_0x124c4e(0x230)]>0x0){var _0x2bc86f=await warehouse[_0x124c4e(0x206)]({'name':_0x4171f3[_0x124c4e(0x1f9)],'room':_0x446959['from_room_name'],'warehouse_category':_0x124c4e(0x1ed)});const _0x212009=_0x2bc86f[_0x124c4e(0x15b)][_0x124c4e(0x240)](_0x41eb6a=>{var _0x1f288f=_0x124c4e;_0x41eb6a['product_name']==_0x446959[_0x1f288f(0x188)]&&_0x41eb6a[_0x1f288f(0x1bc)]==_0x446959[_0x1f288f(0x16c)]&&_0x41eb6a[_0x1f288f(0x20b)]==_0x446959[_0x1f288f(0x192)]&&_0x41eb6a['bin']==_0x446959[_0x1f288f(0x23c)]&&_0x41eb6a[_0x1f288f(0x22f)]==_0x446959['from_bay']&&_0x41eb6a['rack']==_0x446959['from_rack']&&_0x41eb6a[_0x1f288f(0x191)]==_0x446959[_0x1f288f(0x174)]&&_0x41eb6a[_0x1f288f(0x244)]==_0x446959[_0x1f288f(0x244)]&&_0x41eb6a[_0x1f288f(0x1f6)]==_0x446959[_0x1f288f(0x1f6)]&&_0x41eb6a[_0x1f288f(0x1db)]==_0x446959[_0x1f288f(0x1db)]&&_0x41eb6a[_0x1f288f(0x220)]==_0x446959[_0x1f288f(0x1fc)]&&_0x41eb6a['_id']==_0x446959[_0x1f288f(0x162)]&&(_0x41eb6a[_0x1f288f(0x1e9)]=_0x41eb6a[_0x1f288f(0x1e9)]-_0x446959[_0x1f288f(0x230)]);});}return _0x2bc86f;});Promise[_0x23df34(0x196)](_0x1f9014)[_0x23df34(0x186)](async _0x4d65e1=>{var _0x341510=_0x23df34;try{for(const _0x4551b3 of _0x4d65e1){await _0x4551b3['save']();}try{const _0x71e80f=_0x4171f3[_0x341510(0x1c3)]['map'](async _0x391871=>{var _0x3ec790=_0x341510;if(_0x391871[_0x3ec790(0x230)]>0x0){var _0x5bc5d3=await warehouse[_0x3ec790(0x206)]({'name':_0x4171f3['to_warehouse'],'room':_0x391871['to_room_name'],'warehouse_category':_0x3ec790(0x1ed)}),_0x330afd=0x0;const _0x11845b=_0x5bc5d3[_0x3ec790(0x15b)][_0x3ec790(0x240)](_0x4e4115=>{var _0x608d98=_0x3ec790;_0x4e4115[_0x608d98(0x188)]==_0x391871[_0x608d98(0x188)]&&_0x4e4115['floorlevel']==_0x391871[_0x608d98(0x161)]&&_0x4e4115[_0x608d98(0x20b)]==_0x391871[_0x608d98(0x1d9)]&&_0x4e4115['bin']==_0x391871['to_bin']&&_0x4e4115[_0x608d98(0x22f)]==_0x391871[_0x608d98(0x158)]&&_0x4e4115[_0x608d98(0x199)]==_0x391871[_0x608d98(0x199)]&&_0x4e4115[_0x608d98(0x191)]==_0x391871[_0x608d98(0x191)]&&_0x4e4115[_0x608d98(0x244)]==_0x391871[_0x608d98(0x244)]&&_0x4e4115[_0x608d98(0x1f6)]==_0x391871[_0x608d98(0x1f6)]&&_0x4e4115[_0x608d98(0x1db)]==_0x391871[_0x608d98(0x1db)]&&_0x4e4115[_0x608d98(0x220)]==_0x391871[_0x608d98(0x167)]&&(_0x4e4115['product_stock']=_0x4e4115[_0x608d98(0x1e9)]+_0x391871[_0x608d98(0x230)],_0x330afd++);});_0x330afd=='0'&&(_0x5bc5d3['product_details']=_0x5bc5d3['product_details'][_0x3ec790(0x200)]({'product_name':_0x391871['product_name'],'product_stock':_0x391871['to_quantity'],'bay':_0x391871[_0x3ec790(0x158)],'bin':_0x391871['to_bin'],'type':_0x391871['to_types'],'floorlevel':_0x391871[_0x3ec790(0x161)],'storage':_0x391871[_0x3ec790(0x191)],'rack':_0x391871[_0x3ec790(0x199)],'product_code':_0x391871[_0x3ec790(0x1cc)],'primary_code':_0x391871[_0x3ec790(0x246)],'secondary_code':_0x391871[_0x3ec790(0x202)],'maxProducts':_0x391871['maxProducts'],'storage':_0x391871[_0x3ec790(0x191)],'rack':_0x391871[_0x3ec790(0x199)],'expiry_date':_0x391871[_0x3ec790(0x244)],'maxPerUnit':_0x391871['maxperunit'],'batch_code':_0x391871['batch_code'],'production_date':_0x391871[_0x3ec790(0x1db)]}));}return _0x5bc5d3;});Promise[_0x341510(0x196)](_0x71e80f)[_0x341510(0x186)](async _0x26408c=>{var _0x530ed9=_0x341510;try{for(const _0x200b67 of _0x26408c){await warehouse['updateOne']({'_id':_0x200b67[_0x530ed9(0x184)]},{'$addToSet':{'product_details':{'$each':_0x200b67['product_details']}}});}_0x4171f3['finalize']='True';const _0x3c6fb2=await _0x4171f3[_0x530ed9(0x221)](),_0x4686d4=await master_shop[_0x530ed9(0x15a)](),_0x59d555=await email_settings[_0x530ed9(0x206)](),_0x101566=await supervisor_settings[_0x530ed9(0x15a)]();var _0x190aa8=_0x4171f3['product'],_0x203d9d='',_0x22482e;for(_0x22482e in _0x190aa8){_0x203d9d+=_0x530ed9(0x1ec)+_0x530ed9(0x17d)+_0x190aa8[_0x22482e][_0x530ed9(0x188)]+'</td>'+_0x530ed9(0x17d)+_0x190aa8[_0x22482e][_0x530ed9(0x1cc)]+_0x530ed9(0x204)+_0x530ed9(0x17d)+_0x190aa8[_0x22482e][_0x530ed9(0x230)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x190aa8[_0x22482e][_0x530ed9(0x219)]+_0x530ed9(0x204)+_0x530ed9(0x17d)+_0x190aa8[_0x22482e][_0x530ed9(0x227)]+'</td>'+_0x530ed9(0x17d)+_0x4171f3[_0x530ed9(0x18d)]+_0x530ed9(0x204)+_0x530ed9(0x17d)+_0x190aa8[_0x22482e][_0x530ed9(0x1d2)]+'</td>'+_0x530ed9(0x17d)+_0x190aa8[_0x22482e][_0x530ed9(0x191)]+_0x190aa8[_0x22482e][_0x530ed9(0x199)]+_0x190aa8[_0x22482e][_0x530ed9(0x158)]+_0x190aa8[_0x22482e][_0x530ed9(0x223)]+_0x190aa8[_0x22482e][_0x530ed9(0x1d9)][0x0]+_0x190aa8[_0x22482e][_0x530ed9(0x161)]+'</td>',_0x530ed9(0x1f7);}let _0x42261f=nodemailer[_0x530ed9(0x22e)]({'host':_0x59d555['host'],'port':Number(_0x59d555[_0x530ed9(0x228)]),'secure':![],'auth':{'user':_0x59d555['email'],'pass':_0x59d555[_0x530ed9(0x209)]}}),_0x31a742={'from':_0x59d555[_0x530ed9(0x1d1)],'to':_0x101566[0x0][_0x530ed9(0x212)],'subject':_0x530ed9(0x1d8),'attachments':[{'filename':_0x530ed9(0x22a),'path':__dirname+_0x530ed9(0x1b8)+'/upload/'+_0x4686d4[0x0][_0x530ed9(0x1a5)],'cid':_0x530ed9(0x234)}],'html':_0x530ed9(0x23f)+_0x530ed9(0x217)+'</head><body>'+_0x530ed9(0x207)+_0x530ed9(0x1fa)+_0x530ed9(0x207)+_0x530ed9(0x18e)+_0x530ed9(0x1f8)+_0x530ed9(0x207)+'<h2>\x20'+_0x4686d4[0x0][_0x530ed9(0x18a)]+_0x530ed9(0x242)+'</div>'+_0x530ed9(0x1f8)+'<hr\x20class=\x22my-3\x22>'+_0x530ed9(0x207)+_0x530ed9(0x23d)+_0x530ed9(0x222)+_0x4171f3['invoice']+'\x20'+_0x530ed9(0x247)+_0x530ed9(0x248)+_0x4171f3[_0x530ed9(0x201)]+'\x20'+_0x530ed9(0x1e6)+_0x530ed9(0x181)+_0x530ed9(0x1f8)+_0x530ed9(0x155)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x530ed9(0x214)+_0x530ed9(0x165)+_0x530ed9(0x16e)+_0x530ed9(0x1f4)+_0x530ed9(0x156)+_0x530ed9(0x15d)+_0x530ed9(0x177)+'</tr>'+_0x530ed9(0x17e)+_0x530ed9(0x1be)+'\x20'+_0x203d9d+'\x20'+_0x530ed9(0x170)+_0x530ed9(0x1bd)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x530ed9(0x1a6)+_0x4686d4[0x0][_0x530ed9(0x18a)]+'</h5>'+_0x530ed9(0x1f8)+_0x530ed9(0x1f8)+_0x530ed9(0x176)};_0x42261f[_0x530ed9(0x187)](_0x31a742,function(_0xb92665,_0x48bfa4){var _0x1c4af0=_0x530ed9;_0xb92665?(console[_0x1c4af0(0x1e1)](_0xb92665),console[_0x1c4af0(0x1e1)](_0x1c4af0(0x218))):console[_0x1c4af0(0x1e1)]('Email\x20sent\x20successfully');}),_0x41f7bd[_0x530ed9(0x20a)]('success',_0x530ed9(0x19c)),_0x4989e8[_0x530ed9(0x1a8)](_0x530ed9(0x237)+_0x3c6fb2[_0x530ed9(0x184)]);}catch(_0x492e87){console[_0x530ed9(0x190)](_0x492e87),_0x4989e8[_0x530ed9(0x21a)](0x1f4)[_0x530ed9(0x15e)]({'Perror':_0x530ed9(0x1aa),'message':_0x492e87['message']});}})['catch'](_0x1100da=>{var _0x1c2668=_0x341510;console[_0x1c2668(0x190)](_0x1100da),_0x4989e8[_0x1c2668(0x21a)](0x1f4)[_0x1c2668(0x15e)]({'Perror':_0x1c2668(0x1bb)});});}catch(_0x23fdda){_0x4989e8[_0x341510(0x15e)](_0x23fdda);}}catch(_0x29e7c8){console['error'](_0x29e7c8),_0x4989e8[_0x341510(0x21a)](0x1f4)[_0x341510(0x15e)]({'Merror':_0x341510(0x1aa),'Message':_0x29e7c8['message']});}})[_0x23df34(0x249)](_0x2744d3=>{var _0x336cc6=_0x23df34;console['error'](_0x2744d3),_0x4989e8[_0x336cc6(0x21a)](0x1f4)['json']({'Merror':'An\x20error\x20occurred.'});});}catch(_0x4824a9){console[_0x23df34(0x1e1)](_0x4824a9);}});function BayBinSelected(_0x190ea3,_0x4a0b17){var _0x2d8152=a0_0x1e15cd,_0x4bc266=[],_0x5bebc3=[],_0x35af0a=[],_0x388adf=[],_0x2c6c67=[],_0x5ac1e2=[];let _0x37f4ed=[];if(_0x190ea3==_0x2d8152(0x1cf))switch(_0x4a0b17){case _0x2d8152(0x193):_0x4bc266=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5bebc3=[0x1,0x2],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x1ef),'Floor'],_0x2c6c67=['D'],_0x5ac1e2=['A'];break;case _0x2d8152(0x166):_0x4bc266=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5bebc3=[0x1,0x2],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x1ef),_0x2d8152(0x16f)],_0x2c6c67=['D'],_0x5ac1e2=['B'];break;case _0x2d8152(0x1ea):_0x4bc266=[0x0],_0x5bebc3=[0x0],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x16f)],_0x2c6c67=['D'],_0x5ac1e2=['S'];break;case'Receiving\x20Area':_0x4bc266=[0x0],_0x5bebc3=[0x0],_0x388adf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x35af0a=['Floor'],_0x2c6c67=['D'],_0x5ac1e2=['R'];break;}else{if(_0x190ea3=='COLD\x20STORAGE')switch(_0x4a0b17){case _0x2d8152(0x193):_0x4bc266=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5bebc3=['B','F'],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x1ef),_0x2d8152(0x16f)],_0x2c6c67=['C'],_0x5ac1e2=['A'];break;case _0x2d8152(0x166):_0x4bc266=[0x5,0x4,0x3,0x2,0x1],_0x5bebc3=['F','B','S'],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x1ef),'Floor'],_0x2c6c67=['C'],_0x5ac1e2=['B'];break;case'Rack\x20C':_0x4bc266=[0x1,0x2,0x3,0x4,0x5],_0x5bebc3=['B','F','S'],_0x388adf=[0x5,0x4,0x3,0x2,0x1],_0x35af0a=[_0x2d8152(0x1ef),'Floor'],_0x2c6c67=['C'],_0x5ac1e2=['C'];break;case _0x2d8152(0x1f3):_0x4bc266=[0x5,0x4,0x3,0x2,0x1],_0x5bebc3=['F','B','S'],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x1ef),'Floor'],_0x2c6c67=['C'],_0x5ac1e2=['D'];break;case _0x2d8152(0x15c):_0x4bc266=[0x4,0x3,0x2,0x1],_0x5bebc3=[0x1,0x2],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=['Level',_0x2d8152(0x16f)],_0x2c6c67=['C'],_0x5ac1e2=['E'];break;case _0x2d8152(0x198):_0x4bc266=[0x1,0x2,0x3],_0x5bebc3=[0x1,0x2],_0x388adf=[0x1,0x2,0x3,0x4,0x5],_0x35af0a=[_0x2d8152(0x1ef)],_0x2c6c67=['C'],_0x5ac1e2=['F'];break;}}return{'levels':_0x4bc266,'Isle':_0x5bebc3,'rack':_0x388adf,'type':_0x35af0a,'storage':_0x2c6c67,'rak':_0x5ac1e2};}router[a0_0x1e15cd(0x17a)](a0_0x1e15cd(0x180),auth,async(_0x137d87,_0x40aad7)=>{var _0x1958e7=a0_0x1e15cd;try{const {username:_0x2bd362,email:_0x1a99c4,role:_0x51381f}=_0x137d87['user'],_0x1456ec=_0x137d87[_0x1958e7(0x21d)],_0x250a93=await profile[_0x1958e7(0x206)]({'email':_0x1456ec[_0x1958e7(0x1d1)]}),_0xa36f45=await master_shop[_0x1958e7(0x15a)](),_0x5431d7=await transfers['findById'](_0x137d87[_0x1958e7(0x19a)]['id']);let _0x2bc0c4;if(_0x1456ec['role']==_0x1958e7(0x20c)){const _0x419ba0=await staff[_0x1958e7(0x206)]({'email':_0x1456ec[_0x1958e7(0x1d1)]});_0x2bc0c4=await warehouse[_0x1958e7(0x24a)]([{'$match':{'status':_0x1958e7(0x179),'name':_0x419ba0[_0x1958e7(0x1ce)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x1958e7(0x1eb)}}}]);}else _0x2bc0c4=await warehouse[_0x1958e7(0x24a)]([{'$match':{'status':_0x1958e7(0x179),'warehouse_category':_0x1958e7(0x1ed)}},{'$group':{'_id':_0x1958e7(0x1eb),'name':{'$first':'$name'}}}]);const _0xe8d57a=await warehouse[_0x1958e7(0x24a)]([{'$match':{'name':_0x5431d7[_0x1958e7(0x1f9)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x1958e7(0x189)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1958e7(0x171)},'product_stock':{'$first':_0x1958e7(0x1c7)},'bay':{'$first':_0x1958e7(0x1f1)},'bin':{'$first':_0x1958e7(0x153)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1958e7(0x1a1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1958e7(0x1fd)},'product_code':{'$first':_0x1958e7(0x1a0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1958e7(0x1fb)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1958e7(0x16d)},'room':{'$first':_0x1958e7(0x1dd)}}}]),_0x28049a=await product[_0x1958e7(0x15a)]({}),_0x4c8673=BayBinSelected(_0x5431d7[_0x1958e7(0x18d)],_0x5431d7[_0x1958e7(0x1d3)]);if(_0xa36f45[0x0][_0x1958e7(0x1ad)]=='English\x20(US)'){var _0x550329=users[_0x1958e7(0x173)];console['log'](_0x550329);}else{if(_0xa36f45[0x0][_0x1958e7(0x1ad)]==_0x1958e7(0x1bf))var _0x550329=users[_0x1958e7(0x1bf)];else{if(_0xa36f45[0x0]['language']==_0x1958e7(0x23a))var _0x550329=users[_0x1958e7(0x23a)];else{if(_0xa36f45[0x0][_0x1958e7(0x1ad)]==_0x1958e7(0x23b))var _0x550329=users[_0x1958e7(0x23b)];else{if(_0xa36f45[0x0]['language']==_0x1958e7(0x1ba))var _0x550329=users[_0x1958e7(0x1ba)];else{if(_0xa36f45[0x0]['language']=='Portuguese\x20(BR)')var _0x550329=users[_0x1958e7(0x243)];else{if(_0xa36f45[0x0][_0x1958e7(0x1ad)]==_0x1958e7(0x159))var _0x550329=users[_0x1958e7(0x159)];else{if(_0xa36f45[0x0][_0x1958e7(0x1ad)]=='Arabic\x20(ae)')var _0x550329=users[_0x1958e7(0x1b5)];}}}}}}}_0x40aad7[_0x1958e7(0x21f)](_0x1958e7(0x1cd),{'success':_0x137d87[_0x1958e7(0x20a)](_0x1958e7(0x241)),'errors':_0x137d87['flash'](_0x1958e7(0x178)),'role':_0x1456ec,'profile':_0x250a93,'master_shop':_0xa36f45,'warehouse':_0x2bc0c4,'transfer':_0x5431d7,'stock':_0xe8d57a,'unit':_0x28049a,'language':_0x550329});}catch(_0xcf111a){console[_0x1958e7(0x1e1)](_0xcf111a);}}),router[a0_0x1e15cd(0x1ca)](a0_0x1e15cd(0x180),auth,async(_0x5abdc9,_0xa85eb7)=>{var _0x55f930=a0_0x1e15cd;try{const _0x460c04=_0x5abdc9[_0x55f930(0x19a)]['id'],_0x69721c=await transfers[_0x55f930(0x1af)](_0x460c04);_0xa85eb7[_0x55f930(0x15e)](_0x5abdc9[_0x55f930(0x1d4)]);return;const {date:_0x2a107e,from_warehouse:_0x1043d9,FromRoom_name:_0x499816,to_warehouse:_0x55de29,ToRoom_name:_0x25f4c4,prod_name:_0x3d4747,from_prod_qty:_0x5812b9,from_prod_level:_0x56a38e,from_prod_isle:_0x5b556e,from_prod_pallet:_0x589117,to_prod_qty:_0x352b9b,to_prod_level:_0x1b0ecd,to_prod_isle:_0xd43ab5,to_prod_pallet:_0x54fca9,primary_code:_0x2f8b7d,secondary_code:_0x392520,product_code3:_0x3ff94f,note:_0x116c77,invoice:_0x5963e6,expiry_date:_0x5999d7}=_0x5abdc9[_0x55f930(0x1d4)];if(typeof _0x3d4747==_0x55f930(0x163))var _0x38bdb8=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x238)]],_0x238d1c=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x239)]],_0x4c9127=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x17f)]],_0x56c23c=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1ae)]],_0x3d83c6=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x197)]],_0x45fb36=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x192)]],_0x49a93a=[_0x5abdc9[_0x55f930(0x1d4)]['to_prod_qty']],_0xba8df6=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x23e)]],_0x3b8561=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1ff)]],_0x2a4806=[_0x5abdc9[_0x55f930(0x1d4)]['to_prod_pallet']],_0x47f8b5=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1d9)]],_0x25fdf3=[_0x5abdc9['body'][_0x55f930(0x191)]],_0x164146=[_0x5abdc9[_0x55f930(0x1d4)]['rak']],_0x3f5553=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x246)]],_0x3cb10a=[_0x5abdc9['body']['secondary_code']],_0x5b4c1a=[_0x5abdc9['body'][_0x55f930(0x229)]],_0xea520=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1c2)]],_0x24cd5a=[_0x5abdc9[_0x55f930(0x1d4)]['unit']],_0x48c314=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x227)]],_0x17e253=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1f6)]],_0x1d2473=[_0x5abdc9[_0x55f930(0x1d4)]['expiry_date']],_0xbd78cf=[_0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x174)]],_0x518330=[_0x5abdc9['body']['from_rak']];else var _0x38bdb8=[..._0x5abdc9['body'][_0x55f930(0x238)]],_0x25fdf3=[..._0x5abdc9[_0x55f930(0x1d4)]['storage']],_0x164146=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x224)]],_0x45fb36=[..._0x5abdc9[_0x55f930(0x1d4)]['from_types']],_0x47f8b5=[..._0x5abdc9['body']['to_types']],_0x238d1c=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x239)]],_0x4c9127=[..._0x5abdc9['body'][_0x55f930(0x17f)]],_0x56c23c=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1ae)]],_0x3d83c6=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x197)]],_0x49a93a=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1f5)]],_0xba8df6=[..._0x5abdc9['body'][_0x55f930(0x23e)]],_0x3b8561=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1ff)]],_0x2a4806=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1dc)]],_0x3f5553=[..._0x5abdc9['body'][_0x55f930(0x246)]],_0x3cb10a=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x202)]],_0x5b4c1a=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x229)]],_0xea520=[..._0x5abdc9['body'][_0x55f930(0x1c2)]],_0x24cd5a=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x219)]],_0x48c314=[..._0x5abdc9['body'][_0x55f930(0x227)]],_0x17e253=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x1f6)]],_0x1d2473=[..._0x5abdc9[_0x55f930(0x1d4)]['expiry_date']],_0xbd78cf=[..._0x5abdc9[_0x55f930(0x1d4)][_0x55f930(0x174)]],_0x518330=[..._0x5abdc9[_0x55f930(0x1d4)]['from_rak']];const _0x3f90d0=_0x38bdb8[_0x55f930(0x240)](_0x34a0ee=>{return _0x34a0ee={'product_name':_0x34a0ee};});_0x238d1c[_0x55f930(0x1a3)]((_0x430366,_0x4b6dd9)=>{var _0x43622f=_0x55f930;_0x3f90d0[_0x4b6dd9][_0x43622f(0x1e8)]=_0x430366;}),_0x4c9127[_0x55f930(0x1a3)]((_0x7496ae,_0xf7ffec)=>{var _0x3a59e0=_0x55f930;_0x3f90d0[_0xf7ffec][_0x3a59e0(0x211)]=_0x7496ae;}),_0x56c23c[_0x55f930(0x1a3)]((_0x434069,_0x4ee3ed)=>{_0x3f90d0[_0x4ee3ed]['from_bin']=_0x434069;}),_0x3d83c6[_0x55f930(0x1a3)]((_0x447735,_0x498b29)=>{var _0x490d66=_0x55f930;_0x3f90d0[_0x498b29][_0x490d66(0x16c)]=_0x447735;}),_0x49a93a['forEach']((_0x3f52a8,_0x2ccab9)=>{_0x3f90d0[_0x2ccab9]['to_quantity']=_0x3f52a8;}),_0xba8df6['forEach']((_0x362afc,_0x1f2c2c)=>{_0x3f90d0[_0x1f2c2c]['to_bay']=_0x362afc;}),_0x3b8561[_0x55f930(0x1a3)]((_0xe46b63,_0x4874f5)=>{var _0x3b0dbc=_0x55f930;_0x3f90d0[_0x4874f5][_0x3b0dbc(0x223)]=_0xe46b63;}),_0x2a4806[_0x55f930(0x1a3)]((_0x1a68c4,_0x47b7c4)=>{var _0x1c4c8e=_0x55f930;_0x3f90d0[_0x47b7c4][_0x1c4c8e(0x161)]=_0x1a68c4;}),_0x3f5553['forEach']((_0x246927,_0x22ccd1)=>{var _0xba8fe=_0x55f930;_0x3f90d0[_0x22ccd1][_0xba8fe(0x246)]=_0x246927;}),_0x3cb10a[_0x55f930(0x1a3)]((_0x5730f0,_0x1b9877)=>{var _0x220e9a=_0x55f930;_0x3f90d0[_0x1b9877][_0x220e9a(0x202)]=_0x5730f0;}),_0x5b4c1a[_0x55f930(0x1a3)]((_0x3b2c46,_0x4a6267)=>{var _0x708cb4=_0x55f930;_0x3f90d0[_0x4a6267][_0x708cb4(0x1cc)]=_0x3b2c46;}),_0xea520['forEach']((_0x10fd50,_0x288aa2)=>{var _0x4e137e=_0x55f930;_0x3f90d0[_0x288aa2][_0x4e137e(0x231)]=_0x10fd50;}),_0x24cd5a[_0x55f930(0x1a3)]((_0x52be26,_0x4f2913)=>{var _0x3557f2=_0x55f930;_0x3f90d0[_0x4f2913][_0x3557f2(0x219)]=_0x52be26;}),_0x48c314[_0x55f930(0x1a3)]((_0x3f4214,_0x133852)=>{_0x3f90d0[_0x133852]['secondary_unit']=_0x3f4214;}),_0x17e253[_0x55f930(0x1a3)]((_0x26be0a,_0x15ec3a)=>{var _0x191a6a=_0x55f930;_0x3f90d0[_0x15ec3a][_0x191a6a(0x1f6)]=_0x26be0a;}),_0x1d2473[_0x55f930(0x1a3)]((_0x3ad923,_0x444b0d)=>{var _0x305657=_0x55f930;_0x3f90d0[_0x444b0d][_0x305657(0x244)]=_0x3ad923;}),_0x25fdf3['forEach']((_0x3d3c02,_0xe2322d)=>{var _0x4d6991=_0x55f930;_0x3f90d0[_0xe2322d][_0x4d6991(0x191)]=_0x3d3c02;}),_0x164146[_0x55f930(0x1a3)]((_0x119322,_0x598fbd)=>{var _0x1de216=_0x55f930;_0x3f90d0[_0x598fbd][_0x1de216(0x199)]=_0x119322;}),_0x45fb36[_0x55f930(0x1a3)]((_0x1005fa,_0x248960)=>{var _0x96e714=_0x55f930;_0x3f90d0[_0x248960][_0x96e714(0x192)]=_0x1005fa;}),_0x47f8b5[_0x55f930(0x1a3)]((_0xd60ba9,_0x5ad8ed)=>{var _0x552141=_0x55f930;_0x3f90d0[_0x5ad8ed][_0x552141(0x1d9)]=_0xd60ba9;}),_0xbd78cf[_0x55f930(0x1a3)]((_0xd37b19,_0x9d537f)=>{var _0x43bfcb=_0x55f930;_0x3f90d0[_0x9d537f][_0x43bfcb(0x174)]=_0xd37b19;}),_0x518330[_0x55f930(0x1a3)]((_0x38d952,_0x316f56)=>{var _0x2248c0=_0x55f930;_0x3f90d0[_0x316f56][_0x2248c0(0x1df)]=_0x38d952;});const _0x4576b9=_0x3f90d0['filter'](_0x1e5c43=>_0x1e5c43['to_quantity']!=='0'&&_0x1e5c43[_0x55f930(0x230)]!==''||_0x1e5c43[_0x55f930(0x161)]!=='0'&&_0x1e5c43[_0x55f930(0x161)]!=='');var _0x1d2c5a=0x0;_0x4576b9[_0x55f930(0x1a3)](_0x340a80=>{var _0x14dc66=_0x55f930;parseInt(_0x340a80[_0x14dc66(0x1e8)])<parseInt(_0x340a80[_0x14dc66(0x230)])&&_0x1d2c5a++;});if(_0x1d2c5a!=0x0)return _0x5abdc9['flash'](_0x55f930(0x178),_0x55f930(0x183)),_0xa85eb7[_0x55f930(0x1a8)](_0x55f930(0x1a4));const _0x1b883d=await warehouse['findOne']({'name':_0x69721c[_0x55f930(0x1f9)],'room':_0x69721c[_0x55f930(0x185)]});_0x69721c[_0x55f930(0x1c3)][_0x55f930(0x1a3)](_0x167236=>{var _0x141a4c=_0x55f930;if(_0x167236['to_quantity']>0x0){const _0x5dc8c5=_0x1b883d[_0x141a4c(0x15b)][_0x141a4c(0x240)](_0x4697dd=>{var _0x4c4de9=_0x141a4c;_0x4697dd[_0x4c4de9(0x188)]==_0x167236[_0x4c4de9(0x188)]&&_0x4697dd[_0x4c4de9(0x1bc)]==_0x167236[_0x4c4de9(0x16c)]&&_0x4697dd['type']==_0x167236[_0x4c4de9(0x192)]&&_0x4697dd['bin']==_0x167236[_0x4c4de9(0x23c)]&&_0x4697dd['bay']==_0x167236['from_bay']&&_0x4697dd[_0x4c4de9(0x199)]==_0x167236['from_rack']&&_0x4697dd[_0x4c4de9(0x191)]==_0x167236[_0x4c4de9(0x174)]&&(_0x4697dd[_0x4c4de9(0x1e9)]=parseInt(_0x4697dd[_0x4c4de9(0x1e9)])+parseInt(_0x167236[_0x4c4de9(0x230)]));});}}),await _0x1b883d['save']();const _0x59110b=await warehouse[_0x55f930(0x206)]({'name':_0x69721c[_0x55f930(0x18d)],'room':_0x69721c[_0x55f930(0x1d3)]});_0x69721c[_0x55f930(0x1c3)][_0x55f930(0x1a3)](_0x5f508b=>{var _0x45eacc=_0x55f930;if(_0x5f508b[_0x45eacc(0x230)]>0x0){const _0x3b0703=_0x59110b[_0x45eacc(0x15b)][_0x45eacc(0x240)](_0x44067a=>{var _0x3bf9bd=_0x45eacc;_0x44067a[_0x3bf9bd(0x188)]==_0x5f508b[_0x3bf9bd(0x188)]&&_0x44067a['floorlevel']==_0x5f508b[_0x3bf9bd(0x161)]&&_0x44067a[_0x3bf9bd(0x20b)]==_0x5f508b[_0x3bf9bd(0x1d9)]&&_0x44067a['bin']==_0x5f508b[_0x3bf9bd(0x223)]&&_0x44067a['bay']==_0x5f508b[_0x3bf9bd(0x158)]&&_0x44067a['rack']==_0x5f508b['rack']&&_0x44067a[_0x3bf9bd(0x191)]==_0x5f508b[_0x3bf9bd(0x191)]&&(_0x44067a[_0x3bf9bd(0x1e9)]=parseInt(_0x44067a[_0x3bf9bd(0x1e9)])-parseInt(_0x5f508b[_0x3bf9bd(0x230)]));});}}),await _0x59110b['save'](),_0x69721c['date']=_0x2a107e,_0x69721c[_0x55f930(0x1f9)]=_0x1043d9,_0x69721c[_0x55f930(0x18d)]=_0x55de29,_0x69721c[_0x55f930(0x1c3)]=_0x4576b9,_0x69721c[_0x55f930(0x1e4)]=_0x116c77,_0x69721c['invoice']=_0x5963e6;const _0x1ce5c3=await _0x69721c[_0x55f930(0x221)]();console['log'](_0x1ce5c3);const _0x145b36=await warehouse['findOne']({'name':_0x1043d9,'room':_0x499816});_0x1ce5c3[_0x55f930(0x1c3)][_0x55f930(0x1a3)](_0x183a01=>{var _0x30df76=_0x55f930;if(_0x183a01['to_quantity']>0x0){const _0x151ddc=_0x145b36[_0x30df76(0x15b)]['map'](_0x224451=>{var _0x489ce7=_0x30df76;_0x224451[_0x489ce7(0x188)]==_0x183a01[_0x489ce7(0x188)]&&_0x224451['floorlevel']==_0x183a01[_0x489ce7(0x16c)]&&_0x224451[_0x489ce7(0x20b)]==_0x183a01[_0x489ce7(0x192)]&&_0x224451[_0x489ce7(0x1c9)]==_0x183a01[_0x489ce7(0x23c)]&&_0x224451[_0x489ce7(0x22f)]==_0x183a01[_0x489ce7(0x211)]&&_0x224451[_0x489ce7(0x199)]==_0x183a01[_0x489ce7(0x1df)]&&_0x224451[_0x489ce7(0x191)]==_0x183a01[_0x489ce7(0x174)]&&(_0x224451[_0x489ce7(0x1e9)]=parseInt(_0x224451['product_stock'])-parseInt(_0x183a01[_0x489ce7(0x230)]));});}}),await _0x145b36['save']();const _0x1b8358=await warehouse[_0x55f930(0x206)]({'name':_0x55de29,'room':_0x25f4c4});_0x1ce5c3[_0x55f930(0x1c3)][_0x55f930(0x1a3)](_0x2a0930=>{var _0x496f13=_0x55f930;if(_0x2a0930[_0x496f13(0x230)]>0x0){var _0xf3f8eb=0x0;const _0x5bb122=_0x1b8358[_0x496f13(0x15b)][_0x496f13(0x240)](_0x1da09e=>{var _0x72d419=_0x496f13;_0x1da09e[_0x72d419(0x188)]==_0x2a0930[_0x72d419(0x188)]&&_0x1da09e[_0x72d419(0x1bc)]==_0x2a0930['to_floorlevel']&&_0x1da09e['type']==_0x2a0930[_0x72d419(0x1d9)]&&_0x1da09e[_0x72d419(0x1c9)]==_0x2a0930[_0x72d419(0x223)]&&_0x1da09e[_0x72d419(0x22f)]==_0x2a0930[_0x72d419(0x158)]&&_0x1da09e[_0x72d419(0x199)]==_0x2a0930['rack']&&_0x1da09e[_0x72d419(0x191)]==_0x2a0930[_0x72d419(0x191)]&&(_0x1da09e['product_stock']=parseInt(_0x1da09e[_0x72d419(0x1e9)])+parseInt(_0x2a0930[_0x72d419(0x230)]),_0xf3f8eb++);});_0xf3f8eb=='0'&&(_0x1b8358[_0x496f13(0x15b)]=_0x1b8358[_0x496f13(0x15b)][_0x496f13(0x200)]({'product_name':_0x2a0930[_0x496f13(0x188)],'product_stock':_0x2a0930[_0x496f13(0x230)],'bay':_0x2a0930[_0x496f13(0x158)],'bin':_0x2a0930[_0x496f13(0x223)],'type':_0x2a0930['to_types'],'floorlevel':_0x2a0930['to_floorlevel'],'storage':_0x2a0930[_0x496f13(0x191)],'rack':_0x2a0930['rack'],'product_code':_0x2a0930[_0x496f13(0x1cc)],'primary_code':_0x2a0930[_0x496f13(0x246)],'secondary_code':_0x2a0930[_0x496f13(0x202)],'maxProducts':_0x2a0930[_0x496f13(0x231)],'storage':_0x2a0930[_0x496f13(0x191)],'rack':_0x2a0930['rack']}));}}),await _0x1b8358[_0x55f930(0x221)](),_0x5abdc9[_0x55f930(0x20a)]('success','Transfer\x20Edit\x20Successfully'),_0xa85eb7[_0x55f930(0x1a8)](_0x55f930(0x1b9));}catch(_0x47e768){console[_0x55f930(0x1e1)](_0x47e768);}}),router[a0_0x1e15cd(0x1ca)](a0_0x1e15cd(0x1da),async(_0x4dc136,_0x3335ff)=>{var _0x3c1fe4=a0_0x1e15cd;const {FromWareHouse:_0x62beeb,FromRoom:_0xe96479,ToWarehouse:_0x391475,ToRoom:_0x20bf0d,primary_code:_0x4de653,Roomslist:_0x115c31}=_0x4dc136[_0x3c1fe4(0x1d4)],_0x37b1c3=_0x115c31[_0x3c1fe4(0x1f0)](','),_0x1553c0=[];async function _0x30c796(_0x4991ba){var _0x21ad95=_0x3c1fe4;const _0x5c5ace=await warehouse[_0x21ad95(0x24a)]([{'$match':{'name':_0x62beeb,'room':_0x4991ba}},{'$unwind':_0x21ad95(0x189)},{'$match':{'product_details.primary_code':_0x4de653}},{'$group':{'_id':_0x21ad95(0x1d6),'name':{'$first':_0x21ad95(0x171)},'instock':{'$first':_0x21ad95(0x1c7)},'primary_code':{'$first':_0x21ad95(0x1fe)},'secondary_code':{'$first':_0x21ad95(0x1fd)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x21ad95(0x1f1)},'isle':{'$first':_0x21ad95(0x153)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x21ad95(0x1a1)},'unit':{'$first':_0x21ad95(0x1c8)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x21ad95(0x215)},'rack':{'$first':_0x21ad95(0x1fb)},'expiry_date':{'$first':_0x21ad95(0x182)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'prod_cat':{'$first':'P'},'roomNamed':{'$first':_0x21ad95(0x1dd)},'maxProducts':{'$first':_0x21ad95(0x1c0)},'invoice_product':{'$first':_0x21ad95(0x1ab)}}}]),_0xb7301d=await warehouse[_0x21ad95(0x24a)]([{'$match':{'name':_0x62beeb,'room':_0x4991ba}},{'$unwind':_0x21ad95(0x189)},{'$match':{'product_details.secondary_code':_0x4de653}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x21ad95(0x171)},'instock':{'$first':_0x21ad95(0x1c7)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x21ad95(0x1fd)},'product_code':{'$first':_0x21ad95(0x1a0)},'level':{'$first':_0x21ad95(0x1f1)},'isle':{'$first':_0x21ad95(0x153)},'type':{'$first':_0x21ad95(0x21e)},'pallet':{'$first':_0x21ad95(0x1a1)},'unit':{'$first':_0x21ad95(0x1c8)},'secondary_unit':{'$first':_0x21ad95(0x168)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x21ad95(0x1fb)},'expiry_date':{'$first':_0x21ad95(0x182)},'production_date':{'$first':_0x21ad95(0x16d)},'batch_code':{'$first':_0x21ad95(0x236)},'maxPerUnit':{'$first':_0x21ad95(0x1f2)},'prod_cat':{'$first':'S'},'roomNamed':{'$first':_0x21ad95(0x1dd)},'maxProducts':{'$first':_0x21ad95(0x1c0)},'invoice_product':{'$first':_0x21ad95(0x1ab)}}}]);if(_0x5c5ace[_0x21ad95(0x213)]>0x0)_0x1553c0[_0x21ad95(0x1ac)](_0x5c5ace);else _0xb7301d['length']>0x0&&_0x1553c0['push'](_0xb7301d);}const _0x58710e=_0x37b1c3['map'](_0xf7dcd4=>_0x30c796(_0xf7dcd4));await Promise[_0x3c1fe4(0x196)](_0x58710e),_0x3335ff[_0x3c1fe4(0x15e)](_0x1553c0);}),router[a0_0x1e15cd(0x1ca)](a0_0x1e15cd(0x22d),async(_0x47f5e6,_0x5c580a)=>{var _0x33eb07=a0_0x1e15cd;try{const {FromWareHouse:_0x5513a4,FromRoom:_0x334fd5,ToWarehouse:_0x36968f,ToRoom:_0x2a7cb9,secondary_code:_0x358718}=_0x47f5e6['body'],_0x1c1af1=await warehouse[_0x33eb07(0x24a)]([{'$match':{'name':_0x5513a4}},{'$unwind':_0x33eb07(0x189)},{'$match':{'product_details.secondary_code':_0x358718}},{'$group':{'_id':_0x33eb07(0x1d6),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x33eb07(0x1fe)},'secondary_code':{'$first':_0x33eb07(0x1fd)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x33eb07(0x1c7)},'warehouse':{'$first':_0x33eb07(0x1eb)},'level':{'$first':_0x33eb07(0x1e5)},'isle':{'$first':_0x33eb07(0x20e)},'pallet':{'$first':_0x33eb07(0x210)},'maxProducts':{'$first':_0x33eb07(0x1c0)},'unit':{'$first':_0x33eb07(0x1c8)}}}]);_0x5c580a[_0x33eb07(0x21a)](0xc8)[_0x33eb07(0x15e)](_0x1c1af1);}catch(_0x1ee6fa){_0x5c580a[_0x33eb07(0x21a)](0x194)[_0x33eb07(0x15e)]({'message':_0x1ee6fa[_0x33eb07(0x164)]});}}),router[a0_0x1e15cd(0x1ca)](a0_0x1e15cd(0x1e3),async(_0x3ab474,_0x3921ef)=>{var _0x42aec3=a0_0x1e15cd;try{const {FromWareHouse:_0x276c24,FromRoom:_0x2a30e4,ToWarehouse:_0x324fe8,ToRoom:_0x5dd85b,product_code:_0x4d31d3}=_0x3ab474[_0x42aec3(0x1d4)],_0x4f977c=await warehouse['aggregate']([{'$match':{'name':_0x276c24}},{'$unwind':_0x42aec3(0x189)},{'$match':{'product_details.product_code':_0x4d31d3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x42aec3(0x171)},'primary_code':{'$first':_0x42aec3(0x1fe)},'secondary_code':{'$first':_0x42aec3(0x1fd)},'product_code':{'$first':_0x42aec3(0x1a0)},'instock':{'$first':_0x42aec3(0x1c7)},'warehouse':{'$first':_0x42aec3(0x1eb)},'level':{'$first':_0x42aec3(0x1e5)},'isle':{'$first':_0x42aec3(0x20e)},'pallet':{'$first':_0x42aec3(0x210)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x42aec3(0x1c8)}}}]);_0x3921ef['status'](0xc8)[_0x42aec3(0x15e)](_0x4f977c);}catch(_0x2333fb){_0x3921ef[_0x42aec3(0x21a)](0x194)[_0x42aec3(0x15e)]({'message':_0x2333fb[_0x42aec3(0x164)]});}}),router[a0_0x1e15cd(0x1ca)](a0_0x1e15cd(0x18c),async(_0x391715,_0x5ab1f8)=>{var _0x560b72=a0_0x1e15cd;const {level:_0x555256,isle:_0x1bd1a3,pallet:_0x3fc1b2,warehouses:_0x4aa09d,room:_0x3916f7}=_0x391715[_0x560b72(0x1d4)];try{const _0x1a7a1b=await warehouse[_0x560b72(0x24a)]([{'$match':{'name':_0x4aa09d,'room':_0x3916f7}},{'$unwind':_0x560b72(0x189)},{'$match':{'product_details.level':parseInt(_0x555256),'product_details.isle':_0x1bd1a3,'product_details.pallet':parseInt(_0x3fc1b2)}},{'$group':{'_id':_0x560b72(0x1d6),'name':{'$first':_0x560b72(0x171)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x560b72(0x1e5)},'isle':{'$first':_0x560b72(0x20e)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x5ab1f8[_0x560b72(0x21a)](0xc8)['json'](_0x1a7a1b);}catch(_0x103c65){_0x5ab1f8[_0x560b72(0x21a)](0x194)[_0x560b72(0x15e)]({'message':_0x103c65[_0x560b72(0x164)]});}}),module['exports']=router;