var a0_0x574941=a0_0x1710;(function(_0x12ad99,_0x1ea42c){var _0x259b5b=a0_0x1710,_0x12c0aa=_0x12ad99();while(!![]){try{var _0x3773bc=-parseInt(_0x259b5b(0x259))/0x1+-parseInt(_0x259b5b(0x233))/0x2+parseInt(_0x259b5b(0x29b))/0x3+-parseInt(_0x259b5b(0x29d))/0x4*(parseInt(_0x259b5b(0x1f5))/0x5)+parseInt(_0x259b5b(0x2c6))/0x6*(parseInt(_0x259b5b(0x239))/0x7)+parseInt(_0x259b5b(0x24d))/0x8*(parseInt(_0x259b5b(0x2b2))/0x9)+parseInt(_0x259b5b(0x211))/0xa*(parseInt(_0x259b5b(0x294))/0xb);if(_0x3773bc===_0x1ea42c)break;else _0x12c0aa['push'](_0x12c0aa['shift']());}catch(_0x31d536){_0x12c0aa['push'](_0x12c0aa['shift']());}}}(a0_0x32e4,0x721b0));const express=require('express'),app=express(),router=express[a0_0x574941(0x2d9)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x574941(0x204)),auth=require(a0_0x574941(0x2c2)),nodemailer=require(a0_0x574941(0x24f));function a0_0x32e4(){var _0x57966b=['\x20<>\x20','Ambient','isAvailable','LOG-INC-','INC-','645128bcjyvo','An\x20error\x20occurred.','nodemailer','purchase_invoice','getFullYear','success','$gross_price','prod_secondunit','$product_details.type','here2','<div>',',\x20bay:\x20','544633zgSKqG','Error\x20Occurs','$product.room_name','$product_details','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','error','/view/:id','$room','suppliers','add_purchases_finished','findById','master','expiry_date','$product_details._id','aggregate','purchase\x20data\x20add\x20successfully','</body></html>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/view/add_purchases','prod_qty','FGSEmail','/all_purchases_finished/preview/','$product.bin','INCF-','log','$unit','room','Paid\x20For\x20Purchase','abs','type_of_products_type','POnumber','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','due_amount','Room_name','$name','match','$product_details.primary_code','secondary_unit','flash','id_transaction','forEach','$product_details.product_code','<h2>\x20','stock_quantity','/all_purchases_finished/process/','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','find','Email\x20sent\x20successfully','host','warehouse_name','edit_purchases_finished_view','errors','purchases_process','<strong>\x20Regards\x20</strong>','port','$product.floorlevel','production_date','json','33pUGspa','incoming_add','Logo.png','product_name','sendMail','\x20<=>\x20','payment\x20successfull','94950hdERBs','bin','447284HJWixD','/preview/:id','$brand','/view/add_purchases/:id','There\x27s\x20a\x20error\x20in\x20this\x20transaction','false','$note','incoming_view','toString','all_purchases_finished_logs','sales_category','JO_number','concat','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','True','suppliers_docs','maxProducts','/view/add_purchases_logs','product_date','then','9DvaVmx','return_qty','Error\x20occurred\x20while\x20processing\x20product:','return_purchase_finished','paid_amount','en-CA','</table>','email','params','stocks','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','purchases_id','true','$product.quantity','Hindi','message','../middleware/auth','/view_log','path','FROZEN\x20GOODS','6132mPjpna','save','/../public','return_product','user','$maxProdPerUnit','/view','prod_unit','random','$warehouse_name','date','Distributing\x20','Return\x20Goods','primary_code','own','warehouse','product_data','<hr\x20class=\x22my-3\x22>','<html><head><title></title>','Router','$sales_category','$suppliers','$suppliers_docs','$expiry_date','/process/:id','valueOf','prod_cat','language','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','uuid','level','unit','Enclosed','French','Transfer\x20Finalize\x20Successfully','post','$type_products','image','gmail','floor','/give_payment/:id','/all_purchases_finished/view','redirect','logo','to_recieved','Arabic\x20(ae)','maxPerUnit','/view/return_purchase/:id','$primary_code','prod_name',',\x20bin:\x20','<span\x20style=\x22float:\x20right;\x22>','gross_price','to_quantity','to_warehouse','product_cat','secondary_code','string','to_bay','RoomAssign','findOne','$secondary_code','numeric','slice','return_data','$product_details.product_name','maxperunit','<tr>','batch_code','/incoming/add','prod_Qty','</h5>','MaxStocks_data','</tr>','purchase\x20data\x20update\x20successfully','</span>','isProcess','exports','<tbody\x20style=\x22text-align:\x20center;\x22>','back','$category','max_product_unit','$product.type','<h5>','\x20units\x20to\x20warehouse:\x20','body','/picking_list/pdf_puchases_fin_own_trf/','item_code','$invoice','date_recieved','$product_details.floorlevel','map','product','$product','maxStocks','table\x20page','$product.bay','room_name','product_id','/barcode_scanner','Spanish','invoice_init','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','status','type_of_products','German','product_stock','product_details','$due_amount','/barcode/:id','edit_purchases_finished','getMonth','role','purchases\x20item\x20return\x20successfull','min','There\x20is\x20','/getTRF','ejs','createTransport','35IWUrSW','/invoice/:id','prod_code','English\x20(US)','DRY\x20GOODS','</div>','Finished\x20Goods','invoice','/upload/','Portuguese','standard_unit','logs','$secondary_unit','Purchase\x20Mail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','../models/all_models','Rack\x201','name','Enabled','2-digit','<h5\x20style=\x22text-align:\x20left;\x22>','padStart','Purchase\x20Return','sales_data_cateory','$product_details.secondary_code','data_type','Portuguese\x20(BR)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','5031480ikPtZn','$product_details.storage','length','render','getDate','primary_code_hide','bay','stock_data','site_title','\x20Order\x20Date\x20:\x20','$_id','quantity','$return_data','all','prod_level','add_purchases_finished_logs','$date','catch','all_purchases_barcode','$maxStocks','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$alertquantity','</head><body>','</thead>','secondary_code_hide','$batch_code','Arabic','/CheckingWarehouse','/incoming','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</td>','to_room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','414326MJimyt','prod_primunit','English','$paid_amount','max','$product_details.bin','2604ySejIK','purchase_quantity','filter','inc','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','password','product_code','_id','currency_placement','staff','</tbody>','Rack\x202','$product_details.product_stock','get'];a0_0x32e4=function(){return _0x57966b;};return a0_0x32e4();}var ejs=require(a0_0x574941(0x1f3));const path=require(a0_0x574941(0x2c4)),users=require('../public/language/languages.json'),{isNull}=require('util');router[a0_0x574941(0x247)](a0_0x574941(0x22d),auth,async(_0x32047c,_0x2d2e87)=>{var _0x16a0e8=a0_0x574941;try{const {username:_0x268b53,email:_0x326218,role:_0x2a4680}=_0x32047c['user'],_0x2ce14d=_0x32047c[_0x16a0e8(0x2ca)],_0x5bb420=await profile[_0x16a0e8(0x1ba)]({'email':_0x2ce14d[_0x16a0e8(0x2b9)]}),_0x3efd8a=await staff['findOne']({'email':_0x2ce14d['email']}),_0x29550c=await master_shop['find']();let _0x3aaaf6=await transfers_finished[_0x16a0e8(0x267)]([{'$match':{'to_warehouse':_0x3efd8a[_0x16a0e8(0x2d5)]}}]);if(_0x29550c[0x0][_0x16a0e8(0x2e1)]=='English\x20(US)')var _0x199e32=users[_0x16a0e8(0x235)];else{if(_0x29550c[0x0][_0x16a0e8(0x2e1)]==_0x16a0e8(0x2c0))var _0x199e32=users[_0x16a0e8(0x2c0)];else{if(_0x29550c[0x0][_0x16a0e8(0x2e1)]==_0x16a0e8(0x1e7))var _0x199e32=users[_0x16a0e8(0x1e7)];else{if(_0x29550c[0x0]['language']==_0x16a0e8(0x1e2))var _0x199e32=users[_0x16a0e8(0x1e2)];else{if(_0x29550c[0x0]['language']==_0x16a0e8(0x19f))var _0x199e32=users[_0x16a0e8(0x19f)];else{if(_0x29550c[0x0]['language']==_0x16a0e8(0x20f))var _0x199e32=users[_0x16a0e8(0x1fe)];else{if(_0x29550c[0x0][_0x16a0e8(0x2e1)]=='Chinese')var _0x199e32=users['Chinese'];else{if(_0x29550c[0x0][_0x16a0e8(0x2e1)]==_0x16a0e8(0x1ab))var _0x199e32=users[_0x16a0e8(0x22b)];}}}}}}}_0x2d2e87[_0x16a0e8(0x214)](_0x16a0e8(0x2a4),{'success':_0x32047c[_0x16a0e8(0x280)]('success'),'errors':_0x32047c[_0x16a0e8(0x280)](_0x16a0e8(0x28d)),'purchases':_0x3aaaf6,'role':_0x2ce14d,'profile':_0x5bb420,'master_shop':_0x29550c,'language':_0x199e32,'staff_data':_0x3efd8a});}catch(_0x2bfab5){console[_0x16a0e8(0x271)](_0x16a0e8(0x1dd),_0x2bfab5),_0x2d2e87[_0x16a0e8(0x1e5)](0xc8)[_0x16a0e8(0x293)]({'message':_0x2bfab5[_0x16a0e8(0x2c1)]});}}),router[a0_0x574941(0x247)](a0_0x574941(0x1c3),auth,async(_0x5909d5,_0x510a56)=>{var _0x3f3858=a0_0x574941;try{const {username:_0x3c3241,email:_0x856eb2,role:_0x32398f}=_0x5909d5['user'],_0x25301c=_0x5909d5[_0x3f3858(0x2ca)],_0x1583ee=await profile['findOne']({'email':_0x25301c[_0x3f3858(0x2b9)]}),_0x52fb92=await staff[_0x3f3858(0x1ba)]({'email':_0x25301c[_0x3f3858(0x2b9)]}),_0x387f6b=await master_shop[_0x3f3858(0x288)]();let _0x8b4de8=await transfers_finished[_0x3f3858(0x267)]([{'$match':{'to_warehouse':_0x52fb92[_0x3f3858(0x2d5)],'to_recieved':'false'}}]);if(_0x387f6b[0x0][_0x3f3858(0x2e1)]==_0x3f3858(0x1f8))var _0x593802=users['English'];else{if(_0x387f6b[0x0][_0x3f3858(0x2e1)]=='Hindi')var _0x593802=users[_0x3f3858(0x2c0)];else{if(_0x387f6b[0x0][_0x3f3858(0x2e1)]==_0x3f3858(0x1e7))var _0x593802=users[_0x3f3858(0x1e7)];else{if(_0x387f6b[0x0]['language']==_0x3f3858(0x1e2))var _0x593802=users[_0x3f3858(0x1e2)];else{if(_0x387f6b[0x0][_0x3f3858(0x2e1)]==_0x3f3858(0x19f))var _0x593802=users[_0x3f3858(0x19f)];else{if(_0x387f6b[0x0][_0x3f3858(0x2e1)]=='Portuguese\x20(BR)')var _0x593802=users[_0x3f3858(0x1fe)];else{if(_0x387f6b[0x0][_0x3f3858(0x2e1)]==_0x3f3858(0x23d))var _0x593802=users[_0x3f3858(0x23d)];else{if(_0x387f6b[0x0][_0x3f3858(0x2e1)]==_0x3f3858(0x1ab))var _0x593802=users['Arabic'];}}}}}}}_0x510a56[_0x3f3858(0x214)](_0x3f3858(0x295),{'success':_0x5909d5[_0x3f3858(0x280)]('success'),'errors':_0x5909d5['flash'](_0x3f3858(0x28d)),'purchases':_0x8b4de8,'role':_0x25301c,'profile':_0x1583ee,'master_shop':_0x387f6b,'language':_0x593802,'staff_data':_0x52fb92});}catch(_0x4343be){console[_0x3f3858(0x271)](_0x3f3858(0x1dd),_0x4343be),_0x510a56[_0x3f3858(0x1e5)](0xc8)['json']({'message':_0x4343be[_0x3f3858(0x2c1)]});}});const createLog=async _0xf8124c=>{var _0x3ed45e=a0_0x574941;const _0x50d247=new datalogs({'location':_0xf8124c});return await _0x50d247[_0x3ed45e(0x2c7)](),_0x50d247[_0x3ed45e(0x1e3)];};router['post'](a0_0x574941(0x1c3),auth,async(_0x5820a5,_0x250fec)=>{var _0x21093c=a0_0x574941;try{const {invoice_trf_data:_0x424904,item_code:_0xf5a83,SCRN:_0x3675ea,ReqBy:_0x4a4375,type_of_products:_0x2c37c0,dateofreq:_0x3feaa9,PO_number:_0x473c8c,date:_0x4b1ff4,warehouse_name:_0x17b62c,typeservicesData:_0x419a41,typevehicle:_0x3e2e51,driver:_0xb47ffa,plate:_0x4d3085,van:_0x33f1ff,DRSI:_0x5a4a63,TSU:_0x4ed72b,TFU:_0x516cd8,note:_0x12b9d7}=_0x5820a5[_0x21093c(0x1d3)],_0x41bb6e=await transfers_finished[_0x21093c(0x263)](_0x424904);if(typeof _0xf5a83==_0x21093c(0x1b7))var _0x3cb81d=[_0x5820a5[_0x21093c(0x1d3)]['product_name']],_0xcbc843=[_0x5820a5['body'][_0x21093c(0x1d5)]],_0x3be6f5=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1b3)]],_0x4d9517=[_0x5820a5[_0x21093c(0x1d3)]['unit']],_0x237ef9=[_0x5820a5['body'][_0x21093c(0x254)]],_0x1df6f1=[_0x5820a5['body'][_0x21093c(0x29c)]],_0x220715=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x2d3)]],_0x588036=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1b6)]],_0x218255=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1c2)]],_0x294b2a=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x265)]],_0x55f713=[_0x5820a5[_0x21093c(0x1d3)]['production_date']],_0x5066cd=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1cf)]],_0x40e15d=[_0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x273)]];else var _0x3cb81d=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x297)]],_0xcbc843=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1d5)]],_0x3be6f5=[..._0x5820a5[_0x21093c(0x1d3)]['to_quantity']],_0x4d9517=[..._0x5820a5['body'][_0x21093c(0x19d)]],_0x237ef9=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x254)]],_0x1df6f1=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x29c)]],_0x220715=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x2d3)]],_0x588036=[..._0x5820a5['body'][_0x21093c(0x1b6)]],_0x218255=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1c2)]],_0x294b2a=[..._0x5820a5['body'][_0x21093c(0x265)]],_0x55f713=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x292)]],_0x5066cd=[..._0x5820a5[_0x21093c(0x1d3)][_0x21093c(0x1cf)]],_0x40e15d=[..._0x5820a5['body']['room']];const _0x4c4a62=_0x3cb81d['map'](_0x568f42=>{return _0x568f42={'product_name':_0x568f42};});_0xcbc843['forEach']((_0x46d18,_0x6ffdd)=>{var _0x3bde2e=_0x21093c;_0x4c4a62[_0x6ffdd][_0x3bde2e(0x240)]=_0x46d18;}),_0x3be6f5['forEach']((_0xafe7c2,_0x56f443)=>{var _0x47d375=_0x21093c;_0x4c4a62[_0x56f443]['quantity']=Math[_0x47d375(0x275)](_0xafe7c2);}),_0x4d9517[_0x21093c(0x282)]((_0x30f0b3,_0x1f2432)=>{var _0x3255dc=_0x21093c;_0x4c4a62[_0x1f2432][_0x3255dc(0x1ff)]=_0x30f0b3;}),_0x237ef9[_0x21093c(0x282)]((_0x17177d,_0x20d449)=>{_0x4c4a62[_0x20d449]['secondary_unit']=_0x17177d;}),_0x1df6f1[_0x21093c(0x282)]((_0x17ac1f,_0x3f364d)=>{var _0x5be5f0=_0x21093c,_0x3017bd=_0x17ac1f[_0x5be5f0(0x27d)](/[A-Za-z]+/)[0x0],_0x289a9e=parseInt(_0x17ac1f[_0x5be5f0(0x27d)](/\d+/)[0x0]);_0x4c4a62[_0x3f364d][_0x5be5f0(0x19c)]=_0x3017bd,_0x4c4a62[_0x3f364d][_0x5be5f0(0x217)]=_0x289a9e;}),_0x220715[_0x21093c(0x282)]((_0x51a564,_0x45875f)=>{_0x4c4a62[_0x45875f]['primary_code']=_0x51a564;}),_0x588036[_0x21093c(0x282)]((_0x36eb74,_0x33d966)=>{var _0x43edad=_0x21093c;_0x4c4a62[_0x33d966][_0x43edad(0x1b6)]=_0x36eb74;}),_0x218255[_0x21093c(0x282)]((_0x213fd6,_0x26b56f)=>{var _0x3790f5=_0x21093c;_0x4c4a62[_0x26b56f][_0x3790f5(0x1c2)]=_0x213fd6;}),_0x294b2a[_0x21093c(0x282)]((_0x4215ac,_0x440234)=>{var _0x4c03ba=_0x21093c;_0x4c4a62[_0x440234][_0x4c03ba(0x265)]=_0x4215ac;}),_0x55f713[_0x21093c(0x282)]((_0x27737d,_0x43e2a4)=>{var _0x375aa0=_0x21093c;_0x4c4a62[_0x43e2a4][_0x375aa0(0x292)]=_0x27737d;}),_0x5066cd[_0x21093c(0x282)]((_0x27745d,_0x5053af)=>{var _0x26e729=_0x21093c;_0x4c4a62[_0x5053af][_0x26e729(0x1c0)]=_0x27745d;}),_0x40e15d[_0x21093c(0x282)]((_0xa19492,_0x4b7c3d)=>{var _0x4e08f2=_0x21093c;_0x4c4a62[_0x4b7c3d][_0x4e08f2(0x1df)]=_0xa19492;});const _0x10bffc=await createLog('INC');_0x40e15d[_0x21093c(0x282)]((_0x3d70f1,_0x346293)=>{var _0x5ad39a=_0x21093c;_0x4c4a62[_0x346293][_0x5ad39a(0x1fc)]=_0x5ad39a(0x24c)+_0x10bffc[_0x5ad39a(0x2a5)]()[_0x5ad39a(0x20a)](0x8,'0');});const _0x1739d2=_0x4c4a62[_0x21093c(0x23b)](_0x59d004=>_0x59d004[_0x21093c(0x21c)]!=='0'&&_0x59d004[_0x21093c(0x21c)]!==''),_0x5c7772=new purchases_incoming({'invoice':_0x21093c(0x24c)+_0x10bffc[_0x21093c(0x2a5)]()[_0x21093c(0x20a)](0x8,'0'),'date':_0x4b1ff4,'warehouse_name':_0x17b62c,'product':_0x1739d2,'note':_0x12b9d7,'POnumber':_0x473c8c,'SCRN':_0x3675ea,'ReqBy':_0x4a4375,'dateofreq':_0x3feaa9,'typeservicesData':_0x419a41,'van':_0x33f1ff,'typevehicle':_0x3e2e51,'driver':_0xb47ffa,'plate':_0x4d3085,'DRSI':_0x5a4a63,'TSU':_0x4ed72b,'TFU':_0x516cd8,'typeOfProducts':_0x2c37c0}),_0x5f21e5=await _0x5c7772['save'](),_0x330238=_0x5f21e5['product'][_0x21093c(0x1d9)](async _0x582a5d=>{var _0x499433=_0x21093c,_0x5127d=await warehouse[_0x499433(0x1ba)]({'name':_0x17b62c,'room':_0x582a5d[_0x499433(0x1df)]});if(_0x582a5d['quantity']>0x0){var _0x46b3c7=0x0;const _0xb328cb=_0x5127d[_0x499433(0x1e9)][_0x499433(0x1d9)](_0x2f8cae=>{var _0x3ed343=_0x499433;_0x2f8cae[_0x3ed343(0x297)]==_0x582a5d[_0x3ed343(0x297)]&&_0x2f8cae[_0x3ed343(0x217)]==_0x582a5d[_0x3ed343(0x1b8)]&&_0x2f8cae[_0x3ed343(0x265)]==_0x582a5d[_0x3ed343(0x265)]&&_0x2f8cae[_0x3ed343(0x292)]==_0x582a5d[_0x3ed343(0x292)]&&_0x2f8cae[_0x3ed343(0x1c2)]==_0x582a5d['batch_code']&&_0x2f8cae[_0x3ed343(0x1fc)]==_0x582a5d['invoice']&&(typeof _0x582a5d[_0x3ed343(0x281)]=='undefined'?(console[_0x3ed343(0x271)](_0x3ed343(0x256),_0x2f8cae['product_stock']+_0x3ed343(0x248)+_0x2f8cae['_id']+_0x3ed343(0x299)+Math[_0x3ed343(0x275)](_0x2f8cae[_0x3ed343(0x1e8)])+Math[_0x3ed343(0x275)](_0x582a5d[_0x3ed343(0x1b3)])),_0x2f8cae[_0x3ed343(0x1e8)]=Math['abs'](_0x2f8cae['product_stock'])+Math[_0x3ed343(0x275)](_0x582a5d[_0x3ed343(0x21c)])):(_0x2f8cae[_0x3ed343(0x1e8)]=Math[_0x3ed343(0x275)](_0x2f8cae['product_stock'])+Math[_0x3ed343(0x275)](_0x582a5d[_0x3ed343(0x21c)]),_0x46b3c7++));});_0x46b3c7=='0'&&(_0x5127d['product_details']=_0x5127d[_0x499433(0x1e9)][_0x499433(0x2a9)]({'product_name':_0x582a5d[_0x499433(0x297)],'product_stock':_0x582a5d[_0x499433(0x21c)],'bay':_0x582a5d[_0x499433(0x217)],'level':_0x582a5d[_0x499433(0x19c)],'product_code':_0x582a5d[_0x499433(0x240)],'primary_code':_0x582a5d[_0x499433(0x2d3)],'secondary_code':_0x582a5d[_0x499433(0x1b6)],'expiry_date':_0x582a5d[_0x499433(0x265)],'production_date':_0x582a5d[_0x499433(0x292)],'maxProducts':_0x582a5d['maxProducts'],'batch_code':_0x582a5d['batch_code'],'secondary_unit':_0x582a5d[_0x499433(0x27f)],'unit':_0x582a5d['standard_unit'],'maxProducts':_0x582a5d[_0x499433(0x2ae)],'maxPerUnit':_0x582a5d[_0x499433(0x1ac)],'invoice':_0x582a5d[_0x499433(0x1fc)]}));}return _0x5127d;});Promise[_0x21093c(0x21e)](_0x330238)[_0x21093c(0x2b1)](async _0x4ba891=>{var _0x3b2aca=_0x21093c;try{for(const _0xae5f0d of _0x4ba891){await warehouse['updateOne']({'_id':_0xae5f0d[_0x3b2aca(0x241)]},{'$addToSet':{'product_details':{'$each':_0xae5f0d['product_details']}}});}_0x41bb6e[_0x3b2aca(0x1aa)]=_0x3b2aca(0x2be);const _0x46754b=await _0x41bb6e[_0x3b2aca(0x2c7)](),_0x39341d=await master_shop[_0x3b2aca(0x288)](),_0x57fdb8=await email_settings[_0x3b2aca(0x1ba)](),_0x9c4951=await supervisor_settings[_0x3b2aca(0x288)]();var _0xc084b9=_0x5c7772['product'],_0x3f6e8c='',_0x3ad117;for(_0x3ad117 in _0xc084b9){var _0x2091ac='FG';_0x5c7772[_0x3b2aca(0x1b4)]==_0x3b2aca(0x1f9)&&(_0x2091ac='DG'),_0x3f6e8c+=_0x3b2aca(0x1c1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc084b9[_0x3ad117][_0x3b2aca(0x297)]+_0x3b2aca(0x230)+_0x3b2aca(0x278)+_0xc084b9[_0x3ad117]['product_code']+_0x3b2aca(0x230)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc084b9[_0x3ad117][_0x3b2aca(0x1b3)]+'</td>'+_0x3b2aca(0x278)+_0xc084b9[_0x3ad117][_0x3b2aca(0x19d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc084b9[_0x3ad117][_0x3b2aca(0x27f)]+_0x3b2aca(0x230)+_0x3b2aca(0x278)+_0x5c7772[_0x3b2aca(0x1b4)]+_0x3b2aca(0x230)+_0x3b2aca(0x278)+_0xc084b9[_0x3ad117][_0x3b2aca(0x231)]+_0x3b2aca(0x230)+_0x3b2aca(0x278)+_0x2091ac+_0xc084b9[_0x3ad117][_0x3b2aca(0x1b8)]+_0x3b2aca(0x230)+_0x3b2aca(0x1c7);}_0x5820a5['flash']('success',_0x3b2aca(0x1a0)),_0x250fec[_0x3b2aca(0x1a8)](_0x3b2aca(0x1d4)+_0x5f21e5[_0x3b2aca(0x241)]);}catch(_0x531a8d){console[_0x3b2aca(0x25e)](_0x531a8d),_0x250fec[_0x3b2aca(0x1e5)](0x1f4)[_0x3b2aca(0x293)]({'error':_0x3b2aca(0x19a)});}})[_0x21093c(0x222)](_0x2b9ffe=>{var _0x367437=_0x21093c;console['error'](_0x2b9ffe),_0x250fec[_0x367437(0x1e5)](0x1f4)[_0x367437(0x293)]({'error':_0x367437(0x24e)});});}catch(_0x50a8a2){}}),router[a0_0x574941(0x1a1)](a0_0x574941(0x1f2),auth,async(_0x44dcd7,_0x248669)=>{var _0x510f1c=a0_0x574941;try{const {warehouse:_0xe9ecc7}=_0x44dcd7[_0x510f1c(0x1d3)],_0x2d3264=await transfers_finished[_0x510f1c(0x288)]({'to_warehouse':_0xe9ecc7,'to_recieved':_0x510f1c(0x2a2)});_0x248669[_0x510f1c(0x293)](_0x2d3264);}catch(_0x27f3d){}}),router[a0_0x574941(0x1a1)]('/getinvoicetrf',auth,async(_0x4f6da1,_0x84865b)=>{var _0x4ba589=a0_0x574941;try{const {invoice:_0x5e2693}=_0x4f6da1[_0x4ba589(0x1d3)],_0x3e0b46=await transfers_finished[_0x4ba589(0x288)]({'_id':_0x5e2693,'to_recieved':_0x4ba589(0x2a2)});_0x84865b[_0x4ba589(0x293)](_0x3e0b46);}catch(_0x22b0e6){}}),router[a0_0x574941(0x247)](a0_0x574941(0x2cc),auth,async(_0x5b7aee,_0x3fa9f4)=>{var _0x4e53cb=a0_0x574941;try{const {username:_0x2a97af,email:_0x301eb2,role:_0x24780d}=_0x5b7aee[_0x4e53cb(0x2ca)],_0x4126f4=_0x5b7aee[_0x4e53cb(0x2ca)],_0x27558f=await profile[_0x4e53cb(0x1ba)]({'email':_0x4126f4['email']}),_0x16d4b3=await staff[_0x4e53cb(0x1ba)]({'email':_0x4126f4[_0x4e53cb(0x2b9)]});if(_0x4126f4[_0x4e53cb(0x1ee)]==_0x4e53cb(0x243)){const _0x282dbb=await staff['findOne']({'email':_0x4126f4[_0x4e53cb(0x2b9)]});}const _0xaa395a=await master_shop[_0x4e53cb(0x288)]();let _0xe189a6;if(_0x4126f4[_0x4e53cb(0x1ee)]==_0x4e53cb(0x243)){const _0x248e0f=await staff[_0x4e53cb(0x1ba)]({'email':_0x4126f4[_0x4e53cb(0x2b9)]});_0xe189a6=await purchases_finished[_0x4e53cb(0x267)]([{'$match':{'warehouse_name':_0x248e0f[_0x4e53cb(0x2d5)],'typeOfProducts':'own'}},{'$lookup':{'from':'suppliers','localField':_0x4e53cb(0x261),'foreignField':'name','as':_0x4e53cb(0x2ad)}},{'$unwind':_0x4e53cb(0x2dc)},{'$unwind':_0x4e53cb(0x1db)},{'$group':{'_id':_0x4e53cb(0x21b),'invoice':{'$first':_0x4e53cb(0x1d6)},'suppliers':{'$first':_0x4e53cb(0x2db)},'date':{'$first':_0x4e53cb(0x221)},'warehouse_name':{'$first':_0x4e53cb(0x2cf)},'room':{'$first':_0x4e53cb(0x260)},'product':{'$push':_0x4e53cb(0x1db)},'note':{'$first':_0x4e53cb(0x2a3)},'paid_amount':{'$first':_0x4e53cb(0x236)},'due_amount':{'$first':_0x4e53cb(0x1ea)},'return_data':{'$first':_0x4e53cb(0x21d)},'batch_code':{'$first':_0x4e53cb(0x22a)},'expiry_date':{'$first':_0x4e53cb(0x2dd)},'suppliers_docs':{'$first':_0x4e53cb(0x2dc)},'total_product_quantity':{'$sum':_0x4e53cb(0x2bf)},'level':{'$addToSet':_0x4e53cb(0x1de)},'isle':{'$addToSet':_0x4e53cb(0x26f)},'type':{'$addToSet':_0x4e53cb(0x1d0)},'floorlevel':{'$addToSet':_0x4e53cb(0x291)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xe189a6=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x4e53cb(0x2d4)}},{'$unwind':_0x4e53cb(0x1db)},{'$group':{'_id':_0x4e53cb(0x21b),'invoice':{'$first':_0x4e53cb(0x1d6)},'suppliers':{'$first':_0x4e53cb(0x2db)},'date':{'$first':_0x4e53cb(0x221)},'warehouse_name':{'$first':_0x4e53cb(0x2cf)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x4e53cb(0x1db)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x4e53cb(0x236)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4e53cb(0x22a)},'expiry_date':{'$first':_0x4e53cb(0x2dd)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x4e53cb(0x2bf)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x4e53cb(0x26f)},'type':{'$addToSet':_0x4e53cb(0x1d0)},'floorlevel':{'$addToSet':_0x4e53cb(0x291)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xaa395a[0x0]['language']==_0x4e53cb(0x1f8))var _0xd10522=users[_0x4e53cb(0x235)];else{if(_0xaa395a[0x0][_0x4e53cb(0x2e1)]==_0x4e53cb(0x2c0))var _0xd10522=users[_0x4e53cb(0x2c0)];else{if(_0xaa395a[0x0][_0x4e53cb(0x2e1)]==_0x4e53cb(0x1e7))var _0xd10522=users[_0x4e53cb(0x1e7)];else{if(_0xaa395a[0x0][_0x4e53cb(0x2e1)]=='Spanish')var _0xd10522=users['Spanish'];else{if(_0xaa395a[0x0]['language']==_0x4e53cb(0x19f))var _0xd10522=users['French'];else{if(_0xaa395a[0x0][_0x4e53cb(0x2e1)]==_0x4e53cb(0x20f))var _0xd10522=users[_0x4e53cb(0x1fe)];else{if(_0xaa395a[0x0][_0x4e53cb(0x2e1)]==_0x4e53cb(0x23d))var _0xd10522=users[_0x4e53cb(0x23d)];else{if(_0xaa395a[0x0][_0x4e53cb(0x2e1)]==_0x4e53cb(0x1ab))var _0xd10522=users[_0x4e53cb(0x22b)];}}}}}}}_0x3fa9f4[_0x4e53cb(0x214)]('all_purchases_finished',{'success':_0x5b7aee[_0x4e53cb(0x280)](_0x4e53cb(0x252)),'errors':_0x5b7aee[_0x4e53cb(0x280)]('errors'),'purchases':_0xe189a6,'role':_0x4126f4,'profile':_0x27558f,'master_shop':_0xaa395a,'language':_0xd10522});}catch(_0x3d6c8a){console[_0x4e53cb(0x271)](_0x4e53cb(0x1dd),_0x3d6c8a),_0x3fa9f4[_0x4e53cb(0x1e5)](0xc8)[_0x4e53cb(0x293)]({'message':_0x3d6c8a[_0x4e53cb(0x2c1)]});}}),router[a0_0x574941(0x247)](a0_0x574941(0x2c3),auth,async(_0x16bd29,_0x5d8088)=>{var _0x5b0922=a0_0x574941;try{const {username:_0x563e21,email:_0x1288a6,role:_0x1a3000}=_0x16bd29['user'],_0x1ddd39=_0x16bd29[_0x5b0922(0x2ca)],_0x147f7b=await profile[_0x5b0922(0x1ba)]({'email':_0x1ddd39[_0x5b0922(0x2b9)]}),_0x50eeb5=await staff['findOne']({'email':_0x1ddd39[_0x5b0922(0x2b9)]});if(_0x1ddd39['role']=='staff'){const _0x572ca1=await staff['findOne']({'email':_0x1ddd39['email']});}const _0x561581=await master_shop[_0x5b0922(0x288)]();let _0x1dea70;if(_0x1ddd39[_0x5b0922(0x1ee)]==_0x5b0922(0x243)){const _0x5d3606=await staff[_0x5b0922(0x1ba)]({'email':_0x1ddd39['email']});_0x1dea70=await purchases_finished[_0x5b0922(0x267)]([{'$match':{'warehouse_name':_0x5d3606[_0x5b0922(0x2d5)]}},{'$lookup':{'from':_0x5b0922(0x261),'localField':'suppliers','foreignField':_0x5b0922(0x206),'as':_0x5b0922(0x2ad)}},{'$unwind':_0x5b0922(0x2dc)},{'$unwind':'$product'},{'$group':{'_id':_0x5b0922(0x21b),'invoice':{'$first':_0x5b0922(0x1d6)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x5b0922(0x221)},'warehouse_name':{'$first':_0x5b0922(0x2cf)},'room':{'$first':_0x5b0922(0x260)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5b0922(0x1ea)},'return_data':{'$first':_0x5b0922(0x21d)},'batch_code':{'$first':_0x5b0922(0x22a)},'expiry_date':{'$first':_0x5b0922(0x2dd)},'suppliers_docs':{'$first':_0x5b0922(0x2dc)},'total_product_quantity':{'$sum':_0x5b0922(0x2bf)},'level':{'$addToSet':_0x5b0922(0x1de)},'isle':{'$addToSet':_0x5b0922(0x26f)},'type':{'$addToSet':_0x5b0922(0x1d0)},'floorlevel':{'$addToSet':_0x5b0922(0x291)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1dea70=await purchases_finished[_0x5b0922(0x267)]([{'$match':{'typeOfProducts':_0x5b0922(0x200)}},{'$unwind':_0x5b0922(0x1db)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5b0922(0x1d6)},'suppliers':{'$first':_0x5b0922(0x2db)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5b0922(0x2cf)},'room':{'$addToSet':_0x5b0922(0x25b)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5b0922(0x1ea)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5b0922(0x22a)},'expiry_date':{'$first':_0x5b0922(0x2dd)},'suppliers_docs':{'$first':_0x5b0922(0x2dc)},'total_product_quantity':{'$sum':_0x5b0922(0x2bf)},'level':{'$addToSet':_0x5b0922(0x1de)},'isle':{'$addToSet':_0x5b0922(0x26f)},'type':{'$addToSet':_0x5b0922(0x1d0)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x561581[0x0][_0x5b0922(0x2e1)]==_0x5b0922(0x1f8))var _0x1752a5=users[_0x5b0922(0x235)];else{if(_0x561581[0x0][_0x5b0922(0x2e1)]==_0x5b0922(0x2c0))var _0x1752a5=users[_0x5b0922(0x2c0)];else{if(_0x561581[0x0][_0x5b0922(0x2e1)]==_0x5b0922(0x1e7))var _0x1752a5=users['German'];else{if(_0x561581[0x0][_0x5b0922(0x2e1)]==_0x5b0922(0x1e2))var _0x1752a5=users['Spanish'];else{if(_0x561581[0x0]['language']==_0x5b0922(0x19f))var _0x1752a5=users['French'];else{if(_0x561581[0x0][_0x5b0922(0x2e1)]==_0x5b0922(0x20f))var _0x1752a5=users[_0x5b0922(0x1fe)];else{if(_0x561581[0x0][_0x5b0922(0x2e1)]=='Chinese')var _0x1752a5=users[_0x5b0922(0x23d)];else{if(_0x561581[0x0]['language']==_0x5b0922(0x1ab))var _0x1752a5=users[_0x5b0922(0x22b)];}}}}}}}_0x5d8088[_0x5b0922(0x214)](_0x5b0922(0x2a6),{'success':_0x16bd29[_0x5b0922(0x280)](_0x5b0922(0x252)),'errors':_0x16bd29[_0x5b0922(0x280)](_0x5b0922(0x28d)),'purchases':_0x1dea70,'role':_0x1ddd39,'profile':_0x147f7b,'master_shop':_0x561581,'language':_0x1752a5});}catch(_0x1670cd){console[_0x5b0922(0x271)]('table\x20page',_0x1670cd),_0x5d8088['status'](0xc8)['json']({'message':_0x1670cd[_0x5b0922(0x2c1)]});}});function a0_0x1710(_0x5e724b,_0x4503e0){var _0x32e449=a0_0x32e4();return a0_0x1710=function(_0x17105c,_0x3db84f){_0x17105c=_0x17105c-0x19a;var _0x2be96e=_0x32e449[_0x17105c];return _0x2be96e;},a0_0x1710(_0x5e724b,_0x4503e0);}function BayBinSelected(_0x187983,_0x4b1e6e){var _0xcd5580=a0_0x574941,_0x1d5bd7=[],_0x3b7114=[];if(_0x187983==_0xcd5580(0x1f9)){switch(_0x4b1e6e){case _0xcd5580(0x205):_0x1d5bd7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xcd5580(0x245):_0x1d5bd7=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3b7114=['DG'];}else{if(_0x187983==_0xcd5580(0x2c5)){switch(_0x4b1e6e){case _0xcd5580(0x205):_0x1d5bd7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x1d5bd7=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3b7114=['FG'];}}return{'levels':_0x1d5bd7,'identify':_0x3b7114};}async function getRandom8DigitNumber(){var _0xd9d6e6=a0_0x574941;const _0x208ca2=0x989680,_0x1ad90a=0x5f5e0ff,_0x3cec0f=Math[_0xd9d6e6(0x1a5)](Math[_0xd9d6e6(0x2ce)]()*(_0x1ad90a-_0x208ca2+0x1))+_0x208ca2;var _0x5826eb;const _0x25a3ec=await purchases_finished[_0xd9d6e6(0x1ba)]({'invoice':_0xd9d6e6(0x270)+_0x3cec0f});return _0x25a3ec&&_0x25a3ec['length']>0x0?_0x5826eb=_0xd9d6e6(0x270)+_0x3cec0f:_0x5826eb=_0xd9d6e6(0x270)+_0x3cec0f,_0x5826eb;}router[a0_0x574941(0x247)](a0_0x574941(0x26b),auth,async(_0x27a0e3,_0x579cef)=>{var _0x54c750=a0_0x574941;try{const {username:_0x500ba6,email:_0x4f06a4,role:_0x4594a6}=_0x27a0e3[_0x54c750(0x2ca)],_0x1c1306=_0x27a0e3[_0x54c750(0x2ca)],_0x45fdec=await profile[_0x54c750(0x1ba)]({'email':_0x1c1306[_0x54c750(0x2b9)]}),_0x5d6f09=await master_shop[_0x54c750(0x288)](),_0x374d28=await staff[_0x54c750(0x1ba)]({'email':_0x1c1306['email']}),_0x4b2cc9=await suppliers['find']({});let _0x32c43d;if(_0x1c1306[_0x54c750(0x1ee)]==_0x54c750(0x243)){const _0x3ba3a3=await staff['findOne']({'email':_0x1c1306[_0x54c750(0x2b9)]});_0x32c43d=await warehouse[_0x54c750(0x267)]([{'$match':{'status':_0x54c750(0x207),'name':_0x3ba3a3['warehouse']}},{'$group':{'_id':_0x54c750(0x27c),'name':{'$first':_0x54c750(0x27c)}}}]);}else _0x32c43d=await warehouse[_0x54c750(0x267)]([{'$match':{'status':_0x54c750(0x207)}},{'$group':{'_id':_0x54c750(0x27c),'name':{'$first':_0x54c750(0x27c)}}}]);const _0x517464=await product[_0x54c750(0x288)]({}),_0x46a233=await warehouse['find']({'status':'Enabled'}),_0x32de2f=await purchases_finished[_0x54c750(0x288)]({}),_0x2977fc=_0x32de2f[_0x54c750(0x213)]+0x1,_0x41231c=_0x54c750(0x270)+_0x2977fc[_0x54c750(0x2a5)]()[_0x54c750(0x20a)](0x5,'0');var _0x405308=['Ambient',_0x54c750(0x19e)];if(_0x5d6f09[0x0][_0x54c750(0x2e1)]==_0x54c750(0x1f8))var _0x4407bf=users[_0x54c750(0x235)];else{if(_0x5d6f09[0x0][_0x54c750(0x2e1)]=='Hindi')var _0x4407bf=users[_0x54c750(0x2c0)];else{if(_0x5d6f09[0x0][_0x54c750(0x2e1)]==_0x54c750(0x1e7))var _0x4407bf=users[_0x54c750(0x1e7)];else{if(_0x5d6f09[0x0][_0x54c750(0x2e1)]==_0x54c750(0x1e2))var _0x4407bf=users[_0x54c750(0x1e2)];else{if(_0x5d6f09[0x0][_0x54c750(0x2e1)]=='French')var _0x4407bf=users[_0x54c750(0x19f)];else{if(_0x5d6f09[0x0][_0x54c750(0x2e1)]==_0x54c750(0x20f))var _0x4407bf=users[_0x54c750(0x1fe)];else{if(_0x5d6f09[0x0][_0x54c750(0x2e1)]==_0x54c750(0x23d))var _0x4407bf=users[_0x54c750(0x23d)];else{if(_0x5d6f09[0x0]['language']==_0x54c750(0x1ab))var _0x4407bf=users[_0x54c750(0x22b)];}}}}}}}const _0x25e925=getRandom8DigitNumber(),_0x2c7b55=new Date(),_0x4b60b3={'year':_0x54c750(0x1bc),'month':'2-digit','day':_0x54c750(0x208),'timeZone':'Asia/Manila'},_0x3baa2f=_0x2c7b55['toLocaleDateString'](_0x54c750(0x2b7),_0x4b60b3);console['log'](_0x3baa2f),_0x25e925[_0x54c750(0x2b1)](_0x494eac=>{var _0x4424b2=_0x54c750;_0x579cef[_0x4424b2(0x214)](_0x4424b2(0x262),{'success':_0x27a0e3[_0x4424b2(0x280)](_0x4424b2(0x252)),'errors':_0x27a0e3[_0x4424b2(0x280)](_0x4424b2(0x28d)),'role':_0x1c1306,'profile':_0x45fdec,'suppliers':_0x4b2cc9,'warehouse':_0x32c43d,'product':_0x517464,'invoice':_0x494eac,'master_shop':_0x5d6f09,'language':_0x4407bf,'find_data':_0x46a233,'rooms_data':_0x405308,'formattedDate':_0x3baa2f});})[_0x54c750(0x222)](_0x403ead=>{var _0x2e9b72=_0x54c750;_0x27a0e3[_0x2e9b72(0x280)](_0x2e9b72(0x28d),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x579cef['redirect'](_0x2e9b72(0x1a7));});}catch(_0x335754){console['log'](_0x335754);}}),router[a0_0x574941(0x247)](a0_0x574941(0x2af),auth,async(_0x2c08d4,_0x558da0)=>{var _0x2e805e=a0_0x574941;try{const {username:_0xd9665c,email:_0x387ca2,role:_0x526e2b}=_0x2c08d4[_0x2e805e(0x2ca)],_0x33b601=_0x2c08d4[_0x2e805e(0x2ca)],_0x3e4bce=await profile[_0x2e805e(0x1ba)]({'email':_0x33b601[_0x2e805e(0x2b9)]}),_0x1fd41d=await master_shop['find'](),_0x32208a=await staff[_0x2e805e(0x1ba)]({'email':_0x33b601[_0x2e805e(0x2b9)]}),_0x979240=await suppliers[_0x2e805e(0x288)]({});let _0x76d6f7;if(_0x33b601[_0x2e805e(0x1ee)]=='staff'){const _0x7b0a2e=await staff[_0x2e805e(0x1ba)]({'email':_0x33b601[_0x2e805e(0x2b9)]});_0x76d6f7=await warehouse[_0x2e805e(0x267)]([{'$match':{'status':_0x2e805e(0x207),'name':_0x7b0a2e[_0x2e805e(0x2d5)]}},{'$group':{'_id':_0x2e805e(0x27c),'name':{'$first':_0x2e805e(0x27c)}}}]);}else _0x76d6f7=await warehouse[_0x2e805e(0x267)]([{'$match':{'status':_0x2e805e(0x207)}},{'$group':{'_id':_0x2e805e(0x27c),'name':{'$first':_0x2e805e(0x27c)}}}]);const _0x3cf61b=await product[_0x2e805e(0x288)]({}),_0xb4b2b4=await warehouse['find']({'status':_0x2e805e(0x207)}),_0x4728d2=await purchases_finished[_0x2e805e(0x288)]({}),_0x4af0d8=_0x4728d2[_0x2e805e(0x213)]+0x1,_0x32c0a4=_0x2e805e(0x270)+_0x4af0d8['toString']()[_0x2e805e(0x20a)](0x5,'0');var _0x25689d=[_0x2e805e(0x249),'Enclosed'];if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]=='English\x20(US)')var _0x4de41f=users['English'];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x2c0))var _0x4de41f=users[_0x2e805e(0x2c0)];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x1e7))var _0x4de41f=users[_0x2e805e(0x1e7)];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x1e2))var _0x4de41f=users[_0x2e805e(0x1e2)];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x19f))var _0x4de41f=users[_0x2e805e(0x19f)];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x20f))var _0x4de41f=users[_0x2e805e(0x1fe)];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x23d))var _0x4de41f=users[_0x2e805e(0x23d)];else{if(_0x1fd41d[0x0][_0x2e805e(0x2e1)]==_0x2e805e(0x1ab))var _0x4de41f=users[_0x2e805e(0x22b)];}}}}}}}const _0x42bf1b=getRandom8DigitNumber();_0x42bf1b[_0x2e805e(0x2b1)](_0x20c007=>{var _0x119f68=_0x2e805e;_0x558da0[_0x119f68(0x214)](_0x119f68(0x220),{'success':_0x2c08d4[_0x119f68(0x280)]('success'),'errors':_0x2c08d4[_0x119f68(0x280)](_0x119f68(0x28d)),'role':_0x33b601,'profile':_0x3e4bce,'suppliers':_0x979240,'warehouse':_0x76d6f7,'product':_0x3cf61b,'invoice':_0x20c007,'master_shop':_0x1fd41d,'language':_0x4de41f,'find_data':_0xb4b2b4,'rooms_data':_0x25689d});})['catch'](_0x3063be=>{var _0x308b4f=_0x2e805e;_0x2c08d4[_0x308b4f(0x280)](_0x308b4f(0x28d),_0x308b4f(0x2a1)),_0x558da0[_0x308b4f(0x1a8)](_0x308b4f(0x1a7));});}catch(_0x37df85){console[_0x2e805e(0x271)](_0x37df85);}}),router[a0_0x574941(0x247)](a0_0x574941(0x2a0),auth,async(_0x702bfb,_0x43577b)=>{var _0x5a9da1=a0_0x574941;try{const _0x25a172=_0x702bfb[_0x5a9da1(0x2ba)]['id'];console[_0x5a9da1(0x271)](_0x25a172);const _0x13022f=await master_shop[_0x5a9da1(0x288)]();console[_0x5a9da1(0x271)](_0x5a9da1(0x264),_0x13022f);const _0xd34910=await product[_0x5a9da1(0x1ba)]({'name':_0x25a172});console[_0x5a9da1(0x271)](_0x5a9da1(0x1da),_0xd34910),_0x43577b[_0x5a9da1(0x1e5)](0xc8)['json']({'product_data':_0xd34910,'master':_0x13022f});}catch(_0x45eab0){console[_0x5a9da1(0x271)]('add_purchases\x20error',_0x45eab0);}}),router[a0_0x574941(0x1a1)]('/view/add_purchases',auth,async(_0x1570e0,_0x49a097)=>{var _0x836c24=a0_0x574941;try{const {invoice:_0x430d45,date:_0x56d92b,warehouse_name:_0x34cd80,prod_name:_0x373213,note:_0x2b0f09,due_amount:_0x14384c,Room_name:_0x3869d4,PO_number:_0x2fa393,SCRN:_0x3cfb5d,ReqBy:_0x493aa8,dateofreq:_0x2102ec,suppliers:_0x118ad2,typeservicesData:_0x5a080b,van:_0x3a7cee,typevehicle:_0x354df1,driver:_0x56113e,plate:_0x74efd7,DRSI:_0x3bff0c,TSU:_0x2ca346,TFU:_0x2ba6d0,JO_number:_0x5dd549,type_of_products:_0x487eaf}=_0x1570e0['body'];if(typeof _0x373213=='string')var _0x4ebbea=[_0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1af)]],_0x1ad6e0=[_0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1f7)]],_0x3cad51=[_0x1570e0['body'][_0x836c24(0x1c4)]],_0x38eb1b=[_0x1570e0[_0x836c24(0x1d3)]['prod_primunit']],_0x424c8f=[_0x1570e0[_0x836c24(0x1d3)]['prod_secondunit']],_0x1bf2cd=[_0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x2d3)]],_0xb49b7c=[_0x1570e0['body'][_0x836c24(0x1b6)]],_0x3561a1=[_0x1570e0['body'][_0x836c24(0x1c6)]],_0x59a1cd=[_0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1c2)]],_0x499b5a=[_0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x265)]],_0x355e76=[_0x1570e0[_0x836c24(0x1d3)]['product_date']],_0x372896=[_0x1570e0[_0x836c24(0x1d3)]['max_product_unit']],_0x4ff320=[_0x1570e0[_0x836c24(0x1d3)]['prod_cat']],_0x2d0cfa=[_0x1570e0[_0x836c24(0x1d3)]['RoomAssign']],_0x35f0f4=[_0x1570e0['body'][_0x836c24(0x1b2)]],_0x2af946=[_0x1570e0['body'][_0x836c24(0x19b)]],_0x34188e=[_0x1570e0['body'][_0x836c24(0x20c)]],_0x23eb2b=[_0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1e0)]];else var _0x4ebbea=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1af)]],_0x1ad6e0=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1f7)]],_0x3cad51=[..._0x1570e0[_0x836c24(0x1d3)]['prod_Qty']],_0x38eb1b=[..._0x1570e0[_0x836c24(0x1d3)]['prod_primunit']],_0x424c8f=[..._0x1570e0['body'][_0x836c24(0x254)]],_0x1bf2cd=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x2d3)]],_0xb49b7c=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1b6)]],_0x3561a1=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1c6)]],_0x59a1cd=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1c2)]],_0x499b5a=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x265)]],_0x355e76=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x2b0)]],_0x372896=[..._0x1570e0[_0x836c24(0x1d3)]['max_product_unit']],_0x4ff320=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x2e0)]],_0x2d0cfa=[..._0x1570e0[_0x836c24(0x1d3)]['RoomAssign']],_0x35f0f4=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1b2)]],_0x2af946=[..._0x1570e0[_0x836c24(0x1d3)]['uuid']],_0x34188e=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x20c)]],_0x23eb2b=[..._0x1570e0[_0x836c24(0x1d3)][_0x836c24(0x1e0)]];const _0x541225=_0x4ebbea['map'](_0x5e309c=>{return _0x5e309c={'product_name':_0x5e309c};});_0x23eb2b['forEach']((_0x4845c0,_0x2138d0)=>{var _0xb8f48d=_0x836c24;_0x541225[_0x2138d0][_0xb8f48d(0x1e0)]=_0x4845c0,_0x541225[_0x2138d0]['date_recieved']=_0x56d92b;}),_0x34188e[_0x836c24(0x282)]((_0x186769,_0x1ea5f3)=>{var _0x180376=_0x836c24;_0x541225[_0x1ea5f3][_0x180376(0x2a7)]=_0x186769;}),_0x1ad6e0[_0x836c24(0x282)]((_0x3d7c22,_0x556750)=>{var _0x333c07=_0x836c24;_0x541225[_0x556750][_0x333c07(0x240)]=_0x3d7c22;}),_0x2af946[_0x836c24(0x282)]((_0x102fe9,_0x196e8c)=>{var _0x5243b7=_0x836c24;_0x541225[_0x196e8c][_0x5243b7(0x19b)]=_0x102fe9;}),_0x3cad51[_0x836c24(0x282)]((_0x26d300,_0xf3385d)=>{var _0x14dc19=_0x836c24;_0x541225[_0xf3385d][_0x14dc19(0x21c)]=Math[_0x14dc19(0x275)](_0x26d300);}),_0x38eb1b['forEach']((_0x5d57fd,_0x2d277e)=>{var _0x3b4f70=_0x836c24;_0x541225[_0x2d277e][_0x3b4f70(0x1ff)]=_0x5d57fd;}),_0x424c8f['forEach']((_0x5538c1,_0x33089f)=>{var _0x48f53b=_0x836c24;_0x541225[_0x33089f][_0x48f53b(0x27f)]=_0x5538c1;}),_0x1bf2cd['forEach']((_0x8bd0f9,_0x52469b)=>{var _0x291792=_0x836c24;_0x541225[_0x52469b][_0x291792(0x2d3)]=_0x8bd0f9;}),_0xb49b7c[_0x836c24(0x282)]((_0x2816ea,_0x4e9e6f)=>{var _0x31a833=_0x836c24;_0x541225[_0x4e9e6f][_0x31a833(0x1b6)]=_0x2816ea;}),_0x3561a1[_0x836c24(0x282)]((_0x56c795,_0xd5a7d)=>{var _0x386628=_0x836c24;_0x541225[_0xd5a7d][_0x386628(0x1dc)]=_0x56c795;}),_0x59a1cd[_0x836c24(0x282)]((_0x328343,_0x283776)=>{var _0x199d07=_0x836c24;_0x541225[_0x283776][_0x199d07(0x1c2)]=_0x328343;}),_0x499b5a[_0x836c24(0x282)]((_0xa6b01f,_0x26abfa)=>{var _0x211267=_0x836c24;_0x541225[_0x26abfa][_0x211267(0x265)]=_0xa6b01f;}),_0x355e76[_0x836c24(0x282)]((_0x23e4b5,_0x1fbee3)=>{_0x541225[_0x1fbee3]['production_date']=_0x23e4b5;}),_0x372896['forEach']((_0x1feacc,_0x32d035)=>{var _0x52b39f=_0x836c24;_0x541225[_0x32d035][_0x52b39f(0x1c0)]=_0x1feacc;}),_0x4ff320['forEach']((_0x39b0fa,_0x78a8a7)=>{_0x541225[_0x78a8a7]['product_cat']=_0x39b0fa;}),_0x2d0cfa[_0x836c24(0x282)]((_0x2576d6,_0x4c659)=>{var _0x357538=_0x836c24;_0x541225[_0x4c659][_0x357538(0x1df)]=_0x2576d6;}),_0x35f0f4[_0x836c24(0x282)]((_0x3f77d5,_0x425c20)=>{var _0x14ad0a=_0x836c24;_0x541225[_0x425c20][_0x14ad0a(0x1b2)]=_0x3f77d5;});const _0x1a73e1=new invoice_for_incoming();await _0x1a73e1['save']();for(let _0x56aa18=0x0;_0x56aa18<=_0x2d0cfa[_0x836c24(0x213)]-0x1;_0x56aa18++){_0x541225[_0x56aa18][_0x836c24(0x1fc)]=_0x836c24(0x24c)+_0x1a73e1['invoice_init']['toString']()[_0x836c24(0x20a)](0x8,'0');}const _0x279961=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x34cd80}}]);for(let _0x54274a=0x0;_0x54274a<=_0x279961[_0x836c24(0x213)]-0x1;_0x54274a++){const _0x4e533a=_0x279961[_0x54274a];for(let _0x1c4273=0x0;_0x1c4273<=_0x4e533a[_0x836c24(0x2d6)][_0x836c24(0x213)]-0x1;_0x1c4273++){const _0x5d9550=_0x4e533a[_0x836c24(0x2d6)][_0x1c4273],_0x48ec3c=await warehouse[_0x836c24(0x267)]([{'$match':{'name':_0x4e533a[_0x836c24(0x28b)],'room':_0x4e533a[_0x836c24(0x273)]}},{'$unwind':_0x836c24(0x25c)},{'$match':{'product_details.level':_0x5d9550['bay'],'product_details.bay':parseInt(_0x5d9550['bin']),'product_details.product_code':_0x5d9550[_0x836c24(0x240)]}}]);for(let _0x1558d6=0x0;_0x1558d6<=_0x48ec3c[_0x836c24(0x213)]-0x1;_0x1558d6++){let _0x9769e8=_0x48ec3c[_0x1558d6],_0x22fe88=0x0;_0x9769e8['product_details']['product_code']==_0x5d9550[_0x836c24(0x240)]&&_0x9769e8[_0x836c24(0x1e9)][_0x836c24(0x217)]==_0x5d9550[_0x836c24(0x29c)]&&_0x9769e8[_0x836c24(0x1e9)]['level']==_0x5d9550[_0x836c24(0x217)]&&(_0x5d9550[_0x836c24(0x237)]=parseInt(_0x5d9550['max'])-parseInt(_0x9769e8[_0x836c24(0x1e9)][_0x836c24(0x1e8)]),_0x22fe88++),_0x22fe88=='0'&&(parseInt(_0x5d9550[_0x836c24(0x237)])>0x0&&(_0x279961[_0x54274a][_0x836c24(0x2d6)]=_0x279961[_0x54274a][_0x836c24(0x2d6)]['concat']({'bay':_0x5d9550['bay'],'bin':_0x5d9550[_0x836c24(0x29c)],'max':_0x5d9550[_0x836c24(0x237)],'min':_0x5d9550[_0x836c24(0x1f0)],'product_code':_0x5d9550[_0x836c24(0x240)],'product_id':_0x5d9550[_0x836c24(0x1e0)],'product_name':_0x5d9550[_0x836c24(0x297)]})));}}_0x279961[_0x54274a][_0x836c24(0x2d6)]=_0x279961[_0x54274a][_0x836c24(0x2d6)][_0x836c24(0x23b)](_0x4be2f1=>parseInt(_0x4be2f1[_0x836c24(0x237)])>0x0);}let _0x129438=[];for(let _0x4519b7=0x0;_0x4519b7<=_0x541225[_0x836c24(0x213)]-0x1;_0x4519b7++){const _0x4aa0ad=_0x541225[_0x4519b7];for(let _0x5dd077=0x0;_0x5dd077<=_0x279961[_0x836c24(0x213)]-0x1;_0x5dd077++){const _0x2e9a14=_0x279961[_0x5dd077];for(let _0x5e9dc1=0x0;_0x5e9dc1<=_0x2e9a14[_0x836c24(0x2d6)][_0x836c24(0x213)]-0x1;_0x5e9dc1++){const _0x157925=_0x2e9a14[_0x836c24(0x2d6)][_0x5e9dc1];if(_0x157925[_0x836c24(0x240)]===_0x4aa0ad[_0x836c24(0x240)]){let _0x46b9e0=_0x4aa0ad[_0x836c24(0x21c)];const _0x232576=await warehouse[_0x836c24(0x267)]([{'$match':{'name':_0x34cd80,'room':_0x2e9a14[_0x836c24(0x273)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x157925[_0x836c24(0x217)],'product_details.bay':parseInt(_0x157925['bin'])}}]);if(_0x232576[_0x836c24(0x213)]==0x0){for(let _0x5cadba=0x0;_0x5cadba<=_0x2e9a14['product_data']['length']-0x1&&_0x46b9e0>0x0;_0x5cadba++){const _0x73fe08=_0x2e9a14[_0x836c24(0x2d6)][_0x5cadba];if(_0x4aa0ad['product_code']===_0x73fe08[_0x836c24(0x240)]){_0x129438[_0x5cadba]={};const _0x1c268c=parseInt(_0x73fe08[_0x836c24(0x237)]),_0x21fe2b=0x0;let _0x53fd9d=_0x1c268c-_0x21fe2b,_0x125b31=Math[_0x836c24(0x1f0)](_0x46b9e0,_0x53fd9d);console[_0x836c24(0x271)](_0x836c24(0x2d1)+_0x125b31+_0x836c24(0x1d2)+_0x2e9a14[_0x836c24(0x28b)]+',\x20room:\x20'+_0x2e9a14['room']+_0x836c24(0x258)+_0x73fe08[_0x836c24(0x217)]+_0x836c24(0x1b0)+_0x73fe08[_0x836c24(0x29c)]),_0x129438[_0x5cadba]['product_name']=_0x4aa0ad['product_name'],_0x129438[_0x5cadba]['product_code']=_0x4aa0ad[_0x836c24(0x240)],_0x129438[_0x5cadba]['product_id']=_0x4aa0ad['product_id'],_0x129438[_0x5cadba][_0x836c24(0x1d7)]=_0x4aa0ad['date_recieved'],_0x129438[_0x5cadba][_0x836c24(0x2a7)]=_0x4aa0ad['sales_category'],_0x129438[_0x5cadba][_0x836c24(0x19b)]=_0x4aa0ad['uuid'],_0x129438[_0x5cadba]['quantity']=_0x125b31,_0x129438[_0x5cadba][_0x836c24(0x1ff)]=_0x4aa0ad[_0x836c24(0x1ff)],_0x129438[_0x5cadba][_0x836c24(0x27f)]=_0x4aa0ad[_0x836c24(0x27f)],_0x129438[_0x5cadba][_0x836c24(0x2d3)]=_0x4aa0ad[_0x836c24(0x2d3)],_0x129438[_0x5cadba][_0x836c24(0x1b6)]=_0x4aa0ad[_0x836c24(0x1b6)],_0x129438[_0x5cadba][_0x836c24(0x1dc)]=_0x4aa0ad[_0x836c24(0x1dc)],_0x129438[_0x5cadba]['batch_code']=_0x4aa0ad[_0x836c24(0x1c2)],_0x129438[_0x5cadba][_0x836c24(0x265)]=_0x4aa0ad[_0x836c24(0x265)],_0x129438[_0x5cadba][_0x836c24(0x292)]=_0x4aa0ad['production_date'],_0x129438[_0x5cadba]['maxperunit']=_0x4aa0ad[_0x836c24(0x1c0)],_0x129438[_0x5cadba][_0x836c24(0x1b5)]=_0x4aa0ad[_0x836c24(0x1b5)],_0x129438[_0x5cadba][_0x836c24(0x1fc)]=_0x4aa0ad['invoice'],_0x129438[_0x5cadba][_0x836c24(0x1b2)]=_0x4aa0ad[_0x836c24(0x1b2)],_0x129438[_0x5cadba][_0x836c24(0x1df)]=_0x2e9a14['room'],_0x129438[_0x5cadba][_0x836c24(0x19c)]=_0x73fe08['bay'],_0x129438[_0x5cadba]['bay']=_0x73fe08[_0x836c24(0x29c)],_0x46b9e0-=_0x125b31;if(_0x46b9e0<=0x0)break;}}if(_0x46b9e0<=0x0)break;_0x46b9e0>0x0&&console[_0x836c24(0x271)](_0x836c24(0x1f1)+_0x46b9e0+_0x836c24(0x2bc));}else console['log'](_0x157925[_0x836c24(0x240)]+_0x836c24(0x248)+_0x157925[_0x836c24(0x217)]+_0x836c24(0x248)+_0x157925['bin']);}}}}const _0xa7c5bd=_0x129438[_0x836c24(0x23b)](_0x341330=>_0x341330[_0x836c24(0x21c)]!=='0'&&_0x341330['quantity']!==''),_0x2fccba=new purchases_finished({'invoice':_0x836c24(0x24c)+_0x1a73e1[_0x836c24(0x1e3)][_0x836c24(0x2a5)]()['padStart'](0x8,'0'),'suppliers':_0x118ad2,'date':_0x56d92b,'warehouse_name':_0x34cd80,'product':_0xa7c5bd,'note':_0x2b0f09,'due_amount':_0x14384c,'room':_0x3869d4,'POnumber':_0x2fa393,'SCRN':_0x3cfb5d,'JO_number':_0x5dd549,'ReqBy':_0x493aa8,'dateofreq':_0x2102ec,'typeservicesData':_0x5a080b,'van':_0x3a7cee,'typevehicle':_0x354df1,'driver':_0x56113e,'plate':_0x74efd7,'DRSI':_0x3bff0c,'TSU':_0x2ca346,'TFU':_0x2ba6d0,'typeOfProducts':_0x487eaf}),_0xc9e4d9=await _0x2fccba['save'](),_0x237c09=await purchases_finished[_0x836c24(0x1ba)]({'_id':_0xc9e4d9[_0x836c24(0x241)][_0x836c24(0x2df)]()});_0x1570e0[_0x836c24(0x280)](_0x836c24(0x252),_0x836c24(0x268)),_0x49a097[_0x836c24(0x1a8)](_0x836c24(0x286)+_0x237c09[_0x836c24(0x241)][_0x836c24(0x2df)]());}catch(_0x9d006c){console[_0x836c24(0x271)](_0x9d006c);}}),router[a0_0x574941(0x247)]('/process/:id',auth,async(_0x4ec6ab,_0x40bcb7)=>{var _0x4092e8=a0_0x574941;try{const {username:_0x19df45,email:_0x10a290,role:_0x369d69}=_0x4ec6ab[_0x4092e8(0x2ca)],_0xea9a4=_0x4ec6ab[_0x4092e8(0x2ca)],_0x1c9922=_0x4ec6ab[_0x4092e8(0x2ba)]['id'],_0x1c77a1=await profile['findOne']({'email':_0xea9a4[_0x4092e8(0x2b9)]}),_0x1870bb=await master_shop['find'](),_0x4844b6=await staff['findOne']({'email':_0xea9a4[_0x4092e8(0x2b9)]}),_0x1f8873=await suppliers['find']({});let _0x44cdc2;if(_0xea9a4[_0x4092e8(0x1ee)]=='staff'){const _0x189dba=await staff['findOne']({'email':_0xea9a4[_0x4092e8(0x2b9)]});_0x44cdc2=await warehouse[_0x4092e8(0x267)]([{'$match':{'status':_0x4092e8(0x207),'name':_0x189dba[_0x4092e8(0x2d5)]}},{'$group':{'_id':_0x4092e8(0x27c),'name':{'$first':_0x4092e8(0x27c)}}}]);}else _0x44cdc2=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4092e8(0x27c),'name':{'$first':_0x4092e8(0x27c)}}}]);const _0x1ef1b7=await purchases_finished[_0x4092e8(0x263)](_0x1c9922);if(_0x1870bb[0x0][_0x4092e8(0x2e1)]=='English\x20(US)')var _0x4542ed=users['English'];else{if(_0x1870bb[0x0]['language']=='Hindi')var _0x4542ed=users[_0x4092e8(0x2c0)];else{if(_0x1870bb[0x0][_0x4092e8(0x2e1)]==_0x4092e8(0x1e7))var _0x4542ed=users[_0x4092e8(0x1e7)];else{if(_0x1870bb[0x0][_0x4092e8(0x2e1)]=='Spanish')var _0x4542ed=users[_0x4092e8(0x1e2)];else{if(_0x1870bb[0x0][_0x4092e8(0x2e1)]==_0x4092e8(0x19f))var _0x4542ed=users[_0x4092e8(0x19f)];else{if(_0x1870bb[0x0][_0x4092e8(0x2e1)]=='Portuguese\x20(BR)')var _0x4542ed=users['Portuguese'];else{if(_0x1870bb[0x0][_0x4092e8(0x2e1)]==_0x4092e8(0x23d))var _0x4542ed=users['Chinese'];else{if(_0x1870bb[0x0]['language']==_0x4092e8(0x1ab))var _0x4542ed=users[_0x4092e8(0x22b)];}}}}}}}_0x40bcb7['render'](_0x4092e8(0x28e),{'success':_0x4ec6ab[_0x4092e8(0x280)](_0x4092e8(0x252)),'errors':_0x4ec6ab[_0x4092e8(0x280)](_0x4092e8(0x28d)),'role':_0xea9a4,'profile':_0x1c77a1,'suppliers':_0x1f8873,'warehouse':_0x44cdc2,'master_shop':_0x1870bb,'language':_0x4542ed,'purchases_data':_0x1ef1b7});}catch(_0xcbe0c1){console[_0x4092e8(0x271)](_0xcbe0c1);}});async function get_warehouse_data(_0x3b9cee,_0x31ed2a){var _0x10dead=a0_0x574941;try{const _0x3009d6=await warehouse_temporary[_0x10dead(0x1ba)]({'name':_0x3b9cee,'room':_0x31ed2a});if(!_0x3009d6){const _0x3abcd8=new warehouse_temporary({'name':_0x3b9cee,'address':_0x3b9cee,'status':_0x10dead(0x207),'room':_0x31ed2a,'isStaging':_0x10dead(0x2a2)});return await _0x3abcd8['save'](),_0x3abcd8;}else return _0x3009d6;}catch(_0x8820e2){console[_0x10dead(0x25e)](_0x10dead(0x25d),_0x8820e2);throw _0x8820e2;}}router[a0_0x574941(0x1a1)](a0_0x574941(0x2de),auth,async(_0x3f5b33,_0x17f7e7)=>{var _0x4a2ccc=a0_0x574941;try{const _0x27e258=_0x3f5b33[_0x4a2ccc(0x2ba)]['id'],_0x2a95d3=await purchases_finished[_0x4a2ccc(0x263)](_0x27e258);let _0x322d11=[];_0x2a95d3['product'][_0x4a2ccc(0x282)]((_0x3444cf,_0x45023b)=>{var _0x1a8f10=_0x4a2ccc;_0x322d11[_0x45023b]={},_0x322d11[_0x45023b][_0x1a8f10(0x2d5)]=_0x2a95d3['warehouse_name'],_0x322d11[_0x45023b]['product_id']=_0x3444cf[_0x1a8f10(0x1e0)],_0x322d11[_0x45023b][_0x1a8f10(0x297)]=_0x3444cf[_0x1a8f10(0x297)],_0x322d11[_0x45023b]['product_code']=_0x3444cf[_0x1a8f10(0x240)],_0x322d11[_0x45023b][_0x1a8f10(0x1e8)]=_0x3444cf['quantity'],_0x322d11[_0x45023b][_0x1a8f10(0x19d)]=_0x3444cf['standard_unit'],_0x322d11[_0x45023b]['secondary_unit']=_0x3444cf[_0x1a8f10(0x27f)],_0x322d11[_0x45023b][_0x1a8f10(0x19c)]=_0x3444cf[_0x1a8f10(0x19c)],_0x322d11[_0x45023b]['bay']=_0x3444cf[_0x1a8f10(0x217)],_0x322d11[_0x45023b][_0x1a8f10(0x2d3)]=_0x3444cf['primary_code'],_0x322d11[_0x45023b][_0x1a8f10(0x1b6)]=_0x3444cf[_0x1a8f10(0x1b6)],_0x322d11[_0x45023b][_0x1a8f10(0x1dc)]=_0x3444cf['maxStocks'],_0x322d11[_0x45023b][_0x1a8f10(0x1c2)]=_0x3444cf[_0x1a8f10(0x1c2)],_0x322d11[_0x45023b][_0x1a8f10(0x265)]=_0x3444cf[_0x1a8f10(0x265)],_0x322d11[_0x45023b]['production_date']=_0x3444cf[_0x1a8f10(0x292)],_0x322d11[_0x45023b][_0x1a8f10(0x1c0)]=_0x3444cf[_0x1a8f10(0x1c0)],_0x322d11[_0x45023b]['product_cat']=_0x3444cf[_0x1a8f10(0x1b5)],_0x322d11[_0x45023b][_0x1a8f10(0x1df)]=_0x3444cf['room_name'],_0x322d11[_0x45023b][_0x1a8f10(0x1fc)]=_0x3444cf[_0x1a8f10(0x1fc)],_0x322d11[_0x45023b][_0x1a8f10(0x19b)]=_0x3444cf[_0x1a8f10(0x19b)],_0x322d11[_0x45023b]['gross_price']=_0x3444cf[_0x1a8f10(0x1b2)],_0x322d11[_0x45023b]['sales_category']=_0x3444cf[_0x1a8f10(0x2a7)],_0x322d11[_0x45023b][_0x1a8f10(0x1d7)]=_0x3444cf[_0x1a8f10(0x1d7)],_0x322d11[_0x45023b][_0x1a8f10(0x2bd)]=_0x3444cf[_0x1a8f10(0x241)]['valueOf'](),_0x322d11[_0x45023b][_0x1a8f10(0x20e)]=_0x1a8f10(0x23c),_0x322d11[_0x45023b][_0x1a8f10(0x24a)]=_0x1a8f10(0x2be),_0x322d11[_0x45023b]['isUsed']='false';});for(let _0x34961f=0x0;_0x34961f<=_0x322d11[_0x4a2ccc(0x213)]-0x1;_0x34961f++){const _0x1121c4=_0x322d11[_0x34961f],_0x31da35=new warehouse_temporary(_0x1121c4);await _0x31da35['save']();}_0x2a95d3[_0x4a2ccc(0x1ca)]=_0x4a2ccc(0x2be),await _0x2a95d3['save'](),_0x3f5b33['flash'](_0x4a2ccc(0x252),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x17f7e7[_0x4a2ccc(0x1a8)](_0x4a2ccc(0x286)+_0x2a95d3[_0x4a2ccc(0x241)][_0x4a2ccc(0x2df)]());}catch(_0x28c26c){}}),router[a0_0x574941(0x1a1)](a0_0x574941(0x2af),auth,async(_0x5aa870,_0x2e3972)=>{var _0x2ec5b5=a0_0x574941;try{const {invoice:_0x4f3b95,date:_0x112eb9,warehouse_name:_0x2632c8,prod_name:_0x27b937,note:_0x2355bf,due_amount:_0x2121bd,Room_name:_0x145a51,PO_number:_0x214036,SCRN:_0x515132,ReqBy:_0x2bb85c,dateofreq:_0x228059,suppliers:_0x488c32,typeservicesData:_0x73dbbc,van:_0x332fb4,typevehicle:_0x2c0dca,driver:_0x3d6e15,plate:_0x3c7dc9,DRSI:_0x328e85,TSU:_0x793ad8,TFU:_0x576081,JO_number:_0x4d6b2d,type_of_products:_0x284c00}=_0x5aa870['body'];if(typeof _0x27b937=='string')var _0x50c35a=[_0x5aa870[_0x2ec5b5(0x1d3)]['prod_name']],_0x52ac67=[_0x5aa870[_0x2ec5b5(0x1d3)]['prod_code']],_0x4a7ffe=[_0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1c4)]],_0xb768d8=[_0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x234)]],_0x1132dc=[_0x5aa870[_0x2ec5b5(0x1d3)]['prod_secondunit']],_0xbe1714=[_0x5aa870['body'][_0x2ec5b5(0x21f)]],_0x22e30a=[_0x5aa870['body'][_0x2ec5b5(0x2d3)]],_0x5a1b01=[_0x5aa870[_0x2ec5b5(0x1d3)]['secondary_code']],_0x1ddfdb=[_0x5aa870[_0x2ec5b5(0x1d3)]['MaxStocks_data']],_0x4f4013=[_0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1c2)]],_0x282b71=[_0x5aa870['body'][_0x2ec5b5(0x265)]],_0x3653bb=[_0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x2b0)]],_0x17828c=[_0x5aa870[_0x2ec5b5(0x1d3)]['max_product_unit']],_0x525fcf=[_0x5aa870['body'][_0x2ec5b5(0x2e0)]],_0x4eb1a7=[_0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1b9)]],_0x7c9148=[_0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1b2)]],_0x15279b=[_0x5aa870[_0x2ec5b5(0x1d3)]['uuid']],_0x226917=[_0x5aa870['body'][_0x2ec5b5(0x20c)]],_0x296d5d=[_0x5aa870['body']['type_of_products_type']];else var _0x50c35a=[..._0x5aa870['body'][_0x2ec5b5(0x1af)]],_0x52ac67=[..._0x5aa870['body'][_0x2ec5b5(0x1f7)]],_0x4a7ffe=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1c4)]],_0xb768d8=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x234)]],_0x1132dc=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x254)]],_0xbe1714=[..._0x5aa870['body']['prod_level']],_0x22e30a=[..._0x5aa870['body'][_0x2ec5b5(0x2d3)]],_0x5a1b01=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1b6)]],_0x1ddfdb=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1c6)]],_0x4f4013=[..._0x5aa870[_0x2ec5b5(0x1d3)]['batch_code']],_0x282b71=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x265)]],_0x3653bb=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x2b0)]],_0x17828c=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x1cf)]],_0x525fcf=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x2e0)]],_0x4eb1a7=[..._0x5aa870['body'][_0x2ec5b5(0x1b9)]],_0x7c9148=[..._0x5aa870['body'][_0x2ec5b5(0x1b2)]],_0x15279b=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x19b)]],_0x226917=[..._0x5aa870['body'][_0x2ec5b5(0x20c)]],_0x296d5d=[..._0x5aa870[_0x2ec5b5(0x1d3)][_0x2ec5b5(0x276)]];const _0x9d71b4=_0x50c35a['map'](_0xcabf96=>{return _0xcabf96={'product_name':_0xcabf96};});_0x296d5d['forEach']((_0x785ba,_0x2bd4a5)=>{var _0x30590f=_0x2ec5b5;_0x9d71b4[_0x2bd4a5][_0x30590f(0x1e6)]=_0x785ba;}),_0x226917['forEach']((_0x1089f3,_0x4b8801)=>{var _0x27f4d8=_0x2ec5b5;_0x9d71b4[_0x4b8801][_0x27f4d8(0x2a7)]=_0x1089f3;}),_0x52ac67['forEach']((_0x5744cd,_0x18a983)=>{var _0x2289b3=_0x2ec5b5;_0x9d71b4[_0x18a983][_0x2289b3(0x240)]=_0x5744cd;}),_0x15279b[_0x2ec5b5(0x282)]((_0x517784,_0x199d6b)=>{var _0x4f12eb=_0x2ec5b5;_0x9d71b4[_0x199d6b][_0x4f12eb(0x19b)]=_0x517784;}),_0x4a7ffe[_0x2ec5b5(0x282)]((_0x2dd07e,_0x1055ed)=>{var _0x4607dd=_0x2ec5b5;_0x9d71b4[_0x1055ed][_0x4607dd(0x21c)]=Math[_0x4607dd(0x275)](_0x2dd07e);}),_0xb768d8[_0x2ec5b5(0x282)]((_0x40ca69,_0x4c3cbc)=>{_0x9d71b4[_0x4c3cbc]['standard_unit']=_0x40ca69;}),_0x1132dc[_0x2ec5b5(0x282)]((_0x3b7578,_0x3f9b9d)=>{var _0x2221f4=_0x2ec5b5;_0x9d71b4[_0x3f9b9d][_0x2221f4(0x27f)]=_0x3b7578;}),_0xbe1714[_0x2ec5b5(0x282)]((_0x51d7a7,_0xaf4bd5)=>{var _0x21164e=_0x2ec5b5,_0x162223=_0x51d7a7[_0x21164e(0x27d)](/[A-Za-z]+/)[0x0],_0x5241c8=parseInt(_0x51d7a7[_0x21164e(0x27d)](/\d+/)[0x0]);_0x9d71b4[_0xaf4bd5][_0x21164e(0x19c)]=_0x162223,_0x9d71b4[_0xaf4bd5]['bay']=_0x5241c8;}),_0x22e30a[_0x2ec5b5(0x282)]((_0x21aebe,_0x5de39c)=>{var _0x245be8=_0x2ec5b5;_0x9d71b4[_0x5de39c][_0x245be8(0x2d3)]=_0x21aebe;}),_0x5a1b01[_0x2ec5b5(0x282)]((_0xab20a0,_0x182e6c)=>{var _0x3bbf75=_0x2ec5b5;_0x9d71b4[_0x182e6c][_0x3bbf75(0x1b6)]=_0xab20a0;}),_0x1ddfdb[_0x2ec5b5(0x282)]((_0x50875c,_0x25c1c3)=>{var _0x2b59a9=_0x2ec5b5;_0x9d71b4[_0x25c1c3][_0x2b59a9(0x1dc)]=_0x50875c;}),_0x4f4013['forEach']((_0x2cedd4,_0x530103)=>{_0x9d71b4[_0x530103]['batch_code']=_0x2cedd4;}),_0x282b71[_0x2ec5b5(0x282)]((_0x2c2fdd,_0xfd0e3e)=>{var _0x43d123=_0x2ec5b5;_0x9d71b4[_0xfd0e3e][_0x43d123(0x265)]=_0x2c2fdd;}),_0x3653bb['forEach']((_0x57d5d3,_0x52eb48)=>{var _0x37ee16=_0x2ec5b5;_0x9d71b4[_0x52eb48][_0x37ee16(0x292)]=_0x57d5d3;}),_0x17828c[_0x2ec5b5(0x282)]((_0x424a24,_0x52edbd)=>{_0x9d71b4[_0x52edbd]['maxperunit']=_0x424a24;}),_0x525fcf['forEach']((_0x4aa625,_0x1c4552)=>{var _0x3ae3f8=_0x2ec5b5;_0x9d71b4[_0x1c4552][_0x3ae3f8(0x1b5)]=_0x4aa625;}),_0x4eb1a7[_0x2ec5b5(0x282)]((_0x21f75e,_0x57e8dd)=>{var _0x2720f0=_0x2ec5b5;_0x9d71b4[_0x57e8dd][_0x2720f0(0x1df)]=_0x21f75e;}),_0x7c9148[_0x2ec5b5(0x282)]((_0x1509bd,_0x65ebc4)=>{_0x9d71b4[_0x65ebc4]['gross_price']=_0x1509bd;});const _0x5a491a=new purchases_logs();await _0x5a491a['save']();for(let _0x2cfdca=0x0;_0x2cfdca<=_0x4eb1a7[_0x2ec5b5(0x213)]-0x1;_0x2cfdca++){_0x9d71b4[_0x2cfdca][_0x2ec5b5(0x1fc)]=_0x2ec5b5(0x24b)+_0x5a491a[_0x2ec5b5(0x1e3)][_0x2ec5b5(0x2a5)]()[_0x2ec5b5(0x20a)](0x8,'0');}const _0x13b0a7=_0x9d71b4[_0x2ec5b5(0x23b)](_0x524671=>_0x524671[_0x2ec5b5(0x21c)]!=='0'&&_0x524671[_0x2ec5b5(0x21c)]!==''),_0x31e999=new purchases_finished({'invoice':'LOG-INC-'+_0x5a491a[_0x2ec5b5(0x1e3)][_0x2ec5b5(0x2a5)]()['padStart'](0x8,'0'),'suppliers':_0x488c32,'date':_0x112eb9,'warehouse_name':_0x2632c8,'product':_0x13b0a7,'note':_0x2355bf,'due_amount':_0x2121bd,'room':_0x145a51,'POnumber':_0x214036,'SCRN':_0x515132,'JO_number':_0x4d6b2d,'ReqBy':_0x2bb85c,'dateofreq':_0x228059,'typeservicesData':_0x73dbbc,'van':_0x332fb4,'typevehicle':_0x2c0dca,'driver':_0x3d6e15,'plate':_0x3c7dc9,'DRSI':_0x328e85,'TSU':_0x793ad8,'TFU':_0x576081,'typeOfProducts':_0x284c00}),_0x5012bd=await _0x31e999[_0x2ec5b5(0x2c7)](),_0x32ff7e=await purchases_finished['findOne']({'_id':_0x5012bd[_0x2ec5b5(0x241)][_0x2ec5b5(0x2df)]()}),_0x5761f2=_0x32ff7e[_0x2ec5b5(0x1da)][_0x2ec5b5(0x1d9)](async _0x5e06c9=>{var _0x1dbada=_0x2ec5b5;try{var _0x20808a=await warehouse[_0x1dbada(0x1ba)]({'name':_0x2632c8,'room':_0x5e06c9[_0x1dbada(0x1df)]}),_0x1b9dcf=0x0;const _0x5ad4ce=_0x20808a['product_details'][_0x1dbada(0x1d9)](_0x43e255=>{var _0x30e154=_0x1dbada;console[_0x30e154(0x271)](_0x43e255['product_name']+'=='+_0x5e06c9[_0x30e154(0x297)]+'&&'+_0x43e255[_0x30e154(0x217)]+'=='+_0x5e06c9[_0x30e154(0x217)]+'&&'+_0x43e255[_0x30e154(0x265)]+'=='+_0x5e06c9[_0x30e154(0x265)]+'&&'+_0x43e255[_0x30e154(0x292)]+'=='+_0x5e06c9[_0x30e154(0x292)]+'&&'+_0x43e255['batch_code']+'=='+_0x5e06c9[_0x30e154(0x1c2)]+'&&'+_0x43e255['invoice']+'=='+_0x32ff7e[_0x30e154(0x1fc)]),_0x43e255[_0x30e154(0x297)]==_0x5e06c9[_0x30e154(0x297)]&&_0x43e255['bay']==_0x5e06c9['bay']&&_0x43e255[_0x30e154(0x19c)]==_0x5e06c9[_0x30e154(0x19c)]&&_0x43e255[_0x30e154(0x265)]==_0x5e06c9[_0x30e154(0x265)]&&_0x43e255[_0x30e154(0x292)]==_0x5e06c9['production_date']&&_0x43e255[_0x30e154(0x1c2)]==_0x5e06c9[_0x30e154(0x1c2)]&&_0x43e255[_0x30e154(0x1fc)]==_0x32ff7e[_0x30e154(0x1fc)]&&(_0x43e255['product_stock']=Math[_0x30e154(0x275)](_0x43e255[_0x30e154(0x1e8)])+Math[_0x30e154(0x275)](_0x5e06c9[_0x30e154(0x21c)]),_0x1b9dcf++);});return _0x1b9dcf==0x0&&(_0x20808a[_0x1dbada(0x1e9)]=_0x20808a[_0x1dbada(0x1e9)][_0x1dbada(0x2a9)]({'product_name':_0x5e06c9[_0x1dbada(0x297)],'product_stock':Math[_0x1dbada(0x275)](_0x5e06c9[_0x1dbada(0x21c)]),'primary_code':_0x5e06c9[_0x1dbada(0x2d3)],'secondary_code':_0x5e06c9[_0x1dbada(0x1b6)],'product_code':_0x5e06c9[_0x1dbada(0x240)],'bay':_0x5e06c9[_0x1dbada(0x217)],'level':_0x5e06c9[_0x1dbada(0x19c)],'maxProducts':_0x5e06c9['maxStocks'],'unit':_0x5e06c9[_0x1dbada(0x1ff)],'secondary_unit':_0x5e06c9['secondary_unit'],'expiry_date':_0x5e06c9[_0x1dbada(0x265)],'production_date':_0x5e06c9['production_date'],'maxProducts':_0x5e06c9['maxStocks'],'maxPerUnit':_0x5e06c9[_0x1dbada(0x1c0)],'batch_code':_0x5e06c9[_0x1dbada(0x1c2)],'product_cat':_0x5e06c9[_0x1dbada(0x1b5)],'invoice':_0x5e06c9[_0x1dbada(0x1fc)],'id_incoming':_0x5e06c9[_0x1dbada(0x241)],'uuid':_0x5e06c9[_0x1dbada(0x19b)],'gross_price':_0x5e06c9[_0x1dbada(0x1b2)],'sales_category':_0x5e06c9['sales_category'],'type_products':_0x5e06c9[_0x1dbada(0x1e6)]})),_0x20808a;}catch(_0x19a8c9){return console[_0x1dbada(0x25e)](_0x1dbada(0x2b4),_0x19a8c9),null;}});Promise[_0x2ec5b5(0x21e)](_0x5761f2)[_0x2ec5b5(0x2b1)](async _0x1041bd=>{var _0x37e868=_0x2ec5b5;try{for(const _0x125f69 of _0x1041bd){await warehouse['updateOne']({'_id':_0x125f69[_0x37e868(0x241)]},{'$addToSet':{'product_details':{'$each':_0x125f69[_0x37e868(0x1e9)]}}});}const _0xc86d45=await master_shop['find'](),_0x61cab4=await email_settings[_0x37e868(0x1ba)](),_0x55bb67=await supervisor_settings['find']();var _0x2f84c2=_0x32ff7e[_0x37e868(0x1da)],_0x41a87f='',_0x2ec3ce;for(_0x2ec3ce in _0x2f84c2){var _0x2665d5='FG';_0x32ff7e[_0x37e868(0x28b)]==_0x37e868(0x1f9)&&(_0x2665d5='DG'),_0x41a87f+=_0x37e868(0x1c1)+_0x37e868(0x278)+_0x2f84c2[_0x2ec3ce][_0x37e868(0x297)]+_0x37e868(0x230)+_0x37e868(0x278)+_0x2f84c2[_0x2ec3ce][_0x37e868(0x240)]+_0x37e868(0x230)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f84c2[_0x2ec3ce]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f84c2[_0x2ec3ce][_0x37e868(0x1ff)]+_0x37e868(0x230)+_0x37e868(0x278)+_0x2f84c2[_0x2ec3ce][_0x37e868(0x27f)]+'</td>'+_0x37e868(0x278)+_0x32ff7e[_0x37e868(0x28b)]+_0x37e868(0x230)+_0x37e868(0x278)+_0x2f84c2[_0x2ec3ce][_0x37e868(0x1df)]+'</td>'+_0x37e868(0x278)+_0x2665d5+_0x2f84c2[_0x2ec3ce][_0x37e868(0x217)]+'</td>',_0x37e868(0x1c7);}let _0x5006d7=nodemailer['createTransport']({'host':_0x61cab4[_0x37e868(0x28a)],'port':Number(_0x61cab4[_0x37e868(0x290)]),'secure':![],'auth':{'user':_0x61cab4[_0x37e868(0x2b9)],'pass':_0x61cab4[_0x37e868(0x23f)]}}),_0x533153={'from':_0x61cab4[_0x37e868(0x2b9)],'to':_0x55bb67[0x0][_0x37e868(0x26d)],'subject':_0x37e868(0x202),'attachments':[{'filename':_0x37e868(0x296),'path':__dirname+_0x37e868(0x2c8)+_0x37e868(0x1fd)+_0xc86d45[0x0][_0x37e868(0x1a3)],'cid':_0x37e868(0x1a9)}],'html':'<!DOCTYPE\x20html>'+_0x37e868(0x2d8)+'</head><body>'+_0x37e868(0x257)+_0x37e868(0x26a)+'<div>'+_0x37e868(0x210)+_0x37e868(0x1fa)+'<div>'+_0x37e868(0x284)+_0xc86d45[0x0][_0x37e868(0x219)]+'\x20</h2>'+'</div>'+'</div>'+_0x37e868(0x2d7)+_0x37e868(0x257)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x32ff7e[_0x37e868(0x1fc)]+'\x20'+_0x37e868(0x1b1)+'\x20Order\x20Date\x20:\x20'+_0x32ff7e[_0x37e868(0x2d0)]+'\x20'+_0x37e868(0x1c9)+_0x37e868(0x1c5)+'</div>'+_0x37e868(0x203)+_0x37e868(0x225)+'<tr>'+_0x37e868(0x23e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x37e868(0x22f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x37e868(0x2ab)+_0x37e868(0x232)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x37e868(0x1c7)+_0x37e868(0x228)+_0x37e868(0x1cc)+'\x20'+_0x41a87f+'\x20'+_0x37e868(0x244)+_0x37e868(0x2b8)+'<div>'+_0x37e868(0x28f)+_0x37e868(0x1d1)+_0xc86d45[0x0][_0x37e868(0x219)]+_0x37e868(0x1c5)+_0x37e868(0x1fa)+_0x37e868(0x1fa)+'</body></html>'};_0x5006d7['sendMail'](_0x533153,function(_0x54dbf8,_0x515df8){var _0x23c830=_0x37e868;_0x54dbf8?(console[_0x23c830(0x271)](_0x54dbf8),console[_0x23c830(0x271)]('Error\x20Occurs')):console[_0x23c830(0x271)]('Email\x20sent\x20successfully');});}catch(_0x438139){console[_0x37e868(0x25e)](_0x438139),_0x2e3972[_0x37e868(0x1e5)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x438139['message']});}})[_0x2ec5b5(0x222)](_0x493a99=>{var _0x46778a=_0x2ec5b5;console[_0x46778a(0x25e)](_0x493a99);}),_0x5aa870[_0x2ec5b5(0x280)](_0x2ec5b5(0x252),_0x2ec5b5(0x268)),_0x2e3972[_0x2ec5b5(0x1a8)](_0x2ec5b5(0x26e)+_0x32ff7e['_id'][_0x2ec5b5(0x2df)]());}catch(_0x362fc8){console['log'](_0x362fc8);}}),router['get'](a0_0x574941(0x29e),auth,async(_0x1906cb,_0x216070)=>{var _0x3b3060=a0_0x574941;try{const {username:_0x32dfd8,email:_0x3c6e98,role:_0x2c8323}=_0x1906cb[_0x3b3060(0x2ca)],_0x4fecab=_0x1906cb[_0x3b3060(0x2ca)],_0x47fb3b=await profile['findOne']({'email':_0x4fecab[_0x3b3060(0x2b9)]}),_0x4b6eda=await master_shop[_0x3b3060(0x288)](),_0x28b16f=_0x1906cb[_0x3b3060(0x2ba)]['id'],_0x56e6db=await purchases_finished['findById'](_0x28b16f),_0x4ce897=await suppliers[_0x3b3060(0x288)]({});let _0x532093;if(_0x4fecab['role']=='staff'){const _0x5ab844=await staff[_0x3b3060(0x1ba)]({'email':_0x4fecab[_0x3b3060(0x2b9)]});_0x532093=await warehouse['find']({'status':'Enabled','name':_0x5ab844[_0x3b3060(0x2d5)],'warehouse_category':_0x3b3060(0x1fb)});}else _0x532093=await warehouse['aggregate']([{'$match':{'status':_0x3b3060(0x207),'warehouse_category':_0x3b3060(0x1fb)}},{'$group':{'_id':_0x3b3060(0x27c),'name':{'$first':'$name'}}}]);const _0x4243a4=await product['find']({}),_0x335136=BayBinSelected(_0x56e6db[_0x3b3060(0x28b)],_0x56e6db[_0x3b3060(0x273)]);let _0x4a1602=new Date(_0x56e6db[_0x3b3060(0x265)]),_0x480c7a=('0'+_0x4a1602[_0x3b3060(0x215)]())[_0x3b3060(0x1bd)](-0x2),_0x1782f6=('0'+(_0x4a1602['getMonth']()+0x1))[_0x3b3060(0x1bd)](-0x2),_0x4cb968=_0x4a1602[_0x3b3060(0x251)](),_0xa3bbf7=_0x4cb968+'-'+_0x1782f6+'-'+_0x480c7a;if(_0x4b6eda[0x0]['language']==_0x3b3060(0x1f8)){var _0x583963=users[_0x3b3060(0x235)];console[_0x3b3060(0x271)](_0x583963);}else{if(_0x4b6eda[0x0][_0x3b3060(0x2e1)]=='Hindi')var _0x583963=users[_0x3b3060(0x2c0)];else{if(_0x4b6eda[0x0][_0x3b3060(0x2e1)]==_0x3b3060(0x1e7))var _0x583963=users[_0x3b3060(0x1e7)];else{if(_0x4b6eda[0x0][_0x3b3060(0x2e1)]==_0x3b3060(0x1e2))var _0x583963=users['Spanish'];else{if(_0x4b6eda[0x0][_0x3b3060(0x2e1)]==_0x3b3060(0x19f))var _0x583963=users[_0x3b3060(0x19f)];else{if(_0x4b6eda[0x0][_0x3b3060(0x2e1)]==_0x3b3060(0x20f))var _0x583963=users[_0x3b3060(0x1fe)];else{if(_0x4b6eda[0x0][_0x3b3060(0x2e1)]==_0x3b3060(0x23d))var _0x583963=users[_0x3b3060(0x23d)];else{if(_0x4b6eda[0x0]['language']==_0x3b3060(0x1ab))var _0x583963=users[_0x3b3060(0x22b)];}}}}}}}_0x216070[_0x3b3060(0x214)](_0x3b3060(0x28c),{'success':_0x1906cb[_0x3b3060(0x280)](_0x3b3060(0x252)),'errors':_0x1906cb[_0x3b3060(0x280)](_0x3b3060(0x28d)),'role':_0x4fecab,'profile':_0x47fb3b,'purchases':_0x56e6db,'suppliers':_0x4ce897,'warehouse':_0x532093,'product':_0x4243a4,'master_shop':_0x4b6eda,'language':_0x583963,'ed_fullDate':_0xa3bbf7,'dataSelected':_0x335136});}catch(_0x1a74f7){console['log'](_0x1a74f7);}}),router[a0_0x574941(0x247)](a0_0x574941(0x25f),auth,async(_0x17515e,_0x9260dd)=>{var _0x3bd46f=a0_0x574941;try{const {username:_0x48baa7,email:_0x416335,role:_0x4d39bd}=_0x17515e[_0x3bd46f(0x2ca)],_0x472cca=_0x17515e[_0x3bd46f(0x2ca)],_0x26f0d2=await profile[_0x3bd46f(0x1ba)]({'email':_0x472cca[_0x3bd46f(0x2b9)]}),_0x1a790a=await master_shop[_0x3bd46f(0x288)](),_0x13a538=_0x17515e[_0x3bd46f(0x2ba)]['id'],_0x3a4088=await purchases_finished[_0x3bd46f(0x263)](_0x13a538),_0xa6c6e7=await suppliers['find']({});let _0x2cba47;if(_0x472cca[_0x3bd46f(0x1ee)]==_0x3bd46f(0x243)){const _0x2e34b2=await staff[_0x3bd46f(0x1ba)]({'email':_0x472cca[_0x3bd46f(0x2b9)]});_0x2cba47=await warehouse[_0x3bd46f(0x288)]({'status':_0x3bd46f(0x207),'name':_0x2e34b2[_0x3bd46f(0x2d5)],'warehouse_category':_0x3bd46f(0x1fb)});}else _0x2cba47=await warehouse[_0x3bd46f(0x267)]([{'$match':{'status':'Enabled','warehouse_category':_0x3bd46f(0x1fb)}},{'$group':{'_id':_0x3bd46f(0x27c),'name':{'$first':_0x3bd46f(0x27c)}}}]);const _0xb5624b=await product[_0x3bd46f(0x288)]({}),_0x4a1ef0=BayBinSelected(_0x3a4088['warehouse_name'],_0x3a4088['room']);let _0x5e1d27=new Date(_0x3a4088[_0x3bd46f(0x265)]),_0x1a75dc=('0'+_0x5e1d27['getDate']())[_0x3bd46f(0x1bd)](-0x2),_0x100980=('0'+(_0x5e1d27['getMonth']()+0x1))[_0x3bd46f(0x1bd)](-0x2),_0x2e6459=_0x5e1d27['getFullYear'](),_0x2d9909=_0x2e6459+'-'+_0x100980+'-'+_0x1a75dc;if(_0x1a790a[0x0][_0x3bd46f(0x2e1)]=='English\x20(US)'){var _0x5fd5bd=users[_0x3bd46f(0x235)];console[_0x3bd46f(0x271)](_0x5fd5bd);}else{if(_0x1a790a[0x0]['language']==_0x3bd46f(0x2c0))var _0x5fd5bd=users[_0x3bd46f(0x2c0)];else{if(_0x1a790a[0x0]['language']==_0x3bd46f(0x1e7))var _0x5fd5bd=users[_0x3bd46f(0x1e7)];else{if(_0x1a790a[0x0][_0x3bd46f(0x2e1)]==_0x3bd46f(0x1e2))var _0x5fd5bd=users[_0x3bd46f(0x1e2)];else{if(_0x1a790a[0x0][_0x3bd46f(0x2e1)]==_0x3bd46f(0x19f))var _0x5fd5bd=users['French'];else{if(_0x1a790a[0x0][_0x3bd46f(0x2e1)]==_0x3bd46f(0x20f))var _0x5fd5bd=users[_0x3bd46f(0x1fe)];else{if(_0x1a790a[0x0][_0x3bd46f(0x2e1)]==_0x3bd46f(0x23d))var _0x5fd5bd=users[_0x3bd46f(0x23d)];else{if(_0x1a790a[0x0][_0x3bd46f(0x2e1)]=='Arabic\x20(ae)')var _0x5fd5bd=users[_0x3bd46f(0x22b)];}}}}}}}_0x9260dd['render'](_0x3bd46f(0x1ec),{'success':_0x17515e[_0x3bd46f(0x280)](_0x3bd46f(0x252)),'errors':_0x17515e[_0x3bd46f(0x280)]('errors'),'role':_0x472cca,'profile':_0x26f0d2,'purchases':_0x3a4088,'suppliers':_0xa6c6e7,'warehouse':_0x2cba47,'product':_0xb5624b,'master_shop':_0x1a790a,'language':_0x5fd5bd,'ed_fullDate':_0x2d9909,'dataSelected':_0x4a1ef0});}catch(_0x14480b){console[_0x3bd46f(0x271)](_0x14480b);}}),router[a0_0x574941(0x1a1)]('/view/:id',auth,async(_0x5e4d37,_0x35e829)=>{var _0x474213=a0_0x574941;try{const _0xd3f1ea=_0x5e4d37[_0x474213(0x2ba)]['id'],_0x5a5efd=await purchases_finished[_0x474213(0x1ba)]({'_id':_0x5e4d37[_0x474213(0x2ba)]['id']}),_0x48b15e=await warehouse[_0x474213(0x1ba)]({'name':_0x5a5efd[_0x474213(0x28b)],'room':_0x5a5efd[_0x474213(0x273)]});_0x5a5efd[_0x474213(0x1da)][_0x474213(0x282)](_0x32137c=>{var _0x1b9a91=_0x474213;const _0x5afeca=_0x48b15e[_0x1b9a91(0x1e9)][_0x1b9a91(0x1d9)](_0x492b05=>{var _0x136dc4=_0x1b9a91;_0x492b05['product_name']==_0x32137c['product_name']&&_0x492b05[_0x136dc4(0x217)]==_0x32137c[_0x136dc4(0x217)]&&(_0x492b05[_0x136dc4(0x1e8)]=parseInt(_0x492b05['product_stock'])-parseInt(_0x32137c[_0x136dc4(0x21c)]));});}),await _0x48b15e[_0x474213(0x2c7)]();const {invoice:_0x1140de,suppliers:_0x432c5c,date:_0x16a03b,warehouse_name:_0x247b51,prod_name:_0x2fa49e,prod_code:_0xe9cf32,prod_qty:_0x272f12,prod_unit:_0x914385,prod_secondunit:_0x3d78e0,prod_level:_0x36e9a8,prod_isle:_0x59d297,prod_pallet:_0x5dfd02,note:_0x260c0f,expiry_date:_0x381bd1,batch_code:_0x11ee92,paid_amount:_0x2e7792,due_amount:_0x1e8cca,Room_name:_0x14ad78,primary_code:_0x3cac9c,secondary_code:_0x202104,PO_number:_0x286083,JO_number:_0x5671c1}=_0x5e4d37['body'];if(typeof _0x2fa49e==_0x474213(0x1b7))var _0x21f8f0=[_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x1af)]],_0x484a72=[_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x1f7)]],_0x46502b=[_0x5e4d37[_0x474213(0x1d3)]['prod_qty']],_0x3f913f=[_0x5e4d37['body'][_0x474213(0x2cd)]],_0x594f91=[_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x254)]],_0x1ee581=[_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x21f)]],_0x1f1ef6=[_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x2d3)]],_0x12ec08=[_0x5e4d37[_0x474213(0x1d3)]['secondary_code']],_0x33a881=[_0x5e4d37['body'][_0x474213(0x1c6)]],_0x1f5ce8=[_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x1c2)]],_0x36f28d=[_0x5e4d37[_0x474213(0x1d3)]['expiry_date']];else var _0x21f8f0=[..._0x5e4d37['body'][_0x474213(0x1af)]],_0x484a72=[..._0x5e4d37['body'][_0x474213(0x1f7)]],_0x46502b=[..._0x5e4d37[_0x474213(0x1d3)][_0x474213(0x26c)]],_0x3f913f=[..._0x5e4d37[_0x474213(0x1d3)][_0x474213(0x2cd)]],_0x594f91=[..._0x5e4d37['body']['prod_secondunit']],_0x1ee581=[..._0x5e4d37[_0x474213(0x1d3)][_0x474213(0x21f)]],_0x1f1ef6=[..._0x5e4d37[_0x474213(0x1d3)][_0x474213(0x2d3)]],_0x12ec08=[..._0x5e4d37['body'][_0x474213(0x1b6)]],_0x33a881=[..._0x5e4d37['body'][_0x474213(0x1c6)]],_0x1f5ce8=[..._0x5e4d37[_0x474213(0x1d3)][_0x474213(0x1c2)]],_0x36f28d=[..._0x5e4d37[_0x474213(0x1d3)]['expiry_date']];const _0x450285=_0x21f8f0[_0x474213(0x1d9)](_0x54e11c=>{return _0x54e11c={'product_name':_0x54e11c};});_0x484a72['forEach']((_0x45d51e,_0x3f65e7)=>{var _0x39353e=_0x474213;_0x450285[_0x3f65e7][_0x39353e(0x240)]=_0x45d51e;}),_0x46502b[_0x474213(0x282)]((_0xe45f5d,_0x1caf6a)=>{var _0x818d9c=_0x474213;_0x450285[_0x1caf6a][_0x818d9c(0x21c)]=_0xe45f5d;}),_0x3f913f['forEach']((_0x5bb7ac,_0x2dc718)=>{var _0x425576=_0x474213;_0x450285[_0x2dc718][_0x425576(0x1ff)]=_0x5bb7ac;}),_0x594f91[_0x474213(0x282)]((_0x4d336b,_0x9b024e)=>{_0x450285[_0x9b024e]['secondary_unit']=_0x4d336b;}),_0x1ee581['forEach']((_0x2be967,_0x54ccff)=>{var _0x123b1c=_0x474213;_0x450285[_0x54ccff][_0x123b1c(0x217)]=_0x2be967;}),_0x1f1ef6[_0x474213(0x282)]((_0x7128fc,_0x43433f)=>{var _0x51c98b=_0x474213;_0x450285[_0x43433f][_0x51c98b(0x2d3)]=_0x7128fc;}),_0x12ec08[_0x474213(0x282)]((_0x23ef64,_0x201353)=>{_0x450285[_0x201353]['secondary_code']=_0x23ef64;}),_0x33a881[_0x474213(0x282)]((_0x48a1ae,_0x54d201)=>{_0x450285[_0x54d201]['maxStocks']=_0x48a1ae;}),_0x1f5ce8[_0x474213(0x282)]((_0x510e49,_0x505623)=>{_0x450285[_0x505623]['batch_code']=_0x510e49;}),_0x36f28d['forEach']((_0xeee357,_0x4e29e7)=>{var _0x546bb3=_0x474213;_0x450285[_0x4e29e7][_0x546bb3(0x265)]=_0xeee357;});const _0x2f23ae=_0x450285[_0x474213(0x23b)](_0x5209da=>_0x5209da[_0x474213(0x21c)]!=='0'&&_0x5209da[_0x474213(0x21c)]!=='');_0x5a5efd[_0x474213(0x1fc)]=_0x1140de,_0x5a5efd[_0x474213(0x261)]=_0x432c5c,_0x5a5efd[_0x474213(0x2d0)]=_0x16a03b,_0x5a5efd[_0x474213(0x28b)]=_0x247b51,_0x5a5efd[_0x474213(0x1da)]=_0x2f23ae,_0x5a5efd['note']=_0x260c0f,_0x5a5efd['paid_amount']=_0x2e7792,_0x5a5efd['due_amount']=_0x1e8cca,_0x5a5efd['room']=_0x14ad78,_0x5a5efd[_0x474213(0x277)]=_0x286083,_0x5a5efd[_0x474213(0x2a8)]=_0x5671c1;const _0xabf31b=await _0x5a5efd[_0x474213(0x2c7)](),_0x807b55=await warehouse[_0x474213(0x1ba)]({'name':_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x28b)],'room':_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x27b)]});_0x5a5efd['product']['forEach'](_0x5d88ad=>{var _0x41ffc3=_0x474213,_0x13fd3d=0x0;const _0x18f045=_0x807b55[_0x41ffc3(0x1e9)]['map'](_0x3526ab=>{var _0x46b07a=_0x41ffc3;_0x3526ab['product_name']==_0x5d88ad['product_name']&&_0x3526ab[_0x46b07a(0x217)]==_0x5d88ad['bay']&&(_0x3526ab[_0x46b07a(0x1e8)]=parseInt(_0x3526ab[_0x46b07a(0x1e8)])+parseInt(_0x5d88ad[_0x46b07a(0x21c)]),_0x13fd3d++);});_0x13fd3d=='0'&&(_0x807b55[_0x41ffc3(0x1e9)]=_0x807b55[_0x41ffc3(0x1e9)][_0x41ffc3(0x2a9)]({'product_name':_0x5d88ad['product_name'],'product_stock':_0x5d88ad[_0x41ffc3(0x21c)],'primary_code':_0x5d88ad[_0x41ffc3(0x2d3)],'secondary_code':_0x5d88ad['secondary_code'],'product_code':_0x5d88ad[_0x41ffc3(0x240)],'bay':_0x5d88ad['bay'],'maxProducts':_0x5d88ad[_0x41ffc3(0x1dc)],'unit':_0x5d88ad[_0x41ffc3(0x1ff)],'secondary_unit':_0x5d88ad[_0x41ffc3(0x27f)],'expiry_date':_0x5d88ad[_0x41ffc3(0x265)]}));}),await _0x807b55['save']();const _0x2d5090=await s_payment_data[_0x474213(0x1ba)]({'invoice':_0x5e4d37[_0x474213(0x1d3)]['invoice']});if(_0x2d5090===null){}else console['log'](_0x474213(0x261),_0x2d5090,_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x1fc)]),_0x2d5090['suppliers']=_0x5e4d37[_0x474213(0x1d3)][_0x474213(0x261)],await _0x2d5090[_0x474213(0x2c7)]();_0x5e4d37[_0x474213(0x280)](_0x474213(0x252),_0x474213(0x1c8)),_0x35e829[_0x474213(0x1a8)]('/all_purchases_finished/view');}catch(_0x246262){console['log'](_0x246262);}}),router[a0_0x574941(0x1a1)](a0_0x574941(0x1a6),auth,async(_0x58634b,_0x43903e)=>{var _0xb25914=a0_0x574941;try{const _0x49389e=_0x58634b['params']['id'],{invoice:_0x10c81f,suppliers:_0x489436,payable:_0x2062f6,due_amount:_0x56361d}=_0x58634b[_0xb25914(0x1d3)],_0x20bea2=await purchases['findById'](_0x49389e);var _0x26c173=_0x2062f6-_0x56361d;_0x20bea2[_0xb25914(0x2b6)]=parseFloat(_0x20bea2['paid_amount'])+parseFloat(_0x56361d),_0x20bea2[_0xb25914(0x27a)]=_0x26c173;const _0x4c6724=await _0x20bea2[_0xb25914(0x2c7)]();console['log'](_0x4c6724);const _0x137777=await s_payment_data['findOne']({'invoice':_0x10c81f});_0x137777['amount']=_0x26c173,await _0x137777[_0xb25914(0x2c7)]();let _0x41875c=new Date(),_0x3de0ff=('0'+_0x41875c[_0xb25914(0x215)]())[_0xb25914(0x1bd)](-0x2),_0xb62d7d=('0'+(_0x41875c[_0xb25914(0x1ed)]()+0x1))[_0xb25914(0x1bd)](-0x2),_0x2c9631=_0x41875c[_0xb25914(0x251)](),_0xf8314=_0x2c9631+'-'+_0xb62d7d+'-'+_0x3de0ff;const _0x398afc=new suppliers_payment({'invoice':_0x10c81f,'date':_0x2c9631+'-'+_0xb62d7d+'-'+_0x3de0ff,'suppliers':_0x489436,'reason':_0xb25914(0x274),'amount':_0x56361d}),_0xb5e792=await _0x398afc['save']();_0x58634b[_0xb25914(0x280)](_0xb25914(0x252),_0xb25914(0x29a)),_0x43903e[_0xb25914(0x1a8)]('/all_purchases/view');}catch(_0x2203a1){console['log'](_0x2203a1);}}),router[a0_0x574941(0x247)](a0_0x574941(0x1f6),auth,async(_0x1d4a0b,_0x5749df)=>{var _0xc3630a=a0_0x574941;try{const {username:_0x4c6286,email:_0x419a37,role:_0xeb487}=_0x1d4a0b[_0xc3630a(0x2ca)],_0x26c236=_0x1d4a0b[_0xc3630a(0x2ca)],_0x3d952d=await profile['findOne']({'email':_0x26c236[_0xc3630a(0x2b9)]}),_0x3613aa=await master_shop[_0xc3630a(0x288)]();console[_0xc3630a(0x271)](_0xc3630a(0x264),_0x3613aa);const _0x354bcb=_0x1d4a0b[_0xc3630a(0x2ba)]['id'],_0x1cc018=await purchases['findById'](_0x354bcb);console[_0xc3630a(0x271)](_0x1cc018);const _0x57268c=await suppliers[_0xc3630a(0x1ba)]({'name':_0x1cc018[_0xc3630a(0x261)]});console[_0xc3630a(0x271)](_0x57268c);if(_0x3613aa[0x0][_0xc3630a(0x2e1)]==_0xc3630a(0x1f8)){var _0x2ae9fc=users[_0xc3630a(0x235)];console[_0xc3630a(0x271)](_0x2ae9fc);}else{if(_0x3613aa[0x0]['language']==_0xc3630a(0x2c0))var _0x2ae9fc=users['Hindi'];else{if(_0x3613aa[0x0]['language']==_0xc3630a(0x1e7))var _0x2ae9fc=users[_0xc3630a(0x1e7)];else{if(_0x3613aa[0x0][_0xc3630a(0x2e1)]==_0xc3630a(0x1e2))var _0x2ae9fc=users[_0xc3630a(0x1e2)];else{if(_0x3613aa[0x0]['language']==_0xc3630a(0x19f))var _0x2ae9fc=users[_0xc3630a(0x19f)];else{if(_0x3613aa[0x0]['language']=='Portuguese\x20(BR)')var _0x2ae9fc=users[_0xc3630a(0x1fe)];else{if(_0x3613aa[0x0][_0xc3630a(0x2e1)]==_0xc3630a(0x23d))var _0x2ae9fc=users[_0xc3630a(0x23d)];else{if(_0x3613aa[0x0]['language']==_0xc3630a(0x1ab))var _0x2ae9fc=users[_0xc3630a(0x22b)];}}}}}}}_0x5749df[_0xc3630a(0x214)](_0xc3630a(0x250),{'success':_0x1d4a0b[_0xc3630a(0x280)]('success'),'errors':_0x1d4a0b[_0xc3630a(0x280)](_0xc3630a(0x28d)),'role':_0x26c236,'profile':_0x3d952d,'master_shop':_0x3613aa,'supplier':_0x57268c,'purchase':_0x1cc018,'language':_0x2ae9fc});}catch(_0x455f41){console[_0xc3630a(0x271)](_0x455f41);}}),router[a0_0x574941(0x247)]('/view/return_purchase/:id',auth,async(_0x1c6a20,_0x1ae57a)=>{var _0x50597e=a0_0x574941;try{const {username:_0x474bc5,email:_0x3ec2cf,role:_0x4cebbe}=_0x1c6a20[_0x50597e(0x2ca)],_0x591bc4=_0x1c6a20[_0x50597e(0x2ca)],_0x15929c=await profile[_0x50597e(0x1ba)]({'email':_0x591bc4[_0x50597e(0x2b9)]}),_0x3316b6=await master_shop['find']();console[_0x50597e(0x271)](_0x50597e(0x264),_0x3316b6);const _0x3cea53=_0x1c6a20[_0x50597e(0x2ba)]['id'];console[_0x50597e(0x271)](_0x3cea53);const _0x404260=await purchases_finished['findById'](_0x3cea53);console[_0x50597e(0x271)]('user_id',_0x404260);const _0x4eb67d=await product[_0x50597e(0x288)]({}),_0x5f4331=await warehouse[_0x50597e(0x267)]([{'$match':{'name':_0x404260[_0x50597e(0x28b)],'room':_0x404260[_0x50597e(0x273)]}},{'$unwind':_0x50597e(0x25c)},{'$group':{'_id':_0x50597e(0x266),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x50597e(0x246)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x50597e(0x238)},'type':{'$first':_0x50597e(0x255)},'floorlevel':{'$first':_0x50597e(0x1d8)},'primary_code':{'$first':_0x50597e(0x27e)},'secondary_code':{'$first':_0x50597e(0x20d)},'product_code':{'$first':_0x50597e(0x283)},'storage':{'$first':_0x50597e(0x212)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x50597e(0x271)](_0x50597e(0x218),_0x5f4331);let _0x195b82;if(_0x591bc4[_0x50597e(0x1ee)]==_0x50597e(0x243)){const _0x20a9a1=await staff['findOne']({'email':_0x591bc4['email']});_0x195b82=await warehouse[_0x50597e(0x288)]({'status':_0x50597e(0x207),'name':_0x20a9a1[_0x50597e(0x2d5)],'warehouse_category':_0x50597e(0x1fb),'name':_0x50597e(0x2d2)});}else _0x195b82=await warehouse[_0x50597e(0x267)]([{'$match':{'status':_0x50597e(0x207),'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':_0x50597e(0x27c),'name':{'$first':_0x50597e(0x27c)}}}]);if(_0x3316b6[0x0][_0x50597e(0x2e1)]==_0x50597e(0x1f8)){var _0x32e4f1=users[_0x50597e(0x235)];console['log'](_0x32e4f1);}else{if(_0x3316b6[0x0]['language']==_0x50597e(0x2c0))var _0x32e4f1=users['Hindi'];else{if(_0x3316b6[0x0][_0x50597e(0x2e1)]==_0x50597e(0x1e7))var _0x32e4f1=users[_0x50597e(0x1e7)];else{if(_0x3316b6[0x0][_0x50597e(0x2e1)]=='Spanish')var _0x32e4f1=users[_0x50597e(0x1e2)];else{if(_0x3316b6[0x0][_0x50597e(0x2e1)]==_0x50597e(0x19f))var _0x32e4f1=users[_0x50597e(0x19f)];else{if(_0x3316b6[0x0][_0x50597e(0x2e1)]==_0x50597e(0x20f))var _0x32e4f1=users[_0x50597e(0x1fe)];else{if(_0x3316b6[0x0][_0x50597e(0x2e1)]=='Chinese')var _0x32e4f1=users['Chinese'];else{if(_0x3316b6[0x0][_0x50597e(0x2e1)]==_0x50597e(0x1ab))var _0x32e4f1=users[_0x50597e(0x22b)];}}}}}}}_0x1ae57a['render'](_0x50597e(0x2b5),{'success':_0x1c6a20[_0x50597e(0x280)](_0x50597e(0x252)),'errors':_0x1c6a20[_0x50597e(0x280)]('errors'),'role':_0x591bc4,'profile':_0x15929c,'user':_0x404260,'stock':_0x5f4331,'master_shop':_0x3316b6,'product':_0x4eb67d,'language':_0x32e4f1,'warehouse':_0x195b82});}catch(_0x2ea34f){console[_0x50597e(0x271)](_0x2ea34f);}}),router[a0_0x574941(0x1a1)](a0_0x574941(0x1ad),auth,async(_0x53d4d8,_0x54c3c5)=>{var _0x473e6f=a0_0x574941;try{const {invoice:_0x40a36f,date:_0x112564,warehouse_name:_0x518547,Room_name:_0x140914,product_name:_0x3aaac3,purchase_quantity:_0x45ced2,stocks:_0x2b60e2,return_qty:_0xb42efe,note:_0x43aa96,level:_0x423f1d,isle:_0x11afd1,pallet:_0x59cb1d,to_warehouse_name:_0x54a522,to_Room_name:_0x41fab9}=_0x53d4d8[_0x473e6f(0x1d3)],_0x57fe8f=await purchases_finished['findOne']({'_id':_0x53d4d8['params']['id']}),_0x528571=await warehouse[_0x473e6f(0x1ba)]({'name':_0x518547,'room':_0x140914,'warehouse_category':_0x473e6f(0x1fb)});if(typeof _0x3aaac3==_0x473e6f(0x1b7))var _0x76ec40=[_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x297)]],_0x56b7a3=[_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x23a)]],_0x3b0dd9=[_0x53d4d8['body']['stocks']],_0x49ef5f=[_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x2b3)]],_0x1084bc=[_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x19c)]],_0xb74b17=[_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x22e)]],_0x2b11a7=[_0x53d4d8[_0x473e6f(0x1d3)]['primary_code_hide']],_0x47a7a9=[_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x229)]];else var _0x76ec40=[..._0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x297)]],_0x56b7a3=[..._0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x23a)]],_0x3b0dd9=[..._0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x2bb)]],_0x49ef5f=[..._0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x2b3)]],_0x1084bc=[..._0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x19c)]],_0xb74b17=[..._0x53d4d8['body'][_0x473e6f(0x22e)]],_0x2b11a7=[..._0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x216)]],_0x47a7a9=[..._0x53d4d8['body'][_0x473e6f(0x229)]];const _0x4147bc=_0x76ec40['map'](_0xaf7a7d=>{return _0xaf7a7d={'product_name':_0xaf7a7d};});_0x56b7a3[_0x473e6f(0x282)]((_0x438349,_0xfd6849)=>{var _0x395224=_0x473e6f;_0x4147bc[_0xfd6849][_0x395224(0x23a)]=_0x438349;}),_0x3b0dd9['forEach']((_0x12274d,_0x12a52c)=>{var _0x16b46d=_0x473e6f;_0x4147bc[_0x12a52c][_0x16b46d(0x285)]=_0x12274d;}),_0x49ef5f[_0x473e6f(0x282)]((_0xd946a2,_0x5df1a9)=>{var _0x1177ca=_0x473e6f;_0x4147bc[_0x5df1a9][_0x1177ca(0x2b3)]=_0xd946a2;}),_0x1084bc[_0x473e6f(0x282)]((_0x5a9e8a,_0x33f1f3)=>{_0x4147bc[_0x33f1f3]['bay']=_0x5a9e8a;}),_0xb74b17[_0x473e6f(0x282)]((_0x1a05fd,_0xb5e978)=>{var _0x1082c0=_0x473e6f;_0x4147bc[_0xb5e978][_0x1082c0(0x240)]=_0x1a05fd;}),_0x2b11a7[_0x473e6f(0x282)]((_0x253019,_0x53e62f)=>{var _0x38a147=_0x473e6f;_0x4147bc[_0x53e62f][_0x38a147(0x2d3)]=_0x253019;}),_0x47a7a9['forEach']((_0x570488,_0x66e1c)=>{var _0x3235f4=_0x473e6f;_0x4147bc[_0x66e1c][_0x3235f4(0x1b6)]=_0x570488;}),_0x4147bc[_0x473e6f(0x282)](_0x3d53a9=>{var _0x3b2363=_0x473e6f;console[_0x3b2363(0x271)](_0x3d53a9);const _0x5051a9=_0x528571[_0x3b2363(0x1e9)][_0x3b2363(0x1d9)](_0x2fb1ee=>{var _0x5a56e2=_0x3b2363;_0x2fb1ee[_0x5a56e2(0x297)]==_0x3d53a9[_0x5a56e2(0x297)]&&_0x2fb1ee[_0x5a56e2(0x217)]==_0x3d53a9[_0x5a56e2(0x217)]&&(console['log'](parseInt(_0x2fb1ee['product_stock'])+_0x5a56e2(0x248)+parseInt(_0x3d53a9[_0x5a56e2(0x2b3)])),_0x2fb1ee[_0x5a56e2(0x1e8)]=parseInt(_0x2fb1ee[_0x5a56e2(0x1e8)])-parseInt(_0x3d53a9['return_qty']));});}),await _0x528571[_0x473e6f(0x2c7)]();var _0x2f8191=0x0;_0x4147bc[_0x473e6f(0x282)](_0x5512a1=>{var _0x55a11b=_0x473e6f;(parseInt(_0x5512a1[_0x55a11b(0x23a)])<parseInt(_0x5512a1[_0x55a11b(0x2b3)])||parseInt(_0x5512a1[_0x55a11b(0x285)])<parseInt(_0x5512a1[_0x55a11b(0x2b3)]))&&_0x2f8191++;});if(_0x2f8191!=0x0)return _0x53d4d8[_0x473e6f(0x280)](_0x473e6f(0x28d),_0x473e6f(0x287)),_0x54c3c5['redirect'](_0x473e6f(0x1cd));const _0x5d29a1=new purchases_return_finished({'invoice':_0x40a36f,'suppliers':_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x261)],'date':_0x112564,'warehouse_name':_0x518547,'return_product':_0x4147bc,'note':_0x43aa96,'room':_0x140914,'to_warehouse_name':_0x54a522,'to_room':_0x41fab9}),_0x383e35=await _0x5d29a1[_0x473e6f(0x2c7)](),_0x1430a6=await purchases_return_finished[_0x473e6f(0x1ba)]({'invoice':_0x40a36f}),_0xaee02d=await warehouse[_0x473e6f(0x1ba)]({'name':_0x54a522,'room':_0x41fab9,'warehouse_category':_0x473e6f(0x1fb)});_0x1430a6[_0x473e6f(0x2c9)]['forEach'](_0x28c42f=>{var _0x4d4e0e=_0x473e6f,_0x2748f3=0x0;const _0x2898a4=_0xaee02d[_0x4d4e0e(0x1e9)][_0x4d4e0e(0x1d9)](_0x3331de=>{var _0x208952=_0x4d4e0e;console[_0x208952(0x271)](_0x3331de[_0x208952(0x297)]+'=='+_0x28c42f[_0x208952(0x297)]+'&&'+_0x3331de[_0x208952(0x217)]+'=='+_0x28c42f['bay']),_0x3331de[_0x208952(0x297)]==_0x28c42f['product_name']&&_0x3331de[_0x208952(0x217)]==_0x28c42f['bay']&&(_0x3331de[_0x208952(0x1e8)]=parseInt(_0x3331de[_0x208952(0x1e8)])-parseInt(_0x28c42f['return_qty']),_0x2748f3++);});_0x2748f3=='0'&&(_0xaee02d[_0x4d4e0e(0x1e9)]=_0xaee02d[_0x4d4e0e(0x1e9)]['concat']({'product_name':_0x28c42f['product_name'],'product_stock':_0x28c42f[_0x4d4e0e(0x2b3)],'primary_code':_0x28c42f[_0x4d4e0e(0x2d3)],'secondary_code':_0x28c42f[_0x4d4e0e(0x1b6)],'product_code':_0x28c42f[_0x4d4e0e(0x240)],'bay':_0x28c42f[_0x4d4e0e(0x217)],'maxProducts':0xf423f}));}),await _0xaee02d[_0x473e6f(0x2c7)]();const _0x70f5be=await purchases_finished[_0x473e6f(0x1ba)]({'invoice':_0x40a36f});_0x70f5be[_0x473e6f(0x1be)]=_0x473e6f(0x2ac);const _0x869916=await _0x70f5be[_0x473e6f(0x2c7)](),_0x527f8a=new s_payment_data({'invoice':_0x40a36f,'suppliers':_0x53d4d8[_0x473e6f(0x1d3)][_0x473e6f(0x261)],'reason':_0x473e6f(0x20b)});await _0x527f8a[_0x473e6f(0x2c7)]();const _0x30c6ef=await master_shop[_0x473e6f(0x288)](),_0x328e65=await email_settings[_0x473e6f(0x1ba)](),_0x1978c9=await suppliers['findOne']({'name':_0x53d4d8['body'][_0x473e6f(0x261)]});_0x30c6ef[0x0][_0x473e6f(0x242)]==0x1?(right_currency=_0x30c6ef[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x30c6ef[0x0]['currency']);var _0x2afa8f=_0x76ec40,_0x3b17e0=_0x49ef5f,_0x252798='',_0xde8935;for(_0xde8935 in _0x2afa8f){_0x252798+=_0x473e6f(0x1c1)+_0x473e6f(0x278)+_0x2afa8f[_0xde8935]+'</td>'+_0x473e6f(0x278)+_0x3b17e0[_0xde8935]+'</td>'+_0x473e6f(0x1c7);}let _0x172a67=nodemailer[_0x473e6f(0x1f4)]({'service':_0x473e6f(0x1a4),'auth':{'user':_0x328e65[_0x473e6f(0x2b9)],'pass':_0x328e65[_0x473e6f(0x23f)]}}),_0x1a7096={'from':_0x328e65[_0x473e6f(0x2b9)],'to':_0x1978c9['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x473e6f(0x2c8)+'/upload/'+_0x30c6ef[0x0]['image'],'cid':_0x473e6f(0x1a9)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x473e6f(0x227)+_0x473e6f(0x257)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x473e6f(0x257)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x473e6f(0x1fa)+_0x473e6f(0x257)+'<h2>\x20'+_0x30c6ef[0x0][_0x473e6f(0x219)]+'\x20</h2>'+_0x473e6f(0x1fa)+_0x473e6f(0x1fa)+_0x473e6f(0x2d7)+_0x473e6f(0x257)+_0x473e6f(0x209)+'\x20Order\x20Number\x20:\x20'+_0x40a36f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x473e6f(0x21a)+_0x112564+'\x20'+_0x473e6f(0x1c9)+_0x473e6f(0x1c5)+'</div>'+_0x473e6f(0x203)+_0x473e6f(0x225)+_0x473e6f(0x1c1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x473e6f(0x279)+_0x473e6f(0x1e4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x473e6f(0x228)+_0x473e6f(0x1cc)+'\x20'+_0x252798+'\x20'+_0x473e6f(0x244)+_0x473e6f(0x2b8)+_0x473e6f(0x257)+_0x473e6f(0x28f)+'<h5>'+_0x30c6ef[0x0][_0x473e6f(0x219)]+_0x473e6f(0x1c5)+_0x473e6f(0x1fa)+_0x473e6f(0x1fa)+_0x473e6f(0x269)};_0x172a67[_0x473e6f(0x298)](_0x1a7096,function(_0x5d7f5a,_0x10b945){var _0x28f672=_0x473e6f;_0x5d7f5a?console[_0x28f672(0x271)](_0x28f672(0x25a)):console[_0x28f672(0x271)](_0x28f672(0x289));}),_0x53d4d8['flash']('success',_0x473e6f(0x1ef)),_0x54c3c5[_0x473e6f(0x1a8)](_0x473e6f(0x1a7));}catch(_0x3d9afd){_0x54c3c5['status'](0xc8)[_0x473e6f(0x293)]({'message':_0x3d9afd[_0x473e6f(0x2c1)]});}}),router[a0_0x574941(0x247)](a0_0x574941(0x1eb),auth,async(_0x19b3d9,_0x54cfc4)=>{var _0x1f5480=a0_0x574941;try{const {username:_0x5e6da0,email:_0x183320,role:_0x53071e}=_0x19b3d9['user'],_0x51578b=_0x19b3d9[_0x1f5480(0x2ca)],_0x532457=await profile[_0x1f5480(0x1ba)]({'email':_0x51578b[_0x1f5480(0x2b9)]}),_0x380864=await master_shop[_0x1f5480(0x288)](),_0x4dac46=_0x19b3d9[_0x1f5480(0x2ba)]['id'],_0x7613c3=await purchases_finished['findById'](_0x4dac46);if(_0x380864[0x0][_0x1f5480(0x2e1)]==_0x1f5480(0x1f8))var _0x4eae0a=users[_0x1f5480(0x235)];else{if(_0x380864[0x0][_0x1f5480(0x2e1)]==_0x1f5480(0x2c0))var _0x4eae0a=users[_0x1f5480(0x2c0)];else{if(_0x380864[0x0]['language']==_0x1f5480(0x1e7))var _0x4eae0a=users['German'];else{if(_0x380864[0x0]['language']==_0x1f5480(0x1e2))var _0x4eae0a=users[_0x1f5480(0x1e2)];else{if(_0x380864[0x0][_0x1f5480(0x2e1)]==_0x1f5480(0x19f))var _0x4eae0a=users['French'];else{if(_0x380864[0x0]['language']==_0x1f5480(0x20f))var _0x4eae0a=users[_0x1f5480(0x1fe)];else{if(_0x380864[0x0][_0x1f5480(0x2e1)]==_0x1f5480(0x23d))var _0x4eae0a=users[_0x1f5480(0x23d)];else{if(_0x380864[0x0][_0x1f5480(0x2e1)]==_0x1f5480(0x1ab))var _0x4eae0a=users[_0x1f5480(0x22b)];}}}}}}}_0x54cfc4[_0x1f5480(0x214)](_0x1f5480(0x223),{'success':_0x19b3d9[_0x1f5480(0x280)](_0x1f5480(0x252)),'errors':_0x19b3d9[_0x1f5480(0x280)](_0x1f5480(0x28d)),'role':_0x51578b,'profile':_0x532457,'alldata':_0x7613c3,'master_shop':_0x380864,'language':_0x4eae0a}),console[_0x1f5480(0x271)](alldata);}catch(_0x1b708c){console[_0x1f5480(0x271)](_0x1b708c);}}),router[a0_0x574941(0x1a1)](a0_0x574941(0x1e1),async(_0x4fe30d,_0x27d503)=>{var _0x1b6098=a0_0x574941;const {product_code:_0x31dd4a}=_0x4fe30d[_0x1b6098(0x1d3)];var _0x4a681a;const _0x355227=await product[_0x1b6098(0x267)]([{'$match':{'primary_code':_0x31dd4a}},{'$group':{'_id':_0x1b6098(0x21b),'name':{'$first':'$name'},'category':{'$first':_0x1b6098(0x1ce)},'brand':{'$first':_0x1b6098(0x29f)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1b6098(0x2aa)},'primary_code':{'$first':_0x1b6098(0x1ae)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1b6098(0x224)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1b6098(0x201)},'gross_price':{'$first':_0x1b6098(0x253)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x292100=await product[_0x1b6098(0x267)]([{'$match':{'secondary_code':_0x31dd4a}},{'$group':{'_id':_0x1b6098(0x21b),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x1b6098(0x29f)},'unit':{'$first':_0x1b6098(0x272)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1b6098(0x1ae)},'secondary_code':{'$first':_0x1b6098(0x1bb)},'maxStocks':{'$first':_0x1b6098(0x224)},'maxProdPerUnit':{'$first':_0x1b6098(0x2cb)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x1b6098(0x253)},'sales_category':{'$first':_0x1b6098(0x2da)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x355227['length']>0x0)_0x4a681a=_0x355227;else _0x292100[_0x1b6098(0x213)]>0x0&&(_0x4a681a=_0x292100);_0x27d503[_0x1b6098(0x293)](_0x4a681a);}),router[a0_0x574941(0x1a1)](a0_0x574941(0x22c),async(_0xb88ac1,_0x3e7d48)=>{var _0x3dc023=a0_0x574941;const {productCode:_0x3e39c9,bay:_0x422065,warehouses:_0x375aa8,room:_0x41c8d1}=_0xb88ac1['body'];console[_0x3dc023(0x271)](_0xb88ac1[_0x3dc023(0x1d3)]);try{const _0x1673f7=await warehouse[_0x3dc023(0x267)]([{'$match':{'name':_0x375aa8,'room':_0x41c8d1}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x422065)}},{'$group':{'_id':_0x3dc023(0x266),'name':{'$first':_0x3dc023(0x1bf)},'product_stock':{'$first':_0x3dc023(0x246)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3e7d48[_0x3dc023(0x1e5)](0xc8)[_0x3dc023(0x293)](_0x1673f7);}catch(_0xe37df2){_0x3e7d48[_0x3dc023(0x1e5)](0x194)[_0x3dc023(0x293)]({'message':_0xe37df2[_0x3dc023(0x2c1)]});}}),router['post']('/barcode_scanner_logs',async(_0x4e6190,_0x335d08)=>{var _0x131d77=a0_0x574941;const {product_code:_0x584b04}=_0x4e6190[_0x131d77(0x1d3)];var _0x1a7b8b;const _0x3fcc71=await product[_0x131d77(0x267)]([{'$match':{'primary_code':_0x584b04,'type_products':_0x131d77(0x271)}},{'$group':{'_id':_0x131d77(0x21b),'name':{'$first':_0x131d77(0x27c)},'category':{'$first':_0x131d77(0x1ce)},'brand':{'$first':_0x131d77(0x29f)},'unit':{'$first':_0x131d77(0x272)},'alertquantity':{'$first':_0x131d77(0x226)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x131d77(0x1ae)},'secondary_code':{'$first':_0x131d77(0x1bb)},'maxStocks':{'$first':_0x131d77(0x224)},'maxProdPerUnit':{'$first':_0x131d77(0x2cb)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x131d77(0x201)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x131d77(0x2da)},'type_products':{'$first':_0x131d77(0x1a2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x131d77(0x271)](_0x3fcc71);const _0xd48f1c=await product['aggregate']([{'$match':{'secondary_code':_0x584b04,'type_products':_0x131d77(0x271)}},{'$group':{'_id':'$_id','name':{'$first':_0x131d77(0x27c)},'category':{'$first':'$category'},'brand':{'$first':_0x131d77(0x29f)},'unit':{'$first':_0x131d77(0x272)},'alertquantity':{'$first':_0x131d77(0x226)},'product_code':{'$first':_0x131d77(0x2aa)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x131d77(0x224)},'maxProdPerUnit':{'$first':_0x131d77(0x2cb)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x131d77(0x201)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x131d77(0x2da)},'type_products':{'$first':_0x131d77(0x1a2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x3fcc71[_0x131d77(0x213)]>0x0)_0x1a7b8b=_0x3fcc71;else _0xd48f1c[_0x131d77(0x213)]>0x0&&(_0x1a7b8b=_0xd48f1c);_0x335d08[_0x131d77(0x293)](_0x1a7b8b);}),module[a0_0x574941(0x1cb)]=router;