var a0_0x3a3de0=a0_0x2086;(function(_0x5eed5f,_0x47cdca){var _0x4b4ac3=a0_0x2086,_0x2236e0=_0x5eed5f();while(!![]){try{var _0x4a1e5e=parseInt(_0x4b4ac3(0xe0))/0x1+-parseInt(_0x4b4ac3(0x1b3))/0x2+parseInt(_0x4b4ac3(0x188))/0x3*(-parseInt(_0x4b4ac3(0x134))/0x4)+parseInt(_0x4b4ac3(0x1f9))/0x5*(-parseInt(_0x4b4ac3(0xee))/0x6)+parseInt(_0x4b4ac3(0x1ff))/0x7*(parseInt(_0x4b4ac3(0x1ab))/0x8)+parseInt(_0x4b4ac3(0x1b1))/0x9+parseInt(_0x4b4ac3(0x118))/0xa;if(_0x4a1e5e===_0x47cdca)break;else _0x2236e0['push'](_0x2236e0['shift']());}catch(_0x18a329){_0x2236e0['push'](_0x2236e0['shift']());}}}(a0_0xada1,0x2b97c));function a0_0xada1(){var _0x1a5bd2=['match','all_purchases_barcode','$suppliers_docs','sales_category','padStart','suppliers','_id','message','json','type_of_products','host','An\x20error\x20occurred.','paid_amount','product_cat','length','</table>','purchases_process','product_code_hide','DRY\x20GOODS','/barcode_scanner','prod_unit','/process/:id','<hr\x20class=\x22my-3\x22>','INC-','room','INC','name','return_qty','Ambient','abs','due_amount','forEach','FROZEN\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','all_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20<=>\x20','logs','$brand','$product_details','LOG-INC-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</span>','port','</head><body>','===','$product_details.secondary_code','English','Paid\x20For\x20Purchase','<h5>','STAGING\x20AREA\x201','room_name','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/CheckingWarehouse','Finished\x20Goods','65mXjthK','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$name','edit_purchases_finished','all_purchases_finished_logs','<table\x20style=\x22width:\x20100%\x20!important;\x22>','12089RajTgH','$product.room_name','Return\x20Goods','Enabled','/give_payment/:id','user_id','German','$expiry_date','warehouse_name','role','catch','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','site_title','updateOne','purchase\x20data\x20add\x20successfully','$product_details.bin','$product_details.type','add_purchases_finished','$product_code','level','$sales_category','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','JO_number','quantity','Purchase\x20Return','$maxStocks','$product_details.rack','standard_unit',',\x20bin:\x20','<div>','$batch_code','item_code','/upload/','product_details','bin','$product.type','\x20to\x20warehouse:\x20','/barcode_scanner_logs','ejs','random','/barcode/:id','/all_purchases/view','147995mwWger','product_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','secondary_code','/view','password','Spanish','maxProducts','max','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','getFullYear','redirect','42510ekMxyw','Rack\x202','getMonth','isUsed','../public/language/languages.json','prod_qty','bay','prod_secondunit','currency_placement','/all_purchases_finished/view','batch_code','$invoice','createTransport','/all_purchases_finished/process/','$suppliers','sendMail','purchase_quantity','True','util','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','success','$product_details.bay','add_purchases_finished_logs','<h2>\x20','concat','Arabic\x20(ae)','email','getDate','secondary_code_hide','save','$alertquantity','$primary_code','nodemailer','\x20inc\x20=\x20','express','stock_data','maxPerUnit','<strong>\x20Regards\x20</strong>','id_transaction','/view/return_purchase/:id','product_stock','findById','4040750XhRLaH','status','edit_purchases_finished_view','</tbody>','user','expiry_date','$due_amount','sales_data_cateory','incoming_view','uuid','\x20</h2>','return_product','$type_products','product','log','to_bay','</div>','</h5>','POnumber','date_recieved','Arabic','table\x20page','$date','filter','primary_code_hide','min','$product.quantity','params','4NmQQec','own','undefined','date','maxStocks','/view/add_purchases/:id','/all_purchases_finished/preview/','toString','\x20Order\x20Number\x20:\x20',',\x20room:\x20','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','<html><head><title></title>','stock_quantity','Router','Error\x20occurred\x20while\x20processing\x20product:','$gross_price','$secondary_code','$room','error','to_quantity','$unit','false','\x20<>\x20','$product_details.maxProducts','product_code','prod_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Logo.png','Portuguese','<h5\x20style=\x22text-align:\x20left;\x22>','$product.floorlevel','floor','</tr>','\x20units\x20of\x20','<span\x20style=\x22float:\x20right;\x22>','maxperunit','valueOf','isAvailable','logo','$product_details.product_name','prod_name','slice','$product','/getTRF','French','</td>','Portuguese\x20(BR)','$warehouse_name','</body></html>','../middleware/auth','$product_details._id','gross_price','/view_log','$product.bin','/../public','purchases\x20item\x20return\x20successfull','$category','prod_cat','Rack\x201','back','errors','Error\x20Occurs','<tbody\x20style=\x22text-align:\x20center;\x22>','$maxProdPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/invoice/:id','then','get','$note','product_id','true','stocks','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','purchase_invoice','exports','Distributing\x20','RoomAssign','prod_Qty','secondary_unit','Chinese','$paid_amount','currency','production_date','998181gPsPkZ','warehouse','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_date','invoice_init','INCF-','payment\x20successfull','/view/add_purchases_logs','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','to_room_name','map','Hindi','findOne','all','/incoming/add','$product_details.product_stock','note','language','inc','post','unit','English\x20(US)','$product.bay','prod_primunit','to_warehouse','string','find','max_product_unit','/preview/:id','primary_code','purchases_id','Purchase\x20Return\x20Mail','aggregate','master','184pIYLkC','invoice','Asia/Manila','<!DOCTYPE\x20html>','body','2-digit','1111167ruLoco','Email\x20sent\x20successfully','223732wekopF','\x20Order\x20Date\x20:\x20','$return_data','render','here2','MaxStocks_data','product_name','to_recieved','$secondary_unit','image','prod_level','flash','$product_details.storage','There\x27s\x20a\x20error\x20in\x20this\x20transaction'];a0_0xada1=function(){return _0x1a5bd2;};return a0_0xada1();}const express=require(a0_0x3a3de0(0x110)),app=express(),router=express[a0_0x3a3de0(0x141)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require('../models/all_models'),auth=require(a0_0x3a3de0(0x165)),nodemailer=require(a0_0x3a3de0(0x10e));var ejs=require(a0_0x3a3de0(0xdc));const path=require('path'),users=require(a0_0x3a3de0(0xf2)),{isNull}=require(a0_0x3a3de0(0x100));router[a0_0x3a3de0(0x177)]('/incoming',auth,async(_0x57095f,_0x4c73f4)=>{var _0x2f7b62=a0_0x3a3de0;try{const {username:_0x22e6bf,email:_0x1c1bd4,role:_0x1d2c45}=_0x57095f[_0x2f7b62(0x11c)],_0x1ea2bc=_0x57095f['user'],_0x11c0d7=await profile[_0x2f7b62(0x195)]({'email':_0x1ea2bc[_0x2f7b62(0x108)]}),_0x5f095f=await staff[_0x2f7b62(0x195)]({'email':_0x1ea2bc[_0x2f7b62(0x108)]}),_0x5859ed=await master_shop['find']();let _0x4a4155=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x5f095f[_0x2f7b62(0x189)]}}]);if(_0x5859ed[0x0][_0x2f7b62(0x19a)]==_0x2f7b62(0x19e))var _0x9c583c=users['English'];else{if(_0x5859ed[0x0][_0x2f7b62(0x19a)]==_0x2f7b62(0x194))var _0x9c583c=users[_0x2f7b62(0x194)];else{if(_0x5859ed[0x0][_0x2f7b62(0x19a)]=='German')var _0x9c583c=users['German'];else{if(_0x5859ed[0x0]['language']==_0x2f7b62(0xe6))var _0x9c583c=users[_0x2f7b62(0xe6)];else{if(_0x5859ed[0x0]['language']==_0x2f7b62(0x160))var _0x9c583c=users[_0x2f7b62(0x160)];else{if(_0x5859ed[0x0][_0x2f7b62(0x19a)]==_0x2f7b62(0x162))var _0x9c583c=users['Portuguese'];else{if(_0x5859ed[0x0][_0x2f7b62(0x19a)]=='Chinese')var _0x9c583c=users[_0x2f7b62(0x184)];else{if(_0x5859ed[0x0][_0x2f7b62(0x19a)]==_0x2f7b62(0x107))var _0x9c583c=users['Arabic'];}}}}}}}_0x4c73f4[_0x2f7b62(0x1b6)](_0x2f7b62(0x120),{'success':_0x57095f[_0x2f7b62(0x1be)](_0x2f7b62(0x102)),'errors':_0x57095f[_0x2f7b62(0x1be)](_0x2f7b62(0x170)),'purchases':_0x4a4155,'role':_0x1ea2bc,'profile':_0x11c0d7,'master_shop':_0x5859ed,'language':_0x9c583c,'staff_data':_0x5f095f});}catch(_0x5dfa05){console[_0x2f7b62(0x126)](_0x2f7b62(0x12d),_0x5dfa05),_0x4c73f4[_0x2f7b62(0x119)](0xc8)[_0x2f7b62(0x1c9)]({'message':_0x5dfa05[_0x2f7b62(0x1c8)]});}}),router['get']('/incoming/add',auth,async(_0x4cbfdb,_0x30d3af)=>{var _0x5859ec=a0_0x3a3de0;try{const {username:_0x539ae4,email:_0x2ce344,role:_0x1fb3ff}=_0x4cbfdb[_0x5859ec(0x11c)],_0x5e5c62=_0x4cbfdb[_0x5859ec(0x11c)],_0x557d30=await profile[_0x5859ec(0x195)]({'email':_0x5e5c62['email']}),_0x8ddafb=await staff[_0x5859ec(0x195)]({'email':_0x5e5c62[_0x5859ec(0x108)]}),_0x500d7c=await master_shop['find']();let _0x5f2dd6=await transfers_finished[_0x5859ec(0x1a9)]([{'$match':{'to_warehouse':_0x8ddafb[_0x5859ec(0x189)],'to_recieved':_0x5859ec(0x149)}}]);if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0x19e))var _0x10775a=users[_0x5859ec(0x1f0)];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]=='Hindi')var _0x10775a=users[_0x5859ec(0x194)];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0x205))var _0x10775a=users[_0x5859ec(0x205)];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0xe6))var _0x10775a=users[_0x5859ec(0xe6)];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0x160))var _0x10775a=users[_0x5859ec(0x160)];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0x162))var _0x10775a=users[_0x5859ec(0x150)];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0x184))var _0x10775a=users['Chinese'];else{if(_0x500d7c[0x0][_0x5859ec(0x19a)]==_0x5859ec(0x107))var _0x10775a=users[_0x5859ec(0x12c)];}}}}}}}_0x30d3af[_0x5859ec(0x1b6)]('incoming_add',{'success':_0x4cbfdb[_0x5859ec(0x1be)]('success'),'errors':_0x4cbfdb[_0x5859ec(0x1be)](_0x5859ec(0x170)),'purchases':_0x5f2dd6,'role':_0x5e5c62,'profile':_0x557d30,'master_shop':_0x500d7c,'language':_0x10775a,'staff_data':_0x8ddafb});}catch(_0x4ccac5){console[_0x5859ec(0x126)](_0x5859ec(0x12d),_0x4ccac5),_0x30d3af['status'](0xc8)[_0x5859ec(0x1c9)]({'message':_0x4ccac5[_0x5859ec(0x1c8)]});}});function a0_0x2086(_0x22ec31,_0x43a301){var _0xada142=a0_0xada1();return a0_0x2086=function(_0x20869c,_0x55b3e7){_0x20869c=_0x20869c-0xd8;var _0x3f2240=_0xada142[_0x20869c];return _0x3f2240;},a0_0x2086(_0x22ec31,_0x43a301);}const createLog=async _0x57894b=>{var _0x380868=a0_0x3a3de0;const _0x23bddb=new datalogs({'location':_0x57894b});return await _0x23bddb[_0x380868(0x10b)](),_0x23bddb[_0x380868(0x18d)];};router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0x197),auth,async(_0x558527,_0x3654e9)=>{var _0x14b8a1=a0_0x3a3de0;try{const {invoice_trf_data:_0x3658bc,item_code:_0x2f7167,SCRN:_0x3aad14,ReqBy:_0x443446,type_of_products:_0x52e2e5,dateofreq:_0x59edf4,PO_number:_0x2f61b2,date:_0x8ec527,warehouse_name:_0x41bf52,typeservicesData:_0x17644b,typevehicle:_0x52705e,driver:_0x5d7aa2,plate:_0x454c42,van:_0xaf7f5e,DRSI:_0x3970b2,TSU:_0x29940e,TFU:_0x3510e2,note:_0x24166d}=_0x558527[_0x14b8a1(0x1af)],_0x596410=await transfers_finished['findById'](_0x3658bc);if(typeof _0x2f7167=='string')var _0x49c358=[_0x558527['body'][_0x14b8a1(0x1b9)]],_0xa24309=[_0x558527['body']['item_code']],_0x16dfd8=[_0x558527['body'][_0x14b8a1(0x147)]],_0xe4bdf4=[_0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x19d)]],_0x323b54=[_0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0xf5)]],_0x2f0a08=[_0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0xd8)]],_0x18aa24=[_0x558527[_0x14b8a1(0x1af)]['primary_code']],_0x1fe526=[_0x558527['body'][_0x14b8a1(0xe3)]],_0x1cb4c2=[_0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0xf8)]],_0x2bd929=[_0x558527['body'][_0x14b8a1(0x11d)]],_0x8a6a8c=[_0x558527[_0x14b8a1(0x1af)]['production_date']],_0x412833=[_0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x1a4)]],_0x2ce96b=[_0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x1d9)]];else var _0x49c358=[..._0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x1b9)]],_0xa24309=[..._0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x21e)]],_0x16dfd8=[..._0x558527['body'][_0x14b8a1(0x147)]],_0xe4bdf4=[..._0x558527['body']['unit']],_0x323b54=[..._0x558527[_0x14b8a1(0x1af)]['prod_secondunit']],_0x2f0a08=[..._0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0xd8)]],_0x18aa24=[..._0x558527[_0x14b8a1(0x1af)]['primary_code']],_0x1fe526=[..._0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0xe3)]],_0x1cb4c2=[..._0x558527['body'][_0x14b8a1(0xf8)]],_0x2bd929=[..._0x558527[_0x14b8a1(0x1af)]['expiry_date']],_0x8a6a8c=[..._0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x187)]],_0x412833=[..._0x558527[_0x14b8a1(0x1af)][_0x14b8a1(0x1a4)]],_0x2ce96b=[..._0x558527['body'][_0x14b8a1(0x1d9)]];const _0x506dbf=_0x49c358[_0x14b8a1(0x193)](_0x1e8505=>{return _0x1e8505={'product_name':_0x1e8505};});_0xa24309[_0x14b8a1(0x1e0)]((_0x41da48,_0x68a0c7)=>{var _0xbfa22=_0x14b8a1;_0x506dbf[_0x68a0c7][_0xbfa22(0x14c)]=_0x41da48;}),_0x16dfd8[_0x14b8a1(0x1e0)]((_0x54582a,_0x3a9693)=>{var _0x48b13a=_0x14b8a1;_0x506dbf[_0x3a9693][_0x48b13a(0x216)]=Math[_0x48b13a(0x1de)](_0x54582a);}),_0xe4bdf4[_0x14b8a1(0x1e0)]((_0x30bcce,_0x58f668)=>{var _0x38c6a0=_0x14b8a1;_0x506dbf[_0x58f668][_0x38c6a0(0x21a)]=_0x30bcce;}),_0x323b54['forEach']((_0x502206,_0x45b66a)=>{var _0x1c00a9=_0x14b8a1;_0x506dbf[_0x45b66a][_0x1c00a9(0x183)]=_0x502206;}),_0x2f0a08[_0x14b8a1(0x1e0)]((_0xaae16d,_0x58b9fa)=>{var _0x2ce815=_0x14b8a1,_0x14e236=_0xaae16d[_0x2ce815(0x1c1)](/[A-Za-z]+/)[0x0],_0x578dd5=parseInt(_0xaae16d[_0x2ce815(0x1c1)](/\d+/)[0x0]);_0x506dbf[_0x58b9fa][_0x2ce815(0x212)]=_0x14e236,_0x506dbf[_0x58b9fa][_0x2ce815(0xf4)]=_0x578dd5;}),_0x18aa24[_0x14b8a1(0x1e0)]((_0x2bc880,_0x28374e)=>{var _0x472e96=_0x14b8a1;_0x506dbf[_0x28374e][_0x472e96(0x1a6)]=_0x2bc880;}),_0x1fe526[_0x14b8a1(0x1e0)]((_0x165aaf,_0x175a78)=>{var _0x178fef=_0x14b8a1;_0x506dbf[_0x175a78][_0x178fef(0xe3)]=_0x165aaf;}),_0x1cb4c2[_0x14b8a1(0x1e0)]((_0x4c34b2,_0x1de4c8)=>{var _0x215aef=_0x14b8a1;_0x506dbf[_0x1de4c8][_0x215aef(0xf8)]=_0x4c34b2;}),_0x2bd929[_0x14b8a1(0x1e0)]((_0x1089b1,_0x91408c)=>{_0x506dbf[_0x91408c]['expiry_date']=_0x1089b1;}),_0x8a6a8c[_0x14b8a1(0x1e0)]((_0xa1e69f,_0x3a5df7)=>{_0x506dbf[_0x3a5df7]['production_date']=_0xa1e69f;}),_0x412833[_0x14b8a1(0x1e0)]((_0x5bde35,_0x262bc1)=>{var _0x33e147=_0x14b8a1;_0x506dbf[_0x262bc1][_0x33e147(0x157)]=_0x5bde35;}),_0x2ce96b['forEach']((_0xf38a90,_0x174cb5)=>{var _0x5f4c0d=_0x14b8a1;_0x506dbf[_0x174cb5][_0x5f4c0d(0x1f4)]=_0xf38a90;});const _0x5ad2ac=await createLog(_0x14b8a1(0x1da));_0x2ce96b['forEach']((_0x279c6f,_0x50984b)=>{var _0x157373=_0x14b8a1;_0x506dbf[_0x50984b]['invoice']=_0x157373(0x1d8)+_0x5ad2ac[_0x157373(0x13b)]()[_0x157373(0x1c5)](0x8,'0');});const _0x15551d=_0x506dbf[_0x14b8a1(0x12f)](_0x5ba89f=>_0x5ba89f[_0x14b8a1(0x216)]!=='0'&&_0x5ba89f[_0x14b8a1(0x216)]!==''),_0x4ba76c=new purchases_incoming({'invoice':_0x14b8a1(0x1d8)+_0x5ad2ac[_0x14b8a1(0x13b)]()[_0x14b8a1(0x1c5)](0x8,'0'),'date':_0x8ec527,'warehouse_name':_0x41bf52,'product':_0x15551d,'note':_0x24166d,'POnumber':_0x2f61b2,'SCRN':_0x3aad14,'ReqBy':_0x443446,'dateofreq':_0x59edf4,'typeservicesData':_0x17644b,'van':_0xaf7f5e,'typevehicle':_0x52705e,'driver':_0x5d7aa2,'plate':_0x454c42,'DRSI':_0x3970b2,'TSU':_0x29940e,'TFU':_0x3510e2,'typeOfProducts':_0x52e2e5}),_0x362a85=await _0x4ba76c[_0x14b8a1(0x10b)](),_0xa6b6b=_0x362a85['product']['map'](async _0x14186d=>{var _0x59c1da=_0x14b8a1,_0x7ca98a=await warehouse[_0x59c1da(0x195)]({'name':_0x41bf52,'room':_0x14186d[_0x59c1da(0x1f4)]});if(_0x14186d[_0x59c1da(0x216)]>0x0){var _0x2757e0=0x0;const _0x1bc06f=_0x7ca98a[_0x59c1da(0x220)]['map'](_0x9b8d4e=>{var _0x1f6312=_0x59c1da;_0x9b8d4e[_0x1f6312(0x1b9)]==_0x14186d['product_name']&&_0x9b8d4e[_0x1f6312(0xf4)]==_0x14186d[_0x1f6312(0x127)]&&_0x9b8d4e['expiry_date']==_0x14186d['expiry_date']&&_0x9b8d4e[_0x1f6312(0x187)]==_0x14186d['production_date']&&_0x9b8d4e[_0x1f6312(0xf8)]==_0x14186d['batch_code']&&_0x9b8d4e[_0x1f6312(0x1ac)]==_0x14186d[_0x1f6312(0x1ac)]&&(typeof _0x14186d[_0x1f6312(0x114)]==_0x1f6312(0x136)?(console[_0x1f6312(0x126)](_0x1f6312(0x1b7),_0x9b8d4e[_0x1f6312(0x116)]+_0x1f6312(0x14a)+_0x9b8d4e['_id']+_0x1f6312(0x1e5)+Math[_0x1f6312(0x1de)](_0x9b8d4e[_0x1f6312(0x116)])+Math[_0x1f6312(0x1de)](_0x14186d['to_quantity'])),_0x9b8d4e[_0x1f6312(0x116)]=Math['abs'](_0x9b8d4e[_0x1f6312(0x116)])+Math['abs'](_0x14186d[_0x1f6312(0x216)])):(_0x9b8d4e[_0x1f6312(0x116)]=Math['abs'](_0x9b8d4e[_0x1f6312(0x116)])+Math[_0x1f6312(0x1de)](_0x14186d[_0x1f6312(0x216)]),_0x2757e0++));});_0x2757e0=='0'&&(_0x7ca98a[_0x59c1da(0x220)]=_0x7ca98a['product_details'][_0x59c1da(0x106)]({'product_name':_0x14186d['product_name'],'product_stock':_0x14186d[_0x59c1da(0x216)],'bay':_0x14186d[_0x59c1da(0xf4)],'level':_0x14186d['level'],'product_code':_0x14186d['product_code'],'primary_code':_0x14186d[_0x59c1da(0x1a6)],'secondary_code':_0x14186d['secondary_code'],'expiry_date':_0x14186d[_0x59c1da(0x11d)],'production_date':_0x14186d[_0x59c1da(0x187)],'maxProducts':_0x14186d[_0x59c1da(0xe7)],'batch_code':_0x14186d['batch_code'],'secondary_unit':_0x14186d['secondary_unit'],'unit':_0x14186d[_0x59c1da(0x21a)],'maxProducts':_0x14186d[_0x59c1da(0xe7)],'maxPerUnit':_0x14186d[_0x59c1da(0x112)],'invoice':_0x14186d[_0x59c1da(0x1ac)]}));}return _0x7ca98a;});Promise[_0x14b8a1(0x196)](_0xa6b6b)['then'](async _0x3780a6=>{var _0x37366e=_0x14b8a1;try{for(const _0x43a0d2 of _0x3780a6){await warehouse[_0x37366e(0x20c)]({'_id':_0x43a0d2[_0x37366e(0x1c7)]},{'$addToSet':{'product_details':{'$each':_0x43a0d2[_0x37366e(0x220)]}}});}_0x596410[_0x37366e(0x1ba)]='true';const _0x5302be=await _0x596410[_0x37366e(0x10b)](),_0x226d52=await master_shop['find'](),_0x5e9b2c=await email_settings[_0x37366e(0x195)](),_0x4a9fc0=await supervisor_settings[_0x37366e(0x1a3)]();var _0xf5b216=_0x4ba76c[_0x37366e(0x125)],_0x2cb585='',_0x476bec;for(_0x476bec in _0xf5b216){var _0x3c12d4='FG';_0x4ba76c[_0x37366e(0x1a1)]==_0x37366e(0x1d3)&&(_0x3c12d4='DG'),_0x2cb585+=_0x37366e(0x18a)+_0x37366e(0x101)+_0xf5b216[_0x476bec][_0x37366e(0x1b9)]+_0x37366e(0x161)+_0x37366e(0x101)+_0xf5b216[_0x476bec]['product_code']+_0x37366e(0x161)+_0x37366e(0x101)+_0xf5b216[_0x476bec][_0x37366e(0x147)]+'</td>'+_0x37366e(0x101)+_0xf5b216[_0x476bec][_0x37366e(0x19d)]+_0x37366e(0x161)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf5b216[_0x476bec]['secondary_unit']+_0x37366e(0x161)+_0x37366e(0x101)+_0x4ba76c['to_warehouse']+_0x37366e(0x161)+_0x37366e(0x101)+_0xf5b216[_0x476bec][_0x37366e(0x192)]+_0x37366e(0x161)+_0x37366e(0x101)+_0x3c12d4+_0xf5b216[_0x476bec][_0x37366e(0x127)]+_0x37366e(0x161)+_0x37366e(0x154);}_0x558527[_0x37366e(0x1be)]('success','Transfer\x20Finalize\x20Successfully'),_0x3654e9[_0x37366e(0xed)]('/picking_list/pdf_puchases_fin_own_trf/'+_0x362a85[_0x37366e(0x1c7)]);}catch(_0xf7b936){console[_0x37366e(0x146)](_0xf7b936),_0x3654e9[_0x37366e(0x119)](0x1f4)[_0x37366e(0x1c9)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x14b8a1(0x209)](_0xefe40a=>{var _0x5ec833=_0x14b8a1;console[_0x5ec833(0x146)](_0xefe40a),_0x3654e9[_0x5ec833(0x119)](0x1f4)[_0x5ec833(0x1c9)]({'error':_0x5ec833(0x1cc)});});}catch(_0x311411){}}),router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0x15f),auth,async(_0x56862f,_0x454787)=>{var _0x3e107b=a0_0x3a3de0;try{const {warehouse:_0x224f0b}=_0x56862f[_0x3e107b(0x1af)],_0x593cfe=await transfers_finished['find']({'to_warehouse':_0x224f0b,'to_recieved':_0x3e107b(0x149)});_0x454787[_0x3e107b(0x1c9)](_0x593cfe);}catch(_0x5b13c7){}}),router[a0_0x3a3de0(0x19c)]('/getinvoicetrf',auth,async(_0x323125,_0x1267d3)=>{var _0x4c4e00=a0_0x3a3de0;try{const {invoice:_0x2de650}=_0x323125['body'],_0x57d054=await transfers_finished[_0x4c4e00(0x1a3)]({'_id':_0x2de650,'to_recieved':_0x4c4e00(0x149)});_0x1267d3[_0x4c4e00(0x1c9)](_0x57d054);}catch(_0xa07e6e){}}),router['get'](a0_0x3a3de0(0xe4),auth,async(_0x4e0287,_0x56d282)=>{var _0x4c9673=a0_0x3a3de0;try{const {username:_0x49c5d4,email:_0x120b10,role:_0x3da68b}=_0x4e0287[_0x4c9673(0x11c)],_0x3d9179=_0x4e0287[_0x4c9673(0x11c)],_0x187d9a=await profile['findOne']({'email':_0x3d9179[_0x4c9673(0x108)]}),_0x5c70aa=await staff[_0x4c9673(0x195)]({'email':_0x3d9179[_0x4c9673(0x108)]});if(_0x3d9179[_0x4c9673(0x208)]==_0x4c9673(0x17c)){const _0x2b1929=await staff[_0x4c9673(0x195)]({'email':_0x3d9179[_0x4c9673(0x108)]});}const _0xdb78e8=await master_shop[_0x4c9673(0x1a3)]();let _0x328e64;if(_0x3d9179[_0x4c9673(0x208)]==_0x4c9673(0x17c)){const _0x35b066=await staff[_0x4c9673(0x195)]({'email':_0x3d9179[_0x4c9673(0x108)]});_0x328e64=await purchases_finished[_0x4c9673(0x1a9)]([{'$match':{'warehouse_name':_0x35b066[_0x4c9673(0x189)],'typeOfProducts':_0x4c9673(0x135)}},{'$lookup':{'from':_0x4c9673(0x1c6),'localField':_0x4c9673(0x1c6),'foreignField':_0x4c9673(0x1db),'as':'suppliers_docs'}},{'$unwind':_0x4c9673(0x1c3)},{'$unwind':_0x4c9673(0x15e)},{'$group':{'_id':_0x4c9673(0xe9),'invoice':{'$first':_0x4c9673(0xf9)},'suppliers':{'$first':_0x4c9673(0xfc)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4c9673(0x163)},'room':{'$first':_0x4c9673(0x145)},'product':{'$push':_0x4c9673(0x15e)},'note':{'$first':_0x4c9673(0x178)},'paid_amount':{'$first':_0x4c9673(0x185)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4c9673(0x1b5)},'batch_code':{'$first':_0x4c9673(0x21d)},'expiry_date':{'$first':_0x4c9673(0x206)},'suppliers_docs':{'$first':_0x4c9673(0x1c3)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x4c9673(0x169)},'type':{'$addToSet':_0x4c9673(0xd9)},'floorlevel':{'$addToSet':_0x4c9673(0x152)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x328e64=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':'own'}},{'$unwind':_0x4c9673(0x15e)},{'$group':{'_id':_0x4c9673(0xe9),'invoice':{'$first':_0x4c9673(0xf9)},'suppliers':{'$first':_0x4c9673(0xfc)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4c9673(0x163)},'room':{'$addToSet':_0x4c9673(0x200)},'product':{'$push':_0x4c9673(0x15e)},'note':{'$first':_0x4c9673(0x178)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x4c9673(0x11e)},'return_data':{'$first':_0x4c9673(0x1b5)},'batch_code':{'$first':_0x4c9673(0x21d)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4c9673(0x1c3)},'total_product_quantity':{'$sum':_0x4c9673(0x132)},'level':{'$addToSet':_0x4c9673(0x19f)},'isle':{'$addToSet':_0x4c9673(0x169)},'type':{'$addToSet':_0x4c9673(0xd9)},'floorlevel':{'$addToSet':_0x4c9673(0x152)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xdb78e8[0x0][_0x4c9673(0x19a)]==_0x4c9673(0x19e))var _0x41935e=users[_0x4c9673(0x1f0)];else{if(_0xdb78e8[0x0][_0x4c9673(0x19a)]==_0x4c9673(0x194))var _0x41935e=users['Hindi'];else{if(_0xdb78e8[0x0][_0x4c9673(0x19a)]==_0x4c9673(0x205))var _0x41935e=users[_0x4c9673(0x205)];else{if(_0xdb78e8[0x0][_0x4c9673(0x19a)]==_0x4c9673(0xe6))var _0x41935e=users['Spanish'];else{if(_0xdb78e8[0x0]['language']=='French')var _0x41935e=users[_0x4c9673(0x160)];else{if(_0xdb78e8[0x0][_0x4c9673(0x19a)]==_0x4c9673(0x162))var _0x41935e=users[_0x4c9673(0x150)];else{if(_0xdb78e8[0x0][_0x4c9673(0x19a)]==_0x4c9673(0x184))var _0x41935e=users[_0x4c9673(0x184)];else{if(_0xdb78e8[0x0][_0x4c9673(0x19a)]=='Arabic\x20(ae)')var _0x41935e=users[_0x4c9673(0x12c)];}}}}}}}_0x56d282[_0x4c9673(0x1b6)](_0x4c9673(0x1e3),{'success':_0x4e0287[_0x4c9673(0x1be)]('success'),'errors':_0x4e0287['flash'](_0x4c9673(0x170)),'purchases':_0x328e64,'role':_0x3d9179,'profile':_0x187d9a,'master_shop':_0xdb78e8,'language':_0x41935e});}catch(_0x4fdb53){console['log'](_0x4c9673(0x12d),_0x4fdb53),_0x56d282[_0x4c9673(0x119)](0xc8)[_0x4c9673(0x1c9)]({'message':_0x4fdb53[_0x4c9673(0x1c8)]});}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0x168),auth,async(_0x484663,_0x3a09c6)=>{var _0x39e220=a0_0x3a3de0;try{const {username:_0xd6f0a2,email:_0x1a2326,role:_0x4b56ec}=_0x484663['user'],_0x1b5ee8=_0x484663[_0x39e220(0x11c)],_0x5f069c=await profile[_0x39e220(0x195)]({'email':_0x1b5ee8[_0x39e220(0x108)]}),_0x53ca72=await staff[_0x39e220(0x195)]({'email':_0x1b5ee8[_0x39e220(0x108)]});if(_0x1b5ee8[_0x39e220(0x208)]==_0x39e220(0x17c)){const _0x2fe02c=await staff['findOne']({'email':_0x1b5ee8[_0x39e220(0x108)]});}const _0x2249e8=await master_shop['find']();let _0x3f770b;if(_0x1b5ee8['role']==_0x39e220(0x17c)){const _0x515c13=await staff[_0x39e220(0x195)]({'email':_0x1b5ee8[_0x39e220(0x108)]});_0x3f770b=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x515c13[_0x39e220(0x189)]}},{'$lookup':{'from':'suppliers','localField':_0x39e220(0x1c6),'foreignField':_0x39e220(0x1db),'as':'suppliers_docs'}},{'$unwind':_0x39e220(0x1c3)},{'$unwind':_0x39e220(0x15e)},{'$group':{'_id':_0x39e220(0xe9),'invoice':{'$first':_0x39e220(0xf9)},'suppliers':{'$first':_0x39e220(0xfc)},'date':{'$first':_0x39e220(0x12e)},'warehouse_name':{'$first':_0x39e220(0x163)},'room':{'$first':_0x39e220(0x145)},'product':{'$push':_0x39e220(0x15e)},'note':{'$first':_0x39e220(0x178)},'paid_amount':{'$first':_0x39e220(0x185)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x39e220(0x1b5)},'batch_code':{'$first':_0x39e220(0x21d)},'expiry_date':{'$first':_0x39e220(0x206)},'suppliers_docs':{'$first':_0x39e220(0x1c3)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x39e220(0x19f)},'isle':{'$addToSet':_0x39e220(0x169)},'type':{'$addToSet':_0x39e220(0xd9)},'floorlevel':{'$addToSet':_0x39e220(0x152)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3f770b=await purchases_finished[_0x39e220(0x1a9)]([{'$match':{'typeOfProducts':_0x39e220(0x1e6)}},{'$unwind':_0x39e220(0x15e)},{'$group':{'_id':'$_id','invoice':{'$first':_0x39e220(0xf9)},'suppliers':{'$first':_0x39e220(0xfc)},'date':{'$first':_0x39e220(0x12e)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x39e220(0x200)},'product':{'$push':_0x39e220(0x15e)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x39e220(0x11e)},'return_data':{'$first':_0x39e220(0x1b5)},'batch_code':{'$first':_0x39e220(0x21d)},'expiry_date':{'$first':_0x39e220(0x206)},'suppliers_docs':{'$first':_0x39e220(0x1c3)},'total_product_quantity':{'$sum':_0x39e220(0x132)},'level':{'$addToSet':_0x39e220(0x19f)},'isle':{'$addToSet':_0x39e220(0x169)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x39e220(0x152)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2249e8[0x0]['language']=='English\x20(US)')var _0x378fd7=users[_0x39e220(0x1f0)];else{if(_0x2249e8[0x0]['language']==_0x39e220(0x194))var _0x378fd7=users[_0x39e220(0x194)];else{if(_0x2249e8[0x0][_0x39e220(0x19a)]==_0x39e220(0x205))var _0x378fd7=users['German'];else{if(_0x2249e8[0x0]['language']==_0x39e220(0xe6))var _0x378fd7=users[_0x39e220(0xe6)];else{if(_0x2249e8[0x0][_0x39e220(0x19a)]==_0x39e220(0x160))var _0x378fd7=users[_0x39e220(0x160)];else{if(_0x2249e8[0x0]['language']==_0x39e220(0x162))var _0x378fd7=users[_0x39e220(0x150)];else{if(_0x2249e8[0x0]['language']=='Chinese')var _0x378fd7=users[_0x39e220(0x184)];else{if(_0x2249e8[0x0][_0x39e220(0x19a)]==_0x39e220(0x107))var _0x378fd7=users[_0x39e220(0x12c)];}}}}}}}_0x3a09c6[_0x39e220(0x1b6)](_0x39e220(0x1fd),{'success':_0x484663['flash']('success'),'errors':_0x484663['flash'](_0x39e220(0x170)),'purchases':_0x3f770b,'role':_0x1b5ee8,'profile':_0x5f069c,'master_shop':_0x2249e8,'language':_0x378fd7});}catch(_0x1936fb){console['log'](_0x39e220(0x12d),_0x1936fb),_0x3a09c6['status'](0xc8)['json']({'message':_0x1936fb[_0x39e220(0x1c8)]});}});function BayBinSelected(_0x172438,_0x1cdd9e){var _0x382b47=a0_0x3a3de0,_0x5bdfbe=[],_0x42feca=[];if(_0x172438==_0x382b47(0x1d3)){switch(_0x1cdd9e){case _0x382b47(0x16e):_0x5bdfbe=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x382b47(0xef):_0x5bdfbe=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x42feca=['DG'];}else{if(_0x172438==_0x382b47(0x1e1)){switch(_0x1cdd9e){case'Rack\x201':_0x5bdfbe=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x5bdfbe=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x42feca=['FG'];}}return{'levels':_0x5bdfbe,'identify':_0x42feca};}async function getRandom8DigitNumber(){var _0x3e9624=a0_0x3a3de0;const _0x3d4992=0x989680,_0x10617f=0x5f5e0ff,_0x60afdf=Math[_0x3e9624(0x153)](Math[_0x3e9624(0xdd)]()*(_0x10617f-_0x3d4992+0x1))+_0x3d4992;var _0x16fba2;const _0x45b977=await purchases_finished[_0x3e9624(0x195)]({'invoice':_0x3e9624(0x18e)+_0x60afdf});return _0x45b977&&_0x45b977['length']>0x0?_0x16fba2=_0x3e9624(0x18e)+_0x60afdf:_0x16fba2=_0x3e9624(0x18e)+_0x60afdf,_0x16fba2;}router[a0_0x3a3de0(0x177)]('/view/add_purchases',auth,async(_0x5123ee,_0x2c7c69)=>{var _0x3d9a1f=a0_0x3a3de0;try{const {username:_0x171d39,email:_0x4fccd6,role:_0x2e9517}=_0x5123ee['user'],_0x323483=_0x5123ee[_0x3d9a1f(0x11c)],_0x4877c4=await profile[_0x3d9a1f(0x195)]({'email':_0x323483[_0x3d9a1f(0x108)]}),_0x3f25b8=await master_shop[_0x3d9a1f(0x1a3)](),_0x54911c=await staff['findOne']({'email':_0x323483[_0x3d9a1f(0x108)]}),_0x5ce90a=await suppliers[_0x3d9a1f(0x1a3)]({});let _0x909044;if(_0x323483['role']==_0x3d9a1f(0x17c)){const _0x4cd4e7=await staff['findOne']({'email':_0x323483[_0x3d9a1f(0x108)]});_0x909044=await warehouse[_0x3d9a1f(0x1a9)]([{'$match':{'status':'Enabled','name':_0x4cd4e7[_0x3d9a1f(0x189)]}},{'$group':{'_id':_0x3d9a1f(0x1fb),'name':{'$first':'$name'}}}]);}else _0x909044=await warehouse[_0x3d9a1f(0x1a9)]([{'$match':{'status':_0x3d9a1f(0x202)}},{'$group':{'_id':_0x3d9a1f(0x1fb),'name':{'$first':_0x3d9a1f(0x1fb)}}}]);const _0x5473a7=await product[_0x3d9a1f(0x1a3)]({}),_0x1387a1=await warehouse[_0x3d9a1f(0x1a3)]({'status':_0x3d9a1f(0x202)}),_0x2eec7b=await purchases_finished[_0x3d9a1f(0x1a3)]({}),_0x523211=_0x2eec7b[_0x3d9a1f(0x1cf)]+0x1,_0x48bcfe='INCF-'+_0x523211[_0x3d9a1f(0x13b)]()['padStart'](0x5,'0');var _0x55971d=[_0x3d9a1f(0x1dd),'Enclosed'];if(_0x3f25b8[0x0]['language']==_0x3d9a1f(0x19e))var _0x51f828=users['English'];else{if(_0x3f25b8[0x0][_0x3d9a1f(0x19a)]==_0x3d9a1f(0x194))var _0x51f828=users[_0x3d9a1f(0x194)];else{if(_0x3f25b8[0x0][_0x3d9a1f(0x19a)]=='German')var _0x51f828=users['German'];else{if(_0x3f25b8[0x0]['language']=='Spanish')var _0x51f828=users['Spanish'];else{if(_0x3f25b8[0x0][_0x3d9a1f(0x19a)]==_0x3d9a1f(0x160))var _0x51f828=users[_0x3d9a1f(0x160)];else{if(_0x3f25b8[0x0][_0x3d9a1f(0x19a)]==_0x3d9a1f(0x162))var _0x51f828=users[_0x3d9a1f(0x150)];else{if(_0x3f25b8[0x0][_0x3d9a1f(0x19a)]=='Chinese')var _0x51f828=users[_0x3d9a1f(0x184)];else{if(_0x3f25b8[0x0][_0x3d9a1f(0x19a)]==_0x3d9a1f(0x107))var _0x51f828=users['Arabic'];}}}}}}}const _0x4ad470=getRandom8DigitNumber(),_0x13080c=new Date(),_0x3e4c48={'year':'numeric','month':_0x3d9a1f(0x1b0),'day':_0x3d9a1f(0x1b0),'timeZone':_0x3d9a1f(0x1ad)},_0x1e48c9=_0x13080c['toLocaleDateString']('en-CA',_0x3e4c48);console[_0x3d9a1f(0x126)](_0x1e48c9),_0x4ad470[_0x3d9a1f(0x176)](_0x12aed4=>{var _0x2f1611=_0x3d9a1f;_0x2c7c69[_0x2f1611(0x1b6)](_0x2f1611(0x210),{'success':_0x5123ee[_0x2f1611(0x1be)]('success'),'errors':_0x5123ee[_0x2f1611(0x1be)](_0x2f1611(0x170)),'role':_0x323483,'profile':_0x4877c4,'suppliers':_0x5ce90a,'warehouse':_0x909044,'product':_0x5473a7,'invoice':_0x12aed4,'master_shop':_0x3f25b8,'language':_0x51f828,'find_data':_0x1387a1,'rooms_data':_0x55971d,'formattedDate':_0x1e48c9});})[_0x3d9a1f(0x209)](_0x3f4b31=>{var _0x393b05=_0x3d9a1f;_0x5123ee['flash']('errors',_0x393b05(0x1c0)),_0x2c7c69[_0x393b05(0xed)](_0x393b05(0xf7));});}catch(_0x36d275){console[_0x3d9a1f(0x126)](_0x36d275);}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0x190),auth,async(_0x46019c,_0x200275)=>{var _0x32e064=a0_0x3a3de0;try{const {username:_0x2b3f2c,email:_0x3992e5,role:_0x4040e4}=_0x46019c[_0x32e064(0x11c)],_0xfb44a0=_0x46019c['user'],_0x831333=await profile[_0x32e064(0x195)]({'email':_0xfb44a0[_0x32e064(0x108)]}),_0x6dc1d4=await master_shop[_0x32e064(0x1a3)](),_0x3d6396=await staff[_0x32e064(0x195)]({'email':_0xfb44a0[_0x32e064(0x108)]}),_0x512e41=await suppliers[_0x32e064(0x1a3)]({});let _0x573009;if(_0xfb44a0[_0x32e064(0x208)]=='staff'){const _0x4ec77d=await staff['findOne']({'email':_0xfb44a0[_0x32e064(0x108)]});_0x573009=await warehouse[_0x32e064(0x1a9)]([{'$match':{'status':_0x32e064(0x202),'name':_0x4ec77d['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x32e064(0x1fb)}}}]);}else _0x573009=await warehouse[_0x32e064(0x1a9)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x32e064(0x1fb),'name':{'$first':_0x32e064(0x1fb)}}}]);const _0x28680c=await product[_0x32e064(0x1a3)]({}),_0xd0c7e9=await warehouse[_0x32e064(0x1a3)]({'status':'Enabled'}),_0x3b706f=await purchases_finished[_0x32e064(0x1a3)]({}),_0x488ea5=_0x3b706f['length']+0x1,_0x1e3c86=_0x32e064(0x18e)+_0x488ea5[_0x32e064(0x13b)]()[_0x32e064(0x1c5)](0x5,'0');var _0x25f2ca=['Ambient','Enclosed'];if(_0x6dc1d4[0x0][_0x32e064(0x19a)]==_0x32e064(0x19e))var _0x334bdc=users['English'];else{if(_0x6dc1d4[0x0][_0x32e064(0x19a)]=='Hindi')var _0x334bdc=users['Hindi'];else{if(_0x6dc1d4[0x0][_0x32e064(0x19a)]=='German')var _0x334bdc=users[_0x32e064(0x205)];else{if(_0x6dc1d4[0x0][_0x32e064(0x19a)]==_0x32e064(0xe6))var _0x334bdc=users[_0x32e064(0xe6)];else{if(_0x6dc1d4[0x0][_0x32e064(0x19a)]==_0x32e064(0x160))var _0x334bdc=users[_0x32e064(0x160)];else{if(_0x6dc1d4[0x0][_0x32e064(0x19a)]==_0x32e064(0x162))var _0x334bdc=users[_0x32e064(0x150)];else{if(_0x6dc1d4[0x0][_0x32e064(0x19a)]==_0x32e064(0x184))var _0x334bdc=users[_0x32e064(0x184)];else{if(_0x6dc1d4[0x0]['language']=='Arabic\x20(ae)')var _0x334bdc=users[_0x32e064(0x12c)];}}}}}}}const _0xf3250d=getRandom8DigitNumber();_0xf3250d[_0x32e064(0x176)](_0x5e0dbe=>{var _0x5c52b9=_0x32e064;_0x200275['render'](_0x5c52b9(0x104),{'success':_0x46019c[_0x5c52b9(0x1be)](_0x5c52b9(0x102)),'errors':_0x46019c[_0x5c52b9(0x1be)](_0x5c52b9(0x170)),'role':_0xfb44a0,'profile':_0x831333,'suppliers':_0x512e41,'warehouse':_0x573009,'product':_0x28680c,'invoice':_0x5e0dbe,'master_shop':_0x6dc1d4,'language':_0x334bdc,'find_data':_0xd0c7e9,'rooms_data':_0x25f2ca});})[_0x32e064(0x209)](_0x5dfc99=>{var _0xf087c1=_0x32e064;_0x46019c['flash'](_0xf087c1(0x170),_0xf087c1(0x1c0)),_0x200275['redirect'](_0xf087c1(0xf7));});}catch(_0x40381b){console['log'](_0x40381b);}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0x139),auth,async(_0x2019e3,_0x4d81fa)=>{var _0x4f8507=a0_0x3a3de0;try{const _0x50d420=_0x2019e3[_0x4f8507(0x133)]['id'];console[_0x4f8507(0x126)](_0x50d420);const _0x2f0046=await master_shop[_0x4f8507(0x1a3)]();console[_0x4f8507(0x126)]('master',_0x2f0046);const _0xbc760=await product[_0x4f8507(0x195)]({'name':_0x50d420});console[_0x4f8507(0x126)](_0x4f8507(0x125),_0xbc760),_0x4d81fa[_0x4f8507(0x119)](0xc8)[_0x4f8507(0x1c9)]({'product_data':_0xbc760,'master':_0x2f0046});}catch(_0x2777b6){console[_0x4f8507(0x126)]('add_purchases\x20error',_0x2777b6);}}),router[a0_0x3a3de0(0x19c)]('/view/add_purchases',auth,async(_0x16f93c,_0x3d438b)=>{var _0x2a6652=a0_0x3a3de0;try{const {invoice:_0x180960,date:_0x2e35ea,warehouse_name:_0x5ef2b0,prod_name:_0x204a8f,note:_0x2d1946,due_amount:_0x409bf6,Room_name:_0x55ef6,PO_number:_0x355ac2,SCRN:_0x16521b,ReqBy:_0x198f8c,dateofreq:_0x3aac69,suppliers:_0x27e955,typeservicesData:_0x44892a,van:_0x3f7836,typevehicle:_0x16cb71,driver:_0x2a48c1,plate:_0x420e0c,DRSI:_0x414c53,TSU:_0x1d3132,TFU:_0x28c5df,JO_number:_0x3f67ff,type_of_products:_0x3c8038}=_0x16f93c[_0x2a6652(0x1af)];if(typeof _0x204a8f==_0x2a6652(0x1a2))var _0x3d8935=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x15c)]],_0x43f37c=[_0x16f93c[_0x2a6652(0x1af)]['prod_code']],_0x908727=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x182)]],_0x109e66=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x1a0)]],_0x9510f3=[_0x16f93c[_0x2a6652(0x1af)]['prod_secondunit']],_0x3db586=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x1a6)]],_0x7e5216=[_0x16f93c['body']['secondary_code']],_0x1679fd=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x1b8)]],_0x15d76c=[_0x16f93c['body'][_0x2a6652(0xf8)]],_0x6cbbc6=[_0x16f93c['body'][_0x2a6652(0x11d)]],_0x2fc2e8=[_0x16f93c['body'][_0x2a6652(0x18c)]],_0x14f2f9=[_0x16f93c['body'][_0x2a6652(0x1a4)]],_0x2524a8=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x16d)]],_0x57fa93=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x167)]],_0x32663e=[_0x16f93c['body'][_0x2a6652(0x121)]],_0x33e7b0=[_0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x11f)]],_0x13b987=[_0x16f93c[_0x2a6652(0x1af)]['product_id']];else var _0x3d8935=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x15c)]],_0x43f37c=[..._0x16f93c['body'][_0x2a6652(0x14d)]],_0x908727=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x182)]],_0x109e66=[..._0x16f93c['body'][_0x2a6652(0x1a0)]],_0x9510f3=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0xf5)]],_0x3db586=[..._0x16f93c['body'][_0x2a6652(0x1a6)]],_0x7e5216=[..._0x16f93c['body'][_0x2a6652(0xe3)]],_0x1679fd=[..._0x16f93c[_0x2a6652(0x1af)]['MaxStocks_data']],_0x15d76c=[..._0x16f93c[_0x2a6652(0x1af)]['batch_code']],_0x6cbbc6=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x11d)]],_0x2fc2e8=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x18c)]],_0x14f2f9=[..._0x16f93c[_0x2a6652(0x1af)]['max_product_unit']],_0x2524a8=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x16d)]],_0x57fa93=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x167)]],_0x32663e=[..._0x16f93c['body'][_0x2a6652(0x121)]],_0x33e7b0=[..._0x16f93c[_0x2a6652(0x1af)]['sales_data_cateory']],_0x13b987=[..._0x16f93c[_0x2a6652(0x1af)][_0x2a6652(0x179)]];const _0x2589d3=_0x3d8935['map'](_0x2d8e2f=>{return _0x2d8e2f={'product_name':_0x2d8e2f};});_0x13b987[_0x2a6652(0x1e0)]((_0x71083b,_0xbb4d20)=>{var _0x3d4389=_0x2a6652;_0x2589d3[_0xbb4d20]['product_id']=_0x71083b,_0x2589d3[_0xbb4d20][_0x3d4389(0x12b)]=_0x2e35ea;}),_0x33e7b0[_0x2a6652(0x1e0)]((_0x50be18,_0xb3f462)=>{var _0x163878=_0x2a6652;_0x2589d3[_0xb3f462][_0x163878(0x1c4)]=_0x50be18;}),_0x43f37c[_0x2a6652(0x1e0)]((_0x183259,_0x330e84)=>{var _0x8bdfb0=_0x2a6652;_0x2589d3[_0x330e84][_0x8bdfb0(0x14c)]=_0x183259;}),_0x32663e['forEach']((_0x5ce333,_0x3d7213)=>{var _0x26360f=_0x2a6652;_0x2589d3[_0x3d7213][_0x26360f(0x121)]=_0x5ce333;}),_0x908727[_0x2a6652(0x1e0)]((_0x162674,_0x1c339b)=>{var _0x1fcdda=_0x2a6652;_0x2589d3[_0x1c339b][_0x1fcdda(0x216)]=Math[_0x1fcdda(0x1de)](_0x162674);}),_0x109e66['forEach']((_0x15bb93,_0x29bd99)=>{var _0x52c611=_0x2a6652;_0x2589d3[_0x29bd99][_0x52c611(0x21a)]=_0x15bb93;}),_0x9510f3[_0x2a6652(0x1e0)]((_0x2eb8d5,_0x36018d)=>{var _0x310b3f=_0x2a6652;_0x2589d3[_0x36018d][_0x310b3f(0x183)]=_0x2eb8d5;}),_0x3db586[_0x2a6652(0x1e0)]((_0x169e04,_0x23bee0)=>{var _0x520719=_0x2a6652;_0x2589d3[_0x23bee0][_0x520719(0x1a6)]=_0x169e04;}),_0x7e5216[_0x2a6652(0x1e0)]((_0x1a4384,_0x2c0080)=>{var _0x4ead52=_0x2a6652;_0x2589d3[_0x2c0080][_0x4ead52(0xe3)]=_0x1a4384;}),_0x1679fd[_0x2a6652(0x1e0)]((_0x4231ee,_0x43f439)=>{var _0x3a80ba=_0x2a6652;_0x2589d3[_0x43f439][_0x3a80ba(0x138)]=_0x4231ee;}),_0x15d76c[_0x2a6652(0x1e0)]((_0x487a1e,_0x3e9d6c)=>{var _0x29d7f7=_0x2a6652;_0x2589d3[_0x3e9d6c][_0x29d7f7(0xf8)]=_0x487a1e;}),_0x6cbbc6[_0x2a6652(0x1e0)]((_0x6de8af,_0x19b404)=>{var _0x3ef0bd=_0x2a6652;_0x2589d3[_0x19b404][_0x3ef0bd(0x11d)]=_0x6de8af;}),_0x2fc2e8[_0x2a6652(0x1e0)]((_0x18a34e,_0x568544)=>{var _0x1547db=_0x2a6652;_0x2589d3[_0x568544][_0x1547db(0x187)]=_0x18a34e;}),_0x14f2f9[_0x2a6652(0x1e0)]((_0x4a2210,_0x53a2c4)=>{_0x2589d3[_0x53a2c4]['maxperunit']=_0x4a2210;}),_0x2524a8[_0x2a6652(0x1e0)]((_0x498906,_0x1e90c9)=>{_0x2589d3[_0x1e90c9]['product_cat']=_0x498906;}),_0x57fa93['forEach']((_0x28c28a,_0x188242)=>{_0x2589d3[_0x188242]['gross_price']=_0x28c28a;});const _0x1bad30=new invoice_for_incoming();await _0x1bad30['save']();for(let _0x27cd7f=0x0;_0x27cd7f<=_0x3d8935[_0x2a6652(0x1cf)]-0x1;_0x27cd7f++){_0x2589d3[_0x27cd7f][_0x2a6652(0x1ac)]=_0x2a6652(0x1d8)+_0x1bad30['invoice_init'][_0x2a6652(0x13b)]()[_0x2a6652(0x1c5)](0x8,'0');}const _0x386dd1=await warehouse_validation_setup[_0x2a6652(0x1a9)]([{'$match':{'warehouse_name':_0x5ef2b0}}]);for(let _0x28d94f=0x0;_0x28d94f<=_0x386dd1[_0x2a6652(0x1cf)]-0x1;_0x28d94f++){const _0xe16e09=_0x386dd1[_0x28d94f];for(let _0x1216a6=0x0;_0x1216a6<=_0xe16e09[_0x2a6652(0xe1)][_0x2a6652(0x1cf)]-0x1;_0x1216a6++){const _0x230dd3=_0xe16e09['product_data'][_0x1216a6],_0x3157a3=await warehouse[_0x2a6652(0x1a9)]([{'$match':{'name':_0xe16e09['warehouse_name'],'room':_0xe16e09['room']}},{'$unwind':_0x2a6652(0x1e8)},{'$match':{'product_details.level':_0x230dd3[_0x2a6652(0xf4)],'product_details.bay':parseInt(_0x230dd3[_0x2a6652(0xd8)]),'product_details.product_code':_0x230dd3[_0x2a6652(0x14c)]}}]);for(let _0xc5045d=0x0;_0xc5045d<=_0x3157a3['length']-0x1;_0xc5045d++){let _0x2be926=_0x3157a3[_0xc5045d],_0x51d5f6=0x0;_0x2be926[_0x2a6652(0x220)][_0x2a6652(0x14c)]==_0x230dd3['product_code']&&_0x2be926[_0x2a6652(0x220)][_0x2a6652(0xf4)]==_0x230dd3[_0x2a6652(0xd8)]&&_0x2be926[_0x2a6652(0x220)][_0x2a6652(0x212)]==_0x230dd3[_0x2a6652(0xf4)]&&(_0x230dd3[_0x2a6652(0xe8)]=parseInt(_0x230dd3[_0x2a6652(0xe8)])-parseInt(_0x2be926['product_details'][_0x2a6652(0x116)]),_0x51d5f6++),_0x51d5f6=='0'&&(parseInt(_0x230dd3[_0x2a6652(0xe8)])>0x0&&(_0x386dd1[_0x28d94f][_0x2a6652(0xe1)]=_0x386dd1[_0x28d94f][_0x2a6652(0xe1)][_0x2a6652(0x106)]({'bay':_0x230dd3[_0x2a6652(0xf4)],'bin':_0x230dd3['bin'],'max':_0x230dd3[_0x2a6652(0xe8)],'min':_0x230dd3['min'],'product_code':_0x230dd3['product_code'],'product_id':_0x230dd3[_0x2a6652(0x179)],'product_name':_0x230dd3['product_name']})));}}_0x386dd1[_0x28d94f][_0x2a6652(0xe1)]=_0x386dd1[_0x28d94f][_0x2a6652(0xe1)][_0x2a6652(0x12f)](_0xb3cab2=>parseInt(_0xb3cab2[_0x2a6652(0xe8)])>0x0);}for(let _0x2498ff=0x0;_0x2498ff<=_0x386dd1['length']-0x1;_0x2498ff++){const _0x5c7ccd=_0x386dd1[_0x2498ff];for(let _0x5d6ef8=0x0;_0x5d6ef8<=_0x5c7ccd[_0x2a6652(0xe1)][_0x2a6652(0x1cf)]-0x1;_0x5d6ef8++){const _0x376489=_0x5c7ccd['product_data'][_0x5d6ef8],_0x3d44fb=await warehouse_temporary[_0x2a6652(0x1a9)]([{'$match':{'warehouse':_0x5c7ccd['warehouse_name'],'room_name':_0x5c7ccd[_0x2a6652(0x1d9)],'isConfirm':_0x2a6652(0x149),'data_type':_0x2a6652(0x19b),'product_code':_0x376489[_0x2a6652(0x14c)],'level':_0x376489['bay'],'bay':parseInt(_0x376489[_0x2a6652(0xd8)])}}]);for(let _0x86a5e5=0x0;_0x86a5e5<=_0x3d44fb[_0x2a6652(0x1cf)]-0x1;_0x86a5e5++){let _0x50aa44=_0x3d44fb[_0x86a5e5];console[_0x2a6652(0x126)](_0x50aa44);let _0x25d40a=0x0;_0x50aa44[_0x2a6652(0x14c)]==_0x376489['product_code']&&_0x50aa44['bay']==_0x376489[_0x2a6652(0xd8)]&&_0x50aa44[_0x2a6652(0x212)]==_0x376489[_0x2a6652(0xf4)]&&(_0x376489[_0x2a6652(0xe8)]=parseInt(_0x376489[_0x2a6652(0xe8)])-parseInt(_0x50aa44[_0x2a6652(0x116)]),_0x25d40a++),_0x25d40a=='0'&&(parseInt(_0x376489[_0x2a6652(0xe8)])>0x0&&(_0x386dd1[_0x2498ff][_0x2a6652(0xe1)]=_0x386dd1[_0x2498ff]['product_data'][_0x2a6652(0x106)]({'bay':_0x376489[_0x2a6652(0xf4)],'bin':_0x376489[_0x2a6652(0xd8)],'max':_0x376489[_0x2a6652(0xe8)],'min':_0x376489[_0x2a6652(0x131)],'product_code':_0x376489[_0x2a6652(0x14c)],'product_id':_0x376489['product_id'],'product_name':_0x376489['product_name']})));}}_0x386dd1[_0x2498ff][_0x2a6652(0xe1)]=_0x386dd1[_0x2498ff][_0x2a6652(0xe1)][_0x2a6652(0x12f)](_0x23a04b=>parseInt(_0x23a04b['max'])>0x0);}let _0x57fc1a=[],_0x313b25=0x0;for(let _0x2f23d1=0x0;_0x2f23d1<=_0x2589d3[_0x2a6652(0x1cf)]-0x1;_0x2f23d1++){const _0x79f6c6=_0x2589d3[_0x2f23d1];let _0x12f421=_0x79f6c6[_0x2a6652(0x216)];for(let _0x345b30=0x0;_0x345b30<=_0x386dd1[_0x2a6652(0x1cf)]-0x1;_0x345b30++){const _0x2a4f76=_0x386dd1[_0x345b30];for(let _0x548260=0x0;_0x548260<=_0x2a4f76[_0x2a6652(0xe1)][_0x2a6652(0x1cf)]-0x1;_0x548260++){const _0xdb8e=_0x2a4f76[_0x2a6652(0xe1)][_0x548260];if(_0xdb8e[_0x2a6652(0x14c)]===_0x79f6c6['product_code']){const _0x398d76=await warehouse[_0x2a6652(0x1a9)]([{'$match':{'name':_0x5ef2b0,'room':_0x2a4f76['room']}},{'$unwind':_0x2a6652(0x1e8)},{'$match':{'product_details.level':_0xdb8e[_0x2a6652(0xf4)],'product_details.bay':parseInt(_0xdb8e[_0x2a6652(0xd8)])}}]);if(_0x398d76['length']==0x0){for(let _0x464c47=0x0;_0x464c47<=_0x2a4f76[_0x2a6652(0xe1)]['length']-0x1&&_0x12f421>0x0;_0x464c47++){const _0x5d3d88=_0x2a4f76['product_data'][_0x464c47];console[_0x2a6652(0x126)](_0x79f6c6[_0x2a6652(0x14c)]+_0x2a6652(0x1ee)+_0x5d3d88['product_code']+_0x2a6652(0x14a)+_0x5d3d88[_0x2a6652(0x131)]+'\x20<>\x20'+_0x5d3d88[_0x2a6652(0xe8)]+_0x2a6652(0x14a)+_0x5d3d88[_0x2a6652(0xf4)]+_0x2a6652(0x14a)+_0x5d3d88['bin']);if(_0x79f6c6[_0x2a6652(0x14c)]===_0x5d3d88[_0x2a6652(0x14c)]){_0x57fc1a[_0x313b25]={};const _0x4c528b=parseInt(_0x5d3d88[_0x2a6652(0xe8)]),_0x2e8015=0x0;let _0x335757=_0x4c528b-_0x2e8015,_0x1898fb=Math[_0x2a6652(0x131)](_0x12f421,_0x335757);console[_0x2a6652(0x126)](_0x2a6652(0x180)+_0x1898fb+_0x2a6652(0x155)+_0x79f6c6[_0x2a6652(0x1b9)]+_0x2a6652(0xda)+_0x2a4f76[_0x2a6652(0x207)]+_0x2a6652(0x13d)+_0x2a4f76['room']+',\x20bay:\x20'+_0x5d3d88[_0x2a6652(0xf4)]+_0x2a6652(0x21b)+_0x5d3d88[_0x2a6652(0xd8)]+_0x2a6652(0x10f)+_0x313b25),_0x57fc1a[_0x313b25]['product_name']=_0x79f6c6[_0x2a6652(0x1b9)],_0x57fc1a[_0x313b25]['product_code']=_0x79f6c6[_0x2a6652(0x14c)],_0x57fc1a[_0x313b25][_0x2a6652(0x179)]=_0x79f6c6[_0x2a6652(0x179)],_0x57fc1a[_0x313b25][_0x2a6652(0x12b)]=_0x79f6c6[_0x2a6652(0x12b)],_0x57fc1a[_0x313b25][_0x2a6652(0x1c4)]=_0x79f6c6[_0x2a6652(0x1c4)],_0x57fc1a[_0x313b25][_0x2a6652(0x121)]=_0x79f6c6['uuid'],_0x57fc1a[_0x313b25][_0x2a6652(0x216)]=_0x1898fb,_0x57fc1a[_0x313b25][_0x2a6652(0x21a)]=_0x79f6c6[_0x2a6652(0x21a)],_0x57fc1a[_0x313b25]['secondary_unit']=_0x79f6c6[_0x2a6652(0x183)],_0x57fc1a[_0x313b25]['primary_code']=_0x79f6c6['primary_code'],_0x57fc1a[_0x313b25][_0x2a6652(0xe3)]=_0x79f6c6[_0x2a6652(0xe3)],_0x57fc1a[_0x313b25][_0x2a6652(0x138)]=_0x79f6c6['maxStocks'],_0x57fc1a[_0x313b25][_0x2a6652(0xf8)]=_0x79f6c6['batch_code'],_0x57fc1a[_0x313b25]['expiry_date']=_0x79f6c6[_0x2a6652(0x11d)],_0x57fc1a[_0x313b25][_0x2a6652(0x187)]=_0x79f6c6[_0x2a6652(0x187)],_0x57fc1a[_0x313b25]['maxperunit']=_0x79f6c6[_0x2a6652(0x157)],_0x57fc1a[_0x313b25][_0x2a6652(0x1ce)]=_0x79f6c6['product_cat'],_0x57fc1a[_0x313b25]['invoice']=_0x79f6c6[_0x2a6652(0x1ac)],_0x57fc1a[_0x313b25][_0x2a6652(0x167)]=_0x79f6c6[_0x2a6652(0x167)],_0x57fc1a[_0x313b25][_0x2a6652(0x1f4)]=_0x2a4f76[_0x2a6652(0x1d9)],_0x57fc1a[_0x313b25][_0x2a6652(0x212)]=_0x5d3d88[_0x2a6652(0xf4)],_0x57fc1a[_0x313b25][_0x2a6652(0xf4)]=_0x5d3d88[_0x2a6652(0xd8)],_0x12f421-=_0x1898fb,_0x313b25++;if(_0x12f421<=0x0)break;}}if(_0x12f421<=0x0){_0x16f93c['flash'](_0x2a6652(0x170),'The\x20Other\x20'+_0x12f421+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x12f421>0x0){console['log']('There\x20is\x20'+_0x12f421+_0x2a6652(0xeb));break;}}}}}if(_0x12f421>0x0){const _0x3b2174=await warehouse[_0x2a6652(0x1a9)]([{'$match':{'name':_0x5ef2b0,'isStaging':'true'}}]);_0x57fc1a[_0x313b25]={},_0x57fc1a[_0x313b25]['product_name']=_0x79f6c6['product_name'],_0x57fc1a[_0x313b25][_0x2a6652(0x14c)]=_0x79f6c6[_0x2a6652(0x14c)],_0x57fc1a[_0x313b25][_0x2a6652(0x179)]=_0x79f6c6['product_id'],_0x57fc1a[_0x313b25][_0x2a6652(0x12b)]=_0x79f6c6[_0x2a6652(0x12b)],_0x57fc1a[_0x313b25][_0x2a6652(0x1c4)]=_0x79f6c6[_0x2a6652(0x1c4)],_0x57fc1a[_0x313b25][_0x2a6652(0x121)]=_0x79f6c6[_0x2a6652(0x121)],_0x57fc1a[_0x313b25]['quantity']=_0x12f421,_0x57fc1a[_0x313b25][_0x2a6652(0x21a)]=_0x79f6c6['standard_unit'],_0x57fc1a[_0x313b25]['secondary_unit']=_0x79f6c6[_0x2a6652(0x183)],_0x57fc1a[_0x313b25][_0x2a6652(0x1a6)]=_0x79f6c6[_0x2a6652(0x1a6)],_0x57fc1a[_0x313b25][_0x2a6652(0xe3)]=_0x79f6c6[_0x2a6652(0xe3)],_0x57fc1a[_0x313b25][_0x2a6652(0x138)]=_0x79f6c6[_0x2a6652(0x138)],_0x57fc1a[_0x313b25]['batch_code']=_0x79f6c6[_0x2a6652(0xf8)],_0x57fc1a[_0x313b25]['expiry_date']=_0x79f6c6[_0x2a6652(0x11d)],_0x57fc1a[_0x313b25][_0x2a6652(0x187)]=_0x79f6c6[_0x2a6652(0x187)],_0x57fc1a[_0x313b25][_0x2a6652(0x157)]=_0x79f6c6[_0x2a6652(0x157)],_0x57fc1a[_0x313b25][_0x2a6652(0x1ce)]=_0x79f6c6[_0x2a6652(0x1ce)],_0x57fc1a[_0x313b25]['invoice']=_0x79f6c6['invoice'],_0x57fc1a[_0x313b25]['gross_price']=_0x79f6c6['gross_price'],_0x57fc1a[_0x313b25][_0x2a6652(0x1f4)]=_0x3b2174[0x0]['room'],_0x57fc1a[_0x313b25][_0x2a6652(0x212)]='STAGING',_0x57fc1a[_0x313b25][_0x2a6652(0xf4)]='1',console['log'](_0x2a6652(0x1f3)+_0x2a6652(0x14a)+_0x79f6c6[_0x2a6652(0x14c)]+'\x20===\x20'+_0x79f6c6[_0x2a6652(0x14c)]+_0x2a6652(0x14a)+_0x313b25+_0x2a6652(0x14a)+_0x12f421),_0x16f93c[_0x2a6652(0x1be)](_0x2a6652(0x170),'The\x20Other\x20'+_0x12f421+'\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area');}}const _0x101c30=_0x57fc1a[_0x2a6652(0x12f)](_0x24eb89=>_0x24eb89[_0x2a6652(0x216)]!=='0'&&_0x24eb89[_0x2a6652(0x216)]!==''),_0x4ef3e1=new purchases_finished({'invoice':'INC-'+_0x1bad30[_0x2a6652(0x18d)][_0x2a6652(0x13b)]()[_0x2a6652(0x1c5)](0x8,'0'),'suppliers':_0x27e955,'date':_0x2e35ea,'warehouse_name':_0x5ef2b0,'product':_0x101c30,'note':_0x2d1946,'due_amount':_0x409bf6,'room':_0x55ef6,'POnumber':_0x355ac2,'SCRN':_0x16521b,'JO_number':_0x3f67ff,'ReqBy':_0x198f8c,'dateofreq':_0x3aac69,'typeservicesData':_0x44892a,'van':_0x3f7836,'typevehicle':_0x16cb71,'driver':_0x2a48c1,'plate':_0x420e0c,'DRSI':_0x414c53,'TSU':_0x1d3132,'TFU':_0x28c5df,'typeOfProducts':_0x3c8038}),_0x5cacd8=await _0x4ef3e1['save'](),_0x26517c=await purchases_finished['findOne']({'_id':_0x5cacd8[_0x2a6652(0x1c7)][_0x2a6652(0x158)]()});_0x16f93c[_0x2a6652(0x1be)](_0x2a6652(0x102),_0x2a6652(0x20d)),_0x3d438b[_0x2a6652(0xed)](_0x2a6652(0xfb)+_0x26517c[_0x2a6652(0x1c7)][_0x2a6652(0x158)]());}catch(_0x4fca14){console[_0x2a6652(0x126)](_0x4fca14);}}),router['get'](a0_0x3a3de0(0x1d6),auth,async(_0x13237a,_0x4b434e)=>{var _0x5e224d=a0_0x3a3de0;try{const {username:_0x1b9498,email:_0x1cb162,role:_0x1742cb}=_0x13237a['user'],_0x14541d=_0x13237a[_0x5e224d(0x11c)],_0x115c55=_0x13237a[_0x5e224d(0x133)]['id'],_0x2e9566=await profile[_0x5e224d(0x195)]({'email':_0x14541d[_0x5e224d(0x108)]}),_0x3faebc=await master_shop[_0x5e224d(0x1a3)](),_0x1e0471=await staff[_0x5e224d(0x195)]({'email':_0x14541d[_0x5e224d(0x108)]}),_0x31122a=await suppliers[_0x5e224d(0x1a3)]({});let _0x4b4ad0;if(_0x14541d[_0x5e224d(0x208)]==_0x5e224d(0x17c)){const _0x3504a3=await staff[_0x5e224d(0x195)]({'email':_0x14541d['email']});_0x4b4ad0=await warehouse[_0x5e224d(0x1a9)]([{'$match':{'status':_0x5e224d(0x202),'name':_0x3504a3['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x5e224d(0x1fb)}}}]);}else _0x4b4ad0=await warehouse[_0x5e224d(0x1a9)]([{'$match':{'status':_0x5e224d(0x202)}},{'$group':{'_id':_0x5e224d(0x1fb),'name':{'$first':'$name'}}}]);const _0x2458a0=await purchases_finished[_0x5e224d(0x117)](_0x115c55);if(_0x3faebc[0x0][_0x5e224d(0x19a)]=='English\x20(US)')var _0x2c9eb3=users['English'];else{if(_0x3faebc[0x0][_0x5e224d(0x19a)]==_0x5e224d(0x194))var _0x2c9eb3=users[_0x5e224d(0x194)];else{if(_0x3faebc[0x0][_0x5e224d(0x19a)]==_0x5e224d(0x205))var _0x2c9eb3=users[_0x5e224d(0x205)];else{if(_0x3faebc[0x0]['language']=='Spanish')var _0x2c9eb3=users[_0x5e224d(0xe6)];else{if(_0x3faebc[0x0][_0x5e224d(0x19a)]=='French')var _0x2c9eb3=users['French'];else{if(_0x3faebc[0x0]['language']==_0x5e224d(0x162))var _0x2c9eb3=users[_0x5e224d(0x150)];else{if(_0x3faebc[0x0][_0x5e224d(0x19a)]==_0x5e224d(0x184))var _0x2c9eb3=users['Chinese'];else{if(_0x3faebc[0x0][_0x5e224d(0x19a)]==_0x5e224d(0x107))var _0x2c9eb3=users['Arabic'];}}}}}}}_0x4b434e[_0x5e224d(0x1b6)](_0x5e224d(0x1d1),{'success':_0x13237a['flash'](_0x5e224d(0x102)),'errors':_0x13237a['flash'](_0x5e224d(0x170)),'role':_0x14541d,'profile':_0x2e9566,'suppliers':_0x31122a,'warehouse':_0x4b4ad0,'master_shop':_0x3faebc,'language':_0x2c9eb3,'purchases_data':_0x2458a0});}catch(_0x2a68d6){console[_0x5e224d(0x126)](_0x2a68d6);}});async function get_warehouse_data(_0x21fcfb,_0x57cbfe){var _0x54b6e0=a0_0x3a3de0;try{const _0x185d4a=await warehouse_temporary[_0x54b6e0(0x195)]({'name':_0x21fcfb,'room':_0x57cbfe});if(!_0x185d4a){const _0x4fa8bc=new warehouse_temporary({'name':_0x21fcfb,'address':_0x21fcfb,'status':_0x54b6e0(0x202),'room':_0x57cbfe,'isStaging':_0x54b6e0(0x149)});return await _0x4fa8bc[_0x54b6e0(0x10b)](),_0x4fa8bc;}else return _0x185d4a;}catch(_0xff87b2){console[_0x54b6e0(0x146)](_0x54b6e0(0x13e),_0xff87b2);throw _0xff87b2;}}router['post'](a0_0x3a3de0(0x1d6),auth,async(_0x59f01d,_0x27cd02)=>{var _0x1abdd2=a0_0x3a3de0;try{const _0x390fb7=_0x59f01d[_0x1abdd2(0x133)]['id'],_0x3dccc6=await purchases_finished[_0x1abdd2(0x117)](_0x390fb7);let _0x21c201=[];_0x3dccc6[_0x1abdd2(0x125)][_0x1abdd2(0x1e0)]((_0x155111,_0xca70f8)=>{var _0x2214c6=_0x1abdd2;_0x21c201[_0xca70f8]={},_0x21c201[_0xca70f8][_0x2214c6(0x189)]=_0x3dccc6['warehouse_name'],_0x21c201[_0xca70f8]['product_id']=_0x155111['product_id'],_0x21c201[_0xca70f8][_0x2214c6(0x1b9)]=_0x155111[_0x2214c6(0x1b9)],_0x21c201[_0xca70f8][_0x2214c6(0x14c)]=_0x155111[_0x2214c6(0x14c)],_0x21c201[_0xca70f8][_0x2214c6(0x116)]=_0x155111[_0x2214c6(0x216)],_0x21c201[_0xca70f8][_0x2214c6(0x19d)]=_0x155111[_0x2214c6(0x21a)],_0x21c201[_0xca70f8][_0x2214c6(0x183)]=_0x155111['secondary_unit'],_0x21c201[_0xca70f8]['level']=_0x155111[_0x2214c6(0x212)],_0x21c201[_0xca70f8][_0x2214c6(0xf4)]=_0x155111[_0x2214c6(0xf4)],_0x21c201[_0xca70f8]['primary_code']=_0x155111[_0x2214c6(0x1a6)],_0x21c201[_0xca70f8][_0x2214c6(0xe3)]=_0x155111[_0x2214c6(0xe3)],_0x21c201[_0xca70f8][_0x2214c6(0x138)]=_0x155111[_0x2214c6(0x138)],_0x21c201[_0xca70f8][_0x2214c6(0xf8)]=_0x155111[_0x2214c6(0xf8)],_0x21c201[_0xca70f8][_0x2214c6(0x11d)]=_0x155111[_0x2214c6(0x11d)],_0x21c201[_0xca70f8]['production_date']=_0x155111[_0x2214c6(0x187)],_0x21c201[_0xca70f8][_0x2214c6(0x157)]=_0x155111['maxperunit'],_0x21c201[_0xca70f8][_0x2214c6(0x1ce)]=_0x155111[_0x2214c6(0x1ce)],_0x21c201[_0xca70f8][_0x2214c6(0x1f4)]=_0x155111[_0x2214c6(0x1f4)],_0x21c201[_0xca70f8][_0x2214c6(0x1ac)]=_0x155111['invoice'],_0x21c201[_0xca70f8]['uuid']=_0x155111[_0x2214c6(0x121)],_0x21c201[_0xca70f8]['gross_price']=_0x155111[_0x2214c6(0x167)],_0x21c201[_0xca70f8][_0x2214c6(0x1c4)]=_0x155111[_0x2214c6(0x1c4)],_0x21c201[_0xca70f8][_0x2214c6(0x12b)]=_0x155111[_0x2214c6(0x12b)],_0x21c201[_0xca70f8][_0x2214c6(0x1a7)]=_0x155111['_id'][_0x2214c6(0x158)](),_0x21c201[_0xca70f8]['data_type']=_0x2214c6(0x19b),_0x21c201[_0xca70f8][_0x2214c6(0x159)]=_0x2214c6(0x17a),_0x21c201[_0xca70f8][_0x2214c6(0xf1)]=_0x2214c6(0x149);});for(let _0x10e7e6=0x0;_0x10e7e6<=_0x21c201['length']-0x1;_0x10e7e6++){const _0x4eabb6=_0x21c201[_0x10e7e6],_0x1646f4=new warehouse_temporary(_0x4eabb6);await _0x1646f4[_0x1abdd2(0x10b)]();}_0x3dccc6['isProcess']=_0x1abdd2(0x17a),await _0x3dccc6[_0x1abdd2(0x10b)](),_0x59f01d['flash']('success',_0x1abdd2(0x191)),_0x27cd02[_0x1abdd2(0xed)](_0x1abdd2(0xfb)+_0x3dccc6[_0x1abdd2(0x1c7)][_0x1abdd2(0x158)]());}catch(_0x2f83a8){}}),router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0x190),auth,async(_0x18dc2d,_0x272f9a)=>{var _0x320698=a0_0x3a3de0;try{const {invoice:_0x4acd55,date:_0x7f029e,warehouse_name:_0x29a36c,prod_name:_0x1fd581,note:_0x4ddbf4,due_amount:_0x4f568f,Room_name:_0x131b36,PO_number:_0x4c8d52,SCRN:_0x50a780,ReqBy:_0x3b2ca7,dateofreq:_0x96ac6,suppliers:_0x224957,typeservicesData:_0x416bc8,van:_0xf507d7,typevehicle:_0x2a48d1,driver:_0x278354,plate:_0x55c106,DRSI:_0x3430ed,TSU:_0x4faec6,TFU:_0x11057b,JO_number:_0x249db5,type_of_products:_0x58a1e6}=_0x18dc2d['body'];if(typeof _0x1fd581==_0x320698(0x1a2))var _0x4dec97=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x15c)]],_0x421559=[_0x18dc2d[_0x320698(0x1af)]['prod_code']],_0x2a40f2=[_0x18dc2d['body']['prod_Qty']],_0xc1f916=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x1a0)]],_0x3793d0=[_0x18dc2d[_0x320698(0x1af)]['prod_secondunit']],_0x16333=[_0x18dc2d[_0x320698(0x1af)]['prod_level']],_0x39d360=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x1a6)]],_0x577b31=[_0x18dc2d['body']['secondary_code']],_0x561355=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x1b8)]],_0x2a3d25=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0xf8)]],_0x4389e2=[_0x18dc2d['body'][_0x320698(0x11d)]],_0x4ee39d=[_0x18dc2d['body'][_0x320698(0x18c)]],_0xed09cc=[_0x18dc2d[_0x320698(0x1af)]['max_product_unit']],_0x515198=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x16d)]],_0x190627=[_0x18dc2d[_0x320698(0x1af)]['RoomAssign']],_0x6a8a7a=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x167)]],_0x3702fb=[_0x18dc2d[_0x320698(0x1af)][_0x320698(0x121)]],_0x931961=[_0x18dc2d['body']['sales_data_cateory']],_0x1911d5=[_0x18dc2d[_0x320698(0x1af)]['type_of_products_type']];else var _0x4dec97=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x15c)]],_0x421559=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x14d)]],_0x2a40f2=[..._0x18dc2d['body'][_0x320698(0x182)]],_0xc1f916=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x1a0)]],_0x3793d0=[..._0x18dc2d['body']['prod_secondunit']],_0x16333=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x1bd)]],_0x39d360=[..._0x18dc2d['body'][_0x320698(0x1a6)]],_0x577b31=[..._0x18dc2d[_0x320698(0x1af)]['secondary_code']],_0x561355=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x1b8)]],_0x2a3d25=[..._0x18dc2d['body'][_0x320698(0xf8)]],_0x4389e2=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x11d)]],_0x4ee39d=[..._0x18dc2d[_0x320698(0x1af)]['product_date']],_0xed09cc=[..._0x18dc2d['body'][_0x320698(0x1a4)]],_0x515198=[..._0x18dc2d['body'][_0x320698(0x16d)]],_0x190627=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x181)]],_0x6a8a7a=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x167)]],_0x3702fb=[..._0x18dc2d[_0x320698(0x1af)]['uuid']],_0x931961=[..._0x18dc2d[_0x320698(0x1af)][_0x320698(0x11f)]],_0x1911d5=[..._0x18dc2d[_0x320698(0x1af)]['type_of_products_type']];const _0xfcd6df=_0x4dec97['map'](_0x10e05c=>{return _0x10e05c={'product_name':_0x10e05c};});_0x1911d5['forEach']((_0x4e5476,_0x5d0cc6)=>{_0xfcd6df[_0x5d0cc6]['type_of_products']=_0x4e5476;}),_0x931961['forEach']((_0x958e9,_0x1ef7f3)=>{var _0x452d19=_0x320698;_0xfcd6df[_0x1ef7f3][_0x452d19(0x1c4)]=_0x958e9;}),_0x421559['forEach']((_0x32ece7,_0x77ac28)=>{var _0x11ee94=_0x320698;_0xfcd6df[_0x77ac28][_0x11ee94(0x14c)]=_0x32ece7;}),_0x3702fb[_0x320698(0x1e0)]((_0xf28c88,_0x19b422)=>{var _0x2ec08f=_0x320698;_0xfcd6df[_0x19b422][_0x2ec08f(0x121)]=_0xf28c88;}),_0x2a40f2[_0x320698(0x1e0)]((_0x2c1c03,_0x1d554e)=>{var _0x4987bc=_0x320698;_0xfcd6df[_0x1d554e][_0x4987bc(0x216)]=Math['abs'](_0x2c1c03);}),_0xc1f916[_0x320698(0x1e0)]((_0x22c760,_0xc169fe)=>{_0xfcd6df[_0xc169fe]['standard_unit']=_0x22c760;}),_0x3793d0['forEach']((_0x5aa8d7,_0x50df48)=>{_0xfcd6df[_0x50df48]['secondary_unit']=_0x5aa8d7;}),_0x16333[_0x320698(0x1e0)]((_0x38b847,_0x4d8a0f)=>{var _0x5f1495=_0x320698,_0x1d0fed=_0x38b847[_0x5f1495(0x1c1)](/[A-Za-z]+/)[0x0],_0x5221e2=parseInt(_0x38b847[_0x5f1495(0x1c1)](/\d+/)[0x0]);_0xfcd6df[_0x4d8a0f][_0x5f1495(0x212)]=_0x1d0fed,_0xfcd6df[_0x4d8a0f][_0x5f1495(0xf4)]=_0x5221e2;}),_0x39d360[_0x320698(0x1e0)]((_0x25ee6c,_0x3c7a19)=>{var _0x5308d6=_0x320698;_0xfcd6df[_0x3c7a19][_0x5308d6(0x1a6)]=_0x25ee6c;}),_0x577b31[_0x320698(0x1e0)]((_0x50fe66,_0x105029)=>{var _0x291bc9=_0x320698;_0xfcd6df[_0x105029][_0x291bc9(0xe3)]=_0x50fe66;}),_0x561355['forEach']((_0x25a11c,_0x460c3e)=>{var _0x4bab81=_0x320698;_0xfcd6df[_0x460c3e][_0x4bab81(0x138)]=_0x25a11c;}),_0x2a3d25[_0x320698(0x1e0)]((_0x1b39df,_0x293515)=>{var _0x193110=_0x320698;_0xfcd6df[_0x293515][_0x193110(0xf8)]=_0x1b39df;}),_0x4389e2[_0x320698(0x1e0)]((_0x3a92f6,_0x26d594)=>{_0xfcd6df[_0x26d594]['expiry_date']=_0x3a92f6;}),_0x4ee39d[_0x320698(0x1e0)]((_0xbe1c2e,_0x14f47e)=>{var _0x2af8f9=_0x320698;_0xfcd6df[_0x14f47e][_0x2af8f9(0x187)]=_0xbe1c2e;}),_0xed09cc[_0x320698(0x1e0)]((_0x3a4fe4,_0x2ec11a)=>{var _0x45e29d=_0x320698;_0xfcd6df[_0x2ec11a][_0x45e29d(0x157)]=_0x3a4fe4;}),_0x515198[_0x320698(0x1e0)]((_0x1596a9,_0x3a2c62)=>{var _0x5317d6=_0x320698;_0xfcd6df[_0x3a2c62][_0x5317d6(0x1ce)]=_0x1596a9;}),_0x190627[_0x320698(0x1e0)]((_0x5416ad,_0x25c42b)=>{_0xfcd6df[_0x25c42b]['room_name']=_0x5416ad;}),_0x6a8a7a[_0x320698(0x1e0)]((_0x27dabb,_0x5f4e46)=>{var _0x1dd44a=_0x320698;_0xfcd6df[_0x5f4e46][_0x1dd44a(0x167)]=_0x27dabb;});const _0x38e848=new purchases_logs();await _0x38e848[_0x320698(0x10b)]();for(let _0x28cd20=0x0;_0x28cd20<=_0x190627['length']-0x1;_0x28cd20++){_0xfcd6df[_0x28cd20][_0x320698(0x1ac)]=_0x320698(0x1e9)+_0x38e848[_0x320698(0x18d)][_0x320698(0x13b)]()[_0x320698(0x1c5)](0x8,'0');}const _0x39e810=_0xfcd6df[_0x320698(0x12f)](_0x50ef0d=>_0x50ef0d[_0x320698(0x216)]!=='0'&&_0x50ef0d['quantity']!==''),_0x522629=new purchases_finished({'invoice':_0x320698(0x1e9)+_0x38e848[_0x320698(0x18d)][_0x320698(0x13b)]()['padStart'](0x8,'0'),'suppliers':_0x224957,'date':_0x7f029e,'warehouse_name':_0x29a36c,'product':_0x39e810,'note':_0x4ddbf4,'due_amount':_0x4f568f,'room':_0x131b36,'POnumber':_0x4c8d52,'SCRN':_0x50a780,'JO_number':_0x249db5,'ReqBy':_0x3b2ca7,'dateofreq':_0x96ac6,'typeservicesData':_0x416bc8,'van':_0xf507d7,'typevehicle':_0x2a48d1,'driver':_0x278354,'plate':_0x55c106,'DRSI':_0x3430ed,'TSU':_0x4faec6,'TFU':_0x11057b,'typeOfProducts':_0x58a1e6}),_0x460fe4=await _0x522629[_0x320698(0x10b)](),_0x52a750=await purchases_finished[_0x320698(0x195)]({'_id':_0x460fe4[_0x320698(0x1c7)][_0x320698(0x158)]()}),_0x767022=_0x52a750['product'][_0x320698(0x193)](async _0x32ba05=>{var _0x288c8c=_0x320698;try{var _0x55ff5b=await warehouse[_0x288c8c(0x195)]({'name':_0x29a36c,'room':_0x32ba05['room_name']}),_0x72bb93=0x0;const _0x3027d2=_0x55ff5b[_0x288c8c(0x220)]['map'](_0x277d2e=>{var _0x1eb318=_0x288c8c;console['log'](_0x277d2e['product_name']+'=='+_0x32ba05[_0x1eb318(0x1b9)]+'&&'+_0x277d2e[_0x1eb318(0xf4)]+'=='+_0x32ba05['bay']+'&&'+_0x277d2e[_0x1eb318(0x11d)]+'=='+_0x32ba05['expiry_date']+'&&'+_0x277d2e[_0x1eb318(0x187)]+'=='+_0x32ba05[_0x1eb318(0x187)]+'&&'+_0x277d2e[_0x1eb318(0xf8)]+'=='+_0x32ba05['batch_code']+'&&'+_0x277d2e[_0x1eb318(0x1ac)]+'=='+_0x52a750['invoice']),_0x277d2e[_0x1eb318(0x1b9)]==_0x32ba05['product_name']&&_0x277d2e[_0x1eb318(0xf4)]==_0x32ba05[_0x1eb318(0xf4)]&&_0x277d2e[_0x1eb318(0x212)]==_0x32ba05[_0x1eb318(0x212)]&&_0x277d2e[_0x1eb318(0x11d)]==_0x32ba05[_0x1eb318(0x11d)]&&_0x277d2e[_0x1eb318(0x187)]==_0x32ba05[_0x1eb318(0x187)]&&_0x277d2e[_0x1eb318(0xf8)]==_0x32ba05[_0x1eb318(0xf8)]&&_0x277d2e[_0x1eb318(0x1ac)]==_0x52a750['invoice']&&(_0x277d2e[_0x1eb318(0x116)]=Math[_0x1eb318(0x1de)](_0x277d2e[_0x1eb318(0x116)])+Math['abs'](_0x32ba05[_0x1eb318(0x216)]),_0x72bb93++);});return _0x72bb93==0x0&&(_0x55ff5b['product_details']=_0x55ff5b[_0x288c8c(0x220)]['concat']({'product_name':_0x32ba05[_0x288c8c(0x1b9)],'product_stock':Math[_0x288c8c(0x1de)](_0x32ba05[_0x288c8c(0x216)]),'primary_code':_0x32ba05[_0x288c8c(0x1a6)],'secondary_code':_0x32ba05['secondary_code'],'product_code':_0x32ba05[_0x288c8c(0x14c)],'bay':_0x32ba05[_0x288c8c(0xf4)],'level':_0x32ba05[_0x288c8c(0x212)],'maxProducts':_0x32ba05[_0x288c8c(0x138)],'unit':_0x32ba05['standard_unit'],'secondary_unit':_0x32ba05[_0x288c8c(0x183)],'expiry_date':_0x32ba05['expiry_date'],'production_date':_0x32ba05[_0x288c8c(0x187)],'maxProducts':_0x32ba05['maxStocks'],'maxPerUnit':_0x32ba05[_0x288c8c(0x157)],'batch_code':_0x32ba05[_0x288c8c(0xf8)],'product_cat':_0x32ba05[_0x288c8c(0x1ce)],'invoice':_0x32ba05[_0x288c8c(0x1ac)],'id_incoming':_0x32ba05[_0x288c8c(0x1c7)],'uuid':_0x32ba05[_0x288c8c(0x121)],'gross_price':_0x32ba05[_0x288c8c(0x167)],'sales_category':_0x32ba05[_0x288c8c(0x1c4)],'type_products':_0x32ba05[_0x288c8c(0x1ca)]})),_0x55ff5b;}catch(_0x5c7e2b){return console[_0x288c8c(0x146)](_0x288c8c(0x142),_0x5c7e2b),null;}});Promise[_0x320698(0x196)](_0x767022)[_0x320698(0x176)](async _0x4916fa=>{var _0x393196=_0x320698;try{for(const _0x25f91d of _0x4916fa){await warehouse[_0x393196(0x20c)]({'_id':_0x25f91d[_0x393196(0x1c7)]},{'$addToSet':{'product_details':{'$each':_0x25f91d[_0x393196(0x220)]}}});}const _0x3d2347=await master_shop['find'](),_0xda33a5=await email_settings['findOne'](),_0x2042d7=await supervisor_settings['find']();var _0x3e7f33=_0x52a750['product'],_0x2110d3='',_0x447139;for(_0x447139 in _0x3e7f33){var _0x3f0245='FG';_0x52a750['warehouse_name']==_0x393196(0x1d3)&&(_0x3f0245='DG'),_0x2110d3+=_0x393196(0x18a)+_0x393196(0x101)+_0x3e7f33[_0x447139][_0x393196(0x1b9)]+_0x393196(0x161)+_0x393196(0x101)+_0x3e7f33[_0x447139]['product_code']+_0x393196(0x161)+_0x393196(0x101)+_0x3e7f33[_0x447139][_0x393196(0x216)]+_0x393196(0x161)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e7f33[_0x447139][_0x393196(0x21a)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e7f33[_0x447139][_0x393196(0x183)]+_0x393196(0x161)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x52a750[_0x393196(0x207)]+_0x393196(0x161)+_0x393196(0x101)+_0x3e7f33[_0x447139][_0x393196(0x1f4)]+_0x393196(0x161)+_0x393196(0x101)+_0x3f0245+_0x3e7f33[_0x447139][_0x393196(0xf4)]+'</td>',_0x393196(0x154);}let _0x575c23=nodemailer['createTransport']({'host':_0xda33a5[_0x393196(0x1cb)],'port':Number(_0xda33a5[_0x393196(0x1ec)]),'secure':![],'auth':{'user':_0xda33a5[_0x393196(0x108)],'pass':_0xda33a5[_0x393196(0xe5)]}}),_0x3d519c={'from':_0xda33a5[_0x393196(0x108)],'to':_0x2042d7[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x393196(0x14f),'path':__dirname+'/../public'+_0x393196(0x21f)+_0x3d2347[0x0][_0x393196(0x1bc)],'cid':_0x393196(0x15a)}],'html':_0x393196(0x1ae)+_0x393196(0x13f)+_0x393196(0x1ed)+'<div>'+_0x393196(0x14e)+_0x393196(0x21c)+_0x393196(0xe2)+'</div>'+'<div>'+_0x393196(0x105)+_0x3d2347[0x0][_0x393196(0x20b)]+_0x393196(0x122)+_0x393196(0x128)+_0x393196(0x128)+_0x393196(0x1d7)+_0x393196(0x21c)+_0x393196(0x151)+_0x393196(0x13c)+_0x52a750[_0x393196(0x1ac)]+'\x20'+_0x393196(0x156)+'\x20Order\x20Date\x20:\x20'+_0x52a750[_0x393196(0x137)]+'\x20'+_0x393196(0x1eb)+'</h5>'+_0x393196(0x128)+_0x393196(0x1fe)+_0x393196(0x20a)+_0x393196(0x18a)+_0x393196(0x1ea)+_0x393196(0x18b)+_0x393196(0x1fa)+_0x393196(0x174)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x393196(0xea)+_0x393196(0x17d)+_0x393196(0x1e4)+_0x393196(0x154)+'</thead>'+_0x393196(0x172)+'\x20'+_0x2110d3+'\x20'+'</tbody>'+_0x393196(0x1d0)+'<div>'+_0x393196(0x113)+_0x393196(0x1f2)+_0x3d2347[0x0][_0x393196(0x20b)]+'</h5>'+_0x393196(0x128)+_0x393196(0x128)+_0x393196(0x164)};_0x575c23[_0x393196(0xfd)](_0x3d519c,function(_0x73876d,_0x5ec7e0){var _0x52bc87=_0x393196;_0x73876d?(console[_0x52bc87(0x126)](_0x73876d),console['log'](_0x52bc87(0x171))):console[_0x52bc87(0x126)](_0x52bc87(0x1b2));});}catch(_0x3617b7){console[_0x393196(0x146)](_0x3617b7),_0x272f9a[_0x393196(0x119)](0x1f4)[_0x393196(0x1c9)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x3617b7[_0x393196(0x1c8)]});}})[_0x320698(0x209)](_0x3c4978=>{var _0x3759c8=_0x320698;console[_0x3759c8(0x146)](_0x3c4978);}),_0x18dc2d[_0x320698(0x1be)](_0x320698(0x102),_0x320698(0x20d)),_0x272f9a['redirect'](_0x320698(0x13a)+_0x52a750[_0x320698(0x1c7)][_0x320698(0x158)]());}catch(_0x465ccb){console['log'](_0x465ccb);}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0x1a5),auth,async(_0x107f87,_0x4949be)=>{var _0x511811=a0_0x3a3de0;try{const {username:_0x252385,email:_0x45878c,role:_0x53d6a1}=_0x107f87['user'],_0x56b86a=_0x107f87[_0x511811(0x11c)],_0x35080a=await profile[_0x511811(0x195)]({'email':_0x56b86a[_0x511811(0x108)]}),_0x492509=await master_shop[_0x511811(0x1a3)](),_0x466bb7=_0x107f87[_0x511811(0x133)]['id'],_0x8fb972=await purchases_finished[_0x511811(0x117)](_0x466bb7),_0x2f7955=await suppliers['find']({});let _0x3e248c;if(_0x56b86a[_0x511811(0x208)]=='staff'){const _0x5e0654=await staff[_0x511811(0x195)]({'email':_0x56b86a[_0x511811(0x108)]});_0x3e248c=await warehouse[_0x511811(0x1a3)]({'status':'Enabled','name':_0x5e0654[_0x511811(0x189)],'warehouse_category':_0x511811(0x1f8)});}else _0x3e248c=await warehouse[_0x511811(0x1a9)]([{'$match':{'status':_0x511811(0x202),'warehouse_category':_0x511811(0x1f8)}},{'$group':{'_id':_0x511811(0x1fb),'name':{'$first':_0x511811(0x1fb)}}}]);const _0x1fd382=await product[_0x511811(0x1a3)]({}),_0x5841c1=BayBinSelected(_0x8fb972[_0x511811(0x207)],_0x8fb972[_0x511811(0x1d9)]);let _0x24226c=new Date(_0x8fb972[_0x511811(0x11d)]),_0x41f30d=('0'+_0x24226c['getDate']())['slice'](-0x2),_0x4d2414=('0'+(_0x24226c[_0x511811(0xf0)]()+0x1))[_0x511811(0x15d)](-0x2),_0xf455e9=_0x24226c[_0x511811(0xec)](),_0x1323f9=_0xf455e9+'-'+_0x4d2414+'-'+_0x41f30d;if(_0x492509[0x0]['language']=='English\x20(US)'){var _0x1fa0e5=users['English'];console[_0x511811(0x126)](_0x1fa0e5);}else{if(_0x492509[0x0]['language']==_0x511811(0x194))var _0x1fa0e5=users['Hindi'];else{if(_0x492509[0x0][_0x511811(0x19a)]==_0x511811(0x205))var _0x1fa0e5=users[_0x511811(0x205)];else{if(_0x492509[0x0][_0x511811(0x19a)]=='Spanish')var _0x1fa0e5=users[_0x511811(0xe6)];else{if(_0x492509[0x0][_0x511811(0x19a)]=='French')var _0x1fa0e5=users[_0x511811(0x160)];else{if(_0x492509[0x0][_0x511811(0x19a)]==_0x511811(0x162))var _0x1fa0e5=users[_0x511811(0x150)];else{if(_0x492509[0x0]['language']==_0x511811(0x184))var _0x1fa0e5=users[_0x511811(0x184)];else{if(_0x492509[0x0]['language']=='Arabic\x20(ae)')var _0x1fa0e5=users[_0x511811(0x12c)];}}}}}}}_0x4949be[_0x511811(0x1b6)](_0x511811(0x11a),{'success':_0x107f87[_0x511811(0x1be)](_0x511811(0x102)),'errors':_0x107f87[_0x511811(0x1be)](_0x511811(0x170)),'role':_0x56b86a,'profile':_0x35080a,'purchases':_0x8fb972,'suppliers':_0x2f7955,'warehouse':_0x3e248c,'product':_0x1fd382,'master_shop':_0x492509,'language':_0x1fa0e5,'ed_fullDate':_0x1323f9,'dataSelected':_0x5841c1});}catch(_0x8e91bd){console[_0x511811(0x126)](_0x8e91bd);}}),router[a0_0x3a3de0(0x177)]('/view/:id',auth,async(_0x42b0aa,_0x296956)=>{var _0x3d2560=a0_0x3a3de0;try{const {username:_0x207d4e,email:_0xbcbb79,role:_0xff800e}=_0x42b0aa[_0x3d2560(0x11c)],_0x1298c0=_0x42b0aa['user'],_0x42817a=await profile['findOne']({'email':_0x1298c0['email']}),_0x5a24aa=await master_shop['find'](),_0x425e98=_0x42b0aa['params']['id'],_0x1f7275=await purchases_finished[_0x3d2560(0x117)](_0x425e98),_0x3d05ed=await suppliers[_0x3d2560(0x1a3)]({});let _0x24f004;if(_0x1298c0[_0x3d2560(0x208)]==_0x3d2560(0x17c)){const _0x38f3e4=await staff[_0x3d2560(0x195)]({'email':_0x1298c0[_0x3d2560(0x108)]});_0x24f004=await warehouse[_0x3d2560(0x1a3)]({'status':_0x3d2560(0x202),'name':_0x38f3e4['warehouse'],'warehouse_category':_0x3d2560(0x1f8)});}else _0x24f004=await warehouse[_0x3d2560(0x1a9)]([{'$match':{'status':_0x3d2560(0x202),'warehouse_category':_0x3d2560(0x1f8)}},{'$group':{'_id':_0x3d2560(0x1fb),'name':{'$first':_0x3d2560(0x1fb)}}}]);const _0x5a55d2=await product[_0x3d2560(0x1a3)]({}),_0xcdc9b5=BayBinSelected(_0x1f7275['warehouse_name'],_0x1f7275[_0x3d2560(0x1d9)]);let _0x464720=new Date(_0x1f7275['expiry_date']),_0x42a42a=('0'+_0x464720[_0x3d2560(0x109)]())[_0x3d2560(0x15d)](-0x2),_0x19b8a1=('0'+(_0x464720[_0x3d2560(0xf0)]()+0x1))[_0x3d2560(0x15d)](-0x2),_0x273456=_0x464720[_0x3d2560(0xec)](),_0x4babf2=_0x273456+'-'+_0x19b8a1+'-'+_0x42a42a;if(_0x5a24aa[0x0][_0x3d2560(0x19a)]==_0x3d2560(0x19e)){var _0x5de092=users[_0x3d2560(0x1f0)];console[_0x3d2560(0x126)](_0x5de092);}else{if(_0x5a24aa[0x0]['language']=='Hindi')var _0x5de092=users['Hindi'];else{if(_0x5a24aa[0x0][_0x3d2560(0x19a)]=='German')var _0x5de092=users['German'];else{if(_0x5a24aa[0x0]['language']==_0x3d2560(0xe6))var _0x5de092=users[_0x3d2560(0xe6)];else{if(_0x5a24aa[0x0]['language']==_0x3d2560(0x160))var _0x5de092=users['French'];else{if(_0x5a24aa[0x0]['language']=='Portuguese\x20(BR)')var _0x5de092=users[_0x3d2560(0x150)];else{if(_0x5a24aa[0x0][_0x3d2560(0x19a)]==_0x3d2560(0x184))var _0x5de092=users[_0x3d2560(0x184)];else{if(_0x5a24aa[0x0][_0x3d2560(0x19a)]==_0x3d2560(0x107))var _0x5de092=users[_0x3d2560(0x12c)];}}}}}}}_0x296956[_0x3d2560(0x1b6)](_0x3d2560(0x1fc),{'success':_0x42b0aa['flash'](_0x3d2560(0x102)),'errors':_0x42b0aa['flash'](_0x3d2560(0x170)),'role':_0x1298c0,'profile':_0x42817a,'purchases':_0x1f7275,'suppliers':_0x3d05ed,'warehouse':_0x24f004,'product':_0x5a55d2,'master_shop':_0x5a24aa,'language':_0x5de092,'ed_fullDate':_0x4babf2,'dataSelected':_0xcdc9b5});}catch(_0x224d32){console['log'](_0x224d32);}}),router[a0_0x3a3de0(0x19c)]('/view/:id',auth,async(_0x28404e,_0x2d0aed)=>{var _0x4994e6=a0_0x3a3de0;try{const _0x155c75=_0x28404e[_0x4994e6(0x133)]['id'],_0x17e5e6=await purchases_finished[_0x4994e6(0x195)]({'_id':_0x28404e['params']['id']}),_0x57b5a9=await warehouse[_0x4994e6(0x195)]({'name':_0x17e5e6[_0x4994e6(0x207)],'room':_0x17e5e6[_0x4994e6(0x1d9)]});_0x17e5e6[_0x4994e6(0x125)][_0x4994e6(0x1e0)](_0x2203d2=>{var _0x3100b6=_0x4994e6;const _0x529954=_0x57b5a9[_0x3100b6(0x220)][_0x3100b6(0x193)](_0x4b0879=>{var _0x2d3db0=_0x3100b6;_0x4b0879[_0x2d3db0(0x1b9)]==_0x2203d2['product_name']&&_0x4b0879[_0x2d3db0(0xf4)]==_0x2203d2[_0x2d3db0(0xf4)]&&(_0x4b0879[_0x2d3db0(0x116)]=parseInt(_0x4b0879[_0x2d3db0(0x116)])-parseInt(_0x2203d2['quantity']));});}),await _0x57b5a9['save']();const {invoice:_0x5910fc,suppliers:_0x3efcd8,date:_0x4d7aa5,warehouse_name:_0x56f904,prod_name:_0x5baca0,prod_code:_0x4f0c6e,prod_qty:_0x532910,prod_unit:_0x527a49,prod_secondunit:_0x2e408d,prod_level:_0x3d388d,prod_isle:_0x31f8dd,prod_pallet:_0x5e54ee,note:_0x438c73,expiry_date:_0x1ef70e,batch_code:_0xa67e67,paid_amount:_0x259961,due_amount:_0x329410,Room_name:_0x5a032b,primary_code:_0x2a6b4f,secondary_code:_0x2d1ccc,PO_number:_0xb91da8,JO_number:_0x3fe813}=_0x28404e[_0x4994e6(0x1af)];if(typeof _0x5baca0==_0x4994e6(0x1a2))var _0x235d18=[_0x28404e['body'][_0x4994e6(0x15c)]],_0x474660=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x14d)]],_0x2b4d76=[_0x28404e['body']['prod_qty']],_0x4b3e6b=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1d5)]],_0x55988a=[_0x28404e[_0x4994e6(0x1af)]['prod_secondunit']],_0x4aeb68=[_0x28404e[_0x4994e6(0x1af)]['prod_level']],_0x3bbd91=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1a6)]],_0x21eaea=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0xe3)]],_0x3e7101=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1b8)]],_0x190808=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0xf8)]],_0x3fcb5d=[_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x11d)]];else var _0x235d18=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x15c)]],_0x474660=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x14d)]],_0x2b4d76=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0xf3)]],_0x4b3e6b=[..._0x28404e['body'][_0x4994e6(0x1d5)]],_0x55988a=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0xf5)]],_0x4aeb68=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1bd)]],_0x3bbd91=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1a6)]],_0x21eaea=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0xe3)]],_0x3e7101=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1b8)]],_0x190808=[..._0x28404e[_0x4994e6(0x1af)]['batch_code']],_0x3fcb5d=[..._0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x11d)]];const _0x257f87=_0x235d18[_0x4994e6(0x193)](_0x356af3=>{return _0x356af3={'product_name':_0x356af3};});_0x474660[_0x4994e6(0x1e0)]((_0x45b61d,_0x4755d0)=>{var _0x45ad4a=_0x4994e6;_0x257f87[_0x4755d0][_0x45ad4a(0x14c)]=_0x45b61d;}),_0x2b4d76[_0x4994e6(0x1e0)]((_0x432ded,_0x1f28b2)=>{var _0x1d4de2=_0x4994e6;_0x257f87[_0x1f28b2][_0x1d4de2(0x216)]=_0x432ded;}),_0x4b3e6b[_0x4994e6(0x1e0)]((_0x500761,_0x4baba6)=>{var _0x4e7805=_0x4994e6;_0x257f87[_0x4baba6][_0x4e7805(0x21a)]=_0x500761;}),_0x55988a['forEach']((_0x4d2347,_0x396e5b)=>{var _0x527c61=_0x4994e6;_0x257f87[_0x396e5b][_0x527c61(0x183)]=_0x4d2347;}),_0x4aeb68[_0x4994e6(0x1e0)]((_0x3dac63,_0x37fcd0)=>{var _0x58900c=_0x4994e6;_0x257f87[_0x37fcd0][_0x58900c(0xf4)]=_0x3dac63;}),_0x3bbd91[_0x4994e6(0x1e0)]((_0x3b863c,_0x540df5)=>{var _0x49763a=_0x4994e6;_0x257f87[_0x540df5][_0x49763a(0x1a6)]=_0x3b863c;}),_0x21eaea[_0x4994e6(0x1e0)]((_0x36b509,_0x3c3307)=>{var _0x367ba6=_0x4994e6;_0x257f87[_0x3c3307][_0x367ba6(0xe3)]=_0x36b509;}),_0x3e7101['forEach']((_0x105d78,_0x4a57a8)=>{_0x257f87[_0x4a57a8]['maxStocks']=_0x105d78;}),_0x190808[_0x4994e6(0x1e0)]((_0x253082,_0xb78fd9)=>{_0x257f87[_0xb78fd9]['batch_code']=_0x253082;}),_0x3fcb5d[_0x4994e6(0x1e0)]((_0xf56dee,_0x3e937c)=>{var _0x579fff=_0x4994e6;_0x257f87[_0x3e937c][_0x579fff(0x11d)]=_0xf56dee;});const _0x503764=_0x257f87[_0x4994e6(0x12f)](_0x1f1ad0=>_0x1f1ad0[_0x4994e6(0x216)]!=='0'&&_0x1f1ad0[_0x4994e6(0x216)]!=='');_0x17e5e6[_0x4994e6(0x1ac)]=_0x5910fc,_0x17e5e6[_0x4994e6(0x1c6)]=_0x3efcd8,_0x17e5e6[_0x4994e6(0x137)]=_0x4d7aa5,_0x17e5e6[_0x4994e6(0x207)]=_0x56f904,_0x17e5e6[_0x4994e6(0x125)]=_0x503764,_0x17e5e6[_0x4994e6(0x199)]=_0x438c73,_0x17e5e6['paid_amount']=_0x259961,_0x17e5e6[_0x4994e6(0x1df)]=_0x329410,_0x17e5e6[_0x4994e6(0x1d9)]=_0x5a032b,_0x17e5e6[_0x4994e6(0x12a)]=_0xb91da8,_0x17e5e6[_0x4994e6(0x215)]=_0x3fe813;const _0x572cee=await _0x17e5e6['save'](),_0x140deb=await warehouse[_0x4994e6(0x195)]({'name':_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x207)],'room':_0x28404e[_0x4994e6(0x1af)]['Room_name']});_0x17e5e6['product'][_0x4994e6(0x1e0)](_0x5349af=>{var _0xcfe3ec=_0x4994e6,_0x3f5098=0x0;const _0x887037=_0x140deb[_0xcfe3ec(0x220)][_0xcfe3ec(0x193)](_0x2e65ea=>{var _0x483a8c=_0xcfe3ec;_0x2e65ea[_0x483a8c(0x1b9)]==_0x5349af[_0x483a8c(0x1b9)]&&_0x2e65ea[_0x483a8c(0xf4)]==_0x5349af['bay']&&(_0x2e65ea['product_stock']=parseInt(_0x2e65ea[_0x483a8c(0x116)])+parseInt(_0x5349af[_0x483a8c(0x216)]),_0x3f5098++);});_0x3f5098=='0'&&(_0x140deb[_0xcfe3ec(0x220)]=_0x140deb[_0xcfe3ec(0x220)][_0xcfe3ec(0x106)]({'product_name':_0x5349af[_0xcfe3ec(0x1b9)],'product_stock':_0x5349af['quantity'],'primary_code':_0x5349af[_0xcfe3ec(0x1a6)],'secondary_code':_0x5349af[_0xcfe3ec(0xe3)],'product_code':_0x5349af['product_code'],'bay':_0x5349af['bay'],'maxProducts':_0x5349af[_0xcfe3ec(0x138)],'unit':_0x5349af[_0xcfe3ec(0x21a)],'secondary_unit':_0x5349af[_0xcfe3ec(0x183)],'expiry_date':_0x5349af[_0xcfe3ec(0x11d)]}));}),await _0x140deb['save']();const _0x289441=await s_payment_data['findOne']({'invoice':_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1ac)]});if(_0x289441===null){}else console['log']('suppliers',_0x289441,_0x28404e[_0x4994e6(0x1af)][_0x4994e6(0x1ac)]),_0x289441[_0x4994e6(0x1c6)]=_0x28404e['body'][_0x4994e6(0x1c6)],await _0x289441[_0x4994e6(0x10b)]();_0x28404e['flash'](_0x4994e6(0x102),'purchase\x20data\x20update\x20successfully'),_0x2d0aed[_0x4994e6(0xed)](_0x4994e6(0xf7));}catch(_0x514855){console[_0x4994e6(0x126)](_0x514855);}}),router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0x203),auth,async(_0x28ad93,_0x419fd1)=>{var _0x3efe64=a0_0x3a3de0;try{const _0x53a84d=_0x28ad93['params']['id'],{invoice:_0x3a91e4,suppliers:_0x18770c,payable:_0x569fc8,due_amount:_0x14b92d}=_0x28ad93['body'],_0x291c37=await purchases[_0x3efe64(0x117)](_0x53a84d);var _0x470461=_0x569fc8-_0x14b92d;_0x291c37[_0x3efe64(0x1cd)]=parseFloat(_0x291c37[_0x3efe64(0x1cd)])+parseFloat(_0x14b92d),_0x291c37[_0x3efe64(0x1df)]=_0x470461;const _0x90e686=await _0x291c37['save']();console[_0x3efe64(0x126)](_0x90e686);const _0x112757=await s_payment_data[_0x3efe64(0x195)]({'invoice':_0x3a91e4});_0x112757['amount']=_0x470461,await _0x112757['save']();let _0x399b64=new Date(),_0x1e52e2=('0'+_0x399b64['getDate']())[_0x3efe64(0x15d)](-0x2),_0x4d24d3=('0'+(_0x399b64[_0x3efe64(0xf0)]()+0x1))['slice'](-0x2),_0xa49f01=_0x399b64[_0x3efe64(0xec)](),_0x517938=_0xa49f01+'-'+_0x4d24d3+'-'+_0x1e52e2;const _0x43a8a2=new suppliers_payment({'invoice':_0x3a91e4,'date':_0xa49f01+'-'+_0x4d24d3+'-'+_0x1e52e2,'suppliers':_0x18770c,'reason':_0x3efe64(0x1f1),'amount':_0x14b92d}),_0x44ac44=await _0x43a8a2[_0x3efe64(0x10b)]();_0x28ad93[_0x3efe64(0x1be)]('success',_0x3efe64(0x18f)),_0x419fd1['redirect'](_0x3efe64(0xdf));}catch(_0x4e690d){console[_0x3efe64(0x126)](_0x4e690d);}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0x175),auth,async(_0x3deff3,_0x12d529)=>{var _0x2d783c=a0_0x3a3de0;try{const {username:_0x4f97d4,email:_0x29405e,role:_0x160fb5}=_0x3deff3[_0x2d783c(0x11c)],_0x460b8e=_0x3deff3[_0x2d783c(0x11c)],_0x69237=await profile[_0x2d783c(0x195)]({'email':_0x460b8e[_0x2d783c(0x108)]}),_0x5da24b=await master_shop[_0x2d783c(0x1a3)]();console['log'](_0x2d783c(0x1aa),_0x5da24b);const _0x55a221=_0x3deff3[_0x2d783c(0x133)]['id'],_0x103bb9=await purchases['findById'](_0x55a221);console[_0x2d783c(0x126)](_0x103bb9);const _0x440009=await suppliers[_0x2d783c(0x195)]({'name':_0x103bb9['suppliers']});console['log'](_0x440009);if(_0x5da24b[0x0][_0x2d783c(0x19a)]==_0x2d783c(0x19e)){var _0x24d19b=users[_0x2d783c(0x1f0)];console[_0x2d783c(0x126)](_0x24d19b);}else{if(_0x5da24b[0x0][_0x2d783c(0x19a)]==_0x2d783c(0x194))var _0x24d19b=users[_0x2d783c(0x194)];else{if(_0x5da24b[0x0][_0x2d783c(0x19a)]=='German')var _0x24d19b=users[_0x2d783c(0x205)];else{if(_0x5da24b[0x0]['language']=='Spanish')var _0x24d19b=users['Spanish'];else{if(_0x5da24b[0x0][_0x2d783c(0x19a)]=='French')var _0x24d19b=users[_0x2d783c(0x160)];else{if(_0x5da24b[0x0][_0x2d783c(0x19a)]==_0x2d783c(0x162))var _0x24d19b=users[_0x2d783c(0x150)];else{if(_0x5da24b[0x0][_0x2d783c(0x19a)]==_0x2d783c(0x184))var _0x24d19b=users[_0x2d783c(0x184)];else{if(_0x5da24b[0x0][_0x2d783c(0x19a)]==_0x2d783c(0x107))var _0x24d19b=users[_0x2d783c(0x12c)];}}}}}}}_0x12d529[_0x2d783c(0x1b6)](_0x2d783c(0x17e),{'success':_0x3deff3[_0x2d783c(0x1be)](_0x2d783c(0x102)),'errors':_0x3deff3['flash']('errors'),'role':_0x460b8e,'profile':_0x69237,'master_shop':_0x5da24b,'supplier':_0x440009,'purchase':_0x103bb9,'language':_0x24d19b});}catch(_0x381fa4){console[_0x2d783c(0x126)](_0x381fa4);}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0x115),auth,async(_0x3fbc99,_0x641753)=>{var _0x4143e3=a0_0x3a3de0;try{const {username:_0x486e05,email:_0x3c3690,role:_0x565f4d}=_0x3fbc99[_0x4143e3(0x11c)],_0x25d7eb=_0x3fbc99[_0x4143e3(0x11c)],_0x3c852e=await profile['findOne']({'email':_0x25d7eb['email']}),_0x3f1f5f=await master_shop['find']();console[_0x4143e3(0x126)](_0x4143e3(0x1aa),_0x3f1f5f);const _0x34e123=_0x3fbc99[_0x4143e3(0x133)]['id'];console[_0x4143e3(0x126)](_0x34e123);const _0x553184=await purchases_finished[_0x4143e3(0x117)](_0x34e123);console[_0x4143e3(0x126)](_0x4143e3(0x204),_0x553184);const _0x22a343=await product[_0x4143e3(0x1a3)]({}),_0x234597=await warehouse['aggregate']([{'$match':{'name':_0x553184[_0x4143e3(0x207)],'room':_0x553184['room']}},{'$unwind':_0x4143e3(0x1e8)},{'$group':{'_id':_0x4143e3(0x166),'name':{'$first':_0x4143e3(0x15b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4143e3(0x103)},'bin':{'$first':_0x4143e3(0x20e)},'type':{'$first':_0x4143e3(0x20f)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4143e3(0x1ef)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4143e3(0x1bf)},'rack':{'$first':_0x4143e3(0x219)}}}]);console[_0x4143e3(0x126)](_0x4143e3(0x111),_0x234597);let _0x28b5e3;if(_0x25d7eb['role']==_0x4143e3(0x17c)){const _0x35c2b9=await staff[_0x4143e3(0x195)]({'email':_0x25d7eb[_0x4143e3(0x108)]});_0x28b5e3=await warehouse[_0x4143e3(0x1a3)]({'status':_0x4143e3(0x202),'name':_0x35c2b9[_0x4143e3(0x189)],'warehouse_category':_0x4143e3(0x1f8),'name':_0x4143e3(0x201)});}else _0x28b5e3=await warehouse[_0x4143e3(0x1a9)]([{'$match':{'status':_0x4143e3(0x202),'warehouse_category':_0x4143e3(0x1f8),'name':_0x4143e3(0x201)}},{'$group':{'_id':_0x4143e3(0x1fb),'name':{'$first':_0x4143e3(0x1fb)}}}]);if(_0x3f1f5f[0x0]['language']==_0x4143e3(0x19e)){var _0x30e793=users['English'];console[_0x4143e3(0x126)](_0x30e793);}else{if(_0x3f1f5f[0x0]['language']==_0x4143e3(0x194))var _0x30e793=users[_0x4143e3(0x194)];else{if(_0x3f1f5f[0x0]['language']=='German')var _0x30e793=users['German'];else{if(_0x3f1f5f[0x0][_0x4143e3(0x19a)]==_0x4143e3(0xe6))var _0x30e793=users['Spanish'];else{if(_0x3f1f5f[0x0]['language']==_0x4143e3(0x160))var _0x30e793=users[_0x4143e3(0x160)];else{if(_0x3f1f5f[0x0][_0x4143e3(0x19a)]=='Portuguese\x20(BR)')var _0x30e793=users['Portuguese'];else{if(_0x3f1f5f[0x0][_0x4143e3(0x19a)]==_0x4143e3(0x184))var _0x30e793=users[_0x4143e3(0x184)];else{if(_0x3f1f5f[0x0][_0x4143e3(0x19a)]=='Arabic\x20(ae)')var _0x30e793=users[_0x4143e3(0x12c)];}}}}}}}_0x641753[_0x4143e3(0x1b6)]('return_purchase_finished',{'success':_0x3fbc99[_0x4143e3(0x1be)](_0x4143e3(0x102)),'errors':_0x3fbc99['flash']('errors'),'role':_0x25d7eb,'profile':_0x3c852e,'user':_0x553184,'stock':_0x234597,'master_shop':_0x3f1f5f,'product':_0x22a343,'language':_0x30e793,'warehouse':_0x28b5e3});}catch(_0x5d81be){console['log'](_0x5d81be);}}),router['post'](a0_0x3a3de0(0x115),auth,async(_0x305270,_0x106aa8)=>{var _0x1ec1db=a0_0x3a3de0;try{const {invoice:_0x502bb2,date:_0x348a8b,warehouse_name:_0x128af8,Room_name:_0xdceb5b,product_name:_0x5cfd36,purchase_quantity:_0xa62b78,stocks:_0x2d64f8,return_qty:_0x505ff9,note:_0x354bf6,level:_0x150982,isle:_0x29d49e,pallet:_0x4433c1,to_warehouse_name:_0x4cce8e,to_Room_name:_0x2e714f}=_0x305270[_0x1ec1db(0x1af)],_0x329aaa=await purchases_finished['findOne']({'_id':_0x305270[_0x1ec1db(0x133)]['id']}),_0x5cac7a=await warehouse[_0x1ec1db(0x195)]({'name':_0x128af8,'room':_0xdceb5b,'warehouse_category':_0x1ec1db(0x1f8)});if(typeof _0x5cfd36=='string')var _0x3585ba=[_0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x1b9)]],_0x159ada=[_0x305270['body'][_0x1ec1db(0xfe)]],_0xad31aa=[_0x305270['body']['stocks']],_0x351e0e=[_0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x1dc)]],_0xe4d23b=[_0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x212)]],_0x429cde=[_0x305270[_0x1ec1db(0x1af)]['product_code_hide']],_0x25677d=[_0x305270[_0x1ec1db(0x1af)]['primary_code_hide']],_0x455989=[_0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x10a)]];else var _0x3585ba=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x1b9)]],_0x159ada=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0xfe)]],_0xad31aa=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x17b)]],_0x351e0e=[..._0x305270['body'][_0x1ec1db(0x1dc)]],_0xe4d23b=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x212)]],_0x429cde=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x1d2)]],_0x25677d=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x130)]],_0x455989=[..._0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x10a)]];const _0x3e6b81=_0x3585ba['map'](_0x16c762=>{return _0x16c762={'product_name':_0x16c762};});_0x159ada[_0x1ec1db(0x1e0)]((_0x4e0ffb,_0x3a3414)=>{var _0x5b5f31=_0x1ec1db;_0x3e6b81[_0x3a3414][_0x5b5f31(0xfe)]=_0x4e0ffb;}),_0xad31aa[_0x1ec1db(0x1e0)]((_0x5573c3,_0xab2cbd)=>{var _0xf1df44=_0x1ec1db;_0x3e6b81[_0xab2cbd][_0xf1df44(0x140)]=_0x5573c3;}),_0x351e0e[_0x1ec1db(0x1e0)]((_0x54a4a9,_0x14fbdf)=>{var _0x255f6c=_0x1ec1db;_0x3e6b81[_0x14fbdf][_0x255f6c(0x1dc)]=_0x54a4a9;}),_0xe4d23b[_0x1ec1db(0x1e0)]((_0x355dd9,_0x59b0d4)=>{_0x3e6b81[_0x59b0d4]['bay']=_0x355dd9;}),_0x429cde[_0x1ec1db(0x1e0)]((_0x3ce6ef,_0x29837a)=>{_0x3e6b81[_0x29837a]['product_code']=_0x3ce6ef;}),_0x25677d[_0x1ec1db(0x1e0)]((_0xd8fa58,_0x1a062b)=>{var _0x1a4113=_0x1ec1db;_0x3e6b81[_0x1a062b][_0x1a4113(0x1a6)]=_0xd8fa58;}),_0x455989[_0x1ec1db(0x1e0)]((_0x47bcfd,_0xead950)=>{var _0x2ce0a9=_0x1ec1db;_0x3e6b81[_0xead950][_0x2ce0a9(0xe3)]=_0x47bcfd;}),_0x3e6b81[_0x1ec1db(0x1e0)](_0x45b052=>{var _0x41ac78=_0x1ec1db;console[_0x41ac78(0x126)](_0x45b052);const _0x3930f4=_0x5cac7a[_0x41ac78(0x220)][_0x41ac78(0x193)](_0x5ba666=>{var _0x2fb579=_0x41ac78;_0x5ba666['product_name']==_0x45b052[_0x2fb579(0x1b9)]&&_0x5ba666[_0x2fb579(0xf4)]==_0x45b052[_0x2fb579(0xf4)]&&(console[_0x2fb579(0x126)](parseInt(_0x5ba666['product_stock'])+'\x20<>\x20'+parseInt(_0x45b052[_0x2fb579(0x1dc)])),_0x5ba666['product_stock']=parseInt(_0x5ba666[_0x2fb579(0x116)])-parseInt(_0x45b052[_0x2fb579(0x1dc)]));});}),await _0x5cac7a[_0x1ec1db(0x10b)]();var _0x58468e=0x0;_0x3e6b81[_0x1ec1db(0x1e0)](_0x1a36ea=>{var _0x271940=_0x1ec1db;(parseInt(_0x1a36ea[_0x271940(0xfe)])<parseInt(_0x1a36ea[_0x271940(0x1dc)])||parseInt(_0x1a36ea['stock_quantity'])<parseInt(_0x1a36ea[_0x271940(0x1dc)]))&&_0x58468e++;});if(_0x58468e!=0x0)return _0x305270['flash'](_0x1ec1db(0x170),_0x1ec1db(0x214)),_0x106aa8[_0x1ec1db(0xed)](_0x1ec1db(0x16f));const _0x317db4=new purchases_return_finished({'invoice':_0x502bb2,'suppliers':_0x305270[_0x1ec1db(0x1af)][_0x1ec1db(0x1c6)],'date':_0x348a8b,'warehouse_name':_0x128af8,'return_product':_0x3e6b81,'note':_0x354bf6,'room':_0xdceb5b,'to_warehouse_name':_0x4cce8e,'to_room':_0x2e714f}),_0x25b3ec=await _0x317db4['save'](),_0x5ac35a=await purchases_return_finished[_0x1ec1db(0x195)]({'invoice':_0x502bb2}),_0x496561=await warehouse[_0x1ec1db(0x195)]({'name':_0x4cce8e,'room':_0x2e714f,'warehouse_category':_0x1ec1db(0x1f8)});_0x5ac35a[_0x1ec1db(0x123)]['forEach'](_0x331ea4=>{var _0x4e9bd7=_0x1ec1db,_0x1ceebf=0x0;const _0x3da10d=_0x496561[_0x4e9bd7(0x220)][_0x4e9bd7(0x193)](_0x144a34=>{var _0x103b01=_0x4e9bd7;console[_0x103b01(0x126)](_0x144a34[_0x103b01(0x1b9)]+'=='+_0x331ea4[_0x103b01(0x1b9)]+'&&'+_0x144a34[_0x103b01(0xf4)]+'=='+_0x331ea4[_0x103b01(0xf4)]),_0x144a34[_0x103b01(0x1b9)]==_0x331ea4[_0x103b01(0x1b9)]&&_0x144a34['bay']==_0x331ea4[_0x103b01(0xf4)]&&(_0x144a34[_0x103b01(0x116)]=parseInt(_0x144a34[_0x103b01(0x116)])-parseInt(_0x331ea4[_0x103b01(0x1dc)]),_0x1ceebf++);});_0x1ceebf=='0'&&(_0x496561[_0x4e9bd7(0x220)]=_0x496561[_0x4e9bd7(0x220)]['concat']({'product_name':_0x331ea4[_0x4e9bd7(0x1b9)],'product_stock':_0x331ea4[_0x4e9bd7(0x1dc)],'primary_code':_0x331ea4[_0x4e9bd7(0x1a6)],'secondary_code':_0x331ea4[_0x4e9bd7(0xe3)],'product_code':_0x331ea4[_0x4e9bd7(0x14c)],'bay':_0x331ea4['bay'],'maxProducts':0xf423f}));}),await _0x496561[_0x1ec1db(0x10b)]();const _0x55b69f=await purchases_finished['findOne']({'invoice':_0x502bb2});_0x55b69f['return_data']=_0x1ec1db(0xff);const _0x42b975=await _0x55b69f[_0x1ec1db(0x10b)](),_0x3ba467=new s_payment_data({'invoice':_0x502bb2,'suppliers':_0x305270[_0x1ec1db(0x1af)]['suppliers'],'reason':_0x1ec1db(0x217)});await _0x3ba467[_0x1ec1db(0x10b)]();const _0x12b50e=await master_shop[_0x1ec1db(0x1a3)](),_0x46489f=await email_settings[_0x1ec1db(0x195)](),_0x455711=await suppliers['findOne']({'name':_0x305270[_0x1ec1db(0x1af)]['suppliers']});_0x12b50e[0x0][_0x1ec1db(0xf6)]==0x1?(right_currency=_0x12b50e[0x0][_0x1ec1db(0x186)],left_currency=''):(right_currency='',left_currency=_0x12b50e[0x0]['currency']);var _0x1cd026=_0x3585ba,_0x3efe97=_0x351e0e,_0x2423d1='',_0x1d157a;for(_0x1d157a in _0x1cd026){_0x2423d1+=_0x1ec1db(0x18a)+_0x1ec1db(0x101)+_0x1cd026[_0x1d157a]+_0x1ec1db(0x161)+_0x1ec1db(0x101)+_0x3efe97[_0x1d157a]+_0x1ec1db(0x161)+_0x1ec1db(0x154);}let _0x5b2e47=nodemailer[_0x1ec1db(0xfa)]({'service':'gmail','auth':{'user':_0x46489f[_0x1ec1db(0x108)],'pass':_0x46489f[_0x1ec1db(0xe5)]}}),_0x312075={'from':_0x46489f['email'],'to':_0x455711[_0x1ec1db(0x108)],'subject':_0x1ec1db(0x1a8),'attachments':[{'filename':_0x1ec1db(0x14f),'path':__dirname+_0x1ec1db(0x16a)+_0x1ec1db(0x21f)+_0x12b50e[0x0][_0x1ec1db(0x1bc)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x1ec1db(0x13f)+_0x1ec1db(0x1ed)+'<div>'+_0x1ec1db(0x14e)+_0x1ec1db(0x21c)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1ec1db(0x128)+_0x1ec1db(0x21c)+_0x1ec1db(0x105)+_0x12b50e[0x0][_0x1ec1db(0x20b)]+_0x1ec1db(0x122)+'</div>'+_0x1ec1db(0x128)+_0x1ec1db(0x1d7)+_0x1ec1db(0x21c)+_0x1ec1db(0x151)+_0x1ec1db(0x13c)+_0x502bb2+'\x20'+_0x1ec1db(0x156)+_0x1ec1db(0x1b4)+_0x348a8b+'\x20'+_0x1ec1db(0x1eb)+_0x1ec1db(0x129)+'</div>'+_0x1ec1db(0x1fe)+_0x1ec1db(0x20a)+_0x1ec1db(0x18a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1ec1db(0x1e2)+_0x1ec1db(0x1f6)+'</tr>'+_0x1ec1db(0x1f5)+_0x1ec1db(0x172)+'\x20'+_0x2423d1+'\x20'+_0x1ec1db(0x11b)+_0x1ec1db(0x1d0)+_0x1ec1db(0x21c)+_0x1ec1db(0x113)+_0x1ec1db(0x1f2)+_0x12b50e[0x0][_0x1ec1db(0x20b)]+_0x1ec1db(0x129)+_0x1ec1db(0x128)+_0x1ec1db(0x128)+_0x1ec1db(0x164)};_0x5b2e47[_0x1ec1db(0xfd)](_0x312075,function(_0x19b258,_0x38251f){var _0x4acc0a=_0x1ec1db;_0x19b258?console[_0x4acc0a(0x126)](_0x4acc0a(0x171)):console[_0x4acc0a(0x126)]('Email\x20sent\x20successfully');}),_0x305270[_0x1ec1db(0x1be)](_0x1ec1db(0x102),_0x1ec1db(0x16b)),_0x106aa8[_0x1ec1db(0xed)]('/all_purchases_finished/view');}catch(_0x3c11e3){_0x106aa8[_0x1ec1db(0x119)](0xc8)['json']({'message':_0x3c11e3[_0x1ec1db(0x1c8)]});}}),router[a0_0x3a3de0(0x177)](a0_0x3a3de0(0xde),auth,async(_0x3df5db,_0x4c27c9)=>{var _0x270325=a0_0x3a3de0;try{const {username:_0x3d3205,email:_0x4e0a4b,role:_0x3dc382}=_0x3df5db[_0x270325(0x11c)],_0x43d924=_0x3df5db[_0x270325(0x11c)],_0x102f79=await profile[_0x270325(0x195)]({'email':_0x43d924[_0x270325(0x108)]}),_0x2de25e=await master_shop[_0x270325(0x1a3)](),_0x29caa8=_0x3df5db[_0x270325(0x133)]['id'],_0x541c77=await purchases_finished[_0x270325(0x117)](_0x29caa8);if(_0x2de25e[0x0][_0x270325(0x19a)]==_0x270325(0x19e))var _0x1428a7=users[_0x270325(0x1f0)];else{if(_0x2de25e[0x0][_0x270325(0x19a)]==_0x270325(0x194))var _0x1428a7=users[_0x270325(0x194)];else{if(_0x2de25e[0x0][_0x270325(0x19a)]==_0x270325(0x205))var _0x1428a7=users[_0x270325(0x205)];else{if(_0x2de25e[0x0]['language']=='Spanish')var _0x1428a7=users[_0x270325(0xe6)];else{if(_0x2de25e[0x0][_0x270325(0x19a)]=='French')var _0x1428a7=users[_0x270325(0x160)];else{if(_0x2de25e[0x0][_0x270325(0x19a)]==_0x270325(0x162))var _0x1428a7=users[_0x270325(0x150)];else{if(_0x2de25e[0x0][_0x270325(0x19a)]==_0x270325(0x184))var _0x1428a7=users[_0x270325(0x184)];else{if(_0x2de25e[0x0][_0x270325(0x19a)]==_0x270325(0x107))var _0x1428a7=users[_0x270325(0x12c)];}}}}}}}_0x4c27c9[_0x270325(0x1b6)](_0x270325(0x1c2),{'success':_0x3df5db[_0x270325(0x1be)]('success'),'errors':_0x3df5db[_0x270325(0x1be)](_0x270325(0x170)),'role':_0x43d924,'profile':_0x102f79,'alldata':_0x541c77,'master_shop':_0x2de25e,'language':_0x1428a7}),console[_0x270325(0x126)](alldata);}catch(_0x4e9cd7){console['log'](_0x4e9cd7);}}),router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0x1d4),async(_0x448761,_0x4f7f58)=>{var _0x35a042=a0_0x3a3de0;const {product_code:_0x1d444f}=_0x448761[_0x35a042(0x1af)];var _0x1546f8;const _0x3b1cc5=await product[_0x35a042(0x1a9)]([{'$match':{'primary_code':_0x1d444f}},{'$group':{'_id':_0x35a042(0xe9),'name':{'$first':'$name'},'category':{'$first':_0x35a042(0x16c)},'brand':{'$first':_0x35a042(0x1e7)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x35a042(0x10d)},'secondary_code':{'$first':_0x35a042(0x144)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x35a042(0x173)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x35a042(0x143)},'sales_category':{'$first':_0x35a042(0x213)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x587521=await product['aggregate']([{'$match':{'secondary_code':_0x1d444f}},{'$group':{'_id':'$_id','name':{'$first':_0x35a042(0x1fb)},'category':{'$first':_0x35a042(0x16c)},'brand':{'$first':'$brand'},'unit':{'$first':_0x35a042(0x148)},'alertquantity':{'$first':_0x35a042(0x10c)},'product_code':{'$first':_0x35a042(0x211)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x35a042(0x144)},'maxStocks':{'$first':_0x35a042(0x218)},'maxProdPerUnit':{'$first':_0x35a042(0x173)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x3b1cc5[_0x35a042(0x1cf)]>0x0)_0x1546f8=_0x3b1cc5;else _0x587521['length']>0x0&&(_0x1546f8=_0x587521);_0x4f7f58[_0x35a042(0x1c9)](_0x1546f8);}),router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0x1f7),async(_0x354633,_0x91904d)=>{var _0x54a442=a0_0x3a3de0;const {productCode:_0x32f5ec,bay:_0x2465b1,warehouses:_0x5868bc,room:_0x36412c}=_0x354633['body'];console[_0x54a442(0x126)](_0x354633[_0x54a442(0x1af)]);try{const _0x5c633d=await warehouse['aggregate']([{'$match':{'name':_0x5868bc,'room':_0x36412c}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x2465b1)}},{'$group':{'_id':_0x54a442(0x166),'name':{'$first':_0x54a442(0x15b)},'product_stock':{'$first':_0x54a442(0x198)},'bay':{'$first':_0x54a442(0x103)},'maxProducts':{'$first':_0x54a442(0x14b)}}}]);_0x91904d[_0x54a442(0x119)](0xc8)[_0x54a442(0x1c9)](_0x5c633d);}catch(_0x1779f8){_0x91904d[_0x54a442(0x119)](0x194)[_0x54a442(0x1c9)]({'message':_0x1779f8[_0x54a442(0x1c8)]});}}),router[a0_0x3a3de0(0x19c)](a0_0x3a3de0(0xdb),async(_0x26c748,_0x23d7b6)=>{var _0x2fa08d=a0_0x3a3de0;const {product_code:_0x37f835}=_0x26c748[_0x2fa08d(0x1af)];var _0x4896e8;const _0x103eff=await product[_0x2fa08d(0x1a9)]([{'$match':{'primary_code':_0x37f835,'type_products':'log'}},{'$group':{'_id':_0x2fa08d(0xe9),'name':{'$first':_0x2fa08d(0x1fb)},'category':{'$first':_0x2fa08d(0x16c)},'brand':{'$first':_0x2fa08d(0x1e7)},'unit':{'$first':_0x2fa08d(0x148)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2fa08d(0x211)},'primary_code':{'$first':_0x2fa08d(0x10d)},'secondary_code':{'$first':_0x2fa08d(0x144)},'maxStocks':{'$first':_0x2fa08d(0x218)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2fa08d(0x1bb)},'gross_price':{'$first':_0x2fa08d(0x143)},'sales_category':{'$first':_0x2fa08d(0x213)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x2fa08d(0x126)](_0x103eff);const _0x4c0307=await product[_0x2fa08d(0x1a9)]([{'$match':{'secondary_code':_0x37f835,'type_products':_0x2fa08d(0x126)}},{'$group':{'_id':_0x2fa08d(0xe9),'name':{'$first':_0x2fa08d(0x1fb)},'category':{'$first':_0x2fa08d(0x16c)},'brand':{'$first':_0x2fa08d(0x1e7)},'unit':{'$first':_0x2fa08d(0x148)},'alertquantity':{'$first':_0x2fa08d(0x10c)},'product_code':{'$first':_0x2fa08d(0x211)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2fa08d(0x144)},'maxStocks':{'$first':_0x2fa08d(0x218)},'maxProdPerUnit':{'$first':_0x2fa08d(0x173)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x2fa08d(0x143)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x2fa08d(0x124)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x103eff[_0x2fa08d(0x1cf)]>0x0)_0x4896e8=_0x103eff;else _0x4c0307[_0x2fa08d(0x1cf)]>0x0&&(_0x4896e8=_0x4c0307);_0x23d7b6[_0x2fa08d(0x1c9)](_0x4896e8);}),module[a0_0x3a3de0(0x17f)]=router;