var a0_0x487e73=a0_0x1fc9;function a0_0x373a(){var _0x34927b=['warehouse','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','../public/language/languages.json','Portuguese\x20(BR)','logo','save','20620719MidbBW','$product_details.primary_code','FGSEmail','English','/all_purchases_finished/view','$date','/invoice/:id','table\x20page','German','FROZEN\x20GOODS','error','success','/view/return_purchase/:id','uuid','$gross_price','$invoice','$maxProdPerUnit','sendMail','$product_details._id','catch','$product_details.type','/all_purchases/view','true','paid_amount','purchase\x20data\x20add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','to_warehouse','$type_products','$_id','maxPerUnit','Rack\x201','\x20<>\x20','sales_category','/view_log','site_title','/upload/','language','$secondary_code','There\x20is\x20','\x20<=>\x20','prod_Qty','batch_code','$suppliers','<tr>','$warehouse_name','nodemailer','/CheckingWarehouse',',\x20room:\x20','POnumber','Asia/Manila','$secondary_unit','../models/all_models','getFullYear','room_name','1412648mvGfCc','</span>','$maxStocks','room','Paid\x20For\x20Purchase','\x20inc\x20=\x20','5787112HJbJnV','length','purchases\x20item\x20return\x20successfull','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/barcode/:id','getMonth','maxProducts','4NGkIsp',',\x20bin:\x20','add_purchases\x20error','/give_payment/:id','1432524JvsNkd','<span\x20style=\x22float:\x20right;\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_primunit','express','util','bay','get','random','exports','===','INCF-','6257090ahyXAL','/../public','Arabic','isProcess','note','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','7vCDPWJ','prod_level','/view/add_purchases/:id','True','data_type','995496lhIIiM','valueOf','level','$product.floorlevel','primary_code','DRY\x20GOODS','$product.bay','maxStocks','/all_purchases_finished/process/','INC-','$product_code','name','currency_placement','errors','STAGING','$sales_category','stock_quantity','Purchase\x20Mail','secondary_code','Error\x20Occurs','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','English\x20(US)','$product','suppliers','purchases_id','return_data','prod_unit','</div>','/view','LOG-INC-','1940478FfEEnM','date','undefined','max_product_unit','Transfer\x20Finalize\x20Successfully','item_code','getDate','body','Portuguese','INC','An\x20error\x20occurred\x20while\x20saving\x20data.','purchase_quantity','stocks','<tbody\x20style=\x22text-align:\x20center;\x22>','secondary_unit','padStart','$product_details.secondary_code','type_of_products_type','log','<!DOCTYPE\x20html>','$name','unit','filter','The\x20Other\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','warehouse_name','$product_details','max','host','</table>','</h5>','production_date','product_date','Email\x20sent\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$note','There\x27s\x20a\x20error\x20in\x20this\x20transaction','An\x20error\x20occurred.',',\x20bay:\x20','Hindi','return_product','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','slice','French','prod_cat','min','primary_code_hide','email','product_code','aggregate','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','toString','Arabic\x20(ae)','_id','json','$expiry_date','edit_purchases_finished','user_id','role','product','find','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Purchase\x20Return','product_cat','product_name','sales_data_cateory','product_id','all_purchases_finished','to_recieved','\x20</h2>','image','createTransport','<hr\x20class=\x22my-3\x22>','Purchase\x20Return\x20Mail','product_details','\x20units\x20of\x20','$alertquantity','quantity','MaxStocks_data','product_stock','stock_data','$unit','Distributing\x20','<h5\x20style=\x22text-align:\x20left;\x22>','master','RoomAssign','$paid_amount','$product.room_name','params','to_bay','$product_details.product_name','<h5>','</tbody>','concat','false','$primary_code','/view/add_purchases','Return\x20Goods','/view/:id','Enclosed','gmail','Finished\x20Goods','invoice_init','back','findOne','/view/add_purchases_logs','product_code_hide','$batch_code','render','Chinese','string','/picking_list/pdf_puchases_fin_own_trf/','../middleware/auth','match','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','redirect','here2','amount','user','<html><head><title></title>','$product_details.product_code','Spanish','$due_amount','2-digit','$category','$product.bin','/barcode_scanner','flash','STAGING\x20AREA\x201','$return_data','maxperunit','return_purchase_finished','/getinvoicetrf','updateOne','floor','</head><body>','bin','status','prod_name','expiry_date','forEach','prod_qty','then','$product_details.maxProducts','/getTRF','product_data','post','map','abs','findById','$product_details.product_stock','$product.quantity','password','standard_unit','isUsed','$brand','date_recieved','return_qty','Router','</tr>','Rack\x202','purchases_process','secondary_code_hide','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','$product.type','Logo.png','own','toLocaleDateString','prod_code','inc','$room','</td>','logs','Enabled','all_purchases_finished_logs','<div>','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','\x20Order\x20Date\x20:\x20','staff','invoice','</thead>','<strong>\x20Regards\x20</strong>','$product_details.storage','suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$suppliers_docs','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','gross_price','to_quantity','all_purchases_barcode','\x20Order\x20Number\x20:\x20','currency'];a0_0x373a=function(){return _0x34927b;};return a0_0x373a();}(function(_0x417c6b,_0x2ade45){var _0x123f70=a0_0x1fc9,_0x246143=_0x417c6b();while(!![]){try{var _0x132c1a=-parseInt(_0x123f70(0x26f))/0x1+parseInt(_0x123f70(0x2b6))/0x2+parseInt(_0x123f70(0x298))/0x3*(-parseInt(_0x123f70(0x27d))/0x4)+-parseInt(_0x123f70(0x28d))/0x5+parseInt(_0x123f70(0x281))/0x6*(-parseInt(_0x123f70(0x293))/0x7)+parseInt(_0x123f70(0x275))/0x8+parseInt(_0x123f70(0x239))/0x9;if(_0x132c1a===_0x2ade45)break;else _0x246143['push'](_0x246143['shift']());}catch(_0xfe423b){_0x246143['push'](_0x246143['shift']());}}}(a0_0x373a,0xb7257));function a0_0x1fc9(_0x170ace,_0x281e66){var _0x373a19=a0_0x373a();return a0_0x1fc9=function(_0x1fc913,_0x3eafcc){_0x1fc913=_0x1fc913-0x174;var _0x3c12cb=_0x373a19[_0x1fc913];return _0x3c12cb;},a0_0x1fc9(_0x170ace,_0x281e66);}const express=require(a0_0x487e73(0x285)),app=express(),router=express[a0_0x487e73(0x20f)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x487e73(0x26c)),auth=require(a0_0x487e73(0x1e1)),nodemailer=require(a0_0x487e73(0x266));var ejs=require('ejs');const path=require('path'),users=require(a0_0x487e73(0x235)),{isNull}=require(a0_0x487e73(0x286));router[a0_0x487e73(0x288)]('/incoming',auth,async(_0x1b01ec,_0x13a44b)=>{var _0x502549=a0_0x487e73;try{const {username:_0x45cf1f,email:_0x2aaa35,role:_0x4ec95d}=_0x1b01ec['user'],_0x58f641=_0x1b01ec['user'],_0x10c080=await profile[_0x502549(0x1d9)]({'email':_0x58f641[_0x502549(0x1a0)]}),_0x30b01c=await staff['findOne']({'email':_0x58f641[_0x502549(0x1a0)]}),_0x41b21f=await master_shop[_0x502549(0x1ad)]();let _0x48e491=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x30b01c[_0x502549(0x232)]}}]);if(_0x41b21f[0x0]['language']==_0x502549(0x2ad))var _0x366587=users['English'];else{if(_0x41b21f[0x0]['language']=='Hindi')var _0x366587=users[_0x502549(0x198)];else{if(_0x41b21f[0x0][_0x502549(0x25d)]=='German')var _0x366587=users['German'];else{if(_0x41b21f[0x0][_0x502549(0x25d)]=='Spanish')var _0x366587=users[_0x502549(0x1ea)];else{if(_0x41b21f[0x0]['language']==_0x502549(0x19c))var _0x366587=users['French'];else{if(_0x41b21f[0x0][_0x502549(0x25d)]=='Portuguese\x20(BR)')var _0x366587=users[_0x502549(0x179)];else{if(_0x41b21f[0x0][_0x502549(0x25d)]==_0x502549(0x1de))var _0x366587=users[_0x502549(0x1de)];else{if(_0x41b21f[0x0][_0x502549(0x25d)]=='Arabic\x20(ae)')var _0x366587=users[_0x502549(0x28f)];}}}}}}}_0x13a44b[_0x502549(0x1dd)]('incoming_view',{'success':_0x1b01ec['flash'](_0x502549(0x244)),'errors':_0x1b01ec[_0x502549(0x1f0)](_0x502549(0x2a5)),'purchases':_0x48e491,'role':_0x58f641,'profile':_0x10c080,'master_shop':_0x41b21f,'language':_0x366587,'staff_data':_0x30b01c});}catch(_0x22bb0f){console[_0x502549(0x183)](_0x502549(0x240),_0x22bb0f),_0x13a44b[_0x502549(0x1fa)](0xc8)[_0x502549(0x1a7)]({'message':_0x22bb0f[_0x502549(0x221)]});}}),router[a0_0x487e73(0x288)]('/incoming/add',auth,async(_0x5a276a,_0x26a0a6)=>{var _0x50fd3f=a0_0x487e73;try{const {username:_0x2d82d0,email:_0x6b3696,role:_0x1fb70e}=_0x5a276a[_0x50fd3f(0x1e7)],_0x2570f1=_0x5a276a[_0x50fd3f(0x1e7)],_0x5db121=await profile['findOne']({'email':_0x2570f1['email']}),_0x196f43=await staff[_0x50fd3f(0x1d9)]({'email':_0x2570f1[_0x50fd3f(0x1a0)]}),_0x5cdc68=await master_shop['find']();let _0x537e7e=await transfers_finished[_0x50fd3f(0x1a2)]([{'$match':{'to_warehouse':_0x196f43[_0x50fd3f(0x232)],'to_recieved':_0x50fd3f(0x1cf)}}]);if(_0x5cdc68[0x0][_0x50fd3f(0x25d)]==_0x50fd3f(0x2ad))var _0x2d61d6=users[_0x50fd3f(0x23c)];else{if(_0x5cdc68[0x0][_0x50fd3f(0x25d)]=='Hindi')var _0x2d61d6=users[_0x50fd3f(0x198)];else{if(_0x5cdc68[0x0]['language']==_0x50fd3f(0x241))var _0x2d61d6=users[_0x50fd3f(0x241)];else{if(_0x5cdc68[0x0][_0x50fd3f(0x25d)]==_0x50fd3f(0x1ea))var _0x2d61d6=users['Spanish'];else{if(_0x5cdc68[0x0][_0x50fd3f(0x25d)]==_0x50fd3f(0x19c))var _0x2d61d6=users[_0x50fd3f(0x19c)];else{if(_0x5cdc68[0x0]['language']=='Portuguese\x20(BR)')var _0x2d61d6=users[_0x50fd3f(0x179)];else{if(_0x5cdc68[0x0][_0x50fd3f(0x25d)]=='Chinese')var _0x2d61d6=users['Chinese'];else{if(_0x5cdc68[0x0][_0x50fd3f(0x25d)]==_0x50fd3f(0x1a5))var _0x2d61d6=users[_0x50fd3f(0x28f)];}}}}}}}_0x26a0a6[_0x50fd3f(0x1dd)]('incoming_add',{'success':_0x5a276a['flash'](_0x50fd3f(0x244)),'errors':_0x5a276a['flash'](_0x50fd3f(0x2a5)),'purchases':_0x537e7e,'role':_0x2570f1,'profile':_0x5db121,'master_shop':_0x5cdc68,'language':_0x2d61d6,'staff_data':_0x196f43});}catch(_0x107242){console[_0x50fd3f(0x183)]('table\x20page',_0x107242),_0x26a0a6[_0x50fd3f(0x1fa)](0xc8)['json']({'message':_0x107242[_0x50fd3f(0x221)]});}});const createLog=async _0x59928e=>{var _0x4e15ab=a0_0x487e73;const _0x5502cd=new datalogs({'location':_0x59928e});return await _0x5502cd[_0x4e15ab(0x238)](),_0x5502cd[_0x4e15ab(0x1d7)];};router['post']('/incoming/add',auth,async(_0x44fd1a,_0xd4e3f7)=>{var _0x3e46c2=a0_0x487e73;try{const {invoice_trf_data:_0x2d8c45,item_code:_0x334f70,SCRN:_0x1584b3,ReqBy:_0x138c1b,type_of_products:_0x24959a,dateofreq:_0x368cca,PO_number:_0x3c4e1f,date:_0x2c75f5,warehouse_name:_0x51de2a,typeservicesData:_0x268893,typevehicle:_0x2606ab,driver:_0x4269b0,plate:_0x55d39a,van:_0x193a03,DRSI:_0x15e5ef,TSU:_0x329dd4,TFU:_0x374bbb,note:_0x384097}=_0x44fd1a[_0x3e46c2(0x178)],_0x301b48=await transfers_finished[_0x3e46c2(0x206)](_0x2d8c45);if(typeof _0x334f70==_0x3e46c2(0x1df))var _0x217d73=[_0x44fd1a['body'][_0x3e46c2(0x1b1)]],_0x376d8f=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x176)]],_0x228022=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x22e)]],_0x5ce057=[_0x44fd1a['body'][_0x3e46c2(0x186)]],_0x45abe0=[_0x44fd1a['body'][_0x3e46c2(0x233)]],_0x2612a0=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x1f9)]],_0x547ab8=[_0x44fd1a[_0x3e46c2(0x178)]['primary_code']],_0x376f51=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x2aa)]],_0x11c7a5=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x262)]],_0x47829e=[_0x44fd1a[_0x3e46c2(0x178)]['expiry_date']],_0x17205b=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x190)]],_0x1ce019=[_0x44fd1a['body'][_0x3e46c2(0x174)]],_0x2e054b=[_0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x272)]];else var _0x217d73=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x1b1)]],_0x376d8f=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x176)]],_0x228022=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x22e)]],_0x5ce057=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x186)]],_0x45abe0=[..._0x44fd1a[_0x3e46c2(0x178)]['prod_secondunit']],_0x2612a0=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x1f9)]],_0x547ab8=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x29c)]],_0x376f51=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x2aa)]],_0x11c7a5=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x262)]],_0x47829e=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x1fc)]],_0x17205b=[..._0x44fd1a[_0x3e46c2(0x178)]['production_date']],_0x1ce019=[..._0x44fd1a[_0x3e46c2(0x178)][_0x3e46c2(0x174)]],_0x2e054b=[..._0x44fd1a['body'][_0x3e46c2(0x272)]];const _0x519688=_0x217d73[_0x3e46c2(0x204)](_0xc42c65=>{return _0xc42c65={'product_name':_0xc42c65};});_0x376d8f['forEach']((_0x360383,_0x1b6394)=>{_0x519688[_0x1b6394]['product_code']=_0x360383;}),_0x228022['forEach']((_0x55d4e3,_0x29e407)=>{var _0x596398=_0x3e46c2;_0x519688[_0x29e407][_0x596398(0x1be)]=Math['abs'](_0x55d4e3);}),_0x5ce057[_0x3e46c2(0x1fd)]((_0x2df4e6,_0x51460d)=>{var _0x23290d=_0x3e46c2;_0x519688[_0x51460d][_0x23290d(0x20a)]=_0x2df4e6;}),_0x45abe0[_0x3e46c2(0x1fd)]((_0x305e3e,_0x40c301)=>{var _0xef50fe=_0x3e46c2;_0x519688[_0x40c301][_0xef50fe(0x17f)]=_0x305e3e;}),_0x2612a0[_0x3e46c2(0x1fd)]((_0x19cf99,_0x3dd683)=>{var _0x5d7364=_0x3e46c2,_0x5beb4d=_0x19cf99[_0x5d7364(0x1e2)](/[A-Za-z]+/)[0x0],_0x348da9=parseInt(_0x19cf99[_0x5d7364(0x1e2)](/\d+/)[0x0]);_0x519688[_0x3dd683]['level']=_0x5beb4d,_0x519688[_0x3dd683]['bay']=_0x348da9;}),_0x547ab8['forEach']((_0x3ead75,_0x56810f)=>{var _0x2a32e6=_0x3e46c2;_0x519688[_0x56810f][_0x2a32e6(0x29c)]=_0x3ead75;}),_0x376f51[_0x3e46c2(0x1fd)]((_0x3f0428,_0x46d322)=>{var _0xcbb7d8=_0x3e46c2;_0x519688[_0x46d322][_0xcbb7d8(0x2aa)]=_0x3f0428;}),_0x11c7a5['forEach']((_0x392a03,_0x5187b4)=>{var _0x2f22e6=_0x3e46c2;_0x519688[_0x5187b4][_0x2f22e6(0x262)]=_0x392a03;}),_0x47829e[_0x3e46c2(0x1fd)]((_0x3c7bd8,_0x341152)=>{var _0x479b0b=_0x3e46c2;_0x519688[_0x341152][_0x479b0b(0x1fc)]=_0x3c7bd8;}),_0x17205b[_0x3e46c2(0x1fd)]((_0x55ab48,_0x5b767d)=>{var _0x45b375=_0x3e46c2;_0x519688[_0x5b767d][_0x45b375(0x190)]=_0x55ab48;}),_0x1ce019[_0x3e46c2(0x1fd)]((_0x5e70f,_0x1abdeb)=>{var _0x1a0172=_0x3e46c2;_0x519688[_0x1abdeb][_0x1a0172(0x1f3)]=_0x5e70f;}),_0x2e054b[_0x3e46c2(0x1fd)]((_0x306fa6,_0x15ec4e)=>{_0x519688[_0x15ec4e]['room_name']=_0x306fa6;});const _0x1b36e5=await createLog(_0x3e46c2(0x17a));_0x2e054b[_0x3e46c2(0x1fd)]((_0x1b8f8b,_0x2fed92)=>{var _0x591c16=_0x3e46c2;_0x519688[_0x2fed92][_0x591c16(0x225)]=_0x591c16(0x2a1)+_0x1b36e5[_0x591c16(0x1a4)]()[_0x591c16(0x180)](0x8,'0');});const _0x558c46=_0x519688['filter'](_0x4a88e2=>_0x4a88e2[_0x3e46c2(0x1be)]!=='0'&&_0x4a88e2[_0x3e46c2(0x1be)]!==''),_0x325c51=new purchases_incoming({'invoice':_0x3e46c2(0x2a1)+_0x1b36e5[_0x3e46c2(0x1a4)]()[_0x3e46c2(0x180)](0x8,'0'),'date':_0x2c75f5,'warehouse_name':_0x51de2a,'product':_0x558c46,'note':_0x384097,'POnumber':_0x3c4e1f,'SCRN':_0x1584b3,'ReqBy':_0x138c1b,'dateofreq':_0x368cca,'typeservicesData':_0x268893,'van':_0x193a03,'typevehicle':_0x2606ab,'driver':_0x4269b0,'plate':_0x55d39a,'DRSI':_0x15e5ef,'TSU':_0x329dd4,'TFU':_0x374bbb,'typeOfProducts':_0x24959a}),_0x5e350d=await _0x325c51['save'](),_0x20d671=_0x5e350d['product'][_0x3e46c2(0x204)](async _0x5f0d6b=>{var _0xf5ac80=_0x3e46c2,_0x186107=await warehouse[_0xf5ac80(0x1d9)]({'name':_0x51de2a,'room':_0x5f0d6b['room_name']});if(_0x5f0d6b['quantity']>0x0){var _0x48b26b=0x0;const _0x8fccab=_0x186107[_0xf5ac80(0x1bb)][_0xf5ac80(0x204)](_0x69176c=>{var _0x4ae411=_0xf5ac80;_0x69176c[_0x4ae411(0x1b1)]==_0x5f0d6b[_0x4ae411(0x1b1)]&&_0x69176c[_0x4ae411(0x287)]==_0x5f0d6b[_0x4ae411(0x1ca)]&&_0x69176c[_0x4ae411(0x1fc)]==_0x5f0d6b['expiry_date']&&_0x69176c['production_date']==_0x5f0d6b['production_date']&&_0x69176c[_0x4ae411(0x262)]==_0x5f0d6b[_0x4ae411(0x262)]&&_0x69176c[_0x4ae411(0x225)]==_0x5f0d6b[_0x4ae411(0x225)]&&(typeof _0x5f0d6b['id_transaction']==_0x4ae411(0x2b8)?(console[_0x4ae411(0x183)](_0x4ae411(0x1e5),_0x69176c[_0x4ae411(0x1c0)]+_0x4ae411(0x258)+_0x69176c[_0x4ae411(0x1a6)]+_0x4ae411(0x260)+Math[_0x4ae411(0x205)](_0x69176c['product_stock'])+Math['abs'](_0x5f0d6b[_0x4ae411(0x22e)])),_0x69176c[_0x4ae411(0x1c0)]=Math['abs'](_0x69176c[_0x4ae411(0x1c0)])+Math[_0x4ae411(0x205)](_0x5f0d6b[_0x4ae411(0x1be)])):(_0x69176c[_0x4ae411(0x1c0)]=Math[_0x4ae411(0x205)](_0x69176c[_0x4ae411(0x1c0)])+Math[_0x4ae411(0x205)](_0x5f0d6b[_0x4ae411(0x1be)]),_0x48b26b++));});_0x48b26b=='0'&&(_0x186107[_0xf5ac80(0x1bb)]=_0x186107[_0xf5ac80(0x1bb)][_0xf5ac80(0x1ce)]({'product_name':_0x5f0d6b[_0xf5ac80(0x1b1)],'product_stock':_0x5f0d6b[_0xf5ac80(0x1be)],'bay':_0x5f0d6b['bay'],'level':_0x5f0d6b[_0xf5ac80(0x29a)],'product_code':_0x5f0d6b[_0xf5ac80(0x1a1)],'primary_code':_0x5f0d6b[_0xf5ac80(0x29c)],'secondary_code':_0x5f0d6b[_0xf5ac80(0x2aa)],'expiry_date':_0x5f0d6b[_0xf5ac80(0x1fc)],'production_date':_0x5f0d6b[_0xf5ac80(0x190)],'maxProducts':_0x5f0d6b[_0xf5ac80(0x27c)],'batch_code':_0x5f0d6b['batch_code'],'secondary_unit':_0x5f0d6b[_0xf5ac80(0x17f)],'unit':_0x5f0d6b[_0xf5ac80(0x20a)],'maxProducts':_0x5f0d6b[_0xf5ac80(0x27c)],'maxPerUnit':_0x5f0d6b[_0xf5ac80(0x256)],'invoice':_0x5f0d6b['invoice']}));}return _0x186107;});Promise['all'](_0x20d671)[_0x3e46c2(0x1ff)](async _0x57c36a=>{var _0x41e9cf=_0x3e46c2;try{for(const _0x51aa81 of _0x57c36a){await warehouse[_0x41e9cf(0x1f6)]({'_id':_0x51aa81[_0x41e9cf(0x1a6)]},{'$addToSet':{'product_details':{'$each':_0x51aa81[_0x41e9cf(0x1bb)]}}});}_0x301b48[_0x41e9cf(0x1b5)]='true';const _0x470c0d=await _0x301b48[_0x41e9cf(0x238)](),_0x2741a2=await master_shop['find'](),_0x44416d=await email_settings[_0x41e9cf(0x1d9)](),_0x4be866=await supervisor_settings[_0x41e9cf(0x1ad)]();var _0x361129=_0x325c51[_0x41e9cf(0x1ac)],_0x5723ff='',_0x90a23b;for(_0x90a23b in _0x361129){var _0x3b5f77='FG';_0x325c51[_0x41e9cf(0x253)]==_0x41e9cf(0x29d)&&(_0x3b5f77='DG'),_0x5723ff+=_0x41e9cf(0x264)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x361129[_0x90a23b][_0x41e9cf(0x1b1)]+_0x41e9cf(0x21c)+_0x41e9cf(0x1ae)+_0x361129[_0x90a23b][_0x41e9cf(0x1a1)]+_0x41e9cf(0x21c)+_0x41e9cf(0x1ae)+_0x361129[_0x90a23b][_0x41e9cf(0x22e)]+'</td>'+_0x41e9cf(0x1ae)+_0x361129[_0x90a23b][_0x41e9cf(0x186)]+'</td>'+_0x41e9cf(0x1ae)+_0x361129[_0x90a23b][_0x41e9cf(0x17f)]+_0x41e9cf(0x21c)+_0x41e9cf(0x1ae)+_0x325c51[_0x41e9cf(0x253)]+_0x41e9cf(0x21c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x361129[_0x90a23b]['to_room_name']+_0x41e9cf(0x21c)+_0x41e9cf(0x1ae)+_0x3b5f77+_0x361129[_0x90a23b][_0x41e9cf(0x1ca)]+_0x41e9cf(0x21c)+_0x41e9cf(0x210);}_0x44fd1a[_0x41e9cf(0x1f0)](_0x41e9cf(0x244),_0x41e9cf(0x175)),_0xd4e3f7[_0x41e9cf(0x1e4)](_0x41e9cf(0x1e0)+_0x5e350d[_0x41e9cf(0x1a6)]);}catch(_0x526567){console[_0x41e9cf(0x243)](_0x526567),_0xd4e3f7[_0x41e9cf(0x1fa)](0x1f4)[_0x41e9cf(0x1a7)]({'error':_0x41e9cf(0x19a)});}})[_0x3e46c2(0x24c)](_0x4b24f3=>{var _0x3d5e38=_0x3e46c2;console[_0x3d5e38(0x243)](_0x4b24f3),_0xd4e3f7['status'](0x1f4)[_0x3d5e38(0x1a7)]({'error':_0x3d5e38(0x196)});});}catch(_0x4f2c6b){}}),router[a0_0x487e73(0x203)](a0_0x487e73(0x201),auth,async(_0x302286,_0x483345)=>{var _0x45eafa=a0_0x487e73;try{const {warehouse:_0x59812d}=_0x302286[_0x45eafa(0x178)],_0x30c806=await transfers_finished[_0x45eafa(0x1ad)]({'to_warehouse':_0x59812d,'to_recieved':_0x45eafa(0x1cf)});_0x483345[_0x45eafa(0x1a7)](_0x30c806);}catch(_0x4a717d){}}),router[a0_0x487e73(0x203)](a0_0x487e73(0x1f5),auth,async(_0x56e96f,_0x32b54c)=>{var _0x308da8=a0_0x487e73;try{const {invoice:_0x4b596d}=_0x56e96f[_0x308da8(0x178)],_0x40b32d=await transfers_finished['find']({'_id':_0x4b596d,'to_recieved':'false'});_0x32b54c[_0x308da8(0x1a7)](_0x40b32d);}catch(_0xa65eb){}}),router[a0_0x487e73(0x288)](a0_0x487e73(0x2b4),auth,async(_0x55278f,_0x14e225)=>{var _0x2d336c=a0_0x487e73;try{const {username:_0x58e916,email:_0x4238d1,role:_0x308161}=_0x55278f['user'],_0x48c966=_0x55278f[_0x2d336c(0x1e7)],_0x51f38e=await profile['findOne']({'email':_0x48c966[_0x2d336c(0x1a0)]}),_0x54ec8f=await staff[_0x2d336c(0x1d9)]({'email':_0x48c966[_0x2d336c(0x1a0)]});if(_0x48c966[_0x2d336c(0x1ab)]==_0x2d336c(0x224)){const _0x2a1953=await staff[_0x2d336c(0x1d9)]({'email':_0x48c966[_0x2d336c(0x1a0)]});}const _0x1867d5=await master_shop[_0x2d336c(0x1ad)]();let _0x4adfbb;if(_0x48c966[_0x2d336c(0x1ab)]==_0x2d336c(0x224)){const _0xc150db=await staff[_0x2d336c(0x1d9)]({'email':_0x48c966['email']});_0x4adfbb=await purchases_finished[_0x2d336c(0x1a2)]([{'$match':{'warehouse_name':_0xc150db[_0x2d336c(0x232)],'typeOfProducts':_0x2d336c(0x217)}},{'$lookup':{'from':_0x2d336c(0x2af),'localField':_0x2d336c(0x2af),'foreignField':_0x2d336c(0x2a3),'as':'suppliers_docs'}},{'$unwind':_0x2d336c(0x22b)},{'$unwind':_0x2d336c(0x2ae)},{'$group':{'_id':_0x2d336c(0x255),'invoice':{'$first':_0x2d336c(0x248)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2d336c(0x23e)},'warehouse_name':{'$first':_0x2d336c(0x265)},'room':{'$first':_0x2d336c(0x21b)},'product':{'$push':'$product'},'note':{'$first':_0x2d336c(0x194)},'paid_amount':{'$first':_0x2d336c(0x1c7)},'due_amount':{'$first':_0x2d336c(0x1eb)},'return_data':{'$first':_0x2d336c(0x1f2)},'batch_code':{'$first':_0x2d336c(0x1dc)},'expiry_date':{'$first':_0x2d336c(0x1a8)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x2d336c(0x208)},'level':{'$addToSet':_0x2d336c(0x29e)},'isle':{'$addToSet':_0x2d336c(0x1ee)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2d336c(0x29b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4adfbb=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x2d336c(0x217)}},{'$unwind':_0x2d336c(0x2ae)},{'$group':{'_id':_0x2d336c(0x255),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2d336c(0x263)},'date':{'$first':_0x2d336c(0x23e)},'warehouse_name':{'$first':_0x2d336c(0x265)},'room':{'$addToSet':_0x2d336c(0x1c8)},'product':{'$push':_0x2d336c(0x2ae)},'note':{'$first':_0x2d336c(0x194)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2d336c(0x1eb)},'return_data':{'$first':_0x2d336c(0x1f2)},'batch_code':{'$first':_0x2d336c(0x1dc)},'expiry_date':{'$first':_0x2d336c(0x1a8)},'suppliers_docs':{'$first':_0x2d336c(0x22b)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2d336c(0x1ee)},'type':{'$addToSet':_0x2d336c(0x215)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1867d5[0x0][_0x2d336c(0x25d)]==_0x2d336c(0x2ad))var _0x458eee=users['English'];else{if(_0x1867d5[0x0]['language']==_0x2d336c(0x198))var _0x458eee=users[_0x2d336c(0x198)];else{if(_0x1867d5[0x0][_0x2d336c(0x25d)]==_0x2d336c(0x241))var _0x458eee=users[_0x2d336c(0x241)];else{if(_0x1867d5[0x0]['language']==_0x2d336c(0x1ea))var _0x458eee=users[_0x2d336c(0x1ea)];else{if(_0x1867d5[0x0]['language']==_0x2d336c(0x19c))var _0x458eee=users[_0x2d336c(0x19c)];else{if(_0x1867d5[0x0][_0x2d336c(0x25d)]==_0x2d336c(0x236))var _0x458eee=users[_0x2d336c(0x179)];else{if(_0x1867d5[0x0][_0x2d336c(0x25d)]==_0x2d336c(0x1de))var _0x458eee=users[_0x2d336c(0x1de)];else{if(_0x1867d5[0x0][_0x2d336c(0x25d)]==_0x2d336c(0x1a5))var _0x458eee=users[_0x2d336c(0x28f)];}}}}}}}_0x14e225[_0x2d336c(0x1dd)](_0x2d336c(0x1b4),{'success':_0x55278f[_0x2d336c(0x1f0)]('success'),'errors':_0x55278f[_0x2d336c(0x1f0)](_0x2d336c(0x2a5)),'purchases':_0x4adfbb,'role':_0x48c966,'profile':_0x51f38e,'master_shop':_0x1867d5,'language':_0x458eee});}catch(_0x1beb5f){console[_0x2d336c(0x183)]('table\x20page',_0x1beb5f),_0x14e225[_0x2d336c(0x1fa)](0xc8)[_0x2d336c(0x1a7)]({'message':_0x1beb5f['message']});}}),router[a0_0x487e73(0x288)](a0_0x487e73(0x25a),auth,async(_0x3a1449,_0x17b9fd)=>{var _0x39cc92=a0_0x487e73;try{const {username:_0x2d75e0,email:_0x5120b3,role:_0x394708}=_0x3a1449[_0x39cc92(0x1e7)],_0x4d82cc=_0x3a1449[_0x39cc92(0x1e7)],_0x237726=await profile['findOne']({'email':_0x4d82cc['email']}),_0x58409b=await staff[_0x39cc92(0x1d9)]({'email':_0x4d82cc[_0x39cc92(0x1a0)]});if(_0x4d82cc['role']==_0x39cc92(0x224)){const _0x23db3d=await staff[_0x39cc92(0x1d9)]({'email':_0x4d82cc['email']});}const _0xbfd1b7=await master_shop['find']();let _0x242b79;if(_0x4d82cc[_0x39cc92(0x1ab)]==_0x39cc92(0x224)){const _0x291de8=await staff['findOne']({'email':_0x4d82cc[_0x39cc92(0x1a0)]});_0x242b79=await purchases_finished[_0x39cc92(0x1a2)]([{'$match':{'warehouse_name':_0x291de8['warehouse']}},{'$lookup':{'from':_0x39cc92(0x2af),'localField':_0x39cc92(0x2af),'foreignField':_0x39cc92(0x2a3),'as':_0x39cc92(0x229)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x39cc92(0x2ae)},{'$group':{'_id':_0x39cc92(0x255),'invoice':{'$first':_0x39cc92(0x248)},'suppliers':{'$first':_0x39cc92(0x263)},'date':{'$first':_0x39cc92(0x23e)},'warehouse_name':{'$first':_0x39cc92(0x265)},'room':{'$first':_0x39cc92(0x21b)},'product':{'$push':_0x39cc92(0x2ae)},'note':{'$first':_0x39cc92(0x194)},'paid_amount':{'$first':_0x39cc92(0x1c7)},'due_amount':{'$first':_0x39cc92(0x1eb)},'return_data':{'$first':_0x39cc92(0x1f2)},'batch_code':{'$first':_0x39cc92(0x1dc)},'expiry_date':{'$first':_0x39cc92(0x1a8)},'suppliers_docs':{'$first':_0x39cc92(0x22b)},'total_product_quantity':{'$sum':_0x39cc92(0x208)},'level':{'$addToSet':_0x39cc92(0x29e)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x39cc92(0x29b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x242b79=await purchases_finished[_0x39cc92(0x1a2)]([{'$match':{'typeOfProducts':_0x39cc92(0x21d)}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x39cc92(0x248)},'suppliers':{'$first':_0x39cc92(0x263)},'date':{'$first':_0x39cc92(0x23e)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x39cc92(0x1c8)},'product':{'$push':'$product'},'note':{'$first':_0x39cc92(0x194)},'paid_amount':{'$first':_0x39cc92(0x1c7)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x39cc92(0x1f2)},'batch_code':{'$first':_0x39cc92(0x1dc)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x39cc92(0x22b)},'total_product_quantity':{'$sum':_0x39cc92(0x208)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x39cc92(0x1ee)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]==_0x39cc92(0x2ad))var _0x429ef2=users[_0x39cc92(0x23c)];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]=='Hindi')var _0x429ef2=users[_0x39cc92(0x198)];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]==_0x39cc92(0x241))var _0x429ef2=users[_0x39cc92(0x241)];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]==_0x39cc92(0x1ea))var _0x429ef2=users[_0x39cc92(0x1ea)];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]==_0x39cc92(0x19c))var _0x429ef2=users['French'];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]==_0x39cc92(0x236))var _0x429ef2=users[_0x39cc92(0x179)];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]=='Chinese')var _0x429ef2=users[_0x39cc92(0x1de)];else{if(_0xbfd1b7[0x0][_0x39cc92(0x25d)]==_0x39cc92(0x1a5))var _0x429ef2=users[_0x39cc92(0x28f)];}}}}}}}_0x17b9fd[_0x39cc92(0x1dd)](_0x39cc92(0x21f),{'success':_0x3a1449[_0x39cc92(0x1f0)](_0x39cc92(0x244)),'errors':_0x3a1449[_0x39cc92(0x1f0)](_0x39cc92(0x2a5)),'purchases':_0x242b79,'role':_0x4d82cc,'profile':_0x237726,'master_shop':_0xbfd1b7,'language':_0x429ef2});}catch(_0x118128){console[_0x39cc92(0x183)](_0x39cc92(0x240),_0x118128),_0x17b9fd[_0x39cc92(0x1fa)](0xc8)[_0x39cc92(0x1a7)]({'message':_0x118128[_0x39cc92(0x221)]});}});function BayBinSelected(_0x2fed49,_0xcfa82f){var _0x76b54b=a0_0x487e73,_0x14d466=[],_0x26ab41=[];if(_0x2fed49==_0x76b54b(0x29d)){switch(_0xcfa82f){case _0x76b54b(0x257):_0x14d466=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x76b54b(0x211):_0x14d466=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x26ab41=['DG'];}else{if(_0x2fed49==_0x76b54b(0x242)){switch(_0xcfa82f){case'Rack\x201':_0x14d466=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x76b54b(0x211):_0x14d466=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x26ab41=['FG'];}}return{'levels':_0x14d466,'identify':_0x26ab41};}async function getRandom8DigitNumber(){var _0x5ecea5=a0_0x487e73;const _0x4bba21=0x989680,_0x152b90=0x5f5e0ff,_0x5891eb=Math[_0x5ecea5(0x1f7)](Math[_0x5ecea5(0x289)]()*(_0x152b90-_0x4bba21+0x1))+_0x4bba21;var _0x453c29;const _0x4d8507=await purchases_finished['findOne']({'invoice':'INCF-'+_0x5891eb});return _0x4d8507&&_0x4d8507['length']>0x0?_0x453c29=_0x5ecea5(0x28c)+_0x5891eb:_0x453c29=_0x5ecea5(0x28c)+_0x5891eb,_0x453c29;}router[a0_0x487e73(0x288)](a0_0x487e73(0x1d1),auth,async(_0xa8e805,_0x192504)=>{var _0x3c2042=a0_0x487e73;try{const {username:_0x43b181,email:_0x2808dc,role:_0x5e579c}=_0xa8e805[_0x3c2042(0x1e7)],_0x49f6df=_0xa8e805[_0x3c2042(0x1e7)],_0x10e60b=await profile[_0x3c2042(0x1d9)]({'email':_0x49f6df['email']}),_0x3c7653=await master_shop['find'](),_0x3fa096=await staff[_0x3c2042(0x1d9)]({'email':_0x49f6df[_0x3c2042(0x1a0)]}),_0x327df1=await suppliers['find']({});let _0x1c6d83;if(_0x49f6df[_0x3c2042(0x1ab)]==_0x3c2042(0x224)){const _0x723e20=await staff[_0x3c2042(0x1d9)]({'email':_0x49f6df[_0x3c2042(0x1a0)]});_0x1c6d83=await warehouse[_0x3c2042(0x1a2)]([{'$match':{'status':_0x3c2042(0x21e),'name':_0x723e20[_0x3c2042(0x232)]}},{'$group':{'_id':_0x3c2042(0x185),'name':{'$first':_0x3c2042(0x185)}}}]);}else _0x1c6d83=await warehouse['aggregate']([{'$match':{'status':_0x3c2042(0x21e)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x41c526=await product[_0x3c2042(0x1ad)]({}),_0x4906f7=await warehouse[_0x3c2042(0x1ad)]({'status':'Enabled'}),_0x5e9f05=await purchases_finished[_0x3c2042(0x1ad)]({}),_0x29b032=_0x5e9f05[_0x3c2042(0x276)]+0x1,_0x4aae1c=_0x3c2042(0x28c)+_0x29b032[_0x3c2042(0x1a4)]()[_0x3c2042(0x180)](0x5,'0');var _0x2589c9=[_0x3c2042(0x278),_0x3c2042(0x1d4)];if(_0x3c7653[0x0][_0x3c2042(0x25d)]=='English\x20(US)')var _0x24f308=users[_0x3c2042(0x23c)];else{if(_0x3c7653[0x0]['language']==_0x3c2042(0x198))var _0x24f308=users[_0x3c2042(0x198)];else{if(_0x3c7653[0x0][_0x3c2042(0x25d)]==_0x3c2042(0x241))var _0x24f308=users[_0x3c2042(0x241)];else{if(_0x3c7653[0x0][_0x3c2042(0x25d)]==_0x3c2042(0x1ea))var _0x24f308=users[_0x3c2042(0x1ea)];else{if(_0x3c7653[0x0][_0x3c2042(0x25d)]==_0x3c2042(0x19c))var _0x24f308=users[_0x3c2042(0x19c)];else{if(_0x3c7653[0x0]['language']==_0x3c2042(0x236))var _0x24f308=users[_0x3c2042(0x179)];else{if(_0x3c7653[0x0][_0x3c2042(0x25d)]==_0x3c2042(0x1de))var _0x24f308=users[_0x3c2042(0x1de)];else{if(_0x3c7653[0x0][_0x3c2042(0x25d)]==_0x3c2042(0x1a5))var _0x24f308=users[_0x3c2042(0x28f)];}}}}}}}const _0x18ba70=getRandom8DigitNumber(),_0x1d4b58=new Date(),_0x5ace52={'year':'numeric','month':_0x3c2042(0x1ec),'day':_0x3c2042(0x1ec),'timeZone':_0x3c2042(0x26a)},_0x50cf8e=_0x1d4b58[_0x3c2042(0x218)]('en-CA',_0x5ace52);console[_0x3c2042(0x183)](_0x50cf8e),_0x18ba70[_0x3c2042(0x1ff)](_0x142e10=>{var _0x31a817=_0x3c2042;_0x192504[_0x31a817(0x1dd)]('add_purchases_finished',{'success':_0xa8e805['flash'](_0x31a817(0x244)),'errors':_0xa8e805[_0x31a817(0x1f0)](_0x31a817(0x2a5)),'role':_0x49f6df,'profile':_0x10e60b,'suppliers':_0x327df1,'warehouse':_0x1c6d83,'product':_0x41c526,'invoice':_0x142e10,'master_shop':_0x3c7653,'language':_0x24f308,'find_data':_0x4906f7,'rooms_data':_0x2589c9,'formattedDate':_0x50cf8e});})[_0x3c2042(0x24c)](_0x51c0a4=>{var _0x3e9cfb=_0x3c2042;_0xa8e805[_0x3e9cfb(0x1f0)](_0x3e9cfb(0x2a5),_0x3e9cfb(0x195)),_0x192504[_0x3e9cfb(0x1e4)](_0x3e9cfb(0x23d));});}catch(_0x1ccbfa){console['log'](_0x1ccbfa);}}),router[a0_0x487e73(0x288)](a0_0x487e73(0x1da),auth,async(_0x173d5c,_0x436c0b)=>{var _0xbc7b34=a0_0x487e73;try{const {username:_0x15dfd0,email:_0xfea2e0,role:_0x308ead}=_0x173d5c[_0xbc7b34(0x1e7)],_0x4d108a=_0x173d5c[_0xbc7b34(0x1e7)],_0x39d373=await profile[_0xbc7b34(0x1d9)]({'email':_0x4d108a['email']}),_0x3f1596=await master_shop[_0xbc7b34(0x1ad)](),_0x19148c=await staff[_0xbc7b34(0x1d9)]({'email':_0x4d108a[_0xbc7b34(0x1a0)]}),_0x2aa0f6=await suppliers[_0xbc7b34(0x1ad)]({});let _0x528977;if(_0x4d108a[_0xbc7b34(0x1ab)]=='staff'){const _0x30ea58=await staff['findOne']({'email':_0x4d108a[_0xbc7b34(0x1a0)]});_0x528977=await warehouse[_0xbc7b34(0x1a2)]([{'$match':{'status':_0xbc7b34(0x21e),'name':_0x30ea58[_0xbc7b34(0x232)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x528977=await warehouse[_0xbc7b34(0x1a2)]([{'$match':{'status':_0xbc7b34(0x21e)}},{'$group':{'_id':_0xbc7b34(0x185),'name':{'$first':'$name'}}}]);const _0x309fa2=await product[_0xbc7b34(0x1ad)]({}),_0x3fd6e3=await warehouse[_0xbc7b34(0x1ad)]({'status':_0xbc7b34(0x21e)}),_0x2b2efc=await purchases_finished[_0xbc7b34(0x1ad)]({}),_0x3536f4=_0x2b2efc[_0xbc7b34(0x276)]+0x1,_0x5c3767=_0xbc7b34(0x28c)+_0x3536f4['toString']()[_0xbc7b34(0x180)](0x5,'0');var _0x31f86a=['Ambient',_0xbc7b34(0x1d4)];if(_0x3f1596[0x0]['language']=='English\x20(US)')var _0xb431c3=users[_0xbc7b34(0x23c)];else{if(_0x3f1596[0x0]['language']=='Hindi')var _0xb431c3=users['Hindi'];else{if(_0x3f1596[0x0][_0xbc7b34(0x25d)]==_0xbc7b34(0x241))var _0xb431c3=users['German'];else{if(_0x3f1596[0x0]['language']==_0xbc7b34(0x1ea))var _0xb431c3=users[_0xbc7b34(0x1ea)];else{if(_0x3f1596[0x0][_0xbc7b34(0x25d)]==_0xbc7b34(0x19c))var _0xb431c3=users['French'];else{if(_0x3f1596[0x0][_0xbc7b34(0x25d)]==_0xbc7b34(0x236))var _0xb431c3=users[_0xbc7b34(0x179)];else{if(_0x3f1596[0x0][_0xbc7b34(0x25d)]==_0xbc7b34(0x1de))var _0xb431c3=users[_0xbc7b34(0x1de)];else{if(_0x3f1596[0x0][_0xbc7b34(0x25d)]==_0xbc7b34(0x1a5))var _0xb431c3=users['Arabic'];}}}}}}}const _0x20fbe4=getRandom8DigitNumber();_0x20fbe4[_0xbc7b34(0x1ff)](_0x531689=>{var _0x8ddfff=_0xbc7b34;_0x436c0b[_0x8ddfff(0x1dd)]('add_purchases_finished_logs',{'success':_0x173d5c[_0x8ddfff(0x1f0)]('success'),'errors':_0x173d5c['flash'](_0x8ddfff(0x2a5)),'role':_0x4d108a,'profile':_0x39d373,'suppliers':_0x2aa0f6,'warehouse':_0x528977,'product':_0x309fa2,'invoice':_0x531689,'master_shop':_0x3f1596,'language':_0xb431c3,'find_data':_0x3fd6e3,'rooms_data':_0x31f86a});})[_0xbc7b34(0x24c)](_0x474eba=>{var _0x4f2f26=_0xbc7b34;_0x173d5c['flash'](_0x4f2f26(0x2a5),_0x4f2f26(0x195)),_0x436c0b[_0x4f2f26(0x1e4)](_0x4f2f26(0x23d));});}catch(_0x26c175){console[_0xbc7b34(0x183)](_0x26c175);}}),router[a0_0x487e73(0x288)](a0_0x487e73(0x295),auth,async(_0x5354b3,_0x24f5c2)=>{var _0x393681=a0_0x487e73;try{const _0x52c618=_0x5354b3[_0x393681(0x1c9)]['id'];console[_0x393681(0x183)](_0x52c618);const _0x1353f1=await master_shop[_0x393681(0x1ad)]();console[_0x393681(0x183)](_0x393681(0x1c5),_0x1353f1);const _0xaad63a=await product[_0x393681(0x1d9)]({'name':_0x52c618});console['log'](_0x393681(0x1ac),_0xaad63a),_0x24f5c2['status'](0xc8)[_0x393681(0x1a7)]({'product_data':_0xaad63a,'master':_0x1353f1});}catch(_0x1d5c19){console[_0x393681(0x183)](_0x393681(0x27f),_0x1d5c19);}}),router[a0_0x487e73(0x203)]('/view/add_purchases',auth,async(_0x559992,_0x516358)=>{var _0x19a845=a0_0x487e73;try{const {invoice:_0x2fbbfe,date:_0x284057,warehouse_name:_0x552c77,prod_name:_0x5cc9bf,note:_0x51f67b,due_amount:_0xc44613,Room_name:_0x43d98a,PO_number:_0x4d8714,SCRN:_0x245e3a,ReqBy:_0x57d6c5,dateofreq:_0x38b3a6,suppliers:_0xe731ea,typeservicesData:_0x2b9c79,van:_0x2f88ff,typevehicle:_0x2139df,driver:_0x13c6bd,plate:_0x5ef9cc,DRSI:_0x261862,TSU:_0x21cc35,TFU:_0x1b6713,JO_number:_0x800536,type_of_products:_0x167fbb}=_0x559992[_0x19a845(0x178)];if(typeof _0x5cc9bf==_0x19a845(0x1df))var _0x5590f1=[_0x559992[_0x19a845(0x178)][_0x19a845(0x1fb)]],_0x40af38=[_0x559992[_0x19a845(0x178)][_0x19a845(0x219)]],_0x32a90e=[_0x559992['body'][_0x19a845(0x261)]],_0x2110dc=[_0x559992[_0x19a845(0x178)][_0x19a845(0x284)]],_0x13324b=[_0x559992[_0x19a845(0x178)]['prod_secondunit']],_0x17267=[_0x559992[_0x19a845(0x178)]['primary_code']],_0x75aa19=[_0x559992[_0x19a845(0x178)][_0x19a845(0x2aa)]],_0x49afbe=[_0x559992[_0x19a845(0x178)][_0x19a845(0x1bf)]],_0x4f90de=[_0x559992[_0x19a845(0x178)][_0x19a845(0x262)]],_0x3e1539=[_0x559992[_0x19a845(0x178)][_0x19a845(0x1fc)]],_0x95ead9=[_0x559992[_0x19a845(0x178)][_0x19a845(0x191)]],_0x24b1c2=[_0x559992[_0x19a845(0x178)][_0x19a845(0x174)]],_0x45c6ab=[_0x559992['body'][_0x19a845(0x19d)]],_0x3f1e08=[_0x559992['body'][_0x19a845(0x22d)]],_0x15f5de=[_0x559992['body'][_0x19a845(0x246)]],_0x5e4bc8=[_0x559992[_0x19a845(0x178)]['sales_data_cateory']],_0x491feb=[_0x559992['body'][_0x19a845(0x1b3)]];else var _0x5590f1=[..._0x559992['body']['prod_name']],_0x40af38=[..._0x559992[_0x19a845(0x178)]['prod_code']],_0x32a90e=[..._0x559992[_0x19a845(0x178)][_0x19a845(0x261)]],_0x2110dc=[..._0x559992['body'][_0x19a845(0x284)]],_0x13324b=[..._0x559992['body'][_0x19a845(0x233)]],_0x17267=[..._0x559992['body']['primary_code']],_0x75aa19=[..._0x559992[_0x19a845(0x178)][_0x19a845(0x2aa)]],_0x49afbe=[..._0x559992[_0x19a845(0x178)]['MaxStocks_data']],_0x4f90de=[..._0x559992['body'][_0x19a845(0x262)]],_0x3e1539=[..._0x559992[_0x19a845(0x178)][_0x19a845(0x1fc)]],_0x95ead9=[..._0x559992[_0x19a845(0x178)]['product_date']],_0x24b1c2=[..._0x559992['body'][_0x19a845(0x174)]],_0x45c6ab=[..._0x559992['body']['prod_cat']],_0x3f1e08=[..._0x559992[_0x19a845(0x178)][_0x19a845(0x22d)]],_0x15f5de=[..._0x559992[_0x19a845(0x178)]['uuid']],_0x5e4bc8=[..._0x559992[_0x19a845(0x178)][_0x19a845(0x1b2)]],_0x491feb=[..._0x559992['body'][_0x19a845(0x1b3)]];const _0x1861a5=_0x5590f1[_0x19a845(0x204)](_0x2fb4df=>{return _0x2fb4df={'product_name':_0x2fb4df};});_0x491feb[_0x19a845(0x1fd)]((_0x411ddd,_0x5bc705)=>{var _0x4e1dba=_0x19a845;_0x1861a5[_0x5bc705][_0x4e1dba(0x1b3)]=_0x411ddd,_0x1861a5[_0x5bc705]['date_recieved']=_0x284057;}),_0x5e4bc8['forEach']((_0x81bd2b,_0x2cb16d)=>{_0x1861a5[_0x2cb16d]['sales_category']=_0x81bd2b;}),_0x40af38[_0x19a845(0x1fd)]((_0xd77cf9,_0x27865a)=>{var _0x317a7a=_0x19a845;_0x1861a5[_0x27865a][_0x317a7a(0x1a1)]=_0xd77cf9;}),_0x15f5de['forEach']((_0x10b23e,_0x6dd58f)=>{_0x1861a5[_0x6dd58f]['uuid']=_0x10b23e;}),_0x32a90e['forEach']((_0x20a7c3,_0x13a8a1)=>{var _0x2b6799=_0x19a845;_0x1861a5[_0x13a8a1][_0x2b6799(0x1be)]=Math[_0x2b6799(0x205)](_0x20a7c3);}),_0x2110dc[_0x19a845(0x1fd)]((_0x2e9378,_0x36a8c8)=>{var _0x2214f1=_0x19a845;_0x1861a5[_0x36a8c8][_0x2214f1(0x20a)]=_0x2e9378;}),_0x13324b['forEach']((_0x6d7787,_0x3579d8)=>{var _0x130878=_0x19a845;_0x1861a5[_0x3579d8][_0x130878(0x17f)]=_0x6d7787;}),_0x17267[_0x19a845(0x1fd)]((_0x59637f,_0x3a1879)=>{var _0x260947=_0x19a845;_0x1861a5[_0x3a1879][_0x260947(0x29c)]=_0x59637f;}),_0x75aa19[_0x19a845(0x1fd)]((_0x30a756,_0x2770d8)=>{var _0x1713f4=_0x19a845;_0x1861a5[_0x2770d8][_0x1713f4(0x2aa)]=_0x30a756;}),_0x49afbe[_0x19a845(0x1fd)]((_0x547cf5,_0x5e7203)=>{var _0x5a8248=_0x19a845;_0x1861a5[_0x5e7203][_0x5a8248(0x29f)]=_0x547cf5;}),_0x4f90de[_0x19a845(0x1fd)]((_0x464d07,_0x34743e)=>{var _0x2491b6=_0x19a845;_0x1861a5[_0x34743e][_0x2491b6(0x262)]=_0x464d07;}),_0x3e1539[_0x19a845(0x1fd)]((_0x2e1873,_0x48dd1d)=>{_0x1861a5[_0x48dd1d]['expiry_date']=_0x2e1873;}),_0x95ead9[_0x19a845(0x1fd)]((_0x38c231,_0x35083a)=>{var _0x447231=_0x19a845;_0x1861a5[_0x35083a][_0x447231(0x190)]=_0x38c231;}),_0x24b1c2['forEach']((_0x4c7f77,_0x299c9a)=>{var _0x4e0a04=_0x19a845;_0x1861a5[_0x299c9a][_0x4e0a04(0x1f3)]=_0x4c7f77;}),_0x45c6ab[_0x19a845(0x1fd)]((_0x417fd4,_0x52586a)=>{var _0x392427=_0x19a845;_0x1861a5[_0x52586a][_0x392427(0x1b0)]=_0x417fd4;}),_0x3f1e08[_0x19a845(0x1fd)]((_0x55e6fe,_0x3f0de0)=>{var _0x4a8a31=_0x19a845;_0x1861a5[_0x3f0de0][_0x4a8a31(0x22d)]=_0x55e6fe;});const _0x274f08=new invoice_for_incoming();await _0x274f08['save']();for(let _0x13b1cf=0x0;_0x13b1cf<=_0x5590f1[_0x19a845(0x276)]-0x1;_0x13b1cf++){_0x1861a5[_0x13b1cf][_0x19a845(0x225)]=_0x19a845(0x2a1)+_0x274f08[_0x19a845(0x1d7)]['toString']()[_0x19a845(0x180)](0x8,'0');}const _0xd3749b=await warehouse_validation_setup[_0x19a845(0x1a2)]([{'$match':{'warehouse_name':_0x552c77}}]);for(let _0x7eda9e=0x0;_0x7eda9e<=_0xd3749b[_0x19a845(0x276)]-0x1;_0x7eda9e++){const _0x4c5264=_0xd3749b[_0x7eda9e];for(let _0x24adc8=0x0;_0x24adc8<=_0x4c5264[_0x19a845(0x202)][_0x19a845(0x276)]-0x1;_0x24adc8++){const _0x179ae1=_0x4c5264[_0x19a845(0x202)][_0x24adc8],_0x47b84c=await warehouse[_0x19a845(0x1a2)]([{'$match':{'name':_0x4c5264['warehouse_name'],'room':_0x4c5264['room']}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x179ae1[_0x19a845(0x287)],'product_details.bay':parseInt(_0x179ae1['bin']),'product_details.product_code':_0x179ae1[_0x19a845(0x1a1)]}}]);for(let _0x1dd858=0x0;_0x1dd858<=_0x47b84c[_0x19a845(0x276)]-0x1;_0x1dd858++){let _0x4d2d6a=_0x47b84c[_0x1dd858],_0x3ed99b=0x0;_0x4d2d6a[_0x19a845(0x1bb)][_0x19a845(0x1a1)]==_0x179ae1[_0x19a845(0x1a1)]&&_0x4d2d6a[_0x19a845(0x1bb)][_0x19a845(0x287)]==_0x179ae1[_0x19a845(0x1f9)]&&_0x4d2d6a[_0x19a845(0x1bb)][_0x19a845(0x29a)]==_0x179ae1['bay']&&(_0x179ae1[_0x19a845(0x18c)]=parseInt(_0x179ae1['max'])-parseInt(_0x4d2d6a[_0x19a845(0x1bb)][_0x19a845(0x1c0)]),_0x3ed99b++),_0x3ed99b=='0'&&(parseInt(_0x179ae1[_0x19a845(0x18c)])>0x0&&(_0xd3749b[_0x7eda9e][_0x19a845(0x202)]=_0xd3749b[_0x7eda9e][_0x19a845(0x202)][_0x19a845(0x1ce)]({'bay':_0x179ae1[_0x19a845(0x287)],'bin':_0x179ae1[_0x19a845(0x1f9)],'max':_0x179ae1[_0x19a845(0x18c)],'min':_0x179ae1['min'],'product_code':_0x179ae1[_0x19a845(0x1a1)],'product_id':_0x179ae1[_0x19a845(0x1b3)],'product_name':_0x179ae1[_0x19a845(0x1b1)]})));}}_0xd3749b[_0x7eda9e][_0x19a845(0x202)]=_0xd3749b[_0x7eda9e][_0x19a845(0x202)][_0x19a845(0x187)](_0x22ef00=>parseInt(_0x22ef00[_0x19a845(0x18c)])>0x0);}for(let _0x2e4428=0x0;_0x2e4428<=_0xd3749b[_0x19a845(0x276)]-0x1;_0x2e4428++){const _0x3daa81=_0xd3749b[_0x2e4428];for(let _0x347d47=0x0;_0x347d47<=_0x3daa81[_0x19a845(0x202)]['length']-0x1;_0x347d47++){const _0x55c78f=_0x3daa81['product_data'][_0x347d47],_0xdc34f3=await warehouse_temporary['aggregate']([{'$match':{'warehouse':_0x3daa81[_0x19a845(0x18a)],'room_name':_0x3daa81[_0x19a845(0x272)],'isConfirm':'false','data_type':_0x19a845(0x21a),'product_code':_0x55c78f[_0x19a845(0x1a1)],'level':_0x55c78f[_0x19a845(0x287)],'bay':parseInt(_0x55c78f[_0x19a845(0x1f9)])}}]);for(let _0x533e9b=0x0;_0x533e9b<=_0xdc34f3[_0x19a845(0x276)]-0x1;_0x533e9b++){let _0x1257ad=_0xdc34f3[_0x533e9b];console[_0x19a845(0x183)](_0x1257ad);let _0x41b50a=0x0;_0x1257ad[_0x19a845(0x1a1)]==_0x55c78f[_0x19a845(0x1a1)]&&_0x1257ad[_0x19a845(0x287)]==_0x55c78f['bin']&&_0x1257ad[_0x19a845(0x29a)]==_0x55c78f[_0x19a845(0x287)]&&(_0x55c78f[_0x19a845(0x18c)]=parseInt(_0x55c78f['max'])-parseInt(_0x1257ad[_0x19a845(0x1c0)]),_0x41b50a++),_0x41b50a=='0'&&(parseInt(_0x55c78f[_0x19a845(0x18c)])>0x0&&(_0xd3749b[_0x2e4428][_0x19a845(0x202)]=_0xd3749b[_0x2e4428][_0x19a845(0x202)][_0x19a845(0x1ce)]({'bay':_0x55c78f['bay'],'bin':_0x55c78f[_0x19a845(0x1f9)],'max':_0x55c78f['max'],'min':_0x55c78f[_0x19a845(0x19e)],'product_code':_0x55c78f[_0x19a845(0x1a1)],'product_id':_0x55c78f['product_id'],'product_name':_0x55c78f[_0x19a845(0x1b1)]})));}}_0xd3749b[_0x2e4428][_0x19a845(0x202)]=_0xd3749b[_0x2e4428]['product_data'][_0x19a845(0x187)](_0x4b425e=>parseInt(_0x4b425e['max'])>0x0);}let _0x283fcb=[],_0x4fd063=0x0;for(let _0x204e9c=0x0;_0x204e9c<=_0x1861a5[_0x19a845(0x276)]-0x1;_0x204e9c++){const _0x2f8b14=_0x1861a5[_0x204e9c];let _0x54d4f9=_0x2f8b14['quantity'];for(let _0xa96257=0x0;_0xa96257<=_0xd3749b[_0x19a845(0x276)]-0x1;_0xa96257++){const _0x169271=_0xd3749b[_0xa96257];for(let _0x5bc0b6=0x0;_0x5bc0b6<=_0x169271[_0x19a845(0x202)]['length']-0x1;_0x5bc0b6++){const _0x117087=_0x169271[_0x19a845(0x202)][_0x5bc0b6];if(_0x117087['product_code']===_0x2f8b14[_0x19a845(0x1a1)]){const _0x6f087c=await warehouse['aggregate']([{'$match':{'name':_0x552c77,'room':_0x169271[_0x19a845(0x272)]}},{'$unwind':_0x19a845(0x18b)},{'$match':{'product_details.level':_0x117087[_0x19a845(0x287)],'product_details.bay':parseInt(_0x117087[_0x19a845(0x1f9)])}}]);if(_0x6f087c[_0x19a845(0x276)]==0x0){for(let _0x25420e=0x0;_0x25420e<=_0x169271[_0x19a845(0x202)]['length']-0x1&&_0x54d4f9>0x0;_0x25420e++){const _0x5b0f46=_0x169271[_0x19a845(0x202)][_0x25420e];console[_0x19a845(0x183)](_0x2f8b14['product_code']+_0x19a845(0x28b)+_0x5b0f46[_0x19a845(0x1a1)]+_0x19a845(0x258)+_0x5b0f46[_0x19a845(0x19e)]+'\x20<>\x20'+_0x5b0f46[_0x19a845(0x18c)]+_0x19a845(0x258)+_0x5b0f46[_0x19a845(0x287)]+_0x19a845(0x258)+_0x5b0f46[_0x19a845(0x1f9)]);if(_0x2f8b14[_0x19a845(0x1a1)]===_0x5b0f46['product_code']){_0x283fcb[_0x4fd063]={};const _0x4f2843=parseInt(_0x5b0f46['max']),_0x1b3c85=0x0;let _0x2a22d6=_0x4f2843-_0x1b3c85,_0x52d639=Math['min'](_0x54d4f9,_0x2a22d6);console['log'](_0x19a845(0x1c3)+_0x52d639+_0x19a845(0x1bc)+_0x2f8b14[_0x19a845(0x1b1)]+'\x20to\x20warehouse:\x20'+_0x169271['warehouse_name']+_0x19a845(0x268)+_0x169271[_0x19a845(0x272)]+_0x19a845(0x197)+_0x5b0f46[_0x19a845(0x287)]+_0x19a845(0x27e)+_0x5b0f46[_0x19a845(0x1f9)]+_0x19a845(0x274)+_0x4fd063),_0x283fcb[_0x4fd063]['product_name']=_0x2f8b14[_0x19a845(0x1b1)],_0x283fcb[_0x4fd063]['product_code']=_0x2f8b14[_0x19a845(0x1a1)],_0x283fcb[_0x4fd063][_0x19a845(0x1b3)]=_0x2f8b14['product_id'],_0x283fcb[_0x4fd063]['date_recieved']=_0x2f8b14[_0x19a845(0x20d)],_0x283fcb[_0x4fd063][_0x19a845(0x259)]=_0x2f8b14[_0x19a845(0x259)],_0x283fcb[_0x4fd063][_0x19a845(0x246)]=_0x2f8b14[_0x19a845(0x246)],_0x283fcb[_0x4fd063]['quantity']=_0x52d639,_0x283fcb[_0x4fd063][_0x19a845(0x20a)]=_0x2f8b14['standard_unit'],_0x283fcb[_0x4fd063][_0x19a845(0x17f)]=_0x2f8b14['secondary_unit'],_0x283fcb[_0x4fd063][_0x19a845(0x29c)]=_0x2f8b14['primary_code'],_0x283fcb[_0x4fd063][_0x19a845(0x2aa)]=_0x2f8b14['secondary_code'],_0x283fcb[_0x4fd063]['maxStocks']=_0x2f8b14[_0x19a845(0x29f)],_0x283fcb[_0x4fd063][_0x19a845(0x262)]=_0x2f8b14[_0x19a845(0x262)],_0x283fcb[_0x4fd063]['expiry_date']=_0x2f8b14[_0x19a845(0x1fc)],_0x283fcb[_0x4fd063][_0x19a845(0x190)]=_0x2f8b14[_0x19a845(0x190)],_0x283fcb[_0x4fd063][_0x19a845(0x1f3)]=_0x2f8b14[_0x19a845(0x1f3)],_0x283fcb[_0x4fd063][_0x19a845(0x1b0)]=_0x2f8b14[_0x19a845(0x1b0)],_0x283fcb[_0x4fd063][_0x19a845(0x225)]=_0x2f8b14['invoice'],_0x283fcb[_0x4fd063]['gross_price']=_0x2f8b14[_0x19a845(0x22d)],_0x283fcb[_0x4fd063][_0x19a845(0x26e)]=_0x169271[_0x19a845(0x272)],_0x283fcb[_0x4fd063][_0x19a845(0x29a)]=_0x5b0f46['bay'],_0x283fcb[_0x4fd063][_0x19a845(0x287)]=_0x5b0f46[_0x19a845(0x1f9)],_0x54d4f9-=_0x52d639,_0x4fd063++;if(_0x54d4f9<=0x0)break;}}if(_0x54d4f9<=0x0){_0x559992['flash'](_0x19a845(0x2a5),'The\x20Other\x20'+_0x54d4f9+_0x19a845(0x292));break;}if(_0x54d4f9>0x0){console[_0x19a845(0x183)](_0x19a845(0x25f)+_0x54d4f9+_0x19a845(0x22c));break;}}}}}if(_0x54d4f9>0x0){const _0x30c13b=await warehouse['aggregate']([{'$match':{'name':_0x552c77,'isStaging':_0x19a845(0x24f)}}]);_0x283fcb[_0x4fd063]={},_0x283fcb[_0x4fd063][_0x19a845(0x1b1)]=_0x2f8b14[_0x19a845(0x1b1)],_0x283fcb[_0x4fd063]['product_code']=_0x2f8b14[_0x19a845(0x1a1)],_0x283fcb[_0x4fd063][_0x19a845(0x1b3)]=_0x2f8b14[_0x19a845(0x1b3)],_0x283fcb[_0x4fd063][_0x19a845(0x20d)]=_0x2f8b14[_0x19a845(0x20d)],_0x283fcb[_0x4fd063][_0x19a845(0x259)]=_0x2f8b14[_0x19a845(0x259)],_0x283fcb[_0x4fd063][_0x19a845(0x246)]=_0x2f8b14['uuid'],_0x283fcb[_0x4fd063][_0x19a845(0x1be)]=_0x54d4f9,_0x283fcb[_0x4fd063][_0x19a845(0x20a)]=_0x2f8b14[_0x19a845(0x20a)],_0x283fcb[_0x4fd063][_0x19a845(0x17f)]=_0x2f8b14[_0x19a845(0x17f)],_0x283fcb[_0x4fd063][_0x19a845(0x29c)]=_0x2f8b14[_0x19a845(0x29c)],_0x283fcb[_0x4fd063][_0x19a845(0x2aa)]=_0x2f8b14[_0x19a845(0x2aa)],_0x283fcb[_0x4fd063][_0x19a845(0x29f)]=_0x2f8b14[_0x19a845(0x29f)],_0x283fcb[_0x4fd063]['batch_code']=_0x2f8b14['batch_code'],_0x283fcb[_0x4fd063][_0x19a845(0x1fc)]=_0x2f8b14[_0x19a845(0x1fc)],_0x283fcb[_0x4fd063]['production_date']=_0x2f8b14['production_date'],_0x283fcb[_0x4fd063][_0x19a845(0x1f3)]=_0x2f8b14[_0x19a845(0x1f3)],_0x283fcb[_0x4fd063]['product_cat']=_0x2f8b14[_0x19a845(0x1b0)],_0x283fcb[_0x4fd063][_0x19a845(0x225)]=_0x2f8b14['invoice'],_0x283fcb[_0x4fd063][_0x19a845(0x22d)]=_0x2f8b14['gross_price'],_0x283fcb[_0x4fd063]['room_name']=_0x30c13b[0x0][_0x19a845(0x272)],_0x283fcb[_0x4fd063][_0x19a845(0x29a)]=_0x19a845(0x2a6),_0x283fcb[_0x4fd063]['bay']='1',console[_0x19a845(0x183)](_0x19a845(0x1f1)+_0x19a845(0x258)+_0x2f8b14[_0x19a845(0x1a1)]+'\x20===\x20'+_0x2f8b14[_0x19a845(0x1a1)]+_0x19a845(0x258)+_0x4fd063+_0x19a845(0x258)+_0x54d4f9),_0x559992['flash'](_0x19a845(0x2a5),_0x19a845(0x188)+_0x54d4f9+'\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area');}}const _0x2e0ace=_0x283fcb[_0x19a845(0x187)](_0x5f38fc=>_0x5f38fc[_0x19a845(0x1be)]!=='0'&&_0x5f38fc[_0x19a845(0x1be)]!==''),_0x299d6b=new purchases_finished({'invoice':_0x19a845(0x2a1)+_0x274f08[_0x19a845(0x1d7)][_0x19a845(0x1a4)]()[_0x19a845(0x180)](0x8,'0'),'suppliers':_0xe731ea,'date':_0x284057,'warehouse_name':_0x552c77,'product':_0x2e0ace,'note':_0x51f67b,'due_amount':_0xc44613,'room':_0x43d98a,'POnumber':_0x4d8714,'SCRN':_0x245e3a,'JO_number':_0x800536,'ReqBy':_0x57d6c5,'dateofreq':_0x38b3a6,'typeservicesData':_0x2b9c79,'van':_0x2f88ff,'typevehicle':_0x2139df,'driver':_0x13c6bd,'plate':_0x5ef9cc,'DRSI':_0x261862,'TSU':_0x21cc35,'TFU':_0x1b6713,'typeOfProducts':_0x167fbb}),_0x4d04d2=await _0x299d6b[_0x19a845(0x238)](),_0x2a35cd=await purchases_finished[_0x19a845(0x1d9)]({'_id':_0x4d04d2[_0x19a845(0x1a6)][_0x19a845(0x299)]()});_0x559992[_0x19a845(0x1f0)](_0x19a845(0x244),_0x19a845(0x251)),_0x516358['redirect'](_0x19a845(0x2a0)+_0x2a35cd[_0x19a845(0x1a6)][_0x19a845(0x299)]());}catch(_0x34d1b0){console[_0x19a845(0x183)](_0x34d1b0);}}),router[a0_0x487e73(0x288)]('/process/:id',auth,async(_0x1297eb,_0x7e2559)=>{var _0x1498cd=a0_0x487e73;try{const {username:_0x37d93d,email:_0x16c7a1,role:_0x2c1a29}=_0x1297eb['user'],_0xc13551=_0x1297eb[_0x1498cd(0x1e7)],_0x1818da=_0x1297eb['params']['id'],_0x54cf1a=await profile[_0x1498cd(0x1d9)]({'email':_0xc13551[_0x1498cd(0x1a0)]}),_0x3a1089=await master_shop[_0x1498cd(0x1ad)](),_0x30f615=await staff[_0x1498cd(0x1d9)]({'email':_0xc13551[_0x1498cd(0x1a0)]}),_0x4076d6=await suppliers[_0x1498cd(0x1ad)]({});let _0x382de6;if(_0xc13551[_0x1498cd(0x1ab)]==_0x1498cd(0x224)){const _0x1562dd=await staff['findOne']({'email':_0xc13551[_0x1498cd(0x1a0)]});_0x382de6=await warehouse['aggregate']([{'$match':{'status':_0x1498cd(0x21e),'name':_0x1562dd[_0x1498cd(0x232)]}},{'$group':{'_id':_0x1498cd(0x185),'name':{'$first':_0x1498cd(0x185)}}}]);}else _0x382de6=await warehouse[_0x1498cd(0x1a2)]([{'$match':{'status':_0x1498cd(0x21e)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1597b4=await purchases_finished[_0x1498cd(0x206)](_0x1818da);if(_0x3a1089[0x0][_0x1498cd(0x25d)]==_0x1498cd(0x2ad))var _0x2f243c=users[_0x1498cd(0x23c)];else{if(_0x3a1089[0x0][_0x1498cd(0x25d)]==_0x1498cd(0x198))var _0x2f243c=users['Hindi'];else{if(_0x3a1089[0x0]['language']==_0x1498cd(0x241))var _0x2f243c=users[_0x1498cd(0x241)];else{if(_0x3a1089[0x0][_0x1498cd(0x25d)]==_0x1498cd(0x1ea))var _0x2f243c=users[_0x1498cd(0x1ea)];else{if(_0x3a1089[0x0][_0x1498cd(0x25d)]==_0x1498cd(0x19c))var _0x2f243c=users[_0x1498cd(0x19c)];else{if(_0x3a1089[0x0][_0x1498cd(0x25d)]=='Portuguese\x20(BR)')var _0x2f243c=users['Portuguese'];else{if(_0x3a1089[0x0]['language']==_0x1498cd(0x1de))var _0x2f243c=users['Chinese'];else{if(_0x3a1089[0x0][_0x1498cd(0x25d)]==_0x1498cd(0x1a5))var _0x2f243c=users['Arabic'];}}}}}}}_0x7e2559['render'](_0x1498cd(0x212),{'success':_0x1297eb['flash'](_0x1498cd(0x244)),'errors':_0x1297eb[_0x1498cd(0x1f0)]('errors'),'role':_0xc13551,'profile':_0x54cf1a,'suppliers':_0x4076d6,'warehouse':_0x382de6,'master_shop':_0x3a1089,'language':_0x2f243c,'purchases_data':_0x1597b4});}catch(_0x281850){console['log'](_0x281850);}});async function get_warehouse_data(_0x26727a,_0x57e160){var _0x9c3800=a0_0x487e73;try{const _0x7bbaab=await warehouse_temporary['findOne']({'name':_0x26727a,'room':_0x57e160});if(!_0x7bbaab){const _0x5a1d96=new warehouse_temporary({'name':_0x26727a,'address':_0x26727a,'status':_0x9c3800(0x21e),'room':_0x57e160,'isStaging':_0x9c3800(0x1cf)});return await _0x5a1d96[_0x9c3800(0x238)](),_0x5a1d96;}else return _0x7bbaab;}catch(_0x4d29a2){console['error'](_0x9c3800(0x214),_0x4d29a2);throw _0x4d29a2;}}router[a0_0x487e73(0x203)]('/process/:id',auth,async(_0x5cde98,_0x338d8c)=>{var _0x5eed8a=a0_0x487e73;try{const _0x21fb12=_0x5cde98['params']['id'],_0x1d02d7=await purchases_finished[_0x5eed8a(0x206)](_0x21fb12);let _0x4826db=[];_0x1d02d7[_0x5eed8a(0x1ac)]['forEach']((_0x59cccb,_0x38fac0)=>{var _0x513de6=_0x5eed8a;_0x4826db[_0x38fac0]={},_0x4826db[_0x38fac0][_0x513de6(0x232)]=_0x1d02d7[_0x513de6(0x18a)],_0x4826db[_0x38fac0][_0x513de6(0x1b3)]=_0x59cccb[_0x513de6(0x1b3)],_0x4826db[_0x38fac0]['product_name']=_0x59cccb[_0x513de6(0x1b1)],_0x4826db[_0x38fac0][_0x513de6(0x1a1)]=_0x59cccb['product_code'],_0x4826db[_0x38fac0]['product_stock']=_0x59cccb['quantity'],_0x4826db[_0x38fac0][_0x513de6(0x186)]=_0x59cccb[_0x513de6(0x20a)],_0x4826db[_0x38fac0][_0x513de6(0x17f)]=_0x59cccb[_0x513de6(0x17f)],_0x4826db[_0x38fac0][_0x513de6(0x29a)]=_0x59cccb[_0x513de6(0x29a)],_0x4826db[_0x38fac0]['bay']=_0x59cccb['bay'],_0x4826db[_0x38fac0]['primary_code']=_0x59cccb[_0x513de6(0x29c)],_0x4826db[_0x38fac0][_0x513de6(0x2aa)]=_0x59cccb[_0x513de6(0x2aa)],_0x4826db[_0x38fac0][_0x513de6(0x29f)]=_0x59cccb[_0x513de6(0x29f)],_0x4826db[_0x38fac0][_0x513de6(0x262)]=_0x59cccb[_0x513de6(0x262)],_0x4826db[_0x38fac0][_0x513de6(0x1fc)]=_0x59cccb[_0x513de6(0x1fc)],_0x4826db[_0x38fac0][_0x513de6(0x190)]=_0x59cccb[_0x513de6(0x190)],_0x4826db[_0x38fac0][_0x513de6(0x1f3)]=_0x59cccb[_0x513de6(0x1f3)],_0x4826db[_0x38fac0]['product_cat']=_0x59cccb['product_cat'],_0x4826db[_0x38fac0][_0x513de6(0x26e)]=_0x59cccb[_0x513de6(0x26e)],_0x4826db[_0x38fac0][_0x513de6(0x225)]=_0x59cccb['invoice'],_0x4826db[_0x38fac0][_0x513de6(0x246)]=_0x59cccb[_0x513de6(0x246)],_0x4826db[_0x38fac0][_0x513de6(0x22d)]=_0x59cccb[_0x513de6(0x22d)],_0x4826db[_0x38fac0][_0x513de6(0x259)]=_0x59cccb[_0x513de6(0x259)],_0x4826db[_0x38fac0][_0x513de6(0x20d)]=_0x59cccb[_0x513de6(0x20d)],_0x4826db[_0x38fac0][_0x513de6(0x2b0)]=_0x59cccb[_0x513de6(0x1a6)]['valueOf'](),_0x4826db[_0x38fac0][_0x513de6(0x297)]='inc',_0x4826db[_0x38fac0]['isAvailable']='true',_0x4826db[_0x38fac0][_0x513de6(0x20b)]='false';});for(let _0xe26d49=0x0;_0xe26d49<=_0x4826db[_0x5eed8a(0x276)]-0x1;_0xe26d49++){const _0xea7598=_0x4826db[_0xe26d49],_0x3e1b3b=new warehouse_temporary(_0xea7598);await _0x3e1b3b['save']();}_0x1d02d7[_0x5eed8a(0x290)]=_0x5eed8a(0x24f),await _0x1d02d7[_0x5eed8a(0x238)](),_0x5cde98[_0x5eed8a(0x1f0)](_0x5eed8a(0x244),_0x5eed8a(0x2ac)),_0x338d8c[_0x5eed8a(0x1e4)](_0x5eed8a(0x2a0)+_0x1d02d7[_0x5eed8a(0x1a6)][_0x5eed8a(0x299)]());}catch(_0x13b260){}}),router['post']('/view/add_purchases_logs',auth,async(_0x54f1fd,_0x2e5c34)=>{var _0x4ff0ff=a0_0x487e73;try{const {invoice:_0x4b9f5b,date:_0x40e15c,warehouse_name:_0x30846d,prod_name:_0x3beecc,note:_0xf0d479,due_amount:_0x356632,Room_name:_0x1f0051,PO_number:_0x28d886,SCRN:_0x564f0d,ReqBy:_0x5afe99,dateofreq:_0x3b3364,suppliers:_0x41d587,typeservicesData:_0x203317,van:_0x31db1b,typevehicle:_0x128cbc,driver:_0xfb6cfd,plate:_0x139132,DRSI:_0x230ffb,TSU:_0x4859ed,TFU:_0x1d5cc7,JO_number:_0x93e6e8,type_of_products:_0x1b18a0}=_0x54f1fd['body'];if(typeof _0x3beecc=='string')var _0x2ff990=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x1fb)]],_0x2f823c=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x219)]],_0x37cfbb=[_0x54f1fd[_0x4ff0ff(0x178)]['prod_Qty']],_0x2d812d=[_0x54f1fd['body']['prod_primunit']],_0x29e37c=[_0x54f1fd['body'][_0x4ff0ff(0x233)]],_0x57164d=[_0x54f1fd['body'][_0x4ff0ff(0x294)]],_0x46b98d=[_0x54f1fd['body'][_0x4ff0ff(0x29c)]],_0x5c097b=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x2aa)]],_0x201320=[_0x54f1fd[_0x4ff0ff(0x178)]['MaxStocks_data']],_0x1240a6=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x262)]],_0x70eb1c=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x1fc)]],_0x13a04d=[_0x54f1fd['body'][_0x4ff0ff(0x191)]],_0x205cbd=[_0x54f1fd['body'][_0x4ff0ff(0x174)]],_0x5b23f3=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x19d)]],_0x2cf28b=[_0x54f1fd[_0x4ff0ff(0x178)]['RoomAssign']],_0xe2b1bb=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x22d)]],_0x10be83=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x246)]],_0x449578=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x1b2)]],_0xe08cf=[_0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x182)]];else var _0x2ff990=[..._0x54f1fd['body'][_0x4ff0ff(0x1fb)]],_0x2f823c=[..._0x54f1fd[_0x4ff0ff(0x178)]['prod_code']],_0x37cfbb=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x261)]],_0x2d812d=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x284)]],_0x29e37c=[..._0x54f1fd['body'][_0x4ff0ff(0x233)]],_0x57164d=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x294)]],_0x46b98d=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x29c)]],_0x5c097b=[..._0x54f1fd[_0x4ff0ff(0x178)]['secondary_code']],_0x201320=[..._0x54f1fd[_0x4ff0ff(0x178)]['MaxStocks_data']],_0x1240a6=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x262)]],_0x70eb1c=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x1fc)]],_0x13a04d=[..._0x54f1fd[_0x4ff0ff(0x178)]['product_date']],_0x205cbd=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x174)]],_0x5b23f3=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x19d)]],_0x2cf28b=[..._0x54f1fd['body'][_0x4ff0ff(0x1c6)]],_0xe2b1bb=[..._0x54f1fd[_0x4ff0ff(0x178)]['gross_price']],_0x10be83=[..._0x54f1fd['body'][_0x4ff0ff(0x246)]],_0x449578=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x1b2)]],_0xe08cf=[..._0x54f1fd[_0x4ff0ff(0x178)][_0x4ff0ff(0x182)]];const _0x33586c=_0x2ff990[_0x4ff0ff(0x204)](_0x10589d=>{return _0x10589d={'product_name':_0x10589d};});_0xe08cf['forEach']((_0x9eb2d3,_0x22d8da)=>{_0x33586c[_0x22d8da]['type_of_products']=_0x9eb2d3;}),_0x449578[_0x4ff0ff(0x1fd)]((_0x3aa5b9,_0x9b7b80)=>{_0x33586c[_0x9b7b80]['sales_category']=_0x3aa5b9;}),_0x2f823c[_0x4ff0ff(0x1fd)]((_0x23813f,_0x4d9dcf)=>{_0x33586c[_0x4d9dcf]['product_code']=_0x23813f;}),_0x10be83['forEach']((_0x5b1c63,_0x155ab4)=>{var _0x18d25d=_0x4ff0ff;_0x33586c[_0x155ab4][_0x18d25d(0x246)]=_0x5b1c63;}),_0x37cfbb[_0x4ff0ff(0x1fd)]((_0xe73e80,_0x29c547)=>{_0x33586c[_0x29c547]['quantity']=Math['abs'](_0xe73e80);}),_0x2d812d['forEach']((_0xd716c8,_0xb0fc8e)=>{_0x33586c[_0xb0fc8e]['standard_unit']=_0xd716c8;}),_0x29e37c[_0x4ff0ff(0x1fd)]((_0x1b89ae,_0x180843)=>{var _0x409ae5=_0x4ff0ff;_0x33586c[_0x180843][_0x409ae5(0x17f)]=_0x1b89ae;}),_0x57164d['forEach']((_0x5a37d6,_0x18ccd7)=>{var _0x31b83b=_0x4ff0ff,_0x37f9b2=_0x5a37d6[_0x31b83b(0x1e2)](/[A-Za-z]+/)[0x0],_0x5222b0=parseInt(_0x5a37d6[_0x31b83b(0x1e2)](/\d+/)[0x0]);_0x33586c[_0x18ccd7][_0x31b83b(0x29a)]=_0x37f9b2,_0x33586c[_0x18ccd7][_0x31b83b(0x287)]=_0x5222b0;}),_0x46b98d['forEach']((_0x418bad,_0x143d86)=>{var _0x6ab68=_0x4ff0ff;_0x33586c[_0x143d86][_0x6ab68(0x29c)]=_0x418bad;}),_0x5c097b['forEach']((_0x235275,_0x4f43e5)=>{var _0x205ad0=_0x4ff0ff;_0x33586c[_0x4f43e5][_0x205ad0(0x2aa)]=_0x235275;}),_0x201320[_0x4ff0ff(0x1fd)]((_0x15bc59,_0x3ae26d)=>{var _0x4b30a9=_0x4ff0ff;_0x33586c[_0x3ae26d][_0x4b30a9(0x29f)]=_0x15bc59;}),_0x1240a6['forEach']((_0x30bccf,_0x596091)=>{var _0xb8a5c0=_0x4ff0ff;_0x33586c[_0x596091][_0xb8a5c0(0x262)]=_0x30bccf;}),_0x70eb1c['forEach']((_0x17edce,_0x130fee)=>{var _0x4b7020=_0x4ff0ff;_0x33586c[_0x130fee][_0x4b7020(0x1fc)]=_0x17edce;}),_0x13a04d[_0x4ff0ff(0x1fd)]((_0x2895ec,_0x432c7b)=>{var _0x6f92fa=_0x4ff0ff;_0x33586c[_0x432c7b][_0x6f92fa(0x190)]=_0x2895ec;}),_0x205cbd['forEach']((_0x2016df,_0x39588e)=>{var _0x31a9e5=_0x4ff0ff;_0x33586c[_0x39588e][_0x31a9e5(0x1f3)]=_0x2016df;}),_0x5b23f3['forEach']((_0x7a4043,_0x172fcd)=>{var _0x1d8e95=_0x4ff0ff;_0x33586c[_0x172fcd][_0x1d8e95(0x1b0)]=_0x7a4043;}),_0x2cf28b['forEach']((_0x3bbce6,_0xf67577)=>{var _0x1ee656=_0x4ff0ff;_0x33586c[_0xf67577][_0x1ee656(0x26e)]=_0x3bbce6;}),_0xe2b1bb[_0x4ff0ff(0x1fd)]((_0x3d69b7,_0x57d001)=>{_0x33586c[_0x57d001]['gross_price']=_0x3d69b7;});const _0x1575c6=new purchases_logs();await _0x1575c6[_0x4ff0ff(0x238)]();for(let _0x1880f4=0x0;_0x1880f4<=_0x2cf28b[_0x4ff0ff(0x276)]-0x1;_0x1880f4++){_0x33586c[_0x1880f4][_0x4ff0ff(0x225)]='LOG-INC-'+_0x1575c6[_0x4ff0ff(0x1d7)][_0x4ff0ff(0x1a4)]()[_0x4ff0ff(0x180)](0x8,'0');}const _0x1c5162=_0x33586c['filter'](_0x5538f0=>_0x5538f0[_0x4ff0ff(0x1be)]!=='0'&&_0x5538f0[_0x4ff0ff(0x1be)]!==''),_0x37d7ac=new purchases_finished({'invoice':_0x4ff0ff(0x2b5)+_0x1575c6[_0x4ff0ff(0x1d7)][_0x4ff0ff(0x1a4)]()[_0x4ff0ff(0x180)](0x8,'0'),'suppliers':_0x41d587,'date':_0x40e15c,'warehouse_name':_0x30846d,'product':_0x1c5162,'note':_0xf0d479,'due_amount':_0x356632,'room':_0x1f0051,'POnumber':_0x28d886,'SCRN':_0x564f0d,'JO_number':_0x93e6e8,'ReqBy':_0x5afe99,'dateofreq':_0x3b3364,'typeservicesData':_0x203317,'van':_0x31db1b,'typevehicle':_0x128cbc,'driver':_0xfb6cfd,'plate':_0x139132,'DRSI':_0x230ffb,'TSU':_0x4859ed,'TFU':_0x1d5cc7,'typeOfProducts':_0x1b18a0}),_0x266677=await _0x37d7ac[_0x4ff0ff(0x238)](),_0x5cd35b=await purchases_finished[_0x4ff0ff(0x1d9)]({'_id':_0x266677[_0x4ff0ff(0x1a6)][_0x4ff0ff(0x299)]()}),_0xdea8b7=_0x5cd35b['product']['map'](async _0x12173f=>{var _0x5108ac=_0x4ff0ff;try{var _0x3acf17=await warehouse[_0x5108ac(0x1d9)]({'name':_0x30846d,'room':_0x12173f[_0x5108ac(0x26e)]}),_0x1025bf=0x0;const _0x425392=_0x3acf17[_0x5108ac(0x1bb)][_0x5108ac(0x204)](_0x302011=>{var _0x3f3f13=_0x5108ac;console['log'](_0x302011['product_name']+'=='+_0x12173f[_0x3f3f13(0x1b1)]+'&&'+_0x302011[_0x3f3f13(0x287)]+'=='+_0x12173f[_0x3f3f13(0x287)]+'&&'+_0x302011[_0x3f3f13(0x1fc)]+'=='+_0x12173f[_0x3f3f13(0x1fc)]+'&&'+_0x302011[_0x3f3f13(0x190)]+'=='+_0x12173f['production_date']+'&&'+_0x302011[_0x3f3f13(0x262)]+'=='+_0x12173f[_0x3f3f13(0x262)]+'&&'+_0x302011['invoice']+'=='+_0x5cd35b[_0x3f3f13(0x225)]),_0x302011[_0x3f3f13(0x1b1)]==_0x12173f['product_name']&&_0x302011[_0x3f3f13(0x287)]==_0x12173f['bay']&&_0x302011[_0x3f3f13(0x29a)]==_0x12173f[_0x3f3f13(0x29a)]&&_0x302011[_0x3f3f13(0x1fc)]==_0x12173f[_0x3f3f13(0x1fc)]&&_0x302011[_0x3f3f13(0x190)]==_0x12173f[_0x3f3f13(0x190)]&&_0x302011[_0x3f3f13(0x262)]==_0x12173f[_0x3f3f13(0x262)]&&_0x302011[_0x3f3f13(0x225)]==_0x5cd35b[_0x3f3f13(0x225)]&&(_0x302011[_0x3f3f13(0x1c0)]=Math[_0x3f3f13(0x205)](_0x302011['product_stock'])+Math['abs'](_0x12173f[_0x3f3f13(0x1be)]),_0x1025bf++);});return _0x1025bf==0x0&&(_0x3acf17['product_details']=_0x3acf17[_0x5108ac(0x1bb)][_0x5108ac(0x1ce)]({'product_name':_0x12173f['product_name'],'product_stock':Math[_0x5108ac(0x205)](_0x12173f[_0x5108ac(0x1be)]),'primary_code':_0x12173f[_0x5108ac(0x29c)],'secondary_code':_0x12173f['secondary_code'],'product_code':_0x12173f['product_code'],'bay':_0x12173f['bay'],'level':_0x12173f[_0x5108ac(0x29a)],'maxProducts':_0x12173f['maxStocks'],'unit':_0x12173f['standard_unit'],'secondary_unit':_0x12173f['secondary_unit'],'expiry_date':_0x12173f['expiry_date'],'production_date':_0x12173f[_0x5108ac(0x190)],'maxProducts':_0x12173f[_0x5108ac(0x29f)],'maxPerUnit':_0x12173f[_0x5108ac(0x1f3)],'batch_code':_0x12173f[_0x5108ac(0x262)],'product_cat':_0x12173f[_0x5108ac(0x1b0)],'invoice':_0x12173f['invoice'],'id_incoming':_0x12173f[_0x5108ac(0x1a6)],'uuid':_0x12173f['uuid'],'gross_price':_0x12173f['gross_price'],'sales_category':_0x12173f[_0x5108ac(0x259)],'type_products':_0x12173f['type_of_products']})),_0x3acf17;}catch(_0x4e9372){return console[_0x5108ac(0x243)]('Error\x20occurred\x20while\x20processing\x20product:',_0x4e9372),null;}});Promise['all'](_0xdea8b7)[_0x4ff0ff(0x1ff)](async _0x48aa8b=>{var _0x166bed=_0x4ff0ff;try{for(const _0x521f09 of _0x48aa8b){await warehouse[_0x166bed(0x1f6)]({'_id':_0x521f09[_0x166bed(0x1a6)]},{'$addToSet':{'product_details':{'$each':_0x521f09[_0x166bed(0x1bb)]}}});}const _0x73c5b0=await master_shop['find'](),_0x16cc41=await email_settings[_0x166bed(0x1d9)](),_0x56ceaf=await supervisor_settings[_0x166bed(0x1ad)]();var _0x22a2cf=_0x5cd35b[_0x166bed(0x1ac)],_0x29e727='',_0x316a80;for(_0x316a80 in _0x22a2cf){var _0x4b8f26='FG';_0x5cd35b[_0x166bed(0x18a)]==_0x166bed(0x29d)&&(_0x4b8f26='DG'),_0x29e727+=_0x166bed(0x264)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22a2cf[_0x316a80][_0x166bed(0x1b1)]+_0x166bed(0x21c)+_0x166bed(0x1ae)+_0x22a2cf[_0x316a80][_0x166bed(0x1a1)]+_0x166bed(0x21c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22a2cf[_0x316a80][_0x166bed(0x1be)]+_0x166bed(0x21c)+_0x166bed(0x1ae)+_0x22a2cf[_0x316a80]['standard_unit']+_0x166bed(0x21c)+_0x166bed(0x1ae)+_0x22a2cf[_0x316a80][_0x166bed(0x17f)]+_0x166bed(0x21c)+_0x166bed(0x1ae)+_0x5cd35b['warehouse_name']+'</td>'+_0x166bed(0x1ae)+_0x22a2cf[_0x316a80][_0x166bed(0x26e)]+_0x166bed(0x21c)+_0x166bed(0x1ae)+_0x4b8f26+_0x22a2cf[_0x316a80][_0x166bed(0x287)]+_0x166bed(0x21c),_0x166bed(0x210);}let _0x1d6b61=nodemailer[_0x166bed(0x1b8)]({'host':_0x16cc41[_0x166bed(0x18d)],'port':Number(_0x16cc41['port']),'secure':![],'auth':{'user':_0x16cc41[_0x166bed(0x1a0)],'pass':_0x16cc41['password']}}),_0x41d8b5={'from':_0x16cc41['email'],'to':_0x56ceaf[0x0][_0x166bed(0x23b)],'subject':_0x166bed(0x2a9),'attachments':[{'filename':_0x166bed(0x216),'path':__dirname+_0x166bed(0x28e)+_0x166bed(0x25c)+_0x73c5b0[0x0][_0x166bed(0x1b7)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x166bed(0x1e8)+_0x166bed(0x1f8)+'<div>'+_0x166bed(0x1a3)+_0x166bed(0x220)+_0x166bed(0x1e3)+_0x166bed(0x2b3)+_0x166bed(0x220)+'<h2>\x20'+_0x73c5b0[0x0][_0x166bed(0x25b)]+_0x166bed(0x1b6)+_0x166bed(0x2b3)+_0x166bed(0x2b3)+_0x166bed(0x1b9)+_0x166bed(0x220)+_0x166bed(0x1c4)+_0x166bed(0x230)+_0x5cd35b[_0x166bed(0x225)]+'\x20'+_0x166bed(0x282)+_0x166bed(0x223)+_0x5cd35b[_0x166bed(0x2b7)]+'\x20'+_0x166bed(0x270)+_0x166bed(0x18f)+_0x166bed(0x2b3)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x166bed(0x193)+_0x166bed(0x264)+_0x166bed(0x22a)+_0x166bed(0x252)+_0x166bed(0x189)+_0x166bed(0x222)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x166bed(0x279)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x166bed(0x210)+_0x166bed(0x226)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x29e727+'\x20'+'</tbody>'+_0x166bed(0x18e)+_0x166bed(0x220)+_0x166bed(0x227)+_0x166bed(0x1cc)+_0x73c5b0[0x0][_0x166bed(0x25b)]+_0x166bed(0x18f)+_0x166bed(0x2b3)+_0x166bed(0x2b3)+'</body></html>'};_0x1d6b61['sendMail'](_0x41d8b5,function(_0xbc2599,_0xaa8f89){var _0x18e4f9=_0x166bed;_0xbc2599?(console[_0x18e4f9(0x183)](_0xbc2599),console['log'](_0x18e4f9(0x2ab))):console[_0x18e4f9(0x183)](_0x18e4f9(0x192));});}catch(_0x262659){console[_0x166bed(0x243)](_0x262659),_0x2e5c34[_0x166bed(0x1fa)](0x1f4)[_0x166bed(0x1a7)]({'error':_0x166bed(0x17b),'message':_0x262659['message']});}})['catch'](_0x413335=>{var _0x5c0062=_0x4ff0ff;console[_0x5c0062(0x243)](_0x413335);}),_0x54f1fd['flash'](_0x4ff0ff(0x244),'purchase\x20data\x20add\x20successfully'),_0x2e5c34['redirect']('/all_purchases_finished/preview/'+_0x5cd35b[_0x4ff0ff(0x1a6)][_0x4ff0ff(0x299)]());}catch(_0x333e92){console['log'](_0x333e92);}}),router[a0_0x487e73(0x288)]('/preview/:id',auth,async(_0x349feb,_0x496b65)=>{var _0x40b0d7=a0_0x487e73;try{const {username:_0x4ebddb,email:_0x105409,role:_0x423894}=_0x349feb[_0x40b0d7(0x1e7)],_0x423d1e=_0x349feb['user'],_0x100e20=await profile[_0x40b0d7(0x1d9)]({'email':_0x423d1e[_0x40b0d7(0x1a0)]}),_0x2ed40a=await master_shop['find'](),_0x10dcb3=_0x349feb['params']['id'],_0x1dbd64=await purchases_finished[_0x40b0d7(0x206)](_0x10dcb3),_0x244ab3=await suppliers[_0x40b0d7(0x1ad)]({});let _0x430041;if(_0x423d1e[_0x40b0d7(0x1ab)]==_0x40b0d7(0x224)){const _0x8767b7=await staff[_0x40b0d7(0x1d9)]({'email':_0x423d1e['email']});_0x430041=await warehouse['find']({'status':_0x40b0d7(0x21e),'name':_0x8767b7[_0x40b0d7(0x232)],'warehouse_category':'Finished\x20Goods'});}else _0x430041=await warehouse[_0x40b0d7(0x1a2)]([{'$match':{'status':_0x40b0d7(0x21e),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x40b0d7(0x185),'name':{'$first':'$name'}}}]);const _0x2305b4=await product[_0x40b0d7(0x1ad)]({}),_0x2f9ed6=BayBinSelected(_0x1dbd64[_0x40b0d7(0x18a)],_0x1dbd64[_0x40b0d7(0x272)]);let _0x220d44=new Date(_0x1dbd64[_0x40b0d7(0x1fc)]),_0x47a3c0=('0'+_0x220d44[_0x40b0d7(0x177)]())[_0x40b0d7(0x19b)](-0x2),_0x3ca095=('0'+(_0x220d44['getMonth']()+0x1))['slice'](-0x2),_0x55f102=_0x220d44[_0x40b0d7(0x26d)](),_0x1c7276=_0x55f102+'-'+_0x3ca095+'-'+_0x47a3c0;if(_0x2ed40a[0x0][_0x40b0d7(0x25d)]==_0x40b0d7(0x2ad)){var _0x165140=users['English'];console[_0x40b0d7(0x183)](_0x165140);}else{if(_0x2ed40a[0x0][_0x40b0d7(0x25d)]=='Hindi')var _0x165140=users[_0x40b0d7(0x198)];else{if(_0x2ed40a[0x0][_0x40b0d7(0x25d)]==_0x40b0d7(0x241))var _0x165140=users[_0x40b0d7(0x241)];else{if(_0x2ed40a[0x0][_0x40b0d7(0x25d)]==_0x40b0d7(0x1ea))var _0x165140=users[_0x40b0d7(0x1ea)];else{if(_0x2ed40a[0x0][_0x40b0d7(0x25d)]==_0x40b0d7(0x19c))var _0x165140=users[_0x40b0d7(0x19c)];else{if(_0x2ed40a[0x0]['language']==_0x40b0d7(0x236))var _0x165140=users[_0x40b0d7(0x179)];else{if(_0x2ed40a[0x0]['language']==_0x40b0d7(0x1de))var _0x165140=users[_0x40b0d7(0x1de)];else{if(_0x2ed40a[0x0][_0x40b0d7(0x25d)]==_0x40b0d7(0x1a5))var _0x165140=users[_0x40b0d7(0x28f)];}}}}}}}_0x496b65[_0x40b0d7(0x1dd)]('edit_purchases_finished_view',{'success':_0x349feb[_0x40b0d7(0x1f0)](_0x40b0d7(0x244)),'errors':_0x349feb[_0x40b0d7(0x1f0)](_0x40b0d7(0x2a5)),'role':_0x423d1e,'profile':_0x100e20,'purchases':_0x1dbd64,'suppliers':_0x244ab3,'warehouse':_0x430041,'product':_0x2305b4,'master_shop':_0x2ed40a,'language':_0x165140,'ed_fullDate':_0x1c7276,'dataSelected':_0x2f9ed6});}catch(_0x4c53c7){console[_0x40b0d7(0x183)](_0x4c53c7);}}),router['get'](a0_0x487e73(0x1d3),auth,async(_0x59e8ed,_0x32ae61)=>{var _0x31c481=a0_0x487e73;try{const {username:_0xffd7cd,email:_0x5e41cd,role:_0x17852d}=_0x59e8ed['user'],_0x4d4fb5=_0x59e8ed[_0x31c481(0x1e7)],_0x5f3ef3=await profile['findOne']({'email':_0x4d4fb5['email']}),_0x37ed6d=await master_shop[_0x31c481(0x1ad)](),_0x65eebf=_0x59e8ed[_0x31c481(0x1c9)]['id'],_0x2f2902=await purchases_finished['findById'](_0x65eebf),_0x27bb72=await suppliers[_0x31c481(0x1ad)]({});let _0x19283b;if(_0x4d4fb5[_0x31c481(0x1ab)]=='staff'){const _0x18bf51=await staff[_0x31c481(0x1d9)]({'email':_0x4d4fb5[_0x31c481(0x1a0)]});_0x19283b=await warehouse[_0x31c481(0x1ad)]({'status':'Enabled','name':_0x18bf51[_0x31c481(0x232)],'warehouse_category':_0x31c481(0x1d6)});}else _0x19283b=await warehouse[_0x31c481(0x1a2)]([{'$match':{'status':_0x31c481(0x21e),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x41a74a=await product[_0x31c481(0x1ad)]({}),_0x1a17f2=BayBinSelected(_0x2f2902[_0x31c481(0x18a)],_0x2f2902[_0x31c481(0x272)]);let _0x7dae79=new Date(_0x2f2902[_0x31c481(0x1fc)]),_0x4aebd8=('0'+_0x7dae79[_0x31c481(0x177)]())[_0x31c481(0x19b)](-0x2),_0x16dd3c=('0'+(_0x7dae79[_0x31c481(0x27b)]()+0x1))[_0x31c481(0x19b)](-0x2),_0x27a32a=_0x7dae79[_0x31c481(0x26d)](),_0x496ebf=_0x27a32a+'-'+_0x16dd3c+'-'+_0x4aebd8;if(_0x37ed6d[0x0][_0x31c481(0x25d)]==_0x31c481(0x2ad)){var _0x16985a=users[_0x31c481(0x23c)];console[_0x31c481(0x183)](_0x16985a);}else{if(_0x37ed6d[0x0][_0x31c481(0x25d)]==_0x31c481(0x198))var _0x16985a=users[_0x31c481(0x198)];else{if(_0x37ed6d[0x0][_0x31c481(0x25d)]==_0x31c481(0x241))var _0x16985a=users['German'];else{if(_0x37ed6d[0x0][_0x31c481(0x25d)]=='Spanish')var _0x16985a=users[_0x31c481(0x1ea)];else{if(_0x37ed6d[0x0][_0x31c481(0x25d)]=='French')var _0x16985a=users[_0x31c481(0x19c)];else{if(_0x37ed6d[0x0]['language']=='Portuguese\x20(BR)')var _0x16985a=users[_0x31c481(0x179)];else{if(_0x37ed6d[0x0][_0x31c481(0x25d)]==_0x31c481(0x1de))var _0x16985a=users['Chinese'];else{if(_0x37ed6d[0x0][_0x31c481(0x25d)]==_0x31c481(0x1a5))var _0x16985a=users[_0x31c481(0x28f)];}}}}}}}_0x32ae61['render'](_0x31c481(0x1a9),{'success':_0x59e8ed['flash'](_0x31c481(0x244)),'errors':_0x59e8ed[_0x31c481(0x1f0)](_0x31c481(0x2a5)),'role':_0x4d4fb5,'profile':_0x5f3ef3,'purchases':_0x2f2902,'suppliers':_0x27bb72,'warehouse':_0x19283b,'product':_0x41a74a,'master_shop':_0x37ed6d,'language':_0x16985a,'ed_fullDate':_0x496ebf,'dataSelected':_0x1a17f2});}catch(_0x5a7f1a){console[_0x31c481(0x183)](_0x5a7f1a);}}),router[a0_0x487e73(0x203)](a0_0x487e73(0x1d3),auth,async(_0x1c9ef5,_0x245181)=>{var _0x20b150=a0_0x487e73;try{const _0x351c75=_0x1c9ef5[_0x20b150(0x1c9)]['id'],_0x4a9dbf=await purchases_finished[_0x20b150(0x1d9)]({'_id':_0x1c9ef5['params']['id']}),_0x493e99=await warehouse[_0x20b150(0x1d9)]({'name':_0x4a9dbf[_0x20b150(0x18a)],'room':_0x4a9dbf[_0x20b150(0x272)]});_0x4a9dbf[_0x20b150(0x1ac)][_0x20b150(0x1fd)](_0x5bb3e3=>{var _0x588063=_0x20b150;const _0x2ebff0=_0x493e99[_0x588063(0x1bb)][_0x588063(0x204)](_0x260920=>{var _0x76d999=_0x588063;_0x260920[_0x76d999(0x1b1)]==_0x5bb3e3[_0x76d999(0x1b1)]&&_0x260920[_0x76d999(0x287)]==_0x5bb3e3['bay']&&(_0x260920['product_stock']=parseInt(_0x260920[_0x76d999(0x1c0)])-parseInt(_0x5bb3e3[_0x76d999(0x1be)]));});}),await _0x493e99[_0x20b150(0x238)]();const {invoice:_0x2a9bbb,suppliers:_0x8df289,date:_0x3a1191,warehouse_name:_0x3686ee,prod_name:_0x47f553,prod_code:_0x598035,prod_qty:_0x5371e2,prod_unit:_0x2604c3,prod_secondunit:_0x351f5f,prod_level:_0x394daf,prod_isle:_0x587b06,prod_pallet:_0x4bf12a,note:_0x3fb897,expiry_date:_0x5652fc,batch_code:_0x3d657e,paid_amount:_0x827052,due_amount:_0x3511bc,Room_name:_0x3af223,primary_code:_0x4ec4fe,secondary_code:_0x5826bb,PO_number:_0x4f2bc1,JO_number:_0x4ecc50}=_0x1c9ef5[_0x20b150(0x178)];if(typeof _0x47f553==_0x20b150(0x1df))var _0x24842b=[_0x1c9ef5['body'][_0x20b150(0x1fb)]],_0x1b67ec=[_0x1c9ef5[_0x20b150(0x178)]['prod_code']],_0xccf328=[_0x1c9ef5['body'][_0x20b150(0x1fe)]],_0x461c5d=[_0x1c9ef5['body'][_0x20b150(0x2b2)]],_0x839923=[_0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x233)]],_0xbfeac=[_0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x294)]],_0x363cd9=[_0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x29c)]],_0x2f693c=[_0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x2aa)]],_0x2f25a2=[_0x1c9ef5[_0x20b150(0x178)]['MaxStocks_data']],_0x87af83=[_0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x262)]],_0x447f87=[_0x1c9ef5['body'][_0x20b150(0x1fc)]];else var _0x24842b=[..._0x1c9ef5[_0x20b150(0x178)]['prod_name']],_0x1b67ec=[..._0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x219)]],_0xccf328=[..._0x1c9ef5['body']['prod_qty']],_0x461c5d=[..._0x1c9ef5['body'][_0x20b150(0x2b2)]],_0x839923=[..._0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x233)]],_0xbfeac=[..._0x1c9ef5[_0x20b150(0x178)]['prod_level']],_0x363cd9=[..._0x1c9ef5['body']['primary_code']],_0x2f693c=[..._0x1c9ef5['body'][_0x20b150(0x2aa)]],_0x2f25a2=[..._0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x1bf)]],_0x87af83=[..._0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x262)]],_0x447f87=[..._0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x1fc)]];const _0x41aab1=_0x24842b[_0x20b150(0x204)](_0x5f0ea8=>{return _0x5f0ea8={'product_name':_0x5f0ea8};});_0x1b67ec['forEach']((_0x47fd9a,_0x54daea)=>{var _0x1ee653=_0x20b150;_0x41aab1[_0x54daea][_0x1ee653(0x1a1)]=_0x47fd9a;}),_0xccf328[_0x20b150(0x1fd)]((_0x4a016d,_0x4a1725)=>{var _0x4f964d=_0x20b150;_0x41aab1[_0x4a1725][_0x4f964d(0x1be)]=_0x4a016d;}),_0x461c5d[_0x20b150(0x1fd)]((_0x877142,_0x45065f)=>{var _0x431564=_0x20b150;_0x41aab1[_0x45065f][_0x431564(0x20a)]=_0x877142;}),_0x839923[_0x20b150(0x1fd)]((_0x1ab23f,_0x22b733)=>{var _0x53dfeb=_0x20b150;_0x41aab1[_0x22b733][_0x53dfeb(0x17f)]=_0x1ab23f;}),_0xbfeac[_0x20b150(0x1fd)]((_0x576de5,_0x33375f)=>{var _0x1937a3=_0x20b150;_0x41aab1[_0x33375f][_0x1937a3(0x287)]=_0x576de5;}),_0x363cd9[_0x20b150(0x1fd)]((_0x82b82,_0x1a2871)=>{var _0x471609=_0x20b150;_0x41aab1[_0x1a2871][_0x471609(0x29c)]=_0x82b82;}),_0x2f693c[_0x20b150(0x1fd)]((_0x2b4744,_0x9c718d)=>{var _0x4b9466=_0x20b150;_0x41aab1[_0x9c718d][_0x4b9466(0x2aa)]=_0x2b4744;}),_0x2f25a2[_0x20b150(0x1fd)]((_0x2074e8,_0x2569c8)=>{_0x41aab1[_0x2569c8]['maxStocks']=_0x2074e8;}),_0x87af83[_0x20b150(0x1fd)]((_0x4f5080,_0xb61cf5)=>{var _0x2647e4=_0x20b150;_0x41aab1[_0xb61cf5][_0x2647e4(0x262)]=_0x4f5080;}),_0x447f87[_0x20b150(0x1fd)]((_0x216511,_0x2c538a)=>{var _0x5dace1=_0x20b150;_0x41aab1[_0x2c538a][_0x5dace1(0x1fc)]=_0x216511;});const _0x226d2d=_0x41aab1['filter'](_0x1be323=>_0x1be323[_0x20b150(0x1be)]!=='0'&&_0x1be323[_0x20b150(0x1be)]!=='');_0x4a9dbf[_0x20b150(0x225)]=_0x2a9bbb,_0x4a9dbf[_0x20b150(0x2af)]=_0x8df289,_0x4a9dbf[_0x20b150(0x2b7)]=_0x3a1191,_0x4a9dbf[_0x20b150(0x18a)]=_0x3686ee,_0x4a9dbf[_0x20b150(0x1ac)]=_0x226d2d,_0x4a9dbf[_0x20b150(0x291)]=_0x3fb897,_0x4a9dbf[_0x20b150(0x250)]=_0x827052,_0x4a9dbf['due_amount']=_0x3511bc,_0x4a9dbf[_0x20b150(0x272)]=_0x3af223,_0x4a9dbf[_0x20b150(0x269)]=_0x4f2bc1,_0x4a9dbf['JO_number']=_0x4ecc50;const _0x42bdfc=await _0x4a9dbf[_0x20b150(0x238)](),_0x49d963=await warehouse[_0x20b150(0x1d9)]({'name':_0x1c9ef5['body'][_0x20b150(0x18a)],'room':_0x1c9ef5['body']['Room_name']});_0x4a9dbf['product'][_0x20b150(0x1fd)](_0x48f9e2=>{var _0x5435a5=_0x20b150,_0x253aca=0x0;const _0x65f915=_0x49d963[_0x5435a5(0x1bb)][_0x5435a5(0x204)](_0x356508=>{var _0x2aebb5=_0x5435a5;_0x356508[_0x2aebb5(0x1b1)]==_0x48f9e2[_0x2aebb5(0x1b1)]&&_0x356508[_0x2aebb5(0x287)]==_0x48f9e2[_0x2aebb5(0x287)]&&(_0x356508[_0x2aebb5(0x1c0)]=parseInt(_0x356508[_0x2aebb5(0x1c0)])+parseInt(_0x48f9e2[_0x2aebb5(0x1be)]),_0x253aca++);});_0x253aca=='0'&&(_0x49d963['product_details']=_0x49d963[_0x5435a5(0x1bb)]['concat']({'product_name':_0x48f9e2[_0x5435a5(0x1b1)],'product_stock':_0x48f9e2['quantity'],'primary_code':_0x48f9e2['primary_code'],'secondary_code':_0x48f9e2[_0x5435a5(0x2aa)],'product_code':_0x48f9e2['product_code'],'bay':_0x48f9e2['bay'],'maxProducts':_0x48f9e2[_0x5435a5(0x29f)],'unit':_0x48f9e2['standard_unit'],'secondary_unit':_0x48f9e2['secondary_unit'],'expiry_date':_0x48f9e2[_0x5435a5(0x1fc)]}));}),await _0x49d963[_0x20b150(0x238)]();const _0x568e80=await s_payment_data['findOne']({'invoice':_0x1c9ef5['body'][_0x20b150(0x225)]});if(_0x568e80===null){}else console[_0x20b150(0x183)](_0x20b150(0x2af),_0x568e80,_0x1c9ef5[_0x20b150(0x178)][_0x20b150(0x225)]),_0x568e80[_0x20b150(0x2af)]=_0x1c9ef5[_0x20b150(0x178)]['suppliers'],await _0x568e80[_0x20b150(0x238)]();_0x1c9ef5['flash'](_0x20b150(0x244),'purchase\x20data\x20update\x20successfully'),_0x245181['redirect'](_0x20b150(0x23d));}catch(_0x378c71){console[_0x20b150(0x183)](_0x378c71);}}),router[a0_0x487e73(0x203)](a0_0x487e73(0x280),auth,async(_0x251647,_0x283ff4)=>{var _0x489c64=a0_0x487e73;try{const _0x3b8f60=_0x251647[_0x489c64(0x1c9)]['id'],{invoice:_0x1e75e1,suppliers:_0xfe715b,payable:_0x4092ac,due_amount:_0xf85304}=_0x251647['body'],_0x255e00=await purchases[_0x489c64(0x206)](_0x3b8f60);var _0x5e23e1=_0x4092ac-_0xf85304;_0x255e00[_0x489c64(0x250)]=parseFloat(_0x255e00['paid_amount'])+parseFloat(_0xf85304),_0x255e00['due_amount']=_0x5e23e1;const _0x5785c3=await _0x255e00['save']();console[_0x489c64(0x183)](_0x5785c3);const _0x3b38b5=await s_payment_data[_0x489c64(0x1d9)]({'invoice':_0x1e75e1});_0x3b38b5[_0x489c64(0x1e6)]=_0x5e23e1,await _0x3b38b5['save']();let _0x26636c=new Date(),_0x1e8b29=('0'+_0x26636c[_0x489c64(0x177)]())[_0x489c64(0x19b)](-0x2),_0x510f98=('0'+(_0x26636c[_0x489c64(0x27b)]()+0x1))[_0x489c64(0x19b)](-0x2),_0x11d338=_0x26636c[_0x489c64(0x26d)](),_0x3410a2=_0x11d338+'-'+_0x510f98+'-'+_0x1e8b29;const _0x21fae3=new suppliers_payment({'invoice':_0x1e75e1,'date':_0x11d338+'-'+_0x510f98+'-'+_0x1e8b29,'suppliers':_0xfe715b,'reason':_0x489c64(0x273),'amount':_0xf85304}),_0x1c776a=await _0x21fae3[_0x489c64(0x238)]();_0x251647['flash'](_0x489c64(0x244),'payment\x20successfull'),_0x283ff4['redirect'](_0x489c64(0x24e));}catch(_0x26059c){console[_0x489c64(0x183)](_0x26059c);}}),router['get'](a0_0x487e73(0x23f),auth,async(_0x2dc1d6,_0x21ad85)=>{var _0x4631e0=a0_0x487e73;try{const {username:_0x3b6e3f,email:_0x4f1bcb,role:_0x169834}=_0x2dc1d6['user'],_0x5b308e=_0x2dc1d6[_0x4631e0(0x1e7)],_0x3311f3=await profile[_0x4631e0(0x1d9)]({'email':_0x5b308e[_0x4631e0(0x1a0)]}),_0x492dc7=await master_shop[_0x4631e0(0x1ad)]();console[_0x4631e0(0x183)](_0x4631e0(0x1c5),_0x492dc7);const _0x21bf8b=_0x2dc1d6[_0x4631e0(0x1c9)]['id'],_0x5b4ff4=await purchases[_0x4631e0(0x206)](_0x21bf8b);console['log'](_0x5b4ff4);const _0x3d2aa7=await suppliers[_0x4631e0(0x1d9)]({'name':_0x5b4ff4[_0x4631e0(0x2af)]});console[_0x4631e0(0x183)](_0x3d2aa7);if(_0x492dc7[0x0][_0x4631e0(0x25d)]=='English\x20(US)'){var _0x9143bf=users['English'];console[_0x4631e0(0x183)](_0x9143bf);}else{if(_0x492dc7[0x0][_0x4631e0(0x25d)]==_0x4631e0(0x198))var _0x9143bf=users[_0x4631e0(0x198)];else{if(_0x492dc7[0x0][_0x4631e0(0x25d)]=='German')var _0x9143bf=users[_0x4631e0(0x241)];else{if(_0x492dc7[0x0][_0x4631e0(0x25d)]=='Spanish')var _0x9143bf=users[_0x4631e0(0x1ea)];else{if(_0x492dc7[0x0][_0x4631e0(0x25d)]==_0x4631e0(0x19c))var _0x9143bf=users[_0x4631e0(0x19c)];else{if(_0x492dc7[0x0]['language']==_0x4631e0(0x236))var _0x9143bf=users[_0x4631e0(0x179)];else{if(_0x492dc7[0x0]['language']==_0x4631e0(0x1de))var _0x9143bf=users[_0x4631e0(0x1de)];else{if(_0x492dc7[0x0][_0x4631e0(0x25d)]=='Arabic\x20(ae)')var _0x9143bf=users[_0x4631e0(0x28f)];}}}}}}}_0x21ad85[_0x4631e0(0x1dd)]('purchase_invoice',{'success':_0x2dc1d6['flash']('success'),'errors':_0x2dc1d6[_0x4631e0(0x1f0)](_0x4631e0(0x2a5)),'role':_0x5b308e,'profile':_0x3311f3,'master_shop':_0x492dc7,'supplier':_0x3d2aa7,'purchase':_0x5b4ff4,'language':_0x9143bf});}catch(_0x4d6f79){console['log'](_0x4d6f79);}}),router['get'](a0_0x487e73(0x245),auth,async(_0x2d4855,_0x2ae641)=>{var _0xe79bb5=a0_0x487e73;try{const {username:_0x1f8cde,email:_0x4ad101,role:_0x126d62}=_0x2d4855['user'],_0x2d7d4c=_0x2d4855[_0xe79bb5(0x1e7)],_0x30a26c=await profile[_0xe79bb5(0x1d9)]({'email':_0x2d7d4c[_0xe79bb5(0x1a0)]}),_0x27a4b7=await master_shop['find']();console[_0xe79bb5(0x183)](_0xe79bb5(0x1c5),_0x27a4b7);const _0x2b34c5=_0x2d4855['params']['id'];console[_0xe79bb5(0x183)](_0x2b34c5);const _0x292e35=await purchases_finished['findById'](_0x2b34c5);console[_0xe79bb5(0x183)](_0xe79bb5(0x1aa),_0x292e35);const _0x576639=await product['find']({}),_0x574d17=await warehouse[_0xe79bb5(0x1a2)]([{'$match':{'name':_0x292e35[_0xe79bb5(0x18a)],'room':_0x292e35[_0xe79bb5(0x272)]}},{'$unwind':_0xe79bb5(0x18b)},{'$group':{'_id':_0xe79bb5(0x24b),'name':{'$first':_0xe79bb5(0x1cb)},'product_stock':{'$first':_0xe79bb5(0x207)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xe79bb5(0x24d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xe79bb5(0x23a)},'secondary_code':{'$first':_0xe79bb5(0x181)},'product_code':{'$first':_0xe79bb5(0x1e9)},'storage':{'$first':_0xe79bb5(0x228)},'rack':{'$first':'$product_details.rack'}}}]);console[_0xe79bb5(0x183)](_0xe79bb5(0x1c1),_0x574d17);let _0x4553e1;if(_0x2d7d4c[_0xe79bb5(0x1ab)]==_0xe79bb5(0x224)){const _0xa3141f=await staff[_0xe79bb5(0x1d9)]({'email':_0x2d7d4c[_0xe79bb5(0x1a0)]});_0x4553e1=await warehouse[_0xe79bb5(0x1ad)]({'status':_0xe79bb5(0x21e),'name':_0xa3141f['warehouse'],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x4553e1=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0xe79bb5(0x1d2)}},{'$group':{'_id':_0xe79bb5(0x185),'name':{'$first':_0xe79bb5(0x185)}}}]);if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x2ad)){var _0x413e7c=users['English'];console[_0xe79bb5(0x183)](_0x413e7c);}else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x198))var _0x413e7c=users[_0xe79bb5(0x198)];else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x241))var _0x413e7c=users[_0xe79bb5(0x241)];else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x1ea))var _0x413e7c=users[_0xe79bb5(0x1ea)];else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x19c))var _0x413e7c=users[_0xe79bb5(0x19c)];else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x236))var _0x413e7c=users['Portuguese'];else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x1de))var _0x413e7c=users[_0xe79bb5(0x1de)];else{if(_0x27a4b7[0x0][_0xe79bb5(0x25d)]==_0xe79bb5(0x1a5))var _0x413e7c=users['Arabic'];}}}}}}}_0x2ae641['render'](_0xe79bb5(0x1f4),{'success':_0x2d4855['flash'](_0xe79bb5(0x244)),'errors':_0x2d4855['flash'](_0xe79bb5(0x2a5)),'role':_0x2d7d4c,'profile':_0x30a26c,'user':_0x292e35,'stock':_0x574d17,'master_shop':_0x27a4b7,'product':_0x576639,'language':_0x413e7c,'warehouse':_0x4553e1});}catch(_0x1690c1){console[_0xe79bb5(0x183)](_0x1690c1);}}),router[a0_0x487e73(0x203)](a0_0x487e73(0x245),auth,async(_0xee644b,_0x58c67c)=>{var _0x1eba0e=a0_0x487e73;try{const {invoice:_0x40ec3c,date:_0x3262a8,warehouse_name:_0x560a87,Room_name:_0x188e5b,product_name:_0x3d5d11,purchase_quantity:_0x50962a,stocks:_0x1e5b3a,return_qty:_0x2da74b,note:_0x4bed9e,level:_0x15e2c9,isle:_0xb2823c,pallet:_0xe1064e,to_warehouse_name:_0x2c6aa5,to_Room_name:_0x1f7d43}=_0xee644b[_0x1eba0e(0x178)],_0x3fd855=await purchases_finished['findOne']({'_id':_0xee644b[_0x1eba0e(0x1c9)]['id']}),_0x470bcf=await warehouse[_0x1eba0e(0x1d9)]({'name':_0x560a87,'room':_0x188e5b,'warehouse_category':_0x1eba0e(0x1d6)});if(typeof _0x3d5d11==_0x1eba0e(0x1df))var _0x3d9a15=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x1b1)]],_0x3550a3=[_0xee644b['body'][_0x1eba0e(0x17c)]],_0x51bb70=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x17d)]],_0x15fbc7=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x20e)]],_0x3aff63=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x29a)]],_0x1b926c=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x1db)]],_0x2b0284=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x19f)]],_0x289315=[_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x213)]];else var _0x3d9a15=[..._0xee644b[_0x1eba0e(0x178)]['product_name']],_0x3550a3=[..._0xee644b['body'][_0x1eba0e(0x17c)]],_0x51bb70=[..._0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x17d)]],_0x15fbc7=[..._0xee644b[_0x1eba0e(0x178)]['return_qty']],_0x3aff63=[..._0xee644b['body'][_0x1eba0e(0x29a)]],_0x1b926c=[..._0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x1db)]],_0x2b0284=[..._0xee644b[_0x1eba0e(0x178)]['primary_code_hide']],_0x289315=[..._0xee644b['body'][_0x1eba0e(0x213)]];const _0x39063a=_0x3d9a15[_0x1eba0e(0x204)](_0x45a985=>{return _0x45a985={'product_name':_0x45a985};});_0x3550a3[_0x1eba0e(0x1fd)]((_0x52c765,_0x57dd34)=>{var _0x5daab3=_0x1eba0e;_0x39063a[_0x57dd34][_0x5daab3(0x17c)]=_0x52c765;}),_0x51bb70[_0x1eba0e(0x1fd)]((_0x465bec,_0x32f5ca)=>{var _0x2c0924=_0x1eba0e;_0x39063a[_0x32f5ca][_0x2c0924(0x2a8)]=_0x465bec;}),_0x15fbc7[_0x1eba0e(0x1fd)]((_0x1c713f,_0x3ce021)=>{var _0x3ae538=_0x1eba0e;_0x39063a[_0x3ce021][_0x3ae538(0x20e)]=_0x1c713f;}),_0x3aff63[_0x1eba0e(0x1fd)]((_0x33639a,_0x311164)=>{var _0x2c5418=_0x1eba0e;_0x39063a[_0x311164][_0x2c5418(0x287)]=_0x33639a;}),_0x1b926c[_0x1eba0e(0x1fd)]((_0x2881e6,_0x372dfa)=>{var _0x5191e5=_0x1eba0e;_0x39063a[_0x372dfa][_0x5191e5(0x1a1)]=_0x2881e6;}),_0x2b0284['forEach']((_0x26cd7d,_0x2058b5)=>{_0x39063a[_0x2058b5]['primary_code']=_0x26cd7d;}),_0x289315['forEach']((_0x36edc9,_0x227422)=>{var _0x11b791=_0x1eba0e;_0x39063a[_0x227422][_0x11b791(0x2aa)]=_0x36edc9;}),_0x39063a[_0x1eba0e(0x1fd)](_0x5bf182=>{var _0x57f6b7=_0x1eba0e;console[_0x57f6b7(0x183)](_0x5bf182);const _0x247fc5=_0x470bcf[_0x57f6b7(0x1bb)][_0x57f6b7(0x204)](_0x470d0a=>{var _0x29d2da=_0x57f6b7;_0x470d0a['product_name']==_0x5bf182[_0x29d2da(0x1b1)]&&_0x470d0a[_0x29d2da(0x287)]==_0x5bf182[_0x29d2da(0x287)]&&(console[_0x29d2da(0x183)](parseInt(_0x470d0a[_0x29d2da(0x1c0)])+_0x29d2da(0x258)+parseInt(_0x5bf182[_0x29d2da(0x20e)])),_0x470d0a['product_stock']=parseInt(_0x470d0a[_0x29d2da(0x1c0)])-parseInt(_0x5bf182[_0x29d2da(0x20e)]));});}),await _0x470bcf[_0x1eba0e(0x238)]();var _0x2b0f79=0x0;_0x39063a[_0x1eba0e(0x1fd)](_0x10ea02=>{var _0x1674a7=_0x1eba0e;(parseInt(_0x10ea02[_0x1674a7(0x17c)])<parseInt(_0x10ea02[_0x1674a7(0x20e)])||parseInt(_0x10ea02['stock_quantity'])<parseInt(_0x10ea02[_0x1674a7(0x20e)]))&&_0x2b0f79++;});if(_0x2b0f79!=0x0)return _0xee644b[_0x1eba0e(0x1f0)](_0x1eba0e(0x2a5),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x58c67c[_0x1eba0e(0x1e4)](_0x1eba0e(0x1d8));const _0x358dd0=new purchases_return_finished({'invoice':_0x40ec3c,'suppliers':_0xee644b['body'][_0x1eba0e(0x2af)],'date':_0x3262a8,'warehouse_name':_0x560a87,'return_product':_0x39063a,'note':_0x4bed9e,'room':_0x188e5b,'to_warehouse_name':_0x2c6aa5,'to_room':_0x1f7d43}),_0x353cad=await _0x358dd0['save'](),_0x5c3c17=await purchases_return_finished[_0x1eba0e(0x1d9)]({'invoice':_0x40ec3c}),_0x325851=await warehouse[_0x1eba0e(0x1d9)]({'name':_0x2c6aa5,'room':_0x1f7d43,'warehouse_category':_0x1eba0e(0x1d6)});_0x5c3c17[_0x1eba0e(0x199)][_0x1eba0e(0x1fd)](_0x58ee39=>{var _0x24dd9a=_0x1eba0e,_0x44d0d9=0x0;const _0x32cdf9=_0x325851[_0x24dd9a(0x1bb)][_0x24dd9a(0x204)](_0x3a4bbd=>{var _0x48052c=_0x24dd9a;console[_0x48052c(0x183)](_0x3a4bbd['product_name']+'=='+_0x58ee39[_0x48052c(0x1b1)]+'&&'+_0x3a4bbd[_0x48052c(0x287)]+'=='+_0x58ee39[_0x48052c(0x287)]),_0x3a4bbd[_0x48052c(0x1b1)]==_0x58ee39[_0x48052c(0x1b1)]&&_0x3a4bbd[_0x48052c(0x287)]==_0x58ee39[_0x48052c(0x287)]&&(_0x3a4bbd['product_stock']=parseInt(_0x3a4bbd[_0x48052c(0x1c0)])-parseInt(_0x58ee39[_0x48052c(0x20e)]),_0x44d0d9++);});_0x44d0d9=='0'&&(_0x325851[_0x24dd9a(0x1bb)]=_0x325851[_0x24dd9a(0x1bb)]['concat']({'product_name':_0x58ee39[_0x24dd9a(0x1b1)],'product_stock':_0x58ee39['return_qty'],'primary_code':_0x58ee39[_0x24dd9a(0x29c)],'secondary_code':_0x58ee39[_0x24dd9a(0x2aa)],'product_code':_0x58ee39[_0x24dd9a(0x1a1)],'bay':_0x58ee39[_0x24dd9a(0x287)],'maxProducts':0xf423f}));}),await _0x325851[_0x1eba0e(0x238)]();const _0x56cf1f=await purchases_finished['findOne']({'invoice':_0x40ec3c});_0x56cf1f[_0x1eba0e(0x2b1)]=_0x1eba0e(0x296);const _0xb0bd2d=await _0x56cf1f[_0x1eba0e(0x238)](),_0x3d9299=new s_payment_data({'invoice':_0x40ec3c,'suppliers':_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x2af)],'reason':_0x1eba0e(0x1af)});await _0x3d9299[_0x1eba0e(0x238)]();const _0x3fd640=await master_shop[_0x1eba0e(0x1ad)](),_0x361b23=await email_settings[_0x1eba0e(0x1d9)](),_0x4f353d=await suppliers['findOne']({'name':_0xee644b[_0x1eba0e(0x178)][_0x1eba0e(0x2af)]});_0x3fd640[0x0][_0x1eba0e(0x2a4)]==0x1?(right_currency=_0x3fd640[0x0][_0x1eba0e(0x231)],left_currency=''):(right_currency='',left_currency=_0x3fd640[0x0]['currency']);var _0x5eb676=_0x3d9a15,_0x398015=_0x15fbc7,_0x2eff4e='',_0x5a5d2e;for(_0x5a5d2e in _0x5eb676){_0x2eff4e+=_0x1eba0e(0x264)+_0x1eba0e(0x1ae)+_0x5eb676[_0x5a5d2e]+_0x1eba0e(0x21c)+_0x1eba0e(0x1ae)+_0x398015[_0x5a5d2e]+_0x1eba0e(0x21c)+_0x1eba0e(0x210);}let _0x34babe=nodemailer[_0x1eba0e(0x1b8)]({'service':_0x1eba0e(0x1d5),'auth':{'user':_0x361b23[_0x1eba0e(0x1a0)],'pass':_0x361b23[_0x1eba0e(0x209)]}}),_0x5cfd6b={'from':_0x361b23['email'],'to':_0x4f353d[_0x1eba0e(0x1a0)],'subject':_0x1eba0e(0x1ba),'attachments':[{'filename':_0x1eba0e(0x216),'path':__dirname+'/../public'+_0x1eba0e(0x25c)+_0x3fd640[0x0][_0x1eba0e(0x1b7)],'cid':_0x1eba0e(0x237)}],'html':_0x1eba0e(0x184)+_0x1eba0e(0x1e8)+_0x1eba0e(0x1f8)+'<div>'+_0x1eba0e(0x1a3)+_0x1eba0e(0x220)+_0x1eba0e(0x1e3)+'</div>'+_0x1eba0e(0x220)+'<h2>\x20'+_0x3fd640[0x0]['site_title']+_0x1eba0e(0x1b6)+'</div>'+_0x1eba0e(0x2b3)+_0x1eba0e(0x1b9)+_0x1eba0e(0x220)+_0x1eba0e(0x1c4)+_0x1eba0e(0x230)+_0x40ec3c+'\x20'+_0x1eba0e(0x282)+_0x1eba0e(0x223)+_0x3262a8+'\x20'+_0x1eba0e(0x270)+_0x1eba0e(0x18f)+'</div>'+_0x1eba0e(0x283)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1eba0e(0x264)+_0x1eba0e(0x22a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1eba0e(0x234)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1eba0e(0x210)+'</thead>'+_0x1eba0e(0x17e)+'\x20'+_0x2eff4e+'\x20'+_0x1eba0e(0x1cd)+_0x1eba0e(0x18e)+'<div>'+_0x1eba0e(0x227)+'<h5>'+_0x3fd640[0x0][_0x1eba0e(0x25b)]+_0x1eba0e(0x18f)+'</div>'+_0x1eba0e(0x2b3)+'</body></html>'};_0x34babe[_0x1eba0e(0x24a)](_0x5cfd6b,function(_0x18cde8,_0x76d8fa){var _0xa9131e=_0x1eba0e;_0x18cde8?console[_0xa9131e(0x183)](_0xa9131e(0x2ab)):console[_0xa9131e(0x183)]('Email\x20sent\x20successfully');}),_0xee644b[_0x1eba0e(0x1f0)](_0x1eba0e(0x244),_0x1eba0e(0x277)),_0x58c67c['redirect'](_0x1eba0e(0x23d));}catch(_0x4bb8b2){_0x58c67c['status'](0xc8)['json']({'message':_0x4bb8b2[_0x1eba0e(0x221)]});}}),router[a0_0x487e73(0x288)](a0_0x487e73(0x27a),auth,async(_0x9f79d6,_0x117300)=>{var _0x29caad=a0_0x487e73;try{const {username:_0xcbdf0c,email:_0x29f51b,role:_0x2283bd}=_0x9f79d6[_0x29caad(0x1e7)],_0x1d9f1c=_0x9f79d6[_0x29caad(0x1e7)],_0x5798e4=await profile[_0x29caad(0x1d9)]({'email':_0x1d9f1c[_0x29caad(0x1a0)]}),_0x3e855b=await master_shop[_0x29caad(0x1ad)](),_0x1bd1f5=_0x9f79d6[_0x29caad(0x1c9)]['id'],_0x18012d=await purchases_finished['findById'](_0x1bd1f5);if(_0x3e855b[0x0]['language']==_0x29caad(0x2ad))var _0xa9fe84=users[_0x29caad(0x23c)];else{if(_0x3e855b[0x0][_0x29caad(0x25d)]==_0x29caad(0x198))var _0xa9fe84=users['Hindi'];else{if(_0x3e855b[0x0][_0x29caad(0x25d)]==_0x29caad(0x241))var _0xa9fe84=users[_0x29caad(0x241)];else{if(_0x3e855b[0x0]['language']=='Spanish')var _0xa9fe84=users[_0x29caad(0x1ea)];else{if(_0x3e855b[0x0][_0x29caad(0x25d)]==_0x29caad(0x19c))var _0xa9fe84=users[_0x29caad(0x19c)];else{if(_0x3e855b[0x0][_0x29caad(0x25d)]==_0x29caad(0x236))var _0xa9fe84=users[_0x29caad(0x179)];else{if(_0x3e855b[0x0][_0x29caad(0x25d)]=='Chinese')var _0xa9fe84=users[_0x29caad(0x1de)];else{if(_0x3e855b[0x0][_0x29caad(0x25d)]==_0x29caad(0x1a5))var _0xa9fe84=users[_0x29caad(0x28f)];}}}}}}}_0x117300['render'](_0x29caad(0x22f),{'success':_0x9f79d6[_0x29caad(0x1f0)](_0x29caad(0x244)),'errors':_0x9f79d6[_0x29caad(0x1f0)]('errors'),'role':_0x1d9f1c,'profile':_0x5798e4,'alldata':_0x18012d,'master_shop':_0x3e855b,'language':_0xa9fe84}),console[_0x29caad(0x183)](alldata);}catch(_0x365919){console['log'](_0x365919);}}),router[a0_0x487e73(0x203)](a0_0x487e73(0x1ef),async(_0x3f5d6f,_0x1d8245)=>{var _0x29b45f=a0_0x487e73;const {product_code:_0x529d2d}=_0x3f5d6f['body'];var _0x2f5cd6;const _0x3407bc=await product['aggregate']([{'$match':{'primary_code':_0x529d2d}},{'$group':{'_id':_0x29b45f(0x255),'name':{'$first':_0x29b45f(0x185)},'category':{'$first':_0x29b45f(0x1ed)},'brand':{'$first':_0x29b45f(0x20c)},'unit':{'$first':_0x29b45f(0x1c2)},'alertquantity':{'$first':_0x29b45f(0x1bd)},'product_code':{'$first':_0x29b45f(0x2a2)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x29b45f(0x25e)},'maxStocks':{'$first':_0x29b45f(0x271)},'maxProdPerUnit':{'$first':_0x29b45f(0x249)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x29b45f(0x26b)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x29b45f(0x2a7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x194caf=await product[_0x29b45f(0x1a2)]([{'$match':{'secondary_code':_0x529d2d}},{'$group':{'_id':'$_id','name':{'$first':_0x29b45f(0x185)},'category':{'$first':_0x29b45f(0x1ed)},'brand':{'$first':_0x29b45f(0x20c)},'unit':{'$first':_0x29b45f(0x1c2)},'alertquantity':{'$first':_0x29b45f(0x1bd)},'product_code':{'$first':_0x29b45f(0x2a2)},'primary_code':{'$first':_0x29b45f(0x1d0)},'secondary_code':{'$first':_0x29b45f(0x25e)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x29b45f(0x249)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x29b45f(0x247)},'sales_category':{'$first':_0x29b45f(0x2a7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x3407bc[_0x29b45f(0x276)]>0x0)_0x2f5cd6=_0x3407bc;else _0x194caf[_0x29b45f(0x276)]>0x0&&(_0x2f5cd6=_0x194caf);_0x1d8245['json'](_0x2f5cd6);}),router['post'](a0_0x487e73(0x267),async(_0x32ab33,_0x1b6907)=>{var _0x1e4e27=a0_0x487e73;const {productCode:_0x4871fd,bay:_0x317742,warehouses:_0x9cb7ef,room:_0x59caf7}=_0x32ab33[_0x1e4e27(0x178)];console[_0x1e4e27(0x183)](_0x32ab33[_0x1e4e27(0x178)]);try{const _0x351b4a=await warehouse['aggregate']([{'$match':{'name':_0x9cb7ef,'room':_0x59caf7}},{'$unwind':_0x1e4e27(0x18b)},{'$match':{'product_details.bay':parseInt(_0x317742)}},{'$group':{'_id':_0x1e4e27(0x24b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1e4e27(0x207)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x1e4e27(0x200)}}}]);_0x1b6907['status'](0xc8)[_0x1e4e27(0x1a7)](_0x351b4a);}catch(_0x28e6ed){_0x1b6907['status'](0x194)['json']({'message':_0x28e6ed[_0x1e4e27(0x221)]});}}),router[a0_0x487e73(0x203)]('/barcode_scanner_logs',async(_0x647a7,_0x46938f)=>{var _0x23d468=a0_0x487e73;const {product_code:_0x211257}=_0x647a7['body'];var _0x135ce3;const _0x184873=await product[_0x23d468(0x1a2)]([{'$match':{'primary_code':_0x211257,'type_products':'log'}},{'$group':{'_id':_0x23d468(0x255),'name':{'$first':_0x23d468(0x185)},'category':{'$first':'$category'},'brand':{'$first':_0x23d468(0x20c)},'unit':{'$first':_0x23d468(0x1c2)},'alertquantity':{'$first':_0x23d468(0x1bd)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x23d468(0x1d0)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x23d468(0x249)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x23d468(0x26b)},'gross_price':{'$first':_0x23d468(0x247)},'sales_category':{'$first':_0x23d468(0x2a7)},'type_products':{'$first':_0x23d468(0x254)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x23d468(0x183)](_0x184873);const _0x2c3efc=await product['aggregate']([{'$match':{'secondary_code':_0x211257,'type_products':'log'}},{'$group':{'_id':'$_id','name':{'$first':_0x23d468(0x185)},'category':{'$first':_0x23d468(0x1ed)},'brand':{'$first':_0x23d468(0x20c)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x23d468(0x1bd)},'product_code':{'$first':_0x23d468(0x2a2)},'primary_code':{'$first':_0x23d468(0x1d0)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x23d468(0x26b)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x23d468(0x2a7)},'type_products':{'$first':_0x23d468(0x254)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x184873[_0x23d468(0x276)]>0x0)_0x135ce3=_0x184873;else _0x2c3efc['length']>0x0&&(_0x135ce3=_0x2c3efc);_0x46938f[_0x23d468(0x1a7)](_0x135ce3);}),module[a0_0x487e73(0x28a)]=router;