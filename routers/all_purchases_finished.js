function a0_0x158f(){var _0x892695=['stocks','warehouse','room_name','STAGING','$product.type','numeric','Rack\x201','\x20<=>\x20','$room','$sales_category','$product_details.bin','success','$gross_price','French','$due_amount','Error\x20occurred\x20while\x20processing\x20product:','type_of_products_type','$product_details.rack','$maxProdPerUnit','product_cat','<tr>','abs','purchase\x20data\x20add\x20successfully','max_product_unit','table\x20page','product_code_hide','updateOne','Enabled','$product','level','/view/add_purchases_logs','user','stock_data','log','find','Purchase\x20Return\x20Mail','/all_purchases_finished/process/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','min','$secondary_code','$warehouse_name','gross_price','error','flash','name','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','/preview/:id','../middleware/auth','Router','sales_category','date','all_purchases_finished_logs','<!DOCTYPE\x20html>','Email\x20sent\x20successfully','errors','amount','findById','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','to_quantity','<strong>\x20Regards\x20</strong>','ejs','catch','$invoice','prod_cat','$product_details.product_stock','currency_placement','369446SnoHrr','prod_primunit','to_bay','getMonth','</body></html>','room','max','\x20Order\x20Date\x20:\x20','$category','return_data','Arabic\x20(ae)','purchases_id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','here2','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','/process/:id','<hr\x20class=\x22my-3\x22>','Portuguese','prod_Qty','render','301WOTvgH','maxProducts','$date','date_recieved','toLocaleDateString','expiry_date','back','purchase_quantity','$suppliers','/view/return_purchase/:id','user_id','$alertquantity','valueOf','../public/language/languages.json','prod_name','product_data','password','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$return_data','$paid_amount','/view_log','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','concat','/incoming/add','prod_level',',\x20room:\x20','return_purchase_finished','<h5\x20style=\x22text-align:\x20left;\x22>','Portuguese\x20(BR)','uuid','all','type_of_products','add_purchases_finished','$secondary_unit','to_recieved','forEach','string','then','English\x20(US)','/all_purchases_finished/view','$batch_code','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','10iASiaK','$product_details.product_name','gmail','$product.quantity','floor','/view/:id','$product.bay','$maxStocks','/getTRF','/barcode/:id','Chinese','json','/picking_list/pdf_puchases_fin_own_trf/','FROZEN\x20GOODS','prod_qty','isAvailable','True','toString','$primary_code','Arabic','Purchase\x20Mail','</head><body>','55044LrseOg','own','5616522iXuRAP','prod_secondunit','createTransport','email','Transfer\x20Finalize\x20Successfully','/barcode_scanner','findOne','_id','RoomAssign','post','$unit','inc','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/incoming','</table>','padStart','prod_code','product','$product.bin','currency','$suppliers_docs','getDate','<span\x20style=\x22float:\x20right;\x22>','params','297048aiDtEw','production_date','isProcess','\x20<>\x20','suppliers_docs','sales_data_cateory','The\x20Other\x20','Rack\x202','<h2>\x20','</h5>','$brand','$product_details.primary_code','Error\x20Occurs','</tr>','maxperunit','INCF-','</td>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','invoice','$product_details.bay','10YQfVXm','get','util','port','$product_details.floorlevel','FGSEmail','Paid\x20For\x20Purchase','614144HMTVpr','to_room_name','paid_amount','false','/view','bay','redirect','\x20inc\x20=\x20','random','===','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Hindi','German','Spanish','$product.floorlevel','master','Logo.png','/view/add_purchases','getFullYear','save','incoming_add','$product_code','length','unit','purchase_invoice','/give_payment/:id','$product_details.storage','$note','language','Finished\x20Goods','id_transaction','Enclosed','product_stock','item_code','due_amount','$product_details._id','maxPerUnit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>',',\x20bay:\x20','DRY\x20GOODS','aggregate','4993043ARrmyO','Distributing\x20','Return\x20Goods','true','sendMail','$type_products','/barcode_scanner_logs','INC-','4558368DOdsqA','2-digit','Ambient','site_title','<html><head><title></title>','return_qty','</div>','purchases_process','filter','body','isUsed','prod_unit','map','staff','batch_code','exports','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<h5>','edit_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/../public','/invoice/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','product_id','product_date','express','suppliers','message','There\x20is\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','role','host','$expiry_date','3JhZhbX','status','../models/all_models','<div>','/CheckingWarehouse','secondary_code','\x20===\x20','product_code','maxStocks','primary_code_hide','bin','Room_name','warehouse_name','to_warehouse','invoice_init','secondary_code_hide','edit_purchases_finished_view','standard_unit','match','logo','$_id','</tbody>','quantity','slice','data_type','MaxStocks_data','logs','$product.room_name','LOG-INC-','all_purchases_finished'];a0_0x158f=function(){return _0x892695;};return a0_0x158f();}var a0_0x355199=a0_0x9987;(function(_0x451aed,_0x4a191e){var _0x46fbf2=a0_0x9987,_0x141397=_0x451aed();while(!![]){try{var _0x4b669d=parseInt(_0x46fbf2(0xf8))/0x1+parseInt(_0x46fbf2(0x16b))/0x2*(parseInt(_0x46fbf2(0x1de))/0x3)+parseInt(_0x46fbf2(0x188))/0x4*(-parseInt(_0x46fbf2(0x181))/0x5)+-parseInt(_0x46fbf2(0x151))/0x6*(parseInt(_0x46fbf2(0x10f))/0x7)+-parseInt(_0x46fbf2(0x1bc))/0x8+parseInt(_0x46fbf2(0x153))/0x9+parseInt(_0x46fbf2(0x13b))/0xa*(parseInt(_0x46fbf2(0x1b4))/0xb);if(_0x4b669d===_0x4a191e)break;else _0x141397['push'](_0x141397['shift']());}catch(_0x280c79){_0x141397['push'](_0x141397['shift']());}}}(a0_0x158f,0x4f3ef));const express=require(a0_0x355199(0x1d6)),app=express(),router=express[a0_0x355199(0xe5)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x355199(0x1e0)),auth=require(a0_0x355199(0xe4)),nodemailer=require('nodemailer');function a0_0x9987(_0x1b9947,_0x567fee){var _0x158fa2=a0_0x158f();return a0_0x9987=function(_0x998796,_0x3452b7){_0x998796=_0x998796-0xa7;var _0x23fafb=_0x158fa2[_0x998796];return _0x23fafb;},a0_0x9987(_0x1b9947,_0x567fee);}var ejs=require(a0_0x355199(0xf2));const path=require('path'),users=require(a0_0x355199(0x11c)),{isNull}=require(a0_0x355199(0x183));router['get'](a0_0x355199(0x160),auth,async(_0x5864bf,_0x3f2bda)=>{var _0x5b7d52=a0_0x355199;try{const {username:_0x5db9f3,email:_0x4df2fb,role:_0x4c39eb}=_0x5864bf[_0x5b7d52(0xd4)],_0x2af89e=_0x5864bf[_0x5b7d52(0xd4)],_0x478078=await profile[_0x5b7d52(0x159)]({'email':_0x2af89e[_0x5b7d52(0x156)]}),_0x213f01=await staff[_0x5b7d52(0x159)]({'email':_0x2af89e[_0x5b7d52(0x156)]}),_0x452d7c=await master_shop['find']();let _0x476d68=await transfers_finished[_0x5b7d52(0x1b3)]([{'$match':{'to_warehouse':_0x213f01[_0x5b7d52(0xb6)]}}]);if(_0x452d7c[0x0]['language']==_0x5b7d52(0x136))var _0xae5c63=users['English'];else{if(_0x452d7c[0x0][_0x5b7d52(0x1a5)]=='Hindi')var _0xae5c63=users[_0x5b7d52(0x194)];else{if(_0x452d7c[0x0][_0x5b7d52(0x1a5)]==_0x5b7d52(0x195))var _0xae5c63=users[_0x5b7d52(0x195)];else{if(_0x452d7c[0x0]['language']==_0x5b7d52(0x196))var _0xae5c63=users['Spanish'];else{if(_0x452d7c[0x0][_0x5b7d52(0x1a5)]==_0x5b7d52(0xc2))var _0xae5c63=users[_0x5b7d52(0xc2)];else{if(_0x452d7c[0x0][_0x5b7d52(0x1a5)]==_0x5b7d52(0x12c))var _0xae5c63=users[_0x5b7d52(0x10c)];else{if(_0x452d7c[0x0][_0x5b7d52(0x1a5)]==_0x5b7d52(0x145))var _0xae5c63=users['Chinese'];else{if(_0x452d7c[0x0]['language']==_0x5b7d52(0x102))var _0xae5c63=users[_0x5b7d52(0x14e)];}}}}}}}_0x3f2bda[_0x5b7d52(0x10e)]('incoming_view',{'success':_0x5864bf[_0x5b7d52(0xe0)](_0x5b7d52(0xc0)),'errors':_0x5864bf['flash'](_0x5b7d52(0xeb)),'purchases':_0x476d68,'role':_0x2af89e,'profile':_0x478078,'master_shop':_0x452d7c,'language':_0xae5c63,'staff_data':_0x213f01});}catch(_0x571d04){console[_0x5b7d52(0xd6)]('table\x20page',_0x571d04),_0x3f2bda[_0x5b7d52(0x1df)](0xc8)[_0x5b7d52(0x146)]({'message':_0x571d04[_0x5b7d52(0x1d8)]});}}),router[a0_0x355199(0x182)](a0_0x355199(0x127),auth,async(_0x22e7b1,_0xde4e60)=>{var _0x8cbf42=a0_0x355199;try{const {username:_0x128fd1,email:_0x5cc795,role:_0x3200d9}=_0x22e7b1[_0x8cbf42(0xd4)],_0x178192=_0x22e7b1[_0x8cbf42(0xd4)],_0x52c4fb=await profile['findOne']({'email':_0x178192[_0x8cbf42(0x156)]}),_0x3ebfb9=await staff[_0x8cbf42(0x159)]({'email':_0x178192[_0x8cbf42(0x156)]}),_0x6f897b=await master_shop[_0x8cbf42(0xd7)]();let _0x804dbc=await transfers_finished[_0x8cbf42(0x1b3)]([{'$match':{'to_warehouse':_0x3ebfb9['warehouse'],'to_recieved':_0x8cbf42(0x18b)}}]);if(_0x6f897b[0x0]['language']==_0x8cbf42(0x136))var _0x922544=users['English'];else{if(_0x6f897b[0x0][_0x8cbf42(0x1a5)]=='Hindi')var _0x922544=users[_0x8cbf42(0x194)];else{if(_0x6f897b[0x0][_0x8cbf42(0x1a5)]==_0x8cbf42(0x195))var _0x922544=users[_0x8cbf42(0x195)];else{if(_0x6f897b[0x0][_0x8cbf42(0x1a5)]==_0x8cbf42(0x196))var _0x922544=users[_0x8cbf42(0x196)];else{if(_0x6f897b[0x0]['language']==_0x8cbf42(0xc2))var _0x922544=users[_0x8cbf42(0xc2)];else{if(_0x6f897b[0x0][_0x8cbf42(0x1a5)]==_0x8cbf42(0x12c))var _0x922544=users[_0x8cbf42(0x10c)];else{if(_0x6f897b[0x0]['language']==_0x8cbf42(0x145))var _0x922544=users[_0x8cbf42(0x145)];else{if(_0x6f897b[0x0][_0x8cbf42(0x1a5)]=='Arabic\x20(ae)')var _0x922544=users[_0x8cbf42(0x14e)];}}}}}}}_0xde4e60[_0x8cbf42(0x10e)](_0x8cbf42(0x19d),{'success':_0x22e7b1['flash'](_0x8cbf42(0xc0)),'errors':_0x22e7b1[_0x8cbf42(0xe0)]('errors'),'purchases':_0x804dbc,'role':_0x178192,'profile':_0x52c4fb,'master_shop':_0x6f897b,'language':_0x922544,'staff_data':_0x3ebfb9});}catch(_0x11a7e5){console[_0x8cbf42(0xd6)]('table\x20page',_0x11a7e5),_0xde4e60[_0x8cbf42(0x1df)](0xc8)[_0x8cbf42(0x146)]({'message':_0x11a7e5[_0x8cbf42(0x1d8)]});}});const createLog=async _0x380eef=>{var _0x2a0e96=a0_0x355199;const _0x4ceadb=new datalogs({'location':_0x380eef});return await _0x4ceadb[_0x2a0e96(0x19c)](),_0x4ceadb[_0x2a0e96(0x1ec)];};router[a0_0x355199(0x15c)](a0_0x355199(0x127),auth,async(_0x489cf4,_0x386e7d)=>{var _0x149d1b=a0_0x355199;try{const {invoice_trf_data:_0x1236df,item_code:_0xa46cb4,SCRN:_0x224d22,ReqBy:_0x5ee0c3,type_of_products:_0x4657eb,dateofreq:_0x3184b3,PO_number:_0x38d0eb,date:_0x57e7ad,warehouse_name:_0x8890a1,typeservicesData:_0x6c6e5d,typevehicle:_0x5ccb71,driver:_0x4a228a,plate:_0x108656,van:_0x4ba8b5,DRSI:_0x2794f4,TSU:_0x32080a,TFU:_0x4703b3,note:_0x12ce1a}=_0x489cf4[_0x149d1b(0x1c5)],_0x5bb2d9=await transfers_finished[_0x149d1b(0xed)](_0x1236df);if(typeof _0xa46cb4=='string')var _0x8cdf4e=[_0x489cf4['body'][_0x149d1b(0xef)]],_0x2e3bd0=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x1aa)]],_0x21106a=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0xf0)]],_0x13b02a=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x1a0)]],_0x44f63d=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x154)]],_0x3a86fb=[_0x489cf4['body'][_0x149d1b(0x1e8)]],_0x5ca5ff=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x105)]],_0x2e41e4=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x1e3)]],_0x10bbaa=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x1ca)]],_0x2526f3=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x114)]],_0x41cd13=[_0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x16c)]],_0xf8e8fd=[_0x489cf4[_0x149d1b(0x1c5)]['max_product_unit']],_0x46777b=[_0x489cf4[_0x149d1b(0x1c5)]['room']];else var _0x8cdf4e=[..._0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0xef)]],_0x2e3bd0=[..._0x489cf4['body'][_0x149d1b(0x1aa)]],_0x21106a=[..._0x489cf4[_0x149d1b(0x1c5)]['to_quantity']],_0x13b02a=[..._0x489cf4['body']['unit']],_0x44f63d=[..._0x489cf4[_0x149d1b(0x1c5)]['prod_secondunit']],_0x3a86fb=[..._0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x1e8)]],_0x5ca5ff=[..._0x489cf4['body']['primary_code']],_0x2e41e4=[..._0x489cf4['body'][_0x149d1b(0x1e3)]],_0x10bbaa=[..._0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x1ca)]],_0x2526f3=[..._0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x114)]],_0x41cd13=[..._0x489cf4[_0x149d1b(0x1c5)][_0x149d1b(0x16c)]],_0xf8e8fd=[..._0x489cf4['body'][_0x149d1b(0xcc)]],_0x46777b=[..._0x489cf4['body'][_0x149d1b(0xfd)]];const _0x33920f=_0x8cdf4e[_0x149d1b(0x1c8)](_0x12cdb3=>{return _0x12cdb3={'product_name':_0x12cdb3};});_0x2e3bd0['forEach']((_0x5a7cec,_0x425ee4)=>{var _0x278858=_0x149d1b;_0x33920f[_0x425ee4][_0x278858(0x1e5)]=_0x5a7cec;}),_0x21106a[_0x149d1b(0x133)]((_0x5ac96f,_0x5cda54)=>{var _0x2b36fc=_0x149d1b;_0x33920f[_0x5cda54][_0x2b36fc(0xad)]=Math[_0x2b36fc(0xca)](_0x5ac96f);}),_0x13b02a[_0x149d1b(0x133)]((_0x24fcfd,_0xcefe57)=>{_0x33920f[_0xcefe57]['standard_unit']=_0x24fcfd;}),_0x44f63d[_0x149d1b(0x133)]((_0x108ca7,_0x12cdc0)=>{var _0x479f3f=_0x149d1b;_0x33920f[_0x12cdc0][_0x479f3f(0x120)]=_0x108ca7;}),_0x3a86fb[_0x149d1b(0x133)]((_0xd00a93,_0x2f2077)=>{var _0x4f3bc5=_0x149d1b,_0x5f5bc2=_0xd00a93['match'](/[A-Za-z]+/)[0x0],_0x1d9888=parseInt(_0xd00a93['match'](/\d+/)[0x0]);_0x33920f[_0x2f2077]['level']=_0x5f5bc2,_0x33920f[_0x2f2077][_0x4f3bc5(0x18d)]=_0x1d9888;}),_0x5ca5ff[_0x149d1b(0x133)]((_0x57a560,_0x27332b)=>{var _0x9f2d33=_0x149d1b;_0x33920f[_0x27332b][_0x9f2d33(0x105)]=_0x57a560;}),_0x2e41e4[_0x149d1b(0x133)]((_0x31d200,_0x515cbe)=>{_0x33920f[_0x515cbe]['secondary_code']=_0x31d200;}),_0x10bbaa['forEach']((_0x362882,_0x5a5d75)=>{var _0x2e0f8f=_0x149d1b;_0x33920f[_0x5a5d75][_0x2e0f8f(0x1ca)]=_0x362882;}),_0x2526f3[_0x149d1b(0x133)]((_0x5215e,_0x5266fd)=>{var _0x495b3f=_0x149d1b;_0x33920f[_0x5266fd][_0x495b3f(0x114)]=_0x5215e;}),_0x41cd13[_0x149d1b(0x133)]((_0xfcc218,_0xec2934)=>{_0x33920f[_0xec2934]['production_date']=_0xfcc218;}),_0xf8e8fd[_0x149d1b(0x133)]((_0x117cb3,_0x5d9d4d)=>{var _0x1f823a=_0x149d1b;_0x33920f[_0x5d9d4d][_0x1f823a(0x179)]=_0x117cb3;}),_0x46777b[_0x149d1b(0x133)]((_0x5058a2,_0x215bf8)=>{var _0x2547de=_0x149d1b;_0x33920f[_0x215bf8][_0x2547de(0xb7)]=_0x5058a2;});const _0x27e54a=await createLog('INC');_0x46777b[_0x149d1b(0x133)]((_0x84e23b,_0x43bb01)=>{var _0x11dcc6=_0x149d1b;_0x33920f[_0x43bb01]['invoice']=_0x11dcc6(0x1bb)+_0x27e54a['toString']()['padStart'](0x8,'0');});const _0x1ad50d=_0x33920f[_0x149d1b(0x1c4)](_0x4d47f8=>_0x4d47f8[_0x149d1b(0xad)]!=='0'&&_0x4d47f8[_0x149d1b(0xad)]!==''),_0x2b2bba=new purchases_incoming({'invoice':_0x149d1b(0x1bb)+_0x27e54a[_0x149d1b(0x14c)]()[_0x149d1b(0x162)](0x8,'0'),'date':_0x57e7ad,'warehouse_name':_0x8890a1,'product':_0x1ad50d,'note':_0x12ce1a,'POnumber':_0x38d0eb,'SCRN':_0x224d22,'ReqBy':_0x5ee0c3,'dateofreq':_0x3184b3,'typeservicesData':_0x6c6e5d,'van':_0x4ba8b5,'typevehicle':_0x5ccb71,'driver':_0x4a228a,'plate':_0x108656,'DRSI':_0x2794f4,'TSU':_0x32080a,'TFU':_0x4703b3,'typeOfProducts':_0x4657eb}),_0xf0d309=await _0x2b2bba['save'](),_0x3f05be=_0xf0d309[_0x149d1b(0x164)]['map'](async _0xd622d9=>{var _0x37caad=_0x149d1b,_0xf39b4d=await warehouse[_0x37caad(0x159)]({'name':_0x8890a1,'room':_0xd622d9[_0x37caad(0xb7)]});if(_0xd622d9[_0x37caad(0xad)]>0x0){var _0x1d493a=0x0;const _0xe32a33=_0xf39b4d[_0x37caad(0x1af)][_0x37caad(0x1c8)](_0x5359d0=>{var _0x54d5d6=_0x37caad;_0x5359d0[_0x54d5d6(0xef)]==_0xd622d9['product_name']&&_0x5359d0[_0x54d5d6(0x18d)]==_0xd622d9['to_bay']&&_0x5359d0[_0x54d5d6(0x114)]==_0xd622d9[_0x54d5d6(0x114)]&&_0x5359d0[_0x54d5d6(0x16c)]==_0xd622d9['production_date']&&_0x5359d0[_0x54d5d6(0x1ca)]==_0xd622d9['batch_code']&&_0x5359d0[_0x54d5d6(0x17f)]==_0xd622d9[_0x54d5d6(0x17f)]&&(typeof _0xd622d9[_0x54d5d6(0x1a7)]=='undefined'?(console['log'](_0x54d5d6(0x107),_0x5359d0[_0x54d5d6(0x1a9)]+_0x54d5d6(0x16e)+_0x5359d0[_0x54d5d6(0x15a)]+_0x54d5d6(0xbc)+Math['abs'](_0x5359d0['product_stock'])+Math[_0x54d5d6(0xca)](_0xd622d9[_0x54d5d6(0xf0)])),_0x5359d0['product_stock']=Math[_0x54d5d6(0xca)](_0x5359d0[_0x54d5d6(0x1a9)])+Math['abs'](_0xd622d9[_0x54d5d6(0xad)])):(_0x5359d0[_0x54d5d6(0x1a9)]=Math[_0x54d5d6(0xca)](_0x5359d0[_0x54d5d6(0x1a9)])+Math[_0x54d5d6(0xca)](_0xd622d9['quantity']),_0x1d493a++));});_0x1d493a=='0'&&(_0xf39b4d['product_details']=_0xf39b4d[_0x37caad(0x1af)][_0x37caad(0x126)]({'product_name':_0xd622d9[_0x37caad(0xef)],'product_stock':_0xd622d9[_0x37caad(0xad)],'bay':_0xd622d9[_0x37caad(0x18d)],'level':_0xd622d9[_0x37caad(0xd2)],'product_code':_0xd622d9[_0x37caad(0x1e5)],'primary_code':_0xd622d9['primary_code'],'secondary_code':_0xd622d9[_0x37caad(0x1e3)],'expiry_date':_0xd622d9[_0x37caad(0x114)],'production_date':_0xd622d9[_0x37caad(0x16c)],'maxProducts':_0xd622d9[_0x37caad(0x110)],'batch_code':_0xd622d9[_0x37caad(0x1ca)],'secondary_unit':_0xd622d9[_0x37caad(0x120)],'unit':_0xd622d9[_0x37caad(0xa8)],'maxProducts':_0xd622d9[_0x37caad(0x110)],'maxPerUnit':_0xd622d9[_0x37caad(0x1ad)],'invoice':_0xd622d9[_0x37caad(0x17f)]}));}return _0xf39b4d;});Promise['all'](_0x3f05be)['then'](async _0x3a9c84=>{var _0x3effac=_0x149d1b;try{for(const _0x2e0751 of _0x3a9c84){await warehouse[_0x3effac(0xcf)]({'_id':_0x2e0751[_0x3effac(0x15a)]},{'$addToSet':{'product_details':{'$each':_0x2e0751['product_details']}}});}_0x5bb2d9[_0x3effac(0x132)]=_0x3effac(0x1b7);const _0x4d7d09=await _0x5bb2d9[_0x3effac(0x19c)](),_0x3c8106=await master_shop['find'](),_0x17b639=await email_settings[_0x3effac(0x159)](),_0x2dd051=await supervisor_settings[_0x3effac(0xd7)]();var _0x3febbd=_0x2b2bba[_0x3effac(0x164)],_0x35170c='',_0x2ea41c;for(_0x2ea41c in _0x3febbd){var _0x40f824='FG';_0x2b2bba[_0x3effac(0x1eb)]==_0x3effac(0x1b2)&&(_0x40f824='DG'),_0x35170c+='<tr>'+_0x3effac(0x1da)+_0x3febbd[_0x2ea41c][_0x3effac(0xef)]+_0x3effac(0x17b)+_0x3effac(0x1da)+_0x3febbd[_0x2ea41c][_0x3effac(0x1e5)]+_0x3effac(0x17b)+_0x3effac(0x1da)+_0x3febbd[_0x2ea41c][_0x3effac(0xf0)]+_0x3effac(0x17b)+_0x3effac(0x1da)+_0x3febbd[_0x2ea41c]['unit']+_0x3effac(0x17b)+_0x3effac(0x1da)+_0x3febbd[_0x2ea41c][_0x3effac(0x120)]+_0x3effac(0x17b)+_0x3effac(0x1da)+_0x2b2bba[_0x3effac(0x1eb)]+_0x3effac(0x17b)+_0x3effac(0x1da)+_0x3febbd[_0x2ea41c][_0x3effac(0x189)]+_0x3effac(0x17b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40f824+_0x3febbd[_0x2ea41c][_0x3effac(0xfa)]+'</td>'+_0x3effac(0x178);}_0x489cf4[_0x3effac(0xe0)](_0x3effac(0xc0),_0x3effac(0x157)),_0x386e7d[_0x3effac(0x18e)](_0x3effac(0x147)+_0xf0d309[_0x3effac(0x15a)]);}catch(_0x5571ff){console[_0x3effac(0xdf)](_0x5571ff),_0x386e7d['status'](0x1f4)['json']({'error':_0x3effac(0x109)});}})[_0x149d1b(0xf3)](_0x48cf01=>{var _0x4e82f4=_0x149d1b;console[_0x4e82f4(0xdf)](_0x48cf01),_0x386e7d['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x1ed47b){}}),router[a0_0x355199(0x15c)](a0_0x355199(0x143),auth,async(_0x26bee6,_0x42a663)=>{var _0x5a8310=a0_0x355199;try{const {warehouse:_0x29aa74}=_0x26bee6[_0x5a8310(0x1c5)],_0x1af6fb=await transfers_finished['find']({'to_warehouse':_0x29aa74,'to_recieved':'false'});_0x42a663[_0x5a8310(0x146)](_0x1af6fb);}catch(_0x1e1d9c){}}),router[a0_0x355199(0x15c)]('/getinvoicetrf',auth,async(_0x57f8ea,_0x317a3b)=>{var _0x213ec2=a0_0x355199;try{const {invoice:_0x14e07e}=_0x57f8ea[_0x213ec2(0x1c5)],_0x471e4d=await transfers_finished[_0x213ec2(0xd7)]({'_id':_0x14e07e,'to_recieved':_0x213ec2(0x18b)});_0x317a3b[_0x213ec2(0x146)](_0x471e4d);}catch(_0x17124b){}}),router[a0_0x355199(0x182)](a0_0x355199(0x18c),auth,async(_0x5b3630,_0x45de0d)=>{var _0x13b9af=a0_0x355199;try{const {username:_0x31beb9,email:_0x5aaff8,role:_0x3928c1}=_0x5b3630[_0x13b9af(0xd4)],_0x3a25df=_0x5b3630[_0x13b9af(0xd4)],_0x3d6fce=await profile['findOne']({'email':_0x3a25df['email']}),_0x2b8753=await staff[_0x13b9af(0x159)]({'email':_0x3a25df['email']});if(_0x3a25df[_0x13b9af(0x1db)]==_0x13b9af(0x1c9)){const _0x155155=await staff['findOne']({'email':_0x3a25df[_0x13b9af(0x156)]});}const _0x482815=await master_shop[_0x13b9af(0xd7)]();let _0x9506a9;if(_0x3a25df[_0x13b9af(0x1db)]==_0x13b9af(0x1c9)){const _0x20810a=await staff['findOne']({'email':_0x3a25df[_0x13b9af(0x156)]});_0x9506a9=await purchases_finished[_0x13b9af(0x1b3)]([{'$match':{'warehouse_name':_0x20810a['warehouse'],'typeOfProducts':_0x13b9af(0x152)}},{'$lookup':{'from':'suppliers','localField':_0x13b9af(0x1d7),'foreignField':_0x13b9af(0xe1),'as':_0x13b9af(0x16f)}},{'$unwind':_0x13b9af(0x167)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x13b9af(0xf4)},'suppliers':{'$first':_0x13b9af(0x117)},'date':{'$first':_0x13b9af(0x111)},'warehouse_name':{'$first':_0x13b9af(0xdd)},'room':{'$first':_0x13b9af(0xbd)},'product':{'$push':_0x13b9af(0xd1)},'note':{'$first':_0x13b9af(0x1a4)},'paid_amount':{'$first':_0x13b9af(0x123)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x13b9af(0x122)},'batch_code':{'$first':_0x13b9af(0x138)},'expiry_date':{'$first':_0x13b9af(0x1dd)},'suppliers_docs':{'$first':_0x13b9af(0x167)},'total_product_quantity':{'$sum':_0x13b9af(0x13e)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x13b9af(0x165)},'type':{'$addToSet':_0x13b9af(0xb9)},'floorlevel':{'$addToSet':_0x13b9af(0x197)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x9506a9=await purchases_finished[_0x13b9af(0x1b3)]([{'$match':{'typeOfProducts':_0x13b9af(0x152)}},{'$unwind':_0x13b9af(0xd1)},{'$group':{'_id':'$_id','invoice':{'$first':_0x13b9af(0xf4)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x13b9af(0x111)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x13b9af(0xb2)},'product':{'$push':_0x13b9af(0xd1)},'note':{'$first':_0x13b9af(0x1a4)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x13b9af(0xc3)},'return_data':{'$first':_0x13b9af(0x122)},'batch_code':{'$first':_0x13b9af(0x138)},'expiry_date':{'$first':_0x13b9af(0x1dd)},'suppliers_docs':{'$first':_0x13b9af(0x167)},'total_product_quantity':{'$sum':_0x13b9af(0x13e)},'level':{'$addToSet':_0x13b9af(0x141)},'isle':{'$addToSet':_0x13b9af(0x165)},'type':{'$addToSet':_0x13b9af(0xb9)},'floorlevel':{'$addToSet':_0x13b9af(0x197)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x482815[0x0][_0x13b9af(0x1a5)]==_0x13b9af(0x136))var _0x2f1fd0=users[_0x13b9af(0x139)];else{if(_0x482815[0x0]['language']==_0x13b9af(0x194))var _0x2f1fd0=users[_0x13b9af(0x194)];else{if(_0x482815[0x0][_0x13b9af(0x1a5)]=='German')var _0x2f1fd0=users[_0x13b9af(0x195)];else{if(_0x482815[0x0][_0x13b9af(0x1a5)]=='Spanish')var _0x2f1fd0=users['Spanish'];else{if(_0x482815[0x0][_0x13b9af(0x1a5)]==_0x13b9af(0xc2))var _0x2f1fd0=users['French'];else{if(_0x482815[0x0][_0x13b9af(0x1a5)]==_0x13b9af(0x12c))var _0x2f1fd0=users[_0x13b9af(0x10c)];else{if(_0x482815[0x0][_0x13b9af(0x1a5)]==_0x13b9af(0x145))var _0x2f1fd0=users[_0x13b9af(0x145)];else{if(_0x482815[0x0][_0x13b9af(0x1a5)]==_0x13b9af(0x102))var _0x2f1fd0=users[_0x13b9af(0x14e)];}}}}}}}_0x45de0d[_0x13b9af(0x10e)](_0x13b9af(0xb4),{'success':_0x5b3630[_0x13b9af(0xe0)](_0x13b9af(0xc0)),'errors':_0x5b3630[_0x13b9af(0xe0)](_0x13b9af(0xeb)),'purchases':_0x9506a9,'role':_0x3a25df,'profile':_0x3d6fce,'master_shop':_0x482815,'language':_0x2f1fd0});}catch(_0xced80f){console['log'](_0x13b9af(0xcd),_0xced80f),_0x45de0d[_0x13b9af(0x1df)](0xc8)[_0x13b9af(0x146)]({'message':_0xced80f[_0x13b9af(0x1d8)]});}}),router[a0_0x355199(0x182)](a0_0x355199(0x124),auth,async(_0x4cd887,_0xca339f)=>{var _0x2ab65b=a0_0x355199;try{const {username:_0x4982fe,email:_0x29dcd9,role:_0x1781b3}=_0x4cd887['user'],_0x50f0c1=_0x4cd887[_0x2ab65b(0xd4)],_0x5393d8=await profile[_0x2ab65b(0x159)]({'email':_0x50f0c1[_0x2ab65b(0x156)]}),_0x3ffac0=await staff[_0x2ab65b(0x159)]({'email':_0x50f0c1['email']});if(_0x50f0c1[_0x2ab65b(0x1db)]==_0x2ab65b(0x1c9)){const _0x237c93=await staff[_0x2ab65b(0x159)]({'email':_0x50f0c1['email']});}const _0x42b218=await master_shop[_0x2ab65b(0xd7)]();let _0x5eb349;if(_0x50f0c1[_0x2ab65b(0x1db)]==_0x2ab65b(0x1c9)){const _0x550c72=await staff['findOne']({'email':_0x50f0c1[_0x2ab65b(0x156)]});_0x5eb349=await purchases_finished[_0x2ab65b(0x1b3)]([{'$match':{'warehouse_name':_0x550c72[_0x2ab65b(0xb6)]}},{'$lookup':{'from':_0x2ab65b(0x1d7),'localField':_0x2ab65b(0x1d7),'foreignField':_0x2ab65b(0xe1),'as':_0x2ab65b(0x16f)}},{'$unwind':_0x2ab65b(0x167)},{'$unwind':'$product'},{'$group':{'_id':_0x2ab65b(0xab),'invoice':{'$first':_0x2ab65b(0xf4)},'suppliers':{'$first':_0x2ab65b(0x117)},'date':{'$first':_0x2ab65b(0x111)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2ab65b(0xbd)},'product':{'$push':_0x2ab65b(0xd1)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2ab65b(0x123)},'due_amount':{'$first':_0x2ab65b(0xc3)},'return_data':{'$first':_0x2ab65b(0x122)},'batch_code':{'$first':_0x2ab65b(0x138)},'expiry_date':{'$first':_0x2ab65b(0x1dd)},'suppliers_docs':{'$first':_0x2ab65b(0x167)},'total_product_quantity':{'$sum':_0x2ab65b(0x13e)},'level':{'$addToSet':_0x2ab65b(0x141)},'isle':{'$addToSet':_0x2ab65b(0x165)},'type':{'$addToSet':_0x2ab65b(0xb9)},'floorlevel':{'$addToSet':_0x2ab65b(0x197)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5eb349=await purchases_finished[_0x2ab65b(0x1b3)]([{'$match':{'typeOfProducts':_0x2ab65b(0xb1)}},{'$unwind':'$product'},{'$group':{'_id':_0x2ab65b(0xab),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2ab65b(0x111)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x2ab65b(0xb2)},'product':{'$push':_0x2ab65b(0xd1)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2ab65b(0x123)},'due_amount':{'$first':_0x2ab65b(0xc3)},'return_data':{'$first':_0x2ab65b(0x122)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2ab65b(0x1dd)},'suppliers_docs':{'$first':_0x2ab65b(0x167)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2ab65b(0x141)},'isle':{'$addToSet':_0x2ab65b(0x165)},'type':{'$addToSet':_0x2ab65b(0xb9)},'floorlevel':{'$addToSet':_0x2ab65b(0x197)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x42b218[0x0][_0x2ab65b(0x1a5)]==_0x2ab65b(0x136))var _0x5b9cc8=users['English'];else{if(_0x42b218[0x0]['language']==_0x2ab65b(0x194))var _0x5b9cc8=users[_0x2ab65b(0x194)];else{if(_0x42b218[0x0][_0x2ab65b(0x1a5)]==_0x2ab65b(0x195))var _0x5b9cc8=users[_0x2ab65b(0x195)];else{if(_0x42b218[0x0][_0x2ab65b(0x1a5)]==_0x2ab65b(0x196))var _0x5b9cc8=users['Spanish'];else{if(_0x42b218[0x0][_0x2ab65b(0x1a5)]==_0x2ab65b(0xc2))var _0x5b9cc8=users[_0x2ab65b(0xc2)];else{if(_0x42b218[0x0][_0x2ab65b(0x1a5)]==_0x2ab65b(0x12c))var _0x5b9cc8=users[_0x2ab65b(0x10c)];else{if(_0x42b218[0x0]['language']==_0x2ab65b(0x145))var _0x5b9cc8=users[_0x2ab65b(0x145)];else{if(_0x42b218[0x0][_0x2ab65b(0x1a5)]==_0x2ab65b(0x102))var _0x5b9cc8=users['Arabic'];}}}}}}}_0xca339f[_0x2ab65b(0x10e)](_0x2ab65b(0xe8),{'success':_0x4cd887['flash']('success'),'errors':_0x4cd887[_0x2ab65b(0xe0)](_0x2ab65b(0xeb)),'purchases':_0x5eb349,'role':_0x50f0c1,'profile':_0x5393d8,'master_shop':_0x42b218,'language':_0x5b9cc8});}catch(_0x470033){console[_0x2ab65b(0xd6)](_0x2ab65b(0xcd),_0x470033),_0xca339f[_0x2ab65b(0x1df)](0xc8)[_0x2ab65b(0x146)]({'message':_0x470033[_0x2ab65b(0x1d8)]});}});function BayBinSelected(_0x2f23be,_0x3d9896){var _0xc3c25=a0_0x355199,_0x121890=[],_0x52b549=[];if(_0x2f23be==_0xc3c25(0x1b2)){switch(_0x3d9896){case _0xc3c25(0xbb):_0x121890=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xc3c25(0x172):_0x121890=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x52b549=['DG'];}else{if(_0x2f23be==_0xc3c25(0x148)){switch(_0x3d9896){case _0xc3c25(0xbb):_0x121890=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xc3c25(0x172):_0x121890=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x52b549=['FG'];}}return{'levels':_0x121890,'identify':_0x52b549};}async function getRandom8DigitNumber(){var _0x4a5c40=a0_0x355199;const _0x696559=0x989680,_0x5353d9=0x5f5e0ff,_0x4b10ec=Math[_0x4a5c40(0x13f)](Math[_0x4a5c40(0x190)]()*(_0x5353d9-_0x696559+0x1))+_0x696559;var _0x9a9870;const _0x226199=await purchases_finished[_0x4a5c40(0x159)]({'invoice':_0x4a5c40(0x17a)+_0x4b10ec});return _0x226199&&_0x226199['length']>0x0?_0x9a9870=_0x4a5c40(0x17a)+_0x4b10ec:_0x9a9870=_0x4a5c40(0x17a)+_0x4b10ec,_0x9a9870;}router['get']('/view/add_purchases',auth,async(_0x56d469,_0x1fe807)=>{var _0x2e6d48=a0_0x355199;try{const {username:_0x2ab14d,email:_0x4ce7b2,role:_0x5d3ae3}=_0x56d469['user'],_0x14491f=_0x56d469[_0x2e6d48(0xd4)],_0x40397e=await profile[_0x2e6d48(0x159)]({'email':_0x14491f[_0x2e6d48(0x156)]}),_0x4f097f=await master_shop['find'](),_0x1a4042=await staff[_0x2e6d48(0x159)]({'email':_0x14491f[_0x2e6d48(0x156)]}),_0x13f41e=await suppliers['find']({});let _0x5593fb;if(_0x14491f[_0x2e6d48(0x1db)]==_0x2e6d48(0x1c9)){const _0x1c5cd6=await staff[_0x2e6d48(0x159)]({'email':_0x14491f['email']});_0x5593fb=await warehouse[_0x2e6d48(0x1b3)]([{'$match':{'status':_0x2e6d48(0xd0),'name':_0x1c5cd6[_0x2e6d48(0xb6)]}},{'$group':{'_id':_0x2e6d48(0x1cc),'name':{'$first':_0x2e6d48(0x1cc)}}}]);}else _0x5593fb=await warehouse[_0x2e6d48(0x1b3)]([{'$match':{'status':_0x2e6d48(0xd0)}},{'$group':{'_id':_0x2e6d48(0x1cc),'name':{'$first':_0x2e6d48(0x1cc)}}}]);const _0x11a05d=await product[_0x2e6d48(0xd7)]({}),_0xe1b6ae=await warehouse[_0x2e6d48(0xd7)]({'status':_0x2e6d48(0xd0)}),_0x73037c=await purchases_finished['find']({}),_0x24de9f=_0x73037c['length']+0x1,_0x46b671='INCF-'+_0x24de9f['toString']()[_0x2e6d48(0x162)](0x5,'0');var _0x33f461=[_0x2e6d48(0x1be),_0x2e6d48(0x1a8)];if(_0x4f097f[0x0][_0x2e6d48(0x1a5)]==_0x2e6d48(0x136))var _0x433eab=users['English'];else{if(_0x4f097f[0x0][_0x2e6d48(0x1a5)]==_0x2e6d48(0x194))var _0x433eab=users['Hindi'];else{if(_0x4f097f[0x0][_0x2e6d48(0x1a5)]==_0x2e6d48(0x195))var _0x433eab=users[_0x2e6d48(0x195)];else{if(_0x4f097f[0x0][_0x2e6d48(0x1a5)]=='Spanish')var _0x433eab=users[_0x2e6d48(0x196)];else{if(_0x4f097f[0x0]['language']==_0x2e6d48(0xc2))var _0x433eab=users[_0x2e6d48(0xc2)];else{if(_0x4f097f[0x0]['language']==_0x2e6d48(0x12c))var _0x433eab=users[_0x2e6d48(0x10c)];else{if(_0x4f097f[0x0]['language']==_0x2e6d48(0x145))var _0x433eab=users[_0x2e6d48(0x145)];else{if(_0x4f097f[0x0][_0x2e6d48(0x1a5)]=='Arabic\x20(ae)')var _0x433eab=users[_0x2e6d48(0x14e)];}}}}}}}const _0x52e279=getRandom8DigitNumber(),_0xcde82a=new Date(),_0x59ba21={'year':_0x2e6d48(0xba),'month':_0x2e6d48(0x1bd),'day':_0x2e6d48(0x1bd),'timeZone':'Asia/Manila'},_0x51b229=_0xcde82a[_0x2e6d48(0x113)]('en-CA',_0x59ba21);console['log'](_0x51b229),_0x52e279[_0x2e6d48(0x135)](_0x5c426d=>{var _0x181060=_0x2e6d48;_0x1fe807[_0x181060(0x10e)](_0x181060(0x130),{'success':_0x56d469[_0x181060(0xe0)](_0x181060(0xc0)),'errors':_0x56d469['flash'](_0x181060(0xeb)),'role':_0x14491f,'profile':_0x40397e,'suppliers':_0x13f41e,'warehouse':_0x5593fb,'product':_0x11a05d,'invoice':_0x5c426d,'master_shop':_0x4f097f,'language':_0x433eab,'find_data':_0xe1b6ae,'rooms_data':_0x33f461,'formattedDate':_0x51b229});})[_0x2e6d48(0xf3)](_0x1a9525=>{var _0x971177=_0x2e6d48;_0x56d469['flash'](_0x971177(0xeb),_0x971177(0x17c)),_0x1fe807[_0x971177(0x18e)](_0x971177(0x137));});}catch(_0x385684){console[_0x2e6d48(0xd6)](_0x385684);}}),router[a0_0x355199(0x182)](a0_0x355199(0xd3),auth,async(_0x456d93,_0x19d484)=>{var _0x5e3d5c=a0_0x355199;try{const {username:_0x45a898,email:_0x59bf88,role:_0x494ca6}=_0x456d93[_0x5e3d5c(0xd4)],_0x26f2e7=_0x456d93[_0x5e3d5c(0xd4)],_0x4afb2d=await profile[_0x5e3d5c(0x159)]({'email':_0x26f2e7[_0x5e3d5c(0x156)]}),_0x3d9237=await master_shop[_0x5e3d5c(0xd7)](),_0x4776b3=await staff[_0x5e3d5c(0x159)]({'email':_0x26f2e7[_0x5e3d5c(0x156)]}),_0x5412f6=await suppliers[_0x5e3d5c(0xd7)]({});let _0x2cb2f7;if(_0x26f2e7[_0x5e3d5c(0x1db)]==_0x5e3d5c(0x1c9)){const _0x3563e2=await staff['findOne']({'email':_0x26f2e7[_0x5e3d5c(0x156)]});_0x2cb2f7=await warehouse[_0x5e3d5c(0x1b3)]([{'$match':{'status':'Enabled','name':_0x3563e2[_0x5e3d5c(0xb6)]}},{'$group':{'_id':_0x5e3d5c(0x1cc),'name':{'$first':_0x5e3d5c(0x1cc)}}}]);}else _0x2cb2f7=await warehouse[_0x5e3d5c(0x1b3)]([{'$match':{'status':_0x5e3d5c(0xd0)}},{'$group':{'_id':_0x5e3d5c(0x1cc),'name':{'$first':_0x5e3d5c(0x1cc)}}}]);const _0x548fd1=await product[_0x5e3d5c(0xd7)]({}),_0x28a6a=await warehouse[_0x5e3d5c(0xd7)]({'status':'Enabled'}),_0x58a4f1=await purchases_finished[_0x5e3d5c(0xd7)]({}),_0x5b9099=_0x58a4f1[_0x5e3d5c(0x19f)]+0x1,_0x48fb43=_0x5e3d5c(0x17a)+_0x5b9099['toString']()[_0x5e3d5c(0x162)](0x5,'0');var _0x400a3c=[_0x5e3d5c(0x1be),'Enclosed'];if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]==_0x5e3d5c(0x136))var _0x44d422=users['English'];else{if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]==_0x5e3d5c(0x194))var _0x44d422=users[_0x5e3d5c(0x194)];else{if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]==_0x5e3d5c(0x195))var _0x44d422=users[_0x5e3d5c(0x195)];else{if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]==_0x5e3d5c(0x196))var _0x44d422=users[_0x5e3d5c(0x196)];else{if(_0x3d9237[0x0]['language']==_0x5e3d5c(0xc2))var _0x44d422=users[_0x5e3d5c(0xc2)];else{if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]==_0x5e3d5c(0x12c))var _0x44d422=users[_0x5e3d5c(0x10c)];else{if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]==_0x5e3d5c(0x145))var _0x44d422=users[_0x5e3d5c(0x145)];else{if(_0x3d9237[0x0][_0x5e3d5c(0x1a5)]=='Arabic\x20(ae)')var _0x44d422=users[_0x5e3d5c(0x14e)];}}}}}}}const _0x38c55b=getRandom8DigitNumber();_0x38c55b['then'](_0x3d8c7f=>{var _0x24856b=_0x5e3d5c;_0x19d484[_0x24856b(0x10e)]('add_purchases_finished_logs',{'success':_0x456d93['flash'](_0x24856b(0xc0)),'errors':_0x456d93[_0x24856b(0xe0)](_0x24856b(0xeb)),'role':_0x26f2e7,'profile':_0x4afb2d,'suppliers':_0x5412f6,'warehouse':_0x2cb2f7,'product':_0x548fd1,'invoice':_0x3d8c7f,'master_shop':_0x3d9237,'language':_0x44d422,'find_data':_0x28a6a,'rooms_data':_0x400a3c});})[_0x5e3d5c(0xf3)](_0x4d0554=>{var _0xd7827f=_0x5e3d5c;_0x456d93[_0xd7827f(0xe0)]('errors',_0xd7827f(0x17c)),_0x19d484[_0xd7827f(0x18e)]('/all_purchases_finished/view');});}catch(_0x233741){console[_0x5e3d5c(0xd6)](_0x233741);}}),router[a0_0x355199(0x182)]('/view/add_purchases/:id',auth,async(_0x2e1cbd,_0x28a96b)=>{var _0x2a45da=a0_0x355199;try{const _0x31e101=_0x2e1cbd[_0x2a45da(0x16a)]['id'];console['log'](_0x31e101);const _0x60bfa0=await master_shop[_0x2a45da(0xd7)]();console[_0x2a45da(0xd6)](_0x2a45da(0x198),_0x60bfa0);const _0x2b2616=await product[_0x2a45da(0x159)]({'name':_0x31e101});console[_0x2a45da(0xd6)]('product',_0x2b2616),_0x28a96b[_0x2a45da(0x1df)](0xc8)[_0x2a45da(0x146)]({'product_data':_0x2b2616,'master':_0x60bfa0});}catch(_0x5a9dfc){console[_0x2a45da(0xd6)]('add_purchases\x20error',_0x5a9dfc);}}),router['post'](a0_0x355199(0x19a),auth,async(_0x4e0675,_0x3b8fe5)=>{var _0x2e4fa6=a0_0x355199;try{const {invoice:_0x498565,date:_0x385090,warehouse_name:_0x1ad777,prod_name:_0x33ab90,note:_0x35c262,due_amount:_0x23df52,Room_name:_0x4ee15c,PO_number:_0x29637e,SCRN:_0x3ccb7a,ReqBy:_0x1342c0,dateofreq:_0xb9e297,suppliers:_0x43e33e,typeservicesData:_0x2e6e42,van:_0x47f1d8,typevehicle:_0x494ebd,driver:_0x5016af,plate:_0x418b4d,DRSI:_0x5ee73a,TSU:_0x5bd604,TFU:_0xe05110,JO_number:_0x1fb1fe,type_of_products:_0x2708c3}=_0x4e0675['body'];if(typeof _0x33ab90=='string')var _0x253854=[_0x4e0675['body'][_0x2e4fa6(0x11d)]],_0x1f6186=[_0x4e0675[_0x2e4fa6(0x1c5)]['prod_code']],_0xb195f4=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x10d)]],_0x25a886=[_0x4e0675[_0x2e4fa6(0x1c5)]['prod_primunit']],_0x56e797=[_0x4e0675['body'][_0x2e4fa6(0x154)]],_0x28c04e=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x105)]],_0xbf3405=[_0x4e0675['body'][_0x2e4fa6(0x1e3)]],_0x1d3176=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0xb0)]],_0x2f9a12=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x1ca)]],_0x282301=[_0x4e0675['body']['expiry_date']],_0x50f575=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x1d5)]],_0x10cc17=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0xcc)]],_0x33ab06=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0xf5)]],_0x48a6f7=[_0x4e0675['body'][_0x2e4fa6(0xde)]],_0x4f9535=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x12d)]],_0x2f91f6=[_0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x170)]],_0x43b9a1=[_0x4e0675['body'][_0x2e4fa6(0x1d4)]];else var _0x253854=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x11d)]],_0x1f6186=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x163)]],_0xb195f4=[..._0x4e0675[_0x2e4fa6(0x1c5)]['prod_Qty']],_0x25a886=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0xf9)]],_0x56e797=[..._0x4e0675[_0x2e4fa6(0x1c5)]['prod_secondunit']],_0x28c04e=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x105)]],_0xbf3405=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x1e3)]],_0x1d3176=[..._0x4e0675['body']['MaxStocks_data']],_0x2f9a12=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x1ca)]],_0x282301=[..._0x4e0675['body'][_0x2e4fa6(0x114)]],_0x50f575=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x1d5)]],_0x10cc17=[..._0x4e0675['body']['max_product_unit']],_0x33ab06=[..._0x4e0675['body'][_0x2e4fa6(0xf5)]],_0x48a6f7=[..._0x4e0675['body'][_0x2e4fa6(0xde)]],_0x4f9535=[..._0x4e0675['body'][_0x2e4fa6(0x12d)]],_0x2f91f6=[..._0x4e0675['body'][_0x2e4fa6(0x170)]],_0x43b9a1=[..._0x4e0675[_0x2e4fa6(0x1c5)][_0x2e4fa6(0x1d4)]];const _0x38bea5=_0x253854[_0x2e4fa6(0x1c8)](_0x556cc9=>{return _0x556cc9={'product_name':_0x556cc9};});_0x43b9a1[_0x2e4fa6(0x133)]((_0x353a07,_0x1461fd)=>{var _0x49e795=_0x2e4fa6;_0x38bea5[_0x1461fd]['product_id']=_0x353a07,_0x38bea5[_0x1461fd][_0x49e795(0x112)]=_0x385090;}),_0x2f91f6['forEach']((_0x2ef3ed,_0x53a373)=>{_0x38bea5[_0x53a373]['sales_category']=_0x2ef3ed;}),_0x1f6186['forEach']((_0x1f157d,_0xa08d9c)=>{var _0x1fbc57=_0x2e4fa6;_0x38bea5[_0xa08d9c][_0x1fbc57(0x1e5)]=_0x1f157d;}),_0x4f9535[_0x2e4fa6(0x133)]((_0x3bc3ee,_0xecc27b)=>{_0x38bea5[_0xecc27b]['uuid']=_0x3bc3ee;}),_0xb195f4[_0x2e4fa6(0x133)]((_0x4faca5,_0x5ca046)=>{var _0x41c555=_0x2e4fa6;_0x38bea5[_0x5ca046][_0x41c555(0xad)]=Math['abs'](_0x4faca5);}),_0x25a886[_0x2e4fa6(0x133)]((_0x520c19,_0x399bda)=>{var _0x48c715=_0x2e4fa6;_0x38bea5[_0x399bda][_0x48c715(0xa8)]=_0x520c19;}),_0x56e797[_0x2e4fa6(0x133)]((_0x54cc15,_0x4c2688)=>{_0x38bea5[_0x4c2688]['secondary_unit']=_0x54cc15;}),_0x28c04e[_0x2e4fa6(0x133)]((_0x38813a,_0x248c9e)=>{var _0x2fdd5e=_0x2e4fa6;_0x38bea5[_0x248c9e][_0x2fdd5e(0x105)]=_0x38813a;}),_0xbf3405[_0x2e4fa6(0x133)]((_0x3e4962,_0x492ec0)=>{var _0x22075b=_0x2e4fa6;_0x38bea5[_0x492ec0][_0x22075b(0x1e3)]=_0x3e4962;}),_0x1d3176[_0x2e4fa6(0x133)]((_0xc50fee,_0x2c0d6d)=>{_0x38bea5[_0x2c0d6d]['maxStocks']=_0xc50fee;}),_0x2f9a12[_0x2e4fa6(0x133)]((_0x508932,_0x229451)=>{var _0x5c954a=_0x2e4fa6;_0x38bea5[_0x229451][_0x5c954a(0x1ca)]=_0x508932;}),_0x282301[_0x2e4fa6(0x133)]((_0x4357b8,_0x3f5941)=>{var _0x2956a7=_0x2e4fa6;_0x38bea5[_0x3f5941][_0x2956a7(0x114)]=_0x4357b8;}),_0x50f575[_0x2e4fa6(0x133)]((_0x1c105a,_0x3c7aa5)=>{var _0x5665de=_0x2e4fa6;_0x38bea5[_0x3c7aa5][_0x5665de(0x16c)]=_0x1c105a;}),_0x10cc17[_0x2e4fa6(0x133)]((_0x385b6f,_0x501f42)=>{var _0x2e4089=_0x2e4fa6;_0x38bea5[_0x501f42][_0x2e4089(0x179)]=_0x385b6f;}),_0x33ab06[_0x2e4fa6(0x133)]((_0x196fd9,_0x149e20)=>{_0x38bea5[_0x149e20]['product_cat']=_0x196fd9;}),_0x48a6f7['forEach']((_0xac75ff,_0x248f58)=>{var _0x2ac4e8=_0x2e4fa6;_0x38bea5[_0x248f58][_0x2ac4e8(0xde)]=_0xac75ff;});const _0x3535d4=new invoice_for_incoming();await _0x3535d4[_0x2e4fa6(0x19c)]();for(let _0x1e8259=0x0;_0x1e8259<=_0x253854[_0x2e4fa6(0x19f)]-0x1;_0x1e8259++){_0x38bea5[_0x1e8259]['invoice']=_0x2e4fa6(0x1bb)+_0x3535d4[_0x2e4fa6(0x1ec)][_0x2e4fa6(0x14c)]()[_0x2e4fa6(0x162)](0x8,'0');}const _0x423520=await warehouse_validation_setup[_0x2e4fa6(0x1b3)]([{'$match':{'warehouse_name':_0x1ad777}}]);for(let _0x2f7440=0x0;_0x2f7440<=_0x423520[_0x2e4fa6(0x19f)]-0x1;_0x2f7440++){const _0xb9813c=_0x423520[_0x2f7440];for(let _0x16e106=0x0;_0x16e106<=_0xb9813c['product_data']['length']-0x1;_0x16e106++){const _0x198ad6=_0xb9813c[_0x2e4fa6(0x11e)][_0x16e106],_0xef530e=await warehouse[_0x2e4fa6(0x1b3)]([{'$match':{'name':_0xb9813c[_0x2e4fa6(0x1ea)],'room':_0xb9813c[_0x2e4fa6(0xfd)]}},{'$unwind':_0x2e4fa6(0x192)},{'$match':{'product_details.level':_0x198ad6[_0x2e4fa6(0x18d)],'product_details.bay':parseInt(_0x198ad6[_0x2e4fa6(0x1e8)]),'product_details.product_code':_0x198ad6['product_code']}}]);for(let _0x42f4c6=0x0;_0x42f4c6<=_0xef530e[_0x2e4fa6(0x19f)]-0x1;_0x42f4c6++){let _0x16ebf7=_0xef530e[_0x42f4c6],_0x43e82d=0x0;_0x16ebf7[_0x2e4fa6(0x1af)][_0x2e4fa6(0x1e5)]==_0x198ad6[_0x2e4fa6(0x1e5)]&&_0x16ebf7[_0x2e4fa6(0x1af)][_0x2e4fa6(0x18d)]==_0x198ad6[_0x2e4fa6(0x1e8)]&&_0x16ebf7[_0x2e4fa6(0x1af)][_0x2e4fa6(0xd2)]==_0x198ad6['bay']&&(_0x198ad6[_0x2e4fa6(0xfe)]=parseInt(_0x198ad6[_0x2e4fa6(0xfe)])-parseInt(_0x16ebf7[_0x2e4fa6(0x1af)][_0x2e4fa6(0x1a9)]),_0x43e82d++),_0x43e82d=='0'&&(parseInt(_0x198ad6[_0x2e4fa6(0xfe)])>0x0&&(_0x423520[_0x2f7440][_0x2e4fa6(0x11e)]=_0x423520[_0x2f7440]['product_data'][_0x2e4fa6(0x126)]({'bay':_0x198ad6[_0x2e4fa6(0x18d)],'bin':_0x198ad6[_0x2e4fa6(0x1e8)],'max':_0x198ad6['max'],'min':_0x198ad6[_0x2e4fa6(0xdb)],'product_code':_0x198ad6[_0x2e4fa6(0x1e5)],'product_id':_0x198ad6[_0x2e4fa6(0x1d4)],'product_name':_0x198ad6[_0x2e4fa6(0xef)]})));}}_0x423520[_0x2f7440][_0x2e4fa6(0x11e)]=_0x423520[_0x2f7440][_0x2e4fa6(0x11e)]['filter'](_0x3a92aa=>parseInt(_0x3a92aa[_0x2e4fa6(0xfe)])>0x0);}for(let _0x449c13=0x0;_0x449c13<=_0x423520['length']-0x1;_0x449c13++){const _0x29dec3=_0x423520[_0x449c13];for(let _0x3e22e8=0x0;_0x3e22e8<=_0x29dec3[_0x2e4fa6(0x11e)][_0x2e4fa6(0x19f)]-0x1;_0x3e22e8++){const _0x14f863=_0x29dec3[_0x2e4fa6(0x11e)][_0x3e22e8],_0x4c45cc=await warehouse_temporary[_0x2e4fa6(0x1b3)]([{'$match':{'warehouse':_0x29dec3[_0x2e4fa6(0x1ea)],'room_name':_0x29dec3['room'],'isConfirm':_0x2e4fa6(0x18b),'data_type':_0x2e4fa6(0x15e),'product_code':_0x14f863['product_code'],'level':_0x14f863['bay'],'bay':parseInt(_0x14f863['bin'])}}]);for(let _0x36e6cc=0x0;_0x36e6cc<=_0x4c45cc[_0x2e4fa6(0x19f)]-0x1;_0x36e6cc++){let _0xb068d8=_0x4c45cc[_0x36e6cc];console[_0x2e4fa6(0xd6)](_0xb068d8);let _0x2feaf9=0x0;_0xb068d8['product_code']==_0x14f863['product_code']&&_0xb068d8[_0x2e4fa6(0x18d)]==_0x14f863['bin']&&_0xb068d8[_0x2e4fa6(0xd2)]==_0x14f863['bay']&&(_0x14f863[_0x2e4fa6(0xfe)]=parseInt(_0x14f863[_0x2e4fa6(0xfe)])-parseInt(_0xb068d8[_0x2e4fa6(0x1a9)]),_0x2feaf9++),_0x2feaf9=='0'&&(parseInt(_0x14f863[_0x2e4fa6(0xfe)])>0x0&&(_0x423520[_0x449c13]['product_data']=_0x423520[_0x449c13][_0x2e4fa6(0x11e)][_0x2e4fa6(0x126)]({'bay':_0x14f863[_0x2e4fa6(0x18d)],'bin':_0x14f863[_0x2e4fa6(0x1e8)],'max':_0x14f863[_0x2e4fa6(0xfe)],'min':_0x14f863[_0x2e4fa6(0xdb)],'product_code':_0x14f863['product_code'],'product_id':_0x14f863[_0x2e4fa6(0x1d4)],'product_name':_0x14f863[_0x2e4fa6(0xef)]})));}}_0x423520[_0x449c13]['product_data']=_0x423520[_0x449c13][_0x2e4fa6(0x11e)][_0x2e4fa6(0x1c4)](_0x18c818=>parseInt(_0x18c818[_0x2e4fa6(0xfe)])>0x0);}let _0x5d15a7=[],_0x184231=0x0;for(let _0x4e27a7=0x0;_0x4e27a7<=_0x38bea5['length']-0x1;_0x4e27a7++){const _0x51106c=_0x38bea5[_0x4e27a7];let _0x4904c1=_0x51106c[_0x2e4fa6(0xad)];for(let _0x597760=0x0;_0x597760<=_0x423520['length']-0x1;_0x597760++){const _0x24b559=_0x423520[_0x597760];for(let _0x55289d=0x0;_0x55289d<=_0x24b559['product_data'][_0x2e4fa6(0x19f)]-0x1;_0x55289d++){const _0xa73fd7=_0x24b559['product_data'][_0x55289d];if(_0xa73fd7[_0x2e4fa6(0x1e5)]===_0x51106c[_0x2e4fa6(0x1e5)]){const _0x5f5c22=await warehouse['aggregate']([{'$match':{'name':_0x1ad777,'room':_0x24b559[_0x2e4fa6(0xfd)]}},{'$unwind':_0x2e4fa6(0x192)},{'$match':{'product_details.level':_0xa73fd7[_0x2e4fa6(0x18d)],'product_details.bay':parseInt(_0xa73fd7[_0x2e4fa6(0x1e8)])}}]);if(_0x5f5c22[_0x2e4fa6(0x19f)]==0x0){for(let _0x292c44=0x0;_0x292c44<=_0x24b559['product_data'][_0x2e4fa6(0x19f)]-0x1&&_0x4904c1>0x0;_0x292c44++){const _0x1f48ef=_0x24b559[_0x2e4fa6(0x11e)][_0x292c44];console[_0x2e4fa6(0xd6)](_0x51106c['product_code']+_0x2e4fa6(0x191)+_0x1f48ef[_0x2e4fa6(0x1e5)]+'\x20<>\x20'+_0x1f48ef[_0x2e4fa6(0xdb)]+_0x2e4fa6(0x16e)+_0x1f48ef[_0x2e4fa6(0xfe)]+'\x20<>\x20'+_0x1f48ef[_0x2e4fa6(0x18d)]+'\x20<>\x20'+_0x1f48ef[_0x2e4fa6(0x1e8)]);if(_0x51106c[_0x2e4fa6(0x1e5)]===_0x1f48ef['product_code']){_0x5d15a7[_0x184231]={};const _0x795d94=parseInt(_0x1f48ef[_0x2e4fa6(0xfe)]),_0x3b52d8=0x0;let _0x13ca61=_0x795d94-_0x3b52d8,_0x2aceff=Math[_0x2e4fa6(0xdb)](_0x4904c1,_0x13ca61);console[_0x2e4fa6(0xd6)](_0x2e4fa6(0x1b5)+_0x2aceff+'\x20units\x20of\x20'+_0x51106c[_0x2e4fa6(0xef)]+'\x20to\x20warehouse:\x20'+_0x24b559['warehouse_name']+_0x2e4fa6(0x129)+_0x24b559[_0x2e4fa6(0xfd)]+_0x2e4fa6(0x1b1)+_0x1f48ef['bay']+',\x20bin:\x20'+_0x1f48ef[_0x2e4fa6(0x1e8)]+_0x2e4fa6(0x18f)+_0x184231),_0x5d15a7[_0x184231][_0x2e4fa6(0xef)]=_0x51106c[_0x2e4fa6(0xef)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1e5)]=_0x51106c[_0x2e4fa6(0x1e5)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1d4)]=_0x51106c['product_id'],_0x5d15a7[_0x184231][_0x2e4fa6(0x112)]=_0x51106c[_0x2e4fa6(0x112)],_0x5d15a7[_0x184231][_0x2e4fa6(0xe6)]=_0x51106c[_0x2e4fa6(0xe6)],_0x5d15a7[_0x184231][_0x2e4fa6(0x12d)]=_0x51106c[_0x2e4fa6(0x12d)],_0x5d15a7[_0x184231][_0x2e4fa6(0xad)]=_0x2aceff,_0x5d15a7[_0x184231][_0x2e4fa6(0xa8)]=_0x51106c[_0x2e4fa6(0xa8)],_0x5d15a7[_0x184231][_0x2e4fa6(0x120)]=_0x51106c[_0x2e4fa6(0x120)],_0x5d15a7[_0x184231][_0x2e4fa6(0x105)]=_0x51106c['primary_code'],_0x5d15a7[_0x184231]['secondary_code']=_0x51106c[_0x2e4fa6(0x1e3)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1e6)]=_0x51106c[_0x2e4fa6(0x1e6)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1ca)]=_0x51106c[_0x2e4fa6(0x1ca)],_0x5d15a7[_0x184231][_0x2e4fa6(0x114)]=_0x51106c[_0x2e4fa6(0x114)],_0x5d15a7[_0x184231][_0x2e4fa6(0x16c)]=_0x51106c[_0x2e4fa6(0x16c)],_0x5d15a7[_0x184231]['maxperunit']=_0x51106c[_0x2e4fa6(0x179)],_0x5d15a7[_0x184231][_0x2e4fa6(0xc8)]=_0x51106c['product_cat'],_0x5d15a7[_0x184231][_0x2e4fa6(0x17f)]=_0x51106c[_0x2e4fa6(0x17f)],_0x5d15a7[_0x184231][_0x2e4fa6(0xde)]=_0x51106c[_0x2e4fa6(0xde)],_0x5d15a7[_0x184231][_0x2e4fa6(0xb7)]=_0x24b559[_0x2e4fa6(0xfd)],_0x5d15a7[_0x184231]['level']=_0x1f48ef[_0x2e4fa6(0x18d)],_0x5d15a7[_0x184231][_0x2e4fa6(0x18d)]=_0x1f48ef[_0x2e4fa6(0x1e8)],_0x4904c1-=_0x2aceff,_0x184231++;if(_0x4904c1<=0x0)break;}}if(_0x4904c1<=0x0){_0x4e0675[_0x2e4fa6(0xe0)](_0x2e4fa6(0xeb),_0x2e4fa6(0x171)+_0x4904c1+_0x2e4fa6(0x125));break;}if(_0x4904c1>0x0){console[_0x2e4fa6(0xd6)](_0x2e4fa6(0x1d9)+_0x4904c1+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');break;}}}}}if(_0x4904c1>0x0){const _0x1a628a=await warehouse[_0x2e4fa6(0x1b3)]([{'$match':{'name':_0x1ad777,'isStaging':_0x2e4fa6(0x1b7)}}]);_0x5d15a7[_0x184231]={},_0x5d15a7[_0x184231]['product_name']=_0x51106c['product_name'],_0x5d15a7[_0x184231]['product_code']=_0x51106c[_0x2e4fa6(0x1e5)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1d4)]=_0x51106c[_0x2e4fa6(0x1d4)],_0x5d15a7[_0x184231][_0x2e4fa6(0x112)]=_0x51106c[_0x2e4fa6(0x112)],_0x5d15a7[_0x184231][_0x2e4fa6(0xe6)]=_0x51106c['sales_category'],_0x5d15a7[_0x184231]['uuid']=_0x51106c[_0x2e4fa6(0x12d)],_0x5d15a7[_0x184231][_0x2e4fa6(0xad)]=_0x4904c1,_0x5d15a7[_0x184231][_0x2e4fa6(0xa8)]=_0x51106c[_0x2e4fa6(0xa8)],_0x5d15a7[_0x184231][_0x2e4fa6(0x120)]=_0x51106c[_0x2e4fa6(0x120)],_0x5d15a7[_0x184231]['primary_code']=_0x51106c[_0x2e4fa6(0x105)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1e3)]=_0x51106c[_0x2e4fa6(0x1e3)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1e6)]=_0x51106c[_0x2e4fa6(0x1e6)],_0x5d15a7[_0x184231][_0x2e4fa6(0x1ca)]=_0x51106c[_0x2e4fa6(0x1ca)],_0x5d15a7[_0x184231]['expiry_date']=_0x51106c[_0x2e4fa6(0x114)],_0x5d15a7[_0x184231][_0x2e4fa6(0x16c)]=_0x51106c[_0x2e4fa6(0x16c)],_0x5d15a7[_0x184231][_0x2e4fa6(0x179)]=_0x51106c['maxperunit'],_0x5d15a7[_0x184231][_0x2e4fa6(0xc8)]=_0x51106c['product_cat'],_0x5d15a7[_0x184231][_0x2e4fa6(0x17f)]=_0x51106c[_0x2e4fa6(0x17f)],_0x5d15a7[_0x184231][_0x2e4fa6(0xde)]=_0x51106c[_0x2e4fa6(0xde)],_0x5d15a7[_0x184231][_0x2e4fa6(0xb7)]=_0x1a628a[0x0][_0x2e4fa6(0xfd)],_0x5d15a7[_0x184231][_0x2e4fa6(0xd2)]=_0x2e4fa6(0xb8),_0x5d15a7[_0x184231][_0x2e4fa6(0x18d)]='1',console[_0x2e4fa6(0xd6)]('STAGING\x20AREA\x201'+_0x2e4fa6(0x16e)+_0x51106c['product_code']+_0x2e4fa6(0x1e4)+_0x51106c[_0x2e4fa6(0x1e5)]+_0x2e4fa6(0x16e)+_0x184231+'\x20<>\x20'+_0x4904c1),_0x4e0675['flash'](_0x2e4fa6(0xeb),_0x2e4fa6(0x171)+_0x4904c1+_0x2e4fa6(0xe2));}}const _0x5abf4d=_0x5d15a7[_0x2e4fa6(0x1c4)](_0x57edf9=>_0x57edf9[_0x2e4fa6(0xad)]!=='0'&&_0x57edf9['quantity']!==''),_0x404869=new purchases_finished({'invoice':'INC-'+_0x3535d4[_0x2e4fa6(0x1ec)][_0x2e4fa6(0x14c)]()[_0x2e4fa6(0x162)](0x8,'0'),'suppliers':_0x43e33e,'date':_0x385090,'warehouse_name':_0x1ad777,'product':_0x5abf4d,'note':_0x35c262,'due_amount':_0x23df52,'room':_0x4ee15c,'POnumber':_0x29637e,'SCRN':_0x3ccb7a,'JO_number':_0x1fb1fe,'ReqBy':_0x1342c0,'dateofreq':_0xb9e297,'typeservicesData':_0x2e6e42,'van':_0x47f1d8,'typevehicle':_0x494ebd,'driver':_0x5016af,'plate':_0x418b4d,'DRSI':_0x5ee73a,'TSU':_0x5bd604,'TFU':_0xe05110,'typeOfProducts':_0x2708c3}),_0x559ade=await _0x404869[_0x2e4fa6(0x19c)](),_0x333664=await purchases_finished[_0x2e4fa6(0x159)]({'_id':_0x559ade[_0x2e4fa6(0x15a)][_0x2e4fa6(0x11b)]()});_0x4e0675[_0x2e4fa6(0xe0)]('success',_0x2e4fa6(0xcb)),_0x3b8fe5[_0x2e4fa6(0x18e)](_0x2e4fa6(0xd9)+_0x333664[_0x2e4fa6(0x15a)][_0x2e4fa6(0x11b)]());}catch(_0x4dddf1){console[_0x2e4fa6(0xd6)](_0x4dddf1);}}),router[a0_0x355199(0x182)](a0_0x355199(0x10a),auth,async(_0x18040f,_0x5c614f)=>{var _0x455bc2=a0_0x355199;try{const {username:_0x29e777,email:_0x2ce1f9,role:_0x2004b5}=_0x18040f[_0x455bc2(0xd4)],_0x22bfc3=_0x18040f[_0x455bc2(0xd4)],_0xf9db89=_0x18040f[_0x455bc2(0x16a)]['id'],_0x11f697=await profile[_0x455bc2(0x159)]({'email':_0x22bfc3[_0x455bc2(0x156)]}),_0x941f6e=await master_shop['find'](),_0x5097a5=await staff['findOne']({'email':_0x22bfc3[_0x455bc2(0x156)]}),_0x488ab2=await suppliers[_0x455bc2(0xd7)]({});let _0x28d123;if(_0x22bfc3[_0x455bc2(0x1db)]==_0x455bc2(0x1c9)){const _0x564d5b=await staff['findOne']({'email':_0x22bfc3[_0x455bc2(0x156)]});_0x28d123=await warehouse[_0x455bc2(0x1b3)]([{'$match':{'status':_0x455bc2(0xd0),'name':_0x564d5b['warehouse']}},{'$group':{'_id':_0x455bc2(0x1cc),'name':{'$first':'$name'}}}]);}else _0x28d123=await warehouse[_0x455bc2(0x1b3)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x455bc2(0x1cc),'name':{'$first':_0x455bc2(0x1cc)}}}]);const _0x270f3e=await purchases_finished[_0x455bc2(0xed)](_0xf9db89);if(_0x941f6e[0x0][_0x455bc2(0x1a5)]==_0x455bc2(0x136))var _0x330245=users['English'];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]==_0x455bc2(0x194))var _0x330245=users[_0x455bc2(0x194)];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]=='German')var _0x330245=users[_0x455bc2(0x195)];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]=='Spanish')var _0x330245=users[_0x455bc2(0x196)];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]==_0x455bc2(0xc2))var _0x330245=users['French'];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]==_0x455bc2(0x12c))var _0x330245=users[_0x455bc2(0x10c)];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]==_0x455bc2(0x145))var _0x330245=users[_0x455bc2(0x145)];else{if(_0x941f6e[0x0][_0x455bc2(0x1a5)]==_0x455bc2(0x102))var _0x330245=users[_0x455bc2(0x14e)];}}}}}}}_0x5c614f[_0x455bc2(0x10e)](_0x455bc2(0x1c3),{'success':_0x18040f[_0x455bc2(0xe0)]('success'),'errors':_0x18040f[_0x455bc2(0xe0)](_0x455bc2(0xeb)),'role':_0x22bfc3,'profile':_0x11f697,'suppliers':_0x488ab2,'warehouse':_0x28d123,'master_shop':_0x941f6e,'language':_0x330245,'purchases_data':_0x270f3e});}catch(_0x140598){console['log'](_0x140598);}});async function get_warehouse_data(_0x6789ec,_0x1144f7){var _0x4c7068=a0_0x355199;try{const _0x43f648=await warehouse_temporary[_0x4c7068(0x159)]({'name':_0x6789ec,'room':_0x1144f7});if(!_0x43f648){const _0x4e23af=new warehouse_temporary({'name':_0x6789ec,'address':_0x6789ec,'status':_0x4c7068(0xd0),'room':_0x1144f7,'isStaging':_0x4c7068(0x18b)});return await _0x4e23af[_0x4c7068(0x19c)](),_0x4e23af;}else return _0x43f648;}catch(_0x353d52){console[_0x4c7068(0xdf)](_0x4c7068(0x108),_0x353d52);throw _0x353d52;}}router['post'](a0_0x355199(0x10a),auth,async(_0x1f2ce0,_0x8e7ce1)=>{var _0x579f2e=a0_0x355199;try{const _0x244f50=_0x1f2ce0[_0x579f2e(0x16a)]['id'],_0x51baff=await purchases_finished[_0x579f2e(0xed)](_0x244f50);let _0x588b99=[];_0x51baff['product'][_0x579f2e(0x133)]((_0x1ab144,_0x1870cf)=>{var _0x2d2298=_0x579f2e;_0x588b99[_0x1870cf]={},_0x588b99[_0x1870cf][_0x2d2298(0xb6)]=_0x51baff['warehouse_name'],_0x588b99[_0x1870cf][_0x2d2298(0x1d4)]=_0x1ab144['product_id'],_0x588b99[_0x1870cf]['product_name']=_0x1ab144[_0x2d2298(0xef)],_0x588b99[_0x1870cf][_0x2d2298(0x1e5)]=_0x1ab144[_0x2d2298(0x1e5)],_0x588b99[_0x1870cf][_0x2d2298(0x1a9)]=_0x1ab144[_0x2d2298(0xad)],_0x588b99[_0x1870cf][_0x2d2298(0x1a0)]=_0x1ab144[_0x2d2298(0xa8)],_0x588b99[_0x1870cf][_0x2d2298(0x120)]=_0x1ab144[_0x2d2298(0x120)],_0x588b99[_0x1870cf][_0x2d2298(0xd2)]=_0x1ab144[_0x2d2298(0xd2)],_0x588b99[_0x1870cf][_0x2d2298(0x18d)]=_0x1ab144[_0x2d2298(0x18d)],_0x588b99[_0x1870cf][_0x2d2298(0x105)]=_0x1ab144['primary_code'],_0x588b99[_0x1870cf][_0x2d2298(0x1e3)]=_0x1ab144[_0x2d2298(0x1e3)],_0x588b99[_0x1870cf][_0x2d2298(0x1e6)]=_0x1ab144['maxStocks'],_0x588b99[_0x1870cf][_0x2d2298(0x1ca)]=_0x1ab144[_0x2d2298(0x1ca)],_0x588b99[_0x1870cf][_0x2d2298(0x114)]=_0x1ab144[_0x2d2298(0x114)],_0x588b99[_0x1870cf][_0x2d2298(0x16c)]=_0x1ab144[_0x2d2298(0x16c)],_0x588b99[_0x1870cf][_0x2d2298(0x179)]=_0x1ab144[_0x2d2298(0x179)],_0x588b99[_0x1870cf][_0x2d2298(0xc8)]=_0x1ab144[_0x2d2298(0xc8)],_0x588b99[_0x1870cf]['room_name']=_0x1ab144[_0x2d2298(0xb7)],_0x588b99[_0x1870cf][_0x2d2298(0x17f)]=_0x1ab144[_0x2d2298(0x17f)],_0x588b99[_0x1870cf]['uuid']=_0x1ab144['uuid'],_0x588b99[_0x1870cf]['gross_price']=_0x1ab144['gross_price'],_0x588b99[_0x1870cf][_0x2d2298(0xe6)]=_0x1ab144[_0x2d2298(0xe6)],_0x588b99[_0x1870cf][_0x2d2298(0x112)]=_0x1ab144[_0x2d2298(0x112)],_0x588b99[_0x1870cf][_0x2d2298(0x103)]=_0x1ab144[_0x2d2298(0x15a)][_0x2d2298(0x11b)](),_0x588b99[_0x1870cf][_0x2d2298(0xaf)]=_0x2d2298(0x15e),_0x588b99[_0x1870cf][_0x2d2298(0x14a)]=_0x2d2298(0x1b7),_0x588b99[_0x1870cf][_0x2d2298(0x1c6)]='false';});for(let _0x32de8c=0x0;_0x32de8c<=_0x588b99[_0x579f2e(0x19f)]-0x1;_0x32de8c++){const _0x8e1953=_0x588b99[_0x32de8c],_0x2b4985=new warehouse_temporary(_0x8e1953);await _0x2b4985[_0x579f2e(0x19c)]();}_0x51baff[_0x579f2e(0x16d)]='true',await _0x51baff[_0x579f2e(0x19c)](),_0x1f2ce0[_0x579f2e(0xe0)](_0x579f2e(0xc0),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x8e7ce1[_0x579f2e(0x18e)]('/all_purchases_finished/process/'+_0x51baff['_id'][_0x579f2e(0x11b)]());}catch(_0x5b2bf6){}}),router[a0_0x355199(0x15c)](a0_0x355199(0xd3),auth,async(_0x1bc3d1,_0x4847f9)=>{var _0x40d563=a0_0x355199;try{const {invoice:_0xd2922d,date:_0x4f943d,warehouse_name:_0x4c3b25,prod_name:_0x5208d4,note:_0x48a1ce,due_amount:_0x5d0301,Room_name:_0x3a6b12,PO_number:_0x2331a7,SCRN:_0x28dc81,ReqBy:_0x352ff8,dateofreq:_0x43e80a,suppliers:_0x1fb183,typeservicesData:_0x26a097,van:_0x573408,typevehicle:_0x596c14,driver:_0x6d6a59,plate:_0x1fd634,DRSI:_0x455b6b,TSU:_0xd86db1,TFU:_0x608e4b,JO_number:_0x42ff83,type_of_products:_0x1e3bac}=_0x1bc3d1[_0x40d563(0x1c5)];if(typeof _0x5208d4==_0x40d563(0x134))var _0x39c2e5=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x11d)]],_0x538729=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x163)]],_0x27b3ca=[_0x1bc3d1['body'][_0x40d563(0x10d)]],_0x45aade=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xf9)]],_0x613820=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x154)]],_0x17862b=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x128)]],_0x5f1205=[_0x1bc3d1[_0x40d563(0x1c5)]['primary_code']],_0x4a1a4e=[_0x1bc3d1['body'][_0x40d563(0x1e3)]],_0x8805f6=[_0x1bc3d1['body'][_0x40d563(0xb0)]],_0x3a74b5=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x1ca)]],_0x38ae69=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x114)]],_0x112938=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x1d5)]],_0x467b8f=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xcc)]],_0x33f714=[_0x1bc3d1[_0x40d563(0x1c5)]['prod_cat']],_0x519847=[_0x1bc3d1['body'][_0x40d563(0x15b)]],_0x19490e=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xde)]],_0x4687e9=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x12d)]],_0x4137ee=[_0x1bc3d1['body'][_0x40d563(0x170)]],_0x13e530=[_0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xc5)]];else var _0x39c2e5=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x11d)]],_0x538729=[..._0x1bc3d1['body']['prod_code']],_0x27b3ca=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x10d)]],_0x45aade=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xf9)]],_0x613820=[..._0x1bc3d1[_0x40d563(0x1c5)]['prod_secondunit']],_0x17862b=[..._0x1bc3d1[_0x40d563(0x1c5)]['prod_level']],_0x5f1205=[..._0x1bc3d1[_0x40d563(0x1c5)]['primary_code']],_0x4a1a4e=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x1e3)]],_0x8805f6=[..._0x1bc3d1[_0x40d563(0x1c5)]['MaxStocks_data']],_0x3a74b5=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x1ca)]],_0x38ae69=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x114)]],_0x112938=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x1d5)]],_0x467b8f=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xcc)]],_0x33f714=[..._0x1bc3d1['body'][_0x40d563(0xf5)]],_0x519847=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x15b)]],_0x19490e=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xde)]],_0x4687e9=[..._0x1bc3d1[_0x40d563(0x1c5)]['uuid']],_0x4137ee=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0x170)]],_0x13e530=[..._0x1bc3d1[_0x40d563(0x1c5)][_0x40d563(0xc5)]];const _0x949327=_0x39c2e5[_0x40d563(0x1c8)](_0x493ace=>{return _0x493ace={'product_name':_0x493ace};});_0x13e530[_0x40d563(0x133)]((_0x64e3c5,_0x37c715)=>{var _0x13cc69=_0x40d563;_0x949327[_0x37c715][_0x13cc69(0x12f)]=_0x64e3c5;}),_0x4137ee[_0x40d563(0x133)]((_0x33500b,_0x8372fe)=>{_0x949327[_0x8372fe]['sales_category']=_0x33500b;}),_0x538729[_0x40d563(0x133)]((_0x440dc7,_0x392117)=>{var _0x5b9b26=_0x40d563;_0x949327[_0x392117][_0x5b9b26(0x1e5)]=_0x440dc7;}),_0x4687e9[_0x40d563(0x133)]((_0x51096c,_0x2a535d)=>{var _0x2f7adf=_0x40d563;_0x949327[_0x2a535d][_0x2f7adf(0x12d)]=_0x51096c;}),_0x27b3ca['forEach']((_0x1eed39,_0x2d5497)=>{var _0x43aee4=_0x40d563;_0x949327[_0x2d5497][_0x43aee4(0xad)]=Math[_0x43aee4(0xca)](_0x1eed39);}),_0x45aade[_0x40d563(0x133)]((_0x293cd1,_0x55abaa)=>{var _0x2ef2cb=_0x40d563;_0x949327[_0x55abaa][_0x2ef2cb(0xa8)]=_0x293cd1;}),_0x613820['forEach']((_0x53d99c,_0x593c95)=>{var _0x68b9d8=_0x40d563;_0x949327[_0x593c95][_0x68b9d8(0x120)]=_0x53d99c;}),_0x17862b[_0x40d563(0x133)]((_0x480c83,_0x2a5511)=>{var _0x2d1fb5=_0x40d563,_0x44cd86=_0x480c83[_0x2d1fb5(0xa9)](/[A-Za-z]+/)[0x0],_0x3de178=parseInt(_0x480c83['match'](/\d+/)[0x0]);_0x949327[_0x2a5511][_0x2d1fb5(0xd2)]=_0x44cd86,_0x949327[_0x2a5511][_0x2d1fb5(0x18d)]=_0x3de178;}),_0x5f1205[_0x40d563(0x133)]((_0x9667d1,_0x4c0560)=>{var _0x3e647b=_0x40d563;_0x949327[_0x4c0560][_0x3e647b(0x105)]=_0x9667d1;}),_0x4a1a4e[_0x40d563(0x133)]((_0x5153a2,_0x4a71cd)=>{var _0x593c2d=_0x40d563;_0x949327[_0x4a71cd][_0x593c2d(0x1e3)]=_0x5153a2;}),_0x8805f6[_0x40d563(0x133)]((_0x38036d,_0x37ec0e)=>{var _0x14b42e=_0x40d563;_0x949327[_0x37ec0e][_0x14b42e(0x1e6)]=_0x38036d;}),_0x3a74b5[_0x40d563(0x133)]((_0x13e4ca,_0x19f290)=>{var _0x4834ae=_0x40d563;_0x949327[_0x19f290][_0x4834ae(0x1ca)]=_0x13e4ca;}),_0x38ae69[_0x40d563(0x133)]((_0x363b22,_0x9a9369)=>{_0x949327[_0x9a9369]['expiry_date']=_0x363b22;}),_0x112938[_0x40d563(0x133)]((_0x46ee0,_0x76ced1)=>{var _0x41828d=_0x40d563;_0x949327[_0x76ced1][_0x41828d(0x16c)]=_0x46ee0;}),_0x467b8f[_0x40d563(0x133)]((_0x4123f9,_0x4d55dc)=>{var _0x277f07=_0x40d563;_0x949327[_0x4d55dc][_0x277f07(0x179)]=_0x4123f9;}),_0x33f714[_0x40d563(0x133)]((_0x271474,_0x34b99c)=>{var _0x33c019=_0x40d563;_0x949327[_0x34b99c][_0x33c019(0xc8)]=_0x271474;}),_0x519847[_0x40d563(0x133)]((_0x3c51c6,_0x42ba3d)=>{var _0x504e8a=_0x40d563;_0x949327[_0x42ba3d][_0x504e8a(0xb7)]=_0x3c51c6;}),_0x19490e['forEach']((_0x2547f5,_0x37184f)=>{var _0x5423b2=_0x40d563;_0x949327[_0x37184f][_0x5423b2(0xde)]=_0x2547f5;});const _0x22fdb5=new purchases_logs();await _0x22fdb5['save']();for(let _0x5f09ec=0x0;_0x5f09ec<=_0x519847[_0x40d563(0x19f)]-0x1;_0x5f09ec++){_0x949327[_0x5f09ec]['invoice']=_0x40d563(0xb3)+_0x22fdb5[_0x40d563(0x1ec)]['toString']()[_0x40d563(0x162)](0x8,'0');}const _0x2ac719=_0x949327[_0x40d563(0x1c4)](_0x5a1b28=>_0x5a1b28[_0x40d563(0xad)]!=='0'&&_0x5a1b28[_0x40d563(0xad)]!==''),_0x3b5bd4=new purchases_finished({'invoice':_0x40d563(0xb3)+_0x22fdb5[_0x40d563(0x1ec)][_0x40d563(0x14c)]()[_0x40d563(0x162)](0x8,'0'),'suppliers':_0x1fb183,'date':_0x4f943d,'warehouse_name':_0x4c3b25,'product':_0x2ac719,'note':_0x48a1ce,'due_amount':_0x5d0301,'room':_0x3a6b12,'POnumber':_0x2331a7,'SCRN':_0x28dc81,'JO_number':_0x42ff83,'ReqBy':_0x352ff8,'dateofreq':_0x43e80a,'typeservicesData':_0x26a097,'van':_0x573408,'typevehicle':_0x596c14,'driver':_0x6d6a59,'plate':_0x1fd634,'DRSI':_0x455b6b,'TSU':_0xd86db1,'TFU':_0x608e4b,'typeOfProducts':_0x1e3bac}),_0x48a29f=await _0x3b5bd4[_0x40d563(0x19c)](),_0x217b05=await purchases_finished[_0x40d563(0x159)]({'_id':_0x48a29f[_0x40d563(0x15a)][_0x40d563(0x11b)]()}),_0x4e3408=_0x217b05[_0x40d563(0x164)][_0x40d563(0x1c8)](async _0x416130=>{var _0x165ae7=_0x40d563;try{var _0x359c98=await warehouse[_0x165ae7(0x159)]({'name':_0x4c3b25,'room':_0x416130['room_name']}),_0x235268=0x0;const _0x263929=_0x359c98[_0x165ae7(0x1af)][_0x165ae7(0x1c8)](_0x503774=>{var _0x1ff9e6=_0x165ae7;console[_0x1ff9e6(0xd6)](_0x503774[_0x1ff9e6(0xef)]+'=='+_0x416130[_0x1ff9e6(0xef)]+'&&'+_0x503774[_0x1ff9e6(0x18d)]+'=='+_0x416130['bay']+'&&'+_0x503774['expiry_date']+'=='+_0x416130[_0x1ff9e6(0x114)]+'&&'+_0x503774['production_date']+'=='+_0x416130[_0x1ff9e6(0x16c)]+'&&'+_0x503774['batch_code']+'=='+_0x416130[_0x1ff9e6(0x1ca)]+'&&'+_0x503774['invoice']+'=='+_0x217b05[_0x1ff9e6(0x17f)]),_0x503774[_0x1ff9e6(0xef)]==_0x416130[_0x1ff9e6(0xef)]&&_0x503774[_0x1ff9e6(0x18d)]==_0x416130[_0x1ff9e6(0x18d)]&&_0x503774[_0x1ff9e6(0xd2)]==_0x416130[_0x1ff9e6(0xd2)]&&_0x503774[_0x1ff9e6(0x114)]==_0x416130[_0x1ff9e6(0x114)]&&_0x503774[_0x1ff9e6(0x16c)]==_0x416130['production_date']&&_0x503774[_0x1ff9e6(0x1ca)]==_0x416130[_0x1ff9e6(0x1ca)]&&_0x503774[_0x1ff9e6(0x17f)]==_0x217b05[_0x1ff9e6(0x17f)]&&(_0x503774['product_stock']=Math['abs'](_0x503774[_0x1ff9e6(0x1a9)])+Math[_0x1ff9e6(0xca)](_0x416130[_0x1ff9e6(0xad)]),_0x235268++);});return _0x235268==0x0&&(_0x359c98[_0x165ae7(0x1af)]=_0x359c98[_0x165ae7(0x1af)][_0x165ae7(0x126)]({'product_name':_0x416130[_0x165ae7(0xef)],'product_stock':Math[_0x165ae7(0xca)](_0x416130[_0x165ae7(0xad)]),'primary_code':_0x416130[_0x165ae7(0x105)],'secondary_code':_0x416130['secondary_code'],'product_code':_0x416130[_0x165ae7(0x1e5)],'bay':_0x416130[_0x165ae7(0x18d)],'level':_0x416130[_0x165ae7(0xd2)],'maxProducts':_0x416130[_0x165ae7(0x1e6)],'unit':_0x416130[_0x165ae7(0xa8)],'secondary_unit':_0x416130['secondary_unit'],'expiry_date':_0x416130['expiry_date'],'production_date':_0x416130['production_date'],'maxProducts':_0x416130[_0x165ae7(0x1e6)],'maxPerUnit':_0x416130[_0x165ae7(0x179)],'batch_code':_0x416130['batch_code'],'product_cat':_0x416130[_0x165ae7(0xc8)],'invoice':_0x416130['invoice'],'id_incoming':_0x416130[_0x165ae7(0x15a)],'uuid':_0x416130[_0x165ae7(0x12d)],'gross_price':_0x416130[_0x165ae7(0xde)],'sales_category':_0x416130[_0x165ae7(0xe6)],'type_products':_0x416130[_0x165ae7(0x12f)]})),_0x359c98;}catch(_0x1402a9){return console[_0x165ae7(0xdf)](_0x165ae7(0xc4),_0x1402a9),null;}});Promise[_0x40d563(0x12e)](_0x4e3408)['then'](async _0x128a2d=>{var _0x34199a=_0x40d563;try{for(const _0x411878 of _0x128a2d){await warehouse[_0x34199a(0xcf)]({'_id':_0x411878['_id']},{'$addToSet':{'product_details':{'$each':_0x411878['product_details']}}});}const _0x15d347=await master_shop[_0x34199a(0xd7)](),_0x3bc4fb=await email_settings['findOne'](),_0xb3900b=await supervisor_settings['find']();var _0x229578=_0x217b05[_0x34199a(0x164)],_0xf9d826='',_0x29f7cf;for(_0x29f7cf in _0x229578){var _0x1467d0='FG';_0x217b05['warehouse_name']==_0x34199a(0x1b2)&&(_0x1467d0='DG'),_0xf9d826+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x229578[_0x29f7cf]['product_name']+_0x34199a(0x17b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x229578[_0x29f7cf][_0x34199a(0x1e5)]+_0x34199a(0x17b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x229578[_0x29f7cf][_0x34199a(0xad)]+_0x34199a(0x17b)+_0x34199a(0x1da)+_0x229578[_0x29f7cf]['standard_unit']+'</td>'+_0x34199a(0x1da)+_0x229578[_0x29f7cf][_0x34199a(0x120)]+_0x34199a(0x17b)+_0x34199a(0x1da)+_0x217b05[_0x34199a(0x1ea)]+_0x34199a(0x17b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x229578[_0x29f7cf][_0x34199a(0xb7)]+_0x34199a(0x17b)+_0x34199a(0x1da)+_0x1467d0+_0x229578[_0x29f7cf]['bay']+_0x34199a(0x17b),_0x34199a(0x178);}let _0x1ec295=nodemailer[_0x34199a(0x155)]({'host':_0x3bc4fb[_0x34199a(0x1dc)],'port':Number(_0x3bc4fb[_0x34199a(0x184)]),'secure':![],'auth':{'user':_0x3bc4fb['email'],'pass':_0x3bc4fb[_0x34199a(0x11f)]}}),_0x415595={'from':_0x3bc4fb['email'],'to':_0xb3900b[0x0][_0x34199a(0x186)],'subject':_0x34199a(0x14f),'attachments':[{'filename':_0x34199a(0x199),'path':__dirname+_0x34199a(0x1d1)+'/upload/'+_0x15d347[0x0]['image'],'cid':'logo'}],'html':_0x34199a(0xe9)+'<html><head><title></title>'+_0x34199a(0x150)+_0x34199a(0x1e1)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x34199a(0x1e1)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x34199a(0x1c2)+_0x34199a(0x1e1)+_0x34199a(0x173)+_0x15d347[0x0][_0x34199a(0x1bf)]+'\x20</h2>'+_0x34199a(0x1c2)+_0x34199a(0x1c2)+'<hr\x20class=\x22my-3\x22>'+_0x34199a(0x1e1)+_0x34199a(0x12b)+_0x34199a(0x17d)+_0x217b05[_0x34199a(0x17f)]+'\x20'+_0x34199a(0x169)+_0x34199a(0xff)+_0x217b05[_0x34199a(0xe7)]+'\x20'+'</span>'+_0x34199a(0x174)+_0x34199a(0x1c2)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x34199a(0x104)+'<tr>'+_0x34199a(0x193)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x34199a(0xda)+_0x34199a(0x1cd)+_0x34199a(0x13a)+_0x34199a(0x1b0)+_0x34199a(0x106)+_0x34199a(0x178)+'</thead>'+_0x34199a(0x1d3)+'\x20'+_0xf9d826+'\x20'+_0x34199a(0xac)+_0x34199a(0x161)+_0x34199a(0x1e1)+_0x34199a(0xf1)+_0x34199a(0x1ce)+_0x15d347[0x0][_0x34199a(0x1bf)]+_0x34199a(0x174)+_0x34199a(0x1c2)+_0x34199a(0x1c2)+'</body></html>'};_0x1ec295[_0x34199a(0x1b8)](_0x415595,function(_0x372664,_0x5d7304){var _0x2feb10=_0x34199a;_0x372664?(console[_0x2feb10(0xd6)](_0x372664),console['log'](_0x2feb10(0x177))):console['log']('Email\x20sent\x20successfully');});}catch(_0x3673f5){console[_0x34199a(0xdf)](_0x3673f5),_0x4847f9['status'](0x1f4)[_0x34199a(0x146)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x3673f5[_0x34199a(0x1d8)]});}})['catch'](_0x6c5892=>{var _0x52dd85=_0x40d563;console[_0x52dd85(0xdf)](_0x6c5892);}),_0x1bc3d1[_0x40d563(0xe0)](_0x40d563(0xc0),_0x40d563(0xcb)),_0x4847f9[_0x40d563(0x18e)]('/all_purchases_finished/preview/'+_0x217b05['_id'][_0x40d563(0x11b)]());}catch(_0x3f880d){console['log'](_0x3f880d);}}),router[a0_0x355199(0x182)](a0_0x355199(0xe3),auth,async(_0x341458,_0x39ee2b)=>{var _0x488af5=a0_0x355199;try{const {username:_0x329c7,email:_0x10d4c5,role:_0x428cbe}=_0x341458[_0x488af5(0xd4)],_0x45dbe6=_0x341458[_0x488af5(0xd4)],_0x28eff0=await profile[_0x488af5(0x159)]({'email':_0x45dbe6[_0x488af5(0x156)]}),_0x2440f5=await master_shop[_0x488af5(0xd7)](),_0x5af853=_0x341458[_0x488af5(0x16a)]['id'],_0x3c0288=await purchases_finished[_0x488af5(0xed)](_0x5af853),_0x3da40a=await suppliers[_0x488af5(0xd7)]({});let _0x37519a;if(_0x45dbe6[_0x488af5(0x1db)]==_0x488af5(0x1c9)){const _0x50a6a0=await staff[_0x488af5(0x159)]({'email':_0x45dbe6[_0x488af5(0x156)]});_0x37519a=await warehouse[_0x488af5(0xd7)]({'status':_0x488af5(0xd0),'name':_0x50a6a0['warehouse'],'warehouse_category':_0x488af5(0x1a6)});}else _0x37519a=await warehouse[_0x488af5(0x1b3)]([{'$match':{'status':_0x488af5(0xd0),'warehouse_category':_0x488af5(0x1a6)}},{'$group':{'_id':_0x488af5(0x1cc),'name':{'$first':_0x488af5(0x1cc)}}}]);const _0x489e20=await product[_0x488af5(0xd7)]({}),_0x4a6a0c=BayBinSelected(_0x3c0288[_0x488af5(0x1ea)],_0x3c0288['room']);let _0x3ceea1=new Date(_0x3c0288[_0x488af5(0x114)]),_0x1e6a03=('0'+_0x3ceea1[_0x488af5(0x168)]())[_0x488af5(0xae)](-0x2),_0x22f5f9=('0'+(_0x3ceea1[_0x488af5(0xfb)]()+0x1))[_0x488af5(0xae)](-0x2),_0x4a55e2=_0x3ceea1[_0x488af5(0x19b)](),_0x197a5b=_0x4a55e2+'-'+_0x22f5f9+'-'+_0x1e6a03;if(_0x2440f5[0x0][_0x488af5(0x1a5)]=='English\x20(US)'){var _0x33ae7b=users[_0x488af5(0x139)];console[_0x488af5(0xd6)](_0x33ae7b);}else{if(_0x2440f5[0x0][_0x488af5(0x1a5)]==_0x488af5(0x194))var _0x33ae7b=users[_0x488af5(0x194)];else{if(_0x2440f5[0x0][_0x488af5(0x1a5)]=='German')var _0x33ae7b=users[_0x488af5(0x195)];else{if(_0x2440f5[0x0][_0x488af5(0x1a5)]=='Spanish')var _0x33ae7b=users['Spanish'];else{if(_0x2440f5[0x0][_0x488af5(0x1a5)]==_0x488af5(0xc2))var _0x33ae7b=users[_0x488af5(0xc2)];else{if(_0x2440f5[0x0][_0x488af5(0x1a5)]=='Portuguese\x20(BR)')var _0x33ae7b=users['Portuguese'];else{if(_0x2440f5[0x0]['language']==_0x488af5(0x145))var _0x33ae7b=users[_0x488af5(0x145)];else{if(_0x2440f5[0x0][_0x488af5(0x1a5)]==_0x488af5(0x102))var _0x33ae7b=users['Arabic'];}}}}}}}_0x39ee2b[_0x488af5(0x10e)](_0x488af5(0xa7),{'success':_0x341458['flash'](_0x488af5(0xc0)),'errors':_0x341458['flash'](_0x488af5(0xeb)),'role':_0x45dbe6,'profile':_0x28eff0,'purchases':_0x3c0288,'suppliers':_0x3da40a,'warehouse':_0x37519a,'product':_0x489e20,'master_shop':_0x2440f5,'language':_0x33ae7b,'ed_fullDate':_0x197a5b,'dataSelected':_0x4a6a0c});}catch(_0xe38a7e){console[_0x488af5(0xd6)](_0xe38a7e);}}),router['get'](a0_0x355199(0x140),auth,async(_0x324cb5,_0x4d4ba7)=>{var _0x217f1e=a0_0x355199;try{const {username:_0x19ff25,email:_0x2aabaf,role:_0x13520d}=_0x324cb5[_0x217f1e(0xd4)],_0x229c9e=_0x324cb5[_0x217f1e(0xd4)],_0x21f467=await profile[_0x217f1e(0x159)]({'email':_0x229c9e[_0x217f1e(0x156)]}),_0x31a1b7=await master_shop[_0x217f1e(0xd7)](),_0x54775d=_0x324cb5['params']['id'],_0x2a028f=await purchases_finished[_0x217f1e(0xed)](_0x54775d),_0x1464ef=await suppliers['find']({});let _0x4febb8;if(_0x229c9e['role']=='staff'){const _0x5b1a77=await staff[_0x217f1e(0x159)]({'email':_0x229c9e[_0x217f1e(0x156)]});_0x4febb8=await warehouse[_0x217f1e(0xd7)]({'status':_0x217f1e(0xd0),'name':_0x5b1a77[_0x217f1e(0xb6)],'warehouse_category':'Finished\x20Goods'});}else _0x4febb8=await warehouse['aggregate']([{'$match':{'status':_0x217f1e(0xd0),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x217f1e(0x1cc),'name':{'$first':_0x217f1e(0x1cc)}}}]);const _0x4826be=await product[_0x217f1e(0xd7)]({}),_0x33a3af=BayBinSelected(_0x2a028f[_0x217f1e(0x1ea)],_0x2a028f[_0x217f1e(0xfd)]);let _0x3fe075=new Date(_0x2a028f[_0x217f1e(0x114)]),_0x19d299=('0'+_0x3fe075[_0x217f1e(0x168)]())[_0x217f1e(0xae)](-0x2),_0x306073=('0'+(_0x3fe075['getMonth']()+0x1))[_0x217f1e(0xae)](-0x2),_0x856247=_0x3fe075[_0x217f1e(0x19b)](),_0x5bd2f3=_0x856247+'-'+_0x306073+'-'+_0x19d299;if(_0x31a1b7[0x0]['language']==_0x217f1e(0x136)){var _0x411b00=users['English'];console[_0x217f1e(0xd6)](_0x411b00);}else{if(_0x31a1b7[0x0][_0x217f1e(0x1a5)]==_0x217f1e(0x194))var _0x411b00=users[_0x217f1e(0x194)];else{if(_0x31a1b7[0x0][_0x217f1e(0x1a5)]==_0x217f1e(0x195))var _0x411b00=users[_0x217f1e(0x195)];else{if(_0x31a1b7[0x0][_0x217f1e(0x1a5)]==_0x217f1e(0x196))var _0x411b00=users[_0x217f1e(0x196)];else{if(_0x31a1b7[0x0][_0x217f1e(0x1a5)]==_0x217f1e(0xc2))var _0x411b00=users[_0x217f1e(0xc2)];else{if(_0x31a1b7[0x0][_0x217f1e(0x1a5)]==_0x217f1e(0x12c))var _0x411b00=users['Portuguese'];else{if(_0x31a1b7[0x0][_0x217f1e(0x1a5)]==_0x217f1e(0x145))var _0x411b00=users['Chinese'];else{if(_0x31a1b7[0x0]['language']==_0x217f1e(0x102))var _0x411b00=users[_0x217f1e(0x14e)];}}}}}}}_0x4d4ba7['render'](_0x217f1e(0x1cf),{'success':_0x324cb5[_0x217f1e(0xe0)](_0x217f1e(0xc0)),'errors':_0x324cb5[_0x217f1e(0xe0)](_0x217f1e(0xeb)),'role':_0x229c9e,'profile':_0x21f467,'purchases':_0x2a028f,'suppliers':_0x1464ef,'warehouse':_0x4febb8,'product':_0x4826be,'master_shop':_0x31a1b7,'language':_0x411b00,'ed_fullDate':_0x5bd2f3,'dataSelected':_0x33a3af});}catch(_0x3519d6){console['log'](_0x3519d6);}}),router[a0_0x355199(0x15c)](a0_0x355199(0x140),auth,async(_0x5e68cb,_0x279f96)=>{var _0x42a02c=a0_0x355199;try{const _0x27892d=_0x5e68cb[_0x42a02c(0x16a)]['id'],_0x178bee=await purchases_finished[_0x42a02c(0x159)]({'_id':_0x5e68cb['params']['id']}),_0x3c9014=await warehouse[_0x42a02c(0x159)]({'name':_0x178bee[_0x42a02c(0x1ea)],'room':_0x178bee[_0x42a02c(0xfd)]});_0x178bee[_0x42a02c(0x164)][_0x42a02c(0x133)](_0x2fbd69=>{var _0x3996cf=_0x42a02c;const _0x1a277c=_0x3c9014[_0x3996cf(0x1af)][_0x3996cf(0x1c8)](_0x12d155=>{var _0x5244a3=_0x3996cf;_0x12d155[_0x5244a3(0xef)]==_0x2fbd69['product_name']&&_0x12d155[_0x5244a3(0x18d)]==_0x2fbd69[_0x5244a3(0x18d)]&&(_0x12d155['product_stock']=parseInt(_0x12d155[_0x5244a3(0x1a9)])-parseInt(_0x2fbd69[_0x5244a3(0xad)]));});}),await _0x3c9014['save']();const {invoice:_0x7c953f,suppliers:_0x253299,date:_0x24757b,warehouse_name:_0x4f1470,prod_name:_0x1d0072,prod_code:_0x22a9ee,prod_qty:_0x48cc1e,prod_unit:_0x2411a1,prod_secondunit:_0x3016d5,prod_level:_0x15a50,prod_isle:_0x743c70,prod_pallet:_0x4e8de7,note:_0x47e759,expiry_date:_0x427785,batch_code:_0x242f54,paid_amount:_0x23120c,due_amount:_0x48ea59,Room_name:_0x5a6867,primary_code:_0x5cffdf,secondary_code:_0x547eb7,PO_number:_0x1ff757,JO_number:_0x51c0bb}=_0x5e68cb[_0x42a02c(0x1c5)];if(typeof _0x1d0072==_0x42a02c(0x134))var _0x40cf80=[_0x5e68cb['body'][_0x42a02c(0x11d)]],_0x13b0d9=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x163)]],_0x1b771b=[_0x5e68cb['body'][_0x42a02c(0x149)]],_0x2049aa=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x1c7)]],_0x289278=[_0x5e68cb['body'][_0x42a02c(0x154)]],_0x4099c1=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x128)]],_0x104f4b=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x105)]],_0x32c421=[_0x5e68cb[_0x42a02c(0x1c5)]['secondary_code']],_0x1e3fd5=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0xb0)]],_0x1910dd=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x1ca)]],_0x5d7d31=[_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x114)]];else var _0x40cf80=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x11d)]],_0x13b0d9=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x163)]],_0x1b771b=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x149)]],_0x2049aa=[..._0x5e68cb['body'][_0x42a02c(0x1c7)]],_0x289278=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x154)]],_0x4099c1=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x128)]],_0x104f4b=[..._0x5e68cb['body'][_0x42a02c(0x105)]],_0x32c421=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x1e3)]],_0x1e3fd5=[..._0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0xb0)]],_0x1910dd=[..._0x5e68cb[_0x42a02c(0x1c5)]['batch_code']],_0x5d7d31=[..._0x5e68cb['body'][_0x42a02c(0x114)]];const _0x46618a=_0x40cf80[_0x42a02c(0x1c8)](_0x54af5b=>{return _0x54af5b={'product_name':_0x54af5b};});_0x13b0d9[_0x42a02c(0x133)]((_0x2c77ef,_0x50a7bd)=>{_0x46618a[_0x50a7bd]['product_code']=_0x2c77ef;}),_0x1b771b['forEach']((_0x7f6ddf,_0x9ea638)=>{var _0x486f85=_0x42a02c;_0x46618a[_0x9ea638][_0x486f85(0xad)]=_0x7f6ddf;}),_0x2049aa[_0x42a02c(0x133)]((_0x14c70c,_0xb0ebdd)=>{var _0x133dd5=_0x42a02c;_0x46618a[_0xb0ebdd][_0x133dd5(0xa8)]=_0x14c70c;}),_0x289278[_0x42a02c(0x133)]((_0xa2c881,_0x370e45)=>{var _0xa066b=_0x42a02c;_0x46618a[_0x370e45][_0xa066b(0x120)]=_0xa2c881;}),_0x4099c1[_0x42a02c(0x133)]((_0x1fb3df,_0xeae131)=>{var _0x3edbe6=_0x42a02c;_0x46618a[_0xeae131][_0x3edbe6(0x18d)]=_0x1fb3df;}),_0x104f4b[_0x42a02c(0x133)]((_0x1e956a,_0x8ca8d)=>{var _0xa5fbc6=_0x42a02c;_0x46618a[_0x8ca8d][_0xa5fbc6(0x105)]=_0x1e956a;}),_0x32c421[_0x42a02c(0x133)]((_0x358d01,_0x2d9a18)=>{var _0x5b6860=_0x42a02c;_0x46618a[_0x2d9a18][_0x5b6860(0x1e3)]=_0x358d01;}),_0x1e3fd5[_0x42a02c(0x133)]((_0x5623a3,_0x4014f0)=>{var _0x226fa1=_0x42a02c;_0x46618a[_0x4014f0][_0x226fa1(0x1e6)]=_0x5623a3;}),_0x1910dd[_0x42a02c(0x133)]((_0x1a92f4,_0x2e754c)=>{var _0x4f2efe=_0x42a02c;_0x46618a[_0x2e754c][_0x4f2efe(0x1ca)]=_0x1a92f4;}),_0x5d7d31[_0x42a02c(0x133)]((_0x4a0eca,_0x46a500)=>{_0x46618a[_0x46a500]['expiry_date']=_0x4a0eca;});const _0x38e5f6=_0x46618a[_0x42a02c(0x1c4)](_0xbc2587=>_0xbc2587[_0x42a02c(0xad)]!=='0'&&_0xbc2587['quantity']!=='');_0x178bee[_0x42a02c(0x17f)]=_0x7c953f,_0x178bee[_0x42a02c(0x1d7)]=_0x253299,_0x178bee[_0x42a02c(0xe7)]=_0x24757b,_0x178bee[_0x42a02c(0x1ea)]=_0x4f1470,_0x178bee['product']=_0x38e5f6,_0x178bee['note']=_0x47e759,_0x178bee[_0x42a02c(0x18a)]=_0x23120c,_0x178bee[_0x42a02c(0x1ab)]=_0x48ea59,_0x178bee['room']=_0x5a6867,_0x178bee['POnumber']=_0x1ff757,_0x178bee['JO_number']=_0x51c0bb;const _0x561b77=await _0x178bee[_0x42a02c(0x19c)](),_0x30c4f0=await warehouse[_0x42a02c(0x159)]({'name':_0x5e68cb[_0x42a02c(0x1c5)]['warehouse_name'],'room':_0x5e68cb['body'][_0x42a02c(0x1e9)]});_0x178bee['product']['forEach'](_0x3dc27f=>{var _0x40debe=_0x42a02c,_0x215965=0x0;const _0x2f8318=_0x30c4f0[_0x40debe(0x1af)][_0x40debe(0x1c8)](_0x523923=>{var _0x4ba850=_0x40debe;_0x523923[_0x4ba850(0xef)]==_0x3dc27f['product_name']&&_0x523923['bay']==_0x3dc27f[_0x4ba850(0x18d)]&&(_0x523923[_0x4ba850(0x1a9)]=parseInt(_0x523923[_0x4ba850(0x1a9)])+parseInt(_0x3dc27f['quantity']),_0x215965++);});_0x215965=='0'&&(_0x30c4f0[_0x40debe(0x1af)]=_0x30c4f0['product_details'][_0x40debe(0x126)]({'product_name':_0x3dc27f['product_name'],'product_stock':_0x3dc27f['quantity'],'primary_code':_0x3dc27f['primary_code'],'secondary_code':_0x3dc27f['secondary_code'],'product_code':_0x3dc27f[_0x40debe(0x1e5)],'bay':_0x3dc27f[_0x40debe(0x18d)],'maxProducts':_0x3dc27f[_0x40debe(0x1e6)],'unit':_0x3dc27f[_0x40debe(0xa8)],'secondary_unit':_0x3dc27f['secondary_unit'],'expiry_date':_0x3dc27f[_0x40debe(0x114)]}));}),await _0x30c4f0[_0x42a02c(0x19c)]();const _0x5a3035=await s_payment_data[_0x42a02c(0x159)]({'invoice':_0x5e68cb['body'][_0x42a02c(0x17f)]});if(_0x5a3035===null){}else console[_0x42a02c(0xd6)](_0x42a02c(0x1d7),_0x5a3035,_0x5e68cb[_0x42a02c(0x1c5)][_0x42a02c(0x17f)]),_0x5a3035[_0x42a02c(0x1d7)]=_0x5e68cb['body']['suppliers'],await _0x5a3035[_0x42a02c(0x19c)]();_0x5e68cb[_0x42a02c(0xe0)](_0x42a02c(0xc0),'purchase\x20data\x20update\x20successfully'),_0x279f96['redirect'](_0x42a02c(0x137));}catch(_0x4cd2dc){console[_0x42a02c(0xd6)](_0x4cd2dc);}}),router['post'](a0_0x355199(0x1a2),auth,async(_0xd39aed,_0x4217b1)=>{var _0x34d823=a0_0x355199;try{const _0x25a989=_0xd39aed['params']['id'],{invoice:_0x1389b1,suppliers:_0x4238dd,payable:_0x57d6a2,due_amount:_0x24988f}=_0xd39aed[_0x34d823(0x1c5)],_0x1d1336=await purchases['findById'](_0x25a989);var _0x4f950c=_0x57d6a2-_0x24988f;_0x1d1336[_0x34d823(0x18a)]=parseFloat(_0x1d1336['paid_amount'])+parseFloat(_0x24988f),_0x1d1336[_0x34d823(0x1ab)]=_0x4f950c;const _0x212cbb=await _0x1d1336[_0x34d823(0x19c)]();console['log'](_0x212cbb);const _0x106061=await s_payment_data['findOne']({'invoice':_0x1389b1});_0x106061[_0x34d823(0xec)]=_0x4f950c,await _0x106061[_0x34d823(0x19c)]();let _0x86e6ad=new Date(),_0x578e27=('0'+_0x86e6ad[_0x34d823(0x168)]())[_0x34d823(0xae)](-0x2),_0x388bfc=('0'+(_0x86e6ad[_0x34d823(0xfb)]()+0x1))[_0x34d823(0xae)](-0x2),_0x10557d=_0x86e6ad[_0x34d823(0x19b)](),_0x40698b=_0x10557d+'-'+_0x388bfc+'-'+_0x578e27;const _0x42d9b2=new suppliers_payment({'invoice':_0x1389b1,'date':_0x10557d+'-'+_0x388bfc+'-'+_0x578e27,'suppliers':_0x4238dd,'reason':_0x34d823(0x187),'amount':_0x24988f}),_0x8c02a8=await _0x42d9b2[_0x34d823(0x19c)]();_0xd39aed['flash'](_0x34d823(0xc0),'payment\x20successfull'),_0x4217b1['redirect']('/all_purchases/view');}catch(_0x3bdcbd){console[_0x34d823(0xd6)](_0x3bdcbd);}}),router[a0_0x355199(0x182)](a0_0x355199(0x1d2),auth,async(_0x48ed54,_0x50a130)=>{var _0x4cb9cd=a0_0x355199;try{const {username:_0x3c25e5,email:_0x8a0c8d,role:_0x443da6}=_0x48ed54['user'],_0xe946d8=_0x48ed54['user'],_0x4dc017=await profile[_0x4cb9cd(0x159)]({'email':_0xe946d8[_0x4cb9cd(0x156)]}),_0x2c1acf=await master_shop[_0x4cb9cd(0xd7)]();console[_0x4cb9cd(0xd6)]('master',_0x2c1acf);const _0x2c0e51=_0x48ed54[_0x4cb9cd(0x16a)]['id'],_0x382309=await purchases[_0x4cb9cd(0xed)](_0x2c0e51);console[_0x4cb9cd(0xd6)](_0x382309);const _0x3ea5f0=await suppliers[_0x4cb9cd(0x159)]({'name':_0x382309['suppliers']});console[_0x4cb9cd(0xd6)](_0x3ea5f0);if(_0x2c1acf[0x0][_0x4cb9cd(0x1a5)]=='English\x20(US)'){var _0x32063c=users[_0x4cb9cd(0x139)];console[_0x4cb9cd(0xd6)](_0x32063c);}else{if(_0x2c1acf[0x0]['language']=='Hindi')var _0x32063c=users[_0x4cb9cd(0x194)];else{if(_0x2c1acf[0x0]['language']=='German')var _0x32063c=users[_0x4cb9cd(0x195)];else{if(_0x2c1acf[0x0]['language']==_0x4cb9cd(0x196))var _0x32063c=users[_0x4cb9cd(0x196)];else{if(_0x2c1acf[0x0][_0x4cb9cd(0x1a5)]==_0x4cb9cd(0xc2))var _0x32063c=users['French'];else{if(_0x2c1acf[0x0]['language']=='Portuguese\x20(BR)')var _0x32063c=users[_0x4cb9cd(0x10c)];else{if(_0x2c1acf[0x0][_0x4cb9cd(0x1a5)]=='Chinese')var _0x32063c=users[_0x4cb9cd(0x145)];else{if(_0x2c1acf[0x0][_0x4cb9cd(0x1a5)]==_0x4cb9cd(0x102))var _0x32063c=users[_0x4cb9cd(0x14e)];}}}}}}}_0x50a130[_0x4cb9cd(0x10e)](_0x4cb9cd(0x1a1),{'success':_0x48ed54[_0x4cb9cd(0xe0)](_0x4cb9cd(0xc0)),'errors':_0x48ed54['flash'](_0x4cb9cd(0xeb)),'role':_0xe946d8,'profile':_0x4dc017,'master_shop':_0x2c1acf,'supplier':_0x3ea5f0,'purchase':_0x382309,'language':_0x32063c});}catch(_0x16ed0c){console[_0x4cb9cd(0xd6)](_0x16ed0c);}}),router[a0_0x355199(0x182)](a0_0x355199(0x118),auth,async(_0x234ba9,_0x2155c8)=>{var _0x21a02f=a0_0x355199;try{const {username:_0x282d3a,email:_0x1bbb79,role:_0x1b31f4}=_0x234ba9[_0x21a02f(0xd4)],_0x1c3de1=_0x234ba9[_0x21a02f(0xd4)],_0x4ca4ec=await profile[_0x21a02f(0x159)]({'email':_0x1c3de1[_0x21a02f(0x156)]}),_0x4f0bd3=await master_shop['find']();console['log'](_0x21a02f(0x198),_0x4f0bd3);const _0x2ecce4=_0x234ba9[_0x21a02f(0x16a)]['id'];console[_0x21a02f(0xd6)](_0x2ecce4);const _0x4bd44a=await purchases_finished[_0x21a02f(0xed)](_0x2ecce4);console[_0x21a02f(0xd6)](_0x21a02f(0x119),_0x4bd44a);const _0x2bc49f=await product[_0x21a02f(0xd7)]({}),_0x596db6=await warehouse[_0x21a02f(0x1b3)]([{'$match':{'name':_0x4bd44a['warehouse_name'],'room':_0x4bd44a[_0x21a02f(0xfd)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x21a02f(0x1ac),'name':{'$first':_0x21a02f(0x13c)},'product_stock':{'$first':_0x21a02f(0xf6)},'bay':{'$first':_0x21a02f(0x180)},'bin':{'$first':_0x21a02f(0xbf)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x21a02f(0x185)},'primary_code':{'$first':_0x21a02f(0x176)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x21a02f(0x1a3)},'rack':{'$first':_0x21a02f(0xc6)}}}]);console['log'](_0x21a02f(0xd5),_0x596db6);let _0xd8a524;if(_0x1c3de1['role']=='staff'){const _0x2a9040=await staff[_0x21a02f(0x159)]({'email':_0x1c3de1[_0x21a02f(0x156)]});_0xd8a524=await warehouse[_0x21a02f(0xd7)]({'status':'Enabled','name':_0x2a9040[_0x21a02f(0xb6)],'warehouse_category':_0x21a02f(0x1a6),'name':_0x21a02f(0x1b6)});}else _0xd8a524=await warehouse['aggregate']([{'$match':{'status':_0x21a02f(0xd0),'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':_0x21a02f(0x1cc),'name':{'$first':_0x21a02f(0x1cc)}}}]);if(_0x4f0bd3[0x0]['language']==_0x21a02f(0x136)){var _0x1ae136=users[_0x21a02f(0x139)];console[_0x21a02f(0xd6)](_0x1ae136);}else{if(_0x4f0bd3[0x0][_0x21a02f(0x1a5)]==_0x21a02f(0x194))var _0x1ae136=users[_0x21a02f(0x194)];else{if(_0x4f0bd3[0x0][_0x21a02f(0x1a5)]==_0x21a02f(0x195))var _0x1ae136=users[_0x21a02f(0x195)];else{if(_0x4f0bd3[0x0][_0x21a02f(0x1a5)]==_0x21a02f(0x196))var _0x1ae136=users[_0x21a02f(0x196)];else{if(_0x4f0bd3[0x0]['language']==_0x21a02f(0xc2))var _0x1ae136=users[_0x21a02f(0xc2)];else{if(_0x4f0bd3[0x0][_0x21a02f(0x1a5)]=='Portuguese\x20(BR)')var _0x1ae136=users[_0x21a02f(0x10c)];else{if(_0x4f0bd3[0x0][_0x21a02f(0x1a5)]==_0x21a02f(0x145))var _0x1ae136=users[_0x21a02f(0x145)];else{if(_0x4f0bd3[0x0][_0x21a02f(0x1a5)]==_0x21a02f(0x102))var _0x1ae136=users[_0x21a02f(0x14e)];}}}}}}}_0x2155c8['render'](_0x21a02f(0x12a),{'success':_0x234ba9['flash'](_0x21a02f(0xc0)),'errors':_0x234ba9[_0x21a02f(0xe0)](_0x21a02f(0xeb)),'role':_0x1c3de1,'profile':_0x4ca4ec,'user':_0x4bd44a,'stock':_0x596db6,'master_shop':_0x4f0bd3,'product':_0x2bc49f,'language':_0x1ae136,'warehouse':_0xd8a524});}catch(_0x385899){console[_0x21a02f(0xd6)](_0x385899);}}),router[a0_0x355199(0x15c)]('/view/return_purchase/:id',auth,async(_0x8ee208,_0x4a4a3b)=>{var _0x2b2d2d=a0_0x355199;try{const {invoice:_0x1297e6,date:_0x44fb7e,warehouse_name:_0x2ae52b,Room_name:_0x623d7d,product_name:_0x3af683,purchase_quantity:_0x267bb5,stocks:_0x16ed00,return_qty:_0x264255,note:_0x457704,level:_0x1ac46a,isle:_0x225827,pallet:_0x28f68e,to_warehouse_name:_0x410ab0,to_Room_name:_0x32719e}=_0x8ee208[_0x2b2d2d(0x1c5)],_0x1e5d40=await purchases_finished['findOne']({'_id':_0x8ee208[_0x2b2d2d(0x16a)]['id']}),_0x46cde5=await warehouse[_0x2b2d2d(0x159)]({'name':_0x2ae52b,'room':_0x623d7d,'warehouse_category':_0x2b2d2d(0x1a6)});if(typeof _0x3af683==_0x2b2d2d(0x134))var _0x12255d=[_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0xef)]],_0x5567e4=[_0x8ee208[_0x2b2d2d(0x1c5)]['purchase_quantity']],_0x1aa57a=[_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0xb5)]],_0xf9f175=[_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1c1)]],_0x34dd79=[_0x8ee208[_0x2b2d2d(0x1c5)]['level']],_0x286fd8=[_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0xce)]],_0x472f13=[_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1e7)]],_0x5957be=[_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1ed)]];else var _0x12255d=[..._0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0xef)]],_0x5567e4=[..._0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x116)]],_0x1aa57a=[..._0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0xb5)]],_0xf9f175=[..._0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1c1)]],_0x34dd79=[..._0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0xd2)]],_0x286fd8=[..._0x8ee208[_0x2b2d2d(0x1c5)]['product_code_hide']],_0x472f13=[..._0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1e7)]],_0x5957be=[..._0x8ee208[_0x2b2d2d(0x1c5)]['secondary_code_hide']];const _0x4f2595=_0x12255d[_0x2b2d2d(0x1c8)](_0x185c98=>{return _0x185c98={'product_name':_0x185c98};});_0x5567e4[_0x2b2d2d(0x133)]((_0x499e93,_0x3dc3fe)=>{var _0x31063b=_0x2b2d2d;_0x4f2595[_0x3dc3fe][_0x31063b(0x116)]=_0x499e93;}),_0x1aa57a[_0x2b2d2d(0x133)]((_0x18d231,_0x563a92)=>{_0x4f2595[_0x563a92]['stock_quantity']=_0x18d231;}),_0xf9f175[_0x2b2d2d(0x133)]((_0x36ff7e,_0x2ae9fe)=>{_0x4f2595[_0x2ae9fe]['return_qty']=_0x36ff7e;}),_0x34dd79[_0x2b2d2d(0x133)]((_0x2ad2db,_0x4d2ba3)=>{var _0x59d5bc=_0x2b2d2d;_0x4f2595[_0x4d2ba3][_0x59d5bc(0x18d)]=_0x2ad2db;}),_0x286fd8[_0x2b2d2d(0x133)]((_0x403b65,_0x572e1a)=>{var _0xb7842c=_0x2b2d2d;_0x4f2595[_0x572e1a][_0xb7842c(0x1e5)]=_0x403b65;}),_0x472f13[_0x2b2d2d(0x133)]((_0xa40170,_0x2c0bd4)=>{_0x4f2595[_0x2c0bd4]['primary_code']=_0xa40170;}),_0x5957be[_0x2b2d2d(0x133)]((_0x19f735,_0x37da92)=>{var _0x58658e=_0x2b2d2d;_0x4f2595[_0x37da92][_0x58658e(0x1e3)]=_0x19f735;}),_0x4f2595[_0x2b2d2d(0x133)](_0x5e831f=>{var _0x4e52a3=_0x2b2d2d;console[_0x4e52a3(0xd6)](_0x5e831f);const _0x491965=_0x46cde5['product_details']['map'](_0x5b973f=>{var _0xf597b1=_0x4e52a3;_0x5b973f[_0xf597b1(0xef)]==_0x5e831f[_0xf597b1(0xef)]&&_0x5b973f[_0xf597b1(0x18d)]==_0x5e831f[_0xf597b1(0x18d)]&&(console['log'](parseInt(_0x5b973f[_0xf597b1(0x1a9)])+_0xf597b1(0x16e)+parseInt(_0x5e831f['return_qty'])),_0x5b973f[_0xf597b1(0x1a9)]=parseInt(_0x5b973f['product_stock'])-parseInt(_0x5e831f[_0xf597b1(0x1c1)]));});}),await _0x46cde5[_0x2b2d2d(0x19c)]();var _0x20c653=0x0;_0x4f2595['forEach'](_0x56a285=>{var _0x356d75=_0x2b2d2d;(parseInt(_0x56a285[_0x356d75(0x116)])<parseInt(_0x56a285[_0x356d75(0x1c1)])||parseInt(_0x56a285['stock_quantity'])<parseInt(_0x56a285[_0x356d75(0x1c1)]))&&_0x20c653++;});if(_0x20c653!=0x0)return _0x8ee208[_0x2b2d2d(0xe0)](_0x2b2d2d(0xeb),_0x2b2d2d(0x1ae)),_0x4a4a3b[_0x2b2d2d(0x18e)](_0x2b2d2d(0x115));const _0x362f42=new purchases_return_finished({'invoice':_0x1297e6,'suppliers':_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1d7)],'date':_0x44fb7e,'warehouse_name':_0x2ae52b,'return_product':_0x4f2595,'note':_0x457704,'room':_0x623d7d,'to_warehouse_name':_0x410ab0,'to_room':_0x32719e}),_0x2b1cca=await _0x362f42['save'](),_0x33db54=await purchases_return_finished['findOne']({'invoice':_0x1297e6}),_0x5d82ad=await warehouse['findOne']({'name':_0x410ab0,'room':_0x32719e,'warehouse_category':'Finished\x20Goods'});_0x33db54['return_product']['forEach'](_0x145b48=>{var _0x4cd49e=_0x2b2d2d,_0x16ea6e=0x0;const _0x305419=_0x5d82ad[_0x4cd49e(0x1af)]['map'](_0x2e6a19=>{var _0x7e5aca=_0x4cd49e;console[_0x7e5aca(0xd6)](_0x2e6a19['product_name']+'=='+_0x145b48[_0x7e5aca(0xef)]+'&&'+_0x2e6a19['bay']+'=='+_0x145b48['bay']),_0x2e6a19[_0x7e5aca(0xef)]==_0x145b48[_0x7e5aca(0xef)]&&_0x2e6a19[_0x7e5aca(0x18d)]==_0x145b48[_0x7e5aca(0x18d)]&&(_0x2e6a19[_0x7e5aca(0x1a9)]=parseInt(_0x2e6a19[_0x7e5aca(0x1a9)])-parseInt(_0x145b48['return_qty']),_0x16ea6e++);});_0x16ea6e=='0'&&(_0x5d82ad[_0x4cd49e(0x1af)]=_0x5d82ad[_0x4cd49e(0x1af)][_0x4cd49e(0x126)]({'product_name':_0x145b48[_0x4cd49e(0xef)],'product_stock':_0x145b48['return_qty'],'primary_code':_0x145b48[_0x4cd49e(0x105)],'secondary_code':_0x145b48['secondary_code'],'product_code':_0x145b48['product_code'],'bay':_0x145b48[_0x4cd49e(0x18d)],'maxProducts':0xf423f}));}),await _0x5d82ad[_0x2b2d2d(0x19c)]();const _0x3cc22e=await purchases_finished[_0x2b2d2d(0x159)]({'invoice':_0x1297e6});_0x3cc22e[_0x2b2d2d(0x101)]=_0x2b2d2d(0x14b);const _0x1372b3=await _0x3cc22e[_0x2b2d2d(0x19c)](),_0x17bf84=new s_payment_data({'invoice':_0x1297e6,'suppliers':_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1d7)],'reason':'Purchase\x20Return'});await _0x17bf84['save']();const _0x33d4d2=await master_shop['find'](),_0x8ada8e=await email_settings[_0x2b2d2d(0x159)](),_0x25f0a9=await suppliers[_0x2b2d2d(0x159)]({'name':_0x8ee208[_0x2b2d2d(0x1c5)][_0x2b2d2d(0x1d7)]});_0x33d4d2[0x0][_0x2b2d2d(0xf7)]==0x1?(right_currency=_0x33d4d2[0x0][_0x2b2d2d(0x166)],left_currency=''):(right_currency='',left_currency=_0x33d4d2[0x0][_0x2b2d2d(0x166)]);var _0x3556a2=_0x12255d,_0x2e2ac4=_0xf9f175,_0x37a5dd='',_0x1e37fa;for(_0x1e37fa in _0x3556a2){_0x37a5dd+=_0x2b2d2d(0xc9)+_0x2b2d2d(0x1da)+_0x3556a2[_0x1e37fa]+_0x2b2d2d(0x17b)+_0x2b2d2d(0x1da)+_0x2e2ac4[_0x1e37fa]+'</td>'+_0x2b2d2d(0x178);}let _0x37059f=nodemailer[_0x2b2d2d(0x155)]({'service':_0x2b2d2d(0x13d),'auth':{'user':_0x8ada8e[_0x2b2d2d(0x156)],'pass':_0x8ada8e[_0x2b2d2d(0x11f)]}}),_0x3cf55f={'from':_0x8ada8e[_0x2b2d2d(0x156)],'to':_0x25f0a9[_0x2b2d2d(0x156)],'subject':_0x2b2d2d(0xd8),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x33d4d2[0x0]['image'],'cid':_0x2b2d2d(0xaa)}],'html':_0x2b2d2d(0xe9)+_0x2b2d2d(0x1c0)+'</head><body>'+_0x2b2d2d(0x1e1)+_0x2b2d2d(0xee)+_0x2b2d2d(0x1e1)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2b2d2d(0x1c2)+_0x2b2d2d(0x1e1)+'<h2>\x20'+_0x33d4d2[0x0][_0x2b2d2d(0x1bf)]+'\x20</h2>'+_0x2b2d2d(0x1c2)+'</div>'+_0x2b2d2d(0x10b)+_0x2b2d2d(0x1e1)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2b2d2d(0x17d)+_0x1297e6+'\x20'+_0x2b2d2d(0x169)+_0x2b2d2d(0xff)+_0x44fb7e+'\x20'+'</span>'+_0x2b2d2d(0x174)+_0x2b2d2d(0x1c2)+_0x2b2d2d(0x15f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2b2d2d(0xc9)+_0x2b2d2d(0x193)+_0x2b2d2d(0x17e)+_0x2b2d2d(0x1d0)+_0x2b2d2d(0x121)+'</tr>'+'</thead>'+_0x2b2d2d(0x1d3)+'\x20'+_0x37a5dd+'\x20'+_0x2b2d2d(0xac)+_0x2b2d2d(0x161)+_0x2b2d2d(0x1e1)+_0x2b2d2d(0xf1)+'<h5>'+_0x33d4d2[0x0][_0x2b2d2d(0x1bf)]+_0x2b2d2d(0x174)+_0x2b2d2d(0x1c2)+_0x2b2d2d(0x1c2)+_0x2b2d2d(0xfc)};_0x37059f[_0x2b2d2d(0x1b8)](_0x3cf55f,function(_0x193b7a,_0x2d374){var _0x17e4d4=_0x2b2d2d;_0x193b7a?console[_0x17e4d4(0xd6)](_0x17e4d4(0x177)):console[_0x17e4d4(0xd6)](_0x17e4d4(0xea));}),_0x8ee208[_0x2b2d2d(0xe0)](_0x2b2d2d(0xc0),'purchases\x20item\x20return\x20successfull'),_0x4a4a3b['redirect'](_0x2b2d2d(0x137));}catch(_0x1cd060){_0x4a4a3b['status'](0xc8)['json']({'message':_0x1cd060[_0x2b2d2d(0x1d8)]});}}),router[a0_0x355199(0x182)](a0_0x355199(0x144),auth,async(_0x349e97,_0x4aa1b2)=>{var _0x4d8ddd=a0_0x355199;try{const {username:_0x11dace,email:_0x4d7c86,role:_0x49868c}=_0x349e97['user'],_0x4e6323=_0x349e97[_0x4d8ddd(0xd4)],_0x3283df=await profile[_0x4d8ddd(0x159)]({'email':_0x4e6323[_0x4d8ddd(0x156)]}),_0x517ea0=await master_shop[_0x4d8ddd(0xd7)](),_0x2edb2d=_0x349e97[_0x4d8ddd(0x16a)]['id'],_0xbbe2e8=await purchases_finished[_0x4d8ddd(0xed)](_0x2edb2d);if(_0x517ea0[0x0][_0x4d8ddd(0x1a5)]==_0x4d8ddd(0x136))var _0x43b0cc=users['English'];else{if(_0x517ea0[0x0][_0x4d8ddd(0x1a5)]==_0x4d8ddd(0x194))var _0x43b0cc=users[_0x4d8ddd(0x194)];else{if(_0x517ea0[0x0]['language']=='German')var _0x43b0cc=users[_0x4d8ddd(0x195)];else{if(_0x517ea0[0x0][_0x4d8ddd(0x1a5)]=='Spanish')var _0x43b0cc=users[_0x4d8ddd(0x196)];else{if(_0x517ea0[0x0][_0x4d8ddd(0x1a5)]==_0x4d8ddd(0xc2))var _0x43b0cc=users[_0x4d8ddd(0xc2)];else{if(_0x517ea0[0x0][_0x4d8ddd(0x1a5)]=='Portuguese\x20(BR)')var _0x43b0cc=users[_0x4d8ddd(0x10c)];else{if(_0x517ea0[0x0]['language']=='Chinese')var _0x43b0cc=users[_0x4d8ddd(0x145)];else{if(_0x517ea0[0x0][_0x4d8ddd(0x1a5)]=='Arabic\x20(ae)')var _0x43b0cc=users[_0x4d8ddd(0x14e)];}}}}}}}_0x4aa1b2[_0x4d8ddd(0x10e)]('all_purchases_barcode',{'success':_0x349e97[_0x4d8ddd(0xe0)](_0x4d8ddd(0xc0)),'errors':_0x349e97[_0x4d8ddd(0xe0)](_0x4d8ddd(0xeb)),'role':_0x4e6323,'profile':_0x3283df,'alldata':_0xbbe2e8,'master_shop':_0x517ea0,'language':_0x43b0cc}),console['log'](alldata);}catch(_0x1c1f36){console[_0x4d8ddd(0xd6)](_0x1c1f36);}}),router[a0_0x355199(0x15c)](a0_0x355199(0x158),async(_0x4aebcf,_0x1d3eb8)=>{var _0x5879fa=a0_0x355199;const {product_code:_0x4b1256}=_0x4aebcf['body'];var _0x19da08;const _0xc2d642=await product[_0x5879fa(0x1b3)]([{'$match':{'primary_code':_0x4b1256}},{'$group':{'_id':'$_id','name':{'$first':_0x5879fa(0x1cc)},'category':{'$first':_0x5879fa(0x100)},'brand':{'$first':_0x5879fa(0x175)},'unit':{'$first':_0x5879fa(0x15d)},'alertquantity':{'$first':_0x5879fa(0x11a)},'product_code':{'$first':_0x5879fa(0x19e)},'primary_code':{'$first':_0x5879fa(0x14d)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x5879fa(0x142)},'maxProdPerUnit':{'$first':_0x5879fa(0xc7)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5879fa(0x131)},'gross_price':{'$first':_0x5879fa(0xc1)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x6ca2=await product[_0x5879fa(0x1b3)]([{'$match':{'secondary_code':_0x4b1256}},{'$group':{'_id':_0x5879fa(0xab),'name':{'$first':_0x5879fa(0x1cc)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x5879fa(0x15d)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5879fa(0x19e)},'primary_code':{'$first':_0x5879fa(0x14d)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x5879fa(0x142)},'maxProdPerUnit':{'$first':_0x5879fa(0xc7)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5879fa(0x131)},'gross_price':{'$first':_0x5879fa(0xc1)},'sales_category':{'$first':_0x5879fa(0xbe)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0xc2d642['length']>0x0)_0x19da08=_0xc2d642;else _0x6ca2[_0x5879fa(0x19f)]>0x0&&(_0x19da08=_0x6ca2);_0x1d3eb8[_0x5879fa(0x146)](_0x19da08);}),router['post'](a0_0x355199(0x1e2),async(_0x3bee44,_0x24c287)=>{var _0xd4cb9d=a0_0x355199;const {productCode:_0x1408ce,bay:_0x47034b,warehouses:_0x26ee2e,room:_0xdf1c1e}=_0x3bee44[_0xd4cb9d(0x1c5)];console[_0xd4cb9d(0xd6)](_0x3bee44[_0xd4cb9d(0x1c5)]);try{const _0x3d960a=await warehouse[_0xd4cb9d(0x1b3)]([{'$match':{'name':_0x26ee2e,'room':_0xdf1c1e}},{'$unwind':_0xd4cb9d(0x192)},{'$match':{'product_details.bay':parseInt(_0x47034b)}},{'$group':{'_id':_0xd4cb9d(0x1ac),'name':{'$first':_0xd4cb9d(0x13c)},'product_stock':{'$first':_0xd4cb9d(0xf6)},'bay':{'$first':_0xd4cb9d(0x180)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x24c287[_0xd4cb9d(0x1df)](0xc8)[_0xd4cb9d(0x146)](_0x3d960a);}catch(_0x4297d4){_0x24c287['status'](0x194)['json']({'message':_0x4297d4[_0xd4cb9d(0x1d8)]});}}),router[a0_0x355199(0x15c)](a0_0x355199(0x1ba),async(_0x59626a,_0xb80abb)=>{var _0x58d4cc=a0_0x355199;const {product_code:_0xffcb73}=_0x59626a[_0x58d4cc(0x1c5)];var _0x4611a1;const _0x5b2acd=await product['aggregate']([{'$match':{'primary_code':_0xffcb73,'type_products':'log'}},{'$group':{'_id':_0x58d4cc(0xab),'name':{'$first':_0x58d4cc(0x1cc)},'category':{'$first':_0x58d4cc(0x100)},'brand':{'$first':_0x58d4cc(0x175)},'unit':{'$first':_0x58d4cc(0x15d)},'alertquantity':{'$first':_0x58d4cc(0x11a)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x58d4cc(0x142)},'maxProdPerUnit':{'$first':_0x58d4cc(0xc7)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x58d4cc(0x131)},'gross_price':{'$first':_0x58d4cc(0xc1)},'sales_category':{'$first':_0x58d4cc(0xbe)},'type_products':{'$first':_0x58d4cc(0x1b9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x58d4cc(0xd6)](_0x5b2acd);const _0x530598=await product[_0x58d4cc(0x1b3)]([{'$match':{'secondary_code':_0xffcb73,'type_products':_0x58d4cc(0xd6)}},{'$group':{'_id':_0x58d4cc(0xab),'name':{'$first':_0x58d4cc(0x1cc)},'category':{'$first':_0x58d4cc(0x100)},'brand':{'$first':'$brand'},'unit':{'$first':_0x58d4cc(0x15d)},'alertquantity':{'$first':_0x58d4cc(0x11a)},'product_code':{'$first':_0x58d4cc(0x19e)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x58d4cc(0xdc)},'maxStocks':{'$first':_0x58d4cc(0x142)},'maxProdPerUnit':{'$first':_0x58d4cc(0xc7)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x58d4cc(0x131)},'gross_price':{'$first':_0x58d4cc(0xc1)},'sales_category':{'$first':_0x58d4cc(0xbe)},'type_products':{'$first':_0x58d4cc(0x1b9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x5b2acd['length']>0x0)_0x4611a1=_0x5b2acd;else _0x530598[_0x58d4cc(0x19f)]>0x0&&(_0x4611a1=_0x530598);_0xb80abb['json'](_0x4611a1);}),module[a0_0x355199(0x1cb)]=router;