var a0_0x431e3e=a0_0x49ab;(function(_0x2e9a8f,_0x56090a){var _0x2c37e1=a0_0x49ab,_0x38192e=_0x2e9a8f();while(!![]){try{var _0x4242a7=parseInt(_0x2c37e1(0x1a5))/0x1*(-parseInt(_0x2c37e1(0x1d1))/0x2)+-parseInt(_0x2c37e1(0x18b))/0x3*(-parseInt(_0x2c37e1(0x16c))/0x4)+parseInt(_0x2c37e1(0x223))/0x5+parseInt(_0x2c37e1(0x1b0))/0x6*(parseInt(_0x2c37e1(0x123))/0x7)+-parseInt(_0x2c37e1(0x228))/0x8*(parseInt(_0x2c37e1(0x1e9))/0x9)+parseInt(_0x2c37e1(0x153))/0xa*(parseInt(_0x2c37e1(0x19d))/0xb)+-parseInt(_0x2c37e1(0x141))/0xc;if(_0x4242a7===_0x56090a)break;else _0x38192e['push'](_0x38192e['shift']());}catch(_0x330797){_0x38192e['push'](_0x38192e['shift']());}}}(a0_0x355a,0x89c10));const express=require(a0_0x431e3e(0x13c)),app=express(),router=express[a0_0x431e3e(0x1af)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x431e3e(0x140)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require('ejs');const path=require(a0_0x431e3e(0x1f9)),users=require(a0_0x431e3e(0x10d)),{isNull}=require('util');router[a0_0x431e3e(0x103)](a0_0x431e3e(0x1a0),auth,async(_0x25eae5,_0x1808a1)=>{var _0x2b3d38=a0_0x431e3e;try{const {username:_0x1316ac,email:_0x492921,role:_0x8576ed}=_0x25eae5['user'],_0x299014=_0x25eae5[_0x2b3d38(0x239)],_0x50e5ea=await profile['findOne']({'email':_0x299014[_0x2b3d38(0x107)]}),_0x20d26d=await staff['findOne']({'email':_0x299014[_0x2b3d38(0x107)]}),_0x13408b=await master_shop[_0x2b3d38(0x13b)]();let _0x294750=await transfers_finished[_0x2b3d38(0x201)]([{'$match':{'to_warehouse':_0x20d26d[_0x2b3d38(0x231)]}}]);if(_0x13408b[0x0][_0x2b3d38(0x122)]==_0x2b3d38(0x1cf))var _0x264ac5=users[_0x2b3d38(0x233)];else{if(_0x13408b[0x0][_0x2b3d38(0x122)]=='Hindi')var _0x264ac5=users[_0x2b3d38(0x1ce)];else{if(_0x13408b[0x0][_0x2b3d38(0x122)]==_0x2b3d38(0x247))var _0x264ac5=users['German'];else{if(_0x13408b[0x0][_0x2b3d38(0x122)]==_0x2b3d38(0x224))var _0x264ac5=users['Spanish'];else{if(_0x13408b[0x0][_0x2b3d38(0x122)]==_0x2b3d38(0x209))var _0x264ac5=users[_0x2b3d38(0x209)];else{if(_0x13408b[0x0][_0x2b3d38(0x122)]==_0x2b3d38(0x166))var _0x264ac5=users[_0x2b3d38(0x1a6)];else{if(_0x13408b[0x0]['language']==_0x2b3d38(0x117))var _0x264ac5=users[_0x2b3d38(0x117)];else{if(_0x13408b[0x0][_0x2b3d38(0x122)]==_0x2b3d38(0x186))var _0x264ac5=users['Arabic'];}}}}}}}_0x1808a1['render'](_0x2b3d38(0x15d),{'success':_0x25eae5[_0x2b3d38(0x230)](_0x2b3d38(0x1c8)),'errors':_0x25eae5[_0x2b3d38(0x230)](_0x2b3d38(0x1ed)),'purchases':_0x294750,'role':_0x299014,'profile':_0x50e5ea,'master_shop':_0x13408b,'language':_0x264ac5,'staff_data':_0x20d26d});}catch(_0x49983d){console[_0x2b3d38(0x127)](_0x2b3d38(0x217),_0x49983d),_0x1808a1['status'](0xc8)[_0x2b3d38(0x192)]({'message':_0x49983d[_0x2b3d38(0x13f)]});}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x248),auth,async(_0x29bef2,_0x2bd1bc)=>{var _0x183a68=a0_0x431e3e;try{const {username:_0x106224,email:_0x1ab477,role:_0x3e644a}=_0x29bef2['user'],_0x4b9f73=_0x29bef2[_0x183a68(0x239)],_0x125829=await profile[_0x183a68(0x1ef)]({'email':_0x4b9f73[_0x183a68(0x107)]}),_0x4f4198=await staff[_0x183a68(0x1ef)]({'email':_0x4b9f73['email']}),_0x10a4af=await master_shop['find']();let _0x11f57f=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x4f4198[_0x183a68(0x231)],'to_recieved':_0x183a68(0x222)}}]);if(_0x10a4af[0x0]['language']==_0x183a68(0x1cf))var _0x1053e9=users[_0x183a68(0x233)];else{if(_0x10a4af[0x0][_0x183a68(0x122)]==_0x183a68(0x1ce))var _0x1053e9=users[_0x183a68(0x1ce)];else{if(_0x10a4af[0x0][_0x183a68(0x122)]==_0x183a68(0x247))var _0x1053e9=users[_0x183a68(0x247)];else{if(_0x10a4af[0x0][_0x183a68(0x122)]==_0x183a68(0x224))var _0x1053e9=users[_0x183a68(0x224)];else{if(_0x10a4af[0x0]['language']=='French')var _0x1053e9=users[_0x183a68(0x209)];else{if(_0x10a4af[0x0]['language']==_0x183a68(0x166))var _0x1053e9=users[_0x183a68(0x1a6)];else{if(_0x10a4af[0x0][_0x183a68(0x122)]=='Chinese')var _0x1053e9=users[_0x183a68(0x117)];else{if(_0x10a4af[0x0][_0x183a68(0x122)]==_0x183a68(0x186))var _0x1053e9=users['Arabic'];}}}}}}}_0x2bd1bc[_0x183a68(0x116)]('incoming_add',{'success':_0x29bef2[_0x183a68(0x230)](_0x183a68(0x1c8)),'errors':_0x29bef2[_0x183a68(0x230)](_0x183a68(0x1ed)),'purchases':_0x11f57f,'role':_0x4b9f73,'profile':_0x125829,'master_shop':_0x10a4af,'language':_0x1053e9,'staff_data':_0x4f4198});}catch(_0x1f2e21){console[_0x183a68(0x127)](_0x183a68(0x217),_0x1f2e21),_0x2bd1bc[_0x183a68(0x214)](0xc8)[_0x183a68(0x192)]({'message':_0x1f2e21[_0x183a68(0x13f)]});}});const createLog=async _0x12802e=>{const _0x27d171=new datalogs({'location':_0x12802e});return await _0x27d171['save'](),_0x27d171['invoice_init'];};router[a0_0x431e3e(0x15c)](a0_0x431e3e(0x248),auth,async(_0x70c51d,_0x4db44c)=>{var _0x1b2c37=a0_0x431e3e;try{const {invoice_trf_data:_0x247bcd,item_code:_0x185249,SCRN:_0x42df5a,ReqBy:_0x2ba2f3,type_of_products:_0x1e2733,dateofreq:_0x10c32f,PO_number:_0x47c5d3,date:_0x5dc63c,warehouse_name:_0x424078,typeservicesData:_0x5a227a,typevehicle:_0x5b8d0d,driver:_0x4c9913,plate:_0x2f0851,van:_0x194351,DRSI:_0x1f3b85,TSU:_0x22606d,TFU:_0x483000,note:_0x4f6ad6}=_0x70c51d[_0x1b2c37(0x178)],_0x34bdc9=await transfers_finished[_0x1b2c37(0x1f5)](_0x247bcd);if(typeof _0x185249==_0x1b2c37(0x202))var _0x262061=[_0x70c51d['body'][_0x1b2c37(0x15b)]],_0x341fdd=[_0x70c51d['body'][_0x1b2c37(0x171)]],_0x311b10=[_0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x1c0)]],_0x5684ae=[_0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x104)]],_0x21bc45=[_0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x21d)]],_0x6d915e=[_0x70c51d[_0x1b2c37(0x178)]['bin']],_0x2189fe=[_0x70c51d['body'][_0x1b2c37(0x142)]],_0x4f58aa=[_0x70c51d['body'][_0x1b2c37(0x1bc)]],_0x382a45=[_0x70c51d[_0x1b2c37(0x178)]['batch_code']],_0x137a7c=[_0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x1f7)]],_0x3019ce=[_0x70c51d['body'][_0x1b2c37(0x112)]],_0x52a92c=[_0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x126)]],_0x2d395a=[_0x70c51d[_0x1b2c37(0x178)]['room']];else var _0x262061=[..._0x70c51d[_0x1b2c37(0x178)]['product_name']],_0x341fdd=[..._0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x171)]],_0x311b10=[..._0x70c51d['body'][_0x1b2c37(0x1c0)]],_0x5684ae=[..._0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x104)]],_0x21bc45=[..._0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x21d)]],_0x6d915e=[..._0x70c51d[_0x1b2c37(0x178)]['bin']],_0x2189fe=[..._0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x142)]],_0x4f58aa=[..._0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x1bc)]],_0x382a45=[..._0x70c51d[_0x1b2c37(0x178)][_0x1b2c37(0x20a)]],_0x137a7c=[..._0x70c51d['body'][_0x1b2c37(0x1f7)]],_0x3019ce=[..._0x70c51d['body']['production_date']],_0x52a92c=[..._0x70c51d['body'][_0x1b2c37(0x126)]],_0x2d395a=[..._0x70c51d[_0x1b2c37(0x178)]['room']];const _0x1000c9=_0x262061[_0x1b2c37(0x15a)](_0x429fdf=>{return _0x429fdf={'product_name':_0x429fdf};});_0x341fdd[_0x1b2c37(0x12a)]((_0x1fb833,_0x1d7f3c)=>{var _0x265206=_0x1b2c37;_0x1000c9[_0x1d7f3c][_0x265206(0x11c)]=_0x1fb833;}),_0x311b10[_0x1b2c37(0x12a)]((_0x1164ca,_0xe61fbc)=>{var _0x4d5faa=_0x1b2c37;_0x1000c9[_0xe61fbc][_0x4d5faa(0x193)]=Math[_0x4d5faa(0x216)](_0x1164ca);}),_0x5684ae[_0x1b2c37(0x12a)]((_0x3f5cc2,_0x3128f9)=>{var _0x3e5424=_0x1b2c37;_0x1000c9[_0x3128f9][_0x3e5424(0x220)]=_0x3f5cc2;}),_0x21bc45[_0x1b2c37(0x12a)]((_0x4f5362,_0x526def)=>{var _0x246256=_0x1b2c37;_0x1000c9[_0x526def][_0x246256(0x10e)]=_0x4f5362;}),_0x6d915e['forEach']((_0x455457,_0x30e893)=>{var _0x1cab16=_0x1b2c37,_0x2a4a98=_0x455457[_0x1cab16(0x179)](/[A-Za-z]+/)[0x0],_0xdbcb4c=parseInt(_0x455457[_0x1cab16(0x179)](/\d+/)[0x0]);_0x1000c9[_0x30e893]['level']=_0x2a4a98,_0x1000c9[_0x30e893][_0x1cab16(0x1e8)]=_0xdbcb4c;}),_0x2189fe[_0x1b2c37(0x12a)]((_0x591ba2,_0x552072)=>{var _0x2f7ab3=_0x1b2c37;_0x1000c9[_0x552072][_0x2f7ab3(0x142)]=_0x591ba2;}),_0x4f58aa['forEach']((_0x523851,_0x38964e)=>{var _0x5e8da3=_0x1b2c37;_0x1000c9[_0x38964e][_0x5e8da3(0x1bc)]=_0x523851;}),_0x382a45['forEach']((_0x458703,_0x58810e)=>{var _0xb93427=_0x1b2c37;_0x1000c9[_0x58810e][_0xb93427(0x20a)]=_0x458703;}),_0x137a7c[_0x1b2c37(0x12a)]((_0x430781,_0x3d7270)=>{var _0x56127b=_0x1b2c37;_0x1000c9[_0x3d7270][_0x56127b(0x1f7)]=_0x430781;}),_0x3019ce[_0x1b2c37(0x12a)]((_0x56a4d9,_0x347a68)=>{var _0x294e3e=_0x1b2c37;_0x1000c9[_0x347a68][_0x294e3e(0x112)]=_0x56a4d9;}),_0x52a92c['forEach']((_0x493e6f,_0x54e406)=>{var _0x37a0db=_0x1b2c37;_0x1000c9[_0x54e406][_0x37a0db(0x20f)]=_0x493e6f;}),_0x2d395a[_0x1b2c37(0x12a)]((_0x297b73,_0xaa297f)=>{var _0x14b652=_0x1b2c37;_0x1000c9[_0xaa297f][_0x14b652(0x133)]=_0x297b73;});const _0x466888=await createLog(_0x1b2c37(0x212));_0x2d395a[_0x1b2c37(0x12a)]((_0x262af5,_0x360ed7)=>{var _0x533abf=_0x1b2c37;_0x1000c9[_0x360ed7][_0x533abf(0x1b9)]='INC-'+_0x466888['toString']()[_0x533abf(0x23a)](0x8,'0');});const _0x12b461=_0x1000c9['filter'](_0x177698=>_0x177698[_0x1b2c37(0x193)]!=='0'&&_0x177698[_0x1b2c37(0x193)]!==''),_0x246505=new purchases_incoming({'invoice':_0x1b2c37(0x1d9)+_0x466888[_0x1b2c37(0x243)]()[_0x1b2c37(0x23a)](0x8,'0'),'date':_0x5dc63c,'warehouse_name':_0x424078,'product':_0x12b461,'note':_0x4f6ad6,'POnumber':_0x47c5d3,'SCRN':_0x42df5a,'ReqBy':_0x2ba2f3,'dateofreq':_0x10c32f,'typeservicesData':_0x5a227a,'van':_0x194351,'typevehicle':_0x5b8d0d,'driver':_0x4c9913,'plate':_0x2f0851,'DRSI':_0x1f3b85,'TSU':_0x22606d,'TFU':_0x483000,'typeOfProducts':_0x1e2733}),_0x47b3c5=await _0x246505[_0x1b2c37(0x1f3)](),_0x583109=_0x47b3c5['product'][_0x1b2c37(0x15a)](async _0x5ec019=>{var _0x4ba0dc=_0x1b2c37,_0x65ee21=await warehouse['findOne']({'name':_0x424078,'room':_0x5ec019[_0x4ba0dc(0x133)]});if(_0x5ec019[_0x4ba0dc(0x193)]>0x0){var _0x415689=0x0;const _0x2f6c02=_0x65ee21[_0x4ba0dc(0x17c)][_0x4ba0dc(0x15a)](_0x2eedb2=>{var _0xae3387=_0x4ba0dc;_0x2eedb2['product_name']==_0x5ec019['product_name']&&_0x2eedb2[_0xae3387(0x1e8)]==_0x5ec019[_0xae3387(0x1db)]&&_0x2eedb2[_0xae3387(0x1f7)]==_0x5ec019[_0xae3387(0x1f7)]&&_0x2eedb2[_0xae3387(0x112)]==_0x5ec019[_0xae3387(0x112)]&&_0x2eedb2[_0xae3387(0x20a)]==_0x5ec019[_0xae3387(0x20a)]&&_0x2eedb2['invoice']==_0x5ec019[_0xae3387(0x1b9)]&&(typeof _0x5ec019[_0xae3387(0x1c5)]==_0xae3387(0x225)?(console[_0xae3387(0x127)](_0xae3387(0x195),_0x2eedb2['product_stock']+_0xae3387(0x12e)+_0x2eedb2[_0xae3387(0x115)]+_0xae3387(0x19f)+Math['abs'](_0x2eedb2['product_stock'])+Math[_0xae3387(0x216)](_0x5ec019['to_quantity'])),_0x2eedb2[_0xae3387(0x22d)]=Math[_0xae3387(0x216)](_0x2eedb2['product_stock'])+Math[_0xae3387(0x216)](_0x5ec019['quantity'])):(_0x2eedb2['product_stock']=Math[_0xae3387(0x216)](_0x2eedb2[_0xae3387(0x22d)])+Math[_0xae3387(0x216)](_0x5ec019['quantity']),_0x415689++));});_0x415689=='0'&&(_0x65ee21[_0x4ba0dc(0x17c)]=_0x65ee21[_0x4ba0dc(0x17c)][_0x4ba0dc(0x151)]({'product_name':_0x5ec019[_0x4ba0dc(0x15b)],'product_stock':_0x5ec019[_0x4ba0dc(0x193)],'bay':_0x5ec019['bay'],'level':_0x5ec019[_0x4ba0dc(0x23c)],'product_code':_0x5ec019[_0x4ba0dc(0x11c)],'primary_code':_0x5ec019[_0x4ba0dc(0x142)],'secondary_code':_0x5ec019[_0x4ba0dc(0x1bc)],'expiry_date':_0x5ec019['expiry_date'],'production_date':_0x5ec019[_0x4ba0dc(0x112)],'maxProducts':_0x5ec019[_0x4ba0dc(0x208)],'batch_code':_0x5ec019[_0x4ba0dc(0x20a)],'secondary_unit':_0x5ec019[_0x4ba0dc(0x10e)],'unit':_0x5ec019['standard_unit'],'maxProducts':_0x5ec019[_0x4ba0dc(0x208)],'maxPerUnit':_0x5ec019[_0x4ba0dc(0x200)],'invoice':_0x5ec019[_0x4ba0dc(0x1b9)]}));}return _0x65ee21;});Promise['all'](_0x583109)[_0x1b2c37(0x18d)](async _0x5e4a36=>{var _0x1d82f4=_0x1b2c37;try{for(const _0x2434aa of _0x5e4a36){await warehouse['updateOne']({'_id':_0x2434aa['_id']},{'$addToSet':{'product_details':{'$each':_0x2434aa[_0x1d82f4(0x17c)]}}});}_0x34bdc9['to_recieved']=_0x1d82f4(0x1a4);const _0x4b23e3=await _0x34bdc9[_0x1d82f4(0x1f3)](),_0x1c4aec=await master_shop[_0x1d82f4(0x13b)](),_0xbdd0e6=await email_settings[_0x1d82f4(0x1ef)](),_0x48dd3e=await supervisor_settings[_0x1d82f4(0x13b)]();var _0x51355d=_0x246505[_0x1d82f4(0x21f)],_0x17e450='',_0x24fc19;for(_0x24fc19 in _0x51355d){var _0x13ba85='FG';_0x246505[_0x1d82f4(0x182)]=='DRY\x20GOODS'&&(_0x13ba85='DG'),_0x17e450+=_0x1d82f4(0x199)+_0x1d82f4(0x174)+_0x51355d[_0x24fc19][_0x1d82f4(0x15b)]+_0x1d82f4(0x158)+_0x1d82f4(0x174)+_0x51355d[_0x24fc19]['product_code']+'</td>'+_0x1d82f4(0x174)+_0x51355d[_0x24fc19][_0x1d82f4(0x1c0)]+_0x1d82f4(0x158)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x51355d[_0x24fc19][_0x1d82f4(0x104)]+_0x1d82f4(0x158)+_0x1d82f4(0x174)+_0x51355d[_0x24fc19][_0x1d82f4(0x10e)]+_0x1d82f4(0x158)+_0x1d82f4(0x174)+_0x246505['to_warehouse']+_0x1d82f4(0x158)+_0x1d82f4(0x174)+_0x51355d[_0x24fc19][_0x1d82f4(0x1a1)]+_0x1d82f4(0x158)+_0x1d82f4(0x174)+_0x13ba85+_0x51355d[_0x24fc19][_0x1d82f4(0x1db)]+_0x1d82f4(0x158)+_0x1d82f4(0x14a);}_0x70c51d['flash'](_0x1d82f4(0x1c8),_0x1d82f4(0x148)),_0x4db44c[_0x1d82f4(0x20b)](_0x1d82f4(0x205)+_0x47b3c5[_0x1d82f4(0x115)]);}catch(_0x2b65bc){console[_0x1d82f4(0x11a)](_0x2b65bc),_0x4db44c[_0x1d82f4(0x214)](0x1f4)[_0x1d82f4(0x192)]({'error':_0x1d82f4(0x1dd)});}})[_0x1b2c37(0x1de)](_0x230d24=>{var _0x967ad2=_0x1b2c37;console[_0x967ad2(0x11a)](_0x230d24),_0x4db44c[_0x967ad2(0x214)](0x1f4)[_0x967ad2(0x192)]({'error':_0x967ad2(0x17d)});});}catch(_0x2dc615){}}),router[a0_0x431e3e(0x15c)]('/getTRF',auth,async(_0x218ea3,_0x4e1f3f)=>{var _0x2ed235=a0_0x431e3e;try{const {warehouse:_0x2be604}=_0x218ea3[_0x2ed235(0x178)],_0x42dd10=await transfers_finished['find']({'to_warehouse':_0x2be604,'to_recieved':_0x2ed235(0x222)});_0x4e1f3f[_0x2ed235(0x192)](_0x42dd10);}catch(_0x39eb21){}}),router['post'](a0_0x431e3e(0x118),auth,async(_0x4cff21,_0x1cb166)=>{var _0x39b085=a0_0x431e3e;try{const {invoice:_0x444090}=_0x4cff21[_0x39b085(0x178)],_0x3a12dc=await transfers_finished['find']({'_id':_0x444090,'to_recieved':_0x39b085(0x222)});_0x1cb166['json'](_0x3a12dc);}catch(_0xe6178e){}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x1a2),auth,async(_0x36e2c3,_0x19f96d)=>{var _0x3b1283=a0_0x431e3e;try{const {username:_0x269daf,email:_0x278968,role:_0x2bc5c9}=_0x36e2c3['user'],_0x513453=_0x36e2c3[_0x3b1283(0x239)],_0x509406=await profile[_0x3b1283(0x1ef)]({'email':_0x513453[_0x3b1283(0x107)]}),_0x50dc5c=await staff[_0x3b1283(0x1ef)]({'email':_0x513453[_0x3b1283(0x107)]});if(_0x513453['role']==_0x3b1283(0x1f1)){const _0x1b2b71=await staff[_0x3b1283(0x1ef)]({'email':_0x513453[_0x3b1283(0x107)]});}const _0x4c42b5=await master_shop[_0x3b1283(0x13b)]();let _0x507ec5;if(_0x513453['role']==_0x3b1283(0x1f1)){const _0x4c6f5f=await staff[_0x3b1283(0x1ef)]({'email':_0x513453[_0x3b1283(0x107)]});_0x507ec5=await purchases_finished[_0x3b1283(0x201)]([{'$match':{'warehouse_name':_0x4c6f5f[_0x3b1283(0x231)],'typeOfProducts':_0x3b1283(0x1d2)}},{'$lookup':{'from':_0x3b1283(0x1da),'localField':_0x3b1283(0x1da),'foreignField':_0x3b1283(0x1bf),'as':_0x3b1283(0x132)}},{'$unwind':_0x3b1283(0x1d0)},{'$unwind':'$product'},{'$group':{'_id':_0x3b1283(0x1bd),'invoice':{'$first':_0x3b1283(0x1c9)},'suppliers':{'$first':_0x3b1283(0x1eb)},'date':{'$first':_0x3b1283(0x194)},'warehouse_name':{'$first':_0x3b1283(0x15f)},'room':{'$first':'$room'},'product':{'$push':_0x3b1283(0x119)},'note':{'$first':_0x3b1283(0x16e)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3b1283(0x145)},'batch_code':{'$first':_0x3b1283(0x120)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3b1283(0x1d0)},'total_product_quantity':{'$sum':_0x3b1283(0x100)},'level':{'$addToSet':_0x3b1283(0x1d8)},'isle':{'$addToSet':_0x3b1283(0x198)},'type':{'$addToSet':_0x3b1283(0x10f)},'floorlevel':{'$addToSet':_0x3b1283(0x18c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x507ec5=await purchases_finished[_0x3b1283(0x201)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':_0x3b1283(0x119)},{'$group':{'_id':_0x3b1283(0x1bd),'invoice':{'$first':_0x3b1283(0x1c9)},'suppliers':{'$first':_0x3b1283(0x1eb)},'date':{'$first':_0x3b1283(0x194)},'warehouse_name':{'$first':_0x3b1283(0x15f)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3b1283(0x119)},'note':{'$first':_0x3b1283(0x16e)},'paid_amount':{'$first':_0x3b1283(0x1ea)},'due_amount':{'$first':_0x3b1283(0x149)},'return_data':{'$first':_0x3b1283(0x145)},'batch_code':{'$first':_0x3b1283(0x120)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3b1283(0x1d0)},'total_product_quantity':{'$sum':_0x3b1283(0x100)},'level':{'$addToSet':_0x3b1283(0x1d8)},'isle':{'$addToSet':_0x3b1283(0x198)},'type':{'$addToSet':_0x3b1283(0x10f)},'floorlevel':{'$addToSet':_0x3b1283(0x18c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4c42b5[0x0]['language']==_0x3b1283(0x1cf))var _0x458c11=users['English'];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]==_0x3b1283(0x1ce))var _0x458c11=users[_0x3b1283(0x1ce)];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]==_0x3b1283(0x247))var _0x458c11=users[_0x3b1283(0x247)];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]==_0x3b1283(0x224))var _0x458c11=users[_0x3b1283(0x224)];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]==_0x3b1283(0x209))var _0x458c11=users[_0x3b1283(0x209)];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]==_0x3b1283(0x166))var _0x458c11=users['Portuguese'];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]=='Chinese')var _0x458c11=users['Chinese'];else{if(_0x4c42b5[0x0][_0x3b1283(0x122)]==_0x3b1283(0x186))var _0x458c11=users[_0x3b1283(0x1a9)];}}}}}}}_0x19f96d[_0x3b1283(0x116)](_0x3b1283(0x11f),{'success':_0x36e2c3[_0x3b1283(0x230)](_0x3b1283(0x1c8)),'errors':_0x36e2c3['flash'](_0x3b1283(0x1ed)),'purchases':_0x507ec5,'role':_0x513453,'profile':_0x509406,'master_shop':_0x4c42b5,'language':_0x458c11});}catch(_0x2a756c){console[_0x3b1283(0x127)](_0x3b1283(0x217),_0x2a756c),_0x19f96d[_0x3b1283(0x214)](0xc8)['json']({'message':_0x2a756c[_0x3b1283(0x13f)]});}}),router['get']('/view_log',auth,async(_0x4b8d00,_0x58ebe1)=>{var _0x15fa25=a0_0x431e3e;try{const {username:_0x107226,email:_0x4049bd,role:_0xefc66d}=_0x4b8d00['user'],_0x4c8ab3=_0x4b8d00['user'],_0x3b7a67=await profile[_0x15fa25(0x1ef)]({'email':_0x4c8ab3[_0x15fa25(0x107)]}),_0x12057b=await staff[_0x15fa25(0x1ef)]({'email':_0x4c8ab3[_0x15fa25(0x107)]});if(_0x4c8ab3[_0x15fa25(0x1f4)]==_0x15fa25(0x1f1)){const _0x5cca15=await staff[_0x15fa25(0x1ef)]({'email':_0x4c8ab3['email']});}const _0x25c031=await master_shop[_0x15fa25(0x13b)]();let _0x5ee6e0;if(_0x4c8ab3[_0x15fa25(0x1f4)]==_0x15fa25(0x1f1)){const _0x3102da=await staff[_0x15fa25(0x1ef)]({'email':_0x4c8ab3['email']});_0x5ee6e0=await purchases_finished[_0x15fa25(0x201)]([{'$match':{'warehouse_name':_0x3102da[_0x15fa25(0x231)]}},{'$lookup':{'from':'suppliers','localField':_0x15fa25(0x1da),'foreignField':_0x15fa25(0x1bf),'as':_0x15fa25(0x132)}},{'$unwind':_0x15fa25(0x1d0)},{'$unwind':_0x15fa25(0x119)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x15fa25(0x1eb)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x15fa25(0x11e)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x15fa25(0x1ea)},'due_amount':{'$first':_0x15fa25(0x149)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x15fa25(0x120)},'expiry_date':{'$first':_0x15fa25(0x147)},'suppliers_docs':{'$first':_0x15fa25(0x1d0)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x15fa25(0x1d8)},'isle':{'$addToSet':_0x15fa25(0x198)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5ee6e0=await purchases_finished[_0x15fa25(0x201)]([{'$match':{'typeOfProducts':_0x15fa25(0x241)}},{'$unwind':_0x15fa25(0x119)},{'$group':{'_id':_0x15fa25(0x1bd),'invoice':{'$first':_0x15fa25(0x1c9)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x15fa25(0x194)},'warehouse_name':{'$first':_0x15fa25(0x15f)},'room':{'$addToSet':_0x15fa25(0x14c)},'product':{'$push':_0x15fa25(0x119)},'note':{'$first':_0x15fa25(0x16e)},'paid_amount':{'$first':_0x15fa25(0x1ea)},'due_amount':{'$first':_0x15fa25(0x149)},'return_data':{'$first':_0x15fa25(0x145)},'batch_code':{'$first':_0x15fa25(0x120)},'expiry_date':{'$first':_0x15fa25(0x147)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x15fa25(0x100)},'level':{'$addToSet':_0x15fa25(0x1d8)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x25c031[0x0][_0x15fa25(0x122)]==_0x15fa25(0x1cf))var _0x339b51=users[_0x15fa25(0x233)];else{if(_0x25c031[0x0][_0x15fa25(0x122)]=='Hindi')var _0x339b51=users[_0x15fa25(0x1ce)];else{if(_0x25c031[0x0][_0x15fa25(0x122)]==_0x15fa25(0x247))var _0x339b51=users[_0x15fa25(0x247)];else{if(_0x25c031[0x0][_0x15fa25(0x122)]==_0x15fa25(0x224))var _0x339b51=users[_0x15fa25(0x224)];else{if(_0x25c031[0x0][_0x15fa25(0x122)]==_0x15fa25(0x209))var _0x339b51=users[_0x15fa25(0x209)];else{if(_0x25c031[0x0][_0x15fa25(0x122)]=='Portuguese\x20(BR)')var _0x339b51=users['Portuguese'];else{if(_0x25c031[0x0][_0x15fa25(0x122)]=='Chinese')var _0x339b51=users[_0x15fa25(0x117)];else{if(_0x25c031[0x0]['language']==_0x15fa25(0x186))var _0x339b51=users[_0x15fa25(0x1a9)];}}}}}}}_0x58ebe1[_0x15fa25(0x116)](_0x15fa25(0x16a),{'success':_0x4b8d00[_0x15fa25(0x230)](_0x15fa25(0x1c8)),'errors':_0x4b8d00[_0x15fa25(0x230)]('errors'),'purchases':_0x5ee6e0,'role':_0x4c8ab3,'profile':_0x3b7a67,'master_shop':_0x25c031,'language':_0x339b51});}catch(_0x53c671){console[_0x15fa25(0x127)]('table\x20page',_0x53c671),_0x58ebe1[_0x15fa25(0x214)](0xc8)[_0x15fa25(0x192)]({'message':_0x53c671[_0x15fa25(0x13f)]});}});function BayBinSelected(_0x5e1ee3,_0x2a4e5d){var _0x456353=a0_0x431e3e,_0x362264=[],_0x58275c=[];if(_0x5e1ee3==_0x456353(0x23b)){switch(_0x2a4e5d){case _0x456353(0x1e3):_0x362264=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x456353(0x22a):_0x362264=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x58275c=['DG'];}else{if(_0x5e1ee3==_0x456353(0x130)){switch(_0x2a4e5d){case'Rack\x201':_0x362264=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x456353(0x22a):_0x362264=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x58275c=['FG'];}}return{'levels':_0x362264,'identify':_0x58275c};}async function getRandom8DigitNumber(){var _0x5ea41c=a0_0x431e3e;const _0x594c2d=0x989680,_0x5c7d76=0x5f5e0ff,_0xdbed2c=Math[_0x5ea41c(0x20e)](Math[_0x5ea41c(0x1df)]()*(_0x5c7d76-_0x594c2d+0x1))+_0x594c2d;var _0x33d512;const _0x1c05c7=await purchases_finished[_0x5ea41c(0x1ef)]({'invoice':_0x5ea41c(0x1a7)+_0xdbed2c});return _0x1c05c7&&_0x1c05c7[_0x5ea41c(0x23e)]>0x0?_0x33d512=_0x5ea41c(0x1a7)+_0xdbed2c:_0x33d512=_0x5ea41c(0x1a7)+_0xdbed2c,_0x33d512;}router[a0_0x431e3e(0x103)](a0_0x431e3e(0x24a),auth,async(_0x4632e5,_0x28fbbd)=>{var _0x3866d6=a0_0x431e3e;try{const {username:_0x4f6547,email:_0x4add42,role:_0xc3e8e}=_0x4632e5[_0x3866d6(0x239)],_0x4cb074=_0x4632e5[_0x3866d6(0x239)],_0xf8194f=await profile[_0x3866d6(0x1ef)]({'email':_0x4cb074[_0x3866d6(0x107)]}),_0x5a2744=await master_shop[_0x3866d6(0x13b)](),_0x1471b7=await staff['findOne']({'email':_0x4cb074[_0x3866d6(0x107)]}),_0x261a97=await suppliers[_0x3866d6(0x13b)]({});let _0x598ce4;if(_0x4cb074['role']=='staff'){const _0x16f075=await staff['findOne']({'email':_0x4cb074['email']});_0x598ce4=await warehouse[_0x3866d6(0x201)]([{'$match':{'status':'Enabled','name':_0x16f075[_0x3866d6(0x231)]}},{'$group':{'_id':'$name','name':{'$first':_0x3866d6(0x1e7)}}}]);}else _0x598ce4=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3866d6(0x1e7),'name':{'$first':'$name'}}}]);const _0x93ba6d=await product['find']({}),_0x3616ea=await warehouse['find']({'status':'Enabled'}),_0xae5777=await purchases_finished[_0x3866d6(0x13b)]({}),_0x4f6463=_0xae5777['length']+0x1,_0x5ae1ad=_0x3866d6(0x1a7)+_0x4f6463[_0x3866d6(0x243)]()['padStart'](0x5,'0');var _0x4f9e96=[_0x3866d6(0x227),'Enclosed'];if(_0x5a2744[0x0][_0x3866d6(0x122)]=='English\x20(US)')var _0x3924d3=users[_0x3866d6(0x233)];else{if(_0x5a2744[0x0][_0x3866d6(0x122)]=='Hindi')var _0x3924d3=users[_0x3866d6(0x1ce)];else{if(_0x5a2744[0x0][_0x3866d6(0x122)]==_0x3866d6(0x247))var _0x3924d3=users[_0x3866d6(0x247)];else{if(_0x5a2744[0x0][_0x3866d6(0x122)]=='Spanish')var _0x3924d3=users[_0x3866d6(0x224)];else{if(_0x5a2744[0x0][_0x3866d6(0x122)]==_0x3866d6(0x209))var _0x3924d3=users[_0x3866d6(0x209)];else{if(_0x5a2744[0x0][_0x3866d6(0x122)]=='Portuguese\x20(BR)')var _0x3924d3=users[_0x3866d6(0x1a6)];else{if(_0x5a2744[0x0]['language']=='Chinese')var _0x3924d3=users[_0x3866d6(0x117)];else{if(_0x5a2744[0x0][_0x3866d6(0x122)]==_0x3866d6(0x186))var _0x3924d3=users['Arabic'];}}}}}}}const _0x184838=getRandom8DigitNumber(),_0x3f3a60=new Date(),_0x3280a8={'year':_0x3866d6(0x172),'month':'2-digit','day':_0x3866d6(0x17e),'timeZone':'Asia/Manila'},_0x20697b=_0x3f3a60[_0x3866d6(0x183)](_0x3866d6(0x197),_0x3280a8);console['log'](_0x20697b),_0x184838[_0x3866d6(0x18d)](_0x5056c6=>{var _0x198b54=_0x3866d6;_0x28fbbd['render'](_0x198b54(0x204),{'success':_0x4632e5[_0x198b54(0x230)](_0x198b54(0x1c8)),'errors':_0x4632e5[_0x198b54(0x230)](_0x198b54(0x1ed)),'role':_0x4cb074,'profile':_0xf8194f,'suppliers':_0x261a97,'warehouse':_0x598ce4,'product':_0x93ba6d,'invoice':_0x5056c6,'master_shop':_0x5a2744,'language':_0x3924d3,'find_data':_0x3616ea,'rooms_data':_0x4f9e96,'formattedDate':_0x20697b});})['catch'](_0x4b2ce1=>{var _0x4528ce=_0x3866d6;_0x4632e5[_0x4528ce(0x230)](_0x4528ce(0x1ed),_0x4528ce(0x245)),_0x28fbbd['redirect'](_0x4528ce(0x1c1));});}catch(_0x126808){console['log'](_0x126808);}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x1c4),auth,async(_0x336c79,_0x45ad84)=>{var _0x369725=a0_0x431e3e;try{const {username:_0x262537,email:_0x18bddd,role:_0x51a794}=_0x336c79[_0x369725(0x239)],_0x5c0696=_0x336c79[_0x369725(0x239)],_0x416569=await profile['findOne']({'email':_0x5c0696[_0x369725(0x107)]}),_0x27888b=await master_shop[_0x369725(0x13b)](),_0x5c4ecd=await staff['findOne']({'email':_0x5c0696[_0x369725(0x107)]}),_0x3f914c=await suppliers[_0x369725(0x13b)]({});let _0x138902;if(_0x5c0696[_0x369725(0x1f4)]==_0x369725(0x1f1)){const _0x2450e0=await staff[_0x369725(0x1ef)]({'email':_0x5c0696[_0x369725(0x107)]});_0x138902=await warehouse['aggregate']([{'$match':{'status':_0x369725(0x1ab),'name':_0x2450e0[_0x369725(0x231)]}},{'$group':{'_id':_0x369725(0x1e7),'name':{'$first':_0x369725(0x1e7)}}}]);}else _0x138902=await warehouse['aggregate']([{'$match':{'status':_0x369725(0x1ab)}},{'$group':{'_id':_0x369725(0x1e7),'name':{'$first':_0x369725(0x1e7)}}}]);const _0x4f54b9=await product[_0x369725(0x13b)]({}),_0x3ab190=await warehouse[_0x369725(0x13b)]({'status':_0x369725(0x1ab)}),_0x5485f1=await purchases_finished[_0x369725(0x13b)]({}),_0x3f56c7=_0x5485f1[_0x369725(0x23e)]+0x1,_0x5e220e=_0x369725(0x1a7)+_0x3f56c7[_0x369725(0x243)]()[_0x369725(0x23a)](0x5,'0');var _0x582182=[_0x369725(0x227),_0x369725(0x1e2)];if(_0x27888b[0x0]['language']==_0x369725(0x1cf))var _0x1d97a6=users['English'];else{if(_0x27888b[0x0][_0x369725(0x122)]=='Hindi')var _0x1d97a6=users['Hindi'];else{if(_0x27888b[0x0]['language']=='German')var _0x1d97a6=users['German'];else{if(_0x27888b[0x0][_0x369725(0x122)]=='Spanish')var _0x1d97a6=users[_0x369725(0x224)];else{if(_0x27888b[0x0][_0x369725(0x122)]==_0x369725(0x209))var _0x1d97a6=users[_0x369725(0x209)];else{if(_0x27888b[0x0][_0x369725(0x122)]=='Portuguese\x20(BR)')var _0x1d97a6=users[_0x369725(0x1a6)];else{if(_0x27888b[0x0][_0x369725(0x122)]==_0x369725(0x117))var _0x1d97a6=users['Chinese'];else{if(_0x27888b[0x0][_0x369725(0x122)]=='Arabic\x20(ae)')var _0x1d97a6=users[_0x369725(0x1a9)];}}}}}}}const _0x1a2547=getRandom8DigitNumber();_0x1a2547[_0x369725(0x18d)](_0x238349=>{var _0x53a89e=_0x369725;_0x45ad84[_0x53a89e(0x116)](_0x53a89e(0x1ba),{'success':_0x336c79['flash'](_0x53a89e(0x1c8)),'errors':_0x336c79[_0x53a89e(0x230)](_0x53a89e(0x1ed)),'role':_0x5c0696,'profile':_0x416569,'suppliers':_0x3f914c,'warehouse':_0x138902,'product':_0x4f54b9,'invoice':_0x238349,'master_shop':_0x27888b,'language':_0x1d97a6,'find_data':_0x3ab190,'rooms_data':_0x582182});})[_0x369725(0x1de)](_0x3cbc68=>{var _0x217f47=_0x369725;_0x336c79[_0x217f47(0x230)](_0x217f47(0x1ed),_0x217f47(0x245)),_0x45ad84[_0x217f47(0x20b)](_0x217f47(0x1c1));});}catch(_0x5f18d6){console[_0x369725(0x127)](_0x5f18d6);}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x14d),auth,async(_0x24cecf,_0x4723f6)=>{var _0x18c2fa=a0_0x431e3e;try{const _0x119539=_0x24cecf[_0x18c2fa(0x22b)]['id'];console['log'](_0x119539);const _0x24c9f4=await master_shop[_0x18c2fa(0x13b)]();console[_0x18c2fa(0x127)](_0x18c2fa(0x165),_0x24c9f4);const _0x40f747=await product[_0x18c2fa(0x1ef)]({'name':_0x119539});console[_0x18c2fa(0x127)]('product',_0x40f747),_0x4723f6[_0x18c2fa(0x214)](0xc8)[_0x18c2fa(0x192)]({'product_data':_0x40f747,'master':_0x24c9f4});}catch(_0x11a940){console['log'](_0x18c2fa(0x1b6),_0x11a940);}}),router[a0_0x431e3e(0x15c)](a0_0x431e3e(0x24a),auth,async(_0x1eab2d,_0x483657)=>{var _0x37c008=a0_0x431e3e;try{const {invoice:_0x5e0890,date:_0x286887,warehouse_name:_0x2ae5e2,prod_name:_0x30cbd5,note:_0x50d0b0,due_amount:_0x587e57,Room_name:_0x2c1d12,PO_number:_0x1c7e9b,SCRN:_0x489759,ReqBy:_0xc919de,dateofreq:_0xcb39f6,suppliers:_0x37d166,typeservicesData:_0x5d7f4d,van:_0x141f42,typevehicle:_0x2906d4,driver:_0x388a24,plate:_0x5c6961,DRSI:_0x3d1cde,TSU:_0x273b54,TFU:_0xcdf6ef,JO_number:_0x52f4b1,type_of_products:_0x41a18b}=_0x1eab2d['body'];if(typeof _0x30cbd5==_0x37c008(0x202))var _0x19b36b=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x161)]],_0x43ce13=[_0x1eab2d[_0x37c008(0x178)]['prod_code']],_0x4bbbb9=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x162)]],_0x22d3a4=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x1e4)]],_0x1d4e8b=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x21d)]],_0x5c4919=[_0x1eab2d[_0x37c008(0x178)]['primary_code']],_0x20796a=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x1bc)]],_0x5cf8c1=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x17f)]],_0x468a22=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x20a)]],_0x276dac=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x1f7)]],_0x1c3073=[_0x1eab2d[_0x37c008(0x178)]['product_date']],_0x353e0c=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x126)]],_0x1b4290=[_0x1eab2d['body']['prod_cat']],_0x290b80=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x18e)]],_0x4c002a=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x13a)]],_0x38d7a9=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x146)]],_0x2c2029=[_0x1eab2d[_0x37c008(0x178)][_0x37c008(0x164)]];else var _0x19b36b=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x161)]],_0x43ce13=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x144)]],_0x4bbbb9=[..._0x1eab2d[_0x37c008(0x178)]['prod_Qty']],_0x22d3a4=[..._0x1eab2d['body']['prod_primunit']],_0x1d4e8b=[..._0x1eab2d[_0x37c008(0x178)]['prod_secondunit']],_0x5c4919=[..._0x1eab2d[_0x37c008(0x178)]['primary_code']],_0x20796a=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x1bc)]],_0x5cf8c1=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x17f)]],_0x468a22=[..._0x1eab2d['body'][_0x37c008(0x20a)]],_0x276dac=[..._0x1eab2d['body']['expiry_date']],_0x1c3073=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x1cc)]],_0x353e0c=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x126)]],_0x1b4290=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x1cd)]],_0x290b80=[..._0x1eab2d[_0x37c008(0x178)][_0x37c008(0x18e)]],_0x4c002a=[..._0x1eab2d['body'][_0x37c008(0x13a)]],_0x38d7a9=[..._0x1eab2d['body'][_0x37c008(0x146)]],_0x2c2029=[..._0x1eab2d[_0x37c008(0x178)]['product_id']];const _0x2850b7=_0x19b36b[_0x37c008(0x15a)](_0x409398=>{return _0x409398={'product_name':_0x409398};});_0x2c2029['forEach']((_0x4385a5,_0x2c35ba)=>{var _0x2fa174=_0x37c008;_0x2850b7[_0x2c35ba][_0x2fa174(0x164)]=_0x4385a5,_0x2850b7[_0x2c35ba]['date_recieved']=_0x286887;}),_0x38d7a9[_0x37c008(0x12a)]((_0x4a5097,_0x77fe19)=>{_0x2850b7[_0x77fe19]['sales_category']=_0x4a5097;}),_0x43ce13[_0x37c008(0x12a)]((_0xa1fe33,_0x313812)=>{var _0x460f8e=_0x37c008;_0x2850b7[_0x313812][_0x460f8e(0x11c)]=_0xa1fe33;}),_0x4c002a['forEach']((_0x404a5d,_0x1ebea2)=>{var _0x52b55a=_0x37c008;_0x2850b7[_0x1ebea2][_0x52b55a(0x13a)]=_0x404a5d;}),_0x4bbbb9[_0x37c008(0x12a)]((_0x459cab,_0x240a0f)=>{var _0x288692=_0x37c008;_0x2850b7[_0x240a0f]['quantity']=Math[_0x288692(0x216)](_0x459cab);}),_0x22d3a4['forEach']((_0x2755bd,_0x275c1e)=>{var _0x121906=_0x37c008;_0x2850b7[_0x275c1e][_0x121906(0x220)]=_0x2755bd;}),_0x1d4e8b[_0x37c008(0x12a)]((_0x1a607e,_0x41c790)=>{var _0x4aca87=_0x37c008;_0x2850b7[_0x41c790][_0x4aca87(0x10e)]=_0x1a607e;}),_0x5c4919[_0x37c008(0x12a)]((_0x17a5cf,_0x3cc2c3)=>{var _0x4c943f=_0x37c008;_0x2850b7[_0x3cc2c3][_0x4c943f(0x142)]=_0x17a5cf;}),_0x20796a[_0x37c008(0x12a)]((_0x592d01,_0x49d623)=>{var _0x5e59af=_0x37c008;_0x2850b7[_0x49d623][_0x5e59af(0x1bc)]=_0x592d01;}),_0x5cf8c1[_0x37c008(0x12a)]((_0x1e2579,_0x49693d)=>{_0x2850b7[_0x49693d]['maxStocks']=_0x1e2579;}),_0x468a22[_0x37c008(0x12a)]((_0x1a6963,_0x414dc1)=>{var _0x48e638=_0x37c008;_0x2850b7[_0x414dc1][_0x48e638(0x20a)]=_0x1a6963;}),_0x276dac[_0x37c008(0x12a)]((_0x1be1e2,_0x82d90b)=>{_0x2850b7[_0x82d90b]['expiry_date']=_0x1be1e2;}),_0x1c3073[_0x37c008(0x12a)]((_0x503508,_0x356722)=>{var _0x4c9923=_0x37c008;_0x2850b7[_0x356722][_0x4c9923(0x112)]=_0x503508;}),_0x353e0c[_0x37c008(0x12a)]((_0x20166a,_0x2af079)=>{var _0x217494=_0x37c008;_0x2850b7[_0x2af079][_0x217494(0x20f)]=_0x20166a;}),_0x1b4290[_0x37c008(0x12a)]((_0x594508,_0x3053c9)=>{var _0x1e25b7=_0x37c008;_0x2850b7[_0x3053c9][_0x1e25b7(0x242)]=_0x594508;}),_0x290b80['forEach']((_0x554e71,_0xa2e16c)=>{var _0x15ee6c=_0x37c008;_0x2850b7[_0xa2e16c][_0x15ee6c(0x18e)]=_0x554e71;});const _0x2c22e6=new invoice_for_incoming();await _0x2c22e6[_0x37c008(0x1f3)]();for(let _0x4d3aee=0x0;_0x4d3aee<=_0x19b36b['length']-0x1;_0x4d3aee++){_0x2850b7[_0x4d3aee]['invoice']=_0x37c008(0x1d9)+_0x2c22e6['invoice_init'][_0x37c008(0x243)]()['padStart'](0x8,'0');}const _0x595a6d=await warehouse_validation_setup[_0x37c008(0x201)]([{'$match':{'warehouse_name':_0x2ae5e2}}]);for(let _0x3d638e=0x0;_0x3d638e<=_0x595a6d['length']-0x1;_0x3d638e++){const _0x500baf=_0x595a6d[_0x3d638e];for(let _0x364e9c=0x0;_0x364e9c<=_0x500baf[_0x37c008(0x1ae)]['length']-0x1;_0x364e9c++){const _0x36ea6e=_0x500baf['product_data'][_0x364e9c],_0xaa61aa=await warehouse[_0x37c008(0x201)]([{'$match':{'name':_0x500baf[_0x37c008(0x185)],'room':_0x500baf['room']}},{'$unwind':_0x37c008(0x170)},{'$match':{'product_details.level':_0x36ea6e[_0x37c008(0x1e8)],'product_details.bay':parseInt(_0x36ea6e['bin']),'product_details.product_code':_0x36ea6e[_0x37c008(0x11c)]}}]);for(let _0x5d22eb=0x0;_0x5d22eb<=_0xaa61aa['length']-0x1;_0x5d22eb++){let _0xde2770=_0xaa61aa[_0x5d22eb],_0x1d24de=0x0;_0xde2770[_0x37c008(0x17c)]['product_code']==_0x36ea6e[_0x37c008(0x11c)]&&_0xde2770[_0x37c008(0x17c)][_0x37c008(0x1e8)]==_0x36ea6e[_0x37c008(0x1d6)]&&_0xde2770['product_details'][_0x37c008(0x23c)]==_0x36ea6e['bay']&&(_0x36ea6e[_0x37c008(0x240)]=parseInt(_0x36ea6e[_0x37c008(0x240)])-parseInt(_0xde2770[_0x37c008(0x17c)][_0x37c008(0x22d)]),_0x1d24de++),_0x1d24de=='0'&&(parseInt(_0x36ea6e[_0x37c008(0x240)])>0x0&&(_0x595a6d[_0x3d638e][_0x37c008(0x1ae)]=_0x595a6d[_0x3d638e]['product_data'][_0x37c008(0x151)]({'bay':_0x36ea6e[_0x37c008(0x1e8)],'bin':_0x36ea6e['bin'],'max':_0x36ea6e[_0x37c008(0x240)],'min':_0x36ea6e[_0x37c008(0x150)],'product_code':_0x36ea6e[_0x37c008(0x11c)],'product_id':_0x36ea6e['product_id'],'product_name':_0x36ea6e[_0x37c008(0x15b)]})));}}_0x595a6d[_0x3d638e]['product_data']=_0x595a6d[_0x3d638e]['product_data']['filter'](_0x30feeb=>parseInt(_0x30feeb[_0x37c008(0x240)])>0x0);}let _0x253363=[];for(let _0x1d4e71=0x0;_0x1d4e71<=_0x2850b7[_0x37c008(0x23e)]-0x1;_0x1d4e71++){const _0x358aab=_0x2850b7[_0x1d4e71];for(let _0x3275bd=0x0;_0x3275bd<=_0x595a6d['length']-0x1;_0x3275bd++){const _0x5014a0=_0x595a6d[_0x3275bd];for(let _0x46c3e6=0x0;_0x46c3e6<=_0x5014a0[_0x37c008(0x1ae)][_0x37c008(0x23e)]-0x1;_0x46c3e6++){const _0x413598=_0x5014a0[_0x37c008(0x1ae)][_0x46c3e6];if(_0x413598['product_code']===_0x358aab['product_code']){let _0x10e4e7=_0x358aab['quantity'];const _0x3dd80d=await warehouse['aggregate']([{'$match':{'name':_0x2ae5e2,'room':_0x5014a0[_0x37c008(0x237)]}},{'$unwind':_0x37c008(0x170)},{'$match':{'product_details.level':_0x413598[_0x37c008(0x1e8)],'product_details.bay':parseInt(_0x413598[_0x37c008(0x1d6)])}}]);if(_0x3dd80d[_0x37c008(0x23e)]==0x0){let _0x340f89=0x0;for(let _0x191f45=0x0;_0x191f45<=_0x5014a0['product_data']['length']-0x1&&_0x10e4e7>0x0;_0x191f45++){const _0x4b2ff8=_0x5014a0[_0x37c008(0x1ae)][_0x191f45];if(_0x358aab['product_code']===_0x4b2ff8[_0x37c008(0x11c)]){_0x253363[_0x191f45]={};const _0x51f6d1=parseInt(_0x4b2ff8['max']),_0x5bb270=0x0;let _0x1f63dc=_0x51f6d1-_0x5bb270,_0x5569ab=Math[_0x37c008(0x150)](_0x10e4e7,_0x1f63dc);console[_0x37c008(0x127)](_0x37c008(0x196)+_0x5569ab+'\x20units\x20to\x20warehouse:\x20'+_0x5014a0[_0x37c008(0x185)]+',\x20room:\x20'+_0x5014a0[_0x37c008(0x237)]+_0x37c008(0x1d5)+_0x4b2ff8[_0x37c008(0x1e8)]+_0x37c008(0x21e)+_0x4b2ff8[_0x37c008(0x1d6)]),_0x253363[_0x191f45]['product_name']=_0x358aab[_0x37c008(0x15b)],_0x253363[_0x191f45]['product_code']=_0x358aab[_0x37c008(0x11c)],_0x253363[_0x191f45]['product_id']=_0x358aab[_0x37c008(0x164)],_0x253363[_0x191f45][_0x37c008(0x207)]=_0x358aab[_0x37c008(0x207)],_0x253363[_0x191f45][_0x37c008(0x22c)]=_0x358aab[_0x37c008(0x22c)],_0x253363[_0x191f45]['uuid']=_0x358aab['uuid'],_0x253363[_0x191f45]['quantity']=_0x5569ab,_0x253363[_0x191f45][_0x37c008(0x220)]=_0x358aab['standard_unit'],_0x253363[_0x191f45][_0x37c008(0x10e)]=_0x358aab[_0x37c008(0x10e)],_0x253363[_0x191f45]['primary_code']=_0x358aab[_0x37c008(0x142)],_0x253363[_0x191f45][_0x37c008(0x1bc)]=_0x358aab['secondary_code'],_0x253363[_0x191f45][_0x37c008(0x20d)]=_0x358aab['maxStocks'],_0x253363[_0x191f45][_0x37c008(0x20a)]=_0x358aab[_0x37c008(0x20a)],_0x253363[_0x191f45]['expiry_date']=_0x358aab[_0x37c008(0x1f7)],_0x253363[_0x191f45][_0x37c008(0x112)]=_0x358aab['production_date'],_0x253363[_0x191f45][_0x37c008(0x20f)]=_0x358aab['maxperunit'],_0x253363[_0x191f45][_0x37c008(0x242)]=_0x358aab[_0x37c008(0x242)],_0x253363[_0x191f45][_0x37c008(0x1b9)]=_0x358aab['invoice'],_0x253363[_0x191f45][_0x37c008(0x18e)]=_0x358aab['gross_price'],_0x253363[_0x191f45]['room_name']=_0x5014a0['room'],_0x253363[_0x191f45][_0x37c008(0x23c)]=_0x4b2ff8[_0x37c008(0x1e8)],_0x253363[_0x191f45]['bay']=_0x4b2ff8[_0x37c008(0x1d6)],console[_0x37c008(0x127)](_0x191f45),_0x10e4e7-=_0x5569ab;if(_0x10e4e7<=0x0)break;_0x340f89++;}}if(_0x10e4e7<=0x0){console[_0x37c008(0x127)](_0x37c008(0x1c6)+_0x10e4e7+_0x37c008(0x1fb)),_0x1eab2d[_0x37c008(0x230)](_0x37c008(0x1ed),_0x37c008(0x159)+_0x10e4e7+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x10e4e7>0x0){console[_0x37c008(0x127)](_0x37c008(0x1c6)+_0x10e4e7+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');const _0x2d31d5=await warehouse[_0x37c008(0x201)]([{'$match':{'name':_0x2ae5e2,'isStaging':'true'}}]);_0x253363[_0x340f89]={},_0x253363[_0x340f89][_0x37c008(0x15b)]=_0x358aab[_0x37c008(0x15b)],_0x253363[_0x340f89][_0x37c008(0x11c)]=_0x358aab['product_code'],_0x253363[_0x340f89][_0x37c008(0x164)]=_0x358aab[_0x37c008(0x164)],_0x253363[_0x340f89][_0x37c008(0x207)]=_0x358aab[_0x37c008(0x207)],_0x253363[_0x340f89][_0x37c008(0x22c)]=_0x358aab[_0x37c008(0x22c)],_0x253363[_0x340f89][_0x37c008(0x13a)]=_0x358aab[_0x37c008(0x13a)],_0x253363[_0x340f89][_0x37c008(0x193)]=_0x10e4e7,_0x253363[_0x340f89]['standard_unit']=_0x358aab['standard_unit'],_0x253363[_0x340f89][_0x37c008(0x10e)]=_0x358aab[_0x37c008(0x10e)],_0x253363[_0x340f89][_0x37c008(0x142)]=_0x358aab[_0x37c008(0x142)],_0x253363[_0x340f89][_0x37c008(0x1bc)]=_0x358aab[_0x37c008(0x1bc)],_0x253363[_0x340f89][_0x37c008(0x20d)]=_0x358aab[_0x37c008(0x20d)],_0x253363[_0x340f89][_0x37c008(0x20a)]=_0x358aab['batch_code'],_0x253363[_0x340f89][_0x37c008(0x1f7)]=_0x358aab[_0x37c008(0x1f7)],_0x253363[_0x340f89]['production_date']=_0x358aab['production_date'],_0x253363[_0x340f89][_0x37c008(0x20f)]=_0x358aab['maxperunit'],_0x253363[_0x340f89][_0x37c008(0x242)]=_0x358aab[_0x37c008(0x242)],_0x253363[_0x340f89]['invoice']=_0x358aab[_0x37c008(0x1b9)],_0x253363[_0x340f89][_0x37c008(0x18e)]=_0x358aab[_0x37c008(0x18e)],_0x253363[_0x340f89][_0x37c008(0x133)]=_0x2d31d5[0x0][_0x37c008(0x237)],_0x253363[_0x340f89][_0x37c008(0x23c)]=_0x37c008(0x189),_0x253363[_0x340f89][_0x37c008(0x1e8)]='1',_0x1eab2d[_0x37c008(0x230)](_0x37c008(0x1ed),_0x37c008(0x159)+_0x10e4e7+_0x37c008(0x21b));break;}}else{console[_0x37c008(0x127)](_0x413598['product_code']+_0x37c008(0x12e)+_0x413598[_0x37c008(0x1e8)]+_0x37c008(0x12e)+_0x413598[_0x37c008(0x1d6)]+_0x37c008(0x12e)+_0x10e4e7);for(let _0x1373fe=0x0;_0x1373fe<=_0x5014a0[_0x37c008(0x1ae)]['length']-0x1&&_0x10e4e7>0x0;_0x1373fe++){const _0x2d6723=_0x5014a0[_0x37c008(0x1ae)][_0x1373fe];if(_0x358aab[_0x37c008(0x11c)]===_0x2d6723[_0x37c008(0x11c)]){_0x253363[_0x1373fe]={};const _0x2d2360=parseInt(_0x2d6723[_0x37c008(0x240)]),_0x2f21f8=0x0;let _0x53f90b=_0x2d2360-_0x2f21f8,_0x3bd59b=Math[_0x37c008(0x150)](_0x10e4e7,_0x53f90b);console[_0x37c008(0x127)]('Distributing\x20'+_0x3bd59b+_0x37c008(0x1f2)+_0x5014a0[_0x37c008(0x185)]+',\x20room:\x20'+_0x5014a0[_0x37c008(0x237)]+',\x20bay:\x20'+_0x2d6723[_0x37c008(0x1e8)]+_0x37c008(0x21e)+_0x2d6723[_0x37c008(0x1d6)]),_0x253363[_0x1373fe][_0x37c008(0x15b)]=_0x358aab[_0x37c008(0x15b)],_0x253363[_0x1373fe][_0x37c008(0x11c)]=_0x358aab[_0x37c008(0x11c)],_0x253363[_0x1373fe][_0x37c008(0x164)]=_0x358aab[_0x37c008(0x164)],_0x253363[_0x1373fe][_0x37c008(0x207)]=_0x358aab['date_recieved'],_0x253363[_0x1373fe][_0x37c008(0x22c)]=_0x358aab[_0x37c008(0x22c)],_0x253363[_0x1373fe][_0x37c008(0x13a)]=_0x358aab[_0x37c008(0x13a)],_0x253363[_0x1373fe][_0x37c008(0x193)]=_0x3bd59b,_0x253363[_0x1373fe][_0x37c008(0x220)]=_0x358aab[_0x37c008(0x220)],_0x253363[_0x1373fe][_0x37c008(0x10e)]=_0x358aab[_0x37c008(0x10e)],_0x253363[_0x1373fe][_0x37c008(0x142)]=_0x358aab[_0x37c008(0x142)],_0x253363[_0x1373fe][_0x37c008(0x1bc)]=_0x358aab[_0x37c008(0x1bc)],_0x253363[_0x1373fe][_0x37c008(0x20d)]=_0x358aab[_0x37c008(0x20d)],_0x253363[_0x1373fe][_0x37c008(0x20a)]=_0x358aab['batch_code'],_0x253363[_0x1373fe][_0x37c008(0x1f7)]=_0x358aab['expiry_date'],_0x253363[_0x1373fe]['production_date']=_0x358aab[_0x37c008(0x112)],_0x253363[_0x1373fe][_0x37c008(0x20f)]=_0x358aab[_0x37c008(0x20f)],_0x253363[_0x1373fe][_0x37c008(0x242)]=_0x358aab['product_cat'],_0x253363[_0x1373fe][_0x37c008(0x1b9)]=_0x358aab['invoice'],_0x253363[_0x1373fe][_0x37c008(0x18e)]=_0x358aab[_0x37c008(0x18e)],_0x253363[_0x1373fe][_0x37c008(0x133)]=_0x5014a0['room'],_0x253363[_0x1373fe][_0x37c008(0x23c)]=_0x2d6723['bay'],_0x253363[_0x1373fe][_0x37c008(0x1e8)]=_0x2d6723[_0x37c008(0x1d6)],_0x10e4e7-=_0x3bd59b;if(_0x10e4e7<=0x0)break;}}if(_0x10e4e7<=0x0){console[_0x37c008(0x127)](_0x37c008(0x1c6)+_0x10e4e7+_0x37c008(0x1ca));break;}_0x10e4e7>0x0&&(console[_0x37c008(0x127)](_0x37c008(0x1c6)+_0x10e4e7+_0x37c008(0x1ca)),_0x1eab2d[_0x37c008(0x230)](_0x37c008(0x1ed),_0x37c008(0x159)+_0x10e4e7+_0x37c008(0x16d)));}}}}}const _0x2659bd=_0x253363[_0x37c008(0x1f8)](_0xb11bce=>_0xb11bce[_0x37c008(0x193)]!=='0'&&_0xb11bce['quantity']!==''),_0x3e44ef=new purchases_finished({'invoice':_0x37c008(0x1d9)+_0x2c22e6[_0x37c008(0x1ee)][_0x37c008(0x243)]()[_0x37c008(0x23a)](0x8,'0'),'suppliers':_0x37d166,'date':_0x286887,'warehouse_name':_0x2ae5e2,'product':_0x2659bd,'note':_0x50d0b0,'due_amount':_0x587e57,'room':_0x2c1d12,'POnumber':_0x1c7e9b,'SCRN':_0x489759,'JO_number':_0x52f4b1,'ReqBy':_0xc919de,'dateofreq':_0xcb39f6,'typeservicesData':_0x5d7f4d,'van':_0x141f42,'typevehicle':_0x2906d4,'driver':_0x388a24,'plate':_0x5c6961,'DRSI':_0x3d1cde,'TSU':_0x273b54,'TFU':_0xcdf6ef,'typeOfProducts':_0x41a18b}),_0xe5681c=await _0x3e44ef[_0x37c008(0x1f3)](),_0x221fbe=await purchases_finished['findOne']({'_id':_0xe5681c['_id'][_0x37c008(0x19c)]()});_0x1eab2d[_0x37c008(0x230)]('success','purchase\x20data\x20add\x20successfully'),_0x483657[_0x37c008(0x20b)](_0x37c008(0x234)+_0x221fbe[_0x37c008(0x115)]['valueOf']());}catch(_0x163ebb){console['log'](_0x163ebb);}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x129),auth,async(_0x52aff1,_0x5e1bd2)=>{var _0x51bf40=a0_0x431e3e;try{const {username:_0x452e61,email:_0xc64a8a,role:_0x1d9797}=_0x52aff1[_0x51bf40(0x239)],_0x4a7884=_0x52aff1[_0x51bf40(0x239)],_0x3f61d5=_0x52aff1[_0x51bf40(0x22b)]['id'],_0x21ef51=await profile[_0x51bf40(0x1ef)]({'email':_0x4a7884[_0x51bf40(0x107)]}),_0x3f6086=await master_shop[_0x51bf40(0x13b)](),_0x24e9c2=await staff[_0x51bf40(0x1ef)]({'email':_0x4a7884[_0x51bf40(0x107)]}),_0x492e8a=await suppliers['find']({});let _0x32ebcd;if(_0x4a7884[_0x51bf40(0x1f4)]==_0x51bf40(0x1f1)){const _0x3c8b2f=await staff['findOne']({'email':_0x4a7884['email']});_0x32ebcd=await warehouse[_0x51bf40(0x201)]([{'$match':{'status':_0x51bf40(0x1ab),'name':_0x3c8b2f[_0x51bf40(0x231)]}},{'$group':{'_id':_0x51bf40(0x1e7),'name':{'$first':'$name'}}}]);}else _0x32ebcd=await warehouse[_0x51bf40(0x201)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x51bf40(0x1e7),'name':{'$first':_0x51bf40(0x1e7)}}}]);const _0x2e54be=await purchases_finished['findById'](_0x3f61d5);if(_0x3f6086[0x0][_0x51bf40(0x122)]==_0x51bf40(0x1cf))var _0x8c310c=users[_0x51bf40(0x233)];else{if(_0x3f6086[0x0][_0x51bf40(0x122)]==_0x51bf40(0x1ce))var _0x8c310c=users[_0x51bf40(0x1ce)];else{if(_0x3f6086[0x0][_0x51bf40(0x122)]==_0x51bf40(0x247))var _0x8c310c=users[_0x51bf40(0x247)];else{if(_0x3f6086[0x0]['language']==_0x51bf40(0x224))var _0x8c310c=users[_0x51bf40(0x224)];else{if(_0x3f6086[0x0]['language']=='French')var _0x8c310c=users[_0x51bf40(0x209)];else{if(_0x3f6086[0x0][_0x51bf40(0x122)]=='Portuguese\x20(BR)')var _0x8c310c=users[_0x51bf40(0x1a6)];else{if(_0x3f6086[0x0]['language']==_0x51bf40(0x117))var _0x8c310c=users['Chinese'];else{if(_0x3f6086[0x0][_0x51bf40(0x122)]=='Arabic\x20(ae)')var _0x8c310c=users[_0x51bf40(0x1a9)];}}}}}}}_0x5e1bd2[_0x51bf40(0x116)](_0x51bf40(0x210),{'success':_0x52aff1[_0x51bf40(0x230)](_0x51bf40(0x1c8)),'errors':_0x52aff1[_0x51bf40(0x230)](_0x51bf40(0x1ed)),'role':_0x4a7884,'profile':_0x21ef51,'suppliers':_0x492e8a,'warehouse':_0x32ebcd,'master_shop':_0x3f6086,'language':_0x8c310c,'purchases_data':_0x2e54be});}catch(_0x5dbd8e){console[_0x51bf40(0x127)](_0x5dbd8e);}});async function get_warehouse_data(_0x13cb3b,_0xf3b41c){var _0xb1dc3d=a0_0x431e3e;try{const _0x1f9755=await warehouse_temporary[_0xb1dc3d(0x1ef)]({'name':_0x13cb3b,'room':_0xf3b41c});if(!_0x1f9755){const _0x329c8b=new warehouse_temporary({'name':_0x13cb3b,'address':_0x13cb3b,'status':_0xb1dc3d(0x1ab),'room':_0xf3b41c,'isStaging':_0xb1dc3d(0x222)});return await _0x329c8b['save'](),_0x329c8b;}else return _0x1f9755;}catch(_0x290bec){console[_0xb1dc3d(0x11a)](_0xb1dc3d(0x177),_0x290bec);throw _0x290bec;}}function a0_0x49ab(_0x298b76,_0x5240c3){var _0x355a31=a0_0x355a();return a0_0x49ab=function(_0x49ab53,_0x5aaef0){_0x49ab53=_0x49ab53-0x100;var _0x4c754f=_0x355a31[_0x49ab53];return _0x4c754f;},a0_0x49ab(_0x298b76,_0x5240c3);}router['post'](a0_0x431e3e(0x129),auth,async(_0x53f4b1,_0x4f6eac)=>{var _0x5ba2fb=a0_0x431e3e;try{const _0x5ccf1c=_0x53f4b1[_0x5ba2fb(0x22b)]['id'],_0x191363=await purchases_finished[_0x5ba2fb(0x1f5)](_0x5ccf1c);let _0x4086f2=[];_0x191363[_0x5ba2fb(0x21f)][_0x5ba2fb(0x12a)]((_0x2c17f7,_0xcb325d)=>{var _0x28ca72=_0x5ba2fb;_0x4086f2[_0xcb325d]={},_0x4086f2[_0xcb325d][_0x28ca72(0x231)]=_0x191363[_0x28ca72(0x185)],_0x4086f2[_0xcb325d]['product_id']=_0x2c17f7[_0x28ca72(0x164)],_0x4086f2[_0xcb325d][_0x28ca72(0x15b)]=_0x2c17f7[_0x28ca72(0x15b)],_0x4086f2[_0xcb325d][_0x28ca72(0x11c)]=_0x2c17f7['product_code'],_0x4086f2[_0xcb325d]['product_stock']=_0x2c17f7[_0x28ca72(0x193)],_0x4086f2[_0xcb325d]['unit']=_0x2c17f7[_0x28ca72(0x220)],_0x4086f2[_0xcb325d][_0x28ca72(0x10e)]=_0x2c17f7[_0x28ca72(0x10e)],_0x4086f2[_0xcb325d][_0x28ca72(0x23c)]=_0x2c17f7[_0x28ca72(0x23c)],_0x4086f2[_0xcb325d]['bay']=_0x2c17f7['bay'],_0x4086f2[_0xcb325d][_0x28ca72(0x142)]=_0x2c17f7[_0x28ca72(0x142)],_0x4086f2[_0xcb325d][_0x28ca72(0x1bc)]=_0x2c17f7[_0x28ca72(0x1bc)],_0x4086f2[_0xcb325d][_0x28ca72(0x20d)]=_0x2c17f7[_0x28ca72(0x20d)],_0x4086f2[_0xcb325d][_0x28ca72(0x20a)]=_0x2c17f7[_0x28ca72(0x20a)],_0x4086f2[_0xcb325d][_0x28ca72(0x1f7)]=_0x2c17f7[_0x28ca72(0x1f7)],_0x4086f2[_0xcb325d]['production_date']=_0x2c17f7['production_date'],_0x4086f2[_0xcb325d][_0x28ca72(0x20f)]=_0x2c17f7[_0x28ca72(0x20f)],_0x4086f2[_0xcb325d]['product_cat']=_0x2c17f7[_0x28ca72(0x242)],_0x4086f2[_0xcb325d][_0x28ca72(0x133)]=_0x2c17f7['room_name'],_0x4086f2[_0xcb325d][_0x28ca72(0x1b9)]=_0x2c17f7[_0x28ca72(0x1b9)],_0x4086f2[_0xcb325d][_0x28ca72(0x13a)]=_0x2c17f7[_0x28ca72(0x13a)],_0x4086f2[_0xcb325d][_0x28ca72(0x18e)]=_0x2c17f7[_0x28ca72(0x18e)],_0x4086f2[_0xcb325d]['sales_category']=_0x2c17f7[_0x28ca72(0x22c)],_0x4086f2[_0xcb325d][_0x28ca72(0x207)]=_0x2c17f7[_0x28ca72(0x207)],_0x4086f2[_0xcb325d][_0x28ca72(0x1fd)]=_0x2c17f7['_id'][_0x28ca72(0x19c)](),_0x4086f2[_0xcb325d][_0x28ca72(0x17a)]=_0x28ca72(0x173),_0x4086f2[_0xcb325d][_0x28ca72(0x190)]=_0x28ca72(0x1a4),_0x4086f2[_0xcb325d][_0x28ca72(0x12b)]=_0x28ca72(0x222);});for(let _0x190c91=0x0;_0x190c91<=_0x4086f2['length']-0x1;_0x190c91++){const _0x1df524=_0x4086f2[_0x190c91],_0x4f2b82=new warehouse_temporary(_0x1df524);await _0x4f2b82[_0x5ba2fb(0x1f3)]();}_0x191363[_0x5ba2fb(0x19a)]=_0x5ba2fb(0x1a4),await _0x191363['save'](),_0x53f4b1[_0x5ba2fb(0x230)](_0x5ba2fb(0x1c8),_0x5ba2fb(0x244)),_0x4f6eac[_0x5ba2fb(0x20b)](_0x5ba2fb(0x234)+_0x191363['_id'][_0x5ba2fb(0x19c)]());}catch(_0x1fa9e2){}}),router[a0_0x431e3e(0x15c)]('/view/add_purchases_logs',auth,async(_0x24c5f7,_0x105bc6)=>{var _0x5a36dd=a0_0x431e3e;try{const {invoice:_0x31b068,date:_0x1b9aaa,warehouse_name:_0x2e4a87,prod_name:_0x269d32,note:_0x3251af,due_amount:_0x4cbf6e,Room_name:_0x3778ba,PO_number:_0x5474f8,SCRN:_0x43de58,ReqBy:_0x425dd7,dateofreq:_0xe2bd9c,suppliers:_0x3cf8e6,typeservicesData:_0x55e848,van:_0x4f8de9,typevehicle:_0x1606d8,driver:_0x38f250,plate:_0x378d92,DRSI:_0x5c89bf,TSU:_0x38d1bd,TFU:_0x434ea0,JO_number:_0xdef7e9,type_of_products:_0x2d3628}=_0x24c5f7['body'];if(typeof _0x269d32=='string')var _0x4bf476=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x161)]],_0x386d7b=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x144)]],_0x4b7997=[_0x24c5f7[_0x5a36dd(0x178)]['prod_Qty']],_0x348df2=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1e4)]],_0x10b85e=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x21d)]],_0x2e8412=[_0x24c5f7['body']['prod_level']],_0x534d5f=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x142)]],_0xd14093=[_0x24c5f7['body'][_0x5a36dd(0x1bc)]],_0x2c6530=[_0x24c5f7[_0x5a36dd(0x178)]['MaxStocks_data']],_0x235a05=[_0x24c5f7[_0x5a36dd(0x178)]['batch_code']],_0x44bf73=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1f7)]],_0x58bada=[_0x24c5f7[_0x5a36dd(0x178)]['product_date']],_0x5d8a48=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x126)]],_0x5e490e=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1cd)]],_0x1d7ad6=[_0x24c5f7['body'][_0x5a36dd(0x18f)]],_0xa491e5=[_0x24c5f7[_0x5a36dd(0x178)]['gross_price']],_0x69b7aa=[_0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x13a)]],_0x1c8d81=[_0x24c5f7['body']['sales_data_cateory']],_0x248740=[_0x24c5f7[_0x5a36dd(0x178)]['type_of_products_type']];else var _0x4bf476=[..._0x24c5f7[_0x5a36dd(0x178)]['prod_name']],_0x386d7b=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x144)]],_0x4b7997=[..._0x24c5f7[_0x5a36dd(0x178)]['prod_Qty']],_0x348df2=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1e4)]],_0x10b85e=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x21d)]],_0x2e8412=[..._0x24c5f7['body'][_0x5a36dd(0x249)]],_0x534d5f=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x142)]],_0xd14093=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1bc)]],_0x2c6530=[..._0x24c5f7['body']['MaxStocks_data']],_0x235a05=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x20a)]],_0x44bf73=[..._0x24c5f7[_0x5a36dd(0x178)]['expiry_date']],_0x58bada=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1cc)]],_0x5d8a48=[..._0x24c5f7['body'][_0x5a36dd(0x126)]],_0x5e490e=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x1cd)]],_0x1d7ad6=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x18f)]],_0xa491e5=[..._0x24c5f7[_0x5a36dd(0x178)]['gross_price']],_0x69b7aa=[..._0x24c5f7[_0x5a36dd(0x178)][_0x5a36dd(0x13a)]],_0x1c8d81=[..._0x24c5f7['body'][_0x5a36dd(0x146)]],_0x248740=[..._0x24c5f7[_0x5a36dd(0x178)]['type_of_products_type']];const _0x5af1a3=_0x4bf476[_0x5a36dd(0x15a)](_0x53a159=>{return _0x53a159={'product_name':_0x53a159};});_0x248740['forEach']((_0x1453f3,_0x4489fd)=>{var _0x2cc797=_0x5a36dd;_0x5af1a3[_0x4489fd][_0x2cc797(0x229)]=_0x1453f3;}),_0x1c8d81['forEach']((_0x3ad04b,_0x444bf5)=>{var _0x8710ff=_0x5a36dd;_0x5af1a3[_0x444bf5][_0x8710ff(0x22c)]=_0x3ad04b;}),_0x386d7b[_0x5a36dd(0x12a)]((_0x295a49,_0x2f657b)=>{var _0xd32d64=_0x5a36dd;_0x5af1a3[_0x2f657b][_0xd32d64(0x11c)]=_0x295a49;}),_0x69b7aa[_0x5a36dd(0x12a)]((_0x5666fa,_0x78d6fd)=>{var _0x2868fb=_0x5a36dd;_0x5af1a3[_0x78d6fd][_0x2868fb(0x13a)]=_0x5666fa;}),_0x4b7997['forEach']((_0x10d52b,_0x5a3822)=>{var _0x5a9eef=_0x5a36dd;_0x5af1a3[_0x5a3822][_0x5a9eef(0x193)]=Math['abs'](_0x10d52b);}),_0x348df2['forEach']((_0x169056,_0x1115e9)=>{var _0x496020=_0x5a36dd;_0x5af1a3[_0x1115e9][_0x496020(0x220)]=_0x169056;}),_0x10b85e[_0x5a36dd(0x12a)]((_0x39e198,_0x35958f)=>{var _0x179ebb=_0x5a36dd;_0x5af1a3[_0x35958f][_0x179ebb(0x10e)]=_0x39e198;}),_0x2e8412[_0x5a36dd(0x12a)]((_0x40e4ad,_0x54a690)=>{var _0x119d16=_0x5a36dd,_0x272063=_0x40e4ad[_0x119d16(0x179)](/[A-Za-z]+/)[0x0],_0x4050c6=parseInt(_0x40e4ad[_0x119d16(0x179)](/\d+/)[0x0]);_0x5af1a3[_0x54a690][_0x119d16(0x23c)]=_0x272063,_0x5af1a3[_0x54a690][_0x119d16(0x1e8)]=_0x4050c6;}),_0x534d5f['forEach']((_0x47bde6,_0x571a4e)=>{var _0x208a59=_0x5a36dd;_0x5af1a3[_0x571a4e][_0x208a59(0x142)]=_0x47bde6;}),_0xd14093[_0x5a36dd(0x12a)]((_0x1c340f,_0x25851b)=>{var _0x31e762=_0x5a36dd;_0x5af1a3[_0x25851b][_0x31e762(0x1bc)]=_0x1c340f;}),_0x2c6530[_0x5a36dd(0x12a)]((_0x1a136c,_0x132b46)=>{var _0x513d04=_0x5a36dd;_0x5af1a3[_0x132b46][_0x513d04(0x20d)]=_0x1a136c;}),_0x235a05[_0x5a36dd(0x12a)]((_0xb79a74,_0x5c7f23)=>{var _0x48d908=_0x5a36dd;_0x5af1a3[_0x5c7f23][_0x48d908(0x20a)]=_0xb79a74;}),_0x44bf73[_0x5a36dd(0x12a)]((_0x1d0a81,_0x5c13dd)=>{var _0x522d4f=_0x5a36dd;_0x5af1a3[_0x5c13dd][_0x522d4f(0x1f7)]=_0x1d0a81;}),_0x58bada[_0x5a36dd(0x12a)]((_0x1d061f,_0x1198c7)=>{var _0x427bed=_0x5a36dd;_0x5af1a3[_0x1198c7][_0x427bed(0x112)]=_0x1d061f;}),_0x5d8a48[_0x5a36dd(0x12a)]((_0x3fc93e,_0x41ad8d)=>{_0x5af1a3[_0x41ad8d]['maxperunit']=_0x3fc93e;}),_0x5e490e['forEach']((_0x1e5c67,_0x4b04b5)=>{var _0x6acf3f=_0x5a36dd;_0x5af1a3[_0x4b04b5][_0x6acf3f(0x242)]=_0x1e5c67;}),_0x1d7ad6['forEach']((_0x2261a3,_0x2525de)=>{_0x5af1a3[_0x2525de]['room_name']=_0x2261a3;}),_0xa491e5['forEach']((_0xdaa821,_0x2fa446)=>{var _0x1813f9=_0x5a36dd;_0x5af1a3[_0x2fa446][_0x1813f9(0x18e)]=_0xdaa821;});const _0x515095=new purchases_logs();await _0x515095['save']();for(let _0x23bafb=0x0;_0x23bafb<=_0x1d7ad6['length']-0x1;_0x23bafb++){_0x5af1a3[_0x23bafb]['invoice']=_0x5a36dd(0x10b)+_0x515095[_0x5a36dd(0x1ee)][_0x5a36dd(0x243)]()[_0x5a36dd(0x23a)](0x8,'0');}const _0x20aa88=_0x5af1a3[_0x5a36dd(0x1f8)](_0x14ffd1=>_0x14ffd1[_0x5a36dd(0x193)]!=='0'&&_0x14ffd1[_0x5a36dd(0x193)]!==''),_0x37e505=new purchases_finished({'invoice':_0x5a36dd(0x10b)+_0x515095[_0x5a36dd(0x1ee)][_0x5a36dd(0x243)]()['padStart'](0x8,'0'),'suppliers':_0x3cf8e6,'date':_0x1b9aaa,'warehouse_name':_0x2e4a87,'product':_0x20aa88,'note':_0x3251af,'due_amount':_0x4cbf6e,'room':_0x3778ba,'POnumber':_0x5474f8,'SCRN':_0x43de58,'JO_number':_0xdef7e9,'ReqBy':_0x425dd7,'dateofreq':_0xe2bd9c,'typeservicesData':_0x55e848,'van':_0x4f8de9,'typevehicle':_0x1606d8,'driver':_0x38f250,'plate':_0x378d92,'DRSI':_0x5c89bf,'TSU':_0x38d1bd,'TFU':_0x434ea0,'typeOfProducts':_0x2d3628}),_0x58dcb7=await _0x37e505[_0x5a36dd(0x1f3)](),_0xfc8140=await purchases_finished[_0x5a36dd(0x1ef)]({'_id':_0x58dcb7[_0x5a36dd(0x115)]['valueOf']()}),_0x342769=_0xfc8140[_0x5a36dd(0x21f)][_0x5a36dd(0x15a)](async _0x419b27=>{var _0xca2df1=_0x5a36dd;try{var _0x167c8f=await warehouse[_0xca2df1(0x1ef)]({'name':_0x2e4a87,'room':_0x419b27[_0xca2df1(0x133)]}),_0x2020d6=0x0;const _0x11489c=_0x167c8f[_0xca2df1(0x17c)][_0xca2df1(0x15a)](_0x536978=>{var _0x30411e=_0xca2df1;console[_0x30411e(0x127)](_0x536978[_0x30411e(0x15b)]+'=='+_0x419b27[_0x30411e(0x15b)]+'&&'+_0x536978[_0x30411e(0x1e8)]+'=='+_0x419b27[_0x30411e(0x1e8)]+'&&'+_0x536978['expiry_date']+'=='+_0x419b27[_0x30411e(0x1f7)]+'&&'+_0x536978[_0x30411e(0x112)]+'=='+_0x419b27['production_date']+'&&'+_0x536978['batch_code']+'=='+_0x419b27[_0x30411e(0x20a)]+'&&'+_0x536978[_0x30411e(0x1b9)]+'=='+_0xfc8140['invoice']),_0x536978[_0x30411e(0x15b)]==_0x419b27[_0x30411e(0x15b)]&&_0x536978[_0x30411e(0x1e8)]==_0x419b27['bay']&&_0x536978['level']==_0x419b27['level']&&_0x536978[_0x30411e(0x1f7)]==_0x419b27[_0x30411e(0x1f7)]&&_0x536978[_0x30411e(0x112)]==_0x419b27['production_date']&&_0x536978['batch_code']==_0x419b27['batch_code']&&_0x536978[_0x30411e(0x1b9)]==_0xfc8140['invoice']&&(_0x536978[_0x30411e(0x22d)]=Math[_0x30411e(0x216)](_0x536978[_0x30411e(0x22d)])+Math[_0x30411e(0x216)](_0x419b27[_0x30411e(0x193)]),_0x2020d6++);});return _0x2020d6==0x0&&(_0x167c8f['product_details']=_0x167c8f['product_details'][_0xca2df1(0x151)]({'product_name':_0x419b27['product_name'],'product_stock':Math['abs'](_0x419b27[_0xca2df1(0x193)]),'primary_code':_0x419b27[_0xca2df1(0x142)],'secondary_code':_0x419b27[_0xca2df1(0x1bc)],'product_code':_0x419b27[_0xca2df1(0x11c)],'bay':_0x419b27[_0xca2df1(0x1e8)],'level':_0x419b27[_0xca2df1(0x23c)],'maxProducts':_0x419b27[_0xca2df1(0x20d)],'unit':_0x419b27['standard_unit'],'secondary_unit':_0x419b27[_0xca2df1(0x10e)],'expiry_date':_0x419b27[_0xca2df1(0x1f7)],'production_date':_0x419b27[_0xca2df1(0x112)],'maxProducts':_0x419b27[_0xca2df1(0x20d)],'maxPerUnit':_0x419b27['maxperunit'],'batch_code':_0x419b27['batch_code'],'product_cat':_0x419b27[_0xca2df1(0x242)],'invoice':_0x419b27[_0xca2df1(0x1b9)],'id_incoming':_0x419b27[_0xca2df1(0x115)],'uuid':_0x419b27['uuid'],'gross_price':_0x419b27[_0xca2df1(0x18e)],'sales_category':_0x419b27[_0xca2df1(0x22c)],'type_products':_0x419b27[_0xca2df1(0x229)]})),_0x167c8f;}catch(_0x13c451){return console['error']('Error\x20occurred\x20while\x20processing\x20product:',_0x13c451),null;}});Promise['all'](_0x342769)[_0x5a36dd(0x18d)](async _0xc26fb5=>{var _0x6f898c=_0x5a36dd;try{for(const _0x597af6 of _0xc26fb5){await warehouse[_0x6f898c(0x1aa)]({'_id':_0x597af6[_0x6f898c(0x115)]},{'$addToSet':{'product_details':{'$each':_0x597af6[_0x6f898c(0x17c)]}}});}const _0x528494=await master_shop['find'](),_0x3f4e3d=await email_settings[_0x6f898c(0x1ef)](),_0x16ce5b=await supervisor_settings[_0x6f898c(0x13b)]();var _0x4c3396=_0xfc8140['product'],_0x1e950b='',_0x2f5325;for(_0x2f5325 in _0x4c3396){var _0x3a06a7='FG';_0xfc8140[_0x6f898c(0x185)]==_0x6f898c(0x23b)&&(_0x3a06a7='DG'),_0x1e950b+=_0x6f898c(0x199)+_0x6f898c(0x174)+_0x4c3396[_0x2f5325]['product_name']+_0x6f898c(0x158)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c3396[_0x2f5325][_0x6f898c(0x11c)]+_0x6f898c(0x158)+_0x6f898c(0x174)+_0x4c3396[_0x2f5325][_0x6f898c(0x193)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c3396[_0x2f5325][_0x6f898c(0x220)]+_0x6f898c(0x158)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c3396[_0x2f5325][_0x6f898c(0x10e)]+_0x6f898c(0x158)+_0x6f898c(0x174)+_0xfc8140[_0x6f898c(0x185)]+_0x6f898c(0x158)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c3396[_0x2f5325][_0x6f898c(0x133)]+_0x6f898c(0x158)+_0x6f898c(0x174)+_0x3a06a7+_0x4c3396[_0x2f5325][_0x6f898c(0x1e8)]+'</td>',_0x6f898c(0x14a);}let _0x1f2b21=nodemailer[_0x6f898c(0x102)]({'host':_0x3f4e3d[_0x6f898c(0x238)],'port':Number(_0x3f4e3d[_0x6f898c(0x215)]),'secure':![],'auth':{'user':_0x3f4e3d['email'],'pass':_0x3f4e3d['password']}}),_0x385453={'from':_0x3f4e3d[_0x6f898c(0x107)],'to':_0x16ce5b[0x0][_0x6f898c(0x206)],'subject':_0x6f898c(0x167),'attachments':[{'filename':'Logo.png','path':__dirname+_0x6f898c(0x156)+_0x6f898c(0x136)+_0x528494[0x0][_0x6f898c(0x1fc)],'cid':_0x6f898c(0x203)}],'html':'<!DOCTYPE\x20html>'+_0x6f898c(0x1e6)+_0x6f898c(0x1be)+'<div>'+_0x6f898c(0x163)+_0x6f898c(0x106)+_0x6f898c(0x23d)+_0x6f898c(0x14e)+'<div>'+'<h2>\x20'+_0x528494[0x0][_0x6f898c(0x14f)]+'\x20</h2>'+_0x6f898c(0x14e)+_0x6f898c(0x14e)+_0x6f898c(0x19e)+_0x6f898c(0x106)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x6f898c(0x226)+_0xfc8140[_0x6f898c(0x1b9)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0xfc8140[_0x6f898c(0x181)]+'\x20'+_0x6f898c(0x1ad)+_0x6f898c(0x1cb)+'</div>'+_0x6f898c(0x180)+_0x6f898c(0x184)+'<tr>'+_0x6f898c(0x219)+_0x6f898c(0x111)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x6f898c(0x1b1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x6f898c(0x11b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x6f898c(0x14a)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1e950b+'\x20'+_0x6f898c(0x235)+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x528494[0x0][_0x6f898c(0x14f)]+_0x6f898c(0x1cb)+_0x6f898c(0x14e)+_0x6f898c(0x14e)+'</body></html>'};_0x1f2b21[_0x6f898c(0x160)](_0x385453,function(_0x38e1cd,_0x583128){var _0x359411=_0x6f898c;_0x38e1cd?(console[_0x359411(0x127)](_0x38e1cd),console[_0x359411(0x127)]('Error\x20Occurs')):console[_0x359411(0x127)]('Email\x20sent\x20successfully');});}catch(_0xf2a956){console['error'](_0xf2a956),_0x105bc6[_0x6f898c(0x214)](0x1f4)[_0x6f898c(0x192)]({'error':_0x6f898c(0x12d),'message':_0xf2a956[_0x6f898c(0x13f)]});}})[_0x5a36dd(0x1de)](_0x749381=>{console['error'](_0x749381);}),_0x24c5f7[_0x5a36dd(0x230)](_0x5a36dd(0x1c8),_0x5a36dd(0x1b2)),_0x105bc6['redirect'](_0x5a36dd(0x1ec)+_0xfc8140[_0x5a36dd(0x115)]['valueOf']());}catch(_0x463658){console[_0x5a36dd(0x127)](_0x463658);}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x125),auth,async(_0x27c5fd,_0x4c197f)=>{var _0x4b7d2d=a0_0x431e3e;try{const {username:_0x5833c7,email:_0x1345b8,role:_0x29af22}=_0x27c5fd[_0x4b7d2d(0x239)],_0x25842c=_0x27c5fd[_0x4b7d2d(0x239)],_0x5bc7b2=await profile['findOne']({'email':_0x25842c['email']}),_0xc0c26d=await master_shop['find'](),_0x49a391=_0x27c5fd[_0x4b7d2d(0x22b)]['id'],_0x211070=await purchases_finished['findById'](_0x49a391),_0x4041a8=await suppliers[_0x4b7d2d(0x13b)]({});let _0x48120a;if(_0x25842c[_0x4b7d2d(0x1f4)]=='staff'){const _0x4550e7=await staff['findOne']({'email':_0x25842c[_0x4b7d2d(0x107)]});_0x48120a=await warehouse[_0x4b7d2d(0x13b)]({'status':_0x4b7d2d(0x1ab),'name':_0x4550e7[_0x4b7d2d(0x231)],'warehouse_category':_0x4b7d2d(0x16b)});}else _0x48120a=await warehouse[_0x4b7d2d(0x201)]([{'$match':{'status':'Enabled','warehouse_category':_0x4b7d2d(0x16b)}},{'$group':{'_id':_0x4b7d2d(0x1e7),'name':{'$first':_0x4b7d2d(0x1e7)}}}]);const _0x1af519=await product[_0x4b7d2d(0x13b)]({}),_0x59c2b7=BayBinSelected(_0x211070['warehouse_name'],_0x211070[_0x4b7d2d(0x237)]);let _0x307f86=new Date(_0x211070[_0x4b7d2d(0x1f7)]),_0x24ad37=('0'+_0x307f86[_0x4b7d2d(0x16f)]())[_0x4b7d2d(0x187)](-0x2),_0x33833=('0'+(_0x307f86[_0x4b7d2d(0x1b7)]()+0x1))[_0x4b7d2d(0x187)](-0x2),_0x994579=_0x307f86[_0x4b7d2d(0x1ac)](),_0x27f727=_0x994579+'-'+_0x33833+'-'+_0x24ad37;if(_0xc0c26d[0x0][_0x4b7d2d(0x122)]==_0x4b7d2d(0x1cf)){var _0xd04f0c=users[_0x4b7d2d(0x233)];console[_0x4b7d2d(0x127)](_0xd04f0c);}else{if(_0xc0c26d[0x0][_0x4b7d2d(0x122)]==_0x4b7d2d(0x1ce))var _0xd04f0c=users[_0x4b7d2d(0x1ce)];else{if(_0xc0c26d[0x0][_0x4b7d2d(0x122)]==_0x4b7d2d(0x247))var _0xd04f0c=users['German'];else{if(_0xc0c26d[0x0]['language']==_0x4b7d2d(0x224))var _0xd04f0c=users[_0x4b7d2d(0x224)];else{if(_0xc0c26d[0x0]['language']==_0x4b7d2d(0x209))var _0xd04f0c=users[_0x4b7d2d(0x209)];else{if(_0xc0c26d[0x0][_0x4b7d2d(0x122)]==_0x4b7d2d(0x166))var _0xd04f0c=users[_0x4b7d2d(0x1a6)];else{if(_0xc0c26d[0x0][_0x4b7d2d(0x122)]==_0x4b7d2d(0x117))var _0xd04f0c=users[_0x4b7d2d(0x117)];else{if(_0xc0c26d[0x0]['language']==_0x4b7d2d(0x186))var _0xd04f0c=users[_0x4b7d2d(0x1a9)];}}}}}}}_0x4c197f[_0x4b7d2d(0x116)]('edit_purchases_finished_view',{'success':_0x27c5fd['flash'](_0x4b7d2d(0x1c8)),'errors':_0x27c5fd['flash'](_0x4b7d2d(0x1ed)),'role':_0x25842c,'profile':_0x5bc7b2,'purchases':_0x211070,'suppliers':_0x4041a8,'warehouse':_0x48120a,'product':_0x1af519,'master_shop':_0xc0c26d,'language':_0xd04f0c,'ed_fullDate':_0x27f727,'dataSelected':_0x59c2b7});}catch(_0x976f62){console[_0x4b7d2d(0x127)](_0x976f62);}}),router['get']('/view/:id',auth,async(_0x42eb61,_0x7892b9)=>{var _0xa94346=a0_0x431e3e;try{const {username:_0x41d6b4,email:_0x32562f,role:_0xd83f6c}=_0x42eb61[_0xa94346(0x239)],_0x21e600=_0x42eb61[_0xa94346(0x239)],_0x1584a9=await profile[_0xa94346(0x1ef)]({'email':_0x21e600[_0xa94346(0x107)]}),_0x49cacd=await master_shop[_0xa94346(0x13b)](),_0x1ffb80=_0x42eb61[_0xa94346(0x22b)]['id'],_0x3ca19b=await purchases_finished[_0xa94346(0x1f5)](_0x1ffb80),_0x32d785=await suppliers[_0xa94346(0x13b)]({});let _0x2d38a4;if(_0x21e600[_0xa94346(0x1f4)]==_0xa94346(0x1f1)){const _0x567fba=await staff[_0xa94346(0x1ef)]({'email':_0x21e600[_0xa94346(0x107)]});_0x2d38a4=await warehouse['find']({'status':_0xa94346(0x1ab),'name':_0x567fba[_0xa94346(0x231)],'warehouse_category':_0xa94346(0x16b)});}else _0x2d38a4=await warehouse[_0xa94346(0x201)]([{'$match':{'status':_0xa94346(0x1ab),'warehouse_category':_0xa94346(0x16b)}},{'$group':{'_id':_0xa94346(0x1e7),'name':{'$first':_0xa94346(0x1e7)}}}]);const _0x5b88af=await product[_0xa94346(0x13b)]({}),_0x4477eb=BayBinSelected(_0x3ca19b[_0xa94346(0x185)],_0x3ca19b['room']);let _0x53107e=new Date(_0x3ca19b[_0xa94346(0x1f7)]),_0x3fd4af=('0'+_0x53107e[_0xa94346(0x16f)]())['slice'](-0x2),_0x309277=('0'+(_0x53107e[_0xa94346(0x1b7)]()+0x1))['slice'](-0x2),_0x5fac9f=_0x53107e[_0xa94346(0x1ac)](),_0x5aaa78=_0x5fac9f+'-'+_0x309277+'-'+_0x3fd4af;if(_0x49cacd[0x0][_0xa94346(0x122)]==_0xa94346(0x1cf)){var _0x27f794=users['English'];console[_0xa94346(0x127)](_0x27f794);}else{if(_0x49cacd[0x0][_0xa94346(0x122)]==_0xa94346(0x1ce))var _0x27f794=users[_0xa94346(0x1ce)];else{if(_0x49cacd[0x0][_0xa94346(0x122)]==_0xa94346(0x247))var _0x27f794=users[_0xa94346(0x247)];else{if(_0x49cacd[0x0][_0xa94346(0x122)]=='Spanish')var _0x27f794=users['Spanish'];else{if(_0x49cacd[0x0]['language']=='French')var _0x27f794=users[_0xa94346(0x209)];else{if(_0x49cacd[0x0][_0xa94346(0x122)]==_0xa94346(0x166))var _0x27f794=users[_0xa94346(0x1a6)];else{if(_0x49cacd[0x0][_0xa94346(0x122)]==_0xa94346(0x117))var _0x27f794=users[_0xa94346(0x117)];else{if(_0x49cacd[0x0][_0xa94346(0x122)]==_0xa94346(0x186))var _0x27f794=users[_0xa94346(0x1a9)];}}}}}}}_0x7892b9[_0xa94346(0x116)](_0xa94346(0x232),{'success':_0x42eb61[_0xa94346(0x230)]('success'),'errors':_0x42eb61['flash']('errors'),'role':_0x21e600,'profile':_0x1584a9,'purchases':_0x3ca19b,'suppliers':_0x32d785,'warehouse':_0x2d38a4,'product':_0x5b88af,'master_shop':_0x49cacd,'language':_0x27f794,'ed_fullDate':_0x5aaa78,'dataSelected':_0x4477eb});}catch(_0x4279f8){console[_0xa94346(0x127)](_0x4279f8);}}),router[a0_0x431e3e(0x15c)](a0_0x431e3e(0x24b),auth,async(_0x2e1878,_0x6f1b77)=>{var _0x385f28=a0_0x431e3e;try{const _0x1f6cb9=_0x2e1878['params']['id'],_0x103970=await purchases_finished[_0x385f28(0x1ef)]({'_id':_0x2e1878[_0x385f28(0x22b)]['id']}),_0xbe2244=await warehouse['findOne']({'name':_0x103970[_0x385f28(0x185)],'room':_0x103970[_0x385f28(0x237)]});_0x103970[_0x385f28(0x21f)]['forEach'](_0x457b19=>{var _0x11a475=_0x385f28;const _0x22b3ec=_0xbe2244[_0x11a475(0x17c)]['map'](_0x421237=>{var _0x31fe94=_0x11a475;_0x421237[_0x31fe94(0x15b)]==_0x457b19['product_name']&&_0x421237['bay']==_0x457b19[_0x31fe94(0x1e8)]&&(_0x421237[_0x31fe94(0x22d)]=parseInt(_0x421237[_0x31fe94(0x22d)])-parseInt(_0x457b19['quantity']));});}),await _0xbe2244[_0x385f28(0x1f3)]();const {invoice:_0x119f12,suppliers:_0x5ae89b,date:_0x23368d,warehouse_name:_0x328eca,prod_name:_0xcf6fd2,prod_code:_0xa0ee0d,prod_qty:_0x295ab7,prod_unit:_0x3796cc,prod_secondunit:_0x50d575,prod_level:_0x904ba8,prod_isle:_0x4262ef,prod_pallet:_0x590d8c,note:_0xf29098,expiry_date:_0x4bc7b7,batch_code:_0x57a019,paid_amount:_0x1dc8fc,due_amount:_0x4c0351,Room_name:_0x5db189,primary_code:_0x24718a,secondary_code:_0x4f0818,PO_number:_0x2c8d9e,JO_number:_0x4c228d}=_0x2e1878[_0x385f28(0x178)];if(typeof _0xcf6fd2==_0x385f28(0x202))var _0x19c5c5=[_0x2e1878['body'][_0x385f28(0x161)]],_0x108d28=[_0x2e1878[_0x385f28(0x178)][_0x385f28(0x144)]],_0x3b447f=[_0x2e1878[_0x385f28(0x178)][_0x385f28(0x20c)]],_0x2ec0a3=[_0x2e1878[_0x385f28(0x178)]['prod_unit']],_0x5d90f6=[_0x2e1878[_0x385f28(0x178)][_0x385f28(0x21d)]],_0xa93075=[_0x2e1878['body']['prod_level']],_0x18abb9=[_0x2e1878[_0x385f28(0x178)][_0x385f28(0x142)]],_0x248c8f=[_0x2e1878['body'][_0x385f28(0x1bc)]],_0x4187b5=[_0x2e1878[_0x385f28(0x178)][_0x385f28(0x17f)]],_0x67614f=[_0x2e1878[_0x385f28(0x178)]['batch_code']],_0x324040=[_0x2e1878[_0x385f28(0x178)][_0x385f28(0x1f7)]];else var _0x19c5c5=[..._0x2e1878[_0x385f28(0x178)]['prod_name']],_0x108d28=[..._0x2e1878[_0x385f28(0x178)][_0x385f28(0x144)]],_0x3b447f=[..._0x2e1878[_0x385f28(0x178)][_0x385f28(0x20c)]],_0x2ec0a3=[..._0x2e1878[_0x385f28(0x178)]['prod_unit']],_0x5d90f6=[..._0x2e1878[_0x385f28(0x178)]['prod_secondunit']],_0xa93075=[..._0x2e1878['body']['prod_level']],_0x18abb9=[..._0x2e1878[_0x385f28(0x178)][_0x385f28(0x142)]],_0x248c8f=[..._0x2e1878['body'][_0x385f28(0x1bc)]],_0x4187b5=[..._0x2e1878[_0x385f28(0x178)]['MaxStocks_data']],_0x67614f=[..._0x2e1878['body'][_0x385f28(0x20a)]],_0x324040=[..._0x2e1878['body'][_0x385f28(0x1f7)]];const _0x388b50=_0x19c5c5['map'](_0x27bac8=>{return _0x27bac8={'product_name':_0x27bac8};});_0x108d28[_0x385f28(0x12a)]((_0xbd80e8,_0x35c99b)=>{var _0x3d64c5=_0x385f28;_0x388b50[_0x35c99b][_0x3d64c5(0x11c)]=_0xbd80e8;}),_0x3b447f[_0x385f28(0x12a)]((_0x2672a7,_0x1f935a)=>{var _0x55a06b=_0x385f28;_0x388b50[_0x1f935a][_0x55a06b(0x193)]=_0x2672a7;}),_0x2ec0a3['forEach']((_0x36e42a,_0x31904f)=>{_0x388b50[_0x31904f]['standard_unit']=_0x36e42a;}),_0x5d90f6['forEach']((_0x3c1f06,_0x34cfcf)=>{_0x388b50[_0x34cfcf]['secondary_unit']=_0x3c1f06;}),_0xa93075['forEach']((_0x4a9a9f,_0x550045)=>{_0x388b50[_0x550045]['bay']=_0x4a9a9f;}),_0x18abb9[_0x385f28(0x12a)]((_0x5acaba,_0x3a60b8)=>{var _0x420392=_0x385f28;_0x388b50[_0x3a60b8][_0x420392(0x142)]=_0x5acaba;}),_0x248c8f['forEach']((_0x226431,_0x50b6c6)=>{var _0x21ea5f=_0x385f28;_0x388b50[_0x50b6c6][_0x21ea5f(0x1bc)]=_0x226431;}),_0x4187b5[_0x385f28(0x12a)]((_0x2677ea,_0x157287)=>{_0x388b50[_0x157287]['maxStocks']=_0x2677ea;}),_0x67614f['forEach']((_0x42bf37,_0x2d51ba)=>{var _0x37b11f=_0x385f28;_0x388b50[_0x2d51ba][_0x37b11f(0x20a)]=_0x42bf37;}),_0x324040['forEach']((_0x24ecb9,_0x5cfb34)=>{var _0x18a14e=_0x385f28;_0x388b50[_0x5cfb34][_0x18a14e(0x1f7)]=_0x24ecb9;});const _0x1a9263=_0x388b50[_0x385f28(0x1f8)](_0x42d47a=>_0x42d47a[_0x385f28(0x193)]!=='0'&&_0x42d47a[_0x385f28(0x193)]!=='');_0x103970[_0x385f28(0x1b9)]=_0x119f12,_0x103970[_0x385f28(0x1da)]=_0x5ae89b,_0x103970[_0x385f28(0x181)]=_0x23368d,_0x103970['warehouse_name']=_0x328eca,_0x103970['product']=_0x1a9263,_0x103970[_0x385f28(0x139)]=_0xf29098,_0x103970[_0x385f28(0x1e5)]=_0x1dc8fc,_0x103970[_0x385f28(0x1b4)]=_0x4c0351,_0x103970['room']=_0x5db189,_0x103970[_0x385f28(0x152)]=_0x2c8d9e,_0x103970[_0x385f28(0x246)]=_0x4c228d;const _0xaa6f45=await _0x103970[_0x385f28(0x1f3)](),_0x4a1266=await warehouse['findOne']({'name':_0x2e1878[_0x385f28(0x178)][_0x385f28(0x185)],'room':_0x2e1878[_0x385f28(0x178)][_0x385f28(0x1e0)]});_0x103970[_0x385f28(0x21f)][_0x385f28(0x12a)](_0x15fb52=>{var _0x5dbe5e=_0x385f28,_0x1e1a50=0x0;const _0x263ab7=_0x4a1266[_0x5dbe5e(0x17c)]['map'](_0x56ca5a=>{var _0x52aa64=_0x5dbe5e;_0x56ca5a[_0x52aa64(0x15b)]==_0x15fb52[_0x52aa64(0x15b)]&&_0x56ca5a[_0x52aa64(0x1e8)]==_0x15fb52[_0x52aa64(0x1e8)]&&(_0x56ca5a['product_stock']=parseInt(_0x56ca5a[_0x52aa64(0x22d)])+parseInt(_0x15fb52[_0x52aa64(0x193)]),_0x1e1a50++);});_0x1e1a50=='0'&&(_0x4a1266['product_details']=_0x4a1266['product_details'][_0x5dbe5e(0x151)]({'product_name':_0x15fb52[_0x5dbe5e(0x15b)],'product_stock':_0x15fb52[_0x5dbe5e(0x193)],'primary_code':_0x15fb52[_0x5dbe5e(0x142)],'secondary_code':_0x15fb52[_0x5dbe5e(0x1bc)],'product_code':_0x15fb52[_0x5dbe5e(0x11c)],'bay':_0x15fb52[_0x5dbe5e(0x1e8)],'maxProducts':_0x15fb52[_0x5dbe5e(0x20d)],'unit':_0x15fb52[_0x5dbe5e(0x220)],'secondary_unit':_0x15fb52[_0x5dbe5e(0x10e)],'expiry_date':_0x15fb52[_0x5dbe5e(0x1f7)]}));}),await _0x4a1266[_0x385f28(0x1f3)]();const _0x3af4e4=await s_payment_data['findOne']({'invoice':_0x2e1878['body'][_0x385f28(0x1b9)]});if(_0x3af4e4===null){}else console[_0x385f28(0x127)](_0x385f28(0x1da),_0x3af4e4,_0x2e1878[_0x385f28(0x178)][_0x385f28(0x1b9)]),_0x3af4e4[_0x385f28(0x1da)]=_0x2e1878['body'][_0x385f28(0x1da)],await _0x3af4e4['save']();_0x2e1878[_0x385f28(0x230)](_0x385f28(0x1c8),_0x385f28(0x137)),_0x6f1b77[_0x385f28(0x20b)](_0x385f28(0x1c1));}catch(_0x3cff6c){console[_0x385f28(0x127)](_0x3cff6c);}}),router[a0_0x431e3e(0x15c)](a0_0x431e3e(0x19b),auth,async(_0x24310f,_0x44d87f)=>{var _0x527985=a0_0x431e3e;try{const _0xc67f1c=_0x24310f[_0x527985(0x22b)]['id'],{invoice:_0x32d10d,suppliers:_0x27543c,payable:_0x1acefa,due_amount:_0x403fe0}=_0x24310f[_0x527985(0x178)],_0x5a4628=await purchases[_0x527985(0x1f5)](_0xc67f1c);var _0x47d75b=_0x1acefa-_0x403fe0;_0x5a4628[_0x527985(0x1e5)]=parseFloat(_0x5a4628['paid_amount'])+parseFloat(_0x403fe0),_0x5a4628['due_amount']=_0x47d75b;const _0x3cb42c=await _0x5a4628[_0x527985(0x1f3)]();console[_0x527985(0x127)](_0x3cb42c);const _0x183e33=await s_payment_data['findOne']({'invoice':_0x32d10d});_0x183e33[_0x527985(0x11d)]=_0x47d75b,await _0x183e33[_0x527985(0x1f3)]();let _0x3e5b52=new Date(),_0x5836d5=('0'+_0x3e5b52['getDate']())[_0x527985(0x187)](-0x2),_0x4ea687=('0'+(_0x3e5b52['getMonth']()+0x1))['slice'](-0x2),_0x52e39e=_0x3e5b52['getFullYear'](),_0x1f40e0=_0x52e39e+'-'+_0x4ea687+'-'+_0x5836d5;const _0x261238=new suppliers_payment({'invoice':_0x32d10d,'date':_0x52e39e+'-'+_0x4ea687+'-'+_0x5836d5,'suppliers':_0x27543c,'reason':_0x527985(0x15e),'amount':_0x403fe0}),_0x1e56e1=await _0x261238[_0x527985(0x1f3)]();_0x24310f[_0x527985(0x230)](_0x527985(0x1c8),_0x527985(0x21a)),_0x44d87f[_0x527985(0x20b)](_0x527985(0x109));}catch(_0x892786){console[_0x527985(0x127)](_0x892786);}}),router[a0_0x431e3e(0x103)]('/invoice/:id',auth,async(_0x56a2c0,_0x5c8c63)=>{var _0x243402=a0_0x431e3e;try{const {username:_0x5f00f6,email:_0x28a3cb,role:_0x2abbc6}=_0x56a2c0[_0x243402(0x239)],_0x550905=_0x56a2c0[_0x243402(0x239)],_0x2b3ad3=await profile[_0x243402(0x1ef)]({'email':_0x550905[_0x243402(0x107)]}),_0x374f3d=await master_shop[_0x243402(0x13b)]();console['log'](_0x243402(0x165),_0x374f3d);const _0x140079=_0x56a2c0['params']['id'],_0x45430c=await purchases[_0x243402(0x1f5)](_0x140079);console[_0x243402(0x127)](_0x45430c);const _0x979849=await suppliers['findOne']({'name':_0x45430c[_0x243402(0x1da)]});console[_0x243402(0x127)](_0x979849);if(_0x374f3d[0x0][_0x243402(0x122)]=='English\x20(US)'){var _0x46ab06=users[_0x243402(0x233)];console[_0x243402(0x127)](_0x46ab06);}else{if(_0x374f3d[0x0][_0x243402(0x122)]==_0x243402(0x1ce))var _0x46ab06=users[_0x243402(0x1ce)];else{if(_0x374f3d[0x0][_0x243402(0x122)]==_0x243402(0x247))var _0x46ab06=users[_0x243402(0x247)];else{if(_0x374f3d[0x0]['language']==_0x243402(0x224))var _0x46ab06=users[_0x243402(0x224)];else{if(_0x374f3d[0x0][_0x243402(0x122)]==_0x243402(0x209))var _0x46ab06=users[_0x243402(0x209)];else{if(_0x374f3d[0x0]['language']==_0x243402(0x166))var _0x46ab06=users[_0x243402(0x1a6)];else{if(_0x374f3d[0x0]['language']==_0x243402(0x117))var _0x46ab06=users['Chinese'];else{if(_0x374f3d[0x0]['language']==_0x243402(0x186))var _0x46ab06=users[_0x243402(0x1a9)];}}}}}}}_0x5c8c63[_0x243402(0x116)]('purchase_invoice',{'success':_0x56a2c0[_0x243402(0x230)](_0x243402(0x1c8)),'errors':_0x56a2c0[_0x243402(0x230)](_0x243402(0x1ed)),'role':_0x550905,'profile':_0x2b3ad3,'master_shop':_0x374f3d,'supplier':_0x979849,'purchase':_0x45430c,'language':_0x46ab06});}catch(_0x5e3b10){console[_0x243402(0x127)](_0x5e3b10);}}),router[a0_0x431e3e(0x103)](a0_0x431e3e(0x114),auth,async(_0x473776,_0x95490e)=>{var _0x176694=a0_0x431e3e;try{const {username:_0x29beff,email:_0x521d22,role:_0xf3cd2d}=_0x473776[_0x176694(0x239)],_0x25e47c=_0x473776['user'],_0x315080=await profile[_0x176694(0x1ef)]({'email':_0x25e47c[_0x176694(0x107)]}),_0x1757f2=await master_shop[_0x176694(0x13b)]();console[_0x176694(0x127)](_0x176694(0x165),_0x1757f2);const _0x48d376=_0x473776[_0x176694(0x22b)]['id'];console[_0x176694(0x127)](_0x48d376);const _0x3ccb3b=await purchases_finished[_0x176694(0x1f5)](_0x48d376);console['log']('user_id',_0x3ccb3b);const _0x271b10=await product[_0x176694(0x13b)]({}),_0x3224c2=await warehouse[_0x176694(0x201)]([{'$match':{'name':_0x3ccb3b[_0x176694(0x185)],'room':_0x3ccb3b[_0x176694(0x237)]}},{'$unwind':_0x176694(0x170)},{'$group':{'_id':_0x176694(0x10a),'name':{'$first':_0x176694(0x18a)},'product_stock':{'$first':_0x176694(0x21c)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x176694(0x134)},'type':{'$first':_0x176694(0x13e)},'floorlevel':{'$first':_0x176694(0x12f)},'primary_code':{'$first':_0x176694(0x143)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x176694(0x1c3)},'storage':{'$first':_0x176694(0x1fa)},'rack':{'$first':'$product_details.rack'}}}]);console['log'](_0x176694(0x1b5),_0x3224c2);let _0x2234ec;if(_0x25e47c[_0x176694(0x1f4)]==_0x176694(0x1f1)){const _0x19aaf3=await staff[_0x176694(0x1ef)]({'email':_0x25e47c['email']});_0x2234ec=await warehouse['find']({'status':_0x176694(0x1ab),'name':_0x19aaf3[_0x176694(0x231)],'warehouse_category':_0x176694(0x16b),'name':_0x176694(0x211)});}else _0x2234ec=await warehouse[_0x176694(0x201)]([{'$match':{'status':_0x176694(0x1ab),'warehouse_category':_0x176694(0x16b),'name':_0x176694(0x211)}},{'$group':{'_id':_0x176694(0x1e7),'name':{'$first':_0x176694(0x1e7)}}}]);if(_0x1757f2[0x0][_0x176694(0x122)]==_0x176694(0x1cf)){var _0x33b812=users[_0x176694(0x233)];console[_0x176694(0x127)](_0x33b812);}else{if(_0x1757f2[0x0][_0x176694(0x122)]==_0x176694(0x1ce))var _0x33b812=users['Hindi'];else{if(_0x1757f2[0x0][_0x176694(0x122)]=='German')var _0x33b812=users['German'];else{if(_0x1757f2[0x0][_0x176694(0x122)]==_0x176694(0x224))var _0x33b812=users['Spanish'];else{if(_0x1757f2[0x0][_0x176694(0x122)]==_0x176694(0x209))var _0x33b812=users[_0x176694(0x209)];else{if(_0x1757f2[0x0][_0x176694(0x122)]==_0x176694(0x166))var _0x33b812=users[_0x176694(0x1a6)];else{if(_0x1757f2[0x0][_0x176694(0x122)]=='Chinese')var _0x33b812=users[_0x176694(0x117)];else{if(_0x1757f2[0x0]['language']==_0x176694(0x186))var _0x33b812=users[_0x176694(0x1a9)];}}}}}}}_0x95490e['render'](_0x176694(0x101),{'success':_0x473776[_0x176694(0x230)](_0x176694(0x1c8)),'errors':_0x473776[_0x176694(0x230)](_0x176694(0x1ed)),'role':_0x25e47c,'profile':_0x315080,'user':_0x3ccb3b,'stock':_0x3224c2,'master_shop':_0x1757f2,'product':_0x271b10,'language':_0x33b812,'warehouse':_0x2234ec});}catch(_0x62f444){console[_0x176694(0x127)](_0x62f444);}}),router[a0_0x431e3e(0x15c)]('/view/return_purchase/:id',auth,async(_0x269ff2,_0x361d48)=>{var _0x291634=a0_0x431e3e;try{const {invoice:_0xa8b314,date:_0x1616bb,warehouse_name:_0x25d4ee,Room_name:_0x8d3ba6,product_name:_0x27fed6,purchase_quantity:_0x2f4091,stocks:_0x3bf862,return_qty:_0x1df758,note:_0x53d26b,level:_0xad320e,isle:_0x1b962d,pallet:_0x45314f,to_warehouse_name:_0x842b23,to_Room_name:_0x178615}=_0x269ff2[_0x291634(0x178)],_0x54e16e=await purchases_finished[_0x291634(0x1ef)]({'_id':_0x269ff2[_0x291634(0x22b)]['id']}),_0x119749=await warehouse[_0x291634(0x1ef)]({'name':_0x25d4ee,'room':_0x8d3ba6,'warehouse_category':'Finished\x20Goods'});if(typeof _0x27fed6==_0x291634(0x202))var _0x394e4b=[_0x269ff2['body'][_0x291634(0x15b)]],_0x4fdb07=[_0x269ff2[_0x291634(0x178)][_0x291634(0x14b)]],_0x891a7a=[_0x269ff2['body'][_0x291634(0x1b8)]],_0xea12bd=[_0x269ff2['body'][_0x291634(0x176)]],_0x242454=[_0x269ff2[_0x291634(0x178)][_0x291634(0x23c)]],_0x4e7ddb=[_0x269ff2[_0x291634(0x178)]['product_code_hide']],_0x34fd19=[_0x269ff2[_0x291634(0x178)][_0x291634(0x188)]],_0x53f301=[_0x269ff2[_0x291634(0x178)][_0x291634(0x1bb)]];else var _0x394e4b=[..._0x269ff2[_0x291634(0x178)][_0x291634(0x15b)]],_0x4fdb07=[..._0x269ff2[_0x291634(0x178)][_0x291634(0x14b)]],_0x891a7a=[..._0x269ff2[_0x291634(0x178)][_0x291634(0x1b8)]],_0xea12bd=[..._0x269ff2[_0x291634(0x178)][_0x291634(0x176)]],_0x242454=[..._0x269ff2[_0x291634(0x178)][_0x291634(0x23c)]],_0x4e7ddb=[..._0x269ff2['body'][_0x291634(0x1b3)]],_0x34fd19=[..._0x269ff2['body']['primary_code_hide']],_0x53f301=[..._0x269ff2[_0x291634(0x178)][_0x291634(0x1bb)]];const _0x188399=_0x394e4b['map'](_0x20d612=>{return _0x20d612={'product_name':_0x20d612};});_0x4fdb07['forEach']((_0x1a1cb0,_0x232607)=>{var _0x4002f9=_0x291634;_0x188399[_0x232607][_0x4002f9(0x14b)]=_0x1a1cb0;}),_0x891a7a[_0x291634(0x12a)]((_0xe969fd,_0x4d0a5c)=>{var _0x1b7349=_0x291634;_0x188399[_0x4d0a5c][_0x1b7349(0x1d4)]=_0xe969fd;}),_0xea12bd[_0x291634(0x12a)]((_0x5469d3,_0xd553a6)=>{_0x188399[_0xd553a6]['return_qty']=_0x5469d3;}),_0x242454['forEach']((_0x5672f2,_0x2b7ce7)=>{var _0x55bd58=_0x291634;_0x188399[_0x2b7ce7][_0x55bd58(0x1e8)]=_0x5672f2;}),_0x4e7ddb[_0x291634(0x12a)]((_0x245d9a,_0x25ff96)=>{_0x188399[_0x25ff96]['product_code']=_0x245d9a;}),_0x34fd19['forEach']((_0x50e1b1,_0xbec894)=>{var _0x389cc7=_0x291634;_0x188399[_0xbec894][_0x389cc7(0x142)]=_0x50e1b1;}),_0x53f301['forEach']((_0x36faee,_0x9d5ea4)=>{var _0x47bfac=_0x291634;_0x188399[_0x9d5ea4][_0x47bfac(0x1bc)]=_0x36faee;}),_0x188399[_0x291634(0x12a)](_0x8d7947=>{var _0x2f9049=_0x291634;console[_0x2f9049(0x127)](_0x8d7947);const _0x149892=_0x119749['product_details'][_0x2f9049(0x15a)](_0x4e4668=>{var _0x1ecc81=_0x2f9049;_0x4e4668[_0x1ecc81(0x15b)]==_0x8d7947[_0x1ecc81(0x15b)]&&_0x4e4668[_0x1ecc81(0x1e8)]==_0x8d7947['bay']&&(console[_0x1ecc81(0x127)](parseInt(_0x4e4668[_0x1ecc81(0x22d)])+'\x20<>\x20'+parseInt(_0x8d7947[_0x1ecc81(0x176)])),_0x4e4668[_0x1ecc81(0x22d)]=parseInt(_0x4e4668[_0x1ecc81(0x22d)])-parseInt(_0x8d7947[_0x1ecc81(0x176)]));});}),await _0x119749[_0x291634(0x1f3)]();var _0x215e9e=0x0;_0x188399[_0x291634(0x12a)](_0x183c59=>{var _0x23f98b=_0x291634;(parseInt(_0x183c59[_0x23f98b(0x14b)])<parseInt(_0x183c59['return_qty'])||parseInt(_0x183c59[_0x23f98b(0x1d4)])<parseInt(_0x183c59[_0x23f98b(0x176)]))&&_0x215e9e++;});if(_0x215e9e!=0x0)return _0x269ff2[_0x291634(0x230)](_0x291634(0x1ed),_0x291634(0x105)),_0x361d48[_0x291634(0x20b)](_0x291634(0x110));const _0x21b67c=new purchases_return_finished({'invoice':_0xa8b314,'suppliers':_0x269ff2['body']['suppliers'],'date':_0x1616bb,'warehouse_name':_0x25d4ee,'return_product':_0x188399,'note':_0x53d26b,'room':_0x8d3ba6,'to_warehouse_name':_0x842b23,'to_room':_0x178615}),_0x55749c=await _0x21b67c[_0x291634(0x1f3)](),_0x4f0cb7=await purchases_return_finished[_0x291634(0x1ef)]({'invoice':_0xa8b314}),_0x57d15b=await warehouse['findOne']({'name':_0x842b23,'room':_0x178615,'warehouse_category':'Finished\x20Goods'});_0x4f0cb7[_0x291634(0x138)][_0x291634(0x12a)](_0x26a8f=>{var _0x5941f1=_0x291634,_0x3c66c0=0x0;const _0x2076c5=_0x57d15b[_0x5941f1(0x17c)][_0x5941f1(0x15a)](_0x4895b1=>{var _0x239db2=_0x5941f1;console['log'](_0x4895b1[_0x239db2(0x15b)]+'=='+_0x26a8f[_0x239db2(0x15b)]+'&&'+_0x4895b1[_0x239db2(0x1e8)]+'=='+_0x26a8f['bay']),_0x4895b1['product_name']==_0x26a8f[_0x239db2(0x15b)]&&_0x4895b1['bay']==_0x26a8f[_0x239db2(0x1e8)]&&(_0x4895b1['product_stock']=parseInt(_0x4895b1['product_stock'])-parseInt(_0x26a8f[_0x239db2(0x176)]),_0x3c66c0++);});_0x3c66c0=='0'&&(_0x57d15b[_0x5941f1(0x17c)]=_0x57d15b['product_details']['concat']({'product_name':_0x26a8f['product_name'],'product_stock':_0x26a8f[_0x5941f1(0x176)],'primary_code':_0x26a8f['primary_code'],'secondary_code':_0x26a8f['secondary_code'],'product_code':_0x26a8f[_0x5941f1(0x11c)],'bay':_0x26a8f[_0x5941f1(0x1e8)],'maxProducts':0xf423f}));}),await _0x57d15b['save']();const _0x528f30=await purchases_finished[_0x291634(0x1ef)]({'invoice':_0xa8b314});_0x528f30['return_data']=_0x291634(0x221);const _0x459a30=await _0x528f30[_0x291634(0x1f3)](),_0x4d6c0b=new s_payment_data({'invoice':_0xa8b314,'suppliers':_0x269ff2[_0x291634(0x178)][_0x291634(0x1da)],'reason':_0x291634(0x191)});await _0x4d6c0b[_0x291634(0x1f3)]();const _0x49888f=await master_shop[_0x291634(0x13b)](),_0x455625=await email_settings[_0x291634(0x1ef)](),_0x36f261=await suppliers[_0x291634(0x1ef)]({'name':_0x269ff2[_0x291634(0x178)][_0x291634(0x1da)]});_0x49888f[0x0]['currency_placement']==0x1?(right_currency=_0x49888f[0x0][_0x291634(0x218)],left_currency=''):(right_currency='',left_currency=_0x49888f[0x0][_0x291634(0x218)]);var _0x364306=_0x394e4b,_0x40f532=_0xea12bd,_0x1d3c9a='',_0x2b080e;for(_0x2b080e in _0x364306){_0x1d3c9a+='<tr>'+_0x291634(0x174)+_0x364306[_0x2b080e]+_0x291634(0x158)+_0x291634(0x174)+_0x40f532[_0x2b080e]+_0x291634(0x158)+'</tr>';}let _0x280e2e=nodemailer[_0x291634(0x102)]({'service':_0x291634(0x175),'auth':{'user':_0x455625[_0x291634(0x107)],'pass':_0x455625[_0x291634(0x17b)]}}),_0x4afc74={'from':_0x455625[_0x291634(0x107)],'to':_0x36f261[_0x291634(0x107)],'subject':_0x291634(0x1fe),'attachments':[{'filename':_0x291634(0x168),'path':__dirname+'/../public'+'/upload/'+_0x49888f[0x0][_0x291634(0x1fc)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x291634(0x1e6)+'</head><body>'+'<div>'+_0x291634(0x163)+_0x291634(0x106)+_0x291634(0x23d)+_0x291634(0x14e)+_0x291634(0x106)+'<h2>\x20'+_0x49888f[0x0][_0x291634(0x14f)]+'\x20</h2>'+_0x291634(0x14e)+'</div>'+_0x291634(0x19e)+_0x291634(0x106)+_0x291634(0x135)+_0x291634(0x226)+_0xa8b314+'\x20'+_0x291634(0x236)+_0x291634(0x1e1)+_0x1616bb+'\x20'+_0x291634(0x1ad)+_0x291634(0x1cb)+'</div>'+_0x291634(0x180)+_0x291634(0x184)+_0x291634(0x199)+_0x291634(0x219)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x291634(0x121)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x291634(0x14a)+_0x291634(0x155)+_0x291634(0x124)+'\x20'+_0x1d3c9a+'\x20'+_0x291634(0x235)+_0x291634(0x22e)+'<div>'+_0x291634(0x169)+'<h5>'+_0x49888f[0x0][_0x291634(0x14f)]+_0x291634(0x1cb)+_0x291634(0x14e)+_0x291634(0x14e)+_0x291634(0x10c)};_0x280e2e[_0x291634(0x160)](_0x4afc74,function(_0x97a8f7,_0x170b5d){var _0x35bede=_0x291634;_0x97a8f7?console[_0x35bede(0x127)](_0x35bede(0x1dc)):console['log'](_0x35bede(0x128));}),_0x269ff2['flash'](_0x291634(0x1c8),_0x291634(0x1f6)),_0x361d48[_0x291634(0x20b)]('/all_purchases_finished/view');}catch(_0x5b6f8c){_0x361d48[_0x291634(0x214)](0xc8)[_0x291634(0x192)]({'message':_0x5b6f8c['message']});}}),router['get'](a0_0x431e3e(0x154),auth,async(_0x10632b,_0x483a94)=>{var _0x4266d9=a0_0x431e3e;try{const {username:_0x436250,email:_0x5bf02e,role:_0xea81f7}=_0x10632b['user'],_0x34e7b0=_0x10632b[_0x4266d9(0x239)],_0x873ec0=await profile[_0x4266d9(0x1ef)]({'email':_0x34e7b0[_0x4266d9(0x107)]}),_0xe4128c=await master_shop['find'](),_0x4d16c4=_0x10632b[_0x4266d9(0x22b)]['id'],_0x2986da=await purchases_finished[_0x4266d9(0x1f5)](_0x4d16c4);if(_0xe4128c[0x0][_0x4266d9(0x122)]==_0x4266d9(0x1cf))var _0xd19949=users[_0x4266d9(0x233)];else{if(_0xe4128c[0x0]['language']==_0x4266d9(0x1ce))var _0xd19949=users[_0x4266d9(0x1ce)];else{if(_0xe4128c[0x0][_0x4266d9(0x122)]==_0x4266d9(0x247))var _0xd19949=users[_0x4266d9(0x247)];else{if(_0xe4128c[0x0][_0x4266d9(0x122)]==_0x4266d9(0x224))var _0xd19949=users[_0x4266d9(0x224)];else{if(_0xe4128c[0x0][_0x4266d9(0x122)]=='French')var _0xd19949=users['French'];else{if(_0xe4128c[0x0]['language']=='Portuguese\x20(BR)')var _0xd19949=users[_0x4266d9(0x1a6)];else{if(_0xe4128c[0x0][_0x4266d9(0x122)]=='Chinese')var _0xd19949=users[_0x4266d9(0x117)];else{if(_0xe4128c[0x0]['language']==_0x4266d9(0x186))var _0xd19949=users['Arabic'];}}}}}}}_0x483a94[_0x4266d9(0x116)]('all_purchases_barcode',{'success':_0x10632b[_0x4266d9(0x230)](_0x4266d9(0x1c8)),'errors':_0x10632b[_0x4266d9(0x230)]('errors'),'role':_0x34e7b0,'profile':_0x873ec0,'alldata':_0x2986da,'master_shop':_0xe4128c,'language':_0xd19949}),console[_0x4266d9(0x127)](alldata);}catch(_0x4953dc){console[_0x4266d9(0x127)](_0x4953dc);}}),router[a0_0x431e3e(0x15c)](a0_0x431e3e(0x157),async(_0x46e4c3,_0x4a5e35)=>{var _0x3561cd=a0_0x431e3e;const {product_code:_0xecf3cb}=_0x46e4c3[_0x3561cd(0x178)];var _0x20786f;const _0x424c7d=await product[_0x3561cd(0x201)]([{'$match':{'primary_code':_0xecf3cb}},{'$group':{'_id':_0x3561cd(0x1bd),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x3561cd(0x1a3)},'alertquantity':{'$first':_0x3561cd(0x23f)},'product_code':{'$first':_0x3561cd(0x213)},'primary_code':{'$first':_0x3561cd(0x1f0)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3561cd(0x13d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3561cd(0x108)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x3561cd(0x113)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0xe12705=await product[_0x3561cd(0x201)]([{'$match':{'secondary_code':_0xecf3cb}},{'$group':{'_id':_0x3561cd(0x1bd),'name':{'$first':_0x3561cd(0x1e7)},'category':{'$first':_0x3561cd(0x22f)},'brand':{'$first':_0x3561cd(0x1a8)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x3561cd(0x23f)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3561cd(0x108)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x3561cd(0x113)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x424c7d[_0x3561cd(0x23e)]>0x0)_0x20786f=_0x424c7d;else _0xe12705[_0x3561cd(0x23e)]>0x0&&(_0x20786f=_0xe12705);_0x4a5e35[_0x3561cd(0x192)](_0x20786f);}),router[a0_0x431e3e(0x15c)]('/CheckingWarehouse',async(_0x19200d,_0x373858)=>{var _0x4eeecf=a0_0x431e3e;const {productCode:_0xc56471,bay:_0x23bfbe,warehouses:_0x358bef,room:_0x454169}=_0x19200d[_0x4eeecf(0x178)];console['log'](_0x19200d[_0x4eeecf(0x178)]);try{const _0x53e435=await warehouse['aggregate']([{'$match':{'name':_0x358bef,'room':_0x454169}},{'$unwind':_0x4eeecf(0x170)},{'$match':{'product_details.bay':parseInt(_0x23bfbe)}},{'$group':{'_id':_0x4eeecf(0x10a),'name':{'$first':_0x4eeecf(0x18a)},'product_stock':{'$first':_0x4eeecf(0x21c)},'bay':{'$first':_0x4eeecf(0x1d7)},'maxProducts':{'$first':_0x4eeecf(0x12c)}}}]);_0x373858[_0x4eeecf(0x214)](0xc8)['json'](_0x53e435);}catch(_0x8547b8){_0x373858['status'](0x194)[_0x4eeecf(0x192)]({'message':_0x8547b8[_0x4eeecf(0x13f)]});}}),router[a0_0x431e3e(0x15c)](a0_0x431e3e(0x1ff),async(_0x1a7996,_0x1a097)=>{var _0x211943=a0_0x431e3e;const {product_code:_0x3614d7}=_0x1a7996[_0x211943(0x178)];var _0x5d9327;const _0xef4a1e=await product[_0x211943(0x201)]([{'$match':{'primary_code':_0x3614d7,'type_products':_0x211943(0x127)}},{'$group':{'_id':_0x211943(0x1bd),'name':{'$first':'$name'},'category':{'$first':_0x211943(0x22f)},'brand':{'$first':_0x211943(0x1a8)},'unit':{'$first':_0x211943(0x1a3)},'alertquantity':{'$first':_0x211943(0x23f)},'product_code':{'$first':_0x211943(0x213)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x211943(0x1c2)},'maxProdPerUnit':{'$first':_0x211943(0x13d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x211943(0x1d3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0xef4a1e);const _0x372b4c=await product[_0x211943(0x201)]([{'$match':{'secondary_code':_0x3614d7,'type_products':'log'}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x211943(0x22f)},'brand':{'$first':_0x211943(0x1a8)},'unit':{'$first':_0x211943(0x1a3)},'alertquantity':{'$first':_0x211943(0x23f)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x211943(0x1f0)},'secondary_code':{'$first':_0x211943(0x131)},'maxStocks':{'$first':_0x211943(0x1c2)},'maxProdPerUnit':{'$first':_0x211943(0x13d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x211943(0x108)},'gross_price':{'$first':_0x211943(0x1c7)},'sales_category':{'$first':_0x211943(0x113)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0xef4a1e[_0x211943(0x23e)]>0x0)_0x5d9327=_0xef4a1e;else _0x372b4c['length']>0x0&&(_0x5d9327=_0x372b4c);_0x1a097[_0x211943(0x192)](_0x5d9327);}),module['exports']=router;function a0_0x355a(){var _0x370809=['$product_details.primary_code','prod_code','$return_data','sales_data_cateory','$expiry_date','Transfer\x20Finalize\x20Successfully','$due_amount','</tr>','purchase_quantity','$product.room_name','/view/add_purchases/:id','</div>','site_title','min','concat','POnumber','1090bVCtxH','/barcode/:id','</thead>','/../public','/barcode_scanner','</td>','The\x20Other\x20','map','product_name','post','incoming_view','Paid\x20For\x20Purchase','$warehouse_name','sendMail','prod_name','prod_Qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_id','master','Portuguese\x20(BR)','Purchase\x20Mail','Logo.png','<strong>\x20Regards\x20</strong>','all_purchases_finished_logs','Finished\x20Goods','164XGcdwC','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','$note','getDate','$product_details','item_code','numeric','inc','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','gmail','return_qty','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','body','match','data_type','password','product_details','An\x20error\x20occurred.','2-digit','MaxStocks_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','date','to_warehouse','toLocaleDateString','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','warehouse_name','Arabic\x20(ae)','slice','primary_code_hide','STAGING','$product_details.product_name','71775wPcyWF','$product.floorlevel','then','gross_price','RoomAssign','isAvailable','Purchase\x20Return','json','quantity','$date','here2','Distributing\x20','en-CA','$product.bin','<tr>','isProcess','/give_payment/:id','valueOf','39633UymSSw','<hr\x20class=\x22my-3\x22>','\x20<=>\x20','/incoming','to_room_name','/view','$unit','true','27415nisfvY','Portuguese','INCF-','$brand','Arabic','updateOne','Enabled','getFullYear','</span>','product_data','Router','149316fCyzyo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','purchase\x20data\x20add\x20successfully','product_code_hide','due_amount','stock_data','add_purchases\x20error','getMonth','stocks','invoice','add_purchases_finished_logs','secondary_code_hide','secondary_code','$_id','</head><body>','name','to_quantity','/all_purchases_finished/view','$maxStocks','$product_details.product_code','/view/add_purchases_logs','id_transaction','There\x20is\x20','$gross_price','success','$invoice','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','</h5>','product_date','prod_cat','Hindi','English\x20(US)','$suppliers_docs','2WhvJzc','own','$type_products','stock_quantity',',\x20bay:\x20','bin','$product_details.bay','$product.bay','INC-','suppliers','to_bay','Error\x20Occurs','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','catch','random','Room_name','\x20Order\x20Date\x20:\x20','Enclosed','Rack\x201','prod_primunit','paid_amount','<html><head><title></title>','$name','bay','153sDTXvt','$paid_amount','$suppliers','/all_purchases_finished/preview/','errors','invoice_init','findOne','$primary_code','staff','\x20units\x20to\x20warehouse:\x20','save','role','findById','purchases\x20item\x20return\x20successfull','expiry_date','filter','path','$product_details.storage','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x201','image','purchases_id','Purchase\x20Return\x20Mail','/barcode_scanner_logs','maxPerUnit','aggregate','string','logo','add_purchases_finished','/picking_list/pdf_puchases_fin_own_trf/','FGSEmail','date_recieved','maxProducts','French','batch_code','redirect','prod_qty','maxStocks','floor','maxperunit','purchases_process','Return\x20Goods','INC','$product_code','status','port','abs','table\x20page','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','payment\x20successfull','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','$product_details.product_stock','prod_secondunit',',\x20bin:\x20','product','standard_unit','True','false','2707355ecUijP','Spanish','undefined','\x20Order\x20Number\x20:\x20','Ambient','485960IhoeaR','type_of_products','Rack\x202','params','sales_category','product_stock','</table>','$category','flash','warehouse','edit_purchases_finished','English','/all_purchases_finished/process/','</tbody>','<span\x20style=\x22float:\x20right;\x22>','room','host','user','padStart','DRY\x20GOODS','level','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','length','$alertquantity','max','logs','product_cat','toString','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','There\x27s\x20a\x20error\x20in\x20this\x20transaction','JO_number','German','/incoming/add','prod_level','/view/add_purchases','/view/:id','$product.quantity','return_purchase_finished','createTransport','get','unit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<div>','email','$secondary_unit','/all_purchases/view','$product_details._id','LOG-INC-','</body></html>','../public/language/languages.json','secondary_unit','$product.type','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','production_date','$sales_category','/view/return_purchase/:id','_id','render','Chinese','/getinvoicetrf','$product','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','product_code','amount','$room','all_purchases_finished','$batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','language','7UqCEkQ','<tbody\x20style=\x22text-align:\x20center;\x22>','/preview/:id','max_product_unit','log','Email\x20sent\x20successfully','/process/:id','forEach','isUsed','$product_details.maxProducts','An\x20error\x20occurred\x20while\x20saving\x20data.','\x20<>\x20','$product_details.floorlevel','FROZEN\x20GOODS','$secondary_code','suppliers_docs','room_name','$product_details.bin','<h5\x20style=\x22text-align:\x20left;\x22>','/upload/','purchase\x20data\x20update\x20successfully','return_product','note','uuid','find','express','$maxProdPerUnit','$product_details.type','message','../models/all_models','3788268ACZxWM','primary_code'];a0_0x355a=function(){return _0x370809;};return a0_0x355a();}