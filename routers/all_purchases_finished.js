var a0_0xa38023=a0_0x3a40;(function(_0x42bdb5,_0x2fc574){var _0xf956c2=a0_0x3a40,_0x1d732e=_0x42bdb5();while(!![]){try{var _0xfc6201=-parseInt(_0xf956c2(0x296))/0x1*(parseInt(_0xf956c2(0x1ce))/0x2)+-parseInt(_0xf956c2(0x2b1))/0x3*(parseInt(_0xf956c2(0x290))/0x4)+-parseInt(_0xf956c2(0x19e))/0x5+-parseInt(_0xf956c2(0x2b5))/0x6*(-parseInt(_0xf956c2(0x1a9))/0x7)+-parseInt(_0xf956c2(0x1f5))/0x8*(-parseInt(_0xf956c2(0x182))/0x9)+-parseInt(_0xf956c2(0x298))/0xa+parseInt(_0xf956c2(0x1a1))/0xb;if(_0xfc6201===_0x2fc574)break;else _0x1d732e['push'](_0x1d732e['shift']());}catch(_0x5b5bfa){_0x1d732e['push'](_0x1d732e['shift']());}}}(a0_0x3ea6,0xa857b));const express=require(a0_0xa38023(0x24c)),app=express(),router=express[a0_0xa38023(0x1cd)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0xa38023(0x25f)),auth=require('../middleware/auth'),nodemailer=require(a0_0xa38023(0x295));function a0_0x3ea6(){var _0x200bfe=['Rack\x201','prod_Qty','prod_code','add_purchases_finished','/barcode/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','map','</td>','string','$product_details.bay','date_recieved','then','$secondary_code','$brand','INC','</tr>','\x20units\x20of\x20','/process/:id','1153015ALrvun','French','\x20<>\x20','534930RAqgYa','paid_amount','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</div>','English\x20(US)','toString','</span>','98NItVXz','body','/invoice/:id','</body></html>','language','POnumber','$product_details.floorlevel','to_recieved','prod_cat','Purchase\x20Return\x20Mail','en-CA','name','$sales_category','max_product_unit','$alertquantity','updateOne','$room','_id','True','data_type','role','warehouse_name','An\x20error\x20occurred\x20while\x20saving\x20data.','bay','/view/add_purchases_logs','/all_purchases_finished/process/','Distributing\x20','</thead>','errors','Asia/Manila','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','util','/../public','return_purchase_finished','return_qty','aggregate','Router','353866eGdlxg','</head><body>','post','maxperunit','type_of_products_type','Email\x20sent\x20successfully','purchases_process','min','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Room_name','/upload/','all','prod_name','\x20<=>\x20','<!DOCTYPE\x20html>','length','secondary_unit','/view','Ambient','stock_quantity','</h5>','/incoming/add','INCF-','DRY\x20GOODS','/all_purchases_finished/view','quantity','product_code','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','error','$invoice','</table>','$primary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','valueOf','here2','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','$suppliers','isAvailable','2168JiQlRd','maxPerUnit','There\x20is\x20','prod_level','all_purchases_finished','gross_price','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product.type','../public/language/languages.json','Arabic','production_date','German','getDate','findOne','log','$product_details.product_stock','$note','Paid\x20For\x20Purchase','$product.bay','/view/return_purchase/:id','JO_number','suppliers','image','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$name','$product_details.bin','purchase\x20data\x20update\x20successfully','/barcode_scanner','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Portuguese','/view/add_purchases','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','product','createTransport','suppliers_docs','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$type_products','purchases_id','purchase\x20data\x20add\x20successfully','product_id','\x20to\x20warehouse:\x20','product_cat','to_bay','<h5\x20style=\x22text-align:\x20left;\x22>','uuid','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/view/:id','/picking_list/pdf_puchases_fin_own_trf/','$product_details','$product_details._id','Arabic\x20(ae)','purchase_quantity','$product_code','$product.bin','primary_code_hide','product_code_hide','secondary_code_hide','$product','master','stock_data','to_warehouse','Hindi','$unit','inc',',\x20bin:\x20','findById','<span\x20style=\x22float:\x20right;\x22>','$product.quantity','RoomAssign','logo','$date','sales_data_cateory','FGSEmail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','unit','prod_primunit','edit_purchases_finished','Spanish','Chinese','$suppliers_docs','LOG-INC-','return_product','maxStocks','Enabled','express','product_data','gmail','sendMail','all_purchases_finished_logs','json','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$batch_code','note','id_transaction','$product_details.primary_code','/getTRF','Rack\x202','maxProducts','<tr>','<html><head><title></title>','slice','prod_unit','../models/all_models','===',',\x20bay:\x20','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','user','STAGING','params','exports','logs','$product.floorlevel','toLocaleDateString','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_details','/view_log','message','room','path','/all_purchases_finished/preview/','return_data','table\x20page','email','padStart','abs','/view/add_purchases/:id','save','max','bin','site_title','floor','purchases\x20item\x20return\x20successfull','MaxStocks_data','currency','$gross_price','/getinvoicetrf','edit_purchases_finished_view','Portuguese\x20(BR)','incoming_add','match','false','\x20===\x20','Finished\x20Goods','$_id','$product_details.type','2-digit','<hr\x20class=\x22my-3\x22>','\x20Order\x20Number\x20:\x20','invoice','441608vSwWuW','/give_payment/:id','staff','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','primary_code','nodemailer','1kJEKDA','numeric','13516940vYfXzG','product_stock','$maxStocks','to_room_name','get','$category','currency_placement','room_name','/incoming','true','$product_details.product_name','filter','<h5>','success','English','sales_category','$product.room_name','secondary_code','level','invoice_init','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','catch','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Logo.png','6ttolXJ','$product_details.product_code','standard_unit','add_purchases_finished_logs','567282SHqDgc','product_name','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','redirect','$expiry_date','The\x20Other\x20','product_date','stocks','getFullYear','render','$maxProdPerUnit','Enclosed','Error\x20Occurs','to_quantity','find','$secondary_unit','warehouse','due_amount','port','<div>','forEach','INC-','prod_qty','password','$return_data','batch_code','Return\x20Goods','/preview/:id','expiry_date','item_code','concat','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','An\x20error\x20occurred.','43083cKrfjg','\x20Order\x20Date\x20:\x20','random','$product_details.maxProducts','$due_amount','type_of_products','FROZEN\x20GOODS','own','<strong>\x20Regards\x20</strong>','status'];a0_0x3ea6=function(){return _0x200bfe;};return a0_0x3ea6();}var ejs=require('ejs');const path=require(a0_0xa38023(0x271)),users=require(a0_0xa38023(0x1fd)),{isNull}=require(a0_0xa38023(0x1c8));function a0_0x3a40(_0xb9bb81,_0x985744){var _0x3ea6db=a0_0x3ea6();return a0_0x3a40=function(_0x3a40de,_0x36e77d){_0x3a40de=_0x3a40de-0x17f;var _0x1fa014=_0x3ea6db[_0x3a40de];return _0x1fa014;},a0_0x3a40(_0xb9bb81,_0x985744);}router[a0_0xa38023(0x29c)](a0_0xa38023(0x2a0),auth,async(_0x7741d6,_0x189b83)=>{var _0x46175d=a0_0xa38023;try{const {username:_0x1b55e3,email:_0x1d1c6c,role:_0x5ca9ce}=_0x7741d6['user'],_0x25d6ed=_0x7741d6[_0x46175d(0x264)],_0x4943fb=await profile[_0x46175d(0x202)]({'email':_0x25d6ed[_0x46175d(0x275)]}),_0x58a7ae=await staff[_0x46175d(0x202)]({'email':_0x25d6ed['email']}),_0x50cf87=await master_shop[_0x46175d(0x2c3)]();let _0x28037b=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x58a7ae[_0x46175d(0x2c5)]}}]);if(_0x50cf87[0x0][_0x46175d(0x1ad)]==_0x46175d(0x1a6))var _0xcb7392=users[_0x46175d(0x2a6)];else{if(_0x50cf87[0x0][_0x46175d(0x1ad)]==_0x46175d(0x235))var _0xcb7392=users[_0x46175d(0x235)];else{if(_0x50cf87[0x0][_0x46175d(0x1ad)]==_0x46175d(0x200))var _0xcb7392=users[_0x46175d(0x200)];else{if(_0x50cf87[0x0]['language']==_0x46175d(0x245))var _0xcb7392=users['Spanish'];else{if(_0x50cf87[0x0][_0x46175d(0x1ad)]==_0x46175d(0x19f))var _0xcb7392=users['French'];else{if(_0x50cf87[0x0]['language']=='Portuguese\x20(BR)')var _0xcb7392=users['Portuguese'];else{if(_0x50cf87[0x0][_0x46175d(0x1ad)]==_0x46175d(0x246))var _0xcb7392=users[_0x46175d(0x246)];else{if(_0x50cf87[0x0][_0x46175d(0x1ad)]=='Arabic\x20(ae)')var _0xcb7392=users[_0x46175d(0x1fe)];}}}}}}}_0x189b83[_0x46175d(0x2be)]('incoming_view',{'success':_0x7741d6[_0x46175d(0x1a3)](_0x46175d(0x2a5)),'errors':_0x7741d6[_0x46175d(0x1a3)](_0x46175d(0x1c5)),'purchases':_0x28037b,'role':_0x25d6ed,'profile':_0x4943fb,'master_shop':_0x50cf87,'language':_0xcb7392,'staff_data':_0x58a7ae});}catch(_0x3dea80){console[_0x46175d(0x203)](_0x46175d(0x274),_0x3dea80),_0x189b83[_0x46175d(0x18b)](0xc8)[_0x46175d(0x251)]({'message':_0x3dea80[_0x46175d(0x26f)]});}}),router[a0_0xa38023(0x29c)]('/incoming/add',auth,async(_0x216371,_0xcd7add)=>{var _0x3c3e64=a0_0xa38023;try{const {username:_0x47cd1e,email:_0x588bc6,role:_0x1380d4}=_0x216371[_0x3c3e64(0x264)],_0x4cf820=_0x216371[_0x3c3e64(0x264)],_0x464b39=await profile['findOne']({'email':_0x4cf820['email']}),_0x1ae7cf=await staff[_0x3c3e64(0x202)]({'email':_0x4cf820[_0x3c3e64(0x275)]}),_0x481501=await master_shop[_0x3c3e64(0x2c3)]();let _0x326599=await transfers_finished[_0x3c3e64(0x1cc)]([{'$match':{'to_warehouse':_0x1ae7cf['warehouse'],'to_recieved':_0x3c3e64(0x287)}}]);if(_0x481501[0x0][_0x3c3e64(0x1ad)]==_0x3c3e64(0x1a6))var _0x463f40=users[_0x3c3e64(0x2a6)];else{if(_0x481501[0x0][_0x3c3e64(0x1ad)]=='Hindi')var _0x463f40=users[_0x3c3e64(0x235)];else{if(_0x481501[0x0]['language']=='German')var _0x463f40=users['German'];else{if(_0x481501[0x0][_0x3c3e64(0x1ad)]==_0x3c3e64(0x245))var _0x463f40=users['Spanish'];else{if(_0x481501[0x0][_0x3c3e64(0x1ad)]==_0x3c3e64(0x19f))var _0x463f40=users[_0x3c3e64(0x19f)];else{if(_0x481501[0x0][_0x3c3e64(0x1ad)]=='Portuguese\x20(BR)')var _0x463f40=users[_0x3c3e64(0x213)];else{if(_0x481501[0x0][_0x3c3e64(0x1ad)]==_0x3c3e64(0x246))var _0x463f40=users[_0x3c3e64(0x246)];else{if(_0x481501[0x0]['language']==_0x3c3e64(0x22a))var _0x463f40=users['Arabic'];}}}}}}}_0xcd7add[_0x3c3e64(0x2be)](_0x3c3e64(0x285),{'success':_0x216371[_0x3c3e64(0x1a3)]('success'),'errors':_0x216371['flash'](_0x3c3e64(0x1c5)),'purchases':_0x326599,'role':_0x4cf820,'profile':_0x464b39,'master_shop':_0x481501,'language':_0x463f40,'staff_data':_0x1ae7cf});}catch(_0x5ad468){console['log'](_0x3c3e64(0x274),_0x5ad468),_0xcd7add[_0x3c3e64(0x18b)](0xc8)['json']({'message':_0x5ad468[_0x3c3e64(0x26f)]});}});const createLog=async _0x4750f2=>{var _0x3f575f=a0_0xa38023;const _0x6403f8=new datalogs({'location':_0x4750f2});return await _0x6403f8[_0x3f575f(0x279)](),_0x6403f8[_0x3f575f(0x2ab)];};router['post'](a0_0xa38023(0x1e3),auth,async(_0x270059,_0x407444)=>{var _0x255039=a0_0xa38023;try{const {invoice_trf_data:_0x148b27,item_code:_0x367769,SCRN:_0xc1aad4,ReqBy:_0x2f3a9b,type_of_products:_0xd093e2,dateofreq:_0x4feeb0,PO_number:_0x597c5c,date:_0x341f54,warehouse_name:_0xc717c4,typeservicesData:_0xe09d71,typevehicle:_0x47bfa7,driver:_0x28c1dc,plate:_0x1b622e,van:_0x22d0fe,DRSI:_0x21d35f,TSU:_0x34019f,TFU:_0x517755,note:_0x1df38f}=_0x270059['body'],_0x1539e7=await transfers_finished[_0x255039(0x239)](_0x148b27);if(typeof _0x367769=='string')var _0x3ad716=[_0x270059[_0x255039(0x1aa)]['product_name']],_0x1a1188=[_0x270059[_0x255039(0x1aa)][_0x255039(0x2d2)]],_0x498412=[_0x270059[_0x255039(0x1aa)][_0x255039(0x2c2)]],_0x5af601=[_0x270059['body'][_0x255039(0x242)]],_0x4f6581=[_0x270059['body'][_0x255039(0x20c)]],_0x102fd2=[_0x270059[_0x255039(0x1aa)][_0x255039(0x27b)]],_0x36b03c=[_0x270059[_0x255039(0x1aa)][_0x255039(0x294)]],_0x35f8cb=[_0x270059[_0x255039(0x1aa)][_0x255039(0x2a9)]],_0x5c983b=[_0x270059[_0x255039(0x1aa)]['batch_code']],_0x40ff07=[_0x270059[_0x255039(0x1aa)]['expiry_date']],_0x5eac3c=[_0x270059['body'][_0x255039(0x1ff)]],_0x24f684=[_0x270059[_0x255039(0x1aa)][_0x255039(0x1b6)]],_0x3ca8ef=[_0x270059[_0x255039(0x1aa)][_0x255039(0x270)]];else var _0x3ad716=[..._0x270059['body']['product_name']],_0x1a1188=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x2d2)]],_0x498412=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x2c2)]],_0x5af601=[..._0x270059['body']['unit']],_0x4f6581=[..._0x270059[_0x255039(0x1aa)]['prod_secondunit']],_0x102fd2=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x27b)]],_0x36b03c=[..._0x270059[_0x255039(0x1aa)]['primary_code']],_0x35f8cb=[..._0x270059['body'][_0x255039(0x2a9)]],_0x5c983b=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x2ce)]],_0x40ff07=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x2d1)]],_0x5eac3c=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x1ff)]],_0x24f684=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x1b6)]],_0x3ca8ef=[..._0x270059[_0x255039(0x1aa)][_0x255039(0x270)]];const _0x55114a=_0x3ad716[_0x255039(0x192)](_0x37b977=>{return _0x37b977={'product_name':_0x37b977};});_0x1a1188[_0x255039(0x2c9)]((_0x476edc,_0x46d693)=>{var _0x35549d=_0x255039;_0x55114a[_0x46d693][_0x35549d(0x1e8)]=_0x476edc;}),_0x498412['forEach']((_0x366c79,_0x2ae664)=>{var _0x52694d=_0x255039;_0x55114a[_0x2ae664][_0x52694d(0x1e7)]=Math[_0x52694d(0x277)](_0x366c79);}),_0x5af601[_0x255039(0x2c9)]((_0x5237b4,_0x25b39b)=>{var _0x133f52=_0x255039;_0x55114a[_0x25b39b][_0x133f52(0x2b3)]=_0x5237b4;}),_0x4f6581[_0x255039(0x2c9)]((_0x592a77,_0x35e0c4)=>{var _0x9bf69f=_0x255039;_0x55114a[_0x35e0c4][_0x9bf69f(0x1de)]=_0x592a77;}),_0x102fd2[_0x255039(0x2c9)]((_0x327575,_0x1dfe01)=>{var _0x504ccd=_0x255039,_0x431e95=_0x327575[_0x504ccd(0x286)](/[A-Za-z]+/)[0x0],_0x30733a=parseInt(_0x327575[_0x504ccd(0x286)](/\d+/)[0x0]);_0x55114a[_0x1dfe01][_0x504ccd(0x2aa)]=_0x431e95,_0x55114a[_0x1dfe01][_0x504ccd(0x1c0)]=_0x30733a;}),_0x36b03c[_0x255039(0x2c9)]((_0x1fc3ab,_0x2fd588)=>{var _0x5789d0=_0x255039;_0x55114a[_0x2fd588][_0x5789d0(0x294)]=_0x1fc3ab;}),_0x35f8cb['forEach']((_0x51e5c9,_0x157c9f)=>{_0x55114a[_0x157c9f]['secondary_code']=_0x51e5c9;}),_0x5c983b['forEach']((_0x447e98,_0x78bebb)=>{var _0x275d21=_0x255039;_0x55114a[_0x78bebb][_0x275d21(0x2ce)]=_0x447e98;}),_0x40ff07[_0x255039(0x2c9)]((_0x33dc4f,_0x5bbeb7)=>{_0x55114a[_0x5bbeb7]['expiry_date']=_0x33dc4f;}),_0x5eac3c[_0x255039(0x2c9)]((_0x3299e1,_0x4196b8)=>{var _0x2f7f28=_0x255039;_0x55114a[_0x4196b8][_0x2f7f28(0x1ff)]=_0x3299e1;}),_0x24f684['forEach']((_0x565d27,_0x2f630e)=>{var _0x5a54d1=_0x255039;_0x55114a[_0x2f630e][_0x5a54d1(0x1d1)]=_0x565d27;}),_0x3ca8ef[_0x255039(0x2c9)]((_0x2f65f1,_0x497f0d)=>{var _0xe99739=_0x255039;_0x55114a[_0x497f0d][_0xe99739(0x29f)]=_0x2f65f1;});const _0x14794e=await createLog(_0x255039(0x19a));_0x3ca8ef['forEach']((_0x12af2a,_0x72de3d)=>{var _0x40fb79=_0x255039;_0x55114a[_0x72de3d][_0x40fb79(0x28f)]=_0x40fb79(0x2ca)+_0x14794e['toString']()[_0x40fb79(0x276)](0x8,'0');});const _0x421f9f=_0x55114a[_0x255039(0x2a3)](_0xf43d88=>_0xf43d88[_0x255039(0x1e7)]!=='0'&&_0xf43d88['quantity']!==''),_0x55f1c8=new purchases_incoming({'invoice':_0x255039(0x2ca)+_0x14794e[_0x255039(0x1a7)]()[_0x255039(0x276)](0x8,'0'),'date':_0x341f54,'warehouse_name':_0xc717c4,'product':_0x421f9f,'note':_0x1df38f,'POnumber':_0x597c5c,'SCRN':_0xc1aad4,'ReqBy':_0x2f3a9b,'dateofreq':_0x4feeb0,'typeservicesData':_0xe09d71,'van':_0x22d0fe,'typevehicle':_0x47bfa7,'driver':_0x28c1dc,'plate':_0x1b622e,'DRSI':_0x21d35f,'TSU':_0x34019f,'TFU':_0x517755,'typeOfProducts':_0xd093e2}),_0x2a22a2=await _0x55f1c8['save'](),_0x416fb8=_0x2a22a2[_0x255039(0x217)][_0x255039(0x192)](async _0x109f84=>{var _0x349f4e=_0x255039,_0x459c34=await warehouse[_0x349f4e(0x202)]({'name':_0xc717c4,'room':_0x109f84[_0x349f4e(0x29f)]});if(_0x109f84['quantity']>0x0){var _0x12018b=0x0;const _0x18ea9c=_0x459c34[_0x349f4e(0x26d)][_0x349f4e(0x192)](_0xeb0f89=>{var _0x2dbd07=_0x349f4e;_0xeb0f89['product_name']==_0x109f84[_0x2dbd07(0x2b6)]&&_0xeb0f89['bay']==_0x109f84[_0x2dbd07(0x222)]&&_0xeb0f89[_0x2dbd07(0x2d1)]==_0x109f84['expiry_date']&&_0xeb0f89['production_date']==_0x109f84['production_date']&&_0xeb0f89[_0x2dbd07(0x2ce)]==_0x109f84[_0x2dbd07(0x2ce)]&&_0xeb0f89['invoice']==_0x109f84[_0x2dbd07(0x28f)]&&(typeof _0x109f84[_0x2dbd07(0x256)]=='undefined'?(console[_0x2dbd07(0x203)](_0x2dbd07(0x1f1),_0xeb0f89[_0x2dbd07(0x299)]+_0x2dbd07(0x1a0)+_0xeb0f89[_0x2dbd07(0x1ba)]+_0x2dbd07(0x1db)+Math[_0x2dbd07(0x277)](_0xeb0f89['product_stock'])+Math['abs'](_0x109f84['to_quantity'])),_0xeb0f89[_0x2dbd07(0x299)]=Math['abs'](_0xeb0f89['product_stock'])+Math[_0x2dbd07(0x277)](_0x109f84[_0x2dbd07(0x1e7)])):(_0xeb0f89['product_stock']=Math[_0x2dbd07(0x277)](_0xeb0f89[_0x2dbd07(0x299)])+Math[_0x2dbd07(0x277)](_0x109f84['quantity']),_0x12018b++));});_0x12018b=='0'&&(_0x459c34[_0x349f4e(0x26d)]=_0x459c34[_0x349f4e(0x26d)][_0x349f4e(0x2d3)]({'product_name':_0x109f84[_0x349f4e(0x2b6)],'product_stock':_0x109f84[_0x349f4e(0x1e7)],'bay':_0x109f84[_0x349f4e(0x1c0)],'level':_0x109f84[_0x349f4e(0x2aa)],'product_code':_0x109f84[_0x349f4e(0x1e8)],'primary_code':_0x109f84[_0x349f4e(0x294)],'secondary_code':_0x109f84[_0x349f4e(0x2a9)],'expiry_date':_0x109f84[_0x349f4e(0x2d1)],'production_date':_0x109f84[_0x349f4e(0x1ff)],'maxProducts':_0x109f84['maxProducts'],'batch_code':_0x109f84[_0x349f4e(0x2ce)],'secondary_unit':_0x109f84[_0x349f4e(0x1de)],'unit':_0x109f84[_0x349f4e(0x2b3)],'maxProducts':_0x109f84[_0x349f4e(0x25a)],'maxPerUnit':_0x109f84[_0x349f4e(0x1f6)],'invoice':_0x109f84[_0x349f4e(0x28f)]}));}return _0x459c34;});Promise[_0x255039(0x1d9)](_0x416fb8)[_0x255039(0x197)](async _0x16753e=>{var _0x18a665=_0x255039;try{for(const _0x2c7459 of _0x16753e){await warehouse[_0x18a665(0x1b8)]({'_id':_0x2c7459[_0x18a665(0x1ba)]},{'$addToSet':{'product_details':{'$each':_0x2c7459[_0x18a665(0x26d)]}}});}_0x1539e7[_0x18a665(0x1b0)]=_0x18a665(0x2a1);const _0x2b9f63=await _0x1539e7[_0x18a665(0x279)](),_0x5bbbe4=await master_shop['find'](),_0x21e4f9=await email_settings[_0x18a665(0x202)](),_0x5a6972=await supervisor_settings[_0x18a665(0x2c3)]();var _0x36cb83=_0x55f1c8[_0x18a665(0x217)],_0x1f0b09='',_0x55ddc8;for(_0x55ddc8 in _0x36cb83){var _0x3d3281='FG';_0x55f1c8[_0x18a665(0x234)]=='DRY\x20GOODS'&&(_0x3d3281='DG'),_0x1f0b09+=_0x18a665(0x25b)+_0x18a665(0x1ef)+_0x36cb83[_0x55ddc8][_0x18a665(0x2b6)]+_0x18a665(0x193)+_0x18a665(0x1ef)+_0x36cb83[_0x55ddc8][_0x18a665(0x1e8)]+_0x18a665(0x193)+_0x18a665(0x1ef)+_0x36cb83[_0x55ddc8][_0x18a665(0x2c2)]+'</td>'+_0x18a665(0x1ef)+_0x36cb83[_0x55ddc8][_0x18a665(0x242)]+'</td>'+_0x18a665(0x1ef)+_0x36cb83[_0x55ddc8][_0x18a665(0x1de)]+_0x18a665(0x193)+_0x18a665(0x1ef)+_0x55f1c8['to_warehouse']+'</td>'+_0x18a665(0x1ef)+_0x36cb83[_0x55ddc8][_0x18a665(0x29b)]+_0x18a665(0x193)+_0x18a665(0x1ef)+_0x3d3281+_0x36cb83[_0x55ddc8][_0x18a665(0x222)]+'</td>'+_0x18a665(0x19b);}_0x270059[_0x18a665(0x1a3)](_0x18a665(0x2a5),'Transfer\x20Finalize\x20Successfully'),_0x407444[_0x18a665(0x2b8)](_0x18a665(0x227)+_0x2a22a2[_0x18a665(0x1ba)]);}catch(_0x454818){console[_0x18a665(0x1eb)](_0x454818),_0x407444['status'](0x1f4)[_0x18a665(0x251)]({'error':_0x18a665(0x293)});}})[_0x255039(0x2ad)](_0x185ec3=>{var _0x3ec09b=_0x255039;console[_0x3ec09b(0x1eb)](_0x185ec3),_0x407444[_0x3ec09b(0x18b)](0x1f4)[_0x3ec09b(0x251)]({'error':_0x3ec09b(0x181)});});}catch(_0x1e74fc){}}),router[a0_0xa38023(0x1d0)](a0_0xa38023(0x258),auth,async(_0x8e1e43,_0x36bb4d)=>{var _0x346ed7=a0_0xa38023;try{const {warehouse:_0xb0aac2}=_0x8e1e43['body'],_0x54a9c0=await transfers_finished[_0x346ed7(0x2c3)]({'to_warehouse':_0xb0aac2,'to_recieved':_0x346ed7(0x287)});_0x36bb4d[_0x346ed7(0x251)](_0x54a9c0);}catch(_0x3e4339){}}),router['post'](a0_0xa38023(0x282),auth,async(_0x45168d,_0x1dce65)=>{var _0x4bf00b=a0_0xa38023;try{const {invoice:_0x5a4ee5}=_0x45168d['body'],_0x185511=await transfers_finished[_0x4bf00b(0x2c3)]({'_id':_0x5a4ee5,'to_recieved':'false'});_0x1dce65['json'](_0x185511);}catch(_0x8f9584){}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x1df),auth,async(_0x375f17,_0x16d73b)=>{var _0x2964fd=a0_0xa38023;try{const {username:_0x50e90d,email:_0x5cf323,role:_0x21be39}=_0x375f17['user'],_0x3dc397=_0x375f17['user'],_0x17fb6b=await profile[_0x2964fd(0x202)]({'email':_0x3dc397[_0x2964fd(0x275)]}),_0x3b99a0=await staff[_0x2964fd(0x202)]({'email':_0x3dc397[_0x2964fd(0x275)]});if(_0x3dc397['role']==_0x2964fd(0x292)){const _0x2b1a1e=await staff[_0x2964fd(0x202)]({'email':_0x3dc397[_0x2964fd(0x275)]});}const _0x3b4b68=await master_shop['find']();let _0x2bb300;if(_0x3dc397[_0x2964fd(0x1bd)]==_0x2964fd(0x292)){const _0x5cb058=await staff[_0x2964fd(0x202)]({'email':_0x3dc397[_0x2964fd(0x275)]});_0x2bb300=await purchases_finished[_0x2964fd(0x1cc)]([{'$match':{'warehouse_name':_0x5cb058['warehouse'],'typeOfProducts':'own'}},{'$lookup':{'from':_0x2964fd(0x20a),'localField':_0x2964fd(0x20a),'foreignField':'name','as':_0x2964fd(0x219)}},{'$unwind':_0x2964fd(0x247)},{'$unwind':_0x2964fd(0x231)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2964fd(0x1ec)},'suppliers':{'$first':_0x2964fd(0x1f3)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2964fd(0x26b)},'room':{'$first':_0x2964fd(0x1b9)},'product':{'$push':_0x2964fd(0x231)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2964fd(0x252)},'due_amount':{'$first':_0x2964fd(0x186)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x2964fd(0x254)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2964fd(0x247)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2964fd(0x207)},'isle':{'$addToSet':_0x2964fd(0x22d)},'type':{'$addToSet':_0x2964fd(0x1fc)},'floorlevel':{'$addToSet':_0x2964fd(0x269)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2bb300=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x2964fd(0x189)}},{'$unwind':_0x2964fd(0x231)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2964fd(0x1f3)},'date':{'$first':_0x2964fd(0x23e)},'warehouse_name':{'$first':_0x2964fd(0x26b)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x2964fd(0x231)},'note':{'$first':_0x2964fd(0x205)},'paid_amount':{'$first':_0x2964fd(0x252)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2964fd(0x2b9)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x2964fd(0x23b)},'level':{'$addToSet':_0x2964fd(0x207)},'isle':{'$addToSet':_0x2964fd(0x22d)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2964fd(0x269)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3b4b68[0x0][_0x2964fd(0x1ad)]=='English\x20(US)')var _0x44b7c8=users[_0x2964fd(0x2a6)];else{if(_0x3b4b68[0x0][_0x2964fd(0x1ad)]==_0x2964fd(0x235))var _0x44b7c8=users['Hindi'];else{if(_0x3b4b68[0x0][_0x2964fd(0x1ad)]==_0x2964fd(0x200))var _0x44b7c8=users[_0x2964fd(0x200)];else{if(_0x3b4b68[0x0][_0x2964fd(0x1ad)]=='Spanish')var _0x44b7c8=users[_0x2964fd(0x245)];else{if(_0x3b4b68[0x0][_0x2964fd(0x1ad)]=='French')var _0x44b7c8=users[_0x2964fd(0x19f)];else{if(_0x3b4b68[0x0]['language']==_0x2964fd(0x284))var _0x44b7c8=users['Portuguese'];else{if(_0x3b4b68[0x0]['language']==_0x2964fd(0x246))var _0x44b7c8=users[_0x2964fd(0x246)];else{if(_0x3b4b68[0x0][_0x2964fd(0x1ad)]=='Arabic\x20(ae)')var _0x44b7c8=users[_0x2964fd(0x1fe)];}}}}}}}_0x16d73b['render'](_0x2964fd(0x1f9),{'success':_0x375f17[_0x2964fd(0x1a3)](_0x2964fd(0x2a5)),'errors':_0x375f17['flash'](_0x2964fd(0x1c5)),'purchases':_0x2bb300,'role':_0x3dc397,'profile':_0x17fb6b,'master_shop':_0x3b4b68,'language':_0x44b7c8});}catch(_0x21b666){console[_0x2964fd(0x203)]('table\x20page',_0x21b666),_0x16d73b[_0x2964fd(0x18b)](0xc8)[_0x2964fd(0x251)]({'message':_0x21b666['message']});}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x26e),auth,async(_0x15ef6d,_0x43087c)=>{var _0x52c2e5=a0_0xa38023;try{const {username:_0x5ab4a4,email:_0x188375,role:_0x17a0ca}=_0x15ef6d[_0x52c2e5(0x264)],_0x4d77ee=_0x15ef6d[_0x52c2e5(0x264)],_0x2ab54e=await profile[_0x52c2e5(0x202)]({'email':_0x4d77ee['email']}),_0x4666ef=await staff[_0x52c2e5(0x202)]({'email':_0x4d77ee[_0x52c2e5(0x275)]});if(_0x4d77ee[_0x52c2e5(0x1bd)]=='staff'){const _0x47f5db=await staff[_0x52c2e5(0x202)]({'email':_0x4d77ee[_0x52c2e5(0x275)]});}const _0x4af407=await master_shop[_0x52c2e5(0x2c3)]();let _0x5b8ca9;if(_0x4d77ee['role']==_0x52c2e5(0x292)){const _0x474add=await staff[_0x52c2e5(0x202)]({'email':_0x4d77ee[_0x52c2e5(0x275)]});_0x5b8ca9=await purchases_finished[_0x52c2e5(0x1cc)]([{'$match':{'warehouse_name':_0x474add[_0x52c2e5(0x2c5)]}},{'$lookup':{'from':_0x52c2e5(0x20a),'localField':_0x52c2e5(0x20a),'foreignField':_0x52c2e5(0x1b4),'as':_0x52c2e5(0x219)}},{'$unwind':_0x52c2e5(0x247)},{'$unwind':_0x52c2e5(0x231)},{'$group':{'_id':_0x52c2e5(0x28a),'invoice':{'$first':_0x52c2e5(0x1ec)},'suppliers':{'$first':_0x52c2e5(0x1f3)},'date':{'$first':_0x52c2e5(0x23e)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x52c2e5(0x1b9)},'product':{'$push':_0x52c2e5(0x231)},'note':{'$first':_0x52c2e5(0x205)},'paid_amount':{'$first':_0x52c2e5(0x252)},'due_amount':{'$first':_0x52c2e5(0x186)},'return_data':{'$first':_0x52c2e5(0x2cd)},'batch_code':{'$first':_0x52c2e5(0x254)},'expiry_date':{'$first':_0x52c2e5(0x2b9)},'suppliers_docs':{'$first':_0x52c2e5(0x247)},'total_product_quantity':{'$sum':_0x52c2e5(0x23b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x52c2e5(0x22d)},'type':{'$addToSet':_0x52c2e5(0x1fc)},'floorlevel':{'$addToSet':_0x52c2e5(0x269)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5b8ca9=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x52c2e5(0x268)}},{'$unwind':_0x52c2e5(0x231)},{'$group':{'_id':_0x52c2e5(0x28a),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x52c2e5(0x2a8)},'product':{'$push':_0x52c2e5(0x231)},'note':{'$first':_0x52c2e5(0x205)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x52c2e5(0x186)},'return_data':{'$first':_0x52c2e5(0x2cd)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x52c2e5(0x2b9)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x52c2e5(0x207)},'isle':{'$addToSet':_0x52c2e5(0x22d)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x52c2e5(0x269)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4af407[0x0][_0x52c2e5(0x1ad)]==_0x52c2e5(0x1a6))var _0x1c9c91=users['English'];else{if(_0x4af407[0x0][_0x52c2e5(0x1ad)]=='Hindi')var _0x1c9c91=users[_0x52c2e5(0x235)];else{if(_0x4af407[0x0][_0x52c2e5(0x1ad)]==_0x52c2e5(0x200))var _0x1c9c91=users['German'];else{if(_0x4af407[0x0][_0x52c2e5(0x1ad)]=='Spanish')var _0x1c9c91=users[_0x52c2e5(0x245)];else{if(_0x4af407[0x0][_0x52c2e5(0x1ad)]==_0x52c2e5(0x19f))var _0x1c9c91=users[_0x52c2e5(0x19f)];else{if(_0x4af407[0x0]['language']=='Portuguese\x20(BR)')var _0x1c9c91=users['Portuguese'];else{if(_0x4af407[0x0][_0x52c2e5(0x1ad)]==_0x52c2e5(0x246))var _0x1c9c91=users['Chinese'];else{if(_0x4af407[0x0][_0x52c2e5(0x1ad)]==_0x52c2e5(0x22a))var _0x1c9c91=users[_0x52c2e5(0x1fe)];}}}}}}}_0x43087c[_0x52c2e5(0x2be)](_0x52c2e5(0x250),{'success':_0x15ef6d['flash']('success'),'errors':_0x15ef6d[_0x52c2e5(0x1a3)](_0x52c2e5(0x1c5)),'purchases':_0x5b8ca9,'role':_0x4d77ee,'profile':_0x2ab54e,'master_shop':_0x4af407,'language':_0x1c9c91});}catch(_0x202494){console[_0x52c2e5(0x203)]('table\x20page',_0x202494),_0x43087c['status'](0xc8)[_0x52c2e5(0x251)]({'message':_0x202494['message']});}});function BayBinSelected(_0x2ded3c,_0x26ebeb){var _0x33826a=a0_0xa38023,_0x26b553=[],_0x190017=[];if(_0x2ded3c==_0x33826a(0x1e5)){switch(_0x26ebeb){case _0x33826a(0x18c):_0x26b553=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x33826a(0x259):_0x26b553=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x190017=['DG'];}else{if(_0x2ded3c==_0x33826a(0x188)){switch(_0x26ebeb){case'Rack\x201':_0x26b553=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x33826a(0x259):_0x26b553=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x190017=['FG'];}}return{'levels':_0x26b553,'identify':_0x190017};}async function getRandom8DigitNumber(){var _0x267055=a0_0xa38023;const _0x438be2=0x989680,_0x4a3982=0x5f5e0ff,_0x27ef70=Math[_0x267055(0x27d)](Math[_0x267055(0x184)]()*(_0x4a3982-_0x438be2+0x1))+_0x438be2;var _0x2482c1;const _0x3f633a=await purchases_finished[_0x267055(0x202)]({'invoice':_0x267055(0x1e4)+_0x27ef70});return _0x3f633a&&_0x3f633a['length']>0x0?_0x2482c1=_0x267055(0x1e4)+_0x27ef70:_0x2482c1=_0x267055(0x1e4)+_0x27ef70,_0x2482c1;}router[a0_0xa38023(0x29c)](a0_0xa38023(0x214),auth,async(_0x7f2d25,_0x29e948)=>{var _0x57a0f4=a0_0xa38023;try{const {username:_0x4dee5a,email:_0xeb515a,role:_0x49c6df}=_0x7f2d25[_0x57a0f4(0x264)],_0x405026=_0x7f2d25['user'],_0x123c65=await profile[_0x57a0f4(0x202)]({'email':_0x405026[_0x57a0f4(0x275)]}),_0x49b6ea=await master_shop[_0x57a0f4(0x2c3)](),_0x12cd26=await staff[_0x57a0f4(0x202)]({'email':_0x405026[_0x57a0f4(0x275)]}),_0x1ecec1=await suppliers[_0x57a0f4(0x2c3)]({});let _0x4c3c0d;if(_0x405026[_0x57a0f4(0x1bd)]==_0x57a0f4(0x292)){const _0x5bdff4=await staff[_0x57a0f4(0x202)]({'email':_0x405026[_0x57a0f4(0x275)]});_0x4c3c0d=await warehouse[_0x57a0f4(0x1cc)]([{'$match':{'status':_0x57a0f4(0x24b),'name':_0x5bdff4['warehouse']}},{'$group':{'_id':_0x57a0f4(0x20e),'name':{'$first':_0x57a0f4(0x20e)}}}]);}else _0x4c3c0d=await warehouse[_0x57a0f4(0x1cc)]([{'$match':{'status':_0x57a0f4(0x24b)}},{'$group':{'_id':_0x57a0f4(0x20e),'name':{'$first':_0x57a0f4(0x20e)}}}]);const _0x5668dd=await product[_0x57a0f4(0x2c3)]({}),_0x37d354=await warehouse[_0x57a0f4(0x2c3)]({'status':_0x57a0f4(0x24b)}),_0x94f614=await purchases_finished['find']({}),_0x2a4049=_0x94f614[_0x57a0f4(0x1dd)]+0x1,_0x569287=_0x57a0f4(0x1e4)+_0x2a4049[_0x57a0f4(0x1a7)]()[_0x57a0f4(0x276)](0x5,'0');var _0x47f320=[_0x57a0f4(0x1e0),_0x57a0f4(0x2c0)];if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]==_0x57a0f4(0x1a6))var _0x3f7d78=users['English'];else{if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]==_0x57a0f4(0x235))var _0x3f7d78=users[_0x57a0f4(0x235)];else{if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]==_0x57a0f4(0x200))var _0x3f7d78=users['German'];else{if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]==_0x57a0f4(0x245))var _0x3f7d78=users['Spanish'];else{if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]==_0x57a0f4(0x19f))var _0x3f7d78=users[_0x57a0f4(0x19f)];else{if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]==_0x57a0f4(0x284))var _0x3f7d78=users[_0x57a0f4(0x213)];else{if(_0x49b6ea[0x0][_0x57a0f4(0x1ad)]=='Chinese')var _0x3f7d78=users[_0x57a0f4(0x246)];else{if(_0x49b6ea[0x0]['language']==_0x57a0f4(0x22a))var _0x3f7d78=users[_0x57a0f4(0x1fe)];}}}}}}}const _0x3efb05=getRandom8DigitNumber(),_0x5f405c=new Date(),_0x3ed746={'year':_0x57a0f4(0x297),'month':_0x57a0f4(0x28c),'day':'2-digit','timeZone':_0x57a0f4(0x1c6)},_0x1e602b=_0x5f405c[_0x57a0f4(0x26a)](_0x57a0f4(0x1b3),_0x3ed746);console[_0x57a0f4(0x203)](_0x1e602b),_0x3efb05[_0x57a0f4(0x197)](_0x18278a=>{var _0x45f328=_0x57a0f4;_0x29e948[_0x45f328(0x2be)](_0x45f328(0x18f),{'success':_0x7f2d25[_0x45f328(0x1a3)](_0x45f328(0x2a5)),'errors':_0x7f2d25[_0x45f328(0x1a3)](_0x45f328(0x1c5)),'role':_0x405026,'profile':_0x123c65,'suppliers':_0x1ecec1,'warehouse':_0x4c3c0d,'product':_0x5668dd,'invoice':_0x18278a,'master_shop':_0x49b6ea,'language':_0x3f7d78,'find_data':_0x37d354,'rooms_data':_0x47f320,'formattedDate':_0x1e602b});})[_0x57a0f4(0x2ad)](_0x50d3ec=>{var _0x231c40=_0x57a0f4;_0x7f2d25[_0x231c40(0x1a3)](_0x231c40(0x1c5),_0x231c40(0x1fb)),_0x29e948[_0x231c40(0x2b8)]('/all_purchases_finished/view');});}catch(_0x368561){console['log'](_0x368561);}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x1c1),auth,async(_0x2f479a,_0x92b8a2)=>{var _0x18a63c=a0_0xa38023;try{const {username:_0x53e400,email:_0x2625f6,role:_0x5bec25}=_0x2f479a[_0x18a63c(0x264)],_0x49b186=_0x2f479a[_0x18a63c(0x264)],_0x11796c=await profile[_0x18a63c(0x202)]({'email':_0x49b186[_0x18a63c(0x275)]}),_0x36b3c6=await master_shop[_0x18a63c(0x2c3)](),_0x5d38b5=await staff[_0x18a63c(0x202)]({'email':_0x49b186[_0x18a63c(0x275)]}),_0x37bb9b=await suppliers[_0x18a63c(0x2c3)]({});let _0x182f61;if(_0x49b186[_0x18a63c(0x1bd)]=='staff'){const _0x49249b=await staff[_0x18a63c(0x202)]({'email':_0x49b186[_0x18a63c(0x275)]});_0x182f61=await warehouse[_0x18a63c(0x1cc)]([{'$match':{'status':_0x18a63c(0x24b),'name':_0x49249b[_0x18a63c(0x2c5)]}},{'$group':{'_id':_0x18a63c(0x20e),'name':{'$first':_0x18a63c(0x20e)}}}]);}else _0x182f61=await warehouse[_0x18a63c(0x1cc)]([{'$match':{'status':_0x18a63c(0x24b)}},{'$group':{'_id':'$name','name':{'$first':_0x18a63c(0x20e)}}}]);const _0x35fd28=await product[_0x18a63c(0x2c3)]({}),_0x32b9d8=await warehouse[_0x18a63c(0x2c3)]({'status':_0x18a63c(0x24b)}),_0x346885=await purchases_finished['find']({}),_0x52c23b=_0x346885['length']+0x1,_0x328025='INCF-'+_0x52c23b[_0x18a63c(0x1a7)]()['padStart'](0x5,'0');var _0x137ea0=[_0x18a63c(0x1e0),_0x18a63c(0x2c0)];if(_0x36b3c6[0x0][_0x18a63c(0x1ad)]==_0x18a63c(0x1a6))var _0x22bfb2=users[_0x18a63c(0x2a6)];else{if(_0x36b3c6[0x0][_0x18a63c(0x1ad)]==_0x18a63c(0x235))var _0x22bfb2=users[_0x18a63c(0x235)];else{if(_0x36b3c6[0x0]['language']=='German')var _0x22bfb2=users[_0x18a63c(0x200)];else{if(_0x36b3c6[0x0]['language']==_0x18a63c(0x245))var _0x22bfb2=users[_0x18a63c(0x245)];else{if(_0x36b3c6[0x0][_0x18a63c(0x1ad)]==_0x18a63c(0x19f))var _0x22bfb2=users[_0x18a63c(0x19f)];else{if(_0x36b3c6[0x0]['language']=='Portuguese\x20(BR)')var _0x22bfb2=users[_0x18a63c(0x213)];else{if(_0x36b3c6[0x0][_0x18a63c(0x1ad)]==_0x18a63c(0x246))var _0x22bfb2=users[_0x18a63c(0x246)];else{if(_0x36b3c6[0x0][_0x18a63c(0x1ad)]==_0x18a63c(0x22a))var _0x22bfb2=users['Arabic'];}}}}}}}const _0x57d6a=getRandom8DigitNumber();_0x57d6a['then'](_0x4024af=>{var _0x184435=_0x18a63c;_0x92b8a2[_0x184435(0x2be)](_0x184435(0x2b4),{'success':_0x2f479a[_0x184435(0x1a3)]('success'),'errors':_0x2f479a[_0x184435(0x1a3)](_0x184435(0x1c5)),'role':_0x49b186,'profile':_0x11796c,'suppliers':_0x37bb9b,'warehouse':_0x182f61,'product':_0x35fd28,'invoice':_0x4024af,'master_shop':_0x36b3c6,'language':_0x22bfb2,'find_data':_0x32b9d8,'rooms_data':_0x137ea0});})['catch'](_0x511706=>{var _0x561102=_0x18a63c;_0x2f479a[_0x561102(0x1a3)](_0x561102(0x1c5),_0x561102(0x1fb)),_0x92b8a2[_0x561102(0x2b8)](_0x561102(0x1e6));});}catch(_0x1cc922){console[_0x18a63c(0x203)](_0x1cc922);}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x278),auth,async(_0x1e8efb,_0x611b30)=>{var _0x529835=a0_0xa38023;try{const _0xa661a2=_0x1e8efb[_0x529835(0x266)]['id'];console[_0x529835(0x203)](_0xa661a2);const _0x51b5a2=await master_shop[_0x529835(0x2c3)]();console[_0x529835(0x203)](_0x529835(0x232),_0x51b5a2);const _0x4ac227=await product['findOne']({'name':_0xa661a2});console[_0x529835(0x203)]('product',_0x4ac227),_0x611b30[_0x529835(0x18b)](0xc8)['json']({'product_data':_0x4ac227,'master':_0x51b5a2});}catch(_0x11e93d){console[_0x529835(0x203)]('add_purchases\x20error',_0x11e93d);}}),router['post']('/view/add_purchases',auth,async(_0x23cae0,_0xcdb6)=>{var _0x305fb7=a0_0xa38023;try{const {invoice:_0x46b600,date:_0x5abce2,warehouse_name:_0x2dc5ab,prod_name:_0x4b2831,note:_0x14797e,due_amount:_0x41404d,Room_name:_0x524f4e,PO_number:_0x31e4a0,SCRN:_0x55762e,ReqBy:_0x27f128,dateofreq:_0x52bab0,suppliers:_0x37eb4b,typeservicesData:_0x5925f8,van:_0x448b99,typevehicle:_0x30da77,driver:_0x310136,plate:_0x3e3638,DRSI:_0x568db9,TSU:_0x3ba376,TFU:_0x142a17,JO_number:_0x410439,type_of_products:_0x49d8bb}=_0x23cae0[_0x305fb7(0x1aa)];if(typeof _0x4b2831==_0x305fb7(0x194))var _0x36589e=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x1da)]],_0xcd2360=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x18e)]],_0x385fc7=[_0x23cae0['body']['prod_Qty']],_0x83e09=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x243)]],_0x3f321a=[_0x23cae0[_0x305fb7(0x1aa)]['prod_secondunit']],_0x30b008=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x294)]],_0x42a110=[_0x23cae0[_0x305fb7(0x1aa)]['secondary_code']],_0x567928=[_0x23cae0['body'][_0x305fb7(0x27f)]],_0x20d911=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x2ce)]],_0x123d99=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x2d1)]],_0x497a03=[_0x23cae0['body'][_0x305fb7(0x2bb)]],_0x5e7eeb=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x1b6)]],_0x5d4b2a=[_0x23cae0['body'][_0x305fb7(0x1b1)]],_0x3b273b=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x1fa)]],_0x1c8e81=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x224)]],_0xe20851=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x23f)]],_0x220e3c=[_0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x21f)]];else var _0x36589e=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x1da)]],_0xcd2360=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x18e)]],_0x385fc7=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x18d)]],_0x83e09=[..._0x23cae0['body'][_0x305fb7(0x243)]],_0x3f321a=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x20c)]],_0x30b008=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x294)]],_0x42a110=[..._0x23cae0['body'][_0x305fb7(0x2a9)]],_0x567928=[..._0x23cae0['body'][_0x305fb7(0x27f)]],_0x20d911=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x2ce)]],_0x123d99=[..._0x23cae0['body']['expiry_date']],_0x497a03=[..._0x23cae0[_0x305fb7(0x1aa)]['product_date']],_0x5e7eeb=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x1b6)]],_0x5d4b2a=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x1b1)]],_0x3b273b=[..._0x23cae0['body']['gross_price']],_0x1c8e81=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x224)]],_0xe20851=[..._0x23cae0[_0x305fb7(0x1aa)][_0x305fb7(0x23f)]],_0x220e3c=[..._0x23cae0['body'][_0x305fb7(0x21f)]];const _0x26f6aa=_0x36589e[_0x305fb7(0x192)](_0x5e40f2=>{return _0x5e40f2={'product_name':_0x5e40f2};});_0x220e3c[_0x305fb7(0x2c9)]((_0x43e03,_0x33c129)=>{var _0x417444=_0x305fb7;_0x26f6aa[_0x33c129][_0x417444(0x21f)]=_0x43e03,_0x26f6aa[_0x33c129][_0x417444(0x196)]=_0x5abce2;}),_0xe20851[_0x305fb7(0x2c9)]((_0x3833d6,_0x9ec010)=>{_0x26f6aa[_0x9ec010]['sales_category']=_0x3833d6;}),_0xcd2360[_0x305fb7(0x2c9)]((_0x2bc05a,_0x3fd060)=>{var _0x3a04cb=_0x305fb7;_0x26f6aa[_0x3fd060][_0x3a04cb(0x1e8)]=_0x2bc05a;}),_0x1c8e81[_0x305fb7(0x2c9)]((_0x14fef4,_0x9fc9ce)=>{_0x26f6aa[_0x9fc9ce]['uuid']=_0x14fef4;}),_0x385fc7[_0x305fb7(0x2c9)]((_0x1290cd,_0x2e36ff)=>{var _0x37c415=_0x305fb7;_0x26f6aa[_0x2e36ff][_0x37c415(0x1e7)]=Math[_0x37c415(0x277)](_0x1290cd);}),_0x83e09[_0x305fb7(0x2c9)]((_0x408680,_0x1c514e)=>{var _0x5bad2c=_0x305fb7;_0x26f6aa[_0x1c514e][_0x5bad2c(0x2b3)]=_0x408680;}),_0x3f321a['forEach']((_0x4910ac,_0x142c05)=>{var _0x17b5b0=_0x305fb7;_0x26f6aa[_0x142c05][_0x17b5b0(0x1de)]=_0x4910ac;}),_0x30b008['forEach']((_0x391dea,_0x47a6e4)=>{var _0x36acd4=_0x305fb7;_0x26f6aa[_0x47a6e4][_0x36acd4(0x294)]=_0x391dea;}),_0x42a110[_0x305fb7(0x2c9)]((_0x90a81f,_0x5a9939)=>{var _0x5b3635=_0x305fb7;_0x26f6aa[_0x5a9939][_0x5b3635(0x2a9)]=_0x90a81f;}),_0x567928[_0x305fb7(0x2c9)]((_0x1658a6,_0x38d702)=>{_0x26f6aa[_0x38d702]['maxStocks']=_0x1658a6;}),_0x20d911[_0x305fb7(0x2c9)]((_0x52eba2,_0x1496e1)=>{var _0x37cd95=_0x305fb7;_0x26f6aa[_0x1496e1][_0x37cd95(0x2ce)]=_0x52eba2;}),_0x123d99['forEach']((_0x3645fe,_0x3153c3)=>{var _0x442b01=_0x305fb7;_0x26f6aa[_0x3153c3][_0x442b01(0x2d1)]=_0x3645fe;}),_0x497a03[_0x305fb7(0x2c9)]((_0x1c5ad4,_0x15b769)=>{var _0x3c3922=_0x305fb7;_0x26f6aa[_0x15b769][_0x3c3922(0x1ff)]=_0x1c5ad4;}),_0x5e7eeb[_0x305fb7(0x2c9)]((_0x3efa57,_0x2bbc3e)=>{_0x26f6aa[_0x2bbc3e]['maxperunit']=_0x3efa57;}),_0x5d4b2a[_0x305fb7(0x2c9)]((_0x44a91d,_0x3d649a)=>{var _0xa6c2b1=_0x305fb7;_0x26f6aa[_0x3d649a][_0xa6c2b1(0x221)]=_0x44a91d;}),_0x3b273b[_0x305fb7(0x2c9)]((_0xf308b3,_0x13e78a)=>{var _0x1892d6=_0x305fb7;_0x26f6aa[_0x13e78a][_0x1892d6(0x1fa)]=_0xf308b3;});const _0x42b4df=new invoice_for_incoming();await _0x42b4df[_0x305fb7(0x279)]();for(let _0x53465a=0x0;_0x53465a<=_0x36589e[_0x305fb7(0x1dd)]-0x1;_0x53465a++){_0x26f6aa[_0x53465a][_0x305fb7(0x28f)]=_0x305fb7(0x2ca)+_0x42b4df[_0x305fb7(0x2ab)]['toString']()[_0x305fb7(0x276)](0x8,'0');}const _0x3db210=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x2dc5ab}}]);for(let _0x39c2ce=0x0;_0x39c2ce<=_0x3db210['length']-0x1;_0x39c2ce++){const _0x1bd572=_0x3db210[_0x39c2ce];for(let _0x2125e0=0x0;_0x2125e0<=_0x1bd572[_0x305fb7(0x24d)][_0x305fb7(0x1dd)]-0x1;_0x2125e0++){const _0x4342c2=_0x1bd572['product_data'][_0x2125e0],_0x35f850=await warehouse['aggregate']([{'$match':{'name':_0x1bd572[_0x305fb7(0x1be)],'room':_0x1bd572[_0x305fb7(0x270)]}},{'$unwind':_0x305fb7(0x228)},{'$match':{'product_details.level':_0x4342c2[_0x305fb7(0x1c0)],'product_details.bay':parseInt(_0x4342c2['bin']),'product_details.product_code':_0x4342c2['product_code']}}]);for(let _0x4f393a=0x0;_0x4f393a<=_0x35f850['length']-0x1;_0x4f393a++){let _0x53d1d9=_0x35f850[_0x4f393a],_0x3e8aab=0x0;_0x53d1d9['product_details'][_0x305fb7(0x1e8)]==_0x4342c2[_0x305fb7(0x1e8)]&&_0x53d1d9[_0x305fb7(0x26d)][_0x305fb7(0x1c0)]==_0x4342c2[_0x305fb7(0x27b)]&&_0x53d1d9[_0x305fb7(0x26d)]['level']==_0x4342c2[_0x305fb7(0x1c0)]&&(_0x4342c2['max']=parseInt(_0x4342c2['max'])-parseInt(_0x53d1d9[_0x305fb7(0x26d)][_0x305fb7(0x299)]),_0x3e8aab++),_0x3e8aab=='0'&&(parseInt(_0x4342c2[_0x305fb7(0x27a)])>0x0&&(_0x3db210[_0x39c2ce][_0x305fb7(0x24d)]=_0x3db210[_0x39c2ce][_0x305fb7(0x24d)][_0x305fb7(0x2d3)]({'bay':_0x4342c2[_0x305fb7(0x1c0)],'bin':_0x4342c2[_0x305fb7(0x27b)],'max':_0x4342c2[_0x305fb7(0x27a)],'min':_0x4342c2['min'],'product_code':_0x4342c2[_0x305fb7(0x1e8)],'product_id':_0x4342c2[_0x305fb7(0x21f)],'product_name':_0x4342c2[_0x305fb7(0x2b6)]})));}}_0x3db210[_0x39c2ce]['product_data']=_0x3db210[_0x39c2ce]['product_data'][_0x305fb7(0x2a3)](_0x39f254=>parseInt(_0x39f254[_0x305fb7(0x27a)])>0x0);}for(let _0x5e0d92=0x0;_0x5e0d92<=_0x3db210[_0x305fb7(0x1dd)]-0x1;_0x5e0d92++){const _0x22303e=_0x3db210[_0x5e0d92];for(let _0x2b1ed3=0x0;_0x2b1ed3<=_0x22303e[_0x305fb7(0x24d)][_0x305fb7(0x1dd)]-0x1;_0x2b1ed3++){const _0x499624=_0x22303e[_0x305fb7(0x24d)][_0x2b1ed3],_0x3151d1=await warehouse_temporary[_0x305fb7(0x1cc)]([{'$match':{'warehouse':_0x22303e[_0x305fb7(0x1be)],'room_name':_0x22303e[_0x305fb7(0x270)],'isConfirm':_0x305fb7(0x287),'data_type':_0x305fb7(0x237),'product_code':_0x499624[_0x305fb7(0x1e8)],'level':_0x499624[_0x305fb7(0x1c0)],'bay':parseInt(_0x499624[_0x305fb7(0x27b)])}}]);for(let _0x58510b=0x0;_0x58510b<=_0x3151d1[_0x305fb7(0x1dd)]-0x1;_0x58510b++){let _0x471571=_0x3151d1[_0x58510b];console[_0x305fb7(0x203)](_0x471571);let _0x2726a1=0x0;_0x471571[_0x305fb7(0x1e8)]==_0x499624[_0x305fb7(0x1e8)]&&_0x471571[_0x305fb7(0x1c0)]==_0x499624[_0x305fb7(0x27b)]&&_0x471571['level']==_0x499624[_0x305fb7(0x1c0)]&&(_0x499624[_0x305fb7(0x27a)]=parseInt(_0x499624['max'])-parseInt(_0x471571[_0x305fb7(0x299)]),_0x2726a1++),_0x2726a1=='0'&&(parseInt(_0x499624[_0x305fb7(0x27a)])>0x0&&(_0x3db210[_0x5e0d92]['product_data']=_0x3db210[_0x5e0d92]['product_data'][_0x305fb7(0x2d3)]({'bay':_0x499624[_0x305fb7(0x1c0)],'bin':_0x499624[_0x305fb7(0x27b)],'max':_0x499624[_0x305fb7(0x27a)],'min':_0x499624['min'],'product_code':_0x499624[_0x305fb7(0x1e8)],'product_id':_0x499624[_0x305fb7(0x21f)],'product_name':_0x499624['product_name']})));}}_0x3db210[_0x5e0d92][_0x305fb7(0x24d)]=_0x3db210[_0x5e0d92][_0x305fb7(0x24d)][_0x305fb7(0x2a3)](_0x1b4bb5=>parseInt(_0x1b4bb5[_0x305fb7(0x27a)])>0x0);}let _0x44a228=[],_0x3ba173=0x0;for(let _0x4fbb17=0x0;_0x4fbb17<=_0x26f6aa[_0x305fb7(0x1dd)]-0x1;_0x4fbb17++){const _0x279461=_0x26f6aa[_0x4fbb17];let _0x127c78=_0x279461[_0x305fb7(0x1e7)];for(let _0x48f5bb=0x0;_0x48f5bb<=_0x3db210[_0x305fb7(0x1dd)]-0x1;_0x48f5bb++){const _0x59dd68=_0x3db210[_0x48f5bb];for(let _0x1aae31=0x0;_0x1aae31<=_0x59dd68[_0x305fb7(0x24d)][_0x305fb7(0x1dd)]-0x1;_0x1aae31++){const _0x2743af=_0x59dd68[_0x305fb7(0x24d)][_0x1aae31];if(_0x2743af[_0x305fb7(0x1e8)]===_0x279461[_0x305fb7(0x1e8)]){const _0x4c8dba=await warehouse['aggregate']([{'$match':{'name':_0x2dc5ab,'room':_0x59dd68[_0x305fb7(0x270)]}},{'$unwind':_0x305fb7(0x228)},{'$match':{'product_details.level':_0x2743af[_0x305fb7(0x1c0)],'product_details.bay':parseInt(_0x2743af[_0x305fb7(0x27b)])}}]);if(_0x4c8dba[_0x305fb7(0x1dd)]==0x0){for(let _0xa87752=0x0;_0xa87752<=_0x59dd68['product_data'][_0x305fb7(0x1dd)]-0x1&&_0x127c78>0x0;_0xa87752++){const _0xa1fee0=_0x59dd68[_0x305fb7(0x24d)][_0xa87752];console[_0x305fb7(0x203)](_0x279461[_0x305fb7(0x1e8)]+_0x305fb7(0x260)+_0xa1fee0['product_code']+_0x305fb7(0x1a0)+_0xa1fee0['min']+'\x20<>\x20'+_0xa1fee0[_0x305fb7(0x27a)]+_0x305fb7(0x1a0)+_0xa1fee0['bay']+_0x305fb7(0x1a0)+_0xa1fee0[_0x305fb7(0x27b)]);if(_0x279461['product_code']===_0xa1fee0[_0x305fb7(0x1e8)]){_0x44a228[_0x3ba173]={};const _0x3909b7=parseInt(_0xa1fee0[_0x305fb7(0x27a)]),_0x26e49a=0x0;let _0x4676a8=_0x3909b7-_0x26e49a,_0x19a202=Math[_0x305fb7(0x1d5)](_0x127c78,_0x4676a8);console[_0x305fb7(0x203)](_0x305fb7(0x1c3)+_0x19a202+_0x305fb7(0x19c)+_0x279461[_0x305fb7(0x2b6)]+_0x305fb7(0x220)+_0x59dd68[_0x305fb7(0x1be)]+',\x20room:\x20'+_0x59dd68[_0x305fb7(0x270)]+_0x305fb7(0x261)+_0xa1fee0[_0x305fb7(0x1c0)]+_0x305fb7(0x238)+_0xa1fee0[_0x305fb7(0x27b)]+'\x20inc\x20=\x20'+_0x3ba173),_0x44a228[_0x3ba173][_0x305fb7(0x2b6)]=_0x279461[_0x305fb7(0x2b6)],_0x44a228[_0x3ba173]['product_code']=_0x279461[_0x305fb7(0x1e8)],_0x44a228[_0x3ba173][_0x305fb7(0x21f)]=_0x279461[_0x305fb7(0x21f)],_0x44a228[_0x3ba173][_0x305fb7(0x196)]=_0x279461[_0x305fb7(0x196)],_0x44a228[_0x3ba173][_0x305fb7(0x2a7)]=_0x279461['sales_category'],_0x44a228[_0x3ba173][_0x305fb7(0x224)]=_0x279461['uuid'],_0x44a228[_0x3ba173][_0x305fb7(0x1e7)]=_0x19a202,_0x44a228[_0x3ba173][_0x305fb7(0x2b3)]=_0x279461['standard_unit'],_0x44a228[_0x3ba173][_0x305fb7(0x1de)]=_0x279461[_0x305fb7(0x1de)],_0x44a228[_0x3ba173][_0x305fb7(0x294)]=_0x279461['primary_code'],_0x44a228[_0x3ba173][_0x305fb7(0x2a9)]=_0x279461['secondary_code'],_0x44a228[_0x3ba173][_0x305fb7(0x24a)]=_0x279461[_0x305fb7(0x24a)],_0x44a228[_0x3ba173]['batch_code']=_0x279461[_0x305fb7(0x2ce)],_0x44a228[_0x3ba173][_0x305fb7(0x2d1)]=_0x279461['expiry_date'],_0x44a228[_0x3ba173][_0x305fb7(0x1ff)]=_0x279461['production_date'],_0x44a228[_0x3ba173][_0x305fb7(0x1d1)]=_0x279461[_0x305fb7(0x1d1)],_0x44a228[_0x3ba173][_0x305fb7(0x221)]=_0x279461[_0x305fb7(0x221)],_0x44a228[_0x3ba173][_0x305fb7(0x28f)]=_0x279461[_0x305fb7(0x28f)],_0x44a228[_0x3ba173]['gross_price']=_0x279461[_0x305fb7(0x1fa)],_0x44a228[_0x3ba173][_0x305fb7(0x29f)]=_0x59dd68[_0x305fb7(0x270)],_0x44a228[_0x3ba173][_0x305fb7(0x2aa)]=_0xa1fee0[_0x305fb7(0x1c0)],_0x44a228[_0x3ba173][_0x305fb7(0x1c0)]=_0xa1fee0['bin'],_0x127c78-=_0x19a202,_0x3ba173++;if(_0x127c78<=0x0)break;}}if(_0x127c78<=0x0){_0x23cae0[_0x305fb7(0x1a3)](_0x305fb7(0x1c5),_0x305fb7(0x2ba)+_0x127c78+_0x305fb7(0x1ea));break;}if(_0x127c78>0x0){console[_0x305fb7(0x203)](_0x305fb7(0x1f7)+_0x127c78+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');break;}}}}}if(_0x127c78>0x0){const _0x3e314a=await warehouse[_0x305fb7(0x1cc)]([{'$match':{'name':_0x2dc5ab,'isStaging':'true'}}]);_0x44a228[_0x3ba173]={},_0x44a228[_0x3ba173]['product_name']=_0x279461[_0x305fb7(0x2b6)],_0x44a228[_0x3ba173][_0x305fb7(0x1e8)]=_0x279461[_0x305fb7(0x1e8)],_0x44a228[_0x3ba173]['product_id']=_0x279461['product_id'],_0x44a228[_0x3ba173][_0x305fb7(0x196)]=_0x279461[_0x305fb7(0x196)],_0x44a228[_0x3ba173][_0x305fb7(0x2a7)]=_0x279461[_0x305fb7(0x2a7)],_0x44a228[_0x3ba173][_0x305fb7(0x224)]=_0x279461[_0x305fb7(0x224)],_0x44a228[_0x3ba173][_0x305fb7(0x1e7)]=_0x127c78,_0x44a228[_0x3ba173][_0x305fb7(0x2b3)]=_0x279461[_0x305fb7(0x2b3)],_0x44a228[_0x3ba173][_0x305fb7(0x1de)]=_0x279461[_0x305fb7(0x1de)],_0x44a228[_0x3ba173][_0x305fb7(0x294)]=_0x279461['primary_code'],_0x44a228[_0x3ba173][_0x305fb7(0x2a9)]=_0x279461['secondary_code'],_0x44a228[_0x3ba173][_0x305fb7(0x24a)]=_0x279461['maxStocks'],_0x44a228[_0x3ba173][_0x305fb7(0x2ce)]=_0x279461[_0x305fb7(0x2ce)],_0x44a228[_0x3ba173][_0x305fb7(0x2d1)]=_0x279461[_0x305fb7(0x2d1)],_0x44a228[_0x3ba173]['production_date']=_0x279461[_0x305fb7(0x1ff)],_0x44a228[_0x3ba173][_0x305fb7(0x1d1)]=_0x279461['maxperunit'],_0x44a228[_0x3ba173][_0x305fb7(0x221)]=_0x279461[_0x305fb7(0x221)],_0x44a228[_0x3ba173][_0x305fb7(0x28f)]=_0x279461[_0x305fb7(0x28f)],_0x44a228[_0x3ba173]['gross_price']=_0x279461[_0x305fb7(0x1fa)],_0x44a228[_0x3ba173][_0x305fb7(0x29f)]=_0x3e314a[0x0][_0x305fb7(0x270)],_0x44a228[_0x3ba173][_0x305fb7(0x2aa)]=_0x305fb7(0x265),_0x44a228[_0x3ba173][_0x305fb7(0x1c0)]='1',console[_0x305fb7(0x203)]('STAGING\x20AREA\x201'+_0x305fb7(0x1a0)+_0x279461[_0x305fb7(0x1e8)]+_0x305fb7(0x288)+_0x279461[_0x305fb7(0x1e8)]+_0x305fb7(0x1a0)+_0x3ba173+'\x20<>\x20'+_0x127c78),_0x23cae0[_0x305fb7(0x1a3)](_0x305fb7(0x1c5),'The\x20Other\x20'+_0x127c78+_0x305fb7(0x1f2));}}const _0x804b36=_0x44a228['filter'](_0x291b14=>_0x291b14[_0x305fb7(0x1e7)]!=='0'&&_0x291b14[_0x305fb7(0x1e7)]!==''),_0x4dc037=new purchases_finished({'invoice':_0x305fb7(0x2ca)+_0x42b4df['invoice_init'][_0x305fb7(0x1a7)]()['padStart'](0x8,'0'),'suppliers':_0x37eb4b,'date':_0x5abce2,'warehouse_name':_0x2dc5ab,'product':_0x804b36,'note':_0x14797e,'due_amount':_0x41404d,'room':_0x524f4e,'POnumber':_0x31e4a0,'SCRN':_0x55762e,'JO_number':_0x410439,'ReqBy':_0x27f128,'dateofreq':_0x52bab0,'typeservicesData':_0x5925f8,'van':_0x448b99,'typevehicle':_0x30da77,'driver':_0x310136,'plate':_0x3e3638,'DRSI':_0x568db9,'TSU':_0x3ba376,'TFU':_0x142a17,'typeOfProducts':_0x49d8bb}),_0x37b4a5=await _0x4dc037[_0x305fb7(0x279)](),_0x331321=await purchases_finished[_0x305fb7(0x202)]({'_id':_0x37b4a5[_0x305fb7(0x1ba)]['valueOf']()});_0x23cae0[_0x305fb7(0x1a3)]('success',_0x305fb7(0x21e)),_0xcdb6[_0x305fb7(0x2b8)](_0x305fb7(0x1c2)+_0x331321[_0x305fb7(0x1ba)]['valueOf']());}catch(_0x594bb7){console[_0x305fb7(0x203)](_0x594bb7);}}),router['get']('/process/:id',auth,async(_0x41cfd1,_0x3ba722)=>{var _0x1ba2c4=a0_0xa38023;try{const {username:_0x3d3425,email:_0x10bb33,role:_0x9e7c4c}=_0x41cfd1['user'],_0x18bb14=_0x41cfd1['user'],_0x20fa75=_0x41cfd1[_0x1ba2c4(0x266)]['id'],_0xdb8545=await profile[_0x1ba2c4(0x202)]({'email':_0x18bb14[_0x1ba2c4(0x275)]}),_0x538d81=await master_shop[_0x1ba2c4(0x2c3)](),_0x5e4075=await staff['findOne']({'email':_0x18bb14[_0x1ba2c4(0x275)]}),_0xeb1d9b=await suppliers['find']({});let _0x284e3f;if(_0x18bb14['role']==_0x1ba2c4(0x292)){const _0x1c3e38=await staff[_0x1ba2c4(0x202)]({'email':_0x18bb14['email']});_0x284e3f=await warehouse[_0x1ba2c4(0x1cc)]([{'$match':{'status':_0x1ba2c4(0x24b),'name':_0x1c3e38[_0x1ba2c4(0x2c5)]}},{'$group':{'_id':_0x1ba2c4(0x20e),'name':{'$first':_0x1ba2c4(0x20e)}}}]);}else _0x284e3f=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x1ba2c4(0x20e),'name':{'$first':_0x1ba2c4(0x20e)}}}]);const _0x4e1055=await purchases_finished[_0x1ba2c4(0x239)](_0x20fa75);if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]=='English\x20(US)')var _0x484597=users['English'];else{if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]==_0x1ba2c4(0x235))var _0x484597=users[_0x1ba2c4(0x235)];else{if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]==_0x1ba2c4(0x200))var _0x484597=users[_0x1ba2c4(0x200)];else{if(_0x538d81[0x0]['language']==_0x1ba2c4(0x245))var _0x484597=users[_0x1ba2c4(0x245)];else{if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]=='French')var _0x484597=users[_0x1ba2c4(0x19f)];else{if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]==_0x1ba2c4(0x284))var _0x484597=users[_0x1ba2c4(0x213)];else{if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]==_0x1ba2c4(0x246))var _0x484597=users[_0x1ba2c4(0x246)];else{if(_0x538d81[0x0][_0x1ba2c4(0x1ad)]==_0x1ba2c4(0x22a))var _0x484597=users[_0x1ba2c4(0x1fe)];}}}}}}}_0x3ba722[_0x1ba2c4(0x2be)](_0x1ba2c4(0x1d4),{'success':_0x41cfd1[_0x1ba2c4(0x1a3)](_0x1ba2c4(0x2a5)),'errors':_0x41cfd1[_0x1ba2c4(0x1a3)](_0x1ba2c4(0x1c5)),'role':_0x18bb14,'profile':_0xdb8545,'suppliers':_0xeb1d9b,'warehouse':_0x284e3f,'master_shop':_0x538d81,'language':_0x484597,'purchases_data':_0x4e1055});}catch(_0x2432e8){console['log'](_0x2432e8);}});async function get_warehouse_data(_0x2e801c,_0x1b1069){var _0x535377=a0_0xa38023;try{const _0x1b2fe4=await warehouse_temporary['findOne']({'name':_0x2e801c,'room':_0x1b1069});if(!_0x1b2fe4){const _0x10750b=new warehouse_temporary({'name':_0x2e801c,'address':_0x2e801c,'status':_0x535377(0x24b),'room':_0x1b1069,'isStaging':'false'});return await _0x10750b[_0x535377(0x279)](),_0x10750b;}else return _0x1b2fe4;}catch(_0x28243e){console[_0x535377(0x1eb)](_0x535377(0x1e9),_0x28243e);throw _0x28243e;}}router['post'](a0_0xa38023(0x19d),auth,async(_0x28b8ef,_0x2483ce)=>{var _0x589fef=a0_0xa38023;try{const _0x4c2b52=_0x28b8ef[_0x589fef(0x266)]['id'],_0x1059b3=await purchases_finished[_0x589fef(0x239)](_0x4c2b52);let _0x144b99=[];_0x1059b3[_0x589fef(0x217)][_0x589fef(0x2c9)]((_0x51f9a9,_0x2538e8)=>{var _0x4323ef=_0x589fef;_0x144b99[_0x2538e8]={},_0x144b99[_0x2538e8][_0x4323ef(0x2c5)]=_0x1059b3[_0x4323ef(0x1be)],_0x144b99[_0x2538e8][_0x4323ef(0x21f)]=_0x51f9a9['product_id'],_0x144b99[_0x2538e8]['product_name']=_0x51f9a9[_0x4323ef(0x2b6)],_0x144b99[_0x2538e8][_0x4323ef(0x1e8)]=_0x51f9a9[_0x4323ef(0x1e8)],_0x144b99[_0x2538e8][_0x4323ef(0x299)]=_0x51f9a9['quantity'],_0x144b99[_0x2538e8][_0x4323ef(0x242)]=_0x51f9a9[_0x4323ef(0x2b3)],_0x144b99[_0x2538e8][_0x4323ef(0x1de)]=_0x51f9a9['secondary_unit'],_0x144b99[_0x2538e8]['level']=_0x51f9a9[_0x4323ef(0x2aa)],_0x144b99[_0x2538e8][_0x4323ef(0x1c0)]=_0x51f9a9[_0x4323ef(0x1c0)],_0x144b99[_0x2538e8][_0x4323ef(0x294)]=_0x51f9a9[_0x4323ef(0x294)],_0x144b99[_0x2538e8][_0x4323ef(0x2a9)]=_0x51f9a9[_0x4323ef(0x2a9)],_0x144b99[_0x2538e8][_0x4323ef(0x24a)]=_0x51f9a9['maxStocks'],_0x144b99[_0x2538e8][_0x4323ef(0x2ce)]=_0x51f9a9[_0x4323ef(0x2ce)],_0x144b99[_0x2538e8][_0x4323ef(0x2d1)]=_0x51f9a9[_0x4323ef(0x2d1)],_0x144b99[_0x2538e8][_0x4323ef(0x1ff)]=_0x51f9a9[_0x4323ef(0x1ff)],_0x144b99[_0x2538e8][_0x4323ef(0x1d1)]=_0x51f9a9[_0x4323ef(0x1d1)],_0x144b99[_0x2538e8][_0x4323ef(0x221)]=_0x51f9a9[_0x4323ef(0x221)],_0x144b99[_0x2538e8][_0x4323ef(0x29f)]=_0x51f9a9[_0x4323ef(0x29f)],_0x144b99[_0x2538e8][_0x4323ef(0x28f)]=_0x51f9a9['invoice'],_0x144b99[_0x2538e8][_0x4323ef(0x224)]=_0x51f9a9[_0x4323ef(0x224)],_0x144b99[_0x2538e8][_0x4323ef(0x1fa)]=_0x51f9a9[_0x4323ef(0x1fa)],_0x144b99[_0x2538e8]['sales_category']=_0x51f9a9[_0x4323ef(0x2a7)],_0x144b99[_0x2538e8][_0x4323ef(0x196)]=_0x51f9a9[_0x4323ef(0x196)],_0x144b99[_0x2538e8][_0x4323ef(0x21d)]=_0x51f9a9[_0x4323ef(0x1ba)][_0x4323ef(0x1f0)](),_0x144b99[_0x2538e8][_0x4323ef(0x1bc)]=_0x4323ef(0x237),_0x144b99[_0x2538e8][_0x4323ef(0x1f4)]=_0x4323ef(0x2a1),_0x144b99[_0x2538e8]['isUsed']=_0x4323ef(0x287);});for(let _0x570c28=0x0;_0x570c28<=_0x144b99[_0x589fef(0x1dd)]-0x1;_0x570c28++){const _0x465ed6=_0x144b99[_0x570c28],_0x3faffa=new warehouse_temporary(_0x465ed6);await _0x3faffa[_0x589fef(0x279)]();}_0x1059b3['isProcess']=_0x589fef(0x2a1),await _0x1059b3['save'](),_0x28b8ef[_0x589fef(0x1a3)]('success',_0x589fef(0x2b7)),_0x2483ce[_0x589fef(0x2b8)]('/all_purchases_finished/process/'+_0x1059b3['_id']['valueOf']());}catch(_0xc74bda){}}),router[a0_0xa38023(0x1d0)](a0_0xa38023(0x1c1),auth,async(_0x2e95c7,_0x42171e)=>{var _0xbd583f=a0_0xa38023;try{const {invoice:_0x2f60f5,date:_0x10e4d4,warehouse_name:_0x1b2c33,prod_name:_0x545251,note:_0x53c2f4,due_amount:_0x57e3c4,Room_name:_0x45666c,PO_number:_0x23cea9,SCRN:_0x296160,ReqBy:_0x2b0006,dateofreq:_0x316cba,suppliers:_0x3c857b,typeservicesData:_0x1d6ac7,van:_0x4c7f5f,typevehicle:_0x4b86c2,driver:_0x376245,plate:_0x230462,DRSI:_0x33382f,TSU:_0x21e78b,TFU:_0x5630d9,JO_number:_0x4782ad,type_of_products:_0x6ece6b}=_0x2e95c7['body'];if(typeof _0x545251==_0xbd583f(0x194))var _0x4b3c30=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x1da)]],_0x1762ac=[_0x2e95c7[_0xbd583f(0x1aa)]['prod_code']],_0x2b9fe7=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x18d)]],_0x4e7d60=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x243)]],_0x50c3b5=[_0x2e95c7[_0xbd583f(0x1aa)]['prod_secondunit']],_0x1843fd=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x1f8)]],_0x35e575=[_0x2e95c7[_0xbd583f(0x1aa)]['primary_code']],_0x51fde5=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x2a9)]],_0x530929=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x27f)]],_0x119eec=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x2ce)]],_0x2a06ff=[_0x2e95c7[_0xbd583f(0x1aa)]['expiry_date']],_0x5a0080=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x2bb)]],_0x1a2b9e=[_0x2e95c7['body'][_0xbd583f(0x1b6)]],_0x492852=[_0x2e95c7['body']['prod_cat']],_0x298042=[_0x2e95c7['body']['RoomAssign']],_0x43fd47=[_0x2e95c7['body'][_0xbd583f(0x1fa)]],_0x57f6ab=[_0x2e95c7[_0xbd583f(0x1aa)]['uuid']],_0x281125=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x23f)]],_0x21665e=[_0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x1d2)]];else var _0x4b3c30=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x1da)]],_0x1762ac=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x18e)]],_0x2b9fe7=[..._0x2e95c7[_0xbd583f(0x1aa)]['prod_Qty']],_0x4e7d60=[..._0x2e95c7['body'][_0xbd583f(0x243)]],_0x50c3b5=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x20c)]],_0x1843fd=[..._0x2e95c7[_0xbd583f(0x1aa)]['prod_level']],_0x35e575=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x294)]],_0x51fde5=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x2a9)]],_0x530929=[..._0x2e95c7[_0xbd583f(0x1aa)]['MaxStocks_data']],_0x119eec=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x2ce)]],_0x2a06ff=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x2d1)]],_0x5a0080=[..._0x2e95c7[_0xbd583f(0x1aa)]['product_date']],_0x1a2b9e=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x1b6)]],_0x492852=[..._0x2e95c7[_0xbd583f(0x1aa)]['prod_cat']],_0x298042=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x23c)]],_0x43fd47=[..._0x2e95c7['body'][_0xbd583f(0x1fa)]],_0x57f6ab=[..._0x2e95c7[_0xbd583f(0x1aa)][_0xbd583f(0x224)]],_0x281125=[..._0x2e95c7[_0xbd583f(0x1aa)]['sales_data_cateory']],_0x21665e=[..._0x2e95c7[_0xbd583f(0x1aa)]['type_of_products_type']];const _0x20b36e=_0x4b3c30['map'](_0xf7e826=>{return _0xf7e826={'product_name':_0xf7e826};});_0x21665e[_0xbd583f(0x2c9)]((_0x502dd6,_0x266cdb)=>{var _0x37147a=_0xbd583f;_0x20b36e[_0x266cdb][_0x37147a(0x187)]=_0x502dd6;}),_0x281125['forEach']((_0x27f70f,_0xe26e1d)=>{var _0x26749e=_0xbd583f;_0x20b36e[_0xe26e1d][_0x26749e(0x2a7)]=_0x27f70f;}),_0x1762ac[_0xbd583f(0x2c9)]((_0x1a3e95,_0x1be042)=>{var _0x261ad2=_0xbd583f;_0x20b36e[_0x1be042][_0x261ad2(0x1e8)]=_0x1a3e95;}),_0x57f6ab[_0xbd583f(0x2c9)]((_0x44681e,_0xe53bd7)=>{var _0x1393f1=_0xbd583f;_0x20b36e[_0xe53bd7][_0x1393f1(0x224)]=_0x44681e;}),_0x2b9fe7[_0xbd583f(0x2c9)]((_0x3b2b3c,_0x9e5e57)=>{var _0x25f219=_0xbd583f;_0x20b36e[_0x9e5e57]['quantity']=Math[_0x25f219(0x277)](_0x3b2b3c);}),_0x4e7d60[_0xbd583f(0x2c9)]((_0x5349a7,_0x284580)=>{_0x20b36e[_0x284580]['standard_unit']=_0x5349a7;}),_0x50c3b5['forEach']((_0x525ad8,_0x111f8f)=>{var _0x25a533=_0xbd583f;_0x20b36e[_0x111f8f][_0x25a533(0x1de)]=_0x525ad8;}),_0x1843fd[_0xbd583f(0x2c9)]((_0x36a395,_0x186db)=>{var _0x57dbdc=_0xbd583f,_0x493b85=_0x36a395['match'](/[A-Za-z]+/)[0x0],_0x5a1b31=parseInt(_0x36a395[_0x57dbdc(0x286)](/\d+/)[0x0]);_0x20b36e[_0x186db]['level']=_0x493b85,_0x20b36e[_0x186db][_0x57dbdc(0x1c0)]=_0x5a1b31;}),_0x35e575[_0xbd583f(0x2c9)]((_0x28d7d2,_0x2f5520)=>{var _0x1e52a0=_0xbd583f;_0x20b36e[_0x2f5520][_0x1e52a0(0x294)]=_0x28d7d2;}),_0x51fde5[_0xbd583f(0x2c9)]((_0x1d3399,_0x4104bb)=>{_0x20b36e[_0x4104bb]['secondary_code']=_0x1d3399;}),_0x530929[_0xbd583f(0x2c9)]((_0x2a1fca,_0x4648f7)=>{var _0x257af9=_0xbd583f;_0x20b36e[_0x4648f7][_0x257af9(0x24a)]=_0x2a1fca;}),_0x119eec[_0xbd583f(0x2c9)]((_0x36cb60,_0x2760cc)=>{_0x20b36e[_0x2760cc]['batch_code']=_0x36cb60;}),_0x2a06ff['forEach']((_0x22a4fa,_0x43c56e)=>{var _0x92dbec=_0xbd583f;_0x20b36e[_0x43c56e][_0x92dbec(0x2d1)]=_0x22a4fa;}),_0x5a0080[_0xbd583f(0x2c9)]((_0x5a4c34,_0x54af01)=>{var _0x3bfb7c=_0xbd583f;_0x20b36e[_0x54af01][_0x3bfb7c(0x1ff)]=_0x5a4c34;}),_0x1a2b9e[_0xbd583f(0x2c9)]((_0x460d83,_0x2ae0a9)=>{var _0x1c666c=_0xbd583f;_0x20b36e[_0x2ae0a9][_0x1c666c(0x1d1)]=_0x460d83;}),_0x492852[_0xbd583f(0x2c9)]((_0x32d632,_0x58294a)=>{var _0x1ccec2=_0xbd583f;_0x20b36e[_0x58294a][_0x1ccec2(0x221)]=_0x32d632;}),_0x298042[_0xbd583f(0x2c9)]((_0x3f57d6,_0x48612c)=>{var _0xf5c2a9=_0xbd583f;_0x20b36e[_0x48612c][_0xf5c2a9(0x29f)]=_0x3f57d6;}),_0x43fd47[_0xbd583f(0x2c9)]((_0x3e6e64,_0x463e37)=>{var _0x171348=_0xbd583f;_0x20b36e[_0x463e37][_0x171348(0x1fa)]=_0x3e6e64;});const _0x4124e2=new purchases_logs();await _0x4124e2['save']();for(let _0x3ed9f6=0x0;_0x3ed9f6<=_0x298042[_0xbd583f(0x1dd)]-0x1;_0x3ed9f6++){_0x20b36e[_0x3ed9f6][_0xbd583f(0x28f)]='LOG-INC-'+_0x4124e2[_0xbd583f(0x2ab)][_0xbd583f(0x1a7)]()[_0xbd583f(0x276)](0x8,'0');}const _0x173b98=_0x20b36e[_0xbd583f(0x2a3)](_0x587722=>_0x587722[_0xbd583f(0x1e7)]!=='0'&&_0x587722['quantity']!==''),_0x582b8d=new purchases_finished({'invoice':_0xbd583f(0x248)+_0x4124e2[_0xbd583f(0x2ab)]['toString']()[_0xbd583f(0x276)](0x8,'0'),'suppliers':_0x3c857b,'date':_0x10e4d4,'warehouse_name':_0x1b2c33,'product':_0x173b98,'note':_0x53c2f4,'due_amount':_0x57e3c4,'room':_0x45666c,'POnumber':_0x23cea9,'SCRN':_0x296160,'JO_number':_0x4782ad,'ReqBy':_0x2b0006,'dateofreq':_0x316cba,'typeservicesData':_0x1d6ac7,'van':_0x4c7f5f,'typevehicle':_0x4b86c2,'driver':_0x376245,'plate':_0x230462,'DRSI':_0x33382f,'TSU':_0x21e78b,'TFU':_0x5630d9,'typeOfProducts':_0x6ece6b}),_0x75072d=await _0x582b8d['save'](),_0x4c1cc6=await purchases_finished['findOne']({'_id':_0x75072d[_0xbd583f(0x1ba)][_0xbd583f(0x1f0)]()}),_0x37fa2e=_0x4c1cc6[_0xbd583f(0x217)][_0xbd583f(0x192)](async _0x4c1811=>{var _0x145d70=_0xbd583f;try{var _0x61f155=await warehouse[_0x145d70(0x202)]({'name':_0x1b2c33,'room':_0x4c1811[_0x145d70(0x29f)]}),_0x5dbc5a=0x0;const _0x82021f=_0x61f155[_0x145d70(0x26d)]['map'](_0x440e15=>{var _0x3205dd=_0x145d70;console[_0x3205dd(0x203)](_0x440e15['product_name']+'=='+_0x4c1811[_0x3205dd(0x2b6)]+'&&'+_0x440e15['bay']+'=='+_0x4c1811['bay']+'&&'+_0x440e15[_0x3205dd(0x2d1)]+'=='+_0x4c1811[_0x3205dd(0x2d1)]+'&&'+_0x440e15['production_date']+'=='+_0x4c1811[_0x3205dd(0x1ff)]+'&&'+_0x440e15[_0x3205dd(0x2ce)]+'=='+_0x4c1811['batch_code']+'&&'+_0x440e15[_0x3205dd(0x28f)]+'=='+_0x4c1cc6['invoice']),_0x440e15['product_name']==_0x4c1811[_0x3205dd(0x2b6)]&&_0x440e15[_0x3205dd(0x1c0)]==_0x4c1811[_0x3205dd(0x1c0)]&&_0x440e15[_0x3205dd(0x2aa)]==_0x4c1811['level']&&_0x440e15[_0x3205dd(0x2d1)]==_0x4c1811[_0x3205dd(0x2d1)]&&_0x440e15[_0x3205dd(0x1ff)]==_0x4c1811[_0x3205dd(0x1ff)]&&_0x440e15[_0x3205dd(0x2ce)]==_0x4c1811[_0x3205dd(0x2ce)]&&_0x440e15['invoice']==_0x4c1cc6[_0x3205dd(0x28f)]&&(_0x440e15[_0x3205dd(0x299)]=Math['abs'](_0x440e15[_0x3205dd(0x299)])+Math[_0x3205dd(0x277)](_0x4c1811[_0x3205dd(0x1e7)]),_0x5dbc5a++);});return _0x5dbc5a==0x0&&(_0x61f155[_0x145d70(0x26d)]=_0x61f155[_0x145d70(0x26d)]['concat']({'product_name':_0x4c1811[_0x145d70(0x2b6)],'product_stock':Math['abs'](_0x4c1811[_0x145d70(0x1e7)]),'primary_code':_0x4c1811[_0x145d70(0x294)],'secondary_code':_0x4c1811['secondary_code'],'product_code':_0x4c1811[_0x145d70(0x1e8)],'bay':_0x4c1811[_0x145d70(0x1c0)],'level':_0x4c1811['level'],'maxProducts':_0x4c1811[_0x145d70(0x24a)],'unit':_0x4c1811[_0x145d70(0x2b3)],'secondary_unit':_0x4c1811['secondary_unit'],'expiry_date':_0x4c1811['expiry_date'],'production_date':_0x4c1811[_0x145d70(0x1ff)],'maxProducts':_0x4c1811[_0x145d70(0x24a)],'maxPerUnit':_0x4c1811[_0x145d70(0x1d1)],'batch_code':_0x4c1811['batch_code'],'product_cat':_0x4c1811['product_cat'],'invoice':_0x4c1811[_0x145d70(0x28f)],'id_incoming':_0x4c1811[_0x145d70(0x1ba)],'uuid':_0x4c1811[_0x145d70(0x224)],'gross_price':_0x4c1811['gross_price'],'sales_category':_0x4c1811[_0x145d70(0x2a7)],'type_products':_0x4c1811['type_of_products']})),_0x61f155;}catch(_0x175976){return console[_0x145d70(0x1eb)]('Error\x20occurred\x20while\x20processing\x20product:',_0x175976),null;}});Promise['all'](_0x37fa2e)[_0xbd583f(0x197)](async _0x3765ed=>{var _0x29098c=_0xbd583f;try{for(const _0x797b95 of _0x3765ed){await warehouse[_0x29098c(0x1b8)]({'_id':_0x797b95[_0x29098c(0x1ba)]},{'$addToSet':{'product_details':{'$each':_0x797b95[_0x29098c(0x26d)]}}});}const _0x3781f7=await master_shop[_0x29098c(0x2c3)](),_0x4b151d=await email_settings[_0x29098c(0x202)](),_0x4181fc=await supervisor_settings[_0x29098c(0x2c3)]();var _0x4ef3f3=_0x4c1cc6[_0x29098c(0x217)],_0x431496='',_0x48b5fc;for(_0x48b5fc in _0x4ef3f3){var _0x27e355='FG';_0x4c1cc6[_0x29098c(0x1be)]==_0x29098c(0x1e5)&&(_0x27e355='DG'),_0x431496+=_0x29098c(0x25b)+_0x29098c(0x1ef)+_0x4ef3f3[_0x48b5fc]['product_name']+_0x29098c(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4ef3f3[_0x48b5fc][_0x29098c(0x1e8)]+_0x29098c(0x193)+_0x29098c(0x1ef)+_0x4ef3f3[_0x48b5fc][_0x29098c(0x1e7)]+_0x29098c(0x193)+_0x29098c(0x1ef)+_0x4ef3f3[_0x48b5fc]['standard_unit']+_0x29098c(0x193)+_0x29098c(0x1ef)+_0x4ef3f3[_0x48b5fc]['secondary_unit']+_0x29098c(0x193)+_0x29098c(0x1ef)+_0x4c1cc6[_0x29098c(0x1be)]+_0x29098c(0x193)+_0x29098c(0x1ef)+_0x4ef3f3[_0x48b5fc]['room_name']+'</td>'+_0x29098c(0x1ef)+_0x27e355+_0x4ef3f3[_0x48b5fc][_0x29098c(0x1c0)]+_0x29098c(0x193),_0x29098c(0x19b);}let _0x221707=nodemailer[_0x29098c(0x218)]({'host':_0x4b151d['host'],'port':Number(_0x4b151d[_0x29098c(0x2c7)]),'secure':![],'auth':{'user':_0x4b151d[_0x29098c(0x275)],'pass':_0x4b151d[_0x29098c(0x2cc)]}}),_0x1523b2={'from':_0x4b151d[_0x29098c(0x275)],'to':_0x4181fc[0x0][_0x29098c(0x240)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x29098c(0x2b0),'path':__dirname+_0x29098c(0x1c9)+'/upload/'+_0x3781f7[0x0]['image'],'cid':_0x29098c(0x23d)}],'html':_0x29098c(0x1dc)+_0x29098c(0x25c)+_0x29098c(0x1cf)+_0x29098c(0x2c8)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x29098c(0x1c7)+_0x29098c(0x1a5)+_0x29098c(0x2c8)+_0x29098c(0x21a)+_0x3781f7[0x0][_0x29098c(0x27c)]+'\x20</h2>'+_0x29098c(0x1a5)+'</div>'+_0x29098c(0x28d)+_0x29098c(0x2c8)+_0x29098c(0x223)+'\x20Order\x20Number\x20:\x20'+_0x4c1cc6['invoice']+'\x20'+_0x29098c(0x23a)+_0x29098c(0x183)+_0x4c1cc6['date']+'\x20'+_0x29098c(0x1a8)+'</h5>'+_0x29098c(0x1a5)+_0x29098c(0x212)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x29098c(0x26c)+_0x29098c(0x225)+_0x29098c(0x253)+_0x29098c(0x20d)+_0x29098c(0x2af)+_0x29098c(0x2ac)+_0x29098c(0x21b)+_0x29098c(0x263)+'</tr>'+_0x29098c(0x1c4)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x431496+'\x20'+'</tbody>'+'</table>'+_0x29098c(0x2c8)+_0x29098c(0x18a)+'<h5>'+_0x3781f7[0x0][_0x29098c(0x27c)]+_0x29098c(0x1e2)+_0x29098c(0x1a5)+_0x29098c(0x1a5)+'</body></html>'};_0x221707[_0x29098c(0x24f)](_0x1523b2,function(_0x4f80fb,_0x131c48){var _0x30b8f9=_0x29098c;_0x4f80fb?(console[_0x30b8f9(0x203)](_0x4f80fb),console[_0x30b8f9(0x203)](_0x30b8f9(0x2c1))):console[_0x30b8f9(0x203)]('Email\x20sent\x20successfully');});}catch(_0x3fba7d){console['error'](_0x3fba7d),_0x42171e['status'](0x1f4)[_0x29098c(0x251)]({'error':_0x29098c(0x1bf),'message':_0x3fba7d['message']});}})['catch'](_0x4800fd=>{var _0x15c0db=_0xbd583f;console[_0x15c0db(0x1eb)](_0x4800fd);}),_0x2e95c7['flash'](_0xbd583f(0x2a5),_0xbd583f(0x21e)),_0x42171e[_0xbd583f(0x2b8)](_0xbd583f(0x272)+_0x4c1cc6[_0xbd583f(0x1ba)]['valueOf']());}catch(_0x162f7b){console[_0xbd583f(0x203)](_0x162f7b);}}),router['get'](a0_0xa38023(0x2d0),auth,async(_0x4b686d,_0x3d83c7)=>{var _0x111efd=a0_0xa38023;try{const {username:_0x2996ac,email:_0x439b02,role:_0x171f30}=_0x4b686d[_0x111efd(0x264)],_0xb24636=_0x4b686d['user'],_0x2a8b40=await profile[_0x111efd(0x202)]({'email':_0xb24636['email']}),_0x3cbf82=await master_shop[_0x111efd(0x2c3)](),_0x3164e5=_0x4b686d[_0x111efd(0x266)]['id'],_0x4ddbea=await purchases_finished[_0x111efd(0x239)](_0x3164e5),_0x69d82b=await suppliers[_0x111efd(0x2c3)]({});let _0x5a0caa;if(_0xb24636[_0x111efd(0x1bd)]==_0x111efd(0x292)){const _0x5f203c=await staff[_0x111efd(0x202)]({'email':_0xb24636[_0x111efd(0x275)]});_0x5a0caa=await warehouse[_0x111efd(0x2c3)]({'status':_0x111efd(0x24b),'name':_0x5f203c['warehouse'],'warehouse_category':_0x111efd(0x289)});}else _0x5a0caa=await warehouse[_0x111efd(0x1cc)]([{'$match':{'status':_0x111efd(0x24b),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x111efd(0x20e),'name':{'$first':_0x111efd(0x20e)}}}]);const _0x275151=await product[_0x111efd(0x2c3)]({}),_0xf1d79f=BayBinSelected(_0x4ddbea[_0x111efd(0x1be)],_0x4ddbea['room']);let _0x29af8d=new Date(_0x4ddbea[_0x111efd(0x2d1)]),_0x5e401b=('0'+_0x29af8d[_0x111efd(0x201)]())[_0x111efd(0x25d)](-0x2),_0x4bba61=('0'+(_0x29af8d[_0x111efd(0x262)]()+0x1))[_0x111efd(0x25d)](-0x2),_0x17d8f1=_0x29af8d[_0x111efd(0x2bd)](),_0x1969a7=_0x17d8f1+'-'+_0x4bba61+'-'+_0x5e401b;if(_0x3cbf82[0x0][_0x111efd(0x1ad)]==_0x111efd(0x1a6)){var _0x165270=users[_0x111efd(0x2a6)];console[_0x111efd(0x203)](_0x165270);}else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]=='Hindi')var _0x165270=users[_0x111efd(0x235)];else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]==_0x111efd(0x200))var _0x165270=users[_0x111efd(0x200)];else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]==_0x111efd(0x245))var _0x165270=users[_0x111efd(0x245)];else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]==_0x111efd(0x19f))var _0x165270=users[_0x111efd(0x19f)];else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]==_0x111efd(0x284))var _0x165270=users['Portuguese'];else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]=='Chinese')var _0x165270=users[_0x111efd(0x246)];else{if(_0x3cbf82[0x0][_0x111efd(0x1ad)]=='Arabic\x20(ae)')var _0x165270=users[_0x111efd(0x1fe)];}}}}}}}_0x3d83c7[_0x111efd(0x2be)](_0x111efd(0x283),{'success':_0x4b686d[_0x111efd(0x1a3)](_0x111efd(0x2a5)),'errors':_0x4b686d[_0x111efd(0x1a3)]('errors'),'role':_0xb24636,'profile':_0x2a8b40,'purchases':_0x4ddbea,'suppliers':_0x69d82b,'warehouse':_0x5a0caa,'product':_0x275151,'master_shop':_0x3cbf82,'language':_0x165270,'ed_fullDate':_0x1969a7,'dataSelected':_0xf1d79f});}catch(_0x3401c7){console[_0x111efd(0x203)](_0x3401c7);}}),router[a0_0xa38023(0x29c)]('/view/:id',auth,async(_0x5e86c4,_0x5059e2)=>{var _0x2ec8ac=a0_0xa38023;try{const {username:_0x22aaff,email:_0x38ab32,role:_0x2d0c7b}=_0x5e86c4[_0x2ec8ac(0x264)],_0x14e792=_0x5e86c4['user'],_0x2b85c3=await profile['findOne']({'email':_0x14e792[_0x2ec8ac(0x275)]}),_0x4d4556=await master_shop['find'](),_0x42df86=_0x5e86c4[_0x2ec8ac(0x266)]['id'],_0x27b31c=await purchases_finished[_0x2ec8ac(0x239)](_0x42df86),_0x287e99=await suppliers[_0x2ec8ac(0x2c3)]({});let _0x38cbf4;if(_0x14e792[_0x2ec8ac(0x1bd)]==_0x2ec8ac(0x292)){const _0x2a1c02=await staff[_0x2ec8ac(0x202)]({'email':_0x14e792[_0x2ec8ac(0x275)]});_0x38cbf4=await warehouse['find']({'status':'Enabled','name':_0x2a1c02[_0x2ec8ac(0x2c5)],'warehouse_category':_0x2ec8ac(0x289)});}else _0x38cbf4=await warehouse[_0x2ec8ac(0x1cc)]([{'$match':{'status':_0x2ec8ac(0x24b),'warehouse_category':_0x2ec8ac(0x289)}},{'$group':{'_id':'$name','name':{'$first':_0x2ec8ac(0x20e)}}}]);const _0x579d8e=await product[_0x2ec8ac(0x2c3)]({}),_0x60f787=BayBinSelected(_0x27b31c[_0x2ec8ac(0x1be)],_0x27b31c[_0x2ec8ac(0x270)]);let _0x11b3d4=new Date(_0x27b31c[_0x2ec8ac(0x2d1)]),_0x5a3ca7=('0'+_0x11b3d4[_0x2ec8ac(0x201)]())['slice'](-0x2),_0x10b85c=('0'+(_0x11b3d4['getMonth']()+0x1))['slice'](-0x2),_0x1210a5=_0x11b3d4[_0x2ec8ac(0x2bd)](),_0x31d37a=_0x1210a5+'-'+_0x10b85c+'-'+_0x5a3ca7;if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x1a6)){var _0x1f2c93=users['English'];console[_0x2ec8ac(0x203)](_0x1f2c93);}else{if(_0x4d4556[0x0]['language']==_0x2ec8ac(0x235))var _0x1f2c93=users[_0x2ec8ac(0x235)];else{if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x200))var _0x1f2c93=users[_0x2ec8ac(0x200)];else{if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x245))var _0x1f2c93=users['Spanish'];else{if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x19f))var _0x1f2c93=users[_0x2ec8ac(0x19f)];else{if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x284))var _0x1f2c93=users[_0x2ec8ac(0x213)];else{if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x246))var _0x1f2c93=users[_0x2ec8ac(0x246)];else{if(_0x4d4556[0x0][_0x2ec8ac(0x1ad)]==_0x2ec8ac(0x22a))var _0x1f2c93=users[_0x2ec8ac(0x1fe)];}}}}}}}_0x5059e2[_0x2ec8ac(0x2be)](_0x2ec8ac(0x244),{'success':_0x5e86c4[_0x2ec8ac(0x1a3)](_0x2ec8ac(0x2a5)),'errors':_0x5e86c4['flash'](_0x2ec8ac(0x1c5)),'role':_0x14e792,'profile':_0x2b85c3,'purchases':_0x27b31c,'suppliers':_0x287e99,'warehouse':_0x38cbf4,'product':_0x579d8e,'master_shop':_0x4d4556,'language':_0x1f2c93,'ed_fullDate':_0x31d37a,'dataSelected':_0x60f787});}catch(_0x16a91e){console[_0x2ec8ac(0x203)](_0x16a91e);}}),router[a0_0xa38023(0x1d0)](a0_0xa38023(0x226),auth,async(_0x4e01e0,_0x218f45)=>{var _0x4687b4=a0_0xa38023;try{const _0x5c0eaf=_0x4e01e0['params']['id'],_0x1f1d60=await purchases_finished[_0x4687b4(0x202)]({'_id':_0x4e01e0[_0x4687b4(0x266)]['id']}),_0xf6254d=await warehouse['findOne']({'name':_0x1f1d60[_0x4687b4(0x1be)],'room':_0x1f1d60[_0x4687b4(0x270)]});_0x1f1d60[_0x4687b4(0x217)][_0x4687b4(0x2c9)](_0x32f8ea=>{var _0x56d75d=_0x4687b4;const _0x519ef0=_0xf6254d[_0x56d75d(0x26d)][_0x56d75d(0x192)](_0x3b738e=>{var _0x3459fb=_0x56d75d;_0x3b738e[_0x3459fb(0x2b6)]==_0x32f8ea[_0x3459fb(0x2b6)]&&_0x3b738e[_0x3459fb(0x1c0)]==_0x32f8ea[_0x3459fb(0x1c0)]&&(_0x3b738e['product_stock']=parseInt(_0x3b738e[_0x3459fb(0x299)])-parseInt(_0x32f8ea[_0x3459fb(0x1e7)]));});}),await _0xf6254d[_0x4687b4(0x279)]();const {invoice:_0x1d11e5,suppliers:_0x59c6a2,date:_0x45163c,warehouse_name:_0x1a5164,prod_name:_0x4b6e75,prod_code:_0x490623,prod_qty:_0x89081,prod_unit:_0x5c71bb,prod_secondunit:_0x5e5beb,prod_level:_0x511727,prod_isle:_0xbda754,prod_pallet:_0x2faf59,note:_0x3061f8,expiry_date:_0x1aa289,batch_code:_0x3f78f6,paid_amount:_0x60e01f,due_amount:_0x7595a5,Room_name:_0x440d5d,primary_code:_0x18c5ab,secondary_code:_0x510ecf,PO_number:_0x2d797c,JO_number:_0x49cf95}=_0x4e01e0[_0x4687b4(0x1aa)];if(typeof _0x4b6e75==_0x4687b4(0x194))var _0x24c6b1=[_0x4e01e0['body']['prod_name']],_0x2fe86b=[_0x4e01e0['body'][_0x4687b4(0x18e)]],_0x1dad36=[_0x4e01e0['body']['prod_qty']],_0x3e17e4=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x25e)]],_0x385cd8=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x20c)]],_0x345776=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x1f8)]],_0x5f5d95=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x294)]],_0x28d803=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x2a9)]],_0x191974=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x27f)]],_0x1b5d6c=[_0x4e01e0['body'][_0x4687b4(0x2ce)]],_0x519db0=[_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x2d1)]];else var _0x24c6b1=[..._0x4e01e0[_0x4687b4(0x1aa)]['prod_name']],_0x2fe86b=[..._0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x18e)]],_0x1dad36=[..._0x4e01e0['body'][_0x4687b4(0x2cb)]],_0x3e17e4=[..._0x4e01e0[_0x4687b4(0x1aa)]['prod_unit']],_0x385cd8=[..._0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x20c)]],_0x345776=[..._0x4e01e0['body'][_0x4687b4(0x1f8)]],_0x5f5d95=[..._0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x294)]],_0x28d803=[..._0x4e01e0[_0x4687b4(0x1aa)]['secondary_code']],_0x191974=[..._0x4e01e0['body']['MaxStocks_data']],_0x1b5d6c=[..._0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x2ce)]],_0x519db0=[..._0x4e01e0['body']['expiry_date']];const _0x44ccc7=_0x24c6b1[_0x4687b4(0x192)](_0x3aa78c=>{return _0x3aa78c={'product_name':_0x3aa78c};});_0x2fe86b[_0x4687b4(0x2c9)]((_0x6ebb4e,_0x389128)=>{var _0x166949=_0x4687b4;_0x44ccc7[_0x389128][_0x166949(0x1e8)]=_0x6ebb4e;}),_0x1dad36[_0x4687b4(0x2c9)]((_0x2632d0,_0x1bf661)=>{var _0x2ddc02=_0x4687b4;_0x44ccc7[_0x1bf661][_0x2ddc02(0x1e7)]=_0x2632d0;}),_0x3e17e4[_0x4687b4(0x2c9)]((_0x30f88e,_0x40d5ce)=>{_0x44ccc7[_0x40d5ce]['standard_unit']=_0x30f88e;}),_0x385cd8[_0x4687b4(0x2c9)]((_0x45ca78,_0x4867c3)=>{var _0x150766=_0x4687b4;_0x44ccc7[_0x4867c3][_0x150766(0x1de)]=_0x45ca78;}),_0x345776[_0x4687b4(0x2c9)]((_0x56a90e,_0x3b999c)=>{var _0x2a5c24=_0x4687b4;_0x44ccc7[_0x3b999c][_0x2a5c24(0x1c0)]=_0x56a90e;}),_0x5f5d95[_0x4687b4(0x2c9)]((_0xe819b9,_0x3ed7f0)=>{var _0x2cd33d=_0x4687b4;_0x44ccc7[_0x3ed7f0][_0x2cd33d(0x294)]=_0xe819b9;}),_0x28d803['forEach']((_0x3c40e1,_0x3a39df)=>{var _0x9725d2=_0x4687b4;_0x44ccc7[_0x3a39df][_0x9725d2(0x2a9)]=_0x3c40e1;}),_0x191974[_0x4687b4(0x2c9)]((_0xc5acb5,_0x525f12)=>{_0x44ccc7[_0x525f12]['maxStocks']=_0xc5acb5;}),_0x1b5d6c[_0x4687b4(0x2c9)]((_0x30c548,_0xfb3fe)=>{var _0x4927b3=_0x4687b4;_0x44ccc7[_0xfb3fe][_0x4927b3(0x2ce)]=_0x30c548;}),_0x519db0['forEach']((_0x28cb81,_0x7547dd)=>{_0x44ccc7[_0x7547dd]['expiry_date']=_0x28cb81;});const _0x54494d=_0x44ccc7[_0x4687b4(0x2a3)](_0x499253=>_0x499253[_0x4687b4(0x1e7)]!=='0'&&_0x499253[_0x4687b4(0x1e7)]!=='');_0x1f1d60['invoice']=_0x1d11e5,_0x1f1d60[_0x4687b4(0x20a)]=_0x59c6a2,_0x1f1d60[_0x4687b4(0x17f)]=_0x45163c,_0x1f1d60[_0x4687b4(0x1be)]=_0x1a5164,_0x1f1d60['product']=_0x54494d,_0x1f1d60[_0x4687b4(0x255)]=_0x3061f8,_0x1f1d60[_0x4687b4(0x1a2)]=_0x60e01f,_0x1f1d60[_0x4687b4(0x2c6)]=_0x7595a5,_0x1f1d60[_0x4687b4(0x270)]=_0x440d5d,_0x1f1d60[_0x4687b4(0x1ae)]=_0x2d797c,_0x1f1d60[_0x4687b4(0x209)]=_0x49cf95;const _0x1b7904=await _0x1f1d60[_0x4687b4(0x279)](),_0x298bc4=await warehouse[_0x4687b4(0x202)]({'name':_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x1be)],'room':_0x4e01e0[_0x4687b4(0x1aa)][_0x4687b4(0x1d7)]});_0x1f1d60[_0x4687b4(0x217)][_0x4687b4(0x2c9)](_0x51c629=>{var _0x2d0775=_0x4687b4,_0x15fd0c=0x0;const _0x4d9dd3=_0x298bc4[_0x2d0775(0x26d)][_0x2d0775(0x192)](_0xb7218b=>{var _0x2eaf10=_0x2d0775;_0xb7218b[_0x2eaf10(0x2b6)]==_0x51c629[_0x2eaf10(0x2b6)]&&_0xb7218b[_0x2eaf10(0x1c0)]==_0x51c629[_0x2eaf10(0x1c0)]&&(_0xb7218b['product_stock']=parseInt(_0xb7218b[_0x2eaf10(0x299)])+parseInt(_0x51c629['quantity']),_0x15fd0c++);});_0x15fd0c=='0'&&(_0x298bc4[_0x2d0775(0x26d)]=_0x298bc4[_0x2d0775(0x26d)][_0x2d0775(0x2d3)]({'product_name':_0x51c629[_0x2d0775(0x2b6)],'product_stock':_0x51c629[_0x2d0775(0x1e7)],'primary_code':_0x51c629[_0x2d0775(0x294)],'secondary_code':_0x51c629[_0x2d0775(0x2a9)],'product_code':_0x51c629[_0x2d0775(0x1e8)],'bay':_0x51c629[_0x2d0775(0x1c0)],'maxProducts':_0x51c629[_0x2d0775(0x24a)],'unit':_0x51c629[_0x2d0775(0x2b3)],'secondary_unit':_0x51c629[_0x2d0775(0x1de)],'expiry_date':_0x51c629[_0x2d0775(0x2d1)]}));}),await _0x298bc4['save']();const _0x392574=await s_payment_data[_0x4687b4(0x202)]({'invoice':_0x4e01e0['body'][_0x4687b4(0x28f)]});if(_0x392574===null){}else console[_0x4687b4(0x203)]('suppliers',_0x392574,_0x4e01e0[_0x4687b4(0x1aa)]['invoice']),_0x392574[_0x4687b4(0x20a)]=_0x4e01e0['body'][_0x4687b4(0x20a)],await _0x392574[_0x4687b4(0x279)]();_0x4e01e0[_0x4687b4(0x1a3)](_0x4687b4(0x2a5),_0x4687b4(0x210)),_0x218f45[_0x4687b4(0x2b8)]('/all_purchases_finished/view');}catch(_0x643c78){console['log'](_0x643c78);}}),router[a0_0xa38023(0x1d0)](a0_0xa38023(0x291),auth,async(_0x2609ef,_0x47da2a)=>{var _0x524f25=a0_0xa38023;try{const _0x15a971=_0x2609ef['params']['id'],{invoice:_0x1dffef,suppliers:_0x51f7c2,payable:_0x3ba1e2,due_amount:_0x3bc489}=_0x2609ef['body'],_0x4a63c8=await purchases['findById'](_0x15a971);var _0x516d19=_0x3ba1e2-_0x3bc489;_0x4a63c8[_0x524f25(0x1a2)]=parseFloat(_0x4a63c8[_0x524f25(0x1a2)])+parseFloat(_0x3bc489),_0x4a63c8[_0x524f25(0x2c6)]=_0x516d19;const _0x3dff76=await _0x4a63c8['save']();console['log'](_0x3dff76);const _0x3f6c73=await s_payment_data['findOne']({'invoice':_0x1dffef});_0x3f6c73['amount']=_0x516d19,await _0x3f6c73[_0x524f25(0x279)]();let _0x346bbd=new Date(),_0x3e6024=('0'+_0x346bbd[_0x524f25(0x201)]())['slice'](-0x2),_0x5142c7=('0'+(_0x346bbd[_0x524f25(0x262)]()+0x1))[_0x524f25(0x25d)](-0x2),_0x38c9aa=_0x346bbd['getFullYear'](),_0x48d652=_0x38c9aa+'-'+_0x5142c7+'-'+_0x3e6024;const _0x5e6553=new suppliers_payment({'invoice':_0x1dffef,'date':_0x38c9aa+'-'+_0x5142c7+'-'+_0x3e6024,'suppliers':_0x51f7c2,'reason':_0x524f25(0x206),'amount':_0x3bc489}),_0x1c4ad8=await _0x5e6553[_0x524f25(0x279)]();_0x2609ef[_0x524f25(0x1a3)](_0x524f25(0x2a5),_0x524f25(0x215)),_0x47da2a['redirect']('/all_purchases/view');}catch(_0x148a18){console[_0x524f25(0x203)](_0x148a18);}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x1ab),auth,async(_0x124a12,_0x3d81e9)=>{var _0xa248af=a0_0xa38023;try{const {username:_0x3b5fe2,email:_0x335dea,role:_0x2ec943}=_0x124a12['user'],_0x1c0e55=_0x124a12['user'],_0x404113=await profile[_0xa248af(0x202)]({'email':_0x1c0e55[_0xa248af(0x275)]}),_0x11af8e=await master_shop[_0xa248af(0x2c3)]();console[_0xa248af(0x203)](_0xa248af(0x232),_0x11af8e);const _0x23b53d=_0x124a12[_0xa248af(0x266)]['id'],_0x4b6ea7=await purchases['findById'](_0x23b53d);console[_0xa248af(0x203)](_0x4b6ea7);const _0x432212=await suppliers['findOne']({'name':_0x4b6ea7[_0xa248af(0x20a)]});console[_0xa248af(0x203)](_0x432212);if(_0x11af8e[0x0][_0xa248af(0x1ad)]==_0xa248af(0x1a6)){var _0x4b0f19=users[_0xa248af(0x2a6)];console['log'](_0x4b0f19);}else{if(_0x11af8e[0x0][_0xa248af(0x1ad)]=='Hindi')var _0x4b0f19=users[_0xa248af(0x235)];else{if(_0x11af8e[0x0]['language']==_0xa248af(0x200))var _0x4b0f19=users[_0xa248af(0x200)];else{if(_0x11af8e[0x0][_0xa248af(0x1ad)]==_0xa248af(0x245))var _0x4b0f19=users[_0xa248af(0x245)];else{if(_0x11af8e[0x0][_0xa248af(0x1ad)]=='French')var _0x4b0f19=users[_0xa248af(0x19f)];else{if(_0x11af8e[0x0][_0xa248af(0x1ad)]==_0xa248af(0x284))var _0x4b0f19=users[_0xa248af(0x213)];else{if(_0x11af8e[0x0][_0xa248af(0x1ad)]==_0xa248af(0x246))var _0x4b0f19=users[_0xa248af(0x246)];else{if(_0x11af8e[0x0][_0xa248af(0x1ad)]==_0xa248af(0x22a))var _0x4b0f19=users[_0xa248af(0x1fe)];}}}}}}}_0x3d81e9[_0xa248af(0x2be)]('purchase_invoice',{'success':_0x124a12[_0xa248af(0x1a3)](_0xa248af(0x2a5)),'errors':_0x124a12[_0xa248af(0x1a3)]('errors'),'role':_0x1c0e55,'profile':_0x404113,'master_shop':_0x11af8e,'supplier':_0x432212,'purchase':_0x4b6ea7,'language':_0x4b0f19});}catch(_0x113cef){console[_0xa248af(0x203)](_0x113cef);}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x208),auth,async(_0x1e47f3,_0x2f87c2)=>{var _0x277d77=a0_0xa38023;try{const {username:_0x23ba66,email:_0x5cf1f7,role:_0x45479}=_0x1e47f3[_0x277d77(0x264)],_0x4a18c2=_0x1e47f3['user'],_0x4a11b1=await profile[_0x277d77(0x202)]({'email':_0x4a18c2[_0x277d77(0x275)]}),_0x1a4b6c=await master_shop[_0x277d77(0x2c3)]();console['log'](_0x277d77(0x232),_0x1a4b6c);const _0x3ba875=_0x1e47f3[_0x277d77(0x266)]['id'];console['log'](_0x3ba875);const _0x5a4cfd=await purchases_finished[_0x277d77(0x239)](_0x3ba875);console[_0x277d77(0x203)]('user_id',_0x5a4cfd);const _0x2b27f5=await product['find']({}),_0x3b6423=await warehouse['aggregate']([{'$match':{'name':_0x5a4cfd[_0x277d77(0x1be)],'room':_0x5a4cfd[_0x277d77(0x270)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x277d77(0x229),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x277d77(0x204)},'bay':{'$first':_0x277d77(0x195)},'bin':{'$first':_0x277d77(0x20f)},'type':{'$first':_0x277d77(0x28b)},'floorlevel':{'$first':_0x277d77(0x1af)},'primary_code':{'$first':_0x277d77(0x257)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x277d77(0x2b2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x277d77(0x203)](_0x277d77(0x233),_0x3b6423);let _0x3b4e87;if(_0x4a18c2[_0x277d77(0x1bd)]==_0x277d77(0x292)){const _0x42fcbc=await staff[_0x277d77(0x202)]({'email':_0x4a18c2[_0x277d77(0x275)]});_0x3b4e87=await warehouse[_0x277d77(0x2c3)]({'status':_0x277d77(0x24b),'name':_0x42fcbc[_0x277d77(0x2c5)],'warehouse_category':'Finished\x20Goods','name':_0x277d77(0x2cf)});}else _0x3b4e87=await warehouse[_0x277d77(0x1cc)]([{'$match':{'status':_0x277d77(0x24b),'warehouse_category':_0x277d77(0x289),'name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x277d77(0x20e)}}}]);if(_0x1a4b6c[0x0][_0x277d77(0x1ad)]==_0x277d77(0x1a6)){var _0x62a3f4=users['English'];console[_0x277d77(0x203)](_0x62a3f4);}else{if(_0x1a4b6c[0x0][_0x277d77(0x1ad)]=='Hindi')var _0x62a3f4=users['Hindi'];else{if(_0x1a4b6c[0x0][_0x277d77(0x1ad)]==_0x277d77(0x200))var _0x62a3f4=users[_0x277d77(0x200)];else{if(_0x1a4b6c[0x0][_0x277d77(0x1ad)]==_0x277d77(0x245))var _0x62a3f4=users[_0x277d77(0x245)];else{if(_0x1a4b6c[0x0][_0x277d77(0x1ad)]==_0x277d77(0x19f))var _0x62a3f4=users[_0x277d77(0x19f)];else{if(_0x1a4b6c[0x0]['language']==_0x277d77(0x284))var _0x62a3f4=users['Portuguese'];else{if(_0x1a4b6c[0x0]['language']==_0x277d77(0x246))var _0x62a3f4=users[_0x277d77(0x246)];else{if(_0x1a4b6c[0x0][_0x277d77(0x1ad)]==_0x277d77(0x22a))var _0x62a3f4=users[_0x277d77(0x1fe)];}}}}}}}_0x2f87c2[_0x277d77(0x2be)](_0x277d77(0x1ca),{'success':_0x1e47f3[_0x277d77(0x1a3)](_0x277d77(0x2a5)),'errors':_0x1e47f3[_0x277d77(0x1a3)](_0x277d77(0x1c5)),'role':_0x4a18c2,'profile':_0x4a11b1,'user':_0x5a4cfd,'stock':_0x3b6423,'master_shop':_0x1a4b6c,'product':_0x2b27f5,'language':_0x62a3f4,'warehouse':_0x3b4e87});}catch(_0x196277){console[_0x277d77(0x203)](_0x196277);}}),router[a0_0xa38023(0x1d0)](a0_0xa38023(0x208),auth,async(_0x4befeb,_0x2f2809)=>{var _0x3eb2a3=a0_0xa38023;try{const {invoice:_0x29ab4f,date:_0x51de08,warehouse_name:_0x50ee62,Room_name:_0x3f0bf2,product_name:_0x2cc4f6,purchase_quantity:_0x1aea34,stocks:_0x382a7a,return_qty:_0x94455b,note:_0x466a33,level:_0x5b2525,isle:_0x1e0e24,pallet:_0x606a6d,to_warehouse_name:_0x412a42,to_Room_name:_0x230fa4}=_0x4befeb['body'],_0x53b1da=await purchases_finished[_0x3eb2a3(0x202)]({'_id':_0x4befeb[_0x3eb2a3(0x266)]['id']}),_0x45bda7=await warehouse['findOne']({'name':_0x50ee62,'room':_0x3f0bf2,'warehouse_category':_0x3eb2a3(0x289)});if(typeof _0x2cc4f6==_0x3eb2a3(0x194))var _0x3bdac5=[_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x2b6)]],_0x44e569=[_0x4befeb['body'][_0x3eb2a3(0x22b)]],_0x2b1a23=[_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x2bc)]],_0x23f99b=[_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x1cb)]],_0x6cf0f2=[_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x2aa)]],_0x2514ce=[_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x22f)]],_0x2e5330=[_0x4befeb['body'][_0x3eb2a3(0x22e)]],_0x26b389=[_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x230)]];else var _0x3bdac5=[..._0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x2b6)]],_0x44e569=[..._0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x22b)]],_0x2b1a23=[..._0x4befeb[_0x3eb2a3(0x1aa)]['stocks']],_0x23f99b=[..._0x4befeb['body'][_0x3eb2a3(0x1cb)]],_0x6cf0f2=[..._0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x2aa)]],_0x2514ce=[..._0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x22f)]],_0x2e5330=[..._0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x22e)]],_0x26b389=[..._0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x230)]];const _0x178db0=_0x3bdac5['map'](_0x2b2ebe=>{return _0x2b2ebe={'product_name':_0x2b2ebe};});_0x44e569[_0x3eb2a3(0x2c9)]((_0x4f0fff,_0x597307)=>{_0x178db0[_0x597307]['purchase_quantity']=_0x4f0fff;}),_0x2b1a23[_0x3eb2a3(0x2c9)]((_0xa546bf,_0x4b513c)=>{var _0x491afb=_0x3eb2a3;_0x178db0[_0x4b513c][_0x491afb(0x1e1)]=_0xa546bf;}),_0x23f99b[_0x3eb2a3(0x2c9)]((_0x518f5c,_0x4989d8)=>{var _0x268b63=_0x3eb2a3;_0x178db0[_0x4989d8][_0x268b63(0x1cb)]=_0x518f5c;}),_0x6cf0f2['forEach']((_0x5f3f5b,_0xa54931)=>{var _0x2623ec=_0x3eb2a3;_0x178db0[_0xa54931][_0x2623ec(0x1c0)]=_0x5f3f5b;}),_0x2514ce[_0x3eb2a3(0x2c9)]((_0x38ddee,_0x1182f2)=>{var _0x59ac66=_0x3eb2a3;_0x178db0[_0x1182f2][_0x59ac66(0x1e8)]=_0x38ddee;}),_0x2e5330[_0x3eb2a3(0x2c9)]((_0x18c79b,_0x29080d)=>{var _0x33b50a=_0x3eb2a3;_0x178db0[_0x29080d][_0x33b50a(0x294)]=_0x18c79b;}),_0x26b389['forEach']((_0x5e661c,_0x305b6d)=>{var _0x47a90a=_0x3eb2a3;_0x178db0[_0x305b6d][_0x47a90a(0x2a9)]=_0x5e661c;}),_0x178db0[_0x3eb2a3(0x2c9)](_0x4fd1f2=>{var _0x3da68a=_0x3eb2a3;console[_0x3da68a(0x203)](_0x4fd1f2);const _0x1e299c=_0x45bda7[_0x3da68a(0x26d)][_0x3da68a(0x192)](_0x25915e=>{var _0x5b6d4d=_0x3da68a;_0x25915e[_0x5b6d4d(0x2b6)]==_0x4fd1f2[_0x5b6d4d(0x2b6)]&&_0x25915e['bay']==_0x4fd1f2[_0x5b6d4d(0x1c0)]&&(console[_0x5b6d4d(0x203)](parseInt(_0x25915e['product_stock'])+_0x5b6d4d(0x1a0)+parseInt(_0x4fd1f2['return_qty'])),_0x25915e[_0x5b6d4d(0x299)]=parseInt(_0x25915e[_0x5b6d4d(0x299)])-parseInt(_0x4fd1f2[_0x5b6d4d(0x1cb)]));});}),await _0x45bda7[_0x3eb2a3(0x279)]();var _0x4cfbcb=0x0;_0x178db0[_0x3eb2a3(0x2c9)](_0xcf314e=>{var _0x11c7a8=_0x3eb2a3;(parseInt(_0xcf314e[_0x11c7a8(0x22b)])<parseInt(_0xcf314e[_0x11c7a8(0x1cb)])||parseInt(_0xcf314e[_0x11c7a8(0x1e1)])<parseInt(_0xcf314e[_0x11c7a8(0x1cb)]))&&_0x4cfbcb++;});if(_0x4cfbcb!=0x0)return _0x4befeb[_0x3eb2a3(0x1a3)](_0x3eb2a3(0x1c5),_0x3eb2a3(0x1d6)),_0x2f2809[_0x3eb2a3(0x2b8)](_0x3eb2a3(0x2ae));const _0x4ca416=new purchases_return_finished({'invoice':_0x29ab4f,'suppliers':_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x20a)],'date':_0x51de08,'warehouse_name':_0x50ee62,'return_product':_0x178db0,'note':_0x466a33,'room':_0x3f0bf2,'to_warehouse_name':_0x412a42,'to_room':_0x230fa4}),_0x59c91e=await _0x4ca416[_0x3eb2a3(0x279)](),_0x4dd647=await purchases_return_finished[_0x3eb2a3(0x202)]({'invoice':_0x29ab4f}),_0x212f7e=await warehouse[_0x3eb2a3(0x202)]({'name':_0x412a42,'room':_0x230fa4,'warehouse_category':_0x3eb2a3(0x289)});_0x4dd647[_0x3eb2a3(0x249)][_0x3eb2a3(0x2c9)](_0x337dce=>{var _0x218b32=_0x3eb2a3,_0x1c92e0=0x0;const _0x3600c8=_0x212f7e[_0x218b32(0x26d)][_0x218b32(0x192)](_0x5ed263=>{var _0x24e43e=_0x218b32;console[_0x24e43e(0x203)](_0x5ed263[_0x24e43e(0x2b6)]+'=='+_0x337dce['product_name']+'&&'+_0x5ed263['bay']+'=='+_0x337dce[_0x24e43e(0x1c0)]),_0x5ed263[_0x24e43e(0x2b6)]==_0x337dce[_0x24e43e(0x2b6)]&&_0x5ed263[_0x24e43e(0x1c0)]==_0x337dce[_0x24e43e(0x1c0)]&&(_0x5ed263[_0x24e43e(0x299)]=parseInt(_0x5ed263[_0x24e43e(0x299)])-parseInt(_0x337dce[_0x24e43e(0x1cb)]),_0x1c92e0++);});_0x1c92e0=='0'&&(_0x212f7e['product_details']=_0x212f7e[_0x218b32(0x26d)]['concat']({'product_name':_0x337dce[_0x218b32(0x2b6)],'product_stock':_0x337dce[_0x218b32(0x1cb)],'primary_code':_0x337dce['primary_code'],'secondary_code':_0x337dce['secondary_code'],'product_code':_0x337dce[_0x218b32(0x1e8)],'bay':_0x337dce[_0x218b32(0x1c0)],'maxProducts':0xf423f}));}),await _0x212f7e[_0x3eb2a3(0x279)]();const _0x4a904d=await purchases_finished['findOne']({'invoice':_0x29ab4f});_0x4a904d[_0x3eb2a3(0x273)]=_0x3eb2a3(0x1bb);const _0x8484d5=await _0x4a904d['save'](),_0x140d36=new s_payment_data({'invoice':_0x29ab4f,'suppliers':_0x4befeb[_0x3eb2a3(0x1aa)][_0x3eb2a3(0x20a)],'reason':'Purchase\x20Return'});await _0x140d36[_0x3eb2a3(0x279)]();const _0x184d47=await master_shop[_0x3eb2a3(0x2c3)](),_0x1d41d0=await email_settings[_0x3eb2a3(0x202)](),_0x2dbed0=await suppliers[_0x3eb2a3(0x202)]({'name':_0x4befeb['body'][_0x3eb2a3(0x20a)]});_0x184d47[0x0][_0x3eb2a3(0x29e)]==0x1?(right_currency=_0x184d47[0x0][_0x3eb2a3(0x280)],left_currency=''):(right_currency='',left_currency=_0x184d47[0x0][_0x3eb2a3(0x280)]);var _0x2d933a=_0x3bdac5,_0x312611=_0x23f99b,_0x561981='',_0x2d4de1;for(_0x2d4de1 in _0x2d933a){_0x561981+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d933a[_0x2d4de1]+_0x3eb2a3(0x193)+_0x3eb2a3(0x1ef)+_0x312611[_0x2d4de1]+_0x3eb2a3(0x193)+_0x3eb2a3(0x19b);}let _0x52413a=nodemailer[_0x3eb2a3(0x218)]({'service':_0x3eb2a3(0x24e),'auth':{'user':_0x1d41d0[_0x3eb2a3(0x275)],'pass':_0x1d41d0['password']}}),_0x4d0710={'from':_0x1d41d0[_0x3eb2a3(0x275)],'to':_0x2dbed0[_0x3eb2a3(0x275)],'subject':_0x3eb2a3(0x1b2),'attachments':[{'filename':_0x3eb2a3(0x2b0),'path':__dirname+_0x3eb2a3(0x1c9)+_0x3eb2a3(0x1d8)+_0x184d47[0x0][_0x3eb2a3(0x20b)],'cid':_0x3eb2a3(0x23d)}],'html':_0x3eb2a3(0x1dc)+_0x3eb2a3(0x25c)+_0x3eb2a3(0x1cf)+_0x3eb2a3(0x2c8)+_0x3eb2a3(0x191)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3eb2a3(0x1a5)+_0x3eb2a3(0x2c8)+'<h2>\x20'+_0x184d47[0x0][_0x3eb2a3(0x27c)]+'\x20</h2>'+_0x3eb2a3(0x1a5)+_0x3eb2a3(0x1a5)+_0x3eb2a3(0x28d)+'<div>'+_0x3eb2a3(0x223)+_0x3eb2a3(0x28e)+_0x29ab4f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3eb2a3(0x183)+_0x51de08+'\x20'+_0x3eb2a3(0x1a8)+_0x3eb2a3(0x1e2)+_0x3eb2a3(0x1a5)+_0x3eb2a3(0x212)+_0x3eb2a3(0x241)+_0x3eb2a3(0x25b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x3eb2a3(0x1a4)+_0x3eb2a3(0x216)+_0x3eb2a3(0x180)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x561981+'\x20'+'</tbody>'+_0x3eb2a3(0x1ed)+_0x3eb2a3(0x2c8)+_0x3eb2a3(0x18a)+_0x3eb2a3(0x2a4)+_0x184d47[0x0][_0x3eb2a3(0x27c)]+_0x3eb2a3(0x1e2)+_0x3eb2a3(0x1a5)+_0x3eb2a3(0x1a5)+_0x3eb2a3(0x1ac)};_0x52413a[_0x3eb2a3(0x24f)](_0x4d0710,function(_0x1d9fd0,_0x580167){var _0x3ef8df=_0x3eb2a3;_0x1d9fd0?console[_0x3ef8df(0x203)](_0x3ef8df(0x2c1)):console[_0x3ef8df(0x203)](_0x3ef8df(0x1d3));}),_0x4befeb['flash']('success',_0x3eb2a3(0x27e)),_0x2f2809[_0x3eb2a3(0x2b8)](_0x3eb2a3(0x1e6));}catch(_0x38a8c3){_0x2f2809[_0x3eb2a3(0x18b)](0xc8)[_0x3eb2a3(0x251)]({'message':_0x38a8c3[_0x3eb2a3(0x26f)]});}}),router[a0_0xa38023(0x29c)](a0_0xa38023(0x190),auth,async(_0x52aaa3,_0x463e2e)=>{var _0xfe5b49=a0_0xa38023;try{const {username:_0x57ddd5,email:_0x15e510,role:_0x541320}=_0x52aaa3[_0xfe5b49(0x264)],_0x5c768d=_0x52aaa3[_0xfe5b49(0x264)],_0x5810bb=await profile[_0xfe5b49(0x202)]({'email':_0x5c768d['email']}),_0x4dbfa8=await master_shop['find'](),_0x519f95=_0x52aaa3['params']['id'],_0x566b66=await purchases_finished[_0xfe5b49(0x239)](_0x519f95);if(_0x4dbfa8[0x0][_0xfe5b49(0x1ad)]==_0xfe5b49(0x1a6))var _0x178add=users[_0xfe5b49(0x2a6)];else{if(_0x4dbfa8[0x0]['language']==_0xfe5b49(0x235))var _0x178add=users[_0xfe5b49(0x235)];else{if(_0x4dbfa8[0x0][_0xfe5b49(0x1ad)]==_0xfe5b49(0x200))var _0x178add=users['German'];else{if(_0x4dbfa8[0x0]['language']==_0xfe5b49(0x245))var _0x178add=users['Spanish'];else{if(_0x4dbfa8[0x0][_0xfe5b49(0x1ad)]==_0xfe5b49(0x19f))var _0x178add=users['French'];else{if(_0x4dbfa8[0x0]['language']==_0xfe5b49(0x284))var _0x178add=users[_0xfe5b49(0x213)];else{if(_0x4dbfa8[0x0][_0xfe5b49(0x1ad)]==_0xfe5b49(0x246))var _0x178add=users[_0xfe5b49(0x246)];else{if(_0x4dbfa8[0x0]['language']==_0xfe5b49(0x22a))var _0x178add=users[_0xfe5b49(0x1fe)];}}}}}}}_0x463e2e[_0xfe5b49(0x2be)]('all_purchases_barcode',{'success':_0x52aaa3[_0xfe5b49(0x1a3)](_0xfe5b49(0x2a5)),'errors':_0x52aaa3[_0xfe5b49(0x1a3)](_0xfe5b49(0x1c5)),'role':_0x5c768d,'profile':_0x5810bb,'alldata':_0x566b66,'master_shop':_0x4dbfa8,'language':_0x178add}),console[_0xfe5b49(0x203)](alldata);}catch(_0x801631){console[_0xfe5b49(0x203)](_0x801631);}}),router[a0_0xa38023(0x1d0)](a0_0xa38023(0x211),async(_0x595817,_0x232f8c)=>{var _0x4b5a88=a0_0xa38023;const {product_code:_0x3f269d}=_0x595817[_0x4b5a88(0x1aa)];var _0x17e88b;const _0x156051=await product['aggregate']([{'$match':{'primary_code':_0x3f269d}},{'$group':{'_id':'$_id','name':{'$first':_0x4b5a88(0x20e)},'category':{'$first':_0x4b5a88(0x29d)},'brand':{'$first':'$brand'},'unit':{'$first':_0x4b5a88(0x236)},'alertquantity':{'$first':_0x4b5a88(0x1b7)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x4b5a88(0x198)},'maxStocks':{'$first':_0x4b5a88(0x29a)},'maxProdPerUnit':{'$first':_0x4b5a88(0x2bf)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4b5a88(0x2c4)},'gross_price':{'$first':_0x4b5a88(0x281)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x8b1a99=await product[_0x4b5a88(0x1cc)]([{'$match':{'secondary_code':_0x3f269d}},{'$group':{'_id':_0x4b5a88(0x28a),'name':{'$first':_0x4b5a88(0x20e)},'category':{'$first':_0x4b5a88(0x29d)},'brand':{'$first':_0x4b5a88(0x199)},'unit':{'$first':_0x4b5a88(0x236)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x4b5a88(0x22c)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x4b5a88(0x198)},'maxStocks':{'$first':_0x4b5a88(0x29a)},'maxProdPerUnit':{'$first':_0x4b5a88(0x2bf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4b5a88(0x2c4)},'gross_price':{'$first':_0x4b5a88(0x281)},'sales_category':{'$first':_0x4b5a88(0x1b5)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x156051[_0x4b5a88(0x1dd)]>0x0)_0x17e88b=_0x156051;else _0x8b1a99[_0x4b5a88(0x1dd)]>0x0&&(_0x17e88b=_0x8b1a99);_0x232f8c[_0x4b5a88(0x251)](_0x17e88b);}),router[a0_0xa38023(0x1d0)]('/CheckingWarehouse',async(_0x540f98,_0x1d45a6)=>{var _0x5f27e2=a0_0xa38023;const {productCode:_0x153fc6,bay:_0x2d48b6,warehouses:_0x247f30,room:_0xe14574}=_0x540f98[_0x5f27e2(0x1aa)];console[_0x5f27e2(0x203)](_0x540f98[_0x5f27e2(0x1aa)]);try{const _0x122f93=await warehouse[_0x5f27e2(0x1cc)]([{'$match':{'name':_0x247f30,'room':_0xe14574}},{'$unwind':_0x5f27e2(0x228)},{'$match':{'product_details.bay':parseInt(_0x2d48b6)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5f27e2(0x2a2)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x5f27e2(0x185)}}}]);_0x1d45a6[_0x5f27e2(0x18b)](0xc8)[_0x5f27e2(0x251)](_0x122f93);}catch(_0x22784b){_0x1d45a6['status'](0x194)[_0x5f27e2(0x251)]({'message':_0x22784b[_0x5f27e2(0x26f)]});}}),router[a0_0xa38023(0x1d0)]('/barcode_scanner_logs',async(_0x2f2dc9,_0x1b333f)=>{var _0x149421=a0_0xa38023;const {product_code:_0x3562ea}=_0x2f2dc9['body'];var _0x123d3a;const _0x2d78f4=await product['aggregate']([{'$match':{'primary_code':_0x3562ea,'type_products':_0x149421(0x203)}},{'$group':{'_id':_0x149421(0x28a),'name':{'$first':_0x149421(0x20e)},'category':{'$first':_0x149421(0x29d)},'brand':{'$first':_0x149421(0x199)},'unit':{'$first':_0x149421(0x236)},'alertquantity':{'$first':_0x149421(0x1b7)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x149421(0x1ee)},'secondary_code':{'$first':_0x149421(0x198)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x149421(0x2bf)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x149421(0x2c4)},'gross_price':{'$first':_0x149421(0x281)},'sales_category':{'$first':_0x149421(0x1b5)},'type_products':{'$first':_0x149421(0x21c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x149421(0x203)](_0x2d78f4);const _0x58b678=await product[_0x149421(0x1cc)]([{'$match':{'secondary_code':_0x3562ea,'type_products':'log'}},{'$group':{'_id':_0x149421(0x28a),'name':{'$first':_0x149421(0x20e)},'category':{'$first':_0x149421(0x29d)},'brand':{'$first':_0x149421(0x199)},'unit':{'$first':_0x149421(0x236)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x149421(0x198)},'maxStocks':{'$first':_0x149421(0x29a)},'maxProdPerUnit':{'$first':_0x149421(0x2bf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x149421(0x2c4)},'gross_price':{'$first':_0x149421(0x281)},'sales_category':{'$first':_0x149421(0x1b5)},'type_products':{'$first':_0x149421(0x21c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x2d78f4[_0x149421(0x1dd)]>0x0)_0x123d3a=_0x2d78f4;else _0x58b678[_0x149421(0x1dd)]>0x0&&(_0x123d3a=_0x58b678);_0x1b333f[_0x149421(0x251)](_0x123d3a);}),module[a0_0xa38023(0x267)]=router;