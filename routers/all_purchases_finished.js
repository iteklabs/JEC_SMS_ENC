var a0_0x1c0850=a0_0x5096;(function(_0x21683b,_0x2d47a2){var _0x119814=a0_0x5096,_0xb6ad56=_0x21683b();while(!![]){try{var _0x3e52b3=parseInt(_0x119814(0x118))/0x1*(parseInt(_0x119814(0x1b3))/0x2)+-parseInt(_0x119814(0xbb))/0x3+parseInt(_0x119814(0xe7))/0x4*(-parseInt(_0x119814(0x168))/0x5)+parseInt(_0x119814(0x19b))/0x6*(parseInt(_0x119814(0xd4))/0x7)+parseInt(_0x119814(0x12b))/0x8+-parseInt(_0x119814(0x9b))/0x9*(parseInt(_0x119814(0x1a4))/0xa)+-parseInt(_0x119814(0x163))/0xb;if(_0x3e52b3===_0x2d47a2)break;else _0xb6ad56['push'](_0xb6ad56['shift']());}catch(_0x3f8926){_0xb6ad56['push'](_0xb6ad56['shift']());}}}(a0_0x210f,0xb03a7));const express=require(a0_0x1c0850(0x16d)),app=express(),router=express[a0_0x1c0850(0x88)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x1c0850(0x148)),auth=require(a0_0x1c0850(0x9a)),nodemailer=require(a0_0x1c0850(0x134));var ejs=require(a0_0x1c0850(0xa5));const path=require(a0_0x1c0850(0x16c)),users=require('../public/language/languages.json'),{isNull}=require('util');router['get'](a0_0x1c0850(0xc6),auth,async(_0x19c76c,_0x3bb5ce)=>{var _0x560639=a0_0x1c0850;try{const {username:_0x2b842e,email:_0x11e6b5,role:_0x1fe096}=_0x19c76c[_0x560639(0x17e)],_0x50b203=_0x19c76c[_0x560639(0x17e)],_0x2ca156=await profile['findOne']({'email':_0x50b203[_0x560639(0x15e)]}),_0x1f8328=await staff['findOne']({'email':_0x50b203[_0x560639(0x15e)]}),_0x174a00=await master_shop[_0x560639(0x1c2)]();let _0x1a378a=await transfers_finished[_0x560639(0x141)]([{'$match':{'to_warehouse':_0x1f8328['warehouse']}}]);if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0x1c0))var _0x195371=users[_0x560639(0xd0)];else{if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0x1b4))var _0x195371=users[_0x560639(0x1b4)];else{if(_0x174a00[0x0][_0x560639(0x155)]=='German')var _0x195371=users[_0x560639(0x15a)];else{if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0x19d))var _0x195371=users['Spanish'];else{if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0xe6))var _0x195371=users[_0x560639(0xe6)];else{if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0x186))var _0x195371=users[_0x560639(0x1bb)];else{if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0xe8))var _0x195371=users['Chinese'];else{if(_0x174a00[0x0][_0x560639(0x155)]==_0x560639(0x94))var _0x195371=users[_0x560639(0x8c)];}}}}}}}_0x3bb5ce[_0x560639(0x128)](_0x560639(0x187),{'success':_0x19c76c[_0x560639(0xf1)](_0x560639(0x102)),'errors':_0x19c76c[_0x560639(0xf1)]('errors'),'purchases':_0x1a378a,'role':_0x50b203,'profile':_0x2ca156,'master_shop':_0x174a00,'language':_0x195371,'staff_data':_0x1f8328});}catch(_0x5e44e1){console[_0x560639(0x154)]('table\x20page',_0x5e44e1),_0x3bb5ce[_0x560639(0xba)](0xc8)['json']({'message':_0x5e44e1[_0x560639(0x18a)]});}}),router[a0_0x1c0850(0x16f)](a0_0x1c0850(0x179),auth,async(_0x3fabac,_0xfaf5e4)=>{var _0x5ec169=a0_0x1c0850;try{const {username:_0x54deff,email:_0x4832b0,role:_0x14d9d1}=_0x3fabac[_0x5ec169(0x17e)],_0x3af745=_0x3fabac['user'],_0x36a192=await profile[_0x5ec169(0x149)]({'email':_0x3af745[_0x5ec169(0x15e)]}),_0x1c568c=await staff[_0x5ec169(0x149)]({'email':_0x3af745[_0x5ec169(0x15e)]}),_0x1427ac=await master_shop['find']();let _0x178416=await transfers_finished[_0x5ec169(0x141)]([{'$match':{'to_warehouse':_0x1c568c[_0x5ec169(0xcc)],'to_recieved':_0x5ec169(0x145)}}]);if(_0x1427ac[0x0][_0x5ec169(0x155)]=='English\x20(US)')var _0x25d9a7=users[_0x5ec169(0xd0)];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]==_0x5ec169(0x1b4))var _0x25d9a7=users[_0x5ec169(0x1b4)];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]=='German')var _0x25d9a7=users[_0x5ec169(0x15a)];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]=='Spanish')var _0x25d9a7=users['Spanish'];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]==_0x5ec169(0xe6))var _0x25d9a7=users[_0x5ec169(0xe6)];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]==_0x5ec169(0x186))var _0x25d9a7=users[_0x5ec169(0x1bb)];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]=='Chinese')var _0x25d9a7=users['Chinese'];else{if(_0x1427ac[0x0][_0x5ec169(0x155)]=='Arabic\x20(ae)')var _0x25d9a7=users[_0x5ec169(0x8c)];}}}}}}}_0xfaf5e4[_0x5ec169(0x128)](_0x5ec169(0xf2),{'success':_0x3fabac[_0x5ec169(0xf1)]('success'),'errors':_0x3fabac[_0x5ec169(0xf1)](_0x5ec169(0xc3)),'purchases':_0x178416,'role':_0x3af745,'profile':_0x36a192,'master_shop':_0x1427ac,'language':_0x25d9a7,'staff_data':_0x1c568c});}catch(_0x90f981){console['log'](_0x5ec169(0x170),_0x90f981),_0xfaf5e4['status'](0xc8)[_0x5ec169(0x14d)]({'message':_0x90f981[_0x5ec169(0x18a)]});}});function a0_0x5096(_0x1940d7,_0x2f8742){var _0x210fde=a0_0x210f();return a0_0x5096=function(_0x509674,_0x4643ad){_0x509674=_0x509674-0x86;var _0x56a607=_0x210fde[_0x509674];return _0x56a607;},a0_0x5096(_0x1940d7,_0x2f8742);}function a0_0x210f(){var _0x5da38d=['render','/../public','unit','11114048fXyFOd','date_recieved','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','note','product_stock','prod_Qty','JO_number','host','$secondary_code','nodemailer','to_warehouse','<h5\x20style=\x22text-align:\x20left;\x22>','date','$product_details.floorlevel','standard_unit','$product_details._id','product_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','user_id','prod_secondunit','product_code_hide','\x20Order\x20Number\x20:\x20','aggregate','prod_code','Error\x20Occurs','image','false','all_purchases_finished_logs','<strong>\x20Regards\x20</strong>','../models/all_models','findOne','purchase\x20data\x20add\x20successfully','exports','getMonth','json','MaxStocks_data','<h5>','</table>','$maxStocks','DRY\x20GOODS','concat','log','language','params','paid_amount','Finished\x20Goods','random','German',',\x20bin:\x20','createTransport','$product','email','$invoice','stock_data','$product.bay','catch','9079213dhhsOu','maxperunit','prod_unit','$due_amount','suppliers_docs','1201160SpZngz','</tbody>','production_date',',\x20room:\x20','path','express','all_purchases_barcode','get','table\x20page','product_code','slice','</tr>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','id_transaction','back','$product_details.product_code','toLocaleDateString','/incoming/add','LOG-INC-','2-digit','Enabled','RoomAssign','user','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details','<tbody\x20style=\x22text-align:\x20center;\x22>','stock_quantity','$primary_code','max','return_data','Portuguese\x20(BR)','incoming_view','$alertquantity','site_title','message','padStart','$batch_code','product_cat','$product.quantity','$return_data','/all_purchases_finished/view','here2','Purchase\x20Mail','product_date','gross_price','secondary_unit','min','Transfer\x20Finalize\x20Successfully','return_purchase_finished','$expiry_date','Distributing\x20','72ivXRJR','purchase_quantity','Spanish','/getinvoicetrf','role','prod_qty','sales_category','to_recieved','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','130svOmmg','master','/view/return_purchase/:id','findById','$brand','$name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<h2>\x20','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_details','POnumber','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_name','21392miPvQM','Hindi','</span>','$sales_category','secondary_code','</div>','$maxProdPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Portuguese','/view/add_purchases','/preview/:id','add_purchases_finished','$product_details.bay','English\x20(US)','Ambient','find','amount','sendMail','Router','$room','expiry_date','$product_details.maxProducts','Arabic','match','Error\x20occurred\x20while\x20processing\x20product:','room_name','<hr\x20class=\x22my-3\x22>','forEach','</h5>','product','Arabic\x20(ae)','Purchase\x20Return','filter','/give_payment/:id','$product.type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','../middleware/auth','613755TLzweU','$product_details.product_stock','then','password','numeric','getDate','$suppliers_docs','/upload/','warehouse_name','maxPerUnit','ejs','staff','$secondary_unit','$paid_amount','$gross_price','</body></html>','INC-','_id','/view/add_purchases_logs','secondary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Enclosed','abs','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$note','true','stocks','updateOne','$suppliers','product_data','status','877017xbwSEl',',\x20bay:\x20','room','maxProducts','purchase\x20data\x20update\x20successfully','Rack\x201','to_room_name','string','errors','currency','map','/incoming','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Asia/Manila','/all_purchases_finished/preview/','valueOf','all','warehouse','quantity','logo','return_qty','English','/view/add_purchases/:id','payment\x20successfull','level','470722BmOvYj','INCF-','<tr>','Logo.png','/all_purchases/view','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','save','/view','$product_details.product_name','$product.bin','/process/:id','due_amount','/barcode_scanner_logs','/CheckingWarehouse','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','Rack\x202','primary_code','to_quantity','French','4KHjWFX','Chinese','</head><body>','maxStocks','prod_primunit','body','Email\x20sent\x20successfully','prod_level','<span\x20style=\x22float:\x20right;\x22>','max_product_unit','flash','incoming_add','length','own','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.primary_code','item_code','FGSEmail','$category','</thead>','bin','name','\x20</h2>','$product_details.type','uuid','sales_data_cateory','success','logs','prod_cat','\x20units\x20to\x20warehouse:\x20','/all_purchases_finished/process/','floor','$date','return_product','error','\x20<>\x20','$product_details.secondary_code','getFullYear','$product.room_name','$product_details.bin','purchases_process','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','redirect','$product_code','purchase_invoice','$product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','INC','72qnrPqY','product_name','suppliers','toString','/barcode_scanner','<!DOCTYPE\x20html>','$_id','post','batch_code','$warehouse_name','/view/:id','primary_code_hide','invoice_init','$unit','bay','invoice'];a0_0x210f=function(){return _0x5da38d;};return a0_0x210f();}const createLog=async _0x2e53bf=>{var _0x8ddfdd=a0_0x1c0850;const _0x9dbd5c=new datalogs({'location':_0x2e53bf});return await _0x9dbd5c[_0x8ddfdd(0xda)](),_0x9dbd5c[_0x8ddfdd(0x124)];};router['post'](a0_0x1c0850(0x179),auth,async(_0x506273,_0x192056)=>{var _0x2dbae1=a0_0x1c0850;try{const {invoice_trf_data:_0x2ec789,item_code:_0x3b9114,SCRN:_0x10f9d0,ReqBy:_0x27ca16,type_of_products:_0x31a763,dateofreq:_0x63e652,PO_number:_0x5dda24,date:_0x3c4362,warehouse_name:_0x79cd01,typeservicesData:_0x2487db,typevehicle:_0x31586a,driver:_0x3d6c4d,plate:_0x2c5d2a,van:_0x33c9b1,DRSI:_0x1f1ec3,TSU:_0xd08bbe,TFU:_0x3aef25,note:_0x5516db}=_0x506273[_0x2dbae1(0xec)],_0x11474e=await transfers_finished[_0x2dbae1(0x1a7)](_0x2ec789);if(typeof _0x3b9114==_0x2dbae1(0xc2))var _0x22ee04=[_0x506273['body'][_0x2dbae1(0x119)]],_0x34ab94=[_0x506273['body'][_0x2dbae1(0xf8)]],_0x1d77cd=[_0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xe5)]],_0x39d7be=[_0x506273[_0x2dbae1(0xec)][_0x2dbae1(0x12a)]],_0x5b8b6e=[_0x506273[_0x2dbae1(0xec)]['prod_secondunit']],_0x555a31=[_0x506273['body'][_0x2dbae1(0xfc)]],_0x16edc6=[_0x506273[_0x2dbae1(0xec)]['primary_code']],_0x109a5f=[_0x506273[_0x2dbae1(0xec)]['secondary_code']],_0x1c77f8=[_0x506273['body'][_0x2dbae1(0x120)]],_0x22338b=[_0x506273[_0x2dbae1(0xec)][_0x2dbae1(0x8a)]],_0x1d66f0=[_0x506273['body']['production_date']],_0x1d14db=[_0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xf0)]],_0x164d84=[_0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xbd)]];else var _0x22ee04=[..._0x506273[_0x2dbae1(0xec)]['product_name']],_0x34ab94=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xf8)]],_0x1d77cd=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xe5)]],_0x39d7be=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0x12a)]],_0x5b8b6e=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0x13e)]],_0x555a31=[..._0x506273[_0x2dbae1(0xec)]['bin']],_0x16edc6=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xe4)]],_0x109a5f=[..._0x506273[_0x2dbae1(0xec)]['secondary_code']],_0x1c77f8=[..._0x506273['body'][_0x2dbae1(0x120)]],_0x22338b=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0x8a)]],_0x1d66f0=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0x16a)]],_0x1d14db=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xf0)]],_0x164d84=[..._0x506273[_0x2dbae1(0xec)][_0x2dbae1(0xbd)]];const _0x2898bb=_0x22ee04[_0x2dbae1(0xc5)](_0x56567a=>{return _0x56567a={'product_name':_0x56567a};});_0x34ab94[_0x2dbae1(0x91)]((_0x42aee6,_0x1c1c25)=>{var _0x108a83=_0x2dbae1;_0x2898bb[_0x1c1c25][_0x108a83(0x171)]=_0x42aee6;}),_0x1d77cd[_0x2dbae1(0x91)]((_0x19aaeb,_0x8cd487)=>{var _0x5e2025=_0x2dbae1;_0x2898bb[_0x8cd487][_0x5e2025(0xcd)]=Math[_0x5e2025(0xb1)](_0x19aaeb);}),_0x39d7be[_0x2dbae1(0x91)]((_0x14ea95,_0x58ce5f)=>{_0x2898bb[_0x58ce5f]['standard_unit']=_0x14ea95;}),_0x5b8b6e[_0x2dbae1(0x91)]((_0x187552,_0x2a6587)=>{_0x2898bb[_0x2a6587]['secondary_unit']=_0x187552;}),_0x555a31[_0x2dbae1(0x91)]((_0x369d02,_0x6140eb)=>{var _0xf58919=_0x2dbae1,_0x314c9e=_0x369d02[_0xf58919(0x8d)](/[A-Za-z]+/)[0x0],_0x291183=parseInt(_0x369d02[_0xf58919(0x8d)](/\d+/)[0x0]);_0x2898bb[_0x6140eb][_0xf58919(0xd3)]=_0x314c9e,_0x2898bb[_0x6140eb][_0xf58919(0x126)]=_0x291183;}),_0x16edc6[_0x2dbae1(0x91)]((_0x2f3a3c,_0x46cc63)=>{var _0x176d49=_0x2dbae1;_0x2898bb[_0x46cc63][_0x176d49(0xe4)]=_0x2f3a3c;}),_0x109a5f[_0x2dbae1(0x91)]((_0x2def36,_0x22da0a)=>{var _0x1dc06b=_0x2dbae1;_0x2898bb[_0x22da0a][_0x1dc06b(0x1b7)]=_0x2def36;}),_0x1c77f8[_0x2dbae1(0x91)]((_0x10040a,_0x1e901c)=>{var _0x23f7a6=_0x2dbae1;_0x2898bb[_0x1e901c][_0x23f7a6(0x120)]=_0x10040a;}),_0x22338b[_0x2dbae1(0x91)]((_0x521513,_0x5d98df)=>{var _0x5e3593=_0x2dbae1;_0x2898bb[_0x5d98df][_0x5e3593(0x8a)]=_0x521513;}),_0x1d66f0[_0x2dbae1(0x91)]((_0x59f03a,_0xb8354e)=>{var _0x2a5a28=_0x2dbae1;_0x2898bb[_0xb8354e][_0x2a5a28(0x16a)]=_0x59f03a;}),_0x1d14db[_0x2dbae1(0x91)]((_0x8a74c3,_0x272de4)=>{var _0x476968=_0x2dbae1;_0x2898bb[_0x272de4][_0x476968(0x164)]=_0x8a74c3;}),_0x164d84[_0x2dbae1(0x91)]((_0x2bd1cb,_0x391ba1)=>{_0x2898bb[_0x391ba1]['room_name']=_0x2bd1cb;});const _0x221394=await createLog(_0x2dbae1(0x117));_0x164d84[_0x2dbae1(0x91)]((_0x5c7a68,_0x2abb59)=>{var _0x1cec33=_0x2dbae1;_0x2898bb[_0x2abb59][_0x1cec33(0x127)]=_0x1cec33(0xab)+_0x221394[_0x1cec33(0x11b)]()[_0x1cec33(0x18b)](0x8,'0');});const _0x3702a4=_0x2898bb[_0x2dbae1(0x96)](_0x3fd90c=>_0x3fd90c[_0x2dbae1(0xcd)]!=='0'&&_0x3fd90c[_0x2dbae1(0xcd)]!==''),_0x2ce750=new purchases_incoming({'invoice':_0x2dbae1(0xab)+_0x221394[_0x2dbae1(0x11b)]()[_0x2dbae1(0x18b)](0x8,'0'),'date':_0x3c4362,'warehouse_name':_0x79cd01,'product':_0x3702a4,'note':_0x5516db,'POnumber':_0x5dda24,'SCRN':_0x10f9d0,'ReqBy':_0x27ca16,'dateofreq':_0x63e652,'typeservicesData':_0x2487db,'van':_0x33c9b1,'typevehicle':_0x31586a,'driver':_0x3d6c4d,'plate':_0x2c5d2a,'DRSI':_0x1f1ec3,'TSU':_0xd08bbe,'TFU':_0x3aef25,'typeOfProducts':_0x31a763}),_0x1bafc1=await _0x2ce750[_0x2dbae1(0xda)](),_0x421ccc=_0x1bafc1[_0x2dbae1(0x93)]['map'](async _0x4fda81=>{var _0x2f27a8=_0x2dbae1,_0x6b5052=await warehouse['findOne']({'name':_0x79cd01,'room':_0x4fda81[_0x2f27a8(0x8f)]});if(_0x4fda81[_0x2f27a8(0xcd)]>0x0){var _0x3c349b=0x0;const _0x4cfc18=_0x6b5052[_0x2f27a8(0x1ae)]['map'](_0x1ed0cf=>{var _0x3e4a07=_0x2f27a8;_0x1ed0cf[_0x3e4a07(0x119)]==_0x4fda81[_0x3e4a07(0x119)]&&_0x1ed0cf[_0x3e4a07(0x126)]==_0x4fda81['to_bay']&&_0x1ed0cf[_0x3e4a07(0x8a)]==_0x4fda81[_0x3e4a07(0x8a)]&&_0x1ed0cf['production_date']==_0x4fda81[_0x3e4a07(0x16a)]&&_0x1ed0cf[_0x3e4a07(0x120)]==_0x4fda81[_0x3e4a07(0x120)]&&_0x1ed0cf[_0x3e4a07(0x127)]==_0x4fda81[_0x3e4a07(0x127)]&&(typeof _0x4fda81[_0x3e4a07(0x175)]=='undefined'?(console['log'](_0x3e4a07(0x191),_0x1ed0cf[_0x3e4a07(0x12f)]+_0x3e4a07(0x10b)+_0x1ed0cf['_id']+'\x20<=>\x20'+Math['abs'](_0x1ed0cf[_0x3e4a07(0x12f)])+Math[_0x3e4a07(0xb1)](_0x4fda81[_0x3e4a07(0xe5)])),_0x1ed0cf[_0x3e4a07(0x12f)]=Math[_0x3e4a07(0xb1)](_0x1ed0cf[_0x3e4a07(0x12f)])+Math[_0x3e4a07(0xb1)](_0x4fda81[_0x3e4a07(0xcd)])):(_0x1ed0cf[_0x3e4a07(0x12f)]=Math['abs'](_0x1ed0cf[_0x3e4a07(0x12f)])+Math[_0x3e4a07(0xb1)](_0x4fda81[_0x3e4a07(0xcd)]),_0x3c349b++));});_0x3c349b=='0'&&(_0x6b5052['product_details']=_0x6b5052['product_details'][_0x2f27a8(0x153)]({'product_name':_0x4fda81[_0x2f27a8(0x119)],'product_stock':_0x4fda81[_0x2f27a8(0xcd)],'bay':_0x4fda81[_0x2f27a8(0x126)],'level':_0x4fda81['level'],'product_code':_0x4fda81[_0x2f27a8(0x171)],'primary_code':_0x4fda81['primary_code'],'secondary_code':_0x4fda81[_0x2f27a8(0x1b7)],'expiry_date':_0x4fda81[_0x2f27a8(0x8a)],'production_date':_0x4fda81[_0x2f27a8(0x16a)],'maxProducts':_0x4fda81[_0x2f27a8(0xbe)],'batch_code':_0x4fda81[_0x2f27a8(0x120)],'secondary_unit':_0x4fda81['secondary_unit'],'unit':_0x4fda81['standard_unit'],'maxProducts':_0x4fda81[_0x2f27a8(0xbe)],'maxPerUnit':_0x4fda81[_0x2f27a8(0xa4)],'invoice':_0x4fda81['invoice']}));}return _0x6b5052;});Promise['all'](_0x421ccc)[_0x2dbae1(0x9d)](async _0x5ca474=>{var _0x372b6e=_0x2dbae1;try{for(const _0x42b651 of _0x5ca474){await warehouse[_0x372b6e(0xb7)]({'_id':_0x42b651[_0x372b6e(0xac)]},{'$addToSet':{'product_details':{'$each':_0x42b651[_0x372b6e(0x1ae)]}}});}_0x11474e[_0x372b6e(0x1a2)]=_0x372b6e(0xb5);const _0x311997=await _0x11474e[_0x372b6e(0xda)](),_0x5d3070=await master_shop[_0x372b6e(0x1c2)](),_0xac07d3=await email_settings[_0x372b6e(0x149)](),_0x51059c=await supervisor_settings[_0x372b6e(0x1c2)]();var _0x30496b=_0x2ce750[_0x372b6e(0x93)],_0x52638b='',_0x2ccfcc;for(_0x2ccfcc in _0x30496b){var _0x2c86a1='FG';_0x2ce750[_0x372b6e(0x135)]==_0x372b6e(0x152)&&(_0x2c86a1='DG'),_0x52638b+=_0x372b6e(0xd6)+_0x372b6e(0xf5)+_0x30496b[_0x2ccfcc][_0x372b6e(0x119)]+_0x372b6e(0x1b0)+_0x372b6e(0xf5)+_0x30496b[_0x2ccfcc][_0x372b6e(0x171)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30496b[_0x2ccfcc][_0x372b6e(0xe5)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30496b[_0x2ccfcc][_0x372b6e(0x12a)]+_0x372b6e(0x1b0)+_0x372b6e(0xf5)+_0x30496b[_0x2ccfcc]['secondary_unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ce750[_0x372b6e(0x135)]+_0x372b6e(0x1b0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30496b[_0x2ccfcc][_0x372b6e(0xc1)]+_0x372b6e(0x1b0)+_0x372b6e(0xf5)+_0x2c86a1+_0x30496b[_0x2ccfcc]['to_bay']+'</td>'+'</tr>';}_0x506273['flash']('success',_0x372b6e(0x197)),_0x192056['redirect']('/picking_list/pdf_puchases_fin_own_trf/'+_0x1bafc1['_id']);}catch(_0x4ec40e){console[_0x372b6e(0x10a)](_0x4ec40e),_0x192056[_0x372b6e(0xba)](0x1f4)[_0x372b6e(0x14d)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x2dbae1(0x162)](_0x5ace87=>{var _0x2044c3=_0x2dbae1;console[_0x2044c3(0x10a)](_0x5ace87),_0x192056[_0x2044c3(0xba)](0x1f4)[_0x2044c3(0x14d)]({'error':'An\x20error\x20occurred.'});});}catch(_0x1bfcc1){}}),router[a0_0x1c0850(0x11f)]('/getTRF',auth,async(_0x197cf5,_0x4b08fa)=>{var _0x11d937=a0_0x1c0850;try{const {warehouse:_0x42deb3}=_0x197cf5['body'],_0x439b7b=await transfers_finished['find']({'to_warehouse':_0x42deb3,'to_recieved':_0x11d937(0x145)});_0x4b08fa[_0x11d937(0x14d)](_0x439b7b);}catch(_0x119c00){}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0x19e),auth,async(_0x1caa38,_0x1d080f)=>{var _0x6eba19=a0_0x1c0850;try{const {invoice:_0x3f3ae3}=_0x1caa38[_0x6eba19(0xec)],_0x42f74c=await transfers_finished[_0x6eba19(0x1c2)]({'_id':_0x3f3ae3,'to_recieved':_0x6eba19(0x145)});_0x1d080f[_0x6eba19(0x14d)](_0x42f74c);}catch(_0x472107){}}),router['get'](a0_0x1c0850(0xdb),auth,async(_0x364a7a,_0x36d3f3)=>{var _0x46e1cb=a0_0x1c0850;try{const {username:_0x1586f2,email:_0x1af3c6,role:_0x2d93c3}=_0x364a7a[_0x46e1cb(0x17e)],_0x51da5a=_0x364a7a[_0x46e1cb(0x17e)],_0x16d0df=await profile['findOne']({'email':_0x51da5a[_0x46e1cb(0x15e)]}),_0xf71ee2=await staff[_0x46e1cb(0x149)]({'email':_0x51da5a[_0x46e1cb(0x15e)]});if(_0x51da5a[_0x46e1cb(0x19f)]==_0x46e1cb(0xa6)){const _0x510c42=await staff['findOne']({'email':_0x51da5a[_0x46e1cb(0x15e)]});}const _0x53621d=await master_shop[_0x46e1cb(0x1c2)]();let _0x5e4100;if(_0x51da5a[_0x46e1cb(0x19f)]==_0x46e1cb(0xa6)){const _0x464015=await staff['findOne']({'email':_0x51da5a[_0x46e1cb(0x15e)]});_0x5e4100=await purchases_finished[_0x46e1cb(0x141)]([{'$match':{'warehouse_name':_0x464015[_0x46e1cb(0xcc)],'typeOfProducts':'own'}},{'$lookup':{'from':_0x46e1cb(0x11a),'localField':'suppliers','foreignField':_0x46e1cb(0xfd),'as':_0x46e1cb(0x167)}},{'$unwind':_0x46e1cb(0xa1)},{'$unwind':'$product'},{'$group':{'_id':_0x46e1cb(0x11e),'invoice':{'$first':_0x46e1cb(0x15f)},'suppliers':{'$first':_0x46e1cb(0xb8)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x46e1cb(0x121)},'room':{'$first':'$room'},'product':{'$push':_0x46e1cb(0x15d)},'note':{'$first':_0x46e1cb(0xb4)},'paid_amount':{'$first':_0x46e1cb(0xa8)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x46e1cb(0x18f)},'batch_code':{'$first':_0x46e1cb(0x18c)},'expiry_date':{'$first':_0x46e1cb(0x199)},'suppliers_docs':{'$first':_0x46e1cb(0xa1)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x46e1cb(0x98)},'floorlevel':{'$addToSet':_0x46e1cb(0x115)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5e4100=await purchases_finished[_0x46e1cb(0x141)]([{'$match':{'typeOfProducts':_0x46e1cb(0xf4)}},{'$unwind':_0x46e1cb(0x15d)},{'$group':{'_id':_0x46e1cb(0x11e),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x46e1cb(0xb8)},'date':{'$first':_0x46e1cb(0x108)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x46e1cb(0x10e)},'product':{'$push':'$product'},'note':{'$first':_0x46e1cb(0xb4)},'paid_amount':{'$first':_0x46e1cb(0xa8)},'due_amount':{'$first':_0x46e1cb(0x166)},'return_data':{'$first':_0x46e1cb(0x18f)},'batch_code':{'$first':_0x46e1cb(0x18c)},'expiry_date':{'$first':_0x46e1cb(0x199)},'suppliers_docs':{'$first':_0x46e1cb(0xa1)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x46e1cb(0x161)},'isle':{'$addToSet':_0x46e1cb(0xdd)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x46e1cb(0x115)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x53621d[0x0]['language']=='English\x20(US)')var _0x3926ce=users[_0x46e1cb(0xd0)];else{if(_0x53621d[0x0][_0x46e1cb(0x155)]==_0x46e1cb(0x1b4))var _0x3926ce=users[_0x46e1cb(0x1b4)];else{if(_0x53621d[0x0][_0x46e1cb(0x155)]==_0x46e1cb(0x15a))var _0x3926ce=users[_0x46e1cb(0x15a)];else{if(_0x53621d[0x0]['language']=='Spanish')var _0x3926ce=users[_0x46e1cb(0x19d)];else{if(_0x53621d[0x0][_0x46e1cb(0x155)]==_0x46e1cb(0xe6))var _0x3926ce=users[_0x46e1cb(0xe6)];else{if(_0x53621d[0x0]['language']==_0x46e1cb(0x186))var _0x3926ce=users[_0x46e1cb(0x1bb)];else{if(_0x53621d[0x0][_0x46e1cb(0x155)]==_0x46e1cb(0xe8))var _0x3926ce=users[_0x46e1cb(0xe8)];else{if(_0x53621d[0x0][_0x46e1cb(0x155)]=='Arabic\x20(ae)')var _0x3926ce=users['Arabic'];}}}}}}}_0x36d3f3['render']('all_purchases_finished',{'success':_0x364a7a[_0x46e1cb(0xf1)](_0x46e1cb(0x102)),'errors':_0x364a7a[_0x46e1cb(0xf1)](_0x46e1cb(0xc3)),'purchases':_0x5e4100,'role':_0x51da5a,'profile':_0x16d0df,'master_shop':_0x53621d,'language':_0x3926ce});}catch(_0x680e26){console[_0x46e1cb(0x154)](_0x46e1cb(0x170),_0x680e26),_0x36d3f3[_0x46e1cb(0xba)](0xc8)['json']({'message':_0x680e26['message']});}}),router['get']('/view_log',auth,async(_0x2e8acc,_0x48bf0e)=>{var _0x37b246=a0_0x1c0850;try{const {username:_0x5119c1,email:_0x5ec1a1,role:_0x34deb4}=_0x2e8acc[_0x37b246(0x17e)],_0x41759a=_0x2e8acc[_0x37b246(0x17e)],_0x4a0d17=await profile[_0x37b246(0x149)]({'email':_0x41759a[_0x37b246(0x15e)]}),_0x4c21bb=await staff[_0x37b246(0x149)]({'email':_0x41759a[_0x37b246(0x15e)]});if(_0x41759a['role']==_0x37b246(0xa6)){const _0x3ee263=await staff[_0x37b246(0x149)]({'email':_0x41759a[_0x37b246(0x15e)]});}const _0x180977=await master_shop[_0x37b246(0x1c2)]();let _0x5afc24;if(_0x41759a[_0x37b246(0x19f)]==_0x37b246(0xa6)){const _0x188e0b=await staff[_0x37b246(0x149)]({'email':_0x41759a[_0x37b246(0x15e)]});_0x5afc24=await purchases_finished[_0x37b246(0x141)]([{'$match':{'warehouse_name':_0x188e0b[_0x37b246(0xcc)]}},{'$lookup':{'from':'suppliers','localField':_0x37b246(0x11a),'foreignField':_0x37b246(0xfd),'as':_0x37b246(0x167)}},{'$unwind':_0x37b246(0xa1)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x37b246(0xb8)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x37b246(0x89)},'product':{'$push':_0x37b246(0x15d)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x37b246(0x18c)},'expiry_date':{'$first':_0x37b246(0x199)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x37b246(0x18e)},'level':{'$addToSet':_0x37b246(0x161)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x37b246(0x98)},'floorlevel':{'$addToSet':_0x37b246(0x115)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5afc24=await purchases_finished[_0x37b246(0x141)]([{'$match':{'typeOfProducts':_0x37b246(0x103)}},{'$unwind':'$product'},{'$group':{'_id':_0x37b246(0x11e),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x37b246(0xb8)},'date':{'$first':_0x37b246(0x108)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x37b246(0x10e)},'product':{'$push':_0x37b246(0x15d)},'note':{'$first':_0x37b246(0xb4)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x37b246(0x166)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x37b246(0x18c)},'expiry_date':{'$first':_0x37b246(0x199)},'suppliers_docs':{'$first':_0x37b246(0xa1)},'total_product_quantity':{'$sum':_0x37b246(0x18e)},'level':{'$addToSet':_0x37b246(0x161)},'isle':{'$addToSet':_0x37b246(0xdd)},'type':{'$addToSet':_0x37b246(0x98)},'floorlevel':{'$addToSet':_0x37b246(0x115)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x180977[0x0][_0x37b246(0x155)]==_0x37b246(0x1c0))var _0x309306=users[_0x37b246(0xd0)];else{if(_0x180977[0x0]['language']==_0x37b246(0x1b4))var _0x309306=users[_0x37b246(0x1b4)];else{if(_0x180977[0x0][_0x37b246(0x155)]==_0x37b246(0x15a))var _0x309306=users['German'];else{if(_0x180977[0x0][_0x37b246(0x155)]==_0x37b246(0x19d))var _0x309306=users['Spanish'];else{if(_0x180977[0x0][_0x37b246(0x155)]==_0x37b246(0xe6))var _0x309306=users[_0x37b246(0xe6)];else{if(_0x180977[0x0][_0x37b246(0x155)]=='Portuguese\x20(BR)')var _0x309306=users[_0x37b246(0x1bb)];else{if(_0x180977[0x0][_0x37b246(0x155)]==_0x37b246(0xe8))var _0x309306=users[_0x37b246(0xe8)];else{if(_0x180977[0x0][_0x37b246(0x155)]==_0x37b246(0x94))var _0x309306=users[_0x37b246(0x8c)];}}}}}}}_0x48bf0e[_0x37b246(0x128)](_0x37b246(0x146),{'success':_0x2e8acc['flash'](_0x37b246(0x102)),'errors':_0x2e8acc[_0x37b246(0xf1)](_0x37b246(0xc3)),'purchases':_0x5afc24,'role':_0x41759a,'profile':_0x4a0d17,'master_shop':_0x180977,'language':_0x309306});}catch(_0x47021f){console['log'](_0x37b246(0x170),_0x47021f),_0x48bf0e[_0x37b246(0xba)](0xc8)[_0x37b246(0x14d)]({'message':_0x47021f[_0x37b246(0x18a)]});}});function BayBinSelected(_0x4dd91a,_0x27855f){var _0x45b481=a0_0x1c0850,_0x382138=[],_0x573b84=[];if(_0x4dd91a==_0x45b481(0x152)){switch(_0x27855f){case'Rack\x201':_0x382138=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x45b481(0xe3):_0x382138=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x573b84=['DG'];}else{if(_0x4dd91a=='FROZEN\x20GOODS'){switch(_0x27855f){case _0x45b481(0xc0):_0x382138=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x45b481(0xe3):_0x382138=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x573b84=['FG'];}}return{'levels':_0x382138,'identify':_0x573b84};}async function getRandom8DigitNumber(){var _0x265a17=a0_0x1c0850;const _0x148b5f=0x989680,_0x39688f=0x5f5e0ff,_0x39a765=Math[_0x265a17(0x107)](Math[_0x265a17(0x159)]()*(_0x39688f-_0x148b5f+0x1))+_0x148b5f;var _0x6545a0;const _0x5b7de3=await purchases_finished[_0x265a17(0x149)]({'invoice':_0x265a17(0xd5)+_0x39a765});return _0x5b7de3&&_0x5b7de3[_0x265a17(0xf3)]>0x0?_0x6545a0=_0x265a17(0xd5)+_0x39a765:_0x6545a0='INCF-'+_0x39a765,_0x6545a0;}router[a0_0x1c0850(0x16f)](a0_0x1c0850(0x1bc),auth,async(_0x5c013d,_0x186954)=>{var _0x461e50=a0_0x1c0850;try{const {username:_0x1f1664,email:_0x13c763,role:_0x147905}=_0x5c013d['user'],_0x286ca2=_0x5c013d[_0x461e50(0x17e)],_0x51fe25=await profile[_0x461e50(0x149)]({'email':_0x286ca2[_0x461e50(0x15e)]}),_0x2738a2=await master_shop['find'](),_0x248fa0=await staff[_0x461e50(0x149)]({'email':_0x286ca2[_0x461e50(0x15e)]}),_0x3ed6db=await suppliers[_0x461e50(0x1c2)]({});let _0x4ba873;if(_0x286ca2[_0x461e50(0x19f)]==_0x461e50(0xa6)){const _0x22cf03=await staff[_0x461e50(0x149)]({'email':_0x286ca2[_0x461e50(0x15e)]});_0x4ba873=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x22cf03[_0x461e50(0xcc)]}},{'$group':{'_id':_0x461e50(0x1a9),'name':{'$first':_0x461e50(0x1a9)}}}]);}else _0x4ba873=await warehouse[_0x461e50(0x141)]([{'$match':{'status':_0x461e50(0x17c)}},{'$group':{'_id':_0x461e50(0x1a9),'name':{'$first':_0x461e50(0x1a9)}}}]);const _0x54958f=await product['find']({}),_0x22d78f=await warehouse['find']({'status':_0x461e50(0x17c)}),_0xfd9699=await purchases_finished[_0x461e50(0x1c2)]({}),_0x3204df=_0xfd9699['length']+0x1,_0x394e02=_0x461e50(0xd5)+_0x3204df[_0x461e50(0x11b)]()[_0x461e50(0x18b)](0x5,'0');var _0x18f51d=[_0x461e50(0x1c1),_0x461e50(0xb0)];if(_0x2738a2[0x0][_0x461e50(0x155)]=='English\x20(US)')var _0x8d67a6=users[_0x461e50(0xd0)];else{if(_0x2738a2[0x0][_0x461e50(0x155)]=='Hindi')var _0x8d67a6=users[_0x461e50(0x1b4)];else{if(_0x2738a2[0x0][_0x461e50(0x155)]==_0x461e50(0x15a))var _0x8d67a6=users[_0x461e50(0x15a)];else{if(_0x2738a2[0x0]['language']=='Spanish')var _0x8d67a6=users[_0x461e50(0x19d)];else{if(_0x2738a2[0x0][_0x461e50(0x155)]==_0x461e50(0xe6))var _0x8d67a6=users[_0x461e50(0xe6)];else{if(_0x2738a2[0x0]['language']==_0x461e50(0x186))var _0x8d67a6=users[_0x461e50(0x1bb)];else{if(_0x2738a2[0x0][_0x461e50(0x155)]==_0x461e50(0xe8))var _0x8d67a6=users[_0x461e50(0xe8)];else{if(_0x2738a2[0x0][_0x461e50(0x155)]==_0x461e50(0x94))var _0x8d67a6=users[_0x461e50(0x8c)];}}}}}}}const _0x1a9098=getRandom8DigitNumber(),_0x16a2f2=new Date(),_0x210a94={'year':_0x461e50(0x9f),'month':_0x461e50(0x17b),'day':_0x461e50(0x17b),'timeZone':_0x461e50(0xc8)},_0x428f67=_0x16a2f2[_0x461e50(0x178)]('en-CA',_0x210a94);console[_0x461e50(0x154)](_0x428f67),_0x1a9098[_0x461e50(0x9d)](_0x2e230d=>{var _0x47cbde=_0x461e50;_0x186954[_0x47cbde(0x128)](_0x47cbde(0x1be),{'success':_0x5c013d[_0x47cbde(0xf1)](_0x47cbde(0x102)),'errors':_0x5c013d[_0x47cbde(0xf1)](_0x47cbde(0xc3)),'role':_0x286ca2,'profile':_0x51fe25,'suppliers':_0x3ed6db,'warehouse':_0x4ba873,'product':_0x54958f,'invoice':_0x2e230d,'master_shop':_0x2738a2,'language':_0x8d67a6,'find_data':_0x22d78f,'rooms_data':_0x18f51d,'formattedDate':_0x428f67});})[_0x461e50(0x162)](_0x4c1db8=>{var _0x3cd234=_0x461e50;_0x5c013d[_0x3cd234(0xf1)]('errors',_0x3cd234(0x1aa)),_0x186954[_0x3cd234(0x112)]('/all_purchases_finished/view');});}catch(_0x3438be){console[_0x461e50(0x154)](_0x3438be);}}),router[a0_0x1c0850(0x16f)](a0_0x1c0850(0xad),auth,async(_0x10aa33,_0x21ea9a)=>{var _0x11643a=a0_0x1c0850;try{const {username:_0x5b82c4,email:_0x1a8e0f,role:_0x281bc3}=_0x10aa33[_0x11643a(0x17e)],_0x2192ac=_0x10aa33[_0x11643a(0x17e)],_0x38ecf8=await profile[_0x11643a(0x149)]({'email':_0x2192ac['email']}),_0x246f04=await master_shop[_0x11643a(0x1c2)](),_0x96f3bb=await staff['findOne']({'email':_0x2192ac[_0x11643a(0x15e)]}),_0x464649=await suppliers[_0x11643a(0x1c2)]({});let _0x2088d9;if(_0x2192ac[_0x11643a(0x19f)]==_0x11643a(0xa6)){const _0x140d8f=await staff[_0x11643a(0x149)]({'email':_0x2192ac[_0x11643a(0x15e)]});_0x2088d9=await warehouse[_0x11643a(0x141)]([{'$match':{'status':_0x11643a(0x17c),'name':_0x140d8f['warehouse']}},{'$group':{'_id':_0x11643a(0x1a9),'name':{'$first':'$name'}}}]);}else _0x2088d9=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x11643a(0x1a9),'name':{'$first':_0x11643a(0x1a9)}}}]);const _0x4e4ac2=await product[_0x11643a(0x1c2)]({}),_0x193218=await warehouse['find']({'status':_0x11643a(0x17c)}),_0x5954fa=await purchases_finished[_0x11643a(0x1c2)]({}),_0x3b0e70=_0x5954fa[_0x11643a(0xf3)]+0x1,_0xc27ca7=_0x11643a(0xd5)+_0x3b0e70[_0x11643a(0x11b)]()['padStart'](0x5,'0');var _0x55e721=[_0x11643a(0x1c1),_0x11643a(0xb0)];if(_0x246f04[0x0][_0x11643a(0x155)]==_0x11643a(0x1c0))var _0x4e7c5c=users[_0x11643a(0xd0)];else{if(_0x246f04[0x0][_0x11643a(0x155)]==_0x11643a(0x1b4))var _0x4e7c5c=users[_0x11643a(0x1b4)];else{if(_0x246f04[0x0]['language']=='German')var _0x4e7c5c=users[_0x11643a(0x15a)];else{if(_0x246f04[0x0]['language']==_0x11643a(0x19d))var _0x4e7c5c=users[_0x11643a(0x19d)];else{if(_0x246f04[0x0]['language']==_0x11643a(0xe6))var _0x4e7c5c=users[_0x11643a(0xe6)];else{if(_0x246f04[0x0]['language']==_0x11643a(0x186))var _0x4e7c5c=users[_0x11643a(0x1bb)];else{if(_0x246f04[0x0][_0x11643a(0x155)]=='Chinese')var _0x4e7c5c=users[_0x11643a(0xe8)];else{if(_0x246f04[0x0][_0x11643a(0x155)]==_0x11643a(0x94))var _0x4e7c5c=users['Arabic'];}}}}}}}const _0x512424=getRandom8DigitNumber();_0x512424['then'](_0x2f58e9=>{var _0x51790c=_0x11643a;_0x21ea9a[_0x51790c(0x128)]('add_purchases_finished_logs',{'success':_0x10aa33[_0x51790c(0xf1)]('success'),'errors':_0x10aa33['flash'](_0x51790c(0xc3)),'role':_0x2192ac,'profile':_0x38ecf8,'suppliers':_0x464649,'warehouse':_0x2088d9,'product':_0x4e4ac2,'invoice':_0x2f58e9,'master_shop':_0x246f04,'language':_0x4e7c5c,'find_data':_0x193218,'rooms_data':_0x55e721});})[_0x11643a(0x162)](_0x26adc4=>{var _0x16d604=_0x11643a;_0x10aa33[_0x16d604(0xf1)](_0x16d604(0xc3),_0x16d604(0x1aa)),_0x21ea9a[_0x16d604(0x112)](_0x16d604(0x190));});}catch(_0x1622d4){console[_0x11643a(0x154)](_0x1622d4);}}),router[a0_0x1c0850(0x16f)](a0_0x1c0850(0xd1),auth,async(_0x5f23eb,_0x41059f)=>{var _0x2261f0=a0_0x1c0850;try{const _0x2fd518=_0x5f23eb[_0x2261f0(0x156)]['id'];console[_0x2261f0(0x154)](_0x2fd518);const _0x43f003=await master_shop['find']();console[_0x2261f0(0x154)](_0x2261f0(0x1a5),_0x43f003);const _0x15ab34=await product[_0x2261f0(0x149)]({'name':_0x2fd518});console['log']('product',_0x15ab34),_0x41059f[_0x2261f0(0xba)](0xc8)[_0x2261f0(0x14d)]({'product_data':_0x15ab34,'master':_0x43f003});}catch(_0x4cc3be){console[_0x2261f0(0x154)]('add_purchases\x20error',_0x4cc3be);}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0x1bc),auth,async(_0x3d3724,_0x420e64)=>{var _0x1872f2=a0_0x1c0850;try{const {invoice:_0x321f75,date:_0x378b63,warehouse_name:_0x122e3d,prod_name:_0x30bc30,note:_0x43675a,due_amount:_0x58e502,Room_name:_0x43b602,PO_number:_0x59f246,SCRN:_0x3cdbd4,ReqBy:_0x2740e0,dateofreq:_0x357f20,suppliers:_0x54106c,typeservicesData:_0x4e964e,van:_0x1fee26,typevehicle:_0x413025,driver:_0x5c03e6,plate:_0x2f4763,DRSI:_0x1707be,TSU:_0x4ea37d,TFU:_0x3ec794,JO_number:_0x5a9caa,type_of_products:_0x40edec}=_0x3d3724[_0x1872f2(0xec)];if(typeof _0x30bc30==_0x1872f2(0xc2))var _0x2184b8=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x1b2)]],_0x34cc13=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x142)]],_0x9f9ef4=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x130)]],_0x30b271=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0xeb)]],_0x39196c=[_0x3d3724['body'][_0x1872f2(0x13e)]],_0x5bf3b2=[_0x3d3724[_0x1872f2(0xec)]['prod_level']],_0x48861e=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0xe4)]],_0x24fb37=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x1b7)]],_0x38a458=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x14e)]],_0xd3e80e=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x120)]],_0x47f0f5=[_0x3d3724[_0x1872f2(0xec)]['expiry_date']],_0xd839c=[_0x3d3724['body'][_0x1872f2(0x193)]],_0x5cb393=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0xf0)]],_0x2bde1a=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x104)]],_0x151583=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x17d)]],_0x138203=[_0x3d3724['body'][_0x1872f2(0x194)]],_0x4c2760=[_0x3d3724['body'][_0x1872f2(0x100)]],_0x523f3d=[_0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x101)]],_0x26f2d8=[_0x3d3724[_0x1872f2(0xec)]['product_id']];else var _0x2184b8=[..._0x3d3724['body']['prod_name']],_0x34cc13=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x142)]],_0x9f9ef4=[..._0x3d3724['body'][_0x1872f2(0x130)]],_0x30b271=[..._0x3d3724['body'][_0x1872f2(0xeb)]],_0x39196c=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x13e)]],_0x5bf3b2=[..._0x3d3724['body']['prod_level']],_0x48861e=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0xe4)]],_0x24fb37=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x1b7)]],_0x38a458=[..._0x3d3724['body']['MaxStocks_data']],_0xd3e80e=[..._0x3d3724['body'][_0x1872f2(0x120)]],_0x47f0f5=[..._0x3d3724[_0x1872f2(0xec)]['expiry_date']],_0xd839c=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x193)]],_0x5cb393=[..._0x3d3724['body'][_0x1872f2(0xf0)]],_0x2bde1a=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x104)]],_0x151583=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x17d)]],_0x138203=[..._0x3d3724[_0x1872f2(0xec)][_0x1872f2(0x194)]],_0x4c2760=[..._0x3d3724['body'][_0x1872f2(0x100)]],_0x523f3d=[..._0x3d3724['body'][_0x1872f2(0x101)]],_0x26f2d8=[..._0x3d3724['body'][_0x1872f2(0x13b)]];const _0xa94ae3=_0x2184b8[_0x1872f2(0xc5)](_0x1d4643=>{return _0x1d4643={'product_name':_0x1d4643};});_0x26f2d8['forEach']((_0x321b59,_0x2648a1)=>{var _0x3a9392=_0x1872f2;_0xa94ae3[_0x2648a1][_0x3a9392(0x13b)]=_0x321b59,_0xa94ae3[_0x2648a1][_0x3a9392(0x12c)]=_0x378b63;}),_0x523f3d[_0x1872f2(0x91)]((_0xbbee2e,_0x2467bf)=>{_0xa94ae3[_0x2467bf]['sales_category']=_0xbbee2e;}),_0x34cc13[_0x1872f2(0x91)]((_0x299535,_0x222707)=>{_0xa94ae3[_0x222707]['product_code']=_0x299535;}),_0x4c2760[_0x1872f2(0x91)]((_0x557070,_0x17ce50)=>{var _0x383f8a=_0x1872f2;_0xa94ae3[_0x17ce50][_0x383f8a(0x100)]=_0x557070;}),_0x9f9ef4['forEach']((_0x3efdef,_0x4f1699)=>{var _0x392e76=_0x1872f2;_0xa94ae3[_0x4f1699][_0x392e76(0xcd)]=Math[_0x392e76(0xb1)](_0x3efdef);}),_0x30b271[_0x1872f2(0x91)]((_0x381689,_0x40c291)=>{var _0x2a916d=_0x1872f2;_0xa94ae3[_0x40c291][_0x2a916d(0x139)]=_0x381689;}),_0x39196c[_0x1872f2(0x91)]((_0x99b03e,_0x501f0c)=>{var _0x49cde8=_0x1872f2;_0xa94ae3[_0x501f0c][_0x49cde8(0x195)]=_0x99b03e;}),_0x48861e['forEach']((_0x24ab50,_0xd6755d)=>{var _0x3c8d9a=_0x1872f2;_0xa94ae3[_0xd6755d][_0x3c8d9a(0xe4)]=_0x24ab50;}),_0x24fb37['forEach']((_0x16c5f6,_0x3828d8)=>{var _0x53cba1=_0x1872f2;_0xa94ae3[_0x3828d8][_0x53cba1(0x1b7)]=_0x16c5f6;}),_0x38a458[_0x1872f2(0x91)]((_0x539811,_0x246993)=>{_0xa94ae3[_0x246993]['maxStocks']=_0x539811;}),_0xd3e80e[_0x1872f2(0x91)]((_0x5d9b2f,_0x78be18)=>{var _0x328882=_0x1872f2;_0xa94ae3[_0x78be18][_0x328882(0x120)]=_0x5d9b2f;}),_0x47f0f5['forEach']((_0x47c048,_0xab9563)=>{var _0x5251a1=_0x1872f2;_0xa94ae3[_0xab9563][_0x5251a1(0x8a)]=_0x47c048;}),_0xd839c['forEach']((_0x5d447c,_0x2914a9)=>{var _0x1fb92e=_0x1872f2;_0xa94ae3[_0x2914a9][_0x1fb92e(0x16a)]=_0x5d447c;}),_0x5cb393[_0x1872f2(0x91)]((_0x2967d7,_0x3d7fe3)=>{var _0x514d8a=_0x1872f2;_0xa94ae3[_0x3d7fe3][_0x514d8a(0x164)]=_0x2967d7;}),_0x2bde1a['forEach']((_0xd9183e,_0x33de69)=>{var _0x155f2d=_0x1872f2;_0xa94ae3[_0x33de69][_0x155f2d(0x18d)]=_0xd9183e;}),_0x151583['forEach']((_0x49f1a8,_0x441592)=>{var _0x5b41d2=_0x1872f2;_0xa94ae3[_0x441592][_0x5b41d2(0x8f)]=_0x49f1a8;}),_0x138203[_0x1872f2(0x91)]((_0x3cf06a,_0xea9307)=>{var _0xe81497=_0x1872f2;_0xa94ae3[_0xea9307][_0xe81497(0x194)]=_0x3cf06a;});const _0x31e2aa=new invoice_for_incoming();await _0x31e2aa[_0x1872f2(0xda)]();for(let _0x2a20fc=0x0;_0x2a20fc<=_0x151583[_0x1872f2(0xf3)]-0x1;_0x2a20fc++){_0xa94ae3[_0x2a20fc]['invoice']=_0x1872f2(0xab)+_0x31e2aa[_0x1872f2(0x124)][_0x1872f2(0x11b)]()[_0x1872f2(0x18b)](0x8,'0');}const _0x2e5fc3=await warehouse_validation_setup[_0x1872f2(0x141)]([{'$match':{'warehouse_name':_0x122e3d}}]);let _0x4a17cd=[];for(let _0x553977=0x0;_0x553977<=_0xa94ae3[_0x1872f2(0xf3)]-0x1;_0x553977++){const _0x43da02=_0xa94ae3[_0x553977];for(let _0x15a8af=0x0;_0x15a8af<=_0x2e5fc3[_0x1872f2(0xf3)]-0x1;_0x15a8af++){const _0x3f6fa9=_0x2e5fc3[_0x15a8af];for(let _0x1f54b0=0x0;_0x1f54b0<=_0x3f6fa9[_0x1872f2(0xb9)]['length']-0x1;_0x1f54b0++){const _0x2a0a64=_0x3f6fa9[_0x1872f2(0xb9)][_0x1f54b0];if(_0x2a0a64[_0x1872f2(0x171)]===_0x43da02[_0x1872f2(0x171)]){let _0x5f18bd=_0x43da02[_0x1872f2(0xcd)];const _0x483817=await warehouse[_0x1872f2(0x141)]([{'$match':{'name':_0x122e3d,'room':_0x3f6fa9[_0x1872f2(0xbd)]}},{'$unwind':_0x1872f2(0x180)},{'$match':{'level':_0x2a0a64[_0x1872f2(0x126)],'bay':_0x2a0a64[_0x1872f2(0xfc)]}}]);if(_0x483817[_0x1872f2(0xf3)]==0x0){for(let _0x379e93=0x0;_0x379e93<=_0x3f6fa9[_0x1872f2(0xb9)][_0x1872f2(0xf3)]-0x1&&_0x5f18bd>0x0;_0x379e93++){const _0x2c1b82=_0x3f6fa9[_0x1872f2(0xb9)][_0x379e93];if(_0x43da02[_0x1872f2(0x171)]===_0x2c1b82[_0x1872f2(0x171)]){_0x4a17cd[_0x379e93]={};const _0x3bb9ef=parseInt(_0x2c1b82[_0x1872f2(0x184)]),_0x462859=0x0;let _0xc9c1f=_0x3bb9ef-_0x462859,_0x1c72b6=Math[_0x1872f2(0x196)](_0x5f18bd,_0xc9c1f);console[_0x1872f2(0x154)](_0x1872f2(0x19a)+_0x1c72b6+_0x1872f2(0x105)+_0x3f6fa9[_0x1872f2(0xa3)]+_0x1872f2(0x16b)+_0x3f6fa9[_0x1872f2(0xbd)]+_0x1872f2(0xbc)+_0x2c1b82[_0x1872f2(0x126)]+_0x1872f2(0x15b)+_0x2c1b82[_0x1872f2(0xfc)]),_0x4a17cd[_0x379e93][_0x1872f2(0x119)]=_0x43da02[_0x1872f2(0x119)],_0x4a17cd[_0x379e93][_0x1872f2(0x171)]=_0x43da02[_0x1872f2(0x171)],_0x4a17cd[_0x379e93][_0x1872f2(0x13b)]=_0x43da02[_0x1872f2(0x13b)],_0x4a17cd[_0x379e93][_0x1872f2(0x12c)]=_0x43da02[_0x1872f2(0x12c)],_0x4a17cd[_0x379e93][_0x1872f2(0x1a1)]=_0x43da02['sales_category'],_0x4a17cd[_0x379e93][_0x1872f2(0x100)]=_0x43da02[_0x1872f2(0x100)],_0x4a17cd[_0x379e93][_0x1872f2(0xcd)]=_0x1c72b6,_0x4a17cd[_0x379e93][_0x1872f2(0x139)]=_0x43da02[_0x1872f2(0x139)],_0x4a17cd[_0x379e93][_0x1872f2(0x195)]=_0x43da02[_0x1872f2(0x195)],_0x4a17cd[_0x379e93][_0x1872f2(0xe4)]=_0x43da02[_0x1872f2(0xe4)],_0x4a17cd[_0x379e93][_0x1872f2(0x1b7)]=_0x43da02[_0x1872f2(0x1b7)],_0x4a17cd[_0x379e93][_0x1872f2(0xea)]=_0x43da02['maxStocks'],_0x4a17cd[_0x379e93][_0x1872f2(0x120)]=_0x43da02[_0x1872f2(0x120)],_0x4a17cd[_0x379e93]['expiry_date']=_0x43da02['expiry_date'],_0x4a17cd[_0x379e93][_0x1872f2(0x16a)]=_0x43da02['production_date'],_0x4a17cd[_0x379e93][_0x1872f2(0x164)]=_0x43da02[_0x1872f2(0x164)],_0x4a17cd[_0x379e93][_0x1872f2(0x18d)]=_0x43da02['product_cat'],_0x4a17cd[_0x379e93][_0x1872f2(0x127)]=_0x43da02[_0x1872f2(0x127)],_0x4a17cd[_0x379e93][_0x1872f2(0x194)]=_0x43da02['gross_price'],_0x4a17cd[_0x379e93][_0x1872f2(0x8f)]=_0x3f6fa9['room'],_0x4a17cd[_0x379e93][_0x1872f2(0xd3)]=_0x2c1b82[_0x1872f2(0x126)],_0x4a17cd[_0x379e93][_0x1872f2(0x126)]=_0x2c1b82[_0x1872f2(0xfc)],_0x5f18bd-=_0x1c72b6;if(_0x5f18bd<=0x0)break;}}if(_0x5f18bd<=0x0)break;_0x5f18bd>0x0&&console[_0x1872f2(0x154)]('There\x20is\x20'+_0x5f18bd+_0x1872f2(0xe2));}}}}}const _0x59588b=_0x4a17cd[_0x1872f2(0x96)]((_0x36ce15,_0x333467)=>{if(_0x333467>0x0)return{'item':_0x36ce15};}),_0x4dde3a=_0x59588b[_0x1872f2(0x96)](_0x172af8=>_0x172af8[_0x1872f2(0xcd)]!=='0'&&_0x172af8[_0x1872f2(0xcd)]!==''),_0x4b3e84=new purchases_finished({'invoice':_0x1872f2(0xab)+_0x31e2aa['invoice_init'][_0x1872f2(0x11b)]()['padStart'](0x8,'0'),'suppliers':_0x54106c,'date':_0x378b63,'warehouse_name':_0x122e3d,'product':_0x4dde3a,'note':_0x43675a,'due_amount':_0x58e502,'room':_0x43b602,'POnumber':_0x59f246,'SCRN':_0x3cdbd4,'JO_number':_0x5a9caa,'ReqBy':_0x2740e0,'dateofreq':_0x357f20,'typeservicesData':_0x4e964e,'van':_0x1fee26,'typevehicle':_0x413025,'driver':_0x5c03e6,'plate':_0x2f4763,'DRSI':_0x1707be,'TSU':_0x4ea37d,'TFU':_0x3ec794,'typeOfProducts':_0x40edec}),_0x49f609=await _0x4b3e84[_0x1872f2(0xda)](),_0x52a3af=await purchases_finished[_0x1872f2(0x149)]({'_id':_0x49f609[_0x1872f2(0xac)][_0x1872f2(0xca)]()});_0x3d3724[_0x1872f2(0xf1)](_0x1872f2(0x102),'purchase\x20data\x20add\x20successfully'),_0x420e64[_0x1872f2(0x112)](_0x1872f2(0x106)+_0x52a3af['_id']['valueOf']());}catch(_0x542aa2){console['log'](_0x542aa2);}}),router['get'](a0_0x1c0850(0xde),auth,async(_0x13f0cd,_0x5138e8)=>{var _0x6218d=a0_0x1c0850;try{const {username:_0x372cce,email:_0x2d4b2b,role:_0x27da13}=_0x13f0cd[_0x6218d(0x17e)],_0x364018=_0x13f0cd[_0x6218d(0x17e)],_0x5d73a4=_0x13f0cd[_0x6218d(0x156)]['id'],_0x5c6201=await profile[_0x6218d(0x149)]({'email':_0x364018[_0x6218d(0x15e)]}),_0x12b408=await master_shop['find'](),_0x90aaa8=await staff['findOne']({'email':_0x364018['email']}),_0x3fc4c8=await suppliers[_0x6218d(0x1c2)]({});let _0x2b86a6;if(_0x364018[_0x6218d(0x19f)]==_0x6218d(0xa6)){const _0x21b222=await staff[_0x6218d(0x149)]({'email':_0x364018[_0x6218d(0x15e)]});_0x2b86a6=await warehouse[_0x6218d(0x141)]([{'$match':{'status':_0x6218d(0x17c),'name':_0x21b222[_0x6218d(0xcc)]}},{'$group':{'_id':_0x6218d(0x1a9),'name':{'$first':'$name'}}}]);}else _0x2b86a6=await warehouse['aggregate']([{'$match':{'status':_0x6218d(0x17c)}},{'$group':{'_id':_0x6218d(0x1a9),'name':{'$first':_0x6218d(0x1a9)}}}]);const _0x441a69=await purchases_finished[_0x6218d(0x1a7)](_0x5d73a4);if(_0x12b408[0x0][_0x6218d(0x155)]==_0x6218d(0x1c0))var _0x81f4e5=users[_0x6218d(0xd0)];else{if(_0x12b408[0x0]['language']=='Hindi')var _0x81f4e5=users[_0x6218d(0x1b4)];else{if(_0x12b408[0x0]['language']=='German')var _0x81f4e5=users[_0x6218d(0x15a)];else{if(_0x12b408[0x0][_0x6218d(0x155)]==_0x6218d(0x19d))var _0x81f4e5=users[_0x6218d(0x19d)];else{if(_0x12b408[0x0][_0x6218d(0x155)]==_0x6218d(0xe6))var _0x81f4e5=users[_0x6218d(0xe6)];else{if(_0x12b408[0x0][_0x6218d(0x155)]==_0x6218d(0x186))var _0x81f4e5=users[_0x6218d(0x1bb)];else{if(_0x12b408[0x0][_0x6218d(0x155)]=='Chinese')var _0x81f4e5=users[_0x6218d(0xe8)];else{if(_0x12b408[0x0][_0x6218d(0x155)]==_0x6218d(0x94))var _0x81f4e5=users[_0x6218d(0x8c)];}}}}}}}_0x5138e8[_0x6218d(0x128)](_0x6218d(0x110),{'success':_0x13f0cd['flash']('success'),'errors':_0x13f0cd['flash'](_0x6218d(0xc3)),'role':_0x364018,'profile':_0x5c6201,'suppliers':_0x3fc4c8,'warehouse':_0x2b86a6,'master_shop':_0x12b408,'language':_0x81f4e5,'purchases_data':_0x441a69});}catch(_0x4fed93){console[_0x6218d(0x154)](_0x4fed93);}});async function get_warehouse_data(_0x29d0ec,_0x1ae60d){var _0x43aa8e=a0_0x1c0850;try{const _0x2aae51=await warehouse_temporary[_0x43aa8e(0x149)]({'name':_0x29d0ec,'room':_0x1ae60d});if(!_0x2aae51){const _0xd33550=new warehouse_temporary({'name':_0x29d0ec,'address':_0x29d0ec,'status':_0x43aa8e(0x17c),'room':_0x1ae60d,'isStaging':_0x43aa8e(0x145)});return await _0xd33550['save'](),_0xd33550;}else return _0x2aae51;}catch(_0x2321b4){console[_0x43aa8e(0x10a)]('Error\x20fetching\x20or\x20saving\x20warehouse\x20data:',_0x2321b4);throw _0x2321b4;}}router[a0_0x1c0850(0x11f)](a0_0x1c0850(0xde),auth,async(_0x3e7140,_0x4414bb)=>{var _0x39eaf7=a0_0x1c0850;try{const _0x3b5101=_0x3e7140[_0x39eaf7(0x156)]['id'],_0x4c1af4=await purchases_finished[_0x39eaf7(0x1a7)](_0x3b5101);let _0x1c2feb=[];_0x4c1af4[_0x39eaf7(0x93)][_0x39eaf7(0x91)]((_0x2ac76f,_0x35a6fa)=>{var _0x40a6d7=_0x39eaf7;_0x1c2feb[_0x35a6fa]={},_0x1c2feb[_0x35a6fa][_0x40a6d7(0xcc)]=_0x4c1af4[_0x40a6d7(0xa3)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x13b)]=_0x2ac76f[_0x40a6d7(0x13b)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x119)]=_0x2ac76f[_0x40a6d7(0x119)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x171)]=_0x2ac76f['product_code'],_0x1c2feb[_0x35a6fa]['quantity']=_0x2ac76f['quantity'],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x139)]=_0x2ac76f['standard_unit'],_0x1c2feb[_0x35a6fa]['secondary_unit']=_0x2ac76f[_0x40a6d7(0x195)],_0x1c2feb[_0x35a6fa]['level']=_0x2ac76f[_0x40a6d7(0xd3)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x126)]=_0x2ac76f[_0x40a6d7(0x126)],_0x1c2feb[_0x35a6fa]['primary_code']=_0x2ac76f['primary_code'],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x1b7)]=_0x2ac76f[_0x40a6d7(0x1b7)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0xea)]=_0x2ac76f[_0x40a6d7(0xea)],_0x1c2feb[_0x35a6fa]['batch_code']=_0x2ac76f[_0x40a6d7(0x120)],_0x1c2feb[_0x35a6fa]['expiry_date']=_0x2ac76f[_0x40a6d7(0x8a)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x16a)]=_0x2ac76f[_0x40a6d7(0x16a)],_0x1c2feb[_0x35a6fa]['maxperunit']=_0x2ac76f[_0x40a6d7(0x164)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x18d)]=_0x2ac76f[_0x40a6d7(0x18d)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x8f)]=_0x2ac76f['room_name'],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x127)]=_0x2ac76f[_0x40a6d7(0x127)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x100)]=_0x2ac76f[_0x40a6d7(0x100)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x194)]=_0x2ac76f[_0x40a6d7(0x194)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x1a1)]=_0x2ac76f[_0x40a6d7(0x1a1)],_0x1c2feb[_0x35a6fa][_0x40a6d7(0x12c)]=_0x2ac76f[_0x40a6d7(0x12c)],_0x1c2feb[_0x35a6fa]['purchases_id']=_0x2ac76f[_0x40a6d7(0xac)][_0x40a6d7(0xca)]();});for(let _0xe3181d=0x0;_0xe3181d<=_0x1c2feb[_0x39eaf7(0xf3)]-0x1;_0xe3181d++){const _0x2ba155=_0x1c2feb[_0xe3181d],_0x3be74d=new warehouse_temporary(_0x2ba155);await _0x3be74d['save']();}_0x4c1af4['isProcess']=_0x39eaf7(0xb5),await _0x4c1af4['save'](),_0x3e7140[_0x39eaf7(0xf1)]('success','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x4414bb[_0x39eaf7(0x112)](_0x39eaf7(0x106)+_0x4c1af4[_0x39eaf7(0xac)][_0x39eaf7(0xca)]());}catch(_0x16dc06){}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0xad),auth,async(_0x5513a1,_0x5cd5dd)=>{var _0x42814f=a0_0x1c0850;try{const {invoice:_0x41a7f6,date:_0x1b7a73,warehouse_name:_0x13f3e8,prod_name:_0x4bac7b,note:_0xfa64fc,due_amount:_0x1c27dd,Room_name:_0x32c0fd,PO_number:_0x222819,SCRN:_0x37d71a,ReqBy:_0xdb410,dateofreq:_0x27b151,suppliers:_0x4b97bf,typeservicesData:_0x34e6f2,van:_0x1b432b,typevehicle:_0x3b19b5,driver:_0x18f370,plate:_0x57a025,DRSI:_0x217911,TSU:_0x2f74ec,TFU:_0x16ca86,JO_number:_0x5a454b,type_of_products:_0x2d158b}=_0x5513a1[_0x42814f(0xec)];if(typeof _0x4bac7b==_0x42814f(0xc2))var _0x2c4067=[_0x5513a1['body']['prod_name']],_0x4deb5a=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0x142)]],_0x1f1277=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0x130)]],_0x5b096c=[_0x5513a1['body']['prod_primunit']],_0xd81c45=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0x13e)]],_0x57f55a=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0xee)]],_0x55d1fc=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0xe4)]],_0x544d7a=[_0x5513a1['body'][_0x42814f(0x1b7)]],_0x5096ae=[_0x5513a1[_0x42814f(0xec)]['MaxStocks_data']],_0x8e3119=[_0x5513a1['body'][_0x42814f(0x120)]],_0x48406d=[_0x5513a1['body'][_0x42814f(0x8a)]],_0xc989a8=[_0x5513a1['body'][_0x42814f(0x193)]],_0x69942=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0xf0)]],_0x3667ff=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0x104)]],_0x323217=[_0x5513a1['body']['RoomAssign']],_0x1a38f2=[_0x5513a1[_0x42814f(0xec)]['gross_price']],_0x480809=[_0x5513a1[_0x42814f(0xec)][_0x42814f(0x100)]],_0x2623d4=[_0x5513a1[_0x42814f(0xec)]['sales_data_cateory']],_0x2500d5=[_0x5513a1[_0x42814f(0xec)]['type_of_products_type']];else var _0x2c4067=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x1b2)]],_0x4deb5a=[..._0x5513a1[_0x42814f(0xec)]['prod_code']],_0x1f1277=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x130)]],_0x5b096c=[..._0x5513a1[_0x42814f(0xec)]['prod_primunit']],_0xd81c45=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x13e)]],_0x57f55a=[..._0x5513a1['body']['prod_level']],_0x55d1fc=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0xe4)]],_0x544d7a=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x1b7)]],_0x5096ae=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x14e)]],_0x8e3119=[..._0x5513a1['body'][_0x42814f(0x120)]],_0x48406d=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x8a)]],_0xc989a8=[..._0x5513a1['body'][_0x42814f(0x193)]],_0x69942=[..._0x5513a1[_0x42814f(0xec)]['max_product_unit']],_0x3667ff=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x104)]],_0x323217=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x17d)]],_0x1a38f2=[..._0x5513a1['body'][_0x42814f(0x194)]],_0x480809=[..._0x5513a1['body'][_0x42814f(0x100)]],_0x2623d4=[..._0x5513a1[_0x42814f(0xec)][_0x42814f(0x101)]],_0x2500d5=[..._0x5513a1[_0x42814f(0xec)]['type_of_products_type']];const _0x12b1d7=_0x2c4067[_0x42814f(0xc5)](_0x3675af=>{return _0x3675af={'product_name':_0x3675af};});_0x2500d5[_0x42814f(0x91)]((_0x470b75,_0x30ddf4)=>{_0x12b1d7[_0x30ddf4]['type_of_products']=_0x470b75;}),_0x2623d4['forEach']((_0x3a22f5,_0x2abc91)=>{var _0x59e145=_0x42814f;_0x12b1d7[_0x2abc91][_0x59e145(0x1a1)]=_0x3a22f5;}),_0x4deb5a[_0x42814f(0x91)]((_0x214fd5,_0x350811)=>{var _0x2a2fc5=_0x42814f;_0x12b1d7[_0x350811][_0x2a2fc5(0x171)]=_0x214fd5;}),_0x480809[_0x42814f(0x91)]((_0x4df998,_0x47edb8)=>{var _0x11a612=_0x42814f;_0x12b1d7[_0x47edb8][_0x11a612(0x100)]=_0x4df998;}),_0x1f1277['forEach']((_0x54756c,_0x567a5c)=>{var _0x43b60e=_0x42814f;_0x12b1d7[_0x567a5c][_0x43b60e(0xcd)]=Math[_0x43b60e(0xb1)](_0x54756c);}),_0x5b096c[_0x42814f(0x91)]((_0x457143,_0x7c1809)=>{_0x12b1d7[_0x7c1809]['standard_unit']=_0x457143;}),_0xd81c45[_0x42814f(0x91)]((_0x439f55,_0x57af7f)=>{_0x12b1d7[_0x57af7f]['secondary_unit']=_0x439f55;}),_0x57f55a['forEach']((_0xdc59ac,_0x528edd)=>{var _0x40bef2=_0x42814f,_0x32e72f=_0xdc59ac[_0x40bef2(0x8d)](/[A-Za-z]+/)[0x0],_0x14ad74=parseInt(_0xdc59ac[_0x40bef2(0x8d)](/\d+/)[0x0]);_0x12b1d7[_0x528edd][_0x40bef2(0xd3)]=_0x32e72f,_0x12b1d7[_0x528edd][_0x40bef2(0x126)]=_0x14ad74;}),_0x55d1fc[_0x42814f(0x91)]((_0x2c5009,_0x3334f0)=>{_0x12b1d7[_0x3334f0]['primary_code']=_0x2c5009;}),_0x544d7a['forEach']((_0x2336be,_0x3722a6)=>{_0x12b1d7[_0x3722a6]['secondary_code']=_0x2336be;}),_0x5096ae[_0x42814f(0x91)]((_0x321b01,_0x461789)=>{var _0x541a67=_0x42814f;_0x12b1d7[_0x461789][_0x541a67(0xea)]=_0x321b01;}),_0x8e3119['forEach']((_0x1b8359,_0x18ea16)=>{var _0x494cba=_0x42814f;_0x12b1d7[_0x18ea16][_0x494cba(0x120)]=_0x1b8359;}),_0x48406d[_0x42814f(0x91)]((_0x7d7c42,_0x43cb29)=>{_0x12b1d7[_0x43cb29]['expiry_date']=_0x7d7c42;}),_0xc989a8[_0x42814f(0x91)]((_0x2d8b8f,_0x88f6a9)=>{var _0x18e88f=_0x42814f;_0x12b1d7[_0x88f6a9][_0x18e88f(0x16a)]=_0x2d8b8f;}),_0x69942[_0x42814f(0x91)]((_0x1eaf02,_0x362bed)=>{var _0x1517c1=_0x42814f;_0x12b1d7[_0x362bed][_0x1517c1(0x164)]=_0x1eaf02;}),_0x3667ff['forEach']((_0x27d083,_0x1ba318)=>{var _0x220c46=_0x42814f;_0x12b1d7[_0x1ba318][_0x220c46(0x18d)]=_0x27d083;}),_0x323217[_0x42814f(0x91)]((_0x28ba00,_0x5849d5)=>{_0x12b1d7[_0x5849d5]['room_name']=_0x28ba00;}),_0x1a38f2[_0x42814f(0x91)]((_0x3fa7c3,_0x4a9578)=>{_0x12b1d7[_0x4a9578]['gross_price']=_0x3fa7c3;});const _0x6107a9=new purchases_logs();await _0x6107a9[_0x42814f(0xda)]();for(let _0x3edc8b=0x0;_0x3edc8b<=_0x323217[_0x42814f(0xf3)]-0x1;_0x3edc8b++){_0x12b1d7[_0x3edc8b][_0x42814f(0x127)]='LOG-INC-'+_0x6107a9[_0x42814f(0x124)]['toString']()['padStart'](0x8,'0');}const _0x443f24=_0x12b1d7[_0x42814f(0x96)](_0x3769e5=>_0x3769e5[_0x42814f(0xcd)]!=='0'&&_0x3769e5[_0x42814f(0xcd)]!==''),_0x14be88=new purchases_finished({'invoice':_0x42814f(0x17a)+_0x6107a9[_0x42814f(0x124)]['toString']()[_0x42814f(0x18b)](0x8,'0'),'suppliers':_0x4b97bf,'date':_0x1b7a73,'warehouse_name':_0x13f3e8,'product':_0x443f24,'note':_0xfa64fc,'due_amount':_0x1c27dd,'room':_0x32c0fd,'POnumber':_0x222819,'SCRN':_0x37d71a,'JO_number':_0x5a454b,'ReqBy':_0xdb410,'dateofreq':_0x27b151,'typeservicesData':_0x34e6f2,'van':_0x1b432b,'typevehicle':_0x3b19b5,'driver':_0x18f370,'plate':_0x57a025,'DRSI':_0x217911,'TSU':_0x2f74ec,'TFU':_0x16ca86,'typeOfProducts':_0x2d158b}),_0x27159c=await _0x14be88[_0x42814f(0xda)](),_0x42f967=await purchases_finished[_0x42814f(0x149)]({'_id':_0x27159c[_0x42814f(0xac)][_0x42814f(0xca)]()}),_0x2547fd=_0x42f967['product'][_0x42814f(0xc5)](async _0x43ab50=>{var _0x35da86=_0x42814f;try{var _0x5dcfcc=await warehouse['findOne']({'name':_0x13f3e8,'room':_0x43ab50[_0x35da86(0x8f)]}),_0x54fad5=0x0;const _0x3c8352=_0x5dcfcc['product_details'][_0x35da86(0xc5)](_0x4af239=>{var _0x2b8ed5=_0x35da86;console[_0x2b8ed5(0x154)](_0x4af239[_0x2b8ed5(0x119)]+'=='+_0x43ab50[_0x2b8ed5(0x119)]+'&&'+_0x4af239[_0x2b8ed5(0x126)]+'=='+_0x43ab50[_0x2b8ed5(0x126)]+'&&'+_0x4af239[_0x2b8ed5(0x8a)]+'=='+_0x43ab50[_0x2b8ed5(0x8a)]+'&&'+_0x4af239['production_date']+'=='+_0x43ab50[_0x2b8ed5(0x16a)]+'&&'+_0x4af239[_0x2b8ed5(0x120)]+'=='+_0x43ab50[_0x2b8ed5(0x120)]+'&&'+_0x4af239[_0x2b8ed5(0x127)]+'=='+_0x42f967[_0x2b8ed5(0x127)]),_0x4af239[_0x2b8ed5(0x119)]==_0x43ab50[_0x2b8ed5(0x119)]&&_0x4af239[_0x2b8ed5(0x126)]==_0x43ab50[_0x2b8ed5(0x126)]&&_0x4af239[_0x2b8ed5(0xd3)]==_0x43ab50[_0x2b8ed5(0xd3)]&&_0x4af239[_0x2b8ed5(0x8a)]==_0x43ab50[_0x2b8ed5(0x8a)]&&_0x4af239[_0x2b8ed5(0x16a)]==_0x43ab50['production_date']&&_0x4af239['batch_code']==_0x43ab50[_0x2b8ed5(0x120)]&&_0x4af239[_0x2b8ed5(0x127)]==_0x42f967[_0x2b8ed5(0x127)]&&(_0x4af239['product_stock']=Math[_0x2b8ed5(0xb1)](_0x4af239[_0x2b8ed5(0x12f)])+Math[_0x2b8ed5(0xb1)](_0x43ab50[_0x2b8ed5(0xcd)]),_0x54fad5++);});return _0x54fad5==0x0&&(_0x5dcfcc[_0x35da86(0x1ae)]=_0x5dcfcc['product_details'][_0x35da86(0x153)]({'product_name':_0x43ab50['product_name'],'product_stock':Math[_0x35da86(0xb1)](_0x43ab50[_0x35da86(0xcd)]),'primary_code':_0x43ab50['primary_code'],'secondary_code':_0x43ab50[_0x35da86(0x1b7)],'product_code':_0x43ab50[_0x35da86(0x171)],'bay':_0x43ab50[_0x35da86(0x126)],'level':_0x43ab50[_0x35da86(0xd3)],'maxProducts':_0x43ab50['maxStocks'],'unit':_0x43ab50[_0x35da86(0x139)],'secondary_unit':_0x43ab50['secondary_unit'],'expiry_date':_0x43ab50[_0x35da86(0x8a)],'production_date':_0x43ab50['production_date'],'maxProducts':_0x43ab50[_0x35da86(0xea)],'maxPerUnit':_0x43ab50['maxperunit'],'batch_code':_0x43ab50['batch_code'],'product_cat':_0x43ab50[_0x35da86(0x18d)],'invoice':_0x43ab50[_0x35da86(0x127)],'id_incoming':_0x43ab50[_0x35da86(0xac)],'uuid':_0x43ab50[_0x35da86(0x100)],'gross_price':_0x43ab50[_0x35da86(0x194)],'sales_category':_0x43ab50['sales_category'],'type_products':_0x43ab50['type_of_products']})),_0x5dcfcc;}catch(_0x1c42b5){return console[_0x35da86(0x10a)](_0x35da86(0x8e),_0x1c42b5),null;}});Promise[_0x42814f(0xcb)](_0x2547fd)[_0x42814f(0x9d)](async _0x3fc53b=>{var _0x5b765d=_0x42814f;try{for(const _0x2c9e2a of _0x3fc53b){await warehouse[_0x5b765d(0xb7)]({'_id':_0x2c9e2a[_0x5b765d(0xac)]},{'$addToSet':{'product_details':{'$each':_0x2c9e2a[_0x5b765d(0x1ae)]}}});}const _0xfcc2d=await master_shop[_0x5b765d(0x1c2)](),_0x573bc5=await email_settings[_0x5b765d(0x149)](),_0x30376f=await supervisor_settings['find']();var _0x473504=_0x42f967[_0x5b765d(0x93)],_0x5efba8='',_0x392bf1;for(_0x392bf1 in _0x473504){var _0x456508='FG';_0x42f967[_0x5b765d(0xa3)]==_0x5b765d(0x152)&&(_0x456508='DG'),_0x5efba8+='<tr>'+_0x5b765d(0xf5)+_0x473504[_0x392bf1][_0x5b765d(0x119)]+_0x5b765d(0x1b0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x473504[_0x392bf1][_0x5b765d(0x171)]+_0x5b765d(0x1b0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x473504[_0x392bf1][_0x5b765d(0xcd)]+_0x5b765d(0x1b0)+_0x5b765d(0xf5)+_0x473504[_0x392bf1][_0x5b765d(0x139)]+_0x5b765d(0x1b0)+_0x5b765d(0xf5)+_0x473504[_0x392bf1][_0x5b765d(0x195)]+_0x5b765d(0x1b0)+_0x5b765d(0xf5)+_0x42f967['warehouse_name']+_0x5b765d(0x1b0)+_0x5b765d(0xf5)+_0x473504[_0x392bf1][_0x5b765d(0x8f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x456508+_0x473504[_0x392bf1]['bay']+_0x5b765d(0x1b0),_0x5b765d(0x173);}let _0x48bc0a=nodemailer[_0x5b765d(0x15c)]({'host':_0x573bc5[_0x5b765d(0x132)],'port':Number(_0x573bc5['port']),'secure':![],'auth':{'user':_0x573bc5[_0x5b765d(0x15e)],'pass':_0x573bc5[_0x5b765d(0x9e)]}}),_0x274d74={'from':_0x573bc5[_0x5b765d(0x15e)],'to':_0x30376f[0x0][_0x5b765d(0xf9)],'subject':_0x5b765d(0x192),'attachments':[{'filename':_0x5b765d(0xd7),'path':__dirname+_0x5b765d(0x129)+'/upload/'+_0xfcc2d[0x0][_0x5b765d(0x144)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x5b765d(0xe9)+_0x5b765d(0xb2)+_0x5b765d(0x1a3)+_0x5b765d(0xb2)+_0x5b765d(0x99)+_0x5b765d(0x1b8)+_0x5b765d(0xb2)+_0x5b765d(0x1ab)+_0xfcc2d[0x0][_0x5b765d(0x189)]+_0x5b765d(0xfe)+_0x5b765d(0x1b8)+_0x5b765d(0x1b8)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x5b765d(0x136)+'\x20Order\x20Number\x20:\x20'+_0x42f967[_0x5b765d(0x127)]+'\x20'+_0x5b765d(0xef)+'\x20Order\x20Date\x20:\x20'+_0x42f967[_0x5b765d(0x137)]+'\x20'+_0x5b765d(0x1b5)+_0x5b765d(0x92)+_0x5b765d(0x1b8)+_0x5b765d(0x174)+_0x5b765d(0x111)+_0x5b765d(0xd6)+_0x5b765d(0xaf)+_0x5b765d(0x1b1)+_0x5b765d(0xb3)+_0x5b765d(0x12d)+_0x5b765d(0xf6)+_0x5b765d(0x1ad)+_0x5b765d(0xc7)+_0x5b765d(0x116)+_0x5b765d(0x173)+_0x5b765d(0xfb)+_0x5b765d(0x181)+'\x20'+_0x5efba8+'\x20'+_0x5b765d(0x169)+_0x5b765d(0x150)+_0x5b765d(0xb2)+_0x5b765d(0x147)+'<h5>'+_0xfcc2d[0x0][_0x5b765d(0x189)]+'</h5>'+'</div>'+_0x5b765d(0x1b8)+'</body></html>'};_0x48bc0a[_0x5b765d(0x87)](_0x274d74,function(_0x1ed465,_0x35b485){var _0x5b0d4c=_0x5b765d;_0x1ed465?(console[_0x5b0d4c(0x154)](_0x1ed465),console[_0x5b0d4c(0x154)](_0x5b0d4c(0x143))):console[_0x5b0d4c(0x154)]('Email\x20sent\x20successfully');});}catch(_0x15838a){console['error'](_0x15838a),_0x5cd5dd[_0x5b765d(0xba)](0x1f4)[_0x5b765d(0x14d)]({'error':_0x5b765d(0x17f),'message':_0x15838a['message']});}})['catch'](_0x294d81=>{var _0x26996d=_0x42814f;console[_0x26996d(0x10a)](_0x294d81);}),_0x5513a1['flash'](_0x42814f(0x102),_0x42814f(0x14a)),_0x5cd5dd[_0x42814f(0x112)](_0x42814f(0xc9)+_0x42f967['_id'][_0x42814f(0xca)]());}catch(_0x15e8d7){console[_0x42814f(0x154)](_0x15e8d7);}}),router[a0_0x1c0850(0x16f)](a0_0x1c0850(0x1bd),auth,async(_0x7ee429,_0x1c04e3)=>{var _0x1f76c4=a0_0x1c0850;try{const {username:_0x54ccff,email:_0x5d777c,role:_0x39069b}=_0x7ee429[_0x1f76c4(0x17e)],_0x1d03ab=_0x7ee429[_0x1f76c4(0x17e)],_0xfb57da=await profile[_0x1f76c4(0x149)]({'email':_0x1d03ab[_0x1f76c4(0x15e)]}),_0x14d715=await master_shop[_0x1f76c4(0x1c2)](),_0x3d58f4=_0x7ee429['params']['id'],_0x236580=await purchases_finished[_0x1f76c4(0x1a7)](_0x3d58f4),_0x350cdb=await suppliers[_0x1f76c4(0x1c2)]({});let _0x39bd51;if(_0x1d03ab[_0x1f76c4(0x19f)]==_0x1f76c4(0xa6)){const _0x17b085=await staff[_0x1f76c4(0x149)]({'email':_0x1d03ab[_0x1f76c4(0x15e)]});_0x39bd51=await warehouse[_0x1f76c4(0x1c2)]({'status':'Enabled','name':_0x17b085[_0x1f76c4(0xcc)],'warehouse_category':_0x1f76c4(0x158)});}else _0x39bd51=await warehouse['aggregate']([{'$match':{'status':_0x1f76c4(0x17c),'warehouse_category':_0x1f76c4(0x158)}},{'$group':{'_id':_0x1f76c4(0x1a9),'name':{'$first':_0x1f76c4(0x1a9)}}}]);const _0xc95bc9=await product[_0x1f76c4(0x1c2)]({}),_0x5202f8=BayBinSelected(_0x236580[_0x1f76c4(0xa3)],_0x236580[_0x1f76c4(0xbd)]);let _0x4bf030=new Date(_0x236580[_0x1f76c4(0x8a)]),_0x1bcfaf=('0'+_0x4bf030[_0x1f76c4(0xa0)]())[_0x1f76c4(0x172)](-0x2),_0x297f99=('0'+(_0x4bf030['getMonth']()+0x1))[_0x1f76c4(0x172)](-0x2),_0x30c2f3=_0x4bf030[_0x1f76c4(0x10d)](),_0x2d775d=_0x30c2f3+'-'+_0x297f99+'-'+_0x1bcfaf;if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0x1c0)){var _0x3e3cd2=users[_0x1f76c4(0xd0)];console[_0x1f76c4(0x154)](_0x3e3cd2);}else{if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0x1b4))var _0x3e3cd2=users[_0x1f76c4(0x1b4)];else{if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0x15a))var _0x3e3cd2=users[_0x1f76c4(0x15a)];else{if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0x19d))var _0x3e3cd2=users[_0x1f76c4(0x19d)];else{if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0xe6))var _0x3e3cd2=users['French'];else{if(_0x14d715[0x0][_0x1f76c4(0x155)]=='Portuguese\x20(BR)')var _0x3e3cd2=users['Portuguese'];else{if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0xe8))var _0x3e3cd2=users[_0x1f76c4(0xe8)];else{if(_0x14d715[0x0][_0x1f76c4(0x155)]==_0x1f76c4(0x94))var _0x3e3cd2=users['Arabic'];}}}}}}}_0x1c04e3[_0x1f76c4(0x128)]('edit_purchases_finished_view',{'success':_0x7ee429[_0x1f76c4(0xf1)](_0x1f76c4(0x102)),'errors':_0x7ee429['flash'](_0x1f76c4(0xc3)),'role':_0x1d03ab,'profile':_0xfb57da,'purchases':_0x236580,'suppliers':_0x350cdb,'warehouse':_0x39bd51,'product':_0xc95bc9,'master_shop':_0x14d715,'language':_0x3e3cd2,'ed_fullDate':_0x2d775d,'dataSelected':_0x5202f8});}catch(_0x58f9a7){console[_0x1f76c4(0x154)](_0x58f9a7);}}),router[a0_0x1c0850(0x16f)](a0_0x1c0850(0x122),auth,async(_0x4c3e56,_0x459176)=>{var _0x351de9=a0_0x1c0850;try{const {username:_0x411f50,email:_0x196088,role:_0x2920de}=_0x4c3e56['user'],_0x34280a=_0x4c3e56['user'],_0x5bb393=await profile[_0x351de9(0x149)]({'email':_0x34280a['email']}),_0x46f911=await master_shop['find'](),_0x51035d=_0x4c3e56[_0x351de9(0x156)]['id'],_0x2c5787=await purchases_finished[_0x351de9(0x1a7)](_0x51035d),_0x5b5c6c=await suppliers[_0x351de9(0x1c2)]({});let _0x2aab88;if(_0x34280a[_0x351de9(0x19f)]==_0x351de9(0xa6)){const _0x64eda6=await staff[_0x351de9(0x149)]({'email':_0x34280a[_0x351de9(0x15e)]});_0x2aab88=await warehouse[_0x351de9(0x1c2)]({'status':_0x351de9(0x17c),'name':_0x64eda6[_0x351de9(0xcc)],'warehouse_category':'Finished\x20Goods'});}else _0x2aab88=await warehouse[_0x351de9(0x141)]([{'$match':{'status':'Enabled','warehouse_category':_0x351de9(0x158)}},{'$group':{'_id':'$name','name':{'$first':_0x351de9(0x1a9)}}}]);const _0x22e804=await product['find']({}),_0x43d47e=BayBinSelected(_0x2c5787['warehouse_name'],_0x2c5787['room']);let _0x3ae9a4=new Date(_0x2c5787['expiry_date']),_0x4f4973=('0'+_0x3ae9a4[_0x351de9(0xa0)]())[_0x351de9(0x172)](-0x2),_0x3ee8b0=('0'+(_0x3ae9a4[_0x351de9(0x14c)]()+0x1))[_0x351de9(0x172)](-0x2),_0x40ba89=_0x3ae9a4[_0x351de9(0x10d)](),_0x5de855=_0x40ba89+'-'+_0x3ee8b0+'-'+_0x4f4973;if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0x1c0)){var _0x1f7837=users[_0x351de9(0xd0)];console[_0x351de9(0x154)](_0x1f7837);}else{if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0x1b4))var _0x1f7837=users[_0x351de9(0x1b4)];else{if(_0x46f911[0x0]['language']==_0x351de9(0x15a))var _0x1f7837=users['German'];else{if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0x19d))var _0x1f7837=users['Spanish'];else{if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0xe6))var _0x1f7837=users[_0x351de9(0xe6)];else{if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0x186))var _0x1f7837=users[_0x351de9(0x1bb)];else{if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0xe8))var _0x1f7837=users[_0x351de9(0xe8)];else{if(_0x46f911[0x0][_0x351de9(0x155)]==_0x351de9(0x94))var _0x1f7837=users['Arabic'];}}}}}}}_0x459176[_0x351de9(0x128)]('edit_purchases_finished',{'success':_0x4c3e56[_0x351de9(0xf1)](_0x351de9(0x102)),'errors':_0x4c3e56[_0x351de9(0xf1)](_0x351de9(0xc3)),'role':_0x34280a,'profile':_0x5bb393,'purchases':_0x2c5787,'suppliers':_0x5b5c6c,'warehouse':_0x2aab88,'product':_0x22e804,'master_shop':_0x46f911,'language':_0x1f7837,'ed_fullDate':_0x5de855,'dataSelected':_0x43d47e});}catch(_0x4859d7){console[_0x351de9(0x154)](_0x4859d7);}}),router['post'](a0_0x1c0850(0x122),auth,async(_0x474c22,_0x4c21bd)=>{var _0x222ff7=a0_0x1c0850;try{const _0x337d45=_0x474c22['params']['id'],_0x5696c3=await purchases_finished[_0x222ff7(0x149)]({'_id':_0x474c22[_0x222ff7(0x156)]['id']}),_0x77df21=await warehouse[_0x222ff7(0x149)]({'name':_0x5696c3[_0x222ff7(0xa3)],'room':_0x5696c3[_0x222ff7(0xbd)]});_0x5696c3[_0x222ff7(0x93)][_0x222ff7(0x91)](_0x852227=>{var _0x220a0c=_0x222ff7;const _0x30ce09=_0x77df21[_0x220a0c(0x1ae)]['map'](_0x3cceb6=>{var _0x3f0325=_0x220a0c;_0x3cceb6['product_name']==_0x852227[_0x3f0325(0x119)]&&_0x3cceb6[_0x3f0325(0x126)]==_0x852227[_0x3f0325(0x126)]&&(_0x3cceb6[_0x3f0325(0x12f)]=parseInt(_0x3cceb6[_0x3f0325(0x12f)])-parseInt(_0x852227[_0x3f0325(0xcd)]));});}),await _0x77df21[_0x222ff7(0xda)]();const {invoice:_0xb97844,suppliers:_0x3fcc1e,date:_0x5504d7,warehouse_name:_0x3c3af6,prod_name:_0x54224a,prod_code:_0x553538,prod_qty:_0x28dd23,prod_unit:_0x143042,prod_secondunit:_0x31d81a,prod_level:_0x6bd647,prod_isle:_0x311999,prod_pallet:_0x47fc0c,note:_0x1831b3,expiry_date:_0x95d4fc,batch_code:_0x394b80,paid_amount:_0x47e6ba,due_amount:_0x1d5e77,Room_name:_0xe1a4b7,primary_code:_0x2169b1,secondary_code:_0x398048,PO_number:_0x21b57d,JO_number:_0x3c91c9}=_0x474c22[_0x222ff7(0xec)];if(typeof _0x54224a=='string')var _0x424fed=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x1b2)]],_0x50e569=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x142)]],_0x42be5c=[_0x474c22[_0x222ff7(0xec)]['prod_qty']],_0x327436=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x165)]],_0x3342ba=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x13e)]],_0x2e9640=[_0x474c22[_0x222ff7(0xec)]['prod_level']],_0x3fd4b0=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0xe4)]],_0x3203f9=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x1b7)]],_0x31ead4=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x14e)]],_0x2f3ee8=[_0x474c22['body'][_0x222ff7(0x120)]],_0x4dcf1d=[_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x8a)]];else var _0x424fed=[..._0x474c22['body'][_0x222ff7(0x1b2)]],_0x50e569=[..._0x474c22[_0x222ff7(0xec)]['prod_code']],_0x42be5c=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0x1a0)]],_0x327436=[..._0x474c22[_0x222ff7(0xec)]['prod_unit']],_0x3342ba=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0x13e)]],_0x2e9640=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0xee)]],_0x3fd4b0=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0xe4)]],_0x3203f9=[..._0x474c22['body'][_0x222ff7(0x1b7)]],_0x31ead4=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0x14e)]],_0x2f3ee8=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0x120)]],_0x4dcf1d=[..._0x474c22[_0x222ff7(0xec)][_0x222ff7(0x8a)]];const _0x4566bd=_0x424fed[_0x222ff7(0xc5)](_0x1dd243=>{return _0x1dd243={'product_name':_0x1dd243};});_0x50e569[_0x222ff7(0x91)]((_0x56acf0,_0x4fe713)=>{_0x4566bd[_0x4fe713]['product_code']=_0x56acf0;}),_0x42be5c['forEach']((_0x25d413,_0x51ff90)=>{_0x4566bd[_0x51ff90]['quantity']=_0x25d413;}),_0x327436[_0x222ff7(0x91)]((_0xc1b535,_0x2c40d2)=>{var _0x14d4b3=_0x222ff7;_0x4566bd[_0x2c40d2][_0x14d4b3(0x139)]=_0xc1b535;}),_0x3342ba[_0x222ff7(0x91)]((_0x3ed895,_0x416d4c)=>{_0x4566bd[_0x416d4c]['secondary_unit']=_0x3ed895;}),_0x2e9640[_0x222ff7(0x91)]((_0x55a796,_0x26e7e8)=>{var _0x23af26=_0x222ff7;_0x4566bd[_0x26e7e8][_0x23af26(0x126)]=_0x55a796;}),_0x3fd4b0[_0x222ff7(0x91)]((_0x4aa72a,_0x19d12e)=>{var _0xd8b385=_0x222ff7;_0x4566bd[_0x19d12e][_0xd8b385(0xe4)]=_0x4aa72a;}),_0x3203f9[_0x222ff7(0x91)]((_0x40b075,_0x20fbc2)=>{var _0x53098f=_0x222ff7;_0x4566bd[_0x20fbc2][_0x53098f(0x1b7)]=_0x40b075;}),_0x31ead4[_0x222ff7(0x91)]((_0xdb3ec3,_0xb67a65)=>{var _0x16c18f=_0x222ff7;_0x4566bd[_0xb67a65][_0x16c18f(0xea)]=_0xdb3ec3;}),_0x2f3ee8[_0x222ff7(0x91)]((_0x5229bb,_0x448d87)=>{var _0x59ac8a=_0x222ff7;_0x4566bd[_0x448d87][_0x59ac8a(0x120)]=_0x5229bb;}),_0x4dcf1d[_0x222ff7(0x91)]((_0x168601,_0xdb9190)=>{var _0x2eade2=_0x222ff7;_0x4566bd[_0xdb9190][_0x2eade2(0x8a)]=_0x168601;});const _0x155994=_0x4566bd[_0x222ff7(0x96)](_0x22e4c2=>_0x22e4c2['quantity']!=='0'&&_0x22e4c2[_0x222ff7(0xcd)]!=='');_0x5696c3[_0x222ff7(0x127)]=_0xb97844,_0x5696c3['suppliers']=_0x3fcc1e,_0x5696c3[_0x222ff7(0x137)]=_0x5504d7,_0x5696c3['warehouse_name']=_0x3c3af6,_0x5696c3[_0x222ff7(0x93)]=_0x155994,_0x5696c3[_0x222ff7(0x12e)]=_0x1831b3,_0x5696c3['paid_amount']=_0x47e6ba,_0x5696c3['due_amount']=_0x1d5e77,_0x5696c3['room']=_0xe1a4b7,_0x5696c3[_0x222ff7(0x1af)]=_0x21b57d,_0x5696c3[_0x222ff7(0x131)]=_0x3c91c9;const _0x5331a0=await _0x5696c3[_0x222ff7(0xda)](),_0x33a3b9=await warehouse[_0x222ff7(0x149)]({'name':_0x474c22['body'][_0x222ff7(0xa3)],'room':_0x474c22[_0x222ff7(0xec)]['Room_name']});_0x5696c3[_0x222ff7(0x93)][_0x222ff7(0x91)](_0x10ee45=>{var _0xfdeb2e=_0x222ff7,_0x26700c=0x0;const _0x50d860=_0x33a3b9[_0xfdeb2e(0x1ae)][_0xfdeb2e(0xc5)](_0x5fd606=>{var _0x1865e8=_0xfdeb2e;_0x5fd606[_0x1865e8(0x119)]==_0x10ee45[_0x1865e8(0x119)]&&_0x5fd606[_0x1865e8(0x126)]==_0x10ee45['bay']&&(_0x5fd606['product_stock']=parseInt(_0x5fd606['product_stock'])+parseInt(_0x10ee45[_0x1865e8(0xcd)]),_0x26700c++);});_0x26700c=='0'&&(_0x33a3b9[_0xfdeb2e(0x1ae)]=_0x33a3b9[_0xfdeb2e(0x1ae)][_0xfdeb2e(0x153)]({'product_name':_0x10ee45[_0xfdeb2e(0x119)],'product_stock':_0x10ee45[_0xfdeb2e(0xcd)],'primary_code':_0x10ee45[_0xfdeb2e(0xe4)],'secondary_code':_0x10ee45[_0xfdeb2e(0x1b7)],'product_code':_0x10ee45[_0xfdeb2e(0x171)],'bay':_0x10ee45['bay'],'maxProducts':_0x10ee45[_0xfdeb2e(0xea)],'unit':_0x10ee45[_0xfdeb2e(0x139)],'secondary_unit':_0x10ee45[_0xfdeb2e(0x195)],'expiry_date':_0x10ee45[_0xfdeb2e(0x8a)]}));}),await _0x33a3b9[_0x222ff7(0xda)]();const _0x405561=await s_payment_data[_0x222ff7(0x149)]({'invoice':_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x127)]});if(_0x405561===null){}else console[_0x222ff7(0x154)](_0x222ff7(0x11a),_0x405561,_0x474c22['body']['invoice']),_0x405561['suppliers']=_0x474c22[_0x222ff7(0xec)][_0x222ff7(0x11a)],await _0x405561[_0x222ff7(0xda)]();_0x474c22[_0x222ff7(0xf1)](_0x222ff7(0x102),_0x222ff7(0xbf)),_0x4c21bd['redirect'](_0x222ff7(0x190));}catch(_0x21436a){console[_0x222ff7(0x154)](_0x21436a);}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0x97),auth,async(_0x272c87,_0x1915eb)=>{var _0x5bd93a=a0_0x1c0850;try{const _0x4fddda=_0x272c87[_0x5bd93a(0x156)]['id'],{invoice:_0x59d8f8,suppliers:_0x15133e,payable:_0x42dbc4,due_amount:_0x2d5da0}=_0x272c87[_0x5bd93a(0xec)],_0x522617=await purchases[_0x5bd93a(0x1a7)](_0x4fddda);var _0x54df8=_0x42dbc4-_0x2d5da0;_0x522617[_0x5bd93a(0x157)]=parseFloat(_0x522617[_0x5bd93a(0x157)])+parseFloat(_0x2d5da0),_0x522617[_0x5bd93a(0xdf)]=_0x54df8;const _0x3ec57f=await _0x522617[_0x5bd93a(0xda)]();console[_0x5bd93a(0x154)](_0x3ec57f);const _0x16bcd0=await s_payment_data[_0x5bd93a(0x149)]({'invoice':_0x59d8f8});_0x16bcd0[_0x5bd93a(0x86)]=_0x54df8,await _0x16bcd0['save']();let _0x540636=new Date(),_0x20cee5=('0'+_0x540636[_0x5bd93a(0xa0)]())[_0x5bd93a(0x172)](-0x2),_0x1cfb3c=('0'+(_0x540636[_0x5bd93a(0x14c)]()+0x1))[_0x5bd93a(0x172)](-0x2),_0xb14902=_0x540636[_0x5bd93a(0x10d)](),_0x3ff22c=_0xb14902+'-'+_0x1cfb3c+'-'+_0x20cee5;const _0xb4c16c=new suppliers_payment({'invoice':_0x59d8f8,'date':_0xb14902+'-'+_0x1cfb3c+'-'+_0x20cee5,'suppliers':_0x15133e,'reason':'Paid\x20For\x20Purchase','amount':_0x2d5da0}),_0x126601=await _0xb4c16c[_0x5bd93a(0xda)]();_0x272c87[_0x5bd93a(0xf1)](_0x5bd93a(0x102),_0x5bd93a(0xd2)),_0x1915eb['redirect'](_0x5bd93a(0xd8));}catch(_0x1c66e6){console[_0x5bd93a(0x154)](_0x1c66e6);}}),router[a0_0x1c0850(0x16f)]('/invoice/:id',auth,async(_0x43cdab,_0x2dace8)=>{var _0x69f69d=a0_0x1c0850;try{const {username:_0x18f1ea,email:_0x1f7825,role:_0x3026d6}=_0x43cdab[_0x69f69d(0x17e)],_0x3e45c7=_0x43cdab[_0x69f69d(0x17e)],_0x186abb=await profile['findOne']({'email':_0x3e45c7[_0x69f69d(0x15e)]}),_0x12b17f=await master_shop['find']();console['log'](_0x69f69d(0x1a5),_0x12b17f);const _0x2a8061=_0x43cdab['params']['id'],_0x1e0eb2=await purchases[_0x69f69d(0x1a7)](_0x2a8061);console[_0x69f69d(0x154)](_0x1e0eb2);const _0x50ec91=await suppliers[_0x69f69d(0x149)]({'name':_0x1e0eb2[_0x69f69d(0x11a)]});console[_0x69f69d(0x154)](_0x50ec91);if(_0x12b17f[0x0][_0x69f69d(0x155)]==_0x69f69d(0x1c0)){var _0x4dbddd=users[_0x69f69d(0xd0)];console[_0x69f69d(0x154)](_0x4dbddd);}else{if(_0x12b17f[0x0]['language']==_0x69f69d(0x1b4))var _0x4dbddd=users[_0x69f69d(0x1b4)];else{if(_0x12b17f[0x0]['language']==_0x69f69d(0x15a))var _0x4dbddd=users[_0x69f69d(0x15a)];else{if(_0x12b17f[0x0]['language']==_0x69f69d(0x19d))var _0x4dbddd=users[_0x69f69d(0x19d)];else{if(_0x12b17f[0x0][_0x69f69d(0x155)]==_0x69f69d(0xe6))var _0x4dbddd=users['French'];else{if(_0x12b17f[0x0][_0x69f69d(0x155)]=='Portuguese\x20(BR)')var _0x4dbddd=users[_0x69f69d(0x1bb)];else{if(_0x12b17f[0x0]['language']==_0x69f69d(0xe8))var _0x4dbddd=users[_0x69f69d(0xe8)];else{if(_0x12b17f[0x0]['language']==_0x69f69d(0x94))var _0x4dbddd=users[_0x69f69d(0x8c)];}}}}}}}_0x2dace8[_0x69f69d(0x128)](_0x69f69d(0x114),{'success':_0x43cdab[_0x69f69d(0xf1)](_0x69f69d(0x102)),'errors':_0x43cdab[_0x69f69d(0xf1)]('errors'),'role':_0x3e45c7,'profile':_0x186abb,'master_shop':_0x12b17f,'supplier':_0x50ec91,'purchase':_0x1e0eb2,'language':_0x4dbddd});}catch(_0x2df06a){console[_0x69f69d(0x154)](_0x2df06a);}}),router['get']('/view/return_purchase/:id',auth,async(_0x44ec6c,_0x51fafb)=>{var _0x19855c=a0_0x1c0850;try{const {username:_0xa48924,email:_0x2b98d9,role:_0x4fa218}=_0x44ec6c[_0x19855c(0x17e)],_0x41374b=_0x44ec6c['user'],_0x4bc37c=await profile[_0x19855c(0x149)]({'email':_0x41374b['email']}),_0x1a3130=await master_shop[_0x19855c(0x1c2)]();console['log']('master',_0x1a3130);const _0x481e6d=_0x44ec6c[_0x19855c(0x156)]['id'];console[_0x19855c(0x154)](_0x481e6d);const _0x1bdbad=await purchases_finished[_0x19855c(0x1a7)](_0x481e6d);console[_0x19855c(0x154)](_0x19855c(0x13d),_0x1bdbad);const _0x55c553=await product[_0x19855c(0x1c2)]({}),_0x4fa954=await warehouse[_0x19855c(0x141)]([{'$match':{'name':_0x1bdbad[_0x19855c(0xa3)],'room':_0x1bdbad[_0x19855c(0xbd)]}},{'$unwind':_0x19855c(0x180)},{'$group':{'_id':_0x19855c(0x13a),'name':{'$first':_0x19855c(0xdc)},'product_stock':{'$first':_0x19855c(0x9c)},'bay':{'$first':_0x19855c(0x1bf)},'bin':{'$first':_0x19855c(0x10f)},'type':{'$first':_0x19855c(0xff)},'floorlevel':{'$first':_0x19855c(0x138)},'primary_code':{'$first':_0x19855c(0xf7)},'secondary_code':{'$first':_0x19855c(0x10c)},'product_code':{'$first':_0x19855c(0x177)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x19855c(0x154)](_0x19855c(0x160),_0x4fa954);let _0x555d02;if(_0x41374b[_0x19855c(0x19f)]==_0x19855c(0xa6)){const _0x3e5d59=await staff[_0x19855c(0x149)]({'email':_0x41374b[_0x19855c(0x15e)]});_0x555d02=await warehouse[_0x19855c(0x1c2)]({'status':_0x19855c(0x17c),'name':_0x3e5d59['warehouse'],'warehouse_category':_0x19855c(0x158),'name':_0x19855c(0x1ac)});}else _0x555d02=await warehouse[_0x19855c(0x141)]([{'$match':{'status':_0x19855c(0x17c),'warehouse_category':_0x19855c(0x158),'name':_0x19855c(0x1ac)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);if(_0x1a3130[0x0]['language']==_0x19855c(0x1c0)){var _0x371e65=users[_0x19855c(0xd0)];console[_0x19855c(0x154)](_0x371e65);}else{if(_0x1a3130[0x0][_0x19855c(0x155)]==_0x19855c(0x1b4))var _0x371e65=users['Hindi'];else{if(_0x1a3130[0x0][_0x19855c(0x155)]=='German')var _0x371e65=users[_0x19855c(0x15a)];else{if(_0x1a3130[0x0]['language']=='Spanish')var _0x371e65=users['Spanish'];else{if(_0x1a3130[0x0][_0x19855c(0x155)]=='French')var _0x371e65=users[_0x19855c(0xe6)];else{if(_0x1a3130[0x0][_0x19855c(0x155)]=='Portuguese\x20(BR)')var _0x371e65=users[_0x19855c(0x1bb)];else{if(_0x1a3130[0x0]['language']==_0x19855c(0xe8))var _0x371e65=users[_0x19855c(0xe8)];else{if(_0x1a3130[0x0]['language']==_0x19855c(0x94))var _0x371e65=users[_0x19855c(0x8c)];}}}}}}}_0x51fafb[_0x19855c(0x128)](_0x19855c(0x198),{'success':_0x44ec6c[_0x19855c(0xf1)](_0x19855c(0x102)),'errors':_0x44ec6c['flash']('errors'),'role':_0x41374b,'profile':_0x4bc37c,'user':_0x1bdbad,'stock':_0x4fa954,'master_shop':_0x1a3130,'product':_0x55c553,'language':_0x371e65,'warehouse':_0x555d02});}catch(_0x490f10){console[_0x19855c(0x154)](_0x490f10);}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0x1a6),auth,async(_0x3c3344,_0x3c26a0)=>{var _0x43c6b3=a0_0x1c0850;try{const {invoice:_0x40b2f5,date:_0x9b2926,warehouse_name:_0x3fa732,Room_name:_0x3a8db5,product_name:_0x2c0a42,purchase_quantity:_0x4ae3f5,stocks:_0x83f4eb,return_qty:_0x523fd6,note:_0x23fb3b,level:_0x5d99a3,isle:_0x3845b2,pallet:_0x3ff83c,to_warehouse_name:_0x11c33c,to_Room_name:_0x47f592}=_0x3c3344[_0x43c6b3(0xec)],_0x5c2b57=await purchases_finished[_0x43c6b3(0x149)]({'_id':_0x3c3344['params']['id']}),_0x478470=await warehouse[_0x43c6b3(0x149)]({'name':_0x3fa732,'room':_0x3a8db5,'warehouse_category':_0x43c6b3(0x158)});if(typeof _0x2c0a42==_0x43c6b3(0xc2))var _0x57bb14=[_0x3c3344[_0x43c6b3(0xec)]['product_name']],_0x163b71=[_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x19c)]],_0x360fc3=[_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0xb6)]],_0x27f78b=[_0x3c3344['body'][_0x43c6b3(0xcf)]],_0x548dce=[_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0xd3)]],_0x3926e1=[_0x3c3344[_0x43c6b3(0xec)]['product_code_hide']],_0x570dc3=[_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x123)]],_0x2885b0=[_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0xae)]];else var _0x57bb14=[..._0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x119)]],_0x163b71=[..._0x3c3344['body'][_0x43c6b3(0x19c)]],_0x360fc3=[..._0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0xb6)]],_0x27f78b=[..._0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0xcf)]],_0x548dce=[..._0x3c3344[_0x43c6b3(0xec)]['level']],_0x3926e1=[..._0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x13f)]],_0x570dc3=[..._0x3c3344[_0x43c6b3(0xec)]['primary_code_hide']],_0x2885b0=[..._0x3c3344[_0x43c6b3(0xec)]['secondary_code_hide']];const _0x30df52=_0x57bb14['map'](_0x334f30=>{return _0x334f30={'product_name':_0x334f30};});_0x163b71[_0x43c6b3(0x91)]((_0x43ca79,_0x483f93)=>{var _0xb79c79=_0x43c6b3;_0x30df52[_0x483f93][_0xb79c79(0x19c)]=_0x43ca79;}),_0x360fc3[_0x43c6b3(0x91)]((_0x5b619e,_0x557b02)=>{var _0x11c7d8=_0x43c6b3;_0x30df52[_0x557b02][_0x11c7d8(0x182)]=_0x5b619e;}),_0x27f78b['forEach']((_0x5dfc5c,_0x3317bc)=>{var _0x458c01=_0x43c6b3;_0x30df52[_0x3317bc][_0x458c01(0xcf)]=_0x5dfc5c;}),_0x548dce['forEach']((_0x1eff87,_0x3e97d0)=>{var _0xa3abda=_0x43c6b3;_0x30df52[_0x3e97d0][_0xa3abda(0x126)]=_0x1eff87;}),_0x3926e1[_0x43c6b3(0x91)]((_0x47c783,_0x3ea8a2)=>{var _0x10fa82=_0x43c6b3;_0x30df52[_0x3ea8a2][_0x10fa82(0x171)]=_0x47c783;}),_0x570dc3[_0x43c6b3(0x91)]((_0x286044,_0x19ec82)=>{var _0x3165a0=_0x43c6b3;_0x30df52[_0x19ec82][_0x3165a0(0xe4)]=_0x286044;}),_0x2885b0[_0x43c6b3(0x91)]((_0x38dd79,_0x73561d)=>{_0x30df52[_0x73561d]['secondary_code']=_0x38dd79;}),_0x30df52['forEach'](_0x4b0948=>{var _0x1d29ca=_0x43c6b3;console[_0x1d29ca(0x154)](_0x4b0948);const _0x2d5640=_0x478470[_0x1d29ca(0x1ae)][_0x1d29ca(0xc5)](_0x3c33cf=>{var _0x442f9f=_0x1d29ca;_0x3c33cf[_0x442f9f(0x119)]==_0x4b0948[_0x442f9f(0x119)]&&_0x3c33cf['bay']==_0x4b0948[_0x442f9f(0x126)]&&(console[_0x442f9f(0x154)](parseInt(_0x3c33cf[_0x442f9f(0x12f)])+_0x442f9f(0x10b)+parseInt(_0x4b0948['return_qty'])),_0x3c33cf[_0x442f9f(0x12f)]=parseInt(_0x3c33cf[_0x442f9f(0x12f)])-parseInt(_0x4b0948[_0x442f9f(0xcf)]));});}),await _0x478470[_0x43c6b3(0xda)]();var _0x567644=0x0;_0x30df52['forEach'](_0x198b13=>{var _0x13b6a9=_0x43c6b3;(parseInt(_0x198b13['purchase_quantity'])<parseInt(_0x198b13[_0x13b6a9(0xcf)])||parseInt(_0x198b13[_0x13b6a9(0x182)])<parseInt(_0x198b13[_0x13b6a9(0xcf)]))&&_0x567644++;});if(_0x567644!=0x0)return _0x3c3344[_0x43c6b3(0xf1)](_0x43c6b3(0xc3),_0x43c6b3(0xd9)),_0x3c26a0[_0x43c6b3(0x112)](_0x43c6b3(0x176));const _0x285fb8=new purchases_return_finished({'invoice':_0x40b2f5,'suppliers':_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x11a)],'date':_0x9b2926,'warehouse_name':_0x3fa732,'return_product':_0x30df52,'note':_0x23fb3b,'room':_0x3a8db5,'to_warehouse_name':_0x11c33c,'to_room':_0x47f592}),_0x183ad9=await _0x285fb8[_0x43c6b3(0xda)](),_0x11e5d9=await purchases_return_finished[_0x43c6b3(0x149)]({'invoice':_0x40b2f5}),_0x4d05fc=await warehouse[_0x43c6b3(0x149)]({'name':_0x11c33c,'room':_0x47f592,'warehouse_category':_0x43c6b3(0x158)});_0x11e5d9[_0x43c6b3(0x109)][_0x43c6b3(0x91)](_0x363347=>{var _0x504bf9=_0x43c6b3,_0x51b24e=0x0;const _0x428cee=_0x4d05fc[_0x504bf9(0x1ae)][_0x504bf9(0xc5)](_0x59b6d4=>{var _0x37857a=_0x504bf9;console['log'](_0x59b6d4[_0x37857a(0x119)]+'=='+_0x363347[_0x37857a(0x119)]+'&&'+_0x59b6d4[_0x37857a(0x126)]+'=='+_0x363347[_0x37857a(0x126)]),_0x59b6d4['product_name']==_0x363347[_0x37857a(0x119)]&&_0x59b6d4['bay']==_0x363347['bay']&&(_0x59b6d4[_0x37857a(0x12f)]=parseInt(_0x59b6d4[_0x37857a(0x12f)])-parseInt(_0x363347['return_qty']),_0x51b24e++);});_0x51b24e=='0'&&(_0x4d05fc['product_details']=_0x4d05fc[_0x504bf9(0x1ae)]['concat']({'product_name':_0x363347['product_name'],'product_stock':_0x363347[_0x504bf9(0xcf)],'primary_code':_0x363347['primary_code'],'secondary_code':_0x363347[_0x504bf9(0x1b7)],'product_code':_0x363347[_0x504bf9(0x171)],'bay':_0x363347[_0x504bf9(0x126)],'maxProducts':0xf423f}));}),await _0x4d05fc[_0x43c6b3(0xda)]();const _0x1689f7=await purchases_finished[_0x43c6b3(0x149)]({'invoice':_0x40b2f5});_0x1689f7[_0x43c6b3(0x185)]='True';const _0x96472f=await _0x1689f7[_0x43c6b3(0xda)](),_0x1f71c6=new s_payment_data({'invoice':_0x40b2f5,'suppliers':_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x11a)],'reason':_0x43c6b3(0x95)});await _0x1f71c6[_0x43c6b3(0xda)]();const _0x155840=await master_shop[_0x43c6b3(0x1c2)](),_0x3d9a17=await email_settings['findOne'](),_0x18da21=await suppliers['findOne']({'name':_0x3c3344[_0x43c6b3(0xec)][_0x43c6b3(0x11a)]});_0x155840[0x0]['currency_placement']==0x1?(right_currency=_0x155840[0x0][_0x43c6b3(0xc4)],left_currency=''):(right_currency='',left_currency=_0x155840[0x0][_0x43c6b3(0xc4)]);var _0x4a2ac3=_0x57bb14,_0x596e4b=_0x27f78b,_0x16df76='',_0x53c446;for(_0x53c446 in _0x4a2ac3){_0x16df76+=_0x43c6b3(0xd6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4a2ac3[_0x53c446]+_0x43c6b3(0x1b0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x596e4b[_0x53c446]+_0x43c6b3(0x1b0)+_0x43c6b3(0x173);}let _0x3d7882=nodemailer[_0x43c6b3(0x15c)]({'service':'gmail','auth':{'user':_0x3d9a17[_0x43c6b3(0x15e)],'pass':_0x3d9a17['password']}}),_0x2117ce={'from':_0x3d9a17['email'],'to':_0x18da21[_0x43c6b3(0x15e)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x43c6b3(0xd7),'path':__dirname+_0x43c6b3(0x129)+_0x43c6b3(0xa2)+_0x155840[0x0][_0x43c6b3(0x144)],'cid':_0x43c6b3(0xce)}],'html':_0x43c6b3(0x11d)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x43c6b3(0x1a3)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x43c6b3(0xb2)+_0x43c6b3(0x1ab)+_0x155840[0x0][_0x43c6b3(0x189)]+_0x43c6b3(0xfe)+_0x43c6b3(0x1b8)+_0x43c6b3(0x1b8)+_0x43c6b3(0x90)+_0x43c6b3(0xb2)+_0x43c6b3(0x136)+_0x43c6b3(0x140)+_0x40b2f5+'\x20'+_0x43c6b3(0xef)+'\x20Order\x20Date\x20:\x20'+_0x9b2926+'\x20'+_0x43c6b3(0x1b5)+'</h5>'+_0x43c6b3(0x1b8)+_0x43c6b3(0x174)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x43c6b3(0xd6)+_0x43c6b3(0xaf)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x43c6b3(0x13c)+_0x43c6b3(0x1ba)+_0x43c6b3(0x173)+_0x43c6b3(0xfb)+_0x43c6b3(0x181)+'\x20'+_0x16df76+'\x20'+_0x43c6b3(0x169)+_0x43c6b3(0x150)+_0x43c6b3(0xb2)+_0x43c6b3(0x147)+_0x43c6b3(0x14f)+_0x155840[0x0][_0x43c6b3(0x189)]+_0x43c6b3(0x92)+_0x43c6b3(0x1b8)+_0x43c6b3(0x1b8)+_0x43c6b3(0xaa)};_0x3d7882[_0x43c6b3(0x87)](_0x2117ce,function(_0x3b05ed,_0x5d93a9){var _0x47695e=_0x43c6b3;_0x3b05ed?console[_0x47695e(0x154)]('Error\x20Occurs'):console['log'](_0x47695e(0xed));}),_0x3c3344['flash'](_0x43c6b3(0x102),'purchases\x20item\x20return\x20successfull'),_0x3c26a0['redirect'](_0x43c6b3(0x190));}catch(_0x10632d){_0x3c26a0[_0x43c6b3(0xba)](0xc8)['json']({'message':_0x10632d['message']});}}),router[a0_0x1c0850(0x16f)]('/barcode/:id',auth,async(_0x39691f,_0x1605e6)=>{var _0x5d46c9=a0_0x1c0850;try{const {username:_0x2a8c13,email:_0x4ebc67,role:_0x75b834}=_0x39691f[_0x5d46c9(0x17e)],_0x56984a=_0x39691f[_0x5d46c9(0x17e)],_0x1e519b=await profile[_0x5d46c9(0x149)]({'email':_0x56984a[_0x5d46c9(0x15e)]}),_0x4f8e77=await master_shop[_0x5d46c9(0x1c2)](),_0x3702ff=_0x39691f['params']['id'],_0x4e60df=await purchases_finished[_0x5d46c9(0x1a7)](_0x3702ff);if(_0x4f8e77[0x0][_0x5d46c9(0x155)]=='English\x20(US)')var _0x180ab6=users[_0x5d46c9(0xd0)];else{if(_0x4f8e77[0x0]['language']==_0x5d46c9(0x1b4))var _0x180ab6=users[_0x5d46c9(0x1b4)];else{if(_0x4f8e77[0x0][_0x5d46c9(0x155)]==_0x5d46c9(0x15a))var _0x180ab6=users[_0x5d46c9(0x15a)];else{if(_0x4f8e77[0x0][_0x5d46c9(0x155)]==_0x5d46c9(0x19d))var _0x180ab6=users[_0x5d46c9(0x19d)];else{if(_0x4f8e77[0x0]['language']==_0x5d46c9(0xe6))var _0x180ab6=users[_0x5d46c9(0xe6)];else{if(_0x4f8e77[0x0][_0x5d46c9(0x155)]==_0x5d46c9(0x186))var _0x180ab6=users[_0x5d46c9(0x1bb)];else{if(_0x4f8e77[0x0]['language']==_0x5d46c9(0xe8))var _0x180ab6=users['Chinese'];else{if(_0x4f8e77[0x0][_0x5d46c9(0x155)]==_0x5d46c9(0x94))var _0x180ab6=users[_0x5d46c9(0x8c)];}}}}}}}_0x1605e6[_0x5d46c9(0x128)](_0x5d46c9(0x16e),{'success':_0x39691f[_0x5d46c9(0xf1)](_0x5d46c9(0x102)),'errors':_0x39691f[_0x5d46c9(0xf1)](_0x5d46c9(0xc3)),'role':_0x56984a,'profile':_0x1e519b,'alldata':_0x4e60df,'master_shop':_0x4f8e77,'language':_0x180ab6}),console[_0x5d46c9(0x154)](alldata);}catch(_0x3e2ba0){console[_0x5d46c9(0x154)](_0x3e2ba0);}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0x11c),async(_0x3698a8,_0x32d02a)=>{var _0x5a24fe=a0_0x1c0850;const {product_code:_0x5effc7}=_0x3698a8[_0x5a24fe(0xec)];var _0x2a20b7;const _0x29db0d=await product[_0x5a24fe(0x141)]([{'$match':{'primary_code':_0x5effc7}},{'$group':{'_id':_0x5a24fe(0x11e),'name':{'$first':_0x5a24fe(0x1a9)},'category':{'$first':'$category'},'brand':{'$first':_0x5a24fe(0x1a8)},'unit':{'$first':_0x5a24fe(0x125)},'alertquantity':{'$first':_0x5a24fe(0x188)},'product_code':{'$first':_0x5a24fe(0x113)},'primary_code':{'$first':_0x5a24fe(0x183)},'secondary_code':{'$first':_0x5a24fe(0x133)},'maxStocks':{'$first':_0x5a24fe(0x151)},'maxProdPerUnit':{'$first':_0x5a24fe(0x1b9)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x5a24fe(0x1b6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x1da99a=await product[_0x5a24fe(0x141)]([{'$match':{'secondary_code':_0x5effc7}},{'$group':{'_id':_0x5a24fe(0x11e),'name':{'$first':'$name'},'category':{'$first':_0x5a24fe(0xfa)},'brand':{'$first':_0x5a24fe(0x1a8)},'unit':{'$first':_0x5a24fe(0x125)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5a24fe(0x183)},'secondary_code':{'$first':_0x5a24fe(0x133)},'maxStocks':{'$first':_0x5a24fe(0x151)},'maxProdPerUnit':{'$first':_0x5a24fe(0x1b9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5a24fe(0xa7)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x5a24fe(0x1b6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x29db0d['length']>0x0)_0x2a20b7=_0x29db0d;else _0x1da99a[_0x5a24fe(0xf3)]>0x0&&(_0x2a20b7=_0x1da99a);_0x32d02a[_0x5a24fe(0x14d)](_0x2a20b7);}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0xe1),async(_0x250529,_0x26d268)=>{var _0x220914=a0_0x1c0850;const {productCode:_0x3ef59d,bay:_0xce48af,warehouses:_0x4ae2,room:_0x3d75c7}=_0x250529[_0x220914(0xec)];console[_0x220914(0x154)](_0x250529[_0x220914(0xec)]);try{const _0x18c3e7=await warehouse[_0x220914(0x141)]([{'$match':{'name':_0x4ae2,'room':_0x3d75c7}},{'$unwind':_0x220914(0x180)},{'$match':{'product_details.bay':parseInt(_0xce48af)}},{'$group':{'_id':_0x220914(0x13a),'name':{'$first':_0x220914(0xdc)},'product_stock':{'$first':_0x220914(0x9c)},'bay':{'$first':_0x220914(0x1bf)},'maxProducts':{'$first':_0x220914(0x8b)}}}]);_0x26d268[_0x220914(0xba)](0xc8)[_0x220914(0x14d)](_0x18c3e7);}catch(_0x4df1bf){_0x26d268['status'](0x194)[_0x220914(0x14d)]({'message':_0x4df1bf[_0x220914(0x18a)]});}}),router[a0_0x1c0850(0x11f)](a0_0x1c0850(0xe0),async(_0x46b8ea,_0x59bbdd)=>{var _0x54a1d2=a0_0x1c0850;const {product_code:_0x389d13}=_0x46b8ea['body'];var _0x5b94fb;const _0x3afa4f=await product['aggregate']([{'$match':{'primary_code':_0x389d13,'type_products':'log'}},{'$group':{'_id':'$_id','name':{'$first':_0x54a1d2(0x1a9)},'category':{'$first':_0x54a1d2(0xfa)},'brand':{'$first':_0x54a1d2(0x1a8)},'unit':{'$first':_0x54a1d2(0x125)},'alertquantity':{'$first':_0x54a1d2(0x188)},'product_code':{'$first':_0x54a1d2(0x113)},'primary_code':{'$first':_0x54a1d2(0x183)},'secondary_code':{'$first':_0x54a1d2(0x133)},'maxStocks':{'$first':_0x54a1d2(0x151)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x54a1d2(0xa7)},'gross_price':{'$first':_0x54a1d2(0xa9)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x54a1d2(0x154)](_0x3afa4f);const _0x2345e0=await product['aggregate']([{'$match':{'secondary_code':_0x389d13,'type_products':'log'}},{'$group':{'_id':'$_id','name':{'$first':_0x54a1d2(0x1a9)},'category':{'$first':_0x54a1d2(0xfa)},'brand':{'$first':_0x54a1d2(0x1a8)},'unit':{'$first':_0x54a1d2(0x125)},'alertquantity':{'$first':_0x54a1d2(0x188)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x54a1d2(0x183)},'secondary_code':{'$first':_0x54a1d2(0x133)},'maxStocks':{'$first':_0x54a1d2(0x151)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x54a1d2(0xa9)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x3afa4f[_0x54a1d2(0xf3)]>0x0)_0x5b94fb=_0x3afa4f;else _0x2345e0[_0x54a1d2(0xf3)]>0x0&&(_0x5b94fb=_0x2345e0);_0x59bbdd[_0x54a1d2(0x14d)](_0x5b94fb);}),module[a0_0x1c0850(0x14b)]=router;