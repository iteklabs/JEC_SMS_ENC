var a0_0x3316c3=a0_0x5a7e;(function(_0x425261,_0x2c21ed){var _0x307e0a=a0_0x5a7e,_0xb10757=_0x425261();while(!![]){try{var _0x2986d3=-parseInt(_0x307e0a(0x1de))/0x1*(-parseInt(_0x307e0a(0x262))/0x2)+parseInt(_0x307e0a(0x2f0))/0x3+parseInt(_0x307e0a(0x231))/0x4*(-parseInt(_0x307e0a(0x2a5))/0x5)+parseInt(_0x307e0a(0x304))/0x6+-parseInt(_0x307e0a(0x26f))/0x7+parseInt(_0x307e0a(0x205))/0x8*(-parseInt(_0x307e0a(0x2a7))/0x9)+-parseInt(_0x307e0a(0x208))/0xa*(-parseInt(_0x307e0a(0x27c))/0xb);if(_0x2986d3===_0x2c21ed)break;else _0xb10757['push'](_0xb10757['shift']());}catch(_0x1b181c){_0xb10757['push'](_0xb10757['shift']());}}}(a0_0x5cad,0x3fe39));const express=require(a0_0x3316c3(0x27e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x3316c3(0x25e)),auth=require(a0_0x3316c3(0x26b)),nodemailer=require(a0_0x3316c3(0x243));var ejs=require(a0_0x3316c3(0x242));function a0_0x5a7e(_0x2dbd1e,_0x3df9a5){var _0x5cadc5=a0_0x5cad();return a0_0x5a7e=function(_0x5a7eae,_0x2c5787){_0x5a7eae=_0x5a7eae-0x1d6;var _0x1aa634=_0x5cadc5[_0x5a7eae];return _0x1aa634;},a0_0x5a7e(_0x2dbd1e,_0x3df9a5);}const path=require(a0_0x3316c3(0x263)),users=require(a0_0x3316c3(0x2b6)),{isNull}=require('util');router[a0_0x3316c3(0x20c)]('/incoming',auth,async(_0x1cfc1c,_0x40f632)=>{var _0x4490c9=a0_0x3316c3;try{const {username:_0x7a9d9b,email:_0x363107,role:_0x184685}=_0x1cfc1c['user'],_0x10092e=_0x1cfc1c[_0x4490c9(0x2ec)],_0x730996=await profile[_0x4490c9(0x2c9)]({'email':_0x10092e['email']}),_0xfe21a9=await staff[_0x4490c9(0x2c9)]({'email':_0x10092e[_0x4490c9(0x27a)]}),_0x506984=await master_shop['find']();let _0x5e8b96=await transfers_finished[_0x4490c9(0x292)]([{'$match':{'to_warehouse':_0xfe21a9[_0x4490c9(0x2c7)]}}]);if(_0x506984[0x0][_0x4490c9(0x2b2)]==_0x4490c9(0x28e))var _0x3b6074=users[_0x4490c9(0x27f)];else{if(_0x506984[0x0][_0x4490c9(0x2b2)]==_0x4490c9(0x24c))var _0x3b6074=users[_0x4490c9(0x24c)];else{if(_0x506984[0x0]['language']==_0x4490c9(0x240))var _0x3b6074=users[_0x4490c9(0x240)];else{if(_0x506984[0x0]['language']==_0x4490c9(0x22e))var _0x3b6074=users['Spanish'];else{if(_0x506984[0x0][_0x4490c9(0x2b2)]==_0x4490c9(0x2a2))var _0x3b6074=users['French'];else{if(_0x506984[0x0]['language']=='Portuguese\x20(BR)')var _0x3b6074=users[_0x4490c9(0x257)];else{if(_0x506984[0x0][_0x4490c9(0x2b2)]=='Chinese')var _0x3b6074=users[_0x4490c9(0x1f3)];else{if(_0x506984[0x0][_0x4490c9(0x2b2)]==_0x4490c9(0x301))var _0x3b6074=users[_0x4490c9(0x284)];}}}}}}}_0x40f632[_0x4490c9(0x29b)]('incoming_view',{'success':_0x1cfc1c[_0x4490c9(0x211)](_0x4490c9(0x308)),'errors':_0x1cfc1c['flash'](_0x4490c9(0x23b)),'purchases':_0x5e8b96,'role':_0x10092e,'profile':_0x730996,'master_shop':_0x506984,'language':_0x3b6074,'staff_data':_0xfe21a9});}catch(_0x2b1ff8){console[_0x4490c9(0x2e7)](_0x4490c9(0x1d7),_0x2b1ff8),_0x40f632[_0x4490c9(0x207)](0xc8)[_0x4490c9(0x2fc)]({'message':_0x2b1ff8[_0x4490c9(0x29a)]});}}),router['get'](a0_0x3316c3(0x29d),auth,async(_0x5b8581,_0x2f3b66)=>{var _0x18cc24=a0_0x3316c3;try{const {username:_0x51366d,email:_0x51d4c1,role:_0x3805dd}=_0x5b8581[_0x18cc24(0x2ec)],_0x202832=_0x5b8581[_0x18cc24(0x2ec)],_0x23a314=await profile['findOne']({'email':_0x202832[_0x18cc24(0x27a)]}),_0x4dad57=await staff[_0x18cc24(0x2c9)]({'email':_0x202832[_0x18cc24(0x27a)]}),_0x5de10a=await master_shop[_0x18cc24(0x22d)]();let _0xbea2bb=await transfers_finished[_0x18cc24(0x292)]([{'$match':{'to_warehouse':_0x4dad57[_0x18cc24(0x2c7)],'to_recieved':_0x18cc24(0x2df)}}]);if(_0x5de10a[0x0][_0x18cc24(0x2b2)]=='English\x20(US)')var _0x256a66=users[_0x18cc24(0x27f)];else{if(_0x5de10a[0x0][_0x18cc24(0x2b2)]==_0x18cc24(0x24c))var _0x256a66=users[_0x18cc24(0x24c)];else{if(_0x5de10a[0x0][_0x18cc24(0x2b2)]==_0x18cc24(0x240))var _0x256a66=users[_0x18cc24(0x240)];else{if(_0x5de10a[0x0]['language']==_0x18cc24(0x22e))var _0x256a66=users[_0x18cc24(0x22e)];else{if(_0x5de10a[0x0]['language']==_0x18cc24(0x2a2))var _0x256a66=users[_0x18cc24(0x2a2)];else{if(_0x5de10a[0x0][_0x18cc24(0x2b2)]==_0x18cc24(0x258))var _0x256a66=users[_0x18cc24(0x257)];else{if(_0x5de10a[0x0][_0x18cc24(0x2b2)]=='Chinese')var _0x256a66=users[_0x18cc24(0x1f3)];else{if(_0x5de10a[0x0]['language']==_0x18cc24(0x301))var _0x256a66=users[_0x18cc24(0x284)];}}}}}}}_0x2f3b66['render']('incoming_add',{'success':_0x5b8581[_0x18cc24(0x211)](_0x18cc24(0x308)),'errors':_0x5b8581[_0x18cc24(0x211)](_0x18cc24(0x23b)),'purchases':_0xbea2bb,'role':_0x202832,'profile':_0x23a314,'master_shop':_0x5de10a,'language':_0x256a66,'staff_data':_0x4dad57});}catch(_0x1c8d03){console[_0x18cc24(0x2e7)]('table\x20page',_0x1c8d03),_0x2f3b66[_0x18cc24(0x207)](0xc8)['json']({'message':_0x1c8d03['message']});}});const createLog=async _0x1705e7=>{var _0x176387=a0_0x3316c3;const _0x14557d=new datalogs({'location':_0x1705e7});return await _0x14557d[_0x176387(0x23e)](),_0x14557d[_0x176387(0x266)];};router['post'](a0_0x3316c3(0x29d),auth,async(_0x195ee9,_0x42a7ec)=>{var _0x1380e1=a0_0x3316c3;try{const {invoice_trf_data:_0x41ca36,item_code:_0x19afde,SCRN:_0x25d572,ReqBy:_0x24a95d,type_of_products:_0x581e1f,dateofreq:_0x59c29e,PO_number:_0x414678,date:_0x5ea145,warehouse_name:_0x1ca5c9,typeservicesData:_0x578020,typevehicle:_0x118616,driver:_0x5883dd,plate:_0x5ea3e5,van:_0x282ae8,DRSI:_0x2a3663,TSU:_0x2e4922,TFU:_0x4f8b0d,note:_0x31c19c}=_0x195ee9[_0x1380e1(0x2d6)],_0x2822d5=await transfers_finished[_0x1380e1(0x1e7)](_0x41ca36);if(typeof _0x19afde==_0x1380e1(0x1f9))var _0x5500cc=[_0x195ee9['body'][_0x1380e1(0x2bf)]],_0x58647e=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x2a3)]],_0x5babdb=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x28b)]],_0x18821c=[_0x195ee9['body']['unit']],_0x3e4780=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x30a)]],_0x454fe4=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x268)]],_0xa30173=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x26e)]],_0x50a259=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x2c6)]],_0x11ca39=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x21d)]],_0x3dab97=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x247)]],_0x1ec4fc=[_0x195ee9['body']['production_date']],_0x38a9fa=[_0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x226)]],_0x1cc4e9=[_0x195ee9['body']['room']];else var _0x5500cc=[..._0x195ee9['body'][_0x1380e1(0x2bf)]],_0x58647e=[..._0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x2a3)]],_0x5babdb=[..._0x195ee9['body'][_0x1380e1(0x28b)]],_0x18821c=[..._0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x244)]],_0x3e4780=[..._0x195ee9[_0x1380e1(0x2d6)]['prod_secondunit']],_0x454fe4=[..._0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x268)]],_0xa30173=[..._0x195ee9['body'][_0x1380e1(0x26e)]],_0x50a259=[..._0x195ee9['body']['secondary_code']],_0x11ca39=[..._0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x21d)]],_0x3dab97=[..._0x195ee9['body'][_0x1380e1(0x247)]],_0x1ec4fc=[..._0x195ee9['body'][_0x1380e1(0x223)]],_0x38a9fa=[..._0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x226)]],_0x1cc4e9=[..._0x195ee9[_0x1380e1(0x2d6)][_0x1380e1(0x1ec)]];const _0x156770=_0x5500cc['map'](_0x4ba910=>{return _0x4ba910={'product_name':_0x4ba910};});_0x58647e[_0x1380e1(0x245)]((_0x16e575,_0x28559c)=>{_0x156770[_0x28559c]['product_code']=_0x16e575;}),_0x5babdb[_0x1380e1(0x245)]((_0x1deec2,_0x5c0337)=>{var _0x108ba2=_0x1380e1;_0x156770[_0x5c0337][_0x108ba2(0x248)]=Math[_0x108ba2(0x25c)](_0x1deec2);}),_0x18821c[_0x1380e1(0x245)]((_0x938f86,_0x2099a8)=>{_0x156770[_0x2099a8]['standard_unit']=_0x938f86;}),_0x3e4780[_0x1380e1(0x245)]((_0x2354bc,_0x315e00)=>{_0x156770[_0x315e00]['secondary_unit']=_0x2354bc;}),_0x454fe4['forEach']((_0x587142,_0x3f06b3)=>{var _0x706367=_0x1380e1,_0x313b47=_0x587142['match'](/[A-Za-z]+/)[0x0],_0x24c05c=parseInt(_0x587142[_0x706367(0x20e)](/\d+/)[0x0]);_0x156770[_0x3f06b3][_0x706367(0x2c1)]=_0x313b47,_0x156770[_0x3f06b3]['bay']=_0x24c05c;}),_0xa30173[_0x1380e1(0x245)]((_0x53690,_0x520707)=>{_0x156770[_0x520707]['primary_code']=_0x53690;}),_0x50a259[_0x1380e1(0x245)]((_0x5d1e36,_0x37128a)=>{_0x156770[_0x37128a]['secondary_code']=_0x5d1e36;}),_0x11ca39['forEach']((_0x2583a5,_0x2ada52)=>{var _0x56f9a4=_0x1380e1;_0x156770[_0x2ada52][_0x56f9a4(0x21d)]=_0x2583a5;}),_0x3dab97[_0x1380e1(0x245)]((_0x48e657,_0x569381)=>{var _0x2fab0c=_0x1380e1;_0x156770[_0x569381][_0x2fab0c(0x247)]=_0x48e657;}),_0x1ec4fc[_0x1380e1(0x245)]((_0x48768f,_0x504d65)=>{var _0x121d78=_0x1380e1;_0x156770[_0x504d65][_0x121d78(0x223)]=_0x48768f;}),_0x38a9fa[_0x1380e1(0x245)]((_0xcbd917,_0x54b8da)=>{var _0x31712e=_0x1380e1;_0x156770[_0x54b8da][_0x31712e(0x1e2)]=_0xcbd917;}),_0x1cc4e9['forEach']((_0x20586b,_0x4935b5)=>{_0x156770[_0x4935b5]['room_name']=_0x20586b;});const _0x4fcca0=await createLog(_0x1380e1(0x204));_0x1cc4e9[_0x1380e1(0x245)]((_0x460360,_0x13fe8c)=>{var _0x36c360=_0x1380e1;_0x156770[_0x13fe8c][_0x36c360(0x2a6)]=_0x36c360(0x2ef)+_0x4fcca0[_0x36c360(0x1d9)]()[_0x36c360(0x21e)](0x8,'0');});const _0x474c9c=_0x156770[_0x1380e1(0x26a)](_0x104b24=>_0x104b24[_0x1380e1(0x248)]!=='0'&&_0x104b24[_0x1380e1(0x248)]!==''),_0x336fb5=new purchases_incoming({'invoice':_0x1380e1(0x2ef)+_0x4fcca0['toString']()[_0x1380e1(0x21e)](0x8,'0'),'date':_0x5ea145,'warehouse_name':_0x1ca5c9,'product':_0x474c9c,'note':_0x31c19c,'POnumber':_0x414678,'SCRN':_0x25d572,'ReqBy':_0x24a95d,'dateofreq':_0x59c29e,'typeservicesData':_0x578020,'van':_0x282ae8,'typevehicle':_0x118616,'driver':_0x5883dd,'plate':_0x5ea3e5,'DRSI':_0x2a3663,'TSU':_0x2e4922,'TFU':_0x4f8b0d,'typeOfProducts':_0x581e1f}),_0x104aaa=await _0x336fb5[_0x1380e1(0x23e)](),_0x3d6ec0=_0x104aaa['product']['map'](async _0x10e009=>{var _0x1cadc0=_0x1380e1,_0x54e139=await warehouse['findOne']({'name':_0x1ca5c9,'room':_0x10e009[_0x1cadc0(0x28f)]});if(_0x10e009[_0x1cadc0(0x248)]>0x0){var _0x15a0c7=0x0;const _0x3d2327=_0x54e139['product_details'][_0x1cadc0(0x23f)](_0x408ab7=>{var _0xc2ffde=_0x1cadc0;_0x408ab7[_0xc2ffde(0x2bf)]==_0x10e009[_0xc2ffde(0x2bf)]&&_0x408ab7[_0xc2ffde(0x2d0)]==_0x10e009[_0xc2ffde(0x22c)]&&_0x408ab7['expiry_date']==_0x10e009[_0xc2ffde(0x247)]&&_0x408ab7[_0xc2ffde(0x223)]==_0x10e009[_0xc2ffde(0x223)]&&_0x408ab7[_0xc2ffde(0x21d)]==_0x10e009[_0xc2ffde(0x21d)]&&_0x408ab7['invoice']==_0x10e009[_0xc2ffde(0x2a6)]&&(typeof _0x10e009[_0xc2ffde(0x215)]==_0xc2ffde(0x2f1)?(console[_0xc2ffde(0x2e7)]('here2',_0x408ab7[_0xc2ffde(0x280)]+_0xc2ffde(0x250)+_0x408ab7[_0xc2ffde(0x1f8)]+_0xc2ffde(0x23d)+Math['abs'](_0x408ab7['product_stock'])+Math[_0xc2ffde(0x25c)](_0x10e009['to_quantity'])),_0x408ab7[_0xc2ffde(0x280)]=Math[_0xc2ffde(0x25c)](_0x408ab7[_0xc2ffde(0x280)])+Math[_0xc2ffde(0x25c)](_0x10e009['quantity'])):(_0x408ab7['product_stock']=Math[_0xc2ffde(0x25c)](_0x408ab7[_0xc2ffde(0x280)])+Math[_0xc2ffde(0x25c)](_0x10e009[_0xc2ffde(0x248)]),_0x15a0c7++));});_0x15a0c7=='0'&&(_0x54e139['product_details']=_0x54e139['product_details'][_0x1cadc0(0x24a)]({'product_name':_0x10e009[_0x1cadc0(0x2bf)],'product_stock':_0x10e009['quantity'],'bay':_0x10e009[_0x1cadc0(0x2d0)],'level':_0x10e009[_0x1cadc0(0x2c1)],'product_code':_0x10e009[_0x1cadc0(0x2ff)],'primary_code':_0x10e009[_0x1cadc0(0x26e)],'secondary_code':_0x10e009['secondary_code'],'expiry_date':_0x10e009[_0x1cadc0(0x247)],'production_date':_0x10e009[_0x1cadc0(0x223)],'maxProducts':_0x10e009[_0x1cadc0(0x229)],'batch_code':_0x10e009['batch_code'],'secondary_unit':_0x10e009[_0x1cadc0(0x201)],'unit':_0x10e009[_0x1cadc0(0x2c4)],'maxProducts':_0x10e009[_0x1cadc0(0x229)],'maxPerUnit':_0x10e009[_0x1cadc0(0x1ef)],'invoice':_0x10e009[_0x1cadc0(0x2a6)]}));}return _0x54e139;});Promise[_0x1380e1(0x1ed)](_0x3d6ec0)[_0x1380e1(0x218)](async _0x41135f=>{var _0x3882e5=_0x1380e1;try{for(const _0x47424a of _0x41135f){await warehouse['updateOne']({'_id':_0x47424a[_0x3882e5(0x1f8)]},{'$addToSet':{'product_details':{'$each':_0x47424a[_0x3882e5(0x2b9)]}}});}_0x2822d5[_0x3882e5(0x2d9)]=_0x3882e5(0x288);const _0x18b74f=await _0x2822d5[_0x3882e5(0x23e)](),_0x25e096=await master_shop['find'](),_0xe4d53a=await email_settings[_0x3882e5(0x2c9)](),_0x500e79=await supervisor_settings['find']();var _0x2b579f=_0x336fb5['product'],_0x30ea8e='',_0x584dc9;for(_0x584dc9 in _0x2b579f){var _0x51435d='FG';_0x336fb5[_0x3882e5(0x2f4)]==_0x3882e5(0x21c)&&(_0x51435d='DG'),_0x30ea8e+=_0x3882e5(0x2bc)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b579f[_0x584dc9]['product_name']+_0x3882e5(0x237)+_0x3882e5(0x2d4)+_0x2b579f[_0x584dc9][_0x3882e5(0x2ff)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b579f[_0x584dc9][_0x3882e5(0x28b)]+_0x3882e5(0x237)+_0x3882e5(0x2d4)+_0x2b579f[_0x584dc9][_0x3882e5(0x244)]+'</td>'+_0x3882e5(0x2d4)+_0x2b579f[_0x584dc9][_0x3882e5(0x201)]+_0x3882e5(0x237)+_0x3882e5(0x2d4)+_0x336fb5[_0x3882e5(0x2f4)]+_0x3882e5(0x237)+_0x3882e5(0x2d4)+_0x2b579f[_0x584dc9][_0x3882e5(0x1f4)]+_0x3882e5(0x237)+_0x3882e5(0x2d4)+_0x51435d+_0x2b579f[_0x584dc9][_0x3882e5(0x22c)]+_0x3882e5(0x237)+_0x3882e5(0x1fc);}_0x195ee9['flash']('success',_0x3882e5(0x224)),_0x42a7ec[_0x3882e5(0x1fa)]('/picking_list/pdf_puchases_fin_own_trf/'+_0x104aaa['_id']);}catch(_0x4dfdda){console[_0x3882e5(0x290)](_0x4dfdda),_0x42a7ec['status'](0x1f4)['json']({'error':_0x3882e5(0x2f7)});}})[_0x1380e1(0x307)](_0x4a2cb1=>{var _0x32ac3e=_0x1380e1;console[_0x32ac3e(0x290)](_0x4a2cb1),_0x42a7ec[_0x32ac3e(0x207)](0x1f4)[_0x32ac3e(0x2fc)]({'error':_0x32ac3e(0x222)});});}catch(_0xe63585){}}),router[a0_0x3316c3(0x2d3)]('/getTRF',auth,async(_0x10ff70,_0x4432bc)=>{var _0x25dae2=a0_0x3316c3;try{const {warehouse:_0x5e8773}=_0x10ff70[_0x25dae2(0x2d6)],_0x5ba5b6=await transfers_finished[_0x25dae2(0x22d)]({'to_warehouse':_0x5e8773,'to_recieved':_0x25dae2(0x2df)});_0x4432bc['json'](_0x5ba5b6);}catch(_0x52ddd0){}}),router[a0_0x3316c3(0x2d3)]('/getinvoicetrf',auth,async(_0x24a179,_0x31ca60)=>{var _0x522211=a0_0x3316c3;try{const {invoice:_0x38f272}=_0x24a179['body'],_0x4050ed=await transfers_finished['find']({'_id':_0x38f272,'to_recieved':_0x522211(0x2df)});_0x31ca60['json'](_0x4050ed);}catch(_0x8f974d){}}),router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x2cd),auth,async(_0xdabcf0,_0x4ed5e5)=>{var _0x833adf=a0_0x3316c3;try{const {username:_0x2bbe23,email:_0x2f8d76,role:_0x192d92}=_0xdabcf0[_0x833adf(0x2ec)],_0x50cda5=_0xdabcf0[_0x833adf(0x2ec)],_0x3c7ba0=await profile[_0x833adf(0x2c9)]({'email':_0x50cda5[_0x833adf(0x27a)]}),_0x2aed70=await staff[_0x833adf(0x2c9)]({'email':_0x50cda5[_0x833adf(0x27a)]});if(_0x50cda5['role']==_0x833adf(0x281)){const _0x417f6c=await staff[_0x833adf(0x2c9)]({'email':_0x50cda5[_0x833adf(0x27a)]});}const _0x24bf3c=await master_shop[_0x833adf(0x22d)]();let _0x8ac17;if(_0x50cda5['role']=='staff'){const _0x25a930=await staff[_0x833adf(0x2c9)]({'email':_0x50cda5['email']});_0x8ac17=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x25a930[_0x833adf(0x2c7)],'typeOfProducts':'own'}},{'$lookup':{'from':'suppliers','localField':_0x833adf(0x1e6),'foreignField':_0x833adf(0x273),'as':_0x833adf(0x1f1)}},{'$unwind':_0x833adf(0x2fa)},{'$unwind':_0x833adf(0x2e1)},{'$group':{'_id':_0x833adf(0x234),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x833adf(0x2ac)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x833adf(0x256)},'room':{'$first':'$room'},'product':{'$push':_0x833adf(0x2e1)},'note':{'$first':_0x833adf(0x2e3)},'paid_amount':{'$first':_0x833adf(0x2ad)},'due_amount':{'$first':_0x833adf(0x2f8)},'return_data':{'$first':_0x833adf(0x213)},'batch_code':{'$first':_0x833adf(0x1ea)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x833adf(0x251)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x833adf(0x230)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x8ac17=await purchases_finished[_0x833adf(0x292)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':_0x833adf(0x2e1)},{'$group':{'_id':'$_id','invoice':{'$first':_0x833adf(0x2bb)},'suppliers':{'$first':_0x833adf(0x2ac)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x833adf(0x256)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x833adf(0x2e1)},'note':{'$first':_0x833adf(0x2e3)},'paid_amount':{'$first':_0x833adf(0x2ad)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x833adf(0x213)},'batch_code':{'$first':_0x833adf(0x1ea)},'expiry_date':{'$first':_0x833adf(0x2f5)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x833adf(0x27b)},'level':{'$addToSet':_0x833adf(0x251)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x833adf(0x230)},'floorlevel':{'$addToSet':_0x833adf(0x2ee)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x24bf3c[0x0][_0x833adf(0x2b2)]==_0x833adf(0x28e))var _0xd68048=users[_0x833adf(0x27f)];else{if(_0x24bf3c[0x0]['language']==_0x833adf(0x24c))var _0xd68048=users['Hindi'];else{if(_0x24bf3c[0x0]['language']==_0x833adf(0x240))var _0xd68048=users[_0x833adf(0x240)];else{if(_0x24bf3c[0x0][_0x833adf(0x2b2)]==_0x833adf(0x22e))var _0xd68048=users[_0x833adf(0x22e)];else{if(_0x24bf3c[0x0][_0x833adf(0x2b2)]=='French')var _0xd68048=users[_0x833adf(0x2a2)];else{if(_0x24bf3c[0x0][_0x833adf(0x2b2)]==_0x833adf(0x258))var _0xd68048=users['Portuguese'];else{if(_0x24bf3c[0x0][_0x833adf(0x2b2)]=='Chinese')var _0xd68048=users[_0x833adf(0x1f3)];else{if(_0x24bf3c[0x0][_0x833adf(0x2b2)]==_0x833adf(0x301))var _0xd68048=users[_0x833adf(0x284)];}}}}}}}_0x4ed5e5['render'](_0x833adf(0x261),{'success':_0xdabcf0[_0x833adf(0x211)](_0x833adf(0x308)),'errors':_0xdabcf0[_0x833adf(0x211)](_0x833adf(0x23b)),'purchases':_0x8ac17,'role':_0x50cda5,'profile':_0x3c7ba0,'master_shop':_0x24bf3c,'language':_0xd68048});}catch(_0x576a44){console[_0x833adf(0x2e7)](_0x833adf(0x1d7),_0x576a44),_0x4ed5e5[_0x833adf(0x207)](0xc8)[_0x833adf(0x2fc)]({'message':_0x576a44[_0x833adf(0x29a)]});}}),router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x2a9),auth,async(_0x4846ca,_0xd31125)=>{var _0x39bfd2=a0_0x3316c3;try{const {username:_0x1b964d,email:_0x207368,role:_0x23fe48}=_0x4846ca[_0x39bfd2(0x2ec)],_0x4d8d6d=_0x4846ca['user'],_0x363969=await profile[_0x39bfd2(0x2c9)]({'email':_0x4d8d6d[_0x39bfd2(0x27a)]}),_0x41a010=await staff['findOne']({'email':_0x4d8d6d[_0x39bfd2(0x27a)]});if(_0x4d8d6d['role']==_0x39bfd2(0x281)){const _0x2e86d7=await staff[_0x39bfd2(0x2c9)]({'email':_0x4d8d6d[_0x39bfd2(0x27a)]});}const _0x335086=await master_shop[_0x39bfd2(0x22d)]();let _0x3ff7a5;if(_0x4d8d6d['role']=='staff'){const _0x4eac5c=await staff['findOne']({'email':_0x4d8d6d[_0x39bfd2(0x27a)]});_0x3ff7a5=await purchases_finished[_0x39bfd2(0x292)]([{'$match':{'warehouse_name':_0x4eac5c[_0x39bfd2(0x2c7)]}},{'$lookup':{'from':_0x39bfd2(0x1e6),'localField':_0x39bfd2(0x1e6),'foreignField':'name','as':_0x39bfd2(0x1f1)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x39bfd2(0x2e1)},{'$group':{'_id':_0x39bfd2(0x234),'invoice':{'$first':_0x39bfd2(0x2bb)},'suppliers':{'$first':_0x39bfd2(0x2ac)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x39bfd2(0x256)},'room':{'$first':_0x39bfd2(0x2b5)},'product':{'$push':_0x39bfd2(0x2e1)},'note':{'$first':_0x39bfd2(0x2e3)},'paid_amount':{'$first':_0x39bfd2(0x2ad)},'due_amount':{'$first':_0x39bfd2(0x2f8)},'return_data':{'$first':_0x39bfd2(0x213)},'batch_code':{'$first':_0x39bfd2(0x1ea)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x39bfd2(0x251)},'isle':{'$addToSet':_0x39bfd2(0x21b)},'type':{'$addToSet':_0x39bfd2(0x230)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3ff7a5=await purchases_finished[_0x39bfd2(0x292)]([{'$match':{'typeOfProducts':_0x39bfd2(0x2bd)}},{'$unwind':_0x39bfd2(0x2e1)},{'$group':{'_id':_0x39bfd2(0x234),'invoice':{'$first':_0x39bfd2(0x2bb)},'suppliers':{'$first':_0x39bfd2(0x2ac)},'date':{'$first':_0x39bfd2(0x271)},'warehouse_name':{'$first':_0x39bfd2(0x256)},'room':{'$addToSet':_0x39bfd2(0x2e2)},'product':{'$push':_0x39bfd2(0x2e1)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x39bfd2(0x2ad)},'due_amount':{'$first':_0x39bfd2(0x2f8)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x39bfd2(0x1ea)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x39bfd2(0x27b)},'level':{'$addToSet':_0x39bfd2(0x251)},'isle':{'$addToSet':_0x39bfd2(0x21b)},'type':{'$addToSet':_0x39bfd2(0x230)},'floorlevel':{'$addToSet':_0x39bfd2(0x2ee)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x335086[0x0][_0x39bfd2(0x2b2)]==_0x39bfd2(0x28e))var _0x2d5edb=users['English'];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]==_0x39bfd2(0x24c))var _0x2d5edb=users[_0x39bfd2(0x24c)];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]=='German')var _0x2d5edb=users[_0x39bfd2(0x240)];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]=='Spanish')var _0x2d5edb=users['Spanish'];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]==_0x39bfd2(0x2a2))var _0x2d5edb=users['French'];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]==_0x39bfd2(0x258))var _0x2d5edb=users['Portuguese'];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]==_0x39bfd2(0x1f3))var _0x2d5edb=users[_0x39bfd2(0x1f3)];else{if(_0x335086[0x0][_0x39bfd2(0x2b2)]==_0x39bfd2(0x301))var _0x2d5edb=users[_0x39bfd2(0x284)];}}}}}}}_0xd31125[_0x39bfd2(0x29b)](_0x39bfd2(0x293),{'success':_0x4846ca[_0x39bfd2(0x211)](_0x39bfd2(0x308)),'errors':_0x4846ca[_0x39bfd2(0x211)](_0x39bfd2(0x23b)),'purchases':_0x3ff7a5,'role':_0x4d8d6d,'profile':_0x363969,'master_shop':_0x335086,'language':_0x2d5edb});}catch(_0x38c49a){console[_0x39bfd2(0x2e7)](_0x39bfd2(0x1d7),_0x38c49a),_0xd31125[_0x39bfd2(0x207)](0xc8)[_0x39bfd2(0x2fc)]({'message':_0x38c49a['message']});}});function BayBinSelected(_0x549acb,_0x47c7ae){var _0x32e469=a0_0x3316c3,_0x48cfc8=[],_0x5c569f=[];if(_0x549acb==_0x32e469(0x21c)){switch(_0x47c7ae){case'Rack\x201':_0x48cfc8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x32e469(0x22b):_0x48cfc8=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5c569f=['DG'];}else{if(_0x549acb==_0x32e469(0x30f)){switch(_0x47c7ae){case _0x32e469(0x2c3):_0x48cfc8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x32e469(0x22b):_0x48cfc8=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5c569f=['FG'];}}return{'levels':_0x48cfc8,'identify':_0x5c569f};}function a0_0x5cad(){var _0x11dfbf=['valueOf','FROZEN\x20GOODS','Error\x20Occurs','/all_purchases_finished/process/','product_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','There\x20is\x20','</body></html>','secondary_code_hide','table\x20page','Finished\x20Goods','toString','Email\x20sent\x20successfully','getFullYear','edit_purchases_finished','/../public','1344XdWJRu','Error\x20occurred\x20while\x20processing\x20product:','<!DOCTYPE\x20html>','/upload/','maxperunit','$maxStocks','$product_details','<table\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers','findById','return_purchase_finished','note','$batch_code','$maxProdPerUnit','room','all','return_data','maxPerUnit','/view/add_purchases','suppliers_docs','prod_code','Chinese','to_room_name','type_of_products','/process/:id','</thead>','_id','string','redirect','prod_qty','</tr>','\x20Order\x20Number\x20:\x20','</div>','Purchase\x20Return','product_cat','secondary_unit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','purchase\x20data\x20update\x20successfully','INC','834232HnwPYe','sendMail','status','4634580zeomxT','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','get','<h2>\x20','match','add_purchases_finished_logs','user_id','flash','Purchase\x20Return\x20Mail','$return_data','purchases\x20item\x20return\x20successfull','id_transaction','LOG-INC-','Enclosed','then','</h5>','prod_Qty','$product.bin','DRY\x20GOODS','batch_code','padStart','/view/add_purchases/:id','return_product','getDate','An\x20error\x20occurred.','production_date','Transfer\x20Finalize\x20Successfully','prod_cat','max_product_unit','sales_data_cateory','gross_price','maxProducts','add_purchases_finished','Rack\x202','to_bay','find','Spanish','product','$product.type','472592wtYvPl','slice','prod_name','$_id','amount','</tbody>','</td>','$secondary_code','date_recieved','$name','errors','$category','\x20<=>\x20','save','map','German','Return\x20Goods','ejs','nodemailer','unit','forEach','Purchase\x20Mail','expiry_date','quantity','isProcess','concat','$product_code','Hindi','<h5>','<html><head><title></title>','INCF-','\x20<>\x20','$product.bay','\x20Order\x20Date\x20:\x20','sales_category','JO_number','updateOne','$warehouse_name','Portuguese','Portuguese\x20(BR)','<div>','$product_details.rack','back','abs','<hr\x20class=\x22my-3\x22>','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','all_purchases_finished','168JOMKPd','path','/view/add_purchases_logs','prod_level','invoice_init','length','bin','/barcode_scanner_logs','filter','../middleware/auth','/barcode_scanner','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','primary_code','1912687lMWuoO','Logo.png','$date','logo','name','Distributing\x20','getMonth','$type_products','\x20</h2>','/give_payment/:id','date','email','$product.quantity','11FOVuYG','maxStocks','express','English','product_stock','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$primary_code','Arabic','$product_details.product_name','/barcode/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','true','$secondary_unit','/CheckingWarehouse','to_quantity','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssign','English\x20(US)','room_name','error','product_date','aggregate','all_purchases_finished_logs','$unit','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','payment\x20successfull','<strong>\x20Regards\x20</strong>','An\x20error\x20occurred\x20while\x20saving\x20data.','message','render','MaxStocks_data','/incoming/add','purchases_process','currency_placement','params','purchase_invoice','French','item_code','random','10FRLzVK','invoice','18gnjqcD','/all_purchases_finished/preview/','/view_log','en-CA','</span>','$suppliers','$paid_amount','/all_purchases_finished/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','purchases_id','language',',\x20room:\x20','type_of_products_type','$room','../public/language/languages.json','/view/:id','Enabled','product_details','paid_amount','$invoice','<tr>','logs','currency','product_name','primary_code_hide','level','warehouse_name','Rack\x201','standard_unit','$product_details.bay','secondary_code','warehouse','/invoice/:id','findOne','$brand','createTransport','Ambient','/view','POnumber',',\x20bin:\x20','bay','$alertquantity','$product_details.primary_code','post','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','site_title','to_recieved','Paid\x20For\x20Purchase','/view/return_purchase/:id','add_purchases\x20error','stock_data','$product_details._id','false','toLocaleDateString','$product','$product.room_name','$note','prod_unit','$sales_category','purchase\x20data\x20add\x20successfully','log','/all_purchases/view','prod_primunit','edit_purchases_finished_view','$gross_price','user','purchase_quantity','$product.floorlevel','INC-','765588sSpFjg','undefined','role','password','to_warehouse','$expiry_date','uuid','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$due_amount','return_qty','$suppliers_docs','product_code_hide','json',',\x20bay:\x20','</table>','product_code','exports','Arabic\x20(ae)','product_data','stocks','889404XyQhNA','$product_details.product_stock','<span\x20style=\x22float:\x20right;\x22>','catch','success','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_secondunit','gmail','due_amount','$product_details.bin'];a0_0x5cad=function(){return _0x11dfbf;};return a0_0x5cad();}async function getRandom8DigitNumber(){var _0x170e72=a0_0x3316c3;const _0x5e5be5=0x989680,_0x317985=0x5f5e0ff,_0x4e6b98=Math[_0x170e72(0x295)](Math[_0x170e72(0x2a4)]()*(_0x317985-_0x5e5be5+0x1))+_0x5e5be5;var _0x4a1c4b;const _0x1d3bd5=await purchases_finished[_0x170e72(0x2c9)]({'invoice':_0x170e72(0x24f)+_0x4e6b98});return _0x1d3bd5&&_0x1d3bd5[_0x170e72(0x267)]>0x0?_0x4a1c4b=_0x170e72(0x24f)+_0x4e6b98:_0x4a1c4b=_0x170e72(0x24f)+_0x4e6b98,_0x4a1c4b;}router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x1f0),auth,async(_0x1bc830,_0x30770c)=>{var _0x1d5ad6=a0_0x3316c3;try{const {username:_0x2a22cd,email:_0x13b2f5,role:_0x3f15b2}=_0x1bc830[_0x1d5ad6(0x2ec)],_0x9fc534=_0x1bc830[_0x1d5ad6(0x2ec)],_0x17073e=await profile[_0x1d5ad6(0x2c9)]({'email':_0x9fc534[_0x1d5ad6(0x27a)]}),_0x3156a1=await master_shop[_0x1d5ad6(0x22d)](),_0x36313d=await staff[_0x1d5ad6(0x2c9)]({'email':_0x9fc534[_0x1d5ad6(0x27a)]}),_0x51c53e=await suppliers[_0x1d5ad6(0x22d)]({});let _0x27edef;if(_0x9fc534[_0x1d5ad6(0x2f2)]==_0x1d5ad6(0x281)){const _0x3d9ec6=await staff[_0x1d5ad6(0x2c9)]({'email':_0x9fc534[_0x1d5ad6(0x27a)]});_0x27edef=await warehouse[_0x1d5ad6(0x292)]([{'$match':{'status':_0x1d5ad6(0x2b8),'name':_0x3d9ec6[_0x1d5ad6(0x2c7)]}},{'$group':{'_id':_0x1d5ad6(0x23a),'name':{'$first':_0x1d5ad6(0x23a)}}}]);}else _0x27edef=await warehouse['aggregate']([{'$match':{'status':_0x1d5ad6(0x2b8)}},{'$group':{'_id':'$name','name':{'$first':_0x1d5ad6(0x23a)}}}]);const _0x447dbe=await product[_0x1d5ad6(0x22d)]({}),_0x633dcd=await warehouse['find']({'status':_0x1d5ad6(0x2b8)}),_0x22c84d=await purchases_finished[_0x1d5ad6(0x22d)]({}),_0x242ebe=_0x22c84d['length']+0x1,_0x9fdb3a=_0x1d5ad6(0x24f)+_0x242ebe[_0x1d5ad6(0x1d9)]()[_0x1d5ad6(0x21e)](0x5,'0');var _0x1bc0ca=[_0x1d5ad6(0x2cc),_0x1d5ad6(0x217)];if(_0x3156a1[0x0]['language']==_0x1d5ad6(0x28e))var _0x2c3c70=users[_0x1d5ad6(0x27f)];else{if(_0x3156a1[0x0]['language']=='Hindi')var _0x2c3c70=users[_0x1d5ad6(0x24c)];else{if(_0x3156a1[0x0]['language']=='German')var _0x2c3c70=users[_0x1d5ad6(0x240)];else{if(_0x3156a1[0x0]['language']==_0x1d5ad6(0x22e))var _0x2c3c70=users['Spanish'];else{if(_0x3156a1[0x0][_0x1d5ad6(0x2b2)]==_0x1d5ad6(0x2a2))var _0x2c3c70=users[_0x1d5ad6(0x2a2)];else{if(_0x3156a1[0x0][_0x1d5ad6(0x2b2)]==_0x1d5ad6(0x258))var _0x2c3c70=users['Portuguese'];else{if(_0x3156a1[0x0][_0x1d5ad6(0x2b2)]==_0x1d5ad6(0x1f3))var _0x2c3c70=users[_0x1d5ad6(0x1f3)];else{if(_0x3156a1[0x0][_0x1d5ad6(0x2b2)]==_0x1d5ad6(0x301))var _0x2c3c70=users[_0x1d5ad6(0x284)];}}}}}}}const _0x537fa1=getRandom8DigitNumber(),_0xc14559=new Date(),_0xd120b5={'year':'numeric','month':'2-digit','day':'2-digit','timeZone':'Asia/Manila'},_0x3b39c1=_0xc14559[_0x1d5ad6(0x2e0)](_0x1d5ad6(0x2aa),_0xd120b5);console[_0x1d5ad6(0x2e7)](_0x3b39c1),_0x537fa1[_0x1d5ad6(0x218)](_0x1cebc0=>{var _0x195093=_0x1d5ad6;_0x30770c[_0x195093(0x29b)](_0x195093(0x22a),{'success':_0x1bc830[_0x195093(0x211)]('success'),'errors':_0x1bc830[_0x195093(0x211)](_0x195093(0x23b)),'role':_0x9fc534,'profile':_0x17073e,'suppliers':_0x51c53e,'warehouse':_0x27edef,'product':_0x447dbe,'invoice':_0x1cebc0,'master_shop':_0x3156a1,'language':_0x2c3c70,'find_data':_0x633dcd,'rooms_data':_0x1bc0ca,'formattedDate':_0x3b39c1});})[_0x1d5ad6(0x307)](_0x374f84=>{var _0x4e547a=_0x1d5ad6;_0x1bc830[_0x4e547a(0x211)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x30770c[_0x4e547a(0x1fa)]('/all_purchases_finished/view');});}catch(_0x54f374){console[_0x1d5ad6(0x2e7)](_0x54f374);}}),router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x264),auth,async(_0x5dcd12,_0xf1d7cd)=>{var _0x3c66e9=a0_0x3316c3;try{const {username:_0x1840f,email:_0x20a4f8,role:_0x51f87e}=_0x5dcd12['user'],_0x273c94=_0x5dcd12[_0x3c66e9(0x2ec)],_0x41bd44=await profile[_0x3c66e9(0x2c9)]({'email':_0x273c94[_0x3c66e9(0x27a)]}),_0x5476a4=await master_shop['find'](),_0x2604d1=await staff[_0x3c66e9(0x2c9)]({'email':_0x273c94[_0x3c66e9(0x27a)]}),_0x563ac8=await suppliers[_0x3c66e9(0x22d)]({});let _0x352d8f;if(_0x273c94[_0x3c66e9(0x2f2)]==_0x3c66e9(0x281)){const _0x8fa25e=await staff[_0x3c66e9(0x2c9)]({'email':_0x273c94['email']});_0x352d8f=await warehouse[_0x3c66e9(0x292)]([{'$match':{'status':_0x3c66e9(0x2b8),'name':_0x8fa25e[_0x3c66e9(0x2c7)]}},{'$group':{'_id':_0x3c66e9(0x23a),'name':{'$first':'$name'}}}]);}else _0x352d8f=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3c66e9(0x23a),'name':{'$first':_0x3c66e9(0x23a)}}}]);const _0x284678=await product['find']({}),_0x359498=await warehouse[_0x3c66e9(0x22d)]({'status':'Enabled'}),_0x1697f7=await purchases_finished[_0x3c66e9(0x22d)]({}),_0x1ef567=_0x1697f7[_0x3c66e9(0x267)]+0x1,_0x56536a=_0x3c66e9(0x24f)+_0x1ef567[_0x3c66e9(0x1d9)]()[_0x3c66e9(0x21e)](0x5,'0');var _0x39c515=[_0x3c66e9(0x2cc),_0x3c66e9(0x217)];if(_0x5476a4[0x0]['language']==_0x3c66e9(0x28e))var _0x1557dc=users[_0x3c66e9(0x27f)];else{if(_0x5476a4[0x0]['language']==_0x3c66e9(0x24c))var _0x1557dc=users[_0x3c66e9(0x24c)];else{if(_0x5476a4[0x0][_0x3c66e9(0x2b2)]=='German')var _0x1557dc=users['German'];else{if(_0x5476a4[0x0]['language']==_0x3c66e9(0x22e))var _0x1557dc=users[_0x3c66e9(0x22e)];else{if(_0x5476a4[0x0][_0x3c66e9(0x2b2)]=='French')var _0x1557dc=users[_0x3c66e9(0x2a2)];else{if(_0x5476a4[0x0]['language']=='Portuguese\x20(BR)')var _0x1557dc=users[_0x3c66e9(0x257)];else{if(_0x5476a4[0x0][_0x3c66e9(0x2b2)]==_0x3c66e9(0x1f3))var _0x1557dc=users[_0x3c66e9(0x1f3)];else{if(_0x5476a4[0x0]['language']==_0x3c66e9(0x301))var _0x1557dc=users['Arabic'];}}}}}}}const _0x3e6fa8=getRandom8DigitNumber();_0x3e6fa8['then'](_0x18414f=>{var _0x5c92c8=_0x3c66e9;_0xf1d7cd['render'](_0x5c92c8(0x20f),{'success':_0x5dcd12[_0x5c92c8(0x211)]('success'),'errors':_0x5dcd12[_0x5c92c8(0x211)](_0x5c92c8(0x23b)),'role':_0x273c94,'profile':_0x41bd44,'suppliers':_0x563ac8,'warehouse':_0x352d8f,'product':_0x284678,'invoice':_0x18414f,'master_shop':_0x5476a4,'language':_0x1557dc,'find_data':_0x359498,'rooms_data':_0x39c515});})[_0x3c66e9(0x307)](_0xbaffee=>{var _0x118017=_0x3c66e9;_0x5dcd12[_0x118017(0x211)]('errors',_0x118017(0x2b0)),_0xf1d7cd[_0x118017(0x1fa)]('/all_purchases_finished/view');});}catch(_0x1d960c){console[_0x3c66e9(0x2e7)](_0x1d960c);}}),router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x21f),auth,async(_0x929ca1,_0x21022f)=>{var _0x4bb431=a0_0x3316c3;try{const _0x548fcb=_0x929ca1['params']['id'];console[_0x4bb431(0x2e7)](_0x548fcb);const _0x17af71=await master_shop[_0x4bb431(0x22d)]();console[_0x4bb431(0x2e7)](_0x4bb431(0x20a),_0x17af71);const _0x135991=await product[_0x4bb431(0x2c9)]({'name':_0x548fcb});console[_0x4bb431(0x2e7)](_0x4bb431(0x22f),_0x135991),_0x21022f[_0x4bb431(0x207)](0xc8)[_0x4bb431(0x2fc)]({'product_data':_0x135991,'master':_0x17af71});}catch(_0x4cd91c){console[_0x4bb431(0x2e7)](_0x4bb431(0x2dc),_0x4cd91c);}}),router[a0_0x3316c3(0x2d3)]('/view/add_purchases',auth,async(_0x5a838a,_0x2691fa)=>{var _0x515ce9=a0_0x3316c3;try{const {invoice:_0x2a4fc3,date:_0x4d1c8e,warehouse_name:_0x25e1e6,prod_name:_0x3eafde,note:_0x441d6d,due_amount:_0x7e102c,Room_name:_0x223ea4,PO_number:_0x738c07,SCRN:_0x7a32ad,ReqBy:_0x47acf1,dateofreq:_0x2dadc6,suppliers:_0xb121d,typeservicesData:_0x4972af,van:_0x44e0a5,typevehicle:_0x4b87dd,driver:_0xfe034,plate:_0x4c2d0d,DRSI:_0x708763,TSU:_0xe12be8,TFU:_0x2fbee5,JO_number:_0xc0ca3e,type_of_products:_0x51c749}=_0x5a838a[_0x515ce9(0x2d6)];if(typeof _0x3eafde==_0x515ce9(0x1f9))var _0x28ae31=[_0x5a838a['body'][_0x515ce9(0x233)]],_0x55d1a5=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x1f2)]],_0x3c1f33=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x21a)]],_0x4fcf05=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x2e9)]],_0x5373da=[_0x5a838a[_0x515ce9(0x2d6)]['prod_secondunit']],_0x466350=[_0x5a838a['body'][_0x515ce9(0x265)]],_0x2d11fd=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x26e)]],_0x149498=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x2c6)]],_0x4cb352=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x29c)]],_0x3b84fe=[_0x5a838a['body'][_0x515ce9(0x21d)]],_0x4812bd=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x247)]],_0x1d9072=[_0x5a838a['body']['product_date']],_0x146f15=[_0x5a838a[_0x515ce9(0x2d6)]['max_product_unit']],_0x5033c8=[_0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x225)]],_0x385c4a=[_0x5a838a['body']['RoomAssign']],_0x3daec2=[_0x5a838a['body'][_0x515ce9(0x228)]],_0x41bc19=[_0x5a838a['body'][_0x515ce9(0x2f6)]],_0x47a9d0=[_0x5a838a['body']['sales_data_cateory']],_0x36c2cf=[_0x5a838a[_0x515ce9(0x2d6)]['product_id']];else var _0x28ae31=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x233)]],_0x55d1a5=[..._0x5a838a['body'][_0x515ce9(0x1f2)]],_0x3c1f33=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x21a)]],_0x4fcf05=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x2e9)]],_0x5373da=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x30a)]],_0x466350=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x265)]],_0x2d11fd=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x26e)]],_0x149498=[..._0x5a838a[_0x515ce9(0x2d6)]['secondary_code']],_0x4cb352=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x29c)]],_0x3b84fe=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x21d)]],_0x4812bd=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x247)]],_0x1d9072=[..._0x5a838a[_0x515ce9(0x2d6)]['product_date']],_0x146f15=[..._0x5a838a['body'][_0x515ce9(0x226)]],_0x5033c8=[..._0x5a838a['body'][_0x515ce9(0x225)]],_0x385c4a=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x28d)]],_0x3daec2=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x228)]],_0x41bc19=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x2f6)]],_0x47a9d0=[..._0x5a838a['body']['sales_data_cateory']],_0x36c2cf=[..._0x5a838a[_0x515ce9(0x2d6)][_0x515ce9(0x312)]];const _0x37ab61=_0x28ae31[_0x515ce9(0x23f)](_0x36beb0=>{return _0x36beb0={'product_name':_0x36beb0};});_0x36c2cf['forEach']((_0x142d01,_0x2442b5)=>{var _0x1d2338=_0x515ce9;_0x37ab61[_0x2442b5][_0x1d2338(0x312)]=_0x142d01,_0x37ab61[_0x2442b5][_0x1d2338(0x239)]=_0x4d1c8e;}),_0x47a9d0[_0x515ce9(0x245)]((_0x272206,_0xc61cef)=>{var _0x2bd318=_0x515ce9;_0x37ab61[_0xc61cef][_0x2bd318(0x253)]=_0x272206;}),_0x55d1a5[_0x515ce9(0x245)]((_0x3ceb4e,_0x279252)=>{var _0x1c8dde=_0x515ce9;_0x37ab61[_0x279252][_0x1c8dde(0x2ff)]=_0x3ceb4e;}),_0x41bc19['forEach']((_0x2ab72d,_0xd111ef)=>{var _0x4a0699=_0x515ce9;_0x37ab61[_0xd111ef][_0x4a0699(0x2f6)]=_0x2ab72d;}),_0x3c1f33[_0x515ce9(0x245)]((_0x4b51ea,_0x5cb44e)=>{var _0x1970f4=_0x515ce9;_0x37ab61[_0x5cb44e][_0x1970f4(0x248)]=Math['abs'](_0x4b51ea);}),_0x4fcf05['forEach']((_0x4410da,_0x39ead7)=>{var _0x551b02=_0x515ce9;_0x37ab61[_0x39ead7][_0x551b02(0x2c4)]=_0x4410da;}),_0x5373da[_0x515ce9(0x245)]((_0x225d62,_0x21646e)=>{var _0x19ee0b=_0x515ce9;_0x37ab61[_0x21646e][_0x19ee0b(0x201)]=_0x225d62;}),_0x2d11fd[_0x515ce9(0x245)]((_0x21f6e1,_0x4ee2e7)=>{var _0x40da4a=_0x515ce9;_0x37ab61[_0x4ee2e7][_0x40da4a(0x26e)]=_0x21f6e1;}),_0x149498[_0x515ce9(0x245)]((_0x5cd232,_0x31dc4b)=>{var _0x5d47e5=_0x515ce9;_0x37ab61[_0x31dc4b][_0x5d47e5(0x2c6)]=_0x5cd232;}),_0x4cb352[_0x515ce9(0x245)]((_0x2dbdfb,_0xe18ad0)=>{var _0x2bde83=_0x515ce9;_0x37ab61[_0xe18ad0][_0x2bde83(0x27d)]=_0x2dbdfb;}),_0x3b84fe['forEach']((_0x55dec5,_0x1e536b)=>{var _0x5dff99=_0x515ce9;_0x37ab61[_0x1e536b][_0x5dff99(0x21d)]=_0x55dec5;}),_0x4812bd[_0x515ce9(0x245)]((_0x244b8a,_0x138f28)=>{var _0x59d610=_0x515ce9;_0x37ab61[_0x138f28][_0x59d610(0x247)]=_0x244b8a;}),_0x1d9072['forEach']((_0x1fc29f,_0x51c2b7)=>{var _0x1e4729=_0x515ce9;_0x37ab61[_0x51c2b7][_0x1e4729(0x223)]=_0x1fc29f;}),_0x146f15[_0x515ce9(0x245)]((_0xe17182,_0x1107c1)=>{var _0x2bd342=_0x515ce9;_0x37ab61[_0x1107c1][_0x2bd342(0x1e2)]=_0xe17182;}),_0x5033c8[_0x515ce9(0x245)]((_0x39be5a,_0x896fad)=>{var _0x5e40b5=_0x515ce9;_0x37ab61[_0x896fad][_0x5e40b5(0x200)]=_0x39be5a;}),_0x385c4a[_0x515ce9(0x245)]((_0x12bcbf,_0x4a1084)=>{var _0x164247=_0x515ce9;_0x37ab61[_0x4a1084][_0x164247(0x28f)]=_0x12bcbf;}),_0x3daec2['forEach']((_0x506379,_0x38d83c)=>{var _0x5f3d54=_0x515ce9;_0x37ab61[_0x38d83c][_0x5f3d54(0x228)]=_0x506379;});const _0x4e0508=new invoice_for_incoming();await _0x4e0508[_0x515ce9(0x23e)]();for(let _0x5539d3=0x0;_0x5539d3<=_0x385c4a[_0x515ce9(0x267)]-0x1;_0x5539d3++){_0x37ab61[_0x5539d3][_0x515ce9(0x2a6)]=_0x515ce9(0x2ef)+_0x4e0508[_0x515ce9(0x266)][_0x515ce9(0x1d9)]()[_0x515ce9(0x21e)](0x8,'0');}const _0xb2551f=await warehouse_validation_setup[_0x515ce9(0x292)]([{'$match':{'warehouse_name':_0x25e1e6}}]);let _0x294fa3=[];for(let _0x193b70=0x0;_0x193b70<=_0x37ab61[_0x515ce9(0x267)]-0x1;_0x193b70++){const _0xfc6ac8=_0x37ab61[_0x193b70];for(let _0x4e3bcc=0x0;_0x4e3bcc<=_0xb2551f['length']-0x1;_0x4e3bcc++){const _0x3165c8=_0xb2551f[_0x4e3bcc];for(let _0x29bdaf=0x0;_0x29bdaf<=_0x3165c8[_0x515ce9(0x302)][_0x515ce9(0x267)]-0x1;_0x29bdaf++){const _0x39d749=_0x3165c8[_0x515ce9(0x302)][_0x29bdaf];if(_0x39d749[_0x515ce9(0x2ff)]===_0xfc6ac8['product_code']){let _0x28077d=_0xfc6ac8[_0x515ce9(0x248)];const _0x284e0=await warehouse[_0x515ce9(0x292)]([{'$match':{'name':_0x25e1e6,'room':_0x3165c8['room']}},{'$unwind':_0x515ce9(0x1e4)},{'$match':{'level':_0x39d749[_0x515ce9(0x2d0)],'bay':_0x39d749[_0x515ce9(0x268)]}}]);if(_0x284e0[_0x515ce9(0x267)]==0x0){for(let _0x2c4700=0x0;_0x2c4700<=_0x3165c8['product_data']['length']-0x1&&_0x28077d>0x0;_0x2c4700++){const _0x4b852f=_0x3165c8[_0x515ce9(0x302)][_0x2c4700];if(_0xfc6ac8[_0x515ce9(0x2ff)]===_0x4b852f[_0x515ce9(0x2ff)]){_0x294fa3[_0x2c4700]={};const _0x273de1=parseInt(_0x4b852f['max']),_0x2e7a71=0x0;let _0x40272c=_0x273de1-_0x2e7a71,_0xe847f1=Math['min'](_0x28077d,_0x40272c);console[_0x515ce9(0x2e7)](_0x515ce9(0x274)+_0xe847f1+'\x20units\x20to\x20warehouse:\x20'+_0x3165c8[_0x515ce9(0x2c2)]+_0x515ce9(0x2b3)+_0x3165c8['room']+_0x515ce9(0x2fd)+_0x4b852f[_0x515ce9(0x2d0)]+_0x515ce9(0x2cf)+_0x4b852f[_0x515ce9(0x268)]),_0x294fa3[_0x2c4700][_0x515ce9(0x2bf)]=_0xfc6ac8['product_name'],_0x294fa3[_0x2c4700][_0x515ce9(0x2ff)]=_0xfc6ac8[_0x515ce9(0x2ff)],_0x294fa3[_0x2c4700][_0x515ce9(0x312)]=_0xfc6ac8[_0x515ce9(0x312)],_0x294fa3[_0x2c4700]['date_recieved']=_0xfc6ac8[_0x515ce9(0x239)],_0x294fa3[_0x2c4700][_0x515ce9(0x253)]=_0xfc6ac8[_0x515ce9(0x253)],_0x294fa3[_0x2c4700][_0x515ce9(0x2f6)]=_0xfc6ac8['uuid'],_0x294fa3[_0x2c4700][_0x515ce9(0x248)]=_0xe847f1,_0x294fa3[_0x2c4700][_0x515ce9(0x2c4)]=_0xfc6ac8[_0x515ce9(0x2c4)],_0x294fa3[_0x2c4700][_0x515ce9(0x201)]=_0xfc6ac8[_0x515ce9(0x201)],_0x294fa3[_0x2c4700][_0x515ce9(0x26e)]=_0xfc6ac8['primary_code'],_0x294fa3[_0x2c4700]['secondary_code']=_0xfc6ac8[_0x515ce9(0x2c6)],_0x294fa3[_0x2c4700][_0x515ce9(0x27d)]=_0xfc6ac8['maxStocks'],_0x294fa3[_0x2c4700][_0x515ce9(0x21d)]=_0xfc6ac8['batch_code'],_0x294fa3[_0x2c4700][_0x515ce9(0x247)]=_0xfc6ac8[_0x515ce9(0x247)],_0x294fa3[_0x2c4700]['production_date']=_0xfc6ac8[_0x515ce9(0x223)],_0x294fa3[_0x2c4700]['maxperunit']=_0xfc6ac8['maxperunit'],_0x294fa3[_0x2c4700]['product_cat']=_0xfc6ac8['product_cat'],_0x294fa3[_0x2c4700]['invoice']=_0xfc6ac8[_0x515ce9(0x2a6)],_0x294fa3[_0x2c4700][_0x515ce9(0x228)]=_0xfc6ac8[_0x515ce9(0x228)],_0x294fa3[_0x2c4700][_0x515ce9(0x28f)]=_0x3165c8[_0x515ce9(0x1ec)],_0x294fa3[_0x2c4700]['level']=_0x4b852f['bay'],_0x294fa3[_0x2c4700][_0x515ce9(0x2d0)]=_0x4b852f[_0x515ce9(0x268)],_0x28077d-=_0xe847f1;if(_0x28077d<=0x0)break;}}if(_0x28077d<=0x0)break;_0x28077d>0x0&&console[_0x515ce9(0x2e7)](_0x515ce9(0x314)+_0x28077d+_0x515ce9(0x2d5));}}}}}const _0x5aa5b4=_0x294fa3[_0x515ce9(0x26a)]((_0x14d7a0,_0x4e0238)=>{if(_0x4e0238>0x0)return{'item':_0x14d7a0};}),_0x53b002=_0x5aa5b4['filter'](_0x2ee9be=>_0x2ee9be[_0x515ce9(0x248)]!=='0'&&_0x2ee9be[_0x515ce9(0x248)]!==''),_0x3bb2c3=new purchases_finished({'invoice':'INC-'+_0x4e0508[_0x515ce9(0x266)]['toString']()[_0x515ce9(0x21e)](0x8,'0'),'suppliers':_0xb121d,'date':_0x4d1c8e,'warehouse_name':_0x25e1e6,'product':_0x53b002,'note':_0x441d6d,'due_amount':_0x7e102c,'room':_0x223ea4,'POnumber':_0x738c07,'SCRN':_0x7a32ad,'JO_number':_0xc0ca3e,'ReqBy':_0x47acf1,'dateofreq':_0x2dadc6,'typeservicesData':_0x4972af,'van':_0x44e0a5,'typevehicle':_0x4b87dd,'driver':_0xfe034,'plate':_0x4c2d0d,'DRSI':_0x708763,'TSU':_0xe12be8,'TFU':_0x2fbee5,'typeOfProducts':_0x51c749}),_0x109621=await _0x3bb2c3['save'](),_0x151f1a=await purchases_finished[_0x515ce9(0x2c9)]({'_id':_0x109621['_id']['valueOf']()});_0x5a838a[_0x515ce9(0x211)](_0x515ce9(0x308),_0x515ce9(0x2e6)),_0x2691fa[_0x515ce9(0x1fa)](_0x515ce9(0x311)+_0x151f1a[_0x515ce9(0x1f8)][_0x515ce9(0x30e)]());}catch(_0x732e42){console['log'](_0x732e42);}}),router['get'](a0_0x3316c3(0x1f6),auth,async(_0x3e857e,_0x142b85)=>{var _0x19de7c=a0_0x3316c3;try{const {username:_0x424d65,email:_0x4b9aaa,role:_0x4a817c}=_0x3e857e[_0x19de7c(0x2ec)],_0xc1a108=_0x3e857e[_0x19de7c(0x2ec)],_0x27ba5b=_0x3e857e[_0x19de7c(0x2a0)]['id'],_0x48a5f3=await profile[_0x19de7c(0x2c9)]({'email':_0xc1a108[_0x19de7c(0x27a)]}),_0x342410=await master_shop['find'](),_0x171036=await staff['findOne']({'email':_0xc1a108['email']}),_0x139d82=await suppliers[_0x19de7c(0x22d)]({});let _0x4f23af;if(_0xc1a108['role']==_0x19de7c(0x281)){const _0x2ac7b0=await staff['findOne']({'email':_0xc1a108['email']});_0x4f23af=await warehouse[_0x19de7c(0x292)]([{'$match':{'status':_0x19de7c(0x2b8),'name':_0x2ac7b0[_0x19de7c(0x2c7)]}},{'$group':{'_id':_0x19de7c(0x23a),'name':{'$first':_0x19de7c(0x23a)}}}]);}else _0x4f23af=await warehouse['aggregate']([{'$match':{'status':_0x19de7c(0x2b8)}},{'$group':{'_id':_0x19de7c(0x23a),'name':{'$first':_0x19de7c(0x23a)}}}]);const _0x2e7d2d=await purchases_finished['findById'](_0x27ba5b);if(_0x342410[0x0][_0x19de7c(0x2b2)]=='English\x20(US)')var _0x326ba1=users[_0x19de7c(0x27f)];else{if(_0x342410[0x0]['language']==_0x19de7c(0x24c))var _0x326ba1=users[_0x19de7c(0x24c)];else{if(_0x342410[0x0][_0x19de7c(0x2b2)]==_0x19de7c(0x240))var _0x326ba1=users[_0x19de7c(0x240)];else{if(_0x342410[0x0]['language']==_0x19de7c(0x22e))var _0x326ba1=users[_0x19de7c(0x22e)];else{if(_0x342410[0x0][_0x19de7c(0x2b2)]=='French')var _0x326ba1=users[_0x19de7c(0x2a2)];else{if(_0x342410[0x0][_0x19de7c(0x2b2)]==_0x19de7c(0x258))var _0x326ba1=users[_0x19de7c(0x257)];else{if(_0x342410[0x0]['language']==_0x19de7c(0x1f3))var _0x326ba1=users['Chinese'];else{if(_0x342410[0x0][_0x19de7c(0x2b2)]=='Arabic\x20(ae)')var _0x326ba1=users[_0x19de7c(0x284)];}}}}}}}_0x142b85[_0x19de7c(0x29b)](_0x19de7c(0x29e),{'success':_0x3e857e[_0x19de7c(0x211)](_0x19de7c(0x308)),'errors':_0x3e857e['flash']('errors'),'role':_0xc1a108,'profile':_0x48a5f3,'suppliers':_0x139d82,'warehouse':_0x4f23af,'master_shop':_0x342410,'language':_0x326ba1,'purchases_data':_0x2e7d2d});}catch(_0x27d347){console[_0x19de7c(0x2e7)](_0x27d347);}});async function get_warehouse_data(_0x53d111,_0x11d596){var _0x588dc4=a0_0x3316c3;try{const _0xe23824=await warehouse_temporary[_0x588dc4(0x2c9)]({'name':_0x53d111,'room':_0x11d596});if(!_0xe23824){const _0xdadcf4=new warehouse_temporary({'name':_0x53d111,'address':_0x53d111,'status':_0x588dc4(0x2b8),'room':_0x11d596,'isStaging':_0x588dc4(0x2df)});return await _0xdadcf4[_0x588dc4(0x23e)](),_0xdadcf4;}else return _0xe23824;}catch(_0x5e59ba){console[_0x588dc4(0x290)](_0x588dc4(0x209),_0x5e59ba);throw _0x5e59ba;}}router[a0_0x3316c3(0x2d3)](a0_0x3316c3(0x1f6),auth,async(_0x17cfba,_0x3090e0)=>{var _0x583a81=a0_0x3316c3;try{const _0x1b996d=_0x17cfba[_0x583a81(0x2a0)]['id'],_0x1a21fa=await purchases_finished[_0x583a81(0x1e7)](_0x1b996d);let _0x3da7f5=[];_0x1a21fa[_0x583a81(0x22f)][_0x583a81(0x245)]((_0x24a8ec,_0x16b0ee)=>{var _0x4bc878=_0x583a81;_0x3da7f5[_0x16b0ee]={},_0x3da7f5[_0x16b0ee][_0x4bc878(0x2c7)]=_0x1a21fa[_0x4bc878(0x2c2)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x312)]=_0x24a8ec[_0x4bc878(0x312)],_0x3da7f5[_0x16b0ee]['product_name']=_0x24a8ec['product_name'],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2ff)]=_0x24a8ec[_0x4bc878(0x2ff)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x248)]=_0x24a8ec[_0x4bc878(0x248)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2c4)]=_0x24a8ec[_0x4bc878(0x2c4)],_0x3da7f5[_0x16b0ee]['secondary_unit']=_0x24a8ec[_0x4bc878(0x201)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2c1)]=_0x24a8ec[_0x4bc878(0x2c1)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2d0)]=_0x24a8ec[_0x4bc878(0x2d0)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x26e)]=_0x24a8ec['primary_code'],_0x3da7f5[_0x16b0ee]['secondary_code']=_0x24a8ec[_0x4bc878(0x2c6)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x27d)]=_0x24a8ec[_0x4bc878(0x27d)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x21d)]=_0x24a8ec[_0x4bc878(0x21d)],_0x3da7f5[_0x16b0ee]['expiry_date']=_0x24a8ec[_0x4bc878(0x247)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x223)]=_0x24a8ec['production_date'],_0x3da7f5[_0x16b0ee][_0x4bc878(0x1e2)]=_0x24a8ec[_0x4bc878(0x1e2)],_0x3da7f5[_0x16b0ee]['product_cat']=_0x24a8ec[_0x4bc878(0x200)],_0x3da7f5[_0x16b0ee]['room_name']=_0x24a8ec[_0x4bc878(0x28f)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2a6)]=_0x24a8ec['invoice'],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2f6)]=_0x24a8ec[_0x4bc878(0x2f6)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x228)]=_0x24a8ec[_0x4bc878(0x228)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x253)]=_0x24a8ec[_0x4bc878(0x253)],_0x3da7f5[_0x16b0ee]['date_recieved']=_0x24a8ec[_0x4bc878(0x239)],_0x3da7f5[_0x16b0ee][_0x4bc878(0x2b1)]=_0x24a8ec['_id'][_0x4bc878(0x30e)]();});for(let _0x540202=0x0;_0x540202<=_0x3da7f5[_0x583a81(0x267)]-0x1;_0x540202++){const _0x4d6310=_0x3da7f5[_0x540202],_0x24db60=new warehouse_temporary(_0x4d6310);await _0x24db60[_0x583a81(0x23e)]();}_0x1a21fa[_0x583a81(0x249)]='true',await _0x1a21fa[_0x583a81(0x23e)](),_0x17cfba['flash'](_0x583a81(0x308),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x3090e0[_0x583a81(0x1fa)]('/all_purchases_finished/process/'+_0x1a21fa[_0x583a81(0x1f8)][_0x583a81(0x30e)]());}catch(_0x842e8a){}}),router['post']('/view/add_purchases_logs',auth,async(_0x368f00,_0x101075)=>{var _0x83e95e=a0_0x3316c3;try{const {invoice:_0x313924,date:_0x53edd2,warehouse_name:_0x25f058,prod_name:_0x2375e9,note:_0x19519f,due_amount:_0x175b37,Room_name:_0x46769f,PO_number:_0x521566,SCRN:_0x524b0f,ReqBy:_0x1593f3,dateofreq:_0x15a1e7,suppliers:_0x3fed76,typeservicesData:_0x3907c4,van:_0x58db01,typevehicle:_0x5b441f,driver:_0x177a34,plate:_0x1ad03b,DRSI:_0x3345d8,TSU:_0x53e695,TFU:_0x50e9c4,JO_number:_0x5876a6,type_of_products:_0x3fc014}=_0x368f00[_0x83e95e(0x2d6)];if(typeof _0x2375e9==_0x83e95e(0x1f9))var _0x1df145=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x233)]],_0x584f09=[_0x368f00['body']['prod_code']],_0x544a71=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x21a)]],_0x29a554=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x2e9)]],_0x31b6ef=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x30a)]],_0x1bf85c=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x265)]],_0x308f6e=[_0x368f00['body']['primary_code']],_0x22e3f7=[_0x368f00['body'][_0x83e95e(0x2c6)]],_0x2b1b34=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x29c)]],_0x381e33=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x21d)]],_0x45d69d=[_0x368f00[_0x83e95e(0x2d6)]['expiry_date']],_0x34774b=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x291)]],_0x17ccf7=[_0x368f00['body']['max_product_unit']],_0x448f99=[_0x368f00['body'][_0x83e95e(0x225)]],_0x3268e9=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x28d)]],_0x8d8049=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x228)]],_0x23f490=[_0x368f00['body']['uuid']],_0x4253ee=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x227)]],_0x47b45f=[_0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x2b4)]];else var _0x1df145=[..._0x368f00['body'][_0x83e95e(0x233)]],_0x584f09=[..._0x368f00[_0x83e95e(0x2d6)]['prod_code']],_0x544a71=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x21a)]],_0x29a554=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x2e9)]],_0x31b6ef=[..._0x368f00['body'][_0x83e95e(0x30a)]],_0x1bf85c=[..._0x368f00[_0x83e95e(0x2d6)]['prod_level']],_0x308f6e=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x26e)]],_0x22e3f7=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x2c6)]],_0x2b1b34=[..._0x368f00[_0x83e95e(0x2d6)]['MaxStocks_data']],_0x381e33=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x21d)]],_0x45d69d=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x247)]],_0x34774b=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x291)]],_0x17ccf7=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x226)]],_0x448f99=[..._0x368f00[_0x83e95e(0x2d6)]['prod_cat']],_0x3268e9=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x28d)]],_0x8d8049=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x228)]],_0x23f490=[..._0x368f00['body'][_0x83e95e(0x2f6)]],_0x4253ee=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x227)]],_0x47b45f=[..._0x368f00[_0x83e95e(0x2d6)][_0x83e95e(0x2b4)]];const _0x8a011b=_0x1df145[_0x83e95e(0x23f)](_0x4502e4=>{return _0x4502e4={'product_name':_0x4502e4};});_0x47b45f[_0x83e95e(0x245)]((_0x46ba9d,_0x50eece)=>{var _0x120929=_0x83e95e;_0x8a011b[_0x50eece][_0x120929(0x1f5)]=_0x46ba9d;}),_0x4253ee[_0x83e95e(0x245)]((_0x4fb252,_0x2cdb05)=>{var _0x2d48e0=_0x83e95e;_0x8a011b[_0x2cdb05][_0x2d48e0(0x253)]=_0x4fb252;}),_0x584f09[_0x83e95e(0x245)]((_0x58a740,_0xf1a915)=>{var _0x184bef=_0x83e95e;_0x8a011b[_0xf1a915][_0x184bef(0x2ff)]=_0x58a740;}),_0x23f490[_0x83e95e(0x245)]((_0x1dff9f,_0x58a7b1)=>{var _0x43be91=_0x83e95e;_0x8a011b[_0x58a7b1][_0x43be91(0x2f6)]=_0x1dff9f;}),_0x544a71[_0x83e95e(0x245)]((_0xc286ae,_0x2945a9)=>{var _0xb000d3=_0x83e95e;_0x8a011b[_0x2945a9][_0xb000d3(0x248)]=Math[_0xb000d3(0x25c)](_0xc286ae);}),_0x29a554[_0x83e95e(0x245)]((_0x3ca8a4,_0x28bde6)=>{var _0x2e9327=_0x83e95e;_0x8a011b[_0x28bde6][_0x2e9327(0x2c4)]=_0x3ca8a4;}),_0x31b6ef[_0x83e95e(0x245)]((_0x160de4,_0x452907)=>{_0x8a011b[_0x452907]['secondary_unit']=_0x160de4;}),_0x1bf85c[_0x83e95e(0x245)]((_0x1afd00,_0x168592)=>{var _0x516b6e=_0x83e95e,_0xbd6c3f=_0x1afd00[_0x516b6e(0x20e)](/[A-Za-z]+/)[0x0],_0x207819=parseInt(_0x1afd00[_0x516b6e(0x20e)](/\d+/)[0x0]);_0x8a011b[_0x168592][_0x516b6e(0x2c1)]=_0xbd6c3f,_0x8a011b[_0x168592]['bay']=_0x207819;}),_0x308f6e[_0x83e95e(0x245)]((_0x139f6b,_0x551089)=>{var _0x5007bd=_0x83e95e;_0x8a011b[_0x551089][_0x5007bd(0x26e)]=_0x139f6b;}),_0x22e3f7[_0x83e95e(0x245)]((_0x2f85ac,_0x2202c5)=>{_0x8a011b[_0x2202c5]['secondary_code']=_0x2f85ac;}),_0x2b1b34[_0x83e95e(0x245)]((_0x38bd50,_0x563902)=>{_0x8a011b[_0x563902]['maxStocks']=_0x38bd50;}),_0x381e33[_0x83e95e(0x245)]((_0x821f58,_0x58e3b8)=>{var _0x2834c5=_0x83e95e;_0x8a011b[_0x58e3b8][_0x2834c5(0x21d)]=_0x821f58;}),_0x45d69d[_0x83e95e(0x245)]((_0x3c4efb,_0x12e96d)=>{_0x8a011b[_0x12e96d]['expiry_date']=_0x3c4efb;}),_0x34774b[_0x83e95e(0x245)]((_0x38b712,_0x349763)=>{var _0x563186=_0x83e95e;_0x8a011b[_0x349763][_0x563186(0x223)]=_0x38b712;}),_0x17ccf7[_0x83e95e(0x245)]((_0x41a97c,_0x49c76a)=>{var _0xae0413=_0x83e95e;_0x8a011b[_0x49c76a][_0xae0413(0x1e2)]=_0x41a97c;}),_0x448f99[_0x83e95e(0x245)]((_0x349886,_0x69f44d)=>{var _0x3d135a=_0x83e95e;_0x8a011b[_0x69f44d][_0x3d135a(0x200)]=_0x349886;}),_0x3268e9[_0x83e95e(0x245)]((_0x5c5fa4,_0x599920)=>{_0x8a011b[_0x599920]['room_name']=_0x5c5fa4;}),_0x8d8049[_0x83e95e(0x245)]((_0x125be7,_0x28faea)=>{_0x8a011b[_0x28faea]['gross_price']=_0x125be7;});const _0x14b735=new purchases_logs();await _0x14b735[_0x83e95e(0x23e)]();for(let _0x4cbfc1=0x0;_0x4cbfc1<=_0x3268e9[_0x83e95e(0x267)]-0x1;_0x4cbfc1++){_0x8a011b[_0x4cbfc1]['invoice']='LOG-INC-'+_0x14b735[_0x83e95e(0x266)][_0x83e95e(0x1d9)]()[_0x83e95e(0x21e)](0x8,'0');}const _0x250d98=_0x8a011b[_0x83e95e(0x26a)](_0x5c7b24=>_0x5c7b24[_0x83e95e(0x248)]!=='0'&&_0x5c7b24[_0x83e95e(0x248)]!==''),_0x22c933=new purchases_finished({'invoice':_0x83e95e(0x216)+_0x14b735['invoice_init'][_0x83e95e(0x1d9)]()[_0x83e95e(0x21e)](0x8,'0'),'suppliers':_0x3fed76,'date':_0x53edd2,'warehouse_name':_0x25f058,'product':_0x250d98,'note':_0x19519f,'due_amount':_0x175b37,'room':_0x46769f,'POnumber':_0x521566,'SCRN':_0x524b0f,'JO_number':_0x5876a6,'ReqBy':_0x1593f3,'dateofreq':_0x15a1e7,'typeservicesData':_0x3907c4,'van':_0x58db01,'typevehicle':_0x5b441f,'driver':_0x177a34,'plate':_0x1ad03b,'DRSI':_0x3345d8,'TSU':_0x53e695,'TFU':_0x50e9c4,'typeOfProducts':_0x3fc014}),_0x3b75e9=await _0x22c933[_0x83e95e(0x23e)](),_0x2f5155=await purchases_finished['findOne']({'_id':_0x3b75e9['_id'][_0x83e95e(0x30e)]()}),_0x2db7a3=_0x2f5155[_0x83e95e(0x22f)]['map'](async _0x55bf73=>{var _0x6648ad=_0x83e95e;try{var _0xd03c46=await warehouse[_0x6648ad(0x2c9)]({'name':_0x25f058,'room':_0x55bf73[_0x6648ad(0x28f)]}),_0x593185=0x0;const _0x384a4c=_0xd03c46[_0x6648ad(0x2b9)][_0x6648ad(0x23f)](_0x2869cf=>{var _0x5b915b=_0x6648ad;console[_0x5b915b(0x2e7)](_0x2869cf[_0x5b915b(0x2bf)]+'=='+_0x55bf73[_0x5b915b(0x2bf)]+'&&'+_0x2869cf[_0x5b915b(0x2d0)]+'=='+_0x55bf73['bay']+'&&'+_0x2869cf[_0x5b915b(0x247)]+'=='+_0x55bf73[_0x5b915b(0x247)]+'&&'+_0x2869cf['production_date']+'=='+_0x55bf73[_0x5b915b(0x223)]+'&&'+_0x2869cf[_0x5b915b(0x21d)]+'=='+_0x55bf73[_0x5b915b(0x21d)]+'&&'+_0x2869cf[_0x5b915b(0x2a6)]+'=='+_0x2f5155['invoice']),_0x2869cf[_0x5b915b(0x2bf)]==_0x55bf73[_0x5b915b(0x2bf)]&&_0x2869cf['bay']==_0x55bf73[_0x5b915b(0x2d0)]&&_0x2869cf['level']==_0x55bf73[_0x5b915b(0x2c1)]&&_0x2869cf[_0x5b915b(0x247)]==_0x55bf73[_0x5b915b(0x247)]&&_0x2869cf[_0x5b915b(0x223)]==_0x55bf73['production_date']&&_0x2869cf[_0x5b915b(0x21d)]==_0x55bf73['batch_code']&&_0x2869cf['invoice']==_0x2f5155['invoice']&&(_0x2869cf[_0x5b915b(0x280)]=Math[_0x5b915b(0x25c)](_0x2869cf[_0x5b915b(0x280)])+Math[_0x5b915b(0x25c)](_0x55bf73[_0x5b915b(0x248)]),_0x593185++);});return _0x593185==0x0&&(_0xd03c46['product_details']=_0xd03c46[_0x6648ad(0x2b9)]['concat']({'product_name':_0x55bf73[_0x6648ad(0x2bf)],'product_stock':Math[_0x6648ad(0x25c)](_0x55bf73[_0x6648ad(0x248)]),'primary_code':_0x55bf73[_0x6648ad(0x26e)],'secondary_code':_0x55bf73[_0x6648ad(0x2c6)],'product_code':_0x55bf73[_0x6648ad(0x2ff)],'bay':_0x55bf73[_0x6648ad(0x2d0)],'level':_0x55bf73[_0x6648ad(0x2c1)],'maxProducts':_0x55bf73[_0x6648ad(0x27d)],'unit':_0x55bf73[_0x6648ad(0x2c4)],'secondary_unit':_0x55bf73[_0x6648ad(0x201)],'expiry_date':_0x55bf73[_0x6648ad(0x247)],'production_date':_0x55bf73[_0x6648ad(0x223)],'maxProducts':_0x55bf73[_0x6648ad(0x27d)],'maxPerUnit':_0x55bf73['maxperunit'],'batch_code':_0x55bf73[_0x6648ad(0x21d)],'product_cat':_0x55bf73[_0x6648ad(0x200)],'invoice':_0x55bf73[_0x6648ad(0x2a6)],'id_incoming':_0x55bf73['_id'],'uuid':_0x55bf73[_0x6648ad(0x2f6)],'gross_price':_0x55bf73[_0x6648ad(0x228)],'sales_category':_0x55bf73[_0x6648ad(0x253)],'type_products':_0x55bf73[_0x6648ad(0x1f5)]})),_0xd03c46;}catch(_0x13e31e){return console[_0x6648ad(0x290)](_0x6648ad(0x1df),_0x13e31e),null;}});Promise[_0x83e95e(0x1ed)](_0x2db7a3)[_0x83e95e(0x218)](async _0x3d78ea=>{var _0xc1978b=_0x83e95e;try{for(const _0x578822 of _0x3d78ea){await warehouse[_0xc1978b(0x255)]({'_id':_0x578822[_0xc1978b(0x1f8)]},{'$addToSet':{'product_details':{'$each':_0x578822[_0xc1978b(0x2b9)]}}});}const _0x3f543f=await master_shop[_0xc1978b(0x22d)](),_0x4dd303=await email_settings['findOne'](),_0x599d1f=await supervisor_settings[_0xc1978b(0x22d)]();var _0x412aec=_0x2f5155[_0xc1978b(0x22f)],_0x1cd023='',_0x46a929;for(_0x46a929 in _0x412aec){var _0x1ff126='FG';_0x2f5155[_0xc1978b(0x2c2)]=='DRY\x20GOODS'&&(_0x1ff126='DG'),_0x1cd023+=_0xc1978b(0x2bc)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x412aec[_0x46a929][_0xc1978b(0x2bf)]+_0xc1978b(0x237)+_0xc1978b(0x2d4)+_0x412aec[_0x46a929][_0xc1978b(0x2ff)]+_0xc1978b(0x237)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x412aec[_0x46a929]['quantity']+'</td>'+_0xc1978b(0x2d4)+_0x412aec[_0x46a929][_0xc1978b(0x2c4)]+_0xc1978b(0x237)+_0xc1978b(0x2d4)+_0x412aec[_0x46a929][_0xc1978b(0x201)]+'</td>'+_0xc1978b(0x2d4)+_0x2f5155['warehouse_name']+_0xc1978b(0x237)+_0xc1978b(0x2d4)+_0x412aec[_0x46a929][_0xc1978b(0x28f)]+'</td>'+_0xc1978b(0x2d4)+_0x1ff126+_0x412aec[_0x46a929][_0xc1978b(0x2d0)]+_0xc1978b(0x237),_0xc1978b(0x1fc);}let _0x3179ec=nodemailer[_0xc1978b(0x2cb)]({'host':_0x4dd303['host'],'port':Number(_0x4dd303['port']),'secure':![],'auth':{'user':_0x4dd303[_0xc1978b(0x27a)],'pass':_0x4dd303[_0xc1978b(0x2f3)]}}),_0x37eb7d={'from':_0x4dd303[_0xc1978b(0x27a)],'to':_0x599d1f[0x0]['FGSEmail'],'subject':_0xc1978b(0x246),'attachments':[{'filename':'Logo.png','path':__dirname+_0xc1978b(0x1dd)+'/upload/'+_0x3f543f[0x0]['image'],'cid':'logo'}],'html':_0xc1978b(0x1e0)+'<html><head><title></title>'+'</head><body>'+_0xc1978b(0x259)+_0xc1978b(0x26d)+_0xc1978b(0x259)+_0xc1978b(0x309)+_0xc1978b(0x1fe)+_0xc1978b(0x259)+_0xc1978b(0x20d)+_0x3f543f[0x0][_0xc1978b(0x2d8)]+_0xc1978b(0x277)+_0xc1978b(0x1fe)+_0xc1978b(0x1fe)+_0xc1978b(0x25d)+_0xc1978b(0x259)+_0xc1978b(0x260)+_0xc1978b(0x1fd)+_0x2f5155['invoice']+'\x20'+_0xc1978b(0x306)+_0xc1978b(0x252)+_0x2f5155[_0xc1978b(0x279)]+'\x20'+_0xc1978b(0x2ab)+_0xc1978b(0x219)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0xc1978b(0x282)+_0xc1978b(0x2af)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0xc1978b(0x296)+_0xc1978b(0x2d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xc1978b(0x1fc)+_0xc1978b(0x1f7)+_0xc1978b(0x287)+'\x20'+_0x1cd023+'\x20'+_0xc1978b(0x236)+_0xc1978b(0x2fe)+_0xc1978b(0x259)+_0xc1978b(0x298)+_0xc1978b(0x24d)+_0x3f543f[0x0][_0xc1978b(0x2d8)]+_0xc1978b(0x219)+_0xc1978b(0x1fe)+_0xc1978b(0x1fe)+_0xc1978b(0x315)};_0x3179ec[_0xc1978b(0x206)](_0x37eb7d,function(_0x8ef80a,_0x3250ab){var _0x268312=_0xc1978b;_0x8ef80a?(console[_0x268312(0x2e7)](_0x8ef80a),console[_0x268312(0x2e7)](_0x268312(0x310))):console[_0x268312(0x2e7)](_0x268312(0x1da));});}catch(_0x25c3b0){console[_0xc1978b(0x290)](_0x25c3b0),_0x101075[_0xc1978b(0x207)](0x1f4)[_0xc1978b(0x2fc)]({'error':_0xc1978b(0x299),'message':_0x25c3b0[_0xc1978b(0x29a)]});}})[_0x83e95e(0x307)](_0x2db9e=>{var _0x32611e=_0x83e95e;console[_0x32611e(0x290)](_0x2db9e);}),_0x368f00[_0x83e95e(0x211)]('success',_0x83e95e(0x2e6)),_0x101075[_0x83e95e(0x1fa)](_0x83e95e(0x2a8)+_0x2f5155[_0x83e95e(0x1f8)][_0x83e95e(0x30e)]());}catch(_0xc798ae){console[_0x83e95e(0x2e7)](_0xc798ae);}}),router[a0_0x3316c3(0x20c)]('/preview/:id',auth,async(_0x772f97,_0x97c68b)=>{var _0xc5deff=a0_0x3316c3;try{const {username:_0x4c5fda,email:_0xe763fa,role:_0x35a4cc}=_0x772f97['user'],_0x5dc924=_0x772f97['user'],_0x1976d8=await profile[_0xc5deff(0x2c9)]({'email':_0x5dc924[_0xc5deff(0x27a)]}),_0x362c97=await master_shop[_0xc5deff(0x22d)](),_0x264e95=_0x772f97['params']['id'],_0x2d520c=await purchases_finished[_0xc5deff(0x1e7)](_0x264e95),_0x564ef5=await suppliers[_0xc5deff(0x22d)]({});let _0x45ccc8;if(_0x5dc924[_0xc5deff(0x2f2)]==_0xc5deff(0x281)){const _0xc7da2e=await staff['findOne']({'email':_0x5dc924[_0xc5deff(0x27a)]});_0x45ccc8=await warehouse[_0xc5deff(0x22d)]({'status':_0xc5deff(0x2b8),'name':_0xc7da2e[_0xc5deff(0x2c7)],'warehouse_category':_0xc5deff(0x1d8)});}else _0x45ccc8=await warehouse[_0xc5deff(0x292)]([{'$match':{'status':_0xc5deff(0x2b8),'warehouse_category':_0xc5deff(0x1d8)}},{'$group':{'_id':_0xc5deff(0x23a),'name':{'$first':_0xc5deff(0x23a)}}}]);const _0x11653d=await product[_0xc5deff(0x22d)]({}),_0x1b85c3=BayBinSelected(_0x2d520c[_0xc5deff(0x2c2)],_0x2d520c[_0xc5deff(0x1ec)]);let _0x84efc9=new Date(_0x2d520c[_0xc5deff(0x247)]),_0x15851=('0'+_0x84efc9[_0xc5deff(0x221)]())[_0xc5deff(0x232)](-0x2),_0x2bd0ab=('0'+(_0x84efc9[_0xc5deff(0x275)]()+0x1))[_0xc5deff(0x232)](-0x2),_0x320236=_0x84efc9[_0xc5deff(0x1db)](),_0x15b162=_0x320236+'-'+_0x2bd0ab+'-'+_0x15851;if(_0x362c97[0x0][_0xc5deff(0x2b2)]==_0xc5deff(0x28e)){var _0xecd9ee=users[_0xc5deff(0x27f)];console[_0xc5deff(0x2e7)](_0xecd9ee);}else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]==_0xc5deff(0x24c))var _0xecd9ee=users[_0xc5deff(0x24c)];else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]==_0xc5deff(0x240))var _0xecd9ee=users[_0xc5deff(0x240)];else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]==_0xc5deff(0x22e))var _0xecd9ee=users[_0xc5deff(0x22e)];else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]=='French')var _0xecd9ee=users[_0xc5deff(0x2a2)];else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]==_0xc5deff(0x258))var _0xecd9ee=users['Portuguese'];else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]==_0xc5deff(0x1f3))var _0xecd9ee=users['Chinese'];else{if(_0x362c97[0x0][_0xc5deff(0x2b2)]=='Arabic\x20(ae)')var _0xecd9ee=users[_0xc5deff(0x284)];}}}}}}}_0x97c68b[_0xc5deff(0x29b)](_0xc5deff(0x2ea),{'success':_0x772f97['flash']('success'),'errors':_0x772f97['flash']('errors'),'role':_0x5dc924,'profile':_0x1976d8,'purchases':_0x2d520c,'suppliers':_0x564ef5,'warehouse':_0x45ccc8,'product':_0x11653d,'master_shop':_0x362c97,'language':_0xecd9ee,'ed_fullDate':_0x15b162,'dataSelected':_0x1b85c3});}catch(_0x5ee557){console['log'](_0x5ee557);}}),router['get']('/view/:id',auth,async(_0x333cc0,_0x4150d7)=>{var _0x2fc5ac=a0_0x3316c3;try{const {username:_0x1814fb,email:_0x4bc3d2,role:_0x46b246}=_0x333cc0[_0x2fc5ac(0x2ec)],_0xdca561=_0x333cc0[_0x2fc5ac(0x2ec)],_0x2b429e=await profile[_0x2fc5ac(0x2c9)]({'email':_0xdca561[_0x2fc5ac(0x27a)]}),_0x5812c1=await master_shop[_0x2fc5ac(0x22d)](),_0x70412d=_0x333cc0['params']['id'],_0x1d9fa1=await purchases_finished[_0x2fc5ac(0x1e7)](_0x70412d),_0x459647=await suppliers['find']({});let _0xa01c57;if(_0xdca561['role']==_0x2fc5ac(0x281)){const _0xb48126=await staff[_0x2fc5ac(0x2c9)]({'email':_0xdca561[_0x2fc5ac(0x27a)]});_0xa01c57=await warehouse[_0x2fc5ac(0x22d)]({'status':_0x2fc5ac(0x2b8),'name':_0xb48126[_0x2fc5ac(0x2c7)],'warehouse_category':'Finished\x20Goods'});}else _0xa01c57=await warehouse[_0x2fc5ac(0x292)]([{'$match':{'status':'Enabled','warehouse_category':_0x2fc5ac(0x1d8)}},{'$group':{'_id':'$name','name':{'$first':_0x2fc5ac(0x23a)}}}]);const _0x24fcec=await product[_0x2fc5ac(0x22d)]({}),_0x3b221b=BayBinSelected(_0x1d9fa1[_0x2fc5ac(0x2c2)],_0x1d9fa1[_0x2fc5ac(0x1ec)]);let _0x16b804=new Date(_0x1d9fa1[_0x2fc5ac(0x247)]),_0x53cc83=('0'+_0x16b804[_0x2fc5ac(0x221)]())['slice'](-0x2),_0xffd055=('0'+(_0x16b804['getMonth']()+0x1))[_0x2fc5ac(0x232)](-0x2),_0x11098b=_0x16b804['getFullYear'](),_0x1bb5cd=_0x11098b+'-'+_0xffd055+'-'+_0x53cc83;if(_0x5812c1[0x0][_0x2fc5ac(0x2b2)]==_0x2fc5ac(0x28e)){var _0x369b69=users[_0x2fc5ac(0x27f)];console[_0x2fc5ac(0x2e7)](_0x369b69);}else{if(_0x5812c1[0x0][_0x2fc5ac(0x2b2)]=='Hindi')var _0x369b69=users[_0x2fc5ac(0x24c)];else{if(_0x5812c1[0x0]['language']=='German')var _0x369b69=users['German'];else{if(_0x5812c1[0x0]['language']==_0x2fc5ac(0x22e))var _0x369b69=users[_0x2fc5ac(0x22e)];else{if(_0x5812c1[0x0][_0x2fc5ac(0x2b2)]=='French')var _0x369b69=users['French'];else{if(_0x5812c1[0x0][_0x2fc5ac(0x2b2)]==_0x2fc5ac(0x258))var _0x369b69=users[_0x2fc5ac(0x257)];else{if(_0x5812c1[0x0][_0x2fc5ac(0x2b2)]==_0x2fc5ac(0x1f3))var _0x369b69=users[_0x2fc5ac(0x1f3)];else{if(_0x5812c1[0x0][_0x2fc5ac(0x2b2)]=='Arabic\x20(ae)')var _0x369b69=users[_0x2fc5ac(0x284)];}}}}}}}_0x4150d7[_0x2fc5ac(0x29b)](_0x2fc5ac(0x1dc),{'success':_0x333cc0[_0x2fc5ac(0x211)](_0x2fc5ac(0x308)),'errors':_0x333cc0['flash']('errors'),'role':_0xdca561,'profile':_0x2b429e,'purchases':_0x1d9fa1,'suppliers':_0x459647,'warehouse':_0xa01c57,'product':_0x24fcec,'master_shop':_0x5812c1,'language':_0x369b69,'ed_fullDate':_0x1bb5cd,'dataSelected':_0x3b221b});}catch(_0x81372d){console[_0x2fc5ac(0x2e7)](_0x81372d);}}),router[a0_0x3316c3(0x2d3)](a0_0x3316c3(0x2b7),auth,async(_0x7a2cbf,_0x27f26e)=>{var _0xd6bd23=a0_0x3316c3;try{const _0x41f252=_0x7a2cbf[_0xd6bd23(0x2a0)]['id'],_0x4d11ef=await purchases_finished[_0xd6bd23(0x2c9)]({'_id':_0x7a2cbf[_0xd6bd23(0x2a0)]['id']}),_0x3c8037=await warehouse[_0xd6bd23(0x2c9)]({'name':_0x4d11ef['warehouse_name'],'room':_0x4d11ef[_0xd6bd23(0x1ec)]});_0x4d11ef[_0xd6bd23(0x22f)][_0xd6bd23(0x245)](_0x5c71bf=>{var _0x2e84ce=_0xd6bd23;const _0x158aee=_0x3c8037['product_details'][_0x2e84ce(0x23f)](_0x394206=>{var _0x3d88a0=_0x2e84ce;_0x394206[_0x3d88a0(0x2bf)]==_0x5c71bf[_0x3d88a0(0x2bf)]&&_0x394206[_0x3d88a0(0x2d0)]==_0x5c71bf[_0x3d88a0(0x2d0)]&&(_0x394206[_0x3d88a0(0x280)]=parseInt(_0x394206[_0x3d88a0(0x280)])-parseInt(_0x5c71bf[_0x3d88a0(0x248)]));});}),await _0x3c8037[_0xd6bd23(0x23e)]();const {invoice:_0x2ba1c3,suppliers:_0x2b28ea,date:_0x3fcaf4,warehouse_name:_0x25009a,prod_name:_0x33ec60,prod_code:_0x165fca,prod_qty:_0x76a7f3,prod_unit:_0x532147,prod_secondunit:_0x273db0,prod_level:_0x10d35c,prod_isle:_0x12b572,prod_pallet:_0x28bcd6,note:_0xe1d885,expiry_date:_0x33759e,batch_code:_0x451822,paid_amount:_0x3bb625,due_amount:_0x1b1673,Room_name:_0x246880,primary_code:_0x15a354,secondary_code:_0x4175ca,PO_number:_0x365da1,JO_number:_0xd24db7}=_0x7a2cbf[_0xd6bd23(0x2d6)];if(typeof _0x33ec60==_0xd6bd23(0x1f9))var _0x10fa3c=[_0x7a2cbf[_0xd6bd23(0x2d6)]['prod_name']],_0x3d87e3=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x1f2)]],_0x1f1a09=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x1fb)]],_0x46786a=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x2e4)]],_0x2112bb=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x30a)]],_0x9198cc=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x265)]],_0x4812b3=[_0x7a2cbf['body'][_0xd6bd23(0x26e)]],_0x58c217=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x2c6)]],_0x2e5bea=[_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x29c)]],_0x7571d0=[_0x7a2cbf[_0xd6bd23(0x2d6)]['batch_code']],_0x5344fd=[_0x7a2cbf['body'][_0xd6bd23(0x247)]];else var _0x10fa3c=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x233)]],_0x3d87e3=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x1f2)]],_0x1f1a09=[..._0x7a2cbf['body'][_0xd6bd23(0x1fb)]],_0x46786a=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x2e4)]],_0x2112bb=[..._0x7a2cbf[_0xd6bd23(0x2d6)]['prod_secondunit']],_0x9198cc=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x265)]],_0x4812b3=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x26e)]],_0x58c217=[..._0x7a2cbf[_0xd6bd23(0x2d6)]['secondary_code']],_0x2e5bea=[..._0x7a2cbf['body'][_0xd6bd23(0x29c)]],_0x7571d0=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x21d)]],_0x5344fd=[..._0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x247)]];const _0x42afba=_0x10fa3c['map'](_0x3c5da5=>{return _0x3c5da5={'product_name':_0x3c5da5};});_0x3d87e3[_0xd6bd23(0x245)]((_0x39bfd1,_0x28d20)=>{var _0x4f5e91=_0xd6bd23;_0x42afba[_0x28d20][_0x4f5e91(0x2ff)]=_0x39bfd1;}),_0x1f1a09[_0xd6bd23(0x245)]((_0x474cb4,_0x9bf1f8)=>{var _0x24cffa=_0xd6bd23;_0x42afba[_0x9bf1f8][_0x24cffa(0x248)]=_0x474cb4;}),_0x46786a[_0xd6bd23(0x245)]((_0x140e48,_0x448bea)=>{var _0x33bdd8=_0xd6bd23;_0x42afba[_0x448bea][_0x33bdd8(0x2c4)]=_0x140e48;}),_0x2112bb[_0xd6bd23(0x245)]((_0x19d85a,_0x99f11f)=>{_0x42afba[_0x99f11f]['secondary_unit']=_0x19d85a;}),_0x9198cc[_0xd6bd23(0x245)]((_0x5c1f38,_0x1f2494)=>{var _0x30b00a=_0xd6bd23;_0x42afba[_0x1f2494][_0x30b00a(0x2d0)]=_0x5c1f38;}),_0x4812b3['forEach']((_0x8e60d8,_0x499859)=>{_0x42afba[_0x499859]['primary_code']=_0x8e60d8;}),_0x58c217['forEach']((_0x20132a,_0x574b61)=>{_0x42afba[_0x574b61]['secondary_code']=_0x20132a;}),_0x2e5bea['forEach']((_0x1857bc,_0x370123)=>{_0x42afba[_0x370123]['maxStocks']=_0x1857bc;}),_0x7571d0[_0xd6bd23(0x245)]((_0x1248ae,_0x13a469)=>{_0x42afba[_0x13a469]['batch_code']=_0x1248ae;}),_0x5344fd['forEach']((_0x2b6a49,_0x225bce)=>{var _0x151bce=_0xd6bd23;_0x42afba[_0x225bce][_0x151bce(0x247)]=_0x2b6a49;});const _0x104e9=_0x42afba['filter'](_0x3d4f0b=>_0x3d4f0b[_0xd6bd23(0x248)]!=='0'&&_0x3d4f0b[_0xd6bd23(0x248)]!=='');_0x4d11ef[_0xd6bd23(0x2a6)]=_0x2ba1c3,_0x4d11ef[_0xd6bd23(0x1e6)]=_0x2b28ea,_0x4d11ef[_0xd6bd23(0x279)]=_0x3fcaf4,_0x4d11ef[_0xd6bd23(0x2c2)]=_0x25009a,_0x4d11ef['product']=_0x104e9,_0x4d11ef[_0xd6bd23(0x1e9)]=_0xe1d885,_0x4d11ef[_0xd6bd23(0x2ba)]=_0x3bb625,_0x4d11ef[_0xd6bd23(0x30c)]=_0x1b1673,_0x4d11ef[_0xd6bd23(0x1ec)]=_0x246880,_0x4d11ef[_0xd6bd23(0x2ce)]=_0x365da1,_0x4d11ef[_0xd6bd23(0x254)]=_0xd24db7;const _0x5da544=await _0x4d11ef[_0xd6bd23(0x23e)](),_0x4ae0f3=await warehouse[_0xd6bd23(0x2c9)]({'name':_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x2c2)],'room':_0x7a2cbf[_0xd6bd23(0x2d6)]['Room_name']});_0x4d11ef['product']['forEach'](_0x39db=>{var _0x4f6df2=_0xd6bd23,_0x4cbc98=0x0;const _0x5be002=_0x4ae0f3['product_details'][_0x4f6df2(0x23f)](_0x5ce630=>{var _0x13051c=_0x4f6df2;_0x5ce630['product_name']==_0x39db['product_name']&&_0x5ce630[_0x13051c(0x2d0)]==_0x39db[_0x13051c(0x2d0)]&&(_0x5ce630[_0x13051c(0x280)]=parseInt(_0x5ce630[_0x13051c(0x280)])+parseInt(_0x39db[_0x13051c(0x248)]),_0x4cbc98++);});_0x4cbc98=='0'&&(_0x4ae0f3[_0x4f6df2(0x2b9)]=_0x4ae0f3[_0x4f6df2(0x2b9)]['concat']({'product_name':_0x39db[_0x4f6df2(0x2bf)],'product_stock':_0x39db[_0x4f6df2(0x248)],'primary_code':_0x39db[_0x4f6df2(0x26e)],'secondary_code':_0x39db[_0x4f6df2(0x2c6)],'product_code':_0x39db[_0x4f6df2(0x2ff)],'bay':_0x39db[_0x4f6df2(0x2d0)],'maxProducts':_0x39db[_0x4f6df2(0x27d)],'unit':_0x39db['standard_unit'],'secondary_unit':_0x39db[_0x4f6df2(0x201)],'expiry_date':_0x39db[_0x4f6df2(0x247)]}));}),await _0x4ae0f3['save']();const _0x151262=await s_payment_data[_0xd6bd23(0x2c9)]({'invoice':_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x2a6)]});if(_0x151262===null){}else console['log']('suppliers',_0x151262,_0x7a2cbf['body'][_0xd6bd23(0x2a6)]),_0x151262[_0xd6bd23(0x1e6)]=_0x7a2cbf[_0xd6bd23(0x2d6)][_0xd6bd23(0x1e6)],await _0x151262['save']();_0x7a2cbf[_0xd6bd23(0x211)](_0xd6bd23(0x308),_0xd6bd23(0x203)),_0x27f26e[_0xd6bd23(0x1fa)](_0xd6bd23(0x2ae));}catch(_0x12e386){console[_0xd6bd23(0x2e7)](_0x12e386);}}),router[a0_0x3316c3(0x2d3)](a0_0x3316c3(0x278),auth,async(_0x553513,_0x24f40c)=>{var _0x1a6c68=a0_0x3316c3;try{const _0x4aeea4=_0x553513[_0x1a6c68(0x2a0)]['id'],{invoice:_0x416332,suppliers:_0x21618a,payable:_0x295097,due_amount:_0x33bcd6}=_0x553513['body'],_0x22ee9f=await purchases[_0x1a6c68(0x1e7)](_0x4aeea4);var _0x30250b=_0x295097-_0x33bcd6;_0x22ee9f[_0x1a6c68(0x2ba)]=parseFloat(_0x22ee9f[_0x1a6c68(0x2ba)])+parseFloat(_0x33bcd6),_0x22ee9f[_0x1a6c68(0x30c)]=_0x30250b;const _0x482415=await _0x22ee9f[_0x1a6c68(0x23e)]();console[_0x1a6c68(0x2e7)](_0x482415);const _0x599e53=await s_payment_data['findOne']({'invoice':_0x416332});_0x599e53[_0x1a6c68(0x235)]=_0x30250b,await _0x599e53[_0x1a6c68(0x23e)]();let _0x3beb86=new Date(),_0x1543cd=('0'+_0x3beb86['getDate']())[_0x1a6c68(0x232)](-0x2),_0x2b7274=('0'+(_0x3beb86[_0x1a6c68(0x275)]()+0x1))['slice'](-0x2),_0x18ca0d=_0x3beb86['getFullYear'](),_0x557df8=_0x18ca0d+'-'+_0x2b7274+'-'+_0x1543cd;const _0x6e4cd4=new suppliers_payment({'invoice':_0x416332,'date':_0x18ca0d+'-'+_0x2b7274+'-'+_0x1543cd,'suppliers':_0x21618a,'reason':_0x1a6c68(0x2da),'amount':_0x33bcd6}),_0xca22d0=await _0x6e4cd4[_0x1a6c68(0x23e)]();_0x553513['flash'](_0x1a6c68(0x308),_0x1a6c68(0x297)),_0x24f40c[_0x1a6c68(0x1fa)](_0x1a6c68(0x2e8));}catch(_0x26f9a5){console['log'](_0x26f9a5);}}),router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x2c8),auth,async(_0x24e8e9,_0x218fc5)=>{var _0x3162ca=a0_0x3316c3;try{const {username:_0x140a16,email:_0x5bcd03,role:_0x305d5a}=_0x24e8e9[_0x3162ca(0x2ec)],_0x55a168=_0x24e8e9[_0x3162ca(0x2ec)],_0x209925=await profile[_0x3162ca(0x2c9)]({'email':_0x55a168[_0x3162ca(0x27a)]}),_0x5f19b4=await master_shop[_0x3162ca(0x22d)]();console[_0x3162ca(0x2e7)](_0x3162ca(0x20a),_0x5f19b4);const _0xb71293=_0x24e8e9[_0x3162ca(0x2a0)]['id'],_0x5b8e20=await purchases[_0x3162ca(0x1e7)](_0xb71293);console[_0x3162ca(0x2e7)](_0x5b8e20);const _0x13aa2a=await suppliers[_0x3162ca(0x2c9)]({'name':_0x5b8e20[_0x3162ca(0x1e6)]});console[_0x3162ca(0x2e7)](_0x13aa2a);if(_0x5f19b4[0x0][_0x3162ca(0x2b2)]==_0x3162ca(0x28e)){var _0x92d770=users['English'];console['log'](_0x92d770);}else{if(_0x5f19b4[0x0][_0x3162ca(0x2b2)]=='Hindi')var _0x92d770=users[_0x3162ca(0x24c)];else{if(_0x5f19b4[0x0]['language']==_0x3162ca(0x240))var _0x92d770=users[_0x3162ca(0x240)];else{if(_0x5f19b4[0x0]['language']==_0x3162ca(0x22e))var _0x92d770=users['Spanish'];else{if(_0x5f19b4[0x0][_0x3162ca(0x2b2)]==_0x3162ca(0x2a2))var _0x92d770=users[_0x3162ca(0x2a2)];else{if(_0x5f19b4[0x0][_0x3162ca(0x2b2)]==_0x3162ca(0x258))var _0x92d770=users[_0x3162ca(0x257)];else{if(_0x5f19b4[0x0][_0x3162ca(0x2b2)]=='Chinese')var _0x92d770=users[_0x3162ca(0x1f3)];else{if(_0x5f19b4[0x0]['language']==_0x3162ca(0x301))var _0x92d770=users['Arabic'];}}}}}}}_0x218fc5[_0x3162ca(0x29b)](_0x3162ca(0x2a1),{'success':_0x24e8e9[_0x3162ca(0x211)](_0x3162ca(0x308)),'errors':_0x24e8e9['flash'](_0x3162ca(0x23b)),'role':_0x55a168,'profile':_0x209925,'master_shop':_0x5f19b4,'supplier':_0x13aa2a,'purchase':_0x5b8e20,'language':_0x92d770});}catch(_0x5aaab9){console[_0x3162ca(0x2e7)](_0x5aaab9);}}),router['get'](a0_0x3316c3(0x2db),auth,async(_0x363b74,_0x32d8a0)=>{var _0x3d9840=a0_0x3316c3;try{const {username:_0x4ceb1d,email:_0x3ce942,role:_0x2dc5c3}=_0x363b74['user'],_0x3e4918=_0x363b74['user'],_0x3c75da=await profile[_0x3d9840(0x2c9)]({'email':_0x3e4918[_0x3d9840(0x27a)]}),_0x32e16e=await master_shop[_0x3d9840(0x22d)]();console[_0x3d9840(0x2e7)](_0x3d9840(0x20a),_0x32e16e);const _0x1fae52=_0x363b74[_0x3d9840(0x2a0)]['id'];console[_0x3d9840(0x2e7)](_0x1fae52);const _0x5827a7=await purchases_finished[_0x3d9840(0x1e7)](_0x1fae52);console[_0x3d9840(0x2e7)](_0x3d9840(0x210),_0x5827a7);const _0x474b87=await product[_0x3d9840(0x22d)]({}),_0x5d61de=await warehouse['aggregate']([{'$match':{'name':_0x5827a7[_0x3d9840(0x2c2)],'room':_0x5827a7[_0x3d9840(0x1ec)]}},{'$unwind':_0x3d9840(0x1e4)},{'$group':{'_id':_0x3d9840(0x2de),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3d9840(0x305)},'bay':{'$first':_0x3d9840(0x2c5)},'bin':{'$first':_0x3d9840(0x30d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3d9840(0x2d2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3d9840(0x25a)}}}]);console['log'](_0x3d9840(0x2dd),_0x5d61de);let _0x4b71de;if(_0x3e4918[_0x3d9840(0x2f2)]==_0x3d9840(0x281)){const _0x1c6440=await staff['findOne']({'email':_0x3e4918[_0x3d9840(0x27a)]});_0x4b71de=await warehouse['find']({'status':_0x3d9840(0x2b8),'name':_0x1c6440['warehouse'],'warehouse_category':_0x3d9840(0x1d8),'name':'Return\x20Goods'});}else _0x4b71de=await warehouse['aggregate']([{'$match':{'status':_0x3d9840(0x2b8),'warehouse_category':_0x3d9840(0x1d8),'name':_0x3d9840(0x241)}},{'$group':{'_id':_0x3d9840(0x23a),'name':{'$first':_0x3d9840(0x23a)}}}]);if(_0x32e16e[0x0]['language']=='English\x20(US)'){var _0x3edda9=users[_0x3d9840(0x27f)];console[_0x3d9840(0x2e7)](_0x3edda9);}else{if(_0x32e16e[0x0][_0x3d9840(0x2b2)]=='Hindi')var _0x3edda9=users[_0x3d9840(0x24c)];else{if(_0x32e16e[0x0]['language']==_0x3d9840(0x240))var _0x3edda9=users[_0x3d9840(0x240)];else{if(_0x32e16e[0x0][_0x3d9840(0x2b2)]=='Spanish')var _0x3edda9=users[_0x3d9840(0x22e)];else{if(_0x32e16e[0x0][_0x3d9840(0x2b2)]=='French')var _0x3edda9=users[_0x3d9840(0x2a2)];else{if(_0x32e16e[0x0][_0x3d9840(0x2b2)]==_0x3d9840(0x258))var _0x3edda9=users[_0x3d9840(0x257)];else{if(_0x32e16e[0x0]['language']==_0x3d9840(0x1f3))var _0x3edda9=users[_0x3d9840(0x1f3)];else{if(_0x32e16e[0x0]['language']==_0x3d9840(0x301))var _0x3edda9=users['Arabic'];}}}}}}}_0x32d8a0[_0x3d9840(0x29b)](_0x3d9840(0x1e8),{'success':_0x363b74['flash'](_0x3d9840(0x308)),'errors':_0x363b74['flash'](_0x3d9840(0x23b)),'role':_0x3e4918,'profile':_0x3c75da,'user':_0x5827a7,'stock':_0x5d61de,'master_shop':_0x32e16e,'product':_0x474b87,'language':_0x3edda9,'warehouse':_0x4b71de});}catch(_0x178ec4){console[_0x3d9840(0x2e7)](_0x178ec4);}}),router[a0_0x3316c3(0x2d3)](a0_0x3316c3(0x2db),auth,async(_0x1158fe,_0x4c9c3)=>{var _0x4646bf=a0_0x3316c3;try{const {invoice:_0x1735fb,date:_0x384a7f,warehouse_name:_0x37f80c,Room_name:_0x1d7607,product_name:_0x347a1c,purchase_quantity:_0x40ccab,stocks:_0x7e00d0,return_qty:_0x548d45,note:_0x39ff5d,level:_0x51756d,isle:_0x40fefa,pallet:_0x52270a,to_warehouse_name:_0x529c3c,to_Room_name:_0x33cf5a}=_0x1158fe[_0x4646bf(0x2d6)],_0x5b8b50=await purchases_finished[_0x4646bf(0x2c9)]({'_id':_0x1158fe['params']['id']}),_0x207a1b=await warehouse[_0x4646bf(0x2c9)]({'name':_0x37f80c,'room':_0x1d7607,'warehouse_category':_0x4646bf(0x1d8)});if(typeof _0x347a1c==_0x4646bf(0x1f9))var _0x426e89=[_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x2bf)]],_0x19d6e3=[_0x1158fe['body'][_0x4646bf(0x2ed)]],_0x329947=[_0x1158fe[_0x4646bf(0x2d6)]['stocks']],_0x3fc4bc=[_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x2f9)]],_0xa8a00a=[_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x2c1)]],_0x210b8f=[_0x1158fe['body'][_0x4646bf(0x2fb)]],_0x47a776=[_0x1158fe['body'][_0x4646bf(0x2c0)]],_0x329c0f=[_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x1d6)]];else var _0x426e89=[..._0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x2bf)]],_0x19d6e3=[..._0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x2ed)]],_0x329947=[..._0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x303)]],_0x3fc4bc=[..._0x1158fe[_0x4646bf(0x2d6)]['return_qty']],_0xa8a00a=[..._0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x2c1)]],_0x210b8f=[..._0x1158fe['body']['product_code_hide']],_0x47a776=[..._0x1158fe['body'][_0x4646bf(0x2c0)]],_0x329c0f=[..._0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x1d6)]];const _0x4170e5=_0x426e89[_0x4646bf(0x23f)](_0xcc67b7=>{return _0xcc67b7={'product_name':_0xcc67b7};});_0x19d6e3[_0x4646bf(0x245)]((_0x400836,_0x466a01)=>{var _0x5d244a=_0x4646bf;_0x4170e5[_0x466a01][_0x5d244a(0x2ed)]=_0x400836;}),_0x329947[_0x4646bf(0x245)]((_0x4d17cd,_0x2a6927)=>{_0x4170e5[_0x2a6927]['stock_quantity']=_0x4d17cd;}),_0x3fc4bc['forEach']((_0x277d39,_0x240661)=>{var _0x3bcc2f=_0x4646bf;_0x4170e5[_0x240661][_0x3bcc2f(0x2f9)]=_0x277d39;}),_0xa8a00a[_0x4646bf(0x245)]((_0x58ca93,_0x1d530a)=>{_0x4170e5[_0x1d530a]['bay']=_0x58ca93;}),_0x210b8f['forEach']((_0x4e7a01,_0x54f6ca)=>{var _0x364b0f=_0x4646bf;_0x4170e5[_0x54f6ca][_0x364b0f(0x2ff)]=_0x4e7a01;}),_0x47a776[_0x4646bf(0x245)]((_0x425e73,_0x38df86)=>{var _0x2d7c08=_0x4646bf;_0x4170e5[_0x38df86][_0x2d7c08(0x26e)]=_0x425e73;}),_0x329c0f[_0x4646bf(0x245)]((_0x6ccc97,_0x5ba122)=>{_0x4170e5[_0x5ba122]['secondary_code']=_0x6ccc97;}),_0x4170e5[_0x4646bf(0x245)](_0x5b79f2=>{var _0x67f5de=_0x4646bf;console[_0x67f5de(0x2e7)](_0x5b79f2);const _0x4aee61=_0x207a1b['product_details'][_0x67f5de(0x23f)](_0x3c60ca=>{var _0x77f262=_0x67f5de;_0x3c60ca['product_name']==_0x5b79f2[_0x77f262(0x2bf)]&&_0x3c60ca[_0x77f262(0x2d0)]==_0x5b79f2['bay']&&(console['log'](parseInt(_0x3c60ca[_0x77f262(0x280)])+_0x77f262(0x250)+parseInt(_0x5b79f2[_0x77f262(0x2f9)])),_0x3c60ca['product_stock']=parseInt(_0x3c60ca[_0x77f262(0x280)])-parseInt(_0x5b79f2['return_qty']));});}),await _0x207a1b['save']();var _0x4d29f9=0x0;_0x4170e5['forEach'](_0x572a3d=>{var _0x59a502=_0x4646bf;(parseInt(_0x572a3d['purchase_quantity'])<parseInt(_0x572a3d[_0x59a502(0x2f9)])||parseInt(_0x572a3d['stock_quantity'])<parseInt(_0x572a3d['return_qty']))&&_0x4d29f9++;});if(_0x4d29f9!=0x0)return _0x1158fe['flash'](_0x4646bf(0x23b),_0x4646bf(0x202)),_0x4c9c3[_0x4646bf(0x1fa)](_0x4646bf(0x25b));const _0x1153c2=new purchases_return_finished({'invoice':_0x1735fb,'suppliers':_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x1e6)],'date':_0x384a7f,'warehouse_name':_0x37f80c,'return_product':_0x4170e5,'note':_0x39ff5d,'room':_0x1d7607,'to_warehouse_name':_0x529c3c,'to_room':_0x33cf5a}),_0x48f599=await _0x1153c2['save'](),_0x4c665d=await purchases_return_finished['findOne']({'invoice':_0x1735fb}),_0x330e74=await warehouse[_0x4646bf(0x2c9)]({'name':_0x529c3c,'room':_0x33cf5a,'warehouse_category':_0x4646bf(0x1d8)});_0x4c665d[_0x4646bf(0x220)][_0x4646bf(0x245)](_0x5e7bb2=>{var _0x1c3839=_0x4646bf,_0x5ce055=0x0;const _0x3debe=_0x330e74[_0x1c3839(0x2b9)][_0x1c3839(0x23f)](_0x53cde1=>{var _0x50bfb2=_0x1c3839;console[_0x50bfb2(0x2e7)](_0x53cde1['product_name']+'=='+_0x5e7bb2[_0x50bfb2(0x2bf)]+'&&'+_0x53cde1[_0x50bfb2(0x2d0)]+'=='+_0x5e7bb2[_0x50bfb2(0x2d0)]),_0x53cde1[_0x50bfb2(0x2bf)]==_0x5e7bb2['product_name']&&_0x53cde1[_0x50bfb2(0x2d0)]==_0x5e7bb2[_0x50bfb2(0x2d0)]&&(_0x53cde1[_0x50bfb2(0x280)]=parseInt(_0x53cde1[_0x50bfb2(0x280)])-parseInt(_0x5e7bb2[_0x50bfb2(0x2f9)]),_0x5ce055++);});_0x5ce055=='0'&&(_0x330e74[_0x1c3839(0x2b9)]=_0x330e74['product_details'][_0x1c3839(0x24a)]({'product_name':_0x5e7bb2[_0x1c3839(0x2bf)],'product_stock':_0x5e7bb2['return_qty'],'primary_code':_0x5e7bb2[_0x1c3839(0x26e)],'secondary_code':_0x5e7bb2[_0x1c3839(0x2c6)],'product_code':_0x5e7bb2['product_code'],'bay':_0x5e7bb2[_0x1c3839(0x2d0)],'maxProducts':0xf423f}));}),await _0x330e74['save']();const _0x2af804=await purchases_finished[_0x4646bf(0x2c9)]({'invoice':_0x1735fb});_0x2af804[_0x4646bf(0x1ee)]='True';const _0x2f3335=await _0x2af804['save'](),_0x343ad7=new s_payment_data({'invoice':_0x1735fb,'suppliers':_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x1e6)],'reason':_0x4646bf(0x1ff)});await _0x343ad7[_0x4646bf(0x23e)]();const _0x22b420=await master_shop['find'](),_0x5d266a=await email_settings[_0x4646bf(0x2c9)](),_0x53cb55=await suppliers[_0x4646bf(0x2c9)]({'name':_0x1158fe[_0x4646bf(0x2d6)][_0x4646bf(0x1e6)]});_0x22b420[0x0][_0x4646bf(0x29f)]==0x1?(right_currency=_0x22b420[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x22b420[0x0][_0x4646bf(0x2be)]);var _0x557cdd=_0x426e89,_0x123abe=_0x3fc4bc,_0x12cdd5='',_0xd5a3e4;for(_0xd5a3e4 in _0x557cdd){_0x12cdd5+=_0x4646bf(0x2bc)+_0x4646bf(0x2d4)+_0x557cdd[_0xd5a3e4]+'</td>'+_0x4646bf(0x2d4)+_0x123abe[_0xd5a3e4]+_0x4646bf(0x237)+_0x4646bf(0x1fc);}let _0x17d103=nodemailer['createTransport']({'service':_0x4646bf(0x30b),'auth':{'user':_0x5d266a[_0x4646bf(0x27a)],'pass':_0x5d266a[_0x4646bf(0x2f3)]}}),_0x6fd58={'from':_0x5d266a['email'],'to':_0x53cb55[_0x4646bf(0x27a)],'subject':_0x4646bf(0x212),'attachments':[{'filename':_0x4646bf(0x270),'path':__dirname+_0x4646bf(0x1dd)+_0x4646bf(0x1e1)+_0x22b420[0x0]['image'],'cid':_0x4646bf(0x272)}],'html':'<!DOCTYPE\x20html>'+_0x4646bf(0x24e)+'</head><body>'+_0x4646bf(0x259)+_0x4646bf(0x26d)+_0x4646bf(0x259)+_0x4646bf(0x309)+_0x4646bf(0x1fe)+_0x4646bf(0x259)+_0x4646bf(0x20d)+_0x22b420[0x0][_0x4646bf(0x2d8)]+_0x4646bf(0x277)+'</div>'+_0x4646bf(0x1fe)+_0x4646bf(0x25d)+_0x4646bf(0x259)+_0x4646bf(0x260)+_0x4646bf(0x1fd)+_0x1735fb+'\x20'+_0x4646bf(0x306)+_0x4646bf(0x252)+_0x384a7f+'\x20'+_0x4646bf(0x2ab)+_0x4646bf(0x219)+_0x4646bf(0x1fe)+_0x4646bf(0x1e5)+_0x4646bf(0x28c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4646bf(0x25f)+_0x4646bf(0x20b)+_0x4646bf(0x313)+'</tr>'+'</thead>'+_0x4646bf(0x287)+'\x20'+_0x12cdd5+'\x20'+_0x4646bf(0x236)+_0x4646bf(0x2fe)+_0x4646bf(0x259)+'<strong>\x20Regards\x20</strong>'+_0x4646bf(0x24d)+_0x22b420[0x0][_0x4646bf(0x2d8)]+'</h5>'+'</div>'+_0x4646bf(0x1fe)+_0x4646bf(0x315)};_0x17d103[_0x4646bf(0x206)](_0x6fd58,function(_0x3924d2,_0xe62fa9){var _0x2eeb5d=_0x4646bf;_0x3924d2?console['log'](_0x2eeb5d(0x310)):console[_0x2eeb5d(0x2e7)]('Email\x20sent\x20successfully');}),_0x1158fe[_0x4646bf(0x211)](_0x4646bf(0x308),_0x4646bf(0x214)),_0x4c9c3['redirect'](_0x4646bf(0x2ae));}catch(_0x19e05b){_0x4c9c3[_0x4646bf(0x207)](0xc8)[_0x4646bf(0x2fc)]({'message':_0x19e05b[_0x4646bf(0x29a)]});}}),router[a0_0x3316c3(0x20c)](a0_0x3316c3(0x286),auth,async(_0x1c1d75,_0x2401a7)=>{var _0x54b350=a0_0x3316c3;try{const {username:_0x42f557,email:_0x3c0899,role:_0x55431d}=_0x1c1d75[_0x54b350(0x2ec)],_0x4af173=_0x1c1d75[_0x54b350(0x2ec)],_0x32f468=await profile['findOne']({'email':_0x4af173[_0x54b350(0x27a)]}),_0x499d53=await master_shop[_0x54b350(0x22d)](),_0x404371=_0x1c1d75[_0x54b350(0x2a0)]['id'],_0x3ca99b=await purchases_finished['findById'](_0x404371);if(_0x499d53[0x0][_0x54b350(0x2b2)]==_0x54b350(0x28e))var _0x5cf6a2=users[_0x54b350(0x27f)];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]=='Hindi')var _0x5cf6a2=users[_0x54b350(0x24c)];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]==_0x54b350(0x240))var _0x5cf6a2=users[_0x54b350(0x240)];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]==_0x54b350(0x22e))var _0x5cf6a2=users['Spanish'];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]==_0x54b350(0x2a2))var _0x5cf6a2=users[_0x54b350(0x2a2)];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]==_0x54b350(0x258))var _0x5cf6a2=users[_0x54b350(0x257)];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]=='Chinese')var _0x5cf6a2=users['Chinese'];else{if(_0x499d53[0x0][_0x54b350(0x2b2)]=='Arabic\x20(ae)')var _0x5cf6a2=users[_0x54b350(0x284)];}}}}}}}_0x2401a7[_0x54b350(0x29b)]('all_purchases_barcode',{'success':_0x1c1d75[_0x54b350(0x211)](_0x54b350(0x308)),'errors':_0x1c1d75['flash']('errors'),'role':_0x4af173,'profile':_0x32f468,'alldata':_0x3ca99b,'master_shop':_0x499d53,'language':_0x5cf6a2}),console[_0x54b350(0x2e7)](alldata);}catch(_0x8d4b2){console[_0x54b350(0x2e7)](_0x8d4b2);}}),router[a0_0x3316c3(0x2d3)](a0_0x3316c3(0x26c),async(_0x38971d,_0x37f70d)=>{var _0x665565=a0_0x3316c3;const {product_code:_0x5f4a40}=_0x38971d[_0x665565(0x2d6)];var _0x5ada5d;const _0x48e4ba=await product['aggregate']([{'$match':{'primary_code':_0x5f4a40}},{'$group':{'_id':_0x665565(0x234),'name':{'$first':_0x665565(0x23a)},'category':{'$first':_0x665565(0x23c)},'brand':{'$first':_0x665565(0x2ca)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x665565(0x2d1)},'product_code':{'$first':_0x665565(0x24b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x665565(0x238)},'maxStocks':{'$first':_0x665565(0x1e3)},'maxProdPerUnit':{'$first':_0x665565(0x1eb)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x665565(0x289)},'gross_price':{'$first':_0x665565(0x2eb)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x5c55c9=await product[_0x665565(0x292)]([{'$match':{'secondary_code':_0x5f4a40}},{'$group':{'_id':_0x665565(0x234),'name':{'$first':'$name'},'category':{'$first':_0x665565(0x23c)},'brand':{'$first':_0x665565(0x2ca)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x665565(0x2d1)},'product_code':{'$first':_0x665565(0x24b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x665565(0x238)},'maxStocks':{'$first':_0x665565(0x1e3)},'maxProdPerUnit':{'$first':_0x665565(0x1eb)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x665565(0x289)},'gross_price':{'$first':_0x665565(0x2eb)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x48e4ba[_0x665565(0x267)]>0x0)_0x5ada5d=_0x48e4ba;else _0x5c55c9['length']>0x0&&(_0x5ada5d=_0x5c55c9);_0x37f70d['json'](_0x5ada5d);}),router['post'](a0_0x3316c3(0x28a),async(_0x5c9863,_0x266298)=>{var _0x351d54=a0_0x3316c3;const {productCode:_0x22d4f2,bay:_0x81ab4a,warehouses:_0x145d71,room:_0x5cc478}=_0x5c9863[_0x351d54(0x2d6)];console[_0x351d54(0x2e7)](_0x5c9863[_0x351d54(0x2d6)]);try{const _0x19571f=await warehouse[_0x351d54(0x292)]([{'$match':{'name':_0x145d71,'room':_0x5cc478}},{'$unwind':_0x351d54(0x1e4)},{'$match':{'product_details.bay':parseInt(_0x81ab4a)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x351d54(0x285)},'product_stock':{'$first':_0x351d54(0x305)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x266298[_0x351d54(0x207)](0xc8)[_0x351d54(0x2fc)](_0x19571f);}catch(_0x518f8e){_0x266298[_0x351d54(0x207)](0x194)[_0x351d54(0x2fc)]({'message':_0x518f8e[_0x351d54(0x29a)]});}}),router[a0_0x3316c3(0x2d3)](a0_0x3316c3(0x269),async(_0x14b1db,_0x387ef8)=>{var _0x15177b=a0_0x3316c3;const {product_code:_0x158123}=_0x14b1db['body'];var _0x5b2ea4;const _0x1b5a70=await product[_0x15177b(0x292)]([{'$match':{'primary_code':_0x158123,'type_products':_0x15177b(0x2e7)}},{'$group':{'_id':'$_id','name':{'$first':_0x15177b(0x23a)},'category':{'$first':_0x15177b(0x23c)},'brand':{'$first':_0x15177b(0x2ca)},'unit':{'$first':_0x15177b(0x294)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x15177b(0x24b)},'primary_code':{'$first':_0x15177b(0x283)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x15177b(0x1e3)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x15177b(0x2eb)},'sales_category':{'$first':_0x15177b(0x2e5)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x1b5a70);const _0x22f0a9=await product[_0x15177b(0x292)]([{'$match':{'secondary_code':_0x158123,'type_products':_0x15177b(0x2e7)}},{'$group':{'_id':_0x15177b(0x234),'name':{'$first':_0x15177b(0x23a)},'category':{'$first':_0x15177b(0x23c)},'brand':{'$first':_0x15177b(0x2ca)},'unit':{'$first':_0x15177b(0x294)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x15177b(0x24b)},'primary_code':{'$first':_0x15177b(0x283)},'secondary_code':{'$first':_0x15177b(0x238)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x15177b(0x289)},'gross_price':{'$first':_0x15177b(0x2eb)},'sales_category':{'$first':_0x15177b(0x2e5)},'type_products':{'$first':_0x15177b(0x276)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x1b5a70[_0x15177b(0x267)]>0x0)_0x5b2ea4=_0x1b5a70;else _0x22f0a9[_0x15177b(0x267)]>0x0&&(_0x5b2ea4=_0x22f0a9);_0x387ef8[_0x15177b(0x2fc)](_0x5b2ea4);}),module[a0_0x3316c3(0x300)]=router;