var a0_0x39be50=a0_0x2fac;(function(_0x4f84a6,_0x331301){var _0x196de3=a0_0x2fac,_0x3d1f35=_0x4f84a6();while(!![]){try{var _0x51b0a1=parseInt(_0x196de3(0x295))/0x1+parseInt(_0x196de3(0x241))/0x2+-parseInt(_0x196de3(0x2f1))/0x3*(-parseInt(_0x196de3(0x1b2))/0x4)+-parseInt(_0x196de3(0x280))/0x5+parseInt(_0x196de3(0x279))/0x6+parseInt(_0x196de3(0x25b))/0x7+parseInt(_0x196de3(0x2ac))/0x8*(-parseInt(_0x196de3(0x20c))/0x9);if(_0x51b0a1===_0x331301)break;else _0x3d1f35['push'](_0x3d1f35['shift']());}catch(_0x2c8881){_0x3d1f35['push'](_0x3d1f35['shift']());}}}(a0_0x4bc1,0x5b711));const express=require(a0_0x39be50(0x29b)),app=express(),router=express[a0_0x39be50(0x218)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require('../models/all_models'),auth=require(a0_0x39be50(0x1f5)),nodemailer=require(a0_0x39be50(0x274));var ejs=require(a0_0x39be50(0x298));const path=require(a0_0x39be50(0x28f)),users=require(a0_0x39be50(0x2dd)),{isNull}=require(a0_0x39be50(0x2ae));router[a0_0x39be50(0x1c7)](a0_0x39be50(0x201),auth,async(_0x5da02f,_0x58d9a0)=>{var _0x8c54f2=a0_0x39be50;try{const {username:_0x29105f,email:_0x331611,role:_0x120461}=_0x5da02f[_0x8c54f2(0x206)],_0x51a3a6=_0x5da02f[_0x8c54f2(0x206)],_0x454b2b=await profile[_0x8c54f2(0x264)]({'email':_0x51a3a6[_0x8c54f2(0x1b1)]}),_0x3951c3=await staff[_0x8c54f2(0x264)]({'email':_0x51a3a6[_0x8c54f2(0x1b1)]}),_0x35aa08=await master_shop[_0x8c54f2(0x24e)]();let _0x1840e2=await transfers_finished[_0x8c54f2(0x262)]([{'$match':{'to_warehouse':_0x3951c3['warehouse']}}]);if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x1b3))var _0x2b1262=users[_0x8c54f2(0x208)];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x261))var _0x2b1262=users['Hindi'];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x1ef))var _0x2b1262=users[_0x8c54f2(0x1ef)];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x23d))var _0x2b1262=users['Spanish'];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x2aa))var _0x2b1262=users[_0x8c54f2(0x2aa)];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x2a3))var _0x2b1262=users['Portuguese'];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x1ba))var _0x2b1262=users['Chinese'];else{if(_0x35aa08[0x0][_0x8c54f2(0x1b8)]==_0x8c54f2(0x254))var _0x2b1262=users[_0x8c54f2(0x25e)];}}}}}}}_0x58d9a0[_0x8c54f2(0x28c)](_0x8c54f2(0x23c),{'success':_0x5da02f[_0x8c54f2(0x22a)](_0x8c54f2(0x1e4)),'errors':_0x5da02f[_0x8c54f2(0x22a)](_0x8c54f2(0x1e7)),'purchases':_0x1840e2,'role':_0x51a3a6,'profile':_0x454b2b,'master_shop':_0x35aa08,'language':_0x2b1262,'staff_data':_0x3951c3});}catch(_0x449a15){console[_0x8c54f2(0x289)](_0x8c54f2(0x228),_0x449a15),_0x58d9a0[_0x8c54f2(0x1df)](0xc8)[_0x8c54f2(0x214)]({'message':_0x449a15[_0x8c54f2(0x2a1)]});}}),router[a0_0x39be50(0x1c7)]('/incoming/add',auth,async(_0x22d3de,_0x2ec6be)=>{var _0x5d9b58=a0_0x39be50;try{const {username:_0x30d058,email:_0x3d2711,role:_0x4f97c2}=_0x22d3de[_0x5d9b58(0x206)],_0x4a44ff=_0x22d3de['user'],_0x2335cc=await profile['findOne']({'email':_0x4a44ff[_0x5d9b58(0x1b1)]}),_0x3232d6=await staff[_0x5d9b58(0x264)]({'email':_0x4a44ff[_0x5d9b58(0x1b1)]}),_0x305345=await master_shop[_0x5d9b58(0x24e)]();let _0x1cffb4=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x3232d6[_0x5d9b58(0x2ba)],'to_recieved':'false'}}]);if(_0x305345[0x0]['language']==_0x5d9b58(0x1b3))var _0x75be96=users[_0x5d9b58(0x208)];else{if(_0x305345[0x0][_0x5d9b58(0x1b8)]==_0x5d9b58(0x261))var _0x75be96=users[_0x5d9b58(0x261)];else{if(_0x305345[0x0][_0x5d9b58(0x1b8)]==_0x5d9b58(0x1ef))var _0x75be96=users[_0x5d9b58(0x1ef)];else{if(_0x305345[0x0]['language']==_0x5d9b58(0x23d))var _0x75be96=users['Spanish'];else{if(_0x305345[0x0][_0x5d9b58(0x1b8)]=='French')var _0x75be96=users[_0x5d9b58(0x2aa)];else{if(_0x305345[0x0][_0x5d9b58(0x1b8)]==_0x5d9b58(0x2a3))var _0x75be96=users[_0x5d9b58(0x22b)];else{if(_0x305345[0x0][_0x5d9b58(0x1b8)]==_0x5d9b58(0x1ba))var _0x75be96=users[_0x5d9b58(0x1ba)];else{if(_0x305345[0x0]['language']==_0x5d9b58(0x254))var _0x75be96=users['Arabic'];}}}}}}}_0x2ec6be[_0x5d9b58(0x28c)]('incoming_add',{'success':_0x22d3de[_0x5d9b58(0x22a)](_0x5d9b58(0x1e4)),'errors':_0x22d3de['flash']('errors'),'purchases':_0x1cffb4,'role':_0x4a44ff,'profile':_0x2335cc,'master_shop':_0x305345,'language':_0x75be96,'staff_data':_0x3232d6});}catch(_0x5ef1cf){console[_0x5d9b58(0x289)]('table\x20page',_0x5ef1cf),_0x2ec6be[_0x5d9b58(0x1df)](0xc8)[_0x5d9b58(0x214)]({'message':_0x5ef1cf[_0x5d9b58(0x2a1)]});}});function a0_0x4bc1(){var _0x16fe3e=['createTransport','/CheckingWarehouse','invoice','</head><body>','$product_details.bin','French','payment\x20successfull','8xZKIIv','Purchase\x20Return\x20Mail','util','logs','INC-','$name','date_recieved','Purchase\x20Return','type_of_products_type','</body></html>','redirect','suppliers','$due_amount','$maxStocks','warehouse','$product_details.product_stock','to_quantity','maxStocks','sales_data_cateory','\x20<=>\x20','FROZEN\x20GOODS','slice','$product_details.storage','<strong>\x20Regards\x20</strong>','Logo.png','concat','Enabled','/view_log','There\x20is\x20','exports','return_purchase_finished','product_stock','note','to_bay','Rack\x201','product_name','primary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','batch_code','$product_details.secondary_code','True','updateOne','/upload/','true','\x20Order\x20Date\x20:\x20','all_purchases_barcode','/all_purchases_finished/view','/view/add_purchases','<h5\x20style=\x22text-align:\x20left;\x22>','../public/language/languages.json',',\x20bin:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','role','purchases_id','$product_details.maxProducts','$suppliers','suppliers_docs','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','\x20Order\x20Number\x20:\x20','/all_purchases/view','/all_purchases_finished/process/','prod_unit','Room_name','getDate','product_details','sales_category','product_date','expiry_date','237PHiGUv','<!DOCTYPE\x20html>','/process/:id','bin','$alertquantity','email','29008iMaFIS','English\x20(US)','INCF-','room_name','/give_payment/:id','$brand','language','purchase\x20data\x20update\x20successfully','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details','$sales_category','max_product_unit','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_id','map','level','error','name','prod_primunit','get','getFullYear','</h5>','<hr\x20class=\x22my-3\x22>','$category','Transfer\x20Finalize\x20Successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</table>','paid_amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/getTRF','item_code','\x20<>\x20','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Return\x20Goods','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','Ambient','prod_code','back','min','password','match','Distributing\x20','$product_details.primary_code','status','prod_Qty','all','purchases_process','<div>','success','$product.quantity','$product.type','errors','</div>','gross_price','$invoice','$expiry_date','all_purchases_finished','<table\x20style=\x22width:\x20100%\x20!important;\x22>','abs','German','$paid_amount','currency_placement','return_qty','staff','sendMail','../middleware/auth','string','Purchase\x20Mail','edit_purchases_finished','Error\x20occurred\x20while\x20processing\x20product:','forEach','</td>','product_code_hide','LOG-INC-','purchase\x20data\x20add\x20successfully','_id','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','/incoming','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','catch','$_id','type_of_products','user','params','English','/../public','padStart','then','14834313yCPxdQ','false','date','$unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','stock_data','json','gmail','all_purchases_finished_logs','Enclosed','Router','Error\x20Occurs','max','/view/return_purchase/:id','en-CA','$batch_code','$secondary_unit','add_purchases_finished','$warehouse_name','stock_quantity','toString','prod_level','$product_details.bay','/view/:id','logo','<span\x20style=\x22float:\x20right;\x22>','table\x20page','$primary_code','flash','Portuguese','$maxProdPerUnit','maxPerUnit','<html><head><title></title>','uuid','product_code','</tbody>','site_title','product_cat','prod_cat','toLocaleDateString','own','$secondary_code','maxperunit','$product_details.type','$product','filter','incoming_view','Spanish','$product_details.rack','prod_secondunit','floor','813734pfQyDs','user_id','</span>','$type_products','standard_unit','numeric','save','to_warehouse','primary_code_hide','$gross_price','image','valueOf','MaxStocks_data','find','purchase_quantity','$room','quantity','amount','invoice_init','Arabic\x20(ae)','$note','Email\x20sent\x20successfully','to_recieved','length',',\x20bay:\x20','2-digit','4063773wlezwP','Rack\x202','<tbody\x20style=\x22text-align:\x20center;\x22>','Arabic','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$product.bin','Hindi','aggregate','production_date','findOne','$product.room_name','port','host','body','product_data','return_data','findById','/view','currency','$return_data','$product.floorlevel','product','$suppliers_docs','\x20units\x20to\x20warehouse:\x20','secondary_code_hide','nodemailer','room','<h2>\x20','id_transaction','secondary_code','3243282rRGuHx','JO_number','getMonth','prod_name','/invoice/:id','due_amount','/view/add_purchases_logs','2412850TdzWAz','$date','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','warehouse_name','secondary_unit','<tr>','/preview/:id','bay','log','add_purchases_finished_logs',',\x20room:\x20','render','post','unit','path','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.floorlevel','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','RoomAssign','$product_details._id','404511CFzhBt','/barcode_scanner_logs','</thead>','ejs','$product.bay','prod_qty','express','to_room_name','<h5>','/view/add_purchases/:id','DRY\x20GOODS','</tr>','message','edit_purchases_finished_view','Portuguese\x20(BR)','master'];a0_0x4bc1=function(){return _0x16fe3e;};return a0_0x4bc1();}const createLog=async _0x3f5aae=>{var _0x533d54=a0_0x39be50;const _0x1d7d8d=new datalogs({'location':_0x3f5aae});return await _0x1d7d8d[_0x533d54(0x247)](),_0x1d7d8d['invoice_init'];};router[a0_0x39be50(0x28d)]('/incoming/add',auth,async(_0x87242,_0x44954f)=>{var _0x2bf6b5=a0_0x39be50;try{const {invoice_trf_data:_0x5cac89,item_code:_0x38d71d,SCRN:_0x23ba17,ReqBy:_0x53b5fd,type_of_products:_0x4cfbc8,dateofreq:_0x29ec18,PO_number:_0x22f44a,date:_0x2e50a5,warehouse_name:_0x1cef14,typeservicesData:_0x4f72d9,typevehicle:_0x247ec9,driver:_0x4beb0e,plate:_0x2a3f91,van:_0x4293b4,DRSI:_0x2a9f9d,TSU:_0x5bc5f6,TFU:_0x4e3caf,note:_0x3f03ea}=_0x87242[_0x2bf6b5(0x268)],_0x2d337c=await transfers_finished[_0x2bf6b5(0x26b)](_0x5cac89);if(typeof _0x38d71d==_0x2bf6b5(0x1f6))var _0x88a96e=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2cf)]],_0x46e6f2=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x1d2)]],_0x2d4af2=[_0x87242['body'][_0x2bf6b5(0x2bc)]],_0x4f401f=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x28e)]],_0xcd9fed=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x23f)]],_0x53ad9a=[_0x87242['body'][_0x2bf6b5(0x2f4)]],_0x25620b=[_0x87242['body'][_0x2bf6b5(0x2d0)]],_0x441ef4=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x278)]],_0x1635ed=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2d2)]],_0x1ee06a=[_0x87242['body']['expiry_date']],_0x820815=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x263)]],_0x2d9852=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x1be)]],_0x26ee97=[_0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x275)]];else var _0x88a96e=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2cf)]],_0x46e6f2=[..._0x87242['body'][_0x2bf6b5(0x1d2)]],_0x2d4af2=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2bc)]],_0x4f401f=[..._0x87242['body']['unit']],_0xcd9fed=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x23f)]],_0x53ad9a=[..._0x87242[_0x2bf6b5(0x268)]['bin']],_0x25620b=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2d0)]],_0x441ef4=[..._0x87242['body'][_0x2bf6b5(0x278)]],_0x1635ed=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2d2)]],_0x1ee06a=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x2f0)]],_0x820815=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x263)]],_0x2d9852=[..._0x87242[_0x2bf6b5(0x268)][_0x2bf6b5(0x1be)]],_0x26ee97=[..._0x87242['body'][_0x2bf6b5(0x275)]];const _0x5f517a=_0x88a96e['map'](_0x1cd8b5=>{return _0x1cd8b5={'product_name':_0x1cd8b5};});_0x46e6f2[_0x2bf6b5(0x1fa)]((_0x44a41c,_0x158f81)=>{_0x5f517a[_0x158f81]['product_code']=_0x44a41c;}),_0x2d4af2[_0x2bf6b5(0x1fa)]((_0x4a6f05,_0x3d398f)=>{var _0x438247=_0x2bf6b5;_0x5f517a[_0x3d398f][_0x438247(0x251)]=Math[_0x438247(0x1ee)](_0x4a6f05);}),_0x4f401f['forEach']((_0x56f7d6,_0x97738b)=>{_0x5f517a[_0x97738b]['standard_unit']=_0x56f7d6;}),_0xcd9fed[_0x2bf6b5(0x1fa)]((_0x4a0751,_0x298609)=>{var _0x344629=_0x2bf6b5;_0x5f517a[_0x298609][_0x344629(0x285)]=_0x4a0751;}),_0x53ad9a['forEach']((_0x18ac0f,_0x3a6406)=>{var _0x51bbb4=_0x2bf6b5,_0x16f241=_0x18ac0f[_0x51bbb4(0x1dc)](/[A-Za-z]+/)[0x0],_0x10c7ce=parseInt(_0x18ac0f[_0x51bbb4(0x1dc)](/\d+/)[0x0]);_0x5f517a[_0x3a6406]['level']=_0x16f241,_0x5f517a[_0x3a6406]['bay']=_0x10c7ce;}),_0x25620b[_0x2bf6b5(0x1fa)]((_0xca0a4d,_0x9cdc2b)=>{var _0x34e0de=_0x2bf6b5;_0x5f517a[_0x9cdc2b][_0x34e0de(0x2d0)]=_0xca0a4d;}),_0x441ef4[_0x2bf6b5(0x1fa)]((_0x3fe4f5,_0xa092f7)=>{var _0x25d168=_0x2bf6b5;_0x5f517a[_0xa092f7][_0x25d168(0x278)]=_0x3fe4f5;}),_0x1635ed[_0x2bf6b5(0x1fa)]((_0x1f7dfb,_0x2d913f)=>{var _0x2e355a=_0x2bf6b5;_0x5f517a[_0x2d913f][_0x2e355a(0x2d2)]=_0x1f7dfb;}),_0x1ee06a['forEach']((_0x334d76,_0x3e0ffa)=>{var _0x1ecd67=_0x2bf6b5;_0x5f517a[_0x3e0ffa][_0x1ecd67(0x2f0)]=_0x334d76;}),_0x820815[_0x2bf6b5(0x1fa)]((_0x1b943a,_0x17f674)=>{var _0x345aec=_0x2bf6b5;_0x5f517a[_0x17f674][_0x345aec(0x263)]=_0x1b943a;}),_0x2d9852['forEach']((_0xc344bc,_0xc9c1d1)=>{_0x5f517a[_0xc9c1d1]['maxperunit']=_0xc344bc;}),_0x26ee97[_0x2bf6b5(0x1fa)]((_0x35e232,_0x72e8b8)=>{var _0x311999=_0x2bf6b5;_0x5f517a[_0x72e8b8][_0x311999(0x1b5)]=_0x35e232;});const _0x2f09d6=await createLog('INC');_0x26ee97['forEach']((_0x41ed91,_0x3a084d)=>{var _0x4098db=_0x2bf6b5;_0x5f517a[_0x3a084d][_0x4098db(0x2a7)]=_0x4098db(0x2b0)+_0x2f09d6[_0x4098db(0x222)]()['padStart'](0x8,'0');});const _0x1056b1=_0x5f517a[_0x2bf6b5(0x23b)](_0x3e3e2e=>_0x3e3e2e['quantity']!=='0'&&_0x3e3e2e[_0x2bf6b5(0x251)]!==''),_0x2390aa=new purchases_incoming({'invoice':_0x2bf6b5(0x2b0)+_0x2f09d6['toString']()[_0x2bf6b5(0x20a)](0x8,'0'),'date':_0x2e50a5,'warehouse_name':_0x1cef14,'product':_0x1056b1,'note':_0x3f03ea,'POnumber':_0x22f44a,'SCRN':_0x23ba17,'ReqBy':_0x53b5fd,'dateofreq':_0x29ec18,'typeservicesData':_0x4f72d9,'van':_0x4293b4,'typevehicle':_0x247ec9,'driver':_0x4beb0e,'plate':_0x2a3f91,'DRSI':_0x2a9f9d,'TSU':_0x5bc5f6,'TFU':_0x4e3caf,'typeOfProducts':_0x4cfbc8}),_0x213e78=await _0x2390aa[_0x2bf6b5(0x247)](),_0x2cc6cf=_0x213e78['product'][_0x2bf6b5(0x1c2)](async _0x9694e=>{var _0x1c7f6f=_0x2bf6b5,_0x756eae=await warehouse[_0x1c7f6f(0x264)]({'name':_0x1cef14,'room':_0x9694e[_0x1c7f6f(0x1b5)]});if(_0x9694e[_0x1c7f6f(0x251)]>0x0){var _0x5c3309=0x0;const _0x56b8e9=_0x756eae[_0x1c7f6f(0x2ed)][_0x1c7f6f(0x1c2)](_0x2cd44d=>{var _0x58544d=_0x1c7f6f;_0x2cd44d['product_name']==_0x9694e[_0x58544d(0x2cf)]&&_0x2cd44d[_0x58544d(0x288)]==_0x9694e[_0x58544d(0x2cd)]&&_0x2cd44d[_0x58544d(0x2f0)]==_0x9694e[_0x58544d(0x2f0)]&&_0x2cd44d['production_date']==_0x9694e[_0x58544d(0x263)]&&_0x2cd44d[_0x58544d(0x2d2)]==_0x9694e[_0x58544d(0x2d2)]&&_0x2cd44d[_0x58544d(0x2a7)]==_0x9694e[_0x58544d(0x2a7)]&&(typeof _0x9694e[_0x58544d(0x277)]=='undefined'?(console[_0x58544d(0x289)]('here2',_0x2cd44d[_0x58544d(0x2cb)]+'\x20<>\x20'+_0x2cd44d['_id']+_0x58544d(0x2bf)+Math[_0x58544d(0x1ee)](_0x2cd44d['product_stock'])+Math['abs'](_0x9694e['to_quantity'])),_0x2cd44d[_0x58544d(0x2cb)]=Math[_0x58544d(0x1ee)](_0x2cd44d['product_stock'])+Math[_0x58544d(0x1ee)](_0x9694e[_0x58544d(0x251)])):(_0x2cd44d['product_stock']=Math['abs'](_0x2cd44d[_0x58544d(0x2cb)])+Math[_0x58544d(0x1ee)](_0x9694e['quantity']),_0x5c3309++));});_0x5c3309=='0'&&(_0x756eae[_0x1c7f6f(0x2ed)]=_0x756eae[_0x1c7f6f(0x2ed)][_0x1c7f6f(0x2c5)]({'product_name':_0x9694e['product_name'],'product_stock':_0x9694e[_0x1c7f6f(0x251)],'bay':_0x9694e[_0x1c7f6f(0x288)],'level':_0x9694e[_0x1c7f6f(0x1c3)],'product_code':_0x9694e['product_code'],'primary_code':_0x9694e['primary_code'],'secondary_code':_0x9694e[_0x1c7f6f(0x278)],'expiry_date':_0x9694e[_0x1c7f6f(0x2f0)],'production_date':_0x9694e['production_date'],'maxProducts':_0x9694e['maxProducts'],'batch_code':_0x9694e[_0x1c7f6f(0x2d2)],'secondary_unit':_0x9694e['secondary_unit'],'unit':_0x9694e[_0x1c7f6f(0x245)],'maxProducts':_0x9694e['maxProducts'],'maxPerUnit':_0x9694e[_0x1c7f6f(0x22d)],'invoice':_0x9694e['invoice']}));}return _0x756eae;});Promise['all'](_0x2cc6cf)[_0x2bf6b5(0x20b)](async _0x322e9f=>{var _0x54ceb8=_0x2bf6b5;try{for(const _0x214348 of _0x322e9f){await warehouse['updateOne']({'_id':_0x214348[_0x54ceb8(0x1ff)]},{'$addToSet':{'product_details':{'$each':_0x214348[_0x54ceb8(0x2ed)]}}});}_0x2d337c[_0x54ceb8(0x257)]=_0x54ceb8(0x2d7);const _0x1bf040=await _0x2d337c[_0x54ceb8(0x247)](),_0x56c19=await master_shop[_0x54ceb8(0x24e)](),_0x3bcc1e=await email_settings[_0x54ceb8(0x264)](),_0x37f300=await supervisor_settings[_0x54ceb8(0x24e)]();var _0x4e1b16=_0x2390aa[_0x54ceb8(0x270)],_0x44c734='',_0x15cd92;for(_0x15cd92 in _0x4e1b16){var _0x5d19bd='FG';_0x2390aa[_0x54ceb8(0x248)]=='DRY\x20GOODS'&&(_0x5d19bd='DG'),_0x44c734+=_0x54ceb8(0x286)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4e1b16[_0x15cd92][_0x54ceb8(0x2cf)]+'</td>'+_0x54ceb8(0x210)+_0x4e1b16[_0x15cd92][_0x54ceb8(0x230)]+_0x54ceb8(0x1fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4e1b16[_0x15cd92][_0x54ceb8(0x2bc)]+'</td>'+_0x54ceb8(0x210)+_0x4e1b16[_0x15cd92][_0x54ceb8(0x28e)]+_0x54ceb8(0x1fb)+_0x54ceb8(0x210)+_0x4e1b16[_0x15cd92][_0x54ceb8(0x285)]+_0x54ceb8(0x1fb)+_0x54ceb8(0x210)+_0x2390aa['to_warehouse']+_0x54ceb8(0x1fb)+_0x54ceb8(0x210)+_0x4e1b16[_0x15cd92][_0x54ceb8(0x29c)]+'</td>'+_0x54ceb8(0x210)+_0x5d19bd+_0x4e1b16[_0x15cd92]['to_bay']+'</td>'+'</tr>';}_0x87242[_0x54ceb8(0x22a)]('success',_0x54ceb8(0x1cc)),_0x44954f['redirect']('/picking_list/pdf_puchases_fin_own_trf/'+_0x213e78[_0x54ceb8(0x1ff)]);}catch(_0x391e16){console['error'](_0x391e16),_0x44954f['status'](0x1f4)[_0x54ceb8(0x214)]({'error':_0x54ceb8(0x25f)});}})[_0x2bf6b5(0x203)](_0x54d30a=>{var _0x1c049e=_0x2bf6b5;console[_0x1c049e(0x1c4)](_0x54d30a),_0x44954f[_0x1c049e(0x1df)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x2cd30a){}}),router['post'](a0_0x39be50(0x1d1),auth,async(_0x581c93,_0xdd3986)=>{var _0x463828=a0_0x39be50;try{const {warehouse:_0x4506c9}=_0x581c93[_0x463828(0x268)],_0xa7a8e5=await transfers_finished[_0x463828(0x24e)]({'to_warehouse':_0x4506c9,'to_recieved':_0x463828(0x20d)});_0xdd3986[_0x463828(0x214)](_0xa7a8e5);}catch(_0xfa68af){}}),router[a0_0x39be50(0x28d)]('/getinvoicetrf',auth,async(_0x411b3a,_0x4f9281)=>{var _0x2d040f=a0_0x39be50;try{const {invoice:_0x303278}=_0x411b3a[_0x2d040f(0x268)],_0x3faac8=await transfers_finished['find']({'_id':_0x303278,'to_recieved':_0x2d040f(0x20d)});_0x4f9281[_0x2d040f(0x214)](_0x3faac8);}catch(_0x115acf){}}),router['get'](a0_0x39be50(0x26c),auth,async(_0x1bbd4d,_0x5a4e8f)=>{var _0x558129=a0_0x39be50;try{const {username:_0x624659,email:_0x56408a,role:_0x5ea54d}=_0x1bbd4d['user'],_0x5303b1=_0x1bbd4d[_0x558129(0x206)],_0x266a2f=await profile[_0x558129(0x264)]({'email':_0x5303b1[_0x558129(0x1b1)]}),_0x7a6c99=await staff['findOne']({'email':_0x5303b1[_0x558129(0x1b1)]});if(_0x5303b1['role']==_0x558129(0x1f3)){const _0x22c8a5=await staff[_0x558129(0x264)]({'email':_0x5303b1[_0x558129(0x1b1)]});}const _0x18f5ba=await master_shop[_0x558129(0x24e)]();let _0x2fbbe7;if(_0x5303b1[_0x558129(0x2e0)]==_0x558129(0x1f3)){const _0x55458f=await staff[_0x558129(0x264)]({'email':_0x5303b1['email']});_0x2fbbe7=await purchases_finished[_0x558129(0x262)]([{'$match':{'warehouse_name':_0x55458f[_0x558129(0x2ba)],'typeOfProducts':_0x558129(0x236)}},{'$lookup':{'from':_0x558129(0x2b7),'localField':_0x558129(0x2b7),'foreignField':_0x558129(0x1c5),'as':_0x558129(0x2e4)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x558129(0x23a)},{'$group':{'_id':'$_id','invoice':{'$first':_0x558129(0x1ea)},'suppliers':{'$first':_0x558129(0x2e3)},'date':{'$first':_0x558129(0x281)},'warehouse_name':{'$first':_0x558129(0x220)},'room':{'$first':_0x558129(0x250)},'product':{'$push':_0x558129(0x23a)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x558129(0x1f0)},'due_amount':{'$first':_0x558129(0x2b8)},'return_data':{'$first':_0x558129(0x26e)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x558129(0x271)},'total_product_quantity':{'$sum':_0x558129(0x1e5)},'level':{'$addToSet':_0x558129(0x299)},'isle':{'$addToSet':_0x558129(0x260)},'type':{'$addToSet':_0x558129(0x1e6)},'floorlevel':{'$addToSet':_0x558129(0x26f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2fbbe7=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x558129(0x236)}},{'$unwind':_0x558129(0x23a)},{'$group':{'_id':_0x558129(0x204),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x558129(0x281)},'warehouse_name':{'$first':_0x558129(0x220)},'room':{'$addToSet':_0x558129(0x265)},'product':{'$push':_0x558129(0x23a)},'note':{'$first':_0x558129(0x255)},'paid_amount':{'$first':_0x558129(0x1f0)},'due_amount':{'$first':_0x558129(0x2b8)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x558129(0x21d)},'expiry_date':{'$first':_0x558129(0x1eb)},'suppliers_docs':{'$first':_0x558129(0x271)},'total_product_quantity':{'$sum':_0x558129(0x1e5)},'level':{'$addToSet':_0x558129(0x299)},'isle':{'$addToSet':_0x558129(0x260)},'type':{'$addToSet':_0x558129(0x1e6)},'floorlevel':{'$addToSet':_0x558129(0x26f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x1b3))var _0x38299f=users[_0x558129(0x208)];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x261))var _0x38299f=users[_0x558129(0x261)];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x1ef))var _0x38299f=users['German'];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x23d))var _0x38299f=users[_0x558129(0x23d)];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x2aa))var _0x38299f=users[_0x558129(0x2aa)];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x2a3))var _0x38299f=users[_0x558129(0x22b)];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x1ba))var _0x38299f=users[_0x558129(0x1ba)];else{if(_0x18f5ba[0x0][_0x558129(0x1b8)]==_0x558129(0x254))var _0x38299f=users[_0x558129(0x25e)];}}}}}}}_0x5a4e8f[_0x558129(0x28c)](_0x558129(0x1ec),{'success':_0x1bbd4d[_0x558129(0x22a)](_0x558129(0x1e4)),'errors':_0x1bbd4d['flash']('errors'),'purchases':_0x2fbbe7,'role':_0x5303b1,'profile':_0x266a2f,'master_shop':_0x18f5ba,'language':_0x38299f});}catch(_0x2d7e8c){console[_0x558129(0x289)]('table\x20page',_0x2d7e8c),_0x5a4e8f[_0x558129(0x1df)](0xc8)[_0x558129(0x214)]({'message':_0x2d7e8c[_0x558129(0x2a1)]});}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x2c7),auth,async(_0x466714,_0x6ad7c2)=>{var _0x57ea91=a0_0x39be50;try{const {username:_0x4ff71c,email:_0x40baa2,role:_0x197646}=_0x466714[_0x57ea91(0x206)],_0x6d8d63=_0x466714['user'],_0x14bf65=await profile['findOne']({'email':_0x6d8d63[_0x57ea91(0x1b1)]}),_0x392993=await staff[_0x57ea91(0x264)]({'email':_0x6d8d63['email']});if(_0x6d8d63[_0x57ea91(0x2e0)]==_0x57ea91(0x1f3)){const _0x86e900=await staff['findOne']({'email':_0x6d8d63[_0x57ea91(0x1b1)]});}const _0x54c7c8=await master_shop[_0x57ea91(0x24e)]();let _0x130436;if(_0x6d8d63['role']==_0x57ea91(0x1f3)){const _0x30754e=await staff[_0x57ea91(0x264)]({'email':_0x6d8d63[_0x57ea91(0x1b1)]});_0x130436=await purchases_finished[_0x57ea91(0x262)]([{'$match':{'warehouse_name':_0x30754e[_0x57ea91(0x2ba)]}},{'$lookup':{'from':'suppliers','localField':_0x57ea91(0x2b7),'foreignField':_0x57ea91(0x1c5),'as':_0x57ea91(0x2e4)}},{'$unwind':_0x57ea91(0x271)},{'$unwind':_0x57ea91(0x23a)},{'$group':{'_id':_0x57ea91(0x204),'invoice':{'$first':_0x57ea91(0x1ea)},'suppliers':{'$first':_0x57ea91(0x2e3)},'date':{'$first':_0x57ea91(0x281)},'warehouse_name':{'$first':_0x57ea91(0x220)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x57ea91(0x255)},'paid_amount':{'$first':_0x57ea91(0x1f0)},'due_amount':{'$first':_0x57ea91(0x2b8)},'return_data':{'$first':_0x57ea91(0x26e)},'batch_code':{'$first':_0x57ea91(0x21d)},'expiry_date':{'$first':_0x57ea91(0x1eb)},'suppliers_docs':{'$first':_0x57ea91(0x271)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x57ea91(0x260)},'type':{'$addToSet':_0x57ea91(0x1e6)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x130436=await purchases_finished[_0x57ea91(0x262)]([{'$match':{'typeOfProducts':_0x57ea91(0x2af)}},{'$unwind':_0x57ea91(0x23a)},{'$group':{'_id':_0x57ea91(0x204),'invoice':{'$first':_0x57ea91(0x1ea)},'suppliers':{'$first':_0x57ea91(0x2e3)},'date':{'$first':_0x57ea91(0x281)},'warehouse_name':{'$first':_0x57ea91(0x220)},'room':{'$addToSet':_0x57ea91(0x265)},'product':{'$push':_0x57ea91(0x23a)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x57ea91(0x1f0)},'due_amount':{'$first':_0x57ea91(0x2b8)},'return_data':{'$first':_0x57ea91(0x26e)},'batch_code':{'$first':_0x57ea91(0x21d)},'expiry_date':{'$first':_0x57ea91(0x1eb)},'suppliers_docs':{'$first':_0x57ea91(0x271)},'total_product_quantity':{'$sum':_0x57ea91(0x1e5)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x57ea91(0x260)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x57ea91(0x26f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]==_0x57ea91(0x1b3))var _0x56a40c=users[_0x57ea91(0x208)];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]=='Hindi')var _0x56a40c=users[_0x57ea91(0x261)];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]==_0x57ea91(0x1ef))var _0x56a40c=users[_0x57ea91(0x1ef)];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]=='Spanish')var _0x56a40c=users[_0x57ea91(0x23d)];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]==_0x57ea91(0x2aa))var _0x56a40c=users[_0x57ea91(0x2aa)];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]==_0x57ea91(0x2a3))var _0x56a40c=users[_0x57ea91(0x22b)];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]==_0x57ea91(0x1ba))var _0x56a40c=users['Chinese'];else{if(_0x54c7c8[0x0][_0x57ea91(0x1b8)]==_0x57ea91(0x254))var _0x56a40c=users[_0x57ea91(0x25e)];}}}}}}}_0x6ad7c2['render'](_0x57ea91(0x216),{'success':_0x466714[_0x57ea91(0x22a)](_0x57ea91(0x1e4)),'errors':_0x466714[_0x57ea91(0x22a)](_0x57ea91(0x1e7)),'purchases':_0x130436,'role':_0x6d8d63,'profile':_0x14bf65,'master_shop':_0x54c7c8,'language':_0x56a40c});}catch(_0x480196){console['log'](_0x57ea91(0x228),_0x480196),_0x6ad7c2[_0x57ea91(0x1df)](0xc8)[_0x57ea91(0x214)]({'message':_0x480196[_0x57ea91(0x2a1)]});}});function BayBinSelected(_0x36a728,_0x416592){var _0x2d9c72=a0_0x39be50,_0x53935f=[],_0x314c4f=[];if(_0x36a728==_0x2d9c72(0x29f)){switch(_0x416592){case _0x2d9c72(0x2ce):_0x53935f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2d9c72(0x25c):_0x53935f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x314c4f=['DG'];}else{if(_0x36a728==_0x2d9c72(0x2c0)){switch(_0x416592){case _0x2d9c72(0x2ce):_0x53935f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2d9c72(0x25c):_0x53935f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x314c4f=['FG'];}}return{'levels':_0x53935f,'identify':_0x314c4f};}function a0_0x2fac(_0x33b6e7,_0x2678e3){var _0x4bc1c4=a0_0x4bc1();return a0_0x2fac=function(_0x2fac3c,_0x28e5a8){_0x2fac3c=_0x2fac3c-0x1b0;var _0x5bef58=_0x4bc1c4[_0x2fac3c];return _0x5bef58;},a0_0x2fac(_0x33b6e7,_0x2678e3);}async function getRandom8DigitNumber(){var _0x19a659=a0_0x39be50;const _0x39d2f6=0x989680,_0x231a41=0x5f5e0ff,_0xbc91c8=Math[_0x19a659(0x240)](Math[_0x19a659(0x282)]()*(_0x231a41-_0x39d2f6+0x1))+_0x39d2f6;var _0x37a9e7;const _0x4b54f0=await purchases_finished[_0x19a659(0x264)]({'invoice':_0x19a659(0x1b4)+_0xbc91c8});return _0x4b54f0&&_0x4b54f0[_0x19a659(0x258)]>0x0?_0x37a9e7=_0x19a659(0x1b4)+_0xbc91c8:_0x37a9e7=_0x19a659(0x1b4)+_0xbc91c8,_0x37a9e7;}router[a0_0x39be50(0x1c7)](a0_0x39be50(0x2db),auth,async(_0x5ede4c,_0x547d90)=>{var _0x11219f=a0_0x39be50;try{const {username:_0x37beda,email:_0x2b8be7,role:_0x3e09e3}=_0x5ede4c['user'],_0x502dd3=_0x5ede4c[_0x11219f(0x206)],_0x181b7d=await profile['findOne']({'email':_0x502dd3[_0x11219f(0x1b1)]}),_0x219f52=await master_shop[_0x11219f(0x24e)](),_0x2a90a6=await staff[_0x11219f(0x264)]({'email':_0x502dd3['email']}),_0xdf17b5=await suppliers[_0x11219f(0x24e)]({});let _0x4cb94e;if(_0x502dd3[_0x11219f(0x2e0)]==_0x11219f(0x1f3)){const _0x47e934=await staff[_0x11219f(0x264)]({'email':_0x502dd3[_0x11219f(0x1b1)]});_0x4cb94e=await warehouse[_0x11219f(0x262)]([{'$match':{'status':_0x11219f(0x2c6),'name':_0x47e934[_0x11219f(0x2ba)]}},{'$group':{'_id':_0x11219f(0x2b1),'name':{'$first':'$name'}}}]);}else _0x4cb94e=await warehouse[_0x11219f(0x262)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x11219f(0x2b1),'name':{'$first':_0x11219f(0x2b1)}}}]);const _0x2458df=await product[_0x11219f(0x24e)]({}),_0x1711c5=await warehouse['find']({'status':'Enabled'}),_0x2aa189=await purchases_finished[_0x11219f(0x24e)]({}),_0x48bc1b=_0x2aa189['length']+0x1,_0x370037=_0x11219f(0x1b4)+_0x48bc1b[_0x11219f(0x222)]()[_0x11219f(0x20a)](0x5,'0');var _0x3faa81=[_0x11219f(0x1d7),_0x11219f(0x217)];if(_0x219f52[0x0][_0x11219f(0x1b8)]=='English\x20(US)')var _0x1c19ca=users[_0x11219f(0x208)];else{if(_0x219f52[0x0][_0x11219f(0x1b8)]=='Hindi')var _0x1c19ca=users[_0x11219f(0x261)];else{if(_0x219f52[0x0][_0x11219f(0x1b8)]==_0x11219f(0x1ef))var _0x1c19ca=users[_0x11219f(0x1ef)];else{if(_0x219f52[0x0]['language']=='Spanish')var _0x1c19ca=users[_0x11219f(0x23d)];else{if(_0x219f52[0x0]['language']=='French')var _0x1c19ca=users[_0x11219f(0x2aa)];else{if(_0x219f52[0x0][_0x11219f(0x1b8)]=='Portuguese\x20(BR)')var _0x1c19ca=users[_0x11219f(0x22b)];else{if(_0x219f52[0x0][_0x11219f(0x1b8)]==_0x11219f(0x1ba))var _0x1c19ca=users['Chinese'];else{if(_0x219f52[0x0][_0x11219f(0x1b8)]==_0x11219f(0x254))var _0x1c19ca=users[_0x11219f(0x25e)];}}}}}}}const _0x48440d=getRandom8DigitNumber(),_0x24e92e=new Date(),_0xf5064b={'year':_0x11219f(0x246),'month':_0x11219f(0x25a),'day':_0x11219f(0x25a),'timeZone':'Asia/Manila'},_0x145cfc=_0x24e92e[_0x11219f(0x235)](_0x11219f(0x21c),_0xf5064b);console[_0x11219f(0x289)](_0x145cfc),_0x48440d['then'](_0x12e775=>{var _0x4faa68=_0x11219f;_0x547d90['render'](_0x4faa68(0x21f),{'success':_0x5ede4c[_0x4faa68(0x22a)](_0x4faa68(0x1e4)),'errors':_0x5ede4c[_0x4faa68(0x22a)](_0x4faa68(0x1e7)),'role':_0x502dd3,'profile':_0x181b7d,'suppliers':_0xdf17b5,'warehouse':_0x4cb94e,'product':_0x2458df,'invoice':_0x12e775,'master_shop':_0x219f52,'language':_0x1c19ca,'find_data':_0x1711c5,'rooms_data':_0x3faa81,'formattedDate':_0x145cfc});})['catch'](_0x3dd681=>{var _0x4f52e5=_0x11219f;_0x5ede4c[_0x4f52e5(0x22a)](_0x4f52e5(0x1e7),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x547d90[_0x4f52e5(0x2b6)](_0x4f52e5(0x2da));});}catch(_0x55601d){console[_0x11219f(0x289)](_0x55601d);}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x27f),auth,async(_0x214e78,_0x499002)=>{var _0x2466d3=a0_0x39be50;try{const {username:_0x11112a,email:_0x1c323d,role:_0x17a48d}=_0x214e78['user'],_0xcde2b8=_0x214e78[_0x2466d3(0x206)],_0x3e7796=await profile[_0x2466d3(0x264)]({'email':_0xcde2b8[_0x2466d3(0x1b1)]}),_0x39a5c4=await master_shop['find'](),_0x26e5f3=await staff['findOne']({'email':_0xcde2b8['email']}),_0x3dac4f=await suppliers['find']({});let _0x444921;if(_0xcde2b8[_0x2466d3(0x2e0)]==_0x2466d3(0x1f3)){const _0x5e169c=await staff['findOne']({'email':_0xcde2b8[_0x2466d3(0x1b1)]});_0x444921=await warehouse['aggregate']([{'$match':{'status':_0x2466d3(0x2c6),'name':_0x5e169c[_0x2466d3(0x2ba)]}},{'$group':{'_id':_0x2466d3(0x2b1),'name':{'$first':_0x2466d3(0x2b1)}}}]);}else _0x444921=await warehouse['aggregate']([{'$match':{'status':_0x2466d3(0x2c6)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1a5b91=await product[_0x2466d3(0x24e)]({}),_0x1fa626=await warehouse[_0x2466d3(0x24e)]({'status':_0x2466d3(0x2c6)}),_0xefd949=await purchases_finished[_0x2466d3(0x24e)]({}),_0xb894e0=_0xefd949['length']+0x1,_0x1edbb4=_0x2466d3(0x1b4)+_0xb894e0[_0x2466d3(0x222)]()[_0x2466d3(0x20a)](0x5,'0');var _0x370111=[_0x2466d3(0x1d7),_0x2466d3(0x217)];if(_0x39a5c4[0x0][_0x2466d3(0x1b8)]==_0x2466d3(0x1b3))var _0x2d7258=users['English'];else{if(_0x39a5c4[0x0]['language']==_0x2466d3(0x261))var _0x2d7258=users[_0x2466d3(0x261)];else{if(_0x39a5c4[0x0][_0x2466d3(0x1b8)]==_0x2466d3(0x1ef))var _0x2d7258=users[_0x2466d3(0x1ef)];else{if(_0x39a5c4[0x0][_0x2466d3(0x1b8)]==_0x2466d3(0x23d))var _0x2d7258=users[_0x2466d3(0x23d)];else{if(_0x39a5c4[0x0][_0x2466d3(0x1b8)]==_0x2466d3(0x2aa))var _0x2d7258=users[_0x2466d3(0x2aa)];else{if(_0x39a5c4[0x0]['language']==_0x2466d3(0x2a3))var _0x2d7258=users[_0x2466d3(0x22b)];else{if(_0x39a5c4[0x0][_0x2466d3(0x1b8)]==_0x2466d3(0x1ba))var _0x2d7258=users[_0x2466d3(0x1ba)];else{if(_0x39a5c4[0x0][_0x2466d3(0x1b8)]==_0x2466d3(0x254))var _0x2d7258=users[_0x2466d3(0x25e)];}}}}}}}const _0x52fa91=getRandom8DigitNumber();_0x52fa91[_0x2466d3(0x20b)](_0x4f9800=>{var _0x3b6233=_0x2466d3;_0x499002[_0x3b6233(0x28c)](_0x3b6233(0x28a),{'success':_0x214e78[_0x3b6233(0x22a)](_0x3b6233(0x1e4)),'errors':_0x214e78[_0x3b6233(0x22a)](_0x3b6233(0x1e7)),'role':_0xcde2b8,'profile':_0x3e7796,'suppliers':_0x3dac4f,'warehouse':_0x444921,'product':_0x1a5b91,'invoice':_0x4f9800,'master_shop':_0x39a5c4,'language':_0x2d7258,'find_data':_0x1fa626,'rooms_data':_0x370111});})['catch'](_0x451926=>{var _0x60f8fd=_0x2466d3;_0x214e78[_0x60f8fd(0x22a)](_0x60f8fd(0x1e7),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x499002['redirect'](_0x60f8fd(0x2da));});}catch(_0x2a0c58){console['log'](_0x2a0c58);}}),router['get'](a0_0x39be50(0x29e),auth,async(_0x945387,_0x37a7d5)=>{var _0x460961=a0_0x39be50;try{const _0x31e66d=_0x945387[_0x460961(0x207)]['id'];console['log'](_0x31e66d);const _0x3bb543=await master_shop['find']();console[_0x460961(0x289)]('master',_0x3bb543);const _0x36b539=await product[_0x460961(0x264)]({'name':_0x31e66d});console[_0x460961(0x289)]('product',_0x36b539),_0x37a7d5[_0x460961(0x1df)](0xc8)['json']({'product_data':_0x36b539,'master':_0x3bb543});}catch(_0x3c4bc0){console['log']('add_purchases\x20error',_0x3c4bc0);}}),router['post']('/view/add_purchases',auth,async(_0x5bdd81,_0x25a9e1)=>{var _0x33be93=a0_0x39be50;try{const {invoice:_0x5d1c3d,date:_0x833f70,warehouse_name:_0x472f13,prod_name:_0x2cb2ad,note:_0x138176,due_amount:_0x28de93,Room_name:_0x20e4dc,PO_number:_0x21bd0f,SCRN:_0x4ad88d,ReqBy:_0x1b5c7d,dateofreq:_0x31d92f,suppliers:_0xe69d83,typeservicesData:_0x390e58,van:_0x298928,typevehicle:_0x32e3bf,driver:_0x3b960f,plate:_0x1a5503,DRSI:_0x1195c6,TSU:_0x3e1687,TFU:_0x43937c,JO_number:_0x241ed2,type_of_products:_0x5c493f}=_0x5bdd81[_0x33be93(0x268)];if(typeof _0x2cb2ad==_0x33be93(0x1f6))var _0x423640=[_0x5bdd81['body'][_0x33be93(0x27c)]],_0x589ae4=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1d8)]],_0x639e7a=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1e0)]],_0x3280c3=[_0x5bdd81[_0x33be93(0x268)]['prod_primunit']],_0x450199=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x23f)]],_0x202184=[_0x5bdd81[_0x33be93(0x268)]['prod_level']],_0x43a454=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x2d0)]],_0x53c247=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x278)]],_0x3de221=[_0x5bdd81['body']['MaxStocks_data']],_0x3d72d4=[_0x5bdd81[_0x33be93(0x268)]['batch_code']],_0x3870fc=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x2f0)]],_0x282222=[_0x5bdd81['body'][_0x33be93(0x2ef)]],_0x24e258=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1be)]],_0x146b62=[_0x5bdd81['body']['prod_cat']],_0x64344b=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x293)]],_0x4c23d0=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1e9)]],_0x2fe2b5=[_0x5bdd81[_0x33be93(0x268)]['uuid']],_0x1a1bfd=[_0x5bdd81[_0x33be93(0x268)]['sales_data_cateory']],_0x4ee9c1=[_0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1c1)]];else var _0x423640=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x27c)]],_0x589ae4=[..._0x5bdd81['body'][_0x33be93(0x1d8)]],_0x639e7a=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1e0)]],_0x3280c3=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1c6)]],_0x450199=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x23f)]],_0x202184=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x223)]],_0x43a454=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x2d0)]],_0x53c247=[..._0x5bdd81[_0x33be93(0x268)]['secondary_code']],_0x3de221=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x24d)]],_0x3d72d4=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x2d2)]],_0x3870fc=[..._0x5bdd81[_0x33be93(0x268)]['expiry_date']],_0x282222=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x2ef)]],_0x24e258=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1be)]],_0x146b62=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x234)]],_0x64344b=[..._0x5bdd81['body'][_0x33be93(0x293)]],_0x4c23d0=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x1e9)]],_0x2fe2b5=[..._0x5bdd81[_0x33be93(0x268)]['uuid']],_0x1a1bfd=[..._0x5bdd81[_0x33be93(0x268)][_0x33be93(0x2be)]],_0x4ee9c1=[..._0x5bdd81[_0x33be93(0x268)]['product_id']];const _0x4c55e8=_0x423640[_0x33be93(0x1c2)](_0x197e6d=>{return _0x197e6d={'product_name':_0x197e6d};});_0x4ee9c1[_0x33be93(0x1fa)]((_0x3620fc,_0x2019cb)=>{var _0x24a5d1=_0x33be93;_0x4c55e8[_0x2019cb][_0x24a5d1(0x1c1)]=_0x3620fc,_0x4c55e8[_0x2019cb][_0x24a5d1(0x2b2)]=_0x833f70;}),_0x1a1bfd['forEach']((_0x5b67c6,_0x6bffcd)=>{var _0x2af8b1=_0x33be93;_0x4c55e8[_0x6bffcd][_0x2af8b1(0x2ee)]=_0x5b67c6;}),_0x589ae4['forEach']((_0x54664d,_0x285d29)=>{var _0x4328fc=_0x33be93;_0x4c55e8[_0x285d29][_0x4328fc(0x230)]=_0x54664d;}),_0x2fe2b5['forEach']((_0x20e492,_0x336843)=>{_0x4c55e8[_0x336843]['uuid']=_0x20e492;}),_0x639e7a['forEach']((_0x4a5f9b,_0x1eaac1)=>{var _0x4114db=_0x33be93;_0x4c55e8[_0x1eaac1]['quantity']=Math[_0x4114db(0x1ee)](_0x4a5f9b);}),_0x3280c3[_0x33be93(0x1fa)]((_0xecdff1,_0x2828fe)=>{var _0x163417=_0x33be93;_0x4c55e8[_0x2828fe][_0x163417(0x245)]=_0xecdff1;}),_0x450199[_0x33be93(0x1fa)]((_0xb6a91,_0x5ee953)=>{var _0x20d9ea=_0x33be93;_0x4c55e8[_0x5ee953][_0x20d9ea(0x285)]=_0xb6a91;}),_0x43a454[_0x33be93(0x1fa)]((_0xfa2377,_0x1ef369)=>{var _0x556ef2=_0x33be93;_0x4c55e8[_0x1ef369][_0x556ef2(0x2d0)]=_0xfa2377;}),_0x53c247[_0x33be93(0x1fa)]((_0x5a121b,_0x138fd4)=>{var _0x2ed285=_0x33be93;_0x4c55e8[_0x138fd4][_0x2ed285(0x278)]=_0x5a121b;}),_0x3de221[_0x33be93(0x1fa)]((_0x664637,_0x312de4)=>{var _0x2f6f6e=_0x33be93;_0x4c55e8[_0x312de4][_0x2f6f6e(0x2bd)]=_0x664637;}),_0x3d72d4[_0x33be93(0x1fa)]((_0x54d228,_0x39886c)=>{var _0x3bbc03=_0x33be93;_0x4c55e8[_0x39886c][_0x3bbc03(0x2d2)]=_0x54d228;}),_0x3870fc[_0x33be93(0x1fa)]((_0x153a16,_0x3267c2)=>{var _0x1e57b3=_0x33be93;_0x4c55e8[_0x3267c2][_0x1e57b3(0x2f0)]=_0x153a16;}),_0x282222['forEach']((_0x2eb142,_0x10011f)=>{var _0x138242=_0x33be93;_0x4c55e8[_0x10011f][_0x138242(0x263)]=_0x2eb142;}),_0x24e258[_0x33be93(0x1fa)]((_0x382ae7,_0x548c5a)=>{var _0x66ffc6=_0x33be93;_0x4c55e8[_0x548c5a][_0x66ffc6(0x238)]=_0x382ae7;}),_0x146b62[_0x33be93(0x1fa)]((_0x2ba846,_0x4f1280)=>{var _0x1e5674=_0x33be93;_0x4c55e8[_0x4f1280][_0x1e5674(0x233)]=_0x2ba846;}),_0x64344b[_0x33be93(0x1fa)]((_0x3c1fc8,_0xe83374)=>{var _0x573c98=_0x33be93;_0x4c55e8[_0xe83374][_0x573c98(0x1b5)]=_0x3c1fc8;}),_0x4c23d0['forEach']((_0x25dc3d,_0x502f3a)=>{var _0x24ee03=_0x33be93;_0x4c55e8[_0x502f3a][_0x24ee03(0x1e9)]=_0x25dc3d;});const _0x2344ca=new invoice_for_incoming();await _0x2344ca['save']();for(let _0x3b9ad6=0x0;_0x3b9ad6<=_0x64344b['length']-0x1;_0x3b9ad6++){_0x4c55e8[_0x3b9ad6][_0x33be93(0x2a7)]=_0x33be93(0x2b0)+_0x2344ca[_0x33be93(0x253)][_0x33be93(0x222)]()['padStart'](0x8,'0');}const _0x50ecdb=await warehouse_validation_setup[_0x33be93(0x262)]([{'$match':{'warehouse_name':_0x472f13}}]);let _0x26f3f3=[];for(let _0x503431=0x0;_0x503431<=_0x4c55e8[_0x33be93(0x258)]-0x1;_0x503431++){const _0x302141=_0x4c55e8[_0x503431];for(let _0x28e41d=0x0;_0x28e41d<=_0x50ecdb[_0x33be93(0x258)]-0x1;_0x28e41d++){const _0x1176e5=_0x50ecdb[_0x28e41d];for(let _0x4927c5=0x0;_0x4927c5<=_0x1176e5[_0x33be93(0x269)]['length']-0x1;_0x4927c5++){const _0x3a7951=_0x1176e5[_0x33be93(0x269)][_0x4927c5];if(_0x3a7951[_0x33be93(0x230)]===_0x302141[_0x33be93(0x230)]){let _0x2d45f3=_0x302141[_0x33be93(0x251)];const _0x59390a=await warehouse[_0x33be93(0x262)]([{'$match':{'name':_0x472f13,'room':_0x1176e5[_0x33be93(0x275)]}},{'$unwind':_0x33be93(0x1bc)},{'$match':{'level':_0x3a7951[_0x33be93(0x288)],'bay':_0x3a7951[_0x33be93(0x2f4)]}}]);if(_0x59390a[_0x33be93(0x258)]==0x0){for(let _0x5da600=0x0;_0x5da600<=_0x1176e5[_0x33be93(0x269)][_0x33be93(0x258)]-0x1&&_0x2d45f3>0x0;_0x5da600++){const _0x4c071d=_0x1176e5[_0x33be93(0x269)][_0x5da600];if(_0x302141[_0x33be93(0x230)]===_0x4c071d['product_code']){_0x26f3f3[_0x5da600]={};const _0x3b4dd0=parseInt(_0x4c071d[_0x33be93(0x21a)]),_0x39ad25=0x0;let _0xc0833e=_0x3b4dd0-_0x39ad25,_0xd46408=Math[_0x33be93(0x1da)](_0x2d45f3,_0xc0833e);console[_0x33be93(0x289)](_0x33be93(0x1dd)+_0xd46408+_0x33be93(0x272)+_0x1176e5['warehouse_name']+_0x33be93(0x28b)+_0x1176e5['room']+_0x33be93(0x259)+_0x4c071d[_0x33be93(0x288)]+_0x33be93(0x2de)+_0x4c071d[_0x33be93(0x2f4)]),_0x26f3f3[_0x5da600]['product_name']=_0x302141['product_name'],_0x26f3f3[_0x5da600][_0x33be93(0x230)]=_0x302141['product_code'],_0x26f3f3[_0x5da600][_0x33be93(0x1c1)]=_0x302141[_0x33be93(0x1c1)],_0x26f3f3[_0x5da600][_0x33be93(0x2b2)]=_0x302141['date_recieved'],_0x26f3f3[_0x5da600][_0x33be93(0x2ee)]=_0x302141[_0x33be93(0x2ee)],_0x26f3f3[_0x5da600][_0x33be93(0x22f)]=_0x302141[_0x33be93(0x22f)],_0x26f3f3[_0x5da600][_0x33be93(0x251)]=_0xd46408,_0x26f3f3[_0x5da600][_0x33be93(0x245)]=_0x302141[_0x33be93(0x245)],_0x26f3f3[_0x5da600][_0x33be93(0x285)]=_0x302141[_0x33be93(0x285)],_0x26f3f3[_0x5da600]['primary_code']=_0x302141[_0x33be93(0x2d0)],_0x26f3f3[_0x5da600][_0x33be93(0x278)]=_0x302141[_0x33be93(0x278)],_0x26f3f3[_0x5da600][_0x33be93(0x2bd)]=_0x302141['maxStocks'],_0x26f3f3[_0x5da600][_0x33be93(0x2d2)]=_0x302141['batch_code'],_0x26f3f3[_0x5da600][_0x33be93(0x2f0)]=_0x302141[_0x33be93(0x2f0)],_0x26f3f3[_0x5da600][_0x33be93(0x263)]=_0x302141[_0x33be93(0x263)],_0x26f3f3[_0x5da600][_0x33be93(0x238)]=_0x302141[_0x33be93(0x238)],_0x26f3f3[_0x5da600][_0x33be93(0x233)]=_0x302141[_0x33be93(0x233)],_0x26f3f3[_0x5da600][_0x33be93(0x2a7)]=_0x302141[_0x33be93(0x2a7)],_0x26f3f3[_0x5da600][_0x33be93(0x1e9)]=_0x302141[_0x33be93(0x1e9)],_0x26f3f3[_0x5da600]['room_name']=_0x1176e5[_0x33be93(0x275)],_0x26f3f3[_0x5da600][_0x33be93(0x1c3)]=_0x4c071d[_0x33be93(0x288)],_0x26f3f3[_0x5da600][_0x33be93(0x288)]=_0x4c071d['bin'],_0x2d45f3-=_0xd46408;if(_0x2d45f3<=0x0)break;}}if(_0x2d45f3<=0x0)break;_0x2d45f3>0x0&&console[_0x33be93(0x289)](_0x33be93(0x2c8)+_0x2d45f3+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');}}}}}const _0x44275f=_0x26f3f3[_0x33be93(0x23b)]((_0x576554,_0x91d3fc)=>{if(_0x91d3fc>0x0)return{'item':_0x576554};}),_0x572c8a=_0x44275f['filter'](_0x1a7833=>_0x1a7833['quantity']!=='0'&&_0x1a7833[_0x33be93(0x251)]!==''),_0x55aa4a=new purchases_finished({'invoice':_0x33be93(0x2b0)+_0x2344ca[_0x33be93(0x253)][_0x33be93(0x222)]()['padStart'](0x8,'0'),'suppliers':_0xe69d83,'date':_0x833f70,'warehouse_name':_0x472f13,'product':_0x572c8a,'note':_0x138176,'due_amount':_0x28de93,'room':_0x20e4dc,'POnumber':_0x21bd0f,'SCRN':_0x4ad88d,'JO_number':_0x241ed2,'ReqBy':_0x1b5c7d,'dateofreq':_0x31d92f,'typeservicesData':_0x390e58,'van':_0x298928,'typevehicle':_0x32e3bf,'driver':_0x3b960f,'plate':_0x1a5503,'DRSI':_0x1195c6,'TSU':_0x3e1687,'TFU':_0x43937c,'typeOfProducts':_0x5c493f}),_0x1d07f4=await _0x55aa4a['save'](),_0x4bf7a6=await purchases_finished['findOne']({'_id':_0x1d07f4['_id'][_0x33be93(0x24c)]()});_0x5bdd81[_0x33be93(0x22a)](_0x33be93(0x1e4),'purchase\x20data\x20add\x20successfully'),_0x25a9e1[_0x33be93(0x2b6)](_0x33be93(0x2e9)+_0x4bf7a6['_id'][_0x33be93(0x24c)]());}catch(_0x35a50c){console[_0x33be93(0x289)](_0x35a50c);}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x2f3),auth,async(_0x1f4215,_0x285f34)=>{var _0x4316c5=a0_0x39be50;try{const {username:_0x1b41a2,email:_0x4eb017,role:_0xf513b0}=_0x1f4215[_0x4316c5(0x206)],_0x1d8cdb=_0x1f4215[_0x4316c5(0x206)],_0x336ca6=_0x1f4215[_0x4316c5(0x207)]['id'],_0x167904=await profile[_0x4316c5(0x264)]({'email':_0x1d8cdb[_0x4316c5(0x1b1)]}),_0x4fb95=await master_shop[_0x4316c5(0x24e)](),_0x5ae155=await staff[_0x4316c5(0x264)]({'email':_0x1d8cdb[_0x4316c5(0x1b1)]}),_0x3ca6d0=await suppliers[_0x4316c5(0x24e)]({});let _0x9c041a;if(_0x1d8cdb[_0x4316c5(0x2e0)]=='staff'){const _0x3fd68e=await staff[_0x4316c5(0x264)]({'email':_0x1d8cdb[_0x4316c5(0x1b1)]});_0x9c041a=await warehouse[_0x4316c5(0x262)]([{'$match':{'status':_0x4316c5(0x2c6),'name':_0x3fd68e[_0x4316c5(0x2ba)]}},{'$group':{'_id':_0x4316c5(0x2b1),'name':{'$first':_0x4316c5(0x2b1)}}}]);}else _0x9c041a=await warehouse[_0x4316c5(0x262)]([{'$match':{'status':_0x4316c5(0x2c6)}},{'$group':{'_id':_0x4316c5(0x2b1),'name':{'$first':_0x4316c5(0x2b1)}}}]);const _0xa8f5ad=await purchases_finished['findById'](_0x336ca6);if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x1b3))var _0x54ee3e=users[_0x4316c5(0x208)];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x261))var _0x54ee3e=users['Hindi'];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x1ef))var _0x54ee3e=users[_0x4316c5(0x1ef)];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]=='Spanish')var _0x54ee3e=users[_0x4316c5(0x23d)];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x2aa))var _0x54ee3e=users[_0x4316c5(0x2aa)];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x2a3))var _0x54ee3e=users['Portuguese'];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x1ba))var _0x54ee3e=users[_0x4316c5(0x1ba)];else{if(_0x4fb95[0x0][_0x4316c5(0x1b8)]==_0x4316c5(0x254))var _0x54ee3e=users[_0x4316c5(0x25e)];}}}}}}}_0x285f34[_0x4316c5(0x28c)](_0x4316c5(0x1e2),{'success':_0x1f4215[_0x4316c5(0x22a)](_0x4316c5(0x1e4)),'errors':_0x1f4215['flash'](_0x4316c5(0x1e7)),'role':_0x1d8cdb,'profile':_0x167904,'suppliers':_0x3ca6d0,'warehouse':_0x9c041a,'master_shop':_0x4fb95,'language':_0x54ee3e,'purchases_data':_0xa8f5ad});}catch(_0x472991){console[_0x4316c5(0x289)](_0x472991);}});async function get_warehouse_data(_0x1a6add,_0x209c6f){var _0x2026b3=a0_0x39be50;try{const _0x221d76=await warehouse_temporary['findOne']({'name':_0x1a6add,'room':_0x209c6f});if(!_0x221d76){const _0x3015e7=new warehouse_temporary({'name':_0x1a6add,'address':_0x1a6add,'status':_0x2026b3(0x2c6),'room':_0x209c6f,'isStaging':'false'});return await _0x3015e7[_0x2026b3(0x247)](),_0x3015e7;}else return _0x221d76;}catch(_0x5a31bf){console[_0x2026b3(0x1c4)](_0x2026b3(0x1d6),_0x5a31bf);throw _0x5a31bf;}}router[a0_0x39be50(0x28d)](a0_0x39be50(0x2f3),auth,async(_0x3745d3,_0x505eff)=>{var _0x2c156b=a0_0x39be50;try{const _0x4ab60f=_0x3745d3[_0x2c156b(0x207)]['id'],_0x2a2e8a=await purchases_finished[_0x2c156b(0x26b)](_0x4ab60f);let _0x29ae8c=[];_0x2a2e8a[_0x2c156b(0x270)][_0x2c156b(0x1fa)]((_0x5e7d34,_0x9d364f)=>{var _0x28ada1=_0x2c156b;_0x29ae8c[_0x9d364f]={},_0x29ae8c[_0x9d364f][_0x28ada1(0x2ba)]=_0x2a2e8a[_0x28ada1(0x284)],_0x29ae8c[_0x9d364f]['product_id']=_0x5e7d34['product_id'],_0x29ae8c[_0x9d364f][_0x28ada1(0x2cf)]=_0x5e7d34[_0x28ada1(0x2cf)],_0x29ae8c[_0x9d364f][_0x28ada1(0x230)]=_0x5e7d34[_0x28ada1(0x230)],_0x29ae8c[_0x9d364f][_0x28ada1(0x251)]=_0x5e7d34['quantity'],_0x29ae8c[_0x9d364f][_0x28ada1(0x245)]=_0x5e7d34['standard_unit'],_0x29ae8c[_0x9d364f][_0x28ada1(0x285)]=_0x5e7d34['secondary_unit'],_0x29ae8c[_0x9d364f][_0x28ada1(0x1c3)]=_0x5e7d34[_0x28ada1(0x1c3)],_0x29ae8c[_0x9d364f][_0x28ada1(0x288)]=_0x5e7d34[_0x28ada1(0x288)],_0x29ae8c[_0x9d364f]['primary_code']=_0x5e7d34[_0x28ada1(0x2d0)],_0x29ae8c[_0x9d364f][_0x28ada1(0x278)]=_0x5e7d34[_0x28ada1(0x278)],_0x29ae8c[_0x9d364f][_0x28ada1(0x2bd)]=_0x5e7d34[_0x28ada1(0x2bd)],_0x29ae8c[_0x9d364f]['batch_code']=_0x5e7d34[_0x28ada1(0x2d2)],_0x29ae8c[_0x9d364f][_0x28ada1(0x2f0)]=_0x5e7d34['expiry_date'],_0x29ae8c[_0x9d364f]['production_date']=_0x5e7d34['production_date'],_0x29ae8c[_0x9d364f][_0x28ada1(0x238)]=_0x5e7d34['maxperunit'],_0x29ae8c[_0x9d364f][_0x28ada1(0x233)]=_0x5e7d34[_0x28ada1(0x233)],_0x29ae8c[_0x9d364f][_0x28ada1(0x1b5)]=_0x5e7d34[_0x28ada1(0x1b5)],_0x29ae8c[_0x9d364f]['invoice']=_0x5e7d34['invoice'],_0x29ae8c[_0x9d364f][_0x28ada1(0x22f)]=_0x5e7d34['uuid'],_0x29ae8c[_0x9d364f][_0x28ada1(0x1e9)]=_0x5e7d34['gross_price'],_0x29ae8c[_0x9d364f][_0x28ada1(0x2ee)]=_0x5e7d34[_0x28ada1(0x2ee)],_0x29ae8c[_0x9d364f][_0x28ada1(0x2b2)]=_0x5e7d34[_0x28ada1(0x2b2)],_0x29ae8c[_0x9d364f][_0x28ada1(0x2e1)]=_0x5e7d34['_id']['valueOf']();});for(let _0x2a4646=0x0;_0x2a4646<=_0x29ae8c['length']-0x1;_0x2a4646++){const _0x3374f8=_0x29ae8c[_0x2a4646],_0x17fa4a=new warehouse_temporary(_0x3374f8);await _0x17fa4a['save']();}_0x2a2e8a['isProcess']='true',await _0x2a2e8a[_0x2c156b(0x247)](),_0x3745d3['flash']('success',_0x2c156b(0x200)),_0x505eff[_0x2c156b(0x2b6)](_0x2c156b(0x2e9)+_0x2a2e8a[_0x2c156b(0x1ff)][_0x2c156b(0x24c)]());}catch(_0xa1618c){}}),router['post'](a0_0x39be50(0x27f),auth,async(_0x59e261,_0x5f380a)=>{var _0x4a47c9=a0_0x39be50;try{const {invoice:_0x2ed010,date:_0x390b37,warehouse_name:_0x53accf,prod_name:_0x5a47e3,note:_0x10c35d,due_amount:_0x3b327a,Room_name:_0x3aecc0,PO_number:_0x5e073c,SCRN:_0x1e12ee,ReqBy:_0x2046bc,dateofreq:_0x33ca83,suppliers:_0x99a0d8,typeservicesData:_0x5731bf,van:_0x5c2bcc,typevehicle:_0x5c7f3b,driver:_0x1ae7e7,plate:_0x27e911,DRSI:_0x24d5fd,TSU:_0xf7af,TFU:_0x36668a,JO_number:_0x59134d,type_of_products:_0x2e0bde}=_0x59e261[_0x4a47c9(0x268)];if(typeof _0x5a47e3=='string')var _0x1f5ecf=[_0x59e261['body'][_0x4a47c9(0x27c)]],_0x17d2a7=[_0x59e261['body'][_0x4a47c9(0x1d8)]],_0x3b2d57=[_0x59e261['body'][_0x4a47c9(0x1e0)]],_0x490a09=[_0x59e261[_0x4a47c9(0x268)]['prod_primunit']],_0xa163f2=[_0x59e261['body']['prod_secondunit']],_0x4aa44e=[_0x59e261['body'][_0x4a47c9(0x223)]],_0x3bd4db=[_0x59e261['body']['primary_code']],_0x553b0b=[_0x59e261['body']['secondary_code']],_0x5b2013=[_0x59e261[_0x4a47c9(0x268)]['MaxStocks_data']],_0xf477ba=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x2d2)]],_0x5739a4=[_0x59e261[_0x4a47c9(0x268)]['expiry_date']],_0x2983f9=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x2ef)]],_0x413559=[_0x59e261['body'][_0x4a47c9(0x1be)]],_0x44da84=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x234)]],_0x85f3f2=[_0x59e261['body'][_0x4a47c9(0x293)]],_0x14b598=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x1e9)]],_0x149cda=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x22f)]],_0x2c98aa=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x2be)]],_0x52022b=[_0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x2b4)]];else var _0x1f5ecf=[..._0x59e261['body'][_0x4a47c9(0x27c)]],_0x17d2a7=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x1d8)]],_0x3b2d57=[..._0x59e261[_0x4a47c9(0x268)]['prod_Qty']],_0x490a09=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x1c6)]],_0xa163f2=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x23f)]],_0x4aa44e=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x223)]],_0x3bd4db=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x2d0)]],_0x553b0b=[..._0x59e261['body']['secondary_code']],_0x5b2013=[..._0x59e261[_0x4a47c9(0x268)]['MaxStocks_data']],_0xf477ba=[..._0x59e261[_0x4a47c9(0x268)]['batch_code']],_0x5739a4=[..._0x59e261[_0x4a47c9(0x268)]['expiry_date']],_0x2983f9=[..._0x59e261['body'][_0x4a47c9(0x2ef)]],_0x413559=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x1be)]],_0x44da84=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x234)]],_0x85f3f2=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x293)]],_0x14b598=[..._0x59e261[_0x4a47c9(0x268)]['gross_price']],_0x149cda=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x22f)]],_0x2c98aa=[..._0x59e261[_0x4a47c9(0x268)][_0x4a47c9(0x2be)]],_0x52022b=[..._0x59e261['body']['type_of_products_type']];const _0x5949b3=_0x1f5ecf[_0x4a47c9(0x1c2)](_0x5dcab5=>{return _0x5dcab5={'product_name':_0x5dcab5};});_0x52022b['forEach']((_0x322b1a,_0x142672)=>{var _0x2a3af6=_0x4a47c9;_0x5949b3[_0x142672][_0x2a3af6(0x205)]=_0x322b1a;}),_0x2c98aa[_0x4a47c9(0x1fa)]((_0x1fd0dd,_0x20e615)=>{var _0x5475d5=_0x4a47c9;_0x5949b3[_0x20e615][_0x5475d5(0x2ee)]=_0x1fd0dd;}),_0x17d2a7[_0x4a47c9(0x1fa)]((_0x394409,_0x3c8e21)=>{_0x5949b3[_0x3c8e21]['product_code']=_0x394409;}),_0x149cda[_0x4a47c9(0x1fa)]((_0x59d07e,_0x5e75b3)=>{var _0x2deebd=_0x4a47c9;_0x5949b3[_0x5e75b3][_0x2deebd(0x22f)]=_0x59d07e;}),_0x3b2d57[_0x4a47c9(0x1fa)]((_0x19363f,_0xa3d1be)=>{var _0x3cbd88=_0x4a47c9;_0x5949b3[_0xa3d1be][_0x3cbd88(0x251)]=Math[_0x3cbd88(0x1ee)](_0x19363f);}),_0x490a09[_0x4a47c9(0x1fa)]((_0x233354,_0x4c59a6)=>{var _0x38aad3=_0x4a47c9;_0x5949b3[_0x4c59a6][_0x38aad3(0x245)]=_0x233354;}),_0xa163f2[_0x4a47c9(0x1fa)]((_0x6462d2,_0x182ca9)=>{var _0x5a7014=_0x4a47c9;_0x5949b3[_0x182ca9][_0x5a7014(0x285)]=_0x6462d2;}),_0x4aa44e[_0x4a47c9(0x1fa)]((_0x45b5e3,_0x307f39)=>{var _0x327ac8=_0x4a47c9,_0xbf1abd=_0x45b5e3[_0x327ac8(0x1dc)](/[A-Za-z]+/)[0x0],_0xa4baa0=parseInt(_0x45b5e3['match'](/\d+/)[0x0]);_0x5949b3[_0x307f39][_0x327ac8(0x1c3)]=_0xbf1abd,_0x5949b3[_0x307f39]['bay']=_0xa4baa0;}),_0x3bd4db[_0x4a47c9(0x1fa)]((_0x130777,_0xb8c228)=>{var _0x566158=_0x4a47c9;_0x5949b3[_0xb8c228][_0x566158(0x2d0)]=_0x130777;}),_0x553b0b[_0x4a47c9(0x1fa)]((_0x51b74e,_0x5dc644)=>{var _0x5d4c12=_0x4a47c9;_0x5949b3[_0x5dc644][_0x5d4c12(0x278)]=_0x51b74e;}),_0x5b2013[_0x4a47c9(0x1fa)]((_0x1c6b89,_0x5bd403)=>{var _0x567525=_0x4a47c9;_0x5949b3[_0x5bd403][_0x567525(0x2bd)]=_0x1c6b89;}),_0xf477ba['forEach']((_0x3cf8ea,_0x4ec187)=>{var _0x553331=_0x4a47c9;_0x5949b3[_0x4ec187][_0x553331(0x2d2)]=_0x3cf8ea;}),_0x5739a4[_0x4a47c9(0x1fa)]((_0x2db8fe,_0x1b0dbf)=>{_0x5949b3[_0x1b0dbf]['expiry_date']=_0x2db8fe;}),_0x2983f9[_0x4a47c9(0x1fa)]((_0x37357,_0x319cc1)=>{_0x5949b3[_0x319cc1]['production_date']=_0x37357;}),_0x413559[_0x4a47c9(0x1fa)]((_0x5eef64,_0x35cc3d)=>{var _0x5a976c=_0x4a47c9;_0x5949b3[_0x35cc3d][_0x5a976c(0x238)]=_0x5eef64;}),_0x44da84[_0x4a47c9(0x1fa)]((_0x2a823c,_0x4a59b5)=>{var _0x4fc258=_0x4a47c9;_0x5949b3[_0x4a59b5][_0x4fc258(0x233)]=_0x2a823c;}),_0x85f3f2[_0x4a47c9(0x1fa)]((_0x560deb,_0x1d05f9)=>{var _0x36d735=_0x4a47c9;_0x5949b3[_0x1d05f9][_0x36d735(0x1b5)]=_0x560deb;}),_0x14b598['forEach']((_0x3b3817,_0xa303c4)=>{_0x5949b3[_0xa303c4]['gross_price']=_0x3b3817;});const _0x476a3e=new purchases_logs();await _0x476a3e[_0x4a47c9(0x247)]();for(let _0x491243=0x0;_0x491243<=_0x85f3f2['length']-0x1;_0x491243++){_0x5949b3[_0x491243][_0x4a47c9(0x2a7)]=_0x4a47c9(0x1fd)+_0x476a3e[_0x4a47c9(0x253)][_0x4a47c9(0x222)]()['padStart'](0x8,'0');}const _0xf50510=_0x5949b3[_0x4a47c9(0x23b)](_0x9b4d9f=>_0x9b4d9f[_0x4a47c9(0x251)]!=='0'&&_0x9b4d9f['quantity']!==''),_0x1d7761=new purchases_finished({'invoice':_0x4a47c9(0x1fd)+_0x476a3e[_0x4a47c9(0x253)]['toString']()[_0x4a47c9(0x20a)](0x8,'0'),'suppliers':_0x99a0d8,'date':_0x390b37,'warehouse_name':_0x53accf,'product':_0xf50510,'note':_0x10c35d,'due_amount':_0x3b327a,'room':_0x3aecc0,'POnumber':_0x5e073c,'SCRN':_0x1e12ee,'JO_number':_0x59134d,'ReqBy':_0x2046bc,'dateofreq':_0x33ca83,'typeservicesData':_0x5731bf,'van':_0x5c2bcc,'typevehicle':_0x5c7f3b,'driver':_0x1ae7e7,'plate':_0x27e911,'DRSI':_0x24d5fd,'TSU':_0xf7af,'TFU':_0x36668a,'typeOfProducts':_0x2e0bde}),_0x333359=await _0x1d7761[_0x4a47c9(0x247)](),_0x1d5958=await purchases_finished[_0x4a47c9(0x264)]({'_id':_0x333359['_id'][_0x4a47c9(0x24c)]()}),_0x4259c1=_0x1d5958['product'][_0x4a47c9(0x1c2)](async _0x16b6cc=>{var _0x2f4c21=_0x4a47c9;try{var _0x31ab93=await warehouse[_0x2f4c21(0x264)]({'name':_0x53accf,'room':_0x16b6cc['room_name']}),_0x3f075d=0x0;const _0x96d6b4=_0x31ab93[_0x2f4c21(0x2ed)][_0x2f4c21(0x1c2)](_0x2d2a59=>{var _0x188b1d=_0x2f4c21;console['log'](_0x2d2a59[_0x188b1d(0x2cf)]+'=='+_0x16b6cc[_0x188b1d(0x2cf)]+'&&'+_0x2d2a59[_0x188b1d(0x288)]+'=='+_0x16b6cc['bay']+'&&'+_0x2d2a59[_0x188b1d(0x2f0)]+'=='+_0x16b6cc['expiry_date']+'&&'+_0x2d2a59[_0x188b1d(0x263)]+'=='+_0x16b6cc['production_date']+'&&'+_0x2d2a59[_0x188b1d(0x2d2)]+'=='+_0x16b6cc[_0x188b1d(0x2d2)]+'&&'+_0x2d2a59[_0x188b1d(0x2a7)]+'=='+_0x1d5958[_0x188b1d(0x2a7)]),_0x2d2a59['product_name']==_0x16b6cc['product_name']&&_0x2d2a59['bay']==_0x16b6cc[_0x188b1d(0x288)]&&_0x2d2a59[_0x188b1d(0x1c3)]==_0x16b6cc['level']&&_0x2d2a59['expiry_date']==_0x16b6cc[_0x188b1d(0x2f0)]&&_0x2d2a59[_0x188b1d(0x263)]==_0x16b6cc[_0x188b1d(0x263)]&&_0x2d2a59[_0x188b1d(0x2d2)]==_0x16b6cc[_0x188b1d(0x2d2)]&&_0x2d2a59['invoice']==_0x1d5958[_0x188b1d(0x2a7)]&&(_0x2d2a59[_0x188b1d(0x2cb)]=Math[_0x188b1d(0x1ee)](_0x2d2a59[_0x188b1d(0x2cb)])+Math[_0x188b1d(0x1ee)](_0x16b6cc[_0x188b1d(0x251)]),_0x3f075d++);});return _0x3f075d==0x0&&(_0x31ab93[_0x2f4c21(0x2ed)]=_0x31ab93[_0x2f4c21(0x2ed)]['concat']({'product_name':_0x16b6cc[_0x2f4c21(0x2cf)],'product_stock':Math[_0x2f4c21(0x1ee)](_0x16b6cc[_0x2f4c21(0x251)]),'primary_code':_0x16b6cc[_0x2f4c21(0x2d0)],'secondary_code':_0x16b6cc[_0x2f4c21(0x278)],'product_code':_0x16b6cc[_0x2f4c21(0x230)],'bay':_0x16b6cc[_0x2f4c21(0x288)],'level':_0x16b6cc[_0x2f4c21(0x1c3)],'maxProducts':_0x16b6cc[_0x2f4c21(0x2bd)],'unit':_0x16b6cc[_0x2f4c21(0x245)],'secondary_unit':_0x16b6cc[_0x2f4c21(0x285)],'expiry_date':_0x16b6cc['expiry_date'],'production_date':_0x16b6cc[_0x2f4c21(0x263)],'maxProducts':_0x16b6cc[_0x2f4c21(0x2bd)],'maxPerUnit':_0x16b6cc[_0x2f4c21(0x238)],'batch_code':_0x16b6cc[_0x2f4c21(0x2d2)],'product_cat':_0x16b6cc[_0x2f4c21(0x233)],'invoice':_0x16b6cc[_0x2f4c21(0x2a7)],'id_incoming':_0x16b6cc['_id'],'uuid':_0x16b6cc[_0x2f4c21(0x22f)],'gross_price':_0x16b6cc[_0x2f4c21(0x1e9)],'sales_category':_0x16b6cc['sales_category'],'type_products':_0x16b6cc['type_of_products']})),_0x31ab93;}catch(_0x3ece05){return console[_0x2f4c21(0x1c4)](_0x2f4c21(0x1f9),_0x3ece05),null;}});Promise[_0x4a47c9(0x1e1)](_0x4259c1)[_0x4a47c9(0x20b)](async _0x55e565=>{var _0x2f7938=_0x4a47c9;try{for(const _0x2754a3 of _0x55e565){await warehouse[_0x2f7938(0x2d5)]({'_id':_0x2754a3[_0x2f7938(0x1ff)]},{'$addToSet':{'product_details':{'$each':_0x2754a3[_0x2f7938(0x2ed)]}}});}const _0x2d727b=await master_shop[_0x2f7938(0x24e)](),_0x245fdf=await email_settings[_0x2f7938(0x264)](),_0x1fca18=await supervisor_settings[_0x2f7938(0x24e)]();var _0x5bf68e=_0x1d5958[_0x2f7938(0x270)],_0x25d1c6='',_0x4c170a;for(_0x4c170a in _0x5bf68e){var _0x335c66='FG';_0x1d5958[_0x2f7938(0x284)]==_0x2f7938(0x29f)&&(_0x335c66='DG'),_0x25d1c6+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5bf68e[_0x4c170a][_0x2f7938(0x2cf)]+'</td>'+_0x2f7938(0x210)+_0x5bf68e[_0x4c170a][_0x2f7938(0x230)]+_0x2f7938(0x1fb)+_0x2f7938(0x210)+_0x5bf68e[_0x4c170a][_0x2f7938(0x251)]+_0x2f7938(0x1fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5bf68e[_0x4c170a][_0x2f7938(0x245)]+_0x2f7938(0x1fb)+_0x2f7938(0x210)+_0x5bf68e[_0x4c170a][_0x2f7938(0x285)]+'</td>'+_0x2f7938(0x210)+_0x1d5958[_0x2f7938(0x284)]+'</td>'+_0x2f7938(0x210)+_0x5bf68e[_0x4c170a]['room_name']+_0x2f7938(0x1fb)+_0x2f7938(0x210)+_0x335c66+_0x5bf68e[_0x4c170a]['bay']+'</td>',_0x2f7938(0x2a0);}let _0xa8e6f8=nodemailer[_0x2f7938(0x2a5)]({'host':_0x245fdf[_0x2f7938(0x267)],'port':Number(_0x245fdf[_0x2f7938(0x266)]),'secure':![],'auth':{'user':_0x245fdf[_0x2f7938(0x1b1)],'pass':_0x245fdf[_0x2f7938(0x1db)]}}),_0x3351a2={'from':_0x245fdf['email'],'to':_0x1fca18[0x0]['FGSEmail'],'subject':_0x2f7938(0x1f7),'attachments':[{'filename':_0x2f7938(0x2c4),'path':__dirname+_0x2f7938(0x209)+_0x2f7938(0x2d6)+_0x2d727b[0x0]['image'],'cid':_0x2f7938(0x226)}],'html':_0x2f7938(0x2f2)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x2f7938(0x1d0)+_0x2f7938(0x1e3)+_0x2f7938(0x292)+'</div>'+_0x2f7938(0x1e3)+_0x2f7938(0x276)+_0x2d727b[0x0][_0x2f7938(0x232)]+'\x20</h2>'+_0x2f7938(0x1e8)+'</div>'+_0x2f7938(0x1ca)+'<div>'+_0x2f7938(0x2dc)+_0x2f7938(0x2e7)+_0x1d5958[_0x2f7938(0x2a7)]+'\x20'+_0x2f7938(0x227)+_0x2f7938(0x2d8)+_0x1d5958[_0x2f7938(0x20e)]+'\x20'+'</span>'+_0x2f7938(0x1c9)+'</div>'+_0x2f7938(0x1ed)+_0x2f7938(0x290)+_0x2f7938(0x286)+_0x2f7938(0x2df)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x2f7938(0x1cd)+_0x2f7938(0x202)+_0x2f7938(0x1bb)+_0x2f7938(0x1c0)+_0x2f7938(0x283)+_0x2f7938(0x212)+_0x2f7938(0x2a0)+_0x2f7938(0x297)+_0x2f7938(0x25d)+'\x20'+_0x25d1c6+'\x20'+_0x2f7938(0x231)+_0x2f7938(0x1ce)+_0x2f7938(0x1e3)+'<strong>\x20Regards\x20</strong>'+_0x2f7938(0x29d)+_0x2d727b[0x0][_0x2f7938(0x232)]+_0x2f7938(0x1c9)+'</div>'+'</div>'+_0x2f7938(0x2b5)};_0xa8e6f8[_0x2f7938(0x1f4)](_0x3351a2,function(_0xc6ca87,_0x2693bf){var _0x3b0e33=_0x2f7938;_0xc6ca87?(console[_0x3b0e33(0x289)](_0xc6ca87),console[_0x3b0e33(0x289)](_0x3b0e33(0x219))):console[_0x3b0e33(0x289)](_0x3b0e33(0x256));});}catch(_0x39940c){console[_0x2f7938(0x1c4)](_0x39940c),_0x5f380a[_0x2f7938(0x1df)](0x1f4)['json']({'error':_0x2f7938(0x2d1),'message':_0x39940c[_0x2f7938(0x2a1)]});}})[_0x4a47c9(0x203)](_0x562ee6=>{var _0x33a2c3=_0x4a47c9;console[_0x33a2c3(0x1c4)](_0x562ee6);}),_0x59e261[_0x4a47c9(0x22a)]('success',_0x4a47c9(0x1fe)),_0x5f380a[_0x4a47c9(0x2b6)]('/all_purchases_finished/preview/'+_0x1d5958['_id']['valueOf']());}catch(_0x180377){console[_0x4a47c9(0x289)](_0x180377);}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x287),auth,async(_0x3f4e53,_0x54c720)=>{var _0x55395d=a0_0x39be50;try{const {username:_0x1b80d5,email:_0x68b269,role:_0x35323b}=_0x3f4e53[_0x55395d(0x206)],_0x97a864=_0x3f4e53[_0x55395d(0x206)],_0x3b8601=await profile[_0x55395d(0x264)]({'email':_0x97a864['email']}),_0x11cf9a=await master_shop['find'](),_0x6329dd=_0x3f4e53[_0x55395d(0x207)]['id'],_0x1fc4d5=await purchases_finished[_0x55395d(0x26b)](_0x6329dd),_0x1d98dc=await suppliers[_0x55395d(0x24e)]({});let _0x12f823;if(_0x97a864[_0x55395d(0x2e0)]=='staff'){const _0xca5599=await staff[_0x55395d(0x264)]({'email':_0x97a864[_0x55395d(0x1b1)]});_0x12f823=await warehouse['find']({'status':_0x55395d(0x2c6),'name':_0xca5599[_0x55395d(0x2ba)],'warehouse_category':_0x55395d(0x1bf)});}else _0x12f823=await warehouse[_0x55395d(0x262)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x55395d(0x2b1),'name':{'$first':'$name'}}}]);const _0x1f3688=await product[_0x55395d(0x24e)]({}),_0x323824=BayBinSelected(_0x1fc4d5['warehouse_name'],_0x1fc4d5[_0x55395d(0x275)]);let _0x1459b1=new Date(_0x1fc4d5[_0x55395d(0x2f0)]),_0x5c444c=('0'+_0x1459b1[_0x55395d(0x2ec)]())[_0x55395d(0x2c1)](-0x2),_0x5512e9=('0'+(_0x1459b1[_0x55395d(0x27b)]()+0x1))[_0x55395d(0x2c1)](-0x2),_0x15b4c7=_0x1459b1[_0x55395d(0x1c8)](),_0x4306ef=_0x15b4c7+'-'+_0x5512e9+'-'+_0x5c444c;if(_0x11cf9a[0x0][_0x55395d(0x1b8)]==_0x55395d(0x1b3)){var _0x18e523=users[_0x55395d(0x208)];console['log'](_0x18e523);}else{if(_0x11cf9a[0x0][_0x55395d(0x1b8)]==_0x55395d(0x261))var _0x18e523=users[_0x55395d(0x261)];else{if(_0x11cf9a[0x0]['language']=='German')var _0x18e523=users[_0x55395d(0x1ef)];else{if(_0x11cf9a[0x0][_0x55395d(0x1b8)]==_0x55395d(0x23d))var _0x18e523=users[_0x55395d(0x23d)];else{if(_0x11cf9a[0x0][_0x55395d(0x1b8)]==_0x55395d(0x2aa))var _0x18e523=users[_0x55395d(0x2aa)];else{if(_0x11cf9a[0x0][_0x55395d(0x1b8)]==_0x55395d(0x2a3))var _0x18e523=users[_0x55395d(0x22b)];else{if(_0x11cf9a[0x0][_0x55395d(0x1b8)]=='Chinese')var _0x18e523=users[_0x55395d(0x1ba)];else{if(_0x11cf9a[0x0][_0x55395d(0x1b8)]==_0x55395d(0x254))var _0x18e523=users[_0x55395d(0x25e)];}}}}}}}_0x54c720[_0x55395d(0x28c)](_0x55395d(0x2a2),{'success':_0x3f4e53['flash'](_0x55395d(0x1e4)),'errors':_0x3f4e53[_0x55395d(0x22a)](_0x55395d(0x1e7)),'role':_0x97a864,'profile':_0x3b8601,'purchases':_0x1fc4d5,'suppliers':_0x1d98dc,'warehouse':_0x12f823,'product':_0x1f3688,'master_shop':_0x11cf9a,'language':_0x18e523,'ed_fullDate':_0x4306ef,'dataSelected':_0x323824});}catch(_0x3c5d9d){console[_0x55395d(0x289)](_0x3c5d9d);}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x225),auth,async(_0x21ede1,_0x3a5f1e)=>{var _0x1ba365=a0_0x39be50;try{const {username:_0x526d95,email:_0x4d7fc0,role:_0x3f20c9}=_0x21ede1[_0x1ba365(0x206)],_0x1a7aec=_0x21ede1[_0x1ba365(0x206)],_0x315401=await profile[_0x1ba365(0x264)]({'email':_0x1a7aec[_0x1ba365(0x1b1)]}),_0x351df2=await master_shop[_0x1ba365(0x24e)](),_0x496314=_0x21ede1[_0x1ba365(0x207)]['id'],_0x5084f6=await purchases_finished[_0x1ba365(0x26b)](_0x496314),_0x712f49=await suppliers[_0x1ba365(0x24e)]({});let _0x4a99b8;if(_0x1a7aec[_0x1ba365(0x2e0)]==_0x1ba365(0x1f3)){const _0x461c69=await staff[_0x1ba365(0x264)]({'email':_0x1a7aec[_0x1ba365(0x1b1)]});_0x4a99b8=await warehouse[_0x1ba365(0x24e)]({'status':_0x1ba365(0x2c6),'name':_0x461c69['warehouse'],'warehouse_category':_0x1ba365(0x1bf)});}else _0x4a99b8=await warehouse[_0x1ba365(0x262)]([{'$match':{'status':_0x1ba365(0x2c6),'warehouse_category':_0x1ba365(0x1bf)}},{'$group':{'_id':_0x1ba365(0x2b1),'name':{'$first':'$name'}}}]);const _0x4b787d=await product[_0x1ba365(0x24e)]({}),_0x3587e8=BayBinSelected(_0x5084f6['warehouse_name'],_0x5084f6['room']);let _0x44ea4c=new Date(_0x5084f6[_0x1ba365(0x2f0)]),_0x503572=('0'+_0x44ea4c['getDate']())[_0x1ba365(0x2c1)](-0x2),_0x53e8bc=('0'+(_0x44ea4c[_0x1ba365(0x27b)]()+0x1))[_0x1ba365(0x2c1)](-0x2),_0x36835c=_0x44ea4c[_0x1ba365(0x1c8)](),_0x3024b9=_0x36835c+'-'+_0x53e8bc+'-'+_0x503572;if(_0x351df2[0x0][_0x1ba365(0x1b8)]==_0x1ba365(0x1b3)){var _0x5c3b2b=users['English'];console[_0x1ba365(0x289)](_0x5c3b2b);}else{if(_0x351df2[0x0][_0x1ba365(0x1b8)]==_0x1ba365(0x261))var _0x5c3b2b=users['Hindi'];else{if(_0x351df2[0x0][_0x1ba365(0x1b8)]=='German')var _0x5c3b2b=users[_0x1ba365(0x1ef)];else{if(_0x351df2[0x0][_0x1ba365(0x1b8)]=='Spanish')var _0x5c3b2b=users[_0x1ba365(0x23d)];else{if(_0x351df2[0x0][_0x1ba365(0x1b8)]==_0x1ba365(0x2aa))var _0x5c3b2b=users[_0x1ba365(0x2aa)];else{if(_0x351df2[0x0][_0x1ba365(0x1b8)]==_0x1ba365(0x2a3))var _0x5c3b2b=users[_0x1ba365(0x22b)];else{if(_0x351df2[0x0][_0x1ba365(0x1b8)]=='Chinese')var _0x5c3b2b=users['Chinese'];else{if(_0x351df2[0x0]['language']==_0x1ba365(0x254))var _0x5c3b2b=users[_0x1ba365(0x25e)];}}}}}}}_0x3a5f1e[_0x1ba365(0x28c)](_0x1ba365(0x1f8),{'success':_0x21ede1['flash'](_0x1ba365(0x1e4)),'errors':_0x21ede1[_0x1ba365(0x22a)]('errors'),'role':_0x1a7aec,'profile':_0x315401,'purchases':_0x5084f6,'suppliers':_0x712f49,'warehouse':_0x4a99b8,'product':_0x4b787d,'master_shop':_0x351df2,'language':_0x5c3b2b,'ed_fullDate':_0x3024b9,'dataSelected':_0x3587e8});}catch(_0x4e0956){console[_0x1ba365(0x289)](_0x4e0956);}}),router[a0_0x39be50(0x28d)](a0_0x39be50(0x225),auth,async(_0x51886c,_0x46107c)=>{var _0xe36cd0=a0_0x39be50;try{const _0x5b0f3e=_0x51886c[_0xe36cd0(0x207)]['id'],_0x1c688f=await purchases_finished['findOne']({'_id':_0x51886c[_0xe36cd0(0x207)]['id']}),_0x424f8c=await warehouse[_0xe36cd0(0x264)]({'name':_0x1c688f['warehouse_name'],'room':_0x1c688f[_0xe36cd0(0x275)]});_0x1c688f[_0xe36cd0(0x270)]['forEach'](_0xa8663d=>{var _0x322eb4=_0xe36cd0;const _0x262336=_0x424f8c['product_details'][_0x322eb4(0x1c2)](_0x1b8d79=>{var _0x45b326=_0x322eb4;_0x1b8d79['product_name']==_0xa8663d[_0x45b326(0x2cf)]&&_0x1b8d79[_0x45b326(0x288)]==_0xa8663d[_0x45b326(0x288)]&&(_0x1b8d79[_0x45b326(0x2cb)]=parseInt(_0x1b8d79[_0x45b326(0x2cb)])-parseInt(_0xa8663d[_0x45b326(0x251)]));});}),await _0x424f8c[_0xe36cd0(0x247)]();const {invoice:_0x44cb59,suppliers:_0xb3834d,date:_0x363bc1,warehouse_name:_0x193f54,prod_name:_0x4c5cd1,prod_code:_0x31f15f,prod_qty:_0x3b5128,prod_unit:_0x7a0166,prod_secondunit:_0x20befb,prod_level:_0x16c880,prod_isle:_0x47866b,prod_pallet:_0x42fa28,note:_0x4e0449,expiry_date:_0x1bbcb1,batch_code:_0x1aeb63,paid_amount:_0xb7f7,due_amount:_0x4872f5,Room_name:_0x16fdd1,primary_code:_0x27ead1,secondary_code:_0x247ce0,PO_number:_0xb89363,JO_number:_0x33d340}=_0x51886c['body'];if(typeof _0x4c5cd1==_0xe36cd0(0x1f6))var _0x202feb=[_0x51886c[_0xe36cd0(0x268)]['prod_name']],_0x576027=[_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x1d8)]],_0x4c30c8=[_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x29a)]],_0x1d1952=[_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2ea)]],_0x431d0c=[_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x23f)]],_0x4b147e=[_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x223)]],_0x2baa7d=[_0x51886c['body'][_0xe36cd0(0x2d0)]],_0x57abda=[_0x51886c[_0xe36cd0(0x268)]['secondary_code']],_0x144703=[_0x51886c['body'][_0xe36cd0(0x24d)]],_0x5be9ea=[_0x51886c['body'][_0xe36cd0(0x2d2)]],_0x3071af=[_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2f0)]];else var _0x202feb=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x27c)]],_0x576027=[..._0x51886c[_0xe36cd0(0x268)]['prod_code']],_0x4c30c8=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x29a)]],_0x1d1952=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2ea)]],_0x431d0c=[..._0x51886c['body'][_0xe36cd0(0x23f)]],_0x4b147e=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x223)]],_0x2baa7d=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2d0)]],_0x57abda=[..._0x51886c[_0xe36cd0(0x268)]['secondary_code']],_0x144703=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x24d)]],_0x5be9ea=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2d2)]],_0x3071af=[..._0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2f0)]];const _0x5db1f5=_0x202feb['map'](_0x59e61f=>{return _0x59e61f={'product_name':_0x59e61f};});_0x576027[_0xe36cd0(0x1fa)]((_0xea0cbc,_0x4938e1)=>{var _0x7d22f4=_0xe36cd0;_0x5db1f5[_0x4938e1][_0x7d22f4(0x230)]=_0xea0cbc;}),_0x4c30c8[_0xe36cd0(0x1fa)]((_0x2deab5,_0x18c3cb)=>{var _0x56a8a4=_0xe36cd0;_0x5db1f5[_0x18c3cb][_0x56a8a4(0x251)]=_0x2deab5;}),_0x1d1952['forEach']((_0x23195a,_0x2b5ebf)=>{_0x5db1f5[_0x2b5ebf]['standard_unit']=_0x23195a;}),_0x431d0c['forEach']((_0x508131,_0x28b495)=>{_0x5db1f5[_0x28b495]['secondary_unit']=_0x508131;}),_0x4b147e[_0xe36cd0(0x1fa)]((_0x256af7,_0xb113c6)=>{var _0x54f92b=_0xe36cd0;_0x5db1f5[_0xb113c6][_0x54f92b(0x288)]=_0x256af7;}),_0x2baa7d[_0xe36cd0(0x1fa)]((_0x3d329a,_0xaeda7b)=>{var _0x173899=_0xe36cd0;_0x5db1f5[_0xaeda7b][_0x173899(0x2d0)]=_0x3d329a;}),_0x57abda['forEach']((_0x45fe24,_0x2121ed)=>{var _0x1e815e=_0xe36cd0;_0x5db1f5[_0x2121ed][_0x1e815e(0x278)]=_0x45fe24;}),_0x144703[_0xe36cd0(0x1fa)]((_0x55f3f4,_0x3090d8)=>{var _0x5c0983=_0xe36cd0;_0x5db1f5[_0x3090d8][_0x5c0983(0x2bd)]=_0x55f3f4;}),_0x5be9ea[_0xe36cd0(0x1fa)]((_0x321fc5,_0x30d260)=>{var _0x51b849=_0xe36cd0;_0x5db1f5[_0x30d260][_0x51b849(0x2d2)]=_0x321fc5;}),_0x3071af[_0xe36cd0(0x1fa)]((_0x57535c,_0x585c9b)=>{var _0x4aa60e=_0xe36cd0;_0x5db1f5[_0x585c9b][_0x4aa60e(0x2f0)]=_0x57535c;});const _0x3a35b5=_0x5db1f5['filter'](_0x57d0e0=>_0x57d0e0[_0xe36cd0(0x251)]!=='0'&&_0x57d0e0['quantity']!=='');_0x1c688f['invoice']=_0x44cb59,_0x1c688f['suppliers']=_0xb3834d,_0x1c688f[_0xe36cd0(0x20e)]=_0x363bc1,_0x1c688f[_0xe36cd0(0x284)]=_0x193f54,_0x1c688f[_0xe36cd0(0x270)]=_0x3a35b5,_0x1c688f[_0xe36cd0(0x2cc)]=_0x4e0449,_0x1c688f[_0xe36cd0(0x1cf)]=_0xb7f7,_0x1c688f[_0xe36cd0(0x27e)]=_0x4872f5,_0x1c688f['room']=_0x16fdd1,_0x1c688f['POnumber']=_0xb89363,_0x1c688f[_0xe36cd0(0x27a)]=_0x33d340;const _0x2a05d7=await _0x1c688f[_0xe36cd0(0x247)](),_0x23ac63=await warehouse[_0xe36cd0(0x264)]({'name':_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x284)],'room':_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2eb)]});_0x1c688f[_0xe36cd0(0x270)][_0xe36cd0(0x1fa)](_0x4b27ee=>{var _0x390cb9=_0xe36cd0,_0x19280d=0x0;const _0x3d2606=_0x23ac63[_0x390cb9(0x2ed)][_0x390cb9(0x1c2)](_0x3493e6=>{var _0x31e304=_0x390cb9;_0x3493e6[_0x31e304(0x2cf)]==_0x4b27ee['product_name']&&_0x3493e6[_0x31e304(0x288)]==_0x4b27ee[_0x31e304(0x288)]&&(_0x3493e6[_0x31e304(0x2cb)]=parseInt(_0x3493e6[_0x31e304(0x2cb)])+parseInt(_0x4b27ee[_0x31e304(0x251)]),_0x19280d++);});_0x19280d=='0'&&(_0x23ac63['product_details']=_0x23ac63[_0x390cb9(0x2ed)][_0x390cb9(0x2c5)]({'product_name':_0x4b27ee[_0x390cb9(0x2cf)],'product_stock':_0x4b27ee[_0x390cb9(0x251)],'primary_code':_0x4b27ee['primary_code'],'secondary_code':_0x4b27ee[_0x390cb9(0x278)],'product_code':_0x4b27ee[_0x390cb9(0x230)],'bay':_0x4b27ee[_0x390cb9(0x288)],'maxProducts':_0x4b27ee[_0x390cb9(0x2bd)],'unit':_0x4b27ee['standard_unit'],'secondary_unit':_0x4b27ee['secondary_unit'],'expiry_date':_0x4b27ee[_0x390cb9(0x2f0)]}));}),await _0x23ac63[_0xe36cd0(0x247)]();const _0x242752=await s_payment_data[_0xe36cd0(0x264)]({'invoice':_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2a7)]});if(_0x242752===null){}else console[_0xe36cd0(0x289)](_0xe36cd0(0x2b7),_0x242752,_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2a7)]),_0x242752[_0xe36cd0(0x2b7)]=_0x51886c[_0xe36cd0(0x268)][_0xe36cd0(0x2b7)],await _0x242752['save']();_0x51886c[_0xe36cd0(0x22a)]('success',_0xe36cd0(0x1b9)),_0x46107c[_0xe36cd0(0x2b6)](_0xe36cd0(0x2da));}catch(_0x4e7780){console['log'](_0x4e7780);}}),router[a0_0x39be50(0x28d)](a0_0x39be50(0x1b6),auth,async(_0x1714bc,_0x399db0)=>{var _0x2fce38=a0_0x39be50;try{const _0x347eb8=_0x1714bc[_0x2fce38(0x207)]['id'],{invoice:_0x34cbf3,suppliers:_0x226dd2,payable:_0x20e81c,due_amount:_0x265220}=_0x1714bc[_0x2fce38(0x268)],_0x3a4064=await purchases[_0x2fce38(0x26b)](_0x347eb8);var _0x2cac3f=_0x20e81c-_0x265220;_0x3a4064[_0x2fce38(0x1cf)]=parseFloat(_0x3a4064[_0x2fce38(0x1cf)])+parseFloat(_0x265220),_0x3a4064[_0x2fce38(0x27e)]=_0x2cac3f;const _0x2fb6fe=await _0x3a4064[_0x2fce38(0x247)]();console['log'](_0x2fb6fe);const _0x43c8f8=await s_payment_data[_0x2fce38(0x264)]({'invoice':_0x34cbf3});_0x43c8f8[_0x2fce38(0x252)]=_0x2cac3f,await _0x43c8f8[_0x2fce38(0x247)]();let _0x576de6=new Date(),_0x9cf871=('0'+_0x576de6['getDate']())[_0x2fce38(0x2c1)](-0x2),_0x557fd2=('0'+(_0x576de6[_0x2fce38(0x27b)]()+0x1))[_0x2fce38(0x2c1)](-0x2),_0x33b58b=_0x576de6[_0x2fce38(0x1c8)](),_0x129b0c=_0x33b58b+'-'+_0x557fd2+'-'+_0x9cf871;const _0x305c31=new suppliers_payment({'invoice':_0x34cbf3,'date':_0x33b58b+'-'+_0x557fd2+'-'+_0x9cf871,'suppliers':_0x226dd2,'reason':'Paid\x20For\x20Purchase','amount':_0x265220}),_0x4a6d3e=await _0x305c31[_0x2fce38(0x247)]();_0x1714bc['flash'](_0x2fce38(0x1e4),_0x2fce38(0x2ab)),_0x399db0[_0x2fce38(0x2b6)](_0x2fce38(0x2e8));}catch(_0x56501d){console['log'](_0x56501d);}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x27d),auth,async(_0x5690a9,_0x9a7cc1)=>{var _0x1d49d5=a0_0x39be50;try{const {username:_0x26cb67,email:_0x1491c0,role:_0x1d6431}=_0x5690a9[_0x1d49d5(0x206)],_0x288992=_0x5690a9['user'],_0x2c3beb=await profile[_0x1d49d5(0x264)]({'email':_0x288992[_0x1d49d5(0x1b1)]}),_0x57ed2d=await master_shop[_0x1d49d5(0x24e)]();console[_0x1d49d5(0x289)](_0x1d49d5(0x2a4),_0x57ed2d);const _0x8a9aa0=_0x5690a9[_0x1d49d5(0x207)]['id'],_0x1d4761=await purchases[_0x1d49d5(0x26b)](_0x8a9aa0);console[_0x1d49d5(0x289)](_0x1d4761);const _0x34ba51=await suppliers[_0x1d49d5(0x264)]({'name':_0x1d4761[_0x1d49d5(0x2b7)]});console[_0x1d49d5(0x289)](_0x34ba51);if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x1b3)){var _0x3ab61b=users[_0x1d49d5(0x208)];console[_0x1d49d5(0x289)](_0x3ab61b);}else{if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x261))var _0x3ab61b=users[_0x1d49d5(0x261)];else{if(_0x57ed2d[0x0]['language']==_0x1d49d5(0x1ef))var _0x3ab61b=users['German'];else{if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x23d))var _0x3ab61b=users[_0x1d49d5(0x23d)];else{if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x2aa))var _0x3ab61b=users[_0x1d49d5(0x2aa)];else{if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x2a3))var _0x3ab61b=users['Portuguese'];else{if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x1ba))var _0x3ab61b=users[_0x1d49d5(0x1ba)];else{if(_0x57ed2d[0x0][_0x1d49d5(0x1b8)]==_0x1d49d5(0x254))var _0x3ab61b=users[_0x1d49d5(0x25e)];}}}}}}}_0x9a7cc1[_0x1d49d5(0x28c)]('purchase_invoice',{'success':_0x5690a9['flash']('success'),'errors':_0x5690a9[_0x1d49d5(0x22a)](_0x1d49d5(0x1e7)),'role':_0x288992,'profile':_0x2c3beb,'master_shop':_0x57ed2d,'supplier':_0x34ba51,'purchase':_0x1d4761,'language':_0x3ab61b});}catch(_0x303915){console[_0x1d49d5(0x289)](_0x303915);}}),router[a0_0x39be50(0x1c7)](a0_0x39be50(0x21b),auth,async(_0x16ccf5,_0x2e2304)=>{var _0x3290db=a0_0x39be50;try{const {username:_0x26300d,email:_0x578846,role:_0x1956b2}=_0x16ccf5[_0x3290db(0x206)],_0x25fec1=_0x16ccf5[_0x3290db(0x206)],_0xe9e91f=await profile[_0x3290db(0x264)]({'email':_0x25fec1['email']}),_0x48307f=await master_shop[_0x3290db(0x24e)]();console[_0x3290db(0x289)](_0x3290db(0x2a4),_0x48307f);const _0x47e75e=_0x16ccf5[_0x3290db(0x207)]['id'];console[_0x3290db(0x289)](_0x47e75e);const _0x33664b=await purchases_finished[_0x3290db(0x26b)](_0x47e75e);console[_0x3290db(0x289)](_0x3290db(0x242),_0x33664b);const _0x46febb=await product['find']({}),_0x2877a6=await warehouse[_0x3290db(0x262)]([{'$match':{'name':_0x33664b[_0x3290db(0x284)],'room':_0x33664b[_0x3290db(0x275)]}},{'$unwind':_0x3290db(0x1bc)},{'$group':{'_id':_0x3290db(0x294),'name':{'$first':_0x3290db(0x211)},'product_stock':{'$first':_0x3290db(0x2bb)},'bay':{'$first':_0x3290db(0x224)},'bin':{'$first':_0x3290db(0x2a9)},'type':{'$first':_0x3290db(0x239)},'floorlevel':{'$first':_0x3290db(0x291)},'primary_code':{'$first':_0x3290db(0x1de)},'secondary_code':{'$first':_0x3290db(0x2d3)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3290db(0x2c2)},'rack':{'$first':_0x3290db(0x23e)}}}]);console[_0x3290db(0x289)](_0x3290db(0x213),_0x2877a6);let _0x4c4201;if(_0x25fec1[_0x3290db(0x2e0)]==_0x3290db(0x1f3)){const _0x319db1=await staff[_0x3290db(0x264)]({'email':_0x25fec1[_0x3290db(0x1b1)]});_0x4c4201=await warehouse[_0x3290db(0x24e)]({'status':_0x3290db(0x2c6),'name':_0x319db1[_0x3290db(0x2ba)],'warehouse_category':_0x3290db(0x1bf),'name':_0x3290db(0x1d5)});}else _0x4c4201=await warehouse[_0x3290db(0x262)]([{'$match':{'status':_0x3290db(0x2c6),'warehouse_category':_0x3290db(0x1bf),'name':_0x3290db(0x1d5)}},{'$group':{'_id':_0x3290db(0x2b1),'name':{'$first':_0x3290db(0x2b1)}}}]);if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x1b3)){var _0x5f0a5e=users[_0x3290db(0x208)];console[_0x3290db(0x289)](_0x5f0a5e);}else{if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x261))var _0x5f0a5e=users[_0x3290db(0x261)];else{if(_0x48307f[0x0]['language']==_0x3290db(0x1ef))var _0x5f0a5e=users['German'];else{if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x23d))var _0x5f0a5e=users[_0x3290db(0x23d)];else{if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x2aa))var _0x5f0a5e=users[_0x3290db(0x2aa)];else{if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x2a3))var _0x5f0a5e=users[_0x3290db(0x22b)];else{if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x1ba))var _0x5f0a5e=users['Chinese'];else{if(_0x48307f[0x0][_0x3290db(0x1b8)]==_0x3290db(0x254))var _0x5f0a5e=users['Arabic'];}}}}}}}_0x2e2304[_0x3290db(0x28c)](_0x3290db(0x2ca),{'success':_0x16ccf5[_0x3290db(0x22a)](_0x3290db(0x1e4)),'errors':_0x16ccf5[_0x3290db(0x22a)](_0x3290db(0x1e7)),'role':_0x25fec1,'profile':_0xe9e91f,'user':_0x33664b,'stock':_0x2877a6,'master_shop':_0x48307f,'product':_0x46febb,'language':_0x5f0a5e,'warehouse':_0x4c4201});}catch(_0x235642){console[_0x3290db(0x289)](_0x235642);}}),router[a0_0x39be50(0x28d)](a0_0x39be50(0x21b),auth,async(_0x5358af,_0x34d112)=>{var _0x66dabf=a0_0x39be50;try{const {invoice:_0xc6edfd,date:_0x3beb54,warehouse_name:_0x2a9140,Room_name:_0x4983b0,product_name:_0x6ced1b,purchase_quantity:_0x2290fa,stocks:_0x1447e0,return_qty:_0x26b727,note:_0x12293f,level:_0x2c4e15,isle:_0x353f25,pallet:_0x488e79,to_warehouse_name:_0x42845c,to_Room_name:_0x1d4437}=_0x5358af[_0x66dabf(0x268)],_0x4b066a=await purchases_finished[_0x66dabf(0x264)]({'_id':_0x5358af[_0x66dabf(0x207)]['id']}),_0x1cde65=await warehouse[_0x66dabf(0x264)]({'name':_0x2a9140,'room':_0x4983b0,'warehouse_category':_0x66dabf(0x1bf)});if(typeof _0x6ced1b==_0x66dabf(0x1f6))var _0x33f271=[_0x5358af['body'][_0x66dabf(0x2cf)]],_0x23124a=[_0x5358af[_0x66dabf(0x268)][_0x66dabf(0x24f)]],_0x54c89c=[_0x5358af[_0x66dabf(0x268)]['stocks']],_0x4aad06=[_0x5358af[_0x66dabf(0x268)]['return_qty']],_0x3a9f27=[_0x5358af['body'][_0x66dabf(0x1c3)]],_0x15f69b=[_0x5358af[_0x66dabf(0x268)][_0x66dabf(0x1fc)]],_0x476898=[_0x5358af[_0x66dabf(0x268)][_0x66dabf(0x249)]],_0x402977=[_0x5358af[_0x66dabf(0x268)][_0x66dabf(0x273)]];else var _0x33f271=[..._0x5358af['body'][_0x66dabf(0x2cf)]],_0x23124a=[..._0x5358af[_0x66dabf(0x268)][_0x66dabf(0x24f)]],_0x54c89c=[..._0x5358af[_0x66dabf(0x268)]['stocks']],_0x4aad06=[..._0x5358af[_0x66dabf(0x268)]['return_qty']],_0x3a9f27=[..._0x5358af[_0x66dabf(0x268)][_0x66dabf(0x1c3)]],_0x15f69b=[..._0x5358af[_0x66dabf(0x268)][_0x66dabf(0x1fc)]],_0x476898=[..._0x5358af[_0x66dabf(0x268)][_0x66dabf(0x249)]],_0x402977=[..._0x5358af[_0x66dabf(0x268)][_0x66dabf(0x273)]];const _0x4f1b88=_0x33f271[_0x66dabf(0x1c2)](_0x46f6da=>{return _0x46f6da={'product_name':_0x46f6da};});_0x23124a[_0x66dabf(0x1fa)]((_0xd1e233,_0x5b9c35)=>{var _0x3577cf=_0x66dabf;_0x4f1b88[_0x5b9c35][_0x3577cf(0x24f)]=_0xd1e233;}),_0x54c89c[_0x66dabf(0x1fa)]((_0x137c6c,_0x51a58e)=>{var _0x13ced7=_0x66dabf;_0x4f1b88[_0x51a58e][_0x13ced7(0x221)]=_0x137c6c;}),_0x4aad06[_0x66dabf(0x1fa)]((_0x295176,_0x4dc3a1)=>{var _0x2b6fbb=_0x66dabf;_0x4f1b88[_0x4dc3a1][_0x2b6fbb(0x1f2)]=_0x295176;}),_0x3a9f27['forEach']((_0x3b5c5c,_0x5023b4)=>{var _0x36bfcf=_0x66dabf;_0x4f1b88[_0x5023b4][_0x36bfcf(0x288)]=_0x3b5c5c;}),_0x15f69b[_0x66dabf(0x1fa)]((_0x4cd46,_0x4da679)=>{var _0x1c2857=_0x66dabf;_0x4f1b88[_0x4da679][_0x1c2857(0x230)]=_0x4cd46;}),_0x476898[_0x66dabf(0x1fa)]((_0x55dac4,_0x324837)=>{var _0x58fb24=_0x66dabf;_0x4f1b88[_0x324837][_0x58fb24(0x2d0)]=_0x55dac4;}),_0x402977[_0x66dabf(0x1fa)]((_0x14fa84,_0xc36480)=>{var _0x47770d=_0x66dabf;_0x4f1b88[_0xc36480][_0x47770d(0x278)]=_0x14fa84;}),_0x4f1b88['forEach'](_0x39a5b9=>{var _0xae944a=_0x66dabf;console[_0xae944a(0x289)](_0x39a5b9);const _0x9671f=_0x1cde65['product_details'][_0xae944a(0x1c2)](_0x2bebda=>{var _0x58cacb=_0xae944a;_0x2bebda['product_name']==_0x39a5b9[_0x58cacb(0x2cf)]&&_0x2bebda['bay']==_0x39a5b9[_0x58cacb(0x288)]&&(console[_0x58cacb(0x289)](parseInt(_0x2bebda[_0x58cacb(0x2cb)])+_0x58cacb(0x1d3)+parseInt(_0x39a5b9['return_qty'])),_0x2bebda[_0x58cacb(0x2cb)]=parseInt(_0x2bebda[_0x58cacb(0x2cb)])-parseInt(_0x39a5b9[_0x58cacb(0x1f2)]));});}),await _0x1cde65['save']();var _0x5e8ac7=0x0;_0x4f1b88[_0x66dabf(0x1fa)](_0x364dee=>{var _0x30596d=_0x66dabf;(parseInt(_0x364dee[_0x30596d(0x24f)])<parseInt(_0x364dee[_0x30596d(0x1f2)])||parseInt(_0x364dee[_0x30596d(0x221)])<parseInt(_0x364dee[_0x30596d(0x1f2)]))&&_0x5e8ac7++;});if(_0x5e8ac7!=0x0)return _0x5358af[_0x66dabf(0x22a)](_0x66dabf(0x1e7),_0x66dabf(0x1d4)),_0x34d112[_0x66dabf(0x2b6)](_0x66dabf(0x1d9));const _0x106814=new purchases_return_finished({'invoice':_0xc6edfd,'suppliers':_0x5358af[_0x66dabf(0x268)]['suppliers'],'date':_0x3beb54,'warehouse_name':_0x2a9140,'return_product':_0x4f1b88,'note':_0x12293f,'room':_0x4983b0,'to_warehouse_name':_0x42845c,'to_room':_0x1d4437}),_0x5452d9=await _0x106814['save'](),_0x5a4242=await purchases_return_finished[_0x66dabf(0x264)]({'invoice':_0xc6edfd}),_0x565bb8=await warehouse[_0x66dabf(0x264)]({'name':_0x42845c,'room':_0x1d4437,'warehouse_category':'Finished\x20Goods'});_0x5a4242['return_product'][_0x66dabf(0x1fa)](_0x585858=>{var _0x5aafcf=_0x66dabf,_0x134405=0x0;const _0x1fe69c=_0x565bb8[_0x5aafcf(0x2ed)][_0x5aafcf(0x1c2)](_0x124a68=>{var _0x7cb904=_0x5aafcf;console['log'](_0x124a68['product_name']+'=='+_0x585858['product_name']+'&&'+_0x124a68[_0x7cb904(0x288)]+'=='+_0x585858[_0x7cb904(0x288)]),_0x124a68['product_name']==_0x585858[_0x7cb904(0x2cf)]&&_0x124a68[_0x7cb904(0x288)]==_0x585858[_0x7cb904(0x288)]&&(_0x124a68[_0x7cb904(0x2cb)]=parseInt(_0x124a68['product_stock'])-parseInt(_0x585858[_0x7cb904(0x1f2)]),_0x134405++);});_0x134405=='0'&&(_0x565bb8['product_details']=_0x565bb8[_0x5aafcf(0x2ed)]['concat']({'product_name':_0x585858[_0x5aafcf(0x2cf)],'product_stock':_0x585858[_0x5aafcf(0x1f2)],'primary_code':_0x585858[_0x5aafcf(0x2d0)],'secondary_code':_0x585858[_0x5aafcf(0x278)],'product_code':_0x585858['product_code'],'bay':_0x585858['bay'],'maxProducts':0xf423f}));}),await _0x565bb8[_0x66dabf(0x247)]();const _0x1b4f6c=await purchases_finished[_0x66dabf(0x264)]({'invoice':_0xc6edfd});_0x1b4f6c[_0x66dabf(0x26a)]=_0x66dabf(0x2d4);const _0x3d5859=await _0x1b4f6c[_0x66dabf(0x247)](),_0x219936=new s_payment_data({'invoice':_0xc6edfd,'suppliers':_0x5358af['body'][_0x66dabf(0x2b7)],'reason':_0x66dabf(0x2b3)});await _0x219936[_0x66dabf(0x247)]();const _0x2f21f0=await master_shop[_0x66dabf(0x24e)](),_0x1de168=await email_settings[_0x66dabf(0x264)](),_0x3a7e21=await suppliers['findOne']({'name':_0x5358af[_0x66dabf(0x268)]['suppliers']});_0x2f21f0[0x0][_0x66dabf(0x1f1)]==0x1?(right_currency=_0x2f21f0[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x2f21f0[0x0][_0x66dabf(0x26d)]);var _0x559263=_0x33f271,_0x4b5f0c=_0x4aad06,_0x21bbce='',_0xed5f36;for(_0xed5f36 in _0x559263){_0x21bbce+=_0x66dabf(0x286)+_0x66dabf(0x210)+_0x559263[_0xed5f36]+_0x66dabf(0x1fb)+_0x66dabf(0x210)+_0x4b5f0c[_0xed5f36]+_0x66dabf(0x1fb)+'</tr>';}let _0x32fc4d=nodemailer['createTransport']({'service':_0x66dabf(0x215),'auth':{'user':_0x1de168[_0x66dabf(0x1b1)],'pass':_0x1de168[_0x66dabf(0x1db)]}}),_0x525591={'from':_0x1de168[_0x66dabf(0x1b1)],'to':_0x3a7e21[_0x66dabf(0x1b1)],'subject':_0x66dabf(0x2ad),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x66dabf(0x2d6)+_0x2f21f0[0x0][_0x66dabf(0x24b)],'cid':_0x66dabf(0x226)}],'html':'<!DOCTYPE\x20html>'+_0x66dabf(0x22e)+_0x66dabf(0x2a8)+_0x66dabf(0x1e3)+_0x66dabf(0x1d0)+_0x66dabf(0x1e3)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x66dabf(0x1e3)+_0x66dabf(0x276)+_0x2f21f0[0x0][_0x66dabf(0x232)]+'\x20</h2>'+_0x66dabf(0x1e8)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x66dabf(0x1e3)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x66dabf(0x2e7)+_0xc6edfd+'\x20'+_0x66dabf(0x227)+_0x66dabf(0x2d8)+_0x3beb54+'\x20'+_0x66dabf(0x243)+'</h5>'+_0x66dabf(0x1e8)+_0x66dabf(0x1ed)+_0x66dabf(0x290)+_0x66dabf(0x286)+_0x66dabf(0x2df)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x66dabf(0x2e6)+_0x66dabf(0x2a0)+_0x66dabf(0x297)+_0x66dabf(0x25d)+'\x20'+_0x21bbce+'\x20'+_0x66dabf(0x231)+_0x66dabf(0x1ce)+_0x66dabf(0x1e3)+_0x66dabf(0x2c3)+_0x66dabf(0x29d)+_0x2f21f0[0x0][_0x66dabf(0x232)]+_0x66dabf(0x1c9)+_0x66dabf(0x1e8)+_0x66dabf(0x1e8)+_0x66dabf(0x2b5)};_0x32fc4d[_0x66dabf(0x1f4)](_0x525591,function(_0x229f0d,_0x10c6b9){var _0xd17cdc=_0x66dabf;_0x229f0d?console['log'](_0xd17cdc(0x219)):console[_0xd17cdc(0x289)](_0xd17cdc(0x256));}),_0x5358af[_0x66dabf(0x22a)](_0x66dabf(0x1e4),'purchases\x20item\x20return\x20successfull'),_0x34d112['redirect']('/all_purchases_finished/view');}catch(_0x8f3ee){_0x34d112['status'](0xc8)[_0x66dabf(0x214)]({'message':_0x8f3ee['message']});}}),router['get']('/barcode/:id',auth,async(_0x307875,_0x34d36f)=>{var _0x4511fc=a0_0x39be50;try{const {username:_0x55421e,email:_0x39c93c,role:_0x6a6c95}=_0x307875[_0x4511fc(0x206)],_0x38fc4f=_0x307875[_0x4511fc(0x206)],_0x46e817=await profile[_0x4511fc(0x264)]({'email':_0x38fc4f[_0x4511fc(0x1b1)]}),_0x2d6ad1=await master_shop['find'](),_0x55d2a7=_0x307875[_0x4511fc(0x207)]['id'],_0x14e5e6=await purchases_finished['findById'](_0x55d2a7);if(_0x2d6ad1[0x0]['language']==_0x4511fc(0x1b3))var _0x5ef008=users[_0x4511fc(0x208)];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]=='Hindi')var _0x5ef008=users[_0x4511fc(0x261)];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]==_0x4511fc(0x1ef))var _0x5ef008=users[_0x4511fc(0x1ef)];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]==_0x4511fc(0x23d))var _0x5ef008=users[_0x4511fc(0x23d)];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]=='French')var _0x5ef008=users['French'];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]==_0x4511fc(0x2a3))var _0x5ef008=users[_0x4511fc(0x22b)];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]=='Chinese')var _0x5ef008=users[_0x4511fc(0x1ba)];else{if(_0x2d6ad1[0x0][_0x4511fc(0x1b8)]==_0x4511fc(0x254))var _0x5ef008=users[_0x4511fc(0x25e)];}}}}}}}_0x34d36f[_0x4511fc(0x28c)](_0x4511fc(0x2d9),{'success':_0x307875[_0x4511fc(0x22a)]('success'),'errors':_0x307875[_0x4511fc(0x22a)](_0x4511fc(0x1e7)),'role':_0x38fc4f,'profile':_0x46e817,'alldata':_0x14e5e6,'master_shop':_0x2d6ad1,'language':_0x5ef008}),console[_0x4511fc(0x289)](alldata);}catch(_0x200c35){console['log'](_0x200c35);}}),router[a0_0x39be50(0x28d)]('/barcode_scanner',async(_0x229d7f,_0x1cd985)=>{var _0x4fed90=a0_0x39be50;const {product_code:_0x5dea30}=_0x229d7f['body'];var _0x1dd164;const _0x27b861=await product[_0x4fed90(0x262)]([{'$match':{'primary_code':_0x5dea30}},{'$group':{'_id':_0x4fed90(0x204),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x4fed90(0x1b7)},'unit':{'$first':_0x4fed90(0x20f)},'alertquantity':{'$first':_0x4fed90(0x1b0)},'product_code':{'$first':_0x4fed90(0x2e5)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4fed90(0x2b9)},'maxProdPerUnit':{'$first':_0x4fed90(0x22c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x4fed90(0x24a)},'sales_category':{'$first':_0x4fed90(0x1bd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x1c77cd=await product[_0x4fed90(0x262)]([{'$match':{'secondary_code':_0x5dea30}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x4fed90(0x1cb)},'brand':{'$first':'$brand'},'unit':{'$first':_0x4fed90(0x20f)},'alertquantity':{'$first':_0x4fed90(0x1b0)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x4fed90(0x237)},'maxStocks':{'$first':_0x4fed90(0x2b9)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4fed90(0x21e)},'gross_price':{'$first':_0x4fed90(0x24a)},'sales_category':{'$first':_0x4fed90(0x1bd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x27b861[_0x4fed90(0x258)]>0x0)_0x1dd164=_0x27b861;else _0x1c77cd[_0x4fed90(0x258)]>0x0&&(_0x1dd164=_0x1c77cd);_0x1cd985[_0x4fed90(0x214)](_0x1dd164);}),router[a0_0x39be50(0x28d)](a0_0x39be50(0x2a6),async(_0x5d1c67,_0x9a7583)=>{var _0x33ce16=a0_0x39be50;const {productCode:_0x47f8af,bay:_0x12fb93,warehouses:_0x6a6cc0,room:_0x3df23d}=_0x5d1c67[_0x33ce16(0x268)];console['log'](_0x5d1c67['body']);try{const _0x4a061a=await warehouse[_0x33ce16(0x262)]([{'$match':{'name':_0x6a6cc0,'room':_0x3df23d}},{'$unwind':_0x33ce16(0x1bc)},{'$match':{'product_details.bay':parseInt(_0x12fb93)}},{'$group':{'_id':_0x33ce16(0x294),'name':{'$first':_0x33ce16(0x211)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x33ce16(0x2e2)}}}]);_0x9a7583[_0x33ce16(0x1df)](0xc8)[_0x33ce16(0x214)](_0x4a061a);}catch(_0x209175){_0x9a7583[_0x33ce16(0x1df)](0x194)[_0x33ce16(0x214)]({'message':_0x209175[_0x33ce16(0x2a1)]});}}),router[a0_0x39be50(0x28d)](a0_0x39be50(0x296),async(_0x4d9329,_0x2bd670)=>{var _0x3f8906=a0_0x39be50;const {product_code:_0x3c3802}=_0x4d9329[_0x3f8906(0x268)];var _0x445174;const _0x2e5f1d=await product[_0x3f8906(0x262)]([{'$match':{'primary_code':_0x3c3802,'type_products':_0x3f8906(0x289)}},{'$group':{'_id':_0x3f8906(0x204),'name':{'$first':_0x3f8906(0x2b1)},'category':{'$first':_0x3f8906(0x1cb)},'brand':{'$first':_0x3f8906(0x1b7)},'unit':{'$first':_0x3f8906(0x20f)},'alertquantity':{'$first':_0x3f8906(0x1b0)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x3f8906(0x229)},'secondary_code':{'$first':_0x3f8906(0x237)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3f8906(0x21e)},'gross_price':{'$first':_0x3f8906(0x24a)},'sales_category':{'$first':_0x3f8906(0x1bd)},'type_products':{'$first':_0x3f8906(0x244)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x3f8906(0x289)](_0x2e5f1d);const _0x490189=await product[_0x3f8906(0x262)]([{'$match':{'secondary_code':_0x3c3802,'type_products':_0x3f8906(0x289)}},{'$group':{'_id':_0x3f8906(0x204),'name':{'$first':_0x3f8906(0x2b1)},'category':{'$first':_0x3f8906(0x1cb)},'brand':{'$first':_0x3f8906(0x1b7)},'unit':{'$first':_0x3f8906(0x20f)},'alertquantity':{'$first':_0x3f8906(0x1b0)},'product_code':{'$first':_0x3f8906(0x2e5)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3f8906(0x237)},'maxStocks':{'$first':_0x3f8906(0x2b9)},'maxProdPerUnit':{'$first':_0x3f8906(0x22c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x3f8906(0x24a)},'sales_category':{'$first':_0x3f8906(0x1bd)},'type_products':{'$first':_0x3f8906(0x244)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x2e5f1d[_0x3f8906(0x258)]>0x0)_0x445174=_0x2e5f1d;else _0x490189[_0x3f8906(0x258)]>0x0&&(_0x445174=_0x490189);_0x2bd670[_0x3f8906(0x214)](_0x445174);}),module[a0_0x39be50(0x2c9)]=router;