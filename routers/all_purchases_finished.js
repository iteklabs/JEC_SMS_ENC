function a0_0x1bca(){var _0x4e9a4a=['error','isProcess','$date','142LSmIBr','password','all','forEach','LOG-INC-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','room','<!DOCTYPE\x20html>','message','$product_details.product_code','product_name','$product_code','prod_Qty','<h5>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','product_details','table\x20page','/CheckingWarehouse','7079170TRINOn','amount','German','purchase_quantity','role','</body></html>','prod_secondunit','</tr>','<h5\x20style=\x22text-align:\x20left;\x22>','</td>',',\x20bin:\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$paid_amount','prod_qty','$due_amount','prod_level','$batch_code','sendMail','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','nodemailer','params','unit','string','Portuguese','user','$product.room_name','../models/all_models','$type_products','$product_details.primary_code','Asia/Manila','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details','/barcode/:id','get','getFullYear','suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room_name','add_purchases_finished','gmail','port','render','$product.floorlevel','$note','valueOf','<strong>\x20Regards\x20</strong>','</tbody>','success','length','catch','</span>','\x20units\x20of\x20','save','maxPerUnit','$return_data','INC','invoice','return_purchase_finished','Finished\x20Goods','toString','product','$warehouse_name','true','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','secondary_code','filter','max','product_date','name','Rack\x201','/view/add_purchases_logs','$product_details.rack','16584fvnOis','Ambient','JO_number','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','\x20</h2>','findOne','floor','../middleware/auth','product_id','3594865BnvAZa','_id','level','gross_price','max_product_unit','product_stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','warehouse_name','</thead>','\x20Order\x20Number\x20:\x20','162697wmZiru','edit_purchases_finished_view','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','warehouse','product_code','return_product','Arabic\x20(ae)','$product','$product_details.bay','add_purchases_finished_logs',',\x20room:\x20','maxperunit','</table>','Portuguese\x20(BR)','standard_unit','$sales_category','/view_log','Purchase\x20Mail','$name','$product.type','Room_name','isAvailable','<html><head><title></title>','random','10QktCGw','site_title','quantity',',\x20bay:\x20','Enabled','STAGING','logo','prod_code','id_transaction','here2','post','$alertquantity','uuid','util','logs','all_purchases_barcode','createTransport','$product_details.product_stock','5899400aBsSir','body','$maxProdPerUnit','Distributing\x20','purchases\x20item\x20return\x20successfull','/picking_list/pdf_puchases_fin_own_trf/','prod_unit','sales_data_cateory','log','$secondary_code','/view/:id','Error\x20Occurs','maxStocks','/barcode_scanner','errors','type_of_products','min','../public/language/languages.json','secondary_code_hide','type_of_products_type','Transfer\x20Finalize\x20Successfully','staff','date','image','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/invoice/:id','</div>','<span\x20style=\x22float:\x20right;\x22>','$_id','abs','secondary_unit','return_qty','/all_purchases_finished/view','note','prod_primunit','item_code','all_purchases_finished','return_data','An\x20error\x20occurred\x20while\x20saving\x20data.','express','date_recieved','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','RoomAssign','Spanish','status','currency','findById','/view/add_purchases','purchase\x20data\x20add\x20successfully','/getinvoicetrf','product_code_hide','Router','English','/../public','primary_code_hide','product_data','/preview/:id','updateOne','getMonth','Paid\x20For\x20Purchase','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Return\x20Goods','English\x20(US)','sales_category','Arabic','map','$product_details.storage','</head><body>','INCF-','$maxStocks','expiry_date','production_date','/all_purchases/view','3126264kZszPx','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','aggregate','purchase_invoice','<hr\x20class=\x22my-3\x22>','find','\x20<>\x20','$product_details.maxProducts','to_quantity','data_type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$category','<tbody\x20style=\x22text-align:\x20center;\x22>','to_warehouse','then','batch_code','isUsed','$invoice','There\x20is\x20','<div>','master','match','/give_payment/:id','maxProducts','Enclosed','$product.bin','/incoming/add','</h5>','Logo.png','FGSEmail','$secondary_unit','$brand','<h2>\x20','Error\x20occurred\x20while\x20processing\x20product:','json','$primary_code','$product.quantity','flash','\x20Order\x20Date\x20:\x20','/barcode_scanner_logs','616689yhStrs','slice','concat','/view/return_purchase/:id','Purchase\x20Return','invoice_init','paid_amount','/process/:id','redirect','getDate','/view','/all_purchases_finished/preview/','padStart','2-digit','DRY\x20GOODS','The\x20Other\x20','$product.bay','$room','INC-','MaxStocks_data','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Chinese','/incoming','<tr>','to_bay','host','bay','Email\x20sent\x20successfully','product_cat','bin','Hindi','own','$suppliers','$expiry_date','$unit','prod_cat','primary_code','$suppliers_docs','French','email','inc','4vXhoVJ','stock_quantity','false','language','\x20to\x20warehouse:\x20','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','ejs','POnumber','$gross_price','suppliers','\x20inc\x20=\x20'];a0_0x1bca=function(){return _0x4e9a4a;};return a0_0x1bca();}var a0_0x275920=a0_0x2a3f;(function(_0x55c3be,_0x2d718a){var _0x372162=a0_0x2a3f,_0xc4bcf9=_0x55c3be();while(!![]){try{var _0x1251c4=-parseInt(_0x372162(0x2e9))/0x1+parseInt(_0x372162(0x277))/0x2*(parseInt(_0x372162(0x2d6))/0x3)+-parseInt(_0x372162(0x269))/0x4*(-parseInt(_0x372162(0x2df))/0x5)+-parseInt(_0x372162(0x217))/0x6+parseInt(_0x372162(0x28a))/0x7+-parseInt(_0x372162(0x1cd))/0x8+-parseInt(_0x372162(0x23f))/0x9*(parseInt(_0x372162(0x1bb))/0xa);if(_0x1251c4===_0x2d718a)break;else _0xc4bcf9['push'](_0xc4bcf9['shift']());}catch(_0x4c473f){_0xc4bcf9['push'](_0xc4bcf9['shift']());}}}(a0_0x1bca,0x9a8fc));const express=require(a0_0x275920(0x1f4)),app=express(),router=express[a0_0x275920(0x201)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x275920(0x2a6)),auth=require(a0_0x275920(0x2dd)),nodemailer=require(a0_0x275920(0x29f));var ejs=require(a0_0x275920(0x26f));const path=require('path'),users=require(a0_0x275920(0x1de)),{isNull}=require(a0_0x275920(0x1c8));router['get'](a0_0x275920(0x256),auth,async(_0x5e1a95,_0x24a811)=>{var _0x311853=a0_0x275920;try{const {username:_0x499491,email:_0x465353,role:_0x42a8ea}=_0x5e1a95[_0x311853(0x2a4)],_0x33c895=_0x5e1a95[_0x311853(0x2a4)],_0x2fb6df=await profile[_0x311853(0x2db)]({'email':_0x33c895[_0x311853(0x267)]}),_0x55c3ea=await staff[_0x311853(0x2db)]({'email':_0x33c895['email']}),_0x46ead5=await master_shop[_0x311853(0x21c)]();let _0x51c17=await transfers_finished[_0x311853(0x219)]([{'$match':{'to_warehouse':_0x55c3ea[_0x311853(0x2ec)]}}]);if(_0x46ead5[0x0]['language']==_0x311853(0x20c))var _0xb60de4=users[_0x311853(0x202)];else{if(_0x46ead5[0x0][_0x311853(0x26c)]==_0x311853(0x25e))var _0xb60de4=users[_0x311853(0x25e)];else{if(_0x46ead5[0x0][_0x311853(0x26c)]==_0x311853(0x28c))var _0xb60de4=users['German'];else{if(_0x46ead5[0x0]['language']==_0x311853(0x1f9))var _0xb60de4=users[_0x311853(0x1f9)];else{if(_0x46ead5[0x0]['language']==_0x311853(0x266))var _0xb60de4=users[_0x311853(0x266)];else{if(_0x46ead5[0x0][_0x311853(0x26c)]==_0x311853(0x1b0))var _0xb60de4=users[_0x311853(0x2a3)];else{if(_0x46ead5[0x0][_0x311853(0x26c)]==_0x311853(0x255))var _0xb60de4=users[_0x311853(0x255)];else{if(_0x46ead5[0x0][_0x311853(0x26c)]==_0x311853(0x2ef))var _0xb60de4=users['Arabic'];}}}}}}}_0x24a811[_0x311853(0x2b5)]('incoming_view',{'success':_0x5e1a95[_0x311853(0x23c)](_0x311853(0x2bb)),'errors':_0x5e1a95[_0x311853(0x23c)](_0x311853(0x1db)),'purchases':_0x51c17,'role':_0x33c895,'profile':_0x2fb6df,'master_shop':_0x46ead5,'language':_0xb60de4,'staff_data':_0x55c3ea});}catch(_0x4d1545){console[_0x311853(0x1d5)](_0x311853(0x288),_0x4d1545),_0x24a811[_0x311853(0x1fa)](0xc8)[_0x311853(0x239)]({'message':_0x4d1545[_0x311853(0x27f)]});}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x231),auth,async(_0x3ed090,_0x17beaa)=>{var _0x403146=a0_0x275920;try{const {username:_0x30268f,email:_0x5b400f,role:_0x369bb4}=_0x3ed090[_0x403146(0x2a4)],_0x48677c=_0x3ed090[_0x403146(0x2a4)],_0x1c1474=await profile[_0x403146(0x2db)]({'email':_0x48677c[_0x403146(0x267)]}),_0x1214e0=await staff['findOne']({'email':_0x48677c['email']}),_0x4a2540=await master_shop['find']();let _0x45b195=await transfers_finished[_0x403146(0x219)]([{'$match':{'to_warehouse':_0x1214e0[_0x403146(0x2ec)],'to_recieved':_0x403146(0x26b)}}]);if(_0x4a2540[0x0][_0x403146(0x26c)]==_0x403146(0x20c))var _0x4d188f=users[_0x403146(0x202)];else{if(_0x4a2540[0x0]['language']=='Hindi')var _0x4d188f=users['Hindi'];else{if(_0x4a2540[0x0][_0x403146(0x26c)]==_0x403146(0x28c))var _0x4d188f=users['German'];else{if(_0x4a2540[0x0][_0x403146(0x26c)]==_0x403146(0x1f9))var _0x4d188f=users[_0x403146(0x1f9)];else{if(_0x4a2540[0x0][_0x403146(0x26c)]=='French')var _0x4d188f=users[_0x403146(0x266)];else{if(_0x4a2540[0x0][_0x403146(0x26c)]==_0x403146(0x1b0))var _0x4d188f=users[_0x403146(0x2a3)];else{if(_0x4a2540[0x0]['language']==_0x403146(0x255))var _0x4d188f=users[_0x403146(0x255)];else{if(_0x4a2540[0x0][_0x403146(0x26c)]==_0x403146(0x2ef))var _0x4d188f=users[_0x403146(0x20e)];}}}}}}}_0x17beaa[_0x403146(0x2b5)]('incoming_add',{'success':_0x3ed090[_0x403146(0x23c)](_0x403146(0x2bb)),'errors':_0x3ed090[_0x403146(0x23c)]('errors'),'purchases':_0x45b195,'role':_0x48677c,'profile':_0x1c1474,'master_shop':_0x4a2540,'language':_0x4d188f,'staff_data':_0x1214e0});}catch(_0x2cefd8){console[_0x403146(0x1d5)](_0x403146(0x288),_0x2cefd8),_0x17beaa[_0x403146(0x1fa)](0xc8)['json']({'message':_0x2cefd8[_0x403146(0x27f)]});}});const createLog=async _0x1946f8=>{var _0x1f7d17=a0_0x275920;const _0x498aa8=new datalogs({'location':_0x1946f8});return await _0x498aa8[_0x1f7d17(0x2c0)](),_0x498aa8['invoice_init'];};router[a0_0x275920(0x1c5)](a0_0x275920(0x231),auth,async(_0x310d72,_0x507e32)=>{var _0x5ae6cf=a0_0x275920;try{const {invoice_trf_data:_0x233481,item_code:_0xb5b4f4,SCRN:_0x4ca047,ReqBy:_0x44d5fc,type_of_products:_0xa9d1ea,dateofreq:_0x30961d,PO_number:_0x2e891a,date:_0xcc3630,warehouse_name:_0x105e76,typeservicesData:_0x28a887,typevehicle:_0x4769a4,driver:_0x12cefc,plate:_0x5d2381,van:_0x3a89a6,DRSI:_0x79a83c,TSU:_0x3bb064,TFU:_0x37eea9,note:_0x3e2fab}=_0x310d72['body'],_0x5ad6e2=await transfers_finished[_0x5ae6cf(0x1fc)](_0x233481);if(typeof _0xb5b4f4==_0x5ae6cf(0x2a2))var _0xc5d14e=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x281)]],_0x4efd52=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x1f0)]],_0x56b2c3=[_0x310d72['body']['to_quantity']],_0x463047=[_0x310d72['body'][_0x5ae6cf(0x2a1)]],_0xbb0968=[_0x310d72['body'][_0x5ae6cf(0x290)]],_0x8dccbb=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x25d)]],_0x2feb56=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x264)]],_0x50ebf0=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x2ce)]],_0x15c949=[_0x310d72['body'][_0x5ae6cf(0x226)]],_0x5b2106=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x214)]],_0x57fb3b=[_0x310d72[_0x5ae6cf(0x1ce)]['production_date']],_0x4672c0=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x2e3)]],_0x1376eb=[_0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x27d)]];else var _0xc5d14e=[..._0x310d72['body'][_0x5ae6cf(0x281)]],_0x4efd52=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x1f0)]],_0x56b2c3=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x21f)]],_0x463047=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x2a1)]],_0xbb0968=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x290)]],_0x8dccbb=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x25d)]],_0x2feb56=[..._0x310d72[_0x5ae6cf(0x1ce)]['primary_code']],_0x50ebf0=[..._0x310d72[_0x5ae6cf(0x1ce)]['secondary_code']],_0x15c949=[..._0x310d72[_0x5ae6cf(0x1ce)]['batch_code']],_0x5b2106=[..._0x310d72[_0x5ae6cf(0x1ce)]['expiry_date']],_0x57fb3b=[..._0x310d72[_0x5ae6cf(0x1ce)]['production_date']],_0x4672c0=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x2e3)]],_0x1376eb=[..._0x310d72[_0x5ae6cf(0x1ce)][_0x5ae6cf(0x27d)]];const _0x24612d=_0xc5d14e[_0x5ae6cf(0x20f)](_0x1b4ff0=>{return _0x1b4ff0={'product_name':_0x1b4ff0};});_0x4efd52['forEach']((_0x3b5b64,_0x3e815a)=>{var _0x50dcc8=_0x5ae6cf;_0x24612d[_0x3e815a][_0x50dcc8(0x2ed)]=_0x3b5b64;}),_0x56b2c3[_0x5ae6cf(0x27a)]((_0x3ffd01,_0x2e5f1d)=>{var _0x402603=_0x5ae6cf;_0x24612d[_0x2e5f1d]['quantity']=Math[_0x402603(0x1ea)](_0x3ffd01);}),_0x463047[_0x5ae6cf(0x27a)]((_0x4c56b6,_0x580288)=>{_0x24612d[_0x580288]['standard_unit']=_0x4c56b6;}),_0xbb0968['forEach']((_0x30b572,_0xc53c9e)=>{var _0x37ecf5=_0x5ae6cf;_0x24612d[_0xc53c9e][_0x37ecf5(0x1eb)]=_0x30b572;}),_0x8dccbb['forEach']((_0x21526a,_0x3a0406)=>{var _0x2295c4=_0x5ae6cf,_0x105049=_0x21526a['match'](/[A-Za-z]+/)[0x0],_0x25e853=parseInt(_0x21526a[_0x2295c4(0x22c)](/\d+/)[0x0]);_0x24612d[_0x3a0406]['level']=_0x105049,_0x24612d[_0x3a0406][_0x2295c4(0x25a)]=_0x25e853;}),_0x2feb56[_0x5ae6cf(0x27a)]((_0x9df0e8,_0x1dcfd2)=>{var _0x373f5d=_0x5ae6cf;_0x24612d[_0x1dcfd2][_0x373f5d(0x264)]=_0x9df0e8;}),_0x50ebf0[_0x5ae6cf(0x27a)]((_0x225251,_0x2639e8)=>{var _0x37d3c9=_0x5ae6cf;_0x24612d[_0x2639e8][_0x37d3c9(0x2ce)]=_0x225251;}),_0x15c949[_0x5ae6cf(0x27a)]((_0x1f3a6f,_0xb73cb)=>{_0x24612d[_0xb73cb]['batch_code']=_0x1f3a6f;}),_0x5b2106[_0x5ae6cf(0x27a)]((_0x51c0fb,_0x50db1c)=>{_0x24612d[_0x50db1c]['expiry_date']=_0x51c0fb;}),_0x57fb3b[_0x5ae6cf(0x27a)]((_0x3b3b35,_0x435932)=>{var _0x2ab467=_0x5ae6cf;_0x24612d[_0x435932][_0x2ab467(0x215)]=_0x3b3b35;}),_0x4672c0[_0x5ae6cf(0x27a)]((_0x55da0a,_0x39633f)=>{var _0x5e4da4=_0x5ae6cf;_0x24612d[_0x39633f][_0x5e4da4(0x2f4)]=_0x55da0a;}),_0x1376eb['forEach']((_0x4f1126,_0x245cf1)=>{var _0x2592dc=_0x5ae6cf;_0x24612d[_0x245cf1][_0x2592dc(0x2b1)]=_0x4f1126;});const _0x34cba0=await createLog(_0x5ae6cf(0x2c3));_0x1376eb[_0x5ae6cf(0x27a)]((_0x53f398,_0x212294)=>{var _0x3290b8=_0x5ae6cf;_0x24612d[_0x212294][_0x3290b8(0x2c4)]='INC-'+_0x34cba0['toString']()[_0x3290b8(0x24b)](0x8,'0');});const _0x39d3e0=_0x24612d[_0x5ae6cf(0x2cf)](_0x23783e=>_0x23783e[_0x5ae6cf(0x1bd)]!=='0'&&_0x23783e[_0x5ae6cf(0x1bd)]!==''),_0x3edca5=new purchases_incoming({'invoice':_0x5ae6cf(0x251)+_0x34cba0[_0x5ae6cf(0x2c7)]()['padStart'](0x8,'0'),'date':_0xcc3630,'warehouse_name':_0x105e76,'product':_0x39d3e0,'note':_0x3e2fab,'POnumber':_0x2e891a,'SCRN':_0x4ca047,'ReqBy':_0x44d5fc,'dateofreq':_0x30961d,'typeservicesData':_0x28a887,'van':_0x3a89a6,'typevehicle':_0x4769a4,'driver':_0x12cefc,'plate':_0x5d2381,'DRSI':_0x79a83c,'TSU':_0x3bb064,'TFU':_0x37eea9,'typeOfProducts':_0xa9d1ea}),_0xe28cf5=await _0x3edca5['save'](),_0x50264c=_0xe28cf5[_0x5ae6cf(0x2c8)][_0x5ae6cf(0x20f)](async _0x52fe71=>{var _0x454d95=_0x5ae6cf,_0x26f8d8=await warehouse[_0x454d95(0x2db)]({'name':_0x105e76,'room':_0x52fe71[_0x454d95(0x2b1)]});if(_0x52fe71[_0x454d95(0x1bd)]>0x0){var _0x18aeb3=0x0;const _0x30f1a5=_0x26f8d8[_0x454d95(0x287)]['map'](_0x426a87=>{var _0x4415cd=_0x454d95;_0x426a87[_0x4415cd(0x281)]==_0x52fe71[_0x4415cd(0x281)]&&_0x426a87[_0x4415cd(0x25a)]==_0x52fe71[_0x4415cd(0x258)]&&_0x426a87[_0x4415cd(0x214)]==_0x52fe71[_0x4415cd(0x214)]&&_0x426a87['production_date']==_0x52fe71[_0x4415cd(0x215)]&&_0x426a87['batch_code']==_0x52fe71[_0x4415cd(0x226)]&&_0x426a87['invoice']==_0x52fe71[_0x4415cd(0x2c4)]&&(typeof _0x52fe71[_0x4415cd(0x1c3)]=='undefined'?(console[_0x4415cd(0x1d5)](_0x4415cd(0x1c4),_0x426a87[_0x4415cd(0x2e4)]+_0x4415cd(0x21d)+_0x426a87[_0x4415cd(0x2e0)]+'\x20<=>\x20'+Math[_0x4415cd(0x1ea)](_0x426a87['product_stock'])+Math[_0x4415cd(0x1ea)](_0x52fe71[_0x4415cd(0x21f)])),_0x426a87[_0x4415cd(0x2e4)]=Math[_0x4415cd(0x1ea)](_0x426a87[_0x4415cd(0x2e4)])+Math[_0x4415cd(0x1ea)](_0x52fe71[_0x4415cd(0x1bd)])):(_0x426a87[_0x4415cd(0x2e4)]=Math[_0x4415cd(0x1ea)](_0x426a87[_0x4415cd(0x2e4)])+Math[_0x4415cd(0x1ea)](_0x52fe71[_0x4415cd(0x1bd)]),_0x18aeb3++));});_0x18aeb3=='0'&&(_0x26f8d8[_0x454d95(0x287)]=_0x26f8d8[_0x454d95(0x287)]['concat']({'product_name':_0x52fe71['product_name'],'product_stock':_0x52fe71[_0x454d95(0x1bd)],'bay':_0x52fe71[_0x454d95(0x25a)],'level':_0x52fe71[_0x454d95(0x2e1)],'product_code':_0x52fe71['product_code'],'primary_code':_0x52fe71[_0x454d95(0x264)],'secondary_code':_0x52fe71[_0x454d95(0x2ce)],'expiry_date':_0x52fe71[_0x454d95(0x214)],'production_date':_0x52fe71[_0x454d95(0x215)],'maxProducts':_0x52fe71['maxProducts'],'batch_code':_0x52fe71[_0x454d95(0x226)],'secondary_unit':_0x52fe71['secondary_unit'],'unit':_0x52fe71[_0x454d95(0x1b1)],'maxProducts':_0x52fe71[_0x454d95(0x22e)],'maxPerUnit':_0x52fe71[_0x454d95(0x2c1)],'invoice':_0x52fe71[_0x454d95(0x2c4)]}));}return _0x26f8d8;});Promise['all'](_0x50264c)[_0x5ae6cf(0x225)](async _0x5cf43d=>{var _0x5c63da=_0x5ae6cf;try{for(const _0x90c1a6 of _0x5cf43d){await warehouse[_0x5c63da(0x207)]({'_id':_0x90c1a6[_0x5c63da(0x2e0)]},{'$addToSet':{'product_details':{'$each':_0x90c1a6[_0x5c63da(0x287)]}}});}_0x5ad6e2['to_recieved']=_0x5c63da(0x2ca);const _0x43068a=await _0x5ad6e2[_0x5c63da(0x2c0)](),_0x2b9ce7=await master_shop['find'](),_0x290906=await email_settings[_0x5c63da(0x2db)](),_0x9c0a9a=await supervisor_settings[_0x5c63da(0x21c)]();var _0x14f348=_0x3edca5[_0x5c63da(0x2c8)],_0x50e9dd='',_0x5ba0dc;for(_0x5ba0dc in _0x14f348){var _0x31158a='FG';_0x3edca5[_0x5c63da(0x224)]==_0x5c63da(0x24d)&&(_0x31158a='DG'),_0x50e9dd+=_0x5c63da(0x257)+_0x5c63da(0x2e5)+_0x14f348[_0x5ba0dc][_0x5c63da(0x281)]+_0x5c63da(0x293)+_0x5c63da(0x2e5)+_0x14f348[_0x5ba0dc][_0x5c63da(0x2ed)]+_0x5c63da(0x293)+_0x5c63da(0x2e5)+_0x14f348[_0x5ba0dc]['to_quantity']+'</td>'+_0x5c63da(0x2e5)+_0x14f348[_0x5ba0dc][_0x5c63da(0x2a1)]+_0x5c63da(0x293)+_0x5c63da(0x2e5)+_0x14f348[_0x5ba0dc][_0x5c63da(0x1eb)]+_0x5c63da(0x293)+_0x5c63da(0x2e5)+_0x3edca5[_0x5c63da(0x224)]+_0x5c63da(0x293)+_0x5c63da(0x2e5)+_0x14f348[_0x5ba0dc]['to_room_name']+_0x5c63da(0x293)+_0x5c63da(0x2e5)+_0x31158a+_0x14f348[_0x5ba0dc][_0x5c63da(0x258)]+_0x5c63da(0x293)+'</tr>';}_0x310d72['flash'](_0x5c63da(0x2bb),_0x5c63da(0x1e1)),_0x507e32['redirect'](_0x5c63da(0x1d2)+_0xe28cf5[_0x5c63da(0x2e0)]);}catch(_0x2ab0de){console[_0x5c63da(0x274)](_0x2ab0de),_0x507e32['status'](0x1f4)[_0x5c63da(0x239)]({'error':_0x5c63da(0x2eb)});}})[_0x5ae6cf(0x2bd)](_0x122147=>{var _0x45bdee=_0x5ae6cf;console[_0x45bdee(0x274)](_0x122147),_0x507e32[_0x45bdee(0x1fa)](0x1f4)[_0x45bdee(0x239)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3bf168){}}),router['post']('/getTRF',auth,async(_0x346fa6,_0x355cdf)=>{var _0x31a888=a0_0x275920;try{const {warehouse:_0x39958f}=_0x346fa6[_0x31a888(0x1ce)],_0xf8aaf3=await transfers_finished[_0x31a888(0x21c)]({'to_warehouse':_0x39958f,'to_recieved':_0x31a888(0x26b)});_0x355cdf[_0x31a888(0x239)](_0xf8aaf3);}catch(_0xebab7b){}}),router[a0_0x275920(0x1c5)](a0_0x275920(0x1ff),auth,async(_0x3a7713,_0x5b5cb8)=>{var _0x31b9f7=a0_0x275920;try{const {invoice:_0x212713}=_0x3a7713[_0x31b9f7(0x1ce)],_0x5d6092=await transfers_finished['find']({'_id':_0x212713,'to_recieved':_0x31b9f7(0x26b)});_0x5b5cb8[_0x31b9f7(0x239)](_0x5d6092);}catch(_0x2f3891){}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x249),auth,async(_0x1c9f39,_0x700d6e)=>{var _0x11711e=a0_0x275920;try{const {username:_0x149af1,email:_0x504da1,role:_0x3840bb}=_0x1c9f39[_0x11711e(0x2a4)],_0x49086c=_0x1c9f39[_0x11711e(0x2a4)],_0x5da250=await profile[_0x11711e(0x2db)]({'email':_0x49086c[_0x11711e(0x267)]}),_0x4553f9=await staff['findOne']({'email':_0x49086c[_0x11711e(0x267)]});if(_0x49086c[_0x11711e(0x28e)]=='staff'){const _0x490774=await staff[_0x11711e(0x2db)]({'email':_0x49086c[_0x11711e(0x267)]});}const _0x5a33cf=await master_shop[_0x11711e(0x21c)]();let _0x564917;if(_0x49086c[_0x11711e(0x28e)]==_0x11711e(0x1e2)){const _0x3900f9=await staff[_0x11711e(0x2db)]({'email':_0x49086c['email']});_0x564917=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x3900f9['warehouse'],'typeOfProducts':_0x11711e(0x25f)}},{'$lookup':{'from':_0x11711e(0x272),'localField':'suppliers','foreignField':_0x11711e(0x2d2),'as':_0x11711e(0x2af)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x11711e(0x228)},'suppliers':{'$first':_0x11711e(0x260)},'date':{'$first':_0x11711e(0x276)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x11711e(0x250)},'product':{'$push':_0x11711e(0x2f0)},'note':{'$first':_0x11711e(0x2b7)},'paid_amount':{'$first':_0x11711e(0x296)},'due_amount':{'$first':_0x11711e(0x298)},'return_data':{'$first':_0x11711e(0x2c2)},'batch_code':{'$first':_0x11711e(0x29a)},'expiry_date':{'$first':_0x11711e(0x261)},'suppliers_docs':{'$first':_0x11711e(0x265)},'total_product_quantity':{'$sum':_0x11711e(0x23b)},'level':{'$addToSet':_0x11711e(0x24f)},'isle':{'$addToSet':_0x11711e(0x230)},'type':{'$addToSet':_0x11711e(0x1b6)},'floorlevel':{'$addToSet':_0x11711e(0x2b6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x564917=await purchases_finished[_0x11711e(0x219)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$product'},{'$group':{'_id':_0x11711e(0x1e9),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x11711e(0x260)},'date':{'$first':_0x11711e(0x276)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x11711e(0x2a5)},'product':{'$push':_0x11711e(0x2f0)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x11711e(0x296)},'due_amount':{'$first':_0x11711e(0x298)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x11711e(0x23b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x11711e(0x230)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5a33cf[0x0][_0x11711e(0x26c)]==_0x11711e(0x20c))var _0x2ed202=users[_0x11711e(0x202)];else{if(_0x5a33cf[0x0]['language']==_0x11711e(0x25e))var _0x2ed202=users[_0x11711e(0x25e)];else{if(_0x5a33cf[0x0][_0x11711e(0x26c)]==_0x11711e(0x28c))var _0x2ed202=users[_0x11711e(0x28c)];else{if(_0x5a33cf[0x0][_0x11711e(0x26c)]=='Spanish')var _0x2ed202=users[_0x11711e(0x1f9)];else{if(_0x5a33cf[0x0][_0x11711e(0x26c)]=='French')var _0x2ed202=users['French'];else{if(_0x5a33cf[0x0][_0x11711e(0x26c)]=='Portuguese\x20(BR)')var _0x2ed202=users['Portuguese'];else{if(_0x5a33cf[0x0]['language']==_0x11711e(0x255))var _0x2ed202=users[_0x11711e(0x255)];else{if(_0x5a33cf[0x0][_0x11711e(0x26c)]=='Arabic\x20(ae)')var _0x2ed202=users[_0x11711e(0x20e)];}}}}}}}_0x700d6e[_0x11711e(0x2b5)](_0x11711e(0x1f1),{'success':_0x1c9f39[_0x11711e(0x23c)](_0x11711e(0x2bb)),'errors':_0x1c9f39[_0x11711e(0x23c)](_0x11711e(0x1db)),'purchases':_0x564917,'role':_0x49086c,'profile':_0x5da250,'master_shop':_0x5a33cf,'language':_0x2ed202});}catch(_0xf3da2a){console[_0x11711e(0x1d5)]('table\x20page',_0xf3da2a),_0x700d6e['status'](0xc8)[_0x11711e(0x239)]({'message':_0xf3da2a[_0x11711e(0x27f)]});}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x1b3),auth,async(_0x4d71dd,_0x2b7c6b)=>{var _0x3058d3=a0_0x275920;try{const {username:_0x47faa3,email:_0x3047f9,role:_0x3f9d32}=_0x4d71dd['user'],_0x36358b=_0x4d71dd[_0x3058d3(0x2a4)],_0x57e6db=await profile[_0x3058d3(0x2db)]({'email':_0x36358b[_0x3058d3(0x267)]}),_0x38f63f=await staff[_0x3058d3(0x2db)]({'email':_0x36358b[_0x3058d3(0x267)]});if(_0x36358b[_0x3058d3(0x28e)]==_0x3058d3(0x1e2)){const _0x56b25e=await staff[_0x3058d3(0x2db)]({'email':_0x36358b[_0x3058d3(0x267)]});}const _0x471e4e=await master_shop[_0x3058d3(0x21c)]();let _0x431b16;if(_0x36358b[_0x3058d3(0x28e)]=='staff'){const _0x143e4b=await staff[_0x3058d3(0x2db)]({'email':_0x36358b[_0x3058d3(0x267)]});_0x431b16=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x143e4b['warehouse']}},{'$lookup':{'from':_0x3058d3(0x272),'localField':_0x3058d3(0x272),'foreignField':_0x3058d3(0x2d2),'as':_0x3058d3(0x2af)}},{'$unwind':_0x3058d3(0x265)},{'$unwind':_0x3058d3(0x2f0)},{'$group':{'_id':_0x3058d3(0x1e9),'invoice':{'$first':_0x3058d3(0x228)},'suppliers':{'$first':_0x3058d3(0x260)},'date':{'$first':_0x3058d3(0x276)},'warehouse_name':{'$first':_0x3058d3(0x2c9)},'room':{'$first':_0x3058d3(0x250)},'product':{'$push':_0x3058d3(0x2f0)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x3058d3(0x298)},'return_data':{'$first':_0x3058d3(0x2c2)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x3058d3(0x261)},'suppliers_docs':{'$first':_0x3058d3(0x265)},'total_product_quantity':{'$sum':_0x3058d3(0x23b)},'level':{'$addToSet':_0x3058d3(0x24f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x3058d3(0x2b6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x431b16=await purchases_finished[_0x3058d3(0x219)]([{'$match':{'typeOfProducts':_0x3058d3(0x1c9)}},{'$unwind':_0x3058d3(0x2f0)},{'$group':{'_id':_0x3058d3(0x1e9),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x3058d3(0x260)},'date':{'$first':_0x3058d3(0x276)},'warehouse_name':{'$first':_0x3058d3(0x2c9)},'room':{'$addToSet':_0x3058d3(0x2a5)},'product':{'$push':_0x3058d3(0x2f0)},'note':{'$first':_0x3058d3(0x2b7)},'paid_amount':{'$first':_0x3058d3(0x296)},'due_amount':{'$first':_0x3058d3(0x298)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x3058d3(0x29a)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3058d3(0x265)},'total_product_quantity':{'$sum':_0x3058d3(0x23b)},'level':{'$addToSet':_0x3058d3(0x24f)},'isle':{'$addToSet':_0x3058d3(0x230)},'type':{'$addToSet':_0x3058d3(0x1b6)},'floorlevel':{'$addToSet':_0x3058d3(0x2b6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x471e4e[0x0][_0x3058d3(0x26c)]==_0x3058d3(0x20c))var _0x59bee9=users['English'];else{if(_0x471e4e[0x0][_0x3058d3(0x26c)]==_0x3058d3(0x25e))var _0x59bee9=users[_0x3058d3(0x25e)];else{if(_0x471e4e[0x0]['language']=='German')var _0x59bee9=users['German'];else{if(_0x471e4e[0x0][_0x3058d3(0x26c)]==_0x3058d3(0x1f9))var _0x59bee9=users['Spanish'];else{if(_0x471e4e[0x0]['language']==_0x3058d3(0x266))var _0x59bee9=users[_0x3058d3(0x266)];else{if(_0x471e4e[0x0][_0x3058d3(0x26c)]=='Portuguese\x20(BR)')var _0x59bee9=users[_0x3058d3(0x2a3)];else{if(_0x471e4e[0x0][_0x3058d3(0x26c)]==_0x3058d3(0x255))var _0x59bee9=users[_0x3058d3(0x255)];else{if(_0x471e4e[0x0]['language']==_0x3058d3(0x2ef))var _0x59bee9=users[_0x3058d3(0x20e)];}}}}}}}_0x2b7c6b['render']('all_purchases_finished_logs',{'success':_0x4d71dd[_0x3058d3(0x23c)](_0x3058d3(0x2bb)),'errors':_0x4d71dd[_0x3058d3(0x23c)](_0x3058d3(0x1db)),'purchases':_0x431b16,'role':_0x36358b,'profile':_0x57e6db,'master_shop':_0x471e4e,'language':_0x59bee9});}catch(_0x4e3244){console['log'](_0x3058d3(0x288),_0x4e3244),_0x2b7c6b[_0x3058d3(0x1fa)](0xc8)[_0x3058d3(0x239)]({'message':_0x4e3244[_0x3058d3(0x27f)]});}});function BayBinSelected(_0x5bdf99,_0x457eb1){var _0x3bc01a=a0_0x275920,_0x3a7957=[],_0x913179=[];if(_0x5bdf99==_0x3bc01a(0x24d)){switch(_0x457eb1){case'Rack\x201':_0x3a7957=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x3a7957=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x913179=['DG'];}else{if(_0x5bdf99=='FROZEN\x20GOODS'){switch(_0x457eb1){case _0x3bc01a(0x2d3):_0x3a7957=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x3a7957=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x913179=['FG'];}}return{'levels':_0x3a7957,'identify':_0x913179};}async function getRandom8DigitNumber(){var _0x548363=a0_0x275920;const _0x5a3bea=0x989680,_0x2e0cce=0x5f5e0ff,_0x34f532=Math[_0x548363(0x2dc)](Math[_0x548363(0x1ba)]()*(_0x2e0cce-_0x5a3bea+0x1))+_0x5a3bea;var _0x1a8974;const _0x5a87b8=await purchases_finished[_0x548363(0x2db)]({'invoice':'INCF-'+_0x34f532});return _0x5a87b8&&_0x5a87b8[_0x548363(0x2bc)]>0x0?_0x1a8974=_0x548363(0x212)+_0x34f532:_0x1a8974=_0x548363(0x212)+_0x34f532,_0x1a8974;}function a0_0x2a3f(_0x4efab8,_0x59c1f5){var _0x1bcaa8=a0_0x1bca();return a0_0x2a3f=function(_0x2a3f31,_0x4d9c58){_0x2a3f31=_0x2a3f31-0x1af;var _0x44d836=_0x1bcaa8[_0x2a3f31];return _0x44d836;},a0_0x2a3f(_0x4efab8,_0x59c1f5);}router[a0_0x275920(0x2ad)](a0_0x275920(0x1fd),auth,async(_0xa0a041,_0xea25e0)=>{var _0x43a9db=a0_0x275920;try{const {username:_0x3a60c9,email:_0x1c1600,role:_0x344348}=_0xa0a041['user'],_0x110100=_0xa0a041[_0x43a9db(0x2a4)],_0xb06a04=await profile[_0x43a9db(0x2db)]({'email':_0x110100[_0x43a9db(0x267)]}),_0x468d35=await master_shop[_0x43a9db(0x21c)](),_0x359b0a=await staff[_0x43a9db(0x2db)]({'email':_0x110100[_0x43a9db(0x267)]}),_0x5969fe=await suppliers[_0x43a9db(0x21c)]({});let _0x5bdab1;if(_0x110100[_0x43a9db(0x28e)]=='staff'){const _0xd1ea93=await staff[_0x43a9db(0x2db)]({'email':_0x110100[_0x43a9db(0x267)]});_0x5bdab1=await warehouse[_0x43a9db(0x219)]([{'$match':{'status':'Enabled','name':_0xd1ea93[_0x43a9db(0x2ec)]}},{'$group':{'_id':_0x43a9db(0x1b5),'name':{'$first':_0x43a9db(0x1b5)}}}]);}else _0x5bdab1=await warehouse['aggregate']([{'$match':{'status':_0x43a9db(0x1bf)}},{'$group':{'_id':_0x43a9db(0x1b5),'name':{'$first':_0x43a9db(0x1b5)}}}]);const _0xcd8773=await product[_0x43a9db(0x21c)]({}),_0x2c76ce=await warehouse[_0x43a9db(0x21c)]({'status':'Enabled'}),_0x3fe143=await purchases_finished['find']({}),_0x29e031=_0x3fe143[_0x43a9db(0x2bc)]+0x1,_0xa050c1='INCF-'+_0x29e031[_0x43a9db(0x2c7)]()[_0x43a9db(0x24b)](0x5,'0');var _0x529444=[_0x43a9db(0x2d7),_0x43a9db(0x22f)];if(_0x468d35[0x0]['language']==_0x43a9db(0x20c))var _0x4813bd=users[_0x43a9db(0x202)];else{if(_0x468d35[0x0][_0x43a9db(0x26c)]==_0x43a9db(0x25e))var _0x4813bd=users[_0x43a9db(0x25e)];else{if(_0x468d35[0x0][_0x43a9db(0x26c)]==_0x43a9db(0x28c))var _0x4813bd=users[_0x43a9db(0x28c)];else{if(_0x468d35[0x0][_0x43a9db(0x26c)]==_0x43a9db(0x1f9))var _0x4813bd=users['Spanish'];else{if(_0x468d35[0x0]['language']==_0x43a9db(0x266))var _0x4813bd=users[_0x43a9db(0x266)];else{if(_0x468d35[0x0][_0x43a9db(0x26c)]=='Portuguese\x20(BR)')var _0x4813bd=users[_0x43a9db(0x2a3)];else{if(_0x468d35[0x0][_0x43a9db(0x26c)]==_0x43a9db(0x255))var _0x4813bd=users[_0x43a9db(0x255)];else{if(_0x468d35[0x0][_0x43a9db(0x26c)]==_0x43a9db(0x2ef))var _0x4813bd=users[_0x43a9db(0x20e)];}}}}}}}const _0xe9ae97=getRandom8DigitNumber(),_0x174ad6=new Date(),_0x596a2e={'year':'numeric','month':'2-digit','day':_0x43a9db(0x24c),'timeZone':_0x43a9db(0x2a9)},_0x15afec=_0x174ad6['toLocaleDateString']('en-CA',_0x596a2e);console[_0x43a9db(0x1d5)](_0x15afec),_0xe9ae97[_0x43a9db(0x225)](_0x1824b8=>{var _0x1a267d=_0x43a9db;_0xea25e0[_0x1a267d(0x2b5)](_0x1a267d(0x2b2),{'success':_0xa0a041[_0x1a267d(0x23c)](_0x1a267d(0x2bb)),'errors':_0xa0a041[_0x1a267d(0x23c)]('errors'),'role':_0x110100,'profile':_0xb06a04,'suppliers':_0x5969fe,'warehouse':_0x5bdab1,'product':_0xcd8773,'invoice':_0x1824b8,'master_shop':_0x468d35,'language':_0x4813bd,'find_data':_0x2c76ce,'rooms_data':_0x529444,'formattedDate':_0x15afec});})[_0x43a9db(0x2bd)](_0x55f208=>{var _0x105ce1=_0x43a9db;_0xa0a041['flash'](_0x105ce1(0x1db),_0x105ce1(0x1e5)),_0xea25e0[_0x105ce1(0x247)](_0x105ce1(0x1ed));});}catch(_0x457221){console['log'](_0x457221);}}),router['get'](a0_0x275920(0x2d4),auth,async(_0x418b0d,_0x7e8dbe)=>{var _0x271518=a0_0x275920;try{const {username:_0x59d262,email:_0x1324f1,role:_0x47df69}=_0x418b0d[_0x271518(0x2a4)],_0x543e7b=_0x418b0d[_0x271518(0x2a4)],_0x17eed8=await profile[_0x271518(0x2db)]({'email':_0x543e7b[_0x271518(0x267)]}),_0x40c516=await master_shop[_0x271518(0x21c)](),_0x52776e=await staff[_0x271518(0x2db)]({'email':_0x543e7b[_0x271518(0x267)]}),_0x56d1b6=await suppliers[_0x271518(0x21c)]({});let _0x1e21cc;if(_0x543e7b[_0x271518(0x28e)]==_0x271518(0x1e2)){const _0xb133b7=await staff[_0x271518(0x2db)]({'email':_0x543e7b[_0x271518(0x267)]});_0x1e21cc=await warehouse[_0x271518(0x219)]([{'$match':{'status':_0x271518(0x1bf),'name':_0xb133b7['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x271518(0x1b5)}}}]);}else _0x1e21cc=await warehouse[_0x271518(0x219)]([{'$match':{'status':_0x271518(0x1bf)}},{'$group':{'_id':_0x271518(0x1b5),'name':{'$first':_0x271518(0x1b5)}}}]);const _0x59909a=await product[_0x271518(0x21c)]({}),_0x3fd7ec=await warehouse[_0x271518(0x21c)]({'status':'Enabled'}),_0x861876=await purchases_finished[_0x271518(0x21c)]({}),_0x2246d9=_0x861876[_0x271518(0x2bc)]+0x1,_0xb82aa2=_0x271518(0x212)+_0x2246d9[_0x271518(0x2c7)]()[_0x271518(0x24b)](0x5,'0');var _0x3fe421=['Ambient',_0x271518(0x22f)];if(_0x40c516[0x0][_0x271518(0x26c)]==_0x271518(0x20c))var _0x3db5ce=users['English'];else{if(_0x40c516[0x0][_0x271518(0x26c)]==_0x271518(0x25e))var _0x3db5ce=users['Hindi'];else{if(_0x40c516[0x0][_0x271518(0x26c)]=='German')var _0x3db5ce=users[_0x271518(0x28c)];else{if(_0x40c516[0x0][_0x271518(0x26c)]==_0x271518(0x1f9))var _0x3db5ce=users[_0x271518(0x1f9)];else{if(_0x40c516[0x0][_0x271518(0x26c)]==_0x271518(0x266))var _0x3db5ce=users[_0x271518(0x266)];else{if(_0x40c516[0x0][_0x271518(0x26c)]==_0x271518(0x1b0))var _0x3db5ce=users[_0x271518(0x2a3)];else{if(_0x40c516[0x0][_0x271518(0x26c)]==_0x271518(0x255))var _0x3db5ce=users[_0x271518(0x255)];else{if(_0x40c516[0x0]['language']==_0x271518(0x2ef))var _0x3db5ce=users[_0x271518(0x20e)];}}}}}}}const _0x14db00=getRandom8DigitNumber();_0x14db00[_0x271518(0x225)](_0x374969=>{var _0x29b1ea=_0x271518;_0x7e8dbe[_0x29b1ea(0x2b5)](_0x29b1ea(0x2f2),{'success':_0x418b0d['flash'](_0x29b1ea(0x2bb)),'errors':_0x418b0d[_0x29b1ea(0x23c)](_0x29b1ea(0x1db)),'role':_0x543e7b,'profile':_0x17eed8,'suppliers':_0x56d1b6,'warehouse':_0x1e21cc,'product':_0x59909a,'invoice':_0x374969,'master_shop':_0x40c516,'language':_0x3db5ce,'find_data':_0x3fd7ec,'rooms_data':_0x3fe421});})[_0x271518(0x2bd)](_0x5d1560=>{var _0x4d262b=_0x271518;_0x418b0d[_0x4d262b(0x23c)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x7e8dbe[_0x4d262b(0x247)]('/all_purchases_finished/view');});}catch(_0x103aa9){console['log'](_0x103aa9);}}),router[a0_0x275920(0x2ad)]('/view/add_purchases/:id',auth,async(_0x173799,_0x485c74)=>{var _0x2ee62c=a0_0x275920;try{const _0x187ecd=_0x173799[_0x2ee62c(0x2a0)]['id'];console[_0x2ee62c(0x1d5)](_0x187ecd);const _0x55468a=await master_shop[_0x2ee62c(0x21c)]();console[_0x2ee62c(0x1d5)](_0x2ee62c(0x22b),_0x55468a);const _0x4fc5b2=await product[_0x2ee62c(0x2db)]({'name':_0x187ecd});console['log']('product',_0x4fc5b2),_0x485c74[_0x2ee62c(0x1fa)](0xc8)['json']({'product_data':_0x4fc5b2,'master':_0x55468a});}catch(_0x4997e9){console[_0x2ee62c(0x1d5)]('add_purchases\x20error',_0x4997e9);}}),router[a0_0x275920(0x1c5)](a0_0x275920(0x1fd),auth,async(_0x3105b0,_0x19fa0e)=>{var _0x1e435f=a0_0x275920;try{const {invoice:_0x352e0,date:_0x20e45b,warehouse_name:_0x3a75d5,prod_name:_0x2a7314,note:_0x462cdd,due_amount:_0x3c6dad,Room_name:_0x35f9bd,PO_number:_0x5ba84c,SCRN:_0x267123,ReqBy:_0x48a448,dateofreq:_0x22de31,suppliers:_0x18b096,typeservicesData:_0x1ef073,van:_0x5b0865,typevehicle:_0x2e4974,driver:_0x1ca2df,plate:_0x1d1056,DRSI:_0x2cb222,TSU:_0xacfc46,TFU:_0x36769b,JO_number:_0xebca28,type_of_products:_0x2f71ec}=_0x3105b0['body'];if(typeof _0x2a7314==_0x1e435f(0x2a2))var _0x4fb1b4=[_0x3105b0['body']['prod_name']],_0x523430=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x1c2)]],_0x5d625c=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x283)]],_0xdb14de=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x1ef)]],_0x5712e0=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x290)]],_0x4bf5db=[_0x3105b0[_0x1e435f(0x1ce)]['primary_code']],_0x5efe92=[_0x3105b0['body']['secondary_code']],_0x4bb17c=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x252)]],_0x15ee8b=[_0x3105b0[_0x1e435f(0x1ce)]['batch_code']],_0x4ec50b=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x214)]],_0x51497b=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2d1)]],_0xe55ae9=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2e3)]],_0x373264=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x263)]],_0x3ba76a=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2e2)]],_0x2b3ad1=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x1c7)]],_0x2edbd4=[_0x3105b0['body'][_0x1e435f(0x1d4)]],_0x2e0605=[_0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2de)]];else var _0x4fb1b4=[..._0x3105b0['body']['prod_name']],_0x523430=[..._0x3105b0['body'][_0x1e435f(0x1c2)]],_0x5d625c=[..._0x3105b0[_0x1e435f(0x1ce)]['prod_Qty']],_0xdb14de=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x1ef)]],_0x5712e0=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x290)]],_0x4bf5db=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x264)]],_0x5efe92=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2ce)]],_0x4bb17c=[..._0x3105b0['body'][_0x1e435f(0x252)]],_0x15ee8b=[..._0x3105b0['body']['batch_code']],_0x4ec50b=[..._0x3105b0['body'][_0x1e435f(0x214)]],_0x51497b=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2d1)]],_0xe55ae9=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2e3)]],_0x373264=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x263)]],_0x3ba76a=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x2e2)]],_0x2b3ad1=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x1c7)]],_0x2edbd4=[..._0x3105b0[_0x1e435f(0x1ce)][_0x1e435f(0x1d4)]],_0x2e0605=[..._0x3105b0['body']['product_id']];const _0x159671=_0x4fb1b4[_0x1e435f(0x20f)](_0x34598a=>{return _0x34598a={'product_name':_0x34598a};});_0x2e0605[_0x1e435f(0x27a)]((_0x3e7fd1,_0x2a1dfd)=>{var _0x3d4a59=_0x1e435f;_0x159671[_0x2a1dfd][_0x3d4a59(0x2de)]=_0x3e7fd1,_0x159671[_0x2a1dfd][_0x3d4a59(0x1f5)]=_0x20e45b;}),_0x2edbd4[_0x1e435f(0x27a)]((_0x40c527,_0xde746e)=>{var _0x488ffe=_0x1e435f;_0x159671[_0xde746e][_0x488ffe(0x20d)]=_0x40c527;}),_0x523430[_0x1e435f(0x27a)]((_0x44a651,_0x1779fa)=>{var _0x4f82e7=_0x1e435f;_0x159671[_0x1779fa][_0x4f82e7(0x2ed)]=_0x44a651;}),_0x2b3ad1[_0x1e435f(0x27a)]((_0x398976,_0x31bdca)=>{var _0x5b0369=_0x1e435f;_0x159671[_0x31bdca][_0x5b0369(0x1c7)]=_0x398976;}),_0x5d625c[_0x1e435f(0x27a)]((_0x38bcd2,_0x6069d7)=>{var _0x587be6=_0x1e435f;_0x159671[_0x6069d7][_0x587be6(0x1bd)]=Math[_0x587be6(0x1ea)](_0x38bcd2);}),_0xdb14de[_0x1e435f(0x27a)]((_0x449773,_0x26ac77)=>{var _0x363272=_0x1e435f;_0x159671[_0x26ac77][_0x363272(0x1b1)]=_0x449773;}),_0x5712e0[_0x1e435f(0x27a)]((_0x3e2c1e,_0x3e7648)=>{var _0x2f4279=_0x1e435f;_0x159671[_0x3e7648][_0x2f4279(0x1eb)]=_0x3e2c1e;}),_0x4bf5db[_0x1e435f(0x27a)]((_0x664095,_0x356a6c)=>{var _0x4269e4=_0x1e435f;_0x159671[_0x356a6c][_0x4269e4(0x264)]=_0x664095;}),_0x5efe92['forEach']((_0x2e869b,_0x2162d9)=>{_0x159671[_0x2162d9]['secondary_code']=_0x2e869b;}),_0x4bb17c[_0x1e435f(0x27a)]((_0x11d656,_0x5c232f)=>{var _0x1be332=_0x1e435f;_0x159671[_0x5c232f][_0x1be332(0x1d9)]=_0x11d656;}),_0x15ee8b['forEach']((_0x461020,_0x539b0b)=>{var _0x1d7786=_0x1e435f;_0x159671[_0x539b0b][_0x1d7786(0x226)]=_0x461020;}),_0x4ec50b['forEach']((_0x56f0b7,_0x4f2280)=>{var _0x431b81=_0x1e435f;_0x159671[_0x4f2280][_0x431b81(0x214)]=_0x56f0b7;}),_0x51497b['forEach']((_0x18702c,_0x562ddb)=>{var _0x14fa1e=_0x1e435f;_0x159671[_0x562ddb][_0x14fa1e(0x215)]=_0x18702c;}),_0xe55ae9[_0x1e435f(0x27a)]((_0x562555,_0x20a790)=>{_0x159671[_0x20a790]['maxperunit']=_0x562555;}),_0x373264[_0x1e435f(0x27a)]((_0x3abfdf,_0x2efa65)=>{var _0x100010=_0x1e435f;_0x159671[_0x2efa65][_0x100010(0x25c)]=_0x3abfdf;}),_0x3ba76a['forEach']((_0x52b618,_0x17a26f)=>{_0x159671[_0x17a26f]['gross_price']=_0x52b618;});const _0xb17644=new invoice_for_incoming();await _0xb17644[_0x1e435f(0x2c0)]();for(let _0x3c1d40=0x0;_0x3c1d40<=_0x4fb1b4[_0x1e435f(0x2bc)]-0x1;_0x3c1d40++){_0x159671[_0x3c1d40][_0x1e435f(0x2c4)]=_0x1e435f(0x251)+_0xb17644[_0x1e435f(0x244)][_0x1e435f(0x2c7)]()[_0x1e435f(0x24b)](0x8,'0');}const _0x2eb989=await warehouse_validation_setup[_0x1e435f(0x219)]([{'$match':{'warehouse_name':_0x3a75d5}}]);for(let _0x4b401a=0x0;_0x4b401a<=_0x2eb989[_0x1e435f(0x2bc)]-0x1;_0x4b401a++){const _0x48e64a=_0x2eb989[_0x4b401a];for(let _0x34739e=0x0;_0x34739e<=_0x48e64a['product_data'][_0x1e435f(0x2bc)]-0x1;_0x34739e++){const _0xe4b154=_0x48e64a[_0x1e435f(0x205)][_0x34739e],_0x1e0a7b=await warehouse[_0x1e435f(0x219)]([{'$match':{'name':_0x48e64a[_0x1e435f(0x2e6)],'room':_0x48e64a[_0x1e435f(0x27d)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0xe4b154['bay'],'product_details.bay':parseInt(_0xe4b154[_0x1e435f(0x25d)]),'product_details.product_code':_0xe4b154[_0x1e435f(0x2ed)]}}]);for(let _0x39342b=0x0;_0x39342b<=_0x1e0a7b[_0x1e435f(0x2bc)]-0x1;_0x39342b++){let _0x3db9fd=_0x1e0a7b[_0x39342b],_0x334975=0x0;_0x3db9fd[_0x1e435f(0x287)][_0x1e435f(0x2ed)]==_0xe4b154[_0x1e435f(0x2ed)]&&_0x3db9fd[_0x1e435f(0x287)][_0x1e435f(0x25a)]==_0xe4b154[_0x1e435f(0x25d)]&&_0x3db9fd[_0x1e435f(0x287)]['level']==_0xe4b154[_0x1e435f(0x25a)]&&(_0xe4b154['max']=parseInt(_0xe4b154[_0x1e435f(0x2d0)])-parseInt(_0x3db9fd[_0x1e435f(0x287)][_0x1e435f(0x2e4)]),_0x334975++),_0x334975=='0'&&(parseInt(_0xe4b154[_0x1e435f(0x2d0)])>0x0&&(_0x2eb989[_0x4b401a][_0x1e435f(0x205)]=_0x2eb989[_0x4b401a][_0x1e435f(0x205)][_0x1e435f(0x241)]({'bay':_0xe4b154[_0x1e435f(0x25a)],'bin':_0xe4b154[_0x1e435f(0x25d)],'max':_0xe4b154[_0x1e435f(0x2d0)],'min':_0xe4b154[_0x1e435f(0x1dd)],'product_code':_0xe4b154[_0x1e435f(0x2ed)],'product_id':_0xe4b154['product_id'],'product_name':_0xe4b154['product_name']})));}}_0x2eb989[_0x4b401a][_0x1e435f(0x205)]=_0x2eb989[_0x4b401a][_0x1e435f(0x205)][_0x1e435f(0x2cf)](_0x30d8c2=>parseInt(_0x30d8c2[_0x1e435f(0x2d0)])>0x0);}for(let _0x256f66=0x0;_0x256f66<=_0x2eb989['length']-0x1;_0x256f66++){const _0x3d6396=_0x2eb989[_0x256f66];for(let _0x230833=0x0;_0x230833<=_0x3d6396['product_data'][_0x1e435f(0x2bc)]-0x1;_0x230833++){const _0x271ce9=_0x3d6396[_0x1e435f(0x205)][_0x230833],_0x16d1ba=await warehouse_temporary[_0x1e435f(0x219)]([{'$match':{'warehouse':_0x3d6396[_0x1e435f(0x2e6)],'room_name':_0x3d6396[_0x1e435f(0x27d)],'isConfirm':'false','data_type':_0x1e435f(0x268),'product_code':_0x271ce9[_0x1e435f(0x2ed)],'level':_0x271ce9['bay'],'bay':parseInt(_0x271ce9[_0x1e435f(0x25d)])}}]);for(let _0xea119f=0x0;_0xea119f<=_0x16d1ba[_0x1e435f(0x2bc)]-0x1;_0xea119f++){let _0x47c405=_0x16d1ba[_0xea119f];console['log'](_0x47c405);let _0xbbc4dd=0x0;_0x47c405[_0x1e435f(0x2ed)]==_0x271ce9[_0x1e435f(0x2ed)]&&_0x47c405['bay']==_0x271ce9[_0x1e435f(0x25d)]&&_0x47c405[_0x1e435f(0x2e1)]==_0x271ce9[_0x1e435f(0x25a)]&&(_0x271ce9[_0x1e435f(0x2d0)]=parseInt(_0x271ce9['max'])-parseInt(_0x47c405[_0x1e435f(0x2e4)]),_0xbbc4dd++),_0xbbc4dd=='0'&&(parseInt(_0x271ce9[_0x1e435f(0x2d0)])>0x0&&(_0x2eb989[_0x256f66][_0x1e435f(0x205)]=_0x2eb989[_0x256f66][_0x1e435f(0x205)][_0x1e435f(0x241)]({'bay':_0x271ce9[_0x1e435f(0x25a)],'bin':_0x271ce9['bin'],'max':_0x271ce9[_0x1e435f(0x2d0)],'min':_0x271ce9['min'],'product_code':_0x271ce9[_0x1e435f(0x2ed)],'product_id':_0x271ce9[_0x1e435f(0x2de)],'product_name':_0x271ce9[_0x1e435f(0x281)]})));}}_0x2eb989[_0x256f66][_0x1e435f(0x205)]=_0x2eb989[_0x256f66][_0x1e435f(0x205)]['filter'](_0x40b6b5=>parseInt(_0x40b6b5[_0x1e435f(0x2d0)])>0x0);}let _0x189fb9=[],_0x23622c=0x0;for(let _0x2cc485=0x0;_0x2cc485<=_0x159671[_0x1e435f(0x2bc)]-0x1;_0x2cc485++){const _0x285277=_0x159671[_0x2cc485];let _0x3d3d21=_0x285277[_0x1e435f(0x1bd)];for(let _0x16d8e1=0x0;_0x16d8e1<=_0x2eb989['length']-0x1;_0x16d8e1++){const _0x3d0cab=_0x2eb989[_0x16d8e1];for(let _0x5ccddc=0x0;_0x5ccddc<=_0x3d0cab[_0x1e435f(0x205)]['length']-0x1;_0x5ccddc++){const _0x1ed8d6=_0x3d0cab[_0x1e435f(0x205)][_0x5ccddc];if(_0x1ed8d6[_0x1e435f(0x2ed)]===_0x285277['product_code']){const _0x325c04=await warehouse[_0x1e435f(0x219)]([{'$match':{'name':_0x3a75d5,'room':_0x3d0cab[_0x1e435f(0x27d)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x1ed8d6[_0x1e435f(0x25a)],'product_details.bay':parseInt(_0x1ed8d6[_0x1e435f(0x25d)])}}]);if(_0x325c04[_0x1e435f(0x2bc)]==0x0){for(let _0x381f43=0x0;_0x381f43<=_0x3d0cab[_0x1e435f(0x205)][_0x1e435f(0x2bc)]-0x1&&_0x3d3d21>0x0;_0x381f43++){const _0x279e0a=_0x3d0cab[_0x1e435f(0x205)][_0x381f43];console[_0x1e435f(0x1d5)](_0x285277[_0x1e435f(0x2ed)]+'==='+_0x279e0a[_0x1e435f(0x2ed)]+'\x20<>\x20'+_0x279e0a['min']+_0x1e435f(0x21d)+_0x279e0a[_0x1e435f(0x2d0)]+_0x1e435f(0x21d)+_0x279e0a[_0x1e435f(0x25a)]+_0x1e435f(0x21d)+_0x279e0a[_0x1e435f(0x25d)]);if(_0x285277['product_code']===_0x279e0a['product_code']){_0x189fb9[_0x23622c]={};const _0x5bd98d=parseInt(_0x279e0a['max']),_0x437048=0x0;let _0x133d4b=_0x5bd98d-_0x437048,_0x5d11fc=Math[_0x1e435f(0x1dd)](_0x3d3d21,_0x133d4b);console[_0x1e435f(0x1d5)](_0x1e435f(0x1d0)+_0x5d11fc+_0x1e435f(0x2bf)+_0x285277[_0x1e435f(0x281)]+_0x1e435f(0x26d)+_0x3d0cab['warehouse_name']+_0x1e435f(0x2f3)+_0x3d0cab['room']+_0x1e435f(0x1be)+_0x279e0a[_0x1e435f(0x25a)]+_0x1e435f(0x294)+_0x279e0a['bin']+_0x1e435f(0x273)+_0x23622c),_0x189fb9[_0x23622c][_0x1e435f(0x281)]=_0x285277[_0x1e435f(0x281)],_0x189fb9[_0x23622c][_0x1e435f(0x2ed)]=_0x285277['product_code'],_0x189fb9[_0x23622c]['product_id']=_0x285277[_0x1e435f(0x2de)],_0x189fb9[_0x23622c][_0x1e435f(0x1f5)]=_0x285277[_0x1e435f(0x1f5)],_0x189fb9[_0x23622c]['sales_category']=_0x285277['sales_category'],_0x189fb9[_0x23622c][_0x1e435f(0x1c7)]=_0x285277['uuid'],_0x189fb9[_0x23622c][_0x1e435f(0x1bd)]=_0x5d11fc,_0x189fb9[_0x23622c][_0x1e435f(0x1b1)]=_0x285277['standard_unit'],_0x189fb9[_0x23622c]['secondary_unit']=_0x285277['secondary_unit'],_0x189fb9[_0x23622c][_0x1e435f(0x264)]=_0x285277[_0x1e435f(0x264)],_0x189fb9[_0x23622c][_0x1e435f(0x2ce)]=_0x285277['secondary_code'],_0x189fb9[_0x23622c][_0x1e435f(0x1d9)]=_0x285277[_0x1e435f(0x1d9)],_0x189fb9[_0x23622c][_0x1e435f(0x226)]=_0x285277['batch_code'],_0x189fb9[_0x23622c]['expiry_date']=_0x285277[_0x1e435f(0x214)],_0x189fb9[_0x23622c]['production_date']=_0x285277['production_date'],_0x189fb9[_0x23622c][_0x1e435f(0x2f4)]=_0x285277['maxperunit'],_0x189fb9[_0x23622c][_0x1e435f(0x25c)]=_0x285277['product_cat'],_0x189fb9[_0x23622c][_0x1e435f(0x2c4)]=_0x285277[_0x1e435f(0x2c4)],_0x189fb9[_0x23622c]['gross_price']=_0x285277['gross_price'],_0x189fb9[_0x23622c]['room_name']=_0x3d0cab[_0x1e435f(0x27d)],_0x189fb9[_0x23622c][_0x1e435f(0x2e1)]=_0x279e0a[_0x1e435f(0x25a)],_0x189fb9[_0x23622c][_0x1e435f(0x25a)]=_0x279e0a[_0x1e435f(0x25d)],_0x3d3d21-=_0x5d11fc,_0x23622c++;if(_0x3d3d21<=0x0)break;}}if(_0x3d3d21<=0x0){_0x3105b0[_0x1e435f(0x23c)]('errors',_0x1e435f(0x24e)+_0x3d3d21+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x3d3d21>0x0){console['log'](_0x1e435f(0x229)+_0x3d3d21+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');break;}}}}}if(_0x3d3d21>0x0){const _0xe46dad=await warehouse[_0x1e435f(0x219)]([{'$match':{'name':_0x3a75d5,'isStaging':'true'}}]);_0x189fb9[_0x23622c]={},_0x189fb9[_0x23622c][_0x1e435f(0x281)]=_0x285277[_0x1e435f(0x281)],_0x189fb9[_0x23622c][_0x1e435f(0x2ed)]=_0x285277['product_code'],_0x189fb9[_0x23622c]['product_id']=_0x285277['product_id'],_0x189fb9[_0x23622c][_0x1e435f(0x1f5)]=_0x285277['date_recieved'],_0x189fb9[_0x23622c][_0x1e435f(0x20d)]=_0x285277['sales_category'],_0x189fb9[_0x23622c][_0x1e435f(0x1c7)]=_0x285277[_0x1e435f(0x1c7)],_0x189fb9[_0x23622c][_0x1e435f(0x1bd)]=_0x3d3d21,_0x189fb9[_0x23622c][_0x1e435f(0x1b1)]=_0x285277['standard_unit'],_0x189fb9[_0x23622c][_0x1e435f(0x1eb)]=_0x285277['secondary_unit'],_0x189fb9[_0x23622c]['primary_code']=_0x285277[_0x1e435f(0x264)],_0x189fb9[_0x23622c]['secondary_code']=_0x285277['secondary_code'],_0x189fb9[_0x23622c]['maxStocks']=_0x285277['maxStocks'],_0x189fb9[_0x23622c]['batch_code']=_0x285277[_0x1e435f(0x226)],_0x189fb9[_0x23622c]['expiry_date']=_0x285277[_0x1e435f(0x214)],_0x189fb9[_0x23622c]['production_date']=_0x285277[_0x1e435f(0x215)],_0x189fb9[_0x23622c][_0x1e435f(0x2f4)]=_0x285277[_0x1e435f(0x2f4)],_0x189fb9[_0x23622c]['product_cat']=_0x285277[_0x1e435f(0x25c)],_0x189fb9[_0x23622c]['invoice']=_0x285277[_0x1e435f(0x2c4)],_0x189fb9[_0x23622c][_0x1e435f(0x2e2)]=_0x285277['gross_price'],_0x189fb9[_0x23622c]['room_name']=_0xe46dad[0x0][_0x1e435f(0x27d)],_0x189fb9[_0x23622c][_0x1e435f(0x2e1)]=_0x1e435f(0x1c0),_0x189fb9[_0x23622c][_0x1e435f(0x25a)]='1',console[_0x1e435f(0x1d5)]('STAGING\x20AREA\x201'+_0x1e435f(0x21d)+_0x285277['product_code']+'\x20===\x20'+_0x285277[_0x1e435f(0x2ed)]+_0x1e435f(0x21d)+_0x23622c+'\x20<>\x20'+_0x3d3d21),_0x3105b0['flash'](_0x1e435f(0x1db),_0x1e435f(0x24e)+_0x3d3d21+_0x1e435f(0x29e));}}const _0x28df19=_0x189fb9[_0x1e435f(0x2cf)](_0x693377=>_0x693377['quantity']!=='0'&&_0x693377[_0x1e435f(0x1bd)]!==''),_0x5174da=new purchases_finished({'invoice':_0x1e435f(0x251)+_0xb17644[_0x1e435f(0x244)]['toString']()[_0x1e435f(0x24b)](0x8,'0'),'suppliers':_0x18b096,'date':_0x20e45b,'warehouse_name':_0x3a75d5,'product':_0x28df19,'note':_0x462cdd,'due_amount':_0x3c6dad,'room':_0x35f9bd,'POnumber':_0x5ba84c,'SCRN':_0x267123,'JO_number':_0xebca28,'ReqBy':_0x48a448,'dateofreq':_0x22de31,'typeservicesData':_0x1ef073,'van':_0x5b0865,'typevehicle':_0x2e4974,'driver':_0x1ca2df,'plate':_0x1d1056,'DRSI':_0x2cb222,'TSU':_0xacfc46,'TFU':_0x36769b,'typeOfProducts':_0x2f71ec}),_0x332e5e=await _0x5174da[_0x1e435f(0x2c0)](),_0xe7e5ba=await purchases_finished['findOne']({'_id':_0x332e5e[_0x1e435f(0x2e0)][_0x1e435f(0x2b8)]()});_0x3105b0[_0x1e435f(0x23c)](_0x1e435f(0x2bb),_0x1e435f(0x1fe)),_0x19fa0e[_0x1e435f(0x247)]('/all_purchases_finished/process/'+_0xe7e5ba[_0x1e435f(0x2e0)][_0x1e435f(0x2b8)]());}catch(_0x8c5974){console[_0x1e435f(0x1d5)](_0x8c5974);}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x246),auth,async(_0x51d64b,_0x53c80f)=>{var _0x455147=a0_0x275920;try{const {username:_0xda69b2,email:_0x20696e,role:_0x564a7d}=_0x51d64b[_0x455147(0x2a4)],_0x2e2faa=_0x51d64b[_0x455147(0x2a4)],_0xd7a69d=_0x51d64b[_0x455147(0x2a0)]['id'],_0x572716=await profile[_0x455147(0x2db)]({'email':_0x2e2faa['email']}),_0x50663c=await master_shop[_0x455147(0x21c)](),_0xdfffbf=await staff['findOne']({'email':_0x2e2faa[_0x455147(0x267)]}),_0x4e7056=await suppliers[_0x455147(0x21c)]({});let _0xafd7b8;if(_0x2e2faa['role']==_0x455147(0x1e2)){const _0x199e15=await staff[_0x455147(0x2db)]({'email':_0x2e2faa[_0x455147(0x267)]});_0xafd7b8=await warehouse['aggregate']([{'$match':{'status':_0x455147(0x1bf),'name':_0x199e15[_0x455147(0x2ec)]}},{'$group':{'_id':_0x455147(0x1b5),'name':{'$first':'$name'}}}]);}else _0xafd7b8=await warehouse[_0x455147(0x219)]([{'$match':{'status':_0x455147(0x1bf)}},{'$group':{'_id':_0x455147(0x1b5),'name':{'$first':'$name'}}}]);const _0x288246=await purchases_finished[_0x455147(0x1fc)](_0xd7a69d);if(_0x50663c[0x0][_0x455147(0x26c)]=='English\x20(US)')var _0x7ebdad=users[_0x455147(0x202)];else{if(_0x50663c[0x0][_0x455147(0x26c)]==_0x455147(0x25e))var _0x7ebdad=users[_0x455147(0x25e)];else{if(_0x50663c[0x0][_0x455147(0x26c)]=='German')var _0x7ebdad=users[_0x455147(0x28c)];else{if(_0x50663c[0x0]['language']==_0x455147(0x1f9))var _0x7ebdad=users[_0x455147(0x1f9)];else{if(_0x50663c[0x0][_0x455147(0x26c)]==_0x455147(0x266))var _0x7ebdad=users[_0x455147(0x266)];else{if(_0x50663c[0x0][_0x455147(0x26c)]==_0x455147(0x1b0))var _0x7ebdad=users[_0x455147(0x2a3)];else{if(_0x50663c[0x0]['language']=='Chinese')var _0x7ebdad=users[_0x455147(0x255)];else{if(_0x50663c[0x0]['language']==_0x455147(0x2ef))var _0x7ebdad=users[_0x455147(0x20e)];}}}}}}}_0x53c80f[_0x455147(0x2b5)]('purchases_process',{'success':_0x51d64b[_0x455147(0x23c)](_0x455147(0x2bb)),'errors':_0x51d64b[_0x455147(0x23c)](_0x455147(0x1db)),'role':_0x2e2faa,'profile':_0x572716,'suppliers':_0x4e7056,'warehouse':_0xafd7b8,'master_shop':_0x50663c,'language':_0x7ebdad,'purchases_data':_0x288246});}catch(_0x51f2bb){console[_0x455147(0x1d5)](_0x51f2bb);}});async function get_warehouse_data(_0x2a73b6,_0x2979ff){var _0x1ccda7=a0_0x275920;try{const _0x5b7f3f=await warehouse_temporary[_0x1ccda7(0x2db)]({'name':_0x2a73b6,'room':_0x2979ff});if(!_0x5b7f3f){const _0x1931b6=new warehouse_temporary({'name':_0x2a73b6,'address':_0x2a73b6,'status':_0x1ccda7(0x1bf),'room':_0x2979ff,'isStaging':_0x1ccda7(0x26b)});return await _0x1931b6[_0x1ccda7(0x2c0)](),_0x1931b6;}else return _0x5b7f3f;}catch(_0x258235){console[_0x1ccda7(0x274)](_0x1ccda7(0x26e),_0x258235);throw _0x258235;}}router[a0_0x275920(0x1c5)](a0_0x275920(0x246),auth,async(_0x29e229,_0x3b6cff)=>{var _0x2e7820=a0_0x275920;try{const _0x5851e0=_0x29e229[_0x2e7820(0x2a0)]['id'],_0x57beb7=await purchases_finished[_0x2e7820(0x1fc)](_0x5851e0);let _0x468189=[];_0x57beb7[_0x2e7820(0x2c8)][_0x2e7820(0x27a)]((_0xf24e2f,_0x10c3fa)=>{var _0x3e9c19=_0x2e7820;_0x468189[_0x10c3fa]={},_0x468189[_0x10c3fa][_0x3e9c19(0x2ec)]=_0x57beb7[_0x3e9c19(0x2e6)],_0x468189[_0x10c3fa][_0x3e9c19(0x2de)]=_0xf24e2f[_0x3e9c19(0x2de)],_0x468189[_0x10c3fa]['product_name']=_0xf24e2f[_0x3e9c19(0x281)],_0x468189[_0x10c3fa]['product_code']=_0xf24e2f[_0x3e9c19(0x2ed)],_0x468189[_0x10c3fa][_0x3e9c19(0x2e4)]=_0xf24e2f[_0x3e9c19(0x1bd)],_0x468189[_0x10c3fa][_0x3e9c19(0x2a1)]=_0xf24e2f[_0x3e9c19(0x1b1)],_0x468189[_0x10c3fa][_0x3e9c19(0x1eb)]=_0xf24e2f[_0x3e9c19(0x1eb)],_0x468189[_0x10c3fa][_0x3e9c19(0x2e1)]=_0xf24e2f[_0x3e9c19(0x2e1)],_0x468189[_0x10c3fa][_0x3e9c19(0x25a)]=_0xf24e2f[_0x3e9c19(0x25a)],_0x468189[_0x10c3fa][_0x3e9c19(0x264)]=_0xf24e2f[_0x3e9c19(0x264)],_0x468189[_0x10c3fa][_0x3e9c19(0x2ce)]=_0xf24e2f[_0x3e9c19(0x2ce)],_0x468189[_0x10c3fa][_0x3e9c19(0x1d9)]=_0xf24e2f[_0x3e9c19(0x1d9)],_0x468189[_0x10c3fa][_0x3e9c19(0x226)]=_0xf24e2f[_0x3e9c19(0x226)],_0x468189[_0x10c3fa][_0x3e9c19(0x214)]=_0xf24e2f[_0x3e9c19(0x214)],_0x468189[_0x10c3fa][_0x3e9c19(0x215)]=_0xf24e2f[_0x3e9c19(0x215)],_0x468189[_0x10c3fa][_0x3e9c19(0x2f4)]=_0xf24e2f[_0x3e9c19(0x2f4)],_0x468189[_0x10c3fa]['product_cat']=_0xf24e2f[_0x3e9c19(0x25c)],_0x468189[_0x10c3fa]['room_name']=_0xf24e2f['room_name'],_0x468189[_0x10c3fa][_0x3e9c19(0x2c4)]=_0xf24e2f[_0x3e9c19(0x2c4)],_0x468189[_0x10c3fa][_0x3e9c19(0x1c7)]=_0xf24e2f[_0x3e9c19(0x1c7)],_0x468189[_0x10c3fa][_0x3e9c19(0x2e2)]=_0xf24e2f[_0x3e9c19(0x2e2)],_0x468189[_0x10c3fa][_0x3e9c19(0x20d)]=_0xf24e2f[_0x3e9c19(0x20d)],_0x468189[_0x10c3fa][_0x3e9c19(0x1f5)]=_0xf24e2f[_0x3e9c19(0x1f5)],_0x468189[_0x10c3fa]['purchases_id']=_0xf24e2f[_0x3e9c19(0x2e0)][_0x3e9c19(0x2b8)](),_0x468189[_0x10c3fa][_0x3e9c19(0x220)]=_0x3e9c19(0x268),_0x468189[_0x10c3fa][_0x3e9c19(0x1b8)]=_0x3e9c19(0x2ca),_0x468189[_0x10c3fa][_0x3e9c19(0x227)]=_0x3e9c19(0x26b);});for(let _0x47ab99=0x0;_0x47ab99<=_0x468189[_0x2e7820(0x2bc)]-0x1;_0x47ab99++){const _0x390e55=_0x468189[_0x47ab99],_0x57a441=new warehouse_temporary(_0x390e55);await _0x57a441[_0x2e7820(0x2c0)]();}_0x57beb7[_0x2e7820(0x275)]=_0x2e7820(0x2ca),await _0x57beb7[_0x2e7820(0x2c0)](),_0x29e229[_0x2e7820(0x23c)](_0x2e7820(0x2bb),_0x2e7820(0x2d9)),_0x3b6cff[_0x2e7820(0x247)]('/all_purchases_finished/process/'+_0x57beb7[_0x2e7820(0x2e0)][_0x2e7820(0x2b8)]());}catch(_0x5d2582){}}),router['post'](a0_0x275920(0x2d4),auth,async(_0x3df177,_0x17723c)=>{var _0x2ad7b4=a0_0x275920;try{const {invoice:_0x6e94df,date:_0x37d54c,warehouse_name:_0x29fbf1,prod_name:_0x14f78d,note:_0x157a7f,due_amount:_0x4ac128,Room_name:_0x500fa7,PO_number:_0x4ae2c6,SCRN:_0x1bf6fd,ReqBy:_0x41e829,dateofreq:_0x3fa807,suppliers:_0x7fd684,typeservicesData:_0x38c321,van:_0x48df80,typevehicle:_0x5b0405,driver:_0x285076,plate:_0x26297a,DRSI:_0x5cb441,TSU:_0x586d82,TFU:_0x19cdd2,JO_number:_0x5aee62,type_of_products:_0xfa2653}=_0x3df177[_0x2ad7b4(0x1ce)];if(typeof _0x14f78d=='string')var _0x351726=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x29c)]],_0x27c0d9=[_0x3df177['body'][_0x2ad7b4(0x1c2)]],_0x2f88bc=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x283)]],_0x462aab=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x1ef)]],_0x50dd57=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x290)]],_0x5b68cd=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x299)]],_0x593ff0=[_0x3df177[_0x2ad7b4(0x1ce)]['primary_code']],_0x1b4339=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x2ce)]],_0x2fda15=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x252)]],_0x33423e=[_0x3df177[_0x2ad7b4(0x1ce)]['batch_code']],_0x4bdd06=[_0x3df177['body'][_0x2ad7b4(0x214)]],_0x54ca16=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x2d1)]],_0x4b2504=[_0x3df177[_0x2ad7b4(0x1ce)]['max_product_unit']],_0x57640c=[_0x3df177['body']['prod_cat']],_0x122afc=[_0x3df177[_0x2ad7b4(0x1ce)]['RoomAssign']],_0x4cb03d=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x2e2)]],_0x2d6da8=[_0x3df177[_0x2ad7b4(0x1ce)]['uuid']],_0x417af9=[_0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x1d4)]],_0x5c8f33=[_0x3df177['body'][_0x2ad7b4(0x1e0)]];else var _0x351726=[..._0x3df177['body'][_0x2ad7b4(0x29c)]],_0x27c0d9=[..._0x3df177['body'][_0x2ad7b4(0x1c2)]],_0x2f88bc=[..._0x3df177[_0x2ad7b4(0x1ce)]['prod_Qty']],_0x462aab=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x1ef)]],_0x50dd57=[..._0x3df177[_0x2ad7b4(0x1ce)]['prod_secondunit']],_0x5b68cd=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x299)]],_0x593ff0=[..._0x3df177['body'][_0x2ad7b4(0x264)]],_0x1b4339=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x2ce)]],_0x2fda15=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x252)]],_0x33423e=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x226)]],_0x4bdd06=[..._0x3df177[_0x2ad7b4(0x1ce)]['expiry_date']],_0x54ca16=[..._0x3df177['body'][_0x2ad7b4(0x2d1)]],_0x4b2504=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x2e3)]],_0x57640c=[..._0x3df177['body'][_0x2ad7b4(0x263)]],_0x122afc=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x1f8)]],_0x4cb03d=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x2e2)]],_0x2d6da8=[..._0x3df177['body']['uuid']],_0x417af9=[..._0x3df177[_0x2ad7b4(0x1ce)][_0x2ad7b4(0x1d4)]],_0x5c8f33=[..._0x3df177[_0x2ad7b4(0x1ce)]['type_of_products_type']];const _0x2bf88a=_0x351726['map'](_0x23c1f0=>{return _0x23c1f0={'product_name':_0x23c1f0};});_0x5c8f33[_0x2ad7b4(0x27a)]((_0x478adb,_0x22c338)=>{var _0x168d6c=_0x2ad7b4;_0x2bf88a[_0x22c338][_0x168d6c(0x1dc)]=_0x478adb;}),_0x417af9[_0x2ad7b4(0x27a)]((_0x48a3ca,_0x47fbfa)=>{var _0x2fa2b4=_0x2ad7b4;_0x2bf88a[_0x47fbfa][_0x2fa2b4(0x20d)]=_0x48a3ca;}),_0x27c0d9[_0x2ad7b4(0x27a)]((_0x5f2ee0,_0x4427dd)=>{_0x2bf88a[_0x4427dd]['product_code']=_0x5f2ee0;}),_0x2d6da8['forEach']((_0x372dc0,_0x5867ee)=>{var _0x5c73bc=_0x2ad7b4;_0x2bf88a[_0x5867ee][_0x5c73bc(0x1c7)]=_0x372dc0;}),_0x2f88bc[_0x2ad7b4(0x27a)]((_0x1b1089,_0x31e099)=>{var _0x35abc9=_0x2ad7b4;_0x2bf88a[_0x31e099]['quantity']=Math[_0x35abc9(0x1ea)](_0x1b1089);}),_0x462aab['forEach']((_0x2e7422,_0x1654b8)=>{var _0x4ddca4=_0x2ad7b4;_0x2bf88a[_0x1654b8][_0x4ddca4(0x1b1)]=_0x2e7422;}),_0x50dd57[_0x2ad7b4(0x27a)]((_0x12c680,_0xbed90f)=>{var _0x47ed6e=_0x2ad7b4;_0x2bf88a[_0xbed90f][_0x47ed6e(0x1eb)]=_0x12c680;}),_0x5b68cd['forEach']((_0x521d36,_0x379302)=>{var _0x3d00fa=_0x2ad7b4,_0x3375eb=_0x521d36['match'](/[A-Za-z]+/)[0x0],_0x57be28=parseInt(_0x521d36[_0x3d00fa(0x22c)](/\d+/)[0x0]);_0x2bf88a[_0x379302]['level']=_0x3375eb,_0x2bf88a[_0x379302][_0x3d00fa(0x25a)]=_0x57be28;}),_0x593ff0[_0x2ad7b4(0x27a)]((_0x40875f,_0x134ad9)=>{var _0xfba1d9=_0x2ad7b4;_0x2bf88a[_0x134ad9][_0xfba1d9(0x264)]=_0x40875f;}),_0x1b4339[_0x2ad7b4(0x27a)]((_0x1216cc,_0x53ea13)=>{var _0x485cdb=_0x2ad7b4;_0x2bf88a[_0x53ea13][_0x485cdb(0x2ce)]=_0x1216cc;}),_0x2fda15[_0x2ad7b4(0x27a)]((_0x21fd35,_0x4de1c5)=>{var _0x4d9cd6=_0x2ad7b4;_0x2bf88a[_0x4de1c5][_0x4d9cd6(0x1d9)]=_0x21fd35;}),_0x33423e[_0x2ad7b4(0x27a)]((_0x5b83da,_0x55c374)=>{var _0x3f3d1d=_0x2ad7b4;_0x2bf88a[_0x55c374][_0x3f3d1d(0x226)]=_0x5b83da;}),_0x4bdd06[_0x2ad7b4(0x27a)]((_0x567f80,_0x3e8dc0)=>{var _0x21302a=_0x2ad7b4;_0x2bf88a[_0x3e8dc0][_0x21302a(0x214)]=_0x567f80;}),_0x54ca16['forEach']((_0x3b17d7,_0x519fea)=>{var _0x38775d=_0x2ad7b4;_0x2bf88a[_0x519fea][_0x38775d(0x215)]=_0x3b17d7;}),_0x4b2504[_0x2ad7b4(0x27a)]((_0x193acb,_0x51bff6)=>{var _0x5402ed=_0x2ad7b4;_0x2bf88a[_0x51bff6][_0x5402ed(0x2f4)]=_0x193acb;}),_0x57640c['forEach']((_0x295dbd,_0x218455)=>{var _0x4f9924=_0x2ad7b4;_0x2bf88a[_0x218455][_0x4f9924(0x25c)]=_0x295dbd;}),_0x122afc[_0x2ad7b4(0x27a)]((_0x4d0fd9,_0xd05f54)=>{var _0x13840d=_0x2ad7b4;_0x2bf88a[_0xd05f54][_0x13840d(0x2b1)]=_0x4d0fd9;}),_0x4cb03d[_0x2ad7b4(0x27a)]((_0x1eab76,_0x49fbf8)=>{var _0x39a01e=_0x2ad7b4;_0x2bf88a[_0x49fbf8][_0x39a01e(0x2e2)]=_0x1eab76;});const _0x5aad61=new purchases_logs();await _0x5aad61[_0x2ad7b4(0x2c0)]();for(let _0x1c7b47=0x0;_0x1c7b47<=_0x122afc[_0x2ad7b4(0x2bc)]-0x1;_0x1c7b47++){_0x2bf88a[_0x1c7b47]['invoice']=_0x2ad7b4(0x27b)+_0x5aad61[_0x2ad7b4(0x244)][_0x2ad7b4(0x2c7)]()[_0x2ad7b4(0x24b)](0x8,'0');}const _0x28b722=_0x2bf88a[_0x2ad7b4(0x2cf)](_0x43d1fb=>_0x43d1fb[_0x2ad7b4(0x1bd)]!=='0'&&_0x43d1fb[_0x2ad7b4(0x1bd)]!==''),_0x29a8cb=new purchases_finished({'invoice':_0x2ad7b4(0x27b)+_0x5aad61[_0x2ad7b4(0x244)][_0x2ad7b4(0x2c7)]()[_0x2ad7b4(0x24b)](0x8,'0'),'suppliers':_0x7fd684,'date':_0x37d54c,'warehouse_name':_0x29fbf1,'product':_0x28b722,'note':_0x157a7f,'due_amount':_0x4ac128,'room':_0x500fa7,'POnumber':_0x4ae2c6,'SCRN':_0x1bf6fd,'JO_number':_0x5aee62,'ReqBy':_0x41e829,'dateofreq':_0x3fa807,'typeservicesData':_0x38c321,'van':_0x48df80,'typevehicle':_0x5b0405,'driver':_0x285076,'plate':_0x26297a,'DRSI':_0x5cb441,'TSU':_0x586d82,'TFU':_0x19cdd2,'typeOfProducts':_0xfa2653}),_0x2c3c1b=await _0x29a8cb['save'](),_0x410d26=await purchases_finished[_0x2ad7b4(0x2db)]({'_id':_0x2c3c1b[_0x2ad7b4(0x2e0)][_0x2ad7b4(0x2b8)]()}),_0x1b567b=_0x410d26[_0x2ad7b4(0x2c8)]['map'](async _0x5f4dd3=>{var _0x4c146b=_0x2ad7b4;try{var _0xd2f272=await warehouse[_0x4c146b(0x2db)]({'name':_0x29fbf1,'room':_0x5f4dd3['room_name']}),_0x5021c3=0x0;const _0x181806=_0xd2f272[_0x4c146b(0x287)][_0x4c146b(0x20f)](_0x1a3d08=>{var _0x4ce79d=_0x4c146b;console['log'](_0x1a3d08[_0x4ce79d(0x281)]+'=='+_0x5f4dd3[_0x4ce79d(0x281)]+'&&'+_0x1a3d08[_0x4ce79d(0x25a)]+'=='+_0x5f4dd3[_0x4ce79d(0x25a)]+'&&'+_0x1a3d08[_0x4ce79d(0x214)]+'=='+_0x5f4dd3[_0x4ce79d(0x214)]+'&&'+_0x1a3d08[_0x4ce79d(0x215)]+'=='+_0x5f4dd3[_0x4ce79d(0x215)]+'&&'+_0x1a3d08[_0x4ce79d(0x226)]+'=='+_0x5f4dd3['batch_code']+'&&'+_0x1a3d08['invoice']+'=='+_0x410d26[_0x4ce79d(0x2c4)]),_0x1a3d08['product_name']==_0x5f4dd3[_0x4ce79d(0x281)]&&_0x1a3d08[_0x4ce79d(0x25a)]==_0x5f4dd3[_0x4ce79d(0x25a)]&&_0x1a3d08['level']==_0x5f4dd3[_0x4ce79d(0x2e1)]&&_0x1a3d08[_0x4ce79d(0x214)]==_0x5f4dd3[_0x4ce79d(0x214)]&&_0x1a3d08[_0x4ce79d(0x215)]==_0x5f4dd3[_0x4ce79d(0x215)]&&_0x1a3d08[_0x4ce79d(0x226)]==_0x5f4dd3[_0x4ce79d(0x226)]&&_0x1a3d08[_0x4ce79d(0x2c4)]==_0x410d26[_0x4ce79d(0x2c4)]&&(_0x1a3d08[_0x4ce79d(0x2e4)]=Math['abs'](_0x1a3d08['product_stock'])+Math['abs'](_0x5f4dd3['quantity']),_0x5021c3++);});return _0x5021c3==0x0&&(_0xd2f272[_0x4c146b(0x287)]=_0xd2f272[_0x4c146b(0x287)][_0x4c146b(0x241)]({'product_name':_0x5f4dd3[_0x4c146b(0x281)],'product_stock':Math[_0x4c146b(0x1ea)](_0x5f4dd3['quantity']),'primary_code':_0x5f4dd3['primary_code'],'secondary_code':_0x5f4dd3[_0x4c146b(0x2ce)],'product_code':_0x5f4dd3[_0x4c146b(0x2ed)],'bay':_0x5f4dd3['bay'],'level':_0x5f4dd3[_0x4c146b(0x2e1)],'maxProducts':_0x5f4dd3[_0x4c146b(0x1d9)],'unit':_0x5f4dd3[_0x4c146b(0x1b1)],'secondary_unit':_0x5f4dd3[_0x4c146b(0x1eb)],'expiry_date':_0x5f4dd3['expiry_date'],'production_date':_0x5f4dd3[_0x4c146b(0x215)],'maxProducts':_0x5f4dd3[_0x4c146b(0x1d9)],'maxPerUnit':_0x5f4dd3['maxperunit'],'batch_code':_0x5f4dd3['batch_code'],'product_cat':_0x5f4dd3[_0x4c146b(0x25c)],'invoice':_0x5f4dd3[_0x4c146b(0x2c4)],'id_incoming':_0x5f4dd3['_id'],'uuid':_0x5f4dd3['uuid'],'gross_price':_0x5f4dd3[_0x4c146b(0x2e2)],'sales_category':_0x5f4dd3[_0x4c146b(0x20d)],'type_products':_0x5f4dd3[_0x4c146b(0x1dc)]})),_0xd2f272;}catch(_0x3194f8){return console[_0x4c146b(0x274)](_0x4c146b(0x238),_0x3194f8),null;}});Promise[_0x2ad7b4(0x279)](_0x1b567b)[_0x2ad7b4(0x225)](async _0x2adce3=>{var _0x4f4a86=_0x2ad7b4;try{for(const _0x4209e3 of _0x2adce3){await warehouse[_0x4f4a86(0x207)]({'_id':_0x4209e3[_0x4f4a86(0x2e0)]},{'$addToSet':{'product_details':{'$each':_0x4209e3[_0x4f4a86(0x287)]}}});}const _0x2814f0=await master_shop['find'](),_0x578d80=await email_settings['findOne'](),_0x36cfe9=await supervisor_settings[_0x4f4a86(0x21c)]();var _0x22081d=_0x410d26[_0x4f4a86(0x2c8)],_0x13631c='',_0x1a6854;for(_0x1a6854 in _0x22081d){var _0x5a5fb0='FG';_0x410d26[_0x4f4a86(0x2e6)]==_0x4f4a86(0x24d)&&(_0x5a5fb0='DG'),_0x13631c+=_0x4f4a86(0x257)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22081d[_0x1a6854][_0x4f4a86(0x281)]+_0x4f4a86(0x293)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22081d[_0x1a6854][_0x4f4a86(0x2ed)]+_0x4f4a86(0x293)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22081d[_0x1a6854]['quantity']+_0x4f4a86(0x293)+_0x4f4a86(0x2e5)+_0x22081d[_0x1a6854][_0x4f4a86(0x1b1)]+'</td>'+_0x4f4a86(0x2e5)+_0x22081d[_0x1a6854]['secondary_unit']+'</td>'+_0x4f4a86(0x2e5)+_0x410d26[_0x4f4a86(0x2e6)]+_0x4f4a86(0x293)+_0x4f4a86(0x2e5)+_0x22081d[_0x1a6854][_0x4f4a86(0x2b1)]+_0x4f4a86(0x293)+_0x4f4a86(0x2e5)+_0x5a5fb0+_0x22081d[_0x1a6854][_0x4f4a86(0x25a)]+'</td>',_0x4f4a86(0x291);}let _0x2dcb5c=nodemailer[_0x4f4a86(0x1cb)]({'host':_0x578d80[_0x4f4a86(0x259)],'port':Number(_0x578d80[_0x4f4a86(0x2b4)]),'secure':![],'auth':{'user':_0x578d80[_0x4f4a86(0x267)],'pass':_0x578d80[_0x4f4a86(0x278)]}}),_0x1ea3bf={'from':_0x578d80[_0x4f4a86(0x267)],'to':_0x36cfe9[0x0][_0x4f4a86(0x234)],'subject':_0x4f4a86(0x1b4),'attachments':[{'filename':_0x4f4a86(0x233),'path':__dirname+_0x4f4a86(0x203)+'/upload/'+_0x2814f0[0x0][_0x4f4a86(0x1e4)],'cid':_0x4f4a86(0x1c1)}],'html':_0x4f4a86(0x27e)+_0x4f4a86(0x1b9)+_0x4f4a86(0x211)+'<div>'+_0x4f4a86(0x1f6)+_0x4f4a86(0x22a)+_0x4f4a86(0x20a)+_0x4f4a86(0x1e7)+_0x4f4a86(0x22a)+'<h2>\x20'+_0x2814f0[0x0][_0x4f4a86(0x1bc)]+_0x4f4a86(0x2da)+_0x4f4a86(0x1e7)+_0x4f4a86(0x1e7)+_0x4f4a86(0x21b)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x410d26[_0x4f4a86(0x2c4)]+'\x20'+_0x4f4a86(0x1e8)+_0x4f4a86(0x23d)+_0x410d26[_0x4f4a86(0x1e3)]+'\x20'+'</span>'+_0x4f4a86(0x232)+'</div>'+_0x4f4a86(0x285)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4f4a86(0x257)+_0x4f4a86(0x27c)+_0x4f4a86(0x2cb)+_0x4f4a86(0x2aa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4f4a86(0x2b0)+_0x4f4a86(0x1f7)+_0x4f4a86(0x254)+_0x4f4a86(0x2cd)+_0x4f4a86(0x291)+_0x4f4a86(0x2e7)+_0x4f4a86(0x223)+'\x20'+_0x13631c+'\x20'+_0x4f4a86(0x2ba)+_0x4f4a86(0x1af)+'<div>'+_0x4f4a86(0x2b9)+_0x4f4a86(0x284)+_0x2814f0[0x0][_0x4f4a86(0x1bc)]+'</h5>'+_0x4f4a86(0x1e7)+_0x4f4a86(0x1e7)+'</body></html>'};_0x2dcb5c['sendMail'](_0x1ea3bf,function(_0x524db6,_0xfaf30f){var _0x4369f0=_0x4f4a86;_0x524db6?(console[_0x4369f0(0x1d5)](_0x524db6),console[_0x4369f0(0x1d5)](_0x4369f0(0x1d8))):console[_0x4369f0(0x1d5)]('Email\x20sent\x20successfully');});}catch(_0x4ed274){console['error'](_0x4ed274),_0x17723c[_0x4f4a86(0x1fa)](0x1f4)['json']({'error':_0x4f4a86(0x1f3),'message':_0x4ed274[_0x4f4a86(0x27f)]});}})['catch'](_0x31f184=>{var _0x4281ea=_0x2ad7b4;console[_0x4281ea(0x274)](_0x31f184);}),_0x3df177[_0x2ad7b4(0x23c)](_0x2ad7b4(0x2bb),'purchase\x20data\x20add\x20successfully'),_0x17723c['redirect'](_0x2ad7b4(0x24a)+_0x410d26[_0x2ad7b4(0x2e0)][_0x2ad7b4(0x2b8)]());}catch(_0x59dba1){console[_0x2ad7b4(0x1d5)](_0x59dba1);}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x206),auth,async(_0x5d8371,_0x159568)=>{var _0xe01ece=a0_0x275920;try{const {username:_0x59765b,email:_0x1c970d,role:_0x461295}=_0x5d8371[_0xe01ece(0x2a4)],_0x127738=_0x5d8371['user'],_0x2e7262=await profile['findOne']({'email':_0x127738[_0xe01ece(0x267)]}),_0x396ff4=await master_shop[_0xe01ece(0x21c)](),_0x5e9dcb=_0x5d8371[_0xe01ece(0x2a0)]['id'],_0x9eb84=await purchases_finished[_0xe01ece(0x1fc)](_0x5e9dcb),_0x30fffb=await suppliers['find']({});let _0x43e7a6;if(_0x127738[_0xe01ece(0x28e)]==_0xe01ece(0x1e2)){const _0x10ad71=await staff['findOne']({'email':_0x127738[_0xe01ece(0x267)]});_0x43e7a6=await warehouse['find']({'status':_0xe01ece(0x1bf),'name':_0x10ad71[_0xe01ece(0x2ec)],'warehouse_category':_0xe01ece(0x2c6)});}else _0x43e7a6=await warehouse[_0xe01ece(0x219)]([{'$match':{'status':_0xe01ece(0x1bf),'warehouse_category':_0xe01ece(0x2c6)}},{'$group':{'_id':_0xe01ece(0x1b5),'name':{'$first':'$name'}}}]);const _0x1f933a=await product[_0xe01ece(0x21c)]({}),_0x3c9067=BayBinSelected(_0x9eb84[_0xe01ece(0x2e6)],_0x9eb84['room']);let _0x393f91=new Date(_0x9eb84['expiry_date']),_0x4ec9fa=('0'+_0x393f91[_0xe01ece(0x248)]())['slice'](-0x2),_0x330955=('0'+(_0x393f91[_0xe01ece(0x208)]()+0x1))[_0xe01ece(0x240)](-0x2),_0x286900=_0x393f91[_0xe01ece(0x2ae)](),_0x2cadab=_0x286900+'-'+_0x330955+'-'+_0x4ec9fa;if(_0x396ff4[0x0][_0xe01ece(0x26c)]=='English\x20(US)'){var _0x7bfca4=users[_0xe01ece(0x202)];console['log'](_0x7bfca4);}else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]=='Hindi')var _0x7bfca4=users['Hindi'];else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]=='German')var _0x7bfca4=users[_0xe01ece(0x28c)];else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]==_0xe01ece(0x1f9))var _0x7bfca4=users[_0xe01ece(0x1f9)];else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]==_0xe01ece(0x266))var _0x7bfca4=users['French'];else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]=='Portuguese\x20(BR)')var _0x7bfca4=users[_0xe01ece(0x2a3)];else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]==_0xe01ece(0x255))var _0x7bfca4=users['Chinese'];else{if(_0x396ff4[0x0][_0xe01ece(0x26c)]==_0xe01ece(0x2ef))var _0x7bfca4=users[_0xe01ece(0x20e)];}}}}}}}_0x159568[_0xe01ece(0x2b5)](_0xe01ece(0x2ea),{'success':_0x5d8371[_0xe01ece(0x23c)]('success'),'errors':_0x5d8371[_0xe01ece(0x23c)]('errors'),'role':_0x127738,'profile':_0x2e7262,'purchases':_0x9eb84,'suppliers':_0x30fffb,'warehouse':_0x43e7a6,'product':_0x1f933a,'master_shop':_0x396ff4,'language':_0x7bfca4,'ed_fullDate':_0x2cadab,'dataSelected':_0x3c9067});}catch(_0xe1304e){console[_0xe01ece(0x1d5)](_0xe1304e);}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x1d7),auth,async(_0x122651,_0x472f74)=>{var _0xbd6b70=a0_0x275920;try{const {username:_0x13d5fd,email:_0x510d41,role:_0x50cac7}=_0x122651[_0xbd6b70(0x2a4)],_0x15bff1=_0x122651[_0xbd6b70(0x2a4)],_0x233471=await profile[_0xbd6b70(0x2db)]({'email':_0x15bff1[_0xbd6b70(0x267)]}),_0x16250b=await master_shop[_0xbd6b70(0x21c)](),_0x3d5acc=_0x122651[_0xbd6b70(0x2a0)]['id'],_0x2cafb1=await purchases_finished[_0xbd6b70(0x1fc)](_0x3d5acc),_0x71c2a0=await suppliers[_0xbd6b70(0x21c)]({});let _0x3e3074;if(_0x15bff1['role']==_0xbd6b70(0x1e2)){const _0x5bcaef=await staff[_0xbd6b70(0x2db)]({'email':_0x15bff1[_0xbd6b70(0x267)]});_0x3e3074=await warehouse[_0xbd6b70(0x21c)]({'status':_0xbd6b70(0x1bf),'name':_0x5bcaef[_0xbd6b70(0x2ec)],'warehouse_category':_0xbd6b70(0x2c6)});}else _0x3e3074=await warehouse['aggregate']([{'$match':{'status':_0xbd6b70(0x1bf),'warehouse_category':_0xbd6b70(0x2c6)}},{'$group':{'_id':'$name','name':{'$first':_0xbd6b70(0x1b5)}}}]);const _0x302656=await product[_0xbd6b70(0x21c)]({}),_0x5b7ca2=BayBinSelected(_0x2cafb1[_0xbd6b70(0x2e6)],_0x2cafb1['room']);let _0x9d10e9=new Date(_0x2cafb1[_0xbd6b70(0x214)]),_0x5d9033=('0'+_0x9d10e9['getDate']())[_0xbd6b70(0x240)](-0x2),_0x3dece4=('0'+(_0x9d10e9[_0xbd6b70(0x208)]()+0x1))[_0xbd6b70(0x240)](-0x2),_0x29dffd=_0x9d10e9['getFullYear'](),_0x5d0222=_0x29dffd+'-'+_0x3dece4+'-'+_0x5d9033;if(_0x16250b[0x0][_0xbd6b70(0x26c)]==_0xbd6b70(0x20c)){var _0x276049=users[_0xbd6b70(0x202)];console[_0xbd6b70(0x1d5)](_0x276049);}else{if(_0x16250b[0x0][_0xbd6b70(0x26c)]=='Hindi')var _0x276049=users['Hindi'];else{if(_0x16250b[0x0][_0xbd6b70(0x26c)]==_0xbd6b70(0x28c))var _0x276049=users[_0xbd6b70(0x28c)];else{if(_0x16250b[0x0][_0xbd6b70(0x26c)]==_0xbd6b70(0x1f9))var _0x276049=users[_0xbd6b70(0x1f9)];else{if(_0x16250b[0x0][_0xbd6b70(0x26c)]==_0xbd6b70(0x266))var _0x276049=users['French'];else{if(_0x16250b[0x0][_0xbd6b70(0x26c)]=='Portuguese\x20(BR)')var _0x276049=users['Portuguese'];else{if(_0x16250b[0x0]['language']==_0xbd6b70(0x255))var _0x276049=users[_0xbd6b70(0x255)];else{if(_0x16250b[0x0][_0xbd6b70(0x26c)]=='Arabic\x20(ae)')var _0x276049=users[_0xbd6b70(0x20e)];}}}}}}}_0x472f74['render']('edit_purchases_finished',{'success':_0x122651['flash'](_0xbd6b70(0x2bb)),'errors':_0x122651['flash']('errors'),'role':_0x15bff1,'profile':_0x233471,'purchases':_0x2cafb1,'suppliers':_0x71c2a0,'warehouse':_0x3e3074,'product':_0x302656,'master_shop':_0x16250b,'language':_0x276049,'ed_fullDate':_0x5d0222,'dataSelected':_0x5b7ca2});}catch(_0x289a8a){console[_0xbd6b70(0x1d5)](_0x289a8a);}}),router[a0_0x275920(0x1c5)]('/view/:id',auth,async(_0x4e57fd,_0x517a65)=>{var _0x56806b=a0_0x275920;try{const _0x4df8fe=_0x4e57fd['params']['id'],_0xeb9a94=await purchases_finished[_0x56806b(0x2db)]({'_id':_0x4e57fd[_0x56806b(0x2a0)]['id']}),_0x121230=await warehouse[_0x56806b(0x2db)]({'name':_0xeb9a94[_0x56806b(0x2e6)],'room':_0xeb9a94[_0x56806b(0x27d)]});_0xeb9a94[_0x56806b(0x2c8)][_0x56806b(0x27a)](_0x23ea7f=>{var _0x3ef750=_0x56806b;const _0x3c62bb=_0x121230[_0x3ef750(0x287)][_0x3ef750(0x20f)](_0x42b69e=>{var _0x2ee72e=_0x3ef750;_0x42b69e[_0x2ee72e(0x281)]==_0x23ea7f[_0x2ee72e(0x281)]&&_0x42b69e[_0x2ee72e(0x25a)]==_0x23ea7f[_0x2ee72e(0x25a)]&&(_0x42b69e[_0x2ee72e(0x2e4)]=parseInt(_0x42b69e[_0x2ee72e(0x2e4)])-parseInt(_0x23ea7f[_0x2ee72e(0x1bd)]));});}),await _0x121230[_0x56806b(0x2c0)]();const {invoice:_0x810452,suppliers:_0x58dc2c,date:_0x4f85d9,warehouse_name:_0x5981c2,prod_name:_0x58013b,prod_code:_0x431ab8,prod_qty:_0x926ff8,prod_unit:_0x1016f3,prod_secondunit:_0x50c7df,prod_level:_0x456b7e,prod_isle:_0x50285e,prod_pallet:_0x4102a8,note:_0x217dfe,expiry_date:_0x2a394e,batch_code:_0x2dd1ec,paid_amount:_0x18e15b,due_amount:_0xe4e087,Room_name:_0x2d4009,primary_code:_0x42d7d3,secondary_code:_0x255f08,PO_number:_0x5713e4,JO_number:_0x15e172}=_0x4e57fd[_0x56806b(0x1ce)];if(typeof _0x58013b==_0x56806b(0x2a2))var _0x11caa0=[_0x4e57fd['body'][_0x56806b(0x29c)]],_0x2b1b00=[_0x4e57fd['body']['prod_code']],_0x3732c1=[_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x297)]],_0x27e480=[_0x4e57fd['body'][_0x56806b(0x1d3)]],_0x5d4667=[_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x290)]],_0x2a184d=[_0x4e57fd['body'][_0x56806b(0x299)]],_0x2a94ee=[_0x4e57fd[_0x56806b(0x1ce)]['primary_code']],_0x1df483=[_0x4e57fd['body'][_0x56806b(0x2ce)]],_0x595df3=[_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x252)]],_0x312199=[_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x226)]],_0x54b592=[_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x214)]];else var _0x11caa0=[..._0x4e57fd[_0x56806b(0x1ce)]['prod_name']],_0x2b1b00=[..._0x4e57fd[_0x56806b(0x1ce)]['prod_code']],_0x3732c1=[..._0x4e57fd[_0x56806b(0x1ce)]['prod_qty']],_0x27e480=[..._0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x1d3)]],_0x5d4667=[..._0x4e57fd['body'][_0x56806b(0x290)]],_0x2a184d=[..._0x4e57fd[_0x56806b(0x1ce)]['prod_level']],_0x2a94ee=[..._0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x264)]],_0x1df483=[..._0x4e57fd['body'][_0x56806b(0x2ce)]],_0x595df3=[..._0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x252)]],_0x312199=[..._0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x226)]],_0x54b592=[..._0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x214)]];const _0x1ddcd9=_0x11caa0[_0x56806b(0x20f)](_0x4c17a4=>{return _0x4c17a4={'product_name':_0x4c17a4};});_0x2b1b00[_0x56806b(0x27a)]((_0x13ae89,_0x1b477a)=>{var _0x448c5c=_0x56806b;_0x1ddcd9[_0x1b477a][_0x448c5c(0x2ed)]=_0x13ae89;}),_0x3732c1['forEach']((_0x154c7c,_0x3f8dd6)=>{_0x1ddcd9[_0x3f8dd6]['quantity']=_0x154c7c;}),_0x27e480[_0x56806b(0x27a)]((_0x2f199e,_0x3f0f4e)=>{var _0x1adb57=_0x56806b;_0x1ddcd9[_0x3f0f4e][_0x1adb57(0x1b1)]=_0x2f199e;}),_0x5d4667[_0x56806b(0x27a)]((_0x414a8b,_0x5d4053)=>{var _0x49aacd=_0x56806b;_0x1ddcd9[_0x5d4053][_0x49aacd(0x1eb)]=_0x414a8b;}),_0x2a184d['forEach']((_0x3b52da,_0x26e308)=>{var _0x1d2a73=_0x56806b;_0x1ddcd9[_0x26e308][_0x1d2a73(0x25a)]=_0x3b52da;}),_0x2a94ee['forEach']((_0x206c34,_0x41559e)=>{var _0x1f13e7=_0x56806b;_0x1ddcd9[_0x41559e][_0x1f13e7(0x264)]=_0x206c34;}),_0x1df483[_0x56806b(0x27a)]((_0x10edfc,_0x86afec)=>{var _0x25f97e=_0x56806b;_0x1ddcd9[_0x86afec][_0x25f97e(0x2ce)]=_0x10edfc;}),_0x595df3[_0x56806b(0x27a)]((_0x264576,_0x42fa73)=>{var _0x43d4a5=_0x56806b;_0x1ddcd9[_0x42fa73][_0x43d4a5(0x1d9)]=_0x264576;}),_0x312199['forEach']((_0x4e630c,_0x4ed8e9)=>{var _0x371b91=_0x56806b;_0x1ddcd9[_0x4ed8e9][_0x371b91(0x226)]=_0x4e630c;}),_0x54b592['forEach']((_0x509bb1,_0x520cab)=>{var _0x57cbee=_0x56806b;_0x1ddcd9[_0x520cab][_0x57cbee(0x214)]=_0x509bb1;});const _0x3a27ec=_0x1ddcd9[_0x56806b(0x2cf)](_0x1a220b=>_0x1a220b[_0x56806b(0x1bd)]!=='0'&&_0x1a220b[_0x56806b(0x1bd)]!=='');_0xeb9a94[_0x56806b(0x2c4)]=_0x810452,_0xeb9a94[_0x56806b(0x272)]=_0x58dc2c,_0xeb9a94[_0x56806b(0x1e3)]=_0x4f85d9,_0xeb9a94[_0x56806b(0x2e6)]=_0x5981c2,_0xeb9a94['product']=_0x3a27ec,_0xeb9a94[_0x56806b(0x1ee)]=_0x217dfe,_0xeb9a94[_0x56806b(0x245)]=_0x18e15b,_0xeb9a94['due_amount']=_0xe4e087,_0xeb9a94[_0x56806b(0x27d)]=_0x2d4009,_0xeb9a94[_0x56806b(0x270)]=_0x5713e4,_0xeb9a94[_0x56806b(0x2d8)]=_0x15e172;const _0x48a559=await _0xeb9a94[_0x56806b(0x2c0)](),_0x1e1010=await warehouse['findOne']({'name':_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x2e6)],'room':_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x1b7)]});_0xeb9a94[_0x56806b(0x2c8)][_0x56806b(0x27a)](_0xd4d61d=>{var _0x31c4ca=_0x56806b,_0x1d6123=0x0;const _0x4d9415=_0x1e1010[_0x31c4ca(0x287)][_0x31c4ca(0x20f)](_0x147320=>{var _0x27fa2e=_0x31c4ca;_0x147320['product_name']==_0xd4d61d[_0x27fa2e(0x281)]&&_0x147320[_0x27fa2e(0x25a)]==_0xd4d61d[_0x27fa2e(0x25a)]&&(_0x147320[_0x27fa2e(0x2e4)]=parseInt(_0x147320['product_stock'])+parseInt(_0xd4d61d[_0x27fa2e(0x1bd)]),_0x1d6123++);});_0x1d6123=='0'&&(_0x1e1010[_0x31c4ca(0x287)]=_0x1e1010[_0x31c4ca(0x287)][_0x31c4ca(0x241)]({'product_name':_0xd4d61d[_0x31c4ca(0x281)],'product_stock':_0xd4d61d[_0x31c4ca(0x1bd)],'primary_code':_0xd4d61d[_0x31c4ca(0x264)],'secondary_code':_0xd4d61d[_0x31c4ca(0x2ce)],'product_code':_0xd4d61d[_0x31c4ca(0x2ed)],'bay':_0xd4d61d['bay'],'maxProducts':_0xd4d61d[_0x31c4ca(0x1d9)],'unit':_0xd4d61d[_0x31c4ca(0x1b1)],'secondary_unit':_0xd4d61d[_0x31c4ca(0x1eb)],'expiry_date':_0xd4d61d['expiry_date']}));}),await _0x1e1010['save']();const _0x7ac0fc=await s_payment_data[_0x56806b(0x2db)]({'invoice':_0x4e57fd[_0x56806b(0x1ce)]['invoice']});if(_0x7ac0fc===null){}else console['log']('suppliers',_0x7ac0fc,_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x2c4)]),_0x7ac0fc['suppliers']=_0x4e57fd[_0x56806b(0x1ce)][_0x56806b(0x272)],await _0x7ac0fc[_0x56806b(0x2c0)]();_0x4e57fd[_0x56806b(0x23c)]('success','purchase\x20data\x20update\x20successfully'),_0x517a65[_0x56806b(0x247)]('/all_purchases_finished/view');}catch(_0x53fed6){console[_0x56806b(0x1d5)](_0x53fed6);}}),router['post'](a0_0x275920(0x22d),auth,async(_0x2769c3,_0x1cce91)=>{var _0x2af06b=a0_0x275920;try{const _0x445627=_0x2769c3[_0x2af06b(0x2a0)]['id'],{invoice:_0x565b13,suppliers:_0x4e84b9,payable:_0x1196c6,due_amount:_0x5ad124}=_0x2769c3['body'],_0x2aad3f=await purchases[_0x2af06b(0x1fc)](_0x445627);var _0x32f2bc=_0x1196c6-_0x5ad124;_0x2aad3f[_0x2af06b(0x245)]=parseFloat(_0x2aad3f[_0x2af06b(0x245)])+parseFloat(_0x5ad124),_0x2aad3f['due_amount']=_0x32f2bc;const _0x50e811=await _0x2aad3f[_0x2af06b(0x2c0)]();console['log'](_0x50e811);const _0x65d2d6=await s_payment_data[_0x2af06b(0x2db)]({'invoice':_0x565b13});_0x65d2d6[_0x2af06b(0x28b)]=_0x32f2bc,await _0x65d2d6[_0x2af06b(0x2c0)]();let _0x4c56f9=new Date(),_0x2bbb13=('0'+_0x4c56f9[_0x2af06b(0x248)]())[_0x2af06b(0x240)](-0x2),_0x42fd64=('0'+(_0x4c56f9['getMonth']()+0x1))['slice'](-0x2),_0x448f38=_0x4c56f9[_0x2af06b(0x2ae)](),_0x198660=_0x448f38+'-'+_0x42fd64+'-'+_0x2bbb13;const _0x325b3f=new suppliers_payment({'invoice':_0x565b13,'date':_0x448f38+'-'+_0x42fd64+'-'+_0x2bbb13,'suppliers':_0x4e84b9,'reason':_0x2af06b(0x209),'amount':_0x5ad124}),_0x127d4c=await _0x325b3f[_0x2af06b(0x2c0)]();_0x2769c3[_0x2af06b(0x23c)](_0x2af06b(0x2bb),'payment\x20successfull'),_0x1cce91[_0x2af06b(0x247)](_0x2af06b(0x216));}catch(_0x4bce77){console[_0x2af06b(0x1d5)](_0x4bce77);}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x1e6),auth,async(_0x53da65,_0x203026)=>{var _0x117db1=a0_0x275920;try{const {username:_0x43a26a,email:_0x347be1,role:_0x3bbf1b}=_0x53da65[_0x117db1(0x2a4)],_0x3c4749=_0x53da65[_0x117db1(0x2a4)],_0x130980=await profile[_0x117db1(0x2db)]({'email':_0x3c4749[_0x117db1(0x267)]}),_0x54e016=await master_shop[_0x117db1(0x21c)]();console[_0x117db1(0x1d5)](_0x117db1(0x22b),_0x54e016);const _0x1b8bd2=_0x53da65['params']['id'],_0x2c0230=await purchases[_0x117db1(0x1fc)](_0x1b8bd2);console[_0x117db1(0x1d5)](_0x2c0230);const _0x571d5e=await suppliers['findOne']({'name':_0x2c0230[_0x117db1(0x272)]});console['log'](_0x571d5e);if(_0x54e016[0x0]['language']=='English\x20(US)'){var _0x12fbfa=users['English'];console['log'](_0x12fbfa);}else{if(_0x54e016[0x0][_0x117db1(0x26c)]==_0x117db1(0x25e))var _0x12fbfa=users[_0x117db1(0x25e)];else{if(_0x54e016[0x0][_0x117db1(0x26c)]==_0x117db1(0x28c))var _0x12fbfa=users[_0x117db1(0x28c)];else{if(_0x54e016[0x0][_0x117db1(0x26c)]==_0x117db1(0x1f9))var _0x12fbfa=users['Spanish'];else{if(_0x54e016[0x0][_0x117db1(0x26c)]=='French')var _0x12fbfa=users[_0x117db1(0x266)];else{if(_0x54e016[0x0][_0x117db1(0x26c)]==_0x117db1(0x1b0))var _0x12fbfa=users[_0x117db1(0x2a3)];else{if(_0x54e016[0x0][_0x117db1(0x26c)]==_0x117db1(0x255))var _0x12fbfa=users[_0x117db1(0x255)];else{if(_0x54e016[0x0][_0x117db1(0x26c)]==_0x117db1(0x2ef))var _0x12fbfa=users['Arabic'];}}}}}}}_0x203026[_0x117db1(0x2b5)](_0x117db1(0x21a),{'success':_0x53da65[_0x117db1(0x23c)](_0x117db1(0x2bb)),'errors':_0x53da65['flash'](_0x117db1(0x1db)),'role':_0x3c4749,'profile':_0x130980,'master_shop':_0x54e016,'supplier':_0x571d5e,'purchase':_0x2c0230,'language':_0x12fbfa});}catch(_0x3936f4){console[_0x117db1(0x1d5)](_0x3936f4);}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x242),auth,async(_0x1aac29,_0x1499c3)=>{var _0x2b6eff=a0_0x275920;try{const {username:_0x978eb9,email:_0xadcc01,role:_0x3804c5}=_0x1aac29[_0x2b6eff(0x2a4)],_0x203e21=_0x1aac29[_0x2b6eff(0x2a4)],_0x423433=await profile[_0x2b6eff(0x2db)]({'email':_0x203e21[_0x2b6eff(0x267)]}),_0x43303d=await master_shop[_0x2b6eff(0x21c)]();console[_0x2b6eff(0x1d5)]('master',_0x43303d);const _0xf3dd32=_0x1aac29[_0x2b6eff(0x2a0)]['id'];console[_0x2b6eff(0x1d5)](_0xf3dd32);const _0x128724=await purchases_finished[_0x2b6eff(0x1fc)](_0xf3dd32);console[_0x2b6eff(0x1d5)]('user_id',_0x128724);const _0x5d785d=await product[_0x2b6eff(0x21c)]({}),_0x3800e5=await warehouse[_0x2b6eff(0x219)]([{'$match':{'name':_0x128724[_0x2b6eff(0x2e6)],'room':_0x128724[_0x2b6eff(0x27d)]}},{'$unwind':_0x2b6eff(0x2ab)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2b6eff(0x286)},'product_stock':{'$first':_0x2b6eff(0x1cc)},'bay':{'$first':_0x2b6eff(0x2f1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2b6eff(0x253)},'primary_code':{'$first':_0x2b6eff(0x2a8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2b6eff(0x280)},'storage':{'$first':_0x2b6eff(0x210)},'rack':{'$first':_0x2b6eff(0x2d5)}}}]);console[_0x2b6eff(0x1d5)]('stock_data',_0x3800e5);let _0x19bfb3;if(_0x203e21['role']==_0x2b6eff(0x1e2)){const _0x2ed437=await staff[_0x2b6eff(0x2db)]({'email':_0x203e21['email']});_0x19bfb3=await warehouse[_0x2b6eff(0x21c)]({'status':_0x2b6eff(0x1bf),'name':_0x2ed437[_0x2b6eff(0x2ec)],'warehouse_category':'Finished\x20Goods','name':_0x2b6eff(0x20b)});}else _0x19bfb3=await warehouse[_0x2b6eff(0x219)]([{'$match':{'status':_0x2b6eff(0x1bf),'warehouse_category':_0x2b6eff(0x2c6),'name':_0x2b6eff(0x20b)}},{'$group':{'_id':_0x2b6eff(0x1b5),'name':{'$first':_0x2b6eff(0x1b5)}}}]);if(_0x43303d[0x0][_0x2b6eff(0x26c)]=='English\x20(US)'){var _0x160a54=users['English'];console[_0x2b6eff(0x1d5)](_0x160a54);}else{if(_0x43303d[0x0][_0x2b6eff(0x26c)]==_0x2b6eff(0x25e))var _0x160a54=users[_0x2b6eff(0x25e)];else{if(_0x43303d[0x0][_0x2b6eff(0x26c)]==_0x2b6eff(0x28c))var _0x160a54=users[_0x2b6eff(0x28c)];else{if(_0x43303d[0x0][_0x2b6eff(0x26c)]=='Spanish')var _0x160a54=users[_0x2b6eff(0x1f9)];else{if(_0x43303d[0x0][_0x2b6eff(0x26c)]==_0x2b6eff(0x266))var _0x160a54=users[_0x2b6eff(0x266)];else{if(_0x43303d[0x0][_0x2b6eff(0x26c)]==_0x2b6eff(0x1b0))var _0x160a54=users[_0x2b6eff(0x2a3)];else{if(_0x43303d[0x0]['language']==_0x2b6eff(0x255))var _0x160a54=users[_0x2b6eff(0x255)];else{if(_0x43303d[0x0][_0x2b6eff(0x26c)]==_0x2b6eff(0x2ef))var _0x160a54=users[_0x2b6eff(0x20e)];}}}}}}}_0x1499c3[_0x2b6eff(0x2b5)](_0x2b6eff(0x2c5),{'success':_0x1aac29[_0x2b6eff(0x23c)](_0x2b6eff(0x2bb)),'errors':_0x1aac29[_0x2b6eff(0x23c)](_0x2b6eff(0x1db)),'role':_0x203e21,'profile':_0x423433,'user':_0x128724,'stock':_0x3800e5,'master_shop':_0x43303d,'product':_0x5d785d,'language':_0x160a54,'warehouse':_0x19bfb3});}catch(_0x26e6a1){console['log'](_0x26e6a1);}}),router[a0_0x275920(0x1c5)](a0_0x275920(0x242),auth,async(_0x1d19d1,_0x433e37)=>{var _0x19f3f2=a0_0x275920;try{const {invoice:_0x22e1f1,date:_0x334196,warehouse_name:_0x19a432,Room_name:_0xd69cff,product_name:_0x44ec52,purchase_quantity:_0x11f2c5,stocks:_0x326473,return_qty:_0x39fed1,note:_0x25c4e7,level:_0x34d29c,isle:_0x308a26,pallet:_0x1f02a3,to_warehouse_name:_0x54cf3c,to_Room_name:_0x653c7e}=_0x1d19d1[_0x19f3f2(0x1ce)],_0x470414=await purchases_finished[_0x19f3f2(0x2db)]({'_id':_0x1d19d1[_0x19f3f2(0x2a0)]['id']}),_0x16c9f8=await warehouse[_0x19f3f2(0x2db)]({'name':_0x19a432,'room':_0xd69cff,'warehouse_category':'Finished\x20Goods'});if(typeof _0x44ec52==_0x19f3f2(0x2a2))var _0x16ac25=[_0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x281)]],_0x280c69=[_0x1d19d1['body'][_0x19f3f2(0x28d)]],_0x411be4=[_0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x2cc)]],_0x324441=[_0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x1ec)]],_0x48f2d6=[_0x1d19d1[_0x19f3f2(0x1ce)]['level']],_0x3d1055=[_0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x200)]],_0x47dc78=[_0x1d19d1['body'][_0x19f3f2(0x204)]],_0x469b9a=[_0x1d19d1['body']['secondary_code_hide']];else var _0x16ac25=[..._0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x281)]],_0x280c69=[..._0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x28d)]],_0x411be4=[..._0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x2cc)]],_0x324441=[..._0x1d19d1[_0x19f3f2(0x1ce)]['return_qty']],_0x48f2d6=[..._0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x2e1)]],_0x3d1055=[..._0x1d19d1['body'][_0x19f3f2(0x200)]],_0x47dc78=[..._0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x204)]],_0x469b9a=[..._0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x1df)]];const _0x132d4c=_0x16ac25[_0x19f3f2(0x20f)](_0x2c7cf8=>{return _0x2c7cf8={'product_name':_0x2c7cf8};});_0x280c69[_0x19f3f2(0x27a)]((_0x35e689,_0x22d27a)=>{var _0x1469f1=_0x19f3f2;_0x132d4c[_0x22d27a][_0x1469f1(0x28d)]=_0x35e689;}),_0x411be4[_0x19f3f2(0x27a)]((_0x35576e,_0x1543da)=>{var _0x4dcf7f=_0x19f3f2;_0x132d4c[_0x1543da][_0x4dcf7f(0x26a)]=_0x35576e;}),_0x324441[_0x19f3f2(0x27a)]((_0x21c8f1,_0x344197)=>{var _0x35e639=_0x19f3f2;_0x132d4c[_0x344197][_0x35e639(0x1ec)]=_0x21c8f1;}),_0x48f2d6['forEach']((_0x5656f3,_0x48ccba)=>{var _0x5e1283=_0x19f3f2;_0x132d4c[_0x48ccba][_0x5e1283(0x25a)]=_0x5656f3;}),_0x3d1055[_0x19f3f2(0x27a)]((_0x221870,_0x4cf373)=>{var _0x188527=_0x19f3f2;_0x132d4c[_0x4cf373][_0x188527(0x2ed)]=_0x221870;}),_0x47dc78[_0x19f3f2(0x27a)]((_0x3482d1,_0x11982f)=>{_0x132d4c[_0x11982f]['primary_code']=_0x3482d1;}),_0x469b9a['forEach']((_0x22b3b3,_0x52964f)=>{_0x132d4c[_0x52964f]['secondary_code']=_0x22b3b3;}),_0x132d4c[_0x19f3f2(0x27a)](_0x15b732=>{var _0x3bbd3f=_0x19f3f2;console[_0x3bbd3f(0x1d5)](_0x15b732);const _0x146411=_0x16c9f8[_0x3bbd3f(0x287)][_0x3bbd3f(0x20f)](_0x5b81c9=>{var _0x342f8a=_0x3bbd3f;_0x5b81c9[_0x342f8a(0x281)]==_0x15b732[_0x342f8a(0x281)]&&_0x5b81c9[_0x342f8a(0x25a)]==_0x15b732['bay']&&(console[_0x342f8a(0x1d5)](parseInt(_0x5b81c9['product_stock'])+'\x20<>\x20'+parseInt(_0x15b732['return_qty'])),_0x5b81c9[_0x342f8a(0x2e4)]=parseInt(_0x5b81c9[_0x342f8a(0x2e4)])-parseInt(_0x15b732[_0x342f8a(0x1ec)]));});}),await _0x16c9f8[_0x19f3f2(0x2c0)]();var _0x11a7c9=0x0;_0x132d4c['forEach'](_0x2fd4fc=>{var _0x5451f3=_0x19f3f2;(parseInt(_0x2fd4fc[_0x5451f3(0x28d)])<parseInt(_0x2fd4fc['return_qty'])||parseInt(_0x2fd4fc[_0x5451f3(0x26a)])<parseInt(_0x2fd4fc[_0x5451f3(0x1ec)]))&&_0x11a7c9++;});if(_0x11a7c9!=0x0)return _0x1d19d1['flash'](_0x19f3f2(0x1db),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x433e37['redirect']('back');const _0x174185=new purchases_return_finished({'invoice':_0x22e1f1,'suppliers':_0x1d19d1['body']['suppliers'],'date':_0x334196,'warehouse_name':_0x19a432,'return_product':_0x132d4c,'note':_0x25c4e7,'room':_0xd69cff,'to_warehouse_name':_0x54cf3c,'to_room':_0x653c7e}),_0x421702=await _0x174185[_0x19f3f2(0x2c0)](),_0x13126a=await purchases_return_finished[_0x19f3f2(0x2db)]({'invoice':_0x22e1f1}),_0x159e8a=await warehouse[_0x19f3f2(0x2db)]({'name':_0x54cf3c,'room':_0x653c7e,'warehouse_category':'Finished\x20Goods'});_0x13126a[_0x19f3f2(0x2ee)][_0x19f3f2(0x27a)](_0x3942d9=>{var _0x59e341=_0x19f3f2,_0x2bc046=0x0;const _0x3f3c76=_0x159e8a[_0x59e341(0x287)][_0x59e341(0x20f)](_0x4d515c=>{var _0x1f87d7=_0x59e341;console[_0x1f87d7(0x1d5)](_0x4d515c['product_name']+'=='+_0x3942d9[_0x1f87d7(0x281)]+'&&'+_0x4d515c[_0x1f87d7(0x25a)]+'=='+_0x3942d9['bay']),_0x4d515c['product_name']==_0x3942d9[_0x1f87d7(0x281)]&&_0x4d515c['bay']==_0x3942d9[_0x1f87d7(0x25a)]&&(_0x4d515c[_0x1f87d7(0x2e4)]=parseInt(_0x4d515c[_0x1f87d7(0x2e4)])-parseInt(_0x3942d9[_0x1f87d7(0x1ec)]),_0x2bc046++);});_0x2bc046=='0'&&(_0x159e8a['product_details']=_0x159e8a[_0x59e341(0x287)][_0x59e341(0x241)]({'product_name':_0x3942d9[_0x59e341(0x281)],'product_stock':_0x3942d9[_0x59e341(0x1ec)],'primary_code':_0x3942d9[_0x59e341(0x264)],'secondary_code':_0x3942d9[_0x59e341(0x2ce)],'product_code':_0x3942d9[_0x59e341(0x2ed)],'bay':_0x3942d9[_0x59e341(0x25a)],'maxProducts':0xf423f}));}),await _0x159e8a[_0x19f3f2(0x2c0)]();const _0x5cb892=await purchases_finished[_0x19f3f2(0x2db)]({'invoice':_0x22e1f1});_0x5cb892[_0x19f3f2(0x1f2)]='True';const _0x173c15=await _0x5cb892['save'](),_0x19faac=new s_payment_data({'invoice':_0x22e1f1,'suppliers':_0x1d19d1[_0x19f3f2(0x1ce)][_0x19f3f2(0x272)],'reason':_0x19f3f2(0x243)});await _0x19faac['save']();const _0x4ce0cf=await master_shop['find'](),_0x3d38eb=await email_settings['findOne'](),_0x4f1dc0=await suppliers['findOne']({'name':_0x1d19d1['body'][_0x19f3f2(0x272)]});_0x4ce0cf[0x0]['currency_placement']==0x1?(right_currency=_0x4ce0cf[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4ce0cf[0x0][_0x19f3f2(0x1fb)]);var _0x3d5404=_0x16ac25,_0x2b8711=_0x324441,_0x6f84b0='',_0x2a0a01;for(_0x2a0a01 in _0x3d5404){_0x6f84b0+=_0x19f3f2(0x257)+_0x19f3f2(0x2e5)+_0x3d5404[_0x2a0a01]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b8711[_0x2a0a01]+'</td>'+_0x19f3f2(0x291);}let _0x47c4c3=nodemailer[_0x19f3f2(0x1cb)]({'service':_0x19f3f2(0x2b3),'auth':{'user':_0x3d38eb['email'],'pass':_0x3d38eb['password']}}),_0x3a0803={'from':_0x3d38eb[_0x19f3f2(0x267)],'to':_0x4f1dc0[_0x19f3f2(0x267)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x19f3f2(0x233),'path':__dirname+_0x19f3f2(0x203)+'/upload/'+_0x4ce0cf[0x0][_0x19f3f2(0x1e4)],'cid':_0x19f3f2(0x1c1)}],'html':_0x19f3f2(0x27e)+_0x19f3f2(0x1b9)+_0x19f3f2(0x211)+_0x19f3f2(0x22a)+_0x19f3f2(0x1f6)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x19f3f2(0x1e7)+'<div>'+_0x19f3f2(0x237)+_0x4ce0cf[0x0][_0x19f3f2(0x1bc)]+_0x19f3f2(0x2da)+_0x19f3f2(0x1e7)+'</div>'+_0x19f3f2(0x21b)+_0x19f3f2(0x22a)+_0x19f3f2(0x292)+_0x19f3f2(0x2e8)+_0x22e1f1+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x19f3f2(0x23d)+_0x334196+'\x20'+_0x19f3f2(0x2be)+'</h5>'+_0x19f3f2(0x1e7)+_0x19f3f2(0x285)+_0x19f3f2(0x295)+_0x19f3f2(0x257)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x19f3f2(0x221)+_0x19f3f2(0x29d)+_0x19f3f2(0x218)+'</tr>'+'</thead>'+_0x19f3f2(0x223)+'\x20'+_0x6f84b0+'\x20'+_0x19f3f2(0x2ba)+_0x19f3f2(0x1af)+_0x19f3f2(0x22a)+'<strong>\x20Regards\x20</strong>'+_0x19f3f2(0x284)+_0x4ce0cf[0x0][_0x19f3f2(0x1bc)]+_0x19f3f2(0x232)+_0x19f3f2(0x1e7)+_0x19f3f2(0x1e7)+_0x19f3f2(0x28f)};_0x47c4c3[_0x19f3f2(0x29b)](_0x3a0803,function(_0x1bf53e,_0x17fbbf){var _0x53d568=_0x19f3f2;_0x1bf53e?console[_0x53d568(0x1d5)](_0x53d568(0x1d8)):console[_0x53d568(0x1d5)](_0x53d568(0x25b));}),_0x1d19d1[_0x19f3f2(0x23c)](_0x19f3f2(0x2bb),_0x19f3f2(0x1d1)),_0x433e37[_0x19f3f2(0x247)](_0x19f3f2(0x1ed));}catch(_0xf51590){_0x433e37[_0x19f3f2(0x1fa)](0xc8)[_0x19f3f2(0x239)]({'message':_0xf51590[_0x19f3f2(0x27f)]});}}),router[a0_0x275920(0x2ad)](a0_0x275920(0x2ac),auth,async(_0x3d4026,_0x3dfd89)=>{var _0x285c11=a0_0x275920;try{const {username:_0x4f4a6b,email:_0xd5a344,role:_0x547cf8}=_0x3d4026['user'],_0x25cd4f=_0x3d4026[_0x285c11(0x2a4)],_0x3c0b51=await profile[_0x285c11(0x2db)]({'email':_0x25cd4f[_0x285c11(0x267)]}),_0x334a47=await master_shop[_0x285c11(0x21c)](),_0x52890d=_0x3d4026[_0x285c11(0x2a0)]['id'],_0x2c9509=await purchases_finished[_0x285c11(0x1fc)](_0x52890d);if(_0x334a47[0x0][_0x285c11(0x26c)]==_0x285c11(0x20c))var _0x338248=users[_0x285c11(0x202)];else{if(_0x334a47[0x0]['language']==_0x285c11(0x25e))var _0x338248=users[_0x285c11(0x25e)];else{if(_0x334a47[0x0][_0x285c11(0x26c)]=='German')var _0x338248=users['German'];else{if(_0x334a47[0x0]['language']==_0x285c11(0x1f9))var _0x338248=users['Spanish'];else{if(_0x334a47[0x0][_0x285c11(0x26c)]==_0x285c11(0x266))var _0x338248=users[_0x285c11(0x266)];else{if(_0x334a47[0x0]['language']==_0x285c11(0x1b0))var _0x338248=users[_0x285c11(0x2a3)];else{if(_0x334a47[0x0]['language']==_0x285c11(0x255))var _0x338248=users[_0x285c11(0x255)];else{if(_0x334a47[0x0][_0x285c11(0x26c)]==_0x285c11(0x2ef))var _0x338248=users[_0x285c11(0x20e)];}}}}}}}_0x3dfd89['render'](_0x285c11(0x1ca),{'success':_0x3d4026['flash']('success'),'errors':_0x3d4026[_0x285c11(0x23c)]('errors'),'role':_0x25cd4f,'profile':_0x3c0b51,'alldata':_0x2c9509,'master_shop':_0x334a47,'language':_0x338248}),console['log'](alldata);}catch(_0x4be494){console[_0x285c11(0x1d5)](_0x4be494);}}),router[a0_0x275920(0x1c5)](a0_0x275920(0x1da),async(_0x33663e,_0x3d6b4e)=>{var _0x21ceee=a0_0x275920;const {product_code:_0x413d8b}=_0x33663e[_0x21ceee(0x1ce)];var _0x1394c8;const _0x519bab=await product[_0x21ceee(0x219)]([{'$match':{'primary_code':_0x413d8b}},{'$group':{'_id':_0x21ceee(0x1e9),'name':{'$first':_0x21ceee(0x1b5)},'category':{'$first':_0x21ceee(0x222)},'brand':{'$first':_0x21ceee(0x236)},'unit':{'$first':_0x21ceee(0x262)},'alertquantity':{'$first':_0x21ceee(0x1c6)},'product_code':{'$first':_0x21ceee(0x282)},'primary_code':{'$first':_0x21ceee(0x23a)},'secondary_code':{'$first':_0x21ceee(0x1d6)},'maxStocks':{'$first':_0x21ceee(0x213)},'maxProdPerUnit':{'$first':_0x21ceee(0x1cf)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x21ceee(0x235)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x21ceee(0x1b2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x31f4d7=await product['aggregate']([{'$match':{'secondary_code':_0x413d8b}},{'$group':{'_id':_0x21ceee(0x1e9),'name':{'$first':_0x21ceee(0x1b5)},'category':{'$first':_0x21ceee(0x222)},'brand':{'$first':'$brand'},'unit':{'$first':_0x21ceee(0x262)},'alertquantity':{'$first':_0x21ceee(0x1c6)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x21ceee(0x23a)},'secondary_code':{'$first':_0x21ceee(0x1d6)},'maxStocks':{'$first':_0x21ceee(0x213)},'maxProdPerUnit':{'$first':_0x21ceee(0x1cf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x21ceee(0x235)},'gross_price':{'$first':_0x21ceee(0x271)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x519bab[_0x21ceee(0x2bc)]>0x0)_0x1394c8=_0x519bab;else _0x31f4d7['length']>0x0&&(_0x1394c8=_0x31f4d7);_0x3d6b4e[_0x21ceee(0x239)](_0x1394c8);}),router[a0_0x275920(0x1c5)](a0_0x275920(0x289),async(_0x5e05be,_0x350a17)=>{var _0x245911=a0_0x275920;const {productCode:_0x14d9a8,bay:_0x10bd0a,warehouses:_0x4b0704,room:_0x2af456}=_0x5e05be[_0x245911(0x1ce)];console[_0x245911(0x1d5)](_0x5e05be[_0x245911(0x1ce)]);try{const _0x535921=await warehouse[_0x245911(0x219)]([{'$match':{'name':_0x4b0704,'room':_0x2af456}},{'$unwind':_0x245911(0x2ab)},{'$match':{'product_details.bay':parseInt(_0x10bd0a)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x245911(0x286)},'product_stock':{'$first':_0x245911(0x1cc)},'bay':{'$first':_0x245911(0x2f1)},'maxProducts':{'$first':_0x245911(0x21e)}}}]);_0x350a17[_0x245911(0x1fa)](0xc8)[_0x245911(0x239)](_0x535921);}catch(_0x29a393){_0x350a17[_0x245911(0x1fa)](0x194)['json']({'message':_0x29a393[_0x245911(0x27f)]});}}),router['post'](a0_0x275920(0x23e),async(_0x4ccf27,_0x21a7d7)=>{var _0x4a18d2=a0_0x275920;const {product_code:_0x337153}=_0x4ccf27[_0x4a18d2(0x1ce)];var _0x1a9fe;const _0x5ae70f=await product[_0x4a18d2(0x219)]([{'$match':{'primary_code':_0x337153,'type_products':_0x4a18d2(0x1d5)}},{'$group':{'_id':_0x4a18d2(0x1e9),'name':{'$first':'$name'},'category':{'$first':_0x4a18d2(0x222)},'brand':{'$first':_0x4a18d2(0x236)},'unit':{'$first':_0x4a18d2(0x262)},'alertquantity':{'$first':_0x4a18d2(0x1c6)},'product_code':{'$first':_0x4a18d2(0x282)},'primary_code':{'$first':_0x4a18d2(0x23a)},'secondary_code':{'$first':_0x4a18d2(0x1d6)},'maxStocks':{'$first':_0x4a18d2(0x213)},'maxProdPerUnit':{'$first':_0x4a18d2(0x1cf)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4a18d2(0x235)},'gross_price':{'$first':_0x4a18d2(0x271)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x4a18d2(0x2a7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x4a18d2(0x1d5)](_0x5ae70f);const _0x2aaf6c=await product[_0x4a18d2(0x219)]([{'$match':{'secondary_code':_0x337153,'type_products':_0x4a18d2(0x1d5)}},{'$group':{'_id':_0x4a18d2(0x1e9),'name':{'$first':_0x4a18d2(0x1b5)},'category':{'$first':_0x4a18d2(0x222)},'brand':{'$first':_0x4a18d2(0x236)},'unit':{'$first':_0x4a18d2(0x262)},'alertquantity':{'$first':_0x4a18d2(0x1c6)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4a18d2(0x1cf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x4a18d2(0x271)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x4a18d2(0x2a7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x5ae70f[_0x4a18d2(0x2bc)]>0x0)_0x1a9fe=_0x5ae70f;else _0x2aaf6c['length']>0x0&&(_0x1a9fe=_0x2aaf6c);_0x21a7d7[_0x4a18d2(0x239)](_0x1a9fe);}),module['exports']=router;