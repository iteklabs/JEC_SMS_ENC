function a0_0x8be4(_0x594210,_0x2750d6){var _0x5cff05=a0_0x5cff();return a0_0x8be4=function(_0x8be4f5,_0x587cb4){_0x8be4f5=_0x8be4f5-0x1ba;var _0x2486d5=_0x5cff05[_0x8be4f5];return _0x2486d5;},a0_0x8be4(_0x594210,_0x2750d6);}var a0_0x192b41=a0_0x8be4;(function(_0x44221e,_0x370fd2){var _0x46dc46=a0_0x8be4,_0x430770=_0x44221e();while(!![]){try{var _0xd6446d=parseInt(_0x46dc46(0x1bb))/0x1+-parseInt(_0x46dc46(0x2ab))/0x2*(parseInt(_0x46dc46(0x1c3))/0x3)+parseInt(_0x46dc46(0x1d9))/0x4+-parseInt(_0x46dc46(0x2a8))/0x5+parseInt(_0x46dc46(0x2cf))/0x6*(-parseInt(_0x46dc46(0x2a0))/0x7)+parseInt(_0x46dc46(0x1ca))/0x8*(parseInt(_0x46dc46(0x267))/0x9)+-parseInt(_0x46dc46(0x2e1))/0xa*(parseInt(_0x46dc46(0x1fa))/0xb);if(_0xd6446d===_0x370fd2)break;else _0x430770['push'](_0x430770['shift']());}catch(_0x3254f1){_0x430770['push'](_0x430770['shift']());}}}(a0_0x5cff,0x5c667));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x192b41(0x297)),auth=require(a0_0x192b41(0x285)),nodemailer=require(a0_0x192b41(0x207));var ejs=require(a0_0x192b41(0x1ba));const path=require(a0_0x192b41(0x1c6)),users=require(a0_0x192b41(0x2a1)),{isNull}=require('util');router[a0_0x192b41(0x1e4)](a0_0x192b41(0x200),auth,async(_0x313fbf,_0x36be2f)=>{var _0x49fb2a=a0_0x192b41;try{const {username:_0x49c272,email:_0x20b448,role:_0x5053e6}=_0x313fbf[_0x49fb2a(0x2e8)],_0x20ef23=_0x313fbf[_0x49fb2a(0x2e8)],_0x2fb5ac=await profile[_0x49fb2a(0x21c)]({'email':_0x20ef23['email']}),_0x5803eb=await staff[_0x49fb2a(0x21c)]({'email':_0x20ef23[_0x49fb2a(0x281)]}),_0x5c76f5=await master_shop['find']();let _0x4b61ad=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x5803eb['warehouse']}}]);if(_0x5c76f5[0x0][_0x49fb2a(0x245)]==_0x49fb2a(0x1d4))var _0x2b8532=users['English'];else{if(_0x5c76f5[0x0][_0x49fb2a(0x245)]==_0x49fb2a(0x2d6))var _0x2b8532=users['Hindi'];else{if(_0x5c76f5[0x0]['language']=='German')var _0x2b8532=users[_0x49fb2a(0x28f)];else{if(_0x5c76f5[0x0][_0x49fb2a(0x245)]==_0x49fb2a(0x2b5))var _0x2b8532=users['Spanish'];else{if(_0x5c76f5[0x0]['language']==_0x49fb2a(0x2cd))var _0x2b8532=users['French'];else{if(_0x5c76f5[0x0][_0x49fb2a(0x245)]==_0x49fb2a(0x259))var _0x2b8532=users[_0x49fb2a(0x275)];else{if(_0x5c76f5[0x0][_0x49fb2a(0x245)]=='Chinese')var _0x2b8532=users[_0x49fb2a(0x257)];else{if(_0x5c76f5[0x0][_0x49fb2a(0x245)]==_0x49fb2a(0x1c1))var _0x2b8532=users[_0x49fb2a(0x243)];}}}}}}}_0x36be2f[_0x49fb2a(0x1e7)](_0x49fb2a(0x1d3),{'success':_0x313fbf['flash'](_0x49fb2a(0x233)),'errors':_0x313fbf['flash'](_0x49fb2a(0x2f5)),'purchases':_0x4b61ad,'role':_0x20ef23,'profile':_0x2fb5ac,'master_shop':_0x5c76f5,'language':_0x2b8532,'staff_data':_0x5803eb});}catch(_0x5559f6){console['log'](_0x49fb2a(0x2d9),_0x5559f6),_0x36be2f['status'](0xc8)[_0x49fb2a(0x1fc)]({'message':_0x5559f6[_0x49fb2a(0x25f)]});}}),router[a0_0x192b41(0x1e4)](a0_0x192b41(0x2cb),auth,async(_0x37db3e,_0x55df20)=>{var _0x35f213=a0_0x192b41;try{const {username:_0x3e908d,email:_0x40955a,role:_0x14480f}=_0x37db3e[_0x35f213(0x2e8)],_0x2412f9=_0x37db3e[_0x35f213(0x2e8)],_0x2df844=await profile[_0x35f213(0x21c)]({'email':_0x2412f9['email']}),_0x42153e=await staff[_0x35f213(0x21c)]({'email':_0x2412f9[_0x35f213(0x281)]}),_0x1ca45b=await master_shop[_0x35f213(0x23d)]();let _0x29c859=await transfers_finished[_0x35f213(0x1d0)]([{'$match':{'to_warehouse':_0x42153e[_0x35f213(0x2a5)],'to_recieved':_0x35f213(0x29a)}}]);if(_0x1ca45b[0x0][_0x35f213(0x245)]=='English\x20(US)')var _0x58ffd6=users[_0x35f213(0x29b)];else{if(_0x1ca45b[0x0][_0x35f213(0x245)]=='Hindi')var _0x58ffd6=users['Hindi'];else{if(_0x1ca45b[0x0][_0x35f213(0x245)]==_0x35f213(0x28f))var _0x58ffd6=users[_0x35f213(0x28f)];else{if(_0x1ca45b[0x0]['language']==_0x35f213(0x2b5))var _0x58ffd6=users[_0x35f213(0x2b5)];else{if(_0x1ca45b[0x0][_0x35f213(0x245)]==_0x35f213(0x2cd))var _0x58ffd6=users[_0x35f213(0x2cd)];else{if(_0x1ca45b[0x0][_0x35f213(0x245)]==_0x35f213(0x259))var _0x58ffd6=users['Portuguese'];else{if(_0x1ca45b[0x0][_0x35f213(0x245)]==_0x35f213(0x257))var _0x58ffd6=users['Chinese'];else{if(_0x1ca45b[0x0][_0x35f213(0x245)]=='Arabic\x20(ae)')var _0x58ffd6=users[_0x35f213(0x243)];}}}}}}}_0x55df20[_0x35f213(0x1e7)]('incoming_add',{'success':_0x37db3e[_0x35f213(0x23b)](_0x35f213(0x233)),'errors':_0x37db3e[_0x35f213(0x23b)](_0x35f213(0x2f5)),'purchases':_0x29c859,'role':_0x2412f9,'profile':_0x2df844,'master_shop':_0x1ca45b,'language':_0x58ffd6,'staff_data':_0x42153e});}catch(_0x24b52e){console['log']('table\x20page',_0x24b52e),_0x55df20['status'](0xc8)['json']({'message':_0x24b52e[_0x35f213(0x25f)]});}});function a0_0x5cff(){var _0x2d8304=['/view/:id','host','edit_purchases_finished_view','/invoice/:id','maxperunit','post','$product_details.maxProducts','Portuguese','length','getFullYear','$secondary_unit','to_warehouse','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$brand','to_recieved','/preview/:id','return_qty','product_details','email','$room','logo','map','../middleware/auth','$due_amount','<thead\x20style=\x22width:\x20100%\x20!important;\x22>',',\x20bay:\x20','\x20<>\x20','suppliers','/barcode_scanner','currency','/view/add_purchases/:id','toString','German','getDate','$type_products','return_purchase_finished','INC-','stock_quantity','$invoice','true','../models/all_models','invoice','status','false','English','There\x20is\x20','isProcess','date','$product_details.floorlevel','21YZSxUj','../public/language/languages.json','</div>','purchase_quantity','log','warehouse','INC','$note','2118425tAKfNQ','item_code','slice','6QuQUtX','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product.bay','prod_code','bay','password','user_id','$primary_code','type_of_products','to_room_name','Spanish','$product.room_name','Rack\x201','error','updateOne','$warehouse_name','$batch_code','An\x20error\x20occurred.','Return\x20Goods','product_id','purchases_process','Asia/Manila','all','floor','$product_details.type','/all_purchases_finished/preview/','</tbody>','product_date','product_data','expiry_date','redirect','prod_qty','/incoming/add','primary_code','French','/all_purchases_finished/process/','934026YtEcbn','prod_unit','then','payment\x20successfull','</thead>','RoomAssign','\x20</h2>','Hindi','back','to_quantity','table\x20page','</head><body>','$product.quantity','product_cat','$product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_level','min','90AvDPkS','production_date','Error\x20Occurs',',\x20bin:\x20','$product','note','room_name','user','add_purchases_finished','own','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','string','currency_placement','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','<tr>','$suppliers_docs','/upload/','Room_name','all_purchases_finished_logs','errors','maxStocks','sales_data_cateory','logs','$date','INCF-','ejs','500840GJuCem','port','exports','$gross_price','Paid\x20For\x20Purchase','forEach','Arabic\x20(ae)','image','378678VHDrDp','$alertquantity','save','path','match','product_stock','gmail','13360oiNYtM','/view/add_purchases','createTransport','body','MaxStocks_data','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','aggregate','site_title','</body></html>','incoming_view','English\x20(US)','/../public','Logo.png','getMonth','product_name','2635780Ilfwij','$product_details._id','edit_purchases_finished','<span\x20style=\x22float:\x20right;\x22>','\x20<=>\x20','max','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Enclosed','room','to_bay','get','Purchase\x20Return','Rack\x202','render','role','warehouse_name','/all_purchases_finished/view','valueOf','Purchase\x20Return\x20Mail','date_recieved','Transfer\x20Finalize\x20Successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','staff','filter','/give_payment/:id','maxPerUnit','JO_number','Email\x20sent\x20successfully','/getinvoicetrf','random','LOG-INC-','/CheckingWarehouse','326062hqjsHq','$maxStocks','json','stocks','<h5>','<hr\x20class=\x22my-3\x22>','/incoming','True','sendMail','$_id','An\x20error\x20occurred\x20while\x20saving\x20data.','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','findById','nodemailer','quantity','concat','\x20Order\x20Date\x20:\x20','secondary_code_hide','\x20Order\x20Number\x20:\x20','/barcode/:id','<h2>\x20','Enabled','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details','sales_category','$sales_category','</span>','_id','<tbody\x20style=\x22text-align:\x20center;\x22>','$suppliers','/process/:id','$unit','amount','$name','findOne','toLocaleDateString','$product_details.secondary_code','/view/return_purchase/:id','Distributing\x20','add_purchases_finished_logs','$maxProdPerUnit','batch_code','return_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','params','en-CA','secondary_unit','max_product_unit','invoice_init','uuid','/view/add_purchases_logs','abs','prod_secondunit','prod_name','<strong>\x20Regards\x20</strong>','paid_amount','</tr>','success','prod_cat','$product.bin','all_purchases_finished','$product_details.product_code','$category','secondary_code','DRY\x20GOODS','flash','Ambient','find','bin','</table>','<div>','name','master','Arabic','Error\x20occurred\x20while\x20processing\x20product:','language','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.bin','level','padStart','prod_Qty','$secondary_code','product_code','$product_details.primary_code','suppliers_docs','primary_code_hide','$paid_amount','$product_details.product_stock','$product_code','purchases\x20item\x20return\x20successfull','$expiry_date','purchase\x20data\x20add\x20successfully','Chinese','unit','Portuguese\x20(BR)','2-digit','$product.floorlevel','prod_primunit','due_amount','catch','message','<!DOCTYPE\x20html>','gross_price','\x20units\x20to\x20warehouse:\x20','standard_unit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','maxProducts','<html><head><title></title>','4068xnWAJz','$product_details.product_name','product','$product_details.storage','</h5>','$return_data','Finished\x20Goods'];a0_0x5cff=function(){return _0x2d8304;};return a0_0x5cff();}const createLog=async _0x444faf=>{var _0x40b890=a0_0x192b41;const _0x2cecb7=new datalogs({'location':_0x444faf});return await _0x2cecb7[_0x40b890(0x1c5)](),_0x2cecb7[_0x40b890(0x22a)];};router[a0_0x192b41(0x273)](a0_0x192b41(0x2cb),auth,async(_0x448649,_0x52f4df)=>{var _0x257987=a0_0x192b41;try{const {invoice_trf_data:_0x3796fb,item_code:_0x3ccfcb,SCRN:_0x4f45ba,ReqBy:_0x565710,type_of_products:_0x153c47,dateofreq:_0x4f2ff2,PO_number:_0x53f533,date:_0x5aea55,warehouse_name:_0x3ec884,typeservicesData:_0x12fae6,typevehicle:_0x424c4c,driver:_0x5e9836,plate:_0x4f872b,van:_0x165c2b,DRSI:_0x26d4ba,TSU:_0x17d6be,TFU:_0x3dc5b4,note:_0x1b2dac}=_0x448649[_0x257987(0x1cd)],_0x1615ca=await transfers_finished['findById'](_0x3796fb);if(typeof _0x3ccfcb=='string')var _0x30be87=[_0x448649[_0x257987(0x1cd)][_0x257987(0x1d8)]],_0x2370de=[_0x448649['body'][_0x257987(0x2a9)]],_0x22e793=[_0x448649[_0x257987(0x1cd)][_0x257987(0x2d8)]],_0x130d5a=[_0x448649[_0x257987(0x1cd)]['unit']],_0x295b65=[_0x448649[_0x257987(0x1cd)]['prod_secondunit']],_0x494409=[_0x448649[_0x257987(0x1cd)][_0x257987(0x23e)]],_0x57fe02=[_0x448649['body'][_0x257987(0x2cc)]],_0xc8921e=[_0x448649['body'][_0x257987(0x239)]],_0x510905=[_0x448649[_0x257987(0x1cd)][_0x257987(0x223)]],_0x5374d0=[_0x448649['body'][_0x257987(0x2c8)]],_0x2dc9f4=[_0x448649['body']['production_date']],_0x1e6870=[_0x448649[_0x257987(0x1cd)][_0x257987(0x229)]],_0x22a413=[_0x448649['body'][_0x257987(0x1e2)]];else var _0x30be87=[..._0x448649['body'][_0x257987(0x1d8)]],_0x2370de=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x2a9)]],_0x22e793=[..._0x448649['body']['to_quantity']],_0x130d5a=[..._0x448649['body'][_0x257987(0x258)]],_0x295b65=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x22e)]],_0x494409=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x23e)]],_0x57fe02=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x2cc)]],_0xc8921e=[..._0x448649[_0x257987(0x1cd)]['secondary_code']],_0x510905=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x223)]],_0x5374d0=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x2c8)]],_0x2dc9f4=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x2e2)]],_0x1e6870=[..._0x448649[_0x257987(0x1cd)][_0x257987(0x229)]],_0x22a413=[..._0x448649['body'][_0x257987(0x1e2)]];const _0x33062f=_0x30be87[_0x257987(0x284)](_0x3c3b8d=>{return _0x3c3b8d={'product_name':_0x3c3b8d};});_0x2370de['forEach']((_0x3a65fa,_0x44f404)=>{_0x33062f[_0x44f404]['product_code']=_0x3a65fa;}),_0x22e793[_0x257987(0x1c0)]((_0x16e716,_0x5f4f9b)=>{var _0x33acf7=_0x257987;_0x33062f[_0x5f4f9b][_0x33acf7(0x208)]=Math[_0x33acf7(0x22d)](_0x16e716);}),_0x130d5a[_0x257987(0x1c0)]((_0x4a1fbf,_0x20cc56)=>{var _0x2ab94d=_0x257987;_0x33062f[_0x20cc56][_0x2ab94d(0x263)]=_0x4a1fbf;}),_0x295b65[_0x257987(0x1c0)]((_0x253161,_0x2a4465)=>{var _0x3fbb88=_0x257987;_0x33062f[_0x2a4465][_0x3fbb88(0x228)]=_0x253161;}),_0x494409['forEach']((_0x4bd48b,_0x77bf4f)=>{var _0x5cec94=_0x257987,_0x55484a=_0x4bd48b['match'](/[A-Za-z]+/)[0x0],_0x3a88aa=parseInt(_0x4bd48b['match'](/\d+/)[0x0]);_0x33062f[_0x77bf4f]['level']=_0x55484a,_0x33062f[_0x77bf4f][_0x5cec94(0x2af)]=_0x3a88aa;}),_0x57fe02['forEach']((_0x4e0a33,_0x121dd1)=>{var _0xfd4308=_0x257987;_0x33062f[_0x121dd1][_0xfd4308(0x2cc)]=_0x4e0a33;}),_0xc8921e[_0x257987(0x1c0)]((_0x2950d6,_0xa813dc)=>{var _0xeca9d5=_0x257987;_0x33062f[_0xa813dc][_0xeca9d5(0x239)]=_0x2950d6;}),_0x510905['forEach']((_0x271bcc,_0x274cad)=>{var _0x304d96=_0x257987;_0x33062f[_0x274cad][_0x304d96(0x223)]=_0x271bcc;}),_0x5374d0[_0x257987(0x1c0)]((_0x155281,_0x1793d1)=>{var _0x4bf7f5=_0x257987;_0x33062f[_0x1793d1][_0x4bf7f5(0x2c8)]=_0x155281;}),_0x2dc9f4[_0x257987(0x1c0)]((_0x53d545,_0x3f8203)=>{var _0x586f7d=_0x257987;_0x33062f[_0x3f8203][_0x586f7d(0x2e2)]=_0x53d545;}),_0x1e6870[_0x257987(0x1c0)]((_0x293f38,_0x5d833e)=>{var _0x5d3a0f=_0x257987;_0x33062f[_0x5d833e][_0x5d3a0f(0x272)]=_0x293f38;}),_0x22a413['forEach']((_0x4646b6,_0x20c96e)=>{var _0x473633=_0x257987;_0x33062f[_0x20c96e][_0x473633(0x2e7)]=_0x4646b6;});const _0x3b9fbf=await createLog(_0x257987(0x2a6));_0x22a413[_0x257987(0x1c0)]((_0x747d4a,_0x6d703b)=>{var _0x55b13e=_0x257987;_0x33062f[_0x6d703b][_0x55b13e(0x298)]=_0x55b13e(0x293)+_0x3b9fbf[_0x55b13e(0x28e)]()[_0x55b13e(0x24a)](0x8,'0');});const _0x6b7c87=_0x33062f['filter'](_0xf1cb0e=>_0xf1cb0e[_0x257987(0x208)]!=='0'&&_0xf1cb0e['quantity']!==''),_0x5ae5eb=new purchases_incoming({'invoice':_0x257987(0x293)+_0x3b9fbf['toString']()['padStart'](0x8,'0'),'date':_0x5aea55,'warehouse_name':_0x3ec884,'product':_0x6b7c87,'note':_0x1b2dac,'POnumber':_0x53f533,'SCRN':_0x4f45ba,'ReqBy':_0x565710,'dateofreq':_0x4f2ff2,'typeservicesData':_0x12fae6,'van':_0x165c2b,'typevehicle':_0x424c4c,'driver':_0x5e9836,'plate':_0x4f872b,'DRSI':_0x26d4ba,'TSU':_0x17d6be,'TFU':_0x3dc5b4,'typeOfProducts':_0x153c47}),_0x3c1c14=await _0x5ae5eb[_0x257987(0x1c5)](),_0x2c7c55=_0x3c1c14[_0x257987(0x269)]['map'](async _0x323cc7=>{var _0x4ace1f=_0x257987,_0x3def1b=await warehouse[_0x4ace1f(0x21c)]({'name':_0x3ec884,'room':_0x323cc7['room_name']});if(_0x323cc7[_0x4ace1f(0x208)]>0x0){var _0x111ca5=0x0;const _0x21546b=_0x3def1b['product_details'][_0x4ace1f(0x284)](_0x273251=>{var _0x162a89=_0x4ace1f;_0x273251[_0x162a89(0x1d8)]==_0x323cc7['product_name']&&_0x273251[_0x162a89(0x2af)]==_0x323cc7[_0x162a89(0x1e3)]&&_0x273251[_0x162a89(0x2c8)]==_0x323cc7[_0x162a89(0x2c8)]&&_0x273251[_0x162a89(0x2e2)]==_0x323cc7[_0x162a89(0x2e2)]&&_0x273251['batch_code']==_0x323cc7[_0x162a89(0x223)]&&_0x273251[_0x162a89(0x298)]==_0x323cc7[_0x162a89(0x298)]&&(typeof _0x323cc7['id_transaction']=='undefined'?(console[_0x162a89(0x2a4)]('here2',_0x273251[_0x162a89(0x1c8)]+_0x162a89(0x289)+_0x273251[_0x162a89(0x215)]+_0x162a89(0x1dd)+Math[_0x162a89(0x22d)](_0x273251['product_stock'])+Math[_0x162a89(0x22d)](_0x323cc7[_0x162a89(0x2d8)])),_0x273251[_0x162a89(0x1c8)]=Math['abs'](_0x273251['product_stock'])+Math[_0x162a89(0x22d)](_0x323cc7[_0x162a89(0x208)])):(_0x273251[_0x162a89(0x1c8)]=Math[_0x162a89(0x22d)](_0x273251[_0x162a89(0x1c8)])+Math['abs'](_0x323cc7[_0x162a89(0x208)]),_0x111ca5++));});_0x111ca5=='0'&&(_0x3def1b[_0x4ace1f(0x280)]=_0x3def1b['product_details'][_0x4ace1f(0x209)]({'product_name':_0x323cc7[_0x4ace1f(0x1d8)],'product_stock':_0x323cc7[_0x4ace1f(0x208)],'bay':_0x323cc7[_0x4ace1f(0x2af)],'level':_0x323cc7[_0x4ace1f(0x249)],'product_code':_0x323cc7[_0x4ace1f(0x24d)],'primary_code':_0x323cc7[_0x4ace1f(0x2cc)],'secondary_code':_0x323cc7[_0x4ace1f(0x239)],'expiry_date':_0x323cc7[_0x4ace1f(0x2c8)],'production_date':_0x323cc7[_0x4ace1f(0x2e2)],'maxProducts':_0x323cc7['maxProducts'],'batch_code':_0x323cc7['batch_code'],'secondary_unit':_0x323cc7[_0x4ace1f(0x228)],'unit':_0x323cc7[_0x4ace1f(0x263)],'maxProducts':_0x323cc7[_0x4ace1f(0x265)],'maxPerUnit':_0x323cc7[_0x4ace1f(0x1f3)],'invoice':_0x323cc7['invoice']}));}return _0x3def1b;});Promise[_0x257987(0x2c1)](_0x2c7c55)[_0x257987(0x2d1)](async _0x55fcdd=>{var _0x493e9f=_0x257987;try{for(const _0x1b19a3 of _0x55fcdd){await warehouse['updateOne']({'_id':_0x1b19a3[_0x493e9f(0x215)]},{'$addToSet':{'product_details':{'$each':_0x1b19a3['product_details']}}});}_0x1615ca[_0x493e9f(0x27d)]=_0x493e9f(0x296);const _0x2e4783=await _0x1615ca[_0x493e9f(0x1c5)](),_0x1d4df0=await master_shop[_0x493e9f(0x23d)](),_0x19fd5e=await email_settings[_0x493e9f(0x21c)](),_0x3d0746=await supervisor_settings[_0x493e9f(0x23d)]();var _0x4b72fd=_0x5ae5eb[_0x493e9f(0x269)],_0x3f96e8='',_0x4de664;for(_0x4de664 in _0x4b72fd){var _0x442889='FG';_0x5ae5eb[_0x493e9f(0x279)]=='DRY\x20GOODS'&&(_0x442889='DG'),_0x3f96e8+='<tr>'+_0x493e9f(0x205)+_0x4b72fd[_0x4de664]['product_name']+_0x493e9f(0x1df)+_0x493e9f(0x205)+_0x4b72fd[_0x4de664][_0x493e9f(0x24d)]+_0x493e9f(0x1df)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b72fd[_0x4de664][_0x493e9f(0x2d8)]+'</td>'+_0x493e9f(0x205)+_0x4b72fd[_0x4de664][_0x493e9f(0x258)]+_0x493e9f(0x1df)+_0x493e9f(0x205)+_0x4b72fd[_0x4de664][_0x493e9f(0x228)]+_0x493e9f(0x1df)+_0x493e9f(0x205)+_0x5ae5eb[_0x493e9f(0x279)]+'</td>'+_0x493e9f(0x205)+_0x4b72fd[_0x4de664][_0x493e9f(0x2b4)]+_0x493e9f(0x1df)+_0x493e9f(0x205)+_0x442889+_0x4b72fd[_0x4de664][_0x493e9f(0x1e3)]+_0x493e9f(0x1df)+'</tr>';}_0x448649[_0x493e9f(0x23b)](_0x493e9f(0x233),_0x493e9f(0x1ee)),_0x52f4df[_0x493e9f(0x2c9)]('/picking_list/pdf_puchases_fin_own_trf/'+_0x3c1c14[_0x493e9f(0x215)]);}catch(_0x43c76a){console['error'](_0x43c76a),_0x52f4df['status'](0x1f4)[_0x493e9f(0x1fc)]({'error':_0x493e9f(0x1cf)});}})[_0x257987(0x25e)](_0x5c7c89=>{var _0x39f6af=_0x257987;console['error'](_0x5c7c89),_0x52f4df[_0x39f6af(0x299)](0x1f4)[_0x39f6af(0x1fc)]({'error':_0x39f6af(0x2bc)});});}catch(_0x584aa0){}}),router[a0_0x192b41(0x273)]('/getTRF',auth,async(_0x3a2be7,_0x4fb72a)=>{var _0x2496e9=a0_0x192b41;try{const {warehouse:_0x48b7c1}=_0x3a2be7[_0x2496e9(0x1cd)],_0x33d432=await transfers_finished['find']({'to_warehouse':_0x48b7c1,'to_recieved':_0x2496e9(0x29a)});_0x4fb72a[_0x2496e9(0x1fc)](_0x33d432);}catch(_0x4bd600){}}),router[a0_0x192b41(0x273)](a0_0x192b41(0x1f6),auth,async(_0x175c7c,_0x4cf89c)=>{var _0x3cdc69=a0_0x192b41;try{const {invoice:_0x4abe7f}=_0x175c7c[_0x3cdc69(0x1cd)],_0x20fe97=await transfers_finished[_0x3cdc69(0x23d)]({'_id':_0x4abe7f,'to_recieved':'false'});_0x4cf89c['json'](_0x20fe97);}catch(_0x42339f){}}),router['get']('/view',auth,async(_0x1acbf4,_0x3ca759)=>{var _0x216aa8=a0_0x192b41;try{const {username:_0x1e26ce,email:_0x528f42,role:_0x224556}=_0x1acbf4['user'],_0x3a4526=_0x1acbf4[_0x216aa8(0x2e8)],_0x3778c1=await profile[_0x216aa8(0x21c)]({'email':_0x3a4526['email']}),_0xb8358c=await staff[_0x216aa8(0x21c)]({'email':_0x3a4526[_0x216aa8(0x281)]});if(_0x3a4526[_0x216aa8(0x1e8)]==_0x216aa8(0x1f0)){const _0x51d252=await staff[_0x216aa8(0x21c)]({'email':_0x3a4526['email']});}const _0x5cdfb7=await master_shop[_0x216aa8(0x23d)]();let _0x4dc2ee;if(_0x3a4526[_0x216aa8(0x1e8)]==_0x216aa8(0x1f0)){const _0x33c659=await staff[_0x216aa8(0x21c)]({'email':_0x3a4526[_0x216aa8(0x281)]});_0x4dc2ee=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x33c659['warehouse'],'typeOfProducts':_0x216aa8(0x2ea)}},{'$lookup':{'from':_0x216aa8(0x28a),'localField':_0x216aa8(0x28a),'foreignField':_0x216aa8(0x241),'as':_0x216aa8(0x24f)}},{'$unwind':_0x216aa8(0x2f1)},{'$unwind':_0x216aa8(0x2e5)},{'$group':{'_id':_0x216aa8(0x203),'invoice':{'$first':_0x216aa8(0x295)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x216aa8(0x2f9)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x216aa8(0x282)},'product':{'$push':_0x216aa8(0x2e5)},'note':{'$first':_0x216aa8(0x2a7)},'paid_amount':{'$first':_0x216aa8(0x251)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x216aa8(0x2bb)},'expiry_date':{'$first':_0x216aa8(0x255)},'suppliers_docs':{'$first':_0x216aa8(0x2f1)},'total_product_quantity':{'$sum':_0x216aa8(0x2db)},'level':{'$addToSet':_0x216aa8(0x2ad)},'isle':{'$addToSet':_0x216aa8(0x235)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x216aa8(0x25b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4dc2ee=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x216aa8(0x2ea)}},{'$unwind':_0x216aa8(0x2e5)},{'$group':{'_id':_0x216aa8(0x203),'invoice':{'$first':_0x216aa8(0x295)},'suppliers':{'$first':_0x216aa8(0x217)},'date':{'$first':_0x216aa8(0x2f9)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x216aa8(0x2b6)},'product':{'$push':_0x216aa8(0x2e5)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x216aa8(0x251)},'due_amount':{'$first':_0x216aa8(0x286)},'return_data':{'$first':_0x216aa8(0x26c)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x216aa8(0x255)},'suppliers_docs':{'$first':_0x216aa8(0x2f1)},'total_product_quantity':{'$sum':_0x216aa8(0x2db)},'level':{'$addToSet':_0x216aa8(0x2ad)},'isle':{'$addToSet':_0x216aa8(0x235)},'type':{'$addToSet':_0x216aa8(0x2dd)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x1d4))var _0x5a7273=users[_0x216aa8(0x29b)];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x2d6))var _0x5a7273=users[_0x216aa8(0x2d6)];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x28f))var _0x5a7273=users[_0x216aa8(0x28f)];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x2b5))var _0x5a7273=users[_0x216aa8(0x2b5)];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]=='French')var _0x5a7273=users[_0x216aa8(0x2cd)];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x259))var _0x5a7273=users['Portuguese'];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x257))var _0x5a7273=users['Chinese'];else{if(_0x5cdfb7[0x0][_0x216aa8(0x245)]==_0x216aa8(0x1c1))var _0x5a7273=users[_0x216aa8(0x243)];}}}}}}}_0x3ca759[_0x216aa8(0x1e7)](_0x216aa8(0x236),{'success':_0x1acbf4[_0x216aa8(0x23b)]('success'),'errors':_0x1acbf4['flash'](_0x216aa8(0x2f5)),'purchases':_0x4dc2ee,'role':_0x3a4526,'profile':_0x3778c1,'master_shop':_0x5cdfb7,'language':_0x5a7273});}catch(_0x4ab464){console[_0x216aa8(0x2a4)]('table\x20page',_0x4ab464),_0x3ca759[_0x216aa8(0x299)](0xc8)[_0x216aa8(0x1fc)]({'message':_0x4ab464['message']});}}),router[a0_0x192b41(0x1e4)]('/view_log',auth,async(_0x46700b,_0x54b1b7)=>{var _0xc95bcd=a0_0x192b41;try{const {username:_0x53d890,email:_0x4fb673,role:_0x35c9cd}=_0x46700b[_0xc95bcd(0x2e8)],_0x5872f9=_0x46700b[_0xc95bcd(0x2e8)],_0x489db2=await profile[_0xc95bcd(0x21c)]({'email':_0x5872f9['email']}),_0x5838aa=await staff[_0xc95bcd(0x21c)]({'email':_0x5872f9[_0xc95bcd(0x281)]});if(_0x5872f9[_0xc95bcd(0x1e8)]=='staff'){const _0x1a5cb3=await staff[_0xc95bcd(0x21c)]({'email':_0x5872f9[_0xc95bcd(0x281)]});}const _0x327f4c=await master_shop['find']();let _0x2213f1;if(_0x5872f9[_0xc95bcd(0x1e8)]==_0xc95bcd(0x1f0)){const _0x2c4384=await staff[_0xc95bcd(0x21c)]({'email':_0x5872f9[_0xc95bcd(0x281)]});_0x2213f1=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2c4384[_0xc95bcd(0x2a5)]}},{'$lookup':{'from':_0xc95bcd(0x28a),'localField':_0xc95bcd(0x28a),'foreignField':_0xc95bcd(0x241),'as':_0xc95bcd(0x24f)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0xc95bcd(0x2e5)},{'$group':{'_id':'$_id','invoice':{'$first':_0xc95bcd(0x295)},'suppliers':{'$first':_0xc95bcd(0x217)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xc95bcd(0x2ba)},'room':{'$first':_0xc95bcd(0x282)},'product':{'$push':_0xc95bcd(0x2e5)},'note':{'$first':_0xc95bcd(0x2a7)},'paid_amount':{'$first':_0xc95bcd(0x251)},'due_amount':{'$first':_0xc95bcd(0x286)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0xc95bcd(0x2bb)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0xc95bcd(0x2f1)},'total_product_quantity':{'$sum':_0xc95bcd(0x2db)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0xc95bcd(0x2dd)},'floorlevel':{'$addToSet':_0xc95bcd(0x25b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2213f1=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0xc95bcd(0x2f8)}},{'$unwind':_0xc95bcd(0x2e5)},{'$group':{'_id':_0xc95bcd(0x203),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xc95bcd(0x217)},'date':{'$first':_0xc95bcd(0x2f9)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0xc95bcd(0x2b6)},'product':{'$push':_0xc95bcd(0x2e5)},'note':{'$first':'$note'},'paid_amount':{'$first':_0xc95bcd(0x251)},'due_amount':{'$first':_0xc95bcd(0x286)},'return_data':{'$first':_0xc95bcd(0x26c)},'batch_code':{'$first':_0xc95bcd(0x2bb)},'expiry_date':{'$first':_0xc95bcd(0x255)},'suppliers_docs':{'$first':_0xc95bcd(0x2f1)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0xc95bcd(0x2ad)},'isle':{'$addToSet':_0xc95bcd(0x235)},'type':{'$addToSet':_0xc95bcd(0x2dd)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x327f4c[0x0]['language']==_0xc95bcd(0x1d4))var _0x502c96=users[_0xc95bcd(0x29b)];else{if(_0x327f4c[0x0][_0xc95bcd(0x245)]==_0xc95bcd(0x2d6))var _0x502c96=users[_0xc95bcd(0x2d6)];else{if(_0x327f4c[0x0]['language']=='German')var _0x502c96=users[_0xc95bcd(0x28f)];else{if(_0x327f4c[0x0]['language']==_0xc95bcd(0x2b5))var _0x502c96=users['Spanish'];else{if(_0x327f4c[0x0][_0xc95bcd(0x245)]=='French')var _0x502c96=users['French'];else{if(_0x327f4c[0x0][_0xc95bcd(0x245)]=='Portuguese\x20(BR)')var _0x502c96=users['Portuguese'];else{if(_0x327f4c[0x0][_0xc95bcd(0x245)]=='Chinese')var _0x502c96=users[_0xc95bcd(0x257)];else{if(_0x327f4c[0x0][_0xc95bcd(0x245)]==_0xc95bcd(0x1c1))var _0x502c96=users[_0xc95bcd(0x243)];}}}}}}}_0x54b1b7[_0xc95bcd(0x1e7)](_0xc95bcd(0x2f4),{'success':_0x46700b[_0xc95bcd(0x23b)](_0xc95bcd(0x233)),'errors':_0x46700b[_0xc95bcd(0x23b)](_0xc95bcd(0x2f5)),'purchases':_0x2213f1,'role':_0x5872f9,'profile':_0x489db2,'master_shop':_0x327f4c,'language':_0x502c96});}catch(_0x3307d7){console[_0xc95bcd(0x2a4)](_0xc95bcd(0x2d9),_0x3307d7),_0x54b1b7['status'](0xc8)[_0xc95bcd(0x1fc)]({'message':_0x3307d7[_0xc95bcd(0x25f)]});}});function BayBinSelected(_0x4d6df8,_0xc170d){var _0x40b8bd=a0_0x192b41,_0x49f726=[],_0x1dfece=[];if(_0x4d6df8==_0x40b8bd(0x23a)){switch(_0xc170d){case'Rack\x201':_0x49f726=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x49f726=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1dfece=['DG'];}else{if(_0x4d6df8=='FROZEN\x20GOODS'){switch(_0xc170d){case _0x40b8bd(0x2b7):_0x49f726=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x40b8bd(0x1e6):_0x49f726=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1dfece=['FG'];}}return{'levels':_0x49f726,'identify':_0x1dfece};}async function getRandom8DigitNumber(){var _0x4c355c=a0_0x192b41;const _0x449c5b=0x989680,_0x5ca9ce=0x5f5e0ff,_0x4fd3d6=Math[_0x4c355c(0x2c2)](Math[_0x4c355c(0x1f7)]()*(_0x5ca9ce-_0x449c5b+0x1))+_0x449c5b;var _0x39ec0f;const _0x54f834=await purchases_finished['findOne']({'invoice':'INCF-'+_0x4fd3d6});return _0x54f834&&_0x54f834[_0x4c355c(0x276)]>0x0?_0x39ec0f=_0x4c355c(0x2fa)+_0x4fd3d6:_0x39ec0f='INCF-'+_0x4fd3d6,_0x39ec0f;}router[a0_0x192b41(0x1e4)](a0_0x192b41(0x1cb),auth,async(_0x37f011,_0x3129e9)=>{var _0x3314f8=a0_0x192b41;try{const {username:_0x22ac95,email:_0x31ea6f,role:_0x3e6686}=_0x37f011['user'],_0x658587=_0x37f011[_0x3314f8(0x2e8)],_0x228332=await profile[_0x3314f8(0x21c)]({'email':_0x658587[_0x3314f8(0x281)]}),_0x8bc942=await master_shop[_0x3314f8(0x23d)](),_0x552d9f=await staff[_0x3314f8(0x21c)]({'email':_0x658587[_0x3314f8(0x281)]}),_0x4835d1=await suppliers[_0x3314f8(0x23d)]({});let _0x464d7a;if(_0x658587[_0x3314f8(0x1e8)]==_0x3314f8(0x1f0)){const _0x198a4b=await staff['findOne']({'email':_0x658587[_0x3314f8(0x281)]});_0x464d7a=await warehouse[_0x3314f8(0x1d0)]([{'$match':{'status':_0x3314f8(0x20f),'name':_0x198a4b['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x3314f8(0x21b)}}}]);}else _0x464d7a=await warehouse[_0x3314f8(0x1d0)]([{'$match':{'status':_0x3314f8(0x20f)}},{'$group':{'_id':_0x3314f8(0x21b),'name':{'$first':'$name'}}}]);const _0x2d8b72=await product[_0x3314f8(0x23d)]({}),_0x41d8e2=await warehouse[_0x3314f8(0x23d)]({'status':'Enabled'}),_0x59b3c3=await purchases_finished['find']({}),_0x943abe=_0x59b3c3['length']+0x1,_0x239cff=_0x3314f8(0x2fa)+_0x943abe['toString']()[_0x3314f8(0x24a)](0x5,'0');var _0x463d80=[_0x3314f8(0x23c),_0x3314f8(0x1e1)];if(_0x8bc942[0x0][_0x3314f8(0x245)]==_0x3314f8(0x1d4))var _0x183016=users[_0x3314f8(0x29b)];else{if(_0x8bc942[0x0][_0x3314f8(0x245)]=='Hindi')var _0x183016=users['Hindi'];else{if(_0x8bc942[0x0][_0x3314f8(0x245)]==_0x3314f8(0x28f))var _0x183016=users[_0x3314f8(0x28f)];else{if(_0x8bc942[0x0]['language']==_0x3314f8(0x2b5))var _0x183016=users[_0x3314f8(0x2b5)];else{if(_0x8bc942[0x0]['language']=='French')var _0x183016=users[_0x3314f8(0x2cd)];else{if(_0x8bc942[0x0]['language']==_0x3314f8(0x259))var _0x183016=users['Portuguese'];else{if(_0x8bc942[0x0][_0x3314f8(0x245)]==_0x3314f8(0x257))var _0x183016=users[_0x3314f8(0x257)];else{if(_0x8bc942[0x0][_0x3314f8(0x245)]==_0x3314f8(0x1c1))var _0x183016=users[_0x3314f8(0x243)];}}}}}}}const _0x484780=getRandom8DigitNumber(),_0x3eddea=new Date(),_0x7bfb5e={'year':'numeric','month':'2-digit','day':_0x3314f8(0x25a),'timeZone':_0x3314f8(0x2c0)},_0x1b79f2=_0x3eddea[_0x3314f8(0x21d)](_0x3314f8(0x227),_0x7bfb5e);console['log'](_0x1b79f2),_0x484780['then'](_0x517373=>{var _0x70f6fc=_0x3314f8;_0x3129e9[_0x70f6fc(0x1e7)](_0x70f6fc(0x2e9),{'success':_0x37f011[_0x70f6fc(0x23b)](_0x70f6fc(0x233)),'errors':_0x37f011['flash'](_0x70f6fc(0x2f5)),'role':_0x658587,'profile':_0x228332,'suppliers':_0x4835d1,'warehouse':_0x464d7a,'product':_0x2d8b72,'invoice':_0x517373,'master_shop':_0x8bc942,'language':_0x183016,'find_data':_0x41d8e2,'rooms_data':_0x463d80,'formattedDate':_0x1b79f2});})[_0x3314f8(0x25e)](_0x2113da=>{var _0x3f338c=_0x3314f8;_0x37f011[_0x3f338c(0x23b)](_0x3f338c(0x2f5),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3129e9['redirect'](_0x3f338c(0x1ea));});}catch(_0xdf1848){console[_0x3314f8(0x2a4)](_0xdf1848);}}),router[a0_0x192b41(0x1e4)](a0_0x192b41(0x22c),auth,async(_0x22b4f2,_0x2aa973)=>{var _0x1a57e9=a0_0x192b41;try{const {username:_0x59ad7e,email:_0x581920,role:_0x25d872}=_0x22b4f2[_0x1a57e9(0x2e8)],_0x2131f1=_0x22b4f2[_0x1a57e9(0x2e8)],_0x36a5cb=await profile['findOne']({'email':_0x2131f1[_0x1a57e9(0x281)]}),_0x4c5f73=await master_shop[_0x1a57e9(0x23d)](),_0x1b26aa=await staff[_0x1a57e9(0x21c)]({'email':_0x2131f1[_0x1a57e9(0x281)]}),_0x1c2a96=await suppliers[_0x1a57e9(0x23d)]({});let _0x1a4390;if(_0x2131f1[_0x1a57e9(0x1e8)]==_0x1a57e9(0x1f0)){const _0x7953a9=await staff[_0x1a57e9(0x21c)]({'email':_0x2131f1[_0x1a57e9(0x281)]});_0x1a4390=await warehouse[_0x1a57e9(0x1d0)]([{'$match':{'status':_0x1a57e9(0x20f),'name':_0x7953a9[_0x1a57e9(0x2a5)]}},{'$group':{'_id':_0x1a57e9(0x21b),'name':{'$first':_0x1a57e9(0x21b)}}}]);}else _0x1a4390=await warehouse[_0x1a57e9(0x1d0)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x1a57e9(0x21b),'name':{'$first':_0x1a57e9(0x21b)}}}]);const _0x3f420a=await product['find']({}),_0x196b9f=await warehouse['find']({'status':_0x1a57e9(0x20f)}),_0x362d87=await purchases_finished['find']({}),_0x50c919=_0x362d87[_0x1a57e9(0x276)]+0x1,_0x371ccc=_0x1a57e9(0x2fa)+_0x50c919[_0x1a57e9(0x28e)]()[_0x1a57e9(0x24a)](0x5,'0');var _0x8c82a9=[_0x1a57e9(0x23c),_0x1a57e9(0x1e1)];if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x1d4))var _0x279e3e=users['English'];else{if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x2d6))var _0x279e3e=users[_0x1a57e9(0x2d6)];else{if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x28f))var _0x279e3e=users[_0x1a57e9(0x28f)];else{if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x2b5))var _0x279e3e=users[_0x1a57e9(0x2b5)];else{if(_0x4c5f73[0x0]['language']=='French')var _0x279e3e=users[_0x1a57e9(0x2cd)];else{if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x259))var _0x279e3e=users[_0x1a57e9(0x275)];else{if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x257))var _0x279e3e=users['Chinese'];else{if(_0x4c5f73[0x0][_0x1a57e9(0x245)]==_0x1a57e9(0x1c1))var _0x279e3e=users[_0x1a57e9(0x243)];}}}}}}}const _0x1085c4=getRandom8DigitNumber();_0x1085c4[_0x1a57e9(0x2d1)](_0x28516d=>{var _0x461153=_0x1a57e9;_0x2aa973[_0x461153(0x1e7)](_0x461153(0x221),{'success':_0x22b4f2[_0x461153(0x23b)](_0x461153(0x233)),'errors':_0x22b4f2[_0x461153(0x23b)](_0x461153(0x2f5)),'role':_0x2131f1,'profile':_0x36a5cb,'suppliers':_0x1c2a96,'warehouse':_0x1a4390,'product':_0x3f420a,'invoice':_0x28516d,'master_shop':_0x4c5f73,'language':_0x279e3e,'find_data':_0x196b9f,'rooms_data':_0x8c82a9});})['catch'](_0x1dfae0=>{var _0x1e29a1=_0x1a57e9;_0x22b4f2['flash'](_0x1e29a1(0x2f5),_0x1e29a1(0x264)),_0x2aa973[_0x1e29a1(0x2c9)](_0x1e29a1(0x1ea));});}catch(_0x2fc8ec){console[_0x1a57e9(0x2a4)](_0x2fc8ec);}}),router[a0_0x192b41(0x1e4)](a0_0x192b41(0x28d),auth,async(_0x1296ba,_0xcc4ba1)=>{var _0x183b51=a0_0x192b41;try{const _0x268bf5=_0x1296ba[_0x183b51(0x226)]['id'];console[_0x183b51(0x2a4)](_0x268bf5);const _0x5b85e9=await master_shop[_0x183b51(0x23d)]();console[_0x183b51(0x2a4)]('master',_0x5b85e9);const _0x53198f=await product[_0x183b51(0x21c)]({'name':_0x268bf5});console[_0x183b51(0x2a4)](_0x183b51(0x269),_0x53198f),_0xcc4ba1[_0x183b51(0x299)](0xc8)['json']({'product_data':_0x53198f,'master':_0x5b85e9});}catch(_0x557e6d){console[_0x183b51(0x2a4)]('add_purchases\x20error',_0x557e6d);}}),router[a0_0x192b41(0x273)](a0_0x192b41(0x1cb),auth,async(_0x5d4415,_0x1c7d2f)=>{var _0x54a80f=a0_0x192b41;try{const {invoice:_0x312e79,date:_0x5b9602,warehouse_name:_0xa644d9,prod_name:_0x1bb9c0,note:_0x54d421,due_amount:_0x2100f5,Room_name:_0x2fa68c,PO_number:_0xe8e4e8,SCRN:_0x32cc7c,ReqBy:_0x562407,dateofreq:_0x54461a,suppliers:_0x2c9239,typeservicesData:_0x2a9715,van:_0x155abe,typevehicle:_0x215c57,driver:_0x3c4737,plate:_0x5a9da0,DRSI:_0x32dfef,TSU:_0x381f6d,TFU:_0x5bf72f,JO_number:_0x42dd0e,type_of_products:_0x873756}=_0x5d4415[_0x54a80f(0x1cd)];if(typeof _0x1bb9c0==_0x54a80f(0x2ed))var _0x6a1c5=[_0x5d4415[_0x54a80f(0x1cd)]['prod_name']],_0x5958b6=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2ae)]],_0x48fa77=[_0x5d4415[_0x54a80f(0x1cd)]['prod_Qty']],_0x11ee47=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x25c)]],_0x39d398=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x22e)]],_0x1fb52d=[_0x5d4415['body'][_0x54a80f(0x2df)]],_0x153d03=[_0x5d4415['body']['primary_code']],_0x28c146=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x239)]],_0x2df884=[_0x5d4415['body']['MaxStocks_data']],_0x55aaf4=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x223)]],_0x3ae99f=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2c8)]],_0x2dc3c6=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2c6)]],_0x5ebbf2=[_0x5d4415['body'][_0x54a80f(0x229)]],_0x3108b1=[_0x5d4415['body'][_0x54a80f(0x234)]],_0x4efd77=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2d4)]],_0x49edc2=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x261)]],_0x29b009=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x22b)]],_0x1154ea=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2f7)]],_0x39f66a=[_0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2be)]];else var _0x6a1c5=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x22f)]],_0x5958b6=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2ae)]],_0x48fa77=[..._0x5d4415['body'][_0x54a80f(0x24b)]],_0x11ee47=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x25c)]],_0x39d398=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x22e)]],_0x1fb52d=[..._0x5d4415['body'][_0x54a80f(0x2df)]],_0x153d03=[..._0x5d4415[_0x54a80f(0x1cd)]['primary_code']],_0x28c146=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x239)]],_0x2df884=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x1ce)]],_0x55aaf4=[..._0x5d4415['body'][_0x54a80f(0x223)]],_0x3ae99f=[..._0x5d4415['body'][_0x54a80f(0x2c8)]],_0x2dc3c6=[..._0x5d4415['body'][_0x54a80f(0x2c6)]],_0x5ebbf2=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x229)]],_0x3108b1=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x234)]],_0x4efd77=[..._0x5d4415[_0x54a80f(0x1cd)]['RoomAssign']],_0x49edc2=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x261)]],_0x29b009=[..._0x5d4415[_0x54a80f(0x1cd)]['uuid']],_0x1154ea=[..._0x5d4415[_0x54a80f(0x1cd)][_0x54a80f(0x2f7)]],_0x39f66a=[..._0x5d4415['body']['product_id']];const _0x420775=_0x6a1c5[_0x54a80f(0x284)](_0x5be7cc=>{return _0x5be7cc={'product_name':_0x5be7cc};});_0x39f66a[_0x54a80f(0x1c0)]((_0xaa3701,_0x3e0806)=>{var _0x104106=_0x54a80f;_0x420775[_0x3e0806][_0x104106(0x2be)]=_0xaa3701,_0x420775[_0x3e0806]['date_recieved']=_0x5b9602;}),_0x1154ea['forEach']((_0x5c9b93,_0x576802)=>{_0x420775[_0x576802]['sales_category']=_0x5c9b93;}),_0x5958b6['forEach']((_0x1e413a,_0x134727)=>{var _0x559cc0=_0x54a80f;_0x420775[_0x134727][_0x559cc0(0x24d)]=_0x1e413a;}),_0x29b009[_0x54a80f(0x1c0)]((_0x37876b,_0x28a670)=>{var _0x289c7f=_0x54a80f;_0x420775[_0x28a670][_0x289c7f(0x22b)]=_0x37876b;}),_0x48fa77[_0x54a80f(0x1c0)]((_0x38a27d,_0x293a77)=>{var _0x254948=_0x54a80f;_0x420775[_0x293a77][_0x254948(0x208)]=Math['abs'](_0x38a27d);}),_0x11ee47[_0x54a80f(0x1c0)]((_0x6373e2,_0x1e3331)=>{_0x420775[_0x1e3331]['standard_unit']=_0x6373e2;}),_0x39d398[_0x54a80f(0x1c0)]((_0xfaf304,_0x329d9e)=>{var _0x1f44e1=_0x54a80f;_0x420775[_0x329d9e][_0x1f44e1(0x228)]=_0xfaf304;}),_0x153d03[_0x54a80f(0x1c0)]((_0x3a4eb5,_0x592fab)=>{var _0xcfa9d9=_0x54a80f;_0x420775[_0x592fab][_0xcfa9d9(0x2cc)]=_0x3a4eb5;}),_0x28c146[_0x54a80f(0x1c0)]((_0x54e728,_0x41c62a)=>{_0x420775[_0x41c62a]['secondary_code']=_0x54e728;}),_0x2df884[_0x54a80f(0x1c0)]((_0x209ddf,_0x4a8845)=>{var _0x26a219=_0x54a80f;_0x420775[_0x4a8845][_0x26a219(0x2f6)]=_0x209ddf;}),_0x55aaf4[_0x54a80f(0x1c0)]((_0x47a8ca,_0x18ba86)=>{var _0x3ac79a=_0x54a80f;_0x420775[_0x18ba86][_0x3ac79a(0x223)]=_0x47a8ca;}),_0x3ae99f['forEach']((_0x136c4e,_0x4d93a9)=>{var _0x55ab3a=_0x54a80f;_0x420775[_0x4d93a9][_0x55ab3a(0x2c8)]=_0x136c4e;}),_0x2dc3c6[_0x54a80f(0x1c0)]((_0xcf007,_0x60a5ff)=>{var _0x367f4c=_0x54a80f;_0x420775[_0x60a5ff][_0x367f4c(0x2e2)]=_0xcf007;}),_0x5ebbf2['forEach']((_0x10c3ca,_0x528094)=>{var _0x4140df=_0x54a80f;_0x420775[_0x528094][_0x4140df(0x272)]=_0x10c3ca;}),_0x3108b1[_0x54a80f(0x1c0)]((_0x5b9788,_0xb85f96)=>{_0x420775[_0xb85f96]['product_cat']=_0x5b9788;}),_0x4efd77['forEach']((_0x6dddc7,_0x598ba4)=>{_0x420775[_0x598ba4]['room_name']=_0x6dddc7;}),_0x49edc2['forEach']((_0x194e7c,_0x2b79c1)=>{_0x420775[_0x2b79c1]['gross_price']=_0x194e7c;});const _0x6b0a4c=new invoice_for_incoming();await _0x6b0a4c[_0x54a80f(0x1c5)]();for(let _0x1b007e=0x0;_0x1b007e<=_0x4efd77[_0x54a80f(0x276)]-0x1;_0x1b007e++){_0x420775[_0x1b007e][_0x54a80f(0x298)]=_0x54a80f(0x293)+_0x6b0a4c[_0x54a80f(0x22a)][_0x54a80f(0x28e)]()[_0x54a80f(0x24a)](0x8,'0');}const _0x369e6c=await warehouse_validation_setup[_0x54a80f(0x1d0)]([{'$match':{'warehouse_name':_0xa644d9}}]);let _0x3f5518=[];for(let _0x3ce88a=0x0;_0x3ce88a<=_0x420775['length']-0x1;_0x3ce88a++){const _0x2a950f=_0x420775[_0x3ce88a];for(let _0x356b60=0x0;_0x356b60<=_0x369e6c[_0x54a80f(0x276)]-0x1;_0x356b60++){const _0x4c182f=_0x369e6c[_0x356b60];for(let _0x42996d=0x0;_0x42996d<=_0x4c182f[_0x54a80f(0x2c7)][_0x54a80f(0x276)]-0x1;_0x42996d++){const _0xd2952c=_0x4c182f['product_data'][_0x42996d];if(_0xd2952c[_0x54a80f(0x24d)]===_0x2a950f[_0x54a80f(0x24d)]){let _0xcfa470=_0x2a950f[_0x54a80f(0x208)];const _0x3505ff=await warehouse['aggregate']([{'$match':{'name':_0xa644d9,'room':_0x4c182f[_0x54a80f(0x1e2)]}},{'$unwind':_0x54a80f(0x211)},{'$match':{'level':_0xd2952c['bay'],'bay':_0xd2952c[_0x54a80f(0x23e)]}}]);if(_0x3505ff[_0x54a80f(0x276)]==0x0){for(let _0x169c90=0x0;_0x169c90<=_0x4c182f[_0x54a80f(0x2c7)][_0x54a80f(0x276)]-0x1&&_0xcfa470>0x0;_0x169c90++){const _0x102090=_0x4c182f['product_data'][_0x169c90];if(_0x2a950f['product_code']===_0x102090[_0x54a80f(0x24d)]){_0x3f5518[_0x169c90]={};const _0x5c8d4d=parseInt(_0x102090[_0x54a80f(0x1de)]),_0x1c41a2=0x0;let _0x1824a9=_0x5c8d4d-_0x1c41a2,_0x1a244d=Math[_0x54a80f(0x2e0)](_0xcfa470,_0x1824a9);console[_0x54a80f(0x2a4)](_0x54a80f(0x220)+_0x1a244d+_0x54a80f(0x262)+_0x4c182f[_0x54a80f(0x1e9)]+',\x20room:\x20'+_0x4c182f[_0x54a80f(0x1e2)]+_0x54a80f(0x288)+_0x102090['bay']+_0x54a80f(0x2e4)+_0x102090[_0x54a80f(0x23e)]),_0x3f5518[_0x169c90][_0x54a80f(0x1d8)]=_0x2a950f[_0x54a80f(0x1d8)],_0x3f5518[_0x169c90]['product_code']=_0x2a950f['product_code'],_0x3f5518[_0x169c90][_0x54a80f(0x2be)]=_0x2a950f['product_id'],_0x3f5518[_0x169c90][_0x54a80f(0x1ed)]=_0x2a950f[_0x54a80f(0x1ed)],_0x3f5518[_0x169c90][_0x54a80f(0x212)]=_0x2a950f[_0x54a80f(0x212)],_0x3f5518[_0x169c90][_0x54a80f(0x22b)]=_0x2a950f['uuid'],_0x3f5518[_0x169c90][_0x54a80f(0x208)]=_0x1a244d,_0x3f5518[_0x169c90][_0x54a80f(0x263)]=_0x2a950f[_0x54a80f(0x263)],_0x3f5518[_0x169c90][_0x54a80f(0x228)]=_0x2a950f[_0x54a80f(0x228)],_0x3f5518[_0x169c90][_0x54a80f(0x2cc)]=_0x2a950f['primary_code'],_0x3f5518[_0x169c90][_0x54a80f(0x239)]=_0x2a950f[_0x54a80f(0x239)],_0x3f5518[_0x169c90][_0x54a80f(0x2f6)]=_0x2a950f[_0x54a80f(0x2f6)],_0x3f5518[_0x169c90][_0x54a80f(0x223)]=_0x2a950f[_0x54a80f(0x223)],_0x3f5518[_0x169c90][_0x54a80f(0x2c8)]=_0x2a950f[_0x54a80f(0x2c8)],_0x3f5518[_0x169c90]['production_date']=_0x2a950f[_0x54a80f(0x2e2)],_0x3f5518[_0x169c90]['maxperunit']=_0x2a950f['maxperunit'],_0x3f5518[_0x169c90]['product_cat']=_0x2a950f[_0x54a80f(0x2dc)],_0x3f5518[_0x169c90]['invoice']=_0x2a950f[_0x54a80f(0x298)],_0x3f5518[_0x169c90][_0x54a80f(0x261)]=_0x2a950f[_0x54a80f(0x261)],_0x3f5518[_0x169c90]['room_name']=_0x4c182f[_0x54a80f(0x1e2)],_0x3f5518[_0x169c90]['level']=_0x102090[_0x54a80f(0x2af)],_0x3f5518[_0x169c90][_0x54a80f(0x2af)]=_0x102090['bin'],_0xcfa470-=_0x1a244d;if(_0xcfa470<=0x0)break;}}if(_0xcfa470<=0x0)break;_0xcfa470>0x0&&console[_0x54a80f(0x2a4)](_0x54a80f(0x29c)+_0xcfa470+_0x54a80f(0x2ef));}}}}}const _0x539a9e=_0x3f5518[_0x54a80f(0x1f1)]((_0x1a8484,_0x3397c1)=>{if(_0x3397c1>0x0)return{'item':_0x1a8484};}),_0x96ff58=_0x539a9e['filter'](_0x51573f=>_0x51573f['quantity']!=='0'&&_0x51573f['quantity']!==''),_0x7805ad=new purchases_finished({'invoice':'INC-'+_0x6b0a4c[_0x54a80f(0x22a)][_0x54a80f(0x28e)]()[_0x54a80f(0x24a)](0x8,'0'),'suppliers':_0x2c9239,'date':_0x5b9602,'warehouse_name':_0xa644d9,'product':_0x96ff58,'note':_0x54d421,'due_amount':_0x2100f5,'room':_0x2fa68c,'POnumber':_0xe8e4e8,'SCRN':_0x32cc7c,'JO_number':_0x42dd0e,'ReqBy':_0x562407,'dateofreq':_0x54461a,'typeservicesData':_0x2a9715,'van':_0x155abe,'typevehicle':_0x215c57,'driver':_0x3c4737,'plate':_0x5a9da0,'DRSI':_0x32dfef,'TSU':_0x381f6d,'TFU':_0x5bf72f,'typeOfProducts':_0x873756}),_0x58bfc9=await _0x7805ad[_0x54a80f(0x1c5)](),_0x36d891=await purchases_finished['findOne']({'_id':_0x58bfc9['_id']['valueOf']()});_0x5d4415[_0x54a80f(0x23b)](_0x54a80f(0x233),_0x54a80f(0x256)),_0x1c7d2f[_0x54a80f(0x2c9)](_0x54a80f(0x2ce)+_0x36d891[_0x54a80f(0x215)][_0x54a80f(0x1eb)]());}catch(_0xdb0439){console[_0x54a80f(0x2a4)](_0xdb0439);}}),router[a0_0x192b41(0x1e4)](a0_0x192b41(0x218),auth,async(_0x486278,_0x3a50d0)=>{var _0x38226a=a0_0x192b41;try{const {username:_0x328d49,email:_0x2440c1,role:_0x5ee84a}=_0x486278[_0x38226a(0x2e8)],_0x378fef=_0x486278[_0x38226a(0x2e8)],_0x3c8f45=_0x486278[_0x38226a(0x226)]['id'],_0xab1443=await profile[_0x38226a(0x21c)]({'email':_0x378fef[_0x38226a(0x281)]}),_0x218506=await master_shop[_0x38226a(0x23d)](),_0x2777c6=await staff[_0x38226a(0x21c)]({'email':_0x378fef[_0x38226a(0x281)]}),_0x2176d9=await suppliers[_0x38226a(0x23d)]({});let _0x3d1911;if(_0x378fef[_0x38226a(0x1e8)]==_0x38226a(0x1f0)){const _0x10e68b=await staff[_0x38226a(0x21c)]({'email':_0x378fef[_0x38226a(0x281)]});_0x3d1911=await warehouse['aggregate']([{'$match':{'status':_0x38226a(0x20f),'name':_0x10e68b[_0x38226a(0x2a5)]}},{'$group':{'_id':_0x38226a(0x21b),'name':{'$first':_0x38226a(0x21b)}}}]);}else _0x3d1911=await warehouse[_0x38226a(0x1d0)]([{'$match':{'status':_0x38226a(0x20f)}},{'$group':{'_id':_0x38226a(0x21b),'name':{'$first':_0x38226a(0x21b)}}}]);const _0x14f4fb=await purchases_finished['findById'](_0x3c8f45);if(_0x218506[0x0]['language']==_0x38226a(0x1d4))var _0x46fe5b=users['English'];else{if(_0x218506[0x0][_0x38226a(0x245)]=='Hindi')var _0x46fe5b=users[_0x38226a(0x2d6)];else{if(_0x218506[0x0][_0x38226a(0x245)]==_0x38226a(0x28f))var _0x46fe5b=users[_0x38226a(0x28f)];else{if(_0x218506[0x0][_0x38226a(0x245)]==_0x38226a(0x2b5))var _0x46fe5b=users[_0x38226a(0x2b5)];else{if(_0x218506[0x0][_0x38226a(0x245)]==_0x38226a(0x2cd))var _0x46fe5b=users[_0x38226a(0x2cd)];else{if(_0x218506[0x0]['language']=='Portuguese\x20(BR)')var _0x46fe5b=users[_0x38226a(0x275)];else{if(_0x218506[0x0][_0x38226a(0x245)]==_0x38226a(0x257))var _0x46fe5b=users[_0x38226a(0x257)];else{if(_0x218506[0x0][_0x38226a(0x245)]==_0x38226a(0x1c1))var _0x46fe5b=users[_0x38226a(0x243)];}}}}}}}_0x3a50d0['render'](_0x38226a(0x2bf),{'success':_0x486278[_0x38226a(0x23b)]('success'),'errors':_0x486278[_0x38226a(0x23b)](_0x38226a(0x2f5)),'role':_0x378fef,'profile':_0xab1443,'suppliers':_0x2176d9,'warehouse':_0x3d1911,'master_shop':_0x218506,'language':_0x46fe5b,'purchases_data':_0x14f4fb});}catch(_0x5d8a6b){console['log'](_0x5d8a6b);}});async function get_warehouse_data(_0x510a7b,_0x3ded2e){var _0x283249=a0_0x192b41;try{const _0x395152=await warehouse_temporary[_0x283249(0x21c)]({'name':_0x510a7b,'room':_0x3ded2e});if(!_0x395152){const _0x1186c3=new warehouse_temporary({'name':_0x510a7b,'address':_0x510a7b,'status':'Enabled','room':_0x3ded2e,'isStaging':'false'});return await _0x1186c3[_0x283249(0x1c5)](),_0x1186c3;}else return _0x395152;}catch(_0x424746){console[_0x283249(0x2b8)]('Error\x20fetching\x20or\x20saving\x20warehouse\x20data:',_0x424746);throw _0x424746;}}router[a0_0x192b41(0x273)](a0_0x192b41(0x218),auth,async(_0xdb01fc,_0x3ccd3e)=>{var _0x46dd8a=a0_0x192b41;try{const _0xbe4923=_0xdb01fc[_0x46dd8a(0x226)]['id'],_0x1ff322=await purchases_finished[_0x46dd8a(0x206)](_0xbe4923);let _0x30ba22=[];_0x1ff322[_0x46dd8a(0x269)][_0x46dd8a(0x1c0)]((_0xf21781,_0x159fa0)=>{var _0x22f51c=_0x46dd8a;_0x30ba22[_0x159fa0]={},_0x30ba22[_0x159fa0]['warehouse']=_0x1ff322[_0x22f51c(0x1e9)],_0x30ba22[_0x159fa0][_0x22f51c(0x2be)]=_0xf21781[_0x22f51c(0x2be)],_0x30ba22[_0x159fa0][_0x22f51c(0x1d8)]=_0xf21781['product_name'],_0x30ba22[_0x159fa0][_0x22f51c(0x24d)]=_0xf21781[_0x22f51c(0x24d)],_0x30ba22[_0x159fa0]['quantity']=_0xf21781[_0x22f51c(0x208)],_0x30ba22[_0x159fa0][_0x22f51c(0x263)]=_0xf21781[_0x22f51c(0x263)],_0x30ba22[_0x159fa0][_0x22f51c(0x228)]=_0xf21781[_0x22f51c(0x228)],_0x30ba22[_0x159fa0][_0x22f51c(0x249)]=_0xf21781[_0x22f51c(0x249)],_0x30ba22[_0x159fa0]['bay']=_0xf21781[_0x22f51c(0x2af)],_0x30ba22[_0x159fa0]['primary_code']=_0xf21781[_0x22f51c(0x2cc)],_0x30ba22[_0x159fa0][_0x22f51c(0x239)]=_0xf21781[_0x22f51c(0x239)],_0x30ba22[_0x159fa0][_0x22f51c(0x2f6)]=_0xf21781['maxStocks'],_0x30ba22[_0x159fa0]['batch_code']=_0xf21781[_0x22f51c(0x223)],_0x30ba22[_0x159fa0][_0x22f51c(0x2c8)]=_0xf21781['expiry_date'],_0x30ba22[_0x159fa0][_0x22f51c(0x2e2)]=_0xf21781[_0x22f51c(0x2e2)],_0x30ba22[_0x159fa0][_0x22f51c(0x272)]=_0xf21781['maxperunit'],_0x30ba22[_0x159fa0][_0x22f51c(0x2dc)]=_0xf21781['product_cat'],_0x30ba22[_0x159fa0][_0x22f51c(0x2e7)]=_0xf21781['room_name'],_0x30ba22[_0x159fa0][_0x22f51c(0x298)]=_0xf21781[_0x22f51c(0x298)],_0x30ba22[_0x159fa0]['uuid']=_0xf21781['uuid'],_0x30ba22[_0x159fa0][_0x22f51c(0x261)]=_0xf21781[_0x22f51c(0x261)],_0x30ba22[_0x159fa0][_0x22f51c(0x212)]=_0xf21781['sales_category'],_0x30ba22[_0x159fa0][_0x22f51c(0x1ed)]=_0xf21781[_0x22f51c(0x1ed)],_0x30ba22[_0x159fa0]['purchases_id']=_0xf21781[_0x22f51c(0x215)][_0x22f51c(0x1eb)]();});for(let _0x313792=0x0;_0x313792<=_0x30ba22['length']-0x1;_0x313792++){const _0x413c7a=_0x30ba22[_0x313792],_0x3c6fa2=new warehouse_temporary(_0x413c7a);await _0x3c6fa2['save']();}_0x1ff322[_0x46dd8a(0x29d)]='true',await _0x1ff322[_0x46dd8a(0x1c5)](),_0xdb01fc[_0x46dd8a(0x23b)]('success','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x3ccd3e[_0x46dd8a(0x2c9)](_0x46dd8a(0x2ce)+_0x1ff322['_id'][_0x46dd8a(0x1eb)]());}catch(_0x3bfcd2){}}),router[a0_0x192b41(0x273)]('/view/add_purchases_logs',auth,async(_0x27acc0,_0x288b8b)=>{var _0x587c28=a0_0x192b41;try{const {invoice:_0x1c61d1,date:_0x41e80f,warehouse_name:_0x2340a3,prod_name:_0x210baa,note:_0x516c3b,due_amount:_0x58a68c,Room_name:_0x54a6ce,PO_number:_0x184a97,SCRN:_0x513dae,ReqBy:_0xecdcf8,dateofreq:_0x1b2e8b,suppliers:_0x104cef,typeservicesData:_0xecf89b,van:_0x922159,typevehicle:_0x355b14,driver:_0x3450d0,plate:_0x2b2336,DRSI:_0xba2788,TSU:_0x2a1014,TFU:_0x4b1231,JO_number:_0x5c7005,type_of_products:_0xbf218c}=_0x27acc0[_0x587c28(0x1cd)];if(typeof _0x210baa=='string')var _0x43610d=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x22f)]],_0x416411=[_0x27acc0[_0x587c28(0x1cd)]['prod_code']],_0x580783=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x24b)]],_0x38fbcb=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x25c)]],_0x138938=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x22e)]],_0x2c7163=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2df)]],_0x4cee6c=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2cc)]],_0x2de511=[_0x27acc0['body'][_0x587c28(0x239)]],_0x16a99d=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x1ce)]],_0x199b97=[_0x27acc0['body'][_0x587c28(0x223)]],_0x401476=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2c8)]],_0x5234a9=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2c6)]],_0x217583=[_0x27acc0['body'][_0x587c28(0x229)]],_0x3b0a35=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x234)]],_0x205056=[_0x27acc0['body'][_0x587c28(0x2d4)]],_0x43def9=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x261)]],_0x46eacf=[_0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x22b)]],_0x113152=[_0x27acc0['body'][_0x587c28(0x2f7)]],_0x306772=[_0x27acc0[_0x587c28(0x1cd)]['type_of_products_type']];else var _0x43610d=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x22f)]],_0x416411=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2ae)]],_0x580783=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x24b)]],_0x38fbcb=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x25c)]],_0x138938=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x22e)]],_0x2c7163=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2df)]],_0x4cee6c=[..._0x27acc0['body'][_0x587c28(0x2cc)]],_0x2de511=[..._0x27acc0[_0x587c28(0x1cd)]['secondary_code']],_0x16a99d=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x1ce)]],_0x199b97=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x223)]],_0x401476=[..._0x27acc0['body'][_0x587c28(0x2c8)]],_0x5234a9=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2c6)]],_0x217583=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x229)]],_0x3b0a35=[..._0x27acc0[_0x587c28(0x1cd)]['prod_cat']],_0x205056=[..._0x27acc0[_0x587c28(0x1cd)]['RoomAssign']],_0x43def9=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x261)]],_0x46eacf=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x22b)]],_0x113152=[..._0x27acc0[_0x587c28(0x1cd)][_0x587c28(0x2f7)]],_0x306772=[..._0x27acc0['body']['type_of_products_type']];const _0x1aeaaf=_0x43610d['map'](_0x1ac200=>{return _0x1ac200={'product_name':_0x1ac200};});_0x306772[_0x587c28(0x1c0)]((_0x123ada,_0x9a4706)=>{var _0x552884=_0x587c28;_0x1aeaaf[_0x9a4706][_0x552884(0x2b3)]=_0x123ada;}),_0x113152['forEach']((_0x2b7ce4,_0x1fc586)=>{_0x1aeaaf[_0x1fc586]['sales_category']=_0x2b7ce4;}),_0x416411[_0x587c28(0x1c0)]((_0xc53971,_0x61e095)=>{var _0x34666f=_0x587c28;_0x1aeaaf[_0x61e095][_0x34666f(0x24d)]=_0xc53971;}),_0x46eacf[_0x587c28(0x1c0)]((_0x5f101b,_0x91a461)=>{var _0x5bfea6=_0x587c28;_0x1aeaaf[_0x91a461][_0x5bfea6(0x22b)]=_0x5f101b;}),_0x580783[_0x587c28(0x1c0)]((_0x3be372,_0x2bff79)=>{var _0xca1d7e=_0x587c28;_0x1aeaaf[_0x2bff79][_0xca1d7e(0x208)]=Math[_0xca1d7e(0x22d)](_0x3be372);}),_0x38fbcb[_0x587c28(0x1c0)]((_0x305ebf,_0x557839)=>{var _0x3dac55=_0x587c28;_0x1aeaaf[_0x557839][_0x3dac55(0x263)]=_0x305ebf;}),_0x138938[_0x587c28(0x1c0)]((_0x1597e5,_0x3335e1)=>{_0x1aeaaf[_0x3335e1]['secondary_unit']=_0x1597e5;}),_0x2c7163[_0x587c28(0x1c0)]((_0x51ca2c,_0x14c72f)=>{var _0x8a9c35=_0x587c28,_0x2960ca=_0x51ca2c[_0x8a9c35(0x1c7)](/[A-Za-z]+/)[0x0],_0x137f87=parseInt(_0x51ca2c['match'](/\d+/)[0x0]);_0x1aeaaf[_0x14c72f][_0x8a9c35(0x249)]=_0x2960ca,_0x1aeaaf[_0x14c72f][_0x8a9c35(0x2af)]=_0x137f87;}),_0x4cee6c['forEach']((_0x2b734a,_0x878558)=>{_0x1aeaaf[_0x878558]['primary_code']=_0x2b734a;}),_0x2de511[_0x587c28(0x1c0)]((_0x48bad8,_0x283938)=>{var _0x3b7c0c=_0x587c28;_0x1aeaaf[_0x283938][_0x3b7c0c(0x239)]=_0x48bad8;}),_0x16a99d[_0x587c28(0x1c0)]((_0xe44d71,_0x16bcfa)=>{var _0x29afbe=_0x587c28;_0x1aeaaf[_0x16bcfa][_0x29afbe(0x2f6)]=_0xe44d71;}),_0x199b97['forEach']((_0x263703,_0x433ea2)=>{var _0x5ba59d=_0x587c28;_0x1aeaaf[_0x433ea2][_0x5ba59d(0x223)]=_0x263703;}),_0x401476['forEach']((_0x499d3c,_0x35c10c)=>{var _0x317c5f=_0x587c28;_0x1aeaaf[_0x35c10c][_0x317c5f(0x2c8)]=_0x499d3c;}),_0x5234a9[_0x587c28(0x1c0)]((_0x6e7dc2,_0x30af57)=>{_0x1aeaaf[_0x30af57]['production_date']=_0x6e7dc2;}),_0x217583[_0x587c28(0x1c0)]((_0x18ccb,_0xac020b)=>{var _0x442425=_0x587c28;_0x1aeaaf[_0xac020b][_0x442425(0x272)]=_0x18ccb;}),_0x3b0a35[_0x587c28(0x1c0)]((_0x340a7f,_0x3eb611)=>{var _0x2893fd=_0x587c28;_0x1aeaaf[_0x3eb611][_0x2893fd(0x2dc)]=_0x340a7f;}),_0x205056['forEach']((_0x40f140,_0x4f5231)=>{var _0x304e87=_0x587c28;_0x1aeaaf[_0x4f5231][_0x304e87(0x2e7)]=_0x40f140;}),_0x43def9[_0x587c28(0x1c0)]((_0x591698,_0x1d83ec)=>{var _0x2a3d23=_0x587c28;_0x1aeaaf[_0x1d83ec][_0x2a3d23(0x261)]=_0x591698;});const _0xad58bd=new purchases_logs();await _0xad58bd['save']();for(let _0x21baf1=0x0;_0x21baf1<=_0x205056[_0x587c28(0x276)]-0x1;_0x21baf1++){_0x1aeaaf[_0x21baf1]['invoice']='LOG-INC-'+_0xad58bd['invoice_init'][_0x587c28(0x28e)]()[_0x587c28(0x24a)](0x8,'0');}const _0x311a0b=_0x1aeaaf[_0x587c28(0x1f1)](_0xbf9982=>_0xbf9982['quantity']!=='0'&&_0xbf9982[_0x587c28(0x208)]!==''),_0x14a521=new purchases_finished({'invoice':_0x587c28(0x1f8)+_0xad58bd[_0x587c28(0x22a)][_0x587c28(0x28e)]()[_0x587c28(0x24a)](0x8,'0'),'suppliers':_0x104cef,'date':_0x41e80f,'warehouse_name':_0x2340a3,'product':_0x311a0b,'note':_0x516c3b,'due_amount':_0x58a68c,'room':_0x54a6ce,'POnumber':_0x184a97,'SCRN':_0x513dae,'JO_number':_0x5c7005,'ReqBy':_0xecdcf8,'dateofreq':_0x1b2e8b,'typeservicesData':_0xecf89b,'van':_0x922159,'typevehicle':_0x355b14,'driver':_0x3450d0,'plate':_0x2b2336,'DRSI':_0xba2788,'TSU':_0x2a1014,'TFU':_0x4b1231,'typeOfProducts':_0xbf218c}),_0x28cfdc=await _0x14a521[_0x587c28(0x1c5)](),_0x13be2a=await purchases_finished[_0x587c28(0x21c)]({'_id':_0x28cfdc[_0x587c28(0x215)][_0x587c28(0x1eb)]()}),_0x14ad57=_0x13be2a[_0x587c28(0x269)]['map'](async _0x3f2a18=>{var _0x36f18b=_0x587c28;try{var _0x3e5fec=await warehouse[_0x36f18b(0x21c)]({'name':_0x2340a3,'room':_0x3f2a18['room_name']}),_0x428ab5=0x0;const _0x55f4af=_0x3e5fec[_0x36f18b(0x280)]['map'](_0x19027d=>{var _0x41c579=_0x36f18b;console[_0x41c579(0x2a4)](_0x19027d[_0x41c579(0x1d8)]+'=='+_0x3f2a18[_0x41c579(0x1d8)]+'&&'+_0x19027d[_0x41c579(0x2af)]+'=='+_0x3f2a18[_0x41c579(0x2af)]+'&&'+_0x19027d['expiry_date']+'=='+_0x3f2a18[_0x41c579(0x2c8)]+'&&'+_0x19027d['production_date']+'=='+_0x3f2a18['production_date']+'&&'+_0x19027d[_0x41c579(0x223)]+'=='+_0x3f2a18['batch_code']+'&&'+_0x19027d[_0x41c579(0x298)]+'=='+_0x13be2a[_0x41c579(0x298)]),_0x19027d[_0x41c579(0x1d8)]==_0x3f2a18[_0x41c579(0x1d8)]&&_0x19027d[_0x41c579(0x2af)]==_0x3f2a18[_0x41c579(0x2af)]&&_0x19027d['level']==_0x3f2a18['level']&&_0x19027d[_0x41c579(0x2c8)]==_0x3f2a18[_0x41c579(0x2c8)]&&_0x19027d['production_date']==_0x3f2a18[_0x41c579(0x2e2)]&&_0x19027d[_0x41c579(0x223)]==_0x3f2a18['batch_code']&&_0x19027d[_0x41c579(0x298)]==_0x13be2a['invoice']&&(_0x19027d['product_stock']=Math['abs'](_0x19027d['product_stock'])+Math[_0x41c579(0x22d)](_0x3f2a18['quantity']),_0x428ab5++);});return _0x428ab5==0x0&&(_0x3e5fec['product_details']=_0x3e5fec[_0x36f18b(0x280)]['concat']({'product_name':_0x3f2a18['product_name'],'product_stock':Math[_0x36f18b(0x22d)](_0x3f2a18[_0x36f18b(0x208)]),'primary_code':_0x3f2a18[_0x36f18b(0x2cc)],'secondary_code':_0x3f2a18[_0x36f18b(0x239)],'product_code':_0x3f2a18[_0x36f18b(0x24d)],'bay':_0x3f2a18['bay'],'level':_0x3f2a18[_0x36f18b(0x249)],'maxProducts':_0x3f2a18['maxStocks'],'unit':_0x3f2a18['standard_unit'],'secondary_unit':_0x3f2a18[_0x36f18b(0x228)],'expiry_date':_0x3f2a18[_0x36f18b(0x2c8)],'production_date':_0x3f2a18['production_date'],'maxProducts':_0x3f2a18['maxStocks'],'maxPerUnit':_0x3f2a18[_0x36f18b(0x272)],'batch_code':_0x3f2a18[_0x36f18b(0x223)],'product_cat':_0x3f2a18[_0x36f18b(0x2dc)],'invoice':_0x3f2a18[_0x36f18b(0x298)],'id_incoming':_0x3f2a18[_0x36f18b(0x215)],'uuid':_0x3f2a18[_0x36f18b(0x22b)],'gross_price':_0x3f2a18[_0x36f18b(0x261)],'sales_category':_0x3f2a18[_0x36f18b(0x212)],'type_products':_0x3f2a18[_0x36f18b(0x2b3)]})),_0x3e5fec;}catch(_0x2f115f){return console[_0x36f18b(0x2b8)](_0x36f18b(0x244),_0x2f115f),null;}});Promise[_0x587c28(0x2c1)](_0x14ad57)[_0x587c28(0x2d1)](async _0x3f9a19=>{var _0x53f48c=_0x587c28;try{for(const _0x246be7 of _0x3f9a19){await warehouse[_0x53f48c(0x2b9)]({'_id':_0x246be7['_id']},{'$addToSet':{'product_details':{'$each':_0x246be7['product_details']}}});}const _0x59ee03=await master_shop[_0x53f48c(0x23d)](),_0x4361e1=await email_settings[_0x53f48c(0x21c)](),_0x14acba=await supervisor_settings[_0x53f48c(0x23d)]();var _0x5a2abf=_0x13be2a[_0x53f48c(0x269)],_0x42316e='',_0x4e1d7c;for(_0x4e1d7c in _0x5a2abf){var _0x442111='FG';_0x13be2a[_0x53f48c(0x1e9)]==_0x53f48c(0x23a)&&(_0x442111='DG'),_0x42316e+=_0x53f48c(0x2f0)+_0x53f48c(0x205)+_0x5a2abf[_0x4e1d7c][_0x53f48c(0x1d8)]+_0x53f48c(0x1df)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5a2abf[_0x4e1d7c][_0x53f48c(0x24d)]+_0x53f48c(0x1df)+_0x53f48c(0x205)+_0x5a2abf[_0x4e1d7c][_0x53f48c(0x208)]+_0x53f48c(0x1df)+_0x53f48c(0x205)+_0x5a2abf[_0x4e1d7c][_0x53f48c(0x263)]+_0x53f48c(0x1df)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5a2abf[_0x4e1d7c][_0x53f48c(0x228)]+'</td>'+_0x53f48c(0x205)+_0x13be2a[_0x53f48c(0x1e9)]+_0x53f48c(0x1df)+_0x53f48c(0x205)+_0x5a2abf[_0x4e1d7c][_0x53f48c(0x2e7)]+'</td>'+_0x53f48c(0x205)+_0x442111+_0x5a2abf[_0x4e1d7c]['bay']+_0x53f48c(0x1df),'</tr>';}let _0x2bc96b=nodemailer[_0x53f48c(0x1cc)]({'host':_0x4361e1[_0x53f48c(0x26f)],'port':Number(_0x4361e1[_0x53f48c(0x1bc)]),'secure':![],'auth':{'user':_0x4361e1[_0x53f48c(0x281)],'pass':_0x4361e1[_0x53f48c(0x2b0)]}}),_0xc0d5b={'from':_0x4361e1[_0x53f48c(0x281)],'to':_0x14acba[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x53f48c(0x1d6),'path':__dirname+_0x53f48c(0x1d5)+_0x53f48c(0x2f2)+_0x59ee03[0x0][_0x53f48c(0x1c2)],'cid':_0x53f48c(0x283)}],'html':_0x53f48c(0x260)+_0x53f48c(0x266)+_0x53f48c(0x2da)+_0x53f48c(0x240)+_0x53f48c(0x210)+'<div>'+_0x53f48c(0x2ec)+_0x53f48c(0x2a2)+_0x53f48c(0x240)+_0x53f48c(0x20e)+_0x59ee03[0x0]['site_title']+_0x53f48c(0x2d5)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x53f48c(0x240)+_0x53f48c(0x246)+_0x53f48c(0x20c)+_0x13be2a[_0x53f48c(0x298)]+'\x20'+_0x53f48c(0x1dc)+_0x53f48c(0x20a)+_0x13be2a['date']+'\x20'+'</span>'+_0x53f48c(0x26b)+_0x53f48c(0x2a2)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x53f48c(0x287)+_0x53f48c(0x2f0)+_0x53f48c(0x2de)+_0x53f48c(0x247)+_0x53f48c(0x1ef)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x53f48c(0x1e0)+_0x53f48c(0x27b)+_0x53f48c(0x2ac)+_0x53f48c(0x225)+_0x53f48c(0x232)+_0x53f48c(0x2d3)+_0x53f48c(0x216)+'\x20'+_0x42316e+'\x20'+_0x53f48c(0x2c5)+_0x53f48c(0x23f)+_0x53f48c(0x240)+_0x53f48c(0x230)+_0x53f48c(0x1fe)+_0x59ee03[0x0][_0x53f48c(0x1d1)]+'</h5>'+_0x53f48c(0x2a2)+_0x53f48c(0x2a2)+_0x53f48c(0x1d2)};_0x2bc96b['sendMail'](_0xc0d5b,function(_0xe6a5a,_0x16a68d){var _0x4a4c7e=_0x53f48c;_0xe6a5a?(console[_0x4a4c7e(0x2a4)](_0xe6a5a),console[_0x4a4c7e(0x2a4)](_0x4a4c7e(0x2e3))):console[_0x4a4c7e(0x2a4)](_0x4a4c7e(0x1f5));});}catch(_0x51099d){console['error'](_0x51099d),_0x288b8b[_0x53f48c(0x299)](0x1f4)[_0x53f48c(0x1fc)]({'error':_0x53f48c(0x204),'message':_0x51099d[_0x53f48c(0x25f)]});}})['catch'](_0x17573b=>{var _0x44c34a=_0x587c28;console[_0x44c34a(0x2b8)](_0x17573b);}),_0x27acc0['flash'](_0x587c28(0x233),_0x587c28(0x256)),_0x288b8b[_0x587c28(0x2c9)](_0x587c28(0x2c4)+_0x13be2a[_0x587c28(0x215)][_0x587c28(0x1eb)]());}catch(_0x82cdc6){console['log'](_0x82cdc6);}}),router['get'](a0_0x192b41(0x27e),auth,async(_0x438c27,_0x3bbe61)=>{var _0x4eabd7=a0_0x192b41;try{const {username:_0x5b74e8,email:_0xf9a776,role:_0x559d30}=_0x438c27['user'],_0x49b55d=_0x438c27[_0x4eabd7(0x2e8)],_0x44b769=await profile[_0x4eabd7(0x21c)]({'email':_0x49b55d[_0x4eabd7(0x281)]}),_0x10d67f=await master_shop[_0x4eabd7(0x23d)](),_0x27bec9=_0x438c27[_0x4eabd7(0x226)]['id'],_0x4efc5a=await purchases_finished[_0x4eabd7(0x206)](_0x27bec9),_0x194606=await suppliers[_0x4eabd7(0x23d)]({});let _0x34496e;if(_0x49b55d[_0x4eabd7(0x1e8)]=='staff'){const _0xef1510=await staff[_0x4eabd7(0x21c)]({'email':_0x49b55d[_0x4eabd7(0x281)]});_0x34496e=await warehouse[_0x4eabd7(0x23d)]({'status':_0x4eabd7(0x20f),'name':_0xef1510['warehouse'],'warehouse_category':_0x4eabd7(0x26d)});}else _0x34496e=await warehouse[_0x4eabd7(0x1d0)]([{'$match':{'status':_0x4eabd7(0x20f),'warehouse_category':_0x4eabd7(0x26d)}},{'$group':{'_id':'$name','name':{'$first':_0x4eabd7(0x21b)}}}]);const _0x2b6577=await product[_0x4eabd7(0x23d)]({}),_0x5496ee=BayBinSelected(_0x4efc5a[_0x4eabd7(0x1e9)],_0x4efc5a[_0x4eabd7(0x1e2)]);let _0x59be1d=new Date(_0x4efc5a['expiry_date']),_0x1c3f01=('0'+_0x59be1d[_0x4eabd7(0x290)]())[_0x4eabd7(0x2aa)](-0x2),_0x45202a=('0'+(_0x59be1d[_0x4eabd7(0x1d7)]()+0x1))[_0x4eabd7(0x2aa)](-0x2),_0x18628a=_0x59be1d['getFullYear'](),_0x1e8f29=_0x18628a+'-'+_0x45202a+'-'+_0x1c3f01;if(_0x10d67f[0x0]['language']==_0x4eabd7(0x1d4)){var _0x505dad=users[_0x4eabd7(0x29b)];console[_0x4eabd7(0x2a4)](_0x505dad);}else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]=='Hindi')var _0x505dad=users[_0x4eabd7(0x2d6)];else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]==_0x4eabd7(0x28f))var _0x505dad=users[_0x4eabd7(0x28f)];else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]==_0x4eabd7(0x2b5))var _0x505dad=users[_0x4eabd7(0x2b5)];else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]==_0x4eabd7(0x2cd))var _0x505dad=users[_0x4eabd7(0x2cd)];else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]==_0x4eabd7(0x259))var _0x505dad=users[_0x4eabd7(0x275)];else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]==_0x4eabd7(0x257))var _0x505dad=users[_0x4eabd7(0x257)];else{if(_0x10d67f[0x0][_0x4eabd7(0x245)]==_0x4eabd7(0x1c1))var _0x505dad=users[_0x4eabd7(0x243)];}}}}}}}_0x3bbe61[_0x4eabd7(0x1e7)](_0x4eabd7(0x270),{'success':_0x438c27[_0x4eabd7(0x23b)](_0x4eabd7(0x233)),'errors':_0x438c27[_0x4eabd7(0x23b)]('errors'),'role':_0x49b55d,'profile':_0x44b769,'purchases':_0x4efc5a,'suppliers':_0x194606,'warehouse':_0x34496e,'product':_0x2b6577,'master_shop':_0x10d67f,'language':_0x505dad,'ed_fullDate':_0x1e8f29,'dataSelected':_0x5496ee});}catch(_0x24cb35){console[_0x4eabd7(0x2a4)](_0x24cb35);}}),router['get'](a0_0x192b41(0x26e),auth,async(_0x3f514c,_0xd81d5c)=>{var _0x581fdd=a0_0x192b41;try{const {username:_0x1302c5,email:_0x528f50,role:_0x32a714}=_0x3f514c[_0x581fdd(0x2e8)],_0x491e4e=_0x3f514c['user'],_0x1ace7a=await profile['findOne']({'email':_0x491e4e[_0x581fdd(0x281)]}),_0x1fe11d=await master_shop[_0x581fdd(0x23d)](),_0x291fa7=_0x3f514c[_0x581fdd(0x226)]['id'],_0x4326c8=await purchases_finished[_0x581fdd(0x206)](_0x291fa7),_0x2ba57f=await suppliers[_0x581fdd(0x23d)]({});let _0x6272d0;if(_0x491e4e[_0x581fdd(0x1e8)]==_0x581fdd(0x1f0)){const _0x26883a=await staff[_0x581fdd(0x21c)]({'email':_0x491e4e[_0x581fdd(0x281)]});_0x6272d0=await warehouse[_0x581fdd(0x23d)]({'status':_0x581fdd(0x20f),'name':_0x26883a[_0x581fdd(0x2a5)],'warehouse_category':_0x581fdd(0x26d)});}else _0x6272d0=await warehouse[_0x581fdd(0x1d0)]([{'$match':{'status':_0x581fdd(0x20f),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x581fdd(0x21b),'name':{'$first':_0x581fdd(0x21b)}}}]);const _0x1749c4=await product[_0x581fdd(0x23d)]({}),_0x464154=BayBinSelected(_0x4326c8[_0x581fdd(0x1e9)],_0x4326c8[_0x581fdd(0x1e2)]);let _0x5b6df6=new Date(_0x4326c8['expiry_date']),_0x55d865=('0'+_0x5b6df6[_0x581fdd(0x290)]())[_0x581fdd(0x2aa)](-0x2),_0x142164=('0'+(_0x5b6df6[_0x581fdd(0x1d7)]()+0x1))[_0x581fdd(0x2aa)](-0x2),_0x16422f=_0x5b6df6[_0x581fdd(0x277)](),_0x5962e1=_0x16422f+'-'+_0x142164+'-'+_0x55d865;if(_0x1fe11d[0x0]['language']==_0x581fdd(0x1d4)){var _0x204f4b=users[_0x581fdd(0x29b)];console[_0x581fdd(0x2a4)](_0x204f4b);}else{if(_0x1fe11d[0x0][_0x581fdd(0x245)]=='Hindi')var _0x204f4b=users[_0x581fdd(0x2d6)];else{if(_0x1fe11d[0x0]['language']==_0x581fdd(0x28f))var _0x204f4b=users['German'];else{if(_0x1fe11d[0x0][_0x581fdd(0x245)]==_0x581fdd(0x2b5))var _0x204f4b=users[_0x581fdd(0x2b5)];else{if(_0x1fe11d[0x0]['language']==_0x581fdd(0x2cd))var _0x204f4b=users['French'];else{if(_0x1fe11d[0x0][_0x581fdd(0x245)]=='Portuguese\x20(BR)')var _0x204f4b=users[_0x581fdd(0x275)];else{if(_0x1fe11d[0x0][_0x581fdd(0x245)]==_0x581fdd(0x257))var _0x204f4b=users[_0x581fdd(0x257)];else{if(_0x1fe11d[0x0][_0x581fdd(0x245)]==_0x581fdd(0x1c1))var _0x204f4b=users[_0x581fdd(0x243)];}}}}}}}_0xd81d5c[_0x581fdd(0x1e7)](_0x581fdd(0x1db),{'success':_0x3f514c[_0x581fdd(0x23b)]('success'),'errors':_0x3f514c[_0x581fdd(0x23b)]('errors'),'role':_0x491e4e,'profile':_0x1ace7a,'purchases':_0x4326c8,'suppliers':_0x2ba57f,'warehouse':_0x6272d0,'product':_0x1749c4,'master_shop':_0x1fe11d,'language':_0x204f4b,'ed_fullDate':_0x5962e1,'dataSelected':_0x464154});}catch(_0x562abe){console['log'](_0x562abe);}}),router[a0_0x192b41(0x273)](a0_0x192b41(0x26e),auth,async(_0x472772,_0x1c242b)=>{var _0x34a081=a0_0x192b41;try{const _0x2885a1=_0x472772[_0x34a081(0x226)]['id'],_0x16e2af=await purchases_finished[_0x34a081(0x21c)]({'_id':_0x472772[_0x34a081(0x226)]['id']}),_0x305755=await warehouse[_0x34a081(0x21c)]({'name':_0x16e2af[_0x34a081(0x1e9)],'room':_0x16e2af[_0x34a081(0x1e2)]});_0x16e2af['product'][_0x34a081(0x1c0)](_0x298261=>{var _0x4ec27f=_0x34a081;const _0x4ba2bf=_0x305755['product_details'][_0x4ec27f(0x284)](_0x1444f=>{var _0x154aeb=_0x4ec27f;_0x1444f[_0x154aeb(0x1d8)]==_0x298261[_0x154aeb(0x1d8)]&&_0x1444f[_0x154aeb(0x2af)]==_0x298261['bay']&&(_0x1444f[_0x154aeb(0x1c8)]=parseInt(_0x1444f[_0x154aeb(0x1c8)])-parseInt(_0x298261[_0x154aeb(0x208)]));});}),await _0x305755[_0x34a081(0x1c5)]();const {invoice:_0x8acbf6,suppliers:_0x45b242,date:_0x4b9e04,warehouse_name:_0x2ab3b0,prod_name:_0x4443ab,prod_code:_0x538b08,prod_qty:_0x41ab4f,prod_unit:_0x22a906,prod_secondunit:_0x48714b,prod_level:_0x357260,prod_isle:_0x301e99,prod_pallet:_0x367437,note:_0x1292fd,expiry_date:_0x3a7e6f,batch_code:_0x179d99,paid_amount:_0x3db120,due_amount:_0x4336ab,Room_name:_0x5a520a,primary_code:_0x240727,secondary_code:_0x5e6ae5,PO_number:_0x36e7ce,JO_number:_0x1e4d2b}=_0x472772[_0x34a081(0x1cd)];if(typeof _0x4443ab==_0x34a081(0x2ed))var _0x40c1d3=[_0x472772['body'][_0x34a081(0x22f)]],_0x1ae32c=[_0x472772['body'][_0x34a081(0x2ae)]],_0x1c943e=[_0x472772[_0x34a081(0x1cd)][_0x34a081(0x2ca)]],_0x30c5e4=[_0x472772[_0x34a081(0x1cd)][_0x34a081(0x2d0)]],_0x1bd8e8=[_0x472772[_0x34a081(0x1cd)]['prod_secondunit']],_0x4ba25a=[_0x472772[_0x34a081(0x1cd)][_0x34a081(0x2df)]],_0x1f3685=[_0x472772['body'][_0x34a081(0x2cc)]],_0x4a6acd=[_0x472772[_0x34a081(0x1cd)][_0x34a081(0x239)]],_0x5e5f55=[_0x472772['body']['MaxStocks_data']],_0x5eca3b=[_0x472772[_0x34a081(0x1cd)]['batch_code']],_0x15e729=[_0x472772['body']['expiry_date']];else var _0x40c1d3=[..._0x472772['body'][_0x34a081(0x22f)]],_0x1ae32c=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x2ae)]],_0x1c943e=[..._0x472772['body'][_0x34a081(0x2ca)]],_0x30c5e4=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x2d0)]],_0x1bd8e8=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x22e)]],_0x4ba25a=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x2df)]],_0x1f3685=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x2cc)]],_0x4a6acd=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x239)]],_0x5e5f55=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x1ce)]],_0x5eca3b=[..._0x472772['body'][_0x34a081(0x223)]],_0x15e729=[..._0x472772[_0x34a081(0x1cd)][_0x34a081(0x2c8)]];const _0x305d5e=_0x40c1d3[_0x34a081(0x284)](_0x568804=>{return _0x568804={'product_name':_0x568804};});_0x1ae32c[_0x34a081(0x1c0)]((_0x5c543f,_0x40360e)=>{_0x305d5e[_0x40360e]['product_code']=_0x5c543f;}),_0x1c943e['forEach']((_0xdb3759,_0x374f10)=>{var _0x21dd60=_0x34a081;_0x305d5e[_0x374f10][_0x21dd60(0x208)]=_0xdb3759;}),_0x30c5e4[_0x34a081(0x1c0)]((_0x531b13,_0x482f87)=>{var _0x5f2050=_0x34a081;_0x305d5e[_0x482f87][_0x5f2050(0x263)]=_0x531b13;}),_0x1bd8e8['forEach']((_0x4d18f2,_0x329f0f)=>{var _0x53b7af=_0x34a081;_0x305d5e[_0x329f0f][_0x53b7af(0x228)]=_0x4d18f2;}),_0x4ba25a['forEach']((_0x18dea1,_0x328d3c)=>{var _0x3ee079=_0x34a081;_0x305d5e[_0x328d3c][_0x3ee079(0x2af)]=_0x18dea1;}),_0x1f3685[_0x34a081(0x1c0)]((_0x1f46cf,_0x3df9db)=>{var _0x932ccb=_0x34a081;_0x305d5e[_0x3df9db][_0x932ccb(0x2cc)]=_0x1f46cf;}),_0x4a6acd[_0x34a081(0x1c0)]((_0x38723a,_0x2e442d)=>{var _0x5eee21=_0x34a081;_0x305d5e[_0x2e442d][_0x5eee21(0x239)]=_0x38723a;}),_0x5e5f55[_0x34a081(0x1c0)]((_0x341edc,_0xa77891)=>{var _0x4e53d7=_0x34a081;_0x305d5e[_0xa77891][_0x4e53d7(0x2f6)]=_0x341edc;}),_0x5eca3b['forEach']((_0x4ac206,_0x5960a6)=>{var _0x20a2cd=_0x34a081;_0x305d5e[_0x5960a6][_0x20a2cd(0x223)]=_0x4ac206;}),_0x15e729[_0x34a081(0x1c0)]((_0x2c53c9,_0x5a3a9e)=>{var _0x1b0735=_0x34a081;_0x305d5e[_0x5a3a9e][_0x1b0735(0x2c8)]=_0x2c53c9;});const _0x23eeeb=_0x305d5e['filter'](_0x52a915=>_0x52a915[_0x34a081(0x208)]!=='0'&&_0x52a915[_0x34a081(0x208)]!=='');_0x16e2af[_0x34a081(0x298)]=_0x8acbf6,_0x16e2af[_0x34a081(0x28a)]=_0x45b242,_0x16e2af[_0x34a081(0x29e)]=_0x4b9e04,_0x16e2af[_0x34a081(0x1e9)]=_0x2ab3b0,_0x16e2af[_0x34a081(0x269)]=_0x23eeeb,_0x16e2af[_0x34a081(0x2e6)]=_0x1292fd,_0x16e2af[_0x34a081(0x231)]=_0x3db120,_0x16e2af[_0x34a081(0x25d)]=_0x4336ab,_0x16e2af[_0x34a081(0x1e2)]=_0x5a520a,_0x16e2af['POnumber']=_0x36e7ce,_0x16e2af[_0x34a081(0x1f4)]=_0x1e4d2b;const _0x3bade8=await _0x16e2af[_0x34a081(0x1c5)](),_0x1ff4b1=await warehouse['findOne']({'name':_0x472772[_0x34a081(0x1cd)]['warehouse_name'],'room':_0x472772['body'][_0x34a081(0x2f3)]});_0x16e2af[_0x34a081(0x269)][_0x34a081(0x1c0)](_0x48705f=>{var _0x31c949=_0x34a081,_0x1a03c7=0x0;const _0x51fc50=_0x1ff4b1[_0x31c949(0x280)][_0x31c949(0x284)](_0x20f257=>{var _0x1fbba7=_0x31c949;_0x20f257[_0x1fbba7(0x1d8)]==_0x48705f['product_name']&&_0x20f257[_0x1fbba7(0x2af)]==_0x48705f[_0x1fbba7(0x2af)]&&(_0x20f257[_0x1fbba7(0x1c8)]=parseInt(_0x20f257[_0x1fbba7(0x1c8)])+parseInt(_0x48705f[_0x1fbba7(0x208)]),_0x1a03c7++);});_0x1a03c7=='0'&&(_0x1ff4b1[_0x31c949(0x280)]=_0x1ff4b1[_0x31c949(0x280)]['concat']({'product_name':_0x48705f[_0x31c949(0x1d8)],'product_stock':_0x48705f[_0x31c949(0x208)],'primary_code':_0x48705f[_0x31c949(0x2cc)],'secondary_code':_0x48705f[_0x31c949(0x239)],'product_code':_0x48705f[_0x31c949(0x24d)],'bay':_0x48705f[_0x31c949(0x2af)],'maxProducts':_0x48705f[_0x31c949(0x2f6)],'unit':_0x48705f[_0x31c949(0x263)],'secondary_unit':_0x48705f[_0x31c949(0x228)],'expiry_date':_0x48705f[_0x31c949(0x2c8)]}));}),await _0x1ff4b1[_0x34a081(0x1c5)]();const _0x5f4d12=await s_payment_data[_0x34a081(0x21c)]({'invoice':_0x472772[_0x34a081(0x1cd)][_0x34a081(0x298)]});if(_0x5f4d12===null){}else console[_0x34a081(0x2a4)](_0x34a081(0x28a),_0x5f4d12,_0x472772[_0x34a081(0x1cd)]['invoice']),_0x5f4d12[_0x34a081(0x28a)]=_0x472772[_0x34a081(0x1cd)][_0x34a081(0x28a)],await _0x5f4d12[_0x34a081(0x1c5)]();_0x472772['flash'](_0x34a081(0x233),'purchase\x20data\x20update\x20successfully'),_0x1c242b[_0x34a081(0x2c9)](_0x34a081(0x1ea));}catch(_0x343db1){console['log'](_0x343db1);}}),router[a0_0x192b41(0x273)](a0_0x192b41(0x1f2),auth,async(_0x535b8b,_0x8f7d2d)=>{var _0x409e62=a0_0x192b41;try{const _0x3a7cd3=_0x535b8b[_0x409e62(0x226)]['id'],{invoice:_0x3c9a33,suppliers:_0x1f9f25,payable:_0x3a0d50,due_amount:_0x238c85}=_0x535b8b[_0x409e62(0x1cd)],_0xf6aa9c=await purchases[_0x409e62(0x206)](_0x3a7cd3);var _0x34f661=_0x3a0d50-_0x238c85;_0xf6aa9c['paid_amount']=parseFloat(_0xf6aa9c[_0x409e62(0x231)])+parseFloat(_0x238c85),_0xf6aa9c[_0x409e62(0x25d)]=_0x34f661;const _0xe28e06=await _0xf6aa9c[_0x409e62(0x1c5)]();console[_0x409e62(0x2a4)](_0xe28e06);const _0x31f0e7=await s_payment_data[_0x409e62(0x21c)]({'invoice':_0x3c9a33});_0x31f0e7[_0x409e62(0x21a)]=_0x34f661,await _0x31f0e7['save']();let _0x13bf0e=new Date(),_0x597eef=('0'+_0x13bf0e['getDate']())[_0x409e62(0x2aa)](-0x2),_0x2c67ba=('0'+(_0x13bf0e['getMonth']()+0x1))[_0x409e62(0x2aa)](-0x2),_0x1af2da=_0x13bf0e[_0x409e62(0x277)](),_0x1862e9=_0x1af2da+'-'+_0x2c67ba+'-'+_0x597eef;const _0xb310b4=new suppliers_payment({'invoice':_0x3c9a33,'date':_0x1af2da+'-'+_0x2c67ba+'-'+_0x597eef,'suppliers':_0x1f9f25,'reason':_0x409e62(0x1bf),'amount':_0x238c85}),_0x46c583=await _0xb310b4['save']();_0x535b8b['flash'](_0x409e62(0x233),_0x409e62(0x2d2)),_0x8f7d2d[_0x409e62(0x2c9)]('/all_purchases/view');}catch(_0x32974a){console['log'](_0x32974a);}}),router[a0_0x192b41(0x1e4)](a0_0x192b41(0x271),auth,async(_0xda1a97,_0x577bd0)=>{var _0x1b449c=a0_0x192b41;try{const {username:_0x3fbfda,email:_0x23509d,role:_0x3a1b2b}=_0xda1a97[_0x1b449c(0x2e8)],_0x28a0d3=_0xda1a97[_0x1b449c(0x2e8)],_0x226588=await profile[_0x1b449c(0x21c)]({'email':_0x28a0d3[_0x1b449c(0x281)]}),_0x4398b2=await master_shop[_0x1b449c(0x23d)]();console[_0x1b449c(0x2a4)](_0x1b449c(0x242),_0x4398b2);const _0x2370a6=_0xda1a97[_0x1b449c(0x226)]['id'],_0x35364e=await purchases[_0x1b449c(0x206)](_0x2370a6);console['log'](_0x35364e);const _0x10f3b0=await suppliers['findOne']({'name':_0x35364e[_0x1b449c(0x28a)]});console[_0x1b449c(0x2a4)](_0x10f3b0);if(_0x4398b2[0x0][_0x1b449c(0x245)]=='English\x20(US)'){var _0x4ea259=users[_0x1b449c(0x29b)];console[_0x1b449c(0x2a4)](_0x4ea259);}else{if(_0x4398b2[0x0][_0x1b449c(0x245)]==_0x1b449c(0x2d6))var _0x4ea259=users[_0x1b449c(0x2d6)];else{if(_0x4398b2[0x0][_0x1b449c(0x245)]==_0x1b449c(0x28f))var _0x4ea259=users[_0x1b449c(0x28f)];else{if(_0x4398b2[0x0][_0x1b449c(0x245)]=='Spanish')var _0x4ea259=users[_0x1b449c(0x2b5)];else{if(_0x4398b2[0x0]['language']=='French')var _0x4ea259=users[_0x1b449c(0x2cd)];else{if(_0x4398b2[0x0][_0x1b449c(0x245)]==_0x1b449c(0x259))var _0x4ea259=users['Portuguese'];else{if(_0x4398b2[0x0][_0x1b449c(0x245)]=='Chinese')var _0x4ea259=users['Chinese'];else{if(_0x4398b2[0x0]['language']==_0x1b449c(0x1c1))var _0x4ea259=users[_0x1b449c(0x243)];}}}}}}}_0x577bd0['render']('purchase_invoice',{'success':_0xda1a97['flash'](_0x1b449c(0x233)),'errors':_0xda1a97['flash'](_0x1b449c(0x2f5)),'role':_0x28a0d3,'profile':_0x226588,'master_shop':_0x4398b2,'supplier':_0x10f3b0,'purchase':_0x35364e,'language':_0x4ea259});}catch(_0x21f0e8){console[_0x1b449c(0x2a4)](_0x21f0e8);}}),router[a0_0x192b41(0x1e4)]('/view/return_purchase/:id',auth,async(_0x4f8b59,_0x18501b)=>{var _0x17b64e=a0_0x192b41;try{const {username:_0x22f7a3,email:_0x5e3ed8,role:_0x2a70c3}=_0x4f8b59[_0x17b64e(0x2e8)],_0x3f544d=_0x4f8b59['user'],_0x2361f7=await profile['findOne']({'email':_0x3f544d[_0x17b64e(0x281)]}),_0x318288=await master_shop['find']();console[_0x17b64e(0x2a4)](_0x17b64e(0x242),_0x318288);const _0x2a8670=_0x4f8b59[_0x17b64e(0x226)]['id'];console[_0x17b64e(0x2a4)](_0x2a8670);const _0x50efa6=await purchases_finished[_0x17b64e(0x206)](_0x2a8670);console[_0x17b64e(0x2a4)](_0x17b64e(0x2b1),_0x50efa6);const _0x167e8f=await product[_0x17b64e(0x23d)]({}),_0x1aef0a=await warehouse[_0x17b64e(0x1d0)]([{'$match':{'name':_0x50efa6[_0x17b64e(0x1e9)],'room':_0x50efa6[_0x17b64e(0x1e2)]}},{'$unwind':_0x17b64e(0x211)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x17b64e(0x268)},'product_stock':{'$first':_0x17b64e(0x252)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x17b64e(0x248)},'type':{'$first':_0x17b64e(0x2c3)},'floorlevel':{'$first':_0x17b64e(0x29f)},'primary_code':{'$first':_0x17b64e(0x24e)},'secondary_code':{'$first':_0x17b64e(0x21e)},'product_code':{'$first':_0x17b64e(0x237)},'storage':{'$first':_0x17b64e(0x26a)},'rack':{'$first':'$product_details.rack'}}}]);console['log']('stock_data',_0x1aef0a);let _0x1386ca;if(_0x3f544d['role']==_0x17b64e(0x1f0)){const _0x1e022b=await staff[_0x17b64e(0x21c)]({'email':_0x3f544d[_0x17b64e(0x281)]});_0x1386ca=await warehouse[_0x17b64e(0x23d)]({'status':'Enabled','name':_0x1e022b[_0x17b64e(0x2a5)],'warehouse_category':_0x17b64e(0x26d),'name':_0x17b64e(0x2bd)});}else _0x1386ca=await warehouse[_0x17b64e(0x1d0)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x17b64e(0x2bd)}},{'$group':{'_id':'$name','name':{'$first':_0x17b64e(0x21b)}}}]);if(_0x318288[0x0]['language']==_0x17b64e(0x1d4)){var _0x4ef5dd=users[_0x17b64e(0x29b)];console[_0x17b64e(0x2a4)](_0x4ef5dd);}else{if(_0x318288[0x0][_0x17b64e(0x245)]==_0x17b64e(0x2d6))var _0x4ef5dd=users['Hindi'];else{if(_0x318288[0x0][_0x17b64e(0x245)]=='German')var _0x4ef5dd=users[_0x17b64e(0x28f)];else{if(_0x318288[0x0][_0x17b64e(0x245)]==_0x17b64e(0x2b5))var _0x4ef5dd=users[_0x17b64e(0x2b5)];else{if(_0x318288[0x0][_0x17b64e(0x245)]==_0x17b64e(0x2cd))var _0x4ef5dd=users[_0x17b64e(0x2cd)];else{if(_0x318288[0x0][_0x17b64e(0x245)]==_0x17b64e(0x259))var _0x4ef5dd=users['Portuguese'];else{if(_0x318288[0x0][_0x17b64e(0x245)]==_0x17b64e(0x257))var _0x4ef5dd=users['Chinese'];else{if(_0x318288[0x0][_0x17b64e(0x245)]==_0x17b64e(0x1c1))var _0x4ef5dd=users[_0x17b64e(0x243)];}}}}}}}_0x18501b['render'](_0x17b64e(0x292),{'success':_0x4f8b59['flash'](_0x17b64e(0x233)),'errors':_0x4f8b59['flash']('errors'),'role':_0x3f544d,'profile':_0x2361f7,'user':_0x50efa6,'stock':_0x1aef0a,'master_shop':_0x318288,'product':_0x167e8f,'language':_0x4ef5dd,'warehouse':_0x1386ca});}catch(_0x3687fe){console[_0x17b64e(0x2a4)](_0x3687fe);}}),router[a0_0x192b41(0x273)](a0_0x192b41(0x21f),auth,async(_0x9c7612,_0x502244)=>{var _0x2ba20a=a0_0x192b41;try{const {invoice:_0x2bfb22,date:_0x367123,warehouse_name:_0x16caf6,Room_name:_0x12701b,product_name:_0x393b32,purchase_quantity:_0x687711,stocks:_0x4da949,return_qty:_0x5bde2b,note:_0x1caab,level:_0x4ffee1,isle:_0x17926a,pallet:_0x153eeb,to_warehouse_name:_0x4ed707,to_Room_name:_0x3714d1}=_0x9c7612[_0x2ba20a(0x1cd)],_0x49b2ff=await purchases_finished[_0x2ba20a(0x21c)]({'_id':_0x9c7612['params']['id']}),_0x5d8fbb=await warehouse['findOne']({'name':_0x16caf6,'room':_0x12701b,'warehouse_category':'Finished\x20Goods'});if(typeof _0x393b32==_0x2ba20a(0x2ed))var _0x667a13=[_0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x1d8)]],_0x2918f1=[_0x9c7612[_0x2ba20a(0x1cd)]['purchase_quantity']],_0x22aa09=[_0x9c7612['body'][_0x2ba20a(0x1fd)]],_0x79061a=[_0x9c7612[_0x2ba20a(0x1cd)]['return_qty']],_0x2de436=[_0x9c7612[_0x2ba20a(0x1cd)]['level']],_0x5c9d5d=[_0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x27a)]],_0x4499bf=[_0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x250)]],_0x2468e2=[_0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x20b)]];else var _0x667a13=[..._0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x1d8)]],_0x2918f1=[..._0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x2a3)]],_0x22aa09=[..._0x9c7612['body'][_0x2ba20a(0x1fd)]],_0x79061a=[..._0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x27f)]],_0x2de436=[..._0x9c7612[_0x2ba20a(0x1cd)]['level']],_0x5c9d5d=[..._0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x27a)]],_0x4499bf=[..._0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x250)]],_0x2468e2=[..._0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x20b)]];const _0x19334d=_0x667a13[_0x2ba20a(0x284)](_0x3d8a40=>{return _0x3d8a40={'product_name':_0x3d8a40};});_0x2918f1['forEach']((_0x1aaee9,_0x150318)=>{var _0x21f739=_0x2ba20a;_0x19334d[_0x150318][_0x21f739(0x2a3)]=_0x1aaee9;}),_0x22aa09[_0x2ba20a(0x1c0)]((_0x32d56d,_0x43ac6f)=>{var _0x1f8996=_0x2ba20a;_0x19334d[_0x43ac6f][_0x1f8996(0x294)]=_0x32d56d;}),_0x79061a['forEach']((_0x1e3758,_0x1780cc)=>{_0x19334d[_0x1780cc]['return_qty']=_0x1e3758;}),_0x2de436[_0x2ba20a(0x1c0)]((_0x5f91e2,_0x4fed4a)=>{var _0x3df1b4=_0x2ba20a;_0x19334d[_0x4fed4a][_0x3df1b4(0x2af)]=_0x5f91e2;}),_0x5c9d5d[_0x2ba20a(0x1c0)]((_0x2b27b7,_0x121f2f)=>{var _0x159659=_0x2ba20a;_0x19334d[_0x121f2f][_0x159659(0x24d)]=_0x2b27b7;}),_0x4499bf[_0x2ba20a(0x1c0)]((_0x3682f5,_0x37eef6)=>{var _0x5ee3ce=_0x2ba20a;_0x19334d[_0x37eef6][_0x5ee3ce(0x2cc)]=_0x3682f5;}),_0x2468e2[_0x2ba20a(0x1c0)]((_0x20874f,_0x1323d3)=>{var _0x9a4f58=_0x2ba20a;_0x19334d[_0x1323d3][_0x9a4f58(0x239)]=_0x20874f;}),_0x19334d[_0x2ba20a(0x1c0)](_0x4d76bd=>{var _0x2b8819=_0x2ba20a;console['log'](_0x4d76bd);const _0x4580ff=_0x5d8fbb['product_details'][_0x2b8819(0x284)](_0x17119f=>{var _0x459dc1=_0x2b8819;_0x17119f[_0x459dc1(0x1d8)]==_0x4d76bd['product_name']&&_0x17119f[_0x459dc1(0x2af)]==_0x4d76bd[_0x459dc1(0x2af)]&&(console[_0x459dc1(0x2a4)](parseInt(_0x17119f[_0x459dc1(0x1c8)])+_0x459dc1(0x289)+parseInt(_0x4d76bd[_0x459dc1(0x27f)])),_0x17119f['product_stock']=parseInt(_0x17119f[_0x459dc1(0x1c8)])-parseInt(_0x4d76bd['return_qty']));});}),await _0x5d8fbb['save']();var _0x43ff2d=0x0;_0x19334d[_0x2ba20a(0x1c0)](_0x12bcdb=>{var _0x2b6d5a=_0x2ba20a;(parseInt(_0x12bcdb[_0x2b6d5a(0x2a3)])<parseInt(_0x12bcdb[_0x2b6d5a(0x27f)])||parseInt(_0x12bcdb['stock_quantity'])<parseInt(_0x12bcdb[_0x2b6d5a(0x27f)]))&&_0x43ff2d++;});if(_0x43ff2d!=0x0)return _0x9c7612[_0x2ba20a(0x23b)](_0x2ba20a(0x2f5),_0x2ba20a(0x2eb)),_0x502244[_0x2ba20a(0x2c9)](_0x2ba20a(0x2d7));const _0x49f380=new purchases_return_finished({'invoice':_0x2bfb22,'suppliers':_0x9c7612[_0x2ba20a(0x1cd)]['suppliers'],'date':_0x367123,'warehouse_name':_0x16caf6,'return_product':_0x19334d,'note':_0x1caab,'room':_0x12701b,'to_warehouse_name':_0x4ed707,'to_room':_0x3714d1}),_0x14d67b=await _0x49f380[_0x2ba20a(0x1c5)](),_0x3403b9=await purchases_return_finished[_0x2ba20a(0x21c)]({'invoice':_0x2bfb22}),_0x572b1b=await warehouse['findOne']({'name':_0x4ed707,'room':_0x3714d1,'warehouse_category':_0x2ba20a(0x26d)});_0x3403b9[_0x2ba20a(0x224)][_0x2ba20a(0x1c0)](_0x302a9e=>{var _0x2b0efb=_0x2ba20a,_0x5182ea=0x0;const _0x1e4f86=_0x572b1b[_0x2b0efb(0x280)]['map'](_0x95f37d=>{var _0x55c073=_0x2b0efb;console[_0x55c073(0x2a4)](_0x95f37d[_0x55c073(0x1d8)]+'=='+_0x302a9e[_0x55c073(0x1d8)]+'&&'+_0x95f37d[_0x55c073(0x2af)]+'=='+_0x302a9e[_0x55c073(0x2af)]),_0x95f37d[_0x55c073(0x1d8)]==_0x302a9e[_0x55c073(0x1d8)]&&_0x95f37d[_0x55c073(0x2af)]==_0x302a9e[_0x55c073(0x2af)]&&(_0x95f37d[_0x55c073(0x1c8)]=parseInt(_0x95f37d[_0x55c073(0x1c8)])-parseInt(_0x302a9e[_0x55c073(0x27f)]),_0x5182ea++);});_0x5182ea=='0'&&(_0x572b1b[_0x2b0efb(0x280)]=_0x572b1b[_0x2b0efb(0x280)][_0x2b0efb(0x209)]({'product_name':_0x302a9e[_0x2b0efb(0x1d8)],'product_stock':_0x302a9e[_0x2b0efb(0x27f)],'primary_code':_0x302a9e[_0x2b0efb(0x2cc)],'secondary_code':_0x302a9e[_0x2b0efb(0x239)],'product_code':_0x302a9e[_0x2b0efb(0x24d)],'bay':_0x302a9e[_0x2b0efb(0x2af)],'maxProducts':0xf423f}));}),await _0x572b1b[_0x2ba20a(0x1c5)]();const _0x593846=await purchases_finished['findOne']({'invoice':_0x2bfb22});_0x593846['return_data']=_0x2ba20a(0x201);const _0x92a14d=await _0x593846[_0x2ba20a(0x1c5)](),_0x10e236=new s_payment_data({'invoice':_0x2bfb22,'suppliers':_0x9c7612[_0x2ba20a(0x1cd)][_0x2ba20a(0x28a)],'reason':_0x2ba20a(0x1e5)});await _0x10e236['save']();const _0x44dedb=await master_shop[_0x2ba20a(0x23d)](),_0x2c9895=await email_settings['findOne'](),_0x2f1582=await suppliers['findOne']({'name':_0x9c7612[_0x2ba20a(0x1cd)]['suppliers']});_0x44dedb[0x0][_0x2ba20a(0x2ee)]==0x1?(right_currency=_0x44dedb[0x0][_0x2ba20a(0x28c)],left_currency=''):(right_currency='',left_currency=_0x44dedb[0x0]['currency']);var _0x5b07fd=_0x667a13,_0x5c2a08=_0x79061a,_0x1d7217='',_0x122e8b;for(_0x122e8b in _0x5b07fd){_0x1d7217+=_0x2ba20a(0x2f0)+_0x2ba20a(0x205)+_0x5b07fd[_0x122e8b]+'</td>'+_0x2ba20a(0x205)+_0x5c2a08[_0x122e8b]+_0x2ba20a(0x1df)+_0x2ba20a(0x232);}let _0x2c3a39=nodemailer[_0x2ba20a(0x1cc)]({'service':_0x2ba20a(0x1c9),'auth':{'user':_0x2c9895[_0x2ba20a(0x281)],'pass':_0x2c9895[_0x2ba20a(0x2b0)]}}),_0x4335de={'from':_0x2c9895[_0x2ba20a(0x281)],'to':_0x2f1582['email'],'subject':_0x2ba20a(0x1ec),'attachments':[{'filename':_0x2ba20a(0x1d6),'path':__dirname+_0x2ba20a(0x1d5)+_0x2ba20a(0x2f2)+_0x44dedb[0x0][_0x2ba20a(0x1c2)],'cid':_0x2ba20a(0x283)}],'html':_0x2ba20a(0x260)+_0x2ba20a(0x266)+_0x2ba20a(0x2da)+'<div>'+_0x2ba20a(0x210)+_0x2ba20a(0x240)+_0x2ba20a(0x2ec)+'</div>'+_0x2ba20a(0x240)+'<h2>\x20'+_0x44dedb[0x0][_0x2ba20a(0x1d1)]+_0x2ba20a(0x2d5)+'</div>'+_0x2ba20a(0x2a2)+_0x2ba20a(0x1ff)+'<div>'+_0x2ba20a(0x246)+_0x2ba20a(0x20c)+_0x2bfb22+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2ba20a(0x20a)+_0x367123+'\x20'+_0x2ba20a(0x214)+_0x2ba20a(0x26b)+_0x2ba20a(0x2a2)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2ba20a(0x287)+_0x2ba20a(0x2f0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2ba20a(0x232)+_0x2ba20a(0x2d3)+_0x2ba20a(0x216)+'\x20'+_0x1d7217+'\x20'+_0x2ba20a(0x2c5)+'</table>'+_0x2ba20a(0x240)+'<strong>\x20Regards\x20</strong>'+_0x2ba20a(0x1fe)+_0x44dedb[0x0]['site_title']+_0x2ba20a(0x26b)+'</div>'+_0x2ba20a(0x2a2)+_0x2ba20a(0x1d2)};_0x2c3a39[_0x2ba20a(0x202)](_0x4335de,function(_0x3e89a9,_0x3095fc){var _0x3cc541=_0x2ba20a;_0x3e89a9?console['log'](_0x3cc541(0x2e3)):console[_0x3cc541(0x2a4)](_0x3cc541(0x1f5));}),_0x9c7612[_0x2ba20a(0x23b)](_0x2ba20a(0x233),_0x2ba20a(0x254)),_0x502244[_0x2ba20a(0x2c9)]('/all_purchases_finished/view');}catch(_0x521c91){_0x502244[_0x2ba20a(0x299)](0xc8)[_0x2ba20a(0x1fc)]({'message':_0x521c91[_0x2ba20a(0x25f)]});}}),router[a0_0x192b41(0x1e4)](a0_0x192b41(0x20d),auth,async(_0x18ba5d,_0xe5ad1a)=>{var _0x78a7fe=a0_0x192b41;try{const {username:_0x157271,email:_0x3a1e56,role:_0x36f19f}=_0x18ba5d[_0x78a7fe(0x2e8)],_0x4d1825=_0x18ba5d['user'],_0x4bf9e3=await profile[_0x78a7fe(0x21c)]({'email':_0x4d1825['email']}),_0x28b00d=await master_shop[_0x78a7fe(0x23d)](),_0x507f32=_0x18ba5d[_0x78a7fe(0x226)]['id'],_0x594c4b=await purchases_finished[_0x78a7fe(0x206)](_0x507f32);if(_0x28b00d[0x0][_0x78a7fe(0x245)]==_0x78a7fe(0x1d4))var _0x24a7d4=users[_0x78a7fe(0x29b)];else{if(_0x28b00d[0x0][_0x78a7fe(0x245)]==_0x78a7fe(0x2d6))var _0x24a7d4=users[_0x78a7fe(0x2d6)];else{if(_0x28b00d[0x0][_0x78a7fe(0x245)]==_0x78a7fe(0x28f))var _0x24a7d4=users[_0x78a7fe(0x28f)];else{if(_0x28b00d[0x0]['language']==_0x78a7fe(0x2b5))var _0x24a7d4=users['Spanish'];else{if(_0x28b00d[0x0]['language']==_0x78a7fe(0x2cd))var _0x24a7d4=users[_0x78a7fe(0x2cd)];else{if(_0x28b00d[0x0][_0x78a7fe(0x245)]==_0x78a7fe(0x259))var _0x24a7d4=users[_0x78a7fe(0x275)];else{if(_0x28b00d[0x0][_0x78a7fe(0x245)]=='Chinese')var _0x24a7d4=users[_0x78a7fe(0x257)];else{if(_0x28b00d[0x0][_0x78a7fe(0x245)]=='Arabic\x20(ae)')var _0x24a7d4=users[_0x78a7fe(0x243)];}}}}}}}_0xe5ad1a[_0x78a7fe(0x1e7)]('all_purchases_barcode',{'success':_0x18ba5d[_0x78a7fe(0x23b)](_0x78a7fe(0x233)),'errors':_0x18ba5d[_0x78a7fe(0x23b)](_0x78a7fe(0x2f5)),'role':_0x4d1825,'profile':_0x4bf9e3,'alldata':_0x594c4b,'master_shop':_0x28b00d,'language':_0x24a7d4}),console[_0x78a7fe(0x2a4)](alldata);}catch(_0x126f8a){console['log'](_0x126f8a);}}),router[a0_0x192b41(0x273)](a0_0x192b41(0x28b),async(_0x167453,_0x28f125)=>{var _0x40a383=a0_0x192b41;const {product_code:_0x28c8c1}=_0x167453[_0x40a383(0x1cd)];var _0x798153;const _0x39e7fc=await product[_0x40a383(0x1d0)]([{'$match':{'primary_code':_0x28c8c1}},{'$group':{'_id':_0x40a383(0x203),'name':{'$first':_0x40a383(0x21b)},'category':{'$first':_0x40a383(0x238)},'brand':{'$first':_0x40a383(0x27c)},'unit':{'$first':_0x40a383(0x219)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x40a383(0x253)},'primary_code':{'$first':_0x40a383(0x2b2)},'secondary_code':{'$first':_0x40a383(0x24c)},'maxStocks':{'$first':_0x40a383(0x1fb)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x40a383(0x278)},'gross_price':{'$first':_0x40a383(0x1be)},'sales_category':{'$first':_0x40a383(0x213)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x469304=await product[_0x40a383(0x1d0)]([{'$match':{'secondary_code':_0x28c8c1}},{'$group':{'_id':_0x40a383(0x203),'name':{'$first':'$name'},'category':{'$first':_0x40a383(0x238)},'brand':{'$first':_0x40a383(0x27c)},'unit':{'$first':_0x40a383(0x219)},'alertquantity':{'$first':_0x40a383(0x1c4)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x40a383(0x2b2)},'secondary_code':{'$first':_0x40a383(0x24c)},'maxStocks':{'$first':_0x40a383(0x1fb)},'maxProdPerUnit':{'$first':_0x40a383(0x222)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x40a383(0x278)},'gross_price':{'$first':_0x40a383(0x1be)},'sales_category':{'$first':_0x40a383(0x213)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x39e7fc['length']>0x0)_0x798153=_0x39e7fc;else _0x469304[_0x40a383(0x276)]>0x0&&(_0x798153=_0x469304);_0x28f125[_0x40a383(0x1fc)](_0x798153);}),router[a0_0x192b41(0x273)](a0_0x192b41(0x1f9),async(_0x286c39,_0x582ce6)=>{var _0x143228=a0_0x192b41;const {productCode:_0x1e4214,bay:_0x159945,warehouses:_0x1fefb3,room:_0x3f48fe}=_0x286c39[_0x143228(0x1cd)];console[_0x143228(0x2a4)](_0x286c39[_0x143228(0x1cd)]);try{const _0x1b8e72=await warehouse[_0x143228(0x1d0)]([{'$match':{'name':_0x1fefb3,'room':_0x3f48fe}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x159945)}},{'$group':{'_id':_0x143228(0x1da),'name':{'$first':_0x143228(0x268)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x143228(0x274)}}}]);_0x582ce6[_0x143228(0x299)](0xc8)[_0x143228(0x1fc)](_0x1b8e72);}catch(_0x28562d){_0x582ce6[_0x143228(0x299)](0x194)[_0x143228(0x1fc)]({'message':_0x28562d[_0x143228(0x25f)]});}}),router[a0_0x192b41(0x273)]('/barcode_scanner_logs',async(_0x3f3e30,_0x1fc0a2)=>{var _0x394f9d=a0_0x192b41;const {product_code:_0x129db4}=_0x3f3e30[_0x394f9d(0x1cd)];var _0x1efa9e;const _0xe3f136=await product[_0x394f9d(0x1d0)]([{'$match':{'primary_code':_0x129db4,'type_products':_0x394f9d(0x2a4)}},{'$group':{'_id':_0x394f9d(0x203),'name':{'$first':'$name'},'category':{'$first':_0x394f9d(0x238)},'brand':{'$first':_0x394f9d(0x27c)},'unit':{'$first':_0x394f9d(0x219)},'alertquantity':{'$first':_0x394f9d(0x1c4)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x394f9d(0x2b2)},'secondary_code':{'$first':_0x394f9d(0x24c)},'maxStocks':{'$first':_0x394f9d(0x1fb)},'maxProdPerUnit':{'$first':_0x394f9d(0x222)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x394f9d(0x278)},'gross_price':{'$first':_0x394f9d(0x1be)},'sales_category':{'$first':_0x394f9d(0x213)},'type_products':{'$first':_0x394f9d(0x291)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x394f9d(0x2a4)](_0xe3f136);const _0x2435dc=await product['aggregate']([{'$match':{'secondary_code':_0x129db4,'type_products':_0x394f9d(0x2a4)}},{'$group':{'_id':_0x394f9d(0x203),'name':{'$first':_0x394f9d(0x21b)},'category':{'$first':_0x394f9d(0x238)},'brand':{'$first':_0x394f9d(0x27c)},'unit':{'$first':_0x394f9d(0x219)},'alertquantity':{'$first':_0x394f9d(0x1c4)},'product_code':{'$first':_0x394f9d(0x253)},'primary_code':{'$first':_0x394f9d(0x2b2)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x394f9d(0x1fb)},'maxProdPerUnit':{'$first':_0x394f9d(0x222)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x394f9d(0x291)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0xe3f136[_0x394f9d(0x276)]>0x0)_0x1efa9e=_0xe3f136;else _0x2435dc[_0x394f9d(0x276)]>0x0&&(_0x1efa9e=_0x2435dc);_0x1fc0a2[_0x394f9d(0x1fc)](_0x1efa9e);}),module[a0_0x192b41(0x1bd)]=router;