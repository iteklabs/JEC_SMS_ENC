var a0_0xdfc6ce=a0_0x46de;(function(_0x173317,_0x3d7e42){var _0x2955c4=a0_0x46de,_0x5b2c64=_0x173317();while(!![]){try{var _0x3be807=parseInt(_0x2955c4(0x1fa))/0x1+-parseInt(_0x2955c4(0x1a1))/0x2+parseInt(_0x2955c4(0x2b5))/0x3*(parseInt(_0x2955c4(0x18d))/0x4)+-parseInt(_0x2955c4(0x290))/0x5+-parseInt(_0x2955c4(0x2ae))/0x6*(parseInt(_0x2955c4(0x28c))/0x7)+parseInt(_0x2955c4(0x269))/0x8*(-parseInt(_0x2955c4(0x1d5))/0x9)+parseInt(_0x2955c4(0x1c7))/0xa;if(_0x3be807===_0x3d7e42)break;else _0x5b2c64['push'](_0x5b2c64['shift']());}catch(_0x51b9cb){_0x5b2c64['push'](_0x5b2c64['shift']());}}}(a0_0x526c,0x9c82f));const express=require('express'),app=express(),router=express[a0_0xdfc6ce(0x230)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0xdfc6ce(0x26e)),auth=require('../middleware/auth'),nodemailer=require(a0_0xdfc6ce(0x259));var ejs=require('ejs');const path=require(a0_0xdfc6ce(0x1e1)),users=require(a0_0xdfc6ce(0x182)),{isNull}=require(a0_0xdfc6ce(0x23a));router[a0_0xdfc6ce(0x1d4)]('/incoming',auth,async(_0x8acbc3,_0x4c5a5f)=>{var _0x58279a=a0_0xdfc6ce;try{const {username:_0x4845b8,email:_0x18a2a7,role:_0x259d6f}=_0x8acbc3[_0x58279a(0x24b)],_0x5a3520=_0x8acbc3['user'],_0x581905=await profile['findOne']({'email':_0x5a3520[_0x58279a(0x1d0)]}),_0x21aa8e=await staff['findOne']({'email':_0x5a3520['email']}),_0x5a0f0d=await master_shop[_0x58279a(0x2a9)]();let _0x47268d=await transfers_finished[_0x58279a(0x27d)]([{'$match':{'to_warehouse':_0x21aa8e['warehouse']}}]);if(_0x5a0f0d[0x0]['language']==_0x58279a(0x258))var _0x3d14fe=users[_0x58279a(0x227)];else{if(_0x5a0f0d[0x0][_0x58279a(0x1e3)]=='Hindi')var _0x3d14fe=users[_0x58279a(0x23e)];else{if(_0x5a0f0d[0x0]['language']==_0x58279a(0x28f))var _0x3d14fe=users[_0x58279a(0x28f)];else{if(_0x5a0f0d[0x0][_0x58279a(0x1e3)]==_0x58279a(0x18b))var _0x3d14fe=users[_0x58279a(0x18b)];else{if(_0x5a0f0d[0x0]['language']==_0x58279a(0x254))var _0x3d14fe=users[_0x58279a(0x254)];else{if(_0x5a0f0d[0x0][_0x58279a(0x1e3)]=='Portuguese\x20(BR)')var _0x3d14fe=users[_0x58279a(0x29e)];else{if(_0x5a0f0d[0x0]['language']==_0x58279a(0x1b0))var _0x3d14fe=users[_0x58279a(0x1b0)];else{if(_0x5a0f0d[0x0][_0x58279a(0x1e3)]=='Arabic\x20(ae)')var _0x3d14fe=users[_0x58279a(0x17a)];}}}}}}}_0x4c5a5f[_0x58279a(0x20b)]('incoming_view',{'success':_0x8acbc3[_0x58279a(0x1e4)](_0x58279a(0x25a)),'errors':_0x8acbc3[_0x58279a(0x1e4)](_0x58279a(0x214)),'purchases':_0x47268d,'role':_0x5a3520,'profile':_0x581905,'master_shop':_0x5a0f0d,'language':_0x3d14fe,'staff_data':_0x21aa8e});}catch(_0x91c194){console[_0x58279a(0x1d1)](_0x58279a(0x1fd),_0x91c194),_0x4c5a5f['status'](0xc8)[_0x58279a(0x281)]({'message':_0x91c194[_0x58279a(0x1b1)]});}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x1fc),auth,async(_0x54a23d,_0x32f1ec)=>{var _0x260e02=a0_0xdfc6ce;try{const {username:_0x9c856e,email:_0x5acf5c,role:_0x5b906e}=_0x54a23d[_0x260e02(0x24b)],_0x1a6bd8=_0x54a23d[_0x260e02(0x24b)],_0x3713e9=await profile[_0x260e02(0x1b3)]({'email':_0x1a6bd8['email']}),_0x43651c=await staff[_0x260e02(0x1b3)]({'email':_0x1a6bd8[_0x260e02(0x1d0)]}),_0x47f867=await master_shop['find']();let _0x274097=await transfers_finished[_0x260e02(0x27d)]([{'$match':{'to_warehouse':_0x43651c[_0x260e02(0x1ca)],'to_recieved':'false'}}]);if(_0x47f867[0x0]['language']==_0x260e02(0x258))var _0x460e85=users[_0x260e02(0x227)];else{if(_0x47f867[0x0]['language']==_0x260e02(0x23e))var _0x460e85=users[_0x260e02(0x23e)];else{if(_0x47f867[0x0][_0x260e02(0x1e3)]==_0x260e02(0x28f))var _0x460e85=users[_0x260e02(0x28f)];else{if(_0x47f867[0x0]['language']==_0x260e02(0x18b))var _0x460e85=users['Spanish'];else{if(_0x47f867[0x0][_0x260e02(0x1e3)]==_0x260e02(0x254))var _0x460e85=users['French'];else{if(_0x47f867[0x0][_0x260e02(0x1e3)]==_0x260e02(0x1ff))var _0x460e85=users[_0x260e02(0x29e)];else{if(_0x47f867[0x0]['language']=='Chinese')var _0x460e85=users[_0x260e02(0x1b0)];else{if(_0x47f867[0x0][_0x260e02(0x1e3)]=='Arabic\x20(ae)')var _0x460e85=users[_0x260e02(0x17a)];}}}}}}}_0x32f1ec[_0x260e02(0x20b)](_0x260e02(0x1e0),{'success':_0x54a23d[_0x260e02(0x1e4)](_0x260e02(0x25a)),'errors':_0x54a23d[_0x260e02(0x1e4)](_0x260e02(0x214)),'purchases':_0x274097,'role':_0x1a6bd8,'profile':_0x3713e9,'master_shop':_0x47f867,'language':_0x460e85,'staff_data':_0x43651c});}catch(_0x63f761){console[_0x260e02(0x1d1)](_0x260e02(0x1fd),_0x63f761),_0x32f1ec[_0x260e02(0x1d9)](0xc8)[_0x260e02(0x281)]({'message':_0x63f761[_0x260e02(0x1b1)]});}});const createLog=async _0x3d99d3=>{var _0x55b88c=a0_0xdfc6ce;const _0x4c2c6a=new datalogs({'location':_0x3d99d3});return await _0x4c2c6a[_0x55b88c(0x25b)](),_0x4c2c6a['invoice_init'];};router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x1fc),auth,async(_0x33bd41,_0x476c1f)=>{var _0x4eb66b=a0_0xdfc6ce;try{const {invoice_trf_data:_0x5801b8,item_code:_0xd53782,SCRN:_0x58d1d5,ReqBy:_0x25abe3,type_of_products:_0x24b3b3,dateofreq:_0x2c359b,PO_number:_0x2df403,date:_0x10b32c,warehouse_name:_0x800e76,typeservicesData:_0x286ca3,typevehicle:_0x2a1cf6,driver:_0x1ff01e,plate:_0x57dddd,van:_0x225b31,DRSI:_0x4e9dd5,TSU:_0x5486e7,TFU:_0xaa273f,note:_0x137e59}=_0x33bd41[_0x4eb66b(0x178)],_0x15bdf1=await transfers_finished[_0x4eb66b(0x235)](_0x5801b8);if(typeof _0xd53782==_0x4eb66b(0x17c))var _0x2aa714=[_0x33bd41['body'][_0x4eb66b(0x241)]],_0x405447=[_0x33bd41[_0x4eb66b(0x178)]['item_code']],_0x850766=[_0x33bd41['body'][_0x4eb66b(0x20a)]],_0x3708cd=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x18c)]],_0x29a5c0=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x2b9)]],_0x91ae6f=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x293)]],_0x54d531=[_0x33bd41[_0x4eb66b(0x178)]['primary_code']],_0x485ef9=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x199)]],_0x596a15=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x24a)]],_0x595c7a=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x2a4)]],_0x3b520d=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x29d)]],_0x2aa71f=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x1d7)]],_0x450004=[_0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x2bc)]];else var _0x2aa714=[..._0x33bd41['body'][_0x4eb66b(0x241)]],_0x405447=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x27e)]],_0x850766=[..._0x33bd41['body'][_0x4eb66b(0x20a)]],_0x3708cd=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x18c)]],_0x29a5c0=[..._0x33bd41[_0x4eb66b(0x178)]['prod_secondunit']],_0x91ae6f=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x293)]],_0x54d531=[..._0x33bd41['body'][_0x4eb66b(0x181)]],_0x485ef9=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x199)]],_0x596a15=[..._0x33bd41[_0x4eb66b(0x178)]['batch_code']],_0x595c7a=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x2a4)]],_0x3b520d=[..._0x33bd41[_0x4eb66b(0x178)]['production_date']],_0x2aa71f=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x1d7)]],_0x450004=[..._0x33bd41[_0x4eb66b(0x178)][_0x4eb66b(0x2bc)]];const _0x3f2c71=_0x2aa714[_0x4eb66b(0x2af)](_0x5071c8=>{return _0x5071c8={'product_name':_0x5071c8};});_0x405447['forEach']((_0x28fe10,_0x1a1c3b)=>{_0x3f2c71[_0x1a1c3b]['product_code']=_0x28fe10;}),_0x850766[_0x4eb66b(0x2a6)]((_0x455c79,_0x4200ae)=>{var _0x31cce7=_0x4eb66b;_0x3f2c71[_0x4200ae][_0x31cce7(0x2b1)]=Math[_0x31cce7(0x257)](_0x455c79);}),_0x3708cd[_0x4eb66b(0x2a6)]((_0x47222f,_0x3929e7)=>{var _0x2b88ed=_0x4eb66b;_0x3f2c71[_0x3929e7][_0x2b88ed(0x21a)]=_0x47222f;}),_0x29a5c0[_0x4eb66b(0x2a6)]((_0xbce7bd,_0x40527c)=>{var _0xf042ee=_0x4eb66b;_0x3f2c71[_0x40527c][_0xf042ee(0x173)]=_0xbce7bd;}),_0x91ae6f[_0x4eb66b(0x2a6)]((_0x3a30d4,_0x335f00)=>{var _0x4bba10=_0x4eb66b,_0x431e16=_0x3a30d4[_0x4bba10(0x2b2)](/[A-Za-z]+/)[0x0],_0x406e69=parseInt(_0x3a30d4[_0x4bba10(0x2b2)](/\d+/)[0x0]);_0x3f2c71[_0x335f00]['level']=_0x431e16,_0x3f2c71[_0x335f00][_0x4bba10(0x209)]=_0x406e69;}),_0x54d531[_0x4eb66b(0x2a6)]((_0xfdf3a6,_0x48ff82)=>{_0x3f2c71[_0x48ff82]['primary_code']=_0xfdf3a6;}),_0x485ef9[_0x4eb66b(0x2a6)]((_0x41241f,_0x1d28d1)=>{_0x3f2c71[_0x1d28d1]['secondary_code']=_0x41241f;}),_0x596a15[_0x4eb66b(0x2a6)]((_0x47311c,_0x820547)=>{_0x3f2c71[_0x820547]['batch_code']=_0x47311c;}),_0x595c7a['forEach']((_0x1acf22,_0x5a1f39)=>{var _0x1295fc=_0x4eb66b;_0x3f2c71[_0x5a1f39][_0x1295fc(0x2a4)]=_0x1acf22;}),_0x3b520d['forEach']((_0x5d90ac,_0x19856c)=>{var _0x79b7d4=_0x4eb66b;_0x3f2c71[_0x19856c][_0x79b7d4(0x29d)]=_0x5d90ac;}),_0x2aa71f[_0x4eb66b(0x2a6)]((_0x21bc4b,_0x2430ad)=>{var _0x35563a=_0x4eb66b;_0x3f2c71[_0x2430ad][_0x35563a(0x217)]=_0x21bc4b;}),_0x450004[_0x4eb66b(0x2a6)]((_0x4bd202,_0x457716)=>{var _0xd33948=_0x4eb66b;_0x3f2c71[_0x457716][_0xd33948(0x206)]=_0x4bd202;});const _0x2a336e=await createLog(_0x4eb66b(0x225));_0x450004[_0x4eb66b(0x2a6)]((_0x581bf3,_0x2c68ac)=>{var _0x461918=_0x4eb66b;_0x3f2c71[_0x2c68ac][_0x461918(0x2b6)]=_0x461918(0x232)+_0x2a336e[_0x461918(0x29b)]()[_0x461918(0x19e)](0x8,'0');});const _0x23d35b=_0x3f2c71[_0x4eb66b(0x1ba)](_0x31a286=>_0x31a286[_0x4eb66b(0x2b1)]!=='0'&&_0x31a286[_0x4eb66b(0x2b1)]!==''),_0x392ddc=new purchases_incoming({'invoice':_0x4eb66b(0x232)+_0x2a336e['toString']()[_0x4eb66b(0x19e)](0x8,'0'),'date':_0x10b32c,'warehouse_name':_0x800e76,'product':_0x23d35b,'note':_0x137e59,'POnumber':_0x2df403,'SCRN':_0x58d1d5,'ReqBy':_0x25abe3,'dateofreq':_0x2c359b,'typeservicesData':_0x286ca3,'van':_0x225b31,'typevehicle':_0x2a1cf6,'driver':_0x1ff01e,'plate':_0x57dddd,'DRSI':_0x4e9dd5,'TSU':_0x5486e7,'TFU':_0xaa273f,'typeOfProducts':_0x24b3b3}),_0x59d1b9=await _0x392ddc[_0x4eb66b(0x25b)](),_0x2e32d7=_0x59d1b9[_0x4eb66b(0x26b)][_0x4eb66b(0x2af)](async _0x242444=>{var _0x38375b=_0x4eb66b,_0x489005=await warehouse[_0x38375b(0x1b3)]({'name':_0x800e76,'room':_0x242444[_0x38375b(0x206)]});if(_0x242444[_0x38375b(0x2b1)]>0x0){var _0x30c62c=0x0;const _0x251d0c=_0x489005[_0x38375b(0x25d)]['map'](_0x4df1ce=>{var _0x341f4a=_0x38375b;_0x4df1ce[_0x341f4a(0x241)]==_0x242444['product_name']&&_0x4df1ce['bay']==_0x242444[_0x341f4a(0x245)]&&_0x4df1ce[_0x341f4a(0x2a4)]==_0x242444[_0x341f4a(0x2a4)]&&_0x4df1ce[_0x341f4a(0x29d)]==_0x242444[_0x341f4a(0x29d)]&&_0x4df1ce['batch_code']==_0x242444['batch_code']&&_0x4df1ce['invoice']==_0x242444[_0x341f4a(0x2b6)]&&(typeof _0x242444[_0x341f4a(0x2a8)]=='undefined'?(console['log'](_0x341f4a(0x201),_0x4df1ce[_0x341f4a(0x26c)]+_0x341f4a(0x2a1)+_0x4df1ce[_0x341f4a(0x22b)]+'\x20<=>\x20'+Math[_0x341f4a(0x257)](_0x4df1ce[_0x341f4a(0x26c)])+Math['abs'](_0x242444[_0x341f4a(0x20a)])),_0x4df1ce[_0x341f4a(0x26c)]=Math[_0x341f4a(0x257)](_0x4df1ce[_0x341f4a(0x26c)])+Math[_0x341f4a(0x257)](_0x242444['quantity'])):(_0x4df1ce[_0x341f4a(0x26c)]=Math['abs'](_0x4df1ce[_0x341f4a(0x26c)])+Math[_0x341f4a(0x257)](_0x242444[_0x341f4a(0x2b1)]),_0x30c62c++));});_0x30c62c=='0'&&(_0x489005[_0x38375b(0x25d)]=_0x489005[_0x38375b(0x25d)][_0x38375b(0x24e)]({'product_name':_0x242444['product_name'],'product_stock':_0x242444['quantity'],'bay':_0x242444[_0x38375b(0x209)],'level':_0x242444['level'],'product_code':_0x242444[_0x38375b(0x24f)],'primary_code':_0x242444[_0x38375b(0x181)],'secondary_code':_0x242444[_0x38375b(0x199)],'expiry_date':_0x242444['expiry_date'],'production_date':_0x242444[_0x38375b(0x29d)],'maxProducts':_0x242444[_0x38375b(0x272)],'batch_code':_0x242444['batch_code'],'secondary_unit':_0x242444['secondary_unit'],'unit':_0x242444[_0x38375b(0x21a)],'maxProducts':_0x242444[_0x38375b(0x272)],'maxPerUnit':_0x242444[_0x38375b(0x2a0)],'invoice':_0x242444['invoice']}));}return _0x489005;});Promise[_0x4eb66b(0x1c2)](_0x2e32d7)[_0x4eb66b(0x1aa)](async _0x4f8d3c=>{var _0x1ce5d3=_0x4eb66b;try{for(const _0x99680a of _0x4f8d3c){await warehouse[_0x1ce5d3(0x221)]({'_id':_0x99680a[_0x1ce5d3(0x22b)]},{'$addToSet':{'product_details':{'$each':_0x99680a[_0x1ce5d3(0x25d)]}}});}_0x15bdf1[_0x1ce5d3(0x1b9)]=_0x1ce5d3(0x25f);const _0x3655e1=await _0x15bdf1['save'](),_0x3c37c0=await master_shop[_0x1ce5d3(0x2a9)](),_0x5f4839=await email_settings[_0x1ce5d3(0x1b3)](),_0x5938b4=await supervisor_settings[_0x1ce5d3(0x2a9)]();var _0x2e2105=_0x392ddc[_0x1ce5d3(0x26b)],_0x441fe2='',_0x11f00d;for(_0x11f00d in _0x2e2105){var _0x3a59ea='FG';_0x392ddc[_0x1ce5d3(0x2b8)]=='DRY\x20GOODS'&&(_0x3a59ea='DG'),_0x441fe2+='<tr>'+_0x1ce5d3(0x1d3)+_0x2e2105[_0x11f00d]['product_name']+_0x1ce5d3(0x276)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e2105[_0x11f00d][_0x1ce5d3(0x24f)]+'</td>'+_0x1ce5d3(0x1d3)+_0x2e2105[_0x11f00d][_0x1ce5d3(0x20a)]+_0x1ce5d3(0x276)+_0x1ce5d3(0x1d3)+_0x2e2105[_0x11f00d][_0x1ce5d3(0x18c)]+_0x1ce5d3(0x276)+_0x1ce5d3(0x1d3)+_0x2e2105[_0x11f00d][_0x1ce5d3(0x173)]+'</td>'+_0x1ce5d3(0x1d3)+_0x392ddc[_0x1ce5d3(0x2b8)]+_0x1ce5d3(0x276)+_0x1ce5d3(0x1d3)+_0x2e2105[_0x11f00d]['to_room_name']+_0x1ce5d3(0x276)+_0x1ce5d3(0x1d3)+_0x3a59ea+_0x2e2105[_0x11f00d]['to_bay']+_0x1ce5d3(0x276)+_0x1ce5d3(0x170);}_0x33bd41[_0x1ce5d3(0x1e4)](_0x1ce5d3(0x25a),_0x1ce5d3(0x210)),_0x476c1f[_0x1ce5d3(0x1f2)](_0x1ce5d3(0x196)+_0x59d1b9[_0x1ce5d3(0x22b)]);}catch(_0x79e22d){console[_0x1ce5d3(0x296)](_0x79e22d),_0x476c1f['status'](0x1f4)['json']({'error':_0x1ce5d3(0x17b)});}})['catch'](_0x4d652b=>{var _0x2d6c3a=_0x4eb66b;console[_0x2d6c3a(0x296)](_0x4d652b),_0x476c1f[_0x2d6c3a(0x1d9)](0x1f4)[_0x2d6c3a(0x281)]({'error':'An\x20error\x20occurred.'});});}catch(_0x1998bb){}}),router['post'](a0_0xdfc6ce(0x239),auth,async(_0xb996a1,_0x82b13d)=>{var _0x3fa371=a0_0xdfc6ce;try{const {warehouse:_0x1f46b5}=_0xb996a1[_0x3fa371(0x178)],_0xd6aa78=await transfers_finished[_0x3fa371(0x2a9)]({'to_warehouse':_0x1f46b5,'to_recieved':_0x3fa371(0x21d)});_0x82b13d['json'](_0xd6aa78);}catch(_0x283789){}}),router['post'](a0_0xdfc6ce(0x219),auth,async(_0x1a6f7f,_0x2900ab)=>{var _0x376a50=a0_0xdfc6ce;try{const {invoice:_0x45b9bd}=_0x1a6f7f['body'],_0x17cacb=await transfers_finished[_0x376a50(0x2a9)]({'_id':_0x45b9bd,'to_recieved':_0x376a50(0x21d)});_0x2900ab[_0x376a50(0x281)](_0x17cacb);}catch(_0x40d39b){}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x1d6),auth,async(_0x3b4e93,_0xa83fd0)=>{var _0x4a9319=a0_0xdfc6ce;try{const {username:_0x140ec6,email:_0x1a1053,role:_0xb2b1dd}=_0x3b4e93[_0x4a9319(0x24b)],_0x467ed1=_0x3b4e93['user'],_0x146f80=await profile[_0x4a9319(0x1b3)]({'email':_0x467ed1[_0x4a9319(0x1d0)]}),_0x1be40b=await staff[_0x4a9319(0x1b3)]({'email':_0x467ed1[_0x4a9319(0x1d0)]});if(_0x467ed1[_0x4a9319(0x184)]=='staff'){const _0x35fbb7=await staff['findOne']({'email':_0x467ed1['email']});}const _0x436e1c=await master_shop[_0x4a9319(0x2a9)]();let _0x3ec89a;if(_0x467ed1['role']=='staff'){const _0x29248b=await staff[_0x4a9319(0x1b3)]({'email':_0x467ed1['email']});_0x3ec89a=await purchases_finished[_0x4a9319(0x27d)]([{'$match':{'warehouse_name':_0x29248b[_0x4a9319(0x1ca)],'typeOfProducts':'own'}},{'$lookup':{'from':'suppliers','localField':_0x4a9319(0x17e),'foreignField':_0x4a9319(0x1b2),'as':_0x4a9319(0x264)}},{'$unwind':_0x4a9319(0x20e)},{'$unwind':_0x4a9319(0x16c)},{'$group':{'_id':_0x4a9319(0x250),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4a9319(0x279)},'date':{'$first':_0x4a9319(0x1ce)},'warehouse_name':{'$first':_0x4a9319(0x1ee)},'room':{'$first':_0x4a9319(0x246)},'product':{'$push':'$product'},'note':{'$first':_0x4a9319(0x244)},'paid_amount':{'$first':_0x4a9319(0x1e9)},'due_amount':{'$first':_0x4a9319(0x298)},'return_data':{'$first':_0x4a9319(0x22d)},'batch_code':{'$first':_0x4a9319(0x18f)},'expiry_date':{'$first':_0x4a9319(0x1be)},'suppliers_docs':{'$first':_0x4a9319(0x20e)},'total_product_quantity':{'$sum':_0x4a9319(0x189)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4a9319(0x1c4)},'floorlevel':{'$addToSet':_0x4a9319(0x1a0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3ec89a=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x4a9319(0x22a)}},{'$unwind':_0x4a9319(0x16c)},{'$group':{'_id':_0x4a9319(0x250),'invoice':{'$first':_0x4a9319(0x1ec)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4a9319(0x1ce)},'warehouse_name':{'$first':_0x4a9319(0x1ee)},'room':{'$addToSet':_0x4a9319(0x236)},'product':{'$push':_0x4a9319(0x16c)},'note':{'$first':_0x4a9319(0x244)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4a9319(0x22d)},'batch_code':{'$first':_0x4a9319(0x18f)},'expiry_date':{'$first':_0x4a9319(0x1be)},'suppliers_docs':{'$first':_0x4a9319(0x20e)},'total_product_quantity':{'$sum':_0x4a9319(0x189)},'level':{'$addToSet':_0x4a9319(0x285)},'isle':{'$addToSet':_0x4a9319(0x1f8)},'type':{'$addToSet':_0x4a9319(0x1c4)},'floorlevel':{'$addToSet':_0x4a9319(0x1a0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x436e1c[0x0][_0x4a9319(0x1e3)]==_0x4a9319(0x258))var _0xb9d0f9=users[_0x4a9319(0x227)];else{if(_0x436e1c[0x0]['language']==_0x4a9319(0x23e))var _0xb9d0f9=users[_0x4a9319(0x23e)];else{if(_0x436e1c[0x0][_0x4a9319(0x1e3)]==_0x4a9319(0x28f))var _0xb9d0f9=users['German'];else{if(_0x436e1c[0x0][_0x4a9319(0x1e3)]==_0x4a9319(0x18b))var _0xb9d0f9=users[_0x4a9319(0x18b)];else{if(_0x436e1c[0x0][_0x4a9319(0x1e3)]==_0x4a9319(0x254))var _0xb9d0f9=users[_0x4a9319(0x254)];else{if(_0x436e1c[0x0][_0x4a9319(0x1e3)]=='Portuguese\x20(BR)')var _0xb9d0f9=users[_0x4a9319(0x29e)];else{if(_0x436e1c[0x0][_0x4a9319(0x1e3)]==_0x4a9319(0x1b0))var _0xb9d0f9=users[_0x4a9319(0x1b0)];else{if(_0x436e1c[0x0][_0x4a9319(0x1e3)]==_0x4a9319(0x292))var _0xb9d0f9=users['Arabic'];}}}}}}}_0xa83fd0['render'](_0x4a9319(0x24c),{'success':_0x3b4e93[_0x4a9319(0x1e4)](_0x4a9319(0x25a)),'errors':_0x3b4e93[_0x4a9319(0x1e4)]('errors'),'purchases':_0x3ec89a,'role':_0x467ed1,'profile':_0x146f80,'master_shop':_0x436e1c,'language':_0xb9d0f9});}catch(_0x179c26){console[_0x4a9319(0x1d1)]('table\x20page',_0x179c26),_0xa83fd0[_0x4a9319(0x1d9)](0xc8)[_0x4a9319(0x281)]({'message':_0x179c26['message']});}}),router['get'](a0_0xdfc6ce(0x18e),auth,async(_0x3a2e80,_0x3bf24b)=>{var _0x4108ca=a0_0xdfc6ce;try{const {username:_0x1c6785,email:_0x4a4e46,role:_0x33e1ea}=_0x3a2e80[_0x4108ca(0x24b)],_0x20c04e=_0x3a2e80[_0x4108ca(0x24b)],_0xc2bbd4=await profile[_0x4108ca(0x1b3)]({'email':_0x20c04e[_0x4108ca(0x1d0)]}),_0x2b6fb4=await staff[_0x4108ca(0x1b3)]({'email':_0x20c04e[_0x4108ca(0x1d0)]});if(_0x20c04e[_0x4108ca(0x184)]==_0x4108ca(0x21e)){const _0x1cf3f9=await staff[_0x4108ca(0x1b3)]({'email':_0x20c04e[_0x4108ca(0x1d0)]});}const _0x293482=await master_shop[_0x4108ca(0x2a9)]();let _0x4a1a1d;if(_0x20c04e[_0x4108ca(0x184)]=='staff'){const _0x4aebba=await staff['findOne']({'email':_0x20c04e[_0x4108ca(0x1d0)]});_0x4a1a1d=await purchases_finished[_0x4108ca(0x27d)]([{'$match':{'warehouse_name':_0x4aebba[_0x4108ca(0x1ca)]}},{'$lookup':{'from':_0x4108ca(0x17e),'localField':_0x4108ca(0x17e),'foreignField':_0x4108ca(0x1b2),'as':_0x4108ca(0x264)}},{'$unwind':_0x4108ca(0x20e)},{'$unwind':_0x4108ca(0x16c)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4108ca(0x1ec)},'suppliers':{'$first':_0x4108ca(0x279)},'date':{'$first':_0x4108ca(0x1ce)},'warehouse_name':{'$first':_0x4108ca(0x1ee)},'room':{'$first':_0x4108ca(0x246)},'product':{'$push':_0x4108ca(0x16c)},'note':{'$first':_0x4108ca(0x244)},'paid_amount':{'$first':_0x4108ca(0x1e9)},'due_amount':{'$first':_0x4108ca(0x298)},'return_data':{'$first':_0x4108ca(0x22d)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x4108ca(0x1be)},'suppliers_docs':{'$first':_0x4108ca(0x20e)},'total_product_quantity':{'$sum':_0x4108ca(0x189)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4108ca(0x1c4)},'floorlevel':{'$addToSet':_0x4108ca(0x1a0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4a1a1d=await purchases_finished[_0x4108ca(0x27d)]([{'$match':{'typeOfProducts':_0x4108ca(0x172)}},{'$unwind':_0x4108ca(0x16c)},{'$group':{'_id':_0x4108ca(0x250),'invoice':{'$first':_0x4108ca(0x1ec)},'suppliers':{'$first':_0x4108ca(0x279)},'date':{'$first':_0x4108ca(0x1ce)},'warehouse_name':{'$first':_0x4108ca(0x1ee)},'room':{'$addToSet':_0x4108ca(0x236)},'product':{'$push':'$product'},'note':{'$first':_0x4108ca(0x244)},'paid_amount':{'$first':_0x4108ca(0x1e9)},'due_amount':{'$first':_0x4108ca(0x298)},'return_data':{'$first':_0x4108ca(0x22d)},'batch_code':{'$first':_0x4108ca(0x18f)},'expiry_date':{'$first':_0x4108ca(0x1be)},'suppliers_docs':{'$first':_0x4108ca(0x20e)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4108ca(0x285)},'isle':{'$addToSet':_0x4108ca(0x1f8)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x4108ca(0x1a0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x293482[0x0]['language']=='English\x20(US)')var _0x118907=users['English'];else{if(_0x293482[0x0]['language']==_0x4108ca(0x23e))var _0x118907=users[_0x4108ca(0x23e)];else{if(_0x293482[0x0][_0x4108ca(0x1e3)]==_0x4108ca(0x28f))var _0x118907=users[_0x4108ca(0x28f)];else{if(_0x293482[0x0][_0x4108ca(0x1e3)]=='Spanish')var _0x118907=users['Spanish'];else{if(_0x293482[0x0]['language']==_0x4108ca(0x254))var _0x118907=users[_0x4108ca(0x254)];else{if(_0x293482[0x0][_0x4108ca(0x1e3)]==_0x4108ca(0x1ff))var _0x118907=users[_0x4108ca(0x29e)];else{if(_0x293482[0x0][_0x4108ca(0x1e3)]==_0x4108ca(0x1b0))var _0x118907=users[_0x4108ca(0x1b0)];else{if(_0x293482[0x0][_0x4108ca(0x1e3)]==_0x4108ca(0x292))var _0x118907=users[_0x4108ca(0x17a)];}}}}}}}_0x3bf24b['render'](_0x4108ca(0x2b0),{'success':_0x3a2e80[_0x4108ca(0x1e4)](_0x4108ca(0x25a)),'errors':_0x3a2e80[_0x4108ca(0x1e4)](_0x4108ca(0x214)),'purchases':_0x4a1a1d,'role':_0x20c04e,'profile':_0xc2bbd4,'master_shop':_0x293482,'language':_0x118907});}catch(_0x7e3ff9){console[_0x4108ca(0x1d1)](_0x4108ca(0x1fd),_0x7e3ff9),_0x3bf24b[_0x4108ca(0x1d9)](0xc8)['json']({'message':_0x7e3ff9[_0x4108ca(0x1b1)]});}});function BayBinSelected(_0x443c49,_0x58a785){var _0x41ec48=a0_0xdfc6ce,_0x307f07=[],_0x50718a=[];if(_0x443c49==_0x41ec48(0x23f)){switch(_0x58a785){case _0x41ec48(0x240):_0x307f07=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x41ec48(0x198):_0x307f07=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x50718a=['DG'];}else{if(_0x443c49==_0x41ec48(0x194)){switch(_0x58a785){case _0x41ec48(0x240):_0x307f07=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x41ec48(0x198):_0x307f07=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x50718a=['FG'];}}return{'levels':_0x307f07,'identify':_0x50718a};}async function getRandom8DigitNumber(){var _0xfebc82=a0_0xdfc6ce;const _0x168e29=0x989680,_0x4b4d7f=0x5f5e0ff,_0x11c768=Math[_0xfebc82(0x267)](Math[_0xfebc82(0x1c5)]()*(_0x4b4d7f-_0x168e29+0x1))+_0x168e29;var _0x44d9b1;const _0x36ac47=await purchases_finished[_0xfebc82(0x1b3)]({'invoice':_0xfebc82(0x1a4)+_0x11c768});return _0x36ac47&&_0x36ac47['length']>0x0?_0x44d9b1=_0xfebc82(0x1a4)+_0x11c768:_0x44d9b1=_0xfebc82(0x1a4)+_0x11c768,_0x44d9b1;}router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x23c),auth,async(_0x14f2b5,_0x423b74)=>{var _0x144edc=a0_0xdfc6ce;try{const {username:_0x2924d4,email:_0x277a03,role:_0x41f364}=_0x14f2b5[_0x144edc(0x24b)],_0x351dd0=_0x14f2b5[_0x144edc(0x24b)],_0x58e56e=await profile[_0x144edc(0x1b3)]({'email':_0x351dd0[_0x144edc(0x1d0)]}),_0x3e2d66=await master_shop[_0x144edc(0x2a9)](),_0x47a4d4=await staff[_0x144edc(0x1b3)]({'email':_0x351dd0[_0x144edc(0x1d0)]}),_0x1d880d=await suppliers[_0x144edc(0x2a9)]({});let _0x132db1;if(_0x351dd0[_0x144edc(0x184)]==_0x144edc(0x21e)){const _0x8c2e2d=await staff[_0x144edc(0x1b3)]({'email':_0x351dd0[_0x144edc(0x1d0)]});_0x132db1=await warehouse[_0x144edc(0x27d)]([{'$match':{'status':_0x144edc(0x226),'name':_0x8c2e2d[_0x144edc(0x1ca)]}},{'$group':{'_id':_0x144edc(0x1ad),'name':{'$first':'$name'}}}]);}else _0x132db1=await warehouse[_0x144edc(0x27d)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x144edc(0x1ad)}}}]);const _0x1c1ee8=await product['find']({}),_0x596034=await warehouse[_0x144edc(0x2a9)]({'status':'Enabled'}),_0x339d89=await purchases_finished['find']({}),_0x2cf887=_0x339d89[_0x144edc(0x223)]+0x1,_0x32422b=_0x144edc(0x1a4)+_0x2cf887[_0x144edc(0x29b)]()['padStart'](0x5,'0');var _0x66e0f8=['Ambient',_0x144edc(0x28d)];if(_0x3e2d66[0x0]['language']==_0x144edc(0x258))var _0x3e77b9=users[_0x144edc(0x227)];else{if(_0x3e2d66[0x0][_0x144edc(0x1e3)]=='Hindi')var _0x3e77b9=users[_0x144edc(0x23e)];else{if(_0x3e2d66[0x0][_0x144edc(0x1e3)]=='German')var _0x3e77b9=users[_0x144edc(0x28f)];else{if(_0x3e2d66[0x0]['language']==_0x144edc(0x18b))var _0x3e77b9=users[_0x144edc(0x18b)];else{if(_0x3e2d66[0x0]['language']==_0x144edc(0x254))var _0x3e77b9=users[_0x144edc(0x254)];else{if(_0x3e2d66[0x0][_0x144edc(0x1e3)]=='Portuguese\x20(BR)')var _0x3e77b9=users['Portuguese'];else{if(_0x3e2d66[0x0][_0x144edc(0x1e3)]==_0x144edc(0x1b0))var _0x3e77b9=users['Chinese'];else{if(_0x3e2d66[0x0][_0x144edc(0x1e3)]==_0x144edc(0x292))var _0x3e77b9=users[_0x144edc(0x17a)];}}}}}}}const _0x3613a0=getRandom8DigitNumber(),_0x49d43f=new Date(),_0x5621e5={'year':_0x144edc(0x274),'month':'2-digit','day':_0x144edc(0x1eb),'timeZone':_0x144edc(0x1f7)},_0x15e247=_0x49d43f[_0x144edc(0x271)]('en-CA',_0x5621e5);console['log'](_0x15e247),_0x3613a0[_0x144edc(0x1aa)](_0x13d73d=>{var _0x5d3c25=_0x144edc;_0x423b74[_0x5d3c25(0x20b)](_0x5d3c25(0x229),{'success':_0x14f2b5[_0x5d3c25(0x1e4)]('success'),'errors':_0x14f2b5[_0x5d3c25(0x1e4)](_0x5d3c25(0x214)),'role':_0x351dd0,'profile':_0x58e56e,'suppliers':_0x1d880d,'warehouse':_0x132db1,'product':_0x1c1ee8,'invoice':_0x13d73d,'master_shop':_0x3e2d66,'language':_0x3e77b9,'find_data':_0x596034,'rooms_data':_0x66e0f8,'formattedDate':_0x15e247});})[_0x144edc(0x177)](_0x3e7d43=>{var _0x33c52c=_0x144edc;_0x14f2b5[_0x33c52c(0x1e4)]('errors',_0x33c52c(0x249)),_0x423b74[_0x33c52c(0x1f2)](_0x33c52c(0x1fb));});}catch(_0x189329){console['log'](_0x189329);}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x1a5),auth,async(_0x8a7f53,_0x1445a0)=>{var _0x2a96d2=a0_0xdfc6ce;try{const {username:_0x1d5b53,email:_0x1e4beb,role:_0x6178a9}=_0x8a7f53[_0x2a96d2(0x24b)],_0x3894e8=_0x8a7f53[_0x2a96d2(0x24b)],_0xa09bc4=await profile[_0x2a96d2(0x1b3)]({'email':_0x3894e8[_0x2a96d2(0x1d0)]}),_0x22d7e0=await master_shop[_0x2a96d2(0x2a9)](),_0xe71fcc=await staff[_0x2a96d2(0x1b3)]({'email':_0x3894e8[_0x2a96d2(0x1d0)]}),_0x573ca4=await suppliers[_0x2a96d2(0x2a9)]({});let _0x2be521;if(_0x3894e8[_0x2a96d2(0x184)]=='staff'){const _0x1a01d8=await staff[_0x2a96d2(0x1b3)]({'email':_0x3894e8[_0x2a96d2(0x1d0)]});_0x2be521=await warehouse[_0x2a96d2(0x27d)]([{'$match':{'status':_0x2a96d2(0x226),'name':_0x1a01d8[_0x2a96d2(0x1ca)]}},{'$group':{'_id':'$name','name':{'$first':_0x2a96d2(0x1ad)}}}]);}else _0x2be521=await warehouse['aggregate']([{'$match':{'status':_0x2a96d2(0x226)}},{'$group':{'_id':_0x2a96d2(0x1ad),'name':{'$first':_0x2a96d2(0x1ad)}}}]);const _0x847f2e=await product[_0x2a96d2(0x2a9)]({}),_0x5342bd=await warehouse[_0x2a96d2(0x2a9)]({'status':_0x2a96d2(0x226)}),_0x2af18b=await purchases_finished[_0x2a96d2(0x2a9)]({}),_0x48cfc5=_0x2af18b[_0x2a96d2(0x223)]+0x1,_0x5b851f=_0x2a96d2(0x1a4)+_0x48cfc5[_0x2a96d2(0x29b)]()[_0x2a96d2(0x19e)](0x5,'0');var _0x10c03a=[_0x2a96d2(0x2ab),_0x2a96d2(0x28d)];if(_0x22d7e0[0x0][_0x2a96d2(0x1e3)]==_0x2a96d2(0x258))var _0x548464=users[_0x2a96d2(0x227)];else{if(_0x22d7e0[0x0]['language']==_0x2a96d2(0x23e))var _0x548464=users['Hindi'];else{if(_0x22d7e0[0x0][_0x2a96d2(0x1e3)]==_0x2a96d2(0x28f))var _0x548464=users[_0x2a96d2(0x28f)];else{if(_0x22d7e0[0x0]['language']=='Spanish')var _0x548464=users[_0x2a96d2(0x18b)];else{if(_0x22d7e0[0x0]['language']==_0x2a96d2(0x254))var _0x548464=users[_0x2a96d2(0x254)];else{if(_0x22d7e0[0x0][_0x2a96d2(0x1e3)]==_0x2a96d2(0x1ff))var _0x548464=users[_0x2a96d2(0x29e)];else{if(_0x22d7e0[0x0][_0x2a96d2(0x1e3)]=='Chinese')var _0x548464=users[_0x2a96d2(0x1b0)];else{if(_0x22d7e0[0x0]['language']==_0x2a96d2(0x292))var _0x548464=users[_0x2a96d2(0x17a)];}}}}}}}const _0x12810b=getRandom8DigitNumber();_0x12810b[_0x2a96d2(0x1aa)](_0x27ed5f=>{var _0x2aede6=_0x2a96d2;_0x1445a0[_0x2aede6(0x20b)](_0x2aede6(0x25e),{'success':_0x8a7f53[_0x2aede6(0x1e4)](_0x2aede6(0x25a)),'errors':_0x8a7f53[_0x2aede6(0x1e4)](_0x2aede6(0x214)),'role':_0x3894e8,'profile':_0xa09bc4,'suppliers':_0x573ca4,'warehouse':_0x2be521,'product':_0x847f2e,'invoice':_0x27ed5f,'master_shop':_0x22d7e0,'language':_0x548464,'find_data':_0x5342bd,'rooms_data':_0x10c03a});})['catch'](_0x4fd27e=>{var _0x554688=_0x2a96d2;_0x8a7f53[_0x554688(0x1e4)](_0x554688(0x214),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1445a0[_0x554688(0x1f2)](_0x554688(0x1fb));});}catch(_0x39ddb0){console['log'](_0x39ddb0);}}),router['get']('/view/add_purchases/:id',auth,async(_0x400e23,_0x42f74a)=>{var _0x3760cf=a0_0xdfc6ce;try{const _0x3dec18=_0x400e23[_0x3760cf(0x16e)]['id'];console[_0x3760cf(0x1d1)](_0x3dec18);const _0x562912=await master_shop[_0x3760cf(0x2a9)]();console[_0x3760cf(0x1d1)](_0x3760cf(0x179),_0x562912);const _0x2c0be3=await product[_0x3760cf(0x1b3)]({'name':_0x3dec18});console[_0x3760cf(0x1d1)](_0x3760cf(0x26b),_0x2c0be3),_0x42f74a['status'](0xc8)[_0x3760cf(0x281)]({'product_data':_0x2c0be3,'master':_0x562912});}catch(_0x5e968b){console['log'](_0x3760cf(0x215),_0x5e968b);}}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x23c),auth,async(_0x4cf232,_0x35e6d9)=>{var _0x3bef2f=a0_0xdfc6ce;try{const {invoice:_0x2e0f73,date:_0x5df255,warehouse_name:_0x550678,prod_name:_0x27ff0a,note:_0x349a35,due_amount:_0x230cae,Room_name:_0x22ea40,PO_number:_0x2a574c,SCRN:_0x5b5f73,ReqBy:_0x203385,dateofreq:_0x3203c0,suppliers:_0x16004c,typeservicesData:_0x59a085,van:_0x153e4a,typevehicle:_0x284a75,driver:_0x503a77,plate:_0x16b26f,DRSI:_0x2ec19b,TSU:_0x11a22d,TFU:_0x3a98bf,JO_number:_0x3458fc,type_of_products:_0x10c2d0}=_0x4cf232[_0x3bef2f(0x178)];if(typeof _0x27ff0a=='string')var _0x3f0509=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2bb)]],_0x5b46de=[_0x4cf232[_0x3bef2f(0x178)]['prod_code']],_0x2e150f=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x1b8)]],_0x37f13b=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x16f)]],_0x169df9=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2b9)]],_0x46f5d6=[_0x4cf232[_0x3bef2f(0x178)]['primary_code']],_0x80e8a9=[_0x4cf232[_0x3bef2f(0x178)]['secondary_code']],_0x4b37ab=[_0x4cf232[_0x3bef2f(0x178)]['MaxStocks_data']],_0xd5f48b=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x24a)]],_0x2ecd49=[_0x4cf232['body'][_0x3bef2f(0x2a4)]],_0xf1f6b7=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x200)]],_0x3b5ced=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x1d7)]],_0x1dcd07=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x204)]],_0x38a2ab=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2ad)]],_0x531d95=[_0x4cf232[_0x3bef2f(0x178)]['uuid']],_0x5bcec6=[_0x4cf232[_0x3bef2f(0x178)]['sales_data_cateory']],_0x4a26bc=[_0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x28b)]];else var _0x3f0509=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2bb)]],_0x5b46de=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x222)]],_0x2e150f=[..._0x4cf232['body'][_0x3bef2f(0x1b8)]],_0x37f13b=[..._0x4cf232[_0x3bef2f(0x178)]['prod_primunit']],_0x169df9=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2b9)]],_0x46f5d6=[..._0x4cf232[_0x3bef2f(0x178)]['primary_code']],_0x80e8a9=[..._0x4cf232['body']['secondary_code']],_0x4b37ab=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x22c)]],_0xd5f48b=[..._0x4cf232['body'][_0x3bef2f(0x24a)]],_0x2ecd49=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2a4)]],_0xf1f6b7=[..._0x4cf232[_0x3bef2f(0x178)]['product_date']],_0x3b5ced=[..._0x4cf232[_0x3bef2f(0x178)]['max_product_unit']],_0x1dcd07=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x204)]],_0x38a2ab=[..._0x4cf232[_0x3bef2f(0x178)][_0x3bef2f(0x2ad)]],_0x531d95=[..._0x4cf232['body'][_0x3bef2f(0x2aa)]],_0x5bcec6=[..._0x4cf232[_0x3bef2f(0x178)]['sales_data_cateory']],_0x4a26bc=[..._0x4cf232['body'][_0x3bef2f(0x28b)]];const _0x244f13=_0x3f0509['map'](_0x34dc9c=>{return _0x34dc9c={'product_name':_0x34dc9c};});_0x4a26bc['forEach']((_0x5e10db,_0x4e1738)=>{var _0x3bc546=_0x3bef2f;_0x244f13[_0x4e1738][_0x3bc546(0x28b)]=_0x5e10db,_0x244f13[_0x4e1738][_0x3bc546(0x2a5)]=_0x5df255;}),_0x5bcec6[_0x3bef2f(0x2a6)]((_0x4587d5,_0x4bfb24)=>{_0x244f13[_0x4bfb24]['sales_category']=_0x4587d5;}),_0x5b46de['forEach']((_0x383e1f,_0x38ebc8)=>{var _0x48698a=_0x3bef2f;_0x244f13[_0x38ebc8][_0x48698a(0x24f)]=_0x383e1f;}),_0x531d95[_0x3bef2f(0x2a6)]((_0x6ff4b5,_0x41706c)=>{_0x244f13[_0x41706c]['uuid']=_0x6ff4b5;}),_0x2e150f['forEach']((_0x1bfb2f,_0x3008c7)=>{var _0x23403e=_0x3bef2f;_0x244f13[_0x3008c7][_0x23403e(0x2b1)]=Math[_0x23403e(0x257)](_0x1bfb2f);}),_0x37f13b[_0x3bef2f(0x2a6)]((_0x2f27b0,_0x13f5fb)=>{var _0x330191=_0x3bef2f;_0x244f13[_0x13f5fb][_0x330191(0x21a)]=_0x2f27b0;}),_0x169df9[_0x3bef2f(0x2a6)]((_0x240ff7,_0x50ef99)=>{_0x244f13[_0x50ef99]['secondary_unit']=_0x240ff7;}),_0x46f5d6[_0x3bef2f(0x2a6)]((_0x513883,_0x40adfa)=>{var _0x5c6084=_0x3bef2f;_0x244f13[_0x40adfa][_0x5c6084(0x181)]=_0x513883;}),_0x80e8a9['forEach']((_0x555aad,_0xec940b)=>{_0x244f13[_0xec940b]['secondary_code']=_0x555aad;}),_0x4b37ab['forEach']((_0x48265,_0x456bea)=>{var _0x40909d=_0x3bef2f;_0x244f13[_0x456bea][_0x40909d(0x289)]=_0x48265;}),_0xd5f48b[_0x3bef2f(0x2a6)]((_0x2ae90a,_0x209c3d)=>{_0x244f13[_0x209c3d]['batch_code']=_0x2ae90a;}),_0x2ecd49[_0x3bef2f(0x2a6)]((_0x154e9a,_0x33ddb7)=>{var _0xd1805d=_0x3bef2f;_0x244f13[_0x33ddb7][_0xd1805d(0x2a4)]=_0x154e9a;}),_0xf1f6b7['forEach']((_0xea1375,_0x212b1e)=>{var _0x2d5fe0=_0x3bef2f;_0x244f13[_0x212b1e][_0x2d5fe0(0x29d)]=_0xea1375;}),_0x3b5ced[_0x3bef2f(0x2a6)]((_0x4fe840,_0xdee198)=>{_0x244f13[_0xdee198]['maxperunit']=_0x4fe840;}),_0x1dcd07[_0x3bef2f(0x2a6)]((_0x1daec3,_0x33068f)=>{var _0x45d792=_0x3bef2f;_0x244f13[_0x33068f][_0x45d792(0x1c3)]=_0x1daec3;}),_0x38a2ab[_0x3bef2f(0x2a6)]((_0x24c7e2,_0x4bf6c1)=>{var _0x33b311=_0x3bef2f;_0x244f13[_0x4bf6c1][_0x33b311(0x2ad)]=_0x24c7e2;});const _0x1f5776=new invoice_for_incoming();await _0x1f5776[_0x3bef2f(0x25b)]();for(let _0x36f4ba=0x0;_0x36f4ba<=_0x3f0509[_0x3bef2f(0x223)]-0x1;_0x36f4ba++){_0x244f13[_0x36f4ba][_0x3bef2f(0x2b6)]=_0x3bef2f(0x232)+_0x1f5776[_0x3bef2f(0x253)]['toString']()['padStart'](0x8,'0');}const _0x773fa5=await warehouse_validation_setup[_0x3bef2f(0x27d)]([{'$match':{'warehouse_name':_0x550678}}]);for(let _0x5369cd=0x0;_0x5369cd<=_0x773fa5[_0x3bef2f(0x223)]-0x1;_0x5369cd++){const _0x2547e=_0x773fa5[_0x5369cd];for(let _0x23709a=0x0;_0x23709a<=_0x2547e[_0x3bef2f(0x1da)]['length']-0x1;_0x23709a++){const _0x114572=_0x2547e[_0x3bef2f(0x1da)][_0x23709a],_0x364f92=await warehouse[_0x3bef2f(0x27d)]([{'$match':{'name':_0x2547e['warehouse_name'],'room':_0x2547e[_0x3bef2f(0x2bc)]}},{'$unwind':_0x3bef2f(0x190)},{'$match':{'product_details.level':_0x114572[_0x3bef2f(0x209)],'product_details.bay':parseInt(_0x114572[_0x3bef2f(0x293)]),'product_details.product_code':_0x114572[_0x3bef2f(0x24f)]}}]);for(let _0x166db3=0x0;_0x166db3<=_0x364f92[_0x3bef2f(0x223)]-0x1;_0x166db3++){let _0x5dd182=_0x364f92[_0x166db3],_0x484013=0x0;_0x5dd182['product_details'][_0x3bef2f(0x24f)]==_0x114572[_0x3bef2f(0x24f)]&&_0x5dd182['product_details'][_0x3bef2f(0x209)]==_0x114572[_0x3bef2f(0x293)]&&_0x5dd182[_0x3bef2f(0x25d)]['level']==_0x114572[_0x3bef2f(0x209)]&&(_0x114572[_0x3bef2f(0x207)]=parseInt(_0x114572[_0x3bef2f(0x207)])-parseInt(_0x5dd182[_0x3bef2f(0x25d)][_0x3bef2f(0x26c)]),_0x484013++),_0x484013=='0'&&(parseInt(_0x114572[_0x3bef2f(0x207)])>0x0&&(_0x773fa5[_0x5369cd][_0x3bef2f(0x1da)]=_0x773fa5[_0x5369cd][_0x3bef2f(0x1da)][_0x3bef2f(0x24e)]({'bay':_0x114572[_0x3bef2f(0x209)],'bin':_0x114572[_0x3bef2f(0x293)],'max':_0x114572[_0x3bef2f(0x207)],'min':_0x114572[_0x3bef2f(0x191)],'product_code':_0x114572[_0x3bef2f(0x24f)],'product_id':_0x114572[_0x3bef2f(0x28b)],'product_name':_0x114572[_0x3bef2f(0x241)]})));}}_0x773fa5[_0x5369cd][_0x3bef2f(0x1da)]=_0x773fa5[_0x5369cd][_0x3bef2f(0x1da)][_0x3bef2f(0x1ba)](_0x47885b=>parseInt(_0x47885b['max'])>0x0);}for(let _0x34df1d=0x0;_0x34df1d<=_0x773fa5[_0x3bef2f(0x223)]-0x1;_0x34df1d++){const _0x4461c0=_0x773fa5[_0x34df1d];for(let _0x36d3e7=0x0;_0x36d3e7<=_0x4461c0[_0x3bef2f(0x1da)][_0x3bef2f(0x223)]-0x1;_0x36d3e7++){const _0x45f557=_0x4461c0[_0x3bef2f(0x1da)][_0x36d3e7],_0x1b5628=await warehouse_temporary[_0x3bef2f(0x27d)]([{'$match':{'warehouse':_0x4461c0[_0x3bef2f(0x1f6)],'room_name':_0x4461c0[_0x3bef2f(0x2bc)],'isConfirm':'false','data_type':_0x3bef2f(0x23d),'product_code':_0x45f557[_0x3bef2f(0x24f)],'level':_0x45f557['bay'],'bay':parseInt(_0x45f557[_0x3bef2f(0x293)])}}]);for(let _0x4efed2=0x0;_0x4efed2<=_0x1b5628['length']-0x1;_0x4efed2++){let _0x374981=_0x1b5628[_0x4efed2];console[_0x3bef2f(0x1d1)](_0x374981);let _0x2ed286=0x0;_0x374981['product_code']==_0x45f557[_0x3bef2f(0x24f)]&&_0x374981['bay']==_0x45f557[_0x3bef2f(0x293)]&&_0x374981[_0x3bef2f(0x1ac)]==_0x45f557[_0x3bef2f(0x209)]&&(_0x45f557['max']=parseInt(_0x45f557['max'])-parseInt(_0x374981[_0x3bef2f(0x26c)]),_0x2ed286++),_0x2ed286=='0'&&(parseInt(_0x45f557[_0x3bef2f(0x207)])>0x0&&(_0x773fa5[_0x34df1d][_0x3bef2f(0x1da)]=_0x773fa5[_0x34df1d]['product_data'][_0x3bef2f(0x24e)]({'bay':_0x45f557[_0x3bef2f(0x209)],'bin':_0x45f557[_0x3bef2f(0x293)],'max':_0x45f557['max'],'min':_0x45f557['min'],'product_code':_0x45f557[_0x3bef2f(0x24f)],'product_id':_0x45f557[_0x3bef2f(0x28b)],'product_name':_0x45f557['product_name']})));}}_0x773fa5[_0x34df1d][_0x3bef2f(0x1da)]=_0x773fa5[_0x34df1d][_0x3bef2f(0x1da)]['filter'](_0x1aedd2=>parseInt(_0x1aedd2[_0x3bef2f(0x207)])>0x0);}let _0x29eaae=[],_0x4ac398=0x0;for(let _0x44af3f=0x0;_0x44af3f<=_0x244f13[_0x3bef2f(0x223)]-0x1;_0x44af3f++){const _0xa92d41=_0x244f13[_0x44af3f];let _0x1521a2=_0xa92d41['quantity'];for(let _0x119aa3=0x0;_0x119aa3<=_0x773fa5['length']-0x1;_0x119aa3++){const _0x54cdcd=_0x773fa5[_0x119aa3];for(let _0x1175f9=0x0;_0x1175f9<=_0x54cdcd[_0x3bef2f(0x1da)]['length']-0x1;_0x1175f9++){const _0x12946b=_0x54cdcd['product_data'][_0x1175f9];if(_0x12946b['product_code']===_0xa92d41[_0x3bef2f(0x24f)]){const _0x380c1b=await warehouse[_0x3bef2f(0x27d)]([{'$match':{'name':_0x550678,'room':_0x54cdcd[_0x3bef2f(0x2bc)]}},{'$unwind':_0x3bef2f(0x190)},{'$match':{'product_details.level':_0x12946b['bay'],'product_details.bay':parseInt(_0x12946b[_0x3bef2f(0x293)])}}]);if(_0x380c1b[_0x3bef2f(0x223)]==0x0){for(let _0x165d68=0x0;_0x165d68<=_0x54cdcd['product_data'][_0x3bef2f(0x223)]-0x1&&_0x1521a2>0x0;_0x165d68++){const _0x2c2685=_0x54cdcd['product_data'][_0x165d68];console['log'](_0xa92d41['product_code']+_0x3bef2f(0x19f)+_0x2c2685[_0x3bef2f(0x24f)]+_0x3bef2f(0x2a1)+_0x2c2685[_0x3bef2f(0x191)]+_0x3bef2f(0x2a1)+_0x2c2685[_0x3bef2f(0x207)]+_0x3bef2f(0x2a1)+_0x2c2685[_0x3bef2f(0x209)]+_0x3bef2f(0x2a1)+_0x2c2685['bin']);if(_0xa92d41[_0x3bef2f(0x24f)]===_0x2c2685[_0x3bef2f(0x24f)]){_0x29eaae[_0x4ac398]={};const _0x3f0ac5=parseInt(_0x2c2685[_0x3bef2f(0x207)]),_0x2d09d2=0x0;let _0x3d188a=_0x3f0ac5-_0x2d09d2,_0x2308dd=Math[_0x3bef2f(0x191)](_0x1521a2,_0x3d188a);console[_0x3bef2f(0x1d1)](_0x3bef2f(0x1a6)+_0x2308dd+_0x3bef2f(0x1dd)+_0xa92d41[_0x3bef2f(0x241)]+_0x3bef2f(0x291)+_0x54cdcd[_0x3bef2f(0x1f6)]+_0x3bef2f(0x1f9)+_0x54cdcd['room']+_0x3bef2f(0x1e7)+_0x2c2685[_0x3bef2f(0x209)]+',\x20bin:\x20'+_0x2c2685['bin']+_0x3bef2f(0x17d)+_0x4ac398),_0x29eaae[_0x4ac398][_0x3bef2f(0x241)]=_0xa92d41[_0x3bef2f(0x241)],_0x29eaae[_0x4ac398][_0x3bef2f(0x24f)]=_0xa92d41[_0x3bef2f(0x24f)],_0x29eaae[_0x4ac398]['product_id']=_0xa92d41[_0x3bef2f(0x28b)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2a5)]=_0xa92d41[_0x3bef2f(0x2a5)],_0x29eaae[_0x4ac398]['sales_category']=_0xa92d41[_0x3bef2f(0x237)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2aa)]=_0xa92d41[_0x3bef2f(0x2aa)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2b1)]=_0x2308dd,_0x29eaae[_0x4ac398]['standard_unit']=_0xa92d41[_0x3bef2f(0x21a)],_0x29eaae[_0x4ac398][_0x3bef2f(0x173)]=_0xa92d41[_0x3bef2f(0x173)],_0x29eaae[_0x4ac398]['primary_code']=_0xa92d41[_0x3bef2f(0x181)],_0x29eaae[_0x4ac398]['secondary_code']=_0xa92d41['secondary_code'],_0x29eaae[_0x4ac398][_0x3bef2f(0x289)]=_0xa92d41['maxStocks'],_0x29eaae[_0x4ac398]['batch_code']=_0xa92d41[_0x3bef2f(0x24a)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2a4)]=_0xa92d41[_0x3bef2f(0x2a4)],_0x29eaae[_0x4ac398][_0x3bef2f(0x29d)]=_0xa92d41[_0x3bef2f(0x29d)],_0x29eaae[_0x4ac398][_0x3bef2f(0x217)]=_0xa92d41[_0x3bef2f(0x217)],_0x29eaae[_0x4ac398][_0x3bef2f(0x1c3)]=_0xa92d41[_0x3bef2f(0x1c3)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2b6)]=_0xa92d41['invoice'],_0x29eaae[_0x4ac398][_0x3bef2f(0x2ad)]=_0xa92d41[_0x3bef2f(0x2ad)],_0x29eaae[_0x4ac398][_0x3bef2f(0x206)]=_0x54cdcd[_0x3bef2f(0x2bc)],_0x29eaae[_0x4ac398][_0x3bef2f(0x1ac)]=_0x2c2685[_0x3bef2f(0x209)],_0x29eaae[_0x4ac398][_0x3bef2f(0x209)]=_0x2c2685[_0x3bef2f(0x293)],_0x1521a2-=_0x2308dd,_0x4ac398++;if(_0x1521a2<=0x0)break;}}if(_0x1521a2<=0x0){_0x4cf232[_0x3bef2f(0x1e4)](_0x3bef2f(0x214),'The\x20Other\x20'+_0x1521a2+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x1521a2>0x0){console['log'](_0x3bef2f(0x195)+_0x1521a2+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');break;}}}}}if(_0x1521a2>0x0){const _0x101f0e=await warehouse[_0x3bef2f(0x27d)]([{'$match':{'name':_0x550678,'isStaging':_0x3bef2f(0x25f)}}]);_0x29eaae[_0x4ac398]={},_0x29eaae[_0x4ac398]['product_name']=_0xa92d41[_0x3bef2f(0x241)],_0x29eaae[_0x4ac398][_0x3bef2f(0x24f)]=_0xa92d41[_0x3bef2f(0x24f)],_0x29eaae[_0x4ac398][_0x3bef2f(0x28b)]=_0xa92d41[_0x3bef2f(0x28b)],_0x29eaae[_0x4ac398]['date_recieved']=_0xa92d41['date_recieved'],_0x29eaae[_0x4ac398][_0x3bef2f(0x237)]=_0xa92d41[_0x3bef2f(0x237)],_0x29eaae[_0x4ac398]['uuid']=_0xa92d41[_0x3bef2f(0x2aa)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2b1)]=_0x1521a2,_0x29eaae[_0x4ac398][_0x3bef2f(0x21a)]=_0xa92d41[_0x3bef2f(0x21a)],_0x29eaae[_0x4ac398][_0x3bef2f(0x173)]=_0xa92d41[_0x3bef2f(0x173)],_0x29eaae[_0x4ac398][_0x3bef2f(0x181)]=_0xa92d41['primary_code'],_0x29eaae[_0x4ac398][_0x3bef2f(0x199)]=_0xa92d41[_0x3bef2f(0x199)],_0x29eaae[_0x4ac398][_0x3bef2f(0x289)]=_0xa92d41[_0x3bef2f(0x289)],_0x29eaae[_0x4ac398][_0x3bef2f(0x24a)]=_0xa92d41[_0x3bef2f(0x24a)],_0x29eaae[_0x4ac398]['expiry_date']=_0xa92d41[_0x3bef2f(0x2a4)],_0x29eaae[_0x4ac398][_0x3bef2f(0x29d)]=_0xa92d41['production_date'],_0x29eaae[_0x4ac398][_0x3bef2f(0x217)]=_0xa92d41['maxperunit'],_0x29eaae[_0x4ac398]['product_cat']=_0xa92d41[_0x3bef2f(0x1c3)],_0x29eaae[_0x4ac398][_0x3bef2f(0x2b6)]=_0xa92d41['invoice'],_0x29eaae[_0x4ac398][_0x3bef2f(0x2ad)]=_0xa92d41[_0x3bef2f(0x2ad)],_0x29eaae[_0x4ac398][_0x3bef2f(0x206)]=_0x101f0e[0x0]['room'],_0x29eaae[_0x4ac398][_0x3bef2f(0x1ac)]='STAGING',_0x29eaae[_0x4ac398]['bay']='1',console[_0x3bef2f(0x1d1)](_0x3bef2f(0x19a)+_0x3bef2f(0x2a1)+_0xa92d41[_0x3bef2f(0x24f)]+_0x3bef2f(0x183)+_0xa92d41[_0x3bef2f(0x24f)]+_0x3bef2f(0x2a1)+_0x4ac398+_0x3bef2f(0x2a1)+_0x1521a2),_0x4cf232[_0x3bef2f(0x1e4)](_0x3bef2f(0x214),_0x3bef2f(0x282)+_0x1521a2+_0x3bef2f(0x1c1));}}const _0x35619e=_0x29eaae[_0x3bef2f(0x1ba)](_0x43c2b0=>_0x43c2b0[_0x3bef2f(0x2b1)]!=='0'&&_0x43c2b0[_0x3bef2f(0x2b1)]!==''),_0x18de40=new purchases_finished({'invoice':'INC-'+_0x1f5776[_0x3bef2f(0x253)][_0x3bef2f(0x29b)]()[_0x3bef2f(0x19e)](0x8,'0'),'suppliers':_0x16004c,'date':_0x5df255,'warehouse_name':_0x550678,'product':_0x35619e,'note':_0x349a35,'due_amount':_0x230cae,'room':_0x22ea40,'POnumber':_0x2a574c,'SCRN':_0x5b5f73,'JO_number':_0x3458fc,'ReqBy':_0x203385,'dateofreq':_0x3203c0,'typeservicesData':_0x59a085,'van':_0x153e4a,'typevehicle':_0x284a75,'driver':_0x503a77,'plate':_0x16b26f,'DRSI':_0x2ec19b,'TSU':_0x11a22d,'TFU':_0x3a98bf,'typeOfProducts':_0x10c2d0}),_0x2cfc92=await _0x18de40[_0x3bef2f(0x25b)](),_0x2eac41=await purchases_finished[_0x3bef2f(0x1b3)]({'_id':_0x2cfc92[_0x3bef2f(0x22b)][_0x3bef2f(0x1d8)]()});_0x4cf232['flash'](_0x3bef2f(0x25a),_0x3bef2f(0x262)),_0x35e6d9['redirect']('/all_purchases_finished/process/'+_0x2eac41[_0x3bef2f(0x22b)]['valueOf']());}catch(_0x1710dd){console['log'](_0x1710dd);}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x1b4),auth,async(_0x2d25d8,_0x14d347)=>{var _0x1993e4=a0_0xdfc6ce;try{const {username:_0x2fa731,email:_0x5f8172,role:_0x5d70ca}=_0x2d25d8[_0x1993e4(0x24b)],_0xd20233=_0x2d25d8[_0x1993e4(0x24b)],_0x5d8a96=_0x2d25d8[_0x1993e4(0x16e)]['id'],_0x252b29=await profile['findOne']({'email':_0xd20233[_0x1993e4(0x1d0)]}),_0x4a70a5=await master_shop[_0x1993e4(0x2a9)](),_0x5a63f5=await staff[_0x1993e4(0x1b3)]({'email':_0xd20233[_0x1993e4(0x1d0)]}),_0x1b9ed5=await suppliers[_0x1993e4(0x2a9)]({});let _0xdd80f5;if(_0xd20233[_0x1993e4(0x184)]==_0x1993e4(0x21e)){const _0x882b6=await staff[_0x1993e4(0x1b3)]({'email':_0xd20233[_0x1993e4(0x1d0)]});_0xdd80f5=await warehouse[_0x1993e4(0x27d)]([{'$match':{'status':_0x1993e4(0x226),'name':_0x882b6[_0x1993e4(0x1ca)]}},{'$group':{'_id':_0x1993e4(0x1ad),'name':{'$first':_0x1993e4(0x1ad)}}}]);}else _0xdd80f5=await warehouse[_0x1993e4(0x27d)]([{'$match':{'status':_0x1993e4(0x226)}},{'$group':{'_id':_0x1993e4(0x1ad),'name':{'$first':_0x1993e4(0x1ad)}}}]);const _0x338883=await purchases_finished['findById'](_0x5d8a96);if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]=='English\x20(US)')var _0x18012b=users[_0x1993e4(0x227)];else{if(_0x4a70a5[0x0]['language']=='Hindi')var _0x18012b=users['Hindi'];else{if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]==_0x1993e4(0x28f))var _0x18012b=users['German'];else{if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]=='Spanish')var _0x18012b=users[_0x1993e4(0x18b)];else{if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]==_0x1993e4(0x254))var _0x18012b=users[_0x1993e4(0x254)];else{if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]==_0x1993e4(0x1ff))var _0x18012b=users['Portuguese'];else{if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]==_0x1993e4(0x1b0))var _0x18012b=users[_0x1993e4(0x1b0)];else{if(_0x4a70a5[0x0][_0x1993e4(0x1e3)]==_0x1993e4(0x292))var _0x18012b=users[_0x1993e4(0x17a)];}}}}}}}_0x14d347[_0x1993e4(0x20b)]('purchases_process',{'success':_0x2d25d8[_0x1993e4(0x1e4)](_0x1993e4(0x25a)),'errors':_0x2d25d8['flash'](_0x1993e4(0x214)),'role':_0xd20233,'profile':_0x252b29,'suppliers':_0x1b9ed5,'warehouse':_0xdd80f5,'master_shop':_0x4a70a5,'language':_0x18012b,'purchases_data':_0x338883});}catch(_0x46ee51){console[_0x1993e4(0x1d1)](_0x46ee51);}});async function get_warehouse_data(_0x4263ab,_0x8c7eb){var _0x40de1b=a0_0xdfc6ce;try{const _0x266d41=await warehouse_temporary['findOne']({'name':_0x4263ab,'room':_0x8c7eb});if(!_0x266d41){const _0x361178=new warehouse_temporary({'name':_0x4263ab,'address':_0x4263ab,'status':_0x40de1b(0x226),'room':_0x8c7eb,'isStaging':'false'});return await _0x361178[_0x40de1b(0x25b)](),_0x361178;}else return _0x266d41;}catch(_0x907c01){console[_0x40de1b(0x296)](_0x40de1b(0x243),_0x907c01);throw _0x907c01;}}function a0_0x46de(_0x337078,_0x4f1aa0){var _0x526c8c=a0_0x526c();return a0_0x46de=function(_0x46deaa,_0x55630c){_0x46deaa=_0x46deaa-0x16b;var _0xbd15ac=_0x526c8c[_0x46deaa];return _0xbd15ac;},a0_0x46de(_0x337078,_0x4f1aa0);}router[a0_0xdfc6ce(0x175)]('/process/:id',auth,async(_0x185574,_0x3be87f)=>{var _0x3d77e8=a0_0xdfc6ce;try{const _0xfac5be=_0x185574['params']['id'],_0x277e7a=await purchases_finished[_0x3d77e8(0x235)](_0xfac5be);let _0x4e4162=[];_0x277e7a[_0x3d77e8(0x26b)][_0x3d77e8(0x2a6)]((_0x412f20,_0x444248)=>{var _0x89b25d=_0x3d77e8;_0x4e4162[_0x444248]={},_0x4e4162[_0x444248][_0x89b25d(0x1ca)]=_0x277e7a['warehouse_name'],_0x4e4162[_0x444248][_0x89b25d(0x28b)]=_0x412f20[_0x89b25d(0x28b)],_0x4e4162[_0x444248][_0x89b25d(0x241)]=_0x412f20['product_name'],_0x4e4162[_0x444248][_0x89b25d(0x24f)]=_0x412f20[_0x89b25d(0x24f)],_0x4e4162[_0x444248][_0x89b25d(0x26c)]=_0x412f20['quantity'],_0x4e4162[_0x444248][_0x89b25d(0x18c)]=_0x412f20[_0x89b25d(0x21a)],_0x4e4162[_0x444248][_0x89b25d(0x173)]=_0x412f20[_0x89b25d(0x173)],_0x4e4162[_0x444248][_0x89b25d(0x1ac)]=_0x412f20[_0x89b25d(0x1ac)],_0x4e4162[_0x444248][_0x89b25d(0x209)]=_0x412f20[_0x89b25d(0x209)],_0x4e4162[_0x444248][_0x89b25d(0x181)]=_0x412f20[_0x89b25d(0x181)],_0x4e4162[_0x444248]['secondary_code']=_0x412f20[_0x89b25d(0x199)],_0x4e4162[_0x444248]['maxStocks']=_0x412f20[_0x89b25d(0x289)],_0x4e4162[_0x444248][_0x89b25d(0x24a)]=_0x412f20[_0x89b25d(0x24a)],_0x4e4162[_0x444248][_0x89b25d(0x2a4)]=_0x412f20[_0x89b25d(0x2a4)],_0x4e4162[_0x444248][_0x89b25d(0x29d)]=_0x412f20[_0x89b25d(0x29d)],_0x4e4162[_0x444248][_0x89b25d(0x217)]=_0x412f20[_0x89b25d(0x217)],_0x4e4162[_0x444248]['product_cat']=_0x412f20[_0x89b25d(0x1c3)],_0x4e4162[_0x444248][_0x89b25d(0x206)]=_0x412f20[_0x89b25d(0x206)],_0x4e4162[_0x444248]['invoice']=_0x412f20[_0x89b25d(0x2b6)],_0x4e4162[_0x444248]['uuid']=_0x412f20[_0x89b25d(0x2aa)],_0x4e4162[_0x444248][_0x89b25d(0x2ad)]=_0x412f20['gross_price'],_0x4e4162[_0x444248][_0x89b25d(0x237)]=_0x412f20[_0x89b25d(0x237)],_0x4e4162[_0x444248][_0x89b25d(0x2a5)]=_0x412f20[_0x89b25d(0x2a5)],_0x4e4162[_0x444248][_0x89b25d(0x22f)]=_0x412f20[_0x89b25d(0x22b)][_0x89b25d(0x1d8)](),_0x4e4162[_0x444248][_0x89b25d(0x242)]=_0x89b25d(0x23d),_0x4e4162[_0x444248][_0x89b25d(0x1ae)]='true',_0x4e4162[_0x444248][_0x89b25d(0x21f)]=_0x89b25d(0x21d);});for(let _0x365a87=0x0;_0x365a87<=_0x4e4162['length']-0x1;_0x365a87++){const _0x26619b=_0x4e4162[_0x365a87],_0x2d741a=new warehouse_temporary(_0x26619b);await _0x2d741a[_0x3d77e8(0x25b)]();}_0x277e7a[_0x3d77e8(0x1b6)]='true',await _0x277e7a[_0x3d77e8(0x25b)](),_0x185574[_0x3d77e8(0x1e4)](_0x3d77e8(0x25a),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x3be87f[_0x3d77e8(0x1f2)]('/all_purchases_finished/process/'+_0x277e7a[_0x3d77e8(0x22b)][_0x3d77e8(0x1d8)]());}catch(_0x297ee2){}}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x1a5),auth,async(_0xe17724,_0x134777)=>{var _0x1fb66f=a0_0xdfc6ce;try{const {invoice:_0x486339,date:_0x2c5907,warehouse_name:_0xad2f61,prod_name:_0x53480f,note:_0x25a358,due_amount:_0x1411b6,Room_name:_0x1b7c7e,PO_number:_0x23352e,SCRN:_0x3de805,ReqBy:_0x54e221,dateofreq:_0x30808d,suppliers:_0x2c3d33,typeservicesData:_0x1a3c98,van:_0x5840ba,typevehicle:_0x23fad1,driver:_0x115dd0,plate:_0x2c429b,DRSI:_0xde52d1,TSU:_0x4b2387,TFU:_0x456ba3,JO_number:_0x23d8bf,type_of_products:_0x2151a4}=_0xe17724[_0x1fb66f(0x178)];if(typeof _0x53480f==_0x1fb66f(0x17c))var _0x42f676=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x2bb)]],_0x151528=[_0xe17724['body']['prod_code']],_0x36b1fc=[_0xe17724['body'][_0x1fb66f(0x1b8)]],_0x4e3244=[_0xe17724['body'][_0x1fb66f(0x16f)]],_0x21b6fc=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x2b9)]],_0x3c435c=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x1db)]],_0x6d71a0=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x181)]],_0x1810d1=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x199)]],_0x207b5d=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x22c)]],_0x20b62f=[_0xe17724[_0x1fb66f(0x178)]['batch_code']],_0x2364fc=[_0xe17724['body']['expiry_date']],_0x3a6eab=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x200)]],_0x58dfa6=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x1d7)]],_0x59e825=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x204)]],_0x254b04=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x1f3)]],_0x5e1d55=[_0xe17724['body'][_0x1fb66f(0x2ad)]],_0x41e784=[_0xe17724['body'][_0x1fb66f(0x2aa)]],_0x2a76d7=[_0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x297)]],_0x57cc24=[_0xe17724['body']['type_of_products_type']];else var _0x42f676=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x2bb)]],_0x151528=[..._0xe17724[_0x1fb66f(0x178)]['prod_code']],_0x36b1fc=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x1b8)]],_0x4e3244=[..._0xe17724['body'][_0x1fb66f(0x16f)]],_0x21b6fc=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x2b9)]],_0x3c435c=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x1db)]],_0x6d71a0=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x181)]],_0x1810d1=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x199)]],_0x207b5d=[..._0xe17724[_0x1fb66f(0x178)]['MaxStocks_data']],_0x20b62f=[..._0xe17724[_0x1fb66f(0x178)]['batch_code']],_0x2364fc=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x2a4)]],_0x3a6eab=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x200)]],_0x58dfa6=[..._0xe17724[_0x1fb66f(0x178)]['max_product_unit']],_0x59e825=[..._0xe17724['body']['prod_cat']],_0x254b04=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x1f3)]],_0x5e1d55=[..._0xe17724[_0x1fb66f(0x178)][_0x1fb66f(0x2ad)]],_0x41e784=[..._0xe17724['body'][_0x1fb66f(0x2aa)]],_0x2a76d7=[..._0xe17724[_0x1fb66f(0x178)]['sales_data_cateory']],_0x57cc24=[..._0xe17724[_0x1fb66f(0x178)]['type_of_products_type']];const _0x8b49f4=_0x42f676['map'](_0xd8f62d=>{return _0xd8f62d={'product_name':_0xd8f62d};});_0x57cc24['forEach']((_0x4ee9d0,_0x141258)=>{var _0x21e534=_0x1fb66f;_0x8b49f4[_0x141258][_0x21e534(0x29c)]=_0x4ee9d0;}),_0x2a76d7['forEach']((_0x4afeb0,_0x2e5c20)=>{var _0x2f078b=_0x1fb66f;_0x8b49f4[_0x2e5c20][_0x2f078b(0x237)]=_0x4afeb0;}),_0x151528[_0x1fb66f(0x2a6)]((_0x52bbfe,_0xdaaf6d)=>{_0x8b49f4[_0xdaaf6d]['product_code']=_0x52bbfe;}),_0x41e784[_0x1fb66f(0x2a6)]((_0x5aeb5a,_0x18a842)=>{_0x8b49f4[_0x18a842]['uuid']=_0x5aeb5a;}),_0x36b1fc[_0x1fb66f(0x2a6)]((_0x10fd80,_0x5c4580)=>{var _0x5ec905=_0x1fb66f;_0x8b49f4[_0x5c4580][_0x5ec905(0x2b1)]=Math[_0x5ec905(0x257)](_0x10fd80);}),_0x4e3244[_0x1fb66f(0x2a6)]((_0x13e45f,_0x5d6b58)=>{var _0x36df31=_0x1fb66f;_0x8b49f4[_0x5d6b58][_0x36df31(0x21a)]=_0x13e45f;}),_0x21b6fc[_0x1fb66f(0x2a6)]((_0x5ca30b,_0x498df4)=>{var _0x568aca=_0x1fb66f;_0x8b49f4[_0x498df4][_0x568aca(0x173)]=_0x5ca30b;}),_0x3c435c[_0x1fb66f(0x2a6)]((_0x4280e3,_0x3c78fb)=>{var _0x46ffe0=_0x1fb66f,_0x1abe3c=_0x4280e3[_0x46ffe0(0x2b2)](/[A-Za-z]+/)[0x0],_0x9d5d61=parseInt(_0x4280e3['match'](/\d+/)[0x0]);_0x8b49f4[_0x3c78fb][_0x46ffe0(0x1ac)]=_0x1abe3c,_0x8b49f4[_0x3c78fb][_0x46ffe0(0x209)]=_0x9d5d61;}),_0x6d71a0[_0x1fb66f(0x2a6)]((_0x4dfe92,_0x4b570e)=>{var _0x19b10d=_0x1fb66f;_0x8b49f4[_0x4b570e][_0x19b10d(0x181)]=_0x4dfe92;}),_0x1810d1[_0x1fb66f(0x2a6)]((_0x4b241a,_0x97e645)=>{var _0x38d91a=_0x1fb66f;_0x8b49f4[_0x97e645][_0x38d91a(0x199)]=_0x4b241a;}),_0x207b5d[_0x1fb66f(0x2a6)]((_0x1d4729,_0x247769)=>{var _0x2c4eda=_0x1fb66f;_0x8b49f4[_0x247769][_0x2c4eda(0x289)]=_0x1d4729;}),_0x20b62f['forEach']((_0x34bdd4,_0x189afc)=>{var _0x20b2f2=_0x1fb66f;_0x8b49f4[_0x189afc][_0x20b2f2(0x24a)]=_0x34bdd4;}),_0x2364fc[_0x1fb66f(0x2a6)]((_0x6ee124,_0x1676b7)=>{var _0x5a69d8=_0x1fb66f;_0x8b49f4[_0x1676b7][_0x5a69d8(0x2a4)]=_0x6ee124;}),_0x3a6eab[_0x1fb66f(0x2a6)]((_0x183dfb,_0x4ec191)=>{var _0x4614ac=_0x1fb66f;_0x8b49f4[_0x4ec191][_0x4614ac(0x29d)]=_0x183dfb;}),_0x58dfa6[_0x1fb66f(0x2a6)]((_0x9b0c5f,_0x3b271e)=>{var _0x59e8af=_0x1fb66f;_0x8b49f4[_0x3b271e][_0x59e8af(0x217)]=_0x9b0c5f;}),_0x59e825[_0x1fb66f(0x2a6)]((_0x147dc0,_0x20210c)=>{var _0x6064fb=_0x1fb66f;_0x8b49f4[_0x20210c][_0x6064fb(0x1c3)]=_0x147dc0;}),_0x254b04[_0x1fb66f(0x2a6)]((_0x1c10db,_0x2b0cde)=>{var _0x148042=_0x1fb66f;_0x8b49f4[_0x2b0cde][_0x148042(0x206)]=_0x1c10db;}),_0x5e1d55['forEach']((_0x217b76,_0x24e6fe)=>{var _0x24a859=_0x1fb66f;_0x8b49f4[_0x24e6fe][_0x24a859(0x2ad)]=_0x217b76;});const _0x46c0ae=new purchases_logs();await _0x46c0ae['save']();for(let _0x3c7546=0x0;_0x3c7546<=_0x254b04[_0x1fb66f(0x223)]-0x1;_0x3c7546++){_0x8b49f4[_0x3c7546][_0x1fb66f(0x2b6)]=_0x1fb66f(0x211)+_0x46c0ae[_0x1fb66f(0x253)]['toString']()[_0x1fb66f(0x19e)](0x8,'0');}const _0x10a97c=_0x8b49f4[_0x1fb66f(0x1ba)](_0x4edbc2=>_0x4edbc2[_0x1fb66f(0x2b1)]!=='0'&&_0x4edbc2[_0x1fb66f(0x2b1)]!==''),_0x58b917=new purchases_finished({'invoice':_0x1fb66f(0x211)+_0x46c0ae[_0x1fb66f(0x253)]['toString']()[_0x1fb66f(0x19e)](0x8,'0'),'suppliers':_0x2c3d33,'date':_0x2c5907,'warehouse_name':_0xad2f61,'product':_0x10a97c,'note':_0x25a358,'due_amount':_0x1411b6,'room':_0x1b7c7e,'POnumber':_0x23352e,'SCRN':_0x3de805,'JO_number':_0x23d8bf,'ReqBy':_0x54e221,'dateofreq':_0x30808d,'typeservicesData':_0x1a3c98,'van':_0x5840ba,'typevehicle':_0x23fad1,'driver':_0x115dd0,'plate':_0x2c429b,'DRSI':_0xde52d1,'TSU':_0x4b2387,'TFU':_0x456ba3,'typeOfProducts':_0x2151a4}),_0x85182c=await _0x58b917['save'](),_0x14a837=await purchases_finished[_0x1fb66f(0x1b3)]({'_id':_0x85182c[_0x1fb66f(0x22b)][_0x1fb66f(0x1d8)]()}),_0x29cb59=_0x14a837[_0x1fb66f(0x26b)][_0x1fb66f(0x2af)](async _0x531b0a=>{var _0x96dcfd=_0x1fb66f;try{var _0x5e1669=await warehouse[_0x96dcfd(0x1b3)]({'name':_0xad2f61,'room':_0x531b0a[_0x96dcfd(0x206)]}),_0x29ce30=0x0;const _0xaaa732=_0x5e1669[_0x96dcfd(0x25d)][_0x96dcfd(0x2af)](_0x25d81d=>{var _0x56ca0e=_0x96dcfd;console[_0x56ca0e(0x1d1)](_0x25d81d[_0x56ca0e(0x241)]+'=='+_0x531b0a[_0x56ca0e(0x241)]+'&&'+_0x25d81d[_0x56ca0e(0x209)]+'=='+_0x531b0a[_0x56ca0e(0x209)]+'&&'+_0x25d81d[_0x56ca0e(0x2a4)]+'=='+_0x531b0a[_0x56ca0e(0x2a4)]+'&&'+_0x25d81d[_0x56ca0e(0x29d)]+'=='+_0x531b0a[_0x56ca0e(0x29d)]+'&&'+_0x25d81d[_0x56ca0e(0x24a)]+'=='+_0x531b0a[_0x56ca0e(0x24a)]+'&&'+_0x25d81d['invoice']+'=='+_0x14a837[_0x56ca0e(0x2b6)]),_0x25d81d[_0x56ca0e(0x241)]==_0x531b0a[_0x56ca0e(0x241)]&&_0x25d81d[_0x56ca0e(0x209)]==_0x531b0a[_0x56ca0e(0x209)]&&_0x25d81d['level']==_0x531b0a[_0x56ca0e(0x1ac)]&&_0x25d81d['expiry_date']==_0x531b0a['expiry_date']&&_0x25d81d[_0x56ca0e(0x29d)]==_0x531b0a[_0x56ca0e(0x29d)]&&_0x25d81d[_0x56ca0e(0x24a)]==_0x531b0a[_0x56ca0e(0x24a)]&&_0x25d81d[_0x56ca0e(0x2b6)]==_0x14a837[_0x56ca0e(0x2b6)]&&(_0x25d81d[_0x56ca0e(0x26c)]=Math[_0x56ca0e(0x257)](_0x25d81d['product_stock'])+Math[_0x56ca0e(0x257)](_0x531b0a['quantity']),_0x29ce30++);});return _0x29ce30==0x0&&(_0x5e1669['product_details']=_0x5e1669[_0x96dcfd(0x25d)][_0x96dcfd(0x24e)]({'product_name':_0x531b0a[_0x96dcfd(0x241)],'product_stock':Math[_0x96dcfd(0x257)](_0x531b0a['quantity']),'primary_code':_0x531b0a['primary_code'],'secondary_code':_0x531b0a[_0x96dcfd(0x199)],'product_code':_0x531b0a['product_code'],'bay':_0x531b0a[_0x96dcfd(0x209)],'level':_0x531b0a['level'],'maxProducts':_0x531b0a[_0x96dcfd(0x289)],'unit':_0x531b0a[_0x96dcfd(0x21a)],'secondary_unit':_0x531b0a[_0x96dcfd(0x173)],'expiry_date':_0x531b0a[_0x96dcfd(0x2a4)],'production_date':_0x531b0a[_0x96dcfd(0x29d)],'maxProducts':_0x531b0a[_0x96dcfd(0x289)],'maxPerUnit':_0x531b0a[_0x96dcfd(0x217)],'batch_code':_0x531b0a[_0x96dcfd(0x24a)],'product_cat':_0x531b0a[_0x96dcfd(0x1c3)],'invoice':_0x531b0a['invoice'],'id_incoming':_0x531b0a[_0x96dcfd(0x22b)],'uuid':_0x531b0a['uuid'],'gross_price':_0x531b0a[_0x96dcfd(0x2ad)],'sales_category':_0x531b0a['sales_category'],'type_products':_0x531b0a['type_of_products']})),_0x5e1669;}catch(_0x251812){return console[_0x96dcfd(0x296)](_0x96dcfd(0x21c),_0x251812),null;}});Promise[_0x1fb66f(0x1c2)](_0x29cb59)[_0x1fb66f(0x1aa)](async _0x2df90c=>{var _0x499b4d=_0x1fb66f;try{for(const _0x2a0d26 of _0x2df90c){await warehouse[_0x499b4d(0x221)]({'_id':_0x2a0d26[_0x499b4d(0x22b)]},{'$addToSet':{'product_details':{'$each':_0x2a0d26[_0x499b4d(0x25d)]}}});}const _0x277e6c=await master_shop[_0x499b4d(0x2a9)](),_0x2abd7e=await email_settings[_0x499b4d(0x1b3)](),_0x5b81d3=await supervisor_settings[_0x499b4d(0x2a9)]();var _0x35fab6=_0x14a837[_0x499b4d(0x26b)],_0x10aad1='',_0x26e8cb;for(_0x26e8cb in _0x35fab6){var _0x191643='FG';_0x14a837[_0x499b4d(0x1f6)]==_0x499b4d(0x23f)&&(_0x191643='DG'),_0x10aad1+=_0x499b4d(0x1a8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35fab6[_0x26e8cb][_0x499b4d(0x241)]+_0x499b4d(0x276)+_0x499b4d(0x1d3)+_0x35fab6[_0x26e8cb][_0x499b4d(0x24f)]+_0x499b4d(0x276)+_0x499b4d(0x1d3)+_0x35fab6[_0x26e8cb][_0x499b4d(0x2b1)]+'</td>'+_0x499b4d(0x1d3)+_0x35fab6[_0x26e8cb][_0x499b4d(0x21a)]+'</td>'+_0x499b4d(0x1d3)+_0x35fab6[_0x26e8cb][_0x499b4d(0x173)]+_0x499b4d(0x276)+_0x499b4d(0x1d3)+_0x14a837[_0x499b4d(0x1f6)]+'</td>'+_0x499b4d(0x1d3)+_0x35fab6[_0x26e8cb]['room_name']+_0x499b4d(0x276)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x191643+_0x35fab6[_0x26e8cb][_0x499b4d(0x209)]+_0x499b4d(0x276),_0x499b4d(0x170);}let _0x1ffc31=nodemailer[_0x499b4d(0x2ac)]({'host':_0x2abd7e[_0x499b4d(0x233)],'port':Number(_0x2abd7e[_0x499b4d(0x2b3)]),'secure':![],'auth':{'user':_0x2abd7e['email'],'pass':_0x2abd7e[_0x499b4d(0x265)]}}),_0x4e8864={'from':_0x2abd7e[_0x499b4d(0x1d0)],'to':_0x5b81d3[0x0][_0x499b4d(0x27b)],'subject':_0x499b4d(0x28a),'attachments':[{'filename':'Logo.png','path':__dirname+_0x499b4d(0x26f)+_0x499b4d(0x17f)+_0x277e6c[0x0]['image'],'cid':'logo'}],'html':_0x499b4d(0x1df)+_0x499b4d(0x1e2)+_0x499b4d(0x1d2)+_0x499b4d(0x22e)+_0x499b4d(0x263)+_0x499b4d(0x22e)+_0x499b4d(0x1a3)+'</div>'+_0x499b4d(0x22e)+_0x499b4d(0x1f0)+_0x277e6c[0x0]['site_title']+_0x499b4d(0x228)+'</div>'+_0x499b4d(0x256)+_0x499b4d(0x27c)+_0x499b4d(0x22e)+_0x499b4d(0x1af)+_0x499b4d(0x1de)+_0x14a837[_0x499b4d(0x2b6)]+'\x20'+_0x499b4d(0x1ab)+_0x499b4d(0x2ba)+_0x14a837['date']+'\x20'+_0x499b4d(0x234)+_0x499b4d(0x171)+'</div>'+_0x499b4d(0x261)+_0x499b4d(0x23b)+_0x499b4d(0x1a8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x499b4d(0x1fe)+_0x499b4d(0x218)+_0x499b4d(0x26d)+_0x499b4d(0x176)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x499b4d(0x224)+_0x499b4d(0x1a7)+'</tr>'+_0x499b4d(0x180)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x10aad1+'\x20'+_0x499b4d(0x1cc)+'</table>'+_0x499b4d(0x22e)+_0x499b4d(0x260)+_0x499b4d(0x205)+_0x277e6c[0x0][_0x499b4d(0x283)]+'</h5>'+'</div>'+_0x499b4d(0x256)+_0x499b4d(0x186)};_0x1ffc31[_0x499b4d(0x216)](_0x4e8864,function(_0x2965ef,_0x2928dc){var _0x1c8727=_0x499b4d;_0x2965ef?(console[_0x1c8727(0x1d1)](_0x2965ef),console[_0x1c8727(0x1d1)]('Error\x20Occurs')):console[_0x1c8727(0x1d1)]('Email\x20sent\x20successfully');});}catch(_0x7ccc07){console[_0x499b4d(0x296)](_0x7ccc07),_0x134777[_0x499b4d(0x1d9)](0x1f4)[_0x499b4d(0x281)]({'error':_0x499b4d(0x268),'message':_0x7ccc07[_0x499b4d(0x1b1)]});}})[_0x1fb66f(0x177)](_0x1fbba1=>{console['error'](_0x1fbba1);}),_0xe17724[_0x1fb66f(0x1e4)](_0x1fb66f(0x25a),_0x1fb66f(0x262)),_0x134777[_0x1fb66f(0x1f2)](_0x1fb66f(0x20c)+_0x14a837[_0x1fb66f(0x22b)][_0x1fb66f(0x1d8)]());}catch(_0x3cc1df){console[_0x1fb66f(0x1d1)](_0x3cc1df);}}),router['get'](a0_0xdfc6ce(0x29a),auth,async(_0x33927b,_0x26c3a0)=>{var _0x4fcd73=a0_0xdfc6ce;try{const {username:_0x531e70,email:_0x56db49,role:_0x5befdc}=_0x33927b[_0x4fcd73(0x24b)],_0x58a5e1=_0x33927b[_0x4fcd73(0x24b)],_0x45e08a=await profile[_0x4fcd73(0x1b3)]({'email':_0x58a5e1[_0x4fcd73(0x1d0)]}),_0x17eb8e=await master_shop[_0x4fcd73(0x2a9)](),_0x1ab2e6=_0x33927b['params']['id'],_0x3e52c5=await purchases_finished['findById'](_0x1ab2e6),_0x432b95=await suppliers[_0x4fcd73(0x2a9)]({});let _0x3fcdb2;if(_0x58a5e1[_0x4fcd73(0x184)]==_0x4fcd73(0x21e)){const _0x29d3aa=await staff[_0x4fcd73(0x1b3)]({'email':_0x58a5e1[_0x4fcd73(0x1d0)]});_0x3fcdb2=await warehouse[_0x4fcd73(0x2a9)]({'status':_0x4fcd73(0x226),'name':_0x29d3aa[_0x4fcd73(0x1ca)],'warehouse_category':'Finished\x20Goods'});}else _0x3fcdb2=await warehouse[_0x4fcd73(0x27d)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x4fcd73(0x1ad)}}}]);const _0x2dbb6f=await product[_0x4fcd73(0x2a9)]({}),_0x5da5b8=BayBinSelected(_0x3e52c5[_0x4fcd73(0x1f6)],_0x3e52c5[_0x4fcd73(0x2bc)]);let _0x5f4415=new Date(_0x3e52c5['expiry_date']),_0x5be323=('0'+_0x5f4415['getDate']())[_0x4fcd73(0x21b)](-0x2),_0x1e295b=('0'+(_0x5f4415['getMonth']()+0x1))[_0x4fcd73(0x21b)](-0x2),_0x44c8e3=_0x5f4415[_0x4fcd73(0x16b)](),_0x4920ca=_0x44c8e3+'-'+_0x1e295b+'-'+_0x5be323;if(_0x17eb8e[0x0]['language']==_0x4fcd73(0x258)){var _0x111db9=users[_0x4fcd73(0x227)];console[_0x4fcd73(0x1d1)](_0x111db9);}else{if(_0x17eb8e[0x0][_0x4fcd73(0x1e3)]==_0x4fcd73(0x23e))var _0x111db9=users[_0x4fcd73(0x23e)];else{if(_0x17eb8e[0x0]['language']=='German')var _0x111db9=users[_0x4fcd73(0x28f)];else{if(_0x17eb8e[0x0][_0x4fcd73(0x1e3)]==_0x4fcd73(0x18b))var _0x111db9=users[_0x4fcd73(0x18b)];else{if(_0x17eb8e[0x0]['language']==_0x4fcd73(0x254))var _0x111db9=users[_0x4fcd73(0x254)];else{if(_0x17eb8e[0x0][_0x4fcd73(0x1e3)]==_0x4fcd73(0x1ff))var _0x111db9=users['Portuguese'];else{if(_0x17eb8e[0x0][_0x4fcd73(0x1e3)]==_0x4fcd73(0x1b0))var _0x111db9=users[_0x4fcd73(0x1b0)];else{if(_0x17eb8e[0x0][_0x4fcd73(0x1e3)]==_0x4fcd73(0x292))var _0x111db9=users[_0x4fcd73(0x17a)];}}}}}}}_0x26c3a0['render']('edit_purchases_finished_view',{'success':_0x33927b['flash']('success'),'errors':_0x33927b[_0x4fcd73(0x1e4)](_0x4fcd73(0x214)),'role':_0x58a5e1,'profile':_0x45e08a,'purchases':_0x3e52c5,'suppliers':_0x432b95,'warehouse':_0x3fcdb2,'product':_0x2dbb6f,'master_shop':_0x17eb8e,'language':_0x111db9,'ed_fullDate':_0x4920ca,'dataSelected':_0x5da5b8});}catch(_0x84acad){console[_0x4fcd73(0x1d1)](_0x84acad);}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x29f),auth,async(_0x28a5d4,_0x1f670d)=>{var _0x11c5cf=a0_0xdfc6ce;try{const {username:_0x17dc6a,email:_0x1abcd4,role:_0x5016c1}=_0x28a5d4[_0x11c5cf(0x24b)],_0x58fca1=_0x28a5d4[_0x11c5cf(0x24b)],_0x12ffbb=await profile[_0x11c5cf(0x1b3)]({'email':_0x58fca1[_0x11c5cf(0x1d0)]}),_0x5c444b=await master_shop[_0x11c5cf(0x2a9)](),_0x23a789=_0x28a5d4[_0x11c5cf(0x16e)]['id'],_0x41f730=await purchases_finished['findById'](_0x23a789),_0x1a2c88=await suppliers['find']({});let _0x267c41;if(_0x58fca1[_0x11c5cf(0x184)]==_0x11c5cf(0x21e)){const _0x10d651=await staff['findOne']({'email':_0x58fca1[_0x11c5cf(0x1d0)]});_0x267c41=await warehouse['find']({'status':_0x11c5cf(0x226),'name':_0x10d651[_0x11c5cf(0x1ca)],'warehouse_category':_0x11c5cf(0x20f)});}else _0x267c41=await warehouse[_0x11c5cf(0x27d)]([{'$match':{'status':_0x11c5cf(0x226),'warehouse_category':_0x11c5cf(0x20f)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5d6b1d=await product[_0x11c5cf(0x2a9)]({}),_0x19023f=BayBinSelected(_0x41f730['warehouse_name'],_0x41f730[_0x11c5cf(0x2bc)]);let _0x34e3d8=new Date(_0x41f730[_0x11c5cf(0x2a4)]),_0x31c8dc=('0'+_0x34e3d8[_0x11c5cf(0x188)]())[_0x11c5cf(0x21b)](-0x2),_0x1cf229=('0'+(_0x34e3d8[_0x11c5cf(0x2a7)]()+0x1))[_0x11c5cf(0x21b)](-0x2),_0x17f3b6=_0x34e3d8[_0x11c5cf(0x16b)](),_0xe09c32=_0x17f3b6+'-'+_0x1cf229+'-'+_0x31c8dc;if(_0x5c444b[0x0]['language']=='English\x20(US)'){var _0x20c6cf=users['English'];console[_0x11c5cf(0x1d1)](_0x20c6cf);}else{if(_0x5c444b[0x0][_0x11c5cf(0x1e3)]==_0x11c5cf(0x23e))var _0x20c6cf=users['Hindi'];else{if(_0x5c444b[0x0][_0x11c5cf(0x1e3)]==_0x11c5cf(0x28f))var _0x20c6cf=users[_0x11c5cf(0x28f)];else{if(_0x5c444b[0x0][_0x11c5cf(0x1e3)]==_0x11c5cf(0x18b))var _0x20c6cf=users['Spanish'];else{if(_0x5c444b[0x0][_0x11c5cf(0x1e3)]==_0x11c5cf(0x254))var _0x20c6cf=users[_0x11c5cf(0x254)];else{if(_0x5c444b[0x0][_0x11c5cf(0x1e3)]=='Portuguese\x20(BR)')var _0x20c6cf=users[_0x11c5cf(0x29e)];else{if(_0x5c444b[0x0][_0x11c5cf(0x1e3)]=='Chinese')var _0x20c6cf=users['Chinese'];else{if(_0x5c444b[0x0]['language']=='Arabic\x20(ae)')var _0x20c6cf=users[_0x11c5cf(0x17a)];}}}}}}}_0x1f670d[_0x11c5cf(0x20b)](_0x11c5cf(0x174),{'success':_0x28a5d4[_0x11c5cf(0x1e4)](_0x11c5cf(0x25a)),'errors':_0x28a5d4[_0x11c5cf(0x1e4)](_0x11c5cf(0x214)),'role':_0x58fca1,'profile':_0x12ffbb,'purchases':_0x41f730,'suppliers':_0x1a2c88,'warehouse':_0x267c41,'product':_0x5d6b1d,'master_shop':_0x5c444b,'language':_0x20c6cf,'ed_fullDate':_0xe09c32,'dataSelected':_0x19023f});}catch(_0x1c0477){console[_0x11c5cf(0x1d1)](_0x1c0477);}}),router['post'](a0_0xdfc6ce(0x29f),auth,async(_0x410123,_0x366ae2)=>{var _0x1ebf20=a0_0xdfc6ce;try{const _0x5e8eb9=_0x410123[_0x1ebf20(0x16e)]['id'],_0x1b53d0=await purchases_finished[_0x1ebf20(0x1b3)]({'_id':_0x410123['params']['id']}),_0x5cbaf1=await warehouse[_0x1ebf20(0x1b3)]({'name':_0x1b53d0['warehouse_name'],'room':_0x1b53d0[_0x1ebf20(0x2bc)]});_0x1b53d0[_0x1ebf20(0x26b)]['forEach'](_0xd68a23=>{var _0x321855=_0x1ebf20;const _0x38e167=_0x5cbaf1[_0x321855(0x25d)]['map'](_0x29faca=>{var _0x1f0ae8=_0x321855;_0x29faca[_0x1f0ae8(0x241)]==_0xd68a23[_0x1f0ae8(0x241)]&&_0x29faca[_0x1f0ae8(0x209)]==_0xd68a23[_0x1f0ae8(0x209)]&&(_0x29faca[_0x1f0ae8(0x26c)]=parseInt(_0x29faca[_0x1f0ae8(0x26c)])-parseInt(_0xd68a23['quantity']));});}),await _0x5cbaf1[_0x1ebf20(0x25b)]();const {invoice:_0x1b21a3,suppliers:_0x70f4f3,date:_0x17e8b2,warehouse_name:_0x590b34,prod_name:_0x160121,prod_code:_0x14f622,prod_qty:_0x299b3a,prod_unit:_0x594873,prod_secondunit:_0x329ff4,prod_level:_0x2a428e,prod_isle:_0x30c54a,prod_pallet:_0x4fd0cf,note:_0x1259c0,expiry_date:_0x52e411,batch_code:_0x5edd0e,paid_amount:_0x38090c,due_amount:_0x2b2712,Room_name:_0x227b19,primary_code:_0x5ab2eb,secondary_code:_0x4a9ee5,PO_number:_0x33d4df,JO_number:_0x2ce734}=_0x410123[_0x1ebf20(0x178)];if(typeof _0x160121=='string')var _0x4b61e6=[_0x410123[_0x1ebf20(0x178)]['prod_name']],_0x5dcd7c=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x222)]],_0x398c7a=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x299)]],_0x48e559=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x1f4)]],_0x498b81=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x2b9)]],_0xbef879=[_0x410123['body'][_0x1ebf20(0x1db)]],_0x47d745=[_0x410123['body']['primary_code']],_0x20f78a=[_0x410123['body']['secondary_code']],_0x4dc563=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x22c)]],_0x1d2db6=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x24a)]],_0x242b4d=[_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x2a4)]];else var _0x4b61e6=[..._0x410123[_0x1ebf20(0x178)]['prod_name']],_0x5dcd7c=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x222)]],_0x398c7a=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x299)]],_0x48e559=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x1f4)]],_0x498b81=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x2b9)]],_0xbef879=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x1db)]],_0x47d745=[..._0x410123['body'][_0x1ebf20(0x181)]],_0x20f78a=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x199)]],_0x4dc563=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x22c)]],_0x1d2db6=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x24a)]],_0x242b4d=[..._0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x2a4)]];const _0x5b002d=_0x4b61e6[_0x1ebf20(0x2af)](_0x142134=>{return _0x142134={'product_name':_0x142134};});_0x5dcd7c[_0x1ebf20(0x2a6)]((_0x4ca756,_0x14e8be)=>{_0x5b002d[_0x14e8be]['product_code']=_0x4ca756;}),_0x398c7a[_0x1ebf20(0x2a6)]((_0x2740fd,_0x5df7b1)=>{_0x5b002d[_0x5df7b1]['quantity']=_0x2740fd;}),_0x48e559[_0x1ebf20(0x2a6)]((_0x1d26d9,_0x5b61e5)=>{var _0xa3f401=_0x1ebf20;_0x5b002d[_0x5b61e5][_0xa3f401(0x21a)]=_0x1d26d9;}),_0x498b81[_0x1ebf20(0x2a6)]((_0x5e5302,_0x9e0803)=>{var _0x2e937b=_0x1ebf20;_0x5b002d[_0x9e0803][_0x2e937b(0x173)]=_0x5e5302;}),_0xbef879['forEach']((_0x2bd82d,_0xa15435)=>{_0x5b002d[_0xa15435]['bay']=_0x2bd82d;}),_0x47d745[_0x1ebf20(0x2a6)]((_0x3f0054,_0x5142f8)=>{_0x5b002d[_0x5142f8]['primary_code']=_0x3f0054;}),_0x20f78a['forEach']((_0x2a48e3,_0x4f4ba6)=>{var _0x17a70a=_0x1ebf20;_0x5b002d[_0x4f4ba6][_0x17a70a(0x199)]=_0x2a48e3;}),_0x4dc563[_0x1ebf20(0x2a6)]((_0x5e63ff,_0x2b8e1d)=>{_0x5b002d[_0x2b8e1d]['maxStocks']=_0x5e63ff;}),_0x1d2db6[_0x1ebf20(0x2a6)]((_0x914300,_0x514d08)=>{var _0x5ca389=_0x1ebf20;_0x5b002d[_0x514d08][_0x5ca389(0x24a)]=_0x914300;}),_0x242b4d['forEach']((_0x3d40d1,_0x416c8f)=>{var _0x28721e=_0x1ebf20;_0x5b002d[_0x416c8f][_0x28721e(0x2a4)]=_0x3d40d1;});const _0x18a432=_0x5b002d['filter'](_0x2fe27c=>_0x2fe27c[_0x1ebf20(0x2b1)]!=='0'&&_0x2fe27c['quantity']!=='');_0x1b53d0[_0x1ebf20(0x2b6)]=_0x1b21a3,_0x1b53d0[_0x1ebf20(0x17e)]=_0x70f4f3,_0x1b53d0[_0x1ebf20(0x284)]=_0x17e8b2,_0x1b53d0[_0x1ebf20(0x1f6)]=_0x590b34,_0x1b53d0[_0x1ebf20(0x26b)]=_0x18a432,_0x1b53d0[_0x1ebf20(0x24d)]=_0x1259c0,_0x1b53d0[_0x1ebf20(0x1dc)]=_0x38090c,_0x1b53d0['due_amount']=_0x2b2712,_0x1b53d0[_0x1ebf20(0x2bc)]=_0x227b19,_0x1b53d0[_0x1ebf20(0x19d)]=_0x33d4df,_0x1b53d0[_0x1ebf20(0x1cd)]=_0x2ce734;const _0x590022=await _0x1b53d0[_0x1ebf20(0x25b)](),_0x2db02c=await warehouse[_0x1ebf20(0x1b3)]({'name':_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x1f6)],'room':_0x410123[_0x1ebf20(0x178)]['Room_name']});_0x1b53d0[_0x1ebf20(0x26b)][_0x1ebf20(0x2a6)](_0x186d9e=>{var _0x2ad3bf=_0x1ebf20,_0x1d6991=0x0;const _0x570c5a=_0x2db02c[_0x2ad3bf(0x25d)][_0x2ad3bf(0x2af)](_0x7389e2=>{var _0x51e91d=_0x2ad3bf;_0x7389e2[_0x51e91d(0x241)]==_0x186d9e[_0x51e91d(0x241)]&&_0x7389e2['bay']==_0x186d9e[_0x51e91d(0x209)]&&(_0x7389e2['product_stock']=parseInt(_0x7389e2[_0x51e91d(0x26c)])+parseInt(_0x186d9e[_0x51e91d(0x2b1)]),_0x1d6991++);});_0x1d6991=='0'&&(_0x2db02c[_0x2ad3bf(0x25d)]=_0x2db02c[_0x2ad3bf(0x25d)][_0x2ad3bf(0x24e)]({'product_name':_0x186d9e[_0x2ad3bf(0x241)],'product_stock':_0x186d9e[_0x2ad3bf(0x2b1)],'primary_code':_0x186d9e[_0x2ad3bf(0x181)],'secondary_code':_0x186d9e[_0x2ad3bf(0x199)],'product_code':_0x186d9e[_0x2ad3bf(0x24f)],'bay':_0x186d9e[_0x2ad3bf(0x209)],'maxProducts':_0x186d9e['maxStocks'],'unit':_0x186d9e[_0x2ad3bf(0x21a)],'secondary_unit':_0x186d9e[_0x2ad3bf(0x173)],'expiry_date':_0x186d9e[_0x2ad3bf(0x2a4)]}));}),await _0x2db02c['save']();const _0x326bed=await s_payment_data[_0x1ebf20(0x1b3)]({'invoice':_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x2b6)]});if(_0x326bed===null){}else console[_0x1ebf20(0x1d1)]('suppliers',_0x326bed,_0x410123['body'][_0x1ebf20(0x2b6)]),_0x326bed[_0x1ebf20(0x17e)]=_0x410123[_0x1ebf20(0x178)][_0x1ebf20(0x17e)],await _0x326bed[_0x1ebf20(0x25b)]();_0x410123[_0x1ebf20(0x1e4)](_0x1ebf20(0x25a),_0x1ebf20(0x26a)),_0x366ae2['redirect'](_0x1ebf20(0x1fb));}catch(_0x115b60){console['log'](_0x115b60);}}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x27f),auth,async(_0x439281,_0x493b3e)=>{var _0xafe610=a0_0xdfc6ce;try{const _0x2eba56=_0x439281[_0xafe610(0x16e)]['id'],{invoice:_0x16495c,suppliers:_0x3010b6,payable:_0x234012,due_amount:_0x5e70ec}=_0x439281[_0xafe610(0x178)],_0x5695c9=await purchases[_0xafe610(0x235)](_0x2eba56);var _0x28d55a=_0x234012-_0x5e70ec;_0x5695c9[_0xafe610(0x1dc)]=parseFloat(_0x5695c9[_0xafe610(0x1dc)])+parseFloat(_0x5e70ec),_0x5695c9['due_amount']=_0x28d55a;const _0x49b4a5=await _0x5695c9[_0xafe610(0x25b)]();console[_0xafe610(0x1d1)](_0x49b4a5);const _0x2f1925=await s_payment_data[_0xafe610(0x1b3)]({'invoice':_0x16495c});_0x2f1925[_0xafe610(0x275)]=_0x28d55a,await _0x2f1925[_0xafe610(0x25b)]();let _0x37ac01=new Date(),_0x43d52f=('0'+_0x37ac01[_0xafe610(0x188)]())['slice'](-0x2),_0x4e94e0=('0'+(_0x37ac01[_0xafe610(0x2a7)]()+0x1))['slice'](-0x2),_0x12cbec=_0x37ac01['getFullYear'](),_0x468348=_0x12cbec+'-'+_0x4e94e0+'-'+_0x43d52f;const _0x599d55=new suppliers_payment({'invoice':_0x16495c,'date':_0x12cbec+'-'+_0x4e94e0+'-'+_0x43d52f,'suppliers':_0x3010b6,'reason':_0xafe610(0x202),'amount':_0x5e70ec}),_0x4c69d4=await _0x599d55[_0xafe610(0x25b)]();_0x439281['flash'](_0xafe610(0x25a),_0xafe610(0x208)),_0x493b3e[_0xafe610(0x1f2)]('/all_purchases/view');}catch(_0x4d8d60){console['log'](_0x4d8d60);}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x1e8),auth,async(_0x25eacb,_0x192eb1)=>{var _0x59e137=a0_0xdfc6ce;try{const {username:_0x22c8c0,email:_0x5a7349,role:_0x7c7a73}=_0x25eacb['user'],_0x3e3645=_0x25eacb[_0x59e137(0x24b)],_0x532a30=await profile[_0x59e137(0x1b3)]({'email':_0x3e3645['email']}),_0x5a0e60=await master_shop[_0x59e137(0x2a9)]();console[_0x59e137(0x1d1)](_0x59e137(0x179),_0x5a0e60);const _0x49d10b=_0x25eacb['params']['id'],_0x40d128=await purchases[_0x59e137(0x235)](_0x49d10b);console[_0x59e137(0x1d1)](_0x40d128);const _0x3ff186=await suppliers[_0x59e137(0x1b3)]({'name':_0x40d128[_0x59e137(0x17e)]});console['log'](_0x3ff186);if(_0x5a0e60[0x0][_0x59e137(0x1e3)]=='English\x20(US)'){var _0x2a9212=users[_0x59e137(0x227)];console['log'](_0x2a9212);}else{if(_0x5a0e60[0x0][_0x59e137(0x1e3)]==_0x59e137(0x23e))var _0x2a9212=users[_0x59e137(0x23e)];else{if(_0x5a0e60[0x0]['language']=='German')var _0x2a9212=users['German'];else{if(_0x5a0e60[0x0][_0x59e137(0x1e3)]=='Spanish')var _0x2a9212=users[_0x59e137(0x18b)];else{if(_0x5a0e60[0x0]['language']=='French')var _0x2a9212=users[_0x59e137(0x254)];else{if(_0x5a0e60[0x0][_0x59e137(0x1e3)]==_0x59e137(0x1ff))var _0x2a9212=users[_0x59e137(0x29e)];else{if(_0x5a0e60[0x0][_0x59e137(0x1e3)]=='Chinese')var _0x2a9212=users[_0x59e137(0x1b0)];else{if(_0x5a0e60[0x0]['language']==_0x59e137(0x292))var _0x2a9212=users[_0x59e137(0x17a)];}}}}}}}_0x192eb1['render'](_0x59e137(0x2a3),{'success':_0x25eacb[_0x59e137(0x1e4)](_0x59e137(0x25a)),'errors':_0x25eacb[_0x59e137(0x1e4)](_0x59e137(0x214)),'role':_0x3e3645,'profile':_0x532a30,'master_shop':_0x5a0e60,'supplier':_0x3ff186,'purchase':_0x40d128,'language':_0x2a9212});}catch(_0x96499f){console[_0x59e137(0x1d1)](_0x96499f);}}),router[a0_0xdfc6ce(0x1d4)](a0_0xdfc6ce(0x1cb),auth,async(_0x1abef0,_0x4aa5dd)=>{var _0x1e2860=a0_0xdfc6ce;try{const {username:_0x1c6d8c,email:_0x5df053,role:_0x2dc830}=_0x1abef0['user'],_0x3d7400=_0x1abef0[_0x1e2860(0x24b)],_0x12df7f=await profile['findOne']({'email':_0x3d7400[_0x1e2860(0x1d0)]}),_0x5e7351=await master_shop[_0x1e2860(0x2a9)]();console['log'](_0x1e2860(0x179),_0x5e7351);const _0x1b2f7c=_0x1abef0['params']['id'];console['log'](_0x1b2f7c);const _0x30e6d5=await purchases_finished[_0x1e2860(0x235)](_0x1b2f7c);console[_0x1e2860(0x1d1)](_0x1e2860(0x19b),_0x30e6d5);const _0x3588f2=await product['find']({}),_0xc4ae10=await warehouse[_0x1e2860(0x27d)]([{'$match':{'name':_0x30e6d5['warehouse_name'],'room':_0x30e6d5[_0x1e2860(0x2bc)]}},{'$unwind':_0x1e2860(0x190)},{'$group':{'_id':_0x1e2860(0x18a),'name':{'$first':_0x1e2860(0x238)},'product_stock':{'$first':_0x1e2860(0x1bd)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1e2860(0x2a2)},'type':{'$first':_0x1e2860(0x212)},'floorlevel':{'$first':_0x1e2860(0x1ef)},'primary_code':{'$first':_0x1e2860(0x1f1)},'secondary_code':{'$first':_0x1e2860(0x1b7)},'product_code':{'$first':_0x1e2860(0x1a2)},'storage':{'$first':_0x1e2860(0x1f5)},'rack':{'$first':_0x1e2860(0x1e6)}}}]);console['log'](_0x1e2860(0x251),_0xc4ae10);let _0x255320;if(_0x3d7400['role']==_0x1e2860(0x21e)){const _0x4c82f2=await staff[_0x1e2860(0x1b3)]({'email':_0x3d7400[_0x1e2860(0x1d0)]});_0x255320=await warehouse[_0x1e2860(0x2a9)]({'status':_0x1e2860(0x226),'name':_0x4c82f2[_0x1e2860(0x1ca)],'warehouse_category':_0x1e2860(0x20f),'name':_0x1e2860(0x273)});}else _0x255320=await warehouse[_0x1e2860(0x27d)]([{'$match':{'status':'Enabled','warehouse_category':_0x1e2860(0x20f),'name':_0x1e2860(0x273)}},{'$group':{'_id':_0x1e2860(0x1ad),'name':{'$first':_0x1e2860(0x1ad)}}}]);if(_0x5e7351[0x0]['language']==_0x1e2860(0x258)){var _0xace9c3=users[_0x1e2860(0x227)];console[_0x1e2860(0x1d1)](_0xace9c3);}else{if(_0x5e7351[0x0][_0x1e2860(0x1e3)]==_0x1e2860(0x23e))var _0xace9c3=users[_0x1e2860(0x23e)];else{if(_0x5e7351[0x0]['language']=='German')var _0xace9c3=users['German'];else{if(_0x5e7351[0x0][_0x1e2860(0x1e3)]=='Spanish')var _0xace9c3=users[_0x1e2860(0x18b)];else{if(_0x5e7351[0x0][_0x1e2860(0x1e3)]==_0x1e2860(0x254))var _0xace9c3=users[_0x1e2860(0x254)];else{if(_0x5e7351[0x0][_0x1e2860(0x1e3)]==_0x1e2860(0x1ff))var _0xace9c3=users[_0x1e2860(0x29e)];else{if(_0x5e7351[0x0][_0x1e2860(0x1e3)]==_0x1e2860(0x1b0))var _0xace9c3=users[_0x1e2860(0x1b0)];else{if(_0x5e7351[0x0][_0x1e2860(0x1e3)]==_0x1e2860(0x292))var _0xace9c3=users[_0x1e2860(0x17a)];}}}}}}}_0x4aa5dd[_0x1e2860(0x20b)](_0x1e2860(0x203),{'success':_0x1abef0[_0x1e2860(0x1e4)](_0x1e2860(0x25a)),'errors':_0x1abef0['flash'](_0x1e2860(0x214)),'role':_0x3d7400,'profile':_0x12df7f,'user':_0x30e6d5,'stock':_0xc4ae10,'master_shop':_0x5e7351,'product':_0x3588f2,'language':_0xace9c3,'warehouse':_0x255320});}catch(_0x3232c0){console[_0x1e2860(0x1d1)](_0x3232c0);}}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x1cb),auth,async(_0x274328,_0x3f97e8)=>{var _0x1c5124=a0_0xdfc6ce;try{const {invoice:_0x1859be,date:_0x10429b,warehouse_name:_0x5b6e6a,Room_name:_0x231f27,product_name:_0xe8b5b9,purchase_quantity:_0x36b999,stocks:_0xf66d0d,return_qty:_0x5d6201,note:_0xe5251,level:_0x44000f,isle:_0x2ce4de,pallet:_0x3e456d,to_warehouse_name:_0x4ba2c1,to_Room_name:_0x24987d}=_0x274328[_0x1c5124(0x178)],_0x3e2396=await purchases_finished['findOne']({'_id':_0x274328[_0x1c5124(0x16e)]['id']}),_0x335b32=await warehouse[_0x1c5124(0x1b3)]({'name':_0x5b6e6a,'room':_0x231f27,'warehouse_category':_0x1c5124(0x20f)});if(typeof _0xe8b5b9=='string')var _0x23379b=[_0x274328['body'][_0x1c5124(0x241)]],_0x4edb10=[_0x274328[_0x1c5124(0x178)][_0x1c5124(0x213)]],_0x68e0c4=[_0x274328['body']['stocks']],_0x183e82=[_0x274328['body'][_0x1c5124(0x193)]],_0x3d6649=[_0x274328[_0x1c5124(0x178)][_0x1c5124(0x1ac)]],_0x313be5=[_0x274328[_0x1c5124(0x178)][_0x1c5124(0x1bc)]],_0x587a72=[_0x274328[_0x1c5124(0x178)]['primary_code_hide']],_0x4d06c7=[_0x274328[_0x1c5124(0x178)][_0x1c5124(0x278)]];else var _0x23379b=[..._0x274328[_0x1c5124(0x178)][_0x1c5124(0x241)]],_0x4edb10=[..._0x274328[_0x1c5124(0x178)][_0x1c5124(0x213)]],_0x68e0c4=[..._0x274328['body'][_0x1c5124(0x247)]],_0x183e82=[..._0x274328[_0x1c5124(0x178)][_0x1c5124(0x193)]],_0x3d6649=[..._0x274328[_0x1c5124(0x178)][_0x1c5124(0x1ac)]],_0x313be5=[..._0x274328['body'][_0x1c5124(0x1bc)]],_0x587a72=[..._0x274328[_0x1c5124(0x178)][_0x1c5124(0x1a9)]],_0x4d06c7=[..._0x274328[_0x1c5124(0x178)][_0x1c5124(0x278)]];const _0x459662=_0x23379b[_0x1c5124(0x2af)](_0x196d97=>{return _0x196d97={'product_name':_0x196d97};});_0x4edb10['forEach']((_0x3ebf6d,_0x870411)=>{_0x459662[_0x870411]['purchase_quantity']=_0x3ebf6d;}),_0x68e0c4[_0x1c5124(0x2a6)]((_0x2e302e,_0x431be6)=>{var _0xfa64c1=_0x1c5124;_0x459662[_0x431be6][_0xfa64c1(0x20d)]=_0x2e302e;}),_0x183e82[_0x1c5124(0x2a6)]((_0x22d635,_0x407451)=>{var _0x1aa3ce=_0x1c5124;_0x459662[_0x407451][_0x1aa3ce(0x193)]=_0x22d635;}),_0x3d6649[_0x1c5124(0x2a6)]((_0x43c1c9,_0x245a7e)=>{var _0x5a47aa=_0x1c5124;_0x459662[_0x245a7e][_0x5a47aa(0x209)]=_0x43c1c9;}),_0x313be5['forEach']((_0xe39276,_0x1685c6)=>{var _0x21c81e=_0x1c5124;_0x459662[_0x1685c6][_0x21c81e(0x24f)]=_0xe39276;}),_0x587a72[_0x1c5124(0x2a6)]((_0x2a0218,_0x3fc83b)=>{var _0x652153=_0x1c5124;_0x459662[_0x3fc83b][_0x652153(0x181)]=_0x2a0218;}),_0x4d06c7[_0x1c5124(0x2a6)]((_0x27899d,_0xba46ed)=>{var _0xf3c2b5=_0x1c5124;_0x459662[_0xba46ed][_0xf3c2b5(0x199)]=_0x27899d;}),_0x459662[_0x1c5124(0x2a6)](_0x4f27a0=>{var _0x2345ae=_0x1c5124;console[_0x2345ae(0x1d1)](_0x4f27a0);const _0x526e92=_0x335b32['product_details'][_0x2345ae(0x2af)](_0x25a648=>{var _0x8c6b96=_0x2345ae;_0x25a648['product_name']==_0x4f27a0[_0x8c6b96(0x241)]&&_0x25a648[_0x8c6b96(0x209)]==_0x4f27a0[_0x8c6b96(0x209)]&&(console['log'](parseInt(_0x25a648['product_stock'])+_0x8c6b96(0x2a1)+parseInt(_0x4f27a0[_0x8c6b96(0x193)])),_0x25a648[_0x8c6b96(0x26c)]=parseInt(_0x25a648[_0x8c6b96(0x26c)])-parseInt(_0x4f27a0[_0x8c6b96(0x193)]));});}),await _0x335b32['save']();var _0x1f2665=0x0;_0x459662['forEach'](_0x4adbac=>{var _0x970522=_0x1c5124;(parseInt(_0x4adbac[_0x970522(0x213)])<parseInt(_0x4adbac[_0x970522(0x193)])||parseInt(_0x4adbac['stock_quantity'])<parseInt(_0x4adbac[_0x970522(0x193)]))&&_0x1f2665++;});if(_0x1f2665!=0x0)return _0x274328[_0x1c5124(0x1e4)](_0x1c5124(0x214),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3f97e8[_0x1c5124(0x1f2)](_0x1c5124(0x288));const _0x33e072=new purchases_return_finished({'invoice':_0x1859be,'suppliers':_0x274328[_0x1c5124(0x178)]['suppliers'],'date':_0x10429b,'warehouse_name':_0x5b6e6a,'return_product':_0x459662,'note':_0xe5251,'room':_0x231f27,'to_warehouse_name':_0x4ba2c1,'to_room':_0x24987d}),_0x3c218e=await _0x33e072[_0x1c5124(0x25b)](),_0x25bfb8=await purchases_return_finished[_0x1c5124(0x1b3)]({'invoice':_0x1859be}),_0x2d552b=await warehouse['findOne']({'name':_0x4ba2c1,'room':_0x24987d,'warehouse_category':_0x1c5124(0x20f)});_0x25bfb8[_0x1c5124(0x1bb)][_0x1c5124(0x2a6)](_0x1e0b7e=>{var _0xb57149=_0x1c5124,_0x7d676=0x0;const _0x42bca2=_0x2d552b['product_details'][_0xb57149(0x2af)](_0x1dd651=>{var _0x53052c=_0xb57149;console[_0x53052c(0x1d1)](_0x1dd651[_0x53052c(0x241)]+'=='+_0x1e0b7e[_0x53052c(0x241)]+'&&'+_0x1dd651[_0x53052c(0x209)]+'=='+_0x1e0b7e[_0x53052c(0x209)]),_0x1dd651[_0x53052c(0x241)]==_0x1e0b7e['product_name']&&_0x1dd651[_0x53052c(0x209)]==_0x1e0b7e[_0x53052c(0x209)]&&(_0x1dd651[_0x53052c(0x26c)]=parseInt(_0x1dd651['product_stock'])-parseInt(_0x1e0b7e[_0x53052c(0x193)]),_0x7d676++);});_0x7d676=='0'&&(_0x2d552b[_0xb57149(0x25d)]=_0x2d552b[_0xb57149(0x25d)][_0xb57149(0x24e)]({'product_name':_0x1e0b7e[_0xb57149(0x241)],'product_stock':_0x1e0b7e['return_qty'],'primary_code':_0x1e0b7e['primary_code'],'secondary_code':_0x1e0b7e[_0xb57149(0x199)],'product_code':_0x1e0b7e[_0xb57149(0x24f)],'bay':_0x1e0b7e['bay'],'maxProducts':0xf423f}));}),await _0x2d552b[_0x1c5124(0x25b)]();const _0x4c2b60=await purchases_finished['findOne']({'invoice':_0x1859be});_0x4c2b60[_0x1c5124(0x25c)]=_0x1c5124(0x270);const _0x174df2=await _0x4c2b60[_0x1c5124(0x25b)](),_0x4b9b8e=new s_payment_data({'invoice':_0x1859be,'suppliers':_0x274328[_0x1c5124(0x178)][_0x1c5124(0x17e)],'reason':'Purchase\x20Return'});await _0x4b9b8e[_0x1c5124(0x25b)]();const _0x4db240=await master_shop[_0x1c5124(0x2a9)](),_0x491abb=await email_settings['findOne'](),_0x166c7c=await suppliers['findOne']({'name':_0x274328[_0x1c5124(0x178)][_0x1c5124(0x17e)]});_0x4db240[0x0][_0x1c5124(0x1ed)]==0x1?(right_currency=_0x4db240[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4db240[0x0]['currency']);var _0x25cc9d=_0x23379b,_0x2aae1c=_0x183e82,_0x24ae44='',_0x26907f;for(_0x26907f in _0x25cc9d){_0x24ae44+=_0x1c5124(0x1a8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x25cc9d[_0x26907f]+_0x1c5124(0x276)+_0x1c5124(0x1d3)+_0x2aae1c[_0x26907f]+'</td>'+'</tr>';}let _0xac62a3=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x491abb['email'],'pass':_0x491abb[_0x1c5124(0x265)]}}),_0x3021a2={'from':_0x491abb[_0x1c5124(0x1d0)],'to':_0x166c7c[_0x1c5124(0x1d0)],'subject':_0x1c5124(0x185),'attachments':[{'filename':_0x1c5124(0x2b7),'path':__dirname+'/../public'+_0x1c5124(0x17f)+_0x4db240[0x0][_0x1c5124(0x280)],'cid':_0x1c5124(0x295)}],'html':'<!DOCTYPE\x20html>'+_0x1c5124(0x1e2)+_0x1c5124(0x1d2)+_0x1c5124(0x22e)+_0x1c5124(0x263)+_0x1c5124(0x22e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1c5124(0x256)+_0x1c5124(0x22e)+_0x1c5124(0x1f0)+_0x4db240[0x0]['site_title']+_0x1c5124(0x228)+_0x1c5124(0x256)+_0x1c5124(0x256)+_0x1c5124(0x27c)+_0x1c5124(0x22e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x1859be+'\x20'+_0x1c5124(0x1ab)+_0x1c5124(0x2ba)+_0x10429b+'\x20'+_0x1c5124(0x234)+_0x1c5124(0x171)+'</div>'+_0x1c5124(0x261)+_0x1c5124(0x23b)+_0x1c5124(0x1a8)+_0x1c5124(0x252)+_0x1c5124(0x192)+_0x1c5124(0x231)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x1c5124(0x180)+_0x1c5124(0x255)+'\x20'+_0x24ae44+'\x20'+'</tbody>'+_0x1c5124(0x2b4)+_0x1c5124(0x22e)+_0x1c5124(0x260)+_0x1c5124(0x205)+_0x4db240[0x0][_0x1c5124(0x283)]+_0x1c5124(0x171)+'</div>'+_0x1c5124(0x256)+_0x1c5124(0x186)};_0xac62a3[_0x1c5124(0x216)](_0x3021a2,function(_0x40d808,_0x149776){var _0x27c7d5=_0x1c5124;_0x40d808?console[_0x27c7d5(0x1d1)]('Error\x20Occurs'):console[_0x27c7d5(0x1d1)](_0x27c7d5(0x19c));}),_0x274328[_0x1c5124(0x1e4)]('success',_0x1c5124(0x1c0)),_0x3f97e8[_0x1c5124(0x1f2)](_0x1c5124(0x1fb));}catch(_0x2aa395){_0x3f97e8[_0x1c5124(0x1d9)](0xc8)[_0x1c5124(0x281)]({'message':_0x2aa395[_0x1c5124(0x1b1)]});}}),router[a0_0xdfc6ce(0x1d4)]('/barcode/:id',auth,async(_0x31d1ea,_0x4ab361)=>{var _0x44383e=a0_0xdfc6ce;try{const {username:_0x145e4a,email:_0xbafa9e,role:_0x4306aa}=_0x31d1ea[_0x44383e(0x24b)],_0x5dea9f=_0x31d1ea['user'],_0x557aa3=await profile['findOne']({'email':_0x5dea9f[_0x44383e(0x1d0)]}),_0x358793=await master_shop[_0x44383e(0x2a9)](),_0x13efa4=_0x31d1ea['params']['id'],_0x755a0e=await purchases_finished['findById'](_0x13efa4);if(_0x358793[0x0][_0x44383e(0x1e3)]==_0x44383e(0x258))var _0x558a47=users[_0x44383e(0x227)];else{if(_0x358793[0x0][_0x44383e(0x1e3)]==_0x44383e(0x23e))var _0x558a47=users[_0x44383e(0x23e)];else{if(_0x358793[0x0][_0x44383e(0x1e3)]==_0x44383e(0x28f))var _0x558a47=users[_0x44383e(0x28f)];else{if(_0x358793[0x0][_0x44383e(0x1e3)]=='Spanish')var _0x558a47=users[_0x44383e(0x18b)];else{if(_0x358793[0x0][_0x44383e(0x1e3)]=='French')var _0x558a47=users[_0x44383e(0x254)];else{if(_0x358793[0x0]['language']==_0x44383e(0x1ff))var _0x558a47=users[_0x44383e(0x29e)];else{if(_0x358793[0x0][_0x44383e(0x1e3)]=='Chinese')var _0x558a47=users['Chinese'];else{if(_0x358793[0x0][_0x44383e(0x1e3)]==_0x44383e(0x292))var _0x558a47=users[_0x44383e(0x17a)];}}}}}}}_0x4ab361['render'](_0x44383e(0x294),{'success':_0x31d1ea[_0x44383e(0x1e4)](_0x44383e(0x25a)),'errors':_0x31d1ea[_0x44383e(0x1e4)](_0x44383e(0x214)),'role':_0x5dea9f,'profile':_0x557aa3,'alldata':_0x755a0e,'master_shop':_0x358793,'language':_0x558a47}),console[_0x44383e(0x1d1)](alldata);}catch(_0x4a793b){console[_0x44383e(0x1d1)](_0x4a793b);}}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x27a),async(_0xbc1cc9,_0x55f3f0)=>{var _0x26be54=a0_0xdfc6ce;const {product_code:_0x46cbe2}=_0xbc1cc9['body'];var _0x4c1b6e;const _0x1cb543=await product[_0x26be54(0x27d)]([{'$match':{'primary_code':_0x46cbe2}},{'$group':{'_id':_0x26be54(0x250),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x26be54(0x1ea)},'unit':{'$first':_0x26be54(0x187)},'alertquantity':{'$first':_0x26be54(0x277)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x26be54(0x248)},'secondary_code':{'$first':_0x26be54(0x1c9)},'maxStocks':{'$first':_0x26be54(0x197)},'maxProdPerUnit':{'$first':_0x26be54(0x1bf)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x26be54(0x1cf)},'sales_category':{'$first':_0x26be54(0x1c8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x56507d=await product[_0x26be54(0x27d)]([{'$match':{'secondary_code':_0x46cbe2}},{'$group':{'_id':_0x26be54(0x250),'name':{'$first':_0x26be54(0x1ad)},'category':{'$first':'$category'},'brand':{'$first':_0x26be54(0x1ea)},'unit':{'$first':_0x26be54(0x187)},'alertquantity':{'$first':_0x26be54(0x277)},'product_code':{'$first':_0x26be54(0x220)},'primary_code':{'$first':_0x26be54(0x248)},'secondary_code':{'$first':_0x26be54(0x1c9)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x26be54(0x1bf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x26be54(0x16d)},'gross_price':{'$first':_0x26be54(0x1cf)},'sales_category':{'$first':_0x26be54(0x1c8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x1cb543[_0x26be54(0x223)]>0x0)_0x4c1b6e=_0x1cb543;else _0x56507d['length']>0x0&&(_0x4c1b6e=_0x56507d);_0x55f3f0[_0x26be54(0x281)](_0x4c1b6e);}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x1e5),async(_0x3661d5,_0x2743ee)=>{var _0x480c94=a0_0xdfc6ce;const {productCode:_0x16b8ab,bay:_0xec1094,warehouses:_0x4a2536,room:_0x5a483b}=_0x3661d5[_0x480c94(0x178)];console[_0x480c94(0x1d1)](_0x3661d5['body']);try{const _0x2eaf95=await warehouse['aggregate']([{'$match':{'name':_0x4a2536,'room':_0x5a483b}},{'$unwind':_0x480c94(0x190)},{'$match':{'product_details.bay':parseInt(_0xec1094)}},{'$group':{'_id':_0x480c94(0x18a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x480c94(0x1bd)},'bay':{'$first':_0x480c94(0x28e)},'maxProducts':{'$first':_0x480c94(0x287)}}}]);_0x2743ee[_0x480c94(0x1d9)](0xc8)[_0x480c94(0x281)](_0x2eaf95);}catch(_0x30e6de){_0x2743ee[_0x480c94(0x1d9)](0x194)[_0x480c94(0x281)]({'message':_0x30e6de['message']});}}),router[a0_0xdfc6ce(0x175)](a0_0xdfc6ce(0x286),async(_0x2c8105,_0x2b5ad1)=>{var _0x10a1e3=a0_0xdfc6ce;const {product_code:_0x3e4a73}=_0x2c8105[_0x10a1e3(0x178)];var _0x3d876d;const _0x3567d8=await product[_0x10a1e3(0x27d)]([{'$match':{'primary_code':_0x3e4a73,'type_products':'log'}},{'$group':{'_id':_0x10a1e3(0x250),'name':{'$first':_0x10a1e3(0x1ad)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x10a1e3(0x277)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x10a1e3(0x248)},'secondary_code':{'$first':_0x10a1e3(0x1c9)},'maxStocks':{'$first':_0x10a1e3(0x197)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x10a1e3(0x1cf)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x10a1e3(0x1c6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x10a1e3(0x1d1)](_0x3567d8);const _0x23b60c=await product[_0x10a1e3(0x27d)]([{'$match':{'secondary_code':_0x3e4a73,'type_products':'log'}},{'$group':{'_id':_0x10a1e3(0x250),'name':{'$first':_0x10a1e3(0x1ad)},'category':{'$first':_0x10a1e3(0x1b5)},'brand':{'$first':_0x10a1e3(0x1ea)},'unit':{'$first':_0x10a1e3(0x187)},'alertquantity':{'$first':_0x10a1e3(0x277)},'product_code':{'$first':_0x10a1e3(0x220)},'primary_code':{'$first':_0x10a1e3(0x248)},'secondary_code':{'$first':_0x10a1e3(0x1c9)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x10a1e3(0x1bf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x10a1e3(0x16d)},'gross_price':{'$first':_0x10a1e3(0x1cf)},'sales_category':{'$first':_0x10a1e3(0x1c8)},'type_products':{'$first':_0x10a1e3(0x1c6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x3567d8['length']>0x0)_0x3d876d=_0x3567d8;else _0x23b60c[_0x10a1e3(0x223)]>0x0&&(_0x3d876d=_0x23b60c);_0x2b5ad1['json'](_0x3d876d);}),module[a0_0xdfc6ce(0x266)]=router;function a0_0x526c(){var _0x578519=['$product_details.primary_code','redirect','RoomAssign','prod_unit','$product_details.storage','warehouse_name','Asia/Manila','$product.bin',',\x20room:\x20','894915Glmynr','/all_purchases_finished/view','/incoming/add','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Portuguese\x20(BR)','product_date','here2','Paid\x20For\x20Purchase','return_purchase_finished','prod_cat','<h5>','room_name','max','payment\x20successfull','bay','to_quantity','render','/all_purchases_finished/preview/','stock_quantity','$suppliers_docs','Finished\x20Goods','Transfer\x20Finalize\x20Successfully','LOG-INC-','$product_details.type','purchase_quantity','errors','add_purchases\x20error','sendMail','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/getinvoicetrf','standard_unit','slice','Error\x20occurred\x20while\x20processing\x20product:','false','staff','isUsed','$product_code','updateOne','prod_code','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','INC','Enabled','English','\x20</h2>','add_purchases_finished','own','_id','MaxStocks_data','$return_data','<div>','purchases_id','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','INC-','host','</span>','findById','$product.room_name','sales_category','$product_details.product_name','/getTRF','util','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/view/add_purchases','inc','Hindi','DRY\x20GOODS','Rack\x201','product_name','data_type','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','$note','to_bay','$room','stocks','$primary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','batch_code','user','all_purchases_finished','note','concat','product_code','$_id','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','invoice_init','French','<tbody\x20style=\x22text-align:\x20center;\x22>','</div>','abs','English\x20(US)','nodemailer','success','save','return_data','product_details','add_purchases_finished_logs','true','<strong>\x20Regards\x20</strong>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchase\x20data\x20add\x20successfully','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','suppliers_docs','password','exports','floor','An\x20error\x20occurred\x20while\x20saving\x20data.','8RedCzc','purchase\x20data\x20update\x20successfully','product','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','../models/all_models','/../public','True','toLocaleDateString','maxProducts','Return\x20Goods','numeric','amount','</td>','$alertquantity','secondary_code_hide','$suppliers','/barcode_scanner','FGSEmail','<hr\x20class=\x22my-3\x22>','aggregate','item_code','/give_payment/:id','image','json','The\x20Other\x20','site_title','date','$product.bay','/barcode_scanner_logs','$product_details.maxProducts','back','maxStocks','Purchase\x20Mail','product_id','639702KZCvLL','Enclosed','$product_details.bay','German','702840WZDOHN','\x20to\x20warehouse:\x20','Arabic\x20(ae)','bin','all_purchases_barcode','logo','error','sales_data_cateory','$due_amount','prod_qty','/preview/:id','toString','type_of_products','production_date','Portuguese','/view/:id','maxPerUnit','\x20<>\x20','$product_details.bin','purchase_invoice','expiry_date','date_recieved','forEach','getMonth','id_transaction','find','uuid','Ambient','createTransport','gross_price','36kIzGIT','map','all_purchases_finished_logs','quantity','match','port','</table>','15xguaUx','invoice','Logo.png','to_warehouse','prod_secondunit','\x20Order\x20Date\x20:\x20','prod_name','room','getFullYear','$product','$secondary_unit','params','prod_primunit','</tr>','</h5>','logs','secondary_unit','edit_purchases_finished','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','catch','body','master','Arabic','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','string','\x20inc\x20=\x20','suppliers','/upload/','</thead>','primary_code','../public/language/languages.json','\x20===\x20','role','Purchase\x20Return\x20Mail','</body></html>','$unit','getDate','$product.quantity','$product_details._id','Spanish','unit','409012KgoBgL','/view_log','$batch_code','$product_details','min','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','return_qty','FROZEN\x20GOODS','There\x20is\x20','/picking_list/pdf_puchases_fin_own_trf/','$maxStocks','Rack\x202','secondary_code','STAGING\x20AREA\x201','user_id','Email\x20sent\x20successfully','POnumber','padStart','===','$product.floorlevel','1443434FEKDoL','$product_details.product_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','INCF-','/view/add_purchases_logs','Distributing\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<tr>','primary_code_hide','then','<span\x20style=\x22float:\x20right;\x22>','level','$name','isAvailable','<h5\x20style=\x22text-align:\x20left;\x22>','Chinese','message','name','findOne','/process/:id','$category','isProcess','$product_details.secondary_code','prod_Qty','to_recieved','filter','return_product','product_code_hide','$product_details.product_stock','$expiry_date','$maxProdPerUnit','purchases\x20item\x20return\x20successfull','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','all','product_cat','$product.type','random','$type_products','17773970jkPIYD','$sales_category','$secondary_code','warehouse','/view/return_purchase/:id','</tbody>','JO_number','$date','$gross_price','email','log','</head><body>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','10187145UERfCH','/view','max_product_unit','valueOf','status','product_data','prod_level','paid_amount','\x20units\x20of\x20','\x20Order\x20Number\x20:\x20','<!DOCTYPE\x20html>','incoming_add','path','<html><head><title></title>','language','flash','/CheckingWarehouse','$product_details.rack',',\x20bay:\x20','/invoice/:id','$paid_amount','$brand','2-digit','$invoice','currency_placement','$warehouse_name','$product_details.floorlevel','<h2>\x20'];a0_0x526c=function(){return _0x578519;};return a0_0x526c();}