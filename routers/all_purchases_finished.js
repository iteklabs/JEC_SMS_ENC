function a0_0x222f(){var _0x3b3e47=['to_bay','purchases_process','invoice_init','\x20<>\x20','paid_amount','$note','prod_cat','status','</table>','currency_placement','$alertquantity','params','$suppliers_docs','6KdZWiY','$return_data','<h5>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','$product.type','purchase_invoice','\x20units\x20to\x20warehouse:\x20','Transfer\x20Finalize\x20Successfully','$product_details.secondary_code','secondary_code_hide','Arabic\x20(ae)','user','toLocaleDateString','logs','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','language','here2','$product_details.bin','\x20</h2>','type_of_products_type','master','/barcode_scanner','$product_details','$product.room_name','$product','Enabled','1396737uGRCOQ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','date','13946526dCsQjn','/barcode/:id','6032315cGAUIM','floor','$room','$primary_code','/view/add_purchases','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','DRY\x20GOODS','concat','product_data','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</h5>','4zklfdh','$type_products','$brand','7748248NNNntu','secondary_unit','$invoice','</tr>','to_quantity','type_of_products','10RhqjMn','true','/all_purchases/view','MaxStocks_data','Purchase\x20Mail','bin','render','prod_secondunit','all','/view_log','room_name','An\x20error\x20occurred.','prod_qty','$_id','maxStocks','invoice','Email\x20sent\x20successfully','nodemailer','</td>','stock_data','sales_data_cateory','Asia/Manila','forEach','$batch_code','primary_code','email','Spanish','$name','INC-','abs','exports','aggregate','prod_primunit','maxperunit','return_data','Error\x20Occurs','<div>','/view/add_purchases_logs','$maxStocks','user_id','/all_purchases_finished/process/','isProcess','false','util','to_warehouse','stocks','$category','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</thead>','$product_details.maxProducts','standard_unit','Finished\x20Goods','level','Chinese','to_room_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','error','quantity','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','createTransport','warehouse','body','<hr\x20class=\x22my-3\x22>','$product_details.rack','../public/language/languages.json','Paid\x20For\x20Purchase','product_name','item_code','post','then','prod_Qty','to_recieved','prod_name','</head><body>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/:id','/getTRF','/all_purchases_finished/view','$product_details.product_stock','maxProducts','purchases\x20item\x20return\x20successfull','incoming_view','logo','../models/all_models','image','$product_details.product_code','product_details','name','10748717hPEQqc','INCF-','</span>','toString','message','unit','string','<!DOCTYPE\x20html>','Rack\x201','purchase_quantity','/barcode_scanner_logs','purchases_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','_id','date_recieved','Distributing\x20','/incoming/add','/process/:id','English','$unit','INC','map','own','updateOne','$secondary_code','getFullYear','suppliers','$product.floorlevel','Router','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','product_id','secondary_code','slice','Return\x20Goods','$suppliers','add_purchases_finished_logs','max','product_date',',\x20room:\x20','2-digit','edit_purchases_finished','table\x20page','currency','Arabic','<strong>\x20Regards\x20</strong>','$maxProdPerUnit','$due_amount','$product_details.bay','LOG-INC-','primary_code_hide','batch_code','Portuguese','bay','product_code_hide','English\x20(US)','$expiry_date','German','undefined','redirect','$secondary_unit','return_qty','$product.bay','numeric','add_purchases_finished','prod_code','<h2>\x20','$sales_category','return_purchase_finished','98PtQBTP','<html><head><title></title>','site_title','/preview/:id','findById','maxPerUnit','1238ZTneyF','get',',\x20bay:\x20','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_code','<tr>','prod_level','Enclosed','return_product','$product.bin','\x20<=>\x20','Rack\x202','filter','success','product','gross_price','Hindi','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','FROZEN\x20GOODS','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details._id','$date','getDate','valueOf','due_amount','length','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$gross_price','findOne','stock_quantity','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','</body></html>','json','product_stock','role','match','Logo.png','all_purchases_finished','$product.quantity','True','expiry_date','Room_name','save','sales_category','prod_unit','$product_details.floorlevel','getMonth','note','max_product_unit','warehouse_name','back','errors','catch','$paid_amount','$product_details.type','French','\x20Order\x20Date\x20:\x20','$warehouse_name','production_date','password',',\x20bin:\x20','en-CA','There\x20is\x20','<span\x20style=\x22float:\x20right;\x22>','uuid','purchase\x20data\x20add\x20successfully','$product_details.primary_code','/view/return_purchase/:id','all_purchases_barcode','room','find','staff','flash','/upload/','host','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/give_payment/:id','Ambient','all_purchases_finished_logs','\x20Order\x20Number\x20:\x20','log','12321881FmeKCx','Portuguese\x20(BR)','$product_code','product_cat','</tbody>','RoomAssign','inc'];a0_0x222f=function(){return _0x3b3e47;};return a0_0x222f();}var a0_0x5804c6=a0_0x408a;(function(_0x28efa3,_0x41e17e){var _0x253b52=a0_0x408a,_0x337fa9=_0x28efa3();while(!![]){try{var _0x2b6158=parseInt(_0x253b52(0x197))/0x1*(-parseInt(_0x253b52(0x19d))/0x2)+-parseInt(_0x253b52(0xe0))/0x3+parseInt(_0x253b52(0xf1))/0x4*(parseInt(_0x253b52(0xe5))/0x5)+-parseInt(_0x253b52(0x204))/0x6*(-parseInt(_0x253b52(0x153))/0x7)+-parseInt(_0x253b52(0xf4))/0x8+parseInt(_0x253b52(0xe3))/0x9*(-parseInt(_0x253b52(0xfa))/0xa)+parseInt(_0x253b52(0x1f0))/0xb;if(_0x2b6158===_0x41e17e)break;else _0x337fa9['push'](_0x337fa9['shift']());}catch(_0x3bdda9){_0x337fa9['push'](_0x337fa9['shift']());}}}(a0_0x222f,0xc7a73));const express=require('express'),app=express(),router=express[a0_0x5804c6(0x16f)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x5804c6(0x14e)),auth=require('../middleware/auth'),nodemailer=require(a0_0x5804c6(0x10b));var ejs=require('ejs');const path=require('path'),users=require(a0_0x5804c6(0x13b)),{isNull}=require(a0_0x5804c6(0x125));router[a0_0x5804c6(0x19e)]('/incoming',auth,async(_0x3d8ee6,_0x2abad1)=>{var _0xce75e0=a0_0x5804c6;try{const {username:_0x24942a,email:_0x4661ad,role:_0x4ce95d}=_0x3d8ee6[_0xce75e0(0xd0)],_0x30fbd1=_0x3d8ee6[_0xce75e0(0xd0)],_0x2d0481=await profile[_0xce75e0(0x1ba)]({'email':_0x30fbd1[_0xce75e0(0x113)]}),_0x567d3c=await staff[_0xce75e0(0x1ba)]({'email':_0x30fbd1[_0xce75e0(0x113)]}),_0x470849=await master_shop['find']();let _0x4e6f00=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x567d3c['warehouse']}}]);if(_0x470849[0x0][_0xce75e0(0xd5)]==_0xce75e0(0x189))var _0x22e4e0=users[_0xce75e0(0x165)];else{if(_0x470849[0x0][_0xce75e0(0xd5)]=='Hindi')var _0x22e4e0=users[_0xce75e0(0x1ae)];else{if(_0x470849[0x0]['language']==_0xce75e0(0x18b))var _0x22e4e0=users[_0xce75e0(0x18b)];else{if(_0x470849[0x0]['language']==_0xce75e0(0x114))var _0x22e4e0=users[_0xce75e0(0x114)];else{if(_0x470849[0x0]['language']=='French')var _0x22e4e0=users[_0xce75e0(0x1d5)];else{if(_0x470849[0x0]['language']=='Portuguese\x20(BR)')var _0x22e4e0=users[_0xce75e0(0x186)];else{if(_0x470849[0x0][_0xce75e0(0xd5)]==_0xce75e0(0x12f))var _0x22e4e0=users[_0xce75e0(0x12f)];else{if(_0x470849[0x0][_0xce75e0(0xd5)]=='Arabic\x20(ae)')var _0x22e4e0=users[_0xce75e0(0x17e)];}}}}}}}_0x2abad1[_0xce75e0(0x100)](_0xce75e0(0x14c),{'success':_0x3d8ee6['flash'](_0xce75e0(0x1ab)),'errors':_0x3d8ee6[_0xce75e0(0x1e6)](_0xce75e0(0x1d1)),'purchases':_0x4e6f00,'role':_0x30fbd1,'profile':_0x2d0481,'master_shop':_0x470849,'language':_0x22e4e0,'staff_data':_0x567d3c});}catch(_0x34a2bb){console[_0xce75e0(0x1ef)](_0xce75e0(0x17c),_0x34a2bb),_0x2abad1[_0xce75e0(0x1fe)](0xc8)[_0xce75e0(0x1be)]({'message':_0x34a2bb[_0xce75e0(0x157)]});}}),router['get'](a0_0x5804c6(0x163),auth,async(_0x2e78ec,_0x275f0d)=>{var _0x56f4b2=a0_0x5804c6;try{const {username:_0xa4d9f6,email:_0x5a0513,role:_0x29c6db}=_0x2e78ec['user'],_0x134397=_0x2e78ec['user'],_0x24c30b=await profile[_0x56f4b2(0x1ba)]({'email':_0x134397[_0x56f4b2(0x113)]}),_0x4b8fa9=await staff['findOne']({'email':_0x134397[_0x56f4b2(0x113)]}),_0x3059a5=await master_shop[_0x56f4b2(0x1e4)]();let _0x5e4d6b=await transfers_finished[_0x56f4b2(0x119)]([{'$match':{'to_warehouse':_0x4b8fa9['warehouse'],'to_recieved':_0x56f4b2(0x124)}}]);if(_0x3059a5[0x0][_0x56f4b2(0xd5)]==_0x56f4b2(0x189))var _0x21eb0f=users['English'];else{if(_0x3059a5[0x0]['language']==_0x56f4b2(0x1ae))var _0x21eb0f=users[_0x56f4b2(0x1ae)];else{if(_0x3059a5[0x0][_0x56f4b2(0xd5)]=='German')var _0x21eb0f=users[_0x56f4b2(0x18b)];else{if(_0x3059a5[0x0][_0x56f4b2(0xd5)]==_0x56f4b2(0x114))var _0x21eb0f=users[_0x56f4b2(0x114)];else{if(_0x3059a5[0x0][_0x56f4b2(0xd5)]==_0x56f4b2(0x1d5))var _0x21eb0f=users['French'];else{if(_0x3059a5[0x0][_0x56f4b2(0xd5)]=='Portuguese\x20(BR)')var _0x21eb0f=users['Portuguese'];else{if(_0x3059a5[0x0]['language']=='Chinese')var _0x21eb0f=users[_0x56f4b2(0x12f)];else{if(_0x3059a5[0x0][_0x56f4b2(0xd5)]==_0x56f4b2(0xcf))var _0x21eb0f=users[_0x56f4b2(0x17e)];}}}}}}}_0x275f0d[_0x56f4b2(0x100)]('incoming_add',{'success':_0x2e78ec[_0x56f4b2(0x1e6)](_0x56f4b2(0x1ab)),'errors':_0x2e78ec[_0x56f4b2(0x1e6)](_0x56f4b2(0x1d1)),'purchases':_0x5e4d6b,'role':_0x134397,'profile':_0x24c30b,'master_shop':_0x3059a5,'language':_0x21eb0f,'staff_data':_0x4b8fa9});}catch(_0x1e6d85){console['log'](_0x56f4b2(0x17c),_0x1e6d85),_0x275f0d[_0x56f4b2(0x1fe)](0xc8)[_0x56f4b2(0x1be)]({'message':_0x1e6d85['message']});}});const createLog=async _0x4625fe=>{var _0x2316f7=a0_0x5804c6;const _0x321646=new datalogs({'location':_0x4625fe});return await _0x321646[_0x2316f7(0x1c8)](),_0x321646['invoice_init'];};router[a0_0x5804c6(0x13f)]('/incoming/add',auth,async(_0x3eb110,_0x101a5d)=>{var _0x3f539c=a0_0x5804c6;try{const {invoice_trf_data:_0x4e1b52,item_code:_0x4d20b6,SCRN:_0x11cb43,ReqBy:_0x5f3b79,type_of_products:_0x47695b,dateofreq:_0x5e00c3,PO_number:_0x232410,date:_0xccf5b3,warehouse_name:_0x27d7cd,typeservicesData:_0x2dff53,typevehicle:_0x2e9ff9,driver:_0x297c4e,plate:_0x5dbe04,van:_0xdcdaa0,DRSI:_0x3c6e56,TSU:_0x381535,TFU:_0x2728d4,note:_0xcbcd68}=_0x3eb110[_0x3f539c(0x138)],_0xabd4af=await transfers_finished[_0x3f539c(0x19b)](_0x4e1b52);if(typeof _0x4d20b6==_0x3f539c(0x159))var _0x1578f3=[_0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x13d)]],_0x5f4ac2=[_0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x13e)]],_0x5a0597=[_0x3eb110['body'][_0x3f539c(0xf8)]],_0x374f7a=[_0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x158)]],_0x22d0a2=[_0x3eb110[_0x3f539c(0x138)]['prod_secondunit']],_0x1b31dc=[_0x3eb110[_0x3f539c(0x138)][_0x3f539c(0xff)]],_0x2c77cb=[_0x3eb110['body'][_0x3f539c(0x112)]],_0x51bb2e=[_0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x172)]],_0x31021d=[_0x3eb110[_0x3f539c(0x138)]['batch_code']],_0x2cc825=[_0x3eb110['body'][_0x3f539c(0x1c6)]],_0x3813f2=[_0x3eb110[_0x3f539c(0x138)]['production_date']],_0x332172=[_0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x1ce)]],_0x53d2d7=[_0x3eb110[_0x3f539c(0x138)]['room']];else var _0x1578f3=[..._0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x13d)]],_0x5f4ac2=[..._0x3eb110['body'][_0x3f539c(0x13e)]],_0x5a0597=[..._0x3eb110['body']['to_quantity']],_0x374f7a=[..._0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x158)]],_0x22d0a2=[..._0x3eb110[_0x3f539c(0x138)]['prod_secondunit']],_0x1b31dc=[..._0x3eb110[_0x3f539c(0x138)][_0x3f539c(0xff)]],_0x2c77cb=[..._0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x112)]],_0x51bb2e=[..._0x3eb110[_0x3f539c(0x138)][_0x3f539c(0x172)]],_0x31021d=[..._0x3eb110['body'][_0x3f539c(0x185)]],_0x2cc825=[..._0x3eb110['body']['expiry_date']],_0x3813f2=[..._0x3eb110['body'][_0x3f539c(0x1d8)]],_0x332172=[..._0x3eb110['body'][_0x3f539c(0x1ce)]],_0x53d2d7=[..._0x3eb110['body'][_0x3f539c(0x1e3)]];const _0x4adbc7=_0x1578f3[_0x3f539c(0x168)](_0x12bc4e=>{return _0x12bc4e={'product_name':_0x12bc4e};});_0x5f4ac2['forEach']((_0x4f12ea,_0x48e14b)=>{_0x4adbc7[_0x48e14b]['product_code']=_0x4f12ea;}),_0x5a0597[_0x3f539c(0x110)]((_0x197b16,_0x26d9ce)=>{var _0x40998e=_0x3f539c;_0x4adbc7[_0x26d9ce][_0x40998e(0x133)]=Math[_0x40998e(0x117)](_0x197b16);}),_0x374f7a[_0x3f539c(0x110)]((_0x48c9f9,_0x4e6a0a)=>{var _0x1bfcb8=_0x3f539c;_0x4adbc7[_0x4e6a0a][_0x1bfcb8(0x12c)]=_0x48c9f9;}),_0x22d0a2['forEach']((_0x5ed00e,_0x3e3a07)=>{var _0x1d5b96=_0x3f539c;_0x4adbc7[_0x3e3a07][_0x1d5b96(0xf5)]=_0x5ed00e;}),_0x1b31dc[_0x3f539c(0x110)]((_0x98863c,_0x43d1d7)=>{var _0x3a3c6b=_0x3f539c,_0x256f95=_0x98863c[_0x3a3c6b(0x1c1)](/[A-Za-z]+/)[0x0],_0x49f72a=parseInt(_0x98863c[_0x3a3c6b(0x1c1)](/\d+/)[0x0]);_0x4adbc7[_0x43d1d7]['level']=_0x256f95,_0x4adbc7[_0x43d1d7][_0x3a3c6b(0x187)]=_0x49f72a;}),_0x2c77cb[_0x3f539c(0x110)]((_0x16d8ce,_0x3d2b55)=>{var _0x203c7b=_0x3f539c;_0x4adbc7[_0x3d2b55][_0x203c7b(0x112)]=_0x16d8ce;}),_0x51bb2e[_0x3f539c(0x110)]((_0x5518f3,_0x47f641)=>{var _0x5d6add=_0x3f539c;_0x4adbc7[_0x47f641][_0x5d6add(0x172)]=_0x5518f3;}),_0x31021d[_0x3f539c(0x110)]((_0x1259ba,_0x4be78e)=>{_0x4adbc7[_0x4be78e]['batch_code']=_0x1259ba;}),_0x2cc825['forEach']((_0x2904b9,_0x457527)=>{_0x4adbc7[_0x457527]['expiry_date']=_0x2904b9;}),_0x3813f2['forEach']((_0xecf067,_0x278b18)=>{_0x4adbc7[_0x278b18]['production_date']=_0xecf067;}),_0x332172[_0x3f539c(0x110)]((_0x11e8a7,_0x242622)=>{_0x4adbc7[_0x242622]['maxperunit']=_0x11e8a7;}),_0x53d2d7[_0x3f539c(0x110)]((_0x304131,_0x1f4579)=>{var _0x1f308b=_0x3f539c;_0x4adbc7[_0x1f4579][_0x1f308b(0x104)]=_0x304131;});const _0x246f94=await createLog(_0x3f539c(0x167));_0x53d2d7[_0x3f539c(0x110)]((_0x3a1b5e,_0x24cbca)=>{var _0x495480=_0x3f539c;_0x4adbc7[_0x24cbca][_0x495480(0x109)]='INC-'+_0x246f94[_0x495480(0x156)]()[_0x495480(0x134)](0x8,'0');});const _0x545fec=_0x4adbc7['filter'](_0xd225a2=>_0xd225a2['quantity']!=='0'&&_0xd225a2[_0x3f539c(0x133)]!==''),_0x1473c2=new purchases_incoming({'invoice':_0x3f539c(0x116)+_0x246f94[_0x3f539c(0x156)]()[_0x3f539c(0x134)](0x8,'0'),'date':_0xccf5b3,'warehouse_name':_0x27d7cd,'product':_0x545fec,'note':_0xcbcd68,'POnumber':_0x232410,'SCRN':_0x11cb43,'ReqBy':_0x5f3b79,'dateofreq':_0x5e00c3,'typeservicesData':_0x2dff53,'van':_0xdcdaa0,'typevehicle':_0x2e9ff9,'driver':_0x297c4e,'plate':_0x5dbe04,'DRSI':_0x3c6e56,'TSU':_0x381535,'TFU':_0x2728d4,'typeOfProducts':_0x47695b}),_0x56c3ce=await _0x1473c2[_0x3f539c(0x1c8)](),_0x5f3183=_0x56c3ce[_0x3f539c(0x1ac)]['map'](async _0x5570ba=>{var _0x38b325=_0x3f539c,_0x595406=await warehouse[_0x38b325(0x1ba)]({'name':_0x27d7cd,'room':_0x5570ba['room_name']});if(_0x5570ba[_0x38b325(0x133)]>0x0){var _0x329ccb=0x0;const _0x97a686=_0x595406['product_details'][_0x38b325(0x168)](_0x43bc50=>{var _0x3d52b9=_0x38b325;_0x43bc50[_0x3d52b9(0x13d)]==_0x5570ba[_0x3d52b9(0x13d)]&&_0x43bc50[_0x3d52b9(0x187)]==_0x5570ba[_0x3d52b9(0x1f7)]&&_0x43bc50[_0x3d52b9(0x1c6)]==_0x5570ba[_0x3d52b9(0x1c6)]&&_0x43bc50[_0x3d52b9(0x1d8)]==_0x5570ba[_0x3d52b9(0x1d8)]&&_0x43bc50['batch_code']==_0x5570ba[_0x3d52b9(0x185)]&&_0x43bc50[_0x3d52b9(0x109)]==_0x5570ba[_0x3d52b9(0x109)]&&(typeof _0x5570ba['id_transaction']==_0x3d52b9(0x18c)?(console['log'](_0x3d52b9(0xd6),_0x43bc50[_0x3d52b9(0x1bf)]+_0x3d52b9(0x1fa)+_0x43bc50[_0x3d52b9(0x160)]+_0x3d52b9(0x1a8)+Math[_0x3d52b9(0x117)](_0x43bc50['product_stock'])+Math[_0x3d52b9(0x117)](_0x5570ba[_0x3d52b9(0xf8)])),_0x43bc50['product_stock']=Math[_0x3d52b9(0x117)](_0x43bc50['product_stock'])+Math['abs'](_0x5570ba[_0x3d52b9(0x133)])):(_0x43bc50[_0x3d52b9(0x1bf)]=Math[_0x3d52b9(0x117)](_0x43bc50[_0x3d52b9(0x1bf)])+Math[_0x3d52b9(0x117)](_0x5570ba[_0x3d52b9(0x133)]),_0x329ccb++));});_0x329ccb=='0'&&(_0x595406[_0x38b325(0x151)]=_0x595406[_0x38b325(0x151)]['concat']({'product_name':_0x5570ba['product_name'],'product_stock':_0x5570ba['quantity'],'bay':_0x5570ba['bay'],'level':_0x5570ba['level'],'product_code':_0x5570ba['product_code'],'primary_code':_0x5570ba[_0x38b325(0x112)],'secondary_code':_0x5570ba[_0x38b325(0x172)],'expiry_date':_0x5570ba['expiry_date'],'production_date':_0x5570ba[_0x38b325(0x1d8)],'maxProducts':_0x5570ba[_0x38b325(0x14a)],'batch_code':_0x5570ba[_0x38b325(0x185)],'secondary_unit':_0x5570ba[_0x38b325(0xf5)],'unit':_0x5570ba['standard_unit'],'maxProducts':_0x5570ba['maxProducts'],'maxPerUnit':_0x5570ba[_0x38b325(0x19c)],'invoice':_0x5570ba[_0x38b325(0x109)]}));}return _0x595406;});Promise[_0x3f539c(0x102)](_0x5f3183)[_0x3f539c(0x140)](async _0x506608=>{var _0x145258=_0x3f539c;try{for(const _0x4ad229 of _0x506608){await warehouse[_0x145258(0x16a)]({'_id':_0x4ad229[_0x145258(0x160)]},{'$addToSet':{'product_details':{'$each':_0x4ad229[_0x145258(0x151)]}}});}_0xabd4af[_0x145258(0x142)]=_0x145258(0xfb);const _0x515b94=await _0xabd4af[_0x145258(0x1c8)](),_0x43ed02=await master_shop[_0x145258(0x1e4)](),_0x50cc28=await email_settings[_0x145258(0x1ba)](),_0x213a49=await supervisor_settings[_0x145258(0x1e4)]();var _0x44ffb2=_0x1473c2[_0x145258(0x1ac)],_0x4d8b59='',_0x31f874;for(_0x31f874 in _0x44ffb2){var _0x2c6f43='FG';_0x1473c2[_0x145258(0x126)]=='DRY\x20GOODS'&&(_0x2c6f43='DG'),_0x4d8b59+=_0x145258(0x1a3)+_0x145258(0x129)+_0x44ffb2[_0x31f874]['product_name']+_0x145258(0x10c)+_0x145258(0x129)+_0x44ffb2[_0x31f874][_0x145258(0x1a2)]+_0x145258(0x10c)+_0x145258(0x129)+_0x44ffb2[_0x31f874][_0x145258(0xf8)]+_0x145258(0x10c)+_0x145258(0x129)+_0x44ffb2[_0x31f874][_0x145258(0x158)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44ffb2[_0x31f874][_0x145258(0xf5)]+_0x145258(0x10c)+_0x145258(0x129)+_0x1473c2[_0x145258(0x126)]+_0x145258(0x10c)+_0x145258(0x129)+_0x44ffb2[_0x31f874][_0x145258(0x130)]+_0x145258(0x10c)+_0x145258(0x129)+_0x2c6f43+_0x44ffb2[_0x31f874][_0x145258(0x1f7)]+'</td>'+_0x145258(0xf7);}_0x3eb110[_0x145258(0x1e6)]('success',_0x145258(0xcc)),_0x101a5d[_0x145258(0x18d)]('/picking_list/pdf_puchases_fin_own_trf/'+_0x56c3ce['_id']);}catch(_0x4b3438){console['error'](_0x4b3438),_0x101a5d[_0x145258(0x1fe)](0x1f4)['json']({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3f539c(0x1d2)](_0x2f86d6=>{var _0x3c1279=_0x3f539c;console['error'](_0x2f86d6),_0x101a5d['status'](0x1f4)['json']({'error':_0x3c1279(0x105)});});}catch(_0x2418c5){}}),router['post'](a0_0x5804c6(0x147),auth,async(_0x3cfda7,_0x432d25)=>{var _0x651698=a0_0x5804c6;try{const {warehouse:_0x5406f1}=_0x3cfda7['body'],_0x32cd5e=await transfers_finished[_0x651698(0x1e4)]({'to_warehouse':_0x5406f1,'to_recieved':_0x651698(0x124)});_0x432d25['json'](_0x32cd5e);}catch(_0xe87fb3){}}),router[a0_0x5804c6(0x13f)]('/getinvoicetrf',auth,async(_0x1833e8,_0x4c18d3)=>{var _0x298d6b=a0_0x5804c6;try{const {invoice:_0x4c51f7}=_0x1833e8[_0x298d6b(0x138)],_0xb1d911=await transfers_finished[_0x298d6b(0x1e4)]({'_id':_0x4c51f7,'to_recieved':_0x298d6b(0x124)});_0x4c18d3[_0x298d6b(0x1be)](_0xb1d911);}catch(_0x4f9167){}}),router[a0_0x5804c6(0x19e)]('/view',auth,async(_0x43f23a,_0x4a741b)=>{var _0x1e8f66=a0_0x5804c6;try{const {username:_0x593c4b,email:_0x2b59df,role:_0x438a7e}=_0x43f23a[_0x1e8f66(0xd0)],_0x58420d=_0x43f23a[_0x1e8f66(0xd0)],_0x192242=await profile[_0x1e8f66(0x1ba)]({'email':_0x58420d[_0x1e8f66(0x113)]}),_0x46d182=await staff[_0x1e8f66(0x1ba)]({'email':_0x58420d[_0x1e8f66(0x113)]});if(_0x58420d[_0x1e8f66(0x1c0)]=='staff'){const _0x181254=await staff[_0x1e8f66(0x1ba)]({'email':_0x58420d[_0x1e8f66(0x113)]});}const _0x265d1b=await master_shop[_0x1e8f66(0x1e4)]();let _0x5b5c4e;if(_0x58420d[_0x1e8f66(0x1c0)]==_0x1e8f66(0x1e5)){const _0x3a5d0e=await staff['findOne']({'email':_0x58420d['email']});_0x5b5c4e=await purchases_finished[_0x1e8f66(0x119)]([{'$match':{'warehouse_name':_0x3a5d0e[_0x1e8f66(0x137)],'typeOfProducts':_0x1e8f66(0x169)}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x1e8f66(0x152),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x1e8f66(0xde)},{'$group':{'_id':_0x1e8f66(0x107),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x1e8f66(0x1b3)},'warehouse_name':{'$first':_0x1e8f66(0x1d7)},'room':{'$first':_0x1e8f66(0xe7)},'product':{'$push':_0x1e8f66(0xde)},'note':{'$first':_0x1e8f66(0x1fc)},'paid_amount':{'$first':_0x1e8f66(0x1d3)},'due_amount':{'$first':_0x1e8f66(0x181)},'return_data':{'$first':_0x1e8f66(0x205)},'batch_code':{'$first':_0x1e8f66(0x111)},'expiry_date':{'$first':_0x1e8f66(0x18a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1e8f66(0x1c4)},'level':{'$addToSet':_0x1e8f66(0x190)},'isle':{'$addToSet':_0x1e8f66(0x1a7)},'type':{'$addToSet':_0x1e8f66(0x208)},'floorlevel':{'$addToSet':_0x1e8f66(0x16e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5b5c4e=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$product'},{'$group':{'_id':_0x1e8f66(0x107),'invoice':{'$first':_0x1e8f66(0xf6)},'suppliers':{'$first':_0x1e8f66(0x175)},'date':{'$first':_0x1e8f66(0x1b3)},'warehouse_name':{'$first':_0x1e8f66(0x1d7)},'room':{'$addToSet':_0x1e8f66(0xdd)},'product':{'$push':'$product'},'note':{'$first':_0x1e8f66(0x1fc)},'paid_amount':{'$first':_0x1e8f66(0x1d3)},'due_amount':{'$first':_0x1e8f66(0x181)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1e8f66(0x111)},'expiry_date':{'$first':_0x1e8f66(0x18a)},'suppliers_docs':{'$first':_0x1e8f66(0x203)},'total_product_quantity':{'$sum':_0x1e8f66(0x1c4)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1e8f66(0x1a7)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x1e8f66(0x16e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x265d1b[0x0][_0x1e8f66(0xd5)]=='English\x20(US)')var _0x108c62=users[_0x1e8f66(0x165)];else{if(_0x265d1b[0x0][_0x1e8f66(0xd5)]==_0x1e8f66(0x1ae))var _0x108c62=users[_0x1e8f66(0x1ae)];else{if(_0x265d1b[0x0][_0x1e8f66(0xd5)]=='German')var _0x108c62=users['German'];else{if(_0x265d1b[0x0][_0x1e8f66(0xd5)]=='Spanish')var _0x108c62=users[_0x1e8f66(0x114)];else{if(_0x265d1b[0x0]['language']==_0x1e8f66(0x1d5))var _0x108c62=users[_0x1e8f66(0x1d5)];else{if(_0x265d1b[0x0]['language']==_0x1e8f66(0x1f1))var _0x108c62=users[_0x1e8f66(0x186)];else{if(_0x265d1b[0x0][_0x1e8f66(0xd5)]==_0x1e8f66(0x12f))var _0x108c62=users[_0x1e8f66(0x12f)];else{if(_0x265d1b[0x0][_0x1e8f66(0xd5)]=='Arabic\x20(ae)')var _0x108c62=users['Arabic'];}}}}}}}_0x4a741b['render'](_0x1e8f66(0x1c3),{'success':_0x43f23a['flash']('success'),'errors':_0x43f23a[_0x1e8f66(0x1e6)]('errors'),'purchases':_0x5b5c4e,'role':_0x58420d,'profile':_0x192242,'master_shop':_0x265d1b,'language':_0x108c62});}catch(_0x3b4489){console[_0x1e8f66(0x1ef)]('table\x20page',_0x3b4489),_0x4a741b[_0x1e8f66(0x1fe)](0xc8)[_0x1e8f66(0x1be)]({'message':_0x3b4489[_0x1e8f66(0x157)]});}}),router[a0_0x5804c6(0x19e)](a0_0x5804c6(0x103),auth,async(_0x2f06b8,_0x3d0a4c)=>{var _0x490df6=a0_0x5804c6;try{const {username:_0x2e1ae8,email:_0x3dd549,role:_0x1101ab}=_0x2f06b8[_0x490df6(0xd0)],_0x46d0be=_0x2f06b8[_0x490df6(0xd0)],_0x5af0ea=await profile['findOne']({'email':_0x46d0be[_0x490df6(0x113)]}),_0x3e5ef1=await staff['findOne']({'email':_0x46d0be[_0x490df6(0x113)]});if(_0x46d0be[_0x490df6(0x1c0)]==_0x490df6(0x1e5)){const _0x5c7a29=await staff[_0x490df6(0x1ba)]({'email':_0x46d0be[_0x490df6(0x113)]});}const _0x3cb9ff=await master_shop[_0x490df6(0x1e4)]();let _0xdbdd44;if(_0x46d0be[_0x490df6(0x1c0)]=='staff'){const _0x2cb59f=await staff['findOne']({'email':_0x46d0be[_0x490df6(0x113)]});_0xdbdd44=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2cb59f[_0x490df6(0x137)]}},{'$lookup':{'from':_0x490df6(0x16d),'localField':_0x490df6(0x16d),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x490df6(0x203)},{'$unwind':_0x490df6(0xde)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x490df6(0x175)},'date':{'$first':_0x490df6(0x1b3)},'warehouse_name':{'$first':_0x490df6(0x1d7)},'room':{'$first':'$room'},'product':{'$push':_0x490df6(0xde)},'note':{'$first':_0x490df6(0x1fc)},'paid_amount':{'$first':_0x490df6(0x1d3)},'due_amount':{'$first':_0x490df6(0x181)},'return_data':{'$first':_0x490df6(0x205)},'batch_code':{'$first':_0x490df6(0x111)},'expiry_date':{'$first':_0x490df6(0x18a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x490df6(0x1c4)},'level':{'$addToSet':_0x490df6(0x190)},'isle':{'$addToSet':_0x490df6(0x1a7)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xdbdd44=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x490df6(0xd2)}},{'$unwind':_0x490df6(0xde)},{'$group':{'_id':_0x490df6(0x107),'invoice':{'$first':_0x490df6(0xf6)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x490df6(0x1b3)},'warehouse_name':{'$first':_0x490df6(0x1d7)},'room':{'$addToSet':_0x490df6(0xdd)},'product':{'$push':_0x490df6(0xde)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x490df6(0x1d3)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x490df6(0x205)},'batch_code':{'$first':_0x490df6(0x111)},'expiry_date':{'$first':_0x490df6(0x18a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x490df6(0x1c4)},'level':{'$addToSet':_0x490df6(0x190)},'isle':{'$addToSet':_0x490df6(0x1a7)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3cb9ff[0x0][_0x490df6(0xd5)]==_0x490df6(0x189))var _0x14c11b=users['English'];else{if(_0x3cb9ff[0x0][_0x490df6(0xd5)]=='Hindi')var _0x14c11b=users[_0x490df6(0x1ae)];else{if(_0x3cb9ff[0x0][_0x490df6(0xd5)]=='German')var _0x14c11b=users[_0x490df6(0x18b)];else{if(_0x3cb9ff[0x0][_0x490df6(0xd5)]=='Spanish')var _0x14c11b=users['Spanish'];else{if(_0x3cb9ff[0x0][_0x490df6(0xd5)]==_0x490df6(0x1d5))var _0x14c11b=users[_0x490df6(0x1d5)];else{if(_0x3cb9ff[0x0]['language']==_0x490df6(0x1f1))var _0x14c11b=users[_0x490df6(0x186)];else{if(_0x3cb9ff[0x0][_0x490df6(0xd5)]==_0x490df6(0x12f))var _0x14c11b=users[_0x490df6(0x12f)];else{if(_0x3cb9ff[0x0]['language']=='Arabic\x20(ae)')var _0x14c11b=users[_0x490df6(0x17e)];}}}}}}}_0x3d0a4c[_0x490df6(0x100)](_0x490df6(0x1ed),{'success':_0x2f06b8[_0x490df6(0x1e6)](_0x490df6(0x1ab)),'errors':_0x2f06b8[_0x490df6(0x1e6)]('errors'),'purchases':_0xdbdd44,'role':_0x46d0be,'profile':_0x5af0ea,'master_shop':_0x3cb9ff,'language':_0x14c11b});}catch(_0x1bd1dd){console[_0x490df6(0x1ef)](_0x490df6(0x17c),_0x1bd1dd),_0x3d0a4c[_0x490df6(0x1fe)](0xc8)[_0x490df6(0x1be)]({'message':_0x1bd1dd[_0x490df6(0x157)]});}});function BayBinSelected(_0x53ee01,_0x535e3e){var _0x2c6943=a0_0x5804c6,_0x323907=[],_0x461e06=[];if(_0x53ee01==_0x2c6943(0xeb)){switch(_0x535e3e){case _0x2c6943(0x15b):_0x323907=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2c6943(0x1a9):_0x323907=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x461e06=['DG'];}else{if(_0x53ee01==_0x2c6943(0x1b0)){switch(_0x535e3e){case _0x2c6943(0x15b):_0x323907=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2c6943(0x1a9):_0x323907=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x461e06=['FG'];}}return{'levels':_0x323907,'identify':_0x461e06};}async function getRandom8DigitNumber(){var _0x31bd71=a0_0x5804c6;const _0x180b21=0x989680,_0x284f21=0x5f5e0ff,_0x5448ab=Math[_0x31bd71(0xe6)](Math[_0x31bd71(0x1e9)]()*(_0x284f21-_0x180b21+0x1))+_0x180b21;var _0x164fb2;const _0x165d69=await purchases_finished[_0x31bd71(0x1ba)]({'invoice':_0x31bd71(0x154)+_0x5448ab});return _0x165d69&&_0x165d69[_0x31bd71(0x1b7)]>0x0?_0x164fb2=_0x31bd71(0x154)+_0x5448ab:_0x164fb2='INCF-'+_0x5448ab,_0x164fb2;}router[a0_0x5804c6(0x19e)](a0_0x5804c6(0xe9),auth,async(_0x38df25,_0x54f0a3)=>{var _0x361adf=a0_0x5804c6;try{const {username:_0xaaa10b,email:_0x1a5994,role:_0x2e4465}=_0x38df25['user'],_0x38789d=_0x38df25['user'],_0x46d97c=await profile[_0x361adf(0x1ba)]({'email':_0x38789d['email']}),_0x31817d=await master_shop[_0x361adf(0x1e4)](),_0x39a5fd=await staff[_0x361adf(0x1ba)]({'email':_0x38789d[_0x361adf(0x113)]}),_0x57157f=await suppliers[_0x361adf(0x1e4)]({});let _0x5d3f9e;if(_0x38789d['role']=='staff'){const _0x1e6801=await staff[_0x361adf(0x1ba)]({'email':_0x38789d[_0x361adf(0x113)]});_0x5d3f9e=await warehouse[_0x361adf(0x119)]([{'$match':{'status':'Enabled','name':_0x1e6801[_0x361adf(0x137)]}},{'$group':{'_id':_0x361adf(0x115),'name':{'$first':_0x361adf(0x115)}}}]);}else _0x5d3f9e=await warehouse[_0x361adf(0x119)]([{'$match':{'status':_0x361adf(0xdf)}},{'$group':{'_id':'$name','name':{'$first':_0x361adf(0x115)}}}]);const _0x1d1f39=await product[_0x361adf(0x1e4)]({}),_0x131be8=await warehouse[_0x361adf(0x1e4)]({'status':_0x361adf(0xdf)}),_0x2d3cbf=await purchases_finished['find']({}),_0x20a00f=_0x2d3cbf[_0x361adf(0x1b7)]+0x1,_0x470f6c=_0x361adf(0x154)+_0x20a00f[_0x361adf(0x156)]()['padStart'](0x5,'0');var _0x8662f8=['Ambient',_0x361adf(0x1a5)];if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0x189))var _0x34328c=users[_0x361adf(0x165)];else{if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0x1ae))var _0x34328c=users[_0x361adf(0x1ae)];else{if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0x18b))var _0x34328c=users[_0x361adf(0x18b)];else{if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0x114))var _0x34328c=users[_0x361adf(0x114)];else{if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0x1d5))var _0x34328c=users['French'];else{if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0x1f1))var _0x34328c=users['Portuguese'];else{if(_0x31817d[0x0][_0x361adf(0xd5)]=='Chinese')var _0x34328c=users['Chinese'];else{if(_0x31817d[0x0][_0x361adf(0xd5)]==_0x361adf(0xcf))var _0x34328c=users[_0x361adf(0x17e)];}}}}}}}const _0x1b9dfc=getRandom8DigitNumber(),_0x5585f3=new Date(),_0x4f5182={'year':_0x361adf(0x191),'month':_0x361adf(0x17a),'day':_0x361adf(0x17a),'timeZone':_0x361adf(0x10f)},_0x31613d=_0x5585f3[_0x361adf(0xd1)](_0x361adf(0x1db),_0x4f5182);console[_0x361adf(0x1ef)](_0x31613d),_0x1b9dfc[_0x361adf(0x140)](_0x260630=>{var _0x7d5722=_0x361adf;_0x54f0a3[_0x7d5722(0x100)](_0x7d5722(0x192),{'success':_0x38df25[_0x7d5722(0x1e6)]('success'),'errors':_0x38df25[_0x7d5722(0x1e6)](_0x7d5722(0x1d1)),'role':_0x38789d,'profile':_0x46d97c,'suppliers':_0x57157f,'warehouse':_0x5d3f9e,'product':_0x1d1f39,'invoice':_0x260630,'master_shop':_0x31817d,'language':_0x34328c,'find_data':_0x131be8,'rooms_data':_0x8662f8,'formattedDate':_0x31613d});})[_0x361adf(0x1d2)](_0x1eaaf5=>{var _0x3b33dc=_0x361adf;_0x38df25[_0x3b33dc(0x1e6)](_0x3b33dc(0x1d1),_0x3b33dc(0x131)),_0x54f0a3[_0x3b33dc(0x18d)](_0x3b33dc(0x148));});}catch(_0x1ad323){console[_0x361adf(0x1ef)](_0x1ad323);}}),router[a0_0x5804c6(0x19e)](a0_0x5804c6(0x11f),auth,async(_0xccbcc3,_0x21ef43)=>{var _0x35852b=a0_0x5804c6;try{const {username:_0x412aec,email:_0x58fc3d,role:_0x3799fd}=_0xccbcc3[_0x35852b(0xd0)],_0x102362=_0xccbcc3[_0x35852b(0xd0)],_0x9f6b8b=await profile[_0x35852b(0x1ba)]({'email':_0x102362[_0x35852b(0x113)]}),_0x4de335=await master_shop[_0x35852b(0x1e4)](),_0x17c2eb=await staff[_0x35852b(0x1ba)]({'email':_0x102362[_0x35852b(0x113)]}),_0x1beb7a=await suppliers['find']({});let _0x17fb9d;if(_0x102362[_0x35852b(0x1c0)]=='staff'){const _0x4d43fc=await staff[_0x35852b(0x1ba)]({'email':_0x102362['email']});_0x17fb9d=await warehouse[_0x35852b(0x119)]([{'$match':{'status':_0x35852b(0xdf),'name':_0x4d43fc['warehouse']}},{'$group':{'_id':_0x35852b(0x115),'name':{'$first':_0x35852b(0x115)}}}]);}else _0x17fb9d=await warehouse[_0x35852b(0x119)]([{'$match':{'status':_0x35852b(0xdf)}},{'$group':{'_id':_0x35852b(0x115),'name':{'$first':'$name'}}}]);const _0xf71a98=await product[_0x35852b(0x1e4)]({}),_0x57f720=await warehouse['find']({'status':_0x35852b(0xdf)}),_0x57d42e=await purchases_finished['find']({}),_0x2e03bd=_0x57d42e[_0x35852b(0x1b7)]+0x1,_0xd7a0eb=_0x35852b(0x154)+_0x2e03bd[_0x35852b(0x156)]()[_0x35852b(0x134)](0x5,'0');var _0x5aa6f8=[_0x35852b(0x1ec),'Enclosed'];if(_0x4de335[0x0][_0x35852b(0xd5)]==_0x35852b(0x189))var _0x4cc864=users[_0x35852b(0x165)];else{if(_0x4de335[0x0][_0x35852b(0xd5)]==_0x35852b(0x1ae))var _0x4cc864=users[_0x35852b(0x1ae)];else{if(_0x4de335[0x0][_0x35852b(0xd5)]==_0x35852b(0x18b))var _0x4cc864=users['German'];else{if(_0x4de335[0x0]['language']==_0x35852b(0x114))var _0x4cc864=users[_0x35852b(0x114)];else{if(_0x4de335[0x0][_0x35852b(0xd5)]==_0x35852b(0x1d5))var _0x4cc864=users[_0x35852b(0x1d5)];else{if(_0x4de335[0x0][_0x35852b(0xd5)]==_0x35852b(0x1f1))var _0x4cc864=users[_0x35852b(0x186)];else{if(_0x4de335[0x0]['language']==_0x35852b(0x12f))var _0x4cc864=users[_0x35852b(0x12f)];else{if(_0x4de335[0x0][_0x35852b(0xd5)]==_0x35852b(0xcf))var _0x4cc864=users[_0x35852b(0x17e)];}}}}}}}const _0x233783=getRandom8DigitNumber();_0x233783[_0x35852b(0x140)](_0x3ad991=>{var _0xd89ef7=_0x35852b;_0x21ef43[_0xd89ef7(0x100)](_0xd89ef7(0x176),{'success':_0xccbcc3['flash'](_0xd89ef7(0x1ab)),'errors':_0xccbcc3[_0xd89ef7(0x1e6)](_0xd89ef7(0x1d1)),'role':_0x102362,'profile':_0x9f6b8b,'suppliers':_0x1beb7a,'warehouse':_0x17fb9d,'product':_0xf71a98,'invoice':_0x3ad991,'master_shop':_0x4de335,'language':_0x4cc864,'find_data':_0x57f720,'rooms_data':_0x5aa6f8});})[_0x35852b(0x1d2)](_0x40f0c5=>{var _0xad6ecb=_0x35852b;_0xccbcc3[_0xad6ecb(0x1e6)]('errors',_0xad6ecb(0x131)),_0x21ef43[_0xad6ecb(0x18d)](_0xad6ecb(0x148));});}catch(_0x3b24bf){console[_0x35852b(0x1ef)](_0x3b24bf);}}),router['get']('/view/add_purchases/:id',auth,async(_0x2fe3d7,_0x3d5e84)=>{var _0x87adf8=a0_0x5804c6;try{const _0x100e4d=_0x2fe3d7[_0x87adf8(0x202)]['id'];console[_0x87adf8(0x1ef)](_0x100e4d);const _0x5bd808=await master_shop[_0x87adf8(0x1e4)]();console[_0x87adf8(0x1ef)]('master',_0x5bd808);const _0x59c8bc=await product[_0x87adf8(0x1ba)]({'name':_0x100e4d});console[_0x87adf8(0x1ef)](_0x87adf8(0x1ac),_0x59c8bc),_0x3d5e84[_0x87adf8(0x1fe)](0xc8)[_0x87adf8(0x1be)]({'product_data':_0x59c8bc,'master':_0x5bd808});}catch(_0x4f2b94){console[_0x87adf8(0x1ef)]('add_purchases\x20error',_0x4f2b94);}}),router[a0_0x5804c6(0x13f)](a0_0x5804c6(0xe9),auth,async(_0x474745,_0x4fadc8)=>{var _0x328ce7=a0_0x5804c6;try{const {invoice:_0x2fcf29,date:_0x4b242a,warehouse_name:_0x28c790,prod_name:_0x4ca6a0,note:_0x385c10,due_amount:_0x441bb6,Room_name:_0x4356d6,PO_number:_0x3b5d18,SCRN:_0x2245ee,ReqBy:_0x1583ea,dateofreq:_0x596e8a,suppliers:_0x5cdc38,typeservicesData:_0x524722,van:_0x11c238,typevehicle:_0x520987,driver:_0x2ad6f5,plate:_0x20e3b2,DRSI:_0x548165,TSU:_0x1675ac,TFU:_0x55dfb0,JO_number:_0x2a303,type_of_products:_0x4e11a8}=_0x474745[_0x328ce7(0x138)];if(typeof _0x4ca6a0==_0x328ce7(0x159))var _0x10f1b5=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x143)]],_0x4f571d=[_0x474745[_0x328ce7(0x138)]['prod_code']],_0x554b2c=[_0x474745[_0x328ce7(0x138)]['prod_Qty']],_0x4b334f=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x11a)]],_0x3334d9=[_0x474745[_0x328ce7(0x138)]['prod_secondunit']],_0x33fd13=[_0x474745['body'][_0x328ce7(0x112)]],_0x1d51ea=[_0x474745['body'][_0x328ce7(0x172)]],_0x330d45=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0xfd)]],_0x5b1f36=[_0x474745[_0x328ce7(0x138)]['batch_code']],_0x151bee=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x1c6)]],_0x435bea=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x178)]],_0x24e87b=[_0x474745['body']['max_product_unit']],_0xcde90b=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x1fd)]],_0x30c723=[_0x474745[_0x328ce7(0x138)]['RoomAssign']],_0x51b3a0=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x1ad)]],_0x1731eb=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x1de)]],_0x419874=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x10e)]],_0x116900=[_0x474745[_0x328ce7(0x138)][_0x328ce7(0x171)]];else var _0x10f1b5=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x143)]],_0x4f571d=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x193)]],_0x554b2c=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x141)]],_0x4b334f=[..._0x474745['body'][_0x328ce7(0x11a)]],_0x3334d9=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x101)]],_0x33fd13=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x112)]],_0x1d51ea=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x172)]],_0x330d45=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0xfd)]],_0x5b1f36=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x185)]],_0x151bee=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x1c6)]],_0x435bea=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x178)]],_0x24e87b=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x1ce)]],_0xcde90b=[..._0x474745[_0x328ce7(0x138)]['prod_cat']],_0x30c723=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x1f5)]],_0x51b3a0=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x1ad)]],_0x1731eb=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x1de)]],_0x419874=[..._0x474745[_0x328ce7(0x138)][_0x328ce7(0x10e)]],_0x116900=[..._0x474745['body'][_0x328ce7(0x171)]];const _0x904fa2=_0x10f1b5[_0x328ce7(0x168)](_0x4cf880=>{return _0x4cf880={'product_name':_0x4cf880};});_0x116900['forEach']((_0x2aa3bb,_0x32cb9a)=>{var _0x13baae=_0x328ce7;_0x904fa2[_0x32cb9a]['product_id']=_0x2aa3bb,_0x904fa2[_0x32cb9a][_0x13baae(0x161)]=_0x4b242a;}),_0x419874[_0x328ce7(0x110)]((_0x1145be,_0x1b7c98)=>{_0x904fa2[_0x1b7c98]['sales_category']=_0x1145be;}),_0x4f571d['forEach']((_0x25758c,_0x5c9a51)=>{var _0x3c1480=_0x328ce7;_0x904fa2[_0x5c9a51][_0x3c1480(0x1a2)]=_0x25758c;}),_0x1731eb[_0x328ce7(0x110)]((_0x59e6b1,_0x3fb982)=>{var _0x341da1=_0x328ce7;_0x904fa2[_0x3fb982][_0x341da1(0x1de)]=_0x59e6b1;}),_0x554b2c[_0x328ce7(0x110)]((_0x4a2392,_0x15b069)=>{var _0x1dcc2d=_0x328ce7;_0x904fa2[_0x15b069]['quantity']=Math[_0x1dcc2d(0x117)](_0x4a2392);}),_0x4b334f[_0x328ce7(0x110)]((_0xa4234,_0x36a075)=>{var _0x46bca4=_0x328ce7;_0x904fa2[_0x36a075][_0x46bca4(0x12c)]=_0xa4234;}),_0x3334d9[_0x328ce7(0x110)]((_0x571802,_0x231ca4)=>{_0x904fa2[_0x231ca4]['secondary_unit']=_0x571802;}),_0x33fd13['forEach']((_0x54e195,_0x4a6f16)=>{var _0x20d715=_0x328ce7;_0x904fa2[_0x4a6f16][_0x20d715(0x112)]=_0x54e195;}),_0x1d51ea[_0x328ce7(0x110)]((_0x34f671,_0x1ff655)=>{var _0x5cebc7=_0x328ce7;_0x904fa2[_0x1ff655][_0x5cebc7(0x172)]=_0x34f671;}),_0x330d45[_0x328ce7(0x110)]((_0x471a60,_0x17ff54)=>{var _0x33e836=_0x328ce7;_0x904fa2[_0x17ff54][_0x33e836(0x108)]=_0x471a60;}),_0x5b1f36[_0x328ce7(0x110)]((_0x2312fa,_0x179ae8)=>{_0x904fa2[_0x179ae8]['batch_code']=_0x2312fa;}),_0x151bee[_0x328ce7(0x110)]((_0x38b4a3,_0x17aee7)=>{_0x904fa2[_0x17aee7]['expiry_date']=_0x38b4a3;}),_0x435bea[_0x328ce7(0x110)]((_0x58fa97,_0x163fc8)=>{var _0x1d3fdd=_0x328ce7;_0x904fa2[_0x163fc8][_0x1d3fdd(0x1d8)]=_0x58fa97;}),_0x24e87b[_0x328ce7(0x110)]((_0x7ca78f,_0x2f92c1)=>{_0x904fa2[_0x2f92c1]['maxperunit']=_0x7ca78f;}),_0xcde90b['forEach']((_0x2d67ee,_0x26c12d)=>{var _0x4386ec=_0x328ce7;_0x904fa2[_0x26c12d][_0x4386ec(0x1f3)]=_0x2d67ee;}),_0x30c723[_0x328ce7(0x110)]((_0x284546,_0x58e387)=>{_0x904fa2[_0x58e387]['room_name']=_0x284546;}),_0x51b3a0[_0x328ce7(0x110)]((_0x4b0c37,_0x2840cb)=>{var _0xf26632=_0x328ce7;_0x904fa2[_0x2840cb][_0xf26632(0x1ad)]=_0x4b0c37;});const _0x3aabaf=new invoice_for_incoming();await _0x3aabaf[_0x328ce7(0x1c8)]();for(let _0x542a61=0x0;_0x542a61<=_0x30c723[_0x328ce7(0x1b7)]-0x1;_0x542a61++){_0x904fa2[_0x542a61]['invoice']=_0x328ce7(0x116)+_0x3aabaf[_0x328ce7(0x1f9)][_0x328ce7(0x156)]()[_0x328ce7(0x134)](0x8,'0');}const _0xf21e40=await warehouse_validation_setup[_0x328ce7(0x119)]([{'$match':{'warehouse_name':_0x28c790}}]);for(let _0x5899f7=0x0;_0x5899f7<=_0xf21e40['length']-0x1;_0x5899f7++){const _0xd95afe=_0xf21e40[_0x5899f7];for(let _0x356b1c=0x0;_0x356b1c<=_0xd95afe[_0x328ce7(0xed)]['length']-0x1;_0x356b1c++){const _0x405db1=_0xd95afe['product_data'][_0x356b1c],_0x3a4d4e=await warehouse[_0x328ce7(0x119)]([{'$match':{'name':_0xd95afe[_0x328ce7(0x1cf)],'room':_0xd95afe[_0x328ce7(0x1e3)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x405db1[_0x328ce7(0x187)],'product_details.bay':parseInt(_0x405db1[_0x328ce7(0xff)]),'product_details.product_code':_0x405db1[_0x328ce7(0x1a2)]}}]);for(let _0x3e1377=0x0;_0x3e1377<=_0x3a4d4e[_0x328ce7(0x1b7)]-0x1;_0x3e1377++){let _0x4608cc=_0x3a4d4e[_0x3e1377],_0x5aa7e8=0x0;_0x4608cc[_0x328ce7(0x151)][_0x328ce7(0x1a2)]==_0x405db1[_0x328ce7(0x1a2)]&&_0x4608cc[_0x328ce7(0x151)]['bay']==_0x405db1[_0x328ce7(0xff)]&&_0x4608cc['product_details']['level']==_0x405db1[_0x328ce7(0x187)]&&(_0x405db1[_0x328ce7(0x177)]=parseInt(_0x405db1[_0x328ce7(0x177)])-parseInt(_0x4608cc[_0x328ce7(0x151)][_0x328ce7(0x1bf)]),_0x5aa7e8++),_0x5aa7e8=='0'&&(parseInt(_0x405db1[_0x328ce7(0x177)])>0x0&&(_0xf21e40[_0x5899f7][_0x328ce7(0xed)]=_0xf21e40[_0x5899f7][_0x328ce7(0xed)][_0x328ce7(0xec)]({'bay':_0x405db1['bay'],'bin':_0x405db1[_0x328ce7(0xff)],'max':_0x405db1[_0x328ce7(0x177)],'min':_0x405db1['min'],'product_code':_0x405db1[_0x328ce7(0x1a2)],'product_id':_0x405db1[_0x328ce7(0x171)],'product_name':_0x405db1[_0x328ce7(0x13d)]})));}}_0xf21e40[_0x5899f7][_0x328ce7(0xed)]=_0xf21e40[_0x5899f7][_0x328ce7(0xed)]['filter'](_0x3e6de9=>parseInt(_0x3e6de9[_0x328ce7(0x177)])>0x0);}let _0x481ecd=[];for(let _0xf7eaa0=0x0;_0xf7eaa0<=_0x904fa2[_0x328ce7(0x1b7)]-0x1;_0xf7eaa0++){const _0x1b744e=_0x904fa2[_0xf7eaa0];for(let _0x538d2e=0x0;_0x538d2e<=_0xf21e40[_0x328ce7(0x1b7)]-0x1;_0x538d2e++){const _0x5b45f4=_0xf21e40[_0x538d2e];for(let _0x5d05e3=0x0;_0x5d05e3<=_0x5b45f4[_0x328ce7(0xed)][_0x328ce7(0x1b7)]-0x1;_0x5d05e3++){const _0x55df79=_0x5b45f4['product_data'][_0x5d05e3];if(_0x55df79[_0x328ce7(0x1a2)]===_0x1b744e[_0x328ce7(0x1a2)]){let _0x287ded=_0x1b744e[_0x328ce7(0x133)];const _0x5bdbf9=await warehouse[_0x328ce7(0x119)]([{'$match':{'name':_0x28c790,'room':_0x5b45f4[_0x328ce7(0x1e3)]}},{'$unwind':_0x328ce7(0xdc)},{'$match':{'product_details.level':_0x55df79[_0x328ce7(0x187)],'product_details.bay':parseInt(_0x55df79[_0x328ce7(0xff)])}}]);if(_0x5bdbf9['length']==0x0){for(let _0xd13aae=0x0;_0xd13aae<=_0x5b45f4[_0x328ce7(0xed)][_0x328ce7(0x1b7)]-0x1&&_0x287ded>0x0;_0xd13aae++){const _0x40536a=_0x5b45f4[_0x328ce7(0xed)][_0xd13aae];if(_0x1b744e['product_code']===_0x40536a[_0x328ce7(0x1a2)]){_0x481ecd[_0xd13aae]={};const _0x446791=parseInt(_0x40536a[_0x328ce7(0x177)]),_0x2f40ba=0x0;let _0x257413=_0x446791-_0x2f40ba,_0xc04ff1=Math['min'](_0x287ded,_0x257413);console['log'](_0x328ce7(0x162)+_0xc04ff1+_0x328ce7(0xcb)+_0x5b45f4[_0x328ce7(0x1cf)]+_0x328ce7(0x179)+_0x5b45f4[_0x328ce7(0x1e3)]+_0x328ce7(0x19f)+_0x40536a[_0x328ce7(0x187)]+_0x328ce7(0x1da)+_0x40536a[_0x328ce7(0xff)]),_0x481ecd[_0xd13aae][_0x328ce7(0x13d)]=_0x1b744e[_0x328ce7(0x13d)],_0x481ecd[_0xd13aae][_0x328ce7(0x1a2)]=_0x1b744e['product_code'],_0x481ecd[_0xd13aae][_0x328ce7(0x171)]=_0x1b744e[_0x328ce7(0x171)],_0x481ecd[_0xd13aae][_0x328ce7(0x161)]=_0x1b744e[_0x328ce7(0x161)],_0x481ecd[_0xd13aae]['sales_category']=_0x1b744e[_0x328ce7(0x1c9)],_0x481ecd[_0xd13aae][_0x328ce7(0x1de)]=_0x1b744e[_0x328ce7(0x1de)],_0x481ecd[_0xd13aae]['quantity']=_0xc04ff1,_0x481ecd[_0xd13aae][_0x328ce7(0x12c)]=_0x1b744e['standard_unit'],_0x481ecd[_0xd13aae]['secondary_unit']=_0x1b744e[_0x328ce7(0xf5)],_0x481ecd[_0xd13aae][_0x328ce7(0x112)]=_0x1b744e[_0x328ce7(0x112)],_0x481ecd[_0xd13aae][_0x328ce7(0x172)]=_0x1b744e[_0x328ce7(0x172)],_0x481ecd[_0xd13aae][_0x328ce7(0x108)]=_0x1b744e['maxStocks'],_0x481ecd[_0xd13aae]['batch_code']=_0x1b744e[_0x328ce7(0x185)],_0x481ecd[_0xd13aae][_0x328ce7(0x1c6)]=_0x1b744e['expiry_date'],_0x481ecd[_0xd13aae][_0x328ce7(0x1d8)]=_0x1b744e['production_date'],_0x481ecd[_0xd13aae]['maxperunit']=_0x1b744e[_0x328ce7(0x11b)],_0x481ecd[_0xd13aae][_0x328ce7(0x1f3)]=_0x1b744e[_0x328ce7(0x1f3)],_0x481ecd[_0xd13aae][_0x328ce7(0x109)]=_0x1b744e['invoice'],_0x481ecd[_0xd13aae][_0x328ce7(0x1ad)]=_0x1b744e[_0x328ce7(0x1ad)],_0x481ecd[_0xd13aae]['room_name']=_0x5b45f4[_0x328ce7(0x1e3)],_0x481ecd[_0xd13aae][_0x328ce7(0x12e)]=_0x40536a[_0x328ce7(0x187)],_0x481ecd[_0xd13aae][_0x328ce7(0x187)]=_0x40536a['bin'],_0x287ded-=_0xc04ff1;if(_0x287ded<=0x0)break;}}if(_0x287ded<=0x0)break;_0x287ded>0x0&&console[_0x328ce7(0x1ef)](_0x328ce7(0x1dc)+_0x287ded+_0x328ce7(0x207));}else console[_0x328ce7(0x1ef)](_0x55df79[_0x328ce7(0x1a2)]+_0x328ce7(0x1fa)+_0x55df79[_0x328ce7(0x187)]+_0x328ce7(0x1fa)+_0x55df79[_0x328ce7(0xff)]);}}}}const _0x15bafd=_0x481ecd[_0x328ce7(0x1aa)](_0x122d12=>_0x122d12[_0x328ce7(0x133)]!=='0'&&_0x122d12[_0x328ce7(0x133)]!==''),_0x283f01=new purchases_finished({'invoice':'INC-'+_0x3aabaf['invoice_init'][_0x328ce7(0x156)]()[_0x328ce7(0x134)](0x8,'0'),'suppliers':_0x5cdc38,'date':_0x4b242a,'warehouse_name':_0x28c790,'product':_0x15bafd,'note':_0x385c10,'due_amount':_0x441bb6,'room':_0x4356d6,'POnumber':_0x3b5d18,'SCRN':_0x2245ee,'JO_number':_0x2a303,'ReqBy':_0x1583ea,'dateofreq':_0x596e8a,'typeservicesData':_0x524722,'van':_0x11c238,'typevehicle':_0x520987,'driver':_0x2ad6f5,'plate':_0x20e3b2,'DRSI':_0x548165,'TSU':_0x1675ac,'TFU':_0x55dfb0,'typeOfProducts':_0x4e11a8}),_0x12e87a=await _0x283f01[_0x328ce7(0x1c8)](),_0x363d5a=await purchases_finished[_0x328ce7(0x1ba)]({'_id':_0x12e87a[_0x328ce7(0x160)]['valueOf']()});_0x474745[_0x328ce7(0x1e6)](_0x328ce7(0x1ab),_0x328ce7(0x1df)),_0x4fadc8[_0x328ce7(0x18d)](_0x328ce7(0x122)+_0x363d5a['_id']['valueOf']());}catch(_0x2cce25){console['log'](_0x2cce25);}}),router[a0_0x5804c6(0x19e)](a0_0x5804c6(0x164),auth,async(_0x4c3d5f,_0x4a8ab6)=>{var _0x50299b=a0_0x5804c6;try{const {username:_0x383844,email:_0x1b5ff6,role:_0x672a0a}=_0x4c3d5f[_0x50299b(0xd0)],_0x3bf662=_0x4c3d5f[_0x50299b(0xd0)],_0x879ba5=_0x4c3d5f[_0x50299b(0x202)]['id'],_0xf0381e=await profile[_0x50299b(0x1ba)]({'email':_0x3bf662['email']}),_0x6f9fc7=await master_shop[_0x50299b(0x1e4)](),_0x32fdcb=await staff['findOne']({'email':_0x3bf662['email']}),_0x52059e=await suppliers[_0x50299b(0x1e4)]({});let _0x1a8504;if(_0x3bf662[_0x50299b(0x1c0)]==_0x50299b(0x1e5)){const _0x2b9768=await staff['findOne']({'email':_0x3bf662[_0x50299b(0x113)]});_0x1a8504=await warehouse[_0x50299b(0x119)]([{'$match':{'status':'Enabled','name':_0x2b9768[_0x50299b(0x137)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1a8504=await warehouse[_0x50299b(0x119)]([{'$match':{'status':_0x50299b(0xdf)}},{'$group':{'_id':_0x50299b(0x115),'name':{'$first':'$name'}}}]);const _0x39d6e7=await purchases_finished[_0x50299b(0x19b)](_0x879ba5);if(_0x6f9fc7[0x0][_0x50299b(0xd5)]=='English\x20(US)')var _0x5349c4=users[_0x50299b(0x165)];else{if(_0x6f9fc7[0x0]['language']==_0x50299b(0x1ae))var _0x5349c4=users[_0x50299b(0x1ae)];else{if(_0x6f9fc7[0x0][_0x50299b(0xd5)]=='German')var _0x5349c4=users[_0x50299b(0x18b)];else{if(_0x6f9fc7[0x0][_0x50299b(0xd5)]==_0x50299b(0x114))var _0x5349c4=users[_0x50299b(0x114)];else{if(_0x6f9fc7[0x0][_0x50299b(0xd5)]=='French')var _0x5349c4=users[_0x50299b(0x1d5)];else{if(_0x6f9fc7[0x0][_0x50299b(0xd5)]==_0x50299b(0x1f1))var _0x5349c4=users[_0x50299b(0x186)];else{if(_0x6f9fc7[0x0][_0x50299b(0xd5)]=='Chinese')var _0x5349c4=users[_0x50299b(0x12f)];else{if(_0x6f9fc7[0x0][_0x50299b(0xd5)]==_0x50299b(0xcf))var _0x5349c4=users[_0x50299b(0x17e)];}}}}}}}_0x4a8ab6[_0x50299b(0x100)](_0x50299b(0x1f8),{'success':_0x4c3d5f['flash'](_0x50299b(0x1ab)),'errors':_0x4c3d5f[_0x50299b(0x1e6)](_0x50299b(0x1d1)),'role':_0x3bf662,'profile':_0xf0381e,'suppliers':_0x52059e,'warehouse':_0x1a8504,'master_shop':_0x6f9fc7,'language':_0x5349c4,'purchases_data':_0x39d6e7});}catch(_0x3e15ec){console[_0x50299b(0x1ef)](_0x3e15ec);}});async function get_warehouse_data(_0x53e932,_0x298247){var _0x16db4f=a0_0x5804c6;try{const _0x4b90ba=await warehouse_temporary[_0x16db4f(0x1ba)]({'name':_0x53e932,'room':_0x298247});if(!_0x4b90ba){const _0x512400=new warehouse_temporary({'name':_0x53e932,'address':_0x53e932,'status':_0x16db4f(0xdf),'room':_0x298247,'isStaging':_0x16db4f(0x124)});return await _0x512400[_0x16db4f(0x1c8)](),_0x512400;}else return _0x4b90ba;}catch(_0x16c10e){console['error']('Error\x20fetching\x20or\x20saving\x20warehouse\x20data:',_0x16c10e);throw _0x16c10e;}}function a0_0x408a(_0x2cac9d,_0x400fa0){var _0x222fde=a0_0x222f();return a0_0x408a=function(_0x408a14,_0x362573){_0x408a14=_0x408a14-0xcb;var _0x5242de=_0x222fde[_0x408a14];return _0x5242de;},a0_0x408a(_0x2cac9d,_0x400fa0);}router['post'](a0_0x5804c6(0x164),auth,async(_0x1cc139,_0x575925)=>{var _0x3f61f6=a0_0x5804c6;try{const _0xaf3296=_0x1cc139[_0x3f61f6(0x202)]['id'],_0x513d03=await purchases_finished[_0x3f61f6(0x19b)](_0xaf3296);let _0x31c0e6=[];_0x513d03[_0x3f61f6(0x1ac)][_0x3f61f6(0x110)]((_0x5b6ac6,_0x5ea212)=>{var _0x71b337=_0x3f61f6;_0x31c0e6[_0x5ea212]={},_0x31c0e6[_0x5ea212][_0x71b337(0x137)]=_0x513d03['warehouse_name'],_0x31c0e6[_0x5ea212]['product_id']=_0x5b6ac6[_0x71b337(0x171)],_0x31c0e6[_0x5ea212][_0x71b337(0x13d)]=_0x5b6ac6['product_name'],_0x31c0e6[_0x5ea212]['product_code']=_0x5b6ac6['product_code'],_0x31c0e6[_0x5ea212]['product_stock']=_0x5b6ac6['quantity'],_0x31c0e6[_0x5ea212][_0x71b337(0x158)]=_0x5b6ac6[_0x71b337(0x12c)],_0x31c0e6[_0x5ea212][_0x71b337(0xf5)]=_0x5b6ac6[_0x71b337(0xf5)],_0x31c0e6[_0x5ea212][_0x71b337(0x12e)]=_0x5b6ac6[_0x71b337(0x12e)],_0x31c0e6[_0x5ea212][_0x71b337(0x187)]=_0x5b6ac6[_0x71b337(0x187)],_0x31c0e6[_0x5ea212]['primary_code']=_0x5b6ac6[_0x71b337(0x112)],_0x31c0e6[_0x5ea212][_0x71b337(0x172)]=_0x5b6ac6[_0x71b337(0x172)],_0x31c0e6[_0x5ea212][_0x71b337(0x108)]=_0x5b6ac6['maxStocks'],_0x31c0e6[_0x5ea212][_0x71b337(0x185)]=_0x5b6ac6[_0x71b337(0x185)],_0x31c0e6[_0x5ea212]['expiry_date']=_0x5b6ac6[_0x71b337(0x1c6)],_0x31c0e6[_0x5ea212]['production_date']=_0x5b6ac6[_0x71b337(0x1d8)],_0x31c0e6[_0x5ea212][_0x71b337(0x11b)]=_0x5b6ac6[_0x71b337(0x11b)],_0x31c0e6[_0x5ea212][_0x71b337(0x1f3)]=_0x5b6ac6[_0x71b337(0x1f3)],_0x31c0e6[_0x5ea212][_0x71b337(0x104)]=_0x5b6ac6[_0x71b337(0x104)],_0x31c0e6[_0x5ea212][_0x71b337(0x109)]=_0x5b6ac6['invoice'],_0x31c0e6[_0x5ea212]['uuid']=_0x5b6ac6[_0x71b337(0x1de)],_0x31c0e6[_0x5ea212][_0x71b337(0x1ad)]=_0x5b6ac6['gross_price'],_0x31c0e6[_0x5ea212][_0x71b337(0x1c9)]=_0x5b6ac6[_0x71b337(0x1c9)],_0x31c0e6[_0x5ea212]['date_recieved']=_0x5b6ac6[_0x71b337(0x161)],_0x31c0e6[_0x5ea212][_0x71b337(0x15e)]=_0x5b6ac6['_id'][_0x71b337(0x1b5)](),_0x31c0e6[_0x5ea212]['data_type']=_0x71b337(0x1f6);});for(let _0x4dfcdc=0x0;_0x4dfcdc<=_0x31c0e6[_0x3f61f6(0x1b7)]-0x1;_0x4dfcdc++){const _0x55ec65=_0x31c0e6[_0x4dfcdc],_0x4da591=new warehouse_temporary(_0x55ec65);await _0x4da591[_0x3f61f6(0x1c8)]();}_0x513d03[_0x3f61f6(0x123)]=_0x3f61f6(0xfb),await _0x513d03[_0x3f61f6(0x1c8)](),_0x1cc139[_0x3f61f6(0x1e6)]('success',_0x3f61f6(0x170)),_0x575925[_0x3f61f6(0x18d)](_0x3f61f6(0x122)+_0x513d03[_0x3f61f6(0x160)][_0x3f61f6(0x1b5)]());}catch(_0x54ec90){}}),router[a0_0x5804c6(0x13f)](a0_0x5804c6(0x11f),auth,async(_0xbf5722,_0x2b159e)=>{var _0x3dafa7=a0_0x5804c6;try{const {invoice:_0x337752,date:_0x4acda4,warehouse_name:_0x14e312,prod_name:_0x11cc22,note:_0x269688,due_amount:_0x385d4d,Room_name:_0x191718,PO_number:_0x27d2ca,SCRN:_0x4ae71c,ReqBy:_0x2b82f1,dateofreq:_0x91f476,suppliers:_0x41ef2a,typeservicesData:_0x2fa1ef,van:_0x2943a7,typevehicle:_0x5dea42,driver:_0x39d41c,plate:_0x149ec2,DRSI:_0x51a105,TSU:_0x3deaa9,TFU:_0x36eb18,JO_number:_0x316a17,type_of_products:_0x1c45aa}=_0xbf5722['body'];if(typeof _0x11cc22=='string')var _0x301d58=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x143)]],_0x18e5ee=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x193)]],_0x51b40c=[_0xbf5722[_0x3dafa7(0x138)]['prod_Qty']],_0x56fcfe=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x11a)]],_0x1b75e2=[_0xbf5722['body'][_0x3dafa7(0x101)]],_0x62876c=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1a4)]],_0x16673d=[_0xbf5722['body'][_0x3dafa7(0x112)]],_0x418fe5=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x172)]],_0x469d09=[_0xbf5722['body']['MaxStocks_data']],_0x18a46f=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x185)]],_0x4dea2b=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1c6)]],_0x28f954=[_0xbf5722['body'][_0x3dafa7(0x178)]],_0x29fc74=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1ce)]],_0x21d070=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1fd)]],_0x3316bb=[_0xbf5722['body']['RoomAssign']],_0x20bbd1=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1ad)]],_0x25f3e1=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1de)]],_0x3db8cf=[_0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x10e)]],_0x47547f=[_0xbf5722['body'][_0x3dafa7(0xd9)]];else var _0x301d58=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x143)]],_0x18e5ee=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x193)]],_0x51b40c=[..._0xbf5722['body'][_0x3dafa7(0x141)]],_0x56fcfe=[..._0xbf5722['body'][_0x3dafa7(0x11a)]],_0x1b75e2=[..._0xbf5722['body'][_0x3dafa7(0x101)]],_0x62876c=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1a4)]],_0x16673d=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x112)]],_0x418fe5=[..._0xbf5722['body'][_0x3dafa7(0x172)]],_0x469d09=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0xfd)]],_0x18a46f=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x185)]],_0x4dea2b=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1c6)]],_0x28f954=[..._0xbf5722[_0x3dafa7(0x138)]['product_date']],_0x29fc74=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1ce)]],_0x21d070=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1fd)]],_0x3316bb=[..._0xbf5722['body'][_0x3dafa7(0x1f5)]],_0x20bbd1=[..._0xbf5722['body'][_0x3dafa7(0x1ad)]],_0x25f3e1=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0x1de)]],_0x3db8cf=[..._0xbf5722['body'][_0x3dafa7(0x10e)]],_0x47547f=[..._0xbf5722[_0x3dafa7(0x138)][_0x3dafa7(0xd9)]];const _0x15c588=_0x301d58[_0x3dafa7(0x168)](_0x1c06b9=>{return _0x1c06b9={'product_name':_0x1c06b9};});_0x47547f[_0x3dafa7(0x110)]((_0x43437b,_0x2e19fa)=>{var _0x6703a3=_0x3dafa7;_0x15c588[_0x2e19fa][_0x6703a3(0xf9)]=_0x43437b;}),_0x3db8cf[_0x3dafa7(0x110)]((_0x45e49d,_0x302ec8)=>{_0x15c588[_0x302ec8]['sales_category']=_0x45e49d;}),_0x18e5ee[_0x3dafa7(0x110)]((_0x39d21a,_0x284343)=>{var _0x247927=_0x3dafa7;_0x15c588[_0x284343][_0x247927(0x1a2)]=_0x39d21a;}),_0x25f3e1['forEach']((_0x2b8d17,_0x59afe7)=>{var _0x2b6fe0=_0x3dafa7;_0x15c588[_0x59afe7][_0x2b6fe0(0x1de)]=_0x2b8d17;}),_0x51b40c[_0x3dafa7(0x110)]((_0x11bc02,_0x54561c)=>{var _0x5a4a6c=_0x3dafa7;_0x15c588[_0x54561c]['quantity']=Math[_0x5a4a6c(0x117)](_0x11bc02);}),_0x56fcfe[_0x3dafa7(0x110)]((_0xf9c4cd,_0x53b130)=>{var _0x306c9c=_0x3dafa7;_0x15c588[_0x53b130][_0x306c9c(0x12c)]=_0xf9c4cd;}),_0x1b75e2[_0x3dafa7(0x110)]((_0x893dd3,_0x21a29e)=>{var _0xbeb5b=_0x3dafa7;_0x15c588[_0x21a29e][_0xbeb5b(0xf5)]=_0x893dd3;}),_0x62876c[_0x3dafa7(0x110)]((_0x5aa0ac,_0x657e7)=>{var _0x4843e0=_0x3dafa7,_0x113454=_0x5aa0ac[_0x4843e0(0x1c1)](/[A-Za-z]+/)[0x0],_0x398bf4=parseInt(_0x5aa0ac['match'](/\d+/)[0x0]);_0x15c588[_0x657e7][_0x4843e0(0x12e)]=_0x113454,_0x15c588[_0x657e7][_0x4843e0(0x187)]=_0x398bf4;}),_0x16673d[_0x3dafa7(0x110)]((_0x3a9452,_0x3560e1)=>{_0x15c588[_0x3560e1]['primary_code']=_0x3a9452;}),_0x418fe5[_0x3dafa7(0x110)]((_0x38c892,_0x544a3c)=>{var _0x2ad313=_0x3dafa7;_0x15c588[_0x544a3c][_0x2ad313(0x172)]=_0x38c892;}),_0x469d09['forEach']((_0xeadd9e,_0x4903e0)=>{_0x15c588[_0x4903e0]['maxStocks']=_0xeadd9e;}),_0x18a46f['forEach']((_0x48ed44,_0xec2e4d)=>{_0x15c588[_0xec2e4d]['batch_code']=_0x48ed44;}),_0x4dea2b[_0x3dafa7(0x110)]((_0x254daf,_0x223833)=>{var _0x54d7e6=_0x3dafa7;_0x15c588[_0x223833][_0x54d7e6(0x1c6)]=_0x254daf;}),_0x28f954['forEach']((_0x3a4abf,_0x34c55f)=>{var _0x2ef912=_0x3dafa7;_0x15c588[_0x34c55f][_0x2ef912(0x1d8)]=_0x3a4abf;}),_0x29fc74[_0x3dafa7(0x110)]((_0x2938ce,_0x38982b)=>{var _0x3500c6=_0x3dafa7;_0x15c588[_0x38982b][_0x3500c6(0x11b)]=_0x2938ce;}),_0x21d070[_0x3dafa7(0x110)]((_0x1a5b08,_0x3311b4)=>{_0x15c588[_0x3311b4]['product_cat']=_0x1a5b08;}),_0x3316bb[_0x3dafa7(0x110)]((_0x49a220,_0x5bfdf5)=>{_0x15c588[_0x5bfdf5]['room_name']=_0x49a220;}),_0x20bbd1[_0x3dafa7(0x110)]((_0x30de91,_0x5758f5)=>{_0x15c588[_0x5758f5]['gross_price']=_0x30de91;});const _0x22d816=new purchases_logs();await _0x22d816[_0x3dafa7(0x1c8)]();for(let _0x44d577=0x0;_0x44d577<=_0x3316bb[_0x3dafa7(0x1b7)]-0x1;_0x44d577++){_0x15c588[_0x44d577][_0x3dafa7(0x109)]=_0x3dafa7(0x183)+_0x22d816['invoice_init'][_0x3dafa7(0x156)]()[_0x3dafa7(0x134)](0x8,'0');}const _0x34dbd9=_0x15c588[_0x3dafa7(0x1aa)](_0x4f7445=>_0x4f7445[_0x3dafa7(0x133)]!=='0'&&_0x4f7445['quantity']!==''),_0x533862=new purchases_finished({'invoice':_0x3dafa7(0x183)+_0x22d816[_0x3dafa7(0x1f9)]['toString']()[_0x3dafa7(0x134)](0x8,'0'),'suppliers':_0x41ef2a,'date':_0x4acda4,'warehouse_name':_0x14e312,'product':_0x34dbd9,'note':_0x269688,'due_amount':_0x385d4d,'room':_0x191718,'POnumber':_0x27d2ca,'SCRN':_0x4ae71c,'JO_number':_0x316a17,'ReqBy':_0x2b82f1,'dateofreq':_0x91f476,'typeservicesData':_0x2fa1ef,'van':_0x2943a7,'typevehicle':_0x5dea42,'driver':_0x39d41c,'plate':_0x149ec2,'DRSI':_0x51a105,'TSU':_0x3deaa9,'TFU':_0x36eb18,'typeOfProducts':_0x1c45aa}),_0x384d5a=await _0x533862[_0x3dafa7(0x1c8)](),_0xcbf0f=await purchases_finished[_0x3dafa7(0x1ba)]({'_id':_0x384d5a[_0x3dafa7(0x160)][_0x3dafa7(0x1b5)]()}),_0x555498=_0xcbf0f[_0x3dafa7(0x1ac)][_0x3dafa7(0x168)](async _0x4de519=>{var _0x2a926a=_0x3dafa7;try{var _0x46a2f2=await warehouse['findOne']({'name':_0x14e312,'room':_0x4de519[_0x2a926a(0x104)]}),_0x5b492e=0x0;const _0x177dff=_0x46a2f2[_0x2a926a(0x151)]['map'](_0x57ec19=>{var _0x15dc33=_0x2a926a;console[_0x15dc33(0x1ef)](_0x57ec19['product_name']+'=='+_0x4de519[_0x15dc33(0x13d)]+'&&'+_0x57ec19[_0x15dc33(0x187)]+'=='+_0x4de519['bay']+'&&'+_0x57ec19[_0x15dc33(0x1c6)]+'=='+_0x4de519[_0x15dc33(0x1c6)]+'&&'+_0x57ec19[_0x15dc33(0x1d8)]+'=='+_0x4de519[_0x15dc33(0x1d8)]+'&&'+_0x57ec19[_0x15dc33(0x185)]+'=='+_0x4de519[_0x15dc33(0x185)]+'&&'+_0x57ec19[_0x15dc33(0x109)]+'=='+_0xcbf0f[_0x15dc33(0x109)]),_0x57ec19[_0x15dc33(0x13d)]==_0x4de519['product_name']&&_0x57ec19[_0x15dc33(0x187)]==_0x4de519['bay']&&_0x57ec19['level']==_0x4de519[_0x15dc33(0x12e)]&&_0x57ec19[_0x15dc33(0x1c6)]==_0x4de519[_0x15dc33(0x1c6)]&&_0x57ec19['production_date']==_0x4de519['production_date']&&_0x57ec19[_0x15dc33(0x185)]==_0x4de519[_0x15dc33(0x185)]&&_0x57ec19['invoice']==_0xcbf0f[_0x15dc33(0x109)]&&(_0x57ec19['product_stock']=Math[_0x15dc33(0x117)](_0x57ec19['product_stock'])+Math[_0x15dc33(0x117)](_0x4de519[_0x15dc33(0x133)]),_0x5b492e++);});return _0x5b492e==0x0&&(_0x46a2f2[_0x2a926a(0x151)]=_0x46a2f2[_0x2a926a(0x151)]['concat']({'product_name':_0x4de519[_0x2a926a(0x13d)],'product_stock':Math[_0x2a926a(0x117)](_0x4de519['quantity']),'primary_code':_0x4de519['primary_code'],'secondary_code':_0x4de519[_0x2a926a(0x172)],'product_code':_0x4de519[_0x2a926a(0x1a2)],'bay':_0x4de519[_0x2a926a(0x187)],'level':_0x4de519['level'],'maxProducts':_0x4de519[_0x2a926a(0x108)],'unit':_0x4de519[_0x2a926a(0x12c)],'secondary_unit':_0x4de519[_0x2a926a(0xf5)],'expiry_date':_0x4de519[_0x2a926a(0x1c6)],'production_date':_0x4de519[_0x2a926a(0x1d8)],'maxProducts':_0x4de519['maxStocks'],'maxPerUnit':_0x4de519[_0x2a926a(0x11b)],'batch_code':_0x4de519[_0x2a926a(0x185)],'product_cat':_0x4de519[_0x2a926a(0x1f3)],'invoice':_0x4de519[_0x2a926a(0x109)],'id_incoming':_0x4de519[_0x2a926a(0x160)],'uuid':_0x4de519['uuid'],'gross_price':_0x4de519[_0x2a926a(0x1ad)],'sales_category':_0x4de519['sales_category'],'type_products':_0x4de519['type_of_products']})),_0x46a2f2;}catch(_0x5271d7){return console[_0x2a926a(0x132)]('Error\x20occurred\x20while\x20processing\x20product:',_0x5271d7),null;}});Promise[_0x3dafa7(0x102)](_0x555498)['then'](async _0x334fbd=>{var _0x258025=_0x3dafa7;try{for(const _0x284a7a of _0x334fbd){await warehouse[_0x258025(0x16a)]({'_id':_0x284a7a['_id']},{'$addToSet':{'product_details':{'$each':_0x284a7a['product_details']}}});}const _0x12229c=await master_shop['find'](),_0x1bb38b=await email_settings[_0x258025(0x1ba)](),_0x1220e8=await supervisor_settings[_0x258025(0x1e4)]();var _0x226244=_0xcbf0f[_0x258025(0x1ac)],_0x467b86='',_0x3eded6;for(_0x3eded6 in _0x226244){var _0x2923a6='FG';_0xcbf0f['warehouse_name']==_0x258025(0xeb)&&(_0x2923a6='DG'),_0x467b86+=_0x258025(0x1a3)+_0x258025(0x129)+_0x226244[_0x3eded6]['product_name']+_0x258025(0x10c)+_0x258025(0x129)+_0x226244[_0x3eded6][_0x258025(0x1a2)]+'</td>'+_0x258025(0x129)+_0x226244[_0x3eded6]['quantity']+_0x258025(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x226244[_0x3eded6]['standard_unit']+'</td>'+_0x258025(0x129)+_0x226244[_0x3eded6][_0x258025(0xf5)]+_0x258025(0x10c)+_0x258025(0x129)+_0xcbf0f[_0x258025(0x1cf)]+_0x258025(0x10c)+_0x258025(0x129)+_0x226244[_0x3eded6][_0x258025(0x104)]+_0x258025(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2923a6+_0x226244[_0x3eded6][_0x258025(0x187)]+_0x258025(0x10c),_0x258025(0xf7);}let _0x21f0e3=nodemailer[_0x258025(0x136)]({'host':_0x1bb38b[_0x258025(0x1e8)],'port':Number(_0x1bb38b['port']),'secure':![],'auth':{'user':_0x1bb38b[_0x258025(0x113)],'pass':_0x1bb38b[_0x258025(0x1d9)]}}),_0x30eab0={'from':_0x1bb38b[_0x258025(0x113)],'to':_0x1220e8[0x0]['FGSEmail'],'subject':_0x258025(0xfe),'attachments':[{'filename':'Logo.png','path':__dirname+_0x258025(0x1a0)+_0x258025(0x1e7)+_0x12229c[0x0][_0x258025(0x14f)],'cid':_0x258025(0x14d)}],'html':_0x258025(0x15a)+_0x258025(0x198)+_0x258025(0x144)+_0x258025(0x11e)+_0x258025(0x1af)+'<div>'+_0x258025(0x145)+_0x258025(0xd3)+_0x258025(0x11e)+_0x258025(0x194)+_0x12229c[0x0][_0x258025(0x199)]+_0x258025(0xd8)+'</div>'+_0x258025(0xd3)+'<hr\x20class=\x22my-3\x22>'+_0x258025(0x11e)+_0x258025(0xee)+_0x258025(0x1ee)+_0xcbf0f[_0x258025(0x109)]+'\x20'+_0x258025(0x1dd)+'\x20Order\x20Date\x20:\x20'+_0xcbf0f[_0x258025(0xe2)]+'\x20'+_0x258025(0x155)+_0x258025(0xf0)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x258025(0xea)+_0x258025(0x1a3)+_0x258025(0xe1)+_0x258025(0xef)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x258025(0x1a1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x258025(0x1ea)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x467b86+'\x20'+'</tbody>'+_0x258025(0x1ff)+_0x258025(0x11e)+_0x258025(0x17f)+'<h5>'+_0x12229c[0x0][_0x258025(0x199)]+_0x258025(0xf0)+_0x258025(0xd3)+_0x258025(0xd3)+_0x258025(0x1bd)};_0x21f0e3['sendMail'](_0x30eab0,function(_0x500165,_0x1e6b53){var _0x23524f=_0x258025;_0x500165?(console[_0x23524f(0x1ef)](_0x500165),console[_0x23524f(0x1ef)](_0x23524f(0x11d))):console[_0x23524f(0x1ef)](_0x23524f(0x10a));});}catch(_0x9bc3dd){console[_0x258025(0x132)](_0x9bc3dd),_0x2b159e['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x9bc3dd[_0x258025(0x157)]});}})[_0x3dafa7(0x1d2)](_0x260f1e=>{console['error'](_0x260f1e);}),_0xbf5722['flash']('success',_0x3dafa7(0x1df)),_0x2b159e['redirect']('/all_purchases_finished/preview/'+_0xcbf0f[_0x3dafa7(0x160)][_0x3dafa7(0x1b5)]());}catch(_0x21a152){console['log'](_0x21a152);}}),router['get'](a0_0x5804c6(0x19a),auth,async(_0x163a24,_0xc92b57)=>{var _0x2f71f6=a0_0x5804c6;try{const {username:_0x4bc4ce,email:_0x125f83,role:_0x2c348e}=_0x163a24[_0x2f71f6(0xd0)],_0x2336bd=_0x163a24[_0x2f71f6(0xd0)],_0x4f28bc=await profile[_0x2f71f6(0x1ba)]({'email':_0x2336bd[_0x2f71f6(0x113)]}),_0x4b3b5e=await master_shop[_0x2f71f6(0x1e4)](),_0x3daf37=_0x163a24[_0x2f71f6(0x202)]['id'],_0x16282b=await purchases_finished[_0x2f71f6(0x19b)](_0x3daf37),_0x153081=await suppliers['find']({});let _0x2d599a;if(_0x2336bd[_0x2f71f6(0x1c0)]==_0x2f71f6(0x1e5)){const _0x59e8e5=await staff[_0x2f71f6(0x1ba)]({'email':_0x2336bd[_0x2f71f6(0x113)]});_0x2d599a=await warehouse[_0x2f71f6(0x1e4)]({'status':'Enabled','name':_0x59e8e5['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x2d599a=await warehouse['aggregate']([{'$match':{'status':_0x2f71f6(0xdf),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2f71f6(0x115),'name':{'$first':_0x2f71f6(0x115)}}}]);const _0x5379b0=await product[_0x2f71f6(0x1e4)]({}),_0x2589d6=BayBinSelected(_0x16282b[_0x2f71f6(0x1cf)],_0x16282b[_0x2f71f6(0x1e3)]);let _0x46004d=new Date(_0x16282b[_0x2f71f6(0x1c6)]),_0x868493=('0'+_0x46004d['getDate']())[_0x2f71f6(0x173)](-0x2),_0x187a77=('0'+(_0x46004d[_0x2f71f6(0x1cc)]()+0x1))[_0x2f71f6(0x173)](-0x2),_0x37d986=_0x46004d[_0x2f71f6(0x16c)](),_0x2fa803=_0x37d986+'-'+_0x187a77+'-'+_0x868493;if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]==_0x2f71f6(0x189)){var _0x5e5c1=users[_0x2f71f6(0x165)];console[_0x2f71f6(0x1ef)](_0x5e5c1);}else{if(_0x4b3b5e[0x0]['language']==_0x2f71f6(0x1ae))var _0x5e5c1=users[_0x2f71f6(0x1ae)];else{if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]=='German')var _0x5e5c1=users['German'];else{if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]==_0x2f71f6(0x114))var _0x5e5c1=users['Spanish'];else{if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]==_0x2f71f6(0x1d5))var _0x5e5c1=users['French'];else{if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]==_0x2f71f6(0x1f1))var _0x5e5c1=users[_0x2f71f6(0x186)];else{if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]==_0x2f71f6(0x12f))var _0x5e5c1=users['Chinese'];else{if(_0x4b3b5e[0x0][_0x2f71f6(0xd5)]=='Arabic\x20(ae)')var _0x5e5c1=users[_0x2f71f6(0x17e)];}}}}}}}_0xc92b57[_0x2f71f6(0x100)]('edit_purchases_finished_view',{'success':_0x163a24['flash'](_0x2f71f6(0x1ab)),'errors':_0x163a24[_0x2f71f6(0x1e6)](_0x2f71f6(0x1d1)),'role':_0x2336bd,'profile':_0x4f28bc,'purchases':_0x16282b,'suppliers':_0x153081,'warehouse':_0x2d599a,'product':_0x5379b0,'master_shop':_0x4b3b5e,'language':_0x5e5c1,'ed_fullDate':_0x2fa803,'dataSelected':_0x2589d6});}catch(_0x2ca8ec){console['log'](_0x2ca8ec);}}),router[a0_0x5804c6(0x19e)](a0_0x5804c6(0x146),auth,async(_0x37aa93,_0x17bd4b)=>{var _0x2332c3=a0_0x5804c6;try{const {username:_0x5d88f4,email:_0x75326c,role:_0x4bd548}=_0x37aa93[_0x2332c3(0xd0)],_0x581fd4=_0x37aa93[_0x2332c3(0xd0)],_0x48ef94=await profile[_0x2332c3(0x1ba)]({'email':_0x581fd4['email']}),_0x4c183c=await master_shop[_0x2332c3(0x1e4)](),_0x5abcd1=_0x37aa93[_0x2332c3(0x202)]['id'],_0xe0aaaf=await purchases_finished[_0x2332c3(0x19b)](_0x5abcd1),_0x19665b=await suppliers[_0x2332c3(0x1e4)]({});let _0x56e187;if(_0x581fd4[_0x2332c3(0x1c0)]==_0x2332c3(0x1e5)){const _0x7b1a89=await staff[_0x2332c3(0x1ba)]({'email':_0x581fd4['email']});_0x56e187=await warehouse[_0x2332c3(0x1e4)]({'status':_0x2332c3(0xdf),'name':_0x7b1a89[_0x2332c3(0x137)],'warehouse_category':'Finished\x20Goods'});}else _0x56e187=await warehouse['aggregate']([{'$match':{'status':_0x2332c3(0xdf),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x2332c3(0x115)}}}]);const _0x413d53=await product[_0x2332c3(0x1e4)]({}),_0x176300=BayBinSelected(_0xe0aaaf[_0x2332c3(0x1cf)],_0xe0aaaf[_0x2332c3(0x1e3)]);let _0x5a9744=new Date(_0xe0aaaf['expiry_date']),_0x9536f7=('0'+_0x5a9744[_0x2332c3(0x1b4)]())[_0x2332c3(0x173)](-0x2),_0x155dd9=('0'+(_0x5a9744[_0x2332c3(0x1cc)]()+0x1))[_0x2332c3(0x173)](-0x2),_0x3e3798=_0x5a9744['getFullYear'](),_0x2c1d5c=_0x3e3798+'-'+_0x155dd9+'-'+_0x9536f7;if(_0x4c183c[0x0][_0x2332c3(0xd5)]==_0x2332c3(0x189)){var _0xa80e2b=users[_0x2332c3(0x165)];console['log'](_0xa80e2b);}else{if(_0x4c183c[0x0]['language']==_0x2332c3(0x1ae))var _0xa80e2b=users[_0x2332c3(0x1ae)];else{if(_0x4c183c[0x0][_0x2332c3(0xd5)]==_0x2332c3(0x18b))var _0xa80e2b=users[_0x2332c3(0x18b)];else{if(_0x4c183c[0x0][_0x2332c3(0xd5)]=='Spanish')var _0xa80e2b=users[_0x2332c3(0x114)];else{if(_0x4c183c[0x0]['language']==_0x2332c3(0x1d5))var _0xa80e2b=users[_0x2332c3(0x1d5)];else{if(_0x4c183c[0x0]['language']=='Portuguese\x20(BR)')var _0xa80e2b=users[_0x2332c3(0x186)];else{if(_0x4c183c[0x0][_0x2332c3(0xd5)]==_0x2332c3(0x12f))var _0xa80e2b=users[_0x2332c3(0x12f)];else{if(_0x4c183c[0x0][_0x2332c3(0xd5)]==_0x2332c3(0xcf))var _0xa80e2b=users[_0x2332c3(0x17e)];}}}}}}}_0x17bd4b['render'](_0x2332c3(0x17b),{'success':_0x37aa93[_0x2332c3(0x1e6)](_0x2332c3(0x1ab)),'errors':_0x37aa93[_0x2332c3(0x1e6)](_0x2332c3(0x1d1)),'role':_0x581fd4,'profile':_0x48ef94,'purchases':_0xe0aaaf,'suppliers':_0x19665b,'warehouse':_0x56e187,'product':_0x413d53,'master_shop':_0x4c183c,'language':_0xa80e2b,'ed_fullDate':_0x2c1d5c,'dataSelected':_0x176300});}catch(_0x24cd8b){console[_0x2332c3(0x1ef)](_0x24cd8b);}}),router[a0_0x5804c6(0x13f)](a0_0x5804c6(0x146),auth,async(_0x3e2e4f,_0x3e2db3)=>{var _0x47b482=a0_0x5804c6;try{const _0x2c0792=_0x3e2e4f[_0x47b482(0x202)]['id'],_0x1101af=await purchases_finished[_0x47b482(0x1ba)]({'_id':_0x3e2e4f[_0x47b482(0x202)]['id']}),_0x1e2c28=await warehouse[_0x47b482(0x1ba)]({'name':_0x1101af[_0x47b482(0x1cf)],'room':_0x1101af[_0x47b482(0x1e3)]});_0x1101af[_0x47b482(0x1ac)][_0x47b482(0x110)](_0x3f1074=>{var _0x38da9b=_0x47b482;const _0xacaad0=_0x1e2c28[_0x38da9b(0x151)][_0x38da9b(0x168)](_0x30d2e8=>{var _0x326273=_0x38da9b;_0x30d2e8[_0x326273(0x13d)]==_0x3f1074[_0x326273(0x13d)]&&_0x30d2e8[_0x326273(0x187)]==_0x3f1074['bay']&&(_0x30d2e8[_0x326273(0x1bf)]=parseInt(_0x30d2e8[_0x326273(0x1bf)])-parseInt(_0x3f1074[_0x326273(0x133)]));});}),await _0x1e2c28[_0x47b482(0x1c8)]();const {invoice:_0x2787f6,suppliers:_0xfc6ec6,date:_0x3f6668,warehouse_name:_0x3fa6b3,prod_name:_0x41397d,prod_code:_0x6d4d76,prod_qty:_0x36ebcc,prod_unit:_0x53b464,prod_secondunit:_0xc7fe6b,prod_level:_0x35efa0,prod_isle:_0x345a8a,prod_pallet:_0x5c53a2,note:_0x418f1d,expiry_date:_0x15d9fa,batch_code:_0x1191b5,paid_amount:_0x9d40b6,due_amount:_0x960caa,Room_name:_0x5aa8b3,primary_code:_0x9facbe,secondary_code:_0x4a11f7,PO_number:_0x5c1a27,JO_number:_0x2ba671}=_0x3e2e4f['body'];if(typeof _0x41397d==_0x47b482(0x159))var _0x4c4175=[_0x3e2e4f['body'][_0x47b482(0x143)]],_0x728064=[_0x3e2e4f['body'][_0x47b482(0x193)]],_0x337de0=[_0x3e2e4f['body'][_0x47b482(0x106)]],_0x2b8999=[_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x1ca)]],_0xd56f61=[_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x101)]],_0x25dbae=[_0x3e2e4f[_0x47b482(0x138)]['prod_level']],_0x31d5c6=[_0x3e2e4f['body'][_0x47b482(0x112)]],_0x4f9671=[_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x172)]],_0x2c7a13=[_0x3e2e4f['body']['MaxStocks_data']],_0x5d6ea6=[_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x185)]],_0x57356c=[_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x1c6)]];else var _0x4c4175=[..._0x3e2e4f['body'][_0x47b482(0x143)]],_0x728064=[..._0x3e2e4f['body']['prod_code']],_0x337de0=[..._0x3e2e4f['body'][_0x47b482(0x106)]],_0x2b8999=[..._0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x1ca)]],_0xd56f61=[..._0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x101)]],_0x25dbae=[..._0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x1a4)]],_0x31d5c6=[..._0x3e2e4f[_0x47b482(0x138)]['primary_code']],_0x4f9671=[..._0x3e2e4f[_0x47b482(0x138)]['secondary_code']],_0x2c7a13=[..._0x3e2e4f['body'][_0x47b482(0xfd)]],_0x5d6ea6=[..._0x3e2e4f['body'][_0x47b482(0x185)]],_0x57356c=[..._0x3e2e4f[_0x47b482(0x138)]['expiry_date']];const _0x1f2d02=_0x4c4175[_0x47b482(0x168)](_0x49e11a=>{return _0x49e11a={'product_name':_0x49e11a};});_0x728064['forEach']((_0x1f032b,_0x13d7e0)=>{var _0x485fe8=_0x47b482;_0x1f2d02[_0x13d7e0][_0x485fe8(0x1a2)]=_0x1f032b;}),_0x337de0['forEach']((_0x36662a,_0x28b46b)=>{var _0x2d8944=_0x47b482;_0x1f2d02[_0x28b46b][_0x2d8944(0x133)]=_0x36662a;}),_0x2b8999[_0x47b482(0x110)]((_0x48c356,_0x311c7d)=>{var _0xe6cdec=_0x47b482;_0x1f2d02[_0x311c7d][_0xe6cdec(0x12c)]=_0x48c356;}),_0xd56f61[_0x47b482(0x110)]((_0x52f936,_0x31ad88)=>{var _0x407785=_0x47b482;_0x1f2d02[_0x31ad88][_0x407785(0xf5)]=_0x52f936;}),_0x25dbae[_0x47b482(0x110)]((_0x23b850,_0x279f3d)=>{var _0x5dcce5=_0x47b482;_0x1f2d02[_0x279f3d][_0x5dcce5(0x187)]=_0x23b850;}),_0x31d5c6[_0x47b482(0x110)]((_0xc969d0,_0x12be59)=>{var _0x4559d7=_0x47b482;_0x1f2d02[_0x12be59][_0x4559d7(0x112)]=_0xc969d0;}),_0x4f9671['forEach']((_0x7fe095,_0x49a774)=>{var _0x567be8=_0x47b482;_0x1f2d02[_0x49a774][_0x567be8(0x172)]=_0x7fe095;}),_0x2c7a13['forEach']((_0x1e77a6,_0x3de7ae)=>{var _0x444e87=_0x47b482;_0x1f2d02[_0x3de7ae][_0x444e87(0x108)]=_0x1e77a6;}),_0x5d6ea6['forEach']((_0x5ee6f7,_0x3c86af)=>{var _0x400a4b=_0x47b482;_0x1f2d02[_0x3c86af][_0x400a4b(0x185)]=_0x5ee6f7;}),_0x57356c[_0x47b482(0x110)]((_0x48acef,_0x4190f1)=>{var _0xc8318=_0x47b482;_0x1f2d02[_0x4190f1][_0xc8318(0x1c6)]=_0x48acef;});const _0x269826=_0x1f2d02[_0x47b482(0x1aa)](_0x1e612b=>_0x1e612b[_0x47b482(0x133)]!=='0'&&_0x1e612b[_0x47b482(0x133)]!=='');_0x1101af[_0x47b482(0x109)]=_0x2787f6,_0x1101af['suppliers']=_0xfc6ec6,_0x1101af[_0x47b482(0xe2)]=_0x3f6668,_0x1101af[_0x47b482(0x1cf)]=_0x3fa6b3,_0x1101af[_0x47b482(0x1ac)]=_0x269826,_0x1101af[_0x47b482(0x1cd)]=_0x418f1d,_0x1101af[_0x47b482(0x1fb)]=_0x9d40b6,_0x1101af[_0x47b482(0x1b6)]=_0x960caa,_0x1101af[_0x47b482(0x1e3)]=_0x5aa8b3,_0x1101af['POnumber']=_0x5c1a27,_0x1101af['JO_number']=_0x2ba671;const _0x42e15f=await _0x1101af[_0x47b482(0x1c8)](),_0x518bac=await warehouse['findOne']({'name':_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x1cf)],'room':_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x1c7)]});_0x1101af[_0x47b482(0x1ac)][_0x47b482(0x110)](_0x7f887a=>{var _0x366ce7=_0x47b482,_0x1ae4ff=0x0;const _0x592639=_0x518bac[_0x366ce7(0x151)]['map'](_0x40c6f5=>{var _0x5da468=_0x366ce7;_0x40c6f5[_0x5da468(0x13d)]==_0x7f887a[_0x5da468(0x13d)]&&_0x40c6f5[_0x5da468(0x187)]==_0x7f887a[_0x5da468(0x187)]&&(_0x40c6f5[_0x5da468(0x1bf)]=parseInt(_0x40c6f5[_0x5da468(0x1bf)])+parseInt(_0x7f887a[_0x5da468(0x133)]),_0x1ae4ff++);});_0x1ae4ff=='0'&&(_0x518bac[_0x366ce7(0x151)]=_0x518bac[_0x366ce7(0x151)][_0x366ce7(0xec)]({'product_name':_0x7f887a['product_name'],'product_stock':_0x7f887a[_0x366ce7(0x133)],'primary_code':_0x7f887a[_0x366ce7(0x112)],'secondary_code':_0x7f887a['secondary_code'],'product_code':_0x7f887a[_0x366ce7(0x1a2)],'bay':_0x7f887a['bay'],'maxProducts':_0x7f887a['maxStocks'],'unit':_0x7f887a[_0x366ce7(0x12c)],'secondary_unit':_0x7f887a[_0x366ce7(0xf5)],'expiry_date':_0x7f887a['expiry_date']}));}),await _0x518bac['save']();const _0x5d0fae=await s_payment_data[_0x47b482(0x1ba)]({'invoice':_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x109)]});if(_0x5d0fae===null){}else console[_0x47b482(0x1ef)](_0x47b482(0x16d),_0x5d0fae,_0x3e2e4f[_0x47b482(0x138)]['invoice']),_0x5d0fae[_0x47b482(0x16d)]=_0x3e2e4f[_0x47b482(0x138)][_0x47b482(0x16d)],await _0x5d0fae[_0x47b482(0x1c8)]();_0x3e2e4f['flash'](_0x47b482(0x1ab),'purchase\x20data\x20update\x20successfully'),_0x3e2db3[_0x47b482(0x18d)]('/all_purchases_finished/view');}catch(_0x5b753c){console[_0x47b482(0x1ef)](_0x5b753c);}}),router[a0_0x5804c6(0x13f)](a0_0x5804c6(0x1eb),auth,async(_0x114425,_0x68b1e5)=>{var _0x1d7b88=a0_0x5804c6;try{const _0x489ce7=_0x114425['params']['id'],{invoice:_0x3ee158,suppliers:_0x8c777c,payable:_0x1672fc,due_amount:_0xd1efd6}=_0x114425[_0x1d7b88(0x138)],_0x555c29=await purchases[_0x1d7b88(0x19b)](_0x489ce7);var _0x40510f=_0x1672fc-_0xd1efd6;_0x555c29['paid_amount']=parseFloat(_0x555c29[_0x1d7b88(0x1fb)])+parseFloat(_0xd1efd6),_0x555c29['due_amount']=_0x40510f;const _0x306d89=await _0x555c29['save']();console[_0x1d7b88(0x1ef)](_0x306d89);const _0x4645c1=await s_payment_data[_0x1d7b88(0x1ba)]({'invoice':_0x3ee158});_0x4645c1['amount']=_0x40510f,await _0x4645c1[_0x1d7b88(0x1c8)]();let _0x309828=new Date(),_0x4bba85=('0'+_0x309828['getDate']())['slice'](-0x2),_0xdd6d47=('0'+(_0x309828[_0x1d7b88(0x1cc)]()+0x1))[_0x1d7b88(0x173)](-0x2),_0x651fc9=_0x309828['getFullYear'](),_0x37f149=_0x651fc9+'-'+_0xdd6d47+'-'+_0x4bba85;const _0x20a710=new suppliers_payment({'invoice':_0x3ee158,'date':_0x651fc9+'-'+_0xdd6d47+'-'+_0x4bba85,'suppliers':_0x8c777c,'reason':_0x1d7b88(0x13c),'amount':_0xd1efd6}),_0x70c470=await _0x20a710['save']();_0x114425[_0x1d7b88(0x1e6)](_0x1d7b88(0x1ab),'payment\x20successfull'),_0x68b1e5[_0x1d7b88(0x18d)](_0x1d7b88(0xfc));}catch(_0x583fbe){console[_0x1d7b88(0x1ef)](_0x583fbe);}}),router[a0_0x5804c6(0x19e)]('/invoice/:id',auth,async(_0x42656f,_0x4dd607)=>{var _0xb4afae=a0_0x5804c6;try{const {username:_0x33144d,email:_0x4aadfd,role:_0x2e9060}=_0x42656f[_0xb4afae(0xd0)],_0x4ce2fa=_0x42656f[_0xb4afae(0xd0)],_0x35126f=await profile['findOne']({'email':_0x4ce2fa[_0xb4afae(0x113)]}),_0x596052=await master_shop['find']();console[_0xb4afae(0x1ef)](_0xb4afae(0xda),_0x596052);const _0x101eed=_0x42656f['params']['id'],_0x1a6bdf=await purchases[_0xb4afae(0x19b)](_0x101eed);console[_0xb4afae(0x1ef)](_0x1a6bdf);const _0x19fcbb=await suppliers['findOne']({'name':_0x1a6bdf[_0xb4afae(0x16d)]});console[_0xb4afae(0x1ef)](_0x19fcbb);if(_0x596052[0x0]['language']==_0xb4afae(0x189)){var _0x13c5f4=users['English'];console[_0xb4afae(0x1ef)](_0x13c5f4);}else{if(_0x596052[0x0][_0xb4afae(0xd5)]==_0xb4afae(0x1ae))var _0x13c5f4=users[_0xb4afae(0x1ae)];else{if(_0x596052[0x0]['language']==_0xb4afae(0x18b))var _0x13c5f4=users[_0xb4afae(0x18b)];else{if(_0x596052[0x0]['language']==_0xb4afae(0x114))var _0x13c5f4=users[_0xb4afae(0x114)];else{if(_0x596052[0x0][_0xb4afae(0xd5)]==_0xb4afae(0x1d5))var _0x13c5f4=users[_0xb4afae(0x1d5)];else{if(_0x596052[0x0]['language']==_0xb4afae(0x1f1))var _0x13c5f4=users[_0xb4afae(0x186)];else{if(_0x596052[0x0][_0xb4afae(0xd5)]==_0xb4afae(0x12f))var _0x13c5f4=users[_0xb4afae(0x12f)];else{if(_0x596052[0x0]['language']==_0xb4afae(0xcf))var _0x13c5f4=users['Arabic'];}}}}}}}_0x4dd607['render'](_0xb4afae(0x209),{'success':_0x42656f[_0xb4afae(0x1e6)](_0xb4afae(0x1ab)),'errors':_0x42656f['flash'](_0xb4afae(0x1d1)),'role':_0x4ce2fa,'profile':_0x35126f,'master_shop':_0x596052,'supplier':_0x19fcbb,'purchase':_0x1a6bdf,'language':_0x13c5f4});}catch(_0x28bfbb){console['log'](_0x28bfbb);}}),router[a0_0x5804c6(0x19e)](a0_0x5804c6(0x1e1),auth,async(_0x53c7ce,_0xabd1ba)=>{var _0x28bfa6=a0_0x5804c6;try{const {username:_0x5bf0be,email:_0x77954f,role:_0x2f76bb}=_0x53c7ce[_0x28bfa6(0xd0)],_0x32708a=_0x53c7ce[_0x28bfa6(0xd0)],_0x1c1bfc=await profile[_0x28bfa6(0x1ba)]({'email':_0x32708a['email']}),_0x590126=await master_shop[_0x28bfa6(0x1e4)]();console[_0x28bfa6(0x1ef)]('master',_0x590126);const _0x4582b2=_0x53c7ce[_0x28bfa6(0x202)]['id'];console[_0x28bfa6(0x1ef)](_0x4582b2);const _0x370933=await purchases_finished[_0x28bfa6(0x19b)](_0x4582b2);console['log'](_0x28bfa6(0x121),_0x370933);const _0x1546c0=await product[_0x28bfa6(0x1e4)]({}),_0x173d59=await warehouse[_0x28bfa6(0x119)]([{'$match':{'name':_0x370933[_0x28bfa6(0x1cf)],'room':_0x370933['room']}},{'$unwind':_0x28bfa6(0xdc)},{'$group':{'_id':_0x28bfa6(0x1b2),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x28bfa6(0x149)},'bay':{'$first':_0x28bfa6(0x182)},'bin':{'$first':_0x28bfa6(0xd7)},'type':{'$first':_0x28bfa6(0x1d4)},'floorlevel':{'$first':_0x28bfa6(0x1cb)},'primary_code':{'$first':_0x28bfa6(0x1e0)},'secondary_code':{'$first':_0x28bfa6(0xcd)},'product_code':{'$first':_0x28bfa6(0x150)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x28bfa6(0x13a)}}}]);console[_0x28bfa6(0x1ef)](_0x28bfa6(0x10d),_0x173d59);let _0x367d67;if(_0x32708a[_0x28bfa6(0x1c0)]==_0x28bfa6(0x1e5)){const _0x385c9b=await staff[_0x28bfa6(0x1ba)]({'email':_0x32708a[_0x28bfa6(0x113)]});_0x367d67=await warehouse[_0x28bfa6(0x1e4)]({'status':_0x28bfa6(0xdf),'name':_0x385c9b[_0x28bfa6(0x137)],'warehouse_category':_0x28bfa6(0x12d),'name':_0x28bfa6(0x174)});}else _0x367d67=await warehouse['aggregate']([{'$match':{'status':_0x28bfa6(0xdf),'warehouse_category':'Finished\x20Goods','name':_0x28bfa6(0x174)}},{'$group':{'_id':_0x28bfa6(0x115),'name':{'$first':'$name'}}}]);if(_0x590126[0x0]['language']==_0x28bfa6(0x189)){var _0x19cab2=users[_0x28bfa6(0x165)];console[_0x28bfa6(0x1ef)](_0x19cab2);}else{if(_0x590126[0x0][_0x28bfa6(0xd5)]==_0x28bfa6(0x1ae))var _0x19cab2=users[_0x28bfa6(0x1ae)];else{if(_0x590126[0x0][_0x28bfa6(0xd5)]==_0x28bfa6(0x18b))var _0x19cab2=users['German'];else{if(_0x590126[0x0][_0x28bfa6(0xd5)]==_0x28bfa6(0x114))var _0x19cab2=users['Spanish'];else{if(_0x590126[0x0][_0x28bfa6(0xd5)]==_0x28bfa6(0x1d5))var _0x19cab2=users[_0x28bfa6(0x1d5)];else{if(_0x590126[0x0][_0x28bfa6(0xd5)]==_0x28bfa6(0x1f1))var _0x19cab2=users[_0x28bfa6(0x186)];else{if(_0x590126[0x0][_0x28bfa6(0xd5)]=='Chinese')var _0x19cab2=users['Chinese'];else{if(_0x590126[0x0][_0x28bfa6(0xd5)]==_0x28bfa6(0xcf))var _0x19cab2=users[_0x28bfa6(0x17e)];}}}}}}}_0xabd1ba[_0x28bfa6(0x100)](_0x28bfa6(0x196),{'success':_0x53c7ce[_0x28bfa6(0x1e6)](_0x28bfa6(0x1ab)),'errors':_0x53c7ce[_0x28bfa6(0x1e6)](_0x28bfa6(0x1d1)),'role':_0x32708a,'profile':_0x1c1bfc,'user':_0x370933,'stock':_0x173d59,'master_shop':_0x590126,'product':_0x1546c0,'language':_0x19cab2,'warehouse':_0x367d67});}catch(_0x37749a){console['log'](_0x37749a);}}),router[a0_0x5804c6(0x13f)](a0_0x5804c6(0x1e1),auth,async(_0x2142cc,_0x2c505f)=>{var _0x1b2f0a=a0_0x5804c6;try{const {invoice:_0x34e428,date:_0x429de1,warehouse_name:_0x3d094d,Room_name:_0x4be6ca,product_name:_0x489e02,purchase_quantity:_0x4862d0,stocks:_0x3c9874,return_qty:_0xe5fffd,note:_0x46d0b1,level:_0x3922ed,isle:_0x5251bd,pallet:_0xcecb6c,to_warehouse_name:_0x15fe91,to_Room_name:_0xe4456d}=_0x2142cc[_0x1b2f0a(0x138)],_0x27e865=await purchases_finished['findOne']({'_id':_0x2142cc[_0x1b2f0a(0x202)]['id']}),_0xe5cca8=await warehouse[_0x1b2f0a(0x1ba)]({'name':_0x3d094d,'room':_0x4be6ca,'warehouse_category':'Finished\x20Goods'});if(typeof _0x489e02==_0x1b2f0a(0x159))var _0x2fb8d3=[_0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x13d)]],_0x533072=[_0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x15c)]],_0x307862=[_0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x127)]],_0x10ea1b=[_0x2142cc[_0x1b2f0a(0x138)]['return_qty']],_0x47b387=[_0x2142cc['body']['level']],_0x1a326c=[_0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x188)]],_0x2bb09f=[_0x2142cc[_0x1b2f0a(0x138)]['primary_code_hide']],_0x436cbb=[_0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0xce)]];else var _0x2fb8d3=[..._0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x13d)]],_0x533072=[..._0x2142cc[_0x1b2f0a(0x138)]['purchase_quantity']],_0x307862=[..._0x2142cc['body'][_0x1b2f0a(0x127)]],_0x10ea1b=[..._0x2142cc[_0x1b2f0a(0x138)]['return_qty']],_0x47b387=[..._0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x12e)]],_0x1a326c=[..._0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x188)]],_0x2bb09f=[..._0x2142cc['body'][_0x1b2f0a(0x184)]],_0x436cbb=[..._0x2142cc['body'][_0x1b2f0a(0xce)]];const _0x24e318=_0x2fb8d3[_0x1b2f0a(0x168)](_0x2a1c9b=>{return _0x2a1c9b={'product_name':_0x2a1c9b};});_0x533072[_0x1b2f0a(0x110)]((_0x563ffc,_0x2a5204)=>{var _0x1d40f4=_0x1b2f0a;_0x24e318[_0x2a5204][_0x1d40f4(0x15c)]=_0x563ffc;}),_0x307862[_0x1b2f0a(0x110)]((_0x101746,_0x14c16d)=>{var _0x419846=_0x1b2f0a;_0x24e318[_0x14c16d][_0x419846(0x1bb)]=_0x101746;}),_0x10ea1b[_0x1b2f0a(0x110)]((_0x391e89,_0x4fe76e)=>{_0x24e318[_0x4fe76e]['return_qty']=_0x391e89;}),_0x47b387[_0x1b2f0a(0x110)]((_0xf26352,_0x4b3764)=>{_0x24e318[_0x4b3764]['bay']=_0xf26352;}),_0x1a326c[_0x1b2f0a(0x110)]((_0x5c28ad,_0x140fea)=>{_0x24e318[_0x140fea]['product_code']=_0x5c28ad;}),_0x2bb09f[_0x1b2f0a(0x110)]((_0x43acd9,_0x2e9e71)=>{var _0x1c45fa=_0x1b2f0a;_0x24e318[_0x2e9e71][_0x1c45fa(0x112)]=_0x43acd9;}),_0x436cbb[_0x1b2f0a(0x110)]((_0x34d527,_0x40963f)=>{var _0x5f01ef=_0x1b2f0a;_0x24e318[_0x40963f][_0x5f01ef(0x172)]=_0x34d527;}),_0x24e318[_0x1b2f0a(0x110)](_0x87a09e=>{var _0x40bda2=_0x1b2f0a;console['log'](_0x87a09e);const _0x207660=_0xe5cca8[_0x40bda2(0x151)][_0x40bda2(0x168)](_0x538b77=>{var _0x1f137a=_0x40bda2;_0x538b77[_0x1f137a(0x13d)]==_0x87a09e[_0x1f137a(0x13d)]&&_0x538b77[_0x1f137a(0x187)]==_0x87a09e[_0x1f137a(0x187)]&&(console[_0x1f137a(0x1ef)](parseInt(_0x538b77['product_stock'])+_0x1f137a(0x1fa)+parseInt(_0x87a09e['return_qty'])),_0x538b77[_0x1f137a(0x1bf)]=parseInt(_0x538b77[_0x1f137a(0x1bf)])-parseInt(_0x87a09e[_0x1f137a(0x18f)]));});}),await _0xe5cca8[_0x1b2f0a(0x1c8)]();var _0x4b9b4f=0x0;_0x24e318['forEach'](_0x535c4a=>{var _0x5b92e8=_0x1b2f0a;(parseInt(_0x535c4a['purchase_quantity'])<parseInt(_0x535c4a[_0x5b92e8(0x18f)])||parseInt(_0x535c4a[_0x5b92e8(0x1bb)])<parseInt(_0x535c4a[_0x5b92e8(0x18f)]))&&_0x4b9b4f++;});if(_0x4b9b4f!=0x0)return _0x2142cc['flash'](_0x1b2f0a(0x1d1),_0x1b2f0a(0x1bc)),_0x2c505f[_0x1b2f0a(0x18d)](_0x1b2f0a(0x1d0));const _0x1095f0=new purchases_return_finished({'invoice':_0x34e428,'suppliers':_0x2142cc[_0x1b2f0a(0x138)]['suppliers'],'date':_0x429de1,'warehouse_name':_0x3d094d,'return_product':_0x24e318,'note':_0x46d0b1,'room':_0x4be6ca,'to_warehouse_name':_0x15fe91,'to_room':_0xe4456d}),_0x3bcdf2=await _0x1095f0[_0x1b2f0a(0x1c8)](),_0x5e2ee5=await purchases_return_finished[_0x1b2f0a(0x1ba)]({'invoice':_0x34e428}),_0x5eec9c=await warehouse[_0x1b2f0a(0x1ba)]({'name':_0x15fe91,'room':_0xe4456d,'warehouse_category':'Finished\x20Goods'});_0x5e2ee5[_0x1b2f0a(0x1a6)]['forEach'](_0x42378c=>{var _0xb9e5a=_0x1b2f0a,_0x5276e3=0x0;const _0x1dd0a6=_0x5eec9c[_0xb9e5a(0x151)]['map'](_0x763015=>{var _0x474d8f=_0xb9e5a;console[_0x474d8f(0x1ef)](_0x763015[_0x474d8f(0x13d)]+'=='+_0x42378c[_0x474d8f(0x13d)]+'&&'+_0x763015[_0x474d8f(0x187)]+'=='+_0x42378c[_0x474d8f(0x187)]),_0x763015[_0x474d8f(0x13d)]==_0x42378c[_0x474d8f(0x13d)]&&_0x763015[_0x474d8f(0x187)]==_0x42378c[_0x474d8f(0x187)]&&(_0x763015[_0x474d8f(0x1bf)]=parseInt(_0x763015[_0x474d8f(0x1bf)])-parseInt(_0x42378c[_0x474d8f(0x18f)]),_0x5276e3++);});_0x5276e3=='0'&&(_0x5eec9c[_0xb9e5a(0x151)]=_0x5eec9c['product_details']['concat']({'product_name':_0x42378c['product_name'],'product_stock':_0x42378c[_0xb9e5a(0x18f)],'primary_code':_0x42378c['primary_code'],'secondary_code':_0x42378c[_0xb9e5a(0x172)],'product_code':_0x42378c['product_code'],'bay':_0x42378c[_0xb9e5a(0x187)],'maxProducts':0xf423f}));}),await _0x5eec9c[_0x1b2f0a(0x1c8)]();const _0x205df8=await purchases_finished[_0x1b2f0a(0x1ba)]({'invoice':_0x34e428});_0x205df8[_0x1b2f0a(0x11c)]=_0x1b2f0a(0x1c5);const _0x364549=await _0x205df8['save'](),_0x403fbb=new s_payment_data({'invoice':_0x34e428,'suppliers':_0x2142cc[_0x1b2f0a(0x138)][_0x1b2f0a(0x16d)],'reason':'Purchase\x20Return'});await _0x403fbb['save']();const _0x1e193d=await master_shop[_0x1b2f0a(0x1e4)](),_0xd3ed89=await email_settings[_0x1b2f0a(0x1ba)](),_0x3d90db=await suppliers[_0x1b2f0a(0x1ba)]({'name':_0x2142cc[_0x1b2f0a(0x138)]['suppliers']});_0x1e193d[0x0][_0x1b2f0a(0x200)]==0x1?(right_currency=_0x1e193d[0x0][_0x1b2f0a(0x17d)],left_currency=''):(right_currency='',left_currency=_0x1e193d[0x0][_0x1b2f0a(0x17d)]);var _0x1759f5=_0x2fb8d3,_0x953687=_0x10ea1b,_0x439f02='',_0x3648c2;for(_0x3648c2 in _0x1759f5){_0x439f02+=_0x1b2f0a(0x1a3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1759f5[_0x3648c2]+_0x1b2f0a(0x10c)+_0x1b2f0a(0x129)+_0x953687[_0x3648c2]+_0x1b2f0a(0x10c)+_0x1b2f0a(0xf7);}let _0x5b9c3b=nodemailer[_0x1b2f0a(0x136)]({'service':'gmail','auth':{'user':_0xd3ed89[_0x1b2f0a(0x113)],'pass':_0xd3ed89[_0x1b2f0a(0x1d9)]}}),_0x21dedd={'from':_0xd3ed89[_0x1b2f0a(0x113)],'to':_0x3d90db['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x1b2f0a(0x1c2),'path':__dirname+_0x1b2f0a(0x1a0)+_0x1b2f0a(0x1e7)+_0x1e193d[0x0][_0x1b2f0a(0x14f)],'cid':'logo'}],'html':_0x1b2f0a(0x15a)+_0x1b2f0a(0x198)+_0x1b2f0a(0x144)+_0x1b2f0a(0x11e)+_0x1b2f0a(0x1af)+'<div>'+_0x1b2f0a(0x145)+_0x1b2f0a(0xd3)+_0x1b2f0a(0x11e)+_0x1b2f0a(0x194)+_0x1e193d[0x0]['site_title']+_0x1b2f0a(0xd8)+'</div>'+'</div>'+_0x1b2f0a(0x139)+_0x1b2f0a(0x11e)+_0x1b2f0a(0xee)+'\x20Order\x20Number\x20:\x20'+_0x34e428+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1b2f0a(0x1d6)+_0x429de1+'\x20'+_0x1b2f0a(0x155)+_0x1b2f0a(0xf0)+_0x1b2f0a(0xd3)+_0x1b2f0a(0x1b8)+_0x1b2f0a(0xea)+_0x1b2f0a(0x1a3)+_0x1b2f0a(0xe1)+_0x1b2f0a(0x15f)+_0x1b2f0a(0x135)+_0x1b2f0a(0xd4)+'</tr>'+_0x1b2f0a(0x12a)+_0x1b2f0a(0x1b1)+'\x20'+_0x439f02+'\x20'+_0x1b2f0a(0x1f4)+_0x1b2f0a(0x1ff)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x1b2f0a(0x206)+_0x1e193d[0x0][_0x1b2f0a(0x199)]+_0x1b2f0a(0xf0)+_0x1b2f0a(0xd3)+'</div>'+_0x1b2f0a(0x1bd)};_0x5b9c3b['sendMail'](_0x21dedd,function(_0xd0d8cc,_0x34b0a1){var _0x22bbfa=_0x1b2f0a;_0xd0d8cc?console[_0x22bbfa(0x1ef)](_0x22bbfa(0x11d)):console[_0x22bbfa(0x1ef)](_0x22bbfa(0x10a));}),_0x2142cc[_0x1b2f0a(0x1e6)](_0x1b2f0a(0x1ab),_0x1b2f0a(0x14b)),_0x2c505f[_0x1b2f0a(0x18d)]('/all_purchases_finished/view');}catch(_0x52cb94){_0x2c505f[_0x1b2f0a(0x1fe)](0xc8)[_0x1b2f0a(0x1be)]({'message':_0x52cb94[_0x1b2f0a(0x157)]});}}),router['get'](a0_0x5804c6(0xe4),auth,async(_0x3ddd6e,_0x20e236)=>{var _0x577ecf=a0_0x5804c6;try{const {username:_0xb95df1,email:_0x5445a4,role:_0x3efbe1}=_0x3ddd6e['user'],_0x30b500=_0x3ddd6e[_0x577ecf(0xd0)],_0x14128e=await profile[_0x577ecf(0x1ba)]({'email':_0x30b500[_0x577ecf(0x113)]}),_0x25c5c7=await master_shop[_0x577ecf(0x1e4)](),_0x1d852f=_0x3ddd6e['params']['id'],_0x23f504=await purchases_finished['findById'](_0x1d852f);if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0x189))var _0x39fcd5=users['English'];else{if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0x1ae))var _0x39fcd5=users[_0x577ecf(0x1ae)];else{if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0x18b))var _0x39fcd5=users[_0x577ecf(0x18b)];else{if(_0x25c5c7[0x0]['language']=='Spanish')var _0x39fcd5=users[_0x577ecf(0x114)];else{if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0x1d5))var _0x39fcd5=users['French'];else{if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0x1f1))var _0x39fcd5=users[_0x577ecf(0x186)];else{if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0x12f))var _0x39fcd5=users['Chinese'];else{if(_0x25c5c7[0x0][_0x577ecf(0xd5)]==_0x577ecf(0xcf))var _0x39fcd5=users[_0x577ecf(0x17e)];}}}}}}}_0x20e236[_0x577ecf(0x100)](_0x577ecf(0x1e2),{'success':_0x3ddd6e['flash'](_0x577ecf(0x1ab)),'errors':_0x3ddd6e[_0x577ecf(0x1e6)](_0x577ecf(0x1d1)),'role':_0x30b500,'profile':_0x14128e,'alldata':_0x23f504,'master_shop':_0x25c5c7,'language':_0x39fcd5}),console['log'](alldata);}catch(_0x59a946){console[_0x577ecf(0x1ef)](_0x59a946);}}),router['post'](a0_0x5804c6(0xdb),async(_0x336776,_0x4a94bc)=>{var _0x35a1bd=a0_0x5804c6;const {product_code:_0x205628}=_0x336776[_0x35a1bd(0x138)];var _0x47cb78;const _0x1cd66e=await product[_0x35a1bd(0x119)]([{'$match':{'primary_code':_0x205628}},{'$group':{'_id':_0x35a1bd(0x107),'name':{'$first':_0x35a1bd(0x115)},'category':{'$first':_0x35a1bd(0x128)},'brand':{'$first':_0x35a1bd(0xf3)},'unit':{'$first':_0x35a1bd(0x166)},'alertquantity':{'$first':_0x35a1bd(0x201)},'product_code':{'$first':_0x35a1bd(0x1f2)},'primary_code':{'$first':_0x35a1bd(0xe8)},'secondary_code':{'$first':_0x35a1bd(0x16b)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x35a1bd(0x180)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x35a1bd(0x18e)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x35a1bd(0x195)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x5e4b52=await product[_0x35a1bd(0x119)]([{'$match':{'secondary_code':_0x205628}},{'$group':{'_id':'$_id','name':{'$first':_0x35a1bd(0x115)},'category':{'$first':_0x35a1bd(0x128)},'brand':{'$first':_0x35a1bd(0xf3)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x35a1bd(0x201)},'product_code':{'$first':_0x35a1bd(0x1f2)},'primary_code':{'$first':_0x35a1bd(0xe8)},'secondary_code':{'$first':_0x35a1bd(0x16b)},'maxStocks':{'$first':_0x35a1bd(0x120)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x35a1bd(0x18e)},'gross_price':{'$first':_0x35a1bd(0x1b9)},'sales_category':{'$first':_0x35a1bd(0x195)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x1cd66e[_0x35a1bd(0x1b7)]>0x0)_0x47cb78=_0x1cd66e;else _0x5e4b52[_0x35a1bd(0x1b7)]>0x0&&(_0x47cb78=_0x5e4b52);_0x4a94bc[_0x35a1bd(0x1be)](_0x47cb78);}),router['post']('/CheckingWarehouse',async(_0x2a7801,_0x46fa5b)=>{var _0x4092c6=a0_0x5804c6;const {productCode:_0x248f57,bay:_0xcd70e8,warehouses:_0x5af554,room:_0x1d48fc}=_0x2a7801[_0x4092c6(0x138)];console[_0x4092c6(0x1ef)](_0x2a7801[_0x4092c6(0x138)]);try{const _0x211b9a=await warehouse['aggregate']([{'$match':{'name':_0x5af554,'room':_0x1d48fc}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0xcd70e8)}},{'$group':{'_id':_0x4092c6(0x1b2),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4092c6(0x149)},'bay':{'$first':_0x4092c6(0x182)},'maxProducts':{'$first':_0x4092c6(0x12b)}}}]);_0x46fa5b[_0x4092c6(0x1fe)](0xc8)[_0x4092c6(0x1be)](_0x211b9a);}catch(_0x45c4b2){_0x46fa5b[_0x4092c6(0x1fe)](0x194)[_0x4092c6(0x1be)]({'message':_0x45c4b2['message']});}}),router['post'](a0_0x5804c6(0x15d),async(_0x39a89f,_0x3f655f)=>{var _0x3007aa=a0_0x5804c6;const {product_code:_0x2b8c88}=_0x39a89f[_0x3007aa(0x138)];var _0x48168f;const _0x112b70=await product[_0x3007aa(0x119)]([{'$match':{'primary_code':_0x2b8c88,'type_products':_0x3007aa(0x1ef)}},{'$group':{'_id':_0x3007aa(0x107),'name':{'$first':_0x3007aa(0x115)},'category':{'$first':_0x3007aa(0x128)},'brand':{'$first':_0x3007aa(0xf3)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3007aa(0x1f2)},'primary_code':{'$first':_0x3007aa(0xe8)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3007aa(0x120)},'maxProdPerUnit':{'$first':_0x3007aa(0x180)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3007aa(0x18e)},'gross_price':{'$first':_0x3007aa(0x1b9)},'sales_category':{'$first':_0x3007aa(0x195)},'type_products':{'$first':_0x3007aa(0xf2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x112b70);const _0x45c9cb=await product[_0x3007aa(0x119)]([{'$match':{'secondary_code':_0x2b8c88,'type_products':'log'}},{'$group':{'_id':_0x3007aa(0x107),'name':{'$first':_0x3007aa(0x115)},'category':{'$first':_0x3007aa(0x128)},'brand':{'$first':_0x3007aa(0xf3)},'unit':{'$first':_0x3007aa(0x166)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3007aa(0x1f2)},'primary_code':{'$first':_0x3007aa(0xe8)},'secondary_code':{'$first':_0x3007aa(0x16b)},'maxStocks':{'$first':_0x3007aa(0x120)},'maxProdPerUnit':{'$first':_0x3007aa(0x180)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x3007aa(0x1b9)},'sales_category':{'$first':_0x3007aa(0x195)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x112b70[_0x3007aa(0x1b7)]>0x0)_0x48168f=_0x112b70;else _0x45c9cb['length']>0x0&&(_0x48168f=_0x45c9cb);_0x3f655f['json'](_0x48168f);}),module[a0_0x5804c6(0x118)]=router;