var a0_0x253042=a0_0x25d3;(function(_0x476b34,_0x5570c8){var _0x52008b=a0_0x25d3,_0x36bdc1=_0x476b34();while(!![]){try{var _0x35dca3=parseInt(_0x52008b(0x221))/0x1*(parseInt(_0x52008b(0x20d))/0x2)+parseInt(_0x52008b(0x199))/0x3+-parseInt(_0x52008b(0x249))/0x4*(parseInt(_0x52008b(0x22c))/0x5)+-parseInt(_0x52008b(0x1af))/0x6+-parseInt(_0x52008b(0x2c5))/0x7*(-parseInt(_0x52008b(0x1da))/0x8)+-parseInt(_0x52008b(0x219))/0x9*(-parseInt(_0x52008b(0x1cd))/0xa)+parseInt(_0x52008b(0x2a4))/0xb*(parseInt(_0x52008b(0x1cb))/0xc);if(_0x35dca3===_0x5570c8)break;else _0x36bdc1['push'](_0x36bdc1['shift']());}catch(_0x4f5f4e){_0x36bdc1['push'](_0x36bdc1['shift']());}}}(a0_0x3561,0xa6b64));const express=require(a0_0x253042(0x25a)),app=express(),router=express[a0_0x253042(0x295)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x253042(0x1ec)),auth=require(a0_0x253042(0x2c9)),nodemailer=require(a0_0x253042(0x224));var ejs=require('ejs');const path=require(a0_0x253042(0x23b)),users=require(a0_0x253042(0x2c7)),{isNull}=require(a0_0x253042(0x2cf));router['get'](a0_0x253042(0x1a5),auth,async(_0x1d79ff,_0x362a53)=>{var _0x592657=a0_0x253042;try{const {username:_0x5b9ac4,email:_0x1f2dcd,role:_0x452a8d}=_0x1d79ff[_0x592657(0x1e0)],_0x52f133=_0x1d79ff[_0x592657(0x1e0)],_0x4eca0c=await profile[_0x592657(0x2d0)]({'email':_0x52f133[_0x592657(0x25d)]}),_0x5cb2c2=await staff['findOne']({'email':_0x52f133[_0x592657(0x25d)]}),_0x4365b9=await master_shop[_0x592657(0x1ac)]();let _0x2a930e=await transfers_finished[_0x592657(0x228)]([{'$match':{'to_warehouse':_0x5cb2c2[_0x592657(0x20b)]}}]);if(_0x4365b9[0x0][_0x592657(0x26b)]==_0x592657(0x1d7))var _0x553a1b=users[_0x592657(0x1d2)];else{if(_0x4365b9[0x0][_0x592657(0x26b)]==_0x592657(0x282))var _0x553a1b=users['Hindi'];else{if(_0x4365b9[0x0][_0x592657(0x26b)]==_0x592657(0x297))var _0x553a1b=users[_0x592657(0x297)];else{if(_0x4365b9[0x0][_0x592657(0x26b)]==_0x592657(0x2bd))var _0x553a1b=users[_0x592657(0x2bd)];else{if(_0x4365b9[0x0]['language']==_0x592657(0x29a))var _0x553a1b=users[_0x592657(0x29a)];else{if(_0x4365b9[0x0][_0x592657(0x26b)]=='Portuguese\x20(BR)')var _0x553a1b=users[_0x592657(0x1b0)];else{if(_0x4365b9[0x0][_0x592657(0x26b)]==_0x592657(0x266))var _0x553a1b=users['Chinese'];else{if(_0x4365b9[0x0][_0x592657(0x26b)]=='Arabic\x20(ae)')var _0x553a1b=users[_0x592657(0x19c)];}}}}}}}_0x362a53[_0x592657(0x1ad)](_0x592657(0x257),{'success':_0x1d79ff['flash'](_0x592657(0x28e)),'errors':_0x1d79ff[_0x592657(0x1c7)](_0x592657(0x1bf)),'purchases':_0x2a930e,'role':_0x52f133,'profile':_0x4eca0c,'master_shop':_0x4365b9,'language':_0x553a1b,'staff_data':_0x5cb2c2});}catch(_0x193258){console['log'](_0x592657(0x23d),_0x193258),_0x362a53[_0x592657(0x1dd)](0xc8)[_0x592657(0x28c)]({'message':_0x193258[_0x592657(0x2b7)]});}}),router[a0_0x253042(0x240)](a0_0x253042(0x1be),auth,async(_0x523c51,_0xb40f1e)=>{var _0x274477=a0_0x253042;try{const {username:_0x1ad2eb,email:_0x3d9bd3,role:_0x283c63}=_0x523c51[_0x274477(0x1e0)],_0x4c8fc5=_0x523c51[_0x274477(0x1e0)],_0x2895ea=await profile[_0x274477(0x2d0)]({'email':_0x4c8fc5[_0x274477(0x25d)]}),_0x5d9966=await staff['findOne']({'email':_0x4c8fc5[_0x274477(0x25d)]}),_0x311594=await master_shop[_0x274477(0x1ac)]();let _0x229cda=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x5d9966[_0x274477(0x20b)],'to_recieved':'false'}}]);if(_0x311594[0x0][_0x274477(0x26b)]==_0x274477(0x1d7))var _0x2cea5e=users['English'];else{if(_0x311594[0x0]['language']==_0x274477(0x282))var _0x2cea5e=users['Hindi'];else{if(_0x311594[0x0][_0x274477(0x26b)]==_0x274477(0x297))var _0x2cea5e=users[_0x274477(0x297)];else{if(_0x311594[0x0]['language']=='Spanish')var _0x2cea5e=users[_0x274477(0x2bd)];else{if(_0x311594[0x0]['language']==_0x274477(0x29a))var _0x2cea5e=users[_0x274477(0x29a)];else{if(_0x311594[0x0][_0x274477(0x26b)]==_0x274477(0x2cc))var _0x2cea5e=users[_0x274477(0x1b0)];else{if(_0x311594[0x0][_0x274477(0x26b)]==_0x274477(0x266))var _0x2cea5e=users[_0x274477(0x266)];else{if(_0x311594[0x0][_0x274477(0x26b)]=='Arabic\x20(ae)')var _0x2cea5e=users[_0x274477(0x19c)];}}}}}}}_0xb40f1e[_0x274477(0x1ad)](_0x274477(0x1de),{'success':_0x523c51['flash'](_0x274477(0x28e)),'errors':_0x523c51[_0x274477(0x1c7)](_0x274477(0x1bf)),'purchases':_0x229cda,'role':_0x4c8fc5,'profile':_0x2895ea,'master_shop':_0x311594,'language':_0x2cea5e,'staff_data':_0x5d9966});}catch(_0x3e899a){console[_0x274477(0x2ce)](_0x274477(0x23d),_0x3e899a),_0xb40f1e[_0x274477(0x1dd)](0xc8)[_0x274477(0x28c)]({'message':_0x3e899a[_0x274477(0x2b7)]});}});function a0_0x25d3(_0xddd458,_0x742ebf){var _0x356157=a0_0x3561();return a0_0x25d3=function(_0x25d36b,_0x121063){_0x25d36b=_0x25d36b-0x18f;var _0x50f7b0=_0x356157[_0x25d36b];return _0x50f7b0;},a0_0x25d3(_0xddd458,_0x742ebf);}const createLog=async _0x13624d=>{var _0x14a3ec=a0_0x253042;const _0x57a418=new datalogs({'location':_0x13624d});return await _0x57a418['save'](),_0x57a418[_0x14a3ec(0x27c)];};router[a0_0x253042(0x2b1)](a0_0x253042(0x1be),auth,async(_0x21cf52,_0x2427e1)=>{var _0x30f1f3=a0_0x253042;try{const {invoice_trf_data:_0x3b9983,item_code:_0x5590de,SCRN:_0x1339d8,ReqBy:_0x2e21ba,type_of_products:_0x2e06e5,dateofreq:_0x326b2a,PO_number:_0x14997d,date:_0xb3813a,warehouse_name:_0x2ad820,typeservicesData:_0x427cfe,typevehicle:_0x5dcdc1,driver:_0x2a229b,plate:_0x2e53a9,van:_0x2b2c33,DRSI:_0x24f7c5,TSU:_0x314e79,TFU:_0x43932a,note:_0x26c840}=_0x21cf52[_0x30f1f3(0x283)],_0x3c0a8f=await transfers_finished[_0x30f1f3(0x26a)](_0x3b9983);if(typeof _0x5590de==_0x30f1f3(0x223))var _0x6b9bc2=[_0x21cf52[_0x30f1f3(0x283)]['product_name']],_0x4137bb=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x1e7)]],_0x2f4ee7=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x264)]],_0xa4e8fd=[_0x21cf52['body'][_0x30f1f3(0x2b6)]],_0x480977=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x23f)]],_0x358b3c=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x1f8)]],_0x5ca8de=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x24f)]],_0x25cf0e=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x1ca)]],_0x4a325b=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x2ba)]],_0x5bb4a4=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x24d)]],_0x3aa5b9=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x29d)]],_0x4eaa7f=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x198)]],_0x535ca4=[_0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x1ae)]];else var _0x6b9bc2=[..._0x21cf52['body'][_0x30f1f3(0x1e4)]],_0x4137bb=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x1e7)]],_0x2f4ee7=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x264)]],_0xa4e8fd=[..._0x21cf52['body'][_0x30f1f3(0x2b6)]],_0x480977=[..._0x21cf52['body'][_0x30f1f3(0x23f)]],_0x358b3c=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x1f8)]],_0x5ca8de=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x24f)]],_0x25cf0e=[..._0x21cf52['body'][_0x30f1f3(0x1ca)]],_0x4a325b=[..._0x21cf52[_0x30f1f3(0x283)]['batch_code']],_0x5bb4a4=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x24d)]],_0x3aa5b9=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x29d)]],_0x4eaa7f=[..._0x21cf52[_0x30f1f3(0x283)][_0x30f1f3(0x198)]],_0x535ca4=[..._0x21cf52['body'][_0x30f1f3(0x1ae)]];const _0x534836=_0x6b9bc2[_0x30f1f3(0x2a0)](_0x50c9ff=>{return _0x50c9ff={'product_name':_0x50c9ff};});_0x4137bb[_0x30f1f3(0x28d)]((_0x1de09a,_0x5943cb)=>{var _0x578181=_0x30f1f3;_0x534836[_0x5943cb][_0x578181(0x2bc)]=_0x1de09a;}),_0x2f4ee7[_0x30f1f3(0x28d)]((_0x4f963a,_0x47c124)=>{var _0x92421f=_0x30f1f3;_0x534836[_0x47c124][_0x92421f(0x2b4)]=Math[_0x92421f(0x2a3)](_0x4f963a);}),_0xa4e8fd['forEach']((_0x35ec50,_0x525a59)=>{var _0x370803=_0x30f1f3;_0x534836[_0x525a59][_0x370803(0x1fa)]=_0x35ec50;}),_0x480977[_0x30f1f3(0x28d)]((_0x549f80,_0x23c483)=>{var _0x2c6861=_0x30f1f3;_0x534836[_0x23c483][_0x2c6861(0x259)]=_0x549f80;}),_0x358b3c[_0x30f1f3(0x28d)]((_0x5a27f3,_0x32061c)=>{var _0x20a730=_0x30f1f3,_0x4de39f=_0x5a27f3['match'](/[A-Za-z]+/)[0x0],_0x3c47ff=parseInt(_0x5a27f3[_0x20a730(0x24e)](/\d+/)[0x0]);_0x534836[_0x32061c][_0x20a730(0x1d0)]=_0x4de39f,_0x534836[_0x32061c][_0x20a730(0x250)]=_0x3c47ff;}),_0x5ca8de[_0x30f1f3(0x28d)]((_0x512da7,_0x49b445)=>{var _0x241fd9=_0x30f1f3;_0x534836[_0x49b445][_0x241fd9(0x24f)]=_0x512da7;}),_0x25cf0e[_0x30f1f3(0x28d)]((_0x38acff,_0x3003ef)=>{var _0x433c5d=_0x30f1f3;_0x534836[_0x3003ef][_0x433c5d(0x1ca)]=_0x38acff;}),_0x4a325b['forEach']((_0x128bdf,_0x1765b6)=>{var _0x52b77d=_0x30f1f3;_0x534836[_0x1765b6][_0x52b77d(0x2ba)]=_0x128bdf;}),_0x5bb4a4[_0x30f1f3(0x28d)]((_0x535c58,_0x15458d)=>{_0x534836[_0x15458d]['expiry_date']=_0x535c58;}),_0x3aa5b9[_0x30f1f3(0x28d)]((_0x6117ed,_0x2f6fbf)=>{_0x534836[_0x2f6fbf]['production_date']=_0x6117ed;}),_0x4eaa7f[_0x30f1f3(0x28d)]((_0x6bd35,_0x21d26a)=>{var _0x2c5c75=_0x30f1f3;_0x534836[_0x21d26a][_0x2c5c75(0x1f2)]=_0x6bd35;}),_0x535ca4[_0x30f1f3(0x28d)]((_0x3691d2,_0x395cd7)=>{var _0x220d27=_0x30f1f3;_0x534836[_0x395cd7][_0x220d27(0x18f)]=_0x3691d2;});const _0x34f8d9=await createLog(_0x30f1f3(0x1a1));_0x535ca4['forEach']((_0x34a6db,_0x228cda)=>{var _0x3b9394=_0x30f1f3;_0x534836[_0x228cda][_0x3b9394(0x2b2)]='INC-'+_0x34f8d9[_0x3b9394(0x28a)]()['padStart'](0x8,'0');});const _0x5267ee=_0x534836[_0x30f1f3(0x2c3)](_0x3b9f47=>_0x3b9f47[_0x30f1f3(0x2b4)]!=='0'&&_0x3b9f47[_0x30f1f3(0x2b4)]!==''),_0xf621e6=new purchases_incoming({'invoice':_0x30f1f3(0x2b8)+_0x34f8d9['toString']()[_0x30f1f3(0x20a)](0x8,'0'),'date':_0xb3813a,'warehouse_name':_0x2ad820,'product':_0x5267ee,'note':_0x26c840,'POnumber':_0x14997d,'SCRN':_0x1339d8,'ReqBy':_0x2e21ba,'dateofreq':_0x326b2a,'typeservicesData':_0x427cfe,'van':_0x2b2c33,'typevehicle':_0x5dcdc1,'driver':_0x2a229b,'plate':_0x2e53a9,'DRSI':_0x24f7c5,'TSU':_0x314e79,'TFU':_0x43932a,'typeOfProducts':_0x2e06e5}),_0x494e81=await _0xf621e6[_0x30f1f3(0x1d3)](),_0x4eb37a=_0x494e81[_0x30f1f3(0x274)][_0x30f1f3(0x2a0)](async _0x43b624=>{var _0x28e1cd=_0x30f1f3,_0x30bccc=await warehouse[_0x28e1cd(0x2d0)]({'name':_0x2ad820,'room':_0x43b624[_0x28e1cd(0x18f)]});if(_0x43b624[_0x28e1cd(0x2b4)]>0x0){var _0x4089f2=0x0;const _0x5381f6=_0x30bccc['product_details'][_0x28e1cd(0x2a0)](_0x241022=>{var _0x5627a6=_0x28e1cd;_0x241022[_0x5627a6(0x1e4)]==_0x43b624[_0x5627a6(0x1e4)]&&_0x241022[_0x5627a6(0x250)]==_0x43b624[_0x5627a6(0x1e5)]&&_0x241022[_0x5627a6(0x24d)]==_0x43b624['expiry_date']&&_0x241022[_0x5627a6(0x29d)]==_0x43b624[_0x5627a6(0x29d)]&&_0x241022[_0x5627a6(0x2ba)]==_0x43b624[_0x5627a6(0x2ba)]&&_0x241022['invoice']==_0x43b624[_0x5627a6(0x2b2)]&&(typeof _0x43b624[_0x5627a6(0x1c4)]=='undefined'?(console[_0x5627a6(0x2ce)](_0x5627a6(0x21a),_0x241022['product_stock']+_0x5627a6(0x1a4)+_0x241022[_0x5627a6(0x207)]+_0x5627a6(0x2a8)+Math[_0x5627a6(0x2a3)](_0x241022['product_stock'])+Math[_0x5627a6(0x2a3)](_0x43b624[_0x5627a6(0x264)])),_0x241022[_0x5627a6(0x1b4)]=Math[_0x5627a6(0x2a3)](_0x241022[_0x5627a6(0x1b4)])+Math[_0x5627a6(0x2a3)](_0x43b624[_0x5627a6(0x2b4)])):(_0x241022[_0x5627a6(0x1b4)]=Math[_0x5627a6(0x2a3)](_0x241022[_0x5627a6(0x1b4)])+Math['abs'](_0x43b624[_0x5627a6(0x2b4)]),_0x4089f2++));});_0x4089f2=='0'&&(_0x30bccc[_0x28e1cd(0x27e)]=_0x30bccc[_0x28e1cd(0x27e)][_0x28e1cd(0x1fd)]({'product_name':_0x43b624['product_name'],'product_stock':_0x43b624[_0x28e1cd(0x2b4)],'bay':_0x43b624[_0x28e1cd(0x250)],'level':_0x43b624[_0x28e1cd(0x1d0)],'product_code':_0x43b624[_0x28e1cd(0x2bc)],'primary_code':_0x43b624[_0x28e1cd(0x24f)],'secondary_code':_0x43b624['secondary_code'],'expiry_date':_0x43b624['expiry_date'],'production_date':_0x43b624['production_date'],'maxProducts':_0x43b624[_0x28e1cd(0x193)],'batch_code':_0x43b624[_0x28e1cd(0x2ba)],'secondary_unit':_0x43b624[_0x28e1cd(0x259)],'unit':_0x43b624['standard_unit'],'maxProducts':_0x43b624[_0x28e1cd(0x193)],'maxPerUnit':_0x43b624[_0x28e1cd(0x190)],'invoice':_0x43b624[_0x28e1cd(0x2b2)]}));}return _0x30bccc;});Promise[_0x30f1f3(0x210)](_0x4eb37a)[_0x30f1f3(0x2c2)](async _0x5c2c76=>{var _0x5a66ab=_0x30f1f3;try{for(const _0x3c3a54 of _0x5c2c76){await warehouse['updateOne']({'_id':_0x3c3a54[_0x5a66ab(0x207)]},{'$addToSet':{'product_details':{'$each':_0x3c3a54[_0x5a66ab(0x27e)]}}});}_0x3c0a8f[_0x5a66ab(0x1c3)]=_0x5a66ab(0x1bb);const _0x2cd564=await _0x3c0a8f[_0x5a66ab(0x1d3)](),_0x29afcc=await master_shop[_0x5a66ab(0x1ac)](),_0x338b19=await email_settings[_0x5a66ab(0x2d0)](),_0x3c4ebe=await supervisor_settings[_0x5a66ab(0x1ac)]();var _0x503694=_0xf621e6[_0x5a66ab(0x274)],_0x147752='',_0x2648ce;for(_0x2648ce in _0x503694){var _0x5f1cec='FG';_0xf621e6[_0x5a66ab(0x278)]=='DRY\x20GOODS'&&(_0x5f1cec='DG'),_0x147752+=_0x5a66ab(0x246)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x503694[_0x2648ce][_0x5a66ab(0x1e4)]+_0x5a66ab(0x1a6)+_0x5a66ab(0x204)+_0x503694[_0x2648ce][_0x5a66ab(0x2bc)]+_0x5a66ab(0x1a6)+_0x5a66ab(0x204)+_0x503694[_0x2648ce][_0x5a66ab(0x264)]+'</td>'+_0x5a66ab(0x204)+_0x503694[_0x2648ce][_0x5a66ab(0x2b6)]+_0x5a66ab(0x1a6)+_0x5a66ab(0x204)+_0x503694[_0x2648ce][_0x5a66ab(0x259)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf621e6[_0x5a66ab(0x278)]+_0x5a66ab(0x1a6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x503694[_0x2648ce][_0x5a66ab(0x214)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f1cec+_0x503694[_0x2648ce][_0x5a66ab(0x1e5)]+_0x5a66ab(0x1a6)+'</tr>';}_0x21cf52[_0x5a66ab(0x1c7)](_0x5a66ab(0x28e),_0x5a66ab(0x2ac)),_0x2427e1[_0x5a66ab(0x233)](_0x5a66ab(0x1c2)+_0x494e81[_0x5a66ab(0x207)]);}catch(_0x40737d){console['error'](_0x40737d),_0x2427e1[_0x5a66ab(0x1dd)](0x1f4)['json']({'error':_0x5a66ab(0x1b8)});}})[_0x30f1f3(0x2c4)](_0x146ad2=>{var _0x337539=_0x30f1f3;console[_0x337539(0x1e8)](_0x146ad2),_0x2427e1['status'](0x1f4)[_0x337539(0x28c)]({'error':'An\x20error\x20occurred.'});});}catch(_0x305198){}}),router[a0_0x253042(0x2b1)]('/getTRF',auth,async(_0x4f49b0,_0x23fab2)=>{var _0x276f20=a0_0x253042;try{const {warehouse:_0x43e46e}=_0x4f49b0[_0x276f20(0x283)],_0x3ebb24=await transfers_finished[_0x276f20(0x1ac)]({'to_warehouse':_0x43e46e,'to_recieved':_0x276f20(0x298)});_0x23fab2[_0x276f20(0x28c)](_0x3ebb24);}catch(_0x449077){}}),router[a0_0x253042(0x2b1)](a0_0x253042(0x2a7),auth,async(_0x4cd8e1,_0x51fb0f)=>{var _0x2b8dbf=a0_0x253042;try{const {invoice:_0x5170e2}=_0x4cd8e1[_0x2b8dbf(0x283)],_0xbcc65=await transfers_finished[_0x2b8dbf(0x1ac)]({'_id':_0x5170e2,'to_recieved':_0x2b8dbf(0x298)});_0x51fb0f['json'](_0xbcc65);}catch(_0x31029b){}}),router[a0_0x253042(0x240)](a0_0x253042(0x21c),auth,async(_0x4f2122,_0x355e9e)=>{var _0x2d587c=a0_0x253042;try{const {username:_0x3e2c69,email:_0x7bbcc4,role:_0x460421}=_0x4f2122[_0x2d587c(0x1e0)],_0x4af599=_0x4f2122['user'],_0x2f07b0=await profile[_0x2d587c(0x2d0)]({'email':_0x4af599[_0x2d587c(0x25d)]}),_0xa914bc=await staff[_0x2d587c(0x2d0)]({'email':_0x4af599[_0x2d587c(0x25d)]});if(_0x4af599[_0x2d587c(0x1f7)]==_0x2d587c(0x1a2)){const _0x5018eb=await staff[_0x2d587c(0x2d0)]({'email':_0x4af599['email']});}const _0x1ae211=await master_shop[_0x2d587c(0x1ac)]();let _0x27a957;if(_0x4af599[_0x2d587c(0x1f7)]==_0x2d587c(0x1a2)){const _0x464926=await staff['findOne']({'email':_0x4af599[_0x2d587c(0x25d)]});_0x27a957=await purchases_finished[_0x2d587c(0x228)]([{'$match':{'warehouse_name':_0x464926[_0x2d587c(0x20b)],'typeOfProducts':_0x2d587c(0x277)}},{'$lookup':{'from':_0x2d587c(0x2c8),'localField':_0x2d587c(0x2c8),'foreignField':_0x2d587c(0x234),'as':_0x2d587c(0x1fc)}},{'$unwind':_0x2d587c(0x22a)},{'$unwind':'$product'},{'$group':{'_id':_0x2d587c(0x22e),'invoice':{'$first':_0x2d587c(0x20f)},'suppliers':{'$first':_0x2d587c(0x220)},'date':{'$first':_0x2d587c(0x26c)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2d587c(0x197)},'product':{'$push':_0x2d587c(0x2c0)},'note':{'$first':_0x2d587c(0x1c6)},'paid_amount':{'$first':_0x2d587c(0x1f1)},'due_amount':{'$first':_0x2d587c(0x196)},'return_data':{'$first':_0x2d587c(0x2a1)},'batch_code':{'$first':_0x2d587c(0x291)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2d587c(0x1d6)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2d587c(0x235)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x27a957=await purchases_finished[_0x2d587c(0x228)]([{'$match':{'typeOfProducts':_0x2d587c(0x277)}},{'$unwind':_0x2d587c(0x2c0)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2d587c(0x20f)},'suppliers':{'$first':_0x2d587c(0x220)},'date':{'$first':_0x2d587c(0x26c)},'warehouse_name':{'$first':_0x2d587c(0x280)},'room':{'$addToSet':_0x2d587c(0x218)},'product':{'$push':'$product'},'note':{'$first':_0x2d587c(0x1c6)},'paid_amount':{'$first':_0x2d587c(0x1f1)},'due_amount':{'$first':_0x2d587c(0x196)},'return_data':{'$first':_0x2d587c(0x2a1)},'batch_code':{'$first':_0x2d587c(0x291)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2d587c(0x22a)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2d587c(0x281)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2d587c(0x25b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1ae211[0x0][_0x2d587c(0x26b)]=='English\x20(US)')var _0x58ca2d=users[_0x2d587c(0x1d2)];else{if(_0x1ae211[0x0][_0x2d587c(0x26b)]==_0x2d587c(0x282))var _0x58ca2d=users[_0x2d587c(0x282)];else{if(_0x1ae211[0x0]['language']==_0x2d587c(0x297))var _0x58ca2d=users[_0x2d587c(0x297)];else{if(_0x1ae211[0x0][_0x2d587c(0x26b)]==_0x2d587c(0x2bd))var _0x58ca2d=users['Spanish'];else{if(_0x1ae211[0x0][_0x2d587c(0x26b)]=='French')var _0x58ca2d=users[_0x2d587c(0x29a)];else{if(_0x1ae211[0x0][_0x2d587c(0x26b)]==_0x2d587c(0x2cc))var _0x58ca2d=users[_0x2d587c(0x1b0)];else{if(_0x1ae211[0x0]['language']==_0x2d587c(0x266))var _0x58ca2d=users[_0x2d587c(0x266)];else{if(_0x1ae211[0x0]['language']==_0x2d587c(0x273))var _0x58ca2d=users[_0x2d587c(0x19c)];}}}}}}}_0x355e9e['render'](_0x2d587c(0x19f),{'success':_0x4f2122['flash'](_0x2d587c(0x28e)),'errors':_0x4f2122[_0x2d587c(0x1c7)]('errors'),'purchases':_0x27a957,'role':_0x4af599,'profile':_0x2f07b0,'master_shop':_0x1ae211,'language':_0x58ca2d});}catch(_0x18d7ad){console[_0x2d587c(0x2ce)]('table\x20page',_0x18d7ad),_0x355e9e[_0x2d587c(0x1dd)](0xc8)[_0x2d587c(0x28c)]({'message':_0x18d7ad['message']});}}),router[a0_0x253042(0x240)](a0_0x253042(0x26e),auth,async(_0x27d34c,_0x138b87)=>{var _0x35188a=a0_0x253042;try{const {username:_0x14ad07,email:_0x3ef723,role:_0x224c99}=_0x27d34c['user'],_0x400e8b=_0x27d34c[_0x35188a(0x1e0)],_0x1331b3=await profile[_0x35188a(0x2d0)]({'email':_0x400e8b[_0x35188a(0x25d)]}),_0x5a20a4=await staff[_0x35188a(0x2d0)]({'email':_0x400e8b[_0x35188a(0x25d)]});if(_0x400e8b['role']==_0x35188a(0x1a2)){const _0x444ec0=await staff[_0x35188a(0x2d0)]({'email':_0x400e8b[_0x35188a(0x25d)]});}const _0x543b05=await master_shop[_0x35188a(0x1ac)]();let _0x17df5c;if(_0x400e8b[_0x35188a(0x1f7)]=='staff'){const _0x163874=await staff['findOne']({'email':_0x400e8b[_0x35188a(0x25d)]});_0x17df5c=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x163874[_0x35188a(0x20b)]}},{'$lookup':{'from':_0x35188a(0x2c8),'localField':_0x35188a(0x2c8),'foreignField':_0x35188a(0x234),'as':_0x35188a(0x1fc)}},{'$unwind':_0x35188a(0x22a)},{'$unwind':_0x35188a(0x2c0)},{'$group':{'_id':'$_id','invoice':{'$first':_0x35188a(0x20f)},'suppliers':{'$first':_0x35188a(0x220)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x35188a(0x280)},'room':{'$first':'$room'},'product':{'$push':_0x35188a(0x2c0)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x35188a(0x1f1)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x35188a(0x2a1)},'batch_code':{'$first':_0x35188a(0x291)},'expiry_date':{'$first':_0x35188a(0x258)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x35188a(0x1b7)},'level':{'$addToSet':_0x35188a(0x1d6)},'isle':{'$addToSet':_0x35188a(0x281)},'type':{'$addToSet':_0x35188a(0x235)},'floorlevel':{'$addToSet':_0x35188a(0x25b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x17df5c=await purchases_finished[_0x35188a(0x228)]([{'$match':{'typeOfProducts':_0x35188a(0x2a9)}},{'$unwind':'$product'},{'$group':{'_id':_0x35188a(0x22e),'invoice':{'$first':_0x35188a(0x20f)},'suppliers':{'$first':_0x35188a(0x220)},'date':{'$first':_0x35188a(0x26c)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x35188a(0x218)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x35188a(0x1f1)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x35188a(0x2a1)},'batch_code':{'$first':_0x35188a(0x291)},'expiry_date':{'$first':_0x35188a(0x258)},'suppliers_docs':{'$first':_0x35188a(0x22a)},'total_product_quantity':{'$sum':_0x35188a(0x1b7)},'level':{'$addToSet':_0x35188a(0x1d6)},'isle':{'$addToSet':_0x35188a(0x281)},'type':{'$addToSet':_0x35188a(0x235)},'floorlevel':{'$addToSet':_0x35188a(0x25b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x543b05[0x0]['language']==_0x35188a(0x1d7))var _0x1f38ef=users[_0x35188a(0x1d2)];else{if(_0x543b05[0x0][_0x35188a(0x26b)]=='Hindi')var _0x1f38ef=users[_0x35188a(0x282)];else{if(_0x543b05[0x0][_0x35188a(0x26b)]==_0x35188a(0x297))var _0x1f38ef=users[_0x35188a(0x297)];else{if(_0x543b05[0x0]['language']==_0x35188a(0x2bd))var _0x1f38ef=users['Spanish'];else{if(_0x543b05[0x0][_0x35188a(0x26b)]=='French')var _0x1f38ef=users['French'];else{if(_0x543b05[0x0]['language']==_0x35188a(0x2cc))var _0x1f38ef=users[_0x35188a(0x1b0)];else{if(_0x543b05[0x0][_0x35188a(0x26b)]==_0x35188a(0x266))var _0x1f38ef=users['Chinese'];else{if(_0x543b05[0x0]['language']==_0x35188a(0x273))var _0x1f38ef=users[_0x35188a(0x19c)];}}}}}}}_0x138b87[_0x35188a(0x1ad)](_0x35188a(0x270),{'success':_0x27d34c[_0x35188a(0x1c7)](_0x35188a(0x28e)),'errors':_0x27d34c[_0x35188a(0x1c7)](_0x35188a(0x1bf)),'purchases':_0x17df5c,'role':_0x400e8b,'profile':_0x1331b3,'master_shop':_0x543b05,'language':_0x1f38ef});}catch(_0x56f527){console[_0x35188a(0x2ce)](_0x35188a(0x23d),_0x56f527),_0x138b87[_0x35188a(0x1dd)](0xc8)[_0x35188a(0x28c)]({'message':_0x56f527[_0x35188a(0x2b7)]});}});function BayBinSelected(_0x46d1cb,_0x503d30){var _0x4721d4=a0_0x253042,_0x22b57e=[],_0x1970e3=[];if(_0x46d1cb=='DRY\x20GOODS'){switch(_0x503d30){case _0x4721d4(0x1db):_0x22b57e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x22b57e=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1970e3=['DG'];}else{if(_0x46d1cb==_0x4721d4(0x1f4)){switch(_0x503d30){case _0x4721d4(0x1db):_0x22b57e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4721d4(0x25c):_0x22b57e=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1970e3=['FG'];}}return{'levels':_0x22b57e,'identify':_0x1970e3};}async function getRandom8DigitNumber(){var _0x570a56=a0_0x253042;const _0x3b007c=0x989680,_0x437eba=0x5f5e0ff,_0xb2911b=Math[_0x570a56(0x261)](Math[_0x570a56(0x289)]()*(_0x437eba-_0x3b007c+0x1))+_0x3b007c;var _0x3fb9b4;const _0x135cbd=await purchases_finished[_0x570a56(0x2d0)]({'invoice':_0x570a56(0x247)+_0xb2911b});return _0x135cbd&&_0x135cbd[_0x570a56(0x263)]>0x0?_0x3fb9b4='INCF-'+_0xb2911b:_0x3fb9b4='INCF-'+_0xb2911b,_0x3fb9b4;}function a0_0x3561(){var _0x2c69cb=['save','<h5>','product_cat','$product.bay','English\x20(US)','$product_details.primary_code','type_of_products_type','3978392BHzmvy','Rack\x201','due_amount','status','incoming_add','Finished\x20Goods','user','paid_amount','$product_details.storage','logo','product_name','to_bay','$product_details.product_code','item_code','error','</thead>','</head><body>','Return\x20Goods','../models/all_models','type_of_products','sales_category','<hr\x20class=\x22my-3\x22>','FGSEmail','$paid_amount','maxperunit','$gross_price','FROZEN\x20GOODS','\x20Order\x20Date\x20:\x20','$maxStocks','role','bin','Enabled','standard_unit','/CheckingWarehouse','suppliers_docs','concat','site_title','stock_quantity','True',',\x20bay:\x20','Distributing\x20','sendMail','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','JO_number','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','return_product','padStart','warehouse','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','34SSAIuw','$product_details','$invoice','all','$maxProdPerUnit','product_data','/invoice/:id','to_room_name','$product_details.bay','$product_details.product_name','getMonth','$product.room_name','14535yKtiwr','here2','$product_details.bin','/view','Paid\x20For\x20Purchase','Logo.png','/view/add_purchases_logs','$suppliers','11683YpnvPd','purchase\x20data\x20add\x20successfully','string','nodemailer','$unit','Room_name','<strong>\x20Regards\x20</strong>','aggregate','Asia/Manila','$suppliers_docs','/view/add_purchases/:id','25pcWini','currency','$_id','product_code_hide','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</tr>','redirect','name','$product.type','slice','Purchase\x20Return','prod_primunit','master','prod_cat','path','createTransport','table\x20page','Error\x20occurred\x20while\x20processing\x20product:','prod_secondunit','get','purchase_quantity','<h5\x20style=\x22text-align:\x20left;\x22>','prod_Qty','date','</div>','<tr>','INCF-','$category','724368SCVXpl','$product_details._id','$secondary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','expiry_date','match','primary_code','bay','product_date','<!DOCTYPE\x20html>','</table>','RoomAssign','stock_data','Email\x20sent\x20successfully','incoming_view','$expiry_date','secondary_unit','express','$product.floorlevel','Rack\x202','email','add_purchases_finished',',\x20room:\x20','/process/:id','floor','uuid','length','to_quantity','$brand','Chinese','numeric','warehouse_name','/barcode/:id','findById','language','$date','prod_qty','/view_log','prod_level','all_purchases_finished_logs','prod_unit','/barcode_scanner','Arabic\x20(ae)','product','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','own','to_warehouse','all_purchases_barcode','There\x27s\x20a\x20error\x20in\x20this\x20transaction','password','invoice_init','edit_purchases_finished_view','product_details','<html><head><title></title>','$warehouse_name','$product.bin','Hindi','body','\x20</h2>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','purchase\x20data\x20update\x20successfully','random','toString','return_purchase_finished','json','forEach','success','prod_name','params','$batch_code','<h2>\x20','<div>','$product_code','Router','primary_code_hide','German','false','$primary_code','French',',\x20bin:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','production_date','amount','Error\x20Occurs','map','$return_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','abs','55YPTJvP','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','sales_data_cateory','/getinvoicetrf','\x20<=>\x20','logs','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Transfer\x20Finalize\x20Successfully','/view/:id','port','updateOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','post','invoice','/upload/','quantity','/preview/:id','unit','message','INC-','/give_payment/:id','batch_code','</span>','product_code','Spanish','date_recieved','MaxStocks_data','$product','</body></html>','then','filter','catch','7VuUAlc','getFullYear','../public/language/languages.json','suppliers','../middleware/auth','product_id','add_purchases\x20error','Portuguese\x20(BR)','$name','log','util','findOne','en-CA','valueOf','/view/return_purchase/:id','$type_products','room_name','maxPerUnit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$alertquantity','maxProducts','Enclosed','getDate','$due_amount','$room','max_product_unit','2220165mmpJiH','gmail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic','/view/add_purchases','</tbody>','all_purchases_finished','</h5>','INC','staff','return_qty','\x20<>\x20','/incoming','</td>','LOG-INC-','gross_price','$product_details.rack','\x20units\x20to\x20warehouse:\x20','$secondary_unit','find','render','room','4272288hGktVS','Portuguese','isProcess','2-digit','user_id','product_stock','/all_purchases_finished/preview/','secondary_code_hide','$product.quantity','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','/all_purchases_finished/view','$sales_category','true','prod_code','$product_details.maxProducts','/incoming/add','errors','purchases_process','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/picking_list/pdf_puchases_fin_own_trf/','to_recieved','id_transaction','$product_details.product_stock','$note','flash','\x20Order\x20Number\x20:\x20','Purchase\x20Mail','secondary_code','314844GysQMt','currency_placement','4540ZiPSud','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','maxStocks','level','DRY\x20GOODS','English'];a0_0x3561=function(){return _0x2c69cb;};return a0_0x3561();}router['get'](a0_0x253042(0x19d),auth,async(_0x255e7b,_0x2b0775)=>{var _0x2d9aec=a0_0x253042;try{const {username:_0x2bf21a,email:_0x58b483,role:_0x4b885f}=_0x255e7b[_0x2d9aec(0x1e0)],_0x5e2020=_0x255e7b[_0x2d9aec(0x1e0)],_0x28d845=await profile[_0x2d9aec(0x2d0)]({'email':_0x5e2020[_0x2d9aec(0x25d)]}),_0x32f144=await master_shop[_0x2d9aec(0x1ac)](),_0x11063e=await staff[_0x2d9aec(0x2d0)]({'email':_0x5e2020[_0x2d9aec(0x25d)]}),_0x5a0d7b=await suppliers[_0x2d9aec(0x1ac)]({});let _0x137ed2;if(_0x5e2020['role']==_0x2d9aec(0x1a2)){const _0x52a867=await staff[_0x2d9aec(0x2d0)]({'email':_0x5e2020[_0x2d9aec(0x25d)]});_0x137ed2=await warehouse[_0x2d9aec(0x228)]([{'$match':{'status':'Enabled','name':_0x52a867[_0x2d9aec(0x20b)]}},{'$group':{'_id':_0x2d9aec(0x2cd),'name':{'$first':_0x2d9aec(0x2cd)}}}]);}else _0x137ed2=await warehouse[_0x2d9aec(0x228)]([{'$match':{'status':_0x2d9aec(0x1f9)}},{'$group':{'_id':_0x2d9aec(0x2cd),'name':{'$first':_0x2d9aec(0x2cd)}}}]);const _0x5a2165=await product[_0x2d9aec(0x1ac)]({}),_0xdc5fb1=await warehouse['find']({'status':_0x2d9aec(0x1f9)}),_0x552267=await purchases_finished[_0x2d9aec(0x1ac)]({}),_0x1b3ad7=_0x552267[_0x2d9aec(0x263)]+0x1,_0x1fee8a=_0x2d9aec(0x247)+_0x1b3ad7['toString']()[_0x2d9aec(0x20a)](0x5,'0');var _0x2eee3a=['Ambient','Enclosed'];if(_0x32f144[0x0][_0x2d9aec(0x26b)]==_0x2d9aec(0x1d7))var _0x7a93be=users[_0x2d9aec(0x1d2)];else{if(_0x32f144[0x0][_0x2d9aec(0x26b)]==_0x2d9aec(0x282))var _0x7a93be=users[_0x2d9aec(0x282)];else{if(_0x32f144[0x0]['language']=='German')var _0x7a93be=users[_0x2d9aec(0x297)];else{if(_0x32f144[0x0][_0x2d9aec(0x26b)]=='Spanish')var _0x7a93be=users[_0x2d9aec(0x2bd)];else{if(_0x32f144[0x0][_0x2d9aec(0x26b)]==_0x2d9aec(0x29a))var _0x7a93be=users[_0x2d9aec(0x29a)];else{if(_0x32f144[0x0][_0x2d9aec(0x26b)]=='Portuguese\x20(BR)')var _0x7a93be=users[_0x2d9aec(0x1b0)];else{if(_0x32f144[0x0][_0x2d9aec(0x26b)]==_0x2d9aec(0x266))var _0x7a93be=users['Chinese'];else{if(_0x32f144[0x0][_0x2d9aec(0x26b)]==_0x2d9aec(0x273))var _0x7a93be=users[_0x2d9aec(0x19c)];}}}}}}}const _0x5c264d=getRandom8DigitNumber(),_0x1e1586=new Date(),_0x566a5a={'year':_0x2d9aec(0x267),'month':_0x2d9aec(0x1b2),'day':_0x2d9aec(0x1b2),'timeZone':_0x2d9aec(0x229)},_0x37cf8f=_0x1e1586['toLocaleDateString'](_0x2d9aec(0x2d1),_0x566a5a);console[_0x2d9aec(0x2ce)](_0x37cf8f),_0x5c264d[_0x2d9aec(0x2c2)](_0x37be13=>{var _0x7606cd=_0x2d9aec;_0x2b0775[_0x7606cd(0x1ad)](_0x7606cd(0x25e),{'success':_0x255e7b['flash'](_0x7606cd(0x28e)),'errors':_0x255e7b[_0x7606cd(0x1c7)](_0x7606cd(0x1bf)),'role':_0x5e2020,'profile':_0x28d845,'suppliers':_0x5a0d7b,'warehouse':_0x137ed2,'product':_0x5a2165,'invoice':_0x37be13,'master_shop':_0x32f144,'language':_0x7a93be,'find_data':_0xdc5fb1,'rooms_data':_0x2eee3a,'formattedDate':_0x37cf8f});})[_0x2d9aec(0x2c4)](_0xfa04a1=>{var _0x1ac38d=_0x2d9aec;_0x255e7b[_0x1ac38d(0x1c7)]('errors',_0x1ac38d(0x27a)),_0x2b0775[_0x1ac38d(0x233)](_0x1ac38d(0x1b9));});}catch(_0x3de6ee){console[_0x2d9aec(0x2ce)](_0x3de6ee);}}),router['get'](a0_0x253042(0x21f),auth,async(_0x347cee,_0x456353)=>{var _0x351599=a0_0x253042;try{const {username:_0x7a4efc,email:_0x248cfb,role:_0x330198}=_0x347cee[_0x351599(0x1e0)],_0x43c37c=_0x347cee[_0x351599(0x1e0)],_0x45c29d=await profile['findOne']({'email':_0x43c37c[_0x351599(0x25d)]}),_0x1b2fe0=await master_shop[_0x351599(0x1ac)](),_0x3f243e=await staff[_0x351599(0x2d0)]({'email':_0x43c37c[_0x351599(0x25d)]}),_0xe50525=await suppliers[_0x351599(0x1ac)]({});let _0x34b5f5;if(_0x43c37c[_0x351599(0x1f7)]=='staff'){const _0x433983=await staff['findOne']({'email':_0x43c37c[_0x351599(0x25d)]});_0x34b5f5=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x433983[_0x351599(0x20b)]}},{'$group':{'_id':_0x351599(0x2cd),'name':{'$first':'$name'}}}]);}else _0x34b5f5=await warehouse[_0x351599(0x228)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x351599(0x2cd),'name':{'$first':_0x351599(0x2cd)}}}]);const _0x47d205=await product[_0x351599(0x1ac)]({}),_0x4075d7=await warehouse['find']({'status':'Enabled'}),_0x29c015=await purchases_finished[_0x351599(0x1ac)]({}),_0xcdf8e1=_0x29c015[_0x351599(0x263)]+0x1,_0x50a04b=_0x351599(0x247)+_0xcdf8e1[_0x351599(0x28a)]()['padStart'](0x5,'0');var _0x7c027b=[_0x351599(0x275),_0x351599(0x194)];if(_0x1b2fe0[0x0]['language']==_0x351599(0x1d7))var _0x3297f2=users[_0x351599(0x1d2)];else{if(_0x1b2fe0[0x0][_0x351599(0x26b)]==_0x351599(0x282))var _0x3297f2=users[_0x351599(0x282)];else{if(_0x1b2fe0[0x0][_0x351599(0x26b)]==_0x351599(0x297))var _0x3297f2=users[_0x351599(0x297)];else{if(_0x1b2fe0[0x0][_0x351599(0x26b)]==_0x351599(0x2bd))var _0x3297f2=users['Spanish'];else{if(_0x1b2fe0[0x0][_0x351599(0x26b)]==_0x351599(0x29a))var _0x3297f2=users[_0x351599(0x29a)];else{if(_0x1b2fe0[0x0][_0x351599(0x26b)]==_0x351599(0x2cc))var _0x3297f2=users[_0x351599(0x1b0)];else{if(_0x1b2fe0[0x0][_0x351599(0x26b)]==_0x351599(0x266))var _0x3297f2=users['Chinese'];else{if(_0x1b2fe0[0x0]['language']==_0x351599(0x273))var _0x3297f2=users[_0x351599(0x19c)];}}}}}}}const _0x2e92b8=getRandom8DigitNumber();_0x2e92b8[_0x351599(0x2c2)](_0x534647=>{var _0x1f1683=_0x351599;_0x456353['render']('add_purchases_finished_logs',{'success':_0x347cee[_0x1f1683(0x1c7)](_0x1f1683(0x28e)),'errors':_0x347cee[_0x1f1683(0x1c7)](_0x1f1683(0x1bf)),'role':_0x43c37c,'profile':_0x45c29d,'suppliers':_0xe50525,'warehouse':_0x34b5f5,'product':_0x47d205,'invoice':_0x534647,'master_shop':_0x1b2fe0,'language':_0x3297f2,'find_data':_0x4075d7,'rooms_data':_0x7c027b});})[_0x351599(0x2c4)](_0x198330=>{var _0x496375=_0x351599;_0x347cee['flash'](_0x496375(0x1bf),_0x496375(0x27a)),_0x456353['redirect'](_0x496375(0x1b9));});}catch(_0x148bfa){console['log'](_0x148bfa);}}),router[a0_0x253042(0x240)](a0_0x253042(0x22b),auth,async(_0x5bf0a1,_0x401e04)=>{var _0x3cc78d=a0_0x253042;try{const _0x127f79=_0x5bf0a1[_0x3cc78d(0x290)]['id'];console[_0x3cc78d(0x2ce)](_0x127f79);const _0x2046d9=await master_shop[_0x3cc78d(0x1ac)]();console[_0x3cc78d(0x2ce)](_0x3cc78d(0x239),_0x2046d9);const _0x140c88=await product[_0x3cc78d(0x2d0)]({'name':_0x127f79});console[_0x3cc78d(0x2ce)](_0x3cc78d(0x274),_0x140c88),_0x401e04[_0x3cc78d(0x1dd)](0xc8)[_0x3cc78d(0x28c)]({'product_data':_0x140c88,'master':_0x2046d9});}catch(_0x19e736){console[_0x3cc78d(0x2ce)](_0x3cc78d(0x2cb),_0x19e736);}}),router['post'](a0_0x253042(0x19d),auth,async(_0x30a41d,_0x3bef7b)=>{var _0x5a3377=a0_0x253042;try{const {invoice:_0x1a3a1f,date:_0x13fe2c,warehouse_name:_0x57630b,prod_name:_0x384b1b,note:_0x1a74f3,due_amount:_0xa426e,Room_name:_0x596472,PO_number:_0x40bb1b,SCRN:_0x5f4248,ReqBy:_0x12ab37,dateofreq:_0x17c96b,suppliers:_0x4cf977,typeservicesData:_0x425c9a,van:_0x319964,typevehicle:_0x4a617d,driver:_0x863ba7,plate:_0x44f08b,DRSI:_0x1292f6,TSU:_0xd0153f,TFU:_0x4cc7a2,JO_number:_0x4aead1,type_of_products:_0x32df46}=_0x30a41d[_0x5a3377(0x283)];if(typeof _0x384b1b==_0x5a3377(0x223))var _0x321870=[_0x30a41d['body'][_0x5a3377(0x28f)]],_0x49d3ec=[_0x30a41d[_0x5a3377(0x283)]['prod_code']],_0x9fbea7=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x243)]],_0x19e0b7=[_0x30a41d['body']['prod_primunit']],_0x2fda78=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x23f)]],_0x30841b=[_0x30a41d['body'][_0x5a3377(0x26f)]],_0x29ddb2=[_0x30a41d['body']['primary_code']],_0x1fa92e=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x1ca)]],_0x13c421=[_0x30a41d['body'][_0x5a3377(0x2bf)]],_0x375942=[_0x30a41d['body'][_0x5a3377(0x2ba)]],_0x3df27c=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x24d)]],_0xdd145=[_0x30a41d[_0x5a3377(0x283)]['product_date']],_0x511b77=[_0x30a41d[_0x5a3377(0x283)]['max_product_unit']],_0x426631=[_0x30a41d[_0x5a3377(0x283)]['prod_cat']],_0x4d14c2=[_0x30a41d['body'][_0x5a3377(0x254)]],_0x1996c1=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x1a8)]],_0x45c4ed=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x262)]],_0x3ca889=[_0x30a41d[_0x5a3377(0x283)]['sales_data_cateory']],_0x3dc0dc=[_0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x2ca)]];else var _0x321870=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x28f)]],_0x49d3ec=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x1bc)]],_0x9fbea7=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x243)]],_0x19e0b7=[..._0x30a41d['body']['prod_primunit']],_0x2fda78=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x23f)]],_0x30841b=[..._0x30a41d['body'][_0x5a3377(0x26f)]],_0x29ddb2=[..._0x30a41d[_0x5a3377(0x283)]['primary_code']],_0x1fa92e=[..._0x30a41d['body'][_0x5a3377(0x1ca)]],_0x13c421=[..._0x30a41d['body']['MaxStocks_data']],_0x375942=[..._0x30a41d[_0x5a3377(0x283)]['batch_code']],_0x3df27c=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x24d)]],_0xdd145=[..._0x30a41d[_0x5a3377(0x283)]['product_date']],_0x511b77=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x198)]],_0x426631=[..._0x30a41d[_0x5a3377(0x283)]['prod_cat']],_0x4d14c2=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x254)]],_0x1996c1=[..._0x30a41d['body']['gross_price']],_0x45c4ed=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x262)]],_0x3ca889=[..._0x30a41d['body'][_0x5a3377(0x2a6)]],_0x3dc0dc=[..._0x30a41d[_0x5a3377(0x283)][_0x5a3377(0x2ca)]];const _0x5016e7=_0x321870['map'](_0x18c2e4=>{return _0x18c2e4={'product_name':_0x18c2e4};});_0x3dc0dc[_0x5a3377(0x28d)]((_0x4e9491,_0x41319c)=>{var _0x4a0368=_0x5a3377;_0x5016e7[_0x41319c]['product_id']=_0x4e9491,_0x5016e7[_0x41319c][_0x4a0368(0x2be)]=_0x13fe2c;}),_0x3ca889[_0x5a3377(0x28d)]((_0xbe3b6a,_0x21f8a5)=>{var _0x11ad2f=_0x5a3377;_0x5016e7[_0x21f8a5][_0x11ad2f(0x1ee)]=_0xbe3b6a;}),_0x49d3ec[_0x5a3377(0x28d)]((_0x3a8501,_0x20e0d2)=>{var _0x2c841e=_0x5a3377;_0x5016e7[_0x20e0d2][_0x2c841e(0x2bc)]=_0x3a8501;}),_0x45c4ed[_0x5a3377(0x28d)]((_0x12573a,_0x440dd3)=>{_0x5016e7[_0x440dd3]['uuid']=_0x12573a;}),_0x9fbea7[_0x5a3377(0x28d)]((_0x5174ee,_0x55c5e7)=>{var _0x1cced7=_0x5a3377;_0x5016e7[_0x55c5e7][_0x1cced7(0x2b4)]=Math[_0x1cced7(0x2a3)](_0x5174ee);}),_0x19e0b7['forEach']((_0x14d0e5,_0x3e7dee)=>{var _0x4f718b=_0x5a3377;_0x5016e7[_0x3e7dee][_0x4f718b(0x1fa)]=_0x14d0e5;}),_0x2fda78['forEach']((_0x4b0ea1,_0x362404)=>{_0x5016e7[_0x362404]['secondary_unit']=_0x4b0ea1;}),_0x29ddb2[_0x5a3377(0x28d)]((_0x269bfd,_0x4bf22f)=>{var _0x355b72=_0x5a3377;_0x5016e7[_0x4bf22f][_0x355b72(0x24f)]=_0x269bfd;}),_0x1fa92e[_0x5a3377(0x28d)]((_0x4e8a0c,_0x28661e)=>{var _0x1b0fd8=_0x5a3377;_0x5016e7[_0x28661e][_0x1b0fd8(0x1ca)]=_0x4e8a0c;}),_0x13c421[_0x5a3377(0x28d)]((_0x14fac6,_0x29949e)=>{var _0x3b0252=_0x5a3377;_0x5016e7[_0x29949e][_0x3b0252(0x1cf)]=_0x14fac6;}),_0x375942[_0x5a3377(0x28d)]((_0x26c1a6,_0xc675af)=>{var _0x563c29=_0x5a3377;_0x5016e7[_0xc675af][_0x563c29(0x2ba)]=_0x26c1a6;}),_0x3df27c[_0x5a3377(0x28d)]((_0x5971ae,_0x11ed4d)=>{var _0x7e1f6a=_0x5a3377;_0x5016e7[_0x11ed4d][_0x7e1f6a(0x24d)]=_0x5971ae;}),_0xdd145[_0x5a3377(0x28d)]((_0x4352e9,_0x40e204)=>{_0x5016e7[_0x40e204]['production_date']=_0x4352e9;}),_0x511b77['forEach']((_0x31550e,_0x33f041)=>{_0x5016e7[_0x33f041]['maxperunit']=_0x31550e;}),_0x426631[_0x5a3377(0x28d)]((_0x4c0cd5,_0xaf415)=>{var _0x2be18b=_0x5a3377;_0x5016e7[_0xaf415][_0x2be18b(0x1d5)]=_0x4c0cd5;}),_0x4d14c2[_0x5a3377(0x28d)]((_0x37f529,_0x4594d6)=>{_0x5016e7[_0x4594d6]['room_name']=_0x37f529;}),_0x1996c1[_0x5a3377(0x28d)]((_0x2011f8,_0xda48ff)=>{var _0x664301=_0x5a3377;_0x5016e7[_0xda48ff][_0x664301(0x1a8)]=_0x2011f8;});const _0xf2b69f=new invoice_for_incoming();await _0xf2b69f[_0x5a3377(0x1d3)]();for(let _0x18b052=0x0;_0x18b052<=_0x4d14c2[_0x5a3377(0x263)]-0x1;_0x18b052++){_0x5016e7[_0x18b052][_0x5a3377(0x2b2)]=_0x5a3377(0x2b8)+_0xf2b69f[_0x5a3377(0x27c)]['toString']()['padStart'](0x8,'0');}const _0x15ee95=await warehouse_validation_setup[_0x5a3377(0x228)]([{'$match':{'warehouse_name':_0x57630b}}]);let _0x2a62d2=[];for(let _0xee4c1e=0x0;_0xee4c1e<=_0x5016e7[_0x5a3377(0x263)]-0x1;_0xee4c1e++){const _0x279e62=_0x5016e7[_0xee4c1e];for(let _0x2a3721=0x0;_0x2a3721<=_0x15ee95[_0x5a3377(0x263)]-0x1;_0x2a3721++){const _0x48546d=_0x15ee95[_0x2a3721];for(let _0x17163e=0x0;_0x17163e<=_0x48546d['product_data'][_0x5a3377(0x263)]-0x1;_0x17163e++){const _0x4313ff=_0x48546d[_0x5a3377(0x212)][_0x17163e];if(_0x4313ff[_0x5a3377(0x2bc)]===_0x279e62[_0x5a3377(0x2bc)]){let _0x32dcf0=_0x279e62[_0x5a3377(0x2b4)];const _0x5b330d=await warehouse[_0x5a3377(0x228)]([{'$match':{'name':_0x57630b,'room':_0x48546d[_0x5a3377(0x1ae)]}},{'$unwind':_0x5a3377(0x20e)},{'$match':{'level':_0x4313ff[_0x5a3377(0x250)],'bay':_0x4313ff[_0x5a3377(0x1f8)]}}]);if(_0x5b330d[_0x5a3377(0x263)]==0x0){for(let _0x1cec30=0x0;_0x1cec30<=_0x48546d[_0x5a3377(0x212)][_0x5a3377(0x263)]-0x1&&_0x32dcf0>0x0;_0x1cec30++){const _0x500ace=_0x48546d['product_data'][_0x1cec30];if(_0x279e62[_0x5a3377(0x2bc)]===_0x500ace[_0x5a3377(0x2bc)]){_0x2a62d2[_0x1cec30]={};const _0x522416=parseInt(_0x500ace['max']),_0x3e023c=0x0;let _0x545f29=_0x522416-_0x3e023c,_0x364af0=Math['min'](_0x32dcf0,_0x545f29);console[_0x5a3377(0x2ce)](_0x5a3377(0x202)+_0x364af0+_0x5a3377(0x1aa)+_0x48546d[_0x5a3377(0x268)]+_0x5a3377(0x25f)+_0x48546d[_0x5a3377(0x1ae)]+_0x5a3377(0x201)+_0x500ace[_0x5a3377(0x250)]+_0x5a3377(0x29b)+_0x500ace['bin']),_0x2a62d2[_0x1cec30][_0x5a3377(0x1e4)]=_0x279e62[_0x5a3377(0x1e4)],_0x2a62d2[_0x1cec30]['product_code']=_0x279e62[_0x5a3377(0x2bc)],_0x2a62d2[_0x1cec30][_0x5a3377(0x2ca)]=_0x279e62[_0x5a3377(0x2ca)],_0x2a62d2[_0x1cec30]['date_recieved']=_0x279e62['date_recieved'],_0x2a62d2[_0x1cec30][_0x5a3377(0x1ee)]=_0x279e62[_0x5a3377(0x1ee)],_0x2a62d2[_0x1cec30][_0x5a3377(0x262)]=_0x279e62[_0x5a3377(0x262)],_0x2a62d2[_0x1cec30][_0x5a3377(0x2b4)]=_0x364af0,_0x2a62d2[_0x1cec30][_0x5a3377(0x1fa)]=_0x279e62[_0x5a3377(0x1fa)],_0x2a62d2[_0x1cec30][_0x5a3377(0x259)]=_0x279e62[_0x5a3377(0x259)],_0x2a62d2[_0x1cec30][_0x5a3377(0x24f)]=_0x279e62[_0x5a3377(0x24f)],_0x2a62d2[_0x1cec30]['secondary_code']=_0x279e62['secondary_code'],_0x2a62d2[_0x1cec30][_0x5a3377(0x1cf)]=_0x279e62['maxStocks'],_0x2a62d2[_0x1cec30][_0x5a3377(0x2ba)]=_0x279e62[_0x5a3377(0x2ba)],_0x2a62d2[_0x1cec30]['expiry_date']=_0x279e62[_0x5a3377(0x24d)],_0x2a62d2[_0x1cec30][_0x5a3377(0x29d)]=_0x279e62[_0x5a3377(0x29d)],_0x2a62d2[_0x1cec30][_0x5a3377(0x1f2)]=_0x279e62[_0x5a3377(0x1f2)],_0x2a62d2[_0x1cec30][_0x5a3377(0x1d5)]=_0x279e62[_0x5a3377(0x1d5)],_0x2a62d2[_0x1cec30][_0x5a3377(0x2b2)]=_0x279e62[_0x5a3377(0x2b2)],_0x2a62d2[_0x1cec30][_0x5a3377(0x1a8)]=_0x279e62['gross_price'],_0x2a62d2[_0x1cec30][_0x5a3377(0x18f)]=_0x48546d['room'],_0x2a62d2[_0x1cec30][_0x5a3377(0x1d0)]=_0x500ace[_0x5a3377(0x250)],_0x2a62d2[_0x1cec30][_0x5a3377(0x250)]=_0x500ace[_0x5a3377(0x1f8)],_0x32dcf0-=_0x364af0;if(_0x32dcf0<=0x0)break;}}if(_0x32dcf0<=0x0)break;_0x32dcf0>0x0&&console['log']('There\x20is\x20'+_0x32dcf0+_0x5a3377(0x285));}}}}}const _0x534222=_0x2a62d2[_0x5a3377(0x2c3)]((_0x37064a,_0x556494)=>{if(_0x556494>0x0)return{'item':_0x37064a};}),_0xb19c53=_0x534222[_0x5a3377(0x2c3)](_0x5787a8=>_0x5787a8[_0x5a3377(0x2b4)]!=='0'&&_0x5787a8[_0x5a3377(0x2b4)]!==''),_0x25c0e8=new purchases_finished({'invoice':_0x5a3377(0x2b8)+_0xf2b69f[_0x5a3377(0x27c)][_0x5a3377(0x28a)]()[_0x5a3377(0x20a)](0x8,'0'),'suppliers':_0x4cf977,'date':_0x13fe2c,'warehouse_name':_0x57630b,'product':_0xb19c53,'note':_0x1a74f3,'due_amount':_0xa426e,'room':_0x596472,'POnumber':_0x40bb1b,'SCRN':_0x5f4248,'JO_number':_0x4aead1,'ReqBy':_0x12ab37,'dateofreq':_0x17c96b,'typeservicesData':_0x425c9a,'van':_0x319964,'typevehicle':_0x4a617d,'driver':_0x863ba7,'plate':_0x44f08b,'DRSI':_0x1292f6,'TSU':_0xd0153f,'TFU':_0x4cc7a2,'typeOfProducts':_0x32df46}),_0x3138a9=await _0x25c0e8['save'](),_0x36ff55=await purchases_finished[_0x5a3377(0x2d0)]({'_id':_0x3138a9[_0x5a3377(0x207)][_0x5a3377(0x2d2)]()});_0x30a41d[_0x5a3377(0x1c7)](_0x5a3377(0x28e),_0x5a3377(0x222)),_0x3bef7b[_0x5a3377(0x233)]('/all_purchases_finished/process/'+_0x36ff55[_0x5a3377(0x207)][_0x5a3377(0x2d2)]());}catch(_0x19939d){console[_0x5a3377(0x2ce)](_0x19939d);}}),router['get'](a0_0x253042(0x260),auth,async(_0x538703,_0x3058f7)=>{var _0x34692c=a0_0x253042;try{const {username:_0x22794e,email:_0x5ae669,role:_0x2891ed}=_0x538703[_0x34692c(0x1e0)],_0x4a1582=_0x538703['user'],_0x1da27a=_0x538703[_0x34692c(0x290)]['id'],_0x10a2db=await profile['findOne']({'email':_0x4a1582['email']}),_0x46dc63=await master_shop[_0x34692c(0x1ac)](),_0x1d44cd=await staff['findOne']({'email':_0x4a1582[_0x34692c(0x25d)]}),_0x5c75da=await suppliers[_0x34692c(0x1ac)]({});let _0x46f938;if(_0x4a1582[_0x34692c(0x1f7)]==_0x34692c(0x1a2)){const _0x5c3e0a=await staff[_0x34692c(0x2d0)]({'email':_0x4a1582[_0x34692c(0x25d)]});_0x46f938=await warehouse[_0x34692c(0x228)]([{'$match':{'status':'Enabled','name':_0x5c3e0a[_0x34692c(0x20b)]}},{'$group':{'_id':'$name','name':{'$first':_0x34692c(0x2cd)}}}]);}else _0x46f938=await warehouse[_0x34692c(0x228)]([{'$match':{'status':_0x34692c(0x1f9)}},{'$group':{'_id':_0x34692c(0x2cd),'name':{'$first':'$name'}}}]);const _0x1d0cf7=await purchases_finished[_0x34692c(0x26a)](_0x1da27a);if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x1d7))var _0x1f0971=users[_0x34692c(0x1d2)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x282))var _0x1f0971=users[_0x34692c(0x282)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x297))var _0x1f0971=users[_0x34692c(0x297)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x2bd))var _0x1f0971=users[_0x34692c(0x2bd)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]=='French')var _0x1f0971=users[_0x34692c(0x29a)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x2cc))var _0x1f0971=users[_0x34692c(0x1b0)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x266))var _0x1f0971=users[_0x34692c(0x266)];else{if(_0x46dc63[0x0][_0x34692c(0x26b)]==_0x34692c(0x273))var _0x1f0971=users[_0x34692c(0x19c)];}}}}}}}_0x3058f7['render'](_0x34692c(0x1c0),{'success':_0x538703[_0x34692c(0x1c7)]('success'),'errors':_0x538703[_0x34692c(0x1c7)](_0x34692c(0x1bf)),'role':_0x4a1582,'profile':_0x10a2db,'suppliers':_0x5c75da,'warehouse':_0x46f938,'master_shop':_0x46dc63,'language':_0x1f0971,'purchases_data':_0x1d0cf7});}catch(_0x2ed5f4){console[_0x34692c(0x2ce)](_0x2ed5f4);}});async function get_warehouse_data(_0x947e23,_0xa9ab28){var _0x25c61f=a0_0x253042;try{const _0xf54bd3=await warehouse_temporary[_0x25c61f(0x2d0)]({'name':_0x947e23,'room':_0xa9ab28});if(!_0xf54bd3){const _0x400d65=new warehouse_temporary({'name':_0x947e23,'address':_0x947e23,'status':_0x25c61f(0x1f9),'room':_0xa9ab28,'isStaging':'false'});return await _0x400d65['save'](),_0x400d65;}else return _0xf54bd3;}catch(_0x120d06){console['error'](_0x25c61f(0x1ce),_0x120d06);throw _0x120d06;}}router['post'](a0_0x253042(0x260),auth,async(_0x196edc,_0x178229)=>{var _0x5ab3ef=a0_0x253042;try{const _0x465744=_0x196edc['params']['id'],_0x47f3e3=await purchases_finished['findById'](_0x465744);let _0x11e19d=[];_0x47f3e3[_0x5ab3ef(0x274)][_0x5ab3ef(0x28d)]((_0x82a3ec,_0x210354)=>{var _0x32308d=_0x5ab3ef;_0x11e19d[_0x210354]={},_0x11e19d[_0x210354][_0x32308d(0x20b)]=_0x47f3e3[_0x32308d(0x268)],_0x11e19d[_0x210354]['product_id']=_0x82a3ec[_0x32308d(0x2ca)],_0x11e19d[_0x210354][_0x32308d(0x1e4)]=_0x82a3ec[_0x32308d(0x1e4)],_0x11e19d[_0x210354]['product_code']=_0x82a3ec[_0x32308d(0x2bc)],_0x11e19d[_0x210354][_0x32308d(0x2b4)]=_0x82a3ec[_0x32308d(0x2b4)],_0x11e19d[_0x210354]['standard_unit']=_0x82a3ec[_0x32308d(0x1fa)],_0x11e19d[_0x210354][_0x32308d(0x259)]=_0x82a3ec[_0x32308d(0x259)],_0x11e19d[_0x210354][_0x32308d(0x1d0)]=_0x82a3ec[_0x32308d(0x1d0)],_0x11e19d[_0x210354][_0x32308d(0x250)]=_0x82a3ec[_0x32308d(0x250)],_0x11e19d[_0x210354][_0x32308d(0x24f)]=_0x82a3ec[_0x32308d(0x24f)],_0x11e19d[_0x210354]['secondary_code']=_0x82a3ec[_0x32308d(0x1ca)],_0x11e19d[_0x210354]['maxStocks']=_0x82a3ec['maxStocks'],_0x11e19d[_0x210354][_0x32308d(0x2ba)]=_0x82a3ec[_0x32308d(0x2ba)],_0x11e19d[_0x210354][_0x32308d(0x24d)]=_0x82a3ec['expiry_date'],_0x11e19d[_0x210354][_0x32308d(0x29d)]=_0x82a3ec['production_date'],_0x11e19d[_0x210354]['maxperunit']=_0x82a3ec[_0x32308d(0x1f2)],_0x11e19d[_0x210354][_0x32308d(0x1d5)]=_0x82a3ec[_0x32308d(0x1d5)],_0x11e19d[_0x210354][_0x32308d(0x18f)]=_0x82a3ec[_0x32308d(0x18f)],_0x11e19d[_0x210354][_0x32308d(0x2b2)]=_0x82a3ec[_0x32308d(0x2b2)],_0x11e19d[_0x210354][_0x32308d(0x262)]=_0x82a3ec['uuid'],_0x11e19d[_0x210354]['gross_price']=_0x82a3ec[_0x32308d(0x1a8)],_0x11e19d[_0x210354][_0x32308d(0x1ee)]=_0x82a3ec[_0x32308d(0x1ee)],_0x11e19d[_0x210354][_0x32308d(0x2be)]=_0x82a3ec['date_recieved'],_0x11e19d[_0x210354]['purchases_id']=_0x82a3ec['_id'][_0x32308d(0x2d2)]();});for(let _0x4171e2=0x0;_0x4171e2<=_0x11e19d[_0x5ab3ef(0x263)]-0x1;_0x4171e2++){const _0x13b74e=_0x11e19d[_0x4171e2],_0x58b8cd=new warehouse_temporary(_0x13b74e);await _0x58b8cd[_0x5ab3ef(0x1d3)]();}_0x47f3e3[_0x5ab3ef(0x1b1)]=_0x5ab3ef(0x1bb),await _0x47f3e3[_0x5ab3ef(0x1d3)](),_0x196edc[_0x5ab3ef(0x1c7)]('success',_0x5ab3ef(0x20c)),_0x178229[_0x5ab3ef(0x233)]('/all_purchases_finished/process/'+_0x47f3e3[_0x5ab3ef(0x207)][_0x5ab3ef(0x2d2)]());}catch(_0x181dd4){}}),router[a0_0x253042(0x2b1)]('/view/add_purchases_logs',auth,async(_0x39dd31,_0x2ab401)=>{var _0x267cbe=a0_0x253042;try{const {invoice:_0x541ae2,date:_0x506fe8,warehouse_name:_0x517c55,prod_name:_0x57b2b4,note:_0x40902d,due_amount:_0x4f77f0,Room_name:_0x964461,PO_number:_0x44935,SCRN:_0x20491b,ReqBy:_0x109aad,dateofreq:_0x18092e,suppliers:_0x9eae57,typeservicesData:_0x35a4ea,van:_0xcd8ca0,typevehicle:_0x135acd,driver:_0x1c1b6b,plate:_0x5ea4dc,DRSI:_0x410b7f,TSU:_0x531181,TFU:_0x1960b1,JO_number:_0x1a64f8,type_of_products:_0x3d04c3}=_0x39dd31[_0x267cbe(0x283)];if(typeof _0x57b2b4=='string')var _0xd1a4a9=[_0x39dd31[_0x267cbe(0x283)]['prod_name']],_0x1a3ad1=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x1bc)]],_0x287bb5=[_0x39dd31['body'][_0x267cbe(0x243)]],_0x3d7e=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x238)]],_0x3687f2=[_0x39dd31[_0x267cbe(0x283)]['prod_secondunit']],_0x46f30f=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x26f)]],_0x39e4b2=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x24f)]],_0x486d5c=[_0x39dd31[_0x267cbe(0x283)]['secondary_code']],_0x1fb0df=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x2bf)]],_0x1e9282=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x2ba)]],_0x315ec4=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x24d)]],_0xba218b=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x251)]],_0x5ab200=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x198)]],_0x592ee9=[_0x39dd31['body']['prod_cat']],_0x1ffa92=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x254)]],_0x448cfb=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x1a8)]],_0x2a6449=[_0x39dd31['body'][_0x267cbe(0x262)]],_0x4d55df=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x2a6)]],_0x2ee1aa=[_0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x1d9)]];else var _0xd1a4a9=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x28f)]],_0x1a3ad1=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x1bc)]],_0x287bb5=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x243)]],_0x3d7e=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x238)]],_0x3687f2=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x23f)]],_0x46f30f=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x26f)]],_0x39e4b2=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x24f)]],_0x486d5c=[..._0x39dd31['body'][_0x267cbe(0x1ca)]],_0x1fb0df=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x2bf)]],_0x1e9282=[..._0x39dd31['body'][_0x267cbe(0x2ba)]],_0x315ec4=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x24d)]],_0xba218b=[..._0x39dd31['body'][_0x267cbe(0x251)]],_0x5ab200=[..._0x39dd31[_0x267cbe(0x283)]['max_product_unit']],_0x592ee9=[..._0x39dd31['body'][_0x267cbe(0x23a)]],_0x1ffa92=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x254)]],_0x448cfb=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x1a8)]],_0x2a6449=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x262)]],_0x4d55df=[..._0x39dd31[_0x267cbe(0x283)][_0x267cbe(0x2a6)]],_0x2ee1aa=[..._0x39dd31['body']['type_of_products_type']];const _0x45607f=_0xd1a4a9[_0x267cbe(0x2a0)](_0xe75eea=>{return _0xe75eea={'product_name':_0xe75eea};});_0x2ee1aa[_0x267cbe(0x28d)]((_0x2c8950,_0x2a5e94)=>{var _0x4ac32a=_0x267cbe;_0x45607f[_0x2a5e94][_0x4ac32a(0x1ed)]=_0x2c8950;}),_0x4d55df[_0x267cbe(0x28d)]((_0x4deb52,_0x5a3c25)=>{_0x45607f[_0x5a3c25]['sales_category']=_0x4deb52;}),_0x1a3ad1[_0x267cbe(0x28d)]((_0xe1886,_0x52ccd7)=>{_0x45607f[_0x52ccd7]['product_code']=_0xe1886;}),_0x2a6449[_0x267cbe(0x28d)]((_0x40f88c,_0x578337)=>{_0x45607f[_0x578337]['uuid']=_0x40f88c;}),_0x287bb5[_0x267cbe(0x28d)]((_0x57ce7a,_0x2941a8)=>{var _0x46be7e=_0x267cbe;_0x45607f[_0x2941a8][_0x46be7e(0x2b4)]=Math[_0x46be7e(0x2a3)](_0x57ce7a);}),_0x3d7e[_0x267cbe(0x28d)]((_0x49b549,_0x4bea9e)=>{_0x45607f[_0x4bea9e]['standard_unit']=_0x49b549;}),_0x3687f2[_0x267cbe(0x28d)]((_0x4fa690,_0x280136)=>{var _0x1c629d=_0x267cbe;_0x45607f[_0x280136][_0x1c629d(0x259)]=_0x4fa690;}),_0x46f30f[_0x267cbe(0x28d)]((_0x463cf0,_0x1d5719)=>{var _0x388145=_0x267cbe,_0x5f2ad9=_0x463cf0[_0x388145(0x24e)](/[A-Za-z]+/)[0x0],_0x1f299b=parseInt(_0x463cf0['match'](/\d+/)[0x0]);_0x45607f[_0x1d5719][_0x388145(0x1d0)]=_0x5f2ad9,_0x45607f[_0x1d5719][_0x388145(0x250)]=_0x1f299b;}),_0x39e4b2[_0x267cbe(0x28d)]((_0x4ac251,_0x146b25)=>{var _0x740ece=_0x267cbe;_0x45607f[_0x146b25][_0x740ece(0x24f)]=_0x4ac251;}),_0x486d5c[_0x267cbe(0x28d)]((_0x25c628,_0x2e941f)=>{_0x45607f[_0x2e941f]['secondary_code']=_0x25c628;}),_0x1fb0df[_0x267cbe(0x28d)]((_0x535bbb,_0x37351c)=>{_0x45607f[_0x37351c]['maxStocks']=_0x535bbb;}),_0x1e9282[_0x267cbe(0x28d)]((_0x1cf0ee,_0x212fc2)=>{_0x45607f[_0x212fc2]['batch_code']=_0x1cf0ee;}),_0x315ec4['forEach']((_0x30dae2,_0x18f3a4)=>{var _0x5d8d48=_0x267cbe;_0x45607f[_0x18f3a4][_0x5d8d48(0x24d)]=_0x30dae2;}),_0xba218b[_0x267cbe(0x28d)]((_0x2bff10,_0xf87913)=>{_0x45607f[_0xf87913]['production_date']=_0x2bff10;}),_0x5ab200['forEach']((_0x3af11a,_0x498468)=>{var _0x4c33d8=_0x267cbe;_0x45607f[_0x498468][_0x4c33d8(0x1f2)]=_0x3af11a;}),_0x592ee9[_0x267cbe(0x28d)]((_0x388864,_0x3587ee)=>{var _0x476ac9=_0x267cbe;_0x45607f[_0x3587ee][_0x476ac9(0x1d5)]=_0x388864;}),_0x1ffa92[_0x267cbe(0x28d)]((_0x1327de,_0x5269a4)=>{_0x45607f[_0x5269a4]['room_name']=_0x1327de;}),_0x448cfb[_0x267cbe(0x28d)]((_0x49029e,_0x31728f)=>{var _0x228c80=_0x267cbe;_0x45607f[_0x31728f][_0x228c80(0x1a8)]=_0x49029e;});const _0x28d1f1=new purchases_logs();await _0x28d1f1[_0x267cbe(0x1d3)]();for(let _0x3c5f62=0x0;_0x3c5f62<=_0x1ffa92[_0x267cbe(0x263)]-0x1;_0x3c5f62++){_0x45607f[_0x3c5f62][_0x267cbe(0x2b2)]=_0x267cbe(0x1a7)+_0x28d1f1[_0x267cbe(0x27c)][_0x267cbe(0x28a)]()[_0x267cbe(0x20a)](0x8,'0');}const _0x3ca33d=_0x45607f['filter'](_0x327292=>_0x327292['quantity']!=='0'&&_0x327292[_0x267cbe(0x2b4)]!==''),_0x3776ad=new purchases_finished({'invoice':_0x267cbe(0x1a7)+_0x28d1f1[_0x267cbe(0x27c)]['toString']()[_0x267cbe(0x20a)](0x8,'0'),'suppliers':_0x9eae57,'date':_0x506fe8,'warehouse_name':_0x517c55,'product':_0x3ca33d,'note':_0x40902d,'due_amount':_0x4f77f0,'room':_0x964461,'POnumber':_0x44935,'SCRN':_0x20491b,'JO_number':_0x1a64f8,'ReqBy':_0x109aad,'dateofreq':_0x18092e,'typeservicesData':_0x35a4ea,'van':_0xcd8ca0,'typevehicle':_0x135acd,'driver':_0x1c1b6b,'plate':_0x5ea4dc,'DRSI':_0x410b7f,'TSU':_0x531181,'TFU':_0x1960b1,'typeOfProducts':_0x3d04c3}),_0x39ba2d=await _0x3776ad['save'](),_0x2a662f=await purchases_finished[_0x267cbe(0x2d0)]({'_id':_0x39ba2d[_0x267cbe(0x207)]['valueOf']()}),_0x219dd9=_0x2a662f['product'][_0x267cbe(0x2a0)](async _0x4b522e=>{var _0x3644a0=_0x267cbe;try{var _0x2b4ebb=await warehouse['findOne']({'name':_0x517c55,'room':_0x4b522e['room_name']}),_0xae6f00=0x0;const _0x2b4a9f=_0x2b4ebb[_0x3644a0(0x27e)]['map'](_0x43fd2f=>{var _0x57f771=_0x3644a0;console[_0x57f771(0x2ce)](_0x43fd2f['product_name']+'=='+_0x4b522e[_0x57f771(0x1e4)]+'&&'+_0x43fd2f[_0x57f771(0x250)]+'=='+_0x4b522e[_0x57f771(0x250)]+'&&'+_0x43fd2f['expiry_date']+'=='+_0x4b522e['expiry_date']+'&&'+_0x43fd2f[_0x57f771(0x29d)]+'=='+_0x4b522e[_0x57f771(0x29d)]+'&&'+_0x43fd2f[_0x57f771(0x2ba)]+'=='+_0x4b522e[_0x57f771(0x2ba)]+'&&'+_0x43fd2f[_0x57f771(0x2b2)]+'=='+_0x2a662f[_0x57f771(0x2b2)]),_0x43fd2f[_0x57f771(0x1e4)]==_0x4b522e[_0x57f771(0x1e4)]&&_0x43fd2f['bay']==_0x4b522e['bay']&&_0x43fd2f[_0x57f771(0x1d0)]==_0x4b522e[_0x57f771(0x1d0)]&&_0x43fd2f['expiry_date']==_0x4b522e[_0x57f771(0x24d)]&&_0x43fd2f[_0x57f771(0x29d)]==_0x4b522e['production_date']&&_0x43fd2f[_0x57f771(0x2ba)]==_0x4b522e[_0x57f771(0x2ba)]&&_0x43fd2f[_0x57f771(0x2b2)]==_0x2a662f[_0x57f771(0x2b2)]&&(_0x43fd2f['product_stock']=Math['abs'](_0x43fd2f[_0x57f771(0x1b4)])+Math[_0x57f771(0x2a3)](_0x4b522e[_0x57f771(0x2b4)]),_0xae6f00++);});return _0xae6f00==0x0&&(_0x2b4ebb[_0x3644a0(0x27e)]=_0x2b4ebb[_0x3644a0(0x27e)]['concat']({'product_name':_0x4b522e[_0x3644a0(0x1e4)],'product_stock':Math[_0x3644a0(0x2a3)](_0x4b522e[_0x3644a0(0x2b4)]),'primary_code':_0x4b522e['primary_code'],'secondary_code':_0x4b522e[_0x3644a0(0x1ca)],'product_code':_0x4b522e[_0x3644a0(0x2bc)],'bay':_0x4b522e[_0x3644a0(0x250)],'level':_0x4b522e[_0x3644a0(0x1d0)],'maxProducts':_0x4b522e[_0x3644a0(0x1cf)],'unit':_0x4b522e[_0x3644a0(0x1fa)],'secondary_unit':_0x4b522e[_0x3644a0(0x259)],'expiry_date':_0x4b522e['expiry_date'],'production_date':_0x4b522e[_0x3644a0(0x29d)],'maxProducts':_0x4b522e[_0x3644a0(0x1cf)],'maxPerUnit':_0x4b522e[_0x3644a0(0x1f2)],'batch_code':_0x4b522e[_0x3644a0(0x2ba)],'product_cat':_0x4b522e[_0x3644a0(0x1d5)],'invoice':_0x4b522e['invoice'],'id_incoming':_0x4b522e['_id'],'uuid':_0x4b522e['uuid'],'gross_price':_0x4b522e[_0x3644a0(0x1a8)],'sales_category':_0x4b522e[_0x3644a0(0x1ee)],'type_products':_0x4b522e[_0x3644a0(0x1ed)]})),_0x2b4ebb;}catch(_0x27a578){return console[_0x3644a0(0x1e8)](_0x3644a0(0x23e),_0x27a578),null;}});Promise[_0x267cbe(0x210)](_0x219dd9)['then'](async _0xce422d=>{var _0x306bf5=_0x267cbe;try{for(const _0x53aee4 of _0xce422d){await warehouse[_0x306bf5(0x2af)]({'_id':_0x53aee4[_0x306bf5(0x207)]},{'$addToSet':{'product_details':{'$each':_0x53aee4[_0x306bf5(0x27e)]}}});}const _0x14a2ff=await master_shop['find'](),_0x507e7a=await email_settings[_0x306bf5(0x2d0)](),_0x154c03=await supervisor_settings['find']();var _0x360d68=_0x2a662f['product'],_0x5794ca='',_0x20138d;for(_0x20138d in _0x360d68){var _0x2e8d80='FG';_0x2a662f[_0x306bf5(0x268)]==_0x306bf5(0x1d1)&&(_0x2e8d80='DG'),_0x5794ca+=_0x306bf5(0x246)+_0x306bf5(0x204)+_0x360d68[_0x20138d][_0x306bf5(0x1e4)]+_0x306bf5(0x1a6)+_0x306bf5(0x204)+_0x360d68[_0x20138d][_0x306bf5(0x2bc)]+_0x306bf5(0x1a6)+_0x306bf5(0x204)+_0x360d68[_0x20138d][_0x306bf5(0x2b4)]+'</td>'+_0x306bf5(0x204)+_0x360d68[_0x20138d][_0x306bf5(0x1fa)]+_0x306bf5(0x1a6)+_0x306bf5(0x204)+_0x360d68[_0x20138d][_0x306bf5(0x259)]+_0x306bf5(0x1a6)+_0x306bf5(0x204)+_0x2a662f[_0x306bf5(0x268)]+_0x306bf5(0x1a6)+_0x306bf5(0x204)+_0x360d68[_0x20138d][_0x306bf5(0x18f)]+_0x306bf5(0x1a6)+_0x306bf5(0x204)+_0x2e8d80+_0x360d68[_0x20138d][_0x306bf5(0x250)]+_0x306bf5(0x1a6),_0x306bf5(0x232);}let _0x2cfc18=nodemailer['createTransport']({'host':_0x507e7a[_0x306bf5(0x286)],'port':Number(_0x507e7a[_0x306bf5(0x2ae)]),'secure':![],'auth':{'user':_0x507e7a['email'],'pass':_0x507e7a[_0x306bf5(0x27b)]}}),_0x29addb={'from':_0x507e7a[_0x306bf5(0x25d)],'to':_0x154c03[0x0][_0x306bf5(0x1f0)],'subject':_0x306bf5(0x1c9),'attachments':[{'filename':_0x306bf5(0x21e),'path':__dirname+'/../public'+_0x306bf5(0x2b3)+_0x14a2ff[0x0][_0x306bf5(0x2aa)],'cid':'logo'}],'html':_0x306bf5(0x252)+'<html><head><title></title>'+_0x306bf5(0x1ea)+'<div>'+_0x306bf5(0x191)+'<div>'+_0x306bf5(0x231)+_0x306bf5(0x245)+_0x306bf5(0x293)+_0x306bf5(0x292)+_0x14a2ff[0x0]['site_title']+_0x306bf5(0x284)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x306bf5(0x293)+_0x306bf5(0x242)+_0x306bf5(0x1c8)+_0x2a662f[_0x306bf5(0x2b2)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x306bf5(0x1f5)+_0x2a662f[_0x306bf5(0x244)]+'\x20'+'</span>'+_0x306bf5(0x1a0)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x306bf5(0x2a2)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x306bf5(0x29c)+_0x306bf5(0x208)+_0x306bf5(0x205)+_0x306bf5(0x1c1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x306bf5(0x287)+_0x306bf5(0x232)+_0x306bf5(0x1e9)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5794ca+'\x20'+_0x306bf5(0x19e)+_0x306bf5(0x253)+_0x306bf5(0x293)+_0x306bf5(0x227)+_0x306bf5(0x1d4)+_0x14a2ff[0x0][_0x306bf5(0x1fe)]+_0x306bf5(0x1a0)+_0x306bf5(0x245)+_0x306bf5(0x245)+_0x306bf5(0x2c1)};_0x2cfc18[_0x306bf5(0x203)](_0x29addb,function(_0x1d9e7a,_0x4ca494){var _0xf559a6=_0x306bf5;_0x1d9e7a?(console[_0xf559a6(0x2ce)](_0x1d9e7a),console[_0xf559a6(0x2ce)](_0xf559a6(0x29f))):console[_0xf559a6(0x2ce)](_0xf559a6(0x256));});}catch(_0x31f4da){console[_0x306bf5(0x1e8)](_0x31f4da),_0x2ab401[_0x306bf5(0x1dd)](0x1f4)[_0x306bf5(0x28c)]({'error':_0x306bf5(0x24c),'message':_0x31f4da[_0x306bf5(0x2b7)]});}})[_0x267cbe(0x2c4)](_0x22c779=>{var _0x193d91=_0x267cbe;console[_0x193d91(0x1e8)](_0x22c779);}),_0x39dd31['flash'](_0x267cbe(0x28e),_0x267cbe(0x222)),_0x2ab401['redirect'](_0x267cbe(0x1b5)+_0x2a662f[_0x267cbe(0x207)][_0x267cbe(0x2d2)]());}catch(_0x190fee){console['log'](_0x190fee);}}),router[a0_0x253042(0x240)](a0_0x253042(0x2b5),auth,async(_0x52d728,_0x4d099f)=>{var _0x3e178f=a0_0x253042;try{const {username:_0x2b34e4,email:_0x49fa47,role:_0x5b49b1}=_0x52d728[_0x3e178f(0x1e0)],_0x4e783a=_0x52d728[_0x3e178f(0x1e0)],_0x3c95ea=await profile[_0x3e178f(0x2d0)]({'email':_0x4e783a['email']}),_0x1232df=await master_shop[_0x3e178f(0x1ac)](),_0x1ba300=_0x52d728[_0x3e178f(0x290)]['id'],_0xa26ac5=await purchases_finished[_0x3e178f(0x26a)](_0x1ba300),_0x11c0f5=await suppliers[_0x3e178f(0x1ac)]({});let _0x5b2b2b;if(_0x4e783a['role']=='staff'){const _0x30f9e9=await staff['findOne']({'email':_0x4e783a['email']});_0x5b2b2b=await warehouse['find']({'status':'Enabled','name':_0x30f9e9[_0x3e178f(0x20b)],'warehouse_category':_0x3e178f(0x1df)});}else _0x5b2b2b=await warehouse[_0x3e178f(0x228)]([{'$match':{'status':'Enabled','warehouse_category':_0x3e178f(0x1df)}},{'$group':{'_id':'$name','name':{'$first':_0x3e178f(0x2cd)}}}]);const _0x2dea1f=await product['find']({}),_0x31104e=BayBinSelected(_0xa26ac5[_0x3e178f(0x268)],_0xa26ac5[_0x3e178f(0x1ae)]);let _0x271886=new Date(_0xa26ac5['expiry_date']),_0x3d07d7=('0'+_0x271886['getDate']())[_0x3e178f(0x236)](-0x2),_0x187744=('0'+(_0x271886[_0x3e178f(0x217)]()+0x1))[_0x3e178f(0x236)](-0x2),_0x38700c=_0x271886['getFullYear'](),_0x34c74e=_0x38700c+'-'+_0x187744+'-'+_0x3d07d7;if(_0x1232df[0x0]['language']==_0x3e178f(0x1d7)){var _0x78841d=users[_0x3e178f(0x1d2)];console['log'](_0x78841d);}else{if(_0x1232df[0x0][_0x3e178f(0x26b)]==_0x3e178f(0x282))var _0x78841d=users[_0x3e178f(0x282)];else{if(_0x1232df[0x0][_0x3e178f(0x26b)]==_0x3e178f(0x297))var _0x78841d=users['German'];else{if(_0x1232df[0x0][_0x3e178f(0x26b)]==_0x3e178f(0x2bd))var _0x78841d=users[_0x3e178f(0x2bd)];else{if(_0x1232df[0x0][_0x3e178f(0x26b)]==_0x3e178f(0x29a))var _0x78841d=users[_0x3e178f(0x29a)];else{if(_0x1232df[0x0][_0x3e178f(0x26b)]==_0x3e178f(0x2cc))var _0x78841d=users[_0x3e178f(0x1b0)];else{if(_0x1232df[0x0]['language']==_0x3e178f(0x266))var _0x78841d=users[_0x3e178f(0x266)];else{if(_0x1232df[0x0][_0x3e178f(0x26b)]==_0x3e178f(0x273))var _0x78841d=users['Arabic'];}}}}}}}_0x4d099f[_0x3e178f(0x1ad)](_0x3e178f(0x27d),{'success':_0x52d728[_0x3e178f(0x1c7)](_0x3e178f(0x28e)),'errors':_0x52d728['flash']('errors'),'role':_0x4e783a,'profile':_0x3c95ea,'purchases':_0xa26ac5,'suppliers':_0x11c0f5,'warehouse':_0x5b2b2b,'product':_0x2dea1f,'master_shop':_0x1232df,'language':_0x78841d,'ed_fullDate':_0x34c74e,'dataSelected':_0x31104e});}catch(_0x329d3e){console[_0x3e178f(0x2ce)](_0x329d3e);}}),router[a0_0x253042(0x240)](a0_0x253042(0x2ad),auth,async(_0xf8232,_0xd4f18)=>{var _0x4d17a5=a0_0x253042;try{const {username:_0x108c9e,email:_0x4bd1c3,role:_0x1671bf}=_0xf8232[_0x4d17a5(0x1e0)],_0x1ad07b=_0xf8232['user'],_0x18db37=await profile[_0x4d17a5(0x2d0)]({'email':_0x1ad07b[_0x4d17a5(0x25d)]}),_0x384322=await master_shop[_0x4d17a5(0x1ac)](),_0x37289d=_0xf8232[_0x4d17a5(0x290)]['id'],_0x7c9a1e=await purchases_finished['findById'](_0x37289d),_0x71190d=await suppliers[_0x4d17a5(0x1ac)]({});let _0x2a417d;if(_0x1ad07b[_0x4d17a5(0x1f7)]==_0x4d17a5(0x1a2)){const _0xb9270c=await staff[_0x4d17a5(0x2d0)]({'email':_0x1ad07b[_0x4d17a5(0x25d)]});_0x2a417d=await warehouse[_0x4d17a5(0x1ac)]({'status':_0x4d17a5(0x1f9),'name':_0xb9270c['warehouse'],'warehouse_category':_0x4d17a5(0x1df)});}else _0x2a417d=await warehouse[_0x4d17a5(0x228)]([{'$match':{'status':'Enabled','warehouse_category':_0x4d17a5(0x1df)}},{'$group':{'_id':_0x4d17a5(0x2cd),'name':{'$first':_0x4d17a5(0x2cd)}}}]);const _0x142476=await product[_0x4d17a5(0x1ac)]({}),_0x19ab73=BayBinSelected(_0x7c9a1e[_0x4d17a5(0x268)],_0x7c9a1e[_0x4d17a5(0x1ae)]);let _0xc0ccf5=new Date(_0x7c9a1e[_0x4d17a5(0x24d)]),_0x25f1ec=('0'+_0xc0ccf5[_0x4d17a5(0x195)]())[_0x4d17a5(0x236)](-0x2),_0x3916fa=('0'+(_0xc0ccf5[_0x4d17a5(0x217)]()+0x1))[_0x4d17a5(0x236)](-0x2),_0x24c5ee=_0xc0ccf5[_0x4d17a5(0x2c6)](),_0x3abe8c=_0x24c5ee+'-'+_0x3916fa+'-'+_0x25f1ec;if(_0x384322[0x0][_0x4d17a5(0x26b)]==_0x4d17a5(0x1d7)){var _0x3e014f=users[_0x4d17a5(0x1d2)];console['log'](_0x3e014f);}else{if(_0x384322[0x0][_0x4d17a5(0x26b)]==_0x4d17a5(0x282))var _0x3e014f=users[_0x4d17a5(0x282)];else{if(_0x384322[0x0]['language']==_0x4d17a5(0x297))var _0x3e014f=users[_0x4d17a5(0x297)];else{if(_0x384322[0x0][_0x4d17a5(0x26b)]==_0x4d17a5(0x2bd))var _0x3e014f=users[_0x4d17a5(0x2bd)];else{if(_0x384322[0x0]['language']==_0x4d17a5(0x29a))var _0x3e014f=users['French'];else{if(_0x384322[0x0][_0x4d17a5(0x26b)]==_0x4d17a5(0x2cc))var _0x3e014f=users[_0x4d17a5(0x1b0)];else{if(_0x384322[0x0][_0x4d17a5(0x26b)]==_0x4d17a5(0x266))var _0x3e014f=users[_0x4d17a5(0x266)];else{if(_0x384322[0x0][_0x4d17a5(0x26b)]=='Arabic\x20(ae)')var _0x3e014f=users['Arabic'];}}}}}}}_0xd4f18['render']('edit_purchases_finished',{'success':_0xf8232['flash'](_0x4d17a5(0x28e)),'errors':_0xf8232[_0x4d17a5(0x1c7)]('errors'),'role':_0x1ad07b,'profile':_0x18db37,'purchases':_0x7c9a1e,'suppliers':_0x71190d,'warehouse':_0x2a417d,'product':_0x142476,'master_shop':_0x384322,'language':_0x3e014f,'ed_fullDate':_0x3abe8c,'dataSelected':_0x19ab73});}catch(_0x44e88a){console[_0x4d17a5(0x2ce)](_0x44e88a);}}),router[a0_0x253042(0x2b1)]('/view/:id',auth,async(_0x57ab03,_0x503c08)=>{var _0x212230=a0_0x253042;try{const _0x234074=_0x57ab03[_0x212230(0x290)]['id'],_0x2e3f94=await purchases_finished[_0x212230(0x2d0)]({'_id':_0x57ab03['params']['id']}),_0x32c738=await warehouse[_0x212230(0x2d0)]({'name':_0x2e3f94[_0x212230(0x268)],'room':_0x2e3f94['room']});_0x2e3f94['product']['forEach'](_0x31e337=>{var _0x4b3c84=_0x212230;const _0x537b83=_0x32c738[_0x4b3c84(0x27e)][_0x4b3c84(0x2a0)](_0xffebf8=>{var _0x4dd262=_0x4b3c84;_0xffebf8[_0x4dd262(0x1e4)]==_0x31e337['product_name']&&_0xffebf8[_0x4dd262(0x250)]==_0x31e337['bay']&&(_0xffebf8[_0x4dd262(0x1b4)]=parseInt(_0xffebf8['product_stock'])-parseInt(_0x31e337[_0x4dd262(0x2b4)]));});}),await _0x32c738[_0x212230(0x1d3)]();const {invoice:_0x5b740c,suppliers:_0x224a31,date:_0x55a3c1,warehouse_name:_0x57f119,prod_name:_0x543719,prod_code:_0xaedc36,prod_qty:_0x32482c,prod_unit:_0x28cbd1,prod_secondunit:_0x20ed37,prod_level:_0xc1925d,prod_isle:_0x597d04,prod_pallet:_0x510191,note:_0x11afac,expiry_date:_0x3cc34f,batch_code:_0x4893f2,paid_amount:_0xf86cb5,due_amount:_0x3b3292,Room_name:_0xea851b,primary_code:_0x2528b8,secondary_code:_0x3d1357,PO_number:_0x4ad9b0,JO_number:_0x43e960}=_0x57ab03[_0x212230(0x283)];if(typeof _0x543719==_0x212230(0x223))var _0x669373=[_0x57ab03[_0x212230(0x283)][_0x212230(0x28f)]],_0x51bf9c=[_0x57ab03[_0x212230(0x283)][_0x212230(0x1bc)]],_0x3ed1c2=[_0x57ab03['body'][_0x212230(0x26d)]],_0x19aaea=[_0x57ab03['body'][_0x212230(0x271)]],_0x511054=[_0x57ab03[_0x212230(0x283)]['prod_secondunit']],_0x5cac18=[_0x57ab03['body'][_0x212230(0x26f)]],_0x7a1e5=[_0x57ab03[_0x212230(0x283)][_0x212230(0x24f)]],_0x597140=[_0x57ab03['body'][_0x212230(0x1ca)]],_0x528ad2=[_0x57ab03[_0x212230(0x283)][_0x212230(0x2bf)]],_0x3afa0d=[_0x57ab03[_0x212230(0x283)][_0x212230(0x2ba)]],_0x177b4a=[_0x57ab03[_0x212230(0x283)][_0x212230(0x24d)]];else var _0x669373=[..._0x57ab03['body'][_0x212230(0x28f)]],_0x51bf9c=[..._0x57ab03[_0x212230(0x283)]['prod_code']],_0x3ed1c2=[..._0x57ab03['body'][_0x212230(0x26d)]],_0x19aaea=[..._0x57ab03[_0x212230(0x283)][_0x212230(0x271)]],_0x511054=[..._0x57ab03[_0x212230(0x283)][_0x212230(0x23f)]],_0x5cac18=[..._0x57ab03[_0x212230(0x283)]['prod_level']],_0x7a1e5=[..._0x57ab03['body'][_0x212230(0x24f)]],_0x597140=[..._0x57ab03[_0x212230(0x283)][_0x212230(0x1ca)]],_0x528ad2=[..._0x57ab03['body'][_0x212230(0x2bf)]],_0x3afa0d=[..._0x57ab03[_0x212230(0x283)][_0x212230(0x2ba)]],_0x177b4a=[..._0x57ab03['body'][_0x212230(0x24d)]];const _0x24475=_0x669373[_0x212230(0x2a0)](_0x3a5a48=>{return _0x3a5a48={'product_name':_0x3a5a48};});_0x51bf9c[_0x212230(0x28d)]((_0x58805f,_0x82ac01)=>{var _0x5976f0=_0x212230;_0x24475[_0x82ac01][_0x5976f0(0x2bc)]=_0x58805f;}),_0x3ed1c2[_0x212230(0x28d)]((_0x56c540,_0x30b82c)=>{_0x24475[_0x30b82c]['quantity']=_0x56c540;}),_0x19aaea[_0x212230(0x28d)]((_0x164838,_0x27845c)=>{var _0x22d924=_0x212230;_0x24475[_0x27845c][_0x22d924(0x1fa)]=_0x164838;}),_0x511054['forEach']((_0x4f1136,_0x316093)=>{_0x24475[_0x316093]['secondary_unit']=_0x4f1136;}),_0x5cac18[_0x212230(0x28d)]((_0xd18cbb,_0x396b0a)=>{var _0x13501e=_0x212230;_0x24475[_0x396b0a][_0x13501e(0x250)]=_0xd18cbb;}),_0x7a1e5[_0x212230(0x28d)]((_0x9e9187,_0x48acb0)=>{_0x24475[_0x48acb0]['primary_code']=_0x9e9187;}),_0x597140[_0x212230(0x28d)]((_0x4d3f58,_0x4b297f)=>{var _0x52ec47=_0x212230;_0x24475[_0x4b297f][_0x52ec47(0x1ca)]=_0x4d3f58;}),_0x528ad2['forEach']((_0xc232e0,_0xf2ec5f)=>{_0x24475[_0xf2ec5f]['maxStocks']=_0xc232e0;}),_0x3afa0d['forEach']((_0x26c6be,_0x44b747)=>{var _0xaccb1c=_0x212230;_0x24475[_0x44b747][_0xaccb1c(0x2ba)]=_0x26c6be;}),_0x177b4a[_0x212230(0x28d)]((_0x1c7841,_0x55c7c8)=>{var _0x2248e8=_0x212230;_0x24475[_0x55c7c8][_0x2248e8(0x24d)]=_0x1c7841;});const _0x2ec4b9=_0x24475[_0x212230(0x2c3)](_0xa7c2a6=>_0xa7c2a6['quantity']!=='0'&&_0xa7c2a6[_0x212230(0x2b4)]!=='');_0x2e3f94[_0x212230(0x2b2)]=_0x5b740c,_0x2e3f94['suppliers']=_0x224a31,_0x2e3f94['date']=_0x55a3c1,_0x2e3f94[_0x212230(0x268)]=_0x57f119,_0x2e3f94['product']=_0x2ec4b9,_0x2e3f94['note']=_0x11afac,_0x2e3f94['paid_amount']=_0xf86cb5,_0x2e3f94[_0x212230(0x1dc)]=_0x3b3292,_0x2e3f94['room']=_0xea851b,_0x2e3f94['POnumber']=_0x4ad9b0,_0x2e3f94[_0x212230(0x206)]=_0x43e960;const _0x59a288=await _0x2e3f94[_0x212230(0x1d3)](),_0x5ea08=await warehouse[_0x212230(0x2d0)]({'name':_0x57ab03['body'][_0x212230(0x268)],'room':_0x57ab03['body'][_0x212230(0x226)]});_0x2e3f94[_0x212230(0x274)][_0x212230(0x28d)](_0x47b98f=>{var _0x31662b=_0x212230,_0x2fe4fc=0x0;const _0x5c2625=_0x5ea08[_0x31662b(0x27e)][_0x31662b(0x2a0)](_0x1fecbf=>{var _0x1d40e7=_0x31662b;_0x1fecbf[_0x1d40e7(0x1e4)]==_0x47b98f[_0x1d40e7(0x1e4)]&&_0x1fecbf[_0x1d40e7(0x250)]==_0x47b98f[_0x1d40e7(0x250)]&&(_0x1fecbf[_0x1d40e7(0x1b4)]=parseInt(_0x1fecbf[_0x1d40e7(0x1b4)])+parseInt(_0x47b98f['quantity']),_0x2fe4fc++);});_0x2fe4fc=='0'&&(_0x5ea08[_0x31662b(0x27e)]=_0x5ea08[_0x31662b(0x27e)]['concat']({'product_name':_0x47b98f[_0x31662b(0x1e4)],'product_stock':_0x47b98f[_0x31662b(0x2b4)],'primary_code':_0x47b98f[_0x31662b(0x24f)],'secondary_code':_0x47b98f[_0x31662b(0x1ca)],'product_code':_0x47b98f[_0x31662b(0x2bc)],'bay':_0x47b98f[_0x31662b(0x250)],'maxProducts':_0x47b98f[_0x31662b(0x1cf)],'unit':_0x47b98f['standard_unit'],'secondary_unit':_0x47b98f[_0x31662b(0x259)],'expiry_date':_0x47b98f[_0x31662b(0x24d)]}));}),await _0x5ea08['save']();const _0x25c956=await s_payment_data[_0x212230(0x2d0)]({'invoice':_0x57ab03[_0x212230(0x283)][_0x212230(0x2b2)]});if(_0x25c956===null){}else console[_0x212230(0x2ce)]('suppliers',_0x25c956,_0x57ab03[_0x212230(0x283)][_0x212230(0x2b2)]),_0x25c956[_0x212230(0x2c8)]=_0x57ab03[_0x212230(0x283)]['suppliers'],await _0x25c956[_0x212230(0x1d3)]();_0x57ab03[_0x212230(0x1c7)](_0x212230(0x28e),_0x212230(0x288)),_0x503c08[_0x212230(0x233)]('/all_purchases_finished/view');}catch(_0x39cb56){console[_0x212230(0x2ce)](_0x39cb56);}}),router[a0_0x253042(0x2b1)](a0_0x253042(0x2b9),auth,async(_0x420992,_0x1bf9a1)=>{var _0x32bae9=a0_0x253042;try{const _0x24580a=_0x420992[_0x32bae9(0x290)]['id'],{invoice:_0x5a1693,suppliers:_0x1abe02,payable:_0x5e9212,due_amount:_0x51bf26}=_0x420992[_0x32bae9(0x283)],_0x3b06db=await purchases[_0x32bae9(0x26a)](_0x24580a);var _0x1c5e43=_0x5e9212-_0x51bf26;_0x3b06db['paid_amount']=parseFloat(_0x3b06db[_0x32bae9(0x1e1)])+parseFloat(_0x51bf26),_0x3b06db[_0x32bae9(0x1dc)]=_0x1c5e43;const _0x1c4a59=await _0x3b06db[_0x32bae9(0x1d3)]();console[_0x32bae9(0x2ce)](_0x1c4a59);const _0x4fe666=await s_payment_data[_0x32bae9(0x2d0)]({'invoice':_0x5a1693});_0x4fe666[_0x32bae9(0x29e)]=_0x1c5e43,await _0x4fe666[_0x32bae9(0x1d3)]();let _0x3daeb9=new Date(),_0x274991=('0'+_0x3daeb9[_0x32bae9(0x195)]())[_0x32bae9(0x236)](-0x2),_0x2223d8=('0'+(_0x3daeb9['getMonth']()+0x1))['slice'](-0x2),_0x153206=_0x3daeb9[_0x32bae9(0x2c6)](),_0x57a1cf=_0x153206+'-'+_0x2223d8+'-'+_0x274991;const _0x4bc706=new suppliers_payment({'invoice':_0x5a1693,'date':_0x153206+'-'+_0x2223d8+'-'+_0x274991,'suppliers':_0x1abe02,'reason':_0x32bae9(0x21d),'amount':_0x51bf26}),_0x3f6bb7=await _0x4bc706[_0x32bae9(0x1d3)]();_0x420992[_0x32bae9(0x1c7)](_0x32bae9(0x28e),'payment\x20successfull'),_0x1bf9a1[_0x32bae9(0x233)]('/all_purchases/view');}catch(_0x45f957){console['log'](_0x45f957);}}),router['get'](a0_0x253042(0x213),auth,async(_0x19a24e,_0xe628fa)=>{var _0x5808a3=a0_0x253042;try{const {username:_0xe0973,email:_0x4a469d,role:_0x1e2353}=_0x19a24e[_0x5808a3(0x1e0)],_0x4a9732=_0x19a24e['user'],_0x5c6607=await profile[_0x5808a3(0x2d0)]({'email':_0x4a9732[_0x5808a3(0x25d)]}),_0x42fb16=await master_shop[_0x5808a3(0x1ac)]();console['log'](_0x5808a3(0x239),_0x42fb16);const _0x2f8c8d=_0x19a24e['params']['id'],_0xea3d35=await purchases[_0x5808a3(0x26a)](_0x2f8c8d);console[_0x5808a3(0x2ce)](_0xea3d35);const _0x2b258d=await suppliers[_0x5808a3(0x2d0)]({'name':_0xea3d35['suppliers']});console[_0x5808a3(0x2ce)](_0x2b258d);if(_0x42fb16[0x0][_0x5808a3(0x26b)]==_0x5808a3(0x1d7)){var _0x2c1158=users[_0x5808a3(0x1d2)];console[_0x5808a3(0x2ce)](_0x2c1158);}else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]==_0x5808a3(0x282))var _0x2c1158=users[_0x5808a3(0x282)];else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]=='German')var _0x2c1158=users[_0x5808a3(0x297)];else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]=='Spanish')var _0x2c1158=users[_0x5808a3(0x2bd)];else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]==_0x5808a3(0x29a))var _0x2c1158=users[_0x5808a3(0x29a)];else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]==_0x5808a3(0x2cc))var _0x2c1158=users[_0x5808a3(0x1b0)];else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]==_0x5808a3(0x266))var _0x2c1158=users[_0x5808a3(0x266)];else{if(_0x42fb16[0x0][_0x5808a3(0x26b)]==_0x5808a3(0x273))var _0x2c1158=users[_0x5808a3(0x19c)];}}}}}}}_0xe628fa[_0x5808a3(0x1ad)]('purchase_invoice',{'success':_0x19a24e[_0x5808a3(0x1c7)]('success'),'errors':_0x19a24e['flash'](_0x5808a3(0x1bf)),'role':_0x4a9732,'profile':_0x5c6607,'master_shop':_0x42fb16,'supplier':_0x2b258d,'purchase':_0xea3d35,'language':_0x2c1158});}catch(_0x2c6a9d){console['log'](_0x2c6a9d);}}),router[a0_0x253042(0x240)](a0_0x253042(0x2d3),auth,async(_0x1bf007,_0x1a1c02)=>{var _0x40b8f5=a0_0x253042;try{const {username:_0x24230c,email:_0x49f236,role:_0x54375b}=_0x1bf007[_0x40b8f5(0x1e0)],_0x162c31=_0x1bf007[_0x40b8f5(0x1e0)],_0x1cc984=await profile[_0x40b8f5(0x2d0)]({'email':_0x162c31[_0x40b8f5(0x25d)]}),_0x1da0da=await master_shop['find']();console[_0x40b8f5(0x2ce)]('master',_0x1da0da);const _0x416013=_0x1bf007['params']['id'];console['log'](_0x416013);const _0x22c993=await purchases_finished[_0x40b8f5(0x26a)](_0x416013);console[_0x40b8f5(0x2ce)](_0x40b8f5(0x1b3),_0x22c993);const _0x1db0be=await product['find']({}),_0x2c5cdc=await warehouse['aggregate']([{'$match':{'name':_0x22c993[_0x40b8f5(0x268)],'room':_0x22c993[_0x40b8f5(0x1ae)]}},{'$unwind':_0x40b8f5(0x20e)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x40b8f5(0x1c5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x40b8f5(0x21b)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x40b8f5(0x1d8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x40b8f5(0x1e6)},'storage':{'$first':_0x40b8f5(0x1e2)},'rack':{'$first':_0x40b8f5(0x1a9)}}}]);console['log'](_0x40b8f5(0x255),_0x2c5cdc);let _0x44f631;if(_0x162c31[_0x40b8f5(0x1f7)]==_0x40b8f5(0x1a2)){const _0xd4c21=await staff[_0x40b8f5(0x2d0)]({'email':_0x162c31[_0x40b8f5(0x25d)]});_0x44f631=await warehouse[_0x40b8f5(0x1ac)]({'status':_0x40b8f5(0x1f9),'name':_0xd4c21[_0x40b8f5(0x20b)],'warehouse_category':_0x40b8f5(0x1df),'name':_0x40b8f5(0x1eb)});}else _0x44f631=await warehouse[_0x40b8f5(0x228)]([{'$match':{'status':_0x40b8f5(0x1f9),'warehouse_category':_0x40b8f5(0x1df),'name':_0x40b8f5(0x1eb)}},{'$group':{'_id':_0x40b8f5(0x2cd),'name':{'$first':'$name'}}}]);if(_0x1da0da[0x0][_0x40b8f5(0x26b)]==_0x40b8f5(0x1d7)){var _0x185758=users[_0x40b8f5(0x1d2)];console[_0x40b8f5(0x2ce)](_0x185758);}else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]==_0x40b8f5(0x282))var _0x185758=users[_0x40b8f5(0x282)];else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]==_0x40b8f5(0x297))var _0x185758=users[_0x40b8f5(0x297)];else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]=='Spanish')var _0x185758=users['Spanish'];else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]=='French')var _0x185758=users[_0x40b8f5(0x29a)];else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]=='Portuguese\x20(BR)')var _0x185758=users[_0x40b8f5(0x1b0)];else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]==_0x40b8f5(0x266))var _0x185758=users[_0x40b8f5(0x266)];else{if(_0x1da0da[0x0][_0x40b8f5(0x26b)]==_0x40b8f5(0x273))var _0x185758=users[_0x40b8f5(0x19c)];}}}}}}}_0x1a1c02[_0x40b8f5(0x1ad)](_0x40b8f5(0x28b),{'success':_0x1bf007[_0x40b8f5(0x1c7)](_0x40b8f5(0x28e)),'errors':_0x1bf007[_0x40b8f5(0x1c7)](_0x40b8f5(0x1bf)),'role':_0x162c31,'profile':_0x1cc984,'user':_0x22c993,'stock':_0x2c5cdc,'master_shop':_0x1da0da,'product':_0x1db0be,'language':_0x185758,'warehouse':_0x44f631});}catch(_0x261071){console['log'](_0x261071);}}),router[a0_0x253042(0x2b1)](a0_0x253042(0x2d3),auth,async(_0x3bc60b,_0x588698)=>{var _0x38c866=a0_0x253042;try{const {invoice:_0x385e56,date:_0x52039e,warehouse_name:_0x3e1940,Room_name:_0x2aafd5,product_name:_0x259b57,purchase_quantity:_0x3c0208,stocks:_0x4154fd,return_qty:_0x4a58d8,note:_0x30dcbb,level:_0xfd4274,isle:_0x2ad7ce,pallet:_0xb7ae86,to_warehouse_name:_0x4e48ae,to_Room_name:_0x24409a}=_0x3bc60b[_0x38c866(0x283)],_0x58f396=await purchases_finished['findOne']({'_id':_0x3bc60b[_0x38c866(0x290)]['id']}),_0x649310=await warehouse['findOne']({'name':_0x3e1940,'room':_0x2aafd5,'warehouse_category':_0x38c866(0x1df)});if(typeof _0x259b57==_0x38c866(0x223))var _0x1a0b52=[_0x3bc60b[_0x38c866(0x283)][_0x38c866(0x1e4)]],_0x1c7eb8=[_0x3bc60b['body'][_0x38c866(0x241)]],_0x5d6ce9=[_0x3bc60b[_0x38c866(0x283)]['stocks']],_0x4e7951=[_0x3bc60b[_0x38c866(0x283)][_0x38c866(0x1a3)]],_0x489525=[_0x3bc60b['body'][_0x38c866(0x1d0)]],_0x2b8df3=[_0x3bc60b['body'][_0x38c866(0x22f)]],_0x19caa7=[_0x3bc60b[_0x38c866(0x283)][_0x38c866(0x296)]],_0x3312b0=[_0x3bc60b[_0x38c866(0x283)][_0x38c866(0x1b6)]];else var _0x1a0b52=[..._0x3bc60b['body'][_0x38c866(0x1e4)]],_0x1c7eb8=[..._0x3bc60b[_0x38c866(0x283)][_0x38c866(0x241)]],_0x5d6ce9=[..._0x3bc60b[_0x38c866(0x283)]['stocks']],_0x4e7951=[..._0x3bc60b[_0x38c866(0x283)][_0x38c866(0x1a3)]],_0x489525=[..._0x3bc60b['body']['level']],_0x2b8df3=[..._0x3bc60b[_0x38c866(0x283)][_0x38c866(0x22f)]],_0x19caa7=[..._0x3bc60b[_0x38c866(0x283)][_0x38c866(0x296)]],_0x3312b0=[..._0x3bc60b[_0x38c866(0x283)][_0x38c866(0x1b6)]];const _0xe5a53a=_0x1a0b52[_0x38c866(0x2a0)](_0x1860da=>{return _0x1860da={'product_name':_0x1860da};});_0x1c7eb8[_0x38c866(0x28d)]((_0xa59aea,_0x8130c2)=>{var _0x7ff30=_0x38c866;_0xe5a53a[_0x8130c2][_0x7ff30(0x241)]=_0xa59aea;}),_0x5d6ce9['forEach']((_0x246fe5,_0x268d81)=>{var _0x45ea1d=_0x38c866;_0xe5a53a[_0x268d81][_0x45ea1d(0x1ff)]=_0x246fe5;}),_0x4e7951[_0x38c866(0x28d)]((_0xbb0821,_0x4fc8f6)=>{_0xe5a53a[_0x4fc8f6]['return_qty']=_0xbb0821;}),_0x489525[_0x38c866(0x28d)]((_0x2bb7b4,_0x269ef4)=>{var _0x1c4599=_0x38c866;_0xe5a53a[_0x269ef4][_0x1c4599(0x250)]=_0x2bb7b4;}),_0x2b8df3[_0x38c866(0x28d)]((_0x584607,_0x430c79)=>{var _0x4c2104=_0x38c866;_0xe5a53a[_0x430c79][_0x4c2104(0x2bc)]=_0x584607;}),_0x19caa7['forEach']((_0x327809,_0x53a35e)=>{var _0x2f6deb=_0x38c866;_0xe5a53a[_0x53a35e][_0x2f6deb(0x24f)]=_0x327809;}),_0x3312b0[_0x38c866(0x28d)]((_0x204cd5,_0x8b3ef9)=>{_0xe5a53a[_0x8b3ef9]['secondary_code']=_0x204cd5;}),_0xe5a53a['forEach'](_0xd0bb6d=>{var _0x368c9c=_0x38c866;console[_0x368c9c(0x2ce)](_0xd0bb6d);const _0x2396bd=_0x649310[_0x368c9c(0x27e)]['map'](_0x3f3b9a=>{var _0xc8e792=_0x368c9c;_0x3f3b9a[_0xc8e792(0x1e4)]==_0xd0bb6d[_0xc8e792(0x1e4)]&&_0x3f3b9a[_0xc8e792(0x250)]==_0xd0bb6d[_0xc8e792(0x250)]&&(console[_0xc8e792(0x2ce)](parseInt(_0x3f3b9a[_0xc8e792(0x1b4)])+_0xc8e792(0x1a4)+parseInt(_0xd0bb6d[_0xc8e792(0x1a3)])),_0x3f3b9a[_0xc8e792(0x1b4)]=parseInt(_0x3f3b9a[_0xc8e792(0x1b4)])-parseInt(_0xd0bb6d[_0xc8e792(0x1a3)]));});}),await _0x649310['save']();var _0x2a47d5=0x0;_0xe5a53a[_0x38c866(0x28d)](_0x3cf39b=>{var _0x662502=_0x38c866;(parseInt(_0x3cf39b['purchase_quantity'])<parseInt(_0x3cf39b[_0x662502(0x1a3)])||parseInt(_0x3cf39b['stock_quantity'])<parseInt(_0x3cf39b[_0x662502(0x1a3)]))&&_0x2a47d5++;});if(_0x2a47d5!=0x0)return _0x3bc60b[_0x38c866(0x1c7)](_0x38c866(0x1bf),_0x38c866(0x230)),_0x588698['redirect']('back');const _0xd1195=new purchases_return_finished({'invoice':_0x385e56,'suppliers':_0x3bc60b['body'][_0x38c866(0x2c8)],'date':_0x52039e,'warehouse_name':_0x3e1940,'return_product':_0xe5a53a,'note':_0x30dcbb,'room':_0x2aafd5,'to_warehouse_name':_0x4e48ae,'to_room':_0x24409a}),_0x2387d2=await _0xd1195[_0x38c866(0x1d3)](),_0x78684b=await purchases_return_finished[_0x38c866(0x2d0)]({'invoice':_0x385e56}),_0xf5446d=await warehouse[_0x38c866(0x2d0)]({'name':_0x4e48ae,'room':_0x24409a,'warehouse_category':_0x38c866(0x1df)});_0x78684b[_0x38c866(0x209)][_0x38c866(0x28d)](_0x5178c9=>{var _0x288d46=_0x38c866,_0x37e67e=0x0;const _0x379fbf=_0xf5446d[_0x288d46(0x27e)]['map'](_0x406950=>{var _0xff3e31=_0x288d46;console[_0xff3e31(0x2ce)](_0x406950['product_name']+'=='+_0x5178c9['product_name']+'&&'+_0x406950[_0xff3e31(0x250)]+'=='+_0x5178c9[_0xff3e31(0x250)]),_0x406950[_0xff3e31(0x1e4)]==_0x5178c9[_0xff3e31(0x1e4)]&&_0x406950[_0xff3e31(0x250)]==_0x5178c9[_0xff3e31(0x250)]&&(_0x406950[_0xff3e31(0x1b4)]=parseInt(_0x406950[_0xff3e31(0x1b4)])-parseInt(_0x5178c9[_0xff3e31(0x1a3)]),_0x37e67e++);});_0x37e67e=='0'&&(_0xf5446d[_0x288d46(0x27e)]=_0xf5446d[_0x288d46(0x27e)][_0x288d46(0x1fd)]({'product_name':_0x5178c9['product_name'],'product_stock':_0x5178c9['return_qty'],'primary_code':_0x5178c9[_0x288d46(0x24f)],'secondary_code':_0x5178c9[_0x288d46(0x1ca)],'product_code':_0x5178c9[_0x288d46(0x2bc)],'bay':_0x5178c9[_0x288d46(0x250)],'maxProducts':0xf423f}));}),await _0xf5446d[_0x38c866(0x1d3)]();const _0x26e8ac=await purchases_finished[_0x38c866(0x2d0)]({'invoice':_0x385e56});_0x26e8ac['return_data']=_0x38c866(0x200);const _0x10a7d5=await _0x26e8ac[_0x38c866(0x1d3)](),_0x378e59=new s_payment_data({'invoice':_0x385e56,'suppliers':_0x3bc60b[_0x38c866(0x283)][_0x38c866(0x2c8)],'reason':_0x38c866(0x237)});await _0x378e59['save']();const _0x3ea111=await master_shop[_0x38c866(0x1ac)](),_0x25e23d=await email_settings[_0x38c866(0x2d0)](),_0x4e0bba=await suppliers[_0x38c866(0x2d0)]({'name':_0x3bc60b[_0x38c866(0x283)][_0x38c866(0x2c8)]});_0x3ea111[0x0][_0x38c866(0x1cc)]==0x1?(right_currency=_0x3ea111[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3ea111[0x0][_0x38c866(0x22d)]);var _0x124b49=_0x1a0b52,_0x294d3b=_0x4e7951,_0xf21eb4='',_0x267a51;for(_0x267a51 in _0x124b49){_0xf21eb4+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x124b49[_0x267a51]+_0x38c866(0x1a6)+_0x38c866(0x204)+_0x294d3b[_0x267a51]+_0x38c866(0x1a6)+_0x38c866(0x232);}let _0x501890=nodemailer[_0x38c866(0x23c)]({'service':_0x38c866(0x19a),'auth':{'user':_0x25e23d[_0x38c866(0x25d)],'pass':_0x25e23d['password']}}),_0x5f0aee={'from':_0x25e23d[_0x38c866(0x25d)],'to':_0x4e0bba[_0x38c866(0x25d)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x38c866(0x21e),'path':__dirname+'/../public'+'/upload/'+_0x3ea111[0x0][_0x38c866(0x2aa)],'cid':_0x38c866(0x1e3)}],'html':_0x38c866(0x252)+_0x38c866(0x27f)+_0x38c866(0x1ea)+_0x38c866(0x293)+_0x38c866(0x191)+'<div>'+_0x38c866(0x231)+_0x38c866(0x245)+_0x38c866(0x293)+_0x38c866(0x292)+_0x3ea111[0x0][_0x38c866(0x1fe)]+'\x20</h2>'+_0x38c866(0x245)+_0x38c866(0x245)+_0x38c866(0x1ef)+'<div>'+_0x38c866(0x242)+_0x38c866(0x1c8)+_0x385e56+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x52039e+'\x20'+_0x38c866(0x2bb)+'</h5>'+'</div>'+_0x38c866(0x19b)+_0x38c866(0x2a2)+_0x38c866(0x246)+_0x38c866(0x2ab)+_0x38c866(0x2a5)+_0x38c866(0x2b0)+_0x38c866(0x276)+'</tr>'+_0x38c866(0x1e9)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xf21eb4+'\x20'+'</tbody>'+_0x38c866(0x253)+_0x38c866(0x293)+'<strong>\x20Regards\x20</strong>'+_0x38c866(0x1d4)+_0x3ea111[0x0][_0x38c866(0x1fe)]+_0x38c866(0x1a0)+_0x38c866(0x245)+_0x38c866(0x245)+_0x38c866(0x2c1)};_0x501890['sendMail'](_0x5f0aee,function(_0x1b85f5,_0x795384){var _0x179aa7=_0x38c866;_0x1b85f5?console[_0x179aa7(0x2ce)](_0x179aa7(0x29f)):console[_0x179aa7(0x2ce)](_0x179aa7(0x256));}),_0x3bc60b['flash']('success','purchases\x20item\x20return\x20successfull'),_0x588698['redirect'](_0x38c866(0x1b9));}catch(_0x659cc0){_0x588698[_0x38c866(0x1dd)](0xc8)[_0x38c866(0x28c)]({'message':_0x659cc0[_0x38c866(0x2b7)]});}}),router[a0_0x253042(0x240)](a0_0x253042(0x269),auth,async(_0x26e1d4,_0x46bac9)=>{var _0x1bb03c=a0_0x253042;try{const {username:_0x2dcf3f,email:_0x2e16c4,role:_0x169649}=_0x26e1d4['user'],_0x2e9ca4=_0x26e1d4['user'],_0x451e06=await profile[_0x1bb03c(0x2d0)]({'email':_0x2e9ca4[_0x1bb03c(0x25d)]}),_0x1d6885=await master_shop['find'](),_0xcdba0a=_0x26e1d4[_0x1bb03c(0x290)]['id'],_0x294089=await purchases_finished[_0x1bb03c(0x26a)](_0xcdba0a);if(_0x1d6885[0x0][_0x1bb03c(0x26b)]=='English\x20(US)')var _0x4250d2=users['English'];else{if(_0x1d6885[0x0]['language']==_0x1bb03c(0x282))var _0x4250d2=users[_0x1bb03c(0x282)];else{if(_0x1d6885[0x0][_0x1bb03c(0x26b)]=='German')var _0x4250d2=users[_0x1bb03c(0x297)];else{if(_0x1d6885[0x0][_0x1bb03c(0x26b)]=='Spanish')var _0x4250d2=users['Spanish'];else{if(_0x1d6885[0x0]['language']==_0x1bb03c(0x29a))var _0x4250d2=users[_0x1bb03c(0x29a)];else{if(_0x1d6885[0x0][_0x1bb03c(0x26b)]==_0x1bb03c(0x2cc))var _0x4250d2=users[_0x1bb03c(0x1b0)];else{if(_0x1d6885[0x0][_0x1bb03c(0x26b)]==_0x1bb03c(0x266))var _0x4250d2=users[_0x1bb03c(0x266)];else{if(_0x1d6885[0x0][_0x1bb03c(0x26b)]=='Arabic\x20(ae)')var _0x4250d2=users['Arabic'];}}}}}}}_0x46bac9[_0x1bb03c(0x1ad)](_0x1bb03c(0x279),{'success':_0x26e1d4['flash'](_0x1bb03c(0x28e)),'errors':_0x26e1d4[_0x1bb03c(0x1c7)]('errors'),'role':_0x2e9ca4,'profile':_0x451e06,'alldata':_0x294089,'master_shop':_0x1d6885,'language':_0x4250d2}),console['log'](alldata);}catch(_0x4c9a66){console[_0x1bb03c(0x2ce)](_0x4c9a66);}}),router[a0_0x253042(0x2b1)](a0_0x253042(0x272),async(_0x2f129c,_0x526f22)=>{var _0x1ec46b=a0_0x253042;const {product_code:_0x34a17c}=_0x2f129c['body'];var _0x249a2f;const _0x3ee3f6=await product[_0x1ec46b(0x228)]([{'$match':{'primary_code':_0x34a17c}},{'$group':{'_id':_0x1ec46b(0x22e),'name':{'$first':_0x1ec46b(0x2cd)},'category':{'$first':_0x1ec46b(0x248)},'brand':{'$first':_0x1ec46b(0x265)},'unit':{'$first':_0x1ec46b(0x225)},'alertquantity':{'$first':_0x1ec46b(0x192)},'product_code':{'$first':_0x1ec46b(0x294)},'primary_code':{'$first':_0x1ec46b(0x299)},'secondary_code':{'$first':_0x1ec46b(0x24b)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1ec46b(0x211)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x1afbab=await product[_0x1ec46b(0x228)]([{'$match':{'secondary_code':_0x34a17c}},{'$group':{'_id':_0x1ec46b(0x22e),'name':{'$first':_0x1ec46b(0x2cd)},'category':{'$first':_0x1ec46b(0x248)},'brand':{'$first':_0x1ec46b(0x265)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x1ec46b(0x192)},'product_code':{'$first':_0x1ec46b(0x294)},'primary_code':{'$first':_0x1ec46b(0x299)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1ec46b(0x1f6)},'maxProdPerUnit':{'$first':_0x1ec46b(0x211)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1ec46b(0x1ab)},'gross_price':{'$first':_0x1ec46b(0x1f3)},'sales_category':{'$first':_0x1ec46b(0x1ba)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x3ee3f6[_0x1ec46b(0x263)]>0x0)_0x249a2f=_0x3ee3f6;else _0x1afbab['length']>0x0&&(_0x249a2f=_0x1afbab);_0x526f22[_0x1ec46b(0x28c)](_0x249a2f);}),router[a0_0x253042(0x2b1)](a0_0x253042(0x1fb),async(_0x335676,_0x4a729a)=>{var _0x29de39=a0_0x253042;const {productCode:_0x6be950,bay:_0x3c1600,warehouses:_0x4d44b8,room:_0x4b5bbf}=_0x335676['body'];console['log'](_0x335676[_0x29de39(0x283)]);try{const _0x149b96=await warehouse['aggregate']([{'$match':{'name':_0x4d44b8,'room':_0x4b5bbf}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x3c1600)}},{'$group':{'_id':_0x29de39(0x24a),'name':{'$first':_0x29de39(0x216)},'product_stock':{'$first':_0x29de39(0x1c5)},'bay':{'$first':_0x29de39(0x215)},'maxProducts':{'$first':_0x29de39(0x1bd)}}}]);_0x4a729a['status'](0xc8)[_0x29de39(0x28c)](_0x149b96);}catch(_0x533f30){_0x4a729a['status'](0x194)['json']({'message':_0x533f30[_0x29de39(0x2b7)]});}}),router['post']('/barcode_scanner_logs',async(_0xc38ef,_0x495529)=>{var _0x198162=a0_0x253042;const {product_code:_0x329e57}=_0xc38ef[_0x198162(0x283)];var _0x213072;const _0x3b8689=await product[_0x198162(0x228)]([{'$match':{'primary_code':_0x329e57,'type_products':_0x198162(0x2ce)}},{'$group':{'_id':'$_id','name':{'$first':_0x198162(0x2cd)},'category':{'$first':'$category'},'brand':{'$first':_0x198162(0x265)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x198162(0x299)},'secondary_code':{'$first':_0x198162(0x24b)},'maxStocks':{'$first':_0x198162(0x1f6)},'maxProdPerUnit':{'$first':_0x198162(0x211)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x198162(0x1ab)},'gross_price':{'$first':_0x198162(0x1f3)},'sales_category':{'$first':_0x198162(0x1ba)},'type_products':{'$first':_0x198162(0x2d4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x3b8689);const _0x1a115d=await product[_0x198162(0x228)]([{'$match':{'secondary_code':_0x329e57,'type_products':_0x198162(0x2ce)}},{'$group':{'_id':_0x198162(0x22e),'name':{'$first':_0x198162(0x2cd)},'category':{'$first':_0x198162(0x248)},'brand':{'$first':_0x198162(0x265)},'unit':{'$first':_0x198162(0x225)},'alertquantity':{'$first':_0x198162(0x192)},'product_code':{'$first':_0x198162(0x294)},'primary_code':{'$first':_0x198162(0x299)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x198162(0x1f6)},'maxProdPerUnit':{'$first':_0x198162(0x211)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x198162(0x1f3)},'sales_category':{'$first':_0x198162(0x1ba)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x3b8689[_0x198162(0x263)]>0x0)_0x213072=_0x3b8689;else _0x1a115d['length']>0x0&&(_0x213072=_0x1a115d);_0x495529[_0x198162(0x28c)](_0x213072);}),module['exports']=router;