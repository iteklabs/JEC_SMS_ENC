var a0_0x154127=a0_0x1daa;(function(_0x2290aa,_0x3aae40){var _0x30c8c2=a0_0x1daa,_0x295a56=_0x2290aa();while(!![]){try{var _0x46292b=parseInt(_0x30c8c2(0x204))/0x1+-parseInt(_0x30c8c2(0x2e2))/0x2*(-parseInt(_0x30c8c2(0x2a4))/0x3)+-parseInt(_0x30c8c2(0x2e6))/0x4+-parseInt(_0x30c8c2(0x2fc))/0x5+-parseInt(_0x30c8c2(0x1ff))/0x6+-parseInt(_0x30c8c2(0x31e))/0x7*(parseInt(_0x30c8c2(0x266))/0x8)+parseInt(_0x30c8c2(0x232))/0x9*(parseInt(_0x30c8c2(0x2b4))/0xa);if(_0x46292b===_0x3aae40)break;else _0x295a56['push'](_0x295a56['shift']());}catch(_0x8a7d9e){_0x295a56['push'](_0x295a56['shift']());}}}(a0_0x407d,0xc4f8f));const express=require(a0_0x154127(0x2c8)),app=express(),router=express[a0_0x154127(0x248)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x154127(0x2d6)),auth=require(a0_0x154127(0x271)),nodemailer=require(a0_0x154127(0x312));var ejs=require(a0_0x154127(0x28d));const path=require(a0_0x154127(0x282)),users=require('../public/language/languages.json'),{isNull}=require(a0_0x154127(0x265));router[a0_0x154127(0x223)](a0_0x154127(0x306),auth,async(_0x5dcaab,_0x32f8f5)=>{var _0x19dbae=a0_0x154127;try{const {username:_0x28eb69,email:_0x4149ac,role:_0x568aff}=_0x5dcaab[_0x19dbae(0x2a2)],_0x30190d=_0x5dcaab[_0x19dbae(0x2a2)],_0x45c132=await profile[_0x19dbae(0x281)]({'email':_0x30190d[_0x19dbae(0x2ed)]}),_0x40bc65=await staff[_0x19dbae(0x281)]({'email':_0x30190d['email']}),_0x32252c=await master_shop[_0x19dbae(0x2a6)]();let _0x799828=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x40bc65[_0x19dbae(0x27d)]}}]);if(_0x32252c[0x0]['language']=='English\x20(US)')var _0x1d88d8=users[_0x19dbae(0x279)];else{if(_0x32252c[0x0]['language']==_0x19dbae(0x272))var _0x1d88d8=users[_0x19dbae(0x272)];else{if(_0x32252c[0x0][_0x19dbae(0x23b)]=='German')var _0x1d88d8=users[_0x19dbae(0x31f)];else{if(_0x32252c[0x0][_0x19dbae(0x23b)]=='Spanish')var _0x1d88d8=users['Spanish'];else{if(_0x32252c[0x0][_0x19dbae(0x23b)]==_0x19dbae(0x2be))var _0x1d88d8=users[_0x19dbae(0x2be)];else{if(_0x32252c[0x0]['language']==_0x19dbae(0x27a))var _0x1d88d8=users['Portuguese'];else{if(_0x32252c[0x0][_0x19dbae(0x23b)]==_0x19dbae(0x2aa))var _0x1d88d8=users[_0x19dbae(0x2aa)];else{if(_0x32252c[0x0][_0x19dbae(0x23b)]=='Arabic\x20(ae)')var _0x1d88d8=users[_0x19dbae(0x300)];}}}}}}}_0x32f8f5[_0x19dbae(0x2a1)](_0x19dbae(0x2c0),{'success':_0x5dcaab[_0x19dbae(0x24f)](_0x19dbae(0x2a3)),'errors':_0x5dcaab['flash'](_0x19dbae(0x22f)),'purchases':_0x799828,'role':_0x30190d,'profile':_0x45c132,'master_shop':_0x32252c,'language':_0x1d88d8,'staff_data':_0x40bc65});}catch(_0x258759){console[_0x19dbae(0x319)](_0x19dbae(0x216),_0x258759),_0x32f8f5['status'](0xc8)[_0x19dbae(0x2bf)]({'message':_0x258759[_0x19dbae(0x276)]});}}),router[a0_0x154127(0x223)](a0_0x154127(0x1eb),auth,async(_0x4a7a9b,_0x112786)=>{var _0x595bdc=a0_0x154127;try{const {username:_0x43843a,email:_0x518015,role:_0x5bf176}=_0x4a7a9b[_0x595bdc(0x2a2)],_0x56d137=_0x4a7a9b[_0x595bdc(0x2a2)],_0x29c3fa=await profile[_0x595bdc(0x281)]({'email':_0x56d137[_0x595bdc(0x2ed)]}),_0x4d149e=await staff[_0x595bdc(0x281)]({'email':_0x56d137['email']}),_0xc36f94=await master_shop[_0x595bdc(0x2a6)]();let _0x685f69=await transfers_finished[_0x595bdc(0x31a)]([{'$match':{'to_warehouse':_0x4d149e[_0x595bdc(0x27d)],'to_recieved':_0x595bdc(0x247)}}]);if(_0xc36f94[0x0][_0x595bdc(0x23b)]==_0x595bdc(0x212))var _0x51f9db=users[_0x595bdc(0x279)];else{if(_0xc36f94[0x0][_0x595bdc(0x23b)]==_0x595bdc(0x272))var _0x51f9db=users['Hindi'];else{if(_0xc36f94[0x0]['language']=='German')var _0x51f9db=users[_0x595bdc(0x31f)];else{if(_0xc36f94[0x0][_0x595bdc(0x23b)]==_0x595bdc(0x302))var _0x51f9db=users[_0x595bdc(0x302)];else{if(_0xc36f94[0x0][_0x595bdc(0x23b)]==_0x595bdc(0x2be))var _0x51f9db=users[_0x595bdc(0x2be)];else{if(_0xc36f94[0x0][_0x595bdc(0x23b)]=='Portuguese\x20(BR)')var _0x51f9db=users[_0x595bdc(0x339)];else{if(_0xc36f94[0x0]['language']==_0x595bdc(0x2aa))var _0x51f9db=users[_0x595bdc(0x2aa)];else{if(_0xc36f94[0x0][_0x595bdc(0x23b)]=='Arabic\x20(ae)')var _0x51f9db=users[_0x595bdc(0x300)];}}}}}}}_0x112786[_0x595bdc(0x2a1)](_0x595bdc(0x274),{'success':_0x4a7a9b[_0x595bdc(0x24f)](_0x595bdc(0x2a3)),'errors':_0x4a7a9b[_0x595bdc(0x24f)](_0x595bdc(0x22f)),'purchases':_0x685f69,'role':_0x56d137,'profile':_0x29c3fa,'master_shop':_0xc36f94,'language':_0x51f9db,'staff_data':_0x4d149e});}catch(_0x283868){console[_0x595bdc(0x319)](_0x595bdc(0x216),_0x283868),_0x112786[_0x595bdc(0x26f)](0xc8)['json']({'message':_0x283868['message']});}});function a0_0x407d(){var _0x501ae9=['isAvailable','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$alertquantity','prod_code','FROZEN\x20GOODS','French','json','incoming_view','Arabic\x20(ae)','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</body></html>','$product_details.product_stock','Enabled','primary_code','express','\x20<>\x20','$product_details','return_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','master',',\x20bay:\x20','LOG-INC-','uuid','all_purchases_finished_logs','level','type_of_products','$product.type','prod_primunit','../models/all_models','$note','bin','all','prod_name','product_code_hide','secondary_unit','item_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','port','MaxStocks_data','An\x20error\x20occurred.','2fpjqiW','exports','$maxStocks','product_stock','4613288BxQWMt','createTransport','Rack\x202','$product_details.rack','forEach','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','then','email','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','suppliers_docs','$product.bay','/all_purchases_finished/view','maxperunit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','stock_quantity','bay','$product.floorlevel','add_purchases_finished_logs','<!DOCTYPE\x20html>','INC-','STAGING','/upload/','3768380bQZWdt','prod_cat','$warehouse_name','slice','Arabic','prod_Qty','Spanish','$brand','product_cat','$date','/incoming','/picking_list/pdf_puchases_fin_own_trf/','max_product_unit','to_room_name','save','/view/add_purchases','note','paid_amount','The\x20Other\x20','/view','$product_details.maxProducts','quantity','nodemailer','suppliers','2-digit','return_product','user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','error','log','aggregate','Error\x20occurred\x20while\x20processing\x20product:','product','host','21TKMmDH','German','</span>','$product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$secondary_code','image','prod_level','/getTRF','<h5\x20style=\x22text-align:\x20left;\x22>','\x20<=>\x20','purchases_process','</head><body>','due_amount','true','string','</table>','here2','catch','production_date','data_type','product_data','$product_details.product_name','<h2>\x20','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','Ambient','$product_details.bay','Portuguese','stock_data','/invoice/:id','toLocaleDateString','/incoming/add',',\x20bin:\x20','return_qty','Enclosed','staff','secondary_code_hide','$product','Purchase\x20Return\x20Mail','redirect','/barcode/:id','$suppliers_docs','$batch_code','primary_code_hide','\x20to\x20warehouse:\x20','<strong>\x20Regards\x20</strong>','/all_purchases_finished/preview/','/barcode_scanner_logs','to_bay','Logo.png','===','8694uOXWSB','/view_log','</tbody>','$product.room_name','$unit','1491402OflEhW','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','site_title','</thead>','standard_unit','$product.bin','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','purchase\x20data\x20update\x20successfully','/view/:id','Distributing\x20','product_date','True','English\x20(US)','body','updateOne','to_recieved','table\x20page','$paid_amount','INC','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Purchase\x20Return','<div>','match','$sales_category','$gross_price','warehouse_name','$product_details.bin','$product_code','gmail','get','inc','</td>','FGSEmail','\x20units\x20of\x20','product_code','Return\x20Goods','\x20</h2>','<span\x20style=\x22float:\x20right;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','date_recieved','map','errors','product_name','<h5>','414PfIRJK','secondary_code','/../public','$maxProdPerUnit','$expiry_date','$_id','password','product_id','There\x20is\x20','language','return_purchase_finished','valueOf','invoice','prod_qty','Rack\x201','$return_data','filter','product_details','maxProducts','/preview/:id','getDate','false','Router','<html><head><title></title>','room_name','concat','gross_price','<tbody\x20style=\x22text-align:\x20center;\x22>','own','flash','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$invoice','$primary_code','currency','/all_purchases_finished/process/','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','undefined','padStart','abs','all_purchases_finished','purchase\x20data\x20add\x20successfully','length','_id','name','/view/return_purchase/:id','id_transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Asia/Manila','<hr\x20class=\x22my-3\x22>','util','2081000jJAEzj','toString','INCF-','Room_name','RoomAssign','post','</tr>','min','STAGING\x20AREA\x201','status','to_quantity','../middleware/auth','Hindi','expiry_date','incoming_add','sendMail','message','\x20Order\x20Date\x20:\x20','$suppliers','English','Portuguese\x20(BR)','Error\x20Occurs','$room','warehouse','sales_category','purchase_quantity','stocks','findOne','path','getMonth',',\x20room:\x20','$name','params','$secondary_unit','max','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','prod_secondunit','$product_details.floorlevel','date','ejs','Finished\x20Goods','en-CA','sales_data_cateory','add_purchases_finished','Email\x20sent\x20successfully','\x20Order\x20Number\x20:\x20','add_purchases\x20error','</div>','batch_code','unit','/view/add_purchases_logs','/CheckingWarehouse','logs','/process/:id','role','isUsed','$product_details.product_code','prod_unit','maxPerUnit','render','user','success','2593707COpYsc','$product_details.primary_code','find','logo','room','<tr>','Chinese','back','invoice_init','DRY\x20GOODS','$due_amount','$type_products','payment\x20successfull','$category','edit_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','247750WBFTUB','\x20inc\x20=\x20','maxStocks','type_of_products_type','findById'];a0_0x407d=function(){return _0x501ae9;};return a0_0x407d();}const createLog=async _0x4618a7=>{var _0x45cd79=a0_0x154127;const _0x282432=new datalogs({'location':_0x4618a7});return await _0x282432[_0x45cd79(0x30a)](),_0x282432[_0x45cd79(0x2ac)];};function a0_0x1daa(_0x4cb1c9,_0x354547){var _0x407d5c=a0_0x407d();return a0_0x1daa=function(_0x1daa79,_0x16f497){_0x1daa79=_0x1daa79-0x1e8;var _0x242512=_0x407d5c[_0x1daa79];return _0x242512;},a0_0x1daa(_0x4cb1c9,_0x354547);}router[a0_0x154127(0x26b)](a0_0x154127(0x1eb),auth,async(_0x5002ff,_0x1d8955)=>{var _0x30cb28=a0_0x154127;try{const {invoice_trf_data:_0x4e14cc,item_code:_0x536a40,SCRN:_0x10f521,ReqBy:_0x29d840,type_of_products:_0x531c9a,dateofreq:_0x1b5378,PO_number:_0x514365,date:_0x531b8a,warehouse_name:_0x35aea0,typeservicesData:_0x4e4ed6,typevehicle:_0x27c8cf,driver:_0x3994eb,plate:_0x28da31,van:_0x29fec5,DRSI:_0x1676cc,TSU:_0xffcb83,TFU:_0x55a4bc,note:_0x461518}=_0x5002ff[_0x30cb28(0x213)],_0x29eaaf=await transfers_finished['findById'](_0x4e14cc);if(typeof _0x536a40==_0x30cb28(0x32d))var _0x488626=[_0x5002ff[_0x30cb28(0x213)]['product_name']],_0x15ef33=[_0x5002ff['body'][_0x30cb28(0x2dd)]],_0x2d0c0c=[_0x5002ff['body'][_0x30cb28(0x270)]],_0x1fb909=[_0x5002ff['body'][_0x30cb28(0x297)]],_0x1a22b3=[_0x5002ff[_0x30cb28(0x213)]['prod_secondunit']],_0x43826f=[_0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x2d8)]],_0xc1f011=[_0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x2c7)]],_0x20d516=[_0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x233)]],_0x49d6ab=[_0x5002ff[_0x30cb28(0x213)]['batch_code']],_0x20904b=[_0x5002ff[_0x30cb28(0x213)]['expiry_date']],_0x2bd54e=[_0x5002ff['body'][_0x30cb28(0x331)]],_0x56aec6=[_0x5002ff[_0x30cb28(0x213)]['max_product_unit']],_0x1ae7d5=[_0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x2a8)]];else var _0x488626=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x230)]],_0x15ef33=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x2dd)]],_0x2d0c0c=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x270)]],_0x1fb909=[..._0x5002ff[_0x30cb28(0x213)]['unit']],_0x1a22b3=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x28a)]],_0x43826f=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x2d8)]],_0xc1f011=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x2c7)]],_0x20d516=[..._0x5002ff[_0x30cb28(0x213)]['secondary_code']],_0x49d6ab=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x296)]],_0x20904b=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x273)]],_0x2bd54e=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x331)]],_0x56aec6=[..._0x5002ff[_0x30cb28(0x213)][_0x30cb28(0x308)]],_0x1ae7d5=[..._0x5002ff[_0x30cb28(0x213)]['room']];const _0x9ba8d2=_0x488626['map'](_0x4495bc=>{return _0x4495bc={'product_name':_0x4495bc};});_0x15ef33[_0x30cb28(0x2ea)]((_0x3b3ccd,_0x57bf6b)=>{_0x9ba8d2[_0x57bf6b]['product_code']=_0x3b3ccd;}),_0x2d0c0c[_0x30cb28(0x2ea)]((_0x479e94,_0x496f3e)=>{var _0x422234=_0x30cb28;_0x9ba8d2[_0x496f3e][_0x422234(0x311)]=Math[_0x422234(0x25a)](_0x479e94);}),_0x1fb909[_0x30cb28(0x2ea)]((_0x42620d,_0x2ac839)=>{var _0x10557c=_0x30cb28;_0x9ba8d2[_0x2ac839][_0x10557c(0x20a)]=_0x42620d;}),_0x1a22b3['forEach']((_0x44b8fe,_0x4659d5)=>{var _0x517a11=_0x30cb28;_0x9ba8d2[_0x4659d5][_0x517a11(0x2dc)]=_0x44b8fe;}),_0x43826f[_0x30cb28(0x2ea)]((_0x20a346,_0x2ebb90)=>{var _0x436298=_0x30cb28,_0x271d1c=_0x20a346[_0x436298(0x21c)](/[A-Za-z]+/)[0x0],_0x2bc909=parseInt(_0x20a346['match'](/\d+/)[0x0]);_0x9ba8d2[_0x2ebb90][_0x436298(0x2d2)]=_0x271d1c,_0x9ba8d2[_0x2ebb90][_0x436298(0x2f5)]=_0x2bc909;}),_0xc1f011[_0x30cb28(0x2ea)]((_0x51cf7f,_0x57cb53)=>{_0x9ba8d2[_0x57cb53]['primary_code']=_0x51cf7f;}),_0x20d516[_0x30cb28(0x2ea)]((_0x51fa95,_0xbc867a)=>{var _0x246bf0=_0x30cb28;_0x9ba8d2[_0xbc867a][_0x246bf0(0x233)]=_0x51fa95;}),_0x49d6ab['forEach']((_0x299afd,_0x2e5522)=>{_0x9ba8d2[_0x2e5522]['batch_code']=_0x299afd;}),_0x20904b[_0x30cb28(0x2ea)]((_0x1ebc03,_0x2659b4)=>{_0x9ba8d2[_0x2659b4]['expiry_date']=_0x1ebc03;}),_0x2bd54e['forEach']((_0x16aaf1,_0xf993fb)=>{var _0x377238=_0x30cb28;_0x9ba8d2[_0xf993fb][_0x377238(0x331)]=_0x16aaf1;}),_0x56aec6[_0x30cb28(0x2ea)]((_0x34431e,_0x348571)=>{var _0x2afe38=_0x30cb28;_0x9ba8d2[_0x348571][_0x2afe38(0x2f2)]=_0x34431e;}),_0x1ae7d5[_0x30cb28(0x2ea)]((_0x36f0bb,_0xc87011)=>{var _0x4c889d=_0x30cb28;_0x9ba8d2[_0xc87011][_0x4c889d(0x24a)]=_0x36f0bb;});const _0x23b7a6=await createLog(_0x30cb28(0x218));_0x1ae7d5[_0x30cb28(0x2ea)]((_0x9e3fb9,_0x19afa4)=>{var _0x18ec94=_0x30cb28;_0x9ba8d2[_0x19afa4][_0x18ec94(0x23e)]=_0x18ec94(0x2f9)+_0x23b7a6['toString']()[_0x18ec94(0x259)](0x8,'0');});const _0x375264=_0x9ba8d2[_0x30cb28(0x242)](_0x445aed=>_0x445aed[_0x30cb28(0x311)]!=='0'&&_0x445aed[_0x30cb28(0x311)]!==''),_0x5ccf55=new purchases_incoming({'invoice':'INC-'+_0x23b7a6[_0x30cb28(0x267)]()[_0x30cb28(0x259)](0x8,'0'),'date':_0x531b8a,'warehouse_name':_0x35aea0,'product':_0x375264,'note':_0x461518,'POnumber':_0x514365,'SCRN':_0x10f521,'ReqBy':_0x29d840,'dateofreq':_0x1b5378,'typeservicesData':_0x4e4ed6,'van':_0x29fec5,'typevehicle':_0x27c8cf,'driver':_0x3994eb,'plate':_0x28da31,'DRSI':_0x1676cc,'TSU':_0xffcb83,'TFU':_0x55a4bc,'typeOfProducts':_0x531c9a}),_0x19c354=await _0x5ccf55[_0x30cb28(0x30a)](),_0x47a6e1=_0x19c354[_0x30cb28(0x31c)][_0x30cb28(0x22e)](async _0x2342d9=>{var _0x34a825=_0x30cb28,_0x4fd854=await warehouse[_0x34a825(0x281)]({'name':_0x35aea0,'room':_0x2342d9[_0x34a825(0x24a)]});if(_0x2342d9[_0x34a825(0x311)]>0x0){var _0x50adb5=0x0;const _0x1f2445=_0x4fd854['product_details']['map'](_0x8d838b=>{var _0x572603=_0x34a825;_0x8d838b['product_name']==_0x2342d9[_0x572603(0x230)]&&_0x8d838b[_0x572603(0x2f5)]==_0x2342d9[_0x572603(0x1fc)]&&_0x8d838b['expiry_date']==_0x2342d9[_0x572603(0x273)]&&_0x8d838b['production_date']==_0x2342d9[_0x572603(0x331)]&&_0x8d838b['batch_code']==_0x2342d9[_0x572603(0x296)]&&_0x8d838b['invoice']==_0x2342d9[_0x572603(0x23e)]&&(typeof _0x2342d9[_0x572603(0x261)]==_0x572603(0x258)?(console['log'](_0x572603(0x32f),_0x8d838b['product_stock']+'\x20<>\x20'+_0x8d838b[_0x572603(0x25e)]+_0x572603(0x328)+Math[_0x572603(0x25a)](_0x8d838b[_0x572603(0x2e5)])+Math[_0x572603(0x25a)](_0x2342d9['to_quantity'])),_0x8d838b['product_stock']=Math[_0x572603(0x25a)](_0x8d838b['product_stock'])+Math[_0x572603(0x25a)](_0x2342d9[_0x572603(0x311)])):(_0x8d838b[_0x572603(0x2e5)]=Math[_0x572603(0x25a)](_0x8d838b[_0x572603(0x2e5)])+Math[_0x572603(0x25a)](_0x2342d9[_0x572603(0x311)]),_0x50adb5++));});_0x50adb5=='0'&&(_0x4fd854[_0x34a825(0x243)]=_0x4fd854[_0x34a825(0x243)][_0x34a825(0x24b)]({'product_name':_0x2342d9[_0x34a825(0x230)],'product_stock':_0x2342d9[_0x34a825(0x311)],'bay':_0x2342d9[_0x34a825(0x2f5)],'level':_0x2342d9['level'],'product_code':_0x2342d9[_0x34a825(0x228)],'primary_code':_0x2342d9[_0x34a825(0x2c7)],'secondary_code':_0x2342d9['secondary_code'],'expiry_date':_0x2342d9['expiry_date'],'production_date':_0x2342d9[_0x34a825(0x331)],'maxProducts':_0x2342d9['maxProducts'],'batch_code':_0x2342d9['batch_code'],'secondary_unit':_0x2342d9[_0x34a825(0x2dc)],'unit':_0x2342d9[_0x34a825(0x20a)],'maxProducts':_0x2342d9[_0x34a825(0x244)],'maxPerUnit':_0x2342d9[_0x34a825(0x2a0)],'invoice':_0x2342d9[_0x34a825(0x23e)]}));}return _0x4fd854;});Promise[_0x30cb28(0x2d9)](_0x47a6e1)['then'](async _0x1657f5=>{var _0x137026=_0x30cb28;try{for(const _0x1ac944 of _0x1657f5){await warehouse[_0x137026(0x214)]({'_id':_0x1ac944[_0x137026(0x25e)]},{'$addToSet':{'product_details':{'$each':_0x1ac944['product_details']}}});}_0x29eaaf[_0x137026(0x215)]=_0x137026(0x32c);const _0x270c1a=await _0x29eaaf[_0x137026(0x30a)](),_0x1554a8=await master_shop['find'](),_0x4a0317=await email_settings['findOne'](),_0x47798f=await supervisor_settings[_0x137026(0x2a6)]();var _0x1e2b63=_0x5ccf55[_0x137026(0x31c)],_0x4df6d2='',_0x497cfb;for(_0x497cfb in _0x1e2b63){var _0x9c8c85='FG';_0x5ccf55['to_warehouse']=='DRY\x20GOODS'&&(_0x9c8c85='DG'),_0x4df6d2+=_0x137026(0x2a9)+_0x137026(0x20c)+_0x1e2b63[_0x497cfb][_0x137026(0x230)]+_0x137026(0x225)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e2b63[_0x497cfb]['product_code']+_0x137026(0x225)+_0x137026(0x20c)+_0x1e2b63[_0x497cfb][_0x137026(0x270)]+_0x137026(0x225)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e2b63[_0x497cfb][_0x137026(0x297)]+'</td>'+_0x137026(0x20c)+_0x1e2b63[_0x497cfb][_0x137026(0x2dc)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ccf55['to_warehouse']+_0x137026(0x225)+_0x137026(0x20c)+_0x1e2b63[_0x497cfb][_0x137026(0x309)]+_0x137026(0x225)+_0x137026(0x20c)+_0x9c8c85+_0x1e2b63[_0x497cfb][_0x137026(0x1fc)]+_0x137026(0x225)+_0x137026(0x26c);}_0x5002ff[_0x137026(0x24f)]('success','Transfer\x20Finalize\x20Successfully'),_0x1d8955[_0x137026(0x1f3)](_0x137026(0x307)+_0x19c354[_0x137026(0x25e)]);}catch(_0x3f21a1){console[_0x137026(0x318)](_0x3f21a1),_0x1d8955[_0x137026(0x26f)](0x1f4)[_0x137026(0x2bf)]({'error':_0x137026(0x2ee)});}})[_0x30cb28(0x330)](_0x3e46a7=>{var _0x2d3d1e=_0x30cb28;console[_0x2d3d1e(0x318)](_0x3e46a7),_0x1d8955[_0x2d3d1e(0x26f)](0x1f4)[_0x2d3d1e(0x2bf)]({'error':_0x2d3d1e(0x2e1)});});}catch(_0x7c8ec3){}}),router[a0_0x154127(0x26b)](a0_0x154127(0x326),auth,async(_0x103a9c,_0x4339e7)=>{var _0x4f6461=a0_0x154127;try{const {warehouse:_0x1c8879}=_0x103a9c[_0x4f6461(0x213)],_0x5ea6cf=await transfers_finished['find']({'to_warehouse':_0x1c8879,'to_recieved':'false'});_0x4339e7['json'](_0x5ea6cf);}catch(_0x3707db){}}),router['post']('/getinvoicetrf',auth,async(_0x2836d7,_0x1a6271)=>{var _0x15ba2e=a0_0x154127;try{const {invoice:_0x14a0cf}=_0x2836d7[_0x15ba2e(0x213)],_0x11d0d4=await transfers_finished[_0x15ba2e(0x2a6)]({'_id':_0x14a0cf,'to_recieved':'false'});_0x1a6271[_0x15ba2e(0x2bf)](_0x11d0d4);}catch(_0x46e09f){}}),router[a0_0x154127(0x223)](a0_0x154127(0x30f),auth,async(_0xf71ae7,_0x5df2a0)=>{var _0xa5cac3=a0_0x154127;try{const {username:_0x3e9e3b,email:_0x2d75b5,role:_0x34b01f}=_0xf71ae7[_0xa5cac3(0x2a2)],_0x4dc080=_0xf71ae7[_0xa5cac3(0x2a2)],_0x4c34a7=await profile['findOne']({'email':_0x4dc080['email']}),_0x422a8b=await staff['findOne']({'email':_0x4dc080[_0xa5cac3(0x2ed)]});if(_0x4dc080['role']==_0xa5cac3(0x1ef)){const _0x11b70c=await staff[_0xa5cac3(0x281)]({'email':_0x4dc080[_0xa5cac3(0x2ed)]});}const _0x586e6b=await master_shop['find']();let _0x4b6be9;if(_0x4dc080[_0xa5cac3(0x29c)]=='staff'){const _0x1b16ff=await staff[_0xa5cac3(0x281)]({'email':_0x4dc080[_0xa5cac3(0x2ed)]});_0x4b6be9=await purchases_finished[_0xa5cac3(0x31a)]([{'$match':{'warehouse_name':_0x1b16ff['warehouse'],'typeOfProducts':_0xa5cac3(0x24e)}},{'$lookup':{'from':'suppliers','localField':_0xa5cac3(0x313),'foreignField':_0xa5cac3(0x25f),'as':_0xa5cac3(0x2ef)}},{'$unwind':_0xa5cac3(0x1f5)},{'$unwind':_0xa5cac3(0x1f1)},{'$group':{'_id':_0xa5cac3(0x237),'invoice':{'$first':_0xa5cac3(0x251)},'suppliers':{'$first':_0xa5cac3(0x278)},'date':{'$first':_0xa5cac3(0x305)},'warehouse_name':{'$first':_0xa5cac3(0x2fe)},'room':{'$first':_0xa5cac3(0x27c)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0xa5cac3(0x217)},'due_amount':{'$first':_0xa5cac3(0x2ae)},'return_data':{'$first':_0xa5cac3(0x241)},'batch_code':{'$first':_0xa5cac3(0x1f6)},'expiry_date':{'$first':_0xa5cac3(0x236)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xa5cac3(0x321)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0xa5cac3(0x2d4)},'floorlevel':{'$addToSet':_0xa5cac3(0x2f6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4b6be9=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0xa5cac3(0x251)},'suppliers':{'$first':_0xa5cac3(0x278)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xa5cac3(0x2fe)},'room':{'$addToSet':_0xa5cac3(0x202)},'product':{'$push':_0xa5cac3(0x1f1)},'note':{'$first':_0xa5cac3(0x2d7)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0xa5cac3(0x2ae)},'return_data':{'$first':_0xa5cac3(0x241)},'batch_code':{'$first':_0xa5cac3(0x1f6)},'expiry_date':{'$first':_0xa5cac3(0x236)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xa5cac3(0x321)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xa5cac3(0x2f6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x586e6b[0x0][_0xa5cac3(0x23b)]==_0xa5cac3(0x212))var _0x93c266=users[_0xa5cac3(0x279)];else{if(_0x586e6b[0x0][_0xa5cac3(0x23b)]=='Hindi')var _0x93c266=users[_0xa5cac3(0x272)];else{if(_0x586e6b[0x0]['language']=='German')var _0x93c266=users[_0xa5cac3(0x31f)];else{if(_0x586e6b[0x0][_0xa5cac3(0x23b)]==_0xa5cac3(0x302))var _0x93c266=users['Spanish'];else{if(_0x586e6b[0x0][_0xa5cac3(0x23b)]==_0xa5cac3(0x2be))var _0x93c266=users[_0xa5cac3(0x2be)];else{if(_0x586e6b[0x0][_0xa5cac3(0x23b)]==_0xa5cac3(0x27a))var _0x93c266=users[_0xa5cac3(0x339)];else{if(_0x586e6b[0x0][_0xa5cac3(0x23b)]=='Chinese')var _0x93c266=users['Chinese'];else{if(_0x586e6b[0x0][_0xa5cac3(0x23b)]==_0xa5cac3(0x2c1))var _0x93c266=users[_0xa5cac3(0x300)];}}}}}}}_0x5df2a0[_0xa5cac3(0x2a1)](_0xa5cac3(0x25b),{'success':_0xf71ae7[_0xa5cac3(0x24f)](_0xa5cac3(0x2a3)),'errors':_0xf71ae7[_0xa5cac3(0x24f)](_0xa5cac3(0x22f)),'purchases':_0x4b6be9,'role':_0x4dc080,'profile':_0x4c34a7,'master_shop':_0x586e6b,'language':_0x93c266});}catch(_0x32ac32){console[_0xa5cac3(0x319)](_0xa5cac3(0x216),_0x32ac32),_0x5df2a0[_0xa5cac3(0x26f)](0xc8)[_0xa5cac3(0x2bf)]({'message':_0x32ac32[_0xa5cac3(0x276)]});}}),router[a0_0x154127(0x223)](a0_0x154127(0x200),auth,async(_0x17fbf4,_0x32edfe)=>{var _0xb5769a=a0_0x154127;try{const {username:_0x38252a,email:_0x140e94,role:_0x4bd3f3}=_0x17fbf4[_0xb5769a(0x2a2)],_0x51fa10=_0x17fbf4[_0xb5769a(0x2a2)],_0x5f23e1=await profile['findOne']({'email':_0x51fa10[_0xb5769a(0x2ed)]}),_0x39b729=await staff[_0xb5769a(0x281)]({'email':_0x51fa10[_0xb5769a(0x2ed)]});if(_0x51fa10[_0xb5769a(0x29c)]==_0xb5769a(0x1ef)){const _0x140d00=await staff[_0xb5769a(0x281)]({'email':_0x51fa10[_0xb5769a(0x2ed)]});}const _0xb7b75d=await master_shop[_0xb5769a(0x2a6)]();let _0x18bb79;if(_0x51fa10[_0xb5769a(0x29c)]==_0xb5769a(0x1ef)){const _0xb28e81=await staff['findOne']({'email':_0x51fa10['email']});_0x18bb79=await purchases_finished[_0xb5769a(0x31a)]([{'$match':{'warehouse_name':_0xb28e81[_0xb5769a(0x27d)]}},{'$lookup':{'from':'suppliers','localField':_0xb5769a(0x313),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0xb5769a(0x1f1)},{'$group':{'_id':_0xb5769a(0x237),'invoice':{'$first':_0xb5769a(0x251)},'suppliers':{'$first':_0xb5769a(0x278)},'date':{'$first':_0xb5769a(0x305)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0xb5769a(0x1f1)},'note':{'$first':_0xb5769a(0x2d7)},'paid_amount':{'$first':_0xb5769a(0x217)},'due_amount':{'$first':_0xb5769a(0x2ae)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0xb5769a(0x1f6)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0xb5769a(0x1f5)},'total_product_quantity':{'$sum':_0xb5769a(0x321)},'level':{'$addToSet':_0xb5769a(0x2f0)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0xb5769a(0x2d4)},'floorlevel':{'$addToSet':_0xb5769a(0x2f6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x18bb79=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0xb5769a(0x29a)}},{'$unwind':_0xb5769a(0x1f1)},{'$group':{'_id':_0xb5769a(0x237),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xb5769a(0x278)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xb5769a(0x2fe)},'room':{'$addToSet':_0xb5769a(0x202)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0xb5769a(0x217)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xb5769a(0x241)},'batch_code':{'$first':_0xb5769a(0x1f6)},'expiry_date':{'$first':_0xb5769a(0x236)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xb5769a(0x321)},'level':{'$addToSet':_0xb5769a(0x2f0)},'isle':{'$addToSet':_0xb5769a(0x20b)},'type':{'$addToSet':_0xb5769a(0x2d4)},'floorlevel':{'$addToSet':_0xb5769a(0x2f6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x212))var _0x15d274=users['English'];else{if(_0xb7b75d[0x0]['language']==_0xb5769a(0x272))var _0x15d274=users[_0xb5769a(0x272)];else{if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x31f))var _0x15d274=users[_0xb5769a(0x31f)];else{if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x302))var _0x15d274=users[_0xb5769a(0x302)];else{if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x2be))var _0x15d274=users[_0xb5769a(0x2be)];else{if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x27a))var _0x15d274=users[_0xb5769a(0x339)];else{if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x2aa))var _0x15d274=users[_0xb5769a(0x2aa)];else{if(_0xb7b75d[0x0][_0xb5769a(0x23b)]==_0xb5769a(0x2c1))var _0x15d274=users['Arabic'];}}}}}}}_0x32edfe[_0xb5769a(0x2a1)](_0xb5769a(0x2d1),{'success':_0x17fbf4[_0xb5769a(0x24f)](_0xb5769a(0x2a3)),'errors':_0x17fbf4[_0xb5769a(0x24f)]('errors'),'purchases':_0x18bb79,'role':_0x51fa10,'profile':_0x5f23e1,'master_shop':_0xb7b75d,'language':_0x15d274});}catch(_0x31fe17){console[_0xb5769a(0x319)](_0xb5769a(0x216),_0x31fe17),_0x32edfe[_0xb5769a(0x26f)](0xc8)[_0xb5769a(0x2bf)]({'message':_0x31fe17[_0xb5769a(0x276)]});}});function BayBinSelected(_0x3415fc,_0x5ef33b){var _0x35850b=a0_0x154127,_0x222216=[],_0x101432=[];if(_0x3415fc==_0x35850b(0x2ad)){switch(_0x5ef33b){case _0x35850b(0x240):_0x222216=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x35850b(0x2e8):_0x222216=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x101432=['DG'];}else{if(_0x3415fc==_0x35850b(0x2bd)){switch(_0x5ef33b){case _0x35850b(0x240):_0x222216=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x35850b(0x2e8):_0x222216=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x101432=['FG'];}}return{'levels':_0x222216,'identify':_0x101432};}async function getRandom8DigitNumber(){var _0x2691bb=a0_0x154127;const _0x3e598b=0x989680,_0x4b9fd2=0x5f5e0ff,_0xa6be40=Math['floor'](Math['random']()*(_0x4b9fd2-_0x3e598b+0x1))+_0x3e598b;var _0x4f6954;const _0x36ff75=await purchases_finished['findOne']({'invoice':_0x2691bb(0x268)+_0xa6be40});return _0x36ff75&&_0x36ff75[_0x2691bb(0x25d)]>0x0?_0x4f6954=_0x2691bb(0x268)+_0xa6be40:_0x4f6954=_0x2691bb(0x268)+_0xa6be40,_0x4f6954;}router['get']('/view/add_purchases',auth,async(_0x3d03ce,_0x48de17)=>{var _0x341209=a0_0x154127;try{const {username:_0x318bd2,email:_0x1276a2,role:_0x57ad03}=_0x3d03ce[_0x341209(0x2a2)],_0x730dd8=_0x3d03ce[_0x341209(0x2a2)],_0x5dc352=await profile[_0x341209(0x281)]({'email':_0x730dd8[_0x341209(0x2ed)]}),_0x3913da=await master_shop[_0x341209(0x2a6)](),_0x1975f6=await staff[_0x341209(0x281)]({'email':_0x730dd8[_0x341209(0x2ed)]}),_0x3d6fff=await suppliers['find']({});let _0x26e593;if(_0x730dd8[_0x341209(0x29c)]==_0x341209(0x1ef)){const _0x37ebdd=await staff['findOne']({'email':_0x730dd8[_0x341209(0x2ed)]});_0x26e593=await warehouse[_0x341209(0x31a)]([{'$match':{'status':_0x341209(0x2c6),'name':_0x37ebdd[_0x341209(0x27d)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x26e593=await warehouse[_0x341209(0x31a)]([{'$match':{'status':_0x341209(0x2c6)}},{'$group':{'_id':_0x341209(0x285),'name':{'$first':_0x341209(0x285)}}}]);const _0x5de447=await product[_0x341209(0x2a6)]({}),_0x5018d2=await warehouse['find']({'status':_0x341209(0x2c6)}),_0x2a088c=await purchases_finished['find']({}),_0x34da10=_0x2a088c[_0x341209(0x25d)]+0x1,_0x81b535=_0x341209(0x268)+_0x34da10['toString']()[_0x341209(0x259)](0x5,'0');var _0x620476=[_0x341209(0x337),_0x341209(0x1ee)];if(_0x3913da[0x0][_0x341209(0x23b)]==_0x341209(0x212))var _0x3018c2=users['English'];else{if(_0x3913da[0x0][_0x341209(0x23b)]==_0x341209(0x272))var _0x3018c2=users['Hindi'];else{if(_0x3913da[0x0][_0x341209(0x23b)]=='German')var _0x3018c2=users['German'];else{if(_0x3913da[0x0][_0x341209(0x23b)]=='Spanish')var _0x3018c2=users[_0x341209(0x302)];else{if(_0x3913da[0x0][_0x341209(0x23b)]==_0x341209(0x2be))var _0x3018c2=users[_0x341209(0x2be)];else{if(_0x3913da[0x0][_0x341209(0x23b)]==_0x341209(0x27a))var _0x3018c2=users['Portuguese'];else{if(_0x3913da[0x0][_0x341209(0x23b)]==_0x341209(0x2aa))var _0x3018c2=users[_0x341209(0x2aa)];else{if(_0x3913da[0x0][_0x341209(0x23b)]==_0x341209(0x2c1))var _0x3018c2=users[_0x341209(0x300)];}}}}}}}const _0x285345=getRandom8DigitNumber(),_0x51a307=new Date(),_0x41b887={'year':'numeric','month':'2-digit','day':_0x341209(0x314),'timeZone':_0x341209(0x263)},_0x84d29=_0x51a307[_0x341209(0x1ea)](_0x341209(0x28f),_0x41b887);console[_0x341209(0x319)](_0x84d29),_0x285345[_0x341209(0x2ec)](_0xc4ad73=>{var _0x4c953f=_0x341209;_0x48de17[_0x4c953f(0x2a1)](_0x4c953f(0x291),{'success':_0x3d03ce['flash'](_0x4c953f(0x2a3)),'errors':_0x3d03ce[_0x4c953f(0x24f)]('errors'),'role':_0x730dd8,'profile':_0x5dc352,'suppliers':_0x3d6fff,'warehouse':_0x26e593,'product':_0x5de447,'invoice':_0xc4ad73,'master_shop':_0x3913da,'language':_0x3018c2,'find_data':_0x5018d2,'rooms_data':_0x620476,'formattedDate':_0x84d29});})['catch'](_0x74acea=>{var _0x1bf41b=_0x341209;_0x3d03ce[_0x1bf41b(0x24f)]('errors',_0x1bf41b(0x22c)),_0x48de17[_0x1bf41b(0x1f3)](_0x1bf41b(0x2f1));});}catch(_0x34a690){console[_0x341209(0x319)](_0x34a690);}}),router[a0_0x154127(0x223)](a0_0x154127(0x298),auth,async(_0xbb3a1,_0x511227)=>{var _0x2eb111=a0_0x154127;try{const {username:_0x18f039,email:_0x246825,role:_0x44e717}=_0xbb3a1[_0x2eb111(0x2a2)],_0x2bcb48=_0xbb3a1['user'],_0x1bc6ce=await profile[_0x2eb111(0x281)]({'email':_0x2bcb48[_0x2eb111(0x2ed)]}),_0x46f586=await master_shop[_0x2eb111(0x2a6)](),_0x38da5f=await staff['findOne']({'email':_0x2bcb48[_0x2eb111(0x2ed)]}),_0x312ef6=await suppliers[_0x2eb111(0x2a6)]({});let _0x5c1395;if(_0x2bcb48['role']==_0x2eb111(0x1ef)){const _0x1aede2=await staff[_0x2eb111(0x281)]({'email':_0x2bcb48[_0x2eb111(0x2ed)]});_0x5c1395=await warehouse[_0x2eb111(0x31a)]([{'$match':{'status':_0x2eb111(0x2c6),'name':_0x1aede2['warehouse']}},{'$group':{'_id':_0x2eb111(0x285),'name':{'$first':_0x2eb111(0x285)}}}]);}else _0x5c1395=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x2eb111(0x285),'name':{'$first':'$name'}}}]);const _0x5c93f6=await product[_0x2eb111(0x2a6)]({}),_0x26e9ea=await warehouse[_0x2eb111(0x2a6)]({'status':_0x2eb111(0x2c6)}),_0x5e9fa0=await purchases_finished['find']({}),_0x54a362=_0x5e9fa0[_0x2eb111(0x25d)]+0x1,_0x2af20f=_0x2eb111(0x268)+_0x54a362[_0x2eb111(0x267)]()['padStart'](0x5,'0');var _0x3468ba=[_0x2eb111(0x337),_0x2eb111(0x1ee)];if(_0x46f586[0x0][_0x2eb111(0x23b)]==_0x2eb111(0x212))var _0x8eb9a3=users[_0x2eb111(0x279)];else{if(_0x46f586[0x0][_0x2eb111(0x23b)]==_0x2eb111(0x272))var _0x8eb9a3=users['Hindi'];else{if(_0x46f586[0x0]['language']=='German')var _0x8eb9a3=users[_0x2eb111(0x31f)];else{if(_0x46f586[0x0]['language']=='Spanish')var _0x8eb9a3=users[_0x2eb111(0x302)];else{if(_0x46f586[0x0][_0x2eb111(0x23b)]==_0x2eb111(0x2be))var _0x8eb9a3=users[_0x2eb111(0x2be)];else{if(_0x46f586[0x0][_0x2eb111(0x23b)]==_0x2eb111(0x27a))var _0x8eb9a3=users[_0x2eb111(0x339)];else{if(_0x46f586[0x0]['language']==_0x2eb111(0x2aa))var _0x8eb9a3=users[_0x2eb111(0x2aa)];else{if(_0x46f586[0x0][_0x2eb111(0x23b)]==_0x2eb111(0x2c1))var _0x8eb9a3=users[_0x2eb111(0x300)];}}}}}}}const _0x2c6408=getRandom8DigitNumber();_0x2c6408[_0x2eb111(0x2ec)](_0x48b442=>{var _0x683c49=_0x2eb111;_0x511227['render'](_0x683c49(0x2f7),{'success':_0xbb3a1[_0x683c49(0x24f)](_0x683c49(0x2a3)),'errors':_0xbb3a1[_0x683c49(0x24f)](_0x683c49(0x22f)),'role':_0x2bcb48,'profile':_0x1bc6ce,'suppliers':_0x312ef6,'warehouse':_0x5c1395,'product':_0x5c93f6,'invoice':_0x48b442,'master_shop':_0x46f586,'language':_0x8eb9a3,'find_data':_0x26e9ea,'rooms_data':_0x3468ba});})['catch'](_0x29bc12=>{var _0x1be345=_0x2eb111;_0xbb3a1[_0x1be345(0x24f)]('errors',_0x1be345(0x22c)),_0x511227['redirect'](_0x1be345(0x2f1));});}catch(_0x1f92bc){console[_0x2eb111(0x319)](_0x1f92bc);}}),router[a0_0x154127(0x223)]('/view/add_purchases/:id',auth,async(_0x2b901a,_0x5aeb8d)=>{var _0x425350=a0_0x154127;try{const _0x3ef9af=_0x2b901a[_0x425350(0x286)]['id'];console[_0x425350(0x319)](_0x3ef9af);const _0x357c0c=await master_shop['find']();console[_0x425350(0x319)](_0x425350(0x2cd),_0x357c0c);const _0x65aae3=await product[_0x425350(0x281)]({'name':_0x3ef9af});console[_0x425350(0x319)](_0x425350(0x31c),_0x65aae3),_0x5aeb8d[_0x425350(0x26f)](0xc8)['json']({'product_data':_0x65aae3,'master':_0x357c0c});}catch(_0x235b07){console[_0x425350(0x319)](_0x425350(0x294),_0x235b07);}}),router[a0_0x154127(0x26b)](a0_0x154127(0x30b),auth,async(_0x3bde19,_0x3f6db9)=>{var _0x202dac=a0_0x154127;try{const {invoice:_0x5a009b,date:_0x316433,warehouse_name:_0xcd6c70,prod_name:_0x5bec73,note:_0x1fdf9a,due_amount:_0x5bd96b,Room_name:_0x1a7c46,PO_number:_0x13214d,SCRN:_0x398a06,ReqBy:_0x3f2918,dateofreq:_0x306bcd,suppliers:_0x48a7df,typeservicesData:_0x5830e6,van:_0x4cd114,typevehicle:_0x20333a,driver:_0xfadf35,plate:_0x3dfc28,DRSI:_0x5cf582,TSU:_0x2937cb,TFU:_0x3c6c55,JO_number:_0x45aca2,type_of_products:_0x1f637a}=_0x3bde19['body'];if(typeof _0x5bec73=='string')var _0x5970fe=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x2da)]],_0x23f753=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x2bc)]],_0x2c9b42=[_0x3bde19[_0x202dac(0x213)]['prod_Qty']],_0x333443=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x2d5)]],_0x2e1c91=[_0x3bde19['body'][_0x202dac(0x28a)]],_0x216b31=[_0x3bde19['body'][_0x202dac(0x2c7)]],_0x4e0e60=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x233)]],_0x1ca29e=[_0x3bde19['body'][_0x202dac(0x2e0)]],_0x257d94=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x296)]],_0x4bb1fa=[_0x3bde19['body'][_0x202dac(0x273)]],_0x1001f7=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x210)]],_0x355968=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x308)]],_0x46f4c3=[_0x3bde19['body'][_0x202dac(0x2fd)]],_0x510e90=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x24c)]],_0x588ca7=[_0x3bde19[_0x202dac(0x213)]['uuid']],_0x5e20f4=[_0x3bde19[_0x202dac(0x213)][_0x202dac(0x290)]],_0x4b3ec8=[_0x3bde19[_0x202dac(0x213)]['product_id']];else var _0x5970fe=[..._0x3bde19[_0x202dac(0x213)]['prod_name']],_0x23f753=[..._0x3bde19[_0x202dac(0x213)][_0x202dac(0x2bc)]],_0x2c9b42=[..._0x3bde19['body'][_0x202dac(0x301)]],_0x333443=[..._0x3bde19[_0x202dac(0x213)]['prod_primunit']],_0x2e1c91=[..._0x3bde19[_0x202dac(0x213)]['prod_secondunit']],_0x216b31=[..._0x3bde19[_0x202dac(0x213)][_0x202dac(0x2c7)]],_0x4e0e60=[..._0x3bde19['body'][_0x202dac(0x233)]],_0x1ca29e=[..._0x3bde19['body'][_0x202dac(0x2e0)]],_0x257d94=[..._0x3bde19[_0x202dac(0x213)][_0x202dac(0x296)]],_0x4bb1fa=[..._0x3bde19[_0x202dac(0x213)][_0x202dac(0x273)]],_0x1001f7=[..._0x3bde19[_0x202dac(0x213)]['product_date']],_0x355968=[..._0x3bde19['body']['max_product_unit']],_0x46f4c3=[..._0x3bde19[_0x202dac(0x213)]['prod_cat']],_0x510e90=[..._0x3bde19[_0x202dac(0x213)][_0x202dac(0x24c)]],_0x588ca7=[..._0x3bde19['body'][_0x202dac(0x2d0)]],_0x5e20f4=[..._0x3bde19[_0x202dac(0x213)]['sales_data_cateory']],_0x4b3ec8=[..._0x3bde19[_0x202dac(0x213)]['product_id']];const _0x1eee04=_0x5970fe['map'](_0xbae4e5=>{return _0xbae4e5={'product_name':_0xbae4e5};});_0x4b3ec8[_0x202dac(0x2ea)]((_0xa991ad,_0x2d6bbc)=>{var _0xe89dc9=_0x202dac;_0x1eee04[_0x2d6bbc][_0xe89dc9(0x239)]=_0xa991ad,_0x1eee04[_0x2d6bbc]['date_recieved']=_0x316433;}),_0x5e20f4['forEach']((_0x2b605f,_0x5deb31)=>{_0x1eee04[_0x5deb31]['sales_category']=_0x2b605f;}),_0x23f753[_0x202dac(0x2ea)]((_0x7233ea,_0x15e25e)=>{var _0xc0c38b=_0x202dac;_0x1eee04[_0x15e25e][_0xc0c38b(0x228)]=_0x7233ea;}),_0x588ca7[_0x202dac(0x2ea)]((_0x496a90,_0x32d24d)=>{var _0x3fc546=_0x202dac;_0x1eee04[_0x32d24d][_0x3fc546(0x2d0)]=_0x496a90;}),_0x2c9b42['forEach']((_0x86a28c,_0xb56360)=>{var _0x2c4bfb=_0x202dac;_0x1eee04[_0xb56360][_0x2c4bfb(0x311)]=Math['abs'](_0x86a28c);}),_0x333443['forEach']((_0x4342ce,_0x5c3a5b)=>{_0x1eee04[_0x5c3a5b]['standard_unit']=_0x4342ce;}),_0x2e1c91[_0x202dac(0x2ea)]((_0x17dfb4,_0x2ff067)=>{var _0x380cda=_0x202dac;_0x1eee04[_0x2ff067][_0x380cda(0x2dc)]=_0x17dfb4;}),_0x216b31[_0x202dac(0x2ea)]((_0x198345,_0xd3488b)=>{var _0x2817aa=_0x202dac;_0x1eee04[_0xd3488b][_0x2817aa(0x2c7)]=_0x198345;}),_0x4e0e60[_0x202dac(0x2ea)]((_0x30409b,_0x214950)=>{var _0xdc8679=_0x202dac;_0x1eee04[_0x214950][_0xdc8679(0x233)]=_0x30409b;}),_0x1ca29e[_0x202dac(0x2ea)]((_0x301f7c,_0x584205)=>{var _0x4b4cfb=_0x202dac;_0x1eee04[_0x584205][_0x4b4cfb(0x2b6)]=_0x301f7c;}),_0x257d94[_0x202dac(0x2ea)]((_0x59cbc9,_0x27dcae)=>{_0x1eee04[_0x27dcae]['batch_code']=_0x59cbc9;}),_0x4bb1fa[_0x202dac(0x2ea)]((_0xa4d6a5,_0x167bd7)=>{var _0x1ec34c=_0x202dac;_0x1eee04[_0x167bd7][_0x1ec34c(0x273)]=_0xa4d6a5;}),_0x1001f7['forEach']((_0x350b43,_0x2ec4f8)=>{var _0xb25fcb=_0x202dac;_0x1eee04[_0x2ec4f8][_0xb25fcb(0x331)]=_0x350b43;}),_0x355968['forEach']((_0x518581,_0xb9f412)=>{var _0x20bf45=_0x202dac;_0x1eee04[_0xb9f412][_0x20bf45(0x2f2)]=_0x518581;}),_0x46f4c3['forEach']((_0x2e6d4e,_0x14da05)=>{var _0x39e350=_0x202dac;_0x1eee04[_0x14da05][_0x39e350(0x304)]=_0x2e6d4e;}),_0x510e90[_0x202dac(0x2ea)]((_0x2d9492,_0x13a81e)=>{var _0x3f87e5=_0x202dac;_0x1eee04[_0x13a81e][_0x3f87e5(0x24c)]=_0x2d9492;});const _0x11f6b3=new invoice_for_incoming();await _0x11f6b3['save']();for(let _0x35e3b2=0x0;_0x35e3b2<=_0x5970fe[_0x202dac(0x25d)]-0x1;_0x35e3b2++){_0x1eee04[_0x35e3b2][_0x202dac(0x23e)]=_0x202dac(0x2f9)+_0x11f6b3['invoice_init'][_0x202dac(0x267)]()[_0x202dac(0x259)](0x8,'0');}const _0x3994a0=await warehouse_validation_setup[_0x202dac(0x31a)]([{'$match':{'warehouse_name':_0xcd6c70}}]);for(let _0x3ff7bf=0x0;_0x3ff7bf<=_0x3994a0['length']-0x1;_0x3ff7bf++){const _0x149799=_0x3994a0[_0x3ff7bf];for(let _0x4fa7fc=0x0;_0x4fa7fc<=_0x149799[_0x202dac(0x333)][_0x202dac(0x25d)]-0x1;_0x4fa7fc++){const _0xb201ff=_0x149799[_0x202dac(0x333)][_0x4fa7fc],_0x410469=await warehouse[_0x202dac(0x31a)]([{'$match':{'name':_0x149799[_0x202dac(0x21f)],'room':_0x149799[_0x202dac(0x2a8)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0xb201ff[_0x202dac(0x2f5)],'product_details.bay':parseInt(_0xb201ff['bin']),'product_details.product_code':_0xb201ff[_0x202dac(0x228)]}}]);for(let _0x5d3343=0x0;_0x5d3343<=_0x410469['length']-0x1;_0x5d3343++){let _0x55e1ce=_0x410469[_0x5d3343],_0x1f2a73=0x0;_0x55e1ce['product_details'][_0x202dac(0x228)]==_0xb201ff[_0x202dac(0x228)]&&_0x55e1ce[_0x202dac(0x243)]['bay']==_0xb201ff[_0x202dac(0x2d8)]&&_0x55e1ce[_0x202dac(0x243)]['level']==_0xb201ff[_0x202dac(0x2f5)]&&(_0xb201ff['max']=parseInt(_0xb201ff[_0x202dac(0x288)])-parseInt(_0x55e1ce[_0x202dac(0x243)][_0x202dac(0x2e5)]),_0x1f2a73++),_0x1f2a73=='0'&&(parseInt(_0xb201ff[_0x202dac(0x288)])>0x0&&(_0x3994a0[_0x3ff7bf][_0x202dac(0x333)]=_0x3994a0[_0x3ff7bf][_0x202dac(0x333)][_0x202dac(0x24b)]({'bay':_0xb201ff[_0x202dac(0x2f5)],'bin':_0xb201ff[_0x202dac(0x2d8)],'max':_0xb201ff[_0x202dac(0x288)],'min':_0xb201ff[_0x202dac(0x26d)],'product_code':_0xb201ff[_0x202dac(0x228)],'product_id':_0xb201ff['product_id'],'product_name':_0xb201ff[_0x202dac(0x230)]})));}}_0x3994a0[_0x3ff7bf][_0x202dac(0x333)]=_0x3994a0[_0x3ff7bf][_0x202dac(0x333)][_0x202dac(0x242)](_0x5477f3=>parseInt(_0x5477f3[_0x202dac(0x288)])>0x0);}for(let _0x21f1e2=0x0;_0x21f1e2<=_0x3994a0[_0x202dac(0x25d)]-0x1;_0x21f1e2++){const _0x2c7bbb=_0x3994a0[_0x21f1e2];for(let _0x23eccf=0x0;_0x23eccf<=_0x2c7bbb[_0x202dac(0x333)][_0x202dac(0x25d)]-0x1;_0x23eccf++){const _0x12f3b8=_0x2c7bbb[_0x202dac(0x333)][_0x23eccf],_0x36d83f=await warehouse_temporary['aggregate']([{'$match':{'warehouse':_0x2c7bbb[_0x202dac(0x21f)],'room_name':_0x2c7bbb['room'],'isConfirm':_0x202dac(0x247),'data_type':_0x202dac(0x224),'product_code':_0x12f3b8[_0x202dac(0x228)],'level':_0x12f3b8['bay'],'bay':parseInt(_0x12f3b8['bin'])}}]);for(let _0x2d650f=0x0;_0x2d650f<=_0x36d83f['length']-0x1;_0x2d650f++){let _0x4e4f28=_0x36d83f[_0x2d650f];console[_0x202dac(0x319)](_0x4e4f28);let _0x2c27ac=0x0;_0x4e4f28[_0x202dac(0x228)]==_0x12f3b8[_0x202dac(0x228)]&&_0x4e4f28[_0x202dac(0x2f5)]==_0x12f3b8[_0x202dac(0x2d8)]&&_0x4e4f28[_0x202dac(0x2d2)]==_0x12f3b8['bay']&&(_0x12f3b8[_0x202dac(0x288)]=parseInt(_0x12f3b8[_0x202dac(0x288)])-parseInt(_0x4e4f28['product_stock']),_0x2c27ac++),_0x2c27ac=='0'&&(parseInt(_0x12f3b8['max'])>0x0&&(_0x3994a0[_0x21f1e2][_0x202dac(0x333)]=_0x3994a0[_0x21f1e2][_0x202dac(0x333)][_0x202dac(0x24b)]({'bay':_0x12f3b8['bay'],'bin':_0x12f3b8[_0x202dac(0x2d8)],'max':_0x12f3b8[_0x202dac(0x288)],'min':_0x12f3b8[_0x202dac(0x26d)],'product_code':_0x12f3b8[_0x202dac(0x228)],'product_id':_0x12f3b8['product_id'],'product_name':_0x12f3b8['product_name']})));}}_0x3994a0[_0x21f1e2][_0x202dac(0x333)]=_0x3994a0[_0x21f1e2][_0x202dac(0x333)]['filter'](_0x204a2b=>parseInt(_0x204a2b['max'])>0x0);}let _0x49cda4=[],_0x2f130f=0x0;for(let _0x28b695=0x0;_0x28b695<=_0x1eee04['length']-0x1;_0x28b695++){const _0x192395=_0x1eee04[_0x28b695];let _0x523a3d=_0x192395[_0x202dac(0x311)];for(let _0x57623a=0x0;_0x57623a<=_0x3994a0[_0x202dac(0x25d)]-0x1;_0x57623a++){const _0x3ede3d=_0x3994a0[_0x57623a];for(let _0x368c9a=0x0;_0x368c9a<=_0x3ede3d['product_data'][_0x202dac(0x25d)]-0x1;_0x368c9a++){const _0x2871ee=_0x3ede3d[_0x202dac(0x333)][_0x368c9a];if(_0x2871ee[_0x202dac(0x228)]===_0x192395[_0x202dac(0x228)]){const _0x2439eb=await warehouse['aggregate']([{'$match':{'name':_0xcd6c70,'room':_0x3ede3d[_0x202dac(0x2a8)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x2871ee[_0x202dac(0x2f5)],'product_details.bay':parseInt(_0x2871ee[_0x202dac(0x2d8)])}}]);if(_0x2439eb[_0x202dac(0x25d)]==0x0){for(let _0x15e7f2=0x0;_0x15e7f2<=_0x3ede3d['product_data']['length']-0x1&&_0x523a3d>0x0;_0x15e7f2++){const _0x584fbf=_0x3ede3d[_0x202dac(0x333)][_0x15e7f2];console[_0x202dac(0x319)](_0x192395[_0x202dac(0x228)]+_0x202dac(0x1fe)+_0x584fbf[_0x202dac(0x228)]+_0x202dac(0x2c9)+_0x584fbf[_0x202dac(0x26d)]+'\x20<>\x20'+_0x584fbf[_0x202dac(0x288)]+_0x202dac(0x2c9)+_0x584fbf['bay']+'\x20<>\x20'+_0x584fbf[_0x202dac(0x2d8)]);if(_0x192395['product_code']===_0x584fbf['product_code']){_0x49cda4[_0x2f130f]={};const _0x3f0af8=parseInt(_0x584fbf[_0x202dac(0x288)]),_0x6b119=0x0;let _0xca6cff=_0x3f0af8-_0x6b119,_0x338e8c=Math[_0x202dac(0x26d)](_0x523a3d,_0xca6cff);console[_0x202dac(0x319)](_0x202dac(0x20f)+_0x338e8c+_0x202dac(0x227)+_0x192395['product_name']+_0x202dac(0x1f8)+_0x3ede3d[_0x202dac(0x21f)]+_0x202dac(0x284)+_0x3ede3d[_0x202dac(0x2a8)]+_0x202dac(0x2ce)+_0x584fbf[_0x202dac(0x2f5)]+_0x202dac(0x1ec)+_0x584fbf['bin']+_0x202dac(0x2b5)+_0x2f130f),_0x49cda4[_0x2f130f][_0x202dac(0x230)]=_0x192395[_0x202dac(0x230)],_0x49cda4[_0x2f130f][_0x202dac(0x228)]=_0x192395['product_code'],_0x49cda4[_0x2f130f]['product_id']=_0x192395[_0x202dac(0x239)],_0x49cda4[_0x2f130f][_0x202dac(0x22d)]=_0x192395[_0x202dac(0x22d)],_0x49cda4[_0x2f130f][_0x202dac(0x27e)]=_0x192395[_0x202dac(0x27e)],_0x49cda4[_0x2f130f]['uuid']=_0x192395[_0x202dac(0x2d0)],_0x49cda4[_0x2f130f][_0x202dac(0x311)]=_0x338e8c,_0x49cda4[_0x2f130f][_0x202dac(0x20a)]=_0x192395[_0x202dac(0x20a)],_0x49cda4[_0x2f130f][_0x202dac(0x2dc)]=_0x192395[_0x202dac(0x2dc)],_0x49cda4[_0x2f130f][_0x202dac(0x2c7)]=_0x192395[_0x202dac(0x2c7)],_0x49cda4[_0x2f130f][_0x202dac(0x233)]=_0x192395[_0x202dac(0x233)],_0x49cda4[_0x2f130f][_0x202dac(0x2b6)]=_0x192395[_0x202dac(0x2b6)],_0x49cda4[_0x2f130f][_0x202dac(0x296)]=_0x192395[_0x202dac(0x296)],_0x49cda4[_0x2f130f][_0x202dac(0x273)]=_0x192395[_0x202dac(0x273)],_0x49cda4[_0x2f130f]['production_date']=_0x192395[_0x202dac(0x331)],_0x49cda4[_0x2f130f][_0x202dac(0x2f2)]=_0x192395[_0x202dac(0x2f2)],_0x49cda4[_0x2f130f][_0x202dac(0x304)]=_0x192395[_0x202dac(0x304)],_0x49cda4[_0x2f130f]['invoice']=_0x192395['invoice'],_0x49cda4[_0x2f130f][_0x202dac(0x24c)]=_0x192395[_0x202dac(0x24c)],_0x49cda4[_0x2f130f][_0x202dac(0x24a)]=_0x3ede3d[_0x202dac(0x2a8)],_0x49cda4[_0x2f130f][_0x202dac(0x2d2)]=_0x584fbf[_0x202dac(0x2f5)],_0x49cda4[_0x2f130f][_0x202dac(0x2f5)]=_0x584fbf[_0x202dac(0x2d8)],_0x523a3d-=_0x338e8c,_0x2f130f++;if(_0x523a3d<=0x0)break;}}if(_0x523a3d<=0x0){_0x3bde19['flash'](_0x202dac(0x22f),'The\x20Other\x20'+_0x523a3d+_0x202dac(0x336));break;}if(_0x523a3d>0x0){console['log'](_0x202dac(0x23a)+_0x523a3d+_0x202dac(0x207));break;}}}}}if(_0x523a3d>0x0){const _0x48bac8=await warehouse['aggregate']([{'$match':{'name':_0xcd6c70,'isStaging':_0x202dac(0x32c)}}]);_0x49cda4[_0x2f130f]={},_0x49cda4[_0x2f130f][_0x202dac(0x230)]=_0x192395['product_name'],_0x49cda4[_0x2f130f][_0x202dac(0x228)]=_0x192395[_0x202dac(0x228)],_0x49cda4[_0x2f130f][_0x202dac(0x239)]=_0x192395[_0x202dac(0x239)],_0x49cda4[_0x2f130f][_0x202dac(0x22d)]=_0x192395[_0x202dac(0x22d)],_0x49cda4[_0x2f130f][_0x202dac(0x27e)]=_0x192395[_0x202dac(0x27e)],_0x49cda4[_0x2f130f][_0x202dac(0x2d0)]=_0x192395[_0x202dac(0x2d0)],_0x49cda4[_0x2f130f][_0x202dac(0x311)]=_0x523a3d,_0x49cda4[_0x2f130f][_0x202dac(0x20a)]=_0x192395[_0x202dac(0x20a)],_0x49cda4[_0x2f130f]['secondary_unit']=_0x192395[_0x202dac(0x2dc)],_0x49cda4[_0x2f130f][_0x202dac(0x2c7)]=_0x192395['primary_code'],_0x49cda4[_0x2f130f][_0x202dac(0x233)]=_0x192395[_0x202dac(0x233)],_0x49cda4[_0x2f130f][_0x202dac(0x2b6)]=_0x192395[_0x202dac(0x2b6)],_0x49cda4[_0x2f130f][_0x202dac(0x296)]=_0x192395[_0x202dac(0x296)],_0x49cda4[_0x2f130f][_0x202dac(0x273)]=_0x192395[_0x202dac(0x273)],_0x49cda4[_0x2f130f][_0x202dac(0x331)]=_0x192395[_0x202dac(0x331)],_0x49cda4[_0x2f130f][_0x202dac(0x2f2)]=_0x192395[_0x202dac(0x2f2)],_0x49cda4[_0x2f130f][_0x202dac(0x304)]=_0x192395['product_cat'],_0x49cda4[_0x2f130f]['invoice']=_0x192395[_0x202dac(0x23e)],_0x49cda4[_0x2f130f][_0x202dac(0x24c)]=_0x192395[_0x202dac(0x24c)],_0x49cda4[_0x2f130f][_0x202dac(0x24a)]=_0x48bac8[0x0][_0x202dac(0x2a8)],_0x49cda4[_0x2f130f]['level']=_0x202dac(0x2fa),_0x49cda4[_0x2f130f][_0x202dac(0x2f5)]='1',console[_0x202dac(0x319)](_0x202dac(0x26e)+_0x202dac(0x2c9)+_0x192395[_0x202dac(0x228)]+'\x20===\x20'+_0x192395['product_code']+_0x202dac(0x2c9)+_0x2f130f+_0x202dac(0x2c9)+_0x523a3d),_0x3bde19['flash'](_0x202dac(0x22f),_0x202dac(0x30e)+_0x523a3d+_0x202dac(0x2eb));}}const _0x3f043c=_0x49cda4[_0x202dac(0x242)](_0x267a47=>_0x267a47[_0x202dac(0x311)]!=='0'&&_0x267a47[_0x202dac(0x311)]!==''),_0x241a22=new purchases_finished({'invoice':'INC-'+_0x11f6b3[_0x202dac(0x2ac)][_0x202dac(0x267)]()['padStart'](0x8,'0'),'suppliers':_0x48a7df,'date':_0x316433,'warehouse_name':_0xcd6c70,'product':_0x3f043c,'note':_0x1fdf9a,'due_amount':_0x5bd96b,'room':_0x1a7c46,'POnumber':_0x13214d,'SCRN':_0x398a06,'JO_number':_0x45aca2,'ReqBy':_0x3f2918,'dateofreq':_0x306bcd,'typeservicesData':_0x5830e6,'van':_0x4cd114,'typevehicle':_0x20333a,'driver':_0xfadf35,'plate':_0x3dfc28,'DRSI':_0x5cf582,'TSU':_0x2937cb,'TFU':_0x3c6c55,'typeOfProducts':_0x1f637a}),_0x1a912d=await _0x241a22[_0x202dac(0x30a)](),_0xaf0c5=await purchases_finished[_0x202dac(0x281)]({'_id':_0x1a912d[_0x202dac(0x25e)][_0x202dac(0x23d)]()});_0x3bde19[_0x202dac(0x24f)](_0x202dac(0x2a3),'purchase\x20data\x20add\x20successfully'),_0x3f6db9[_0x202dac(0x1f3)](_0x202dac(0x254)+_0xaf0c5['_id'][_0x202dac(0x23d)]());}catch(_0x3c0790){console['log'](_0x3c0790);}}),router[a0_0x154127(0x223)](a0_0x154127(0x29b),auth,async(_0x4d7736,_0x4f442f)=>{var _0x57aed=a0_0x154127;try{const {username:_0x119ead,email:_0x2c40cd,role:_0x337e75}=_0x4d7736['user'],_0x91db23=_0x4d7736[_0x57aed(0x2a2)],_0x2ed8b8=_0x4d7736[_0x57aed(0x286)]['id'],_0x1bbf4a=await profile[_0x57aed(0x281)]({'email':_0x91db23[_0x57aed(0x2ed)]}),_0x181df3=await master_shop[_0x57aed(0x2a6)](),_0x54a56f=await staff[_0x57aed(0x281)]({'email':_0x91db23[_0x57aed(0x2ed)]}),_0x36bf33=await suppliers[_0x57aed(0x2a6)]({});let _0x22f6ca;if(_0x91db23[_0x57aed(0x29c)]==_0x57aed(0x1ef)){const _0x5b1e2e=await staff[_0x57aed(0x281)]({'email':_0x91db23['email']});_0x22f6ca=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x5b1e2e[_0x57aed(0x27d)]}},{'$group':{'_id':_0x57aed(0x285),'name':{'$first':_0x57aed(0x285)}}}]);}else _0x22f6ca=await warehouse['aggregate']([{'$match':{'status':_0x57aed(0x2c6)}},{'$group':{'_id':_0x57aed(0x285),'name':{'$first':_0x57aed(0x285)}}}]);const _0x13237b=await purchases_finished['findById'](_0x2ed8b8);if(_0x181df3[0x0][_0x57aed(0x23b)]==_0x57aed(0x212))var _0x414d17=users[_0x57aed(0x279)];else{if(_0x181df3[0x0]['language']==_0x57aed(0x272))var _0x414d17=users['Hindi'];else{if(_0x181df3[0x0]['language']==_0x57aed(0x31f))var _0x414d17=users[_0x57aed(0x31f)];else{if(_0x181df3[0x0][_0x57aed(0x23b)]==_0x57aed(0x302))var _0x414d17=users[_0x57aed(0x302)];else{if(_0x181df3[0x0][_0x57aed(0x23b)]=='French')var _0x414d17=users[_0x57aed(0x2be)];else{if(_0x181df3[0x0][_0x57aed(0x23b)]==_0x57aed(0x27a))var _0x414d17=users['Portuguese'];else{if(_0x181df3[0x0]['language']==_0x57aed(0x2aa))var _0x414d17=users[_0x57aed(0x2aa)];else{if(_0x181df3[0x0][_0x57aed(0x23b)]==_0x57aed(0x2c1))var _0x414d17=users[_0x57aed(0x300)];}}}}}}}_0x4f442f[_0x57aed(0x2a1)](_0x57aed(0x329),{'success':_0x4d7736[_0x57aed(0x24f)](_0x57aed(0x2a3)),'errors':_0x4d7736[_0x57aed(0x24f)]('errors'),'role':_0x91db23,'profile':_0x1bbf4a,'suppliers':_0x36bf33,'warehouse':_0x22f6ca,'master_shop':_0x181df3,'language':_0x414d17,'purchases_data':_0x13237b});}catch(_0x2eb475){console[_0x57aed(0x319)](_0x2eb475);}});async function get_warehouse_data(_0x470357,_0xb65eee){var _0x488e6a=a0_0x154127;try{const _0x52f3ee=await warehouse_temporary[_0x488e6a(0x281)]({'name':_0x470357,'room':_0xb65eee});if(!_0x52f3ee){const _0x1a88e4=new warehouse_temporary({'name':_0x470357,'address':_0x470357,'status':_0x488e6a(0x2c6),'room':_0xb65eee,'isStaging':_0x488e6a(0x247)});return await _0x1a88e4[_0x488e6a(0x30a)](),_0x1a88e4;}else return _0x52f3ee;}catch(_0x595553){console[_0x488e6a(0x318)](_0x488e6a(0x289),_0x595553);throw _0x595553;}}router['post'](a0_0x154127(0x29b),auth,async(_0x1f2f44,_0x5549bd)=>{var _0x478179=a0_0x154127;try{const _0xf98e8c=_0x1f2f44[_0x478179(0x286)]['id'],_0xfcd96=await purchases_finished[_0x478179(0x2b8)](_0xf98e8c);let _0x560ea4=[];_0xfcd96[_0x478179(0x31c)][_0x478179(0x2ea)]((_0x2c5ed7,_0x2b310c)=>{var _0x455ead=_0x478179;_0x560ea4[_0x2b310c]={},_0x560ea4[_0x2b310c][_0x455ead(0x27d)]=_0xfcd96['warehouse_name'],_0x560ea4[_0x2b310c][_0x455ead(0x239)]=_0x2c5ed7[_0x455ead(0x239)],_0x560ea4[_0x2b310c]['product_name']=_0x2c5ed7[_0x455ead(0x230)],_0x560ea4[_0x2b310c]['product_code']=_0x2c5ed7['product_code'],_0x560ea4[_0x2b310c][_0x455ead(0x2e5)]=_0x2c5ed7[_0x455ead(0x311)],_0x560ea4[_0x2b310c][_0x455ead(0x297)]=_0x2c5ed7[_0x455ead(0x20a)],_0x560ea4[_0x2b310c][_0x455ead(0x2dc)]=_0x2c5ed7[_0x455ead(0x2dc)],_0x560ea4[_0x2b310c][_0x455ead(0x2d2)]=_0x2c5ed7[_0x455ead(0x2d2)],_0x560ea4[_0x2b310c]['bay']=_0x2c5ed7['bay'],_0x560ea4[_0x2b310c]['primary_code']=_0x2c5ed7[_0x455ead(0x2c7)],_0x560ea4[_0x2b310c][_0x455ead(0x233)]=_0x2c5ed7[_0x455ead(0x233)],_0x560ea4[_0x2b310c][_0x455ead(0x2b6)]=_0x2c5ed7[_0x455ead(0x2b6)],_0x560ea4[_0x2b310c][_0x455ead(0x296)]=_0x2c5ed7['batch_code'],_0x560ea4[_0x2b310c][_0x455ead(0x273)]=_0x2c5ed7[_0x455ead(0x273)],_0x560ea4[_0x2b310c][_0x455ead(0x331)]=_0x2c5ed7['production_date'],_0x560ea4[_0x2b310c][_0x455ead(0x2f2)]=_0x2c5ed7[_0x455ead(0x2f2)],_0x560ea4[_0x2b310c]['product_cat']=_0x2c5ed7[_0x455ead(0x304)],_0x560ea4[_0x2b310c][_0x455ead(0x24a)]=_0x2c5ed7[_0x455ead(0x24a)],_0x560ea4[_0x2b310c][_0x455ead(0x23e)]=_0x2c5ed7['invoice'],_0x560ea4[_0x2b310c][_0x455ead(0x2d0)]=_0x2c5ed7[_0x455ead(0x2d0)],_0x560ea4[_0x2b310c][_0x455ead(0x24c)]=_0x2c5ed7['gross_price'],_0x560ea4[_0x2b310c][_0x455ead(0x27e)]=_0x2c5ed7[_0x455ead(0x27e)],_0x560ea4[_0x2b310c][_0x455ead(0x22d)]=_0x2c5ed7['date_recieved'],_0x560ea4[_0x2b310c]['purchases_id']=_0x2c5ed7[_0x455ead(0x25e)][_0x455ead(0x23d)](),_0x560ea4[_0x2b310c][_0x455ead(0x332)]=_0x455ead(0x224),_0x560ea4[_0x2b310c][_0x455ead(0x2b9)]='true',_0x560ea4[_0x2b310c][_0x455ead(0x29d)]='false';});for(let _0x135e90=0x0;_0x135e90<=_0x560ea4[_0x478179(0x25d)]-0x1;_0x135e90++){const _0x20cd37=_0x560ea4[_0x135e90],_0x539fab=new warehouse_temporary(_0x20cd37);await _0x539fab['save']();}_0xfcd96['isProcess']=_0x478179(0x32c),await _0xfcd96[_0x478179(0x30a)](),_0x1f2f44[_0x478179(0x24f)](_0x478179(0x2a3),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x5549bd['redirect']('/all_purchases_finished/process/'+_0xfcd96[_0x478179(0x25e)][_0x478179(0x23d)]());}catch(_0x483534){}}),router[a0_0x154127(0x26b)]('/view/add_purchases_logs',auth,async(_0x330b4e,_0x4a4b95)=>{var _0x57a029=a0_0x154127;try{const {invoice:_0x54492f,date:_0x13dd91,warehouse_name:_0x384f2f,prod_name:_0x8f40d,note:_0x4e6786,due_amount:_0x332e14,Room_name:_0x11fed2,PO_number:_0x1ab766,SCRN:_0x14a59c,ReqBy:_0x1fcb6f,dateofreq:_0x23d44d,suppliers:_0x653b75,typeservicesData:_0x51cbf3,van:_0x5e11f2,typevehicle:_0x540fef,driver:_0x109006,plate:_0x5eba43,DRSI:_0x22cca0,TSU:_0x675c90,TFU:_0x26d7f6,JO_number:_0x479974,type_of_products:_0x47bebb}=_0x330b4e['body'];if(typeof _0x8f40d==_0x57a029(0x32d))var _0x303d77=[_0x330b4e[_0x57a029(0x213)]['prod_name']],_0x3bde27=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x2bc)]],_0x378b70=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x301)]],_0x157546=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x2d5)]],_0x534e62=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x28a)]],_0x537282=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x325)]],_0x530308=[_0x330b4e['body']['primary_code']],_0x2a87e3=[_0x330b4e[_0x57a029(0x213)]['secondary_code']],_0x58bed7=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x2e0)]],_0x50a482=[_0x330b4e['body'][_0x57a029(0x296)]],_0x235a56=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x273)]],_0x945f3c=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x210)]],_0x324525=[_0x330b4e['body'][_0x57a029(0x308)]],_0x37ca3d=[_0x330b4e[_0x57a029(0x213)]['prod_cat']],_0x37b515=[_0x330b4e['body'][_0x57a029(0x26a)]],_0x3632c1=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x24c)]],_0x1d03a3=[_0x330b4e[_0x57a029(0x213)][_0x57a029(0x2d0)]],_0x5aa573=[_0x330b4e['body'][_0x57a029(0x290)]],_0x57fd34=[_0x330b4e['body']['type_of_products_type']];else var _0x303d77=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x2da)]],_0x3bde27=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x2bc)]],_0x378b70=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x301)]],_0x157546=[..._0x330b4e['body'][_0x57a029(0x2d5)]],_0x534e62=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x28a)]],_0x537282=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x325)]],_0x530308=[..._0x330b4e[_0x57a029(0x213)]['primary_code']],_0x2a87e3=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x233)]],_0x58bed7=[..._0x330b4e[_0x57a029(0x213)]['MaxStocks_data']],_0x50a482=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x296)]],_0x235a56=[..._0x330b4e[_0x57a029(0x213)]['expiry_date']],_0x945f3c=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x210)]],_0x324525=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x308)]],_0x37ca3d=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x2fd)]],_0x37b515=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x26a)]],_0x3632c1=[..._0x330b4e[_0x57a029(0x213)]['gross_price']],_0x1d03a3=[..._0x330b4e['body'][_0x57a029(0x2d0)]],_0x5aa573=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x290)]],_0x57fd34=[..._0x330b4e[_0x57a029(0x213)][_0x57a029(0x2b7)]];const _0x20ea8e=_0x303d77[_0x57a029(0x22e)](_0xadbd67=>{return _0xadbd67={'product_name':_0xadbd67};});_0x57fd34[_0x57a029(0x2ea)]((_0x349a23,_0x3ab2f9)=>{var _0x3d48d5=_0x57a029;_0x20ea8e[_0x3ab2f9][_0x3d48d5(0x2d3)]=_0x349a23;}),_0x5aa573['forEach']((_0x4320ac,_0x2e4efe)=>{var _0x3d2a8b=_0x57a029;_0x20ea8e[_0x2e4efe][_0x3d2a8b(0x27e)]=_0x4320ac;}),_0x3bde27['forEach']((_0x221caa,_0x4c4d89)=>{var _0x3405d5=_0x57a029;_0x20ea8e[_0x4c4d89][_0x3405d5(0x228)]=_0x221caa;}),_0x1d03a3[_0x57a029(0x2ea)]((_0x7feb6b,_0xe220cb)=>{var _0x3481b5=_0x57a029;_0x20ea8e[_0xe220cb][_0x3481b5(0x2d0)]=_0x7feb6b;}),_0x378b70[_0x57a029(0x2ea)]((_0x4fbea2,_0x2982ac)=>{var _0x473955=_0x57a029;_0x20ea8e[_0x2982ac][_0x473955(0x311)]=Math[_0x473955(0x25a)](_0x4fbea2);}),_0x157546[_0x57a029(0x2ea)]((_0x2a1373,_0x3bdd47)=>{var _0x186160=_0x57a029;_0x20ea8e[_0x3bdd47][_0x186160(0x20a)]=_0x2a1373;}),_0x534e62[_0x57a029(0x2ea)]((_0x2eaa60,_0x3cd483)=>{var _0x1d0789=_0x57a029;_0x20ea8e[_0x3cd483][_0x1d0789(0x2dc)]=_0x2eaa60;}),_0x537282[_0x57a029(0x2ea)]((_0x499e03,_0x28ded6)=>{var _0x89445a=_0x57a029,_0x482d28=_0x499e03[_0x89445a(0x21c)](/[A-Za-z]+/)[0x0],_0x8204d7=parseInt(_0x499e03[_0x89445a(0x21c)](/\d+/)[0x0]);_0x20ea8e[_0x28ded6][_0x89445a(0x2d2)]=_0x482d28,_0x20ea8e[_0x28ded6][_0x89445a(0x2f5)]=_0x8204d7;}),_0x530308['forEach']((_0x3f735d,_0x1bfe71)=>{var _0x37c292=_0x57a029;_0x20ea8e[_0x1bfe71][_0x37c292(0x2c7)]=_0x3f735d;}),_0x2a87e3[_0x57a029(0x2ea)]((_0x235a39,_0x188ca4)=>{_0x20ea8e[_0x188ca4]['secondary_code']=_0x235a39;}),_0x58bed7['forEach']((_0x5e095b,_0x4abf73)=>{_0x20ea8e[_0x4abf73]['maxStocks']=_0x5e095b;}),_0x50a482[_0x57a029(0x2ea)]((_0x56da01,_0x3c107b)=>{var _0x1c1a3a=_0x57a029;_0x20ea8e[_0x3c107b][_0x1c1a3a(0x296)]=_0x56da01;}),_0x235a56[_0x57a029(0x2ea)]((_0x30aaa4,_0x3e9247)=>{var _0x53b451=_0x57a029;_0x20ea8e[_0x3e9247][_0x53b451(0x273)]=_0x30aaa4;}),_0x945f3c[_0x57a029(0x2ea)]((_0x59578b,_0x57f615)=>{_0x20ea8e[_0x57f615]['production_date']=_0x59578b;}),_0x324525[_0x57a029(0x2ea)]((_0x1c80d3,_0x4d81c2)=>{var _0x46cd69=_0x57a029;_0x20ea8e[_0x4d81c2][_0x46cd69(0x2f2)]=_0x1c80d3;}),_0x37ca3d['forEach']((_0x3effe8,_0x328c16)=>{var _0x3b5a14=_0x57a029;_0x20ea8e[_0x328c16][_0x3b5a14(0x304)]=_0x3effe8;}),_0x37b515[_0x57a029(0x2ea)]((_0x22823a,_0x4ae759)=>{var _0x5ef7e7=_0x57a029;_0x20ea8e[_0x4ae759][_0x5ef7e7(0x24a)]=_0x22823a;}),_0x3632c1[_0x57a029(0x2ea)]((_0x49397f,_0xb505df)=>{var _0xd6c05c=_0x57a029;_0x20ea8e[_0xb505df][_0xd6c05c(0x24c)]=_0x49397f;});const _0x4fb5a9=new purchases_logs();await _0x4fb5a9[_0x57a029(0x30a)]();for(let _0x11476a=0x0;_0x11476a<=_0x37b515[_0x57a029(0x25d)]-0x1;_0x11476a++){_0x20ea8e[_0x11476a][_0x57a029(0x23e)]=_0x57a029(0x2cf)+_0x4fb5a9[_0x57a029(0x2ac)]['toString']()[_0x57a029(0x259)](0x8,'0');}const _0x11d127=_0x20ea8e[_0x57a029(0x242)](_0x13798a=>_0x13798a[_0x57a029(0x311)]!=='0'&&_0x13798a[_0x57a029(0x311)]!==''),_0x422cb9=new purchases_finished({'invoice':_0x57a029(0x2cf)+_0x4fb5a9[_0x57a029(0x2ac)][_0x57a029(0x267)]()[_0x57a029(0x259)](0x8,'0'),'suppliers':_0x653b75,'date':_0x13dd91,'warehouse_name':_0x384f2f,'product':_0x11d127,'note':_0x4e6786,'due_amount':_0x332e14,'room':_0x11fed2,'POnumber':_0x1ab766,'SCRN':_0x14a59c,'JO_number':_0x479974,'ReqBy':_0x1fcb6f,'dateofreq':_0x23d44d,'typeservicesData':_0x51cbf3,'van':_0x5e11f2,'typevehicle':_0x540fef,'driver':_0x109006,'plate':_0x5eba43,'DRSI':_0x22cca0,'TSU':_0x675c90,'TFU':_0x26d7f6,'typeOfProducts':_0x47bebb}),_0x390bea=await _0x422cb9[_0x57a029(0x30a)](),_0x25452b=await purchases_finished[_0x57a029(0x281)]({'_id':_0x390bea[_0x57a029(0x25e)][_0x57a029(0x23d)]()}),_0x2c83d7=_0x25452b[_0x57a029(0x31c)]['map'](async _0x3861df=>{var _0x2f6a4d=_0x57a029;try{var _0x15ac53=await warehouse[_0x2f6a4d(0x281)]({'name':_0x384f2f,'room':_0x3861df[_0x2f6a4d(0x24a)]}),_0xcb8f09=0x0;const _0x8c9eea=_0x15ac53[_0x2f6a4d(0x243)][_0x2f6a4d(0x22e)](_0x2f4644=>{var _0x361f2d=_0x2f6a4d;console['log'](_0x2f4644['product_name']+'=='+_0x3861df[_0x361f2d(0x230)]+'&&'+_0x2f4644['bay']+'=='+_0x3861df['bay']+'&&'+_0x2f4644[_0x361f2d(0x273)]+'=='+_0x3861df[_0x361f2d(0x273)]+'&&'+_0x2f4644['production_date']+'=='+_0x3861df['production_date']+'&&'+_0x2f4644[_0x361f2d(0x296)]+'=='+_0x3861df['batch_code']+'&&'+_0x2f4644[_0x361f2d(0x23e)]+'=='+_0x25452b['invoice']),_0x2f4644['product_name']==_0x3861df[_0x361f2d(0x230)]&&_0x2f4644[_0x361f2d(0x2f5)]==_0x3861df[_0x361f2d(0x2f5)]&&_0x2f4644[_0x361f2d(0x2d2)]==_0x3861df[_0x361f2d(0x2d2)]&&_0x2f4644[_0x361f2d(0x273)]==_0x3861df[_0x361f2d(0x273)]&&_0x2f4644[_0x361f2d(0x331)]==_0x3861df[_0x361f2d(0x331)]&&_0x2f4644[_0x361f2d(0x296)]==_0x3861df[_0x361f2d(0x296)]&&_0x2f4644[_0x361f2d(0x23e)]==_0x25452b['invoice']&&(_0x2f4644[_0x361f2d(0x2e5)]=Math[_0x361f2d(0x25a)](_0x2f4644[_0x361f2d(0x2e5)])+Math[_0x361f2d(0x25a)](_0x3861df['quantity']),_0xcb8f09++);});return _0xcb8f09==0x0&&(_0x15ac53[_0x2f6a4d(0x243)]=_0x15ac53['product_details'][_0x2f6a4d(0x24b)]({'product_name':_0x3861df[_0x2f6a4d(0x230)],'product_stock':Math[_0x2f6a4d(0x25a)](_0x3861df[_0x2f6a4d(0x311)]),'primary_code':_0x3861df[_0x2f6a4d(0x2c7)],'secondary_code':_0x3861df[_0x2f6a4d(0x233)],'product_code':_0x3861df[_0x2f6a4d(0x228)],'bay':_0x3861df[_0x2f6a4d(0x2f5)],'level':_0x3861df['level'],'maxProducts':_0x3861df[_0x2f6a4d(0x2b6)],'unit':_0x3861df[_0x2f6a4d(0x20a)],'secondary_unit':_0x3861df['secondary_unit'],'expiry_date':_0x3861df[_0x2f6a4d(0x273)],'production_date':_0x3861df[_0x2f6a4d(0x331)],'maxProducts':_0x3861df['maxStocks'],'maxPerUnit':_0x3861df[_0x2f6a4d(0x2f2)],'batch_code':_0x3861df['batch_code'],'product_cat':_0x3861df['product_cat'],'invoice':_0x3861df[_0x2f6a4d(0x23e)],'id_incoming':_0x3861df[_0x2f6a4d(0x25e)],'uuid':_0x3861df[_0x2f6a4d(0x2d0)],'gross_price':_0x3861df[_0x2f6a4d(0x24c)],'sales_category':_0x3861df[_0x2f6a4d(0x27e)],'type_products':_0x3861df[_0x2f6a4d(0x2d3)]})),_0x15ac53;}catch(_0x52d75c){return console[_0x2f6a4d(0x318)](_0x2f6a4d(0x31b),_0x52d75c),null;}});Promise[_0x57a029(0x2d9)](_0x2c83d7)[_0x57a029(0x2ec)](async _0xedae69=>{var _0x4a50a3=_0x57a029;try{for(const _0xbd8db3 of _0xedae69){await warehouse[_0x4a50a3(0x214)]({'_id':_0xbd8db3[_0x4a50a3(0x25e)]},{'$addToSet':{'product_details':{'$each':_0xbd8db3[_0x4a50a3(0x243)]}}});}const _0x797234=await master_shop['find'](),_0x4a3466=await email_settings['findOne'](),_0xe213d0=await supervisor_settings[_0x4a50a3(0x2a6)]();var _0x1e1b8e=_0x25452b[_0x4a50a3(0x31c)],_0x48ac9a='',_0x8f5f9c;for(_0x8f5f9c in _0x1e1b8e){var _0x404075='FG';_0x25452b['warehouse_name']==_0x4a50a3(0x2ad)&&(_0x404075='DG'),_0x48ac9a+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e1b8e[_0x8f5f9c][_0x4a50a3(0x230)]+_0x4a50a3(0x225)+_0x4a50a3(0x20c)+_0x1e1b8e[_0x8f5f9c][_0x4a50a3(0x228)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e1b8e[_0x8f5f9c]['quantity']+_0x4a50a3(0x225)+_0x4a50a3(0x20c)+_0x1e1b8e[_0x8f5f9c][_0x4a50a3(0x20a)]+_0x4a50a3(0x225)+_0x4a50a3(0x20c)+_0x1e1b8e[_0x8f5f9c]['secondary_unit']+_0x4a50a3(0x225)+_0x4a50a3(0x20c)+_0x25452b[_0x4a50a3(0x21f)]+'</td>'+_0x4a50a3(0x20c)+_0x1e1b8e[_0x8f5f9c]['room_name']+_0x4a50a3(0x225)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x404075+_0x1e1b8e[_0x8f5f9c][_0x4a50a3(0x2f5)]+_0x4a50a3(0x225),_0x4a50a3(0x26c);}let _0x536be4=nodemailer[_0x4a50a3(0x2e7)]({'host':_0x4a3466[_0x4a50a3(0x31d)],'port':Number(_0x4a3466[_0x4a50a3(0x2df)]),'secure':![],'auth':{'user':_0x4a3466[_0x4a50a3(0x2ed)],'pass':_0x4a3466['password']}}),_0x3fa5e7={'from':_0x4a3466[_0x4a50a3(0x2ed)],'to':_0xe213d0[0x0][_0x4a50a3(0x226)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x4a50a3(0x1fd),'path':__dirname+_0x4a50a3(0x234)+'/upload/'+_0x797234[0x0][_0x4a50a3(0x324)],'cid':_0x4a50a3(0x2a7)}],'html':_0x4a50a3(0x2f8)+_0x4a50a3(0x249)+_0x4a50a3(0x32a)+_0x4a50a3(0x21b)+_0x4a50a3(0x219)+_0x4a50a3(0x21b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x4a50a3(0x21b)+_0x4a50a3(0x335)+_0x797234[0x0][_0x4a50a3(0x208)]+_0x4a50a3(0x22a)+_0x4a50a3(0x295)+_0x4a50a3(0x295)+_0x4a50a3(0x264)+_0x4a50a3(0x21b)+_0x4a50a3(0x327)+'\x20Order\x20Number\x20:\x20'+_0x25452b[_0x4a50a3(0x23e)]+'\x20'+_0x4a50a3(0x22b)+'\x20Order\x20Date\x20:\x20'+_0x25452b[_0x4a50a3(0x28c)]+'\x20'+_0x4a50a3(0x320)+_0x4a50a3(0x205)+_0x4a50a3(0x295)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4a50a3(0x250)+_0x4a50a3(0x2a9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4a50a3(0x206)+_0x4a50a3(0x2c3)+_0x4a50a3(0x257)+_0x4a50a3(0x2b3)+_0x4a50a3(0x2ba)+_0x4a50a3(0x317)+_0x4a50a3(0x322)+'</tr>'+_0x4a50a3(0x209)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x48ac9a+'\x20'+_0x4a50a3(0x201)+'</table>'+_0x4a50a3(0x21b)+_0x4a50a3(0x1f9)+_0x4a50a3(0x231)+_0x797234[0x0][_0x4a50a3(0x208)]+'</h5>'+_0x4a50a3(0x295)+_0x4a50a3(0x295)+_0x4a50a3(0x2c4)};_0x536be4['sendMail'](_0x3fa5e7,function(_0xd8684f,_0xd8a6cb){var _0x268af7=_0x4a50a3;_0xd8684f?(console[_0x268af7(0x319)](_0xd8684f),console[_0x268af7(0x319)]('Error\x20Occurs')):console[_0x268af7(0x319)](_0x268af7(0x292));});}catch(_0x4073f2){console[_0x4a50a3(0x318)](_0x4073f2),_0x4a4b95[_0x4a50a3(0x26f)](0x1f4)[_0x4a50a3(0x2bf)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x4073f2[_0x4a50a3(0x276)]});}})[_0x57a029(0x330)](_0x3a428e=>{var _0x3aa3fa=_0x57a029;console[_0x3aa3fa(0x318)](_0x3a428e);}),_0x330b4e[_0x57a029(0x24f)](_0x57a029(0x2a3),_0x57a029(0x25c)),_0x4a4b95[_0x57a029(0x1f3)](_0x57a029(0x1fa)+_0x25452b[_0x57a029(0x25e)]['valueOf']());}catch(_0xc277ba){console[_0x57a029(0x319)](_0xc277ba);}}),router[a0_0x154127(0x223)](a0_0x154127(0x245),auth,async(_0x27e05f,_0x23fadb)=>{var _0x5959fc=a0_0x154127;try{const {username:_0x231746,email:_0x4d4484,role:_0x14968b}=_0x27e05f[_0x5959fc(0x2a2)],_0x5c57c8=_0x27e05f[_0x5959fc(0x2a2)],_0x3d35d9=await profile[_0x5959fc(0x281)]({'email':_0x5c57c8[_0x5959fc(0x2ed)]}),_0x128070=await master_shop[_0x5959fc(0x2a6)](),_0x701052=_0x27e05f['params']['id'],_0x495cae=await purchases_finished['findById'](_0x701052),_0x4f7994=await suppliers[_0x5959fc(0x2a6)]({});let _0x5cd42f;if(_0x5c57c8['role']=='staff'){const _0x5ea376=await staff['findOne']({'email':_0x5c57c8[_0x5959fc(0x2ed)]});_0x5cd42f=await warehouse['find']({'status':'Enabled','name':_0x5ea376[_0x5959fc(0x27d)],'warehouse_category':_0x5959fc(0x28e)});}else _0x5cd42f=await warehouse[_0x5959fc(0x31a)]([{'$match':{'status':_0x5959fc(0x2c6),'warehouse_category':_0x5959fc(0x28e)}},{'$group':{'_id':'$name','name':{'$first':_0x5959fc(0x285)}}}]);const _0x23ebe5=await product[_0x5959fc(0x2a6)]({}),_0x3c59a5=BayBinSelected(_0x495cae[_0x5959fc(0x21f)],_0x495cae[_0x5959fc(0x2a8)]);let _0x559b5a=new Date(_0x495cae[_0x5959fc(0x273)]),_0x5a8518=('0'+_0x559b5a['getDate']())[_0x5959fc(0x2ff)](-0x2),_0x2ddc0f=('0'+(_0x559b5a[_0x5959fc(0x283)]()+0x1))[_0x5959fc(0x2ff)](-0x2),_0xe6d5e=_0x559b5a[_0x5959fc(0x255)](),_0x2bbfe9=_0xe6d5e+'-'+_0x2ddc0f+'-'+_0x5a8518;if(_0x128070[0x0][_0x5959fc(0x23b)]=='English\x20(US)'){var _0x453a5e=users[_0x5959fc(0x279)];console[_0x5959fc(0x319)](_0x453a5e);}else{if(_0x128070[0x0][_0x5959fc(0x23b)]==_0x5959fc(0x272))var _0x453a5e=users[_0x5959fc(0x272)];else{if(_0x128070[0x0][_0x5959fc(0x23b)]=='German')var _0x453a5e=users[_0x5959fc(0x31f)];else{if(_0x128070[0x0]['language']==_0x5959fc(0x302))var _0x453a5e=users[_0x5959fc(0x302)];else{if(_0x128070[0x0][_0x5959fc(0x23b)]==_0x5959fc(0x2be))var _0x453a5e=users[_0x5959fc(0x2be)];else{if(_0x128070[0x0][_0x5959fc(0x23b)]==_0x5959fc(0x27a))var _0x453a5e=users[_0x5959fc(0x339)];else{if(_0x128070[0x0]['language']==_0x5959fc(0x2aa))var _0x453a5e=users['Chinese'];else{if(_0x128070[0x0][_0x5959fc(0x23b)]==_0x5959fc(0x2c1))var _0x453a5e=users[_0x5959fc(0x300)];}}}}}}}_0x23fadb[_0x5959fc(0x2a1)]('edit_purchases_finished_view',{'success':_0x27e05f[_0x5959fc(0x24f)](_0x5959fc(0x2a3)),'errors':_0x27e05f['flash'](_0x5959fc(0x22f)),'role':_0x5c57c8,'profile':_0x3d35d9,'purchases':_0x495cae,'suppliers':_0x4f7994,'warehouse':_0x5cd42f,'product':_0x23ebe5,'master_shop':_0x128070,'language':_0x453a5e,'ed_fullDate':_0x2bbfe9,'dataSelected':_0x3c59a5});}catch(_0x586305){console[_0x5959fc(0x319)](_0x586305);}}),router[a0_0x154127(0x223)](a0_0x154127(0x20e),auth,async(_0x187400,_0x5b7b27)=>{var _0x3f20d1=a0_0x154127;try{const {username:_0x578179,email:_0x4aca8c,role:_0x1ec20c}=_0x187400['user'],_0x37ef9e=_0x187400[_0x3f20d1(0x2a2)],_0x4b5665=await profile[_0x3f20d1(0x281)]({'email':_0x37ef9e['email']}),_0x14fb4a=await master_shop['find'](),_0x212c9f=_0x187400[_0x3f20d1(0x286)]['id'],_0x594fcc=await purchases_finished[_0x3f20d1(0x2b8)](_0x212c9f),_0xb8220b=await suppliers[_0x3f20d1(0x2a6)]({});let _0x31a203;if(_0x37ef9e[_0x3f20d1(0x29c)]==_0x3f20d1(0x1ef)){const _0x437d18=await staff[_0x3f20d1(0x281)]({'email':_0x37ef9e[_0x3f20d1(0x2ed)]});_0x31a203=await warehouse[_0x3f20d1(0x2a6)]({'status':'Enabled','name':_0x437d18['warehouse'],'warehouse_category':_0x3f20d1(0x28e)});}else _0x31a203=await warehouse[_0x3f20d1(0x31a)]([{'$match':{'status':_0x3f20d1(0x2c6),'warehouse_category':_0x3f20d1(0x28e)}},{'$group':{'_id':_0x3f20d1(0x285),'name':{'$first':_0x3f20d1(0x285)}}}]);const _0x5831df=await product['find']({}),_0x2603f3=BayBinSelected(_0x594fcc[_0x3f20d1(0x21f)],_0x594fcc[_0x3f20d1(0x2a8)]);let _0x2e4832=new Date(_0x594fcc[_0x3f20d1(0x273)]),_0x3001c4=('0'+_0x2e4832[_0x3f20d1(0x246)]())[_0x3f20d1(0x2ff)](-0x2),_0x4006d6=('0'+(_0x2e4832[_0x3f20d1(0x283)]()+0x1))[_0x3f20d1(0x2ff)](-0x2),_0x3cc07d=_0x2e4832[_0x3f20d1(0x255)](),_0xe718f1=_0x3cc07d+'-'+_0x4006d6+'-'+_0x3001c4;if(_0x14fb4a[0x0]['language']==_0x3f20d1(0x212)){var _0x5620ab=users[_0x3f20d1(0x279)];console['log'](_0x5620ab);}else{if(_0x14fb4a[0x0][_0x3f20d1(0x23b)]==_0x3f20d1(0x272))var _0x5620ab=users['Hindi'];else{if(_0x14fb4a[0x0]['language']==_0x3f20d1(0x31f))var _0x5620ab=users['German'];else{if(_0x14fb4a[0x0]['language']==_0x3f20d1(0x302))var _0x5620ab=users[_0x3f20d1(0x302)];else{if(_0x14fb4a[0x0][_0x3f20d1(0x23b)]==_0x3f20d1(0x2be))var _0x5620ab=users[_0x3f20d1(0x2be)];else{if(_0x14fb4a[0x0][_0x3f20d1(0x23b)]==_0x3f20d1(0x27a))var _0x5620ab=users[_0x3f20d1(0x339)];else{if(_0x14fb4a[0x0][_0x3f20d1(0x23b)]==_0x3f20d1(0x2aa))var _0x5620ab=users[_0x3f20d1(0x2aa)];else{if(_0x14fb4a[0x0][_0x3f20d1(0x23b)]=='Arabic\x20(ae)')var _0x5620ab=users[_0x3f20d1(0x300)];}}}}}}}_0x5b7b27['render'](_0x3f20d1(0x2b2),{'success':_0x187400['flash']('success'),'errors':_0x187400[_0x3f20d1(0x24f)](_0x3f20d1(0x22f)),'role':_0x37ef9e,'profile':_0x4b5665,'purchases':_0x594fcc,'suppliers':_0xb8220b,'warehouse':_0x31a203,'product':_0x5831df,'master_shop':_0x14fb4a,'language':_0x5620ab,'ed_fullDate':_0xe718f1,'dataSelected':_0x2603f3});}catch(_0x4d87f1){console[_0x3f20d1(0x319)](_0x4d87f1);}}),router['post'](a0_0x154127(0x20e),auth,async(_0x58dd2b,_0x50f522)=>{var _0x225f58=a0_0x154127;try{const _0x4a0d54=_0x58dd2b[_0x225f58(0x286)]['id'],_0x15e064=await purchases_finished[_0x225f58(0x281)]({'_id':_0x58dd2b[_0x225f58(0x286)]['id']}),_0x1ed86f=await warehouse['findOne']({'name':_0x15e064[_0x225f58(0x21f)],'room':_0x15e064[_0x225f58(0x2a8)]});_0x15e064[_0x225f58(0x31c)][_0x225f58(0x2ea)](_0x589886=>{var _0x4c032a=_0x225f58;const _0x22a41d=_0x1ed86f[_0x4c032a(0x243)][_0x4c032a(0x22e)](_0x42cc6a=>{var _0x3a1d17=_0x4c032a;_0x42cc6a[_0x3a1d17(0x230)]==_0x589886['product_name']&&_0x42cc6a[_0x3a1d17(0x2f5)]==_0x589886[_0x3a1d17(0x2f5)]&&(_0x42cc6a[_0x3a1d17(0x2e5)]=parseInt(_0x42cc6a[_0x3a1d17(0x2e5)])-parseInt(_0x589886[_0x3a1d17(0x311)]));});}),await _0x1ed86f['save']();const {invoice:_0x6fb9b5,suppliers:_0x156c41,date:_0x1bde51,warehouse_name:_0x228c83,prod_name:_0x393c2d,prod_code:_0x3ed42c,prod_qty:_0x3de368,prod_unit:_0x13254b,prod_secondunit:_0x2e0f70,prod_level:_0x1cdb9d,prod_isle:_0xdb07fe,prod_pallet:_0x33ad68,note:_0x709e0d,expiry_date:_0x16f812,batch_code:_0xc8433,paid_amount:_0x50bf1e,due_amount:_0x48810a,Room_name:_0x4c1b03,primary_code:_0x2a37c3,secondary_code:_0x437bab,PO_number:_0x3f04bf,JO_number:_0x44a717}=_0x58dd2b['body'];if(typeof _0x393c2d==_0x225f58(0x32d))var _0x4e6c2a=[_0x58dd2b[_0x225f58(0x213)]['prod_name']],_0x3615ad=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x2bc)]],_0x5024d4=[_0x58dd2b['body'][_0x225f58(0x23f)]],_0x1bd020=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x29f)]],_0xb5ba10=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x28a)]],_0xd7a057=[_0x58dd2b['body'][_0x225f58(0x325)]],_0x1be759=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x2c7)]],_0x3308a6=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x233)]],_0x3c9ada=[_0x58dd2b[_0x225f58(0x213)]['MaxStocks_data']],_0x262dee=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x296)]],_0x145598=[_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x273)]];else var _0x4e6c2a=[..._0x58dd2b['body'][_0x225f58(0x2da)]],_0x3615ad=[..._0x58dd2b[_0x225f58(0x213)][_0x225f58(0x2bc)]],_0x5024d4=[..._0x58dd2b['body'][_0x225f58(0x23f)]],_0x1bd020=[..._0x58dd2b[_0x225f58(0x213)][_0x225f58(0x29f)]],_0xb5ba10=[..._0x58dd2b[_0x225f58(0x213)][_0x225f58(0x28a)]],_0xd7a057=[..._0x58dd2b[_0x225f58(0x213)][_0x225f58(0x325)]],_0x1be759=[..._0x58dd2b[_0x225f58(0x213)]['primary_code']],_0x3308a6=[..._0x58dd2b['body'][_0x225f58(0x233)]],_0x3c9ada=[..._0x58dd2b[_0x225f58(0x213)]['MaxStocks_data']],_0x262dee=[..._0x58dd2b[_0x225f58(0x213)][_0x225f58(0x296)]],_0x145598=[..._0x58dd2b[_0x225f58(0x213)][_0x225f58(0x273)]];const _0x5efa55=_0x4e6c2a[_0x225f58(0x22e)](_0x123baa=>{return _0x123baa={'product_name':_0x123baa};});_0x3615ad[_0x225f58(0x2ea)]((_0x8b4166,_0x3f0e3a)=>{var _0x3369c8=_0x225f58;_0x5efa55[_0x3f0e3a][_0x3369c8(0x228)]=_0x8b4166;}),_0x5024d4[_0x225f58(0x2ea)]((_0x6f4b18,_0x150ed9)=>{var _0x1590b0=_0x225f58;_0x5efa55[_0x150ed9][_0x1590b0(0x311)]=_0x6f4b18;}),_0x1bd020[_0x225f58(0x2ea)]((_0x559729,_0x465644)=>{var _0x31c6fc=_0x225f58;_0x5efa55[_0x465644][_0x31c6fc(0x20a)]=_0x559729;}),_0xb5ba10['forEach']((_0x13a847,_0x4abe92)=>{var _0x58abab=_0x225f58;_0x5efa55[_0x4abe92][_0x58abab(0x2dc)]=_0x13a847;}),_0xd7a057[_0x225f58(0x2ea)]((_0xa1b3df,_0x13a742)=>{var _0x381f0d=_0x225f58;_0x5efa55[_0x13a742][_0x381f0d(0x2f5)]=_0xa1b3df;}),_0x1be759[_0x225f58(0x2ea)]((_0x49ee83,_0x45a806)=>{_0x5efa55[_0x45a806]['primary_code']=_0x49ee83;}),_0x3308a6[_0x225f58(0x2ea)]((_0x1f3d8d,_0x74fc4)=>{var _0xab038d=_0x225f58;_0x5efa55[_0x74fc4][_0xab038d(0x233)]=_0x1f3d8d;}),_0x3c9ada[_0x225f58(0x2ea)]((_0xee283d,_0x3e0593)=>{_0x5efa55[_0x3e0593]['maxStocks']=_0xee283d;}),_0x262dee[_0x225f58(0x2ea)]((_0x2ae9a6,_0x7ebfd5)=>{var _0x4da94d=_0x225f58;_0x5efa55[_0x7ebfd5][_0x4da94d(0x296)]=_0x2ae9a6;}),_0x145598['forEach']((_0xe372cf,_0x473a21)=>{var _0x163e91=_0x225f58;_0x5efa55[_0x473a21][_0x163e91(0x273)]=_0xe372cf;});const _0x40d29b=_0x5efa55[_0x225f58(0x242)](_0x1fbc20=>_0x1fbc20['quantity']!=='0'&&_0x1fbc20[_0x225f58(0x311)]!=='');_0x15e064[_0x225f58(0x23e)]=_0x6fb9b5,_0x15e064[_0x225f58(0x313)]=_0x156c41,_0x15e064[_0x225f58(0x28c)]=_0x1bde51,_0x15e064['warehouse_name']=_0x228c83,_0x15e064[_0x225f58(0x31c)]=_0x40d29b,_0x15e064[_0x225f58(0x30c)]=_0x709e0d,_0x15e064[_0x225f58(0x30d)]=_0x50bf1e,_0x15e064[_0x225f58(0x32b)]=_0x48810a,_0x15e064[_0x225f58(0x2a8)]=_0x4c1b03,_0x15e064['POnumber']=_0x3f04bf,_0x15e064['JO_number']=_0x44a717;const _0x259406=await _0x15e064[_0x225f58(0x30a)](),_0xbafa20=await warehouse[_0x225f58(0x281)]({'name':_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x21f)],'room':_0x58dd2b['body'][_0x225f58(0x269)]});_0x15e064['product'][_0x225f58(0x2ea)](_0x374dcc=>{var _0x4d23b1=_0x225f58,_0x45df95=0x0;const _0x532928=_0xbafa20['product_details']['map'](_0xf2d882=>{var _0x506dee=a0_0x1daa;_0xf2d882[_0x506dee(0x230)]==_0x374dcc[_0x506dee(0x230)]&&_0xf2d882[_0x506dee(0x2f5)]==_0x374dcc[_0x506dee(0x2f5)]&&(_0xf2d882[_0x506dee(0x2e5)]=parseInt(_0xf2d882['product_stock'])+parseInt(_0x374dcc[_0x506dee(0x311)]),_0x45df95++);});_0x45df95=='0'&&(_0xbafa20['product_details']=_0xbafa20[_0x4d23b1(0x243)][_0x4d23b1(0x24b)]({'product_name':_0x374dcc[_0x4d23b1(0x230)],'product_stock':_0x374dcc[_0x4d23b1(0x311)],'primary_code':_0x374dcc[_0x4d23b1(0x2c7)],'secondary_code':_0x374dcc[_0x4d23b1(0x233)],'product_code':_0x374dcc[_0x4d23b1(0x228)],'bay':_0x374dcc['bay'],'maxProducts':_0x374dcc[_0x4d23b1(0x2b6)],'unit':_0x374dcc[_0x4d23b1(0x20a)],'secondary_unit':_0x374dcc[_0x4d23b1(0x2dc)],'expiry_date':_0x374dcc[_0x4d23b1(0x273)]}));}),await _0xbafa20['save']();const _0x195f69=await s_payment_data[_0x225f58(0x281)]({'invoice':_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x23e)]});if(_0x195f69===null){}else console[_0x225f58(0x319)](_0x225f58(0x313),_0x195f69,_0x58dd2b[_0x225f58(0x213)][_0x225f58(0x23e)]),_0x195f69['suppliers']=_0x58dd2b['body']['suppliers'],await _0x195f69['save']();_0x58dd2b['flash'](_0x225f58(0x2a3),_0x225f58(0x20d)),_0x50f522[_0x225f58(0x1f3)](_0x225f58(0x2f1));}catch(_0x4c4e6f){console[_0x225f58(0x319)](_0x4c4e6f);}}),router[a0_0x154127(0x26b)]('/give_payment/:id',auth,async(_0x586918,_0x3e927f)=>{var _0x52e7ca=a0_0x154127;try{const _0x1cbc22=_0x586918[_0x52e7ca(0x286)]['id'],{invoice:_0x2921f1,suppliers:_0x3939ca,payable:_0x1e6b24,due_amount:_0xf303e3}=_0x586918[_0x52e7ca(0x213)],_0x2e6193=await purchases[_0x52e7ca(0x2b8)](_0x1cbc22);var _0x3afaf4=_0x1e6b24-_0xf303e3;_0x2e6193['paid_amount']=parseFloat(_0x2e6193[_0x52e7ca(0x30d)])+parseFloat(_0xf303e3),_0x2e6193[_0x52e7ca(0x32b)]=_0x3afaf4;const _0xe83d57=await _0x2e6193['save']();console['log'](_0xe83d57);const _0x412c41=await s_payment_data[_0x52e7ca(0x281)]({'invoice':_0x2921f1});_0x412c41['amount']=_0x3afaf4,await _0x412c41[_0x52e7ca(0x30a)]();let _0xdfa41=new Date(),_0x2afcd2=('0'+_0xdfa41['getDate']())[_0x52e7ca(0x2ff)](-0x2),_0x3397c3=('0'+(_0xdfa41[_0x52e7ca(0x283)]()+0x1))['slice'](-0x2),_0xd9a115=_0xdfa41[_0x52e7ca(0x255)](),_0x25de74=_0xd9a115+'-'+_0x3397c3+'-'+_0x2afcd2;const _0x2676d1=new suppliers_payment({'invoice':_0x2921f1,'date':_0xd9a115+'-'+_0x3397c3+'-'+_0x2afcd2,'suppliers':_0x3939ca,'reason':_0x52e7ca(0x2c2),'amount':_0xf303e3}),_0x42a643=await _0x2676d1[_0x52e7ca(0x30a)]();_0x586918['flash'](_0x52e7ca(0x2a3),_0x52e7ca(0x2b0)),_0x3e927f[_0x52e7ca(0x1f3)]('/all_purchases/view');}catch(_0x140373){console[_0x52e7ca(0x319)](_0x140373);}}),router[a0_0x154127(0x223)](a0_0x154127(0x1e9),auth,async(_0x8b896,_0x59ec2c)=>{var _0x574658=a0_0x154127;try{const {username:_0x55a982,email:_0x43e9aa,role:_0x47e0e5}=_0x8b896[_0x574658(0x2a2)],_0x42c772=_0x8b896[_0x574658(0x2a2)],_0x41147e=await profile[_0x574658(0x281)]({'email':_0x42c772[_0x574658(0x2ed)]}),_0x25c66d=await master_shop['find']();console[_0x574658(0x319)](_0x574658(0x2cd),_0x25c66d);const _0x581340=_0x8b896[_0x574658(0x286)]['id'],_0x2ca56a=await purchases[_0x574658(0x2b8)](_0x581340);console[_0x574658(0x319)](_0x2ca56a);const _0x4cdf73=await suppliers[_0x574658(0x281)]({'name':_0x2ca56a[_0x574658(0x313)]});console['log'](_0x4cdf73);if(_0x25c66d[0x0][_0x574658(0x23b)]=='English\x20(US)'){var _0x3c3500=users['English'];console[_0x574658(0x319)](_0x3c3500);}else{if(_0x25c66d[0x0][_0x574658(0x23b)]==_0x574658(0x272))var _0x3c3500=users['Hindi'];else{if(_0x25c66d[0x0][_0x574658(0x23b)]==_0x574658(0x31f))var _0x3c3500=users[_0x574658(0x31f)];else{if(_0x25c66d[0x0][_0x574658(0x23b)]=='Spanish')var _0x3c3500=users[_0x574658(0x302)];else{if(_0x25c66d[0x0][_0x574658(0x23b)]==_0x574658(0x2be))var _0x3c3500=users[_0x574658(0x2be)];else{if(_0x25c66d[0x0][_0x574658(0x23b)]==_0x574658(0x27a))var _0x3c3500=users[_0x574658(0x339)];else{if(_0x25c66d[0x0][_0x574658(0x23b)]==_0x574658(0x2aa))var _0x3c3500=users[_0x574658(0x2aa)];else{if(_0x25c66d[0x0][_0x574658(0x23b)]==_0x574658(0x2c1))var _0x3c3500=users[_0x574658(0x300)];}}}}}}}_0x59ec2c['render']('purchase_invoice',{'success':_0x8b896['flash']('success'),'errors':_0x8b896['flash'](_0x574658(0x22f)),'role':_0x42c772,'profile':_0x41147e,'master_shop':_0x25c66d,'supplier':_0x4cdf73,'purchase':_0x2ca56a,'language':_0x3c3500});}catch(_0x1056f4){console[_0x574658(0x319)](_0x1056f4);}}),router[a0_0x154127(0x223)](a0_0x154127(0x260),auth,async(_0x51e29e,_0x58b19c)=>{var _0x13207b=a0_0x154127;try{const {username:_0xbe522b,email:_0x4be23a,role:_0x508bcb}=_0x51e29e[_0x13207b(0x2a2)],_0xbf0b10=_0x51e29e['user'],_0x58d5ea=await profile[_0x13207b(0x281)]({'email':_0xbf0b10[_0x13207b(0x2ed)]}),_0x3eb0f4=await master_shop[_0x13207b(0x2a6)]();console[_0x13207b(0x319)](_0x13207b(0x2cd),_0x3eb0f4);const _0x15d63d=_0x51e29e[_0x13207b(0x286)]['id'];console[_0x13207b(0x319)](_0x15d63d);const _0x5dabd6=await purchases_finished[_0x13207b(0x2b8)](_0x15d63d);console[_0x13207b(0x319)](_0x13207b(0x316),_0x5dabd6);const _0x47b040=await product[_0x13207b(0x2a6)]({}),_0x19fbf8=await warehouse[_0x13207b(0x31a)]([{'$match':{'name':_0x5dabd6[_0x13207b(0x21f)],'room':_0x5dabd6[_0x13207b(0x2a8)]}},{'$unwind':_0x13207b(0x2ca)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x13207b(0x334)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x13207b(0x338)},'bin':{'$first':_0x13207b(0x220)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x13207b(0x28b)},'primary_code':{'$first':_0x13207b(0x2a5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x13207b(0x29e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x13207b(0x2e9)}}}]);console[_0x13207b(0x319)](_0x13207b(0x1e8),_0x19fbf8);let _0x455bd0;if(_0xbf0b10[_0x13207b(0x29c)]==_0x13207b(0x1ef)){const _0x2c8d40=await staff[_0x13207b(0x281)]({'email':_0xbf0b10['email']});_0x455bd0=await warehouse['find']({'status':_0x13207b(0x2c6),'name':_0x2c8d40['warehouse'],'warehouse_category':'Finished\x20Goods','name':_0x13207b(0x229)});}else _0x455bd0=await warehouse[_0x13207b(0x31a)]([{'$match':{'status':_0x13207b(0x2c6),'warehouse_category':_0x13207b(0x28e),'name':'Return\x20Goods'}},{'$group':{'_id':_0x13207b(0x285),'name':{'$first':'$name'}}}]);if(_0x3eb0f4[0x0][_0x13207b(0x23b)]==_0x13207b(0x212)){var _0x4cd9fa=users[_0x13207b(0x279)];console[_0x13207b(0x319)](_0x4cd9fa);}else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]==_0x13207b(0x272))var _0x4cd9fa=users[_0x13207b(0x272)];else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]=='German')var _0x4cd9fa=users['German'];else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]=='Spanish')var _0x4cd9fa=users['Spanish'];else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]==_0x13207b(0x2be))var _0x4cd9fa=users[_0x13207b(0x2be)];else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]=='Portuguese\x20(BR)')var _0x4cd9fa=users[_0x13207b(0x339)];else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]==_0x13207b(0x2aa))var _0x4cd9fa=users[_0x13207b(0x2aa)];else{if(_0x3eb0f4[0x0][_0x13207b(0x23b)]=='Arabic\x20(ae)')var _0x4cd9fa=users[_0x13207b(0x300)];}}}}}}}_0x58b19c['render'](_0x13207b(0x23c),{'success':_0x51e29e['flash'](_0x13207b(0x2a3)),'errors':_0x51e29e[_0x13207b(0x24f)](_0x13207b(0x22f)),'role':_0xbf0b10,'profile':_0x58d5ea,'user':_0x5dabd6,'stock':_0x19fbf8,'master_shop':_0x3eb0f4,'product':_0x47b040,'language':_0x4cd9fa,'warehouse':_0x455bd0});}catch(_0x123c87){console[_0x13207b(0x319)](_0x123c87);}}),router[a0_0x154127(0x26b)](a0_0x154127(0x260),auth,async(_0x1497e1,_0x29e92d)=>{var _0x3bde9f=a0_0x154127;try{const {invoice:_0x2d3185,date:_0x5bbb4a,warehouse_name:_0x42a773,Room_name:_0x36c23a,product_name:_0x4f3f6d,purchase_quantity:_0x39ec1b,stocks:_0xea5d1a,return_qty:_0x514746,note:_0x50b993,level:_0x50994c,isle:_0x581c4e,pallet:_0x4fcf5f,to_warehouse_name:_0x16b758,to_Room_name:_0x440cd9}=_0x1497e1['body'],_0x3b02ba=await purchases_finished[_0x3bde9f(0x281)]({'_id':_0x1497e1[_0x3bde9f(0x286)]['id']}),_0x44230e=await warehouse['findOne']({'name':_0x42a773,'room':_0x36c23a,'warehouse_category':_0x3bde9f(0x28e)});if(typeof _0x4f3f6d==_0x3bde9f(0x32d))var _0x54b9a4=[_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x230)]],_0x3377e9=[_0x1497e1['body']['purchase_quantity']],_0x34246e=[_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x280)]],_0x1d2f17=[_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x1ed)]],_0x4950c5=[_0x1497e1[_0x3bde9f(0x213)]['level']],_0x3be5b9=[_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x2db)]],_0x39e197=[_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x1f7)]],_0x4ac707=[_0x1497e1['body'][_0x3bde9f(0x1f0)]];else var _0x54b9a4=[..._0x1497e1['body'][_0x3bde9f(0x230)]],_0x3377e9=[..._0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x27f)]],_0x34246e=[..._0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x280)]],_0x1d2f17=[..._0x1497e1['body'][_0x3bde9f(0x1ed)]],_0x4950c5=[..._0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x2d2)]],_0x3be5b9=[..._0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x2db)]],_0x39e197=[..._0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x1f7)]],_0x4ac707=[..._0x1497e1['body'][_0x3bde9f(0x1f0)]];const _0x5a491f=_0x54b9a4[_0x3bde9f(0x22e)](_0x1cc767=>{return _0x1cc767={'product_name':_0x1cc767};});_0x3377e9[_0x3bde9f(0x2ea)]((_0x1125c7,_0x4928e8)=>{var _0x45df08=_0x3bde9f;_0x5a491f[_0x4928e8][_0x45df08(0x27f)]=_0x1125c7;}),_0x34246e[_0x3bde9f(0x2ea)]((_0x26d064,_0x2862a8)=>{_0x5a491f[_0x2862a8]['stock_quantity']=_0x26d064;}),_0x1d2f17[_0x3bde9f(0x2ea)]((_0x504beb,_0x26c42b)=>{var _0x160b13=_0x3bde9f;_0x5a491f[_0x26c42b][_0x160b13(0x1ed)]=_0x504beb;}),_0x4950c5[_0x3bde9f(0x2ea)]((_0x423dd8,_0x1090fd)=>{_0x5a491f[_0x1090fd]['bay']=_0x423dd8;}),_0x3be5b9[_0x3bde9f(0x2ea)]((_0x229dbd,_0x552f7c)=>{var _0x378b21=_0x3bde9f;_0x5a491f[_0x552f7c][_0x378b21(0x228)]=_0x229dbd;}),_0x39e197[_0x3bde9f(0x2ea)]((_0x15f1bc,_0xba4e78)=>{var _0x4369ff=_0x3bde9f;_0x5a491f[_0xba4e78][_0x4369ff(0x2c7)]=_0x15f1bc;}),_0x4ac707['forEach']((_0x332630,_0x4aabb1)=>{_0x5a491f[_0x4aabb1]['secondary_code']=_0x332630;}),_0x5a491f['forEach'](_0x4824a6=>{var _0x240100=_0x3bde9f;console['log'](_0x4824a6);const _0x124d41=_0x44230e[_0x240100(0x243)][_0x240100(0x22e)](_0x4b9d53=>{var _0x4cd896=_0x240100;_0x4b9d53[_0x4cd896(0x230)]==_0x4824a6[_0x4cd896(0x230)]&&_0x4b9d53[_0x4cd896(0x2f5)]==_0x4824a6[_0x4cd896(0x2f5)]&&(console['log'](parseInt(_0x4b9d53[_0x4cd896(0x2e5)])+_0x4cd896(0x2c9)+parseInt(_0x4824a6['return_qty'])),_0x4b9d53[_0x4cd896(0x2e5)]=parseInt(_0x4b9d53[_0x4cd896(0x2e5)])-parseInt(_0x4824a6[_0x4cd896(0x1ed)]));});}),await _0x44230e[_0x3bde9f(0x30a)]();var _0x1db8f7=0x0;_0x5a491f[_0x3bde9f(0x2ea)](_0x69a648=>{var _0x560979=_0x3bde9f;(parseInt(_0x69a648[_0x560979(0x27f)])<parseInt(_0x69a648['return_qty'])||parseInt(_0x69a648[_0x560979(0x2f4)])<parseInt(_0x69a648[_0x560979(0x1ed)]))&&_0x1db8f7++;});if(_0x1db8f7!=0x0)return _0x1497e1[_0x3bde9f(0x24f)]('errors',_0x3bde9f(0x2f3)),_0x29e92d[_0x3bde9f(0x1f3)](_0x3bde9f(0x2ab));const _0x2ac7df=new purchases_return_finished({'invoice':_0x2d3185,'suppliers':_0x1497e1[_0x3bde9f(0x213)]['suppliers'],'date':_0x5bbb4a,'warehouse_name':_0x42a773,'return_product':_0x5a491f,'note':_0x50b993,'room':_0x36c23a,'to_warehouse_name':_0x16b758,'to_room':_0x440cd9}),_0x31ba8d=await _0x2ac7df[_0x3bde9f(0x30a)](),_0x186a5c=await purchases_return_finished[_0x3bde9f(0x281)]({'invoice':_0x2d3185}),_0x43389a=await warehouse[_0x3bde9f(0x281)]({'name':_0x16b758,'room':_0x440cd9,'warehouse_category':_0x3bde9f(0x28e)});_0x186a5c[_0x3bde9f(0x315)][_0x3bde9f(0x2ea)](_0x1f5f5d=>{var _0x9ab97d=_0x3bde9f,_0x5b3fc3=0x0;const _0x55038f=_0x43389a[_0x9ab97d(0x243)][_0x9ab97d(0x22e)](_0x3d8f13=>{var _0x304a72=_0x9ab97d;console[_0x304a72(0x319)](_0x3d8f13[_0x304a72(0x230)]+'=='+_0x1f5f5d['product_name']+'&&'+_0x3d8f13['bay']+'=='+_0x1f5f5d['bay']),_0x3d8f13[_0x304a72(0x230)]==_0x1f5f5d['product_name']&&_0x3d8f13[_0x304a72(0x2f5)]==_0x1f5f5d[_0x304a72(0x2f5)]&&(_0x3d8f13[_0x304a72(0x2e5)]=parseInt(_0x3d8f13['product_stock'])-parseInt(_0x1f5f5d['return_qty']),_0x5b3fc3++);});_0x5b3fc3=='0'&&(_0x43389a[_0x9ab97d(0x243)]=_0x43389a['product_details'][_0x9ab97d(0x24b)]({'product_name':_0x1f5f5d[_0x9ab97d(0x230)],'product_stock':_0x1f5f5d['return_qty'],'primary_code':_0x1f5f5d['primary_code'],'secondary_code':_0x1f5f5d[_0x9ab97d(0x233)],'product_code':_0x1f5f5d[_0x9ab97d(0x228)],'bay':_0x1f5f5d[_0x9ab97d(0x2f5)],'maxProducts':0xf423f}));}),await _0x43389a[_0x3bde9f(0x30a)]();const _0x4df087=await purchases_finished[_0x3bde9f(0x281)]({'invoice':_0x2d3185});_0x4df087[_0x3bde9f(0x2cb)]=_0x3bde9f(0x211);const _0x2d6a73=await _0x4df087[_0x3bde9f(0x30a)](),_0xc10766=new s_payment_data({'invoice':_0x2d3185,'suppliers':_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x313)],'reason':_0x3bde9f(0x21a)});await _0xc10766[_0x3bde9f(0x30a)]();const _0xe1df2a=await master_shop[_0x3bde9f(0x2a6)](),_0x37380b=await email_settings[_0x3bde9f(0x281)](),_0x4c3f3d=await suppliers[_0x3bde9f(0x281)]({'name':_0x1497e1[_0x3bde9f(0x213)][_0x3bde9f(0x313)]});_0xe1df2a[0x0]['currency_placement']==0x1?(right_currency=_0xe1df2a[0x0][_0x3bde9f(0x253)],left_currency=''):(right_currency='',left_currency=_0xe1df2a[0x0][_0x3bde9f(0x253)]);var _0x439ded=_0x54b9a4,_0x34a8e3=_0x1d2f17,_0x455d0b='',_0x354d09;for(_0x354d09 in _0x439ded){_0x455d0b+=_0x3bde9f(0x2a9)+_0x3bde9f(0x20c)+_0x439ded[_0x354d09]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34a8e3[_0x354d09]+_0x3bde9f(0x225)+_0x3bde9f(0x26c);}let _0x51d055=nodemailer['createTransport']({'service':_0x3bde9f(0x222),'auth':{'user':_0x37380b[_0x3bde9f(0x2ed)],'pass':_0x37380b[_0x3bde9f(0x238)]}}),_0x592943={'from':_0x37380b['email'],'to':_0x4c3f3d['email'],'subject':_0x3bde9f(0x1f2),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3bde9f(0x234)+_0x3bde9f(0x2fb)+_0xe1df2a[0x0][_0x3bde9f(0x324)],'cid':'logo'}],'html':_0x3bde9f(0x2f8)+_0x3bde9f(0x249)+_0x3bde9f(0x32a)+_0x3bde9f(0x21b)+_0x3bde9f(0x219)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x3bde9f(0x21b)+_0x3bde9f(0x335)+_0xe1df2a[0x0][_0x3bde9f(0x208)]+'\x20</h2>'+'</div>'+_0x3bde9f(0x295)+'<hr\x20class=\x22my-3\x22>'+_0x3bde9f(0x21b)+_0x3bde9f(0x327)+_0x3bde9f(0x293)+_0x2d3185+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3bde9f(0x277)+_0x5bbb4a+'\x20'+_0x3bde9f(0x320)+'</h5>'+_0x3bde9f(0x295)+_0x3bde9f(0x2cc)+_0x3bde9f(0x250)+_0x3bde9f(0x2a9)+_0x3bde9f(0x262)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3bde9f(0x256)+_0x3bde9f(0x2de)+_0x3bde9f(0x26c)+'</thead>'+_0x3bde9f(0x24d)+'\x20'+_0x455d0b+'\x20'+'</tbody>'+_0x3bde9f(0x32e)+_0x3bde9f(0x21b)+_0x3bde9f(0x1f9)+'<h5>'+_0xe1df2a[0x0][_0x3bde9f(0x208)]+_0x3bde9f(0x205)+_0x3bde9f(0x295)+_0x3bde9f(0x295)+_0x3bde9f(0x2c4)};_0x51d055[_0x3bde9f(0x275)](_0x592943,function(_0xccf8e,_0x248145){var _0x103b07=_0x3bde9f;_0xccf8e?console[_0x103b07(0x319)](_0x103b07(0x27b)):console['log']('Email\x20sent\x20successfully');}),_0x1497e1['flash'](_0x3bde9f(0x2a3),'purchases\x20item\x20return\x20successfull'),_0x29e92d[_0x3bde9f(0x1f3)](_0x3bde9f(0x2f1));}catch(_0x386f81){_0x29e92d[_0x3bde9f(0x26f)](0xc8)[_0x3bde9f(0x2bf)]({'message':_0x386f81[_0x3bde9f(0x276)]});}}),router['get'](a0_0x154127(0x1f4),auth,async(_0x131322,_0x13c2ac)=>{var _0x5bae78=a0_0x154127;try{const {username:_0x59e311,email:_0x160703,role:_0x5b508b}=_0x131322[_0x5bae78(0x2a2)],_0x5eb631=_0x131322['user'],_0x21a1d9=await profile[_0x5bae78(0x281)]({'email':_0x5eb631[_0x5bae78(0x2ed)]}),_0x396be6=await master_shop[_0x5bae78(0x2a6)](),_0x49b018=_0x131322[_0x5bae78(0x286)]['id'],_0xf4518b=await purchases_finished[_0x5bae78(0x2b8)](_0x49b018);if(_0x396be6[0x0][_0x5bae78(0x23b)]==_0x5bae78(0x212))var _0x2d82af=users['English'];else{if(_0x396be6[0x0][_0x5bae78(0x23b)]=='Hindi')var _0x2d82af=users[_0x5bae78(0x272)];else{if(_0x396be6[0x0][_0x5bae78(0x23b)]==_0x5bae78(0x31f))var _0x2d82af=users[_0x5bae78(0x31f)];else{if(_0x396be6[0x0]['language']==_0x5bae78(0x302))var _0x2d82af=users[_0x5bae78(0x302)];else{if(_0x396be6[0x0]['language']=='French')var _0x2d82af=users[_0x5bae78(0x2be)];else{if(_0x396be6[0x0][_0x5bae78(0x23b)]==_0x5bae78(0x27a))var _0x2d82af=users[_0x5bae78(0x339)];else{if(_0x396be6[0x0][_0x5bae78(0x23b)]==_0x5bae78(0x2aa))var _0x2d82af=users[_0x5bae78(0x2aa)];else{if(_0x396be6[0x0][_0x5bae78(0x23b)]==_0x5bae78(0x2c1))var _0x2d82af=users[_0x5bae78(0x300)];}}}}}}}_0x13c2ac[_0x5bae78(0x2a1)]('all_purchases_barcode',{'success':_0x131322[_0x5bae78(0x24f)](_0x5bae78(0x2a3)),'errors':_0x131322['flash'](_0x5bae78(0x22f)),'role':_0x5eb631,'profile':_0x21a1d9,'alldata':_0xf4518b,'master_shop':_0x396be6,'language':_0x2d82af}),console[_0x5bae78(0x319)](alldata);}catch(_0x2b7a80){console[_0x5bae78(0x319)](_0x2b7a80);}}),router[a0_0x154127(0x26b)]('/barcode_scanner',async(_0x83b990,_0x11d9f8)=>{var _0x1de33a=a0_0x154127;const {product_code:_0x1efed4}=_0x83b990[_0x1de33a(0x213)];var _0x5d39f2;const _0x162f47=await product[_0x1de33a(0x31a)]([{'$match':{'primary_code':_0x1efed4}},{'$group':{'_id':_0x1de33a(0x237),'name':{'$first':_0x1de33a(0x285)},'category':{'$first':_0x1de33a(0x2b1)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1de33a(0x221)},'primary_code':{'$first':_0x1de33a(0x252)},'secondary_code':{'$first':_0x1de33a(0x323)},'maxStocks':{'$first':_0x1de33a(0x2e4)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x1de33a(0x21e)},'sales_category':{'$first':_0x1de33a(0x21d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x54a9f4=await product[_0x1de33a(0x31a)]([{'$match':{'secondary_code':_0x1efed4}},{'$group':{'_id':_0x1de33a(0x237),'name':{'$first':'$name'},'category':{'$first':_0x1de33a(0x2b1)},'brand':{'$first':'$brand'},'unit':{'$first':_0x1de33a(0x203)},'alertquantity':{'$first':_0x1de33a(0x2bb)},'product_code':{'$first':_0x1de33a(0x221)},'primary_code':{'$first':_0x1de33a(0x252)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1de33a(0x2e4)},'maxProdPerUnit':{'$first':_0x1de33a(0x235)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1de33a(0x287)},'gross_price':{'$first':_0x1de33a(0x21e)},'sales_category':{'$first':_0x1de33a(0x21d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x162f47['length']>0x0)_0x5d39f2=_0x162f47;else _0x54a9f4[_0x1de33a(0x25d)]>0x0&&(_0x5d39f2=_0x54a9f4);_0x11d9f8[_0x1de33a(0x2bf)](_0x5d39f2);}),router['post'](a0_0x154127(0x299),async(_0x23c4e6,_0x2f031f)=>{var _0x306953=a0_0x154127;const {productCode:_0x2305ef,bay:_0xdef399,warehouses:_0x36b416,room:_0x308c9c}=_0x23c4e6[_0x306953(0x213)];console['log'](_0x23c4e6['body']);try{const _0x10b77a=await warehouse['aggregate']([{'$match':{'name':_0x36b416,'room':_0x308c9c}},{'$unwind':_0x306953(0x2ca)},{'$match':{'product_details.bay':parseInt(_0xdef399)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x306953(0x2c5)},'bay':{'$first':_0x306953(0x338)},'maxProducts':{'$first':_0x306953(0x310)}}}]);_0x2f031f[_0x306953(0x26f)](0xc8)[_0x306953(0x2bf)](_0x10b77a);}catch(_0x1f92dc){_0x2f031f[_0x306953(0x26f)](0x194)[_0x306953(0x2bf)]({'message':_0x1f92dc['message']});}}),router[a0_0x154127(0x26b)](a0_0x154127(0x1fb),async(_0x5273fd,_0x2201e6)=>{var _0x288758=a0_0x154127;const {product_code:_0x4b9cd9}=_0x5273fd[_0x288758(0x213)];var _0x43b4a4;const _0x51e147=await product['aggregate']([{'$match':{'primary_code':_0x4b9cd9,'type_products':_0x288758(0x319)}},{'$group':{'_id':_0x288758(0x237),'name':{'$first':'$name'},'category':{'$first':_0x288758(0x2b1)},'brand':{'$first':_0x288758(0x303)},'unit':{'$first':_0x288758(0x203)},'alertquantity':{'$first':_0x288758(0x2bb)},'product_code':{'$first':_0x288758(0x221)},'primary_code':{'$first':_0x288758(0x252)},'secondary_code':{'$first':_0x288758(0x323)},'maxStocks':{'$first':_0x288758(0x2e4)},'maxProdPerUnit':{'$first':_0x288758(0x235)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x288758(0x287)},'gross_price':{'$first':_0x288758(0x21e)},'sales_category':{'$first':_0x288758(0x21d)},'type_products':{'$first':_0x288758(0x2af)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x288758(0x319)](_0x51e147);const _0xa7b028=await product[_0x288758(0x31a)]([{'$match':{'secondary_code':_0x4b9cd9,'type_products':'log'}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x288758(0x303)},'unit':{'$first':_0x288758(0x203)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x288758(0x221)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x288758(0x323)},'maxStocks':{'$first':_0x288758(0x2e4)},'maxProdPerUnit':{'$first':_0x288758(0x235)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x288758(0x287)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x288758(0x2af)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x51e147[_0x288758(0x25d)]>0x0)_0x43b4a4=_0x51e147;else _0xa7b028[_0x288758(0x25d)]>0x0&&(_0x43b4a4=_0xa7b028);_0x2201e6['json'](_0x43b4a4);}),module[a0_0x154127(0x2e3)]=router;