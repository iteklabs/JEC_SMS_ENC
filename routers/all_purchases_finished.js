var a0_0x195c2d=a0_0x32dc;(function(_0x13ddb4,_0x5a1c18){var _0x3bb29a=a0_0x32dc,_0x28dc98=_0x13ddb4();while(!![]){try{var _0x41f40f=-parseInt(_0x3bb29a(0x209))/0x1*(parseInt(_0x3bb29a(0x114))/0x2)+parseInt(_0x3bb29a(0x1a5))/0x3+-parseInt(_0x3bb29a(0x122))/0x4*(-parseInt(_0x3bb29a(0xe8))/0x5)+-parseInt(_0x3bb29a(0x13e))/0x6+parseInt(_0x3bb29a(0xfc))/0x7+parseInt(_0x3bb29a(0x1d4))/0x8*(-parseInt(_0x3bb29a(0x18e))/0x9)+parseInt(_0x3bb29a(0x109))/0xa;if(_0x41f40f===_0x5a1c18)break;else _0x28dc98['push'](_0x28dc98['shift']());}catch(_0x1cb48e){_0x28dc98['push'](_0x28dc98['shift']());}}}(a0_0x14bc,0x4cf19));const express=require(a0_0x195c2d(0xf8)),app=express(),router=express[a0_0x195c2d(0xef)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require('../models/all_models'),auth=require(a0_0x195c2d(0x189)),nodemailer=require(a0_0x195c2d(0x193));function a0_0x14bc(){var _0x3259ee=['edit_purchases_finished','amount','edit_purchases_finished_view','name','primary_code','to_bay','add_purchases\x20error','purchase_invoice','product_date','$paid_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','room','image','Finished\x20Goods','Ambient','Chinese','<strong>\x20Regards\x20</strong>','log','$brand','prod_cat','An\x20error\x20occurred.','product_id','slice','return_purchase_finished','filter','../middleware/auth','incoming_add','</tr>','concat','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','230409VovFpR','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','true','product_details','nodemailer','$product_details.bin','currency','getDate','$category','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','Room_name','incoming_view','purchase\x20data\x20update\x20successfully','$due_amount','abs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sendMail','$name','$product.type','purchases_id','725916iVzJiL','logo','purchase_quantity','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','\x20<>\x20','secondary_unit','product_code_hide','host','ejs','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','Asia/Manila','$note','product_stock','$unit','return_qty','$product','$date','$alertquantity','numeric','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.bay','render','</span>','Return\x20Goods','/all_purchases_finished/view','$product_details.product_name','body','language','level','gross_price','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','role','stocks','to_quantity','German','maxStocks','prod_primunit','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product.floorlevel','$product_details._id','Spanish','English\x20(US)','getMonth','product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','8KoBNHW','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_code','Hindi','en-CA','currency_placement','$primary_code','unit','date','\x20units\x20to\x20warehouse:\x20','site_title','json','/barcode_scanner_logs','</td>','maxProducts','get','expiry_date','$product_details.maxProducts','$product_details.type','sales_category','$batch_code','Arabic','$product_details.secondary_code','bin','$_id','</table>','forEach','flash','prod_Qty','/barcode/:id','all','/view_log','createTransport','success','<div>','$suppliers','$product_details.product_code','secondary_code','</body></html>','add_purchases_finished_logs','$maxStocks','valueOf','Portuguese','INC','suppliers','/preview/:id',',\x20bay:\x20','prod_qty','invoice','prod_name','product','standard_unit','back','39983hKJepT','INC-','Rack\x202','\x20Order\x20Date\x20:\x20','/view/add_purchases_logs','/getinvoicetrf','payment\x20successfull','$product_details.primary_code','return_product','false','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details','Rack\x201','/view/add_purchases/:id','findById','aggregate','/upload/','toLocaleDateString','</head><body>','English','stock_data',',\x20bin:\x20','Portuguese\x20(BR)','params','2-digit','$product_details.rack','</h5>','FROZEN\x20GOODS','type_of_products','INCF-','id_transaction','warehouse','115SuskRI','Enabled','secondary_code_hide','$product.bin','maxperunit','$type_products','user_id','Router','<h2>\x20','\x20<=>\x20','$warehouse_name','bay','staff','/getTRF','status','own','express','_id','stock_quantity','DRY\x20GOODS','2070306liTvjT','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','date_recieved','<hr\x20class=\x22my-3\x22>','MaxStocks_data','batch_code','user','$maxProdPerUnit','<span\x20style=\x22float:\x20right;\x22>','/all_purchases/view','gmail','to_warehouse','<h5\x20style=\x22text-align:\x20left;\x22>','1920260rLCTHZ','room_name','$product_code','map','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</thead>','findOne','error','$secondary_unit','redirect','<h5>','2kUCqfx','/process/:id','getFullYear','Enclosed','padStart','/picking_list/pdf_puchases_fin_own_trf/','add_purchases_finished','prod_unit','\x20</h2>','email','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','note','all_purchases_finished_logs','table\x20page','39468yVEize','invoice_init','There\x20is\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_level','$product.room_name','path','purchases_process','product_code','item_code','to_recieved','POnumber','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/all_purchases_finished/preview/','master','due_amount','</tbody>','$invoice','message','prod_secondunit','Arabic\x20(ae)','Email\x20sent\x20successfully','undefined','LOG-INC-','$product.bay','\x20Order\x20Number\x20:\x20','/barcode_scanner','$room','3455712MinYWu','Purchase\x20Return','$expiry_date','toString','save','/../public','$suppliers_docs','production_date','/view/add_purchases','updateOne','$sales_category',',\x20room:\x20','$secondary_code','to_room_name','logs','warehouse_name','$gross_price','maxPerUnit','quantity','purchase\x20data\x20add\x20successfully','isProcess','product_name','max_product_unit','sales_data_cateory','Transfer\x20Finalize\x20Successfully','product_data','all_purchases_barcode','</div>','primary_code_hide','<tr>','/invoice/:id','paid_amount','post','max','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','errors','Error\x20Occurs','$product.quantity','$product_details.product_stock','French','<html><head><title></title>','then','Distributing\x20','Purchase\x20Mail','match','True','find','catch','type_of_products_type','uuid'];a0_0x14bc=function(){return _0x3259ee;};return a0_0x14bc();}var ejs=require(a0_0x195c2d(0x1ae));const path=require(a0_0x195c2d(0x128)),users=require('../public/language/languages.json'),{isNull}=require('util');router[a0_0x195c2d(0x1e3)]('/incoming',auth,async(_0x1f7972,_0x56c74a)=>{var _0x1b01a=a0_0x195c2d;try{const {username:_0x5d1357,email:_0x3924a9,role:_0x22a64b}=_0x1f7972[_0x1b01a(0x102)],_0x1ed423=_0x1f7972['user'],_0xf12824=await profile[_0x1b01a(0x10f)]({'email':_0x1ed423['email']}),_0x33721f=await staff[_0x1b01a(0x10f)]({'email':_0x1ed423[_0x1b01a(0x11d)]}),_0x5cb951=await master_shop[_0x1b01a(0x16c)]();let _0x5adc4e=await transfers_finished[_0x1b01a(0xd7)]([{'$match':{'to_warehouse':_0x33721f[_0x1b01a(0xe7)]}}]);if(_0x5cb951[0x0]['language']==_0x1b01a(0x1d0))var _0x5cbf4b=users[_0x1b01a(0xdb)];else{if(_0x5cb951[0x0][_0x1b01a(0x1c1)]=='Hindi')var _0x5cbf4b=users[_0x1b01a(0x1d7)];else{if(_0x5cb951[0x0][_0x1b01a(0x1c1)]=='German')var _0x5cbf4b=users[_0x1b01a(0x1c8)];else{if(_0x5cb951[0x0][_0x1b01a(0x1c1)]==_0x1b01a(0x1cf))var _0x5cbf4b=users[_0x1b01a(0x1cf)];else{if(_0x5cb951[0x0]['language']==_0x1b01a(0x165))var _0x5cbf4b=users[_0x1b01a(0x165)];else{if(_0x5cb951[0x0]['language']=='Portuguese\x20(BR)')var _0x5cbf4b=users[_0x1b01a(0x1fe)];else{if(_0x5cb951[0x0][_0x1b01a(0x1c1)]=='Chinese')var _0x5cbf4b=users[_0x1b01a(0x17f)];else{if(_0x5cb951[0x0][_0x1b01a(0x1c1)]=='Arabic\x20(ae)')var _0x5cbf4b=users[_0x1b01a(0x1e9)];}}}}}}}_0x56c74a['render'](_0x1b01a(0x19a),{'success':_0x1f7972[_0x1b01a(0x1ef)](_0x1b01a(0x1f5)),'errors':_0x1f7972['flash'](_0x1b01a(0x161)),'purchases':_0x5adc4e,'role':_0x1ed423,'profile':_0xf12824,'master_shop':_0x5cb951,'language':_0x5cbf4b,'staff_data':_0x33721f});}catch(_0x28db0e){console['log'](_0x1b01a(0x121),_0x28db0e),_0x56c74a[_0x1b01a(0xf6)](0xc8)[_0x1b01a(0x1df)]({'message':_0x28db0e[_0x1b01a(0x134)]});}}),router['get']('/incoming/add',auth,async(_0x12ecd0,_0x287e1c)=>{var _0x170be3=a0_0x195c2d;try{const {username:_0x4d560f,email:_0xe5d976,role:_0x3426d1}=_0x12ecd0['user'],_0x1ae96a=_0x12ecd0['user'],_0xdf08ee=await profile[_0x170be3(0x10f)]({'email':_0x1ae96a['email']}),_0x20ca78=await staff[_0x170be3(0x10f)]({'email':_0x1ae96a[_0x170be3(0x11d)]}),_0x58975b=await master_shop[_0x170be3(0x16c)]();let _0x4b5b6b=await transfers_finished[_0x170be3(0xd7)]([{'$match':{'to_warehouse':_0x20ca78[_0x170be3(0xe7)],'to_recieved':_0x170be3(0xd0)}}]);if(_0x58975b[0x0][_0x170be3(0x1c1)]==_0x170be3(0x1d0))var _0xae815c=users[_0x170be3(0xdb)];else{if(_0x58975b[0x0]['language']=='Hindi')var _0xae815c=users[_0x170be3(0x1d7)];else{if(_0x58975b[0x0][_0x170be3(0x1c1)]=='German')var _0xae815c=users[_0x170be3(0x1c8)];else{if(_0x58975b[0x0][_0x170be3(0x1c1)]==_0x170be3(0x1cf))var _0xae815c=users['Spanish'];else{if(_0x58975b[0x0]['language']==_0x170be3(0x165))var _0xae815c=users[_0x170be3(0x165)];else{if(_0x58975b[0x0][_0x170be3(0x1c1)]==_0x170be3(0xde))var _0xae815c=users[_0x170be3(0x1fe)];else{if(_0x58975b[0x0][_0x170be3(0x1c1)]=='Chinese')var _0xae815c=users[_0x170be3(0x17f)];else{if(_0x58975b[0x0]['language']=='Arabic\x20(ae)')var _0xae815c=users[_0x170be3(0x1e9)];}}}}}}}_0x287e1c[_0x170be3(0x1bb)](_0x170be3(0x18a),{'success':_0x12ecd0[_0x170be3(0x1ef)](_0x170be3(0x1f5)),'errors':_0x12ecd0[_0x170be3(0x1ef)](_0x170be3(0x161)),'purchases':_0x4b5b6b,'role':_0x1ae96a,'profile':_0xdf08ee,'master_shop':_0x58975b,'language':_0xae815c,'staff_data':_0x20ca78});}catch(_0x429803){console[_0x170be3(0x181)](_0x170be3(0x121),_0x429803),_0x287e1c[_0x170be3(0xf6)](0xc8)[_0x170be3(0x1df)]({'message':_0x429803[_0x170be3(0x134)]});}});function a0_0x32dc(_0x2aa9e3,_0x194dd8){var _0x14bc0b=a0_0x14bc();return a0_0x32dc=function(_0x32dc93,_0x1dd5cc){_0x32dc93=_0x32dc93-0xcd;var _0x596302=_0x14bc0b[_0x32dc93];return _0x596302;},a0_0x32dc(_0x2aa9e3,_0x194dd8);}const createLog=async _0x13abd8=>{var _0x5be8f8=a0_0x195c2d;const _0x4ba0e4=new datalogs({'location':_0x13abd8});return await _0x4ba0e4[_0x5be8f8(0x142)](),_0x4ba0e4[_0x5be8f8(0x123)];};router['post']('/incoming/add',auth,async(_0x169229,_0x6b95af)=>{var _0x1f702a=a0_0x195c2d;try{const {invoice_trf_data:_0x252448,item_code:_0x40c0ce,SCRN:_0x9952fa,ReqBy:_0x1ca083,type_of_products:_0x576981,dateofreq:_0x214b0b,PO_number:_0x476b7f,date:_0x514160,warehouse_name:_0x5c1f7b,typeservicesData:_0x4864ba,typevehicle:_0x4572eb,driver:_0x37f83e,plate:_0x4d5bd0,van:_0x228449,DRSI:_0x470272,TSU:_0x51d26a,TFU:_0x467f31,note:_0x39fd4c}=_0x169229[_0x1f702a(0x1c0)],_0x16c9b2=await transfers_finished[_0x1f702a(0xd6)](_0x252448);if(typeof _0x40c0ce==_0x1f702a(0xd1))var _0x369137=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x153)]],_0x3fde2b=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x12b)]],_0xc99200=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1c7)]],_0x24b8ce=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1db)]],_0x272408=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x135)]],_0x25ec50=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1eb)]],_0x412bee=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x174)]],_0x4a6e84=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1f9)]],_0x4fb127=[_0x169229['body'][_0x1f702a(0x101)]],_0x29998f=[_0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1e4)]],_0x5d3d6e=[_0x169229[_0x1f702a(0x1c0)]['production_date']],_0x4ba5fd=[_0x169229[_0x1f702a(0x1c0)]['max_product_unit']],_0x4582f3=[_0x169229['body'][_0x1f702a(0x17b)]];else var _0x369137=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x153)]],_0x3fde2b=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x12b)]],_0xc99200=[..._0x169229['body'][_0x1f702a(0x1c7)]],_0x24b8ce=[..._0x169229['body'][_0x1f702a(0x1db)]],_0x272408=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x135)]],_0x25ec50=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1eb)]],_0x412bee=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x174)]],_0x4a6e84=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1f9)]],_0x4fb127=[..._0x169229[_0x1f702a(0x1c0)]['batch_code']],_0x29998f=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x1e4)]],_0x5d3d6e=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x145)]],_0x4ba5fd=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x154)]],_0x4582f3=[..._0x169229[_0x1f702a(0x1c0)][_0x1f702a(0x17b)]];const _0x2ba3e3=_0x369137[_0x1f702a(0x10c)](_0x236678=>{return _0x236678={'product_name':_0x236678};});_0x3fde2b[_0x1f702a(0x1ee)]((_0x106592,_0x387e73)=>{var _0x57dbd1=_0x1f702a;_0x2ba3e3[_0x387e73][_0x57dbd1(0x12a)]=_0x106592;}),_0xc99200[_0x1f702a(0x1ee)]((_0x115b95,_0x38e1e1)=>{var _0x459113=_0x1f702a;_0x2ba3e3[_0x38e1e1][_0x459113(0x150)]=Math[_0x459113(0x19d)](_0x115b95);}),_0x24b8ce[_0x1f702a(0x1ee)]((_0x2c25ba,_0x13a418)=>{var _0x4cea81=_0x1f702a;_0x2ba3e3[_0x13a418][_0x4cea81(0x207)]=_0x2c25ba;}),_0x272408[_0x1f702a(0x1ee)]((_0x49fe45,_0x12d8d6)=>{var _0x58701c=_0x1f702a;_0x2ba3e3[_0x12d8d6][_0x58701c(0x1ab)]=_0x49fe45;}),_0x25ec50['forEach']((_0x38c4f2,_0x3d37b0)=>{var _0x4239e8=_0x1f702a,_0x3ca572=_0x38c4f2[_0x4239e8(0x16a)](/[A-Za-z]+/)[0x0],_0x1b7349=parseInt(_0x38c4f2[_0x4239e8(0x16a)](/\d+/)[0x0]);_0x2ba3e3[_0x3d37b0][_0x4239e8(0x1c2)]=_0x3ca572,_0x2ba3e3[_0x3d37b0][_0x4239e8(0xf3)]=_0x1b7349;}),_0x412bee[_0x1f702a(0x1ee)]((_0x845543,_0x3d3603)=>{var _0x290321=_0x1f702a;_0x2ba3e3[_0x3d3603][_0x290321(0x174)]=_0x845543;}),_0x4a6e84[_0x1f702a(0x1ee)]((_0x203e81,_0x1db9c4)=>{var _0x4afeee=_0x1f702a;_0x2ba3e3[_0x1db9c4][_0x4afeee(0x1f9)]=_0x203e81;}),_0x4fb127['forEach']((_0x282b58,_0x3ae5f4)=>{var _0x19a834=_0x1f702a;_0x2ba3e3[_0x3ae5f4][_0x19a834(0x101)]=_0x282b58;}),_0x29998f[_0x1f702a(0x1ee)]((_0x1b35b7,_0x3ade59)=>{_0x2ba3e3[_0x3ade59]['expiry_date']=_0x1b35b7;}),_0x5d3d6e['forEach']((_0x298f27,_0x304f2a)=>{var _0x451fa0=_0x1f702a;_0x2ba3e3[_0x304f2a][_0x451fa0(0x145)]=_0x298f27;}),_0x4ba5fd[_0x1f702a(0x1ee)]((_0x574770,_0x377ab8)=>{_0x2ba3e3[_0x377ab8]['maxperunit']=_0x574770;}),_0x4582f3[_0x1f702a(0x1ee)]((_0x2f7bbb,_0x26d8b0)=>{var _0x22eccc=_0x1f702a;_0x2ba3e3[_0x26d8b0][_0x22eccc(0x10a)]=_0x2f7bbb;});const _0x191da0=await createLog(_0x1f702a(0x1ff));_0x4582f3[_0x1f702a(0x1ee)]((_0x1fa3b5,_0x7826e8)=>{var _0x2d0e0e=_0x1f702a;_0x2ba3e3[_0x7826e8][_0x2d0e0e(0x204)]=_0x2d0e0e(0x20a)+_0x191da0[_0x2d0e0e(0x141)]()['padStart'](0x8,'0');});const _0x38237b=_0x2ba3e3[_0x1f702a(0x188)](_0x22f0c3=>_0x22f0c3[_0x1f702a(0x150)]!=='0'&&_0x22f0c3[_0x1f702a(0x150)]!==''),_0x335f93=new purchases_incoming({'invoice':_0x1f702a(0x20a)+_0x191da0[_0x1f702a(0x141)]()[_0x1f702a(0x118)](0x8,'0'),'date':_0x514160,'warehouse_name':_0x5c1f7b,'product':_0x38237b,'note':_0x39fd4c,'POnumber':_0x476b7f,'SCRN':_0x9952fa,'ReqBy':_0x1ca083,'dateofreq':_0x214b0b,'typeservicesData':_0x4864ba,'van':_0x228449,'typevehicle':_0x4572eb,'driver':_0x37f83e,'plate':_0x4d5bd0,'DRSI':_0x470272,'TSU':_0x51d26a,'TFU':_0x467f31,'typeOfProducts':_0x576981}),_0x22b472=await _0x335f93[_0x1f702a(0x142)](),_0x421675=_0x22b472['product']['map'](async _0x1822ca=>{var _0x3c573d=_0x1f702a,_0x4df4ce=await warehouse[_0x3c573d(0x10f)]({'name':_0x5c1f7b,'room':_0x1822ca['room_name']});if(_0x1822ca[_0x3c573d(0x150)]>0x0){var _0x4bd4cc=0x0;const _0x1aec63=_0x4df4ce['product_details'][_0x3c573d(0x10c)](_0xaa034f=>{var _0x30101e=_0x3c573d;_0xaa034f[_0x30101e(0x153)]==_0x1822ca[_0x30101e(0x153)]&&_0xaa034f[_0x30101e(0xf3)]==_0x1822ca[_0x30101e(0x175)]&&_0xaa034f['expiry_date']==_0x1822ca[_0x30101e(0x1e4)]&&_0xaa034f[_0x30101e(0x145)]==_0x1822ca[_0x30101e(0x145)]&&_0xaa034f[_0x30101e(0x101)]==_0x1822ca[_0x30101e(0x101)]&&_0xaa034f[_0x30101e(0x204)]==_0x1822ca[_0x30101e(0x204)]&&(typeof _0x1822ca[_0x30101e(0xe6)]==_0x30101e(0x138)?(console[_0x30101e(0x181)]('here2',_0xaa034f[_0x30101e(0x1b2)]+'\x20<>\x20'+_0xaa034f[_0x30101e(0xf9)]+_0x30101e(0xf1)+Math[_0x30101e(0x19d)](_0xaa034f[_0x30101e(0x1b2)])+Math[_0x30101e(0x19d)](_0x1822ca[_0x30101e(0x1c7)])),_0xaa034f['product_stock']=Math[_0x30101e(0x19d)](_0xaa034f[_0x30101e(0x1b2)])+Math[_0x30101e(0x19d)](_0x1822ca['quantity'])):(_0xaa034f[_0x30101e(0x1b2)]=Math[_0x30101e(0x19d)](_0xaa034f[_0x30101e(0x1b2)])+Math['abs'](_0x1822ca[_0x30101e(0x150)]),_0x4bd4cc++));});_0x4bd4cc=='0'&&(_0x4df4ce[_0x3c573d(0x192)]=_0x4df4ce['product_details'][_0x3c573d(0x18c)]({'product_name':_0x1822ca[_0x3c573d(0x153)],'product_stock':_0x1822ca[_0x3c573d(0x150)],'bay':_0x1822ca['bay'],'level':_0x1822ca['level'],'product_code':_0x1822ca[_0x3c573d(0x12a)],'primary_code':_0x1822ca[_0x3c573d(0x174)],'secondary_code':_0x1822ca['secondary_code'],'expiry_date':_0x1822ca[_0x3c573d(0x1e4)],'production_date':_0x1822ca[_0x3c573d(0x145)],'maxProducts':_0x1822ca[_0x3c573d(0x1e2)],'batch_code':_0x1822ca[_0x3c573d(0x101)],'secondary_unit':_0x1822ca['secondary_unit'],'unit':_0x1822ca[_0x3c573d(0x207)],'maxProducts':_0x1822ca[_0x3c573d(0x1e2)],'maxPerUnit':_0x1822ca[_0x3c573d(0x14f)],'invoice':_0x1822ca[_0x3c573d(0x204)]}));}return _0x4df4ce;});Promise[_0x1f702a(0x1f2)](_0x421675)['then'](async _0x50730e=>{var _0x23e319=_0x1f702a;try{for(const _0x229f41 of _0x50730e){await warehouse['updateOne']({'_id':_0x229f41['_id']},{'$addToSet':{'product_details':{'$each':_0x229f41[_0x23e319(0x192)]}}});}_0x16c9b2[_0x23e319(0x12c)]=_0x23e319(0x191);const _0x51bb54=await _0x16c9b2[_0x23e319(0x142)](),_0x2a7087=await master_shop[_0x23e319(0x16c)](),_0x5d578d=await email_settings[_0x23e319(0x10f)](),_0x2cc5bd=await supervisor_settings['find']();var _0x210291=_0x335f93[_0x23e319(0x206)],_0x114848='',_0x374ae3;for(_0x374ae3 in _0x210291){var _0x13755b='FG';_0x335f93['to_warehouse']==_0x23e319(0xfb)&&(_0x13755b='DG'),_0x114848+='<tr>'+_0x23e319(0xfd)+_0x210291[_0x374ae3][_0x23e319(0x153)]+_0x23e319(0x1e1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x210291[_0x374ae3][_0x23e319(0x12a)]+_0x23e319(0x1e1)+_0x23e319(0xfd)+_0x210291[_0x374ae3][_0x23e319(0x1c7)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x210291[_0x374ae3]['unit']+_0x23e319(0x1e1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x210291[_0x374ae3][_0x23e319(0x1ab)]+_0x23e319(0x1e1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x335f93[_0x23e319(0x107)]+_0x23e319(0x1e1)+_0x23e319(0xfd)+_0x210291[_0x374ae3][_0x23e319(0x14b)]+_0x23e319(0x1e1)+_0x23e319(0xfd)+_0x13755b+_0x210291[_0x374ae3]['to_bay']+'</td>'+_0x23e319(0x18b);}_0x169229['flash']('success',_0x23e319(0x156)),_0x6b95af['redirect'](_0x23e319(0x119)+_0x22b472[_0x23e319(0xf9)]);}catch(_0x1e0473){console[_0x23e319(0x110)](_0x1e0473),_0x6b95af[_0x23e319(0xf6)](0x1f4)[_0x23e319(0x1df)]({'error':_0x23e319(0x198)});}})[_0x1f702a(0x16d)](_0x25b060=>{var _0x1e35ed=_0x1f702a;console['error'](_0x25b060),_0x6b95af[_0x1e35ed(0xf6)](0x1f4)[_0x1e35ed(0x1df)]({'error':_0x1e35ed(0x184)});});}catch(_0x1f780b){}}),router[a0_0x195c2d(0x15e)](a0_0x195c2d(0xf5),auth,async(_0xa1d3b9,_0x399a5b)=>{var _0xa3da64=a0_0x195c2d;try{const {warehouse:_0x2b54a1}=_0xa1d3b9['body'],_0x3f469e=await transfers_finished[_0xa3da64(0x16c)]({'to_warehouse':_0x2b54a1,'to_recieved':_0xa3da64(0xd0)});_0x399a5b[_0xa3da64(0x1df)](_0x3f469e);}catch(_0x24d730){}}),router['post'](a0_0x195c2d(0x20e),auth,async(_0x149c4b,_0x47f9a3)=>{var _0x1b26d0=a0_0x195c2d;try{const {invoice:_0xd9fc38}=_0x149c4b[_0x1b26d0(0x1c0)],_0xbaa89=await transfers_finished[_0x1b26d0(0x16c)]({'_id':_0xd9fc38,'to_recieved':_0x1b26d0(0xd0)});_0x47f9a3[_0x1b26d0(0x1df)](_0xbaa89);}catch(_0x1a79d){}}),router['get']('/view',auth,async(_0x3bcfbe,_0x41e31e)=>{var _0x1dee31=a0_0x195c2d;try{const {username:_0x157d41,email:_0x3c534e,role:_0x23d959}=_0x3bcfbe[_0x1dee31(0x102)],_0x35fb80=_0x3bcfbe[_0x1dee31(0x102)],_0x35f63a=await profile[_0x1dee31(0x10f)]({'email':_0x35fb80[_0x1dee31(0x11d)]}),_0x122138=await staff[_0x1dee31(0x10f)]({'email':_0x35fb80[_0x1dee31(0x11d)]});if(_0x35fb80['role']==_0x1dee31(0xf4)){const _0x26d240=await staff[_0x1dee31(0x10f)]({'email':_0x35fb80[_0x1dee31(0x11d)]});}const _0x560f97=await master_shop[_0x1dee31(0x16c)]();let _0x3c6458;if(_0x35fb80[_0x1dee31(0x1c5)]==_0x1dee31(0xf4)){const _0x570a08=await staff[_0x1dee31(0x10f)]({'email':_0x35fb80[_0x1dee31(0x11d)]});_0x3c6458=await purchases_finished[_0x1dee31(0xd7)]([{'$match':{'warehouse_name':_0x570a08[_0x1dee31(0xe7)],'typeOfProducts':_0x1dee31(0xf7)}},{'$lookup':{'from':_0x1dee31(0x200),'localField':_0x1dee31(0x200),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x1dee31(0x144)},{'$unwind':_0x1dee31(0x1b5)},{'$group':{'_id':_0x1dee31(0x1ec),'invoice':{'$first':_0x1dee31(0x133)},'suppliers':{'$first':_0x1dee31(0x1f7)},'date':{'$first':_0x1dee31(0x1b6)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1dee31(0x13d)},'product':{'$push':_0x1dee31(0x1b5)},'note':{'$first':_0x1dee31(0x1b1)},'paid_amount':{'$first':_0x1dee31(0x179)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1dee31(0x144)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x1dee31(0x13a)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x1dee31(0x1a3)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3c6458=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x1dee31(0xf7)}},{'$unwind':_0x1dee31(0x1b5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1dee31(0x133)},'suppliers':{'$first':_0x1dee31(0x1f7)},'date':{'$first':_0x1dee31(0x1b6)},'warehouse_name':{'$first':_0x1dee31(0xf2)},'room':{'$addToSet':_0x1dee31(0x127)},'product':{'$push':_0x1dee31(0x1b5)},'note':{'$first':_0x1dee31(0x1b1)},'paid_amount':{'$first':_0x1dee31(0x179)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1dee31(0x1e8)},'expiry_date':{'$first':_0x1dee31(0x140)},'suppliers_docs':{'$first':_0x1dee31(0x144)},'total_product_quantity':{'$sum':_0x1dee31(0x163)},'level':{'$addToSet':_0x1dee31(0x13a)},'isle':{'$addToSet':_0x1dee31(0xeb)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x560f97[0x0][_0x1dee31(0x1c1)]=='English\x20(US)')var _0x226b1c=users['English'];else{if(_0x560f97[0x0][_0x1dee31(0x1c1)]==_0x1dee31(0x1d7))var _0x226b1c=users[_0x1dee31(0x1d7)];else{if(_0x560f97[0x0]['language']==_0x1dee31(0x1c8))var _0x226b1c=users[_0x1dee31(0x1c8)];else{if(_0x560f97[0x0][_0x1dee31(0x1c1)]==_0x1dee31(0x1cf))var _0x226b1c=users[_0x1dee31(0x1cf)];else{if(_0x560f97[0x0]['language']==_0x1dee31(0x165))var _0x226b1c=users['French'];else{if(_0x560f97[0x0]['language']==_0x1dee31(0xde))var _0x226b1c=users[_0x1dee31(0x1fe)];else{if(_0x560f97[0x0][_0x1dee31(0x1c1)]=='Chinese')var _0x226b1c=users[_0x1dee31(0x17f)];else{if(_0x560f97[0x0][_0x1dee31(0x1c1)]==_0x1dee31(0x136))var _0x226b1c=users[_0x1dee31(0x1e9)];}}}}}}}_0x41e31e[_0x1dee31(0x1bb)]('all_purchases_finished',{'success':_0x3bcfbe[_0x1dee31(0x1ef)]('success'),'errors':_0x3bcfbe['flash']('errors'),'purchases':_0x3c6458,'role':_0x35fb80,'profile':_0x35f63a,'master_shop':_0x560f97,'language':_0x226b1c});}catch(_0x4d7e25){console[_0x1dee31(0x181)](_0x1dee31(0x121),_0x4d7e25),_0x41e31e[_0x1dee31(0xf6)](0xc8)['json']({'message':_0x4d7e25['message']});}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x1f3),auth,async(_0x2eefc7,_0x34b02a)=>{var _0x5002b9=a0_0x195c2d;try{const {username:_0x346237,email:_0x16506a,role:_0x475315}=_0x2eefc7[_0x5002b9(0x102)],_0x1d6ec3=_0x2eefc7['user'],_0x391229=await profile[_0x5002b9(0x10f)]({'email':_0x1d6ec3[_0x5002b9(0x11d)]}),_0x207a22=await staff[_0x5002b9(0x10f)]({'email':_0x1d6ec3['email']});if(_0x1d6ec3['role']==_0x5002b9(0xf4)){const _0x44ea3f=await staff[_0x5002b9(0x10f)]({'email':_0x1d6ec3[_0x5002b9(0x11d)]});}const _0x56bc28=await master_shop[_0x5002b9(0x16c)]();let _0x3c7def;if(_0x1d6ec3[_0x5002b9(0x1c5)]=='staff'){const _0x48e0f9=await staff[_0x5002b9(0x10f)]({'email':_0x1d6ec3[_0x5002b9(0x11d)]});_0x3c7def=await purchases_finished[_0x5002b9(0xd7)]([{'$match':{'warehouse_name':_0x48e0f9[_0x5002b9(0xe7)]}},{'$lookup':{'from':_0x5002b9(0x200),'localField':'suppliers','foreignField':_0x5002b9(0x173),'as':'suppliers_docs'}},{'$unwind':_0x5002b9(0x144)},{'$unwind':_0x5002b9(0x1b5)},{'$group':{'_id':_0x5002b9(0x1ec),'invoice':{'$first':_0x5002b9(0x133)},'suppliers':{'$first':_0x5002b9(0x1f7)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5002b9(0xf2)},'room':{'$first':_0x5002b9(0x13d)},'product':{'$push':_0x5002b9(0x1b5)},'note':{'$first':_0x5002b9(0x1b1)},'paid_amount':{'$first':_0x5002b9(0x179)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x5002b9(0x140)},'suppliers_docs':{'$first':_0x5002b9(0x144)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x5002b9(0x13a)},'isle':{'$addToSet':_0x5002b9(0xeb)},'type':{'$addToSet':_0x5002b9(0x1a3)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3c7def=await purchases_finished[_0x5002b9(0xd7)]([{'$match':{'typeOfProducts':_0x5002b9(0x14c)}},{'$unwind':_0x5002b9(0x1b5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5002b9(0x133)},'suppliers':{'$first':_0x5002b9(0x1f7)},'date':{'$first':_0x5002b9(0x1b6)},'warehouse_name':{'$first':_0x5002b9(0xf2)},'room':{'$addToSet':_0x5002b9(0x127)},'product':{'$push':_0x5002b9(0x1b5)},'note':{'$first':_0x5002b9(0x1b1)},'paid_amount':{'$first':_0x5002b9(0x179)},'due_amount':{'$first':_0x5002b9(0x19c)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x5002b9(0x140)},'suppliers_docs':{'$first':_0x5002b9(0x144)},'total_product_quantity':{'$sum':_0x5002b9(0x163)},'level':{'$addToSet':_0x5002b9(0x13a)},'isle':{'$addToSet':_0x5002b9(0xeb)},'type':{'$addToSet':_0x5002b9(0x1a3)},'floorlevel':{'$addToSet':_0x5002b9(0x1cd)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x56bc28[0x0]['language']==_0x5002b9(0x1d0))var _0x5e6eca=users[_0x5002b9(0xdb)];else{if(_0x56bc28[0x0][_0x5002b9(0x1c1)]==_0x5002b9(0x1d7))var _0x5e6eca=users[_0x5002b9(0x1d7)];else{if(_0x56bc28[0x0][_0x5002b9(0x1c1)]==_0x5002b9(0x1c8))var _0x5e6eca=users[_0x5002b9(0x1c8)];else{if(_0x56bc28[0x0][_0x5002b9(0x1c1)]==_0x5002b9(0x1cf))var _0x5e6eca=users[_0x5002b9(0x1cf)];else{if(_0x56bc28[0x0][_0x5002b9(0x1c1)]==_0x5002b9(0x165))var _0x5e6eca=users[_0x5002b9(0x165)];else{if(_0x56bc28[0x0][_0x5002b9(0x1c1)]==_0x5002b9(0xde))var _0x5e6eca=users[_0x5002b9(0x1fe)];else{if(_0x56bc28[0x0][_0x5002b9(0x1c1)]=='Chinese')var _0x5e6eca=users[_0x5002b9(0x17f)];else{if(_0x56bc28[0x0]['language']=='Arabic\x20(ae)')var _0x5e6eca=users[_0x5002b9(0x1e9)];}}}}}}}_0x34b02a[_0x5002b9(0x1bb)](_0x5002b9(0x120),{'success':_0x2eefc7[_0x5002b9(0x1ef)](_0x5002b9(0x1f5)),'errors':_0x2eefc7['flash'](_0x5002b9(0x161)),'purchases':_0x3c7def,'role':_0x1d6ec3,'profile':_0x391229,'master_shop':_0x56bc28,'language':_0x5e6eca});}catch(_0x54b34b){console[_0x5002b9(0x181)](_0x5002b9(0x121),_0x54b34b),_0x34b02a[_0x5002b9(0xf6)](0xc8)[_0x5002b9(0x1df)]({'message':_0x54b34b['message']});}});function BayBinSelected(_0x4d0665,_0x490ead){var _0x389e94=a0_0x195c2d,_0x2c38ff=[],_0x83e4fa=[];if(_0x4d0665==_0x389e94(0xfb)){switch(_0x490ead){case _0x389e94(0xd4):_0x2c38ff=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x389e94(0x20b):_0x2c38ff=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x83e4fa=['DG'];}else{if(_0x4d0665==_0x389e94(0xe3)){switch(_0x490ead){case _0x389e94(0xd4):_0x2c38ff=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x389e94(0x20b):_0x2c38ff=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x83e4fa=['FG'];}}return{'levels':_0x2c38ff,'identify':_0x83e4fa};}async function getRandom8DigitNumber(){var _0x11839e=a0_0x195c2d;const _0x15b179=0x989680,_0x3bd618=0x5f5e0ff,_0x7624de=Math['floor'](Math['random']()*(_0x3bd618-_0x15b179+0x1))+_0x15b179;var _0x329d61;const _0x12bc0c=await purchases_finished[_0x11839e(0x10f)]({'invoice':_0x11839e(0xe5)+_0x7624de});return _0x12bc0c&&_0x12bc0c[_0x11839e(0x1a8)]>0x0?_0x329d61='INCF-'+_0x7624de:_0x329d61=_0x11839e(0xe5)+_0x7624de,_0x329d61;}router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x146),auth,async(_0x422465,_0x57e02c)=>{var _0x3a3e8f=a0_0x195c2d;try{const {username:_0x329659,email:_0x30b36a,role:_0x581a5a}=_0x422465[_0x3a3e8f(0x102)],_0x4652d0=_0x422465[_0x3a3e8f(0x102)],_0x2303e0=await profile[_0x3a3e8f(0x10f)]({'email':_0x4652d0['email']}),_0x199c5b=await master_shop[_0x3a3e8f(0x16c)](),_0x4f9dc5=await staff[_0x3a3e8f(0x10f)]({'email':_0x4652d0[_0x3a3e8f(0x11d)]}),_0x230caa=await suppliers[_0x3a3e8f(0x16c)]({});let _0x1275e5;if(_0x4652d0[_0x3a3e8f(0x1c5)]==_0x3a3e8f(0xf4)){const _0x410688=await staff['findOne']({'email':_0x4652d0['email']});_0x1275e5=await warehouse[_0x3a3e8f(0xd7)]([{'$match':{'status':_0x3a3e8f(0xe9),'name':_0x410688['warehouse']}},{'$group':{'_id':_0x3a3e8f(0x1a2),'name':{'$first':'$name'}}}]);}else _0x1275e5=await warehouse[_0x3a3e8f(0xd7)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3a3e8f(0x1a2),'name':{'$first':'$name'}}}]);const _0x553d47=await product[_0x3a3e8f(0x16c)]({}),_0x280546=await warehouse[_0x3a3e8f(0x16c)]({'status':'Enabled'}),_0xace3bd=await purchases_finished[_0x3a3e8f(0x16c)]({}),_0x1bc952=_0xace3bd[_0x3a3e8f(0x1a8)]+0x1,_0x21c569=_0x3a3e8f(0xe5)+_0x1bc952[_0x3a3e8f(0x141)]()[_0x3a3e8f(0x118)](0x5,'0');var _0x4a2ffb=[_0x3a3e8f(0x17e),_0x3a3e8f(0x117)];if(_0x199c5b[0x0][_0x3a3e8f(0x1c1)]=='English\x20(US)')var _0x52cbb6=users[_0x3a3e8f(0xdb)];else{if(_0x199c5b[0x0][_0x3a3e8f(0x1c1)]==_0x3a3e8f(0x1d7))var _0x52cbb6=users[_0x3a3e8f(0x1d7)];else{if(_0x199c5b[0x0]['language']==_0x3a3e8f(0x1c8))var _0x52cbb6=users[_0x3a3e8f(0x1c8)];else{if(_0x199c5b[0x0][_0x3a3e8f(0x1c1)]=='Spanish')var _0x52cbb6=users[_0x3a3e8f(0x1cf)];else{if(_0x199c5b[0x0][_0x3a3e8f(0x1c1)]==_0x3a3e8f(0x165))var _0x52cbb6=users[_0x3a3e8f(0x165)];else{if(_0x199c5b[0x0][_0x3a3e8f(0x1c1)]=='Portuguese\x20(BR)')var _0x52cbb6=users[_0x3a3e8f(0x1fe)];else{if(_0x199c5b[0x0][_0x3a3e8f(0x1c1)]=='Chinese')var _0x52cbb6=users[_0x3a3e8f(0x17f)];else{if(_0x199c5b[0x0]['language']==_0x3a3e8f(0x136))var _0x52cbb6=users['Arabic'];}}}}}}}const _0x9b4a59=getRandom8DigitNumber(),_0x252f0e=new Date(),_0x378e54={'year':_0x3a3e8f(0x1b8),'month':_0x3a3e8f(0xe0),'day':_0x3a3e8f(0xe0),'timeZone':_0x3a3e8f(0x1b0)},_0x4251af=_0x252f0e[_0x3a3e8f(0xd9)](_0x3a3e8f(0x1d8),_0x378e54);console[_0x3a3e8f(0x181)](_0x4251af),_0x9b4a59[_0x3a3e8f(0x167)](_0x14497c=>{var _0x331017=_0x3a3e8f;_0x57e02c[_0x331017(0x1bb)](_0x331017(0x11a),{'success':_0x422465['flash']('success'),'errors':_0x422465[_0x331017(0x1ef)](_0x331017(0x161)),'role':_0x4652d0,'profile':_0x2303e0,'suppliers':_0x230caa,'warehouse':_0x1275e5,'product':_0x553d47,'invoice':_0x14497c,'master_shop':_0x199c5b,'language':_0x52cbb6,'find_data':_0x280546,'rooms_data':_0x4a2ffb,'formattedDate':_0x4251af});})[_0x3a3e8f(0x16d)](_0x4d02f2=>{var _0x472443=_0x3a3e8f;_0x422465[_0x472443(0x1ef)](_0x472443(0x161),_0x472443(0x12e)),_0x57e02c[_0x472443(0x112)](_0x472443(0x1be));});}catch(_0x170613){console[_0x3a3e8f(0x181)](_0x170613);}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x20d),auth,async(_0x29f35b,_0x1f1922)=>{var _0x5a5865=a0_0x195c2d;try{const {username:_0x1c6704,email:_0x286beb,role:_0x2625fc}=_0x29f35b[_0x5a5865(0x102)],_0x15892e=_0x29f35b['user'],_0x3543e2=await profile['findOne']({'email':_0x15892e['email']}),_0x481799=await master_shop[_0x5a5865(0x16c)](),_0x18537c=await staff[_0x5a5865(0x10f)]({'email':_0x15892e[_0x5a5865(0x11d)]}),_0x2dc36f=await suppliers[_0x5a5865(0x16c)]({});let _0x5a1262;if(_0x15892e[_0x5a5865(0x1c5)]==_0x5a5865(0xf4)){const _0x53fe3d=await staff[_0x5a5865(0x10f)]({'email':_0x15892e['email']});_0x5a1262=await warehouse[_0x5a5865(0xd7)]([{'$match':{'status':_0x5a5865(0xe9),'name':_0x53fe3d['warehouse']}},{'$group':{'_id':_0x5a5865(0x1a2),'name':{'$first':_0x5a5865(0x1a2)}}}]);}else _0x5a1262=await warehouse['aggregate']([{'$match':{'status':_0x5a5865(0xe9)}},{'$group':{'_id':_0x5a5865(0x1a2),'name':{'$first':'$name'}}}]);const _0x45ee3e=await product[_0x5a5865(0x16c)]({}),_0x30c5ce=await warehouse[_0x5a5865(0x16c)]({'status':_0x5a5865(0xe9)}),_0x3df8d7=await purchases_finished[_0x5a5865(0x16c)]({}),_0x2b6c4c=_0x3df8d7[_0x5a5865(0x1a8)]+0x1,_0x172eec='INCF-'+_0x2b6c4c[_0x5a5865(0x141)]()['padStart'](0x5,'0');var _0x3bb367=[_0x5a5865(0x17e),_0x5a5865(0x117)];if(_0x481799[0x0]['language']==_0x5a5865(0x1d0))var _0x17dba4=users[_0x5a5865(0xdb)];else{if(_0x481799[0x0][_0x5a5865(0x1c1)]==_0x5a5865(0x1d7))var _0x17dba4=users['Hindi'];else{if(_0x481799[0x0][_0x5a5865(0x1c1)]==_0x5a5865(0x1c8))var _0x17dba4=users['German'];else{if(_0x481799[0x0][_0x5a5865(0x1c1)]==_0x5a5865(0x1cf))var _0x17dba4=users[_0x5a5865(0x1cf)];else{if(_0x481799[0x0]['language']==_0x5a5865(0x165))var _0x17dba4=users[_0x5a5865(0x165)];else{if(_0x481799[0x0][_0x5a5865(0x1c1)]==_0x5a5865(0xde))var _0x17dba4=users[_0x5a5865(0x1fe)];else{if(_0x481799[0x0][_0x5a5865(0x1c1)]==_0x5a5865(0x17f))var _0x17dba4=users[_0x5a5865(0x17f)];else{if(_0x481799[0x0][_0x5a5865(0x1c1)]==_0x5a5865(0x136))var _0x17dba4=users['Arabic'];}}}}}}}const _0x3c9cbf=getRandom8DigitNumber();_0x3c9cbf['then'](_0x5a729a=>{var _0x3e7827=_0x5a5865;_0x1f1922['render'](_0x3e7827(0x1fb),{'success':_0x29f35b[_0x3e7827(0x1ef)](_0x3e7827(0x1f5)),'errors':_0x29f35b[_0x3e7827(0x1ef)](_0x3e7827(0x161)),'role':_0x15892e,'profile':_0x3543e2,'suppliers':_0x2dc36f,'warehouse':_0x5a1262,'product':_0x45ee3e,'invoice':_0x5a729a,'master_shop':_0x481799,'language':_0x17dba4,'find_data':_0x30c5ce,'rooms_data':_0x3bb367});})[_0x5a5865(0x16d)](_0x4206f8=>{var _0xae8302=_0x5a5865;_0x29f35b[_0xae8302(0x1ef)](_0xae8302(0x161),_0xae8302(0x12e)),_0x1f1922[_0xae8302(0x112)](_0xae8302(0x1be));});}catch(_0x2603fc){console[_0x5a5865(0x181)](_0x2603fc);}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0xd5),auth,async(_0x38d939,_0x194536)=>{var _0x355d29=a0_0x195c2d;try{const _0x37fa85=_0x38d939['params']['id'];console[_0x355d29(0x181)](_0x37fa85);const _0x45b753=await master_shop['find']();console[_0x355d29(0x181)]('master',_0x45b753);const _0x20c748=await product[_0x355d29(0x10f)]({'name':_0x37fa85});console[_0x355d29(0x181)](_0x355d29(0x206),_0x20c748),_0x194536[_0x355d29(0xf6)](0xc8)[_0x355d29(0x1df)]({'product_data':_0x20c748,'master':_0x45b753});}catch(_0x40b017){console[_0x355d29(0x181)](_0x355d29(0x176),_0x40b017);}}),router[a0_0x195c2d(0x15e)](a0_0x195c2d(0x146),auth,async(_0x405ded,_0x3c3535)=>{var _0x5a3a71=a0_0x195c2d;try{const {invoice:_0x44f776,date:_0x4e1201,warehouse_name:_0x54ffce,prod_name:_0x3fd2ec,note:_0x257604,due_amount:_0x34be42,Room_name:_0x578df3,PO_number:_0x4f7c86,SCRN:_0x56a018,ReqBy:_0x59657c,dateofreq:_0x3934a3,suppliers:_0x404139,typeservicesData:_0x3df49d,van:_0x124ebf,typevehicle:_0x296e5c,driver:_0x3eae0a,plate:_0x369e99,DRSI:_0x1ab6e4,TSU:_0x3f02b9,TFU:_0xc2b526,JO_number:_0x1f9e84,type_of_products:_0x434e0c}=_0x405ded[_0x5a3a71(0x1c0)];if(typeof _0x3fd2ec==_0x5a3a71(0xd1))var _0x535f3e=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x205)]],_0x30ef6d=[_0x405ded['body'][_0x5a3a71(0x1d6)]],_0x1605a3=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1f0)]],_0x38ec3e=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1ca)]],_0xf4fcac=[_0x405ded['body'][_0x5a3a71(0x135)]],_0x2db2ae=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x126)]],_0x4dc414=[_0x405ded['body'][_0x5a3a71(0x174)]],_0x6847d3=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1f9)]],_0x4fd669=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x100)]],_0x85c5d8=[_0x405ded[_0x5a3a71(0x1c0)]['batch_code']],_0x5b57f3=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1e4)]],_0x33f303=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x178)]],_0x374f18=[_0x405ded['body']['max_product_unit']],_0x1f2c5f=[_0x405ded['body']['prod_cat']],_0x3aa3c9=[_0x405ded[_0x5a3a71(0x1c0)]['RoomAssign']],_0xf90d46=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1c3)]],_0x13a379=[_0x405ded[_0x5a3a71(0x1c0)]['uuid']],_0xc07a0e=[_0x405ded['body'][_0x5a3a71(0x155)]],_0x31aded=[_0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x185)]];else var _0x535f3e=[..._0x405ded[_0x5a3a71(0x1c0)]['prod_name']],_0x30ef6d=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1d6)]],_0x1605a3=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1f0)]],_0x38ec3e=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1ca)]],_0xf4fcac=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x135)]],_0x2db2ae=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x126)]],_0x4dc414=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x174)]],_0x6847d3=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x1f9)]],_0x4fd669=[..._0x405ded[_0x5a3a71(0x1c0)]['MaxStocks_data']],_0x85c5d8=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x101)]],_0x5b57f3=[..._0x405ded['body'][_0x5a3a71(0x1e4)]],_0x33f303=[..._0x405ded['body']['product_date']],_0x374f18=[..._0x405ded[_0x5a3a71(0x1c0)]['max_product_unit']],_0x1f2c5f=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x183)]],_0x3aa3c9=[..._0x405ded[_0x5a3a71(0x1c0)]['RoomAssign']],_0xf90d46=[..._0x405ded['body'][_0x5a3a71(0x1c3)]],_0x13a379=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x16f)]],_0xc07a0e=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x155)]],_0x31aded=[..._0x405ded[_0x5a3a71(0x1c0)][_0x5a3a71(0x185)]];const _0xed8356=_0x535f3e[_0x5a3a71(0x10c)](_0x3728fc=>{return _0x3728fc={'product_name':_0x3728fc};});_0x31aded['forEach']((_0x267a88,_0x1e310f)=>{var _0x4e2655=_0x5a3a71;_0xed8356[_0x1e310f][_0x4e2655(0x185)]=_0x267a88,_0xed8356[_0x1e310f][_0x4e2655(0xfe)]=_0x4e1201;}),_0xc07a0e['forEach']((_0x5eb92a,_0x3d45d2)=>{_0xed8356[_0x3d45d2]['sales_category']=_0x5eb92a;}),_0x30ef6d[_0x5a3a71(0x1ee)]((_0x96f146,_0x4e8e06)=>{_0xed8356[_0x4e8e06]['product_code']=_0x96f146;}),_0x13a379[_0x5a3a71(0x1ee)]((_0xea12da,_0x974294)=>{_0xed8356[_0x974294]['uuid']=_0xea12da;}),_0x1605a3['forEach']((_0x74efd2,_0x4b2934)=>{var _0x6e841e=_0x5a3a71;_0xed8356[_0x4b2934][_0x6e841e(0x150)]=Math['abs'](_0x74efd2);}),_0x38ec3e[_0x5a3a71(0x1ee)]((_0x5854b0,_0x85b985)=>{var _0x2bfe4f=_0x5a3a71;_0xed8356[_0x85b985][_0x2bfe4f(0x207)]=_0x5854b0;}),_0xf4fcac[_0x5a3a71(0x1ee)]((_0x529371,_0x5311b9)=>{_0xed8356[_0x5311b9]['secondary_unit']=_0x529371;}),_0x4dc414[_0x5a3a71(0x1ee)]((_0x230754,_0x17a355)=>{var _0x1a7403=_0x5a3a71;_0xed8356[_0x17a355][_0x1a7403(0x174)]=_0x230754;}),_0x6847d3['forEach']((_0x29e3de,_0x2aff1d)=>{_0xed8356[_0x2aff1d]['secondary_code']=_0x29e3de;}),_0x4fd669[_0x5a3a71(0x1ee)]((_0x4c8ed5,_0x2bfada)=>{_0xed8356[_0x2bfada]['maxStocks']=_0x4c8ed5;}),_0x85c5d8['forEach']((_0x2934a7,_0x341b5d)=>{var _0x179636=_0x5a3a71;_0xed8356[_0x341b5d][_0x179636(0x101)]=_0x2934a7;}),_0x5b57f3[_0x5a3a71(0x1ee)]((_0x41212f,_0x4489b6)=>{_0xed8356[_0x4489b6]['expiry_date']=_0x41212f;}),_0x33f303[_0x5a3a71(0x1ee)]((_0x1f93e1,_0xa85c7c)=>{_0xed8356[_0xa85c7c]['production_date']=_0x1f93e1;}),_0x374f18[_0x5a3a71(0x1ee)]((_0x1a50c5,_0x3a3c09)=>{_0xed8356[_0x3a3c09]['maxperunit']=_0x1a50c5;}),_0x1f2c5f[_0x5a3a71(0x1ee)]((_0x1c047f,_0x5b73f0)=>{var _0x5c023b=_0x5a3a71;_0xed8356[_0x5b73f0][_0x5c023b(0x1d2)]=_0x1c047f;}),_0x3aa3c9[_0x5a3a71(0x1ee)]((_0x38815a,_0x2daafa)=>{_0xed8356[_0x2daafa]['room_name']=_0x38815a;}),_0xf90d46[_0x5a3a71(0x1ee)]((_0x3f8d90,_0x34c016)=>{_0xed8356[_0x34c016]['gross_price']=_0x3f8d90;});const _0x429727=new invoice_for_incoming();await _0x429727[_0x5a3a71(0x142)]();for(let _0x14ebae=0x0;_0x14ebae<=_0x3aa3c9[_0x5a3a71(0x1a8)]-0x1;_0x14ebae++){_0xed8356[_0x14ebae][_0x5a3a71(0x204)]='INC-'+_0x429727['invoice_init'][_0x5a3a71(0x141)]()[_0x5a3a71(0x118)](0x8,'0');}const _0x1e67dc=await warehouse_validation_setup[_0x5a3a71(0xd7)]([{'$match':{'warehouse_name':_0x54ffce}}]);let _0x203213=[];for(let _0x124b09=0x0;_0x124b09<=_0xed8356[_0x5a3a71(0x1a8)]-0x1;_0x124b09++){const _0xd5ee57=_0xed8356[_0x124b09];for(let _0x5bccff=0x0;_0x5bccff<=_0x1e67dc[_0x5a3a71(0x1a8)]-0x1;_0x5bccff++){const _0x5e3f81=_0x1e67dc[_0x5bccff];for(let _0x4df20a=0x0;_0x4df20a<=_0x5e3f81[_0x5a3a71(0x157)][_0x5a3a71(0x1a8)]-0x1;_0x4df20a++){const _0x568750=_0x5e3f81['product_data'][_0x4df20a];if(_0x568750[_0x5a3a71(0x12a)]===_0xd5ee57[_0x5a3a71(0x12a)]){let _0x1e8286=_0xd5ee57[_0x5a3a71(0x150)];const _0x4e3f34=await warehouse[_0x5a3a71(0xd7)]([{'$match':{'name':_0x54ffce,'room':_0x5e3f81[_0x5a3a71(0x17b)]}},{'$unwind':_0x5a3a71(0xd3)},{'$match':{'level':_0x568750['bay'],'bay':_0x568750['bin']}}]);if(_0x4e3f34['length']==0x0){for(let _0xbe10b8=0x0;_0xbe10b8<=_0x5e3f81[_0x5a3a71(0x157)][_0x5a3a71(0x1a8)]-0x1&&_0x1e8286>0x0;_0xbe10b8++){const _0x3440d0=_0x5e3f81['product_data'][_0xbe10b8];if(_0xd5ee57[_0x5a3a71(0x12a)]===_0x3440d0['product_code']){_0x203213[_0xbe10b8]={};const _0x21c767=parseInt(_0x3440d0[_0x5a3a71(0x15f)]),_0x59eec1=0x0;let _0x2e5ecc=_0x21c767-_0x59eec1,_0x2319f7=Math['min'](_0x1e8286,_0x2e5ecc);console[_0x5a3a71(0x181)](_0x5a3a71(0x168)+_0x2319f7+_0x5a3a71(0x1dd)+_0x5e3f81['warehouse_name']+_0x5a3a71(0x149)+_0x5e3f81[_0x5a3a71(0x17b)]+_0x5a3a71(0x202)+_0x3440d0[_0x5a3a71(0xf3)]+_0x5a3a71(0xdd)+_0x3440d0[_0x5a3a71(0x1eb)]),_0x203213[_0xbe10b8][_0x5a3a71(0x153)]=_0xd5ee57[_0x5a3a71(0x153)],_0x203213[_0xbe10b8][_0x5a3a71(0x12a)]=_0xd5ee57[_0x5a3a71(0x12a)],_0x203213[_0xbe10b8]['product_id']=_0xd5ee57[_0x5a3a71(0x185)],_0x203213[_0xbe10b8][_0x5a3a71(0xfe)]=_0xd5ee57[_0x5a3a71(0xfe)],_0x203213[_0xbe10b8][_0x5a3a71(0x1e7)]=_0xd5ee57[_0x5a3a71(0x1e7)],_0x203213[_0xbe10b8][_0x5a3a71(0x16f)]=_0xd5ee57[_0x5a3a71(0x16f)],_0x203213[_0xbe10b8]['quantity']=_0x2319f7,_0x203213[_0xbe10b8][_0x5a3a71(0x207)]=_0xd5ee57[_0x5a3a71(0x207)],_0x203213[_0xbe10b8][_0x5a3a71(0x1ab)]=_0xd5ee57[_0x5a3a71(0x1ab)],_0x203213[_0xbe10b8]['primary_code']=_0xd5ee57[_0x5a3a71(0x174)],_0x203213[_0xbe10b8][_0x5a3a71(0x1f9)]=_0xd5ee57[_0x5a3a71(0x1f9)],_0x203213[_0xbe10b8][_0x5a3a71(0x1c9)]=_0xd5ee57[_0x5a3a71(0x1c9)],_0x203213[_0xbe10b8][_0x5a3a71(0x101)]=_0xd5ee57[_0x5a3a71(0x101)],_0x203213[_0xbe10b8][_0x5a3a71(0x1e4)]=_0xd5ee57[_0x5a3a71(0x1e4)],_0x203213[_0xbe10b8][_0x5a3a71(0x145)]=_0xd5ee57[_0x5a3a71(0x145)],_0x203213[_0xbe10b8]['maxperunit']=_0xd5ee57['maxperunit'],_0x203213[_0xbe10b8][_0x5a3a71(0x1d2)]=_0xd5ee57['product_cat'],_0x203213[_0xbe10b8][_0x5a3a71(0x204)]=_0xd5ee57['invoice'],_0x203213[_0xbe10b8]['gross_price']=_0xd5ee57['gross_price'],_0x203213[_0xbe10b8][_0x5a3a71(0x10a)]=_0x5e3f81['room'],_0x203213[_0xbe10b8][_0x5a3a71(0x1c2)]=_0x3440d0[_0x5a3a71(0xf3)],_0x203213[_0xbe10b8]['bay']=_0x3440d0['bin'],_0x1e8286-=_0x2319f7;if(_0x1e8286<=0x0)break;}}if(_0x1e8286<=0x0)break;_0x1e8286>0x0&&console['log'](_0x5a3a71(0x124)+_0x1e8286+_0x5a3a71(0x1af));}}}}}const _0x844421=_0x203213['filter']((_0x43d270,_0x55144b)=>{if(_0x55144b>0x0)return{'item':_0x43d270};}),_0xd3d1f2=_0x844421[_0x5a3a71(0x188)](_0x216a51=>_0x216a51['quantity']!=='0'&&_0x216a51[_0x5a3a71(0x150)]!==''),_0x54660b=new purchases_finished({'invoice':'INC-'+_0x429727[_0x5a3a71(0x123)][_0x5a3a71(0x141)]()[_0x5a3a71(0x118)](0x8,'0'),'suppliers':_0x404139,'date':_0x4e1201,'warehouse_name':_0x54ffce,'product':_0xd3d1f2,'note':_0x257604,'due_amount':_0x34be42,'room':_0x578df3,'POnumber':_0x4f7c86,'SCRN':_0x56a018,'JO_number':_0x1f9e84,'ReqBy':_0x59657c,'dateofreq':_0x3934a3,'typeservicesData':_0x3df49d,'van':_0x124ebf,'typevehicle':_0x296e5c,'driver':_0x3eae0a,'plate':_0x369e99,'DRSI':_0x1ab6e4,'TSU':_0x3f02b9,'TFU':_0xc2b526,'typeOfProducts':_0x434e0c}),_0x316ee8=await _0x54660b[_0x5a3a71(0x142)](),_0x26c442=await purchases_finished[_0x5a3a71(0x10f)]({'_id':_0x316ee8[_0x5a3a71(0xf9)][_0x5a3a71(0x1fd)]()});_0x405ded[_0x5a3a71(0x1ef)]('success',_0x5a3a71(0x151)),_0x3c3535[_0x5a3a71(0x112)]('/all_purchases_finished/process/'+_0x26c442[_0x5a3a71(0xf9)][_0x5a3a71(0x1fd)]());}catch(_0x362c2d){console[_0x5a3a71(0x181)](_0x362c2d);}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x115),auth,async(_0x2dc32f,_0x38b0d1)=>{var _0x45dbff=a0_0x195c2d;try{const {username:_0xa9a251,email:_0x324b91,role:_0x52ff7e}=_0x2dc32f[_0x45dbff(0x102)],_0x5a049d=_0x2dc32f[_0x45dbff(0x102)],_0x47d625=_0x2dc32f[_0x45dbff(0xdf)]['id'],_0x5b0f65=await profile[_0x45dbff(0x10f)]({'email':_0x5a049d[_0x45dbff(0x11d)]}),_0x29ca47=await master_shop[_0x45dbff(0x16c)](),_0x4bb367=await staff[_0x45dbff(0x10f)]({'email':_0x5a049d[_0x45dbff(0x11d)]}),_0x218579=await suppliers[_0x45dbff(0x16c)]({});let _0x5826b7;if(_0x5a049d[_0x45dbff(0x1c5)]==_0x45dbff(0xf4)){const _0x596b91=await staff[_0x45dbff(0x10f)]({'email':_0x5a049d[_0x45dbff(0x11d)]});_0x5826b7=await warehouse[_0x45dbff(0xd7)]([{'$match':{'status':_0x45dbff(0xe9),'name':_0x596b91['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x45dbff(0x1a2)}}}]);}else _0x5826b7=await warehouse[_0x45dbff(0xd7)]([{'$match':{'status':_0x45dbff(0xe9)}},{'$group':{'_id':_0x45dbff(0x1a2),'name':{'$first':_0x45dbff(0x1a2)}}}]);const _0x5c6d2f=await purchases_finished[_0x45dbff(0xd6)](_0x47d625);if(_0x29ca47[0x0]['language']==_0x45dbff(0x1d0))var _0x5d012e=users[_0x45dbff(0xdb)];else{if(_0x29ca47[0x0][_0x45dbff(0x1c1)]=='Hindi')var _0x5d012e=users[_0x45dbff(0x1d7)];else{if(_0x29ca47[0x0]['language']=='German')var _0x5d012e=users[_0x45dbff(0x1c8)];else{if(_0x29ca47[0x0][_0x45dbff(0x1c1)]==_0x45dbff(0x1cf))var _0x5d012e=users[_0x45dbff(0x1cf)];else{if(_0x29ca47[0x0][_0x45dbff(0x1c1)]=='French')var _0x5d012e=users[_0x45dbff(0x165)];else{if(_0x29ca47[0x0]['language']==_0x45dbff(0xde))var _0x5d012e=users['Portuguese'];else{if(_0x29ca47[0x0]['language']=='Chinese')var _0x5d012e=users[_0x45dbff(0x17f)];else{if(_0x29ca47[0x0][_0x45dbff(0x1c1)]==_0x45dbff(0x136))var _0x5d012e=users[_0x45dbff(0x1e9)];}}}}}}}_0x38b0d1[_0x45dbff(0x1bb)](_0x45dbff(0x129),{'success':_0x2dc32f[_0x45dbff(0x1ef)](_0x45dbff(0x1f5)),'errors':_0x2dc32f[_0x45dbff(0x1ef)](_0x45dbff(0x161)),'role':_0x5a049d,'profile':_0x5b0f65,'suppliers':_0x218579,'warehouse':_0x5826b7,'master_shop':_0x29ca47,'language':_0x5d012e,'purchases_data':_0x5c6d2f});}catch(_0x1d9444){console[_0x45dbff(0x181)](_0x1d9444);}});async function get_warehouse_data(_0x336c49,_0x1eefa1){var _0x3159a5=a0_0x195c2d;try{const _0x1d40da=await warehouse_temporary[_0x3159a5(0x10f)]({'name':_0x336c49,'room':_0x1eefa1});if(!_0x1d40da){const _0x2c873b=new warehouse_temporary({'name':_0x336c49,'address':_0x336c49,'status':_0x3159a5(0xe9),'room':_0x1eefa1,'isStaging':_0x3159a5(0xd0)});return await _0x2c873b[_0x3159a5(0x142)](),_0x2c873b;}else return _0x1d40da;}catch(_0x1e8753){console[_0x3159a5(0x110)](_0x3159a5(0x160),_0x1e8753);throw _0x1e8753;}}router['post'](a0_0x195c2d(0x115),auth,async(_0x3742ee,_0x3b102d)=>{var _0x3c41f3=a0_0x195c2d;try{const _0x2f6fb4=_0x3742ee[_0x3c41f3(0xdf)]['id'],_0xa39c64=await purchases_finished[_0x3c41f3(0xd6)](_0x2f6fb4);let _0x2bca69=[];_0xa39c64[_0x3c41f3(0x206)]['forEach']((_0x18a523,_0x4beaf9)=>{var _0x1c7469=_0x3c41f3;_0x2bca69[_0x4beaf9]={},_0x2bca69[_0x4beaf9][_0x1c7469(0xe7)]=_0xa39c64[_0x1c7469(0x14d)],_0x2bca69[_0x4beaf9]['product_id']=_0x18a523[_0x1c7469(0x185)],_0x2bca69[_0x4beaf9][_0x1c7469(0x153)]=_0x18a523[_0x1c7469(0x153)],_0x2bca69[_0x4beaf9][_0x1c7469(0x12a)]=_0x18a523['product_code'],_0x2bca69[_0x4beaf9]['quantity']=_0x18a523['quantity'],_0x2bca69[_0x4beaf9][_0x1c7469(0x207)]=_0x18a523[_0x1c7469(0x207)],_0x2bca69[_0x4beaf9]['secondary_unit']=_0x18a523[_0x1c7469(0x1ab)],_0x2bca69[_0x4beaf9][_0x1c7469(0x1c2)]=_0x18a523[_0x1c7469(0x1c2)],_0x2bca69[_0x4beaf9]['bay']=_0x18a523[_0x1c7469(0xf3)],_0x2bca69[_0x4beaf9][_0x1c7469(0x174)]=_0x18a523[_0x1c7469(0x174)],_0x2bca69[_0x4beaf9][_0x1c7469(0x1f9)]=_0x18a523[_0x1c7469(0x1f9)],_0x2bca69[_0x4beaf9]['maxStocks']=_0x18a523[_0x1c7469(0x1c9)],_0x2bca69[_0x4beaf9][_0x1c7469(0x101)]=_0x18a523['batch_code'],_0x2bca69[_0x4beaf9][_0x1c7469(0x1e4)]=_0x18a523[_0x1c7469(0x1e4)],_0x2bca69[_0x4beaf9][_0x1c7469(0x145)]=_0x18a523['production_date'],_0x2bca69[_0x4beaf9]['maxperunit']=_0x18a523[_0x1c7469(0xec)],_0x2bca69[_0x4beaf9][_0x1c7469(0x1d2)]=_0x18a523[_0x1c7469(0x1d2)],_0x2bca69[_0x4beaf9][_0x1c7469(0x10a)]=_0x18a523['room_name'],_0x2bca69[_0x4beaf9][_0x1c7469(0x204)]=_0x18a523[_0x1c7469(0x204)],_0x2bca69[_0x4beaf9][_0x1c7469(0x16f)]=_0x18a523[_0x1c7469(0x16f)],_0x2bca69[_0x4beaf9][_0x1c7469(0x1c3)]=_0x18a523[_0x1c7469(0x1c3)],_0x2bca69[_0x4beaf9][_0x1c7469(0x1e7)]=_0x18a523[_0x1c7469(0x1e7)],_0x2bca69[_0x4beaf9][_0x1c7469(0xfe)]=_0x18a523[_0x1c7469(0xfe)],_0x2bca69[_0x4beaf9][_0x1c7469(0x1a4)]=_0x18a523['_id'][_0x1c7469(0x1fd)]();});for(let _0x4810d3=0x0;_0x4810d3<=_0x2bca69['length']-0x1;_0x4810d3++){const _0x5aa011=_0x2bca69[_0x4810d3],_0x4be110=new warehouse_temporary(_0x5aa011);await _0x4be110['save']();}_0xa39c64[_0x3c41f3(0x152)]='true',await _0xa39c64[_0x3c41f3(0x142)](),_0x3742ee[_0x3c41f3(0x1ef)](_0x3c41f3(0x1f5),_0x3c41f3(0x11e)),_0x3b102d['redirect']('/all_purchases_finished/process/'+_0xa39c64[_0x3c41f3(0xf9)][_0x3c41f3(0x1fd)]());}catch(_0xc5d853){}}),router['post']('/view/add_purchases_logs',auth,async(_0x17a482,_0x1d34b9)=>{var _0x26c7c3=a0_0x195c2d;try{const {invoice:_0x4d56d6,date:_0x5799b0,warehouse_name:_0x17e654,prod_name:_0x1a9580,note:_0x378c67,due_amount:_0x42bbd3,Room_name:_0x3fbf52,PO_number:_0x358806,SCRN:_0x148960,ReqBy:_0x31e921,dateofreq:_0x1e2948,suppliers:_0x3b823a,typeservicesData:_0x105ad3,van:_0x339592,typevehicle:_0x147886,driver:_0x505038,plate:_0x312718,DRSI:_0x3175ad,TSU:_0x19f80f,TFU:_0x586e2f,JO_number:_0x269f3e,type_of_products:_0x172cc1}=_0x17a482[_0x26c7c3(0x1c0)];if(typeof _0x1a9580=='string')var _0x58ff9a=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x205)]],_0x1c07c3=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x1d6)]],_0x1b8de6=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x1f0)]],_0x5b8854=[_0x17a482['body'][_0x26c7c3(0x1ca)]],_0x4de729=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x135)]],_0x36e39b=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x126)]],_0x5a8055=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x174)]],_0x73591c=[_0x17a482['body']['secondary_code']],_0x26cf08=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x100)]],_0x195537=[_0x17a482[_0x26c7c3(0x1c0)]['batch_code']],_0xb07acc=[_0x17a482['body'][_0x26c7c3(0x1e4)]],_0x332996=[_0x17a482[_0x26c7c3(0x1c0)]['product_date']],_0x3cd17b=[_0x17a482[_0x26c7c3(0x1c0)]['max_product_unit']],_0x5cf458=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x183)]],_0x1ba476=[_0x17a482[_0x26c7c3(0x1c0)]['RoomAssign']],_0xac980e=[_0x17a482['body'][_0x26c7c3(0x1c3)]],_0x5c6ac4=[_0x17a482[_0x26c7c3(0x1c0)]['uuid']],_0x381c8a=[_0x17a482['body'][_0x26c7c3(0x155)]],_0x4dd747=[_0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x16e)]];else var _0x58ff9a=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x205)]],_0x1c07c3=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x1d6)]],_0x1b8de6=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x1f0)]],_0x5b8854=[..._0x17a482['body']['prod_primunit']],_0x4de729=[..._0x17a482['body'][_0x26c7c3(0x135)]],_0x36e39b=[..._0x17a482['body'][_0x26c7c3(0x126)]],_0x5a8055=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x174)]],_0x73591c=[..._0x17a482['body'][_0x26c7c3(0x1f9)]],_0x26cf08=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x100)]],_0x195537=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x101)]],_0xb07acc=[..._0x17a482['body'][_0x26c7c3(0x1e4)]],_0x332996=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x178)]],_0x3cd17b=[..._0x17a482['body'][_0x26c7c3(0x154)]],_0x5cf458=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x183)]],_0x1ba476=[..._0x17a482[_0x26c7c3(0x1c0)]['RoomAssign']],_0xac980e=[..._0x17a482['body'][_0x26c7c3(0x1c3)]],_0x5c6ac4=[..._0x17a482['body'][_0x26c7c3(0x16f)]],_0x381c8a=[..._0x17a482[_0x26c7c3(0x1c0)]['sales_data_cateory']],_0x4dd747=[..._0x17a482[_0x26c7c3(0x1c0)][_0x26c7c3(0x16e)]];const _0x92109b=_0x58ff9a[_0x26c7c3(0x10c)](_0x1eed11=>{return _0x1eed11={'product_name':_0x1eed11};});_0x4dd747[_0x26c7c3(0x1ee)]((_0x21fb34,_0x1beba0)=>{var _0x43180e=_0x26c7c3;_0x92109b[_0x1beba0][_0x43180e(0xe4)]=_0x21fb34;}),_0x381c8a[_0x26c7c3(0x1ee)]((_0x194ab6,_0x5c8b6f)=>{var _0xdb47ef=_0x26c7c3;_0x92109b[_0x5c8b6f][_0xdb47ef(0x1e7)]=_0x194ab6;}),_0x1c07c3['forEach']((_0x317004,_0x5a755a)=>{var _0x472afb=_0x26c7c3;_0x92109b[_0x5a755a][_0x472afb(0x12a)]=_0x317004;}),_0x5c6ac4[_0x26c7c3(0x1ee)]((_0x141f12,_0x36eed2)=>{var _0x377bf0=_0x26c7c3;_0x92109b[_0x36eed2][_0x377bf0(0x16f)]=_0x141f12;}),_0x1b8de6[_0x26c7c3(0x1ee)]((_0x4a4993,_0x25b1e0)=>{var _0x209443=_0x26c7c3;_0x92109b[_0x25b1e0][_0x209443(0x150)]=Math[_0x209443(0x19d)](_0x4a4993);}),_0x5b8854['forEach']((_0xe4d641,_0x2dfcd8)=>{_0x92109b[_0x2dfcd8]['standard_unit']=_0xe4d641;}),_0x4de729[_0x26c7c3(0x1ee)]((_0x51997c,_0x79ce92)=>{var _0x245edf=_0x26c7c3;_0x92109b[_0x79ce92][_0x245edf(0x1ab)]=_0x51997c;}),_0x36e39b[_0x26c7c3(0x1ee)]((_0x5ad6fe,_0x4fa6f7)=>{var _0x1aa555=_0x26c7c3,_0x5ac448=_0x5ad6fe[_0x1aa555(0x16a)](/[A-Za-z]+/)[0x0],_0x4ec793=parseInt(_0x5ad6fe[_0x1aa555(0x16a)](/\d+/)[0x0]);_0x92109b[_0x4fa6f7][_0x1aa555(0x1c2)]=_0x5ac448,_0x92109b[_0x4fa6f7]['bay']=_0x4ec793;}),_0x5a8055[_0x26c7c3(0x1ee)]((_0x316c28,_0x2beefe)=>{_0x92109b[_0x2beefe]['primary_code']=_0x316c28;}),_0x73591c[_0x26c7c3(0x1ee)]((_0xeec610,_0x58f544)=>{_0x92109b[_0x58f544]['secondary_code']=_0xeec610;}),_0x26cf08['forEach']((_0x2e146e,_0xcbcb6b)=>{var _0x1daf56=_0x26c7c3;_0x92109b[_0xcbcb6b][_0x1daf56(0x1c9)]=_0x2e146e;}),_0x195537['forEach']((_0x547efa,_0x3a3627)=>{var _0x1152ce=_0x26c7c3;_0x92109b[_0x3a3627][_0x1152ce(0x101)]=_0x547efa;}),_0xb07acc['forEach']((_0x51a063,_0x103029)=>{_0x92109b[_0x103029]['expiry_date']=_0x51a063;}),_0x332996[_0x26c7c3(0x1ee)]((_0x2cec47,_0x33aca4)=>{var _0x26ecdd=_0x26c7c3;_0x92109b[_0x33aca4][_0x26ecdd(0x145)]=_0x2cec47;}),_0x3cd17b[_0x26c7c3(0x1ee)]((_0x54ce36,_0x39c0ae)=>{var _0x2d99bd=_0x26c7c3;_0x92109b[_0x39c0ae][_0x2d99bd(0xec)]=_0x54ce36;}),_0x5cf458[_0x26c7c3(0x1ee)]((_0x440a67,_0xbfa195)=>{var _0x24abca=_0x26c7c3;_0x92109b[_0xbfa195][_0x24abca(0x1d2)]=_0x440a67;}),_0x1ba476[_0x26c7c3(0x1ee)]((_0x2f8b21,_0x2a42d1)=>{var _0x3f9ee2=_0x26c7c3;_0x92109b[_0x2a42d1][_0x3f9ee2(0x10a)]=_0x2f8b21;}),_0xac980e[_0x26c7c3(0x1ee)]((_0x4da48a,_0x3ed1e9)=>{var _0x37bd37=_0x26c7c3;_0x92109b[_0x3ed1e9][_0x37bd37(0x1c3)]=_0x4da48a;});const _0x1edf17=new purchases_logs();await _0x1edf17[_0x26c7c3(0x142)]();for(let _0x24542b=0x0;_0x24542b<=_0x1ba476[_0x26c7c3(0x1a8)]-0x1;_0x24542b++){_0x92109b[_0x24542b][_0x26c7c3(0x204)]=_0x26c7c3(0x139)+_0x1edf17[_0x26c7c3(0x123)]['toString']()[_0x26c7c3(0x118)](0x8,'0');}const _0x26f040=_0x92109b['filter'](_0x52c836=>_0x52c836[_0x26c7c3(0x150)]!=='0'&&_0x52c836['quantity']!==''),_0x337bbd=new purchases_finished({'invoice':_0x26c7c3(0x139)+_0x1edf17[_0x26c7c3(0x123)][_0x26c7c3(0x141)]()['padStart'](0x8,'0'),'suppliers':_0x3b823a,'date':_0x5799b0,'warehouse_name':_0x17e654,'product':_0x26f040,'note':_0x378c67,'due_amount':_0x42bbd3,'room':_0x3fbf52,'POnumber':_0x358806,'SCRN':_0x148960,'JO_number':_0x269f3e,'ReqBy':_0x31e921,'dateofreq':_0x1e2948,'typeservicesData':_0x105ad3,'van':_0x339592,'typevehicle':_0x147886,'driver':_0x505038,'plate':_0x312718,'DRSI':_0x3175ad,'TSU':_0x19f80f,'TFU':_0x586e2f,'typeOfProducts':_0x172cc1}),_0x4ad10e=await _0x337bbd[_0x26c7c3(0x142)](),_0x4d5558=await purchases_finished[_0x26c7c3(0x10f)]({'_id':_0x4ad10e[_0x26c7c3(0xf9)][_0x26c7c3(0x1fd)]()}),_0x2ab23c=_0x4d5558[_0x26c7c3(0x206)][_0x26c7c3(0x10c)](async _0x1ab5ce=>{var _0x5da90a=_0x26c7c3;try{var _0xe9b09=await warehouse[_0x5da90a(0x10f)]({'name':_0x17e654,'room':_0x1ab5ce[_0x5da90a(0x10a)]}),_0x4c8338=0x0;const _0x801c01=_0xe9b09[_0x5da90a(0x192)]['map'](_0x4f58fd=>{var _0x547fa9=_0x5da90a;console[_0x547fa9(0x181)](_0x4f58fd[_0x547fa9(0x153)]+'=='+_0x1ab5ce[_0x547fa9(0x153)]+'&&'+_0x4f58fd['bay']+'=='+_0x1ab5ce['bay']+'&&'+_0x4f58fd[_0x547fa9(0x1e4)]+'=='+_0x1ab5ce[_0x547fa9(0x1e4)]+'&&'+_0x4f58fd[_0x547fa9(0x145)]+'=='+_0x1ab5ce[_0x547fa9(0x145)]+'&&'+_0x4f58fd[_0x547fa9(0x101)]+'=='+_0x1ab5ce[_0x547fa9(0x101)]+'&&'+_0x4f58fd['invoice']+'=='+_0x4d5558[_0x547fa9(0x204)]),_0x4f58fd[_0x547fa9(0x153)]==_0x1ab5ce[_0x547fa9(0x153)]&&_0x4f58fd[_0x547fa9(0xf3)]==_0x1ab5ce[_0x547fa9(0xf3)]&&_0x4f58fd[_0x547fa9(0x1c2)]==_0x1ab5ce[_0x547fa9(0x1c2)]&&_0x4f58fd['expiry_date']==_0x1ab5ce['expiry_date']&&_0x4f58fd['production_date']==_0x1ab5ce[_0x547fa9(0x145)]&&_0x4f58fd[_0x547fa9(0x101)]==_0x1ab5ce[_0x547fa9(0x101)]&&_0x4f58fd[_0x547fa9(0x204)]==_0x4d5558['invoice']&&(_0x4f58fd[_0x547fa9(0x1b2)]=Math[_0x547fa9(0x19d)](_0x4f58fd[_0x547fa9(0x1b2)])+Math[_0x547fa9(0x19d)](_0x1ab5ce[_0x547fa9(0x150)]),_0x4c8338++);});return _0x4c8338==0x0&&(_0xe9b09[_0x5da90a(0x192)]=_0xe9b09[_0x5da90a(0x192)][_0x5da90a(0x18c)]({'product_name':_0x1ab5ce[_0x5da90a(0x153)],'product_stock':Math[_0x5da90a(0x19d)](_0x1ab5ce[_0x5da90a(0x150)]),'primary_code':_0x1ab5ce[_0x5da90a(0x174)],'secondary_code':_0x1ab5ce[_0x5da90a(0x1f9)],'product_code':_0x1ab5ce['product_code'],'bay':_0x1ab5ce['bay'],'level':_0x1ab5ce[_0x5da90a(0x1c2)],'maxProducts':_0x1ab5ce['maxStocks'],'unit':_0x1ab5ce[_0x5da90a(0x207)],'secondary_unit':_0x1ab5ce[_0x5da90a(0x1ab)],'expiry_date':_0x1ab5ce['expiry_date'],'production_date':_0x1ab5ce[_0x5da90a(0x145)],'maxProducts':_0x1ab5ce[_0x5da90a(0x1c9)],'maxPerUnit':_0x1ab5ce[_0x5da90a(0xec)],'batch_code':_0x1ab5ce[_0x5da90a(0x101)],'product_cat':_0x1ab5ce[_0x5da90a(0x1d2)],'invoice':_0x1ab5ce[_0x5da90a(0x204)],'id_incoming':_0x1ab5ce['_id'],'uuid':_0x1ab5ce['uuid'],'gross_price':_0x1ab5ce['gross_price'],'sales_category':_0x1ab5ce[_0x5da90a(0x1e7)],'type_products':_0x1ab5ce[_0x5da90a(0xe4)]})),_0xe9b09;}catch(_0x4c44ef){return console['error']('Error\x20occurred\x20while\x20processing\x20product:',_0x4c44ef),null;}});Promise[_0x26c7c3(0x1f2)](_0x2ab23c)['then'](async _0x4dc806=>{var _0x3fca80=_0x26c7c3;try{for(const _0x3b8c56 of _0x4dc806){await warehouse[_0x3fca80(0x147)]({'_id':_0x3b8c56['_id']},{'$addToSet':{'product_details':{'$each':_0x3b8c56[_0x3fca80(0x192)]}}});}const _0x11a90a=await master_shop[_0x3fca80(0x16c)](),_0x555108=await email_settings[_0x3fca80(0x10f)](),_0x311345=await supervisor_settings[_0x3fca80(0x16c)]();var _0x27856a=_0x4d5558[_0x3fca80(0x206)],_0x58f782='',_0x3df98c;for(_0x3df98c in _0x27856a){var _0x3536bc='FG';_0x4d5558['warehouse_name']==_0x3fca80(0xfb)&&(_0x3536bc='DG'),_0x58f782+=_0x3fca80(0x15b)+_0x3fca80(0xfd)+_0x27856a[_0x3df98c]['product_name']+_0x3fca80(0x1e1)+_0x3fca80(0xfd)+_0x27856a[_0x3df98c][_0x3fca80(0x12a)]+_0x3fca80(0x1e1)+_0x3fca80(0xfd)+_0x27856a[_0x3df98c][_0x3fca80(0x150)]+_0x3fca80(0x1e1)+_0x3fca80(0xfd)+_0x27856a[_0x3df98c][_0x3fca80(0x207)]+_0x3fca80(0x1e1)+_0x3fca80(0xfd)+_0x27856a[_0x3df98c][_0x3fca80(0x1ab)]+_0x3fca80(0x1e1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4d5558[_0x3fca80(0x14d)]+_0x3fca80(0x1e1)+_0x3fca80(0xfd)+_0x27856a[_0x3df98c][_0x3fca80(0x10a)]+_0x3fca80(0x1e1)+_0x3fca80(0xfd)+_0x3536bc+_0x27856a[_0x3df98c][_0x3fca80(0xf3)]+_0x3fca80(0x1e1),_0x3fca80(0x18b);}let _0x17c34c=nodemailer[_0x3fca80(0x1f4)]({'host':_0x555108[_0x3fca80(0x1ad)],'port':Number(_0x555108['port']),'secure':![],'auth':{'user':_0x555108[_0x3fca80(0x11d)],'pass':_0x555108[_0x3fca80(0x18f)]}}),_0x152a72={'from':_0x555108[_0x3fca80(0x11d)],'to':_0x311345[0x0]['FGSEmail'],'subject':_0x3fca80(0x169),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3fca80(0x143)+_0x3fca80(0xd8)+_0x11a90a[0x0][_0x3fca80(0x17c)],'cid':_0x3fca80(0x1a6)}],'html':'<!DOCTYPE\x20html>'+_0x3fca80(0x166)+_0x3fca80(0xda)+_0x3fca80(0x1f6)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3fca80(0x1f6)+_0x3fca80(0x18d)+_0x3fca80(0x159)+_0x3fca80(0x1f6)+_0x3fca80(0xf0)+_0x11a90a[0x0][_0x3fca80(0x1de)]+_0x3fca80(0x11c)+_0x3fca80(0x159)+_0x3fca80(0x159)+_0x3fca80(0xff)+_0x3fca80(0x1f6)+_0x3fca80(0x108)+_0x3fca80(0x13b)+_0x4d5558[_0x3fca80(0x204)]+'\x20'+_0x3fca80(0x104)+_0x3fca80(0x20c)+_0x4d5558[_0x3fca80(0x1dc)]+'\x20'+_0x3fca80(0x1bc)+_0x3fca80(0xe2)+_0x3fca80(0x159)+_0x3fca80(0x10d)+_0x3fca80(0x19e)+'<tr>'+_0x3fca80(0x1a0)+_0x3fca80(0x190)+_0x3fca80(0x1b9)+_0x3fca80(0x1a9)+_0x3fca80(0x1d5)+_0x3fca80(0x1cc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3fca80(0x18b)+'</thead>'+_0x3fca80(0x17a)+'\x20'+_0x58f782+'\x20'+_0x3fca80(0x132)+'</table>'+_0x3fca80(0x1f6)+'<strong>\x20Regards\x20</strong>'+_0x3fca80(0x113)+_0x11a90a[0x0][_0x3fca80(0x1de)]+'</h5>'+_0x3fca80(0x159)+_0x3fca80(0x159)+'</body></html>'};_0x17c34c[_0x3fca80(0x1a1)](_0x152a72,function(_0x326870,_0x553c56){var _0x56aade=_0x3fca80;_0x326870?(console['log'](_0x326870),console['log'](_0x56aade(0x162))):console[_0x56aade(0x181)]('Email\x20sent\x20successfully');});}catch(_0x890dfb){console[_0x3fca80(0x110)](_0x890dfb),_0x1d34b9[_0x3fca80(0xf6)](0x1f4)[_0x3fca80(0x1df)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x890dfb['message']});}})['catch'](_0x2a908a=>{var _0x12f415=_0x26c7c3;console[_0x12f415(0x110)](_0x2a908a);}),_0x17a482[_0x26c7c3(0x1ef)](_0x26c7c3(0x1f5),_0x26c7c3(0x151)),_0x1d34b9['redirect'](_0x26c7c3(0x12f)+_0x4d5558[_0x26c7c3(0xf9)]['valueOf']());}catch(_0x347961){console[_0x26c7c3(0x181)](_0x347961);}}),router['get'](a0_0x195c2d(0x201),auth,async(_0x1b5ab6,_0x11c0fa)=>{var _0x22f27b=a0_0x195c2d;try{const {username:_0x21ac40,email:_0x4a92f9,role:_0x230797}=_0x1b5ab6[_0x22f27b(0x102)],_0x581cd9=_0x1b5ab6[_0x22f27b(0x102)],_0x25d125=await profile[_0x22f27b(0x10f)]({'email':_0x581cd9[_0x22f27b(0x11d)]}),_0x312907=await master_shop[_0x22f27b(0x16c)](),_0xce707b=_0x1b5ab6[_0x22f27b(0xdf)]['id'],_0x27be9a=await purchases_finished[_0x22f27b(0xd6)](_0xce707b),_0x45afc6=await suppliers[_0x22f27b(0x16c)]({});let _0xb263d7;if(_0x581cd9['role']==_0x22f27b(0xf4)){const _0x4908db=await staff[_0x22f27b(0x10f)]({'email':_0x581cd9[_0x22f27b(0x11d)]});_0xb263d7=await warehouse[_0x22f27b(0x16c)]({'status':_0x22f27b(0xe9),'name':_0x4908db[_0x22f27b(0xe7)],'warehouse_category':'Finished\x20Goods'});}else _0xb263d7=await warehouse['aggregate']([{'$match':{'status':_0x22f27b(0xe9),'warehouse_category':_0x22f27b(0x17d)}},{'$group':{'_id':_0x22f27b(0x1a2),'name':{'$first':_0x22f27b(0x1a2)}}}]);const _0x44a8da=await product['find']({}),_0x321713=BayBinSelected(_0x27be9a[_0x22f27b(0x14d)],_0x27be9a[_0x22f27b(0x17b)]);let _0x4e1fa3=new Date(_0x27be9a[_0x22f27b(0x1e4)]),_0x424e7b=('0'+_0x4e1fa3[_0x22f27b(0x196)]())[_0x22f27b(0x186)](-0x2),_0x5819c2=('0'+(_0x4e1fa3[_0x22f27b(0x1d1)]()+0x1))['slice'](-0x2),_0x57f52d=_0x4e1fa3[_0x22f27b(0x116)](),_0x3364e6=_0x57f52d+'-'+_0x5819c2+'-'+_0x424e7b;if(_0x312907[0x0][_0x22f27b(0x1c1)]==_0x22f27b(0x1d0)){var _0x1a556a=users[_0x22f27b(0xdb)];console[_0x22f27b(0x181)](_0x1a556a);}else{if(_0x312907[0x0]['language']==_0x22f27b(0x1d7))var _0x1a556a=users['Hindi'];else{if(_0x312907[0x0][_0x22f27b(0x1c1)]=='German')var _0x1a556a=users[_0x22f27b(0x1c8)];else{if(_0x312907[0x0][_0x22f27b(0x1c1)]=='Spanish')var _0x1a556a=users[_0x22f27b(0x1cf)];else{if(_0x312907[0x0][_0x22f27b(0x1c1)]==_0x22f27b(0x165))var _0x1a556a=users[_0x22f27b(0x165)];else{if(_0x312907[0x0][_0x22f27b(0x1c1)]=='Portuguese\x20(BR)')var _0x1a556a=users[_0x22f27b(0x1fe)];else{if(_0x312907[0x0][_0x22f27b(0x1c1)]==_0x22f27b(0x17f))var _0x1a556a=users[_0x22f27b(0x17f)];else{if(_0x312907[0x0]['language']==_0x22f27b(0x136))var _0x1a556a=users[_0x22f27b(0x1e9)];}}}}}}}_0x11c0fa[_0x22f27b(0x1bb)](_0x22f27b(0x172),{'success':_0x1b5ab6['flash'](_0x22f27b(0x1f5)),'errors':_0x1b5ab6[_0x22f27b(0x1ef)]('errors'),'role':_0x581cd9,'profile':_0x25d125,'purchases':_0x27be9a,'suppliers':_0x45afc6,'warehouse':_0xb263d7,'product':_0x44a8da,'master_shop':_0x312907,'language':_0x1a556a,'ed_fullDate':_0x3364e6,'dataSelected':_0x321713});}catch(_0x4d8d16){console[_0x22f27b(0x181)](_0x4d8d16);}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x1cb),auth,async(_0x2ea6a4,_0x3d709f)=>{var _0xa630f2=a0_0x195c2d;try{const {username:_0x433b88,email:_0x18d6ff,role:_0x29b6a1}=_0x2ea6a4[_0xa630f2(0x102)],_0x3a924=_0x2ea6a4[_0xa630f2(0x102)],_0x57b9d3=await profile[_0xa630f2(0x10f)]({'email':_0x3a924['email']}),_0x432612=await master_shop[_0xa630f2(0x16c)](),_0xa9102c=_0x2ea6a4['params']['id'],_0x192113=await purchases_finished[_0xa630f2(0xd6)](_0xa9102c),_0x388450=await suppliers[_0xa630f2(0x16c)]({});let _0x45fa78;if(_0x3a924[_0xa630f2(0x1c5)]==_0xa630f2(0xf4)){const _0xe34806=await staff[_0xa630f2(0x10f)]({'email':_0x3a924[_0xa630f2(0x11d)]});_0x45fa78=await warehouse[_0xa630f2(0x16c)]({'status':_0xa630f2(0xe9),'name':_0xe34806['warehouse'],'warehouse_category':_0xa630f2(0x17d)});}else _0x45fa78=await warehouse[_0xa630f2(0xd7)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0xa630f2(0x1a2),'name':{'$first':_0xa630f2(0x1a2)}}}]);const _0x2146dc=await product[_0xa630f2(0x16c)]({}),_0x2d9385=BayBinSelected(_0x192113[_0xa630f2(0x14d)],_0x192113['room']);let _0x51f608=new Date(_0x192113[_0xa630f2(0x1e4)]),_0x95a67b=('0'+_0x51f608[_0xa630f2(0x196)]())[_0xa630f2(0x186)](-0x2),_0x8c4e7e=('0'+(_0x51f608['getMonth']()+0x1))[_0xa630f2(0x186)](-0x2),_0x1569c5=_0x51f608[_0xa630f2(0x116)](),_0x3238a5=_0x1569c5+'-'+_0x8c4e7e+'-'+_0x95a67b;if(_0x432612[0x0][_0xa630f2(0x1c1)]=='English\x20(US)'){var _0x202a0a=users[_0xa630f2(0xdb)];console[_0xa630f2(0x181)](_0x202a0a);}else{if(_0x432612[0x0][_0xa630f2(0x1c1)]==_0xa630f2(0x1d7))var _0x202a0a=users[_0xa630f2(0x1d7)];else{if(_0x432612[0x0][_0xa630f2(0x1c1)]==_0xa630f2(0x1c8))var _0x202a0a=users['German'];else{if(_0x432612[0x0][_0xa630f2(0x1c1)]==_0xa630f2(0x1cf))var _0x202a0a=users[_0xa630f2(0x1cf)];else{if(_0x432612[0x0][_0xa630f2(0x1c1)]==_0xa630f2(0x165))var _0x202a0a=users[_0xa630f2(0x165)];else{if(_0x432612[0x0][_0xa630f2(0x1c1)]==_0xa630f2(0xde))var _0x202a0a=users['Portuguese'];else{if(_0x432612[0x0]['language']==_0xa630f2(0x17f))var _0x202a0a=users[_0xa630f2(0x17f)];else{if(_0x432612[0x0]['language']==_0xa630f2(0x136))var _0x202a0a=users[_0xa630f2(0x1e9)];}}}}}}}_0x3d709f[_0xa630f2(0x1bb)](_0xa630f2(0x170),{'success':_0x2ea6a4[_0xa630f2(0x1ef)]('success'),'errors':_0x2ea6a4[_0xa630f2(0x1ef)](_0xa630f2(0x161)),'role':_0x3a924,'profile':_0x57b9d3,'purchases':_0x192113,'suppliers':_0x388450,'warehouse':_0x45fa78,'product':_0x2146dc,'master_shop':_0x432612,'language':_0x202a0a,'ed_fullDate':_0x3238a5,'dataSelected':_0x2d9385});}catch(_0xd8e06a){console[_0xa630f2(0x181)](_0xd8e06a);}}),router['post'](a0_0x195c2d(0x1cb),auth,async(_0x32ea63,_0x547100)=>{var _0x37a885=a0_0x195c2d;try{const _0x411317=_0x32ea63[_0x37a885(0xdf)]['id'],_0x589203=await purchases_finished[_0x37a885(0x10f)]({'_id':_0x32ea63['params']['id']}),_0x306343=await warehouse[_0x37a885(0x10f)]({'name':_0x589203[_0x37a885(0x14d)],'room':_0x589203[_0x37a885(0x17b)]});_0x589203[_0x37a885(0x206)][_0x37a885(0x1ee)](_0x4e546a=>{var _0x242a65=_0x37a885;const _0x49d87b=_0x306343[_0x242a65(0x192)][_0x242a65(0x10c)](_0x4e7fbe=>{var _0x8a015b=_0x242a65;_0x4e7fbe[_0x8a015b(0x153)]==_0x4e546a[_0x8a015b(0x153)]&&_0x4e7fbe[_0x8a015b(0xf3)]==_0x4e546a[_0x8a015b(0xf3)]&&(_0x4e7fbe[_0x8a015b(0x1b2)]=parseInt(_0x4e7fbe[_0x8a015b(0x1b2)])-parseInt(_0x4e546a[_0x8a015b(0x150)]));});}),await _0x306343['save']();const {invoice:_0x10acd8,suppliers:_0x18364f,date:_0x18b6d5,warehouse_name:_0x2fe028,prod_name:_0x120092,prod_code:_0x41c35a,prod_qty:_0x53a6a7,prod_unit:_0x4dacbc,prod_secondunit:_0x40e5ff,prod_level:_0x108690,prod_isle:_0x8ddc45,prod_pallet:_0x100615,note:_0x131847,expiry_date:_0x4fa7c7,batch_code:_0x29175e,paid_amount:_0x377c49,due_amount:_0x590509,Room_name:_0x27ab93,primary_code:_0x2bda79,secondary_code:_0x52693c,PO_number:_0x3bc2be,JO_number:_0x396fd3}=_0x32ea63[_0x37a885(0x1c0)];if(typeof _0x120092==_0x37a885(0xd1))var _0xd94d57=[_0x32ea63['body'][_0x37a885(0x205)]],_0x2c761d=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x1d6)]],_0x354508=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x203)]],_0x1cd889=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x11b)]],_0x4919d8=[_0x32ea63['body'][_0x37a885(0x135)]],_0x327235=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x126)]],_0x24ff44=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x174)]],_0x48f0f6=[_0x32ea63[_0x37a885(0x1c0)]['secondary_code']],_0x22272c=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x100)]],_0x15dae4=[_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x101)]],_0x580740=[_0x32ea63[_0x37a885(0x1c0)]['expiry_date']];else var _0xd94d57=[..._0x32ea63['body'][_0x37a885(0x205)]],_0x2c761d=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x1d6)]],_0x354508=[..._0x32ea63['body'][_0x37a885(0x203)]],_0x1cd889=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x11b)]],_0x4919d8=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x135)]],_0x327235=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x126)]],_0x24ff44=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x174)]],_0x48f0f6=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x1f9)]],_0x22272c=[..._0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x100)]],_0x15dae4=[..._0x32ea63['body']['batch_code']],_0x580740=[..._0x32ea63['body'][_0x37a885(0x1e4)]];const _0x23d4af=_0xd94d57[_0x37a885(0x10c)](_0x17d36a=>{return _0x17d36a={'product_name':_0x17d36a};});_0x2c761d[_0x37a885(0x1ee)]((_0x24e96b,_0x38cdd7)=>{var _0x468c94=_0x37a885;_0x23d4af[_0x38cdd7][_0x468c94(0x12a)]=_0x24e96b;}),_0x354508['forEach']((_0x36641f,_0x2c58c7)=>{var _0x288361=_0x37a885;_0x23d4af[_0x2c58c7][_0x288361(0x150)]=_0x36641f;}),_0x1cd889[_0x37a885(0x1ee)]((_0x5afd69,_0x1021bc)=>{var _0x43e86e=_0x37a885;_0x23d4af[_0x1021bc][_0x43e86e(0x207)]=_0x5afd69;}),_0x4919d8[_0x37a885(0x1ee)]((_0x4d647f,_0x43cdb6)=>{_0x23d4af[_0x43cdb6]['secondary_unit']=_0x4d647f;}),_0x327235[_0x37a885(0x1ee)]((_0x1faf95,_0x1916ae)=>{var _0x50b662=_0x37a885;_0x23d4af[_0x1916ae][_0x50b662(0xf3)]=_0x1faf95;}),_0x24ff44['forEach']((_0x2c0fb7,_0x558d43)=>{_0x23d4af[_0x558d43]['primary_code']=_0x2c0fb7;}),_0x48f0f6[_0x37a885(0x1ee)]((_0x331bd5,_0x3f3263)=>{var _0x382171=_0x37a885;_0x23d4af[_0x3f3263][_0x382171(0x1f9)]=_0x331bd5;}),_0x22272c[_0x37a885(0x1ee)]((_0x614bf7,_0x1468f5)=>{_0x23d4af[_0x1468f5]['maxStocks']=_0x614bf7;}),_0x15dae4[_0x37a885(0x1ee)]((_0x42f95d,_0x33712a)=>{var _0x34eeb6=_0x37a885;_0x23d4af[_0x33712a][_0x34eeb6(0x101)]=_0x42f95d;}),_0x580740['forEach']((_0x45b2ac,_0xda7e40)=>{var _0x28a27f=_0x37a885;_0x23d4af[_0xda7e40][_0x28a27f(0x1e4)]=_0x45b2ac;});const _0x2dea25=_0x23d4af['filter'](_0x111736=>_0x111736[_0x37a885(0x150)]!=='0'&&_0x111736['quantity']!=='');_0x589203[_0x37a885(0x204)]=_0x10acd8,_0x589203[_0x37a885(0x200)]=_0x18364f,_0x589203[_0x37a885(0x1dc)]=_0x18b6d5,_0x589203['warehouse_name']=_0x2fe028,_0x589203[_0x37a885(0x206)]=_0x2dea25,_0x589203[_0x37a885(0x11f)]=_0x131847,_0x589203[_0x37a885(0x15d)]=_0x377c49,_0x589203[_0x37a885(0x131)]=_0x590509,_0x589203[_0x37a885(0x17b)]=_0x27ab93,_0x589203[_0x37a885(0x12d)]=_0x3bc2be,_0x589203['JO_number']=_0x396fd3;const _0x3d8a93=await _0x589203[_0x37a885(0x142)](),_0x3ea481=await warehouse[_0x37a885(0x10f)]({'name':_0x32ea63[_0x37a885(0x1c0)]['warehouse_name'],'room':_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x199)]});_0x589203[_0x37a885(0x206)][_0x37a885(0x1ee)](_0x300956=>{var _0x54f0eb=_0x37a885,_0x2c2569=0x0;const _0x320f8d=_0x3ea481[_0x54f0eb(0x192)][_0x54f0eb(0x10c)](_0x54db41=>{var _0x5e0a71=_0x54f0eb;_0x54db41['product_name']==_0x300956[_0x5e0a71(0x153)]&&_0x54db41['bay']==_0x300956[_0x5e0a71(0xf3)]&&(_0x54db41[_0x5e0a71(0x1b2)]=parseInt(_0x54db41[_0x5e0a71(0x1b2)])+parseInt(_0x300956[_0x5e0a71(0x150)]),_0x2c2569++);});_0x2c2569=='0'&&(_0x3ea481['product_details']=_0x3ea481['product_details'][_0x54f0eb(0x18c)]({'product_name':_0x300956[_0x54f0eb(0x153)],'product_stock':_0x300956[_0x54f0eb(0x150)],'primary_code':_0x300956[_0x54f0eb(0x174)],'secondary_code':_0x300956[_0x54f0eb(0x1f9)],'product_code':_0x300956[_0x54f0eb(0x12a)],'bay':_0x300956[_0x54f0eb(0xf3)],'maxProducts':_0x300956[_0x54f0eb(0x1c9)],'unit':_0x300956[_0x54f0eb(0x207)],'secondary_unit':_0x300956[_0x54f0eb(0x1ab)],'expiry_date':_0x300956[_0x54f0eb(0x1e4)]}));}),await _0x3ea481[_0x37a885(0x142)]();const _0x5d698f=await s_payment_data['findOne']({'invoice':_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x204)]});if(_0x5d698f===null){}else console[_0x37a885(0x181)]('suppliers',_0x5d698f,_0x32ea63['body'][_0x37a885(0x204)]),_0x5d698f[_0x37a885(0x200)]=_0x32ea63[_0x37a885(0x1c0)][_0x37a885(0x200)],await _0x5d698f[_0x37a885(0x142)]();_0x32ea63['flash'](_0x37a885(0x1f5),_0x37a885(0x19b)),_0x547100[_0x37a885(0x112)](_0x37a885(0x1be));}catch(_0x380e13){console[_0x37a885(0x181)](_0x380e13);}}),router[a0_0x195c2d(0x15e)]('/give_payment/:id',auth,async(_0x72c95,_0x11cb57)=>{var _0x367e4d=a0_0x195c2d;try{const _0xc0620b=_0x72c95['params']['id'],{invoice:_0x3194ec,suppliers:_0xb28662,payable:_0x440eba,due_amount:_0x2471e9}=_0x72c95[_0x367e4d(0x1c0)],_0x448880=await purchases[_0x367e4d(0xd6)](_0xc0620b);var _0x5878ff=_0x440eba-_0x2471e9;_0x448880[_0x367e4d(0x15d)]=parseFloat(_0x448880[_0x367e4d(0x15d)])+parseFloat(_0x2471e9),_0x448880['due_amount']=_0x5878ff;const _0x4dfad4=await _0x448880['save']();console[_0x367e4d(0x181)](_0x4dfad4);const _0x675e4c=await s_payment_data[_0x367e4d(0x10f)]({'invoice':_0x3194ec});_0x675e4c[_0x367e4d(0x171)]=_0x5878ff,await _0x675e4c['save']();let _0x2c3466=new Date(),_0x6c8848=('0'+_0x2c3466[_0x367e4d(0x196)]())[_0x367e4d(0x186)](-0x2),_0x38e688=('0'+(_0x2c3466[_0x367e4d(0x1d1)]()+0x1))[_0x367e4d(0x186)](-0x2),_0x590a61=_0x2c3466[_0x367e4d(0x116)](),_0x208a52=_0x590a61+'-'+_0x38e688+'-'+_0x6c8848;const _0x315b19=new suppliers_payment({'invoice':_0x3194ec,'date':_0x590a61+'-'+_0x38e688+'-'+_0x6c8848,'suppliers':_0xb28662,'reason':'Paid\x20For\x20Purchase','amount':_0x2471e9}),_0x2249f7=await _0x315b19[_0x367e4d(0x142)]();_0x72c95[_0x367e4d(0x1ef)]('success',_0x367e4d(0xcd)),_0x11cb57['redirect'](_0x367e4d(0x105));}catch(_0x5d286d){console[_0x367e4d(0x181)](_0x5d286d);}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x15c),auth,async(_0x211353,_0x3614e4)=>{var _0x36380f=a0_0x195c2d;try{const {username:_0x42c0a1,email:_0xa8effd,role:_0x4613aa}=_0x211353[_0x36380f(0x102)],_0xfbdd68=_0x211353[_0x36380f(0x102)],_0x180d99=await profile[_0x36380f(0x10f)]({'email':_0xfbdd68[_0x36380f(0x11d)]}),_0x391317=await master_shop[_0x36380f(0x16c)]();console[_0x36380f(0x181)]('master',_0x391317);const _0x205e3d=_0x211353['params']['id'],_0x3c1d48=await purchases['findById'](_0x205e3d);console[_0x36380f(0x181)](_0x3c1d48);const _0x30e50a=await suppliers[_0x36380f(0x10f)]({'name':_0x3c1d48[_0x36380f(0x200)]});console[_0x36380f(0x181)](_0x30e50a);if(_0x391317[0x0][_0x36380f(0x1c1)]==_0x36380f(0x1d0)){var _0x5bfbcd=users[_0x36380f(0xdb)];console[_0x36380f(0x181)](_0x5bfbcd);}else{if(_0x391317[0x0][_0x36380f(0x1c1)]==_0x36380f(0x1d7))var _0x5bfbcd=users[_0x36380f(0x1d7)];else{if(_0x391317[0x0][_0x36380f(0x1c1)]==_0x36380f(0x1c8))var _0x5bfbcd=users['German'];else{if(_0x391317[0x0][_0x36380f(0x1c1)]==_0x36380f(0x1cf))var _0x5bfbcd=users[_0x36380f(0x1cf)];else{if(_0x391317[0x0][_0x36380f(0x1c1)]=='French')var _0x5bfbcd=users['French'];else{if(_0x391317[0x0][_0x36380f(0x1c1)]==_0x36380f(0xde))var _0x5bfbcd=users[_0x36380f(0x1fe)];else{if(_0x391317[0x0][_0x36380f(0x1c1)]==_0x36380f(0x17f))var _0x5bfbcd=users[_0x36380f(0x17f)];else{if(_0x391317[0x0]['language']==_0x36380f(0x136))var _0x5bfbcd=users[_0x36380f(0x1e9)];}}}}}}}_0x3614e4[_0x36380f(0x1bb)](_0x36380f(0x177),{'success':_0x211353[_0x36380f(0x1ef)]('success'),'errors':_0x211353[_0x36380f(0x1ef)](_0x36380f(0x161)),'role':_0xfbdd68,'profile':_0x180d99,'master_shop':_0x391317,'supplier':_0x30e50a,'purchase':_0x3c1d48,'language':_0x5bfbcd});}catch(_0xfd065d){console[_0x36380f(0x181)](_0xfd065d);}}),router[a0_0x195c2d(0x1e3)]('/view/return_purchase/:id',auth,async(_0x2c7120,_0x569daf)=>{var _0x2d05fe=a0_0x195c2d;try{const {username:_0x590694,email:_0x113bc0,role:_0x34b0af}=_0x2c7120[_0x2d05fe(0x102)],_0xad7ccd=_0x2c7120[_0x2d05fe(0x102)],_0x16bfa4=await profile['findOne']({'email':_0xad7ccd[_0x2d05fe(0x11d)]}),_0xf6c433=await master_shop['find']();console[_0x2d05fe(0x181)](_0x2d05fe(0x130),_0xf6c433);const _0x3ad0c5=_0x2c7120[_0x2d05fe(0xdf)]['id'];console[_0x2d05fe(0x181)](_0x3ad0c5);const _0x1a8a1b=await purchases_finished[_0x2d05fe(0xd6)](_0x3ad0c5);console[_0x2d05fe(0x181)](_0x2d05fe(0xee),_0x1a8a1b);const _0x3d3647=await product[_0x2d05fe(0x16c)]({}),_0x1a0bd2=await warehouse[_0x2d05fe(0xd7)]([{'$match':{'name':_0x1a8a1b['warehouse_name'],'room':_0x1a8a1b['room']}},{'$unwind':_0x2d05fe(0xd3)},{'$group':{'_id':_0x2d05fe(0x1ce),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2d05fe(0x164)},'bay':{'$first':_0x2d05fe(0x1ba)},'bin':{'$first':_0x2d05fe(0x194)},'type':{'$first':_0x2d05fe(0x1e6)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2d05fe(0xce)},'secondary_code':{'$first':_0x2d05fe(0x1ea)},'product_code':{'$first':_0x2d05fe(0x1f8)},'storage':{'$first':_0x2d05fe(0x19f)},'rack':{'$first':_0x2d05fe(0xe1)}}}]);console[_0x2d05fe(0x181)](_0x2d05fe(0xdc),_0x1a0bd2);let _0x58575a;if(_0xad7ccd[_0x2d05fe(0x1c5)]==_0x2d05fe(0xf4)){const _0x34337b=await staff[_0x2d05fe(0x10f)]({'email':_0xad7ccd[_0x2d05fe(0x11d)]});_0x58575a=await warehouse[_0x2d05fe(0x16c)]({'status':_0x2d05fe(0xe9),'name':_0x34337b['warehouse'],'warehouse_category':_0x2d05fe(0x17d),'name':_0x2d05fe(0x1bd)});}else _0x58575a=await warehouse[_0x2d05fe(0xd7)]([{'$match':{'status':_0x2d05fe(0xe9),'warehouse_category':_0x2d05fe(0x17d),'name':_0x2d05fe(0x1bd)}},{'$group':{'_id':_0x2d05fe(0x1a2),'name':{'$first':_0x2d05fe(0x1a2)}}}]);if(_0xf6c433[0x0]['language']==_0x2d05fe(0x1d0)){var _0x146395=users[_0x2d05fe(0xdb)];console[_0x2d05fe(0x181)](_0x146395);}else{if(_0xf6c433[0x0][_0x2d05fe(0x1c1)]==_0x2d05fe(0x1d7))var _0x146395=users[_0x2d05fe(0x1d7)];else{if(_0xf6c433[0x0]['language']==_0x2d05fe(0x1c8))var _0x146395=users[_0x2d05fe(0x1c8)];else{if(_0xf6c433[0x0]['language']==_0x2d05fe(0x1cf))var _0x146395=users['Spanish'];else{if(_0xf6c433[0x0]['language']==_0x2d05fe(0x165))var _0x146395=users[_0x2d05fe(0x165)];else{if(_0xf6c433[0x0]['language']=='Portuguese\x20(BR)')var _0x146395=users['Portuguese'];else{if(_0xf6c433[0x0][_0x2d05fe(0x1c1)]==_0x2d05fe(0x17f))var _0x146395=users[_0x2d05fe(0x17f)];else{if(_0xf6c433[0x0][_0x2d05fe(0x1c1)]=='Arabic\x20(ae)')var _0x146395=users[_0x2d05fe(0x1e9)];}}}}}}}_0x569daf['render'](_0x2d05fe(0x187),{'success':_0x2c7120['flash'](_0x2d05fe(0x1f5)),'errors':_0x2c7120[_0x2d05fe(0x1ef)](_0x2d05fe(0x161)),'role':_0xad7ccd,'profile':_0x16bfa4,'user':_0x1a8a1b,'stock':_0x1a0bd2,'master_shop':_0xf6c433,'product':_0x3d3647,'language':_0x146395,'warehouse':_0x58575a});}catch(_0x33fe9c){console[_0x2d05fe(0x181)](_0x33fe9c);}}),router[a0_0x195c2d(0x15e)]('/view/return_purchase/:id',auth,async(_0xb5fb2b,_0x2b6ab9)=>{var _0x4999ee=a0_0x195c2d;try{const {invoice:_0x237f3e,date:_0x30da7d,warehouse_name:_0x5886e8,Room_name:_0x2e0571,product_name:_0x20e211,purchase_quantity:_0x4fe51c,stocks:_0x5b267f,return_qty:_0x1f901a,note:_0x2425c2,level:_0x1acc39,isle:_0x1373b3,pallet:_0x177da6,to_warehouse_name:_0x16748a,to_Room_name:_0x2f2b42}=_0xb5fb2b[_0x4999ee(0x1c0)],_0x3ae78f=await purchases_finished[_0x4999ee(0x10f)]({'_id':_0xb5fb2b['params']['id']}),_0x3d767d=await warehouse['findOne']({'name':_0x5886e8,'room':_0x2e0571,'warehouse_category':_0x4999ee(0x17d)});if(typeof _0x20e211=='string')var _0x30fccc=[_0xb5fb2b['body'][_0x4999ee(0x153)]],_0x4b3b09=[_0xb5fb2b[_0x4999ee(0x1c0)]['purchase_quantity']],_0x48ea3d=[_0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x1c6)]],_0x5c427c=[_0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x1b4)]],_0x11abd4=[_0xb5fb2b[_0x4999ee(0x1c0)]['level']],_0x22c8bd=[_0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x1ac)]],_0x2d494a=[_0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x15a)]],_0x4a990b=[_0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0xea)]];else var _0x30fccc=[..._0xb5fb2b['body'][_0x4999ee(0x153)]],_0x4b3b09=[..._0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x1a7)]],_0x48ea3d=[..._0xb5fb2b['body'][_0x4999ee(0x1c6)]],_0x5c427c=[..._0xb5fb2b['body'][_0x4999ee(0x1b4)]],_0x11abd4=[..._0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x1c2)]],_0x22c8bd=[..._0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x1ac)]],_0x2d494a=[..._0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x15a)]],_0x4a990b=[..._0xb5fb2b['body'][_0x4999ee(0xea)]];const _0x2bb3c8=_0x30fccc[_0x4999ee(0x10c)](_0xd1570=>{return _0xd1570={'product_name':_0xd1570};});_0x4b3b09[_0x4999ee(0x1ee)]((_0x4f0c9d,_0x18bea0)=>{var _0x4a6ab7=_0x4999ee;_0x2bb3c8[_0x18bea0][_0x4a6ab7(0x1a7)]=_0x4f0c9d;}),_0x48ea3d[_0x4999ee(0x1ee)]((_0x36a884,_0x580087)=>{var _0x3c6cf5=_0x4999ee;_0x2bb3c8[_0x580087][_0x3c6cf5(0xfa)]=_0x36a884;}),_0x5c427c[_0x4999ee(0x1ee)]((_0x547bf1,_0x2c4e5a)=>{var _0x10e396=_0x4999ee;_0x2bb3c8[_0x2c4e5a][_0x10e396(0x1b4)]=_0x547bf1;}),_0x11abd4[_0x4999ee(0x1ee)]((_0x22073d,_0x22e705)=>{var _0x325ddf=_0x4999ee;_0x2bb3c8[_0x22e705][_0x325ddf(0xf3)]=_0x22073d;}),_0x22c8bd['forEach']((_0xbd1b9,_0x38725e)=>{var _0x243908=_0x4999ee;_0x2bb3c8[_0x38725e][_0x243908(0x12a)]=_0xbd1b9;}),_0x2d494a['forEach']((_0x19da7d,_0x48a6b5)=>{_0x2bb3c8[_0x48a6b5]['primary_code']=_0x19da7d;}),_0x4a990b[_0x4999ee(0x1ee)]((_0x5ad25f,_0x54a1f2)=>{var _0x59ecb1=_0x4999ee;_0x2bb3c8[_0x54a1f2][_0x59ecb1(0x1f9)]=_0x5ad25f;}),_0x2bb3c8['forEach'](_0x510e1b=>{var _0x28129c=_0x4999ee;console[_0x28129c(0x181)](_0x510e1b);const _0x12d4fa=_0x3d767d['product_details']['map'](_0x2c17db=>{var _0x5dbbe7=_0x28129c;_0x2c17db['product_name']==_0x510e1b[_0x5dbbe7(0x153)]&&_0x2c17db[_0x5dbbe7(0xf3)]==_0x510e1b['bay']&&(console['log'](parseInt(_0x2c17db[_0x5dbbe7(0x1b2)])+_0x5dbbe7(0x1aa)+parseInt(_0x510e1b[_0x5dbbe7(0x1b4)])),_0x2c17db[_0x5dbbe7(0x1b2)]=parseInt(_0x2c17db['product_stock'])-parseInt(_0x510e1b[_0x5dbbe7(0x1b4)]));});}),await _0x3d767d[_0x4999ee(0x142)]();var _0x5dc462=0x0;_0x2bb3c8[_0x4999ee(0x1ee)](_0x43964f=>{var _0x5dfe70=_0x4999ee;(parseInt(_0x43964f[_0x5dfe70(0x1a7)])<parseInt(_0x43964f[_0x5dfe70(0x1b4)])||parseInt(_0x43964f[_0x5dfe70(0xfa)])<parseInt(_0x43964f[_0x5dfe70(0x1b4)]))&&_0x5dc462++;});if(_0x5dc462!=0x0)return _0xb5fb2b[_0x4999ee(0x1ef)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x2b6ab9[_0x4999ee(0x112)](_0x4999ee(0x208));const _0x1aab9c=new purchases_return_finished({'invoice':_0x237f3e,'suppliers':_0xb5fb2b['body'][_0x4999ee(0x200)],'date':_0x30da7d,'warehouse_name':_0x5886e8,'return_product':_0x2bb3c8,'note':_0x2425c2,'room':_0x2e0571,'to_warehouse_name':_0x16748a,'to_room':_0x2f2b42}),_0x2a42e4=await _0x1aab9c[_0x4999ee(0x142)](),_0x161e95=await purchases_return_finished['findOne']({'invoice':_0x237f3e}),_0x346841=await warehouse['findOne']({'name':_0x16748a,'room':_0x2f2b42,'warehouse_category':_0x4999ee(0x17d)});_0x161e95[_0x4999ee(0xcf)][_0x4999ee(0x1ee)](_0x148c22=>{var _0x42597b=_0x4999ee,_0x1ed758=0x0;const _0x534c1d=_0x346841[_0x42597b(0x192)]['map'](_0x3d2670=>{var _0x5c8f31=_0x42597b;console['log'](_0x3d2670[_0x5c8f31(0x153)]+'=='+_0x148c22[_0x5c8f31(0x153)]+'&&'+_0x3d2670[_0x5c8f31(0xf3)]+'=='+_0x148c22[_0x5c8f31(0xf3)]),_0x3d2670['product_name']==_0x148c22[_0x5c8f31(0x153)]&&_0x3d2670[_0x5c8f31(0xf3)]==_0x148c22['bay']&&(_0x3d2670[_0x5c8f31(0x1b2)]=parseInt(_0x3d2670[_0x5c8f31(0x1b2)])-parseInt(_0x148c22[_0x5c8f31(0x1b4)]),_0x1ed758++);});_0x1ed758=='0'&&(_0x346841[_0x42597b(0x192)]=_0x346841[_0x42597b(0x192)]['concat']({'product_name':_0x148c22[_0x42597b(0x153)],'product_stock':_0x148c22[_0x42597b(0x1b4)],'primary_code':_0x148c22['primary_code'],'secondary_code':_0x148c22[_0x42597b(0x1f9)],'product_code':_0x148c22[_0x42597b(0x12a)],'bay':_0x148c22['bay'],'maxProducts':0xf423f}));}),await _0x346841[_0x4999ee(0x142)]();const _0x123219=await purchases_finished[_0x4999ee(0x10f)]({'invoice':_0x237f3e});_0x123219['return_data']=_0x4999ee(0x16b);const _0x133ad9=await _0x123219[_0x4999ee(0x142)](),_0x4d40a3=new s_payment_data({'invoice':_0x237f3e,'suppliers':_0xb5fb2b[_0x4999ee(0x1c0)]['suppliers'],'reason':_0x4999ee(0x13f)});await _0x4d40a3['save']();const _0x10b6d7=await master_shop[_0x4999ee(0x16c)](),_0x37fb52=await email_settings[_0x4999ee(0x10f)](),_0x73de76=await suppliers['findOne']({'name':_0xb5fb2b[_0x4999ee(0x1c0)][_0x4999ee(0x200)]});_0x10b6d7[0x0][_0x4999ee(0x1d9)]==0x1?(right_currency=_0x10b6d7[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x10b6d7[0x0][_0x4999ee(0x195)]);var _0x23f73f=_0x30fccc,_0x363ed3=_0x5c427c,_0x4a1dd9='',_0x389fd8;for(_0x389fd8 in _0x23f73f){_0x4a1dd9+='<tr>'+_0x4999ee(0xfd)+_0x23f73f[_0x389fd8]+_0x4999ee(0x1e1)+_0x4999ee(0xfd)+_0x363ed3[_0x389fd8]+'</td>'+_0x4999ee(0x18b);}let _0x3d2b4d=nodemailer[_0x4999ee(0x1f4)]({'service':_0x4999ee(0x106),'auth':{'user':_0x37fb52['email'],'pass':_0x37fb52[_0x4999ee(0x18f)]}}),_0x34e373={'from':_0x37fb52['email'],'to':_0x73de76['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x4999ee(0x143)+_0x4999ee(0xd8)+_0x10b6d7[0x0][_0x4999ee(0x17c)],'cid':_0x4999ee(0x1a6)}],'html':'<!DOCTYPE\x20html>'+_0x4999ee(0x166)+_0x4999ee(0xda)+_0x4999ee(0x1f6)+_0x4999ee(0x125)+_0x4999ee(0x1f6)+_0x4999ee(0x18d)+_0x4999ee(0x159)+_0x4999ee(0x1f6)+_0x4999ee(0xf0)+_0x10b6d7[0x0][_0x4999ee(0x1de)]+_0x4999ee(0x11c)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x4999ee(0x108)+_0x4999ee(0x13b)+_0x237f3e+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4999ee(0x20c)+_0x30da7d+'\x20'+_0x4999ee(0x1bc)+_0x4999ee(0xe2)+_0x4999ee(0x159)+_0x4999ee(0x10d)+_0x4999ee(0x19e)+_0x4999ee(0x15b)+_0x4999ee(0x1a0)+_0x4999ee(0x1d3)+_0x4999ee(0x1c4)+_0x4999ee(0xd2)+_0x4999ee(0x18b)+_0x4999ee(0x10e)+_0x4999ee(0x17a)+'\x20'+_0x4a1dd9+'\x20'+_0x4999ee(0x132)+_0x4999ee(0x1ed)+_0x4999ee(0x1f6)+_0x4999ee(0x180)+_0x4999ee(0x113)+_0x10b6d7[0x0][_0x4999ee(0x1de)]+'</h5>'+_0x4999ee(0x159)+_0x4999ee(0x159)+_0x4999ee(0x1fa)};_0x3d2b4d['sendMail'](_0x34e373,function(_0x241207,_0x558302){var _0x59946b=_0x4999ee;_0x241207?console[_0x59946b(0x181)](_0x59946b(0x162)):console[_0x59946b(0x181)](_0x59946b(0x137));}),_0xb5fb2b[_0x4999ee(0x1ef)](_0x4999ee(0x1f5),'purchases\x20item\x20return\x20successfull'),_0x2b6ab9[_0x4999ee(0x112)]('/all_purchases_finished/view');}catch(_0x5537e4){_0x2b6ab9[_0x4999ee(0xf6)](0xc8)[_0x4999ee(0x1df)]({'message':_0x5537e4[_0x4999ee(0x134)]});}}),router[a0_0x195c2d(0x1e3)](a0_0x195c2d(0x1f1),auth,async(_0x4d9f72,_0x1054af)=>{var _0x865d6d=a0_0x195c2d;try{const {username:_0x263852,email:_0x47a39f,role:_0xd7c470}=_0x4d9f72[_0x865d6d(0x102)],_0x180e39=_0x4d9f72[_0x865d6d(0x102)],_0x51eaff=await profile['findOne']({'email':_0x180e39[_0x865d6d(0x11d)]}),_0x2c1da=await master_shop[_0x865d6d(0x16c)](),_0x520825=_0x4d9f72[_0x865d6d(0xdf)]['id'],_0x2e8b76=await purchases_finished[_0x865d6d(0xd6)](_0x520825);if(_0x2c1da[0x0][_0x865d6d(0x1c1)]==_0x865d6d(0x1d0))var _0x3a9b72=users[_0x865d6d(0xdb)];else{if(_0x2c1da[0x0][_0x865d6d(0x1c1)]==_0x865d6d(0x1d7))var _0x3a9b72=users[_0x865d6d(0x1d7)];else{if(_0x2c1da[0x0][_0x865d6d(0x1c1)]==_0x865d6d(0x1c8))var _0x3a9b72=users['German'];else{if(_0x2c1da[0x0][_0x865d6d(0x1c1)]==_0x865d6d(0x1cf))var _0x3a9b72=users['Spanish'];else{if(_0x2c1da[0x0][_0x865d6d(0x1c1)]==_0x865d6d(0x165))var _0x3a9b72=users[_0x865d6d(0x165)];else{if(_0x2c1da[0x0][_0x865d6d(0x1c1)]==_0x865d6d(0xde))var _0x3a9b72=users[_0x865d6d(0x1fe)];else{if(_0x2c1da[0x0]['language']=='Chinese')var _0x3a9b72=users[_0x865d6d(0x17f)];else{if(_0x2c1da[0x0]['language']==_0x865d6d(0x136))var _0x3a9b72=users[_0x865d6d(0x1e9)];}}}}}}}_0x1054af[_0x865d6d(0x1bb)](_0x865d6d(0x158),{'success':_0x4d9f72[_0x865d6d(0x1ef)](_0x865d6d(0x1f5)),'errors':_0x4d9f72[_0x865d6d(0x1ef)](_0x865d6d(0x161)),'role':_0x180e39,'profile':_0x51eaff,'alldata':_0x2e8b76,'master_shop':_0x2c1da,'language':_0x3a9b72}),console[_0x865d6d(0x181)](alldata);}catch(_0x5c59d1){console[_0x865d6d(0x181)](_0x5c59d1);}}),router[a0_0x195c2d(0x15e)](a0_0x195c2d(0x13c),async(_0xe63956,_0x40aff6)=>{var _0x4fa2ed=a0_0x195c2d;const {product_code:_0x541d0d}=_0xe63956[_0x4fa2ed(0x1c0)];var _0x41283a;const _0x38b326=await product[_0x4fa2ed(0xd7)]([{'$match':{'primary_code':_0x541d0d}},{'$group':{'_id':_0x4fa2ed(0x1ec),'name':{'$first':_0x4fa2ed(0x1a2)},'category':{'$first':'$category'},'brand':{'$first':_0x4fa2ed(0x182)},'unit':{'$first':_0x4fa2ed(0x1b3)},'alertquantity':{'$first':_0x4fa2ed(0x1b7)},'product_code':{'$first':_0x4fa2ed(0x10b)},'primary_code':{'$first':_0x4fa2ed(0x1da)},'secondary_code':{'$first':_0x4fa2ed(0x14a)},'maxStocks':{'$first':_0x4fa2ed(0x1fc)},'maxProdPerUnit':{'$first':_0x4fa2ed(0x103)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4fa2ed(0x111)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x4fa2ed(0x148)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x17a8f3=await product[_0x4fa2ed(0xd7)]([{'$match':{'secondary_code':_0x541d0d}},{'$group':{'_id':_0x4fa2ed(0x1ec),'name':{'$first':_0x4fa2ed(0x1a2)},'category':{'$first':_0x4fa2ed(0x197)},'brand':{'$first':_0x4fa2ed(0x182)},'unit':{'$first':_0x4fa2ed(0x1b3)},'alertquantity':{'$first':_0x4fa2ed(0x1b7)},'product_code':{'$first':_0x4fa2ed(0x10b)},'primary_code':{'$first':_0x4fa2ed(0x1da)},'secondary_code':{'$first':_0x4fa2ed(0x14a)},'maxStocks':{'$first':_0x4fa2ed(0x1fc)},'maxProdPerUnit':{'$first':_0x4fa2ed(0x103)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4fa2ed(0x111)},'gross_price':{'$first':_0x4fa2ed(0x14e)},'sales_category':{'$first':_0x4fa2ed(0x148)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x38b326[_0x4fa2ed(0x1a8)]>0x0)_0x41283a=_0x38b326;else _0x17a8f3[_0x4fa2ed(0x1a8)]>0x0&&(_0x41283a=_0x17a8f3);_0x40aff6['json'](_0x41283a);}),router[a0_0x195c2d(0x15e)]('/CheckingWarehouse',async(_0x520ea1,_0x451a02)=>{var _0x4bdb8d=a0_0x195c2d;const {productCode:_0x587da5,bay:_0x4dbbd3,warehouses:_0x43c867,room:_0x9ce184}=_0x520ea1['body'];console['log'](_0x520ea1['body']);try{const _0x43e99f=await warehouse[_0x4bdb8d(0xd7)]([{'$match':{'name':_0x43c867,'room':_0x9ce184}},{'$unwind':_0x4bdb8d(0xd3)},{'$match':{'product_details.bay':parseInt(_0x4dbbd3)}},{'$group':{'_id':_0x4bdb8d(0x1ce),'name':{'$first':_0x4bdb8d(0x1bf)},'product_stock':{'$first':_0x4bdb8d(0x164)},'bay':{'$first':_0x4bdb8d(0x1ba)},'maxProducts':{'$first':_0x4bdb8d(0x1e5)}}}]);_0x451a02[_0x4bdb8d(0xf6)](0xc8)['json'](_0x43e99f);}catch(_0x1d4b1c){_0x451a02[_0x4bdb8d(0xf6)](0x194)['json']({'message':_0x1d4b1c[_0x4bdb8d(0x134)]});}}),router[a0_0x195c2d(0x15e)](a0_0x195c2d(0x1e0),async(_0x4c7359,_0x325d97)=>{var _0x87afd=a0_0x195c2d;const {product_code:_0x4d001a}=_0x4c7359[_0x87afd(0x1c0)];var _0x3539ec;const _0x37c227=await product[_0x87afd(0xd7)]([{'$match':{'primary_code':_0x4d001a,'type_products':_0x87afd(0x181)}},{'$group':{'_id':_0x87afd(0x1ec),'name':{'$first':_0x87afd(0x1a2)},'category':{'$first':_0x87afd(0x197)},'brand':{'$first':'$brand'},'unit':{'$first':_0x87afd(0x1b3)},'alertquantity':{'$first':_0x87afd(0x1b7)},'product_code':{'$first':_0x87afd(0x10b)},'primary_code':{'$first':_0x87afd(0x1da)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x87afd(0x1fc)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x87afd(0x111)},'gross_price':{'$first':_0x87afd(0x14e)},'sales_category':{'$first':_0x87afd(0x148)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x37c227);const _0x134862=await product[_0x87afd(0xd7)]([{'$match':{'secondary_code':_0x4d001a,'type_products':_0x87afd(0x181)}},{'$group':{'_id':'$_id','name':{'$first':_0x87afd(0x1a2)},'category':{'$first':_0x87afd(0x197)},'brand':{'$first':_0x87afd(0x182)},'unit':{'$first':_0x87afd(0x1b3)},'alertquantity':{'$first':_0x87afd(0x1b7)},'product_code':{'$first':_0x87afd(0x10b)},'primary_code':{'$first':_0x87afd(0x1da)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x87afd(0x103)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x87afd(0x111)},'gross_price':{'$first':_0x87afd(0x14e)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x87afd(0xed)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x37c227['length']>0x0)_0x3539ec=_0x37c227;else _0x134862['length']>0x0&&(_0x3539ec=_0x134862);_0x325d97['json'](_0x3539ec);}),module['exports']=router;