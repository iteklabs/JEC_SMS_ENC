var a0_0x533dff=a0_0x22b8;(function(_0x5f3f0f,_0x25c3ee){var _0x48df76=a0_0x22b8,_0x43eee1=_0x5f3f0f();while(!![]){try{var _0x18baf0=-parseInt(_0x48df76(0x286))/0x1+parseInt(_0x48df76(0x309))/0x2*(parseInt(_0x48df76(0x1c9))/0x3)+-parseInt(_0x48df76(0x216))/0x4*(-parseInt(_0x48df76(0x2d7))/0x5)+parseInt(_0x48df76(0x1f4))/0x6*(-parseInt(_0x48df76(0x2f5))/0x7)+-parseInt(_0x48df76(0x1de))/0x8+parseInt(_0x48df76(0x1d7))/0x9*(-parseInt(_0x48df76(0x2d1))/0xa)+parseInt(_0x48df76(0x2b5))/0xb;if(_0x18baf0===_0x25c3ee)break;else _0x43eee1['push'](_0x43eee1['shift']());}catch(_0x37052d){_0x43eee1['push'](_0x43eee1['shift']());}}}(a0_0x29e3,0x7e37a));const express=require(a0_0x533dff(0x22a)),app=express(),router=express[a0_0x533dff(0x26d)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require('../models/all_models'),auth=require(a0_0x533dff(0x261)),nodemailer=require(a0_0x533dff(0x2e1));var ejs=require(a0_0x533dff(0x1ca));const path=require(a0_0x533dff(0x229)),users=require(a0_0x533dff(0x1d2)),{isNull}=require(a0_0x533dff(0x294));router[a0_0x533dff(0x1f3)](a0_0x533dff(0x264),auth,async(_0x206aa7,_0x4bf057)=>{var _0x41e3d5=a0_0x533dff;try{const {username:_0x1828bb,email:_0x2f2699,role:_0x16c468}=_0x206aa7[_0x41e3d5(0x260)],_0x134082=_0x206aa7[_0x41e3d5(0x260)],_0x1a0495=await profile['findOne']({'email':_0x134082[_0x41e3d5(0x288)]}),_0x32a4b5=await staff[_0x41e3d5(0x1d9)]({'email':_0x134082[_0x41e3d5(0x288)]}),_0x345c56=await master_shop[_0x41e3d5(0x1f1)]();let _0x17beef=await transfers_finished[_0x41e3d5(0x1f2)]([{'$match':{'to_warehouse':_0x32a4b5[_0x41e3d5(0x2a9)]}}]);if(_0x345c56[0x0][_0x41e3d5(0x2b2)]==_0x41e3d5(0x256))var _0x41655c=users[_0x41e3d5(0x29d)];else{if(_0x345c56[0x0][_0x41e3d5(0x2b2)]=='Hindi')var _0x41655c=users[_0x41e3d5(0x27e)];else{if(_0x345c56[0x0][_0x41e3d5(0x2b2)]==_0x41e3d5(0x28e))var _0x41655c=users[_0x41e3d5(0x28e)];else{if(_0x345c56[0x0][_0x41e3d5(0x2b2)]==_0x41e3d5(0x2a5))var _0x41655c=users[_0x41e3d5(0x2a5)];else{if(_0x345c56[0x0]['language']==_0x41e3d5(0x310))var _0x41655c=users['French'];else{if(_0x345c56[0x0]['language']==_0x41e3d5(0x1ed))var _0x41655c=users['Portuguese'];else{if(_0x345c56[0x0][_0x41e3d5(0x2b2)]==_0x41e3d5(0x227))var _0x41655c=users[_0x41e3d5(0x227)];else{if(_0x345c56[0x0][_0x41e3d5(0x2b2)]=='Arabic\x20(ae)')var _0x41655c=users['Arabic'];}}}}}}}_0x4bf057['render'](_0x41e3d5(0x23d),{'success':_0x206aa7[_0x41e3d5(0x201)](_0x41e3d5(0x285)),'errors':_0x206aa7[_0x41e3d5(0x201)](_0x41e3d5(0x2b6)),'purchases':_0x17beef,'role':_0x134082,'profile':_0x1a0495,'master_shop':_0x345c56,'language':_0x41655c,'staff_data':_0x32a4b5});}catch(_0x683f45){console[_0x41e3d5(0x20f)](_0x41e3d5(0x26e),_0x683f45),_0x4bf057[_0x41e3d5(0x1d8)](0xc8)[_0x41e3d5(0x28d)]({'message':_0x683f45[_0x41e3d5(0x217)]});}}),router[a0_0x533dff(0x1f3)](a0_0x533dff(0x234),auth,async(_0x55896b,_0x55ec90)=>{var _0x43bdc1=a0_0x533dff;try{const {username:_0x66b3ca,email:_0x47fb75,role:_0x23b31c}=_0x55896b[_0x43bdc1(0x260)],_0x22a508=_0x55896b[_0x43bdc1(0x260)],_0xe77f64=await profile['findOne']({'email':_0x22a508[_0x43bdc1(0x288)]}),_0x383a25=await staff[_0x43bdc1(0x1d9)]({'email':_0x22a508[_0x43bdc1(0x288)]}),_0x3b7645=await master_shop[_0x43bdc1(0x1f1)]();let _0x50bcb8=await transfers_finished[_0x43bdc1(0x1f2)]([{'$match':{'to_warehouse':_0x383a25['warehouse'],'to_recieved':'false'}}]);if(_0x3b7645[0x0]['language']=='English\x20(US)')var _0xa5b5d9=users[_0x43bdc1(0x29d)];else{if(_0x3b7645[0x0]['language']==_0x43bdc1(0x27e))var _0xa5b5d9=users[_0x43bdc1(0x27e)];else{if(_0x3b7645[0x0]['language']==_0x43bdc1(0x28e))var _0xa5b5d9=users[_0x43bdc1(0x28e)];else{if(_0x3b7645[0x0][_0x43bdc1(0x2b2)]=='Spanish')var _0xa5b5d9=users[_0x43bdc1(0x2a5)];else{if(_0x3b7645[0x0][_0x43bdc1(0x2b2)]==_0x43bdc1(0x310))var _0xa5b5d9=users[_0x43bdc1(0x310)];else{if(_0x3b7645[0x0][_0x43bdc1(0x2b2)]=='Portuguese\x20(BR)')var _0xa5b5d9=users[_0x43bdc1(0x27c)];else{if(_0x3b7645[0x0][_0x43bdc1(0x2b2)]=='Chinese')var _0xa5b5d9=users[_0x43bdc1(0x227)];else{if(_0x3b7645[0x0]['language']==_0x43bdc1(0x2fc))var _0xa5b5d9=users[_0x43bdc1(0x274)];}}}}}}}_0x55ec90[_0x43bdc1(0x287)](_0x43bdc1(0x27a),{'success':_0x55896b[_0x43bdc1(0x201)](_0x43bdc1(0x285)),'errors':_0x55896b['flash'](_0x43bdc1(0x2b6)),'purchases':_0x50bcb8,'role':_0x22a508,'profile':_0xe77f64,'master_shop':_0x3b7645,'language':_0xa5b5d9,'staff_data':_0x383a25});}catch(_0x114dc2){console[_0x43bdc1(0x20f)]('table\x20page',_0x114dc2),_0x55ec90[_0x43bdc1(0x1d8)](0xc8)[_0x43bdc1(0x28d)]({'message':_0x114dc2[_0x43bdc1(0x217)]});}});function a0_0x22b8(_0x421ddb,_0x258329){var _0x29e3a6=a0_0x29e3();return a0_0x22b8=function(_0x22b8fe,_0x331ba1){_0x22b8fe=_0x22b8fe-0x1c9;var _0xd61b9f=_0x29e3a6[_0x22b8fe];return _0xd61b9f;},a0_0x22b8(_0x421ddb,_0x258329);}const createLog=async _0x5e1253=>{var _0x42d3e0=a0_0x533dff;const _0x5a8580=new datalogs({'location':_0x5e1253});return await _0x5a8580[_0x42d3e0(0x2af)](),_0x5a8580[_0x42d3e0(0x1d3)];};router[a0_0x533dff(0x277)](a0_0x533dff(0x234),auth,async(_0xea8e12,_0x4d6ace)=>{var _0x4415cc=a0_0x533dff;try{const {invoice_trf_data:_0x119109,item_code:_0x280a96,SCRN:_0x72e063,ReqBy:_0x573df2,type_of_products:_0x26bad0,dateofreq:_0x5d2a12,PO_number:_0xe03103,date:_0x491154,warehouse_name:_0x310153,typeservicesData:_0x57f977,typevehicle:_0x257c00,driver:_0xf0f8f3,plate:_0x448c4e,van:_0x25c59d,DRSI:_0x49bcf4,TSU:_0x5b542a,TFU:_0x962107,note:_0x24af74}=_0xea8e12[_0x4415cc(0x281)],_0x2dc3d9=await transfers_finished[_0x4415cc(0x29b)](_0x119109);if(typeof _0x280a96=='string')var _0x1c8bb5=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x231)]],_0x12fed8=[_0xea8e12['body']['item_code']],_0xf90a31=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x238)]],_0x2890cc=[_0xea8e12['body'][_0x4415cc(0x1f6)]],_0x152690=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x252)]],_0x5caa8c=[_0xea8e12['body'][_0x4415cc(0x28b)]],_0x1f5a61=[_0xea8e12[_0x4415cc(0x281)]['primary_code']],_0x5cd424=[_0xea8e12['body'][_0x4415cc(0x1dd)]],_0x59af46=[_0xea8e12['body'][_0x4415cc(0x2d4)]],_0x205ac7=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x248)]],_0x43a574=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x311)]],_0x24c04c=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x2c6)]],_0x159f16=[_0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x250)]];else var _0x1c8bb5=[..._0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x231)]],_0x12fed8=[..._0xea8e12['body'][_0x4415cc(0x297)]],_0xf90a31=[..._0xea8e12[_0x4415cc(0x281)]['to_quantity']],_0x2890cc=[..._0xea8e12['body'][_0x4415cc(0x1f6)]],_0x152690=[..._0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x252)]],_0x5caa8c=[..._0xea8e12[_0x4415cc(0x281)]['bin']],_0x1f5a61=[..._0xea8e12[_0x4415cc(0x281)]['primary_code']],_0x5cd424=[..._0xea8e12[_0x4415cc(0x281)]['secondary_code']],_0x59af46=[..._0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x2d4)]],_0x205ac7=[..._0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x248)]],_0x43a574=[..._0xea8e12[_0x4415cc(0x281)][_0x4415cc(0x311)]],_0x24c04c=[..._0xea8e12[_0x4415cc(0x281)]['max_product_unit']],_0x159f16=[..._0xea8e12['body'][_0x4415cc(0x250)]];const _0x3b53b4=_0x1c8bb5[_0x4415cc(0x2ec)](_0x41a353=>{return _0x41a353={'product_name':_0x41a353};});_0x12fed8[_0x4415cc(0x241)]((_0x5829ba,_0x4c905b)=>{var _0x5d2845=_0x4415cc;_0x3b53b4[_0x4c905b][_0x5d2845(0x257)]=_0x5829ba;}),_0xf90a31['forEach']((_0x11b701,_0x238877)=>{var _0x12d9dd=_0x4415cc;_0x3b53b4[_0x238877][_0x12d9dd(0x2b0)]=Math[_0x12d9dd(0x302)](_0x11b701);}),_0x2890cc['forEach']((_0x1e356e,_0x4ba184)=>{var _0x4aafb9=_0x4415cc;_0x3b53b4[_0x4ba184][_0x4aafb9(0x221)]=_0x1e356e;}),_0x152690[_0x4415cc(0x241)]((_0x6d2c3a,_0x39a16d)=>{_0x3b53b4[_0x39a16d]['secondary_unit']=_0x6d2c3a;}),_0x5caa8c[_0x4415cc(0x241)]((_0x16cba6,_0x4a9606)=>{var _0x5877a6=_0x4415cc,_0x482fff=_0x16cba6[_0x5877a6(0x21c)](/[A-Za-z]+/)[0x0],_0x57ea89=parseInt(_0x16cba6[_0x5877a6(0x21c)](/\d+/)[0x0]);_0x3b53b4[_0x4a9606]['level']=_0x482fff,_0x3b53b4[_0x4a9606][_0x5877a6(0x1f7)]=_0x57ea89;}),_0x1f5a61[_0x4415cc(0x241)]((_0x2b46ac,_0xc27f24)=>{var _0x242153=_0x4415cc;_0x3b53b4[_0xc27f24][_0x242153(0x244)]=_0x2b46ac;}),_0x5cd424['forEach']((_0x4e494f,_0x34ade9)=>{var _0x57bec7=_0x4415cc;_0x3b53b4[_0x34ade9][_0x57bec7(0x1dd)]=_0x4e494f;}),_0x59af46[_0x4415cc(0x241)]((_0x2182ae,_0x3b9fed)=>{var _0x2e61c2=_0x4415cc;_0x3b53b4[_0x3b9fed][_0x2e61c2(0x2d4)]=_0x2182ae;}),_0x205ac7[_0x4415cc(0x241)]((_0x2beb00,_0x9ed053)=>{var _0x5b30d1=_0x4415cc;_0x3b53b4[_0x9ed053][_0x5b30d1(0x248)]=_0x2beb00;}),_0x43a574[_0x4415cc(0x241)]((_0x47eabe,_0x4b1039)=>{var _0x6b2e8=_0x4415cc;_0x3b53b4[_0x4b1039][_0x6b2e8(0x311)]=_0x47eabe;}),_0x24c04c[_0x4415cc(0x241)]((_0x3da96b,_0x3cce3e)=>{_0x3b53b4[_0x3cce3e]['maxperunit']=_0x3da96b;}),_0x159f16[_0x4415cc(0x241)]((_0x36d931,_0x40bcca)=>{_0x3b53b4[_0x40bcca]['room_name']=_0x36d931;});const _0x5017e1=await createLog(_0x4415cc(0x2e3));_0x159f16[_0x4415cc(0x241)]((_0xa53bc8,_0x19dd70)=>{var _0x5b716b=_0x4415cc;_0x3b53b4[_0x19dd70][_0x5b716b(0x2f7)]=_0x5b716b(0x228)+_0x5017e1[_0x5b716b(0x255)]()['padStart'](0x8,'0');});const _0x48286f=_0x3b53b4[_0x4415cc(0x2d8)](_0x17d522=>_0x17d522[_0x4415cc(0x2b0)]!=='0'&&_0x17d522['quantity']!==''),_0x1a5d57=new purchases_incoming({'invoice':'INC-'+_0x5017e1['toString']()[_0x4415cc(0x208)](0x8,'0'),'date':_0x491154,'warehouse_name':_0x310153,'product':_0x48286f,'note':_0x24af74,'POnumber':_0xe03103,'SCRN':_0x72e063,'ReqBy':_0x573df2,'dateofreq':_0x5d2a12,'typeservicesData':_0x57f977,'van':_0x25c59d,'typevehicle':_0x257c00,'driver':_0xf0f8f3,'plate':_0x448c4e,'DRSI':_0x49bcf4,'TSU':_0x5b542a,'TFU':_0x962107,'typeOfProducts':_0x26bad0}),_0x4aeb27=await _0x1a5d57[_0x4415cc(0x2af)](),_0x215562=_0x4aeb27['product'][_0x4415cc(0x2ec)](async _0xa49cc6=>{var _0x8d35d7=_0x4415cc,_0x3ae99c=await warehouse[_0x8d35d7(0x1d9)]({'name':_0x310153,'room':_0xa49cc6[_0x8d35d7(0x25c)]});if(_0xa49cc6[_0x8d35d7(0x2b0)]>0x0){var _0x2dad4f=0x0;const _0x49aafc=_0x3ae99c[_0x8d35d7(0x2d2)][_0x8d35d7(0x2ec)](_0x14f3d9=>{var _0xf51b48=_0x8d35d7;_0x14f3d9['product_name']==_0xa49cc6['product_name']&&_0x14f3d9[_0xf51b48(0x1f7)]==_0xa49cc6['to_bay']&&_0x14f3d9[_0xf51b48(0x248)]==_0xa49cc6['expiry_date']&&_0x14f3d9['production_date']==_0xa49cc6[_0xf51b48(0x311)]&&_0x14f3d9[_0xf51b48(0x2d4)]==_0xa49cc6[_0xf51b48(0x2d4)]&&_0x14f3d9[_0xf51b48(0x2f7)]==_0xa49cc6['invoice']&&(typeof _0xa49cc6[_0xf51b48(0x316)]==_0xf51b48(0x251)?(console[_0xf51b48(0x20f)]('here2',_0x14f3d9[_0xf51b48(0x1d4)]+_0xf51b48(0x2d0)+_0x14f3d9['_id']+_0xf51b48(0x291)+Math[_0xf51b48(0x302)](_0x14f3d9['product_stock'])+Math[_0xf51b48(0x302)](_0xa49cc6[_0xf51b48(0x238)])),_0x14f3d9[_0xf51b48(0x1d4)]=Math[_0xf51b48(0x302)](_0x14f3d9[_0xf51b48(0x1d4)])+Math['abs'](_0xa49cc6[_0xf51b48(0x2b0)])):(_0x14f3d9[_0xf51b48(0x1d4)]=Math['abs'](_0x14f3d9[_0xf51b48(0x1d4)])+Math['abs'](_0xa49cc6[_0xf51b48(0x2b0)]),_0x2dad4f++));});_0x2dad4f=='0'&&(_0x3ae99c[_0x8d35d7(0x2d2)]=_0x3ae99c[_0x8d35d7(0x2d2)][_0x8d35d7(0x222)]({'product_name':_0xa49cc6[_0x8d35d7(0x231)],'product_stock':_0xa49cc6[_0x8d35d7(0x2b0)],'bay':_0xa49cc6['bay'],'level':_0xa49cc6[_0x8d35d7(0x1f8)],'product_code':_0xa49cc6['product_code'],'primary_code':_0xa49cc6[_0x8d35d7(0x244)],'secondary_code':_0xa49cc6[_0x8d35d7(0x1dd)],'expiry_date':_0xa49cc6['expiry_date'],'production_date':_0xa49cc6[_0x8d35d7(0x311)],'maxProducts':_0xa49cc6[_0x8d35d7(0x2e5)],'batch_code':_0xa49cc6[_0x8d35d7(0x2d4)],'secondary_unit':_0xa49cc6[_0x8d35d7(0x305)],'unit':_0xa49cc6[_0x8d35d7(0x221)],'maxProducts':_0xa49cc6[_0x8d35d7(0x2e5)],'maxPerUnit':_0xa49cc6[_0x8d35d7(0x2ef)],'invoice':_0xa49cc6[_0x8d35d7(0x2f7)]}));}return _0x3ae99c;});Promise[_0x4415cc(0x267)](_0x215562)[_0x4415cc(0x2e0)](async _0x44f7e5=>{var _0x4b063b=_0x4415cc;try{for(const _0x117500 of _0x44f7e5){await warehouse['updateOne']({'_id':_0x117500[_0x4b063b(0x270)]},{'$addToSet':{'product_details':{'$each':_0x117500[_0x4b063b(0x2d2)]}}});}_0x2dc3d9['to_recieved']=_0x4b063b(0x23a);const _0xcc61af=await _0x2dc3d9['save'](),_0x52fce0=await master_shop[_0x4b063b(0x1f1)](),_0x37a7ec=await email_settings['findOne'](),_0x46352c=await supervisor_settings[_0x4b063b(0x1f1)]();var _0x2d8273=_0x1a5d57[_0x4b063b(0x1d0)],_0x25e3e0='',_0x2027ec;for(_0x2027ec in _0x2d8273){var _0xaad8dd='FG';_0x1a5d57[_0x4b063b(0x1eb)]==_0x4b063b(0x25b)&&(_0xaad8dd='DG'),_0x25e3e0+=_0x4b063b(0x2f6)+_0x4b063b(0x275)+_0x2d8273[_0x2027ec][_0x4b063b(0x231)]+_0x4b063b(0x30a)+_0x4b063b(0x275)+_0x2d8273[_0x2027ec]['product_code']+_0x4b063b(0x30a)+_0x4b063b(0x275)+_0x2d8273[_0x2027ec]['to_quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d8273[_0x2027ec][_0x4b063b(0x1f6)]+_0x4b063b(0x30a)+_0x4b063b(0x275)+_0x2d8273[_0x2027ec][_0x4b063b(0x305)]+_0x4b063b(0x30a)+_0x4b063b(0x275)+_0x1a5d57['to_warehouse']+_0x4b063b(0x30a)+_0x4b063b(0x275)+_0x2d8273[_0x2027ec][_0x4b063b(0x2fe)]+_0x4b063b(0x30a)+_0x4b063b(0x275)+_0xaad8dd+_0x2d8273[_0x2027ec][_0x4b063b(0x1dc)]+_0x4b063b(0x30a)+_0x4b063b(0x1ea);}_0xea8e12[_0x4b063b(0x201)](_0x4b063b(0x285),'Transfer\x20Finalize\x20Successfully'),_0x4d6ace[_0x4b063b(0x2bb)](_0x4b063b(0x2cb)+_0x4aeb27[_0x4b063b(0x270)]);}catch(_0x1d2c36){console[_0x4b063b(0x22f)](_0x1d2c36),_0x4d6ace[_0x4b063b(0x1d8)](0x1f4)[_0x4b063b(0x28d)]({'error':_0x4b063b(0x215)});}})[_0x4415cc(0x253)](_0x9bacd1=>{var _0x3b2021=_0x4415cc;console['error'](_0x9bacd1),_0x4d6ace['status'](0x1f4)[_0x3b2021(0x28d)]({'error':_0x3b2021(0x24b)});});}catch(_0xf74096){}}),router[a0_0x533dff(0x277)](a0_0x533dff(0x2c7),auth,async(_0x453919,_0x36f4cb)=>{var _0x1bdd79=a0_0x533dff;try{const {warehouse:_0x54470b}=_0x453919[_0x1bdd79(0x281)],_0x1ca3fc=await transfers_finished[_0x1bdd79(0x1f1)]({'to_warehouse':_0x54470b,'to_recieved':'false'});_0x36f4cb[_0x1bdd79(0x28d)](_0x1ca3fc);}catch(_0xc963e0){}}),router['post'](a0_0x533dff(0x2a7),auth,async(_0x320493,_0x463645)=>{var _0x31061a=a0_0x533dff;try{const {invoice:_0x4b04c5}=_0x320493[_0x31061a(0x281)],_0x385c52=await transfers_finished[_0x31061a(0x1f1)]({'_id':_0x4b04c5,'to_recieved':_0x31061a(0x202)});_0x463645[_0x31061a(0x28d)](_0x385c52);}catch(_0x1f5118){}}),router['get'](a0_0x533dff(0x245),auth,async(_0x41c296,_0x404899)=>{var _0x40b5d8=a0_0x533dff;try{const {username:_0x4bb702,email:_0x3b3259,role:_0x10f594}=_0x41c296[_0x40b5d8(0x260)],_0x1c6e01=_0x41c296[_0x40b5d8(0x260)],_0x370aee=await profile[_0x40b5d8(0x1d9)]({'email':_0x1c6e01[_0x40b5d8(0x288)]}),_0x2496f7=await staff[_0x40b5d8(0x1d9)]({'email':_0x1c6e01[_0x40b5d8(0x288)]});if(_0x1c6e01[_0x40b5d8(0x210)]==_0x40b5d8(0x2ff)){const _0x205b0d=await staff['findOne']({'email':_0x1c6e01[_0x40b5d8(0x288)]});}const _0x44d488=await master_shop[_0x40b5d8(0x1f1)]();let _0x6a6d43;if(_0x1c6e01['role']==_0x40b5d8(0x2ff)){const _0x221a47=await staff[_0x40b5d8(0x1d9)]({'email':_0x1c6e01[_0x40b5d8(0x288)]});_0x6a6d43=await purchases_finished[_0x40b5d8(0x1f2)]([{'$match':{'warehouse_name':_0x221a47[_0x40b5d8(0x2a9)],'typeOfProducts':_0x40b5d8(0x290)}},{'$lookup':{'from':_0x40b5d8(0x22b),'localField':_0x40b5d8(0x22b),'foreignField':_0x40b5d8(0x2f1),'as':_0x40b5d8(0x2b4)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x40b5d8(0x223)},{'$group':{'_id':'$_id','invoice':{'$first':_0x40b5d8(0x1f5)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x40b5d8(0x2c5)},'warehouse_name':{'$first':_0x40b5d8(0x265)},'room':{'$first':_0x40b5d8(0x23b)},'product':{'$push':_0x40b5d8(0x223)},'note':{'$first':_0x40b5d8(0x26b)},'paid_amount':{'$first':_0x40b5d8(0x2e8)},'due_amount':{'$first':_0x40b5d8(0x232)},'return_data':{'$first':_0x40b5d8(0x2f4)},'batch_code':{'$first':_0x40b5d8(0x2a1)},'expiry_date':{'$first':_0x40b5d8(0x236)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x40b5d8(0x30e)},'level':{'$addToSet':_0x40b5d8(0x2dc)},'isle':{'$addToSet':_0x40b5d8(0x269)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x40b5d8(0x243)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x6a6d43=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x40b5d8(0x290)}},{'$unwind':_0x40b5d8(0x223)},{'$group':{'_id':_0x40b5d8(0x21a),'invoice':{'$first':_0x40b5d8(0x1f5)},'suppliers':{'$first':_0x40b5d8(0x2a6)},'date':{'$first':_0x40b5d8(0x2c5)},'warehouse_name':{'$first':_0x40b5d8(0x265)},'room':{'$addToSet':_0x40b5d8(0x1d5)},'product':{'$push':'$product'},'note':{'$first':_0x40b5d8(0x26b)},'paid_amount':{'$first':_0x40b5d8(0x2e8)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x40b5d8(0x2f4)},'batch_code':{'$first':_0x40b5d8(0x2a1)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x40b5d8(0x268)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x40b5d8(0x2dc)},'isle':{'$addToSet':_0x40b5d8(0x269)},'type':{'$addToSet':_0x40b5d8(0x1e0)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x44d488[0x0][_0x40b5d8(0x2b2)]==_0x40b5d8(0x256))var _0x526c5e=users[_0x40b5d8(0x29d)];else{if(_0x44d488[0x0]['language']==_0x40b5d8(0x27e))var _0x526c5e=users['Hindi'];else{if(_0x44d488[0x0][_0x40b5d8(0x2b2)]==_0x40b5d8(0x28e))var _0x526c5e=users[_0x40b5d8(0x28e)];else{if(_0x44d488[0x0][_0x40b5d8(0x2b2)]=='Spanish')var _0x526c5e=users[_0x40b5d8(0x2a5)];else{if(_0x44d488[0x0][_0x40b5d8(0x2b2)]==_0x40b5d8(0x310))var _0x526c5e=users[_0x40b5d8(0x310)];else{if(_0x44d488[0x0][_0x40b5d8(0x2b2)]=='Portuguese\x20(BR)')var _0x526c5e=users['Portuguese'];else{if(_0x44d488[0x0][_0x40b5d8(0x2b2)]==_0x40b5d8(0x227))var _0x526c5e=users['Chinese'];else{if(_0x44d488[0x0][_0x40b5d8(0x2b2)]==_0x40b5d8(0x2fc))var _0x526c5e=users['Arabic'];}}}}}}}_0x404899[_0x40b5d8(0x287)](_0x40b5d8(0x317),{'success':_0x41c296[_0x40b5d8(0x201)](_0x40b5d8(0x285)),'errors':_0x41c296[_0x40b5d8(0x201)](_0x40b5d8(0x2b6)),'purchases':_0x6a6d43,'role':_0x1c6e01,'profile':_0x370aee,'master_shop':_0x44d488,'language':_0x526c5e});}catch(_0x103d90){console[_0x40b5d8(0x20f)](_0x40b5d8(0x26e),_0x103d90),_0x404899[_0x40b5d8(0x1d8)](0xc8)['json']({'message':_0x103d90[_0x40b5d8(0x217)]});}}),router[a0_0x533dff(0x1f3)]('/view_log',auth,async(_0x32ade2,_0x38bc41)=>{var _0x4a8319=a0_0x533dff;try{const {username:_0x29e712,email:_0x1aec9a,role:_0xe73002}=_0x32ade2[_0x4a8319(0x260)],_0x49c729=_0x32ade2[_0x4a8319(0x260)],_0x53da29=await profile[_0x4a8319(0x1d9)]({'email':_0x49c729[_0x4a8319(0x288)]}),_0x518811=await staff[_0x4a8319(0x1d9)]({'email':_0x49c729[_0x4a8319(0x288)]});if(_0x49c729[_0x4a8319(0x210)]=='staff'){const _0x18162e=await staff[_0x4a8319(0x1d9)]({'email':_0x49c729[_0x4a8319(0x288)]});}const _0x3052fd=await master_shop[_0x4a8319(0x1f1)]();let _0x1971e9;if(_0x49c729[_0x4a8319(0x210)]==_0x4a8319(0x2ff)){const _0x56b5aa=await staff[_0x4a8319(0x1d9)]({'email':_0x49c729[_0x4a8319(0x288)]});_0x1971e9=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x56b5aa[_0x4a8319(0x2a9)]}},{'$lookup':{'from':_0x4a8319(0x22b),'localField':_0x4a8319(0x22b),'foreignField':_0x4a8319(0x2f1),'as':_0x4a8319(0x2b4)}},{'$unwind':_0x4a8319(0x268)},{'$unwind':_0x4a8319(0x223)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4a8319(0x1f5)},'suppliers':{'$first':_0x4a8319(0x2a6)},'date':{'$first':_0x4a8319(0x2c5)},'warehouse_name':{'$first':_0x4a8319(0x265)},'room':{'$first':_0x4a8319(0x23b)},'product':{'$push':'$product'},'note':{'$first':_0x4a8319(0x26b)},'paid_amount':{'$first':_0x4a8319(0x2e8)},'due_amount':{'$first':_0x4a8319(0x232)},'return_data':{'$first':_0x4a8319(0x2f4)},'batch_code':{'$first':_0x4a8319(0x2a1)},'expiry_date':{'$first':_0x4a8319(0x236)},'suppliers_docs':{'$first':_0x4a8319(0x268)},'total_product_quantity':{'$sum':_0x4a8319(0x30e)},'level':{'$addToSet':_0x4a8319(0x2dc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x4a8319(0x243)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1971e9=await purchases_finished[_0x4a8319(0x1f2)]([{'$match':{'typeOfProducts':_0x4a8319(0x2ac)}},{'$unwind':_0x4a8319(0x223)},{'$group':{'_id':_0x4a8319(0x21a),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4a8319(0x2a6)},'date':{'$first':_0x4a8319(0x2c5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x4a8319(0x1d5)},'product':{'$push':_0x4a8319(0x223)},'note':{'$first':_0x4a8319(0x26b)},'paid_amount':{'$first':_0x4a8319(0x2e8)},'due_amount':{'$first':_0x4a8319(0x232)},'return_data':{'$first':_0x4a8319(0x2f4)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x4a8319(0x236)},'suppliers_docs':{'$first':_0x4a8319(0x268)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4a8319(0x2dc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4a8319(0x1e0)},'floorlevel':{'$addToSet':_0x4a8319(0x243)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3052fd[0x0]['language']==_0x4a8319(0x256))var _0xbd3531=users[_0x4a8319(0x29d)];else{if(_0x3052fd[0x0][_0x4a8319(0x2b2)]=='Hindi')var _0xbd3531=users[_0x4a8319(0x27e)];else{if(_0x3052fd[0x0][_0x4a8319(0x2b2)]=='German')var _0xbd3531=users['German'];else{if(_0x3052fd[0x0]['language']=='Spanish')var _0xbd3531=users['Spanish'];else{if(_0x3052fd[0x0][_0x4a8319(0x2b2)]==_0x4a8319(0x310))var _0xbd3531=users[_0x4a8319(0x310)];else{if(_0x3052fd[0x0][_0x4a8319(0x2b2)]==_0x4a8319(0x1ed))var _0xbd3531=users[_0x4a8319(0x27c)];else{if(_0x3052fd[0x0][_0x4a8319(0x2b2)]=='Chinese')var _0xbd3531=users[_0x4a8319(0x227)];else{if(_0x3052fd[0x0][_0x4a8319(0x2b2)]==_0x4a8319(0x2fc))var _0xbd3531=users[_0x4a8319(0x274)];}}}}}}}_0x38bc41[_0x4a8319(0x287)](_0x4a8319(0x21b),{'success':_0x32ade2[_0x4a8319(0x201)]('success'),'errors':_0x32ade2[_0x4a8319(0x201)](_0x4a8319(0x2b6)),'purchases':_0x1971e9,'role':_0x49c729,'profile':_0x53da29,'master_shop':_0x3052fd,'language':_0xbd3531});}catch(_0x38e3d5){console[_0x4a8319(0x20f)](_0x4a8319(0x26e),_0x38e3d5),_0x38bc41[_0x4a8319(0x1d8)](0xc8)[_0x4a8319(0x28d)]({'message':_0x38e3d5['message']});}});function BayBinSelected(_0x1b9646,_0xc98c1b){var _0x35e9e2=a0_0x533dff,_0x4aad4a=[],_0x7f7605=[];if(_0x1b9646==_0x35e9e2(0x25b)){switch(_0xc98c1b){case _0x35e9e2(0x266):_0x4aad4a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x35e9e2(0x2ba):_0x4aad4a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x7f7605=['DG'];}else{if(_0x1b9646=='FROZEN\x20GOODS'){switch(_0xc98c1b){case _0x35e9e2(0x266):_0x4aad4a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x35e9e2(0x2ba):_0x4aad4a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x7f7605=['FG'];}}return{'levels':_0x4aad4a,'identify':_0x7f7605};}async function getRandom8DigitNumber(){var _0x10edb0=a0_0x533dff;const _0x441ad3=0x989680,_0x24ddcb=0x5f5e0ff,_0x20ff1f=Math[_0x10edb0(0x24a)](Math[_0x10edb0(0x2ab)]()*(_0x24ddcb-_0x441ad3+0x1))+_0x441ad3;var _0x1b70ab;const _0x3187ef=await purchases_finished[_0x10edb0(0x1d9)]({'invoice':_0x10edb0(0x279)+_0x20ff1f});return _0x3187ef&&_0x3187ef['length']>0x0?_0x1b70ab=_0x10edb0(0x279)+_0x20ff1f:_0x1b70ab=_0x10edb0(0x279)+_0x20ff1f,_0x1b70ab;}router['get'](a0_0x533dff(0x295),auth,async(_0x38909c,_0x11d5c9)=>{var _0x569ce5=a0_0x533dff;try{const {username:_0x19820d,email:_0x17821c,role:_0x2e4dd4}=_0x38909c[_0x569ce5(0x260)],_0x56c723=_0x38909c[_0x569ce5(0x260)],_0x3cec85=await profile['findOne']({'email':_0x56c723['email']}),_0x6497c5=await master_shop[_0x569ce5(0x1f1)](),_0x1a5281=await staff[_0x569ce5(0x1d9)]({'email':_0x56c723[_0x569ce5(0x288)]}),_0x2f0f11=await suppliers['find']({});let _0x31cb4a;if(_0x56c723[_0x569ce5(0x210)]=='staff'){const _0x4770bb=await staff[_0x569ce5(0x1d9)]({'email':_0x56c723[_0x569ce5(0x288)]});_0x31cb4a=await warehouse[_0x569ce5(0x1f2)]([{'$match':{'status':'Enabled','name':_0x4770bb[_0x569ce5(0x2a9)]}},{'$group':{'_id':'$name','name':{'$first':_0x569ce5(0x1f9)}}}]);}else _0x31cb4a=await warehouse[_0x569ce5(0x1f2)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x569ce5(0x1f9),'name':{'$first':_0x569ce5(0x1f9)}}}]);const _0x1708e3=await product['find']({}),_0x46f5c0=await warehouse[_0x569ce5(0x1f1)]({'status':_0x569ce5(0x2ce)}),_0x35b821=await purchases_finished['find']({}),_0x4e1b94=_0x35b821[_0x569ce5(0x24c)]+0x1,_0x38b551=_0x569ce5(0x279)+_0x4e1b94['toString']()[_0x569ce5(0x208)](0x5,'0');var _0x186548=['Ambient',_0x569ce5(0x2db)];if(_0x6497c5[0x0][_0x569ce5(0x2b2)]=='English\x20(US)')var _0x3f1600=users['English'];else{if(_0x6497c5[0x0]['language']==_0x569ce5(0x27e))var _0x3f1600=users[_0x569ce5(0x27e)];else{if(_0x6497c5[0x0][_0x569ce5(0x2b2)]==_0x569ce5(0x28e))var _0x3f1600=users[_0x569ce5(0x28e)];else{if(_0x6497c5[0x0][_0x569ce5(0x2b2)]==_0x569ce5(0x2a5))var _0x3f1600=users[_0x569ce5(0x2a5)];else{if(_0x6497c5[0x0][_0x569ce5(0x2b2)]=='French')var _0x3f1600=users[_0x569ce5(0x310)];else{if(_0x6497c5[0x0][_0x569ce5(0x2b2)]==_0x569ce5(0x1ed))var _0x3f1600=users[_0x569ce5(0x27c)];else{if(_0x6497c5[0x0]['language']==_0x569ce5(0x227))var _0x3f1600=users[_0x569ce5(0x227)];else{if(_0x6497c5[0x0][_0x569ce5(0x2b2)]==_0x569ce5(0x2fc))var _0x3f1600=users[_0x569ce5(0x274)];}}}}}}}const _0x194eb7=getRandom8DigitNumber(),_0x45ef62=new Date(),_0x3ba8ee={'year':_0x569ce5(0x1cb),'month':'2-digit','day':_0x569ce5(0x30c),'timeZone':_0x569ce5(0x22e)},_0x38c542=_0x45ef62['toLocaleDateString']('en-CA',_0x3ba8ee);console[_0x569ce5(0x20f)](_0x38c542),_0x194eb7[_0x569ce5(0x2e0)](_0x67ab45=>{var _0x2bb1e7=_0x569ce5;_0x11d5c9[_0x2bb1e7(0x287)]('add_purchases_finished',{'success':_0x38909c['flash'](_0x2bb1e7(0x285)),'errors':_0x38909c[_0x2bb1e7(0x201)]('errors'),'role':_0x56c723,'profile':_0x3cec85,'suppliers':_0x2f0f11,'warehouse':_0x31cb4a,'product':_0x1708e3,'invoice':_0x67ab45,'master_shop':_0x6497c5,'language':_0x3f1600,'find_data':_0x46f5c0,'rooms_data':_0x186548,'formattedDate':_0x38c542});})['catch'](_0x54cd21=>{var _0x337954=_0x569ce5;_0x38909c[_0x337954(0x201)](_0x337954(0x2b6),_0x337954(0x272)),_0x11d5c9['redirect']('/all_purchases_finished/view');});}catch(_0x536621){console[_0x569ce5(0x20f)](_0x536621);}}),router[a0_0x533dff(0x1f3)]('/view/add_purchases_logs',auth,async(_0xd88a81,_0x203bc7)=>{var _0x369be3=a0_0x533dff;try{const {username:_0x558085,email:_0x53a17a,role:_0x1f83cf}=_0xd88a81[_0x369be3(0x260)],_0x3dd2f5=_0xd88a81[_0x369be3(0x260)],_0x51ec48=await profile[_0x369be3(0x1d9)]({'email':_0x3dd2f5[_0x369be3(0x288)]}),_0x1b7b44=await master_shop[_0x369be3(0x1f1)](),_0x48a9ea=await staff[_0x369be3(0x1d9)]({'email':_0x3dd2f5[_0x369be3(0x288)]}),_0x522bbc=await suppliers['find']({});let _0x127941;if(_0x3dd2f5[_0x369be3(0x210)]==_0x369be3(0x2ff)){const _0x152747=await staff[_0x369be3(0x1d9)]({'email':_0x3dd2f5[_0x369be3(0x288)]});_0x127941=await warehouse[_0x369be3(0x1f2)]([{'$match':{'status':_0x369be3(0x2ce),'name':_0x152747[_0x369be3(0x2a9)]}},{'$group':{'_id':'$name','name':{'$first':_0x369be3(0x1f9)}}}]);}else _0x127941=await warehouse[_0x369be3(0x1f2)]([{'$match':{'status':_0x369be3(0x2ce)}},{'$group':{'_id':_0x369be3(0x1f9),'name':{'$first':_0x369be3(0x1f9)}}}]);const _0x44a635=await product[_0x369be3(0x1f1)]({}),_0x5c982c=await warehouse[_0x369be3(0x1f1)]({'status':_0x369be3(0x2ce)}),_0x4289e5=await purchases_finished[_0x369be3(0x1f1)]({}),_0x203e17=_0x4289e5[_0x369be3(0x24c)]+0x1,_0x23d907='INCF-'+_0x203e17[_0x369be3(0x255)]()[_0x369be3(0x208)](0x5,'0');var _0x2ec079=['Ambient',_0x369be3(0x2db)];if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x256))var _0x39ce01=users['English'];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x27e))var _0x39ce01=users[_0x369be3(0x27e)];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x28e))var _0x39ce01=users['German'];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]=='Spanish')var _0x39ce01=users[_0x369be3(0x2a5)];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x310))var _0x39ce01=users[_0x369be3(0x310)];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x1ed))var _0x39ce01=users[_0x369be3(0x27c)];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x227))var _0x39ce01=users[_0x369be3(0x227)];else{if(_0x1b7b44[0x0][_0x369be3(0x2b2)]==_0x369be3(0x2fc))var _0x39ce01=users[_0x369be3(0x274)];}}}}}}}const _0x217129=getRandom8DigitNumber();_0x217129[_0x369be3(0x2e0)](_0x579a77=>{var _0x5f25fc=_0x369be3;_0x203bc7[_0x5f25fc(0x287)](_0x5f25fc(0x306),{'success':_0xd88a81['flash'](_0x5f25fc(0x285)),'errors':_0xd88a81[_0x5f25fc(0x201)](_0x5f25fc(0x2b6)),'role':_0x3dd2f5,'profile':_0x51ec48,'suppliers':_0x522bbc,'warehouse':_0x127941,'product':_0x44a635,'invoice':_0x579a77,'master_shop':_0x1b7b44,'language':_0x39ce01,'find_data':_0x5c982c,'rooms_data':_0x2ec079});})[_0x369be3(0x253)](_0x4b0497=>{var _0x54b439=_0x369be3;_0xd88a81[_0x54b439(0x201)](_0x54b439(0x2b6),_0x54b439(0x272)),_0x203bc7[_0x54b439(0x2bb)]('/all_purchases_finished/view');});}catch(_0x33265e){console[_0x369be3(0x20f)](_0x33265e);}}),router[a0_0x533dff(0x1f3)](a0_0x533dff(0x30b),auth,async(_0x2e73de,_0x27a149)=>{var _0x3066b5=a0_0x533dff;try{const _0x335487=_0x2e73de[_0x3066b5(0x2b9)]['id'];console[_0x3066b5(0x20f)](_0x335487);const _0x2ae0d4=await master_shop[_0x3066b5(0x1f1)]();console[_0x3066b5(0x20f)](_0x3066b5(0x24d),_0x2ae0d4);const _0x1893c9=await product['findOne']({'name':_0x335487});console[_0x3066b5(0x20f)](_0x3066b5(0x1d0),_0x1893c9),_0x27a149[_0x3066b5(0x1d8)](0xc8)[_0x3066b5(0x28d)]({'product_data':_0x1893c9,'master':_0x2ae0d4});}catch(_0x432ca1){console[_0x3066b5(0x20f)](_0x3066b5(0x23e),_0x432ca1);}}),router[a0_0x533dff(0x277)](a0_0x533dff(0x295),auth,async(_0x3d08ad,_0x1e6b23)=>{var _0x3d3722=a0_0x533dff;try{const {invoice:_0x28b1f6,date:_0x177601,warehouse_name:_0x205798,prod_name:_0x26841f,note:_0x1fdecc,due_amount:_0x4512ce,Room_name:_0x15723f,PO_number:_0x34d0da,SCRN:_0x206950,ReqBy:_0x486465,dateofreq:_0x3ae07a,suppliers:_0x536e98,typeservicesData:_0x14ac25,van:_0x42d40f,typevehicle:_0x5abdb5,driver:_0x38bb4b,plate:_0x273bae,DRSI:_0x2c58fe,TSU:_0x1281c7,TFU:_0x201198,JO_number:_0x5dc7f4,type_of_products:_0x7f4800}=_0x3d08ad[_0x3d3722(0x281)];if(typeof _0x26841f==_0x3d3722(0x1ff))var _0x215753=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x20d)]],_0x41e585=[_0x3d08ad['body'][_0x3d3722(0x27d)]],_0x383e52=[_0x3d08ad['body'][_0x3d3722(0x1ec)]],_0x5e4ea9=[_0x3d08ad['body'][_0x3d3722(0x20b)]],_0x17bdb8=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x252)]],_0x5b2df4=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x244)]],_0x20e1ee=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x1dd)]],_0x45e9ac=[_0x3d08ad[_0x3d3722(0x281)]['MaxStocks_data']],_0x98aed6=[_0x3d08ad[_0x3d3722(0x281)]['batch_code']],_0x1efb62=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x248)]],_0x1d0147=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x2bc)]],_0x455008=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x2c6)]],_0x2a039c=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x207)]],_0x5610dc=[_0x3d08ad['body'][_0x3d3722(0x2fb)]],_0x173529=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x26a)]],_0xd8e514=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x200)]],_0x34497a=[_0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x296)]];else var _0x215753=[..._0x3d08ad[_0x3d3722(0x281)]['prod_name']],_0x41e585=[..._0x3d08ad[_0x3d3722(0x281)]['prod_code']],_0x383e52=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x1ec)]],_0x5e4ea9=[..._0x3d08ad[_0x3d3722(0x281)]['prod_primunit']],_0x17bdb8=[..._0x3d08ad[_0x3d3722(0x281)]['prod_secondunit']],_0x5b2df4=[..._0x3d08ad['body']['primary_code']],_0x20e1ee=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x1dd)]],_0x45e9ac=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x2e4)]],_0x98aed6=[..._0x3d08ad[_0x3d3722(0x281)]['batch_code']],_0x1efb62=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x248)]],_0x1d0147=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x2bc)]],_0x455008=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x2c6)]],_0x2a039c=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x207)]],_0x5610dc=[..._0x3d08ad[_0x3d3722(0x281)]['gross_price']],_0x173529=[..._0x3d08ad[_0x3d3722(0x281)][_0x3d3722(0x26a)]],_0xd8e514=[..._0x3d08ad[_0x3d3722(0x281)]['sales_data_cateory']],_0x34497a=[..._0x3d08ad['body']['product_id']];const _0x3e0f05=_0x215753[_0x3d3722(0x2ec)](_0x5af507=>{return _0x5af507={'product_name':_0x5af507};});_0x34497a['forEach']((_0x1a6cc8,_0x2a1139)=>{var _0x5e14ae=_0x3d3722;_0x3e0f05[_0x2a1139][_0x5e14ae(0x296)]=_0x1a6cc8,_0x3e0f05[_0x2a1139]['date_recieved']=_0x177601;}),_0xd8e514[_0x3d3722(0x241)]((_0xc97f8c,_0x3bad6f)=>{_0x3e0f05[_0x3bad6f]['sales_category']=_0xc97f8c;}),_0x41e585[_0x3d3722(0x241)]((_0xf918cb,_0x3be8ab)=>{var _0x5e21ed=_0x3d3722;_0x3e0f05[_0x3be8ab][_0x5e21ed(0x257)]=_0xf918cb;}),_0x173529[_0x3d3722(0x241)]((_0x2d18c7,_0x5eb6e4)=>{var _0x2ddb15=_0x3d3722;_0x3e0f05[_0x5eb6e4][_0x2ddb15(0x26a)]=_0x2d18c7;}),_0x383e52[_0x3d3722(0x241)]((_0x46af6e,_0x693710)=>{var _0x17a927=_0x3d3722;_0x3e0f05[_0x693710]['quantity']=Math[_0x17a927(0x302)](_0x46af6e);}),_0x5e4ea9[_0x3d3722(0x241)]((_0x27f2d6,_0x59ef28)=>{var _0x320be2=_0x3d3722;_0x3e0f05[_0x59ef28][_0x320be2(0x221)]=_0x27f2d6;}),_0x17bdb8[_0x3d3722(0x241)]((_0x2e285a,_0x3e5633)=>{var _0x188518=_0x3d3722;_0x3e0f05[_0x3e5633][_0x188518(0x305)]=_0x2e285a;}),_0x5b2df4[_0x3d3722(0x241)]((_0x5a7119,_0x187354)=>{var _0x557982=_0x3d3722;_0x3e0f05[_0x187354][_0x557982(0x244)]=_0x5a7119;}),_0x20e1ee[_0x3d3722(0x241)]((_0x4d5fa8,_0x2bbf24)=>{var _0x3be4b6=_0x3d3722;_0x3e0f05[_0x2bbf24][_0x3be4b6(0x1dd)]=_0x4d5fa8;}),_0x45e9ac[_0x3d3722(0x241)]((_0x119448,_0xfb5c62)=>{_0x3e0f05[_0xfb5c62]['maxStocks']=_0x119448;}),_0x98aed6[_0x3d3722(0x241)]((_0x20bf2d,_0x5cd345)=>{var _0x2736be=_0x3d3722;_0x3e0f05[_0x5cd345][_0x2736be(0x2d4)]=_0x20bf2d;}),_0x1efb62[_0x3d3722(0x241)]((_0x132c5e,_0x1a60d1)=>{_0x3e0f05[_0x1a60d1]['expiry_date']=_0x132c5e;}),_0x1d0147[_0x3d3722(0x241)]((_0x347baf,_0x227534)=>{var _0x1c0fa8=_0x3d3722;_0x3e0f05[_0x227534][_0x1c0fa8(0x311)]=_0x347baf;}),_0x455008[_0x3d3722(0x241)]((_0x472b14,_0x4e265f)=>{var _0x2bec40=_0x3d3722;_0x3e0f05[_0x4e265f][_0x2bec40(0x315)]=_0x472b14;}),_0x2a039c[_0x3d3722(0x241)]((_0x1a27b4,_0x50c369)=>{var _0x1c454b=_0x3d3722;_0x3e0f05[_0x50c369][_0x1c454b(0x2f0)]=_0x1a27b4;}),_0x5610dc[_0x3d3722(0x241)]((_0x27fa46,_0x2eea6b)=>{var _0x376b63=_0x3d3722;_0x3e0f05[_0x2eea6b][_0x376b63(0x2fb)]=_0x27fa46;});const _0x24961b=new invoice_for_incoming();await _0x24961b[_0x3d3722(0x2af)]();for(let _0x108804=0x0;_0x108804<=_0x215753[_0x3d3722(0x24c)]-0x1;_0x108804++){_0x3e0f05[_0x108804]['invoice']=_0x3d3722(0x228)+_0x24961b['invoice_init'][_0x3d3722(0x255)]()['padStart'](0x8,'0');}const _0x2b6b2a=await warehouse_validation_setup[_0x3d3722(0x1f2)]([{'$match':{'warehouse_name':_0x205798}}]);for(let _0x5db907=0x0;_0x5db907<=_0x2b6b2a[_0x3d3722(0x24c)]-0x1;_0x5db907++){const _0x194b69=_0x2b6b2a[_0x5db907];for(let _0x20a1e7=0x0;_0x20a1e7<=_0x194b69['product_data'][_0x3d3722(0x24c)]-0x1;_0x20a1e7++){const _0x5cab5a=_0x194b69[_0x3d3722(0x2ad)][_0x20a1e7],_0x386076=await warehouse[_0x3d3722(0x1f2)]([{'$match':{'name':_0x194b69[_0x3d3722(0x1d6)],'room':_0x194b69['room']}},{'$unwind':_0x3d3722(0x1e6)},{'$match':{'product_details.level':_0x5cab5a[_0x3d3722(0x1f7)],'product_details.bay':parseInt(_0x5cab5a[_0x3d3722(0x28b)]),'product_details.product_code':_0x5cab5a[_0x3d3722(0x257)]}}]);for(let _0x1b369c=0x0;_0x1b369c<=_0x386076[_0x3d3722(0x24c)]-0x1;_0x1b369c++){let _0x16b116=_0x386076[_0x1b369c],_0x170be6=0x0;_0x16b116[_0x3d3722(0x2d2)][_0x3d3722(0x257)]==_0x5cab5a[_0x3d3722(0x257)]&&_0x16b116[_0x3d3722(0x2d2)][_0x3d3722(0x1f7)]==_0x5cab5a['bin']&&_0x16b116['product_details'][_0x3d3722(0x1f8)]==_0x5cab5a['bay']&&(_0x5cab5a[_0x3d3722(0x273)]=parseInt(_0x5cab5a[_0x3d3722(0x273)])-parseInt(_0x16b116[_0x3d3722(0x2d2)]['product_stock']),_0x170be6++),_0x170be6=='0'&&(parseInt(_0x5cab5a[_0x3d3722(0x273)])>0x0&&(_0x2b6b2a[_0x5db907][_0x3d3722(0x2ad)]=_0x2b6b2a[_0x5db907][_0x3d3722(0x2ad)][_0x3d3722(0x222)]({'bay':_0x5cab5a['bay'],'bin':_0x5cab5a[_0x3d3722(0x28b)],'max':_0x5cab5a[_0x3d3722(0x273)],'min':_0x5cab5a['min'],'product_code':_0x5cab5a[_0x3d3722(0x257)],'product_id':_0x5cab5a[_0x3d3722(0x296)],'product_name':_0x5cab5a['product_name']})));}}_0x2b6b2a[_0x5db907]['product_data']=_0x2b6b2a[_0x5db907][_0x3d3722(0x2ad)][_0x3d3722(0x2d8)](_0x40c6d3=>parseInt(_0x40c6d3['max'])>0x0);}for(let _0x5c44e2=0x0;_0x5c44e2<=_0x2b6b2a[_0x3d3722(0x24c)]-0x1;_0x5c44e2++){const _0x3f4f37=_0x2b6b2a[_0x5c44e2];for(let _0x3144fd=0x0;_0x3144fd<=_0x3f4f37[_0x3d3722(0x2ad)]['length']-0x1;_0x3144fd++){const _0x2bb721=_0x3f4f37[_0x3d3722(0x2ad)][_0x3144fd],_0x1f7c3d=await warehouse_temporary[_0x3d3722(0x1f2)]([{'$match':{'warehouse':_0x3f4f37[_0x3d3722(0x1d6)],'room_name':_0x3f4f37[_0x3d3722(0x250)],'isConfirm':'false','data_type':_0x3d3722(0x2e9),'product_code':_0x2bb721[_0x3d3722(0x257)],'level':_0x2bb721[_0x3d3722(0x1f7)],'bay':parseInt(_0x2bb721[_0x3d3722(0x28b)])}}]);for(let _0x1ff68e=0x0;_0x1ff68e<=_0x1f7c3d[_0x3d3722(0x24c)]-0x1;_0x1ff68e++){let _0x3c7445=_0x1f7c3d[_0x1ff68e];console[_0x3d3722(0x20f)](_0x3c7445);let _0x95180c=0x0;_0x3c7445['product_code']==_0x2bb721[_0x3d3722(0x257)]&&_0x3c7445[_0x3d3722(0x1f7)]==_0x2bb721[_0x3d3722(0x28b)]&&_0x3c7445[_0x3d3722(0x1f8)]==_0x2bb721[_0x3d3722(0x1f7)]&&(_0x2bb721[_0x3d3722(0x273)]=parseInt(_0x2bb721[_0x3d3722(0x273)])-parseInt(_0x3c7445[_0x3d3722(0x1d4)]),_0x95180c++),_0x95180c=='0'&&(parseInt(_0x2bb721[_0x3d3722(0x273)])>0x0&&(_0x2b6b2a[_0x5c44e2][_0x3d3722(0x2ad)]=_0x2b6b2a[_0x5c44e2][_0x3d3722(0x2ad)][_0x3d3722(0x222)]({'bay':_0x2bb721[_0x3d3722(0x1f7)],'bin':_0x2bb721['bin'],'max':_0x2bb721[_0x3d3722(0x273)],'min':_0x2bb721[_0x3d3722(0x301)],'product_code':_0x2bb721[_0x3d3722(0x257)],'product_id':_0x2bb721['product_id'],'product_name':_0x2bb721[_0x3d3722(0x231)]})));}}_0x2b6b2a[_0x5c44e2]['product_data']=_0x2b6b2a[_0x5c44e2]['product_data']['filter'](_0x34552e=>parseInt(_0x34552e[_0x3d3722(0x273)])>0x0);}let _0x22d9ce=[],_0x2357ee=0x0;for(let _0x454247=0x0;_0x454247<=_0x3e0f05[_0x3d3722(0x24c)]-0x1;_0x454247++){const _0x4be49a=_0x3e0f05[_0x454247];let _0x3f1449=_0x4be49a[_0x3d3722(0x2b0)];for(let _0x4cc64d=0x0;_0x4cc64d<=_0x2b6b2a[_0x3d3722(0x24c)]-0x1;_0x4cc64d++){const _0x5ca706=_0x2b6b2a[_0x4cc64d];for(let _0x5a15da=0x0;_0x5a15da<=_0x5ca706['product_data'][_0x3d3722(0x24c)]-0x1;_0x5a15da++){const _0x5bec82=_0x5ca706[_0x3d3722(0x2ad)][_0x5a15da];if(_0x5bec82[_0x3d3722(0x257)]===_0x4be49a[_0x3d3722(0x257)]){const _0x1f7a4d=await warehouse[_0x3d3722(0x1f2)]([{'$match':{'name':_0x205798,'room':_0x5ca706[_0x3d3722(0x250)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x5bec82['bay'],'product_details.bay':parseInt(_0x5bec82[_0x3d3722(0x28b)])}}]);if(_0x1f7a4d[_0x3d3722(0x24c)]==0x0){for(let _0x31e8d9=0x0;_0x31e8d9<=_0x5ca706[_0x3d3722(0x2ad)][_0x3d3722(0x24c)]-0x1&&_0x3f1449>0x0;_0x31e8d9++){const _0x4f0930=_0x5ca706['product_data'][_0x31e8d9];console['log'](_0x4be49a[_0x3d3722(0x257)]+_0x3d3722(0x240)+_0x4f0930[_0x3d3722(0x257)]+_0x3d3722(0x2d0)+_0x4f0930[_0x3d3722(0x301)]+'\x20<>\x20'+_0x4f0930['max']+_0x3d3722(0x2d0)+_0x4f0930[_0x3d3722(0x1f7)]+_0x3d3722(0x2d0)+_0x4f0930[_0x3d3722(0x28b)]);if(_0x4be49a[_0x3d3722(0x257)]===_0x4f0930[_0x3d3722(0x257)]){_0x22d9ce[_0x2357ee]={};const _0x2ac886=parseInt(_0x4f0930[_0x3d3722(0x273)]),_0x591af4=0x0;let _0x38090a=_0x2ac886-_0x591af4,_0x456603=Math[_0x3d3722(0x301)](_0x3f1449,_0x38090a);console[_0x3d3722(0x20f)](_0x3d3722(0x225)+_0x456603+_0x3d3722(0x2cc)+_0x4be49a[_0x3d3722(0x231)]+_0x3d3722(0x2d3)+_0x5ca706[_0x3d3722(0x1d6)]+',\x20room:\x20'+_0x5ca706['room']+',\x20bay:\x20'+_0x4f0930[_0x3d3722(0x1f7)]+',\x20bin:\x20'+_0x4f0930[_0x3d3722(0x28b)]+_0x3d3722(0x30d)+_0x2357ee),_0x22d9ce[_0x2357ee][_0x3d3722(0x231)]=_0x4be49a['product_name'],_0x22d9ce[_0x2357ee][_0x3d3722(0x257)]=_0x4be49a['product_code'],_0x22d9ce[_0x2357ee]['product_id']=_0x4be49a[_0x3d3722(0x296)],_0x22d9ce[_0x2357ee][_0x3d3722(0x2eb)]=_0x4be49a[_0x3d3722(0x2eb)],_0x22d9ce[_0x2357ee][_0x3d3722(0x263)]=_0x4be49a[_0x3d3722(0x263)],_0x22d9ce[_0x2357ee][_0x3d3722(0x26a)]=_0x4be49a['uuid'],_0x22d9ce[_0x2357ee][_0x3d3722(0x2b0)]=_0x456603,_0x22d9ce[_0x2357ee]['standard_unit']=_0x4be49a[_0x3d3722(0x221)],_0x22d9ce[_0x2357ee][_0x3d3722(0x305)]=_0x4be49a['secondary_unit'],_0x22d9ce[_0x2357ee]['primary_code']=_0x4be49a[_0x3d3722(0x244)],_0x22d9ce[_0x2357ee][_0x3d3722(0x1dd)]=_0x4be49a[_0x3d3722(0x1dd)],_0x22d9ce[_0x2357ee]['maxStocks']=_0x4be49a[_0x3d3722(0x209)],_0x22d9ce[_0x2357ee][_0x3d3722(0x2d4)]=_0x4be49a[_0x3d3722(0x2d4)],_0x22d9ce[_0x2357ee][_0x3d3722(0x248)]=_0x4be49a[_0x3d3722(0x248)],_0x22d9ce[_0x2357ee]['production_date']=_0x4be49a[_0x3d3722(0x311)],_0x22d9ce[_0x2357ee][_0x3d3722(0x315)]=_0x4be49a['maxperunit'],_0x22d9ce[_0x2357ee]['product_cat']=_0x4be49a['product_cat'],_0x22d9ce[_0x2357ee][_0x3d3722(0x2f7)]=_0x4be49a['invoice'],_0x22d9ce[_0x2357ee][_0x3d3722(0x2fb)]=_0x4be49a[_0x3d3722(0x2fb)],_0x22d9ce[_0x2357ee][_0x3d3722(0x25c)]=_0x5ca706['room'],_0x22d9ce[_0x2357ee][_0x3d3722(0x1f8)]=_0x4f0930['bay'],_0x22d9ce[_0x2357ee][_0x3d3722(0x1f7)]=_0x4f0930[_0x3d3722(0x28b)],_0x3f1449-=_0x456603,_0x2357ee++;if(_0x3f1449<=0x0)break;}}if(_0x3f1449<=0x0){_0x3d08ad['flash']('errors',_0x3d3722(0x2ee)+_0x3f1449+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x3f1449>0x0){console['log'](_0x3d3722(0x2c3)+_0x3f1449+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');break;}}}}}if(_0x3f1449>0x0){const _0x3c3fcc=await warehouse[_0x3d3722(0x1f2)]([{'$match':{'name':_0x205798,'isStaging':_0x3d3722(0x23a)}}]);_0x22d9ce[_0x2357ee]={},_0x22d9ce[_0x2357ee][_0x3d3722(0x231)]=_0x4be49a[_0x3d3722(0x231)],_0x22d9ce[_0x2357ee][_0x3d3722(0x257)]=_0x4be49a[_0x3d3722(0x257)],_0x22d9ce[_0x2357ee]['product_id']=_0x4be49a[_0x3d3722(0x296)],_0x22d9ce[_0x2357ee]['date_recieved']=_0x4be49a['date_recieved'],_0x22d9ce[_0x2357ee][_0x3d3722(0x263)]=_0x4be49a[_0x3d3722(0x263)],_0x22d9ce[_0x2357ee][_0x3d3722(0x26a)]=_0x4be49a[_0x3d3722(0x26a)],_0x22d9ce[_0x2357ee][_0x3d3722(0x2b0)]=_0x3f1449,_0x22d9ce[_0x2357ee][_0x3d3722(0x221)]=_0x4be49a['standard_unit'],_0x22d9ce[_0x2357ee][_0x3d3722(0x305)]=_0x4be49a[_0x3d3722(0x305)],_0x22d9ce[_0x2357ee][_0x3d3722(0x244)]=_0x4be49a[_0x3d3722(0x244)],_0x22d9ce[_0x2357ee][_0x3d3722(0x1dd)]=_0x4be49a[_0x3d3722(0x1dd)],_0x22d9ce[_0x2357ee][_0x3d3722(0x209)]=_0x4be49a[_0x3d3722(0x209)],_0x22d9ce[_0x2357ee][_0x3d3722(0x2d4)]=_0x4be49a[_0x3d3722(0x2d4)],_0x22d9ce[_0x2357ee]['expiry_date']=_0x4be49a['expiry_date'],_0x22d9ce[_0x2357ee][_0x3d3722(0x311)]=_0x4be49a[_0x3d3722(0x311)],_0x22d9ce[_0x2357ee][_0x3d3722(0x315)]=_0x4be49a[_0x3d3722(0x315)],_0x22d9ce[_0x2357ee][_0x3d3722(0x2f0)]=_0x4be49a['product_cat'],_0x22d9ce[_0x2357ee][_0x3d3722(0x2f7)]=_0x4be49a[_0x3d3722(0x2f7)],_0x22d9ce[_0x2357ee][_0x3d3722(0x2fb)]=_0x4be49a['gross_price'],_0x22d9ce[_0x2357ee][_0x3d3722(0x25c)]=_0x3c3fcc[0x0]['room'],_0x22d9ce[_0x2357ee]['level']=_0x3d3722(0x258),_0x22d9ce[_0x2357ee][_0x3d3722(0x1f7)]='1',console[_0x3d3722(0x20f)]('STAGING\x20AREA\x201'+_0x3d3722(0x2d0)+_0x4be49a[_0x3d3722(0x257)]+_0x3d3722(0x25f)+_0x4be49a[_0x3d3722(0x257)]+_0x3d3722(0x2d0)+_0x2357ee+_0x3d3722(0x2d0)+_0x3f1449),_0x3d08ad[_0x3d3722(0x201)](_0x3d3722(0x2b6),_0x3d3722(0x2ee)+_0x3f1449+_0x3d3722(0x2cd));}}const _0x20559f=_0x22d9ce['filter'](_0x5ebc7f=>_0x5ebc7f['quantity']!=='0'&&_0x5ebc7f[_0x3d3722(0x2b0)]!==''),_0x509bec=new purchases_finished({'invoice':_0x3d3722(0x228)+_0x24961b[_0x3d3722(0x1d3)]['toString']()[_0x3d3722(0x208)](0x8,'0'),'suppliers':_0x536e98,'date':_0x177601,'warehouse_name':_0x205798,'product':_0x20559f,'note':_0x1fdecc,'due_amount':_0x4512ce,'room':_0x15723f,'POnumber':_0x34d0da,'SCRN':_0x206950,'JO_number':_0x5dc7f4,'ReqBy':_0x486465,'dateofreq':_0x3ae07a,'typeservicesData':_0x14ac25,'van':_0x42d40f,'typevehicle':_0x5abdb5,'driver':_0x38bb4b,'plate':_0x273bae,'DRSI':_0x2c58fe,'TSU':_0x1281c7,'TFU':_0x201198,'typeOfProducts':_0x7f4800}),_0x21b6f4=await _0x509bec['save'](),_0x4541b9=await purchases_finished[_0x3d3722(0x1d9)]({'_id':_0x21b6f4[_0x3d3722(0x270)]['valueOf']()});_0x3d08ad[_0x3d3722(0x201)](_0x3d3722(0x285),_0x3d3722(0x28a)),_0x1e6b23['redirect'](_0x3d3722(0x1fc)+_0x4541b9[_0x3d3722(0x270)][_0x3d3722(0x1db)]());}catch(_0xecba1e){console[_0x3d3722(0x20f)](_0xecba1e);}}),router['get'](a0_0x533dff(0x2da),auth,async(_0xe8de22,_0x461320)=>{var _0x44d4c5=a0_0x533dff;try{const {username:_0x3b4403,email:_0x1a2d4c,role:_0x3497f9}=_0xe8de22[_0x44d4c5(0x260)],_0x27269f=_0xe8de22[_0x44d4c5(0x260)],_0x301363=_0xe8de22['params']['id'],_0x57da26=await profile[_0x44d4c5(0x1d9)]({'email':_0x27269f[_0x44d4c5(0x288)]}),_0x47af4f=await master_shop['find'](),_0x12ac71=await staff[_0x44d4c5(0x1d9)]({'email':_0x27269f[_0x44d4c5(0x288)]}),_0x1507f9=await suppliers['find']({});let _0x2f9249;if(_0x27269f[_0x44d4c5(0x210)]==_0x44d4c5(0x2ff)){const _0x1b2adb=await staff['findOne']({'email':_0x27269f['email']});_0x2f9249=await warehouse[_0x44d4c5(0x1f2)]([{'$match':{'status':_0x44d4c5(0x2ce),'name':_0x1b2adb[_0x44d4c5(0x2a9)]}},{'$group':{'_id':_0x44d4c5(0x1f9),'name':{'$first':_0x44d4c5(0x1f9)}}}]);}else _0x2f9249=await warehouse['aggregate']([{'$match':{'status':_0x44d4c5(0x2ce)}},{'$group':{'_id':_0x44d4c5(0x1f9),'name':{'$first':_0x44d4c5(0x1f9)}}}]);const _0x27c942=await purchases_finished[_0x44d4c5(0x29b)](_0x301363);if(_0x47af4f[0x0]['language']==_0x44d4c5(0x256))var _0x94ca79=users[_0x44d4c5(0x29d)];else{if(_0x47af4f[0x0][_0x44d4c5(0x2b2)]==_0x44d4c5(0x27e))var _0x94ca79=users[_0x44d4c5(0x27e)];else{if(_0x47af4f[0x0][_0x44d4c5(0x2b2)]=='German')var _0x94ca79=users[_0x44d4c5(0x28e)];else{if(_0x47af4f[0x0][_0x44d4c5(0x2b2)]==_0x44d4c5(0x2a5))var _0x94ca79=users[_0x44d4c5(0x2a5)];else{if(_0x47af4f[0x0][_0x44d4c5(0x2b2)]=='French')var _0x94ca79=users[_0x44d4c5(0x310)];else{if(_0x47af4f[0x0]['language']=='Portuguese\x20(BR)')var _0x94ca79=users[_0x44d4c5(0x27c)];else{if(_0x47af4f[0x0][_0x44d4c5(0x2b2)]=='Chinese')var _0x94ca79=users[_0x44d4c5(0x227)];else{if(_0x47af4f[0x0][_0x44d4c5(0x2b2)]=='Arabic\x20(ae)')var _0x94ca79=users[_0x44d4c5(0x274)];}}}}}}}_0x461320['render'](_0x44d4c5(0x2c4),{'success':_0xe8de22[_0x44d4c5(0x201)](_0x44d4c5(0x285)),'errors':_0xe8de22[_0x44d4c5(0x201)](_0x44d4c5(0x2b6)),'role':_0x27269f,'profile':_0x57da26,'suppliers':_0x1507f9,'warehouse':_0x2f9249,'master_shop':_0x47af4f,'language':_0x94ca79,'purchases_data':_0x27c942});}catch(_0x2fce3d){console[_0x44d4c5(0x20f)](_0x2fce3d);}});async function get_warehouse_data(_0x2ec6b6,_0x49298c){var _0x36fe2d=a0_0x533dff;try{const _0x47fb61=await warehouse_temporary[_0x36fe2d(0x1d9)]({'name':_0x2ec6b6,'room':_0x49298c});if(!_0x47fb61){const _0x583491=new warehouse_temporary({'name':_0x2ec6b6,'address':_0x2ec6b6,'status':_0x36fe2d(0x2ce),'room':_0x49298c,'isStaging':_0x36fe2d(0x202)});return await _0x583491[_0x36fe2d(0x2af)](),_0x583491;}else return _0x47fb61;}catch(_0x4006e4){console[_0x36fe2d(0x22f)](_0x36fe2d(0x1cc),_0x4006e4);throw _0x4006e4;}}function a0_0x29e3(){var _0x5ca884=['$_id','all_purchases_finished_logs','match','$product_details._id','date','<span\x20style=\x22float:\x20right;\x22>','gmail','standard_unit','concat','$product','prod_unit','Distributing\x20','</tbody>','Chinese','INC-','path','express','suppliers','<div>','<h5\x20style=\x22text-align:\x20left;\x22>','Asia/Manila','error','edit_purchases_finished','product_name','$due_amount','payment\x20successfull','/incoming/add','return_purchase_finished','$expiry_date','POnumber','to_quantity','primary_code_hide','true','$room','logo','incoming_view','add_purchases\x20error','</h5>','===','forEach','FGSEmail','$product.floorlevel','primary_code','/view','<!DOCTYPE\x20html>','/all_purchases_finished/view','expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','floor','An\x20error\x20occurred.','length','master','Email\x20sent\x20successfully','prod_qty','room','undefined','prod_secondunit','catch','$category','toString','English\x20(US)','product_code','STAGING','$product_details.product_name','RoomAssign','DRY\x20GOODS','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','purchase\x20data\x20update\x20successfully','\x20===\x20','user','../middleware/auth','/../public','sales_category','/incoming','$warehouse_name','Rack\x201','all','$suppliers_docs','$product.bin','uuid','$note','image','Router','table\x20page','$product_details.maxProducts','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','max','Arabic','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','due_amount','post','/all_purchases_finished/preview/','INCF-','incoming_add','<html><head><title></title>','Portuguese','prod_code','Hindi','/barcode/:id','$secondary_code','body','LOG-INC-','$product_details.type','stock_data','success','516554OpkSGA','render','email','$product_details.floorlevel','purchase\x20data\x20add\x20successfully','bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','json','German','/barcode_scanner','own','\x20<=>\x20','stock_quantity','$alertquantity','util','/view/add_purchases','product_id','item_code','$product_details.storage','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','findById','Return\x20Goods','English','return_product','/upload/','paid_amount','$batch_code','currency','data_type','$sales_category','Spanish','$suppliers','/getinvoicetrf','Finished\x20Goods','warehouse','password','random','logs','product_data','<h2>\x20','save','quantity','/barcode_scanner_logs','language','$product_details.bin','suppliers_docs','8629665MAguZj','errors','purchase_quantity','/all_purchases/view','params','Rack\x202','redirect','product_date','Purchase\x20Return\x20Mail','\x20Order\x20Number\x20:\x20','prod_level','</thead>','createTransport','$product_details.rack','There\x20is\x20','purchases_process','$date','max_product_unit','/getTRF','purchases\x20item\x20return\x20successfull','slice','Error\x20occurred\x20while\x20processing\x20product:','/picking_list/pdf_puchases_fin_own_trf/','\x20units\x20of\x20','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','Enabled','$product_details.bay','\x20<>\x20','10yikrWS','product_details','\x20to\x20warehouse:\x20','batch_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Room_name','1335yBbuRO','filter','/view/:id','/process/:id','Enclosed','$product.bay','/preview/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','return_qty','then','nodemailer','/view/return_purchase/:id','INC','MaxStocks_data','maxProducts','edit_purchases_finished_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$paid_amount','inc','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','date_recieved','map','/give_payment/:id','The\x20Other\x20','maxPerUnit','product_cat','name','$unit','$primary_code','$return_data','221550lnMwbH','<tr>','invoice','getFullYear','secondary_code_hide','purchase_invoice','gross_price','Arabic\x20(ae)','\x20Order\x20Date\x20:\x20','to_room_name','staff','<tbody\x20style=\x22text-align:\x20center;\x22>','min','abs','$product_code','host','secondary_unit','add_purchases_finished_logs','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<strong>\x20Regards\x20</strong>','1945802gJhwKL','</td>','/view/add_purchases/:id','2-digit','\x20inc\x20=\x20','$product.quantity','type_of_products','French','production_date','isUsed','return_data','purchases_id','maxperunit','id_transaction','all_purchases_finished','3lnMdFt','ejs','numeric','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','$product_details.product_stock','JO_number','Error\x20Occurs','product','$product_details.product_code','../public/language/languages.json','invoice_init','product_stock','$product.room_name','warehouse_name','9236538hMKlDo','status','findOne','$brand','valueOf','to_bay','secondary_code','1992072LQDuQu','type_of_products_type','$product.type','/invoice/:id','\x20</h2>','</head><body>','$secondary_unit','all_purchases_barcode','$product_details','site_title','amount','port','</tr>','to_warehouse','prod_Qty','Portuguese\x20(BR)','$type_products','$gross_price','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','find','aggregate','get','42KBCZcO','$invoice','unit','bay','level','$name','getDate','<h5>','/all_purchases_finished/process/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','string','sales_data_cateory','flash','false','product_code_hide','getMonth','Purchase\x20Mail','isProcess','prod_cat','padStart','maxStocks','note','prod_primunit','</body></html>','prod_name','</div>','log','role','$maxProdPerUnit','$maxStocks','Logo.png','</table>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','11580kBVUJr','message','Paid\x20For\x20Purchase','sendMail'];a0_0x29e3=function(){return _0x5ca884;};return a0_0x29e3();}router[a0_0x533dff(0x277)](a0_0x533dff(0x2da),auth,async(_0x43fdc5,_0x117211)=>{var _0x40a944=a0_0x533dff;try{const _0xd628ac=_0x43fdc5[_0x40a944(0x2b9)]['id'],_0x49e78f=await purchases_finished[_0x40a944(0x29b)](_0xd628ac);let _0x17f8b5=[];_0x49e78f[_0x40a944(0x1d0)][_0x40a944(0x241)]((_0xddbd8c,_0x25f3c0)=>{var _0x44d4e3=_0x40a944;_0x17f8b5[_0x25f3c0]={},_0x17f8b5[_0x25f3c0][_0x44d4e3(0x2a9)]=_0x49e78f[_0x44d4e3(0x1d6)],_0x17f8b5[_0x25f3c0]['product_id']=_0xddbd8c[_0x44d4e3(0x296)],_0x17f8b5[_0x25f3c0]['product_name']=_0xddbd8c['product_name'],_0x17f8b5[_0x25f3c0]['product_code']=_0xddbd8c[_0x44d4e3(0x257)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x1d4)]=_0xddbd8c[_0x44d4e3(0x2b0)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x1f6)]=_0xddbd8c['standard_unit'],_0x17f8b5[_0x25f3c0]['secondary_unit']=_0xddbd8c[_0x44d4e3(0x305)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x1f8)]=_0xddbd8c['level'],_0x17f8b5[_0x25f3c0]['bay']=_0xddbd8c[_0x44d4e3(0x1f7)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x244)]=_0xddbd8c[_0x44d4e3(0x244)],_0x17f8b5[_0x25f3c0]['secondary_code']=_0xddbd8c[_0x44d4e3(0x1dd)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x209)]=_0xddbd8c['maxStocks'],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x2d4)]=_0xddbd8c[_0x44d4e3(0x2d4)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x248)]=_0xddbd8c['expiry_date'],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x311)]=_0xddbd8c['production_date'],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x315)]=_0xddbd8c['maxperunit'],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x2f0)]=_0xddbd8c['product_cat'],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x25c)]=_0xddbd8c[_0x44d4e3(0x25c)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x2f7)]=_0xddbd8c['invoice'],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x26a)]=_0xddbd8c[_0x44d4e3(0x26a)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x2fb)]=_0xddbd8c[_0x44d4e3(0x2fb)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x263)]=_0xddbd8c[_0x44d4e3(0x263)],_0x17f8b5[_0x25f3c0]['date_recieved']=_0xddbd8c[_0x44d4e3(0x2eb)],_0x17f8b5[_0x25f3c0][_0x44d4e3(0x314)]=_0xddbd8c[_0x44d4e3(0x270)]['valueOf'](),_0x17f8b5[_0x25f3c0][_0x44d4e3(0x2a3)]=_0x44d4e3(0x2e9),_0x17f8b5[_0x25f3c0]['isAvailable']=_0x44d4e3(0x23a),_0x17f8b5[_0x25f3c0][_0x44d4e3(0x312)]=_0x44d4e3(0x202);});for(let _0x5004b7=0x0;_0x5004b7<=_0x17f8b5[_0x40a944(0x24c)]-0x1;_0x5004b7++){const _0x1d0204=_0x17f8b5[_0x5004b7],_0x3e33df=new warehouse_temporary(_0x1d0204);await _0x3e33df[_0x40a944(0x2af)]();}_0x49e78f[_0x40a944(0x206)]=_0x40a944(0x23a),await _0x49e78f[_0x40a944(0x2af)](),_0x43fdc5[_0x40a944(0x201)]('success','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x117211[_0x40a944(0x2bb)](_0x40a944(0x1fc)+_0x49e78f[_0x40a944(0x270)][_0x40a944(0x1db)]());}catch(_0x4650fd){}}),router['post']('/view/add_purchases_logs',auth,async(_0xa692e,_0x243ac7)=>{var _0xa3efae=a0_0x533dff;try{const {invoice:_0x139e8a,date:_0x170e26,warehouse_name:_0x5c026b,prod_name:_0x45935c,note:_0x3dad35,due_amount:_0x27a745,Room_name:_0x225c95,PO_number:_0x4cc6ab,SCRN:_0x34fe23,ReqBy:_0x4752f2,dateofreq:_0x3f2d9e,suppliers:_0x54395f,typeservicesData:_0x191cd7,van:_0x17d7ca,typevehicle:_0x51440d,driver:_0x5c5363,plate:_0x279dd2,DRSI:_0x2966be,TSU:_0x19aa4b,TFU:_0x4058f9,JO_number:_0x577c5b,type_of_products:_0x6211f9}=_0xa692e[_0xa3efae(0x281)];if(typeof _0x45935c=='string')var _0x343479=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x20d)]],_0xf15748=[_0xa692e[_0xa3efae(0x281)]['prod_code']],_0x51fd3f=[_0xa692e['body'][_0xa3efae(0x1ec)]],_0x5e0633=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x20b)]],_0x91da28=[_0xa692e[_0xa3efae(0x281)]['prod_secondunit']],_0x59e957=[_0xa692e['body'][_0xa3efae(0x2bf)]],_0x58fd2e=[_0xa692e['body'][_0xa3efae(0x244)]],_0x16f58d=[_0xa692e[_0xa3efae(0x281)]['secondary_code']],_0xa71c5f=[_0xa692e[_0xa3efae(0x281)]['MaxStocks_data']],_0x830c60=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x2d4)]],_0x55427f=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x248)]],_0x48b364=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x2bc)]],_0x4181d5=[_0xa692e['body'][_0xa3efae(0x2c6)]],_0x261d56=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x207)]],_0x434cbc=[_0xa692e['body']['RoomAssign']],_0x3a5f77=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x2fb)]],_0xd7a093=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x26a)]],_0xc3e463=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x200)]],_0x49f1a0=[_0xa692e[_0xa3efae(0x281)][_0xa3efae(0x1df)]];else var _0x343479=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x20d)]],_0xf15748=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x27d)]],_0x51fd3f=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x1ec)]],_0x5e0633=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x20b)]],_0x91da28=[..._0xa692e['body']['prod_secondunit']],_0x59e957=[..._0xa692e[_0xa3efae(0x281)]['prod_level']],_0x58fd2e=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x244)]],_0x16f58d=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x1dd)]],_0xa71c5f=[..._0xa692e[_0xa3efae(0x281)]['MaxStocks_data']],_0x830c60=[..._0xa692e['body']['batch_code']],_0x55427f=[..._0xa692e[_0xa3efae(0x281)]['expiry_date']],_0x48b364=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x2bc)]],_0x4181d5=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x2c6)]],_0x261d56=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x207)]],_0x434cbc=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x25a)]],_0x3a5f77=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x2fb)]],_0xd7a093=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x26a)]],_0xc3e463=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x200)]],_0x49f1a0=[..._0xa692e[_0xa3efae(0x281)][_0xa3efae(0x1df)]];const _0x2843c3=_0x343479[_0xa3efae(0x2ec)](_0x57764b=>{return _0x57764b={'product_name':_0x57764b};});_0x49f1a0['forEach']((_0x358b72,_0x567e25)=>{_0x2843c3[_0x567e25]['type_of_products']=_0x358b72;}),_0xc3e463[_0xa3efae(0x241)]((_0x1fac11,_0xff9242)=>{var _0x529cd1=_0xa3efae;_0x2843c3[_0xff9242][_0x529cd1(0x263)]=_0x1fac11;}),_0xf15748['forEach']((_0x37d1b0,_0xdccc6d)=>{var _0x27c8e1=_0xa3efae;_0x2843c3[_0xdccc6d][_0x27c8e1(0x257)]=_0x37d1b0;}),_0xd7a093[_0xa3efae(0x241)]((_0x36780e,_0xd0c89f)=>{_0x2843c3[_0xd0c89f]['uuid']=_0x36780e;}),_0x51fd3f[_0xa3efae(0x241)]((_0x1db76a,_0x58c0f7)=>{var _0x3c76cf=_0xa3efae;_0x2843c3[_0x58c0f7][_0x3c76cf(0x2b0)]=Math[_0x3c76cf(0x302)](_0x1db76a);}),_0x5e0633[_0xa3efae(0x241)]((_0x5603dc,_0x38ccbf)=>{var _0x24fcc2=_0xa3efae;_0x2843c3[_0x38ccbf][_0x24fcc2(0x221)]=_0x5603dc;}),_0x91da28[_0xa3efae(0x241)]((_0x137c0c,_0x3f2709)=>{_0x2843c3[_0x3f2709]['secondary_unit']=_0x137c0c;}),_0x59e957[_0xa3efae(0x241)]((_0x31bbf2,_0x510b58)=>{var _0x33edb9=_0xa3efae,_0x249d28=_0x31bbf2[_0x33edb9(0x21c)](/[A-Za-z]+/)[0x0],_0x108b91=parseInt(_0x31bbf2['match'](/\d+/)[0x0]);_0x2843c3[_0x510b58]['level']=_0x249d28,_0x2843c3[_0x510b58][_0x33edb9(0x1f7)]=_0x108b91;}),_0x58fd2e[_0xa3efae(0x241)]((_0x15c5ff,_0x1a4da8)=>{var _0x8e4ad1=_0xa3efae;_0x2843c3[_0x1a4da8][_0x8e4ad1(0x244)]=_0x15c5ff;}),_0x16f58d[_0xa3efae(0x241)]((_0x8c8ee6,_0x5387fd)=>{_0x2843c3[_0x5387fd]['secondary_code']=_0x8c8ee6;}),_0xa71c5f[_0xa3efae(0x241)]((_0x39e188,_0x38d3a9)=>{var _0x4d593e=_0xa3efae;_0x2843c3[_0x38d3a9][_0x4d593e(0x209)]=_0x39e188;}),_0x830c60[_0xa3efae(0x241)]((_0x5291d1,_0x460ba8)=>{var _0xde8cbc=_0xa3efae;_0x2843c3[_0x460ba8][_0xde8cbc(0x2d4)]=_0x5291d1;}),_0x55427f[_0xa3efae(0x241)]((_0x3ab2ea,_0x16323d)=>{var _0x4ff950=_0xa3efae;_0x2843c3[_0x16323d][_0x4ff950(0x248)]=_0x3ab2ea;}),_0x48b364[_0xa3efae(0x241)]((_0x32f51a,_0x54cbbf)=>{_0x2843c3[_0x54cbbf]['production_date']=_0x32f51a;}),_0x4181d5[_0xa3efae(0x241)]((_0x5b11f1,_0x55f203)=>{_0x2843c3[_0x55f203]['maxperunit']=_0x5b11f1;}),_0x261d56['forEach']((_0xd00857,_0xae81b2)=>{_0x2843c3[_0xae81b2]['product_cat']=_0xd00857;}),_0x434cbc['forEach']((_0xda1f3,_0x559889)=>{_0x2843c3[_0x559889]['room_name']=_0xda1f3;}),_0x3a5f77[_0xa3efae(0x241)]((_0x29d64b,_0x2cbec2)=>{var _0x4ebe9d=_0xa3efae;_0x2843c3[_0x2cbec2][_0x4ebe9d(0x2fb)]=_0x29d64b;});const _0xd3d4b3=new purchases_logs();await _0xd3d4b3['save']();for(let _0x2f03e7=0x0;_0x2f03e7<=_0x434cbc[_0xa3efae(0x24c)]-0x1;_0x2f03e7++){_0x2843c3[_0x2f03e7][_0xa3efae(0x2f7)]=_0xa3efae(0x282)+_0xd3d4b3[_0xa3efae(0x1d3)][_0xa3efae(0x255)]()['padStart'](0x8,'0');}const _0x4c6db6=_0x2843c3[_0xa3efae(0x2d8)](_0x20872f=>_0x20872f[_0xa3efae(0x2b0)]!=='0'&&_0x20872f[_0xa3efae(0x2b0)]!==''),_0x3f7f1d=new purchases_finished({'invoice':_0xa3efae(0x282)+_0xd3d4b3[_0xa3efae(0x1d3)][_0xa3efae(0x255)]()[_0xa3efae(0x208)](0x8,'0'),'suppliers':_0x54395f,'date':_0x170e26,'warehouse_name':_0x5c026b,'product':_0x4c6db6,'note':_0x3dad35,'due_amount':_0x27a745,'room':_0x225c95,'POnumber':_0x4cc6ab,'SCRN':_0x34fe23,'JO_number':_0x577c5b,'ReqBy':_0x4752f2,'dateofreq':_0x3f2d9e,'typeservicesData':_0x191cd7,'van':_0x17d7ca,'typevehicle':_0x51440d,'driver':_0x5c5363,'plate':_0x279dd2,'DRSI':_0x2966be,'TSU':_0x19aa4b,'TFU':_0x4058f9,'typeOfProducts':_0x6211f9}),_0x595ef9=await _0x3f7f1d['save'](),_0x1e14ed=await purchases_finished[_0xa3efae(0x1d9)]({'_id':_0x595ef9[_0xa3efae(0x270)]['valueOf']()}),_0x30e20f=_0x1e14ed['product'][_0xa3efae(0x2ec)](async _0x492527=>{var _0x43732a=_0xa3efae;try{var _0x2e4866=await warehouse[_0x43732a(0x1d9)]({'name':_0x5c026b,'room':_0x492527[_0x43732a(0x25c)]}),_0x526650=0x0;const _0x2b2995=_0x2e4866[_0x43732a(0x2d2)]['map'](_0x33c7cd=>{var _0x46e851=_0x43732a;console[_0x46e851(0x20f)](_0x33c7cd[_0x46e851(0x231)]+'=='+_0x492527[_0x46e851(0x231)]+'&&'+_0x33c7cd[_0x46e851(0x1f7)]+'=='+_0x492527[_0x46e851(0x1f7)]+'&&'+_0x33c7cd['expiry_date']+'=='+_0x492527[_0x46e851(0x248)]+'&&'+_0x33c7cd[_0x46e851(0x311)]+'=='+_0x492527[_0x46e851(0x311)]+'&&'+_0x33c7cd[_0x46e851(0x2d4)]+'=='+_0x492527[_0x46e851(0x2d4)]+'&&'+_0x33c7cd['invoice']+'=='+_0x1e14ed[_0x46e851(0x2f7)]),_0x33c7cd[_0x46e851(0x231)]==_0x492527[_0x46e851(0x231)]&&_0x33c7cd[_0x46e851(0x1f7)]==_0x492527[_0x46e851(0x1f7)]&&_0x33c7cd[_0x46e851(0x1f8)]==_0x492527[_0x46e851(0x1f8)]&&_0x33c7cd[_0x46e851(0x248)]==_0x492527[_0x46e851(0x248)]&&_0x33c7cd['production_date']==_0x492527[_0x46e851(0x311)]&&_0x33c7cd['batch_code']==_0x492527[_0x46e851(0x2d4)]&&_0x33c7cd[_0x46e851(0x2f7)]==_0x1e14ed[_0x46e851(0x2f7)]&&(_0x33c7cd[_0x46e851(0x1d4)]=Math[_0x46e851(0x302)](_0x33c7cd['product_stock'])+Math[_0x46e851(0x302)](_0x492527[_0x46e851(0x2b0)]),_0x526650++);});return _0x526650==0x0&&(_0x2e4866[_0x43732a(0x2d2)]=_0x2e4866[_0x43732a(0x2d2)][_0x43732a(0x222)]({'product_name':_0x492527[_0x43732a(0x231)],'product_stock':Math['abs'](_0x492527[_0x43732a(0x2b0)]),'primary_code':_0x492527[_0x43732a(0x244)],'secondary_code':_0x492527[_0x43732a(0x1dd)],'product_code':_0x492527[_0x43732a(0x257)],'bay':_0x492527[_0x43732a(0x1f7)],'level':_0x492527[_0x43732a(0x1f8)],'maxProducts':_0x492527[_0x43732a(0x209)],'unit':_0x492527[_0x43732a(0x221)],'secondary_unit':_0x492527['secondary_unit'],'expiry_date':_0x492527[_0x43732a(0x248)],'production_date':_0x492527[_0x43732a(0x311)],'maxProducts':_0x492527[_0x43732a(0x209)],'maxPerUnit':_0x492527[_0x43732a(0x315)],'batch_code':_0x492527[_0x43732a(0x2d4)],'product_cat':_0x492527[_0x43732a(0x2f0)],'invoice':_0x492527['invoice'],'id_incoming':_0x492527['_id'],'uuid':_0x492527['uuid'],'gross_price':_0x492527['gross_price'],'sales_category':_0x492527[_0x43732a(0x263)],'type_products':_0x492527[_0x43732a(0x30f)]})),_0x2e4866;}catch(_0x3c74bb){return console[_0x43732a(0x22f)](_0x43732a(0x2ca),_0x3c74bb),null;}});Promise[_0xa3efae(0x267)](_0x30e20f)[_0xa3efae(0x2e0)](async _0x2c583b=>{var _0x39e846=_0xa3efae;try{for(const _0x4916d4 of _0x2c583b){await warehouse['updateOne']({'_id':_0x4916d4[_0x39e846(0x270)]},{'$addToSet':{'product_details':{'$each':_0x4916d4[_0x39e846(0x2d2)]}}});}const _0x35d544=await master_shop[_0x39e846(0x1f1)](),_0x236aac=await email_settings[_0x39e846(0x1d9)](),_0x451fd3=await supervisor_settings['find']();var _0x300f3c=_0x1e14ed[_0x39e846(0x1d0)],_0x4e77fb='',_0x56ce46;for(_0x56ce46 in _0x300f3c){var _0x664a9b='FG';_0x1e14ed[_0x39e846(0x1d6)]==_0x39e846(0x25b)&&(_0x664a9b='DG'),_0x4e77fb+=_0x39e846(0x2f6)+_0x39e846(0x275)+_0x300f3c[_0x56ce46][_0x39e846(0x231)]+_0x39e846(0x30a)+_0x39e846(0x275)+_0x300f3c[_0x56ce46][_0x39e846(0x257)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x300f3c[_0x56ce46]['quantity']+_0x39e846(0x30a)+_0x39e846(0x275)+_0x300f3c[_0x56ce46][_0x39e846(0x221)]+_0x39e846(0x30a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x300f3c[_0x56ce46]['secondary_unit']+_0x39e846(0x30a)+_0x39e846(0x275)+_0x1e14ed['warehouse_name']+'</td>'+_0x39e846(0x275)+_0x300f3c[_0x56ce46][_0x39e846(0x25c)]+_0x39e846(0x30a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x664a9b+_0x300f3c[_0x56ce46][_0x39e846(0x1f7)]+'</td>',_0x39e846(0x1ea);}let _0x1b2ca0=nodemailer[_0x39e846(0x2c1)]({'host':_0x236aac[_0x39e846(0x304)],'port':Number(_0x236aac[_0x39e846(0x1e9)]),'secure':![],'auth':{'user':_0x236aac['email'],'pass':_0x236aac[_0x39e846(0x2aa)]}}),_0x53c4ea={'from':_0x236aac[_0x39e846(0x288)],'to':_0x451fd3[0x0][_0x39e846(0x242)],'subject':_0x39e846(0x205),'attachments':[{'filename':_0x39e846(0x213),'path':__dirname+_0x39e846(0x262)+_0x39e846(0x29f)+_0x35d544[0x0][_0x39e846(0x26c)],'cid':'logo'}],'html':_0x39e846(0x246)+_0x39e846(0x27b)+'</head><body>'+'<div>'+_0x39e846(0x2de)+_0x39e846(0x22c)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x39e846(0x20e)+_0x39e846(0x22c)+'<h2>\x20'+_0x35d544[0x0][_0x39e846(0x1e7)]+_0x39e846(0x1e2)+_0x39e846(0x20e)+_0x39e846(0x20e)+'<hr\x20class=\x22my-3\x22>'+_0x39e846(0x22c)+_0x39e846(0x22d)+'\x20Order\x20Number\x20:\x20'+_0x1e14ed[_0x39e846(0x2f7)]+'\x20'+_0x39e846(0x21f)+_0x39e846(0x2fd)+_0x1e14ed[_0x39e846(0x21e)]+'\x20'+'</span>'+_0x39e846(0x23f)+_0x39e846(0x20e)+_0x39e846(0x28c)+_0x39e846(0x2d5)+_0x39e846(0x2f6)+_0x39e846(0x1fd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x39e846(0x2e7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x39e846(0x2ea)+_0x39e846(0x29a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x39e846(0x1f0)+_0x39e846(0x1ea)+_0x39e846(0x2c0)+_0x39e846(0x300)+'\x20'+_0x4e77fb+'\x20'+'</tbody>'+_0x39e846(0x214)+_0x39e846(0x22c)+_0x39e846(0x308)+_0x39e846(0x1fb)+_0x35d544[0x0]['site_title']+'</h5>'+_0x39e846(0x20e)+'</div>'+_0x39e846(0x20c)};_0x1b2ca0[_0x39e846(0x219)](_0x53c4ea,function(_0x570428,_0x85fcdb){var _0xd51ac9=_0x39e846;_0x570428?(console['log'](_0x570428),console['log'](_0xd51ac9(0x1cf))):console[_0xd51ac9(0x20f)](_0xd51ac9(0x24e));});}catch(_0x2ff8b5){console[_0x39e846(0x22f)](_0x2ff8b5),_0x243ac7['status'](0x1f4)['json']({'error':_0x39e846(0x249),'message':_0x2ff8b5[_0x39e846(0x217)]});}})[_0xa3efae(0x253)](_0x15cf4f=>{var _0x58201e=_0xa3efae;console[_0x58201e(0x22f)](_0x15cf4f);}),_0xa692e[_0xa3efae(0x201)]('success','purchase\x20data\x20add\x20successfully'),_0x243ac7[_0xa3efae(0x2bb)](_0xa3efae(0x278)+_0x1e14ed['_id'][_0xa3efae(0x1db)]());}catch(_0x64ab40){console[_0xa3efae(0x20f)](_0x64ab40);}}),router[a0_0x533dff(0x1f3)](a0_0x533dff(0x2dd),auth,async(_0x212601,_0x454872)=>{var _0x2623f1=a0_0x533dff;try{const {username:_0x2cdf49,email:_0x4de5ba,role:_0x4c328f}=_0x212601['user'],_0x2f3b4b=_0x212601[_0x2623f1(0x260)],_0x548b09=await profile['findOne']({'email':_0x2f3b4b[_0x2623f1(0x288)]}),_0x2cbc06=await master_shop[_0x2623f1(0x1f1)](),_0x32fc73=_0x212601[_0x2623f1(0x2b9)]['id'],_0x216cf0=await purchases_finished['findById'](_0x32fc73),_0x34cdd2=await suppliers[_0x2623f1(0x1f1)]({});let _0x4f10f0;if(_0x2f3b4b[_0x2623f1(0x210)]=='staff'){const _0x132425=await staff[_0x2623f1(0x1d9)]({'email':_0x2f3b4b[_0x2623f1(0x288)]});_0x4f10f0=await warehouse['find']({'status':'Enabled','name':_0x132425[_0x2623f1(0x2a9)],'warehouse_category':_0x2623f1(0x2a8)});}else _0x4f10f0=await warehouse[_0x2623f1(0x1f2)]([{'$match':{'status':'Enabled','warehouse_category':_0x2623f1(0x2a8)}},{'$group':{'_id':_0x2623f1(0x1f9),'name':{'$first':'$name'}}}]);const _0x3506bb=await product['find']({}),_0x159186=BayBinSelected(_0x216cf0['warehouse_name'],_0x216cf0[_0x2623f1(0x250)]);let _0x1c7b48=new Date(_0x216cf0['expiry_date']),_0x2af5d3=('0'+_0x1c7b48[_0x2623f1(0x1fa)]())['slice'](-0x2),_0x47e92f=('0'+(_0x1c7b48[_0x2623f1(0x204)]()+0x1))[_0x2623f1(0x2c9)](-0x2),_0x3271c1=_0x1c7b48['getFullYear'](),_0x332eda=_0x3271c1+'-'+_0x47e92f+'-'+_0x2af5d3;if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]==_0x2623f1(0x256)){var _0x4f76d5=users['English'];console['log'](_0x4f76d5);}else{if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]==_0x2623f1(0x27e))var _0x4f76d5=users[_0x2623f1(0x27e)];else{if(_0x2cbc06[0x0]['language']=='German')var _0x4f76d5=users['German'];else{if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]=='Spanish')var _0x4f76d5=users[_0x2623f1(0x2a5)];else{if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]==_0x2623f1(0x310))var _0x4f76d5=users[_0x2623f1(0x310)];else{if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]==_0x2623f1(0x1ed))var _0x4f76d5=users[_0x2623f1(0x27c)];else{if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]==_0x2623f1(0x227))var _0x4f76d5=users[_0x2623f1(0x227)];else{if(_0x2cbc06[0x0][_0x2623f1(0x2b2)]==_0x2623f1(0x2fc))var _0x4f76d5=users[_0x2623f1(0x274)];}}}}}}}_0x454872[_0x2623f1(0x287)](_0x2623f1(0x2e6),{'success':_0x212601[_0x2623f1(0x201)](_0x2623f1(0x285)),'errors':_0x212601[_0x2623f1(0x201)](_0x2623f1(0x2b6)),'role':_0x2f3b4b,'profile':_0x548b09,'purchases':_0x216cf0,'suppliers':_0x34cdd2,'warehouse':_0x4f10f0,'product':_0x3506bb,'master_shop':_0x2cbc06,'language':_0x4f76d5,'ed_fullDate':_0x332eda,'dataSelected':_0x159186});}catch(_0x1d2a8a){console[_0x2623f1(0x20f)](_0x1d2a8a);}}),router[a0_0x533dff(0x1f3)](a0_0x533dff(0x2d9),auth,async(_0x3c35a6,_0x432864)=>{var _0x1e47cd=a0_0x533dff;try{const {username:_0x3cf8af,email:_0x4f3164,role:_0x268516}=_0x3c35a6[_0x1e47cd(0x260)],_0x59cd4f=_0x3c35a6['user'],_0x1702f0=await profile[_0x1e47cd(0x1d9)]({'email':_0x59cd4f[_0x1e47cd(0x288)]}),_0x55413a=await master_shop[_0x1e47cd(0x1f1)](),_0x5476b0=_0x3c35a6[_0x1e47cd(0x2b9)]['id'],_0x1614db=await purchases_finished[_0x1e47cd(0x29b)](_0x5476b0),_0x1ebf0b=await suppliers[_0x1e47cd(0x1f1)]({});let _0x58884f;if(_0x59cd4f[_0x1e47cd(0x210)]=='staff'){const _0x3a0a7d=await staff[_0x1e47cd(0x1d9)]({'email':_0x59cd4f[_0x1e47cd(0x288)]});_0x58884f=await warehouse[_0x1e47cd(0x1f1)]({'status':'Enabled','name':_0x3a0a7d[_0x1e47cd(0x2a9)],'warehouse_category':_0x1e47cd(0x2a8)});}else _0x58884f=await warehouse[_0x1e47cd(0x1f2)]([{'$match':{'status':'Enabled','warehouse_category':_0x1e47cd(0x2a8)}},{'$group':{'_id':_0x1e47cd(0x1f9),'name':{'$first':_0x1e47cd(0x1f9)}}}]);const _0xf088be=await product[_0x1e47cd(0x1f1)]({}),_0x5c9d2d=BayBinSelected(_0x1614db[_0x1e47cd(0x1d6)],_0x1614db[_0x1e47cd(0x250)]);let _0x4a9181=new Date(_0x1614db['expiry_date']),_0x51a5af=('0'+_0x4a9181[_0x1e47cd(0x1fa)]())[_0x1e47cd(0x2c9)](-0x2),_0x42091c=('0'+(_0x4a9181['getMonth']()+0x1))[_0x1e47cd(0x2c9)](-0x2),_0x260af2=_0x4a9181[_0x1e47cd(0x2f8)](),_0x2d228d=_0x260af2+'-'+_0x42091c+'-'+_0x51a5af;if(_0x55413a[0x0][_0x1e47cd(0x2b2)]=='English\x20(US)'){var _0x5083ba=users['English'];console[_0x1e47cd(0x20f)](_0x5083ba);}else{if(_0x55413a[0x0][_0x1e47cd(0x2b2)]==_0x1e47cd(0x27e))var _0x5083ba=users[_0x1e47cd(0x27e)];else{if(_0x55413a[0x0][_0x1e47cd(0x2b2)]==_0x1e47cd(0x28e))var _0x5083ba=users['German'];else{if(_0x55413a[0x0][_0x1e47cd(0x2b2)]==_0x1e47cd(0x2a5))var _0x5083ba=users[_0x1e47cd(0x2a5)];else{if(_0x55413a[0x0][_0x1e47cd(0x2b2)]==_0x1e47cd(0x310))var _0x5083ba=users[_0x1e47cd(0x310)];else{if(_0x55413a[0x0][_0x1e47cd(0x2b2)]==_0x1e47cd(0x1ed))var _0x5083ba=users['Portuguese'];else{if(_0x55413a[0x0][_0x1e47cd(0x2b2)]==_0x1e47cd(0x227))var _0x5083ba=users[_0x1e47cd(0x227)];else{if(_0x55413a[0x0]['language']==_0x1e47cd(0x2fc))var _0x5083ba=users[_0x1e47cd(0x274)];}}}}}}}_0x432864['render'](_0x1e47cd(0x230),{'success':_0x3c35a6[_0x1e47cd(0x201)](_0x1e47cd(0x285)),'errors':_0x3c35a6[_0x1e47cd(0x201)]('errors'),'role':_0x59cd4f,'profile':_0x1702f0,'purchases':_0x1614db,'suppliers':_0x1ebf0b,'warehouse':_0x58884f,'product':_0xf088be,'master_shop':_0x55413a,'language':_0x5083ba,'ed_fullDate':_0x2d228d,'dataSelected':_0x5c9d2d});}catch(_0x5cbef5){console[_0x1e47cd(0x20f)](_0x5cbef5);}}),router[a0_0x533dff(0x277)]('/view/:id',auth,async(_0x3e0a47,_0x16bbd0)=>{var _0x2047ae=a0_0x533dff;try{const _0xd0101a=_0x3e0a47[_0x2047ae(0x2b9)]['id'],_0x240b25=await purchases_finished[_0x2047ae(0x1d9)]({'_id':_0x3e0a47[_0x2047ae(0x2b9)]['id']}),_0x36502d=await warehouse[_0x2047ae(0x1d9)]({'name':_0x240b25[_0x2047ae(0x1d6)],'room':_0x240b25[_0x2047ae(0x250)]});_0x240b25['product'][_0x2047ae(0x241)](_0x12111a=>{var _0x586de0=_0x2047ae;const _0x19901c=_0x36502d[_0x586de0(0x2d2)][_0x586de0(0x2ec)](_0x7da0a=>{var _0x3280de=_0x586de0;_0x7da0a[_0x3280de(0x231)]==_0x12111a['product_name']&&_0x7da0a[_0x3280de(0x1f7)]==_0x12111a[_0x3280de(0x1f7)]&&(_0x7da0a['product_stock']=parseInt(_0x7da0a['product_stock'])-parseInt(_0x12111a[_0x3280de(0x2b0)]));});}),await _0x36502d['save']();const {invoice:_0x221054,suppliers:_0x2ef7b1,date:_0x1ba3a6,warehouse_name:_0x2d32aa,prod_name:_0x1e3419,prod_code:_0x129628,prod_qty:_0x3245f5,prod_unit:_0x1ba78b,prod_secondunit:_0x6e7506,prod_level:_0x5e89d3,prod_isle:_0x38ff75,prod_pallet:_0x2c0f0f,note:_0x209a21,expiry_date:_0x5a3d0,batch_code:_0x491f5a,paid_amount:_0x2d674d,due_amount:_0x220dff,Room_name:_0x228680,primary_code:_0x3a66ed,secondary_code:_0x2bf0a4,PO_number:_0x283a37,JO_number:_0x5dd2f6}=_0x3e0a47[_0x2047ae(0x281)];if(typeof _0x1e3419==_0x2047ae(0x1ff))var _0x559c84=[_0x3e0a47['body']['prod_name']],_0x3c9910=[_0x3e0a47['body'][_0x2047ae(0x27d)]],_0x550e3b=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x24f)]],_0x4e5d16=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x224)]],_0xef96b8=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x252)]],_0x2ef171=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x2bf)]],_0x1348f5=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x244)]],_0x2960f0=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x1dd)]],_0x3b3067=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x2e4)]],_0x526d68=[_0x3e0a47['body']['batch_code']],_0x346f26=[_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x248)]];else var _0x559c84=[..._0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x20d)]],_0x3c9910=[..._0x3e0a47[_0x2047ae(0x281)]['prod_code']],_0x550e3b=[..._0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x24f)]],_0x4e5d16=[..._0x3e0a47['body']['prod_unit']],_0xef96b8=[..._0x3e0a47[_0x2047ae(0x281)]['prod_secondunit']],_0x2ef171=[..._0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x2bf)]],_0x1348f5=[..._0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x244)]],_0x2960f0=[..._0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x1dd)]],_0x3b3067=[..._0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x2e4)]],_0x526d68=[..._0x3e0a47['body'][_0x2047ae(0x2d4)]],_0x346f26=[..._0x3e0a47['body']['expiry_date']];const _0x1bd879=_0x559c84[_0x2047ae(0x2ec)](_0x24830f=>{return _0x24830f={'product_name':_0x24830f};});_0x3c9910[_0x2047ae(0x241)]((_0xb37940,_0x214262)=>{var _0x48f97d=_0x2047ae;_0x1bd879[_0x214262][_0x48f97d(0x257)]=_0xb37940;}),_0x550e3b[_0x2047ae(0x241)]((_0x12ce5d,_0x370153)=>{var _0x4b52cf=_0x2047ae;_0x1bd879[_0x370153][_0x4b52cf(0x2b0)]=_0x12ce5d;}),_0x4e5d16[_0x2047ae(0x241)]((_0x4d1b58,_0x594368)=>{var _0x36ae23=_0x2047ae;_0x1bd879[_0x594368][_0x36ae23(0x221)]=_0x4d1b58;}),_0xef96b8[_0x2047ae(0x241)]((_0x5a62cb,_0x354df5)=>{var _0x1822e9=_0x2047ae;_0x1bd879[_0x354df5][_0x1822e9(0x305)]=_0x5a62cb;}),_0x2ef171[_0x2047ae(0x241)]((_0x527389,_0xba782a)=>{var _0x53234a=_0x2047ae;_0x1bd879[_0xba782a][_0x53234a(0x1f7)]=_0x527389;}),_0x1348f5[_0x2047ae(0x241)]((_0x1e85a1,_0xc4bd2d)=>{var _0xd1ed6a=_0x2047ae;_0x1bd879[_0xc4bd2d][_0xd1ed6a(0x244)]=_0x1e85a1;}),_0x2960f0[_0x2047ae(0x241)]((_0x54648c,_0x1ebdc0)=>{var _0x2ca194=_0x2047ae;_0x1bd879[_0x1ebdc0][_0x2ca194(0x1dd)]=_0x54648c;}),_0x3b3067[_0x2047ae(0x241)]((_0x5340ca,_0x5820bc)=>{var _0x49e6d1=_0x2047ae;_0x1bd879[_0x5820bc][_0x49e6d1(0x209)]=_0x5340ca;}),_0x526d68['forEach']((_0x35f0da,_0x3053cb)=>{var _0x5b04f0=_0x2047ae;_0x1bd879[_0x3053cb][_0x5b04f0(0x2d4)]=_0x35f0da;}),_0x346f26[_0x2047ae(0x241)]((_0x1748e9,_0x281568)=>{var _0x23a0ce=_0x2047ae;_0x1bd879[_0x281568][_0x23a0ce(0x248)]=_0x1748e9;});const _0x2fcc13=_0x1bd879[_0x2047ae(0x2d8)](_0x5d73e3=>_0x5d73e3['quantity']!=='0'&&_0x5d73e3['quantity']!=='');_0x240b25[_0x2047ae(0x2f7)]=_0x221054,_0x240b25[_0x2047ae(0x22b)]=_0x2ef7b1,_0x240b25[_0x2047ae(0x21e)]=_0x1ba3a6,_0x240b25[_0x2047ae(0x1d6)]=_0x2d32aa,_0x240b25['product']=_0x2fcc13,_0x240b25[_0x2047ae(0x20a)]=_0x209a21,_0x240b25[_0x2047ae(0x2a0)]=_0x2d674d,_0x240b25[_0x2047ae(0x276)]=_0x220dff,_0x240b25[_0x2047ae(0x250)]=_0x228680,_0x240b25[_0x2047ae(0x237)]=_0x283a37,_0x240b25[_0x2047ae(0x1ce)]=_0x5dd2f6;const _0x1d7043=await _0x240b25[_0x2047ae(0x2af)](),_0x15ff76=await warehouse[_0x2047ae(0x1d9)]({'name':_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x1d6)],'room':_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x2d6)]});_0x240b25[_0x2047ae(0x1d0)][_0x2047ae(0x241)](_0x400425=>{var _0xc0c20e=_0x2047ae,_0x1b844d=0x0;const _0x4f9931=_0x15ff76[_0xc0c20e(0x2d2)]['map'](_0x73d8fd=>{var _0x2e39db=_0xc0c20e;_0x73d8fd[_0x2e39db(0x231)]==_0x400425[_0x2e39db(0x231)]&&_0x73d8fd[_0x2e39db(0x1f7)]==_0x400425[_0x2e39db(0x1f7)]&&(_0x73d8fd['product_stock']=parseInt(_0x73d8fd['product_stock'])+parseInt(_0x400425[_0x2e39db(0x2b0)]),_0x1b844d++);});_0x1b844d=='0'&&(_0x15ff76['product_details']=_0x15ff76[_0xc0c20e(0x2d2)][_0xc0c20e(0x222)]({'product_name':_0x400425[_0xc0c20e(0x231)],'product_stock':_0x400425[_0xc0c20e(0x2b0)],'primary_code':_0x400425[_0xc0c20e(0x244)],'secondary_code':_0x400425[_0xc0c20e(0x1dd)],'product_code':_0x400425[_0xc0c20e(0x257)],'bay':_0x400425[_0xc0c20e(0x1f7)],'maxProducts':_0x400425[_0xc0c20e(0x209)],'unit':_0x400425[_0xc0c20e(0x221)],'secondary_unit':_0x400425['secondary_unit'],'expiry_date':_0x400425[_0xc0c20e(0x248)]}));}),await _0x15ff76[_0x2047ae(0x2af)]();const _0x16b047=await s_payment_data[_0x2047ae(0x1d9)]({'invoice':_0x3e0a47[_0x2047ae(0x281)][_0x2047ae(0x2f7)]});if(_0x16b047===null){}else console[_0x2047ae(0x20f)]('suppliers',_0x16b047,_0x3e0a47[_0x2047ae(0x281)]['invoice']),_0x16b047[_0x2047ae(0x22b)]=_0x3e0a47[_0x2047ae(0x281)]['suppliers'],await _0x16b047[_0x2047ae(0x2af)]();_0x3e0a47[_0x2047ae(0x201)](_0x2047ae(0x285),_0x2047ae(0x25e)),_0x16bbd0['redirect'](_0x2047ae(0x247));}catch(_0x18cdfa){console[_0x2047ae(0x20f)](_0x18cdfa);}}),router[a0_0x533dff(0x277)](a0_0x533dff(0x2ed),auth,async(_0xa41453,_0x374067)=>{var _0x1f7664=a0_0x533dff;try{const _0x18d60b=_0xa41453[_0x1f7664(0x2b9)]['id'],{invoice:_0xb4bbe7,suppliers:_0x169ddd,payable:_0x11554a,due_amount:_0x69faa0}=_0xa41453[_0x1f7664(0x281)],_0x8e3f25=await purchases[_0x1f7664(0x29b)](_0x18d60b);var _0x69bcc1=_0x11554a-_0x69faa0;_0x8e3f25[_0x1f7664(0x2a0)]=parseFloat(_0x8e3f25[_0x1f7664(0x2a0)])+parseFloat(_0x69faa0),_0x8e3f25[_0x1f7664(0x276)]=_0x69bcc1;const _0x1e803c=await _0x8e3f25[_0x1f7664(0x2af)]();console[_0x1f7664(0x20f)](_0x1e803c);const _0x163398=await s_payment_data[_0x1f7664(0x1d9)]({'invoice':_0xb4bbe7});_0x163398[_0x1f7664(0x1e8)]=_0x69bcc1,await _0x163398[_0x1f7664(0x2af)]();let _0x1781a5=new Date(),_0x1ef024=('0'+_0x1781a5[_0x1f7664(0x1fa)]())[_0x1f7664(0x2c9)](-0x2),_0x35464f=('0'+(_0x1781a5[_0x1f7664(0x204)]()+0x1))[_0x1f7664(0x2c9)](-0x2),_0xddf9e1=_0x1781a5[_0x1f7664(0x2f8)](),_0x5e04ed=_0xddf9e1+'-'+_0x35464f+'-'+_0x1ef024;const _0x258d26=new suppliers_payment({'invoice':_0xb4bbe7,'date':_0xddf9e1+'-'+_0x35464f+'-'+_0x1ef024,'suppliers':_0x169ddd,'reason':_0x1f7664(0x218),'amount':_0x69faa0}),_0x59e83a=await _0x258d26[_0x1f7664(0x2af)]();_0xa41453[_0x1f7664(0x201)](_0x1f7664(0x285),_0x1f7664(0x233)),_0x374067[_0x1f7664(0x2bb)](_0x1f7664(0x2b8));}catch(_0x446637){console[_0x1f7664(0x20f)](_0x446637);}}),router[a0_0x533dff(0x1f3)](a0_0x533dff(0x1e1),auth,async(_0x46741f,_0x19ed6a)=>{var _0x231823=a0_0x533dff;try{const {username:_0x481504,email:_0x3b5ad2,role:_0x168769}=_0x46741f['user'],_0x146f73=_0x46741f['user'],_0x1c9513=await profile[_0x231823(0x1d9)]({'email':_0x146f73[_0x231823(0x288)]}),_0x31572f=await master_shop[_0x231823(0x1f1)]();console[_0x231823(0x20f)](_0x231823(0x24d),_0x31572f);const _0x1dc54a=_0x46741f[_0x231823(0x2b9)]['id'],_0x522361=await purchases[_0x231823(0x29b)](_0x1dc54a);console[_0x231823(0x20f)](_0x522361);const _0x2d3e69=await suppliers[_0x231823(0x1d9)]({'name':_0x522361[_0x231823(0x22b)]});console[_0x231823(0x20f)](_0x2d3e69);if(_0x31572f[0x0][_0x231823(0x2b2)]==_0x231823(0x256)){var _0x430356=users[_0x231823(0x29d)];console['log'](_0x430356);}else{if(_0x31572f[0x0][_0x231823(0x2b2)]==_0x231823(0x27e))var _0x430356=users[_0x231823(0x27e)];else{if(_0x31572f[0x0]['language']==_0x231823(0x28e))var _0x430356=users[_0x231823(0x28e)];else{if(_0x31572f[0x0][_0x231823(0x2b2)]==_0x231823(0x2a5))var _0x430356=users[_0x231823(0x2a5)];else{if(_0x31572f[0x0][_0x231823(0x2b2)]=='French')var _0x430356=users[_0x231823(0x310)];else{if(_0x31572f[0x0]['language']==_0x231823(0x1ed))var _0x430356=users[_0x231823(0x27c)];else{if(_0x31572f[0x0][_0x231823(0x2b2)]==_0x231823(0x227))var _0x430356=users['Chinese'];else{if(_0x31572f[0x0][_0x231823(0x2b2)]=='Arabic\x20(ae)')var _0x430356=users['Arabic'];}}}}}}}_0x19ed6a[_0x231823(0x287)](_0x231823(0x2fa),{'success':_0x46741f[_0x231823(0x201)](_0x231823(0x285)),'errors':_0x46741f['flash'](_0x231823(0x2b6)),'role':_0x146f73,'profile':_0x1c9513,'master_shop':_0x31572f,'supplier':_0x2d3e69,'purchase':_0x522361,'language':_0x430356});}catch(_0x2389ed){console['log'](_0x2389ed);}}),router[a0_0x533dff(0x1f3)]('/view/return_purchase/:id',auth,async(_0x5f1b57,_0x2a1fda)=>{var _0x4f570e=a0_0x533dff;try{const {username:_0x589203,email:_0x19d2ad,role:_0xb4ba78}=_0x5f1b57['user'],_0x55f565=_0x5f1b57[_0x4f570e(0x260)],_0x24f16b=await profile[_0x4f570e(0x1d9)]({'email':_0x55f565[_0x4f570e(0x288)]}),_0x256a8e=await master_shop[_0x4f570e(0x1f1)]();console[_0x4f570e(0x20f)](_0x4f570e(0x24d),_0x256a8e);const _0xd8c8f5=_0x5f1b57['params']['id'];console[_0x4f570e(0x20f)](_0xd8c8f5);const _0x3a0bd0=await purchases_finished[_0x4f570e(0x29b)](_0xd8c8f5);console[_0x4f570e(0x20f)]('user_id',_0x3a0bd0);const _0x8d2a33=await product[_0x4f570e(0x1f1)]({}),_0xd2f672=await warehouse[_0x4f570e(0x1f2)]([{'$match':{'name':_0x3a0bd0[_0x4f570e(0x1d6)],'room':_0x3a0bd0[_0x4f570e(0x250)]}},{'$unwind':_0x4f570e(0x1e6)},{'$group':{'_id':_0x4f570e(0x21d),'name':{'$first':_0x4f570e(0x259)},'product_stock':{'$first':_0x4f570e(0x1cd)},'bay':{'$first':_0x4f570e(0x2cf)},'bin':{'$first':_0x4f570e(0x2b3)},'type':{'$first':_0x4f570e(0x283)},'floorlevel':{'$first':_0x4f570e(0x289)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4f570e(0x1d1)},'storage':{'$first':_0x4f570e(0x298)},'rack':{'$first':_0x4f570e(0x2c2)}}}]);console[_0x4f570e(0x20f)](_0x4f570e(0x284),_0xd2f672);let _0x27d7e5;if(_0x55f565[_0x4f570e(0x210)]==_0x4f570e(0x2ff)){const _0x228255=await staff[_0x4f570e(0x1d9)]({'email':_0x55f565[_0x4f570e(0x288)]});_0x27d7e5=await warehouse['find']({'status':'Enabled','name':_0x228255[_0x4f570e(0x2a9)],'warehouse_category':'Finished\x20Goods','name':_0x4f570e(0x29c)});}else _0x27d7e5=await warehouse[_0x4f570e(0x1f2)]([{'$match':{'status':'Enabled','warehouse_category':_0x4f570e(0x2a8),'name':_0x4f570e(0x29c)}},{'$group':{'_id':_0x4f570e(0x1f9),'name':{'$first':_0x4f570e(0x1f9)}}}]);if(_0x256a8e[0x0]['language']==_0x4f570e(0x256)){var _0x5a52b6=users[_0x4f570e(0x29d)];console['log'](_0x5a52b6);}else{if(_0x256a8e[0x0][_0x4f570e(0x2b2)]=='Hindi')var _0x5a52b6=users[_0x4f570e(0x27e)];else{if(_0x256a8e[0x0][_0x4f570e(0x2b2)]=='German')var _0x5a52b6=users['German'];else{if(_0x256a8e[0x0][_0x4f570e(0x2b2)]=='Spanish')var _0x5a52b6=users[_0x4f570e(0x2a5)];else{if(_0x256a8e[0x0][_0x4f570e(0x2b2)]=='French')var _0x5a52b6=users[_0x4f570e(0x310)];else{if(_0x256a8e[0x0]['language']==_0x4f570e(0x1ed))var _0x5a52b6=users['Portuguese'];else{if(_0x256a8e[0x0][_0x4f570e(0x2b2)]==_0x4f570e(0x227))var _0x5a52b6=users[_0x4f570e(0x227)];else{if(_0x256a8e[0x0][_0x4f570e(0x2b2)]==_0x4f570e(0x2fc))var _0x5a52b6=users[_0x4f570e(0x274)];}}}}}}}_0x2a1fda[_0x4f570e(0x287)](_0x4f570e(0x235),{'success':_0x5f1b57[_0x4f570e(0x201)](_0x4f570e(0x285)),'errors':_0x5f1b57[_0x4f570e(0x201)](_0x4f570e(0x2b6)),'role':_0x55f565,'profile':_0x24f16b,'user':_0x3a0bd0,'stock':_0xd2f672,'master_shop':_0x256a8e,'product':_0x8d2a33,'language':_0x5a52b6,'warehouse':_0x27d7e5});}catch(_0x549562){console[_0x4f570e(0x20f)](_0x549562);}}),router[a0_0x533dff(0x277)](a0_0x533dff(0x2e2),auth,async(_0x3ff8f8,_0x550144)=>{var _0x2b1ff5=a0_0x533dff;try{const {invoice:_0x505b46,date:_0x22688e,warehouse_name:_0x33816d,Room_name:_0x123e55,product_name:_0x1b45f2,purchase_quantity:_0x333e04,stocks:_0x1653cd,return_qty:_0x3791fd,note:_0x4351fb,level:_0x1996e4,isle:_0x3f6cf7,pallet:_0x5e4d65,to_warehouse_name:_0x5ce2bf,to_Room_name:_0x41970b}=_0x3ff8f8[_0x2b1ff5(0x281)],_0x40c42d=await purchases_finished[_0x2b1ff5(0x1d9)]({'_id':_0x3ff8f8[_0x2b1ff5(0x2b9)]['id']}),_0x4ebcd9=await warehouse[_0x2b1ff5(0x1d9)]({'name':_0x33816d,'room':_0x123e55,'warehouse_category':_0x2b1ff5(0x2a8)});if(typeof _0x1b45f2==_0x2b1ff5(0x1ff))var _0x5efbf6=[_0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x231)]],_0x2bb404=[_0x3ff8f8[_0x2b1ff5(0x281)]['purchase_quantity']],_0x1cdc0a=[_0x3ff8f8[_0x2b1ff5(0x281)]['stocks']],_0x3ff036=[_0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x2df)]],_0xe16009=[_0x3ff8f8[_0x2b1ff5(0x281)]['level']],_0x2a49a2=[_0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x203)]],_0x16986a=[_0x3ff8f8[_0x2b1ff5(0x281)]['primary_code_hide']],_0x157ebe=[_0x3ff8f8['body'][_0x2b1ff5(0x2f9)]];else var _0x5efbf6=[..._0x3ff8f8['body']['product_name']],_0x2bb404=[..._0x3ff8f8[_0x2b1ff5(0x281)]['purchase_quantity']],_0x1cdc0a=[..._0x3ff8f8['body']['stocks']],_0x3ff036=[..._0x3ff8f8['body'][_0x2b1ff5(0x2df)]],_0xe16009=[..._0x3ff8f8[_0x2b1ff5(0x281)]['level']],_0x2a49a2=[..._0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x203)]],_0x16986a=[..._0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x239)]],_0x157ebe=[..._0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x2f9)]];const _0xb4ddb5=_0x5efbf6[_0x2b1ff5(0x2ec)](_0x446be5=>{return _0x446be5={'product_name':_0x446be5};});_0x2bb404[_0x2b1ff5(0x241)]((_0x50b1f6,_0x483caa)=>{var _0x33f548=_0x2b1ff5;_0xb4ddb5[_0x483caa][_0x33f548(0x2b7)]=_0x50b1f6;}),_0x1cdc0a['forEach']((_0x309011,_0x327dcc)=>{var _0x2b172c=_0x2b1ff5;_0xb4ddb5[_0x327dcc][_0x2b172c(0x292)]=_0x309011;}),_0x3ff036[_0x2b1ff5(0x241)]((_0xe80338,_0x178ce1)=>{var _0x338ee4=_0x2b1ff5;_0xb4ddb5[_0x178ce1][_0x338ee4(0x2df)]=_0xe80338;}),_0xe16009[_0x2b1ff5(0x241)]((_0x3e0ad0,_0x2f5218)=>{var _0x3ef24d=_0x2b1ff5;_0xb4ddb5[_0x2f5218][_0x3ef24d(0x1f7)]=_0x3e0ad0;}),_0x2a49a2[_0x2b1ff5(0x241)]((_0x5a401d,_0x224574)=>{var _0x2c67dc=_0x2b1ff5;_0xb4ddb5[_0x224574][_0x2c67dc(0x257)]=_0x5a401d;}),_0x16986a[_0x2b1ff5(0x241)]((_0x5c3681,_0x4a04b7)=>{_0xb4ddb5[_0x4a04b7]['primary_code']=_0x5c3681;}),_0x157ebe[_0x2b1ff5(0x241)]((_0x4fccea,_0x18b258)=>{var _0x4ca204=_0x2b1ff5;_0xb4ddb5[_0x18b258][_0x4ca204(0x1dd)]=_0x4fccea;}),_0xb4ddb5['forEach'](_0x3bea9d=>{var _0x541616=_0x2b1ff5;console[_0x541616(0x20f)](_0x3bea9d);const _0x9c5465=_0x4ebcd9[_0x541616(0x2d2)]['map'](_0x5a2b57=>{var _0x2ab0ca=_0x541616;_0x5a2b57['product_name']==_0x3bea9d[_0x2ab0ca(0x231)]&&_0x5a2b57['bay']==_0x3bea9d['bay']&&(console['log'](parseInt(_0x5a2b57[_0x2ab0ca(0x1d4)])+_0x2ab0ca(0x2d0)+parseInt(_0x3bea9d[_0x2ab0ca(0x2df)])),_0x5a2b57['product_stock']=parseInt(_0x5a2b57[_0x2ab0ca(0x1d4)])-parseInt(_0x3bea9d[_0x2ab0ca(0x2df)]));});}),await _0x4ebcd9[_0x2b1ff5(0x2af)]();var _0x2b0ab7=0x0;_0xb4ddb5[_0x2b1ff5(0x241)](_0x262098=>{var _0x4f910d=_0x2b1ff5;(parseInt(_0x262098['purchase_quantity'])<parseInt(_0x262098['return_qty'])||parseInt(_0x262098[_0x4f910d(0x292)])<parseInt(_0x262098[_0x4f910d(0x2df)]))&&_0x2b0ab7++;});if(_0x2b0ab7!=0x0)return _0x3ff8f8[_0x2b1ff5(0x201)](_0x2b1ff5(0x2b6),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x550144['redirect']('back');const _0x2c5fda=new purchases_return_finished({'invoice':_0x505b46,'suppliers':_0x3ff8f8[_0x2b1ff5(0x281)][_0x2b1ff5(0x22b)],'date':_0x22688e,'warehouse_name':_0x33816d,'return_product':_0xb4ddb5,'note':_0x4351fb,'room':_0x123e55,'to_warehouse_name':_0x5ce2bf,'to_room':_0x41970b}),_0x298628=await _0x2c5fda['save'](),_0x112782=await purchases_return_finished[_0x2b1ff5(0x1d9)]({'invoice':_0x505b46}),_0x1ca28e=await warehouse[_0x2b1ff5(0x1d9)]({'name':_0x5ce2bf,'room':_0x41970b,'warehouse_category':_0x2b1ff5(0x2a8)});_0x112782[_0x2b1ff5(0x29e)][_0x2b1ff5(0x241)](_0x143210=>{var _0xe0ee49=_0x2b1ff5,_0x566fc1=0x0;const _0x3b36ea=_0x1ca28e['product_details']['map'](_0x170899=>{var _0x9239bf=a0_0x22b8;console[_0x9239bf(0x20f)](_0x170899[_0x9239bf(0x231)]+'=='+_0x143210['product_name']+'&&'+_0x170899[_0x9239bf(0x1f7)]+'=='+_0x143210[_0x9239bf(0x1f7)]),_0x170899[_0x9239bf(0x231)]==_0x143210[_0x9239bf(0x231)]&&_0x170899[_0x9239bf(0x1f7)]==_0x143210[_0x9239bf(0x1f7)]&&(_0x170899['product_stock']=parseInt(_0x170899[_0x9239bf(0x1d4)])-parseInt(_0x143210[_0x9239bf(0x2df)]),_0x566fc1++);});_0x566fc1=='0'&&(_0x1ca28e[_0xe0ee49(0x2d2)]=_0x1ca28e[_0xe0ee49(0x2d2)][_0xe0ee49(0x222)]({'product_name':_0x143210['product_name'],'product_stock':_0x143210[_0xe0ee49(0x2df)],'primary_code':_0x143210[_0xe0ee49(0x244)],'secondary_code':_0x143210[_0xe0ee49(0x1dd)],'product_code':_0x143210[_0xe0ee49(0x257)],'bay':_0x143210[_0xe0ee49(0x1f7)],'maxProducts':0xf423f}));}),await _0x1ca28e['save']();const _0x335e9e=await purchases_finished[_0x2b1ff5(0x1d9)]({'invoice':_0x505b46});_0x335e9e[_0x2b1ff5(0x313)]='True';const _0xc7806c=await _0x335e9e['save'](),_0x1cd717=new s_payment_data({'invoice':_0x505b46,'suppliers':_0x3ff8f8['body'][_0x2b1ff5(0x22b)],'reason':'Purchase\x20Return'});await _0x1cd717['save']();const _0x109b59=await master_shop[_0x2b1ff5(0x1f1)](),_0x5075a0=await email_settings[_0x2b1ff5(0x1d9)](),_0x17c859=await suppliers[_0x2b1ff5(0x1d9)]({'name':_0x3ff8f8['body'][_0x2b1ff5(0x22b)]});_0x109b59[0x0]['currency_placement']==0x1?(right_currency=_0x109b59[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x109b59[0x0][_0x2b1ff5(0x2a2)]);var _0x4eb674=_0x5efbf6,_0x55c79d=_0x3ff036,_0x8df0d9='',_0x4725e5;for(_0x4725e5 in _0x4eb674){_0x8df0d9+=_0x2b1ff5(0x2f6)+_0x2b1ff5(0x275)+_0x4eb674[_0x4725e5]+_0x2b1ff5(0x30a)+_0x2b1ff5(0x275)+_0x55c79d[_0x4725e5]+'</td>'+_0x2b1ff5(0x1ea);}let _0x183a12=nodemailer[_0x2b1ff5(0x2c1)]({'service':_0x2b1ff5(0x220),'auth':{'user':_0x5075a0[_0x2b1ff5(0x288)],'pass':_0x5075a0[_0x2b1ff5(0x2aa)]}}),_0x192f0e={'from':_0x5075a0[_0x2b1ff5(0x288)],'to':_0x17c859[_0x2b1ff5(0x288)],'subject':_0x2b1ff5(0x2bd),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x2b1ff5(0x29f)+_0x109b59[0x0][_0x2b1ff5(0x26c)],'cid':_0x2b1ff5(0x23c)}],'html':_0x2b1ff5(0x246)+_0x2b1ff5(0x27b)+_0x2b1ff5(0x1e3)+_0x2b1ff5(0x22c)+_0x2b1ff5(0x2de)+_0x2b1ff5(0x22c)+_0x2b1ff5(0x307)+_0x2b1ff5(0x20e)+_0x2b1ff5(0x22c)+_0x2b1ff5(0x2ae)+_0x109b59[0x0][_0x2b1ff5(0x1e7)]+_0x2b1ff5(0x1e2)+'</div>'+_0x2b1ff5(0x20e)+_0x2b1ff5(0x299)+_0x2b1ff5(0x22c)+_0x2b1ff5(0x22d)+_0x2b1ff5(0x2be)+_0x505b46+'\x20'+_0x2b1ff5(0x21f)+_0x2b1ff5(0x2fd)+_0x22688e+'\x20'+'</span>'+_0x2b1ff5(0x23f)+_0x2b1ff5(0x20e)+_0x2b1ff5(0x28c)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2b1ff5(0x25d)+_0x2b1ff5(0x1fe)+_0x2b1ff5(0x271)+_0x2b1ff5(0x1ea)+'</thead>'+_0x2b1ff5(0x300)+'\x20'+_0x8df0d9+'\x20'+_0x2b1ff5(0x226)+_0x2b1ff5(0x214)+_0x2b1ff5(0x22c)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x109b59[0x0]['site_title']+_0x2b1ff5(0x23f)+_0x2b1ff5(0x20e)+_0x2b1ff5(0x20e)+'</body></html>'};_0x183a12[_0x2b1ff5(0x219)](_0x192f0e,function(_0x4e443c,_0x594280){var _0xfa5b17=_0x2b1ff5;_0x4e443c?console[_0xfa5b17(0x20f)](_0xfa5b17(0x1cf)):console[_0xfa5b17(0x20f)](_0xfa5b17(0x24e));}),_0x3ff8f8['flash']('success',_0x2b1ff5(0x2c8)),_0x550144['redirect'](_0x2b1ff5(0x247));}catch(_0x4005d9){_0x550144['status'](0xc8)[_0x2b1ff5(0x28d)]({'message':_0x4005d9['message']});}}),router[a0_0x533dff(0x1f3)](a0_0x533dff(0x27f),auth,async(_0x2f3338,_0x34fc51)=>{var _0x3d56d1=a0_0x533dff;try{const {username:_0x36c28,email:_0x19e401,role:_0x4b849a}=_0x2f3338[_0x3d56d1(0x260)],_0x16a13d=_0x2f3338[_0x3d56d1(0x260)],_0x1dce7c=await profile[_0x3d56d1(0x1d9)]({'email':_0x16a13d[_0x3d56d1(0x288)]}),_0x385ecf=await master_shop[_0x3d56d1(0x1f1)](),_0x3c99c6=_0x2f3338[_0x3d56d1(0x2b9)]['id'],_0x1e2784=await purchases_finished[_0x3d56d1(0x29b)](_0x3c99c6);if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]==_0x3d56d1(0x256))var _0x23d8b1=users[_0x3d56d1(0x29d)];else{if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]==_0x3d56d1(0x27e))var _0x23d8b1=users[_0x3d56d1(0x27e)];else{if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]==_0x3d56d1(0x28e))var _0x23d8b1=users[_0x3d56d1(0x28e)];else{if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]==_0x3d56d1(0x2a5))var _0x23d8b1=users[_0x3d56d1(0x2a5)];else{if(_0x385ecf[0x0]['language']==_0x3d56d1(0x310))var _0x23d8b1=users[_0x3d56d1(0x310)];else{if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]==_0x3d56d1(0x1ed))var _0x23d8b1=users['Portuguese'];else{if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]=='Chinese')var _0x23d8b1=users[_0x3d56d1(0x227)];else{if(_0x385ecf[0x0][_0x3d56d1(0x2b2)]==_0x3d56d1(0x2fc))var _0x23d8b1=users[_0x3d56d1(0x274)];}}}}}}}_0x34fc51[_0x3d56d1(0x287)](_0x3d56d1(0x1e5),{'success':_0x2f3338[_0x3d56d1(0x201)](_0x3d56d1(0x285)),'errors':_0x2f3338[_0x3d56d1(0x201)](_0x3d56d1(0x2b6)),'role':_0x16a13d,'profile':_0x1dce7c,'alldata':_0x1e2784,'master_shop':_0x385ecf,'language':_0x23d8b1}),console[_0x3d56d1(0x20f)](alldata);}catch(_0x323b56){console[_0x3d56d1(0x20f)](_0x323b56);}}),router[a0_0x533dff(0x277)](a0_0x533dff(0x28f),async(_0x24ccb6,_0x55b645)=>{var _0xb2452b=a0_0x533dff;const {product_code:_0x1ea703}=_0x24ccb6[_0xb2452b(0x281)];var _0xc6fc71;const _0x1ae783=await product[_0xb2452b(0x1f2)]([{'$match':{'primary_code':_0x1ea703}},{'$group':{'_id':_0xb2452b(0x21a),'name':{'$first':_0xb2452b(0x1f9)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0xb2452b(0x2f2)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0xb2452b(0x303)},'primary_code':{'$first':_0xb2452b(0x2f3)},'secondary_code':{'$first':_0xb2452b(0x280)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xb2452b(0x1e4)},'gross_price':{'$first':_0xb2452b(0x1ef)},'sales_category':{'$first':_0xb2452b(0x2a4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x337d3a=await product[_0xb2452b(0x1f2)]([{'$match':{'secondary_code':_0x1ea703}},{'$group':{'_id':_0xb2452b(0x21a),'name':{'$first':_0xb2452b(0x1f9)},'category':{'$first':_0xb2452b(0x254)},'brand':{'$first':_0xb2452b(0x1da)},'unit':{'$first':_0xb2452b(0x2f2)},'alertquantity':{'$first':_0xb2452b(0x293)},'product_code':{'$first':_0xb2452b(0x303)},'primary_code':{'$first':_0xb2452b(0x2f3)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0xb2452b(0x212)},'maxProdPerUnit':{'$first':_0xb2452b(0x211)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xb2452b(0x1e4)},'gross_price':{'$first':_0xb2452b(0x1ef)},'sales_category':{'$first':_0xb2452b(0x2a4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x1ae783[_0xb2452b(0x24c)]>0x0)_0xc6fc71=_0x1ae783;else _0x337d3a[_0xb2452b(0x24c)]>0x0&&(_0xc6fc71=_0x337d3a);_0x55b645[_0xb2452b(0x28d)](_0xc6fc71);}),router[a0_0x533dff(0x277)]('/CheckingWarehouse',async(_0xd6a0a2,_0x179807)=>{var _0x4235de=a0_0x533dff;const {productCode:_0xb0560e,bay:_0x25e7a3,warehouses:_0x543f65,room:_0x1e1cf0}=_0xd6a0a2[_0x4235de(0x281)];console['log'](_0xd6a0a2[_0x4235de(0x281)]);try{const _0x49c73f=await warehouse['aggregate']([{'$match':{'name':_0x543f65,'room':_0x1e1cf0}},{'$unwind':_0x4235de(0x1e6)},{'$match':{'product_details.bay':parseInt(_0x25e7a3)}},{'$group':{'_id':_0x4235de(0x21d),'name':{'$first':_0x4235de(0x259)},'product_stock':{'$first':_0x4235de(0x1cd)},'bay':{'$first':_0x4235de(0x2cf)},'maxProducts':{'$first':_0x4235de(0x26f)}}}]);_0x179807[_0x4235de(0x1d8)](0xc8)[_0x4235de(0x28d)](_0x49c73f);}catch(_0x4b77ab){_0x179807[_0x4235de(0x1d8)](0x194)[_0x4235de(0x28d)]({'message':_0x4b77ab[_0x4235de(0x217)]});}}),router[a0_0x533dff(0x277)](a0_0x533dff(0x2b1),async(_0x2a22c6,_0x335012)=>{var _0x1884a4=a0_0x533dff;const {product_code:_0x10d0c3}=_0x2a22c6[_0x1884a4(0x281)];var _0x6da065;const _0x54c40a=await product[_0x1884a4(0x1f2)]([{'$match':{'primary_code':_0x10d0c3,'type_products':_0x1884a4(0x20f)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x1884a4(0x254)},'brand':{'$first':_0x1884a4(0x1da)},'unit':{'$first':_0x1884a4(0x2f2)},'alertquantity':{'$first':_0x1884a4(0x293)},'product_code':{'$first':_0x1884a4(0x303)},'primary_code':{'$first':_0x1884a4(0x2f3)},'secondary_code':{'$first':_0x1884a4(0x280)},'maxStocks':{'$first':_0x1884a4(0x212)},'maxProdPerUnit':{'$first':_0x1884a4(0x211)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1884a4(0x1e4)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x1884a4(0x2a4)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x1884a4(0x20f)](_0x54c40a);const _0x545f80=await product[_0x1884a4(0x1f2)]([{'$match':{'secondary_code':_0x10d0c3,'type_products':_0x1884a4(0x20f)}},{'$group':{'_id':'$_id','name':{'$first':_0x1884a4(0x1f9)},'category':{'$first':_0x1884a4(0x254)},'brand':{'$first':_0x1884a4(0x1da)},'unit':{'$first':_0x1884a4(0x2f2)},'alertquantity':{'$first':_0x1884a4(0x293)},'product_code':{'$first':_0x1884a4(0x303)},'primary_code':{'$first':_0x1884a4(0x2f3)},'secondary_code':{'$first':_0x1884a4(0x280)},'maxStocks':{'$first':_0x1884a4(0x212)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1884a4(0x1e4)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x1884a4(0x2a4)},'type_products':{'$first':_0x1884a4(0x1ee)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x54c40a[_0x1884a4(0x24c)]>0x0)_0x6da065=_0x54c40a;else _0x545f80[_0x1884a4(0x24c)]>0x0&&(_0x6da065=_0x545f80);_0x335012['json'](_0x6da065);}),module['exports']=router;