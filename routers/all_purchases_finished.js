var a0_0x41fc1a=a0_0x5679;(function(_0x59f789,_0x1a554d){var _0x116a4b=a0_0x5679,_0x2bfdaf=_0x59f789();while(!![]){try{var _0x1b409f=parseInt(_0x116a4b(0x24d))/0x1+parseInt(_0x116a4b(0x293))/0x2*(parseInt(_0x116a4b(0x1ce))/0x3)+-parseInt(_0x116a4b(0x209))/0x4+parseInt(_0x116a4b(0x243))/0x5+parseInt(_0x116a4b(0x28e))/0x6*(parseInt(_0x116a4b(0x1cd))/0x7)+-parseInt(_0x116a4b(0x252))/0x8+parseInt(_0x116a4b(0x28a))/0x9;if(_0x1b409f===_0x1a554d)break;else _0x2bfdaf['push'](_0x2bfdaf['shift']());}catch(_0xdfb4bf){_0x2bfdaf['push'](_0x2bfdaf['shift']());}}}(a0_0x28e7,0xb1c1d));const express=require('express'),app=express(),router=express[a0_0x41fc1a(0x2e6)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x41fc1a(0x1e2)),auth=require(a0_0x41fc1a(0x277)),nodemailer=require(a0_0x41fc1a(0x1b9));var ejs=require(a0_0x41fc1a(0x204));const path=require(a0_0x41fc1a(0x1e3)),users=require(a0_0x41fc1a(0x247)),{isNull}=require(a0_0x41fc1a(0x28d));router[a0_0x41fc1a(0x29e)]('/incoming',auth,async(_0x598d5d,_0x2988f8)=>{var _0xd6fb50=a0_0x41fc1a;try{const {username:_0xdb151a,email:_0x1af83d,role:_0x397c16}=_0x598d5d[_0xd6fb50(0x24f)],_0x5131b0=_0x598d5d[_0xd6fb50(0x24f)],_0x6d9979=await profile[_0xd6fb50(0x2cb)]({'email':_0x5131b0[_0xd6fb50(0x285)]}),_0x1c17c1=await staff[_0xd6fb50(0x2cb)]({'email':_0x5131b0[_0xd6fb50(0x285)]}),_0x3552c1=await master_shop[_0xd6fb50(0x205)]();let _0x169393=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x1c17c1[_0xd6fb50(0x290)]}}]);if(_0x3552c1[0x0]['language']==_0xd6fb50(0x2ba))var _0x4cbc48=users['English'];else{if(_0x3552c1[0x0][_0xd6fb50(0x2ad)]=='Hindi')var _0x4cbc48=users['Hindi'];else{if(_0x3552c1[0x0][_0xd6fb50(0x2ad)]==_0xd6fb50(0x2f1))var _0x4cbc48=users[_0xd6fb50(0x2f1)];else{if(_0x3552c1[0x0][_0xd6fb50(0x2ad)]==_0xd6fb50(0x283))var _0x4cbc48=users['Spanish'];else{if(_0x3552c1[0x0][_0xd6fb50(0x2ad)]==_0xd6fb50(0x2a3))var _0x4cbc48=users['French'];else{if(_0x3552c1[0x0][_0xd6fb50(0x2ad)]==_0xd6fb50(0x1fa))var _0x4cbc48=users[_0xd6fb50(0x2d8)];else{if(_0x3552c1[0x0][_0xd6fb50(0x2ad)]==_0xd6fb50(0x218))var _0x4cbc48=users[_0xd6fb50(0x218)];else{if(_0x3552c1[0x0]['language']==_0xd6fb50(0x2f3))var _0x4cbc48=users['Arabic'];}}}}}}}_0x2988f8['render'](_0xd6fb50(0x255),{'success':_0x598d5d['flash']('success'),'errors':_0x598d5d[_0xd6fb50(0x251)](_0xd6fb50(0x2f0)),'purchases':_0x169393,'role':_0x5131b0,'profile':_0x6d9979,'master_shop':_0x3552c1,'language':_0x4cbc48,'staff_data':_0x1c17c1});}catch(_0x23b8ee){console[_0xd6fb50(0x295)](_0xd6fb50(0x2b8),_0x23b8ee),_0x2988f8[_0xd6fb50(0x1fd)](0xc8)[_0xd6fb50(0x2b0)]({'message':_0x23b8ee['message']});}}),router[a0_0x41fc1a(0x29e)]('/incoming/add',auth,async(_0x17aedf,_0x426130)=>{var _0x40fdc4=a0_0x41fc1a;try{const {username:_0x121d0f,email:_0x35169a,role:_0x1b7519}=_0x17aedf[_0x40fdc4(0x24f)],_0x2851f0=_0x17aedf['user'],_0x52312a=await profile['findOne']({'email':_0x2851f0['email']}),_0x5473f0=await staff[_0x40fdc4(0x2cb)]({'email':_0x2851f0[_0x40fdc4(0x285)]}),_0x4589d7=await master_shop[_0x40fdc4(0x205)]();let _0x42c530=await transfers_finished[_0x40fdc4(0x29c)]([{'$match':{'to_warehouse':_0x5473f0[_0x40fdc4(0x290)],'to_recieved':_0x40fdc4(0x2cf)}}]);if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]==_0x40fdc4(0x2ba))var _0x41d9fb=users[_0x40fdc4(0x1cb)];else{if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]=='Hindi')var _0x41d9fb=users[_0x40fdc4(0x2c0)];else{if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]==_0x40fdc4(0x2f1))var _0x41d9fb=users[_0x40fdc4(0x2f1)];else{if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]==_0x40fdc4(0x283))var _0x41d9fb=users[_0x40fdc4(0x283)];else{if(_0x4589d7[0x0]['language']==_0x40fdc4(0x2a3))var _0x41d9fb=users[_0x40fdc4(0x2a3)];else{if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]=='Portuguese\x20(BR)')var _0x41d9fb=users[_0x40fdc4(0x2d8)];else{if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]=='Chinese')var _0x41d9fb=users[_0x40fdc4(0x218)];else{if(_0x4589d7[0x0][_0x40fdc4(0x2ad)]==_0x40fdc4(0x2f3))var _0x41d9fb=users[_0x40fdc4(0x234)];}}}}}}}_0x426130['render']('incoming_add',{'success':_0x17aedf['flash']('success'),'errors':_0x17aedf[_0x40fdc4(0x251)](_0x40fdc4(0x2f0)),'purchases':_0x42c530,'role':_0x2851f0,'profile':_0x52312a,'master_shop':_0x4589d7,'language':_0x41d9fb,'staff_data':_0x5473f0});}catch(_0x11fc33){console['log']('table\x20page',_0x11fc33),_0x426130[_0x40fdc4(0x1fd)](0xc8)[_0x40fdc4(0x2b0)]({'message':_0x11fc33['message']});}});const createLog=async _0x5c402a=>{var _0x1569d2=a0_0x41fc1a;const _0x9d2ff2=new datalogs({'location':_0x5c402a});return await _0x9d2ff2[_0x1569d2(0x224)](),_0x9d2ff2['invoice_init'];};function a0_0x28e7(){var _0x546a63=['paid_amount','1413027FSSIng','$suppliers','inc','util','2083398xHXizK','type_of_products_type','warehouse','slice','stocks','2hphRqi','findById','log','$product.room_name','getDate','warehouse_name','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','aggregate','$product_details._id','get',',\x20room:\x20','add_purchases\x20error','Finished\x20Goods','length','French','gross_price','body','role','<tbody\x20style=\x22text-align:\x20center;\x22>','/give_payment/:id','$product_details','error','$product.bin','product_cat','language','2-digit','standard_unit','json','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Asia/Manila','$_id','production_date','Purchase\x20Return','createTransport','</body></html>','table\x20page','to_quantity','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','An\x20error\x20occurred.','return_qty','purchase\x20data\x20update\x20successfully','padStart','Hindi','currency','<span\x20style=\x22float:\x20right;\x22>','uuid','currency_placement','all_purchases_finished_logs','$type_products','purchase_invoice','<!DOCTYPE\x20html>','prod_code','/barcode/:id','findOne','$product_details.secondary_code','$product_details.floorlevel','add_purchases_finished_logs','false','en-CA','maxProducts','edit_purchases_finished_view','invoice_init','LOG-INC-','message','<div>','$batch_code','Portuguese','maxStocks','</tbody>','abs','name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product','add_purchases_finished','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','purchase_quantity','own','primary_code_hide','return_purchase_finished','max_product_unit','Router','</tr>','Ambient','$product.type','concat','sales_category','product_data','secondary_code_hide','bay','MaxStocks_data','errors','German','batch_code','Arabic\x20(ae)','Purchase\x20Mail','INC','all','prod_cat','purchases_id','INC-','purchases_process','nodemailer','<h5\x20style=\x22text-align:\x20left;\x22>','/incoming/add','RoomAssign','</thead>','prod_Qty','$product_details.product_name','edit_purchases_finished','product_code','$alertquantity','_id','<strong>\x20Regards\x20</strong>','/view_log','$brand','expiry_date','quantity','prod_level','back','English','<h5>','28dWwDvc','925827DBvvFG','prod_qty','level','string','Room_name','success','to_recieved','note','redirect','Enclosed','stock_quantity','$product.floorlevel','map','params','product_date','$paid_amount','product_code_hide','$name','/view','secondary_code','../models/all_models','path','$product_details.product_code','Distributing\x20','True','Email\x20sent\x20successfully','$secondary_unit','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','$product_details.product_stock','\x20Order\x20Number\x20:\x20','$secondary_code','$maxStocks','Logo.png','updateOne','$gross_price','</head><body>','true','room_name','payment\x20successfull','$product_details.type','</div>','/../public','Portuguese\x20(BR)','all_purchases_finished','due_amount','status','\x20<=>\x20','/process/:id','/all_purchases/view','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','return_data','exports','ejs','find','$warehouse_name','stock_data','$product','2972056QCxEPl','secondary_unit','bin','$invoice','$sales_category','toString','max','<hr\x20class=\x22my-3\x22>','\x20</h2>','match','product_name','$product_details.maxProducts','$product.quantity','<tr>','filter','Chinese','invoice','/barcode_scanner_logs','/view/return_purchase/:id','Purchase\x20Return\x20Mail','</td>','valueOf','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.rack','purchase\x20data\x20add\x20successfully','$return_data','save','/view/add_purchases/:id','prod_name','/upload/','$unit','product_stock','Error\x20Occurs','password','$primary_code','Return\x20Goods','date_recieved','master','id_transaction','return_product','DRY\x20GOODS','primary_code','Arabic','$expiry_date','</table>','maxperunit','Rack\x201','to_warehouse','/all_purchases_finished/process/','getMonth','then','$product.bay','/view/:id','logo','unit','$product_details.bay','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','2974725ygjPqy','prod_secondunit','Paid\x20For\x20Purchase','gmail','../public/language/languages.json','floor','product_id','sendMail','$category','port','474787trBFYm','\x20<>\x20','user','</span>','flash','11625352gOCRwJ','There\x27s\x20a\x20error\x20in\x20this\x20transaction','suppliers','incoming_view','to_bay','date','forEach','staff','$maxProdPerUnit','/getinvoicetrf','numeric','here2','host','data_type','/all_purchases_finished/view','post','getFullYear','/CheckingWarehouse','render','prod_unit','$due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>',',\x20bin:\x20','$note','product_details','catch',',\x20bay:\x20','FROZEN\x20GOODS','$product_details.bin','Rack\x202','sales_data_cateory','all_purchases_barcode','min','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$room','INCF-','Enabled','../middleware/auth','random','<h2>\x20','prod_primunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','suppliers_docs','purchases\x20item\x20return\x20successfull','FGSEmail','</h5>','type_of_products','item_code','/view/add_purchases','Spanish','$product_code','email','$suppliers_docs','to_room_name','site_title'];a0_0x28e7=function(){return _0x546a63;};return a0_0x28e7();}function a0_0x5679(_0x4cbb5c,_0x3a7924){var _0x28e7be=a0_0x28e7();return a0_0x5679=function(_0x5679a5,_0x14cd25){_0x5679a5=_0x5679a5-0x1b3;var _0xe5e03c=_0x28e7be[_0x5679a5];return _0xe5e03c;},a0_0x5679(_0x4cbb5c,_0x3a7924);}router[a0_0x41fc1a(0x261)](a0_0x41fc1a(0x1bb),auth,async(_0x50f66a,_0x1f6aea)=>{var _0x1754f6=a0_0x41fc1a;try{const {invoice_trf_data:_0x48c9a3,item_code:_0x1fdd8b,SCRN:_0x336eb4,ReqBy:_0x122b4e,type_of_products:_0x27babd,dateofreq:_0x5aa0c0,PO_number:_0x3c2122,date:_0x59acdc,warehouse_name:_0x404cbe,typeservicesData:_0xf427ea,typevehicle:_0x65fb3b,driver:_0x80cd20,plate:_0x50b09e,van:_0xeec0d1,DRSI:_0x4e8e26,TSU:_0x17e5dd,TFU:_0xdd4ad2,note:_0x471ef9}=_0x50f66a[_0x1754f6(0x2a5)],_0x64b247=await transfers_finished['findById'](_0x48c9a3);if(typeof _0x1fdd8b=='string')var _0x169068=[_0x50f66a['body']['product_name']],_0x2a8324=[_0x50f66a['body']['item_code']],_0x3ed998=[_0x50f66a['body'][_0x1754f6(0x2b9)]],_0x3634cd=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x240)]],_0x4b42f4=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x244)]],_0xb2658e=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x20b)]],_0x57b100=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x233)]],_0x1e35d8=[_0x50f66a['body']['secondary_code']],_0x20fe08=[_0x50f66a['body'][_0x1754f6(0x2f2)]],_0x2a15ea=[_0x50f66a[_0x1754f6(0x2a5)]['expiry_date']],_0x20a8d8=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x2b4)]],_0x202b4d=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x2e5)]],_0x43d318=[_0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x21f)]];else var _0x169068=[..._0x50f66a[_0x1754f6(0x2a5)]['product_name']],_0x2a8324=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x281)]],_0x3ed998=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x2b9)]],_0x3634cd=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x240)]],_0x4b42f4=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x244)]],_0xb2658e=[..._0x50f66a[_0x1754f6(0x2a5)]['bin']],_0x57b100=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x233)]],_0x1e35d8=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x1e1)]],_0x20fe08=[..._0x50f66a['body']['batch_code']],_0x2a15ea=[..._0x50f66a['body'][_0x1754f6(0x1c7)]],_0x20a8d8=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x2b4)]],_0x202b4d=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x2e5)]],_0x43d318=[..._0x50f66a[_0x1754f6(0x2a5)][_0x1754f6(0x21f)]];const _0xc5ab8f=_0x169068[_0x1754f6(0x1da)](_0x33ebee=>{return _0x33ebee={'product_name':_0x33ebee};});_0x2a8324[_0x1754f6(0x258)]((_0x80364,_0x47afc9)=>{_0xc5ab8f[_0x47afc9]['product_code']=_0x80364;}),_0x3ed998[_0x1754f6(0x258)]((_0x2e8d2d,_0x43e76e)=>{var _0xc8bbc9=_0x1754f6;_0xc5ab8f[_0x43e76e][_0xc8bbc9(0x1c8)]=Math['abs'](_0x2e8d2d);}),_0x3634cd[_0x1754f6(0x258)]((_0x16103e,_0x3584f2)=>{var _0x5d2062=_0x1754f6;_0xc5ab8f[_0x3584f2][_0x5d2062(0x2af)]=_0x16103e;}),_0x4b42f4[_0x1754f6(0x258)]((_0x414905,_0x28280f)=>{var _0x1ec7c0=_0x1754f6;_0xc5ab8f[_0x28280f][_0x1ec7c0(0x20a)]=_0x414905;}),_0xb2658e['forEach']((_0x10d9d6,_0x3df3b3)=>{var _0x26abbf=_0x1754f6,_0x3ef339=_0x10d9d6[_0x26abbf(0x212)](/[A-Za-z]+/)[0x0],_0x2c0fea=parseInt(_0x10d9d6[_0x26abbf(0x212)](/\d+/)[0x0]);_0xc5ab8f[_0x3df3b3][_0x26abbf(0x1d0)]=_0x3ef339,_0xc5ab8f[_0x3df3b3][_0x26abbf(0x2ee)]=_0x2c0fea;}),_0x57b100['forEach']((_0x5ed127,_0x56105b)=>{var _0x587d40=_0x1754f6;_0xc5ab8f[_0x56105b][_0x587d40(0x233)]=_0x5ed127;}),_0x1e35d8[_0x1754f6(0x258)]((_0x51861c,_0x2050d6)=>{var _0x5e9567=_0x1754f6;_0xc5ab8f[_0x2050d6][_0x5e9567(0x1e1)]=_0x51861c;}),_0x20fe08[_0x1754f6(0x258)]((_0x6e0a2a,_0x18d545)=>{var _0x532151=_0x1754f6;_0xc5ab8f[_0x18d545][_0x532151(0x2f2)]=_0x6e0a2a;}),_0x2a15ea['forEach']((_0x4fa887,_0x2fba24)=>{var _0x4b8493=_0x1754f6;_0xc5ab8f[_0x2fba24][_0x4b8493(0x1c7)]=_0x4fa887;}),_0x20a8d8['forEach']((_0x222425,_0x1fda6b)=>{var _0x5d32b5=_0x1754f6;_0xc5ab8f[_0x1fda6b][_0x5d32b5(0x2b4)]=_0x222425;}),_0x202b4d['forEach']((_0x7f8dfd,_0x263f57)=>{var _0x239147=_0x1754f6;_0xc5ab8f[_0x263f57][_0x239147(0x237)]=_0x7f8dfd;}),_0x43d318[_0x1754f6(0x258)]((_0x4e3e62,_0x52d29a)=>{var _0x2e347f=_0x1754f6;_0xc5ab8f[_0x52d29a][_0x2e347f(0x1f5)]=_0x4e3e62;});const _0x53e9d0=await createLog(_0x1754f6(0x1b3));_0x43d318[_0x1754f6(0x258)]((_0x353e42,_0x387255)=>{var _0x45556a=_0x1754f6;_0xc5ab8f[_0x387255][_0x45556a(0x219)]=_0x45556a(0x1b7)+_0x53e9d0[_0x45556a(0x20e)]()[_0x45556a(0x2bf)](0x8,'0');});const _0x1da960=_0xc5ab8f[_0x1754f6(0x217)](_0x216e7f=>_0x216e7f[_0x1754f6(0x1c8)]!=='0'&&_0x216e7f['quantity']!==''),_0x2175ff=new purchases_incoming({'invoice':_0x1754f6(0x1b7)+_0x53e9d0[_0x1754f6(0x20e)]()[_0x1754f6(0x2bf)](0x8,'0'),'date':_0x59acdc,'warehouse_name':_0x404cbe,'product':_0x1da960,'note':_0x471ef9,'POnumber':_0x3c2122,'SCRN':_0x336eb4,'ReqBy':_0x122b4e,'dateofreq':_0x5aa0c0,'typeservicesData':_0xf427ea,'van':_0xeec0d1,'typevehicle':_0x65fb3b,'driver':_0x80cd20,'plate':_0x50b09e,'DRSI':_0x4e8e26,'TSU':_0x17e5dd,'TFU':_0xdd4ad2,'typeOfProducts':_0x27babd}),_0x323376=await _0x2175ff['save'](),_0x39810e=_0x323376[_0x1754f6(0x2de)][_0x1754f6(0x1da)](async _0x2056f9=>{var _0x4d3959=_0x1754f6,_0x53a05a=await warehouse[_0x4d3959(0x2cb)]({'name':_0x404cbe,'room':_0x2056f9[_0x4d3959(0x1f5)]});if(_0x2056f9[_0x4d3959(0x1c8)]>0x0){var _0x54b47e=0x0;const _0x2c6271=_0x53a05a['product_details']['map'](_0x6e075c=>{var _0x2e62af=_0x4d3959;_0x6e075c[_0x2e62af(0x213)]==_0x2056f9[_0x2e62af(0x213)]&&_0x6e075c[_0x2e62af(0x2ee)]==_0x2056f9[_0x2e62af(0x256)]&&_0x6e075c[_0x2e62af(0x1c7)]==_0x2056f9[_0x2e62af(0x1c7)]&&_0x6e075c['production_date']==_0x2056f9[_0x2e62af(0x2b4)]&&_0x6e075c[_0x2e62af(0x2f2)]==_0x2056f9[_0x2e62af(0x2f2)]&&_0x6e075c[_0x2e62af(0x219)]==_0x2056f9[_0x2e62af(0x219)]&&(typeof _0x2056f9[_0x2e62af(0x230)]=='undefined'?(console[_0x2e62af(0x295)](_0x2e62af(0x25d),_0x6e075c[_0x2e62af(0x229)]+_0x2e62af(0x24e)+_0x6e075c[_0x2e62af(0x1c3)]+_0x2e62af(0x1fe)+Math[_0x2e62af(0x2db)](_0x6e075c[_0x2e62af(0x229)])+Math['abs'](_0x2056f9['to_quantity'])),_0x6e075c[_0x2e62af(0x229)]=Math[_0x2e62af(0x2db)](_0x6e075c[_0x2e62af(0x229)])+Math[_0x2e62af(0x2db)](_0x2056f9['quantity'])):(_0x6e075c['product_stock']=Math[_0x2e62af(0x2db)](_0x6e075c[_0x2e62af(0x229)])+Math[_0x2e62af(0x2db)](_0x2056f9[_0x2e62af(0x1c8)]),_0x54b47e++));});_0x54b47e=='0'&&(_0x53a05a[_0x4d3959(0x26a)]=_0x53a05a[_0x4d3959(0x26a)]['concat']({'product_name':_0x2056f9[_0x4d3959(0x213)],'product_stock':_0x2056f9['quantity'],'bay':_0x2056f9[_0x4d3959(0x2ee)],'level':_0x2056f9[_0x4d3959(0x1d0)],'product_code':_0x2056f9[_0x4d3959(0x1c1)],'primary_code':_0x2056f9[_0x4d3959(0x233)],'secondary_code':_0x2056f9[_0x4d3959(0x1e1)],'expiry_date':_0x2056f9[_0x4d3959(0x1c7)],'production_date':_0x2056f9['production_date'],'maxProducts':_0x2056f9[_0x4d3959(0x2d1)],'batch_code':_0x2056f9[_0x4d3959(0x2f2)],'secondary_unit':_0x2056f9[_0x4d3959(0x20a)],'unit':_0x2056f9[_0x4d3959(0x2af)],'maxProducts':_0x2056f9['maxProducts'],'maxPerUnit':_0x2056f9['maxPerUnit'],'invoice':_0x2056f9[_0x4d3959(0x219)]}));}return _0x53a05a;});Promise[_0x1754f6(0x1b4)](_0x39810e)[_0x1754f6(0x23c)](async _0x1cd89d=>{var _0x17fc80=_0x1754f6;try{for(const _0x45ccbd of _0x1cd89d){await warehouse[_0x17fc80(0x1f1)]({'_id':_0x45ccbd[_0x17fc80(0x1c3)]},{'$addToSet':{'product_details':{'$each':_0x45ccbd[_0x17fc80(0x26a)]}}});}_0x64b247[_0x17fc80(0x1d4)]=_0x17fc80(0x1f4);const _0x312cf1=await _0x64b247[_0x17fc80(0x224)](),_0x54937b=await master_shop[_0x17fc80(0x205)](),_0x12e7a1=await email_settings['findOne'](),_0x1f86be=await supervisor_settings[_0x17fc80(0x205)]();var _0x33ac8b=_0x2175ff[_0x17fc80(0x2de)],_0x29d447='',_0x4b3cad;for(_0x4b3cad in _0x33ac8b){var _0x43ec3b='FG';_0x2175ff[_0x17fc80(0x239)]==_0x17fc80(0x232)&&(_0x43ec3b='DG'),_0x29d447+=_0x17fc80(0x216)+_0x17fc80(0x2b1)+_0x33ac8b[_0x4b3cad][_0x17fc80(0x213)]+_0x17fc80(0x21d)+_0x17fc80(0x2b1)+_0x33ac8b[_0x4b3cad][_0x17fc80(0x1c1)]+_0x17fc80(0x21d)+_0x17fc80(0x2b1)+_0x33ac8b[_0x4b3cad][_0x17fc80(0x2b9)]+_0x17fc80(0x21d)+_0x17fc80(0x2b1)+_0x33ac8b[_0x4b3cad]['unit']+'</td>'+_0x17fc80(0x2b1)+_0x33ac8b[_0x4b3cad][_0x17fc80(0x20a)]+_0x17fc80(0x21d)+_0x17fc80(0x2b1)+_0x2175ff[_0x17fc80(0x239)]+_0x17fc80(0x21d)+_0x17fc80(0x2b1)+_0x33ac8b[_0x4b3cad][_0x17fc80(0x287)]+'</td>'+_0x17fc80(0x2b1)+_0x43ec3b+_0x33ac8b[_0x4b3cad][_0x17fc80(0x256)]+_0x17fc80(0x21d)+_0x17fc80(0x2e7);}_0x50f66a[_0x17fc80(0x251)](_0x17fc80(0x1d3),'Transfer\x20Finalize\x20Successfully'),_0x1f6aea['redirect']('/picking_list/pdf_puchases_fin_own_trf/'+_0x323376['_id']);}catch(_0x3f692f){console[_0x17fc80(0x2aa)](_0x3f692f),_0x1f6aea['status'](0x1f4)[_0x17fc80(0x2b0)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x3f285d=>{var _0x56ed36=_0x1754f6;console[_0x56ed36(0x2aa)](_0x3f285d),_0x1f6aea[_0x56ed36(0x1fd)](0x1f4)[_0x56ed36(0x2b0)]({'error':_0x56ed36(0x2bc)});});}catch(_0x1d5cfd){}}),router[a0_0x41fc1a(0x261)]('/getTRF',auth,async(_0x4e75a3,_0x363b10)=>{var _0x4c3500=a0_0x41fc1a;try{const {warehouse:_0x157289}=_0x4e75a3[_0x4c3500(0x2a5)],_0x5ea2c9=await transfers_finished[_0x4c3500(0x205)]({'to_warehouse':_0x157289,'to_recieved':_0x4c3500(0x2cf)});_0x363b10[_0x4c3500(0x2b0)](_0x5ea2c9);}catch(_0x7a763e){}}),router['post'](a0_0x41fc1a(0x25b),auth,async(_0x3c49ef,_0x22ab00)=>{var _0x1f4d1e=a0_0x41fc1a;try{const {invoice:_0x2a9483}=_0x3c49ef[_0x1f4d1e(0x2a5)],_0xc2fbaf=await transfers_finished[_0x1f4d1e(0x205)]({'_id':_0x2a9483,'to_recieved':_0x1f4d1e(0x2cf)});_0x22ab00['json'](_0xc2fbaf);}catch(_0x8b7037){}}),router['get'](a0_0x41fc1a(0x1e0),auth,async(_0x44a5a2,_0x4531c3)=>{var _0x4f0dda=a0_0x41fc1a;try{const {username:_0x56226d,email:_0x8b72b2,role:_0x3d0596}=_0x44a5a2['user'],_0xffcab8=_0x44a5a2['user'],_0x1adc0b=await profile[_0x4f0dda(0x2cb)]({'email':_0xffcab8[_0x4f0dda(0x285)]}),_0x5c4e44=await staff[_0x4f0dda(0x2cb)]({'email':_0xffcab8[_0x4f0dda(0x285)]});if(_0xffcab8[_0x4f0dda(0x2a6)]==_0x4f0dda(0x259)){const _0x38a38c=await staff[_0x4f0dda(0x2cb)]({'email':_0xffcab8[_0x4f0dda(0x285)]});}const _0xc3647c=await master_shop[_0x4f0dda(0x205)]();let _0x2d84c7;if(_0xffcab8[_0x4f0dda(0x2a6)]==_0x4f0dda(0x259)){const _0x30d44c=await staff[_0x4f0dda(0x2cb)]({'email':_0xffcab8[_0x4f0dda(0x285)]});_0x2d84c7=await purchases_finished[_0x4f0dda(0x29c)]([{'$match':{'warehouse_name':_0x30d44c['warehouse'],'typeOfProducts':'own'}},{'$lookup':{'from':_0x4f0dda(0x254),'localField':'suppliers','foreignField':_0x4f0dda(0x2dc),'as':_0x4f0dda(0x27c)}},{'$unwind':_0x4f0dda(0x286)},{'$unwind':'$product'},{'$group':{'_id':_0x4f0dda(0x2b3),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4f0dda(0x28b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4f0dda(0x206)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x4f0dda(0x269)},'paid_amount':{'$first':_0x4f0dda(0x1dd)},'due_amount':{'$first':_0x4f0dda(0x266)},'return_data':{'$first':_0x4f0dda(0x223)},'batch_code':{'$first':_0x4f0dda(0x2d7)},'expiry_date':{'$first':_0x4f0dda(0x235)},'suppliers_docs':{'$first':_0x4f0dda(0x286)},'total_product_quantity':{'$sum':_0x4f0dda(0x215)},'level':{'$addToSet':_0x4f0dda(0x23d)},'isle':{'$addToSet':_0x4f0dda(0x2ab)},'type':{'$addToSet':_0x4f0dda(0x2e9)},'floorlevel':{'$addToSet':_0x4f0dda(0x1d9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2d84c7=await purchases_finished[_0x4f0dda(0x29c)]([{'$match':{'typeOfProducts':_0x4f0dda(0x2e2)}},{'$unwind':_0x4f0dda(0x208)},{'$group':{'_id':_0x4f0dda(0x2b3),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4f0dda(0x28b)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x4f0dda(0x269)},'paid_amount':{'$first':_0x4f0dda(0x1dd)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4f0dda(0x223)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x4f0dda(0x235)},'suppliers_docs':{'$first':_0x4f0dda(0x286)},'total_product_quantity':{'$sum':_0x4f0dda(0x215)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x4f0dda(0x2ab)},'type':{'$addToSet':_0x4f0dda(0x2e9)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xc3647c[0x0][_0x4f0dda(0x2ad)]==_0x4f0dda(0x2ba))var _0xcb3f=users[_0x4f0dda(0x1cb)];else{if(_0xc3647c[0x0][_0x4f0dda(0x2ad)]==_0x4f0dda(0x2c0))var _0xcb3f=users[_0x4f0dda(0x2c0)];else{if(_0xc3647c[0x0]['language']=='German')var _0xcb3f=users[_0x4f0dda(0x2f1)];else{if(_0xc3647c[0x0]['language']=='Spanish')var _0xcb3f=users['Spanish'];else{if(_0xc3647c[0x0]['language']==_0x4f0dda(0x2a3))var _0xcb3f=users[_0x4f0dda(0x2a3)];else{if(_0xc3647c[0x0][_0x4f0dda(0x2ad)]==_0x4f0dda(0x1fa))var _0xcb3f=users[_0x4f0dda(0x2d8)];else{if(_0xc3647c[0x0]['language']==_0x4f0dda(0x218))var _0xcb3f=users[_0x4f0dda(0x218)];else{if(_0xc3647c[0x0][_0x4f0dda(0x2ad)]=='Arabic\x20(ae)')var _0xcb3f=users['Arabic'];}}}}}}}_0x4531c3['render'](_0x4f0dda(0x1fb),{'success':_0x44a5a2[_0x4f0dda(0x251)]('success'),'errors':_0x44a5a2[_0x4f0dda(0x251)](_0x4f0dda(0x2f0)),'purchases':_0x2d84c7,'role':_0xffcab8,'profile':_0x1adc0b,'master_shop':_0xc3647c,'language':_0xcb3f});}catch(_0x91e569){console['log'](_0x4f0dda(0x2b8),_0x91e569),_0x4531c3['status'](0xc8)[_0x4f0dda(0x2b0)]({'message':_0x91e569['message']});}}),router['get'](a0_0x41fc1a(0x1c5),auth,async(_0x56de23,_0x594b20)=>{var _0x241b0e=a0_0x41fc1a;try{const {username:_0x5594c3,email:_0x2c5be7,role:_0x1159ef}=_0x56de23[_0x241b0e(0x24f)],_0x27e897=_0x56de23[_0x241b0e(0x24f)],_0x7e80f7=await profile[_0x241b0e(0x2cb)]({'email':_0x27e897[_0x241b0e(0x285)]}),_0x368740=await staff['findOne']({'email':_0x27e897[_0x241b0e(0x285)]});if(_0x27e897[_0x241b0e(0x2a6)]==_0x241b0e(0x259)){const _0x4f02f4=await staff[_0x241b0e(0x2cb)]({'email':_0x27e897['email']});}const _0x2925f3=await master_shop['find']();let _0x587f72;if(_0x27e897[_0x241b0e(0x2a6)]==_0x241b0e(0x259)){const _0xa2e2b0=await staff[_0x241b0e(0x2cb)]({'email':_0x27e897['email']});_0x587f72=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0xa2e2b0['warehouse']}},{'$lookup':{'from':_0x241b0e(0x254),'localField':_0x241b0e(0x254),'foreignField':'name','as':_0x241b0e(0x27c)}},{'$unwind':_0x241b0e(0x286)},{'$unwind':_0x241b0e(0x208)},{'$group':{'_id':_0x241b0e(0x2b3),'invoice':{'$first':_0x241b0e(0x20c)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x241b0e(0x206)},'room':{'$first':_0x241b0e(0x274)},'product':{'$push':_0x241b0e(0x208)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x241b0e(0x223)},'batch_code':{'$first':_0x241b0e(0x2d7)},'expiry_date':{'$first':_0x241b0e(0x235)},'suppliers_docs':{'$first':_0x241b0e(0x286)},'total_product_quantity':{'$sum':_0x241b0e(0x215)},'level':{'$addToSet':_0x241b0e(0x23d)},'isle':{'$addToSet':_0x241b0e(0x2ab)},'type':{'$addToSet':_0x241b0e(0x2e9)},'floorlevel':{'$addToSet':_0x241b0e(0x1d9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x587f72=await purchases_finished[_0x241b0e(0x29c)]([{'$match':{'typeOfProducts':'logs'}},{'$unwind':'$product'},{'$group':{'_id':_0x241b0e(0x2b3),'invoice':{'$first':_0x241b0e(0x20c)},'suppliers':{'$first':_0x241b0e(0x28b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x241b0e(0x206)},'room':{'$addToSet':_0x241b0e(0x296)},'product':{'$push':_0x241b0e(0x208)},'note':{'$first':_0x241b0e(0x269)},'paid_amount':{'$first':_0x241b0e(0x1dd)},'due_amount':{'$first':_0x241b0e(0x266)},'return_data':{'$first':_0x241b0e(0x223)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x241b0e(0x235)},'suppliers_docs':{'$first':_0x241b0e(0x286)},'total_product_quantity':{'$sum':_0x241b0e(0x215)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x241b0e(0x2ab)},'type':{'$addToSet':_0x241b0e(0x2e9)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2925f3[0x0][_0x241b0e(0x2ad)]==_0x241b0e(0x2ba))var _0x14b815=users[_0x241b0e(0x1cb)];else{if(_0x2925f3[0x0][_0x241b0e(0x2ad)]==_0x241b0e(0x2c0))var _0x14b815=users[_0x241b0e(0x2c0)];else{if(_0x2925f3[0x0][_0x241b0e(0x2ad)]=='German')var _0x14b815=users[_0x241b0e(0x2f1)];else{if(_0x2925f3[0x0][_0x241b0e(0x2ad)]==_0x241b0e(0x283))var _0x14b815=users[_0x241b0e(0x283)];else{if(_0x2925f3[0x0]['language']==_0x241b0e(0x2a3))var _0x14b815=users[_0x241b0e(0x2a3)];else{if(_0x2925f3[0x0][_0x241b0e(0x2ad)]==_0x241b0e(0x1fa))var _0x14b815=users[_0x241b0e(0x2d8)];else{if(_0x2925f3[0x0][_0x241b0e(0x2ad)]==_0x241b0e(0x218))var _0x14b815=users['Chinese'];else{if(_0x2925f3[0x0]['language']=='Arabic\x20(ae)')var _0x14b815=users[_0x241b0e(0x234)];}}}}}}}_0x594b20[_0x241b0e(0x264)](_0x241b0e(0x2c5),{'success':_0x56de23[_0x241b0e(0x251)](_0x241b0e(0x1d3)),'errors':_0x56de23[_0x241b0e(0x251)](_0x241b0e(0x2f0)),'purchases':_0x587f72,'role':_0x27e897,'profile':_0x7e80f7,'master_shop':_0x2925f3,'language':_0x14b815});}catch(_0x4896f4){console[_0x241b0e(0x295)](_0x241b0e(0x2b8),_0x4896f4),_0x594b20['status'](0xc8)[_0x241b0e(0x2b0)]({'message':_0x4896f4[_0x241b0e(0x2d5)]});}});function BayBinSelected(_0x4cc90e,_0x3aaa21){var _0x413794=a0_0x41fc1a,_0x5ee4d3=[],_0x4b4859=[];if(_0x4cc90e==_0x413794(0x232)){switch(_0x3aaa21){case _0x413794(0x238):_0x5ee4d3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x413794(0x26f):_0x5ee4d3=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4b4859=['DG'];}else{if(_0x4cc90e==_0x413794(0x26d)){switch(_0x3aaa21){case _0x413794(0x238):_0x5ee4d3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x413794(0x26f):_0x5ee4d3=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4b4859=['FG'];}}return{'levels':_0x5ee4d3,'identify':_0x4b4859};}async function getRandom8DigitNumber(){var _0x589800=a0_0x41fc1a;const _0x2c7f94=0x989680,_0x17b38f=0x5f5e0ff,_0x1855c5=Math[_0x589800(0x248)](Math[_0x589800(0x278)]()*(_0x17b38f-_0x2c7f94+0x1))+_0x2c7f94;var _0x2aac11;const _0x3e3776=await purchases_finished['findOne']({'invoice':_0x589800(0x275)+_0x1855c5});return _0x3e3776&&_0x3e3776[_0x589800(0x2a2)]>0x0?_0x2aac11=_0x589800(0x275)+_0x1855c5:_0x2aac11='INCF-'+_0x1855c5,_0x2aac11;}router['get']('/view/add_purchases',auth,async(_0x5f3ea4,_0x523bbc)=>{var _0x34ad59=a0_0x41fc1a;try{const {username:_0x1eb6f8,email:_0x42218d,role:_0x324377}=_0x5f3ea4['user'],_0x5e579b=_0x5f3ea4[_0x34ad59(0x24f)],_0x55db00=await profile[_0x34ad59(0x2cb)]({'email':_0x5e579b[_0x34ad59(0x285)]}),_0x18a5ea=await master_shop[_0x34ad59(0x205)](),_0x22a34e=await staff['findOne']({'email':_0x5e579b[_0x34ad59(0x285)]}),_0x59c0d6=await suppliers[_0x34ad59(0x205)]({});let _0x1c1efb;if(_0x5e579b[_0x34ad59(0x2a6)]==_0x34ad59(0x259)){const _0x5d1951=await staff['findOne']({'email':_0x5e579b[_0x34ad59(0x285)]});_0x1c1efb=await warehouse['aggregate']([{'$match':{'status':_0x34ad59(0x276),'name':_0x5d1951['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1c1efb=await warehouse[_0x34ad59(0x29c)]([{'$match':{'status':_0x34ad59(0x276)}},{'$group':{'_id':_0x34ad59(0x1df),'name':{'$first':_0x34ad59(0x1df)}}}]);const _0x24575d=await product['find']({}),_0xa233a9=await warehouse[_0x34ad59(0x205)]({'status':'Enabled'}),_0x2c11f6=await purchases_finished['find']({}),_0x42def2=_0x2c11f6[_0x34ad59(0x2a2)]+0x1,_0x56a4b0=_0x34ad59(0x275)+_0x42def2[_0x34ad59(0x20e)]()['padStart'](0x5,'0');var _0x43ede7=[_0x34ad59(0x2e8),'Enclosed'];if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]==_0x34ad59(0x2ba))var _0x285029=users['English'];else{if(_0x18a5ea[0x0]['language']==_0x34ad59(0x2c0))var _0x285029=users[_0x34ad59(0x2c0)];else{if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]==_0x34ad59(0x2f1))var _0x285029=users[_0x34ad59(0x2f1)];else{if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]=='Spanish')var _0x285029=users[_0x34ad59(0x283)];else{if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]==_0x34ad59(0x2a3))var _0x285029=users['French'];else{if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]=='Portuguese\x20(BR)')var _0x285029=users[_0x34ad59(0x2d8)];else{if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]==_0x34ad59(0x218))var _0x285029=users[_0x34ad59(0x218)];else{if(_0x18a5ea[0x0][_0x34ad59(0x2ad)]=='Arabic\x20(ae)')var _0x285029=users[_0x34ad59(0x234)];}}}}}}}const _0x2701c5=getRandom8DigitNumber(),_0x25ac35=new Date(),_0x2d7401={'year':_0x34ad59(0x25c),'month':_0x34ad59(0x2ae),'day':_0x34ad59(0x2ae),'timeZone':_0x34ad59(0x2b2)},_0x51ce08=_0x25ac35['toLocaleDateString'](_0x34ad59(0x2d0),_0x2d7401);console[_0x34ad59(0x295)](_0x51ce08),_0x2701c5[_0x34ad59(0x23c)](_0x24d231=>{var _0x1b0efd=_0x34ad59;_0x523bbc[_0x1b0efd(0x264)](_0x1b0efd(0x2df),{'success':_0x5f3ea4[_0x1b0efd(0x251)](_0x1b0efd(0x1d3)),'errors':_0x5f3ea4[_0x1b0efd(0x251)](_0x1b0efd(0x2f0)),'role':_0x5e579b,'profile':_0x55db00,'suppliers':_0x59c0d6,'warehouse':_0x1c1efb,'product':_0x24575d,'invoice':_0x24d231,'master_shop':_0x18a5ea,'language':_0x285029,'find_data':_0xa233a9,'rooms_data':_0x43ede7,'formattedDate':_0x51ce08});})['catch'](_0x3895c1=>{var _0xdbfadc=_0x34ad59;_0x5f3ea4[_0xdbfadc(0x251)](_0xdbfadc(0x2f0),_0xdbfadc(0x253)),_0x523bbc[_0xdbfadc(0x1d6)](_0xdbfadc(0x260));});}catch(_0x23b486){console[_0x34ad59(0x295)](_0x23b486);}}),router[a0_0x41fc1a(0x29e)]('/view/add_purchases_logs',auth,async(_0x3d9737,_0x1c8a92)=>{var _0x1999f6=a0_0x41fc1a;try{const {username:_0x37ca44,email:_0x25a7c4,role:_0x156459}=_0x3d9737['user'],_0x144d0b=_0x3d9737[_0x1999f6(0x24f)],_0x4f3338=await profile[_0x1999f6(0x2cb)]({'email':_0x144d0b[_0x1999f6(0x285)]}),_0x1405b9=await master_shop[_0x1999f6(0x205)](),_0x5b03dd=await staff[_0x1999f6(0x2cb)]({'email':_0x144d0b[_0x1999f6(0x285)]}),_0x1508a7=await suppliers['find']({});let _0x4dc5d1;if(_0x144d0b['role']==_0x1999f6(0x259)){const _0x3aa84b=await staff[_0x1999f6(0x2cb)]({'email':_0x144d0b[_0x1999f6(0x285)]});_0x4dc5d1=await warehouse[_0x1999f6(0x29c)]([{'$match':{'status':_0x1999f6(0x276),'name':_0x3aa84b[_0x1999f6(0x290)]}},{'$group':{'_id':_0x1999f6(0x1df),'name':{'$first':_0x1999f6(0x1df)}}}]);}else _0x4dc5d1=await warehouse[_0x1999f6(0x29c)]([{'$match':{'status':_0x1999f6(0x276)}},{'$group':{'_id':_0x1999f6(0x1df),'name':{'$first':'$name'}}}]);const _0x392236=await product[_0x1999f6(0x205)]({}),_0x1c7a4f=await warehouse[_0x1999f6(0x205)]({'status':_0x1999f6(0x276)}),_0x126bdd=await purchases_finished[_0x1999f6(0x205)]({}),_0x195356=_0x126bdd[_0x1999f6(0x2a2)]+0x1,_0x3f49f1='INCF-'+_0x195356[_0x1999f6(0x20e)]()[_0x1999f6(0x2bf)](0x5,'0');var _0x17d338=['Ambient',_0x1999f6(0x1d7)];if(_0x1405b9[0x0][_0x1999f6(0x2ad)]==_0x1999f6(0x2ba))var _0x47a2b0=users[_0x1999f6(0x1cb)];else{if(_0x1405b9[0x0]['language']==_0x1999f6(0x2c0))var _0x47a2b0=users[_0x1999f6(0x2c0)];else{if(_0x1405b9[0x0][_0x1999f6(0x2ad)]==_0x1999f6(0x2f1))var _0x47a2b0=users[_0x1999f6(0x2f1)];else{if(_0x1405b9[0x0]['language']==_0x1999f6(0x283))var _0x47a2b0=users[_0x1999f6(0x283)];else{if(_0x1405b9[0x0]['language']=='French')var _0x47a2b0=users[_0x1999f6(0x2a3)];else{if(_0x1405b9[0x0][_0x1999f6(0x2ad)]==_0x1999f6(0x1fa))var _0x47a2b0=users[_0x1999f6(0x2d8)];else{if(_0x1405b9[0x0]['language']==_0x1999f6(0x218))var _0x47a2b0=users[_0x1999f6(0x218)];else{if(_0x1405b9[0x0][_0x1999f6(0x2ad)]==_0x1999f6(0x2f3))var _0x47a2b0=users[_0x1999f6(0x234)];}}}}}}}const _0x12a245=getRandom8DigitNumber();_0x12a245[_0x1999f6(0x23c)](_0x5c0788=>{var _0x55b0c1=_0x1999f6;_0x1c8a92['render'](_0x55b0c1(0x2ce),{'success':_0x3d9737[_0x55b0c1(0x251)](_0x55b0c1(0x1d3)),'errors':_0x3d9737[_0x55b0c1(0x251)](_0x55b0c1(0x2f0)),'role':_0x144d0b,'profile':_0x4f3338,'suppliers':_0x1508a7,'warehouse':_0x4dc5d1,'product':_0x392236,'invoice':_0x5c0788,'master_shop':_0x1405b9,'language':_0x47a2b0,'find_data':_0x1c7a4f,'rooms_data':_0x17d338});})['catch'](_0x5afdd9=>{var _0x39f859=_0x1999f6;_0x3d9737[_0x39f859(0x251)](_0x39f859(0x2f0),_0x39f859(0x253)),_0x1c8a92[_0x39f859(0x1d6)](_0x39f859(0x260));});}catch(_0x496e18){console['log'](_0x496e18);}}),router[a0_0x41fc1a(0x29e)](a0_0x41fc1a(0x225),auth,async(_0x184db0,_0x11e0e4)=>{var _0x99e790=a0_0x41fc1a;try{const _0x48e9e8=_0x184db0[_0x99e790(0x1db)]['id'];console['log'](_0x48e9e8);const _0x5d7e34=await master_shop[_0x99e790(0x205)]();console[_0x99e790(0x295)](_0x99e790(0x22f),_0x5d7e34);const _0x120dde=await product[_0x99e790(0x2cb)]({'name':_0x48e9e8});console[_0x99e790(0x295)](_0x99e790(0x2de),_0x120dde),_0x11e0e4[_0x99e790(0x1fd)](0xc8)['json']({'product_data':_0x120dde,'master':_0x5d7e34});}catch(_0x19b8d9){console[_0x99e790(0x295)](_0x99e790(0x2a0),_0x19b8d9);}}),router[a0_0x41fc1a(0x261)](a0_0x41fc1a(0x282),auth,async(_0x1a74b0,_0x10b7c7)=>{var _0x25eb0a=a0_0x41fc1a;try{const {invoice:_0x1965bd,date:_0x464a9a,warehouse_name:_0x584203,prod_name:_0x2dbc09,note:_0x4f7bd8,due_amount:_0x7bae21,Room_name:_0x4762ee,PO_number:_0x1f5a7c,SCRN:_0x1d6153,ReqBy:_0x3d550e,dateofreq:_0x422b3f,suppliers:_0x4e53ba,typeservicesData:_0x325ed1,van:_0x1b4e0f,typevehicle:_0x41670e,driver:_0x4ff650,plate:_0x9bde22,DRSI:_0x571ed8,TSU:_0x176d49,TFU:_0x1c29a5,JO_number:_0x37aace,type_of_products:_0x4f139d}=_0x1a74b0['body'];if(typeof _0x2dbc09==_0x25eb0a(0x1d1))var _0x5e91ff=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x226)]],_0x30e6a9=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x2c9)]],_0x5463fc=[_0x1a74b0['body'][_0x25eb0a(0x1be)]],_0x329d52=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x27a)]],_0x4a6314=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x244)]],_0x5a2dd2=[_0x1a74b0[_0x25eb0a(0x2a5)]['prod_level']],_0x273627=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x233)]],_0xcb67cc=[_0x1a74b0['body'][_0x25eb0a(0x1e1)]],_0x2f2d92=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x2ef)]],_0x2872b8=[_0x1a74b0[_0x25eb0a(0x2a5)]['batch_code']],_0x5d39c5=[_0x1a74b0['body'][_0x25eb0a(0x1c7)]],_0x2ac159=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x1dc)]],_0x41d59e=[_0x1a74b0['body'][_0x25eb0a(0x2e5)]],_0x3dd993=[_0x1a74b0['body'][_0x25eb0a(0x1b5)]],_0xdcdd93=[_0x1a74b0[_0x25eb0a(0x2a5)]['RoomAssign']],_0x5dd50c=[_0x1a74b0['body']['gross_price']],_0x57c30c=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x2c3)]],_0x483ac6=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x270)]],_0x126f6c=[_0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x249)]];else var _0x5e91ff=[..._0x1a74b0[_0x25eb0a(0x2a5)]['prod_name']],_0x30e6a9=[..._0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x2c9)]],_0x5463fc=[..._0x1a74b0[_0x25eb0a(0x2a5)]['prod_Qty']],_0x329d52=[..._0x1a74b0['body'][_0x25eb0a(0x27a)]],_0x4a6314=[..._0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x244)]],_0x5a2dd2=[..._0x1a74b0['body'][_0x25eb0a(0x1c9)]],_0x273627=[..._0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x233)]],_0xcb67cc=[..._0x1a74b0['body'][_0x25eb0a(0x1e1)]],_0x2f2d92=[..._0x1a74b0[_0x25eb0a(0x2a5)]['MaxStocks_data']],_0x2872b8=[..._0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x2f2)]],_0x5d39c5=[..._0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x1c7)]],_0x2ac159=[..._0x1a74b0[_0x25eb0a(0x2a5)]['product_date']],_0x41d59e=[..._0x1a74b0['body']['max_product_unit']],_0x3dd993=[..._0x1a74b0['body']['prod_cat']],_0xdcdd93=[..._0x1a74b0['body'][_0x25eb0a(0x1bc)]],_0x5dd50c=[..._0x1a74b0[_0x25eb0a(0x2a5)][_0x25eb0a(0x2a4)]],_0x57c30c=[..._0x1a74b0['body'][_0x25eb0a(0x2c3)]],_0x483ac6=[..._0x1a74b0['body'][_0x25eb0a(0x270)]],_0x126f6c=[..._0x1a74b0['body'][_0x25eb0a(0x249)]];const _0x90137d=_0x5e91ff[_0x25eb0a(0x1da)](_0xc589c6=>{return _0xc589c6={'product_name':_0xc589c6};});_0x126f6c[_0x25eb0a(0x258)]((_0x36f0e3,_0x1abc23)=>{var _0x38da07=_0x25eb0a;_0x90137d[_0x1abc23][_0x38da07(0x249)]=_0x36f0e3,_0x90137d[_0x1abc23]['date_recieved']=_0x464a9a;}),_0x483ac6[_0x25eb0a(0x258)]((_0x13a67e,_0x1e204a)=>{_0x90137d[_0x1e204a]['sales_category']=_0x13a67e;}),_0x30e6a9[_0x25eb0a(0x258)]((_0x302e34,_0x1cd75a)=>{_0x90137d[_0x1cd75a]['product_code']=_0x302e34;}),_0x57c30c[_0x25eb0a(0x258)]((_0x1cc511,_0x455b57)=>{_0x90137d[_0x455b57]['uuid']=_0x1cc511;}),_0x5463fc[_0x25eb0a(0x258)]((_0x65214d,_0xdaa3a9)=>{var _0x1764b2=_0x25eb0a;_0x90137d[_0xdaa3a9][_0x1764b2(0x1c8)]=Math[_0x1764b2(0x2db)](_0x65214d);}),_0x329d52[_0x25eb0a(0x258)]((_0x2c3fd7,_0x2d20d7)=>{var _0x43b61d=_0x25eb0a;_0x90137d[_0x2d20d7][_0x43b61d(0x2af)]=_0x2c3fd7;}),_0x4a6314[_0x25eb0a(0x258)]((_0x16b31d,_0x185d03)=>{_0x90137d[_0x185d03]['secondary_unit']=_0x16b31d;}),_0x273627['forEach']((_0x12b094,_0xe91a13)=>{_0x90137d[_0xe91a13]['primary_code']=_0x12b094;}),_0xcb67cc[_0x25eb0a(0x258)]((_0x1bfc9d,_0x105244)=>{_0x90137d[_0x105244]['secondary_code']=_0x1bfc9d;}),_0x2f2d92[_0x25eb0a(0x258)]((_0x2b7274,_0x4141c5)=>{var _0x302dd9=_0x25eb0a;_0x90137d[_0x4141c5][_0x302dd9(0x2d9)]=_0x2b7274;}),_0x2872b8[_0x25eb0a(0x258)]((_0x12779d,_0x21d1c8)=>{var _0x198355=_0x25eb0a;_0x90137d[_0x21d1c8][_0x198355(0x2f2)]=_0x12779d;}),_0x5d39c5[_0x25eb0a(0x258)]((_0xc4b505,_0x3c7afa)=>{var _0xd1f42b=_0x25eb0a;_0x90137d[_0x3c7afa][_0xd1f42b(0x1c7)]=_0xc4b505;}),_0x2ac159[_0x25eb0a(0x258)]((_0x3ec66e,_0x15a767)=>{var _0xb6c1d4=_0x25eb0a;_0x90137d[_0x15a767][_0xb6c1d4(0x2b4)]=_0x3ec66e;}),_0x41d59e[_0x25eb0a(0x258)]((_0x42d4d9,_0x179e9f)=>{var _0x26db29=_0x25eb0a;_0x90137d[_0x179e9f][_0x26db29(0x237)]=_0x42d4d9;}),_0x3dd993[_0x25eb0a(0x258)]((_0x425d68,_0x3c0475)=>{var _0x1c1b08=_0x25eb0a;_0x90137d[_0x3c0475][_0x1c1b08(0x2ac)]=_0x425d68;}),_0xdcdd93[_0x25eb0a(0x258)]((_0x57ffaa,_0x2e3cd4)=>{var _0x5a382c=_0x25eb0a;_0x90137d[_0x2e3cd4][_0x5a382c(0x1f5)]=_0x57ffaa;}),_0x5dd50c[_0x25eb0a(0x258)]((_0x3be401,_0x36affc)=>{_0x90137d[_0x36affc]['gross_price']=_0x3be401;});const _0x2a5a41=new invoice_for_incoming();await _0x2a5a41[_0x25eb0a(0x224)]();for(let _0x5df0a2=0x0;_0x5df0a2<=_0xdcdd93['length']-0x1;_0x5df0a2++){_0x90137d[_0x5df0a2][_0x25eb0a(0x219)]=_0x25eb0a(0x1b7)+_0x2a5a41['invoice_init'][_0x25eb0a(0x20e)]()[_0x25eb0a(0x2bf)](0x8,'0');}const _0x544d76=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x584203}}]);let _0x252b8b=[];for(let _0x2d9e0c=0x0;_0x2d9e0c<=_0x90137d[_0x25eb0a(0x2a2)]-0x1;_0x2d9e0c++){const _0x39ebaa=_0x90137d[_0x2d9e0c];for(let _0x280eb0=0x0;_0x280eb0<=_0x544d76[_0x25eb0a(0x2a2)]-0x1;_0x280eb0++){const _0x2147a3=_0x544d76[_0x280eb0];for(let _0x3a3a7c=0x0;_0x3a3a7c<=_0x2147a3[_0x25eb0a(0x2ec)]['length']-0x1;_0x3a3a7c++){const _0x2aec3c=_0x2147a3['product_data'][_0x3a3a7c];if(_0x2aec3c[_0x25eb0a(0x1c1)]===_0x39ebaa['product_code']){let _0x2315f1=_0x39ebaa[_0x25eb0a(0x1c8)];const _0x5f14da=await warehouse['aggregate']([{'$match':{'name':_0x584203,'room':_0x2147a3['room']}},{'$unwind':_0x25eb0a(0x2a9)},{'$match':{'level':_0x2aec3c[_0x25eb0a(0x2ee)],'bay':_0x2aec3c['bin']}}]);if(_0x5f14da[_0x25eb0a(0x2a2)]==0x0){for(let _0x113660=0x0;_0x113660<=_0x2147a3[_0x25eb0a(0x2ec)][_0x25eb0a(0x2a2)]-0x1&&_0x2315f1>0x0;_0x113660++){const _0x5bbbce=_0x2147a3['product_data'][_0x113660];if(_0x39ebaa[_0x25eb0a(0x1c1)]===_0x5bbbce[_0x25eb0a(0x1c1)]){_0x252b8b[_0x113660]={};const _0x4c7b23=parseInt(_0x5bbbce[_0x25eb0a(0x20f)]),_0x5de885=0x0;let _0x42fdec=_0x4c7b23-_0x5de885,_0x4ae2f9=Math[_0x25eb0a(0x272)](_0x2315f1,_0x42fdec);console[_0x25eb0a(0x295)](_0x25eb0a(0x1e5)+_0x4ae2f9+'\x20units\x20to\x20warehouse:\x20'+_0x2147a3[_0x25eb0a(0x298)]+_0x25eb0a(0x29f)+_0x2147a3['room']+_0x25eb0a(0x26c)+_0x5bbbce[_0x25eb0a(0x2ee)]+_0x25eb0a(0x268)+_0x5bbbce[_0x25eb0a(0x20b)]),_0x252b8b[_0x113660]['product_name']=_0x39ebaa[_0x25eb0a(0x213)],_0x252b8b[_0x113660][_0x25eb0a(0x1c1)]=_0x39ebaa[_0x25eb0a(0x1c1)],_0x252b8b[_0x113660]['product_id']=_0x39ebaa[_0x25eb0a(0x249)],_0x252b8b[_0x113660][_0x25eb0a(0x22e)]=_0x39ebaa['date_recieved'],_0x252b8b[_0x113660]['sales_category']=_0x39ebaa['sales_category'],_0x252b8b[_0x113660][_0x25eb0a(0x2c3)]=_0x39ebaa[_0x25eb0a(0x2c3)],_0x252b8b[_0x113660][_0x25eb0a(0x1c8)]=_0x4ae2f9,_0x252b8b[_0x113660][_0x25eb0a(0x2af)]=_0x39ebaa['standard_unit'],_0x252b8b[_0x113660][_0x25eb0a(0x20a)]=_0x39ebaa[_0x25eb0a(0x20a)],_0x252b8b[_0x113660]['primary_code']=_0x39ebaa[_0x25eb0a(0x233)],_0x252b8b[_0x113660][_0x25eb0a(0x1e1)]=_0x39ebaa[_0x25eb0a(0x1e1)],_0x252b8b[_0x113660]['maxStocks']=_0x39ebaa[_0x25eb0a(0x2d9)],_0x252b8b[_0x113660]['batch_code']=_0x39ebaa['batch_code'],_0x252b8b[_0x113660][_0x25eb0a(0x1c7)]=_0x39ebaa[_0x25eb0a(0x1c7)],_0x252b8b[_0x113660][_0x25eb0a(0x2b4)]=_0x39ebaa[_0x25eb0a(0x2b4)],_0x252b8b[_0x113660][_0x25eb0a(0x237)]=_0x39ebaa[_0x25eb0a(0x237)],_0x252b8b[_0x113660][_0x25eb0a(0x2ac)]=_0x39ebaa[_0x25eb0a(0x2ac)],_0x252b8b[_0x113660][_0x25eb0a(0x219)]=_0x39ebaa[_0x25eb0a(0x219)],_0x252b8b[_0x113660][_0x25eb0a(0x2a4)]=_0x39ebaa[_0x25eb0a(0x2a4)],_0x252b8b[_0x113660][_0x25eb0a(0x1f5)]=_0x2147a3[_0x25eb0a(0x21f)],_0x252b8b[_0x113660][_0x25eb0a(0x1d0)]=_0x5bbbce[_0x25eb0a(0x2ee)],_0x252b8b[_0x113660][_0x25eb0a(0x2ee)]=_0x5bbbce[_0x25eb0a(0x20b)],_0x2315f1-=_0x4ae2f9;if(_0x2315f1<=0x0)break;}}if(_0x2315f1<=0x0)break;_0x2315f1>0x0&&console[_0x25eb0a(0x295)]('There\x20is\x20'+_0x2315f1+_0x25eb0a(0x1eb));}}}}}console[_0x25eb0a(0x295)](_0x252b8b);const _0x47abfc=_0x252b8b[_0x25eb0a(0x217)](_0x54e067=>_0x54e067[_0x25eb0a(0x1c8)]!=='0'&&_0x54e067[_0x25eb0a(0x1c8)]!==''),_0x2a996b=new purchases_finished({'invoice':_0x25eb0a(0x1b7)+_0x2a5a41['invoice_init'][_0x25eb0a(0x20e)]()[_0x25eb0a(0x2bf)](0x8,'0'),'suppliers':_0x4e53ba,'date':_0x464a9a,'warehouse_name':_0x584203,'product':_0x47abfc,'note':_0x4f7bd8,'due_amount':_0x7bae21,'room':_0x4762ee,'POnumber':_0x1f5a7c,'SCRN':_0x1d6153,'JO_number':_0x37aace,'ReqBy':_0x3d550e,'dateofreq':_0x422b3f,'typeservicesData':_0x325ed1,'van':_0x1b4e0f,'typevehicle':_0x41670e,'driver':_0x4ff650,'plate':_0x9bde22,'DRSI':_0x571ed8,'TSU':_0x176d49,'TFU':_0x1c29a5,'typeOfProducts':_0x4f139d}),_0x53536d=await _0x2a996b[_0x25eb0a(0x224)](),_0x34f166=await purchases_finished['findOne']({'_id':_0x53536d[_0x25eb0a(0x1c3)][_0x25eb0a(0x21e)]()});_0x1a74b0['flash'](_0x25eb0a(0x1d3),_0x25eb0a(0x222)),_0x10b7c7[_0x25eb0a(0x1d6)](_0x25eb0a(0x23a)+_0x34f166[_0x25eb0a(0x1c3)]['valueOf']());}catch(_0x5c5789){console[_0x25eb0a(0x295)](_0x5c5789);}}),router[a0_0x41fc1a(0x29e)](a0_0x41fc1a(0x1ff),auth,async(_0x4cab84,_0x500fe5)=>{var _0x65a4b4=a0_0x41fc1a;try{const {username:_0x3cc403,email:_0x1ba601,role:_0x2a300c}=_0x4cab84[_0x65a4b4(0x24f)],_0x159ea9=_0x4cab84[_0x65a4b4(0x24f)],_0x8b95b3=_0x4cab84[_0x65a4b4(0x1db)]['id'],_0x25a972=await profile[_0x65a4b4(0x2cb)]({'email':_0x159ea9['email']}),_0x41fd1e=await master_shop['find'](),_0x64d4e3=await staff[_0x65a4b4(0x2cb)]({'email':_0x159ea9[_0x65a4b4(0x285)]}),_0x2ddcab=await suppliers[_0x65a4b4(0x205)]({});let _0x517705;if(_0x159ea9[_0x65a4b4(0x2a6)]==_0x65a4b4(0x259)){const _0x592405=await staff[_0x65a4b4(0x2cb)]({'email':_0x159ea9[_0x65a4b4(0x285)]});_0x517705=await warehouse[_0x65a4b4(0x29c)]([{'$match':{'status':'Enabled','name':_0x592405['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x517705=await warehouse[_0x65a4b4(0x29c)]([{'$match':{'status':_0x65a4b4(0x276)}},{'$group':{'_id':'$name','name':{'$first':_0x65a4b4(0x1df)}}}]);const _0x29b433=await purchases_finished['findById'](_0x8b95b3);if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]==_0x65a4b4(0x2ba))var _0x40cdc6=users[_0x65a4b4(0x1cb)];else{if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]==_0x65a4b4(0x2c0))var _0x40cdc6=users['Hindi'];else{if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]==_0x65a4b4(0x2f1))var _0x40cdc6=users[_0x65a4b4(0x2f1)];else{if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]==_0x65a4b4(0x283))var _0x40cdc6=users['Spanish'];else{if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]==_0x65a4b4(0x2a3))var _0x40cdc6=users[_0x65a4b4(0x2a3)];else{if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]==_0x65a4b4(0x1fa))var _0x40cdc6=users[_0x65a4b4(0x2d8)];else{if(_0x41fd1e[0x0]['language']=='Chinese')var _0x40cdc6=users[_0x65a4b4(0x218)];else{if(_0x41fd1e[0x0][_0x65a4b4(0x2ad)]=='Arabic\x20(ae)')var _0x40cdc6=users[_0x65a4b4(0x234)];}}}}}}}_0x500fe5[_0x65a4b4(0x264)](_0x65a4b4(0x1b8),{'success':_0x4cab84[_0x65a4b4(0x251)](_0x65a4b4(0x1d3)),'errors':_0x4cab84[_0x65a4b4(0x251)]('errors'),'role':_0x159ea9,'profile':_0x25a972,'suppliers':_0x2ddcab,'warehouse':_0x517705,'master_shop':_0x41fd1e,'language':_0x40cdc6,'purchases_data':_0x29b433});}catch(_0x2f9a45){console[_0x65a4b4(0x295)](_0x2f9a45);}});async function get_warehouse_data(_0xfbee3d,_0x2f26ea){var _0x269c76=a0_0x41fc1a;try{const _0x2e9e55=await warehouse_temporary['findOne']({'name':_0xfbee3d,'room':_0x2f26ea});if(!_0x2e9e55){const _0x4c5d33=new warehouse_temporary({'name':_0xfbee3d,'address':_0xfbee3d,'status':_0x269c76(0x276),'room':_0x2f26ea,'isStaging':_0x269c76(0x2cf)});return await _0x4c5d33[_0x269c76(0x224)](),_0x4c5d33;}else return _0x2e9e55;}catch(_0x3636d3){console[_0x269c76(0x2aa)](_0x269c76(0x201),_0x3636d3);throw _0x3636d3;}}router[a0_0x41fc1a(0x261)]('/process/:id',auth,async(_0x39ab77,_0x373993)=>{var _0x3cefed=a0_0x41fc1a;try{const _0x2902db=_0x39ab77[_0x3cefed(0x1db)]['id'],_0x3cb8b3=await purchases_finished[_0x3cefed(0x294)](_0x2902db);let _0x1e521b=[];_0x3cb8b3['product']['forEach']((_0x11a81d,_0x20bfd8)=>{var _0x125eca=_0x3cefed;_0x1e521b[_0x20bfd8]={},_0x1e521b[_0x20bfd8]['warehouse']=_0x3cb8b3['warehouse_name'],_0x1e521b[_0x20bfd8][_0x125eca(0x249)]=_0x11a81d['product_id'],_0x1e521b[_0x20bfd8][_0x125eca(0x213)]=_0x11a81d['product_name'],_0x1e521b[_0x20bfd8][_0x125eca(0x1c1)]=_0x11a81d[_0x125eca(0x1c1)],_0x1e521b[_0x20bfd8][_0x125eca(0x229)]=_0x11a81d[_0x125eca(0x1c8)],_0x1e521b[_0x20bfd8][_0x125eca(0x2af)]=_0x11a81d[_0x125eca(0x2af)],_0x1e521b[_0x20bfd8][_0x125eca(0x20a)]=_0x11a81d[_0x125eca(0x20a)],_0x1e521b[_0x20bfd8][_0x125eca(0x1d0)]=_0x11a81d[_0x125eca(0x1d0)],_0x1e521b[_0x20bfd8][_0x125eca(0x2ee)]=_0x11a81d[_0x125eca(0x2ee)],_0x1e521b[_0x20bfd8][_0x125eca(0x233)]=_0x11a81d[_0x125eca(0x233)],_0x1e521b[_0x20bfd8]['secondary_code']=_0x11a81d[_0x125eca(0x1e1)],_0x1e521b[_0x20bfd8][_0x125eca(0x2d9)]=_0x11a81d[_0x125eca(0x2d9)],_0x1e521b[_0x20bfd8][_0x125eca(0x2f2)]=_0x11a81d[_0x125eca(0x2f2)],_0x1e521b[_0x20bfd8]['expiry_date']=_0x11a81d['expiry_date'],_0x1e521b[_0x20bfd8][_0x125eca(0x2b4)]=_0x11a81d[_0x125eca(0x2b4)],_0x1e521b[_0x20bfd8]['maxperunit']=_0x11a81d[_0x125eca(0x237)],_0x1e521b[_0x20bfd8]['product_cat']=_0x11a81d[_0x125eca(0x2ac)],_0x1e521b[_0x20bfd8][_0x125eca(0x1f5)]=_0x11a81d[_0x125eca(0x1f5)],_0x1e521b[_0x20bfd8]['invoice']=_0x11a81d[_0x125eca(0x219)],_0x1e521b[_0x20bfd8][_0x125eca(0x2c3)]=_0x11a81d[_0x125eca(0x2c3)],_0x1e521b[_0x20bfd8][_0x125eca(0x2a4)]=_0x11a81d[_0x125eca(0x2a4)],_0x1e521b[_0x20bfd8][_0x125eca(0x2eb)]=_0x11a81d['sales_category'],_0x1e521b[_0x20bfd8][_0x125eca(0x22e)]=_0x11a81d['date_recieved'],_0x1e521b[_0x20bfd8][_0x125eca(0x1b6)]=_0x11a81d['_id']['valueOf'](),_0x1e521b[_0x20bfd8][_0x125eca(0x25f)]=_0x125eca(0x28c);});for(let _0x3f10b4=0x0;_0x3f10b4<=_0x1e521b[_0x3cefed(0x2a2)]-0x1;_0x3f10b4++){const _0x2b7657=_0x1e521b[_0x3f10b4],_0x212d78=new warehouse_temporary(_0x2b7657);await _0x212d78[_0x3cefed(0x224)]();}_0x3cb8b3['isProcess']=_0x3cefed(0x1f4),await _0x3cb8b3[_0x3cefed(0x224)](),_0x39ab77[_0x3cefed(0x251)](_0x3cefed(0x1d3),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x373993['redirect'](_0x3cefed(0x23a)+_0x3cb8b3[_0x3cefed(0x1c3)][_0x3cefed(0x21e)]());}catch(_0x9a1bc8){}}),router['post']('/view/add_purchases_logs',auth,async(_0x5842fc,_0x1420bb)=>{var _0xcf320e=a0_0x41fc1a;try{const {invoice:_0x1490e4,date:_0x36a86b,warehouse_name:_0x39120a,prod_name:_0x3e6367,note:_0x253f5d,due_amount:_0x2fba32,Room_name:_0x10f516,PO_number:_0xdfcd25,SCRN:_0x163db9,ReqBy:_0x9ab711,dateofreq:_0x3ffbcb,suppliers:_0x5c60e0,typeservicesData:_0x5705f6,van:_0x350f25,typevehicle:_0x4c1b81,driver:_0x16ad12,plate:_0x2fb0fd,DRSI:_0x54acb2,TSU:_0x33e7c9,TFU:_0x5c6203,JO_number:_0x34da04,type_of_products:_0x2e0526}=_0x5842fc[_0xcf320e(0x2a5)];if(typeof _0x3e6367=='string')var _0x14eeb3=[_0x5842fc[_0xcf320e(0x2a5)]['prod_name']],_0x3b38f2=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x2c9)]],_0x59c466=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x1be)]],_0x4a29de=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x27a)]],_0xd63d65=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x244)]],_0x48c8c8=[_0x5842fc[_0xcf320e(0x2a5)]['prod_level']],_0x4d6cd1=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x233)]],_0xac89fc=[_0x5842fc[_0xcf320e(0x2a5)]['secondary_code']],_0x115c26=[_0x5842fc['body'][_0xcf320e(0x2ef)]],_0x5e573a=[_0x5842fc[_0xcf320e(0x2a5)]['batch_code']],_0x5dad31=[_0x5842fc['body'][_0xcf320e(0x1c7)]],_0x1aeda8=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x1dc)]],_0x8f924=[_0x5842fc['body'][_0xcf320e(0x2e5)]],_0x3a920a=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x1b5)]],_0x4d3fe1=[_0x5842fc['body']['RoomAssign']],_0x23cb51=[_0x5842fc['body']['gross_price']],_0x577ec8=[_0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x2c3)]],_0x3e1e8e=[_0x5842fc[_0xcf320e(0x2a5)]['sales_data_cateory']],_0x2158be=[_0x5842fc['body'][_0xcf320e(0x28f)]];else var _0x14eeb3=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x226)]],_0x3b38f2=[..._0x5842fc['body']['prod_code']],_0x59c466=[..._0x5842fc[_0xcf320e(0x2a5)]['prod_Qty']],_0x4a29de=[..._0x5842fc[_0xcf320e(0x2a5)]['prod_primunit']],_0xd63d65=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x244)]],_0x48c8c8=[..._0x5842fc['body'][_0xcf320e(0x1c9)]],_0x4d6cd1=[..._0x5842fc[_0xcf320e(0x2a5)]['primary_code']],_0xac89fc=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x1e1)]],_0x115c26=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x2ef)]],_0x5e573a=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x2f2)]],_0x5dad31=[..._0x5842fc[_0xcf320e(0x2a5)]['expiry_date']],_0x1aeda8=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x1dc)]],_0x8f924=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x2e5)]],_0x3a920a=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x1b5)]],_0x4d3fe1=[..._0x5842fc['body'][_0xcf320e(0x1bc)]],_0x23cb51=[..._0x5842fc[_0xcf320e(0x2a5)][_0xcf320e(0x2a4)]],_0x577ec8=[..._0x5842fc[_0xcf320e(0x2a5)]['uuid']],_0x3e1e8e=[..._0x5842fc[_0xcf320e(0x2a5)]['sales_data_cateory']],_0x2158be=[..._0x5842fc['body'][_0xcf320e(0x28f)]];const _0x3d8891=_0x14eeb3['map'](_0x418539=>{return _0x418539={'product_name':_0x418539};});_0x2158be[_0xcf320e(0x258)]((_0xeb84e8,_0x44df06)=>{var _0x2478bc=_0xcf320e;_0x3d8891[_0x44df06][_0x2478bc(0x280)]=_0xeb84e8;}),_0x3e1e8e[_0xcf320e(0x258)]((_0x687433,_0x21ec0a)=>{_0x3d8891[_0x21ec0a]['sales_category']=_0x687433;}),_0x3b38f2[_0xcf320e(0x258)]((_0x2abd0c,_0x34084c)=>{_0x3d8891[_0x34084c]['product_code']=_0x2abd0c;}),_0x577ec8[_0xcf320e(0x258)]((_0x58bcf5,_0x477e4e)=>{var _0x3f56a4=_0xcf320e;_0x3d8891[_0x477e4e][_0x3f56a4(0x2c3)]=_0x58bcf5;}),_0x59c466[_0xcf320e(0x258)]((_0x9f1eaf,_0x361338)=>{var _0x54cccb=_0xcf320e;_0x3d8891[_0x361338][_0x54cccb(0x1c8)]=Math[_0x54cccb(0x2db)](_0x9f1eaf);}),_0x4a29de[_0xcf320e(0x258)]((_0x32163e,_0x54c871)=>{_0x3d8891[_0x54c871]['standard_unit']=_0x32163e;}),_0xd63d65[_0xcf320e(0x258)]((_0x351568,_0xf48aa7)=>{_0x3d8891[_0xf48aa7]['secondary_unit']=_0x351568;}),_0x48c8c8[_0xcf320e(0x258)]((_0x46de33,_0x5a3867)=>{var _0x1b20c4=_0xcf320e,_0x41dcad=_0x46de33['match'](/[A-Za-z]+/)[0x0],_0x55da7c=parseInt(_0x46de33[_0x1b20c4(0x212)](/\d+/)[0x0]);_0x3d8891[_0x5a3867][_0x1b20c4(0x1d0)]=_0x41dcad,_0x3d8891[_0x5a3867]['bay']=_0x55da7c;}),_0x4d6cd1[_0xcf320e(0x258)]((_0x321657,_0x5b4c5a)=>{var _0x332f28=_0xcf320e;_0x3d8891[_0x5b4c5a][_0x332f28(0x233)]=_0x321657;}),_0xac89fc[_0xcf320e(0x258)]((_0xe3406f,_0x21b6a9)=>{var _0x2c220b=_0xcf320e;_0x3d8891[_0x21b6a9][_0x2c220b(0x1e1)]=_0xe3406f;}),_0x115c26[_0xcf320e(0x258)]((_0x18e66a,_0x332577)=>{var _0x260988=_0xcf320e;_0x3d8891[_0x332577][_0x260988(0x2d9)]=_0x18e66a;}),_0x5e573a[_0xcf320e(0x258)]((_0x55b89f,_0x7c992d)=>{_0x3d8891[_0x7c992d]['batch_code']=_0x55b89f;}),_0x5dad31[_0xcf320e(0x258)]((_0x3b0372,_0x129414)=>{var _0x41d2c8=_0xcf320e;_0x3d8891[_0x129414][_0x41d2c8(0x1c7)]=_0x3b0372;}),_0x1aeda8[_0xcf320e(0x258)]((_0x1a3f81,_0x5cee9b)=>{var _0x5b9d5b=_0xcf320e;_0x3d8891[_0x5cee9b][_0x5b9d5b(0x2b4)]=_0x1a3f81;}),_0x8f924['forEach']((_0x5b0b51,_0x5537f8)=>{var _0x60e5fe=_0xcf320e;_0x3d8891[_0x5537f8][_0x60e5fe(0x237)]=_0x5b0b51;}),_0x3a920a['forEach']((_0x21051c,_0x1ca681)=>{var _0x5aef01=_0xcf320e;_0x3d8891[_0x1ca681][_0x5aef01(0x2ac)]=_0x21051c;}),_0x4d3fe1[_0xcf320e(0x258)]((_0x505188,_0xd050f)=>{var _0x27246d=_0xcf320e;_0x3d8891[_0xd050f][_0x27246d(0x1f5)]=_0x505188;}),_0x23cb51[_0xcf320e(0x258)]((_0x56c80a,_0x27e084)=>{var _0x280e7e=_0xcf320e;_0x3d8891[_0x27e084][_0x280e7e(0x2a4)]=_0x56c80a;});const _0x5a3adc=new purchases_logs();await _0x5a3adc[_0xcf320e(0x224)]();for(let _0x56be07=0x0;_0x56be07<=_0x4d3fe1[_0xcf320e(0x2a2)]-0x1;_0x56be07++){_0x3d8891[_0x56be07]['invoice']='LOG-INC-'+_0x5a3adc[_0xcf320e(0x2d3)][_0xcf320e(0x20e)]()[_0xcf320e(0x2bf)](0x8,'0');}const _0x3b075b=_0x3d8891[_0xcf320e(0x217)](_0x2ce044=>_0x2ce044['quantity']!=='0'&&_0x2ce044[_0xcf320e(0x1c8)]!==''),_0x229c19=new purchases_finished({'invoice':_0xcf320e(0x2d4)+_0x5a3adc[_0xcf320e(0x2d3)]['toString']()['padStart'](0x8,'0'),'suppliers':_0x5c60e0,'date':_0x36a86b,'warehouse_name':_0x39120a,'product':_0x3b075b,'note':_0x253f5d,'due_amount':_0x2fba32,'room':_0x10f516,'POnumber':_0xdfcd25,'SCRN':_0x163db9,'JO_number':_0x34da04,'ReqBy':_0x9ab711,'dateofreq':_0x3ffbcb,'typeservicesData':_0x5705f6,'van':_0x350f25,'typevehicle':_0x4c1b81,'driver':_0x16ad12,'plate':_0x2fb0fd,'DRSI':_0x54acb2,'TSU':_0x33e7c9,'TFU':_0x5c6203,'typeOfProducts':_0x2e0526}),_0x2054d6=await _0x229c19[_0xcf320e(0x224)](),_0x35283c=await purchases_finished['findOne']({'_id':_0x2054d6[_0xcf320e(0x1c3)]['valueOf']()}),_0x4a392b=_0x35283c[_0xcf320e(0x2de)][_0xcf320e(0x1da)](async _0xa50379=>{var _0x14bf21=_0xcf320e;try{var _0x37a3e9=await warehouse[_0x14bf21(0x2cb)]({'name':_0x39120a,'room':_0xa50379['room_name']}),_0xbc15c7=0x0;const _0x261638=_0x37a3e9['product_details']['map'](_0x5772b3=>{var _0x30f602=_0x14bf21;console[_0x30f602(0x295)](_0x5772b3[_0x30f602(0x213)]+'=='+_0xa50379[_0x30f602(0x213)]+'&&'+_0x5772b3[_0x30f602(0x2ee)]+'=='+_0xa50379[_0x30f602(0x2ee)]+'&&'+_0x5772b3['expiry_date']+'=='+_0xa50379[_0x30f602(0x1c7)]+'&&'+_0x5772b3[_0x30f602(0x2b4)]+'=='+_0xa50379['production_date']+'&&'+_0x5772b3[_0x30f602(0x2f2)]+'=='+_0xa50379[_0x30f602(0x2f2)]+'&&'+_0x5772b3[_0x30f602(0x219)]+'=='+_0x35283c[_0x30f602(0x219)]),_0x5772b3['product_name']==_0xa50379[_0x30f602(0x213)]&&_0x5772b3[_0x30f602(0x2ee)]==_0xa50379[_0x30f602(0x2ee)]&&_0x5772b3[_0x30f602(0x1d0)]==_0xa50379[_0x30f602(0x1d0)]&&_0x5772b3[_0x30f602(0x1c7)]==_0xa50379[_0x30f602(0x1c7)]&&_0x5772b3['production_date']==_0xa50379['production_date']&&_0x5772b3[_0x30f602(0x2f2)]==_0xa50379[_0x30f602(0x2f2)]&&_0x5772b3[_0x30f602(0x219)]==_0x35283c[_0x30f602(0x219)]&&(_0x5772b3[_0x30f602(0x229)]=Math[_0x30f602(0x2db)](_0x5772b3['product_stock'])+Math[_0x30f602(0x2db)](_0xa50379[_0x30f602(0x1c8)]),_0xbc15c7++);});return _0xbc15c7==0x0&&(_0x37a3e9[_0x14bf21(0x26a)]=_0x37a3e9[_0x14bf21(0x26a)][_0x14bf21(0x2ea)]({'product_name':_0xa50379[_0x14bf21(0x213)],'product_stock':Math[_0x14bf21(0x2db)](_0xa50379[_0x14bf21(0x1c8)]),'primary_code':_0xa50379[_0x14bf21(0x233)],'secondary_code':_0xa50379['secondary_code'],'product_code':_0xa50379['product_code'],'bay':_0xa50379[_0x14bf21(0x2ee)],'level':_0xa50379['level'],'maxProducts':_0xa50379[_0x14bf21(0x2d9)],'unit':_0xa50379[_0x14bf21(0x2af)],'secondary_unit':_0xa50379[_0x14bf21(0x20a)],'expiry_date':_0xa50379[_0x14bf21(0x1c7)],'production_date':_0xa50379[_0x14bf21(0x2b4)],'maxProducts':_0xa50379[_0x14bf21(0x2d9)],'maxPerUnit':_0xa50379[_0x14bf21(0x237)],'batch_code':_0xa50379['batch_code'],'product_cat':_0xa50379[_0x14bf21(0x2ac)],'invoice':_0xa50379['invoice'],'id_incoming':_0xa50379[_0x14bf21(0x1c3)],'uuid':_0xa50379[_0x14bf21(0x2c3)],'gross_price':_0xa50379['gross_price'],'sales_category':_0xa50379['sales_category'],'type_products':_0xa50379[_0x14bf21(0x280)]})),_0x37a3e9;}catch(_0x10c640){return console[_0x14bf21(0x2aa)]('Error\x20occurred\x20while\x20processing\x20product:',_0x10c640),null;}});Promise[_0xcf320e(0x1b4)](_0x4a392b)[_0xcf320e(0x23c)](async _0x26353b=>{var _0x4dc5f1=_0xcf320e;try{for(const _0x47e4e7 of _0x26353b){await warehouse[_0x4dc5f1(0x1f1)]({'_id':_0x47e4e7['_id']},{'$addToSet':{'product_details':{'$each':_0x47e4e7[_0x4dc5f1(0x26a)]}}});}const _0x4de0be=await master_shop[_0x4dc5f1(0x205)](),_0x3c43c9=await email_settings[_0x4dc5f1(0x2cb)](),_0xf96bab=await supervisor_settings[_0x4dc5f1(0x205)]();var _0x313ab3=_0x35283c[_0x4dc5f1(0x2de)],_0x5853ab='',_0x5a4bd2;for(_0x5a4bd2 in _0x313ab3){var _0xb1596='FG';_0x35283c[_0x4dc5f1(0x298)]==_0x4dc5f1(0x232)&&(_0xb1596='DG'),_0x5853ab+=_0x4dc5f1(0x216)+_0x4dc5f1(0x2b1)+_0x313ab3[_0x5a4bd2][_0x4dc5f1(0x213)]+_0x4dc5f1(0x21d)+_0x4dc5f1(0x2b1)+_0x313ab3[_0x5a4bd2]['product_code']+_0x4dc5f1(0x21d)+_0x4dc5f1(0x2b1)+_0x313ab3[_0x5a4bd2][_0x4dc5f1(0x1c8)]+'</td>'+_0x4dc5f1(0x2b1)+_0x313ab3[_0x5a4bd2][_0x4dc5f1(0x2af)]+_0x4dc5f1(0x21d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x313ab3[_0x5a4bd2][_0x4dc5f1(0x20a)]+_0x4dc5f1(0x21d)+_0x4dc5f1(0x2b1)+_0x35283c[_0x4dc5f1(0x298)]+'</td>'+_0x4dc5f1(0x2b1)+_0x313ab3[_0x5a4bd2][_0x4dc5f1(0x1f5)]+_0x4dc5f1(0x21d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb1596+_0x313ab3[_0x5a4bd2][_0x4dc5f1(0x2ee)]+_0x4dc5f1(0x21d),_0x4dc5f1(0x2e7);}let _0x825ce0=nodemailer['createTransport']({'host':_0x3c43c9[_0x4dc5f1(0x25e)],'port':Number(_0x3c43c9[_0x4dc5f1(0x24c)]),'secure':![],'auth':{'user':_0x3c43c9[_0x4dc5f1(0x285)],'pass':_0x3c43c9[_0x4dc5f1(0x22b)]}}),_0x493a4c={'from':_0x3c43c9['email'],'to':_0xf96bab[0x0][_0x4dc5f1(0x27e)],'subject':_0x4dc5f1(0x2f4),'attachments':[{'filename':_0x4dc5f1(0x1f0),'path':__dirname+_0x4dc5f1(0x1f9)+_0x4dc5f1(0x227)+_0x4de0be[0x0]['image'],'cid':_0x4dc5f1(0x23f)}],'html':_0x4dc5f1(0x2c8)+'<html><head><title></title>'+_0x4dc5f1(0x1f3)+_0x4dc5f1(0x2d6)+_0x4dc5f1(0x2e0)+_0x4dc5f1(0x2d6)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4dc5f1(0x1f8)+_0x4dc5f1(0x2d6)+_0x4dc5f1(0x279)+_0x4de0be[0x0]['site_title']+_0x4dc5f1(0x211)+_0x4dc5f1(0x1f8)+'</div>'+_0x4dc5f1(0x210)+_0x4dc5f1(0x2d6)+_0x4dc5f1(0x1ba)+_0x4dc5f1(0x1ed)+_0x35283c['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x35283c[_0x4dc5f1(0x257)]+'\x20'+_0x4dc5f1(0x250)+_0x4dc5f1(0x27f)+_0x4dc5f1(0x1f8)+_0x4dc5f1(0x29b)+_0x4dc5f1(0x242)+_0x4dc5f1(0x216)+_0x4dc5f1(0x2dd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4dc5f1(0x2bb)+_0x4dc5f1(0x29a)+_0x4dc5f1(0x273)+_0x4dc5f1(0x27b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4dc5f1(0x1ea)+_0x4dc5f1(0x2e7)+_0x4dc5f1(0x1bd)+_0x4dc5f1(0x2a7)+'\x20'+_0x5853ab+'\x20'+'</tbody>'+_0x4dc5f1(0x236)+_0x4dc5f1(0x2d6)+_0x4dc5f1(0x1c4)+_0x4dc5f1(0x1cc)+_0x4de0be[0x0][_0x4dc5f1(0x288)]+_0x4dc5f1(0x27f)+_0x4dc5f1(0x1f8)+_0x4dc5f1(0x1f8)+'</body></html>'};_0x825ce0[_0x4dc5f1(0x24a)](_0x493a4c,function(_0x3df0d5,_0x1bc95a){var _0x1ca337=_0x4dc5f1;_0x3df0d5?(console['log'](_0x3df0d5),console[_0x1ca337(0x295)](_0x1ca337(0x22a))):console[_0x1ca337(0x295)](_0x1ca337(0x1e7));});}catch(_0xfb17d1){console[_0x4dc5f1(0x2aa)](_0xfb17d1),_0x1420bb[_0x4dc5f1(0x1fd)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0xfb17d1[_0x4dc5f1(0x2d5)]});}})[_0xcf320e(0x26b)](_0x163abb=>{var _0x6e6d2d=_0xcf320e;console[_0x6e6d2d(0x2aa)](_0x163abb);}),_0x5842fc['flash']('success',_0xcf320e(0x222)),_0x1420bb[_0xcf320e(0x1d6)]('/all_purchases_finished/preview/'+_0x35283c['_id']['valueOf']());}catch(_0x320544){console['log'](_0x320544);}}),router['get'](a0_0x41fc1a(0x299),auth,async(_0x352974,_0x6e0129)=>{var _0x174fa6=a0_0x41fc1a;try{const {username:_0x1e865c,email:_0x56c373,role:_0x29e537}=_0x352974[_0x174fa6(0x24f)],_0x5bd795=_0x352974['user'],_0x3b5142=await profile['findOne']({'email':_0x5bd795['email']}),_0x61cde4=await master_shop[_0x174fa6(0x205)](),_0x486f9e=_0x352974[_0x174fa6(0x1db)]['id'],_0x423244=await purchases_finished[_0x174fa6(0x294)](_0x486f9e),_0xa52189=await suppliers['find']({});let _0x4ddec9;if(_0x5bd795[_0x174fa6(0x2a6)]==_0x174fa6(0x259)){const _0x4cd5a9=await staff[_0x174fa6(0x2cb)]({'email':_0x5bd795[_0x174fa6(0x285)]});_0x4ddec9=await warehouse[_0x174fa6(0x205)]({'status':_0x174fa6(0x276),'name':_0x4cd5a9['warehouse'],'warehouse_category':_0x174fa6(0x2a1)});}else _0x4ddec9=await warehouse[_0x174fa6(0x29c)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x174fa6(0x1df),'name':{'$first':_0x174fa6(0x1df)}}}]);const _0x298973=await product['find']({}),_0x39c4ee=BayBinSelected(_0x423244[_0x174fa6(0x298)],_0x423244['room']);let _0x33b723=new Date(_0x423244[_0x174fa6(0x1c7)]),_0x1062f4=('0'+_0x33b723['getDate']())[_0x174fa6(0x291)](-0x2),_0x215103=('0'+(_0x33b723[_0x174fa6(0x23b)]()+0x1))[_0x174fa6(0x291)](-0x2),_0x17f0b8=_0x33b723[_0x174fa6(0x262)](),_0xb924f8=_0x17f0b8+'-'+_0x215103+'-'+_0x1062f4;if(_0x61cde4[0x0][_0x174fa6(0x2ad)]==_0x174fa6(0x2ba)){var _0x393e9=users['English'];console['log'](_0x393e9);}else{if(_0x61cde4[0x0][_0x174fa6(0x2ad)]==_0x174fa6(0x2c0))var _0x393e9=users['Hindi'];else{if(_0x61cde4[0x0][_0x174fa6(0x2ad)]==_0x174fa6(0x2f1))var _0x393e9=users[_0x174fa6(0x2f1)];else{if(_0x61cde4[0x0][_0x174fa6(0x2ad)]=='Spanish')var _0x393e9=users[_0x174fa6(0x283)];else{if(_0x61cde4[0x0]['language']==_0x174fa6(0x2a3))var _0x393e9=users[_0x174fa6(0x2a3)];else{if(_0x61cde4[0x0][_0x174fa6(0x2ad)]==_0x174fa6(0x1fa))var _0x393e9=users['Portuguese'];else{if(_0x61cde4[0x0][_0x174fa6(0x2ad)]=='Chinese')var _0x393e9=users[_0x174fa6(0x218)];else{if(_0x61cde4[0x0][_0x174fa6(0x2ad)]=='Arabic\x20(ae)')var _0x393e9=users[_0x174fa6(0x234)];}}}}}}}_0x6e0129[_0x174fa6(0x264)](_0x174fa6(0x2d2),{'success':_0x352974[_0x174fa6(0x251)](_0x174fa6(0x1d3)),'errors':_0x352974[_0x174fa6(0x251)](_0x174fa6(0x2f0)),'role':_0x5bd795,'profile':_0x3b5142,'purchases':_0x423244,'suppliers':_0xa52189,'warehouse':_0x4ddec9,'product':_0x298973,'master_shop':_0x61cde4,'language':_0x393e9,'ed_fullDate':_0xb924f8,'dataSelected':_0x39c4ee});}catch(_0x48768f){console[_0x174fa6(0x295)](_0x48768f);}}),router[a0_0x41fc1a(0x29e)]('/view/:id',auth,async(_0x36193a,_0x1d40b9)=>{var _0x56ea5=a0_0x41fc1a;try{const {username:_0x156689,email:_0x7046f0,role:_0x249426}=_0x36193a[_0x56ea5(0x24f)],_0x24357a=_0x36193a[_0x56ea5(0x24f)],_0x3da0cc=await profile[_0x56ea5(0x2cb)]({'email':_0x24357a[_0x56ea5(0x285)]}),_0xe14675=await master_shop[_0x56ea5(0x205)](),_0x521c11=_0x36193a[_0x56ea5(0x1db)]['id'],_0x5d3cd2=await purchases_finished[_0x56ea5(0x294)](_0x521c11),_0x3ee757=await suppliers[_0x56ea5(0x205)]({});let _0x46460b;if(_0x24357a[_0x56ea5(0x2a6)]==_0x56ea5(0x259)){const _0x234c47=await staff['findOne']({'email':_0x24357a[_0x56ea5(0x285)]});_0x46460b=await warehouse[_0x56ea5(0x205)]({'status':'Enabled','name':_0x234c47[_0x56ea5(0x290)],'warehouse_category':'Finished\x20Goods'});}else _0x46460b=await warehouse[_0x56ea5(0x29c)]([{'$match':{'status':_0x56ea5(0x276),'warehouse_category':_0x56ea5(0x2a1)}},{'$group':{'_id':_0x56ea5(0x1df),'name':{'$first':_0x56ea5(0x1df)}}}]);const _0x451d4c=await product[_0x56ea5(0x205)]({}),_0x1bc902=BayBinSelected(_0x5d3cd2['warehouse_name'],_0x5d3cd2[_0x56ea5(0x21f)]);let _0x14e6e4=new Date(_0x5d3cd2[_0x56ea5(0x1c7)]),_0xe80123=('0'+_0x14e6e4[_0x56ea5(0x297)]())[_0x56ea5(0x291)](-0x2),_0x33270f=('0'+(_0x14e6e4[_0x56ea5(0x23b)]()+0x1))[_0x56ea5(0x291)](-0x2),_0x35f9fb=_0x14e6e4['getFullYear'](),_0x337d4c=_0x35f9fb+'-'+_0x33270f+'-'+_0xe80123;if(_0xe14675[0x0][_0x56ea5(0x2ad)]=='English\x20(US)'){var _0x179745=users[_0x56ea5(0x1cb)];console['log'](_0x179745);}else{if(_0xe14675[0x0][_0x56ea5(0x2ad)]==_0x56ea5(0x2c0))var _0x179745=users['Hindi'];else{if(_0xe14675[0x0]['language']==_0x56ea5(0x2f1))var _0x179745=users[_0x56ea5(0x2f1)];else{if(_0xe14675[0x0][_0x56ea5(0x2ad)]=='Spanish')var _0x179745=users[_0x56ea5(0x283)];else{if(_0xe14675[0x0][_0x56ea5(0x2ad)]==_0x56ea5(0x2a3))var _0x179745=users[_0x56ea5(0x2a3)];else{if(_0xe14675[0x0][_0x56ea5(0x2ad)]=='Portuguese\x20(BR)')var _0x179745=users['Portuguese'];else{if(_0xe14675[0x0][_0x56ea5(0x2ad)]==_0x56ea5(0x218))var _0x179745=users[_0x56ea5(0x218)];else{if(_0xe14675[0x0][_0x56ea5(0x2ad)]==_0x56ea5(0x2f3))var _0x179745=users[_0x56ea5(0x234)];}}}}}}}_0x1d40b9['render'](_0x56ea5(0x1c0),{'success':_0x36193a['flash']('success'),'errors':_0x36193a[_0x56ea5(0x251)](_0x56ea5(0x2f0)),'role':_0x24357a,'profile':_0x3da0cc,'purchases':_0x5d3cd2,'suppliers':_0x3ee757,'warehouse':_0x46460b,'product':_0x451d4c,'master_shop':_0xe14675,'language':_0x179745,'ed_fullDate':_0x337d4c,'dataSelected':_0x1bc902});}catch(_0x236081){console[_0x56ea5(0x295)](_0x236081);}}),router[a0_0x41fc1a(0x261)](a0_0x41fc1a(0x23e),auth,async(_0xcd9d38,_0x3d9be8)=>{var _0x173212=a0_0x41fc1a;try{const _0x5a2485=_0xcd9d38[_0x173212(0x1db)]['id'],_0x2ab699=await purchases_finished[_0x173212(0x2cb)]({'_id':_0xcd9d38[_0x173212(0x1db)]['id']}),_0x117461=await warehouse[_0x173212(0x2cb)]({'name':_0x2ab699[_0x173212(0x298)],'room':_0x2ab699['room']});_0x2ab699[_0x173212(0x2de)][_0x173212(0x258)](_0x44d681=>{var _0x29033b=_0x173212;const _0xd838c1=_0x117461[_0x29033b(0x26a)]['map'](_0x251d01=>{var _0x17910a=_0x29033b;_0x251d01[_0x17910a(0x213)]==_0x44d681[_0x17910a(0x213)]&&_0x251d01[_0x17910a(0x2ee)]==_0x44d681[_0x17910a(0x2ee)]&&(_0x251d01[_0x17910a(0x229)]=parseInt(_0x251d01[_0x17910a(0x229)])-parseInt(_0x44d681[_0x17910a(0x1c8)]));});}),await _0x117461[_0x173212(0x224)]();const {invoice:_0x269bbc,suppliers:_0x14a52a,date:_0x53239f,warehouse_name:_0x1a2908,prod_name:_0x19cfb9,prod_code:_0xddff3a,prod_qty:_0x3f4334,prod_unit:_0x439945,prod_secondunit:_0x19f1b6,prod_level:_0x3a5634,prod_isle:_0x4ddd6f,prod_pallet:_0x3d79cc,note:_0x1ec0d2,expiry_date:_0x3700b1,batch_code:_0x204385,paid_amount:_0xe41d07,due_amount:_0x5183e9,Room_name:_0x14986,primary_code:_0x10f582,secondary_code:_0xcbe9fe,PO_number:_0x80cd4d,JO_number:_0x521163}=_0xcd9d38[_0x173212(0x2a5)];if(typeof _0x19cfb9=='string')var _0x4d9d52=[_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x226)]],_0x25f839=[_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x2c9)]],_0x490088=[_0xcd9d38[_0x173212(0x2a5)]['prod_qty']],_0x48996e=[_0xcd9d38[_0x173212(0x2a5)]['prod_unit']],_0x386c7e=[_0xcd9d38[_0x173212(0x2a5)]['prod_secondunit']],_0x1a1e42=[_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x1c9)]],_0x5e871f=[_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x233)]],_0x1c4fd9=[_0xcd9d38[_0x173212(0x2a5)]['secondary_code']],_0x548ae9=[_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x2ef)]],_0x2f59ed=[_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x2f2)]],_0x1abc38=[_0xcd9d38['body'][_0x173212(0x1c7)]];else var _0x4d9d52=[..._0xcd9d38[_0x173212(0x2a5)][_0x173212(0x226)]],_0x25f839=[..._0xcd9d38[_0x173212(0x2a5)][_0x173212(0x2c9)]],_0x490088=[..._0xcd9d38[_0x173212(0x2a5)][_0x173212(0x1cf)]],_0x48996e=[..._0xcd9d38[_0x173212(0x2a5)][_0x173212(0x265)]],_0x386c7e=[..._0xcd9d38[_0x173212(0x2a5)]['prod_secondunit']],_0x1a1e42=[..._0xcd9d38[_0x173212(0x2a5)][_0x173212(0x1c9)]],_0x5e871f=[..._0xcd9d38[_0x173212(0x2a5)]['primary_code']],_0x1c4fd9=[..._0xcd9d38[_0x173212(0x2a5)][_0x173212(0x1e1)]],_0x548ae9=[..._0xcd9d38['body'][_0x173212(0x2ef)]],_0x2f59ed=[..._0xcd9d38[_0x173212(0x2a5)]['batch_code']],_0x1abc38=[..._0xcd9d38['body'][_0x173212(0x1c7)]];const _0x48dc42=_0x4d9d52[_0x173212(0x1da)](_0x3c289b=>{return _0x3c289b={'product_name':_0x3c289b};});_0x25f839['forEach']((_0x2a099c,_0x66260c)=>{var _0x117421=_0x173212;_0x48dc42[_0x66260c][_0x117421(0x1c1)]=_0x2a099c;}),_0x490088[_0x173212(0x258)]((_0x97595a,_0xc2b97a)=>{var _0xac66c1=_0x173212;_0x48dc42[_0xc2b97a][_0xac66c1(0x1c8)]=_0x97595a;}),_0x48996e[_0x173212(0x258)]((_0x4809e7,_0x144eda)=>{var _0x3065cb=_0x173212;_0x48dc42[_0x144eda][_0x3065cb(0x2af)]=_0x4809e7;}),_0x386c7e[_0x173212(0x258)]((_0x18e6e6,_0x3af393)=>{_0x48dc42[_0x3af393]['secondary_unit']=_0x18e6e6;}),_0x1a1e42['forEach']((_0x1a1fc9,_0x424798)=>{var _0x590238=_0x173212;_0x48dc42[_0x424798][_0x590238(0x2ee)]=_0x1a1fc9;}),_0x5e871f[_0x173212(0x258)]((_0x3a0527,_0x2c63cd)=>{var _0x1b498e=_0x173212;_0x48dc42[_0x2c63cd][_0x1b498e(0x233)]=_0x3a0527;}),_0x1c4fd9['forEach']((_0x5144c4,_0x50db05)=>{_0x48dc42[_0x50db05]['secondary_code']=_0x5144c4;}),_0x548ae9['forEach']((_0xea03f9,_0x45698f)=>{var _0x5aec12=_0x173212;_0x48dc42[_0x45698f][_0x5aec12(0x2d9)]=_0xea03f9;}),_0x2f59ed['forEach']((_0x34ad4c,_0x359c33)=>{var _0x56b314=_0x173212;_0x48dc42[_0x359c33][_0x56b314(0x2f2)]=_0x34ad4c;}),_0x1abc38[_0x173212(0x258)]((_0x22f14a,_0xf32e8)=>{var _0x10cb46=_0x173212;_0x48dc42[_0xf32e8][_0x10cb46(0x1c7)]=_0x22f14a;});const _0x22bce6=_0x48dc42[_0x173212(0x217)](_0x412ba9=>_0x412ba9[_0x173212(0x1c8)]!=='0'&&_0x412ba9['quantity']!=='');_0x2ab699['invoice']=_0x269bbc,_0x2ab699['suppliers']=_0x14a52a,_0x2ab699[_0x173212(0x257)]=_0x53239f,_0x2ab699[_0x173212(0x298)]=_0x1a2908,_0x2ab699[_0x173212(0x2de)]=_0x22bce6,_0x2ab699[_0x173212(0x1d5)]=_0x1ec0d2,_0x2ab699[_0x173212(0x289)]=_0xe41d07,_0x2ab699[_0x173212(0x1fc)]=_0x5183e9,_0x2ab699[_0x173212(0x21f)]=_0x14986,_0x2ab699['POnumber']=_0x80cd4d,_0x2ab699['JO_number']=_0x521163;const _0x4f5cc5=await _0x2ab699[_0x173212(0x224)](),_0x116bb3=await warehouse[_0x173212(0x2cb)]({'name':_0xcd9d38['body'][_0x173212(0x298)],'room':_0xcd9d38['body'][_0x173212(0x1d2)]});_0x2ab699['product']['forEach'](_0x1a3cea=>{var _0x13c2f2=_0x173212,_0x332fe9=0x0;const _0x10984d=_0x116bb3['product_details']['map'](_0x572fed=>{var _0x3deb95=a0_0x5679;_0x572fed[_0x3deb95(0x213)]==_0x1a3cea['product_name']&&_0x572fed[_0x3deb95(0x2ee)]==_0x1a3cea['bay']&&(_0x572fed['product_stock']=parseInt(_0x572fed[_0x3deb95(0x229)])+parseInt(_0x1a3cea[_0x3deb95(0x1c8)]),_0x332fe9++);});_0x332fe9=='0'&&(_0x116bb3['product_details']=_0x116bb3[_0x13c2f2(0x26a)][_0x13c2f2(0x2ea)]({'product_name':_0x1a3cea[_0x13c2f2(0x213)],'product_stock':_0x1a3cea['quantity'],'primary_code':_0x1a3cea[_0x13c2f2(0x233)],'secondary_code':_0x1a3cea[_0x13c2f2(0x1e1)],'product_code':_0x1a3cea[_0x13c2f2(0x1c1)],'bay':_0x1a3cea[_0x13c2f2(0x2ee)],'maxProducts':_0x1a3cea[_0x13c2f2(0x2d9)],'unit':_0x1a3cea[_0x13c2f2(0x2af)],'secondary_unit':_0x1a3cea['secondary_unit'],'expiry_date':_0x1a3cea['expiry_date']}));}),await _0x116bb3['save']();const _0x3c9f70=await s_payment_data[_0x173212(0x2cb)]({'invoice':_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x219)]});if(_0x3c9f70===null){}else console[_0x173212(0x295)]('suppliers',_0x3c9f70,_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x219)]),_0x3c9f70[_0x173212(0x254)]=_0xcd9d38[_0x173212(0x2a5)][_0x173212(0x254)],await _0x3c9f70[_0x173212(0x224)]();_0xcd9d38['flash'](_0x173212(0x1d3),_0x173212(0x2be)),_0x3d9be8[_0x173212(0x1d6)](_0x173212(0x260));}catch(_0x28d1fb){console['log'](_0x28d1fb);}}),router[a0_0x41fc1a(0x261)](a0_0x41fc1a(0x2a8),auth,async(_0x4dfa5c,_0x34896a)=>{var _0x1aab38=a0_0x41fc1a;try{const _0x253f16=_0x4dfa5c[_0x1aab38(0x1db)]['id'],{invoice:_0x1780cd,suppliers:_0x3c4a40,payable:_0x24b10c,due_amount:_0x27e323}=_0x4dfa5c['body'],_0x3351a6=await purchases['findById'](_0x253f16);var _0x109656=_0x24b10c-_0x27e323;_0x3351a6['paid_amount']=parseFloat(_0x3351a6[_0x1aab38(0x289)])+parseFloat(_0x27e323),_0x3351a6['due_amount']=_0x109656;const _0x657501=await _0x3351a6['save']();console['log'](_0x657501);const _0x3b896c=await s_payment_data[_0x1aab38(0x2cb)]({'invoice':_0x1780cd});_0x3b896c['amount']=_0x109656,await _0x3b896c[_0x1aab38(0x224)]();let _0x1e32f1=new Date(),_0x50780a=('0'+_0x1e32f1['getDate']())[_0x1aab38(0x291)](-0x2),_0x1585b7=('0'+(_0x1e32f1[_0x1aab38(0x23b)]()+0x1))[_0x1aab38(0x291)](-0x2),_0x2d7b93=_0x1e32f1[_0x1aab38(0x262)](),_0x477f6c=_0x2d7b93+'-'+_0x1585b7+'-'+_0x50780a;const _0x5e189f=new suppliers_payment({'invoice':_0x1780cd,'date':_0x2d7b93+'-'+_0x1585b7+'-'+_0x50780a,'suppliers':_0x3c4a40,'reason':_0x1aab38(0x245),'amount':_0x27e323}),_0x203cd1=await _0x5e189f['save']();_0x4dfa5c['flash']('success',_0x1aab38(0x1f6)),_0x34896a[_0x1aab38(0x1d6)](_0x1aab38(0x200));}catch(_0xab8a84){console[_0x1aab38(0x295)](_0xab8a84);}}),router[a0_0x41fc1a(0x29e)]('/invoice/:id',auth,async(_0x18acdc,_0x3c15ab)=>{var _0x207595=a0_0x41fc1a;try{const {username:_0x528406,email:_0x2998e4,role:_0x1a7596}=_0x18acdc[_0x207595(0x24f)],_0x46943e=_0x18acdc[_0x207595(0x24f)],_0x3e6028=await profile[_0x207595(0x2cb)]({'email':_0x46943e[_0x207595(0x285)]}),_0x300fe3=await master_shop[_0x207595(0x205)]();console[_0x207595(0x295)](_0x207595(0x22f),_0x300fe3);const _0xf2c4e1=_0x18acdc[_0x207595(0x1db)]['id'],_0x30ba22=await purchases[_0x207595(0x294)](_0xf2c4e1);console[_0x207595(0x295)](_0x30ba22);const _0x1ccf49=await suppliers[_0x207595(0x2cb)]({'name':_0x30ba22[_0x207595(0x254)]});console[_0x207595(0x295)](_0x1ccf49);if(_0x300fe3[0x0][_0x207595(0x2ad)]==_0x207595(0x2ba)){var _0x2f64f5=users[_0x207595(0x1cb)];console[_0x207595(0x295)](_0x2f64f5);}else{if(_0x300fe3[0x0][_0x207595(0x2ad)]==_0x207595(0x2c0))var _0x2f64f5=users[_0x207595(0x2c0)];else{if(_0x300fe3[0x0][_0x207595(0x2ad)]==_0x207595(0x2f1))var _0x2f64f5=users[_0x207595(0x2f1)];else{if(_0x300fe3[0x0][_0x207595(0x2ad)]==_0x207595(0x283))var _0x2f64f5=users[_0x207595(0x283)];else{if(_0x300fe3[0x0]['language']=='French')var _0x2f64f5=users[_0x207595(0x2a3)];else{if(_0x300fe3[0x0][_0x207595(0x2ad)]==_0x207595(0x1fa))var _0x2f64f5=users[_0x207595(0x2d8)];else{if(_0x300fe3[0x0][_0x207595(0x2ad)]=='Chinese')var _0x2f64f5=users[_0x207595(0x218)];else{if(_0x300fe3[0x0]['language']=='Arabic\x20(ae)')var _0x2f64f5=users['Arabic'];}}}}}}}_0x3c15ab[_0x207595(0x264)](_0x207595(0x2c7),{'success':_0x18acdc[_0x207595(0x251)](_0x207595(0x1d3)),'errors':_0x18acdc['flash']('errors'),'role':_0x46943e,'profile':_0x3e6028,'master_shop':_0x300fe3,'supplier':_0x1ccf49,'purchase':_0x30ba22,'language':_0x2f64f5});}catch(_0x1bf558){console[_0x207595(0x295)](_0x1bf558);}}),router[a0_0x41fc1a(0x29e)](a0_0x41fc1a(0x21b),auth,async(_0x3a31e3,_0x2d1940)=>{var _0x5f13c4=a0_0x41fc1a;try{const {username:_0x5df4cb,email:_0x157cc9,role:_0x162177}=_0x3a31e3[_0x5f13c4(0x24f)],_0x5df191=_0x3a31e3['user'],_0x532587=await profile['findOne']({'email':_0x5df191[_0x5f13c4(0x285)]}),_0x1acdec=await master_shop[_0x5f13c4(0x205)]();console[_0x5f13c4(0x295)](_0x5f13c4(0x22f),_0x1acdec);const _0x344275=_0x3a31e3[_0x5f13c4(0x1db)]['id'];console['log'](_0x344275);const _0x88b3d7=await purchases_finished[_0x5f13c4(0x294)](_0x344275);console['log']('user_id',_0x88b3d7);const _0x241a19=await product[_0x5f13c4(0x205)]({}),_0x216409=await warehouse[_0x5f13c4(0x29c)]([{'$match':{'name':_0x88b3d7[_0x5f13c4(0x298)],'room':_0x88b3d7['room']}},{'$unwind':_0x5f13c4(0x2a9)},{'$group':{'_id':_0x5f13c4(0x29d),'name':{'$first':_0x5f13c4(0x1bf)},'product_stock':{'$first':_0x5f13c4(0x1ec)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5f13c4(0x26e)},'type':{'$first':_0x5f13c4(0x1f7)},'floorlevel':{'$first':_0x5f13c4(0x2cd)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5f13c4(0x2cc)},'product_code':{'$first':_0x5f13c4(0x1e4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5f13c4(0x221)}}}]);console[_0x5f13c4(0x295)](_0x5f13c4(0x207),_0x216409);let _0x225df1;if(_0x5df191[_0x5f13c4(0x2a6)]==_0x5f13c4(0x259)){const _0x3e16a9=await staff['findOne']({'email':_0x5df191[_0x5f13c4(0x285)]});_0x225df1=await warehouse[_0x5f13c4(0x205)]({'status':_0x5f13c4(0x276),'name':_0x3e16a9[_0x5f13c4(0x290)],'warehouse_category':_0x5f13c4(0x2a1),'name':_0x5f13c4(0x22d)});}else _0x225df1=await warehouse[_0x5f13c4(0x29c)]([{'$match':{'status':_0x5f13c4(0x276),'warehouse_category':_0x5f13c4(0x2a1),'name':_0x5f13c4(0x22d)}},{'$group':{'_id':_0x5f13c4(0x1df),'name':{'$first':'$name'}}}]);if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]=='English\x20(US)'){var _0x57b248=users[_0x5f13c4(0x1cb)];console[_0x5f13c4(0x295)](_0x57b248);}else{if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]==_0x5f13c4(0x2c0))var _0x57b248=users[_0x5f13c4(0x2c0)];else{if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]=='German')var _0x57b248=users[_0x5f13c4(0x2f1)];else{if(_0x1acdec[0x0]['language']==_0x5f13c4(0x283))var _0x57b248=users[_0x5f13c4(0x283)];else{if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]=='French')var _0x57b248=users['French'];else{if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]==_0x5f13c4(0x1fa))var _0x57b248=users[_0x5f13c4(0x2d8)];else{if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]==_0x5f13c4(0x218))var _0x57b248=users[_0x5f13c4(0x218)];else{if(_0x1acdec[0x0][_0x5f13c4(0x2ad)]==_0x5f13c4(0x2f3))var _0x57b248=users[_0x5f13c4(0x234)];}}}}}}}_0x2d1940[_0x5f13c4(0x264)](_0x5f13c4(0x2e4),{'success':_0x3a31e3['flash'](_0x5f13c4(0x1d3)),'errors':_0x3a31e3[_0x5f13c4(0x251)](_0x5f13c4(0x2f0)),'role':_0x5df191,'profile':_0x532587,'user':_0x88b3d7,'stock':_0x216409,'master_shop':_0x1acdec,'product':_0x241a19,'language':_0x57b248,'warehouse':_0x225df1});}catch(_0x4dc763){console['log'](_0x4dc763);}}),router['post'](a0_0x41fc1a(0x21b),auth,async(_0x4c72bb,_0x473b97)=>{var _0xa5ce22=a0_0x41fc1a;try{const {invoice:_0x37af4e,date:_0x1cd758,warehouse_name:_0x506b95,Room_name:_0x258f84,product_name:_0x239195,purchase_quantity:_0x36a7ba,stocks:_0x209e4f,return_qty:_0x3429eb,note:_0x315c9b,level:_0xe6aac7,isle:_0x1bac0b,pallet:_0x4599c8,to_warehouse_name:_0x354f8d,to_Room_name:_0x22bbb5}=_0x4c72bb[_0xa5ce22(0x2a5)],_0x2f709f=await purchases_finished[_0xa5ce22(0x2cb)]({'_id':_0x4c72bb['params']['id']}),_0x4d9970=await warehouse['findOne']({'name':_0x506b95,'room':_0x258f84,'warehouse_category':_0xa5ce22(0x2a1)});if(typeof _0x239195==_0xa5ce22(0x1d1))var _0x1695f7=[_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x213)]],_0x517a85=[_0x4c72bb[_0xa5ce22(0x2a5)]['purchase_quantity']],_0xeb9529=[_0x4c72bb[_0xa5ce22(0x2a5)]['stocks']],_0x53bcb9=[_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2bd)]],_0x38f93c=[_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x1d0)]],_0x45694a=[_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x1de)]],_0x4530ef=[_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2e3)]],_0x2ce0e0=[_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2ed)]];else var _0x1695f7=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x213)]],_0x517a85=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2e1)]],_0xeb9529=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x292)]],_0x53bcb9=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2bd)]],_0x38f93c=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x1d0)]],_0x45694a=[..._0x4c72bb['body'][_0xa5ce22(0x1de)]],_0x4530ef=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2e3)]],_0x2ce0e0=[..._0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x2ed)]];const _0x4a11ba=_0x1695f7[_0xa5ce22(0x1da)](_0x26702a=>{return _0x26702a={'product_name':_0x26702a};});_0x517a85['forEach']((_0xa56829,_0x30146e)=>{var _0xadd63=_0xa5ce22;_0x4a11ba[_0x30146e][_0xadd63(0x2e1)]=_0xa56829;}),_0xeb9529[_0xa5ce22(0x258)]((_0x240a7d,_0x1054e8)=>{var _0x2bcdcd=_0xa5ce22;_0x4a11ba[_0x1054e8][_0x2bcdcd(0x1d8)]=_0x240a7d;}),_0x53bcb9[_0xa5ce22(0x258)]((_0x50347c,_0x1087a9)=>{var _0x3432ad=_0xa5ce22;_0x4a11ba[_0x1087a9][_0x3432ad(0x2bd)]=_0x50347c;}),_0x38f93c[_0xa5ce22(0x258)]((_0x5540fe,_0x3922c6)=>{var _0x112302=_0xa5ce22;_0x4a11ba[_0x3922c6][_0x112302(0x2ee)]=_0x5540fe;}),_0x45694a[_0xa5ce22(0x258)]((_0x1b3c82,_0x2d9916)=>{_0x4a11ba[_0x2d9916]['product_code']=_0x1b3c82;}),_0x4530ef[_0xa5ce22(0x258)]((_0x35b02e,_0x18b9a8)=>{var _0x2cef02=_0xa5ce22;_0x4a11ba[_0x18b9a8][_0x2cef02(0x233)]=_0x35b02e;}),_0x2ce0e0['forEach']((_0x1091d9,_0x1e00f2)=>{var _0x3c95fa=_0xa5ce22;_0x4a11ba[_0x1e00f2][_0x3c95fa(0x1e1)]=_0x1091d9;}),_0x4a11ba[_0xa5ce22(0x258)](_0x22f42c=>{var _0x271521=_0xa5ce22;console[_0x271521(0x295)](_0x22f42c);const _0x3b3642=_0x4d9970[_0x271521(0x26a)]['map'](_0xc34c7b=>{var _0x2a1a5f=_0x271521;_0xc34c7b[_0x2a1a5f(0x213)]==_0x22f42c[_0x2a1a5f(0x213)]&&_0xc34c7b[_0x2a1a5f(0x2ee)]==_0x22f42c['bay']&&(console['log'](parseInt(_0xc34c7b[_0x2a1a5f(0x229)])+_0x2a1a5f(0x24e)+parseInt(_0x22f42c['return_qty'])),_0xc34c7b[_0x2a1a5f(0x229)]=parseInt(_0xc34c7b[_0x2a1a5f(0x229)])-parseInt(_0x22f42c[_0x2a1a5f(0x2bd)]));});}),await _0x4d9970[_0xa5ce22(0x224)]();var _0x15c8d8=0x0;_0x4a11ba[_0xa5ce22(0x258)](_0x2bd241=>{var _0x12217d=_0xa5ce22;(parseInt(_0x2bd241[_0x12217d(0x2e1)])<parseInt(_0x2bd241[_0x12217d(0x2bd)])||parseInt(_0x2bd241[_0x12217d(0x1d8)])<parseInt(_0x2bd241[_0x12217d(0x2bd)]))&&_0x15c8d8++;});if(_0x15c8d8!=0x0)return _0x4c72bb[_0xa5ce22(0x251)](_0xa5ce22(0x2f0),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x473b97[_0xa5ce22(0x1d6)](_0xa5ce22(0x1ca));const _0x44c37d=new purchases_return_finished({'invoice':_0x37af4e,'suppliers':_0x4c72bb['body'][_0xa5ce22(0x254)],'date':_0x1cd758,'warehouse_name':_0x506b95,'return_product':_0x4a11ba,'note':_0x315c9b,'room':_0x258f84,'to_warehouse_name':_0x354f8d,'to_room':_0x22bbb5}),_0x5ae73c=await _0x44c37d[_0xa5ce22(0x224)](),_0x55f848=await purchases_return_finished[_0xa5ce22(0x2cb)]({'invoice':_0x37af4e}),_0x5a26ca=await warehouse[_0xa5ce22(0x2cb)]({'name':_0x354f8d,'room':_0x22bbb5,'warehouse_category':'Finished\x20Goods'});_0x55f848[_0xa5ce22(0x231)][_0xa5ce22(0x258)](_0x389b7d=>{var _0x3e2dd3=_0xa5ce22,_0x1aa6f7=0x0;const _0xb6b189=_0x5a26ca['product_details'][_0x3e2dd3(0x1da)](_0x3ec9bf=>{var _0x4fea45=_0x3e2dd3;console[_0x4fea45(0x295)](_0x3ec9bf[_0x4fea45(0x213)]+'=='+_0x389b7d[_0x4fea45(0x213)]+'&&'+_0x3ec9bf[_0x4fea45(0x2ee)]+'=='+_0x389b7d[_0x4fea45(0x2ee)]),_0x3ec9bf['product_name']==_0x389b7d['product_name']&&_0x3ec9bf[_0x4fea45(0x2ee)]==_0x389b7d[_0x4fea45(0x2ee)]&&(_0x3ec9bf['product_stock']=parseInt(_0x3ec9bf[_0x4fea45(0x229)])-parseInt(_0x389b7d[_0x4fea45(0x2bd)]),_0x1aa6f7++);});_0x1aa6f7=='0'&&(_0x5a26ca['product_details']=_0x5a26ca[_0x3e2dd3(0x26a)]['concat']({'product_name':_0x389b7d[_0x3e2dd3(0x213)],'product_stock':_0x389b7d[_0x3e2dd3(0x2bd)],'primary_code':_0x389b7d[_0x3e2dd3(0x233)],'secondary_code':_0x389b7d[_0x3e2dd3(0x1e1)],'product_code':_0x389b7d[_0x3e2dd3(0x1c1)],'bay':_0x389b7d[_0x3e2dd3(0x2ee)],'maxProducts':0xf423f}));}),await _0x5a26ca[_0xa5ce22(0x224)]();const _0x374763=await purchases_finished['findOne']({'invoice':_0x37af4e});_0x374763[_0xa5ce22(0x202)]=_0xa5ce22(0x1e6);const _0x4f0ae7=await _0x374763[_0xa5ce22(0x224)](),_0x91654a=new s_payment_data({'invoice':_0x37af4e,'suppliers':_0x4c72bb[_0xa5ce22(0x2a5)][_0xa5ce22(0x254)],'reason':_0xa5ce22(0x2b5)});await _0x91654a[_0xa5ce22(0x224)]();const _0x4c5f64=await master_shop['find'](),_0x5588d9=await email_settings[_0xa5ce22(0x2cb)](),_0x279670=await suppliers[_0xa5ce22(0x2cb)]({'name':_0x4c72bb[_0xa5ce22(0x2a5)]['suppliers']});_0x4c5f64[0x0][_0xa5ce22(0x2c4)]==0x1?(right_currency=_0x4c5f64[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4c5f64[0x0][_0xa5ce22(0x2c1)]);var _0x5b468c=_0x1695f7,_0x417be3=_0x53bcb9,_0x2cda7b='',_0x19f696;for(_0x19f696 in _0x5b468c){_0x2cda7b+=_0xa5ce22(0x216)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b468c[_0x19f696]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x417be3[_0x19f696]+_0xa5ce22(0x21d)+_0xa5ce22(0x2e7);}let _0x2ae8d1=nodemailer[_0xa5ce22(0x2b6)]({'service':_0xa5ce22(0x246),'auth':{'user':_0x5588d9[_0xa5ce22(0x285)],'pass':_0x5588d9[_0xa5ce22(0x22b)]}}),_0x48e005={'from':_0x5588d9['email'],'to':_0x279670['email'],'subject':_0xa5ce22(0x21c),'attachments':[{'filename':_0xa5ce22(0x1f0),'path':__dirname+'/../public'+'/upload/'+_0x4c5f64[0x0]['image'],'cid':'logo'}],'html':_0xa5ce22(0x2c8)+_0xa5ce22(0x1e9)+'</head><body>'+_0xa5ce22(0x2d6)+_0xa5ce22(0x2e0)+_0xa5ce22(0x2d6)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xa5ce22(0x1f8)+_0xa5ce22(0x2d6)+_0xa5ce22(0x279)+_0x4c5f64[0x0][_0xa5ce22(0x288)]+'\x20</h2>'+_0xa5ce22(0x1f8)+_0xa5ce22(0x1f8)+_0xa5ce22(0x210)+_0xa5ce22(0x2d6)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xa5ce22(0x1ed)+_0x37af4e+'\x20'+_0xa5ce22(0x2c2)+'\x20Order\x20Date\x20:\x20'+_0x1cd758+'\x20'+_0xa5ce22(0x250)+_0xa5ce22(0x27f)+_0xa5ce22(0x1f8)+_0xa5ce22(0x29b)+_0xa5ce22(0x242)+_0xa5ce22(0x216)+_0xa5ce22(0x2dd)+_0xa5ce22(0x220)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0xa5ce22(0x267)+'</tr>'+_0xa5ce22(0x1bd)+_0xa5ce22(0x2a7)+'\x20'+_0x2cda7b+'\x20'+_0xa5ce22(0x2da)+'</table>'+_0xa5ce22(0x2d6)+'<strong>\x20Regards\x20</strong>'+_0xa5ce22(0x1cc)+_0x4c5f64[0x0][_0xa5ce22(0x288)]+'</h5>'+_0xa5ce22(0x1f8)+_0xa5ce22(0x1f8)+_0xa5ce22(0x2b7)};_0x2ae8d1['sendMail'](_0x48e005,function(_0x159347,_0x42e446){var _0x247d46=_0xa5ce22;_0x159347?console[_0x247d46(0x295)](_0x247d46(0x22a)):console['log'](_0x247d46(0x1e7));}),_0x4c72bb[_0xa5ce22(0x251)](_0xa5ce22(0x1d3),_0xa5ce22(0x27d)),_0x473b97[_0xa5ce22(0x1d6)](_0xa5ce22(0x260));}catch(_0x494adc){_0x473b97['status'](0xc8)[_0xa5ce22(0x2b0)]({'message':_0x494adc['message']});}}),router[a0_0x41fc1a(0x29e)](a0_0x41fc1a(0x2ca),auth,async(_0x26823d,_0xa70164)=>{var _0x5b9cd9=a0_0x41fc1a;try{const {username:_0x1ded63,email:_0x394f35,role:_0x2979ad}=_0x26823d[_0x5b9cd9(0x24f)],_0x1e8f40=_0x26823d['user'],_0x2862de=await profile[_0x5b9cd9(0x2cb)]({'email':_0x1e8f40[_0x5b9cd9(0x285)]}),_0x440f86=await master_shop['find'](),_0x4b173f=_0x26823d[_0x5b9cd9(0x1db)]['id'],_0x186d8c=await purchases_finished[_0x5b9cd9(0x294)](_0x4b173f);if(_0x440f86[0x0][_0x5b9cd9(0x2ad)]==_0x5b9cd9(0x2ba))var _0x46c3e4=users['English'];else{if(_0x440f86[0x0][_0x5b9cd9(0x2ad)]==_0x5b9cd9(0x2c0))var _0x46c3e4=users[_0x5b9cd9(0x2c0)];else{if(_0x440f86[0x0]['language']=='German')var _0x46c3e4=users[_0x5b9cd9(0x2f1)];else{if(_0x440f86[0x0][_0x5b9cd9(0x2ad)]==_0x5b9cd9(0x283))var _0x46c3e4=users[_0x5b9cd9(0x283)];else{if(_0x440f86[0x0][_0x5b9cd9(0x2ad)]==_0x5b9cd9(0x2a3))var _0x46c3e4=users[_0x5b9cd9(0x2a3)];else{if(_0x440f86[0x0]['language']==_0x5b9cd9(0x1fa))var _0x46c3e4=users[_0x5b9cd9(0x2d8)];else{if(_0x440f86[0x0][_0x5b9cd9(0x2ad)]==_0x5b9cd9(0x218))var _0x46c3e4=users[_0x5b9cd9(0x218)];else{if(_0x440f86[0x0][_0x5b9cd9(0x2ad)]==_0x5b9cd9(0x2f3))var _0x46c3e4=users[_0x5b9cd9(0x234)];}}}}}}}_0xa70164['render'](_0x5b9cd9(0x271),{'success':_0x26823d[_0x5b9cd9(0x251)]('success'),'errors':_0x26823d[_0x5b9cd9(0x251)](_0x5b9cd9(0x2f0)),'role':_0x1e8f40,'profile':_0x2862de,'alldata':_0x186d8c,'master_shop':_0x440f86,'language':_0x46c3e4}),console[_0x5b9cd9(0x295)](alldata);}catch(_0x361da8){console[_0x5b9cd9(0x295)](_0x361da8);}}),router[a0_0x41fc1a(0x261)]('/barcode_scanner',async(_0x26465d,_0x5de0f4)=>{var _0x41aca8=a0_0x41fc1a;const {product_code:_0x1732ba}=_0x26465d[_0x41aca8(0x2a5)];var _0x2eeb89;const _0x4cbf8a=await product[_0x41aca8(0x29c)]([{'$match':{'primary_code':_0x1732ba}},{'$group':{'_id':_0x41aca8(0x2b3),'name':{'$first':_0x41aca8(0x1df)},'category':{'$first':'$category'},'brand':{'$first':_0x41aca8(0x1c6)},'unit':{'$first':_0x41aca8(0x228)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x41aca8(0x284)},'primary_code':{'$first':_0x41aca8(0x22c)},'secondary_code':{'$first':_0x41aca8(0x1ee)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x41aca8(0x25a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x41aca8(0x1e8)},'gross_price':{'$first':_0x41aca8(0x1f2)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x3da7b5=await product['aggregate']([{'$match':{'secondary_code':_0x1732ba}},{'$group':{'_id':'$_id','name':{'$first':_0x41aca8(0x1df)},'category':{'$first':_0x41aca8(0x24b)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x41aca8(0x1c2)},'product_code':{'$first':_0x41aca8(0x284)},'primary_code':{'$first':_0x41aca8(0x22c)},'secondary_code':{'$first':_0x41aca8(0x1ee)},'maxStocks':{'$first':_0x41aca8(0x1ef)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x41aca8(0x1f2)},'sales_category':{'$first':_0x41aca8(0x20d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x4cbf8a['length']>0x0)_0x2eeb89=_0x4cbf8a;else _0x3da7b5['length']>0x0&&(_0x2eeb89=_0x3da7b5);_0x5de0f4[_0x41aca8(0x2b0)](_0x2eeb89);}),router[a0_0x41fc1a(0x261)](a0_0x41fc1a(0x263),async(_0x223738,_0xa62da7)=>{var _0x4b6967=a0_0x41fc1a;const {productCode:_0x5f59b2,bay:_0x4ceacc,warehouses:_0x44d2c8,room:_0x2328cc}=_0x223738[_0x4b6967(0x2a5)];console[_0x4b6967(0x295)](_0x223738['body']);try{const _0x124049=await warehouse[_0x4b6967(0x29c)]([{'$match':{'name':_0x44d2c8,'room':_0x2328cc}},{'$unwind':_0x4b6967(0x2a9)},{'$match':{'product_details.bay':parseInt(_0x4ceacc)}},{'$group':{'_id':_0x4b6967(0x29d),'name':{'$first':_0x4b6967(0x1bf)},'product_stock':{'$first':_0x4b6967(0x1ec)},'bay':{'$first':_0x4b6967(0x241)},'maxProducts':{'$first':_0x4b6967(0x214)}}}]);_0xa62da7['status'](0xc8)['json'](_0x124049);}catch(_0x58cbe5){_0xa62da7['status'](0x194)['json']({'message':_0x58cbe5[_0x4b6967(0x2d5)]});}}),router[a0_0x41fc1a(0x261)](a0_0x41fc1a(0x21a),async(_0x17c233,_0x4bd06e)=>{var _0x41f01d=a0_0x41fc1a;const {product_code:_0x2b45fe}=_0x17c233[_0x41f01d(0x2a5)];var _0x54ecec;const _0x1b7ce=await product['aggregate']([{'$match':{'primary_code':_0x2b45fe,'type_products':'log'}},{'$group':{'_id':_0x41f01d(0x2b3),'name':{'$first':_0x41f01d(0x1df)},'category':{'$first':_0x41f01d(0x24b)},'brand':{'$first':_0x41f01d(0x1c6)},'unit':{'$first':_0x41f01d(0x228)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x41f01d(0x284)},'primary_code':{'$first':_0x41f01d(0x22c)},'secondary_code':{'$first':_0x41f01d(0x1ee)},'maxStocks':{'$first':_0x41f01d(0x1ef)},'maxProdPerUnit':{'$first':_0x41f01d(0x25a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x41f01d(0x1e8)},'gross_price':{'$first':_0x41f01d(0x1f2)},'sales_category':{'$first':_0x41f01d(0x20d)},'type_products':{'$first':_0x41f01d(0x2c6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x41f01d(0x295)](_0x1b7ce);const _0x46356e=await product[_0x41f01d(0x29c)]([{'$match':{'secondary_code':_0x2b45fe,'type_products':_0x41f01d(0x295)}},{'$group':{'_id':_0x41f01d(0x2b3),'name':{'$first':_0x41f01d(0x1df)},'category':{'$first':_0x41f01d(0x24b)},'brand':{'$first':'$brand'},'unit':{'$first':_0x41f01d(0x228)},'alertquantity':{'$first':_0x41f01d(0x1c2)},'product_code':{'$first':_0x41f01d(0x284)},'primary_code':{'$first':_0x41f01d(0x22c)},'secondary_code':{'$first':_0x41f01d(0x1ee)},'maxStocks':{'$first':_0x41f01d(0x1ef)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x41f01d(0x1e8)},'gross_price':{'$first':_0x41f01d(0x1f2)},'sales_category':{'$first':_0x41f01d(0x20d)},'type_products':{'$first':_0x41f01d(0x2c6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x1b7ce[_0x41f01d(0x2a2)]>0x0)_0x54ecec=_0x1b7ce;else _0x46356e[_0x41f01d(0x2a2)]>0x0&&(_0x54ecec=_0x46356e);_0x4bd06e[_0x41f01d(0x2b0)](_0x54ecec);}),module[a0_0x41fc1a(0x203)]=router;