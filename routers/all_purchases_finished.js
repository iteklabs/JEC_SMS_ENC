var a0_0x37d3eb=a0_0x253b;function a0_0x253b(_0x18ea82,_0x1b3e08){var _0x18bf37=a0_0x18bf();return a0_0x253b=function(_0x253b89,_0xe21a48){_0x253b89=_0x253b89-0x12d;var _0x1acae2=_0x18bf37[_0x253b89];return _0x1acae2;},a0_0x253b(_0x18ea82,_0x1b3e08);}(function(_0x811e8c,_0x3477df){var _0x1cb437=a0_0x253b,_0x2ebc12=_0x811e8c();while(!![]){try{var _0x342d44=-parseInt(_0x1cb437(0x26e))/0x1+parseInt(_0x1cb437(0x240))/0x2*(parseInt(_0x1cb437(0x200))/0x3)+parseInt(_0x1cb437(0x266))/0x4*(parseInt(_0x1cb437(0x1d0))/0x5)+parseInt(_0x1cb437(0x260))/0x6*(parseInt(_0x1cb437(0x26d))/0x7)+parseInt(_0x1cb437(0x1ba))/0x8+-parseInt(_0x1cb437(0x169))/0x9*(parseInt(_0x1cb437(0x239))/0xa)+parseInt(_0x1cb437(0x13b))/0xb;if(_0x342d44===_0x3477df)break;else _0x2ebc12['push'](_0x2ebc12['shift']());}catch(_0x2ceb79){_0x2ebc12['push'](_0x2ebc12['shift']());}}}(a0_0x18bf,0x48a4c));const express=require('express'),app=express(),router=express[a0_0x37d3eb(0x179)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x37d3eb(0x1b3)),auth=require(a0_0x37d3eb(0x1fd)),nodemailer=require(a0_0x37d3eb(0x15b));var ejs=require('ejs');const path=require(a0_0x37d3eb(0x238)),users=require(a0_0x37d3eb(0x167)),{isNull}=require('util');router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x20b),auth,async(_0x3dfa51,_0x39330d)=>{var _0x347391=a0_0x37d3eb;try{const {username:_0x3a2f01,email:_0x38f1a2,role:_0x132519}=_0x3dfa51[_0x347391(0x1ab)],_0x3e4f24=_0x3dfa51['user'],_0x1b7430=await profile['findOne']({'email':_0x3e4f24['email']}),_0x3c54cf=await staff[_0x347391(0x197)]({'email':_0x3e4f24[_0x347391(0x24b)]}),_0x381ec9=await master_shop['find']();let _0x12e787=await transfers_finished[_0x347391(0x19f)]([{'$match':{'to_warehouse':_0x3c54cf[_0x347391(0x1ce)]}}]);if(_0x381ec9[0x0][_0x347391(0x227)]==_0x347391(0x1e9))var _0x15c81d=users[_0x347391(0x16a)];else{if(_0x381ec9[0x0][_0x347391(0x227)]==_0x347391(0x16d))var _0x15c81d=users[_0x347391(0x16d)];else{if(_0x381ec9[0x0]['language']==_0x347391(0x1bf))var _0x15c81d=users['German'];else{if(_0x381ec9[0x0][_0x347391(0x227)]==_0x347391(0x142))var _0x15c81d=users['Spanish'];else{if(_0x381ec9[0x0][_0x347391(0x227)]=='French')var _0x15c81d=users[_0x347391(0x1f1)];else{if(_0x381ec9[0x0]['language']==_0x347391(0x258))var _0x15c81d=users['Portuguese'];else{if(_0x381ec9[0x0][_0x347391(0x227)]==_0x347391(0x25c))var _0x15c81d=users[_0x347391(0x25c)];else{if(_0x381ec9[0x0]['language']=='Arabic\x20(ae)')var _0x15c81d=users[_0x347391(0x1eb)];}}}}}}}_0x39330d['render'](_0x347391(0x1cd),{'success':_0x3dfa51[_0x347391(0x265)](_0x347391(0x1c8)),'errors':_0x3dfa51['flash'](_0x347391(0x149)),'purchases':_0x12e787,'role':_0x3e4f24,'profile':_0x1b7430,'master_shop':_0x381ec9,'language':_0x15c81d,'staff_data':_0x3c54cf});}catch(_0x3bcc76){console['log'](_0x347391(0x198),_0x3bcc76),_0x39330d['status'](0xc8)[_0x347391(0x12e)]({'message':_0x3bcc76[_0x347391(0x1c6)]});}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x1cc),auth,async(_0x29ba78,_0x105fac)=>{var _0x5f4436=a0_0x37d3eb;try{const {username:_0x59d582,email:_0x1761ee,role:_0x4e3ca7}=_0x29ba78['user'],_0x2dadb5=_0x29ba78[_0x5f4436(0x1ab)],_0x418dda=await profile[_0x5f4436(0x197)]({'email':_0x2dadb5[_0x5f4436(0x24b)]}),_0x451098=await staff[_0x5f4436(0x197)]({'email':_0x2dadb5[_0x5f4436(0x24b)]}),_0x1e3e07=await master_shop['find']();let _0x41d8b9=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x451098[_0x5f4436(0x1ce)],'to_recieved':'false'}}]);if(_0x1e3e07[0x0][_0x5f4436(0x227)]==_0x5f4436(0x1e9))var _0x355751=users[_0x5f4436(0x16a)];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]==_0x5f4436(0x16d))var _0x355751=users['Hindi'];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]==_0x5f4436(0x1bf))var _0x355751=users[_0x5f4436(0x1bf)];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]==_0x5f4436(0x142))var _0x355751=users[_0x5f4436(0x142)];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]=='French')var _0x355751=users[_0x5f4436(0x1f1)];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]=='Portuguese\x20(BR)')var _0x355751=users[_0x5f4436(0x1de)];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]==_0x5f4436(0x25c))var _0x355751=users[_0x5f4436(0x25c)];else{if(_0x1e3e07[0x0][_0x5f4436(0x227)]=='Arabic\x20(ae)')var _0x355751=users[_0x5f4436(0x1eb)];}}}}}}}_0x105fac['render']('incoming_add',{'success':_0x29ba78['flash'](_0x5f4436(0x1c8)),'errors':_0x29ba78[_0x5f4436(0x265)](_0x5f4436(0x149)),'purchases':_0x41d8b9,'role':_0x2dadb5,'profile':_0x418dda,'master_shop':_0x1e3e07,'language':_0x355751,'staff_data':_0x451098});}catch(_0x55250f){console[_0x5f4436(0x17b)](_0x5f4436(0x198),_0x55250f),_0x105fac[_0x5f4436(0x156)](0xc8)['json']({'message':_0x55250f['message']});}});const createLog=async _0x17a0f7=>{var _0x1b2649=a0_0x37d3eb;const _0x2d91f7=new datalogs({'location':_0x17a0f7});return await _0x2d91f7['save'](),_0x2d91f7[_0x1b2649(0x17f)];};router['post'](a0_0x37d3eb(0x1cc),auth,async(_0x575cfa,_0x348f6e)=>{var _0xc2b838=a0_0x37d3eb;try{const {invoice_trf_data:_0x1903ec,item_code:_0x1bb338,SCRN:_0x7324a2,ReqBy:_0x5ca20a,type_of_products:_0x3c78db,dateofreq:_0x2b38f5,PO_number:_0x49dcc3,date:_0xcc3232,warehouse_name:_0x5c2556,typeservicesData:_0x48a52b,typevehicle:_0x5519c4,driver:_0x4bf032,plate:_0xc08942,van:_0x11e680,DRSI:_0x3e8988,TSU:_0x41be28,TFU:_0x399da5,note:_0x348bb2}=_0x575cfa[_0xc2b838(0x1db)],_0x2ef859=await transfers_finished['findById'](_0x1903ec);if(typeof _0x1bb338==_0xc2b838(0x1c7))var _0x300a35=[_0x575cfa['body']['product_name']],_0x335de4=[_0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x27e)]],_0x5c65f7=[_0x575cfa['body']['to_quantity']],_0x36be93=[_0x575cfa['body'][_0xc2b838(0x143)]],_0x27c07a=[_0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x215)]],_0x4117ee=[_0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x160)]],_0x9b111c=[_0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x23d)]],_0x5215e6=[_0x575cfa[_0xc2b838(0x1db)]['secondary_code']],_0x1925ee=[_0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x23c)]],_0x25982f=[_0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x205)]],_0x58b0d8=[_0x575cfa['body'][_0xc2b838(0x21c)]],_0x13883e=[_0x575cfa['body'][_0xc2b838(0x1a7)]],_0x1e5285=[_0x575cfa['body'][_0xc2b838(0x191)]];else var _0x300a35=[..._0x575cfa['body'][_0xc2b838(0x1d7)]],_0x335de4=[..._0x575cfa[_0xc2b838(0x1db)]['item_code']],_0x5c65f7=[..._0x575cfa['body'][_0xc2b838(0x195)]],_0x36be93=[..._0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x143)]],_0x27c07a=[..._0x575cfa[_0xc2b838(0x1db)]['prod_secondunit']],_0x4117ee=[..._0x575cfa[_0xc2b838(0x1db)]['bin']],_0x9b111c=[..._0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x23d)]],_0x5215e6=[..._0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x18a)]],_0x1925ee=[..._0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x23c)]],_0x25982f=[..._0x575cfa[_0xc2b838(0x1db)]['expiry_date']],_0x58b0d8=[..._0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x21c)]],_0x13883e=[..._0x575cfa[_0xc2b838(0x1db)]['max_product_unit']],_0x1e5285=[..._0x575cfa[_0xc2b838(0x1db)][_0xc2b838(0x191)]];const _0x3e5235=_0x300a35[_0xc2b838(0x1a8)](_0x1049ef=>{return _0x1049ef={'product_name':_0x1049ef};});_0x335de4[_0xc2b838(0x235)]((_0xab7aad,_0x3f5756)=>{_0x3e5235[_0x3f5756]['product_code']=_0xab7aad;}),_0x5c65f7[_0xc2b838(0x235)]((_0x2fd680,_0x133428)=>{_0x3e5235[_0x133428]['quantity']=Math['abs'](_0x2fd680);}),_0x36be93[_0xc2b838(0x235)]((_0x1076bc,_0x3481fb)=>{_0x3e5235[_0x3481fb]['standard_unit']=_0x1076bc;}),_0x27c07a[_0xc2b838(0x235)]((_0xa5d64d,_0x426167)=>{var _0x4c636a=_0xc2b838;_0x3e5235[_0x426167][_0x4c636a(0x1b6)]=_0xa5d64d;}),_0x4117ee[_0xc2b838(0x235)]((_0x225ac8,_0x6ab6dd)=>{var _0x21e81c=_0xc2b838,_0xa2fc82=_0x225ac8[_0x21e81c(0x18d)](/[A-Za-z]+/)[0x0],_0x2ccc4e=parseInt(_0x225ac8['match'](/\d+/)[0x0]);_0x3e5235[_0x6ab6dd][_0x21e81c(0x192)]=_0xa2fc82,_0x3e5235[_0x6ab6dd][_0x21e81c(0x1b7)]=_0x2ccc4e;}),_0x9b111c[_0xc2b838(0x235)]((_0x29acd3,_0x56ba4d)=>{var _0x174ee0=_0xc2b838;_0x3e5235[_0x56ba4d][_0x174ee0(0x23d)]=_0x29acd3;}),_0x5215e6['forEach']((_0x1ff0d3,_0x26ccd0)=>{_0x3e5235[_0x26ccd0]['secondary_code']=_0x1ff0d3;}),_0x1925ee[_0xc2b838(0x235)]((_0x318694,_0x4f7825)=>{var _0x5c60ef=_0xc2b838;_0x3e5235[_0x4f7825][_0x5c60ef(0x23c)]=_0x318694;}),_0x25982f[_0xc2b838(0x235)]((_0x3ec921,_0x43f344)=>{var _0x1e94d6=_0xc2b838;_0x3e5235[_0x43f344][_0x1e94d6(0x205)]=_0x3ec921;}),_0x58b0d8[_0xc2b838(0x235)]((_0x31d129,_0x4b3dee)=>{var _0x156370=_0xc2b838;_0x3e5235[_0x4b3dee][_0x156370(0x21c)]=_0x31d129;}),_0x13883e['forEach']((_0x316a35,_0x6beaf1)=>{var _0x719242=_0xc2b838;_0x3e5235[_0x6beaf1][_0x719242(0x1f2)]=_0x316a35;}),_0x1e5285[_0xc2b838(0x235)]((_0x3711e8,_0x21cb78)=>{var _0x37aa12=_0xc2b838;_0x3e5235[_0x21cb78][_0x37aa12(0x173)]=_0x3711e8;});const _0x445ca0=await createLog(_0xc2b838(0x14b));_0x1e5285[_0xc2b838(0x235)]((_0x54905a,_0x5eb434)=>{var _0x50974f=_0xc2b838;_0x3e5235[_0x5eb434][_0x50974f(0x18e)]=_0x50974f(0x19e)+_0x445ca0[_0x50974f(0x16f)]()[_0x50974f(0x175)](0x8,'0');});const _0x13640d=_0x3e5235[_0xc2b838(0x1cf)](_0x9e5114=>_0x9e5114['quantity']!=='0'&&_0x9e5114[_0xc2b838(0x174)]!==''),_0x971308=new purchases_incoming({'invoice':_0xc2b838(0x19e)+_0x445ca0[_0xc2b838(0x16f)]()['padStart'](0x8,'0'),'date':_0xcc3232,'warehouse_name':_0x5c2556,'product':_0x13640d,'note':_0x348bb2,'POnumber':_0x49dcc3,'SCRN':_0x7324a2,'ReqBy':_0x5ca20a,'dateofreq':_0x2b38f5,'typeservicesData':_0x48a52b,'van':_0x11e680,'typevehicle':_0x5519c4,'driver':_0x4bf032,'plate':_0xc08942,'DRSI':_0x3e8988,'TSU':_0x41be28,'TFU':_0x399da5,'typeOfProducts':_0x3c78db}),_0x5ea82a=await _0x971308[_0xc2b838(0x226)](),_0x36b29d=_0x5ea82a[_0xc2b838(0x159)][_0xc2b838(0x1a8)](async _0x447799=>{var _0x495ecc=_0xc2b838,_0x26dd04=await warehouse['findOne']({'name':_0x5c2556,'room':_0x447799[_0x495ecc(0x173)]});if(_0x447799[_0x495ecc(0x174)]>0x0){var _0x5e787b=0x0;const _0x3e3238=_0x26dd04[_0x495ecc(0x19d)][_0x495ecc(0x1a8)](_0x40002d=>{var _0x16b2fb=_0x495ecc;_0x40002d['product_name']==_0x447799['product_name']&&_0x40002d[_0x16b2fb(0x1b7)]==_0x447799['to_bay']&&_0x40002d[_0x16b2fb(0x205)]==_0x447799['expiry_date']&&_0x40002d[_0x16b2fb(0x21c)]==_0x447799[_0x16b2fb(0x21c)]&&_0x40002d[_0x16b2fb(0x23c)]==_0x447799[_0x16b2fb(0x23c)]&&_0x40002d[_0x16b2fb(0x18e)]==_0x447799[_0x16b2fb(0x18e)]&&(typeof _0x447799[_0x16b2fb(0x1ed)]==_0x16b2fb(0x16c)?(console['log']('here2',_0x40002d[_0x16b2fb(0x189)]+_0x16b2fb(0x1d6)+_0x40002d[_0x16b2fb(0x136)]+_0x16b2fb(0x1ac)+Math['abs'](_0x40002d[_0x16b2fb(0x189)])+Math['abs'](_0x447799[_0x16b2fb(0x195)])),_0x40002d[_0x16b2fb(0x189)]=Math[_0x16b2fb(0x15c)](_0x40002d['product_stock'])+Math[_0x16b2fb(0x15c)](_0x447799[_0x16b2fb(0x174)])):(_0x40002d[_0x16b2fb(0x189)]=Math['abs'](_0x40002d[_0x16b2fb(0x189)])+Math['abs'](_0x447799[_0x16b2fb(0x174)]),_0x5e787b++));});_0x5e787b=='0'&&(_0x26dd04[_0x495ecc(0x19d)]=_0x26dd04[_0x495ecc(0x19d)][_0x495ecc(0x157)]({'product_name':_0x447799[_0x495ecc(0x1d7)],'product_stock':_0x447799[_0x495ecc(0x174)],'bay':_0x447799['bay'],'level':_0x447799[_0x495ecc(0x192)],'product_code':_0x447799[_0x495ecc(0x247)],'primary_code':_0x447799[_0x495ecc(0x23d)],'secondary_code':_0x447799[_0x495ecc(0x18a)],'expiry_date':_0x447799[_0x495ecc(0x205)],'production_date':_0x447799[_0x495ecc(0x21c)],'maxProducts':_0x447799['maxProducts'],'batch_code':_0x447799[_0x495ecc(0x23c)],'secondary_unit':_0x447799[_0x495ecc(0x1b6)],'unit':_0x447799[_0x495ecc(0x190)],'maxProducts':_0x447799[_0x495ecc(0x1fa)],'maxPerUnit':_0x447799[_0x495ecc(0x130)],'invoice':_0x447799[_0x495ecc(0x18e)]}));}return _0x26dd04;});Promise['all'](_0x36b29d)[_0xc2b838(0x148)](async _0x44d5c4=>{var _0x1a96d9=_0xc2b838;try{for(const _0x56fc9f of _0x44d5c4){await warehouse[_0x1a96d9(0x1d5)]({'_id':_0x56fc9f[_0x1a96d9(0x136)]},{'$addToSet':{'product_details':{'$each':_0x56fc9f[_0x1a96d9(0x19d)]}}});}_0x2ef859[_0x1a96d9(0x25a)]='true';const _0x51955b=await _0x2ef859['save'](),_0x41bc05=await master_shop[_0x1a96d9(0x1d3)](),_0x13c0d2=await email_settings[_0x1a96d9(0x197)](),_0x1c28e7=await supervisor_settings[_0x1a96d9(0x1d3)]();var _0x38b4c3=_0x971308[_0x1a96d9(0x159)],_0x558781='',_0x4688b0;for(_0x4688b0 in _0x38b4c3){var _0x3e9fc3='FG';_0x971308[_0x1a96d9(0x21d)]==_0x1a96d9(0x146)&&(_0x3e9fc3='DG'),_0x558781+=_0x1a96d9(0x182)+_0x1a96d9(0x12d)+_0x38b4c3[_0x4688b0][_0x1a96d9(0x1d7)]+_0x1a96d9(0x23e)+_0x1a96d9(0x12d)+_0x38b4c3[_0x4688b0][_0x1a96d9(0x247)]+_0x1a96d9(0x23e)+_0x1a96d9(0x12d)+_0x38b4c3[_0x4688b0]['to_quantity']+_0x1a96d9(0x23e)+_0x1a96d9(0x12d)+_0x38b4c3[_0x4688b0][_0x1a96d9(0x143)]+_0x1a96d9(0x23e)+_0x1a96d9(0x12d)+_0x38b4c3[_0x4688b0][_0x1a96d9(0x1b6)]+_0x1a96d9(0x23e)+_0x1a96d9(0x12d)+_0x971308[_0x1a96d9(0x21d)]+_0x1a96d9(0x23e)+_0x1a96d9(0x12d)+_0x38b4c3[_0x4688b0][_0x1a96d9(0x183)]+_0x1a96d9(0x23e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e9fc3+_0x38b4c3[_0x4688b0][_0x1a96d9(0x251)]+_0x1a96d9(0x23e)+_0x1a96d9(0x18c);}_0x575cfa['flash'](_0x1a96d9(0x1c8),'Transfer\x20Finalize\x20Successfully'),_0x348f6e['redirect']('/picking_list/pdf_puchases_fin_own_trf/'+_0x5ea82a[_0x1a96d9(0x136)]);}catch(_0x526ca5){console[_0x1a96d9(0x27a)](_0x526ca5),_0x348f6e['status'](0x1f4)[_0x1a96d9(0x12e)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0xc2b838(0x137)](_0x482960=>{var _0xeca13a=_0xc2b838;console[_0xeca13a(0x27a)](_0x482960),_0x348f6e['status'](0x1f4)[_0xeca13a(0x12e)]({'error':_0xeca13a(0x1dd)});});}catch(_0xd1e1e5){}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x1cb),auth,async(_0x256307,_0x2eac92)=>{var _0x5eb5af=a0_0x37d3eb;try{const {warehouse:_0x177237}=_0x256307[_0x5eb5af(0x1db)],_0x2d251c=await transfers_finished[_0x5eb5af(0x1d3)]({'to_warehouse':_0x177237,'to_recieved':'false'});_0x2eac92[_0x5eb5af(0x12e)](_0x2d251c);}catch(_0x22ce50){}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x1bd),auth,async(_0x2ad256,_0x19175b)=>{var _0x5ad990=a0_0x37d3eb;try{const {invoice:_0x1200c1}=_0x2ad256['body'],_0x3ce7ff=await transfers_finished[_0x5ad990(0x1d3)]({'_id':_0x1200c1,'to_recieved':_0x5ad990(0x196)});_0x19175b['json'](_0x3ce7ff);}catch(_0x5a9fc0){}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x1ae),auth,async(_0x32b193,_0x13ef25)=>{var _0x2cb8ea=a0_0x37d3eb;try{const {username:_0x2f142b,email:_0x2c74b3,role:_0x4c13f5}=_0x32b193[_0x2cb8ea(0x1ab)],_0x295409=_0x32b193['user'],_0x11b325=await profile[_0x2cb8ea(0x197)]({'email':_0x295409['email']}),_0x2920dd=await staff['findOne']({'email':_0x295409[_0x2cb8ea(0x24b)]});if(_0x295409[_0x2cb8ea(0x14c)]==_0x2cb8ea(0x14f)){const _0x26bff2=await staff[_0x2cb8ea(0x197)]({'email':_0x295409[_0x2cb8ea(0x24b)]});}const _0x232d17=await master_shop[_0x2cb8ea(0x1d3)]();let _0x3018ae;if(_0x295409[_0x2cb8ea(0x14c)]==_0x2cb8ea(0x14f)){const _0x2d08ab=await staff[_0x2cb8ea(0x197)]({'email':_0x295409[_0x2cb8ea(0x24b)]});_0x3018ae=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2d08ab[_0x2cb8ea(0x1ce)],'typeOfProducts':_0x2cb8ea(0x1ef)}},{'$lookup':{'from':_0x2cb8ea(0x1e1),'localField':_0x2cb8ea(0x1e1),'foreignField':_0x2cb8ea(0x172),'as':_0x2cb8ea(0x271)}},{'$unwind':_0x2cb8ea(0x229)},{'$unwind':'$product'},{'$group':{'_id':_0x2cb8ea(0x254),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2cb8ea(0x223)},'warehouse_name':{'$first':_0x2cb8ea(0x1d4)},'room':{'$first':'$room'},'product':{'$push':_0x2cb8ea(0x155)},'note':{'$first':_0x2cb8ea(0x1e8)},'paid_amount':{'$first':_0x2cb8ea(0x14d)},'due_amount':{'$first':_0x2cb8ea(0x14e)},'return_data':{'$first':_0x2cb8ea(0x232)},'batch_code':{'$first':_0x2cb8ea(0x184)},'expiry_date':{'$first':_0x2cb8ea(0x23a)},'suppliers_docs':{'$first':_0x2cb8ea(0x229)},'total_product_quantity':{'$sum':_0x2cb8ea(0x1e6)},'level':{'$addToSet':_0x2cb8ea(0x201)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2cb8ea(0x141)},'floorlevel':{'$addToSet':_0x2cb8ea(0x1e7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3018ae=await purchases_finished[_0x2cb8ea(0x19f)]([{'$match':{'typeOfProducts':_0x2cb8ea(0x1ef)}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2cb8ea(0x20f)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2cb8ea(0x1d4)},'room':{'$addToSet':_0x2cb8ea(0x1ad)},'product':{'$push':_0x2cb8ea(0x155)},'note':{'$first':_0x2cb8ea(0x1e8)},'paid_amount':{'$first':_0x2cb8ea(0x14d)},'due_amount':{'$first':_0x2cb8ea(0x14e)},'return_data':{'$first':_0x2cb8ea(0x232)},'batch_code':{'$first':_0x2cb8ea(0x184)},'expiry_date':{'$first':_0x2cb8ea(0x23a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x2cb8ea(0x1e6)},'level':{'$addToSet':_0x2cb8ea(0x201)},'isle':{'$addToSet':_0x2cb8ea(0x207)},'type':{'$addToSet':_0x2cb8ea(0x141)},'floorlevel':{'$addToSet':_0x2cb8ea(0x1e7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x232d17[0x0][_0x2cb8ea(0x227)]==_0x2cb8ea(0x1e9))var _0x15eea8=users[_0x2cb8ea(0x16a)];else{if(_0x232d17[0x0][_0x2cb8ea(0x227)]==_0x2cb8ea(0x16d))var _0x15eea8=users[_0x2cb8ea(0x16d)];else{if(_0x232d17[0x0][_0x2cb8ea(0x227)]=='German')var _0x15eea8=users[_0x2cb8ea(0x1bf)];else{if(_0x232d17[0x0][_0x2cb8ea(0x227)]==_0x2cb8ea(0x142))var _0x15eea8=users['Spanish'];else{if(_0x232d17[0x0][_0x2cb8ea(0x227)]=='French')var _0x15eea8=users[_0x2cb8ea(0x1f1)];else{if(_0x232d17[0x0][_0x2cb8ea(0x227)]==_0x2cb8ea(0x258))var _0x15eea8=users['Portuguese'];else{if(_0x232d17[0x0]['language']=='Chinese')var _0x15eea8=users['Chinese'];else{if(_0x232d17[0x0][_0x2cb8ea(0x227)]=='Arabic\x20(ae)')var _0x15eea8=users[_0x2cb8ea(0x1eb)];}}}}}}}_0x13ef25[_0x2cb8ea(0x166)](_0x2cb8ea(0x233),{'success':_0x32b193[_0x2cb8ea(0x265)](_0x2cb8ea(0x1c8)),'errors':_0x32b193[_0x2cb8ea(0x265)]('errors'),'purchases':_0x3018ae,'role':_0x295409,'profile':_0x11b325,'master_shop':_0x232d17,'language':_0x15eea8});}catch(_0x26cd5b){console[_0x2cb8ea(0x17b)]('table\x20page',_0x26cd5b),_0x13ef25[_0x2cb8ea(0x156)](0xc8)['json']({'message':_0x26cd5b['message']});}}),router['get'](a0_0x37d3eb(0x131),auth,async(_0xfba62d,_0x1a5b7d)=>{var _0x2517ea=a0_0x37d3eb;try{const {username:_0x327af6,email:_0x432ab9,role:_0x30bf63}=_0xfba62d['user'],_0xdd3a2=_0xfba62d[_0x2517ea(0x1ab)],_0x3c0fc4=await profile[_0x2517ea(0x197)]({'email':_0xdd3a2[_0x2517ea(0x24b)]}),_0x50fd33=await staff['findOne']({'email':_0xdd3a2[_0x2517ea(0x24b)]});if(_0xdd3a2[_0x2517ea(0x14c)]==_0x2517ea(0x14f)){const _0xd858e0=await staff['findOne']({'email':_0xdd3a2[_0x2517ea(0x24b)]});}const _0x3696bf=await master_shop[_0x2517ea(0x1d3)]();let _0x29bcb4;if(_0xdd3a2[_0x2517ea(0x14c)]==_0x2517ea(0x14f)){const _0x7ebf39=await staff[_0x2517ea(0x197)]({'email':_0xdd3a2[_0x2517ea(0x24b)]});_0x29bcb4=await purchases_finished[_0x2517ea(0x19f)]([{'$match':{'warehouse_name':_0x7ebf39[_0x2517ea(0x1ce)]}},{'$lookup':{'from':_0x2517ea(0x1e1),'localField':_0x2517ea(0x1e1),'foreignField':_0x2517ea(0x172),'as':_0x2517ea(0x271)}},{'$unwind':_0x2517ea(0x229)},{'$unwind':'$product'},{'$group':{'_id':_0x2517ea(0x254),'invoice':{'$first':_0x2517ea(0x20f)},'suppliers':{'$first':_0x2517ea(0x193)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2517ea(0x1d4)},'room':{'$first':_0x2517ea(0x214)},'product':{'$push':_0x2517ea(0x155)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2517ea(0x14d)},'due_amount':{'$first':_0x2517ea(0x14e)},'return_data':{'$first':_0x2517ea(0x232)},'batch_code':{'$first':_0x2517ea(0x184)},'expiry_date':{'$first':_0x2517ea(0x23a)},'suppliers_docs':{'$first':_0x2517ea(0x229)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2517ea(0x201)},'isle':{'$addToSet':_0x2517ea(0x207)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2517ea(0x1e7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x29bcb4=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x2517ea(0x155)},{'$group':{'_id':_0x2517ea(0x254),'invoice':{'$first':_0x2517ea(0x20f)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2517ea(0x223)},'warehouse_name':{'$first':_0x2517ea(0x1d4)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x2517ea(0x155)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2517ea(0x14e)},'return_data':{'$first':_0x2517ea(0x232)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2517ea(0x23a)},'suppliers_docs':{'$first':_0x2517ea(0x229)},'total_product_quantity':{'$sum':_0x2517ea(0x1e6)},'level':{'$addToSet':_0x2517ea(0x201)},'isle':{'$addToSet':_0x2517ea(0x207)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2517ea(0x1e7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3696bf[0x0]['language']==_0x2517ea(0x1e9))var _0x23fe62=users[_0x2517ea(0x16a)];else{if(_0x3696bf[0x0][_0x2517ea(0x227)]==_0x2517ea(0x16d))var _0x23fe62=users['Hindi'];else{if(_0x3696bf[0x0][_0x2517ea(0x227)]=='German')var _0x23fe62=users['German'];else{if(_0x3696bf[0x0]['language']=='Spanish')var _0x23fe62=users[_0x2517ea(0x142)];else{if(_0x3696bf[0x0][_0x2517ea(0x227)]==_0x2517ea(0x1f1))var _0x23fe62=users[_0x2517ea(0x1f1)];else{if(_0x3696bf[0x0]['language']==_0x2517ea(0x258))var _0x23fe62=users[_0x2517ea(0x1de)];else{if(_0x3696bf[0x0][_0x2517ea(0x227)]==_0x2517ea(0x25c))var _0x23fe62=users[_0x2517ea(0x25c)];else{if(_0x3696bf[0x0][_0x2517ea(0x227)]==_0x2517ea(0x213))var _0x23fe62=users['Arabic'];}}}}}}}_0x1a5b7d[_0x2517ea(0x166)]('all_purchases_finished_logs',{'success':_0xfba62d[_0x2517ea(0x265)](_0x2517ea(0x1c8)),'errors':_0xfba62d['flash'](_0x2517ea(0x149)),'purchases':_0x29bcb4,'role':_0xdd3a2,'profile':_0x3c0fc4,'master_shop':_0x3696bf,'language':_0x23fe62});}catch(_0x3e4401){console[_0x2517ea(0x17b)](_0x2517ea(0x198),_0x3e4401),_0x1a5b7d[_0x2517ea(0x156)](0xc8)['json']({'message':_0x3e4401['message']});}});function BayBinSelected(_0x28e157,_0x5dc85d){var _0x1972f7=a0_0x37d3eb,_0x52f07d=[],_0xd6d932=[];if(_0x28e157=='DRY\x20GOODS'){switch(_0x5dc85d){case'Rack\x201':_0x52f07d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1972f7(0x133):_0x52f07d=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xd6d932=['DG'];}else{if(_0x28e157==_0x1972f7(0x25e)){switch(_0x5dc85d){case _0x1972f7(0x1da):_0x52f07d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1972f7(0x133):_0x52f07d=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xd6d932=['FG'];}}return{'levels':_0x52f07d,'identify':_0xd6d932};}async function getRandom8DigitNumber(){var _0x23971c=a0_0x37d3eb;const _0x24fedc=0x989680,_0x3d9546=0x5f5e0ff,_0x1b8994=Math[_0x23971c(0x1b8)](Math[_0x23971c(0x270)]()*(_0x3d9546-_0x24fedc+0x1))+_0x24fedc;var _0x5cbabb;const _0x40c138=await purchases_finished[_0x23971c(0x197)]({'invoice':_0x23971c(0x18f)+_0x1b8994});return _0x40c138&&_0x40c138[_0x23971c(0x24d)]>0x0?_0x5cbabb=_0x23971c(0x18f)+_0x1b8994:_0x5cbabb=_0x23971c(0x18f)+_0x1b8994,_0x5cbabb;}router[a0_0x37d3eb(0x218)]('/view/add_purchases',auth,async(_0x575546,_0x161015)=>{var _0x216147=a0_0x37d3eb;try{const {username:_0x382b26,email:_0x1444be,role:_0x52b115}=_0x575546[_0x216147(0x1ab)],_0x31be37=_0x575546[_0x216147(0x1ab)],_0x1c690a=await profile[_0x216147(0x197)]({'email':_0x31be37['email']}),_0x1895ba=await master_shop[_0x216147(0x1d3)](),_0x5dde10=await staff[_0x216147(0x197)]({'email':_0x31be37['email']}),_0x3ece28=await suppliers[_0x216147(0x1d3)]({});let _0x45237f;if(_0x31be37[_0x216147(0x14c)]=='staff'){const _0xc21b5e=await staff[_0x216147(0x197)]({'email':_0x31be37[_0x216147(0x24b)]});_0x45237f=await warehouse[_0x216147(0x19f)]([{'$match':{'status':_0x216147(0x19a),'name':_0xc21b5e[_0x216147(0x1ce)]}},{'$group':{'_id':_0x216147(0x25f),'name':{'$first':_0x216147(0x25f)}}}]);}else _0x45237f=await warehouse[_0x216147(0x19f)]([{'$match':{'status':_0x216147(0x19a)}},{'$group':{'_id':_0x216147(0x25f),'name':{'$first':_0x216147(0x25f)}}}]);const _0x63c527=await product['find']({}),_0x31a049=await warehouse[_0x216147(0x1d3)]({'status':_0x216147(0x19a)}),_0x3a1066=await purchases_finished[_0x216147(0x1d3)]({}),_0x2d7684=_0x3a1066[_0x216147(0x24d)]+0x1,_0x38dfd2='INCF-'+_0x2d7684['toString']()[_0x216147(0x175)](0x5,'0');var _0x4bce15=[_0x216147(0x22b),_0x216147(0x272)];if(_0x1895ba[0x0][_0x216147(0x227)]==_0x216147(0x1e9))var _0x5d5483=users[_0x216147(0x16a)];else{if(_0x1895ba[0x0][_0x216147(0x227)]=='Hindi')var _0x5d5483=users[_0x216147(0x16d)];else{if(_0x1895ba[0x0]['language']==_0x216147(0x1bf))var _0x5d5483=users[_0x216147(0x1bf)];else{if(_0x1895ba[0x0][_0x216147(0x227)]==_0x216147(0x142))var _0x5d5483=users[_0x216147(0x142)];else{if(_0x1895ba[0x0]['language']==_0x216147(0x1f1))var _0x5d5483=users[_0x216147(0x1f1)];else{if(_0x1895ba[0x0][_0x216147(0x227)]==_0x216147(0x258))var _0x5d5483=users[_0x216147(0x1de)];else{if(_0x1895ba[0x0]['language']==_0x216147(0x25c))var _0x5d5483=users[_0x216147(0x25c)];else{if(_0x1895ba[0x0][_0x216147(0x227)]==_0x216147(0x213))var _0x5d5483=users[_0x216147(0x1eb)];}}}}}}}const _0x5e9fe4=getRandom8DigitNumber(),_0x5b777b=new Date(),_0x19670d={'year':_0x216147(0x24a),'month':_0x216147(0x22d),'day':_0x216147(0x22d),'timeZone':_0x216147(0x21b)},_0x38e838=_0x5b777b[_0x216147(0x275)](_0x216147(0x147),_0x19670d);console[_0x216147(0x17b)](_0x38e838),_0x5e9fe4['then'](_0x249cc1=>{var _0x4b137f=_0x216147;_0x161015['render'](_0x4b137f(0x21a),{'success':_0x575546['flash'](_0x4b137f(0x1c8)),'errors':_0x575546[_0x4b137f(0x265)](_0x4b137f(0x149)),'role':_0x31be37,'profile':_0x1c690a,'suppliers':_0x3ece28,'warehouse':_0x45237f,'product':_0x63c527,'invoice':_0x249cc1,'master_shop':_0x1895ba,'language':_0x5d5483,'find_data':_0x31a049,'rooms_data':_0x4bce15,'formattedDate':_0x38e838});})[_0x216147(0x137)](_0x4225c2=>{var _0x2fe829=_0x216147;_0x575546[_0x2fe829(0x265)](_0x2fe829(0x149),_0x2fe829(0x203)),_0x161015[_0x2fe829(0x17c)]('/all_purchases_finished/view');});}catch(_0x2a5d1d){console[_0x216147(0x17b)](_0x2a5d1d);}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x25d),auth,async(_0x1bd0d5,_0xbdf7de)=>{var _0x68dfe6=a0_0x37d3eb;try{const {username:_0xca8f6d,email:_0x43728f,role:_0x352c5b}=_0x1bd0d5[_0x68dfe6(0x1ab)],_0x5dbdaa=_0x1bd0d5[_0x68dfe6(0x1ab)],_0x5e289f=await profile['findOne']({'email':_0x5dbdaa[_0x68dfe6(0x24b)]}),_0x2350a2=await master_shop[_0x68dfe6(0x1d3)](),_0x4dc3c0=await staff['findOne']({'email':_0x5dbdaa[_0x68dfe6(0x24b)]}),_0x11e0c5=await suppliers[_0x68dfe6(0x1d3)]({});let _0x48fac3;if(_0x5dbdaa['role']==_0x68dfe6(0x14f)){const _0x48ee04=await staff[_0x68dfe6(0x197)]({'email':_0x5dbdaa[_0x68dfe6(0x24b)]});_0x48fac3=await warehouse[_0x68dfe6(0x19f)]([{'$match':{'status':_0x68dfe6(0x19a),'name':_0x48ee04[_0x68dfe6(0x1ce)]}},{'$group':{'_id':'$name','name':{'$first':_0x68dfe6(0x25f)}}}]);}else _0x48fac3=await warehouse['aggregate']([{'$match':{'status':_0x68dfe6(0x19a)}},{'$group':{'_id':_0x68dfe6(0x25f),'name':{'$first':_0x68dfe6(0x25f)}}}]);const _0xfb008c=await product[_0x68dfe6(0x1d3)]({}),_0x347e98=await warehouse['find']({'status':'Enabled'}),_0x5cef3e=await purchases_finished[_0x68dfe6(0x1d3)]({}),_0x43aeea=_0x5cef3e[_0x68dfe6(0x24d)]+0x1,_0x5690a1=_0x68dfe6(0x18f)+_0x43aeea[_0x68dfe6(0x16f)]()[_0x68dfe6(0x175)](0x5,'0');var _0x543b5e=[_0x68dfe6(0x22b),_0x68dfe6(0x272)];if(_0x2350a2[0x0][_0x68dfe6(0x227)]==_0x68dfe6(0x1e9))var _0x4483bd=users[_0x68dfe6(0x16a)];else{if(_0x2350a2[0x0]['language']==_0x68dfe6(0x16d))var _0x4483bd=users[_0x68dfe6(0x16d)];else{if(_0x2350a2[0x0][_0x68dfe6(0x227)]=='German')var _0x4483bd=users[_0x68dfe6(0x1bf)];else{if(_0x2350a2[0x0]['language']=='Spanish')var _0x4483bd=users[_0x68dfe6(0x142)];else{if(_0x2350a2[0x0][_0x68dfe6(0x227)]==_0x68dfe6(0x1f1))var _0x4483bd=users[_0x68dfe6(0x1f1)];else{if(_0x2350a2[0x0][_0x68dfe6(0x227)]==_0x68dfe6(0x258))var _0x4483bd=users[_0x68dfe6(0x1de)];else{if(_0x2350a2[0x0][_0x68dfe6(0x227)]==_0x68dfe6(0x25c))var _0x4483bd=users[_0x68dfe6(0x25c)];else{if(_0x2350a2[0x0][_0x68dfe6(0x227)]==_0x68dfe6(0x213))var _0x4483bd=users[_0x68dfe6(0x1eb)];}}}}}}}const _0x2fa3a2=getRandom8DigitNumber();_0x2fa3a2[_0x68dfe6(0x148)](_0x39f715=>{var _0x2d3814=_0x68dfe6;_0xbdf7de[_0x2d3814(0x166)](_0x2d3814(0x234),{'success':_0x1bd0d5[_0x2d3814(0x265)](_0x2d3814(0x1c8)),'errors':_0x1bd0d5[_0x2d3814(0x265)](_0x2d3814(0x149)),'role':_0x5dbdaa,'profile':_0x5e289f,'suppliers':_0x11e0c5,'warehouse':_0x48fac3,'product':_0xfb008c,'invoice':_0x39f715,'master_shop':_0x2350a2,'language':_0x4483bd,'find_data':_0x347e98,'rooms_data':_0x543b5e});})[_0x68dfe6(0x137)](_0x479c4b=>{var _0xbbb631=_0x68dfe6;_0x1bd0d5[_0xbbb631(0x265)](_0xbbb631(0x149),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xbdf7de[_0xbbb631(0x17c)]('/all_purchases_finished/view');});}catch(_0xdb629e){console[_0x68dfe6(0x17b)](_0xdb629e);}}),router[a0_0x37d3eb(0x218)]('/view/add_purchases/:id',auth,async(_0x1d766c,_0x1a8520)=>{var _0xb46e3c=a0_0x37d3eb;try{const _0x1317a9=_0x1d766c['params']['id'];console['log'](_0x1317a9);const _0xd8d378=await master_shop['find']();console[_0xb46e3c(0x17b)](_0xb46e3c(0x178),_0xd8d378);const _0x5799af=await product['findOne']({'name':_0x1317a9});console[_0xb46e3c(0x17b)](_0xb46e3c(0x159),_0x5799af),_0x1a8520[_0xb46e3c(0x156)](0xc8)['json']({'product_data':_0x5799af,'master':_0xd8d378});}catch(_0xa78f54){console['log'](_0xb46e3c(0x161),_0xa78f54);}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x15f),auth,async(_0x255630,_0x3e2a4d)=>{var _0x5112e3=a0_0x37d3eb;try{const {invoice:_0x3371a7,date:_0x4a7d4b,warehouse_name:_0x2a505e,prod_name:_0x2538d4,note:_0x45fc95,due_amount:_0x387edf,Room_name:_0x429ca9,PO_number:_0x35602c,SCRN:_0x31295c,ReqBy:_0x1e3b50,dateofreq:_0x4ab027,suppliers:_0x2b1b92,typeservicesData:_0x272ee8,van:_0x38a3ae,typevehicle:_0x583a91,driver:_0x3af2de,plate:_0x47ab58,DRSI:_0x32a65e,TSU:_0x492ec8,TFU:_0x4d0bdd,JO_number:_0x4f82c3,type_of_products:_0x11cc89}=_0x255630[_0x5112e3(0x1db)];if(typeof _0x2538d4==_0x5112e3(0x1c7))var _0x42badb=[_0x255630['body']['prod_name']],_0x3e8873=[_0x255630[_0x5112e3(0x1db)]['prod_code']],_0x39d5bd=[_0x255630[_0x5112e3(0x1db)][_0x5112e3(0x21e)]],_0x17e48f=[_0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1c0)]],_0x292249=[_0x255630[_0x5112e3(0x1db)][_0x5112e3(0x215)]],_0x1579fb=[_0x255630['body']['primary_code']],_0x30cc59=[_0x255630['body'][_0x5112e3(0x18a)]],_0x1ed3b9=[_0x255630['body'][_0x5112e3(0x1f0)]],_0x5450ef=[_0x255630[_0x5112e3(0x1db)]['batch_code']],_0x2667ae=[_0x255630[_0x5112e3(0x1db)]['expiry_date']],_0x394da1=[_0x255630[_0x5112e3(0x1db)]['product_date']],_0x252e1f=[_0x255630[_0x5112e3(0x1db)]['max_product_unit']],_0x188c11=[_0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1d8)]],_0x47224b=[_0x255630['body'][_0x5112e3(0x231)]],_0x2efb6b=[_0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1c5)]],_0x3af6ce=[_0x255630[_0x5112e3(0x1db)]['sales_data_cateory']],_0x10e659=[_0x255630[_0x5112e3(0x1db)][_0x5112e3(0x236)]];else var _0x42badb=[..._0x255630['body'][_0x5112e3(0x20a)]],_0x3e8873=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x209)]],_0x39d5bd=[..._0x255630[_0x5112e3(0x1db)]['prod_Qty']],_0x17e48f=[..._0x255630[_0x5112e3(0x1db)]['prod_primunit']],_0x292249=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x215)]],_0x1579fb=[..._0x255630['body'][_0x5112e3(0x23d)]],_0x30cc59=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x18a)]],_0x1ed3b9=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1f0)]],_0x5450ef=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x23c)]],_0x2667ae=[..._0x255630[_0x5112e3(0x1db)]['expiry_date']],_0x394da1=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x264)]],_0x252e1f=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1a7)]],_0x188c11=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1d8)]],_0x47224b=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x231)]],_0x2efb6b=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x1c5)]],_0x3af6ce=[..._0x255630[_0x5112e3(0x1db)][_0x5112e3(0x252)]],_0x10e659=[..._0x255630['body']['product_id']];const _0x293fe3=_0x42badb[_0x5112e3(0x1a8)](_0x493f00=>{return _0x493f00={'product_name':_0x493f00};});_0x10e659['forEach']((_0x122d39,_0x25fc7a)=>{var _0x54ceda=_0x5112e3;_0x293fe3[_0x25fc7a]['product_id']=_0x122d39,_0x293fe3[_0x25fc7a][_0x54ceda(0x277)]=_0x4a7d4b;}),_0x3af6ce[_0x5112e3(0x235)]((_0x19287e,_0x1424d1)=>{var _0x53f9e6=_0x5112e3;_0x293fe3[_0x1424d1][_0x53f9e6(0x163)]=_0x19287e;}),_0x3e8873[_0x5112e3(0x235)]((_0x6885f2,_0x4ea284)=>{var _0xbf51bd=_0x5112e3;_0x293fe3[_0x4ea284][_0xbf51bd(0x247)]=_0x6885f2;}),_0x2efb6b['forEach']((_0x3b057e,_0x3b4332)=>{var _0x2bed62=_0x5112e3;_0x293fe3[_0x3b4332][_0x2bed62(0x1c5)]=_0x3b057e;}),_0x39d5bd[_0x5112e3(0x235)]((_0x7d9df4,_0x4326e0)=>{var _0x1d4936=_0x5112e3;_0x293fe3[_0x4326e0][_0x1d4936(0x174)]=Math[_0x1d4936(0x15c)](_0x7d9df4);}),_0x17e48f[_0x5112e3(0x235)]((_0x43c5f4,_0x54d0a8)=>{var _0x390eff=_0x5112e3;_0x293fe3[_0x54d0a8][_0x390eff(0x190)]=_0x43c5f4;}),_0x292249['forEach']((_0x5db0ab,_0x55af7c)=>{var _0x46bb44=_0x5112e3;_0x293fe3[_0x55af7c][_0x46bb44(0x1b6)]=_0x5db0ab;}),_0x1579fb[_0x5112e3(0x235)]((_0x518a51,_0x328e0e)=>{var _0x1042ca=_0x5112e3;_0x293fe3[_0x328e0e][_0x1042ca(0x23d)]=_0x518a51;}),_0x30cc59[_0x5112e3(0x235)]((_0x539d9f,_0x27a955)=>{var _0x1a4e50=_0x5112e3;_0x293fe3[_0x27a955][_0x1a4e50(0x18a)]=_0x539d9f;}),_0x1ed3b9[_0x5112e3(0x235)]((_0x11e4a3,_0x57501e)=>{var _0xa3dd9e=_0x5112e3;_0x293fe3[_0x57501e][_0xa3dd9e(0x246)]=_0x11e4a3;}),_0x5450ef[_0x5112e3(0x235)]((_0x51a56b,_0x3ab4d1)=>{_0x293fe3[_0x3ab4d1]['batch_code']=_0x51a56b;}),_0x2667ae[_0x5112e3(0x235)]((_0x114c85,_0x2779ef)=>{var _0x4e4f6b=_0x5112e3;_0x293fe3[_0x2779ef][_0x4e4f6b(0x205)]=_0x114c85;}),_0x394da1[_0x5112e3(0x235)]((_0x1f7362,_0x4370cd)=>{var _0x1c9f2f=_0x5112e3;_0x293fe3[_0x4370cd][_0x1c9f2f(0x21c)]=_0x1f7362;}),_0x252e1f[_0x5112e3(0x235)]((_0x3d25c2,_0x322af4)=>{var _0x9013c2=_0x5112e3;_0x293fe3[_0x322af4][_0x9013c2(0x1f2)]=_0x3d25c2;}),_0x188c11[_0x5112e3(0x235)]((_0x4de979,_0x59905c)=>{var _0x1ab4b4=_0x5112e3;_0x293fe3[_0x59905c][_0x1ab4b4(0x144)]=_0x4de979;}),_0x47224b[_0x5112e3(0x235)]((_0x3724fc,_0x3cd5f1)=>{var _0x3845d9=_0x5112e3;_0x293fe3[_0x3cd5f1][_0x3845d9(0x231)]=_0x3724fc;});const _0x49888b=new invoice_for_incoming();await _0x49888b[_0x5112e3(0x226)]();for(let _0x22c50a=0x0;_0x22c50a<=_0x42badb[_0x5112e3(0x24d)]-0x1;_0x22c50a++){_0x293fe3[_0x22c50a][_0x5112e3(0x18e)]=_0x5112e3(0x19e)+_0x49888b[_0x5112e3(0x17f)][_0x5112e3(0x16f)]()['padStart'](0x8,'0');}const _0x3cec39=await warehouse_validation_setup[_0x5112e3(0x19f)]([{'$match':{'warehouse_name':_0x2a505e}}]);for(let _0x4bc003=0x0;_0x4bc003<=_0x3cec39['length']-0x1;_0x4bc003++){const _0x3f8caf=_0x3cec39[_0x4bc003];for(let _0x135e38=0x0;_0x135e38<=_0x3f8caf[_0x5112e3(0x228)][_0x5112e3(0x24d)]-0x1;_0x135e38++){const _0x9b06eb=_0x3f8caf['product_data'][_0x135e38],_0x1f61e0=await warehouse[_0x5112e3(0x19f)]([{'$match':{'name':_0x3f8caf['warehouse_name'],'room':_0x3f8caf[_0x5112e3(0x191)]}},{'$unwind':_0x5112e3(0x20e)},{'$match':{'product_details.level':_0x9b06eb['bay'],'product_details.bay':parseInt(_0x9b06eb[_0x5112e3(0x160)]),'product_details.product_code':_0x9b06eb['product_code']}}]);for(let _0x14d422=0x0;_0x14d422<=_0x1f61e0['length']-0x1;_0x14d422++){let _0x254867=_0x1f61e0[_0x14d422],_0x4fef30=0x0;_0x254867[_0x5112e3(0x19d)][_0x5112e3(0x247)]==_0x9b06eb[_0x5112e3(0x247)]&&_0x254867[_0x5112e3(0x19d)][_0x5112e3(0x1b7)]==_0x9b06eb[_0x5112e3(0x160)]&&_0x254867[_0x5112e3(0x19d)]['level']==_0x9b06eb[_0x5112e3(0x1b7)]&&(_0x9b06eb[_0x5112e3(0x15d)]=parseInt(_0x9b06eb[_0x5112e3(0x15d)])-parseInt(_0x254867['product_details'][_0x5112e3(0x189)]),_0x4fef30++),_0x4fef30=='0'&&(parseInt(_0x9b06eb[_0x5112e3(0x15d)])>0x0&&(_0x3cec39[_0x4bc003][_0x5112e3(0x228)]=_0x3cec39[_0x4bc003][_0x5112e3(0x228)]['concat']({'bay':_0x9b06eb[_0x5112e3(0x1b7)],'bin':_0x9b06eb[_0x5112e3(0x160)],'max':_0x9b06eb[_0x5112e3(0x15d)],'min':_0x9b06eb['min'],'product_code':_0x9b06eb[_0x5112e3(0x247)],'product_id':_0x9b06eb[_0x5112e3(0x236)],'product_name':_0x9b06eb[_0x5112e3(0x1d7)]})));}}_0x3cec39[_0x4bc003]['product_data']=_0x3cec39[_0x4bc003][_0x5112e3(0x228)][_0x5112e3(0x1cf)](_0x31ee94=>parseInt(_0x31ee94[_0x5112e3(0x15d)])>0x0);}for(let _0x462d3b=0x0;_0x462d3b<=_0x3cec39[_0x5112e3(0x24d)]-0x1;_0x462d3b++){const _0x49f3df=_0x3cec39[_0x462d3b];for(let _0x59ca40=0x0;_0x59ca40<=_0x49f3df[_0x5112e3(0x228)][_0x5112e3(0x24d)]-0x1;_0x59ca40++){const _0xcf3893=_0x49f3df[_0x5112e3(0x228)][_0x59ca40],_0x389ec2=await warehouse_temporary[_0x5112e3(0x19f)]([{'$match':{'warehouse':_0x49f3df[_0x5112e3(0x211)],'room_name':_0x49f3df[_0x5112e3(0x191)],'isConfirm':_0x5112e3(0x196),'data_type':_0x5112e3(0x1e4),'product_code':_0xcf3893[_0x5112e3(0x247)],'level':_0xcf3893['bay'],'bay':parseInt(_0xcf3893[_0x5112e3(0x160)])}}]);for(let _0x2b7ebd=0x0;_0x2b7ebd<=_0x389ec2[_0x5112e3(0x24d)]-0x1;_0x2b7ebd++){let _0x19c3a4=_0x389ec2[_0x2b7ebd];console[_0x5112e3(0x17b)](_0x19c3a4);let _0x314272=0x0;_0x19c3a4[_0x5112e3(0x247)]==_0xcf3893['product_code']&&_0x19c3a4[_0x5112e3(0x1b7)]==_0xcf3893['bin']&&_0x19c3a4[_0x5112e3(0x192)]==_0xcf3893[_0x5112e3(0x1b7)]&&(_0xcf3893['max']=parseInt(_0xcf3893[_0x5112e3(0x15d)])-parseInt(_0x19c3a4[_0x5112e3(0x189)]),_0x314272++),_0x314272=='0'&&(parseInt(_0xcf3893[_0x5112e3(0x15d)])>0x0&&(_0x3cec39[_0x462d3b][_0x5112e3(0x228)]=_0x3cec39[_0x462d3b][_0x5112e3(0x228)][_0x5112e3(0x157)]({'bay':_0xcf3893[_0x5112e3(0x1b7)],'bin':_0xcf3893['bin'],'max':_0xcf3893[_0x5112e3(0x15d)],'min':_0xcf3893[_0x5112e3(0x1c1)],'product_code':_0xcf3893['product_code'],'product_id':_0xcf3893['product_id'],'product_name':_0xcf3893['product_name']})));}}_0x3cec39[_0x462d3b]['product_data']=_0x3cec39[_0x462d3b]['product_data']['filter'](_0x2532eb=>parseInt(_0x2532eb['max'])>0x0);}let _0x5d8f4e=[],_0x316215=0x0;for(let _0x56fe5a=0x0;_0x56fe5a<=_0x293fe3[_0x5112e3(0x24d)]-0x1;_0x56fe5a++){const _0x41eb1c=_0x293fe3[_0x56fe5a];let _0x37c28d=_0x41eb1c[_0x5112e3(0x174)];for(let _0x1e6691=0x0;_0x1e6691<=_0x3cec39[_0x5112e3(0x24d)]-0x1;_0x1e6691++){const _0x280ab6=_0x3cec39[_0x1e6691];for(let _0x9ddc93=0x0;_0x9ddc93<=_0x280ab6[_0x5112e3(0x228)][_0x5112e3(0x24d)]-0x1;_0x9ddc93++){const _0x22909c=_0x280ab6[_0x5112e3(0x228)][_0x9ddc93];if(_0x22909c[_0x5112e3(0x247)]===_0x41eb1c[_0x5112e3(0x247)]){const _0x38bd19=await warehouse[_0x5112e3(0x19f)]([{'$match':{'name':_0x2a505e,'room':_0x280ab6[_0x5112e3(0x191)]}},{'$unwind':_0x5112e3(0x20e)},{'$match':{'product_details.level':_0x22909c[_0x5112e3(0x1b7)],'product_details.bay':parseInt(_0x22909c[_0x5112e3(0x160)])}}]);if(_0x38bd19[_0x5112e3(0x24d)]==0x0){for(let _0x53e9b8=0x0;_0x53e9b8<=_0x280ab6[_0x5112e3(0x228)][_0x5112e3(0x24d)]-0x1&&_0x37c28d>0x0;_0x53e9b8++){const _0x4bbfb6=_0x280ab6[_0x5112e3(0x228)][_0x53e9b8];console[_0x5112e3(0x17b)](_0x41eb1c['product_code']+_0x5112e3(0x135)+_0x4bbfb6['product_code']+'\x20<>\x20'+_0x4bbfb6[_0x5112e3(0x1c1)]+'\x20<>\x20'+_0x4bbfb6[_0x5112e3(0x15d)]+_0x5112e3(0x1d6)+_0x4bbfb6['bay']+'\x20<>\x20'+_0x4bbfb6[_0x5112e3(0x160)]);if(_0x41eb1c[_0x5112e3(0x247)]===_0x4bbfb6['product_code']){_0x5d8f4e[_0x316215]={};const _0x4a9096=parseInt(_0x4bbfb6[_0x5112e3(0x15d)]),_0x425ca7=0x0;let _0x2a37c9=_0x4a9096-_0x425ca7,_0x36f973=Math[_0x5112e3(0x1c1)](_0x37c28d,_0x2a37c9);console['log'](_0x5112e3(0x13a)+_0x36f973+_0x5112e3(0x1c3)+_0x41eb1c[_0x5112e3(0x1d7)]+'\x20to\x20warehouse:\x20'+_0x280ab6[_0x5112e3(0x211)]+_0x5112e3(0x1b1)+_0x280ab6['room']+_0x5112e3(0x257)+_0x4bbfb6['bay']+',\x20bin:\x20'+_0x4bbfb6[_0x5112e3(0x160)]+_0x5112e3(0x206)+_0x316215),_0x5d8f4e[_0x316215][_0x5112e3(0x1d7)]=_0x41eb1c[_0x5112e3(0x1d7)],_0x5d8f4e[_0x316215]['product_code']=_0x41eb1c[_0x5112e3(0x247)],_0x5d8f4e[_0x316215][_0x5112e3(0x236)]=_0x41eb1c['product_id'],_0x5d8f4e[_0x316215]['date_recieved']=_0x41eb1c[_0x5112e3(0x277)],_0x5d8f4e[_0x316215][_0x5112e3(0x163)]=_0x41eb1c[_0x5112e3(0x163)],_0x5d8f4e[_0x316215][_0x5112e3(0x1c5)]=_0x41eb1c[_0x5112e3(0x1c5)],_0x5d8f4e[_0x316215][_0x5112e3(0x174)]=_0x36f973,_0x5d8f4e[_0x316215][_0x5112e3(0x190)]=_0x41eb1c[_0x5112e3(0x190)],_0x5d8f4e[_0x316215]['secondary_unit']=_0x41eb1c['secondary_unit'],_0x5d8f4e[_0x316215][_0x5112e3(0x23d)]=_0x41eb1c[_0x5112e3(0x23d)],_0x5d8f4e[_0x316215][_0x5112e3(0x18a)]=_0x41eb1c[_0x5112e3(0x18a)],_0x5d8f4e[_0x316215][_0x5112e3(0x246)]=_0x41eb1c[_0x5112e3(0x246)],_0x5d8f4e[_0x316215][_0x5112e3(0x23c)]=_0x41eb1c[_0x5112e3(0x23c)],_0x5d8f4e[_0x316215][_0x5112e3(0x205)]=_0x41eb1c[_0x5112e3(0x205)],_0x5d8f4e[_0x316215]['production_date']=_0x41eb1c[_0x5112e3(0x21c)],_0x5d8f4e[_0x316215][_0x5112e3(0x1f2)]=_0x41eb1c[_0x5112e3(0x1f2)],_0x5d8f4e[_0x316215][_0x5112e3(0x144)]=_0x41eb1c[_0x5112e3(0x144)],_0x5d8f4e[_0x316215][_0x5112e3(0x18e)]=_0x41eb1c[_0x5112e3(0x18e)],_0x5d8f4e[_0x316215][_0x5112e3(0x231)]=_0x41eb1c[_0x5112e3(0x231)],_0x5d8f4e[_0x316215][_0x5112e3(0x173)]=_0x280ab6[_0x5112e3(0x191)],_0x5d8f4e[_0x316215][_0x5112e3(0x192)]=_0x4bbfb6[_0x5112e3(0x1b7)],_0x5d8f4e[_0x316215][_0x5112e3(0x1b7)]=_0x4bbfb6[_0x5112e3(0x160)],_0x37c28d-=_0x36f973,_0x316215++;if(_0x37c28d<=0x0)break;}}if(_0x37c28d<=0x0){_0x255630['flash'](_0x5112e3(0x149),_0x5112e3(0x245)+_0x37c28d+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x37c28d>0x0){console[_0x5112e3(0x17b)](_0x5112e3(0x222)+_0x37c28d+_0x5112e3(0x24e));break;}}}}}if(_0x37c28d>0x0){const _0x3de24a=await warehouse[_0x5112e3(0x19f)]([{'$match':{'name':_0x2a505e,'isStaging':_0x5112e3(0x27b)}}]);_0x5d8f4e[_0x316215]={},_0x5d8f4e[_0x316215][_0x5112e3(0x1d7)]=_0x41eb1c[_0x5112e3(0x1d7)],_0x5d8f4e[_0x316215][_0x5112e3(0x247)]=_0x41eb1c[_0x5112e3(0x247)],_0x5d8f4e[_0x316215]['product_id']=_0x41eb1c[_0x5112e3(0x236)],_0x5d8f4e[_0x316215][_0x5112e3(0x277)]=_0x41eb1c['date_recieved'],_0x5d8f4e[_0x316215][_0x5112e3(0x163)]=_0x41eb1c[_0x5112e3(0x163)],_0x5d8f4e[_0x316215]['uuid']=_0x41eb1c[_0x5112e3(0x1c5)],_0x5d8f4e[_0x316215][_0x5112e3(0x174)]=_0x37c28d,_0x5d8f4e[_0x316215][_0x5112e3(0x190)]=_0x41eb1c[_0x5112e3(0x190)],_0x5d8f4e[_0x316215]['secondary_unit']=_0x41eb1c[_0x5112e3(0x1b6)],_0x5d8f4e[_0x316215][_0x5112e3(0x23d)]=_0x41eb1c[_0x5112e3(0x23d)],_0x5d8f4e[_0x316215][_0x5112e3(0x18a)]=_0x41eb1c[_0x5112e3(0x18a)],_0x5d8f4e[_0x316215][_0x5112e3(0x246)]=_0x41eb1c['maxStocks'],_0x5d8f4e[_0x316215][_0x5112e3(0x23c)]=_0x41eb1c[_0x5112e3(0x23c)],_0x5d8f4e[_0x316215][_0x5112e3(0x205)]=_0x41eb1c['expiry_date'],_0x5d8f4e[_0x316215]['production_date']=_0x41eb1c[_0x5112e3(0x21c)],_0x5d8f4e[_0x316215][_0x5112e3(0x1f2)]=_0x41eb1c[_0x5112e3(0x1f2)],_0x5d8f4e[_0x316215][_0x5112e3(0x144)]=_0x41eb1c[_0x5112e3(0x144)],_0x5d8f4e[_0x316215][_0x5112e3(0x18e)]=_0x41eb1c[_0x5112e3(0x18e)],_0x5d8f4e[_0x316215][_0x5112e3(0x231)]=_0x41eb1c[_0x5112e3(0x231)],_0x5d8f4e[_0x316215][_0x5112e3(0x173)]=_0x3de24a[0x0]['room'],_0x5d8f4e[_0x316215][_0x5112e3(0x192)]='STAGING',_0x5d8f4e[_0x316215][_0x5112e3(0x1b7)]='1',console[_0x5112e3(0x17b)](_0x5112e3(0x26f)+_0x5112e3(0x1d6)+_0x41eb1c[_0x5112e3(0x247)]+'\x20===\x20'+_0x41eb1c[_0x5112e3(0x247)]+_0x5112e3(0x1d6)+_0x316215+_0x5112e3(0x1d6)+_0x37c28d),_0x255630['flash'](_0x5112e3(0x149),_0x5112e3(0x245)+_0x37c28d+'\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area');}}const _0x5e5a23=_0x5d8f4e['filter'](_0x39008e=>_0x39008e[_0x5112e3(0x174)]!=='0'&&_0x39008e['quantity']!==''),_0x1fabba=new purchases_finished({'invoice':_0x5112e3(0x19e)+_0x49888b['invoice_init'][_0x5112e3(0x16f)]()[_0x5112e3(0x175)](0x8,'0'),'suppliers':_0x2b1b92,'date':_0x4a7d4b,'warehouse_name':_0x2a505e,'product':_0x5e5a23,'note':_0x45fc95,'due_amount':_0x387edf,'room':_0x429ca9,'POnumber':_0x35602c,'SCRN':_0x31295c,'JO_number':_0x4f82c3,'ReqBy':_0x1e3b50,'dateofreq':_0x4ab027,'typeservicesData':_0x272ee8,'van':_0x38a3ae,'typevehicle':_0x583a91,'driver':_0x3af2de,'plate':_0x47ab58,'DRSI':_0x32a65e,'TSU':_0x492ec8,'TFU':_0x4d0bdd,'typeOfProducts':_0x11cc89}),_0x19c6d7=await _0x1fabba[_0x5112e3(0x226)](),_0x1b2e84=await purchases_finished[_0x5112e3(0x197)]({'_id':_0x19c6d7[_0x5112e3(0x136)][_0x5112e3(0x1f8)]()});_0x255630[_0x5112e3(0x265)](_0x5112e3(0x1c8),_0x5112e3(0x1b4)),_0x3e2a4d['redirect'](_0x5112e3(0x242)+_0x1b2e84[_0x5112e3(0x136)][_0x5112e3(0x1f8)]());}catch(_0x508776){console[_0x5112e3(0x17b)](_0x508776);}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x1fb),auth,async(_0x48244b,_0x43d845)=>{var _0x54d89e=a0_0x37d3eb;try{const {username:_0x4ae95b,email:_0x4be4f4,role:_0x25d028}=_0x48244b[_0x54d89e(0x1ab)],_0x13f2f2=_0x48244b[_0x54d89e(0x1ab)],_0x2b67b4=_0x48244b['params']['id'],_0x4ce35e=await profile['findOne']({'email':_0x13f2f2[_0x54d89e(0x24b)]}),_0x3c003b=await master_shop[_0x54d89e(0x1d3)](),_0xd86316=await staff['findOne']({'email':_0x13f2f2[_0x54d89e(0x24b)]}),_0x26cf41=await suppliers[_0x54d89e(0x1d3)]({});let _0x3e8f14;if(_0x13f2f2[_0x54d89e(0x14c)]==_0x54d89e(0x14f)){const _0x3fc55c=await staff[_0x54d89e(0x197)]({'email':_0x13f2f2[_0x54d89e(0x24b)]});_0x3e8f14=await warehouse[_0x54d89e(0x19f)]([{'$match':{'status':_0x54d89e(0x19a),'name':_0x3fc55c['warehouse']}},{'$group':{'_id':_0x54d89e(0x25f),'name':{'$first':_0x54d89e(0x25f)}}}]);}else _0x3e8f14=await warehouse[_0x54d89e(0x19f)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x54d89e(0x25f),'name':{'$first':_0x54d89e(0x25f)}}}]);const _0x2de8e6=await purchases_finished[_0x54d89e(0x1f3)](_0x2b67b4);if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x1e9))var _0x1848cf=users[_0x54d89e(0x16a)];else{if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x16d))var _0x1848cf=users['Hindi'];else{if(_0x3c003b[0x0]['language']==_0x54d89e(0x1bf))var _0x1848cf=users['German'];else{if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x142))var _0x1848cf=users[_0x54d89e(0x142)];else{if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x1f1))var _0x1848cf=users['French'];else{if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x258))var _0x1848cf=users[_0x54d89e(0x1de)];else{if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x25c))var _0x1848cf=users[_0x54d89e(0x25c)];else{if(_0x3c003b[0x0][_0x54d89e(0x227)]==_0x54d89e(0x213))var _0x1848cf=users[_0x54d89e(0x1eb)];}}}}}}}_0x43d845[_0x54d89e(0x166)](_0x54d89e(0x176),{'success':_0x48244b['flash'](_0x54d89e(0x1c8)),'errors':_0x48244b['flash'](_0x54d89e(0x149)),'role':_0x13f2f2,'profile':_0x4ce35e,'suppliers':_0x26cf41,'warehouse':_0x3e8f14,'master_shop':_0x3c003b,'language':_0x1848cf,'purchases_data':_0x2de8e6});}catch(_0x2a70ac){console['log'](_0x2a70ac);}});function a0_0x18bf(){var _0x429cde=['/incoming/add','incoming_view','warehouse','filter','45OefjsM','exports','Return\x20Goods','find','$warehouse_name','updateOne','\x20<>\x20','product_name','prod_cat','getDate','Rack\x201','body','$product_details.product_stock','An\x20error\x20occurred.','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Purchase\x20Return\x20Mail','suppliers','/invoice/:id','</tbody>','inc','$product_code','$product.quantity','$product.floorlevel','$note','English\x20(US)','isProcess','Arabic','</div>','id_transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','own','MaxStocks_data','French','maxperunit','findById','edit_purchases_finished','True','</span>','/view/:id','valueOf','slice','maxProducts','/process/:id','primary_code_hide','../middleware/auth','/../public','/all_purchases_finished/view','3OXTcYE','$product.bay','$secondary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.storage','expiry_date','\x20inc\x20=\x20','$product.bin','return_qty','prod_code','prod_name','/incoming','purchases\x20item\x20return\x20successfull','note','$product_details','$invoice','$maxStocks','warehouse_name','$product_details.rack','Arabic\x20(ae)','$room','prod_secondunit','prod_qty','FGSEmail','get','<strong>\x20Regards\x20</strong>','add_purchases_finished','Asia/Manila','production_date','to_warehouse','prod_Qty','stocks','data_type','\x20Order\x20Date\x20:\x20','There\x20is\x20','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','params','save','language','product_data','$suppliers_docs','type_of_products','Ambient','$product_details.maxProducts','2-digit','all','Finished\x20Goods','type_of_products_type','gross_price','$return_data','all_purchases_finished','add_purchases_finished_logs','forEach','product_id','</h5>','path','5029610EhmSvR','$expiry_date','/barcode_scanner','batch_code','primary_code','</td>','purchases_id','632546UkwSQM','/barcode_scanner_logs','/all_purchases_finished/process/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','password','The\x20Other\x20','maxStocks','product_code','<h5\x20style=\x22text-align:\x20left;\x22>','</thead>','numeric','email','<!DOCTYPE\x20html>','length','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','$sales_category','<html><head><title></title>','to_bay','sales_data_cateory','$product_details.secondary_code','$_id','back','<table\x20style=\x22width:\x20100%\x20!important;\x22>',',\x20bay:\x20','Portuguese\x20(BR)','Error\x20occurred\x20while\x20processing\x20product:','to_recieved','LOG-INC-','Chinese','/view/add_purchases_logs','FROZEN\x20GOODS','$name','102EOQpDJ','currency','/all_purchases_finished/preview/','$alertquantity','product_date','flash','97004bSKRNJ','post','Room_name','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<div>','/preview/:id','80878vjczWV','335898Nzppfd','STAGING\x20AREA\x201','random','suppliers_docs','Enclosed','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','toLocaleDateString','$unit','date_recieved','$gross_price','sendMail','error','true','user_id','<h2>\x20','item_code','secondary_code_hide','<tbody\x20style=\x22text-align:\x20center;\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','json','host','maxPerUnit','/view_log','$type_products','Rack\x202','RoomAssign','===','_id','catch','Logo.png','Purchase\x20Mail','Distributing\x20','1538493YneAHp','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','isUsed','logo','$product_details.floorlevel','$product.type','Spanish','unit','product_cat','due_amount','DRY\x20GOODS','en-CA','then','errors','<hr\x20class=\x22my-3\x22>','INC','role','$paid_amount','$due_amount','staff','purchase_invoice','$secondary_unit','image','</head><body>','getFullYear','$product','status','concat','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product','prod_unit','nodemailer','abs','max','$product_details.product_name','/view/add_purchases','bin','add_purchases\x20error','/give_payment/:id','sales_category','edit_purchases_finished_view','createTransport','render','../public/language/languages.json','stock_data','9dZUKGL','English','$brand','undefined','Hindi','$product_details._id','toString','site_title','<h5>','name','room_name','quantity','padStart','purchases_process','return_product','master','Router','\x20</h2>','log','redirect','$product_details.bin','date','invoice_init','</table>','paid_amount','<tr>','to_room_name','$batch_code','\x20Order\x20Number\x20:\x20','Paid\x20For\x20Purchase','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','product_stock','secondary_code','stock_quantity','</tr>','match','invoice','INCF-','standard_unit','room','level','$suppliers','/view/return_purchase/:id','to_quantity','false','findOne','table\x20page','$product_details.bay','Enabled','amount','$maxProdPerUnit','product_details','INC-','aggregate','prod_level','currency_placement','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$category','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','max_product_unit','map','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','purchase_quantity','user','\x20<=>\x20','$product.room_name','/view','POnumber','Error\x20Occurs',',\x20room:\x20','payment\x20successfull','../models/all_models','purchase\x20data\x20add\x20successfully','/CheckingWarehouse','secondary_unit','bay','floor','<span\x20style=\x22float:\x20right;\x22>','2124752VlGpIf','/barcode/:id','port','/getinvoicetrf','purchase\x20data\x20update\x20successfully','German','prod_primunit','min','isAvailable','\x20units\x20of\x20','getMonth','uuid','message','string','success','/upload/','product_code_hide','/getTRF'];a0_0x18bf=function(){return _0x429cde;};return a0_0x18bf();}async function get_warehouse_data(_0x402beb,_0x4dda25){var _0x2e8d3c=a0_0x37d3eb;try{const _0x1c2f8f=await warehouse_temporary[_0x2e8d3c(0x197)]({'name':_0x402beb,'room':_0x4dda25});if(!_0x1c2f8f){const _0x3e7c77=new warehouse_temporary({'name':_0x402beb,'address':_0x402beb,'status':_0x2e8d3c(0x19a),'room':_0x4dda25,'isStaging':_0x2e8d3c(0x196)});return await _0x3e7c77[_0x2e8d3c(0x226)](),_0x3e7c77;}else return _0x1c2f8f;}catch(_0x15e332){console[_0x2e8d3c(0x27a)](_0x2e8d3c(0x187),_0x15e332);throw _0x15e332;}}router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x1fb),auth,async(_0x51f6c8,_0x3fb8da)=>{var _0x1542ea=a0_0x37d3eb;try{const _0x473dfc=_0x51f6c8[_0x1542ea(0x225)]['id'],_0x4ed320=await purchases_finished['findById'](_0x473dfc);let _0x1ab2b6=[];_0x4ed320[_0x1542ea(0x159)][_0x1542ea(0x235)]((_0x2addaa,_0x254af5)=>{var _0x15391a=_0x1542ea;_0x1ab2b6[_0x254af5]={},_0x1ab2b6[_0x254af5][_0x15391a(0x1ce)]=_0x4ed320[_0x15391a(0x211)],_0x1ab2b6[_0x254af5][_0x15391a(0x236)]=_0x2addaa['product_id'],_0x1ab2b6[_0x254af5][_0x15391a(0x1d7)]=_0x2addaa[_0x15391a(0x1d7)],_0x1ab2b6[_0x254af5][_0x15391a(0x247)]=_0x2addaa[_0x15391a(0x247)],_0x1ab2b6[_0x254af5][_0x15391a(0x189)]=_0x2addaa[_0x15391a(0x174)],_0x1ab2b6[_0x254af5]['unit']=_0x2addaa[_0x15391a(0x190)],_0x1ab2b6[_0x254af5]['secondary_unit']=_0x2addaa['secondary_unit'],_0x1ab2b6[_0x254af5][_0x15391a(0x192)]=_0x2addaa['level'],_0x1ab2b6[_0x254af5][_0x15391a(0x1b7)]=_0x2addaa[_0x15391a(0x1b7)],_0x1ab2b6[_0x254af5]['primary_code']=_0x2addaa[_0x15391a(0x23d)],_0x1ab2b6[_0x254af5][_0x15391a(0x18a)]=_0x2addaa['secondary_code'],_0x1ab2b6[_0x254af5][_0x15391a(0x246)]=_0x2addaa[_0x15391a(0x246)],_0x1ab2b6[_0x254af5][_0x15391a(0x23c)]=_0x2addaa[_0x15391a(0x23c)],_0x1ab2b6[_0x254af5][_0x15391a(0x205)]=_0x2addaa[_0x15391a(0x205)],_0x1ab2b6[_0x254af5][_0x15391a(0x21c)]=_0x2addaa[_0x15391a(0x21c)],_0x1ab2b6[_0x254af5][_0x15391a(0x1f2)]=_0x2addaa[_0x15391a(0x1f2)],_0x1ab2b6[_0x254af5][_0x15391a(0x144)]=_0x2addaa[_0x15391a(0x144)],_0x1ab2b6[_0x254af5][_0x15391a(0x173)]=_0x2addaa['room_name'],_0x1ab2b6[_0x254af5][_0x15391a(0x18e)]=_0x2addaa[_0x15391a(0x18e)],_0x1ab2b6[_0x254af5]['uuid']=_0x2addaa['uuid'],_0x1ab2b6[_0x254af5][_0x15391a(0x231)]=_0x2addaa[_0x15391a(0x231)],_0x1ab2b6[_0x254af5][_0x15391a(0x163)]=_0x2addaa['sales_category'],_0x1ab2b6[_0x254af5]['date_recieved']=_0x2addaa[_0x15391a(0x277)],_0x1ab2b6[_0x254af5][_0x15391a(0x23f)]=_0x2addaa['_id']['valueOf'](),_0x1ab2b6[_0x254af5][_0x15391a(0x220)]=_0x15391a(0x1e4),_0x1ab2b6[_0x254af5][_0x15391a(0x1c2)]=_0x15391a(0x27b),_0x1ab2b6[_0x254af5][_0x15391a(0x13e)]=_0x15391a(0x196);});for(let _0x4a792e=0x0;_0x4a792e<=_0x1ab2b6[_0x1542ea(0x24d)]-0x1;_0x4a792e++){const _0x333a5b=_0x1ab2b6[_0x4a792e],_0x332480=new warehouse_temporary(_0x333a5b);await _0x332480['save']();}_0x4ed320[_0x1542ea(0x1ea)]=_0x1542ea(0x27b),await _0x4ed320[_0x1542ea(0x226)](),_0x51f6c8[_0x1542ea(0x265)](_0x1542ea(0x1c8),_0x1542ea(0x1a6)),_0x3fb8da[_0x1542ea(0x17c)]('/all_purchases_finished/process/'+_0x4ed320[_0x1542ea(0x136)][_0x1542ea(0x1f8)]());}catch(_0x3b11c2){}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x25d),auth,async(_0x43e0a7,_0x4f1f6f)=>{var _0x53fad2=a0_0x37d3eb;try{const {invoice:_0x27cc2d,date:_0x49e317,warehouse_name:_0x25e6b3,prod_name:_0x52e4b7,note:_0x224533,due_amount:_0x3c074d,Room_name:_0x39112d,PO_number:_0x44683c,SCRN:_0x14e20,ReqBy:_0x5cca13,dateofreq:_0x3e0078,suppliers:_0x59f7a2,typeservicesData:_0x1da88a,van:_0x3cb197,typevehicle:_0x4bf5e9,driver:_0x1c9036,plate:_0x4f7eb2,DRSI:_0x227917,TSU:_0x58bdea,TFU:_0x28dcbf,JO_number:_0xf2dbcd,type_of_products:_0x457b69}=_0x43e0a7[_0x53fad2(0x1db)];if(typeof _0x52e4b7==_0x53fad2(0x1c7))var _0x2f9367=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x20a)]],_0x2f6e85=[_0x43e0a7['body'][_0x53fad2(0x209)]],_0x3c5db8=[_0x43e0a7[_0x53fad2(0x1db)]['prod_Qty']],_0x1cd99d=[_0x43e0a7[_0x53fad2(0x1db)]['prod_primunit']],_0x599b1f=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x215)]],_0xcd5af7=[_0x43e0a7[_0x53fad2(0x1db)]['prod_level']],_0x349704=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x23d)]],_0x5dcfd3=[_0x43e0a7[_0x53fad2(0x1db)]['secondary_code']],_0x12eb16=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x1f0)]],_0x2ee4cb=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x23c)]],_0x38747f=[_0x43e0a7['body'][_0x53fad2(0x205)]],_0x17baab=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x264)]],_0x2bd342=[_0x43e0a7['body'][_0x53fad2(0x1a7)]],_0x5b35be=[_0x43e0a7[_0x53fad2(0x1db)]['prod_cat']],_0x39f6e8=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x134)]],_0x276faf=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x231)]],_0x48931d=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x1c5)]],_0x29e6db=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x252)]],_0x37c59b=[_0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x230)]];else var _0x2f9367=[..._0x43e0a7['body'][_0x53fad2(0x20a)]],_0x2f6e85=[..._0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x209)]],_0x3c5db8=[..._0x43e0a7['body'][_0x53fad2(0x21e)]],_0x1cd99d=[..._0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x1c0)]],_0x599b1f=[..._0x43e0a7['body']['prod_secondunit']],_0xcd5af7=[..._0x43e0a7['body'][_0x53fad2(0x1a0)]],_0x349704=[..._0x43e0a7['body'][_0x53fad2(0x23d)]],_0x5dcfd3=[..._0x43e0a7['body']['secondary_code']],_0x12eb16=[..._0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x1f0)]],_0x2ee4cb=[..._0x43e0a7[_0x53fad2(0x1db)]['batch_code']],_0x38747f=[..._0x43e0a7['body']['expiry_date']],_0x17baab=[..._0x43e0a7['body'][_0x53fad2(0x264)]],_0x2bd342=[..._0x43e0a7['body']['max_product_unit']],_0x5b35be=[..._0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x1d8)]],_0x39f6e8=[..._0x43e0a7['body'][_0x53fad2(0x134)]],_0x276faf=[..._0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x231)]],_0x48931d=[..._0x43e0a7[_0x53fad2(0x1db)][_0x53fad2(0x1c5)]],_0x29e6db=[..._0x43e0a7['body'][_0x53fad2(0x252)]],_0x37c59b=[..._0x43e0a7['body'][_0x53fad2(0x230)]];const _0x20f454=_0x2f9367[_0x53fad2(0x1a8)](_0x1d66e9=>{return _0x1d66e9={'product_name':_0x1d66e9};});_0x37c59b['forEach']((_0x260d5b,_0x4e31b4)=>{var _0x4050ac=_0x53fad2;_0x20f454[_0x4e31b4][_0x4050ac(0x22a)]=_0x260d5b;}),_0x29e6db[_0x53fad2(0x235)]((_0x1e88d3,_0x306743)=>{var _0x34e0a9=_0x53fad2;_0x20f454[_0x306743][_0x34e0a9(0x163)]=_0x1e88d3;}),_0x2f6e85[_0x53fad2(0x235)]((_0x1ff42e,_0x595893)=>{var _0x5e7b6d=_0x53fad2;_0x20f454[_0x595893][_0x5e7b6d(0x247)]=_0x1ff42e;}),_0x48931d[_0x53fad2(0x235)]((_0x187de3,_0x1c3a27)=>{var _0x39c3f4=_0x53fad2;_0x20f454[_0x1c3a27][_0x39c3f4(0x1c5)]=_0x187de3;}),_0x3c5db8[_0x53fad2(0x235)]((_0x1cc71d,_0x32aea4)=>{var _0x23824f=_0x53fad2;_0x20f454[_0x32aea4][_0x23824f(0x174)]=Math[_0x23824f(0x15c)](_0x1cc71d);}),_0x1cd99d['forEach']((_0x107df3,_0x291218)=>{_0x20f454[_0x291218]['standard_unit']=_0x107df3;}),_0x599b1f[_0x53fad2(0x235)]((_0x183cf8,_0xf47374)=>{_0x20f454[_0xf47374]['secondary_unit']=_0x183cf8;}),_0xcd5af7['forEach']((_0x4d01c9,_0x5d5c08)=>{var _0x51486e=_0x53fad2,_0x127897=_0x4d01c9['match'](/[A-Za-z]+/)[0x0],_0x35310f=parseInt(_0x4d01c9[_0x51486e(0x18d)](/\d+/)[0x0]);_0x20f454[_0x5d5c08]['level']=_0x127897,_0x20f454[_0x5d5c08]['bay']=_0x35310f;}),_0x349704[_0x53fad2(0x235)]((_0xf1198d,_0x2d3e84)=>{var _0x55f475=_0x53fad2;_0x20f454[_0x2d3e84][_0x55f475(0x23d)]=_0xf1198d;}),_0x5dcfd3[_0x53fad2(0x235)]((_0x950c1b,_0x391e9e)=>{var _0x48f294=_0x53fad2;_0x20f454[_0x391e9e][_0x48f294(0x18a)]=_0x950c1b;}),_0x12eb16['forEach']((_0xd57871,_0x5a6de9)=>{var _0x5520f3=_0x53fad2;_0x20f454[_0x5a6de9][_0x5520f3(0x246)]=_0xd57871;}),_0x2ee4cb[_0x53fad2(0x235)]((_0x5d7ae9,_0x4b7579)=>{var _0x8e1738=_0x53fad2;_0x20f454[_0x4b7579][_0x8e1738(0x23c)]=_0x5d7ae9;}),_0x38747f[_0x53fad2(0x235)]((_0x8ff27d,_0x4a84d8)=>{var _0x2a79cd=_0x53fad2;_0x20f454[_0x4a84d8][_0x2a79cd(0x205)]=_0x8ff27d;}),_0x17baab[_0x53fad2(0x235)]((_0x37375f,_0x5cbc3f)=>{var _0x108a4d=_0x53fad2;_0x20f454[_0x5cbc3f][_0x108a4d(0x21c)]=_0x37375f;}),_0x2bd342[_0x53fad2(0x235)]((_0x45bb0d,_0xbce114)=>{var _0x313f6c=_0x53fad2;_0x20f454[_0xbce114][_0x313f6c(0x1f2)]=_0x45bb0d;}),_0x5b35be[_0x53fad2(0x235)]((_0x49679f,_0x59016c)=>{var _0x36ee6f=_0x53fad2;_0x20f454[_0x59016c][_0x36ee6f(0x144)]=_0x49679f;}),_0x39f6e8[_0x53fad2(0x235)]((_0x24d9d6,_0x584b2f)=>{_0x20f454[_0x584b2f]['room_name']=_0x24d9d6;}),_0x276faf[_0x53fad2(0x235)]((_0xfee0f4,_0x196587)=>{var _0x470531=_0x53fad2;_0x20f454[_0x196587][_0x470531(0x231)]=_0xfee0f4;});const _0x2dc106=new purchases_logs();await _0x2dc106['save']();for(let _0x28a639=0x0;_0x28a639<=_0x39f6e8[_0x53fad2(0x24d)]-0x1;_0x28a639++){_0x20f454[_0x28a639][_0x53fad2(0x18e)]=_0x53fad2(0x25b)+_0x2dc106['invoice_init'][_0x53fad2(0x16f)]()['padStart'](0x8,'0');}const _0x4c804a=_0x20f454[_0x53fad2(0x1cf)](_0x206c6c=>_0x206c6c[_0x53fad2(0x174)]!=='0'&&_0x206c6c[_0x53fad2(0x174)]!==''),_0x459ca3=new purchases_finished({'invoice':_0x53fad2(0x25b)+_0x2dc106['invoice_init'][_0x53fad2(0x16f)]()[_0x53fad2(0x175)](0x8,'0'),'suppliers':_0x59f7a2,'date':_0x49e317,'warehouse_name':_0x25e6b3,'product':_0x4c804a,'note':_0x224533,'due_amount':_0x3c074d,'room':_0x39112d,'POnumber':_0x44683c,'SCRN':_0x14e20,'JO_number':_0xf2dbcd,'ReqBy':_0x5cca13,'dateofreq':_0x3e0078,'typeservicesData':_0x1da88a,'van':_0x3cb197,'typevehicle':_0x4bf5e9,'driver':_0x1c9036,'plate':_0x4f7eb2,'DRSI':_0x227917,'TSU':_0x58bdea,'TFU':_0x28dcbf,'typeOfProducts':_0x457b69}),_0x5b428e=await _0x459ca3[_0x53fad2(0x226)](),_0x4bd210=await purchases_finished[_0x53fad2(0x197)]({'_id':_0x5b428e[_0x53fad2(0x136)][_0x53fad2(0x1f8)]()}),_0x2b370e=_0x4bd210[_0x53fad2(0x159)][_0x53fad2(0x1a8)](async _0x14e782=>{var _0x59aa01=_0x53fad2;try{var _0x4290b8=await warehouse['findOne']({'name':_0x25e6b3,'room':_0x14e782[_0x59aa01(0x173)]}),_0x519a43=0x0;const _0x4f6c43=_0x4290b8[_0x59aa01(0x19d)][_0x59aa01(0x1a8)](_0x365398=>{var _0x1fe9f6=_0x59aa01;console['log'](_0x365398[_0x1fe9f6(0x1d7)]+'=='+_0x14e782['product_name']+'&&'+_0x365398[_0x1fe9f6(0x1b7)]+'=='+_0x14e782[_0x1fe9f6(0x1b7)]+'&&'+_0x365398[_0x1fe9f6(0x205)]+'=='+_0x14e782[_0x1fe9f6(0x205)]+'&&'+_0x365398[_0x1fe9f6(0x21c)]+'=='+_0x14e782[_0x1fe9f6(0x21c)]+'&&'+_0x365398['batch_code']+'=='+_0x14e782[_0x1fe9f6(0x23c)]+'&&'+_0x365398['invoice']+'=='+_0x4bd210[_0x1fe9f6(0x18e)]),_0x365398['product_name']==_0x14e782['product_name']&&_0x365398[_0x1fe9f6(0x1b7)]==_0x14e782[_0x1fe9f6(0x1b7)]&&_0x365398[_0x1fe9f6(0x192)]==_0x14e782[_0x1fe9f6(0x192)]&&_0x365398[_0x1fe9f6(0x205)]==_0x14e782['expiry_date']&&_0x365398[_0x1fe9f6(0x21c)]==_0x14e782[_0x1fe9f6(0x21c)]&&_0x365398[_0x1fe9f6(0x23c)]==_0x14e782['batch_code']&&_0x365398[_0x1fe9f6(0x18e)]==_0x4bd210[_0x1fe9f6(0x18e)]&&(_0x365398[_0x1fe9f6(0x189)]=Math[_0x1fe9f6(0x15c)](_0x365398[_0x1fe9f6(0x189)])+Math['abs'](_0x14e782[_0x1fe9f6(0x174)]),_0x519a43++);});return _0x519a43==0x0&&(_0x4290b8['product_details']=_0x4290b8[_0x59aa01(0x19d)][_0x59aa01(0x157)]({'product_name':_0x14e782[_0x59aa01(0x1d7)],'product_stock':Math[_0x59aa01(0x15c)](_0x14e782[_0x59aa01(0x174)]),'primary_code':_0x14e782['primary_code'],'secondary_code':_0x14e782[_0x59aa01(0x18a)],'product_code':_0x14e782[_0x59aa01(0x247)],'bay':_0x14e782[_0x59aa01(0x1b7)],'level':_0x14e782[_0x59aa01(0x192)],'maxProducts':_0x14e782['maxStocks'],'unit':_0x14e782[_0x59aa01(0x190)],'secondary_unit':_0x14e782['secondary_unit'],'expiry_date':_0x14e782[_0x59aa01(0x205)],'production_date':_0x14e782[_0x59aa01(0x21c)],'maxProducts':_0x14e782[_0x59aa01(0x246)],'maxPerUnit':_0x14e782[_0x59aa01(0x1f2)],'batch_code':_0x14e782[_0x59aa01(0x23c)],'product_cat':_0x14e782[_0x59aa01(0x144)],'invoice':_0x14e782[_0x59aa01(0x18e)],'id_incoming':_0x14e782['_id'],'uuid':_0x14e782[_0x59aa01(0x1c5)],'gross_price':_0x14e782[_0x59aa01(0x231)],'sales_category':_0x14e782['sales_category'],'type_products':_0x14e782[_0x59aa01(0x22a)]})),_0x4290b8;}catch(_0x269b1f){return console[_0x59aa01(0x27a)](_0x59aa01(0x259),_0x269b1f),null;}});Promise[_0x53fad2(0x22e)](_0x2b370e)[_0x53fad2(0x148)](async _0x2e1fe0=>{var _0x16586c=_0x53fad2;try{for(const _0x175a8b of _0x2e1fe0){await warehouse[_0x16586c(0x1d5)]({'_id':_0x175a8b[_0x16586c(0x136)]},{'$addToSet':{'product_details':{'$each':_0x175a8b['product_details']}}});}const _0x1650b7=await master_shop[_0x16586c(0x1d3)](),_0x1d2dd3=await email_settings[_0x16586c(0x197)](),_0x19d7e8=await supervisor_settings[_0x16586c(0x1d3)]();var _0x49ecdc=_0x4bd210[_0x16586c(0x159)],_0x5b1dd3='',_0x2e6669;for(_0x2e6669 in _0x49ecdc){var _0x4edff8='FG';_0x4bd210['warehouse_name']==_0x16586c(0x146)&&(_0x4edff8='DG'),_0x5b1dd3+=_0x16586c(0x182)+_0x16586c(0x12d)+_0x49ecdc[_0x2e6669][_0x16586c(0x1d7)]+_0x16586c(0x23e)+_0x16586c(0x12d)+_0x49ecdc[_0x2e6669][_0x16586c(0x247)]+'</td>'+_0x16586c(0x12d)+_0x49ecdc[_0x2e6669]['quantity']+_0x16586c(0x23e)+_0x16586c(0x12d)+_0x49ecdc[_0x2e6669]['standard_unit']+_0x16586c(0x23e)+_0x16586c(0x12d)+_0x49ecdc[_0x2e6669][_0x16586c(0x1b6)]+_0x16586c(0x23e)+_0x16586c(0x12d)+_0x4bd210[_0x16586c(0x211)]+_0x16586c(0x23e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x49ecdc[_0x2e6669][_0x16586c(0x173)]+_0x16586c(0x23e)+_0x16586c(0x12d)+_0x4edff8+_0x49ecdc[_0x2e6669]['bay']+_0x16586c(0x23e),_0x16586c(0x18c);}let _0x250e68=nodemailer[_0x16586c(0x165)]({'host':_0x1d2dd3[_0x16586c(0x12f)],'port':Number(_0x1d2dd3[_0x16586c(0x1bc)]),'secure':![],'auth':{'user':_0x1d2dd3[_0x16586c(0x24b)],'pass':_0x1d2dd3[_0x16586c(0x244)]}}),_0x505e59={'from':_0x1d2dd3[_0x16586c(0x24b)],'to':_0x19d7e8[0x0][_0x16586c(0x217)],'subject':_0x16586c(0x139),'attachments':[{'filename':_0x16586c(0x138),'path':__dirname+_0x16586c(0x1fe)+_0x16586c(0x1c9)+_0x1650b7[0x0][_0x16586c(0x152)],'cid':_0x16586c(0x13f)}],'html':_0x16586c(0x24c)+_0x16586c(0x250)+_0x16586c(0x153)+'<div>'+_0x16586c(0x158)+_0x16586c(0x26b)+_0x16586c(0x1a4)+_0x16586c(0x1ec)+_0x16586c(0x26b)+_0x16586c(0x27d)+_0x1650b7[0x0][_0x16586c(0x170)]+_0x16586c(0x17a)+_0x16586c(0x1ec)+_0x16586c(0x1ec)+_0x16586c(0x14a)+'<div>'+_0x16586c(0x248)+_0x16586c(0x185)+_0x4bd210[_0x16586c(0x18e)]+'\x20'+_0x16586c(0x1b9)+'\x20Order\x20Date\x20:\x20'+_0x4bd210[_0x16586c(0x17e)]+'\x20'+_0x16586c(0x1f6)+'</h5>'+_0x16586c(0x1ec)+_0x16586c(0x256)+_0x16586c(0x1a9)+_0x16586c(0x182)+_0x16586c(0x13c)+_0x16586c(0x1ee)+_0x16586c(0x243)+_0x16586c(0x1df)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x16586c(0x1a3)+_0x16586c(0x224)+_0x16586c(0x274)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5b1dd3+'\x20'+_0x16586c(0x1e3)+_0x16586c(0x180)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x16586c(0x171)+_0x1650b7[0x0]['site_title']+_0x16586c(0x237)+_0x16586c(0x1ec)+_0x16586c(0x1ec)+'</body></html>'};_0x250e68[_0x16586c(0x279)](_0x505e59,function(_0x388815,_0x5200f5){var _0x248d56=_0x16586c;_0x388815?(console[_0x248d56(0x17b)](_0x388815),console['log']('Error\x20Occurs')):console['log'](_0x248d56(0x273));});}catch(_0x2aacb5){console['error'](_0x2aacb5),_0x4f1f6f[_0x16586c(0x156)](0x1f4)[_0x16586c(0x12e)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x2aacb5[_0x16586c(0x1c6)]});}})[_0x53fad2(0x137)](_0x4a2ff4=>{var _0x5a83d9=_0x53fad2;console[_0x5a83d9(0x27a)](_0x4a2ff4);}),_0x43e0a7[_0x53fad2(0x265)]('success',_0x53fad2(0x1b4)),_0x4f1f6f[_0x53fad2(0x17c)](_0x53fad2(0x262)+_0x4bd210[_0x53fad2(0x136)]['valueOf']());}catch(_0x4e881b){console[_0x53fad2(0x17b)](_0x4e881b);}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x26c),auth,async(_0x31bce5,_0x4100ca)=>{var _0x2677fc=a0_0x37d3eb;try{const {username:_0x5b842d,email:_0x12356f,role:_0x27200e}=_0x31bce5[_0x2677fc(0x1ab)],_0x11c569=_0x31bce5[_0x2677fc(0x1ab)],_0x54e763=await profile[_0x2677fc(0x197)]({'email':_0x11c569[_0x2677fc(0x24b)]}),_0x47d271=await master_shop[_0x2677fc(0x1d3)](),_0x5e481a=_0x31bce5[_0x2677fc(0x225)]['id'],_0x165276=await purchases_finished[_0x2677fc(0x1f3)](_0x5e481a),_0xbd9376=await suppliers[_0x2677fc(0x1d3)]({});let _0x21841e;if(_0x11c569[_0x2677fc(0x14c)]==_0x2677fc(0x14f)){const _0x44e5ec=await staff[_0x2677fc(0x197)]({'email':_0x11c569[_0x2677fc(0x24b)]});_0x21841e=await warehouse[_0x2677fc(0x1d3)]({'status':_0x2677fc(0x19a),'name':_0x44e5ec['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x21841e=await warehouse[_0x2677fc(0x19f)]([{'$match':{'status':'Enabled','warehouse_category':_0x2677fc(0x22f)}},{'$group':{'_id':'$name','name':{'$first':_0x2677fc(0x25f)}}}]);const _0x4f7fad=await product[_0x2677fc(0x1d3)]({}),_0x10660a=BayBinSelected(_0x165276['warehouse_name'],_0x165276[_0x2677fc(0x191)]);let _0x48d33=new Date(_0x165276[_0x2677fc(0x205)]),_0x7944d5=('0'+_0x48d33['getDate']())['slice'](-0x2),_0x524a18=('0'+(_0x48d33[_0x2677fc(0x1c4)]()+0x1))[_0x2677fc(0x1f9)](-0x2),_0x250f36=_0x48d33[_0x2677fc(0x154)](),_0x65f851=_0x250f36+'-'+_0x524a18+'-'+_0x7944d5;if(_0x47d271[0x0][_0x2677fc(0x227)]==_0x2677fc(0x1e9)){var _0x3b7b98=users[_0x2677fc(0x16a)];console[_0x2677fc(0x17b)](_0x3b7b98);}else{if(_0x47d271[0x0][_0x2677fc(0x227)]=='Hindi')var _0x3b7b98=users[_0x2677fc(0x16d)];else{if(_0x47d271[0x0][_0x2677fc(0x227)]==_0x2677fc(0x1bf))var _0x3b7b98=users[_0x2677fc(0x1bf)];else{if(_0x47d271[0x0][_0x2677fc(0x227)]=='Spanish')var _0x3b7b98=users[_0x2677fc(0x142)];else{if(_0x47d271[0x0][_0x2677fc(0x227)]=='French')var _0x3b7b98=users[_0x2677fc(0x1f1)];else{if(_0x47d271[0x0][_0x2677fc(0x227)]=='Portuguese\x20(BR)')var _0x3b7b98=users[_0x2677fc(0x1de)];else{if(_0x47d271[0x0][_0x2677fc(0x227)]==_0x2677fc(0x25c))var _0x3b7b98=users[_0x2677fc(0x25c)];else{if(_0x47d271[0x0][_0x2677fc(0x227)]==_0x2677fc(0x213))var _0x3b7b98=users[_0x2677fc(0x1eb)];}}}}}}}_0x4100ca[_0x2677fc(0x166)](_0x2677fc(0x164),{'success':_0x31bce5[_0x2677fc(0x265)](_0x2677fc(0x1c8)),'errors':_0x31bce5['flash'](_0x2677fc(0x149)),'role':_0x11c569,'profile':_0x54e763,'purchases':_0x165276,'suppliers':_0xbd9376,'warehouse':_0x21841e,'product':_0x4f7fad,'master_shop':_0x47d271,'language':_0x3b7b98,'ed_fullDate':_0x65f851,'dataSelected':_0x10660a});}catch(_0x4b9ecc){console[_0x2677fc(0x17b)](_0x4b9ecc);}}),router['get'](a0_0x37d3eb(0x1f7),auth,async(_0x5a7a8d,_0x5250d9)=>{var _0x30e5b8=a0_0x37d3eb;try{const {username:_0x28dbd4,email:_0x3468a0,role:_0x100030}=_0x5a7a8d['user'],_0x540cf6=_0x5a7a8d[_0x30e5b8(0x1ab)],_0x26de4a=await profile[_0x30e5b8(0x197)]({'email':_0x540cf6[_0x30e5b8(0x24b)]}),_0x3e5719=await master_shop['find'](),_0x393ca5=_0x5a7a8d[_0x30e5b8(0x225)]['id'],_0x34f0f2=await purchases_finished['findById'](_0x393ca5),_0x1f0e63=await suppliers[_0x30e5b8(0x1d3)]({});let _0xd5e0a4;if(_0x540cf6[_0x30e5b8(0x14c)]==_0x30e5b8(0x14f)){const _0x436429=await staff[_0x30e5b8(0x197)]({'email':_0x540cf6[_0x30e5b8(0x24b)]});_0xd5e0a4=await warehouse[_0x30e5b8(0x1d3)]({'status':_0x30e5b8(0x19a),'name':_0x436429[_0x30e5b8(0x1ce)],'warehouse_category':_0x30e5b8(0x22f)});}else _0xd5e0a4=await warehouse[_0x30e5b8(0x19f)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x30e5b8(0x25f),'name':{'$first':_0x30e5b8(0x25f)}}}]);const _0x6ad921=await product[_0x30e5b8(0x1d3)]({}),_0x330ef0=BayBinSelected(_0x34f0f2['warehouse_name'],_0x34f0f2[_0x30e5b8(0x191)]);let _0x3c92ea=new Date(_0x34f0f2[_0x30e5b8(0x205)]),_0x43245e=('0'+_0x3c92ea[_0x30e5b8(0x1d9)]())[_0x30e5b8(0x1f9)](-0x2),_0x5afa5b=('0'+(_0x3c92ea[_0x30e5b8(0x1c4)]()+0x1))[_0x30e5b8(0x1f9)](-0x2),_0xaed7c5=_0x3c92ea[_0x30e5b8(0x154)](),_0x3e1096=_0xaed7c5+'-'+_0x5afa5b+'-'+_0x43245e;if(_0x3e5719[0x0][_0x30e5b8(0x227)]==_0x30e5b8(0x1e9)){var _0x177365=users[_0x30e5b8(0x16a)];console[_0x30e5b8(0x17b)](_0x177365);}else{if(_0x3e5719[0x0]['language']==_0x30e5b8(0x16d))var _0x177365=users[_0x30e5b8(0x16d)];else{if(_0x3e5719[0x0][_0x30e5b8(0x227)]==_0x30e5b8(0x1bf))var _0x177365=users[_0x30e5b8(0x1bf)];else{if(_0x3e5719[0x0]['language']=='Spanish')var _0x177365=users[_0x30e5b8(0x142)];else{if(_0x3e5719[0x0][_0x30e5b8(0x227)]==_0x30e5b8(0x1f1))var _0x177365=users['French'];else{if(_0x3e5719[0x0][_0x30e5b8(0x227)]==_0x30e5b8(0x258))var _0x177365=users[_0x30e5b8(0x1de)];else{if(_0x3e5719[0x0][_0x30e5b8(0x227)]=='Chinese')var _0x177365=users[_0x30e5b8(0x25c)];else{if(_0x3e5719[0x0][_0x30e5b8(0x227)]=='Arabic\x20(ae)')var _0x177365=users[_0x30e5b8(0x1eb)];}}}}}}}_0x5250d9[_0x30e5b8(0x166)](_0x30e5b8(0x1f4),{'success':_0x5a7a8d['flash']('success'),'errors':_0x5a7a8d[_0x30e5b8(0x265)](_0x30e5b8(0x149)),'role':_0x540cf6,'profile':_0x26de4a,'purchases':_0x34f0f2,'suppliers':_0x1f0e63,'warehouse':_0xd5e0a4,'product':_0x6ad921,'master_shop':_0x3e5719,'language':_0x177365,'ed_fullDate':_0x3e1096,'dataSelected':_0x330ef0});}catch(_0xefd71c){console[_0x30e5b8(0x17b)](_0xefd71c);}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x1f7),auth,async(_0x3c8e13,_0x456708)=>{var _0x5e08de=a0_0x37d3eb;try{const _0x4dc381=_0x3c8e13['params']['id'],_0x2e6541=await purchases_finished[_0x5e08de(0x197)]({'_id':_0x3c8e13[_0x5e08de(0x225)]['id']}),_0x18cce8=await warehouse[_0x5e08de(0x197)]({'name':_0x2e6541[_0x5e08de(0x211)],'room':_0x2e6541[_0x5e08de(0x191)]});_0x2e6541[_0x5e08de(0x159)][_0x5e08de(0x235)](_0x2bb17a=>{var _0xb2ccb8=_0x5e08de;const _0x54a171=_0x18cce8['product_details'][_0xb2ccb8(0x1a8)](_0x56167b=>{var _0xd7ea74=_0xb2ccb8;_0x56167b['product_name']==_0x2bb17a['product_name']&&_0x56167b['bay']==_0x2bb17a[_0xd7ea74(0x1b7)]&&(_0x56167b[_0xd7ea74(0x189)]=parseInt(_0x56167b[_0xd7ea74(0x189)])-parseInt(_0x2bb17a[_0xd7ea74(0x174)]));});}),await _0x18cce8[_0x5e08de(0x226)]();const {invoice:_0x4f2ced,suppliers:_0x5c2a23,date:_0x5f0af8,warehouse_name:_0x135dc2,prod_name:_0x319dda,prod_code:_0x47dfff,prod_qty:_0x511574,prod_unit:_0x4342b5,prod_secondunit:_0x5498cb,prod_level:_0x4c168f,prod_isle:_0x283d1d,prod_pallet:_0x4c6c15,note:_0x1b1e0e,expiry_date:_0xcf0da4,batch_code:_0x32f953,paid_amount:_0x3a27ee,due_amount:_0x4b2349,Room_name:_0x3af381,primary_code:_0x3fbaac,secondary_code:_0x3b29f5,PO_number:_0x544962,JO_number:_0x56aade}=_0x3c8e13[_0x5e08de(0x1db)];if(typeof _0x319dda==_0x5e08de(0x1c7))var _0x30f43d=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x20a)]],_0x3e3e1a=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x209)]],_0x6ad259=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x216)]],_0x10a72a=[_0x3c8e13[_0x5e08de(0x1db)]['prod_unit']],_0x4dfd67=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x215)]],_0x575d3f=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x1a0)]],_0x174a2a=[_0x3c8e13['body'][_0x5e08de(0x23d)]],_0x93a4b0=[_0x3c8e13[_0x5e08de(0x1db)]['secondary_code']],_0x31f91a=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x1f0)]],_0x547fd7=[_0x3c8e13[_0x5e08de(0x1db)]['batch_code']],_0x19cc04=[_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x205)]];else var _0x30f43d=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x20a)]],_0x3e3e1a=[..._0x3c8e13[_0x5e08de(0x1db)]['prod_code']],_0x6ad259=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x216)]],_0x10a72a=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x15a)]],_0x4dfd67=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x215)]],_0x575d3f=[..._0x3c8e13['body'][_0x5e08de(0x1a0)]],_0x174a2a=[..._0x3c8e13['body'][_0x5e08de(0x23d)]],_0x93a4b0=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x18a)]],_0x31f91a=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x1f0)]],_0x547fd7=[..._0x3c8e13[_0x5e08de(0x1db)]['batch_code']],_0x19cc04=[..._0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x205)]];const _0x775c42=_0x30f43d[_0x5e08de(0x1a8)](_0x148f43=>{return _0x148f43={'product_name':_0x148f43};});_0x3e3e1a['forEach']((_0x38a7a3,_0x414637)=>{var _0x530bdd=_0x5e08de;_0x775c42[_0x414637][_0x530bdd(0x247)]=_0x38a7a3;}),_0x6ad259[_0x5e08de(0x235)]((_0x146e3f,_0x52b0ef)=>{var _0x5f403b=_0x5e08de;_0x775c42[_0x52b0ef][_0x5f403b(0x174)]=_0x146e3f;}),_0x10a72a[_0x5e08de(0x235)]((_0x37ae73,_0xb20af1)=>{var _0x39611e=_0x5e08de;_0x775c42[_0xb20af1][_0x39611e(0x190)]=_0x37ae73;}),_0x4dfd67['forEach']((_0x3630e6,_0x34f92f)=>{var _0x4b7508=_0x5e08de;_0x775c42[_0x34f92f][_0x4b7508(0x1b6)]=_0x3630e6;}),_0x575d3f[_0x5e08de(0x235)]((_0x2c1d86,_0x3b685c)=>{_0x775c42[_0x3b685c]['bay']=_0x2c1d86;}),_0x174a2a['forEach']((_0x3bbbeb,_0x27f499)=>{var _0x257db6=_0x5e08de;_0x775c42[_0x27f499][_0x257db6(0x23d)]=_0x3bbbeb;}),_0x93a4b0['forEach']((_0x1b0a69,_0x50892e)=>{var _0x1a0955=_0x5e08de;_0x775c42[_0x50892e][_0x1a0955(0x18a)]=_0x1b0a69;}),_0x31f91a['forEach']((_0x44a609,_0x4836c6)=>{var _0x26e77b=_0x5e08de;_0x775c42[_0x4836c6][_0x26e77b(0x246)]=_0x44a609;}),_0x547fd7[_0x5e08de(0x235)]((_0x4ff2af,_0x50a0ca)=>{var _0x4de05d=_0x5e08de;_0x775c42[_0x50a0ca][_0x4de05d(0x23c)]=_0x4ff2af;}),_0x19cc04[_0x5e08de(0x235)]((_0x5aa5b8,_0x105450)=>{var _0x4b7ab7=_0x5e08de;_0x775c42[_0x105450][_0x4b7ab7(0x205)]=_0x5aa5b8;});const _0x3682f1=_0x775c42['filter'](_0x5ce941=>_0x5ce941['quantity']!=='0'&&_0x5ce941[_0x5e08de(0x174)]!=='');_0x2e6541['invoice']=_0x4f2ced,_0x2e6541[_0x5e08de(0x1e1)]=_0x5c2a23,_0x2e6541[_0x5e08de(0x17e)]=_0x5f0af8,_0x2e6541[_0x5e08de(0x211)]=_0x135dc2,_0x2e6541[_0x5e08de(0x159)]=_0x3682f1,_0x2e6541[_0x5e08de(0x20d)]=_0x1b1e0e,_0x2e6541[_0x5e08de(0x181)]=_0x3a27ee,_0x2e6541[_0x5e08de(0x145)]=_0x4b2349,_0x2e6541[_0x5e08de(0x191)]=_0x3af381,_0x2e6541[_0x5e08de(0x1af)]=_0x544962,_0x2e6541['JO_number']=_0x56aade;const _0x1ff910=await _0x2e6541[_0x5e08de(0x226)](),_0x66af68=await warehouse[_0x5e08de(0x197)]({'name':_0x3c8e13['body'][_0x5e08de(0x211)],'room':_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x268)]});_0x2e6541[_0x5e08de(0x159)][_0x5e08de(0x235)](_0x48880a=>{var _0x2c5641=_0x5e08de,_0x1bf945=0x0;const _0x5caa91=_0x66af68[_0x2c5641(0x19d)][_0x2c5641(0x1a8)](_0xf7504f=>{var _0x4812b3=_0x2c5641;_0xf7504f[_0x4812b3(0x1d7)]==_0x48880a[_0x4812b3(0x1d7)]&&_0xf7504f['bay']==_0x48880a['bay']&&(_0xf7504f[_0x4812b3(0x189)]=parseInt(_0xf7504f[_0x4812b3(0x189)])+parseInt(_0x48880a[_0x4812b3(0x174)]),_0x1bf945++);});_0x1bf945=='0'&&(_0x66af68[_0x2c5641(0x19d)]=_0x66af68[_0x2c5641(0x19d)][_0x2c5641(0x157)]({'product_name':_0x48880a['product_name'],'product_stock':_0x48880a[_0x2c5641(0x174)],'primary_code':_0x48880a['primary_code'],'secondary_code':_0x48880a['secondary_code'],'product_code':_0x48880a[_0x2c5641(0x247)],'bay':_0x48880a['bay'],'maxProducts':_0x48880a[_0x2c5641(0x246)],'unit':_0x48880a[_0x2c5641(0x190)],'secondary_unit':_0x48880a[_0x2c5641(0x1b6)],'expiry_date':_0x48880a[_0x2c5641(0x205)]}));}),await _0x66af68[_0x5e08de(0x226)]();const _0x2580ab=await s_payment_data[_0x5e08de(0x197)]({'invoice':_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x18e)]});if(_0x2580ab===null){}else console[_0x5e08de(0x17b)](_0x5e08de(0x1e1),_0x2580ab,_0x3c8e13['body']['invoice']),_0x2580ab[_0x5e08de(0x1e1)]=_0x3c8e13[_0x5e08de(0x1db)][_0x5e08de(0x1e1)],await _0x2580ab[_0x5e08de(0x226)]();_0x3c8e13[_0x5e08de(0x265)](_0x5e08de(0x1c8),_0x5e08de(0x1be)),_0x456708['redirect']('/all_purchases_finished/view');}catch(_0x2ceafa){console['log'](_0x2ceafa);}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x162),auth,async(_0x849138,_0x1c9c44)=>{var _0x47c2dc=a0_0x37d3eb;try{const _0x1097c4=_0x849138[_0x47c2dc(0x225)]['id'],{invoice:_0x3a4a47,suppliers:_0x5a132b,payable:_0x2cca0b,due_amount:_0x541f0f}=_0x849138[_0x47c2dc(0x1db)],_0x242e66=await purchases[_0x47c2dc(0x1f3)](_0x1097c4);var _0x13be71=_0x2cca0b-_0x541f0f;_0x242e66[_0x47c2dc(0x181)]=parseFloat(_0x242e66[_0x47c2dc(0x181)])+parseFloat(_0x541f0f),_0x242e66[_0x47c2dc(0x145)]=_0x13be71;const _0x351323=await _0x242e66['save']();console[_0x47c2dc(0x17b)](_0x351323);const _0x3c07d8=await s_payment_data[_0x47c2dc(0x197)]({'invoice':_0x3a4a47});_0x3c07d8[_0x47c2dc(0x19b)]=_0x13be71,await _0x3c07d8[_0x47c2dc(0x226)]();let _0x3cef93=new Date(),_0x5f4894=('0'+_0x3cef93['getDate']())[_0x47c2dc(0x1f9)](-0x2),_0xc3c0de=('0'+(_0x3cef93[_0x47c2dc(0x1c4)]()+0x1))[_0x47c2dc(0x1f9)](-0x2),_0x413392=_0x3cef93[_0x47c2dc(0x154)](),_0x63eb9f=_0x413392+'-'+_0xc3c0de+'-'+_0x5f4894;const _0x3f726f=new suppliers_payment({'invoice':_0x3a4a47,'date':_0x413392+'-'+_0xc3c0de+'-'+_0x5f4894,'suppliers':_0x5a132b,'reason':_0x47c2dc(0x186),'amount':_0x541f0f}),_0x534faa=await _0x3f726f[_0x47c2dc(0x226)]();_0x849138[_0x47c2dc(0x265)]('success',_0x47c2dc(0x1b2)),_0x1c9c44[_0x47c2dc(0x17c)]('/all_purchases/view');}catch(_0x5b6bfa){console['log'](_0x5b6bfa);}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x1e2),auth,async(_0x230538,_0x4085fb)=>{var _0x3f1288=a0_0x37d3eb;try{const {username:_0x3fb70d,email:_0x4145b8,role:_0x40ed51}=_0x230538[_0x3f1288(0x1ab)],_0x46a2f5=_0x230538['user'],_0x40facd=await profile[_0x3f1288(0x197)]({'email':_0x46a2f5[_0x3f1288(0x24b)]}),_0x2dbcf4=await master_shop[_0x3f1288(0x1d3)]();console[_0x3f1288(0x17b)](_0x3f1288(0x178),_0x2dbcf4);const _0x5935bf=_0x230538[_0x3f1288(0x225)]['id'],_0x227664=await purchases[_0x3f1288(0x1f3)](_0x5935bf);console[_0x3f1288(0x17b)](_0x227664);const _0x499a49=await suppliers[_0x3f1288(0x197)]({'name':_0x227664['suppliers']});console[_0x3f1288(0x17b)](_0x499a49);if(_0x2dbcf4[0x0][_0x3f1288(0x227)]==_0x3f1288(0x1e9)){var _0x43fa45=users['English'];console[_0x3f1288(0x17b)](_0x43fa45);}else{if(_0x2dbcf4[0x0]['language']==_0x3f1288(0x16d))var _0x43fa45=users[_0x3f1288(0x16d)];else{if(_0x2dbcf4[0x0]['language']==_0x3f1288(0x1bf))var _0x43fa45=users[_0x3f1288(0x1bf)];else{if(_0x2dbcf4[0x0][_0x3f1288(0x227)]==_0x3f1288(0x142))var _0x43fa45=users[_0x3f1288(0x142)];else{if(_0x2dbcf4[0x0]['language']=='French')var _0x43fa45=users[_0x3f1288(0x1f1)];else{if(_0x2dbcf4[0x0][_0x3f1288(0x227)]==_0x3f1288(0x258))var _0x43fa45=users[_0x3f1288(0x1de)];else{if(_0x2dbcf4[0x0][_0x3f1288(0x227)]=='Chinese')var _0x43fa45=users[_0x3f1288(0x25c)];else{if(_0x2dbcf4[0x0][_0x3f1288(0x227)]==_0x3f1288(0x213))var _0x43fa45=users['Arabic'];}}}}}}}_0x4085fb[_0x3f1288(0x166)](_0x3f1288(0x150),{'success':_0x230538[_0x3f1288(0x265)](_0x3f1288(0x1c8)),'errors':_0x230538[_0x3f1288(0x265)](_0x3f1288(0x149)),'role':_0x46a2f5,'profile':_0x40facd,'master_shop':_0x2dbcf4,'supplier':_0x499a49,'purchase':_0x227664,'language':_0x43fa45});}catch(_0x4f410d){console[_0x3f1288(0x17b)](_0x4f410d);}}),router['get'](a0_0x37d3eb(0x194),auth,async(_0x281fdf,_0xf2d982)=>{var _0x234cb0=a0_0x37d3eb;try{const {username:_0x59aeba,email:_0x116333,role:_0x10fb90}=_0x281fdf['user'],_0x34444a=_0x281fdf[_0x234cb0(0x1ab)],_0xd68e97=await profile['findOne']({'email':_0x34444a['email']}),_0xdbd403=await master_shop[_0x234cb0(0x1d3)]();console[_0x234cb0(0x17b)]('master',_0xdbd403);const _0x49668e=_0x281fdf[_0x234cb0(0x225)]['id'];console['log'](_0x49668e);const _0xe9e7dc=await purchases_finished[_0x234cb0(0x1f3)](_0x49668e);console[_0x234cb0(0x17b)](_0x234cb0(0x27c),_0xe9e7dc);const _0x1f34d0=await product[_0x234cb0(0x1d3)]({}),_0x55a384=await warehouse['aggregate']([{'$match':{'name':_0xe9e7dc['warehouse_name'],'room':_0xe9e7dc['room']}},{'$unwind':_0x234cb0(0x20e)},{'$group':{'_id':_0x234cb0(0x16e),'name':{'$first':_0x234cb0(0x15e)},'product_stock':{'$first':_0x234cb0(0x1dc)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x234cb0(0x17d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x234cb0(0x140)},'primary_code':{'$first':_0x234cb0(0x1a2)},'secondary_code':{'$first':_0x234cb0(0x253)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x234cb0(0x204)},'rack':{'$first':_0x234cb0(0x212)}}}]);console[_0x234cb0(0x17b)](_0x234cb0(0x168),_0x55a384);let _0x2b8cae;if(_0x34444a[_0x234cb0(0x14c)]==_0x234cb0(0x14f)){const _0x36db83=await staff[_0x234cb0(0x197)]({'email':_0x34444a['email']});_0x2b8cae=await warehouse[_0x234cb0(0x1d3)]({'status':'Enabled','name':_0x36db83['warehouse'],'warehouse_category':'Finished\x20Goods','name':_0x234cb0(0x1d2)});}else _0x2b8cae=await warehouse[_0x234cb0(0x19f)]([{'$match':{'status':_0x234cb0(0x19a),'warehouse_category':_0x234cb0(0x22f),'name':_0x234cb0(0x1d2)}},{'$group':{'_id':_0x234cb0(0x25f),'name':{'$first':_0x234cb0(0x25f)}}}]);if(_0xdbd403[0x0][_0x234cb0(0x227)]==_0x234cb0(0x1e9)){var _0xa0746=users[_0x234cb0(0x16a)];console['log'](_0xa0746);}else{if(_0xdbd403[0x0][_0x234cb0(0x227)]=='Hindi')var _0xa0746=users[_0x234cb0(0x16d)];else{if(_0xdbd403[0x0][_0x234cb0(0x227)]==_0x234cb0(0x1bf))var _0xa0746=users[_0x234cb0(0x1bf)];else{if(_0xdbd403[0x0][_0x234cb0(0x227)]==_0x234cb0(0x142))var _0xa0746=users[_0x234cb0(0x142)];else{if(_0xdbd403[0x0][_0x234cb0(0x227)]==_0x234cb0(0x1f1))var _0xa0746=users['French'];else{if(_0xdbd403[0x0][_0x234cb0(0x227)]=='Portuguese\x20(BR)')var _0xa0746=users[_0x234cb0(0x1de)];else{if(_0xdbd403[0x0][_0x234cb0(0x227)]==_0x234cb0(0x25c))var _0xa0746=users['Chinese'];else{if(_0xdbd403[0x0][_0x234cb0(0x227)]=='Arabic\x20(ae)')var _0xa0746=users['Arabic'];}}}}}}}_0xf2d982[_0x234cb0(0x166)]('return_purchase_finished',{'success':_0x281fdf[_0x234cb0(0x265)]('success'),'errors':_0x281fdf['flash'](_0x234cb0(0x149)),'role':_0x34444a,'profile':_0xd68e97,'user':_0xe9e7dc,'stock':_0x55a384,'master_shop':_0xdbd403,'product':_0x1f34d0,'language':_0xa0746,'warehouse':_0x2b8cae});}catch(_0x19cd8c){console[_0x234cb0(0x17b)](_0x19cd8c);}}),router['post'](a0_0x37d3eb(0x194),auth,async(_0x432318,_0x197381)=>{var _0x538cf4=a0_0x37d3eb;try{const {invoice:_0x46f538,date:_0x5952fc,warehouse_name:_0x4fbf0f,Room_name:_0x214b56,product_name:_0x374813,purchase_quantity:_0x40843c,stocks:_0x214e3b,return_qty:_0x8ea54f,note:_0x45f0c2,level:_0x1dc9e3,isle:_0x23c339,pallet:_0x14c726,to_warehouse_name:_0x302b0b,to_Room_name:_0x3daae6}=_0x432318[_0x538cf4(0x1db)],_0x2a8c29=await purchases_finished[_0x538cf4(0x197)]({'_id':_0x432318[_0x538cf4(0x225)]['id']}),_0x5c131d=await warehouse[_0x538cf4(0x197)]({'name':_0x4fbf0f,'room':_0x214b56,'warehouse_category':_0x538cf4(0x22f)});if(typeof _0x374813=='string')var _0x5929a5=[_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1d7)]],_0x16b631=[_0x432318['body'][_0x538cf4(0x1aa)]],_0x32c9b6=[_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x21f)]],_0x5a778e=[_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x208)]],_0x35598c=[_0x432318[_0x538cf4(0x1db)]['level']],_0x598202=[_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1ca)]],_0x4bf6c8=[_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1fc)]],_0xd30bf8=[_0x432318[_0x538cf4(0x1db)]['secondary_code_hide']];else var _0x5929a5=[..._0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1d7)]],_0x16b631=[..._0x432318[_0x538cf4(0x1db)]['purchase_quantity']],_0x32c9b6=[..._0x432318['body'][_0x538cf4(0x21f)]],_0x5a778e=[..._0x432318[_0x538cf4(0x1db)]['return_qty']],_0x35598c=[..._0x432318[_0x538cf4(0x1db)][_0x538cf4(0x192)]],_0x598202=[..._0x432318['body'][_0x538cf4(0x1ca)]],_0x4bf6c8=[..._0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1fc)]],_0xd30bf8=[..._0x432318['body'][_0x538cf4(0x27f)]];const _0x306539=_0x5929a5['map'](_0x433df9=>{return _0x433df9={'product_name':_0x433df9};});_0x16b631[_0x538cf4(0x235)]((_0x11e03f,_0x14789c)=>{var _0x37e326=_0x538cf4;_0x306539[_0x14789c][_0x37e326(0x1aa)]=_0x11e03f;}),_0x32c9b6[_0x538cf4(0x235)]((_0x5f590a,_0x46df00)=>{var _0x52efa8=_0x538cf4;_0x306539[_0x46df00][_0x52efa8(0x18b)]=_0x5f590a;}),_0x5a778e[_0x538cf4(0x235)]((_0x24e586,_0x169cc9)=>{_0x306539[_0x169cc9]['return_qty']=_0x24e586;}),_0x35598c['forEach']((_0x3487a3,_0x23a7c0)=>{var _0x3e3473=_0x538cf4;_0x306539[_0x23a7c0][_0x3e3473(0x1b7)]=_0x3487a3;}),_0x598202[_0x538cf4(0x235)]((_0x252353,_0x1acd82)=>{var _0x138d75=_0x538cf4;_0x306539[_0x1acd82][_0x138d75(0x247)]=_0x252353;}),_0x4bf6c8['forEach']((_0x4e650d,_0x511392)=>{var _0x50c695=_0x538cf4;_0x306539[_0x511392][_0x50c695(0x23d)]=_0x4e650d;}),_0xd30bf8[_0x538cf4(0x235)]((_0x7fea60,_0xf0220a)=>{var _0x324dc3=_0x538cf4;_0x306539[_0xf0220a][_0x324dc3(0x18a)]=_0x7fea60;}),_0x306539['forEach'](_0x56be74=>{var _0x3d1cbd=_0x538cf4;console[_0x3d1cbd(0x17b)](_0x56be74);const _0x20ed26=_0x5c131d['product_details'][_0x3d1cbd(0x1a8)](_0x1a9259=>{var _0x3c0623=_0x3d1cbd;_0x1a9259[_0x3c0623(0x1d7)]==_0x56be74[_0x3c0623(0x1d7)]&&_0x1a9259[_0x3c0623(0x1b7)]==_0x56be74[_0x3c0623(0x1b7)]&&(console[_0x3c0623(0x17b)](parseInt(_0x1a9259[_0x3c0623(0x189)])+_0x3c0623(0x1d6)+parseInt(_0x56be74[_0x3c0623(0x208)])),_0x1a9259['product_stock']=parseInt(_0x1a9259[_0x3c0623(0x189)])-parseInt(_0x56be74[_0x3c0623(0x208)]));});}),await _0x5c131d[_0x538cf4(0x226)]();var _0x9ee6ad=0x0;_0x306539[_0x538cf4(0x235)](_0x476c28=>{var _0x339bd8=_0x538cf4;(parseInt(_0x476c28[_0x339bd8(0x1aa)])<parseInt(_0x476c28[_0x339bd8(0x208)])||parseInt(_0x476c28['stock_quantity'])<parseInt(_0x476c28[_0x339bd8(0x208)]))&&_0x9ee6ad++;});if(_0x9ee6ad!=0x0)return _0x432318[_0x538cf4(0x265)](_0x538cf4(0x149),_0x538cf4(0x13d)),_0x197381[_0x538cf4(0x17c)](_0x538cf4(0x255));const _0x38f9df=new purchases_return_finished({'invoice':_0x46f538,'suppliers':_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1e1)],'date':_0x5952fc,'warehouse_name':_0x4fbf0f,'return_product':_0x306539,'note':_0x45f0c2,'room':_0x214b56,'to_warehouse_name':_0x302b0b,'to_room':_0x3daae6}),_0x1cb536=await _0x38f9df[_0x538cf4(0x226)](),_0x334c76=await purchases_return_finished[_0x538cf4(0x197)]({'invoice':_0x46f538}),_0xaa28fd=await warehouse[_0x538cf4(0x197)]({'name':_0x302b0b,'room':_0x3daae6,'warehouse_category':_0x538cf4(0x22f)});_0x334c76[_0x538cf4(0x177)][_0x538cf4(0x235)](_0x576de4=>{var _0x10e4a8=_0x538cf4,_0x2933db=0x0;const _0x28a353=_0xaa28fd[_0x10e4a8(0x19d)]['map'](_0x47cdf5=>{var _0x159fa8=_0x10e4a8;console[_0x159fa8(0x17b)](_0x47cdf5[_0x159fa8(0x1d7)]+'=='+_0x576de4[_0x159fa8(0x1d7)]+'&&'+_0x47cdf5[_0x159fa8(0x1b7)]+'=='+_0x576de4[_0x159fa8(0x1b7)]),_0x47cdf5[_0x159fa8(0x1d7)]==_0x576de4[_0x159fa8(0x1d7)]&&_0x47cdf5[_0x159fa8(0x1b7)]==_0x576de4[_0x159fa8(0x1b7)]&&(_0x47cdf5[_0x159fa8(0x189)]=parseInt(_0x47cdf5[_0x159fa8(0x189)])-parseInt(_0x576de4[_0x159fa8(0x208)]),_0x2933db++);});_0x2933db=='0'&&(_0xaa28fd[_0x10e4a8(0x19d)]=_0xaa28fd['product_details']['concat']({'product_name':_0x576de4['product_name'],'product_stock':_0x576de4[_0x10e4a8(0x208)],'primary_code':_0x576de4[_0x10e4a8(0x23d)],'secondary_code':_0x576de4[_0x10e4a8(0x18a)],'product_code':_0x576de4[_0x10e4a8(0x247)],'bay':_0x576de4['bay'],'maxProducts':0xf423f}));}),await _0xaa28fd[_0x538cf4(0x226)]();const _0x25fa61=await purchases_finished['findOne']({'invoice':_0x46f538});_0x25fa61['return_data']=_0x538cf4(0x1f5);const _0x20208c=await _0x25fa61[_0x538cf4(0x226)](),_0x3db1e2=new s_payment_data({'invoice':_0x46f538,'suppliers':_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1e1)],'reason':'Purchase\x20Return'});await _0x3db1e2[_0x538cf4(0x226)]();const _0x2e0755=await master_shop[_0x538cf4(0x1d3)](),_0x490c83=await email_settings[_0x538cf4(0x197)](),_0x104d46=await suppliers[_0x538cf4(0x197)]({'name':_0x432318[_0x538cf4(0x1db)][_0x538cf4(0x1e1)]});_0x2e0755[0x0][_0x538cf4(0x1a1)]==0x1?(right_currency=_0x2e0755[0x0][_0x538cf4(0x261)],left_currency=''):(right_currency='',left_currency=_0x2e0755[0x0][_0x538cf4(0x261)]);var _0x16910f=_0x5929a5,_0x5c3cb3=_0x5a778e,_0x362884='',_0x124db4;for(_0x124db4 in _0x16910f){_0x362884+=_0x538cf4(0x182)+_0x538cf4(0x12d)+_0x16910f[_0x124db4]+_0x538cf4(0x23e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c3cb3[_0x124db4]+_0x538cf4(0x23e)+_0x538cf4(0x18c);}let _0x31bdae=nodemailer[_0x538cf4(0x165)]({'service':'gmail','auth':{'user':_0x490c83[_0x538cf4(0x24b)],'pass':_0x490c83[_0x538cf4(0x244)]}}),_0x3f71fd={'from':_0x490c83[_0x538cf4(0x24b)],'to':_0x104d46[_0x538cf4(0x24b)],'subject':_0x538cf4(0x1e0),'attachments':[{'filename':_0x538cf4(0x138),'path':__dirname+_0x538cf4(0x1fe)+_0x538cf4(0x1c9)+_0x2e0755[0x0]['image'],'cid':_0x538cf4(0x13f)}],'html':_0x538cf4(0x24c)+_0x538cf4(0x250)+'</head><body>'+_0x538cf4(0x26b)+_0x538cf4(0x158)+_0x538cf4(0x26b)+_0x538cf4(0x1a4)+_0x538cf4(0x1ec)+'<div>'+_0x538cf4(0x27d)+_0x2e0755[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x538cf4(0x1ec)+_0x538cf4(0x14a)+_0x538cf4(0x26b)+_0x538cf4(0x248)+_0x538cf4(0x185)+_0x46f538+'\x20'+_0x538cf4(0x1b9)+_0x538cf4(0x221)+_0x5952fc+'\x20'+_0x538cf4(0x1f6)+_0x538cf4(0x237)+_0x538cf4(0x1ec)+_0x538cf4(0x256)+_0x538cf4(0x1a9)+_0x538cf4(0x182)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x538cf4(0x188)+_0x538cf4(0x26a)+_0x538cf4(0x18c)+_0x538cf4(0x249)+_0x538cf4(0x280)+'\x20'+_0x362884+'\x20'+'</tbody>'+_0x538cf4(0x180)+_0x538cf4(0x26b)+_0x538cf4(0x219)+'<h5>'+_0x2e0755[0x0][_0x538cf4(0x170)]+_0x538cf4(0x237)+_0x538cf4(0x1ec)+'</div>'+'</body></html>'};_0x31bdae[_0x538cf4(0x279)](_0x3f71fd,function(_0x22b967,_0x32b253){var _0x5cc76f=_0x538cf4;_0x22b967?console[_0x5cc76f(0x17b)](_0x5cc76f(0x1b0)):console[_0x5cc76f(0x17b)](_0x5cc76f(0x273));}),_0x432318[_0x538cf4(0x265)]('success',_0x538cf4(0x20c)),_0x197381[_0x538cf4(0x17c)](_0x538cf4(0x1ff));}catch(_0x1d49f9){_0x197381[_0x538cf4(0x156)](0xc8)[_0x538cf4(0x12e)]({'message':_0x1d49f9[_0x538cf4(0x1c6)]});}}),router[a0_0x37d3eb(0x218)](a0_0x37d3eb(0x1bb),auth,async(_0x472bc6,_0x2d0a82)=>{var _0x2a0608=a0_0x37d3eb;try{const {username:_0x2bc6c5,email:_0x5ed2d1,role:_0x420ccd}=_0x472bc6[_0x2a0608(0x1ab)],_0x5b71a9=_0x472bc6[_0x2a0608(0x1ab)],_0x4c961e=await profile['findOne']({'email':_0x5b71a9[_0x2a0608(0x24b)]}),_0x367751=await master_shop['find'](),_0x4cbd24=_0x472bc6[_0x2a0608(0x225)]['id'],_0x38c90d=await purchases_finished['findById'](_0x4cbd24);if(_0x367751[0x0][_0x2a0608(0x227)]==_0x2a0608(0x1e9))var _0x1d8ccd=users['English'];else{if(_0x367751[0x0][_0x2a0608(0x227)]==_0x2a0608(0x16d))var _0x1d8ccd=users[_0x2a0608(0x16d)];else{if(_0x367751[0x0][_0x2a0608(0x227)]==_0x2a0608(0x1bf))var _0x1d8ccd=users[_0x2a0608(0x1bf)];else{if(_0x367751[0x0]['language']==_0x2a0608(0x142))var _0x1d8ccd=users[_0x2a0608(0x142)];else{if(_0x367751[0x0][_0x2a0608(0x227)]==_0x2a0608(0x1f1))var _0x1d8ccd=users['French'];else{if(_0x367751[0x0][_0x2a0608(0x227)]=='Portuguese\x20(BR)')var _0x1d8ccd=users['Portuguese'];else{if(_0x367751[0x0][_0x2a0608(0x227)]==_0x2a0608(0x25c))var _0x1d8ccd=users[_0x2a0608(0x25c)];else{if(_0x367751[0x0][_0x2a0608(0x227)]==_0x2a0608(0x213))var _0x1d8ccd=users[_0x2a0608(0x1eb)];}}}}}}}_0x2d0a82[_0x2a0608(0x166)]('all_purchases_barcode',{'success':_0x472bc6[_0x2a0608(0x265)](_0x2a0608(0x1c8)),'errors':_0x472bc6['flash']('errors'),'role':_0x5b71a9,'profile':_0x4c961e,'alldata':_0x38c90d,'master_shop':_0x367751,'language':_0x1d8ccd}),console['log'](alldata);}catch(_0x5ca2bf){console[_0x2a0608(0x17b)](_0x5ca2bf);}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x23b),async(_0x25f0ac,_0x24c9d0)=>{var _0x442879=a0_0x37d3eb;const {product_code:_0x150ad9}=_0x25f0ac[_0x442879(0x1db)];var _0x149474;const _0x3fa164=await product[_0x442879(0x19f)]([{'$match':{'primary_code':_0x150ad9}},{'$group':{'_id':_0x442879(0x254),'name':{'$first':_0x442879(0x25f)},'category':{'$first':'$category'},'brand':{'$first':_0x442879(0x16b)},'unit':{'$first':_0x442879(0x276)},'alertquantity':{'$first':_0x442879(0x263)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x442879(0x269)},'secondary_code':{'$first':_0x442879(0x202)},'maxStocks':{'$first':_0x442879(0x210)},'maxProdPerUnit':{'$first':_0x442879(0x19c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x442879(0x151)},'gross_price':{'$first':_0x442879(0x278)},'sales_category':{'$first':_0x442879(0x24f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x8f6b2d=await product[_0x442879(0x19f)]([{'$match':{'secondary_code':_0x150ad9}},{'$group':{'_id':_0x442879(0x254),'name':{'$first':_0x442879(0x25f)},'category':{'$first':_0x442879(0x1a5)},'brand':{'$first':_0x442879(0x16b)},'unit':{'$first':_0x442879(0x276)},'alertquantity':{'$first':_0x442879(0x263)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x442879(0x269)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x442879(0x210)},'maxProdPerUnit':{'$first':_0x442879(0x19c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x442879(0x151)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x442879(0x24f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x3fa164['length']>0x0)_0x149474=_0x3fa164;else _0x8f6b2d['length']>0x0&&(_0x149474=_0x8f6b2d);_0x24c9d0['json'](_0x149474);}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x1b5),async(_0x1f957c,_0x181ad6)=>{var _0x20db97=a0_0x37d3eb;const {productCode:_0x3b8657,bay:_0x439522,warehouses:_0x5456e7,room:_0x2de0b4}=_0x1f957c['body'];console[_0x20db97(0x17b)](_0x1f957c[_0x20db97(0x1db)]);try{const _0x373005=await warehouse[_0x20db97(0x19f)]([{'$match':{'name':_0x5456e7,'room':_0x2de0b4}},{'$unwind':_0x20db97(0x20e)},{'$match':{'product_details.bay':parseInt(_0x439522)}},{'$group':{'_id':_0x20db97(0x16e),'name':{'$first':_0x20db97(0x15e)},'product_stock':{'$first':_0x20db97(0x1dc)},'bay':{'$first':_0x20db97(0x199)},'maxProducts':{'$first':_0x20db97(0x22c)}}}]);_0x181ad6['status'](0xc8)['json'](_0x373005);}catch(_0x25e767){_0x181ad6[_0x20db97(0x156)](0x194)['json']({'message':_0x25e767['message']});}}),router[a0_0x37d3eb(0x267)](a0_0x37d3eb(0x241),async(_0x753ec3,_0x18367c)=>{var _0x19b7dd=a0_0x37d3eb;const {product_code:_0x157147}=_0x753ec3[_0x19b7dd(0x1db)];var _0x329b37;const _0x4a8342=await product['aggregate']([{'$match':{'primary_code':_0x157147,'type_products':_0x19b7dd(0x17b)}},{'$group':{'_id':'$_id','name':{'$first':_0x19b7dd(0x25f)},'category':{'$first':_0x19b7dd(0x1a5)},'brand':{'$first':'$brand'},'unit':{'$first':_0x19b7dd(0x276)},'alertquantity':{'$first':_0x19b7dd(0x263)},'product_code':{'$first':_0x19b7dd(0x1e5)},'primary_code':{'$first':_0x19b7dd(0x269)},'secondary_code':{'$first':_0x19b7dd(0x202)},'maxStocks':{'$first':_0x19b7dd(0x210)},'maxProdPerUnit':{'$first':_0x19b7dd(0x19c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x19b7dd(0x151)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x19b7dd(0x24f)},'type_products':{'$first':_0x19b7dd(0x132)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x19b7dd(0x17b)](_0x4a8342);const _0x4f8358=await product[_0x19b7dd(0x19f)]([{'$match':{'secondary_code':_0x157147,'type_products':'log'}},{'$group':{'_id':'$_id','name':{'$first':_0x19b7dd(0x25f)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x19b7dd(0x263)},'product_code':{'$first':_0x19b7dd(0x1e5)},'primary_code':{'$first':_0x19b7dd(0x269)},'secondary_code':{'$first':_0x19b7dd(0x202)},'maxStocks':{'$first':_0x19b7dd(0x210)},'maxProdPerUnit':{'$first':_0x19b7dd(0x19c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x19b7dd(0x151)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x19b7dd(0x24f)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x4a8342[_0x19b7dd(0x24d)]>0x0)_0x329b37=_0x4a8342;else _0x4f8358[_0x19b7dd(0x24d)]>0x0&&(_0x329b37=_0x4f8358);_0x18367c[_0x19b7dd(0x12e)](_0x329b37);}),module[a0_0x37d3eb(0x1d1)]=router;