var a0_0xe45e51=a0_0x43bf;(function(_0x35f02f,_0x1fe5a8){var _0x893570=a0_0x43bf,_0x244ec9=_0x35f02f();while(!![]){try{var _0x3049e7=-parseInt(_0x893570(0x1a7))/0x1+-parseInt(_0x893570(0x11b))/0x2+parseInt(_0x893570(0xf2))/0x3*(-parseInt(_0x893570(0x1ad))/0x4)+-parseInt(_0x893570(0x19d))/0x5*(parseInt(_0x893570(0x1a5))/0x6)+parseInt(_0x893570(0x1ba))/0x7+parseInt(_0x893570(0xd7))/0x8+parseInt(_0x893570(0x1d8))/0x9*(parseInt(_0x893570(0x100))/0xa);if(_0x3049e7===_0x1fe5a8)break;else _0x244ec9['push'](_0x244ec9['shift']());}catch(_0x1a9da0){_0x244ec9['push'](_0x244ec9['shift']());}}}(a0_0x103a,0xdcb06));const express=require(a0_0xe45e51(0xe9)),app=express(),router=express[a0_0xe45e51(0x193)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require('../models/all_models'),auth=require(a0_0xe45e51(0x1df)),nodemailer=require(a0_0xe45e51(0xbe));var ejs=require(a0_0xe45e51(0x1ed));function a0_0x43bf(_0x3f376a,_0x1dbd3c){var _0x103a4b=a0_0x103a();return a0_0x43bf=function(_0x43bf32,_0x184f07){_0x43bf32=_0x43bf32-0xae;var _0x35ed3f=_0x103a4b[_0x43bf32];return _0x35ed3f;},a0_0x43bf(_0x3f376a,_0x1dbd3c);}const path=require('path'),users=require(a0_0xe45e51(0xb3)),{isNull}=require(a0_0xe45e51(0xca));router[a0_0xe45e51(0x17b)](a0_0xe45e51(0xea),auth,async(_0x5f2cde,_0x2592a0)=>{var _0x345d2d=a0_0xe45e51;try{const {username:_0x14650d,email:_0x388299,role:_0x145495}=_0x5f2cde['user'],_0x4190c4=_0x5f2cde[_0x345d2d(0x1cf)],_0x1243c2=await profile[_0x345d2d(0xfa)]({'email':_0x4190c4[_0x345d2d(0x1bb)]}),_0x58a0ef=await staff[_0x345d2d(0xfa)]({'email':_0x4190c4['email']}),_0x56673b=await master_shop[_0x345d2d(0x1d5)]();let _0x1019ba=await transfers_finished[_0x345d2d(0x10a)]([{'$match':{'to_warehouse':_0x58a0ef['warehouse']}}]);if(_0x56673b[0x0][_0x345d2d(0x1b9)]==_0x345d2d(0x13e))var _0x22536d=users['English'];else{if(_0x56673b[0x0][_0x345d2d(0x1b9)]==_0x345d2d(0x119))var _0x22536d=users[_0x345d2d(0x119)];else{if(_0x56673b[0x0][_0x345d2d(0x1b9)]==_0x345d2d(0x101))var _0x22536d=users['German'];else{if(_0x56673b[0x0]['language']==_0x345d2d(0x16e))var _0x22536d=users['Spanish'];else{if(_0x56673b[0x0][_0x345d2d(0x1b9)]==_0x345d2d(0xf5))var _0x22536d=users[_0x345d2d(0xf5)];else{if(_0x56673b[0x0]['language']==_0x345d2d(0x162))var _0x22536d=users[_0x345d2d(0x12c)];else{if(_0x56673b[0x0][_0x345d2d(0x1b9)]=='Chinese')var _0x22536d=users['Chinese'];else{if(_0x56673b[0x0]['language']==_0x345d2d(0xe6))var _0x22536d=users['Arabic'];}}}}}}}_0x2592a0['render']('incoming_view',{'success':_0x5f2cde[_0x345d2d(0xe3)](_0x345d2d(0x11a)),'errors':_0x5f2cde['flash'](_0x345d2d(0xeb)),'purchases':_0x1019ba,'role':_0x4190c4,'profile':_0x1243c2,'master_shop':_0x56673b,'language':_0x22536d,'staff_data':_0x58a0ef});}catch(_0x3b6898){console['log'](_0x345d2d(0x140),_0x3b6898),_0x2592a0[_0x345d2d(0x1a9)](0xc8)[_0x345d2d(0x1db)]({'message':_0x3b6898['message']});}}),router[a0_0xe45e51(0x17b)](a0_0xe45e51(0x17f),auth,async(_0x2d4f42,_0x1a0256)=>{var _0x1a783a=a0_0xe45e51;try{const {username:_0x45a333,email:_0x10f87b,role:_0x47722a}=_0x2d4f42['user'],_0x4eb229=_0x2d4f42['user'],_0x2d2559=await profile['findOne']({'email':_0x4eb229[_0x1a783a(0x1bb)]}),_0x199439=await staff[_0x1a783a(0xfa)]({'email':_0x4eb229['email']}),_0x8952bf=await master_shop[_0x1a783a(0x1d5)]();let _0x5e04e=await transfers_finished[_0x1a783a(0x10a)]([{'$match':{'to_warehouse':_0x199439[_0x1a783a(0x124)],'to_recieved':_0x1a783a(0xb4)}}]);if(_0x8952bf[0x0][_0x1a783a(0x1b9)]=='English\x20(US)')var _0x2a778d=users[_0x1a783a(0x166)];else{if(_0x8952bf[0x0][_0x1a783a(0x1b9)]==_0x1a783a(0x119))var _0x2a778d=users[_0x1a783a(0x119)];else{if(_0x8952bf[0x0][_0x1a783a(0x1b9)]==_0x1a783a(0x101))var _0x2a778d=users[_0x1a783a(0x101)];else{if(_0x8952bf[0x0][_0x1a783a(0x1b9)]==_0x1a783a(0x16e))var _0x2a778d=users[_0x1a783a(0x16e)];else{if(_0x8952bf[0x0][_0x1a783a(0x1b9)]=='French')var _0x2a778d=users[_0x1a783a(0xf5)];else{if(_0x8952bf[0x0]['language']==_0x1a783a(0x162))var _0x2a778d=users['Portuguese'];else{if(_0x8952bf[0x0][_0x1a783a(0x1b9)]==_0x1a783a(0xdb))var _0x2a778d=users[_0x1a783a(0xdb)];else{if(_0x8952bf[0x0]['language']=='Arabic\x20(ae)')var _0x2a778d=users['Arabic'];}}}}}}}_0x1a0256[_0x1a783a(0x190)](_0x1a783a(0x150),{'success':_0x2d4f42[_0x1a783a(0xe3)](_0x1a783a(0x11a)),'errors':_0x2d4f42[_0x1a783a(0xe3)](_0x1a783a(0xeb)),'purchases':_0x5e04e,'role':_0x4eb229,'profile':_0x2d2559,'master_shop':_0x8952bf,'language':_0x2a778d,'staff_data':_0x199439});}catch(_0x1858e1){console[_0x1a783a(0x1eb)](_0x1a783a(0x140),_0x1858e1),_0x1a0256[_0x1a783a(0x1a9)](0xc8)[_0x1a783a(0x1db)]({'message':_0x1858e1[_0x1a783a(0xcc)]});}});const createLog=async _0x164a85=>{var _0x487414=a0_0xe45e51;const _0x5577e9=new datalogs({'location':_0x164a85});return await _0x5577e9[_0x487414(0x122)](),_0x5577e9[_0x487414(0xd2)];};router[a0_0xe45e51(0x141)](a0_0xe45e51(0x17f),auth,async(_0x513c51,_0x60842e)=>{var _0x3782db=a0_0xe45e51;try{const {invoice_trf_data:_0x24f101,item_code:_0xabb52c,SCRN:_0x513dd6,ReqBy:_0x18ab0e,type_of_products:_0xd94064,dateofreq:_0x2c8b4d,PO_number:_0x30bedd,date:_0x32e0c3,warehouse_name:_0xdd02b8,typeservicesData:_0x27f5df,typevehicle:_0x1d460c,driver:_0x96171d,plate:_0xc3f4da,van:_0x764d91,DRSI:_0x48c30d,TSU:_0x349f21,TFU:_0x142f65,note:_0x5703ed}=_0x513c51[_0x3782db(0x104)],_0x58acce=await transfers_finished[_0x3782db(0x158)](_0x24f101);if(typeof _0xabb52c==_0x3782db(0xc3))var _0x3fa448=[_0x513c51['body'][_0x3782db(0x105)]],_0xf3be84=[_0x513c51[_0x3782db(0x104)][_0x3782db(0x148)]],_0x42091f=[_0x513c51[_0x3782db(0x104)]['to_quantity']],_0x1d005b=[_0x513c51['body'][_0x3782db(0x183)]],_0x217a20=[_0x513c51[_0x3782db(0x104)][_0x3782db(0x108)]],_0x403f1c=[_0x513c51[_0x3782db(0x104)][_0x3782db(0x107)]],_0x16b133=[_0x513c51[_0x3782db(0x104)][_0x3782db(0x155)]],_0x2672a4=[_0x513c51[_0x3782db(0x104)][_0x3782db(0x1d7)]],_0x304a23=[_0x513c51['body'][_0x3782db(0x1dc)]],_0x385ef9=[_0x513c51['body'][_0x3782db(0x1bf)]],_0x15cb6d=[_0x513c51[_0x3782db(0x104)][_0x3782db(0xf9)]],_0x1a61ef=[_0x513c51['body'][_0x3782db(0x11e)]],_0x4aa051=[_0x513c51['body'][_0x3782db(0x1a1)]];else var _0x3fa448=[..._0x513c51[_0x3782db(0x104)][_0x3782db(0x105)]],_0xf3be84=[..._0x513c51[_0x3782db(0x104)][_0x3782db(0x148)]],_0x42091f=[..._0x513c51[_0x3782db(0x104)][_0x3782db(0x1a0)]],_0x1d005b=[..._0x513c51[_0x3782db(0x104)][_0x3782db(0x183)]],_0x217a20=[..._0x513c51['body'][_0x3782db(0x108)]],_0x403f1c=[..._0x513c51['body'][_0x3782db(0x107)]],_0x16b133=[..._0x513c51[_0x3782db(0x104)][_0x3782db(0x155)]],_0x2672a4=[..._0x513c51[_0x3782db(0x104)][_0x3782db(0x1d7)]],_0x304a23=[..._0x513c51['body'][_0x3782db(0x1dc)]],_0x385ef9=[..._0x513c51[_0x3782db(0x104)]['expiry_date']],_0x15cb6d=[..._0x513c51[_0x3782db(0x104)]['production_date']],_0x1a61ef=[..._0x513c51[_0x3782db(0x104)]['max_product_unit']],_0x4aa051=[..._0x513c51[_0x3782db(0x104)]['room']];const _0x2414e0=_0x3fa448[_0x3782db(0x11d)](_0x8a6217=>{return _0x8a6217={'product_name':_0x8a6217};});_0xf3be84[_0x3782db(0x145)]((_0x287761,_0x36270b)=>{var _0x2d45dc=_0x3782db;_0x2414e0[_0x36270b][_0x2d45dc(0xb1)]=_0x287761;}),_0x42091f[_0x3782db(0x145)]((_0x36d5ea,_0x4616e4)=>{var _0x1edf25=_0x3782db;_0x2414e0[_0x4616e4][_0x1edf25(0x127)]=Math[_0x1edf25(0x18a)](_0x36d5ea);}),_0x1d005b[_0x3782db(0x145)]((_0x2e0eb6,_0x347f4f)=>{_0x2414e0[_0x347f4f]['standard_unit']=_0x2e0eb6;}),_0x217a20[_0x3782db(0x145)]((_0x1d9fe6,_0x1a2501)=>{var _0x4c6c9d=_0x3782db;_0x2414e0[_0x1a2501][_0x4c6c9d(0x135)]=_0x1d9fe6;}),_0x403f1c[_0x3782db(0x145)]((_0x28ada1,_0x247d58)=>{var _0xffa0a8=_0x3782db,_0x8c51e8=_0x28ada1[_0xffa0a8(0x194)](/[A-Za-z]+/)[0x0],_0xdb9e67=parseInt(_0x28ada1[_0xffa0a8(0x194)](/\d+/)[0x0]);_0x2414e0[_0x247d58]['level']=_0x8c51e8,_0x2414e0[_0x247d58]['bay']=_0xdb9e67;}),_0x16b133[_0x3782db(0x145)]((_0x4f8667,_0x26b6c4)=>{var _0x2c0ebe=_0x3782db;_0x2414e0[_0x26b6c4][_0x2c0ebe(0x155)]=_0x4f8667;}),_0x2672a4[_0x3782db(0x145)]((_0x1ab6bc,_0x3e4f76)=>{var _0x2a91df=_0x3782db;_0x2414e0[_0x3e4f76][_0x2a91df(0x1d7)]=_0x1ab6bc;}),_0x304a23[_0x3782db(0x145)]((_0x319a0d,_0x42bd1f)=>{_0x2414e0[_0x42bd1f]['batch_code']=_0x319a0d;}),_0x385ef9['forEach']((_0x308050,_0x41710c)=>{var _0x34eb11=_0x3782db;_0x2414e0[_0x41710c][_0x34eb11(0x1bf)]=_0x308050;}),_0x15cb6d[_0x3782db(0x145)]((_0xd6f106,_0x57712f)=>{var _0x3b9212=_0x3782db;_0x2414e0[_0x57712f][_0x3b9212(0xf9)]=_0xd6f106;}),_0x1a61ef[_0x3782db(0x145)]((_0x2d2016,_0x1ef557)=>{var _0x2a56be=_0x3782db;_0x2414e0[_0x1ef557][_0x2a56be(0x168)]=_0x2d2016;}),_0x4aa051[_0x3782db(0x145)]((_0x244f7d,_0x137d60)=>{var _0x2cb71b=_0x3782db;_0x2414e0[_0x137d60][_0x2cb71b(0x1e4)]=_0x244f7d;});const _0x51a54d=await createLog('INC');_0x4aa051[_0x3782db(0x145)]((_0x40c3b7,_0x519a23)=>{var _0x5a11cc=_0x3782db;_0x2414e0[_0x519a23][_0x5a11cc(0x109)]=_0x5a11cc(0x188)+_0x51a54d['toString']()[_0x5a11cc(0xd1)](0x8,'0');});const _0x1741c4=_0x2414e0[_0x3782db(0x169)](_0x1ff587=>_0x1ff587[_0x3782db(0x127)]!=='0'&&_0x1ff587[_0x3782db(0x127)]!==''),_0x55a588=new purchases_incoming({'invoice':_0x3782db(0x188)+_0x51a54d[_0x3782db(0xed)]()['padStart'](0x8,'0'),'date':_0x32e0c3,'warehouse_name':_0xdd02b8,'product':_0x1741c4,'note':_0x5703ed,'POnumber':_0x30bedd,'SCRN':_0x513dd6,'ReqBy':_0x18ab0e,'dateofreq':_0x2c8b4d,'typeservicesData':_0x27f5df,'van':_0x764d91,'typevehicle':_0x1d460c,'driver':_0x96171d,'plate':_0xc3f4da,'DRSI':_0x48c30d,'TSU':_0x349f21,'TFU':_0x142f65,'typeOfProducts':_0xd94064}),_0x12165b=await _0x55a588[_0x3782db(0x122)](),_0xd5621b=_0x12165b[_0x3782db(0xdc)]['map'](async _0x135b06=>{var _0x2b8ea0=_0x3782db,_0x49176a=await warehouse['findOne']({'name':_0xdd02b8,'room':_0x135b06[_0x2b8ea0(0x1e4)]});if(_0x135b06[_0x2b8ea0(0x127)]>0x0){var _0x23680e=0x0;const _0x503353=_0x49176a[_0x2b8ea0(0x1e7)][_0x2b8ea0(0x11d)](_0x16a759=>{var _0x449b7f=_0x2b8ea0;_0x16a759['product_name']==_0x135b06[_0x449b7f(0x105)]&&_0x16a759['bay']==_0x135b06['to_bay']&&_0x16a759[_0x449b7f(0x1bf)]==_0x135b06[_0x449b7f(0x1bf)]&&_0x16a759['production_date']==_0x135b06['production_date']&&_0x16a759[_0x449b7f(0x1dc)]==_0x135b06[_0x449b7f(0x1dc)]&&_0x16a759[_0x449b7f(0x109)]==_0x135b06['invoice']&&(typeof _0x135b06[_0x449b7f(0x138)]==_0x449b7f(0x151)?(console[_0x449b7f(0x1eb)](_0x449b7f(0x1de),_0x16a759[_0x449b7f(0x1e5)]+_0x449b7f(0x1e9)+_0x16a759[_0x449b7f(0x1c5)]+'\x20<=>\x20'+Math[_0x449b7f(0x18a)](_0x16a759[_0x449b7f(0x1e5)])+Math['abs'](_0x135b06[_0x449b7f(0x1a0)])),_0x16a759[_0x449b7f(0x1e5)]=Math['abs'](_0x16a759['product_stock'])+Math[_0x449b7f(0x18a)](_0x135b06['quantity'])):(_0x16a759['product_stock']=Math[_0x449b7f(0x18a)](_0x16a759['product_stock'])+Math['abs'](_0x135b06[_0x449b7f(0x127)]),_0x23680e++));});_0x23680e=='0'&&(_0x49176a[_0x2b8ea0(0x1e7)]=_0x49176a[_0x2b8ea0(0x1e7)][_0x2b8ea0(0xba)]({'product_name':_0x135b06[_0x2b8ea0(0x105)],'product_stock':_0x135b06['quantity'],'bay':_0x135b06[_0x2b8ea0(0xfe)],'level':_0x135b06[_0x2b8ea0(0x114)],'product_code':_0x135b06['product_code'],'primary_code':_0x135b06[_0x2b8ea0(0x155)],'secondary_code':_0x135b06['secondary_code'],'expiry_date':_0x135b06[_0x2b8ea0(0x1bf)],'production_date':_0x135b06['production_date'],'maxProducts':_0x135b06[_0x2b8ea0(0x1cd)],'batch_code':_0x135b06[_0x2b8ea0(0x1dc)],'secondary_unit':_0x135b06['secondary_unit'],'unit':_0x135b06['standard_unit'],'maxProducts':_0x135b06[_0x2b8ea0(0x1cd)],'maxPerUnit':_0x135b06['maxPerUnit'],'invoice':_0x135b06[_0x2b8ea0(0x109)]}));}return _0x49176a;});Promise[_0x3782db(0x1b0)](_0xd5621b)[_0x3782db(0x1c8)](async _0x4e7e24=>{var _0xe6e635=_0x3782db;try{for(const _0x3c22b3 of _0x4e7e24){await warehouse['updateOne']({'_id':_0x3c22b3[_0xe6e635(0x1c5)]},{'$addToSet':{'product_details':{'$each':_0x3c22b3[_0xe6e635(0x1e7)]}}});}_0x58acce[_0xe6e635(0x1c7)]=_0xe6e635(0x1d0);const _0x59204c=await _0x58acce['save'](),_0xf202f0=await master_shop[_0xe6e635(0x1d5)](),_0x4f3ef6=await email_settings['findOne'](),_0x26cf6c=await supervisor_settings[_0xe6e635(0x1d5)]();var _0x107441=_0x55a588['product'],_0x25f17b='',_0x2961bb;for(_0x2961bb in _0x107441){var _0xa9db97='FG';_0x55a588[_0xe6e635(0x1f0)]=='DRY\x20GOODS'&&(_0xa9db97='DG'),_0x25f17b+=_0xe6e635(0x182)+_0xe6e635(0x18d)+_0x107441[_0x2961bb][_0xe6e635(0x105)]+_0xe6e635(0x1e2)+_0xe6e635(0x18d)+_0x107441[_0x2961bb]['product_code']+_0xe6e635(0x1e2)+_0xe6e635(0x18d)+_0x107441[_0x2961bb][_0xe6e635(0x1a0)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x107441[_0x2961bb][_0xe6e635(0x183)]+_0xe6e635(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x107441[_0x2961bb][_0xe6e635(0x135)]+_0xe6e635(0x1e2)+_0xe6e635(0x18d)+_0x55a588[_0xe6e635(0x1f0)]+_0xe6e635(0x1e2)+_0xe6e635(0x18d)+_0x107441[_0x2961bb][_0xe6e635(0x14b)]+_0xe6e635(0x1e2)+_0xe6e635(0x18d)+_0xa9db97+_0x107441[_0x2961bb][_0xe6e635(0x153)]+'</td>'+_0xe6e635(0x1b5);}_0x513c51[_0xe6e635(0xe3)]('success','Transfer\x20Finalize\x20Successfully'),_0x60842e[_0xe6e635(0x117)](_0xe6e635(0x13c)+_0x12165b['_id']);}catch(_0x377ce5){console['error'](_0x377ce5),_0x60842e[_0xe6e635(0x1a9)](0x1f4)['json']({'error':_0xe6e635(0x1aa)});}})[_0x3782db(0xd6)](_0x1eb079=>{var _0x59e5a5=_0x3782db;console[_0x59e5a5(0x18c)](_0x1eb079),_0x60842e[_0x59e5a5(0x1a9)](0x1f4)[_0x59e5a5(0x1db)]({'error':_0x59e5a5(0x123)});});}catch(_0x5a2e4a){}}),router[a0_0xe45e51(0x141)]('/getTRF',auth,async(_0x4b7f73,_0x22c3f9)=>{var _0x451192=a0_0xe45e51;try{const {warehouse:_0x431afb}=_0x4b7f73[_0x451192(0x104)],_0x2e9063=await transfers_finished[_0x451192(0x1d5)]({'to_warehouse':_0x431afb,'to_recieved':_0x451192(0xb4)});_0x22c3f9[_0x451192(0x1db)](_0x2e9063);}catch(_0x5b9f6b){}}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0x192),auth,async(_0x7f8504,_0x413753)=>{var _0x53586b=a0_0xe45e51;try{const {invoice:_0x284897}=_0x7f8504[_0x53586b(0x104)],_0x43dc00=await transfers_finished[_0x53586b(0x1d5)]({'_id':_0x284897,'to_recieved':_0x53586b(0xb4)});_0x413753[_0x53586b(0x1db)](_0x43dc00);}catch(_0x3ecec4){}}),router[a0_0xe45e51(0x17b)]('/view',auth,async(_0x42c82a,_0x2e8ff0)=>{var _0x49f1dc=a0_0xe45e51;try{const {username:_0x1a6e20,email:_0x172f16,role:_0x122730}=_0x42c82a[_0x49f1dc(0x1cf)],_0xfd77bd=_0x42c82a[_0x49f1dc(0x1cf)],_0x11fb8c=await profile['findOne']({'email':_0xfd77bd[_0x49f1dc(0x1bb)]}),_0x1ad4eb=await staff['findOne']({'email':_0xfd77bd[_0x49f1dc(0x1bb)]});if(_0xfd77bd['role']==_0x49f1dc(0x11f)){const _0x56b49c=await staff[_0x49f1dc(0xfa)]({'email':_0xfd77bd[_0x49f1dc(0x1bb)]});}const _0x5f2057=await master_shop['find']();let _0x39252a;if(_0xfd77bd[_0x49f1dc(0x1ee)]=='staff'){const _0x26041c=await staff[_0x49f1dc(0xfa)]({'email':_0xfd77bd[_0x49f1dc(0x1bb)]});_0x39252a=await purchases_finished[_0x49f1dc(0x10a)]([{'$match':{'warehouse_name':_0x26041c[_0x49f1dc(0x124)],'typeOfProducts':_0x49f1dc(0xb0)}},{'$lookup':{'from':'suppliers','localField':_0x49f1dc(0x13d),'foreignField':_0x49f1dc(0x198),'as':_0x49f1dc(0xe2)}},{'$unwind':_0x49f1dc(0x163)},{'$unwind':_0x49f1dc(0xd3)},{'$group':{'_id':_0x49f1dc(0xf8),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x49f1dc(0x175)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x49f1dc(0xbd)},'product':{'$push':_0x49f1dc(0xd3)},'note':{'$first':_0x49f1dc(0x19a)},'paid_amount':{'$first':_0x49f1dc(0xc9)},'due_amount':{'$first':_0x49f1dc(0x177)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x49f1dc(0xc1)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x49f1dc(0x163)},'total_product_quantity':{'$sum':_0x49f1dc(0x147)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x49f1dc(0x1e1)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x39252a=await purchases_finished[_0x49f1dc(0x10a)]([{'$match':{'typeOfProducts':_0x49f1dc(0xb0)}},{'$unwind':'$product'},{'$group':{'_id':_0x49f1dc(0xf8),'invoice':{'$first':_0x49f1dc(0x103)},'suppliers':{'$first':_0x49f1dc(0xe1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x49f1dc(0x1b1)},'room':{'$addToSet':_0x49f1dc(0xb8)},'product':{'$push':_0x49f1dc(0xd3)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x49f1dc(0x177)},'return_data':{'$first':_0x49f1dc(0x13b)},'batch_code':{'$first':_0x49f1dc(0xc1)},'expiry_date':{'$first':_0x49f1dc(0x179)},'suppliers_docs':{'$first':_0x49f1dc(0x163)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x49f1dc(0x1d9)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x49f1dc(0x19c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]=='English\x20(US)')var _0x169b45=users['English'];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]==_0x49f1dc(0x119))var _0x169b45=users['Hindi'];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]==_0x49f1dc(0x101))var _0x169b45=users[_0x49f1dc(0x101)];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]==_0x49f1dc(0x16e))var _0x169b45=users[_0x49f1dc(0x16e)];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]==_0x49f1dc(0xf5))var _0x169b45=users[_0x49f1dc(0xf5)];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]==_0x49f1dc(0x162))var _0x169b45=users[_0x49f1dc(0x12c)];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]==_0x49f1dc(0xdb))var _0x169b45=users[_0x49f1dc(0xdb)];else{if(_0x5f2057[0x0][_0x49f1dc(0x1b9)]=='Arabic\x20(ae)')var _0x169b45=users[_0x49f1dc(0x11c)];}}}}}}}_0x2e8ff0[_0x49f1dc(0x190)](_0x49f1dc(0xce),{'success':_0x42c82a[_0x49f1dc(0xe3)](_0x49f1dc(0x11a)),'errors':_0x42c82a['flash'](_0x49f1dc(0xeb)),'purchases':_0x39252a,'role':_0xfd77bd,'profile':_0x11fb8c,'master_shop':_0x5f2057,'language':_0x169b45});}catch(_0x49e140){console[_0x49f1dc(0x1eb)](_0x49f1dc(0x140),_0x49e140),_0x2e8ff0['status'](0xc8)[_0x49f1dc(0x1db)]({'message':_0x49e140['message']});}}),router['get'](a0_0xe45e51(0x181),auth,async(_0x3c77fd,_0x2709c5)=>{var _0x20e8cb=a0_0xe45e51;try{const {username:_0x306f70,email:_0x2a877b,role:_0x51a850}=_0x3c77fd[_0x20e8cb(0x1cf)],_0x14de0e=_0x3c77fd['user'],_0x2fd8ad=await profile[_0x20e8cb(0xfa)]({'email':_0x14de0e['email']}),_0x1efb1b=await staff[_0x20e8cb(0xfa)]({'email':_0x14de0e[_0x20e8cb(0x1bb)]});if(_0x14de0e[_0x20e8cb(0x1ee)]=='staff'){const _0x823f86=await staff[_0x20e8cb(0xfa)]({'email':_0x14de0e['email']});}const _0x2ef686=await master_shop[_0x20e8cb(0x1d5)]();let _0x505876;if(_0x14de0e['role']=='staff'){const _0x442845=await staff[_0x20e8cb(0xfa)]({'email':_0x14de0e['email']});_0x505876=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x442845['warehouse']}},{'$lookup':{'from':'suppliers','localField':_0x20e8cb(0x13d),'foreignField':_0x20e8cb(0x198),'as':_0x20e8cb(0xe2)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x20e8cb(0xe1)},'date':{'$first':_0x20e8cb(0x175)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x20e8cb(0xbd)},'product':{'$push':_0x20e8cb(0xd3)},'note':{'$first':_0x20e8cb(0x19a)},'paid_amount':{'$first':_0x20e8cb(0xc9)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x20e8cb(0x13b)},'batch_code':{'$first':_0x20e8cb(0xc1)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x20e8cb(0x163)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x20e8cb(0x1d9)},'isle':{'$addToSet':_0x20e8cb(0x189)},'type':{'$addToSet':_0x20e8cb(0x1e1)},'floorlevel':{'$addToSet':_0x20e8cb(0x19c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x505876=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x20e8cb(0xdd)}},{'$unwind':_0x20e8cb(0xd3)},{'$group':{'_id':_0x20e8cb(0xf8),'invoice':{'$first':_0x20e8cb(0x103)},'suppliers':{'$first':_0x20e8cb(0xe1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x20e8cb(0x1b1)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x20e8cb(0xd3)},'note':{'$first':_0x20e8cb(0x19a)},'paid_amount':{'$first':_0x20e8cb(0xc9)},'due_amount':{'$first':_0x20e8cb(0x177)},'return_data':{'$first':_0x20e8cb(0x13b)},'batch_code':{'$first':_0x20e8cb(0xc1)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x20e8cb(0x163)},'total_product_quantity':{'$sum':_0x20e8cb(0x147)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x20e8cb(0x189)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x20e8cb(0x19c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2ef686[0x0][_0x20e8cb(0x1b9)]==_0x20e8cb(0x13e))var _0x46f26c=users['English'];else{if(_0x2ef686[0x0][_0x20e8cb(0x1b9)]==_0x20e8cb(0x119))var _0x46f26c=users[_0x20e8cb(0x119)];else{if(_0x2ef686[0x0][_0x20e8cb(0x1b9)]==_0x20e8cb(0x101))var _0x46f26c=users[_0x20e8cb(0x101)];else{if(_0x2ef686[0x0]['language']==_0x20e8cb(0x16e))var _0x46f26c=users[_0x20e8cb(0x16e)];else{if(_0x2ef686[0x0][_0x20e8cb(0x1b9)]==_0x20e8cb(0xf5))var _0x46f26c=users[_0x20e8cb(0xf5)];else{if(_0x2ef686[0x0]['language']==_0x20e8cb(0x162))var _0x46f26c=users[_0x20e8cb(0x12c)];else{if(_0x2ef686[0x0][_0x20e8cb(0x1b9)]==_0x20e8cb(0xdb))var _0x46f26c=users[_0x20e8cb(0xdb)];else{if(_0x2ef686[0x0][_0x20e8cb(0x1b9)]==_0x20e8cb(0xe6))var _0x46f26c=users[_0x20e8cb(0x11c)];}}}}}}}_0x2709c5[_0x20e8cb(0x190)](_0x20e8cb(0x1d2),{'success':_0x3c77fd[_0x20e8cb(0xe3)](_0x20e8cb(0x11a)),'errors':_0x3c77fd['flash'](_0x20e8cb(0xeb)),'purchases':_0x505876,'role':_0x14de0e,'profile':_0x2fd8ad,'master_shop':_0x2ef686,'language':_0x46f26c});}catch(_0x34ace8){console['log'](_0x20e8cb(0x140),_0x34ace8),_0x2709c5[_0x20e8cb(0x1a9)](0xc8)['json']({'message':_0x34ace8['message']});}});function BayBinSelected(_0x8764f,_0x1b4e0d){var _0x5d365b=a0_0xe45e51,_0x392d57=[],_0xa36a5e=[];if(_0x8764f=='DRY\x20GOODS'){switch(_0x1b4e0d){case'Rack\x201':_0x392d57=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5d365b(0x1e3):_0x392d57=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xa36a5e=['DG'];}else{if(_0x8764f=='FROZEN\x20GOODS'){switch(_0x1b4e0d){case'Rack\x201':_0x392d57=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5d365b(0x1e3):_0x392d57=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xa36a5e=['FG'];}}return{'levels':_0x392d57,'identify':_0xa36a5e};}async function getRandom8DigitNumber(){var _0x47ed10=a0_0xe45e51;const _0x146433=0x989680,_0x3d465e=0x5f5e0ff,_0x588352=Math[_0x47ed10(0x1da)](Math[_0x47ed10(0x19f)]()*(_0x3d465e-_0x146433+0x1))+_0x146433;var _0x1050aa;const _0x3cec95=await purchases_finished['findOne']({'invoice':_0x47ed10(0x1be)+_0x588352});return _0x3cec95&&_0x3cec95[_0x47ed10(0x13f)]>0x0?_0x1050aa='INCF-'+_0x588352:_0x1050aa=_0x47ed10(0x1be)+_0x588352,_0x1050aa;}router[a0_0xe45e51(0x17b)](a0_0xe45e51(0x10e),auth,async(_0x539e54,_0x2f6cfe)=>{var _0x336e37=a0_0xe45e51;try{const {username:_0x23557c,email:_0x437244,role:_0x24971e}=_0x539e54[_0x336e37(0x1cf)],_0x21b274=_0x539e54['user'],_0x819e85=await profile['findOne']({'email':_0x21b274[_0x336e37(0x1bb)]}),_0x3de6bd=await master_shop[_0x336e37(0x1d5)](),_0x2a4b15=await staff[_0x336e37(0xfa)]({'email':_0x21b274[_0x336e37(0x1bb)]}),_0xb843b4=await suppliers[_0x336e37(0x1d5)]({});let _0x2cb024;if(_0x21b274[_0x336e37(0x1ee)]==_0x336e37(0x11f)){const _0x40f2b4=await staff['findOne']({'email':_0x21b274[_0x336e37(0x1bb)]});_0x2cb024=await warehouse[_0x336e37(0x10a)]([{'$match':{'status':'Enabled','name':_0x40f2b4[_0x336e37(0x124)]}},{'$group':{'_id':_0x336e37(0x137),'name':{'$first':'$name'}}}]);}else _0x2cb024=await warehouse[_0x336e37(0x10a)]([{'$match':{'status':_0x336e37(0x1d3)}},{'$group':{'_id':'$name','name':{'$first':_0x336e37(0x137)}}}]);const _0x7c034a=await product[_0x336e37(0x1d5)]({}),_0x2feda4=await warehouse[_0x336e37(0x1d5)]({'status':_0x336e37(0x1d3)}),_0xd85b4e=await purchases_finished[_0x336e37(0x1d5)]({}),_0xca12=_0xd85b4e[_0x336e37(0x13f)]+0x1,_0x1143a5=_0x336e37(0x1be)+_0xca12['toString']()[_0x336e37(0xd1)](0x5,'0');var _0xd6e381=['Ambient',_0x336e37(0x1c3)];if(_0x3de6bd[0x0][_0x336e37(0x1b9)]==_0x336e37(0x13e))var _0x34fc36=users[_0x336e37(0x166)];else{if(_0x3de6bd[0x0]['language']=='Hindi')var _0x34fc36=users[_0x336e37(0x119)];else{if(_0x3de6bd[0x0]['language']==_0x336e37(0x101))var _0x34fc36=users['German'];else{if(_0x3de6bd[0x0][_0x336e37(0x1b9)]=='Spanish')var _0x34fc36=users[_0x336e37(0x16e)];else{if(_0x3de6bd[0x0]['language']==_0x336e37(0xf5))var _0x34fc36=users[_0x336e37(0xf5)];else{if(_0x3de6bd[0x0][_0x336e37(0x1b9)]==_0x336e37(0x162))var _0x34fc36=users[_0x336e37(0x12c)];else{if(_0x3de6bd[0x0]['language']=='Chinese')var _0x34fc36=users[_0x336e37(0xdb)];else{if(_0x3de6bd[0x0][_0x336e37(0x1b9)]==_0x336e37(0xe6))var _0x34fc36=users[_0x336e37(0x11c)];}}}}}}}const _0x3ada8e=getRandom8DigitNumber(),_0x570d67=new Date(),_0x432d2c={'year':_0x336e37(0x1ec),'month':_0x336e37(0x176),'day':_0x336e37(0x176),'timeZone':_0x336e37(0x187)},_0x3df2ba=_0x570d67['toLocaleDateString']('en-CA',_0x432d2c);console[_0x336e37(0x1eb)](_0x3df2ba),_0x3ada8e['then'](_0x1fa294=>{var _0x65f730=_0x336e37;_0x2f6cfe[_0x65f730(0x190)]('add_purchases_finished',{'success':_0x539e54[_0x65f730(0xe3)](_0x65f730(0x11a)),'errors':_0x539e54[_0x65f730(0xe3)]('errors'),'role':_0x21b274,'profile':_0x819e85,'suppliers':_0xb843b4,'warehouse':_0x2cb024,'product':_0x7c034a,'invoice':_0x1fa294,'master_shop':_0x3de6bd,'language':_0x34fc36,'find_data':_0x2feda4,'rooms_data':_0xd6e381,'formattedDate':_0x3df2ba});})['catch'](_0x5964b8=>{var _0xd7326d=_0x336e37;_0x539e54[_0xd7326d(0xe3)](_0xd7326d(0xeb),_0xd7326d(0xe7)),_0x2f6cfe[_0xd7326d(0x117)](_0xd7326d(0x133));});}catch(_0x78fc29){console[_0x336e37(0x1eb)](_0x78fc29);}}),router['get'](a0_0xe45e51(0xe4),auth,async(_0x2bcc5d,_0x1f5e78)=>{var _0x24c529=a0_0xe45e51;try{const {username:_0x350476,email:_0x5c73cd,role:_0x106693}=_0x2bcc5d[_0x24c529(0x1cf)],_0x4d65b4=_0x2bcc5d[_0x24c529(0x1cf)],_0x29b985=await profile[_0x24c529(0xfa)]({'email':_0x4d65b4[_0x24c529(0x1bb)]}),_0x23ed30=await master_shop[_0x24c529(0x1d5)](),_0x3ed40d=await staff[_0x24c529(0xfa)]({'email':_0x4d65b4[_0x24c529(0x1bb)]}),_0x365cee=await suppliers[_0x24c529(0x1d5)]({});let _0x8f35f4;if(_0x4d65b4[_0x24c529(0x1ee)]==_0x24c529(0x11f)){const _0xee6546=await staff[_0x24c529(0xfa)]({'email':_0x4d65b4['email']});_0x8f35f4=await warehouse[_0x24c529(0x10a)]([{'$match':{'status':_0x24c529(0x1d3),'name':_0xee6546[_0x24c529(0x124)]}},{'$group':{'_id':'$name','name':{'$first':_0x24c529(0x137)}}}]);}else _0x8f35f4=await warehouse[_0x24c529(0x10a)]([{'$match':{'status':_0x24c529(0x1d3)}},{'$group':{'_id':_0x24c529(0x137),'name':{'$first':'$name'}}}]);const _0x150adf=await product[_0x24c529(0x1d5)]({}),_0x1515e3=await warehouse[_0x24c529(0x1d5)]({'status':_0x24c529(0x1d3)}),_0x2d4368=await purchases_finished[_0x24c529(0x1d5)]({}),_0x228217=_0x2d4368['length']+0x1,_0x42c0ce=_0x24c529(0x1be)+_0x228217['toString']()[_0x24c529(0xd1)](0x5,'0');var _0x4da514=['Ambient',_0x24c529(0x1c3)];if(_0x23ed30[0x0][_0x24c529(0x1b9)]==_0x24c529(0x13e))var _0x194240=users[_0x24c529(0x166)];else{if(_0x23ed30[0x0]['language']=='Hindi')var _0x194240=users['Hindi'];else{if(_0x23ed30[0x0][_0x24c529(0x1b9)]==_0x24c529(0x101))var _0x194240=users[_0x24c529(0x101)];else{if(_0x23ed30[0x0][_0x24c529(0x1b9)]==_0x24c529(0x16e))var _0x194240=users[_0x24c529(0x16e)];else{if(_0x23ed30[0x0][_0x24c529(0x1b9)]==_0x24c529(0xf5))var _0x194240=users[_0x24c529(0xf5)];else{if(_0x23ed30[0x0][_0x24c529(0x1b9)]==_0x24c529(0x162))var _0x194240=users['Portuguese'];else{if(_0x23ed30[0x0][_0x24c529(0x1b9)]=='Chinese')var _0x194240=users['Chinese'];else{if(_0x23ed30[0x0]['language']==_0x24c529(0xe6))var _0x194240=users[_0x24c529(0x11c)];}}}}}}}const _0x2182cf=getRandom8DigitNumber();_0x2182cf['then'](_0x3f9f7b=>{var _0x4ebbaa=_0x24c529;_0x1f5e78[_0x4ebbaa(0x190)](_0x4ebbaa(0x12f),{'success':_0x2bcc5d[_0x4ebbaa(0xe3)](_0x4ebbaa(0x11a)),'errors':_0x2bcc5d[_0x4ebbaa(0xe3)]('errors'),'role':_0x4d65b4,'profile':_0x29b985,'suppliers':_0x365cee,'warehouse':_0x8f35f4,'product':_0x150adf,'invoice':_0x3f9f7b,'master_shop':_0x23ed30,'language':_0x194240,'find_data':_0x1515e3,'rooms_data':_0x4da514});})[_0x24c529(0xd6)](_0xc940fe=>{var _0x48c7ca=_0x24c529;_0x2bcc5d[_0x48c7ca(0xe3)]('errors',_0x48c7ca(0xe7)),_0x1f5e78[_0x48c7ca(0x117)](_0x48c7ca(0x133));});}catch(_0xd379b4){console[_0x24c529(0x1eb)](_0xd379b4);}}),router[a0_0xe45e51(0x17b)](a0_0xe45e51(0x13a),auth,async(_0xdb11db,_0x167b46)=>{var _0x2ffdd8=a0_0xe45e51;try{const _0x263641=_0xdb11db[_0x2ffdd8(0x15e)]['id'];console['log'](_0x263641);const _0x1a7434=await master_shop[_0x2ffdd8(0x1d5)]();console[_0x2ffdd8(0x1eb)](_0x2ffdd8(0x116),_0x1a7434);const _0xb9e589=await product[_0x2ffdd8(0xfa)]({'name':_0x263641});console[_0x2ffdd8(0x1eb)](_0x2ffdd8(0xdc),_0xb9e589),_0x167b46[_0x2ffdd8(0x1a9)](0xc8)[_0x2ffdd8(0x1db)]({'product_data':_0xb9e589,'master':_0x1a7434});}catch(_0x4fe6aa){console[_0x2ffdd8(0x1eb)](_0x2ffdd8(0x10c),_0x4fe6aa);}}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0x10e),auth,async(_0x5a75ab,_0x528afa)=>{var _0x51e0a8=a0_0xe45e51;try{const {invoice:_0xae99ea,date:_0xbf7339,warehouse_name:_0x4ed91d,prod_name:_0x24fc1e,note:_0xf8ce63,due_amount:_0x1635f9,Room_name:_0x4f3bf2,PO_number:_0x577af2,SCRN:_0x2c2b76,ReqBy:_0x45706d,dateofreq:_0x3bb4cc,suppliers:_0x4371fb,typeservicesData:_0x3713fd,van:_0xc4f841,typevehicle:_0x35925b,driver:_0x2139bf,plate:_0x39f8a4,DRSI:_0x5e4110,TSU:_0x178bef,TFU:_0x4cf30f,JO_number:_0xc742b8,type_of_products:_0x366835}=_0x5a75ab[_0x51e0a8(0x104)];if(typeof _0x24fc1e==_0x51e0a8(0xc3))var _0x55877f=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x12a)]],_0x5ba43e=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xf6)]],_0x1a0bf3=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x12e)]],_0x5ad92c=[_0x5a75ab['body'][_0x51e0a8(0x14e)]],_0x17d833=[_0x5a75ab['body'][_0x51e0a8(0x108)]],_0x64f603=[_0x5a75ab[_0x51e0a8(0x104)]['prod_level']],_0x402ed1=[_0x5a75ab[_0x51e0a8(0x104)]['primary_code']],_0x5a6778=[_0x5a75ab['body'][_0x51e0a8(0x1d7)]],_0x4cea54=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1ce)]],_0xa98ba1=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1dc)]],_0x20714a=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1bf)]],_0x2de0d6=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xe5)]],_0x2d4626=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x11e)]],_0x4a06f1=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xf0)]],_0x472659=[_0x5a75ab['body']['RoomAssign']],_0x303556=[_0x5a75ab['body'][_0x51e0a8(0x1b4)]],_0x5d891f=[_0x5a75ab[_0x51e0a8(0x104)]['uuid']],_0x307e60=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xc6)]],_0x3981d7=[_0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1c6)]];else var _0x55877f=[..._0x5a75ab['body'][_0x51e0a8(0x12a)]],_0x5ba43e=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xf6)]],_0x1a0bf3=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x12e)]],_0x5ad92c=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x14e)]],_0x17d833=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x108)]],_0x64f603=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x142)]],_0x402ed1=[..._0x5a75ab[_0x51e0a8(0x104)]['primary_code']],_0x5a6778=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1d7)]],_0x4cea54=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1ce)]],_0xa98ba1=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1dc)]],_0x20714a=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1bf)]],_0x2de0d6=[..._0x5a75ab['body'][_0x51e0a8(0xe5)]],_0x2d4626=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x11e)]],_0x4a06f1=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xf0)]],_0x472659=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x18b)]],_0x303556=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0x1b4)]],_0x5d891f=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xf4)]],_0x307e60=[..._0x5a75ab[_0x51e0a8(0x104)][_0x51e0a8(0xc6)]],_0x3981d7=[..._0x5a75ab['body'][_0x51e0a8(0x1c6)]];const _0x52db76=_0x55877f[_0x51e0a8(0x11d)](_0x2a6401=>{return _0x2a6401={'product_name':_0x2a6401};});_0x3981d7[_0x51e0a8(0x145)]((_0x4a4ec9,_0x51fa3e)=>{var _0x2e4b64=_0x51e0a8;_0x52db76[_0x51fa3e][_0x2e4b64(0x1c6)]=_0x4a4ec9,_0x52db76[_0x51fa3e][_0x2e4b64(0xfb)]=_0xbf7339;}),_0x307e60[_0x51e0a8(0x145)]((_0x4e2194,_0x2924cd)=>{var _0x2d41b2=_0x51e0a8;_0x52db76[_0x2924cd][_0x2d41b2(0x1cc)]=_0x4e2194;}),_0x5ba43e[_0x51e0a8(0x145)]((_0x5ad1f5,_0x2d60ca)=>{var _0x5a9791=_0x51e0a8;_0x52db76[_0x2d60ca][_0x5a9791(0xb1)]=_0x5ad1f5;}),_0x5d891f[_0x51e0a8(0x145)]((_0x37a57d,_0x567391)=>{var _0x53b1c3=_0x51e0a8;_0x52db76[_0x567391][_0x53b1c3(0xf4)]=_0x37a57d;}),_0x1a0bf3[_0x51e0a8(0x145)]((_0x48b0cd,_0x1f7874)=>{var _0x33f71c=_0x51e0a8;_0x52db76[_0x1f7874][_0x33f71c(0x127)]=Math['abs'](_0x48b0cd);}),_0x5ad92c[_0x51e0a8(0x145)]((_0x42410a,_0x3e20f7)=>{var _0x6753=_0x51e0a8;_0x52db76[_0x3e20f7][_0x6753(0x16f)]=_0x42410a;}),_0x17d833['forEach']((_0x380ccb,_0x8c059d)=>{var _0x1cfb1b=_0x51e0a8;_0x52db76[_0x8c059d][_0x1cfb1b(0x135)]=_0x380ccb;}),_0x402ed1['forEach']((_0x548208,_0x5b6c3c)=>{var _0x569fb8=_0x51e0a8;_0x52db76[_0x5b6c3c][_0x569fb8(0x155)]=_0x548208;}),_0x5a6778[_0x51e0a8(0x145)]((_0x5b379b,_0x33a9a9)=>{var _0x5919a7=_0x51e0a8;_0x52db76[_0x33a9a9][_0x5919a7(0x1d7)]=_0x5b379b;}),_0x4cea54[_0x51e0a8(0x145)]((_0x335008,_0x42ef1d)=>{_0x52db76[_0x42ef1d]['maxStocks']=_0x335008;}),_0xa98ba1['forEach']((_0x46ea3d,_0x2f0a1f)=>{_0x52db76[_0x2f0a1f]['batch_code']=_0x46ea3d;}),_0x20714a['forEach']((_0x878705,_0xc25043)=>{_0x52db76[_0xc25043]['expiry_date']=_0x878705;}),_0x2de0d6[_0x51e0a8(0x145)]((_0x549f0a,_0x4a834f)=>{_0x52db76[_0x4a834f]['production_date']=_0x549f0a;}),_0x2d4626[_0x51e0a8(0x145)]((_0x50a694,_0x239640)=>{_0x52db76[_0x239640]['maxperunit']=_0x50a694;}),_0x4a06f1[_0x51e0a8(0x145)]((_0x531cfc,_0x272478)=>{_0x52db76[_0x272478]['product_cat']=_0x531cfc;}),_0x472659[_0x51e0a8(0x145)]((_0x48a87e,_0x48020b)=>{var _0x4c5361=_0x51e0a8;_0x52db76[_0x48020b][_0x4c5361(0x1e4)]=_0x48a87e;}),_0x303556[_0x51e0a8(0x145)]((_0x57659d,_0x38fe9b)=>{var _0x5e35a8=_0x51e0a8;_0x52db76[_0x38fe9b][_0x5e35a8(0x1b4)]=_0x57659d;});const _0x5e4219=new invoice_for_incoming();await _0x5e4219['save']();for(let _0x5a6a2c=0x0;_0x5a6a2c<=_0x472659[_0x51e0a8(0x13f)]-0x1;_0x5a6a2c++){_0x52db76[_0x5a6a2c]['invoice']=_0x51e0a8(0x188)+_0x5e4219[_0x51e0a8(0xd2)][_0x51e0a8(0xed)]()[_0x51e0a8(0xd1)](0x8,'0');}const _0x20d4a6=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x4ed91d}}]);let _0x3b88bc=[];for(let _0x1d3e88=0x0;_0x1d3e88<=_0x52db76[_0x51e0a8(0x13f)]-0x1;_0x1d3e88++){const _0x1cc560=_0x52db76[_0x1d3e88];for(let _0x412206=0x0;_0x412206<=_0x20d4a6['length']-0x1;_0x412206++){const _0x592501=_0x20d4a6[_0x412206];for(let _0x2b0383=0x0;_0x2b0383<=_0x592501[_0x51e0a8(0x14c)][_0x51e0a8(0x13f)]-0x1;_0x2b0383++){const _0xf72087=_0x592501['product_data'][_0x2b0383];if(_0xf72087[_0x51e0a8(0xb1)]===_0x1cc560[_0x51e0a8(0xb1)]){let _0x994adf=_0x1cc560[_0x51e0a8(0x127)];const _0x2d955a=await warehouse[_0x51e0a8(0x10a)]([{'$match':{'name':_0x4ed91d,'room':_0x592501[_0x51e0a8(0x1a1)]}},{'$unwind':_0x51e0a8(0x157)},{'$match':{'level':_0xf72087[_0x51e0a8(0xfe)],'bay':_0xf72087[_0x51e0a8(0x107)]}}]);if(_0x2d955a[_0x51e0a8(0x13f)]==0x0){for(let _0xaa0d6e=0x0;_0xaa0d6e<=_0x592501[_0x51e0a8(0x14c)][_0x51e0a8(0x13f)]-0x1&&_0x994adf>0x0;_0xaa0d6e++){const _0x2cc6f3=_0x592501[_0x51e0a8(0x14c)][_0xaa0d6e];if(_0x1cc560[_0x51e0a8(0xb1)]===_0x2cc6f3[_0x51e0a8(0xb1)]){_0x3b88bc[_0xaa0d6e]={};const _0x3415a9=parseInt(_0x2cc6f3['max']),_0x5ea46c=0x0;let _0x29629f=_0x3415a9-_0x5ea46c,_0x330dd2=Math['min'](_0x994adf,_0x29629f);console[_0x51e0a8(0x1eb)](_0x51e0a8(0x15c)+_0x330dd2+_0x51e0a8(0x110)+_0x592501[_0x51e0a8(0xc4)]+_0x51e0a8(0x195)+_0x592501[_0x51e0a8(0x1a1)]+_0x51e0a8(0x118)+_0x2cc6f3[_0x51e0a8(0xfe)]+_0x51e0a8(0x1a2)+_0x2cc6f3[_0x51e0a8(0x107)]),_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x105)]=_0x1cc560[_0x51e0a8(0x105)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0xb1)]=_0x1cc560[_0x51e0a8(0xb1)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x1c6)]=_0x1cc560[_0x51e0a8(0x1c6)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0xfb)]=_0x1cc560[_0x51e0a8(0xfb)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x1cc)]=_0x1cc560['sales_category'],_0x3b88bc[_0xaa0d6e]['uuid']=_0x1cc560[_0x51e0a8(0xf4)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x127)]=_0x330dd2,_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x16f)]=_0x1cc560['standard_unit'],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x135)]=_0x1cc560[_0x51e0a8(0x135)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x155)]=_0x1cc560[_0x51e0a8(0x155)],_0x3b88bc[_0xaa0d6e]['secondary_code']=_0x1cc560[_0x51e0a8(0x1d7)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x171)]=_0x1cc560[_0x51e0a8(0x171)],_0x3b88bc[_0xaa0d6e]['batch_code']=_0x1cc560[_0x51e0a8(0x1dc)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x1bf)]=_0x1cc560['expiry_date'],_0x3b88bc[_0xaa0d6e]['production_date']=_0x1cc560[_0x51e0a8(0xf9)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x168)]=_0x1cc560[_0x51e0a8(0x168)],_0x3b88bc[_0xaa0d6e]['product_cat']=_0x1cc560[_0x51e0a8(0x111)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x109)]=_0x1cc560[_0x51e0a8(0x109)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x1b4)]=_0x1cc560[_0x51e0a8(0x1b4)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x1e4)]=_0x592501['room'],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0x114)]=_0x2cc6f3[_0x51e0a8(0xfe)],_0x3b88bc[_0xaa0d6e][_0x51e0a8(0xfe)]=_0x2cc6f3[_0x51e0a8(0x107)],_0x994adf-=_0x330dd2;if(_0x994adf<=0x0)break;}}if(_0x994adf<=0x0)break;_0x994adf>0x0&&console['log'](_0x51e0a8(0x164)+_0x994adf+_0x51e0a8(0x16b));}}}}}console[_0x51e0a8(0x1eb)](_0x3b88bc);const _0x2c6290=_0x3b88bc['filter'](_0x28c114=>_0x28c114['quantity']!=='0'&&_0x28c114[_0x51e0a8(0x127)]!==''),_0x4e70c9=new purchases_finished({'invoice':'INC-'+_0x5e4219[_0x51e0a8(0xd2)][_0x51e0a8(0xed)]()[_0x51e0a8(0xd1)](0x8,'0'),'suppliers':_0x4371fb,'date':_0xbf7339,'warehouse_name':_0x4ed91d,'product':_0x2c6290,'note':_0xf8ce63,'due_amount':_0x1635f9,'room':_0x4f3bf2,'POnumber':_0x577af2,'SCRN':_0x2c2b76,'JO_number':_0xc742b8,'ReqBy':_0x45706d,'dateofreq':_0x3bb4cc,'typeservicesData':_0x3713fd,'van':_0xc4f841,'typevehicle':_0x35925b,'driver':_0x2139bf,'plate':_0x39f8a4,'DRSI':_0x5e4110,'TSU':_0x178bef,'TFU':_0x4cf30f,'typeOfProducts':_0x366835}),_0x25745b=await _0x4e70c9['save'](),_0x5788cb=await purchases_finished[_0x51e0a8(0xfa)]({'_id':_0x25745b[_0x51e0a8(0x1c5)][_0x51e0a8(0x106)]()});_0x5a75ab['flash'](_0x51e0a8(0x11a),_0x51e0a8(0x1dd)),_0x528afa[_0x51e0a8(0x117)]('/all_purchases_finished/process/'+_0x5788cb[_0x51e0a8(0x1c5)][_0x51e0a8(0x106)]());}catch(_0xbf5e77){console[_0x51e0a8(0x1eb)](_0xbf5e77);}}),router[a0_0xe45e51(0x17b)]('/process/:id',auth,async(_0x2ac8c6,_0x3475c8)=>{var _0xcd5e2c=a0_0xe45e51;try{const {username:_0x164095,email:_0x37fff3,role:_0x3b3ace}=_0x2ac8c6[_0xcd5e2c(0x1cf)],_0x44e4c7=_0x2ac8c6[_0xcd5e2c(0x1cf)],_0x45c674=_0x2ac8c6[_0xcd5e2c(0x15e)]['id'],_0x1d33c8=await profile[_0xcd5e2c(0xfa)]({'email':_0x44e4c7[_0xcd5e2c(0x1bb)]}),_0x39e7b7=await master_shop[_0xcd5e2c(0x1d5)](),_0x22fcdd=await staff[_0xcd5e2c(0xfa)]({'email':_0x44e4c7[_0xcd5e2c(0x1bb)]}),_0x5ae068=await suppliers['find']({});let _0x448338;if(_0x44e4c7['role']==_0xcd5e2c(0x11f)){const _0x55116d=await staff[_0xcd5e2c(0xfa)]({'email':_0x44e4c7[_0xcd5e2c(0x1bb)]});_0x448338=await warehouse[_0xcd5e2c(0x10a)]([{'$match':{'status':'Enabled','name':_0x55116d[_0xcd5e2c(0x124)]}},{'$group':{'_id':_0xcd5e2c(0x137),'name':{'$first':_0xcd5e2c(0x137)}}}]);}else _0x448338=await warehouse[_0xcd5e2c(0x10a)]([{'$match':{'status':_0xcd5e2c(0x1d3)}},{'$group':{'_id':_0xcd5e2c(0x137),'name':{'$first':'$name'}}}]);const _0x229a65=await purchases_finished[_0xcd5e2c(0x158)](_0x45c674);if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]=='English\x20(US)')var _0x2a4e02=users[_0xcd5e2c(0x166)];else{if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]==_0xcd5e2c(0x119))var _0x2a4e02=users[_0xcd5e2c(0x119)];else{if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]==_0xcd5e2c(0x101))var _0x2a4e02=users['German'];else{if(_0x39e7b7[0x0]['language']==_0xcd5e2c(0x16e))var _0x2a4e02=users['Spanish'];else{if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]==_0xcd5e2c(0xf5))var _0x2a4e02=users[_0xcd5e2c(0xf5)];else{if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]==_0xcd5e2c(0x162))var _0x2a4e02=users[_0xcd5e2c(0x12c)];else{if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]=='Chinese')var _0x2a4e02=users[_0xcd5e2c(0xdb)];else{if(_0x39e7b7[0x0][_0xcd5e2c(0x1b9)]==_0xcd5e2c(0xe6))var _0x2a4e02=users['Arabic'];}}}}}}}_0x3475c8[_0xcd5e2c(0x190)](_0xcd5e2c(0x1d1),{'success':_0x2ac8c6[_0xcd5e2c(0xe3)](_0xcd5e2c(0x11a)),'errors':_0x2ac8c6['flash'](_0xcd5e2c(0xeb)),'role':_0x44e4c7,'profile':_0x1d33c8,'suppliers':_0x5ae068,'warehouse':_0x448338,'master_shop':_0x39e7b7,'language':_0x2a4e02,'purchases_data':_0x229a65});}catch(_0x13cb27){console[_0xcd5e2c(0x1eb)](_0x13cb27);}});function a0_0x103a(){var _0x4559a0=['../public/language/languages.json','false','$brand','image','updateOne','$product.room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','concat','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$room','nodemailer','prod_qty','purchase_quantity','$batch_code','exports','string','warehouse_name','<hr\x20class=\x22my-3\x22>','sales_data_cateory','$secondary_code','$secondary_unit','$paid_amount','util','purchase\x20data\x20update\x20successfully','message','$product_details._id','all_purchases_finished','Logo.png','payment\x20successfull','padStart','invoice_init','$product','purchase_invoice','<h5\x20style=\x22text-align:\x20left;\x22>','catch','13668552zUyEID','back','$product_details.bay','/CheckingWarehouse','Chinese','product','logs','$unit','$sales_category','/preview/:id','$suppliers','suppliers_docs','flash','/view/add_purchases_logs','product_date','Arabic\x20(ae)','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Paid\x20For\x20Purchase','express','/incoming','errors','</table>','toString','$gross_price','gmail','prod_cat','</head><body>','33olcCTw','/all_purchases_finished/process/','uuid','French','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$_id','production_date','findOne','date_recieved','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</h5>','bay','$product_details.primary_code','250CGOjyk','German','LOG-INC-','$invoice','body','product_name','valueOf','bin','prod_secondunit','invoice','aggregate','/view/return_purchase/:id','add_purchases\x20error','type_of_products_type','/view/add_purchases','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','\x20units\x20to\x20warehouse:\x20','product_cat','<strong>\x20Regards\x20</strong>','<h2>\x20','level','stock_quantity','master','redirect',',\x20bay:\x20','Hindi','success','2817954Mfdskh','Arabic','map','max_product_unit','staff','$category','</body></html>','save','An\x20error\x20occurred.','warehouse','return_data','/barcode/:id','quantity','Error\x20Occurs','$product_details.maxProducts','prod_name','$maxProdPerUnit','Portuguese','purchases\x20item\x20return\x20successfull','prod_Qty','add_purchases_finished_logs','getDate','$product_details.storage','secondary_code_hide','/all_purchases_finished/view','</div>','secondary_unit','data_type','$name','id_transaction','currency','/view/add_purchases/:id','$return_data','/picking_list/pdf_puchases_fin_own_trf/','suppliers','English\x20(US)','length','table\x20page','post','prod_level','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','forEach','$alertquantity','$product.quantity','item_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','currency_placement','to_room_name','product_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_primunit','all_purchases_barcode','incoming_add','undefined','\x20Order\x20Date\x20:\x20','to_bay','getFullYear','primary_code','</thead>','$product_details','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.secondary_code','<!DOCTYPE\x20html>','Distributing\x20','sendMail','params','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Return\x20Goods','/give_payment/:id','Portuguese\x20(BR)','$suppliers_docs','There\x20is\x20','/invoice/:id','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','maxperunit','filter','\x20Order\x20Number\x20:\x20','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','/../public','due_amount','Spanish','standard_unit','stocks','maxStocks','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$primary_code','/barcode_scanner','$date','2-digit','$due_amount','/upload/','$expiry_date','</span>','get','user_id','stock_data','date','/incoming/add','prod_unit','/view_log','<tr>','unit','$product_details.type','return_purchase_finished','note','Asia/Manila','INC-','$product.bin','abs','RoomAssign','error','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','logo','paid_amount','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/getinvoicetrf','Router','match',',\x20room:\x20','type_of_products','DRY\x20GOODS','name','return_qty','$note','Email\x20sent\x20successfully','$product.floorlevel','4591185VowOFf','Purchase\x20Return','random','to_quantity','room',',\x20bin:\x20','slice','Room_name','6aNzUcQ','/all_purchases/view','116219OnBCZy','isProcess','status','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','createTransport','$product_details.rack','171404nDJARM','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<div>','all','$warehouse_name','purchases_id','$type_products','gross_price','</tr>','Purchase\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/all_purchases_finished/preview/','language','7854994AVClFT','email','FGSEmail','True','INCF-','expiry_date','<html><head><title></title>','$product_details.floorlevel','site_title','Enclosed','<tbody\x20style=\x22text-align:\x20center;\x22>','_id','product_id','to_recieved','then','</tbody>','return_product','<h5>','sales_category','maxProducts','MaxStocks_data','user','true','purchases_process','all_purchases_finished_logs','Enabled','edit_purchases_finished_view','find','An\x20error\x20occurred\x20while\x20saving\x20data.','secondary_code','355689PQBANf','$product.bay','floor','json','batch_code','purchase\x20data\x20add\x20successfully','here2','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product.type','</td>','Rack\x202','room_name','product_stock','product_code_hide','product_details','inc','\x20<>\x20','$product_details.product_stock','log','numeric','ejs','role','$product_details.product_name','to_warehouse','Purchase\x20Mail','$product_code','own','product_code','password'];a0_0x103a=function(){return _0x4559a0;};return a0_0x103a();}async function get_warehouse_data(_0x4c7390,_0x23bc4e){var _0x1f279f=a0_0xe45e51;try{const _0x30b741=await warehouse_temporary[_0x1f279f(0xfa)]({'name':_0x4c7390,'room':_0x23bc4e});if(!_0x30b741){const _0x5669e0=new warehouse_temporary({'name':_0x4c7390,'address':_0x4c7390,'status':_0x1f279f(0x1d3),'room':_0x23bc4e,'isStaging':_0x1f279f(0xb4)});return await _0x5669e0[_0x1f279f(0x122)](),_0x5669e0;}else return _0x30b741;}catch(_0x2fde5c){console[_0x1f279f(0x18c)](_0x1f279f(0x10f),_0x2fde5c);throw _0x2fde5c;}}router[a0_0xe45e51(0x141)]('/process/:id',auth,async(_0x3cd1cf,_0x436bb7)=>{var _0x437319=a0_0xe45e51;try{const _0x280e4f=_0x3cd1cf[_0x437319(0x15e)]['id'],_0x67e6cf=await purchases_finished[_0x437319(0x158)](_0x280e4f);let _0x549e18=[];_0x67e6cf[_0x437319(0xdc)][_0x437319(0x145)]((_0x33ce6c,_0x712371)=>{var _0x4d1582=_0x437319;_0x549e18[_0x712371]={},_0x549e18[_0x712371]['warehouse']=_0x67e6cf[_0x4d1582(0xc4)],_0x549e18[_0x712371][_0x4d1582(0x1c6)]=_0x33ce6c[_0x4d1582(0x1c6)],_0x549e18[_0x712371]['product_name']=_0x33ce6c[_0x4d1582(0x105)],_0x549e18[_0x712371][_0x4d1582(0xb1)]=_0x33ce6c[_0x4d1582(0xb1)],_0x549e18[_0x712371][_0x4d1582(0x1e5)]=_0x33ce6c[_0x4d1582(0x127)],_0x549e18[_0x712371][_0x4d1582(0x16f)]=_0x33ce6c[_0x4d1582(0x16f)],_0x549e18[_0x712371][_0x4d1582(0x135)]=_0x33ce6c[_0x4d1582(0x135)],_0x549e18[_0x712371][_0x4d1582(0x114)]=_0x33ce6c[_0x4d1582(0x114)],_0x549e18[_0x712371][_0x4d1582(0xfe)]=_0x33ce6c['bay'],_0x549e18[_0x712371][_0x4d1582(0x155)]=_0x33ce6c[_0x4d1582(0x155)],_0x549e18[_0x712371]['secondary_code']=_0x33ce6c[_0x4d1582(0x1d7)],_0x549e18[_0x712371]['maxStocks']=_0x33ce6c[_0x4d1582(0x171)],_0x549e18[_0x712371][_0x4d1582(0x1dc)]=_0x33ce6c['batch_code'],_0x549e18[_0x712371][_0x4d1582(0x1bf)]=_0x33ce6c[_0x4d1582(0x1bf)],_0x549e18[_0x712371]['production_date']=_0x33ce6c[_0x4d1582(0xf9)],_0x549e18[_0x712371][_0x4d1582(0x168)]=_0x33ce6c[_0x4d1582(0x168)],_0x549e18[_0x712371][_0x4d1582(0x111)]=_0x33ce6c[_0x4d1582(0x111)],_0x549e18[_0x712371][_0x4d1582(0x1e4)]=_0x33ce6c[_0x4d1582(0x1e4)],_0x549e18[_0x712371][_0x4d1582(0x109)]=_0x33ce6c[_0x4d1582(0x109)],_0x549e18[_0x712371]['uuid']=_0x33ce6c['uuid'],_0x549e18[_0x712371][_0x4d1582(0x1b4)]=_0x33ce6c[_0x4d1582(0x1b4)],_0x549e18[_0x712371][_0x4d1582(0x1cc)]=_0x33ce6c[_0x4d1582(0x1cc)],_0x549e18[_0x712371][_0x4d1582(0xfb)]=_0x33ce6c[_0x4d1582(0xfb)],_0x549e18[_0x712371][_0x4d1582(0x1b2)]=_0x33ce6c[_0x4d1582(0x1c5)][_0x4d1582(0x106)](),_0x549e18[_0x712371][_0x4d1582(0x136)]=_0x4d1582(0x1e8);});for(let _0x195707=0x0;_0x195707<=_0x549e18[_0x437319(0x13f)]-0x1;_0x195707++){const _0x16023e=_0x549e18[_0x195707],_0x8a8c46=new warehouse_temporary(_0x16023e);await _0x8a8c46[_0x437319(0x122)]();}_0x67e6cf[_0x437319(0x1a8)]=_0x437319(0x1d0),await _0x67e6cf['save'](),_0x3cd1cf[_0x437319(0xe3)]('success','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x436bb7[_0x437319(0x117)](_0x437319(0xf3)+_0x67e6cf[_0x437319(0x1c5)][_0x437319(0x106)]());}catch(_0x285011){}}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0xe4),auth,async(_0x260ab8,_0x347b69)=>{var _0x559584=a0_0xe45e51;try{const {invoice:_0x10e70d,date:_0x1fe3e3,warehouse_name:_0x3a47e5,prod_name:_0x40cdb4,note:_0x4c1fc6,due_amount:_0x25d645,Room_name:_0x366f36,PO_number:_0x18e1db,SCRN:_0x14b485,ReqBy:_0x13c6b8,dateofreq:_0x3fc663,suppliers:_0x33720a,typeservicesData:_0xaeac8a,van:_0x30a9af,typevehicle:_0x6bfe13,driver:_0x1b9e9e,plate:_0x1af8a0,DRSI:_0x2f7a33,TSU:_0x3978f7,TFU:_0x25e911,JO_number:_0x7e46b9,type_of_products:_0x1a6ff9}=_0x260ab8['body'];if(typeof _0x40cdb4=='string')var _0x4441=[_0x260ab8[_0x559584(0x104)][_0x559584(0x12a)]],_0xdf5ac=[_0x260ab8[_0x559584(0x104)]['prod_code']],_0x394a8e=[_0x260ab8['body'][_0x559584(0x12e)]],_0x3ee5bc=[_0x260ab8['body'][_0x559584(0x14e)]],_0x20c664=[_0x260ab8[_0x559584(0x104)]['prod_secondunit']],_0x5222a0=[_0x260ab8[_0x559584(0x104)]['prod_level']],_0x2e9142=[_0x260ab8[_0x559584(0x104)][_0x559584(0x155)]],_0x4713e2=[_0x260ab8[_0x559584(0x104)]['secondary_code']],_0x4c1673=[_0x260ab8['body'][_0x559584(0x1ce)]],_0x2fd5c8=[_0x260ab8[_0x559584(0x104)][_0x559584(0x1dc)]],_0x318bde=[_0x260ab8[_0x559584(0x104)][_0x559584(0x1bf)]],_0x204871=[_0x260ab8[_0x559584(0x104)][_0x559584(0xe5)]],_0x5b1809=[_0x260ab8[_0x559584(0x104)][_0x559584(0x11e)]],_0xccc7cf=[_0x260ab8[_0x559584(0x104)]['prod_cat']],_0x2d17ca=[_0x260ab8['body'][_0x559584(0x18b)]],_0x3838ad=[_0x260ab8[_0x559584(0x104)][_0x559584(0x1b4)]],_0x524d96=[_0x260ab8[_0x559584(0x104)][_0x559584(0xf4)]],_0x5691bf=[_0x260ab8[_0x559584(0x104)][_0x559584(0xc6)]],_0x78fef8=[_0x260ab8['body'][_0x559584(0x10d)]];else var _0x4441=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x12a)]],_0xdf5ac=[..._0x260ab8['body'][_0x559584(0xf6)]],_0x394a8e=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x12e)]],_0x3ee5bc=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x14e)]],_0x20c664=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x108)]],_0x5222a0=[..._0x260ab8['body'][_0x559584(0x142)]],_0x2e9142=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x155)]],_0x4713e2=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x1d7)]],_0x4c1673=[..._0x260ab8['body'][_0x559584(0x1ce)]],_0x2fd5c8=[..._0x260ab8['body'][_0x559584(0x1dc)]],_0x318bde=[..._0x260ab8['body'][_0x559584(0x1bf)]],_0x204871=[..._0x260ab8[_0x559584(0x104)][_0x559584(0xe5)]],_0x5b1809=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x11e)]],_0xccc7cf=[..._0x260ab8[_0x559584(0x104)]['prod_cat']],_0x2d17ca=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x18b)]],_0x3838ad=[..._0x260ab8[_0x559584(0x104)][_0x559584(0x1b4)]],_0x524d96=[..._0x260ab8[_0x559584(0x104)]['uuid']],_0x5691bf=[..._0x260ab8[_0x559584(0x104)][_0x559584(0xc6)]],_0x78fef8=[..._0x260ab8[_0x559584(0x104)]['type_of_products_type']];const _0x3638b7=_0x4441[_0x559584(0x11d)](_0x2a0a7a=>{return _0x2a0a7a={'product_name':_0x2a0a7a};});_0x78fef8[_0x559584(0x145)]((_0x53b0de,_0x235856)=>{var _0x130052=_0x559584;_0x3638b7[_0x235856][_0x130052(0x196)]=_0x53b0de;}),_0x5691bf[_0x559584(0x145)]((_0x169b38,_0x16b379)=>{_0x3638b7[_0x16b379]['sales_category']=_0x169b38;}),_0xdf5ac[_0x559584(0x145)]((_0x5f5bbd,_0x50f034)=>{var _0x3ab38a=_0x559584;_0x3638b7[_0x50f034][_0x3ab38a(0xb1)]=_0x5f5bbd;}),_0x524d96[_0x559584(0x145)]((_0x1f0358,_0x439162)=>{var _0x58702e=_0x559584;_0x3638b7[_0x439162][_0x58702e(0xf4)]=_0x1f0358;}),_0x394a8e[_0x559584(0x145)]((_0x4e5e75,_0x1ae803)=>{var _0x3295ff=_0x559584;_0x3638b7[_0x1ae803][_0x3295ff(0x127)]=Math[_0x3295ff(0x18a)](_0x4e5e75);}),_0x3ee5bc[_0x559584(0x145)]((_0x679b83,_0x3b6934)=>{var _0x4a9b04=_0x559584;_0x3638b7[_0x3b6934][_0x4a9b04(0x16f)]=_0x679b83;}),_0x20c664['forEach']((_0x247144,_0x573340)=>{var _0x480748=_0x559584;_0x3638b7[_0x573340][_0x480748(0x135)]=_0x247144;}),_0x5222a0[_0x559584(0x145)]((_0x18192d,_0x78837)=>{var _0x20daa4=_0x559584,_0x38c226=_0x18192d[_0x20daa4(0x194)](/[A-Za-z]+/)[0x0],_0x39f958=parseInt(_0x18192d[_0x20daa4(0x194)](/\d+/)[0x0]);_0x3638b7[_0x78837][_0x20daa4(0x114)]=_0x38c226,_0x3638b7[_0x78837][_0x20daa4(0xfe)]=_0x39f958;}),_0x2e9142[_0x559584(0x145)]((_0x14de56,_0x27acee)=>{_0x3638b7[_0x27acee]['primary_code']=_0x14de56;}),_0x4713e2['forEach']((_0x18c8f1,_0x3f51fd)=>{var _0x1bde86=_0x559584;_0x3638b7[_0x3f51fd][_0x1bde86(0x1d7)]=_0x18c8f1;}),_0x4c1673[_0x559584(0x145)]((_0x46a2b7,_0x3e4d7b)=>{var _0x586aaf=_0x559584;_0x3638b7[_0x3e4d7b][_0x586aaf(0x171)]=_0x46a2b7;}),_0x2fd5c8['forEach']((_0x4bddb5,_0x4ef54f)=>{_0x3638b7[_0x4ef54f]['batch_code']=_0x4bddb5;}),_0x318bde[_0x559584(0x145)]((_0x3def4b,_0x34bd2a)=>{var _0x17579f=_0x559584;_0x3638b7[_0x34bd2a][_0x17579f(0x1bf)]=_0x3def4b;}),_0x204871[_0x559584(0x145)]((_0x1d4274,_0x3d9f48)=>{var _0x572c93=_0x559584;_0x3638b7[_0x3d9f48][_0x572c93(0xf9)]=_0x1d4274;}),_0x5b1809[_0x559584(0x145)]((_0x5b2ca3,_0x1eb926)=>{var _0x3c1ab8=_0x559584;_0x3638b7[_0x1eb926][_0x3c1ab8(0x168)]=_0x5b2ca3;}),_0xccc7cf[_0x559584(0x145)]((_0x45dbab,_0x8bfaff)=>{var _0x514d87=_0x559584;_0x3638b7[_0x8bfaff][_0x514d87(0x111)]=_0x45dbab;}),_0x2d17ca[_0x559584(0x145)]((_0x4bac9c,_0x23a3f8)=>{var _0x361dc7=_0x559584;_0x3638b7[_0x23a3f8][_0x361dc7(0x1e4)]=_0x4bac9c;}),_0x3838ad[_0x559584(0x145)]((_0x3f87f3,_0x1c3c24)=>{var _0x56c692=_0x559584;_0x3638b7[_0x1c3c24][_0x56c692(0x1b4)]=_0x3f87f3;});const _0xd3b03c=new purchases_logs();await _0xd3b03c[_0x559584(0x122)]();for(let _0xc0acdc=0x0;_0xc0acdc<=_0x2d17ca[_0x559584(0x13f)]-0x1;_0xc0acdc++){_0x3638b7[_0xc0acdc][_0x559584(0x109)]=_0x559584(0x102)+_0xd3b03c[_0x559584(0xd2)][_0x559584(0xed)]()[_0x559584(0xd1)](0x8,'0');}const _0x11c82f=_0x3638b7[_0x559584(0x169)](_0x1b62d5=>_0x1b62d5[_0x559584(0x127)]!=='0'&&_0x1b62d5[_0x559584(0x127)]!==''),_0x1d38ac=new purchases_finished({'invoice':_0x559584(0x102)+_0xd3b03c[_0x559584(0xd2)]['toString']()[_0x559584(0xd1)](0x8,'0'),'suppliers':_0x33720a,'date':_0x1fe3e3,'warehouse_name':_0x3a47e5,'product':_0x11c82f,'note':_0x4c1fc6,'due_amount':_0x25d645,'room':_0x366f36,'POnumber':_0x18e1db,'SCRN':_0x14b485,'JO_number':_0x7e46b9,'ReqBy':_0x13c6b8,'dateofreq':_0x3fc663,'typeservicesData':_0xaeac8a,'van':_0x30a9af,'typevehicle':_0x6bfe13,'driver':_0x1b9e9e,'plate':_0x1af8a0,'DRSI':_0x2f7a33,'TSU':_0x3978f7,'TFU':_0x25e911,'typeOfProducts':_0x1a6ff9}),_0x548d12=await _0x1d38ac[_0x559584(0x122)](),_0x2471d0=await purchases_finished[_0x559584(0xfa)]({'_id':_0x548d12[_0x559584(0x1c5)][_0x559584(0x106)]()}),_0x246cf2=_0x2471d0['product'][_0x559584(0x11d)](async _0x172292=>{var _0x4b87fb=_0x559584;try{var _0xf09a0e=await warehouse[_0x4b87fb(0xfa)]({'name':_0x3a47e5,'room':_0x172292[_0x4b87fb(0x1e4)]}),_0x3d489e=0x0;const _0x1ddcd=_0xf09a0e[_0x4b87fb(0x1e7)][_0x4b87fb(0x11d)](_0x18f139=>{var _0x1fb7d3=_0x4b87fb;console[_0x1fb7d3(0x1eb)](_0x18f139[_0x1fb7d3(0x105)]+'=='+_0x172292[_0x1fb7d3(0x105)]+'&&'+_0x18f139[_0x1fb7d3(0xfe)]+'=='+_0x172292[_0x1fb7d3(0xfe)]+'&&'+_0x18f139[_0x1fb7d3(0x1bf)]+'=='+_0x172292[_0x1fb7d3(0x1bf)]+'&&'+_0x18f139['production_date']+'=='+_0x172292[_0x1fb7d3(0xf9)]+'&&'+_0x18f139[_0x1fb7d3(0x1dc)]+'=='+_0x172292['batch_code']+'&&'+_0x18f139[_0x1fb7d3(0x109)]+'=='+_0x2471d0['invoice']),_0x18f139[_0x1fb7d3(0x105)]==_0x172292[_0x1fb7d3(0x105)]&&_0x18f139[_0x1fb7d3(0xfe)]==_0x172292[_0x1fb7d3(0xfe)]&&_0x18f139['level']==_0x172292['level']&&_0x18f139['expiry_date']==_0x172292[_0x1fb7d3(0x1bf)]&&_0x18f139[_0x1fb7d3(0xf9)]==_0x172292[_0x1fb7d3(0xf9)]&&_0x18f139[_0x1fb7d3(0x1dc)]==_0x172292[_0x1fb7d3(0x1dc)]&&_0x18f139[_0x1fb7d3(0x109)]==_0x2471d0[_0x1fb7d3(0x109)]&&(_0x18f139[_0x1fb7d3(0x1e5)]=Math[_0x1fb7d3(0x18a)](_0x18f139[_0x1fb7d3(0x1e5)])+Math[_0x1fb7d3(0x18a)](_0x172292[_0x1fb7d3(0x127)]),_0x3d489e++);});return _0x3d489e==0x0&&(_0xf09a0e[_0x4b87fb(0x1e7)]=_0xf09a0e[_0x4b87fb(0x1e7)][_0x4b87fb(0xba)]({'product_name':_0x172292[_0x4b87fb(0x105)],'product_stock':Math[_0x4b87fb(0x18a)](_0x172292[_0x4b87fb(0x127)]),'primary_code':_0x172292[_0x4b87fb(0x155)],'secondary_code':_0x172292[_0x4b87fb(0x1d7)],'product_code':_0x172292[_0x4b87fb(0xb1)],'bay':_0x172292[_0x4b87fb(0xfe)],'level':_0x172292[_0x4b87fb(0x114)],'maxProducts':_0x172292['maxStocks'],'unit':_0x172292[_0x4b87fb(0x16f)],'secondary_unit':_0x172292['secondary_unit'],'expiry_date':_0x172292[_0x4b87fb(0x1bf)],'production_date':_0x172292[_0x4b87fb(0xf9)],'maxProducts':_0x172292[_0x4b87fb(0x171)],'maxPerUnit':_0x172292[_0x4b87fb(0x168)],'batch_code':_0x172292[_0x4b87fb(0x1dc)],'product_cat':_0x172292['product_cat'],'invoice':_0x172292[_0x4b87fb(0x109)],'id_incoming':_0x172292[_0x4b87fb(0x1c5)],'uuid':_0x172292['uuid'],'gross_price':_0x172292['gross_price'],'sales_category':_0x172292[_0x4b87fb(0x1cc)],'type_products':_0x172292[_0x4b87fb(0x196)]})),_0xf09a0e;}catch(_0x57a0e8){return console[_0x4b87fb(0x18c)]('Error\x20occurred\x20while\x20processing\x20product:',_0x57a0e8),null;}});Promise[_0x559584(0x1b0)](_0x246cf2)[_0x559584(0x1c8)](async _0x4e1406=>{var _0x1e7965=_0x559584;try{for(const _0x53a85d of _0x4e1406){await warehouse[_0x1e7965(0xb7)]({'_id':_0x53a85d['_id']},{'$addToSet':{'product_details':{'$each':_0x53a85d['product_details']}}});}const _0x42e3c4=await master_shop['find'](),_0x4ccfbd=await email_settings[_0x1e7965(0xfa)](),_0x371f32=await supervisor_settings['find']();var _0x2162e2=_0x2471d0[_0x1e7965(0xdc)],_0x29aacc='',_0x255511;for(_0x255511 in _0x2162e2){var _0x34d5f5='FG';_0x2471d0[_0x1e7965(0xc4)]==_0x1e7965(0x197)&&(_0x34d5f5='DG'),_0x29aacc+='<tr>'+_0x1e7965(0x18d)+_0x2162e2[_0x255511][_0x1e7965(0x105)]+_0x1e7965(0x1e2)+_0x1e7965(0x18d)+_0x2162e2[_0x255511][_0x1e7965(0xb1)]+_0x1e7965(0x1e2)+_0x1e7965(0x18d)+_0x2162e2[_0x255511][_0x1e7965(0x127)]+_0x1e7965(0x1e2)+_0x1e7965(0x18d)+_0x2162e2[_0x255511][_0x1e7965(0x16f)]+_0x1e7965(0x1e2)+_0x1e7965(0x18d)+_0x2162e2[_0x255511][_0x1e7965(0x135)]+_0x1e7965(0x1e2)+_0x1e7965(0x18d)+_0x2471d0[_0x1e7965(0xc4)]+_0x1e7965(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2162e2[_0x255511]['room_name']+_0x1e7965(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34d5f5+_0x2162e2[_0x255511]['bay']+_0x1e7965(0x1e2),_0x1e7965(0x1b5);}let _0x9271d8=nodemailer[_0x1e7965(0x1ab)]({'host':_0x4ccfbd['host'],'port':Number(_0x4ccfbd['port']),'secure':![],'auth':{'user':_0x4ccfbd[_0x1e7965(0x1bb)],'pass':_0x4ccfbd[_0x1e7965(0xb2)]}}),_0x32d02d={'from':_0x4ccfbd[_0x1e7965(0x1bb)],'to':_0x371f32[0x0][_0x1e7965(0x1bc)],'subject':_0x1e7965(0xae),'attachments':[{'filename':_0x1e7965(0xcf),'path':__dirname+_0x1e7965(0x16c)+_0x1e7965(0x178)+_0x42e3c4[0x0]['image'],'cid':'logo'}],'html':_0x1e7965(0x15b)+_0x1e7965(0x1c0)+_0x1e7965(0xf1)+_0x1e7965(0x1af)+_0x1e7965(0x1ae)+_0x1e7965(0x1af)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1e7965(0x134)+_0x1e7965(0x1af)+_0x1e7965(0x113)+_0x42e3c4[0x0][_0x1e7965(0x1c2)]+'\x20</h2>'+_0x1e7965(0x134)+_0x1e7965(0x134)+_0x1e7965(0xc5)+_0x1e7965(0x1af)+_0x1e7965(0xd5)+'\x20Order\x20Number\x20:\x20'+_0x2471d0[_0x1e7965(0x109)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1e7965(0x152)+_0x2471d0['date']+'\x20'+_0x1e7965(0x17a)+'</h5>'+'</div>'+_0x1e7965(0x15f)+_0x1e7965(0xfc)+'<tr>'+_0x1e7965(0xbc)+_0x1e7965(0x159)+_0x1e7965(0x14d)+_0x1e7965(0x167)+_0x1e7965(0xb9)+_0x1e7965(0x149)+_0x1e7965(0x144)+_0x1e7965(0x191)+'</tr>'+'</thead>'+_0x1e7965(0x1c4)+'\x20'+_0x29aacc+'\x20'+_0x1e7965(0x1c9)+_0x1e7965(0xec)+_0x1e7965(0x1af)+'<strong>\x20Regards\x20</strong>'+_0x1e7965(0x1cb)+_0x42e3c4[0x0]['site_title']+_0x1e7965(0xfd)+_0x1e7965(0x134)+_0x1e7965(0x134)+_0x1e7965(0x121)};_0x9271d8[_0x1e7965(0x15d)](_0x32d02d,function(_0x306a10,_0x226964){var _0x5976fa=_0x1e7965;_0x306a10?(console[_0x5976fa(0x1eb)](_0x306a10),console[_0x5976fa(0x1eb)](_0x5976fa(0x128))):console['log'](_0x5976fa(0x19b));});}catch(_0x1b7cdb){console['error'](_0x1b7cdb),_0x347b69[_0x1e7965(0x1a9)](0x1f4)[_0x1e7965(0x1db)]({'error':_0x1e7965(0x1d6),'message':_0x1b7cdb[_0x1e7965(0xcc)]});}})[_0x559584(0xd6)](_0x285426=>{var _0x2a6a5d=_0x559584;console[_0x2a6a5d(0x18c)](_0x285426);}),_0x260ab8['flash']('success','purchase\x20data\x20add\x20successfully'),_0x347b69[_0x559584(0x117)](_0x559584(0x1b8)+_0x2471d0['_id'][_0x559584(0x106)]());}catch(_0x2964f9){console['log'](_0x2964f9);}}),router[a0_0xe45e51(0x17b)](a0_0xe45e51(0xe0),auth,async(_0x3b2f28,_0x24132f)=>{var _0x3a208f=a0_0xe45e51;try{const {username:_0x5d85a6,email:_0x1f2466,role:_0x6e12df}=_0x3b2f28[_0x3a208f(0x1cf)],_0x1e3375=_0x3b2f28[_0x3a208f(0x1cf)],_0x5e6bd5=await profile[_0x3a208f(0xfa)]({'email':_0x1e3375[_0x3a208f(0x1bb)]}),_0x242e58=await master_shop[_0x3a208f(0x1d5)](),_0x2b31fb=_0x3b2f28['params']['id'],_0x785da=await purchases_finished[_0x3a208f(0x158)](_0x2b31fb),_0x5d18c6=await suppliers[_0x3a208f(0x1d5)]({});let _0x1a29cb;if(_0x1e3375[_0x3a208f(0x1ee)]=='staff'){const _0x4244a0=await staff[_0x3a208f(0xfa)]({'email':_0x1e3375[_0x3a208f(0x1bb)]});_0x1a29cb=await warehouse[_0x3a208f(0x1d5)]({'status':'Enabled','name':_0x4244a0['warehouse'],'warehouse_category':_0x3a208f(0xbb)});}else _0x1a29cb=await warehouse[_0x3a208f(0x10a)]([{'$match':{'status':_0x3a208f(0x1d3),'warehouse_category':_0x3a208f(0xbb)}},{'$group':{'_id':_0x3a208f(0x137),'name':{'$first':'$name'}}}]);const _0x19250c=await product['find']({}),_0x4c3b13=BayBinSelected(_0x785da[_0x3a208f(0xc4)],_0x785da[_0x3a208f(0x1a1)]);let _0x535eb8=new Date(_0x785da[_0x3a208f(0x1bf)]),_0x1b42b9=('0'+_0x535eb8[_0x3a208f(0x130)]())[_0x3a208f(0x1a3)](-0x2),_0x15db1c=('0'+(_0x535eb8['getMonth']()+0x1))['slice'](-0x2),_0x544e69=_0x535eb8[_0x3a208f(0x154)](),_0x5dc973=_0x544e69+'-'+_0x15db1c+'-'+_0x1b42b9;if(_0x242e58[0x0][_0x3a208f(0x1b9)]==_0x3a208f(0x13e)){var _0x17d596=users[_0x3a208f(0x166)];console['log'](_0x17d596);}else{if(_0x242e58[0x0]['language']==_0x3a208f(0x119))var _0x17d596=users['Hindi'];else{if(_0x242e58[0x0][_0x3a208f(0x1b9)]=='German')var _0x17d596=users[_0x3a208f(0x101)];else{if(_0x242e58[0x0][_0x3a208f(0x1b9)]==_0x3a208f(0x16e))var _0x17d596=users[_0x3a208f(0x16e)];else{if(_0x242e58[0x0][_0x3a208f(0x1b9)]==_0x3a208f(0xf5))var _0x17d596=users[_0x3a208f(0xf5)];else{if(_0x242e58[0x0]['language']==_0x3a208f(0x162))var _0x17d596=users[_0x3a208f(0x12c)];else{if(_0x242e58[0x0][_0x3a208f(0x1b9)]==_0x3a208f(0xdb))var _0x17d596=users['Chinese'];else{if(_0x242e58[0x0][_0x3a208f(0x1b9)]==_0x3a208f(0xe6))var _0x17d596=users['Arabic'];}}}}}}}_0x24132f[_0x3a208f(0x190)](_0x3a208f(0x1d4),{'success':_0x3b2f28[_0x3a208f(0xe3)](_0x3a208f(0x11a)),'errors':_0x3b2f28['flash'](_0x3a208f(0xeb)),'role':_0x1e3375,'profile':_0x5e6bd5,'purchases':_0x785da,'suppliers':_0x5d18c6,'warehouse':_0x1a29cb,'product':_0x19250c,'master_shop':_0x242e58,'language':_0x17d596,'ed_fullDate':_0x5dc973,'dataSelected':_0x4c3b13});}catch(_0x16d895){console[_0x3a208f(0x1eb)](_0x16d895);}}),router['get']('/view/:id',auth,async(_0xe1f89,_0x1ccb2c)=>{var _0x5f210e=a0_0xe45e51;try{const {username:_0xc87d3,email:_0x5b21e2,role:_0x3ec70e}=_0xe1f89[_0x5f210e(0x1cf)],_0xa13745=_0xe1f89['user'],_0x1081bb=await profile[_0x5f210e(0xfa)]({'email':_0xa13745[_0x5f210e(0x1bb)]}),_0x1d6788=await master_shop['find'](),_0x4ae353=_0xe1f89[_0x5f210e(0x15e)]['id'],_0x421fd3=await purchases_finished['findById'](_0x4ae353),_0xfe3215=await suppliers[_0x5f210e(0x1d5)]({});let _0x292b71;if(_0xa13745[_0x5f210e(0x1ee)]==_0x5f210e(0x11f)){const _0x15a45c=await staff['findOne']({'email':_0xa13745[_0x5f210e(0x1bb)]});_0x292b71=await warehouse[_0x5f210e(0x1d5)]({'status':_0x5f210e(0x1d3),'name':_0x15a45c[_0x5f210e(0x124)],'warehouse_category':'Finished\x20Goods'});}else _0x292b71=await warehouse[_0x5f210e(0x10a)]([{'$match':{'status':_0x5f210e(0x1d3),'warehouse_category':_0x5f210e(0xbb)}},{'$group':{'_id':_0x5f210e(0x137),'name':{'$first':'$name'}}}]);const _0x21b93e=await product['find']({}),_0x13fe8f=BayBinSelected(_0x421fd3[_0x5f210e(0xc4)],_0x421fd3['room']);let _0x2a8c5c=new Date(_0x421fd3[_0x5f210e(0x1bf)]),_0x1a81b5=('0'+_0x2a8c5c[_0x5f210e(0x130)]())[_0x5f210e(0x1a3)](-0x2),_0x4ea612=('0'+(_0x2a8c5c['getMonth']()+0x1))[_0x5f210e(0x1a3)](-0x2),_0x498fe2=_0x2a8c5c[_0x5f210e(0x154)](),_0x55e711=_0x498fe2+'-'+_0x4ea612+'-'+_0x1a81b5;if(_0x1d6788[0x0]['language']=='English\x20(US)'){var _0x16688d=users[_0x5f210e(0x166)];console[_0x5f210e(0x1eb)](_0x16688d);}else{if(_0x1d6788[0x0][_0x5f210e(0x1b9)]==_0x5f210e(0x119))var _0x16688d=users[_0x5f210e(0x119)];else{if(_0x1d6788[0x0][_0x5f210e(0x1b9)]==_0x5f210e(0x101))var _0x16688d=users['German'];else{if(_0x1d6788[0x0]['language']==_0x5f210e(0x16e))var _0x16688d=users[_0x5f210e(0x16e)];else{if(_0x1d6788[0x0]['language']==_0x5f210e(0xf5))var _0x16688d=users[_0x5f210e(0xf5)];else{if(_0x1d6788[0x0][_0x5f210e(0x1b9)]=='Portuguese\x20(BR)')var _0x16688d=users[_0x5f210e(0x12c)];else{if(_0x1d6788[0x0][_0x5f210e(0x1b9)]==_0x5f210e(0xdb))var _0x16688d=users[_0x5f210e(0xdb)];else{if(_0x1d6788[0x0][_0x5f210e(0x1b9)]=='Arabic\x20(ae)')var _0x16688d=users[_0x5f210e(0x11c)];}}}}}}}_0x1ccb2c[_0x5f210e(0x190)]('edit_purchases_finished',{'success':_0xe1f89[_0x5f210e(0xe3)]('success'),'errors':_0xe1f89['flash']('errors'),'role':_0xa13745,'profile':_0x1081bb,'purchases':_0x421fd3,'suppliers':_0xfe3215,'warehouse':_0x292b71,'product':_0x21b93e,'master_shop':_0x1d6788,'language':_0x16688d,'ed_fullDate':_0x55e711,'dataSelected':_0x13fe8f});}catch(_0x245c53){console[_0x5f210e(0x1eb)](_0x245c53);}}),router['post']('/view/:id',auth,async(_0x236ccd,_0xc9fe0)=>{var _0x3e7203=a0_0xe45e51;try{const _0x17e525=_0x236ccd['params']['id'],_0x3d9616=await purchases_finished['findOne']({'_id':_0x236ccd[_0x3e7203(0x15e)]['id']}),_0x3d887b=await warehouse[_0x3e7203(0xfa)]({'name':_0x3d9616[_0x3e7203(0xc4)],'room':_0x3d9616[_0x3e7203(0x1a1)]});_0x3d9616[_0x3e7203(0xdc)]['forEach'](_0x23a031=>{var _0x1b70d2=_0x3e7203;const _0xb5bb6c=_0x3d887b[_0x1b70d2(0x1e7)]['map'](_0x4f55c1=>{var _0xc4e60e=_0x1b70d2;_0x4f55c1[_0xc4e60e(0x105)]==_0x23a031['product_name']&&_0x4f55c1[_0xc4e60e(0xfe)]==_0x23a031[_0xc4e60e(0xfe)]&&(_0x4f55c1[_0xc4e60e(0x1e5)]=parseInt(_0x4f55c1[_0xc4e60e(0x1e5)])-parseInt(_0x23a031[_0xc4e60e(0x127)]));});}),await _0x3d887b[_0x3e7203(0x122)]();const {invoice:_0x4218c0,suppliers:_0x2721ec,date:_0xd7578d,warehouse_name:_0x4c994a,prod_name:_0xeea16e,prod_code:_0x20ff8c,prod_qty:_0x25af93,prod_unit:_0x2c9717,prod_secondunit:_0x2d212c,prod_level:_0x271fdd,prod_isle:_0x2fdc21,prod_pallet:_0x46a038,note:_0xbb33c1,expiry_date:_0x155880,batch_code:_0xd0f4e5,paid_amount:_0x531417,due_amount:_0xb0ffff,Room_name:_0x18a752,primary_code:_0x4c83d3,secondary_code:_0x1d5855,PO_number:_0x38852e,JO_number:_0x491931}=_0x236ccd[_0x3e7203(0x104)];if(typeof _0xeea16e==_0x3e7203(0xc3))var _0x50c17a=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x12a)]],_0x55b309=[_0x236ccd['body']['prod_code']],_0x4cffd=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0xbf)]],_0x4f9fd4=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x180)]],_0x148eb7=[_0x236ccd[_0x3e7203(0x104)]['prod_secondunit']],_0x1f4493=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x142)]],_0x41952f=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x155)]],_0x2d9002=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x1d7)]],_0x140b08=[_0x236ccd[_0x3e7203(0x104)]['MaxStocks_data']],_0x4c6146=[_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x1dc)]],_0xc6b26a=[_0x236ccd['body'][_0x3e7203(0x1bf)]];else var _0x50c17a=[..._0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x12a)]],_0x55b309=[..._0x236ccd[_0x3e7203(0x104)]['prod_code']],_0x4cffd=[..._0x236ccd['body'][_0x3e7203(0xbf)]],_0x4f9fd4=[..._0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x180)]],_0x148eb7=[..._0x236ccd['body'][_0x3e7203(0x108)]],_0x1f4493=[..._0x236ccd[_0x3e7203(0x104)]['prod_level']],_0x41952f=[..._0x236ccd['body'][_0x3e7203(0x155)]],_0x2d9002=[..._0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x1d7)]],_0x140b08=[..._0x236ccd[_0x3e7203(0x104)]['MaxStocks_data']],_0x4c6146=[..._0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x1dc)]],_0xc6b26a=[..._0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x1bf)]];const _0x4bf6d3=_0x50c17a[_0x3e7203(0x11d)](_0x26944=>{return _0x26944={'product_name':_0x26944};});_0x55b309[_0x3e7203(0x145)]((_0x2ce133,_0x4f6fa9)=>{var _0x4cc66b=_0x3e7203;_0x4bf6d3[_0x4f6fa9][_0x4cc66b(0xb1)]=_0x2ce133;}),_0x4cffd['forEach']((_0x18ef16,_0x4d3698)=>{_0x4bf6d3[_0x4d3698]['quantity']=_0x18ef16;}),_0x4f9fd4['forEach']((_0x48fcf9,_0x316cce)=>{var _0x431eeb=_0x3e7203;_0x4bf6d3[_0x316cce][_0x431eeb(0x16f)]=_0x48fcf9;}),_0x148eb7[_0x3e7203(0x145)]((_0x1cdffd,_0x3b2090)=>{var _0x124536=_0x3e7203;_0x4bf6d3[_0x3b2090][_0x124536(0x135)]=_0x1cdffd;}),_0x1f4493[_0x3e7203(0x145)]((_0x234292,_0x13b861)=>{var _0x249ed9=_0x3e7203;_0x4bf6d3[_0x13b861][_0x249ed9(0xfe)]=_0x234292;}),_0x41952f[_0x3e7203(0x145)]((_0x437e15,_0x52a559)=>{var _0xef0133=_0x3e7203;_0x4bf6d3[_0x52a559][_0xef0133(0x155)]=_0x437e15;}),_0x2d9002[_0x3e7203(0x145)]((_0x598ce3,_0x3459e6)=>{var _0x3f06d8=_0x3e7203;_0x4bf6d3[_0x3459e6][_0x3f06d8(0x1d7)]=_0x598ce3;}),_0x140b08['forEach']((_0x38057d,_0x41c41e)=>{var _0x55c9f8=_0x3e7203;_0x4bf6d3[_0x41c41e][_0x55c9f8(0x171)]=_0x38057d;}),_0x4c6146['forEach']((_0x18daab,_0x80014e)=>{_0x4bf6d3[_0x80014e]['batch_code']=_0x18daab;}),_0xc6b26a['forEach']((_0x279dcd,_0x597307)=>{var _0x2405da=_0x3e7203;_0x4bf6d3[_0x597307][_0x2405da(0x1bf)]=_0x279dcd;});const _0x151486=_0x4bf6d3[_0x3e7203(0x169)](_0x1aa990=>_0x1aa990[_0x3e7203(0x127)]!=='0'&&_0x1aa990[_0x3e7203(0x127)]!=='');_0x3d9616['invoice']=_0x4218c0,_0x3d9616['suppliers']=_0x2721ec,_0x3d9616[_0x3e7203(0x17e)]=_0xd7578d,_0x3d9616[_0x3e7203(0xc4)]=_0x4c994a,_0x3d9616[_0x3e7203(0xdc)]=_0x151486,_0x3d9616[_0x3e7203(0x186)]=_0xbb33c1,_0x3d9616[_0x3e7203(0x18f)]=_0x531417,_0x3d9616[_0x3e7203(0x16d)]=_0xb0ffff,_0x3d9616['room']=_0x18a752,_0x3d9616['POnumber']=_0x38852e,_0x3d9616['JO_number']=_0x491931;const _0x2dde23=await _0x3d9616['save'](),_0x222d98=await warehouse['findOne']({'name':_0x236ccd[_0x3e7203(0x104)]['warehouse_name'],'room':_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x1a4)]});_0x3d9616[_0x3e7203(0xdc)]['forEach'](_0x5f3120=>{var _0x5da619=_0x3e7203,_0x1c2fe6=0x0;const _0x1643d7=_0x222d98[_0x5da619(0x1e7)][_0x5da619(0x11d)](_0x401373=>{var _0x2ccafe=_0x5da619;_0x401373['product_name']==_0x5f3120[_0x2ccafe(0x105)]&&_0x401373[_0x2ccafe(0xfe)]==_0x5f3120[_0x2ccafe(0xfe)]&&(_0x401373[_0x2ccafe(0x1e5)]=parseInt(_0x401373[_0x2ccafe(0x1e5)])+parseInt(_0x5f3120[_0x2ccafe(0x127)]),_0x1c2fe6++);});_0x1c2fe6=='0'&&(_0x222d98['product_details']=_0x222d98[_0x5da619(0x1e7)]['concat']({'product_name':_0x5f3120[_0x5da619(0x105)],'product_stock':_0x5f3120[_0x5da619(0x127)],'primary_code':_0x5f3120[_0x5da619(0x155)],'secondary_code':_0x5f3120[_0x5da619(0x1d7)],'product_code':_0x5f3120[_0x5da619(0xb1)],'bay':_0x5f3120[_0x5da619(0xfe)],'maxProducts':_0x5f3120['maxStocks'],'unit':_0x5f3120[_0x5da619(0x16f)],'secondary_unit':_0x5f3120[_0x5da619(0x135)],'expiry_date':_0x5f3120[_0x5da619(0x1bf)]}));}),await _0x222d98[_0x3e7203(0x122)]();const _0x52e559=await s_payment_data[_0x3e7203(0xfa)]({'invoice':_0x236ccd['body'][_0x3e7203(0x109)]});if(_0x52e559===null){}else console[_0x3e7203(0x1eb)](_0x3e7203(0x13d),_0x52e559,_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x109)]),_0x52e559[_0x3e7203(0x13d)]=_0x236ccd[_0x3e7203(0x104)][_0x3e7203(0x13d)],await _0x52e559['save']();_0x236ccd['flash'](_0x3e7203(0x11a),_0x3e7203(0xcb)),_0xc9fe0['redirect'](_0x3e7203(0x133));}catch(_0x3cec01){console[_0x3e7203(0x1eb)](_0x3cec01);}}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0x161),auth,async(_0x541398,_0x35139e)=>{var _0x418fc6=a0_0xe45e51;try{const _0x550425=_0x541398[_0x418fc6(0x15e)]['id'],{invoice:_0x2bcc65,suppliers:_0x2e647d,payable:_0x4128f0,due_amount:_0x4bc0b5}=_0x541398[_0x418fc6(0x104)],_0x13157f=await purchases[_0x418fc6(0x158)](_0x550425);var _0x2574c1=_0x4128f0-_0x4bc0b5;_0x13157f[_0x418fc6(0x18f)]=parseFloat(_0x13157f[_0x418fc6(0x18f)])+parseFloat(_0x4bc0b5),_0x13157f[_0x418fc6(0x16d)]=_0x2574c1;const _0x35d0a1=await _0x13157f['save']();console[_0x418fc6(0x1eb)](_0x35d0a1);const _0x5d97f4=await s_payment_data[_0x418fc6(0xfa)]({'invoice':_0x2bcc65});_0x5d97f4['amount']=_0x2574c1,await _0x5d97f4['save']();let _0x5d7b82=new Date(),_0x2816a5=('0'+_0x5d7b82[_0x418fc6(0x130)]())[_0x418fc6(0x1a3)](-0x2),_0x426b3c=('0'+(_0x5d7b82['getMonth']()+0x1))[_0x418fc6(0x1a3)](-0x2),_0x11146c=_0x5d7b82[_0x418fc6(0x154)](),_0x231e82=_0x11146c+'-'+_0x426b3c+'-'+_0x2816a5;const _0x20fad9=new suppliers_payment({'invoice':_0x2bcc65,'date':_0x11146c+'-'+_0x426b3c+'-'+_0x2816a5,'suppliers':_0x2e647d,'reason':_0x418fc6(0xe8),'amount':_0x4bc0b5}),_0x10da0f=await _0x20fad9[_0x418fc6(0x122)]();_0x541398[_0x418fc6(0xe3)](_0x418fc6(0x11a),_0x418fc6(0xd0)),_0x35139e[_0x418fc6(0x117)](_0x418fc6(0x1a6));}catch(_0x256a2b){console['log'](_0x256a2b);}}),router[a0_0xe45e51(0x17b)](a0_0xe45e51(0x165),auth,async(_0x20c785,_0x240a05)=>{var _0x2060ba=a0_0xe45e51;try{const {username:_0x3f2b70,email:_0x444dc9,role:_0x36da82}=_0x20c785['user'],_0x111440=_0x20c785[_0x2060ba(0x1cf)],_0x581032=await profile[_0x2060ba(0xfa)]({'email':_0x111440[_0x2060ba(0x1bb)]}),_0x4bbe57=await master_shop[_0x2060ba(0x1d5)]();console[_0x2060ba(0x1eb)](_0x2060ba(0x116),_0x4bbe57);const _0x85e842=_0x20c785['params']['id'],_0x530642=await purchases[_0x2060ba(0x158)](_0x85e842);console[_0x2060ba(0x1eb)](_0x530642);const _0x93a15d=await suppliers[_0x2060ba(0xfa)]({'name':_0x530642[_0x2060ba(0x13d)]});console[_0x2060ba(0x1eb)](_0x93a15d);if(_0x4bbe57[0x0][_0x2060ba(0x1b9)]==_0x2060ba(0x13e)){var _0x43b9af=users[_0x2060ba(0x166)];console[_0x2060ba(0x1eb)](_0x43b9af);}else{if(_0x4bbe57[0x0][_0x2060ba(0x1b9)]==_0x2060ba(0x119))var _0x43b9af=users[_0x2060ba(0x119)];else{if(_0x4bbe57[0x0][_0x2060ba(0x1b9)]==_0x2060ba(0x101))var _0x43b9af=users[_0x2060ba(0x101)];else{if(_0x4bbe57[0x0][_0x2060ba(0x1b9)]=='Spanish')var _0x43b9af=users[_0x2060ba(0x16e)];else{if(_0x4bbe57[0x0][_0x2060ba(0x1b9)]==_0x2060ba(0xf5))var _0x43b9af=users[_0x2060ba(0xf5)];else{if(_0x4bbe57[0x0][_0x2060ba(0x1b9)]==_0x2060ba(0x162))var _0x43b9af=users[_0x2060ba(0x12c)];else{if(_0x4bbe57[0x0]['language']=='Chinese')var _0x43b9af=users[_0x2060ba(0xdb)];else{if(_0x4bbe57[0x0]['language']==_0x2060ba(0xe6))var _0x43b9af=users['Arabic'];}}}}}}}_0x240a05[_0x2060ba(0x190)](_0x2060ba(0xd4),{'success':_0x20c785['flash']('success'),'errors':_0x20c785[_0x2060ba(0xe3)]('errors'),'role':_0x111440,'profile':_0x581032,'master_shop':_0x4bbe57,'supplier':_0x93a15d,'purchase':_0x530642,'language':_0x43b9af});}catch(_0x267e86){console[_0x2060ba(0x1eb)](_0x267e86);}}),router[a0_0xe45e51(0x17b)]('/view/return_purchase/:id',auth,async(_0x38aeed,_0x2e5681)=>{var _0x402a97=a0_0xe45e51;try{const {username:_0x40637b,email:_0x39ffcd,role:_0x2a441b}=_0x38aeed[_0x402a97(0x1cf)],_0xb9d62e=_0x38aeed[_0x402a97(0x1cf)],_0xee9506=await profile[_0x402a97(0xfa)]({'email':_0xb9d62e[_0x402a97(0x1bb)]}),_0x181818=await master_shop[_0x402a97(0x1d5)]();console[_0x402a97(0x1eb)](_0x402a97(0x116),_0x181818);const _0xa59266=_0x38aeed[_0x402a97(0x15e)]['id'];console['log'](_0xa59266);const _0x276af1=await purchases_finished['findById'](_0xa59266);console[_0x402a97(0x1eb)](_0x402a97(0x17c),_0x276af1);const _0x52d3f6=await product[_0x402a97(0x1d5)]({}),_0x1a4bff=await warehouse['aggregate']([{'$match':{'name':_0x276af1[_0x402a97(0xc4)],'room':_0x276af1[_0x402a97(0x1a1)]}},{'$unwind':_0x402a97(0x157)},{'$group':{'_id':_0x402a97(0xcd),'name':{'$first':_0x402a97(0x1ef)},'product_stock':{'$first':_0x402a97(0x1ea)},'bay':{'$first':_0x402a97(0xd9)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x402a97(0x184)},'floorlevel':{'$first':_0x402a97(0x1c1)},'primary_code':{'$first':_0x402a97(0xff)},'secondary_code':{'$first':_0x402a97(0x15a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x402a97(0x131)},'rack':{'$first':_0x402a97(0x1ac)}}}]);console[_0x402a97(0x1eb)](_0x402a97(0x17d),_0x1a4bff);let _0x155c7d;if(_0xb9d62e[_0x402a97(0x1ee)]==_0x402a97(0x11f)){const _0x2bf483=await staff[_0x402a97(0xfa)]({'email':_0xb9d62e[_0x402a97(0x1bb)]});_0x155c7d=await warehouse[_0x402a97(0x1d5)]({'status':_0x402a97(0x1d3),'name':_0x2bf483[_0x402a97(0x124)],'warehouse_category':_0x402a97(0xbb),'name':_0x402a97(0x160)});}else _0x155c7d=await warehouse[_0x402a97(0x10a)]([{'$match':{'status':_0x402a97(0x1d3),'warehouse_category':_0x402a97(0xbb),'name':_0x402a97(0x160)}},{'$group':{'_id':_0x402a97(0x137),'name':{'$first':'$name'}}}]);if(_0x181818[0x0][_0x402a97(0x1b9)]=='English\x20(US)'){var _0x590cd1=users['English'];console['log'](_0x590cd1);}else{if(_0x181818[0x0][_0x402a97(0x1b9)]==_0x402a97(0x119))var _0x590cd1=users[_0x402a97(0x119)];else{if(_0x181818[0x0][_0x402a97(0x1b9)]=='German')var _0x590cd1=users[_0x402a97(0x101)];else{if(_0x181818[0x0][_0x402a97(0x1b9)]==_0x402a97(0x16e))var _0x590cd1=users[_0x402a97(0x16e)];else{if(_0x181818[0x0][_0x402a97(0x1b9)]=='French')var _0x590cd1=users[_0x402a97(0xf5)];else{if(_0x181818[0x0]['language']==_0x402a97(0x162))var _0x590cd1=users['Portuguese'];else{if(_0x181818[0x0]['language']=='Chinese')var _0x590cd1=users[_0x402a97(0xdb)];else{if(_0x181818[0x0]['language']=='Arabic\x20(ae)')var _0x590cd1=users[_0x402a97(0x11c)];}}}}}}}_0x2e5681['render'](_0x402a97(0x185),{'success':_0x38aeed[_0x402a97(0xe3)](_0x402a97(0x11a)),'errors':_0x38aeed[_0x402a97(0xe3)](_0x402a97(0xeb)),'role':_0xb9d62e,'profile':_0xee9506,'user':_0x276af1,'stock':_0x1a4bff,'master_shop':_0x181818,'product':_0x52d3f6,'language':_0x590cd1,'warehouse':_0x155c7d});}catch(_0xdb4732){console[_0x402a97(0x1eb)](_0xdb4732);}}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0x10b),auth,async(_0x3c68d7,_0x2d5bc2)=>{var _0x49cd90=a0_0xe45e51;try{const {invoice:_0x5c53c5,date:_0xd5bcd5,warehouse_name:_0x3fa6ce,Room_name:_0x1c59f2,product_name:_0x339926,purchase_quantity:_0x2ddc58,stocks:_0x4568b1,return_qty:_0x2a613d,note:_0x1036a5,level:_0x331d64,isle:_0x57aa22,pallet:_0x1e0125,to_warehouse_name:_0x32289d,to_Room_name:_0x67b848}=_0x3c68d7[_0x49cd90(0x104)],_0x157c5a=await purchases_finished['findOne']({'_id':_0x3c68d7[_0x49cd90(0x15e)]['id']}),_0x26cdbd=await warehouse[_0x49cd90(0xfa)]({'name':_0x3fa6ce,'room':_0x1c59f2,'warehouse_category':_0x49cd90(0xbb)});if(typeof _0x339926=='string')var _0x13851c=[_0x3c68d7[_0x49cd90(0x104)][_0x49cd90(0x105)]],_0x4afa03=[_0x3c68d7[_0x49cd90(0x104)]['purchase_quantity']],_0x53a57f=[_0x3c68d7['body'][_0x49cd90(0x170)]],_0x5c1ce9=[_0x3c68d7['body'][_0x49cd90(0x199)]],_0x3bf461=[_0x3c68d7['body'][_0x49cd90(0x114)]],_0x3ebced=[_0x3c68d7[_0x49cd90(0x104)][_0x49cd90(0x1e6)]],_0x2b3b0c=[_0x3c68d7['body']['primary_code_hide']],_0x2d8ade=[_0x3c68d7['body'][_0x49cd90(0x132)]];else var _0x13851c=[..._0x3c68d7['body'][_0x49cd90(0x105)]],_0x4afa03=[..._0x3c68d7[_0x49cd90(0x104)][_0x49cd90(0xc0)]],_0x53a57f=[..._0x3c68d7[_0x49cd90(0x104)]['stocks']],_0x5c1ce9=[..._0x3c68d7[_0x49cd90(0x104)]['return_qty']],_0x3bf461=[..._0x3c68d7[_0x49cd90(0x104)]['level']],_0x3ebced=[..._0x3c68d7[_0x49cd90(0x104)][_0x49cd90(0x1e6)]],_0x2b3b0c=[..._0x3c68d7[_0x49cd90(0x104)]['primary_code_hide']],_0x2d8ade=[..._0x3c68d7[_0x49cd90(0x104)]['secondary_code_hide']];const _0x4ac477=_0x13851c[_0x49cd90(0x11d)](_0x2a8ac6=>{return _0x2a8ac6={'product_name':_0x2a8ac6};});_0x4afa03[_0x49cd90(0x145)]((_0x466779,_0x5554d7)=>{var _0x59615f=_0x49cd90;_0x4ac477[_0x5554d7][_0x59615f(0xc0)]=_0x466779;}),_0x53a57f['forEach']((_0x11f08a,_0x49f7d8)=>{var _0x3799d4=_0x49cd90;_0x4ac477[_0x49f7d8][_0x3799d4(0x115)]=_0x11f08a;}),_0x5c1ce9[_0x49cd90(0x145)]((_0x3a6f5f,_0x2fec71)=>{var _0x7f0554=_0x49cd90;_0x4ac477[_0x2fec71][_0x7f0554(0x199)]=_0x3a6f5f;}),_0x3bf461[_0x49cd90(0x145)]((_0x495677,_0x5bd11d)=>{var _0x2870df=_0x49cd90;_0x4ac477[_0x5bd11d][_0x2870df(0xfe)]=_0x495677;}),_0x3ebced[_0x49cd90(0x145)]((_0xa8f755,_0x7e604b)=>{var _0x351b14=_0x49cd90;_0x4ac477[_0x7e604b][_0x351b14(0xb1)]=_0xa8f755;}),_0x2b3b0c[_0x49cd90(0x145)]((_0x30f8ab,_0x1b2a7e)=>{var _0x17ea7e=_0x49cd90;_0x4ac477[_0x1b2a7e][_0x17ea7e(0x155)]=_0x30f8ab;}),_0x2d8ade['forEach']((_0x334388,_0x3c9705)=>{var _0x3f40be=_0x49cd90;_0x4ac477[_0x3c9705][_0x3f40be(0x1d7)]=_0x334388;}),_0x4ac477['forEach'](_0x6a646a=>{var _0x2f84f2=_0x49cd90;console[_0x2f84f2(0x1eb)](_0x6a646a);const _0x4bb5a3=_0x26cdbd['product_details'][_0x2f84f2(0x11d)](_0x113e49=>{var _0x5b664f=_0x2f84f2;_0x113e49[_0x5b664f(0x105)]==_0x6a646a[_0x5b664f(0x105)]&&_0x113e49[_0x5b664f(0xfe)]==_0x6a646a['bay']&&(console[_0x5b664f(0x1eb)](parseInt(_0x113e49['product_stock'])+_0x5b664f(0x1e9)+parseInt(_0x6a646a[_0x5b664f(0x199)])),_0x113e49[_0x5b664f(0x1e5)]=parseInt(_0x113e49[_0x5b664f(0x1e5)])-parseInt(_0x6a646a[_0x5b664f(0x199)]));});}),await _0x26cdbd['save']();var _0x453d96=0x0;_0x4ac477[_0x49cd90(0x145)](_0x232987=>{var _0x345bf4=_0x49cd90;(parseInt(_0x232987[_0x345bf4(0xc0)])<parseInt(_0x232987[_0x345bf4(0x199)])||parseInt(_0x232987[_0x345bf4(0x115)])<parseInt(_0x232987['return_qty']))&&_0x453d96++;});if(_0x453d96!=0x0)return _0x3c68d7[_0x49cd90(0xe3)](_0x49cd90(0xeb),_0x49cd90(0x172)),_0x2d5bc2[_0x49cd90(0x117)](_0x49cd90(0xd8));const _0x16b095=new purchases_return_finished({'invoice':_0x5c53c5,'suppliers':_0x3c68d7[_0x49cd90(0x104)][_0x49cd90(0x13d)],'date':_0xd5bcd5,'warehouse_name':_0x3fa6ce,'return_product':_0x4ac477,'note':_0x1036a5,'room':_0x1c59f2,'to_warehouse_name':_0x32289d,'to_room':_0x67b848}),_0x14ec1c=await _0x16b095[_0x49cd90(0x122)](),_0x7838f5=await purchases_return_finished[_0x49cd90(0xfa)]({'invoice':_0x5c53c5}),_0xfd4ee0=await warehouse[_0x49cd90(0xfa)]({'name':_0x32289d,'room':_0x67b848,'warehouse_category':'Finished\x20Goods'});_0x7838f5[_0x49cd90(0x1ca)][_0x49cd90(0x145)](_0x484805=>{var _0x46fdf=_0x49cd90,_0x51043e=0x0;const _0x36f20b=_0xfd4ee0[_0x46fdf(0x1e7)]['map'](_0x51606a=>{var _0x26e854=_0x46fdf;console['log'](_0x51606a['product_name']+'=='+_0x484805[_0x26e854(0x105)]+'&&'+_0x51606a['bay']+'=='+_0x484805['bay']),_0x51606a[_0x26e854(0x105)]==_0x484805[_0x26e854(0x105)]&&_0x51606a[_0x26e854(0xfe)]==_0x484805[_0x26e854(0xfe)]&&(_0x51606a[_0x26e854(0x1e5)]=parseInt(_0x51606a[_0x26e854(0x1e5)])-parseInt(_0x484805[_0x26e854(0x199)]),_0x51043e++);});_0x51043e=='0'&&(_0xfd4ee0['product_details']=_0xfd4ee0[_0x46fdf(0x1e7)]['concat']({'product_name':_0x484805[_0x46fdf(0x105)],'product_stock':_0x484805[_0x46fdf(0x199)],'primary_code':_0x484805[_0x46fdf(0x155)],'secondary_code':_0x484805[_0x46fdf(0x1d7)],'product_code':_0x484805[_0x46fdf(0xb1)],'bay':_0x484805[_0x46fdf(0xfe)],'maxProducts':0xf423f}));}),await _0xfd4ee0['save']();const _0xfe0f90=await purchases_finished[_0x49cd90(0xfa)]({'invoice':_0x5c53c5});_0xfe0f90[_0x49cd90(0x125)]=_0x49cd90(0x1bd);const _0x255da1=await _0xfe0f90['save'](),_0x5755f3=new s_payment_data({'invoice':_0x5c53c5,'suppliers':_0x3c68d7[_0x49cd90(0x104)]['suppliers'],'reason':_0x49cd90(0x19e)});await _0x5755f3[_0x49cd90(0x122)]();const _0x3a1a7d=await master_shop[_0x49cd90(0x1d5)](),_0x3d1103=await email_settings[_0x49cd90(0xfa)](),_0x40ebe1=await suppliers[_0x49cd90(0xfa)]({'name':_0x3c68d7[_0x49cd90(0x104)]['suppliers']});_0x3a1a7d[0x0][_0x49cd90(0x14a)]==0x1?(right_currency=_0x3a1a7d[0x0][_0x49cd90(0x139)],left_currency=''):(right_currency='',left_currency=_0x3a1a7d[0x0][_0x49cd90(0x139)]);var _0x38f361=_0x13851c,_0x2a5240=_0x5c1ce9,_0x2205d2='',_0x122dc1;for(_0x122dc1 in _0x38f361){_0x2205d2+=_0x49cd90(0x182)+_0x49cd90(0x18d)+_0x38f361[_0x122dc1]+_0x49cd90(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a5240[_0x122dc1]+_0x49cd90(0x1e2)+_0x49cd90(0x1b5);}let _0x25cf82=nodemailer['createTransport']({'service':_0x49cd90(0xef),'auth':{'user':_0x3d1103['email'],'pass':_0x3d1103[_0x49cd90(0xb2)]}}),_0x249fa3={'from':_0x3d1103['email'],'to':_0x40ebe1['email'],'subject':_0x49cd90(0x1b6),'attachments':[{'filename':_0x49cd90(0xcf),'path':__dirname+_0x49cd90(0x16c)+_0x49cd90(0x178)+_0x3a1a7d[0x0][_0x49cd90(0xb6)],'cid':_0x49cd90(0x18e)}],'html':_0x49cd90(0x15b)+_0x49cd90(0x1c0)+_0x49cd90(0xf1)+_0x49cd90(0x1af)+_0x49cd90(0x1ae)+_0x49cd90(0x1af)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x49cd90(0x134)+_0x49cd90(0x1af)+_0x49cd90(0x113)+_0x3a1a7d[0x0][_0x49cd90(0x1c2)]+'\x20</h2>'+'</div>'+_0x49cd90(0x134)+_0x49cd90(0xc5)+_0x49cd90(0x1af)+_0x49cd90(0xd5)+_0x49cd90(0x16a)+_0x5c53c5+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x49cd90(0x152)+_0xd5bcd5+'\x20'+_0x49cd90(0x17a)+_0x49cd90(0xfd)+_0x49cd90(0x134)+_0x49cd90(0x15f)+_0x49cd90(0xfc)+_0x49cd90(0x182)+_0x49cd90(0xbc)+_0x49cd90(0xf7)+_0x49cd90(0x1b7)+_0x49cd90(0x1e0)+'</tr>'+_0x49cd90(0x156)+_0x49cd90(0x1c4)+'\x20'+_0x2205d2+'\x20'+_0x49cd90(0x1c9)+_0x49cd90(0xec)+_0x49cd90(0x1af)+_0x49cd90(0x112)+_0x49cd90(0x1cb)+_0x3a1a7d[0x0][_0x49cd90(0x1c2)]+_0x49cd90(0xfd)+'</div>'+_0x49cd90(0x134)+_0x49cd90(0x121)};_0x25cf82[_0x49cd90(0x15d)](_0x249fa3,function(_0x3a7123,_0x1c4e07){var _0x45f4cc=_0x49cd90;_0x3a7123?console[_0x45f4cc(0x1eb)]('Error\x20Occurs'):console[_0x45f4cc(0x1eb)](_0x45f4cc(0x19b));}),_0x3c68d7['flash'](_0x49cd90(0x11a),_0x49cd90(0x12d)),_0x2d5bc2[_0x49cd90(0x117)](_0x49cd90(0x133));}catch(_0x1d994a){_0x2d5bc2[_0x49cd90(0x1a9)](0xc8)[_0x49cd90(0x1db)]({'message':_0x1d994a[_0x49cd90(0xcc)]});}}),router[a0_0xe45e51(0x17b)](a0_0xe45e51(0x126),auth,async(_0x21b6d0,_0x231190)=>{var _0x42ed44=a0_0xe45e51;try{const {username:_0x13f4c2,email:_0x1fe714,role:_0x57a91a}=_0x21b6d0[_0x42ed44(0x1cf)],_0x55c4ca=_0x21b6d0[_0x42ed44(0x1cf)],_0x34a6f9=await profile[_0x42ed44(0xfa)]({'email':_0x55c4ca['email']}),_0x2de1af=await master_shop[_0x42ed44(0x1d5)](),_0x300034=_0x21b6d0[_0x42ed44(0x15e)]['id'],_0x54f2ae=await purchases_finished[_0x42ed44(0x158)](_0x300034);if(_0x2de1af[0x0][_0x42ed44(0x1b9)]==_0x42ed44(0x13e))var _0x1b04fe=users[_0x42ed44(0x166)];else{if(_0x2de1af[0x0]['language']==_0x42ed44(0x119))var _0x1b04fe=users[_0x42ed44(0x119)];else{if(_0x2de1af[0x0][_0x42ed44(0x1b9)]==_0x42ed44(0x101))var _0x1b04fe=users[_0x42ed44(0x101)];else{if(_0x2de1af[0x0][_0x42ed44(0x1b9)]==_0x42ed44(0x16e))var _0x1b04fe=users[_0x42ed44(0x16e)];else{if(_0x2de1af[0x0][_0x42ed44(0x1b9)]=='French')var _0x1b04fe=users[_0x42ed44(0xf5)];else{if(_0x2de1af[0x0]['language']==_0x42ed44(0x162))var _0x1b04fe=users[_0x42ed44(0x12c)];else{if(_0x2de1af[0x0][_0x42ed44(0x1b9)]==_0x42ed44(0xdb))var _0x1b04fe=users['Chinese'];else{if(_0x2de1af[0x0][_0x42ed44(0x1b9)]==_0x42ed44(0xe6))var _0x1b04fe=users[_0x42ed44(0x11c)];}}}}}}}_0x231190[_0x42ed44(0x190)](_0x42ed44(0x14f),{'success':_0x21b6d0[_0x42ed44(0xe3)](_0x42ed44(0x11a)),'errors':_0x21b6d0[_0x42ed44(0xe3)](_0x42ed44(0xeb)),'role':_0x55c4ca,'profile':_0x34a6f9,'alldata':_0x54f2ae,'master_shop':_0x2de1af,'language':_0x1b04fe}),console[_0x42ed44(0x1eb)](alldata);}catch(_0x641ee5){console[_0x42ed44(0x1eb)](_0x641ee5);}}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0x174),async(_0x427e0a,_0xf0df99)=>{var _0x3be5e6=a0_0xe45e51;const {product_code:_0xece30c}=_0x427e0a[_0x3be5e6(0x104)];var _0x9cbae7;const _0x4c7388=await product[_0x3be5e6(0x10a)]([{'$match':{'primary_code':_0xece30c}},{'$group':{'_id':_0x3be5e6(0xf8),'name':{'$first':_0x3be5e6(0x137)},'category':{'$first':'$category'},'brand':{'$first':_0x3be5e6(0xb5)},'unit':{'$first':_0x3be5e6(0xde)},'alertquantity':{'$first':_0x3be5e6(0x146)},'product_code':{'$first':_0x3be5e6(0xaf)},'primary_code':{'$first':_0x3be5e6(0x173)},'secondary_code':{'$first':_0x3be5e6(0xc7)},'maxStocks':{'$first':_0x3be5e6(0x143)},'maxProdPerUnit':{'$first':_0x3be5e6(0x12b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x3be5e6(0xee)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x4db275=await product[_0x3be5e6(0x10a)]([{'$match':{'secondary_code':_0xece30c}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x3be5e6(0x120)},'brand':{'$first':_0x3be5e6(0xb5)},'unit':{'$first':_0x3be5e6(0xde)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3be5e6(0xaf)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3be5e6(0xc7)},'maxStocks':{'$first':_0x3be5e6(0x143)},'maxProdPerUnit':{'$first':_0x3be5e6(0x12b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3be5e6(0xc8)},'gross_price':{'$first':_0x3be5e6(0xee)},'sales_category':{'$first':_0x3be5e6(0xdf)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x4c7388[_0x3be5e6(0x13f)]>0x0)_0x9cbae7=_0x4c7388;else _0x4db275['length']>0x0&&(_0x9cbae7=_0x4db275);_0xf0df99[_0x3be5e6(0x1db)](_0x9cbae7);}),router[a0_0xe45e51(0x141)](a0_0xe45e51(0xda),async(_0x5527d3,_0x5d92cf)=>{var _0x12d510=a0_0xe45e51;const {productCode:_0x23acf6,bay:_0x384ee6,warehouses:_0x7c0cb7,room:_0x38074a}=_0x5527d3['body'];console['log'](_0x5527d3[_0x12d510(0x104)]);try{const _0x2db73c=await warehouse[_0x12d510(0x10a)]([{'$match':{'name':_0x7c0cb7,'room':_0x38074a}},{'$unwind':_0x12d510(0x157)},{'$match':{'product_details.bay':parseInt(_0x384ee6)}},{'$group':{'_id':_0x12d510(0xcd),'name':{'$first':_0x12d510(0x1ef)},'product_stock':{'$first':_0x12d510(0x1ea)},'bay':{'$first':_0x12d510(0xd9)},'maxProducts':{'$first':_0x12d510(0x129)}}}]);_0x5d92cf['status'](0xc8)[_0x12d510(0x1db)](_0x2db73c);}catch(_0x46f3ac){_0x5d92cf['status'](0x194)['json']({'message':_0x46f3ac[_0x12d510(0xcc)]});}}),router['post']('/barcode_scanner_logs',async(_0x502129,_0x416e25)=>{var _0x26bc40=a0_0xe45e51;const {product_code:_0x412c7e}=_0x502129[_0x26bc40(0x104)];var _0x26f6d4;const _0x2cfada=await product['aggregate']([{'$match':{'primary_code':_0x412c7e,'type_products':_0x26bc40(0x1eb)}},{'$group':{'_id':_0x26bc40(0xf8),'name':{'$first':_0x26bc40(0x137)},'category':{'$first':_0x26bc40(0x120)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x26bc40(0x146)},'product_code':{'$first':_0x26bc40(0xaf)},'primary_code':{'$first':_0x26bc40(0x173)},'secondary_code':{'$first':_0x26bc40(0xc7)},'maxStocks':{'$first':_0x26bc40(0x143)},'maxProdPerUnit':{'$first':_0x26bc40(0x12b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x26bc40(0xc8)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x26bc40(0x1b3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x26bc40(0x1eb)](_0x2cfada);const _0x1a31a4=await product[_0x26bc40(0x10a)]([{'$match':{'secondary_code':_0x412c7e,'type_products':_0x26bc40(0x1eb)}},{'$group':{'_id':_0x26bc40(0xf8),'name':{'$first':_0x26bc40(0x137)},'category':{'$first':_0x26bc40(0x120)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x26bc40(0x146)},'product_code':{'$first':_0x26bc40(0xaf)},'primary_code':{'$first':_0x26bc40(0x173)},'secondary_code':{'$first':_0x26bc40(0xc7)},'maxStocks':{'$first':_0x26bc40(0x143)},'maxProdPerUnit':{'$first':_0x26bc40(0x12b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x26bc40(0xc8)},'gross_price':{'$first':_0x26bc40(0xee)},'sales_category':{'$first':_0x26bc40(0xdf)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x2cfada[_0x26bc40(0x13f)]>0x0)_0x26f6d4=_0x2cfada;else _0x1a31a4[_0x26bc40(0x13f)]>0x0&&(_0x26f6d4=_0x1a31a4);_0x416e25[_0x26bc40(0x1db)](_0x26f6d4);}),module[a0_0xe45e51(0xc2)]=router;