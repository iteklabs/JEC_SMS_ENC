var a0_0x12f677=a0_0x1c7c;function a0_0x3967(){var _0x1be78c=['$sales_category','product_data','sales_category','$product.type','length','uuid','<span\x20style=\x22float:\x20right;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','concat','German','error','suppliers','createTransport','purchase\x20data\x20add\x20successfully','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_details','express','toString','product_name','stock_quantity','ejs','to_room_name','$secondary_unit','gmail','currency','name','flash','log','valueOf','Enclosed','edit_purchases_finished','</span>','paid_amount','</head><body>','$unit','purchases_process','getMonth','$suppliers','$return_data','en-CA','warehouse_name','$category','Finished\x20Goods','id_transaction','</td>','Return\x20Goods','Spanish','purchase_invoice','prod_name','../public/language/languages.json','email','$_id','<h5>','/all_purchases/view','_id','1629912vHEiip','English','LOG-INC-','/incoming/add','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','params','/view','unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Arabic\x20(ae)','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Ambient','INC','$due_amount','maxPerUnit','<tbody\x20style=\x22text-align:\x20center;\x22>','message','$product_code','findById','getDate','date','/picking_list/pdf_puchases_fin_own_trf/','nodemailer','Distributing\x20','match','\x20</h2>','$product.room_name','$note','POnumber','/view/:id','$product.bin','Hindi','item_code','</h5>','staff','date_recieved','primary_code_hide','$product_details.secondary_code','due_amount','INCF-','RoomAssign','$invoice','/give_payment/:id','type_of_products_type','9iheUqI','10Znfiqb','maxperunit','string','True','$product_details.rack','$warehouse_name','maxProducts','stocks','invoice_init','path','INC-','\x20<>\x20','bin','$product.bay','secondary_unit','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$secondary_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.product_name','Portuguese','$product_details.floorlevel','product_code','logo','4891711jtmcqk','MaxStocks_data','<!DOCTYPE\x20html>','suppliers_docs','../models/all_models','Email\x20sent\x20successfully','primary_code','</tr>','currency_placement','Room_name','product_stock','render','Arabic','master','slice','status','return_purchase_finished','find','all_purchases_barcode','Rack\x202','secondary_code_hide','$maxProdPerUnit','Purchase\x20Mail','prod_unit','payment\x20successfull','type_of_products','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','to_bay','max_product_unit','$primary_code','prod_code','all_purchases_finished_logs','20TnjcwY','role','There\x20is\x20','to_recieved','<hr\x20class=\x22my-3\x22>','catch','DRY\x20GOODS','purchases\x20item\x20return\x20successfull','$date','prod_primunit','max','updateOne','product_date','Rack\x201','An\x20error\x20occurred\x20while\x20saving\x20data.','<div>','<h2>\x20','own','success','/all_purchases_finished/view','filter','return_qty','gross_price','true','$product_details.product_stock','Chinese','$product_details','get','then','French','abs','Paid\x20For\x20Purchase','isProcess','13dAacpD','site_title','standard_unit','back','Router','json','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','redirect','add_purchases_finished_logs','$product.quantity','</body></html>','padStart','image','errors','$suppliers_docs',',\x20room:\x20','/view/return_purchase/:id','7fDHwCR','</thead>','secondary_code','/view/add_purchases','2-digit','Purchase\x20Return','to_warehouse','to_quantity','exports','product_cat','$type_products','level','\x20units\x20to\x20warehouse:\x20','undefined','385481eoYTZS','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','return_product','$product_details.bin','floor','prod_cat','/all_purchases_finished/process/','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product','forEach','false','random','warehouse','$maxStocks','quantity','purchase\x20data\x20update\x20successfully','$product_details.bay','toLocaleDateString','An\x20error\x20occurred.','language','bay','$product.floorlevel','<strong>\x20Regards\x20</strong>','$alertquantity','purchases_id','$gross_price',',\x20bin:\x20','Logo.png','$room','1066HVzWmm','production_date','/../public','/view/add_purchases_logs','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Portuguese\x20(BR)','1212qGwsLh','\x20Order\x20Date\x20:\x20','prod_qty','util','add_purchases_finished','incoming_view','user','</table>','product_id','sales_data_cateory','password','404000ZMehDm','maxStocks','English\x20(US)','prod_level','room','save','expiry_date','<html><head><title></title>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.maxProducts','Asia/Manila','$product_details.product_code','/CheckingWarehouse','Error\x20Occurs','all','incoming_add','$brand','post','$batch_code','here2','$product_details.primary_code','map','/process/:id','1853384yibEdL','<tr>','224712tVYLpp','logs','Error\x20occurred\x20while\x20processing\x20product:','$expiry_date','room_name','findOne','batch_code','body','product_code_hide','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','prod_Qty','$product_details._id','/invoice/:id','aggregate','prod_secondunit',',\x20bay:\x20','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$name','purchase_quantity','sendMail','add_purchases\x20error','user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</tbody>','FGSEmail'];a0_0x3967=function(){return _0x1be78c;};return a0_0x3967();}(function(_0x2be499,_0xe2d12c){var _0x1e5232=a0_0x1c7c,_0x331d48=_0x2be499();while(!![]){try{var _0x328494=-parseInt(_0x1e5232(0x18c))/0x1+-parseInt(_0x1e5232(0x1ab))/0x2*(-parseInt(_0x1e5232(0x1b2))/0x3)+parseInt(_0x1e5232(0x1bd))/0x4*(parseInt(_0x1e5232(0x14c))/0x5)+-parseInt(_0x1e5232(0x22b))/0x6*(-parseInt(_0x1e5232(0x17e))/0x7)+parseInt(_0x1e5232(0x1d9))/0x8*(parseInt(_0x1e5232(0x258))/0x9)+-parseInt(_0x1e5232(0x259))/0xa*(parseInt(_0x1e5232(0x271))/0xb)+-parseInt(_0x1e5232(0x1db))/0xc*(parseInt(_0x1e5232(0x16d))/0xd);if(_0x328494===_0xe2d12c)break;else _0x331d48['push'](_0x331d48['shift']());}catch(_0x44f653){_0x331d48['push'](_0x331d48['shift']());}}}(a0_0x3967,0x42d55));const express=require(a0_0x12f677(0x204)),app=express(),router=express[a0_0x12f677(0x171)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x12f677(0x275)),auth=require('../middleware/auth'),nodemailer=require(a0_0x12f677(0x242));var ejs=require(a0_0x12f677(0x208));const path=require(a0_0x12f677(0x262)),users=require(a0_0x12f677(0x225)),{isNull}=require(a0_0x12f677(0x1b5));router[a0_0x12f677(0x167)]('/incoming',auth,async(_0x1c1e59,_0x5b11c0)=>{var _0x4ea4b0=a0_0x12f677;try{const {username:_0x5dfd40,email:_0x195a00,role:_0x10081b}=_0x1c1e59[_0x4ea4b0(0x1b8)],_0x50cf36=_0x1c1e59[_0x4ea4b0(0x1b8)],_0x1a2a99=await profile[_0x4ea4b0(0x1e0)]({'email':_0x50cf36[_0x4ea4b0(0x226)]}),_0x61dd8f=await staff[_0x4ea4b0(0x1e0)]({'email':_0x50cf36[_0x4ea4b0(0x226)]}),_0x514448=await master_shop[_0x4ea4b0(0x13d)]();let _0x57daf5=await transfers_finished[_0x4ea4b0(0x1e8)]([{'$match':{'to_warehouse':_0x61dd8f[_0x4ea4b0(0x19a)]}}]);if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x1bf))var _0x216e07=users[_0x4ea4b0(0x22c)];else{if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x24b))var _0x216e07=users['Hindi'];else{if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x1fd))var _0x216e07=users['German'];else{if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x222))var _0x216e07=users[_0x4ea4b0(0x222)];else{if(_0x514448[0x0]['language']==_0x4ea4b0(0x169))var _0x216e07=users[_0x4ea4b0(0x169)];else{if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x1b1))var _0x216e07=users[_0x4ea4b0(0x26d)];else{if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x165))var _0x216e07=users[_0x4ea4b0(0x165)];else{if(_0x514448[0x0][_0x4ea4b0(0x1a1)]==_0x4ea4b0(0x234))var _0x216e07=users[_0x4ea4b0(0x27d)];}}}}}}}_0x5b11c0[_0x4ea4b0(0x27c)](_0x4ea4b0(0x1b7),{'success':_0x1c1e59[_0x4ea4b0(0x20e)](_0x4ea4b0(0x15e)),'errors':_0x1c1e59[_0x4ea4b0(0x20e)](_0x4ea4b0(0x17a)),'purchases':_0x57daf5,'role':_0x50cf36,'profile':_0x1a2a99,'master_shop':_0x514448,'language':_0x216e07,'staff_data':_0x61dd8f});}catch(_0x3a70e4){console['log'](_0x4ea4b0(0x18d),_0x3a70e4),_0x5b11c0['status'](0xc8)[_0x4ea4b0(0x172)]({'message':_0x3a70e4[_0x4ea4b0(0x23c)]});}}),router['get']('/incoming/add',auth,async(_0x5cc6a4,_0x2f72a7)=>{var _0x46cdbe=a0_0x12f677;try{const {username:_0xc0aa74,email:_0x2809e2,role:_0x104bf0}=_0x5cc6a4[_0x46cdbe(0x1b8)],_0x10545d=_0x5cc6a4[_0x46cdbe(0x1b8)],_0x499e01=await profile['findOne']({'email':_0x10545d[_0x46cdbe(0x226)]}),_0x1e8a24=await staff[_0x46cdbe(0x1e0)]({'email':_0x10545d[_0x46cdbe(0x226)]}),_0x5ad1da=await master_shop['find']();let _0x537227=await transfers_finished[_0x46cdbe(0x1e8)]([{'$match':{'to_warehouse':_0x1e8a24[_0x46cdbe(0x19a)],'to_recieved':_0x46cdbe(0x198)}}]);if(_0x5ad1da[0x0]['language']==_0x46cdbe(0x1bf))var _0x236e70=users['English'];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]==_0x46cdbe(0x24b))var _0x236e70=users[_0x46cdbe(0x24b)];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]==_0x46cdbe(0x1fd))var _0x236e70=users[_0x46cdbe(0x1fd)];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]==_0x46cdbe(0x222))var _0x236e70=users[_0x46cdbe(0x222)];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]=='French')var _0x236e70=users[_0x46cdbe(0x169)];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]==_0x46cdbe(0x1b1))var _0x236e70=users[_0x46cdbe(0x26d)];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]==_0x46cdbe(0x165))var _0x236e70=users[_0x46cdbe(0x165)];else{if(_0x5ad1da[0x0][_0x46cdbe(0x1a1)]==_0x46cdbe(0x234))var _0x236e70=users[_0x46cdbe(0x27d)];}}}}}}}_0x2f72a7[_0x46cdbe(0x27c)](_0x46cdbe(0x1d1),{'success':_0x5cc6a4[_0x46cdbe(0x20e)]('success'),'errors':_0x5cc6a4[_0x46cdbe(0x20e)](_0x46cdbe(0x17a)),'purchases':_0x537227,'role':_0x10545d,'profile':_0x499e01,'master_shop':_0x5ad1da,'language':_0x236e70,'staff_data':_0x1e8a24});}catch(_0x5abc8a){console[_0x46cdbe(0x20f)](_0x46cdbe(0x18d),_0x5abc8a),_0x2f72a7[_0x46cdbe(0x280)](0xc8)[_0x46cdbe(0x172)]({'message':_0x5abc8a[_0x46cdbe(0x23c)]});}});const createLog=async _0x1276a1=>{var _0x5d1a26=a0_0x12f677;const _0xe8070f=new datalogs({'location':_0x1276a1});return await _0xe8070f[_0x5d1a26(0x1c2)](),_0xe8070f[_0x5d1a26(0x261)];};router[a0_0x12f677(0x1d3)](a0_0x12f677(0x22e),auth,async(_0x3f610a,_0x5737c0)=>{var _0x52275e=a0_0x12f677;try{const {invoice_trf_data:_0x213d7f,item_code:_0x2fc772,SCRN:_0x4588e1,ReqBy:_0x10c9c1,type_of_products:_0x497fd1,dateofreq:_0xcb1e4a,PO_number:_0x20eaf5,date:_0x550e2c,warehouse_name:_0xf5bbd9,typeservicesData:_0xb341ee,typevehicle:_0x39c8bf,driver:_0x4bcf00,plate:_0x3b521b,van:_0x5c52f,DRSI:_0x58d845,TSU:_0x3ffd19,TFU:_0xfbf355,note:_0x5ec69d}=_0x3f610a[_0x52275e(0x1e2)],_0x4a3ed4=await transfers_finished[_0x52275e(0x23e)](_0x213d7f);if(typeof _0x2fc772=='string')var _0x3112f6=[_0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x206)]],_0x476046=[_0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x24c)]],_0x33311a=[_0x3f610a['body']['to_quantity']],_0x33db4d=[_0x3f610a['body'][_0x52275e(0x232)]],_0x25f5c9=[_0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x1e9)]],_0x881227=[_0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x265)]],_0x57fea5=[_0x3f610a['body'][_0x52275e(0x277)]],_0x40edf4=[_0x3f610a[_0x52275e(0x1e2)]['secondary_code']],_0xcbd60c=[_0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x1e1)]],_0x456cbf=[_0x3f610a[_0x52275e(0x1e2)]['expiry_date']],_0x28a942=[_0x3f610a['body'][_0x52275e(0x1ac)]],_0x4d0960=[_0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x148)]],_0x5dc467=[_0x3f610a['body'][_0x52275e(0x1c1)]];else var _0x3112f6=[..._0x3f610a['body'][_0x52275e(0x206)]],_0x476046=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x24c)]],_0x33311a=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x185)]],_0x33db4d=[..._0x3f610a['body'][_0x52275e(0x232)]],_0x25f5c9=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x1e9)]],_0x881227=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x265)]],_0x57fea5=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x277)]],_0x40edf4=[..._0x3f610a['body'][_0x52275e(0x180)]],_0xcbd60c=[..._0x3f610a['body'][_0x52275e(0x1e1)]],_0x456cbf=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x1c3)]],_0x28a942=[..._0x3f610a[_0x52275e(0x1e2)][_0x52275e(0x1ac)]],_0x4d0960=[..._0x3f610a[_0x52275e(0x1e2)]['max_product_unit']],_0x5dc467=[..._0x3f610a[_0x52275e(0x1e2)]['room']];const _0x1022a7=_0x3112f6['map'](_0x43a956=>{return _0x43a956={'product_name':_0x43a956};});_0x476046[_0x52275e(0x197)]((_0x3e7e78,_0x4cdc5b)=>{var _0xaf2377=_0x52275e;_0x1022a7[_0x4cdc5b][_0xaf2377(0x26f)]=_0x3e7e78;}),_0x33311a[_0x52275e(0x197)]((_0x2c4939,_0x3c0a66)=>{var _0x4af2ed=_0x52275e;_0x1022a7[_0x3c0a66][_0x4af2ed(0x19c)]=Math[_0x4af2ed(0x16a)](_0x2c4939);}),_0x33db4d['forEach']((_0x41a3ba,_0x48e3d8)=>{var _0x496f4f=_0x52275e;_0x1022a7[_0x48e3d8][_0x496f4f(0x16f)]=_0x41a3ba;}),_0x25f5c9['forEach']((_0x110141,_0x20646a)=>{var _0x15c89c=_0x52275e;_0x1022a7[_0x20646a][_0x15c89c(0x267)]=_0x110141;}),_0x881227['forEach']((_0x11080c,_0x8f44cc)=>{var _0x8c0164=_0x52275e,_0x2721ec=_0x11080c[_0x8c0164(0x244)](/[A-Za-z]+/)[0x0],_0x465b3c=parseInt(_0x11080c[_0x8c0164(0x244)](/\d+/)[0x0]);_0x1022a7[_0x8f44cc][_0x8c0164(0x189)]=_0x2721ec,_0x1022a7[_0x8f44cc]['bay']=_0x465b3c;}),_0x57fea5['forEach']((_0x539e0e,_0x268d24)=>{var _0x351990=_0x52275e;_0x1022a7[_0x268d24][_0x351990(0x277)]=_0x539e0e;}),_0x40edf4[_0x52275e(0x197)]((_0x3d1bbb,_0x51f720)=>{_0x1022a7[_0x51f720]['secondary_code']=_0x3d1bbb;}),_0xcbd60c[_0x52275e(0x197)]((_0x4518fb,_0x5f3ed2)=>{var _0x286b13=_0x52275e;_0x1022a7[_0x5f3ed2][_0x286b13(0x1e1)]=_0x4518fb;}),_0x456cbf[_0x52275e(0x197)]((_0x436ac1,_0x174f44)=>{_0x1022a7[_0x174f44]['expiry_date']=_0x436ac1;}),_0x28a942[_0x52275e(0x197)]((_0x51da24,_0x2a592a)=>{var _0x4ceccc=_0x52275e;_0x1022a7[_0x2a592a][_0x4ceccc(0x1ac)]=_0x51da24;}),_0x4d0960[_0x52275e(0x197)]((_0x55d617,_0xee75b0)=>{var _0x2e8870=_0x52275e;_0x1022a7[_0xee75b0][_0x2e8870(0x25a)]=_0x55d617;}),_0x5dc467[_0x52275e(0x197)]((_0x56077b,_0x424253)=>{var _0x553f9e=_0x52275e;_0x1022a7[_0x424253][_0x553f9e(0x1df)]=_0x56077b;});const _0x1e609a=await createLog(_0x52275e(0x238));_0x5dc467['forEach']((_0x4ba057,_0x22c262)=>{var _0x404df8=_0x52275e;_0x1022a7[_0x22c262][_0x404df8(0x1c7)]='INC-'+_0x1e609a[_0x404df8(0x205)]()[_0x404df8(0x178)](0x8,'0');});const _0x13360d=_0x1022a7['filter'](_0x3b2dc7=>_0x3b2dc7[_0x52275e(0x19c)]!=='0'&&_0x3b2dc7[_0x52275e(0x19c)]!==''),_0x23e1bc=new purchases_incoming({'invoice':'INC-'+_0x1e609a['toString']()[_0x52275e(0x178)](0x8,'0'),'date':_0x550e2c,'warehouse_name':_0xf5bbd9,'product':_0x13360d,'note':_0x5ec69d,'POnumber':_0x20eaf5,'SCRN':_0x4588e1,'ReqBy':_0x10c9c1,'dateofreq':_0xcb1e4a,'typeservicesData':_0xb341ee,'van':_0x5c52f,'typevehicle':_0x39c8bf,'driver':_0x4bcf00,'plate':_0x3b521b,'DRSI':_0x58d845,'TSU':_0x3ffd19,'TFU':_0xfbf355,'typeOfProducts':_0x497fd1}),_0x3c2a3f=await _0x23e1bc[_0x52275e(0x1c2)](),_0xb8f088=_0x3c2a3f[_0x52275e(0x196)][_0x52275e(0x1d7)](async _0x586442=>{var _0x21019f=_0x52275e,_0x507e35=await warehouse[_0x21019f(0x1e0)]({'name':_0xf5bbd9,'room':_0x586442[_0x21019f(0x1df)]});if(_0x586442[_0x21019f(0x19c)]>0x0){var _0x32f5cd=0x0;const _0x2cb594=_0x507e35['product_details'][_0x21019f(0x1d7)](_0x4447fc=>{var _0x46d7c7=_0x21019f;_0x4447fc[_0x46d7c7(0x206)]==_0x586442[_0x46d7c7(0x206)]&&_0x4447fc[_0x46d7c7(0x1a2)]==_0x586442['to_bay']&&_0x4447fc[_0x46d7c7(0x1c3)]==_0x586442['expiry_date']&&_0x4447fc[_0x46d7c7(0x1ac)]==_0x586442[_0x46d7c7(0x1ac)]&&_0x4447fc[_0x46d7c7(0x1e1)]==_0x586442['batch_code']&&_0x4447fc['invoice']==_0x586442['invoice']&&(typeof _0x586442[_0x46d7c7(0x21f)]==_0x46d7c7(0x18b)?(console['log'](_0x46d7c7(0x1d5),_0x4447fc[_0x46d7c7(0x27b)]+_0x46d7c7(0x264)+_0x4447fc[_0x46d7c7(0x22a)]+'\x20<=>\x20'+Math[_0x46d7c7(0x16a)](_0x4447fc['product_stock'])+Math['abs'](_0x586442[_0x46d7c7(0x185)])),_0x4447fc[_0x46d7c7(0x27b)]=Math[_0x46d7c7(0x16a)](_0x4447fc[_0x46d7c7(0x27b)])+Math[_0x46d7c7(0x16a)](_0x586442[_0x46d7c7(0x19c)])):(_0x4447fc[_0x46d7c7(0x27b)]=Math[_0x46d7c7(0x16a)](_0x4447fc[_0x46d7c7(0x27b)])+Math[_0x46d7c7(0x16a)](_0x586442[_0x46d7c7(0x19c)]),_0x32f5cd++));});_0x32f5cd=='0'&&(_0x507e35[_0x21019f(0x203)]=_0x507e35['product_details'][_0x21019f(0x1fc)]({'product_name':_0x586442[_0x21019f(0x206)],'product_stock':_0x586442[_0x21019f(0x19c)],'bay':_0x586442[_0x21019f(0x1a2)],'level':_0x586442[_0x21019f(0x189)],'product_code':_0x586442[_0x21019f(0x26f)],'primary_code':_0x586442[_0x21019f(0x277)],'secondary_code':_0x586442[_0x21019f(0x180)],'expiry_date':_0x586442[_0x21019f(0x1c3)],'production_date':_0x586442['production_date'],'maxProducts':_0x586442[_0x21019f(0x25f)],'batch_code':_0x586442[_0x21019f(0x1e1)],'secondary_unit':_0x586442[_0x21019f(0x267)],'unit':_0x586442[_0x21019f(0x16f)],'maxProducts':_0x586442[_0x21019f(0x25f)],'maxPerUnit':_0x586442[_0x21019f(0x23a)],'invoice':_0x586442[_0x21019f(0x1c7)]}));}return _0x507e35;});Promise[_0x52275e(0x1d0)](_0xb8f088)[_0x52275e(0x168)](async _0x90889e=>{var _0x178faa=_0x52275e;try{for(const _0x544eb1 of _0x90889e){await warehouse[_0x178faa(0x157)]({'_id':_0x544eb1[_0x178faa(0x22a)]},{'$addToSet':{'product_details':{'$each':_0x544eb1['product_details']}}});}_0x4a3ed4[_0x178faa(0x14f)]=_0x178faa(0x163);const _0x1ec091=await _0x4a3ed4[_0x178faa(0x1c2)](),_0x59a465=await master_shop[_0x178faa(0x13d)](),_0xafa822=await email_settings[_0x178faa(0x1e0)](),_0x2992e0=await supervisor_settings['find']();var _0x1ab46a=_0x23e1bc[_0x178faa(0x196)],_0x1cb6d3='',_0x154379;for(_0x154379 in _0x1ab46a){var _0x480bac='FG';_0x23e1bc[_0x178faa(0x184)]==_0x178faa(0x152)&&(_0x480bac='DG'),_0x1cb6d3+=_0x178faa(0x1da)+_0x178faa(0x202)+_0x1ab46a[_0x154379][_0x178faa(0x206)]+_0x178faa(0x220)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1ab46a[_0x154379]['product_code']+_0x178faa(0x220)+_0x178faa(0x202)+_0x1ab46a[_0x154379]['to_quantity']+_0x178faa(0x220)+_0x178faa(0x202)+_0x1ab46a[_0x154379][_0x178faa(0x232)]+_0x178faa(0x220)+_0x178faa(0x202)+_0x1ab46a[_0x154379][_0x178faa(0x267)]+'</td>'+_0x178faa(0x202)+_0x23e1bc['to_warehouse']+'</td>'+_0x178faa(0x202)+_0x1ab46a[_0x154379][_0x178faa(0x209)]+_0x178faa(0x220)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x480bac+_0x1ab46a[_0x154379][_0x178faa(0x147)]+_0x178faa(0x220)+_0x178faa(0x278);}_0x3f610a[_0x178faa(0x20e)]('success','Transfer\x20Finalize\x20Successfully'),_0x5737c0[_0x178faa(0x174)](_0x178faa(0x241)+_0x3c2a3f[_0x178faa(0x22a)]);}catch(_0x59aaea){console[_0x178faa(0x1fe)](_0x59aaea),_0x5737c0[_0x178faa(0x280)](0x1f4)[_0x178faa(0x172)]({'error':_0x178faa(0x173)});}})[_0x52275e(0x151)](_0x245d45=>{var _0x14cb68=_0x52275e;console[_0x14cb68(0x1fe)](_0x245d45),_0x5737c0['status'](0x1f4)[_0x14cb68(0x172)]({'error':_0x14cb68(0x1a0)});});}catch(_0x403de4){}}),router[a0_0x12f677(0x1d3)]('/getTRF',auth,async(_0x2c8b8f,_0x363b28)=>{var _0x5d7a83=a0_0x12f677;try{const {warehouse:_0x4a2ece}=_0x2c8b8f[_0x5d7a83(0x1e2)],_0x53dc95=await transfers_finished['find']({'to_warehouse':_0x4a2ece,'to_recieved':'false'});_0x363b28['json'](_0x53dc95);}catch(_0xc6b789){}}),router[a0_0x12f677(0x1d3)]('/getinvoicetrf',auth,async(_0x72fa9c,_0x1802e1)=>{var _0xddb5b4=a0_0x12f677;try{const {invoice:_0x4826e8}=_0x72fa9c[_0xddb5b4(0x1e2)],_0x55880b=await transfers_finished['find']({'_id':_0x4826e8,'to_recieved':_0xddb5b4(0x198)});_0x1802e1[_0xddb5b4(0x172)](_0x55880b);}catch(_0x35402f){}}),router[a0_0x12f677(0x167)](a0_0x12f677(0x231),auth,async(_0x431707,_0x57596c)=>{var _0x503460=a0_0x12f677;try{const {username:_0x3eab79,email:_0x30c587,role:_0x18a265}=_0x431707[_0x503460(0x1b8)],_0x2d8abe=_0x431707[_0x503460(0x1b8)],_0x2c4395=await profile[_0x503460(0x1e0)]({'email':_0x2d8abe['email']}),_0x5e71ca=await staff[_0x503460(0x1e0)]({'email':_0x2d8abe[_0x503460(0x226)]});if(_0x2d8abe[_0x503460(0x14d)]==_0x503460(0x24e)){const _0x2f1155=await staff[_0x503460(0x1e0)]({'email':_0x2d8abe['email']});}const _0x3cfdc2=await master_shop['find']();let _0x10d9d8;if(_0x2d8abe['role']==_0x503460(0x24e)){const _0x422577=await staff[_0x503460(0x1e0)]({'email':_0x2d8abe[_0x503460(0x226)]});_0x10d9d8=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x422577[_0x503460(0x19a)],'typeOfProducts':_0x503460(0x15d)}},{'$lookup':{'from':_0x503460(0x1ff),'localField':_0x503460(0x1ff),'foreignField':_0x503460(0x20d),'as':_0x503460(0x274)}},{'$unwind':_0x503460(0x17b)},{'$unwind':_0x503460(0x1c6)},{'$group':{'_id':_0x503460(0x227),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x503460(0x219)},'date':{'$first':_0x503460(0x154)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x503460(0x1c6)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x503460(0x1af)},'due_amount':{'$first':_0x503460(0x239)},'return_data':{'$first':_0x503460(0x21a)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x503460(0x17b)},'total_product_quantity':{'$sum':_0x503460(0x176)},'level':{'$addToSet':_0x503460(0x266)},'isle':{'$addToSet':_0x503460(0x24a)},'type':{'$addToSet':_0x503460(0x1f7)},'floorlevel':{'$addToSet':_0x503460(0x1a3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x10d9d8=await purchases_finished[_0x503460(0x1e8)]([{'$match':{'typeOfProducts':_0x503460(0x15d)}},{'$unwind':_0x503460(0x1c6)},{'$group':{'_id':'$_id','invoice':{'$first':_0x503460(0x255)},'suppliers':{'$first':_0x503460(0x219)},'date':{'$first':_0x503460(0x154)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x503460(0x246)},'product':{'$push':'$product'},'note':{'$first':_0x503460(0x247)},'paid_amount':{'$first':_0x503460(0x1af)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x503460(0x21a)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x503460(0x17b)},'total_product_quantity':{'$sum':_0x503460(0x176)},'level':{'$addToSet':_0x503460(0x266)},'isle':{'$addToSet':_0x503460(0x24a)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x503460(0x1a3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3cfdc2[0x0][_0x503460(0x1a1)]==_0x503460(0x1bf))var _0x55ff3d=users[_0x503460(0x22c)];else{if(_0x3cfdc2[0x0]['language']==_0x503460(0x24b))var _0x55ff3d=users['Hindi'];else{if(_0x3cfdc2[0x0]['language']==_0x503460(0x1fd))var _0x55ff3d=users[_0x503460(0x1fd)];else{if(_0x3cfdc2[0x0][_0x503460(0x1a1)]==_0x503460(0x222))var _0x55ff3d=users['Spanish'];else{if(_0x3cfdc2[0x0]['language']==_0x503460(0x169))var _0x55ff3d=users[_0x503460(0x169)];else{if(_0x3cfdc2[0x0]['language']=='Portuguese\x20(BR)')var _0x55ff3d=users[_0x503460(0x26d)];else{if(_0x3cfdc2[0x0]['language']=='Chinese')var _0x55ff3d=users[_0x503460(0x165)];else{if(_0x3cfdc2[0x0][_0x503460(0x1a1)]==_0x503460(0x234))var _0x55ff3d=users[_0x503460(0x27d)];}}}}}}}_0x57596c[_0x503460(0x27c)]('all_purchases_finished',{'success':_0x431707[_0x503460(0x20e)](_0x503460(0x15e)),'errors':_0x431707['flash']('errors'),'purchases':_0x10d9d8,'role':_0x2d8abe,'profile':_0x2c4395,'master_shop':_0x3cfdc2,'language':_0x55ff3d});}catch(_0x410149){console[_0x503460(0x20f)](_0x503460(0x18d),_0x410149),_0x57596c[_0x503460(0x280)](0xc8)['json']({'message':_0x410149[_0x503460(0x23c)]});}}),router[a0_0x12f677(0x167)]('/view_log',auth,async(_0x1457fa,_0x41d7b7)=>{var _0x40125f=a0_0x12f677;try{const {username:_0x321ef5,email:_0x252cad,role:_0x47b33e}=_0x1457fa[_0x40125f(0x1b8)],_0x3f10fa=_0x1457fa[_0x40125f(0x1b8)],_0x1a77f6=await profile['findOne']({'email':_0x3f10fa[_0x40125f(0x226)]}),_0x52b2bf=await staff[_0x40125f(0x1e0)]({'email':_0x3f10fa[_0x40125f(0x226)]});if(_0x3f10fa[_0x40125f(0x14d)]=='staff'){const _0x2d71b2=await staff['findOne']({'email':_0x3f10fa[_0x40125f(0x226)]});}const _0xb7e2ac=await master_shop[_0x40125f(0x13d)]();let _0x969e4e;if(_0x3f10fa[_0x40125f(0x14d)]==_0x40125f(0x24e)){const _0x5d7265=await staff[_0x40125f(0x1e0)]({'email':_0x3f10fa[_0x40125f(0x226)]});_0x969e4e=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x5d7265[_0x40125f(0x19a)]}},{'$lookup':{'from':_0x40125f(0x1ff),'localField':_0x40125f(0x1ff),'foreignField':_0x40125f(0x20d),'as':_0x40125f(0x274)}},{'$unwind':_0x40125f(0x17b)},{'$unwind':_0x40125f(0x1c6)},{'$group':{'_id':_0x40125f(0x227),'invoice':{'$first':_0x40125f(0x255)},'suppliers':{'$first':_0x40125f(0x219)},'date':{'$first':_0x40125f(0x154)},'warehouse_name':{'$first':_0x40125f(0x25e)},'room':{'$first':_0x40125f(0x1aa)},'product':{'$push':_0x40125f(0x1c6)},'note':{'$first':_0x40125f(0x247)},'paid_amount':{'$first':_0x40125f(0x1af)},'due_amount':{'$first':_0x40125f(0x239)},'return_data':{'$first':_0x40125f(0x21a)},'batch_code':{'$first':_0x40125f(0x1d4)},'expiry_date':{'$first':_0x40125f(0x1de)},'suppliers_docs':{'$first':_0x40125f(0x17b)},'total_product_quantity':{'$sum':_0x40125f(0x176)},'level':{'$addToSet':_0x40125f(0x266)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x40125f(0x1f7)},'floorlevel':{'$addToSet':_0x40125f(0x1a3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x969e4e=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x40125f(0x1dc)}},{'$unwind':_0x40125f(0x1c6)},{'$group':{'_id':_0x40125f(0x227),'invoice':{'$first':_0x40125f(0x255)},'suppliers':{'$first':_0x40125f(0x219)},'date':{'$first':_0x40125f(0x154)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x40125f(0x246)},'product':{'$push':_0x40125f(0x1c6)},'note':{'$first':_0x40125f(0x247)},'paid_amount':{'$first':_0x40125f(0x1af)},'due_amount':{'$first':_0x40125f(0x239)},'return_data':{'$first':_0x40125f(0x21a)},'batch_code':{'$first':_0x40125f(0x1d4)},'expiry_date':{'$first':_0x40125f(0x1de)},'suppliers_docs':{'$first':_0x40125f(0x17b)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x40125f(0x266)},'isle':{'$addToSet':_0x40125f(0x24a)},'type':{'$addToSet':_0x40125f(0x1f7)},'floorlevel':{'$addToSet':_0x40125f(0x1a3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xb7e2ac[0x0][_0x40125f(0x1a1)]==_0x40125f(0x1bf))var _0x56c9dc=users[_0x40125f(0x22c)];else{if(_0xb7e2ac[0x0]['language']==_0x40125f(0x24b))var _0x56c9dc=users[_0x40125f(0x24b)];else{if(_0xb7e2ac[0x0][_0x40125f(0x1a1)]==_0x40125f(0x1fd))var _0x56c9dc=users[_0x40125f(0x1fd)];else{if(_0xb7e2ac[0x0]['language']==_0x40125f(0x222))var _0x56c9dc=users[_0x40125f(0x222)];else{if(_0xb7e2ac[0x0][_0x40125f(0x1a1)]==_0x40125f(0x169))var _0x56c9dc=users[_0x40125f(0x169)];else{if(_0xb7e2ac[0x0][_0x40125f(0x1a1)]==_0x40125f(0x1b1))var _0x56c9dc=users[_0x40125f(0x26d)];else{if(_0xb7e2ac[0x0][_0x40125f(0x1a1)]==_0x40125f(0x165))var _0x56c9dc=users[_0x40125f(0x165)];else{if(_0xb7e2ac[0x0]['language']==_0x40125f(0x234))var _0x56c9dc=users[_0x40125f(0x27d)];}}}}}}}_0x41d7b7['render'](_0x40125f(0x14b),{'success':_0x1457fa[_0x40125f(0x20e)](_0x40125f(0x15e)),'errors':_0x1457fa[_0x40125f(0x20e)](_0x40125f(0x17a)),'purchases':_0x969e4e,'role':_0x3f10fa,'profile':_0x1a77f6,'master_shop':_0xb7e2ac,'language':_0x56c9dc});}catch(_0x318f20){console[_0x40125f(0x20f)](_0x40125f(0x18d),_0x318f20),_0x41d7b7[_0x40125f(0x280)](0xc8)[_0x40125f(0x172)]({'message':_0x318f20[_0x40125f(0x23c)]});}});function a0_0x1c7c(_0x1f0ec5,_0x3e81a7){var _0x39671c=a0_0x3967();return a0_0x1c7c=function(_0x1c7cff,_0x57ed87){_0x1c7cff=_0x1c7cff-0x13d;var _0x298770=_0x39671c[_0x1c7cff];return _0x298770;},a0_0x1c7c(_0x1f0ec5,_0x3e81a7);}function BayBinSelected(_0x120491,_0x50864e){var _0x17b9e7=a0_0x12f677,_0x4b5d4f=[],_0x383e31=[];if(_0x120491==_0x17b9e7(0x152)){switch(_0x50864e){case _0x17b9e7(0x159):_0x4b5d4f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x17b9e7(0x13f):_0x4b5d4f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x383e31=['DG'];}else{if(_0x120491=='FROZEN\x20GOODS'){switch(_0x50864e){case'Rack\x201':_0x4b5d4f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x4b5d4f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x383e31=['FG'];}}return{'levels':_0x4b5d4f,'identify':_0x383e31};}async function getRandom8DigitNumber(){var _0x36ebf3=a0_0x12f677;const _0x405551=0x989680,_0x55c1ac=0x5f5e0ff,_0x76a6e8=Math[_0x36ebf3(0x191)](Math[_0x36ebf3(0x199)]()*(_0x55c1ac-_0x405551+0x1))+_0x405551;var _0x361848;const _0x15e94c=await purchases_finished[_0x36ebf3(0x1e0)]({'invoice':'INCF-'+_0x76a6e8});return _0x15e94c&&_0x15e94c[_0x36ebf3(0x1f8)]>0x0?_0x361848=_0x36ebf3(0x253)+_0x76a6e8:_0x361848='INCF-'+_0x76a6e8,_0x361848;}router[a0_0x12f677(0x167)]('/view/add_purchases',auth,async(_0xa89dfb,_0x1e8125)=>{var _0x280fa4=a0_0x12f677;try{const {username:_0x7d4d75,email:_0x4b1b62,role:_0xfdbef}=_0xa89dfb[_0x280fa4(0x1b8)],_0x361bc2=_0xa89dfb[_0x280fa4(0x1b8)],_0xfb84a1=await profile['findOne']({'email':_0x361bc2[_0x280fa4(0x226)]}),_0x2d55b7=await master_shop['find'](),_0x4f3b69=await staff[_0x280fa4(0x1e0)]({'email':_0x361bc2['email']}),_0xa2229b=await suppliers['find']({});let _0x366199;if(_0x361bc2['role']==_0x280fa4(0x24e)){const _0x57f38a=await staff[_0x280fa4(0x1e0)]({'email':_0x361bc2[_0x280fa4(0x226)]});_0x366199=await warehouse[_0x280fa4(0x1e8)]([{'$match':{'status':_0x280fa4(0x194),'name':_0x57f38a['warehouse']}},{'$group':{'_id':_0x280fa4(0x1ec),'name':{'$first':_0x280fa4(0x1ec)}}}]);}else _0x366199=await warehouse[_0x280fa4(0x1e8)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x280fa4(0x1ec)}}}]);const _0x2da7cc=await product[_0x280fa4(0x13d)]({}),_0x344d3e=await warehouse[_0x280fa4(0x13d)]({'status':_0x280fa4(0x194)}),_0xdb470f=await purchases_finished[_0x280fa4(0x13d)]({}),_0x47f212=_0xdb470f[_0x280fa4(0x1f8)]+0x1,_0x3ceedb=_0x280fa4(0x253)+_0x47f212['toString']()[_0x280fa4(0x178)](0x5,'0');var _0x2d0698=[_0x280fa4(0x237),_0x280fa4(0x211)];if(_0x2d55b7[0x0][_0x280fa4(0x1a1)]=='English\x20(US)')var _0x38b79e=users[_0x280fa4(0x22c)];else{if(_0x2d55b7[0x0]['language']==_0x280fa4(0x24b))var _0x38b79e=users[_0x280fa4(0x24b)];else{if(_0x2d55b7[0x0][_0x280fa4(0x1a1)]==_0x280fa4(0x1fd))var _0x38b79e=users['German'];else{if(_0x2d55b7[0x0][_0x280fa4(0x1a1)]==_0x280fa4(0x222))var _0x38b79e=users[_0x280fa4(0x222)];else{if(_0x2d55b7[0x0][_0x280fa4(0x1a1)]==_0x280fa4(0x169))var _0x38b79e=users[_0x280fa4(0x169)];else{if(_0x2d55b7[0x0][_0x280fa4(0x1a1)]=='Portuguese\x20(BR)')var _0x38b79e=users[_0x280fa4(0x26d)];else{if(_0x2d55b7[0x0]['language']==_0x280fa4(0x165))var _0x38b79e=users[_0x280fa4(0x165)];else{if(_0x2d55b7[0x0][_0x280fa4(0x1a1)]==_0x280fa4(0x234))var _0x38b79e=users[_0x280fa4(0x27d)];}}}}}}}const _0x214880=getRandom8DigitNumber(),_0x120327=new Date(),_0x1ef1f2={'year':'numeric','month':_0x280fa4(0x182),'day':'2-digit','timeZone':_0x280fa4(0x1cc)},_0x48c6b6=_0x120327[_0x280fa4(0x19f)](_0x280fa4(0x21b),_0x1ef1f2);console['log'](_0x48c6b6),_0x214880['then'](_0x939d40=>{var _0x579266=_0x280fa4;_0x1e8125[_0x579266(0x27c)](_0x579266(0x1b6),{'success':_0xa89dfb[_0x579266(0x20e)](_0x579266(0x15e)),'errors':_0xa89dfb[_0x579266(0x20e)]('errors'),'role':_0x361bc2,'profile':_0xfb84a1,'suppliers':_0xa2229b,'warehouse':_0x366199,'product':_0x2da7cc,'invoice':_0x939d40,'master_shop':_0x2d55b7,'language':_0x38b79e,'find_data':_0x344d3e,'rooms_data':_0x2d0698,'formattedDate':_0x48c6b6});})[_0x280fa4(0x151)](_0x2c008c=>{var _0x38565a=_0x280fa4;_0xa89dfb[_0x38565a(0x20e)](_0x38565a(0x17a),_0x38565a(0x1fb)),_0x1e8125[_0x38565a(0x174)]('/all_purchases_finished/view');});}catch(_0x16f5dd){console[_0x280fa4(0x20f)](_0x16f5dd);}}),router[a0_0x12f677(0x167)](a0_0x12f677(0x1ae),auth,async(_0x522dd7,_0x497571)=>{var _0x5db056=a0_0x12f677;try{const {username:_0x1fdd50,email:_0x304ec5,role:_0x3ae4e0}=_0x522dd7[_0x5db056(0x1b8)],_0x5dc6f8=_0x522dd7[_0x5db056(0x1b8)],_0x5a0528=await profile[_0x5db056(0x1e0)]({'email':_0x5dc6f8['email']}),_0x2d838b=await master_shop[_0x5db056(0x13d)](),_0x42c557=await staff[_0x5db056(0x1e0)]({'email':_0x5dc6f8[_0x5db056(0x226)]}),_0x306212=await suppliers[_0x5db056(0x13d)]({});let _0x2c2c13;if(_0x5dc6f8[_0x5db056(0x14d)]==_0x5db056(0x24e)){const _0x1b6fb4=await staff[_0x5db056(0x1e0)]({'email':_0x5dc6f8[_0x5db056(0x226)]});_0x2c2c13=await warehouse[_0x5db056(0x1e8)]([{'$match':{'status':_0x5db056(0x194),'name':_0x1b6fb4[_0x5db056(0x19a)]}},{'$group':{'_id':_0x5db056(0x1ec),'name':{'$first':_0x5db056(0x1ec)}}}]);}else _0x2c2c13=await warehouse[_0x5db056(0x1e8)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x5db056(0x1ec),'name':{'$first':_0x5db056(0x1ec)}}}]);const _0x4ff4ff=await product['find']({}),_0x2ef2bc=await warehouse[_0x5db056(0x13d)]({'status':_0x5db056(0x194)}),_0xcbc6bd=await purchases_finished['find']({}),_0x16d7b7=_0xcbc6bd[_0x5db056(0x1f8)]+0x1,_0x307b7e=_0x5db056(0x253)+_0x16d7b7['toString']()[_0x5db056(0x178)](0x5,'0');var _0x56305e=['Ambient',_0x5db056(0x211)];if(_0x2d838b[0x0][_0x5db056(0x1a1)]==_0x5db056(0x1bf))var _0x13be0d=users[_0x5db056(0x22c)];else{if(_0x2d838b[0x0][_0x5db056(0x1a1)]=='Hindi')var _0x13be0d=users[_0x5db056(0x24b)];else{if(_0x2d838b[0x0][_0x5db056(0x1a1)]==_0x5db056(0x1fd))var _0x13be0d=users[_0x5db056(0x1fd)];else{if(_0x2d838b[0x0][_0x5db056(0x1a1)]=='Spanish')var _0x13be0d=users[_0x5db056(0x222)];else{if(_0x2d838b[0x0][_0x5db056(0x1a1)]=='French')var _0x13be0d=users[_0x5db056(0x169)];else{if(_0x2d838b[0x0][_0x5db056(0x1a1)]==_0x5db056(0x1b1))var _0x13be0d=users[_0x5db056(0x26d)];else{if(_0x2d838b[0x0][_0x5db056(0x1a1)]==_0x5db056(0x165))var _0x13be0d=users[_0x5db056(0x165)];else{if(_0x2d838b[0x0]['language']==_0x5db056(0x234))var _0x13be0d=users[_0x5db056(0x27d)];}}}}}}}const _0x279c1a=getRandom8DigitNumber();_0x279c1a['then'](_0x45108d=>{var _0x27fcf8=_0x5db056;_0x497571[_0x27fcf8(0x27c)](_0x27fcf8(0x175),{'success':_0x522dd7[_0x27fcf8(0x20e)](_0x27fcf8(0x15e)),'errors':_0x522dd7[_0x27fcf8(0x20e)](_0x27fcf8(0x17a)),'role':_0x5dc6f8,'profile':_0x5a0528,'suppliers':_0x306212,'warehouse':_0x2c2c13,'product':_0x4ff4ff,'invoice':_0x45108d,'master_shop':_0x2d838b,'language':_0x13be0d,'find_data':_0x2ef2bc,'rooms_data':_0x56305e});})['catch'](_0x4bcf86=>{var _0x37e764=_0x5db056;_0x522dd7[_0x37e764(0x20e)](_0x37e764(0x17a),_0x37e764(0x1fb)),_0x497571[_0x37e764(0x174)]('/all_purchases_finished/view');});}catch(_0x265c1f){console[_0x5db056(0x20f)](_0x265c1f);}}),router[a0_0x12f677(0x167)]('/view/add_purchases/:id',auth,async(_0x48dcdb,_0x5598e2)=>{var _0x52dafb=a0_0x12f677;try{const _0x42fd59=_0x48dcdb[_0x52dafb(0x230)]['id'];console['log'](_0x42fd59);const _0x90ee96=await master_shop[_0x52dafb(0x13d)]();console['log'](_0x52dafb(0x27e),_0x90ee96);const _0x4de45d=await product[_0x52dafb(0x1e0)]({'name':_0x42fd59});console[_0x52dafb(0x20f)](_0x52dafb(0x196),_0x4de45d),_0x5598e2['status'](0xc8)[_0x52dafb(0x172)]({'product_data':_0x4de45d,'master':_0x90ee96});}catch(_0x1eb08b){console[_0x52dafb(0x20f)](_0x52dafb(0x1ef),_0x1eb08b);}}),router['post'](a0_0x12f677(0x181),auth,async(_0x3959a5,_0x12b6c1)=>{var _0x51c69d=a0_0x12f677;try{const {invoice:_0x4faa3a,date:_0x9a6842,warehouse_name:_0x22b5f3,prod_name:_0x3807db,note:_0x2a2416,due_amount:_0xce75c1,Room_name:_0x4728e9,PO_number:_0x34b1fe,SCRN:_0x550b02,ReqBy:_0x40475c,dateofreq:_0x1c8b71,suppliers:_0x120fe4,typeservicesData:_0x194c1c,van:_0x9af867,typevehicle:_0x5b7732,driver:_0x4ff709,plate:_0x271ccf,DRSI:_0x20d4be,TSU:_0x2d7989,TFU:_0x5b4f51,JO_number:_0x445cf4,type_of_products:_0x31b853}=_0x3959a5[_0x51c69d(0x1e2)];if(typeof _0x3807db==_0x51c69d(0x25b))var _0x5d7239=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x224)]],_0x1acdbb=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x14a)]],_0x39fa3e=[_0x3959a5[_0x51c69d(0x1e2)]['prod_Qty']],_0x38f638=[_0x3959a5['body'][_0x51c69d(0x155)]],_0x3fb9c2=[_0x3959a5['body'][_0x51c69d(0x1e9)]],_0x2bd276=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1c0)]],_0xa413c6=[_0x3959a5['body'][_0x51c69d(0x277)]],_0x20da51=[_0x3959a5['body']['secondary_code']],_0x5b3329=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x272)]],_0x14e214=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1e1)]],_0x1a7467=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1c3)]],_0x349351=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x158)]],_0x4ee090=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x148)]],_0x1e4eb3=[_0x3959a5['body']['prod_cat']],_0x435e8c=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x254)]],_0x4a8762=[_0x3959a5[_0x51c69d(0x1e2)]['gross_price']],_0x296741=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1f9)]],_0x409588=[_0x3959a5['body'][_0x51c69d(0x1bb)]],_0x35fd4d=[_0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1ba)]];else var _0x5d7239=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x224)]],_0x1acdbb=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x14a)]],_0x39fa3e=[..._0x3959a5['body'][_0x51c69d(0x1e5)]],_0x38f638=[..._0x3959a5[_0x51c69d(0x1e2)]['prod_primunit']],_0x3fb9c2=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1e9)]],_0x2bd276=[..._0x3959a5['body'][_0x51c69d(0x1c0)]],_0xa413c6=[..._0x3959a5[_0x51c69d(0x1e2)]['primary_code']],_0x20da51=[..._0x3959a5[_0x51c69d(0x1e2)]['secondary_code']],_0x5b3329=[..._0x3959a5['body'][_0x51c69d(0x272)]],_0x14e214=[..._0x3959a5['body'][_0x51c69d(0x1e1)]],_0x1a7467=[..._0x3959a5['body'][_0x51c69d(0x1c3)]],_0x349351=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x158)]],_0x4ee090=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x148)]],_0x1e4eb3=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x192)]],_0x435e8c=[..._0x3959a5['body'][_0x51c69d(0x254)]],_0x4a8762=[..._0x3959a5['body']['gross_price']],_0x296741=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1f9)]],_0x409588=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1bb)]],_0x35fd4d=[..._0x3959a5[_0x51c69d(0x1e2)][_0x51c69d(0x1ba)]];const _0x373464=_0x5d7239['map'](_0x429fe6=>{return _0x429fe6={'product_name':_0x429fe6};});_0x35fd4d['forEach']((_0x271c8a,_0x53e108)=>{var _0x11d368=_0x51c69d;_0x373464[_0x53e108]['product_id']=_0x271c8a,_0x373464[_0x53e108][_0x11d368(0x24f)]=_0x9a6842;}),_0x409588['forEach']((_0xe684f8,_0x186593)=>{var _0x257824=_0x51c69d;_0x373464[_0x186593][_0x257824(0x1f6)]=_0xe684f8;}),_0x1acdbb['forEach']((_0x3f00e1,_0x4dc212)=>{var _0x1cf0a7=_0x51c69d;_0x373464[_0x4dc212][_0x1cf0a7(0x26f)]=_0x3f00e1;}),_0x296741[_0x51c69d(0x197)]((_0x4092f1,_0x47ec5f)=>{_0x373464[_0x47ec5f]['uuid']=_0x4092f1;}),_0x39fa3e[_0x51c69d(0x197)]((_0x3fe2ab,_0x3fe5d9)=>{var _0x2f52a6=_0x51c69d;_0x373464[_0x3fe5d9]['quantity']=Math[_0x2f52a6(0x16a)](_0x3fe2ab);}),_0x38f638[_0x51c69d(0x197)]((_0x904c5d,_0x8f5279)=>{var _0x5cbf6b=_0x51c69d;_0x373464[_0x8f5279][_0x5cbf6b(0x16f)]=_0x904c5d;}),_0x3fb9c2[_0x51c69d(0x197)]((_0x30bd45,_0x29c892)=>{var _0x44888e=_0x51c69d;_0x373464[_0x29c892][_0x44888e(0x267)]=_0x30bd45;}),_0xa413c6[_0x51c69d(0x197)]((_0xc5af60,_0x1f0e5c)=>{var _0x5bb029=_0x51c69d;_0x373464[_0x1f0e5c][_0x5bb029(0x277)]=_0xc5af60;}),_0x20da51[_0x51c69d(0x197)]((_0x150aba,_0x166718)=>{var _0x4847cb=_0x51c69d;_0x373464[_0x166718][_0x4847cb(0x180)]=_0x150aba;}),_0x5b3329[_0x51c69d(0x197)]((_0x920e10,_0x3ca752)=>{var _0x58e696=_0x51c69d;_0x373464[_0x3ca752][_0x58e696(0x1be)]=_0x920e10;}),_0x14e214[_0x51c69d(0x197)]((_0x576793,_0x5caed3)=>{_0x373464[_0x5caed3]['batch_code']=_0x576793;}),_0x1a7467[_0x51c69d(0x197)]((_0x274603,_0x351f48)=>{var _0x317ebd=_0x51c69d;_0x373464[_0x351f48][_0x317ebd(0x1c3)]=_0x274603;}),_0x349351[_0x51c69d(0x197)]((_0x4e009f,_0x1b6dd3)=>{_0x373464[_0x1b6dd3]['production_date']=_0x4e009f;}),_0x4ee090['forEach']((_0x4b2750,_0x19e242)=>{var _0x49a312=_0x51c69d;_0x373464[_0x19e242][_0x49a312(0x25a)]=_0x4b2750;}),_0x1e4eb3[_0x51c69d(0x197)]((_0x11bbd7,_0x829957)=>{_0x373464[_0x829957]['product_cat']=_0x11bbd7;}),_0x435e8c[_0x51c69d(0x197)]((_0x744ca7,_0x207f67)=>{var _0x5e61a2=_0x51c69d;_0x373464[_0x207f67][_0x5e61a2(0x1df)]=_0x744ca7;}),_0x4a8762[_0x51c69d(0x197)]((_0xc8e92a,_0x4c96d3)=>{var _0x2d736f=_0x51c69d;_0x373464[_0x4c96d3][_0x2d736f(0x162)]=_0xc8e92a;});const _0x5ab90a=new invoice_for_incoming();await _0x5ab90a[_0x51c69d(0x1c2)]();for(let _0x2f4f66=0x0;_0x2f4f66<=_0x435e8c[_0x51c69d(0x1f8)]-0x1;_0x2f4f66++){_0x373464[_0x2f4f66][_0x51c69d(0x1c7)]=_0x51c69d(0x263)+_0x5ab90a[_0x51c69d(0x261)][_0x51c69d(0x205)]()[_0x51c69d(0x178)](0x8,'0');}const _0x4c92b5=await warehouse_validation_setup[_0x51c69d(0x1e8)]([{'$match':{'warehouse_name':_0x22b5f3}}]);let _0x9fb4e7=[];for(let _0x3e5a27=0x0;_0x3e5a27<=_0x373464['length']-0x1;_0x3e5a27++){const _0x58d996=_0x373464[_0x3e5a27];for(let _0x83330e=0x0;_0x83330e<=_0x4c92b5['length']-0x1;_0x83330e++){const _0x11801a=_0x4c92b5[_0x83330e];for(let _0x3749d2=0x0;_0x3749d2<=_0x11801a['product_data']['length']-0x1;_0x3749d2++){const _0x5a0c35=_0x11801a['product_data'][_0x3749d2];if(_0x5a0c35[_0x51c69d(0x26f)]===_0x58d996['product_code']){let _0x356528=_0x58d996[_0x51c69d(0x19c)];const _0x4f7ea9=await warehouse[_0x51c69d(0x1e8)]([{'$match':{'name':_0x22b5f3,'room':_0x11801a[_0x51c69d(0x1c1)]}},{'$unwind':_0x51c69d(0x166)},{'$match':{'level':_0x5a0c35[_0x51c69d(0x1a2)],'bay':_0x5a0c35['bin']}}]);if(_0x4f7ea9[_0x51c69d(0x1f8)]==0x0){for(let _0x4d7686=0x0;_0x4d7686<=_0x11801a['product_data']['length']-0x1&&_0x356528>0x0;_0x4d7686++){const _0x3af5e1=_0x11801a[_0x51c69d(0x1f5)][_0x4d7686];if(_0x58d996[_0x51c69d(0x26f)]===_0x3af5e1[_0x51c69d(0x26f)]){_0x9fb4e7[_0x4d7686]={};const _0x4b5705=parseInt(_0x3af5e1[_0x51c69d(0x156)]),_0x256635=0x0;let _0x5bd63f=_0x4b5705-_0x256635,_0x54bc64=Math['min'](_0x356528,_0x5bd63f);console[_0x51c69d(0x20f)](_0x51c69d(0x243)+_0x54bc64+_0x51c69d(0x18a)+_0x11801a[_0x51c69d(0x21c)]+_0x51c69d(0x17c)+_0x11801a[_0x51c69d(0x1c1)]+_0x51c69d(0x1ea)+_0x3af5e1[_0x51c69d(0x1a2)]+_0x51c69d(0x1a8)+_0x3af5e1['bin']),_0x9fb4e7[_0x4d7686][_0x51c69d(0x206)]=_0x58d996[_0x51c69d(0x206)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x26f)]=_0x58d996[_0x51c69d(0x26f)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1ba)]=_0x58d996[_0x51c69d(0x1ba)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x24f)]=_0x58d996[_0x51c69d(0x24f)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1f6)]=_0x58d996[_0x51c69d(0x1f6)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1f9)]=_0x58d996[_0x51c69d(0x1f9)],_0x9fb4e7[_0x4d7686]['quantity']=_0x54bc64,_0x9fb4e7[_0x4d7686][_0x51c69d(0x16f)]=_0x58d996[_0x51c69d(0x16f)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x267)]=_0x58d996[_0x51c69d(0x267)],_0x9fb4e7[_0x4d7686]['primary_code']=_0x58d996[_0x51c69d(0x277)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x180)]=_0x58d996['secondary_code'],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1be)]=_0x58d996[_0x51c69d(0x1be)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1e1)]=_0x58d996[_0x51c69d(0x1e1)],_0x9fb4e7[_0x4d7686]['expiry_date']=_0x58d996[_0x51c69d(0x1c3)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1ac)]=_0x58d996[_0x51c69d(0x1ac)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x25a)]=_0x58d996[_0x51c69d(0x25a)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x187)]=_0x58d996['product_cat'],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1c7)]=_0x58d996['invoice'],_0x9fb4e7[_0x4d7686][_0x51c69d(0x162)]=_0x58d996[_0x51c69d(0x162)],_0x9fb4e7[_0x4d7686][_0x51c69d(0x1df)]=_0x11801a['room'],_0x9fb4e7[_0x4d7686][_0x51c69d(0x189)]=_0x3af5e1[_0x51c69d(0x1a2)],_0x9fb4e7[_0x4d7686]['bay']=_0x3af5e1[_0x51c69d(0x265)],_0x356528-=_0x54bc64;if(_0x356528<=0x0)break;}}if(_0x356528<=0x0)break;_0x356528>0x0&&console['log'](_0x51c69d(0x14e)+_0x356528+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');}}}}}const _0x6ade0c=_0x9fb4e7['filter']((_0x3aa011,_0x364cd5)=>{if(_0x364cd5>0x0)return{'item':_0x3aa011};}),_0x335afc=_0x6ade0c['filter'](_0x235e20=>_0x235e20[_0x51c69d(0x19c)]!=='0'&&_0x235e20['quantity']!==''),_0x21a79f=new purchases_finished({'invoice':'INC-'+_0x5ab90a[_0x51c69d(0x261)][_0x51c69d(0x205)]()[_0x51c69d(0x178)](0x8,'0'),'suppliers':_0x120fe4,'date':_0x9a6842,'warehouse_name':_0x22b5f3,'product':_0x335afc,'note':_0x2a2416,'due_amount':_0xce75c1,'room':_0x4728e9,'POnumber':_0x34b1fe,'SCRN':_0x550b02,'JO_number':_0x445cf4,'ReqBy':_0x40475c,'dateofreq':_0x1c8b71,'typeservicesData':_0x194c1c,'van':_0x9af867,'typevehicle':_0x5b7732,'driver':_0x4ff709,'plate':_0x271ccf,'DRSI':_0x20d4be,'TSU':_0x2d7989,'TFU':_0x5b4f51,'typeOfProducts':_0x31b853}),_0x4d0bcb=await _0x21a79f['save'](),_0x567ed2=await purchases_finished[_0x51c69d(0x1e0)]({'_id':_0x4d0bcb['_id'][_0x51c69d(0x210)]()});_0x3959a5[_0x51c69d(0x20e)](_0x51c69d(0x15e),_0x51c69d(0x201)),_0x12b6c1[_0x51c69d(0x174)]('/all_purchases_finished/process/'+_0x567ed2[_0x51c69d(0x22a)][_0x51c69d(0x210)]());}catch(_0xe086f4){console[_0x51c69d(0x20f)](_0xe086f4);}}),router['get']('/process/:id',auth,async(_0x5af7b6,_0x3f94de)=>{var _0x5c765e=a0_0x12f677;try{const {username:_0x30c56b,email:_0x102663,role:_0x27d016}=_0x5af7b6[_0x5c765e(0x1b8)],_0x2cd510=_0x5af7b6[_0x5c765e(0x1b8)],_0x5a504f=_0x5af7b6[_0x5c765e(0x230)]['id'],_0x346138=await profile[_0x5c765e(0x1e0)]({'email':_0x2cd510[_0x5c765e(0x226)]}),_0x3ae637=await master_shop[_0x5c765e(0x13d)](),_0x4b6c4b=await staff[_0x5c765e(0x1e0)]({'email':_0x2cd510[_0x5c765e(0x226)]}),_0xc549e9=await suppliers[_0x5c765e(0x13d)]({});let _0x5b24d7;if(_0x2cd510[_0x5c765e(0x14d)]=='staff'){const _0x2fc0d1=await staff['findOne']({'email':_0x2cd510[_0x5c765e(0x226)]});_0x5b24d7=await warehouse[_0x5c765e(0x1e8)]([{'$match':{'status':_0x5c765e(0x194),'name':_0x2fc0d1[_0x5c765e(0x19a)]}},{'$group':{'_id':_0x5c765e(0x1ec),'name':{'$first':_0x5c765e(0x1ec)}}}]);}else _0x5b24d7=await warehouse[_0x5c765e(0x1e8)]([{'$match':{'status':_0x5c765e(0x194)}},{'$group':{'_id':_0x5c765e(0x1ec),'name':{'$first':_0x5c765e(0x1ec)}}}]);const _0x112cbc=await purchases_finished[_0x5c765e(0x23e)](_0x5a504f);if(_0x3ae637[0x0]['language']==_0x5c765e(0x1bf))var _0x1da145=users['English'];else{if(_0x3ae637[0x0]['language']==_0x5c765e(0x24b))var _0x1da145=users['Hindi'];else{if(_0x3ae637[0x0]['language']==_0x5c765e(0x1fd))var _0x1da145=users['German'];else{if(_0x3ae637[0x0][_0x5c765e(0x1a1)]==_0x5c765e(0x222))var _0x1da145=users[_0x5c765e(0x222)];else{if(_0x3ae637[0x0][_0x5c765e(0x1a1)]==_0x5c765e(0x169))var _0x1da145=users[_0x5c765e(0x169)];else{if(_0x3ae637[0x0]['language']==_0x5c765e(0x1b1))var _0x1da145=users[_0x5c765e(0x26d)];else{if(_0x3ae637[0x0][_0x5c765e(0x1a1)]=='Chinese')var _0x1da145=users[_0x5c765e(0x165)];else{if(_0x3ae637[0x0][_0x5c765e(0x1a1)]==_0x5c765e(0x234))var _0x1da145=users['Arabic'];}}}}}}}_0x3f94de[_0x5c765e(0x27c)](_0x5c765e(0x217),{'success':_0x5af7b6[_0x5c765e(0x20e)](_0x5c765e(0x15e)),'errors':_0x5af7b6[_0x5c765e(0x20e)](_0x5c765e(0x17a)),'role':_0x2cd510,'profile':_0x346138,'suppliers':_0xc549e9,'warehouse':_0x5b24d7,'master_shop':_0x3ae637,'language':_0x1da145,'purchases_data':_0x112cbc});}catch(_0x1cafcf){console[_0x5c765e(0x20f)](_0x1cafcf);}});async function get_warehouse_data(_0x590948,_0x23e9a2){var _0x1cf70e=a0_0x12f677;try{const _0x452260=await warehouse_temporary[_0x1cf70e(0x1e0)]({'name':_0x590948,'room':_0x23e9a2});if(!_0x452260){const _0x28cdce=new warehouse_temporary({'name':_0x590948,'address':_0x590948,'status':'Enabled','room':_0x23e9a2,'isStaging':_0x1cf70e(0x198)});return await _0x28cdce[_0x1cf70e(0x1c2)](),_0x28cdce;}else return _0x452260;}catch(_0x396955){console[_0x1cf70e(0x1fe)](_0x1cf70e(0x22f),_0x396955);throw _0x396955;}}router[a0_0x12f677(0x1d3)](a0_0x12f677(0x1d8),auth,async(_0x5e8e84,_0x5d0f25)=>{var _0x49fed3=a0_0x12f677;try{const _0x21da12=_0x5e8e84['params']['id'],_0x17f2ea=await purchases_finished[_0x49fed3(0x23e)](_0x21da12);let _0x54d884=[];_0x17f2ea[_0x49fed3(0x196)][_0x49fed3(0x197)]((_0x340d6b,_0x1680bb)=>{var _0x36ede4=_0x49fed3;_0x54d884[_0x1680bb]={},_0x54d884[_0x1680bb]['warehouse']=_0x17f2ea[_0x36ede4(0x21c)],_0x54d884[_0x1680bb]['product_id']=_0x340d6b[_0x36ede4(0x1ba)],_0x54d884[_0x1680bb][_0x36ede4(0x206)]=_0x340d6b['product_name'],_0x54d884[_0x1680bb]['product_code']=_0x340d6b['product_code'],_0x54d884[_0x1680bb]['quantity']=_0x340d6b[_0x36ede4(0x19c)],_0x54d884[_0x1680bb][_0x36ede4(0x16f)]=_0x340d6b[_0x36ede4(0x16f)],_0x54d884[_0x1680bb][_0x36ede4(0x267)]=_0x340d6b['secondary_unit'],_0x54d884[_0x1680bb][_0x36ede4(0x189)]=_0x340d6b[_0x36ede4(0x189)],_0x54d884[_0x1680bb]['bay']=_0x340d6b[_0x36ede4(0x1a2)],_0x54d884[_0x1680bb][_0x36ede4(0x277)]=_0x340d6b[_0x36ede4(0x277)],_0x54d884[_0x1680bb]['secondary_code']=_0x340d6b[_0x36ede4(0x180)],_0x54d884[_0x1680bb][_0x36ede4(0x1be)]=_0x340d6b[_0x36ede4(0x1be)],_0x54d884[_0x1680bb][_0x36ede4(0x1e1)]=_0x340d6b[_0x36ede4(0x1e1)],_0x54d884[_0x1680bb][_0x36ede4(0x1c3)]=_0x340d6b[_0x36ede4(0x1c3)],_0x54d884[_0x1680bb][_0x36ede4(0x1ac)]=_0x340d6b[_0x36ede4(0x1ac)],_0x54d884[_0x1680bb][_0x36ede4(0x25a)]=_0x340d6b['maxperunit'],_0x54d884[_0x1680bb][_0x36ede4(0x187)]=_0x340d6b['product_cat'],_0x54d884[_0x1680bb][_0x36ede4(0x1df)]=_0x340d6b[_0x36ede4(0x1df)],_0x54d884[_0x1680bb][_0x36ede4(0x1c7)]=_0x340d6b['invoice'],_0x54d884[_0x1680bb]['uuid']=_0x340d6b[_0x36ede4(0x1f9)],_0x54d884[_0x1680bb]['gross_price']=_0x340d6b['gross_price'],_0x54d884[_0x1680bb][_0x36ede4(0x1f6)]=_0x340d6b['sales_category'],_0x54d884[_0x1680bb]['date_recieved']=_0x340d6b[_0x36ede4(0x24f)],_0x54d884[_0x1680bb][_0x36ede4(0x1a6)]=_0x340d6b[_0x36ede4(0x22a)][_0x36ede4(0x210)]();});for(let _0x436f22=0x0;_0x436f22<=_0x54d884[_0x49fed3(0x1f8)]-0x1;_0x436f22++){const _0xd0ae9c=_0x54d884[_0x436f22],_0x1da8b9=new warehouse_temporary(_0xd0ae9c);await _0x1da8b9['save']();}_0x17f2ea[_0x49fed3(0x16c)]=_0x49fed3(0x163),await _0x17f2ea[_0x49fed3(0x1c2)](),_0x5e8e84[_0x49fed3(0x20e)](_0x49fed3(0x15e),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x5d0f25['redirect'](_0x49fed3(0x193)+_0x17f2ea['_id'][_0x49fed3(0x210)]());}catch(_0x4db86){}}),router[a0_0x12f677(0x1d3)](a0_0x12f677(0x1ae),auth,async(_0x364a98,_0x3abb70)=>{var _0x571d03=a0_0x12f677;try{const {invoice:_0x33ac71,date:_0x48f6b9,warehouse_name:_0x49e7e4,prod_name:_0x410032,note:_0x349607,due_amount:_0x5e9ce8,Room_name:_0x442774,PO_number:_0x17819d,SCRN:_0x466419,ReqBy:_0x4ba117,dateofreq:_0x5f0b56,suppliers:_0x441a87,typeservicesData:_0x1ddaf2,van:_0x32029f,typevehicle:_0x5d92ab,driver:_0x2b6754,plate:_0x5f256d,DRSI:_0x18436a,TSU:_0x2aa348,TFU:_0x3b32a3,JO_number:_0x4f38ae,type_of_products:_0x925da}=_0x364a98[_0x571d03(0x1e2)];if(typeof _0x410032==_0x571d03(0x25b))var _0x3d1eb9=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x224)]],_0x697861=[_0x364a98['body']['prod_code']],_0x15877f=[_0x364a98['body'][_0x571d03(0x1e5)]],_0x14cf23=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x155)]],_0x42a3c3=[_0x364a98[_0x571d03(0x1e2)]['prod_secondunit']],_0x12592d=[_0x364a98['body'][_0x571d03(0x1c0)]],_0x396d23=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x277)]],_0x47409b=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x180)]],_0x255b5a=[_0x364a98['body']['MaxStocks_data']],_0x43fcb4=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x1e1)]],_0x12fe48=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x1c3)]],_0x201395=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x158)]],_0x335309=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x148)]],_0x5afa5d=[_0x364a98['body'][_0x571d03(0x192)]],_0x20feba=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x254)]],_0x49f490=[_0x364a98['body']['gross_price']],_0x193fb1=[_0x364a98[_0x571d03(0x1e2)]['uuid']],_0x427b3f=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x1bb)]],_0x4c14b8=[_0x364a98[_0x571d03(0x1e2)][_0x571d03(0x257)]];else var _0x3d1eb9=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x224)]],_0x697861=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x14a)]],_0x15877f=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x1e5)]],_0x14cf23=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x155)]],_0x42a3c3=[..._0x364a98['body'][_0x571d03(0x1e9)]],_0x12592d=[..._0x364a98['body'][_0x571d03(0x1c0)]],_0x396d23=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x277)]],_0x47409b=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x180)]],_0x255b5a=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x272)]],_0x43fcb4=[..._0x364a98['body']['batch_code']],_0x12fe48=[..._0x364a98[_0x571d03(0x1e2)]['expiry_date']],_0x201395=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x158)]],_0x335309=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x148)]],_0x5afa5d=[..._0x364a98[_0x571d03(0x1e2)]['prod_cat']],_0x20feba=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x254)]],_0x49f490=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x162)]],_0x193fb1=[..._0x364a98[_0x571d03(0x1e2)][_0x571d03(0x1f9)]],_0x427b3f=[..._0x364a98[_0x571d03(0x1e2)]['sales_data_cateory']],_0x4c14b8=[..._0x364a98[_0x571d03(0x1e2)]['type_of_products_type']];const _0x3bae6c=_0x3d1eb9[_0x571d03(0x1d7)](_0x5eadfb=>{return _0x5eadfb={'product_name':_0x5eadfb};});_0x4c14b8[_0x571d03(0x197)]((_0x4a59bc,_0x2e1f66)=>{var _0x3e3e9a=_0x571d03;_0x3bae6c[_0x2e1f66][_0x3e3e9a(0x145)]=_0x4a59bc;}),_0x427b3f[_0x571d03(0x197)]((_0x3d1b08,_0x99601e)=>{var _0x522931=_0x571d03;_0x3bae6c[_0x99601e][_0x522931(0x1f6)]=_0x3d1b08;}),_0x697861[_0x571d03(0x197)]((_0x3acc0d,_0x1c063a)=>{var _0x415dd9=_0x571d03;_0x3bae6c[_0x1c063a][_0x415dd9(0x26f)]=_0x3acc0d;}),_0x193fb1[_0x571d03(0x197)]((_0x3b5495,_0xc98cb3)=>{var _0x5edb92=_0x571d03;_0x3bae6c[_0xc98cb3][_0x5edb92(0x1f9)]=_0x3b5495;}),_0x15877f['forEach']((_0x57a91e,_0x42f1df)=>{var _0x558813=_0x571d03;_0x3bae6c[_0x42f1df][_0x558813(0x19c)]=Math['abs'](_0x57a91e);}),_0x14cf23['forEach']((_0x26b7fa,_0x50b2f3)=>{_0x3bae6c[_0x50b2f3]['standard_unit']=_0x26b7fa;}),_0x42a3c3[_0x571d03(0x197)]((_0x208f72,_0x406bea)=>{_0x3bae6c[_0x406bea]['secondary_unit']=_0x208f72;}),_0x12592d[_0x571d03(0x197)]((_0x597df2,_0xa5c1e8)=>{var _0x17ee04=_0x571d03,_0x5ba780=_0x597df2[_0x17ee04(0x244)](/[A-Za-z]+/)[0x0],_0x2ed7b5=parseInt(_0x597df2['match'](/\d+/)[0x0]);_0x3bae6c[_0xa5c1e8][_0x17ee04(0x189)]=_0x5ba780,_0x3bae6c[_0xa5c1e8][_0x17ee04(0x1a2)]=_0x2ed7b5;}),_0x396d23[_0x571d03(0x197)]((_0x1d24bd,_0x12cc97)=>{var _0x1d2006=_0x571d03;_0x3bae6c[_0x12cc97][_0x1d2006(0x277)]=_0x1d24bd;}),_0x47409b['forEach']((_0x5210f3,_0x47f22d)=>{var _0x2babc0=_0x571d03;_0x3bae6c[_0x47f22d][_0x2babc0(0x180)]=_0x5210f3;}),_0x255b5a[_0x571d03(0x197)]((_0x391e1a,_0x2493c6)=>{var _0x57abfb=_0x571d03;_0x3bae6c[_0x2493c6][_0x57abfb(0x1be)]=_0x391e1a;}),_0x43fcb4[_0x571d03(0x197)]((_0x112411,_0x1aadac)=>{var _0x3a0321=_0x571d03;_0x3bae6c[_0x1aadac][_0x3a0321(0x1e1)]=_0x112411;}),_0x12fe48[_0x571d03(0x197)]((_0x594092,_0x591283)=>{var _0x1fcc0e=_0x571d03;_0x3bae6c[_0x591283][_0x1fcc0e(0x1c3)]=_0x594092;}),_0x201395[_0x571d03(0x197)]((_0x34289f,_0xb58b25)=>{var _0x131a1f=_0x571d03;_0x3bae6c[_0xb58b25][_0x131a1f(0x1ac)]=_0x34289f;}),_0x335309[_0x571d03(0x197)]((_0x392501,_0x3f5b07)=>{_0x3bae6c[_0x3f5b07]['maxperunit']=_0x392501;}),_0x5afa5d[_0x571d03(0x197)]((_0x3b03a8,_0x3b6221)=>{var _0x58c7f5=_0x571d03;_0x3bae6c[_0x3b6221][_0x58c7f5(0x187)]=_0x3b03a8;}),_0x20feba[_0x571d03(0x197)]((_0x184cd5,_0x18a691)=>{_0x3bae6c[_0x18a691]['room_name']=_0x184cd5;}),_0x49f490[_0x571d03(0x197)]((_0x237cd7,_0x34adf8)=>{var _0x4d098d=_0x571d03;_0x3bae6c[_0x34adf8][_0x4d098d(0x162)]=_0x237cd7;});const _0x19bdbe=new purchases_logs();await _0x19bdbe[_0x571d03(0x1c2)]();for(let _0x597fab=0x0;_0x597fab<=_0x20feba[_0x571d03(0x1f8)]-0x1;_0x597fab++){_0x3bae6c[_0x597fab][_0x571d03(0x1c7)]=_0x571d03(0x22d)+_0x19bdbe[_0x571d03(0x261)]['toString']()[_0x571d03(0x178)](0x8,'0');}const _0x1f7143=_0x3bae6c[_0x571d03(0x160)](_0x3dbef6=>_0x3dbef6[_0x571d03(0x19c)]!=='0'&&_0x3dbef6[_0x571d03(0x19c)]!==''),_0x92f181=new purchases_finished({'invoice':'LOG-INC-'+_0x19bdbe['invoice_init']['toString']()['padStart'](0x8,'0'),'suppliers':_0x441a87,'date':_0x48f6b9,'warehouse_name':_0x49e7e4,'product':_0x1f7143,'note':_0x349607,'due_amount':_0x5e9ce8,'room':_0x442774,'POnumber':_0x17819d,'SCRN':_0x466419,'JO_number':_0x4f38ae,'ReqBy':_0x4ba117,'dateofreq':_0x5f0b56,'typeservicesData':_0x1ddaf2,'van':_0x32029f,'typevehicle':_0x5d92ab,'driver':_0x2b6754,'plate':_0x5f256d,'DRSI':_0x18436a,'TSU':_0x2aa348,'TFU':_0x3b32a3,'typeOfProducts':_0x925da}),_0x2b5e2b=await _0x92f181[_0x571d03(0x1c2)](),_0x2f0637=await purchases_finished[_0x571d03(0x1e0)]({'_id':_0x2b5e2b[_0x571d03(0x22a)][_0x571d03(0x210)]()}),_0x351ab6=_0x2f0637[_0x571d03(0x196)][_0x571d03(0x1d7)](async _0x1b4ed9=>{var _0x93fd1f=_0x571d03;try{var _0x284a8c=await warehouse[_0x93fd1f(0x1e0)]({'name':_0x49e7e4,'room':_0x1b4ed9[_0x93fd1f(0x1df)]}),_0x2aaa24=0x0;const _0x5d4dea=_0x284a8c[_0x93fd1f(0x203)][_0x93fd1f(0x1d7)](_0x48b3e9=>{var _0x35a872=_0x93fd1f;console['log'](_0x48b3e9[_0x35a872(0x206)]+'=='+_0x1b4ed9[_0x35a872(0x206)]+'&&'+_0x48b3e9[_0x35a872(0x1a2)]+'=='+_0x1b4ed9['bay']+'&&'+_0x48b3e9[_0x35a872(0x1c3)]+'=='+_0x1b4ed9[_0x35a872(0x1c3)]+'&&'+_0x48b3e9[_0x35a872(0x1ac)]+'=='+_0x1b4ed9[_0x35a872(0x1ac)]+'&&'+_0x48b3e9[_0x35a872(0x1e1)]+'=='+_0x1b4ed9[_0x35a872(0x1e1)]+'&&'+_0x48b3e9[_0x35a872(0x1c7)]+'=='+_0x2f0637[_0x35a872(0x1c7)]),_0x48b3e9[_0x35a872(0x206)]==_0x1b4ed9['product_name']&&_0x48b3e9[_0x35a872(0x1a2)]==_0x1b4ed9[_0x35a872(0x1a2)]&&_0x48b3e9[_0x35a872(0x189)]==_0x1b4ed9[_0x35a872(0x189)]&&_0x48b3e9['expiry_date']==_0x1b4ed9[_0x35a872(0x1c3)]&&_0x48b3e9[_0x35a872(0x1ac)]==_0x1b4ed9['production_date']&&_0x48b3e9['batch_code']==_0x1b4ed9[_0x35a872(0x1e1)]&&_0x48b3e9[_0x35a872(0x1c7)]==_0x2f0637[_0x35a872(0x1c7)]&&(_0x48b3e9[_0x35a872(0x27b)]=Math[_0x35a872(0x16a)](_0x48b3e9[_0x35a872(0x27b)])+Math[_0x35a872(0x16a)](_0x1b4ed9[_0x35a872(0x19c)]),_0x2aaa24++);});return _0x2aaa24==0x0&&(_0x284a8c['product_details']=_0x284a8c[_0x93fd1f(0x203)][_0x93fd1f(0x1fc)]({'product_name':_0x1b4ed9[_0x93fd1f(0x206)],'product_stock':Math[_0x93fd1f(0x16a)](_0x1b4ed9['quantity']),'primary_code':_0x1b4ed9['primary_code'],'secondary_code':_0x1b4ed9[_0x93fd1f(0x180)],'product_code':_0x1b4ed9[_0x93fd1f(0x26f)],'bay':_0x1b4ed9[_0x93fd1f(0x1a2)],'level':_0x1b4ed9[_0x93fd1f(0x189)],'maxProducts':_0x1b4ed9[_0x93fd1f(0x1be)],'unit':_0x1b4ed9[_0x93fd1f(0x16f)],'secondary_unit':_0x1b4ed9[_0x93fd1f(0x267)],'expiry_date':_0x1b4ed9[_0x93fd1f(0x1c3)],'production_date':_0x1b4ed9[_0x93fd1f(0x1ac)],'maxProducts':_0x1b4ed9[_0x93fd1f(0x1be)],'maxPerUnit':_0x1b4ed9['maxperunit'],'batch_code':_0x1b4ed9['batch_code'],'product_cat':_0x1b4ed9[_0x93fd1f(0x187)],'invoice':_0x1b4ed9[_0x93fd1f(0x1c7)],'id_incoming':_0x1b4ed9[_0x93fd1f(0x22a)],'uuid':_0x1b4ed9['uuid'],'gross_price':_0x1b4ed9['gross_price'],'sales_category':_0x1b4ed9[_0x93fd1f(0x1f6)],'type_products':_0x1b4ed9[_0x93fd1f(0x145)]})),_0x284a8c;}catch(_0xe33beb){return console[_0x93fd1f(0x1fe)](_0x93fd1f(0x1dd),_0xe33beb),null;}});Promise[_0x571d03(0x1d0)](_0x351ab6)['then'](async _0x2d1665=>{var _0x1c41dc=_0x571d03;try{for(const _0x41abe2 of _0x2d1665){await warehouse[_0x1c41dc(0x157)]({'_id':_0x41abe2[_0x1c41dc(0x22a)]},{'$addToSet':{'product_details':{'$each':_0x41abe2['product_details']}}});}const _0x2b89aa=await master_shop[_0x1c41dc(0x13d)](),_0x1668a7=await email_settings[_0x1c41dc(0x1e0)](),_0x544a3e=await supervisor_settings[_0x1c41dc(0x13d)]();var _0x1628a1=_0x2f0637[_0x1c41dc(0x196)],_0x297b0b='',_0x525603;for(_0x525603 in _0x1628a1){var _0x4c9618='FG';_0x2f0637[_0x1c41dc(0x21c)]=='DRY\x20GOODS'&&(_0x4c9618='DG'),_0x297b0b+=_0x1c41dc(0x1da)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1628a1[_0x525603][_0x1c41dc(0x206)]+_0x1c41dc(0x220)+_0x1c41dc(0x202)+_0x1628a1[_0x525603][_0x1c41dc(0x26f)]+_0x1c41dc(0x220)+_0x1c41dc(0x202)+_0x1628a1[_0x525603][_0x1c41dc(0x19c)]+_0x1c41dc(0x220)+_0x1c41dc(0x202)+_0x1628a1[_0x525603]['standard_unit']+_0x1c41dc(0x220)+_0x1c41dc(0x202)+_0x1628a1[_0x525603][_0x1c41dc(0x267)]+_0x1c41dc(0x220)+_0x1c41dc(0x202)+_0x2f0637[_0x1c41dc(0x21c)]+'</td>'+_0x1c41dc(0x202)+_0x1628a1[_0x525603][_0x1c41dc(0x1df)]+'</td>'+_0x1c41dc(0x202)+_0x4c9618+_0x1628a1[_0x525603][_0x1c41dc(0x1a2)]+'</td>',_0x1c41dc(0x278);}let _0x1349f5=nodemailer[_0x1c41dc(0x200)]({'host':_0x1668a7['host'],'port':Number(_0x1668a7['port']),'secure':![],'auth':{'user':_0x1668a7[_0x1c41dc(0x226)],'pass':_0x1668a7[_0x1c41dc(0x1bc)]}}),_0x42b659={'from':_0x1668a7[_0x1c41dc(0x226)],'to':_0x544a3e[0x0][_0x1c41dc(0x1f3)],'subject':_0x1c41dc(0x142),'attachments':[{'filename':_0x1c41dc(0x1a9),'path':__dirname+_0x1c41dc(0x1ad)+'/upload/'+_0x2b89aa[0x0][_0x1c41dc(0x179)],'cid':_0x1c41dc(0x270)}],'html':'<!DOCTYPE\x20html>'+_0x1c41dc(0x1c4)+'</head><body>'+_0x1c41dc(0x15b)+_0x1c41dc(0x1c5)+_0x1c41dc(0x15b)+_0x1c41dc(0x26b)+_0x1c41dc(0x1c9)+_0x1c41dc(0x15b)+'<h2>\x20'+_0x2b89aa[0x0]['site_title']+_0x1c41dc(0x245)+'</div>'+_0x1c41dc(0x1c9)+'<hr\x20class=\x22my-3\x22>'+_0x1c41dc(0x15b)+_0x1c41dc(0x268)+'\x20Order\x20Number\x20:\x20'+_0x2f0637['invoice']+'\x20'+_0x1c41dc(0x1fa)+_0x1c41dc(0x1b3)+_0x2f0637[_0x1c41dc(0x240)]+'\x20'+'</span>'+'</h5>'+_0x1c41dc(0x1c9)+_0x1c41dc(0x1eb)+_0x1c41dc(0x1e4)+'<tr>'+_0x1c41dc(0x269)+_0x1c41dc(0x1f1)+_0x1c41dc(0x236)+_0x1c41dc(0x1ca)+_0x1c41dc(0x195)+_0x1c41dc(0x233)+_0x1c41dc(0x18e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x1c41dc(0x17f)+_0x1c41dc(0x23b)+'\x20'+_0x297b0b+'\x20'+_0x1c41dc(0x1f2)+_0x1c41dc(0x1b9)+'<div>'+_0x1c41dc(0x1a4)+'<h5>'+_0x2b89aa[0x0][_0x1c41dc(0x16e)]+_0x1c41dc(0x24d)+_0x1c41dc(0x1c9)+'</div>'+_0x1c41dc(0x177)};_0x1349f5[_0x1c41dc(0x1ee)](_0x42b659,function(_0xd23daf,_0x2736ff){var _0x39a8a4=_0x1c41dc;_0xd23daf?(console[_0x39a8a4(0x20f)](_0xd23daf),console[_0x39a8a4(0x20f)](_0x39a8a4(0x1cf))):console[_0x39a8a4(0x20f)](_0x39a8a4(0x276));});}catch(_0x25112f){console[_0x1c41dc(0x1fe)](_0x25112f),_0x3abb70[_0x1c41dc(0x280)](0x1f4)['json']({'error':_0x1c41dc(0x15a),'message':_0x25112f[_0x1c41dc(0x23c)]});}})[_0x571d03(0x151)](_0x3c2504=>{var _0x165548=_0x571d03;console[_0x165548(0x1fe)](_0x3c2504);}),_0x364a98['flash']('success',_0x571d03(0x201)),_0x3abb70['redirect']('/all_purchases_finished/preview/'+_0x2f0637['_id'][_0x571d03(0x210)]());}catch(_0x5480be){console[_0x571d03(0x20f)](_0x5480be);}}),router[a0_0x12f677(0x167)]('/preview/:id',auth,async(_0x1efdc2,_0x3df433)=>{var _0x111e2e=a0_0x12f677;try{const {username:_0x2ec48e,email:_0x4a8e22,role:_0x86877d}=_0x1efdc2[_0x111e2e(0x1b8)],_0x3cee41=_0x1efdc2[_0x111e2e(0x1b8)],_0x42668c=await profile[_0x111e2e(0x1e0)]({'email':_0x3cee41[_0x111e2e(0x226)]}),_0x14f8a1=await master_shop[_0x111e2e(0x13d)](),_0x10f7a7=_0x1efdc2[_0x111e2e(0x230)]['id'],_0x40ab05=await purchases_finished[_0x111e2e(0x23e)](_0x10f7a7),_0x3cc462=await suppliers[_0x111e2e(0x13d)]({});let _0x5cd25b;if(_0x3cee41[_0x111e2e(0x14d)]==_0x111e2e(0x24e)){const _0x207fad=await staff[_0x111e2e(0x1e0)]({'email':_0x3cee41[_0x111e2e(0x226)]});_0x5cd25b=await warehouse[_0x111e2e(0x13d)]({'status':_0x111e2e(0x194),'name':_0x207fad['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x5cd25b=await warehouse['aggregate']([{'$match':{'status':_0x111e2e(0x194),'warehouse_category':_0x111e2e(0x21e)}},{'$group':{'_id':_0x111e2e(0x1ec),'name':{'$first':_0x111e2e(0x1ec)}}}]);const _0x433e7d=await product['find']({}),_0x5eeaee=BayBinSelected(_0x40ab05[_0x111e2e(0x21c)],_0x40ab05[_0x111e2e(0x1c1)]);let _0x144f80=new Date(_0x40ab05[_0x111e2e(0x1c3)]),_0x54574d=('0'+_0x144f80[_0x111e2e(0x23f)]())[_0x111e2e(0x27f)](-0x2),_0x558414=('0'+(_0x144f80['getMonth']()+0x1))[_0x111e2e(0x27f)](-0x2),_0x2969f2=_0x144f80[_0x111e2e(0x235)](),_0x105a42=_0x2969f2+'-'+_0x558414+'-'+_0x54574d;if(_0x14f8a1[0x0]['language']==_0x111e2e(0x1bf)){var _0x2d0b76=users[_0x111e2e(0x22c)];console['log'](_0x2d0b76);}else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]==_0x111e2e(0x24b))var _0x2d0b76=users['Hindi'];else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]==_0x111e2e(0x1fd))var _0x2d0b76=users[_0x111e2e(0x1fd)];else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]=='Spanish')var _0x2d0b76=users['Spanish'];else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]=='French')var _0x2d0b76=users['French'];else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]=='Portuguese\x20(BR)')var _0x2d0b76=users['Portuguese'];else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]==_0x111e2e(0x165))var _0x2d0b76=users['Chinese'];else{if(_0x14f8a1[0x0][_0x111e2e(0x1a1)]==_0x111e2e(0x234))var _0x2d0b76=users[_0x111e2e(0x27d)];}}}}}}}_0x3df433[_0x111e2e(0x27c)]('edit_purchases_finished_view',{'success':_0x1efdc2[_0x111e2e(0x20e)](_0x111e2e(0x15e)),'errors':_0x1efdc2['flash'](_0x111e2e(0x17a)),'role':_0x3cee41,'profile':_0x42668c,'purchases':_0x40ab05,'suppliers':_0x3cc462,'warehouse':_0x5cd25b,'product':_0x433e7d,'master_shop':_0x14f8a1,'language':_0x2d0b76,'ed_fullDate':_0x105a42,'dataSelected':_0x5eeaee});}catch(_0x384ce6){console[_0x111e2e(0x20f)](_0x384ce6);}}),router[a0_0x12f677(0x167)](a0_0x12f677(0x249),auth,async(_0x511b6c,_0x33b751)=>{var _0xb238f1=a0_0x12f677;try{const {username:_0x4d7867,email:_0x16a16d,role:_0x1f9520}=_0x511b6c[_0xb238f1(0x1b8)],_0x15192c=_0x511b6c[_0xb238f1(0x1b8)],_0x3852f4=await profile[_0xb238f1(0x1e0)]({'email':_0x15192c['email']}),_0x1c80b9=await master_shop[_0xb238f1(0x13d)](),_0x3855c6=_0x511b6c['params']['id'],_0x4737d9=await purchases_finished[_0xb238f1(0x23e)](_0x3855c6),_0x1e7f72=await suppliers[_0xb238f1(0x13d)]({});let _0x3f685f;if(_0x15192c[_0xb238f1(0x14d)]==_0xb238f1(0x24e)){const _0x3b2012=await staff[_0xb238f1(0x1e0)]({'email':_0x15192c[_0xb238f1(0x226)]});_0x3f685f=await warehouse[_0xb238f1(0x13d)]({'status':_0xb238f1(0x194),'name':_0x3b2012[_0xb238f1(0x19a)],'warehouse_category':_0xb238f1(0x21e)});}else _0x3f685f=await warehouse[_0xb238f1(0x1e8)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0xb238f1(0x1ec)}}}]);const _0x587706=await product[_0xb238f1(0x13d)]({}),_0x76b26f=BayBinSelected(_0x4737d9[_0xb238f1(0x21c)],_0x4737d9[_0xb238f1(0x1c1)]);let _0x211032=new Date(_0x4737d9[_0xb238f1(0x1c3)]),_0x4bea2b=('0'+_0x211032['getDate']())[_0xb238f1(0x27f)](-0x2),_0x5c3be4=('0'+(_0x211032[_0xb238f1(0x218)]()+0x1))[_0xb238f1(0x27f)](-0x2),_0x109261=_0x211032[_0xb238f1(0x235)](),_0x7324ad=_0x109261+'-'+_0x5c3be4+'-'+_0x4bea2b;if(_0x1c80b9[0x0]['language']==_0xb238f1(0x1bf)){var _0x38e121=users[_0xb238f1(0x22c)];console[_0xb238f1(0x20f)](_0x38e121);}else{if(_0x1c80b9[0x0]['language']==_0xb238f1(0x24b))var _0x38e121=users['Hindi'];else{if(_0x1c80b9[0x0][_0xb238f1(0x1a1)]==_0xb238f1(0x1fd))var _0x38e121=users[_0xb238f1(0x1fd)];else{if(_0x1c80b9[0x0][_0xb238f1(0x1a1)]==_0xb238f1(0x222))var _0x38e121=users[_0xb238f1(0x222)];else{if(_0x1c80b9[0x0][_0xb238f1(0x1a1)]=='French')var _0x38e121=users['French'];else{if(_0x1c80b9[0x0][_0xb238f1(0x1a1)]==_0xb238f1(0x1b1))var _0x38e121=users[_0xb238f1(0x26d)];else{if(_0x1c80b9[0x0][_0xb238f1(0x1a1)]==_0xb238f1(0x165))var _0x38e121=users[_0xb238f1(0x165)];else{if(_0x1c80b9[0x0][_0xb238f1(0x1a1)]==_0xb238f1(0x234))var _0x38e121=users['Arabic'];}}}}}}}_0x33b751['render'](_0xb238f1(0x212),{'success':_0x511b6c['flash'](_0xb238f1(0x15e)),'errors':_0x511b6c[_0xb238f1(0x20e)]('errors'),'role':_0x15192c,'profile':_0x3852f4,'purchases':_0x4737d9,'suppliers':_0x1e7f72,'warehouse':_0x3f685f,'product':_0x587706,'master_shop':_0x1c80b9,'language':_0x38e121,'ed_fullDate':_0x7324ad,'dataSelected':_0x76b26f});}catch(_0x59005b){console[_0xb238f1(0x20f)](_0x59005b);}}),router[a0_0x12f677(0x1d3)](a0_0x12f677(0x249),auth,async(_0x5dc9dc,_0x3d9362)=>{var _0x339265=a0_0x12f677;try{const _0x4035df=_0x5dc9dc[_0x339265(0x230)]['id'],_0x3b625b=await purchases_finished[_0x339265(0x1e0)]({'_id':_0x5dc9dc[_0x339265(0x230)]['id']}),_0x2944ae=await warehouse[_0x339265(0x1e0)]({'name':_0x3b625b[_0x339265(0x21c)],'room':_0x3b625b[_0x339265(0x1c1)]});_0x3b625b[_0x339265(0x196)][_0x339265(0x197)](_0x286560=>{var _0x54353b=_0x339265;const _0x30f010=_0x2944ae['product_details'][_0x54353b(0x1d7)](_0x5d27bc=>{var _0x5d1ff0=_0x54353b;_0x5d27bc[_0x5d1ff0(0x206)]==_0x286560[_0x5d1ff0(0x206)]&&_0x5d27bc[_0x5d1ff0(0x1a2)]==_0x286560[_0x5d1ff0(0x1a2)]&&(_0x5d27bc[_0x5d1ff0(0x27b)]=parseInt(_0x5d27bc['product_stock'])-parseInt(_0x286560[_0x5d1ff0(0x19c)]));});}),await _0x2944ae[_0x339265(0x1c2)]();const {invoice:_0x5e9a49,suppliers:_0x3ba2e4,date:_0x995f5f,warehouse_name:_0x1a7a7d,prod_name:_0x5bb02e,prod_code:_0xdea284,prod_qty:_0x328315,prod_unit:_0x473747,prod_secondunit:_0x5d2100,prod_level:_0x4a021a,prod_isle:_0x504a1a,prod_pallet:_0x54e8f9,note:_0x4758a7,expiry_date:_0x200d83,batch_code:_0x12d25e,paid_amount:_0x5a5ed6,due_amount:_0xe33843,Room_name:_0x1f66da,primary_code:_0xbda977,secondary_code:_0x595802,PO_number:_0x2200fb,JO_number:_0x58c1c6}=_0x5dc9dc[_0x339265(0x1e2)];if(typeof _0x5bb02e==_0x339265(0x25b))var _0x315240=[_0x5dc9dc['body'][_0x339265(0x224)]],_0xde8e09=[_0x5dc9dc[_0x339265(0x1e2)]['prod_code']],_0x1fb79c=[_0x5dc9dc['body'][_0x339265(0x1b4)]],_0x509b49=[_0x5dc9dc['body'][_0x339265(0x143)]],_0x2c86f8=[_0x5dc9dc['body'][_0x339265(0x1e9)]],_0x3862e7=[_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1c0)]],_0x9b0d=[_0x5dc9dc[_0x339265(0x1e2)]['primary_code']],_0xb5e057=[_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x180)]],_0x151f16=[_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x272)]],_0x12d35d=[_0x5dc9dc[_0x339265(0x1e2)]['batch_code']],_0x43974f=[_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1c3)]];else var _0x315240=[..._0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x224)]],_0xde8e09=[..._0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x14a)]],_0x1fb79c=[..._0x5dc9dc['body'][_0x339265(0x1b4)]],_0x509b49=[..._0x5dc9dc['body'][_0x339265(0x143)]],_0x2c86f8=[..._0x5dc9dc['body']['prod_secondunit']],_0x3862e7=[..._0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1c0)]],_0x9b0d=[..._0x5dc9dc['body'][_0x339265(0x277)]],_0xb5e057=[..._0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x180)]],_0x151f16=[..._0x5dc9dc['body'][_0x339265(0x272)]],_0x12d35d=[..._0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1e1)]],_0x43974f=[..._0x5dc9dc[_0x339265(0x1e2)]['expiry_date']];const _0x2b88db=_0x315240['map'](_0x376a8c=>{return _0x376a8c={'product_name':_0x376a8c};});_0xde8e09[_0x339265(0x197)]((_0x13beee,_0x4d448a)=>{var _0x1bb35e=_0x339265;_0x2b88db[_0x4d448a][_0x1bb35e(0x26f)]=_0x13beee;}),_0x1fb79c[_0x339265(0x197)]((_0x478b73,_0x3809e3)=>{var _0x374169=_0x339265;_0x2b88db[_0x3809e3][_0x374169(0x19c)]=_0x478b73;}),_0x509b49['forEach']((_0x2664da,_0x1263c2)=>{var _0x1e5d7d=_0x339265;_0x2b88db[_0x1263c2][_0x1e5d7d(0x16f)]=_0x2664da;}),_0x2c86f8[_0x339265(0x197)]((_0x354959,_0x187af1)=>{var _0x56e79a=_0x339265;_0x2b88db[_0x187af1][_0x56e79a(0x267)]=_0x354959;}),_0x3862e7[_0x339265(0x197)]((_0x216ebb,_0x384a92)=>{var _0x3f7da5=_0x339265;_0x2b88db[_0x384a92][_0x3f7da5(0x1a2)]=_0x216ebb;}),_0x9b0d['forEach']((_0x545d22,_0xc67cee)=>{var _0x267383=_0x339265;_0x2b88db[_0xc67cee][_0x267383(0x277)]=_0x545d22;}),_0xb5e057[_0x339265(0x197)]((_0xbb508d,_0x271116)=>{_0x2b88db[_0x271116]['secondary_code']=_0xbb508d;}),_0x151f16['forEach']((_0x57fff0,_0x432c06)=>{_0x2b88db[_0x432c06]['maxStocks']=_0x57fff0;}),_0x12d35d['forEach']((_0x16f764,_0x6b81da)=>{var _0x39d679=_0x339265;_0x2b88db[_0x6b81da][_0x39d679(0x1e1)]=_0x16f764;}),_0x43974f[_0x339265(0x197)]((_0x2fd503,_0x57637e)=>{var _0x3be9ab=_0x339265;_0x2b88db[_0x57637e][_0x3be9ab(0x1c3)]=_0x2fd503;});const _0x4e60b=_0x2b88db[_0x339265(0x160)](_0x4b6d80=>_0x4b6d80[_0x339265(0x19c)]!=='0'&&_0x4b6d80[_0x339265(0x19c)]!=='');_0x3b625b[_0x339265(0x1c7)]=_0x5e9a49,_0x3b625b['suppliers']=_0x3ba2e4,_0x3b625b[_0x339265(0x240)]=_0x995f5f,_0x3b625b[_0x339265(0x21c)]=_0x1a7a7d,_0x3b625b[_0x339265(0x196)]=_0x4e60b,_0x3b625b['note']=_0x4758a7,_0x3b625b['paid_amount']=_0x5a5ed6,_0x3b625b[_0x339265(0x252)]=_0xe33843,_0x3b625b[_0x339265(0x1c1)]=_0x1f66da,_0x3b625b[_0x339265(0x248)]=_0x2200fb,_0x3b625b['JO_number']=_0x58c1c6;const _0x7a1847=await _0x3b625b[_0x339265(0x1c2)](),_0x3e13f2=await warehouse['findOne']({'name':_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x21c)],'room':_0x5dc9dc['body'][_0x339265(0x27a)]});_0x3b625b[_0x339265(0x196)]['forEach'](_0x5a6db0=>{var _0x574f6d=_0x339265,_0x419739=0x0;const _0x41c06c=_0x3e13f2[_0x574f6d(0x203)][_0x574f6d(0x1d7)](_0x3c0955=>{var _0x4a2958=_0x574f6d;_0x3c0955['product_name']==_0x5a6db0['product_name']&&_0x3c0955[_0x4a2958(0x1a2)]==_0x5a6db0[_0x4a2958(0x1a2)]&&(_0x3c0955[_0x4a2958(0x27b)]=parseInt(_0x3c0955[_0x4a2958(0x27b)])+parseInt(_0x5a6db0[_0x4a2958(0x19c)]),_0x419739++);});_0x419739=='0'&&(_0x3e13f2['product_details']=_0x3e13f2[_0x574f6d(0x203)][_0x574f6d(0x1fc)]({'product_name':_0x5a6db0['product_name'],'product_stock':_0x5a6db0[_0x574f6d(0x19c)],'primary_code':_0x5a6db0[_0x574f6d(0x277)],'secondary_code':_0x5a6db0[_0x574f6d(0x180)],'product_code':_0x5a6db0['product_code'],'bay':_0x5a6db0[_0x574f6d(0x1a2)],'maxProducts':_0x5a6db0[_0x574f6d(0x1be)],'unit':_0x5a6db0['standard_unit'],'secondary_unit':_0x5a6db0[_0x574f6d(0x267)],'expiry_date':_0x5a6db0[_0x574f6d(0x1c3)]}));}),await _0x3e13f2[_0x339265(0x1c2)]();const _0x237f1c=await s_payment_data[_0x339265(0x1e0)]({'invoice':_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1c7)]});if(_0x237f1c===null){}else console[_0x339265(0x20f)](_0x339265(0x1ff),_0x237f1c,_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1c7)]),_0x237f1c[_0x339265(0x1ff)]=_0x5dc9dc[_0x339265(0x1e2)][_0x339265(0x1ff)],await _0x237f1c[_0x339265(0x1c2)]();_0x5dc9dc[_0x339265(0x20e)](_0x339265(0x15e),_0x339265(0x19d)),_0x3d9362['redirect'](_0x339265(0x15f));}catch(_0x154916){console[_0x339265(0x20f)](_0x154916);}}),router['post'](a0_0x12f677(0x256),auth,async(_0x57a5c5,_0x1e1b1e)=>{var _0x2910df=a0_0x12f677;try{const _0x2b0034=_0x57a5c5['params']['id'],{invoice:_0x1e9435,suppliers:_0x54ad34,payable:_0xda7d3,due_amount:_0x51bc27}=_0x57a5c5[_0x2910df(0x1e2)],_0x3f7c4b=await purchases[_0x2910df(0x23e)](_0x2b0034);var _0x5b2f96=_0xda7d3-_0x51bc27;_0x3f7c4b[_0x2910df(0x214)]=parseFloat(_0x3f7c4b[_0x2910df(0x214)])+parseFloat(_0x51bc27),_0x3f7c4b[_0x2910df(0x252)]=_0x5b2f96;const _0x13d81a=await _0x3f7c4b[_0x2910df(0x1c2)]();console[_0x2910df(0x20f)](_0x13d81a);const _0x1079a9=await s_payment_data[_0x2910df(0x1e0)]({'invoice':_0x1e9435});_0x1079a9['amount']=_0x5b2f96,await _0x1079a9['save']();let _0x5eb4a3=new Date(),_0x25a538=('0'+_0x5eb4a3['getDate']())['slice'](-0x2),_0x3fd334=('0'+(_0x5eb4a3['getMonth']()+0x1))[_0x2910df(0x27f)](-0x2),_0x15b6fc=_0x5eb4a3[_0x2910df(0x235)](),_0x29818b=_0x15b6fc+'-'+_0x3fd334+'-'+_0x25a538;const _0x53cf07=new suppliers_payment({'invoice':_0x1e9435,'date':_0x15b6fc+'-'+_0x3fd334+'-'+_0x25a538,'suppliers':_0x54ad34,'reason':_0x2910df(0x16b),'amount':_0x51bc27}),_0x4414a6=await _0x53cf07['save']();_0x57a5c5[_0x2910df(0x20e)]('success',_0x2910df(0x144)),_0x1e1b1e[_0x2910df(0x174)](_0x2910df(0x229));}catch(_0x5121f0){console['log'](_0x5121f0);}}),router[a0_0x12f677(0x167)](a0_0x12f677(0x1e7),auth,async(_0x41e635,_0x51f1ea)=>{var _0x38b37f=a0_0x12f677;try{const {username:_0x344840,email:_0x5dee8d,role:_0x4b909d}=_0x41e635['user'],_0x32459d=_0x41e635[_0x38b37f(0x1b8)],_0x46bdba=await profile['findOne']({'email':_0x32459d[_0x38b37f(0x226)]}),_0x98e436=await master_shop[_0x38b37f(0x13d)]();console[_0x38b37f(0x20f)](_0x38b37f(0x27e),_0x98e436);const _0x45ebf8=_0x41e635[_0x38b37f(0x230)]['id'],_0x5500fc=await purchases[_0x38b37f(0x23e)](_0x45ebf8);console[_0x38b37f(0x20f)](_0x5500fc);const _0x20dd64=await suppliers[_0x38b37f(0x1e0)]({'name':_0x5500fc[_0x38b37f(0x1ff)]});console[_0x38b37f(0x20f)](_0x20dd64);if(_0x98e436[0x0]['language']==_0x38b37f(0x1bf)){var _0x5edbd5=users[_0x38b37f(0x22c)];console[_0x38b37f(0x20f)](_0x5edbd5);}else{if(_0x98e436[0x0][_0x38b37f(0x1a1)]==_0x38b37f(0x24b))var _0x5edbd5=users['Hindi'];else{if(_0x98e436[0x0][_0x38b37f(0x1a1)]==_0x38b37f(0x1fd))var _0x5edbd5=users[_0x38b37f(0x1fd)];else{if(_0x98e436[0x0]['language']==_0x38b37f(0x222))var _0x5edbd5=users['Spanish'];else{if(_0x98e436[0x0][_0x38b37f(0x1a1)]=='French')var _0x5edbd5=users[_0x38b37f(0x169)];else{if(_0x98e436[0x0]['language']=='Portuguese\x20(BR)')var _0x5edbd5=users[_0x38b37f(0x26d)];else{if(_0x98e436[0x0][_0x38b37f(0x1a1)]==_0x38b37f(0x165))var _0x5edbd5=users[_0x38b37f(0x165)];else{if(_0x98e436[0x0][_0x38b37f(0x1a1)]==_0x38b37f(0x234))var _0x5edbd5=users[_0x38b37f(0x27d)];}}}}}}}_0x51f1ea[_0x38b37f(0x27c)](_0x38b37f(0x223),{'success':_0x41e635[_0x38b37f(0x20e)]('success'),'errors':_0x41e635['flash'](_0x38b37f(0x17a)),'role':_0x32459d,'profile':_0x46bdba,'master_shop':_0x98e436,'supplier':_0x20dd64,'purchase':_0x5500fc,'language':_0x5edbd5});}catch(_0xec4ca7){console[_0x38b37f(0x20f)](_0xec4ca7);}}),router['get'](a0_0x12f677(0x17d),auth,async(_0x46713b,_0x532654)=>{var _0x5f377d=a0_0x12f677;try{const {username:_0x3cd783,email:_0x3fa9d2,role:_0x339800}=_0x46713b[_0x5f377d(0x1b8)],_0x54d0e7=_0x46713b[_0x5f377d(0x1b8)],_0x256add=await profile[_0x5f377d(0x1e0)]({'email':_0x54d0e7['email']}),_0x70b9e0=await master_shop[_0x5f377d(0x13d)]();console[_0x5f377d(0x20f)]('master',_0x70b9e0);const _0x3dd934=_0x46713b[_0x5f377d(0x230)]['id'];console[_0x5f377d(0x20f)](_0x3dd934);const _0x456d43=await purchases_finished[_0x5f377d(0x23e)](_0x3dd934);console[_0x5f377d(0x20f)](_0x5f377d(0x1f0),_0x456d43);const _0x48ec14=await product[_0x5f377d(0x13d)]({}),_0x422a06=await warehouse['aggregate']([{'$match':{'name':_0x456d43[_0x5f377d(0x21c)],'room':_0x456d43['room']}},{'$unwind':_0x5f377d(0x166)},{'$group':{'_id':_0x5f377d(0x1e6),'name':{'$first':_0x5f377d(0x26c)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5f377d(0x19e)},'bin':{'$first':_0x5f377d(0x190)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5f377d(0x26e)},'primary_code':{'$first':_0x5f377d(0x1d6)},'secondary_code':{'$first':_0x5f377d(0x251)},'product_code':{'$first':_0x5f377d(0x1cd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5f377d(0x25d)}}}]);console[_0x5f377d(0x20f)]('stock_data',_0x422a06);let _0x196456;if(_0x54d0e7[_0x5f377d(0x14d)]=='staff'){const _0x405677=await staff[_0x5f377d(0x1e0)]({'email':_0x54d0e7[_0x5f377d(0x226)]});_0x196456=await warehouse['find']({'status':'Enabled','name':_0x405677[_0x5f377d(0x19a)],'warehouse_category':'Finished\x20Goods','name':_0x5f377d(0x221)});}else _0x196456=await warehouse[_0x5f377d(0x1e8)]([{'$match':{'status':_0x5f377d(0x194),'warehouse_category':'Finished\x20Goods','name':_0x5f377d(0x221)}},{'$group':{'_id':_0x5f377d(0x1ec),'name':{'$first':_0x5f377d(0x1ec)}}}]);if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]==_0x5f377d(0x1bf)){var _0x305f5c=users[_0x5f377d(0x22c)];console[_0x5f377d(0x20f)](_0x305f5c);}else{if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]=='Hindi')var _0x305f5c=users[_0x5f377d(0x24b)];else{if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]==_0x5f377d(0x1fd))var _0x305f5c=users['German'];else{if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]==_0x5f377d(0x222))var _0x305f5c=users[_0x5f377d(0x222)];else{if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]==_0x5f377d(0x169))var _0x305f5c=users[_0x5f377d(0x169)];else{if(_0x70b9e0[0x0]['language']==_0x5f377d(0x1b1))var _0x305f5c=users['Portuguese'];else{if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]==_0x5f377d(0x165))var _0x305f5c=users[_0x5f377d(0x165)];else{if(_0x70b9e0[0x0][_0x5f377d(0x1a1)]=='Arabic\x20(ae)')var _0x305f5c=users[_0x5f377d(0x27d)];}}}}}}}_0x532654['render'](_0x5f377d(0x281),{'success':_0x46713b[_0x5f377d(0x20e)](_0x5f377d(0x15e)),'errors':_0x46713b[_0x5f377d(0x20e)](_0x5f377d(0x17a)),'role':_0x54d0e7,'profile':_0x256add,'user':_0x456d43,'stock':_0x422a06,'master_shop':_0x70b9e0,'product':_0x48ec14,'language':_0x305f5c,'warehouse':_0x196456});}catch(_0x56d3db){console['log'](_0x56d3db);}}),router[a0_0x12f677(0x1d3)](a0_0x12f677(0x17d),auth,async(_0x40ad40,_0x164da4)=>{var _0x45a59d=a0_0x12f677;try{const {invoice:_0x234f26,date:_0x7d5c29,warehouse_name:_0x3e32b2,Room_name:_0x59382e,product_name:_0x3551fd,purchase_quantity:_0x581d6f,stocks:_0x4066cb,return_qty:_0x218147,note:_0x5a2c81,level:_0x23ef33,isle:_0x3cfde1,pallet:_0x604e2c,to_warehouse_name:_0xf1574e,to_Room_name:_0x4efb6a}=_0x40ad40[_0x45a59d(0x1e2)],_0x6a94e4=await purchases_finished[_0x45a59d(0x1e0)]({'_id':_0x40ad40[_0x45a59d(0x230)]['id']}),_0xa612fb=await warehouse['findOne']({'name':_0x3e32b2,'room':_0x59382e,'warehouse_category':_0x45a59d(0x21e)});if(typeof _0x3551fd==_0x45a59d(0x25b))var _0x29ccb8=[_0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x206)]],_0x2e618b=[_0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x1ed)]],_0x966ec0=[_0x40ad40['body'][_0x45a59d(0x260)]],_0x139b61=[_0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x161)]],_0x2d9a0f=[_0x40ad40[_0x45a59d(0x1e2)]['level']],_0x2b9567=[_0x40ad40[_0x45a59d(0x1e2)]['product_code_hide']],_0xf99e75=[_0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x250)]],_0x25b6da=[_0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x140)]];else var _0x29ccb8=[..._0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x206)]],_0x2e618b=[..._0x40ad40[_0x45a59d(0x1e2)]['purchase_quantity']],_0x966ec0=[..._0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x260)]],_0x139b61=[..._0x40ad40[_0x45a59d(0x1e2)]['return_qty']],_0x2d9a0f=[..._0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x189)]],_0x2b9567=[..._0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x1e3)]],_0xf99e75=[..._0x40ad40['body'][_0x45a59d(0x250)]],_0x25b6da=[..._0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x140)]];const _0x4d4417=_0x29ccb8[_0x45a59d(0x1d7)](_0x386d36=>{return _0x386d36={'product_name':_0x386d36};});_0x2e618b['forEach']((_0x1803cd,_0x42783e)=>{var _0x29f71a=_0x45a59d;_0x4d4417[_0x42783e][_0x29f71a(0x1ed)]=_0x1803cd;}),_0x966ec0[_0x45a59d(0x197)]((_0x3f5d2d,_0x38522c)=>{var _0x223fa3=_0x45a59d;_0x4d4417[_0x38522c][_0x223fa3(0x207)]=_0x3f5d2d;}),_0x139b61[_0x45a59d(0x197)]((_0x1b6b51,_0xd0a4e1)=>{var _0x4f8ccf=_0x45a59d;_0x4d4417[_0xd0a4e1][_0x4f8ccf(0x161)]=_0x1b6b51;}),_0x2d9a0f[_0x45a59d(0x197)]((_0x556a4d,_0x2c2405)=>{_0x4d4417[_0x2c2405]['bay']=_0x556a4d;}),_0x2b9567[_0x45a59d(0x197)]((_0x297fb7,_0x3b8b9e)=>{var _0x1e8189=_0x45a59d;_0x4d4417[_0x3b8b9e][_0x1e8189(0x26f)]=_0x297fb7;}),_0xf99e75[_0x45a59d(0x197)]((_0xa32110,_0x38a9e3)=>{_0x4d4417[_0x38a9e3]['primary_code']=_0xa32110;}),_0x25b6da[_0x45a59d(0x197)]((_0x55d18b,_0x3b02e2)=>{var _0x352e4a=_0x45a59d;_0x4d4417[_0x3b02e2][_0x352e4a(0x180)]=_0x55d18b;}),_0x4d4417['forEach'](_0x4bbae0=>{var _0x57dd1b=_0x45a59d;console[_0x57dd1b(0x20f)](_0x4bbae0);const _0x19ddc4=_0xa612fb[_0x57dd1b(0x203)][_0x57dd1b(0x1d7)](_0x499481=>{var _0x2fe6f3=_0x57dd1b;_0x499481['product_name']==_0x4bbae0[_0x2fe6f3(0x206)]&&_0x499481[_0x2fe6f3(0x1a2)]==_0x4bbae0[_0x2fe6f3(0x1a2)]&&(console['log'](parseInt(_0x499481[_0x2fe6f3(0x27b)])+_0x2fe6f3(0x264)+parseInt(_0x4bbae0[_0x2fe6f3(0x161)])),_0x499481[_0x2fe6f3(0x27b)]=parseInt(_0x499481[_0x2fe6f3(0x27b)])-parseInt(_0x4bbae0[_0x2fe6f3(0x161)]));});}),await _0xa612fb[_0x45a59d(0x1c2)]();var _0x53ee0a=0x0;_0x4d4417[_0x45a59d(0x197)](_0x12018a=>{var _0x32ca90=_0x45a59d;(parseInt(_0x12018a[_0x32ca90(0x1ed)])<parseInt(_0x12018a['return_qty'])||parseInt(_0x12018a['stock_quantity'])<parseInt(_0x12018a[_0x32ca90(0x161)]))&&_0x53ee0a++;});if(_0x53ee0a!=0x0)return _0x40ad40[_0x45a59d(0x20e)](_0x45a59d(0x17a),_0x45a59d(0x146)),_0x164da4[_0x45a59d(0x174)](_0x45a59d(0x170));const _0x114245=new purchases_return_finished({'invoice':_0x234f26,'suppliers':_0x40ad40[_0x45a59d(0x1e2)][_0x45a59d(0x1ff)],'date':_0x7d5c29,'warehouse_name':_0x3e32b2,'return_product':_0x4d4417,'note':_0x5a2c81,'room':_0x59382e,'to_warehouse_name':_0xf1574e,'to_room':_0x4efb6a}),_0xe2f1a2=await _0x114245[_0x45a59d(0x1c2)](),_0x1f421b=await purchases_return_finished[_0x45a59d(0x1e0)]({'invoice':_0x234f26}),_0x4d9b9d=await warehouse[_0x45a59d(0x1e0)]({'name':_0xf1574e,'room':_0x4efb6a,'warehouse_category':_0x45a59d(0x21e)});_0x1f421b[_0x45a59d(0x18f)][_0x45a59d(0x197)](_0x37ed91=>{var _0x45c48e=_0x45a59d,_0x54a94a=0x0;const _0x30ee5a=_0x4d9b9d[_0x45c48e(0x203)][_0x45c48e(0x1d7)](_0x5ac567=>{var _0x189bbb=_0x45c48e;console['log'](_0x5ac567['product_name']+'=='+_0x37ed91[_0x189bbb(0x206)]+'&&'+_0x5ac567['bay']+'=='+_0x37ed91[_0x189bbb(0x1a2)]),_0x5ac567[_0x189bbb(0x206)]==_0x37ed91[_0x189bbb(0x206)]&&_0x5ac567[_0x189bbb(0x1a2)]==_0x37ed91['bay']&&(_0x5ac567[_0x189bbb(0x27b)]=parseInt(_0x5ac567['product_stock'])-parseInt(_0x37ed91[_0x189bbb(0x161)]),_0x54a94a++);});_0x54a94a=='0'&&(_0x4d9b9d['product_details']=_0x4d9b9d[_0x45c48e(0x203)][_0x45c48e(0x1fc)]({'product_name':_0x37ed91[_0x45c48e(0x206)],'product_stock':_0x37ed91['return_qty'],'primary_code':_0x37ed91['primary_code'],'secondary_code':_0x37ed91[_0x45c48e(0x180)],'product_code':_0x37ed91[_0x45c48e(0x26f)],'bay':_0x37ed91[_0x45c48e(0x1a2)],'maxProducts':0xf423f}));}),await _0x4d9b9d['save']();const _0x505000=await purchases_finished[_0x45a59d(0x1e0)]({'invoice':_0x234f26});_0x505000['return_data']=_0x45a59d(0x25c);const _0x2455d5=await _0x505000[_0x45a59d(0x1c2)](),_0x2863b1=new s_payment_data({'invoice':_0x234f26,'suppliers':_0x40ad40['body'][_0x45a59d(0x1ff)],'reason':_0x45a59d(0x183)});await _0x2863b1[_0x45a59d(0x1c2)]();const _0x29d6f=await master_shop[_0x45a59d(0x13d)](),_0xad6128=await email_settings[_0x45a59d(0x1e0)](),_0x3e1af5=await suppliers[_0x45a59d(0x1e0)]({'name':_0x40ad40['body'][_0x45a59d(0x1ff)]});_0x29d6f[0x0][_0x45a59d(0x279)]==0x1?(right_currency=_0x29d6f[0x0][_0x45a59d(0x20c)],left_currency=''):(right_currency='',left_currency=_0x29d6f[0x0][_0x45a59d(0x20c)]);var _0x314c4a=_0x29ccb8,_0x118fa4=_0x139b61,_0xded27c='',_0x374299;for(_0x374299 in _0x314c4a){_0xded27c+=_0x45a59d(0x1da)+_0x45a59d(0x202)+_0x314c4a[_0x374299]+_0x45a59d(0x220)+_0x45a59d(0x202)+_0x118fa4[_0x374299]+_0x45a59d(0x220)+_0x45a59d(0x278);}let _0x12f07f=nodemailer[_0x45a59d(0x200)]({'service':_0x45a59d(0x20b),'auth':{'user':_0xad6128[_0x45a59d(0x226)],'pass':_0xad6128[_0x45a59d(0x1bc)]}}),_0x3047c4={'from':_0xad6128[_0x45a59d(0x226)],'to':_0x3e1af5[_0x45a59d(0x226)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x45a59d(0x1ad)+'/upload/'+_0x29d6f[0x0][_0x45a59d(0x179)],'cid':_0x45a59d(0x270)}],'html':_0x45a59d(0x273)+_0x45a59d(0x1c4)+_0x45a59d(0x215)+_0x45a59d(0x15b)+_0x45a59d(0x1c5)+_0x45a59d(0x15b)+_0x45a59d(0x26b)+'</div>'+_0x45a59d(0x15b)+_0x45a59d(0x15c)+_0x29d6f[0x0][_0x45a59d(0x16e)]+_0x45a59d(0x245)+_0x45a59d(0x1c9)+_0x45a59d(0x1c9)+_0x45a59d(0x150)+_0x45a59d(0x15b)+_0x45a59d(0x268)+'\x20Order\x20Number\x20:\x20'+_0x234f26+'\x20'+_0x45a59d(0x1fa)+_0x45a59d(0x1b3)+_0x7d5c29+'\x20'+_0x45a59d(0x213)+_0x45a59d(0x24d)+'</div>'+_0x45a59d(0x1eb)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x45a59d(0x1b0)+_0x45a59d(0x1c8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x45a59d(0x17f)+_0x45a59d(0x23b)+'\x20'+_0xded27c+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x45a59d(0x1a4)+_0x45a59d(0x228)+_0x29d6f[0x0][_0x45a59d(0x16e)]+'</h5>'+'</div>'+_0x45a59d(0x1c9)+'</body></html>'};_0x12f07f[_0x45a59d(0x1ee)](_0x3047c4,function(_0x2e2001,_0xe351f8){var _0x19355a=_0x45a59d;_0x2e2001?console['log']('Error\x20Occurs'):console[_0x19355a(0x20f)](_0x19355a(0x276));}),_0x40ad40[_0x45a59d(0x20e)]('success',_0x45a59d(0x153)),_0x164da4[_0x45a59d(0x174)](_0x45a59d(0x15f));}catch(_0x26c357){_0x164da4['status'](0xc8)[_0x45a59d(0x172)]({'message':_0x26c357['message']});}}),router[a0_0x12f677(0x167)]('/barcode/:id',auth,async(_0x30f946,_0x3650ab)=>{var _0x57552a=a0_0x12f677;try{const {username:_0x10a987,email:_0x26ed31,role:_0x9c8434}=_0x30f946[_0x57552a(0x1b8)],_0xeb8909=_0x30f946[_0x57552a(0x1b8)],_0x2d638d=await profile[_0x57552a(0x1e0)]({'email':_0xeb8909[_0x57552a(0x226)]}),_0x36616b=await master_shop[_0x57552a(0x13d)](),_0x172503=_0x30f946['params']['id'],_0x38e198=await purchases_finished['findById'](_0x172503);if(_0x36616b[0x0][_0x57552a(0x1a1)]==_0x57552a(0x1bf))var _0x23c34c=users[_0x57552a(0x22c)];else{if(_0x36616b[0x0][_0x57552a(0x1a1)]=='Hindi')var _0x23c34c=users[_0x57552a(0x24b)];else{if(_0x36616b[0x0][_0x57552a(0x1a1)]=='German')var _0x23c34c=users['German'];else{if(_0x36616b[0x0]['language']==_0x57552a(0x222))var _0x23c34c=users[_0x57552a(0x222)];else{if(_0x36616b[0x0][_0x57552a(0x1a1)]==_0x57552a(0x169))var _0x23c34c=users[_0x57552a(0x169)];else{if(_0x36616b[0x0][_0x57552a(0x1a1)]=='Portuguese\x20(BR)')var _0x23c34c=users[_0x57552a(0x26d)];else{if(_0x36616b[0x0][_0x57552a(0x1a1)]==_0x57552a(0x165))var _0x23c34c=users[_0x57552a(0x165)];else{if(_0x36616b[0x0][_0x57552a(0x1a1)]==_0x57552a(0x234))var _0x23c34c=users[_0x57552a(0x27d)];}}}}}}}_0x3650ab[_0x57552a(0x27c)](_0x57552a(0x13e),{'success':_0x30f946[_0x57552a(0x20e)](_0x57552a(0x15e)),'errors':_0x30f946[_0x57552a(0x20e)]('errors'),'role':_0xeb8909,'profile':_0x2d638d,'alldata':_0x38e198,'master_shop':_0x36616b,'language':_0x23c34c}),console[_0x57552a(0x20f)](alldata);}catch(_0x17bcd9){console[_0x57552a(0x20f)](_0x17bcd9);}}),router['post']('/barcode_scanner',async(_0x188cd7,_0x517eb3)=>{var _0xda7089=a0_0x12f677;const {product_code:_0x460e3a}=_0x188cd7['body'];var _0x43bf12;const _0x246ee7=await product[_0xda7089(0x1e8)]([{'$match':{'primary_code':_0x460e3a}},{'$group':{'_id':'$_id','name':{'$first':_0xda7089(0x1ec)},'category':{'$first':_0xda7089(0x21d)},'brand':{'$first':_0xda7089(0x1d2)},'unit':{'$first':_0xda7089(0x216)},'alertquantity':{'$first':_0xda7089(0x1a5)},'product_code':{'$first':_0xda7089(0x23d)},'primary_code':{'$first':_0xda7089(0x149)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0xda7089(0x141)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0xda7089(0x1a7)},'sales_category':{'$first':_0xda7089(0x1f4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x4963dc=await product[_0xda7089(0x1e8)]([{'$match':{'secondary_code':_0x460e3a}},{'$group':{'_id':_0xda7089(0x227),'name':{'$first':'$name'},'category':{'$first':_0xda7089(0x21d)},'brand':{'$first':_0xda7089(0x1d2)},'unit':{'$first':_0xda7089(0x216)},'alertquantity':{'$first':_0xda7089(0x1a5)},'product_code':{'$first':_0xda7089(0x23d)},'primary_code':{'$first':_0xda7089(0x149)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xda7089(0x20a)},'gross_price':{'$first':_0xda7089(0x1a7)},'sales_category':{'$first':_0xda7089(0x1f4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x246ee7[_0xda7089(0x1f8)]>0x0)_0x43bf12=_0x246ee7;else _0x4963dc[_0xda7089(0x1f8)]>0x0&&(_0x43bf12=_0x4963dc);_0x517eb3[_0xda7089(0x172)](_0x43bf12);}),router[a0_0x12f677(0x1d3)](a0_0x12f677(0x1ce),async(_0x4cb849,_0x17195a)=>{var _0x2affc9=a0_0x12f677;const {productCode:_0x160884,bay:_0x4cd4fa,warehouses:_0x2e4cfb,room:_0x58127a}=_0x4cb849[_0x2affc9(0x1e2)];console[_0x2affc9(0x20f)](_0x4cb849['body']);try{const _0x397c30=await warehouse[_0x2affc9(0x1e8)]([{'$match':{'name':_0x2e4cfb,'room':_0x58127a}},{'$unwind':_0x2affc9(0x166)},{'$match':{'product_details.bay':parseInt(_0x4cd4fa)}},{'$group':{'_id':_0x2affc9(0x1e6),'name':{'$first':_0x2affc9(0x26c)},'product_stock':{'$first':_0x2affc9(0x164)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x2affc9(0x1cb)}}}]);_0x17195a['status'](0xc8)[_0x2affc9(0x172)](_0x397c30);}catch(_0x54a59c){_0x17195a[_0x2affc9(0x280)](0x194)['json']({'message':_0x54a59c[_0x2affc9(0x23c)]});}}),router[a0_0x12f677(0x1d3)]('/barcode_scanner_logs',async(_0x3ceb52,_0x12213a)=>{var _0x22870f=a0_0x12f677;const {product_code:_0x276358}=_0x3ceb52[_0x22870f(0x1e2)];var _0x10c5fd;const _0x2f43c2=await product['aggregate']([{'$match':{'primary_code':_0x276358,'type_products':_0x22870f(0x20f)}},{'$group':{'_id':_0x22870f(0x227),'name':{'$first':_0x22870f(0x1ec)},'category':{'$first':'$category'},'brand':{'$first':_0x22870f(0x1d2)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x22870f(0x1a5)},'product_code':{'$first':_0x22870f(0x23d)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x22870f(0x26a)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x22870f(0x141)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x22870f(0x20a)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x22870f(0x1f4)},'type_products':{'$first':_0x22870f(0x188)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x22870f(0x20f)](_0x2f43c2);const _0x29df96=await product[_0x22870f(0x1e8)]([{'$match':{'secondary_code':_0x276358,'type_products':_0x22870f(0x20f)}},{'$group':{'_id':_0x22870f(0x227),'name':{'$first':_0x22870f(0x1ec)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x22870f(0x216)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x22870f(0x23d)},'primary_code':{'$first':_0x22870f(0x149)},'secondary_code':{'$first':_0x22870f(0x26a)},'maxStocks':{'$first':_0x22870f(0x19b)},'maxProdPerUnit':{'$first':_0x22870f(0x141)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x22870f(0x20a)},'gross_price':{'$first':_0x22870f(0x1a7)},'sales_category':{'$first':_0x22870f(0x1f4)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x2f43c2['length']>0x0)_0x10c5fd=_0x2f43c2;else _0x29df96['length']>0x0&&(_0x10c5fd=_0x29df96);_0x12213a[_0x22870f(0x172)](_0x10c5fd);}),module[a0_0x12f677(0x186)]=router;