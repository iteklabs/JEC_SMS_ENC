var a0_0x1d8bef=a0_0x3086;(function(_0x376f6a,_0x3f048e){var _0x4e6510=a0_0x3086,_0x15d078=_0x376f6a();while(!![]){try{var _0x27c82a=parseInt(_0x4e6510(0x105))/0x1*(parseInt(_0x4e6510(0x16d))/0x2)+parseInt(_0x4e6510(0x22b))/0x3+-parseInt(_0x4e6510(0x18d))/0x4*(-parseInt(_0x4e6510(0x11e))/0x5)+-parseInt(_0x4e6510(0x151))/0x6+parseInt(_0x4e6510(0x223))/0x7*(parseInt(_0x4e6510(0x15c))/0x8)+parseInt(_0x4e6510(0x1dd))/0x9*(parseInt(_0x4e6510(0x1df))/0xa)+parseInt(_0x4e6510(0x1ab))/0xb*(-parseInt(_0x4e6510(0x1e0))/0xc);if(_0x27c82a===_0x3f048e)break;else _0x15d078['push'](_0x15d078['shift']());}catch(_0x1a7433){_0x15d078['push'](_0x15d078['shift']());}}}(a0_0x194e,0x748ec));const express=require(a0_0x1d8bef(0x1f1)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x1d8bef(0x207)),auth=require(a0_0x1d8bef(0x12e)),nodemailer=require(a0_0x1d8bef(0x17d));var ejs=require('ejs');const path=require(a0_0x1d8bef(0x114)),users=require(a0_0x1d8bef(0x126)),{isNull}=require('util');router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0x1a9),auth,async(_0x4644a6,_0x5ad3e9)=>{var _0x2ad86f=a0_0x1d8bef;try{const {username:_0xeec75,email:_0x31097a,role:_0xce5d1d}=_0x4644a6[_0x2ad86f(0x19b)],_0x19794e=_0x4644a6[_0x2ad86f(0x19b)],_0x3f2d57=await profile[_0x2ad86f(0x1b7)]({'email':_0x19794e[_0x2ad86f(0x12b)]}),_0x5946ab=await staff[_0x2ad86f(0x1b7)]({'email':_0x19794e[_0x2ad86f(0x12b)]}),_0x15f784=await master_shop[_0x2ad86f(0x1ac)]();let _0x32dc6e=await transfers_finished[_0x2ad86f(0x21a)]([{'$match':{'to_warehouse':_0x5946ab[_0x2ad86f(0x118)]}}]);if(_0x15f784[0x0][_0x2ad86f(0xfa)]=='English\x20(US)')var _0x298c04=users['English'];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]==_0x2ad86f(0x120))var _0x298c04=users[_0x2ad86f(0x120)];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]==_0x2ad86f(0x213))var _0x298c04=users[_0x2ad86f(0x213)];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]==_0x2ad86f(0xff))var _0x298c04=users[_0x2ad86f(0xff)];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]==_0x2ad86f(0x224))var _0x298c04=users[_0x2ad86f(0x224)];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]=='Portuguese\x20(BR)')var _0x298c04=users[_0x2ad86f(0x14c)];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]==_0x2ad86f(0x214))var _0x298c04=users[_0x2ad86f(0x214)];else{if(_0x15f784[0x0][_0x2ad86f(0xfa)]==_0x2ad86f(0x17a))var _0x298c04=users[_0x2ad86f(0x175)];}}}}}}}_0x5ad3e9[_0x2ad86f(0x165)](_0x2ad86f(0x13a),{'success':_0x4644a6[_0x2ad86f(0xf3)](_0x2ad86f(0x1f3)),'errors':_0x4644a6[_0x2ad86f(0xf3)](_0x2ad86f(0x1cc)),'purchases':_0x32dc6e,'role':_0x19794e,'profile':_0x3f2d57,'master_shop':_0x15f784,'language':_0x298c04,'staff_data':_0x5946ab});}catch(_0x523cc2){console[_0x2ad86f(0x1cf)]('table\x20page',_0x523cc2),_0x5ad3e9[_0x2ad86f(0x1dc)](0xc8)[_0x2ad86f(0xf5)]({'message':_0x523cc2[_0x2ad86f(0x10f)]});}}),router[a0_0x1d8bef(0x158)]('/incoming/add',auth,async(_0x14e36d,_0x5b44fb)=>{var _0x4f4fc5=a0_0x1d8bef;try{const {username:_0x38a5ec,email:_0x5e54d3,role:_0x450ec1}=_0x14e36d[_0x4f4fc5(0x19b)],_0x2835e5=_0x14e36d[_0x4f4fc5(0x19b)],_0xef9b4d=await profile['findOne']({'email':_0x2835e5[_0x4f4fc5(0x12b)]}),_0x155b1e=await staff[_0x4f4fc5(0x1b7)]({'email':_0x2835e5[_0x4f4fc5(0x12b)]}),_0x589898=await master_shop[_0x4f4fc5(0x1ac)]();let _0x436a3e=await transfers_finished[_0x4f4fc5(0x21a)]([{'$match':{'to_warehouse':_0x155b1e[_0x4f4fc5(0x118)],'to_recieved':'false'}}]);if(_0x589898[0x0]['language']==_0x4f4fc5(0x1f8))var _0x2d7d7d=users[_0x4f4fc5(0x209)];else{if(_0x589898[0x0][_0x4f4fc5(0xfa)]==_0x4f4fc5(0x120))var _0x2d7d7d=users[_0x4f4fc5(0x120)];else{if(_0x589898[0x0][_0x4f4fc5(0xfa)]==_0x4f4fc5(0x213))var _0x2d7d7d=users[_0x4f4fc5(0x213)];else{if(_0x589898[0x0]['language']==_0x4f4fc5(0xff))var _0x2d7d7d=users[_0x4f4fc5(0xff)];else{if(_0x589898[0x0][_0x4f4fc5(0xfa)]==_0x4f4fc5(0x224))var _0x2d7d7d=users[_0x4f4fc5(0x224)];else{if(_0x589898[0x0][_0x4f4fc5(0xfa)]=='Portuguese\x20(BR)')var _0x2d7d7d=users[_0x4f4fc5(0x14c)];else{if(_0x589898[0x0][_0x4f4fc5(0xfa)]=='Chinese')var _0x2d7d7d=users[_0x4f4fc5(0x214)];else{if(_0x589898[0x0][_0x4f4fc5(0xfa)]==_0x4f4fc5(0x17a))var _0x2d7d7d=users[_0x4f4fc5(0x175)];}}}}}}}_0x5b44fb['render']('incoming_add',{'success':_0x14e36d['flash'](_0x4f4fc5(0x1f3)),'errors':_0x14e36d[_0x4f4fc5(0xf3)]('errors'),'purchases':_0x436a3e,'role':_0x2835e5,'profile':_0xef9b4d,'master_shop':_0x589898,'language':_0x2d7d7d,'staff_data':_0x155b1e});}catch(_0x480da0){console[_0x4f4fc5(0x1cf)](_0x4f4fc5(0x1b6),_0x480da0),_0x5b44fb[_0x4f4fc5(0x1dc)](0xc8)[_0x4f4fc5(0xf5)]({'message':_0x480da0[_0x4f4fc5(0x10f)]});}});const createLog=async _0x47b969=>{var _0x14a583=a0_0x1d8bef;const _0x1626c5=new datalogs({'location':_0x47b969});return await _0x1626c5[_0x14a583(0x1d0)](),_0x1626c5['invoice_init'];};router['post'](a0_0x1d8bef(0x131),auth,async(_0x27a388,_0x1ebb36)=>{var _0x3c18aa=a0_0x1d8bef;try{const {invoice_trf_data:_0x313a5f,item_code:_0x5b5d9c,SCRN:_0x1595f8,ReqBy:_0x3ab731,type_of_products:_0x28547d,dateofreq:_0x56d18b,PO_number:_0x147827,date:_0x14dbbc,warehouse_name:_0x121b7c,typeservicesData:_0x44f7dc,typevehicle:_0x5803e2,driver:_0x4ec10a,plate:_0x395f5b,van:_0x5e06c2,DRSI:_0xee7fc6,TSU:_0x50d425,TFU:_0x6ee038,note:_0x5830f1}=_0x27a388['body'],_0x360485=await transfers_finished[_0x3c18aa(0x1be)](_0x313a5f);if(typeof _0x5b5d9c==_0x3c18aa(0x167))var _0x5a7c45=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x1bb)]],_0x3dfe81=[_0x27a388['body']['item_code']],_0x596c45=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x15d)]],_0x32532f=[_0x27a388[_0x3c18aa(0x230)]['unit']],_0x5b7d59=[_0x27a388['body'][_0x3c18aa(0x1ea)]],_0x2ba6d7=[_0x27a388['body']['bin']],_0x50492b=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x11c)]],_0x285257=[_0x27a388[_0x3c18aa(0x230)]['secondary_code']],_0x1097f1=[_0x27a388[_0x3c18aa(0x230)]['batch_code']],_0x43317f=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x19d)]],_0x549c1=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x1f4)]],_0x376fcf=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x208)]],_0x5021e8=[_0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x21f)]];else var _0x5a7c45=[..._0x27a388[_0x3c18aa(0x230)]['product_name']],_0x3dfe81=[..._0x27a388['body'][_0x3c18aa(0xf9)]],_0x596c45=[..._0x27a388['body'][_0x3c18aa(0x15d)]],_0x32532f=[..._0x27a388[_0x3c18aa(0x230)]['unit']],_0x5b7d59=[..._0x27a388[_0x3c18aa(0x230)]['prod_secondunit']],_0x2ba6d7=[..._0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x153)]],_0x50492b=[..._0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x11c)]],_0x285257=[..._0x27a388['body'][_0x3c18aa(0x18c)]],_0x1097f1=[..._0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x21e)]],_0x43317f=[..._0x27a388['body'][_0x3c18aa(0x19d)]],_0x549c1=[..._0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x1f4)]],_0x376fcf=[..._0x27a388[_0x3c18aa(0x230)][_0x3c18aa(0x208)]],_0x5021e8=[..._0x27a388['body']['room']];const _0x283f74=_0x5a7c45[_0x3c18aa(0x1d5)](_0x118890=>{return _0x118890={'product_name':_0x118890};});_0x3dfe81['forEach']((_0x258f67,_0x2ebbab)=>{var _0x244134=_0x3c18aa;_0x283f74[_0x2ebbab][_0x244134(0x198)]=_0x258f67;}),_0x596c45[_0x3c18aa(0x199)]((_0x2a52a6,_0x5b6cae)=>{var _0x48394b=_0x3c18aa;_0x283f74[_0x5b6cae][_0x48394b(0x200)]=Math[_0x48394b(0x1ed)](_0x2a52a6);}),_0x32532f[_0x3c18aa(0x199)]((_0x5570ab,_0x1c46b3)=>{var _0x32e96a=_0x3c18aa;_0x283f74[_0x1c46b3][_0x32e96a(0x109)]=_0x5570ab;}),_0x5b7d59[_0x3c18aa(0x199)]((_0x3ff3ee,_0x28bcda)=>{var _0x2dfdce=_0x3c18aa;_0x283f74[_0x28bcda][_0x2dfdce(0x1aa)]=_0x3ff3ee;}),_0x2ba6d7[_0x3c18aa(0x199)]((_0x4f356c,_0x380f7f)=>{var _0x165784=_0x3c18aa,_0xdc8fa1=_0x4f356c[_0x165784(0x1e8)](/[A-Za-z]+/)[0x0],_0x471289=parseInt(_0x4f356c[_0x165784(0x1e8)](/\d+/)[0x0]);_0x283f74[_0x380f7f][_0x165784(0x1e4)]=_0xdc8fa1,_0x283f74[_0x380f7f]['bay']=_0x471289;}),_0x50492b['forEach']((_0x4c7dd2,_0x59f4a1)=>{_0x283f74[_0x59f4a1]['primary_code']=_0x4c7dd2;}),_0x285257[_0x3c18aa(0x199)]((_0x2341eb,_0x11ad4b)=>{var _0x202f51=_0x3c18aa;_0x283f74[_0x11ad4b][_0x202f51(0x18c)]=_0x2341eb;}),_0x1097f1[_0x3c18aa(0x199)]((_0x354605,_0x29fd41)=>{var _0x583f29=_0x3c18aa;_0x283f74[_0x29fd41][_0x583f29(0x21e)]=_0x354605;}),_0x43317f[_0x3c18aa(0x199)]((_0x1a7afc,_0x5b6080)=>{_0x283f74[_0x5b6080]['expiry_date']=_0x1a7afc;}),_0x549c1['forEach']((_0x3c40a7,_0x1c1354)=>{var _0x3f6c1f=_0x3c18aa;_0x283f74[_0x1c1354][_0x3f6c1f(0x1f4)]=_0x3c40a7;}),_0x376fcf['forEach']((_0x55130c,_0x4b311d)=>{var _0x205b51=_0x3c18aa;_0x283f74[_0x4b311d][_0x205b51(0x1a8)]=_0x55130c;}),_0x5021e8[_0x3c18aa(0x199)]((_0x4c6549,_0x1c2ef1)=>{var _0x1265a3=_0x3c18aa;_0x283f74[_0x1c2ef1][_0x1265a3(0x189)]=_0x4c6549;});const _0x22ae19=await createLog('INC');_0x5021e8[_0x3c18aa(0x199)]((_0x2b9c5e,_0xfe4bc2)=>{var _0x5118df=_0x3c18aa;_0x283f74[_0xfe4bc2]['invoice']=_0x5118df(0x1ad)+_0x22ae19[_0x5118df(0x180)]()[_0x5118df(0x21d)](0x8,'0');});const _0x4db48e=_0x283f74[_0x3c18aa(0x204)](_0x3f8c29=>_0x3f8c29[_0x3c18aa(0x200)]!=='0'&&_0x3f8c29[_0x3c18aa(0x200)]!==''),_0x1ba8a8=new purchases_incoming({'invoice':'INC-'+_0x22ae19[_0x3c18aa(0x180)]()[_0x3c18aa(0x21d)](0x8,'0'),'date':_0x14dbbc,'warehouse_name':_0x121b7c,'product':_0x4db48e,'note':_0x5830f1,'POnumber':_0x147827,'SCRN':_0x1595f8,'ReqBy':_0x3ab731,'dateofreq':_0x56d18b,'typeservicesData':_0x44f7dc,'van':_0x5e06c2,'typevehicle':_0x5803e2,'driver':_0x4ec10a,'plate':_0x395f5b,'DRSI':_0xee7fc6,'TSU':_0x50d425,'TFU':_0x6ee038,'typeOfProducts':_0x28547d}),_0x533327=await _0x1ba8a8[_0x3c18aa(0x1d0)](),_0xaa2fa0=_0x533327[_0x3c18aa(0x170)][_0x3c18aa(0x1d5)](async _0x414110=>{var _0x354226=_0x3c18aa,_0x216881=await warehouse[_0x354226(0x1b7)]({'name':_0x121b7c,'room':_0x414110[_0x354226(0x189)]});if(_0x414110[_0x354226(0x200)]>0x0){var _0x393610=0x0;const _0x4fd7ab=_0x216881['product_details'][_0x354226(0x1d5)](_0x33dadd=>{var _0xeff53f=_0x354226;_0x33dadd['product_name']==_0x414110[_0xeff53f(0x1bb)]&&_0x33dadd['bay']==_0x414110[_0xeff53f(0x142)]&&_0x33dadd[_0xeff53f(0x19d)]==_0x414110[_0xeff53f(0x19d)]&&_0x33dadd['production_date']==_0x414110[_0xeff53f(0x1f4)]&&_0x33dadd[_0xeff53f(0x21e)]==_0x414110[_0xeff53f(0x21e)]&&_0x33dadd['invoice']==_0x414110[_0xeff53f(0x173)]&&(typeof _0x414110['id_transaction']=='undefined'?(console['log']('here2',_0x33dadd['product_stock']+_0xeff53f(0x117)+_0x33dadd[_0xeff53f(0x129)]+_0xeff53f(0x220)+Math['abs'](_0x33dadd['product_stock'])+Math[_0xeff53f(0x1ed)](_0x414110[_0xeff53f(0x15d)])),_0x33dadd['product_stock']=Math[_0xeff53f(0x1ed)](_0x33dadd['product_stock'])+Math[_0xeff53f(0x1ed)](_0x414110['quantity'])):(_0x33dadd[_0xeff53f(0x19e)]=Math[_0xeff53f(0x1ed)](_0x33dadd[_0xeff53f(0x19e)])+Math[_0xeff53f(0x1ed)](_0x414110['quantity']),_0x393610++));});_0x393610=='0'&&(_0x216881['product_details']=_0x216881[_0x354226(0x188)][_0x354226(0x171)]({'product_name':_0x414110[_0x354226(0x1bb)],'product_stock':_0x414110[_0x354226(0x200)],'bay':_0x414110[_0x354226(0x218)],'level':_0x414110[_0x354226(0x1e4)],'product_code':_0x414110[_0x354226(0x198)],'primary_code':_0x414110[_0x354226(0x11c)],'secondary_code':_0x414110[_0x354226(0x18c)],'expiry_date':_0x414110[_0x354226(0x19d)],'production_date':_0x414110[_0x354226(0x1f4)],'maxProducts':_0x414110[_0x354226(0x164)],'batch_code':_0x414110[_0x354226(0x21e)],'secondary_unit':_0x414110[_0x354226(0x1aa)],'unit':_0x414110['standard_unit'],'maxProducts':_0x414110[_0x354226(0x164)],'maxPerUnit':_0x414110[_0x354226(0x14f)],'invoice':_0x414110[_0x354226(0x173)]}));}return _0x216881;});Promise['all'](_0xaa2fa0)['then'](async _0x53897d=>{var _0x5dd1d1=_0x3c18aa;try{for(const _0x4d0a43 of _0x53897d){await warehouse[_0x5dd1d1(0x19c)]({'_id':_0x4d0a43[_0x5dd1d1(0x129)]},{'$addToSet':{'product_details':{'$each':_0x4d0a43[_0x5dd1d1(0x188)]}}});}_0x360485[_0x5dd1d1(0x194)]=_0x5dd1d1(0x20e);const _0x36c5b0=await _0x360485[_0x5dd1d1(0x1d0)](),_0x1c0d9a=await master_shop['find'](),_0x2dea14=await email_settings[_0x5dd1d1(0x1b7)](),_0x38857b=await supervisor_settings[_0x5dd1d1(0x1ac)]();var _0xf6f2cc=_0x1ba8a8[_0x5dd1d1(0x170)],_0x3c5d35='',_0x4bc8b5;for(_0x4bc8b5 in _0xf6f2cc){var _0x57721e='FG';_0x1ba8a8[_0x5dd1d1(0x1cd)]==_0x5dd1d1(0x174)&&(_0x57721e='DG'),_0x3c5d35+=_0x5dd1d1(0x228)+_0x5dd1d1(0x1f0)+_0xf6f2cc[_0x4bc8b5][_0x5dd1d1(0x1bb)]+_0x5dd1d1(0x22c)+_0x5dd1d1(0x1f0)+_0xf6f2cc[_0x4bc8b5][_0x5dd1d1(0x198)]+'</td>'+_0x5dd1d1(0x1f0)+_0xf6f2cc[_0x4bc8b5]['to_quantity']+_0x5dd1d1(0x22c)+_0x5dd1d1(0x1f0)+_0xf6f2cc[_0x4bc8b5][_0x5dd1d1(0x1c5)]+'</td>'+_0x5dd1d1(0x1f0)+_0xf6f2cc[_0x4bc8b5][_0x5dd1d1(0x1aa)]+'</td>'+_0x5dd1d1(0x1f0)+_0x1ba8a8[_0x5dd1d1(0x1cd)]+'</td>'+_0x5dd1d1(0x1f0)+_0xf6f2cc[_0x4bc8b5]['to_room_name']+_0x5dd1d1(0x22c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57721e+_0xf6f2cc[_0x4bc8b5][_0x5dd1d1(0x142)]+_0x5dd1d1(0x22c)+_0x5dd1d1(0x1ce);}_0x27a388[_0x5dd1d1(0xf3)](_0x5dd1d1(0x1f3),_0x5dd1d1(0x102)),_0x1ebb36[_0x5dd1d1(0x21b)](_0x5dd1d1(0x14e)+_0x533327[_0x5dd1d1(0x129)]);}catch(_0x1169e3){console[_0x5dd1d1(0x113)](_0x1169e3),_0x1ebb36[_0x5dd1d1(0x1dc)](0x1f4)[_0x5dd1d1(0xf5)]({'error':_0x5dd1d1(0x177)});}})[_0x3c18aa(0x225)](_0x18a1e1=>{var _0x2abbc9=_0x3c18aa;console[_0x2abbc9(0x113)](_0x18a1e1),_0x1ebb36[_0x2abbc9(0x1dc)](0x1f4)[_0x2abbc9(0xf5)]({'error':_0x2abbc9(0x172)});});}catch(_0x3780fe){}}),router['post'](a0_0x1d8bef(0x187),auth,async(_0x30262a,_0x4c0e5a)=>{var _0x1a50d3=a0_0x1d8bef;try{const {warehouse:_0x3d6b91}=_0x30262a[_0x1a50d3(0x230)],_0x396106=await transfers_finished[_0x1a50d3(0x1ac)]({'to_warehouse':_0x3d6b91,'to_recieved':_0x1a50d3(0xf7)});_0x4c0e5a[_0x1a50d3(0xf5)](_0x396106);}catch(_0x12424e){}}),router[a0_0x1d8bef(0x134)]('/getinvoicetrf',auth,async(_0x24e521,_0x108e26)=>{var _0x2c8cf2=a0_0x1d8bef;try{const {invoice:_0x576e03}=_0x24e521[_0x2c8cf2(0x230)],_0xa098dc=await transfers_finished[_0x2c8cf2(0x1ac)]({'_id':_0x576e03,'to_recieved':_0x2c8cf2(0xf7)});_0x108e26[_0x2c8cf2(0xf5)](_0xa098dc);}catch(_0x429be3){}}),router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0x136),auth,async(_0x4c424e,_0x594a52)=>{var _0x20e05d=a0_0x1d8bef;try{const {username:_0x2d7b01,email:_0x4d6d00,role:_0x1db4b0}=_0x4c424e[_0x20e05d(0x19b)],_0x209812=_0x4c424e[_0x20e05d(0x19b)],_0x14a43f=await profile['findOne']({'email':_0x209812[_0x20e05d(0x12b)]}),_0xefbead=await staff[_0x20e05d(0x1b7)]({'email':_0x209812[_0x20e05d(0x12b)]});if(_0x209812['role']==_0x20e05d(0x125)){const _0xcc99f4=await staff['findOne']({'email':_0x209812[_0x20e05d(0x12b)]});}const _0x32114d=await master_shop[_0x20e05d(0x1ac)]();let _0x2a4506;if(_0x209812['role']==_0x20e05d(0x125)){const _0x3af4c1=await staff[_0x20e05d(0x1b7)]({'email':_0x209812[_0x20e05d(0x12b)]});_0x2a4506=await purchases_finished[_0x20e05d(0x21a)]([{'$match':{'warehouse_name':_0x3af4c1['warehouse'],'typeOfProducts':_0x20e05d(0xf0)}},{'$lookup':{'from':'suppliers','localField':_0x20e05d(0x15a),'foreignField':_0x20e05d(0x1d4),'as':_0x20e05d(0x1a1)}},{'$unwind':_0x20e05d(0x182)},{'$unwind':'$product'},{'$group':{'_id':_0x20e05d(0x1c1),'invoice':{'$first':_0x20e05d(0x144)},'suppliers':{'$first':_0x20e05d(0x10b)},'date':{'$first':_0x20e05d(0x123)},'warehouse_name':{'$first':_0x20e05d(0x1fb)},'room':{'$first':_0x20e05d(0x15e)},'product':{'$push':_0x20e05d(0x104)},'note':{'$first':_0x20e05d(0x1f2)},'paid_amount':{'$first':_0x20e05d(0x132)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x20e05d(0x139)},'batch_code':{'$first':_0x20e05d(0x1ef)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x20e05d(0x182)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x20e05d(0x1bf)},'type':{'$addToSet':_0x20e05d(0x1d3)},'floorlevel':{'$addToSet':_0x20e05d(0x191)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2a4506=await purchases_finished[_0x20e05d(0x21a)]([{'$match':{'typeOfProducts':_0x20e05d(0xf0)}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x20e05d(0x10b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x20e05d(0x1fb)},'room':{'$addToSet':_0x20e05d(0x12f)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x20e05d(0x132)},'due_amount':{'$first':_0x20e05d(0x159)},'return_data':{'$first':_0x20e05d(0x139)},'batch_code':{'$first':_0x20e05d(0x1ef)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x20e05d(0x182)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x20e05d(0x215)},'isle':{'$addToSet':_0x20e05d(0x1bf)},'type':{'$addToSet':_0x20e05d(0x1d3)},'floorlevel':{'$addToSet':_0x20e05d(0x191)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x32114d[0x0][_0x20e05d(0xfa)]=='English\x20(US)')var _0xff1cce=users[_0x20e05d(0x209)];else{if(_0x32114d[0x0][_0x20e05d(0xfa)]=='Hindi')var _0xff1cce=users[_0x20e05d(0x120)];else{if(_0x32114d[0x0]['language']=='German')var _0xff1cce=users['German'];else{if(_0x32114d[0x0][_0x20e05d(0xfa)]==_0x20e05d(0xff))var _0xff1cce=users['Spanish'];else{if(_0x32114d[0x0][_0x20e05d(0xfa)]==_0x20e05d(0x224))var _0xff1cce=users['French'];else{if(_0x32114d[0x0][_0x20e05d(0xfa)]==_0x20e05d(0x178))var _0xff1cce=users[_0x20e05d(0x14c)];else{if(_0x32114d[0x0][_0x20e05d(0xfa)]==_0x20e05d(0x214))var _0xff1cce=users[_0x20e05d(0x214)];else{if(_0x32114d[0x0][_0x20e05d(0xfa)]=='Arabic\x20(ae)')var _0xff1cce=users[_0x20e05d(0x175)];}}}}}}}_0x594a52['render'](_0x20e05d(0x15b),{'success':_0x4c424e[_0x20e05d(0xf3)]('success'),'errors':_0x4c424e[_0x20e05d(0xf3)](_0x20e05d(0x1cc)),'purchases':_0x2a4506,'role':_0x209812,'profile':_0x14a43f,'master_shop':_0x32114d,'language':_0xff1cce});}catch(_0x2b84df){console['log'](_0x20e05d(0x1b6),_0x2b84df),_0x594a52[_0x20e05d(0x1dc)](0xc8)['json']({'message':_0x2b84df[_0x20e05d(0x10f)]});}}),router['get']('/view_log',auth,async(_0xec6a4d,_0x58d1c8)=>{var _0xa92f84=a0_0x1d8bef;try{const {username:_0x29cb5f,email:_0xbe149e,role:_0xf9d9be}=_0xec6a4d['user'],_0x3856d5=_0xec6a4d[_0xa92f84(0x19b)],_0xc18cbd=await profile[_0xa92f84(0x1b7)]({'email':_0x3856d5['email']}),_0x2a8f9d=await staff[_0xa92f84(0x1b7)]({'email':_0x3856d5[_0xa92f84(0x12b)]});if(_0x3856d5['role']==_0xa92f84(0x125)){const _0x369e06=await staff[_0xa92f84(0x1b7)]({'email':_0x3856d5[_0xa92f84(0x12b)]});}const _0x10a8c0=await master_shop['find']();let _0x5476f0;if(_0x3856d5[_0xa92f84(0x1af)]==_0xa92f84(0x125)){const _0xe0656e=await staff[_0xa92f84(0x1b7)]({'email':_0x3856d5[_0xa92f84(0x12b)]});_0x5476f0=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0xe0656e[_0xa92f84(0x118)]}},{'$lookup':{'from':_0xa92f84(0x15a),'localField':'suppliers','foreignField':'name','as':_0xa92f84(0x1a1)}},{'$unwind':_0xa92f84(0x182)},{'$unwind':_0xa92f84(0x104)},{'$group':{'_id':_0xa92f84(0x1c1),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xa92f84(0x10b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xa92f84(0x1fb)},'room':{'$first':'$room'},'product':{'$push':_0xa92f84(0x104)},'note':{'$first':'$note'},'paid_amount':{'$first':_0xa92f84(0x132)},'due_amount':{'$first':_0xa92f84(0x159)},'return_data':{'$first':_0xa92f84(0x139)},'batch_code':{'$first':_0xa92f84(0x1ef)},'expiry_date':{'$first':_0xa92f84(0x128)},'suppliers_docs':{'$first':_0xa92f84(0x182)},'total_product_quantity':{'$sum':_0xa92f84(0x1a3)},'level':{'$addToSet':_0xa92f84(0x215)},'isle':{'$addToSet':_0xa92f84(0x1bf)},'type':{'$addToSet':_0xa92f84(0x1d3)},'floorlevel':{'$addToSet':_0xa92f84(0x191)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5476f0=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0xa92f84(0x104)},{'$group':{'_id':_0xa92f84(0x1c1),'invoice':{'$first':_0xa92f84(0x144)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xa92f84(0x1fb)},'room':{'$addToSet':_0xa92f84(0x12f)},'product':{'$push':_0xa92f84(0x104)},'note':{'$first':_0xa92f84(0x1f2)},'paid_amount':{'$first':_0xa92f84(0x132)},'due_amount':{'$first':_0xa92f84(0x159)},'return_data':{'$first':_0xa92f84(0x139)},'batch_code':{'$first':_0xa92f84(0x1ef)},'expiry_date':{'$first':_0xa92f84(0x128)},'suppliers_docs':{'$first':_0xa92f84(0x182)},'total_product_quantity':{'$sum':_0xa92f84(0x1a3)},'level':{'$addToSet':_0xa92f84(0x215)},'isle':{'$addToSet':_0xa92f84(0x1bf)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xa92f84(0x191)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x10a8c0[0x0][_0xa92f84(0xfa)]==_0xa92f84(0x1f8))var _0x277346=users['English'];else{if(_0x10a8c0[0x0]['language']==_0xa92f84(0x120))var _0x277346=users[_0xa92f84(0x120)];else{if(_0x10a8c0[0x0][_0xa92f84(0xfa)]=='German')var _0x277346=users[_0xa92f84(0x213)];else{if(_0x10a8c0[0x0][_0xa92f84(0xfa)]==_0xa92f84(0xff))var _0x277346=users[_0xa92f84(0xff)];else{if(_0x10a8c0[0x0]['language']==_0xa92f84(0x224))var _0x277346=users[_0xa92f84(0x224)];else{if(_0x10a8c0[0x0][_0xa92f84(0xfa)]==_0xa92f84(0x178))var _0x277346=users['Portuguese'];else{if(_0x10a8c0[0x0]['language']==_0xa92f84(0x214))var _0x277346=users[_0xa92f84(0x214)];else{if(_0x10a8c0[0x0][_0xa92f84(0xfa)]==_0xa92f84(0x17a))var _0x277346=users[_0xa92f84(0x175)];}}}}}}}_0x58d1c8[_0xa92f84(0x165)](_0xa92f84(0x121),{'success':_0xec6a4d['flash'](_0xa92f84(0x1f3)),'errors':_0xec6a4d[_0xa92f84(0xf3)](_0xa92f84(0x1cc)),'purchases':_0x5476f0,'role':_0x3856d5,'profile':_0xc18cbd,'master_shop':_0x10a8c0,'language':_0x277346});}catch(_0x369ed8){console[_0xa92f84(0x1cf)](_0xa92f84(0x1b6),_0x369ed8),_0x58d1c8[_0xa92f84(0x1dc)](0xc8)['json']({'message':_0x369ed8[_0xa92f84(0x10f)]});}});function a0_0x3086(_0x12ba6f,_0x8f0da8){var _0x194e30=a0_0x194e();return a0_0x3086=function(_0x308684,_0x4f0580){_0x308684=_0x308684-0xee;var _0x26113e=_0x194e30[_0x308684];return _0x26113e;},a0_0x3086(_0x12ba6f,_0x8f0da8);}function BayBinSelected(_0x546b66,_0x2aeca6){var _0x3b9268=a0_0x1d8bef,_0x5b5035=[],_0x12391b=[];if(_0x546b66==_0x3b9268(0x174)){switch(_0x2aeca6){case _0x3b9268(0x122):_0x5b5035=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x3b9268(0x110):_0x5b5035=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x12391b=['DG'];}else{if(_0x546b66==_0x3b9268(0x1eb)){switch(_0x2aeca6){case _0x3b9268(0x122):_0x5b5035=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x3b9268(0x110):_0x5b5035=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x12391b=['FG'];}}return{'levels':_0x5b5035,'identify':_0x12391b};}async function getRandom8DigitNumber(){var _0x4ffa33=a0_0x1d8bef;const _0x8fd464=0x989680,_0x549a87=0x5f5e0ff,_0xf566f1=Math['floor'](Math[_0x4ffa33(0x193)]()*(_0x549a87-_0x8fd464+0x1))+_0x8fd464;var _0x42d02b;const _0x30e689=await purchases_finished['findOne']({'invoice':_0x4ffa33(0x130)+_0xf566f1});return _0x30e689&&_0x30e689[_0x4ffa33(0x13b)]>0x0?_0x42d02b='INCF-'+_0xf566f1:_0x42d02b=_0x4ffa33(0x130)+_0xf566f1,_0x42d02b;}router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0x111),auth,async(_0x47ec52,_0x2e795f)=>{var _0x322c8f=a0_0x1d8bef;try{const {username:_0x5ce328,email:_0x2d25af,role:_0x4eefaa}=_0x47ec52[_0x322c8f(0x19b)],_0x2c84ac=_0x47ec52[_0x322c8f(0x19b)],_0x353954=await profile[_0x322c8f(0x1b7)]({'email':_0x2c84ac['email']}),_0x6472a8=await master_shop[_0x322c8f(0x1ac)](),_0x22ab02=await staff[_0x322c8f(0x1b7)]({'email':_0x2c84ac['email']}),_0x4b4962=await suppliers[_0x322c8f(0x1ac)]({});let _0x3c5aef;if(_0x2c84ac[_0x322c8f(0x1af)]==_0x322c8f(0x125)){const _0x154cd1=await staff[_0x322c8f(0x1b7)]({'email':_0x2c84ac[_0x322c8f(0x12b)]});_0x3c5aef=await warehouse[_0x322c8f(0x21a)]([{'$match':{'status':_0x322c8f(0x1ff),'name':_0x154cd1['warehouse']}},{'$group':{'_id':_0x322c8f(0x1e9),'name':{'$first':_0x322c8f(0x1e9)}}}]);}else _0x3c5aef=await warehouse[_0x322c8f(0x21a)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x322c8f(0x1e9),'name':{'$first':'$name'}}}]);const _0x137390=await product[_0x322c8f(0x1ac)]({}),_0x4faac1=await warehouse[_0x322c8f(0x1ac)]({'status':_0x322c8f(0x1ff)}),_0x34a193=await purchases_finished[_0x322c8f(0x1ac)]({}),_0x2f2cd5=_0x34a193['length']+0x1,_0x51dcb1=_0x322c8f(0x130)+_0x2f2cd5[_0x322c8f(0x180)]()[_0x322c8f(0x21d)](0x5,'0');var _0x595b4c=[_0x322c8f(0xf2),_0x322c8f(0x15f)];if(_0x6472a8[0x0]['language']==_0x322c8f(0x1f8))var _0x3d8735=users['English'];else{if(_0x6472a8[0x0][_0x322c8f(0xfa)]==_0x322c8f(0x120))var _0x3d8735=users[_0x322c8f(0x120)];else{if(_0x6472a8[0x0][_0x322c8f(0xfa)]==_0x322c8f(0x213))var _0x3d8735=users[_0x322c8f(0x213)];else{if(_0x6472a8[0x0][_0x322c8f(0xfa)]=='Spanish')var _0x3d8735=users[_0x322c8f(0xff)];else{if(_0x6472a8[0x0]['language']==_0x322c8f(0x224))var _0x3d8735=users[_0x322c8f(0x224)];else{if(_0x6472a8[0x0][_0x322c8f(0xfa)]=='Portuguese\x20(BR)')var _0x3d8735=users[_0x322c8f(0x14c)];else{if(_0x6472a8[0x0][_0x322c8f(0xfa)]==_0x322c8f(0x214))var _0x3d8735=users[_0x322c8f(0x214)];else{if(_0x6472a8[0x0][_0x322c8f(0xfa)]==_0x322c8f(0x17a))var _0x3d8735=users[_0x322c8f(0x175)];}}}}}}}const _0x5c21c6=getRandom8DigitNumber(),_0x5f2eb1=new Date(),_0x2c6031={'year':_0x322c8f(0x106),'month':_0x322c8f(0x152),'day':_0x322c8f(0x152),'timeZone':_0x322c8f(0x1db)},_0x45e5ae=_0x5f2eb1[_0x322c8f(0x112)]('en-CA',_0x2c6031);console[_0x322c8f(0x1cf)](_0x45e5ae),_0x5c21c6['then'](_0x28e149=>{var _0x47f9a4=_0x322c8f;_0x2e795f['render'](_0x47f9a4(0x20f),{'success':_0x47ec52[_0x47f9a4(0xf3)](_0x47f9a4(0x1f3)),'errors':_0x47ec52['flash']('errors'),'role':_0x2c84ac,'profile':_0x353954,'suppliers':_0x4b4962,'warehouse':_0x3c5aef,'product':_0x137390,'invoice':_0x28e149,'master_shop':_0x6472a8,'language':_0x3d8735,'find_data':_0x4faac1,'rooms_data':_0x595b4c,'formattedDate':_0x45e5ae});})[_0x322c8f(0x225)](_0x291e4f=>{var _0xa6604=_0x322c8f;_0x47ec52[_0xa6604(0xf3)]('errors',_0xa6604(0x11f)),_0x2e795f['redirect'](_0xa6604(0x1ae));});}catch(_0x47e5a4){console[_0x322c8f(0x1cf)](_0x47e5a4);}}),router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0x202),auth,async(_0x578b23,_0x2e9c12)=>{var _0x4c4ebe=a0_0x1d8bef;try{const {username:_0x5144c6,email:_0x572d78,role:_0xb1264c}=_0x578b23[_0x4c4ebe(0x19b)],_0x591b2f=_0x578b23[_0x4c4ebe(0x19b)],_0x572f26=await profile['findOne']({'email':_0x591b2f[_0x4c4ebe(0x12b)]}),_0x4c7f91=await master_shop[_0x4c4ebe(0x1ac)](),_0x163535=await staff['findOne']({'email':_0x591b2f['email']}),_0xbca692=await suppliers[_0x4c4ebe(0x1ac)]({});let _0x444f44;if(_0x591b2f[_0x4c4ebe(0x1af)]==_0x4c4ebe(0x125)){const _0x44897d=await staff['findOne']({'email':_0x591b2f[_0x4c4ebe(0x12b)]});_0x444f44=await warehouse[_0x4c4ebe(0x21a)]([{'$match':{'status':'Enabled','name':_0x44897d[_0x4c4ebe(0x118)]}},{'$group':{'_id':_0x4c4ebe(0x1e9),'name':{'$first':_0x4c4ebe(0x1e9)}}}]);}else _0x444f44=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4c4ebe(0x1e9),'name':{'$first':_0x4c4ebe(0x1e9)}}}]);const _0x2faf39=await product[_0x4c4ebe(0x1ac)]({}),_0x31cbd1=await warehouse['find']({'status':_0x4c4ebe(0x1ff)}),_0x531d18=await purchases_finished[_0x4c4ebe(0x1ac)]({}),_0x16091c=_0x531d18[_0x4c4ebe(0x13b)]+0x1,_0x561b36=_0x4c4ebe(0x130)+_0x16091c[_0x4c4ebe(0x180)]()[_0x4c4ebe(0x21d)](0x5,'0');var _0x5a079b=['Ambient','Enclosed'];if(_0x4c7f91[0x0][_0x4c4ebe(0xfa)]==_0x4c4ebe(0x1f8))var _0x275e78=users[_0x4c4ebe(0x209)];else{if(_0x4c7f91[0x0][_0x4c4ebe(0xfa)]==_0x4c4ebe(0x120))var _0x275e78=users[_0x4c4ebe(0x120)];else{if(_0x4c7f91[0x0][_0x4c4ebe(0xfa)]==_0x4c4ebe(0x213))var _0x275e78=users[_0x4c4ebe(0x213)];else{if(_0x4c7f91[0x0][_0x4c4ebe(0xfa)]=='Spanish')var _0x275e78=users['Spanish'];else{if(_0x4c7f91[0x0][_0x4c4ebe(0xfa)]=='French')var _0x275e78=users[_0x4c4ebe(0x224)];else{if(_0x4c7f91[0x0]['language']==_0x4c4ebe(0x178))var _0x275e78=users[_0x4c4ebe(0x14c)];else{if(_0x4c7f91[0x0][_0x4c4ebe(0xfa)]==_0x4c4ebe(0x214))var _0x275e78=users[_0x4c4ebe(0x214)];else{if(_0x4c7f91[0x0]['language']==_0x4c4ebe(0x17a))var _0x275e78=users[_0x4c4ebe(0x175)];}}}}}}}const _0x4b67b8=getRandom8DigitNumber();_0x4b67b8[_0x4c4ebe(0x11a)](_0x232df3=>{var _0x5a09e2=_0x4c4ebe;_0x2e9c12[_0x5a09e2(0x165)](_0x5a09e2(0x11b),{'success':_0x578b23[_0x5a09e2(0xf3)](_0x5a09e2(0x1f3)),'errors':_0x578b23[_0x5a09e2(0xf3)]('errors'),'role':_0x591b2f,'profile':_0x572f26,'suppliers':_0xbca692,'warehouse':_0x444f44,'product':_0x2faf39,'invoice':_0x232df3,'master_shop':_0x4c7f91,'language':_0x275e78,'find_data':_0x31cbd1,'rooms_data':_0x5a079b});})[_0x4c4ebe(0x225)](_0x5b52ff=>{var _0x831cc8=_0x4c4ebe;_0x578b23[_0x831cc8(0xf3)](_0x831cc8(0x1cc),_0x831cc8(0x11f)),_0x2e9c12[_0x831cc8(0x21b)](_0x831cc8(0x1ae));});}catch(_0x39bb55){console['log'](_0x39bb55);}}),router[a0_0x1d8bef(0x158)]('/view/add_purchases/:id',auth,async(_0x1bac02,_0x45d994)=>{var _0x22cf49=a0_0x1d8bef;try{const _0x19cedb=_0x1bac02[_0x22cf49(0x1da)]['id'];console['log'](_0x19cedb);const _0x3fff87=await master_shop[_0x22cf49(0x1ac)]();console[_0x22cf49(0x1cf)](_0x22cf49(0x1a5),_0x3fff87);const _0x9baf12=await product[_0x22cf49(0x1b7)]({'name':_0x19cedb});console[_0x22cf49(0x1cf)](_0x22cf49(0x170),_0x9baf12),_0x45d994[_0x22cf49(0x1dc)](0xc8)['json']({'product_data':_0x9baf12,'master':_0x3fff87});}catch(_0x11d9eb){console[_0x22cf49(0x1cf)](_0x22cf49(0x149),_0x11d9eb);}}),router[a0_0x1d8bef(0x134)]('/view/add_purchases',auth,async(_0x38ab81,_0x2389bf)=>{var _0xc74a9f=a0_0x1d8bef;try{const {invoice:_0x36a72b,date:_0x6f6a4e,warehouse_name:_0x466781,prod_name:_0x529a8e,note:_0x554779,due_amount:_0x3fe2a5,Room_name:_0x50a37a,PO_number:_0x4fe583,SCRN:_0x1ce798,ReqBy:_0x5cf9c7,dateofreq:_0x406327,suppliers:_0x4ede17,typeservicesData:_0x4c9d4c,van:_0xc1a734,typevehicle:_0x433a4a,driver:_0x211638,plate:_0x2e5599,DRSI:_0xefc7ae,TSU:_0x313358,TFU:_0xe82daf,JO_number:_0x7d8985,type_of_products:_0x5b9915}=_0x38ab81[_0xc74a9f(0x230)];if(typeof _0x529a8e==_0xc74a9f(0x167))var _0x5016ee=[_0x38ab81[_0xc74a9f(0x230)]['prod_name']],_0x55a4df=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x1b1)]],_0x481141=[_0x38ab81[_0xc74a9f(0x230)]['prod_Qty']],_0x246491=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x115)]],_0x325b07=[_0x38ab81['body']['prod_secondunit']],_0x1e29be=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x11c)]],_0x2f96fb=[_0x38ab81[_0xc74a9f(0x230)]['secondary_code']],_0x313f49=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x166)]],_0x3a1126=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x21e)]],_0x456fbb=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x19d)]],_0x230fcf=[_0x38ab81['body'][_0xc74a9f(0x217)]],_0x155ef5=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x208)]],_0x5f039e=[_0x38ab81['body']['prod_cat']],_0x227c21=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x143)]],_0xbaf2d6=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x20d)]],_0x150590=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x1b4)]],_0x603176=[_0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x1b0)]];else var _0x5016ee=[..._0x38ab81[_0xc74a9f(0x230)]['prod_name']],_0x55a4df=[..._0x38ab81['body'][_0xc74a9f(0x1b1)]],_0x481141=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x103)]],_0x246491=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x115)]],_0x325b07=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x1ea)]],_0x1e29be=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x11c)]],_0x2f96fb=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x18c)]],_0x313f49=[..._0x38ab81['body'][_0xc74a9f(0x166)]],_0x3a1126=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x21e)]],_0x456fbb=[..._0x38ab81[_0xc74a9f(0x230)]['expiry_date']],_0x230fcf=[..._0x38ab81['body'][_0xc74a9f(0x217)]],_0x155ef5=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x208)]],_0x5f039e=[..._0x38ab81['body']['prod_cat']],_0x227c21=[..._0x38ab81['body'][_0xc74a9f(0x143)]],_0xbaf2d6=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x20d)]],_0x150590=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x1b4)]],_0x603176=[..._0x38ab81[_0xc74a9f(0x230)][_0xc74a9f(0x1b0)]];const _0x49e754=_0x5016ee[_0xc74a9f(0x1d5)](_0x4a17ce=>{return _0x4a17ce={'product_name':_0x4a17ce};});_0x603176[_0xc74a9f(0x199)]((_0x4829a2,_0x16da76)=>{var _0x36de6b=_0xc74a9f;_0x49e754[_0x16da76][_0x36de6b(0x1b0)]=_0x4829a2,_0x49e754[_0x16da76][_0x36de6b(0x232)]=_0x6f6a4e;}),_0x150590[_0xc74a9f(0x199)]((_0x5b99a4,_0x3a6983)=>{var _0x5bce81=_0xc74a9f;_0x49e754[_0x3a6983][_0x5bce81(0x1fe)]=_0x5b99a4;}),_0x55a4df[_0xc74a9f(0x199)]((_0x49e23c,_0x16e968)=>{var _0x1785ab=_0xc74a9f;_0x49e754[_0x16e968][_0x1785ab(0x198)]=_0x49e23c;}),_0xbaf2d6['forEach']((_0x307d9d,_0xe0e89b)=>{var _0xfff92=_0xc74a9f;_0x49e754[_0xe0e89b][_0xfff92(0x20d)]=_0x307d9d;}),_0x481141[_0xc74a9f(0x199)]((_0x5f4284,_0x25f197)=>{var _0x5c5947=_0xc74a9f;_0x49e754[_0x25f197]['quantity']=Math[_0x5c5947(0x1ed)](_0x5f4284);}),_0x246491[_0xc74a9f(0x199)]((_0x5a4eed,_0x30f9bf)=>{var _0x21f996=_0xc74a9f;_0x49e754[_0x30f9bf][_0x21f996(0x109)]=_0x5a4eed;}),_0x325b07[_0xc74a9f(0x199)]((_0x27820b,_0x39acf6)=>{var _0x44846e=_0xc74a9f;_0x49e754[_0x39acf6][_0x44846e(0x1aa)]=_0x27820b;}),_0x1e29be['forEach']((_0x28620f,_0x3b7336)=>{var _0x92436=_0xc74a9f;_0x49e754[_0x3b7336][_0x92436(0x11c)]=_0x28620f;}),_0x2f96fb[_0xc74a9f(0x199)]((_0x45d870,_0x5cf803)=>{var _0x4049f9=_0xc74a9f;_0x49e754[_0x5cf803][_0x4049f9(0x18c)]=_0x45d870;}),_0x313f49[_0xc74a9f(0x199)]((_0x2b695b,_0x10b1b8)=>{var _0x9d6cf5=_0xc74a9f;_0x49e754[_0x10b1b8][_0x9d6cf5(0x157)]=_0x2b695b;}),_0x3a1126[_0xc74a9f(0x199)]((_0x527400,_0x4b1cb8)=>{_0x49e754[_0x4b1cb8]['batch_code']=_0x527400;}),_0x456fbb[_0xc74a9f(0x199)]((_0x485e50,_0x10c9e4)=>{var _0x32ead2=_0xc74a9f;_0x49e754[_0x10c9e4][_0x32ead2(0x19d)]=_0x485e50;}),_0x230fcf['forEach']((_0x2e3464,_0x5ba729)=>{_0x49e754[_0x5ba729]['production_date']=_0x2e3464;}),_0x155ef5[_0xc74a9f(0x199)]((_0x5c2220,_0x559f23)=>{var _0x564eab=_0xc74a9f;_0x49e754[_0x559f23][_0x564eab(0x1a8)]=_0x5c2220;}),_0x5f039e['forEach']((_0x42a4b0,_0x1960dc)=>{var _0x875814=_0xc74a9f;_0x49e754[_0x1960dc][_0x875814(0x1f7)]=_0x42a4b0;}),_0x227c21['forEach']((_0x17614e,_0x40df0a)=>{var _0x560b63=_0xc74a9f;_0x49e754[_0x40df0a][_0x560b63(0x143)]=_0x17614e;});const _0x3aff9a=new invoice_for_incoming();await _0x3aff9a['save']();for(let _0x2fae78=0x0;_0x2fae78<=_0x5016ee['length']-0x1;_0x2fae78++){_0x49e754[_0x2fae78][_0xc74a9f(0x173)]=_0xc74a9f(0x1ad)+_0x3aff9a[_0xc74a9f(0xee)][_0xc74a9f(0x180)]()[_0xc74a9f(0x21d)](0x8,'0');}const _0x296bcc=await warehouse_validation_setup[_0xc74a9f(0x21a)]([{'$match':{'warehouse_name':_0x466781}}]);for(let _0xbdd37=0x0;_0xbdd37<=_0x296bcc[_0xc74a9f(0x13b)]-0x1;_0xbdd37++){const _0x2003f=_0x296bcc[_0xbdd37];for(let _0x486036=0x0;_0x486036<=_0x2003f['product_data'][_0xc74a9f(0x13b)]-0x1;_0x486036++){const _0x418733=_0x2003f['product_data'][_0x486036],_0x3179db=await warehouse[_0xc74a9f(0x21a)]([{'$match':{'name':_0x2003f[_0xc74a9f(0x1a6)],'room':_0x2003f['room']}},{'$unwind':_0xc74a9f(0x20c)},{'$match':{'product_details.level':_0x418733[_0xc74a9f(0x218)],'product_details.bay':parseInt(_0x418733[_0xc74a9f(0x153)]),'product_details.product_code':_0x418733[_0xc74a9f(0x198)]}}]);for(let _0x31bc57=0x0;_0x31bc57<=_0x3179db[_0xc74a9f(0x13b)]-0x1;_0x31bc57++){let _0x241832=_0x3179db[_0x31bc57],_0x3085a0=0x0;_0x241832[_0xc74a9f(0x188)]['product_code']==_0x418733['product_code']&&_0x241832[_0xc74a9f(0x188)][_0xc74a9f(0x218)]==_0x418733['bin']&&_0x241832['product_details'][_0xc74a9f(0x1e4)]==_0x418733[_0xc74a9f(0x218)]&&(_0x418733[_0xc74a9f(0x21c)]=parseInt(_0x418733[_0xc74a9f(0x21c)])-parseInt(_0x241832['product_details']['product_stock']),_0x3085a0++),_0x3085a0=='0'&&(parseInt(_0x418733[_0xc74a9f(0x21c)])>0x0&&(_0x296bcc[_0xbdd37][_0xc74a9f(0x10e)]=_0x296bcc[_0xbdd37][_0xc74a9f(0x10e)][_0xc74a9f(0x171)]({'bay':_0x418733[_0xc74a9f(0x218)],'bin':_0x418733[_0xc74a9f(0x153)],'max':_0x418733['max'],'min':_0x418733[_0xc74a9f(0x168)],'product_code':_0x418733[_0xc74a9f(0x198)],'product_id':_0x418733[_0xc74a9f(0x1b0)],'product_name':_0x418733[_0xc74a9f(0x1bb)]})));}}_0x296bcc[_0xbdd37][_0xc74a9f(0x10e)]=_0x296bcc[_0xbdd37][_0xc74a9f(0x10e)]['filter'](_0x2a6401=>parseInt(_0x2a6401[_0xc74a9f(0x21c)])>0x0);}for(let _0x55dfaf=0x0;_0x55dfaf<=_0x296bcc[_0xc74a9f(0x13b)]-0x1;_0x55dfaf++){const _0x32c0b8=_0x296bcc[_0x55dfaf];for(let _0x1fa51f=0x0;_0x1fa51f<=_0x32c0b8[_0xc74a9f(0x10e)][_0xc74a9f(0x13b)]-0x1;_0x1fa51f++){const _0x5bdeb1=_0x32c0b8['product_data'][_0x1fa51f],_0x5591d6=await warehouse_temporary[_0xc74a9f(0x21a)]([{'$match':{'warehouse':_0x32c0b8[_0xc74a9f(0x1a6)],'room_name':_0x32c0b8[_0xc74a9f(0x21f)],'isConfirm':_0xc74a9f(0xf7),'data_type':_0xc74a9f(0x226),'product_code':_0x5bdeb1[_0xc74a9f(0x198)],'level':_0x5bdeb1['bay'],'bay':parseInt(_0x5bdeb1[_0xc74a9f(0x153)])}}]);for(let _0xfdc757=0x0;_0xfdc757<=_0x5591d6[_0xc74a9f(0x13b)]-0x1;_0xfdc757++){let _0x1b7d0b=_0x5591d6[_0xfdc757];console[_0xc74a9f(0x1cf)](_0x1b7d0b);let _0x462009=0x0;_0x1b7d0b['product_code']==_0x5bdeb1['product_code']&&_0x1b7d0b[_0xc74a9f(0x218)]==_0x5bdeb1[_0xc74a9f(0x153)]&&_0x1b7d0b['level']==_0x5bdeb1[_0xc74a9f(0x218)]&&(_0x5bdeb1['max']=parseInt(_0x5bdeb1[_0xc74a9f(0x21c)])-parseInt(_0x1b7d0b[_0xc74a9f(0x19e)]),_0x462009++),_0x462009=='0'&&(parseInt(_0x5bdeb1['max'])>0x0&&(_0x296bcc[_0x55dfaf][_0xc74a9f(0x10e)]=_0x296bcc[_0x55dfaf]['product_data'][_0xc74a9f(0x171)]({'bay':_0x5bdeb1[_0xc74a9f(0x218)],'bin':_0x5bdeb1[_0xc74a9f(0x153)],'max':_0x5bdeb1[_0xc74a9f(0x21c)],'min':_0x5bdeb1[_0xc74a9f(0x168)],'product_code':_0x5bdeb1[_0xc74a9f(0x198)],'product_id':_0x5bdeb1[_0xc74a9f(0x1b0)],'product_name':_0x5bdeb1[_0xc74a9f(0x1bb)]})));}}_0x296bcc[_0x55dfaf][_0xc74a9f(0x10e)]=_0x296bcc[_0x55dfaf][_0xc74a9f(0x10e)][_0xc74a9f(0x204)](_0x4fc064=>parseInt(_0x4fc064[_0xc74a9f(0x21c)])>0x0);}let _0x2f2f2a=[],_0x272a57=0x0;for(let _0x4d45a5=0x0;_0x4d45a5<=_0x49e754[_0xc74a9f(0x13b)]-0x1;_0x4d45a5++){const _0x28e681=_0x49e754[_0x4d45a5];let _0x297a79=_0x28e681[_0xc74a9f(0x200)];for(let _0x40cf3e=0x0;_0x40cf3e<=_0x296bcc[_0xc74a9f(0x13b)]-0x1;_0x40cf3e++){const _0x40ac00=_0x296bcc[_0x40cf3e];for(let _0x4d6495=0x0;_0x4d6495<=_0x40ac00['product_data']['length']-0x1;_0x4d6495++){const _0x2407cc=_0x40ac00[_0xc74a9f(0x10e)][_0x4d6495];if(_0x2407cc['product_code']===_0x28e681[_0xc74a9f(0x198)]){const _0x1ceeef=await warehouse[_0xc74a9f(0x21a)]([{'$match':{'name':_0x466781,'room':_0x40ac00[_0xc74a9f(0x21f)]}},{'$unwind':_0xc74a9f(0x20c)},{'$match':{'product_details.level':_0x2407cc[_0xc74a9f(0x218)],'product_details.bay':parseInt(_0x2407cc['bin'])}}]);if(_0x1ceeef[_0xc74a9f(0x13b)]==0x0){for(let _0x133252=0x0;_0x133252<=_0x40ac00['product_data'][_0xc74a9f(0x13b)]-0x1&&_0x297a79>0x0;_0x133252++){const _0x57dc1c=_0x40ac00[_0xc74a9f(0x10e)][_0x133252];console[_0xc74a9f(0x1cf)](_0x28e681['product_code']+_0xc74a9f(0x1b2)+_0x57dc1c['product_code']+_0xc74a9f(0x117)+_0x57dc1c['min']+_0xc74a9f(0x117)+_0x57dc1c[_0xc74a9f(0x21c)]+'\x20<>\x20'+_0x57dc1c[_0xc74a9f(0x218)]+_0xc74a9f(0x117)+_0x57dc1c['bin']);if(_0x28e681[_0xc74a9f(0x198)]===_0x57dc1c[_0xc74a9f(0x198)]){_0x2f2f2a[_0x272a57]={};const _0x5316f8=parseInt(_0x57dc1c[_0xc74a9f(0x21c)]),_0xbbc454=0x0;let _0x36ae62=_0x5316f8-_0xbbc454,_0x2bf03b=Math[_0xc74a9f(0x168)](_0x297a79,_0x36ae62);console[_0xc74a9f(0x1cf)]('Distributing\x20'+_0x2bf03b+'\x20units\x20of\x20'+_0x28e681[_0xc74a9f(0x1bb)]+'\x20to\x20warehouse:\x20'+_0x40ac00[_0xc74a9f(0x1a6)]+_0xc74a9f(0x210)+_0x40ac00[_0xc74a9f(0x21f)]+_0xc74a9f(0x160)+_0x57dc1c[_0xc74a9f(0x218)]+_0xc74a9f(0x162)+_0x57dc1c[_0xc74a9f(0x153)]+_0xc74a9f(0x1e7)+_0x272a57),_0x2f2f2a[_0x272a57][_0xc74a9f(0x1bb)]=_0x28e681[_0xc74a9f(0x1bb)],_0x2f2f2a[_0x272a57]['product_code']=_0x28e681[_0xc74a9f(0x198)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1b0)]=_0x28e681[_0xc74a9f(0x1b0)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x232)]=_0x28e681['date_recieved'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1fe)]=_0x28e681[_0xc74a9f(0x1fe)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x20d)]=_0x28e681[_0xc74a9f(0x20d)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x200)]=_0x2bf03b,_0x2f2f2a[_0x272a57][_0xc74a9f(0x109)]=_0x28e681[_0xc74a9f(0x109)],_0x2f2f2a[_0x272a57]['secondary_unit']=_0x28e681[_0xc74a9f(0x1aa)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x11c)]=_0x28e681['primary_code'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x18c)]=_0x28e681[_0xc74a9f(0x18c)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x157)]=_0x28e681[_0xc74a9f(0x157)],_0x2f2f2a[_0x272a57]['batch_code']=_0x28e681[_0xc74a9f(0x21e)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x19d)]=_0x28e681['expiry_date'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1f4)]=_0x28e681['production_date'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1a8)]=_0x28e681[_0xc74a9f(0x1a8)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1f7)]=_0x28e681[_0xc74a9f(0x1f7)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x173)]=_0x28e681['invoice'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x143)]=_0x28e681[_0xc74a9f(0x143)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x189)]=_0x40ac00[_0xc74a9f(0x21f)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1e4)]=_0x57dc1c[_0xc74a9f(0x218)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x218)]=_0x57dc1c['bin'],_0x297a79-=_0x2bf03b,_0x272a57++;if(_0x297a79<=0x0)break;}}if(_0x297a79<=0x0){_0x38ab81[_0xc74a9f(0xf3)](_0xc74a9f(0x1cc),_0xc74a9f(0x16e)+_0x297a79+'\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');break;}if(_0x297a79>0x0){console[_0xc74a9f(0x1cf)](_0xc74a9f(0x1e1)+_0x297a79+_0xc74a9f(0x16b));break;}}}}}if(_0x297a79>0x0){const _0x2c23dc=await warehouse[_0xc74a9f(0x21a)]([{'$match':{'name':_0x466781,'isStaging':_0xc74a9f(0x20e)}}]);_0x2f2f2a[_0x272a57]={},_0x2f2f2a[_0x272a57][_0xc74a9f(0x1bb)]=_0x28e681[_0xc74a9f(0x1bb)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x198)]=_0x28e681[_0xc74a9f(0x198)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1b0)]=_0x28e681['product_id'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x232)]=_0x28e681[_0xc74a9f(0x232)],_0x2f2f2a[_0x272a57]['sales_category']=_0x28e681[_0xc74a9f(0x1fe)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x20d)]=_0x28e681[_0xc74a9f(0x20d)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x200)]=_0x297a79,_0x2f2f2a[_0x272a57][_0xc74a9f(0x109)]=_0x28e681[_0xc74a9f(0x109)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1aa)]=_0x28e681['secondary_unit'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x11c)]=_0x28e681[_0xc74a9f(0x11c)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x18c)]=_0x28e681[_0xc74a9f(0x18c)],_0x2f2f2a[_0x272a57]['maxStocks']=_0x28e681['maxStocks'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x21e)]=_0x28e681[_0xc74a9f(0x21e)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x19d)]=_0x28e681[_0xc74a9f(0x19d)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1f4)]=_0x28e681['production_date'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1a8)]=_0x28e681[_0xc74a9f(0x1a8)],_0x2f2f2a[_0x272a57]['product_cat']=_0x28e681[_0xc74a9f(0x1f7)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x173)]=_0x28e681[_0xc74a9f(0x173)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x143)]=_0x28e681['gross_price'],_0x2f2f2a[_0x272a57][_0xc74a9f(0x189)]=_0x2c23dc[0x0][_0xc74a9f(0x21f)],_0x2f2f2a[_0x272a57][_0xc74a9f(0x1e4)]=_0xc74a9f(0x108),_0x2f2f2a[_0x272a57][_0xc74a9f(0x218)]='1',console[_0xc74a9f(0x1cf)](_0xc74a9f(0x1b8)+'\x20<>\x20'+_0x28e681[_0xc74a9f(0x198)]+_0xc74a9f(0x186)+_0x28e681[_0xc74a9f(0x198)]+_0xc74a9f(0x117)+_0x272a57+'\x20<>\x20'+_0x297a79),_0x38ab81[_0xc74a9f(0xf3)]('errors',_0xc74a9f(0x16e)+_0x297a79+_0xc74a9f(0x124));}}const _0x1588c8=_0x2f2f2a[_0xc74a9f(0x204)](_0xd10a62=>_0xd10a62[_0xc74a9f(0x200)]!=='0'&&_0xd10a62[_0xc74a9f(0x200)]!==''),_0x3262c0=new purchases_finished({'invoice':_0xc74a9f(0x1ad)+_0x3aff9a[_0xc74a9f(0xee)]['toString']()[_0xc74a9f(0x21d)](0x8,'0'),'suppliers':_0x4ede17,'date':_0x6f6a4e,'warehouse_name':_0x466781,'product':_0x1588c8,'note':_0x554779,'due_amount':_0x3fe2a5,'room':_0x50a37a,'POnumber':_0x4fe583,'SCRN':_0x1ce798,'JO_number':_0x7d8985,'ReqBy':_0x5cf9c7,'dateofreq':_0x406327,'typeservicesData':_0x4c9d4c,'van':_0xc1a734,'typevehicle':_0x433a4a,'driver':_0x211638,'plate':_0x2e5599,'DRSI':_0xefc7ae,'TSU':_0x313358,'TFU':_0xe82daf,'typeOfProducts':_0x5b9915}),_0x116df6=await _0x3262c0[_0xc74a9f(0x1d0)](),_0x54fb1c=await purchases_finished[_0xc74a9f(0x1b7)]({'_id':_0x116df6['_id'][_0xc74a9f(0x116)]()});_0x38ab81[_0xc74a9f(0xf3)](_0xc74a9f(0x1f3),_0xc74a9f(0x179)),_0x2389bf[_0xc74a9f(0x21b)]('/all_purchases_finished/process/'+_0x54fb1c['_id'][_0xc74a9f(0x116)]());}catch(_0x5ebe19){console[_0xc74a9f(0x1cf)](_0x5ebe19);}}),router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0x17c),auth,async(_0x5a9f4b,_0x3b7e79)=>{var _0x5c87bb=a0_0x1d8bef;try{const {username:_0x5aa698,email:_0x45e0a7,role:_0xb7f57c}=_0x5a9f4b[_0x5c87bb(0x19b)],_0x4a442e=_0x5a9f4b[_0x5c87bb(0x19b)],_0x4b67e4=_0x5a9f4b[_0x5c87bb(0x1da)]['id'],_0x3dbe5f=await profile[_0x5c87bb(0x1b7)]({'email':_0x4a442e[_0x5c87bb(0x12b)]}),_0x154796=await master_shop[_0x5c87bb(0x1ac)](),_0xdcc726=await staff[_0x5c87bb(0x1b7)]({'email':_0x4a442e[_0x5c87bb(0x12b)]}),_0x54f2df=await suppliers[_0x5c87bb(0x1ac)]({});let _0x14c69c;if(_0x4a442e['role']==_0x5c87bb(0x125)){const _0xbf33fb=await staff['findOne']({'email':_0x4a442e['email']});_0x14c69c=await warehouse[_0x5c87bb(0x21a)]([{'$match':{'status':_0x5c87bb(0x1ff),'name':_0xbf33fb[_0x5c87bb(0x118)]}},{'$group':{'_id':_0x5c87bb(0x1e9),'name':{'$first':_0x5c87bb(0x1e9)}}}]);}else _0x14c69c=await warehouse[_0x5c87bb(0x21a)]([{'$match':{'status':_0x5c87bb(0x1ff)}},{'$group':{'_id':_0x5c87bb(0x1e9),'name':{'$first':_0x5c87bb(0x1e9)}}}]);const _0x1e5b44=await purchases_finished[_0x5c87bb(0x1be)](_0x4b67e4);if(_0x154796[0x0]['language']==_0x5c87bb(0x1f8))var _0x3ff1d9=users[_0x5c87bb(0x209)];else{if(_0x154796[0x0]['language']==_0x5c87bb(0x120))var _0x3ff1d9=users[_0x5c87bb(0x120)];else{if(_0x154796[0x0][_0x5c87bb(0xfa)]==_0x5c87bb(0x213))var _0x3ff1d9=users[_0x5c87bb(0x213)];else{if(_0x154796[0x0][_0x5c87bb(0xfa)]==_0x5c87bb(0xff))var _0x3ff1d9=users[_0x5c87bb(0xff)];else{if(_0x154796[0x0][_0x5c87bb(0xfa)]=='French')var _0x3ff1d9=users[_0x5c87bb(0x224)];else{if(_0x154796[0x0][_0x5c87bb(0xfa)]==_0x5c87bb(0x178))var _0x3ff1d9=users['Portuguese'];else{if(_0x154796[0x0][_0x5c87bb(0xfa)]=='Chinese')var _0x3ff1d9=users['Chinese'];else{if(_0x154796[0x0][_0x5c87bb(0xfa)]=='Arabic\x20(ae)')var _0x3ff1d9=users[_0x5c87bb(0x175)];}}}}}}}_0x3b7e79[_0x5c87bb(0x165)](_0x5c87bb(0x16a),{'success':_0x5a9f4b['flash']('success'),'errors':_0x5a9f4b[_0x5c87bb(0xf3)](_0x5c87bb(0x1cc)),'role':_0x4a442e,'profile':_0x3dbe5f,'suppliers':_0x54f2df,'warehouse':_0x14c69c,'master_shop':_0x154796,'language':_0x3ff1d9,'purchases_data':_0x1e5b44});}catch(_0x29a661){console[_0x5c87bb(0x1cf)](_0x29a661);}});async function get_warehouse_data(_0x1a18ba,_0x49030f){var _0x47b7af=a0_0x1d8bef;try{const _0x559502=await warehouse_temporary['findOne']({'name':_0x1a18ba,'room':_0x49030f});if(!_0x559502){const _0x2531b3=new warehouse_temporary({'name':_0x1a18ba,'address':_0x1a18ba,'status':'Enabled','room':_0x49030f,'isStaging':'false'});return await _0x2531b3[_0x47b7af(0x1d0)](),_0x2531b3;}else return _0x559502;}catch(_0x5718eb){console[_0x47b7af(0x113)](_0x47b7af(0x154),_0x5718eb);throw _0x5718eb;}}router[a0_0x1d8bef(0x134)](a0_0x1d8bef(0x17c),auth,async(_0x517f72,_0x110bfe)=>{var _0x52b592=a0_0x1d8bef;try{const _0x3fd6fd=_0x517f72['params']['id'],_0x39bb08=await purchases_finished[_0x52b592(0x1be)](_0x3fd6fd);let _0x4da1c2=[];_0x39bb08['product'][_0x52b592(0x199)]((_0x1882d9,_0x2f84d9)=>{var _0x67ce9a=_0x52b592;_0x4da1c2[_0x2f84d9]={},_0x4da1c2[_0x2f84d9][_0x67ce9a(0x118)]=_0x39bb08[_0x67ce9a(0x1a6)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1b0)]=_0x1882d9['product_id'],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1bb)]=_0x1882d9[_0x67ce9a(0x1bb)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x198)]=_0x1882d9['product_code'],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x19e)]=_0x1882d9[_0x67ce9a(0x200)],_0x4da1c2[_0x2f84d9]['unit']=_0x1882d9[_0x67ce9a(0x109)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1aa)]=_0x1882d9[_0x67ce9a(0x1aa)],_0x4da1c2[_0x2f84d9]['level']=_0x1882d9['level'],_0x4da1c2[_0x2f84d9]['bay']=_0x1882d9[_0x67ce9a(0x218)],_0x4da1c2[_0x2f84d9]['primary_code']=_0x1882d9[_0x67ce9a(0x11c)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x18c)]=_0x1882d9['secondary_code'],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x157)]=_0x1882d9[_0x67ce9a(0x157)],_0x4da1c2[_0x2f84d9]['batch_code']=_0x1882d9[_0x67ce9a(0x21e)],_0x4da1c2[_0x2f84d9]['expiry_date']=_0x1882d9[_0x67ce9a(0x19d)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1f4)]=_0x1882d9[_0x67ce9a(0x1f4)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1a8)]=_0x1882d9[_0x67ce9a(0x1a8)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1f7)]=_0x1882d9[_0x67ce9a(0x1f7)],_0x4da1c2[_0x2f84d9]['room_name']=_0x1882d9[_0x67ce9a(0x189)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x173)]=_0x1882d9[_0x67ce9a(0x173)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x20d)]=_0x1882d9['uuid'],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x143)]=_0x1882d9[_0x67ce9a(0x143)],_0x4da1c2[_0x2f84d9]['sales_category']=_0x1882d9['sales_category'],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x232)]=_0x1882d9[_0x67ce9a(0x232)],_0x4da1c2[_0x2f84d9][_0x67ce9a(0x163)]=_0x1882d9['_id'][_0x67ce9a(0x116)](),_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1e5)]='inc',_0x4da1c2[_0x2f84d9][_0x67ce9a(0x1f6)]='true',_0x4da1c2[_0x2f84d9][_0x67ce9a(0x10d)]=_0x67ce9a(0xf7);});for(let _0x5ba154=0x0;_0x5ba154<=_0x4da1c2[_0x52b592(0x13b)]-0x1;_0x5ba154++){const _0x48005d=_0x4da1c2[_0x5ba154],_0x5e077a=new warehouse_temporary(_0x48005d);await _0x5e077a[_0x52b592(0x1d0)]();}_0x39bb08[_0x52b592(0x1d8)]=_0x52b592(0x20e),await _0x39bb08[_0x52b592(0x1d0)](),_0x517f72[_0x52b592(0xf3)](_0x52b592(0x1f3),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x110bfe[_0x52b592(0x21b)]('/all_purchases_finished/process/'+_0x39bb08[_0x52b592(0x129)][_0x52b592(0x116)]());}catch(_0x23b96f){}}),router[a0_0x1d8bef(0x134)](a0_0x1d8bef(0x202),auth,async(_0x220d3d,_0x3aad94)=>{var _0x180186=a0_0x1d8bef;try{const {invoice:_0x2df759,date:_0x3aeba0,warehouse_name:_0x243c7a,prod_name:_0x4a2829,note:_0x2fd065,due_amount:_0x46f815,Room_name:_0x191a4f,PO_number:_0x349398,SCRN:_0x3ef3e1,ReqBy:_0x241462,dateofreq:_0x3a9f86,suppliers:_0x5e8b11,typeservicesData:_0x50c599,van:_0x148af3,typevehicle:_0x2b026c,driver:_0x5de518,plate:_0x5e4151,DRSI:_0x3e4efe,TSU:_0x554360,TFU:_0x3dab1b,JO_number:_0x4d2514,type_of_products:_0x145324}=_0x220d3d[_0x180186(0x230)];if(typeof _0x4a2829==_0x180186(0x167))var _0x2093d1=[_0x220d3d['body'][_0x180186(0x219)]],_0x41f694=[_0x220d3d[_0x180186(0x230)][_0x180186(0x1b1)]],_0x44ebb2=[_0x220d3d['body'][_0x180186(0x103)]],_0x27b116=[_0x220d3d[_0x180186(0x230)][_0x180186(0x115)]],_0x2e5048=[_0x220d3d['body']['prod_secondunit']],_0x3d2004=[_0x220d3d[_0x180186(0x230)][_0x180186(0x13f)]],_0x17e8da=[_0x220d3d[_0x180186(0x230)][_0x180186(0x11c)]],_0x2f2767=[_0x220d3d[_0x180186(0x230)][_0x180186(0x18c)]],_0x5d78c4=[_0x220d3d[_0x180186(0x230)][_0x180186(0x166)]],_0x2b2de8=[_0x220d3d[_0x180186(0x230)][_0x180186(0x21e)]],_0x288ee2=[_0x220d3d[_0x180186(0x230)]['expiry_date']],_0x329135=[_0x220d3d[_0x180186(0x230)][_0x180186(0x217)]],_0x489efa=[_0x220d3d[_0x180186(0x230)][_0x180186(0x208)]],_0x1a2376=[_0x220d3d[_0x180186(0x230)][_0x180186(0x138)]],_0xf90d9f=[_0x220d3d['body'][_0x180186(0x1ca)]],_0x251846=[_0x220d3d['body'][_0x180186(0x143)]],_0x163178=[_0x220d3d[_0x180186(0x230)][_0x180186(0x20d)]],_0x12d158=[_0x220d3d[_0x180186(0x230)][_0x180186(0x1b4)]],_0x2f9b7c=[_0x220d3d[_0x180186(0x230)][_0x180186(0x161)]];else var _0x2093d1=[..._0x220d3d['body'][_0x180186(0x219)]],_0x41f694=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x1b1)]],_0x44ebb2=[..._0x220d3d[_0x180186(0x230)]['prod_Qty']],_0x27b116=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x115)]],_0x2e5048=[..._0x220d3d[_0x180186(0x230)]['prod_secondunit']],_0x3d2004=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x13f)]],_0x17e8da=[..._0x220d3d['body'][_0x180186(0x11c)]],_0x2f2767=[..._0x220d3d['body'][_0x180186(0x18c)]],_0x5d78c4=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x166)]],_0x2b2de8=[..._0x220d3d[_0x180186(0x230)]['batch_code']],_0x288ee2=[..._0x220d3d['body'][_0x180186(0x19d)]],_0x329135=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x217)]],_0x489efa=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x208)]],_0x1a2376=[..._0x220d3d['body'][_0x180186(0x138)]],_0xf90d9f=[..._0x220d3d[_0x180186(0x230)]['RoomAssign']],_0x251846=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x143)]],_0x163178=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x20d)]],_0x12d158=[..._0x220d3d[_0x180186(0x230)][_0x180186(0x1b4)]],_0x2f9b7c=[..._0x220d3d['body'][_0x180186(0x161)]];const _0x348e71=_0x2093d1[_0x180186(0x1d5)](_0x380455=>{return _0x380455={'product_name':_0x380455};});_0x2f9b7c[_0x180186(0x199)]((_0x1715d0,_0x4c3df6)=>{var _0x13c8c8=_0x180186;_0x348e71[_0x4c3df6][_0x13c8c8(0x135)]=_0x1715d0;}),_0x12d158[_0x180186(0x199)]((_0x3b816b,_0xac1084)=>{var _0x42ae00=_0x180186;_0x348e71[_0xac1084][_0x42ae00(0x1fe)]=_0x3b816b;}),_0x41f694[_0x180186(0x199)]((_0x31e571,_0x4d968e)=>{var _0xa69ecb=_0x180186;_0x348e71[_0x4d968e][_0xa69ecb(0x198)]=_0x31e571;}),_0x163178[_0x180186(0x199)]((_0x53f566,_0x1e2312)=>{var _0x173716=_0x180186;_0x348e71[_0x1e2312][_0x173716(0x20d)]=_0x53f566;}),_0x44ebb2['forEach']((_0x4db655,_0x2cf2d3)=>{var _0x639a07=_0x180186;_0x348e71[_0x2cf2d3][_0x639a07(0x200)]=Math[_0x639a07(0x1ed)](_0x4db655);}),_0x27b116['forEach']((_0x4930dd,_0x1bd485)=>{var _0x2c8a89=_0x180186;_0x348e71[_0x1bd485][_0x2c8a89(0x109)]=_0x4930dd;}),_0x2e5048[_0x180186(0x199)]((_0x340f73,_0x293dd5)=>{var _0x12dca3=_0x180186;_0x348e71[_0x293dd5][_0x12dca3(0x1aa)]=_0x340f73;}),_0x3d2004[_0x180186(0x199)]((_0x41a43b,_0xf27b61)=>{var _0x8f379f=_0x180186,_0xfab9d0=_0x41a43b[_0x8f379f(0x1e8)](/[A-Za-z]+/)[0x0],_0x4108a4=parseInt(_0x41a43b[_0x8f379f(0x1e8)](/\d+/)[0x0]);_0x348e71[_0xf27b61][_0x8f379f(0x1e4)]=_0xfab9d0,_0x348e71[_0xf27b61][_0x8f379f(0x218)]=_0x4108a4;}),_0x17e8da[_0x180186(0x199)]((_0x28fdc1,_0xeaecde)=>{var _0x5ae08e=_0x180186;_0x348e71[_0xeaecde][_0x5ae08e(0x11c)]=_0x28fdc1;}),_0x2f2767['forEach']((_0x30695c,_0x4da10d)=>{_0x348e71[_0x4da10d]['secondary_code']=_0x30695c;}),_0x5d78c4[_0x180186(0x199)]((_0x874044,_0x15af70)=>{_0x348e71[_0x15af70]['maxStocks']=_0x874044;}),_0x2b2de8['forEach']((_0x84afcf,_0x57b29c)=>{var _0x48bee=_0x180186;_0x348e71[_0x57b29c][_0x48bee(0x21e)]=_0x84afcf;}),_0x288ee2[_0x180186(0x199)]((_0x1b1413,_0x52a47b)=>{var _0x1f81a8=_0x180186;_0x348e71[_0x52a47b][_0x1f81a8(0x19d)]=_0x1b1413;}),_0x329135['forEach']((_0x5ec619,_0x198516)=>{var _0x1409f3=_0x180186;_0x348e71[_0x198516][_0x1409f3(0x1f4)]=_0x5ec619;}),_0x489efa[_0x180186(0x199)]((_0x4cd2e1,_0x3df504)=>{var _0x3d1f8b=_0x180186;_0x348e71[_0x3df504][_0x3d1f8b(0x1a8)]=_0x4cd2e1;}),_0x1a2376[_0x180186(0x199)]((_0x8b498f,_0x43e02b)=>{_0x348e71[_0x43e02b]['product_cat']=_0x8b498f;}),_0xf90d9f['forEach']((_0x5636a1,_0x56898a)=>{_0x348e71[_0x56898a]['room_name']=_0x5636a1;}),_0x251846[_0x180186(0x199)]((_0x10ce94,_0x25c788)=>{_0x348e71[_0x25c788]['gross_price']=_0x10ce94;});const _0x5ec232=new purchases_logs();await _0x5ec232['save']();for(let _0x5a38ed=0x0;_0x5a38ed<=_0xf90d9f[_0x180186(0x13b)]-0x1;_0x5a38ed++){_0x348e71[_0x5a38ed][_0x180186(0x173)]=_0x180186(0x11d)+_0x5ec232[_0x180186(0xee)][_0x180186(0x180)]()['padStart'](0x8,'0');}const _0x187a2c=_0x348e71[_0x180186(0x204)](_0x2353be=>_0x2353be['quantity']!=='0'&&_0x2353be['quantity']!==''),_0x5d7343=new purchases_finished({'invoice':'LOG-INC-'+_0x5ec232['invoice_init'][_0x180186(0x180)]()[_0x180186(0x21d)](0x8,'0'),'suppliers':_0x5e8b11,'date':_0x3aeba0,'warehouse_name':_0x243c7a,'product':_0x187a2c,'note':_0x2fd065,'due_amount':_0x46f815,'room':_0x191a4f,'POnumber':_0x349398,'SCRN':_0x3ef3e1,'JO_number':_0x4d2514,'ReqBy':_0x241462,'dateofreq':_0x3a9f86,'typeservicesData':_0x50c599,'van':_0x148af3,'typevehicle':_0x2b026c,'driver':_0x5de518,'plate':_0x5e4151,'DRSI':_0x3e4efe,'TSU':_0x554360,'TFU':_0x3dab1b,'typeOfProducts':_0x145324}),_0x3a220e=await _0x5d7343[_0x180186(0x1d0)](),_0x1aad07=await purchases_finished[_0x180186(0x1b7)]({'_id':_0x3a220e['_id'][_0x180186(0x116)]()}),_0xfee09c=_0x1aad07[_0x180186(0x170)][_0x180186(0x1d5)](async _0xeb7fce=>{var _0x124dcb=_0x180186;try{var _0x5c1174=await warehouse[_0x124dcb(0x1b7)]({'name':_0x243c7a,'room':_0xeb7fce[_0x124dcb(0x189)]}),_0x581e93=0x0;const _0x10acfd=_0x5c1174['product_details'][_0x124dcb(0x1d5)](_0x912b2c=>{var _0xd035f7=_0x124dcb;console[_0xd035f7(0x1cf)](_0x912b2c['product_name']+'=='+_0xeb7fce['product_name']+'&&'+_0x912b2c[_0xd035f7(0x218)]+'=='+_0xeb7fce[_0xd035f7(0x218)]+'&&'+_0x912b2c['expiry_date']+'=='+_0xeb7fce[_0xd035f7(0x19d)]+'&&'+_0x912b2c[_0xd035f7(0x1f4)]+'=='+_0xeb7fce[_0xd035f7(0x1f4)]+'&&'+_0x912b2c[_0xd035f7(0x21e)]+'=='+_0xeb7fce['batch_code']+'&&'+_0x912b2c[_0xd035f7(0x173)]+'=='+_0x1aad07['invoice']),_0x912b2c[_0xd035f7(0x1bb)]==_0xeb7fce[_0xd035f7(0x1bb)]&&_0x912b2c['bay']==_0xeb7fce[_0xd035f7(0x218)]&&_0x912b2c[_0xd035f7(0x1e4)]==_0xeb7fce[_0xd035f7(0x1e4)]&&_0x912b2c[_0xd035f7(0x19d)]==_0xeb7fce[_0xd035f7(0x19d)]&&_0x912b2c['production_date']==_0xeb7fce[_0xd035f7(0x1f4)]&&_0x912b2c['batch_code']==_0xeb7fce['batch_code']&&_0x912b2c[_0xd035f7(0x173)]==_0x1aad07['invoice']&&(_0x912b2c['product_stock']=Math[_0xd035f7(0x1ed)](_0x912b2c[_0xd035f7(0x19e)])+Math['abs'](_0xeb7fce[_0xd035f7(0x200)]),_0x581e93++);});return _0x581e93==0x0&&(_0x5c1174[_0x124dcb(0x188)]=_0x5c1174[_0x124dcb(0x188)]['concat']({'product_name':_0xeb7fce[_0x124dcb(0x1bb)],'product_stock':Math[_0x124dcb(0x1ed)](_0xeb7fce[_0x124dcb(0x200)]),'primary_code':_0xeb7fce[_0x124dcb(0x11c)],'secondary_code':_0xeb7fce[_0x124dcb(0x18c)],'product_code':_0xeb7fce[_0x124dcb(0x198)],'bay':_0xeb7fce[_0x124dcb(0x218)],'level':_0xeb7fce[_0x124dcb(0x1e4)],'maxProducts':_0xeb7fce[_0x124dcb(0x157)],'unit':_0xeb7fce['standard_unit'],'secondary_unit':_0xeb7fce['secondary_unit'],'expiry_date':_0xeb7fce['expiry_date'],'production_date':_0xeb7fce[_0x124dcb(0x1f4)],'maxProducts':_0xeb7fce[_0x124dcb(0x157)],'maxPerUnit':_0xeb7fce[_0x124dcb(0x1a8)],'batch_code':_0xeb7fce[_0x124dcb(0x21e)],'product_cat':_0xeb7fce[_0x124dcb(0x1f7)],'invoice':_0xeb7fce[_0x124dcb(0x173)],'id_incoming':_0xeb7fce[_0x124dcb(0x129)],'uuid':_0xeb7fce[_0x124dcb(0x20d)],'gross_price':_0xeb7fce[_0x124dcb(0x143)],'sales_category':_0xeb7fce['sales_category'],'type_products':_0xeb7fce['type_of_products']})),_0x5c1174;}catch(_0x17884f){return console['error']('Error\x20occurred\x20while\x20processing\x20product:',_0x17884f),null;}});Promise[_0x180186(0x101)](_0xfee09c)[_0x180186(0x11a)](async _0x3be3f6=>{var _0x557ee5=_0x180186;try{for(const _0x3c23c1 of _0x3be3f6){await warehouse[_0x557ee5(0x19c)]({'_id':_0x3c23c1[_0x557ee5(0x129)]},{'$addToSet':{'product_details':{'$each':_0x3c23c1['product_details']}}});}const _0x4dbee7=await master_shop[_0x557ee5(0x1ac)](),_0x5d219d=await email_settings[_0x557ee5(0x1b7)](),_0x11b4f4=await supervisor_settings[_0x557ee5(0x1ac)]();var _0x17a70f=_0x1aad07[_0x557ee5(0x170)],_0x13afe0='',_0x30d32c;for(_0x30d32c in _0x17a70f){var _0x3efd7f='FG';_0x1aad07[_0x557ee5(0x1a6)]=='DRY\x20GOODS'&&(_0x3efd7f='DG'),_0x13afe0+=_0x557ee5(0x228)+_0x557ee5(0x1f0)+_0x17a70f[_0x30d32c][_0x557ee5(0x1bb)]+_0x557ee5(0x22c)+_0x557ee5(0x1f0)+_0x17a70f[_0x30d32c][_0x557ee5(0x198)]+'</td>'+_0x557ee5(0x1f0)+_0x17a70f[_0x30d32c][_0x557ee5(0x200)]+_0x557ee5(0x22c)+_0x557ee5(0x1f0)+_0x17a70f[_0x30d32c][_0x557ee5(0x109)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x17a70f[_0x30d32c][_0x557ee5(0x1aa)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1aad07[_0x557ee5(0x1a6)]+_0x557ee5(0x22c)+_0x557ee5(0x1f0)+_0x17a70f[_0x30d32c]['room_name']+'</td>'+_0x557ee5(0x1f0)+_0x3efd7f+_0x17a70f[_0x30d32c][_0x557ee5(0x218)]+'</td>','</tr>';}let _0x41e45f=nodemailer['createTransport']({'host':_0x5d219d['host'],'port':Number(_0x5d219d[_0x557ee5(0x1f9)]),'secure':![],'auth':{'user':_0x5d219d[_0x557ee5(0x12b)],'pass':_0x5d219d[_0x557ee5(0x1a0)]}}),_0xba52de={'from':_0x5d219d[_0x557ee5(0x12b)],'to':_0x11b4f4[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x557ee5(0x1c9),'path':__dirname+_0x557ee5(0x137)+'/upload/'+_0x4dbee7[0x0]['image'],'cid':'logo'}],'html':_0x557ee5(0x18a)+_0x557ee5(0x146)+_0x557ee5(0x1ee)+_0x557ee5(0x19a)+_0x557ee5(0x222)+_0x557ee5(0x19a)+_0x557ee5(0x221)+'</div>'+_0x557ee5(0x19a)+_0x557ee5(0x12d)+_0x4dbee7[0x0]['site_title']+'\x20</h2>'+_0x557ee5(0x1bc)+_0x557ee5(0x1bc)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x557ee5(0x192)+_0x1aad07[_0x557ee5(0x173)]+'\x20'+_0x557ee5(0x17e)+_0x557ee5(0x10a)+_0x1aad07[_0x557ee5(0x195)]+'\x20'+_0x557ee5(0x1d9)+_0x557ee5(0x22d)+_0x557ee5(0x1bc)+_0x557ee5(0x148)+_0x557ee5(0x17f)+_0x557ee5(0x228)+_0x557ee5(0x1a2)+_0x557ee5(0x145)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x557ee5(0x18e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x557ee5(0x107)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x557ee5(0x1b5)+_0x557ee5(0x1ce)+_0x557ee5(0x119)+_0x557ee5(0xf6)+'\x20'+_0x13afe0+'\x20'+_0x557ee5(0x1ec)+_0x557ee5(0x183)+'<div>'+_0x557ee5(0x1e3)+'<h5>'+_0x4dbee7[0x0][_0x557ee5(0xf4)]+_0x557ee5(0x22d)+_0x557ee5(0x1bc)+'</div>'+_0x557ee5(0x20b)};_0x41e45f[_0x557ee5(0x1c6)](_0xba52de,function(_0x4efd89,_0x3b6604){var _0x488dc4=_0x557ee5;_0x4efd89?(console[_0x488dc4(0x1cf)](_0x4efd89),console['log'](_0x488dc4(0x155))):console[_0x488dc4(0x1cf)](_0x488dc4(0x156));});}catch(_0x58fdd1){console[_0x557ee5(0x113)](_0x58fdd1),_0x3aad94['status'](0x1f4)[_0x557ee5(0xf5)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x58fdd1[_0x557ee5(0x10f)]});}})['catch'](_0x340c16=>{var _0x34d560=_0x180186;console[_0x34d560(0x113)](_0x340c16);}),_0x220d3d[_0x180186(0xf3)](_0x180186(0x1f3),_0x180186(0x179)),_0x3aad94['redirect']('/all_purchases_finished/preview/'+_0x1aad07[_0x180186(0x129)][_0x180186(0x116)]());}catch(_0x246410){console[_0x180186(0x1cf)](_0x246410);}}),router['get'](a0_0x1d8bef(0xfd),auth,async(_0x334e46,_0x22e24b)=>{var _0x15c7b2=a0_0x1d8bef;try{const {username:_0xd26946,email:_0x1a0c31,role:_0x456534}=_0x334e46[_0x15c7b2(0x19b)],_0x34eebf=_0x334e46[_0x15c7b2(0x19b)],_0x3255d9=await profile[_0x15c7b2(0x1b7)]({'email':_0x34eebf[_0x15c7b2(0x12b)]}),_0x495eb4=await master_shop[_0x15c7b2(0x1ac)](),_0x6dbd39=_0x334e46['params']['id'],_0xf41638=await purchases_finished[_0x15c7b2(0x1be)](_0x6dbd39),_0x361cfc=await suppliers['find']({});let _0xc03287;if(_0x34eebf[_0x15c7b2(0x1af)]==_0x15c7b2(0x125)){const _0x3a253e=await staff['findOne']({'email':_0x34eebf[_0x15c7b2(0x12b)]});_0xc03287=await warehouse['find']({'status':_0x15c7b2(0x1ff),'name':_0x3a253e[_0x15c7b2(0x118)],'warehouse_category':_0x15c7b2(0x176)});}else _0xc03287=await warehouse[_0x15c7b2(0x21a)]([{'$match':{'status':_0x15c7b2(0x1ff),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x15c7b2(0x1e9),'name':{'$first':_0x15c7b2(0x1e9)}}}]);const _0x1b8c1e=await product[_0x15c7b2(0x1ac)]({}),_0x380f65=BayBinSelected(_0xf41638['warehouse_name'],_0xf41638['room']);let _0x513fb8=new Date(_0xf41638[_0x15c7b2(0x19d)]),_0x4aa686=('0'+_0x513fb8[_0x15c7b2(0x201)]())[_0x15c7b2(0x1e6)](-0x2),_0x12b908=('0'+(_0x513fb8[_0x15c7b2(0x19f)]()+0x1))[_0x15c7b2(0x1e6)](-0x2),_0x3faa90=_0x513fb8[_0x15c7b2(0x1fa)](),_0x4ad9be=_0x3faa90+'-'+_0x12b908+'-'+_0x4aa686;if(_0x495eb4[0x0]['language']==_0x15c7b2(0x1f8)){var _0x3b86b2=users[_0x15c7b2(0x209)];console[_0x15c7b2(0x1cf)](_0x3b86b2);}else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]==_0x15c7b2(0x120))var _0x3b86b2=users[_0x15c7b2(0x120)];else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]=='German')var _0x3b86b2=users[_0x15c7b2(0x213)];else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]==_0x15c7b2(0xff))var _0x3b86b2=users[_0x15c7b2(0xff)];else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]==_0x15c7b2(0x224))var _0x3b86b2=users[_0x15c7b2(0x224)];else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]==_0x15c7b2(0x178))var _0x3b86b2=users['Portuguese'];else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]=='Chinese')var _0x3b86b2=users[_0x15c7b2(0x214)];else{if(_0x495eb4[0x0][_0x15c7b2(0xfa)]==_0x15c7b2(0x17a))var _0x3b86b2=users[_0x15c7b2(0x175)];}}}}}}}_0x22e24b['render'](_0x15c7b2(0x181),{'success':_0x334e46[_0x15c7b2(0xf3)](_0x15c7b2(0x1f3)),'errors':_0x334e46[_0x15c7b2(0xf3)](_0x15c7b2(0x1cc)),'role':_0x34eebf,'profile':_0x3255d9,'purchases':_0xf41638,'suppliers':_0x361cfc,'warehouse':_0xc03287,'product':_0x1b8c1e,'master_shop':_0x495eb4,'language':_0x3b86b2,'ed_fullDate':_0x4ad9be,'dataSelected':_0x380f65});}catch(_0x6397cd){console[_0x15c7b2(0x1cf)](_0x6397cd);}}),router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0xfb),auth,async(_0x3930dc,_0x207d64)=>{var _0xdc2a07=a0_0x1d8bef;try{const {username:_0x5c58ce,email:_0x1ea51f,role:_0x9a9570}=_0x3930dc[_0xdc2a07(0x19b)],_0xb90567=_0x3930dc['user'],_0x2e2cbb=await profile[_0xdc2a07(0x1b7)]({'email':_0xb90567['email']}),_0x2f0c03=await master_shop[_0xdc2a07(0x1ac)](),_0x11e4cd=_0x3930dc['params']['id'],_0x7e173d=await purchases_finished['findById'](_0x11e4cd),_0x3aeabe=await suppliers['find']({});let _0x24b115;if(_0xb90567[_0xdc2a07(0x1af)]==_0xdc2a07(0x125)){const _0x586a70=await staff['findOne']({'email':_0xb90567[_0xdc2a07(0x12b)]});_0x24b115=await warehouse[_0xdc2a07(0x1ac)]({'status':_0xdc2a07(0x1ff),'name':_0x586a70[_0xdc2a07(0x118)],'warehouse_category':_0xdc2a07(0x176)});}else _0x24b115=await warehouse[_0xdc2a07(0x21a)]([{'$match':{'status':_0xdc2a07(0x1ff),'warehouse_category':_0xdc2a07(0x176)}},{'$group':{'_id':_0xdc2a07(0x1e9),'name':{'$first':_0xdc2a07(0x1e9)}}}]);const _0x36fe09=await product['find']({}),_0x1ba695=BayBinSelected(_0x7e173d[_0xdc2a07(0x1a6)],_0x7e173d[_0xdc2a07(0x21f)]);let _0x497ac2=new Date(_0x7e173d[_0xdc2a07(0x19d)]),_0x8ab405=('0'+_0x497ac2['getDate']())[_0xdc2a07(0x1e6)](-0x2),_0x45d90d=('0'+(_0x497ac2['getMonth']()+0x1))['slice'](-0x2),_0x1b724c=_0x497ac2['getFullYear'](),_0x37a4ae=_0x1b724c+'-'+_0x45d90d+'-'+_0x8ab405;if(_0x2f0c03[0x0]['language']==_0xdc2a07(0x1f8)){var _0x13f09c=users[_0xdc2a07(0x209)];console['log'](_0x13f09c);}else{if(_0x2f0c03[0x0][_0xdc2a07(0xfa)]=='Hindi')var _0x13f09c=users['Hindi'];else{if(_0x2f0c03[0x0][_0xdc2a07(0xfa)]==_0xdc2a07(0x213))var _0x13f09c=users[_0xdc2a07(0x213)];else{if(_0x2f0c03[0x0][_0xdc2a07(0xfa)]==_0xdc2a07(0xff))var _0x13f09c=users['Spanish'];else{if(_0x2f0c03[0x0]['language']==_0xdc2a07(0x224))var _0x13f09c=users[_0xdc2a07(0x224)];else{if(_0x2f0c03[0x0][_0xdc2a07(0xfa)]=='Portuguese\x20(BR)')var _0x13f09c=users[_0xdc2a07(0x14c)];else{if(_0x2f0c03[0x0]['language']=='Chinese')var _0x13f09c=users[_0xdc2a07(0x214)];else{if(_0x2f0c03[0x0][_0xdc2a07(0xfa)]=='Arabic\x20(ae)')var _0x13f09c=users[_0xdc2a07(0x175)];}}}}}}}_0x207d64['render'](_0xdc2a07(0x190),{'success':_0x3930dc[_0xdc2a07(0xf3)](_0xdc2a07(0x1f3)),'errors':_0x3930dc[_0xdc2a07(0xf3)](_0xdc2a07(0x1cc)),'role':_0xb90567,'profile':_0x2e2cbb,'purchases':_0x7e173d,'suppliers':_0x3aeabe,'warehouse':_0x24b115,'product':_0x36fe09,'master_shop':_0x2f0c03,'language':_0x13f09c,'ed_fullDate':_0x37a4ae,'dataSelected':_0x1ba695});}catch(_0x477c74){console[_0xdc2a07(0x1cf)](_0x477c74);}}),router[a0_0x1d8bef(0x134)](a0_0x1d8bef(0xfb),auth,async(_0x13e86b,_0x55e967)=>{var _0x2b993a=a0_0x1d8bef;try{const _0x50e2a7=_0x13e86b[_0x2b993a(0x1da)]['id'],_0x4e8fa0=await purchases_finished[_0x2b993a(0x1b7)]({'_id':_0x13e86b[_0x2b993a(0x1da)]['id']}),_0x15b02e=await warehouse['findOne']({'name':_0x4e8fa0[_0x2b993a(0x1a6)],'room':_0x4e8fa0[_0x2b993a(0x21f)]});_0x4e8fa0['product'][_0x2b993a(0x199)](_0x3642f5=>{var _0x3b284e=_0x2b993a;const _0x5b97d7=_0x15b02e[_0x3b284e(0x188)][_0x3b284e(0x1d5)](_0x26f551=>{var _0x1ff2d7=_0x3b284e;_0x26f551[_0x1ff2d7(0x1bb)]==_0x3642f5['product_name']&&_0x26f551['bay']==_0x3642f5[_0x1ff2d7(0x218)]&&(_0x26f551[_0x1ff2d7(0x19e)]=parseInt(_0x26f551[_0x1ff2d7(0x19e)])-parseInt(_0x3642f5[_0x1ff2d7(0x200)]));});}),await _0x15b02e['save']();const {invoice:_0x22ab73,suppliers:_0x13ab3c,date:_0x21cf10,warehouse_name:_0x830ba5,prod_name:_0x18f8ab,prod_code:_0xa6d576,prod_qty:_0x42c8f0,prod_unit:_0x42e09c,prod_secondunit:_0x24f290,prod_level:_0x530c1f,prod_isle:_0x20d970,prod_pallet:_0x411f3c,note:_0x293a4d,expiry_date:_0x51b4af,batch_code:_0x34d22a,paid_amount:_0x32fa0a,due_amount:_0x5bb80b,Room_name:_0x2e2768,primary_code:_0x10abe6,secondary_code:_0x44b7e8,PO_number:_0x46a467,JO_number:_0x33077b}=_0x13e86b[_0x2b993a(0x230)];if(typeof _0x18f8ab=='string')var _0x262e94=[_0x13e86b[_0x2b993a(0x230)]['prod_name']],_0x5a6af3=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x1b1)]],_0x34b445=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x1c4)]],_0x16b8fc=[_0x13e86b[_0x2b993a(0x230)]['prod_unit']],_0x54036f=[_0x13e86b[_0x2b993a(0x230)]['prod_secondunit']],_0x42673e=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x13f)]],_0x2ee4ae=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x11c)]],_0x3070c3=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x18c)]],_0x12fe61=[_0x13e86b[_0x2b993a(0x230)]['MaxStocks_data']],_0x3abbf2=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x21e)]],_0x28e673=[_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x19d)]];else var _0x262e94=[..._0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x219)]],_0x5a6af3=[..._0x13e86b['body'][_0x2b993a(0x1b1)]],_0x34b445=[..._0x13e86b['body']['prod_qty']],_0x16b8fc=[..._0x13e86b['body']['prod_unit']],_0x54036f=[..._0x13e86b['body'][_0x2b993a(0x1ea)]],_0x42673e=[..._0x13e86b[_0x2b993a(0x230)]['prod_level']],_0x2ee4ae=[..._0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x11c)]],_0x3070c3=[..._0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x18c)]],_0x12fe61=[..._0x13e86b[_0x2b993a(0x230)]['MaxStocks_data']],_0x3abbf2=[..._0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x21e)]],_0x28e673=[..._0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x19d)]];const _0x48e73a=_0x262e94[_0x2b993a(0x1d5)](_0x514e1f=>{return _0x514e1f={'product_name':_0x514e1f};});_0x5a6af3['forEach']((_0x39b152,_0x580e31)=>{var _0x174323=_0x2b993a;_0x48e73a[_0x580e31][_0x174323(0x198)]=_0x39b152;}),_0x34b445[_0x2b993a(0x199)]((_0x44f488,_0x337300)=>{var _0x4bb5c1=_0x2b993a;_0x48e73a[_0x337300][_0x4bb5c1(0x200)]=_0x44f488;}),_0x16b8fc[_0x2b993a(0x199)]((_0x51c097,_0x2e0df8)=>{_0x48e73a[_0x2e0df8]['standard_unit']=_0x51c097;}),_0x54036f[_0x2b993a(0x199)]((_0x5c8b40,_0x23608e)=>{var _0x12ffca=_0x2b993a;_0x48e73a[_0x23608e][_0x12ffca(0x1aa)]=_0x5c8b40;}),_0x42673e[_0x2b993a(0x199)]((_0x4dbb25,_0x292e58)=>{var _0x3b6645=_0x2b993a;_0x48e73a[_0x292e58][_0x3b6645(0x218)]=_0x4dbb25;}),_0x2ee4ae[_0x2b993a(0x199)]((_0x23e316,_0x28c22f)=>{_0x48e73a[_0x28c22f]['primary_code']=_0x23e316;}),_0x3070c3[_0x2b993a(0x199)]((_0x331f1e,_0x3c3e2b)=>{var _0x35aec1=_0x2b993a;_0x48e73a[_0x3c3e2b][_0x35aec1(0x18c)]=_0x331f1e;}),_0x12fe61[_0x2b993a(0x199)]((_0x3c2559,_0x44d4f3)=>{var _0x56d4d5=_0x2b993a;_0x48e73a[_0x44d4f3][_0x56d4d5(0x157)]=_0x3c2559;}),_0x3abbf2['forEach']((_0x2c8c8f,_0x2eb4bf)=>{var _0x204e0b=_0x2b993a;_0x48e73a[_0x2eb4bf][_0x204e0b(0x21e)]=_0x2c8c8f;}),_0x28e673[_0x2b993a(0x199)]((_0x389414,_0x460161)=>{_0x48e73a[_0x460161]['expiry_date']=_0x389414;});const _0xcce78b=_0x48e73a['filter'](_0x5a990e=>_0x5a990e[_0x2b993a(0x200)]!=='0'&&_0x5a990e[_0x2b993a(0x200)]!=='');_0x4e8fa0[_0x2b993a(0x173)]=_0x22ab73,_0x4e8fa0[_0x2b993a(0x15a)]=_0x13ab3c,_0x4e8fa0[_0x2b993a(0x195)]=_0x21cf10,_0x4e8fa0[_0x2b993a(0x1a6)]=_0x830ba5,_0x4e8fa0[_0x2b993a(0x170)]=_0xcce78b,_0x4e8fa0[_0x2b993a(0x197)]=_0x293a4d,_0x4e8fa0['paid_amount']=_0x32fa0a,_0x4e8fa0[_0x2b993a(0x140)]=_0x5bb80b,_0x4e8fa0[_0x2b993a(0x21f)]=_0x2e2768,_0x4e8fa0['POnumber']=_0x46a467,_0x4e8fa0['JO_number']=_0x33077b;const _0x31bdf3=await _0x4e8fa0[_0x2b993a(0x1d0)](),_0x2aed5c=await warehouse[_0x2b993a(0x1b7)]({'name':_0x13e86b['body']['warehouse_name'],'room':_0x13e86b['body'][_0x2b993a(0x22e)]});_0x4e8fa0[_0x2b993a(0x170)][_0x2b993a(0x199)](_0x168b4a=>{var _0x210fb7=_0x2b993a,_0x3abfda=0x0;const _0x357e1e=_0x2aed5c[_0x210fb7(0x188)]['map'](_0x222b20=>{var _0x2ac6b2=_0x210fb7;_0x222b20[_0x2ac6b2(0x1bb)]==_0x168b4a[_0x2ac6b2(0x1bb)]&&_0x222b20[_0x2ac6b2(0x218)]==_0x168b4a[_0x2ac6b2(0x218)]&&(_0x222b20['product_stock']=parseInt(_0x222b20['product_stock'])+parseInt(_0x168b4a[_0x2ac6b2(0x200)]),_0x3abfda++);});_0x3abfda=='0'&&(_0x2aed5c[_0x210fb7(0x188)]=_0x2aed5c[_0x210fb7(0x188)]['concat']({'product_name':_0x168b4a['product_name'],'product_stock':_0x168b4a[_0x210fb7(0x200)],'primary_code':_0x168b4a[_0x210fb7(0x11c)],'secondary_code':_0x168b4a[_0x210fb7(0x18c)],'product_code':_0x168b4a[_0x210fb7(0x198)],'bay':_0x168b4a[_0x210fb7(0x218)],'maxProducts':_0x168b4a[_0x210fb7(0x157)],'unit':_0x168b4a['standard_unit'],'secondary_unit':_0x168b4a[_0x210fb7(0x1aa)],'expiry_date':_0x168b4a[_0x210fb7(0x19d)]}));}),await _0x2aed5c[_0x2b993a(0x1d0)]();const _0x3877b3=await s_payment_data[_0x2b993a(0x1b7)]({'invoice':_0x13e86b[_0x2b993a(0x230)]['invoice']});if(_0x3877b3===null){}else console[_0x2b993a(0x1cf)](_0x2b993a(0x15a),_0x3877b3,_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x173)]),_0x3877b3['suppliers']=_0x13e86b[_0x2b993a(0x230)][_0x2b993a(0x15a)],await _0x3877b3['save']();_0x13e86b[_0x2b993a(0xf3)](_0x2b993a(0x1f3),_0x2b993a(0xf1)),_0x55e967[_0x2b993a(0x21b)](_0x2b993a(0x1ae));}catch(_0x342d69){console[_0x2b993a(0x1cf)](_0x342d69);}}),router[a0_0x1d8bef(0x134)](a0_0x1d8bef(0x1fc),auth,async(_0x302c2d,_0x231342)=>{var _0x90237e=a0_0x1d8bef;try{const _0x32ba01=_0x302c2d['params']['id'],{invoice:_0x2ad3f8,suppliers:_0x5b0d2b,payable:_0x1c73eb,due_amount:_0x534657}=_0x302c2d[_0x90237e(0x230)],_0x53c927=await purchases[_0x90237e(0x1be)](_0x32ba01);var _0x4d778c=_0x1c73eb-_0x534657;_0x53c927[_0x90237e(0x227)]=parseFloat(_0x53c927[_0x90237e(0x227)])+parseFloat(_0x534657),_0x53c927[_0x90237e(0x140)]=_0x4d778c;const _0x3cbdf9=await _0x53c927[_0x90237e(0x1d0)]();console[_0x90237e(0x1cf)](_0x3cbdf9);const _0x3186fc=await s_payment_data[_0x90237e(0x1b7)]({'invoice':_0x2ad3f8});_0x3186fc[_0x90237e(0x231)]=_0x4d778c,await _0x3186fc[_0x90237e(0x1d0)]();let _0x58f3cf=new Date(),_0x402f52=('0'+_0x58f3cf['getDate']())['slice'](-0x2),_0x346c40=('0'+(_0x58f3cf['getMonth']()+0x1))['slice'](-0x2),_0x23c6e2=_0x58f3cf[_0x90237e(0x1fa)](),_0x27c327=_0x23c6e2+'-'+_0x346c40+'-'+_0x402f52;const _0x42168e=new suppliers_payment({'invoice':_0x2ad3f8,'date':_0x23c6e2+'-'+_0x346c40+'-'+_0x402f52,'suppliers':_0x5b0d2b,'reason':'Paid\x20For\x20Purchase','amount':_0x534657}),_0x552eb5=await _0x42168e[_0x90237e(0x1d0)]();_0x302c2d[_0x90237e(0xf3)]('success',_0x90237e(0x211)),_0x231342[_0x90237e(0x21b)](_0x90237e(0xef));}catch(_0x27121e){console[_0x90237e(0x1cf)](_0x27121e);}}),router[a0_0x1d8bef(0x158)](a0_0x1d8bef(0x22a),auth,async(_0x18cda0,_0x49f861)=>{var _0x21bac1=a0_0x1d8bef;try{const {username:_0x220e07,email:_0x38d772,role:_0x63cb85}=_0x18cda0[_0x21bac1(0x19b)],_0x4419d6=_0x18cda0[_0x21bac1(0x19b)],_0x5661f3=await profile[_0x21bac1(0x1b7)]({'email':_0x4419d6[_0x21bac1(0x12b)]}),_0x14056c=await master_shop[_0x21bac1(0x1ac)]();console[_0x21bac1(0x1cf)](_0x21bac1(0x1a5),_0x14056c);const _0x3d7a73=_0x18cda0[_0x21bac1(0x1da)]['id'],_0x53c615=await purchases[_0x21bac1(0x1be)](_0x3d7a73);console['log'](_0x53c615);const _0x1e68b8=await suppliers[_0x21bac1(0x1b7)]({'name':_0x53c615[_0x21bac1(0x15a)]});console[_0x21bac1(0x1cf)](_0x1e68b8);if(_0x14056c[0x0]['language']==_0x21bac1(0x1f8)){var _0x6a4d8=users[_0x21bac1(0x209)];console[_0x21bac1(0x1cf)](_0x6a4d8);}else{if(_0x14056c[0x0]['language']==_0x21bac1(0x120))var _0x6a4d8=users[_0x21bac1(0x120)];else{if(_0x14056c[0x0][_0x21bac1(0xfa)]==_0x21bac1(0x213))var _0x6a4d8=users[_0x21bac1(0x213)];else{if(_0x14056c[0x0]['language']==_0x21bac1(0xff))var _0x6a4d8=users[_0x21bac1(0xff)];else{if(_0x14056c[0x0][_0x21bac1(0xfa)]==_0x21bac1(0x224))var _0x6a4d8=users[_0x21bac1(0x224)];else{if(_0x14056c[0x0][_0x21bac1(0xfa)]==_0x21bac1(0x178))var _0x6a4d8=users[_0x21bac1(0x14c)];else{if(_0x14056c[0x0][_0x21bac1(0xfa)]=='Chinese')var _0x6a4d8=users[_0x21bac1(0x214)];else{if(_0x14056c[0x0][_0x21bac1(0xfa)]==_0x21bac1(0x17a))var _0x6a4d8=users[_0x21bac1(0x175)];}}}}}}}_0x49f861['render'](_0x21bac1(0x16f),{'success':_0x18cda0[_0x21bac1(0xf3)](_0x21bac1(0x1f3)),'errors':_0x18cda0['flash']('errors'),'role':_0x4419d6,'profile':_0x5661f3,'master_shop':_0x14056c,'supplier':_0x1e68b8,'purchase':_0x53c615,'language':_0x6a4d8});}catch(_0x4503a5){console[_0x21bac1(0x1cf)](_0x4503a5);}}),router[a0_0x1d8bef(0x158)]('/view/return_purchase/:id',auth,async(_0xbaba3e,_0x5b9e04)=>{var _0x2db7f7=a0_0x1d8bef;try{const {username:_0x503f61,email:_0x47a2e8,role:_0x13bed}=_0xbaba3e[_0x2db7f7(0x19b)],_0x29f448=_0xbaba3e[_0x2db7f7(0x19b)],_0x12012b=await profile[_0x2db7f7(0x1b7)]({'email':_0x29f448[_0x2db7f7(0x12b)]}),_0x3ba8cc=await master_shop['find']();console['log'](_0x2db7f7(0x1a5),_0x3ba8cc);const _0x159071=_0xbaba3e[_0x2db7f7(0x1da)]['id'];console[_0x2db7f7(0x1cf)](_0x159071);const _0x5ac504=await purchases_finished[_0x2db7f7(0x1be)](_0x159071);console['log']('user_id',_0x5ac504);const _0x4c6dda=await product['find']({}),_0x19a898=await warehouse[_0x2db7f7(0x21a)]([{'$match':{'name':_0x5ac504[_0x2db7f7(0x1a6)],'room':_0x5ac504[_0x2db7f7(0x21f)]}},{'$unwind':_0x2db7f7(0x20c)},{'$group':{'_id':_0x2db7f7(0x205),'name':{'$first':_0x2db7f7(0x1b9)},'product_stock':{'$first':_0x2db7f7(0x1f5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2db7f7(0x147)},'type':{'$first':_0x2db7f7(0x141)},'floorlevel':{'$first':_0x2db7f7(0x1bd)},'primary_code':{'$first':_0x2db7f7(0x100)},'secondary_code':{'$first':_0x2db7f7(0x1d1)},'product_code':{'$first':_0x2db7f7(0xfe)},'storage':{'$first':_0x2db7f7(0x16c)},'rack':{'$first':_0x2db7f7(0x17b)}}}]);console['log'](_0x2db7f7(0x1d7),_0x19a898);let _0x468c15;if(_0x29f448[_0x2db7f7(0x1af)]==_0x2db7f7(0x125)){const _0x5b6af2=await staff[_0x2db7f7(0x1b7)]({'email':_0x29f448[_0x2db7f7(0x12b)]});_0x468c15=await warehouse[_0x2db7f7(0x1ac)]({'status':_0x2db7f7(0x1ff),'name':_0x5b6af2[_0x2db7f7(0x118)],'warehouse_category':_0x2db7f7(0x176),'name':_0x2db7f7(0x12a)});}else _0x468c15=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x2db7f7(0x176),'name':_0x2db7f7(0x12a)}},{'$group':{'_id':_0x2db7f7(0x1e9),'name':{'$first':_0x2db7f7(0x1e9)}}}]);if(_0x3ba8cc[0x0][_0x2db7f7(0xfa)]==_0x2db7f7(0x1f8)){var _0x593033=users[_0x2db7f7(0x209)];console[_0x2db7f7(0x1cf)](_0x593033);}else{if(_0x3ba8cc[0x0]['language']==_0x2db7f7(0x120))var _0x593033=users[_0x2db7f7(0x120)];else{if(_0x3ba8cc[0x0][_0x2db7f7(0xfa)]==_0x2db7f7(0x213))var _0x593033=users[_0x2db7f7(0x213)];else{if(_0x3ba8cc[0x0][_0x2db7f7(0xfa)]==_0x2db7f7(0xff))var _0x593033=users[_0x2db7f7(0xff)];else{if(_0x3ba8cc[0x0]['language']==_0x2db7f7(0x224))var _0x593033=users[_0x2db7f7(0x224)];else{if(_0x3ba8cc[0x0]['language']==_0x2db7f7(0x178))var _0x593033=users[_0x2db7f7(0x14c)];else{if(_0x3ba8cc[0x0][_0x2db7f7(0xfa)]==_0x2db7f7(0x214))var _0x593033=users[_0x2db7f7(0x214)];else{if(_0x3ba8cc[0x0][_0x2db7f7(0xfa)]==_0x2db7f7(0x17a))var _0x593033=users['Arabic'];}}}}}}}_0x5b9e04[_0x2db7f7(0x165)](_0x2db7f7(0x206),{'success':_0xbaba3e['flash'](_0x2db7f7(0x1f3)),'errors':_0xbaba3e[_0x2db7f7(0xf3)]('errors'),'role':_0x29f448,'profile':_0x12012b,'user':_0x5ac504,'stock':_0x19a898,'master_shop':_0x3ba8cc,'product':_0x4c6dda,'language':_0x593033,'warehouse':_0x468c15});}catch(_0x513edf){console[_0x2db7f7(0x1cf)](_0x513edf);}}),router[a0_0x1d8bef(0x134)]('/view/return_purchase/:id',auth,async(_0x1bc9ab,_0x6cf9a1)=>{var _0x58f6fb=a0_0x1d8bef;try{const {invoice:_0x212a54,date:_0x1e38ee,warehouse_name:_0xf5fe5f,Room_name:_0x381c30,product_name:_0x1c3563,purchase_quantity:_0x135970,stocks:_0x38367a,return_qty:_0x1ec394,note:_0xdc6214,level:_0x2b1e16,isle:_0xbd5259,pallet:_0x4b32d5,to_warehouse_name:_0x84d35f,to_Room_name:_0x334e45}=_0x1bc9ab[_0x58f6fb(0x230)],_0x23028e=await purchases_finished[_0x58f6fb(0x1b7)]({'_id':_0x1bc9ab[_0x58f6fb(0x1da)]['id']}),_0x5776bf=await warehouse[_0x58f6fb(0x1b7)]({'name':_0xf5fe5f,'room':_0x381c30,'warehouse_category':'Finished\x20Goods'});if(typeof _0x1c3563==_0x58f6fb(0x167))var _0x45bfa6=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1bb)]],_0x4ebe4b=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1d6)]],_0x3bff0c=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1cb)]],_0x15853e=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1de)]],_0x2c6def=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1e4)]],_0xb4c03f=[_0x1bc9ab['body']['product_code_hide']],_0x4413ea=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1e2)]],_0x369c72=[_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x150)]];else var _0x45bfa6=[..._0x1bc9ab['body'][_0x58f6fb(0x1bb)]],_0x4ebe4b=[..._0x1bc9ab['body'][_0x58f6fb(0x1d6)]],_0x3bff0c=[..._0x1bc9ab['body'][_0x58f6fb(0x1cb)]],_0x15853e=[..._0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1de)]],_0x2c6def=[..._0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1e4)]],_0xb4c03f=[..._0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x216)]],_0x4413ea=[..._0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x1e2)]],_0x369c72=[..._0x1bc9ab[_0x58f6fb(0x230)]['secondary_code_hide']];const _0x1aa0ad=_0x45bfa6[_0x58f6fb(0x1d5)](_0x5213b4=>{return _0x5213b4={'product_name':_0x5213b4};});_0x4ebe4b[_0x58f6fb(0x199)]((_0x44428c,_0xae91a4)=>{var _0xebfbb9=_0x58f6fb;_0x1aa0ad[_0xae91a4][_0xebfbb9(0x1d6)]=_0x44428c;}),_0x3bff0c[_0x58f6fb(0x199)]((_0x3367b9,_0x460005)=>{var _0x8da1f5=_0x58f6fb;_0x1aa0ad[_0x460005][_0x8da1f5(0x1c3)]=_0x3367b9;}),_0x15853e['forEach']((_0x3c0ed2,_0x5b4e9d)=>{var _0x16c68a=_0x58f6fb;_0x1aa0ad[_0x5b4e9d][_0x16c68a(0x1de)]=_0x3c0ed2;}),_0x2c6def[_0x58f6fb(0x199)]((_0x2a7eab,_0x3d9c1c)=>{var _0x5cec9c=_0x58f6fb;_0x1aa0ad[_0x3d9c1c][_0x5cec9c(0x218)]=_0x2a7eab;}),_0xb4c03f['forEach']((_0x501057,_0x3372a3)=>{_0x1aa0ad[_0x3372a3]['product_code']=_0x501057;}),_0x4413ea[_0x58f6fb(0x199)]((_0x305aa7,_0x70ef3)=>{var _0x151d9e=_0x58f6fb;_0x1aa0ad[_0x70ef3][_0x151d9e(0x11c)]=_0x305aa7;}),_0x369c72['forEach']((_0xffbb6,_0x48bc73)=>{var _0x1a4185=_0x58f6fb;_0x1aa0ad[_0x48bc73][_0x1a4185(0x18c)]=_0xffbb6;}),_0x1aa0ad[_0x58f6fb(0x199)](_0x41ebfd=>{var _0x46b959=_0x58f6fb;console[_0x46b959(0x1cf)](_0x41ebfd);const _0x3959dd=_0x5776bf[_0x46b959(0x188)][_0x46b959(0x1d5)](_0x482c4b=>{var _0x327d06=_0x46b959;_0x482c4b['product_name']==_0x41ebfd[_0x327d06(0x1bb)]&&_0x482c4b['bay']==_0x41ebfd['bay']&&(console['log'](parseInt(_0x482c4b['product_stock'])+_0x327d06(0x117)+parseInt(_0x41ebfd[_0x327d06(0x1de)])),_0x482c4b[_0x327d06(0x19e)]=parseInt(_0x482c4b['product_stock'])-parseInt(_0x41ebfd[_0x327d06(0x1de)]));});}),await _0x5776bf[_0x58f6fb(0x1d0)]();var _0x1ca95a=0x0;_0x1aa0ad[_0x58f6fb(0x199)](_0x2ea799=>{var _0x4501a6=_0x58f6fb;(parseInt(_0x2ea799['purchase_quantity'])<parseInt(_0x2ea799[_0x4501a6(0x1de)])||parseInt(_0x2ea799[_0x4501a6(0x1c3)])<parseInt(_0x2ea799['return_qty']))&&_0x1ca95a++;});if(_0x1ca95a!=0x0)return _0x1bc9ab[_0x58f6fb(0xf3)]('errors',_0x58f6fb(0xfc)),_0x6cf9a1['redirect'](_0x58f6fb(0x203));const _0x490534=new purchases_return_finished({'invoice':_0x212a54,'suppliers':_0x1bc9ab[_0x58f6fb(0x230)]['suppliers'],'date':_0x1e38ee,'warehouse_name':_0xf5fe5f,'return_product':_0x1aa0ad,'note':_0xdc6214,'room':_0x381c30,'to_warehouse_name':_0x84d35f,'to_room':_0x334e45}),_0x379254=await _0x490534['save'](),_0x4d0d4c=await purchases_return_finished[_0x58f6fb(0x1b7)]({'invoice':_0x212a54}),_0x35f1d6=await warehouse[_0x58f6fb(0x1b7)]({'name':_0x84d35f,'room':_0x334e45,'warehouse_category':_0x58f6fb(0x176)});_0x4d0d4c['return_product']['forEach'](_0x180de4=>{var _0x2c4641=_0x58f6fb,_0x27a5f0=0x0;const _0x5e4a76=_0x35f1d6['product_details'][_0x2c4641(0x1d5)](_0x706704=>{var _0x3536c3=_0x2c4641;console[_0x3536c3(0x1cf)](_0x706704[_0x3536c3(0x1bb)]+'=='+_0x180de4[_0x3536c3(0x1bb)]+'&&'+_0x706704[_0x3536c3(0x218)]+'=='+_0x180de4[_0x3536c3(0x218)]),_0x706704[_0x3536c3(0x1bb)]==_0x180de4[_0x3536c3(0x1bb)]&&_0x706704[_0x3536c3(0x218)]==_0x180de4[_0x3536c3(0x218)]&&(_0x706704[_0x3536c3(0x19e)]=parseInt(_0x706704['product_stock'])-parseInt(_0x180de4[_0x3536c3(0x1de)]),_0x27a5f0++);});_0x27a5f0=='0'&&(_0x35f1d6[_0x2c4641(0x188)]=_0x35f1d6[_0x2c4641(0x188)][_0x2c4641(0x171)]({'product_name':_0x180de4['product_name'],'product_stock':_0x180de4[_0x2c4641(0x1de)],'primary_code':_0x180de4[_0x2c4641(0x11c)],'secondary_code':_0x180de4['secondary_code'],'product_code':_0x180de4[_0x2c4641(0x198)],'bay':_0x180de4['bay'],'maxProducts':0xf423f}));}),await _0x35f1d6[_0x58f6fb(0x1d0)]();const _0x31d6bd=await purchases_finished[_0x58f6fb(0x1b7)]({'invoice':_0x212a54});_0x31d6bd['return_data']=_0x58f6fb(0x10c);const _0x39c082=await _0x31d6bd[_0x58f6fb(0x1d0)](),_0x5f549c=new s_payment_data({'invoice':_0x212a54,'suppliers':_0x1bc9ab['body']['suppliers'],'reason':'Purchase\x20Return'});await _0x5f549c['save']();const _0x5593f1=await master_shop[_0x58f6fb(0x1ac)](),_0x3c9929=await email_settings[_0x58f6fb(0x1b7)](),_0x451d25=await suppliers['findOne']({'name':_0x1bc9ab[_0x58f6fb(0x230)][_0x58f6fb(0x15a)]});_0x5593f1[0x0][_0x58f6fb(0x18f)]==0x1?(right_currency=_0x5593f1[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5593f1[0x0]['currency']);var _0x33b6f9=_0x45bfa6,_0x2399d7=_0x15853e,_0x184b8c='',_0x295e0a;for(_0x295e0a in _0x33b6f9){_0x184b8c+='<tr>'+_0x58f6fb(0x1f0)+_0x33b6f9[_0x295e0a]+_0x58f6fb(0x22c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2399d7[_0x295e0a]+_0x58f6fb(0x22c)+_0x58f6fb(0x1ce);}let _0x1d1ed4=nodemailer[_0x58f6fb(0x14d)]({'service':'gmail','auth':{'user':_0x3c9929[_0x58f6fb(0x12b)],'pass':_0x3c9929[_0x58f6fb(0x1a0)]}}),_0x1de073={'from':_0x3c9929[_0x58f6fb(0x12b)],'to':_0x451d25[_0x58f6fb(0x12b)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x58f6fb(0x137)+_0x58f6fb(0x229)+_0x5593f1[0x0][_0x58f6fb(0x18b)],'cid':'logo'}],'html':_0x58f6fb(0x18a)+_0x58f6fb(0x146)+'</head><body>'+_0x58f6fb(0x19a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x58f6fb(0x221)+_0x58f6fb(0x1bc)+'<div>'+'<h2>\x20'+_0x5593f1[0x0][_0x58f6fb(0xf4)]+_0x58f6fb(0x12c)+_0x58f6fb(0x1bc)+_0x58f6fb(0x1bc)+_0x58f6fb(0x127)+_0x58f6fb(0x19a)+_0x58f6fb(0x13e)+_0x58f6fb(0x192)+_0x212a54+'\x20'+_0x58f6fb(0x17e)+_0x58f6fb(0x10a)+_0x1e38ee+'\x20'+'</span>'+'</h5>'+_0x58f6fb(0x1bc)+_0x58f6fb(0x148)+_0x58f6fb(0x17f)+_0x58f6fb(0x228)+_0x58f6fb(0x1a2)+_0x58f6fb(0x1ba)+_0x58f6fb(0x1c2)+_0x58f6fb(0x212)+_0x58f6fb(0x1ce)+'</thead>'+_0x58f6fb(0xf6)+'\x20'+_0x184b8c+'\x20'+_0x58f6fb(0x1ec)+_0x58f6fb(0x183)+'<div>'+_0x58f6fb(0x1e3)+_0x58f6fb(0x1fd)+_0x5593f1[0x0][_0x58f6fb(0xf4)]+'</h5>'+_0x58f6fb(0x1bc)+'</div>'+_0x58f6fb(0x20b)};_0x1d1ed4['sendMail'](_0x1de073,function(_0x2a2aff,_0x5cb209){var _0x378aaf=_0x58f6fb;_0x2a2aff?console[_0x378aaf(0x1cf)](_0x378aaf(0x155)):console[_0x378aaf(0x1cf)]('Email\x20sent\x20successfully');}),_0x1bc9ab['flash'](_0x58f6fb(0x1f3),'purchases\x20item\x20return\x20successfull'),_0x6cf9a1[_0x58f6fb(0x21b)](_0x58f6fb(0x1ae));}catch(_0x20fc86){_0x6cf9a1[_0x58f6fb(0x1dc)](0xc8)[_0x58f6fb(0xf5)]({'message':_0x20fc86[_0x58f6fb(0x10f)]});}}),router[a0_0x1d8bef(0x158)]('/barcode/:id',auth,async(_0x2e6555,_0x421211)=>{var _0x330263=a0_0x1d8bef;try{const {username:_0x216ae3,email:_0x5de60e,role:_0x22f584}=_0x2e6555[_0x330263(0x19b)],_0x2f56c9=_0x2e6555[_0x330263(0x19b)],_0x32020d=await profile['findOne']({'email':_0x2f56c9[_0x330263(0x12b)]}),_0x50043c=await master_shop[_0x330263(0x1ac)](),_0x51cd3b=_0x2e6555[_0x330263(0x1da)]['id'],_0x46629=await purchases_finished[_0x330263(0x1be)](_0x51cd3b);if(_0x50043c[0x0]['language']==_0x330263(0x1f8))var _0x4e1397=users[_0x330263(0x209)];else{if(_0x50043c[0x0]['language']==_0x330263(0x120))var _0x4e1397=users[_0x330263(0x120)];else{if(_0x50043c[0x0][_0x330263(0xfa)]==_0x330263(0x213))var _0x4e1397=users[_0x330263(0x213)];else{if(_0x50043c[0x0][_0x330263(0xfa)]==_0x330263(0xff))var _0x4e1397=users[_0x330263(0xff)];else{if(_0x50043c[0x0][_0x330263(0xfa)]==_0x330263(0x224))var _0x4e1397=users[_0x330263(0x224)];else{if(_0x50043c[0x0][_0x330263(0xfa)]==_0x330263(0x178))var _0x4e1397=users[_0x330263(0x14c)];else{if(_0x50043c[0x0]['language']==_0x330263(0x214))var _0x4e1397=users[_0x330263(0x214)];else{if(_0x50043c[0x0]['language']=='Arabic\x20(ae)')var _0x4e1397=users['Arabic'];}}}}}}}_0x421211['render'](_0x330263(0x184),{'success':_0x2e6555['flash'](_0x330263(0x1f3)),'errors':_0x2e6555['flash'](_0x330263(0x1cc)),'role':_0x2f56c9,'profile':_0x32020d,'alldata':_0x46629,'master_shop':_0x50043c,'language':_0x4e1397}),console['log'](alldata);}catch(_0x591b60){console[_0x330263(0x1cf)](_0x591b60);}}),router[a0_0x1d8bef(0x134)](a0_0x1d8bef(0x14b),async(_0x106674,_0xd741d1)=>{var _0x4cc96c=a0_0x1d8bef;const {product_code:_0x399adc}=_0x106674['body'];var _0x416430;const _0x55855e=await product[_0x4cc96c(0x21a)]([{'$match':{'primary_code':_0x399adc}},{'$group':{'_id':_0x4cc96c(0x1c1),'name':{'$first':'$name'},'category':{'$first':_0x4cc96c(0x169)},'brand':{'$first':_0x4cc96c(0x1b3)},'unit':{'$first':_0x4cc96c(0xf8)},'alertquantity':{'$first':_0x4cc96c(0x1a7)},'product_code':{'$first':_0x4cc96c(0x1c0)},'primary_code':{'$first':_0x4cc96c(0x13c)},'secondary_code':{'$first':_0x4cc96c(0x1a4)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4cc96c(0x22f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x4cc96c(0x13d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x1f9585=await product[_0x4cc96c(0x21a)]([{'$match':{'secondary_code':_0x399adc}},{'$group':{'_id':'$_id','name':{'$first':_0x4cc96c(0x1e9)},'category':{'$first':_0x4cc96c(0x169)},'brand':{'$first':_0x4cc96c(0x1b3)},'unit':{'$first':_0x4cc96c(0xf8)},'alertquantity':{'$first':_0x4cc96c(0x1a7)},'product_code':{'$first':_0x4cc96c(0x1c0)},'primary_code':{'$first':_0x4cc96c(0x13c)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4cc96c(0x20a)},'maxProdPerUnit':{'$first':_0x4cc96c(0x22f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4cc96c(0x1d2)},'gross_price':{'$first':_0x4cc96c(0x133)},'sales_category':{'$first':_0x4cc96c(0x13d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x55855e[_0x4cc96c(0x13b)]>0x0)_0x416430=_0x55855e;else _0x1f9585['length']>0x0&&(_0x416430=_0x1f9585);_0xd741d1[_0x4cc96c(0xf5)](_0x416430);}),router['post'](a0_0x1d8bef(0x14a),async(_0xa68096,_0x4f06b5)=>{var _0xc9dc0b=a0_0x1d8bef;const {productCode:_0x6b0c19,bay:_0x3916a9,warehouses:_0x422f21,room:_0x4d9fed}=_0xa68096[_0xc9dc0b(0x230)];console[_0xc9dc0b(0x1cf)](_0xa68096['body']);try{const _0x5dc973=await warehouse['aggregate']([{'$match':{'name':_0x422f21,'room':_0x4d9fed}},{'$unwind':_0xc9dc0b(0x20c)},{'$match':{'product_details.bay':parseInt(_0x3916a9)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xc9dc0b(0x1c8)},'maxProducts':{'$first':_0xc9dc0b(0x196)}}}]);_0x4f06b5[_0xc9dc0b(0x1dc)](0xc8)[_0xc9dc0b(0xf5)](_0x5dc973);}catch(_0x141ece){_0x4f06b5['status'](0x194)[_0xc9dc0b(0xf5)]({'message':_0x141ece[_0xc9dc0b(0x10f)]});}}),router[a0_0x1d8bef(0x134)]('/barcode_scanner_logs',async(_0x4e45aa,_0x27ca3d)=>{var _0x37500d=a0_0x1d8bef;const {product_code:_0x3b0526}=_0x4e45aa[_0x37500d(0x230)];var _0x4063b1;const _0x473908=await product[_0x37500d(0x21a)]([{'$match':{'primary_code':_0x3b0526,'type_products':_0x37500d(0x1cf)}},{'$group':{'_id':_0x37500d(0x1c1),'name':{'$first':_0x37500d(0x1e9)},'category':{'$first':_0x37500d(0x169)},'brand':{'$first':_0x37500d(0x1b3)},'unit':{'$first':_0x37500d(0xf8)},'alertquantity':{'$first':_0x37500d(0x1a7)},'product_code':{'$first':_0x37500d(0x1c0)},'primary_code':{'$first':_0x37500d(0x13c)},'secondary_code':{'$first':_0x37500d(0x1a4)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x37500d(0x22f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x37500d(0x1d2)},'gross_price':{'$first':_0x37500d(0x133)},'sales_category':{'$first':_0x37500d(0x13d)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x37500d(0x1cf)](_0x473908);const _0x4f13a7=await product[_0x37500d(0x21a)]([{'$match':{'secondary_code':_0x3b0526,'type_products':_0x37500d(0x1cf)}},{'$group':{'_id':_0x37500d(0x1c1),'name':{'$first':_0x37500d(0x1e9)},'category':{'$first':_0x37500d(0x169)},'brand':{'$first':'$brand'},'unit':{'$first':_0x37500d(0xf8)},'alertquantity':{'$first':_0x37500d(0x1a7)},'product_code':{'$first':_0x37500d(0x1c0)},'primary_code':{'$first':_0x37500d(0x13c)},'secondary_code':{'$first':_0x37500d(0x1a4)},'maxStocks':{'$first':_0x37500d(0x20a)},'maxProdPerUnit':{'$first':_0x37500d(0x22f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x37500d(0x1d2)},'gross_price':{'$first':_0x37500d(0x133)},'sales_category':{'$first':_0x37500d(0x13d)},'type_products':{'$first':_0x37500d(0x1c7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x473908[_0x37500d(0x13b)]>0x0)_0x4063b1=_0x473908;else _0x4f13a7[_0x37500d(0x13b)]>0x0&&(_0x4063b1=_0x4f13a7);_0x27ca3d[_0x37500d(0xf5)](_0x4063b1);}),module[a0_0x1d8bef(0x185)]=router;function a0_0x194e(){var _0x28d336=['sales_data_cateory','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','table\x20page','findOne','STAGING\x20AREA\x201','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','product_name','</div>','$product_details.floorlevel','findById','$product.bin','$product_code','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','stock_quantity','prod_qty','unit','sendMail','$type_products','$product_details.bay','Logo.png','RoomAssign','stocks','errors','to_warehouse','</tr>','log','save','$product_details.secondary_code','$secondary_unit','$product.type','name','map','purchase_quantity','stock_data','isProcess','</span>','params','Asia/Manila','status','369EJdvgs','return_qty','231050CZBkyc','8213880NkPGpw','There\x20is\x20','primary_code_hide','<strong>\x20Regards\x20</strong>','level','data_type','slice','\x20inc\x20=\x20','match','$name','prod_secondunit','FROZEN\x20GOODS','</tbody>','abs','</head><body>','$batch_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','express','$note','success','production_date','$product_details.product_stock','isAvailable','product_cat','English\x20(US)','port','getFullYear','$warehouse_name','/give_payment/:id','<h5>','sales_category','Enabled','quantity','getDate','/view/add_purchases_logs','back','filter','$product_details._id','return_purchase_finished','../models/all_models','max_product_unit','English','$maxStocks','</body></html>','$product_details','uuid','true','add_purchases_finished',',\x20room:\x20','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','German','Chinese','$product.bay','product_code_hide','product_date','bay','prod_name','aggregate','redirect','max','padStart','batch_code','room','\x20<=>\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','7AFzqTs','French','catch','inc','paid_amount','<tr>','/upload/','/invoice/:id','1063497jgeeDn','</td>','</h5>','Room_name','$maxProdPerUnit','body','amount','date_recieved','invoice_init','/all_purchases/view','own','purchase\x20data\x20update\x20successfully','Ambient','flash','site_title','json','<tbody\x20style=\x22text-align:\x20center;\x22>','false','$unit','item_code','language','/view/:id','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','/preview/:id','$product_details.product_code','Spanish','$product_details.primary_code','all','Transfer\x20Finalize\x20Successfully','prod_Qty','$product','741jFhbar','numeric','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','STAGING','standard_unit','\x20Order\x20Date\x20:\x20','$suppliers','True','isUsed','product_data','message','Rack\x202','/view/add_purchases','toLocaleDateString','error','path','prod_primunit','valueOf','\x20<>\x20','warehouse','</thead>','then','add_purchases_finished_logs','primary_code','LOG-INC-','25zzaUpC','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Hindi','all_purchases_finished_logs','Rack\x201','$date','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','staff','../public/language/languages.json','<hr\x20class=\x22my-3\x22>','$expiry_date','_id','Return\x20Goods','email','\x20</h2>','<h2>\x20','../middleware/auth','$product.room_name','INCF-','/incoming/add','$paid_amount','$gross_price','post','type_of_products','/view','/../public','prod_cat','$return_data','incoming_view','length','$primary_code','$sales_category','<h5\x20style=\x22text-align:\x20left;\x22>','prod_level','due_amount','$product_details.type','to_bay','gross_price','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<html><head><title></title>','$product_details.bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','add_purchases\x20error','/CheckingWarehouse','/barcode_scanner','Portuguese','createTransport','/picking_list/pdf_puchases_fin_own_trf/','maxPerUnit','secondary_code_hide','774258thzluY','2-digit','bin','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','Error\x20Occurs','Email\x20sent\x20successfully','maxStocks','get','$due_amount','suppliers','all_purchases_finished','5220584cHuTyy','to_quantity','$room','Enclosed',',\x20bay:\x20','type_of_products_type',',\x20bin:\x20','purchases_id','maxProducts','render','MaxStocks_data','string','min','$category','purchases_process','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','$product_details.storage','2262MRfyHa','The\x20Other\x20','purchase_invoice','product','concat','An\x20error\x20occurred.','invoice','DRY\x20GOODS','Arabic','Finished\x20Goods','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','Portuguese\x20(BR)','purchase\x20data\x20add\x20successfully','Arabic\x20(ae)','$product_details.rack','/process/:id','nodemailer','<span\x20style=\x22float:\x20right;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','toString','edit_purchases_finished_view','$suppliers_docs','</table>','all_purchases_barcode','exports','\x20===\x20','/getTRF','product_details','room_name','<!DOCTYPE\x20html>','image','secondary_code','441580nMOaYV','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','currency_placement','edit_purchases_finished','$product.floorlevel','\x20Order\x20Number\x20:\x20','random','to_recieved','date','$product_details.maxProducts','note','product_code','forEach','<div>','user','updateOne','expiry_date','product_stock','getMonth','password','suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product.quantity','$secondary_code','master','warehouse_name','$alertquantity','maxperunit','/incoming','secondary_unit','44FDmuRC','find','INC-','/all_purchases_finished/view','role','product_id','prod_code','===','$brand'];a0_0x194e=function(){return _0x28d336;};return a0_0x194e();}