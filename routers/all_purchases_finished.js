var a0_0x15df27=a0_0x1c67;(function(_0x1d8b30,_0x141549){var _0x3f50ed=a0_0x1c67,_0x2d9d82=_0x1d8b30();while(!![]){try{var _0x3aab47=-parseInt(_0x3f50ed(0x17f))/0x1+parseInt(_0x3f50ed(0x139))/0x2+parseInt(_0x3f50ed(0x15d))/0x3*(parseInt(_0x3f50ed(0x167))/0x4)+-parseInt(_0x3f50ed(0x1d9))/0x5*(parseInt(_0x3f50ed(0x157))/0x6)+parseInt(_0x3f50ed(0x22a))/0x7+-parseInt(_0x3f50ed(0x210))/0x8*(-parseInt(_0x3f50ed(0x14a))/0x9)+-parseInt(_0x3f50ed(0x107))/0xa;if(_0x3aab47===_0x141549)break;else _0x2d9d82['push'](_0x2d9d82['shift']());}catch(_0x109470){_0x2d9d82['push'](_0x2d9d82['shift']());}}}(a0_0xe4e2,0x89277));const express=require('express'),app=express(),router=express[a0_0x15df27(0x21d)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x15df27(0x17c)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require(a0_0x15df27(0x10e));const path=require('path'),users=require('../public/language/languages.json'),{isNull}=require(a0_0x15df27(0x12b));router[a0_0x15df27(0x1d1)](a0_0x15df27(0x22e),auth,async(_0x50c015,_0x5f201a)=>{var _0x50dbe0=a0_0x15df27;try{const {username:_0x23de87,email:_0x5dfb65,role:_0x3a797f}=_0x50c015[_0x50dbe0(0x20e)],_0x2224f9=_0x50c015[_0x50dbe0(0x20e)],_0x563f13=await profile[_0x50dbe0(0x1da)]({'email':_0x2224f9[_0x50dbe0(0x16f)]}),_0x25263c=await staff[_0x50dbe0(0x1da)]({'email':_0x2224f9[_0x50dbe0(0x16f)]}),_0xd4d28f=await master_shop[_0x50dbe0(0x128)]();let _0x3238d1=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x25263c[_0x50dbe0(0x159)]}}]);if(_0xd4d28f[0x0][_0x50dbe0(0x132)]=='English\x20(US)')var _0x527c70=users[_0x50dbe0(0x1b8)];else{if(_0xd4d28f[0x0]['language']==_0x50dbe0(0x1c6))var _0x527c70=users[_0x50dbe0(0x1c6)];else{if(_0xd4d28f[0x0]['language']==_0x50dbe0(0x1a7))var _0x527c70=users['German'];else{if(_0xd4d28f[0x0][_0x50dbe0(0x132)]==_0x50dbe0(0x1d3))var _0x527c70=users[_0x50dbe0(0x1d3)];else{if(_0xd4d28f[0x0][_0x50dbe0(0x132)]==_0x50dbe0(0x151))var _0x527c70=users['French'];else{if(_0xd4d28f[0x0]['language']==_0x50dbe0(0x15e))var _0x527c70=users[_0x50dbe0(0x15c)];else{if(_0xd4d28f[0x0][_0x50dbe0(0x132)]=='Chinese')var _0x527c70=users[_0x50dbe0(0x14e)];else{if(_0xd4d28f[0x0][_0x50dbe0(0x132)]==_0x50dbe0(0x155))var _0x527c70=users[_0x50dbe0(0x18e)];}}}}}}}_0x5f201a[_0x50dbe0(0x178)](_0x50dbe0(0x1ab),{'success':_0x50c015[_0x50dbe0(0x1cf)](_0x50dbe0(0x1cb)),'errors':_0x50c015[_0x50dbe0(0x1cf)](_0x50dbe0(0x113)),'purchases':_0x3238d1,'role':_0x2224f9,'profile':_0x563f13,'master_shop':_0xd4d28f,'language':_0x527c70,'staff_data':_0x25263c});}catch(_0x443db8){console[_0x50dbe0(0x199)](_0x50dbe0(0x221),_0x443db8),_0x5f201a[_0x50dbe0(0x192)](0xc8)[_0x50dbe0(0x217)]({'message':_0x443db8[_0x50dbe0(0x112)]});}}),router['get'](a0_0x15df27(0x17e),auth,async(_0x1be5ea,_0x2c1147)=>{var _0x42e1a0=a0_0x15df27;try{const {username:_0xd8f9d2,email:_0xe82df2,role:_0x121280}=_0x1be5ea['user'],_0x39f721=_0x1be5ea['user'],_0x312c2d=await profile['findOne']({'email':_0x39f721[_0x42e1a0(0x16f)]}),_0x58381a=await staff[_0x42e1a0(0x1da)]({'email':_0x39f721[_0x42e1a0(0x16f)]}),_0x129778=await master_shop['find']();let _0x5da733=await transfers_finished[_0x42e1a0(0x17a)]([{'$match':{'to_warehouse':_0x58381a['warehouse'],'to_recieved':_0x42e1a0(0x1ef)}}]);if(_0x129778[0x0][_0x42e1a0(0x132)]=='English\x20(US)')var _0x10368f=users[_0x42e1a0(0x1b8)];else{if(_0x129778[0x0]['language']==_0x42e1a0(0x1c6))var _0x10368f=users[_0x42e1a0(0x1c6)];else{if(_0x129778[0x0]['language']==_0x42e1a0(0x1a7))var _0x10368f=users[_0x42e1a0(0x1a7)];else{if(_0x129778[0x0][_0x42e1a0(0x132)]==_0x42e1a0(0x1d3))var _0x10368f=users['Spanish'];else{if(_0x129778[0x0][_0x42e1a0(0x132)]==_0x42e1a0(0x151))var _0x10368f=users['French'];else{if(_0x129778[0x0]['language']==_0x42e1a0(0x15e))var _0x10368f=users[_0x42e1a0(0x15c)];else{if(_0x129778[0x0][_0x42e1a0(0x132)]==_0x42e1a0(0x14e))var _0x10368f=users['Chinese'];else{if(_0x129778[0x0]['language']=='Arabic\x20(ae)')var _0x10368f=users['Arabic'];}}}}}}}_0x2c1147[_0x42e1a0(0x178)](_0x42e1a0(0x106),{'success':_0x1be5ea[_0x42e1a0(0x1cf)]('success'),'errors':_0x1be5ea[_0x42e1a0(0x1cf)]('errors'),'purchases':_0x5da733,'role':_0x39f721,'profile':_0x312c2d,'master_shop':_0x129778,'language':_0x10368f,'staff_data':_0x58381a});}catch(_0x4d79d3){console[_0x42e1a0(0x199)](_0x42e1a0(0x221),_0x4d79d3),_0x2c1147['status'](0xc8)[_0x42e1a0(0x217)]({'message':_0x4d79d3[_0x42e1a0(0x112)]});}});const createLog=async _0x917239=>{var _0x493589=a0_0x15df27;const _0x2b705c=new datalogs({'location':_0x917239});return await _0x2b705c[_0x493589(0x1d6)](),_0x2b705c[_0x493589(0x179)];};router['post'](a0_0x15df27(0x17e),auth,async(_0x4a9f6a,_0x5082a8)=>{var _0x15a13e=a0_0x15df27;try{const {invoice_trf_data:_0x48bf1e,item_code:_0x43f089,SCRN:_0x2433c7,ReqBy:_0x12db72,type_of_products:_0x318952,dateofreq:_0x3946de,PO_number:_0x1bc88e,date:_0x244f05,warehouse_name:_0x690508,typeservicesData:_0x34574b,typevehicle:_0x2c749b,driver:_0x22067b,plate:_0xfb8006,van:_0x4aeefa,DRSI:_0x10253a,TSU:_0x3e6357,TFU:_0x15b1bf,note:_0xbb37f}=_0x4a9f6a[_0x15a13e(0x191)],_0x53ded6=await transfers_finished[_0x15a13e(0x117)](_0x48bf1e);if(typeof _0x43f089==_0x15a13e(0x119))var _0x521ada=[_0x4a9f6a['body'][_0x15a13e(0x16c)]],_0x5d22ed=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x19a)]],_0x3710a2=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1eb)]],_0x86ed09=[_0x4a9f6a[_0x15a13e(0x191)]['unit']],_0x2d5a9e=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x146)]],_0x379302=[_0x4a9f6a['body'][_0x15a13e(0x16e)]],_0x2d6e70=[_0x4a9f6a[_0x15a13e(0x191)]['primary_code']],_0x10ed85=[_0x4a9f6a['body']['secondary_code']],_0x4c5cf3=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1e1)]],_0x4c3a60=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1aa)]],_0x32f0b2=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x203)]],_0x193ab8=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1c7)]],_0x18dc35=[_0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1ee)]];else var _0x521ada=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x16c)]],_0x5d22ed=[..._0x4a9f6a['body'][_0x15a13e(0x19a)]],_0x3710a2=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1eb)]],_0x86ed09=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1c0)]],_0x2d5a9e=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x146)]],_0x379302=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x16e)]],_0x2d6e70=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1a6)]],_0x10ed85=[..._0x4a9f6a['body'][_0x15a13e(0x134)]],_0x4c5cf3=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1e1)]],_0x4c3a60=[..._0x4a9f6a['body'][_0x15a13e(0x1aa)]],_0x32f0b2=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x203)]],_0x193ab8=[..._0x4a9f6a['body']['max_product_unit']],_0x18dc35=[..._0x4a9f6a[_0x15a13e(0x191)][_0x15a13e(0x1ee)]];const _0x1438ea=_0x521ada[_0x15a13e(0x169)](_0x224118=>{return _0x224118={'product_name':_0x224118};});_0x5d22ed[_0x15a13e(0x195)]((_0x20f4cf,_0x17c23b)=>{var _0x1477ce=_0x15a13e;_0x1438ea[_0x17c23b][_0x1477ce(0x126)]=_0x20f4cf;}),_0x3710a2[_0x15a13e(0x195)]((_0x2941a5,_0x3bf6aa)=>{var _0x13c5e1=_0x15a13e;_0x1438ea[_0x3bf6aa]['quantity']=Math[_0x13c5e1(0x1bf)](_0x2941a5);}),_0x86ed09[_0x15a13e(0x195)]((_0x2d550b,_0x1a9ac6)=>{var _0xe6232b=_0x15a13e;_0x1438ea[_0x1a9ac6][_0xe6232b(0x20a)]=_0x2d550b;}),_0x2d5a9e[_0x15a13e(0x195)]((_0x4c5075,_0x191c60)=>{var _0x1edc01=_0x15a13e;_0x1438ea[_0x191c60][_0x1edc01(0x22f)]=_0x4c5075;}),_0x379302[_0x15a13e(0x195)]((_0x308258,_0x172cdb)=>{var _0x5b34de=_0x15a13e,_0x46353a=_0x308258[_0x5b34de(0x224)](/[A-Za-z]+/)[0x0],_0x2b97cb=parseInt(_0x308258['match'](/\d+/)[0x0]);_0x1438ea[_0x172cdb][_0x5b34de(0x202)]=_0x46353a,_0x1438ea[_0x172cdb][_0x5b34de(0x196)]=_0x2b97cb;}),_0x2d6e70['forEach']((_0x4b55d6,_0x5a1e50)=>{var _0x1eca1a=_0x15a13e;_0x1438ea[_0x5a1e50][_0x1eca1a(0x1a6)]=_0x4b55d6;}),_0x10ed85[_0x15a13e(0x195)]((_0x61692a,_0x394cd1)=>{var _0xb817f4=_0x15a13e;_0x1438ea[_0x394cd1][_0xb817f4(0x134)]=_0x61692a;}),_0x4c5cf3[_0x15a13e(0x195)]((_0x17b64d,_0x33a619)=>{var _0x3f0a5c=_0x15a13e;_0x1438ea[_0x33a619][_0x3f0a5c(0x1e1)]=_0x17b64d;}),_0x4c3a60[_0x15a13e(0x195)]((_0x1914bc,_0x272e56)=>{_0x1438ea[_0x272e56]['expiry_date']=_0x1914bc;}),_0x32f0b2['forEach']((_0x27f404,_0x2b9918)=>{var _0xed69d8=_0x15a13e;_0x1438ea[_0x2b9918][_0xed69d8(0x203)]=_0x27f404;}),_0x193ab8[_0x15a13e(0x195)]((_0x55e495,_0x44e4ec)=>{var _0x345f5f=_0x15a13e;_0x1438ea[_0x44e4ec][_0x345f5f(0x1f4)]=_0x55e495;}),_0x18dc35['forEach']((_0x595cc8,_0x2433f6)=>{var _0x313938=_0x15a13e;_0x1438ea[_0x2433f6][_0x313938(0x1f9)]=_0x595cc8;});const _0xdd213c=await createLog(_0x15a13e(0x222));_0x18dc35[_0x15a13e(0x195)]((_0x1b25f3,_0x3dae61)=>{var _0x373b5d=_0x15a13e;_0x1438ea[_0x3dae61][_0x373b5d(0x1c4)]=_0x373b5d(0x185)+_0xdd213c['toString']()['padStart'](0x8,'0');});const _0xfc0386=_0x1438ea[_0x15a13e(0x20b)](_0x46e5ce=>_0x46e5ce[_0x15a13e(0x1db)]!=='0'&&_0x46e5ce[_0x15a13e(0x1db)]!==''),_0x3f7887=new purchases_incoming({'invoice':'INC-'+_0xdd213c[_0x15a13e(0x1b3)]()[_0x15a13e(0x1ed)](0x8,'0'),'date':_0x244f05,'warehouse_name':_0x690508,'product':_0xfc0386,'note':_0xbb37f,'POnumber':_0x1bc88e,'SCRN':_0x2433c7,'ReqBy':_0x12db72,'dateofreq':_0x3946de,'typeservicesData':_0x34574b,'van':_0x4aeefa,'typevehicle':_0x2c749b,'driver':_0x22067b,'plate':_0xfb8006,'DRSI':_0x10253a,'TSU':_0x3e6357,'TFU':_0x15b1bf,'typeOfProducts':_0x318952}),_0x2c52c9=await _0x3f7887[_0x15a13e(0x1d6)](),_0x15a59e=_0x2c52c9['product']['map'](async _0x420243=>{var _0x5aac20=_0x15a13e,_0x4e4a88=await warehouse[_0x5aac20(0x1da)]({'name':_0x690508,'room':_0x420243[_0x5aac20(0x1f9)]});if(_0x420243[_0x5aac20(0x1db)]>0x0){var _0xf90de2=0x0;const _0x2d89ef=_0x4e4a88[_0x5aac20(0x1e4)][_0x5aac20(0x169)](_0x307d99=>{var _0x54af91=_0x5aac20;_0x307d99[_0x54af91(0x16c)]==_0x420243[_0x54af91(0x16c)]&&_0x307d99[_0x54af91(0x196)]==_0x420243[_0x54af91(0x204)]&&_0x307d99['expiry_date']==_0x420243[_0x54af91(0x1aa)]&&_0x307d99['production_date']==_0x420243[_0x54af91(0x203)]&&_0x307d99['batch_code']==_0x420243[_0x54af91(0x1e1)]&&_0x307d99[_0x54af91(0x1c4)]==_0x420243[_0x54af91(0x1c4)]&&(typeof _0x420243[_0x54af91(0x168)]==_0x54af91(0x17d)?(console[_0x54af91(0x199)]('here2',_0x307d99[_0x54af91(0x165)]+_0x54af91(0x103)+_0x307d99[_0x54af91(0x15b)]+'\x20<=>\x20'+Math[_0x54af91(0x1bf)](_0x307d99[_0x54af91(0x165)])+Math[_0x54af91(0x1bf)](_0x420243[_0x54af91(0x1eb)])),_0x307d99['product_stock']=Math[_0x54af91(0x1bf)](_0x307d99[_0x54af91(0x165)])+Math['abs'](_0x420243[_0x54af91(0x1db)])):(_0x307d99[_0x54af91(0x165)]=Math[_0x54af91(0x1bf)](_0x307d99[_0x54af91(0x165)])+Math['abs'](_0x420243[_0x54af91(0x1db)]),_0xf90de2++));});_0xf90de2=='0'&&(_0x4e4a88[_0x5aac20(0x1e4)]=_0x4e4a88[_0x5aac20(0x1e4)]['concat']({'product_name':_0x420243[_0x5aac20(0x16c)],'product_stock':_0x420243[_0x5aac20(0x1db)],'bay':_0x420243[_0x5aac20(0x196)],'level':_0x420243[_0x5aac20(0x202)],'product_code':_0x420243[_0x5aac20(0x126)],'primary_code':_0x420243[_0x5aac20(0x1a6)],'secondary_code':_0x420243[_0x5aac20(0x134)],'expiry_date':_0x420243[_0x5aac20(0x1aa)],'production_date':_0x420243[_0x5aac20(0x203)],'maxProducts':_0x420243[_0x5aac20(0x1f3)],'batch_code':_0x420243['batch_code'],'secondary_unit':_0x420243['secondary_unit'],'unit':_0x420243[_0x5aac20(0x20a)],'maxProducts':_0x420243[_0x5aac20(0x1f3)],'maxPerUnit':_0x420243[_0x5aac20(0x223)],'invoice':_0x420243[_0x5aac20(0x1c4)]}));}return _0x4e4a88;});Promise[_0x15a13e(0x153)](_0x15a59e)['then'](async _0x442021=>{var _0xe0681f=_0x15a13e;try{for(const _0x701b9b of _0x442021){await warehouse[_0xe0681f(0x188)]({'_id':_0x701b9b[_0xe0681f(0x15b)]},{'$addToSet':{'product_details':{'$each':_0x701b9b[_0xe0681f(0x1e4)]}}});}_0x53ded6[_0xe0681f(0x1fd)]=_0xe0681f(0x122);const _0x2ac51d=await _0x53ded6['save'](),_0xca87ed=await master_shop[_0xe0681f(0x128)](),_0x5e8944=await email_settings[_0xe0681f(0x1da)](),_0x52f4e1=await supervisor_settings[_0xe0681f(0x128)]();var _0x379432=_0x3f7887[_0xe0681f(0x17b)],_0x5f56b1='',_0x207ef0;for(_0x207ef0 in _0x379432){var _0x503510='FG';_0x3f7887['to_warehouse']==_0xe0681f(0x154)&&(_0x503510='DG'),_0x5f56b1+='<tr>'+_0xe0681f(0x1c9)+_0x379432[_0x207ef0]['product_name']+_0xe0681f(0x1e7)+_0xe0681f(0x1c9)+_0x379432[_0x207ef0][_0xe0681f(0x126)]+_0xe0681f(0x1e7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x379432[_0x207ef0][_0xe0681f(0x1eb)]+_0xe0681f(0x1e7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x379432[_0x207ef0][_0xe0681f(0x1c0)]+'</td>'+_0xe0681f(0x1c9)+_0x379432[_0x207ef0][_0xe0681f(0x22f)]+'</td>'+_0xe0681f(0x1c9)+_0x3f7887[_0xe0681f(0x1fe)]+_0xe0681f(0x1e7)+_0xe0681f(0x1c9)+_0x379432[_0x207ef0]['to_room_name']+_0xe0681f(0x1e7)+_0xe0681f(0x1c9)+_0x503510+_0x379432[_0x207ef0]['to_bay']+_0xe0681f(0x1e7)+_0xe0681f(0x13d);}_0x4a9f6a[_0xe0681f(0x1cf)](_0xe0681f(0x1cb),_0xe0681f(0x136)),_0x5082a8['redirect']('/picking_list/pdf_puchases_fin_own_trf/'+_0x2c52c9['_id']);}catch(_0x46c98f){console[_0xe0681f(0x124)](_0x46c98f),_0x5082a8[_0xe0681f(0x192)](0x1f4)['json']({'error':_0xe0681f(0x116)});}})['catch'](_0x2d68f2=>{var _0x406694=_0x15a13e;console['error'](_0x2d68f2),_0x5082a8[_0x406694(0x192)](0x1f4)[_0x406694(0x217)]({'error':'An\x20error\x20occurred.'});});}catch(_0x167e7a){}}),router[a0_0x15df27(0x121)](a0_0x15df27(0x13b),auth,async(_0x1ff93e,_0x29193c)=>{var _0x2d49f2=a0_0x15df27;try{const {warehouse:_0x4fe3fa}=_0x1ff93e['body'],_0x1b3bb7=await transfers_finished[_0x2d49f2(0x128)]({'to_warehouse':_0x4fe3fa,'to_recieved':_0x2d49f2(0x1ef)});_0x29193c[_0x2d49f2(0x217)](_0x1b3bb7);}catch(_0x1ad9fd){}}),router['post'](a0_0x15df27(0x1b1),auth,async(_0x5b936a,_0x5e8b1e)=>{var _0x2b5b7d=a0_0x15df27;try{const {invoice:_0x4cf483}=_0x5b936a[_0x2b5b7d(0x191)],_0x78124e=await transfers_finished['find']({'_id':_0x4cf483,'to_recieved':_0x2b5b7d(0x1ef)});_0x5e8b1e[_0x2b5b7d(0x217)](_0x78124e);}catch(_0x546d26){}}),router['get'](a0_0x15df27(0x213),auth,async(_0x16919f,_0x5f5a60)=>{var _0x383c4d=a0_0x15df27;try{const {username:_0x3ba552,email:_0x5f07a6,role:_0x24c680}=_0x16919f[_0x383c4d(0x20e)],_0x39e6f1=_0x16919f[_0x383c4d(0x20e)],_0x5b1c58=await profile['findOne']({'email':_0x39e6f1[_0x383c4d(0x16f)]}),_0x2547c6=await staff['findOne']({'email':_0x39e6f1[_0x383c4d(0x16f)]});if(_0x39e6f1[_0x383c4d(0x232)]==_0x383c4d(0x11f)){const _0x37a24e=await staff['findOne']({'email':_0x39e6f1['email']});}const _0x578261=await master_shop[_0x383c4d(0x128)]();let _0x4be6e1;if(_0x39e6f1[_0x383c4d(0x232)]==_0x383c4d(0x11f)){const _0x2fe277=await staff[_0x383c4d(0x1da)]({'email':_0x39e6f1[_0x383c4d(0x16f)]});_0x4be6e1=await purchases_finished[_0x383c4d(0x17a)]([{'$match':{'warehouse_name':_0x2fe277[_0x383c4d(0x159)],'typeOfProducts':_0x383c4d(0x160)}},{'$lookup':{'from':'suppliers','localField':_0x383c4d(0x1ba),'foreignField':_0x383c4d(0xf5),'as':_0x383c4d(0x1ff)}},{'$unwind':_0x383c4d(0x148)},{'$unwind':_0x383c4d(0x156)},{'$group':{'_id':_0x383c4d(0x162),'invoice':{'$first':_0x383c4d(0x208)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x383c4d(0x175)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x383c4d(0xfd)},'product':{'$push':_0x383c4d(0x156)},'note':{'$first':_0x383c4d(0x1fa)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x383c4d(0x131)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x383c4d(0x1bd)},'expiry_date':{'$first':_0x383c4d(0x1d7)},'suppliers_docs':{'$first':_0x383c4d(0x148)},'total_product_quantity':{'$sum':_0x383c4d(0x1d2)},'level':{'$addToSet':_0x383c4d(0x10b)},'isle':{'$addToSet':_0x383c4d(0x214)},'type':{'$addToSet':_0x383c4d(0x1a3)},'floorlevel':{'$addToSet':_0x383c4d(0x1e8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4be6e1=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x383c4d(0x160)}},{'$unwind':_0x383c4d(0x156)},{'$group':{'_id':_0x383c4d(0x162),'invoice':{'$first':_0x383c4d(0x208)},'suppliers':{'$first':_0x383c4d(0x1a1)},'date':{'$first':_0x383c4d(0x175)},'warehouse_name':{'$first':_0x383c4d(0x12f)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x383c4d(0x156)},'note':{'$first':_0x383c4d(0x1fa)},'paid_amount':{'$first':_0x383c4d(0xfb)},'due_amount':{'$first':_0x383c4d(0x131)},'return_data':{'$first':_0x383c4d(0x177)},'batch_code':{'$first':_0x383c4d(0x1bd)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x383c4d(0x148)},'total_product_quantity':{'$sum':_0x383c4d(0x1d2)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x383c4d(0x1a3)},'floorlevel':{'$addToSet':_0x383c4d(0x1e8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x578261[0x0]['language']==_0x383c4d(0x1dc))var _0x47e848=users[_0x383c4d(0x1b8)];else{if(_0x578261[0x0][_0x383c4d(0x132)]=='Hindi')var _0x47e848=users[_0x383c4d(0x1c6)];else{if(_0x578261[0x0][_0x383c4d(0x132)]==_0x383c4d(0x1a7))var _0x47e848=users[_0x383c4d(0x1a7)];else{if(_0x578261[0x0]['language']=='Spanish')var _0x47e848=users[_0x383c4d(0x1d3)];else{if(_0x578261[0x0][_0x383c4d(0x132)]=='French')var _0x47e848=users['French'];else{if(_0x578261[0x0][_0x383c4d(0x132)]=='Portuguese\x20(BR)')var _0x47e848=users['Portuguese'];else{if(_0x578261[0x0][_0x383c4d(0x132)]==_0x383c4d(0x14e))var _0x47e848=users[_0x383c4d(0x14e)];else{if(_0x578261[0x0][_0x383c4d(0x132)]==_0x383c4d(0x155))var _0x47e848=users[_0x383c4d(0x18e)];}}}}}}}_0x5f5a60[_0x383c4d(0x178)]('all_purchases_finished',{'success':_0x16919f[_0x383c4d(0x1cf)](_0x383c4d(0x1cb)),'errors':_0x16919f[_0x383c4d(0x1cf)](_0x383c4d(0x113)),'purchases':_0x4be6e1,'role':_0x39e6f1,'profile':_0x5b1c58,'master_shop':_0x578261,'language':_0x47e848});}catch(_0x437272){console[_0x383c4d(0x199)](_0x383c4d(0x221),_0x437272),_0x5f5a60[_0x383c4d(0x192)](0xc8)[_0x383c4d(0x217)]({'message':_0x437272[_0x383c4d(0x112)]});}}),router['get'](a0_0x15df27(0xf9),auth,async(_0x335d4c,_0x25f270)=>{var _0xaaac40=a0_0x15df27;try{const {username:_0x1c1239,email:_0x1b878d,role:_0x5a7318}=_0x335d4c[_0xaaac40(0x20e)],_0x285efa=_0x335d4c['user'],_0x29ac48=await profile[_0xaaac40(0x1da)]({'email':_0x285efa[_0xaaac40(0x16f)]}),_0x4f429c=await staff[_0xaaac40(0x1da)]({'email':_0x285efa['email']});if(_0x285efa[_0xaaac40(0x232)]=='staff'){const _0x4ff607=await staff[_0xaaac40(0x1da)]({'email':_0x285efa[_0xaaac40(0x16f)]});}const _0x3d1bb5=await master_shop[_0xaaac40(0x128)]();let _0x5c61e2;if(_0x285efa[_0xaaac40(0x232)]==_0xaaac40(0x11f)){const _0x299686=await staff['findOne']({'email':_0x285efa['email']});_0x5c61e2=await purchases_finished[_0xaaac40(0x17a)]([{'$match':{'warehouse_name':_0x299686['warehouse']}},{'$lookup':{'from':_0xaaac40(0x1ba),'localField':_0xaaac40(0x1ba),'foreignField':_0xaaac40(0xf5),'as':_0xaaac40(0x1ff)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0xaaac40(0x162),'invoice':{'$first':_0xaaac40(0x208)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xaaac40(0x12f)},'room':{'$first':_0xaaac40(0xfd)},'product':{'$push':'$product'},'note':{'$first':_0xaaac40(0x1fa)},'paid_amount':{'$first':_0xaaac40(0xfb)},'due_amount':{'$first':_0xaaac40(0x131)},'return_data':{'$first':_0xaaac40(0x177)},'batch_code':{'$first':_0xaaac40(0x1bd)},'expiry_date':{'$first':_0xaaac40(0x1d7)},'suppliers_docs':{'$first':_0xaaac40(0x148)},'total_product_quantity':{'$sum':_0xaaac40(0x1d2)},'level':{'$addToSet':_0xaaac40(0x10b)},'isle':{'$addToSet':_0xaaac40(0x214)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xaaac40(0x1e8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5c61e2=await purchases_finished[_0xaaac40(0x17a)]([{'$match':{'typeOfProducts':_0xaaac40(0x1b7)}},{'$unwind':_0xaaac40(0x156)},{'$group':{'_id':_0xaaac40(0x162),'invoice':{'$first':_0xaaac40(0x208)},'suppliers':{'$first':_0xaaac40(0x1a1)},'date':{'$first':_0xaaac40(0x175)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0xaaac40(0x137)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0xaaac40(0xfb)},'due_amount':{'$first':_0xaaac40(0x131)},'return_data':{'$first':_0xaaac40(0x177)},'batch_code':{'$first':_0xaaac40(0x1bd)},'expiry_date':{'$first':_0xaaac40(0x1d7)},'suppliers_docs':{'$first':_0xaaac40(0x148)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0xaaac40(0x10b)},'isle':{'$addToSet':_0xaaac40(0x214)},'type':{'$addToSet':_0xaaac40(0x1a3)},'floorlevel':{'$addToSet':_0xaaac40(0x1e8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x1dc))var _0x30a77b=users['English'];else{if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x1c6))var _0x30a77b=users['Hindi'];else{if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x1a7))var _0x30a77b=users[_0xaaac40(0x1a7)];else{if(_0x3d1bb5[0x0]['language']==_0xaaac40(0x1d3))var _0x30a77b=users[_0xaaac40(0x1d3)];else{if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x151))var _0x30a77b=users[_0xaaac40(0x151)];else{if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x15e))var _0x30a77b=users[_0xaaac40(0x15c)];else{if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x14e))var _0x30a77b=users['Chinese'];else{if(_0x3d1bb5[0x0][_0xaaac40(0x132)]==_0xaaac40(0x155))var _0x30a77b=users[_0xaaac40(0x18e)];}}}}}}}_0x25f270[_0xaaac40(0x178)]('all_purchases_finished_logs',{'success':_0x335d4c[_0xaaac40(0x1cf)](_0xaaac40(0x1cb)),'errors':_0x335d4c[_0xaaac40(0x1cf)]('errors'),'purchases':_0x5c61e2,'role':_0x285efa,'profile':_0x29ac48,'master_shop':_0x3d1bb5,'language':_0x30a77b});}catch(_0x596b21){console[_0xaaac40(0x199)](_0xaaac40(0x221),_0x596b21),_0x25f270[_0xaaac40(0x192)](0xc8)['json']({'message':_0x596b21[_0xaaac40(0x112)]});}});function a0_0x1c67(_0x24c14c,_0x140ed6){var _0xe4e268=a0_0xe4e2();return a0_0x1c67=function(_0x1c67fd,_0x2db843){_0x1c67fd=_0x1c67fd-0xf2;var _0x5b13dd=_0xe4e268[_0x1c67fd];return _0x5b13dd;},a0_0x1c67(_0x24c14c,_0x140ed6);}function BayBinSelected(_0x780f1e,_0x369c06){var _0x574b2a=a0_0x15df27,_0x239464=[],_0x31da12=[];if(_0x780f1e==_0x574b2a(0x154)){switch(_0x369c06){case _0x574b2a(0x1c5):_0x239464=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x574b2a(0xf8):_0x239464=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x31da12=['DG'];}else{if(_0x780f1e==_0x574b2a(0x21c)){switch(_0x369c06){case _0x574b2a(0x1c5):_0x239464=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x574b2a(0xf8):_0x239464=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x31da12=['FG'];}}return{'levels':_0x239464,'identify':_0x31da12};}async function getRandom8DigitNumber(){var _0x197c42=a0_0x15df27;const _0x61e3c1=0x989680,_0x13f94c=0x5f5e0ff,_0x194bd1=Math[_0x197c42(0x141)](Math[_0x197c42(0x212)]()*(_0x13f94c-_0x61e3c1+0x1))+_0x61e3c1;var _0x2be881;const _0x27fe02=await purchases_finished[_0x197c42(0x1da)]({'invoice':_0x197c42(0x21f)+_0x194bd1});return _0x27fe02&&_0x27fe02[_0x197c42(0x1a4)]>0x0?_0x2be881=_0x197c42(0x21f)+_0x194bd1:_0x2be881=_0x197c42(0x21f)+_0x194bd1,_0x2be881;}router[a0_0x15df27(0x1d1)](a0_0x15df27(0x10a),auth,async(_0x3dbd4c,_0x4d1bf5)=>{var _0x3eaaf2=a0_0x15df27;try{const {username:_0x44b057,email:_0xb3e3ee,role:_0x34df2c}=_0x3dbd4c['user'],_0x1db815=_0x3dbd4c['user'],_0x395931=await profile['findOne']({'email':_0x1db815['email']}),_0x12e6ad=await master_shop['find'](),_0x5398c6=await staff[_0x3eaaf2(0x1da)]({'email':_0x1db815[_0x3eaaf2(0x16f)]}),_0xc09f60=await suppliers[_0x3eaaf2(0x128)]({});let _0x3f8d8a;if(_0x1db815[_0x3eaaf2(0x232)]==_0x3eaaf2(0x11f)){const _0x54b0b9=await staff[_0x3eaaf2(0x1da)]({'email':_0x1db815[_0x3eaaf2(0x16f)]});_0x3f8d8a=await warehouse[_0x3eaaf2(0x17a)]([{'$match':{'status':_0x3eaaf2(0x198),'name':_0x54b0b9[_0x3eaaf2(0x159)]}},{'$group':{'_id':_0x3eaaf2(0x206),'name':{'$first':_0x3eaaf2(0x206)}}}]);}else _0x3f8d8a=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3eaaf2(0x206),'name':{'$first':'$name'}}}]);const _0x5017fd=await product[_0x3eaaf2(0x128)]({}),_0x34eb4c=await warehouse[_0x3eaaf2(0x128)]({'status':'Enabled'}),_0x1c6256=await purchases_finished['find']({}),_0x2b7ce8=_0x1c6256['length']+0x1,_0xbb37b1=_0x3eaaf2(0x21f)+_0x2b7ce8[_0x3eaaf2(0x1b3)]()['padStart'](0x5,'0');var _0x3041e1=[_0x3eaaf2(0x13f),_0x3eaaf2(0x1ce)];if(_0x12e6ad[0x0][_0x3eaaf2(0x132)]==_0x3eaaf2(0x1dc))var _0x4703aa=users[_0x3eaaf2(0x1b8)];else{if(_0x12e6ad[0x0][_0x3eaaf2(0x132)]==_0x3eaaf2(0x1c6))var _0x4703aa=users[_0x3eaaf2(0x1c6)];else{if(_0x12e6ad[0x0]['language']==_0x3eaaf2(0x1a7))var _0x4703aa=users[_0x3eaaf2(0x1a7)];else{if(_0x12e6ad[0x0]['language']==_0x3eaaf2(0x1d3))var _0x4703aa=users['Spanish'];else{if(_0x12e6ad[0x0]['language']==_0x3eaaf2(0x151))var _0x4703aa=users['French'];else{if(_0x12e6ad[0x0][_0x3eaaf2(0x132)]==_0x3eaaf2(0x15e))var _0x4703aa=users[_0x3eaaf2(0x15c)];else{if(_0x12e6ad[0x0][_0x3eaaf2(0x132)]==_0x3eaaf2(0x14e))var _0x4703aa=users[_0x3eaaf2(0x14e)];else{if(_0x12e6ad[0x0][_0x3eaaf2(0x132)]=='Arabic\x20(ae)')var _0x4703aa=users[_0x3eaaf2(0x18e)];}}}}}}}const _0x33c8c3=getRandom8DigitNumber(),_0x2c9b92=new Date(),_0x5aa015={'year':_0x3eaaf2(0xff),'month':_0x3eaaf2(0x186),'day':_0x3eaaf2(0x186),'timeZone':_0x3eaaf2(0x1c8)},_0xf602cc=_0x2c9b92[_0x3eaaf2(0x1bc)](_0x3eaaf2(0x1a8),_0x5aa015);console[_0x3eaaf2(0x199)](_0xf602cc),_0x33c8c3['then'](_0x4262c2=>{var _0x26cf64=_0x3eaaf2;_0x4d1bf5[_0x26cf64(0x178)](_0x26cf64(0x1f8),{'success':_0x3dbd4c['flash']('success'),'errors':_0x3dbd4c[_0x26cf64(0x1cf)](_0x26cf64(0x113)),'role':_0x1db815,'profile':_0x395931,'suppliers':_0xc09f60,'warehouse':_0x3f8d8a,'product':_0x5017fd,'invoice':_0x4262c2,'master_shop':_0x12e6ad,'language':_0x4703aa,'find_data':_0x34eb4c,'rooms_data':_0x3041e1,'formattedDate':_0xf602cc});})['catch'](_0x59e5cd=>{var _0x1b00df=_0x3eaaf2;_0x3dbd4c[_0x1b00df(0x1cf)](_0x1b00df(0x113),_0x1b00df(0x108)),_0x4d1bf5[_0x1b00df(0x10d)]('/all_purchases_finished/view');});}catch(_0x350fc0){console['log'](_0x350fc0);}}),router[a0_0x15df27(0x1d1)](a0_0x15df27(0x10f),auth,async(_0x2e40a6,_0x35c563)=>{var _0x451ac1=a0_0x15df27;try{const {username:_0x891c09,email:_0x2635c2,role:_0x3f6f88}=_0x2e40a6[_0x451ac1(0x20e)],_0x452676=_0x2e40a6[_0x451ac1(0x20e)],_0x31849b=await profile[_0x451ac1(0x1da)]({'email':_0x452676[_0x451ac1(0x16f)]}),_0x800397=await master_shop['find'](),_0x1147ef=await staff[_0x451ac1(0x1da)]({'email':_0x452676[_0x451ac1(0x16f)]}),_0x2fa4f2=await suppliers[_0x451ac1(0x128)]({});let _0x5afa2c;if(_0x452676[_0x451ac1(0x232)]==_0x451ac1(0x11f)){const _0x532f94=await staff['findOne']({'email':_0x452676[_0x451ac1(0x16f)]});_0x5afa2c=await warehouse['aggregate']([{'$match':{'status':_0x451ac1(0x198),'name':_0x532f94[_0x451ac1(0x159)]}},{'$group':{'_id':'$name','name':{'$first':_0x451ac1(0x206)}}}]);}else _0x5afa2c=await warehouse[_0x451ac1(0x17a)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x451ac1(0x206),'name':{'$first':'$name'}}}]);const _0x31ab93=await product[_0x451ac1(0x128)]({}),_0x2cd69b=await warehouse[_0x451ac1(0x128)]({'status':_0x451ac1(0x198)}),_0xb5f6ec=await purchases_finished[_0x451ac1(0x128)]({}),_0x19cd1e=_0xb5f6ec[_0x451ac1(0x1a4)]+0x1,_0x331836='INCF-'+_0x19cd1e[_0x451ac1(0x1b3)]()[_0x451ac1(0x1ed)](0x5,'0');var _0x275d5b=[_0x451ac1(0x13f),_0x451ac1(0x1ce)];if(_0x800397[0x0][_0x451ac1(0x132)]=='English\x20(US)')var _0x1f61d2=users[_0x451ac1(0x1b8)];else{if(_0x800397[0x0][_0x451ac1(0x132)]=='Hindi')var _0x1f61d2=users[_0x451ac1(0x1c6)];else{if(_0x800397[0x0][_0x451ac1(0x132)]==_0x451ac1(0x1a7))var _0x1f61d2=users[_0x451ac1(0x1a7)];else{if(_0x800397[0x0][_0x451ac1(0x132)]=='Spanish')var _0x1f61d2=users[_0x451ac1(0x1d3)];else{if(_0x800397[0x0]['language']=='French')var _0x1f61d2=users[_0x451ac1(0x151)];else{if(_0x800397[0x0][_0x451ac1(0x132)]=='Portuguese\x20(BR)')var _0x1f61d2=users[_0x451ac1(0x15c)];else{if(_0x800397[0x0]['language']==_0x451ac1(0x14e))var _0x1f61d2=users[_0x451ac1(0x14e)];else{if(_0x800397[0x0][_0x451ac1(0x132)]=='Arabic\x20(ae)')var _0x1f61d2=users[_0x451ac1(0x18e)];}}}}}}}const _0x2b0040=getRandom8DigitNumber();_0x2b0040['then'](_0x2f8ca8=>{var _0x33a28b=_0x451ac1;_0x35c563[_0x33a28b(0x178)](_0x33a28b(0x1d8),{'success':_0x2e40a6['flash'](_0x33a28b(0x1cb)),'errors':_0x2e40a6[_0x33a28b(0x1cf)](_0x33a28b(0x113)),'role':_0x452676,'profile':_0x31849b,'suppliers':_0x2fa4f2,'warehouse':_0x5afa2c,'product':_0x31ab93,'invoice':_0x2f8ca8,'master_shop':_0x800397,'language':_0x1f61d2,'find_data':_0x2cd69b,'rooms_data':_0x275d5b});})['catch'](_0x3e1391=>{var _0x3e00b1=_0x451ac1;_0x2e40a6[_0x3e00b1(0x1cf)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x35c563[_0x3e00b1(0x10d)](_0x3e00b1(0x1cd));});}catch(_0x560941){console[_0x451ac1(0x199)](_0x560941);}}),router['get'](a0_0x15df27(0x1a9),auth,async(_0x2d04cd,_0x23e06d)=>{var _0x4282a6=a0_0x15df27;try{const _0x4e2c5d=_0x2d04cd['params']['id'];console[_0x4282a6(0x199)](_0x4e2c5d);const _0x4c5178=await master_shop[_0x4282a6(0x128)]();console['log'](_0x4282a6(0x20c),_0x4c5178);const _0xb6607a=await product[_0x4282a6(0x1da)]({'name':_0x4e2c5d});console['log'](_0x4282a6(0x17b),_0xb6607a),_0x23e06d['status'](0xc8)[_0x4282a6(0x217)]({'product_data':_0xb6607a,'master':_0x4c5178});}catch(_0x3e0459){console[_0x4282a6(0x199)](_0x4282a6(0x101),_0x3e0459);}}),router['post']('/view/add_purchases',auth,async(_0x39adad,_0x131261)=>{var _0x7260e0=a0_0x15df27;try{const {invoice:_0x42bd78,date:_0x4712a0,warehouse_name:_0x4fc204,prod_name:_0x20be47,note:_0xb1af31,due_amount:_0x4e7bb5,Room_name:_0x2add8d,PO_number:_0x278d1f,SCRN:_0x218b65,ReqBy:_0xb2ab4e,dateofreq:_0x24d089,suppliers:_0x65663f,typeservicesData:_0x205dc4,van:_0x2e4447,typevehicle:_0xd09d82,driver:_0xdc70e5,plate:_0xdf1f28,DRSI:_0x597e4a,TSU:_0x175f4d,TFU:_0x58338f,JO_number:_0x101b8b,type_of_products:_0x44c84a}=_0x39adad[_0x7260e0(0x191)];if(typeof _0x20be47==_0x7260e0(0x119))var _0x3845fa=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x111)]],_0x22eb15=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x220)]],_0x4128d3=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1ae)]],_0x2fefd6=[_0x39adad[_0x7260e0(0x191)]['prod_primunit']],_0x308cc6=[_0x39adad[_0x7260e0(0x191)]['prod_secondunit']],_0x5b2143=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x166)]],_0x7c7fdb=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1a6)]],_0x151e66=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x134)]],_0x51bcaf=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1e2)]],_0x56ea24=[_0x39adad[_0x7260e0(0x191)]['batch_code']],_0x20ab6a=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1aa)]],_0x56fd56=[_0x39adad['body'][_0x7260e0(0x16a)]],_0x42f105=[_0x39adad[_0x7260e0(0x191)]['max_product_unit']],_0x2ae687=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x218)]],_0x256709=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1e3)]],_0x340196=[_0x39adad[_0x7260e0(0x191)]['gross_price']],_0x47021a=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x197)]],_0x986e11=[_0x39adad[_0x7260e0(0x191)]['sales_data_cateory']],_0x3d336b=[_0x39adad[_0x7260e0(0x191)][_0x7260e0(0x118)]];else var _0x3845fa=[..._0x39adad['body'][_0x7260e0(0x111)]],_0x22eb15=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x220)]],_0x4128d3=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1ae)]],_0x2fefd6=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x11a)]],_0x308cc6=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x146)]],_0x5b2143=[..._0x39adad['body'][_0x7260e0(0x166)]],_0x7c7fdb=[..._0x39adad[_0x7260e0(0x191)]['primary_code']],_0x151e66=[..._0x39adad[_0x7260e0(0x191)]['secondary_code']],_0x51bcaf=[..._0x39adad['body']['MaxStocks_data']],_0x56ea24=[..._0x39adad[_0x7260e0(0x191)]['batch_code']],_0x20ab6a=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x1aa)]],_0x56fd56=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x16a)]],_0x42f105=[..._0x39adad['body'][_0x7260e0(0x1c7)]],_0x2ae687=[..._0x39adad['body']['prod_cat']],_0x256709=[..._0x39adad[_0x7260e0(0x191)]['RoomAssign']],_0x340196=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x229)]],_0x47021a=[..._0x39adad['body']['uuid']],_0x986e11=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x171)]],_0x3d336b=[..._0x39adad[_0x7260e0(0x191)][_0x7260e0(0x118)]];const _0x232282=_0x3845fa[_0x7260e0(0x169)](_0x1bc3af=>{return _0x1bc3af={'product_name':_0x1bc3af};});_0x3d336b['forEach']((_0x15e328,_0x5386f8)=>{var _0x3f872c=_0x7260e0;_0x232282[_0x5386f8]['product_id']=_0x15e328,_0x232282[_0x5386f8][_0x3f872c(0x152)]=_0x4712a0;}),_0x986e11[_0x7260e0(0x195)]((_0x20d9ba,_0x374813)=>{var _0x2dd3e2=_0x7260e0;_0x232282[_0x374813][_0x2dd3e2(0x1b2)]=_0x20d9ba;}),_0x22eb15[_0x7260e0(0x195)]((_0x3b3371,_0x349acf)=>{var _0xc1f1de=_0x7260e0;_0x232282[_0x349acf][_0xc1f1de(0x126)]=_0x3b3371;}),_0x47021a[_0x7260e0(0x195)]((_0x1751aa,_0x511aa8)=>{var _0x479cb2=_0x7260e0;_0x232282[_0x511aa8][_0x479cb2(0x197)]=_0x1751aa;}),_0x4128d3[_0x7260e0(0x195)]((_0x3ad3a3,_0x563aff)=>{var _0x332047=_0x7260e0;_0x232282[_0x563aff][_0x332047(0x1db)]=Math['abs'](_0x3ad3a3);}),_0x2fefd6[_0x7260e0(0x195)]((_0x288d75,_0xc7c305)=>{var _0x4e7880=_0x7260e0;_0x232282[_0xc7c305][_0x4e7880(0x20a)]=_0x288d75;}),_0x308cc6[_0x7260e0(0x195)]((_0x4b868c,_0x5d2930)=>{var _0x19ac5d=_0x7260e0;_0x232282[_0x5d2930][_0x19ac5d(0x22f)]=_0x4b868c;}),_0x7c7fdb['forEach']((_0x244eea,_0x18067b)=>{var _0x4f5091=_0x7260e0;_0x232282[_0x18067b][_0x4f5091(0x1a6)]=_0x244eea;}),_0x151e66[_0x7260e0(0x195)]((_0x3f4f0c,_0x2eb4e9)=>{var _0x9de714=_0x7260e0;_0x232282[_0x2eb4e9][_0x9de714(0x134)]=_0x3f4f0c;}),_0x51bcaf[_0x7260e0(0x195)]((_0x2a3d9e,_0x381f9d)=>{var _0x222d9b=_0x7260e0;_0x232282[_0x381f9d][_0x222d9b(0x1af)]=_0x2a3d9e;}),_0x56ea24['forEach']((_0x1b3947,_0x4684cd)=>{var _0x1e74ce=_0x7260e0;_0x232282[_0x4684cd][_0x1e74ce(0x1e1)]=_0x1b3947;}),_0x20ab6a[_0x7260e0(0x195)]((_0x301607,_0x1f4d0b)=>{var _0x5bd55f=_0x7260e0;_0x232282[_0x1f4d0b][_0x5bd55f(0x1aa)]=_0x301607;}),_0x56fd56[_0x7260e0(0x195)]((_0x4b6085,_0x1d26db)=>{_0x232282[_0x1d26db]['production_date']=_0x4b6085;}),_0x42f105[_0x7260e0(0x195)]((_0x24ebae,_0x3cb57c)=>{_0x232282[_0x3cb57c]['maxperunit']=_0x24ebae;}),_0x2ae687[_0x7260e0(0x195)]((_0x494936,_0x384883)=>{_0x232282[_0x384883]['product_cat']=_0x494936;}),_0x256709['forEach']((_0xd0e8d2,_0x39744a)=>{var _0x34554e=_0x7260e0;_0x232282[_0x39744a][_0x34554e(0x1f9)]=_0xd0e8d2;}),_0x340196[_0x7260e0(0x195)]((_0x3675de,_0x1ab146)=>{var _0x520364=_0x7260e0;_0x232282[_0x1ab146][_0x520364(0x229)]=_0x3675de;});const _0x318e4d=new invoice_for_incoming();await _0x318e4d[_0x7260e0(0x1d6)]();for(let _0x29807f=0x0;_0x29807f<=_0x256709['length']-0x1;_0x29807f++){_0x232282[_0x29807f][_0x7260e0(0x1c4)]=_0x7260e0(0x185)+_0x318e4d[_0x7260e0(0x179)][_0x7260e0(0x1b3)]()['padStart'](0x8,'0');}const _0x3a4b8a=await warehouse_validation_setup[_0x7260e0(0x17a)]([{'$match':{'warehouse_name':_0x4fc204}}]);let _0x3c6656=[];for(let _0x1b7632=0x0;_0x1b7632<=_0x232282[_0x7260e0(0x1a4)]-0x1;_0x1b7632++){const _0x4775cc=_0x232282[_0x1b7632];for(let _0x607b53=0x0;_0x607b53<=_0x3a4b8a['length']-0x1;_0x607b53++){const _0x538676=_0x3a4b8a[_0x607b53];for(let _0x5d01f7=0x0;_0x5d01f7<=_0x538676[_0x7260e0(0x22b)][_0x7260e0(0x1a4)]-0x1;_0x5d01f7++){const _0x20b699=_0x538676['product_data'][_0x5d01f7];if(_0x20b699[_0x7260e0(0x126)]===_0x4775cc[_0x7260e0(0x126)]){let _0x471f61=_0x4775cc[_0x7260e0(0x1db)];const _0x2cf635=await warehouse['aggregate']([{'$match':{'name':_0x4fc204,'room':_0x538676[_0x7260e0(0x1ee)]}},{'$unwind':'$product_details'},{'$match':{'level':_0x20b699[_0x7260e0(0x196)],'bay':_0x20b699[_0x7260e0(0x16e)]}}]);if(_0x2cf635[_0x7260e0(0x1a4)]==0x0){for(let _0x1db44d=0x0;_0x1db44d<=_0x538676[_0x7260e0(0x22b)][_0x7260e0(0x1a4)]-0x1&&_0x471f61>0x0;_0x1db44d++){const _0x55057f=_0x538676[_0x7260e0(0x22b)][_0x1db44d];if(_0x4775cc[_0x7260e0(0x126)]===_0x55057f[_0x7260e0(0x126)]){_0x3c6656[_0x1db44d]={};const _0x38c2c5=parseInt(_0x55057f[_0x7260e0(0x181)]),_0x4caebe=0x0;let _0xa77aa5=_0x38c2c5-_0x4caebe,_0x1d16ee=Math[_0x7260e0(0x123)](_0x471f61,_0xa77aa5);console[_0x7260e0(0x199)](_0x7260e0(0x183)+_0x1d16ee+_0x7260e0(0x1bb)+_0x538676['warehouse_name']+_0x7260e0(0x1ac)+_0x538676['room']+_0x7260e0(0x12c)+_0x55057f[_0x7260e0(0x196)]+_0x7260e0(0x1e6)+_0x55057f[_0x7260e0(0x16e)]),_0x3c6656[_0x1db44d]['product_name']=_0x4775cc['product_name'],_0x3c6656[_0x1db44d][_0x7260e0(0x126)]=_0x4775cc[_0x7260e0(0x126)],_0x3c6656[_0x1db44d]['product_id']=_0x4775cc['product_id'],_0x3c6656[_0x1db44d][_0x7260e0(0x152)]=_0x4775cc[_0x7260e0(0x152)],_0x3c6656[_0x1db44d]['sales_category']=_0x4775cc[_0x7260e0(0x1b2)],_0x3c6656[_0x1db44d][_0x7260e0(0x197)]=_0x4775cc[_0x7260e0(0x197)],_0x3c6656[_0x1db44d][_0x7260e0(0x1db)]=_0x1d16ee,_0x3c6656[_0x1db44d]['standard_unit']=_0x4775cc[_0x7260e0(0x20a)],_0x3c6656[_0x1db44d][_0x7260e0(0x22f)]=_0x4775cc['secondary_unit'],_0x3c6656[_0x1db44d][_0x7260e0(0x1a6)]=_0x4775cc['primary_code'],_0x3c6656[_0x1db44d]['secondary_code']=_0x4775cc[_0x7260e0(0x134)],_0x3c6656[_0x1db44d]['maxStocks']=_0x4775cc[_0x7260e0(0x1af)],_0x3c6656[_0x1db44d][_0x7260e0(0x1e1)]=_0x4775cc[_0x7260e0(0x1e1)],_0x3c6656[_0x1db44d]['expiry_date']=_0x4775cc['expiry_date'],_0x3c6656[_0x1db44d][_0x7260e0(0x203)]=_0x4775cc[_0x7260e0(0x203)],_0x3c6656[_0x1db44d][_0x7260e0(0x1f4)]=_0x4775cc[_0x7260e0(0x1f4)],_0x3c6656[_0x1db44d][_0x7260e0(0x176)]=_0x4775cc[_0x7260e0(0x176)],_0x3c6656[_0x1db44d]['invoice']=_0x4775cc[_0x7260e0(0x1c4)],_0x3c6656[_0x1db44d][_0x7260e0(0x229)]=_0x4775cc['gross_price'],_0x3c6656[_0x1db44d][_0x7260e0(0x1f9)]=_0x538676[_0x7260e0(0x1ee)],_0x3c6656[_0x1db44d][_0x7260e0(0x202)]=_0x55057f[_0x7260e0(0x196)],_0x3c6656[_0x1db44d][_0x7260e0(0x196)]=_0x55057f[_0x7260e0(0x16e)],_0x471f61-=_0x1d16ee;if(_0x471f61<=0x0)break;}}if(_0x471f61<=0x0)break;_0x471f61>0x0&&console['log'](_0x7260e0(0x1c2)+_0x471f61+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');}}}}}const _0x3a2a73=_0x3c6656[_0x7260e0(0x20b)]((_0x240a87,_0xd5a7ae)=>{if(_0xd5a7ae>0x0)return{'item':_0x240a87};}),_0x59084d=_0x3a2a73[_0x7260e0(0x20b)](_0x55503a=>_0x55503a['quantity']!=='0'&&_0x55503a[_0x7260e0(0x1db)]!==''),_0x34cebc=new purchases_finished({'invoice':'INC-'+_0x318e4d[_0x7260e0(0x179)][_0x7260e0(0x1b3)]()['padStart'](0x8,'0'),'suppliers':_0x65663f,'date':_0x4712a0,'warehouse_name':_0x4fc204,'product':_0x59084d,'note':_0xb1af31,'due_amount':_0x4e7bb5,'room':_0x2add8d,'POnumber':_0x278d1f,'SCRN':_0x218b65,'JO_number':_0x101b8b,'ReqBy':_0xb2ab4e,'dateofreq':_0x24d089,'typeservicesData':_0x205dc4,'van':_0x2e4447,'typevehicle':_0xd09d82,'driver':_0xdc70e5,'plate':_0xdf1f28,'DRSI':_0x597e4a,'TSU':_0x175f4d,'TFU':_0x58338f,'typeOfProducts':_0x44c84a}),_0x5b0aba=await _0x34cebc[_0x7260e0(0x1d6)](),_0xd669fd=await purchases_finished[_0x7260e0(0x1da)]({'_id':_0x5b0aba[_0x7260e0(0x15b)][_0x7260e0(0x172)]()});_0x39adad[_0x7260e0(0x1cf)](_0x7260e0(0x1cb),_0x7260e0(0x150)),_0x131261[_0x7260e0(0x10d)](_0x7260e0(0x225)+_0xd669fd['_id'][_0x7260e0(0x172)]());}catch(_0x5aaff1){console[_0x7260e0(0x199)](_0x5aaff1);}}),router['get']('/process/:id',auth,async(_0xb7386a,_0x2540a4)=>{var _0x4bd0a1=a0_0x15df27;try{const {username:_0x2c4748,email:_0x8139cb,role:_0x76a5e8}=_0xb7386a[_0x4bd0a1(0x20e)],_0x443f44=_0xb7386a[_0x4bd0a1(0x20e)],_0xade530=_0xb7386a[_0x4bd0a1(0x207)]['id'],_0x38103c=await profile[_0x4bd0a1(0x1da)]({'email':_0x443f44[_0x4bd0a1(0x16f)]}),_0xc40f7a=await master_shop['find'](),_0xd3950e=await staff[_0x4bd0a1(0x1da)]({'email':_0x443f44['email']}),_0x48ed73=await suppliers[_0x4bd0a1(0x128)]({});let _0x122a3c;if(_0x443f44[_0x4bd0a1(0x232)]==_0x4bd0a1(0x11f)){const _0x14e3e4=await staff[_0x4bd0a1(0x1da)]({'email':_0x443f44[_0x4bd0a1(0x16f)]});_0x122a3c=await warehouse[_0x4bd0a1(0x17a)]([{'$match':{'status':_0x4bd0a1(0x198),'name':_0x14e3e4[_0x4bd0a1(0x159)]}},{'$group':{'_id':_0x4bd0a1(0x206),'name':{'$first':'$name'}}}]);}else _0x122a3c=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4bd0a1(0x206),'name':{'$first':_0x4bd0a1(0x206)}}}]);const _0x5838f5=await purchases_finished[_0x4bd0a1(0x117)](_0xade530);if(_0xc40f7a[0x0][_0x4bd0a1(0x132)]==_0x4bd0a1(0x1dc))var _0x5096f0=users['English'];else{if(_0xc40f7a[0x0][_0x4bd0a1(0x132)]=='Hindi')var _0x5096f0=users[_0x4bd0a1(0x1c6)];else{if(_0xc40f7a[0x0][_0x4bd0a1(0x132)]=='German')var _0x5096f0=users[_0x4bd0a1(0x1a7)];else{if(_0xc40f7a[0x0][_0x4bd0a1(0x132)]==_0x4bd0a1(0x1d3))var _0x5096f0=users['Spanish'];else{if(_0xc40f7a[0x0][_0x4bd0a1(0x132)]=='French')var _0x5096f0=users['French'];else{if(_0xc40f7a[0x0]['language']==_0x4bd0a1(0x15e))var _0x5096f0=users[_0x4bd0a1(0x15c)];else{if(_0xc40f7a[0x0][_0x4bd0a1(0x132)]=='Chinese')var _0x5096f0=users[_0x4bd0a1(0x14e)];else{if(_0xc40f7a[0x0]['language']=='Arabic\x20(ae)')var _0x5096f0=users[_0x4bd0a1(0x18e)];}}}}}}}_0x2540a4[_0x4bd0a1(0x178)]('purchases_process',{'success':_0xb7386a['flash']('success'),'errors':_0xb7386a[_0x4bd0a1(0x1cf)](_0x4bd0a1(0x113)),'role':_0x443f44,'profile':_0x38103c,'suppliers':_0x48ed73,'warehouse':_0x122a3c,'master_shop':_0xc40f7a,'language':_0x5096f0,'purchases_data':_0x5838f5});}catch(_0xbc9ae6){console[_0x4bd0a1(0x199)](_0xbc9ae6);}});async function get_warehouse_data(_0x55ef0d,_0x1055ac){var _0x57fc19=a0_0x15df27;try{const _0x38e946=await warehouse_temporary['findOne']({'name':_0x55ef0d,'room':_0x1055ac});if(!_0x38e946){const _0xaa1ac7=new warehouse_temporary({'name':_0x55ef0d,'address':_0x55ef0d,'status':_0x57fc19(0x198),'room':_0x1055ac,'isStaging':_0x57fc19(0x1ef)});return await _0xaa1ac7[_0x57fc19(0x1d6)](),_0xaa1ac7;}else return _0x38e946;}catch(_0x10a2f7){console['error'](_0x57fc19(0x161),_0x10a2f7);throw _0x10a2f7;}}function a0_0xe4e2(){var _0x3d011e=['Rack\x201','Hindi','max_product_unit','Asia/Manila','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_code','success','$secondary_code','/all_purchases_finished/view','Enclosed','flash','<div>','get','$product.quantity','Spanish','purchases_id','</tbody>','save','$expiry_date','add_purchases_finished_logs','545wjxtlH','findOne','quantity','English\x20(US)','user_id','back','/../public','\x20</h2>','batch_code','MaxStocks_data','RoomAssign','product_details','\x20Order\x20Number\x20:\x20',',\x20bin:\x20','</td>','$product.floorlevel','<table\x20style=\x22width:\x20100%\x20!important;\x22>','edit_purchases_finished','to_quantity','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','padStart','room','false','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$alertquantity','purchase\x20data\x20update\x20successfully','maxProducts','maxperunit','$product_details.product_stock','paid_amount','<!DOCTYPE\x20html>','add_purchases_finished','room_name','$note','isProcess','<tr>','to_recieved','to_warehouse','suppliers_docs','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','level','production_date','to_bay','image','$name','params','$invoice','</thead>','standard_unit','filter','master','<h5>','user','product_code_hide','568XclCnD','return_product','random','/view','$product.bin','/view/return_purchase/:id','Purchase\x20Return\x20Mail','json','prod_cat','/process/:id','password','host','FROZEN\x20GOODS','Router','all_purchases_barcode','INCF-','prod_code','table\x20page','INC','maxPerUnit','match','/all_purchases_finished/process/','$product_details.product_code','return_qty','LOG-INC-','gross_price','4202800MdbIaF','product_data','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/incoming','secondary_unit','due_amount','date','role','amount','$product_details._id','primary_code_hide','name','payment\x20successfull','/barcode_scanner','Rack\x202','/view_log','Room_name','$paid_amount','Return\x20Goods','$room','catch','numeric','prod_unit','add_purchases\x20error','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','\x20<>\x20','$secondary_unit','/barcode/:id','incoming_add','13323920ApfIQn','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.primary_code','/view/add_purchases','$product.bay','getFullYear','redirect','ejs','/view/add_purchases_logs','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_name','message','errors','type_of_products_type','stocks','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','findById','product_id','string','prod_primunit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','getDate','createTransport','/upload/','staff','/CheckingWarehouse','post','true','min','error','getMonth','product_code','$maxStocks','find','prod_qty','purchase_quantity','util',',\x20bay:\x20','Logo.png','concat','$warehouse_name','then','$due_amount','language','stock_quantity','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Transfer\x20Finalize\x20Successfully','$product.room_name','$brand','1837328bCMJMJ','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/getTRF','/view/:id','</tr>','$product_details.bay','Ambient','$product_details.type','floor','Paid\x20For\x20Purchase','</div>','<h5\x20style=\x22text-align:\x20left;\x22>','secondary_code_hide','prod_secondunit','Purchase\x20Mail','$suppliers_docs','$maxProdPerUnit','77103WsASwA','$product_details','POnumber','$product_details.floorlevel','Chinese','Error\x20Occurs','purchase\x20data\x20add\x20successfully','French','date_recieved','all','DRY\x20GOODS','Arabic\x20(ae)','$product','21258HBVJyL','\x20Order\x20Date\x20:\x20','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','_id','Portuguese','15PgVtSR','Portuguese\x20(BR)','exports','own','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','$_id','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_stock','prod_level','336188YYGzGB','id_transaction','map','product_date','$product_details.secondary_code','product_name','$unit','bin','email','currency','sales_data_cateory','valueOf','currency_placement','$sales_category','$date','product_cat','$return_data','render','invoice_init','aggregate','product','../models/all_models','undefined','/incoming/add','267194OvSgeb','return_data','max','$type_products','Distributing\x20','True','INC-','2-digit','$primary_code','updateOne','$product_details.product_name','<hr\x20class=\x22my-3\x22>','stock_data','return_purchase_finished','port','Arabic','note','purchases\x20item\x20return\x20successfull','body','status','<strong>\x20Regards\x20</strong>','type_of_products','forEach','bay','uuid','Enabled','log','item_code','site_title','$category','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Finished\x20Goods','</body></html>','Email\x20sent\x20successfully','$suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.type','length','/all_purchases_finished/preview/','primary_code','German','en-CA','/view/add_purchases/:id','expiry_date','incoming_view',',\x20room:\x20','<h2>\x20','prod_Qty','maxStocks','$gross_price','/getinvoicetrf','sales_category','toString','</table>','<html><head><title></title>','slice','logs','English','purchase_invoice','suppliers','\x20units\x20to\x20warehouse:\x20','toLocaleDateString','$batch_code','JO_number','abs','unit','$product_details.rack','There\x20is\x20','sendMail','invoice'];a0_0xe4e2=function(){return _0x3d011e;};return a0_0xe4e2();}router[a0_0x15df27(0x121)](a0_0x15df27(0x219),auth,async(_0x129db6,_0x6071c5)=>{var _0x47a0a3=a0_0x15df27;try{const _0x33f27e=_0x129db6[_0x47a0a3(0x207)]['id'],_0x3e2899=await purchases_finished[_0x47a0a3(0x117)](_0x33f27e);let _0x3b5eeb=[];_0x3e2899[_0x47a0a3(0x17b)][_0x47a0a3(0x195)]((_0x3a0ee4,_0xadbc5c)=>{var _0x111a18=_0x47a0a3;_0x3b5eeb[_0xadbc5c]={},_0x3b5eeb[_0xadbc5c][_0x111a18(0x159)]=_0x3e2899[_0x111a18(0x163)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x118)]=_0x3a0ee4[_0x111a18(0x118)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x16c)]=_0x3a0ee4['product_name'],_0x3b5eeb[_0xadbc5c]['product_code']=_0x3a0ee4[_0x111a18(0x126)],_0x3b5eeb[_0xadbc5c]['quantity']=_0x3a0ee4[_0x111a18(0x1db)],_0x3b5eeb[_0xadbc5c]['standard_unit']=_0x3a0ee4[_0x111a18(0x20a)],_0x3b5eeb[_0xadbc5c]['secondary_unit']=_0x3a0ee4[_0x111a18(0x22f)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x202)]=_0x3a0ee4[_0x111a18(0x202)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x196)]=_0x3a0ee4[_0x111a18(0x196)],_0x3b5eeb[_0xadbc5c]['primary_code']=_0x3a0ee4[_0x111a18(0x1a6)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x134)]=_0x3a0ee4['secondary_code'],_0x3b5eeb[_0xadbc5c]['maxStocks']=_0x3a0ee4[_0x111a18(0x1af)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x1e1)]=_0x3a0ee4['batch_code'],_0x3b5eeb[_0xadbc5c][_0x111a18(0x1aa)]=_0x3a0ee4[_0x111a18(0x1aa)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x203)]=_0x3a0ee4[_0x111a18(0x203)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x1f4)]=_0x3a0ee4['maxperunit'],_0x3b5eeb[_0xadbc5c]['product_cat']=_0x3a0ee4[_0x111a18(0x176)],_0x3b5eeb[_0xadbc5c]['room_name']=_0x3a0ee4[_0x111a18(0x1f9)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x1c4)]=_0x3a0ee4[_0x111a18(0x1c4)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x197)]=_0x3a0ee4[_0x111a18(0x197)],_0x3b5eeb[_0xadbc5c][_0x111a18(0x229)]=_0x3a0ee4['gross_price'],_0x3b5eeb[_0xadbc5c][_0x111a18(0x1b2)]=_0x3a0ee4[_0x111a18(0x1b2)],_0x3b5eeb[_0xadbc5c]['date_recieved']=_0x3a0ee4['date_recieved'],_0x3b5eeb[_0xadbc5c][_0x111a18(0x1d4)]=_0x3a0ee4[_0x111a18(0x15b)][_0x111a18(0x172)]();});for(let _0x306eb6=0x0;_0x306eb6<=_0x3b5eeb['length']-0x1;_0x306eb6++){const _0x3896c5=_0x3b5eeb[_0x306eb6],_0x3b0f68=new warehouse_temporary(_0x3896c5);await _0x3b0f68[_0x47a0a3(0x1d6)]();}_0x3e2899[_0x47a0a3(0x1fb)]='true',await _0x3e2899[_0x47a0a3(0x1d6)](),_0x129db6[_0x47a0a3(0x1cf)](_0x47a0a3(0x1cb),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x6071c5[_0x47a0a3(0x10d)]('/all_purchases_finished/process/'+_0x3e2899[_0x47a0a3(0x15b)][_0x47a0a3(0x172)]());}catch(_0x1c11d3){}}),router['post']('/view/add_purchases_logs',auth,async(_0x278a30,_0x2c148c)=>{var _0x548747=a0_0x15df27;try{const {invoice:_0x570c3a,date:_0x197474,warehouse_name:_0x5fcf7d,prod_name:_0x316a4a,note:_0x3211c5,due_amount:_0xae4623,Room_name:_0x5dce45,PO_number:_0x2343c6,SCRN:_0x53f305,ReqBy:_0x1dc2b9,dateofreq:_0x4b4282,suppliers:_0x41e3bc,typeservicesData:_0x33a584,van:_0x346f79,typevehicle:_0x57e29b,driver:_0x4f18d2,plate:_0xbd8d5a,DRSI:_0x377618,TSU:_0x29ab2d,TFU:_0x32b28e,JO_number:_0x1591b5,type_of_products:_0x4f7959}=_0x278a30[_0x548747(0x191)];if(typeof _0x316a4a==_0x548747(0x119))var _0x3a2c73=[_0x278a30[_0x548747(0x191)]['prod_name']],_0x2737be=[_0x278a30[_0x548747(0x191)]['prod_code']],_0x526194=[_0x278a30[_0x548747(0x191)]['prod_Qty']],_0x5c500e=[_0x278a30['body'][_0x548747(0x11a)]],_0x48f0d0=[_0x278a30['body'][_0x548747(0x146)]],_0x1e491b=[_0x278a30[_0x548747(0x191)][_0x548747(0x166)]],_0x59c48b=[_0x278a30[_0x548747(0x191)][_0x548747(0x1a6)]],_0x33a88e=[_0x278a30[_0x548747(0x191)][_0x548747(0x134)]],_0xe1cfed=[_0x278a30[_0x548747(0x191)]['MaxStocks_data']],_0x35ba45=[_0x278a30[_0x548747(0x191)]['batch_code']],_0x2601e1=[_0x278a30[_0x548747(0x191)][_0x548747(0x1aa)]],_0x4a3429=[_0x278a30[_0x548747(0x191)]['product_date']],_0x152eda=[_0x278a30[_0x548747(0x191)]['max_product_unit']],_0x36be84=[_0x278a30['body'][_0x548747(0x218)]],_0x4764c8=[_0x278a30[_0x548747(0x191)][_0x548747(0x1e3)]],_0x1035f9=[_0x278a30['body']['gross_price']],_0x19c8be=[_0x278a30[_0x548747(0x191)][_0x548747(0x197)]],_0x5e654d=[_0x278a30[_0x548747(0x191)]['sales_data_cateory']],_0x45a381=[_0x278a30['body'][_0x548747(0x114)]];else var _0x3a2c73=[..._0x278a30['body']['prod_name']],_0x2737be=[..._0x278a30[_0x548747(0x191)][_0x548747(0x220)]],_0x526194=[..._0x278a30[_0x548747(0x191)][_0x548747(0x1ae)]],_0x5c500e=[..._0x278a30['body'][_0x548747(0x11a)]],_0x48f0d0=[..._0x278a30[_0x548747(0x191)][_0x548747(0x146)]],_0x1e491b=[..._0x278a30[_0x548747(0x191)][_0x548747(0x166)]],_0x59c48b=[..._0x278a30['body']['primary_code']],_0x33a88e=[..._0x278a30['body'][_0x548747(0x134)]],_0xe1cfed=[..._0x278a30[_0x548747(0x191)]['MaxStocks_data']],_0x35ba45=[..._0x278a30['body']['batch_code']],_0x2601e1=[..._0x278a30[_0x548747(0x191)][_0x548747(0x1aa)]],_0x4a3429=[..._0x278a30[_0x548747(0x191)][_0x548747(0x16a)]],_0x152eda=[..._0x278a30[_0x548747(0x191)][_0x548747(0x1c7)]],_0x36be84=[..._0x278a30[_0x548747(0x191)][_0x548747(0x218)]],_0x4764c8=[..._0x278a30[_0x548747(0x191)][_0x548747(0x1e3)]],_0x1035f9=[..._0x278a30['body'][_0x548747(0x229)]],_0x19c8be=[..._0x278a30['body'][_0x548747(0x197)]],_0x5e654d=[..._0x278a30['body'][_0x548747(0x171)]],_0x45a381=[..._0x278a30[_0x548747(0x191)][_0x548747(0x114)]];const _0x5845e7=_0x3a2c73[_0x548747(0x169)](_0x1ffc9a=>{return _0x1ffc9a={'product_name':_0x1ffc9a};});_0x45a381[_0x548747(0x195)]((_0x75d426,_0x28d8c5)=>{var _0x11097a=_0x548747;_0x5845e7[_0x28d8c5][_0x11097a(0x194)]=_0x75d426;}),_0x5e654d[_0x548747(0x195)]((_0x5d671c,_0x40aca9)=>{_0x5845e7[_0x40aca9]['sales_category']=_0x5d671c;}),_0x2737be[_0x548747(0x195)]((_0x336aaf,_0x1cf94e)=>{var _0x376a34=_0x548747;_0x5845e7[_0x1cf94e][_0x376a34(0x126)]=_0x336aaf;}),_0x19c8be[_0x548747(0x195)]((_0x4fe99f,_0x470c64)=>{var _0x5c165c=_0x548747;_0x5845e7[_0x470c64][_0x5c165c(0x197)]=_0x4fe99f;}),_0x526194['forEach']((_0x592607,_0x1dfced)=>{var _0x543173=_0x548747;_0x5845e7[_0x1dfced][_0x543173(0x1db)]=Math['abs'](_0x592607);}),_0x5c500e[_0x548747(0x195)]((_0x2eec93,_0xd95706)=>{_0x5845e7[_0xd95706]['standard_unit']=_0x2eec93;}),_0x48f0d0['forEach']((_0x5c27ce,_0x28ac73)=>{var _0x1937da=_0x548747;_0x5845e7[_0x28ac73][_0x1937da(0x22f)]=_0x5c27ce;}),_0x1e491b[_0x548747(0x195)]((_0x4e766b,_0x44d2ba)=>{var _0x59d939=_0x548747,_0x59aff0=_0x4e766b[_0x59d939(0x224)](/[A-Za-z]+/)[0x0],_0x55a3ed=parseInt(_0x4e766b[_0x59d939(0x224)](/\d+/)[0x0]);_0x5845e7[_0x44d2ba][_0x59d939(0x202)]=_0x59aff0,_0x5845e7[_0x44d2ba][_0x59d939(0x196)]=_0x55a3ed;}),_0x59c48b[_0x548747(0x195)]((_0x2fe60a,_0x327ec7)=>{_0x5845e7[_0x327ec7]['primary_code']=_0x2fe60a;}),_0x33a88e[_0x548747(0x195)]((_0x4bd479,_0x4d94b0)=>{var _0x418299=_0x548747;_0x5845e7[_0x4d94b0][_0x418299(0x134)]=_0x4bd479;}),_0xe1cfed[_0x548747(0x195)]((_0x5d2d62,_0x73a1ec)=>{var _0x104419=_0x548747;_0x5845e7[_0x73a1ec][_0x104419(0x1af)]=_0x5d2d62;}),_0x35ba45[_0x548747(0x195)]((_0x3ea040,_0x2e8441)=>{_0x5845e7[_0x2e8441]['batch_code']=_0x3ea040;}),_0x2601e1[_0x548747(0x195)]((_0x509ab9,_0x1dce50)=>{var _0x2a8bcc=_0x548747;_0x5845e7[_0x1dce50][_0x2a8bcc(0x1aa)]=_0x509ab9;}),_0x4a3429[_0x548747(0x195)]((_0xcf9b6e,_0x5db09e)=>{var _0x3533b7=_0x548747;_0x5845e7[_0x5db09e][_0x3533b7(0x203)]=_0xcf9b6e;}),_0x152eda[_0x548747(0x195)]((_0x127b68,_0x426472)=>{var _0x46f43c=_0x548747;_0x5845e7[_0x426472][_0x46f43c(0x1f4)]=_0x127b68;}),_0x36be84[_0x548747(0x195)]((_0x5d0e34,_0x3c38d0)=>{_0x5845e7[_0x3c38d0]['product_cat']=_0x5d0e34;}),_0x4764c8['forEach']((_0x1f0679,_0x15df4b)=>{_0x5845e7[_0x15df4b]['room_name']=_0x1f0679;}),_0x1035f9[_0x548747(0x195)]((_0x4df41e,_0x127d84)=>{_0x5845e7[_0x127d84]['gross_price']=_0x4df41e;});const _0x50990b=new purchases_logs();await _0x50990b['save']();for(let _0x48adfe=0x0;_0x48adfe<=_0x4764c8[_0x548747(0x1a4)]-0x1;_0x48adfe++){_0x5845e7[_0x48adfe][_0x548747(0x1c4)]=_0x548747(0x228)+_0x50990b[_0x548747(0x179)][_0x548747(0x1b3)]()['padStart'](0x8,'0');}const _0x2a5450=_0x5845e7['filter'](_0x109b5f=>_0x109b5f[_0x548747(0x1db)]!=='0'&&_0x109b5f[_0x548747(0x1db)]!==''),_0x2667c2=new purchases_finished({'invoice':_0x548747(0x228)+_0x50990b[_0x548747(0x179)][_0x548747(0x1b3)]()[_0x548747(0x1ed)](0x8,'0'),'suppliers':_0x41e3bc,'date':_0x197474,'warehouse_name':_0x5fcf7d,'product':_0x2a5450,'note':_0x3211c5,'due_amount':_0xae4623,'room':_0x5dce45,'POnumber':_0x2343c6,'SCRN':_0x53f305,'JO_number':_0x1591b5,'ReqBy':_0x1dc2b9,'dateofreq':_0x4b4282,'typeservicesData':_0x33a584,'van':_0x346f79,'typevehicle':_0x57e29b,'driver':_0x4f18d2,'plate':_0xbd8d5a,'DRSI':_0x377618,'TSU':_0x29ab2d,'TFU':_0x32b28e,'typeOfProducts':_0x4f7959}),_0x40ef24=await _0x2667c2[_0x548747(0x1d6)](),_0x385093=await purchases_finished[_0x548747(0x1da)]({'_id':_0x40ef24['_id'][_0x548747(0x172)]()}),_0x336495=_0x385093[_0x548747(0x17b)][_0x548747(0x169)](async _0x89edf8=>{var _0xd7b2c7=_0x548747;try{var _0x41aaed=await warehouse[_0xd7b2c7(0x1da)]({'name':_0x5fcf7d,'room':_0x89edf8['room_name']}),_0x43c1ff=0x0;const _0x21f3bb=_0x41aaed[_0xd7b2c7(0x1e4)][_0xd7b2c7(0x169)](_0x3da1c9=>{var _0x5180fc=_0xd7b2c7;console[_0x5180fc(0x199)](_0x3da1c9[_0x5180fc(0x16c)]+'=='+_0x89edf8['product_name']+'&&'+_0x3da1c9['bay']+'=='+_0x89edf8[_0x5180fc(0x196)]+'&&'+_0x3da1c9[_0x5180fc(0x1aa)]+'=='+_0x89edf8[_0x5180fc(0x1aa)]+'&&'+_0x3da1c9[_0x5180fc(0x203)]+'=='+_0x89edf8['production_date']+'&&'+_0x3da1c9[_0x5180fc(0x1e1)]+'=='+_0x89edf8['batch_code']+'&&'+_0x3da1c9[_0x5180fc(0x1c4)]+'=='+_0x385093[_0x5180fc(0x1c4)]),_0x3da1c9[_0x5180fc(0x16c)]==_0x89edf8['product_name']&&_0x3da1c9['bay']==_0x89edf8[_0x5180fc(0x196)]&&_0x3da1c9[_0x5180fc(0x202)]==_0x89edf8[_0x5180fc(0x202)]&&_0x3da1c9['expiry_date']==_0x89edf8[_0x5180fc(0x1aa)]&&_0x3da1c9[_0x5180fc(0x203)]==_0x89edf8[_0x5180fc(0x203)]&&_0x3da1c9[_0x5180fc(0x1e1)]==_0x89edf8[_0x5180fc(0x1e1)]&&_0x3da1c9[_0x5180fc(0x1c4)]==_0x385093['invoice']&&(_0x3da1c9['product_stock']=Math[_0x5180fc(0x1bf)](_0x3da1c9[_0x5180fc(0x165)])+Math[_0x5180fc(0x1bf)](_0x89edf8[_0x5180fc(0x1db)]),_0x43c1ff++);});return _0x43c1ff==0x0&&(_0x41aaed[_0xd7b2c7(0x1e4)]=_0x41aaed['product_details'][_0xd7b2c7(0x12e)]({'product_name':_0x89edf8['product_name'],'product_stock':Math[_0xd7b2c7(0x1bf)](_0x89edf8[_0xd7b2c7(0x1db)]),'primary_code':_0x89edf8[_0xd7b2c7(0x1a6)],'secondary_code':_0x89edf8['secondary_code'],'product_code':_0x89edf8[_0xd7b2c7(0x126)],'bay':_0x89edf8['bay'],'level':_0x89edf8[_0xd7b2c7(0x202)],'maxProducts':_0x89edf8[_0xd7b2c7(0x1af)],'unit':_0x89edf8[_0xd7b2c7(0x20a)],'secondary_unit':_0x89edf8[_0xd7b2c7(0x22f)],'expiry_date':_0x89edf8['expiry_date'],'production_date':_0x89edf8[_0xd7b2c7(0x203)],'maxProducts':_0x89edf8[_0xd7b2c7(0x1af)],'maxPerUnit':_0x89edf8[_0xd7b2c7(0x1f4)],'batch_code':_0x89edf8[_0xd7b2c7(0x1e1)],'product_cat':_0x89edf8['product_cat'],'invoice':_0x89edf8['invoice'],'id_incoming':_0x89edf8[_0xd7b2c7(0x15b)],'uuid':_0x89edf8['uuid'],'gross_price':_0x89edf8[_0xd7b2c7(0x229)],'sales_category':_0x89edf8[_0xd7b2c7(0x1b2)],'type_products':_0x89edf8[_0xd7b2c7(0x194)]})),_0x41aaed;}catch(_0x3028b6){return console[_0xd7b2c7(0x124)]('Error\x20occurred\x20while\x20processing\x20product:',_0x3028b6),null;}});Promise[_0x548747(0x153)](_0x336495)[_0x548747(0x130)](async _0x4fee03=>{var _0x58a49a=_0x548747;try{for(const _0x351563 of _0x4fee03){await warehouse[_0x58a49a(0x188)]({'_id':_0x351563[_0x58a49a(0x15b)]},{'$addToSet':{'product_details':{'$each':_0x351563[_0x58a49a(0x1e4)]}}});}const _0x1419ad=await master_shop['find'](),_0x3fde30=await email_settings['findOne'](),_0x3bc595=await supervisor_settings[_0x58a49a(0x128)]();var _0x5021ea=_0x385093[_0x58a49a(0x17b)],_0x5798ce='',_0x50bda6;for(_0x50bda6 in _0x5021ea){var _0x3cd6d7='FG';_0x385093[_0x58a49a(0x163)]==_0x58a49a(0x154)&&(_0x3cd6d7='DG'),_0x5798ce+=_0x58a49a(0x1fc)+_0x58a49a(0x1c9)+_0x5021ea[_0x50bda6]['product_name']+'</td>'+_0x58a49a(0x1c9)+_0x5021ea[_0x50bda6]['product_code']+_0x58a49a(0x1e7)+_0x58a49a(0x1c9)+_0x5021ea[_0x50bda6][_0x58a49a(0x1db)]+_0x58a49a(0x1e7)+_0x58a49a(0x1c9)+_0x5021ea[_0x50bda6][_0x58a49a(0x20a)]+_0x58a49a(0x1e7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5021ea[_0x50bda6][_0x58a49a(0x22f)]+_0x58a49a(0x1e7)+_0x58a49a(0x1c9)+_0x385093[_0x58a49a(0x163)]+_0x58a49a(0x1e7)+_0x58a49a(0x1c9)+_0x5021ea[_0x50bda6]['room_name']+_0x58a49a(0x1e7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3cd6d7+_0x5021ea[_0x50bda6][_0x58a49a(0x196)]+'</td>','</tr>';}let _0x2f0d61=nodemailer[_0x58a49a(0x11d)]({'host':_0x3fde30[_0x58a49a(0x21b)],'port':Number(_0x3fde30[_0x58a49a(0x18d)]),'secure':![],'auth':{'user':_0x3fde30[_0x58a49a(0x16f)],'pass':_0x3fde30[_0x58a49a(0x21a)]}}),_0x1f5152={'from':_0x3fde30[_0x58a49a(0x16f)],'to':_0x3bc595[0x0]['FGSEmail'],'subject':_0x58a49a(0x147),'attachments':[{'filename':_0x58a49a(0x12d),'path':__dirname+_0x58a49a(0x1df)+'/upload/'+_0x1419ad[0x0][_0x58a49a(0x205)],'cid':_0x58a49a(0x22c)}],'html':_0x58a49a(0x1f7)+_0x58a49a(0x1b5)+'</head><body>'+_0x58a49a(0x1d0)+_0x58a49a(0x13a)+_0x58a49a(0x1d0)+_0x58a49a(0x102)+_0x58a49a(0x143)+'<div>'+_0x58a49a(0x1ad)+_0x1419ad[0x0][_0x58a49a(0x19b)]+_0x58a49a(0x1e0)+_0x58a49a(0x143)+_0x58a49a(0x143)+_0x58a49a(0x18a)+'<div>'+_0x58a49a(0x144)+_0x58a49a(0x1e5)+_0x385093[_0x58a49a(0x1c4)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x58a49a(0x158)+_0x385093[_0x58a49a(0x231)]+'\x20'+'</span>'+_0x58a49a(0x200)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x58a49a(0x1ec)+_0x58a49a(0x1fc)+_0x58a49a(0x1f0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x58a49a(0x19d)+_0x58a49a(0x164)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x58a49a(0x201)+_0x58a49a(0x15a)+'</tr>'+_0x58a49a(0x209)+_0x58a49a(0x110)+'\x20'+_0x5798ce+'\x20'+_0x58a49a(0x1d5)+_0x58a49a(0x1b4)+_0x58a49a(0x1d0)+_0x58a49a(0x193)+_0x58a49a(0x20d)+_0x1419ad[0x0][_0x58a49a(0x19b)]+'</h5>'+'</div>'+'</div>'+_0x58a49a(0x19f)};_0x2f0d61[_0x58a49a(0x1c3)](_0x1f5152,function(_0x585ddc,_0x2e0b9c){var _0x33ad4f=_0x58a49a;_0x585ddc?(console['log'](_0x585ddc),console[_0x33ad4f(0x199)](_0x33ad4f(0x14f))):console['log'](_0x33ad4f(0x1a0));});}catch(_0x5a1c36){console['error'](_0x5a1c36),_0x2c148c[_0x58a49a(0x192)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x5a1c36[_0x58a49a(0x112)]});}})[_0x548747(0xfe)](_0x5cac41=>{console['error'](_0x5cac41);}),_0x278a30[_0x548747(0x1cf)]('success',_0x548747(0x150)),_0x2c148c[_0x548747(0x10d)](_0x548747(0x1a5)+_0x385093[_0x548747(0x15b)][_0x548747(0x172)]());}catch(_0x16ca92){console[_0x548747(0x199)](_0x16ca92);}}),router['get']('/preview/:id',auth,async(_0x1c8308,_0x360d91)=>{var _0x2b9913=a0_0x15df27;try{const {username:_0x51447d,email:_0x582f0f,role:_0x1ce457}=_0x1c8308[_0x2b9913(0x20e)],_0x253d79=_0x1c8308[_0x2b9913(0x20e)],_0x1e31f1=await profile[_0x2b9913(0x1da)]({'email':_0x253d79[_0x2b9913(0x16f)]}),_0x2da3a3=await master_shop[_0x2b9913(0x128)](),_0x204647=_0x1c8308[_0x2b9913(0x207)]['id'],_0x1de26c=await purchases_finished[_0x2b9913(0x117)](_0x204647),_0x50b2d0=await suppliers[_0x2b9913(0x128)]({});let _0x25e6f5;if(_0x253d79['role']==_0x2b9913(0x11f)){const _0x122e71=await staff[_0x2b9913(0x1da)]({'email':_0x253d79[_0x2b9913(0x16f)]});_0x25e6f5=await warehouse[_0x2b9913(0x128)]({'status':_0x2b9913(0x198),'name':_0x122e71['warehouse'],'warehouse_category':_0x2b9913(0x19e)});}else _0x25e6f5=await warehouse[_0x2b9913(0x17a)]([{'$match':{'status':_0x2b9913(0x198),'warehouse_category':_0x2b9913(0x19e)}},{'$group':{'_id':_0x2b9913(0x206),'name':{'$first':_0x2b9913(0x206)}}}]);const _0x5e19b8=await product[_0x2b9913(0x128)]({}),_0x1b3d5e=BayBinSelected(_0x1de26c[_0x2b9913(0x163)],_0x1de26c[_0x2b9913(0x1ee)]);let _0x2768fa=new Date(_0x1de26c['expiry_date']),_0x46eb4c=('0'+_0x2768fa['getDate']())[_0x2b9913(0x1b6)](-0x2),_0x4eb750=('0'+(_0x2768fa['getMonth']()+0x1))[_0x2b9913(0x1b6)](-0x2),_0x19b2e6=_0x2768fa[_0x2b9913(0x10c)](),_0x39778b=_0x19b2e6+'-'+_0x4eb750+'-'+_0x46eb4c;if(_0x2da3a3[0x0][_0x2b9913(0x132)]==_0x2b9913(0x1dc)){var _0x2cbe37=users['English'];console[_0x2b9913(0x199)](_0x2cbe37);}else{if(_0x2da3a3[0x0][_0x2b9913(0x132)]==_0x2b9913(0x1c6))var _0x2cbe37=users[_0x2b9913(0x1c6)];else{if(_0x2da3a3[0x0][_0x2b9913(0x132)]==_0x2b9913(0x1a7))var _0x2cbe37=users[_0x2b9913(0x1a7)];else{if(_0x2da3a3[0x0][_0x2b9913(0x132)]==_0x2b9913(0x1d3))var _0x2cbe37=users[_0x2b9913(0x1d3)];else{if(_0x2da3a3[0x0][_0x2b9913(0x132)]=='French')var _0x2cbe37=users[_0x2b9913(0x151)];else{if(_0x2da3a3[0x0][_0x2b9913(0x132)]==_0x2b9913(0x15e))var _0x2cbe37=users[_0x2b9913(0x15c)];else{if(_0x2da3a3[0x0][_0x2b9913(0x132)]==_0x2b9913(0x14e))var _0x2cbe37=users[_0x2b9913(0x14e)];else{if(_0x2da3a3[0x0]['language']=='Arabic\x20(ae)')var _0x2cbe37=users['Arabic'];}}}}}}}_0x360d91[_0x2b9913(0x178)]('edit_purchases_finished_view',{'success':_0x1c8308[_0x2b9913(0x1cf)](_0x2b9913(0x1cb)),'errors':_0x1c8308['flash'](_0x2b9913(0x113)),'role':_0x253d79,'profile':_0x1e31f1,'purchases':_0x1de26c,'suppliers':_0x50b2d0,'warehouse':_0x25e6f5,'product':_0x5e19b8,'master_shop':_0x2da3a3,'language':_0x2cbe37,'ed_fullDate':_0x39778b,'dataSelected':_0x1b3d5e});}catch(_0x3640a0){console['log'](_0x3640a0);}}),router[a0_0x15df27(0x1d1)]('/view/:id',auth,async(_0x1510e5,_0x22fc75)=>{var _0x2a7f4b=a0_0x15df27;try{const {username:_0x2b03f5,email:_0x53923a,role:_0x43b485}=_0x1510e5[_0x2a7f4b(0x20e)],_0x513274=_0x1510e5['user'],_0x10fd32=await profile['findOne']({'email':_0x513274[_0x2a7f4b(0x16f)]}),_0x70947b=await master_shop[_0x2a7f4b(0x128)](),_0x280cc3=_0x1510e5[_0x2a7f4b(0x207)]['id'],_0x1c003b=await purchases_finished[_0x2a7f4b(0x117)](_0x280cc3),_0x1a4aa9=await suppliers[_0x2a7f4b(0x128)]({});let _0x36c325;if(_0x513274['role']=='staff'){const _0xe9a7a=await staff[_0x2a7f4b(0x1da)]({'email':_0x513274[_0x2a7f4b(0x16f)]});_0x36c325=await warehouse[_0x2a7f4b(0x128)]({'status':_0x2a7f4b(0x198),'name':_0xe9a7a[_0x2a7f4b(0x159)],'warehouse_category':_0x2a7f4b(0x19e)});}else _0x36c325=await warehouse[_0x2a7f4b(0x17a)]([{'$match':{'status':_0x2a7f4b(0x198),'warehouse_category':_0x2a7f4b(0x19e)}},{'$group':{'_id':'$name','name':{'$first':_0x2a7f4b(0x206)}}}]);const _0x3a3565=await product[_0x2a7f4b(0x128)]({}),_0x516b29=BayBinSelected(_0x1c003b[_0x2a7f4b(0x163)],_0x1c003b[_0x2a7f4b(0x1ee)]);let _0x19c9ff=new Date(_0x1c003b[_0x2a7f4b(0x1aa)]),_0x5b0a02=('0'+_0x19c9ff[_0x2a7f4b(0x11c)]())[_0x2a7f4b(0x1b6)](-0x2),_0x43e8ef=('0'+(_0x19c9ff['getMonth']()+0x1))['slice'](-0x2),_0x4639c0=_0x19c9ff[_0x2a7f4b(0x10c)](),_0x5d8d6a=_0x4639c0+'-'+_0x43e8ef+'-'+_0x5b0a02;if(_0x70947b[0x0][_0x2a7f4b(0x132)]==_0x2a7f4b(0x1dc)){var _0x4f0632=users[_0x2a7f4b(0x1b8)];console[_0x2a7f4b(0x199)](_0x4f0632);}else{if(_0x70947b[0x0][_0x2a7f4b(0x132)]==_0x2a7f4b(0x1c6))var _0x4f0632=users[_0x2a7f4b(0x1c6)];else{if(_0x70947b[0x0][_0x2a7f4b(0x132)]==_0x2a7f4b(0x1a7))var _0x4f0632=users[_0x2a7f4b(0x1a7)];else{if(_0x70947b[0x0][_0x2a7f4b(0x132)]=='Spanish')var _0x4f0632=users['Spanish'];else{if(_0x70947b[0x0][_0x2a7f4b(0x132)]==_0x2a7f4b(0x151))var _0x4f0632=users['French'];else{if(_0x70947b[0x0][_0x2a7f4b(0x132)]==_0x2a7f4b(0x15e))var _0x4f0632=users[_0x2a7f4b(0x15c)];else{if(_0x70947b[0x0]['language']==_0x2a7f4b(0x14e))var _0x4f0632=users[_0x2a7f4b(0x14e)];else{if(_0x70947b[0x0]['language']==_0x2a7f4b(0x155))var _0x4f0632=users[_0x2a7f4b(0x18e)];}}}}}}}_0x22fc75[_0x2a7f4b(0x178)](_0x2a7f4b(0x1ea),{'success':_0x1510e5['flash'](_0x2a7f4b(0x1cb)),'errors':_0x1510e5[_0x2a7f4b(0x1cf)]('errors'),'role':_0x513274,'profile':_0x10fd32,'purchases':_0x1c003b,'suppliers':_0x1a4aa9,'warehouse':_0x36c325,'product':_0x3a3565,'master_shop':_0x70947b,'language':_0x4f0632,'ed_fullDate':_0x5d8d6a,'dataSelected':_0x516b29});}catch(_0x45e2b8){console[_0x2a7f4b(0x199)](_0x45e2b8);}}),router['post'](a0_0x15df27(0x13c),auth,async(_0xd56336,_0x47680e)=>{var _0x243558=a0_0x15df27;try{const _0x40b400=_0xd56336['params']['id'],_0x43eee1=await purchases_finished[_0x243558(0x1da)]({'_id':_0xd56336['params']['id']}),_0x364dec=await warehouse['findOne']({'name':_0x43eee1['warehouse_name'],'room':_0x43eee1[_0x243558(0x1ee)]});_0x43eee1['product']['forEach'](_0x3e8328=>{var _0x131633=_0x243558;const _0x3c1d84=_0x364dec[_0x131633(0x1e4)]['map'](_0x984b1c=>{var _0x11e666=_0x131633;_0x984b1c[_0x11e666(0x16c)]==_0x3e8328['product_name']&&_0x984b1c[_0x11e666(0x196)]==_0x3e8328[_0x11e666(0x196)]&&(_0x984b1c[_0x11e666(0x165)]=parseInt(_0x984b1c[_0x11e666(0x165)])-parseInt(_0x3e8328[_0x11e666(0x1db)]));});}),await _0x364dec[_0x243558(0x1d6)]();const {invoice:_0x59b224,suppliers:_0x1a0150,date:_0x1b8cdb,warehouse_name:_0x29cc8a,prod_name:_0xc69b99,prod_code:_0x362c65,prod_qty:_0x18e3ee,prod_unit:_0x100458,prod_secondunit:_0x14f367,prod_level:_0x46eeb3,prod_isle:_0x139c7a,prod_pallet:_0x59126b,note:_0x2986a3,expiry_date:_0x3d24b2,batch_code:_0x57b5e6,paid_amount:_0x33645c,due_amount:_0x5ac912,Room_name:_0x5ae4b1,primary_code:_0x229db4,secondary_code:_0x12e7a2,PO_number:_0x394544,JO_number:_0x1ee3ed}=_0xd56336[_0x243558(0x191)];if(typeof _0xc69b99==_0x243558(0x119))var _0x5a8414=[_0xd56336['body'][_0x243558(0x111)]],_0x59abf0=[_0xd56336[_0x243558(0x191)][_0x243558(0x220)]],_0x1cb467=[_0xd56336[_0x243558(0x191)][_0x243558(0x129)]],_0x28d7d2=[_0xd56336['body'][_0x243558(0x100)]],_0x3bca4c=[_0xd56336[_0x243558(0x191)][_0x243558(0x146)]],_0x5241bc=[_0xd56336[_0x243558(0x191)][_0x243558(0x166)]],_0x548f10=[_0xd56336[_0x243558(0x191)][_0x243558(0x1a6)]],_0x14e399=[_0xd56336[_0x243558(0x191)][_0x243558(0x134)]],_0x128f17=[_0xd56336[_0x243558(0x191)][_0x243558(0x1e2)]],_0xa8259c=[_0xd56336['body'][_0x243558(0x1e1)]],_0x50c645=[_0xd56336['body'][_0x243558(0x1aa)]];else var _0x5a8414=[..._0xd56336[_0x243558(0x191)][_0x243558(0x111)]],_0x59abf0=[..._0xd56336[_0x243558(0x191)][_0x243558(0x220)]],_0x1cb467=[..._0xd56336['body']['prod_qty']],_0x28d7d2=[..._0xd56336['body'][_0x243558(0x100)]],_0x3bca4c=[..._0xd56336[_0x243558(0x191)][_0x243558(0x146)]],_0x5241bc=[..._0xd56336['body'][_0x243558(0x166)]],_0x548f10=[..._0xd56336[_0x243558(0x191)]['primary_code']],_0x14e399=[..._0xd56336[_0x243558(0x191)]['secondary_code']],_0x128f17=[..._0xd56336['body'][_0x243558(0x1e2)]],_0xa8259c=[..._0xd56336[_0x243558(0x191)][_0x243558(0x1e1)]],_0x50c645=[..._0xd56336[_0x243558(0x191)][_0x243558(0x1aa)]];const _0x2b81f6=_0x5a8414[_0x243558(0x169)](_0x13ecc2=>{return _0x13ecc2={'product_name':_0x13ecc2};});_0x59abf0[_0x243558(0x195)]((_0x10a83c,_0x257d5a)=>{_0x2b81f6[_0x257d5a]['product_code']=_0x10a83c;}),_0x1cb467['forEach']((_0x30b773,_0x548ab6)=>{var _0x56b465=_0x243558;_0x2b81f6[_0x548ab6][_0x56b465(0x1db)]=_0x30b773;}),_0x28d7d2[_0x243558(0x195)]((_0x3123bc,_0x4f24a0)=>{var _0x355a4f=_0x243558;_0x2b81f6[_0x4f24a0][_0x355a4f(0x20a)]=_0x3123bc;}),_0x3bca4c[_0x243558(0x195)]((_0x54714f,_0x4e49ce)=>{var _0x25615f=_0x243558;_0x2b81f6[_0x4e49ce][_0x25615f(0x22f)]=_0x54714f;}),_0x5241bc['forEach']((_0x558ba4,_0xc6fc51)=>{_0x2b81f6[_0xc6fc51]['bay']=_0x558ba4;}),_0x548f10[_0x243558(0x195)]((_0x45de8d,_0x2a1c54)=>{var _0x3c6475=_0x243558;_0x2b81f6[_0x2a1c54][_0x3c6475(0x1a6)]=_0x45de8d;}),_0x14e399['forEach']((_0x4537f7,_0x2128f6)=>{var _0xac5ed3=_0x243558;_0x2b81f6[_0x2128f6][_0xac5ed3(0x134)]=_0x4537f7;}),_0x128f17[_0x243558(0x195)]((_0x30b048,_0x4545f8)=>{var _0x3f31ba=_0x243558;_0x2b81f6[_0x4545f8][_0x3f31ba(0x1af)]=_0x30b048;}),_0xa8259c['forEach']((_0x2bd398,_0x948a6f)=>{_0x2b81f6[_0x948a6f]['batch_code']=_0x2bd398;}),_0x50c645[_0x243558(0x195)]((_0x165e0a,_0x515080)=>{_0x2b81f6[_0x515080]['expiry_date']=_0x165e0a;});const _0x320306=_0x2b81f6['filter'](_0x24c90a=>_0x24c90a[_0x243558(0x1db)]!=='0'&&_0x24c90a[_0x243558(0x1db)]!=='');_0x43eee1['invoice']=_0x59b224,_0x43eee1['suppliers']=_0x1a0150,_0x43eee1[_0x243558(0x231)]=_0x1b8cdb,_0x43eee1[_0x243558(0x163)]=_0x29cc8a,_0x43eee1['product']=_0x320306,_0x43eee1[_0x243558(0x18f)]=_0x2986a3,_0x43eee1[_0x243558(0x1f6)]=_0x33645c,_0x43eee1[_0x243558(0x230)]=_0x5ac912,_0x43eee1[_0x243558(0x1ee)]=_0x5ae4b1,_0x43eee1[_0x243558(0x14c)]=_0x394544,_0x43eee1[_0x243558(0x1be)]=_0x1ee3ed;const _0x2b25f6=await _0x43eee1[_0x243558(0x1d6)](),_0x5056a1=await warehouse[_0x243558(0x1da)]({'name':_0xd56336[_0x243558(0x191)][_0x243558(0x163)],'room':_0xd56336['body'][_0x243558(0xfa)]});_0x43eee1[_0x243558(0x17b)][_0x243558(0x195)](_0x336501=>{var _0x4be736=_0x243558,_0xa31394=0x0;const _0x1a9f7c=_0x5056a1[_0x4be736(0x1e4)][_0x4be736(0x169)](_0x251805=>{var _0x179aba=_0x4be736;_0x251805[_0x179aba(0x16c)]==_0x336501[_0x179aba(0x16c)]&&_0x251805[_0x179aba(0x196)]==_0x336501['bay']&&(_0x251805[_0x179aba(0x165)]=parseInt(_0x251805[_0x179aba(0x165)])+parseInt(_0x336501[_0x179aba(0x1db)]),_0xa31394++);});_0xa31394=='0'&&(_0x5056a1[_0x4be736(0x1e4)]=_0x5056a1[_0x4be736(0x1e4)][_0x4be736(0x12e)]({'product_name':_0x336501[_0x4be736(0x16c)],'product_stock':_0x336501['quantity'],'primary_code':_0x336501[_0x4be736(0x1a6)],'secondary_code':_0x336501[_0x4be736(0x134)],'product_code':_0x336501['product_code'],'bay':_0x336501['bay'],'maxProducts':_0x336501[_0x4be736(0x1af)],'unit':_0x336501[_0x4be736(0x20a)],'secondary_unit':_0x336501[_0x4be736(0x22f)],'expiry_date':_0x336501['expiry_date']}));}),await _0x5056a1[_0x243558(0x1d6)]();const _0x5e93a3=await s_payment_data[_0x243558(0x1da)]({'invoice':_0xd56336['body'][_0x243558(0x1c4)]});if(_0x5e93a3===null){}else console[_0x243558(0x199)](_0x243558(0x1ba),_0x5e93a3,_0xd56336[_0x243558(0x191)]['invoice']),_0x5e93a3[_0x243558(0x1ba)]=_0xd56336[_0x243558(0x191)][_0x243558(0x1ba)],await _0x5e93a3[_0x243558(0x1d6)]();_0xd56336[_0x243558(0x1cf)](_0x243558(0x1cb),_0x243558(0x1f2)),_0x47680e[_0x243558(0x10d)](_0x243558(0x1cd));}catch(_0x3fac4a){console[_0x243558(0x199)](_0x3fac4a);}}),router[a0_0x15df27(0x121)]('/give_payment/:id',auth,async(_0x22fa58,_0x5655a4)=>{var _0x5a3ba3=a0_0x15df27;try{const _0x23e89a=_0x22fa58[_0x5a3ba3(0x207)]['id'],{invoice:_0x54f108,suppliers:_0x1f067f,payable:_0x577879,due_amount:_0x9b09eb}=_0x22fa58[_0x5a3ba3(0x191)],_0x9f780e=await purchases[_0x5a3ba3(0x117)](_0x23e89a);var _0x54b366=_0x577879-_0x9b09eb;_0x9f780e[_0x5a3ba3(0x1f6)]=parseFloat(_0x9f780e[_0x5a3ba3(0x1f6)])+parseFloat(_0x9b09eb),_0x9f780e[_0x5a3ba3(0x230)]=_0x54b366;const _0x26dcc8=await _0x9f780e['save']();console[_0x5a3ba3(0x199)](_0x26dcc8);const _0x3bd9c4=await s_payment_data['findOne']({'invoice':_0x54f108});_0x3bd9c4[_0x5a3ba3(0xf2)]=_0x54b366,await _0x3bd9c4[_0x5a3ba3(0x1d6)]();let _0x940496=new Date(),_0x58441f=('0'+_0x940496[_0x5a3ba3(0x11c)]())[_0x5a3ba3(0x1b6)](-0x2),_0x6ba655=('0'+(_0x940496[_0x5a3ba3(0x125)]()+0x1))[_0x5a3ba3(0x1b6)](-0x2),_0x133cbb=_0x940496[_0x5a3ba3(0x10c)](),_0x56dfa6=_0x133cbb+'-'+_0x6ba655+'-'+_0x58441f;const _0x373f86=new suppliers_payment({'invoice':_0x54f108,'date':_0x133cbb+'-'+_0x6ba655+'-'+_0x58441f,'suppliers':_0x1f067f,'reason':_0x5a3ba3(0x142),'amount':_0x9b09eb}),_0x1236be=await _0x373f86[_0x5a3ba3(0x1d6)]();_0x22fa58['flash'](_0x5a3ba3(0x1cb),_0x5a3ba3(0xf6)),_0x5655a4[_0x5a3ba3(0x10d)]('/all_purchases/view');}catch(_0x49c03f){console['log'](_0x49c03f);}}),router[a0_0x15df27(0x1d1)]('/invoice/:id',auth,async(_0x56fa0a,_0x5e947c)=>{var _0xbf495=a0_0x15df27;try{const {username:_0x1cef10,email:_0x5a1891,role:_0x86b342}=_0x56fa0a[_0xbf495(0x20e)],_0x20dcb7=_0x56fa0a['user'],_0x5ea524=await profile[_0xbf495(0x1da)]({'email':_0x20dcb7[_0xbf495(0x16f)]}),_0x52ed0a=await master_shop['find']();console[_0xbf495(0x199)](_0xbf495(0x20c),_0x52ed0a);const _0x2a0899=_0x56fa0a[_0xbf495(0x207)]['id'],_0xde1b5b=await purchases[_0xbf495(0x117)](_0x2a0899);console[_0xbf495(0x199)](_0xde1b5b);const _0x377164=await suppliers[_0xbf495(0x1da)]({'name':_0xde1b5b[_0xbf495(0x1ba)]});console[_0xbf495(0x199)](_0x377164);if(_0x52ed0a[0x0][_0xbf495(0x132)]==_0xbf495(0x1dc)){var _0x25e2b3=users[_0xbf495(0x1b8)];console[_0xbf495(0x199)](_0x25e2b3);}else{if(_0x52ed0a[0x0][_0xbf495(0x132)]==_0xbf495(0x1c6))var _0x25e2b3=users['Hindi'];else{if(_0x52ed0a[0x0][_0xbf495(0x132)]==_0xbf495(0x1a7))var _0x25e2b3=users[_0xbf495(0x1a7)];else{if(_0x52ed0a[0x0][_0xbf495(0x132)]==_0xbf495(0x1d3))var _0x25e2b3=users[_0xbf495(0x1d3)];else{if(_0x52ed0a[0x0][_0xbf495(0x132)]==_0xbf495(0x151))var _0x25e2b3=users[_0xbf495(0x151)];else{if(_0x52ed0a[0x0][_0xbf495(0x132)]=='Portuguese\x20(BR)')var _0x25e2b3=users['Portuguese'];else{if(_0x52ed0a[0x0]['language']==_0xbf495(0x14e))var _0x25e2b3=users[_0xbf495(0x14e)];else{if(_0x52ed0a[0x0][_0xbf495(0x132)]==_0xbf495(0x155))var _0x25e2b3=users['Arabic'];}}}}}}}_0x5e947c[_0xbf495(0x178)](_0xbf495(0x1b9),{'success':_0x56fa0a[_0xbf495(0x1cf)](_0xbf495(0x1cb)),'errors':_0x56fa0a[_0xbf495(0x1cf)]('errors'),'role':_0x20dcb7,'profile':_0x5ea524,'master_shop':_0x52ed0a,'supplier':_0x377164,'purchase':_0xde1b5b,'language':_0x25e2b3});}catch(_0x35b554){console['log'](_0x35b554);}}),router['get'](a0_0x15df27(0x215),auth,async(_0x4850ad,_0x355ba8)=>{var _0x16cc44=a0_0x15df27;try{const {username:_0x848f8d,email:_0x43c36b,role:_0xed9c6b}=_0x4850ad[_0x16cc44(0x20e)],_0x3f36fe=_0x4850ad['user'],_0x5626e9=await profile[_0x16cc44(0x1da)]({'email':_0x3f36fe['email']}),_0x3fe9a4=await master_shop['find']();console[_0x16cc44(0x199)]('master',_0x3fe9a4);const _0x563356=_0x4850ad[_0x16cc44(0x207)]['id'];console['log'](_0x563356);const _0x27c3d1=await purchases_finished[_0x16cc44(0x117)](_0x563356);console[_0x16cc44(0x199)](_0x16cc44(0x1dd),_0x27c3d1);const _0x1291c8=await product[_0x16cc44(0x128)]({}),_0xd4a133=await warehouse['aggregate']([{'$match':{'name':_0x27c3d1['warehouse_name'],'room':_0x27c3d1[_0x16cc44(0x1ee)]}},{'$unwind':_0x16cc44(0x14b)},{'$group':{'_id':_0x16cc44(0xf3),'name':{'$first':_0x16cc44(0x189)},'product_stock':{'$first':_0x16cc44(0x1f5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x16cc44(0x140)},'floorlevel':{'$first':_0x16cc44(0x14d)},'primary_code':{'$first':_0x16cc44(0x109)},'secondary_code':{'$first':_0x16cc44(0x16b)},'product_code':{'$first':_0x16cc44(0x226)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x16cc44(0x1c1)}}}]);console[_0x16cc44(0x199)](_0x16cc44(0x18b),_0xd4a133);let _0x14882b;if(_0x3f36fe[_0x16cc44(0x232)]==_0x16cc44(0x11f)){const _0x20aed7=await staff[_0x16cc44(0x1da)]({'email':_0x3f36fe[_0x16cc44(0x16f)]});_0x14882b=await warehouse[_0x16cc44(0x128)]({'status':_0x16cc44(0x198),'name':_0x20aed7[_0x16cc44(0x159)],'warehouse_category':_0x16cc44(0x19e),'name':_0x16cc44(0xfc)});}else _0x14882b=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);if(_0x3fe9a4[0x0][_0x16cc44(0x132)]==_0x16cc44(0x1dc)){var _0x8b93ec=users['English'];console[_0x16cc44(0x199)](_0x8b93ec);}else{if(_0x3fe9a4[0x0][_0x16cc44(0x132)]==_0x16cc44(0x1c6))var _0x8b93ec=users[_0x16cc44(0x1c6)];else{if(_0x3fe9a4[0x0]['language']==_0x16cc44(0x1a7))var _0x8b93ec=users[_0x16cc44(0x1a7)];else{if(_0x3fe9a4[0x0][_0x16cc44(0x132)]=='Spanish')var _0x8b93ec=users[_0x16cc44(0x1d3)];else{if(_0x3fe9a4[0x0][_0x16cc44(0x132)]==_0x16cc44(0x151))var _0x8b93ec=users[_0x16cc44(0x151)];else{if(_0x3fe9a4[0x0][_0x16cc44(0x132)]==_0x16cc44(0x15e))var _0x8b93ec=users[_0x16cc44(0x15c)];else{if(_0x3fe9a4[0x0][_0x16cc44(0x132)]==_0x16cc44(0x14e))var _0x8b93ec=users[_0x16cc44(0x14e)];else{if(_0x3fe9a4[0x0][_0x16cc44(0x132)]==_0x16cc44(0x155))var _0x8b93ec=users[_0x16cc44(0x18e)];}}}}}}}_0x355ba8[_0x16cc44(0x178)](_0x16cc44(0x18c),{'success':_0x4850ad['flash'](_0x16cc44(0x1cb)),'errors':_0x4850ad[_0x16cc44(0x1cf)]('errors'),'role':_0x3f36fe,'profile':_0x5626e9,'user':_0x27c3d1,'stock':_0xd4a133,'master_shop':_0x3fe9a4,'product':_0x1291c8,'language':_0x8b93ec,'warehouse':_0x14882b});}catch(_0x118e8f){console[_0x16cc44(0x199)](_0x118e8f);}}),router['post'](a0_0x15df27(0x215),auth,async(_0x3d3a92,_0xdb1149)=>{var _0x1a230e=a0_0x15df27;try{const {invoice:_0x2ffeeb,date:_0x2bf5aa,warehouse_name:_0x5016f3,Room_name:_0x50531c,product_name:_0x3c47e8,purchase_quantity:_0x42bd32,stocks:_0x1339ad,return_qty:_0x53a66d,note:_0x4e6ecc,level:_0x361956,isle:_0x19da6a,pallet:_0x1be3af,to_warehouse_name:_0x5e8593,to_Room_name:_0x9dcdfc}=_0x3d3a92['body'],_0x355683=await purchases_finished[_0x1a230e(0x1da)]({'_id':_0x3d3a92[_0x1a230e(0x207)]['id']}),_0x1749a8=await warehouse[_0x1a230e(0x1da)]({'name':_0x5016f3,'room':_0x50531c,'warehouse_category':_0x1a230e(0x19e)});if(typeof _0x3c47e8==_0x1a230e(0x119))var _0x2c5bc2=[_0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x16c)]],_0x4abec1=[_0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x12a)]],_0x2a0e51=[_0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x115)]],_0x1b0fa7=[_0x3d3a92[_0x1a230e(0x191)]['return_qty']],_0x3df8a4=[_0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x202)]],_0x28568e=[_0x3d3a92[_0x1a230e(0x191)]['product_code_hide']],_0x523763=[_0x3d3a92['body'][_0x1a230e(0xf4)]],_0x2de680=[_0x3d3a92[_0x1a230e(0x191)]['secondary_code_hide']];else var _0x2c5bc2=[..._0x3d3a92[_0x1a230e(0x191)]['product_name']],_0x4abec1=[..._0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x12a)]],_0x2a0e51=[..._0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x115)]],_0x1b0fa7=[..._0x3d3a92['body'][_0x1a230e(0x227)]],_0x3df8a4=[..._0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x202)]],_0x28568e=[..._0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x20f)]],_0x523763=[..._0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0xf4)]],_0x2de680=[..._0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x145)]];const _0x1035d8=_0x2c5bc2[_0x1a230e(0x169)](_0x5c9fab=>{return _0x5c9fab={'product_name':_0x5c9fab};});_0x4abec1['forEach']((_0x5531ae,_0x390a92)=>{var _0x8e808e=_0x1a230e;_0x1035d8[_0x390a92][_0x8e808e(0x12a)]=_0x5531ae;}),_0x2a0e51[_0x1a230e(0x195)]((_0x581f33,_0x416c96)=>{var _0x5f5018=_0x1a230e;_0x1035d8[_0x416c96][_0x5f5018(0x133)]=_0x581f33;}),_0x1b0fa7[_0x1a230e(0x195)]((_0x576d1b,_0x114505)=>{var _0x249f6b=_0x1a230e;_0x1035d8[_0x114505][_0x249f6b(0x227)]=_0x576d1b;}),_0x3df8a4[_0x1a230e(0x195)]((_0x5d2f71,_0x4ed128)=>{var _0x39dadb=_0x1a230e;_0x1035d8[_0x4ed128][_0x39dadb(0x196)]=_0x5d2f71;}),_0x28568e[_0x1a230e(0x195)]((_0x2dc7d1,_0x1a70bc)=>{_0x1035d8[_0x1a70bc]['product_code']=_0x2dc7d1;}),_0x523763[_0x1a230e(0x195)]((_0x223f4a,_0x323409)=>{_0x1035d8[_0x323409]['primary_code']=_0x223f4a;}),_0x2de680[_0x1a230e(0x195)]((_0x8ad6f2,_0x4fd0ea)=>{_0x1035d8[_0x4fd0ea]['secondary_code']=_0x8ad6f2;}),_0x1035d8[_0x1a230e(0x195)](_0xfbb4bf=>{var _0x39730c=_0x1a230e;console[_0x39730c(0x199)](_0xfbb4bf);const _0x123cc1=_0x1749a8['product_details'][_0x39730c(0x169)](_0x372b00=>{var _0x1fd705=_0x39730c;_0x372b00[_0x1fd705(0x16c)]==_0xfbb4bf['product_name']&&_0x372b00[_0x1fd705(0x196)]==_0xfbb4bf[_0x1fd705(0x196)]&&(console['log'](parseInt(_0x372b00[_0x1fd705(0x165)])+_0x1fd705(0x103)+parseInt(_0xfbb4bf[_0x1fd705(0x227)])),_0x372b00[_0x1fd705(0x165)]=parseInt(_0x372b00[_0x1fd705(0x165)])-parseInt(_0xfbb4bf[_0x1fd705(0x227)]));});}),await _0x1749a8['save']();var _0x4d9559=0x0;_0x1035d8[_0x1a230e(0x195)](_0x4775c6=>{var _0x498ac7=_0x1a230e;(parseInt(_0x4775c6[_0x498ac7(0x12a)])<parseInt(_0x4775c6[_0x498ac7(0x227)])||parseInt(_0x4775c6[_0x498ac7(0x133)])<parseInt(_0x4775c6[_0x498ac7(0x227)]))&&_0x4d9559++;});if(_0x4d9559!=0x0)return _0x3d3a92[_0x1a230e(0x1cf)](_0x1a230e(0x113),_0x1a230e(0x11b)),_0xdb1149['redirect'](_0x1a230e(0x1de));const _0x5e7962=new purchases_return_finished({'invoice':_0x2ffeeb,'suppliers':_0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x1ba)],'date':_0x2bf5aa,'warehouse_name':_0x5016f3,'return_product':_0x1035d8,'note':_0x4e6ecc,'room':_0x50531c,'to_warehouse_name':_0x5e8593,'to_room':_0x9dcdfc}),_0x35e44e=await _0x5e7962[_0x1a230e(0x1d6)](),_0x2874a6=await purchases_return_finished[_0x1a230e(0x1da)]({'invoice':_0x2ffeeb}),_0x3338b9=await warehouse['findOne']({'name':_0x5e8593,'room':_0x9dcdfc,'warehouse_category':_0x1a230e(0x19e)});_0x2874a6[_0x1a230e(0x211)][_0x1a230e(0x195)](_0x52e8a3=>{var _0x1f415f=_0x1a230e,_0x185565=0x0;const _0x544e09=_0x3338b9['product_details']['map'](_0x390673=>{var _0x2aa3c0=a0_0x1c67;console['log'](_0x390673['product_name']+'=='+_0x52e8a3[_0x2aa3c0(0x16c)]+'&&'+_0x390673[_0x2aa3c0(0x196)]+'=='+_0x52e8a3[_0x2aa3c0(0x196)]),_0x390673[_0x2aa3c0(0x16c)]==_0x52e8a3[_0x2aa3c0(0x16c)]&&_0x390673[_0x2aa3c0(0x196)]==_0x52e8a3[_0x2aa3c0(0x196)]&&(_0x390673[_0x2aa3c0(0x165)]=parseInt(_0x390673[_0x2aa3c0(0x165)])-parseInt(_0x52e8a3[_0x2aa3c0(0x227)]),_0x185565++);});_0x185565=='0'&&(_0x3338b9[_0x1f415f(0x1e4)]=_0x3338b9[_0x1f415f(0x1e4)][_0x1f415f(0x12e)]({'product_name':_0x52e8a3[_0x1f415f(0x16c)],'product_stock':_0x52e8a3['return_qty'],'primary_code':_0x52e8a3['primary_code'],'secondary_code':_0x52e8a3[_0x1f415f(0x134)],'product_code':_0x52e8a3[_0x1f415f(0x126)],'bay':_0x52e8a3['bay'],'maxProducts':0xf423f}));}),await _0x3338b9[_0x1a230e(0x1d6)]();const _0x1223de=await purchases_finished[_0x1a230e(0x1da)]({'invoice':_0x2ffeeb});_0x1223de[_0x1a230e(0x180)]=_0x1a230e(0x184);const _0x45dd2e=await _0x1223de[_0x1a230e(0x1d6)](),_0x4390d7=new s_payment_data({'invoice':_0x2ffeeb,'suppliers':_0x3d3a92[_0x1a230e(0x191)][_0x1a230e(0x1ba)],'reason':'Purchase\x20Return'});await _0x4390d7['save']();const _0x5e0b51=await master_shop[_0x1a230e(0x128)](),_0x4e3254=await email_settings[_0x1a230e(0x1da)](),_0x296ff6=await suppliers[_0x1a230e(0x1da)]({'name':_0x3d3a92[_0x1a230e(0x191)]['suppliers']});_0x5e0b51[0x0][_0x1a230e(0x173)]==0x1?(right_currency=_0x5e0b51[0x0][_0x1a230e(0x170)],left_currency=''):(right_currency='',left_currency=_0x5e0b51[0x0][_0x1a230e(0x170)]);var _0x267966=_0x2c5bc2,_0x4363e8=_0x1b0fa7,_0x4a917f='',_0xd1343d;for(_0xd1343d in _0x267966){_0x4a917f+=_0x1a230e(0x1fc)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x267966[_0xd1343d]+_0x1a230e(0x1e7)+_0x1a230e(0x1c9)+_0x4363e8[_0xd1343d]+'</td>'+_0x1a230e(0x13d);}let _0x1f55b6=nodemailer[_0x1a230e(0x11d)]({'service':'gmail','auth':{'user':_0x4e3254['email'],'pass':_0x4e3254['password']}}),_0x57e296={'from':_0x4e3254[_0x1a230e(0x16f)],'to':_0x296ff6['email'],'subject':_0x1a230e(0x216),'attachments':[{'filename':_0x1a230e(0x12d),'path':__dirname+_0x1a230e(0x1df)+_0x1a230e(0x11e)+_0x5e0b51[0x0][_0x1a230e(0x205)],'cid':_0x1a230e(0x22c)}],'html':_0x1a230e(0x1f7)+'<html><head><title></title>'+'</head><body>'+_0x1a230e(0x1d0)+_0x1a230e(0x13a)+_0x1a230e(0x1d0)+_0x1a230e(0x102)+_0x1a230e(0x143)+_0x1a230e(0x1d0)+'<h2>\x20'+_0x5e0b51[0x0]['site_title']+_0x1a230e(0x1e0)+_0x1a230e(0x143)+'</div>'+_0x1a230e(0x18a)+_0x1a230e(0x1d0)+_0x1a230e(0x144)+'\x20Order\x20Number\x20:\x20'+_0x2ffeeb+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1a230e(0x158)+_0x2bf5aa+'\x20'+'</span>'+_0x1a230e(0x200)+_0x1a230e(0x143)+_0x1a230e(0x1e9)+_0x1a230e(0x1ec)+_0x1a230e(0x1fc)+_0x1a230e(0x1f0)+_0x1a230e(0x135)+_0x1a230e(0x1a2)+_0x1a230e(0x22d)+_0x1a230e(0x13d)+'</thead>'+_0x1a230e(0x110)+'\x20'+_0x4a917f+'\x20'+_0x1a230e(0x1d5)+_0x1a230e(0x1b4)+'<div>'+_0x1a230e(0x193)+_0x1a230e(0x20d)+_0x5e0b51[0x0][_0x1a230e(0x19b)]+_0x1a230e(0x200)+_0x1a230e(0x143)+_0x1a230e(0x143)+_0x1a230e(0x19f)};_0x1f55b6['sendMail'](_0x57e296,function(_0x375525,_0x325d86){var _0x285dae=_0x1a230e;_0x375525?console['log'](_0x285dae(0x14f)):console['log'](_0x285dae(0x1a0));}),_0x3d3a92[_0x1a230e(0x1cf)](_0x1a230e(0x1cb),_0x1a230e(0x190)),_0xdb1149[_0x1a230e(0x10d)]('/all_purchases_finished/view');}catch(_0x473f65){_0xdb1149[_0x1a230e(0x192)](0xc8)[_0x1a230e(0x217)]({'message':_0x473f65[_0x1a230e(0x112)]});}}),router[a0_0x15df27(0x1d1)](a0_0x15df27(0x105),auth,async(_0xb30967,_0x5c3e73)=>{var _0x1f8cea=a0_0x15df27;try{const {username:_0x3ff196,email:_0x596283,role:_0x2e5b70}=_0xb30967[_0x1f8cea(0x20e)],_0x4e80cb=_0xb30967[_0x1f8cea(0x20e)],_0xf994e3=await profile[_0x1f8cea(0x1da)]({'email':_0x4e80cb[_0x1f8cea(0x16f)]}),_0x3bf25d=await master_shop[_0x1f8cea(0x128)](),_0x260e5a=_0xb30967[_0x1f8cea(0x207)]['id'],_0x48faa3=await purchases_finished[_0x1f8cea(0x117)](_0x260e5a);if(_0x3bf25d[0x0][_0x1f8cea(0x132)]==_0x1f8cea(0x1dc))var _0x4a8f22=users[_0x1f8cea(0x1b8)];else{if(_0x3bf25d[0x0]['language']==_0x1f8cea(0x1c6))var _0x4a8f22=users[_0x1f8cea(0x1c6)];else{if(_0x3bf25d[0x0][_0x1f8cea(0x132)]==_0x1f8cea(0x1a7))var _0x4a8f22=users[_0x1f8cea(0x1a7)];else{if(_0x3bf25d[0x0][_0x1f8cea(0x132)]==_0x1f8cea(0x1d3))var _0x4a8f22=users[_0x1f8cea(0x1d3)];else{if(_0x3bf25d[0x0][_0x1f8cea(0x132)]==_0x1f8cea(0x151))var _0x4a8f22=users[_0x1f8cea(0x151)];else{if(_0x3bf25d[0x0][_0x1f8cea(0x132)]==_0x1f8cea(0x15e))var _0x4a8f22=users['Portuguese'];else{if(_0x3bf25d[0x0]['language']==_0x1f8cea(0x14e))var _0x4a8f22=users[_0x1f8cea(0x14e)];else{if(_0x3bf25d[0x0]['language']==_0x1f8cea(0x155))var _0x4a8f22=users[_0x1f8cea(0x18e)];}}}}}}}_0x5c3e73['render'](_0x1f8cea(0x21e),{'success':_0xb30967[_0x1f8cea(0x1cf)](_0x1f8cea(0x1cb)),'errors':_0xb30967[_0x1f8cea(0x1cf)]('errors'),'role':_0x4e80cb,'profile':_0xf994e3,'alldata':_0x48faa3,'master_shop':_0x3bf25d,'language':_0x4a8f22}),console[_0x1f8cea(0x199)](alldata);}catch(_0x42e370){console[_0x1f8cea(0x199)](_0x42e370);}}),router[a0_0x15df27(0x121)](a0_0x15df27(0xf7),async(_0x237aec,_0x588e0f)=>{var _0x963463=a0_0x15df27;const {product_code:_0x4a7935}=_0x237aec[_0x963463(0x191)];var _0x3cf5fe;const _0x4de0cd=await product['aggregate']([{'$match':{'primary_code':_0x4a7935}},{'$group':{'_id':_0x963463(0x162),'name':{'$first':'$name'},'category':{'$first':_0x963463(0x19c)},'brand':{'$first':_0x963463(0x138)},'unit':{'$first':_0x963463(0x16d)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x963463(0x1ca)},'primary_code':{'$first':_0x963463(0x187)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x963463(0x127)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x963463(0x104)},'gross_price':{'$first':_0x963463(0x1b0)},'sales_category':{'$first':_0x963463(0x174)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x46e118=await product['aggregate']([{'$match':{'secondary_code':_0x4a7935}},{'$group':{'_id':_0x963463(0x162),'name':{'$first':_0x963463(0x206)},'category':{'$first':_0x963463(0x19c)},'brand':{'$first':'$brand'},'unit':{'$first':_0x963463(0x16d)},'alertquantity':{'$first':_0x963463(0x1f1)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x963463(0x187)},'secondary_code':{'$first':_0x963463(0x1cc)},'maxStocks':{'$first':_0x963463(0x127)},'maxProdPerUnit':{'$first':_0x963463(0x149)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x963463(0x104)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x963463(0x174)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x4de0cd[_0x963463(0x1a4)]>0x0)_0x3cf5fe=_0x4de0cd;else _0x46e118[_0x963463(0x1a4)]>0x0&&(_0x3cf5fe=_0x46e118);_0x588e0f[_0x963463(0x217)](_0x3cf5fe);}),router[a0_0x15df27(0x121)](a0_0x15df27(0x120),async(_0x51097e,_0x58f365)=>{var _0x32f6be=a0_0x15df27;const {productCode:_0x5b19de,bay:_0x22e49a,warehouses:_0x5e1af1,room:_0x46226f}=_0x51097e[_0x32f6be(0x191)];console['log'](_0x51097e[_0x32f6be(0x191)]);try{const _0x359371=await warehouse[_0x32f6be(0x17a)]([{'$match':{'name':_0x5e1af1,'room':_0x46226f}},{'$unwind':_0x32f6be(0x14b)},{'$match':{'product_details.bay':parseInt(_0x22e49a)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x32f6be(0x189)},'product_stock':{'$first':_0x32f6be(0x1f5)},'bay':{'$first':_0x32f6be(0x13e)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x58f365[_0x32f6be(0x192)](0xc8)['json'](_0x359371);}catch(_0x1fba10){_0x58f365['status'](0x194)['json']({'message':_0x1fba10[_0x32f6be(0x112)]});}}),router[a0_0x15df27(0x121)]('/barcode_scanner_logs',async(_0x4334d2,_0xa56416)=>{var _0x1e0127=a0_0x15df27;const {product_code:_0x4535bf}=_0x4334d2['body'];var _0x5265ab;const _0x3b64e4=await product[_0x1e0127(0x17a)]([{'$match':{'primary_code':_0x4535bf,'type_products':_0x1e0127(0x199)}},{'$group':{'_id':_0x1e0127(0x162),'name':{'$first':_0x1e0127(0x206)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x1e0127(0x16d)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1e0127(0x1ca)},'primary_code':{'$first':_0x1e0127(0x187)},'secondary_code':{'$first':_0x1e0127(0x1cc)},'maxStocks':{'$first':_0x1e0127(0x127)},'maxProdPerUnit':{'$first':_0x1e0127(0x149)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1e0127(0x104)},'gross_price':{'$first':_0x1e0127(0x1b0)},'sales_category':{'$first':_0x1e0127(0x174)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x1e0127(0x199)](_0x3b64e4);const _0x936c68=await product[_0x1e0127(0x17a)]([{'$match':{'secondary_code':_0x4535bf,'type_products':_0x1e0127(0x199)}},{'$group':{'_id':_0x1e0127(0x162),'name':{'$first':'$name'},'category':{'$first':_0x1e0127(0x19c)},'brand':{'$first':_0x1e0127(0x138)},'unit':{'$first':_0x1e0127(0x16d)},'alertquantity':{'$first':_0x1e0127(0x1f1)},'product_code':{'$first':_0x1e0127(0x1ca)},'primary_code':{'$first':_0x1e0127(0x187)},'secondary_code':{'$first':_0x1e0127(0x1cc)},'maxStocks':{'$first':_0x1e0127(0x127)},'maxProdPerUnit':{'$first':_0x1e0127(0x149)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x1e0127(0x1b0)},'sales_category':{'$first':_0x1e0127(0x174)},'type_products':{'$first':_0x1e0127(0x182)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x3b64e4[_0x1e0127(0x1a4)]>0x0)_0x5265ab=_0x3b64e4;else _0x936c68['length']>0x0&&(_0x5265ab=_0x936c68);_0xa56416[_0x1e0127(0x217)](_0x5265ab);}),module[a0_0x15df27(0x15f)]=router;