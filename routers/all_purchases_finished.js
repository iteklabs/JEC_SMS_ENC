var a0_0x3dcf3a=a0_0x17a2;(function(_0x367895,_0x5020d1){var _0x4cccf7=a0_0x17a2,_0x2e5e90=_0x367895();while(!![]){try{var _0x82bb9c=-parseInt(_0x4cccf7(0x15a))/0x1*(-parseInt(_0x4cccf7(0x1d0))/0x2)+parseInt(_0x4cccf7(0x187))/0x3+parseInt(_0x4cccf7(0x1c1))/0x4*(parseInt(_0x4cccf7(0x1b1))/0x5)+-parseInt(_0x4cccf7(0xa3))/0x6*(-parseInt(_0x4cccf7(0x100))/0x7)+-parseInt(_0x4cccf7(0x174))/0x8+-parseInt(_0x4cccf7(0xb2))/0x9*(parseInt(_0x4cccf7(0x16b))/0xa)+parseInt(_0x4cccf7(0x153))/0xb;if(_0x82bb9c===_0x5020d1)break;else _0x2e5e90['push'](_0x2e5e90['shift']());}catch(_0x11a612){_0x2e5e90['push'](_0x2e5e90['shift']());}}}(a0_0x1a60,0x67aca));const express=require(a0_0x3dcf3a(0x17c)),app=express(),router=express[a0_0x3dcf3a(0x137)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require('../models/all_models'),auth=require(a0_0x3dcf3a(0x16c)),nodemailer=require(a0_0x3dcf3a(0xbf));var ejs=require(a0_0x3dcf3a(0x1d6));const path=require(a0_0x3dcf3a(0xe5)),users=require('../public/language/languages.json'),{isNull}=require(a0_0x3dcf3a(0x14c));router['get'](a0_0x3dcf3a(0x1a1),auth,async(_0x15f7b6,_0xfd0521)=>{var _0x37341c=a0_0x3dcf3a;try{const {username:_0x209e63,email:_0x1501b2,role:_0x341a14}=_0x15f7b6[_0x37341c(0x1be)],_0x35d88a=_0x15f7b6[_0x37341c(0x1be)],_0x10faf3=await profile[_0x37341c(0x14f)]({'email':_0x35d88a[_0x37341c(0x162)]}),_0x335b65=await staff['findOne']({'email':_0x35d88a[_0x37341c(0x162)]}),_0x501bfc=await master_shop[_0x37341c(0xe6)]();let _0x4a507e=await transfers_finished[_0x37341c(0x157)]([{'$match':{'to_warehouse':_0x335b65[_0x37341c(0xdf)]}}]);if(_0x501bfc[0x0][_0x37341c(0x143)]==_0x37341c(0xfb))var _0x1573cf=users[_0x37341c(0x18a)];else{if(_0x501bfc[0x0][_0x37341c(0x143)]=='Hindi')var _0x1573cf=users['Hindi'];else{if(_0x501bfc[0x0][_0x37341c(0x143)]==_0x37341c(0x11a))var _0x1573cf=users['German'];else{if(_0x501bfc[0x0]['language']=='Spanish')var _0x1573cf=users[_0x37341c(0xd2)];else{if(_0x501bfc[0x0][_0x37341c(0x143)]==_0x37341c(0x1a5))var _0x1573cf=users['French'];else{if(_0x501bfc[0x0]['language']=='Portuguese\x20(BR)')var _0x1573cf=users[_0x37341c(0x105)];else{if(_0x501bfc[0x0]['language']==_0x37341c(0xd0))var _0x1573cf=users[_0x37341c(0xd0)];else{if(_0x501bfc[0x0][_0x37341c(0x143)]==_0x37341c(0x1c4))var _0x1573cf=users[_0x37341c(0x144)];}}}}}}}_0xfd0521[_0x37341c(0x163)](_0x37341c(0x1cf),{'success':_0x15f7b6[_0x37341c(0x16d)](_0x37341c(0xfc)),'errors':_0x15f7b6[_0x37341c(0x16d)](_0x37341c(0xa2)),'purchases':_0x4a507e,'role':_0x35d88a,'profile':_0x10faf3,'master_shop':_0x501bfc,'language':_0x1573cf,'staff_data':_0x335b65});}catch(_0x28ef51){console['log'](_0x37341c(0xaa),_0x28ef51),_0xfd0521[_0x37341c(0x1ca)](0xc8)[_0x37341c(0x1bc)]({'message':_0x28ef51[_0x37341c(0x171)]});}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0xb5),auth,async(_0x575021,_0x4638f8)=>{var _0x5ef661=a0_0x3dcf3a;try{const {username:_0x2456ed,email:_0x16e1e5,role:_0x49edaf}=_0x575021[_0x5ef661(0x1be)],_0x27ab13=_0x575021[_0x5ef661(0x1be)],_0x178161=await profile[_0x5ef661(0x14f)]({'email':_0x27ab13[_0x5ef661(0x162)]}),_0x34bcd4=await staff[_0x5ef661(0x14f)]({'email':_0x27ab13[_0x5ef661(0x162)]}),_0x1ce4cc=await master_shop['find']();let _0x3a5a38=await transfers_finished[_0x5ef661(0x157)]([{'$match':{'to_warehouse':_0x34bcd4[_0x5ef661(0xdf)],'to_recieved':_0x5ef661(0x129)}}]);if(_0x1ce4cc[0x0][_0x5ef661(0x143)]==_0x5ef661(0xfb))var _0x2e3f65=users['English'];else{if(_0x1ce4cc[0x0][_0x5ef661(0x143)]==_0x5ef661(0x1ab))var _0x2e3f65=users[_0x5ef661(0x1ab)];else{if(_0x1ce4cc[0x0]['language']==_0x5ef661(0x11a))var _0x2e3f65=users['German'];else{if(_0x1ce4cc[0x0][_0x5ef661(0x143)]=='Spanish')var _0x2e3f65=users[_0x5ef661(0xd2)];else{if(_0x1ce4cc[0x0][_0x5ef661(0x143)]==_0x5ef661(0x1a5))var _0x2e3f65=users[_0x5ef661(0x1a5)];else{if(_0x1ce4cc[0x0][_0x5ef661(0x143)]=='Portuguese\x20(BR)')var _0x2e3f65=users[_0x5ef661(0x105)];else{if(_0x1ce4cc[0x0][_0x5ef661(0x143)]==_0x5ef661(0xd0))var _0x2e3f65=users[_0x5ef661(0xd0)];else{if(_0x1ce4cc[0x0][_0x5ef661(0x143)]==_0x5ef661(0x1c4))var _0x2e3f65=users[_0x5ef661(0x144)];}}}}}}}_0x4638f8['render'](_0x5ef661(0x197),{'success':_0x575021[_0x5ef661(0x16d)]('success'),'errors':_0x575021['flash'](_0x5ef661(0xa2)),'purchases':_0x3a5a38,'role':_0x27ab13,'profile':_0x178161,'master_shop':_0x1ce4cc,'language':_0x2e3f65,'staff_data':_0x34bcd4});}catch(_0x44865e){console['log'](_0x5ef661(0xaa),_0x44865e),_0x4638f8[_0x5ef661(0x1ca)](0xc8)[_0x5ef661(0x1bc)]({'message':_0x44865e[_0x5ef661(0x171)]});}});function a0_0x1a60(){var _0x48504f=['find','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','to_bay','\x20Order\x20Number\x20:\x20','catch','/give_payment/:id','random','$product_details.floorlevel','product_name','/upload/','<h5\x20style=\x22text-align:\x20left;\x22>','\x20<>\x20','INCF-','logo','add_purchases\x20error','stock_quantity','port','$product','max','$product_details.type','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','English\x20(US)','success','error','Finished\x20Goods','purchase_quantity','21364MqUTSr','$product.bay','Return\x20Goods','Purchase\x20Return\x20Mail','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','Portuguese','/all_purchases_finished/process/','here2','$product_code','Rack\x202','$brand','standard_unit','room_name','$alertquantity','/view/add_purchases','uuid','room','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','log','purchases\x20item\x20return\x20successfull','product_details','$category','/process/:id','Error\x20occurred\x20while\x20processing\x20product:','site_title','German','$suppliers_docs','prod_qty','all_purchases_finished_logs','product_code_hide','Room_name','product_code','updateOne','</body></html>','product_cat','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','quantity','<html><head><title></title>','prod_Qty','Portuguese\x20(BR)','false','_id','gross_price','all','item_code','<h5>','padStart','master','purchase\x20data\x20add\x20successfully','Asia/Manila','$product_details.storage','all_purchases_finished','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.product_code','Router','$type_products','Rack\x201','secondary_unit','LOG-INC-','\x20Order\x20Date\x20:\x20','Email\x20sent\x20successfully','DRY\x20GOODS','redirect','stocks','maxProducts','$name','language','Arabic','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$maxStocks','FROZEN\x20GOODS','util','$product_details.bay','$due_amount','findOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','params','$product_details.primary_code','3110217rzOmDX','slice','numeric','toString','aggregate','unit','Enclosed','75172yMiUVm','Distributing\x20','floor','<!DOCTYPE\x20html>','$_id','to_warehouse','expiry_date','$primary_code','email','render','$product.bin','Purchase\x20Return','</tr>','$maxProdPerUnit','/preview/:id','purchases_process','/../public','7810250dbTRrL','../middleware/auth','flash','body','\x20units\x20to\x20warehouse:\x20','<div>','message','$product_details.secondary_code','FGSEmail','5352104nxedMj','$product.type','$product_details._id','Transfer\x20Finalize\x20Successfully','getDate','$secondary_code','role','production_date','express','to_room_name','date','/view/add_purchases_logs','$product_details.product_name','$product_details','prod_unit','$warehouse_name','prod_code','Enabled','$product.room_name','1484352FcjaXR','/all_purchases_finished/preview/','true','English','Logo.png','password','add_purchases_finished','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','$unit','$gross_price','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_level','$expiry_date','save','<table\x20style=\x22width:\x20100%\x20!important;\x22>','findById','incoming_add','due_amount','date_recieved','\x20<=>\x20','$product_details.bin','min','string','bin','getMonth','$invoice','/incoming','/picking_list/pdf_puchases_fin_own_trf/','$paid_amount','product_date','French','$product.floorlevel','invoice','INC-','currency','secondary_code_hide','Hindi','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','INC','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$secondary_unit','878265aLQmie','MaxStocks_data','length','product_stock','/barcode/:id','/CheckingWarehouse','level','$batch_code','purchase\x20data\x20update\x20successfully','</tbody>','\x20</h2>','json','<span\x20style=\x22float:\x20right;\x22>','user','Paid\x20For\x20Purchase','maxStocks','4vEhUru','undefined','$return_data','Arabic\x20(ae)','product','amount','purchases_id','get','gmail','status','own','then','sales_data_cateory','</table>','incoming_view','22NTTaZP','staff','map','add_purchases_finished_logs','<h2>\x20','$product_details.product_stock','ejs','Purchase\x20Mail','max_product_unit','/getinvoicetrf','valueOf',',\x20bay:\x20','<hr\x20class=\x22my-3\x22>','maxPerUnit','/invoice/:id','/view/add_purchases/:id','type_of_products_type','$note','name','createTransport','</head><body>','type_of_products','maxperunit','host','errors','186eUeKMc','An\x20error\x20occurred\x20while\x20saving\x20data.','match','RoomAssign','to_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','concat','table\x20page','isProcess','</div>','logs','sendMail','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</thead>','toLocaleDateString','9sWPuzG','$suppliers','$sales_category','/incoming/add','/barcode_scanner_logs','primary_code_hide','product_id','</span>','2-digit','getFullYear','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','return_purchase_finished','nodemailer','$product.quantity','</td>',',\x20bin:\x20','Error\x20Occurs','/view/:id','/view/return_purchase/:id','prod_primunit','prod_name','secondary_code',',\x20room:\x20','return_qty','paid_amount','$room','prod_cat','<tr>','batch_code','Chinese','An\x20error\x20occurred.','Spanish','post','suppliers','invoice_init','sales_category','image','warehouse_name','<strong>\x20Regards\x20</strong>','purchase_invoice','abs','prod_secondunit','$product_details.rack','product_data','warehouse','forEach','/all_purchases_finished/view','</h5>','POnumber','bay','path'];a0_0x1a60=function(){return _0x48504f;};return a0_0x1a60();}const createLog=async _0x12cf41=>{var _0x2e3022=a0_0x3dcf3a;const _0x541d41=new datalogs({'location':_0x12cf41});return await _0x541d41[_0x2e3022(0x194)](),_0x541d41[_0x2e3022(0xd5)];};router[a0_0x3dcf3a(0xd3)](a0_0x3dcf3a(0xb5),auth,async(_0x57b5a4,_0x48aaad)=>{var _0x432bf4=a0_0x3dcf3a;try{const {invoice_trf_data:_0x510c3f,item_code:_0xc5a8e7,SCRN:_0x42db03,ReqBy:_0x43d998,type_of_products:_0x58d1a2,dateofreq:_0xcc7437,PO_number:_0x35a044,date:_0x1a826c,warehouse_name:_0x2473fc,typeservicesData:_0x1f6caa,typevehicle:_0x164a49,driver:_0x26bc44,plate:_0x4d7939,van:_0x55fdc7,DRSI:_0x5bd999,TSU:_0x59ee0a,TFU:_0x3872de,note:_0x1dae29}=_0x57b5a4['body'],_0x7f9ca1=await transfers_finished[_0x432bf4(0x196)](_0x510c3f);if(typeof _0xc5a8e7=='string')var _0x2611ff=[_0x57b5a4['body'][_0x432bf4(0xee)]],_0x1b52ee=[_0x57b5a4['body'][_0x432bf4(0x12d)]],_0xa684cf=[_0x57b5a4[_0x432bf4(0x16e)]['to_quantity']],_0x28c2da=[_0x57b5a4['body']['unit']],_0x18b081=[_0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0xdc)]],_0xe880d7=[_0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x19e)]],_0x5aa041=[_0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x1ac)]],_0xf414a5=[_0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0xc8)]],_0x7fd42d=[_0x57b5a4[_0x432bf4(0x16e)]['batch_code']],_0x4559ed=[_0x57b5a4['body'][_0x432bf4(0x160)]],_0xae536=[_0x57b5a4['body'][_0x432bf4(0x17b)]],_0x21cbdf=[_0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x1d8)]],_0x3227ac=[_0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x110)]];else var _0x2611ff=[..._0x57b5a4['body'][_0x432bf4(0xee)]],_0x1b52ee=[..._0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x12d)]],_0xa684cf=[..._0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0xa7)]],_0x28c2da=[..._0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x158)]],_0x18b081=[..._0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0xdc)]],_0xe880d7=[..._0x57b5a4[_0x432bf4(0x16e)]['bin']],_0x5aa041=[..._0x57b5a4['body'][_0x432bf4(0x1ac)]],_0xf414a5=[..._0x57b5a4[_0x432bf4(0x16e)]['secondary_code']],_0x7fd42d=[..._0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0xcf)]],_0x4559ed=[..._0x57b5a4['body'][_0x432bf4(0x160)]],_0xae536=[..._0x57b5a4['body']['production_date']],_0x21cbdf=[..._0x57b5a4[_0x432bf4(0x16e)][_0x432bf4(0x1d8)]],_0x3227ac=[..._0x57b5a4['body'][_0x432bf4(0x110)]];const _0x2ead83=_0x2611ff[_0x432bf4(0x1d2)](_0x586292=>{return _0x586292={'product_name':_0x586292};});_0x1b52ee[_0x432bf4(0xe0)]((_0xa78b94,_0x5e7b8a)=>{var _0x589f2e=_0x432bf4;_0x2ead83[_0x5e7b8a][_0x589f2e(0x120)]=_0xa78b94;}),_0xa684cf['forEach']((_0x7d3943,_0x55693a)=>{var _0x4d3bf5=_0x432bf4;_0x2ead83[_0x55693a][_0x4d3bf5(0x125)]=Math[_0x4d3bf5(0xdb)](_0x7d3943);}),_0x28c2da[_0x432bf4(0xe0)]((_0x31fee3,_0x510288)=>{var _0x43c941=_0x432bf4;_0x2ead83[_0x510288][_0x43c941(0x10b)]=_0x31fee3;}),_0x18b081[_0x432bf4(0xe0)]((_0x57faac,_0x50e718)=>{_0x2ead83[_0x50e718]['secondary_unit']=_0x57faac;}),_0xe880d7[_0x432bf4(0xe0)]((_0x293657,_0x1ada03)=>{var _0x5ee7a4=_0x432bf4,_0x4513a7=_0x293657['match'](/[A-Za-z]+/)[0x0],_0x4d8a06=parseInt(_0x293657[_0x5ee7a4(0xa5)](/\d+/)[0x0]);_0x2ead83[_0x1ada03][_0x5ee7a4(0x1b7)]=_0x4513a7,_0x2ead83[_0x1ada03]['bay']=_0x4d8a06;}),_0x5aa041[_0x432bf4(0xe0)]((_0x519340,_0x124c78)=>{var _0x3f134c=_0x432bf4;_0x2ead83[_0x124c78][_0x3f134c(0x1ac)]=_0x519340;}),_0xf414a5['forEach']((_0x18b935,_0x53cff3)=>{var _0x379aed=_0x432bf4;_0x2ead83[_0x53cff3][_0x379aed(0xc8)]=_0x18b935;}),_0x7fd42d[_0x432bf4(0xe0)]((_0x3fd417,_0x340b25)=>{var _0x30c28e=_0x432bf4;_0x2ead83[_0x340b25][_0x30c28e(0xcf)]=_0x3fd417;}),_0x4559ed[_0x432bf4(0xe0)]((_0x3a083f,_0x2ac63b)=>{var _0x43ffd5=_0x432bf4;_0x2ead83[_0x2ac63b][_0x43ffd5(0x160)]=_0x3a083f;}),_0xae536['forEach']((_0xc275db,_0x5e4a57)=>{var _0x1e538a=_0x432bf4;_0x2ead83[_0x5e4a57][_0x1e538a(0x17b)]=_0xc275db;}),_0x21cbdf[_0x432bf4(0xe0)]((_0x44c968,_0x564a95)=>{_0x2ead83[_0x564a95]['maxperunit']=_0x44c968;}),_0x3227ac['forEach']((_0xcf2821,_0x47262d)=>{var _0x420362=_0x432bf4;_0x2ead83[_0x47262d][_0x420362(0x10c)]=_0xcf2821;});const _0x3a0927=await createLog(_0x432bf4(0x1ae));_0x3227ac[_0x432bf4(0xe0)]((_0x4876b5,_0x43a9b0)=>{var _0x27eae6=_0x432bf4;_0x2ead83[_0x43a9b0]['invoice']=_0x27eae6(0x1a8)+_0x3a0927[_0x27eae6(0x156)]()[_0x27eae6(0x12f)](0x8,'0');});const _0xd0b7d=_0x2ead83[_0x432bf4(0x145)](_0x4605c1=>_0x4605c1[_0x432bf4(0x125)]!=='0'&&_0x4605c1[_0x432bf4(0x125)]!==''),_0xea9ca3=new purchases_incoming({'invoice':_0x432bf4(0x1a8)+_0x3a0927[_0x432bf4(0x156)]()[_0x432bf4(0x12f)](0x8,'0'),'date':_0x1a826c,'warehouse_name':_0x2473fc,'product':_0xd0b7d,'note':_0x1dae29,'POnumber':_0x35a044,'SCRN':_0x42db03,'ReqBy':_0x43d998,'dateofreq':_0xcc7437,'typeservicesData':_0x1f6caa,'van':_0x55fdc7,'typevehicle':_0x164a49,'driver':_0x26bc44,'plate':_0x4d7939,'DRSI':_0x5bd999,'TSU':_0x59ee0a,'TFU':_0x3872de,'typeOfProducts':_0x58d1a2}),_0x1ea0b3=await _0xea9ca3[_0x432bf4(0x194)](),_0x3ef7ec=_0x1ea0b3[_0x432bf4(0x1c5)][_0x432bf4(0x1d2)](async _0x2cd8e4=>{var _0x3960aa=_0x432bf4,_0x2dcf5e=await warehouse[_0x3960aa(0x14f)]({'name':_0x2473fc,'room':_0x2cd8e4[_0x3960aa(0x10c)]});if(_0x2cd8e4[_0x3960aa(0x125)]>0x0){var _0xd3c18=0x0;const _0x1ba983=_0x2dcf5e[_0x3960aa(0x115)][_0x3960aa(0x1d2)](_0x3fa94d=>{var _0x5c9901=_0x3960aa;_0x3fa94d['product_name']==_0x2cd8e4['product_name']&&_0x3fa94d['bay']==_0x2cd8e4[_0x5c9901(0xe8)]&&_0x3fa94d[_0x5c9901(0x160)]==_0x2cd8e4[_0x5c9901(0x160)]&&_0x3fa94d[_0x5c9901(0x17b)]==_0x2cd8e4[_0x5c9901(0x17b)]&&_0x3fa94d[_0x5c9901(0xcf)]==_0x2cd8e4[_0x5c9901(0xcf)]&&_0x3fa94d['invoice']==_0x2cd8e4[_0x5c9901(0x1a7)]&&(typeof _0x2cd8e4['id_transaction']==_0x5c9901(0x1c2)?(console[_0x5c9901(0x113)](_0x5c9901(0x107),_0x3fa94d[_0x5c9901(0x1b4)]+'\x20<>\x20'+_0x3fa94d[_0x5c9901(0x12a)]+_0x5c9901(0x19a)+Math[_0x5c9901(0xdb)](_0x3fa94d['product_stock'])+Math[_0x5c9901(0xdb)](_0x2cd8e4['to_quantity'])),_0x3fa94d[_0x5c9901(0x1b4)]=Math[_0x5c9901(0xdb)](_0x3fa94d[_0x5c9901(0x1b4)])+Math[_0x5c9901(0xdb)](_0x2cd8e4[_0x5c9901(0x125)])):(_0x3fa94d['product_stock']=Math[_0x5c9901(0xdb)](_0x3fa94d[_0x5c9901(0x1b4)])+Math['abs'](_0x2cd8e4['quantity']),_0xd3c18++));});_0xd3c18=='0'&&(_0x2dcf5e[_0x3960aa(0x115)]=_0x2dcf5e[_0x3960aa(0x115)][_0x3960aa(0xa9)]({'product_name':_0x2cd8e4['product_name'],'product_stock':_0x2cd8e4[_0x3960aa(0x125)],'bay':_0x2cd8e4['bay'],'level':_0x2cd8e4[_0x3960aa(0x1b7)],'product_code':_0x2cd8e4[_0x3960aa(0x120)],'primary_code':_0x2cd8e4[_0x3960aa(0x1ac)],'secondary_code':_0x2cd8e4[_0x3960aa(0xc8)],'expiry_date':_0x2cd8e4[_0x3960aa(0x160)],'production_date':_0x2cd8e4[_0x3960aa(0x17b)],'maxProducts':_0x2cd8e4['maxProducts'],'batch_code':_0x2cd8e4[_0x3960aa(0xcf)],'secondary_unit':_0x2cd8e4[_0x3960aa(0x13a)],'unit':_0x2cd8e4['standard_unit'],'maxProducts':_0x2cd8e4[_0x3960aa(0x141)],'maxPerUnit':_0x2cd8e4[_0x3960aa(0x1dd)],'invoice':_0x2cd8e4[_0x3960aa(0x1a7)]}));}return _0x2dcf5e;});Promise[_0x432bf4(0x12c)](_0x3ef7ec)[_0x432bf4(0x1cc)](async _0x1f4723=>{var _0x3f6c84=_0x432bf4;try{for(const _0x258c28 of _0x1f4723){await warehouse['updateOne']({'_id':_0x258c28['_id']},{'$addToSet':{'product_details':{'$each':_0x258c28[_0x3f6c84(0x115)]}}});}_0x7f9ca1['to_recieved']=_0x3f6c84(0x189);const _0x260cfe=await _0x7f9ca1[_0x3f6c84(0x194)](),_0x3e9fe8=await master_shop[_0x3f6c84(0xe6)](),_0x310e8e=await email_settings[_0x3f6c84(0x14f)](),_0x29fe35=await supervisor_settings['find']();var _0x2ac57f=_0xea9ca3[_0x3f6c84(0x1c5)],_0x1c6730='',_0x27efbb;for(_0x27efbb in _0x2ac57f){var _0x651996='FG';_0xea9ca3['to_warehouse']=='DRY\x20GOODS'&&(_0x651996='DG'),_0x1c6730+=_0x3f6c84(0xce)+_0x3f6c84(0xaf)+_0x2ac57f[_0x27efbb][_0x3f6c84(0xee)]+_0x3f6c84(0xc1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ac57f[_0x27efbb][_0x3f6c84(0x120)]+_0x3f6c84(0xc1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ac57f[_0x27efbb][_0x3f6c84(0xa7)]+_0x3f6c84(0xc1)+_0x3f6c84(0xaf)+_0x2ac57f[_0x27efbb][_0x3f6c84(0x158)]+_0x3f6c84(0xc1)+_0x3f6c84(0xaf)+_0x2ac57f[_0x27efbb]['secondary_unit']+_0x3f6c84(0xc1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xea9ca3[_0x3f6c84(0x15f)]+_0x3f6c84(0xc1)+_0x3f6c84(0xaf)+_0x2ac57f[_0x27efbb][_0x3f6c84(0x17d)]+_0x3f6c84(0xc1)+_0x3f6c84(0xaf)+_0x651996+_0x2ac57f[_0x27efbb][_0x3f6c84(0xe8)]+_0x3f6c84(0xc1)+_0x3f6c84(0x166);}_0x57b5a4[_0x3f6c84(0x16d)](_0x3f6c84(0xfc),_0x3f6c84(0x177)),_0x48aaad[_0x3f6c84(0x13f)](_0x3f6c84(0x1a2)+_0x1ea0b3['_id']);}catch(_0x176b63){console['error'](_0x176b63),_0x48aaad['status'](0x1f4)[_0x3f6c84(0x1bc)]({'error':_0x3f6c84(0x124)});}})[_0x432bf4(0xea)](_0x586bd0=>{var _0x437ec3=_0x432bf4;console[_0x437ec3(0xfd)](_0x586bd0),_0x48aaad[_0x437ec3(0x1ca)](0x1f4)[_0x437ec3(0x1bc)]({'error':_0x437ec3(0xd1)});});}catch(_0x2979c7){}}),router[a0_0x3dcf3a(0xd3)]('/getTRF',auth,async(_0x10811d,_0x35953c)=>{var _0x471e14=a0_0x3dcf3a;try{const {warehouse:_0x3e30c2}=_0x10811d[_0x471e14(0x16e)],_0xf80805=await transfers_finished['find']({'to_warehouse':_0x3e30c2,'to_recieved':_0x471e14(0x129)});_0x35953c[_0x471e14(0x1bc)](_0xf80805);}catch(_0xd44560){}}),router['post'](a0_0x3dcf3a(0x1d9),auth,async(_0x37173c,_0x3b766c)=>{var _0x202312=a0_0x3dcf3a;try{const {invoice:_0x16491f}=_0x37173c['body'],_0xddcb2=await transfers_finished[_0x202312(0xe6)]({'_id':_0x16491f,'to_recieved':'false'});_0x3b766c[_0x202312(0x1bc)](_0xddcb2);}catch(_0x538634){}}),router[a0_0x3dcf3a(0x1c8)]('/view',auth,async(_0x21ed9c,_0xb29317)=>{var _0x45591d=a0_0x3dcf3a;try{const {username:_0x15bd02,email:_0x16a56a,role:_0x22f5f8}=_0x21ed9c['user'],_0x25b23f=_0x21ed9c[_0x45591d(0x1be)],_0x5c290d=await profile[_0x45591d(0x14f)]({'email':_0x25b23f[_0x45591d(0x162)]}),_0x506cee=await staff[_0x45591d(0x14f)]({'email':_0x25b23f['email']});if(_0x25b23f[_0x45591d(0x17a)]==_0x45591d(0x1d1)){const _0xd1996e=await staff['findOne']({'email':_0x25b23f['email']});}const _0x5dfa1a=await master_shop[_0x45591d(0xe6)]();let _0x2eb102;if(_0x25b23f[_0x45591d(0x17a)]=='staff'){const _0x5f0060=await staff['findOne']({'email':_0x25b23f['email']});_0x2eb102=await purchases_finished[_0x45591d(0x157)]([{'$match':{'warehouse_name':_0x5f0060[_0x45591d(0xdf)],'typeOfProducts':_0x45591d(0x1cb)}},{'$lookup':{'from':_0x45591d(0xd4),'localField':_0x45591d(0xd4),'foreignField':_0x45591d(0x1e2),'as':'suppliers_docs'}},{'$unwind':_0x45591d(0x11b)},{'$unwind':_0x45591d(0xf7)},{'$group':{'_id':_0x45591d(0x15e),'invoice':{'$first':_0x45591d(0x1a0)},'suppliers':{'$first':_0x45591d(0xb3)},'date':{'$first':_0x45591d(0x111)},'warehouse_name':{'$first':_0x45591d(0x183)},'room':{'$first':_0x45591d(0xcc)},'product':{'$push':'$product'},'note':{'$first':_0x45591d(0x1e1)},'paid_amount':{'$first':_0x45591d(0x1a3)},'due_amount':{'$first':_0x45591d(0x14e)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x45591d(0x1b8)},'expiry_date':{'$first':_0x45591d(0x193)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x45591d(0xc0)},'level':{'$addToSet':_0x45591d(0x101)},'isle':{'$addToSet':_0x45591d(0x164)},'type':{'$addToSet':_0x45591d(0x175)},'floorlevel':{'$addToSet':_0x45591d(0x1a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2eb102=await purchases_finished[_0x45591d(0x157)]([{'$match':{'typeOfProducts':_0x45591d(0x1cb)}},{'$unwind':_0x45591d(0xf7)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x45591d(0x111)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x45591d(0xf7)},'note':{'$first':_0x45591d(0x1e1)},'paid_amount':{'$first':_0x45591d(0x1a3)},'due_amount':{'$first':_0x45591d(0x14e)},'return_data':{'$first':_0x45591d(0x1c3)},'batch_code':{'$first':_0x45591d(0x1b8)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x45591d(0x11b)},'total_product_quantity':{'$sum':_0x45591d(0xc0)},'level':{'$addToSet':_0x45591d(0x101)},'isle':{'$addToSet':_0x45591d(0x164)},'type':{'$addToSet':_0x45591d(0x175)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5dfa1a[0x0][_0x45591d(0x143)]==_0x45591d(0xfb))var _0x47c1da=users[_0x45591d(0x18a)];else{if(_0x5dfa1a[0x0][_0x45591d(0x143)]==_0x45591d(0x1ab))var _0x47c1da=users['Hindi'];else{if(_0x5dfa1a[0x0]['language']==_0x45591d(0x11a))var _0x47c1da=users[_0x45591d(0x11a)];else{if(_0x5dfa1a[0x0][_0x45591d(0x143)]==_0x45591d(0xd2))var _0x47c1da=users['Spanish'];else{if(_0x5dfa1a[0x0][_0x45591d(0x143)]==_0x45591d(0x1a5))var _0x47c1da=users[_0x45591d(0x1a5)];else{if(_0x5dfa1a[0x0][_0x45591d(0x143)]==_0x45591d(0x128))var _0x47c1da=users[_0x45591d(0x105)];else{if(_0x5dfa1a[0x0][_0x45591d(0x143)]==_0x45591d(0xd0))var _0x47c1da=users[_0x45591d(0xd0)];else{if(_0x5dfa1a[0x0]['language']=='Arabic\x20(ae)')var _0x47c1da=users[_0x45591d(0x144)];}}}}}}}_0xb29317[_0x45591d(0x163)](_0x45591d(0x134),{'success':_0x21ed9c[_0x45591d(0x16d)](_0x45591d(0xfc)),'errors':_0x21ed9c['flash'](_0x45591d(0xa2)),'purchases':_0x2eb102,'role':_0x25b23f,'profile':_0x5c290d,'master_shop':_0x5dfa1a,'language':_0x47c1da});}catch(_0x16c56c){console[_0x45591d(0x113)](_0x45591d(0xaa),_0x16c56c),_0xb29317[_0x45591d(0x1ca)](0xc8)['json']({'message':_0x16c56c['message']});}}),router['get']('/view_log',auth,async(_0x4d1596,_0x55595f)=>{var _0x126be4=a0_0x3dcf3a;try{const {username:_0x210460,email:_0x139873,role:_0x4eb1d7}=_0x4d1596[_0x126be4(0x1be)],_0x4dab1c=_0x4d1596[_0x126be4(0x1be)],_0x54c814=await profile[_0x126be4(0x14f)]({'email':_0x4dab1c[_0x126be4(0x162)]}),_0x60d705=await staff['findOne']({'email':_0x4dab1c[_0x126be4(0x162)]});if(_0x4dab1c[_0x126be4(0x17a)]==_0x126be4(0x1d1)){const _0x2847f0=await staff[_0x126be4(0x14f)]({'email':_0x4dab1c[_0x126be4(0x162)]});}const _0x1a0f08=await master_shop[_0x126be4(0xe6)]();let _0x558843;if(_0x4dab1c['role']==_0x126be4(0x1d1)){const _0x55a0e9=await staff['findOne']({'email':_0x4dab1c[_0x126be4(0x162)]});_0x558843=await purchases_finished[_0x126be4(0x157)]([{'$match':{'warehouse_name':_0x55a0e9['warehouse']}},{'$lookup':{'from':_0x126be4(0xd4),'localField':_0x126be4(0xd4),'foreignField':_0x126be4(0x1e2),'as':'suppliers_docs'}},{'$unwind':_0x126be4(0x11b)},{'$unwind':_0x126be4(0xf7)},{'$group':{'_id':_0x126be4(0x15e),'invoice':{'$first':_0x126be4(0x1a0)},'suppliers':{'$first':_0x126be4(0xb3)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x126be4(0x183)},'room':{'$first':'$room'},'product':{'$push':_0x126be4(0xf7)},'note':{'$first':_0x126be4(0x1e1)},'paid_amount':{'$first':_0x126be4(0x1a3)},'due_amount':{'$first':_0x126be4(0x14e)},'return_data':{'$first':_0x126be4(0x1c3)},'batch_code':{'$first':_0x126be4(0x1b8)},'expiry_date':{'$first':_0x126be4(0x193)},'suppliers_docs':{'$first':_0x126be4(0x11b)},'total_product_quantity':{'$sum':_0x126be4(0xc0)},'level':{'$addToSet':_0x126be4(0x101)},'isle':{'$addToSet':_0x126be4(0x164)},'type':{'$addToSet':_0x126be4(0x175)},'floorlevel':{'$addToSet':_0x126be4(0x1a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x558843=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x126be4(0xad)}},{'$unwind':_0x126be4(0xf7)},{'$group':{'_id':_0x126be4(0x15e),'invoice':{'$first':_0x126be4(0x1a0)},'suppliers':{'$first':_0x126be4(0xb3)},'date':{'$first':_0x126be4(0x111)},'warehouse_name':{'$first':_0x126be4(0x183)},'room':{'$addToSet':_0x126be4(0x186)},'product':{'$push':_0x126be4(0xf7)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x126be4(0x1a3)},'due_amount':{'$first':_0x126be4(0x14e)},'return_data':{'$first':_0x126be4(0x1c3)},'batch_code':{'$first':_0x126be4(0x1b8)},'expiry_date':{'$first':_0x126be4(0x193)},'suppliers_docs':{'$first':_0x126be4(0x11b)},'total_product_quantity':{'$sum':_0x126be4(0xc0)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x126be4(0x164)},'type':{'$addToSet':_0x126be4(0x175)},'floorlevel':{'$addToSet':_0x126be4(0x1a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1a0f08[0x0]['language']=='English\x20(US)')var _0x1c478b=users['English'];else{if(_0x1a0f08[0x0]['language']==_0x126be4(0x1ab))var _0x1c478b=users['Hindi'];else{if(_0x1a0f08[0x0]['language']==_0x126be4(0x11a))var _0x1c478b=users[_0x126be4(0x11a)];else{if(_0x1a0f08[0x0][_0x126be4(0x143)]=='Spanish')var _0x1c478b=users[_0x126be4(0xd2)];else{if(_0x1a0f08[0x0][_0x126be4(0x143)]==_0x126be4(0x1a5))var _0x1c478b=users['French'];else{if(_0x1a0f08[0x0][_0x126be4(0x143)]==_0x126be4(0x128))var _0x1c478b=users[_0x126be4(0x105)];else{if(_0x1a0f08[0x0][_0x126be4(0x143)]==_0x126be4(0xd0))var _0x1c478b=users[_0x126be4(0xd0)];else{if(_0x1a0f08[0x0][_0x126be4(0x143)]=='Arabic\x20(ae)')var _0x1c478b=users[_0x126be4(0x144)];}}}}}}}_0x55595f[_0x126be4(0x163)](_0x126be4(0x11d),{'success':_0x4d1596[_0x126be4(0x16d)](_0x126be4(0xfc)),'errors':_0x4d1596[_0x126be4(0x16d)](_0x126be4(0xa2)),'purchases':_0x558843,'role':_0x4dab1c,'profile':_0x54c814,'master_shop':_0x1a0f08,'language':_0x1c478b});}catch(_0x199e89){console[_0x126be4(0x113)](_0x126be4(0xaa),_0x199e89),_0x55595f[_0x126be4(0x1ca)](0xc8)[_0x126be4(0x1bc)]({'message':_0x199e89[_0x126be4(0x171)]});}});function BayBinSelected(_0x54b354,_0x50e0f4){var _0x52c3a0=a0_0x3dcf3a,_0x1671b2=[],_0x596dfb=[];if(_0x54b354==_0x52c3a0(0x13e)){switch(_0x50e0f4){case _0x52c3a0(0x139):_0x1671b2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x52c3a0(0x109):_0x1671b2=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x596dfb=['DG'];}else{if(_0x54b354==_0x52c3a0(0x14b)){switch(_0x50e0f4){case'Rack\x201':_0x1671b2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x52c3a0(0x109):_0x1671b2=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x596dfb=['FG'];}}return{'levels':_0x1671b2,'identify':_0x596dfb};}async function getRandom8DigitNumber(){var _0x5e738b=a0_0x3dcf3a;const _0x22c656=0x989680,_0xf0ec16=0x5f5e0ff,_0x393bc9=Math[_0x5e738b(0x15c)](Math[_0x5e738b(0xec)]()*(_0xf0ec16-_0x22c656+0x1))+_0x22c656;var _0x3ea445;const _0x578c60=await purchases_finished['findOne']({'invoice':'INCF-'+_0x393bc9});return _0x578c60&&_0x578c60[_0x5e738b(0x1b3)]>0x0?_0x3ea445='INCF-'+_0x393bc9:_0x3ea445=_0x5e738b(0xf2)+_0x393bc9,_0x3ea445;}router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x10e),auth,async(_0x31ed41,_0x2e9224)=>{var _0x31f3c0=a0_0x3dcf3a;try{const {username:_0x1a1e53,email:_0x429460,role:_0x2e9214}=_0x31ed41[_0x31f3c0(0x1be)],_0x2f8dd4=_0x31ed41['user'],_0x173ad4=await profile[_0x31f3c0(0x14f)]({'email':_0x2f8dd4['email']}),_0x22564f=await master_shop[_0x31f3c0(0xe6)](),_0x10bbd1=await staff['findOne']({'email':_0x2f8dd4[_0x31f3c0(0x162)]}),_0x35461a=await suppliers[_0x31f3c0(0xe6)]({});let _0x358700;if(_0x2f8dd4[_0x31f3c0(0x17a)]==_0x31f3c0(0x1d1)){const _0x25631e=await staff[_0x31f3c0(0x14f)]({'email':_0x2f8dd4['email']});_0x358700=await warehouse[_0x31f3c0(0x157)]([{'$match':{'status':_0x31f3c0(0x185),'name':_0x25631e[_0x31f3c0(0xdf)]}},{'$group':{'_id':_0x31f3c0(0x142),'name':{'$first':_0x31f3c0(0x142)}}}]);}else _0x358700=await warehouse[_0x31f3c0(0x157)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x31f3c0(0x142),'name':{'$first':_0x31f3c0(0x142)}}}]);const _0x5d42a8=await product[_0x31f3c0(0xe6)]({}),_0xa33b1c=await warehouse['find']({'status':_0x31f3c0(0x185)}),_0x94b415=await purchases_finished[_0x31f3c0(0xe6)]({}),_0xbdd2ad=_0x94b415[_0x31f3c0(0x1b3)]+0x1,_0x2d9ea7=_0x31f3c0(0xf2)+_0xbdd2ad['toString']()[_0x31f3c0(0x12f)](0x5,'0');var _0x3f9fd8=['Ambient',_0x31f3c0(0x159)];if(_0x22564f[0x0][_0x31f3c0(0x143)]=='English\x20(US)')var _0x3422d2=users['English'];else{if(_0x22564f[0x0][_0x31f3c0(0x143)]==_0x31f3c0(0x1ab))var _0x3422d2=users[_0x31f3c0(0x1ab)];else{if(_0x22564f[0x0][_0x31f3c0(0x143)]==_0x31f3c0(0x11a))var _0x3422d2=users[_0x31f3c0(0x11a)];else{if(_0x22564f[0x0][_0x31f3c0(0x143)]==_0x31f3c0(0xd2))var _0x3422d2=users[_0x31f3c0(0xd2)];else{if(_0x22564f[0x0]['language']=='French')var _0x3422d2=users[_0x31f3c0(0x1a5)];else{if(_0x22564f[0x0][_0x31f3c0(0x143)]==_0x31f3c0(0x128))var _0x3422d2=users[_0x31f3c0(0x105)];else{if(_0x22564f[0x0][_0x31f3c0(0x143)]==_0x31f3c0(0xd0))var _0x3422d2=users[_0x31f3c0(0xd0)];else{if(_0x22564f[0x0][_0x31f3c0(0x143)]==_0x31f3c0(0x1c4))var _0x3422d2=users[_0x31f3c0(0x144)];}}}}}}}const _0x5222c8=getRandom8DigitNumber(),_0x1d3396=new Date(),_0x3d468a={'year':_0x31f3c0(0x155),'month':_0x31f3c0(0xba),'day':_0x31f3c0(0xba),'timeZone':_0x31f3c0(0x132)},_0x46b733=_0x1d3396[_0x31f3c0(0xb1)]('en-CA',_0x3d468a);console[_0x31f3c0(0x113)](_0x46b733),_0x5222c8[_0x31f3c0(0x1cc)](_0x58e2ed=>{var _0x427161=_0x31f3c0;_0x2e9224[_0x427161(0x163)](_0x427161(0x18d),{'success':_0x31ed41[_0x427161(0x16d)]('success'),'errors':_0x31ed41[_0x427161(0x16d)](_0x427161(0xa2)),'role':_0x2f8dd4,'profile':_0x173ad4,'suppliers':_0x35461a,'warehouse':_0x358700,'product':_0x5d42a8,'invoice':_0x58e2ed,'master_shop':_0x22564f,'language':_0x3422d2,'find_data':_0xa33b1c,'rooms_data':_0x3f9fd8,'formattedDate':_0x46b733});})[_0x31f3c0(0xea)](_0x23d686=>{var _0x44ed9f=_0x31f3c0;_0x31ed41['flash'](_0x44ed9f(0xa2),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x2e9224[_0x44ed9f(0x13f)](_0x44ed9f(0xe1));});}catch(_0x166b3a){console[_0x31f3c0(0x113)](_0x166b3a);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x17f),auth,async(_0x385c3b,_0x370e96)=>{var _0x59161d=a0_0x3dcf3a;try{const {username:_0x1a4137,email:_0x16e23a,role:_0x517c79}=_0x385c3b[_0x59161d(0x1be)],_0x16a485=_0x385c3b[_0x59161d(0x1be)],_0x1d923b=await profile[_0x59161d(0x14f)]({'email':_0x16a485[_0x59161d(0x162)]}),_0x25fd64=await master_shop[_0x59161d(0xe6)](),_0x2225bc=await staff[_0x59161d(0x14f)]({'email':_0x16a485[_0x59161d(0x162)]}),_0x1914db=await suppliers['find']({});let _0x33a550;if(_0x16a485['role']=='staff'){const _0x2e8df4=await staff[_0x59161d(0x14f)]({'email':_0x16a485['email']});_0x33a550=await warehouse[_0x59161d(0x157)]([{'$match':{'status':'Enabled','name':_0x2e8df4[_0x59161d(0xdf)]}},{'$group':{'_id':_0x59161d(0x142),'name':{'$first':_0x59161d(0x142)}}}]);}else _0x33a550=await warehouse[_0x59161d(0x157)]([{'$match':{'status':_0x59161d(0x185)}},{'$group':{'_id':_0x59161d(0x142),'name':{'$first':'$name'}}}]);const _0x420672=await product[_0x59161d(0xe6)]({}),_0x5af909=await warehouse[_0x59161d(0xe6)]({'status':_0x59161d(0x185)}),_0x255459=await purchases_finished[_0x59161d(0xe6)]({}),_0x4453d7=_0x255459[_0x59161d(0x1b3)]+0x1,_0x1b6a23='INCF-'+_0x4453d7['toString']()['padStart'](0x5,'0');var _0x55064d=['Ambient',_0x59161d(0x159)];if(_0x25fd64[0x0]['language']==_0x59161d(0xfb))var _0x49c523=users['English'];else{if(_0x25fd64[0x0][_0x59161d(0x143)]=='Hindi')var _0x49c523=users[_0x59161d(0x1ab)];else{if(_0x25fd64[0x0][_0x59161d(0x143)]=='German')var _0x49c523=users[_0x59161d(0x11a)];else{if(_0x25fd64[0x0][_0x59161d(0x143)]=='Spanish')var _0x49c523=users[_0x59161d(0xd2)];else{if(_0x25fd64[0x0][_0x59161d(0x143)]==_0x59161d(0x1a5))var _0x49c523=users[_0x59161d(0x1a5)];else{if(_0x25fd64[0x0][_0x59161d(0x143)]==_0x59161d(0x128))var _0x49c523=users[_0x59161d(0x105)];else{if(_0x25fd64[0x0][_0x59161d(0x143)]=='Chinese')var _0x49c523=users[_0x59161d(0xd0)];else{if(_0x25fd64[0x0][_0x59161d(0x143)]==_0x59161d(0x1c4))var _0x49c523=users['Arabic'];}}}}}}}const _0x263ffd=getRandom8DigitNumber();_0x263ffd['then'](_0x39b470=>{var _0x9f7681=_0x59161d;_0x370e96[_0x9f7681(0x163)](_0x9f7681(0x1d3),{'success':_0x385c3b[_0x9f7681(0x16d)](_0x9f7681(0xfc)),'errors':_0x385c3b['flash'](_0x9f7681(0xa2)),'role':_0x16a485,'profile':_0x1d923b,'suppliers':_0x1914db,'warehouse':_0x33a550,'product':_0x420672,'invoice':_0x39b470,'master_shop':_0x25fd64,'language':_0x49c523,'find_data':_0x5af909,'rooms_data':_0x55064d});})[_0x59161d(0xea)](_0x531c42=>{var _0x28be1c=_0x59161d;_0x385c3b['flash'](_0x28be1c(0xa2),_0x28be1c(0x135)),_0x370e96[_0x28be1c(0x13f)](_0x28be1c(0xe1));});}catch(_0x5c9de3){console[_0x59161d(0x113)](_0x5c9de3);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x1df),auth,async(_0x21e145,_0x2f5d85)=>{var _0x333091=a0_0x3dcf3a;try{const _0x2d2662=_0x21e145['params']['id'];console[_0x333091(0x113)](_0x2d2662);const _0x2ba246=await master_shop[_0x333091(0xe6)]();console[_0x333091(0x113)](_0x333091(0x130),_0x2ba246);const _0x5878b1=await product['findOne']({'name':_0x2d2662});console[_0x333091(0x113)]('product',_0x5878b1),_0x2f5d85[_0x333091(0x1ca)](0xc8)[_0x333091(0x1bc)]({'product_data':_0x5878b1,'master':_0x2ba246});}catch(_0x3082f4){console[_0x333091(0x113)](_0x333091(0xf4),_0x3082f4);}}),router['post'](a0_0x3dcf3a(0x10e),auth,async(_0x593acc,_0x1b4951)=>{var _0xe829b=a0_0x3dcf3a;try{const {invoice:_0x6b2fca,date:_0x503ae6,warehouse_name:_0x59c936,prod_name:_0x302732,note:_0x2a3e69,due_amount:_0x6c32d3,Room_name:_0x1e694c,PO_number:_0x5986eb,SCRN:_0x35deea,ReqBy:_0x5dfead,dateofreq:_0x2224c7,suppliers:_0x3cc670,typeservicesData:_0x4b6a82,van:_0x1e5ee4,typevehicle:_0x1d9136,driver:_0x26091b,plate:_0xafa38e,DRSI:_0x38b29b,TSU:_0x1fda1c,TFU:_0x2b242b,JO_number:_0x263ce8,type_of_products:_0x476cbb}=_0x593acc[_0xe829b(0x16e)];if(typeof _0x302732=='string')var _0x409d52=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0xc7)]],_0x1f7b9a=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0x184)]],_0x4c3219=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0x127)]],_0x447002=[_0x593acc['body'][_0xe829b(0xc6)]],_0x5253e5=[_0x593acc[_0xe829b(0x16e)]['prod_secondunit']],_0x5b8ba6=[_0x593acc['body'][_0xe829b(0x192)]],_0x62a457=[_0x593acc['body'][_0xe829b(0x1ac)]],_0xac3179=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0xc8)]],_0x5cbb7d=[_0x593acc[_0xe829b(0x16e)]['MaxStocks_data']],_0x79047d=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0xcf)]],_0x317d7e=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0x160)]],_0x4487e5=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0x1a4)]],_0x331bc6=[_0x593acc['body'][_0xe829b(0x1d8)]],_0x10c118=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0xcd)]],_0x43bb6d=[_0x593acc[_0xe829b(0x16e)]['RoomAssign']],_0x21051e=[_0x593acc['body']['gross_price']],_0xd5cecd=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0x10f)]],_0x11110e=[_0x593acc[_0xe829b(0x16e)][_0xe829b(0x1cd)]],_0x446122=[_0x593acc['body'][_0xe829b(0xb8)]];else var _0x409d52=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0xc7)]],_0x1f7b9a=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x184)]],_0x4c3219=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x127)]],_0x447002=[..._0x593acc[_0xe829b(0x16e)]['prod_primunit']],_0x5253e5=[..._0x593acc['body'][_0xe829b(0xdc)]],_0x5b8ba6=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x192)]],_0x62a457=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x1ac)]],_0xac3179=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0xc8)]],_0x5cbb7d=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x1b2)]],_0x79047d=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0xcf)]],_0x317d7e=[..._0x593acc[_0xe829b(0x16e)]['expiry_date']],_0x4487e5=[..._0x593acc[_0xe829b(0x16e)]['product_date']],_0x331bc6=[..._0x593acc['body'][_0xe829b(0x1d8)]],_0x10c118=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0xcd)]],_0x43bb6d=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0xa6)]],_0x21051e=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x12b)]],_0xd5cecd=[..._0x593acc[_0xe829b(0x16e)]['uuid']],_0x11110e=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0x1cd)]],_0x446122=[..._0x593acc[_0xe829b(0x16e)][_0xe829b(0xb8)]];const _0x3798f8=_0x409d52[_0xe829b(0x1d2)](_0x273179=>{return _0x273179={'product_name':_0x273179};});_0x446122['forEach']((_0x445512,_0x2e47cf)=>{var _0x2c3d53=_0xe829b;_0x3798f8[_0x2e47cf]['product_id']=_0x445512,_0x3798f8[_0x2e47cf][_0x2c3d53(0x199)]=_0x503ae6;}),_0x11110e[_0xe829b(0xe0)]((_0x2b6dc0,_0x45a34c)=>{var _0x2516c9=_0xe829b;_0x3798f8[_0x45a34c][_0x2516c9(0xd6)]=_0x2b6dc0;}),_0x1f7b9a[_0xe829b(0xe0)]((_0x22c077,_0x811ffb)=>{var _0xa2c4e7=_0xe829b;_0x3798f8[_0x811ffb][_0xa2c4e7(0x120)]=_0x22c077;}),_0xd5cecd['forEach']((_0x5e9358,_0x77b313)=>{_0x3798f8[_0x77b313]['uuid']=_0x5e9358;}),_0x4c3219[_0xe829b(0xe0)]((_0x5ed3b2,_0x15f70d)=>{var _0x450280=_0xe829b;_0x3798f8[_0x15f70d][_0x450280(0x125)]=Math[_0x450280(0xdb)](_0x5ed3b2);}),_0x447002['forEach']((_0x67391b,_0x42b2cf)=>{_0x3798f8[_0x42b2cf]['standard_unit']=_0x67391b;}),_0x5253e5['forEach']((_0x18e419,_0x13b61d)=>{_0x3798f8[_0x13b61d]['secondary_unit']=_0x18e419;}),_0x62a457[_0xe829b(0xe0)]((_0x2c50d1,_0x21166e)=>{var _0x4dbef8=_0xe829b;_0x3798f8[_0x21166e][_0x4dbef8(0x1ac)]=_0x2c50d1;}),_0xac3179[_0xe829b(0xe0)]((_0x4d450e,_0x127231)=>{var _0xbe77c6=_0xe829b;_0x3798f8[_0x127231][_0xbe77c6(0xc8)]=_0x4d450e;}),_0x5cbb7d['forEach']((_0x4bc585,_0x16f32d)=>{var _0x44199c=_0xe829b;_0x3798f8[_0x16f32d][_0x44199c(0x1c0)]=_0x4bc585;}),_0x79047d['forEach']((_0x400535,_0x2b01ec)=>{var _0x30808e=_0xe829b;_0x3798f8[_0x2b01ec][_0x30808e(0xcf)]=_0x400535;}),_0x317d7e[_0xe829b(0xe0)]((_0x317aec,_0x37c27f)=>{_0x3798f8[_0x37c27f]['expiry_date']=_0x317aec;}),_0x4487e5[_0xe829b(0xe0)]((_0x174e6f,_0x16d2a6)=>{var _0x1f59f8=_0xe829b;_0x3798f8[_0x16d2a6][_0x1f59f8(0x17b)]=_0x174e6f;}),_0x331bc6[_0xe829b(0xe0)]((_0x435b71,_0x484a67)=>{_0x3798f8[_0x484a67]['maxperunit']=_0x435b71;}),_0x10c118[_0xe829b(0xe0)]((_0xa80b34,_0x42fb06)=>{var _0x2c6b91=_0xe829b;_0x3798f8[_0x42fb06][_0x2c6b91(0x123)]=_0xa80b34;}),_0x43bb6d[_0xe829b(0xe0)]((_0x156d16,_0x4e8318)=>{var _0x13cd8c=_0xe829b;_0x3798f8[_0x4e8318][_0x13cd8c(0x10c)]=_0x156d16;}),_0x21051e[_0xe829b(0xe0)]((_0x1a2c11,_0x53b9f5)=>{_0x3798f8[_0x53b9f5]['gross_price']=_0x1a2c11;});const _0x502752=new invoice_for_incoming();await _0x502752['save']();for(let _0x10a986=0x0;_0x10a986<=_0x43bb6d[_0xe829b(0x1b3)]-0x1;_0x10a986++){_0x3798f8[_0x10a986][_0xe829b(0x1a7)]=_0xe829b(0x1a8)+_0x502752[_0xe829b(0xd5)]['toString']()[_0xe829b(0x12f)](0x8,'0');}const _0x571583=await warehouse_validation_setup[_0xe829b(0x157)]([{'$match':{'warehouse_name':_0x59c936}}]);let _0x18c3f9=[];for(let _0x2c6b95=0x0;_0x2c6b95<=_0x3798f8[_0xe829b(0x1b3)]-0x1;_0x2c6b95++){const _0x10b0b4=_0x3798f8[_0x2c6b95];for(let _0x554551=0x0;_0x554551<=_0x571583[_0xe829b(0x1b3)]-0x1;_0x554551++){const _0x3f8689=_0x571583[_0x554551];for(let _0x1af650=0x0;_0x1af650<=_0x3f8689[_0xe829b(0xde)]['length']-0x1;_0x1af650++){const _0x494487=_0x3f8689[_0xe829b(0xde)][_0x1af650];if(_0x494487[_0xe829b(0x120)]===_0x10b0b4[_0xe829b(0x120)]){let _0x1adba5=_0x10b0b4['quantity'];const _0x46118d=await warehouse['aggregate']([{'$match':{'name':_0x59c936,'room':_0x3f8689[_0xe829b(0x110)]}},{'$unwind':_0xe829b(0x181)},{'$match':{'level':_0x494487[_0xe829b(0xe4)],'bay':_0x494487['bin']}}]);if(_0x46118d[_0xe829b(0x1b3)]==0x0){for(let _0x37cbed=0x0;_0x37cbed<=_0x3f8689['product_data'][_0xe829b(0x1b3)]-0x1&&_0x1adba5>0x0;_0x37cbed++){const _0x23f2ab=_0x3f8689[_0xe829b(0xde)][_0x37cbed];if(_0x10b0b4['product_code']===_0x23f2ab[_0xe829b(0x120)]){_0x18c3f9[_0x37cbed]={};const _0x2f4034=parseInt(_0x23f2ab[_0xe829b(0xf8)]),_0x4f3d91=0x0;let _0x4ccebe=_0x2f4034-_0x4f3d91,_0x318f0f=Math[_0xe829b(0x19c)](_0x1adba5,_0x4ccebe);console['log'](_0xe829b(0x15b)+_0x318f0f+_0xe829b(0x16f)+_0x3f8689[_0xe829b(0xd8)]+_0xe829b(0xc9)+_0x3f8689[_0xe829b(0x110)]+_0xe829b(0x1db)+_0x23f2ab['bay']+_0xe829b(0xc2)+_0x23f2ab[_0xe829b(0x19e)]),_0x18c3f9[_0x37cbed]['product_name']=_0x10b0b4['product_name'],_0x18c3f9[_0x37cbed][_0xe829b(0x120)]=_0x10b0b4['product_code'],_0x18c3f9[_0x37cbed]['product_id']=_0x10b0b4['product_id'],_0x18c3f9[_0x37cbed][_0xe829b(0x199)]=_0x10b0b4['date_recieved'],_0x18c3f9[_0x37cbed][_0xe829b(0xd6)]=_0x10b0b4['sales_category'],_0x18c3f9[_0x37cbed]['uuid']=_0x10b0b4['uuid'],_0x18c3f9[_0x37cbed][_0xe829b(0x125)]=_0x318f0f,_0x18c3f9[_0x37cbed][_0xe829b(0x10b)]=_0x10b0b4['standard_unit'],_0x18c3f9[_0x37cbed][_0xe829b(0x13a)]=_0x10b0b4[_0xe829b(0x13a)],_0x18c3f9[_0x37cbed][_0xe829b(0x1ac)]=_0x10b0b4[_0xe829b(0x1ac)],_0x18c3f9[_0x37cbed][_0xe829b(0xc8)]=_0x10b0b4['secondary_code'],_0x18c3f9[_0x37cbed][_0xe829b(0x1c0)]=_0x10b0b4[_0xe829b(0x1c0)],_0x18c3f9[_0x37cbed][_0xe829b(0xcf)]=_0x10b0b4[_0xe829b(0xcf)],_0x18c3f9[_0x37cbed][_0xe829b(0x160)]=_0x10b0b4[_0xe829b(0x160)],_0x18c3f9[_0x37cbed][_0xe829b(0x17b)]=_0x10b0b4[_0xe829b(0x17b)],_0x18c3f9[_0x37cbed][_0xe829b(0x1e6)]=_0x10b0b4[_0xe829b(0x1e6)],_0x18c3f9[_0x37cbed][_0xe829b(0x123)]=_0x10b0b4['product_cat'],_0x18c3f9[_0x37cbed][_0xe829b(0x1a7)]=_0x10b0b4[_0xe829b(0x1a7)],_0x18c3f9[_0x37cbed]['gross_price']=_0x10b0b4['gross_price'],_0x18c3f9[_0x37cbed][_0xe829b(0x10c)]=_0x3f8689[_0xe829b(0x110)],_0x18c3f9[_0x37cbed]['level']=_0x23f2ab[_0xe829b(0xe4)],_0x18c3f9[_0x37cbed][_0xe829b(0xe4)]=_0x23f2ab[_0xe829b(0x19e)],_0x1adba5-=_0x318f0f;if(_0x1adba5<=0x0)break;}}if(_0x1adba5<=0x0)break;_0x1adba5>0x0&&console[_0xe829b(0x113)]('There\x20is\x20'+_0x1adba5+_0xe829b(0x18e));}}}}}const _0x46df74=_0x18c3f9[_0xe829b(0x145)]((_0x526e26,_0x146bc9)=>{if(_0x146bc9>0x0)return{'item':_0x526e26};}),_0x392a81=_0x46df74['filter'](_0x1811c6=>_0x1811c6[_0xe829b(0x125)]!=='0'&&_0x1811c6[_0xe829b(0x125)]!==''),_0xd8b737=new purchases_finished({'invoice':'INC-'+_0x502752[_0xe829b(0xd5)][_0xe829b(0x156)]()[_0xe829b(0x12f)](0x8,'0'),'suppliers':_0x3cc670,'date':_0x503ae6,'warehouse_name':_0x59c936,'product':_0x392a81,'note':_0x2a3e69,'due_amount':_0x6c32d3,'room':_0x1e694c,'POnumber':_0x5986eb,'SCRN':_0x35deea,'JO_number':_0x263ce8,'ReqBy':_0x5dfead,'dateofreq':_0x2224c7,'typeservicesData':_0x4b6a82,'van':_0x1e5ee4,'typevehicle':_0x1d9136,'driver':_0x26091b,'plate':_0xafa38e,'DRSI':_0x38b29b,'TSU':_0x1fda1c,'TFU':_0x2b242b,'typeOfProducts':_0x476cbb}),_0xa40afe=await _0xd8b737[_0xe829b(0x194)](),_0x27f31a=await purchases_finished[_0xe829b(0x14f)]({'_id':_0xa40afe['_id'][_0xe829b(0x1da)]()});_0x593acc[_0xe829b(0x16d)](_0xe829b(0xfc),'purchase\x20data\x20add\x20successfully'),_0x1b4951[_0xe829b(0x13f)](_0xe829b(0x106)+_0x27f31a['_id'][_0xe829b(0x1da)]());}catch(_0x45d829){console['log'](_0x45d829);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x117),auth,async(_0x583593,_0x25d73b)=>{var _0x112020=a0_0x3dcf3a;try{const {username:_0x52afd3,email:_0x5d6239,role:_0x5adddd}=_0x583593[_0x112020(0x1be)],_0x374231=_0x583593[_0x112020(0x1be)],_0x32da4d=_0x583593[_0x112020(0x151)]['id'],_0x137a9f=await profile['findOne']({'email':_0x374231[_0x112020(0x162)]}),_0x11790b=await master_shop[_0x112020(0xe6)](),_0x121e99=await staff['findOne']({'email':_0x374231[_0x112020(0x162)]}),_0x5d8032=await suppliers[_0x112020(0xe6)]({});let _0x44d0ee;if(_0x374231['role']==_0x112020(0x1d1)){const _0x4a26a2=await staff['findOne']({'email':_0x374231[_0x112020(0x162)]});_0x44d0ee=await warehouse[_0x112020(0x157)]([{'$match':{'status':_0x112020(0x185),'name':_0x4a26a2[_0x112020(0xdf)]}},{'$group':{'_id':_0x112020(0x142),'name':{'$first':_0x112020(0x142)}}}]);}else _0x44d0ee=await warehouse[_0x112020(0x157)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x112020(0x142),'name':{'$first':_0x112020(0x142)}}}]);const _0x34e1ac=await purchases_finished[_0x112020(0x196)](_0x32da4d);if(_0x11790b[0x0][_0x112020(0x143)]=='English\x20(US)')var _0x6842d1=users['English'];else{if(_0x11790b[0x0][_0x112020(0x143)]==_0x112020(0x1ab))var _0x6842d1=users['Hindi'];else{if(_0x11790b[0x0][_0x112020(0x143)]==_0x112020(0x11a))var _0x6842d1=users[_0x112020(0x11a)];else{if(_0x11790b[0x0]['language']==_0x112020(0xd2))var _0x6842d1=users[_0x112020(0xd2)];else{if(_0x11790b[0x0][_0x112020(0x143)]==_0x112020(0x1a5))var _0x6842d1=users[_0x112020(0x1a5)];else{if(_0x11790b[0x0][_0x112020(0x143)]==_0x112020(0x128))var _0x6842d1=users['Portuguese'];else{if(_0x11790b[0x0][_0x112020(0x143)]==_0x112020(0xd0))var _0x6842d1=users[_0x112020(0xd0)];else{if(_0x11790b[0x0][_0x112020(0x143)]==_0x112020(0x1c4))var _0x6842d1=users[_0x112020(0x144)];}}}}}}}_0x25d73b['render'](_0x112020(0x169),{'success':_0x583593['flash'](_0x112020(0xfc)),'errors':_0x583593[_0x112020(0x16d)](_0x112020(0xa2)),'role':_0x374231,'profile':_0x137a9f,'suppliers':_0x5d8032,'warehouse':_0x44d0ee,'master_shop':_0x11790b,'language':_0x6842d1,'purchases_data':_0x34e1ac});}catch(_0x4ee50c){console[_0x112020(0x113)](_0x4ee50c);}});async function get_warehouse_data(_0x1b06e1,_0x5a7ec8){var _0x2d61f0=a0_0x3dcf3a;try{const _0x16ace=await warehouse_temporary[_0x2d61f0(0x14f)]({'name':_0x1b06e1,'room':_0x5a7ec8});if(!_0x16ace){const _0x4cf640=new warehouse_temporary({'name':_0x1b06e1,'address':_0x1b06e1,'status':_0x2d61f0(0x185),'room':_0x5a7ec8,'isStaging':_0x2d61f0(0x129)});return await _0x4cf640[_0x2d61f0(0x194)](),_0x4cf640;}else return _0x16ace;}catch(_0x287f64){console[_0x2d61f0(0xfd)](_0x2d61f0(0x104),_0x287f64);throw _0x287f64;}}function a0_0x17a2(_0x3152bc,_0x487cac){var _0x1a60ea=a0_0x1a60();return a0_0x17a2=function(_0x17a275,_0x51d121){_0x17a275=_0x17a275-0xa1;var _0x1583aa=_0x1a60ea[_0x17a275];return _0x1583aa;},a0_0x17a2(_0x3152bc,_0x487cac);}router['post']('/process/:id',auth,async(_0x36d45f,_0x47d8ab)=>{var _0x4f7e99=a0_0x3dcf3a;try{const _0x5555c0=_0x36d45f[_0x4f7e99(0x151)]['id'],_0x4790f1=await purchases_finished[_0x4f7e99(0x196)](_0x5555c0);let _0x4ea8ef=[];_0x4790f1[_0x4f7e99(0x1c5)]['forEach']((_0xbb011b,_0x4c31aa)=>{var _0x203834=_0x4f7e99;_0x4ea8ef[_0x4c31aa]={},_0x4ea8ef[_0x4c31aa][_0x203834(0xdf)]=_0x4790f1[_0x203834(0xd8)],_0x4ea8ef[_0x4c31aa]['product_id']=_0xbb011b[_0x203834(0xb8)],_0x4ea8ef[_0x4c31aa][_0x203834(0xee)]=_0xbb011b['product_name'],_0x4ea8ef[_0x4c31aa][_0x203834(0x120)]=_0xbb011b[_0x203834(0x120)],_0x4ea8ef[_0x4c31aa][_0x203834(0x125)]=_0xbb011b['quantity'],_0x4ea8ef[_0x4c31aa][_0x203834(0x10b)]=_0xbb011b[_0x203834(0x10b)],_0x4ea8ef[_0x4c31aa][_0x203834(0x13a)]=_0xbb011b[_0x203834(0x13a)],_0x4ea8ef[_0x4c31aa][_0x203834(0x1b7)]=_0xbb011b[_0x203834(0x1b7)],_0x4ea8ef[_0x4c31aa]['bay']=_0xbb011b[_0x203834(0xe4)],_0x4ea8ef[_0x4c31aa][_0x203834(0x1ac)]=_0xbb011b[_0x203834(0x1ac)],_0x4ea8ef[_0x4c31aa]['secondary_code']=_0xbb011b[_0x203834(0xc8)],_0x4ea8ef[_0x4c31aa][_0x203834(0x1c0)]=_0xbb011b[_0x203834(0x1c0)],_0x4ea8ef[_0x4c31aa][_0x203834(0xcf)]=_0xbb011b[_0x203834(0xcf)],_0x4ea8ef[_0x4c31aa][_0x203834(0x160)]=_0xbb011b[_0x203834(0x160)],_0x4ea8ef[_0x4c31aa][_0x203834(0x17b)]=_0xbb011b[_0x203834(0x17b)],_0x4ea8ef[_0x4c31aa][_0x203834(0x1e6)]=_0xbb011b[_0x203834(0x1e6)],_0x4ea8ef[_0x4c31aa][_0x203834(0x123)]=_0xbb011b[_0x203834(0x123)],_0x4ea8ef[_0x4c31aa]['room_name']=_0xbb011b[_0x203834(0x10c)],_0x4ea8ef[_0x4c31aa][_0x203834(0x1a7)]=_0xbb011b[_0x203834(0x1a7)],_0x4ea8ef[_0x4c31aa][_0x203834(0x10f)]=_0xbb011b[_0x203834(0x10f)],_0x4ea8ef[_0x4c31aa][_0x203834(0x12b)]=_0xbb011b[_0x203834(0x12b)],_0x4ea8ef[_0x4c31aa][_0x203834(0xd6)]=_0xbb011b[_0x203834(0xd6)],_0x4ea8ef[_0x4c31aa]['date_recieved']=_0xbb011b[_0x203834(0x199)],_0x4ea8ef[_0x4c31aa][_0x203834(0x1c7)]=_0xbb011b[_0x203834(0x12a)][_0x203834(0x1da)]();});for(let _0x5f00e7=0x0;_0x5f00e7<=_0x4ea8ef[_0x4f7e99(0x1b3)]-0x1;_0x5f00e7++){const _0x58d139=_0x4ea8ef[_0x5f00e7],_0x344424=new warehouse_temporary(_0x58d139);await _0x344424['save']();}_0x4790f1[_0x4f7e99(0xab)]=_0x4f7e99(0x189),await _0x4790f1[_0x4f7e99(0x194)](),_0x36d45f[_0x4f7e99(0x16d)]('success',_0x4f7e99(0x147)),_0x47d8ab[_0x4f7e99(0x13f)](_0x4f7e99(0x106)+_0x4790f1['_id']['valueOf']());}catch(_0x2e29a0){}}),router['post'](a0_0x3dcf3a(0x17f),auth,async(_0x476854,_0x2c1d40)=>{var _0x50b027=a0_0x3dcf3a;try{const {invoice:_0x12f7a3,date:_0x3208f3,warehouse_name:_0x3d1413,prod_name:_0xa62f77,note:_0x130aa5,due_amount:_0x1d9c8f,Room_name:_0x3bc8d4,PO_number:_0x1bdd17,SCRN:_0x2d6ee8,ReqBy:_0x1bd8a2,dateofreq:_0x47f5c3,suppliers:_0x369a46,typeservicesData:_0x121d41,van:_0x19fc93,typevehicle:_0x4b360d,driver:_0x18af95,plate:_0x4ebf96,DRSI:_0x583f9c,TSU:_0x5ca149,TFU:_0x10595c,JO_number:_0xcf28de,type_of_products:_0x104248}=_0x476854[_0x50b027(0x16e)];if(typeof _0xa62f77=='string')var _0x1a3410=[_0x476854[_0x50b027(0x16e)]['prod_name']],_0x55e6e6=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x184)]],_0x1097e3=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x127)]],_0x368afc=[_0x476854[_0x50b027(0x16e)][_0x50b027(0xc6)]],_0x8cdc19=[_0x476854['body'][_0x50b027(0xdc)]],_0x295be2=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x192)]],_0x173a59=[_0x476854[_0x50b027(0x16e)]['primary_code']],_0x1badf4=[_0x476854[_0x50b027(0x16e)][_0x50b027(0xc8)]],_0x17baf9=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x1b2)]],_0x117798=[_0x476854['body'][_0x50b027(0xcf)]],_0x3bea85=[_0x476854['body'][_0x50b027(0x160)]],_0x58bf5a=[_0x476854[_0x50b027(0x16e)]['product_date']],_0x5d5495=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x1d8)]],_0x3b36b1=[_0x476854[_0x50b027(0x16e)][_0x50b027(0xcd)]],_0x45a3a8=[_0x476854['body']['RoomAssign']],_0x1ab00f=[_0x476854['body'][_0x50b027(0x12b)]],_0xf24b95=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x10f)]],_0x153254=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x1cd)]],_0x2a10a2=[_0x476854[_0x50b027(0x16e)][_0x50b027(0x1e0)]];else var _0x1a3410=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0xc7)]],_0x55e6e6=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x184)]],_0x1097e3=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x127)]],_0x368afc=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0xc6)]],_0x8cdc19=[..._0x476854[_0x50b027(0x16e)]['prod_secondunit']],_0x295be2=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x192)]],_0x173a59=[..._0x476854[_0x50b027(0x16e)]['primary_code']],_0x1badf4=[..._0x476854['body'][_0x50b027(0xc8)]],_0x17baf9=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x1b2)]],_0x117798=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0xcf)]],_0x3bea85=[..._0x476854[_0x50b027(0x16e)]['expiry_date']],_0x58bf5a=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x1a4)]],_0x5d5495=[..._0x476854['body'][_0x50b027(0x1d8)]],_0x3b36b1=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0xcd)]],_0x45a3a8=[..._0x476854[_0x50b027(0x16e)]['RoomAssign']],_0x1ab00f=[..._0x476854['body']['gross_price']],_0xf24b95=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x10f)]],_0x153254=[..._0x476854['body'][_0x50b027(0x1cd)]],_0x2a10a2=[..._0x476854[_0x50b027(0x16e)][_0x50b027(0x1e0)]];const _0x28082c=_0x1a3410[_0x50b027(0x1d2)](_0x409f14=>{return _0x409f14={'product_name':_0x409f14};});_0x2a10a2[_0x50b027(0xe0)]((_0x826217,_0x18aadc)=>{_0x28082c[_0x18aadc]['type_of_products']=_0x826217;}),_0x153254['forEach']((_0x54d0c4,_0x4155c6)=>{var _0x25c50a=_0x50b027;_0x28082c[_0x4155c6][_0x25c50a(0xd6)]=_0x54d0c4;}),_0x55e6e6[_0x50b027(0xe0)]((_0x5a9acc,_0x408598)=>{var _0x39d1a9=_0x50b027;_0x28082c[_0x408598][_0x39d1a9(0x120)]=_0x5a9acc;}),_0xf24b95[_0x50b027(0xe0)]((_0x394be8,_0x55f799)=>{_0x28082c[_0x55f799]['uuid']=_0x394be8;}),_0x1097e3[_0x50b027(0xe0)]((_0x1f2fed,_0x5906d8)=>{var _0x26df08=_0x50b027;_0x28082c[_0x5906d8]['quantity']=Math[_0x26df08(0xdb)](_0x1f2fed);}),_0x368afc[_0x50b027(0xe0)]((_0x27a47e,_0x3ab34d)=>{var _0x2beafd=_0x50b027;_0x28082c[_0x3ab34d][_0x2beafd(0x10b)]=_0x27a47e;}),_0x8cdc19[_0x50b027(0xe0)]((_0x1042db,_0x43f721)=>{var _0x445f36=_0x50b027;_0x28082c[_0x43f721][_0x445f36(0x13a)]=_0x1042db;}),_0x295be2['forEach']((_0x46c172,_0xb6b9fa)=>{var _0x6476b6=_0x50b027,_0x399dbf=_0x46c172[_0x6476b6(0xa5)](/[A-Za-z]+/)[0x0],_0x296db2=parseInt(_0x46c172[_0x6476b6(0xa5)](/\d+/)[0x0]);_0x28082c[_0xb6b9fa][_0x6476b6(0x1b7)]=_0x399dbf,_0x28082c[_0xb6b9fa][_0x6476b6(0xe4)]=_0x296db2;}),_0x173a59[_0x50b027(0xe0)]((_0xa04378,_0x1627ea)=>{var _0x4620d0=_0x50b027;_0x28082c[_0x1627ea][_0x4620d0(0x1ac)]=_0xa04378;}),_0x1badf4['forEach']((_0x30e018,_0x661208)=>{var _0x2541c7=_0x50b027;_0x28082c[_0x661208][_0x2541c7(0xc8)]=_0x30e018;}),_0x17baf9[_0x50b027(0xe0)]((_0xaef716,_0x185f98)=>{_0x28082c[_0x185f98]['maxStocks']=_0xaef716;}),_0x117798[_0x50b027(0xe0)]((_0x2e279b,_0x2a33d8)=>{_0x28082c[_0x2a33d8]['batch_code']=_0x2e279b;}),_0x3bea85[_0x50b027(0xe0)]((_0x57d04a,_0x10a3a2)=>{var _0x2f0412=_0x50b027;_0x28082c[_0x10a3a2][_0x2f0412(0x160)]=_0x57d04a;}),_0x58bf5a[_0x50b027(0xe0)]((_0x31cf26,_0x3cea7d)=>{_0x28082c[_0x3cea7d]['production_date']=_0x31cf26;}),_0x5d5495[_0x50b027(0xe0)]((_0x4b71a9,_0x5dee8a)=>{var _0x59ede6=_0x50b027;_0x28082c[_0x5dee8a][_0x59ede6(0x1e6)]=_0x4b71a9;}),_0x3b36b1[_0x50b027(0xe0)]((_0x8f6fab,_0x1c7022)=>{var _0x52e4ab=_0x50b027;_0x28082c[_0x1c7022][_0x52e4ab(0x123)]=_0x8f6fab;}),_0x45a3a8['forEach']((_0x463934,_0x39ef14)=>{var _0x296ebc=_0x50b027;_0x28082c[_0x39ef14][_0x296ebc(0x10c)]=_0x463934;}),_0x1ab00f[_0x50b027(0xe0)]((_0x25caf8,_0x4452ff)=>{var _0x270000=_0x50b027;_0x28082c[_0x4452ff][_0x270000(0x12b)]=_0x25caf8;});const _0x13cb29=new purchases_logs();await _0x13cb29['save']();for(let _0x269e4a=0x0;_0x269e4a<=_0x45a3a8[_0x50b027(0x1b3)]-0x1;_0x269e4a++){_0x28082c[_0x269e4a][_0x50b027(0x1a7)]='LOG-INC-'+_0x13cb29[_0x50b027(0xd5)][_0x50b027(0x156)]()[_0x50b027(0x12f)](0x8,'0');}const _0x2153f3=_0x28082c[_0x50b027(0x145)](_0x3b9b3a=>_0x3b9b3a[_0x50b027(0x125)]!=='0'&&_0x3b9b3a[_0x50b027(0x125)]!==''),_0x5c8c78=new purchases_finished({'invoice':_0x50b027(0x13b)+_0x13cb29[_0x50b027(0xd5)][_0x50b027(0x156)]()[_0x50b027(0x12f)](0x8,'0'),'suppliers':_0x369a46,'date':_0x3208f3,'warehouse_name':_0x3d1413,'product':_0x2153f3,'note':_0x130aa5,'due_amount':_0x1d9c8f,'room':_0x3bc8d4,'POnumber':_0x1bdd17,'SCRN':_0x2d6ee8,'JO_number':_0xcf28de,'ReqBy':_0x1bd8a2,'dateofreq':_0x47f5c3,'typeservicesData':_0x121d41,'van':_0x19fc93,'typevehicle':_0x4b360d,'driver':_0x18af95,'plate':_0x4ebf96,'DRSI':_0x583f9c,'TSU':_0x5ca149,'TFU':_0x10595c,'typeOfProducts':_0x104248}),_0x7dc89f=await _0x5c8c78['save'](),_0xf0be5=await purchases_finished[_0x50b027(0x14f)]({'_id':_0x7dc89f[_0x50b027(0x12a)][_0x50b027(0x1da)]()}),_0x18cb8c=_0xf0be5['product'][_0x50b027(0x1d2)](async _0x2cf71d=>{var _0x58838a=_0x50b027;try{var _0x265976=await warehouse[_0x58838a(0x14f)]({'name':_0x3d1413,'room':_0x2cf71d['room_name']}),_0x3bb16c=0x0;const _0xd083db=_0x265976['product_details'][_0x58838a(0x1d2)](_0x191f6d=>{var _0x4bdc7c=_0x58838a;console['log'](_0x191f6d[_0x4bdc7c(0xee)]+'=='+_0x2cf71d[_0x4bdc7c(0xee)]+'&&'+_0x191f6d[_0x4bdc7c(0xe4)]+'=='+_0x2cf71d[_0x4bdc7c(0xe4)]+'&&'+_0x191f6d['expiry_date']+'=='+_0x2cf71d['expiry_date']+'&&'+_0x191f6d['production_date']+'=='+_0x2cf71d[_0x4bdc7c(0x17b)]+'&&'+_0x191f6d[_0x4bdc7c(0xcf)]+'=='+_0x2cf71d['batch_code']+'&&'+_0x191f6d[_0x4bdc7c(0x1a7)]+'=='+_0xf0be5[_0x4bdc7c(0x1a7)]),_0x191f6d[_0x4bdc7c(0xee)]==_0x2cf71d[_0x4bdc7c(0xee)]&&_0x191f6d['bay']==_0x2cf71d[_0x4bdc7c(0xe4)]&&_0x191f6d[_0x4bdc7c(0x1b7)]==_0x2cf71d['level']&&_0x191f6d['expiry_date']==_0x2cf71d[_0x4bdc7c(0x160)]&&_0x191f6d['production_date']==_0x2cf71d[_0x4bdc7c(0x17b)]&&_0x191f6d[_0x4bdc7c(0xcf)]==_0x2cf71d['batch_code']&&_0x191f6d[_0x4bdc7c(0x1a7)]==_0xf0be5['invoice']&&(_0x191f6d[_0x4bdc7c(0x1b4)]=Math[_0x4bdc7c(0xdb)](_0x191f6d[_0x4bdc7c(0x1b4)])+Math[_0x4bdc7c(0xdb)](_0x2cf71d['quantity']),_0x3bb16c++);});return _0x3bb16c==0x0&&(_0x265976['product_details']=_0x265976[_0x58838a(0x115)][_0x58838a(0xa9)]({'product_name':_0x2cf71d[_0x58838a(0xee)],'product_stock':Math[_0x58838a(0xdb)](_0x2cf71d['quantity']),'primary_code':_0x2cf71d[_0x58838a(0x1ac)],'secondary_code':_0x2cf71d[_0x58838a(0xc8)],'product_code':_0x2cf71d[_0x58838a(0x120)],'bay':_0x2cf71d[_0x58838a(0xe4)],'level':_0x2cf71d[_0x58838a(0x1b7)],'maxProducts':_0x2cf71d[_0x58838a(0x1c0)],'unit':_0x2cf71d[_0x58838a(0x10b)],'secondary_unit':_0x2cf71d[_0x58838a(0x13a)],'expiry_date':_0x2cf71d['expiry_date'],'production_date':_0x2cf71d[_0x58838a(0x17b)],'maxProducts':_0x2cf71d[_0x58838a(0x1c0)],'maxPerUnit':_0x2cf71d['maxperunit'],'batch_code':_0x2cf71d[_0x58838a(0xcf)],'product_cat':_0x2cf71d[_0x58838a(0x123)],'invoice':_0x2cf71d['invoice'],'id_incoming':_0x2cf71d['_id'],'uuid':_0x2cf71d[_0x58838a(0x10f)],'gross_price':_0x2cf71d['gross_price'],'sales_category':_0x2cf71d[_0x58838a(0xd6)],'type_products':_0x2cf71d[_0x58838a(0x1e5)]})),_0x265976;}catch(_0x48cc3d){return console['error'](_0x58838a(0x118),_0x48cc3d),null;}});Promise['all'](_0x18cb8c)[_0x50b027(0x1cc)](async _0x302751=>{var _0x278cec=_0x50b027;try{for(const _0x104b31 of _0x302751){await warehouse[_0x278cec(0x121)]({'_id':_0x104b31[_0x278cec(0x12a)]},{'$addToSet':{'product_details':{'$each':_0x104b31[_0x278cec(0x115)]}}});}const _0x25f0de=await master_shop[_0x278cec(0xe6)](),_0xc54da3=await email_settings[_0x278cec(0x14f)](),_0x42c9ee=await supervisor_settings[_0x278cec(0xe6)]();var _0x312c2a=_0xf0be5[_0x278cec(0x1c5)],_0xaedd20='',_0x55970b;for(_0x55970b in _0x312c2a){var _0x41927a='FG';_0xf0be5[_0x278cec(0xd8)]==_0x278cec(0x13e)&&(_0x41927a='DG'),_0xaedd20+=_0x278cec(0xce)+_0x278cec(0xaf)+_0x312c2a[_0x55970b][_0x278cec(0xee)]+_0x278cec(0xc1)+_0x278cec(0xaf)+_0x312c2a[_0x55970b][_0x278cec(0x120)]+_0x278cec(0xc1)+_0x278cec(0xaf)+_0x312c2a[_0x55970b][_0x278cec(0x125)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x312c2a[_0x55970b][_0x278cec(0x10b)]+_0x278cec(0xc1)+_0x278cec(0xaf)+_0x312c2a[_0x55970b]['secondary_unit']+_0x278cec(0xc1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf0be5['warehouse_name']+_0x278cec(0xc1)+_0x278cec(0xaf)+_0x312c2a[_0x55970b]['room_name']+_0x278cec(0xc1)+_0x278cec(0xaf)+_0x41927a+_0x312c2a[_0x55970b][_0x278cec(0xe4)]+'</td>',_0x278cec(0x166);}let _0x3d0cc8=nodemailer['createTransport']({'host':_0xc54da3[_0x278cec(0xa1)],'port':Number(_0xc54da3[_0x278cec(0xf6)]),'secure':![],'auth':{'user':_0xc54da3[_0x278cec(0x162)],'pass':_0xc54da3['password']}}),_0x4f7a5d={'from':_0xc54da3[_0x278cec(0x162)],'to':_0x42c9ee[0x0][_0x278cec(0x173)],'subject':_0x278cec(0x1d7),'attachments':[{'filename':_0x278cec(0x18b),'path':__dirname+_0x278cec(0x16a)+_0x278cec(0xef)+_0x25f0de[0x0]['image'],'cid':_0x278cec(0xf3)}],'html':'<!DOCTYPE\x20html>'+_0x278cec(0x126)+_0x278cec(0x1e4)+_0x278cec(0x170)+_0x278cec(0x150)+_0x278cec(0x170)+_0x278cec(0xe7)+_0x278cec(0xac)+'<div>'+_0x278cec(0x1d4)+_0x25f0de[0x0]['site_title']+_0x278cec(0x1bb)+_0x278cec(0xac)+'</div>'+_0x278cec(0x1dc)+_0x278cec(0x170)+_0x278cec(0xf0)+_0x278cec(0xe9)+_0xf0be5['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x278cec(0x13c)+_0xf0be5[_0x278cec(0x17e)]+'\x20'+_0x278cec(0xb9)+_0x278cec(0xe2)+_0x278cec(0xac)+_0x278cec(0x195)+_0x278cec(0x1af)+_0x278cec(0xce)+_0x278cec(0x149)+_0x278cec(0x1ad)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x278cec(0x191)+_0x278cec(0x146)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x278cec(0xa8)+_0x278cec(0x166)+_0x278cec(0xb0)+_0x278cec(0xbc)+'\x20'+_0xaedd20+'\x20'+_0x278cec(0x1ba)+_0x278cec(0x1ce)+'<div>'+_0x278cec(0xd9)+_0x278cec(0x12e)+_0x25f0de[0x0][_0x278cec(0x119)]+_0x278cec(0xe2)+_0x278cec(0xac)+_0x278cec(0xac)+_0x278cec(0x122)};_0x3d0cc8[_0x278cec(0xae)](_0x4f7a5d,function(_0x2c2758,_0x418fee){var _0x27a1c1=_0x278cec;_0x2c2758?(console[_0x27a1c1(0x113)](_0x2c2758),console['log'](_0x27a1c1(0xc3))):console[_0x27a1c1(0x113)](_0x27a1c1(0x13d));});}catch(_0x4e2426){console[_0x278cec(0xfd)](_0x4e2426),_0x2c1d40['status'](0x1f4)['json']({'error':_0x278cec(0xa4),'message':_0x4e2426[_0x278cec(0x171)]});}})[_0x50b027(0xea)](_0x3bd129=>{var _0x2a9b98=_0x50b027;console[_0x2a9b98(0xfd)](_0x3bd129);}),_0x476854[_0x50b027(0x16d)](_0x50b027(0xfc),_0x50b027(0x131)),_0x2c1d40[_0x50b027(0x13f)](_0x50b027(0x188)+_0xf0be5[_0x50b027(0x12a)]['valueOf']());}catch(_0x24d137){console[_0x50b027(0x113)](_0x24d137);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x168),auth,async(_0xcca1c1,_0x3c91e7)=>{var _0x34d45b=a0_0x3dcf3a;try{const {username:_0x5925f9,email:_0xee1100,role:_0x1b499a}=_0xcca1c1[_0x34d45b(0x1be)],_0x1132d7=_0xcca1c1['user'],_0x2945de=await profile[_0x34d45b(0x14f)]({'email':_0x1132d7[_0x34d45b(0x162)]}),_0x2b04ba=await master_shop['find'](),_0x219858=_0xcca1c1['params']['id'],_0x4539e8=await purchases_finished['findById'](_0x219858),_0x8b662d=await suppliers[_0x34d45b(0xe6)]({});let _0x4c1204;if(_0x1132d7['role']==_0x34d45b(0x1d1)){const _0x4bc398=await staff[_0x34d45b(0x14f)]({'email':_0x1132d7[_0x34d45b(0x162)]});_0x4c1204=await warehouse[_0x34d45b(0xe6)]({'status':_0x34d45b(0x185),'name':_0x4bc398[_0x34d45b(0xdf)],'warehouse_category':'Finished\x20Goods'});}else _0x4c1204=await warehouse[_0x34d45b(0x157)]([{'$match':{'status':_0x34d45b(0x185),'warehouse_category':_0x34d45b(0xfe)}},{'$group':{'_id':'$name','name':{'$first':_0x34d45b(0x142)}}}]);const _0x572954=await product['find']({}),_0x45f908=BayBinSelected(_0x4539e8[_0x34d45b(0xd8)],_0x4539e8[_0x34d45b(0x110)]);let _0x119c63=new Date(_0x4539e8[_0x34d45b(0x160)]),_0x41cfd7=('0'+_0x119c63[_0x34d45b(0x178)]())[_0x34d45b(0x154)](-0x2),_0x37114f=('0'+(_0x119c63[_0x34d45b(0x19f)]()+0x1))[_0x34d45b(0x154)](-0x2),_0x38fa14=_0x119c63[_0x34d45b(0xbb)](),_0x6c6f8a=_0x38fa14+'-'+_0x37114f+'-'+_0x41cfd7;if(_0x2b04ba[0x0][_0x34d45b(0x143)]==_0x34d45b(0xfb)){var _0x338637=users[_0x34d45b(0x18a)];console['log'](_0x338637);}else{if(_0x2b04ba[0x0][_0x34d45b(0x143)]=='Hindi')var _0x338637=users[_0x34d45b(0x1ab)];else{if(_0x2b04ba[0x0]['language']==_0x34d45b(0x11a))var _0x338637=users['German'];else{if(_0x2b04ba[0x0][_0x34d45b(0x143)]=='Spanish')var _0x338637=users['Spanish'];else{if(_0x2b04ba[0x0]['language']==_0x34d45b(0x1a5))var _0x338637=users[_0x34d45b(0x1a5)];else{if(_0x2b04ba[0x0][_0x34d45b(0x143)]==_0x34d45b(0x128))var _0x338637=users[_0x34d45b(0x105)];else{if(_0x2b04ba[0x0][_0x34d45b(0x143)]=='Chinese')var _0x338637=users[_0x34d45b(0xd0)];else{if(_0x2b04ba[0x0]['language']==_0x34d45b(0x1c4))var _0x338637=users[_0x34d45b(0x144)];}}}}}}}_0x3c91e7['render']('edit_purchases_finished_view',{'success':_0xcca1c1[_0x34d45b(0x16d)](_0x34d45b(0xfc)),'errors':_0xcca1c1[_0x34d45b(0x16d)]('errors'),'role':_0x1132d7,'profile':_0x2945de,'purchases':_0x4539e8,'suppliers':_0x8b662d,'warehouse':_0x4c1204,'product':_0x572954,'master_shop':_0x2b04ba,'language':_0x338637,'ed_fullDate':_0x6c6f8a,'dataSelected':_0x45f908});}catch(_0x1d2456){console[_0x34d45b(0x113)](_0x1d2456);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0xc4),auth,async(_0x17fa8a,_0x469db4)=>{var _0x4e36ee=a0_0x3dcf3a;try{const {username:_0x15beeb,email:_0xca863d,role:_0x4ec23a}=_0x17fa8a['user'],_0x12a2b6=_0x17fa8a[_0x4e36ee(0x1be)],_0x197df5=await profile[_0x4e36ee(0x14f)]({'email':_0x12a2b6[_0x4e36ee(0x162)]}),_0x390387=await master_shop[_0x4e36ee(0xe6)](),_0x5a3da1=_0x17fa8a['params']['id'],_0x2ba0fa=await purchases_finished['findById'](_0x5a3da1),_0x2f2d5c=await suppliers[_0x4e36ee(0xe6)]({});let _0x57da28;if(_0x12a2b6[_0x4e36ee(0x17a)]==_0x4e36ee(0x1d1)){const _0x114097=await staff[_0x4e36ee(0x14f)]({'email':_0x12a2b6['email']});_0x57da28=await warehouse[_0x4e36ee(0xe6)]({'status':'Enabled','name':_0x114097['warehouse'],'warehouse_category':_0x4e36ee(0xfe)});}else _0x57da28=await warehouse[_0x4e36ee(0x157)]([{'$match':{'status':_0x4e36ee(0x185),'warehouse_category':_0x4e36ee(0xfe)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x67f29a=await product[_0x4e36ee(0xe6)]({}),_0x30d55b=BayBinSelected(_0x2ba0fa[_0x4e36ee(0xd8)],_0x2ba0fa['room']);let _0x147b83=new Date(_0x2ba0fa[_0x4e36ee(0x160)]),_0x51a892=('0'+_0x147b83[_0x4e36ee(0x178)]())[_0x4e36ee(0x154)](-0x2),_0xb932de=('0'+(_0x147b83[_0x4e36ee(0x19f)]()+0x1))[_0x4e36ee(0x154)](-0x2),_0x3e1a72=_0x147b83[_0x4e36ee(0xbb)](),_0x66309b=_0x3e1a72+'-'+_0xb932de+'-'+_0x51a892;if(_0x390387[0x0][_0x4e36ee(0x143)]==_0x4e36ee(0xfb)){var _0x449f3e=users[_0x4e36ee(0x18a)];console['log'](_0x449f3e);}else{if(_0x390387[0x0][_0x4e36ee(0x143)]==_0x4e36ee(0x1ab))var _0x449f3e=users['Hindi'];else{if(_0x390387[0x0][_0x4e36ee(0x143)]=='German')var _0x449f3e=users[_0x4e36ee(0x11a)];else{if(_0x390387[0x0][_0x4e36ee(0x143)]=='Spanish')var _0x449f3e=users[_0x4e36ee(0xd2)];else{if(_0x390387[0x0][_0x4e36ee(0x143)]==_0x4e36ee(0x1a5))var _0x449f3e=users[_0x4e36ee(0x1a5)];else{if(_0x390387[0x0][_0x4e36ee(0x143)]==_0x4e36ee(0x128))var _0x449f3e=users[_0x4e36ee(0x105)];else{if(_0x390387[0x0][_0x4e36ee(0x143)]=='Chinese')var _0x449f3e=users['Chinese'];else{if(_0x390387[0x0][_0x4e36ee(0x143)]==_0x4e36ee(0x1c4))var _0x449f3e=users[_0x4e36ee(0x144)];}}}}}}}_0x469db4[_0x4e36ee(0x163)]('edit_purchases_finished',{'success':_0x17fa8a[_0x4e36ee(0x16d)](_0x4e36ee(0xfc)),'errors':_0x17fa8a[_0x4e36ee(0x16d)](_0x4e36ee(0xa2)),'role':_0x12a2b6,'profile':_0x197df5,'purchases':_0x2ba0fa,'suppliers':_0x2f2d5c,'warehouse':_0x57da28,'product':_0x67f29a,'master_shop':_0x390387,'language':_0x449f3e,'ed_fullDate':_0x66309b,'dataSelected':_0x30d55b});}catch(_0x453c18){console[_0x4e36ee(0x113)](_0x453c18);}}),router[a0_0x3dcf3a(0xd3)]('/view/:id',auth,async(_0x82229d,_0x7388e1)=>{var _0x3f9e7b=a0_0x3dcf3a;try{const _0x34c8be=_0x82229d[_0x3f9e7b(0x151)]['id'],_0x1878a6=await purchases_finished[_0x3f9e7b(0x14f)]({'_id':_0x82229d[_0x3f9e7b(0x151)]['id']}),_0x107940=await warehouse['findOne']({'name':_0x1878a6['warehouse_name'],'room':_0x1878a6['room']});_0x1878a6[_0x3f9e7b(0x1c5)][_0x3f9e7b(0xe0)](_0x4574c4=>{var _0x2ef827=_0x3f9e7b;const _0x5da08d=_0x107940[_0x2ef827(0x115)][_0x2ef827(0x1d2)](_0x2cea7c=>{var _0x4583c2=_0x2ef827;_0x2cea7c[_0x4583c2(0xee)]==_0x4574c4[_0x4583c2(0xee)]&&_0x2cea7c[_0x4583c2(0xe4)]==_0x4574c4['bay']&&(_0x2cea7c[_0x4583c2(0x1b4)]=parseInt(_0x2cea7c[_0x4583c2(0x1b4)])-parseInt(_0x4574c4[_0x4583c2(0x125)]));});}),await _0x107940[_0x3f9e7b(0x194)]();const {invoice:_0xbce298,suppliers:_0x49a843,date:_0x395c72,warehouse_name:_0x463274,prod_name:_0x2eb509,prod_code:_0x3321e8,prod_qty:_0x1adf56,prod_unit:_0x124968,prod_secondunit:_0x40dd92,prod_level:_0x29f245,prod_isle:_0x4b383d,prod_pallet:_0x520fd7,note:_0x2aa440,expiry_date:_0x59a0f3,batch_code:_0x49c7d1,paid_amount:_0x16809f,due_amount:_0x4262ae,Room_name:_0x290270,primary_code:_0x4990e3,secondary_code:_0x4a2dc3,PO_number:_0x205590,JO_number:_0x49d342}=_0x82229d[_0x3f9e7b(0x16e)];if(typeof _0x2eb509==_0x3f9e7b(0x19d))var _0x599d05=[_0x82229d['body']['prod_name']],_0x108865=[_0x82229d[_0x3f9e7b(0x16e)]['prod_code']],_0x381cf9=[_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x11c)]],_0x219016=[_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x182)]],_0x628113=[_0x82229d[_0x3f9e7b(0x16e)]['prod_secondunit']],_0x35b8e2=[_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x192)]],_0xaa7125=[_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x1ac)]],_0x4784ba=[_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0xc8)]],_0x5a649d=[_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x1b2)]],_0x2eef7f=[_0x82229d[_0x3f9e7b(0x16e)]['batch_code']],_0x19f294=[_0x82229d['body'][_0x3f9e7b(0x160)]];else var _0x599d05=[..._0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0xc7)]],_0x108865=[..._0x82229d['body'][_0x3f9e7b(0x184)]],_0x381cf9=[..._0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x11c)]],_0x219016=[..._0x82229d['body'][_0x3f9e7b(0x182)]],_0x628113=[..._0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0xdc)]],_0x35b8e2=[..._0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x192)]],_0xaa7125=[..._0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x1ac)]],_0x4784ba=[..._0x82229d[_0x3f9e7b(0x16e)]['secondary_code']],_0x5a649d=[..._0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x1b2)]],_0x2eef7f=[..._0x82229d['body'][_0x3f9e7b(0xcf)]],_0x19f294=[..._0x82229d[_0x3f9e7b(0x16e)]['expiry_date']];const _0x4f0b7c=_0x599d05[_0x3f9e7b(0x1d2)](_0x3249ba=>{return _0x3249ba={'product_name':_0x3249ba};});_0x108865['forEach']((_0x3ff67f,_0x5347a0)=>{var _0x4ed6a7=_0x3f9e7b;_0x4f0b7c[_0x5347a0][_0x4ed6a7(0x120)]=_0x3ff67f;}),_0x381cf9['forEach']((_0x24bf98,_0x17d291)=>{var _0x51f5fa=_0x3f9e7b;_0x4f0b7c[_0x17d291][_0x51f5fa(0x125)]=_0x24bf98;}),_0x219016[_0x3f9e7b(0xe0)]((_0x4e0b30,_0x54a0e8)=>{var _0x1d41ac=_0x3f9e7b;_0x4f0b7c[_0x54a0e8][_0x1d41ac(0x10b)]=_0x4e0b30;}),_0x628113[_0x3f9e7b(0xe0)]((_0x29affd,_0x2e2a28)=>{var _0x122894=_0x3f9e7b;_0x4f0b7c[_0x2e2a28][_0x122894(0x13a)]=_0x29affd;}),_0x35b8e2[_0x3f9e7b(0xe0)]((_0x2d9241,_0x54c61f)=>{var _0x467221=_0x3f9e7b;_0x4f0b7c[_0x54c61f][_0x467221(0xe4)]=_0x2d9241;}),_0xaa7125[_0x3f9e7b(0xe0)]((_0x2795cf,_0x19c2a1)=>{var _0x2dca75=_0x3f9e7b;_0x4f0b7c[_0x19c2a1][_0x2dca75(0x1ac)]=_0x2795cf;}),_0x4784ba[_0x3f9e7b(0xe0)]((_0x155eaf,_0x95af7d)=>{_0x4f0b7c[_0x95af7d]['secondary_code']=_0x155eaf;}),_0x5a649d['forEach']((_0x1c4ae7,_0x1271b5)=>{var _0x245732=_0x3f9e7b;_0x4f0b7c[_0x1271b5][_0x245732(0x1c0)]=_0x1c4ae7;}),_0x2eef7f['forEach']((_0x216963,_0x11bd66)=>{var _0x33ad10=_0x3f9e7b;_0x4f0b7c[_0x11bd66][_0x33ad10(0xcf)]=_0x216963;}),_0x19f294[_0x3f9e7b(0xe0)]((_0x2d8166,_0x5dc57c)=>{var _0x253e92=_0x3f9e7b;_0x4f0b7c[_0x5dc57c][_0x253e92(0x160)]=_0x2d8166;});const _0x1bc3ac=_0x4f0b7c[_0x3f9e7b(0x145)](_0x431ea1=>_0x431ea1[_0x3f9e7b(0x125)]!=='0'&&_0x431ea1[_0x3f9e7b(0x125)]!=='');_0x1878a6[_0x3f9e7b(0x1a7)]=_0xbce298,_0x1878a6[_0x3f9e7b(0xd4)]=_0x49a843,_0x1878a6[_0x3f9e7b(0x17e)]=_0x395c72,_0x1878a6[_0x3f9e7b(0xd8)]=_0x463274,_0x1878a6[_0x3f9e7b(0x1c5)]=_0x1bc3ac,_0x1878a6['note']=_0x2aa440,_0x1878a6['paid_amount']=_0x16809f,_0x1878a6[_0x3f9e7b(0x198)]=_0x4262ae,_0x1878a6[_0x3f9e7b(0x110)]=_0x290270,_0x1878a6[_0x3f9e7b(0xe3)]=_0x205590,_0x1878a6['JO_number']=_0x49d342;const _0x482a1a=await _0x1878a6[_0x3f9e7b(0x194)](),_0x50fd65=await warehouse[_0x3f9e7b(0x14f)]({'name':_0x82229d['body'][_0x3f9e7b(0xd8)],'room':_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x11f)]});_0x1878a6['product']['forEach'](_0x8d0b11=>{var _0xa10e60=_0x3f9e7b,_0x21db85=0x0;const _0x39f83a=_0x50fd65[_0xa10e60(0x115)][_0xa10e60(0x1d2)](_0x1c3bc3=>{var _0xec0c79=_0xa10e60;_0x1c3bc3['product_name']==_0x8d0b11[_0xec0c79(0xee)]&&_0x1c3bc3[_0xec0c79(0xe4)]==_0x8d0b11[_0xec0c79(0xe4)]&&(_0x1c3bc3[_0xec0c79(0x1b4)]=parseInt(_0x1c3bc3[_0xec0c79(0x1b4)])+parseInt(_0x8d0b11[_0xec0c79(0x125)]),_0x21db85++);});_0x21db85=='0'&&(_0x50fd65[_0xa10e60(0x115)]=_0x50fd65[_0xa10e60(0x115)][_0xa10e60(0xa9)]({'product_name':_0x8d0b11['product_name'],'product_stock':_0x8d0b11[_0xa10e60(0x125)],'primary_code':_0x8d0b11[_0xa10e60(0x1ac)],'secondary_code':_0x8d0b11[_0xa10e60(0xc8)],'product_code':_0x8d0b11[_0xa10e60(0x120)],'bay':_0x8d0b11['bay'],'maxProducts':_0x8d0b11[_0xa10e60(0x1c0)],'unit':_0x8d0b11[_0xa10e60(0x10b)],'secondary_unit':_0x8d0b11['secondary_unit'],'expiry_date':_0x8d0b11[_0xa10e60(0x160)]}));}),await _0x50fd65[_0x3f9e7b(0x194)]();const _0x34f254=await s_payment_data['findOne']({'invoice':_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x1a7)]});if(_0x34f254===null){}else console[_0x3f9e7b(0x113)]('suppliers',_0x34f254,_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0x1a7)]),_0x34f254[_0x3f9e7b(0xd4)]=_0x82229d[_0x3f9e7b(0x16e)][_0x3f9e7b(0xd4)],await _0x34f254[_0x3f9e7b(0x194)]();_0x82229d['flash'](_0x3f9e7b(0xfc),_0x3f9e7b(0x1b9)),_0x7388e1[_0x3f9e7b(0x13f)](_0x3f9e7b(0xe1));}catch(_0x20592a){console['log'](_0x20592a);}}),router['post'](a0_0x3dcf3a(0xeb),auth,async(_0x4de2fb,_0x25a6d0)=>{var _0x3586ad=a0_0x3dcf3a;try{const _0xae4099=_0x4de2fb[_0x3586ad(0x151)]['id'],{invoice:_0x86fb6d,suppliers:_0xac2bed,payable:_0x2e8d45,due_amount:_0x49861c}=_0x4de2fb['body'],_0x158261=await purchases['findById'](_0xae4099);var _0x21c384=_0x2e8d45-_0x49861c;_0x158261[_0x3586ad(0xcb)]=parseFloat(_0x158261['paid_amount'])+parseFloat(_0x49861c),_0x158261[_0x3586ad(0x198)]=_0x21c384;const _0x2478ac=await _0x158261['save']();console['log'](_0x2478ac);const _0x4e04ea=await s_payment_data[_0x3586ad(0x14f)]({'invoice':_0x86fb6d});_0x4e04ea[_0x3586ad(0x1c6)]=_0x21c384,await _0x4e04ea[_0x3586ad(0x194)]();let _0x53292d=new Date(),_0x82db2a=('0'+_0x53292d[_0x3586ad(0x178)]())[_0x3586ad(0x154)](-0x2),_0x226f54=('0'+(_0x53292d[_0x3586ad(0x19f)]()+0x1))[_0x3586ad(0x154)](-0x2),_0x51ab3d=_0x53292d[_0x3586ad(0xbb)](),_0x2418b1=_0x51ab3d+'-'+_0x226f54+'-'+_0x82db2a;const _0x4c6c2f=new suppliers_payment({'invoice':_0x86fb6d,'date':_0x51ab3d+'-'+_0x226f54+'-'+_0x82db2a,'suppliers':_0xac2bed,'reason':_0x3586ad(0x1bf),'amount':_0x49861c}),_0x5c48e4=await _0x4c6c2f[_0x3586ad(0x194)]();_0x4de2fb[_0x3586ad(0x16d)](_0x3586ad(0xfc),'payment\x20successfull'),_0x25a6d0['redirect']('/all_purchases/view');}catch(_0x1dd29e){console['log'](_0x1dd29e);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x1de),auth,async(_0x4043b0,_0x16d3eb)=>{var _0x1be720=a0_0x3dcf3a;try{const {username:_0x1dabee,email:_0x5826a8,role:_0x1cad3b}=_0x4043b0[_0x1be720(0x1be)],_0x2ba048=_0x4043b0[_0x1be720(0x1be)],_0x1696e5=await profile[_0x1be720(0x14f)]({'email':_0x2ba048[_0x1be720(0x162)]}),_0x455ad3=await master_shop[_0x1be720(0xe6)]();console[_0x1be720(0x113)](_0x1be720(0x130),_0x455ad3);const _0x8fcba0=_0x4043b0[_0x1be720(0x151)]['id'],_0x40ec7a=await purchases['findById'](_0x8fcba0);console[_0x1be720(0x113)](_0x40ec7a);const _0x229427=await suppliers[_0x1be720(0x14f)]({'name':_0x40ec7a[_0x1be720(0xd4)]});console[_0x1be720(0x113)](_0x229427);if(_0x455ad3[0x0]['language']==_0x1be720(0xfb)){var _0xee09b0=users[_0x1be720(0x18a)];console[_0x1be720(0x113)](_0xee09b0);}else{if(_0x455ad3[0x0][_0x1be720(0x143)]==_0x1be720(0x1ab))var _0xee09b0=users['Hindi'];else{if(_0x455ad3[0x0][_0x1be720(0x143)]=='German')var _0xee09b0=users[_0x1be720(0x11a)];else{if(_0x455ad3[0x0]['language']==_0x1be720(0xd2))var _0xee09b0=users[_0x1be720(0xd2)];else{if(_0x455ad3[0x0][_0x1be720(0x143)]==_0x1be720(0x1a5))var _0xee09b0=users['French'];else{if(_0x455ad3[0x0][_0x1be720(0x143)]=='Portuguese\x20(BR)')var _0xee09b0=users[_0x1be720(0x105)];else{if(_0x455ad3[0x0]['language']==_0x1be720(0xd0))var _0xee09b0=users['Chinese'];else{if(_0x455ad3[0x0][_0x1be720(0x143)]==_0x1be720(0x1c4))var _0xee09b0=users[_0x1be720(0x144)];}}}}}}}_0x16d3eb[_0x1be720(0x163)](_0x1be720(0xda),{'success':_0x4043b0[_0x1be720(0x16d)](_0x1be720(0xfc)),'errors':_0x4043b0[_0x1be720(0x16d)]('errors'),'role':_0x2ba048,'profile':_0x1696e5,'master_shop':_0x455ad3,'supplier':_0x229427,'purchase':_0x40ec7a,'language':_0xee09b0});}catch(_0xc6763a){console[_0x1be720(0x113)](_0xc6763a);}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0xc5),auth,async(_0x5975cf,_0xe5a250)=>{var _0x3e09d2=a0_0x3dcf3a;try{const {username:_0x29c995,email:_0x191148,role:_0x126c96}=_0x5975cf[_0x3e09d2(0x1be)],_0x3d8d70=_0x5975cf[_0x3e09d2(0x1be)],_0x383a6e=await profile[_0x3e09d2(0x14f)]({'email':_0x3d8d70[_0x3e09d2(0x162)]}),_0xff6b4a=await master_shop[_0x3e09d2(0xe6)]();console[_0x3e09d2(0x113)]('master',_0xff6b4a);const _0x4606a2=_0x5975cf[_0x3e09d2(0x151)]['id'];console[_0x3e09d2(0x113)](_0x4606a2);const _0x42e38e=await purchases_finished['findById'](_0x4606a2);console['log']('user_id',_0x42e38e);const _0x43ef84=await product[_0x3e09d2(0xe6)]({}),_0x335197=await warehouse[_0x3e09d2(0x157)]([{'$match':{'name':_0x42e38e['warehouse_name'],'room':_0x42e38e['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3e09d2(0x176),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3e09d2(0x1d5)},'bay':{'$first':_0x3e09d2(0x14d)},'bin':{'$first':_0x3e09d2(0x19b)},'type':{'$first':_0x3e09d2(0xf9)},'floorlevel':{'$first':_0x3e09d2(0xed)},'primary_code':{'$first':_0x3e09d2(0x152)},'secondary_code':{'$first':_0x3e09d2(0x172)},'product_code':{'$first':_0x3e09d2(0x136)},'storage':{'$first':_0x3e09d2(0x133)},'rack':{'$first':_0x3e09d2(0xdd)}}}]);console['log']('stock_data',_0x335197);let _0x153333;if(_0x3d8d70[_0x3e09d2(0x17a)]==_0x3e09d2(0x1d1)){const _0x5331cc=await staff[_0x3e09d2(0x14f)]({'email':_0x3d8d70[_0x3e09d2(0x162)]});_0x153333=await warehouse[_0x3e09d2(0xe6)]({'status':'Enabled','name':_0x5331cc[_0x3e09d2(0xdf)],'warehouse_category':_0x3e09d2(0xfe),'name':_0x3e09d2(0x102)});}else _0x153333=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3e09d2(0xfe),'name':_0x3e09d2(0x102)}},{'$group':{'_id':_0x3e09d2(0x142),'name':{'$first':'$name'}}}]);if(_0xff6b4a[0x0][_0x3e09d2(0x143)]==_0x3e09d2(0xfb)){var _0x3c6be6=users[_0x3e09d2(0x18a)];console[_0x3e09d2(0x113)](_0x3c6be6);}else{if(_0xff6b4a[0x0][_0x3e09d2(0x143)]=='Hindi')var _0x3c6be6=users[_0x3e09d2(0x1ab)];else{if(_0xff6b4a[0x0][_0x3e09d2(0x143)]==_0x3e09d2(0x11a))var _0x3c6be6=users[_0x3e09d2(0x11a)];else{if(_0xff6b4a[0x0][_0x3e09d2(0x143)]==_0x3e09d2(0xd2))var _0x3c6be6=users[_0x3e09d2(0xd2)];else{if(_0xff6b4a[0x0]['language']=='French')var _0x3c6be6=users[_0x3e09d2(0x1a5)];else{if(_0xff6b4a[0x0][_0x3e09d2(0x143)]==_0x3e09d2(0x128))var _0x3c6be6=users[_0x3e09d2(0x105)];else{if(_0xff6b4a[0x0][_0x3e09d2(0x143)]==_0x3e09d2(0xd0))var _0x3c6be6=users['Chinese'];else{if(_0xff6b4a[0x0][_0x3e09d2(0x143)]==_0x3e09d2(0x1c4))var _0x3c6be6=users[_0x3e09d2(0x144)];}}}}}}}_0xe5a250[_0x3e09d2(0x163)](_0x3e09d2(0xbe),{'success':_0x5975cf[_0x3e09d2(0x16d)](_0x3e09d2(0xfc)),'errors':_0x5975cf[_0x3e09d2(0x16d)]('errors'),'role':_0x3d8d70,'profile':_0x383a6e,'user':_0x42e38e,'stock':_0x335197,'master_shop':_0xff6b4a,'product':_0x43ef84,'language':_0x3c6be6,'warehouse':_0x153333});}catch(_0x569811){console[_0x3e09d2(0x113)](_0x569811);}}),router[a0_0x3dcf3a(0xd3)](a0_0x3dcf3a(0xc5),auth,async(_0x1d052b,_0x217ddf)=>{var _0x4045de=a0_0x3dcf3a;try{const {invoice:_0xf49d4,date:_0x422ad3,warehouse_name:_0x212c81,Room_name:_0x5f56b3,product_name:_0x3411e4,purchase_quantity:_0x502e86,stocks:_0x2b3440,return_qty:_0x2940b4,note:_0x1c2f80,level:_0x5dfe29,isle:_0x74d676,pallet:_0x381d69,to_warehouse_name:_0x2cb9ca,to_Room_name:_0x3606bf}=_0x1d052b[_0x4045de(0x16e)],_0x21e872=await purchases_finished[_0x4045de(0x14f)]({'_id':_0x1d052b[_0x4045de(0x151)]['id']}),_0x180e07=await warehouse['findOne']({'name':_0x212c81,'room':_0x5f56b3,'warehouse_category':'Finished\x20Goods'});if(typeof _0x3411e4=='string')var _0x2fcf65=[_0x1d052b[_0x4045de(0x16e)]['product_name']],_0x45dbff=[_0x1d052b[_0x4045de(0x16e)]['purchase_quantity']],_0x55a9d4=[_0x1d052b[_0x4045de(0x16e)][_0x4045de(0x140)]],_0x5cb5e5=[_0x1d052b['body'][_0x4045de(0xca)]],_0x3bb2f7=[_0x1d052b[_0x4045de(0x16e)][_0x4045de(0x1b7)]],_0x2511c2=[_0x1d052b[_0x4045de(0x16e)][_0x4045de(0x11e)]],_0x39fb95=[_0x1d052b[_0x4045de(0x16e)][_0x4045de(0xb7)]],_0x18d4d2=[_0x1d052b[_0x4045de(0x16e)][_0x4045de(0x1aa)]];else var _0x2fcf65=[..._0x1d052b[_0x4045de(0x16e)][_0x4045de(0xee)]],_0x45dbff=[..._0x1d052b[_0x4045de(0x16e)][_0x4045de(0xff)]],_0x55a9d4=[..._0x1d052b[_0x4045de(0x16e)]['stocks']],_0x5cb5e5=[..._0x1d052b['body'][_0x4045de(0xca)]],_0x3bb2f7=[..._0x1d052b[_0x4045de(0x16e)][_0x4045de(0x1b7)]],_0x2511c2=[..._0x1d052b[_0x4045de(0x16e)]['product_code_hide']],_0x39fb95=[..._0x1d052b[_0x4045de(0x16e)][_0x4045de(0xb7)]],_0x18d4d2=[..._0x1d052b[_0x4045de(0x16e)][_0x4045de(0x1aa)]];const _0x248fe8=_0x2fcf65[_0x4045de(0x1d2)](_0x34f9e5=>{return _0x34f9e5={'product_name':_0x34f9e5};});_0x45dbff[_0x4045de(0xe0)]((_0x4d7649,_0x196203)=>{var _0x3118bd=_0x4045de;_0x248fe8[_0x196203][_0x3118bd(0xff)]=_0x4d7649;}),_0x55a9d4[_0x4045de(0xe0)]((_0x574eb3,_0x245151)=>{var _0x1eaaef=_0x4045de;_0x248fe8[_0x245151][_0x1eaaef(0xf5)]=_0x574eb3;}),_0x5cb5e5[_0x4045de(0xe0)]((_0x3ef282,_0x4b07fa)=>{var _0x363955=_0x4045de;_0x248fe8[_0x4b07fa][_0x363955(0xca)]=_0x3ef282;}),_0x3bb2f7[_0x4045de(0xe0)]((_0x7d8d98,_0x8d4f09)=>{var _0x3acf0e=_0x4045de;_0x248fe8[_0x8d4f09][_0x3acf0e(0xe4)]=_0x7d8d98;}),_0x2511c2[_0x4045de(0xe0)]((_0x168b72,_0x243c70)=>{var _0x34d276=_0x4045de;_0x248fe8[_0x243c70][_0x34d276(0x120)]=_0x168b72;}),_0x39fb95[_0x4045de(0xe0)]((_0x2331d1,_0x70e5c5)=>{var _0x48c2d5=_0x4045de;_0x248fe8[_0x70e5c5][_0x48c2d5(0x1ac)]=_0x2331d1;}),_0x18d4d2[_0x4045de(0xe0)]((_0x71db85,_0x2dd48e)=>{_0x248fe8[_0x2dd48e]['secondary_code']=_0x71db85;}),_0x248fe8[_0x4045de(0xe0)](_0x519c2b=>{var _0x5d3918=_0x4045de;console[_0x5d3918(0x113)](_0x519c2b);const _0x272097=_0x180e07['product_details'][_0x5d3918(0x1d2)](_0x4da8b7=>{var _0x11a6a1=_0x5d3918;_0x4da8b7[_0x11a6a1(0xee)]==_0x519c2b[_0x11a6a1(0xee)]&&_0x4da8b7['bay']==_0x519c2b[_0x11a6a1(0xe4)]&&(console[_0x11a6a1(0x113)](parseInt(_0x4da8b7[_0x11a6a1(0x1b4)])+_0x11a6a1(0xf1)+parseInt(_0x519c2b[_0x11a6a1(0xca)])),_0x4da8b7[_0x11a6a1(0x1b4)]=parseInt(_0x4da8b7[_0x11a6a1(0x1b4)])-parseInt(_0x519c2b['return_qty']));});}),await _0x180e07[_0x4045de(0x194)]();var _0x5f3d12=0x0;_0x248fe8[_0x4045de(0xe0)](_0x23ab80=>{var _0x4cb280=_0x4045de;(parseInt(_0x23ab80['purchase_quantity'])<parseInt(_0x23ab80[_0x4cb280(0xca)])||parseInt(_0x23ab80[_0x4cb280(0xf5)])<parseInt(_0x23ab80[_0x4cb280(0xca)]))&&_0x5f3d12++;});if(_0x5f3d12!=0x0)return _0x1d052b[_0x4045de(0x16d)](_0x4045de(0xa2),_0x4045de(0xfa)),_0x217ddf['redirect']('back');const _0x568e32=new purchases_return_finished({'invoice':_0xf49d4,'suppliers':_0x1d052b[_0x4045de(0x16e)][_0x4045de(0xd4)],'date':_0x422ad3,'warehouse_name':_0x212c81,'return_product':_0x248fe8,'note':_0x1c2f80,'room':_0x5f56b3,'to_warehouse_name':_0x2cb9ca,'to_room':_0x3606bf}),_0x3bbc3f=await _0x568e32[_0x4045de(0x194)](),_0x59b166=await purchases_return_finished[_0x4045de(0x14f)]({'invoice':_0xf49d4}),_0x1dfd93=await warehouse[_0x4045de(0x14f)]({'name':_0x2cb9ca,'room':_0x3606bf,'warehouse_category':_0x4045de(0xfe)});_0x59b166['return_product'][_0x4045de(0xe0)](_0x4e1de3=>{var _0x1effa4=_0x4045de,_0x51b445=0x0;const _0x2a8f36=_0x1dfd93['product_details'][_0x1effa4(0x1d2)](_0x4f3ec5=>{var _0x3e5534=_0x1effa4;console[_0x3e5534(0x113)](_0x4f3ec5[_0x3e5534(0xee)]+'=='+_0x4e1de3[_0x3e5534(0xee)]+'&&'+_0x4f3ec5[_0x3e5534(0xe4)]+'=='+_0x4e1de3[_0x3e5534(0xe4)]),_0x4f3ec5['product_name']==_0x4e1de3[_0x3e5534(0xee)]&&_0x4f3ec5[_0x3e5534(0xe4)]==_0x4e1de3['bay']&&(_0x4f3ec5[_0x3e5534(0x1b4)]=parseInt(_0x4f3ec5[_0x3e5534(0x1b4)])-parseInt(_0x4e1de3['return_qty']),_0x51b445++);});_0x51b445=='0'&&(_0x1dfd93[_0x1effa4(0x115)]=_0x1dfd93[_0x1effa4(0x115)][_0x1effa4(0xa9)]({'product_name':_0x4e1de3[_0x1effa4(0xee)],'product_stock':_0x4e1de3[_0x1effa4(0xca)],'primary_code':_0x4e1de3['primary_code'],'secondary_code':_0x4e1de3[_0x1effa4(0xc8)],'product_code':_0x4e1de3[_0x1effa4(0x120)],'bay':_0x4e1de3[_0x1effa4(0xe4)],'maxProducts':0xf423f}));}),await _0x1dfd93[_0x4045de(0x194)]();const _0x53f1c3=await purchases_finished['findOne']({'invoice':_0xf49d4});_0x53f1c3['return_data']=_0x4045de(0x148);const _0x214cb3=await _0x53f1c3[_0x4045de(0x194)](),_0x233058=new s_payment_data({'invoice':_0xf49d4,'suppliers':_0x1d052b[_0x4045de(0x16e)]['suppliers'],'reason':_0x4045de(0x165)});await _0x233058[_0x4045de(0x194)]();const _0xd23890=await master_shop[_0x4045de(0xe6)](),_0x4eb9eb=await email_settings['findOne'](),_0x1a6c54=await suppliers[_0x4045de(0x14f)]({'name':_0x1d052b[_0x4045de(0x16e)][_0x4045de(0xd4)]});_0xd23890[0x0]['currency_placement']==0x1?(right_currency=_0xd23890[0x0][_0x4045de(0x1a9)],left_currency=''):(right_currency='',left_currency=_0xd23890[0x0][_0x4045de(0x1a9)]);var _0xda483f=_0x2fcf65,_0x55a31e=_0x5cb5e5,_0x4e7c76='',_0xe1a488;for(_0xe1a488 in _0xda483f){_0x4e7c76+='<tr>'+_0x4045de(0xaf)+_0xda483f[_0xe1a488]+_0x4045de(0xc1)+_0x4045de(0xaf)+_0x55a31e[_0xe1a488]+_0x4045de(0xc1)+'</tr>';}let _0x285535=nodemailer[_0x4045de(0x1e3)]({'service':_0x4045de(0x1c9),'auth':{'user':_0x4eb9eb[_0x4045de(0x162)],'pass':_0x4eb9eb[_0x4045de(0x18c)]}}),_0x10199d={'from':_0x4eb9eb[_0x4045de(0x162)],'to':_0x1a6c54[_0x4045de(0x162)],'subject':_0x4045de(0x103),'attachments':[{'filename':_0x4045de(0x18b),'path':__dirname+_0x4045de(0x16a)+_0x4045de(0xef)+_0xd23890[0x0][_0x4045de(0xd7)],'cid':_0x4045de(0xf3)}],'html':_0x4045de(0x15d)+_0x4045de(0x126)+_0x4045de(0x1e4)+_0x4045de(0x170)+_0x4045de(0x150)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4045de(0xac)+'<div>'+_0x4045de(0x1d4)+_0xd23890[0x0]['site_title']+_0x4045de(0x1bb)+_0x4045de(0xac)+'</div>'+_0x4045de(0x1dc)+_0x4045de(0x170)+_0x4045de(0xf0)+'\x20Order\x20Number\x20:\x20'+_0xf49d4+'\x20'+_0x4045de(0x1bd)+_0x4045de(0x13c)+_0x422ad3+'\x20'+'</span>'+_0x4045de(0xe2)+'</div>'+_0x4045de(0x195)+_0x4045de(0x1af)+_0x4045de(0xce)+_0x4045de(0x149)+_0x4045de(0xbd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x4045de(0x112)+_0x4045de(0x166)+'</thead>'+_0x4045de(0xbc)+'\x20'+_0x4e7c76+'\x20'+'</tbody>'+_0x4045de(0x1ce)+'<div>'+_0x4045de(0xd9)+'<h5>'+_0xd23890[0x0][_0x4045de(0x119)]+_0x4045de(0xe2)+'</div>'+_0x4045de(0xac)+_0x4045de(0x122)};_0x285535[_0x4045de(0xae)](_0x10199d,function(_0x251bd8,_0x3d3f75){var _0x2fd6a9=_0x4045de;_0x251bd8?console[_0x2fd6a9(0x113)](_0x2fd6a9(0xc3)):console['log'](_0x2fd6a9(0x13d));}),_0x1d052b[_0x4045de(0x16d)]('success',_0x4045de(0x114)),_0x217ddf['redirect']('/all_purchases_finished/view');}catch(_0x19df46){_0x217ddf[_0x4045de(0x1ca)](0xc8)['json']({'message':_0x19df46['message']});}}),router[a0_0x3dcf3a(0x1c8)](a0_0x3dcf3a(0x1b5),auth,async(_0x28ff11,_0x5e01e7)=>{var _0x7ce47=a0_0x3dcf3a;try{const {username:_0x3e3aea,email:_0x1c728b,role:_0x3b3614}=_0x28ff11[_0x7ce47(0x1be)],_0xda023a=_0x28ff11['user'],_0xd321f5=await profile[_0x7ce47(0x14f)]({'email':_0xda023a[_0x7ce47(0x162)]}),_0x461e7c=await master_shop['find'](),_0x17ed32=_0x28ff11[_0x7ce47(0x151)]['id'],_0x128e93=await purchases_finished[_0x7ce47(0x196)](_0x17ed32);if(_0x461e7c[0x0][_0x7ce47(0x143)]=='English\x20(US)')var _0x4afd3c=users[_0x7ce47(0x18a)];else{if(_0x461e7c[0x0][_0x7ce47(0x143)]==_0x7ce47(0x1ab))var _0x4afd3c=users[_0x7ce47(0x1ab)];else{if(_0x461e7c[0x0]['language']=='German')var _0x4afd3c=users[_0x7ce47(0x11a)];else{if(_0x461e7c[0x0]['language']==_0x7ce47(0xd2))var _0x4afd3c=users[_0x7ce47(0xd2)];else{if(_0x461e7c[0x0][_0x7ce47(0x143)]==_0x7ce47(0x1a5))var _0x4afd3c=users['French'];else{if(_0x461e7c[0x0][_0x7ce47(0x143)]==_0x7ce47(0x128))var _0x4afd3c=users[_0x7ce47(0x105)];else{if(_0x461e7c[0x0][_0x7ce47(0x143)]=='Chinese')var _0x4afd3c=users[_0x7ce47(0xd0)];else{if(_0x461e7c[0x0][_0x7ce47(0x143)]=='Arabic\x20(ae)')var _0x4afd3c=users[_0x7ce47(0x144)];}}}}}}}_0x5e01e7[_0x7ce47(0x163)]('all_purchases_barcode',{'success':_0x28ff11['flash'](_0x7ce47(0xfc)),'errors':_0x28ff11['flash'](_0x7ce47(0xa2)),'role':_0xda023a,'profile':_0xd321f5,'alldata':_0x128e93,'master_shop':_0x461e7c,'language':_0x4afd3c}),console[_0x7ce47(0x113)](alldata);}catch(_0x579483){console[_0x7ce47(0x113)](_0x579483);}}),router[a0_0x3dcf3a(0xd3)]('/barcode_scanner',async(_0x4107f4,_0x1a1746)=>{var _0x838a2f=a0_0x3dcf3a;const {product_code:_0x1da4f3}=_0x4107f4[_0x838a2f(0x16e)];var _0x3d3b0a;const _0x3d4bf1=await product[_0x838a2f(0x157)]([{'$match':{'primary_code':_0x1da4f3}},{'$group':{'_id':_0x838a2f(0x15e),'name':{'$first':'$name'},'category':{'$first':_0x838a2f(0x116)},'brand':{'$first':'$brand'},'unit':{'$first':_0x838a2f(0x18f)},'alertquantity':{'$first':_0x838a2f(0x10d)},'product_code':{'$first':_0x838a2f(0x108)},'primary_code':{'$first':_0x838a2f(0x161)},'secondary_code':{'$first':_0x838a2f(0x179)},'maxStocks':{'$first':_0x838a2f(0x14a)},'maxProdPerUnit':{'$first':_0x838a2f(0x167)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x838a2f(0x190)},'sales_category':{'$first':_0x838a2f(0xb4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x2ff65c=await product[_0x838a2f(0x157)]([{'$match':{'secondary_code':_0x1da4f3}},{'$group':{'_id':'$_id','name':{'$first':_0x838a2f(0x142)},'category':{'$first':_0x838a2f(0x116)},'brand':{'$first':_0x838a2f(0x10a)},'unit':{'$first':_0x838a2f(0x18f)},'alertquantity':{'$first':_0x838a2f(0x10d)},'product_code':{'$first':_0x838a2f(0x108)},'primary_code':{'$first':_0x838a2f(0x161)},'secondary_code':{'$first':_0x838a2f(0x179)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x838a2f(0x167)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x838a2f(0x1b0)},'gross_price':{'$first':_0x838a2f(0x190)},'sales_category':{'$first':_0x838a2f(0xb4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x3d4bf1[_0x838a2f(0x1b3)]>0x0)_0x3d3b0a=_0x3d4bf1;else _0x2ff65c[_0x838a2f(0x1b3)]>0x0&&(_0x3d3b0a=_0x2ff65c);_0x1a1746[_0x838a2f(0x1bc)](_0x3d3b0a);}),router[a0_0x3dcf3a(0xd3)](a0_0x3dcf3a(0x1b6),async(_0x2b5b60,_0x5549ec)=>{var _0x599eff=a0_0x3dcf3a;const {productCode:_0xf47437,bay:_0x294dca,warehouses:_0x2a0fe9,room:_0x118591}=_0x2b5b60[_0x599eff(0x16e)];console[_0x599eff(0x113)](_0x2b5b60[_0x599eff(0x16e)]);try{const _0x3e1783=await warehouse['aggregate']([{'$match':{'name':_0x2a0fe9,'room':_0x118591}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x294dca)}},{'$group':{'_id':_0x599eff(0x176),'name':{'$first':_0x599eff(0x180)},'product_stock':{'$first':_0x599eff(0x1d5)},'bay':{'$first':_0x599eff(0x14d)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x5549ec[_0x599eff(0x1ca)](0xc8)[_0x599eff(0x1bc)](_0x3e1783);}catch(_0x272ceb){_0x5549ec[_0x599eff(0x1ca)](0x194)['json']({'message':_0x272ceb['message']});}}),router[a0_0x3dcf3a(0xd3)](a0_0x3dcf3a(0xb6),async(_0x4dd907,_0x30b65b)=>{var _0x2a3810=a0_0x3dcf3a;const {product_code:_0x18861e}=_0x4dd907[_0x2a3810(0x16e)];var _0x18549f;const _0x42a09e=await product[_0x2a3810(0x157)]([{'$match':{'primary_code':_0x18861e,'type_products':_0x2a3810(0x113)}},{'$group':{'_id':_0x2a3810(0x15e),'name':{'$first':_0x2a3810(0x142)},'category':{'$first':'$category'},'brand':{'$first':_0x2a3810(0x10a)},'unit':{'$first':_0x2a3810(0x18f)},'alertquantity':{'$first':_0x2a3810(0x10d)},'product_code':{'$first':_0x2a3810(0x108)},'primary_code':{'$first':_0x2a3810(0x161)},'secondary_code':{'$first':_0x2a3810(0x179)},'maxStocks':{'$first':_0x2a3810(0x14a)},'maxProdPerUnit':{'$first':_0x2a3810(0x167)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2a3810(0x1b0)},'gross_price':{'$first':_0x2a3810(0x190)},'sales_category':{'$first':_0x2a3810(0xb4)},'type_products':{'$first':_0x2a3810(0x138)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x42a09e);const _0x584af8=await product['aggregate']([{'$match':{'secondary_code':_0x18861e,'type_products':_0x2a3810(0x113)}},{'$group':{'_id':_0x2a3810(0x15e),'name':{'$first':'$name'},'category':{'$first':_0x2a3810(0x116)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2a3810(0x18f)},'alertquantity':{'$first':_0x2a3810(0x10d)},'product_code':{'$first':_0x2a3810(0x108)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2a3810(0x179)},'maxStocks':{'$first':_0x2a3810(0x14a)},'maxProdPerUnit':{'$first':_0x2a3810(0x167)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2a3810(0x1b0)},'gross_price':{'$first':_0x2a3810(0x190)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x42a09e['length']>0x0)_0x18549f=_0x42a09e;else _0x584af8['length']>0x0&&(_0x18549f=_0x584af8);_0x30b65b[_0x2a3810(0x1bc)](_0x18549f);}),module['exports']=router;