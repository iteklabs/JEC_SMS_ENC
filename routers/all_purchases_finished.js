var a0_0x504cd5=a0_0x47a0;(function(_0xb83ad9,_0x3b0d76){var _0x22e1d7=a0_0x47a0,_0x3dff36=_0xb83ad9();while(!![]){try{var _0x2864df=-parseInt(_0x22e1d7(0xd5))/0x1*(parseInt(_0x22e1d7(0x9a))/0x2)+parseInt(_0x22e1d7(0xef))/0x3+parseInt(_0x22e1d7(0x9c))/0x4*(-parseInt(_0x22e1d7(0xdb))/0x5)+-parseInt(_0x22e1d7(0x16a))/0x6*(parseInt(_0x22e1d7(0x12d))/0x7)+parseInt(_0x22e1d7(0xca))/0x8+parseInt(_0x22e1d7(0xcb))/0x9*(-parseInt(_0x22e1d7(0x11a))/0xa)+parseInt(_0x22e1d7(0xc9))/0xb*(parseInt(_0x22e1d7(0x138))/0xc);if(_0x2864df===_0x3b0d76)break;else _0x3dff36['push'](_0x3dff36['shift']());}catch(_0x191791){_0x3dff36['push'](_0x3dff36['shift']());}}}(a0_0x443d,0xe6f80));const express=require(a0_0x504cd5(0x195)),app=express(),router=express[a0_0x504cd5(0x1c8)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x504cd5(0x123)),auth=require(a0_0x504cd5(0x198)),nodemailer=require(a0_0x504cd5(0x1a1));var ejs=require('ejs');const path=require(a0_0x504cd5(0xda)),users=require(a0_0x504cd5(0x115)),{isNull}=require(a0_0x504cd5(0x1a3));router[a0_0x504cd5(0x90)](a0_0x504cd5(0x173),auth,async(_0x5ce593,_0x34eef6)=>{var _0x40f1ab=a0_0x504cd5;try{const {username:_0x43f172,email:_0x18226a,role:_0x48b642}=_0x5ce593[_0x40f1ab(0x1a0)],_0x105c1f=_0x5ce593[_0x40f1ab(0x1a0)],_0x47669b=await profile[_0x40f1ab(0xb1)]({'email':_0x105c1f['email']}),_0x566e3d=await staff[_0x40f1ab(0xb1)]({'email':_0x105c1f['email']}),_0x5d24cd=await master_shop[_0x40f1ab(0xc7)]();let _0xdf3cc1=await transfers_finished[_0x40f1ab(0x9b)]([{'$match':{'to_warehouse':_0x566e3d[_0x40f1ab(0xbc)]}}]);if(_0x5d24cd[0x0][_0x40f1ab(0x14a)]==_0x40f1ab(0x169))var _0x277c05=users[_0x40f1ab(0xcd)];else{if(_0x5d24cd[0x0]['language']==_0x40f1ab(0x17c))var _0x277c05=users[_0x40f1ab(0x17c)];else{if(_0x5d24cd[0x0][_0x40f1ab(0x14a)]==_0x40f1ab(0x104))var _0x277c05=users[_0x40f1ab(0x104)];else{if(_0x5d24cd[0x0][_0x40f1ab(0x14a)]=='Spanish')var _0x277c05=users['Spanish'];else{if(_0x5d24cd[0x0]['language']==_0x40f1ab(0x193))var _0x277c05=users['French'];else{if(_0x5d24cd[0x0]['language']==_0x40f1ab(0x1b8))var _0x277c05=users[_0x40f1ab(0x1b0)];else{if(_0x5d24cd[0x0][_0x40f1ab(0x14a)]==_0x40f1ab(0xf1))var _0x277c05=users[_0x40f1ab(0xf1)];else{if(_0x5d24cd[0x0][_0x40f1ab(0x14a)]=='Arabic\x20(ae)')var _0x277c05=users['Arabic'];}}}}}}}_0x34eef6[_0x40f1ab(0x16d)](_0x40f1ab(0x185),{'success':_0x5ce593[_0x40f1ab(0x130)](_0x40f1ab(0x1a9)),'errors':_0x5ce593[_0x40f1ab(0x130)](_0x40f1ab(0x18c)),'purchases':_0xdf3cc1,'role':_0x105c1f,'profile':_0x47669b,'master_shop':_0x5d24cd,'language':_0x277c05,'staff_data':_0x566e3d});}catch(_0x1ee480){console[_0x40f1ab(0xdd)](_0x40f1ab(0xa8),_0x1ee480),_0x34eef6[_0x40f1ab(0xfd)](0xc8)['json']({'message':_0x1ee480['message']});}}),router[a0_0x504cd5(0x90)](a0_0x504cd5(0x15c),auth,async(_0x1e3407,_0x1aca4c)=>{var _0x190199=a0_0x504cd5;try{const {username:_0x481585,email:_0x220284,role:_0x501155}=_0x1e3407[_0x190199(0x1a0)],_0x51bbd9=_0x1e3407[_0x190199(0x1a0)],_0x99c6d9=await profile[_0x190199(0xb1)]({'email':_0x51bbd9[_0x190199(0xf5)]}),_0x63e470=await staff[_0x190199(0xb1)]({'email':_0x51bbd9['email']}),_0xa5b031=await master_shop[_0x190199(0xc7)]();let _0x5cbb15=await transfers_finished[_0x190199(0x9b)]([{'$match':{'to_warehouse':_0x63e470[_0x190199(0xbc)],'to_recieved':_0x190199(0xcc)}}]);if(_0xa5b031[0x0][_0x190199(0x14a)]==_0x190199(0x169))var _0x3e452c=users[_0x190199(0xcd)];else{if(_0xa5b031[0x0][_0x190199(0x14a)]=='Hindi')var _0x3e452c=users[_0x190199(0x17c)];else{if(_0xa5b031[0x0][_0x190199(0x14a)]==_0x190199(0x104))var _0x3e452c=users[_0x190199(0x104)];else{if(_0xa5b031[0x0]['language']==_0x190199(0x13c))var _0x3e452c=users[_0x190199(0x13c)];else{if(_0xa5b031[0x0][_0x190199(0x14a)]==_0x190199(0x193))var _0x3e452c=users[_0x190199(0x193)];else{if(_0xa5b031[0x0]['language']==_0x190199(0x1b8))var _0x3e452c=users[_0x190199(0x1b0)];else{if(_0xa5b031[0x0][_0x190199(0x14a)]==_0x190199(0xf1))var _0x3e452c=users[_0x190199(0xf1)];else{if(_0xa5b031[0x0][_0x190199(0x14a)]==_0x190199(0x102))var _0x3e452c=users[_0x190199(0x1b9)];}}}}}}}_0x1aca4c[_0x190199(0x16d)]('incoming_add',{'success':_0x1e3407[_0x190199(0x130)](_0x190199(0x1a9)),'errors':_0x1e3407['flash'](_0x190199(0x18c)),'purchases':_0x5cbb15,'role':_0x51bbd9,'profile':_0x99c6d9,'master_shop':_0xa5b031,'language':_0x3e452c,'staff_data':_0x63e470});}catch(_0x5ebacd){console[_0x190199(0xdd)](_0x190199(0xa8),_0x5ebacd),_0x1aca4c[_0x190199(0xfd)](0xc8)['json']({'message':_0x5ebacd[_0x190199(0x196)]});}});function a0_0x443d(){var _0xbe14cd=['$product_details._id','$return_data','random','exports','RoomAssign','INCF-','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','incoming_view','$product_details.bin','match','note','/preview/:id','maxStocks','$product.bay','errors','payment\x20successfull','floor','$alertquantity','isProcess','/view/return_purchase/:id','$product_details.rack','French','$product_details.maxProducts','express','message','item_code','../middleware/auth','$warehouse_name','</span>','save','Error\x20occurred\x20while\x20processing\x20product:','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','sales_data_cateory','<tbody\x20style=\x22text-align:\x20center;\x22>','user','nodemailer','purchase_quantity','util','Enclosed','$unit','</thead>','LOG-INC-','$product','success','invoice_init','There\x20is\x20','prod_qty','image','redirect','body','Portuguese','$gross_price','id_transaction','<strong>\x20Regards\x20</strong>','slice','$paid_amount','purchases_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Portuguese\x20(BR)','Arabic','/all_purchases_finished/process/','$product_details.product_name','$product_code','all_purchases_finished','purchase\x20data\x20add\x20successfully','/view_log','$date','</tr>','<div>','True','invoice','due_amount','stock_data','</head><body>','Router','toString','post','$invoice','room_name','$category','\x20Order\x20Number\x20:\x20','concat','product_stock','$product_details.primary_code','<span\x20style=\x22float:\x20right;\x22>','$product.room_name','to_bay','then','get','Purchase\x20Return','date_recieved','purchase\x20data\x20update\x20successfully','\x20Order\x20Date\x20:\x20','sales_category','quantity','maxProducts','uuid','stock_quantity','6038RKTNuI','aggregate','1598236ZfwGpk','/picking_list/pdf_puchases_fin_own_trf/','expiry_date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','INC','gmail','DRY\x20GOODS','getDate','/view/add_purchases','to_recieved','There\x27s\x20a\x20error\x20in\x20this\x20transaction','table\x20page','/all_purchases_finished/preview/','findById','$expiry_date','/../public','prod_unit','product_details','gross_price','logo','findOne','filter','paid_amount','user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','to_warehouse','params','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','prod_level','forEach','Ambient','warehouse','$sales_category','Email\x20sent\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','primary_code','$maxProdPerUnit','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$batch_code','product_cat','2-digit','find','production_date','11GzLxlb','12244968NyEtIJ','1611cWirCr','false','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$brand','all_purchases_finished_logs','/all_purchases/view','suppliers','<h5>','password','243NMnzmN','to_quantity','date','/view/:id','\x20<>\x20','path','10KzExrV','</div>','log','$suppliers_docs',',\x20bay:\x20','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.bay','length','catch','room','staff','own','logs','</table>','$product_details.type','all','prod_name','padStart','product_date','1471392eoNiHj','Asia/Manila','Chinese','$_id','stocks','</h5>','email','product_code','Purchase\x20Return\x20Mail','$secondary_unit','back','$product_details.product_stock','bay','map','status','abs','prod_cat','JO_number','$product_details','Arabic\x20(ae)','return_qty','German','purchase_invoice','json','$room','string','Transfer\x20Finalize\x20Successfully','_id','<hr\x20class=\x22my-3\x22>','add_purchases_finished_logs','secondary_code_hide','en-CA','product_code_hide','$maxStocks','bin','/getinvoicetrf','role','host','../public/language/languages.json','FROZEN\x20GOODS','Rack\x202','product_id','Room_name','62470mILQWc','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$due_amount','prod_Qty','site_title','product_name','Logo.png','/invoice/:id','$product.floorlevel','../models/all_models','getMonth','secondary_unit','return_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Error\x20Occurs','/process/:id','return_purchase_finished','<tr>','/barcode_scanner_logs','9952145WoEOsn','maxperunit','$product_details.floorlevel','flash','Purchase\x20Mail','<h2>\x20','$product_details.storage','Enabled','An\x20error\x20occurred.','$product_details.product_code','</tbody>','35971752mjEzkX','Distributing\x20','$product.bin','$name','Spanish','valueOf','primary_code_hide','/upload/',',\x20room:\x20','here2','prod_primunit','\x20</h2>','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','Finished\x20Goods','INC-','/view/add_purchases_logs','toLocaleDateString','</body></html>','language','max_product_unit','true','<html><head><title></title>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.quantity','numeric','name','/all_purchases_finished/view','batch_code','product','Paid\x20For\x20Purchase','$product_details.secondary_code','/barcode_scanner','$type_products','$secondary_code','maxPerUnit','/CheckingWarehouse','/incoming/add','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','master','edit_purchases_finished_view','getFullYear','$product.type','error','Rack\x201','level','standard_unit','Return\x20Goods','product_data','$suppliers','English\x20(US)','6ZXGigh','<h5\x20style=\x22text-align:\x20left;\x22>','MaxStocks_data','render','/view/add_purchases/:id','warehouse_name','</td>','type_of_products','suppliers_docs','/incoming','prod_code','/getTRF',',\x20bin:\x20','to_room_name','min','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','type_of_products_type','Hindi','$note'];a0_0x443d=function(){return _0xbe14cd;};return a0_0x443d();}const createLog=async _0x285fe1=>{var _0x1e3c7=a0_0x504cd5;const _0x1f1525=new datalogs({'location':_0x285fe1});return await _0x1f1525[_0x1e3c7(0x19b)](),_0x1f1525[_0x1e3c7(0x1aa)];};router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x15c),auth,async(_0xe24a84,_0xd79e10)=>{var _0x15603a=a0_0x504cd5;try{const {invoice_trf_data:_0x502151,item_code:_0x25e9ff,SCRN:_0xd20978,ReqBy:_0x4bfd93,type_of_products:_0x2eb711,dateofreq:_0x12acb7,PO_number:_0x38453a,date:_0x21abfb,warehouse_name:_0x16f062,typeservicesData:_0x55e5ec,typevehicle:_0x5cf507,driver:_0x5a3d40,plate:_0x1c5ab6,van:_0x342640,DRSI:_0x230b32,TSU:_0x44d0fc,TFU:_0x2e9abb,note:_0x5ae0c5}=_0xe24a84[_0x15603a(0x1af)],_0x2466e4=await transfers_finished['findById'](_0x502151);if(typeof _0x25e9ff=='string')var _0x5b2665=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0x11f)]],_0x3b81fa=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0x197)]],_0x5eae25=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0xd6)]],_0x546bda=[_0xe24a84[_0x15603a(0x1af)]['unit']],_0x20e29a=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0x179)]],_0x37fa80=[_0xe24a84[_0x15603a(0x1af)]['bin']],_0x365eaa=[_0xe24a84['body']['primary_code']],_0x11b675=[_0xe24a84['body'][_0x15603a(0xc2)]],_0x133bd2=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0x153)]],_0xee4ec0=[_0xe24a84['body']['expiry_date']],_0x52ced9=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0xc8)]],_0x4dc6bd=[_0xe24a84[_0x15603a(0x1af)][_0x15603a(0x14b)]],_0x312c16=[_0xe24a84['body'][_0x15603a(0xe5)]];else var _0x5b2665=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0x11f)]],_0x3b81fa=[..._0xe24a84['body']['item_code']],_0x5eae25=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0xd6)]],_0x546bda=[..._0xe24a84[_0x15603a(0x1af)]['unit']],_0x20e29a=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0x179)]],_0x37fa80=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0x111)]],_0x365eaa=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0xc0)]],_0x11b675=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0xc2)]],_0x133bd2=[..._0xe24a84['body'][_0x15603a(0x153)]],_0xee4ec0=[..._0xe24a84['body'][_0x15603a(0x9e)]],_0x52ced9=[..._0xe24a84[_0x15603a(0x1af)][_0x15603a(0xc8)]],_0x4dc6bd=[..._0xe24a84['body'][_0x15603a(0x14b)]],_0x312c16=[..._0xe24a84[_0x15603a(0x1af)]['room']];const _0x488d81=_0x5b2665[_0x15603a(0xfc)](_0x21f545=>{return _0x21f545={'product_name':_0x21f545};});_0x3b81fa[_0x15603a(0xba)]((_0x592b04,_0x10c800)=>{var _0x5adc85=_0x15603a;_0x488d81[_0x10c800][_0x5adc85(0xf6)]=_0x592b04;}),_0x5eae25[_0x15603a(0xba)]((_0x32a0a4,_0x2d8aaa)=>{var _0x32c54d=_0x15603a;_0x488d81[_0x2d8aaa][_0x32c54d(0x96)]=Math[_0x32c54d(0xfe)](_0x32a0a4);}),_0x546bda['forEach']((_0x43e478,_0xf2f72f)=>{var _0xe63e94=_0x15603a;_0x488d81[_0xf2f72f][_0xe63e94(0x165)]=_0x43e478;}),_0x20e29a[_0x15603a(0xba)]((_0x312b88,_0x2b3873)=>{var _0x287907=_0x15603a;_0x488d81[_0x2b3873][_0x287907(0x125)]=_0x312b88;}),_0x37fa80['forEach']((_0x130f3f,_0x3ffaff)=>{var _0x1930d6=_0x15603a,_0x135711=_0x130f3f['match'](/[A-Za-z]+/)[0x0],_0x32608e=parseInt(_0x130f3f[_0x1930d6(0x187)](/\d+/)[0x0]);_0x488d81[_0x3ffaff]['level']=_0x135711,_0x488d81[_0x3ffaff][_0x1930d6(0xfb)]=_0x32608e;}),_0x365eaa[_0x15603a(0xba)]((_0x1f72c7,_0x3b2f92)=>{var _0x3fcd7e=_0x15603a;_0x488d81[_0x3b2f92][_0x3fcd7e(0xc0)]=_0x1f72c7;}),_0x11b675['forEach']((_0x5a4883,_0x2dc3f9)=>{_0x488d81[_0x2dc3f9]['secondary_code']=_0x5a4883;}),_0x133bd2[_0x15603a(0xba)]((_0x575c48,_0xe41581)=>{var _0x22fa14=_0x15603a;_0x488d81[_0xe41581][_0x22fa14(0x153)]=_0x575c48;}),_0xee4ec0[_0x15603a(0xba)]((_0x3b6191,_0x5dea93)=>{var _0x362965=_0x15603a;_0x488d81[_0x5dea93][_0x362965(0x9e)]=_0x3b6191;}),_0x52ced9['forEach']((_0x429904,_0x36e9a2)=>{_0x488d81[_0x36e9a2]['production_date']=_0x429904;}),_0x4dc6bd[_0x15603a(0xba)]((_0x259ef4,_0x3237e6)=>{var _0x1df886=_0x15603a;_0x488d81[_0x3237e6][_0x1df886(0x12e)]=_0x259ef4;}),_0x312c16[_0x15603a(0xba)]((_0x15f15f,_0xcc6c44)=>{var _0x4525df=_0x15603a;_0x488d81[_0xcc6c44][_0x4525df(0x1cc)]=_0x15f15f;});const _0x46b876=await createLog(_0x15603a(0xa1));_0x312c16['forEach']((_0x187b3c,_0x54420e)=>{var _0x41e7cb=_0x15603a;_0x488d81[_0x54420e]['invoice']='INC-'+_0x46b876[_0x41e7cb(0x1c9)]()['padStart'](0x8,'0');});const _0x492861=_0x488d81['filter'](_0x1b0f43=>_0x1b0f43[_0x15603a(0x96)]!=='0'&&_0x1b0f43[_0x15603a(0x96)]!==''),_0x5f0bf5=new purchases_incoming({'invoice':_0x15603a(0x146)+_0x46b876[_0x15603a(0x1c9)]()['padStart'](0x8,'0'),'date':_0x21abfb,'warehouse_name':_0x16f062,'product':_0x492861,'note':_0x5ae0c5,'POnumber':_0x38453a,'SCRN':_0xd20978,'ReqBy':_0x4bfd93,'dateofreq':_0x12acb7,'typeservicesData':_0x55e5ec,'van':_0x342640,'typevehicle':_0x5cf507,'driver':_0x5a3d40,'plate':_0x1c5ab6,'DRSI':_0x230b32,'TSU':_0x44d0fc,'TFU':_0x2e9abb,'typeOfProducts':_0x2eb711}),_0x248040=await _0x5f0bf5['save'](),_0x7536ca=_0x248040['product']['map'](async _0x5e3401=>{var _0x1bd18=_0x15603a,_0x40694a=await warehouse['findOne']({'name':_0x16f062,'room':_0x5e3401[_0x1bd18(0x1cc)]});if(_0x5e3401[_0x1bd18(0x96)]>0x0){var _0x51c8cf=0x0;const _0x1a3475=_0x40694a[_0x1bd18(0xae)][_0x1bd18(0xfc)](_0x5d9642=>{var _0x29c47a=_0x1bd18;_0x5d9642[_0x29c47a(0x11f)]==_0x5e3401[_0x29c47a(0x11f)]&&_0x5d9642[_0x29c47a(0xfb)]==_0x5e3401[_0x29c47a(0x8e)]&&_0x5d9642['expiry_date']==_0x5e3401[_0x29c47a(0x9e)]&&_0x5d9642[_0x29c47a(0xc8)]==_0x5e3401['production_date']&&_0x5d9642[_0x29c47a(0x153)]==_0x5e3401[_0x29c47a(0x153)]&&_0x5d9642[_0x29c47a(0x1c4)]==_0x5e3401[_0x29c47a(0x1c4)]&&(typeof _0x5e3401[_0x29c47a(0x1b2)]=='undefined'?(console[_0x29c47a(0xdd)](_0x29c47a(0x141),_0x5d9642['product_stock']+_0x29c47a(0xd9)+_0x5d9642[_0x29c47a(0x10a)]+'\x20<=>\x20'+Math[_0x29c47a(0xfe)](_0x5d9642[_0x29c47a(0x1d0)])+Math[_0x29c47a(0xfe)](_0x5e3401['to_quantity'])),_0x5d9642[_0x29c47a(0x1d0)]=Math[_0x29c47a(0xfe)](_0x5d9642['product_stock'])+Math['abs'](_0x5e3401[_0x29c47a(0x96)])):(_0x5d9642[_0x29c47a(0x1d0)]=Math[_0x29c47a(0xfe)](_0x5d9642[_0x29c47a(0x1d0)])+Math[_0x29c47a(0xfe)](_0x5e3401['quantity']),_0x51c8cf++));});_0x51c8cf=='0'&&(_0x40694a[_0x1bd18(0xae)]=_0x40694a['product_details'][_0x1bd18(0x1cf)]({'product_name':_0x5e3401['product_name'],'product_stock':_0x5e3401['quantity'],'bay':_0x5e3401[_0x1bd18(0xfb)],'level':_0x5e3401['level'],'product_code':_0x5e3401['product_code'],'primary_code':_0x5e3401[_0x1bd18(0xc0)],'secondary_code':_0x5e3401[_0x1bd18(0xc2)],'expiry_date':_0x5e3401[_0x1bd18(0x9e)],'production_date':_0x5e3401[_0x1bd18(0xc8)],'maxProducts':_0x5e3401[_0x1bd18(0x97)],'batch_code':_0x5e3401[_0x1bd18(0x153)],'secondary_unit':_0x5e3401[_0x1bd18(0x125)],'unit':_0x5e3401[_0x1bd18(0x165)],'maxProducts':_0x5e3401[_0x1bd18(0x97)],'maxPerUnit':_0x5e3401[_0x1bd18(0x15a)],'invoice':_0x5e3401[_0x1bd18(0x1c4)]}));}return _0x40694a;});Promise[_0x15603a(0xeb)](_0x7536ca)[_0x15603a(0x8f)](async _0x5e06be=>{var _0x433b8e=_0x15603a;try{for(const _0x8364d7 of _0x5e06be){await warehouse['updateOne']({'_id':_0x8364d7['_id']},{'$addToSet':{'product_details':{'$each':_0x8364d7[_0x433b8e(0xae)]}}});}_0x2466e4[_0x433b8e(0xa6)]=_0x433b8e(0x14c);const _0x20e5cc=await _0x2466e4[_0x433b8e(0x19b)](),_0x31e1aa=await master_shop[_0x433b8e(0xc7)](),_0x185332=await email_settings[_0x433b8e(0xb1)](),_0x50dac9=await supervisor_settings[_0x433b8e(0xc7)]();var _0x2a42a9=_0x5f0bf5[_0x433b8e(0x154)],_0x476ffb='',_0x4d3b87;for(_0x4d3b87 in _0x2a42a9){var _0x34c341='FG';_0x5f0bf5[_0x433b8e(0xb6)]=='DRY\x20GOODS'&&(_0x34c341='DG'),_0x476ffb+=_0x433b8e(0x12b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a42a9[_0x4d3b87]['product_name']+'</td>'+_0x433b8e(0x14e)+_0x2a42a9[_0x4d3b87]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a42a9[_0x4d3b87][_0x433b8e(0xd6)]+_0x433b8e(0x170)+_0x433b8e(0x14e)+_0x2a42a9[_0x4d3b87]['unit']+'</td>'+_0x433b8e(0x14e)+_0x2a42a9[_0x4d3b87][_0x433b8e(0x125)]+_0x433b8e(0x170)+_0x433b8e(0x14e)+_0x5f0bf5[_0x433b8e(0xb6)]+_0x433b8e(0x170)+_0x433b8e(0x14e)+_0x2a42a9[_0x4d3b87][_0x433b8e(0x177)]+_0x433b8e(0x170)+_0x433b8e(0x14e)+_0x34c341+_0x2a42a9[_0x4d3b87][_0x433b8e(0x8e)]+_0x433b8e(0x170)+'</tr>';}_0xe24a84[_0x433b8e(0x130)](_0x433b8e(0x1a9),_0x433b8e(0x109)),_0xd79e10[_0x433b8e(0x1ae)](_0x433b8e(0x9d)+_0x248040['_id']);}catch(_0x6dc1fe){console[_0x433b8e(0x162)](_0x6dc1fe),_0xd79e10[_0x433b8e(0xfd)](0x1f4)[_0x433b8e(0x106)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x15603a(0xe4)](_0xb57128=>{var _0x455bde=_0x15603a;console[_0x455bde(0x162)](_0xb57128),_0xd79e10[_0x455bde(0xfd)](0x1f4)[_0x455bde(0x106)]({'error':_0x455bde(0x135)});});}catch(_0x557c7f){}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x175),auth,async(_0x83ff5b,_0x524112)=>{var _0x26ff44=a0_0x504cd5;try{const {warehouse:_0x9963e2}=_0x83ff5b['body'],_0x5f2c0a=await transfers_finished[_0x26ff44(0xc7)]({'to_warehouse':_0x9963e2,'to_recieved':_0x26ff44(0xcc)});_0x524112['json'](_0x5f2c0a);}catch(_0x737590){}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x112),auth,async(_0x166282,_0x1bf306)=>{var _0x54135c=a0_0x504cd5;try{const {invoice:_0x55f719}=_0x166282['body'],_0x565591=await transfers_finished[_0x54135c(0xc7)]({'_id':_0x55f719,'to_recieved':_0x54135c(0xcc)});_0x1bf306[_0x54135c(0x106)](_0x565591);}catch(_0x2b7d40){}}),router[a0_0x504cd5(0x90)]('/view',auth,async(_0x2267a2,_0x38ec2c)=>{var _0x376a26=a0_0x504cd5;try{const {username:_0x29b396,email:_0x15705d,role:_0x4d4453}=_0x2267a2[_0x376a26(0x1a0)],_0x112b6c=_0x2267a2[_0x376a26(0x1a0)],_0x42a22d=await profile[_0x376a26(0xb1)]({'email':_0x112b6c['email']}),_0x46dfcc=await staff['findOne']({'email':_0x112b6c[_0x376a26(0xf5)]});if(_0x112b6c[_0x376a26(0x113)]=='staff'){const _0x14d6b0=await staff[_0x376a26(0xb1)]({'email':_0x112b6c[_0x376a26(0xf5)]});}const _0x290f4=await master_shop[_0x376a26(0xc7)]();let _0x3964ab;if(_0x112b6c[_0x376a26(0x113)]==_0x376a26(0xe6)){const _0x42a9b5=await staff[_0x376a26(0xb1)]({'email':_0x112b6c[_0x376a26(0xf5)]});_0x3964ab=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x42a9b5[_0x376a26(0xbc)],'typeOfProducts':'own'}},{'$lookup':{'from':'suppliers','localField':_0x376a26(0xd2),'foreignField':'name','as':_0x376a26(0x172)}},{'$unwind':_0x376a26(0xde)},{'$unwind':_0x376a26(0x1a8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x376a26(0x1cb)},'suppliers':{'$first':_0x376a26(0x168)},'date':{'$first':_0x376a26(0x1c0)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x376a26(0x107)},'product':{'$push':_0x376a26(0x1a8)},'note':{'$first':_0x376a26(0x17d)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x376a26(0x11c)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x376a26(0xc4)},'expiry_date':{'$first':_0x376a26(0xab)},'suppliers_docs':{'$first':_0x376a26(0xde)},'total_product_quantity':{'$sum':_0x376a26(0x14f)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x376a26(0x13a)},'type':{'$addToSet':_0x376a26(0x161)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3964ab=await purchases_finished[_0x376a26(0x9b)]([{'$match':{'typeOfProducts':_0x376a26(0xe7)}},{'$unwind':_0x376a26(0x1a8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x376a26(0x1cb)},'suppliers':{'$first':_0x376a26(0x168)},'date':{'$first':_0x376a26(0x1c0)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x376a26(0x17d)},'paid_amount':{'$first':_0x376a26(0x1b5)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x376a26(0x17f)},'batch_code':{'$first':_0x376a26(0xc4)},'expiry_date':{'$first':_0x376a26(0xab)},'suppliers_docs':{'$first':_0x376a26(0xde)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x376a26(0x18b)},'isle':{'$addToSet':_0x376a26(0x13a)},'type':{'$addToSet':_0x376a26(0x161)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x290f4[0x0][_0x376a26(0x14a)]=='English\x20(US)')var _0x470549=users[_0x376a26(0xcd)];else{if(_0x290f4[0x0][_0x376a26(0x14a)]==_0x376a26(0x17c))var _0x470549=users[_0x376a26(0x17c)];else{if(_0x290f4[0x0][_0x376a26(0x14a)]=='German')var _0x470549=users[_0x376a26(0x104)];else{if(_0x290f4[0x0][_0x376a26(0x14a)]==_0x376a26(0x13c))var _0x470549=users[_0x376a26(0x13c)];else{if(_0x290f4[0x0][_0x376a26(0x14a)]=='French')var _0x470549=users['French'];else{if(_0x290f4[0x0][_0x376a26(0x14a)]==_0x376a26(0x1b8))var _0x470549=users[_0x376a26(0x1b0)];else{if(_0x290f4[0x0]['language']==_0x376a26(0xf1))var _0x470549=users['Chinese'];else{if(_0x290f4[0x0][_0x376a26(0x14a)]=='Arabic\x20(ae)')var _0x470549=users[_0x376a26(0x1b9)];}}}}}}}_0x38ec2c[_0x376a26(0x16d)](_0x376a26(0x1bd),{'success':_0x2267a2[_0x376a26(0x130)]('success'),'errors':_0x2267a2[_0x376a26(0x130)]('errors'),'purchases':_0x3964ab,'role':_0x112b6c,'profile':_0x42a22d,'master_shop':_0x290f4,'language':_0x470549});}catch(_0x3ccb4b){console[_0x376a26(0xdd)](_0x376a26(0xa8),_0x3ccb4b),_0x38ec2c[_0x376a26(0xfd)](0xc8)['json']({'message':_0x3ccb4b[_0x376a26(0x196)]});}}),router['get'](a0_0x504cd5(0x1bf),auth,async(_0x56b095,_0x4bc881)=>{var _0x1a6b61=a0_0x504cd5;try{const {username:_0x3e0218,email:_0x34ef8f,role:_0x15d841}=_0x56b095[_0x1a6b61(0x1a0)],_0x2eba04=_0x56b095[_0x1a6b61(0x1a0)],_0x1d59b3=await profile[_0x1a6b61(0xb1)]({'email':_0x2eba04['email']}),_0x1402d2=await staff[_0x1a6b61(0xb1)]({'email':_0x2eba04[_0x1a6b61(0xf5)]});if(_0x2eba04[_0x1a6b61(0x113)]==_0x1a6b61(0xe6)){const _0x1ca845=await staff['findOne']({'email':_0x2eba04[_0x1a6b61(0xf5)]});}const _0xb34c8b=await master_shop[_0x1a6b61(0xc7)]();let _0x1818ff;if(_0x2eba04['role']=='staff'){const _0x3b09ce=await staff[_0x1a6b61(0xb1)]({'email':_0x2eba04['email']});_0x1818ff=await purchases_finished[_0x1a6b61(0x9b)]([{'$match':{'warehouse_name':_0x3b09ce[_0x1a6b61(0xbc)]}},{'$lookup':{'from':'suppliers','localField':_0x1a6b61(0xd2),'foreignField':_0x1a6b61(0x151),'as':'suppliers_docs'}},{'$unwind':_0x1a6b61(0xde)},{'$unwind':'$product'},{'$group':{'_id':_0x1a6b61(0xf2),'invoice':{'$first':_0x1a6b61(0x1cb)},'suppliers':{'$first':_0x1a6b61(0x168)},'date':{'$first':_0x1a6b61(0x1c0)},'warehouse_name':{'$first':_0x1a6b61(0x199)},'room':{'$first':_0x1a6b61(0x107)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x1a6b61(0x11c)},'return_data':{'$first':_0x1a6b61(0x17f)},'batch_code':{'$first':_0x1a6b61(0xc4)},'expiry_date':{'$first':_0x1a6b61(0xab)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1a6b61(0x14f)},'level':{'$addToSet':_0x1a6b61(0x18b)},'isle':{'$addToSet':_0x1a6b61(0x13a)},'type':{'$addToSet':_0x1a6b61(0x161)},'floorlevel':{'$addToSet':_0x1a6b61(0x122)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1818ff=await purchases_finished[_0x1a6b61(0x9b)]([{'$match':{'typeOfProducts':_0x1a6b61(0xe8)}},{'$unwind':_0x1a6b61(0x1a8)},{'$group':{'_id':_0x1a6b61(0xf2),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x1a6b61(0x1c0)},'warehouse_name':{'$first':_0x1a6b61(0x199)},'room':{'$addToSet':_0x1a6b61(0x1d3)},'product':{'$push':'$product'},'note':{'$first':_0x1a6b61(0x17d)},'paid_amount':{'$first':_0x1a6b61(0x1b5)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x1a6b61(0x17f)},'batch_code':{'$first':_0x1a6b61(0xc4)},'expiry_date':{'$first':_0x1a6b61(0xab)},'suppliers_docs':{'$first':_0x1a6b61(0xde)},'total_product_quantity':{'$sum':_0x1a6b61(0x14f)},'level':{'$addToSet':_0x1a6b61(0x18b)},'isle':{'$addToSet':_0x1a6b61(0x13a)},'type':{'$addToSet':_0x1a6b61(0x161)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xb34c8b[0x0][_0x1a6b61(0x14a)]=='English\x20(US)')var _0x89168c=users['English'];else{if(_0xb34c8b[0x0]['language']=='Hindi')var _0x89168c=users['Hindi'];else{if(_0xb34c8b[0x0][_0x1a6b61(0x14a)]==_0x1a6b61(0x104))var _0x89168c=users[_0x1a6b61(0x104)];else{if(_0xb34c8b[0x0][_0x1a6b61(0x14a)]==_0x1a6b61(0x13c))var _0x89168c=users[_0x1a6b61(0x13c)];else{if(_0xb34c8b[0x0][_0x1a6b61(0x14a)]==_0x1a6b61(0x193))var _0x89168c=users[_0x1a6b61(0x193)];else{if(_0xb34c8b[0x0][_0x1a6b61(0x14a)]==_0x1a6b61(0x1b8))var _0x89168c=users[_0x1a6b61(0x1b0)];else{if(_0xb34c8b[0x0]['language']==_0x1a6b61(0xf1))var _0x89168c=users['Chinese'];else{if(_0xb34c8b[0x0]['language']==_0x1a6b61(0x102))var _0x89168c=users[_0x1a6b61(0x1b9)];}}}}}}}_0x4bc881[_0x1a6b61(0x16d)](_0x1a6b61(0xd0),{'success':_0x56b095['flash'](_0x1a6b61(0x1a9)),'errors':_0x56b095[_0x1a6b61(0x130)](_0x1a6b61(0x18c)),'purchases':_0x1818ff,'role':_0x2eba04,'profile':_0x1d59b3,'master_shop':_0xb34c8b,'language':_0x89168c});}catch(_0x58df5f){console[_0x1a6b61(0xdd)](_0x1a6b61(0xa8),_0x58df5f),_0x4bc881[_0x1a6b61(0xfd)](0xc8)[_0x1a6b61(0x106)]({'message':_0x58df5f['message']});}});function BayBinSelected(_0x4da920,_0x3c054f){var _0x6ff2cf=a0_0x504cd5,_0x4a2797=[],_0x48eb47=[];if(_0x4da920==_0x6ff2cf(0xa3)){switch(_0x3c054f){case _0x6ff2cf(0x163):_0x4a2797=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x6ff2cf(0x117):_0x4a2797=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x48eb47=['DG'];}else{if(_0x4da920==_0x6ff2cf(0x116)){switch(_0x3c054f){case'Rack\x201':_0x4a2797=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x6ff2cf(0x117):_0x4a2797=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x48eb47=['FG'];}}return{'levels':_0x4a2797,'identify':_0x48eb47};}async function getRandom8DigitNumber(){var _0x1fd3a2=a0_0x504cd5;const _0x1052ee=0x989680,_0x2d256c=0x5f5e0ff,_0x2ab791=Math[_0x1fd3a2(0x18e)](Math[_0x1fd3a2(0x180)]()*(_0x2d256c-_0x1052ee+0x1))+_0x1052ee;var _0x1a44e7;const _0x134c72=await purchases_finished[_0x1fd3a2(0xb1)]({'invoice':_0x1fd3a2(0x183)+_0x2ab791});return _0x134c72&&_0x134c72[_0x1fd3a2(0xe3)]>0x0?_0x1a44e7=_0x1fd3a2(0x183)+_0x2ab791:_0x1a44e7=_0x1fd3a2(0x183)+_0x2ab791,_0x1a44e7;}router[a0_0x504cd5(0x90)](a0_0x504cd5(0xa5),auth,async(_0x49d2e2,_0x26e3ea)=>{var _0x6d6d0e=a0_0x504cd5;try{const {username:_0xecd51a,email:_0x3838f7,role:_0x455e88}=_0x49d2e2['user'],_0xd355a1=_0x49d2e2[_0x6d6d0e(0x1a0)],_0x306516=await profile[_0x6d6d0e(0xb1)]({'email':_0xd355a1[_0x6d6d0e(0xf5)]}),_0x5f46a1=await master_shop[_0x6d6d0e(0xc7)](),_0x12010c=await staff[_0x6d6d0e(0xb1)]({'email':_0xd355a1['email']}),_0x246ffd=await suppliers[_0x6d6d0e(0xc7)]({});let _0x268d83;if(_0xd355a1[_0x6d6d0e(0x113)]==_0x6d6d0e(0xe6)){const _0x5e5e78=await staff[_0x6d6d0e(0xb1)]({'email':_0xd355a1['email']});_0x268d83=await warehouse[_0x6d6d0e(0x9b)]([{'$match':{'status':_0x6d6d0e(0x134),'name':_0x5e5e78[_0x6d6d0e(0xbc)]}},{'$group':{'_id':'$name','name':{'$first':_0x6d6d0e(0x13b)}}}]);}else _0x268d83=await warehouse[_0x6d6d0e(0x9b)]([{'$match':{'status':_0x6d6d0e(0x134)}},{'$group':{'_id':_0x6d6d0e(0x13b),'name':{'$first':_0x6d6d0e(0x13b)}}}]);const _0x26a9ae=await product[_0x6d6d0e(0xc7)]({}),_0x42607f=await warehouse[_0x6d6d0e(0xc7)]({'status':_0x6d6d0e(0x134)}),_0x3daaf8=await purchases_finished[_0x6d6d0e(0xc7)]({}),_0xd35dbd=_0x3daaf8[_0x6d6d0e(0xe3)]+0x1,_0x1c49b4=_0x6d6d0e(0x183)+_0xd35dbd['toString']()[_0x6d6d0e(0xed)](0x5,'0');var _0x3e9f75=[_0x6d6d0e(0xbb),_0x6d6d0e(0x1a4)];if(_0x5f46a1[0x0][_0x6d6d0e(0x14a)]==_0x6d6d0e(0x169))var _0x3dc91d=users[_0x6d6d0e(0xcd)];else{if(_0x5f46a1[0x0][_0x6d6d0e(0x14a)]==_0x6d6d0e(0x17c))var _0x3dc91d=users[_0x6d6d0e(0x17c)];else{if(_0x5f46a1[0x0][_0x6d6d0e(0x14a)]=='German')var _0x3dc91d=users[_0x6d6d0e(0x104)];else{if(_0x5f46a1[0x0][_0x6d6d0e(0x14a)]=='Spanish')var _0x3dc91d=users[_0x6d6d0e(0x13c)];else{if(_0x5f46a1[0x0][_0x6d6d0e(0x14a)]=='French')var _0x3dc91d=users[_0x6d6d0e(0x193)];else{if(_0x5f46a1[0x0]['language']==_0x6d6d0e(0x1b8))var _0x3dc91d=users[_0x6d6d0e(0x1b0)];else{if(_0x5f46a1[0x0][_0x6d6d0e(0x14a)]=='Chinese')var _0x3dc91d=users[_0x6d6d0e(0xf1)];else{if(_0x5f46a1[0x0]['language']==_0x6d6d0e(0x102))var _0x3dc91d=users[_0x6d6d0e(0x1b9)];}}}}}}}const _0xf6b642=getRandom8DigitNumber(),_0x2a4d6b=new Date(),_0x4c31ba={'year':_0x6d6d0e(0x150),'month':'2-digit','day':_0x6d6d0e(0xc6),'timeZone':_0x6d6d0e(0xf0)},_0x4131cf=_0x2a4d6b[_0x6d6d0e(0x148)](_0x6d6d0e(0x10e),_0x4c31ba);console[_0x6d6d0e(0xdd)](_0x4131cf),_0xf6b642[_0x6d6d0e(0x8f)](_0x3f807c=>{var _0x19e0c8=_0x6d6d0e;_0x26e3ea[_0x19e0c8(0x16d)]('add_purchases_finished',{'success':_0x49d2e2['flash'](_0x19e0c8(0x1a9)),'errors':_0x49d2e2[_0x19e0c8(0x130)]('errors'),'role':_0xd355a1,'profile':_0x306516,'suppliers':_0x246ffd,'warehouse':_0x268d83,'product':_0x26a9ae,'invoice':_0x3f807c,'master_shop':_0x5f46a1,'language':_0x3dc91d,'find_data':_0x42607f,'rooms_data':_0x3e9f75,'formattedDate':_0x4131cf});})[_0x6d6d0e(0xe4)](_0x443475=>{var _0x2bce7a=_0x6d6d0e;_0x49d2e2[_0x2bce7a(0x130)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x26e3ea[_0x2bce7a(0x1ae)](_0x2bce7a(0x152));});}catch(_0x321203){console[_0x6d6d0e(0xdd)](_0x321203);}}),router[a0_0x504cd5(0x90)](a0_0x504cd5(0x147),auth,async(_0x1e00e4,_0x5112ed)=>{var _0x1d7a36=a0_0x504cd5;try{const {username:_0x4e2615,email:_0x2cfcb4,role:_0x4af873}=_0x1e00e4[_0x1d7a36(0x1a0)],_0x349cc2=_0x1e00e4['user'],_0xc1d98e=await profile[_0x1d7a36(0xb1)]({'email':_0x349cc2[_0x1d7a36(0xf5)]}),_0x10abea=await master_shop[_0x1d7a36(0xc7)](),_0x259bc0=await staff['findOne']({'email':_0x349cc2[_0x1d7a36(0xf5)]}),_0x468334=await suppliers[_0x1d7a36(0xc7)]({});let _0x57e114;if(_0x349cc2[_0x1d7a36(0x113)]==_0x1d7a36(0xe6)){const _0x53541e=await staff[_0x1d7a36(0xb1)]({'email':_0x349cc2[_0x1d7a36(0xf5)]});_0x57e114=await warehouse[_0x1d7a36(0x9b)]([{'$match':{'status':_0x1d7a36(0x134),'name':_0x53541e['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x1d7a36(0x13b)}}}]);}else _0x57e114=await warehouse[_0x1d7a36(0x9b)]([{'$match':{'status':_0x1d7a36(0x134)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x118cac=await product[_0x1d7a36(0xc7)]({}),_0x28b2c2=await warehouse[_0x1d7a36(0xc7)]({'status':_0x1d7a36(0x134)}),_0x52aed8=await purchases_finished[_0x1d7a36(0xc7)]({}),_0x4aa9c0=_0x52aed8[_0x1d7a36(0xe3)]+0x1,_0x211853=_0x1d7a36(0x183)+_0x4aa9c0[_0x1d7a36(0x1c9)]()[_0x1d7a36(0xed)](0x5,'0');var _0x436dc3=[_0x1d7a36(0xbb),_0x1d7a36(0x1a4)];if(_0x10abea[0x0][_0x1d7a36(0x14a)]=='English\x20(US)')var _0x3afb47=users[_0x1d7a36(0xcd)];else{if(_0x10abea[0x0][_0x1d7a36(0x14a)]==_0x1d7a36(0x17c))var _0x3afb47=users[_0x1d7a36(0x17c)];else{if(_0x10abea[0x0][_0x1d7a36(0x14a)]==_0x1d7a36(0x104))var _0x3afb47=users[_0x1d7a36(0x104)];else{if(_0x10abea[0x0][_0x1d7a36(0x14a)]=='Spanish')var _0x3afb47=users[_0x1d7a36(0x13c)];else{if(_0x10abea[0x0]['language']=='French')var _0x3afb47=users[_0x1d7a36(0x193)];else{if(_0x10abea[0x0][_0x1d7a36(0x14a)]==_0x1d7a36(0x1b8))var _0x3afb47=users[_0x1d7a36(0x1b0)];else{if(_0x10abea[0x0][_0x1d7a36(0x14a)]==_0x1d7a36(0xf1))var _0x3afb47=users[_0x1d7a36(0xf1)];else{if(_0x10abea[0x0][_0x1d7a36(0x14a)]=='Arabic\x20(ae)')var _0x3afb47=users[_0x1d7a36(0x1b9)];}}}}}}}const _0x217b6d=getRandom8DigitNumber();_0x217b6d[_0x1d7a36(0x8f)](_0x3c676d=>{var _0x231601=_0x1d7a36;_0x5112ed[_0x231601(0x16d)](_0x231601(0x10c),{'success':_0x1e00e4[_0x231601(0x130)]('success'),'errors':_0x1e00e4[_0x231601(0x130)](_0x231601(0x18c)),'role':_0x349cc2,'profile':_0xc1d98e,'suppliers':_0x468334,'warehouse':_0x57e114,'product':_0x118cac,'invoice':_0x3c676d,'master_shop':_0x10abea,'language':_0x3afb47,'find_data':_0x28b2c2,'rooms_data':_0x436dc3});})[_0x1d7a36(0xe4)](_0x549a35=>{var _0xacf7cc=_0x1d7a36;_0x1e00e4['flash'](_0xacf7cc(0x18c),_0xacf7cc(0xa7)),_0x5112ed[_0xacf7cc(0x1ae)]('/all_purchases_finished/view');});}catch(_0xe9e517){console['log'](_0xe9e517);}}),router['get'](a0_0x504cd5(0x16e),auth,async(_0x329f50,_0x579b84)=>{var _0x2ad689=a0_0x504cd5;try{const _0xec7c1e=_0x329f50['params']['id'];console[_0x2ad689(0xdd)](_0xec7c1e);const _0x1831cf=await master_shop[_0x2ad689(0xc7)]();console[_0x2ad689(0xdd)](_0x2ad689(0x15e),_0x1831cf);const _0xe38323=await product[_0x2ad689(0xb1)]({'name':_0xec7c1e});console[_0x2ad689(0xdd)](_0x2ad689(0x154),_0xe38323),_0x579b84[_0x2ad689(0xfd)](0xc8)[_0x2ad689(0x106)]({'product_data':_0xe38323,'master':_0x1831cf});}catch(_0x2c2184){console['log']('add_purchases\x20error',_0x2c2184);}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0xa5),auth,async(_0x396919,_0x2f9374)=>{var _0x2ff5d4=a0_0x504cd5;try{const {invoice:_0x5a68a4,date:_0x1c098c,warehouse_name:_0x3168a,prod_name:_0x23afd8,note:_0x4353d5,due_amount:_0x27df05,Room_name:_0x153331,PO_number:_0x208f22,SCRN:_0x280463,ReqBy:_0x547947,dateofreq:_0x4560a4,suppliers:_0x215873,typeservicesData:_0x4e0d0c,van:_0x14660b,typevehicle:_0x3eed11,driver:_0x5b788c,plate:_0xf9869,DRSI:_0x38e914,TSU:_0x11dd22,TFU:_0x52a4ea,JO_number:_0x44d5c3,type_of_products:_0x50f34a}=_0x396919['body'];if(typeof _0x23afd8==_0x2ff5d4(0x108))var _0x2322a3=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xec)]],_0x4424f3=[_0x396919[_0x2ff5d4(0x1af)]['prod_code']],_0x19a02e=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x11d)]],_0x22246e=[_0x396919[_0x2ff5d4(0x1af)]['prod_primunit']],_0xad9861=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x179)]],_0x5ae8d1=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xb9)]],_0x42f95e=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xc0)]],_0x5e2fad=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xc2)]],_0xe8ba74=[_0x396919['body'][_0x2ff5d4(0x16c)]],_0x259a15=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x153)]],_0x4d07e4=[_0x396919[_0x2ff5d4(0x1af)]['expiry_date']],_0x486cbf=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xee)]],_0x408098=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x14b)]],_0x741cee=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xff)]],_0x4768a1=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x182)]],_0x3dc989=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xaf)]],_0x4ac8cd=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x98)]],_0x130b4d=[_0x396919['body'][_0x2ff5d4(0x19e)]],_0x16156a=[_0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x118)]];else var _0x2322a3=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xec)]],_0x4424f3=[..._0x396919['body']['prod_code']],_0x19a02e=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x11d)]],_0x22246e=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x142)]],_0xad9861=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x179)]],_0x5ae8d1=[..._0x396919['body'][_0x2ff5d4(0xb9)]],_0x42f95e=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xc0)]],_0x5e2fad=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xc2)]],_0xe8ba74=[..._0x396919[_0x2ff5d4(0x1af)]['MaxStocks_data']],_0x259a15=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x153)]],_0x4d07e4=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x9e)]],_0x486cbf=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xee)]],_0x408098=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0x14b)]],_0x741cee=[..._0x396919[_0x2ff5d4(0x1af)]['prod_cat']],_0x4768a1=[..._0x396919['body'][_0x2ff5d4(0x182)]],_0x3dc989=[..._0x396919[_0x2ff5d4(0x1af)][_0x2ff5d4(0xaf)]],_0x4ac8cd=[..._0x396919[_0x2ff5d4(0x1af)]['uuid']],_0x130b4d=[..._0x396919['body']['sales_data_cateory']],_0x16156a=[..._0x396919[_0x2ff5d4(0x1af)]['product_id']];const _0x2de595=_0x2322a3['map'](_0x71cfaf=>{return _0x71cfaf={'product_name':_0x71cfaf};});_0x16156a[_0x2ff5d4(0xba)]((_0x12a947,_0x204e9c)=>{var _0xb21a7b=_0x2ff5d4;_0x2de595[_0x204e9c][_0xb21a7b(0x118)]=_0x12a947,_0x2de595[_0x204e9c][_0xb21a7b(0x92)]=_0x1c098c;}),_0x130b4d[_0x2ff5d4(0xba)]((_0xc7b4e2,_0x59c34d)=>{var _0x261c56=_0x2ff5d4;_0x2de595[_0x59c34d][_0x261c56(0x95)]=_0xc7b4e2;}),_0x4424f3[_0x2ff5d4(0xba)]((_0xbf426,_0x41d077)=>{var _0x5a2273=_0x2ff5d4;_0x2de595[_0x41d077][_0x5a2273(0xf6)]=_0xbf426;}),_0x4ac8cd[_0x2ff5d4(0xba)]((_0x5b2ca8,_0x12042e)=>{var _0x4c3324=_0x2ff5d4;_0x2de595[_0x12042e][_0x4c3324(0x98)]=_0x5b2ca8;}),_0x19a02e[_0x2ff5d4(0xba)]((_0x161097,_0x322056)=>{var _0x5b9156=_0x2ff5d4;_0x2de595[_0x322056][_0x5b9156(0x96)]=Math[_0x5b9156(0xfe)](_0x161097);}),_0x22246e[_0x2ff5d4(0xba)]((_0x3d8245,_0x353725)=>{var _0x115d71=_0x2ff5d4;_0x2de595[_0x353725][_0x115d71(0x165)]=_0x3d8245;}),_0xad9861[_0x2ff5d4(0xba)]((_0x3817a7,_0x39e337)=>{var _0x26d716=_0x2ff5d4;_0x2de595[_0x39e337][_0x26d716(0x125)]=_0x3817a7;}),_0x42f95e[_0x2ff5d4(0xba)]((_0x369827,_0x3a4a50)=>{var _0x40cd10=_0x2ff5d4;_0x2de595[_0x3a4a50][_0x40cd10(0xc0)]=_0x369827;}),_0x5e2fad[_0x2ff5d4(0xba)]((_0x2e7399,_0x5d087a)=>{var _0x32380b=_0x2ff5d4;_0x2de595[_0x5d087a][_0x32380b(0xc2)]=_0x2e7399;}),_0xe8ba74[_0x2ff5d4(0xba)]((_0x339b8f,_0x5c824c)=>{var _0x4c057d=_0x2ff5d4;_0x2de595[_0x5c824c][_0x4c057d(0x18a)]=_0x339b8f;}),_0x259a15[_0x2ff5d4(0xba)]((_0x5a5583,_0x2fcb3d)=>{var _0x555c7e=_0x2ff5d4;_0x2de595[_0x2fcb3d][_0x555c7e(0x153)]=_0x5a5583;}),_0x4d07e4[_0x2ff5d4(0xba)]((_0x52afe2,_0x127c8e)=>{_0x2de595[_0x127c8e]['expiry_date']=_0x52afe2;}),_0x486cbf[_0x2ff5d4(0xba)]((_0x5fbd71,_0x3347f7)=>{var _0x343804=_0x2ff5d4;_0x2de595[_0x3347f7][_0x343804(0xc8)]=_0x5fbd71;}),_0x408098[_0x2ff5d4(0xba)]((_0x1feedf,_0x5eaaed)=>{_0x2de595[_0x5eaaed]['maxperunit']=_0x1feedf;}),_0x741cee['forEach']((_0x43ae11,_0x4d3392)=>{_0x2de595[_0x4d3392]['product_cat']=_0x43ae11;}),_0x4768a1['forEach']((_0x3584e8,_0x61ad8a)=>{var _0x4cdfa4=_0x2ff5d4;_0x2de595[_0x61ad8a][_0x4cdfa4(0x1cc)]=_0x3584e8;}),_0x3dc989[_0x2ff5d4(0xba)]((_0x31e4b7,_0x3073a6)=>{var _0x557d01=_0x2ff5d4;_0x2de595[_0x3073a6][_0x557d01(0xaf)]=_0x31e4b7;});const _0x5d9a1d=new invoice_for_incoming();await _0x5d9a1d[_0x2ff5d4(0x19b)]();for(let _0x1bb41f=0x0;_0x1bb41f<=_0x4768a1[_0x2ff5d4(0xe3)]-0x1;_0x1bb41f++){_0x2de595[_0x1bb41f][_0x2ff5d4(0x1c4)]=_0x2ff5d4(0x146)+_0x5d9a1d[_0x2ff5d4(0x1aa)][_0x2ff5d4(0x1c9)]()['padStart'](0x8,'0');}const _0x1f2d35=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x3168a}}]);let _0x16a07a=[];for(let _0x1faba9=0x0;_0x1faba9<=_0x2de595[_0x2ff5d4(0xe3)]-0x1;_0x1faba9++){const _0x32d6f2=_0x2de595[_0x1faba9];for(let _0x364efd=0x0;_0x364efd<=_0x1f2d35[_0x2ff5d4(0xe3)]-0x1;_0x364efd++){const _0x2c3815=_0x1f2d35[_0x364efd];for(let _0x3d1803=0x0;_0x3d1803<=_0x2c3815['product_data'][_0x2ff5d4(0xe3)]-0x1;_0x3d1803++){const _0x338a7b=_0x2c3815[_0x2ff5d4(0x167)][_0x3d1803];if(_0x338a7b[_0x2ff5d4(0xf6)]===_0x32d6f2[_0x2ff5d4(0xf6)]){let _0x4113d8=_0x32d6f2[_0x2ff5d4(0x96)];const _0x1a0fc0=await warehouse[_0x2ff5d4(0x9b)]([{'$match':{'name':_0x3168a,'room':_0x2c3815[_0x2ff5d4(0xe5)]}},{'$unwind':'$product_details'},{'$match':{'level':_0x338a7b['bay'],'bay':_0x338a7b[_0x2ff5d4(0x111)]}}]);if(_0x1a0fc0[_0x2ff5d4(0xe3)]==0x0){for(let _0xc0fc0a=0x0;_0xc0fc0a<=_0x2c3815[_0x2ff5d4(0x167)][_0x2ff5d4(0xe3)]-0x1&&_0x4113d8>0x0;_0xc0fc0a++){const _0x1b6048=_0x2c3815[_0x2ff5d4(0x167)][_0xc0fc0a];if(_0x32d6f2['product_code']===_0x1b6048['product_code']){_0x16a07a[_0xc0fc0a]={};const _0x15bafd=parseInt(_0x1b6048['max']),_0x387a6e=0x0;let _0x2fd57d=_0x15bafd-_0x387a6e,_0x33f1eb=Math[_0x2ff5d4(0x178)](_0x4113d8,_0x2fd57d);console['log'](_0x2ff5d4(0x139)+_0x33f1eb+'\x20units\x20to\x20warehouse:\x20'+_0x2c3815[_0x2ff5d4(0x16f)]+_0x2ff5d4(0x140)+_0x2c3815[_0x2ff5d4(0xe5)]+_0x2ff5d4(0xdf)+_0x1b6048[_0x2ff5d4(0xfb)]+_0x2ff5d4(0x176)+_0x1b6048[_0x2ff5d4(0x111)]),_0x16a07a[_0xc0fc0a]['product_name']=_0x32d6f2[_0x2ff5d4(0x11f)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0xf6)]=_0x32d6f2[_0x2ff5d4(0xf6)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x118)]=_0x32d6f2[_0x2ff5d4(0x118)],_0x16a07a[_0xc0fc0a]['date_recieved']=_0x32d6f2[_0x2ff5d4(0x92)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x95)]=_0x32d6f2[_0x2ff5d4(0x95)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x98)]=_0x32d6f2['uuid'],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x96)]=_0x33f1eb,_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x165)]=_0x32d6f2[_0x2ff5d4(0x165)],_0x16a07a[_0xc0fc0a]['secondary_unit']=_0x32d6f2[_0x2ff5d4(0x125)],_0x16a07a[_0xc0fc0a]['primary_code']=_0x32d6f2[_0x2ff5d4(0xc0)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0xc2)]=_0x32d6f2[_0x2ff5d4(0xc2)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x18a)]=_0x32d6f2[_0x2ff5d4(0x18a)],_0x16a07a[_0xc0fc0a]['batch_code']=_0x32d6f2[_0x2ff5d4(0x153)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x9e)]=_0x32d6f2[_0x2ff5d4(0x9e)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0xc8)]=_0x32d6f2[_0x2ff5d4(0xc8)],_0x16a07a[_0xc0fc0a]['maxperunit']=_0x32d6f2[_0x2ff5d4(0x12e)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0xc5)]=_0x32d6f2[_0x2ff5d4(0xc5)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x1c4)]=_0x32d6f2[_0x2ff5d4(0x1c4)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0xaf)]=_0x32d6f2[_0x2ff5d4(0xaf)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x1cc)]=_0x2c3815[_0x2ff5d4(0xe5)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0x164)]=_0x1b6048[_0x2ff5d4(0xfb)],_0x16a07a[_0xc0fc0a][_0x2ff5d4(0xfb)]=_0x1b6048[_0x2ff5d4(0x111)],_0x4113d8-=_0x33f1eb;if(_0x4113d8<=0x0)break;}}if(_0x4113d8<=0x0)break;_0x4113d8>0x0&&console[_0x2ff5d4(0xdd)](_0x2ff5d4(0x1ab)+_0x4113d8+_0x2ff5d4(0x144));}}}}}const _0x5d6217=_0x16a07a[_0x2ff5d4(0xb2)]((_0x461f35,_0x65f0d9)=>{if(_0x65f0d9>0x0)return{'item':_0x461f35};}),_0x2dd0cb=_0x5d6217[_0x2ff5d4(0xb2)](_0x3eaabb=>_0x3eaabb[_0x2ff5d4(0x96)]!=='0'&&_0x3eaabb['quantity']!==''),_0x4d21b8=new purchases_finished({'invoice':_0x2ff5d4(0x146)+_0x5d9a1d[_0x2ff5d4(0x1aa)][_0x2ff5d4(0x1c9)]()[_0x2ff5d4(0xed)](0x8,'0'),'suppliers':_0x215873,'date':_0x1c098c,'warehouse_name':_0x3168a,'product':_0x2dd0cb,'note':_0x4353d5,'due_amount':_0x27df05,'room':_0x153331,'POnumber':_0x208f22,'SCRN':_0x280463,'JO_number':_0x44d5c3,'ReqBy':_0x547947,'dateofreq':_0x4560a4,'typeservicesData':_0x4e0d0c,'van':_0x14660b,'typevehicle':_0x3eed11,'driver':_0x5b788c,'plate':_0xf9869,'DRSI':_0x38e914,'TSU':_0x11dd22,'TFU':_0x52a4ea,'typeOfProducts':_0x50f34a}),_0x124d1e=await _0x4d21b8[_0x2ff5d4(0x19b)](),_0x5aeb26=await purchases_finished[_0x2ff5d4(0xb1)]({'_id':_0x124d1e[_0x2ff5d4(0x10a)][_0x2ff5d4(0x13d)]()});_0x396919[_0x2ff5d4(0x130)](_0x2ff5d4(0x1a9),_0x2ff5d4(0x1be)),_0x2f9374[_0x2ff5d4(0x1ae)](_0x2ff5d4(0x1ba)+_0x5aeb26[_0x2ff5d4(0x10a)][_0x2ff5d4(0x13d)]());}catch(_0x42c6c8){console[_0x2ff5d4(0xdd)](_0x42c6c8);}}),router[a0_0x504cd5(0x90)](a0_0x504cd5(0x129),auth,async(_0x1dc6ea,_0x4ec53c)=>{var _0x2bcaaf=a0_0x504cd5;try{const {username:_0x4484bd,email:_0x57c9f0,role:_0x4e8efd}=_0x1dc6ea[_0x2bcaaf(0x1a0)],_0x5a196a=_0x1dc6ea[_0x2bcaaf(0x1a0)],_0x5c8239=_0x1dc6ea[_0x2bcaaf(0xb7)]['id'],_0x1e1218=await profile[_0x2bcaaf(0xb1)]({'email':_0x5a196a[_0x2bcaaf(0xf5)]}),_0x50a9b1=await master_shop[_0x2bcaaf(0xc7)](),_0x3395f8=await staff[_0x2bcaaf(0xb1)]({'email':_0x5a196a['email']}),_0x29411c=await suppliers[_0x2bcaaf(0xc7)]({});let _0x37aed3;if(_0x5a196a['role']==_0x2bcaaf(0xe6)){const _0x144860=await staff[_0x2bcaaf(0xb1)]({'email':_0x5a196a['email']});_0x37aed3=await warehouse[_0x2bcaaf(0x9b)]([{'$match':{'status':_0x2bcaaf(0x134),'name':_0x144860[_0x2bcaaf(0xbc)]}},{'$group':{'_id':_0x2bcaaf(0x13b),'name':{'$first':_0x2bcaaf(0x13b)}}}]);}else _0x37aed3=await warehouse[_0x2bcaaf(0x9b)]([{'$match':{'status':_0x2bcaaf(0x134)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x2eab7b=await purchases_finished[_0x2bcaaf(0xaa)](_0x5c8239);if(_0x50a9b1[0x0][_0x2bcaaf(0x14a)]==_0x2bcaaf(0x169))var _0x29a82c=users[_0x2bcaaf(0xcd)];else{if(_0x50a9b1[0x0][_0x2bcaaf(0x14a)]==_0x2bcaaf(0x17c))var _0x29a82c=users[_0x2bcaaf(0x17c)];else{if(_0x50a9b1[0x0][_0x2bcaaf(0x14a)]==_0x2bcaaf(0x104))var _0x29a82c=users['German'];else{if(_0x50a9b1[0x0]['language']==_0x2bcaaf(0x13c))var _0x29a82c=users[_0x2bcaaf(0x13c)];else{if(_0x50a9b1[0x0][_0x2bcaaf(0x14a)]==_0x2bcaaf(0x193))var _0x29a82c=users['French'];else{if(_0x50a9b1[0x0][_0x2bcaaf(0x14a)]=='Portuguese\x20(BR)')var _0x29a82c=users[_0x2bcaaf(0x1b0)];else{if(_0x50a9b1[0x0]['language']==_0x2bcaaf(0xf1))var _0x29a82c=users['Chinese'];else{if(_0x50a9b1[0x0]['language']==_0x2bcaaf(0x102))var _0x29a82c=users['Arabic'];}}}}}}}_0x4ec53c[_0x2bcaaf(0x16d)]('purchases_process',{'success':_0x1dc6ea[_0x2bcaaf(0x130)](_0x2bcaaf(0x1a9)),'errors':_0x1dc6ea[_0x2bcaaf(0x130)](_0x2bcaaf(0x18c)),'role':_0x5a196a,'profile':_0x1e1218,'suppliers':_0x29411c,'warehouse':_0x37aed3,'master_shop':_0x50a9b1,'language':_0x29a82c,'purchases_data':_0x2eab7b});}catch(_0x34878f){console[_0x2bcaaf(0xdd)](_0x34878f);}});function a0_0x47a0(_0x8db99d,_0x816196){var _0x443dc4=a0_0x443d();return a0_0x47a0=function(_0x47a0b7,_0x576221){_0x47a0b7=_0x47a0b7-0x8e;var _0x5130f6=_0x443dc4[_0x47a0b7];return _0x5130f6;},a0_0x47a0(_0x8db99d,_0x816196);}async function get_warehouse_data(_0x967e4d,_0xc651ff){var _0x13c218=a0_0x504cd5;try{const _0x3ec7f5=await warehouse_temporary[_0x13c218(0xb1)]({'name':_0x967e4d,'room':_0xc651ff});if(!_0x3ec7f5){const _0x24b03e=new warehouse_temporary({'name':_0x967e4d,'address':_0x967e4d,'status':'Enabled','room':_0xc651ff,'isStaging':_0x13c218(0xcc)});return await _0x24b03e[_0x13c218(0x19b)](),_0x24b03e;}else return _0x3ec7f5;}catch(_0x3ac029){console['error'](_0x13c218(0xe0),_0x3ac029);throw _0x3ac029;}}router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x129),auth,async(_0x582f55,_0x55d9a8)=>{var _0x4dcaf6=a0_0x504cd5;try{const _0x403d62=_0x582f55[_0x4dcaf6(0xb7)]['id'],_0x308690=await purchases_finished[_0x4dcaf6(0xaa)](_0x403d62);let _0xa2560e=[];_0x308690[_0x4dcaf6(0x154)][_0x4dcaf6(0xba)]((_0x5625b1,_0x22dbda)=>{var _0x5459d8=_0x4dcaf6;_0xa2560e[_0x22dbda]={},_0xa2560e[_0x22dbda]['warehouse']=_0x308690[_0x5459d8(0x16f)],_0xa2560e[_0x22dbda][_0x5459d8(0x118)]=_0x5625b1['product_id'],_0xa2560e[_0x22dbda][_0x5459d8(0x11f)]=_0x5625b1[_0x5459d8(0x11f)],_0xa2560e[_0x22dbda][_0x5459d8(0xf6)]=_0x5625b1['product_code'],_0xa2560e[_0x22dbda]['quantity']=_0x5625b1[_0x5459d8(0x96)],_0xa2560e[_0x22dbda][_0x5459d8(0x165)]=_0x5625b1[_0x5459d8(0x165)],_0xa2560e[_0x22dbda][_0x5459d8(0x125)]=_0x5625b1[_0x5459d8(0x125)],_0xa2560e[_0x22dbda][_0x5459d8(0x164)]=_0x5625b1[_0x5459d8(0x164)],_0xa2560e[_0x22dbda][_0x5459d8(0xfb)]=_0x5625b1[_0x5459d8(0xfb)],_0xa2560e[_0x22dbda][_0x5459d8(0xc0)]=_0x5625b1[_0x5459d8(0xc0)],_0xa2560e[_0x22dbda][_0x5459d8(0xc2)]=_0x5625b1[_0x5459d8(0xc2)],_0xa2560e[_0x22dbda][_0x5459d8(0x18a)]=_0x5625b1[_0x5459d8(0x18a)],_0xa2560e[_0x22dbda][_0x5459d8(0x153)]=_0x5625b1[_0x5459d8(0x153)],_0xa2560e[_0x22dbda][_0x5459d8(0x9e)]=_0x5625b1[_0x5459d8(0x9e)],_0xa2560e[_0x22dbda]['production_date']=_0x5625b1[_0x5459d8(0xc8)],_0xa2560e[_0x22dbda][_0x5459d8(0x12e)]=_0x5625b1[_0x5459d8(0x12e)],_0xa2560e[_0x22dbda][_0x5459d8(0xc5)]=_0x5625b1['product_cat'],_0xa2560e[_0x22dbda][_0x5459d8(0x1cc)]=_0x5625b1['room_name'],_0xa2560e[_0x22dbda][_0x5459d8(0x1c4)]=_0x5625b1[_0x5459d8(0x1c4)],_0xa2560e[_0x22dbda][_0x5459d8(0x98)]=_0x5625b1[_0x5459d8(0x98)],_0xa2560e[_0x22dbda]['gross_price']=_0x5625b1[_0x5459d8(0xaf)],_0xa2560e[_0x22dbda][_0x5459d8(0x95)]=_0x5625b1[_0x5459d8(0x95)],_0xa2560e[_0x22dbda][_0x5459d8(0x92)]=_0x5625b1[_0x5459d8(0x92)],_0xa2560e[_0x22dbda][_0x5459d8(0x1b6)]=_0x5625b1[_0x5459d8(0x10a)][_0x5459d8(0x13d)]();});for(let _0x73daf=0x0;_0x73daf<=_0xa2560e[_0x4dcaf6(0xe3)]-0x1;_0x73daf++){const _0x4cb162=_0xa2560e[_0x73daf],_0x44cf30=new warehouse_temporary(_0x4cb162);await _0x44cf30[_0x4dcaf6(0x19b)]();}_0x308690[_0x4dcaf6(0x190)]=_0x4dcaf6(0x14c),await _0x308690['save'](),_0x582f55['flash'](_0x4dcaf6(0x1a9),_0x4dcaf6(0xb8)),_0x55d9a8[_0x4dcaf6(0x1ae)](_0x4dcaf6(0x1ba)+_0x308690[_0x4dcaf6(0x10a)][_0x4dcaf6(0x13d)]());}catch(_0x19e227){}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x147),auth,async(_0x37e5a0,_0x2f6228)=>{var _0x4427c6=a0_0x504cd5;try{const {invoice:_0x2bdea6,date:_0x550c75,warehouse_name:_0x2f4d86,prod_name:_0x25b165,note:_0x4ec56a,due_amount:_0x89dd47,Room_name:_0x368797,PO_number:_0x4737a5,SCRN:_0x5297ee,ReqBy:_0x482b75,dateofreq:_0x4f588f,suppliers:_0x2bfc3f,typeservicesData:_0x1b9833,van:_0x3e3c01,typevehicle:_0x2a3810,driver:_0x4fbd7a,plate:_0x501eb8,DRSI:_0x32a5b8,TSU:_0x5efdf3,TFU:_0x417242,JO_number:_0x4f316b,type_of_products:_0x52ab5a}=_0x37e5a0[_0x4427c6(0x1af)];if(typeof _0x25b165=='string')var _0x10c03d=[_0x37e5a0['body'][_0x4427c6(0xec)]],_0x10d342=[_0x37e5a0['body']['prod_code']],_0x6d31f6=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x11d)]],_0x3ffa3c=[_0x37e5a0['body'][_0x4427c6(0x142)]],_0x1dd121=[_0x37e5a0['body'][_0x4427c6(0x179)]],_0x449d47=[_0x37e5a0[_0x4427c6(0x1af)]['prod_level']],_0x47e5d3=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0xc0)]],_0x2ecc18=[_0x37e5a0[_0x4427c6(0x1af)]['secondary_code']],_0x38ca43=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x16c)]],_0x42bc73=[_0x37e5a0['body']['batch_code']],_0x27b043=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x9e)]],_0x2bc18a=[_0x37e5a0[_0x4427c6(0x1af)]['product_date']],_0xd1cc3c=[_0x37e5a0['body'][_0x4427c6(0x14b)]],_0x179c21=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0xff)]],_0x3072b7=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x182)]],_0x213cad=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0xaf)]],_0x19965d=[_0x37e5a0['body'][_0x4427c6(0x98)]],_0x19e119=[_0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x19e)]],_0x5fd59e=[_0x37e5a0[_0x4427c6(0x1af)]['type_of_products_type']];else var _0x10c03d=[..._0x37e5a0[_0x4427c6(0x1af)]['prod_name']],_0x10d342=[..._0x37e5a0['body'][_0x4427c6(0x174)]],_0x6d31f6=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x11d)]],_0x3ffa3c=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x142)]],_0x1dd121=[..._0x37e5a0[_0x4427c6(0x1af)]['prod_secondunit']],_0x449d47=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0xb9)]],_0x47e5d3=[..._0x37e5a0[_0x4427c6(0x1af)]['primary_code']],_0x2ecc18=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0xc2)]],_0x38ca43=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x16c)]],_0x42bc73=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x153)]],_0x27b043=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x9e)]],_0x2bc18a=[..._0x37e5a0[_0x4427c6(0x1af)]['product_date']],_0xd1cc3c=[..._0x37e5a0['body']['max_product_unit']],_0x179c21=[..._0x37e5a0['body'][_0x4427c6(0xff)]],_0x3072b7=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x182)]],_0x213cad=[..._0x37e5a0['body'][_0x4427c6(0xaf)]],_0x19965d=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x98)]],_0x19e119=[..._0x37e5a0['body'][_0x4427c6(0x19e)]],_0x5fd59e=[..._0x37e5a0[_0x4427c6(0x1af)][_0x4427c6(0x17b)]];const _0x5ef6c2=_0x10c03d[_0x4427c6(0xfc)](_0xa1bba1=>{return _0xa1bba1={'product_name':_0xa1bba1};});_0x5fd59e[_0x4427c6(0xba)]((_0x54cc4e,_0x381c05)=>{var _0x4829de=_0x4427c6;_0x5ef6c2[_0x381c05][_0x4829de(0x171)]=_0x54cc4e;}),_0x19e119[_0x4427c6(0xba)]((_0x321250,_0x369dae)=>{var _0x5dd986=_0x4427c6;_0x5ef6c2[_0x369dae][_0x5dd986(0x95)]=_0x321250;}),_0x10d342['forEach']((_0x2da8c3,_0xb6a8b3)=>{_0x5ef6c2[_0xb6a8b3]['product_code']=_0x2da8c3;}),_0x19965d['forEach']((_0x21c0ad,_0x57186e)=>{var _0x1f4156=_0x4427c6;_0x5ef6c2[_0x57186e][_0x1f4156(0x98)]=_0x21c0ad;}),_0x6d31f6[_0x4427c6(0xba)]((_0x332eb1,_0x4d30c1)=>{var _0x28e0da=_0x4427c6;_0x5ef6c2[_0x4d30c1][_0x28e0da(0x96)]=Math[_0x28e0da(0xfe)](_0x332eb1);}),_0x3ffa3c['forEach']((_0x33aaf5,_0x1e5e54)=>{_0x5ef6c2[_0x1e5e54]['standard_unit']=_0x33aaf5;}),_0x1dd121[_0x4427c6(0xba)]((_0x370cb3,_0x1859ed)=>{var _0x24b664=_0x4427c6;_0x5ef6c2[_0x1859ed][_0x24b664(0x125)]=_0x370cb3;}),_0x449d47[_0x4427c6(0xba)]((_0x2a3acc,_0x330038)=>{var _0x30c8ba=_0x4427c6,_0x59073c=_0x2a3acc[_0x30c8ba(0x187)](/[A-Za-z]+/)[0x0],_0x409187=parseInt(_0x2a3acc['match'](/\d+/)[0x0]);_0x5ef6c2[_0x330038]['level']=_0x59073c,_0x5ef6c2[_0x330038]['bay']=_0x409187;}),_0x47e5d3[_0x4427c6(0xba)]((_0x548afd,_0x207aea)=>{var _0x5b69ef=_0x4427c6;_0x5ef6c2[_0x207aea][_0x5b69ef(0xc0)]=_0x548afd;}),_0x2ecc18['forEach']((_0xac7757,_0x326c51)=>{_0x5ef6c2[_0x326c51]['secondary_code']=_0xac7757;}),_0x38ca43[_0x4427c6(0xba)]((_0x4de8ea,_0x407766)=>{_0x5ef6c2[_0x407766]['maxStocks']=_0x4de8ea;}),_0x42bc73[_0x4427c6(0xba)]((_0x2c4ea6,_0x3f76dd)=>{var _0x269737=_0x4427c6;_0x5ef6c2[_0x3f76dd][_0x269737(0x153)]=_0x2c4ea6;}),_0x27b043[_0x4427c6(0xba)]((_0x90c0d,_0x2d9337)=>{var _0x31a7d6=_0x4427c6;_0x5ef6c2[_0x2d9337][_0x31a7d6(0x9e)]=_0x90c0d;}),_0x2bc18a[_0x4427c6(0xba)]((_0x5b4d24,_0x51c3cb)=>{var _0x239904=_0x4427c6;_0x5ef6c2[_0x51c3cb][_0x239904(0xc8)]=_0x5b4d24;}),_0xd1cc3c[_0x4427c6(0xba)]((_0x52c776,_0x5c54ba)=>{var _0x520e4f=_0x4427c6;_0x5ef6c2[_0x5c54ba][_0x520e4f(0x12e)]=_0x52c776;}),_0x179c21[_0x4427c6(0xba)]((_0x2ddf3f,_0x5e8eca)=>{var _0x373b0d=_0x4427c6;_0x5ef6c2[_0x5e8eca][_0x373b0d(0xc5)]=_0x2ddf3f;}),_0x3072b7[_0x4427c6(0xba)]((_0xfc72e9,_0xd1e78)=>{var _0x492e86=_0x4427c6;_0x5ef6c2[_0xd1e78][_0x492e86(0x1cc)]=_0xfc72e9;}),_0x213cad[_0x4427c6(0xba)]((_0x257554,_0x14e89a)=>{_0x5ef6c2[_0x14e89a]['gross_price']=_0x257554;});const _0x51de2e=new purchases_logs();await _0x51de2e['save']();for(let _0x38fff2=0x0;_0x38fff2<=_0x3072b7[_0x4427c6(0xe3)]-0x1;_0x38fff2++){_0x5ef6c2[_0x38fff2][_0x4427c6(0x1c4)]=_0x4427c6(0x1a7)+_0x51de2e[_0x4427c6(0x1aa)][_0x4427c6(0x1c9)]()[_0x4427c6(0xed)](0x8,'0');}const _0x5de1c9=_0x5ef6c2[_0x4427c6(0xb2)](_0x112b71=>_0x112b71['quantity']!=='0'&&_0x112b71[_0x4427c6(0x96)]!==''),_0x36bf73=new purchases_finished({'invoice':_0x4427c6(0x1a7)+_0x51de2e[_0x4427c6(0x1aa)]['toString']()[_0x4427c6(0xed)](0x8,'0'),'suppliers':_0x2bfc3f,'date':_0x550c75,'warehouse_name':_0x2f4d86,'product':_0x5de1c9,'note':_0x4ec56a,'due_amount':_0x89dd47,'room':_0x368797,'POnumber':_0x4737a5,'SCRN':_0x5297ee,'JO_number':_0x4f316b,'ReqBy':_0x482b75,'dateofreq':_0x4f588f,'typeservicesData':_0x1b9833,'van':_0x3e3c01,'typevehicle':_0x2a3810,'driver':_0x4fbd7a,'plate':_0x501eb8,'DRSI':_0x32a5b8,'TSU':_0x5efdf3,'TFU':_0x417242,'typeOfProducts':_0x52ab5a}),_0x3ee004=await _0x36bf73[_0x4427c6(0x19b)](),_0x12ca4b=await purchases_finished[_0x4427c6(0xb1)]({'_id':_0x3ee004[_0x4427c6(0x10a)]['valueOf']()}),_0x30e2e9=_0x12ca4b['product'][_0x4427c6(0xfc)](async _0x4d4012=>{var _0x5c1a1d=_0x4427c6;try{var _0x5e690c=await warehouse[_0x5c1a1d(0xb1)]({'name':_0x2f4d86,'room':_0x4d4012[_0x5c1a1d(0x1cc)]}),_0x193d99=0x0;const _0x80d33=_0x5e690c[_0x5c1a1d(0xae)][_0x5c1a1d(0xfc)](_0x229a4f=>{var _0x25c5c4=_0x5c1a1d;console[_0x25c5c4(0xdd)](_0x229a4f['product_name']+'=='+_0x4d4012[_0x25c5c4(0x11f)]+'&&'+_0x229a4f[_0x25c5c4(0xfb)]+'=='+_0x4d4012[_0x25c5c4(0xfb)]+'&&'+_0x229a4f[_0x25c5c4(0x9e)]+'=='+_0x4d4012['expiry_date']+'&&'+_0x229a4f[_0x25c5c4(0xc8)]+'=='+_0x4d4012['production_date']+'&&'+_0x229a4f['batch_code']+'=='+_0x4d4012[_0x25c5c4(0x153)]+'&&'+_0x229a4f[_0x25c5c4(0x1c4)]+'=='+_0x12ca4b['invoice']),_0x229a4f['product_name']==_0x4d4012['product_name']&&_0x229a4f[_0x25c5c4(0xfb)]==_0x4d4012[_0x25c5c4(0xfb)]&&_0x229a4f[_0x25c5c4(0x164)]==_0x4d4012['level']&&_0x229a4f[_0x25c5c4(0x9e)]==_0x4d4012[_0x25c5c4(0x9e)]&&_0x229a4f[_0x25c5c4(0xc8)]==_0x4d4012[_0x25c5c4(0xc8)]&&_0x229a4f[_0x25c5c4(0x153)]==_0x4d4012['batch_code']&&_0x229a4f[_0x25c5c4(0x1c4)]==_0x12ca4b[_0x25c5c4(0x1c4)]&&(_0x229a4f['product_stock']=Math['abs'](_0x229a4f[_0x25c5c4(0x1d0)])+Math[_0x25c5c4(0xfe)](_0x4d4012['quantity']),_0x193d99++);});return _0x193d99==0x0&&(_0x5e690c[_0x5c1a1d(0xae)]=_0x5e690c[_0x5c1a1d(0xae)][_0x5c1a1d(0x1cf)]({'product_name':_0x4d4012[_0x5c1a1d(0x11f)],'product_stock':Math['abs'](_0x4d4012['quantity']),'primary_code':_0x4d4012[_0x5c1a1d(0xc0)],'secondary_code':_0x4d4012[_0x5c1a1d(0xc2)],'product_code':_0x4d4012[_0x5c1a1d(0xf6)],'bay':_0x4d4012[_0x5c1a1d(0xfb)],'level':_0x4d4012[_0x5c1a1d(0x164)],'maxProducts':_0x4d4012[_0x5c1a1d(0x18a)],'unit':_0x4d4012[_0x5c1a1d(0x165)],'secondary_unit':_0x4d4012[_0x5c1a1d(0x125)],'expiry_date':_0x4d4012[_0x5c1a1d(0x9e)],'production_date':_0x4d4012[_0x5c1a1d(0xc8)],'maxProducts':_0x4d4012[_0x5c1a1d(0x18a)],'maxPerUnit':_0x4d4012[_0x5c1a1d(0x12e)],'batch_code':_0x4d4012['batch_code'],'product_cat':_0x4d4012[_0x5c1a1d(0xc5)],'invoice':_0x4d4012[_0x5c1a1d(0x1c4)],'id_incoming':_0x4d4012[_0x5c1a1d(0x10a)],'uuid':_0x4d4012['uuid'],'gross_price':_0x4d4012[_0x5c1a1d(0xaf)],'sales_category':_0x4d4012[_0x5c1a1d(0x95)],'type_products':_0x4d4012[_0x5c1a1d(0x171)]})),_0x5e690c;}catch(_0x43cdf6){return console[_0x5c1a1d(0x162)](_0x5c1a1d(0x19c),_0x43cdf6),null;}});Promise['all'](_0x30e2e9)[_0x4427c6(0x8f)](async _0x308fee=>{var _0x2ad769=_0x4427c6;try{for(const _0x41b1ee of _0x308fee){await warehouse['updateOne']({'_id':_0x41b1ee[_0x2ad769(0x10a)]},{'$addToSet':{'product_details':{'$each':_0x41b1ee['product_details']}}});}const _0x2eae70=await master_shop['find'](),_0x47ebc8=await email_settings[_0x2ad769(0xb1)](),_0x55779b=await supervisor_settings[_0x2ad769(0xc7)]();var _0xb59fb3=_0x12ca4b[_0x2ad769(0x154)],_0x1bc4cb='',_0x2fdf47;for(_0x2fdf47 in _0xb59fb3){var _0x32a8fa='FG';_0x12ca4b[_0x2ad769(0x16f)]==_0x2ad769(0xa3)&&(_0x32a8fa='DG'),_0x1bc4cb+=_0x2ad769(0x12b)+_0x2ad769(0x14e)+_0xb59fb3[_0x2fdf47][_0x2ad769(0x11f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb59fb3[_0x2fdf47][_0x2ad769(0xf6)]+_0x2ad769(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb59fb3[_0x2fdf47][_0x2ad769(0x96)]+'</td>'+_0x2ad769(0x14e)+_0xb59fb3[_0x2fdf47]['standard_unit']+'</td>'+_0x2ad769(0x14e)+_0xb59fb3[_0x2fdf47][_0x2ad769(0x125)]+_0x2ad769(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12ca4b[_0x2ad769(0x16f)]+_0x2ad769(0x170)+_0x2ad769(0x14e)+_0xb59fb3[_0x2fdf47]['room_name']+_0x2ad769(0x170)+_0x2ad769(0x14e)+_0x32a8fa+_0xb59fb3[_0x2fdf47][_0x2ad769(0xfb)]+_0x2ad769(0x170),_0x2ad769(0x1c1);}let _0xff74b6=nodemailer['createTransport']({'host':_0x47ebc8[_0x2ad769(0x114)],'port':Number(_0x47ebc8['port']),'secure':![],'auth':{'user':_0x47ebc8[_0x2ad769(0xf5)],'pass':_0x47ebc8[_0x2ad769(0xd4)]}}),_0x18a7c2={'from':_0x47ebc8[_0x2ad769(0xf5)],'to':_0x55779b[0x0]['FGSEmail'],'subject':_0x2ad769(0x131),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x2ad769(0x13f)+_0x2eae70[0x0][_0x2ad769(0x1ad)],'cid':_0x2ad769(0xb0)}],'html':'<!DOCTYPE\x20html>'+_0x2ad769(0x14d)+_0x2ad769(0x1c7)+_0x2ad769(0x1c2)+_0x2ad769(0x15d)+_0x2ad769(0x1c2)+_0x2ad769(0x127)+_0x2ad769(0xdc)+_0x2ad769(0x1c2)+_0x2ad769(0x132)+_0x2eae70[0x0]['site_title']+_0x2ad769(0x143)+_0x2ad769(0xdc)+_0x2ad769(0xdc)+_0x2ad769(0x10b)+_0x2ad769(0x1c2)+_0x2ad769(0x16b)+_0x2ad769(0x1ce)+_0x12ca4b['invoice']+'\x20'+_0x2ad769(0x1d2)+'\x20Order\x20Date\x20:\x20'+_0x12ca4b[_0x2ad769(0xd7)]+'\x20'+_0x2ad769(0x19a)+'</h5>'+'</div>'+_0x2ad769(0x9f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2ad769(0x12b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2ad769(0x17a)+_0x2ad769(0x19d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x2ad769(0xce)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x2ad769(0xb5)+_0x2ad769(0x11b)+_0x2ad769(0x1c1)+_0x2ad769(0x1a6)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1bc4cb+'\x20'+_0x2ad769(0x137)+_0x2ad769(0xe9)+'<div>'+_0x2ad769(0x1b3)+_0x2ad769(0xd3)+_0x2eae70[0x0]['site_title']+_0x2ad769(0xf4)+'</div>'+_0x2ad769(0xdc)+_0x2ad769(0x149)};_0xff74b6['sendMail'](_0x18a7c2,function(_0xbe0c45,_0x1fdf04){var _0x33f9a2=_0x2ad769;_0xbe0c45?(console[_0x33f9a2(0xdd)](_0xbe0c45),console[_0x33f9a2(0xdd)](_0x33f9a2(0x128))):console[_0x33f9a2(0xdd)](_0x33f9a2(0xbe));});}catch(_0x4c6b3d){console[_0x2ad769(0x162)](_0x4c6b3d),_0x2f6228[_0x2ad769(0xfd)](0x1f4)[_0x2ad769(0x106)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x4c6b3d[_0x2ad769(0x196)]});}})[_0x4427c6(0xe4)](_0x216fc1=>{var _0x254730=_0x4427c6;console[_0x254730(0x162)](_0x216fc1);}),_0x37e5a0[_0x4427c6(0x130)]('success','purchase\x20data\x20add\x20successfully'),_0x2f6228['redirect'](_0x4427c6(0xa9)+_0x12ca4b[_0x4427c6(0x10a)][_0x4427c6(0x13d)]());}catch(_0xbfa2d0){console[_0x4427c6(0xdd)](_0xbfa2d0);}}),router[a0_0x504cd5(0x90)](a0_0x504cd5(0x189),auth,async(_0x281ae8,_0xa32977)=>{var _0x1255c1=a0_0x504cd5;try{const {username:_0x5d9060,email:_0x47d233,role:_0xa6b4fb}=_0x281ae8[_0x1255c1(0x1a0)],_0x2179dd=_0x281ae8['user'],_0x2a162d=await profile[_0x1255c1(0xb1)]({'email':_0x2179dd[_0x1255c1(0xf5)]}),_0x4e765c=await master_shop[_0x1255c1(0xc7)](),_0x176451=_0x281ae8[_0x1255c1(0xb7)]['id'],_0x419396=await purchases_finished[_0x1255c1(0xaa)](_0x176451),_0x5d55d0=await suppliers[_0x1255c1(0xc7)]({});let _0x2605e1;if(_0x2179dd['role']==_0x1255c1(0xe6)){const _0x470ce9=await staff['findOne']({'email':_0x2179dd['email']});_0x2605e1=await warehouse[_0x1255c1(0xc7)]({'status':_0x1255c1(0x134),'name':_0x470ce9[_0x1255c1(0xbc)],'warehouse_category':_0x1255c1(0x145)});}else _0x2605e1=await warehouse[_0x1255c1(0x9b)]([{'$match':{'status':_0x1255c1(0x134),'warehouse_category':_0x1255c1(0x145)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x4239e8=await product[_0x1255c1(0xc7)]({}),_0xa78e29=BayBinSelected(_0x419396[_0x1255c1(0x16f)],_0x419396['room']);let _0xa462e0=new Date(_0x419396[_0x1255c1(0x9e)]),_0x569cf2=('0'+_0xa462e0[_0x1255c1(0xa4)]())['slice'](-0x2),_0x5c16d8=('0'+(_0xa462e0['getMonth']()+0x1))['slice'](-0x2),_0x530896=_0xa462e0[_0x1255c1(0x160)](),_0x5a6ab7=_0x530896+'-'+_0x5c16d8+'-'+_0x569cf2;if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x169)){var _0x2e4464=users[_0x1255c1(0xcd)];console[_0x1255c1(0xdd)](_0x2e4464);}else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x17c))var _0x2e4464=users[_0x1255c1(0x17c)];else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x104))var _0x2e4464=users['German'];else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x13c))var _0x2e4464=users[_0x1255c1(0x13c)];else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x193))var _0x2e4464=users[_0x1255c1(0x193)];else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x1b8))var _0x2e4464=users[_0x1255c1(0x1b0)];else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0xf1))var _0x2e4464=users[_0x1255c1(0xf1)];else{if(_0x4e765c[0x0][_0x1255c1(0x14a)]==_0x1255c1(0x102))var _0x2e4464=users['Arabic'];}}}}}}}_0xa32977['render'](_0x1255c1(0x15f),{'success':_0x281ae8[_0x1255c1(0x130)]('success'),'errors':_0x281ae8[_0x1255c1(0x130)](_0x1255c1(0x18c)),'role':_0x2179dd,'profile':_0x2a162d,'purchases':_0x419396,'suppliers':_0x5d55d0,'warehouse':_0x2605e1,'product':_0x4239e8,'master_shop':_0x4e765c,'language':_0x2e4464,'ed_fullDate':_0x5a6ab7,'dataSelected':_0xa78e29});}catch(_0x4bf0ee){console['log'](_0x4bf0ee);}}),router[a0_0x504cd5(0x90)](a0_0x504cd5(0xd8),auth,async(_0x5ef66b,_0x22cd29)=>{var _0xe4b8f7=a0_0x504cd5;try{const {username:_0x63463a,email:_0x5f04c8,role:_0x4af7bb}=_0x5ef66b['user'],_0x5c2913=_0x5ef66b[_0xe4b8f7(0x1a0)],_0x2dc4=await profile['findOne']({'email':_0x5c2913['email']}),_0x2eb637=await master_shop[_0xe4b8f7(0xc7)](),_0x5131cc=_0x5ef66b[_0xe4b8f7(0xb7)]['id'],_0x2e231c=await purchases_finished['findById'](_0x5131cc),_0x5e341b=await suppliers['find']({});let _0x225e09;if(_0x5c2913[_0xe4b8f7(0x113)]=='staff'){const _0x1e751e=await staff[_0xe4b8f7(0xb1)]({'email':_0x5c2913[_0xe4b8f7(0xf5)]});_0x225e09=await warehouse[_0xe4b8f7(0xc7)]({'status':_0xe4b8f7(0x134),'name':_0x1e751e[_0xe4b8f7(0xbc)],'warehouse_category':_0xe4b8f7(0x145)});}else _0x225e09=await warehouse['aggregate']([{'$match':{'status':_0xe4b8f7(0x134),'warehouse_category':_0xe4b8f7(0x145)}},{'$group':{'_id':_0xe4b8f7(0x13b),'name':{'$first':'$name'}}}]);const _0xa44319=await product[_0xe4b8f7(0xc7)]({}),_0x49b60e=BayBinSelected(_0x2e231c[_0xe4b8f7(0x16f)],_0x2e231c[_0xe4b8f7(0xe5)]);let _0x272e93=new Date(_0x2e231c['expiry_date']),_0x4f7c6e=('0'+_0x272e93[_0xe4b8f7(0xa4)]())[_0xe4b8f7(0x1b4)](-0x2),_0x5f361f=('0'+(_0x272e93[_0xe4b8f7(0x124)]()+0x1))[_0xe4b8f7(0x1b4)](-0x2),_0xb688cb=_0x272e93[_0xe4b8f7(0x160)](),_0x14c9ce=_0xb688cb+'-'+_0x5f361f+'-'+_0x4f7c6e;if(_0x2eb637[0x0]['language']==_0xe4b8f7(0x169)){var _0x12242e=users[_0xe4b8f7(0xcd)];console[_0xe4b8f7(0xdd)](_0x12242e);}else{if(_0x2eb637[0x0][_0xe4b8f7(0x14a)]==_0xe4b8f7(0x17c))var _0x12242e=users[_0xe4b8f7(0x17c)];else{if(_0x2eb637[0x0][_0xe4b8f7(0x14a)]=='German')var _0x12242e=users[_0xe4b8f7(0x104)];else{if(_0x2eb637[0x0][_0xe4b8f7(0x14a)]==_0xe4b8f7(0x13c))var _0x12242e=users['Spanish'];else{if(_0x2eb637[0x0][_0xe4b8f7(0x14a)]=='French')var _0x12242e=users[_0xe4b8f7(0x193)];else{if(_0x2eb637[0x0][_0xe4b8f7(0x14a)]=='Portuguese\x20(BR)')var _0x12242e=users[_0xe4b8f7(0x1b0)];else{if(_0x2eb637[0x0]['language']=='Chinese')var _0x12242e=users[_0xe4b8f7(0xf1)];else{if(_0x2eb637[0x0]['language']==_0xe4b8f7(0x102))var _0x12242e=users['Arabic'];}}}}}}}_0x22cd29[_0xe4b8f7(0x16d)]('edit_purchases_finished',{'success':_0x5ef66b['flash'](_0xe4b8f7(0x1a9)),'errors':_0x5ef66b['flash'](_0xe4b8f7(0x18c)),'role':_0x5c2913,'profile':_0x2dc4,'purchases':_0x2e231c,'suppliers':_0x5e341b,'warehouse':_0x225e09,'product':_0xa44319,'master_shop':_0x2eb637,'language':_0x12242e,'ed_fullDate':_0x14c9ce,'dataSelected':_0x49b60e});}catch(_0x19e1c0){console['log'](_0x19e1c0);}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0xd8),auth,async(_0x508f4f,_0x3cf496)=>{var _0x4c31fd=a0_0x504cd5;try{const _0x4bbb0a=_0x508f4f['params']['id'],_0x5e5ad1=await purchases_finished[_0x4c31fd(0xb1)]({'_id':_0x508f4f['params']['id']}),_0x2df89f=await warehouse['findOne']({'name':_0x5e5ad1[_0x4c31fd(0x16f)],'room':_0x5e5ad1[_0x4c31fd(0xe5)]});_0x5e5ad1[_0x4c31fd(0x154)][_0x4c31fd(0xba)](_0x526b83=>{var _0x4744bb=_0x4c31fd;const _0x3b7d75=_0x2df89f[_0x4744bb(0xae)]['map'](_0x40f707=>{var _0x5aa18d=_0x4744bb;_0x40f707['product_name']==_0x526b83[_0x5aa18d(0x11f)]&&_0x40f707[_0x5aa18d(0xfb)]==_0x526b83['bay']&&(_0x40f707[_0x5aa18d(0x1d0)]=parseInt(_0x40f707[_0x5aa18d(0x1d0)])-parseInt(_0x526b83[_0x5aa18d(0x96)]));});}),await _0x2df89f['save']();const {invoice:_0x547e1e,suppliers:_0x1889f5,date:_0xb18c0b,warehouse_name:_0x332c90,prod_name:_0x1fd35e,prod_code:_0x15d052,prod_qty:_0x371bd2,prod_unit:_0x2eee8c,prod_secondunit:_0x2b5c18,prod_level:_0x2759bb,prod_isle:_0x29f057,prod_pallet:_0x53d8f8,note:_0x17dfe3,expiry_date:_0x1b12c5,batch_code:_0x48c367,paid_amount:_0x5a8839,due_amount:_0x2553bd,Room_name:_0x3ed71e,primary_code:_0x34499f,secondary_code:_0xc4aea3,PO_number:_0x2d143a,JO_number:_0x17c2e4}=_0x508f4f['body'];if(typeof _0x1fd35e==_0x4c31fd(0x108))var _0x5e18ea=[_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0xec)]],_0x5ea32c=[_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x174)]],_0x15a0cb=[_0x508f4f['body']['prod_qty']],_0x51fa24=[_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0xad)]],_0x20b1c6=[_0x508f4f[_0x4c31fd(0x1af)]['prod_secondunit']],_0x5e52e0=[_0x508f4f[_0x4c31fd(0x1af)]['prod_level']],_0x5ef397=[_0x508f4f['body'][_0x4c31fd(0xc0)]],_0x2d85dd=[_0x508f4f['body'][_0x4c31fd(0xc2)]],_0x3899e7=[_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x16c)]],_0x177c45=[_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x153)]],_0x277b3f=[_0x508f4f['body']['expiry_date']];else var _0x5e18ea=[..._0x508f4f[_0x4c31fd(0x1af)]['prod_name']],_0x5ea32c=[..._0x508f4f['body'][_0x4c31fd(0x174)]],_0x15a0cb=[..._0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x1ac)]],_0x51fa24=[..._0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0xad)]],_0x20b1c6=[..._0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x179)]],_0x5e52e0=[..._0x508f4f[_0x4c31fd(0x1af)]['prod_level']],_0x5ef397=[..._0x508f4f['body'][_0x4c31fd(0xc0)]],_0x2d85dd=[..._0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0xc2)]],_0x3899e7=[..._0x508f4f['body'][_0x4c31fd(0x16c)]],_0x177c45=[..._0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x153)]],_0x277b3f=[..._0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x9e)]];const _0x11125a=_0x5e18ea[_0x4c31fd(0xfc)](_0x3fdf7b=>{return _0x3fdf7b={'product_name':_0x3fdf7b};});_0x5ea32c[_0x4c31fd(0xba)]((_0x6c677e,_0x20b93d)=>{var _0x3a686b=_0x4c31fd;_0x11125a[_0x20b93d][_0x3a686b(0xf6)]=_0x6c677e;}),_0x15a0cb['forEach']((_0x5dc868,_0x143bc0)=>{var _0x59a594=_0x4c31fd;_0x11125a[_0x143bc0][_0x59a594(0x96)]=_0x5dc868;}),_0x51fa24['forEach']((_0x514f31,_0xbd0444)=>{_0x11125a[_0xbd0444]['standard_unit']=_0x514f31;}),_0x20b1c6[_0x4c31fd(0xba)]((_0x493f36,_0x270825)=>{_0x11125a[_0x270825]['secondary_unit']=_0x493f36;}),_0x5e52e0[_0x4c31fd(0xba)]((_0x3044d3,_0x2e2d38)=>{var _0x56ba38=_0x4c31fd;_0x11125a[_0x2e2d38][_0x56ba38(0xfb)]=_0x3044d3;}),_0x5ef397[_0x4c31fd(0xba)]((_0x133266,_0x4f3692)=>{var _0x2a0f96=_0x4c31fd;_0x11125a[_0x4f3692][_0x2a0f96(0xc0)]=_0x133266;}),_0x2d85dd[_0x4c31fd(0xba)]((_0xf5d937,_0x2e8b9a)=>{_0x11125a[_0x2e8b9a]['secondary_code']=_0xf5d937;}),_0x3899e7[_0x4c31fd(0xba)]((_0x512913,_0x3bbc51)=>{var _0x2941dc=_0x4c31fd;_0x11125a[_0x3bbc51][_0x2941dc(0x18a)]=_0x512913;}),_0x177c45[_0x4c31fd(0xba)]((_0x5c2d6b,_0x40d30b)=>{_0x11125a[_0x40d30b]['batch_code']=_0x5c2d6b;}),_0x277b3f[_0x4c31fd(0xba)]((_0x4514d7,_0xb54f64)=>{_0x11125a[_0xb54f64]['expiry_date']=_0x4514d7;});const _0x1fe950=_0x11125a[_0x4c31fd(0xb2)](_0x231686=>_0x231686['quantity']!=='0'&&_0x231686[_0x4c31fd(0x96)]!=='');_0x5e5ad1['invoice']=_0x547e1e,_0x5e5ad1[_0x4c31fd(0xd2)]=_0x1889f5,_0x5e5ad1[_0x4c31fd(0xd7)]=_0xb18c0b,_0x5e5ad1['warehouse_name']=_0x332c90,_0x5e5ad1['product']=_0x1fe950,_0x5e5ad1[_0x4c31fd(0x188)]=_0x17dfe3,_0x5e5ad1[_0x4c31fd(0xb3)]=_0x5a8839,_0x5e5ad1[_0x4c31fd(0x1c5)]=_0x2553bd,_0x5e5ad1['room']=_0x3ed71e,_0x5e5ad1['POnumber']=_0x2d143a,_0x5e5ad1[_0x4c31fd(0x100)]=_0x17c2e4;const _0x5ee80c=await _0x5e5ad1[_0x4c31fd(0x19b)](),_0x2880b2=await warehouse[_0x4c31fd(0xb1)]({'name':_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x16f)],'room':_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x119)]});_0x5e5ad1[_0x4c31fd(0x154)][_0x4c31fd(0xba)](_0x122937=>{var _0x28d55c=_0x4c31fd,_0x79b7af=0x0;const _0x108229=_0x2880b2[_0x28d55c(0xae)]['map'](_0x14ce6e=>{var _0x150c67=_0x28d55c;_0x14ce6e[_0x150c67(0x11f)]==_0x122937[_0x150c67(0x11f)]&&_0x14ce6e['bay']==_0x122937[_0x150c67(0xfb)]&&(_0x14ce6e[_0x150c67(0x1d0)]=parseInt(_0x14ce6e[_0x150c67(0x1d0)])+parseInt(_0x122937[_0x150c67(0x96)]),_0x79b7af++);});_0x79b7af=='0'&&(_0x2880b2['product_details']=_0x2880b2[_0x28d55c(0xae)]['concat']({'product_name':_0x122937[_0x28d55c(0x11f)],'product_stock':_0x122937[_0x28d55c(0x96)],'primary_code':_0x122937[_0x28d55c(0xc0)],'secondary_code':_0x122937[_0x28d55c(0xc2)],'product_code':_0x122937[_0x28d55c(0xf6)],'bay':_0x122937[_0x28d55c(0xfb)],'maxProducts':_0x122937['maxStocks'],'unit':_0x122937['standard_unit'],'secondary_unit':_0x122937[_0x28d55c(0x125)],'expiry_date':_0x122937['expiry_date']}));}),await _0x2880b2['save']();const _0x553663=await s_payment_data[_0x4c31fd(0xb1)]({'invoice':_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x1c4)]});if(_0x553663===null){}else console['log']('suppliers',_0x553663,_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0x1c4)]),_0x553663[_0x4c31fd(0xd2)]=_0x508f4f[_0x4c31fd(0x1af)][_0x4c31fd(0xd2)],await _0x553663['save']();_0x508f4f['flash']('success',_0x4c31fd(0x93)),_0x3cf496[_0x4c31fd(0x1ae)]('/all_purchases_finished/view');}catch(_0xe96083){console[_0x4c31fd(0xdd)](_0xe96083);}}),router[a0_0x504cd5(0x1ca)]('/give_payment/:id',auth,async(_0x1a7c92,_0x54e43b)=>{var _0x4efece=a0_0x504cd5;try{const _0x1fb4f4=_0x1a7c92['params']['id'],{invoice:_0x42d4e6,suppliers:_0x5c170d,payable:_0x259fec,due_amount:_0xfb0602}=_0x1a7c92[_0x4efece(0x1af)],_0x23c6b9=await purchases[_0x4efece(0xaa)](_0x1fb4f4);var _0x3ff0d1=_0x259fec-_0xfb0602;_0x23c6b9[_0x4efece(0xb3)]=parseFloat(_0x23c6b9[_0x4efece(0xb3)])+parseFloat(_0xfb0602),_0x23c6b9[_0x4efece(0x1c5)]=_0x3ff0d1;const _0x4e6a23=await _0x23c6b9[_0x4efece(0x19b)]();console[_0x4efece(0xdd)](_0x4e6a23);const _0x4478ce=await s_payment_data[_0x4efece(0xb1)]({'invoice':_0x42d4e6});_0x4478ce['amount']=_0x3ff0d1,await _0x4478ce[_0x4efece(0x19b)]();let _0x1efbc2=new Date(),_0x1e1450=('0'+_0x1efbc2[_0x4efece(0xa4)]())[_0x4efece(0x1b4)](-0x2),_0x35fc83=('0'+(_0x1efbc2['getMonth']()+0x1))[_0x4efece(0x1b4)](-0x2),_0x4a949b=_0x1efbc2[_0x4efece(0x160)](),_0x55c947=_0x4a949b+'-'+_0x35fc83+'-'+_0x1e1450;const _0x414700=new suppliers_payment({'invoice':_0x42d4e6,'date':_0x4a949b+'-'+_0x35fc83+'-'+_0x1e1450,'suppliers':_0x5c170d,'reason':_0x4efece(0x155),'amount':_0xfb0602}),_0x58d516=await _0x414700[_0x4efece(0x19b)]();_0x1a7c92[_0x4efece(0x130)](_0x4efece(0x1a9),_0x4efece(0x18d)),_0x54e43b['redirect'](_0x4efece(0xd1));}catch(_0x405960){console['log'](_0x405960);}}),router['get'](a0_0x504cd5(0x121),auth,async(_0x182163,_0x5abf2a)=>{var _0x154ccf=a0_0x504cd5;try{const {username:_0x412bab,email:_0x17ee37,role:_0xea7ef}=_0x182163[_0x154ccf(0x1a0)],_0x7468bd=_0x182163[_0x154ccf(0x1a0)],_0x2c0a06=await profile[_0x154ccf(0xb1)]({'email':_0x7468bd['email']}),_0xa8ad96=await master_shop[_0x154ccf(0xc7)]();console[_0x154ccf(0xdd)](_0x154ccf(0x15e),_0xa8ad96);const _0x269c0b=_0x182163['params']['id'],_0x158b2e=await purchases[_0x154ccf(0xaa)](_0x269c0b);console[_0x154ccf(0xdd)](_0x158b2e);const _0x422ab5=await suppliers[_0x154ccf(0xb1)]({'name':_0x158b2e[_0x154ccf(0xd2)]});console['log'](_0x422ab5);if(_0xa8ad96[0x0]['language']==_0x154ccf(0x169)){var _0x35637d=users[_0x154ccf(0xcd)];console['log'](_0x35637d);}else{if(_0xa8ad96[0x0][_0x154ccf(0x14a)]==_0x154ccf(0x17c))var _0x35637d=users[_0x154ccf(0x17c)];else{if(_0xa8ad96[0x0][_0x154ccf(0x14a)]==_0x154ccf(0x104))var _0x35637d=users[_0x154ccf(0x104)];else{if(_0xa8ad96[0x0][_0x154ccf(0x14a)]==_0x154ccf(0x13c))var _0x35637d=users[_0x154ccf(0x13c)];else{if(_0xa8ad96[0x0][_0x154ccf(0x14a)]==_0x154ccf(0x193))var _0x35637d=users[_0x154ccf(0x193)];else{if(_0xa8ad96[0x0][_0x154ccf(0x14a)]==_0x154ccf(0x1b8))var _0x35637d=users['Portuguese'];else{if(_0xa8ad96[0x0][_0x154ccf(0x14a)]==_0x154ccf(0xf1))var _0x35637d=users['Chinese'];else{if(_0xa8ad96[0x0]['language']=='Arabic\x20(ae)')var _0x35637d=users[_0x154ccf(0x1b9)];}}}}}}}_0x5abf2a[_0x154ccf(0x16d)](_0x154ccf(0x105),{'success':_0x182163[_0x154ccf(0x130)](_0x154ccf(0x1a9)),'errors':_0x182163[_0x154ccf(0x130)]('errors'),'role':_0x7468bd,'profile':_0x2c0a06,'master_shop':_0xa8ad96,'supplier':_0x422ab5,'purchase':_0x158b2e,'language':_0x35637d});}catch(_0x29a233){console[_0x154ccf(0xdd)](_0x29a233);}}),router[a0_0x504cd5(0x90)]('/view/return_purchase/:id',auth,async(_0xb539f6,_0x1a191a)=>{var _0x439951=a0_0x504cd5;try{const {username:_0x3e673d,email:_0xc749ec,role:_0x60e332}=_0xb539f6['user'],_0x261d1a=_0xb539f6[_0x439951(0x1a0)],_0x4b5ef8=await profile[_0x439951(0xb1)]({'email':_0x261d1a[_0x439951(0xf5)]}),_0x1039f3=await master_shop['find']();console[_0x439951(0xdd)]('master',_0x1039f3);const _0x39a85d=_0xb539f6[_0x439951(0xb7)]['id'];console[_0x439951(0xdd)](_0x39a85d);const _0x2fb42c=await purchases_finished[_0x439951(0xaa)](_0x39a85d);console[_0x439951(0xdd)](_0x439951(0xb4),_0x2fb42c);const _0xd4180=await product[_0x439951(0xc7)]({}),_0x1ec804=await warehouse[_0x439951(0x9b)]([{'$match':{'name':_0x2fb42c[_0x439951(0x16f)],'room':_0x2fb42c[_0x439951(0xe5)]}},{'$unwind':_0x439951(0x101)},{'$group':{'_id':_0x439951(0x17e),'name':{'$first':_0x439951(0x1bb)},'product_stock':{'$first':_0x439951(0xfa)},'bay':{'$first':_0x439951(0xe2)},'bin':{'$first':_0x439951(0x186)},'type':{'$first':_0x439951(0xea)},'floorlevel':{'$first':_0x439951(0x12f)},'primary_code':{'$first':_0x439951(0x1d1)},'secondary_code':{'$first':_0x439951(0x156)},'product_code':{'$first':_0x439951(0x136)},'storage':{'$first':_0x439951(0x133)},'rack':{'$first':_0x439951(0x192)}}}]);console['log'](_0x439951(0x1c6),_0x1ec804);let _0x4a9d1e;if(_0x261d1a[_0x439951(0x113)]==_0x439951(0xe6)){const _0x5a4599=await staff[_0x439951(0xb1)]({'email':_0x261d1a[_0x439951(0xf5)]});_0x4a9d1e=await warehouse[_0x439951(0xc7)]({'status':_0x439951(0x134),'name':_0x5a4599['warehouse'],'warehouse_category':_0x439951(0x145),'name':_0x439951(0x166)});}else _0x4a9d1e=await warehouse[_0x439951(0x9b)]([{'$match':{'status':_0x439951(0x134),'warehouse_category':_0x439951(0x145),'name':_0x439951(0x166)}},{'$group':{'_id':'$name','name':{'$first':_0x439951(0x13b)}}}]);if(_0x1039f3[0x0][_0x439951(0x14a)]=='English\x20(US)'){var _0x429679=users['English'];console[_0x439951(0xdd)](_0x429679);}else{if(_0x1039f3[0x0]['language']==_0x439951(0x17c))var _0x429679=users[_0x439951(0x17c)];else{if(_0x1039f3[0x0][_0x439951(0x14a)]==_0x439951(0x104))var _0x429679=users['German'];else{if(_0x1039f3[0x0]['language']==_0x439951(0x13c))var _0x429679=users[_0x439951(0x13c)];else{if(_0x1039f3[0x0][_0x439951(0x14a)]==_0x439951(0x193))var _0x429679=users[_0x439951(0x193)];else{if(_0x1039f3[0x0][_0x439951(0x14a)]==_0x439951(0x1b8))var _0x429679=users['Portuguese'];else{if(_0x1039f3[0x0][_0x439951(0x14a)]=='Chinese')var _0x429679=users['Chinese'];else{if(_0x1039f3[0x0]['language']=='Arabic\x20(ae)')var _0x429679=users[_0x439951(0x1b9)];}}}}}}}_0x1a191a[_0x439951(0x16d)](_0x439951(0x12a),{'success':_0xb539f6[_0x439951(0x130)](_0x439951(0x1a9)),'errors':_0xb539f6[_0x439951(0x130)](_0x439951(0x18c)),'role':_0x261d1a,'profile':_0x4b5ef8,'user':_0x2fb42c,'stock':_0x1ec804,'master_shop':_0x1039f3,'product':_0xd4180,'language':_0x429679,'warehouse':_0x4a9d1e});}catch(_0x47d0b2){console[_0x439951(0xdd)](_0x47d0b2);}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x191),auth,async(_0x74ae02,_0x44a9f9)=>{var _0x518d06=a0_0x504cd5;try{const {invoice:_0xfb4ec1,date:_0x19e445,warehouse_name:_0x4fe5dc,Room_name:_0x1e7da8,product_name:_0x503b26,purchase_quantity:_0xf1a1cd,stocks:_0x410a3c,return_qty:_0x19638c,note:_0x318343,level:_0x518391,isle:_0x53b5e1,pallet:_0x1e991c,to_warehouse_name:_0x17426a,to_Room_name:_0x1757a5}=_0x74ae02[_0x518d06(0x1af)],_0x1a71d9=await purchases_finished[_0x518d06(0xb1)]({'_id':_0x74ae02[_0x518d06(0xb7)]['id']}),_0x4ee18c=await warehouse[_0x518d06(0xb1)]({'name':_0x4fe5dc,'room':_0x1e7da8,'warehouse_category':'Finished\x20Goods'});if(typeof _0x503b26==_0x518d06(0x108))var _0x1a5b56=[_0x74ae02[_0x518d06(0x1af)]['product_name']],_0x2215c2=[_0x74ae02[_0x518d06(0x1af)]['purchase_quantity']],_0x57413e=[_0x74ae02[_0x518d06(0x1af)][_0x518d06(0xf3)]],_0x3432d5=[_0x74ae02['body'][_0x518d06(0x103)]],_0x6f6ae1=[_0x74ae02[_0x518d06(0x1af)]['level']],_0x47c21e=[_0x74ae02[_0x518d06(0x1af)][_0x518d06(0x10f)]],_0x327b5a=[_0x74ae02['body'][_0x518d06(0x13e)]],_0xbd6aea=[_0x74ae02[_0x518d06(0x1af)][_0x518d06(0x10d)]];else var _0x1a5b56=[..._0x74ae02['body'][_0x518d06(0x11f)]],_0x2215c2=[..._0x74ae02[_0x518d06(0x1af)][_0x518d06(0x1a2)]],_0x57413e=[..._0x74ae02[_0x518d06(0x1af)][_0x518d06(0xf3)]],_0x3432d5=[..._0x74ae02[_0x518d06(0x1af)][_0x518d06(0x103)]],_0x6f6ae1=[..._0x74ae02['body'][_0x518d06(0x164)]],_0x47c21e=[..._0x74ae02[_0x518d06(0x1af)][_0x518d06(0x10f)]],_0x327b5a=[..._0x74ae02[_0x518d06(0x1af)][_0x518d06(0x13e)]],_0xbd6aea=[..._0x74ae02[_0x518d06(0x1af)]['secondary_code_hide']];const _0x4d5387=_0x1a5b56['map'](_0x226b8d=>{return _0x226b8d={'product_name':_0x226b8d};});_0x2215c2[_0x518d06(0xba)]((_0x1f2cf6,_0x138d91)=>{var _0x2a2e46=_0x518d06;_0x4d5387[_0x138d91][_0x2a2e46(0x1a2)]=_0x1f2cf6;}),_0x57413e[_0x518d06(0xba)]((_0x6e8ca3,_0x1cbfe7)=>{_0x4d5387[_0x1cbfe7]['stock_quantity']=_0x6e8ca3;}),_0x3432d5['forEach']((_0x46bf12,_0x57ac93)=>{var _0x396f87=_0x518d06;_0x4d5387[_0x57ac93][_0x396f87(0x103)]=_0x46bf12;}),_0x6f6ae1[_0x518d06(0xba)]((_0x4be239,_0x4164ce)=>{_0x4d5387[_0x4164ce]['bay']=_0x4be239;}),_0x47c21e['forEach']((_0x4ab102,_0x592117)=>{_0x4d5387[_0x592117]['product_code']=_0x4ab102;}),_0x327b5a[_0x518d06(0xba)]((_0x10b3c5,_0x2343ba)=>{var _0x563aa3=_0x518d06;_0x4d5387[_0x2343ba][_0x563aa3(0xc0)]=_0x10b3c5;}),_0xbd6aea[_0x518d06(0xba)]((_0x193b7d,_0x4e203b)=>{_0x4d5387[_0x4e203b]['secondary_code']=_0x193b7d;}),_0x4d5387[_0x518d06(0xba)](_0x426c25=>{var _0x571dca=_0x518d06;console[_0x571dca(0xdd)](_0x426c25);const _0x5dfaa9=_0x4ee18c[_0x571dca(0xae)][_0x571dca(0xfc)](_0x2f20d9=>{var _0x127daf=_0x571dca;_0x2f20d9['product_name']==_0x426c25[_0x127daf(0x11f)]&&_0x2f20d9[_0x127daf(0xfb)]==_0x426c25['bay']&&(console[_0x127daf(0xdd)](parseInt(_0x2f20d9['product_stock'])+_0x127daf(0xd9)+parseInt(_0x426c25[_0x127daf(0x103)])),_0x2f20d9[_0x127daf(0x1d0)]=parseInt(_0x2f20d9[_0x127daf(0x1d0)])-parseInt(_0x426c25[_0x127daf(0x103)]));});}),await _0x4ee18c['save']();var _0x418fe6=0x0;_0x4d5387[_0x518d06(0xba)](_0xb1cbda=>{var _0x5d2891=_0x518d06;(parseInt(_0xb1cbda[_0x5d2891(0x1a2)])<parseInt(_0xb1cbda[_0x5d2891(0x103)])||parseInt(_0xb1cbda[_0x5d2891(0x99)])<parseInt(_0xb1cbda[_0x5d2891(0x103)]))&&_0x418fe6++;});if(_0x418fe6!=0x0)return _0x74ae02[_0x518d06(0x130)](_0x518d06(0x18c),_0x518d06(0x184)),_0x44a9f9['redirect'](_0x518d06(0xf9));const _0x13d213=new purchases_return_finished({'invoice':_0xfb4ec1,'suppliers':_0x74ae02[_0x518d06(0x1af)][_0x518d06(0xd2)],'date':_0x19e445,'warehouse_name':_0x4fe5dc,'return_product':_0x4d5387,'note':_0x318343,'room':_0x1e7da8,'to_warehouse_name':_0x17426a,'to_room':_0x1757a5}),_0x3052c6=await _0x13d213[_0x518d06(0x19b)](),_0x267568=await purchases_return_finished[_0x518d06(0xb1)]({'invoice':_0xfb4ec1}),_0x1efcdc=await warehouse[_0x518d06(0xb1)]({'name':_0x17426a,'room':_0x1757a5,'warehouse_category':_0x518d06(0x145)});_0x267568['return_product'][_0x518d06(0xba)](_0x29a220=>{var _0x4a7206=_0x518d06,_0x4bdef2=0x0;const _0x10a8bd=_0x1efcdc[_0x4a7206(0xae)][_0x4a7206(0xfc)](_0x29f6b2=>{var _0x4a45be=_0x4a7206;console['log'](_0x29f6b2[_0x4a45be(0x11f)]+'=='+_0x29a220['product_name']+'&&'+_0x29f6b2[_0x4a45be(0xfb)]+'=='+_0x29a220['bay']),_0x29f6b2['product_name']==_0x29a220['product_name']&&_0x29f6b2['bay']==_0x29a220[_0x4a45be(0xfb)]&&(_0x29f6b2[_0x4a45be(0x1d0)]=parseInt(_0x29f6b2[_0x4a45be(0x1d0)])-parseInt(_0x29a220['return_qty']),_0x4bdef2++);});_0x4bdef2=='0'&&(_0x1efcdc[_0x4a7206(0xae)]=_0x1efcdc[_0x4a7206(0xae)][_0x4a7206(0x1cf)]({'product_name':_0x29a220[_0x4a7206(0x11f)],'product_stock':_0x29a220[_0x4a7206(0x103)],'primary_code':_0x29a220[_0x4a7206(0xc0)],'secondary_code':_0x29a220[_0x4a7206(0xc2)],'product_code':_0x29a220[_0x4a7206(0xf6)],'bay':_0x29a220[_0x4a7206(0xfb)],'maxProducts':0xf423f}));}),await _0x1efcdc[_0x518d06(0x19b)]();const _0x2bd86e=await purchases_finished[_0x518d06(0xb1)]({'invoice':_0xfb4ec1});_0x2bd86e[_0x518d06(0x126)]=_0x518d06(0x1c3);const _0x18c9b3=await _0x2bd86e[_0x518d06(0x19b)](),_0x5db7f7=new s_payment_data({'invoice':_0xfb4ec1,'suppliers':_0x74ae02[_0x518d06(0x1af)][_0x518d06(0xd2)],'reason':_0x518d06(0x91)});await _0x5db7f7[_0x518d06(0x19b)]();const _0x3cb1a1=await master_shop[_0x518d06(0xc7)](),_0x9f2cd0=await email_settings[_0x518d06(0xb1)](),_0xe82856=await suppliers[_0x518d06(0xb1)]({'name':_0x74ae02[_0x518d06(0x1af)][_0x518d06(0xd2)]});_0x3cb1a1[0x0]['currency_placement']==0x1?(right_currency=_0x3cb1a1[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3cb1a1[0x0]['currency']);var _0x40eb88=_0x1a5b56,_0x335f9e=_0x3432d5,_0x58bd6f='',_0x2d2959;for(_0x2d2959 in _0x40eb88){_0x58bd6f+='<tr>'+_0x518d06(0x14e)+_0x40eb88[_0x2d2959]+_0x518d06(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x335f9e[_0x2d2959]+'</td>'+'</tr>';}let _0x2a33a6=nodemailer['createTransport']({'service':_0x518d06(0xa2),'auth':{'user':_0x9f2cd0[_0x518d06(0xf5)],'pass':_0x9f2cd0[_0x518d06(0xd4)]}}),_0x11d203={'from':_0x9f2cd0[_0x518d06(0xf5)],'to':_0xe82856['email'],'subject':_0x518d06(0xf7),'attachments':[{'filename':_0x518d06(0x120),'path':__dirname+_0x518d06(0xac)+_0x518d06(0x13f)+_0x3cb1a1[0x0][_0x518d06(0x1ad)],'cid':_0x518d06(0xb0)}],'html':'<!DOCTYPE\x20html>'+_0x518d06(0x14d)+_0x518d06(0x1c7)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x518d06(0x1c2)+_0x518d06(0x127)+'</div>'+_0x518d06(0x1c2)+_0x518d06(0x132)+_0x3cb1a1[0x0][_0x518d06(0x11e)]+_0x518d06(0x143)+_0x518d06(0xdc)+'</div>'+_0x518d06(0x10b)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0xfb4ec1+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x518d06(0x94)+_0x19e445+'\x20'+_0x518d06(0x19a)+_0x518d06(0xf4)+_0x518d06(0xdc)+_0x518d06(0x9f)+_0x518d06(0xbf)+_0x518d06(0x12b)+_0x518d06(0xe1)+_0x518d06(0xa0)+_0x518d06(0x1b7)+_0x518d06(0xc3)+'</tr>'+_0x518d06(0x1a6)+_0x518d06(0x19f)+'\x20'+_0x58bd6f+'\x20'+_0x518d06(0x137)+'</table>'+_0x518d06(0x1c2)+_0x518d06(0x1b3)+_0x518d06(0xd3)+_0x3cb1a1[0x0][_0x518d06(0x11e)]+'</h5>'+_0x518d06(0xdc)+_0x518d06(0xdc)+_0x518d06(0x149)};_0x2a33a6['sendMail'](_0x11d203,function(_0x59ed91,_0x2ecd4d){var _0x648de3=_0x518d06;_0x59ed91?console['log'](_0x648de3(0x128)):console[_0x648de3(0xdd)](_0x648de3(0xbe));}),_0x74ae02[_0x518d06(0x130)](_0x518d06(0x1a9),'purchases\x20item\x20return\x20successfull'),_0x44a9f9[_0x518d06(0x1ae)](_0x518d06(0x152));}catch(_0x44d0e4){_0x44a9f9[_0x518d06(0xfd)](0xc8)[_0x518d06(0x106)]({'message':_0x44d0e4[_0x518d06(0x196)]});}}),router[a0_0x504cd5(0x90)]('/barcode/:id',auth,async(_0x153a8a,_0x3bb245)=>{var _0x3c7ee4=a0_0x504cd5;try{const {username:_0x4e56a5,email:_0x1d00a3,role:_0x899cdc}=_0x153a8a['user'],_0x507ddf=_0x153a8a[_0x3c7ee4(0x1a0)],_0x588f6b=await profile[_0x3c7ee4(0xb1)]({'email':_0x507ddf[_0x3c7ee4(0xf5)]}),_0x55c1f3=await master_shop['find'](),_0x11d574=_0x153a8a[_0x3c7ee4(0xb7)]['id'],_0x2f90b6=await purchases_finished[_0x3c7ee4(0xaa)](_0x11d574);if(_0x55c1f3[0x0][_0x3c7ee4(0x14a)]=='English\x20(US)')var _0x5a6823=users['English'];else{if(_0x55c1f3[0x0][_0x3c7ee4(0x14a)]==_0x3c7ee4(0x17c))var _0x5a6823=users[_0x3c7ee4(0x17c)];else{if(_0x55c1f3[0x0]['language']==_0x3c7ee4(0x104))var _0x5a6823=users[_0x3c7ee4(0x104)];else{if(_0x55c1f3[0x0][_0x3c7ee4(0x14a)]=='Spanish')var _0x5a6823=users[_0x3c7ee4(0x13c)];else{if(_0x55c1f3[0x0][_0x3c7ee4(0x14a)]==_0x3c7ee4(0x193))var _0x5a6823=users[_0x3c7ee4(0x193)];else{if(_0x55c1f3[0x0][_0x3c7ee4(0x14a)]==_0x3c7ee4(0x1b8))var _0x5a6823=users[_0x3c7ee4(0x1b0)];else{if(_0x55c1f3[0x0]['language']==_0x3c7ee4(0xf1))var _0x5a6823=users[_0x3c7ee4(0xf1)];else{if(_0x55c1f3[0x0][_0x3c7ee4(0x14a)]==_0x3c7ee4(0x102))var _0x5a6823=users[_0x3c7ee4(0x1b9)];}}}}}}}_0x3bb245[_0x3c7ee4(0x16d)]('all_purchases_barcode',{'success':_0x153a8a['flash']('success'),'errors':_0x153a8a[_0x3c7ee4(0x130)](_0x3c7ee4(0x18c)),'role':_0x507ddf,'profile':_0x588f6b,'alldata':_0x2f90b6,'master_shop':_0x55c1f3,'language':_0x5a6823}),console['log'](alldata);}catch(_0x492df3){console['log'](_0x492df3);}}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x157),async(_0x33d76c,_0x24a061)=>{var _0xfdb4a=a0_0x504cd5;const {product_code:_0x103a94}=_0x33d76c['body'];var _0x18645a;const _0xfd2cb1=await product['aggregate']([{'$match':{'primary_code':_0x103a94}},{'$group':{'_id':_0xfdb4a(0xf2),'name':{'$first':_0xfdb4a(0x13b)},'category':{'$first':'$category'},'brand':{'$first':_0xfdb4a(0xcf)},'unit':{'$first':_0xfdb4a(0x1a5)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0xfdb4a(0x1bc)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0xfdb4a(0x159)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0xfdb4a(0x1b1)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0xfa8a83=await product[_0xfdb4a(0x9b)]([{'$match':{'secondary_code':_0x103a94}},{'$group':{'_id':_0xfdb4a(0xf2),'name':{'$first':'$name'},'category':{'$first':_0xfdb4a(0x1cd)},'brand':{'$first':_0xfdb4a(0xcf)},'unit':{'$first':_0xfdb4a(0x1a5)},'alertquantity':{'$first':_0xfdb4a(0x18f)},'product_code':{'$first':_0xfdb4a(0x1bc)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0xfdb4a(0xc1)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xfdb4a(0xf8)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0xfdb4a(0xbd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0xfd2cb1['length']>0x0)_0x18645a=_0xfd2cb1;else _0xfa8a83[_0xfdb4a(0xe3)]>0x0&&(_0x18645a=_0xfa8a83);_0x24a061['json'](_0x18645a);}),router[a0_0x504cd5(0x1ca)](a0_0x504cd5(0x15b),async(_0x21f4ee,_0x5aa8f0)=>{var _0x1051f3=a0_0x504cd5;const {productCode:_0x15604d,bay:_0x4832c3,warehouses:_0x45b6a7,room:_0xf4f779}=_0x21f4ee[_0x1051f3(0x1af)];console['log'](_0x21f4ee[_0x1051f3(0x1af)]);try{const _0x4df964=await warehouse[_0x1051f3(0x9b)]([{'$match':{'name':_0x45b6a7,'room':_0xf4f779}},{'$unwind':_0x1051f3(0x101)},{'$match':{'product_details.bay':parseInt(_0x4832c3)}},{'$group':{'_id':_0x1051f3(0x17e),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1051f3(0xfa)},'bay':{'$first':_0x1051f3(0xe2)},'maxProducts':{'$first':_0x1051f3(0x194)}}}]);_0x5aa8f0[_0x1051f3(0xfd)](0xc8)[_0x1051f3(0x106)](_0x4df964);}catch(_0x59e333){_0x5aa8f0[_0x1051f3(0xfd)](0x194)['json']({'message':_0x59e333[_0x1051f3(0x196)]});}}),router['post'](a0_0x504cd5(0x12c),async(_0x531a03,_0x1cd4f1)=>{var _0x549f6f=a0_0x504cd5;const {product_code:_0x191c02}=_0x531a03[_0x549f6f(0x1af)];var _0x243d32;const _0x95b39b=await product[_0x549f6f(0x9b)]([{'$match':{'primary_code':_0x191c02,'type_products':_0x549f6f(0xdd)}},{'$group':{'_id':_0x549f6f(0xf2),'name':{'$first':'$name'},'category':{'$first':_0x549f6f(0x1cd)},'brand':{'$first':_0x549f6f(0xcf)},'unit':{'$first':_0x549f6f(0x1a5)},'alertquantity':{'$first':_0x549f6f(0x18f)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x549f6f(0x159)},'maxStocks':{'$first':_0x549f6f(0x110)},'maxProdPerUnit':{'$first':_0x549f6f(0xc1)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x549f6f(0xf8)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x549f6f(0xbd)},'type_products':{'$first':_0x549f6f(0x158)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x549f6f(0xdd)](_0x95b39b);const _0x5130cf=await product['aggregate']([{'$match':{'secondary_code':_0x191c02,'type_products':_0x549f6f(0xdd)}},{'$group':{'_id':'$_id','name':{'$first':_0x549f6f(0x13b)},'category':{'$first':_0x549f6f(0x1cd)},'brand':{'$first':_0x549f6f(0xcf)},'unit':{'$first':_0x549f6f(0x1a5)},'alertquantity':{'$first':_0x549f6f(0x18f)},'product_code':{'$first':_0x549f6f(0x1bc)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x549f6f(0x159)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x549f6f(0xc1)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x549f6f(0xf8)},'gross_price':{'$first':_0x549f6f(0x1b1)},'sales_category':{'$first':_0x549f6f(0xbd)},'type_products':{'$first':_0x549f6f(0x158)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x95b39b[_0x549f6f(0xe3)]>0x0)_0x243d32=_0x95b39b;else _0x5130cf[_0x549f6f(0xe3)]>0x0&&(_0x243d32=_0x5130cf);_0x1cd4f1[_0x549f6f(0x106)](_0x243d32);}),module[a0_0x504cd5(0x181)]=router;