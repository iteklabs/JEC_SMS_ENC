var a0_0x2a53dd=a0_0x25c6;(function(_0x3d814e,_0x556d45){var _0x3c3d68=a0_0x25c6,_0x576ed7=_0x3d814e();while(!![]){try{var _0x38f648=parseInt(_0x3c3d68(0x1b8))/0x1*(parseInt(_0x3c3d68(0x18e))/0x2)+-parseInt(_0x3c3d68(0x1f3))/0x3*(-parseInt(_0x3c3d68(0x1b9))/0x4)+-parseInt(_0x3c3d68(0x1b5))/0x5*(-parseInt(_0x3c3d68(0x1ce))/0x6)+-parseInt(_0x3c3d68(0x1e7))/0x7*(-parseInt(_0x3c3d68(0x11f))/0x8)+-parseInt(_0x3c3d68(0x175))/0x9*(parseInt(_0x3c3d68(0x166))/0xa)+-parseInt(_0x3c3d68(0x1d3))/0xb+parseInt(_0x3c3d68(0x12b))/0xc*(-parseInt(_0x3c3d68(0x167))/0xd);if(_0x38f648===_0x556d45)break;else _0x576ed7['push'](_0x576ed7['shift']());}catch(_0x32f14c){_0x576ed7['push'](_0x576ed7['shift']());}}}(a0_0x1913,0x5a96e));const express=require(a0_0x2a53dd(0x1cc)),app=express(),router=express[a0_0x2a53dd(0x16b)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x2a53dd(0x121)),auth=require(a0_0x2a53dd(0xe5)),nodemailer=require(a0_0x2a53dd(0x19e));var ejs=require('ejs');const path=require(a0_0x2a53dd(0x17b)),users=require('../public/language/languages.json'),{isNull}=require(a0_0x2a53dd(0x21c));router[a0_0x2a53dd(0x219)]('/incoming',auth,async(_0x54bd3f,_0x2822fb)=>{var _0x392902=a0_0x2a53dd;try{const {username:_0x51bd57,email:_0x359b80,role:_0x2bf2ea}=_0x54bd3f[_0x392902(0x136)],_0x12153e=_0x54bd3f['user'],_0x348d92=await profile[_0x392902(0x103)]({'email':_0x12153e['email']}),_0x115cf3=await staff[_0x392902(0x103)]({'email':_0x12153e[_0x392902(0x1a2)]}),_0x48cae1=await master_shop['find']();let _0x405ede=await transfers_finished[_0x392902(0x185)]([{'$match':{'to_warehouse':_0x115cf3[_0x392902(0x1d1)]}}]);if(_0x48cae1[0x0]['language']==_0x392902(0x1d2))var _0x2013b8=users[_0x392902(0xf8)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x220))var _0x2013b8=users[_0x392902(0x220)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x1c9))var _0x2013b8=users[_0x392902(0x1c9)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x221))var _0x2013b8=users[_0x392902(0x221)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x102))var _0x2013b8=users[_0x392902(0x102)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x20e))var _0x2013b8=users[_0x392902(0xfa)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x21e))var _0x2013b8=users[_0x392902(0x21e)];else{if(_0x48cae1[0x0][_0x392902(0x190)]==_0x392902(0x228))var _0x2013b8=users[_0x392902(0x222)];}}}}}}}_0x2822fb[_0x392902(0x189)](_0x392902(0x216),{'success':_0x54bd3f[_0x392902(0x215)](_0x392902(0x14b)),'errors':_0x54bd3f[_0x392902(0x215)](_0x392902(0x132)),'purchases':_0x405ede,'role':_0x12153e,'profile':_0x348d92,'master_shop':_0x48cae1,'language':_0x2013b8,'staff_data':_0x115cf3});}catch(_0x5ec702){console[_0x392902(0x195)]('table\x20page',_0x5ec702),_0x2822fb[_0x392902(0x12e)](0xc8)[_0x392902(0x133)]({'message':_0x5ec702[_0x392902(0x1fd)]});}}),router[a0_0x2a53dd(0x219)](a0_0x2a53dd(0x153),auth,async(_0x56f63e,_0x4035e5)=>{var _0x5c5292=a0_0x2a53dd;try{const {username:_0x2511a1,email:_0x483b40,role:_0xfa066e}=_0x56f63e[_0x5c5292(0x136)],_0xdec38c=_0x56f63e[_0x5c5292(0x136)],_0x2d55e4=await profile[_0x5c5292(0x103)]({'email':_0xdec38c[_0x5c5292(0x1a2)]}),_0x493f85=await staff[_0x5c5292(0x103)]({'email':_0xdec38c['email']}),_0x4ce7c3=await master_shop[_0x5c5292(0x137)]();let _0x55cdb4=await transfers_finished[_0x5c5292(0x185)]([{'$match':{'to_warehouse':_0x493f85['warehouse'],'to_recieved':'false'}}]);if(_0x4ce7c3[0x0][_0x5c5292(0x190)]==_0x5c5292(0x1d2))var _0x20d713=users[_0x5c5292(0xf8)];else{if(_0x4ce7c3[0x0][_0x5c5292(0x190)]==_0x5c5292(0x220))var _0x20d713=users['Hindi'];else{if(_0x4ce7c3[0x0][_0x5c5292(0x190)]==_0x5c5292(0x1c9))var _0x20d713=users[_0x5c5292(0x1c9)];else{if(_0x4ce7c3[0x0]['language']=='Spanish')var _0x20d713=users[_0x5c5292(0x221)];else{if(_0x4ce7c3[0x0][_0x5c5292(0x190)]==_0x5c5292(0x102))var _0x20d713=users[_0x5c5292(0x102)];else{if(_0x4ce7c3[0x0]['language']==_0x5c5292(0x20e))var _0x20d713=users[_0x5c5292(0xfa)];else{if(_0x4ce7c3[0x0][_0x5c5292(0x190)]==_0x5c5292(0x21e))var _0x20d713=users[_0x5c5292(0x21e)];else{if(_0x4ce7c3[0x0][_0x5c5292(0x190)]=='Arabic\x20(ae)')var _0x20d713=users['Arabic'];}}}}}}}_0x4035e5['render']('incoming_add',{'success':_0x56f63e[_0x5c5292(0x215)]('success'),'errors':_0x56f63e['flash'](_0x5c5292(0x132)),'purchases':_0x55cdb4,'role':_0xdec38c,'profile':_0x2d55e4,'master_shop':_0x4ce7c3,'language':_0x20d713,'staff_data':_0x493f85});}catch(_0x440298){console[_0x5c5292(0x195)]('table\x20page',_0x440298),_0x4035e5[_0x5c5292(0x12e)](0xc8)['json']({'message':_0x440298['message']});}});const createLog=async _0xaeaa78=>{var _0x36a6ac=a0_0x2a53dd;const _0x288d80=new datalogs({'location':_0xaeaa78});return await _0x288d80[_0x36a6ac(0x1aa)](),_0x288d80[_0x36a6ac(0x192)];};function a0_0x25c6(_0x35ab79,_0x4290d6){var _0x1913ac=a0_0x1913();return a0_0x25c6=function(_0x25c63e,_0x16e395){_0x25c63e=_0x25c63e-0xe3;var _0x27ea6b=_0x1913ac[_0x25c63e];return _0x27ea6b;},a0_0x25c6(_0x35ab79,_0x4290d6);}router[a0_0x2a53dd(0x1ee)](a0_0x2a53dd(0x153),auth,async(_0x384b49,_0x2e45ad)=>{var _0x14597f=a0_0x2a53dd;try{const {invoice_trf_data:_0x3a3a6e,item_code:_0x17dcec,SCRN:_0x2e28c4,ReqBy:_0x452e03,type_of_products:_0x3dd82d,dateofreq:_0x54246d,PO_number:_0x47261b,date:_0xcfcde7,warehouse_name:_0x538a1a,typeservicesData:_0x58860b,typevehicle:_0x5402c8,driver:_0x4ce3e9,plate:_0xcc10bb,van:_0x24e680,DRSI:_0x13a993,TSU:_0x19ca2a,TFU:_0x31241a,note:_0x5573fd}=_0x384b49[_0x14597f(0x1b7)],_0x26cbf6=await transfers_finished[_0x14597f(0x1a0)](_0x3a3a6e);if(typeof _0x17dcec==_0x14597f(0x157))var _0x154e93=[_0x384b49[_0x14597f(0x1b7)]['product_name']],_0x18a08f=[_0x384b49['body'][_0x14597f(0x114)]],_0x56d865=[_0x384b49['body'][_0x14597f(0x1f9)]],_0xdaa546=[_0x384b49[_0x14597f(0x1b7)]['unit']],_0x3e9c62=[_0x384b49['body']['prod_secondunit']],_0x31ebe6=[_0x384b49['body'][_0x14597f(0x170)]],_0x208da4=[_0x384b49[_0x14597f(0x1b7)][_0x14597f(0x19f)]],_0x985dde=[_0x384b49['body'][_0x14597f(0x1b6)]],_0x2882e0=[_0x384b49['body']['batch_code']],_0x55cac0=[_0x384b49[_0x14597f(0x1b7)][_0x14597f(0x21d)]],_0x750018=[_0x384b49['body']['production_date']],_0x365c2f=[_0x384b49[_0x14597f(0x1b7)][_0x14597f(0x17c)]],_0x386213=[_0x384b49[_0x14597f(0x1b7)]['room']];else var _0x154e93=[..._0x384b49['body'][_0x14597f(0x13c)]],_0x18a08f=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x114)]],_0x56d865=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x1f9)]],_0xdaa546=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x208)]],_0x3e9c62=[..._0x384b49['body']['prod_secondunit']],_0x31ebe6=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x170)]],_0x208da4=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x19f)]],_0x985dde=[..._0x384b49[_0x14597f(0x1b7)]['secondary_code']],_0x2882e0=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x1d6)]],_0x55cac0=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x21d)]],_0x750018=[..._0x384b49[_0x14597f(0x1b7)]['production_date']],_0x365c2f=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x17c)]],_0x386213=[..._0x384b49[_0x14597f(0x1b7)][_0x14597f(0x201)]];const _0x365218=_0x154e93['map'](_0x2da03d=>{return _0x2da03d={'product_name':_0x2da03d};});_0x18a08f['forEach']((_0x4fec29,_0x2664f6)=>{var _0x1b530c=_0x14597f;_0x365218[_0x2664f6][_0x1b530c(0x125)]=_0x4fec29;}),_0x56d865[_0x14597f(0x15a)]((_0x8ddb14,_0x1d60e4)=>{var _0x40b58e=_0x14597f;_0x365218[_0x1d60e4]['quantity']=Math[_0x40b58e(0x17f)](_0x8ddb14);}),_0xdaa546[_0x14597f(0x15a)]((_0x54f0cf,_0x361047)=>{var _0x569af8=_0x14597f;_0x365218[_0x361047][_0x569af8(0x1db)]=_0x54f0cf;}),_0x3e9c62['forEach']((_0x1aba00,_0x53aacf)=>{var _0x3d757c=_0x14597f;_0x365218[_0x53aacf][_0x3d757c(0x1e6)]=_0x1aba00;}),_0x31ebe6['forEach']((_0x2fdf99,_0xf17c53)=>{var _0x18356b=_0x14597f,_0x4958b7=_0x2fdf99[_0x18356b(0x106)](/[A-Za-z]+/)[0x0],_0x12c9f5=parseInt(_0x2fdf99['match'](/\d+/)[0x0]);_0x365218[_0xf17c53][_0x18356b(0x122)]=_0x4958b7,_0x365218[_0xf17c53]['bay']=_0x12c9f5;}),_0x208da4[_0x14597f(0x15a)]((_0x30d76c,_0x3b62cd)=>{var _0x32118a=_0x14597f;_0x365218[_0x3b62cd][_0x32118a(0x19f)]=_0x30d76c;}),_0x985dde[_0x14597f(0x15a)]((_0x1c3a5d,_0x220b59)=>{var _0x88bf0f=_0x14597f;_0x365218[_0x220b59][_0x88bf0f(0x1b6)]=_0x1c3a5d;}),_0x2882e0[_0x14597f(0x15a)]((_0x504a00,_0x52bd07)=>{_0x365218[_0x52bd07]['batch_code']=_0x504a00;}),_0x55cac0[_0x14597f(0x15a)]((_0x2a1de8,_0x4a57e7)=>{var _0x1b48aa=_0x14597f;_0x365218[_0x4a57e7][_0x1b48aa(0x21d)]=_0x2a1de8;}),_0x750018[_0x14597f(0x15a)]((_0x48f885,_0x58b4f9)=>{var _0x33aa54=_0x14597f;_0x365218[_0x58b4f9][_0x33aa54(0xea)]=_0x48f885;}),_0x365c2f['forEach']((_0x31d79e,_0x7a7fbe)=>{var _0x54d6c1=_0x14597f;_0x365218[_0x7a7fbe][_0x54d6c1(0x1d9)]=_0x31d79e;}),_0x386213[_0x14597f(0x15a)]((_0x538ea8,_0x268c88)=>{var _0x546fdb=_0x14597f;_0x365218[_0x268c88][_0x546fdb(0x18d)]=_0x538ea8;});const _0xc15ad8=await createLog(_0x14597f(0x107));_0x386213[_0x14597f(0x15a)]((_0x5db07d,_0x25a28d)=>{var _0x1d6a79=_0x14597f;_0x365218[_0x25a28d]['invoice']='INC-'+_0xc15ad8[_0x1d6a79(0x1bb)]()[_0x1d6a79(0x1d4)](0x8,'0');});const _0x3da6d1=_0x365218[_0x14597f(0x181)](_0x310266=>_0x310266[_0x14597f(0x19b)]!=='0'&&_0x310266[_0x14597f(0x19b)]!==''),_0x416eb8=new purchases_incoming({'invoice':'INC-'+_0xc15ad8[_0x14597f(0x1bb)]()['padStart'](0x8,'0'),'date':_0xcfcde7,'warehouse_name':_0x538a1a,'product':_0x3da6d1,'note':_0x5573fd,'POnumber':_0x47261b,'SCRN':_0x2e28c4,'ReqBy':_0x452e03,'dateofreq':_0x54246d,'typeservicesData':_0x58860b,'van':_0x24e680,'typevehicle':_0x5402c8,'driver':_0x4ce3e9,'plate':_0xcc10bb,'DRSI':_0x13a993,'TSU':_0x19ca2a,'TFU':_0x31241a,'typeOfProducts':_0x3dd82d}),_0x13dbda=await _0x416eb8[_0x14597f(0x1aa)](),_0x59de8b=_0x13dbda['product'][_0x14597f(0x210)](async _0xe69f8d=>{var _0x38f084=_0x14597f,_0x2ee9f8=await warehouse[_0x38f084(0x103)]({'name':_0x538a1a,'room':_0xe69f8d[_0x38f084(0x18d)]});if(_0xe69f8d[_0x38f084(0x19b)]>0x0){var _0x390419=0x0;const _0x3e091c=_0x2ee9f8['product_details'][_0x38f084(0x210)](_0xbb0343=>{var _0x2361b5=_0x38f084;_0xbb0343[_0x2361b5(0x13c)]==_0xe69f8d[_0x2361b5(0x13c)]&&_0xbb0343[_0x2361b5(0x13d)]==_0xe69f8d[_0x2361b5(0x218)]&&_0xbb0343['expiry_date']==_0xe69f8d[_0x2361b5(0x21d)]&&_0xbb0343[_0x2361b5(0xea)]==_0xe69f8d[_0x2361b5(0xea)]&&_0xbb0343[_0x2361b5(0x1d6)]==_0xe69f8d[_0x2361b5(0x1d6)]&&_0xbb0343['invoice']==_0xe69f8d[_0x2361b5(0x10a)]&&(typeof _0xe69f8d[_0x2361b5(0x203)]==_0x2361b5(0x12d)?(console[_0x2361b5(0x195)](_0x2361b5(0x109),_0xbb0343['product_stock']+_0x2361b5(0x1c7)+_0xbb0343[_0x2361b5(0x15e)]+'\x20<=>\x20'+Math[_0x2361b5(0x17f)](_0xbb0343[_0x2361b5(0x1eb)])+Math[_0x2361b5(0x17f)](_0xe69f8d[_0x2361b5(0x1f9)])),_0xbb0343[_0x2361b5(0x1eb)]=Math[_0x2361b5(0x17f)](_0xbb0343['product_stock'])+Math[_0x2361b5(0x17f)](_0xe69f8d[_0x2361b5(0x19b)])):(_0xbb0343[_0x2361b5(0x1eb)]=Math[_0x2361b5(0x17f)](_0xbb0343['product_stock'])+Math['abs'](_0xe69f8d[_0x2361b5(0x19b)]),_0x390419++));});_0x390419=='0'&&(_0x2ee9f8['product_details']=_0x2ee9f8['product_details'][_0x38f084(0x1af)]({'product_name':_0xe69f8d[_0x38f084(0x13c)],'product_stock':_0xe69f8d[_0x38f084(0x19b)],'bay':_0xe69f8d[_0x38f084(0x13d)],'level':_0xe69f8d['level'],'product_code':_0xe69f8d['product_code'],'primary_code':_0xe69f8d['primary_code'],'secondary_code':_0xe69f8d[_0x38f084(0x1b6)],'expiry_date':_0xe69f8d[_0x38f084(0x21d)],'production_date':_0xe69f8d[_0x38f084(0xea)],'maxProducts':_0xe69f8d[_0x38f084(0x134)],'batch_code':_0xe69f8d[_0x38f084(0x1d6)],'secondary_unit':_0xe69f8d['secondary_unit'],'unit':_0xe69f8d[_0x38f084(0x1db)],'maxProducts':_0xe69f8d['maxProducts'],'maxPerUnit':_0xe69f8d[_0x38f084(0x1c8)],'invoice':_0xe69f8d[_0x38f084(0x10a)]}));}return _0x2ee9f8;});Promise[_0x14597f(0x1e1)](_0x59de8b)['then'](async _0x3b0aa6=>{var _0x2d388e=_0x14597f;try{for(const _0x5c0ffc of _0x3b0aa6){await warehouse['updateOne']({'_id':_0x5c0ffc[_0x2d388e(0x15e)]},{'$addToSet':{'product_details':{'$each':_0x5c0ffc['product_details']}}});}_0x26cbf6[_0x2d388e(0x1e8)]=_0x2d388e(0xf0);const _0x5bd9e4=await _0x26cbf6[_0x2d388e(0x1aa)](),_0x203578=await master_shop['find'](),_0x237be2=await email_settings[_0x2d388e(0x103)](),_0x2cea34=await supervisor_settings[_0x2d388e(0x137)]();var _0x5f405c=_0x416eb8[_0x2d388e(0x174)],_0x572074='',_0x3f8802;for(_0x3f8802 in _0x5f405c){var _0x11e9d4='FG';_0x416eb8[_0x2d388e(0x11c)]=='DRY\x20GOODS'&&(_0x11e9d4='DG'),_0x572074+='<tr>'+_0x2d388e(0x20c)+_0x5f405c[_0x3f8802][_0x2d388e(0x13c)]+'</td>'+_0x2d388e(0x20c)+_0x5f405c[_0x3f8802]['product_code']+_0x2d388e(0x1e2)+_0x2d388e(0x20c)+_0x5f405c[_0x3f8802]['to_quantity']+_0x2d388e(0x1e2)+_0x2d388e(0x20c)+_0x5f405c[_0x3f8802][_0x2d388e(0x208)]+'</td>'+_0x2d388e(0x20c)+_0x5f405c[_0x3f8802][_0x2d388e(0x1e6)]+_0x2d388e(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x416eb8[_0x2d388e(0x11c)]+'</td>'+_0x2d388e(0x20c)+_0x5f405c[_0x3f8802][_0x2d388e(0x11e)]+_0x2d388e(0x1e2)+_0x2d388e(0x20c)+_0x11e9d4+_0x5f405c[_0x3f8802][_0x2d388e(0x218)]+_0x2d388e(0x1e2)+'</tr>';}_0x384b49[_0x2d388e(0x215)](_0x2d388e(0x14b),_0x2d388e(0x149)),_0x2e45ad[_0x2d388e(0x1e5)]('/picking_list/pdf_puchases_fin_own_trf/'+_0x13dbda[_0x2d388e(0x15e)]);}catch(_0x5d7ba4){console[_0x2d388e(0x184)](_0x5d7ba4),_0x2e45ad[_0x2d388e(0x12e)](0x1f4)[_0x2d388e(0x133)]({'error':_0x2d388e(0x15c)});}})[_0x14597f(0x223)](_0x42c8cd=>{var _0x26acc6=_0x14597f;console['error'](_0x42c8cd),_0x2e45ad[_0x26acc6(0x12e)](0x1f4)[_0x26acc6(0x133)]({'error':_0x26acc6(0x1b4)});});}catch(_0x42fa7d){}}),router['post'](a0_0x2a53dd(0x156),auth,async(_0x15208e,_0x5b23f1)=>{var _0x38811e=a0_0x2a53dd;try{const {warehouse:_0x40dd9a}=_0x15208e[_0x38811e(0x1b7)],_0x502ba0=await transfers_finished[_0x38811e(0x137)]({'to_warehouse':_0x40dd9a,'to_recieved':_0x38811e(0x15f)});_0x5b23f1[_0x38811e(0x133)](_0x502ba0);}catch(_0x549a8b){}}),router[a0_0x2a53dd(0x1ee)]('/getinvoicetrf',auth,async(_0x2c6a59,_0x5cc97f)=>{var _0x1cfc00=a0_0x2a53dd;try{const {invoice:_0x43912f}=_0x2c6a59[_0x1cfc00(0x1b7)],_0x3239fa=await transfers_finished[_0x1cfc00(0x137)]({'_id':_0x43912f,'to_recieved':_0x1cfc00(0x15f)});_0x5cc97f[_0x1cfc00(0x133)](_0x3239fa);}catch(_0x54c457){}}),router[a0_0x2a53dd(0x219)](a0_0x2a53dd(0x21a),auth,async(_0x4a1d73,_0x199c93)=>{var _0x23942f=a0_0x2a53dd;try{const {username:_0x31cefa,email:_0x495651,role:_0x870310}=_0x4a1d73[_0x23942f(0x136)],_0x114c7d=_0x4a1d73[_0x23942f(0x136)],_0x1b71b7=await profile[_0x23942f(0x103)]({'email':_0x114c7d['email']}),_0xfdf6f8=await staff[_0x23942f(0x103)]({'email':_0x114c7d[_0x23942f(0x1a2)]});if(_0x114c7d['role']=='staff'){const _0xd1a41f=await staff[_0x23942f(0x103)]({'email':_0x114c7d[_0x23942f(0x1a2)]});}const _0x314b13=await master_shop[_0x23942f(0x137)]();let _0x43481f;if(_0x114c7d[_0x23942f(0x162)]==_0x23942f(0x176)){const _0x2a9d97=await staff[_0x23942f(0x103)]({'email':_0x114c7d[_0x23942f(0x1a2)]});_0x43481f=await purchases_finished[_0x23942f(0x185)]([{'$match':{'warehouse_name':_0x2a9d97['warehouse'],'typeOfProducts':_0x23942f(0x1ff)}},{'$lookup':{'from':_0x23942f(0x1a3),'localField':'suppliers','foreignField':_0x23942f(0x1c6),'as':_0x23942f(0x182)}},{'$unwind':_0x23942f(0x104)},{'$unwind':_0x23942f(0x16e)},{'$group':{'_id':_0x23942f(0x131),'invoice':{'$first':_0x23942f(0x187)},'suppliers':{'$first':_0x23942f(0x17a)},'date':{'$first':_0x23942f(0x1b3)},'warehouse_name':{'$first':_0x23942f(0x15b)},'room':{'$first':_0x23942f(0x129)},'product':{'$push':_0x23942f(0x16e)},'note':{'$first':_0x23942f(0x130)},'paid_amount':{'$first':_0x23942f(0xf9)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x23942f(0x16f)},'batch_code':{'$first':_0x23942f(0x1bf)},'expiry_date':{'$first':_0x23942f(0x128)},'suppliers_docs':{'$first':_0x23942f(0x104)},'total_product_quantity':{'$sum':_0x23942f(0x226)},'level':{'$addToSet':_0x23942f(0x193)},'isle':{'$addToSet':_0x23942f(0x20f)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x43481f=await purchases_finished[_0x23942f(0x185)]([{'$match':{'typeOfProducts':_0x23942f(0x1ff)}},{'$unwind':_0x23942f(0x16e)},{'$group':{'_id':_0x23942f(0x131),'invoice':{'$first':_0x23942f(0x187)},'suppliers':{'$first':_0x23942f(0x17a)},'date':{'$first':_0x23942f(0x1b3)},'warehouse_name':{'$first':_0x23942f(0x15b)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x23942f(0x16e)},'note':{'$first':_0x23942f(0x130)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x23942f(0x1f7)},'return_data':{'$first':_0x23942f(0x16f)},'batch_code':{'$first':_0x23942f(0x1bf)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x23942f(0x104)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x23942f(0x193)},'isle':{'$addToSet':_0x23942f(0x20f)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x23942f(0x1fc)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x314b13[0x0][_0x23942f(0x190)]==_0x23942f(0x1d2))var _0x210f5d=users[_0x23942f(0xf8)];else{if(_0x314b13[0x0][_0x23942f(0x190)]==_0x23942f(0x220))var _0x210f5d=users[_0x23942f(0x220)];else{if(_0x314b13[0x0][_0x23942f(0x190)]==_0x23942f(0x1c9))var _0x210f5d=users[_0x23942f(0x1c9)];else{if(_0x314b13[0x0]['language']==_0x23942f(0x221))var _0x210f5d=users[_0x23942f(0x221)];else{if(_0x314b13[0x0][_0x23942f(0x190)]==_0x23942f(0x102))var _0x210f5d=users[_0x23942f(0x102)];else{if(_0x314b13[0x0][_0x23942f(0x190)]=='Portuguese\x20(BR)')var _0x210f5d=users[_0x23942f(0xfa)];else{if(_0x314b13[0x0][_0x23942f(0x190)]==_0x23942f(0x21e))var _0x210f5d=users[_0x23942f(0x21e)];else{if(_0x314b13[0x0][_0x23942f(0x190)]=='Arabic\x20(ae)')var _0x210f5d=users['Arabic'];}}}}}}}_0x199c93['render'](_0x23942f(0x113),{'success':_0x4a1d73[_0x23942f(0x215)](_0x23942f(0x14b)),'errors':_0x4a1d73[_0x23942f(0x215)](_0x23942f(0x132)),'purchases':_0x43481f,'role':_0x114c7d,'profile':_0x1b71b7,'master_shop':_0x314b13,'language':_0x210f5d});}catch(_0x40d653){console[_0x23942f(0x195)](_0x23942f(0x146),_0x40d653),_0x199c93[_0x23942f(0x12e)](0xc8)[_0x23942f(0x133)]({'message':_0x40d653[_0x23942f(0x1fd)]});}}),router['get'](a0_0x2a53dd(0x10c),auth,async(_0x307a61,_0x461001)=>{var _0x26dfad=a0_0x2a53dd;try{const {username:_0xc4b0a2,email:_0x3d69e0,role:_0x1c958a}=_0x307a61['user'],_0x409f34=_0x307a61[_0x26dfad(0x136)],_0x294e5f=await profile[_0x26dfad(0x103)]({'email':_0x409f34[_0x26dfad(0x1a2)]}),_0x4aa72e=await staff[_0x26dfad(0x103)]({'email':_0x409f34['email']});if(_0x409f34[_0x26dfad(0x162)]==_0x26dfad(0x176)){const _0x46bf74=await staff[_0x26dfad(0x103)]({'email':_0x409f34['email']});}const _0x17e3b7=await master_shop[_0x26dfad(0x137)]();let _0x4e6bb2;if(_0x409f34['role']==_0x26dfad(0x176)){const _0x236caa=await staff[_0x26dfad(0x103)]({'email':_0x409f34['email']});_0x4e6bb2=await purchases_finished[_0x26dfad(0x185)]([{'$match':{'warehouse_name':_0x236caa[_0x26dfad(0x1d1)]}},{'$lookup':{'from':_0x26dfad(0x1a3),'localField':_0x26dfad(0x1a3),'foreignField':_0x26dfad(0x1c6),'as':'suppliers_docs'}},{'$unwind':_0x26dfad(0x104)},{'$unwind':_0x26dfad(0x16e)},{'$group':{'_id':'$_id','invoice':{'$first':_0x26dfad(0x187)},'suppliers':{'$first':_0x26dfad(0x17a)},'date':{'$first':_0x26dfad(0x1b3)},'warehouse_name':{'$first':_0x26dfad(0x15b)},'room':{'$first':_0x26dfad(0x129)},'product':{'$push':_0x26dfad(0x16e)},'note':{'$first':_0x26dfad(0x130)},'paid_amount':{'$first':_0x26dfad(0xf9)},'due_amount':{'$first':_0x26dfad(0x1f7)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x26dfad(0x128)},'suppliers_docs':{'$first':_0x26dfad(0x104)},'total_product_quantity':{'$sum':_0x26dfad(0x226)},'level':{'$addToSet':_0x26dfad(0x193)},'isle':{'$addToSet':_0x26dfad(0x20f)},'type':{'$addToSet':_0x26dfad(0xeb)},'floorlevel':{'$addToSet':_0x26dfad(0x1fc)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4e6bb2=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x26dfad(0x188)}},{'$unwind':_0x26dfad(0x16e)},{'$group':{'_id':_0x26dfad(0x131),'invoice':{'$first':_0x26dfad(0x187)},'suppliers':{'$first':_0x26dfad(0x17a)},'date':{'$first':_0x26dfad(0x1b3)},'warehouse_name':{'$first':_0x26dfad(0x15b)},'room':{'$addToSet':_0x26dfad(0x209)},'product':{'$push':_0x26dfad(0x16e)},'note':{'$first':_0x26dfad(0x130)},'paid_amount':{'$first':_0x26dfad(0xf9)},'due_amount':{'$first':_0x26dfad(0x1f7)},'return_data':{'$first':_0x26dfad(0x16f)},'batch_code':{'$first':_0x26dfad(0x1bf)},'expiry_date':{'$first':_0x26dfad(0x128)},'suppliers_docs':{'$first':_0x26dfad(0x104)},'total_product_quantity':{'$sum':_0x26dfad(0x226)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x26dfad(0xeb)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x17e3b7[0x0][_0x26dfad(0x190)]=='English\x20(US)')var _0x52f4fb=users[_0x26dfad(0xf8)];else{if(_0x17e3b7[0x0][_0x26dfad(0x190)]=='Hindi')var _0x52f4fb=users[_0x26dfad(0x220)];else{if(_0x17e3b7[0x0][_0x26dfad(0x190)]=='German')var _0x52f4fb=users[_0x26dfad(0x1c9)];else{if(_0x17e3b7[0x0]['language']=='Spanish')var _0x52f4fb=users['Spanish'];else{if(_0x17e3b7[0x0][_0x26dfad(0x190)]==_0x26dfad(0x102))var _0x52f4fb=users[_0x26dfad(0x102)];else{if(_0x17e3b7[0x0][_0x26dfad(0x190)]==_0x26dfad(0x20e))var _0x52f4fb=users[_0x26dfad(0xfa)];else{if(_0x17e3b7[0x0][_0x26dfad(0x190)]==_0x26dfad(0x21e))var _0x52f4fb=users['Chinese'];else{if(_0x17e3b7[0x0][_0x26dfad(0x190)]==_0x26dfad(0x228))var _0x52f4fb=users[_0x26dfad(0x222)];}}}}}}}_0x461001[_0x26dfad(0x189)](_0x26dfad(0x142),{'success':_0x307a61[_0x26dfad(0x215)](_0x26dfad(0x14b)),'errors':_0x307a61[_0x26dfad(0x215)](_0x26dfad(0x132)),'purchases':_0x4e6bb2,'role':_0x409f34,'profile':_0x294e5f,'master_shop':_0x17e3b7,'language':_0x52f4fb});}catch(_0x15ba74){console[_0x26dfad(0x195)](_0x26dfad(0x146),_0x15ba74),_0x461001[_0x26dfad(0x12e)](0xc8)['json']({'message':_0x15ba74[_0x26dfad(0x1fd)]});}});function a0_0x1913(){var _0x2bf574=['payment\x20successfull','<h5>','34200KhSSXW','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','date_recieved','prod_qty','$due_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','to_quantity','$unit','FROZEN\x20GOODS','$product.floorlevel','message','uuid','own','edit_purchases_finished_view','room','INC-','id_transaction','amount','<h5\x20style=\x22text-align:\x20left;\x22>','add_purchases_finished','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','unit','$product.room_name','password','then','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Portuguese\x20(BR)','$product.bin','map','<hr\x20class=\x22my-3\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','purchases_id','site_title','flash','incoming_view','purchase\x20data\x20add\x20successfully','to_bay','get','/view','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','util','expiry_date','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Hindi','Spanish','Arabic','catch','random','\x20Order\x20Number\x20:\x20','$product.quantity','Rack\x202','Arabic\x20(ae)','$product_details.product_code','isProcess','</body></html>','$product_details','../middleware/auth','getDate','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$maxStocks','production_date','$product.type','sales_data_cateory','$sales_category','<!DOCTYPE\x20html>','createTransport','true','gross_price','/view/add_purchases_logs','primary_code_hide','$category','$primary_code','$product_details.storage','prod_primunit','English','$paid_amount','Portuguese','$brand','/view/:id','There\x20is\x20','master','POnumber','product_cat','stock_quantity','French','findOne','$suppliers_docs','return_product','match','INC','/view/return_purchase/:id','here2','invoice','prod_name','/view_log','currency_placement','purchase_quantity','max','$product_details.type','prod_unit','product_date','all_purchases_finished','item_code','isAvailable','$product_details.product_name','$product_details._id','/all_purchases_finished/view','\x20Order\x20Date\x20:\x20','maxStocks','sendMail','to_warehouse','$product_details.maxProducts','to_room_name','136VrtVSe','FGSEmail','../models/all_models','level','user_id','/preview/:id','product_code','/give_payment/:id','Distributing\x20','$expiry_date','$room','/../public','348kBNlYr','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','undefined','status','<span\x20style=\x22float:\x20right;\x22>','$note','$_id','errors','json','maxProducts',',\x20room:\x20','user','find','\x20</h2>','/all_purchases/view','2-digit',',\x20bin:\x20','product_name','bay','/all_purchases_finished/process/','min','$name','DRY\x20GOODS','all_purchases_finished_logs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','edit_purchases_finished','Purchase\x20Return','table\x20page','paid_amount','Email\x20sent\x20successfully','Transfer\x20Finalize\x20Successfully','</head><body>','success','gmail','Ambient','/view/add_purchases/:id','</thead>','stock_data','$maxProdPerUnit','toLocaleDateString','/incoming/add','add_purchases_finished_logs','</table>','/getTRF','string','<strong>\x20Regards\x20</strong>','logo','forEach','$warehouse_name','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','floor','_id','false','/view/add_purchases','True','role','type_of_products_type','prod_Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','2335040FStcuk','419679QsYflQ','/process/:id','<div>','$secondary_code','Router','$gross_price','valueOf','$product','$return_data','bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Finished\x20Goods','Room_name','product','18AjDkiF','staff','product_details','$secondary_unit','product_id','$suppliers','path','max_product_unit','product_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','abs','INCF-','filter','suppliers_docs','</span>','error','aggregate','prod_secondunit','$invoice','logs','render','$product_details.bin','<tr>','RoomAssign','room_name','2fuGJGs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','language','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','invoice_init','$product.bay','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','log','Logo.png','return_qty','The\x20Other\x20','prod_level','prod_cat','quantity','<h2>\x20','due_amount','nodemailer','primary_code','findById','An\x20error\x20occurred\x20while\x20saving\x20data.','email','suppliers','</div>','LOG-INC-','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x201','$type_products','$product_details.bay','getMonth','save','/invoice/:id','$product_code',',\x20bay:\x20','\x20units\x20to\x20warehouse:\x20','concat','length','secondary_code_hide','purchases\x20item\x20return\x20successfull','$date','An\x20error\x20occurred.','37435FmbEvN','secondary_code','body','479091tjXWGF','216eZFMGU','product_code_hide','toString','warehouse_name','params','/upload/','$batch_code','note','$product_details.secondary_code','updateOne','date','Rack\x201','Return\x20Goods','name','\x20<>\x20','maxPerUnit','German','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','Error\x20Occurs','express','data_type','348TOcxfB','type_of_products','inc','warehouse','English\x20(US)','4090757opVolT','padStart','</tbody>','batch_code','$alertquantity','prod_code','maxperunit','Enabled','standard_unit','Purchase\x20Return\x20Mail','sales_category','en-CA','purchases_process','getFullYear','all','</td>','</h5>','Enclosed','redirect','secondary_unit','254149qoDPMO','to_recieved','host','/barcode_scanner','product_stock','slice','STAGING','post','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'];a0_0x1913=function(){return _0x2bf574;};return a0_0x1913();}function BayBinSelected(_0x53e59f,_0x573084){var _0x2a6766=a0_0x2a53dd,_0x47441d=[],_0x2af0b9=[];if(_0x53e59f=='DRY\x20GOODS'){switch(_0x573084){case _0x2a6766(0x1c4):_0x47441d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x47441d=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2af0b9=['DG'];}else{if(_0x53e59f==_0x2a6766(0x1fb)){switch(_0x573084){case _0x2a6766(0x1c4):_0x47441d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2a6766(0x227):_0x47441d=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2af0b9=['FG'];}}return{'levels':_0x47441d,'identify':_0x2af0b9};}async function getRandom8DigitNumber(){var _0x3adfae=a0_0x2a53dd;const _0x165072=0x989680,_0x9dea0b=0x5f5e0ff,_0x2050b0=Math[_0x3adfae(0x15d)](Math[_0x3adfae(0x224)]()*(_0x9dea0b-_0x165072+0x1))+_0x165072;var _0x327f0a;const _0xc222d3=await purchases_finished['findOne']({'invoice':_0x3adfae(0x180)+_0x2050b0});return _0xc222d3&&_0xc222d3[_0x3adfae(0x1b0)]>0x0?_0x327f0a=_0x3adfae(0x180)+_0x2050b0:_0x327f0a=_0x3adfae(0x180)+_0x2050b0,_0x327f0a;}router[a0_0x2a53dd(0x219)](a0_0x2a53dd(0x160),auth,async(_0x2ab03a,_0x26ff82)=>{var _0x1076c9=a0_0x2a53dd;try{const {username:_0xf4117f,email:_0x2e622a,role:_0x5990be}=_0x2ab03a[_0x1076c9(0x136)],_0x4579bb=_0x2ab03a[_0x1076c9(0x136)],_0x4f3767=await profile['findOne']({'email':_0x4579bb['email']}),_0x42b479=await master_shop[_0x1076c9(0x137)](),_0x334534=await staff[_0x1076c9(0x103)]({'email':_0x4579bb[_0x1076c9(0x1a2)]}),_0x29f24f=await suppliers['find']({});let _0x8ab52f;if(_0x4579bb['role']=='staff'){const _0x1cb691=await staff['findOne']({'email':_0x4579bb[_0x1076c9(0x1a2)]});_0x8ab52f=await warehouse[_0x1076c9(0x185)]([{'$match':{'status':_0x1076c9(0x1da),'name':_0x1cb691[_0x1076c9(0x1d1)]}},{'$group':{'_id':_0x1076c9(0x140),'name':{'$first':_0x1076c9(0x140)}}}]);}else _0x8ab52f=await warehouse['aggregate']([{'$match':{'status':_0x1076c9(0x1da)}},{'$group':{'_id':_0x1076c9(0x140),'name':{'$first':_0x1076c9(0x140)}}}]);const _0x4bfec0=await product[_0x1076c9(0x137)]({}),_0x1cce43=await warehouse[_0x1076c9(0x137)]({'status':'Enabled'}),_0x22cdf9=await purchases_finished[_0x1076c9(0x137)]({}),_0x1eb060=_0x22cdf9[_0x1076c9(0x1b0)]+0x1,_0x56cf90=_0x1076c9(0x180)+_0x1eb060['toString']()[_0x1076c9(0x1d4)](0x5,'0');var _0x40f4a0=[_0x1076c9(0x14d),'Enclosed'];if(_0x42b479[0x0][_0x1076c9(0x190)]==_0x1076c9(0x1d2))var _0x3b70c7=users[_0x1076c9(0xf8)];else{if(_0x42b479[0x0]['language']==_0x1076c9(0x220))var _0x3b70c7=users[_0x1076c9(0x220)];else{if(_0x42b479[0x0][_0x1076c9(0x190)]=='German')var _0x3b70c7=users[_0x1076c9(0x1c9)];else{if(_0x42b479[0x0][_0x1076c9(0x190)]==_0x1076c9(0x221))var _0x3b70c7=users[_0x1076c9(0x221)];else{if(_0x42b479[0x0]['language']=='French')var _0x3b70c7=users[_0x1076c9(0x102)];else{if(_0x42b479[0x0][_0x1076c9(0x190)]==_0x1076c9(0x20e))var _0x3b70c7=users[_0x1076c9(0xfa)];else{if(_0x42b479[0x0][_0x1076c9(0x190)]==_0x1076c9(0x21e))var _0x3b70c7=users['Chinese'];else{if(_0x42b479[0x0]['language']==_0x1076c9(0x228))var _0x3b70c7=users['Arabic'];}}}}}}}const _0x453fe6=getRandom8DigitNumber(),_0x344315=new Date(),_0x451646={'year':'numeric','month':_0x1076c9(0x13a),'day':_0x1076c9(0x13a),'timeZone':'Asia/Manila'},_0x22c3fb=_0x344315[_0x1076c9(0x152)](_0x1076c9(0x1de),_0x451646);console[_0x1076c9(0x195)](_0x22c3fb),_0x453fe6[_0x1076c9(0x20b)](_0x526e4f=>{var _0xb77da2=_0x1076c9;_0x26ff82[_0xb77da2(0x189)](_0xb77da2(0x206),{'success':_0x2ab03a[_0xb77da2(0x215)](_0xb77da2(0x14b)),'errors':_0x2ab03a['flash'](_0xb77da2(0x132)),'role':_0x4579bb,'profile':_0x4f3767,'suppliers':_0x29f24f,'warehouse':_0x8ab52f,'product':_0x4bfec0,'invoice':_0x526e4f,'master_shop':_0x42b479,'language':_0x3b70c7,'find_data':_0x1cce43,'rooms_data':_0x40f4a0,'formattedDate':_0x22c3fb});})['catch'](_0x3981df=>{var _0x1bade8=_0x1076c9;_0x2ab03a[_0x1bade8(0x215)](_0x1bade8(0x132),_0x1bade8(0x18f)),_0x26ff82[_0x1bade8(0x1e5)](_0x1bade8(0x118));});}catch(_0x4fc765){console['log'](_0x4fc765);}}),router[a0_0x2a53dd(0x219)](a0_0x2a53dd(0xf2),auth,async(_0x5b8ddb,_0x53df63)=>{var _0x4ba26d=a0_0x2a53dd;try{const {username:_0x36b289,email:_0x431584,role:_0xf71505}=_0x5b8ddb['user'],_0x4ce9d4=_0x5b8ddb[_0x4ba26d(0x136)],_0x40a3c8=await profile[_0x4ba26d(0x103)]({'email':_0x4ce9d4[_0x4ba26d(0x1a2)]}),_0x5effc8=await master_shop['find'](),_0x522127=await staff[_0x4ba26d(0x103)]({'email':_0x4ce9d4[_0x4ba26d(0x1a2)]}),_0x28170d=await suppliers['find']({});let _0x2a3e22;if(_0x4ce9d4['role']==_0x4ba26d(0x176)){const _0x1dfcb5=await staff[_0x4ba26d(0x103)]({'email':_0x4ce9d4[_0x4ba26d(0x1a2)]});_0x2a3e22=await warehouse[_0x4ba26d(0x185)]([{'$match':{'status':_0x4ba26d(0x1da),'name':_0x1dfcb5[_0x4ba26d(0x1d1)]}},{'$group':{'_id':_0x4ba26d(0x140),'name':{'$first':'$name'}}}]);}else _0x2a3e22=await warehouse[_0x4ba26d(0x185)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4ba26d(0x140),'name':{'$first':_0x4ba26d(0x140)}}}]);const _0x5b512e=await product[_0x4ba26d(0x137)]({}),_0x379672=await warehouse[_0x4ba26d(0x137)]({'status':'Enabled'}),_0xc5a1bf=await purchases_finished[_0x4ba26d(0x137)]({}),_0xc1cdf6=_0xc5a1bf[_0x4ba26d(0x1b0)]+0x1,_0x4d4b25='INCF-'+_0xc1cdf6[_0x4ba26d(0x1bb)]()[_0x4ba26d(0x1d4)](0x5,'0');var _0x26fbdd=[_0x4ba26d(0x14d),_0x4ba26d(0x1e4)];if(_0x5effc8[0x0][_0x4ba26d(0x190)]=='English\x20(US)')var _0x3996f1=users['English'];else{if(_0x5effc8[0x0][_0x4ba26d(0x190)]==_0x4ba26d(0x220))var _0x3996f1=users['Hindi'];else{if(_0x5effc8[0x0][_0x4ba26d(0x190)]==_0x4ba26d(0x1c9))var _0x3996f1=users['German'];else{if(_0x5effc8[0x0][_0x4ba26d(0x190)]==_0x4ba26d(0x221))var _0x3996f1=users[_0x4ba26d(0x221)];else{if(_0x5effc8[0x0][_0x4ba26d(0x190)]=='French')var _0x3996f1=users[_0x4ba26d(0x102)];else{if(_0x5effc8[0x0][_0x4ba26d(0x190)]==_0x4ba26d(0x20e))var _0x3996f1=users[_0x4ba26d(0xfa)];else{if(_0x5effc8[0x0]['language']==_0x4ba26d(0x21e))var _0x3996f1=users[_0x4ba26d(0x21e)];else{if(_0x5effc8[0x0][_0x4ba26d(0x190)]==_0x4ba26d(0x228))var _0x3996f1=users[_0x4ba26d(0x222)];}}}}}}}const _0x508081=getRandom8DigitNumber();_0x508081[_0x4ba26d(0x20b)](_0x4bd24a=>{var _0x1ece21=_0x4ba26d;_0x53df63[_0x1ece21(0x189)](_0x1ece21(0x154),{'success':_0x5b8ddb[_0x1ece21(0x215)](_0x1ece21(0x14b)),'errors':_0x5b8ddb[_0x1ece21(0x215)](_0x1ece21(0x132)),'role':_0x4ce9d4,'profile':_0x40a3c8,'suppliers':_0x28170d,'warehouse':_0x2a3e22,'product':_0x5b512e,'invoice':_0x4bd24a,'master_shop':_0x5effc8,'language':_0x3996f1,'find_data':_0x379672,'rooms_data':_0x26fbdd});})[_0x4ba26d(0x223)](_0x4d3fd7=>{var _0x21f3e7=_0x4ba26d;_0x5b8ddb[_0x21f3e7(0x215)]('errors',_0x21f3e7(0x18f)),_0x53df63['redirect'](_0x21f3e7(0x118));});}catch(_0x25476f){console['log'](_0x25476f);}}),router['get'](a0_0x2a53dd(0x14e),auth,async(_0x597749,_0x269d39)=>{var _0x24e908=a0_0x2a53dd;try{const _0x52f774=_0x597749[_0x24e908(0x1bd)]['id'];console['log'](_0x52f774);const _0x4daa16=await master_shop['find']();console['log'](_0x24e908(0xfe),_0x4daa16);const _0x4f4f78=await product[_0x24e908(0x103)]({'name':_0x52f774});console[_0x24e908(0x195)](_0x24e908(0x174),_0x4f4f78),_0x269d39[_0x24e908(0x12e)](0xc8)[_0x24e908(0x133)]({'product_data':_0x4f4f78,'master':_0x4daa16});}catch(_0x22b3ab){console['log']('add_purchases\x20error',_0x22b3ab);}}),router[a0_0x2a53dd(0x1ee)]('/view/add_purchases',auth,async(_0x3d5e3d,_0x272e31)=>{var _0x15a566=a0_0x2a53dd;try{const {invoice:_0xd50f6,date:_0x4b6340,warehouse_name:_0x33fd92,prod_name:_0x25ac99,note:_0x2518b4,due_amount:_0x549c2f,Room_name:_0x14ce0d,PO_number:_0xbd35e5,SCRN:_0x3312c5,ReqBy:_0x3d4338,dateofreq:_0x59e6f5,suppliers:_0x406889,typeservicesData:_0x2fb9dd,van:_0x3a2fa2,typevehicle:_0x187d20,driver:_0x299aeb,plate:_0x4f4ac0,DRSI:_0x31defd,TSU:_0x4f3146,TFU:_0x545a0e,JO_number:_0x316a1f,type_of_products:_0x5d0ab3}=_0x3d5e3d['body'];if(typeof _0x25ac99==_0x15a566(0x157))var _0x303d21=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x10b)]],_0x1c0a66=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x1d8)]],_0x5942fa=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x164)]],_0x35cbd4=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0xf7)]],_0x37c4c2=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x186)]],_0x3f484d=[_0x3d5e3d['body'][_0x15a566(0x19f)]],_0x14fdb8=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x1b6)]],_0x2cd71a=[_0x3d5e3d['body'][_0x15a566(0x1ef)]],_0x39c85c=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x1d6)]],_0x4eead6=[_0x3d5e3d['body'][_0x15a566(0x21d)]],_0x491235=[_0x3d5e3d['body'][_0x15a566(0x112)]],_0x282143=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x17c)]],_0x344d3e=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x19a)]],_0x50603c=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0xf1)]],_0x5ba80e=[_0x3d5e3d['body'][_0x15a566(0x1fe)]],_0xd61da7=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0xec)]],_0x9173eb=[_0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x179)]];else var _0x303d21=[..._0x3d5e3d['body']['prod_name']],_0x1c0a66=[..._0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x1d8)]],_0x5942fa=[..._0x3d5e3d[_0x15a566(0x1b7)]['prod_Qty']],_0x35cbd4=[..._0x3d5e3d['body'][_0x15a566(0xf7)]],_0x37c4c2=[..._0x3d5e3d[_0x15a566(0x1b7)]['prod_secondunit']],_0x3f484d=[..._0x3d5e3d[_0x15a566(0x1b7)]['primary_code']],_0x14fdb8=[..._0x3d5e3d['body']['secondary_code']],_0x2cd71a=[..._0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x1ef)]],_0x39c85c=[..._0x3d5e3d['body']['batch_code']],_0x4eead6=[..._0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x21d)]],_0x491235=[..._0x3d5e3d['body'][_0x15a566(0x112)]],_0x282143=[..._0x3d5e3d[_0x15a566(0x1b7)]['max_product_unit']],_0x344d3e=[..._0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0x19a)]],_0x50603c=[..._0x3d5e3d[_0x15a566(0x1b7)][_0x15a566(0xf1)]],_0x5ba80e=[..._0x3d5e3d['body'][_0x15a566(0x1fe)]],_0xd61da7=[..._0x3d5e3d['body'][_0x15a566(0xec)]],_0x9173eb=[..._0x3d5e3d['body'][_0x15a566(0x179)]];const _0x802dc7=_0x303d21[_0x15a566(0x210)](_0x4d9100=>{return _0x4d9100={'product_name':_0x4d9100};});_0x9173eb['forEach']((_0x1111e8,_0x1badff)=>{var _0x5d5ff2=_0x15a566;_0x802dc7[_0x1badff][_0x5d5ff2(0x179)]=_0x1111e8,_0x802dc7[_0x1badff][_0x5d5ff2(0x1f5)]=_0x4b6340;}),_0xd61da7['forEach']((_0x44e455,_0x5e47cd)=>{var _0x186723=_0x15a566;_0x802dc7[_0x5e47cd][_0x186723(0x1dd)]=_0x44e455;}),_0x1c0a66[_0x15a566(0x15a)]((_0x584cfa,_0x30f9fd)=>{_0x802dc7[_0x30f9fd]['product_code']=_0x584cfa;}),_0x5ba80e['forEach']((_0x3c0a45,_0x22f421)=>{_0x802dc7[_0x22f421]['uuid']=_0x3c0a45;}),_0x5942fa[_0x15a566(0x15a)]((_0x3fb8c1,_0x4a7896)=>{var _0x52de2b=_0x15a566;_0x802dc7[_0x4a7896][_0x52de2b(0x19b)]=Math['abs'](_0x3fb8c1);}),_0x35cbd4[_0x15a566(0x15a)]((_0x410d70,_0x4b87f5)=>{_0x802dc7[_0x4b87f5]['standard_unit']=_0x410d70;}),_0x37c4c2['forEach']((_0x452d7a,_0x957794)=>{var _0x184aee=_0x15a566;_0x802dc7[_0x957794][_0x184aee(0x1e6)]=_0x452d7a;}),_0x3f484d[_0x15a566(0x15a)]((_0x288ee7,_0x392d40)=>{var _0x5e85df=_0x15a566;_0x802dc7[_0x392d40][_0x5e85df(0x19f)]=_0x288ee7;}),_0x14fdb8[_0x15a566(0x15a)]((_0x5a3f84,_0x1eb665)=>{var _0x292019=_0x15a566;_0x802dc7[_0x1eb665][_0x292019(0x1b6)]=_0x5a3f84;}),_0x2cd71a[_0x15a566(0x15a)]((_0x259ccc,_0x39fec8)=>{var _0x46e0a9=_0x15a566;_0x802dc7[_0x39fec8][_0x46e0a9(0x11a)]=_0x259ccc;}),_0x39c85c['forEach']((_0x28fe32,_0x351460)=>{_0x802dc7[_0x351460]['batch_code']=_0x28fe32;}),_0x4eead6[_0x15a566(0x15a)]((_0x99912a,_0x4f212c)=>{var _0x30e0e1=_0x15a566;_0x802dc7[_0x4f212c][_0x30e0e1(0x21d)]=_0x99912a;}),_0x491235['forEach']((_0x1d343b,_0x1cb59c)=>{_0x802dc7[_0x1cb59c]['production_date']=_0x1d343b;}),_0x282143[_0x15a566(0x15a)]((_0x5cd3c6,_0x24a403)=>{_0x802dc7[_0x24a403]['maxperunit']=_0x5cd3c6;}),_0x344d3e['forEach']((_0x22ff1f,_0x42057c)=>{var _0x5bfac3=_0x15a566;_0x802dc7[_0x42057c][_0x5bfac3(0x100)]=_0x22ff1f;}),_0x50603c['forEach']((_0x1b3e8c,_0x3af6ee)=>{var _0x1d42a6=_0x15a566;_0x802dc7[_0x3af6ee][_0x1d42a6(0xf1)]=_0x1b3e8c;});const _0xbbbf3a=new invoice_for_incoming();await _0xbbbf3a[_0x15a566(0x1aa)]();for(let _0x5cc933=0x0;_0x5cc933<=_0x303d21[_0x15a566(0x1b0)]-0x1;_0x5cc933++){_0x802dc7[_0x5cc933][_0x15a566(0x10a)]='INC-'+_0xbbbf3a[_0x15a566(0x192)]['toString']()[_0x15a566(0x1d4)](0x8,'0');}const _0x429ad1=await warehouse_validation_setup[_0x15a566(0x185)]([{'$match':{'warehouse_name':_0x33fd92}}]);for(let _0x41d257=0x0;_0x41d257<=_0x429ad1[_0x15a566(0x1b0)]-0x1;_0x41d257++){const _0x38dff4=_0x429ad1[_0x41d257];for(let _0x4562e9=0x0;_0x4562e9<=_0x38dff4['product_data']['length']-0x1;_0x4562e9++){const _0x47e092=_0x38dff4[_0x15a566(0x17d)][_0x4562e9],_0x3c59cd=await warehouse[_0x15a566(0x185)]([{'$match':{'name':_0x38dff4['warehouse_name'],'room':_0x38dff4['room']}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x47e092[_0x15a566(0x13d)],'product_details.bay':parseInt(_0x47e092['bin']),'product_details.product_code':_0x47e092[_0x15a566(0x125)]}}]);for(let _0x474144=0x0;_0x474144<=_0x3c59cd[_0x15a566(0x1b0)]-0x1;_0x474144++){let _0x4e1279=_0x3c59cd[_0x474144],_0x568358=0x0;_0x4e1279['product_details']['product_code']==_0x47e092[_0x15a566(0x125)]&&_0x4e1279['product_details'][_0x15a566(0x13d)]==_0x47e092[_0x15a566(0x170)]&&_0x4e1279[_0x15a566(0x177)]['level']==_0x47e092[_0x15a566(0x13d)]&&(_0x47e092[_0x15a566(0x10f)]=parseInt(_0x47e092[_0x15a566(0x10f)])-parseInt(_0x4e1279[_0x15a566(0x177)][_0x15a566(0x1eb)]),_0x568358++),_0x568358=='0'&&(parseInt(_0x47e092[_0x15a566(0x10f)])>0x0&&(_0x429ad1[_0x41d257][_0x15a566(0x17d)]=_0x429ad1[_0x41d257][_0x15a566(0x17d)][_0x15a566(0x1af)]({'bay':_0x47e092['bay'],'bin':_0x47e092[_0x15a566(0x170)],'max':_0x47e092[_0x15a566(0x10f)],'min':_0x47e092[_0x15a566(0x13f)],'product_code':_0x47e092['product_code'],'product_id':_0x47e092[_0x15a566(0x179)],'product_name':_0x47e092[_0x15a566(0x13c)]})));}}_0x429ad1[_0x41d257][_0x15a566(0x17d)]=_0x429ad1[_0x41d257]['product_data']['filter'](_0x425a16=>parseInt(_0x425a16[_0x15a566(0x10f)])>0x0);}let _0x181fbd=[];for(let _0x451b3c=0x0;_0x451b3c<=_0x802dc7[_0x15a566(0x1b0)]-0x1;_0x451b3c++){const _0x20093d=_0x802dc7[_0x451b3c];for(let _0x3766b2=0x0;_0x3766b2<=_0x429ad1[_0x15a566(0x1b0)]-0x1;_0x3766b2++){const _0x991b57=_0x429ad1[_0x3766b2];for(let _0xbd5519=0x0;_0xbd5519<=_0x991b57['product_data'][_0x15a566(0x1b0)]-0x1;_0xbd5519++){const _0x328473=_0x991b57['product_data'][_0xbd5519];if(_0x328473[_0x15a566(0x125)]===_0x20093d['product_code']){let _0x580d28=_0x20093d['quantity'];const _0x1e4a70=await warehouse[_0x15a566(0x185)]([{'$match':{'name':_0x33fd92,'room':_0x991b57[_0x15a566(0x201)]}},{'$unwind':_0x15a566(0xe4)},{'$match':{'product_details.level':_0x328473[_0x15a566(0x13d)],'product_details.bay':parseInt(_0x328473[_0x15a566(0x170)])}}]);if(_0x1e4a70[_0x15a566(0x1b0)]==0x0){let _0x17f86b=0x0;for(let _0x5befd0=0x0;_0x5befd0<=_0x991b57[_0x15a566(0x17d)]['length']-0x1&&_0x580d28>0x0;_0x5befd0++){const _0x3cb25b=_0x991b57[_0x15a566(0x17d)][_0x5befd0];if(_0x20093d[_0x15a566(0x125)]===_0x3cb25b[_0x15a566(0x125)]){_0x181fbd[_0x5befd0]={};const _0x59a807=parseInt(_0x3cb25b[_0x15a566(0x10f)]),_0x25c34b=0x0;let _0x58aa19=_0x59a807-_0x25c34b,_0x559259=Math[_0x15a566(0x13f)](_0x580d28,_0x58aa19);console[_0x15a566(0x195)](_0x15a566(0x127)+_0x559259+_0x15a566(0x1ae)+_0x991b57[_0x15a566(0x1bc)]+_0x15a566(0x135)+_0x991b57[_0x15a566(0x201)]+_0x15a566(0x1ad)+_0x3cb25b[_0x15a566(0x13d)]+_0x15a566(0x13b)+_0x3cb25b['bin']),_0x181fbd[_0x5befd0]['product_name']=_0x20093d['product_name'],_0x181fbd[_0x5befd0][_0x15a566(0x125)]=_0x20093d[_0x15a566(0x125)],_0x181fbd[_0x5befd0][_0x15a566(0x179)]=_0x20093d[_0x15a566(0x179)],_0x181fbd[_0x5befd0]['date_recieved']=_0x20093d[_0x15a566(0x1f5)],_0x181fbd[_0x5befd0][_0x15a566(0x1dd)]=_0x20093d[_0x15a566(0x1dd)],_0x181fbd[_0x5befd0]['uuid']=_0x20093d['uuid'],_0x181fbd[_0x5befd0][_0x15a566(0x19b)]=_0x559259,_0x181fbd[_0x5befd0][_0x15a566(0x1db)]=_0x20093d['standard_unit'],_0x181fbd[_0x5befd0][_0x15a566(0x1e6)]=_0x20093d['secondary_unit'],_0x181fbd[_0x5befd0]['primary_code']=_0x20093d[_0x15a566(0x19f)],_0x181fbd[_0x5befd0][_0x15a566(0x1b6)]=_0x20093d[_0x15a566(0x1b6)],_0x181fbd[_0x5befd0][_0x15a566(0x11a)]=_0x20093d[_0x15a566(0x11a)],_0x181fbd[_0x5befd0][_0x15a566(0x1d6)]=_0x20093d[_0x15a566(0x1d6)],_0x181fbd[_0x5befd0][_0x15a566(0x21d)]=_0x20093d[_0x15a566(0x21d)],_0x181fbd[_0x5befd0][_0x15a566(0xea)]=_0x20093d['production_date'],_0x181fbd[_0x5befd0][_0x15a566(0x1d9)]=_0x20093d[_0x15a566(0x1d9)],_0x181fbd[_0x5befd0]['product_cat']=_0x20093d['product_cat'],_0x181fbd[_0x5befd0][_0x15a566(0x10a)]=_0x20093d[_0x15a566(0x10a)],_0x181fbd[_0x5befd0][_0x15a566(0xf1)]=_0x20093d['gross_price'],_0x181fbd[_0x5befd0]['room_name']=_0x991b57['room'],_0x181fbd[_0x5befd0]['level']=_0x3cb25b[_0x15a566(0x13d)],_0x181fbd[_0x5befd0]['bay']=_0x3cb25b[_0x15a566(0x170)],console['log'](_0x5befd0),_0x580d28-=_0x559259;if(_0x580d28<=0x0)break;_0x17f86b++;}}if(_0x580d28<=0x0){console[_0x15a566(0x195)](_0x15a566(0xfd)+_0x580d28+_0x15a566(0x1a6)),_0x3d5e3d[_0x15a566(0x215)]('errors','The\x20Other\x20'+_0x580d28+_0x15a566(0x191));break;}if(_0x580d28>0x0){console[_0x15a566(0x195)](_0x15a566(0xfd)+_0x580d28+_0x15a566(0x207));const _0x4a74a2=await warehouse[_0x15a566(0x185)]([{'$match':{'name':_0x33fd92,'isStaging':_0x15a566(0xf0)}}]);_0x181fbd[_0x17f86b]={},_0x181fbd[_0x17f86b][_0x15a566(0x13c)]=_0x20093d[_0x15a566(0x13c)],_0x181fbd[_0x17f86b][_0x15a566(0x125)]=_0x20093d[_0x15a566(0x125)],_0x181fbd[_0x17f86b]['product_id']=_0x20093d[_0x15a566(0x179)],_0x181fbd[_0x17f86b][_0x15a566(0x1f5)]=_0x20093d[_0x15a566(0x1f5)],_0x181fbd[_0x17f86b][_0x15a566(0x1dd)]=_0x20093d[_0x15a566(0x1dd)],_0x181fbd[_0x17f86b]['uuid']=_0x20093d['uuid'],_0x181fbd[_0x17f86b][_0x15a566(0x19b)]=_0x580d28,_0x181fbd[_0x17f86b]['standard_unit']=_0x20093d[_0x15a566(0x1db)],_0x181fbd[_0x17f86b][_0x15a566(0x1e6)]=_0x20093d[_0x15a566(0x1e6)],_0x181fbd[_0x17f86b][_0x15a566(0x19f)]=_0x20093d[_0x15a566(0x19f)],_0x181fbd[_0x17f86b][_0x15a566(0x1b6)]=_0x20093d[_0x15a566(0x1b6)],_0x181fbd[_0x17f86b][_0x15a566(0x11a)]=_0x20093d[_0x15a566(0x11a)],_0x181fbd[_0x17f86b][_0x15a566(0x1d6)]=_0x20093d[_0x15a566(0x1d6)],_0x181fbd[_0x17f86b]['expiry_date']=_0x20093d['expiry_date'],_0x181fbd[_0x17f86b]['production_date']=_0x20093d[_0x15a566(0xea)],_0x181fbd[_0x17f86b]['maxperunit']=_0x20093d[_0x15a566(0x1d9)],_0x181fbd[_0x17f86b]['product_cat']=_0x20093d[_0x15a566(0x100)],_0x181fbd[_0x17f86b][_0x15a566(0x10a)]=_0x20093d[_0x15a566(0x10a)],_0x181fbd[_0x17f86b]['gross_price']=_0x20093d[_0x15a566(0xf1)],_0x181fbd[_0x17f86b][_0x15a566(0x18d)]=_0x4a74a2[0x0][_0x15a566(0x201)],_0x181fbd[_0x17f86b][_0x15a566(0x122)]=_0x15a566(0x1ed),_0x181fbd[_0x17f86b][_0x15a566(0x13d)]='1',_0x3d5e3d['flash'](_0x15a566(0x132),_0x15a566(0x198)+_0x580d28+'\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area');break;}}else{console['log'](_0x328473[_0x15a566(0x125)]+_0x15a566(0x1c7)+_0x328473[_0x15a566(0x13d)]+_0x15a566(0x1c7)+_0x328473[_0x15a566(0x170)]+_0x15a566(0x1c7)+_0x580d28);let _0x316eae=0x0;for(let _0x1bc829=0x0;_0x1bc829<=_0x991b57[_0x15a566(0x17d)][_0x15a566(0x1b0)]-0x1&&_0x580d28>0x0;_0x1bc829++){const _0x990e40=_0x991b57[_0x15a566(0x17d)][_0x1bc829];if(_0x20093d[_0x15a566(0x125)]===_0x990e40[_0x15a566(0x125)]){_0x181fbd[_0x1bc829]={};const _0x2681d0=parseInt(_0x990e40[_0x15a566(0x10f)]),_0x25a88f=0x0;let _0x363515=_0x2681d0-_0x25a88f,_0x1f5047=Math['min'](_0x580d28,_0x363515);console['log'](_0x15a566(0x127)+_0x1f5047+_0x15a566(0x1ae)+_0x991b57[_0x15a566(0x1bc)]+_0x15a566(0x135)+_0x991b57['room']+_0x15a566(0x1ad)+_0x990e40[_0x15a566(0x13d)]+_0x15a566(0x13b)+_0x990e40[_0x15a566(0x170)]),_0x181fbd[_0x1bc829][_0x15a566(0x13c)]=_0x20093d['product_name'],_0x181fbd[_0x1bc829][_0x15a566(0x125)]=_0x20093d[_0x15a566(0x125)],_0x181fbd[_0x1bc829][_0x15a566(0x179)]=_0x20093d[_0x15a566(0x179)],_0x181fbd[_0x1bc829][_0x15a566(0x1f5)]=_0x20093d[_0x15a566(0x1f5)],_0x181fbd[_0x1bc829][_0x15a566(0x1dd)]=_0x20093d[_0x15a566(0x1dd)],_0x181fbd[_0x1bc829][_0x15a566(0x1fe)]=_0x20093d['uuid'],_0x181fbd[_0x1bc829][_0x15a566(0x19b)]=_0x1f5047,_0x181fbd[_0x1bc829][_0x15a566(0x1db)]=_0x20093d['standard_unit'],_0x181fbd[_0x1bc829]['secondary_unit']=_0x20093d['secondary_unit'],_0x181fbd[_0x1bc829][_0x15a566(0x19f)]=_0x20093d[_0x15a566(0x19f)],_0x181fbd[_0x1bc829]['secondary_code']=_0x20093d['secondary_code'],_0x181fbd[_0x1bc829]['maxStocks']=_0x20093d['maxStocks'],_0x181fbd[_0x1bc829][_0x15a566(0x1d6)]=_0x20093d[_0x15a566(0x1d6)],_0x181fbd[_0x1bc829][_0x15a566(0x21d)]=_0x20093d['expiry_date'],_0x181fbd[_0x1bc829][_0x15a566(0xea)]=_0x20093d['production_date'],_0x181fbd[_0x1bc829][_0x15a566(0x1d9)]=_0x20093d[_0x15a566(0x1d9)],_0x181fbd[_0x1bc829]['product_cat']=_0x20093d[_0x15a566(0x100)],_0x181fbd[_0x1bc829][_0x15a566(0x10a)]=_0x20093d[_0x15a566(0x10a)],_0x181fbd[_0x1bc829]['gross_price']=_0x20093d[_0x15a566(0xf1)],_0x181fbd[_0x1bc829][_0x15a566(0x18d)]=_0x991b57[_0x15a566(0x201)],_0x181fbd[_0x1bc829][_0x15a566(0x122)]=_0x990e40['bay'],_0x181fbd[_0x1bc829][_0x15a566(0x13d)]=_0x990e40[_0x15a566(0x170)],_0x580d28-=_0x1f5047;if(_0x580d28<=0x0)break;_0x316eae++;}}if(_0x580d28<=0x0){console[_0x15a566(0x195)]('There\x20is\x20'+_0x580d28+_0x15a566(0x1ca));break;}if(_0x580d28>0x0){const _0x409695=await warehouse[_0x15a566(0x185)]([{'$match':{'name':_0x33fd92,'isStaging':'true'}}]);_0x181fbd[_0x316eae]={},_0x181fbd[_0x316eae][_0x15a566(0x13c)]=_0x20093d[_0x15a566(0x13c)],_0x181fbd[_0x316eae]['product_code']=_0x20093d['product_code'],_0x181fbd[_0x316eae][_0x15a566(0x179)]=_0x20093d[_0x15a566(0x179)],_0x181fbd[_0x316eae][_0x15a566(0x1f5)]=_0x20093d[_0x15a566(0x1f5)],_0x181fbd[_0x316eae][_0x15a566(0x1dd)]=_0x20093d[_0x15a566(0x1dd)],_0x181fbd[_0x316eae][_0x15a566(0x1fe)]=_0x20093d[_0x15a566(0x1fe)],_0x181fbd[_0x316eae][_0x15a566(0x19b)]=_0x580d28,_0x181fbd[_0x316eae][_0x15a566(0x1db)]=_0x20093d['standard_unit'],_0x181fbd[_0x316eae]['secondary_unit']=_0x20093d[_0x15a566(0x1e6)],_0x181fbd[_0x316eae][_0x15a566(0x19f)]=_0x20093d[_0x15a566(0x19f)],_0x181fbd[_0x316eae][_0x15a566(0x1b6)]=_0x20093d[_0x15a566(0x1b6)],_0x181fbd[_0x316eae]['maxStocks']=_0x20093d[_0x15a566(0x11a)],_0x181fbd[_0x316eae]['batch_code']=_0x20093d['batch_code'],_0x181fbd[_0x316eae][_0x15a566(0x21d)]=_0x20093d[_0x15a566(0x21d)],_0x181fbd[_0x316eae][_0x15a566(0xea)]=_0x20093d[_0x15a566(0xea)],_0x181fbd[_0x316eae][_0x15a566(0x1d9)]=_0x20093d[_0x15a566(0x1d9)],_0x181fbd[_0x316eae]['product_cat']=_0x20093d[_0x15a566(0x100)],_0x181fbd[_0x316eae][_0x15a566(0x10a)]=_0x20093d[_0x15a566(0x10a)],_0x181fbd[_0x316eae]['gross_price']=_0x20093d['gross_price'],_0x181fbd[_0x316eae][_0x15a566(0x18d)]=_0x409695[0x0][_0x15a566(0x201)],_0x181fbd[_0x316eae][_0x15a566(0x122)]='STAGING',_0x181fbd[_0x316eae][_0x15a566(0x13d)]='1',_0x3d5e3d[_0x15a566(0x215)](_0x15a566(0x132),_0x15a566(0x198)+_0x580d28+_0x15a566(0x191));}}}}}}const _0x2444d2=_0x181fbd[_0x15a566(0x181)](_0x5aff82=>_0x5aff82['quantity']!=='0'&&_0x5aff82[_0x15a566(0x19b)]!==''),_0x3789dc=new purchases_finished({'invoice':_0x15a566(0x202)+_0xbbbf3a[_0x15a566(0x192)][_0x15a566(0x1bb)]()[_0x15a566(0x1d4)](0x8,'0'),'suppliers':_0x406889,'date':_0x4b6340,'warehouse_name':_0x33fd92,'product':_0x2444d2,'note':_0x2518b4,'due_amount':_0x549c2f,'room':_0x14ce0d,'POnumber':_0xbd35e5,'SCRN':_0x3312c5,'JO_number':_0x316a1f,'ReqBy':_0x3d4338,'dateofreq':_0x59e6f5,'typeservicesData':_0x2fb9dd,'van':_0x3a2fa2,'typevehicle':_0x187d20,'driver':_0x299aeb,'plate':_0x4f4ac0,'DRSI':_0x31defd,'TSU':_0x4f3146,'TFU':_0x545a0e,'typeOfProducts':_0x5d0ab3}),_0x2cb821=await _0x3789dc[_0x15a566(0x1aa)](),_0x23b267=await purchases_finished[_0x15a566(0x103)]({'_id':_0x2cb821[_0x15a566(0x15e)][_0x15a566(0x16d)]()});_0x3d5e3d[_0x15a566(0x215)](_0x15a566(0x14b),'purchase\x20data\x20add\x20successfully'),_0x272e31[_0x15a566(0x1e5)](_0x15a566(0x13e)+_0x23b267[_0x15a566(0x15e)][_0x15a566(0x16d)]());}catch(_0x27c41d){console[_0x15a566(0x195)](_0x27c41d);}}),router['get'](a0_0x2a53dd(0x168),auth,async(_0x570608,_0x27aaf8)=>{var _0x515bc7=a0_0x2a53dd;try{const {username:_0x4dae10,email:_0x1b3d12,role:_0x2a6653}=_0x570608[_0x515bc7(0x136)],_0x5a1fdc=_0x570608[_0x515bc7(0x136)],_0x6a424=_0x570608[_0x515bc7(0x1bd)]['id'],_0xcd4d5d=await profile['findOne']({'email':_0x5a1fdc[_0x515bc7(0x1a2)]}),_0x1ad722=await master_shop['find'](),_0xf79f53=await staff[_0x515bc7(0x103)]({'email':_0x5a1fdc[_0x515bc7(0x1a2)]}),_0x4f721e=await suppliers[_0x515bc7(0x137)]({});let _0x35d3ae;if(_0x5a1fdc['role']=='staff'){const _0x34cc75=await staff[_0x515bc7(0x103)]({'email':_0x5a1fdc[_0x515bc7(0x1a2)]});_0x35d3ae=await warehouse[_0x515bc7(0x185)]([{'$match':{'status':_0x515bc7(0x1da),'name':_0x34cc75['warehouse']}},{'$group':{'_id':_0x515bc7(0x140),'name':{'$first':_0x515bc7(0x140)}}}]);}else _0x35d3ae=await warehouse[_0x515bc7(0x185)]([{'$match':{'status':_0x515bc7(0x1da)}},{'$group':{'_id':'$name','name':{'$first':_0x515bc7(0x140)}}}]);const _0x3ae9df=await purchases_finished[_0x515bc7(0x1a0)](_0x6a424);if(_0x1ad722[0x0][_0x515bc7(0x190)]==_0x515bc7(0x1d2))var _0xaec6e2=users['English'];else{if(_0x1ad722[0x0][_0x515bc7(0x190)]=='Hindi')var _0xaec6e2=users['Hindi'];else{if(_0x1ad722[0x0][_0x515bc7(0x190)]==_0x515bc7(0x1c9))var _0xaec6e2=users[_0x515bc7(0x1c9)];else{if(_0x1ad722[0x0]['language']==_0x515bc7(0x221))var _0xaec6e2=users[_0x515bc7(0x221)];else{if(_0x1ad722[0x0][_0x515bc7(0x190)]==_0x515bc7(0x102))var _0xaec6e2=users[_0x515bc7(0x102)];else{if(_0x1ad722[0x0][_0x515bc7(0x190)]==_0x515bc7(0x20e))var _0xaec6e2=users[_0x515bc7(0xfa)];else{if(_0x1ad722[0x0]['language']=='Chinese')var _0xaec6e2=users[_0x515bc7(0x21e)];else{if(_0x1ad722[0x0][_0x515bc7(0x190)]==_0x515bc7(0x228))var _0xaec6e2=users[_0x515bc7(0x222)];}}}}}}}_0x27aaf8['render'](_0x515bc7(0x1df),{'success':_0x570608['flash'](_0x515bc7(0x14b)),'errors':_0x570608[_0x515bc7(0x215)](_0x515bc7(0x132)),'role':_0x5a1fdc,'profile':_0xcd4d5d,'suppliers':_0x4f721e,'warehouse':_0x35d3ae,'master_shop':_0x1ad722,'language':_0xaec6e2,'purchases_data':_0x3ae9df});}catch(_0x33e906){console['log'](_0x33e906);}});async function get_warehouse_data(_0x121eac,_0x13481c){var _0x5e4c55=a0_0x2a53dd;try{const _0x58a979=await warehouse_temporary[_0x5e4c55(0x103)]({'name':_0x121eac,'room':_0x13481c});if(!_0x58a979){const _0x135ff3=new warehouse_temporary({'name':_0x121eac,'address':_0x121eac,'status':_0x5e4c55(0x1da),'room':_0x13481c,'isStaging':_0x5e4c55(0x15f)});return await _0x135ff3[_0x5e4c55(0x1aa)](),_0x135ff3;}else return _0x58a979;}catch(_0x3b8865){console[_0x5e4c55(0x184)](_0x5e4c55(0x194),_0x3b8865);throw _0x3b8865;}}router[a0_0x2a53dd(0x1ee)](a0_0x2a53dd(0x168),auth,async(_0x4d062a,_0x53771c)=>{var _0xe1408e=a0_0x2a53dd;try{const _0x5926b9=_0x4d062a[_0xe1408e(0x1bd)]['id'],_0x4464b3=await purchases_finished['findById'](_0x5926b9);let _0x2ff542=[];_0x4464b3[_0xe1408e(0x174)][_0xe1408e(0x15a)]((_0x4d23bc,_0x532b89)=>{var _0x33143f=_0xe1408e;_0x2ff542[_0x532b89]={},_0x2ff542[_0x532b89]['warehouse']=_0x4464b3[_0x33143f(0x1bc)],_0x2ff542[_0x532b89]['product_id']=_0x4d23bc[_0x33143f(0x179)],_0x2ff542[_0x532b89][_0x33143f(0x13c)]=_0x4d23bc['product_name'],_0x2ff542[_0x532b89]['product_code']=_0x4d23bc[_0x33143f(0x125)],_0x2ff542[_0x532b89][_0x33143f(0x1eb)]=_0x4d23bc[_0x33143f(0x19b)],_0x2ff542[_0x532b89][_0x33143f(0x208)]=_0x4d23bc[_0x33143f(0x1db)],_0x2ff542[_0x532b89][_0x33143f(0x1e6)]=_0x4d23bc[_0x33143f(0x1e6)],_0x2ff542[_0x532b89][_0x33143f(0x122)]=_0x4d23bc[_0x33143f(0x122)],_0x2ff542[_0x532b89][_0x33143f(0x13d)]=_0x4d23bc[_0x33143f(0x13d)],_0x2ff542[_0x532b89]['primary_code']=_0x4d23bc[_0x33143f(0x19f)],_0x2ff542[_0x532b89]['secondary_code']=_0x4d23bc[_0x33143f(0x1b6)],_0x2ff542[_0x532b89]['maxStocks']=_0x4d23bc['maxStocks'],_0x2ff542[_0x532b89][_0x33143f(0x1d6)]=_0x4d23bc['batch_code'],_0x2ff542[_0x532b89][_0x33143f(0x21d)]=_0x4d23bc['expiry_date'],_0x2ff542[_0x532b89][_0x33143f(0xea)]=_0x4d23bc[_0x33143f(0xea)],_0x2ff542[_0x532b89][_0x33143f(0x1d9)]=_0x4d23bc[_0x33143f(0x1d9)],_0x2ff542[_0x532b89][_0x33143f(0x100)]=_0x4d23bc[_0x33143f(0x100)],_0x2ff542[_0x532b89][_0x33143f(0x18d)]=_0x4d23bc[_0x33143f(0x18d)],_0x2ff542[_0x532b89][_0x33143f(0x10a)]=_0x4d23bc['invoice'],_0x2ff542[_0x532b89]['uuid']=_0x4d23bc[_0x33143f(0x1fe)],_0x2ff542[_0x532b89][_0x33143f(0xf1)]=_0x4d23bc[_0x33143f(0xf1)],_0x2ff542[_0x532b89]['sales_category']=_0x4d23bc[_0x33143f(0x1dd)],_0x2ff542[_0x532b89]['date_recieved']=_0x4d23bc['date_recieved'],_0x2ff542[_0x532b89][_0x33143f(0x213)]=_0x4d23bc[_0x33143f(0x15e)][_0x33143f(0x16d)](),_0x2ff542[_0x532b89][_0x33143f(0x1cd)]=_0x33143f(0x1d0),_0x2ff542[_0x532b89][_0x33143f(0x115)]='true',_0x2ff542[_0x532b89]['isUsed']=_0x33143f(0x15f);});for(let _0x50c4ac=0x0;_0x50c4ac<=_0x2ff542[_0xe1408e(0x1b0)]-0x1;_0x50c4ac++){const _0x47fcfd=_0x2ff542[_0x50c4ac],_0x5bc578=new warehouse_temporary(_0x47fcfd);await _0x5bc578[_0xe1408e(0x1aa)]();}_0x4464b3[_0xe1408e(0x22a)]=_0xe1408e(0xf0),await _0x4464b3[_0xe1408e(0x1aa)](),_0x4d062a['flash'](_0xe1408e(0x14b),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x53771c[_0xe1408e(0x1e5)](_0xe1408e(0x13e)+_0x4464b3[_0xe1408e(0x15e)][_0xe1408e(0x16d)]());}catch(_0x4e15a1){}}),router['post'](a0_0x2a53dd(0xf2),auth,async(_0x2c05e4,_0x33b50c)=>{var _0x2a2ef1=a0_0x2a53dd;try{const {invoice:_0x49c0bd,date:_0x2a498d,warehouse_name:_0x3af597,prod_name:_0x416d7c,note:_0x54f38e,due_amount:_0x506854,Room_name:_0x208e6b,PO_number:_0x427c38,SCRN:_0x29a70b,ReqBy:_0x30517e,dateofreq:_0x541236,suppliers:_0x18d5b9,typeservicesData:_0x265bf7,van:_0x541fe7,typevehicle:_0x527c50,driver:_0x349858,plate:_0x71e826,DRSI:_0xf2d29f,TSU:_0x50ee96,TFU:_0x2c0077,JO_number:_0x495921,type_of_products:_0x5c7edf}=_0x2c05e4['body'];if(typeof _0x416d7c==_0x2a2ef1(0x157))var _0x321e14=[_0x2c05e4['body']['prod_name']],_0x25d309=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1d8)]],_0x2bda83=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x164)]],_0x374268=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0xf7)]],_0x2ae423=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x186)]],_0x4ab29d=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x199)]],_0x1b9fbb=[_0x2c05e4['body'][_0x2a2ef1(0x19f)]],_0x1bfe02=[_0x2c05e4[_0x2a2ef1(0x1b7)]['secondary_code']],_0xc1a386=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1ef)]],_0x5664f4=[_0x2c05e4[_0x2a2ef1(0x1b7)]['batch_code']],_0x1e0b6e=[_0x2c05e4['body'][_0x2a2ef1(0x21d)]],_0x304998=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x112)]],_0x8495b1=[_0x2c05e4['body']['max_product_unit']],_0x1aa22e=[_0x2c05e4['body']['prod_cat']],_0x48eb7f=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x18c)]],_0x1aa1da=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0xf1)]],_0x1e2e7d=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1fe)]],_0x43e11a=[_0x2c05e4['body'][_0x2a2ef1(0xec)]],_0x26a6fa=[_0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x163)]];else var _0x321e14=[..._0x2c05e4['body']['prod_name']],_0x25d309=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1d8)]],_0x2bda83=[..._0x2c05e4[_0x2a2ef1(0x1b7)]['prod_Qty']],_0x374268=[..._0x2c05e4[_0x2a2ef1(0x1b7)]['prod_primunit']],_0x2ae423=[..._0x2c05e4['body'][_0x2a2ef1(0x186)]],_0x4ab29d=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x199)]],_0x1b9fbb=[..._0x2c05e4['body']['primary_code']],_0x1bfe02=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1b6)]],_0xc1a386=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1ef)]],_0x5664f4=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1d6)]],_0x1e0b6e=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x21d)]],_0x304998=[..._0x2c05e4['body'][_0x2a2ef1(0x112)]],_0x8495b1=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x17c)]],_0x1aa22e=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x19a)]],_0x48eb7f=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x18c)]],_0x1aa1da=[..._0x2c05e4[_0x2a2ef1(0x1b7)]['gross_price']],_0x1e2e7d=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x1fe)]],_0x43e11a=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0xec)]],_0x26a6fa=[..._0x2c05e4[_0x2a2ef1(0x1b7)][_0x2a2ef1(0x163)]];const _0x4d10ee=_0x321e14[_0x2a2ef1(0x210)](_0x5df5a0=>{return _0x5df5a0={'product_name':_0x5df5a0};});_0x26a6fa[_0x2a2ef1(0x15a)]((_0x4593a7,_0x2ef0f7)=>{var _0x13f3da=_0x2a2ef1;_0x4d10ee[_0x2ef0f7][_0x13f3da(0x1cf)]=_0x4593a7;}),_0x43e11a[_0x2a2ef1(0x15a)]((_0x28c048,_0x954505)=>{var _0x17e8e5=_0x2a2ef1;_0x4d10ee[_0x954505][_0x17e8e5(0x1dd)]=_0x28c048;}),_0x25d309['forEach']((_0xff54b0,_0x55dc9c)=>{var _0x52f697=_0x2a2ef1;_0x4d10ee[_0x55dc9c][_0x52f697(0x125)]=_0xff54b0;}),_0x1e2e7d[_0x2a2ef1(0x15a)]((_0x55cf3b,_0x2fddfc)=>{var _0x224422=_0x2a2ef1;_0x4d10ee[_0x2fddfc][_0x224422(0x1fe)]=_0x55cf3b;}),_0x2bda83['forEach']((_0x46dd31,_0x47d522)=>{var _0x421cd0=_0x2a2ef1;_0x4d10ee[_0x47d522][_0x421cd0(0x19b)]=Math['abs'](_0x46dd31);}),_0x374268[_0x2a2ef1(0x15a)]((_0x1bd55e,_0x3f0469)=>{var _0x7735d2=_0x2a2ef1;_0x4d10ee[_0x3f0469][_0x7735d2(0x1db)]=_0x1bd55e;}),_0x2ae423['forEach']((_0x4cee51,_0x25c574)=>{_0x4d10ee[_0x25c574]['secondary_unit']=_0x4cee51;}),_0x4ab29d[_0x2a2ef1(0x15a)]((_0x57842b,_0x592cf3)=>{var _0x75fee3=_0x2a2ef1,_0x478177=_0x57842b[_0x75fee3(0x106)](/[A-Za-z]+/)[0x0],_0x143ec3=parseInt(_0x57842b[_0x75fee3(0x106)](/\d+/)[0x0]);_0x4d10ee[_0x592cf3][_0x75fee3(0x122)]=_0x478177,_0x4d10ee[_0x592cf3]['bay']=_0x143ec3;}),_0x1b9fbb[_0x2a2ef1(0x15a)]((_0x55af1f,_0x1cd7eb)=>{var _0x4b18cb=_0x2a2ef1;_0x4d10ee[_0x1cd7eb][_0x4b18cb(0x19f)]=_0x55af1f;}),_0x1bfe02[_0x2a2ef1(0x15a)]((_0x125da2,_0x4fa7de)=>{var _0x38fd66=_0x2a2ef1;_0x4d10ee[_0x4fa7de][_0x38fd66(0x1b6)]=_0x125da2;}),_0xc1a386['forEach']((_0x9f8123,_0xced8e7)=>{var _0x2998d3=_0x2a2ef1;_0x4d10ee[_0xced8e7][_0x2998d3(0x11a)]=_0x9f8123;}),_0x5664f4[_0x2a2ef1(0x15a)]((_0x3afd8,_0x5c1974)=>{var _0x24a648=_0x2a2ef1;_0x4d10ee[_0x5c1974][_0x24a648(0x1d6)]=_0x3afd8;}),_0x1e0b6e[_0x2a2ef1(0x15a)]((_0x2d2b5c,_0x49587f)=>{var _0x10d9d7=_0x2a2ef1;_0x4d10ee[_0x49587f][_0x10d9d7(0x21d)]=_0x2d2b5c;}),_0x304998['forEach']((_0x321be3,_0x45ddad)=>{var _0xb8fe5e=_0x2a2ef1;_0x4d10ee[_0x45ddad][_0xb8fe5e(0xea)]=_0x321be3;}),_0x8495b1[_0x2a2ef1(0x15a)]((_0x4e6432,_0x42a4cb)=>{var _0x2570d3=_0x2a2ef1;_0x4d10ee[_0x42a4cb][_0x2570d3(0x1d9)]=_0x4e6432;}),_0x1aa22e[_0x2a2ef1(0x15a)]((_0x456964,_0x5f37fa)=>{var _0x457824=_0x2a2ef1;_0x4d10ee[_0x5f37fa][_0x457824(0x100)]=_0x456964;}),_0x48eb7f[_0x2a2ef1(0x15a)]((_0x2a2af9,_0x463e50)=>{var _0x5bf872=_0x2a2ef1;_0x4d10ee[_0x463e50][_0x5bf872(0x18d)]=_0x2a2af9;}),_0x1aa1da[_0x2a2ef1(0x15a)]((_0x105569,_0x4248cb)=>{var _0x32574a=_0x2a2ef1;_0x4d10ee[_0x4248cb][_0x32574a(0xf1)]=_0x105569;});const _0x5dab29=new purchases_logs();await _0x5dab29['save']();for(let _0x29332d=0x0;_0x29332d<=_0x48eb7f[_0x2a2ef1(0x1b0)]-0x1;_0x29332d++){_0x4d10ee[_0x29332d][_0x2a2ef1(0x10a)]=_0x2a2ef1(0x1a5)+_0x5dab29[_0x2a2ef1(0x192)][_0x2a2ef1(0x1bb)]()[_0x2a2ef1(0x1d4)](0x8,'0');}const _0x500291=_0x4d10ee[_0x2a2ef1(0x181)](_0x168940=>_0x168940[_0x2a2ef1(0x19b)]!=='0'&&_0x168940[_0x2a2ef1(0x19b)]!==''),_0x42bb10=new purchases_finished({'invoice':_0x2a2ef1(0x1a5)+_0x5dab29[_0x2a2ef1(0x192)]['toString']()[_0x2a2ef1(0x1d4)](0x8,'0'),'suppliers':_0x18d5b9,'date':_0x2a498d,'warehouse_name':_0x3af597,'product':_0x500291,'note':_0x54f38e,'due_amount':_0x506854,'room':_0x208e6b,'POnumber':_0x427c38,'SCRN':_0x29a70b,'JO_number':_0x495921,'ReqBy':_0x30517e,'dateofreq':_0x541236,'typeservicesData':_0x265bf7,'van':_0x541fe7,'typevehicle':_0x527c50,'driver':_0x349858,'plate':_0x71e826,'DRSI':_0xf2d29f,'TSU':_0x50ee96,'TFU':_0x2c0077,'typeOfProducts':_0x5c7edf}),_0x366708=await _0x42bb10[_0x2a2ef1(0x1aa)](),_0x60041c=await purchases_finished[_0x2a2ef1(0x103)]({'_id':_0x366708[_0x2a2ef1(0x15e)]['valueOf']()}),_0x3dab18=_0x60041c[_0x2a2ef1(0x174)][_0x2a2ef1(0x210)](async _0x3aa8ba=>{var _0xb9e2f1=_0x2a2ef1;try{var _0x196144=await warehouse[_0xb9e2f1(0x103)]({'name':_0x3af597,'room':_0x3aa8ba[_0xb9e2f1(0x18d)]}),_0x15002e=0x0;const _0x146e2e=_0x196144[_0xb9e2f1(0x177)][_0xb9e2f1(0x210)](_0x42382c=>{var _0x4f1c6f=_0xb9e2f1;console[_0x4f1c6f(0x195)](_0x42382c[_0x4f1c6f(0x13c)]+'=='+_0x3aa8ba[_0x4f1c6f(0x13c)]+'&&'+_0x42382c[_0x4f1c6f(0x13d)]+'=='+_0x3aa8ba[_0x4f1c6f(0x13d)]+'&&'+_0x42382c[_0x4f1c6f(0x21d)]+'=='+_0x3aa8ba[_0x4f1c6f(0x21d)]+'&&'+_0x42382c[_0x4f1c6f(0xea)]+'=='+_0x3aa8ba['production_date']+'&&'+_0x42382c[_0x4f1c6f(0x1d6)]+'=='+_0x3aa8ba[_0x4f1c6f(0x1d6)]+'&&'+_0x42382c[_0x4f1c6f(0x10a)]+'=='+_0x60041c[_0x4f1c6f(0x10a)]),_0x42382c[_0x4f1c6f(0x13c)]==_0x3aa8ba[_0x4f1c6f(0x13c)]&&_0x42382c[_0x4f1c6f(0x13d)]==_0x3aa8ba[_0x4f1c6f(0x13d)]&&_0x42382c[_0x4f1c6f(0x122)]==_0x3aa8ba[_0x4f1c6f(0x122)]&&_0x42382c['expiry_date']==_0x3aa8ba[_0x4f1c6f(0x21d)]&&_0x42382c[_0x4f1c6f(0xea)]==_0x3aa8ba[_0x4f1c6f(0xea)]&&_0x42382c[_0x4f1c6f(0x1d6)]==_0x3aa8ba[_0x4f1c6f(0x1d6)]&&_0x42382c['invoice']==_0x60041c['invoice']&&(_0x42382c[_0x4f1c6f(0x1eb)]=Math[_0x4f1c6f(0x17f)](_0x42382c[_0x4f1c6f(0x1eb)])+Math['abs'](_0x3aa8ba[_0x4f1c6f(0x19b)]),_0x15002e++);});return _0x15002e==0x0&&(_0x196144[_0xb9e2f1(0x177)]=_0x196144[_0xb9e2f1(0x177)][_0xb9e2f1(0x1af)]({'product_name':_0x3aa8ba[_0xb9e2f1(0x13c)],'product_stock':Math[_0xb9e2f1(0x17f)](_0x3aa8ba[_0xb9e2f1(0x19b)]),'primary_code':_0x3aa8ba[_0xb9e2f1(0x19f)],'secondary_code':_0x3aa8ba['secondary_code'],'product_code':_0x3aa8ba[_0xb9e2f1(0x125)],'bay':_0x3aa8ba[_0xb9e2f1(0x13d)],'level':_0x3aa8ba['level'],'maxProducts':_0x3aa8ba[_0xb9e2f1(0x11a)],'unit':_0x3aa8ba[_0xb9e2f1(0x1db)],'secondary_unit':_0x3aa8ba[_0xb9e2f1(0x1e6)],'expiry_date':_0x3aa8ba[_0xb9e2f1(0x21d)],'production_date':_0x3aa8ba[_0xb9e2f1(0xea)],'maxProducts':_0x3aa8ba[_0xb9e2f1(0x11a)],'maxPerUnit':_0x3aa8ba[_0xb9e2f1(0x1d9)],'batch_code':_0x3aa8ba[_0xb9e2f1(0x1d6)],'product_cat':_0x3aa8ba[_0xb9e2f1(0x100)],'invoice':_0x3aa8ba[_0xb9e2f1(0x10a)],'id_incoming':_0x3aa8ba[_0xb9e2f1(0x15e)],'uuid':_0x3aa8ba[_0xb9e2f1(0x1fe)],'gross_price':_0x3aa8ba[_0xb9e2f1(0xf1)],'sales_category':_0x3aa8ba['sales_category'],'type_products':_0x3aa8ba[_0xb9e2f1(0x1cf)]})),_0x196144;}catch(_0x186fc9){return console[_0xb9e2f1(0x184)]('Error\x20occurred\x20while\x20processing\x20product:',_0x186fc9),null;}});Promise[_0x2a2ef1(0x1e1)](_0x3dab18)[_0x2a2ef1(0x20b)](async _0x3867e2=>{var _0x1e1af7=_0x2a2ef1;try{for(const _0x5590c7 of _0x3867e2){await warehouse[_0x1e1af7(0x1c2)]({'_id':_0x5590c7[_0x1e1af7(0x15e)]},{'$addToSet':{'product_details':{'$each':_0x5590c7[_0x1e1af7(0x177)]}}});}const _0x1f8bca=await master_shop[_0x1e1af7(0x137)](),_0x163f51=await email_settings[_0x1e1af7(0x103)](),_0xd3cb23=await supervisor_settings[_0x1e1af7(0x137)]();var _0x1096bd=_0x60041c[_0x1e1af7(0x174)],_0x34daef='',_0x3b8020;for(_0x3b8020 in _0x1096bd){var _0xe99c52='FG';_0x60041c[_0x1e1af7(0x1bc)]==_0x1e1af7(0x141)&&(_0xe99c52='DG'),_0x34daef+=_0x1e1af7(0x18b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1096bd[_0x3b8020][_0x1e1af7(0x13c)]+_0x1e1af7(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1096bd[_0x3b8020][_0x1e1af7(0x125)]+_0x1e1af7(0x1e2)+_0x1e1af7(0x20c)+_0x1096bd[_0x3b8020][_0x1e1af7(0x19b)]+_0x1e1af7(0x1e2)+_0x1e1af7(0x20c)+_0x1096bd[_0x3b8020][_0x1e1af7(0x1db)]+_0x1e1af7(0x1e2)+_0x1e1af7(0x20c)+_0x1096bd[_0x3b8020][_0x1e1af7(0x1e6)]+_0x1e1af7(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x60041c[_0x1e1af7(0x1bc)]+'</td>'+_0x1e1af7(0x20c)+_0x1096bd[_0x3b8020][_0x1e1af7(0x18d)]+_0x1e1af7(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xe99c52+_0x1096bd[_0x3b8020][_0x1e1af7(0x13d)]+_0x1e1af7(0x1e2),_0x1e1af7(0xe7);}let _0x3e669b=nodemailer[_0x1e1af7(0xef)]({'host':_0x163f51[_0x1e1af7(0x1e9)],'port':Number(_0x163f51['port']),'secure':![],'auth':{'user':_0x163f51['email'],'pass':_0x163f51[_0x1e1af7(0x20a)]}}),_0x422e2a={'from':_0x163f51[_0x1e1af7(0x1a2)],'to':_0xd3cb23[0x0][_0x1e1af7(0x120)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x1e1af7(0x1be)+_0x1f8bca[0x0]['image'],'cid':_0x1e1af7(0x159)}],'html':_0x1e1af7(0xee)+'<html><head><title></title>'+'</head><body>'+_0x1e1af7(0x169)+_0x1e1af7(0x212)+_0x1e1af7(0x169)+_0x1e1af7(0x12c)+_0x1e1af7(0x1a4)+_0x1e1af7(0x169)+_0x1e1af7(0x19c)+_0x1f8bca[0x0][_0x1e1af7(0x214)]+_0x1e1af7(0x138)+_0x1e1af7(0x1a4)+_0x1e1af7(0x1a4)+_0x1e1af7(0x211)+_0x1e1af7(0x169)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1e1af7(0x225)+_0x60041c[_0x1e1af7(0x10a)]+'\x20'+_0x1e1af7(0x12f)+_0x1e1af7(0x119)+_0x60041c['date']+'\x20'+_0x1e1af7(0x183)+'</h5>'+_0x1e1af7(0x1a4)+_0x1e1af7(0x171)+_0x1e1af7(0x17e)+'<tr>'+_0x1e1af7(0x21f)+_0x1e1af7(0x165)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1e1af7(0x1f4)+_0x1e1af7(0x1f0)+_0x1e1af7(0xe8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1e1af7(0xe7)+_0x1e1af7(0x14f)+_0x1e1af7(0x1f8)+'\x20'+_0x34daef+'\x20'+_0x1e1af7(0x1d5)+_0x1e1af7(0x155)+'<div>'+_0x1e1af7(0x158)+_0x1e1af7(0x1f2)+_0x1f8bca[0x0][_0x1e1af7(0x214)]+_0x1e1af7(0x1e3)+_0x1e1af7(0x1a4)+_0x1e1af7(0x1a4)+_0x1e1af7(0xe3)};_0x3e669b[_0x1e1af7(0x11b)](_0x422e2a,function(_0x163502,_0x35792f){var _0x7630c2=_0x1e1af7;_0x163502?(console[_0x7630c2(0x195)](_0x163502),console['log'](_0x7630c2(0x1cb))):console[_0x7630c2(0x195)](_0x7630c2(0x148));});}catch(_0x5a5c20){console[_0x1e1af7(0x184)](_0x5a5c20),_0x33b50c['status'](0x1f4)['json']({'error':_0x1e1af7(0x1a1),'message':_0x5a5c20[_0x1e1af7(0x1fd)]});}})[_0x2a2ef1(0x223)](_0x128502=>{var _0xf27217=_0x2a2ef1;console[_0xf27217(0x184)](_0x128502);}),_0x2c05e4[_0x2a2ef1(0x215)]('success',_0x2a2ef1(0x217)),_0x33b50c[_0x2a2ef1(0x1e5)]('/all_purchases_finished/preview/'+_0x60041c['_id'][_0x2a2ef1(0x16d)]());}catch(_0x1f36d2){console['log'](_0x1f36d2);}}),router[a0_0x2a53dd(0x219)](a0_0x2a53dd(0x124),auth,async(_0x3befa1,_0x4cd7db)=>{var _0x44e9cd=a0_0x2a53dd;try{const {username:_0x8ed63,email:_0xf2a860,role:_0x5d62cb}=_0x3befa1[_0x44e9cd(0x136)],_0x210a17=_0x3befa1['user'],_0xe5215=await profile[_0x44e9cd(0x103)]({'email':_0x210a17[_0x44e9cd(0x1a2)]}),_0xd1dc89=await master_shop[_0x44e9cd(0x137)](),_0x3044ad=_0x3befa1[_0x44e9cd(0x1bd)]['id'],_0x1e0d6d=await purchases_finished['findById'](_0x3044ad),_0x403d44=await suppliers[_0x44e9cd(0x137)]({});let _0x41b777;if(_0x210a17['role']==_0x44e9cd(0x176)){const _0x1631f8=await staff[_0x44e9cd(0x103)]({'email':_0x210a17[_0x44e9cd(0x1a2)]});_0x41b777=await warehouse[_0x44e9cd(0x137)]({'status':'Enabled','name':_0x1631f8['warehouse'],'warehouse_category':_0x44e9cd(0x172)});}else _0x41b777=await warehouse[_0x44e9cd(0x185)]([{'$match':{'status':_0x44e9cd(0x1da),'warehouse_category':_0x44e9cd(0x172)}},{'$group':{'_id':_0x44e9cd(0x140),'name':{'$first':_0x44e9cd(0x140)}}}]);const _0x53f2b0=await product[_0x44e9cd(0x137)]({}),_0x3f7598=BayBinSelected(_0x1e0d6d[_0x44e9cd(0x1bc)],_0x1e0d6d[_0x44e9cd(0x201)]);let _0x344013=new Date(_0x1e0d6d[_0x44e9cd(0x21d)]),_0x35178d=('0'+_0x344013[_0x44e9cd(0xe6)]())[_0x44e9cd(0x1ec)](-0x2),_0x166371=('0'+(_0x344013[_0x44e9cd(0x1a9)]()+0x1))[_0x44e9cd(0x1ec)](-0x2),_0x740414=_0x344013[_0x44e9cd(0x1e0)](),_0x33ffd7=_0x740414+'-'+_0x166371+'-'+_0x35178d;if(_0xd1dc89[0x0][_0x44e9cd(0x190)]==_0x44e9cd(0x1d2)){var _0x3abb92=users[_0x44e9cd(0xf8)];console[_0x44e9cd(0x195)](_0x3abb92);}else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]==_0x44e9cd(0x220))var _0x3abb92=users[_0x44e9cd(0x220)];else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]=='German')var _0x3abb92=users[_0x44e9cd(0x1c9)];else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]==_0x44e9cd(0x221))var _0x3abb92=users[_0x44e9cd(0x221)];else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]==_0x44e9cd(0x102))var _0x3abb92=users[_0x44e9cd(0x102)];else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]==_0x44e9cd(0x20e))var _0x3abb92=users[_0x44e9cd(0xfa)];else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]==_0x44e9cd(0x21e))var _0x3abb92=users[_0x44e9cd(0x21e)];else{if(_0xd1dc89[0x0][_0x44e9cd(0x190)]=='Arabic\x20(ae)')var _0x3abb92=users[_0x44e9cd(0x222)];}}}}}}}_0x4cd7db['render'](_0x44e9cd(0x200),{'success':_0x3befa1[_0x44e9cd(0x215)]('success'),'errors':_0x3befa1['flash'](_0x44e9cd(0x132)),'role':_0x210a17,'profile':_0xe5215,'purchases':_0x1e0d6d,'suppliers':_0x403d44,'warehouse':_0x41b777,'product':_0x53f2b0,'master_shop':_0xd1dc89,'language':_0x3abb92,'ed_fullDate':_0x33ffd7,'dataSelected':_0x3f7598});}catch(_0x194f1d){console[_0x44e9cd(0x195)](_0x194f1d);}}),router[a0_0x2a53dd(0x219)]('/view/:id',auth,async(_0x9ed261,_0x301996)=>{var _0x74ce9e=a0_0x2a53dd;try{const {username:_0x53558c,email:_0x4c1d95,role:_0x257ae7}=_0x9ed261[_0x74ce9e(0x136)],_0x3be577=_0x9ed261[_0x74ce9e(0x136)],_0x93c74d=await profile[_0x74ce9e(0x103)]({'email':_0x3be577[_0x74ce9e(0x1a2)]}),_0x50625f=await master_shop[_0x74ce9e(0x137)](),_0x11f2d4=_0x9ed261['params']['id'],_0x231269=await purchases_finished[_0x74ce9e(0x1a0)](_0x11f2d4),_0x2a1173=await suppliers[_0x74ce9e(0x137)]({});let _0x272b63;if(_0x3be577[_0x74ce9e(0x162)]==_0x74ce9e(0x176)){const _0x5bc224=await staff[_0x74ce9e(0x103)]({'email':_0x3be577[_0x74ce9e(0x1a2)]});_0x272b63=await warehouse['find']({'status':'Enabled','name':_0x5bc224['warehouse'],'warehouse_category':_0x74ce9e(0x172)});}else _0x272b63=await warehouse['aggregate']([{'$match':{'status':_0x74ce9e(0x1da),'warehouse_category':_0x74ce9e(0x172)}},{'$group':{'_id':_0x74ce9e(0x140),'name':{'$first':_0x74ce9e(0x140)}}}]);const _0x310e5a=await product[_0x74ce9e(0x137)]({}),_0x15c407=BayBinSelected(_0x231269['warehouse_name'],_0x231269[_0x74ce9e(0x201)]);let _0x4117f2=new Date(_0x231269[_0x74ce9e(0x21d)]),_0x38722e=('0'+_0x4117f2[_0x74ce9e(0xe6)]())['slice'](-0x2),_0x48b0b6=('0'+(_0x4117f2[_0x74ce9e(0x1a9)]()+0x1))['slice'](-0x2),_0x4e07b2=_0x4117f2[_0x74ce9e(0x1e0)](),_0x5a5a69=_0x4e07b2+'-'+_0x48b0b6+'-'+_0x38722e;if(_0x50625f[0x0][_0x74ce9e(0x190)]==_0x74ce9e(0x1d2)){var _0x49d597=users[_0x74ce9e(0xf8)];console[_0x74ce9e(0x195)](_0x49d597);}else{if(_0x50625f[0x0]['language']==_0x74ce9e(0x220))var _0x49d597=users[_0x74ce9e(0x220)];else{if(_0x50625f[0x0]['language']==_0x74ce9e(0x1c9))var _0x49d597=users[_0x74ce9e(0x1c9)];else{if(_0x50625f[0x0]['language']==_0x74ce9e(0x221))var _0x49d597=users[_0x74ce9e(0x221)];else{if(_0x50625f[0x0][_0x74ce9e(0x190)]==_0x74ce9e(0x102))var _0x49d597=users[_0x74ce9e(0x102)];else{if(_0x50625f[0x0][_0x74ce9e(0x190)]==_0x74ce9e(0x20e))var _0x49d597=users[_0x74ce9e(0xfa)];else{if(_0x50625f[0x0][_0x74ce9e(0x190)]==_0x74ce9e(0x21e))var _0x49d597=users[_0x74ce9e(0x21e)];else{if(_0x50625f[0x0]['language']=='Arabic\x20(ae)')var _0x49d597=users[_0x74ce9e(0x222)];}}}}}}}_0x301996[_0x74ce9e(0x189)](_0x74ce9e(0x144),{'success':_0x9ed261[_0x74ce9e(0x215)](_0x74ce9e(0x14b)),'errors':_0x9ed261[_0x74ce9e(0x215)](_0x74ce9e(0x132)),'role':_0x3be577,'profile':_0x93c74d,'purchases':_0x231269,'suppliers':_0x2a1173,'warehouse':_0x272b63,'product':_0x310e5a,'master_shop':_0x50625f,'language':_0x49d597,'ed_fullDate':_0x5a5a69,'dataSelected':_0x15c407});}catch(_0x5b6cc4){console[_0x74ce9e(0x195)](_0x5b6cc4);}}),router['post'](a0_0x2a53dd(0xfc),auth,async(_0x79d8ae,_0x1cfd9b)=>{var _0x33a260=a0_0x2a53dd;try{const _0x1a5f1e=_0x79d8ae[_0x33a260(0x1bd)]['id'],_0x3ab68a=await purchases_finished['findOne']({'_id':_0x79d8ae[_0x33a260(0x1bd)]['id']}),_0x342aab=await warehouse['findOne']({'name':_0x3ab68a['warehouse_name'],'room':_0x3ab68a[_0x33a260(0x201)]});_0x3ab68a[_0x33a260(0x174)][_0x33a260(0x15a)](_0x2e1624=>{var _0x135130=_0x33a260;const _0x10d0d4=_0x342aab[_0x135130(0x177)][_0x135130(0x210)](_0x1f3a66=>{var _0x5365dc=_0x135130;_0x1f3a66[_0x5365dc(0x13c)]==_0x2e1624[_0x5365dc(0x13c)]&&_0x1f3a66[_0x5365dc(0x13d)]==_0x2e1624['bay']&&(_0x1f3a66['product_stock']=parseInt(_0x1f3a66['product_stock'])-parseInt(_0x2e1624['quantity']));});}),await _0x342aab[_0x33a260(0x1aa)]();const {invoice:_0x52e334,suppliers:_0x32815c,date:_0x371b4f,warehouse_name:_0x4445fe,prod_name:_0x5c4542,prod_code:_0x5e5848,prod_qty:_0xb83fbf,prod_unit:_0x5841f1,prod_secondunit:_0x159e64,prod_level:_0x45dfe3,prod_isle:_0x7318cd,prod_pallet:_0x974b,note:_0x244657,expiry_date:_0x368ba2,batch_code:_0x283fbc,paid_amount:_0x4c6acd,due_amount:_0xf96c10,Room_name:_0x336b72,primary_code:_0x1b81f9,secondary_code:_0xd87995,PO_number:_0x1f3098,JO_number:_0x7194ac}=_0x79d8ae[_0x33a260(0x1b7)];if(typeof _0x5c4542==_0x33a260(0x157))var _0x759557=[_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x10b)]],_0x1c879a=[_0x79d8ae['body'][_0x33a260(0x1d8)]],_0x4f9752=[_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1f6)]],_0x299d0d=[_0x79d8ae['body'][_0x33a260(0x111)]],_0x11a92a=[_0x79d8ae[_0x33a260(0x1b7)]['prod_secondunit']],_0x57e90a=[_0x79d8ae['body'][_0x33a260(0x199)]],_0x2efabc=[_0x79d8ae['body'][_0x33a260(0x19f)]],_0x1eb281=[_0x79d8ae['body']['secondary_code']],_0x55d45b=[_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1ef)]],_0x3cadb7=[_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1d6)]],_0x34c6dc=[_0x79d8ae[_0x33a260(0x1b7)]['expiry_date']];else var _0x759557=[..._0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x10b)]],_0x1c879a=[..._0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1d8)]],_0x4f9752=[..._0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1f6)]],_0x299d0d=[..._0x79d8ae['body'][_0x33a260(0x111)]],_0x11a92a=[..._0x79d8ae[_0x33a260(0x1b7)]['prod_secondunit']],_0x57e90a=[..._0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x199)]],_0x2efabc=[..._0x79d8ae[_0x33a260(0x1b7)]['primary_code']],_0x1eb281=[..._0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1b6)]],_0x55d45b=[..._0x79d8ae[_0x33a260(0x1b7)]['MaxStocks_data']],_0x3cadb7=[..._0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1d6)]],_0x34c6dc=[..._0x79d8ae[_0x33a260(0x1b7)]['expiry_date']];const _0xdca5bd=_0x759557['map'](_0x24b9e0=>{return _0x24b9e0={'product_name':_0x24b9e0};});_0x1c879a['forEach']((_0x405f61,_0x257bdb)=>{var _0xc8c581=_0x33a260;_0xdca5bd[_0x257bdb][_0xc8c581(0x125)]=_0x405f61;}),_0x4f9752['forEach']((_0x49c90f,_0x10f719)=>{var _0xa864bf=_0x33a260;_0xdca5bd[_0x10f719][_0xa864bf(0x19b)]=_0x49c90f;}),_0x299d0d[_0x33a260(0x15a)]((_0xc8b10e,_0x29adc9)=>{var _0x51ef29=_0x33a260;_0xdca5bd[_0x29adc9][_0x51ef29(0x1db)]=_0xc8b10e;}),_0x11a92a['forEach']((_0x584de2,_0xd24c8f)=>{var _0x5a875b=_0x33a260;_0xdca5bd[_0xd24c8f][_0x5a875b(0x1e6)]=_0x584de2;}),_0x57e90a[_0x33a260(0x15a)]((_0x49cada,_0x4af0d1)=>{var _0x21bf50=_0x33a260;_0xdca5bd[_0x4af0d1][_0x21bf50(0x13d)]=_0x49cada;}),_0x2efabc[_0x33a260(0x15a)]((_0x55976f,_0x392be5)=>{var _0x22c22c=_0x33a260;_0xdca5bd[_0x392be5][_0x22c22c(0x19f)]=_0x55976f;}),_0x1eb281['forEach']((_0x32d108,_0xa6505f)=>{_0xdca5bd[_0xa6505f]['secondary_code']=_0x32d108;}),_0x55d45b['forEach']((_0x28ea08,_0x5ba583)=>{var _0x55f1bf=_0x33a260;_0xdca5bd[_0x5ba583][_0x55f1bf(0x11a)]=_0x28ea08;}),_0x3cadb7[_0x33a260(0x15a)]((_0x47a276,_0x93ea78)=>{_0xdca5bd[_0x93ea78]['batch_code']=_0x47a276;}),_0x34c6dc[_0x33a260(0x15a)]((_0x582662,_0x3eede0)=>{var _0xc1e7f6=_0x33a260;_0xdca5bd[_0x3eede0][_0xc1e7f6(0x21d)]=_0x582662;});const _0x1b41b9=_0xdca5bd[_0x33a260(0x181)](_0x461348=>_0x461348[_0x33a260(0x19b)]!=='0'&&_0x461348[_0x33a260(0x19b)]!=='');_0x3ab68a[_0x33a260(0x10a)]=_0x52e334,_0x3ab68a[_0x33a260(0x1a3)]=_0x32815c,_0x3ab68a[_0x33a260(0x1c3)]=_0x371b4f,_0x3ab68a[_0x33a260(0x1bc)]=_0x4445fe,_0x3ab68a['product']=_0x1b41b9,_0x3ab68a[_0x33a260(0x1c0)]=_0x244657,_0x3ab68a[_0x33a260(0x147)]=_0x4c6acd,_0x3ab68a[_0x33a260(0x19d)]=_0xf96c10,_0x3ab68a[_0x33a260(0x201)]=_0x336b72,_0x3ab68a[_0x33a260(0xff)]=_0x1f3098,_0x3ab68a['JO_number']=_0x7194ac;const _0x3f424e=await _0x3ab68a[_0x33a260(0x1aa)](),_0x12e2af=await warehouse[_0x33a260(0x103)]({'name':_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1bc)],'room':_0x79d8ae['body'][_0x33a260(0x173)]});_0x3ab68a['product'][_0x33a260(0x15a)](_0x57320f=>{var _0x2101ce=_0x33a260,_0x2bcc84=0x0;const _0x140541=_0x12e2af['product_details'][_0x2101ce(0x210)](_0x12f091=>{var _0x3f2c5f=_0x2101ce;_0x12f091[_0x3f2c5f(0x13c)]==_0x57320f['product_name']&&_0x12f091[_0x3f2c5f(0x13d)]==_0x57320f[_0x3f2c5f(0x13d)]&&(_0x12f091['product_stock']=parseInt(_0x12f091[_0x3f2c5f(0x1eb)])+parseInt(_0x57320f[_0x3f2c5f(0x19b)]),_0x2bcc84++);});_0x2bcc84=='0'&&(_0x12e2af[_0x2101ce(0x177)]=_0x12e2af[_0x2101ce(0x177)][_0x2101ce(0x1af)]({'product_name':_0x57320f['product_name'],'product_stock':_0x57320f[_0x2101ce(0x19b)],'primary_code':_0x57320f[_0x2101ce(0x19f)],'secondary_code':_0x57320f[_0x2101ce(0x1b6)],'product_code':_0x57320f[_0x2101ce(0x125)],'bay':_0x57320f['bay'],'maxProducts':_0x57320f[_0x2101ce(0x11a)],'unit':_0x57320f[_0x2101ce(0x1db)],'secondary_unit':_0x57320f[_0x2101ce(0x1e6)],'expiry_date':_0x57320f['expiry_date']}));}),await _0x12e2af[_0x33a260(0x1aa)]();const _0x282521=await s_payment_data[_0x33a260(0x103)]({'invoice':_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x10a)]});if(_0x282521===null){}else console[_0x33a260(0x195)]('suppliers',_0x282521,_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x10a)]),_0x282521[_0x33a260(0x1a3)]=_0x79d8ae[_0x33a260(0x1b7)][_0x33a260(0x1a3)],await _0x282521['save']();_0x79d8ae[_0x33a260(0x215)](_0x33a260(0x14b),'purchase\x20data\x20update\x20successfully'),_0x1cfd9b[_0x33a260(0x1e5)]('/all_purchases_finished/view');}catch(_0x4141fe){console[_0x33a260(0x195)](_0x4141fe);}}),router[a0_0x2a53dd(0x1ee)](a0_0x2a53dd(0x126),auth,async(_0x1fcc8b,_0x33ebf4)=>{var _0x39562f=a0_0x2a53dd;try{const _0x56707d=_0x1fcc8b[_0x39562f(0x1bd)]['id'],{invoice:_0x421373,suppliers:_0x3764db,payable:_0x3d8edb,due_amount:_0x33e900}=_0x1fcc8b[_0x39562f(0x1b7)],_0x1a557d=await purchases[_0x39562f(0x1a0)](_0x56707d);var _0xa0e84f=_0x3d8edb-_0x33e900;_0x1a557d[_0x39562f(0x147)]=parseFloat(_0x1a557d[_0x39562f(0x147)])+parseFloat(_0x33e900),_0x1a557d[_0x39562f(0x19d)]=_0xa0e84f;const _0x5b01d0=await _0x1a557d['save']();console[_0x39562f(0x195)](_0x5b01d0);const _0x52635d=await s_payment_data[_0x39562f(0x103)]({'invoice':_0x421373});_0x52635d[_0x39562f(0x204)]=_0xa0e84f,await _0x52635d[_0x39562f(0x1aa)]();let _0x2e7a75=new Date(),_0x3f2035=('0'+_0x2e7a75[_0x39562f(0xe6)]())[_0x39562f(0x1ec)](-0x2),_0x587cfb=('0'+(_0x2e7a75['getMonth']()+0x1))['slice'](-0x2),_0x33e44e=_0x2e7a75[_0x39562f(0x1e0)](),_0x503627=_0x33e44e+'-'+_0x587cfb+'-'+_0x3f2035;const _0x4fd022=new suppliers_payment({'invoice':_0x421373,'date':_0x33e44e+'-'+_0x587cfb+'-'+_0x3f2035,'suppliers':_0x3764db,'reason':'Paid\x20For\x20Purchase','amount':_0x33e900}),_0x20a63e=await _0x4fd022['save']();_0x1fcc8b[_0x39562f(0x215)](_0x39562f(0x14b),_0x39562f(0x1f1)),_0x33ebf4[_0x39562f(0x1e5)](_0x39562f(0x139));}catch(_0x4a046a){console[_0x39562f(0x195)](_0x4a046a);}}),router[a0_0x2a53dd(0x219)](a0_0x2a53dd(0x1ab),auth,async(_0x16f088,_0x273d88)=>{var _0x493103=a0_0x2a53dd;try{const {username:_0x20c68b,email:_0x3183c0,role:_0x5ef6ff}=_0x16f088[_0x493103(0x136)],_0x43b355=_0x16f088[_0x493103(0x136)],_0x2ab5f2=await profile[_0x493103(0x103)]({'email':_0x43b355[_0x493103(0x1a2)]}),_0x23b188=await master_shop[_0x493103(0x137)]();console[_0x493103(0x195)]('master',_0x23b188);const _0x26bd3d=_0x16f088[_0x493103(0x1bd)]['id'],_0x4b0c7d=await purchases[_0x493103(0x1a0)](_0x26bd3d);console['log'](_0x4b0c7d);const _0x5d69bc=await suppliers['findOne']({'name':_0x4b0c7d[_0x493103(0x1a3)]});console[_0x493103(0x195)](_0x5d69bc);if(_0x23b188[0x0][_0x493103(0x190)]==_0x493103(0x1d2)){var _0x57f99e=users['English'];console[_0x493103(0x195)](_0x57f99e);}else{if(_0x23b188[0x0][_0x493103(0x190)]==_0x493103(0x220))var _0x57f99e=users['Hindi'];else{if(_0x23b188[0x0]['language']==_0x493103(0x1c9))var _0x57f99e=users[_0x493103(0x1c9)];else{if(_0x23b188[0x0]['language']=='Spanish')var _0x57f99e=users[_0x493103(0x221)];else{if(_0x23b188[0x0][_0x493103(0x190)]==_0x493103(0x102))var _0x57f99e=users[_0x493103(0x102)];else{if(_0x23b188[0x0][_0x493103(0x190)]==_0x493103(0x20e))var _0x57f99e=users[_0x493103(0xfa)];else{if(_0x23b188[0x0][_0x493103(0x190)]=='Chinese')var _0x57f99e=users[_0x493103(0x21e)];else{if(_0x23b188[0x0][_0x493103(0x190)]=='Arabic\x20(ae)')var _0x57f99e=users[_0x493103(0x222)];}}}}}}}_0x273d88['render']('purchase_invoice',{'success':_0x16f088[_0x493103(0x215)](_0x493103(0x14b)),'errors':_0x16f088[_0x493103(0x215)](_0x493103(0x132)),'role':_0x43b355,'profile':_0x2ab5f2,'master_shop':_0x23b188,'supplier':_0x5d69bc,'purchase':_0x4b0c7d,'language':_0x57f99e});}catch(_0x59afcd){console['log'](_0x59afcd);}}),router['get'](a0_0x2a53dd(0x108),auth,async(_0x594f6b,_0x4f919e)=>{var _0x42be88=a0_0x2a53dd;try{const {username:_0x6b2e8c,email:_0x37a4c4,role:_0x35a34a}=_0x594f6b[_0x42be88(0x136)],_0x14051f=_0x594f6b[_0x42be88(0x136)],_0x56e847=await profile[_0x42be88(0x103)]({'email':_0x14051f['email']}),_0x3339ed=await master_shop[_0x42be88(0x137)]();console['log']('master',_0x3339ed);const _0x118070=_0x594f6b[_0x42be88(0x1bd)]['id'];console[_0x42be88(0x195)](_0x118070);const _0x1428ee=await purchases_finished[_0x42be88(0x1a0)](_0x118070);console[_0x42be88(0x195)](_0x42be88(0x123),_0x1428ee);const _0x549bd9=await product['find']({}),_0x4ffd84=await warehouse[_0x42be88(0x185)]([{'$match':{'name':_0x1428ee[_0x42be88(0x1bc)],'room':_0x1428ee['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x42be88(0x117),'name':{'$first':_0x42be88(0x116)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x42be88(0x1a8)},'bin':{'$first':_0x42be88(0x18a)},'type':{'$first':_0x42be88(0x110)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x42be88(0x1c1)},'product_code':{'$first':_0x42be88(0x229)},'storage':{'$first':_0x42be88(0xf6)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x42be88(0x195)](_0x42be88(0x150),_0x4ffd84);let _0x330db0;if(_0x14051f['role']==_0x42be88(0x176)){const _0x256321=await staff[_0x42be88(0x103)]({'email':_0x14051f['email']});_0x330db0=await warehouse['find']({'status':_0x42be88(0x1da),'name':_0x256321[_0x42be88(0x1d1)],'warehouse_category':_0x42be88(0x172),'name':'Return\x20Goods'});}else _0x330db0=await warehouse['aggregate']([{'$match':{'status':_0x42be88(0x1da),'warehouse_category':_0x42be88(0x172),'name':_0x42be88(0x1c5)}},{'$group':{'_id':'$name','name':{'$first':_0x42be88(0x140)}}}]);if(_0x3339ed[0x0][_0x42be88(0x190)]=='English\x20(US)'){var _0x41f88f=users[_0x42be88(0xf8)];console[_0x42be88(0x195)](_0x41f88f);}else{if(_0x3339ed[0x0][_0x42be88(0x190)]==_0x42be88(0x220))var _0x41f88f=users[_0x42be88(0x220)];else{if(_0x3339ed[0x0][_0x42be88(0x190)]=='German')var _0x41f88f=users[_0x42be88(0x1c9)];else{if(_0x3339ed[0x0][_0x42be88(0x190)]==_0x42be88(0x221))var _0x41f88f=users[_0x42be88(0x221)];else{if(_0x3339ed[0x0][_0x42be88(0x190)]=='French')var _0x41f88f=users['French'];else{if(_0x3339ed[0x0][_0x42be88(0x190)]==_0x42be88(0x20e))var _0x41f88f=users[_0x42be88(0xfa)];else{if(_0x3339ed[0x0][_0x42be88(0x190)]==_0x42be88(0x21e))var _0x41f88f=users[_0x42be88(0x21e)];else{if(_0x3339ed[0x0][_0x42be88(0x190)]==_0x42be88(0x228))var _0x41f88f=users[_0x42be88(0x222)];}}}}}}}_0x4f919e[_0x42be88(0x189)]('return_purchase_finished',{'success':_0x594f6b[_0x42be88(0x215)](_0x42be88(0x14b)),'errors':_0x594f6b[_0x42be88(0x215)](_0x42be88(0x132)),'role':_0x14051f,'profile':_0x56e847,'user':_0x1428ee,'stock':_0x4ffd84,'master_shop':_0x3339ed,'product':_0x549bd9,'language':_0x41f88f,'warehouse':_0x330db0});}catch(_0x4b791c){console[_0x42be88(0x195)](_0x4b791c);}}),router['post']('/view/return_purchase/:id',auth,async(_0x5b7323,_0xfd3ee8)=>{var _0x1aced6=a0_0x2a53dd;try{const {invoice:_0x503d14,date:_0x4b3208,warehouse_name:_0x1ae78b,Room_name:_0x595c35,product_name:_0x1ed778,purchase_quantity:_0x2879e8,stocks:_0x2ef1c3,return_qty:_0x16b1f4,note:_0x55e06f,level:_0x2419b3,isle:_0x5818e7,pallet:_0x291c35,to_warehouse_name:_0x36a782,to_Room_name:_0x12fe52}=_0x5b7323['body'],_0x898c10=await purchases_finished['findOne']({'_id':_0x5b7323[_0x1aced6(0x1bd)]['id']}),_0xeb6196=await warehouse[_0x1aced6(0x103)]({'name':_0x1ae78b,'room':_0x595c35,'warehouse_category':'Finished\x20Goods'});if(typeof _0x1ed778==_0x1aced6(0x157))var _0x3f11c2=[_0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x13c)]],_0x4e49a7=[_0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x10e)]],_0x215750=[_0x5b7323[_0x1aced6(0x1b7)]['stocks']],_0x1b102b=[_0x5b7323['body']['return_qty']],_0x442efc=[_0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x122)]],_0x12c468=[_0x5b7323['body'][_0x1aced6(0x1ba)]],_0x4363ff=[_0x5b7323['body'][_0x1aced6(0xf3)]],_0x4b8518=[_0x5b7323[_0x1aced6(0x1b7)]['secondary_code_hide']];else var _0x3f11c2=[..._0x5b7323[_0x1aced6(0x1b7)]['product_name']],_0x4e49a7=[..._0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x10e)]],_0x215750=[..._0x5b7323[_0x1aced6(0x1b7)]['stocks']],_0x1b102b=[..._0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x197)]],_0x442efc=[..._0x5b7323[_0x1aced6(0x1b7)]['level']],_0x12c468=[..._0x5b7323[_0x1aced6(0x1b7)]['product_code_hide']],_0x4363ff=[..._0x5b7323['body'][_0x1aced6(0xf3)]],_0x4b8518=[..._0x5b7323['body'][_0x1aced6(0x1b1)]];const _0x311326=_0x3f11c2[_0x1aced6(0x210)](_0x4808ce=>{return _0x4808ce={'product_name':_0x4808ce};});_0x4e49a7[_0x1aced6(0x15a)]((_0x347e97,_0x15f70e)=>{var _0x1d443c=_0x1aced6;_0x311326[_0x15f70e][_0x1d443c(0x10e)]=_0x347e97;}),_0x215750[_0x1aced6(0x15a)]((_0x213f55,_0x47a1ad)=>{var _0x190912=_0x1aced6;_0x311326[_0x47a1ad][_0x190912(0x101)]=_0x213f55;}),_0x1b102b['forEach']((_0x297fc7,_0x1ba853)=>{_0x311326[_0x1ba853]['return_qty']=_0x297fc7;}),_0x442efc[_0x1aced6(0x15a)]((_0x5728b4,_0x120c23)=>{var _0xdfc120=_0x1aced6;_0x311326[_0x120c23][_0xdfc120(0x13d)]=_0x5728b4;}),_0x12c468[_0x1aced6(0x15a)]((_0x52efe7,_0x5a34d9)=>{_0x311326[_0x5a34d9]['product_code']=_0x52efe7;}),_0x4363ff[_0x1aced6(0x15a)]((_0x1c2bab,_0x599b6b)=>{_0x311326[_0x599b6b]['primary_code']=_0x1c2bab;}),_0x4b8518[_0x1aced6(0x15a)]((_0x47c4a2,_0x31b466)=>{var _0x4a4ef9=_0x1aced6;_0x311326[_0x31b466][_0x4a4ef9(0x1b6)]=_0x47c4a2;}),_0x311326[_0x1aced6(0x15a)](_0x453a95=>{var _0x5990a6=_0x1aced6;console[_0x5990a6(0x195)](_0x453a95);const _0x4508a7=_0xeb6196['product_details']['map'](_0x4cdcef=>{var _0xbfab82=_0x5990a6;_0x4cdcef[_0xbfab82(0x13c)]==_0x453a95[_0xbfab82(0x13c)]&&_0x4cdcef[_0xbfab82(0x13d)]==_0x453a95['bay']&&(console[_0xbfab82(0x195)](parseInt(_0x4cdcef[_0xbfab82(0x1eb)])+_0xbfab82(0x1c7)+parseInt(_0x453a95[_0xbfab82(0x197)])),_0x4cdcef['product_stock']=parseInt(_0x4cdcef[_0xbfab82(0x1eb)])-parseInt(_0x453a95[_0xbfab82(0x197)]));});}),await _0xeb6196[_0x1aced6(0x1aa)]();var _0x5ca7f3=0x0;_0x311326[_0x1aced6(0x15a)](_0x45e7e2=>{var _0xf52286=_0x1aced6;(parseInt(_0x45e7e2[_0xf52286(0x10e)])<parseInt(_0x45e7e2[_0xf52286(0x197)])||parseInt(_0x45e7e2[_0xf52286(0x101)])<parseInt(_0x45e7e2[_0xf52286(0x197)]))&&_0x5ca7f3++;});if(_0x5ca7f3!=0x0)return _0x5b7323[_0x1aced6(0x215)](_0x1aced6(0x132),_0x1aced6(0x21b)),_0xfd3ee8['redirect']('back');const _0x327155=new purchases_return_finished({'invoice':_0x503d14,'suppliers':_0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x1a3)],'date':_0x4b3208,'warehouse_name':_0x1ae78b,'return_product':_0x311326,'note':_0x55e06f,'room':_0x595c35,'to_warehouse_name':_0x36a782,'to_room':_0x12fe52}),_0x3980bf=await _0x327155[_0x1aced6(0x1aa)](),_0x479815=await purchases_return_finished[_0x1aced6(0x103)]({'invoice':_0x503d14}),_0x1c6087=await warehouse[_0x1aced6(0x103)]({'name':_0x36a782,'room':_0x12fe52,'warehouse_category':_0x1aced6(0x172)});_0x479815[_0x1aced6(0x105)][_0x1aced6(0x15a)](_0x5e4397=>{var _0x20e7b9=_0x1aced6,_0x2a5228=0x0;const _0x39a565=_0x1c6087[_0x20e7b9(0x177)][_0x20e7b9(0x210)](_0x557a11=>{var _0xed2e3e=_0x20e7b9;console[_0xed2e3e(0x195)](_0x557a11['product_name']+'=='+_0x5e4397['product_name']+'&&'+_0x557a11[_0xed2e3e(0x13d)]+'=='+_0x5e4397[_0xed2e3e(0x13d)]),_0x557a11[_0xed2e3e(0x13c)]==_0x5e4397[_0xed2e3e(0x13c)]&&_0x557a11['bay']==_0x5e4397['bay']&&(_0x557a11[_0xed2e3e(0x1eb)]=parseInt(_0x557a11[_0xed2e3e(0x1eb)])-parseInt(_0x5e4397['return_qty']),_0x2a5228++);});_0x2a5228=='0'&&(_0x1c6087[_0x20e7b9(0x177)]=_0x1c6087[_0x20e7b9(0x177)][_0x20e7b9(0x1af)]({'product_name':_0x5e4397[_0x20e7b9(0x13c)],'product_stock':_0x5e4397['return_qty'],'primary_code':_0x5e4397[_0x20e7b9(0x19f)],'secondary_code':_0x5e4397['secondary_code'],'product_code':_0x5e4397[_0x20e7b9(0x125)],'bay':_0x5e4397[_0x20e7b9(0x13d)],'maxProducts':0xf423f}));}),await _0x1c6087[_0x1aced6(0x1aa)]();const _0x53142f=await purchases_finished[_0x1aced6(0x103)]({'invoice':_0x503d14});_0x53142f['return_data']=_0x1aced6(0x161);const _0x3089b6=await _0x53142f['save'](),_0x371252=new s_payment_data({'invoice':_0x503d14,'suppliers':_0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x1a3)],'reason':_0x1aced6(0x145)});await _0x371252[_0x1aced6(0x1aa)]();const _0x4a00df=await master_shop[_0x1aced6(0x137)](),_0x5bccc1=await email_settings[_0x1aced6(0x103)](),_0x82e121=await suppliers[_0x1aced6(0x103)]({'name':_0x5b7323[_0x1aced6(0x1b7)][_0x1aced6(0x1a3)]});_0x4a00df[0x0][_0x1aced6(0x10d)]==0x1?(right_currency=_0x4a00df[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4a00df[0x0]['currency']);var _0x63fcfe=_0x3f11c2,_0x2556cf=_0x1b102b,_0x120532='',_0x17a03e;for(_0x17a03e in _0x63fcfe){_0x120532+=_0x1aced6(0x18b)+_0x1aced6(0x20c)+_0x63fcfe[_0x17a03e]+_0x1aced6(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2556cf[_0x17a03e]+'</td>'+_0x1aced6(0xe7);}let _0x32a8cb=nodemailer[_0x1aced6(0xef)]({'service':_0x1aced6(0x14c),'auth':{'user':_0x5bccc1[_0x1aced6(0x1a2)],'pass':_0x5bccc1[_0x1aced6(0x20a)]}}),_0x42f04c={'from':_0x5bccc1['email'],'to':_0x82e121['email'],'subject':_0x1aced6(0x1dc),'attachments':[{'filename':_0x1aced6(0x196),'path':__dirname+_0x1aced6(0x12a)+_0x1aced6(0x1be)+_0x4a00df[0x0]['image'],'cid':'logo'}],'html':_0x1aced6(0xee)+'<html><head><title></title>'+_0x1aced6(0x14a)+_0x1aced6(0x169)+_0x1aced6(0x212)+_0x1aced6(0x169)+_0x1aced6(0x12c)+_0x1aced6(0x1a4)+'<div>'+'<h2>\x20'+_0x4a00df[0x0][_0x1aced6(0x214)]+_0x1aced6(0x138)+_0x1aced6(0x1a4)+_0x1aced6(0x1a4)+_0x1aced6(0x211)+_0x1aced6(0x169)+_0x1aced6(0x205)+_0x1aced6(0x225)+_0x503d14+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x4b3208+'\x20'+_0x1aced6(0x183)+'</h5>'+_0x1aced6(0x1a4)+_0x1aced6(0x171)+_0x1aced6(0x17e)+_0x1aced6(0x18b)+_0x1aced6(0x21f)+_0x1aced6(0x20d)+_0x1aced6(0x143)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1aced6(0xe7)+'</thead>'+_0x1aced6(0x1f8)+'\x20'+_0x120532+'\x20'+_0x1aced6(0x1d5)+'</table>'+_0x1aced6(0x169)+_0x1aced6(0x158)+'<h5>'+_0x4a00df[0x0][_0x1aced6(0x214)]+_0x1aced6(0x1e3)+'</div>'+_0x1aced6(0x1a4)+_0x1aced6(0xe3)};_0x32a8cb['sendMail'](_0x42f04c,function(_0x375080,_0x13fbff){var _0x21d092=_0x1aced6;_0x375080?console['log'](_0x21d092(0x1cb)):console['log'](_0x21d092(0x148));}),_0x5b7323[_0x1aced6(0x215)](_0x1aced6(0x14b),_0x1aced6(0x1b2)),_0xfd3ee8[_0x1aced6(0x1e5)]('/all_purchases_finished/view');}catch(_0x14873d){_0xfd3ee8[_0x1aced6(0x12e)](0xc8)[_0x1aced6(0x133)]({'message':_0x14873d[_0x1aced6(0x1fd)]});}}),router[a0_0x2a53dd(0x219)]('/barcode/:id',auth,async(_0x20b5eb,_0x372602)=>{var _0x3aff57=a0_0x2a53dd;try{const {username:_0x38e504,email:_0x42245c,role:_0x202ef6}=_0x20b5eb[_0x3aff57(0x136)],_0x1fcfbc=_0x20b5eb['user'],_0x419941=await profile[_0x3aff57(0x103)]({'email':_0x1fcfbc[_0x3aff57(0x1a2)]}),_0x627522=await master_shop[_0x3aff57(0x137)](),_0x11245d=_0x20b5eb[_0x3aff57(0x1bd)]['id'],_0x1bb65a=await purchases_finished['findById'](_0x11245d);if(_0x627522[0x0][_0x3aff57(0x190)]==_0x3aff57(0x1d2))var _0x427715=users['English'];else{if(_0x627522[0x0][_0x3aff57(0x190)]=='Hindi')var _0x427715=users[_0x3aff57(0x220)];else{if(_0x627522[0x0][_0x3aff57(0x190)]=='German')var _0x427715=users[_0x3aff57(0x1c9)];else{if(_0x627522[0x0][_0x3aff57(0x190)]=='Spanish')var _0x427715=users['Spanish'];else{if(_0x627522[0x0][_0x3aff57(0x190)]==_0x3aff57(0x102))var _0x427715=users[_0x3aff57(0x102)];else{if(_0x627522[0x0][_0x3aff57(0x190)]==_0x3aff57(0x20e))var _0x427715=users['Portuguese'];else{if(_0x627522[0x0][_0x3aff57(0x190)]==_0x3aff57(0x21e))var _0x427715=users['Chinese'];else{if(_0x627522[0x0][_0x3aff57(0x190)]=='Arabic\x20(ae)')var _0x427715=users[_0x3aff57(0x222)];}}}}}}}_0x372602[_0x3aff57(0x189)]('all_purchases_barcode',{'success':_0x20b5eb['flash'](_0x3aff57(0x14b)),'errors':_0x20b5eb[_0x3aff57(0x215)](_0x3aff57(0x132)),'role':_0x1fcfbc,'profile':_0x419941,'alldata':_0x1bb65a,'master_shop':_0x627522,'language':_0x427715}),console[_0x3aff57(0x195)](alldata);}catch(_0x1eb356){console[_0x3aff57(0x195)](_0x1eb356);}}),router[a0_0x2a53dd(0x1ee)](a0_0x2a53dd(0x1ea),async(_0x404eba,_0x4290ff)=>{var _0x15692e=a0_0x2a53dd;const {product_code:_0x59a22c}=_0x404eba[_0x15692e(0x1b7)];var _0x25b71c;const _0x4404bc=await product[_0x15692e(0x185)]([{'$match':{'primary_code':_0x59a22c}},{'$group':{'_id':_0x15692e(0x131),'name':{'$first':_0x15692e(0x140)},'category':{'$first':_0x15692e(0xf4)},'brand':{'$first':_0x15692e(0xfb)},'unit':{'$first':_0x15692e(0x1fa)},'alertquantity':{'$first':_0x15692e(0x1d7)},'product_code':{'$first':_0x15692e(0x1ac)},'primary_code':{'$first':_0x15692e(0xf5)},'secondary_code':{'$first':_0x15692e(0x16a)},'maxStocks':{'$first':_0x15692e(0xe9)},'maxProdPerUnit':{'$first':_0x15692e(0x151)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x15692e(0x16c)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x1c5148=await product[_0x15692e(0x185)]([{'$match':{'secondary_code':_0x59a22c}},{'$group':{'_id':_0x15692e(0x131),'name':{'$first':_0x15692e(0x140)},'category':{'$first':_0x15692e(0xf4)},'brand':{'$first':_0x15692e(0xfb)},'unit':{'$first':_0x15692e(0x1fa)},'alertquantity':{'$first':_0x15692e(0x1d7)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x15692e(0xf5)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x15692e(0xe9)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x15692e(0x178)},'gross_price':{'$first':_0x15692e(0x16c)},'sales_category':{'$first':_0x15692e(0xed)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x4404bc[_0x15692e(0x1b0)]>0x0)_0x25b71c=_0x4404bc;else _0x1c5148[_0x15692e(0x1b0)]>0x0&&(_0x25b71c=_0x1c5148);_0x4290ff[_0x15692e(0x133)](_0x25b71c);}),router['post']('/CheckingWarehouse',async(_0x177dc3,_0x362e0d)=>{var _0x35ace0=a0_0x2a53dd;const {productCode:_0x26a8e9,bay:_0x13a1b6,warehouses:_0x38a859,room:_0x4578a3}=_0x177dc3[_0x35ace0(0x1b7)];console['log'](_0x177dc3[_0x35ace0(0x1b7)]);try{const _0x44624d=await warehouse[_0x35ace0(0x185)]([{'$match':{'name':_0x38a859,'room':_0x4578a3}},{'$unwind':_0x35ace0(0xe4)},{'$match':{'product_details.bay':parseInt(_0x13a1b6)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x35ace0(0x116)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x35ace0(0x1a8)},'maxProducts':{'$first':_0x35ace0(0x11d)}}}]);_0x362e0d[_0x35ace0(0x12e)](0xc8)[_0x35ace0(0x133)](_0x44624d);}catch(_0x20edc2){_0x362e0d[_0x35ace0(0x12e)](0x194)[_0x35ace0(0x133)]({'message':_0x20edc2['message']});}}),router['post']('/barcode_scanner_logs',async(_0x41bd35,_0x1f28a6)=>{var _0x36486e=a0_0x2a53dd;const {product_code:_0x31b090}=_0x41bd35[_0x36486e(0x1b7)];var _0x19f488;const _0x33cadb=await product[_0x36486e(0x185)]([{'$match':{'primary_code':_0x31b090,'type_products':_0x36486e(0x195)}},{'$group':{'_id':_0x36486e(0x131),'name':{'$first':_0x36486e(0x140)},'category':{'$first':_0x36486e(0xf4)},'brand':{'$first':'$brand'},'unit':{'$first':_0x36486e(0x1fa)},'alertquantity':{'$first':_0x36486e(0x1d7)},'product_code':{'$first':_0x36486e(0x1ac)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x36486e(0x16a)},'maxStocks':{'$first':_0x36486e(0xe9)},'maxProdPerUnit':{'$first':_0x36486e(0x151)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x36486e(0x178)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x36486e(0xed)},'type_products':{'$first':_0x36486e(0x1a7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x36486e(0x195)](_0x33cadb);const _0x51782a=await product[_0x36486e(0x185)]([{'$match':{'secondary_code':_0x31b090,'type_products':'log'}},{'$group':{'_id':_0x36486e(0x131),'name':{'$first':_0x36486e(0x140)},'category':{'$first':_0x36486e(0xf4)},'brand':{'$first':_0x36486e(0xfb)},'unit':{'$first':_0x36486e(0x1fa)},'alertquantity':{'$first':_0x36486e(0x1d7)},'product_code':{'$first':_0x36486e(0x1ac)},'primary_code':{'$first':_0x36486e(0xf5)},'secondary_code':{'$first':_0x36486e(0x16a)},'maxStocks':{'$first':_0x36486e(0xe9)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x33cadb[_0x36486e(0x1b0)]>0x0)_0x19f488=_0x33cadb;else _0x51782a[_0x36486e(0x1b0)]>0x0&&(_0x19f488=_0x51782a);_0x1f28a6['json'](_0x19f488);}),module['exports']=router;