var a0_0x2a6b3c=a0_0x1bc5;function a0_0x3c16(){var _0x11ca02=['English\x20(US)','abs','then','all','$type_products','/view/return_purchase/:id','9754362ONQNnJ','Paid\x20For\x20Purchase','<strong>\x20Regards\x20</strong>','$date','sendMail','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','findOne','$product_details.product_code','product_data','role','$product_details.secondary_code','production_date','log','\x20</h2>','id_transaction','</h5>','site_title','to_warehouse','maxPerUnit','$category','$product_details.product_name','edit_purchases_finished_view','min','prod_primunit','string','master','Rack\x202','Portuguese','/view/add_purchases/:id','amount','Enabled','Transfer\x20Finalize\x20Successfully','/all_purchases/view','<!DOCTYPE\x20html>','find','/all_purchases_finished/preview/','<span\x20style=\x22float:\x20right;\x22>','message','\x20units\x20of\x20','back','standard_unit','$_id','stock_quantity','$product_details.primary_code','/barcode_scanner_logs','success','\x20<>\x20',',\x20bin:\x20','$suppliers','to_room_name','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','secondary_code','/view/add_purchases_logs','name','primary_code','filter','max_product_unit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','currency','INC','product_cat','room_name','logo','</head><body>','prod_unit','all_purchases_finished','redirect','130010BCDVWx','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','product_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$suppliers_docs','purchase_quantity','toString','/picking_list/pdf_puchases_fin_own_trf/','$product_code','\x20to\x20warehouse:\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','purchase\x20data\x20update\x20successfully','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sales_category','$sales_category','bay','\x20===\x20','here2','user','maxStocks','German','Error\x20Occurs','<hr\x20class=\x22my-3\x22>','$unit','Ambient','nodemailer','/give_payment/:id','$product.floorlevel','LOG-INC-','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','forEach','ejs','/invoice/:id','prod_cat','$secondary_code','FROZEN\x20GOODS','return_data','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','$product_details.bin','password','invoice','type_of_products','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','/incoming','</span>','Router','</thead>','express','flash','prod_Qty','updateOne','save','uuid','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','staff','<html><head><title></title>','json','$product_details.rack','$name','email','product_stock','type_of_products_type','18505oGOJcQ','An\x20error\x20occurred\x20while\x20saving\x20data.','2-digit','$product_details.type','aggregate','<div>','product_name','621diPaef','The\x20Other\x20','../models/all_models','/preview/:id','date','get','data_type','$invoice','secondary_unit','primary_code_hide','$warehouse_name','An\x20error\x20occurred.','valueOf','Hindi','gross_price','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','===','/process/:id','user_id','render','host','Distributing\x20','warehouse_name','$product_details.bay','\x20<=>\x20','slice','false','to_recieved','en-CA','$product.bay','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_level','language','$product.room_name','/view/add_purchases','/incoming/add','/view/:id','expiry_date','214091oqPdou','length','/all_purchases_finished/view','unit','purchases\x20item\x20return\x20successfull','$secondary_unit','suppliers','$return_data','\x20Order\x20Number\x20:\x20','date_recieved','</tr>','\x20Order\x20Date\x20:\x20','FGSEmail','numeric','$expiry_date','getDate','product_details','to_quantity','/view','_id','$maxProdPerUnit','prod_name','maxProducts','to_bay','Arabic','RoomAssign','stocks','return_qty','$batch_code','French','4685814RikpXl','inc','$product','max','$product_details.storage','$note','post','<h5>','map','1588apazLx','There\x27s\x20a\x20error\x20in\x20this\x20transaction','getFullYear','Finished\x20Goods','match','/getinvoicetrf','$product_details.floorlevel','invoice_init','toLocaleDateString',',\x20bay:\x20','STAGING\x20AREA\x201','DRY\x20GOODS','item_code','$product.type','error','$product.quantity','$product_details._id','padStart','/barcode_scanner','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_code','purchase\x20data\x20add\x20successfully','Purchase\x20Return','../middleware/auth','/upload/','Arabic\x20(ae)','/all_purchases_finished/process/','$product_details.maxProducts','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','table\x20page','note','INC-','status','isUsed','product','Enclosed','product_id','Portuguese\x20(BR)','</body></html>','/barcode/:id','concat','return_purchase_finished','sales_data_cateory','3573570HYNwss','$paid_amount','Purchase\x20Mail','true','4GqCuTk','bin','Purchase\x20Return\x20Mail','image','/../public','errors','prod_secondunit','quantity','$gross_price','logs','path','$primary_code','add_purchases_finished_logs','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','suppliers_docs','floor','$maxStocks','undefined','batch_code','<h5\x20style=\x22text-align:\x20left;\x22>','findById','Asia/Manila','/CheckingWarehouse','$alertquantity','</table>','product_code','Chinese','product_code_hide','prod_qty','INCF-','<tr>','$due_amount','warehouse','</div>','isProcess','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','incoming_add','English','$product.bin','$room','12007968nVjZCa','Spanish','MaxStocks_data','edit_purchases_finished','</tbody>','purchase_invoice','return_product','secondary_code_hide','payment\x20successfull','$brand','params','level','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','paid_amount','Return\x20Goods','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','<h2>\x20','</td>','add_purchases\x20error','createTransport'];a0_0x3c16=function(){return _0x11ca02;};return a0_0x3c16();}(function(_0x43eab6,_0x226456){var _0x335408=a0_0x1bc5,_0x42cbd8=_0x43eab6();while(!![]){try{var _0x4ee764=-parseInt(_0x335408(0x7b))/0x1*(-parseInt(_0x335408(0xd1))/0x2)+-parseInt(_0x335408(0x99))/0x3+parseInt(_0x335408(0xa2))/0x4*(-parseInt(_0x335408(0x19b))/0x5)+parseInt(_0x335408(0x115))/0x6+-parseInt(_0x335408(0xcd))/0x7+parseInt(_0x335408(0xfa))/0x8+-parseInt(_0x335408(0x1a2))/0x9*(-parseInt(_0x335408(0x15b))/0xa);if(_0x4ee764===_0x226456)break;else _0x42cbd8['push'](_0x42cbd8['shift']());}catch(_0xc0b74d){_0x42cbd8['push'](_0x42cbd8['shift']());}}}(a0_0x3c16,0xde395));const express=require(a0_0x2a6b3c(0x18c)),app=express(),router=express[a0_0x2a6b3c(0x18a)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x2a6b3c(0x1a4)),auth=require(a0_0x2a6b3c(0xb9)),nodemailer=require(a0_0x2a6b3c(0x175));var ejs=require(a0_0x2a6b3c(0x17c));const path=require(a0_0x2a6b3c(0xdb)),users=require('../public/language/languages.json'),{isNull}=require('util');router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0x188),auth,async(_0x4ac863,_0x35a956)=>{var _0x11e39c=a0_0x2a6b3c;try{const {username:_0x2b1134,email:_0x1fc296,role:_0x338d3f}=_0x4ac863[_0x11e39c(0x16e)],_0x1b2d1c=_0x4ac863[_0x11e39c(0x16e)],_0x39ac07=await profile[_0x11e39c(0x11c)]({'email':_0x1b2d1c[_0x11e39c(0x198)]}),_0x5255b0=await staff['findOne']({'email':_0x1b2d1c[_0x11e39c(0x198)]}),_0x2374a5=await master_shop[_0x11e39c(0x138)]();let _0x5144fe=await transfers_finished[_0x11e39c(0x19f)]([{'$match':{'to_warehouse':_0x5255b0[_0x11e39c(0xf1)]}}]);if(_0x2374a5[0x0][_0x11e39c(0x75)]=='English\x20(US)')var _0x484564=users[_0x11e39c(0xf7)];else{if(_0x2374a5[0x0][_0x11e39c(0x75)]==_0x11e39c(0x1af))var _0x484564=users[_0x11e39c(0x1af)];else{if(_0x2374a5[0x0][_0x11e39c(0x75)]==_0x11e39c(0x170))var _0x484564=users[_0x11e39c(0x170)];else{if(_0x2374a5[0x0][_0x11e39c(0x75)]==_0x11e39c(0xfb))var _0x484564=users[_0x11e39c(0xfb)];else{if(_0x2374a5[0x0][_0x11e39c(0x75)]==_0x11e39c(0x98))var _0x484564=users[_0x11e39c(0x98)];else{if(_0x2374a5[0x0][_0x11e39c(0x75)]=='Portuguese\x20(BR)')var _0x484564=users[_0x11e39c(0x131)];else{if(_0x2374a5[0x0]['language']==_0x11e39c(0xeb))var _0x484564=users[_0x11e39c(0xeb)];else{if(_0x2374a5[0x0][_0x11e39c(0x75)]==_0x11e39c(0xbb))var _0x484564=users['Arabic'];}}}}}}}_0x35a956['render']('incoming_view',{'success':_0x4ac863[_0x11e39c(0x18d)](_0x11e39c(0x143)),'errors':_0x4ac863[_0x11e39c(0x18d)](_0x11e39c(0xd6)),'purchases':_0x5144fe,'role':_0x1b2d1c,'profile':_0x39ac07,'master_shop':_0x2374a5,'language':_0x484564,'staff_data':_0x5255b0});}catch(_0x464527){console['log'](_0x11e39c(0xbf),_0x464527),_0x35a956[_0x11e39c(0xc2)](0xc8)[_0x11e39c(0x195)]({'message':_0x464527[_0x11e39c(0x13b)]});}}),router[a0_0x2a6b3c(0x1a7)]('/incoming/add',auth,async(_0x1a9703,_0x35cb40)=>{var _0x2aac04=a0_0x2a6b3c;try{const {username:_0x18f597,email:_0x553c46,role:_0x523f94}=_0x1a9703[_0x2aac04(0x16e)],_0xa17980=_0x1a9703[_0x2aac04(0x16e)],_0x1fdb3c=await profile[_0x2aac04(0x11c)]({'email':_0xa17980[_0x2aac04(0x198)]}),_0x3cf5a0=await staff[_0x2aac04(0x11c)]({'email':_0xa17980['email']}),_0x3dd019=await master_shop[_0x2aac04(0x138)]();let _0x2d68ec=await transfers_finished[_0x2aac04(0x19f)]([{'$match':{'to_warehouse':_0x3cf5a0[_0x2aac04(0xf1)],'to_recieved':_0x2aac04(0x6e)}}]);if(_0x3dd019[0x0]['language']==_0x2aac04(0x10f))var _0x2e3970=users['English'];else{if(_0x3dd019[0x0][_0x2aac04(0x75)]==_0x2aac04(0x1af))var _0x2e3970=users[_0x2aac04(0x1af)];else{if(_0x3dd019[0x0][_0x2aac04(0x75)]==_0x2aac04(0x170))var _0x2e3970=users[_0x2aac04(0x170)];else{if(_0x3dd019[0x0][_0x2aac04(0x75)]==_0x2aac04(0xfb))var _0x2e3970=users[_0x2aac04(0xfb)];else{if(_0x3dd019[0x0][_0x2aac04(0x75)]==_0x2aac04(0x98))var _0x2e3970=users[_0x2aac04(0x98)];else{if(_0x3dd019[0x0][_0x2aac04(0x75)]==_0x2aac04(0xc7))var _0x2e3970=users['Portuguese'];else{if(_0x3dd019[0x0][_0x2aac04(0x75)]=='Chinese')var _0x2e3970=users[_0x2aac04(0xeb)];else{if(_0x3dd019[0x0]['language']==_0x2aac04(0xbb))var _0x2e3970=users[_0x2aac04(0x93)];}}}}}}}_0x35cb40['render'](_0x2aac04(0xf6),{'success':_0x1a9703[_0x2aac04(0x18d)](_0x2aac04(0x143)),'errors':_0x1a9703[_0x2aac04(0x18d)]('errors'),'purchases':_0x2d68ec,'role':_0xa17980,'profile':_0x1fdb3c,'master_shop':_0x3dd019,'language':_0x2e3970,'staff_data':_0x3cf5a0});}catch(_0x5bf158){console['log']('table\x20page',_0x5bf158),_0x35cb40[_0x2aac04(0xc2)](0xc8)[_0x2aac04(0x195)]({'message':_0x5bf158[_0x2aac04(0x13b)]});}});const createLog=async _0x1df16b=>{var _0x5d7416=a0_0x2a6b3c;const _0x3f4d55=new datalogs({'location':_0x1df16b});return await _0x3f4d55[_0x5d7416(0x190)](),_0x3f4d55['invoice_init'];};router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0x78),auth,async(_0x53eaae,_0x1db5d2)=>{var _0x347a78=a0_0x2a6b3c;try{const {invoice_trf_data:_0x5e89f3,item_code:_0x3faaba,SCRN:_0x2637cb,ReqBy:_0x335e48,type_of_products:_0x2f130b,dateofreq:_0x50ac6a,PO_number:_0x3c689e,date:_0x5b5e99,warehouse_name:_0x5e13e7,typeservicesData:_0x3c797a,typevehicle:_0x105064,driver:_0x53c645,plate:_0x5bab6b,van:_0x17fc13,DRSI:_0xe548cc,TSU:_0x33df28,TFU:_0x14550a,note:_0x56bc2e}=_0x53eaae[_0x347a78(0x11a)],_0x5b7c64=await transfers_finished[_0x347a78(0xe5)](_0x5e89f3);if(typeof _0x3faaba=='string')var _0x3fdb06=[_0x53eaae['body'][_0x347a78(0x1a1)]],_0x4f599b=[_0x53eaae['body'][_0x347a78(0xae)]],_0xc1716=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0x8c)]],_0x171a6d=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0x7e)]],_0x84dae2=[_0x53eaae['body']['prod_secondunit']],_0x3c4c6f=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0xd2)]],_0x375ebc=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0x14d)]],_0x282e66=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0x14a)]],_0x2e5e55=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0xe3)]],_0x185a32=[_0x53eaae[_0x347a78(0x11a)]['expiry_date']],_0x3911a5=[_0x53eaae['body'][_0x347a78(0x121)]],_0x2655b8=[_0x53eaae['body']['max_product_unit']],_0x5f1da4=[_0x53eaae[_0x347a78(0x11a)][_0x347a78(0x148)]];else var _0x3fdb06=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x1a1)]],_0x4f599b=[..._0x53eaae['body'][_0x347a78(0xae)]],_0xc1716=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x8c)]],_0x171a6d=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x7e)]],_0x84dae2=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0xd7)]],_0x3c4c6f=[..._0x53eaae[_0x347a78(0x11a)]['bin']],_0x375ebc=[..._0x53eaae['body']['primary_code']],_0x282e66=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x14a)]],_0x2e5e55=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0xe3)]],_0x185a32=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x7a)]],_0x3911a5=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x121)]],_0x2655b8=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x14f)]],_0x5f1da4=[..._0x53eaae[_0x347a78(0x11a)][_0x347a78(0x148)]];const _0x24e070=_0x3fdb06['map'](_0xeff8c4=>{return _0xeff8c4={'product_name':_0xeff8c4};});_0x4f599b['forEach']((_0x4c57a4,_0x31a0b9)=>{var _0x351796=_0x347a78;_0x24e070[_0x31a0b9][_0x351796(0xea)]=_0x4c57a4;}),_0xc1716[_0x347a78(0x17b)]((_0x247beb,_0xcf8429)=>{var _0x3d39ba=_0x347a78;_0x24e070[_0xcf8429][_0x3d39ba(0xd8)]=Math[_0x3d39ba(0x110)](_0x247beb);}),_0x171a6d[_0x347a78(0x17b)]((_0x40fd85,_0x2c2086)=>{var _0x2e5d4a=_0x347a78;_0x24e070[_0x2c2086][_0x2e5d4a(0x13e)]=_0x40fd85;}),_0x84dae2[_0x347a78(0x17b)]((_0x27e772,_0xdcbb59)=>{var _0xa27265=_0x347a78;_0x24e070[_0xdcbb59][_0xa27265(0x1aa)]=_0x27e772;}),_0x3c4c6f[_0x347a78(0x17b)]((_0x5794c8,_0x59f6e0)=>{var _0x10dcc9=_0x347a78,_0x2f9623=_0x5794c8[_0x10dcc9(0xa6)](/[A-Za-z]+/)[0x0],_0x1a1848=parseInt(_0x5794c8['match'](/\d+/)[0x0]);_0x24e070[_0x59f6e0]['level']=_0x2f9623,_0x24e070[_0x59f6e0][_0x10dcc9(0x16b)]=_0x1a1848;}),_0x375ebc[_0x347a78(0x17b)]((_0x5c924e,_0x327b32)=>{var _0x5548e8=_0x347a78;_0x24e070[_0x327b32][_0x5548e8(0x14d)]=_0x5c924e;}),_0x282e66['forEach']((_0x92e829,_0x330c71)=>{var _0x261e41=_0x347a78;_0x24e070[_0x330c71][_0x261e41(0x14a)]=_0x92e829;}),_0x2e5e55[_0x347a78(0x17b)]((_0x441d3a,_0x19a030)=>{_0x24e070[_0x19a030]['batch_code']=_0x441d3a;}),_0x185a32[_0x347a78(0x17b)]((_0x3d3c30,_0xd3b0cd)=>{var _0x45ab21=_0x347a78;_0x24e070[_0xd3b0cd][_0x45ab21(0x7a)]=_0x3d3c30;}),_0x3911a5[_0x347a78(0x17b)]((_0x5c8688,_0x4c16d9)=>{var _0x568b32=_0x347a78;_0x24e070[_0x4c16d9][_0x568b32(0x121)]=_0x5c8688;}),_0x2655b8[_0x347a78(0x17b)]((_0x393e34,_0x42c292)=>{var _0xeb385b=_0x347a78;_0x24e070[_0x42c292][_0xeb385b(0x106)]=_0x393e34;}),_0x5f1da4[_0x347a78(0x17b)]((_0xe0595e,_0x5e944c)=>{var _0x1691a0=_0x347a78;_0x24e070[_0x5e944c][_0x1691a0(0x155)]=_0xe0595e;});const _0x5ed334=await createLog(_0x347a78(0x153));_0x5f1da4[_0x347a78(0x17b)]((_0x1bf5a5,_0x11cc2f)=>{var _0x51e695=_0x347a78;_0x24e070[_0x11cc2f][_0x51e695(0x185)]='INC-'+_0x5ed334['toString']()[_0x51e695(0xb3)](0x8,'0');});const _0x36c2c6=_0x24e070[_0x347a78(0x14e)](_0x53ab71=>_0x53ab71[_0x347a78(0xd8)]!=='0'&&_0x53ab71[_0x347a78(0xd8)]!==''),_0x14a3da=new purchases_incoming({'invoice':_0x347a78(0xc1)+_0x5ed334['toString']()[_0x347a78(0xb3)](0x8,'0'),'date':_0x5b5e99,'warehouse_name':_0x5e13e7,'product':_0x36c2c6,'note':_0x56bc2e,'POnumber':_0x3c689e,'SCRN':_0x2637cb,'ReqBy':_0x335e48,'dateofreq':_0x50ac6a,'typeservicesData':_0x3c797a,'van':_0x17fc13,'typevehicle':_0x105064,'driver':_0x53c645,'plate':_0x5bab6b,'DRSI':_0xe548cc,'TSU':_0x33df28,'TFU':_0x14550a,'typeOfProducts':_0x2f130b}),_0x2099a0=await _0x14a3da[_0x347a78(0x190)](),_0x13900b=_0x2099a0[_0x347a78(0xc4)][_0x347a78(0xa1)](async _0x244def=>{var _0x108716=_0x347a78,_0x104636=await warehouse[_0x108716(0x11c)]({'name':_0x5e13e7,'room':_0x244def[_0x108716(0x155)]});if(_0x244def[_0x108716(0xd8)]>0x0){var _0x5359c8=0x0;const _0x2d7b87=_0x104636[_0x108716(0x8b)]['map'](_0x4f95bb=>{var _0x35352e=_0x108716;_0x4f95bb['product_name']==_0x244def[_0x35352e(0x1a1)]&&_0x4f95bb[_0x35352e(0x16b)]==_0x244def['to_bay']&&_0x4f95bb[_0x35352e(0x7a)]==_0x244def[_0x35352e(0x7a)]&&_0x4f95bb[_0x35352e(0x121)]==_0x244def[_0x35352e(0x121)]&&_0x4f95bb['batch_code']==_0x244def[_0x35352e(0xe3)]&&_0x4f95bb[_0x35352e(0x185)]==_0x244def[_0x35352e(0x185)]&&(typeof _0x244def[_0x35352e(0x124)]==_0x35352e(0xe2)?(console[_0x35352e(0x122)](_0x35352e(0x16d),_0x4f95bb[_0x35352e(0x199)]+_0x35352e(0x144)+_0x4f95bb[_0x35352e(0x8e)]+_0x35352e(0x6c)+Math['abs'](_0x4f95bb['product_stock'])+Math[_0x35352e(0x110)](_0x244def[_0x35352e(0x8c)])),_0x4f95bb['product_stock']=Math[_0x35352e(0x110)](_0x4f95bb[_0x35352e(0x199)])+Math[_0x35352e(0x110)](_0x244def[_0x35352e(0xd8)])):(_0x4f95bb[_0x35352e(0x199)]=Math['abs'](_0x4f95bb[_0x35352e(0x199)])+Math[_0x35352e(0x110)](_0x244def[_0x35352e(0xd8)]),_0x5359c8++));});_0x5359c8=='0'&&(_0x104636[_0x108716(0x8b)]=_0x104636['product_details'][_0x108716(0xca)]({'product_name':_0x244def[_0x108716(0x1a1)],'product_stock':_0x244def['quantity'],'bay':_0x244def[_0x108716(0x16b)],'level':_0x244def[_0x108716(0x105)],'product_code':_0x244def[_0x108716(0xea)],'primary_code':_0x244def[_0x108716(0x14d)],'secondary_code':_0x244def[_0x108716(0x14a)],'expiry_date':_0x244def[_0x108716(0x7a)],'production_date':_0x244def[_0x108716(0x121)],'maxProducts':_0x244def[_0x108716(0x91)],'batch_code':_0x244def[_0x108716(0xe3)],'secondary_unit':_0x244def[_0x108716(0x1aa)],'unit':_0x244def['standard_unit'],'maxProducts':_0x244def['maxProducts'],'maxPerUnit':_0x244def[_0x108716(0x128)],'invoice':_0x244def[_0x108716(0x185)]}));}return _0x104636;});Promise[_0x347a78(0x112)](_0x13900b)['then'](async _0x2df4ec=>{var _0x492d66=_0x347a78;try{for(const _0x30e640 of _0x2df4ec){await warehouse[_0x492d66(0x18f)]({'_id':_0x30e640[_0x492d66(0x8e)]},{'$addToSet':{'product_details':{'$each':_0x30e640[_0x492d66(0x8b)]}}});}_0x5b7c64[_0x492d66(0x6f)]=_0x492d66(0xd0);const _0x48551f=await _0x5b7c64[_0x492d66(0x190)](),_0x22c678=await master_shop[_0x492d66(0x138)](),_0x47b45e=await email_settings['findOne'](),_0x2c6a81=await supervisor_settings['find']();var _0x281d76=_0x14a3da[_0x492d66(0xc4)],_0x17f836='',_0x14a143;for(_0x14a143 in _0x281d76){var _0x155c90='FG';_0x14a3da[_0x492d66(0x127)]=='DRY\x20GOODS'&&(_0x155c90='DG'),_0x17f836+=_0x492d66(0xef)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x281d76[_0x14a143]['product_name']+_0x492d66(0x10c)+_0x492d66(0x165)+_0x281d76[_0x14a143]['product_code']+_0x492d66(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x281d76[_0x14a143]['to_quantity']+_0x492d66(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x281d76[_0x14a143][_0x492d66(0x7e)]+_0x492d66(0x10c)+_0x492d66(0x165)+_0x281d76[_0x14a143][_0x492d66(0x1aa)]+_0x492d66(0x10c)+_0x492d66(0x165)+_0x14a3da['to_warehouse']+_0x492d66(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x281d76[_0x14a143][_0x492d66(0x147)]+'</td>'+_0x492d66(0x165)+_0x155c90+_0x281d76[_0x14a143][_0x492d66(0x92)]+_0x492d66(0x10c)+'</tr>';}_0x53eaae[_0x492d66(0x18d)](_0x492d66(0x143),_0x492d66(0x135)),_0x1db5d2[_0x492d66(0x15a)](_0x492d66(0x162)+_0x2099a0[_0x492d66(0x8e)]);}catch(_0x59ce58){console['error'](_0x59ce58),_0x1db5d2[_0x492d66(0xc2)](0x1f4)[_0x492d66(0x195)]({'error':_0x492d66(0x10a)});}})[_0x347a78(0x167)](_0x5d2803=>{var _0x1ae314=_0x347a78;console[_0x1ae314(0xb0)](_0x5d2803),_0x1db5d2['status'](0x1f4)[_0x1ae314(0x195)]({'error':_0x1ae314(0x1ad)});});}catch(_0x5f3523){}}),router['post']('/getTRF',auth,async(_0x411dd8,_0x2f9219)=>{var _0xd72e01=a0_0x2a6b3c;try{const {warehouse:_0x29865e}=_0x411dd8['body'],_0x255da5=await transfers_finished['find']({'to_warehouse':_0x29865e,'to_recieved':_0xd72e01(0x6e)});_0x2f9219['json'](_0x255da5);}catch(_0x4b84a7){}}),router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0xa7),auth,async(_0x26e02e,_0x2d9e61)=>{var _0x31e1ed=a0_0x2a6b3c;try{const {invoice:_0x432dad}=_0x26e02e[_0x31e1ed(0x11a)],_0x35c06f=await transfers_finished[_0x31e1ed(0x138)]({'_id':_0x432dad,'to_recieved':_0x31e1ed(0x6e)});_0x2d9e61['json'](_0x35c06f);}catch(_0x3ec103){}}),router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0x8d),auth,async(_0x591764,_0x75b06b)=>{var _0x8c101a=a0_0x2a6b3c;try{const {username:_0x1ea276,email:_0x4e7648,role:_0x40c2a5}=_0x591764[_0x8c101a(0x16e)],_0x41ca06=_0x591764[_0x8c101a(0x16e)],_0x28d0af=await profile['findOne']({'email':_0x41ca06['email']}),_0x40e6e5=await staff['findOne']({'email':_0x41ca06['email']});if(_0x41ca06['role']=='staff'){const _0x3defb6=await staff['findOne']({'email':_0x41ca06['email']});}const _0x429312=await master_shop[_0x8c101a(0x138)]();let _0x315b18;if(_0x41ca06[_0x8c101a(0x11f)]==_0x8c101a(0x193)){const _0x3b4ee4=await staff['findOne']({'email':_0x41ca06[_0x8c101a(0x198)]});_0x315b18=await purchases_finished[_0x8c101a(0x19f)]([{'$match':{'warehouse_name':_0x3b4ee4[_0x8c101a(0xf1)],'typeOfProducts':'own'}},{'$lookup':{'from':_0x8c101a(0x81),'localField':_0x8c101a(0x81),'foreignField':'name','as':_0x8c101a(0xdf)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x8c101a(0x9b)},{'$group':{'_id':_0x8c101a(0x13f),'invoice':{'$first':_0x8c101a(0x1a9)},'suppliers':{'$first':_0x8c101a(0x146)},'date':{'$first':_0x8c101a(0x118)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x8c101a(0xf9)},'product':{'$push':_0x8c101a(0x9b)},'note':{'$first':_0x8c101a(0x9e)},'paid_amount':{'$first':_0x8c101a(0xce)},'due_amount':{'$first':_0x8c101a(0xf0)},'return_data':{'$first':_0x8c101a(0x82)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x8c101a(0x89)},'suppliers_docs':{'$first':_0x8c101a(0x15f)},'total_product_quantity':{'$sum':_0x8c101a(0xb1)},'level':{'$addToSet':_0x8c101a(0x71)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x8c101a(0xaf)},'floorlevel':{'$addToSet':_0x8c101a(0x177)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x315b18=await purchases_finished[_0x8c101a(0x19f)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$product'},{'$group':{'_id':_0x8c101a(0x13f),'invoice':{'$first':_0x8c101a(0x1a9)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x8c101a(0x118)},'warehouse_name':{'$first':_0x8c101a(0x1ac)},'room':{'$addToSet':_0x8c101a(0x76)},'product':{'$push':'$product'},'note':{'$first':_0x8c101a(0x9e)},'paid_amount':{'$first':_0x8c101a(0xce)},'due_amount':{'$first':_0x8c101a(0xf0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x8c101a(0x97)},'expiry_date':{'$first':_0x8c101a(0x89)},'suppliers_docs':{'$first':_0x8c101a(0x15f)},'total_product_quantity':{'$sum':_0x8c101a(0xb1)},'level':{'$addToSet':_0x8c101a(0x71)},'isle':{'$addToSet':_0x8c101a(0xf8)},'type':{'$addToSet':_0x8c101a(0xaf)},'floorlevel':{'$addToSet':_0x8c101a(0x177)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x429312[0x0][_0x8c101a(0x75)]=='English\x20(US)')var _0x5be74e=users[_0x8c101a(0xf7)];else{if(_0x429312[0x0][_0x8c101a(0x75)]==_0x8c101a(0x1af))var _0x5be74e=users[_0x8c101a(0x1af)];else{if(_0x429312[0x0][_0x8c101a(0x75)]==_0x8c101a(0x170))var _0x5be74e=users['German'];else{if(_0x429312[0x0][_0x8c101a(0x75)]==_0x8c101a(0xfb))var _0x5be74e=users[_0x8c101a(0xfb)];else{if(_0x429312[0x0][_0x8c101a(0x75)]==_0x8c101a(0x98))var _0x5be74e=users[_0x8c101a(0x98)];else{if(_0x429312[0x0][_0x8c101a(0x75)]=='Portuguese\x20(BR)')var _0x5be74e=users[_0x8c101a(0x131)];else{if(_0x429312[0x0]['language']==_0x8c101a(0xeb))var _0x5be74e=users[_0x8c101a(0xeb)];else{if(_0x429312[0x0][_0x8c101a(0x75)]==_0x8c101a(0xbb))var _0x5be74e=users[_0x8c101a(0x93)];}}}}}}}_0x75b06b[_0x8c101a(0x67)](_0x8c101a(0x159),{'success':_0x591764[_0x8c101a(0x18d)]('success'),'errors':_0x591764['flash']('errors'),'purchases':_0x315b18,'role':_0x41ca06,'profile':_0x28d0af,'master_shop':_0x429312,'language':_0x5be74e});}catch(_0x21974b){console[_0x8c101a(0x122)]('table\x20page',_0x21974b),_0x75b06b['status'](0xc8)['json']({'message':_0x21974b['message']});}}),router[a0_0x2a6b3c(0x1a7)]('/view_log',auth,async(_0x1399fc,_0x2a6aa2)=>{var _0x3c45fb=a0_0x2a6b3c;try{const {username:_0x6f0c40,email:_0x58f2f0,role:_0x57d347}=_0x1399fc[_0x3c45fb(0x16e)],_0x3472ed=_0x1399fc[_0x3c45fb(0x16e)],_0x45e0bb=await profile[_0x3c45fb(0x11c)]({'email':_0x3472ed[_0x3c45fb(0x198)]}),_0x5043e4=await staff[_0x3c45fb(0x11c)]({'email':_0x3472ed[_0x3c45fb(0x198)]});if(_0x3472ed[_0x3c45fb(0x11f)]==_0x3c45fb(0x193)){const _0x3450d3=await staff['findOne']({'email':_0x3472ed[_0x3c45fb(0x198)]});}const _0x36bb22=await master_shop['find']();let _0x34f6cf;if(_0x3472ed['role']==_0x3c45fb(0x193)){const _0x431415=await staff[_0x3c45fb(0x11c)]({'email':_0x3472ed[_0x3c45fb(0x198)]});_0x34f6cf=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x431415[_0x3c45fb(0xf1)]}},{'$lookup':{'from':_0x3c45fb(0x81),'localField':_0x3c45fb(0x81),'foreignField':_0x3c45fb(0x14c),'as':_0x3c45fb(0xdf)}},{'$unwind':_0x3c45fb(0x15f)},{'$unwind':_0x3c45fb(0x9b)},{'$group':{'_id':_0x3c45fb(0x13f),'invoice':{'$first':_0x3c45fb(0x1a9)},'suppliers':{'$first':_0x3c45fb(0x146)},'date':{'$first':_0x3c45fb(0x118)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x3c45fb(0xf9)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3c45fb(0x82)},'batch_code':{'$first':_0x3c45fb(0x97)},'expiry_date':{'$first':_0x3c45fb(0x89)},'suppliers_docs':{'$first':_0x3c45fb(0x15f)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x3c45fb(0x71)},'isle':{'$addToSet':_0x3c45fb(0xf8)},'type':{'$addToSet':_0x3c45fb(0xaf)},'floorlevel':{'$addToSet':_0x3c45fb(0x177)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x34f6cf=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x3c45fb(0xda)}},{'$unwind':_0x3c45fb(0x9b)},{'$group':{'_id':_0x3c45fb(0x13f),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x3c45fb(0x76)},'product':{'$push':_0x3c45fb(0x9b)},'note':{'$first':_0x3c45fb(0x9e)},'paid_amount':{'$first':_0x3c45fb(0xce)},'due_amount':{'$first':_0x3c45fb(0xf0)},'return_data':{'$first':_0x3c45fb(0x82)},'batch_code':{'$first':_0x3c45fb(0x97)},'expiry_date':{'$first':_0x3c45fb(0x89)},'suppliers_docs':{'$first':_0x3c45fb(0x15f)},'total_product_quantity':{'$sum':_0x3c45fb(0xb1)},'level':{'$addToSet':_0x3c45fb(0x71)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3c45fb(0xaf)},'floorlevel':{'$addToSet':_0x3c45fb(0x177)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x36bb22[0x0]['language']==_0x3c45fb(0x10f))var _0x32050d=users[_0x3c45fb(0xf7)];else{if(_0x36bb22[0x0][_0x3c45fb(0x75)]==_0x3c45fb(0x1af))var _0x32050d=users[_0x3c45fb(0x1af)];else{if(_0x36bb22[0x0]['language']==_0x3c45fb(0x170))var _0x32050d=users[_0x3c45fb(0x170)];else{if(_0x36bb22[0x0][_0x3c45fb(0x75)]=='Spanish')var _0x32050d=users['Spanish'];else{if(_0x36bb22[0x0][_0x3c45fb(0x75)]==_0x3c45fb(0x98))var _0x32050d=users['French'];else{if(_0x36bb22[0x0][_0x3c45fb(0x75)]=='Portuguese\x20(BR)')var _0x32050d=users[_0x3c45fb(0x131)];else{if(_0x36bb22[0x0][_0x3c45fb(0x75)]==_0x3c45fb(0xeb))var _0x32050d=users['Chinese'];else{if(_0x36bb22[0x0][_0x3c45fb(0x75)]==_0x3c45fb(0xbb))var _0x32050d=users[_0x3c45fb(0x93)];}}}}}}}_0x2a6aa2[_0x3c45fb(0x67)]('all_purchases_finished_logs',{'success':_0x1399fc[_0x3c45fb(0x18d)](_0x3c45fb(0x143)),'errors':_0x1399fc[_0x3c45fb(0x18d)](_0x3c45fb(0xd6)),'purchases':_0x34f6cf,'role':_0x3472ed,'profile':_0x45e0bb,'master_shop':_0x36bb22,'language':_0x32050d});}catch(_0x4fefd1){console[_0x3c45fb(0x122)](_0x3c45fb(0xbf),_0x4fefd1),_0x2a6aa2[_0x3c45fb(0xc2)](0xc8)[_0x3c45fb(0x195)]({'message':_0x4fefd1['message']});}});function BayBinSelected(_0x129d4d,_0x3f5a39){var _0x582a59=a0_0x2a6b3c,_0x1d4448=[],_0x3b8ab0=[];if(_0x129d4d==_0x582a59(0xad)){switch(_0x3f5a39){case'Rack\x201':_0x1d4448=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x1d4448=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3b8ab0=['DG'];}else{if(_0x129d4d==_0x582a59(0x180)){switch(_0x3f5a39){case'Rack\x201':_0x1d4448=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x582a59(0x130):_0x1d4448=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3b8ab0=['FG'];}}return{'levels':_0x1d4448,'identify':_0x3b8ab0};}function a0_0x1bc5(_0x9c67fb,_0x4de65b){var _0x3c16f4=a0_0x3c16();return a0_0x1bc5=function(_0x1bc503,_0x28eff3){_0x1bc503=_0x1bc503-0x65;var _0x51ddbe=_0x3c16f4[_0x1bc503];return _0x51ddbe;},a0_0x1bc5(_0x9c67fb,_0x4de65b);}async function getRandom8DigitNumber(){var _0x4f3ed4=a0_0x2a6b3c;const _0x155e8f=0x989680,_0x62c5f5=0x5f5e0ff,_0x46e214=Math[_0x4f3ed4(0xe0)](Math['random']()*(_0x62c5f5-_0x155e8f+0x1))+_0x155e8f;var _0x31875e;const _0x290384=await purchases_finished[_0x4f3ed4(0x11c)]({'invoice':_0x4f3ed4(0xee)+_0x46e214});return _0x290384&&_0x290384['length']>0x0?_0x31875e=_0x4f3ed4(0xee)+_0x46e214:_0x31875e=_0x4f3ed4(0xee)+_0x46e214,_0x31875e;}router['get'](a0_0x2a6b3c(0x77),auth,async(_0x2a5f8c,_0x477a08)=>{var _0x299d02=a0_0x2a6b3c;try{const {username:_0x5c19ed,email:_0xdade3a,role:_0x39f7d3}=_0x2a5f8c['user'],_0x508043=_0x2a5f8c['user'],_0x5bad35=await profile[_0x299d02(0x11c)]({'email':_0x508043['email']}),_0x5020cb=await master_shop['find'](),_0x419d07=await staff[_0x299d02(0x11c)]({'email':_0x508043[_0x299d02(0x198)]}),_0x4ee0d7=await suppliers['find']({});let _0x25989d;if(_0x508043[_0x299d02(0x11f)]==_0x299d02(0x193)){const _0x32f5e2=await staff['findOne']({'email':_0x508043[_0x299d02(0x198)]});_0x25989d=await warehouse[_0x299d02(0x19f)]([{'$match':{'status':'Enabled','name':_0x32f5e2[_0x299d02(0xf1)]}},{'$group':{'_id':'$name','name':{'$first':_0x299d02(0x197)}}}]);}else _0x25989d=await warehouse['aggregate']([{'$match':{'status':_0x299d02(0x134)}},{'$group':{'_id':_0x299d02(0x197),'name':{'$first':_0x299d02(0x197)}}}]);const _0xf7e862=await product['find']({}),_0x5010d5=await warehouse[_0x299d02(0x138)]({'status':_0x299d02(0x134)}),_0x1a10db=await purchases_finished[_0x299d02(0x138)]({}),_0x4933ec=_0x1a10db[_0x299d02(0x7c)]+0x1,_0x5da231=_0x299d02(0xee)+_0x4933ec[_0x299d02(0x161)]()[_0x299d02(0xb3)](0x5,'0');var _0x3faa18=[_0x299d02(0x174),_0x299d02(0xc5)];if(_0x5020cb[0x0][_0x299d02(0x75)]==_0x299d02(0x10f))var _0x4dda64=users[_0x299d02(0xf7)];else{if(_0x5020cb[0x0][_0x299d02(0x75)]==_0x299d02(0x1af))var _0x4dda64=users[_0x299d02(0x1af)];else{if(_0x5020cb[0x0]['language']==_0x299d02(0x170))var _0x4dda64=users[_0x299d02(0x170)];else{if(_0x5020cb[0x0][_0x299d02(0x75)]=='Spanish')var _0x4dda64=users['Spanish'];else{if(_0x5020cb[0x0][_0x299d02(0x75)]==_0x299d02(0x98))var _0x4dda64=users[_0x299d02(0x98)];else{if(_0x5020cb[0x0][_0x299d02(0x75)]==_0x299d02(0xc7))var _0x4dda64=users[_0x299d02(0x131)];else{if(_0x5020cb[0x0]['language']=='Chinese')var _0x4dda64=users['Chinese'];else{if(_0x5020cb[0x0][_0x299d02(0x75)]=='Arabic\x20(ae)')var _0x4dda64=users[_0x299d02(0x93)];}}}}}}}const _0x17a336=getRandom8DigitNumber(),_0x4ccb20=new Date(),_0xb96133={'year':_0x299d02(0x88),'month':_0x299d02(0x19d),'day':'2-digit','timeZone':_0x299d02(0xe6)},_0xec26bb=_0x4ccb20[_0x299d02(0xaa)](_0x299d02(0x70),_0xb96133);console[_0x299d02(0x122)](_0xec26bb),_0x17a336['then'](_0x728213=>{var _0x218ddb=_0x299d02;_0x477a08['render']('add_purchases_finished',{'success':_0x2a5f8c[_0x218ddb(0x18d)](_0x218ddb(0x143)),'errors':_0x2a5f8c[_0x218ddb(0x18d)]('errors'),'role':_0x508043,'profile':_0x5bad35,'suppliers':_0x4ee0d7,'warehouse':_0x25989d,'product':_0xf7e862,'invoice':_0x728213,'master_shop':_0x5020cb,'language':_0x4dda64,'find_data':_0x5010d5,'rooms_data':_0x3faa18,'formattedDate':_0xec26bb});})[_0x299d02(0x167)](_0x64f732=>{var _0x437f5c=_0x299d02;_0x2a5f8c[_0x437f5c(0x18d)](_0x437f5c(0xd6),_0x437f5c(0xa3)),_0x477a08[_0x437f5c(0x15a)](_0x437f5c(0x7d));});}catch(_0x4a45eb){console[_0x299d02(0x122)](_0x4a45eb);}}),router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0x14b),auth,async(_0xcf6d9a,_0x362a3f)=>{var _0x20094=a0_0x2a6b3c;try{const {username:_0x3fa2da,email:_0x186955,role:_0x435d64}=_0xcf6d9a['user'],_0x211a33=_0xcf6d9a[_0x20094(0x16e)],_0x5d2869=await profile[_0x20094(0x11c)]({'email':_0x211a33[_0x20094(0x198)]}),_0x32112c=await master_shop['find'](),_0x3706a5=await staff[_0x20094(0x11c)]({'email':_0x211a33[_0x20094(0x198)]}),_0x45da9e=await suppliers[_0x20094(0x138)]({});let _0x4a2f98;if(_0x211a33[_0x20094(0x11f)]==_0x20094(0x193)){const _0x184193=await staff[_0x20094(0x11c)]({'email':_0x211a33[_0x20094(0x198)]});_0x4a2f98=await warehouse[_0x20094(0x19f)]([{'$match':{'status':_0x20094(0x134),'name':_0x184193[_0x20094(0xf1)]}},{'$group':{'_id':_0x20094(0x197),'name':{'$first':_0x20094(0x197)}}}]);}else _0x4a2f98=await warehouse[_0x20094(0x19f)]([{'$match':{'status':_0x20094(0x134)}},{'$group':{'_id':_0x20094(0x197),'name':{'$first':'$name'}}}]);const _0x12469c=await product[_0x20094(0x138)]({}),_0x5e9400=await warehouse['find']({'status':_0x20094(0x134)}),_0x65c2f2=await purchases_finished[_0x20094(0x138)]({}),_0x2b4b20=_0x65c2f2[_0x20094(0x7c)]+0x1,_0xd468b7='INCF-'+_0x2b4b20['toString']()['padStart'](0x5,'0');var _0x543ca4=[_0x20094(0x174),_0x20094(0xc5)];if(_0x32112c[0x0][_0x20094(0x75)]==_0x20094(0x10f))var _0x587b64=users[_0x20094(0xf7)];else{if(_0x32112c[0x0][_0x20094(0x75)]==_0x20094(0x1af))var _0x587b64=users[_0x20094(0x1af)];else{if(_0x32112c[0x0][_0x20094(0x75)]==_0x20094(0x170))var _0x587b64=users[_0x20094(0x170)];else{if(_0x32112c[0x0]['language']==_0x20094(0xfb))var _0x587b64=users['Spanish'];else{if(_0x32112c[0x0][_0x20094(0x75)]=='French')var _0x587b64=users[_0x20094(0x98)];else{if(_0x32112c[0x0][_0x20094(0x75)]=='Portuguese\x20(BR)')var _0x587b64=users[_0x20094(0x131)];else{if(_0x32112c[0x0][_0x20094(0x75)]==_0x20094(0xeb))var _0x587b64=users[_0x20094(0xeb)];else{if(_0x32112c[0x0]['language']==_0x20094(0xbb))var _0x587b64=users[_0x20094(0x93)];}}}}}}}const _0x3f9cd1=getRandom8DigitNumber();_0x3f9cd1[_0x20094(0x111)](_0x577305=>{var _0x3fd81b=_0x20094;_0x362a3f['render'](_0x3fd81b(0xdd),{'success':_0xcf6d9a['flash']('success'),'errors':_0xcf6d9a[_0x3fd81b(0x18d)](_0x3fd81b(0xd6)),'role':_0x211a33,'profile':_0x5d2869,'suppliers':_0x45da9e,'warehouse':_0x4a2f98,'product':_0x12469c,'invoice':_0x577305,'master_shop':_0x32112c,'language':_0x587b64,'find_data':_0x5e9400,'rooms_data':_0x543ca4});})[_0x20094(0x167)](_0x1382d6=>{var _0x523623=_0x20094;_0xcf6d9a[_0x523623(0x18d)](_0x523623(0xd6),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x362a3f[_0x523623(0x15a)](_0x523623(0x7d));});}catch(_0x14e63f){console[_0x20094(0x122)](_0x14e63f);}}),router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0x132),auth,async(_0x222ed7,_0x50e9bd)=>{var _0x4244c2=a0_0x2a6b3c;try{const _0x51c8f6=_0x222ed7[_0x4244c2(0x104)]['id'];console[_0x4244c2(0x122)](_0x51c8f6);const _0x2b580c=await master_shop[_0x4244c2(0x138)]();console['log'](_0x4244c2(0x12f),_0x2b580c);const _0x14d9b9=await product[_0x4244c2(0x11c)]({'name':_0x51c8f6});console[_0x4244c2(0x122)]('product',_0x14d9b9),_0x50e9bd[_0x4244c2(0xc2)](0xc8)['json']({'product_data':_0x14d9b9,'master':_0x2b580c});}catch(_0x24c53f){console[_0x4244c2(0x122)](_0x4244c2(0x10d),_0x24c53f);}}),router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0x77),auth,async(_0x5def11,_0x497b73)=>{var _0x52da6e=a0_0x2a6b3c;try{const {invoice:_0x434a30,date:_0x3de22a,warehouse_name:_0x5341ca,prod_name:_0x8cab50,note:_0x4d43f9,due_amount:_0xd0b221,Room_name:_0x4ce5ff,PO_number:_0x63f66f,SCRN:_0x2c5401,ReqBy:_0xb7f0ea,dateofreq:_0x38c0a2,suppliers:_0x2db66b,typeservicesData:_0x195604,van:_0x28a415,typevehicle:_0x58e553,driver:_0x36f31c,plate:_0x56babe,DRSI:_0x378c32,TSU:_0x263cc5,TFU:_0x3c53ca,JO_number:_0xc67bdb,type_of_products:_0x59bce1}=_0x5def11[_0x52da6e(0x11a)];if(typeof _0x8cab50==_0x52da6e(0x12e))var _0x136f85=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x90)]],_0x1f01f9=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0xb6)]],_0x142b98=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x18e)]],_0x457600=[_0x5def11[_0x52da6e(0x11a)]['prod_primunit']],_0x24418a=[_0x5def11['body'][_0x52da6e(0xd7)]],_0x122e52=[_0x5def11['body'][_0x52da6e(0x14d)]],_0x40bf1c=[_0x5def11['body']['secondary_code']],_0x5456b6=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0xfc)]],_0x43603d=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0xe3)]],_0x200929=[_0x5def11['body'][_0x52da6e(0x7a)]],_0x217213=[_0x5def11[_0x52da6e(0x11a)]['product_date']],_0x29b7fb=[_0x5def11[_0x52da6e(0x11a)]['max_product_unit']],_0x3ca4a6=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x17e)]],_0x43132b=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x1b0)]],_0x44c71b=[_0x5def11[_0x52da6e(0x11a)]['uuid']],_0x39786b=[_0x5def11['body'][_0x52da6e(0xcc)]],_0x213a6b=[_0x5def11[_0x52da6e(0x11a)][_0x52da6e(0xc6)]];else var _0x136f85=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x90)]],_0x1f01f9=[..._0x5def11['body']['prod_code']],_0x142b98=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x18e)]],_0x457600=[..._0x5def11['body'][_0x52da6e(0x12d)]],_0x24418a=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0xd7)]],_0x122e52=[..._0x5def11['body'][_0x52da6e(0x14d)]],_0x40bf1c=[..._0x5def11[_0x52da6e(0x11a)]['secondary_code']],_0x5456b6=[..._0x5def11['body'][_0x52da6e(0xfc)]],_0x43603d=[..._0x5def11['body'][_0x52da6e(0xe3)]],_0x200929=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x7a)]],_0x217213=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x15d)]],_0x29b7fb=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x14f)]],_0x3ca4a6=[..._0x5def11[_0x52da6e(0x11a)]['prod_cat']],_0x43132b=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x1b0)]],_0x44c71b=[..._0x5def11[_0x52da6e(0x11a)][_0x52da6e(0x191)]],_0x39786b=[..._0x5def11[_0x52da6e(0x11a)]['sales_data_cateory']],_0x213a6b=[..._0x5def11['body'][_0x52da6e(0xc6)]];const _0x257abb=_0x136f85[_0x52da6e(0xa1)](_0x6d241d=>{return _0x6d241d={'product_name':_0x6d241d};});_0x213a6b[_0x52da6e(0x17b)]((_0x411fb2,_0xe2bb49)=>{var _0x3ea52c=_0x52da6e;_0x257abb[_0xe2bb49]['product_id']=_0x411fb2,_0x257abb[_0xe2bb49][_0x3ea52c(0x84)]=_0x3de22a;}),_0x39786b['forEach']((_0x1026f8,_0x530af3)=>{_0x257abb[_0x530af3]['sales_category']=_0x1026f8;}),_0x1f01f9['forEach']((_0x468bac,_0x23c745)=>{var _0x427780=_0x52da6e;_0x257abb[_0x23c745][_0x427780(0xea)]=_0x468bac;}),_0x44c71b['forEach']((_0x5d008f,_0x2ef26a)=>{var _0x346d0a=_0x52da6e;_0x257abb[_0x2ef26a][_0x346d0a(0x191)]=_0x5d008f;}),_0x142b98[_0x52da6e(0x17b)]((_0xd5856d,_0x24cfa4)=>{var _0x248e6b=_0x52da6e;_0x257abb[_0x24cfa4][_0x248e6b(0xd8)]=Math[_0x248e6b(0x110)](_0xd5856d);}),_0x457600[_0x52da6e(0x17b)]((_0x224dc4,_0x5f008a)=>{var _0x43c7e1=_0x52da6e;_0x257abb[_0x5f008a][_0x43c7e1(0x13e)]=_0x224dc4;}),_0x24418a[_0x52da6e(0x17b)]((_0x33ee64,_0x4174e7)=>{var _0x3f6667=_0x52da6e;_0x257abb[_0x4174e7][_0x3f6667(0x1aa)]=_0x33ee64;}),_0x122e52[_0x52da6e(0x17b)]((_0x5cc340,_0x78e2e9)=>{var _0x387c44=_0x52da6e;_0x257abb[_0x78e2e9][_0x387c44(0x14d)]=_0x5cc340;}),_0x40bf1c[_0x52da6e(0x17b)]((_0x2b39ce,_0x4971eb)=>{var _0x5501db=_0x52da6e;_0x257abb[_0x4971eb][_0x5501db(0x14a)]=_0x2b39ce;}),_0x5456b6[_0x52da6e(0x17b)]((_0x2b6cdb,_0xdd128f)=>{var _0x263591=_0x52da6e;_0x257abb[_0xdd128f][_0x263591(0x16f)]=_0x2b6cdb;}),_0x43603d[_0x52da6e(0x17b)]((_0x239294,_0x2ad8f9)=>{var _0x107f19=_0x52da6e;_0x257abb[_0x2ad8f9][_0x107f19(0xe3)]=_0x239294;}),_0x200929[_0x52da6e(0x17b)]((_0x2e02b0,_0x34e1d6)=>{_0x257abb[_0x34e1d6]['expiry_date']=_0x2e02b0;}),_0x217213[_0x52da6e(0x17b)]((_0x1974da,_0x4e9e08)=>{var _0xf54305=_0x52da6e;_0x257abb[_0x4e9e08][_0xf54305(0x121)]=_0x1974da;}),_0x29b7fb[_0x52da6e(0x17b)]((_0x51a8e7,_0x5ba901)=>{var _0x4732ac=_0x52da6e;_0x257abb[_0x5ba901][_0x4732ac(0x106)]=_0x51a8e7;}),_0x3ca4a6[_0x52da6e(0x17b)]((_0x240271,_0x2c36e0)=>{_0x257abb[_0x2c36e0]['product_cat']=_0x240271;}),_0x43132b[_0x52da6e(0x17b)]((_0x408751,_0x3742fa)=>{var _0x25854c=_0x52da6e;_0x257abb[_0x3742fa][_0x25854c(0x1b0)]=_0x408751;});const _0x258e86=new invoice_for_incoming();await _0x258e86[_0x52da6e(0x190)]();for(let _0x4cb2cf=0x0;_0x4cb2cf<=_0x136f85['length']-0x1;_0x4cb2cf++){_0x257abb[_0x4cb2cf]['invoice']=_0x52da6e(0xc1)+_0x258e86[_0x52da6e(0xa9)][_0x52da6e(0x161)]()[_0x52da6e(0xb3)](0x8,'0');}const _0x522b10=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x5341ca}}]);for(let _0x2de8d2=0x0;_0x2de8d2<=_0x522b10['length']-0x1;_0x2de8d2++){const _0x5d6a2f=_0x522b10[_0x2de8d2];for(let _0x49139c=0x0;_0x49139c<=_0x5d6a2f[_0x52da6e(0x11e)]['length']-0x1;_0x49139c++){const _0xa5001d=_0x5d6a2f[_0x52da6e(0x11e)][_0x49139c],_0x250f53=await warehouse[_0x52da6e(0x19f)]([{'$match':{'name':_0x5d6a2f['warehouse_name'],'room':_0x5d6a2f['room']}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0xa5001d[_0x52da6e(0x16b)],'product_details.bay':parseInt(_0xa5001d[_0x52da6e(0xd2)]),'product_details.product_code':_0xa5001d[_0x52da6e(0xea)]}}]);for(let _0x2ce375=0x0;_0x2ce375<=_0x250f53['length']-0x1;_0x2ce375++){let _0x36db35=_0x250f53[_0x2ce375],_0x4860ba=0x0;_0x36db35[_0x52da6e(0x8b)][_0x52da6e(0xea)]==_0xa5001d[_0x52da6e(0xea)]&&_0x36db35[_0x52da6e(0x8b)]['bay']==_0xa5001d['bin']&&_0x36db35[_0x52da6e(0x8b)]['level']==_0xa5001d[_0x52da6e(0x16b)]&&(_0xa5001d[_0x52da6e(0x9c)]=parseInt(_0xa5001d[_0x52da6e(0x9c)])-parseInt(_0x36db35[_0x52da6e(0x8b)][_0x52da6e(0x199)]),_0x4860ba++),_0x4860ba=='0'&&(parseInt(_0xa5001d['max'])>0x0&&(_0x522b10[_0x2de8d2][_0x52da6e(0x11e)]=_0x522b10[_0x2de8d2][_0x52da6e(0x11e)][_0x52da6e(0xca)]({'bay':_0xa5001d[_0x52da6e(0x16b)],'bin':_0xa5001d[_0x52da6e(0xd2)],'max':_0xa5001d['max'],'min':_0xa5001d[_0x52da6e(0x12c)],'product_code':_0xa5001d[_0x52da6e(0xea)],'product_id':_0xa5001d[_0x52da6e(0xc6)],'product_name':_0xa5001d[_0x52da6e(0x1a1)]})));}}_0x522b10[_0x2de8d2][_0x52da6e(0x11e)]=_0x522b10[_0x2de8d2][_0x52da6e(0x11e)]['filter'](_0x1d7783=>parseInt(_0x1d7783[_0x52da6e(0x9c)])>0x0);}for(let _0x392650=0x0;_0x392650<=_0x522b10['length']-0x1;_0x392650++){const _0x13a38d=_0x522b10[_0x392650];for(let _0x39fac2=0x0;_0x39fac2<=_0x13a38d[_0x52da6e(0x11e)][_0x52da6e(0x7c)]-0x1;_0x39fac2++){const _0xef8606=_0x13a38d[_0x52da6e(0x11e)][_0x39fac2],_0xac64e2=await warehouse_temporary[_0x52da6e(0x19f)]([{'$match':{'warehouse':_0x13a38d[_0x52da6e(0x6a)],'room_name':_0x13a38d[_0x52da6e(0x148)],'isConfirm':'false','data_type':_0x52da6e(0x9a),'product_code':_0xef8606['product_code'],'level':_0xef8606[_0x52da6e(0x16b)],'bay':parseInt(_0xef8606[_0x52da6e(0xd2)])}}]);for(let _0x123952=0x0;_0x123952<=_0xac64e2[_0x52da6e(0x7c)]-0x1;_0x123952++){let _0x578517=_0xac64e2[_0x123952];console[_0x52da6e(0x122)](_0x578517);let _0x4e2a58=0x0;_0x578517[_0x52da6e(0xea)]==_0xef8606['product_code']&&_0x578517[_0x52da6e(0x16b)]==_0xef8606[_0x52da6e(0xd2)]&&_0x578517['level']==_0xef8606['bay']&&(_0xef8606[_0x52da6e(0x9c)]=parseInt(_0xef8606[_0x52da6e(0x9c)])-parseInt(_0x578517[_0x52da6e(0x199)]),_0x4e2a58++),_0x4e2a58=='0'&&(parseInt(_0xef8606['max'])>0x0&&(_0x522b10[_0x392650]['product_data']=_0x522b10[_0x392650]['product_data']['concat']({'bay':_0xef8606[_0x52da6e(0x16b)],'bin':_0xef8606[_0x52da6e(0xd2)],'max':_0xef8606[_0x52da6e(0x9c)],'min':_0xef8606[_0x52da6e(0x12c)],'product_code':_0xef8606[_0x52da6e(0xea)],'product_id':_0xef8606['product_id'],'product_name':_0xef8606[_0x52da6e(0x1a1)]})));}}_0x522b10[_0x392650]['product_data']=_0x522b10[_0x392650][_0x52da6e(0x11e)][_0x52da6e(0x14e)](_0x29e6b5=>parseInt(_0x29e6b5[_0x52da6e(0x9c)])>0x0);}let _0xf83fba=[],_0x1dc66c=0x0;for(let _0x5ea4c2=0x0;_0x5ea4c2<=_0x257abb[_0x52da6e(0x7c)]-0x1;_0x5ea4c2++){const _0x1d4d71=_0x257abb[_0x5ea4c2];let _0x508512=_0x1d4d71['quantity'];for(let _0x339c38=0x0;_0x339c38<=_0x522b10[_0x52da6e(0x7c)]-0x1;_0x339c38++){const _0x2ba2f4=_0x522b10[_0x339c38];for(let _0x1ff834=0x0;_0x1ff834<=_0x2ba2f4['product_data'][_0x52da6e(0x7c)]-0x1;_0x1ff834++){const _0x256242=_0x2ba2f4[_0x52da6e(0x11e)][_0x1ff834];if(_0x256242[_0x52da6e(0xea)]===_0x1d4d71[_0x52da6e(0xea)]){const _0x41599b=await warehouse[_0x52da6e(0x19f)]([{'$match':{'name':_0x5341ca,'room':_0x2ba2f4['room']}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x256242[_0x52da6e(0x16b)],'product_details.bay':parseInt(_0x256242[_0x52da6e(0xd2)])}}]);if(_0x41599b[_0x52da6e(0x7c)]==0x0){for(let _0x1363de=0x0;_0x1363de<=_0x2ba2f4[_0x52da6e(0x11e)][_0x52da6e(0x7c)]-0x1&&_0x508512>0x0;_0x1363de++){const _0xad7fd4=_0x2ba2f4[_0x52da6e(0x11e)][_0x1363de];console[_0x52da6e(0x122)](_0x1d4d71[_0x52da6e(0xea)]+_0x52da6e(0x1b2)+_0xad7fd4[_0x52da6e(0xea)]+_0x52da6e(0x144)+_0xad7fd4[_0x52da6e(0x12c)]+_0x52da6e(0x144)+_0xad7fd4[_0x52da6e(0x9c)]+_0x52da6e(0x144)+_0xad7fd4[_0x52da6e(0x16b)]+_0x52da6e(0x144)+_0xad7fd4['bin']);if(_0x1d4d71['product_code']===_0xad7fd4['product_code']){_0xf83fba[_0x1dc66c]={};const _0x4ca4e9=parseInt(_0xad7fd4[_0x52da6e(0x9c)]),_0x1c7358=0x0;let _0x5caa35=_0x4ca4e9-_0x1c7358,_0x275089=Math[_0x52da6e(0x12c)](_0x508512,_0x5caa35);console[_0x52da6e(0x122)](_0x52da6e(0x69)+_0x275089+_0x52da6e(0x13c)+_0x1d4d71[_0x52da6e(0x1a1)]+_0x52da6e(0x164)+_0x2ba2f4[_0x52da6e(0x6a)]+',\x20room:\x20'+_0x2ba2f4[_0x52da6e(0x148)]+_0x52da6e(0xab)+_0xad7fd4[_0x52da6e(0x16b)]+_0x52da6e(0x145)+_0xad7fd4['bin']+'\x20inc\x20=\x20'+_0x1dc66c),_0xf83fba[_0x1dc66c][_0x52da6e(0x1a1)]=_0x1d4d71[_0x52da6e(0x1a1)],_0xf83fba[_0x1dc66c][_0x52da6e(0xea)]=_0x1d4d71['product_code'],_0xf83fba[_0x1dc66c][_0x52da6e(0xc6)]=_0x1d4d71[_0x52da6e(0xc6)],_0xf83fba[_0x1dc66c][_0x52da6e(0x84)]=_0x1d4d71[_0x52da6e(0x84)],_0xf83fba[_0x1dc66c]['sales_category']=_0x1d4d71[_0x52da6e(0x169)],_0xf83fba[_0x1dc66c][_0x52da6e(0x191)]=_0x1d4d71[_0x52da6e(0x191)],_0xf83fba[_0x1dc66c]['quantity']=_0x275089,_0xf83fba[_0x1dc66c]['standard_unit']=_0x1d4d71[_0x52da6e(0x13e)],_0xf83fba[_0x1dc66c]['secondary_unit']=_0x1d4d71[_0x52da6e(0x1aa)],_0xf83fba[_0x1dc66c][_0x52da6e(0x14d)]=_0x1d4d71[_0x52da6e(0x14d)],_0xf83fba[_0x1dc66c]['secondary_code']=_0x1d4d71['secondary_code'],_0xf83fba[_0x1dc66c]['maxStocks']=_0x1d4d71[_0x52da6e(0x16f)],_0xf83fba[_0x1dc66c][_0x52da6e(0xe3)]=_0x1d4d71['batch_code'],_0xf83fba[_0x1dc66c][_0x52da6e(0x7a)]=_0x1d4d71[_0x52da6e(0x7a)],_0xf83fba[_0x1dc66c][_0x52da6e(0x121)]=_0x1d4d71[_0x52da6e(0x121)],_0xf83fba[_0x1dc66c][_0x52da6e(0x106)]=_0x1d4d71[_0x52da6e(0x106)],_0xf83fba[_0x1dc66c]['product_cat']=_0x1d4d71[_0x52da6e(0x154)],_0xf83fba[_0x1dc66c][_0x52da6e(0x185)]=_0x1d4d71[_0x52da6e(0x185)],_0xf83fba[_0x1dc66c][_0x52da6e(0x1b0)]=_0x1d4d71[_0x52da6e(0x1b0)],_0xf83fba[_0x1dc66c][_0x52da6e(0x155)]=_0x2ba2f4[_0x52da6e(0x148)],_0xf83fba[_0x1dc66c][_0x52da6e(0x105)]=_0xad7fd4[_0x52da6e(0x16b)],_0xf83fba[_0x1dc66c][_0x52da6e(0x16b)]=_0xad7fd4[_0x52da6e(0xd2)],_0x508512-=_0x275089,_0x1dc66c++;if(_0x508512<=0x0)break;}}if(_0x508512<=0x0){_0x5def11[_0x52da6e(0x18d)](_0x52da6e(0xd6),_0x52da6e(0x1a3)+_0x508512+_0x52da6e(0x182));break;}if(_0x508512>0x0){console[_0x52da6e(0x122)]('There\x20is\x20'+_0x508512+_0x52da6e(0xde));break;}}}}}if(_0x508512>0x0){const _0x5d80d0=await warehouse[_0x52da6e(0x19f)]([{'$match':{'name':_0x5341ca,'isStaging':_0x52da6e(0xd0)}}]);_0xf83fba[_0x1dc66c]={},_0xf83fba[_0x1dc66c][_0x52da6e(0x1a1)]=_0x1d4d71[_0x52da6e(0x1a1)],_0xf83fba[_0x1dc66c][_0x52da6e(0xea)]=_0x1d4d71[_0x52da6e(0xea)],_0xf83fba[_0x1dc66c]['product_id']=_0x1d4d71[_0x52da6e(0xc6)],_0xf83fba[_0x1dc66c]['date_recieved']=_0x1d4d71[_0x52da6e(0x84)],_0xf83fba[_0x1dc66c][_0x52da6e(0x169)]=_0x1d4d71['sales_category'],_0xf83fba[_0x1dc66c][_0x52da6e(0x191)]=_0x1d4d71[_0x52da6e(0x191)],_0xf83fba[_0x1dc66c]['quantity']=_0x508512,_0xf83fba[_0x1dc66c][_0x52da6e(0x13e)]=_0x1d4d71[_0x52da6e(0x13e)],_0xf83fba[_0x1dc66c][_0x52da6e(0x1aa)]=_0x1d4d71['secondary_unit'],_0xf83fba[_0x1dc66c][_0x52da6e(0x14d)]=_0x1d4d71[_0x52da6e(0x14d)],_0xf83fba[_0x1dc66c]['secondary_code']=_0x1d4d71[_0x52da6e(0x14a)],_0xf83fba[_0x1dc66c][_0x52da6e(0x16f)]=_0x1d4d71[_0x52da6e(0x16f)],_0xf83fba[_0x1dc66c]['batch_code']=_0x1d4d71['batch_code'],_0xf83fba[_0x1dc66c][_0x52da6e(0x7a)]=_0x1d4d71[_0x52da6e(0x7a)],_0xf83fba[_0x1dc66c]['production_date']=_0x1d4d71[_0x52da6e(0x121)],_0xf83fba[_0x1dc66c]['maxperunit']=_0x1d4d71[_0x52da6e(0x106)],_0xf83fba[_0x1dc66c][_0x52da6e(0x154)]=_0x1d4d71[_0x52da6e(0x154)],_0xf83fba[_0x1dc66c]['invoice']=_0x1d4d71[_0x52da6e(0x185)],_0xf83fba[_0x1dc66c]['gross_price']=_0x1d4d71[_0x52da6e(0x1b0)],_0xf83fba[_0x1dc66c]['room_name']=_0x5d80d0[0x0][_0x52da6e(0x148)],_0xf83fba[_0x1dc66c]['level']='STAGING',_0xf83fba[_0x1dc66c][_0x52da6e(0x16b)]='1',console[_0x52da6e(0x122)](_0x52da6e(0xac)+_0x52da6e(0x144)+_0x1d4d71['product_code']+_0x52da6e(0x16c)+_0x1d4d71['product_code']+_0x52da6e(0x144)+_0x1dc66c+_0x52da6e(0x144)+_0x508512),_0x5def11[_0x52da6e(0x18d)](_0x52da6e(0xd6),_0x52da6e(0x1a3)+_0x508512+_0x52da6e(0x187));}}const _0x1819b2=_0xf83fba[_0x52da6e(0x14e)](_0xdfe9e8=>_0xdfe9e8[_0x52da6e(0xd8)]!=='0'&&_0xdfe9e8[_0x52da6e(0xd8)]!==''),_0x10c339=new purchases_finished({'invoice':_0x52da6e(0xc1)+_0x258e86[_0x52da6e(0xa9)][_0x52da6e(0x161)]()[_0x52da6e(0xb3)](0x8,'0'),'suppliers':_0x2db66b,'date':_0x3de22a,'warehouse_name':_0x5341ca,'product':_0x1819b2,'note':_0x4d43f9,'due_amount':_0xd0b221,'room':_0x4ce5ff,'POnumber':_0x63f66f,'SCRN':_0x2c5401,'JO_number':_0xc67bdb,'ReqBy':_0xb7f0ea,'dateofreq':_0x38c0a2,'typeservicesData':_0x195604,'van':_0x28a415,'typevehicle':_0x58e553,'driver':_0x36f31c,'plate':_0x56babe,'DRSI':_0x378c32,'TSU':_0x263cc5,'TFU':_0x3c53ca,'typeOfProducts':_0x59bce1}),_0x477cce=await _0x10c339['save'](),_0xcc3022=await purchases_finished[_0x52da6e(0x11c)]({'_id':_0x477cce[_0x52da6e(0x8e)][_0x52da6e(0x1ae)]()});_0x5def11[_0x52da6e(0x18d)](_0x52da6e(0x143),_0x52da6e(0xb7)),_0x497b73[_0x52da6e(0x15a)](_0x52da6e(0xbc)+_0xcc3022['_id'][_0x52da6e(0x1ae)]());}catch(_0x5a575a){console[_0x52da6e(0x122)](_0x5a575a);}}),router['get'](a0_0x2a6b3c(0x65),auth,async(_0x4b4d47,_0x4dd9d2)=>{var _0x214398=a0_0x2a6b3c;try{const {username:_0x45bdea,email:_0x1fc850,role:_0x2c3086}=_0x4b4d47[_0x214398(0x16e)],_0x71fffe=_0x4b4d47[_0x214398(0x16e)],_0x280b85=_0x4b4d47['params']['id'],_0x526836=await profile[_0x214398(0x11c)]({'email':_0x71fffe[_0x214398(0x198)]}),_0x39474d=await master_shop[_0x214398(0x138)](),_0x4a80ad=await staff['findOne']({'email':_0x71fffe[_0x214398(0x198)]}),_0xe423a5=await suppliers[_0x214398(0x138)]({});let _0x5cdfb0;if(_0x71fffe[_0x214398(0x11f)]=='staff'){const _0x3885ca=await staff[_0x214398(0x11c)]({'email':_0x71fffe[_0x214398(0x198)]});_0x5cdfb0=await warehouse[_0x214398(0x19f)]([{'$match':{'status':_0x214398(0x134),'name':_0x3885ca[_0x214398(0xf1)]}},{'$group':{'_id':_0x214398(0x197),'name':{'$first':'$name'}}}]);}else _0x5cdfb0=await warehouse[_0x214398(0x19f)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x214398(0x197)}}}]);const _0x26681e=await purchases_finished[_0x214398(0xe5)](_0x280b85);if(_0x39474d[0x0][_0x214398(0x75)]==_0x214398(0x10f))var _0x4925e9=users[_0x214398(0xf7)];else{if(_0x39474d[0x0][_0x214398(0x75)]==_0x214398(0x1af))var _0x4925e9=users['Hindi'];else{if(_0x39474d[0x0]['language']==_0x214398(0x170))var _0x4925e9=users[_0x214398(0x170)];else{if(_0x39474d[0x0]['language']==_0x214398(0xfb))var _0x4925e9=users[_0x214398(0xfb)];else{if(_0x39474d[0x0][_0x214398(0x75)]==_0x214398(0x98))var _0x4925e9=users[_0x214398(0x98)];else{if(_0x39474d[0x0][_0x214398(0x75)]==_0x214398(0xc7))var _0x4925e9=users[_0x214398(0x131)];else{if(_0x39474d[0x0][_0x214398(0x75)]=='Chinese')var _0x4925e9=users[_0x214398(0xeb)];else{if(_0x39474d[0x0]['language']=='Arabic\x20(ae)')var _0x4925e9=users[_0x214398(0x93)];}}}}}}}_0x4dd9d2[_0x214398(0x67)]('purchases_process',{'success':_0x4b4d47[_0x214398(0x18d)](_0x214398(0x143)),'errors':_0x4b4d47[_0x214398(0x18d)](_0x214398(0xd6)),'role':_0x71fffe,'profile':_0x526836,'suppliers':_0xe423a5,'warehouse':_0x5cdfb0,'master_shop':_0x39474d,'language':_0x4925e9,'purchases_data':_0x26681e});}catch(_0x3a90a2){console['log'](_0x3a90a2);}});async function get_warehouse_data(_0x3ad635,_0x5005da){var _0x2bd5a7=a0_0x2a6b3c;try{const _0xee85c0=await warehouse_temporary[_0x2bd5a7(0x11c)]({'name':_0x3ad635,'room':_0x5005da});if(!_0xee85c0){const _0x36b7fb=new warehouse_temporary({'name':_0x3ad635,'address':_0x3ad635,'status':'Enabled','room':_0x5005da,'isStaging':_0x2bd5a7(0x6e)});return await _0x36b7fb[_0x2bd5a7(0x190)](),_0x36b7fb;}else return _0xee85c0;}catch(_0x2eedbb){console[_0x2bd5a7(0xb0)]('Error\x20fetching\x20or\x20saving\x20warehouse\x20data:',_0x2eedbb);throw _0x2eedbb;}}router['post']('/process/:id',auth,async(_0xd31d28,_0x3c8092)=>{var _0x649e71=a0_0x2a6b3c;try{const _0x41abe9=_0xd31d28[_0x649e71(0x104)]['id'],_0x1372dd=await purchases_finished[_0x649e71(0xe5)](_0x41abe9);let _0x56524b=[];_0x1372dd[_0x649e71(0xc4)][_0x649e71(0x17b)]((_0x2532c4,_0x18bda7)=>{var _0x14a64c=_0x649e71;_0x56524b[_0x18bda7]={},_0x56524b[_0x18bda7][_0x14a64c(0xf1)]=_0x1372dd[_0x14a64c(0x6a)],_0x56524b[_0x18bda7][_0x14a64c(0xc6)]=_0x2532c4['product_id'],_0x56524b[_0x18bda7]['product_name']=_0x2532c4[_0x14a64c(0x1a1)],_0x56524b[_0x18bda7][_0x14a64c(0xea)]=_0x2532c4[_0x14a64c(0xea)],_0x56524b[_0x18bda7][_0x14a64c(0x199)]=_0x2532c4['quantity'],_0x56524b[_0x18bda7][_0x14a64c(0x7e)]=_0x2532c4['standard_unit'],_0x56524b[_0x18bda7][_0x14a64c(0x1aa)]=_0x2532c4[_0x14a64c(0x1aa)],_0x56524b[_0x18bda7][_0x14a64c(0x105)]=_0x2532c4[_0x14a64c(0x105)],_0x56524b[_0x18bda7][_0x14a64c(0x16b)]=_0x2532c4[_0x14a64c(0x16b)],_0x56524b[_0x18bda7][_0x14a64c(0x14d)]=_0x2532c4[_0x14a64c(0x14d)],_0x56524b[_0x18bda7]['secondary_code']=_0x2532c4['secondary_code'],_0x56524b[_0x18bda7]['maxStocks']=_0x2532c4[_0x14a64c(0x16f)],_0x56524b[_0x18bda7]['batch_code']=_0x2532c4[_0x14a64c(0xe3)],_0x56524b[_0x18bda7][_0x14a64c(0x7a)]=_0x2532c4[_0x14a64c(0x7a)],_0x56524b[_0x18bda7]['production_date']=_0x2532c4[_0x14a64c(0x121)],_0x56524b[_0x18bda7][_0x14a64c(0x106)]=_0x2532c4['maxperunit'],_0x56524b[_0x18bda7][_0x14a64c(0x154)]=_0x2532c4[_0x14a64c(0x154)],_0x56524b[_0x18bda7][_0x14a64c(0x155)]=_0x2532c4['room_name'],_0x56524b[_0x18bda7][_0x14a64c(0x185)]=_0x2532c4['invoice'],_0x56524b[_0x18bda7][_0x14a64c(0x191)]=_0x2532c4[_0x14a64c(0x191)],_0x56524b[_0x18bda7]['gross_price']=_0x2532c4[_0x14a64c(0x1b0)],_0x56524b[_0x18bda7][_0x14a64c(0x169)]=_0x2532c4[_0x14a64c(0x169)],_0x56524b[_0x18bda7]['date_recieved']=_0x2532c4[_0x14a64c(0x84)],_0x56524b[_0x18bda7]['purchases_id']=_0x2532c4[_0x14a64c(0x8e)][_0x14a64c(0x1ae)](),_0x56524b[_0x18bda7][_0x14a64c(0x1a8)]=_0x14a64c(0x9a),_0x56524b[_0x18bda7]['isAvailable']=_0x14a64c(0xd0),_0x56524b[_0x18bda7][_0x14a64c(0xc3)]='false';});for(let _0x958ed6=0x0;_0x958ed6<=_0x56524b['length']-0x1;_0x958ed6++){const _0x194917=_0x56524b[_0x958ed6],_0x22338f=new warehouse_temporary(_0x194917);await _0x22338f[_0x649e71(0x190)]();}_0x1372dd[_0x649e71(0xf3)]=_0x649e71(0xd0),await _0x1372dd['save'](),_0xd31d28[_0x649e71(0x18d)](_0x649e71(0x143),_0x649e71(0x15c)),_0x3c8092[_0x649e71(0x15a)]('/all_purchases_finished/process/'+_0x1372dd['_id']['valueOf']());}catch(_0x34043){}}),router['post']('/view/add_purchases_logs',auth,async(_0x2de94f,_0x50b0df)=>{var _0x1529ce=a0_0x2a6b3c;try{const {invoice:_0x12d001,date:_0x2b97c9,warehouse_name:_0x3de625,prod_name:_0x311d56,note:_0x5174fb,due_amount:_0x293c53,Room_name:_0x405625,PO_number:_0x1dd7e4,SCRN:_0x5bc842,ReqBy:_0x504137,dateofreq:_0xe693f0,suppliers:_0x5a16ac,typeservicesData:_0x22d6e3,van:_0x3a51fc,typevehicle:_0x4b60db,driver:_0x2fce72,plate:_0x52203e,DRSI:_0x545407,TSU:_0x85a568,TFU:_0x49e5b0,JO_number:_0x4e76a9,type_of_products:_0x5869a2}=_0x2de94f[_0x1529ce(0x11a)];if(typeof _0x311d56==_0x1529ce(0x12e))var _0x409a71=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x90)]],_0x2506d8=[_0x2de94f['body'][_0x1529ce(0xb6)]],_0x9d1351=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x18e)]],_0x48a986=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x12d)]],_0x4cc162=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0xd7)]],_0x43931c=[_0x2de94f['body'][_0x1529ce(0x74)]],_0x353db5=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x14d)]],_0x14a713=[_0x2de94f[_0x1529ce(0x11a)]['secondary_code']],_0x41fd23=[_0x2de94f[_0x1529ce(0x11a)]['MaxStocks_data']],_0x4c73a9=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0xe3)]],_0x2f4d97=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x7a)]],_0x1329b6=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x15d)]],_0x5c5dec=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x14f)]],_0x4bdc9b=[_0x2de94f[_0x1529ce(0x11a)]['prod_cat']],_0x27e5ed=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x94)]],_0x494583=[_0x2de94f['body'][_0x1529ce(0x1b0)]],_0x2c6def=[_0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x191)]],_0x424c60=[_0x2de94f[_0x1529ce(0x11a)]['sales_data_cateory']],_0x2e5352=[_0x2de94f['body']['type_of_products_type']];else var _0x409a71=[..._0x2de94f[_0x1529ce(0x11a)]['prod_name']],_0x2506d8=[..._0x2de94f['body'][_0x1529ce(0xb6)]],_0x9d1351=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x18e)]],_0x48a986=[..._0x2de94f['body'][_0x1529ce(0x12d)]],_0x4cc162=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0xd7)]],_0x43931c=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x74)]],_0x353db5=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x14d)]],_0x14a713=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x14a)]],_0x41fd23=[..._0x2de94f['body'][_0x1529ce(0xfc)]],_0x4c73a9=[..._0x2de94f['body']['batch_code']],_0x2f4d97=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x7a)]],_0x1329b6=[..._0x2de94f['body']['product_date']],_0x5c5dec=[..._0x2de94f['body'][_0x1529ce(0x14f)]],_0x4bdc9b=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x17e)]],_0x27e5ed=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x94)]],_0x494583=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x1b0)]],_0x2c6def=[..._0x2de94f['body']['uuid']],_0x424c60=[..._0x2de94f[_0x1529ce(0x11a)]['sales_data_cateory']],_0x2e5352=[..._0x2de94f[_0x1529ce(0x11a)][_0x1529ce(0x19a)]];const _0x36e8d1=_0x409a71['map'](_0x50d44f=>{return _0x50d44f={'product_name':_0x50d44f};});_0x2e5352['forEach']((_0x1d60a0,_0x2ea734)=>{var _0x58d47a=_0x1529ce;_0x36e8d1[_0x2ea734][_0x58d47a(0x186)]=_0x1d60a0;}),_0x424c60[_0x1529ce(0x17b)]((_0x19b1b5,_0x17aca2)=>{var _0x2c7c12=_0x1529ce;_0x36e8d1[_0x17aca2][_0x2c7c12(0x169)]=_0x19b1b5;}),_0x2506d8[_0x1529ce(0x17b)]((_0x2a63a3,_0x5a689f)=>{_0x36e8d1[_0x5a689f]['product_code']=_0x2a63a3;}),_0x2c6def[_0x1529ce(0x17b)]((_0x30f639,_0x784b6c)=>{var _0x5f00a=_0x1529ce;_0x36e8d1[_0x784b6c][_0x5f00a(0x191)]=_0x30f639;}),_0x9d1351['forEach']((_0xc72a,_0x35ab4c)=>{var _0x199381=_0x1529ce;_0x36e8d1[_0x35ab4c][_0x199381(0xd8)]=Math[_0x199381(0x110)](_0xc72a);}),_0x48a986['forEach']((_0xfea098,_0x37a8a3)=>{var _0x45dea5=_0x1529ce;_0x36e8d1[_0x37a8a3][_0x45dea5(0x13e)]=_0xfea098;}),_0x4cc162[_0x1529ce(0x17b)]((_0x454e80,_0x32506e)=>{_0x36e8d1[_0x32506e]['secondary_unit']=_0x454e80;}),_0x43931c[_0x1529ce(0x17b)]((_0x229874,_0x3f051f)=>{var _0x2397cc=_0x1529ce,_0x4da75=_0x229874['match'](/[A-Za-z]+/)[0x0],_0x2d0c91=parseInt(_0x229874[_0x2397cc(0xa6)](/\d+/)[0x0]);_0x36e8d1[_0x3f051f][_0x2397cc(0x105)]=_0x4da75,_0x36e8d1[_0x3f051f]['bay']=_0x2d0c91;}),_0x353db5[_0x1529ce(0x17b)]((_0x5e34e1,_0x39e23c)=>{var _0x50ea75=_0x1529ce;_0x36e8d1[_0x39e23c][_0x50ea75(0x14d)]=_0x5e34e1;}),_0x14a713[_0x1529ce(0x17b)]((_0x57ad44,_0x33d080)=>{var _0x46d0af=_0x1529ce;_0x36e8d1[_0x33d080][_0x46d0af(0x14a)]=_0x57ad44;}),_0x41fd23['forEach']((_0x3369c4,_0xee2a2d)=>{_0x36e8d1[_0xee2a2d]['maxStocks']=_0x3369c4;}),_0x4c73a9[_0x1529ce(0x17b)]((_0x2fc6a3,_0x70083)=>{var _0x1636e6=_0x1529ce;_0x36e8d1[_0x70083][_0x1636e6(0xe3)]=_0x2fc6a3;}),_0x2f4d97['forEach']((_0x33efb5,_0x4a28d1)=>{var _0x489ff6=_0x1529ce;_0x36e8d1[_0x4a28d1][_0x489ff6(0x7a)]=_0x33efb5;}),_0x1329b6[_0x1529ce(0x17b)]((_0x2b9342,_0x384d1b)=>{var _0x3ccb7e=_0x1529ce;_0x36e8d1[_0x384d1b][_0x3ccb7e(0x121)]=_0x2b9342;}),_0x5c5dec[_0x1529ce(0x17b)]((_0x463ee6,_0x11ba20)=>{var _0x67fc2f=_0x1529ce;_0x36e8d1[_0x11ba20][_0x67fc2f(0x106)]=_0x463ee6;}),_0x4bdc9b[_0x1529ce(0x17b)]((_0x125b4e,_0x285377)=>{_0x36e8d1[_0x285377]['product_cat']=_0x125b4e;}),_0x27e5ed[_0x1529ce(0x17b)]((_0x499171,_0x5eb341)=>{var _0x2f7d00=_0x1529ce;_0x36e8d1[_0x5eb341][_0x2f7d00(0x155)]=_0x499171;}),_0x494583[_0x1529ce(0x17b)]((_0x1b54a0,_0x12f038)=>{var _0x4025cd=_0x1529ce;_0x36e8d1[_0x12f038][_0x4025cd(0x1b0)]=_0x1b54a0;});const _0xb6a0bf=new purchases_logs();await _0xb6a0bf[_0x1529ce(0x190)]();for(let _0x4f6853=0x0;_0x4f6853<=_0x27e5ed[_0x1529ce(0x7c)]-0x1;_0x4f6853++){_0x36e8d1[_0x4f6853]['invoice']=_0x1529ce(0x178)+_0xb6a0bf[_0x1529ce(0xa9)][_0x1529ce(0x161)]()['padStart'](0x8,'0');}const _0x4cc4ec=_0x36e8d1[_0x1529ce(0x14e)](_0x53b43e=>_0x53b43e['quantity']!=='0'&&_0x53b43e[_0x1529ce(0xd8)]!==''),_0x3e4a0e=new purchases_finished({'invoice':_0x1529ce(0x178)+_0xb6a0bf['invoice_init'][_0x1529ce(0x161)]()[_0x1529ce(0xb3)](0x8,'0'),'suppliers':_0x5a16ac,'date':_0x2b97c9,'warehouse_name':_0x3de625,'product':_0x4cc4ec,'note':_0x5174fb,'due_amount':_0x293c53,'room':_0x405625,'POnumber':_0x1dd7e4,'SCRN':_0x5bc842,'JO_number':_0x4e76a9,'ReqBy':_0x504137,'dateofreq':_0xe693f0,'typeservicesData':_0x22d6e3,'van':_0x3a51fc,'typevehicle':_0x4b60db,'driver':_0x2fce72,'plate':_0x52203e,'DRSI':_0x545407,'TSU':_0x85a568,'TFU':_0x49e5b0,'typeOfProducts':_0x5869a2}),_0xb2a456=await _0x3e4a0e[_0x1529ce(0x190)](),_0x4ac087=await purchases_finished[_0x1529ce(0x11c)]({'_id':_0xb2a456[_0x1529ce(0x8e)][_0x1529ce(0x1ae)]()}),_0x6f294b=_0x4ac087[_0x1529ce(0xc4)]['map'](async _0x19ce78=>{var _0x59b6e9=_0x1529ce;try{var _0x7e73f4=await warehouse[_0x59b6e9(0x11c)]({'name':_0x3de625,'room':_0x19ce78['room_name']}),_0x53d1ef=0x0;const _0xe0f137=_0x7e73f4['product_details']['map'](_0x138134=>{var _0x5d2207=_0x59b6e9;console['log'](_0x138134[_0x5d2207(0x1a1)]+'=='+_0x19ce78[_0x5d2207(0x1a1)]+'&&'+_0x138134[_0x5d2207(0x16b)]+'=='+_0x19ce78[_0x5d2207(0x16b)]+'&&'+_0x138134[_0x5d2207(0x7a)]+'=='+_0x19ce78[_0x5d2207(0x7a)]+'&&'+_0x138134[_0x5d2207(0x121)]+'=='+_0x19ce78[_0x5d2207(0x121)]+'&&'+_0x138134['batch_code']+'=='+_0x19ce78[_0x5d2207(0xe3)]+'&&'+_0x138134[_0x5d2207(0x185)]+'=='+_0x4ac087[_0x5d2207(0x185)]),_0x138134['product_name']==_0x19ce78[_0x5d2207(0x1a1)]&&_0x138134[_0x5d2207(0x16b)]==_0x19ce78[_0x5d2207(0x16b)]&&_0x138134['level']==_0x19ce78['level']&&_0x138134[_0x5d2207(0x7a)]==_0x19ce78[_0x5d2207(0x7a)]&&_0x138134[_0x5d2207(0x121)]==_0x19ce78[_0x5d2207(0x121)]&&_0x138134[_0x5d2207(0xe3)]==_0x19ce78[_0x5d2207(0xe3)]&&_0x138134['invoice']==_0x4ac087[_0x5d2207(0x185)]&&(_0x138134[_0x5d2207(0x199)]=Math['abs'](_0x138134[_0x5d2207(0x199)])+Math[_0x5d2207(0x110)](_0x19ce78[_0x5d2207(0xd8)]),_0x53d1ef++);});return _0x53d1ef==0x0&&(_0x7e73f4[_0x59b6e9(0x8b)]=_0x7e73f4[_0x59b6e9(0x8b)][_0x59b6e9(0xca)]({'product_name':_0x19ce78[_0x59b6e9(0x1a1)],'product_stock':Math[_0x59b6e9(0x110)](_0x19ce78[_0x59b6e9(0xd8)]),'primary_code':_0x19ce78[_0x59b6e9(0x14d)],'secondary_code':_0x19ce78[_0x59b6e9(0x14a)],'product_code':_0x19ce78['product_code'],'bay':_0x19ce78[_0x59b6e9(0x16b)],'level':_0x19ce78[_0x59b6e9(0x105)],'maxProducts':_0x19ce78['maxStocks'],'unit':_0x19ce78[_0x59b6e9(0x13e)],'secondary_unit':_0x19ce78[_0x59b6e9(0x1aa)],'expiry_date':_0x19ce78['expiry_date'],'production_date':_0x19ce78[_0x59b6e9(0x121)],'maxProducts':_0x19ce78[_0x59b6e9(0x16f)],'maxPerUnit':_0x19ce78[_0x59b6e9(0x106)],'batch_code':_0x19ce78[_0x59b6e9(0xe3)],'product_cat':_0x19ce78[_0x59b6e9(0x154)],'invoice':_0x19ce78[_0x59b6e9(0x185)],'id_incoming':_0x19ce78[_0x59b6e9(0x8e)],'uuid':_0x19ce78[_0x59b6e9(0x191)],'gross_price':_0x19ce78['gross_price'],'sales_category':_0x19ce78[_0x59b6e9(0x169)],'type_products':_0x19ce78[_0x59b6e9(0x186)]})),_0x7e73f4;}catch(_0x4148e0){return console[_0x59b6e9(0xb0)]('Error\x20occurred\x20while\x20processing\x20product:',_0x4148e0),null;}});Promise['all'](_0x6f294b)['then'](async _0x20b4ee=>{var _0x1744ab=_0x1529ce;try{for(const _0x430a6c of _0x20b4ee){await warehouse[_0x1744ab(0x18f)]({'_id':_0x430a6c['_id']},{'$addToSet':{'product_details':{'$each':_0x430a6c[_0x1744ab(0x8b)]}}});}const _0x2f25df=await master_shop['find'](),_0xe71b2e=await email_settings[_0x1744ab(0x11c)](),_0x2fe407=await supervisor_settings[_0x1744ab(0x138)]();var _0x223c76=_0x4ac087[_0x1744ab(0xc4)],_0x4f37d8='',_0x38fc17;for(_0x38fc17 in _0x223c76){var _0x22d39b='FG';_0x4ac087[_0x1744ab(0x6a)]==_0x1744ab(0xad)&&(_0x22d39b='DG'),_0x4f37d8+=_0x1744ab(0xef)+_0x1744ab(0x165)+_0x223c76[_0x38fc17][_0x1744ab(0x1a1)]+_0x1744ab(0x10c)+_0x1744ab(0x165)+_0x223c76[_0x38fc17][_0x1744ab(0xea)]+_0x1744ab(0x10c)+_0x1744ab(0x165)+_0x223c76[_0x38fc17][_0x1744ab(0xd8)]+_0x1744ab(0x10c)+_0x1744ab(0x165)+_0x223c76[_0x38fc17][_0x1744ab(0x13e)]+'</td>'+_0x1744ab(0x165)+_0x223c76[_0x38fc17][_0x1744ab(0x1aa)]+_0x1744ab(0x10c)+_0x1744ab(0x165)+_0x4ac087[_0x1744ab(0x6a)]+_0x1744ab(0x10c)+_0x1744ab(0x165)+_0x223c76[_0x38fc17][_0x1744ab(0x155)]+'</td>'+_0x1744ab(0x165)+_0x22d39b+_0x223c76[_0x38fc17]['bay']+_0x1744ab(0x10c),'</tr>';}let _0xd8bde6=nodemailer['createTransport']({'host':_0xe71b2e[_0x1744ab(0x68)],'port':Number(_0xe71b2e['port']),'secure':![],'auth':{'user':_0xe71b2e[_0x1744ab(0x198)],'pass':_0xe71b2e[_0x1744ab(0x184)]}}),_0x116095={'from':_0xe71b2e[_0x1744ab(0x198)],'to':_0x2fe407[0x0][_0x1744ab(0x87)],'subject':_0x1744ab(0xcf),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1744ab(0xd5)+_0x1744ab(0xba)+_0x2f25df[0x0]['image'],'cid':_0x1744ab(0x156)}],'html':_0x1744ab(0x137)+_0x1744ab(0x194)+'</head><body>'+_0x1744ab(0x1a0)+_0x1744ab(0xbe)+'<div>'+_0x1744ab(0x1b1)+_0x1744ab(0xf2)+_0x1744ab(0x1a0)+_0x1744ab(0x10b)+_0x2f25df[0x0][_0x1744ab(0x126)]+'\x20</h2>'+'</div>'+'</div>'+_0x1744ab(0x172)+_0x1744ab(0x1a0)+_0x1744ab(0xe4)+_0x1744ab(0x83)+_0x4ac087[_0x1744ab(0x185)]+'\x20'+_0x1744ab(0x13a)+_0x1744ab(0x86)+_0x4ac087[_0x1744ab(0x1a6)]+'\x20'+_0x1744ab(0x189)+_0x1744ab(0x125)+'</div>'+_0x1744ab(0xb5)+_0x1744ab(0x150)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1744ab(0x15e)+_0x1744ab(0x11b)+_0x1744ab(0xf4)+_0x1744ab(0x149)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1744ab(0x107)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1744ab(0x85)+_0x1744ab(0x18b)+_0x1744ab(0xf5)+'\x20'+_0x4f37d8+'\x20'+_0x1744ab(0xfe)+_0x1744ab(0xe9)+_0x1744ab(0x1a0)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x2f25df[0x0][_0x1744ab(0x126)]+_0x1744ab(0x125)+_0x1744ab(0xf2)+'</div>'+_0x1744ab(0xc8)};_0xd8bde6['sendMail'](_0x116095,function(_0x19a16e,_0x3b8349){var _0xcb569=_0x1744ab;_0x19a16e?(console['log'](_0x19a16e),console['log']('Error\x20Occurs')):console[_0xcb569(0x122)]('Email\x20sent\x20successfully');});}catch(_0x315bb5){console[_0x1744ab(0xb0)](_0x315bb5),_0x50b0df[_0x1744ab(0xc2)](0x1f4)[_0x1744ab(0x195)]({'error':_0x1744ab(0x19c),'message':_0x315bb5[_0x1744ab(0x13b)]});}})[_0x1529ce(0x167)](_0x56d620=>{var _0x4862f2=_0x1529ce;console[_0x4862f2(0xb0)](_0x56d620);}),_0x2de94f[_0x1529ce(0x18d)](_0x1529ce(0x143),_0x1529ce(0xb7)),_0x50b0df[_0x1529ce(0x15a)](_0x1529ce(0x139)+_0x4ac087['_id'][_0x1529ce(0x1ae)]());}catch(_0x2eba06){console[_0x1529ce(0x122)](_0x2eba06);}}),router['get'](a0_0x2a6b3c(0x1a5),auth,async(_0x55dc10,_0x4b4f35)=>{var _0x262210=a0_0x2a6b3c;try{const {username:_0x137b8b,email:_0x2020c4,role:_0x1e67c5}=_0x55dc10[_0x262210(0x16e)],_0x23d46e=_0x55dc10[_0x262210(0x16e)],_0x244e5a=await profile[_0x262210(0x11c)]({'email':_0x23d46e['email']}),_0x1396ee=await master_shop[_0x262210(0x138)](),_0x55f424=_0x55dc10[_0x262210(0x104)]['id'],_0x1b3f0a=await purchases_finished['findById'](_0x55f424),_0x9c597e=await suppliers[_0x262210(0x138)]({});let _0x38ccad;if(_0x23d46e[_0x262210(0x11f)]=='staff'){const _0x3023ef=await staff[_0x262210(0x11c)]({'email':_0x23d46e[_0x262210(0x198)]});_0x38ccad=await warehouse[_0x262210(0x138)]({'status':_0x262210(0x134),'name':_0x3023ef[_0x262210(0xf1)],'warehouse_category':_0x262210(0xa5)});}else _0x38ccad=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x262210(0xa5)}},{'$group':{'_id':_0x262210(0x197),'name':{'$first':_0x262210(0x197)}}}]);const _0x195bf6=await product[_0x262210(0x138)]({}),_0xc504cf=BayBinSelected(_0x1b3f0a[_0x262210(0x6a)],_0x1b3f0a[_0x262210(0x148)]);let _0x527e37=new Date(_0x1b3f0a[_0x262210(0x7a)]),_0xe2503e=('0'+_0x527e37[_0x262210(0x8a)]())[_0x262210(0x6d)](-0x2),_0x25f321=('0'+(_0x527e37[_0x262210(0x72)]()+0x1))['slice'](-0x2),_0x1e882e=_0x527e37[_0x262210(0xa4)](),_0x2e131e=_0x1e882e+'-'+_0x25f321+'-'+_0xe2503e;if(_0x1396ee[0x0][_0x262210(0x75)]==_0x262210(0x10f)){var _0x139c3b=users['English'];console[_0x262210(0x122)](_0x139c3b);}else{if(_0x1396ee[0x0][_0x262210(0x75)]==_0x262210(0x1af))var _0x139c3b=users[_0x262210(0x1af)];else{if(_0x1396ee[0x0][_0x262210(0x75)]==_0x262210(0x170))var _0x139c3b=users[_0x262210(0x170)];else{if(_0x1396ee[0x0][_0x262210(0x75)]=='Spanish')var _0x139c3b=users[_0x262210(0xfb)];else{if(_0x1396ee[0x0][_0x262210(0x75)]==_0x262210(0x98))var _0x139c3b=users[_0x262210(0x98)];else{if(_0x1396ee[0x0][_0x262210(0x75)]==_0x262210(0xc7))var _0x139c3b=users['Portuguese'];else{if(_0x1396ee[0x0]['language']==_0x262210(0xeb))var _0x139c3b=users[_0x262210(0xeb)];else{if(_0x1396ee[0x0]['language']==_0x262210(0xbb))var _0x139c3b=users[_0x262210(0x93)];}}}}}}}_0x4b4f35[_0x262210(0x67)](_0x262210(0x12b),{'success':_0x55dc10[_0x262210(0x18d)](_0x262210(0x143)),'errors':_0x55dc10['flash'](_0x262210(0xd6)),'role':_0x23d46e,'profile':_0x244e5a,'purchases':_0x1b3f0a,'suppliers':_0x9c597e,'warehouse':_0x38ccad,'product':_0x195bf6,'master_shop':_0x1396ee,'language':_0x139c3b,'ed_fullDate':_0x2e131e,'dataSelected':_0xc504cf});}catch(_0x396b8e){console['log'](_0x396b8e);}}),router[a0_0x2a6b3c(0x1a7)]('/view/:id',auth,async(_0x18707a,_0x41bc16)=>{var _0x435bb9=a0_0x2a6b3c;try{const {username:_0x11243c,email:_0x559c98,role:_0x39bf8a}=_0x18707a[_0x435bb9(0x16e)],_0x272a0b=_0x18707a['user'],_0x594458=await profile[_0x435bb9(0x11c)]({'email':_0x272a0b['email']}),_0x56b82a=await master_shop[_0x435bb9(0x138)](),_0x46d5ea=_0x18707a['params']['id'],_0x30524c=await purchases_finished[_0x435bb9(0xe5)](_0x46d5ea),_0x5a28af=await suppliers[_0x435bb9(0x138)]({});let _0x431fa3;if(_0x272a0b[_0x435bb9(0x11f)]==_0x435bb9(0x193)){const _0x2e3d68=await staff[_0x435bb9(0x11c)]({'email':_0x272a0b[_0x435bb9(0x198)]});_0x431fa3=await warehouse[_0x435bb9(0x138)]({'status':_0x435bb9(0x134),'name':_0x2e3d68[_0x435bb9(0xf1)],'warehouse_category':_0x435bb9(0xa5)});}else _0x431fa3=await warehouse[_0x435bb9(0x19f)]([{'$match':{'status':'Enabled','warehouse_category':_0x435bb9(0xa5)}},{'$group':{'_id':_0x435bb9(0x197),'name':{'$first':_0x435bb9(0x197)}}}]);const _0xbadbcf=await product['find']({}),_0x2ca995=BayBinSelected(_0x30524c['warehouse_name'],_0x30524c['room']);let _0x53c5db=new Date(_0x30524c[_0x435bb9(0x7a)]),_0x592126=('0'+_0x53c5db['getDate']())[_0x435bb9(0x6d)](-0x2),_0x8cbc05=('0'+(_0x53c5db[_0x435bb9(0x72)]()+0x1))['slice'](-0x2),_0x39a2e6=_0x53c5db[_0x435bb9(0xa4)](),_0x1e9647=_0x39a2e6+'-'+_0x8cbc05+'-'+_0x592126;if(_0x56b82a[0x0][_0x435bb9(0x75)]==_0x435bb9(0x10f)){var _0x481913=users['English'];console[_0x435bb9(0x122)](_0x481913);}else{if(_0x56b82a[0x0][_0x435bb9(0x75)]=='Hindi')var _0x481913=users['Hindi'];else{if(_0x56b82a[0x0][_0x435bb9(0x75)]==_0x435bb9(0x170))var _0x481913=users[_0x435bb9(0x170)];else{if(_0x56b82a[0x0][_0x435bb9(0x75)]=='Spanish')var _0x481913=users[_0x435bb9(0xfb)];else{if(_0x56b82a[0x0]['language']==_0x435bb9(0x98))var _0x481913=users[_0x435bb9(0x98)];else{if(_0x56b82a[0x0]['language']==_0x435bb9(0xc7))var _0x481913=users[_0x435bb9(0x131)];else{if(_0x56b82a[0x0]['language']==_0x435bb9(0xeb))var _0x481913=users[_0x435bb9(0xeb)];else{if(_0x56b82a[0x0]['language']=='Arabic\x20(ae)')var _0x481913=users['Arabic'];}}}}}}}_0x41bc16[_0x435bb9(0x67)](_0x435bb9(0xfd),{'success':_0x18707a[_0x435bb9(0x18d)]('success'),'errors':_0x18707a['flash'](_0x435bb9(0xd6)),'role':_0x272a0b,'profile':_0x594458,'purchases':_0x30524c,'suppliers':_0x5a28af,'warehouse':_0x431fa3,'product':_0xbadbcf,'master_shop':_0x56b82a,'language':_0x481913,'ed_fullDate':_0x1e9647,'dataSelected':_0x2ca995});}catch(_0x1b5c31){console['log'](_0x1b5c31);}}),router['post'](a0_0x2a6b3c(0x79),auth,async(_0xdb2146,_0x3d6b62)=>{var _0x560726=a0_0x2a6b3c;try{const _0x134415=_0xdb2146['params']['id'],_0x2c795b=await purchases_finished[_0x560726(0x11c)]({'_id':_0xdb2146[_0x560726(0x104)]['id']}),_0x5cfce2=await warehouse[_0x560726(0x11c)]({'name':_0x2c795b[_0x560726(0x6a)],'room':_0x2c795b['room']});_0x2c795b['product'][_0x560726(0x17b)](_0xe91b49=>{var _0x2da0ef=_0x560726;const _0x3348c8=_0x5cfce2[_0x2da0ef(0x8b)]['map'](_0x2e7214=>{var _0x832538=_0x2da0ef;_0x2e7214[_0x832538(0x1a1)]==_0xe91b49[_0x832538(0x1a1)]&&_0x2e7214[_0x832538(0x16b)]==_0xe91b49[_0x832538(0x16b)]&&(_0x2e7214['product_stock']=parseInt(_0x2e7214[_0x832538(0x199)])-parseInt(_0xe91b49[_0x832538(0xd8)]));});}),await _0x5cfce2[_0x560726(0x190)]();const {invoice:_0x5108ee,suppliers:_0x50335b,date:_0x2758c8,warehouse_name:_0x16a166,prod_name:_0x2880b8,prod_code:_0x349d33,prod_qty:_0x46d8e2,prod_unit:_0x2a9d10,prod_secondunit:_0x379df7,prod_level:_0xde0edb,prod_isle:_0x130264,prod_pallet:_0x28b45f,note:_0x2c35be,expiry_date:_0x1624ea,batch_code:_0x4e6d0c,paid_amount:_0x347ce9,due_amount:_0x216603,Room_name:_0x55cb95,primary_code:_0x1398ee,secondary_code:_0x108044,PO_number:_0x57ef03,JO_number:_0x2c43c1}=_0xdb2146[_0x560726(0x11a)];if(typeof _0x2880b8=='string')var _0x1d2783=[_0xdb2146[_0x560726(0x11a)][_0x560726(0x90)]],_0x4c212e=[_0xdb2146[_0x560726(0x11a)][_0x560726(0xb6)]],_0x38a31a=[_0xdb2146[_0x560726(0x11a)][_0x560726(0xed)]],_0x3b5cc2=[_0xdb2146[_0x560726(0x11a)][_0x560726(0x158)]],_0x4bed68=[_0xdb2146['body'][_0x560726(0xd7)]],_0x41d4e5=[_0xdb2146['body'][_0x560726(0x74)]],_0x4c6910=[_0xdb2146[_0x560726(0x11a)][_0x560726(0x14d)]],_0x2360ce=[_0xdb2146[_0x560726(0x11a)]['secondary_code']],_0x2b58b5=[_0xdb2146[_0x560726(0x11a)][_0x560726(0xfc)]],_0x52d4f9=[_0xdb2146['body'][_0x560726(0xe3)]],_0x12102c=[_0xdb2146[_0x560726(0x11a)][_0x560726(0x7a)]];else var _0x1d2783=[..._0xdb2146['body'][_0x560726(0x90)]],_0x4c212e=[..._0xdb2146['body']['prod_code']],_0x38a31a=[..._0xdb2146[_0x560726(0x11a)][_0x560726(0xed)]],_0x3b5cc2=[..._0xdb2146[_0x560726(0x11a)][_0x560726(0x158)]],_0x4bed68=[..._0xdb2146['body'][_0x560726(0xd7)]],_0x41d4e5=[..._0xdb2146['body'][_0x560726(0x74)]],_0x4c6910=[..._0xdb2146[_0x560726(0x11a)][_0x560726(0x14d)]],_0x2360ce=[..._0xdb2146['body'][_0x560726(0x14a)]],_0x2b58b5=[..._0xdb2146[_0x560726(0x11a)][_0x560726(0xfc)]],_0x52d4f9=[..._0xdb2146[_0x560726(0x11a)]['batch_code']],_0x12102c=[..._0xdb2146[_0x560726(0x11a)][_0x560726(0x7a)]];const _0x1936ce=_0x1d2783[_0x560726(0xa1)](_0x50a1b6=>{return _0x50a1b6={'product_name':_0x50a1b6};});_0x4c212e[_0x560726(0x17b)]((_0x23d6a6,_0x2fc644)=>{var _0x204962=_0x560726;_0x1936ce[_0x2fc644][_0x204962(0xea)]=_0x23d6a6;}),_0x38a31a[_0x560726(0x17b)]((_0x153748,_0xed286b)=>{_0x1936ce[_0xed286b]['quantity']=_0x153748;}),_0x3b5cc2[_0x560726(0x17b)]((_0x209089,_0x5b472d)=>{var _0x171402=_0x560726;_0x1936ce[_0x5b472d][_0x171402(0x13e)]=_0x209089;}),_0x4bed68[_0x560726(0x17b)]((_0x1a781a,_0x546d6b)=>{var _0x349c0b=_0x560726;_0x1936ce[_0x546d6b][_0x349c0b(0x1aa)]=_0x1a781a;}),_0x41d4e5[_0x560726(0x17b)]((_0xb6621a,_0x15e0ad)=>{_0x1936ce[_0x15e0ad]['bay']=_0xb6621a;}),_0x4c6910[_0x560726(0x17b)]((_0x5df1f4,_0x4b70dc)=>{var _0x575bb7=_0x560726;_0x1936ce[_0x4b70dc][_0x575bb7(0x14d)]=_0x5df1f4;}),_0x2360ce[_0x560726(0x17b)]((_0x4f5e2b,_0x19e7eb)=>{var _0x289783=_0x560726;_0x1936ce[_0x19e7eb][_0x289783(0x14a)]=_0x4f5e2b;}),_0x2b58b5[_0x560726(0x17b)]((_0x2f15c8,_0xc8d048)=>{var _0x1e6734=_0x560726;_0x1936ce[_0xc8d048][_0x1e6734(0x16f)]=_0x2f15c8;}),_0x52d4f9[_0x560726(0x17b)]((_0x5819ea,_0x29b0d9)=>{var _0x231b76=_0x560726;_0x1936ce[_0x29b0d9][_0x231b76(0xe3)]=_0x5819ea;}),_0x12102c[_0x560726(0x17b)]((_0x14ae6e,_0x54d9b2)=>{var _0x5f5677=_0x560726;_0x1936ce[_0x54d9b2][_0x5f5677(0x7a)]=_0x14ae6e;});const _0x4b0407=_0x1936ce[_0x560726(0x14e)](_0x1872f7=>_0x1872f7[_0x560726(0xd8)]!=='0'&&_0x1872f7[_0x560726(0xd8)]!=='');_0x2c795b[_0x560726(0x185)]=_0x5108ee,_0x2c795b['suppliers']=_0x50335b,_0x2c795b[_0x560726(0x1a6)]=_0x2758c8,_0x2c795b['warehouse_name']=_0x16a166,_0x2c795b[_0x560726(0xc4)]=_0x4b0407,_0x2c795b[_0x560726(0xc0)]=_0x2c35be,_0x2c795b[_0x560726(0x108)]=_0x347ce9,_0x2c795b[_0x560726(0x179)]=_0x216603,_0x2c795b[_0x560726(0x148)]=_0x55cb95,_0x2c795b['POnumber']=_0x57ef03,_0x2c795b['JO_number']=_0x2c43c1;const _0x62a342=await _0x2c795b[_0x560726(0x190)](),_0x205993=await warehouse[_0x560726(0x11c)]({'name':_0xdb2146[_0x560726(0x11a)]['warehouse_name'],'room':_0xdb2146['body']['Room_name']});_0x2c795b[_0x560726(0xc4)][_0x560726(0x17b)](_0x5a7d53=>{var _0x5e2097=_0x560726,_0x15b251=0x0;const _0xb26c8f=_0x205993[_0x5e2097(0x8b)][_0x5e2097(0xa1)](_0x201d8f=>{var _0x273f07=_0x5e2097;_0x201d8f[_0x273f07(0x1a1)]==_0x5a7d53[_0x273f07(0x1a1)]&&_0x201d8f[_0x273f07(0x16b)]==_0x5a7d53[_0x273f07(0x16b)]&&(_0x201d8f[_0x273f07(0x199)]=parseInt(_0x201d8f[_0x273f07(0x199)])+parseInt(_0x5a7d53[_0x273f07(0xd8)]),_0x15b251++);});_0x15b251=='0'&&(_0x205993['product_details']=_0x205993[_0x5e2097(0x8b)][_0x5e2097(0xca)]({'product_name':_0x5a7d53[_0x5e2097(0x1a1)],'product_stock':_0x5a7d53[_0x5e2097(0xd8)],'primary_code':_0x5a7d53[_0x5e2097(0x14d)],'secondary_code':_0x5a7d53[_0x5e2097(0x14a)],'product_code':_0x5a7d53[_0x5e2097(0xea)],'bay':_0x5a7d53[_0x5e2097(0x16b)],'maxProducts':_0x5a7d53[_0x5e2097(0x16f)],'unit':_0x5a7d53['standard_unit'],'secondary_unit':_0x5a7d53[_0x5e2097(0x1aa)],'expiry_date':_0x5a7d53['expiry_date']}));}),await _0x205993['save']();const _0x2c4984=await s_payment_data[_0x560726(0x11c)]({'invoice':_0xdb2146['body'][_0x560726(0x185)]});if(_0x2c4984===null){}else console[_0x560726(0x122)](_0x560726(0x81),_0x2c4984,_0xdb2146['body']['invoice']),_0x2c4984[_0x560726(0x81)]=_0xdb2146[_0x560726(0x11a)][_0x560726(0x81)],await _0x2c4984['save']();_0xdb2146[_0x560726(0x18d)]('success',_0x560726(0x166)),_0x3d6b62[_0x560726(0x15a)](_0x560726(0x7d));}catch(_0x568ba6){console['log'](_0x568ba6);}}),router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0x176),auth,async(_0x3528c5,_0x276a91)=>{var _0x2c683a=a0_0x2a6b3c;try{const _0x357a11=_0x3528c5[_0x2c683a(0x104)]['id'],{invoice:_0x1e13d0,suppliers:_0x3ae729,payable:_0x3fc01b,due_amount:_0x5d53d1}=_0x3528c5[_0x2c683a(0x11a)],_0x2b781c=await purchases[_0x2c683a(0xe5)](_0x357a11);var _0x26a354=_0x3fc01b-_0x5d53d1;_0x2b781c['paid_amount']=parseFloat(_0x2b781c[_0x2c683a(0x108)])+parseFloat(_0x5d53d1),_0x2b781c[_0x2c683a(0x179)]=_0x26a354;const _0x2a31a9=await _0x2b781c[_0x2c683a(0x190)]();console[_0x2c683a(0x122)](_0x2a31a9);const _0x40cfa2=await s_payment_data[_0x2c683a(0x11c)]({'invoice':_0x1e13d0});_0x40cfa2[_0x2c683a(0x133)]=_0x26a354,await _0x40cfa2[_0x2c683a(0x190)]();let _0x244477=new Date(),_0x3dc6b1=('0'+_0x244477[_0x2c683a(0x8a)]())[_0x2c683a(0x6d)](-0x2),_0x2b066a=('0'+(_0x244477[_0x2c683a(0x72)]()+0x1))[_0x2c683a(0x6d)](-0x2),_0x5b96c1=_0x244477[_0x2c683a(0xa4)](),_0x4882b1=_0x5b96c1+'-'+_0x2b066a+'-'+_0x3dc6b1;const _0x1f8bc6=new suppliers_payment({'invoice':_0x1e13d0,'date':_0x5b96c1+'-'+_0x2b066a+'-'+_0x3dc6b1,'suppliers':_0x3ae729,'reason':_0x2c683a(0x116),'amount':_0x5d53d1}),_0x155a62=await _0x1f8bc6[_0x2c683a(0x190)]();_0x3528c5['flash'](_0x2c683a(0x143),_0x2c683a(0x102)),_0x276a91[_0x2c683a(0x15a)](_0x2c683a(0x136));}catch(_0x2f8eda){console[_0x2c683a(0x122)](_0x2f8eda);}}),router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0x17d),auth,async(_0x4ee972,_0x1542e7)=>{var _0x19d5cb=a0_0x2a6b3c;try{const {username:_0x20d281,email:_0x3eb56c,role:_0x299a83}=_0x4ee972[_0x19d5cb(0x16e)],_0x4bae15=_0x4ee972['user'],_0x475304=await profile['findOne']({'email':_0x4bae15['email']}),_0x1cef0a=await master_shop[_0x19d5cb(0x138)]();console[_0x19d5cb(0x122)]('master',_0x1cef0a);const _0x14d7f7=_0x4ee972['params']['id'],_0x327e2a=await purchases[_0x19d5cb(0xe5)](_0x14d7f7);console[_0x19d5cb(0x122)](_0x327e2a);const _0x556436=await suppliers[_0x19d5cb(0x11c)]({'name':_0x327e2a[_0x19d5cb(0x81)]});console['log'](_0x556436);if(_0x1cef0a[0x0][_0x19d5cb(0x75)]==_0x19d5cb(0x10f)){var _0x4f8f0f=users[_0x19d5cb(0xf7)];console[_0x19d5cb(0x122)](_0x4f8f0f);}else{if(_0x1cef0a[0x0][_0x19d5cb(0x75)]=='Hindi')var _0x4f8f0f=users['Hindi'];else{if(_0x1cef0a[0x0][_0x19d5cb(0x75)]==_0x19d5cb(0x170))var _0x4f8f0f=users[_0x19d5cb(0x170)];else{if(_0x1cef0a[0x0][_0x19d5cb(0x75)]==_0x19d5cb(0xfb))var _0x4f8f0f=users['Spanish'];else{if(_0x1cef0a[0x0][_0x19d5cb(0x75)]==_0x19d5cb(0x98))var _0x4f8f0f=users[_0x19d5cb(0x98)];else{if(_0x1cef0a[0x0][_0x19d5cb(0x75)]==_0x19d5cb(0xc7))var _0x4f8f0f=users[_0x19d5cb(0x131)];else{if(_0x1cef0a[0x0]['language']==_0x19d5cb(0xeb))var _0x4f8f0f=users['Chinese'];else{if(_0x1cef0a[0x0][_0x19d5cb(0x75)]==_0x19d5cb(0xbb))var _0x4f8f0f=users['Arabic'];}}}}}}}_0x1542e7[_0x19d5cb(0x67)](_0x19d5cb(0xff),{'success':_0x4ee972[_0x19d5cb(0x18d)](_0x19d5cb(0x143)),'errors':_0x4ee972[_0x19d5cb(0x18d)](_0x19d5cb(0xd6)),'role':_0x4bae15,'profile':_0x475304,'master_shop':_0x1cef0a,'supplier':_0x556436,'purchase':_0x327e2a,'language':_0x4f8f0f});}catch(_0x1a8bb0){console[_0x19d5cb(0x122)](_0x1a8bb0);}}),router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0x114),auth,async(_0x211415,_0x4ab5d7)=>{var _0x3f72ef=a0_0x2a6b3c;try{const {username:_0xa199de,email:_0x316700,role:_0x58e524}=_0x211415[_0x3f72ef(0x16e)],_0x2fbdd9=_0x211415[_0x3f72ef(0x16e)],_0x463ffe=await profile['findOne']({'email':_0x2fbdd9[_0x3f72ef(0x198)]}),_0x2944c6=await master_shop[_0x3f72ef(0x138)]();console[_0x3f72ef(0x122)](_0x3f72ef(0x12f),_0x2944c6);const _0x472245=_0x211415[_0x3f72ef(0x104)]['id'];console[_0x3f72ef(0x122)](_0x472245);const _0x5f574f=await purchases_finished[_0x3f72ef(0xe5)](_0x472245);console[_0x3f72ef(0x122)](_0x3f72ef(0x66),_0x5f574f);const _0x14de2d=await product[_0x3f72ef(0x138)]({}),_0x382698=await warehouse[_0x3f72ef(0x19f)]([{'$match':{'name':_0x5f574f[_0x3f72ef(0x6a)],'room':_0x5f574f[_0x3f72ef(0x148)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3f72ef(0xb2),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3f72ef(0x6b)},'bin':{'$first':_0x3f72ef(0x183)},'type':{'$first':_0x3f72ef(0x19e)},'floorlevel':{'$first':_0x3f72ef(0xa8)},'primary_code':{'$first':_0x3f72ef(0x141)},'secondary_code':{'$first':_0x3f72ef(0x120)},'product_code':{'$first':_0x3f72ef(0x11d)},'storage':{'$first':_0x3f72ef(0x9d)},'rack':{'$first':_0x3f72ef(0x196)}}}]);console[_0x3f72ef(0x122)]('stock_data',_0x382698);let _0x35f798;if(_0x2fbdd9[_0x3f72ef(0x11f)]=='staff'){const _0x170b5b=await staff['findOne']({'email':_0x2fbdd9[_0x3f72ef(0x198)]});_0x35f798=await warehouse[_0x3f72ef(0x138)]({'status':'Enabled','name':_0x170b5b[_0x3f72ef(0xf1)],'warehouse_category':_0x3f72ef(0xa5),'name':_0x3f72ef(0x109)});}else _0x35f798=await warehouse[_0x3f72ef(0x19f)]([{'$match':{'status':_0x3f72ef(0x134),'warehouse_category':_0x3f72ef(0xa5),'name':'Return\x20Goods'}},{'$group':{'_id':_0x3f72ef(0x197),'name':{'$first':_0x3f72ef(0x197)}}}]);if(_0x2944c6[0x0][_0x3f72ef(0x75)]==_0x3f72ef(0x10f)){var _0x46ad73=users[_0x3f72ef(0xf7)];console[_0x3f72ef(0x122)](_0x46ad73);}else{if(_0x2944c6[0x0][_0x3f72ef(0x75)]==_0x3f72ef(0x1af))var _0x46ad73=users[_0x3f72ef(0x1af)];else{if(_0x2944c6[0x0][_0x3f72ef(0x75)]==_0x3f72ef(0x170))var _0x46ad73=users[_0x3f72ef(0x170)];else{if(_0x2944c6[0x0]['language']=='Spanish')var _0x46ad73=users['Spanish'];else{if(_0x2944c6[0x0][_0x3f72ef(0x75)]==_0x3f72ef(0x98))var _0x46ad73=users[_0x3f72ef(0x98)];else{if(_0x2944c6[0x0][_0x3f72ef(0x75)]==_0x3f72ef(0xc7))var _0x46ad73=users['Portuguese'];else{if(_0x2944c6[0x0][_0x3f72ef(0x75)]==_0x3f72ef(0xeb))var _0x46ad73=users[_0x3f72ef(0xeb)];else{if(_0x2944c6[0x0][_0x3f72ef(0x75)]=='Arabic\x20(ae)')var _0x46ad73=users[_0x3f72ef(0x93)];}}}}}}}_0x4ab5d7['render'](_0x3f72ef(0xcb),{'success':_0x211415[_0x3f72ef(0x18d)]('success'),'errors':_0x211415[_0x3f72ef(0x18d)](_0x3f72ef(0xd6)),'role':_0x2fbdd9,'profile':_0x463ffe,'user':_0x5f574f,'stock':_0x382698,'master_shop':_0x2944c6,'product':_0x14de2d,'language':_0x46ad73,'warehouse':_0x35f798});}catch(_0x174872){console[_0x3f72ef(0x122)](_0x174872);}}),router[a0_0x2a6b3c(0x9f)]('/view/return_purchase/:id',auth,async(_0x27ef7c,_0x4414bd)=>{var _0x3eb659=a0_0x2a6b3c;try{const {invoice:_0x248ea8,date:_0x48717e,warehouse_name:_0x3e94b8,Room_name:_0x14f371,product_name:_0x2c55d6,purchase_quantity:_0x55727d,stocks:_0x112130,return_qty:_0x410ab5,note:_0x367092,level:_0x2b4834,isle:_0x545f7b,pallet:_0x3378bd,to_warehouse_name:_0x687cf5,to_Room_name:_0x21c6ad}=_0x27ef7c[_0x3eb659(0x11a)],_0xd2daa3=await purchases_finished[_0x3eb659(0x11c)]({'_id':_0x27ef7c['params']['id']}),_0x40d5c9=await warehouse[_0x3eb659(0x11c)]({'name':_0x3e94b8,'room':_0x14f371,'warehouse_category':_0x3eb659(0xa5)});if(typeof _0x2c55d6==_0x3eb659(0x12e))var _0x2c2725=[_0x27ef7c['body'][_0x3eb659(0x1a1)]],_0xe22685=[_0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x160)]],_0x2916fb=[_0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x95)]],_0x302b33=[_0x27ef7c['body'][_0x3eb659(0x96)]],_0x1c6d0c=[_0x27ef7c['body']['level']],_0x58bc2a=[_0x27ef7c['body'][_0x3eb659(0xec)]],_0x59fc60=[_0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x1ab)]],_0x5a280c=[_0x27ef7c['body'][_0x3eb659(0x101)]];else var _0x2c2725=[..._0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x1a1)]],_0xe22685=[..._0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x160)]],_0x2916fb=[..._0x27ef7c['body']['stocks']],_0x302b33=[..._0x27ef7c[_0x3eb659(0x11a)]['return_qty']],_0x1c6d0c=[..._0x27ef7c[_0x3eb659(0x11a)]['level']],_0x58bc2a=[..._0x27ef7c['body'][_0x3eb659(0xec)]],_0x59fc60=[..._0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x1ab)]],_0x5a280c=[..._0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x101)]];const _0x4e2446=_0x2c2725['map'](_0x34e8fc=>{return _0x34e8fc={'product_name':_0x34e8fc};});_0xe22685[_0x3eb659(0x17b)]((_0x3be54b,_0x309364)=>{var _0x3762fc=_0x3eb659;_0x4e2446[_0x309364][_0x3762fc(0x160)]=_0x3be54b;}),_0x2916fb[_0x3eb659(0x17b)]((_0x12bd83,_0x438783)=>{var _0x2b12cc=_0x3eb659;_0x4e2446[_0x438783][_0x2b12cc(0x140)]=_0x12bd83;}),_0x302b33['forEach']((_0x77747f,_0x402f52)=>{var _0xace7c2=_0x3eb659;_0x4e2446[_0x402f52][_0xace7c2(0x96)]=_0x77747f;}),_0x1c6d0c[_0x3eb659(0x17b)]((_0x2525a8,_0x4fca13)=>{var _0x46a6d0=_0x3eb659;_0x4e2446[_0x4fca13][_0x46a6d0(0x16b)]=_0x2525a8;}),_0x58bc2a['forEach']((_0x3a6177,_0x2c8e37)=>{var _0x10fa18=_0x3eb659;_0x4e2446[_0x2c8e37][_0x10fa18(0xea)]=_0x3a6177;}),_0x59fc60[_0x3eb659(0x17b)]((_0x4ff34c,_0x11bc9f)=>{var _0x317f68=_0x3eb659;_0x4e2446[_0x11bc9f][_0x317f68(0x14d)]=_0x4ff34c;}),_0x5a280c['forEach']((_0x19ab56,_0x1b7b0c)=>{var _0x51a36b=_0x3eb659;_0x4e2446[_0x1b7b0c][_0x51a36b(0x14a)]=_0x19ab56;}),_0x4e2446[_0x3eb659(0x17b)](_0x301c2e=>{var _0x3c5c9e=_0x3eb659;console['log'](_0x301c2e);const _0x5068e7=_0x40d5c9[_0x3c5c9e(0x8b)][_0x3c5c9e(0xa1)](_0x511a6e=>{var _0x451af5=_0x3c5c9e;_0x511a6e[_0x451af5(0x1a1)]==_0x301c2e[_0x451af5(0x1a1)]&&_0x511a6e[_0x451af5(0x16b)]==_0x301c2e[_0x451af5(0x16b)]&&(console[_0x451af5(0x122)](parseInt(_0x511a6e[_0x451af5(0x199)])+_0x451af5(0x144)+parseInt(_0x301c2e[_0x451af5(0x96)])),_0x511a6e['product_stock']=parseInt(_0x511a6e[_0x451af5(0x199)])-parseInt(_0x301c2e[_0x451af5(0x96)]));});}),await _0x40d5c9['save']();var _0x1f4030=0x0;_0x4e2446[_0x3eb659(0x17b)](_0x1f0923=>{var _0x5c94b7=_0x3eb659;(parseInt(_0x1f0923[_0x5c94b7(0x160)])<parseInt(_0x1f0923[_0x5c94b7(0x96)])||parseInt(_0x1f0923[_0x5c94b7(0x140)])<parseInt(_0x1f0923['return_qty']))&&_0x1f4030++;});if(_0x1f4030!=0x0)return _0x27ef7c['flash'](_0x3eb659(0xd6),_0x3eb659(0x151)),_0x4414bd[_0x3eb659(0x15a)](_0x3eb659(0x13d));const _0x58380c=new purchases_return_finished({'invoice':_0x248ea8,'suppliers':_0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x81)],'date':_0x48717e,'warehouse_name':_0x3e94b8,'return_product':_0x4e2446,'note':_0x367092,'room':_0x14f371,'to_warehouse_name':_0x687cf5,'to_room':_0x21c6ad}),_0x12c113=await _0x58380c[_0x3eb659(0x190)](),_0x2defce=await purchases_return_finished[_0x3eb659(0x11c)]({'invoice':_0x248ea8}),_0x8a3b5f=await warehouse[_0x3eb659(0x11c)]({'name':_0x687cf5,'room':_0x21c6ad,'warehouse_category':_0x3eb659(0xa5)});_0x2defce[_0x3eb659(0x100)]['forEach'](_0x4ca610=>{var _0x6280bf=_0x3eb659,_0x29f2be=0x0;const _0x56da0f=_0x8a3b5f['product_details'][_0x6280bf(0xa1)](_0x5fa8d3=>{var _0x5d5476=_0x6280bf;console[_0x5d5476(0x122)](_0x5fa8d3[_0x5d5476(0x1a1)]+'=='+_0x4ca610[_0x5d5476(0x1a1)]+'&&'+_0x5fa8d3[_0x5d5476(0x16b)]+'=='+_0x4ca610['bay']),_0x5fa8d3['product_name']==_0x4ca610[_0x5d5476(0x1a1)]&&_0x5fa8d3[_0x5d5476(0x16b)]==_0x4ca610['bay']&&(_0x5fa8d3[_0x5d5476(0x199)]=parseInt(_0x5fa8d3[_0x5d5476(0x199)])-parseInt(_0x4ca610['return_qty']),_0x29f2be++);});_0x29f2be=='0'&&(_0x8a3b5f['product_details']=_0x8a3b5f[_0x6280bf(0x8b)][_0x6280bf(0xca)]({'product_name':_0x4ca610[_0x6280bf(0x1a1)],'product_stock':_0x4ca610[_0x6280bf(0x96)],'primary_code':_0x4ca610[_0x6280bf(0x14d)],'secondary_code':_0x4ca610['secondary_code'],'product_code':_0x4ca610['product_code'],'bay':_0x4ca610[_0x6280bf(0x16b)],'maxProducts':0xf423f}));}),await _0x8a3b5f[_0x3eb659(0x190)]();const _0x5f0a2c=await purchases_finished[_0x3eb659(0x11c)]({'invoice':_0x248ea8});_0x5f0a2c[_0x3eb659(0x181)]='True';const _0x3addc5=await _0x5f0a2c['save'](),_0x124748=new s_payment_data({'invoice':_0x248ea8,'suppliers':_0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x81)],'reason':_0x3eb659(0xb8)});await _0x124748[_0x3eb659(0x190)]();const _0x118adf=await master_shop[_0x3eb659(0x138)](),_0x231f20=await email_settings['findOne'](),_0x1c961a=await suppliers[_0x3eb659(0x11c)]({'name':_0x27ef7c[_0x3eb659(0x11a)][_0x3eb659(0x81)]});_0x118adf[0x0]['currency_placement']==0x1?(right_currency=_0x118adf[0x0][_0x3eb659(0x152)],left_currency=''):(right_currency='',left_currency=_0x118adf[0x0][_0x3eb659(0x152)]);var _0x361827=_0x2c2725,_0x424cb7=_0x302b33,_0x17d58f='',_0x5d807c;for(_0x5d807c in _0x361827){_0x17d58f+=_0x3eb659(0xef)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x361827[_0x5d807c]+_0x3eb659(0x10c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x424cb7[_0x5d807c]+'</td>'+_0x3eb659(0x85);}let _0x148575=nodemailer[_0x3eb659(0x10e)]({'service':'gmail','auth':{'user':_0x231f20[_0x3eb659(0x198)],'pass':_0x231f20[_0x3eb659(0x184)]}}),_0x15b3d1={'from':_0x231f20['email'],'to':_0x1c961a[_0x3eb659(0x198)],'subject':_0x3eb659(0xd3),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3eb659(0xd5)+_0x3eb659(0xba)+_0x118adf[0x0][_0x3eb659(0xd4)],'cid':_0x3eb659(0x156)}],'html':'<!DOCTYPE\x20html>'+_0x3eb659(0x194)+_0x3eb659(0x157)+_0x3eb659(0x1a0)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3eb659(0x1a0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3eb659(0xf2)+_0x3eb659(0x1a0)+'<h2>\x20'+_0x118adf[0x0][_0x3eb659(0x126)]+_0x3eb659(0x123)+_0x3eb659(0xf2)+_0x3eb659(0xf2)+_0x3eb659(0x172)+'<div>'+_0x3eb659(0xe4)+_0x3eb659(0x83)+_0x248ea8+'\x20'+_0x3eb659(0x13a)+_0x3eb659(0x86)+_0x48717e+'\x20'+'</span>'+_0x3eb659(0x125)+_0x3eb659(0xf2)+_0x3eb659(0xb5)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3eb659(0xef)+_0x3eb659(0x168)+_0x3eb659(0x73)+_0x3eb659(0x192)+_0x3eb659(0x17a)+_0x3eb659(0x85)+_0x3eb659(0x18b)+_0x3eb659(0xf5)+'\x20'+_0x17d58f+'\x20'+_0x3eb659(0xfe)+_0x3eb659(0xe9)+_0x3eb659(0x1a0)+_0x3eb659(0x117)+_0x3eb659(0xa0)+_0x118adf[0x0][_0x3eb659(0x126)]+_0x3eb659(0x125)+'</div>'+'</div>'+_0x3eb659(0xc8)};_0x148575[_0x3eb659(0x119)](_0x15b3d1,function(_0x2cd81c,_0xcf3b10){var _0x58dc86=_0x3eb659;_0x2cd81c?console[_0x58dc86(0x122)](_0x58dc86(0x171)):console[_0x58dc86(0x122)]('Email\x20sent\x20successfully');}),_0x27ef7c[_0x3eb659(0x18d)](_0x3eb659(0x143),_0x3eb659(0x7f)),_0x4414bd[_0x3eb659(0x15a)](_0x3eb659(0x7d));}catch(_0x598db1){_0x4414bd[_0x3eb659(0xc2)](0xc8)[_0x3eb659(0x195)]({'message':_0x598db1[_0x3eb659(0x13b)]});}}),router[a0_0x2a6b3c(0x1a7)](a0_0x2a6b3c(0xc9),auth,async(_0x5512c7,_0x1a0710)=>{var _0x5f25a8=a0_0x2a6b3c;try{const {username:_0x589dfa,email:_0x574b2f,role:_0x3b3c1f}=_0x5512c7[_0x5f25a8(0x16e)],_0x5c8e34=_0x5512c7[_0x5f25a8(0x16e)],_0x3b8c2b=await profile[_0x5f25a8(0x11c)]({'email':_0x5c8e34[_0x5f25a8(0x198)]}),_0x120198=await master_shop[_0x5f25a8(0x138)](),_0x227bb6=_0x5512c7['params']['id'],_0x200403=await purchases_finished[_0x5f25a8(0xe5)](_0x227bb6);if(_0x120198[0x0]['language']==_0x5f25a8(0x10f))var _0x34ce78=users[_0x5f25a8(0xf7)];else{if(_0x120198[0x0][_0x5f25a8(0x75)]==_0x5f25a8(0x1af))var _0x34ce78=users['Hindi'];else{if(_0x120198[0x0][_0x5f25a8(0x75)]=='German')var _0x34ce78=users[_0x5f25a8(0x170)];else{if(_0x120198[0x0][_0x5f25a8(0x75)]==_0x5f25a8(0xfb))var _0x34ce78=users['Spanish'];else{if(_0x120198[0x0]['language']=='French')var _0x34ce78=users[_0x5f25a8(0x98)];else{if(_0x120198[0x0]['language']==_0x5f25a8(0xc7))var _0x34ce78=users[_0x5f25a8(0x131)];else{if(_0x120198[0x0]['language']==_0x5f25a8(0xeb))var _0x34ce78=users['Chinese'];else{if(_0x120198[0x0][_0x5f25a8(0x75)]=='Arabic\x20(ae)')var _0x34ce78=users['Arabic'];}}}}}}}_0x1a0710['render']('all_purchases_barcode',{'success':_0x5512c7[_0x5f25a8(0x18d)](_0x5f25a8(0x143)),'errors':_0x5512c7['flash'](_0x5f25a8(0xd6)),'role':_0x5c8e34,'profile':_0x3b8c2b,'alldata':_0x200403,'master_shop':_0x120198,'language':_0x34ce78}),console['log'](alldata);}catch(_0x5e0ab1){console[_0x5f25a8(0x122)](_0x5e0ab1);}}),router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0xb4),async(_0x17c627,_0x4d5ef1)=>{var _0x408f0f=a0_0x2a6b3c;const {product_code:_0x1642e6}=_0x17c627[_0x408f0f(0x11a)];var _0x6bd122;const _0x46a461=await product[_0x408f0f(0x19f)]([{'$match':{'primary_code':_0x1642e6}},{'$group':{'_id':_0x408f0f(0x13f),'name':{'$first':_0x408f0f(0x197)},'category':{'$first':_0x408f0f(0x129)},'brand':{'$first':_0x408f0f(0x103)},'unit':{'$first':_0x408f0f(0x173)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x408f0f(0x163)},'primary_code':{'$first':_0x408f0f(0xdc)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x408f0f(0xe1)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x408f0f(0xd9)},'sales_category':{'$first':_0x408f0f(0x16a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x3119b2=await product[_0x408f0f(0x19f)]([{'$match':{'secondary_code':_0x1642e6}},{'$group':{'_id':'$_id','name':{'$first':_0x408f0f(0x197)},'category':{'$first':'$category'},'brand':{'$first':_0x408f0f(0x103)},'unit':{'$first':_0x408f0f(0x173)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x408f0f(0x163)},'primary_code':{'$first':_0x408f0f(0xdc)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x408f0f(0xe1)},'maxProdPerUnit':{'$first':_0x408f0f(0x8f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x408f0f(0x80)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x408f0f(0x16a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x46a461[_0x408f0f(0x7c)]>0x0)_0x6bd122=_0x46a461;else _0x3119b2[_0x408f0f(0x7c)]>0x0&&(_0x6bd122=_0x3119b2);_0x4d5ef1[_0x408f0f(0x195)](_0x6bd122);}),router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0xe7),async(_0x5b6c4f,_0x53abbb)=>{var _0x1a9085=a0_0x2a6b3c;const {productCode:_0x18798b,bay:_0x243e6c,warehouses:_0x1365ce,room:_0x49b1d6}=_0x5b6c4f[_0x1a9085(0x11a)];console[_0x1a9085(0x122)](_0x5b6c4f[_0x1a9085(0x11a)]);try{const _0xcb8d9f=await warehouse[_0x1a9085(0x19f)]([{'$match':{'name':_0x1365ce,'room':_0x49b1d6}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x243e6c)}},{'$group':{'_id':_0x1a9085(0xb2),'name':{'$first':_0x1a9085(0x12a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x1a9085(0xbd)}}}]);_0x53abbb[_0x1a9085(0xc2)](0xc8)['json'](_0xcb8d9f);}catch(_0x38fb08){_0x53abbb[_0x1a9085(0xc2)](0x194)['json']({'message':_0x38fb08['message']});}}),router[a0_0x2a6b3c(0x9f)](a0_0x2a6b3c(0x142),async(_0x3e5133,_0x51102d)=>{var _0x1c7b88=a0_0x2a6b3c;const {product_code:_0x3fa307}=_0x3e5133[_0x1c7b88(0x11a)];var _0x291658;const _0x21a887=await product['aggregate']([{'$match':{'primary_code':_0x3fa307,'type_products':_0x1c7b88(0x122)}},{'$group':{'_id':_0x1c7b88(0x13f),'name':{'$first':_0x1c7b88(0x197)},'category':{'$first':_0x1c7b88(0x129)},'brand':{'$first':_0x1c7b88(0x103)},'unit':{'$first':_0x1c7b88(0x173)},'alertquantity':{'$first':_0x1c7b88(0xe8)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1c7b88(0xdc)},'secondary_code':{'$first':_0x1c7b88(0x17f)},'maxStocks':{'$first':_0x1c7b88(0xe1)},'maxProdPerUnit':{'$first':_0x1c7b88(0x8f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1c7b88(0x80)},'gross_price':{'$first':_0x1c7b88(0xd9)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x1c7b88(0x113)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x21a887);const _0x5de7f3=await product[_0x1c7b88(0x19f)]([{'$match':{'secondary_code':_0x3fa307,'type_products':'log'}},{'$group':{'_id':_0x1c7b88(0x13f),'name':{'$first':_0x1c7b88(0x197)},'category':{'$first':'$category'},'brand':{'$first':_0x1c7b88(0x103)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x1c7b88(0xe8)},'product_code':{'$first':_0x1c7b88(0x163)},'primary_code':{'$first':_0x1c7b88(0xdc)},'secondary_code':{'$first':_0x1c7b88(0x17f)},'maxStocks':{'$first':_0x1c7b88(0xe1)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1c7b88(0x80)},'gross_price':{'$first':_0x1c7b88(0xd9)},'sales_category':{'$first':_0x1c7b88(0x16a)},'type_products':{'$first':_0x1c7b88(0x113)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x21a887[_0x1c7b88(0x7c)]>0x0)_0x291658=_0x21a887;else _0x5de7f3['length']>0x0&&(_0x291658=_0x5de7f3);_0x51102d[_0x1c7b88(0x195)](_0x291658);}),module['exports']=router;