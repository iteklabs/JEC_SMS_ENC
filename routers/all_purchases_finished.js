function a0_0x3a8a(){var _0x40a5fb=['amount','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Ambient','</table>','/view/add_purchases_logs','437785cWrAxV','purchases_process','params','padStart','then','Purchase\x20Return','prod_code','product_stock','$type_products','errors','return_product','<h5>','here2','min','$product','$product.room_name','\x20<=>\x20','German','$secondary_code','2217ooUfjS','/getinvoicetrf','</tr>','/barcode_scanner','$return_data','stocks','<hr\x20class=\x22my-3\x22>','$maxProdPerUnit','An\x20error\x20occurred.','concat','flash','purchases\x20item\x20return\x20successfull','<table\x20style=\x22width:\x20100%\x20!important;\x22>','bin','/give_payment/:id','/view/return_purchase/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details','json','due_amount','/all_purchases_finished/view','undefined','match','33704AQoAnz','Portuguese\x20(BR)','all_purchases_finished','message','port','date','quantity','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/all_purchases/view','LOG-INC-','user_id','/view/add_purchases/:id','maxperunit','to_bay','$_id','password','$product_details.type','Room_name','Hindi','all_purchases_barcode',',\x20room:\x20','paid_amount','Spanish','incoming_add','$brand','\x20Order\x20Date\x20:\x20','Email\x20sent\x20successfully','type_of_products','prod_Qty','staff','save','payment\x20successfull','util','true','French','map','</h5>','product_code','secondary_unit','name','edit_purchases_finished','../models/all_models','/barcode_scanner_logs','back','prod_secondunit','Error\x20occurred\x20while\x20processing\x20product:','maxPerUnit','valueOf','../public/language/languages.json','expiry_date','post','product_date','getMonth','warehouse','$room','primary_code','item_code','forEach','<h5\x20style=\x22text-align:\x20left;\x22>','aggregate','body','getFullYear','Arabic\x20(ae)','Rack\x202','$category','692613rmDPsK','findById','$product_details._id','prod_name','</td>','secondary_code','render','English','all_purchases_finished_logs','Transfer\x20Finalize\x20Successfully','<div>','filter','success','product_code_hide','purchase_invoice','add_purchases_finished','findOne','INC','$product_details.bay','logs','$expiry_date','There\x20is\x20','currency_placement','9227QzxHGG','master','level','$product.bin','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Portuguese','An\x20error\x20occurred\x20while\x20saving\x20data.','$date','POnumber','_id','suppliers_docs','44ojNfya','own','$due_amount','<tr>','id_transaction','$warehouse_name','maxStocks','gross_price','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_cat','string','createTransport','product_cat','$suppliers','Enabled','email','/view','standard_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','status','/invoice/:id','Chinese','find','max','table\x20page','product_name','Asia/Manila','<span\x20style=\x22float:\x20right;\x22>','$unit','purchase_quantity','<html><head><title></title>','ejs','user','/incoming','gmail','Paid\x20For\x20Purchase','unit','sales_data_cateory','DRY\x20GOODS','invoice_init','INC-','$product_details.maxProducts','<h2>\x20','image','INCF-','note','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</body></html>','</div>','/view_log','toString','exports','batch_code','/barcode/:id','$gross_price','room_name','\x20</h2>','English\x20(US)','/process/:id','production_date','/picking_list/pdf_puchases_fin_own_trf/','express','$product_details.bin','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','slice','prod_primunit','../middleware/auth','JO_number','stock_quantity','logo','false','Error\x20Occurs','</span>','prod_level','to_quantity','length','$primary_code','abs','3899atEtgo','Arabic','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$secondary_unit','product_data','76KGQOSy','2-digit','add_purchases\x20error','return_qty','/view/:id',',\x20bay:\x20','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','purchase\x20data\x20add\x20successfully','$batch_code','MaxStocks_data','</tbody>','language','$product_details.product_name','$paid_amount','Logo.png','Rack\x201','room','$product_details.rack','getDate','/upload/','$name','redirect','$alertquantity','get','<strong>\x20Regards\x20</strong>','$note','$product.type','product_id','primary_code_hide','</head><body>','secondary_code_hide','suppliers','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','type_of_products_type','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.primary_code','invoice','warehouse_name','\x20Order\x20Number\x20:\x20','3400595bRGHCM','currency','$suppliers_docs','uuid','product_details','/preview/:id','\x20units\x20to\x20warehouse:\x20','maxProducts','$product_details.storage','nodemailer','<tbody\x20style=\x22text-align:\x20center;\x22>','site_title','prod_unit','$product.quantity','\x20<>\x20','role',',\x20bin:\x20','$invoice','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','RoomAssign','</thead>','$sales_category','error','host','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','$product.floorlevel','stock_data','/all_purchases_finished/process/','sales_category','10inDIBt','date_recieved','Purchase\x20Return\x20Mail','$product_details.product_stock','$product_details.product_code','sendMail','en-CA','Finished\x20Goods','log','2316NpaNWC','updateOne','purchases_id','add_purchases_finished_logs','<!DOCTYPE\x20html>','$product.bay','$product_details.secondary_code','product','max_product_unit'];a0_0x3a8a=function(){return _0x40a5fb;};return a0_0x3a8a();}var a0_0x243e5b=a0_0x15a0;(function(_0x1c2efb,_0x209562){var _0x317f2e=a0_0x15a0,_0x1a08d5=_0x1c2efb();while(!![]){try{var _0x16bfa5=parseInt(_0x317f2e(0x1a0))/0x1*(parseInt(_0x317f2e(0x1ae))/0x2)+parseInt(_0x317f2e(0x130))/0x3*(parseInt(_0x317f2e(0x203))/0x4)+-parseInt(_0x317f2e(0x11d))/0x5+parseInt(_0x317f2e(0x10f))/0x6*(parseInt(_0x317f2e(0x1fd))/0x7)+-parseInt(_0x317f2e(0x147))/0x8+parseInt(_0x317f2e(0x189))/0x9*(parseInt(_0x317f2e(0x106))/0xa)+-parseInt(_0x317f2e(0x22b))/0xb;if(_0x16bfa5===_0x209562)break;else _0x1a08d5['push'](_0x1a08d5['shift']());}catch(_0x34ea4f){_0x1a08d5['push'](_0x1a08d5['shift']());}}}(a0_0x3a8a,0x1a62f));const express=require(a0_0x243e5b(0x1ec)),app=express(),router=express[a0_0x243e5b(0x225)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x243e5b(0x171)),auth=require(a0_0x243e5b(0x1f1)),nodemailer=require(a0_0x243e5b(0x234));var ejs=require(a0_0x243e5b(0x1cd));const path=require(a0_0x243e5b(0x1a6)),users=require(a0_0x243e5b(0x178)),{isNull}=require(a0_0x243e5b(0x168));router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x1cf),auth,async(_0x3feea5,_0x2ed653)=>{var _0x32a830=a0_0x243e5b;try{const {username:_0x59ad88,email:_0x2ac919,role:_0x33835b}=_0x3feea5[_0x32a830(0x1ce)],_0x3d7e00=_0x3feea5[_0x32a830(0x1ce)],_0x2b7601=await profile[_0x32a830(0x199)]({'email':_0x3d7e00['email']}),_0x3c0fa7=await staff[_0x32a830(0x199)]({'email':_0x3d7e00['email']}),_0xf60d7f=await master_shop[_0x32a830(0x1c4)]();let _0x5c3957=await transfers_finished[_0x32a830(0x183)]([{'$match':{'to_warehouse':_0x3c0fa7[_0x32a830(0x17d)]}}]);if(_0xf60d7f[0x0]['language']==_0x32a830(0x1e8))var _0x2d9a1d=users[_0x32a830(0x190)];else{if(_0xf60d7f[0x0]['language']==_0x32a830(0x15a))var _0x2d9a1d=users[_0x32a830(0x15a)];else{if(_0xf60d7f[0x0]['language']==_0x32a830(0x12e))var _0x2d9a1d=users[_0x32a830(0x12e)];else{if(_0xf60d7f[0x0][_0x32a830(0x20e)]=='Spanish')var _0x2d9a1d=users['Spanish'];else{if(_0xf60d7f[0x0][_0x32a830(0x20e)]==_0x32a830(0x16a))var _0x2d9a1d=users[_0x32a830(0x16a)];else{if(_0xf60d7f[0x0][_0x32a830(0x20e)]==_0x32a830(0x148))var _0x2d9a1d=users['Portuguese'];else{if(_0xf60d7f[0x0]['language']==_0x32a830(0x1c3))var _0x2d9a1d=users[_0x32a830(0x1c3)];else{if(_0xf60d7f[0x0][_0x32a830(0x20e)]==_0x32a830(0x186))var _0x2d9a1d=users[_0x32a830(0x1fe)];}}}}}}}_0x2ed653[_0x32a830(0x18f)]('incoming_view',{'success':_0x3feea5[_0x32a830(0x13a)](_0x32a830(0x195)),'errors':_0x3feea5[_0x32a830(0x13a)]('errors'),'purchases':_0x5c3957,'role':_0x3d7e00,'profile':_0x2b7601,'master_shop':_0xf60d7f,'language':_0x2d9a1d,'staff_data':_0x3c0fa7});}catch(_0x5b4b37){console[_0x32a830(0x10e)]('table\x20page',_0x5b4b37),_0x2ed653[_0x32a830(0x1c1)](0xc8)[_0x32a830(0x142)]({'message':_0x5b4b37['message']});}}),router[a0_0x243e5b(0x21a)]('/incoming/add',auth,async(_0x288f1d,_0xfb3543)=>{var _0x187ecf=a0_0x243e5b;try{const {username:_0x14a40e,email:_0xc530ec,role:_0x2fd9e1}=_0x288f1d[_0x187ecf(0x1ce)],_0xaa7cab=_0x288f1d['user'],_0x459b96=await profile[_0x187ecf(0x199)]({'email':_0xaa7cab[_0x187ecf(0x1bd)]}),_0xb3496=await staff[_0x187ecf(0x199)]({'email':_0xaa7cab[_0x187ecf(0x1bd)]}),_0xbf0457=await master_shop['find']();let _0x43dc6b=await transfers_finished[_0x187ecf(0x183)]([{'$match':{'to_warehouse':_0xb3496['warehouse'],'to_recieved':'false'}}]);if(_0xbf0457[0x0]['language']==_0x187ecf(0x1e8))var _0x3465d3=users[_0x187ecf(0x190)];else{if(_0xbf0457[0x0][_0x187ecf(0x20e)]=='Hindi')var _0x3465d3=users[_0x187ecf(0x15a)];else{if(_0xbf0457[0x0]['language']==_0x187ecf(0x12e))var _0x3465d3=users['German'];else{if(_0xbf0457[0x0][_0x187ecf(0x20e)]==_0x187ecf(0x15e))var _0x3465d3=users[_0x187ecf(0x15e)];else{if(_0xbf0457[0x0][_0x187ecf(0x20e)]==_0x187ecf(0x16a))var _0x3465d3=users[_0x187ecf(0x16a)];else{if(_0xbf0457[0x0][_0x187ecf(0x20e)]==_0x187ecf(0x148))var _0x3465d3=users[_0x187ecf(0x1a8)];else{if(_0xbf0457[0x0]['language']=='Chinese')var _0x3465d3=users['Chinese'];else{if(_0xbf0457[0x0][_0x187ecf(0x20e)]==_0x187ecf(0x186))var _0x3465d3=users[_0x187ecf(0x1fe)];}}}}}}}_0xfb3543['render'](_0x187ecf(0x15f),{'success':_0x288f1d['flash']('success'),'errors':_0x288f1d[_0x187ecf(0x13a)](_0x187ecf(0x126)),'purchases':_0x43dc6b,'role':_0xaa7cab,'profile':_0x459b96,'master_shop':_0xbf0457,'language':_0x3465d3,'staff_data':_0xb3496});}catch(_0x1eb319){console[_0x187ecf(0x10e)]('table\x20page',_0x1eb319),_0xfb3543['status'](0xc8)[_0x187ecf(0x142)]({'message':_0x1eb319[_0x187ecf(0x14a)]});}});const createLog=async _0x15af36=>{var _0x7af2ae=a0_0x243e5b;const _0x547f8f=new datalogs({'location':_0x15af36});return await _0x547f8f[_0x7af2ae(0x166)](),_0x547f8f[_0x7af2ae(0x1d5)];};router[a0_0x243e5b(0x17a)]('/incoming/add',auth,async(_0x825ead,_0x195b3d)=>{var _0x3d7806=a0_0x243e5b;try{const {invoice_trf_data:_0x255dee,item_code:_0x41a9b0,SCRN:_0x170e3a,ReqBy:_0x2341dc,type_of_products:_0x4cff98,dateofreq:_0x10bfd6,PO_number:_0x3af7b3,date:_0x1f8e08,warehouse_name:_0x2d4e51,typeservicesData:_0x580041,typevehicle:_0x2a0286,driver:_0x27be01,plate:_0xb5673e,van:_0x28cdd7,DRSI:_0xa141c1,TSU:_0x2c4d02,TFU:_0x25d2f6,note:_0x560cc6}=_0x825ead['body'],_0x555e78=await transfers_finished[_0x3d7806(0x18a)](_0x255dee);if(typeof _0x41a9b0==_0x3d7806(0x1b8))var _0x13d62a=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1c7)]],_0x20ca32=[_0x825ead['body'][_0x3d7806(0x180)]],_0x2188e4=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1f9)]],_0x2c2cb5=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1d2)]],_0x2ef3eb=[_0x825ead[_0x3d7806(0x184)]['prod_secondunit']],_0x4189a6=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x13d)]],_0x56918a=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x17f)]],_0x37f5c4=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x18e)]],_0xc06d01=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1e3)]],_0x543d52=[_0x825ead[_0x3d7806(0x184)][_0x3d7806(0x179)]],_0x44e827=[_0x825ead[_0x3d7806(0x184)]['production_date']],_0x21aae3=[_0x825ead[_0x3d7806(0x184)]['max_product_unit']],_0x44812c=[_0x825ead['body'][_0x3d7806(0x213)]];else var _0x13d62a=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1c7)]],_0x20ca32=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x180)]],_0x2188e4=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1f9)]],_0x2c2cb5=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x1d2)]],_0x2ef3eb=[..._0x825ead[_0x3d7806(0x184)]['prod_secondunit']],_0x4189a6=[..._0x825ead['body'][_0x3d7806(0x13d)]],_0x56918a=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x17f)]],_0x37f5c4=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x18e)]],_0xc06d01=[..._0x825ead[_0x3d7806(0x184)]['batch_code']],_0x543d52=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x179)]],_0x44e827=[..._0x825ead[_0x3d7806(0x184)]['production_date']],_0x21aae3=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x117)]],_0x44812c=[..._0x825ead[_0x3d7806(0x184)][_0x3d7806(0x213)]];const _0x542532=_0x13d62a[_0x3d7806(0x16b)](_0xa29b89=>{return _0xa29b89={'product_name':_0xa29b89};});_0x20ca32[_0x3d7806(0x181)]((_0x2ea81a,_0x1c65af)=>{var _0xbe831=_0x3d7806;_0x542532[_0x1c65af][_0xbe831(0x16d)]=_0x2ea81a;}),_0x2188e4[_0x3d7806(0x181)]((_0x3ab5a4,_0x3221bd)=>{var _0x290c69=_0x3d7806;_0x542532[_0x3221bd][_0x290c69(0x14d)]=Math[_0x290c69(0x1fc)](_0x3ab5a4);}),_0x2c2cb5[_0x3d7806(0x181)]((_0x26d331,_0x4895ce)=>{var _0x1abccb=_0x3d7806;_0x542532[_0x4895ce][_0x1abccb(0x1bf)]=_0x26d331;}),_0x2ef3eb[_0x3d7806(0x181)]((_0x30161d,_0x41e844)=>{var _0x472fd4=_0x3d7806;_0x542532[_0x41e844][_0x472fd4(0x16e)]=_0x30161d;}),_0x4189a6[_0x3d7806(0x181)]((_0x363572,_0x4b5df6)=>{var _0x59a818=_0x3d7806,_0x77fcad=_0x363572[_0x59a818(0x146)](/[A-Za-z]+/)[0x0],_0x4b8b02=parseInt(_0x363572[_0x59a818(0x146)](/\d+/)[0x0]);_0x542532[_0x4b5df6][_0x59a818(0x1a2)]=_0x77fcad,_0x542532[_0x4b5df6][_0x59a818(0xfa)]=_0x4b8b02;}),_0x56918a[_0x3d7806(0x181)]((_0x144b0e,_0x10c526)=>{var _0x10b42c=_0x3d7806;_0x542532[_0x10c526][_0x10b42c(0x17f)]=_0x144b0e;}),_0x37f5c4['forEach']((_0x5f3747,_0x49e6a0)=>{var _0x419160=_0x3d7806;_0x542532[_0x49e6a0][_0x419160(0x18e)]=_0x5f3747;}),_0xc06d01['forEach']((_0x56e22a,_0x1ddb90)=>{_0x542532[_0x1ddb90]['batch_code']=_0x56e22a;}),_0x543d52[_0x3d7806(0x181)]((_0x2cdf5a,_0x24c822)=>{var _0x3fd463=_0x3d7806;_0x542532[_0x24c822][_0x3fd463(0x179)]=_0x2cdf5a;}),_0x44e827[_0x3d7806(0x181)]((_0x323265,_0x40682d)=>{_0x542532[_0x40682d]['production_date']=_0x323265;}),_0x21aae3[_0x3d7806(0x181)]((_0x23ac54,_0x1510e3)=>{var _0x50fce1=_0x3d7806;_0x542532[_0x1510e3][_0x50fce1(0x154)]=_0x23ac54;}),_0x44812c[_0x3d7806(0x181)]((_0xd8e4af,_0x11fc7d)=>{_0x542532[_0x11fc7d]['room_name']=_0xd8e4af;});const _0x3850a7=await createLog(_0x3d7806(0x19a));_0x44812c[_0x3d7806(0x181)]((_0x59d7d5,_0x1d3bcc)=>{var _0x4fdc85=_0x3d7806;_0x542532[_0x1d3bcc][_0x4fdc85(0x228)]=_0x4fdc85(0x1d6)+_0x3850a7[_0x4fdc85(0x1e1)]()[_0x4fdc85(0x120)](0x8,'0');});const _0x16e6be=_0x542532[_0x3d7806(0x194)](_0x2142dd=>_0x2142dd['quantity']!=='0'&&_0x2142dd[_0x3d7806(0x14d)]!==''),_0x447c1e=new purchases_incoming({'invoice':_0x3d7806(0x1d6)+_0x3850a7[_0x3d7806(0x1e1)]()[_0x3d7806(0x120)](0x8,'0'),'date':_0x1f8e08,'warehouse_name':_0x2d4e51,'product':_0x16e6be,'note':_0x560cc6,'POnumber':_0x3af7b3,'SCRN':_0x170e3a,'ReqBy':_0x2341dc,'dateofreq':_0x10bfd6,'typeservicesData':_0x580041,'van':_0x28cdd7,'typevehicle':_0x2a0286,'driver':_0x27be01,'plate':_0xb5673e,'DRSI':_0xa141c1,'TSU':_0x2c4d02,'TFU':_0x25d2f6,'typeOfProducts':_0x4cff98}),_0x5d4c33=await _0x447c1e[_0x3d7806(0x166)](),_0x350f10=_0x5d4c33['product'][_0x3d7806(0x16b)](async _0xddf004=>{var _0xeadd9d=_0x3d7806,_0x45de49=await warehouse['findOne']({'name':_0x2d4e51,'room':_0xddf004[_0xeadd9d(0x1e6)]});if(_0xddf004['quantity']>0x0){var _0xa0cb47=0x0;const _0x15e60d=_0x45de49[_0xeadd9d(0x22f)]['map'](_0x22799d=>{var _0x1fb7af=_0xeadd9d;_0x22799d[_0x1fb7af(0x1c7)]==_0xddf004[_0x1fb7af(0x1c7)]&&_0x22799d[_0x1fb7af(0xfa)]==_0xddf004[_0x1fb7af(0x155)]&&_0x22799d[_0x1fb7af(0x179)]==_0xddf004[_0x1fb7af(0x179)]&&_0x22799d[_0x1fb7af(0x1ea)]==_0xddf004[_0x1fb7af(0x1ea)]&&_0x22799d[_0x1fb7af(0x1e3)]==_0xddf004[_0x1fb7af(0x1e3)]&&_0x22799d[_0x1fb7af(0x228)]==_0xddf004['invoice']&&(typeof _0xddf004[_0x1fb7af(0x1b2)]==_0x1fb7af(0x145)?(console[_0x1fb7af(0x10e)](_0x1fb7af(0x129),_0x22799d['product_stock']+_0x1fb7af(0xf6)+_0x22799d['_id']+_0x1fb7af(0x12d)+Math[_0x1fb7af(0x1fc)](_0x22799d['product_stock'])+Math[_0x1fb7af(0x1fc)](_0xddf004[_0x1fb7af(0x1f9)])),_0x22799d[_0x1fb7af(0x124)]=Math['abs'](_0x22799d['product_stock'])+Math['abs'](_0xddf004[_0x1fb7af(0x14d)])):(_0x22799d['product_stock']=Math[_0x1fb7af(0x1fc)](_0x22799d['product_stock'])+Math[_0x1fb7af(0x1fc)](_0xddf004[_0x1fb7af(0x14d)]),_0xa0cb47++));});_0xa0cb47=='0'&&(_0x45de49[_0xeadd9d(0x22f)]=_0x45de49[_0xeadd9d(0x22f)]['concat']({'product_name':_0xddf004[_0xeadd9d(0x1c7)],'product_stock':_0xddf004[_0xeadd9d(0x14d)],'bay':_0xddf004['bay'],'level':_0xddf004[_0xeadd9d(0x1a2)],'product_code':_0xddf004['product_code'],'primary_code':_0xddf004[_0xeadd9d(0x17f)],'secondary_code':_0xddf004[_0xeadd9d(0x18e)],'expiry_date':_0xddf004[_0xeadd9d(0x179)],'production_date':_0xddf004[_0xeadd9d(0x1ea)],'maxProducts':_0xddf004[_0xeadd9d(0x232)],'batch_code':_0xddf004[_0xeadd9d(0x1e3)],'secondary_unit':_0xddf004['secondary_unit'],'unit':_0xddf004[_0xeadd9d(0x1bf)],'maxProducts':_0xddf004[_0xeadd9d(0x232)],'maxPerUnit':_0xddf004[_0xeadd9d(0x176)],'invoice':_0xddf004[_0xeadd9d(0x228)]}));}return _0x45de49;});Promise['all'](_0x350f10)[_0x3d7806(0x121)](async _0x22b6ed=>{var _0x550526=_0x3d7806;try{for(const _0x41d49c of _0x22b6ed){await warehouse[_0x550526(0x110)]({'_id':_0x41d49c[_0x550526(0x1ac)]},{'$addToSet':{'product_details':{'$each':_0x41d49c[_0x550526(0x22f)]}}});}_0x555e78['to_recieved']=_0x550526(0x169);const _0x56d1d8=await _0x555e78[_0x550526(0x166)](),_0xcec306=await master_shop[_0x550526(0x1c4)](),_0x164c37=await email_settings[_0x550526(0x199)](),_0x325031=await supervisor_settings[_0x550526(0x1c4)]();var _0xfce08f=_0x447c1e[_0x550526(0x116)],_0x24f5f0='',_0x187505;for(_0x187505 in _0xfce08f){var _0x52c98f='FG';_0x447c1e['to_warehouse']=='DRY\x20GOODS'&&(_0x52c98f='DG'),_0x24f5f0+=_0x550526(0x1b1)+_0x550526(0x1ee)+_0xfce08f[_0x187505][_0x550526(0x1c7)]+'</td>'+_0x550526(0x1ee)+_0xfce08f[_0x187505]['product_code']+_0x550526(0x18d)+_0x550526(0x1ee)+_0xfce08f[_0x187505]['to_quantity']+_0x550526(0x18d)+_0x550526(0x1ee)+_0xfce08f[_0x187505][_0x550526(0x1d2)]+_0x550526(0x18d)+_0x550526(0x1ee)+_0xfce08f[_0x187505]['secondary_unit']+_0x550526(0x18d)+_0x550526(0x1ee)+_0x447c1e['to_warehouse']+_0x550526(0x18d)+_0x550526(0x1ee)+_0xfce08f[_0x187505]['to_room_name']+'</td>'+_0x550526(0x1ee)+_0x52c98f+_0xfce08f[_0x187505][_0x550526(0x155)]+_0x550526(0x18d)+_0x550526(0x132);}_0x825ead[_0x550526(0x13a)](_0x550526(0x195),_0x550526(0x192)),_0x195b3d[_0x550526(0x218)](_0x550526(0x1eb)+_0x5d4c33['_id']);}catch(_0x594413){console['error'](_0x594413),_0x195b3d['status'](0x1f4)[_0x550526(0x142)]({'error':_0x550526(0x209)});}})['catch'](_0x5aac41=>{var _0x432aef=_0x3d7806;console[_0x432aef(0xff)](_0x5aac41),_0x195b3d[_0x432aef(0x1c1)](0x1f4)[_0x432aef(0x142)]({'error':_0x432aef(0x138)});});}catch(_0x9936be){}}),router[a0_0x243e5b(0x17a)]('/getTRF',auth,async(_0x3ef8fd,_0x3e72b6)=>{var _0x27531d=a0_0x243e5b;try{const {warehouse:_0x3936f4}=_0x3ef8fd['body'],_0x2cd683=await transfers_finished[_0x27531d(0x1c4)]({'to_warehouse':_0x3936f4,'to_recieved':'false'});_0x3e72b6[_0x27531d(0x142)](_0x2cd683);}catch(_0x45da90){}}),router[a0_0x243e5b(0x17a)](a0_0x243e5b(0x131),auth,async(_0x5198a8,_0xd845c6)=>{var _0x523438=a0_0x243e5b;try{const {invoice:_0x11121b}=_0x5198a8[_0x523438(0x184)],_0x3dc7ca=await transfers_finished[_0x523438(0x1c4)]({'_id':_0x11121b,'to_recieved':_0x523438(0x1f5)});_0xd845c6[_0x523438(0x142)](_0x3dc7ca);}catch(_0x548d09){}}),router['get'](a0_0x243e5b(0x1be),auth,async(_0x39b121,_0x47fb09)=>{var _0x48dfb5=a0_0x243e5b;try{const {username:_0x183d93,email:_0x188d34,role:_0x31ddd6}=_0x39b121[_0x48dfb5(0x1ce)],_0x90e9f3=_0x39b121[_0x48dfb5(0x1ce)],_0x19180e=await profile[_0x48dfb5(0x199)]({'email':_0x90e9f3[_0x48dfb5(0x1bd)]}),_0x568dbc=await staff[_0x48dfb5(0x199)]({'email':_0x90e9f3['email']});if(_0x90e9f3[_0x48dfb5(0xf7)]==_0x48dfb5(0x165)){const _0xf990ba=await staff[_0x48dfb5(0x199)]({'email':_0x90e9f3[_0x48dfb5(0x1bd)]});}const _0x22b507=await master_shop['find']();let _0x5b0f57;if(_0x90e9f3['role']==_0x48dfb5(0x165)){const _0x562ddd=await staff[_0x48dfb5(0x199)]({'email':_0x90e9f3[_0x48dfb5(0x1bd)]});_0x5b0f57=await purchases_finished[_0x48dfb5(0x183)]([{'$match':{'warehouse_name':_0x562ddd['warehouse'],'typeOfProducts':_0x48dfb5(0x1af)}},{'$lookup':{'from':_0x48dfb5(0x222),'localField':'suppliers','foreignField':'name','as':_0x48dfb5(0x1ad)}},{'$unwind':_0x48dfb5(0x22d)},{'$unwind':'$product'},{'$group':{'_id':_0x48dfb5(0x156),'invoice':{'$first':_0x48dfb5(0xf9)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x48dfb5(0x1aa)},'warehouse_name':{'$first':_0x48dfb5(0x1b3)},'room':{'$first':_0x48dfb5(0x17e)},'product':{'$push':_0x48dfb5(0x12b)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x48dfb5(0x1b0)},'return_data':{'$first':_0x48dfb5(0x134)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x48dfb5(0x22d)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x48dfb5(0x114)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x48dfb5(0x102)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5b0f57=await purchases_finished[_0x48dfb5(0x183)]([{'$match':{'typeOfProducts':_0x48dfb5(0x1af)}},{'$unwind':_0x48dfb5(0x12b)},{'$group':{'_id':_0x48dfb5(0x156),'invoice':{'$first':_0x48dfb5(0xf9)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x48dfb5(0x1b3)},'room':{'$addToSet':_0x48dfb5(0x12c)},'product':{'$push':_0x48dfb5(0x12b)},'note':{'$first':_0x48dfb5(0x21c)},'paid_amount':{'$first':_0x48dfb5(0x210)},'due_amount':{'$first':_0x48dfb5(0x1b0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x48dfb5(0x19d)},'suppliers_docs':{'$first':_0x48dfb5(0x22d)},'total_product_quantity':{'$sum':_0x48dfb5(0xf5)},'level':{'$addToSet':_0x48dfb5(0x114)},'isle':{'$addToSet':_0x48dfb5(0x1a3)},'type':{'$addToSet':_0x48dfb5(0x21d)},'floorlevel':{'$addToSet':_0x48dfb5(0x102)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x22b507[0x0][_0x48dfb5(0x20e)]==_0x48dfb5(0x1e8))var _0x3110bc=users[_0x48dfb5(0x190)];else{if(_0x22b507[0x0]['language']==_0x48dfb5(0x15a))var _0x3110bc=users[_0x48dfb5(0x15a)];else{if(_0x22b507[0x0][_0x48dfb5(0x20e)]=='German')var _0x3110bc=users[_0x48dfb5(0x12e)];else{if(_0x22b507[0x0]['language']==_0x48dfb5(0x15e))var _0x3110bc=users['Spanish'];else{if(_0x22b507[0x0][_0x48dfb5(0x20e)]==_0x48dfb5(0x16a))var _0x3110bc=users[_0x48dfb5(0x16a)];else{if(_0x22b507[0x0]['language']==_0x48dfb5(0x148))var _0x3110bc=users[_0x48dfb5(0x1a8)];else{if(_0x22b507[0x0][_0x48dfb5(0x20e)]==_0x48dfb5(0x1c3))var _0x3110bc=users['Chinese'];else{if(_0x22b507[0x0]['language']==_0x48dfb5(0x186))var _0x3110bc=users['Arabic'];}}}}}}}_0x47fb09[_0x48dfb5(0x18f)](_0x48dfb5(0x149),{'success':_0x39b121[_0x48dfb5(0x13a)](_0x48dfb5(0x195)),'errors':_0x39b121[_0x48dfb5(0x13a)]('errors'),'purchases':_0x5b0f57,'role':_0x90e9f3,'profile':_0x19180e,'master_shop':_0x22b507,'language':_0x3110bc});}catch(_0x12ee3e){console['log'](_0x48dfb5(0x1c6),_0x12ee3e),_0x47fb09[_0x48dfb5(0x1c1)](0xc8)['json']({'message':_0x12ee3e['message']});}}),router['get'](a0_0x243e5b(0x1e0),auth,async(_0x320528,_0x5e5462)=>{var _0x2d54c5=a0_0x243e5b;try{const {username:_0x5a4ae0,email:_0x3a8057,role:_0x22b683}=_0x320528[_0x2d54c5(0x1ce)],_0x583267=_0x320528[_0x2d54c5(0x1ce)],_0xe5b5c5=await profile['findOne']({'email':_0x583267[_0x2d54c5(0x1bd)]}),_0x5dbca2=await staff['findOne']({'email':_0x583267[_0x2d54c5(0x1bd)]});if(_0x583267[_0x2d54c5(0xf7)]=='staff'){const _0x570735=await staff['findOne']({'email':_0x583267[_0x2d54c5(0x1bd)]});}const _0x4883c2=await master_shop[_0x2d54c5(0x1c4)]();let _0x2db9ef;if(_0x583267['role']=='staff'){const _0x2eb2fc=await staff[_0x2d54c5(0x199)]({'email':_0x583267[_0x2d54c5(0x1bd)]});_0x2db9ef=await purchases_finished[_0x2d54c5(0x183)]([{'$match':{'warehouse_name':_0x2eb2fc[_0x2d54c5(0x17d)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x2d54c5(0x16f),'as':_0x2d54c5(0x1ad)}},{'$unwind':_0x2d54c5(0x22d)},{'$unwind':_0x2d54c5(0x12b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2d54c5(0xf9)},'suppliers':{'$first':_0x2d54c5(0x1bb)},'date':{'$first':_0x2d54c5(0x1aa)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2d54c5(0x17e)},'product':{'$push':_0x2d54c5(0x12b)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2d54c5(0x1b0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x2d54c5(0x20b)},'expiry_date':{'$first':_0x2d54c5(0x19d)},'suppliers_docs':{'$first':_0x2d54c5(0x22d)},'total_product_quantity':{'$sum':_0x2d54c5(0xf5)},'level':{'$addToSet':_0x2d54c5(0x114)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2d54c5(0x21d)},'floorlevel':{'$addToSet':_0x2d54c5(0x102)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2db9ef=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x2d54c5(0x19c)}},{'$unwind':_0x2d54c5(0x12b)},{'$group':{'_id':_0x2d54c5(0x156),'invoice':{'$first':_0x2d54c5(0xf9)},'suppliers':{'$first':_0x2d54c5(0x1bb)},'date':{'$first':_0x2d54c5(0x1aa)},'warehouse_name':{'$first':_0x2d54c5(0x1b3)},'room':{'$addToSet':_0x2d54c5(0x12c)},'product':{'$push':'$product'},'note':{'$first':_0x2d54c5(0x21c)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2d54c5(0x1b0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2d54c5(0x19d)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x2d54c5(0xf5)},'level':{'$addToSet':_0x2d54c5(0x114)},'isle':{'$addToSet':_0x2d54c5(0x1a3)},'type':{'$addToSet':_0x2d54c5(0x21d)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4883c2[0x0][_0x2d54c5(0x20e)]==_0x2d54c5(0x1e8))var _0x12a06e=users[_0x2d54c5(0x190)];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]==_0x2d54c5(0x15a))var _0x12a06e=users[_0x2d54c5(0x15a)];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]==_0x2d54c5(0x12e))var _0x12a06e=users[_0x2d54c5(0x12e)];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]==_0x2d54c5(0x15e))var _0x12a06e=users[_0x2d54c5(0x15e)];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]=='French')var _0x12a06e=users['French'];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]==_0x2d54c5(0x148))var _0x12a06e=users['Portuguese'];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]=='Chinese')var _0x12a06e=users[_0x2d54c5(0x1c3)];else{if(_0x4883c2[0x0][_0x2d54c5(0x20e)]=='Arabic\x20(ae)')var _0x12a06e=users[_0x2d54c5(0x1fe)];}}}}}}}_0x5e5462[_0x2d54c5(0x18f)](_0x2d54c5(0x191),{'success':_0x320528[_0x2d54c5(0x13a)]('success'),'errors':_0x320528[_0x2d54c5(0x13a)]('errors'),'purchases':_0x2db9ef,'role':_0x583267,'profile':_0xe5b5c5,'master_shop':_0x4883c2,'language':_0x12a06e});}catch(_0x4f3f36){console[_0x2d54c5(0x10e)]('table\x20page',_0x4f3f36),_0x5e5462[_0x2d54c5(0x1c1)](0xc8)[_0x2d54c5(0x142)]({'message':_0x4f3f36[_0x2d54c5(0x14a)]});}});function BayBinSelected(_0x1af26a,_0x3ad405){var _0x279091=a0_0x243e5b,_0x39bb1d=[],_0x417780=[];if(_0x1af26a=='DRY\x20GOODS'){switch(_0x3ad405){case _0x279091(0x212):_0x39bb1d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x39bb1d=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x417780=['DG'];}else{if(_0x1af26a=='FROZEN\x20GOODS'){switch(_0x3ad405){case'Rack\x201':_0x39bb1d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x279091(0x187):_0x39bb1d=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x417780=['FG'];}}return{'levels':_0x39bb1d,'identify':_0x417780};}function a0_0x15a0(_0x16baac,_0x43aee1){var _0x3a8a4e=a0_0x3a8a();return a0_0x15a0=function(_0x15a03f,_0x4c46dd){_0x15a03f=_0x15a03f-0xf4;var _0x4adcc7=_0x3a8a4e[_0x15a03f];return _0x4adcc7;},a0_0x15a0(_0x16baac,_0x43aee1);}async function getRandom8DigitNumber(){var _0x403199=a0_0x243e5b;const _0x1e6194=0x989680,_0x2f6941=0x5f5e0ff,_0x1c0636=Math['floor'](Math['random']()*(_0x2f6941-_0x1e6194+0x1))+_0x1e6194;var _0x501b65;const _0x2a5057=await purchases_finished[_0x403199(0x199)]({'invoice':_0x403199(0x1da)+_0x1c0636});return _0x2a5057&&_0x2a5057['length']>0x0?_0x501b65=_0x403199(0x1da)+_0x1c0636:_0x501b65=_0x403199(0x1da)+_0x1c0636,_0x501b65;}router['get']('/view/add_purchases',auth,async(_0x39fd2c,_0x31d155)=>{var _0x127da2=a0_0x243e5b;try{const {username:_0x4302b1,email:_0x21d5f7,role:_0xcf04b6}=_0x39fd2c['user'],_0xabe27d=_0x39fd2c[_0x127da2(0x1ce)],_0x1eb2f2=await profile[_0x127da2(0x199)]({'email':_0xabe27d[_0x127da2(0x1bd)]}),_0x2d217b=await master_shop['find'](),_0x2f1438=await staff[_0x127da2(0x199)]({'email':_0xabe27d[_0x127da2(0x1bd)]}),_0x1c2750=await suppliers[_0x127da2(0x1c4)]({});let _0x4ac695;if(_0xabe27d[_0x127da2(0xf7)]==_0x127da2(0x165)){const _0x352b36=await staff[_0x127da2(0x199)]({'email':_0xabe27d[_0x127da2(0x1bd)]});_0x4ac695=await warehouse[_0x127da2(0x183)]([{'$match':{'status':'Enabled','name':_0x352b36['warehouse']}},{'$group':{'_id':_0x127da2(0x217),'name':{'$first':'$name'}}}]);}else _0x4ac695=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x127da2(0x217),'name':{'$first':_0x127da2(0x217)}}}]);const _0x429252=await product[_0x127da2(0x1c4)]({}),_0x2e239c=await warehouse[_0x127da2(0x1c4)]({'status':'Enabled'}),_0x197783=await purchases_finished['find']({}),_0x11290e=_0x197783[_0x127da2(0x1fa)]+0x1,_0x4f7d2c=_0x127da2(0x1da)+_0x11290e['toString']()[_0x127da2(0x120)](0x5,'0');var _0x322336=['Ambient','Enclosed'];if(_0x2d217b[0x0]['language']==_0x127da2(0x1e8))var _0x919904=users[_0x127da2(0x190)];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]==_0x127da2(0x15a))var _0x919904=users[_0x127da2(0x15a)];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]==_0x127da2(0x12e))var _0x919904=users['German'];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]==_0x127da2(0x15e))var _0x919904=users[_0x127da2(0x15e)];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]==_0x127da2(0x16a))var _0x919904=users[_0x127da2(0x16a)];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]=='Portuguese\x20(BR)')var _0x919904=users[_0x127da2(0x1a8)];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]=='Chinese')var _0x919904=users[_0x127da2(0x1c3)];else{if(_0x2d217b[0x0][_0x127da2(0x20e)]==_0x127da2(0x186))var _0x919904=users[_0x127da2(0x1fe)];}}}}}}}const _0x30a1ee=getRandom8DigitNumber(),_0x1abd37=new Date(),_0x5c9ed4={'year':'numeric','month':_0x127da2(0x204),'day':'2-digit','timeZone':_0x127da2(0x1c8)},_0x15d772=_0x1abd37['toLocaleDateString'](_0x127da2(0x10c),_0x5c9ed4);console['log'](_0x15d772),_0x30a1ee[_0x127da2(0x121)](_0x26c897=>{var _0x5e495d=_0x127da2;_0x31d155[_0x5e495d(0x18f)](_0x5e495d(0x198),{'success':_0x39fd2c[_0x5e495d(0x13a)](_0x5e495d(0x195)),'errors':_0x39fd2c[_0x5e495d(0x13a)](_0x5e495d(0x126)),'role':_0xabe27d,'profile':_0x1eb2f2,'suppliers':_0x1c2750,'warehouse':_0x4ac695,'product':_0x429252,'invoice':_0x26c897,'master_shop':_0x2d217b,'language':_0x919904,'find_data':_0x2e239c,'rooms_data':_0x322336,'formattedDate':_0x15d772});})['catch'](_0x39e0c0=>{var _0x1cac44=_0x127da2;_0x39fd2c['flash']('errors',_0x1cac44(0x1ff)),_0x31d155[_0x1cac44(0x218)](_0x1cac44(0x144));});}catch(_0x561140){console[_0x127da2(0x10e)](_0x561140);}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x11c),auth,async(_0xbbc168,_0x268d42)=>{var _0x53d55b=a0_0x243e5b;try{const {username:_0x54e21d,email:_0x34d2d5,role:_0x18b4e9}=_0xbbc168[_0x53d55b(0x1ce)],_0x2a7c32=_0xbbc168[_0x53d55b(0x1ce)],_0x2a2b2a=await profile[_0x53d55b(0x199)]({'email':_0x2a7c32[_0x53d55b(0x1bd)]}),_0x138cee=await master_shop['find'](),_0x556bd1=await staff[_0x53d55b(0x199)]({'email':_0x2a7c32[_0x53d55b(0x1bd)]}),_0x366d15=await suppliers['find']({});let _0x363e98;if(_0x2a7c32[_0x53d55b(0xf7)]==_0x53d55b(0x165)){const _0x57dd81=await staff[_0x53d55b(0x199)]({'email':_0x2a7c32['email']});_0x363e98=await warehouse[_0x53d55b(0x183)]([{'$match':{'status':_0x53d55b(0x1bc),'name':_0x57dd81[_0x53d55b(0x17d)]}},{'$group':{'_id':_0x53d55b(0x217),'name':{'$first':_0x53d55b(0x217)}}}]);}else _0x363e98=await warehouse[_0x53d55b(0x183)]([{'$match':{'status':_0x53d55b(0x1bc)}},{'$group':{'_id':_0x53d55b(0x217),'name':{'$first':'$name'}}}]);const _0x249227=await product['find']({}),_0x4430de=await warehouse['find']({'status':'Enabled'}),_0x45b7db=await purchases_finished[_0x53d55b(0x1c4)]({}),_0x22e808=_0x45b7db[_0x53d55b(0x1fa)]+0x1,_0x4c4b03='INCF-'+_0x22e808[_0x53d55b(0x1e1)]()[_0x53d55b(0x120)](0x5,'0');var _0x275542=[_0x53d55b(0x11a),'Enclosed'];if(_0x138cee[0x0][_0x53d55b(0x20e)]==_0x53d55b(0x1e8))var _0x474654=users[_0x53d55b(0x190)];else{if(_0x138cee[0x0][_0x53d55b(0x20e)]==_0x53d55b(0x15a))var _0x474654=users[_0x53d55b(0x15a)];else{if(_0x138cee[0x0][_0x53d55b(0x20e)]==_0x53d55b(0x12e))var _0x474654=users[_0x53d55b(0x12e)];else{if(_0x138cee[0x0][_0x53d55b(0x20e)]==_0x53d55b(0x15e))var _0x474654=users[_0x53d55b(0x15e)];else{if(_0x138cee[0x0]['language']==_0x53d55b(0x16a))var _0x474654=users['French'];else{if(_0x138cee[0x0]['language']=='Portuguese\x20(BR)')var _0x474654=users[_0x53d55b(0x1a8)];else{if(_0x138cee[0x0][_0x53d55b(0x20e)]==_0x53d55b(0x1c3))var _0x474654=users[_0x53d55b(0x1c3)];else{if(_0x138cee[0x0][_0x53d55b(0x20e)]=='Arabic\x20(ae)')var _0x474654=users[_0x53d55b(0x1fe)];}}}}}}}const _0x31db6f=getRandom8DigitNumber();_0x31db6f[_0x53d55b(0x121)](_0x14a3d0=>{var _0x56223e=_0x53d55b;_0x268d42[_0x56223e(0x18f)](_0x56223e(0x112),{'success':_0xbbc168[_0x56223e(0x13a)](_0x56223e(0x195)),'errors':_0xbbc168['flash'](_0x56223e(0x126)),'role':_0x2a7c32,'profile':_0x2a2b2a,'suppliers':_0x366d15,'warehouse':_0x363e98,'product':_0x249227,'invoice':_0x14a3d0,'master_shop':_0x138cee,'language':_0x474654,'find_data':_0x4430de,'rooms_data':_0x275542});})['catch'](_0x1aa150=>{var _0x3e05b9=_0x53d55b;_0xbbc168[_0x3e05b9(0x13a)](_0x3e05b9(0x126),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x268d42[_0x3e05b9(0x218)](_0x3e05b9(0x144));});}catch(_0x2ee125){console[_0x53d55b(0x10e)](_0x2ee125);}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x153),auth,async(_0x28bf18,_0x49cd25)=>{var _0x5468b2=a0_0x243e5b;try{const _0x28fda5=_0x28bf18[_0x5468b2(0x11f)]['id'];console[_0x5468b2(0x10e)](_0x28fda5);const _0x20f21b=await master_shop[_0x5468b2(0x1c4)]();console[_0x5468b2(0x10e)]('master',_0x20f21b);const _0x36b9a5=await product[_0x5468b2(0x199)]({'name':_0x28fda5});console[_0x5468b2(0x10e)]('product',_0x36b9a5),_0x49cd25[_0x5468b2(0x1c1)](0xc8)['json']({'product_data':_0x36b9a5,'master':_0x20f21b});}catch(_0x596e93){console[_0x5468b2(0x10e)](_0x5468b2(0x205),_0x596e93);}}),router['post']('/view/add_purchases',auth,async(_0xcf7ec4,_0x76831b)=>{var _0x84ce04=a0_0x243e5b;try{const {invoice:_0x9fb00f,date:_0x4f0d62,warehouse_name:_0x14a67a,prod_name:_0x58a590,note:_0x3e9c2e,due_amount:_0x112c50,Room_name:_0x464288,PO_number:_0x2832eb,SCRN:_0x51f376,ReqBy:_0x153c5d,dateofreq:_0x53d339,suppliers:_0x4a8481,typeservicesData:_0x33b366,van:_0xe37640,typevehicle:_0x5b113a,driver:_0x2e6668,plate:_0x24f739,DRSI:_0x426a07,TSU:_0x33ced5,TFU:_0x57f7b2,JO_number:_0x2d5bcf,type_of_products:_0xf14bf0}=_0xcf7ec4[_0x84ce04(0x184)];if(typeof _0x58a590==_0x84ce04(0x1b8))var _0x2dbdd8=[_0xcf7ec4[_0x84ce04(0x184)]['prod_name']],_0x5313fa=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x123)]],_0x5eb630=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x164)]],_0x143e1f=[_0xcf7ec4[_0x84ce04(0x184)]['prod_primunit']],_0x5e22d9=[_0xcf7ec4['body'][_0x84ce04(0x174)]],_0x23ac26=[_0xcf7ec4[_0x84ce04(0x184)]['prod_level']],_0x3ad97d=[_0xcf7ec4['body'][_0x84ce04(0x17f)]],_0x435b07=[_0xcf7ec4[_0x84ce04(0x184)]['secondary_code']],_0x21b989=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x20c)]],_0x21765b=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x1e3)]],_0x5b6173=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x179)]],_0x1cb542=[_0xcf7ec4['body']['product_date']],_0x13f3a9=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x117)]],_0x2140ac=[_0xcf7ec4[_0x84ce04(0x184)]['prod_cat']],_0x12c2fe=[_0xcf7ec4['body'][_0x84ce04(0xfc)]],_0x5dde79=[_0xcf7ec4[_0x84ce04(0x184)]['gross_price']],_0x1476b2=[_0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x22e)]],_0x36c8a2=[_0xcf7ec4[_0x84ce04(0x184)]['sales_data_cateory']],_0x599f25=[_0xcf7ec4[_0x84ce04(0x184)]['product_id']];else var _0x2dbdd8=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x18c)]],_0x5313fa=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x123)]],_0x5eb630=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x164)]],_0x143e1f=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x1f0)]],_0x5e22d9=[..._0xcf7ec4[_0x84ce04(0x184)]['prod_secondunit']],_0x23ac26=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x1f8)]],_0x3ad97d=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x17f)]],_0x435b07=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x18e)]],_0x21b989=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x20c)]],_0x21765b=[..._0xcf7ec4[_0x84ce04(0x184)]['batch_code']],_0x5b6173=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x179)]],_0x1cb542=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x17b)]],_0x13f3a9=[..._0xcf7ec4['body'][_0x84ce04(0x117)]],_0x2140ac=[..._0xcf7ec4[_0x84ce04(0x184)]['prod_cat']],_0x12c2fe=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0xfc)]],_0x5dde79=[..._0xcf7ec4['body'][_0x84ce04(0x1b5)]],_0x1476b2=[..._0xcf7ec4['body'][_0x84ce04(0x22e)]],_0x36c8a2=[..._0xcf7ec4[_0x84ce04(0x184)][_0x84ce04(0x1d3)]],_0x599f25=[..._0xcf7ec4['body'][_0x84ce04(0x21e)]];const _0x47b081=_0x2dbdd8[_0x84ce04(0x16b)](_0x459028=>{return _0x459028={'product_name':_0x459028};});_0x599f25[_0x84ce04(0x181)]((_0x11e442,_0x2b3a0f)=>{var _0x4ebf7b=_0x84ce04;_0x47b081[_0x2b3a0f][_0x4ebf7b(0x21e)]=_0x11e442,_0x47b081[_0x2b3a0f][_0x4ebf7b(0x107)]=_0x4f0d62;}),_0x36c8a2['forEach']((_0x653b82,_0x544f7c)=>{var _0x167802=_0x84ce04;_0x47b081[_0x544f7c][_0x167802(0x105)]=_0x653b82;}),_0x5313fa[_0x84ce04(0x181)]((_0x37c906,_0x429351)=>{_0x47b081[_0x429351]['product_code']=_0x37c906;}),_0x1476b2[_0x84ce04(0x181)]((_0x96ceb3,_0x1cdf17)=>{var _0x3df206=_0x84ce04;_0x47b081[_0x1cdf17][_0x3df206(0x22e)]=_0x96ceb3;}),_0x5eb630[_0x84ce04(0x181)]((_0x17f3b2,_0x2691d3)=>{var _0x567a17=_0x84ce04;_0x47b081[_0x2691d3][_0x567a17(0x14d)]=Math[_0x567a17(0x1fc)](_0x17f3b2);}),_0x143e1f[_0x84ce04(0x181)]((_0x3dca68,_0x2e0397)=>{_0x47b081[_0x2e0397]['standard_unit']=_0x3dca68;}),_0x5e22d9[_0x84ce04(0x181)]((_0x85b06,_0x1957cc)=>{var _0x2b2311=_0x84ce04;_0x47b081[_0x1957cc][_0x2b2311(0x16e)]=_0x85b06;}),_0x3ad97d['forEach']((_0x3455d4,_0x311849)=>{var _0x30b911=_0x84ce04;_0x47b081[_0x311849][_0x30b911(0x17f)]=_0x3455d4;}),_0x435b07[_0x84ce04(0x181)]((_0x252839,_0x17587d)=>{var _0x3f1b0b=_0x84ce04;_0x47b081[_0x17587d][_0x3f1b0b(0x18e)]=_0x252839;}),_0x21b989[_0x84ce04(0x181)]((_0x5d4e9c,_0x26ba81)=>{var _0x37b730=_0x84ce04;_0x47b081[_0x26ba81][_0x37b730(0x1b4)]=_0x5d4e9c;}),_0x21765b[_0x84ce04(0x181)]((_0x94f1f7,_0x13735a)=>{var _0x3823c2=_0x84ce04;_0x47b081[_0x13735a][_0x3823c2(0x1e3)]=_0x94f1f7;}),_0x5b6173[_0x84ce04(0x181)]((_0x4033b0,_0x143d16)=>{var _0x4d59a2=_0x84ce04;_0x47b081[_0x143d16][_0x4d59a2(0x179)]=_0x4033b0;}),_0x1cb542[_0x84ce04(0x181)]((_0x568e50,_0x3fd90d)=>{var _0x14517e=_0x84ce04;_0x47b081[_0x3fd90d][_0x14517e(0x1ea)]=_0x568e50;}),_0x13f3a9[_0x84ce04(0x181)]((_0x152917,_0x1160b0)=>{var _0x222ef4=_0x84ce04;_0x47b081[_0x1160b0][_0x222ef4(0x154)]=_0x152917;}),_0x2140ac['forEach']((_0x50f82b,_0x5b0408)=>{var _0x17d06d=_0x84ce04;_0x47b081[_0x5b0408][_0x17d06d(0x1ba)]=_0x50f82b;}),_0x12c2fe[_0x84ce04(0x181)]((_0x1dd654,_0x264ada)=>{var _0x547e41=_0x84ce04;_0x47b081[_0x264ada][_0x547e41(0x1e6)]=_0x1dd654;}),_0x5dde79['forEach']((_0x1b622f,_0x5276c8)=>{var _0x98074e=_0x84ce04;_0x47b081[_0x5276c8][_0x98074e(0x1b5)]=_0x1b622f;});const _0x2b6c23=new invoice_for_incoming();await _0x2b6c23[_0x84ce04(0x166)]();for(let _0x5cbcf3=0x0;_0x5cbcf3<=_0x12c2fe['length']-0x1;_0x5cbcf3++){_0x47b081[_0x5cbcf3][_0x84ce04(0x228)]=_0x84ce04(0x1d6)+_0x2b6c23['invoice_init'][_0x84ce04(0x1e1)]()[_0x84ce04(0x120)](0x8,'0');}const _0x2109b=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x14a67a}}]);let _0x43704d=[];for(let _0x2c1fb7=0x0;_0x2c1fb7<=_0x47b081[_0x84ce04(0x1fa)]-0x1;_0x2c1fb7++){const _0x20ebbb=_0x47b081[_0x2c1fb7];for(let _0x2f0d38=0x0;_0x2f0d38<=_0x2109b[_0x84ce04(0x1fa)]-0x1;_0x2f0d38++){const _0x5af930=_0x2109b[_0x2f0d38];for(let _0x1862eb=0x0;_0x1862eb<=_0x5af930[_0x84ce04(0x202)][_0x84ce04(0x1fa)]-0x1;_0x1862eb++){const _0x47e897=_0x5af930[_0x84ce04(0x202)][_0x1862eb];if(_0x47e897[_0x84ce04(0x16d)]===_0x20ebbb['product_code']){let _0x54aae4=_0x20ebbb['quantity'];const _0x9caf98=await warehouse[_0x84ce04(0x183)]([{'$match':{'name':_0x14a67a,'room':_0x5af930[_0x84ce04(0x213)]}},{'$unwind':_0x84ce04(0x141)},{'$match':{'level':_0x47e897['bay'],'bay':_0x47e897[_0x84ce04(0x13d)]}}]);if(_0x9caf98[_0x84ce04(0x1fa)]==0x0){for(let _0x4d8796=0x0;_0x4d8796<=_0x5af930[_0x84ce04(0x202)][_0x84ce04(0x1fa)]-0x1&&_0x54aae4>0x0;_0x4d8796++){const _0x785fea=_0x5af930['product_data'][_0x4d8796];if(_0x20ebbb['product_code']===_0x785fea[_0x84ce04(0x16d)]){_0x43704d[_0x4d8796]={};const _0x3ed2f2=parseInt(_0x785fea[_0x84ce04(0x1c5)]),_0x2b63e0=0x0;let _0x4414dd=_0x3ed2f2-_0x2b63e0,_0x6ce16d=Math[_0x84ce04(0x12a)](_0x54aae4,_0x4414dd);console[_0x84ce04(0x10e)]('Distributing\x20'+_0x6ce16d+_0x84ce04(0x231)+_0x5af930[_0x84ce04(0x229)]+_0x84ce04(0x15c)+_0x5af930[_0x84ce04(0x213)]+_0x84ce04(0x208)+_0x785fea[_0x84ce04(0xfa)]+_0x84ce04(0xf8)+_0x785fea[_0x84ce04(0x13d)]),_0x43704d[_0x4d8796][_0x84ce04(0x1c7)]=_0x20ebbb['product_name'],_0x43704d[_0x4d8796]['product_code']=_0x20ebbb['product_code'],_0x43704d[_0x4d8796]['product_id']=_0x20ebbb[_0x84ce04(0x21e)],_0x43704d[_0x4d8796][_0x84ce04(0x107)]=_0x20ebbb[_0x84ce04(0x107)],_0x43704d[_0x4d8796][_0x84ce04(0x105)]=_0x20ebbb[_0x84ce04(0x105)],_0x43704d[_0x4d8796]['uuid']=_0x20ebbb[_0x84ce04(0x22e)],_0x43704d[_0x4d8796][_0x84ce04(0x14d)]=_0x6ce16d,_0x43704d[_0x4d8796][_0x84ce04(0x1bf)]=_0x20ebbb[_0x84ce04(0x1bf)],_0x43704d[_0x4d8796][_0x84ce04(0x16e)]=_0x20ebbb['secondary_unit'],_0x43704d[_0x4d8796][_0x84ce04(0x17f)]=_0x20ebbb['primary_code'],_0x43704d[_0x4d8796][_0x84ce04(0x18e)]=_0x20ebbb[_0x84ce04(0x18e)],_0x43704d[_0x4d8796][_0x84ce04(0x1b4)]=_0x20ebbb['maxStocks'],_0x43704d[_0x4d8796][_0x84ce04(0x1e3)]=_0x20ebbb[_0x84ce04(0x1e3)],_0x43704d[_0x4d8796][_0x84ce04(0x179)]=_0x20ebbb['expiry_date'],_0x43704d[_0x4d8796]['production_date']=_0x20ebbb[_0x84ce04(0x1ea)],_0x43704d[_0x4d8796][_0x84ce04(0x154)]=_0x20ebbb['maxperunit'],_0x43704d[_0x4d8796][_0x84ce04(0x1ba)]=_0x20ebbb['product_cat'],_0x43704d[_0x4d8796]['invoice']=_0x20ebbb['invoice'],_0x43704d[_0x4d8796][_0x84ce04(0x1b5)]=_0x20ebbb[_0x84ce04(0x1b5)],_0x43704d[_0x4d8796][_0x84ce04(0x1e6)]=_0x5af930['room'],_0x43704d[_0x4d8796]['level']=_0x785fea[_0x84ce04(0xfa)],_0x43704d[_0x4d8796][_0x84ce04(0xfa)]=_0x785fea['bin'],_0x54aae4-=_0x6ce16d;if(_0x54aae4<=0x0)break;}}if(_0x54aae4<=0x0)break;_0x54aae4>0x0&&console[_0x84ce04(0x10e)](_0x84ce04(0x19e)+_0x54aae4+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.');}}}}}const _0x597aab=_0x43704d[_0x84ce04(0x194)]((_0x5a439e,_0x30b7c4)=>{if(_0x30b7c4>0x0)return{'item':_0x5a439e};}),_0x2cb8c1=_0x597aab[_0x84ce04(0x194)](_0x2c5786=>_0x2c5786[_0x84ce04(0x14d)]!=='0'&&_0x2c5786[_0x84ce04(0x14d)]!==''),_0x585ea9=new purchases_finished({'invoice':_0x84ce04(0x1d6)+_0x2b6c23[_0x84ce04(0x1d5)]['toString']()[_0x84ce04(0x120)](0x8,'0'),'suppliers':_0x4a8481,'date':_0x4f0d62,'warehouse_name':_0x14a67a,'product':_0x2cb8c1,'note':_0x3e9c2e,'due_amount':_0x112c50,'room':_0x464288,'POnumber':_0x2832eb,'SCRN':_0x51f376,'JO_number':_0x2d5bcf,'ReqBy':_0x153c5d,'dateofreq':_0x53d339,'typeservicesData':_0x33b366,'van':_0xe37640,'typevehicle':_0x5b113a,'driver':_0x2e6668,'plate':_0x24f739,'DRSI':_0x426a07,'TSU':_0x33ced5,'TFU':_0x57f7b2,'typeOfProducts':_0xf14bf0}),_0x2cb8ff=await _0x585ea9[_0x84ce04(0x166)](),_0x2900ad=await purchases_finished[_0x84ce04(0x199)]({'_id':_0x2cb8ff[_0x84ce04(0x1ac)][_0x84ce04(0x177)]()});_0xcf7ec4['flash'](_0x84ce04(0x195),'purchase\x20data\x20add\x20successfully'),_0x76831b[_0x84ce04(0x218)]('/all_purchases_finished/process/'+_0x2900ad[_0x84ce04(0x1ac)][_0x84ce04(0x177)]());}catch(_0x4b05bd){console['log'](_0x4b05bd);}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x1e9),auth,async(_0x1ef294,_0x21ebf9)=>{var _0x10d918=a0_0x243e5b;try{const {username:_0x1a17ef,email:_0x365088,role:_0x2bd0b4}=_0x1ef294['user'],_0x318f3c=_0x1ef294[_0x10d918(0x1ce)],_0x56b32e=_0x1ef294['params']['id'],_0x48bae3=await profile[_0x10d918(0x199)]({'email':_0x318f3c[_0x10d918(0x1bd)]}),_0x4a1c6e=await master_shop[_0x10d918(0x1c4)](),_0x57b500=await staff[_0x10d918(0x199)]({'email':_0x318f3c[_0x10d918(0x1bd)]}),_0x18a168=await suppliers[_0x10d918(0x1c4)]({});let _0x3fea3c;if(_0x318f3c[_0x10d918(0xf7)]==_0x10d918(0x165)){const _0x46ba32=await staff[_0x10d918(0x199)]({'email':_0x318f3c['email']});_0x3fea3c=await warehouse[_0x10d918(0x183)]([{'$match':{'status':_0x10d918(0x1bc),'name':_0x46ba32[_0x10d918(0x17d)]}},{'$group':{'_id':_0x10d918(0x217),'name':{'$first':_0x10d918(0x217)}}}]);}else _0x3fea3c=await warehouse['aggregate']([{'$match':{'status':_0x10d918(0x1bc)}},{'$group':{'_id':_0x10d918(0x217),'name':{'$first':_0x10d918(0x217)}}}]);const _0x324f26=await purchases_finished[_0x10d918(0x18a)](_0x56b32e);if(_0x4a1c6e[0x0][_0x10d918(0x20e)]=='English\x20(US)')var _0xc0b944=users[_0x10d918(0x190)];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]=='Hindi')var _0xc0b944=users[_0x10d918(0x15a)];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]==_0x10d918(0x12e))var _0xc0b944=users[_0x10d918(0x12e)];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]=='Spanish')var _0xc0b944=users[_0x10d918(0x15e)];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]==_0x10d918(0x16a))var _0xc0b944=users[_0x10d918(0x16a)];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]==_0x10d918(0x148))var _0xc0b944=users['Portuguese'];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]==_0x10d918(0x1c3))var _0xc0b944=users['Chinese'];else{if(_0x4a1c6e[0x0][_0x10d918(0x20e)]==_0x10d918(0x186))var _0xc0b944=users['Arabic'];}}}}}}}_0x21ebf9[_0x10d918(0x18f)](_0x10d918(0x11e),{'success':_0x1ef294[_0x10d918(0x13a)]('success'),'errors':_0x1ef294[_0x10d918(0x13a)](_0x10d918(0x126)),'role':_0x318f3c,'profile':_0x48bae3,'suppliers':_0x18a168,'warehouse':_0x3fea3c,'master_shop':_0x4a1c6e,'language':_0xc0b944,'purchases_data':_0x324f26});}catch(_0x18bb34){console[_0x10d918(0x10e)](_0x18bb34);}});async function get_warehouse_data(_0x519b9c,_0x20f237){var _0x2081d9=a0_0x243e5b;try{const _0x13f6a2=await warehouse_temporary[_0x2081d9(0x199)]({'name':_0x519b9c,'room':_0x20f237});if(!_0x13f6a2){const _0x19fd03=new warehouse_temporary({'name':_0x519b9c,'address':_0x519b9c,'status':_0x2081d9(0x1bc),'room':_0x20f237,'isStaging':_0x2081d9(0x1f5)});return await _0x19fd03['save'](),_0x19fd03;}else return _0x13f6a2;}catch(_0x33da81){console[_0x2081d9(0xff)]('Error\x20fetching\x20or\x20saving\x20warehouse\x20data:',_0x33da81);throw _0x33da81;}}router[a0_0x243e5b(0x17a)](a0_0x243e5b(0x1e9),auth,async(_0x3c2ec6,_0x17e879)=>{var _0x5b340f=a0_0x243e5b;try{const _0x1f5f74=_0x3c2ec6[_0x5b340f(0x11f)]['id'],_0x170376=await purchases_finished[_0x5b340f(0x18a)](_0x1f5f74);let _0x51af7f=[];_0x170376[_0x5b340f(0x116)][_0x5b340f(0x181)]((_0x361e14,_0x47ed1a)=>{var _0xe9f2b9=_0x5b340f;_0x51af7f[_0x47ed1a]={},_0x51af7f[_0x47ed1a][_0xe9f2b9(0x17d)]=_0x170376[_0xe9f2b9(0x229)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x21e)]=_0x361e14['product_id'],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x1c7)]=_0x361e14['product_name'],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x16d)]=_0x361e14[_0xe9f2b9(0x16d)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x14d)]=_0x361e14[_0xe9f2b9(0x14d)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x1bf)]=_0x361e14[_0xe9f2b9(0x1bf)],_0x51af7f[_0x47ed1a]['secondary_unit']=_0x361e14[_0xe9f2b9(0x16e)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x1a2)]=_0x361e14[_0xe9f2b9(0x1a2)],_0x51af7f[_0x47ed1a]['bay']=_0x361e14[_0xe9f2b9(0xfa)],_0x51af7f[_0x47ed1a]['primary_code']=_0x361e14[_0xe9f2b9(0x17f)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x18e)]=_0x361e14['secondary_code'],_0x51af7f[_0x47ed1a]['maxStocks']=_0x361e14[_0xe9f2b9(0x1b4)],_0x51af7f[_0x47ed1a]['batch_code']=_0x361e14[_0xe9f2b9(0x1e3)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x179)]=_0x361e14[_0xe9f2b9(0x179)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x1ea)]=_0x361e14[_0xe9f2b9(0x1ea)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x154)]=_0x361e14[_0xe9f2b9(0x154)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x1ba)]=_0x361e14[_0xe9f2b9(0x1ba)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x1e6)]=_0x361e14[_0xe9f2b9(0x1e6)],_0x51af7f[_0x47ed1a]['invoice']=_0x361e14[_0xe9f2b9(0x228)],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x22e)]=_0x361e14[_0xe9f2b9(0x22e)],_0x51af7f[_0x47ed1a]['gross_price']=_0x361e14[_0xe9f2b9(0x1b5)],_0x51af7f[_0x47ed1a]['sales_category']=_0x361e14['sales_category'],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x107)]=_0x361e14['date_recieved'],_0x51af7f[_0x47ed1a][_0xe9f2b9(0x111)]=_0x361e14[_0xe9f2b9(0x1ac)][_0xe9f2b9(0x177)]();});for(let _0x59ea7b=0x0;_0x59ea7b<=_0x51af7f[_0x5b340f(0x1fa)]-0x1;_0x59ea7b++){const _0x1bc523=_0x51af7f[_0x59ea7b],_0x5c7887=new warehouse_temporary(_0x1bc523);await _0x5c7887[_0x5b340f(0x166)]();}_0x170376['isProcess']='true',await _0x170376['save'](),_0x3c2ec6[_0x5b340f(0x13a)](_0x5b340f(0x195),_0x5b340f(0x101)),_0x17e879[_0x5b340f(0x218)](_0x5b340f(0x104)+_0x170376[_0x5b340f(0x1ac)][_0x5b340f(0x177)]());}catch(_0x1a906e){}}),router[a0_0x243e5b(0x17a)]('/view/add_purchases_logs',auth,async(_0x23079e,_0x3df657)=>{var _0x5cd707=a0_0x243e5b;try{const {invoice:_0x12bd7b,date:_0x1b204a,warehouse_name:_0x581651,prod_name:_0x1a3550,note:_0x13cdc2,due_amount:_0x35edcd,Room_name:_0x42865f,PO_number:_0x47c989,SCRN:_0xc28614,ReqBy:_0x456557,dateofreq:_0x201fa8,suppliers:_0x550cb0,typeservicesData:_0x5a815d,van:_0x2c1489,typevehicle:_0x384aec,driver:_0x39f608,plate:_0x224410,DRSI:_0x289fd7,TSU:_0x473245,TFU:_0x26408f,JO_number:_0x5489e6,type_of_products:_0x3eaa9e}=_0x23079e[_0x5cd707(0x184)];if(typeof _0x1a3550==_0x5cd707(0x1b8))var _0x2d9f3e=[_0x23079e['body'][_0x5cd707(0x18c)]],_0x14a32a=[_0x23079e[_0x5cd707(0x184)]['prod_code']],_0x1788f8=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x164)]],_0x39b79f=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x1f0)]],_0x58e9de=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x174)]],_0x67787=[_0x23079e[_0x5cd707(0x184)]['prod_level']],_0x2c4361=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x17f)]],_0x71b609=[_0x23079e['body'][_0x5cd707(0x18e)]],_0x2889ce=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x20c)]],_0x53cb4e=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x1e3)]],_0x3794da=[_0x23079e[_0x5cd707(0x184)]['expiry_date']],_0xc0cd16=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x17b)]],_0x2bd20d=[_0x23079e[_0x5cd707(0x184)]['max_product_unit']],_0x539844=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0x1b7)]],_0x531fdd=[_0x23079e[_0x5cd707(0x184)][_0x5cd707(0xfc)]],_0x29a4fd=[_0x23079e['body'][_0x5cd707(0x1b5)]],_0x196544=[_0x23079e[_0x5cd707(0x184)]['uuid']],_0x49a838=[_0x23079e[_0x5cd707(0x184)]['sales_data_cateory']],_0x377e85=[_0x23079e['body']['type_of_products_type']];else var _0x2d9f3e=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x18c)]],_0x14a32a=[..._0x23079e['body'][_0x5cd707(0x123)]],_0x1788f8=[..._0x23079e[_0x5cd707(0x184)]['prod_Qty']],_0x39b79f=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x1f0)]],_0x58e9de=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x174)]],_0x67787=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x1f8)]],_0x2c4361=[..._0x23079e[_0x5cd707(0x184)]['primary_code']],_0x71b609=[..._0x23079e['body'][_0x5cd707(0x18e)]],_0x2889ce=[..._0x23079e[_0x5cd707(0x184)]['MaxStocks_data']],_0x53cb4e=[..._0x23079e[_0x5cd707(0x184)]['batch_code']],_0x3794da=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x179)]],_0xc0cd16=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x17b)]],_0x2bd20d=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x117)]],_0x539844=[..._0x23079e['body'][_0x5cd707(0x1b7)]],_0x531fdd=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0xfc)]],_0x29a4fd=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x1b5)]],_0x196544=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x22e)]],_0x49a838=[..._0x23079e['body']['sales_data_cateory']],_0x377e85=[..._0x23079e[_0x5cd707(0x184)][_0x5cd707(0x224)]];const _0x9e74e2=_0x2d9f3e[_0x5cd707(0x16b)](_0x3c0a27=>{return _0x3c0a27={'product_name':_0x3c0a27};});_0x377e85[_0x5cd707(0x181)]((_0x555f62,_0x3d280c)=>{var _0x4f35c4=_0x5cd707;_0x9e74e2[_0x3d280c][_0x4f35c4(0x163)]=_0x555f62;}),_0x49a838[_0x5cd707(0x181)]((_0x297cf1,_0x363911)=>{_0x9e74e2[_0x363911]['sales_category']=_0x297cf1;}),_0x14a32a[_0x5cd707(0x181)]((_0x3130aa,_0x3e6084)=>{var _0x312a4=_0x5cd707;_0x9e74e2[_0x3e6084][_0x312a4(0x16d)]=_0x3130aa;}),_0x196544[_0x5cd707(0x181)]((_0x372dee,_0x41ded7)=>{var _0x239001=_0x5cd707;_0x9e74e2[_0x41ded7][_0x239001(0x22e)]=_0x372dee;}),_0x1788f8[_0x5cd707(0x181)]((_0x3859b1,_0x4f8c3c)=>{var _0x51a89c=_0x5cd707;_0x9e74e2[_0x4f8c3c][_0x51a89c(0x14d)]=Math[_0x51a89c(0x1fc)](_0x3859b1);}),_0x39b79f[_0x5cd707(0x181)]((_0x115d5b,_0x1a08d4)=>{var _0x1741ea=_0x5cd707;_0x9e74e2[_0x1a08d4][_0x1741ea(0x1bf)]=_0x115d5b;}),_0x58e9de[_0x5cd707(0x181)]((_0x1f1950,_0x48bd89)=>{var _0x769e28=_0x5cd707;_0x9e74e2[_0x48bd89][_0x769e28(0x16e)]=_0x1f1950;}),_0x67787[_0x5cd707(0x181)]((_0x3fc328,_0x385eba)=>{var _0xf46f30=_0x5cd707,_0x5a6cc0=_0x3fc328[_0xf46f30(0x146)](/[A-Za-z]+/)[0x0],_0x14b223=parseInt(_0x3fc328[_0xf46f30(0x146)](/\d+/)[0x0]);_0x9e74e2[_0x385eba][_0xf46f30(0x1a2)]=_0x5a6cc0,_0x9e74e2[_0x385eba][_0xf46f30(0xfa)]=_0x14b223;}),_0x2c4361[_0x5cd707(0x181)]((_0x2f0a79,_0x58c39f)=>{_0x9e74e2[_0x58c39f]['primary_code']=_0x2f0a79;}),_0x71b609[_0x5cd707(0x181)]((_0x25e8d2,_0xcfbd42)=>{var _0x1331f7=_0x5cd707;_0x9e74e2[_0xcfbd42][_0x1331f7(0x18e)]=_0x25e8d2;}),_0x2889ce[_0x5cd707(0x181)]((_0x2bc446,_0x5213aa)=>{var _0x1b20f2=_0x5cd707;_0x9e74e2[_0x5213aa][_0x1b20f2(0x1b4)]=_0x2bc446;}),_0x53cb4e[_0x5cd707(0x181)]((_0x16227f,_0x335690)=>{var _0x3f8c5f=_0x5cd707;_0x9e74e2[_0x335690][_0x3f8c5f(0x1e3)]=_0x16227f;}),_0x3794da[_0x5cd707(0x181)]((_0x80119,_0x5ef73d)=>{_0x9e74e2[_0x5ef73d]['expiry_date']=_0x80119;}),_0xc0cd16[_0x5cd707(0x181)]((_0x391045,_0x12a613)=>{var _0xe6667=_0x5cd707;_0x9e74e2[_0x12a613][_0xe6667(0x1ea)]=_0x391045;}),_0x2bd20d[_0x5cd707(0x181)]((_0x339ea7,_0x466db6)=>{var _0x115078=_0x5cd707;_0x9e74e2[_0x466db6][_0x115078(0x154)]=_0x339ea7;}),_0x539844[_0x5cd707(0x181)]((_0x1ba54f,_0x23c008)=>{var _0x1d1ab7=_0x5cd707;_0x9e74e2[_0x23c008][_0x1d1ab7(0x1ba)]=_0x1ba54f;}),_0x531fdd[_0x5cd707(0x181)]((_0x3b0adb,_0x586299)=>{var _0x536cf1=_0x5cd707;_0x9e74e2[_0x586299][_0x536cf1(0x1e6)]=_0x3b0adb;}),_0x29a4fd['forEach']((_0x191f53,_0x5d380f)=>{var _0x501a21=_0x5cd707;_0x9e74e2[_0x5d380f][_0x501a21(0x1b5)]=_0x191f53;});const _0x56dfb4=new purchases_logs();await _0x56dfb4[_0x5cd707(0x166)]();for(let _0xd6bcbd=0x0;_0xd6bcbd<=_0x531fdd[_0x5cd707(0x1fa)]-0x1;_0xd6bcbd++){_0x9e74e2[_0xd6bcbd][_0x5cd707(0x228)]=_0x5cd707(0x151)+_0x56dfb4[_0x5cd707(0x1d5)]['toString']()[_0x5cd707(0x120)](0x8,'0');}const _0x154476=_0x9e74e2['filter'](_0x1b43a8=>_0x1b43a8[_0x5cd707(0x14d)]!=='0'&&_0x1b43a8[_0x5cd707(0x14d)]!==''),_0x2061c0=new purchases_finished({'invoice':'LOG-INC-'+_0x56dfb4[_0x5cd707(0x1d5)]['toString']()[_0x5cd707(0x120)](0x8,'0'),'suppliers':_0x550cb0,'date':_0x1b204a,'warehouse_name':_0x581651,'product':_0x154476,'note':_0x13cdc2,'due_amount':_0x35edcd,'room':_0x42865f,'POnumber':_0x47c989,'SCRN':_0xc28614,'JO_number':_0x5489e6,'ReqBy':_0x456557,'dateofreq':_0x201fa8,'typeservicesData':_0x5a815d,'van':_0x2c1489,'typevehicle':_0x384aec,'driver':_0x39f608,'plate':_0x224410,'DRSI':_0x289fd7,'TSU':_0x473245,'TFU':_0x26408f,'typeOfProducts':_0x3eaa9e}),_0x210449=await _0x2061c0[_0x5cd707(0x166)](),_0x5c5092=await purchases_finished[_0x5cd707(0x199)]({'_id':_0x210449[_0x5cd707(0x1ac)]['valueOf']()}),_0x899a7e=_0x5c5092[_0x5cd707(0x116)][_0x5cd707(0x16b)](async _0x196802=>{var _0x33d83b=_0x5cd707;try{var _0x51ab4a=await warehouse[_0x33d83b(0x199)]({'name':_0x581651,'room':_0x196802['room_name']}),_0x12e19e=0x0;const _0x2e6682=_0x51ab4a[_0x33d83b(0x22f)][_0x33d83b(0x16b)](_0x21ca95=>{var _0x5120b3=_0x33d83b;console[_0x5120b3(0x10e)](_0x21ca95['product_name']+'=='+_0x196802[_0x5120b3(0x1c7)]+'&&'+_0x21ca95['bay']+'=='+_0x196802['bay']+'&&'+_0x21ca95['expiry_date']+'=='+_0x196802[_0x5120b3(0x179)]+'&&'+_0x21ca95[_0x5120b3(0x1ea)]+'=='+_0x196802[_0x5120b3(0x1ea)]+'&&'+_0x21ca95[_0x5120b3(0x1e3)]+'=='+_0x196802[_0x5120b3(0x1e3)]+'&&'+_0x21ca95['invoice']+'=='+_0x5c5092[_0x5120b3(0x228)]),_0x21ca95[_0x5120b3(0x1c7)]==_0x196802[_0x5120b3(0x1c7)]&&_0x21ca95['bay']==_0x196802[_0x5120b3(0xfa)]&&_0x21ca95[_0x5120b3(0x1a2)]==_0x196802[_0x5120b3(0x1a2)]&&_0x21ca95[_0x5120b3(0x179)]==_0x196802[_0x5120b3(0x179)]&&_0x21ca95[_0x5120b3(0x1ea)]==_0x196802[_0x5120b3(0x1ea)]&&_0x21ca95['batch_code']==_0x196802[_0x5120b3(0x1e3)]&&_0x21ca95[_0x5120b3(0x228)]==_0x5c5092[_0x5120b3(0x228)]&&(_0x21ca95[_0x5120b3(0x124)]=Math[_0x5120b3(0x1fc)](_0x21ca95[_0x5120b3(0x124)])+Math['abs'](_0x196802[_0x5120b3(0x14d)]),_0x12e19e++);});return _0x12e19e==0x0&&(_0x51ab4a[_0x33d83b(0x22f)]=_0x51ab4a['product_details']['concat']({'product_name':_0x196802[_0x33d83b(0x1c7)],'product_stock':Math['abs'](_0x196802[_0x33d83b(0x14d)]),'primary_code':_0x196802['primary_code'],'secondary_code':_0x196802[_0x33d83b(0x18e)],'product_code':_0x196802[_0x33d83b(0x16d)],'bay':_0x196802['bay'],'level':_0x196802[_0x33d83b(0x1a2)],'maxProducts':_0x196802[_0x33d83b(0x1b4)],'unit':_0x196802[_0x33d83b(0x1bf)],'secondary_unit':_0x196802['secondary_unit'],'expiry_date':_0x196802[_0x33d83b(0x179)],'production_date':_0x196802[_0x33d83b(0x1ea)],'maxProducts':_0x196802[_0x33d83b(0x1b4)],'maxPerUnit':_0x196802['maxperunit'],'batch_code':_0x196802['batch_code'],'product_cat':_0x196802[_0x33d83b(0x1ba)],'invoice':_0x196802[_0x33d83b(0x228)],'id_incoming':_0x196802[_0x33d83b(0x1ac)],'uuid':_0x196802['uuid'],'gross_price':_0x196802[_0x33d83b(0x1b5)],'sales_category':_0x196802[_0x33d83b(0x105)],'type_products':_0x196802[_0x33d83b(0x163)]})),_0x51ab4a;}catch(_0x17c983){return console[_0x33d83b(0xff)](_0x33d83b(0x175),_0x17c983),null;}});Promise['all'](_0x899a7e)[_0x5cd707(0x121)](async _0x3538af=>{var _0x1a78fd=_0x5cd707;try{for(const _0x27a51e of _0x3538af){await warehouse[_0x1a78fd(0x110)]({'_id':_0x27a51e[_0x1a78fd(0x1ac)]},{'$addToSet':{'product_details':{'$each':_0x27a51e[_0x1a78fd(0x22f)]}}});}const _0x22911c=await master_shop[_0x1a78fd(0x1c4)](),_0x532e99=await email_settings[_0x1a78fd(0x199)](),_0x310618=await supervisor_settings['find']();var _0x54a2b5=_0x5c5092['product'],_0x377e2a='',_0x39b0e7;for(_0x39b0e7 in _0x54a2b5){var _0x2fd345='FG';_0x5c5092[_0x1a78fd(0x229)]==_0x1a78fd(0x1d4)&&(_0x2fd345='DG'),_0x377e2a+=_0x1a78fd(0x1b1)+_0x1a78fd(0x1ee)+_0x54a2b5[_0x39b0e7][_0x1a78fd(0x1c7)]+_0x1a78fd(0x18d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54a2b5[_0x39b0e7][_0x1a78fd(0x16d)]+_0x1a78fd(0x18d)+_0x1a78fd(0x1ee)+_0x54a2b5[_0x39b0e7][_0x1a78fd(0x14d)]+_0x1a78fd(0x18d)+_0x1a78fd(0x1ee)+_0x54a2b5[_0x39b0e7]['standard_unit']+_0x1a78fd(0x18d)+_0x1a78fd(0x1ee)+_0x54a2b5[_0x39b0e7][_0x1a78fd(0x16e)]+_0x1a78fd(0x18d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c5092[_0x1a78fd(0x229)]+'</td>'+_0x1a78fd(0x1ee)+_0x54a2b5[_0x39b0e7][_0x1a78fd(0x1e6)]+_0x1a78fd(0x18d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2fd345+_0x54a2b5[_0x39b0e7][_0x1a78fd(0xfa)]+'</td>','</tr>';}let _0x2b61e3=nodemailer[_0x1a78fd(0x1b9)]({'host':_0x532e99[_0x1a78fd(0x100)],'port':Number(_0x532e99[_0x1a78fd(0x14b)]),'secure':![],'auth':{'user':_0x532e99[_0x1a78fd(0x1bd)],'pass':_0x532e99[_0x1a78fd(0x157)]}}),_0x1e9df5={'from':_0x532e99['email'],'to':_0x310618[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x1a78fd(0x211),'path':__dirname+_0x1a78fd(0x1a4)+_0x1a78fd(0x216)+_0x22911c[0x0]['image'],'cid':_0x1a78fd(0x1f4)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1a78fd(0x220)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x1a78fd(0x1c0)+_0x1a78fd(0x1df)+'<div>'+_0x1a78fd(0x1d8)+_0x22911c[0x0]['site_title']+_0x1a78fd(0x1e7)+_0x1a78fd(0x1df)+'</div>'+_0x1a78fd(0x136)+_0x1a78fd(0x193)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1a78fd(0x22a)+_0x5c5092['invoice']+'\x20'+_0x1a78fd(0x1c9)+_0x1a78fd(0x161)+_0x5c5092[_0x1a78fd(0x14c)]+'\x20'+'</span>'+_0x1a78fd(0x16c)+_0x1a78fd(0x1df)+_0x1a78fd(0x13c)+_0x1a78fd(0x119)+_0x1a78fd(0x1b1)+_0x1a78fd(0x1a5)+_0x1a78fd(0xfb)+_0x1a78fd(0x1dd)+_0x1a78fd(0x226)+_0x1a78fd(0x1b6)+_0x1a78fd(0x140)+_0x1a78fd(0x14f)+_0x1a78fd(0x1a7)+_0x1a78fd(0x132)+_0x1a78fd(0xfd)+_0x1a78fd(0x235)+'\x20'+_0x377e2a+'\x20'+_0x1a78fd(0x20d)+_0x1a78fd(0x11b)+_0x1a78fd(0x193)+_0x1a78fd(0x21b)+_0x1a78fd(0x128)+_0x22911c[0x0][_0x1a78fd(0x236)]+_0x1a78fd(0x16c)+_0x1a78fd(0x1df)+_0x1a78fd(0x1df)+_0x1a78fd(0x1de)};_0x2b61e3[_0x1a78fd(0x10b)](_0x1e9df5,function(_0x787241,_0x48926d){var _0x435105=_0x1a78fd;_0x787241?(console[_0x435105(0x10e)](_0x787241),console[_0x435105(0x10e)]('Error\x20Occurs')):console[_0x435105(0x10e)](_0x435105(0x162));});}catch(_0x54bca2){console[_0x1a78fd(0xff)](_0x54bca2),_0x3df657['status'](0x1f4)[_0x1a78fd(0x142)]({'error':_0x1a78fd(0x1a9),'message':_0x54bca2['message']});}})['catch'](_0x293643=>{var _0x1a9c12=_0x5cd707;console[_0x1a9c12(0xff)](_0x293643);}),_0x23079e[_0x5cd707(0x13a)](_0x5cd707(0x195),_0x5cd707(0x20a)),_0x3df657[_0x5cd707(0x218)]('/all_purchases_finished/preview/'+_0x5c5092[_0x5cd707(0x1ac)][_0x5cd707(0x177)]());}catch(_0x427a6a){console[_0x5cd707(0x10e)](_0x427a6a);}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x230),auth,async(_0x260bdd,_0x220d6e)=>{var _0xd083ff=a0_0x243e5b;try{const {username:_0x1433a1,email:_0x9291a9,role:_0x1cf134}=_0x260bdd[_0xd083ff(0x1ce)],_0x2a61dc=_0x260bdd['user'],_0x41d2c5=await profile['findOne']({'email':_0x2a61dc[_0xd083ff(0x1bd)]}),_0x37e72b=await master_shop[_0xd083ff(0x1c4)](),_0x57cc79=_0x260bdd[_0xd083ff(0x11f)]['id'],_0x55c0a0=await purchases_finished[_0xd083ff(0x18a)](_0x57cc79),_0x417b13=await suppliers[_0xd083ff(0x1c4)]({});let _0x29816d;if(_0x2a61dc['role']=='staff'){const _0x5a9f24=await staff[_0xd083ff(0x199)]({'email':_0x2a61dc[_0xd083ff(0x1bd)]});_0x29816d=await warehouse[_0xd083ff(0x1c4)]({'status':_0xd083ff(0x1bc),'name':_0x5a9f24[_0xd083ff(0x17d)],'warehouse_category':'Finished\x20Goods'});}else _0x29816d=await warehouse['aggregate']([{'$match':{'status':_0xd083ff(0x1bc),'warehouse_category':_0xd083ff(0x10d)}},{'$group':{'_id':'$name','name':{'$first':_0xd083ff(0x217)}}}]);const _0x203b45=await product[_0xd083ff(0x1c4)]({}),_0x293061=BayBinSelected(_0x55c0a0['warehouse_name'],_0x55c0a0[_0xd083ff(0x213)]);let _0x5abccf=new Date(_0x55c0a0[_0xd083ff(0x179)]),_0x1bc1bd=('0'+_0x5abccf[_0xd083ff(0x215)]())[_0xd083ff(0x1ef)](-0x2),_0x10325b=('0'+(_0x5abccf[_0xd083ff(0x17c)]()+0x1))[_0xd083ff(0x1ef)](-0x2),_0x33d822=_0x5abccf[_0xd083ff(0x185)](),_0x386cea=_0x33d822+'-'+_0x10325b+'-'+_0x1bc1bd;if(_0x37e72b[0x0][_0xd083ff(0x20e)]==_0xd083ff(0x1e8)){var _0x3efe70=users['English'];console[_0xd083ff(0x10e)](_0x3efe70);}else{if(_0x37e72b[0x0]['language']=='Hindi')var _0x3efe70=users[_0xd083ff(0x15a)];else{if(_0x37e72b[0x0][_0xd083ff(0x20e)]==_0xd083ff(0x12e))var _0x3efe70=users[_0xd083ff(0x12e)];else{if(_0x37e72b[0x0][_0xd083ff(0x20e)]=='Spanish')var _0x3efe70=users[_0xd083ff(0x15e)];else{if(_0x37e72b[0x0][_0xd083ff(0x20e)]==_0xd083ff(0x16a))var _0x3efe70=users[_0xd083ff(0x16a)];else{if(_0x37e72b[0x0][_0xd083ff(0x20e)]==_0xd083ff(0x148))var _0x3efe70=users['Portuguese'];else{if(_0x37e72b[0x0][_0xd083ff(0x20e)]==_0xd083ff(0x1c3))var _0x3efe70=users[_0xd083ff(0x1c3)];else{if(_0x37e72b[0x0][_0xd083ff(0x20e)]==_0xd083ff(0x186))var _0x3efe70=users[_0xd083ff(0x1fe)];}}}}}}}_0x220d6e[_0xd083ff(0x18f)]('edit_purchases_finished_view',{'success':_0x260bdd['flash'](_0xd083ff(0x195)),'errors':_0x260bdd[_0xd083ff(0x13a)](_0xd083ff(0x126)),'role':_0x2a61dc,'profile':_0x41d2c5,'purchases':_0x55c0a0,'suppliers':_0x417b13,'warehouse':_0x29816d,'product':_0x203b45,'master_shop':_0x37e72b,'language':_0x3efe70,'ed_fullDate':_0x386cea,'dataSelected':_0x293061});}catch(_0x2de1ec){console['log'](_0x2de1ec);}}),router[a0_0x243e5b(0x21a)]('/view/:id',auth,async(_0x48cd72,_0x468418)=>{var _0x5649d2=a0_0x243e5b;try{const {username:_0x217068,email:_0x3689b5,role:_0x2fc76f}=_0x48cd72[_0x5649d2(0x1ce)],_0x1be813=_0x48cd72['user'],_0x4e4ba1=await profile[_0x5649d2(0x199)]({'email':_0x1be813['email']}),_0x31e8de=await master_shop[_0x5649d2(0x1c4)](),_0x3d4fe3=_0x48cd72[_0x5649d2(0x11f)]['id'],_0x5db70d=await purchases_finished[_0x5649d2(0x18a)](_0x3d4fe3),_0x1b58b3=await suppliers[_0x5649d2(0x1c4)]({});let _0xa1d078;if(_0x1be813['role']==_0x5649d2(0x165)){const _0x90c5a3=await staff[_0x5649d2(0x199)]({'email':_0x1be813[_0x5649d2(0x1bd)]});_0xa1d078=await warehouse['find']({'status':'Enabled','name':_0x90c5a3[_0x5649d2(0x17d)],'warehouse_category':_0x5649d2(0x10d)});}else _0xa1d078=await warehouse[_0x5649d2(0x183)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x5649d2(0x217),'name':{'$first':'$name'}}}]);const _0x509f27=await product[_0x5649d2(0x1c4)]({}),_0x3e034e=BayBinSelected(_0x5db70d[_0x5649d2(0x229)],_0x5db70d[_0x5649d2(0x213)]);let _0x351c9b=new Date(_0x5db70d['expiry_date']),_0x332489=('0'+_0x351c9b[_0x5649d2(0x215)]())[_0x5649d2(0x1ef)](-0x2),_0x5947cf=('0'+(_0x351c9b[_0x5649d2(0x17c)]()+0x1))[_0x5649d2(0x1ef)](-0x2),_0x5302db=_0x351c9b[_0x5649d2(0x185)](),_0x268d7b=_0x5302db+'-'+_0x5947cf+'-'+_0x332489;if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x1e8)){var _0x35d35b=users['English'];console[_0x5649d2(0x10e)](_0x35d35b);}else{if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x15a))var _0x35d35b=users[_0x5649d2(0x15a)];else{if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x12e))var _0x35d35b=users[_0x5649d2(0x12e)];else{if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x15e))var _0x35d35b=users['Spanish'];else{if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x16a))var _0x35d35b=users[_0x5649d2(0x16a)];else{if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x148))var _0x35d35b=users[_0x5649d2(0x1a8)];else{if(_0x31e8de[0x0][_0x5649d2(0x20e)]==_0x5649d2(0x1c3))var _0x35d35b=users[_0x5649d2(0x1c3)];else{if(_0x31e8de[0x0]['language']=='Arabic\x20(ae)')var _0x35d35b=users[_0x5649d2(0x1fe)];}}}}}}}_0x468418[_0x5649d2(0x18f)](_0x5649d2(0x170),{'success':_0x48cd72[_0x5649d2(0x13a)](_0x5649d2(0x195)),'errors':_0x48cd72['flash']('errors'),'role':_0x1be813,'profile':_0x4e4ba1,'purchases':_0x5db70d,'suppliers':_0x1b58b3,'warehouse':_0xa1d078,'product':_0x509f27,'master_shop':_0x31e8de,'language':_0x35d35b,'ed_fullDate':_0x268d7b,'dataSelected':_0x3e034e});}catch(_0x3d3d58){console[_0x5649d2(0x10e)](_0x3d3d58);}}),router['post'](a0_0x243e5b(0x207),auth,async(_0x5ee133,_0x3db7e0)=>{var _0x13c362=a0_0x243e5b;try{const _0xac68ed=_0x5ee133['params']['id'],_0x4a9741=await purchases_finished[_0x13c362(0x199)]({'_id':_0x5ee133[_0x13c362(0x11f)]['id']}),_0x8b632b=await warehouse['findOne']({'name':_0x4a9741[_0x13c362(0x229)],'room':_0x4a9741[_0x13c362(0x213)]});_0x4a9741['product']['forEach'](_0xd16915=>{var _0x22b7dc=_0x13c362;const _0x2ee5c3=_0x8b632b[_0x22b7dc(0x22f)][_0x22b7dc(0x16b)](_0x1a29c3=>{var _0x506675=_0x22b7dc;_0x1a29c3['product_name']==_0xd16915['product_name']&&_0x1a29c3[_0x506675(0xfa)]==_0xd16915[_0x506675(0xfa)]&&(_0x1a29c3[_0x506675(0x124)]=parseInt(_0x1a29c3['product_stock'])-parseInt(_0xd16915['quantity']));});}),await _0x8b632b[_0x13c362(0x166)]();const {invoice:_0x4aa1be,suppliers:_0x4add02,date:_0x4478f6,warehouse_name:_0x21113f,prod_name:_0x128476,prod_code:_0x512877,prod_qty:_0x34de82,prod_unit:_0xc4b67d,prod_secondunit:_0x5112ed,prod_level:_0x253d94,prod_isle:_0x19ec62,prod_pallet:_0x1a1cef,note:_0x46dbdd,expiry_date:_0x3887ef,batch_code:_0x217404,paid_amount:_0x1ae4e4,due_amount:_0x56ba4d,Room_name:_0x59ffe1,primary_code:_0xc11713,secondary_code:_0xedadc1,PO_number:_0x4db562,JO_number:_0x2a8a19}=_0x5ee133[_0x13c362(0x184)];if(typeof _0x128476==_0x13c362(0x1b8))var _0x1c947f=[_0x5ee133['body'][_0x13c362(0x18c)]],_0x11a00f=[_0x5ee133['body'][_0x13c362(0x123)]],_0x4f9139=[_0x5ee133[_0x13c362(0x184)]['prod_qty']],_0xb2d6b0=[_0x5ee133[_0x13c362(0x184)]['prod_unit']],_0x5b5725=[_0x5ee133[_0x13c362(0x184)][_0x13c362(0x174)]],_0x509082=[_0x5ee133[_0x13c362(0x184)][_0x13c362(0x1f8)]],_0x3e8ea4=[_0x5ee133[_0x13c362(0x184)][_0x13c362(0x17f)]],_0x53951a=[_0x5ee133[_0x13c362(0x184)][_0x13c362(0x18e)]],_0x4dc8b7=[_0x5ee133[_0x13c362(0x184)]['MaxStocks_data']],_0x16ec26=[_0x5ee133[_0x13c362(0x184)][_0x13c362(0x1e3)]],_0x3972b3=[_0x5ee133[_0x13c362(0x184)][_0x13c362(0x179)]];else var _0x1c947f=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x18c)]],_0x11a00f=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x123)]],_0x4f9139=[..._0x5ee133['body']['prod_qty']],_0xb2d6b0=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0xf4)]],_0x5b5725=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x174)]],_0x509082=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x1f8)]],_0x3e8ea4=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x17f)]],_0x53951a=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x18e)]],_0x4dc8b7=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x20c)]],_0x16ec26=[..._0x5ee133['body'][_0x13c362(0x1e3)]],_0x3972b3=[..._0x5ee133[_0x13c362(0x184)][_0x13c362(0x179)]];const _0x333e9c=_0x1c947f[_0x13c362(0x16b)](_0x3a7711=>{return _0x3a7711={'product_name':_0x3a7711};});_0x11a00f[_0x13c362(0x181)]((_0x1bed6a,_0xcb0c45)=>{var _0x4522cf=_0x13c362;_0x333e9c[_0xcb0c45][_0x4522cf(0x16d)]=_0x1bed6a;}),_0x4f9139[_0x13c362(0x181)]((_0x5b0f6c,_0x5c23b7)=>{_0x333e9c[_0x5c23b7]['quantity']=_0x5b0f6c;}),_0xb2d6b0['forEach']((_0x56983b,_0x356d33)=>{var _0x3b8c12=_0x13c362;_0x333e9c[_0x356d33][_0x3b8c12(0x1bf)]=_0x56983b;}),_0x5b5725[_0x13c362(0x181)]((_0x39f6fa,_0x2d9a13)=>{var _0x9362b8=_0x13c362;_0x333e9c[_0x2d9a13][_0x9362b8(0x16e)]=_0x39f6fa;}),_0x509082['forEach']((_0x863406,_0x349641)=>{_0x333e9c[_0x349641]['bay']=_0x863406;}),_0x3e8ea4[_0x13c362(0x181)]((_0x12479d,_0x59967f)=>{_0x333e9c[_0x59967f]['primary_code']=_0x12479d;}),_0x53951a[_0x13c362(0x181)]((_0x1b200d,_0x56feea)=>{var _0x5a4a2b=_0x13c362;_0x333e9c[_0x56feea][_0x5a4a2b(0x18e)]=_0x1b200d;}),_0x4dc8b7[_0x13c362(0x181)]((_0x509b0f,_0x31a181)=>{var _0xac140a=_0x13c362;_0x333e9c[_0x31a181][_0xac140a(0x1b4)]=_0x509b0f;}),_0x16ec26[_0x13c362(0x181)]((_0x5e20f7,_0x4acd50)=>{_0x333e9c[_0x4acd50]['batch_code']=_0x5e20f7;}),_0x3972b3[_0x13c362(0x181)]((_0x3dae56,_0x139cb6)=>{var _0x5a8c8e=_0x13c362;_0x333e9c[_0x139cb6][_0x5a8c8e(0x179)]=_0x3dae56;});const _0x3d6168=_0x333e9c[_0x13c362(0x194)](_0x31689d=>_0x31689d['quantity']!=='0'&&_0x31689d[_0x13c362(0x14d)]!=='');_0x4a9741[_0x13c362(0x228)]=_0x4aa1be,_0x4a9741['suppliers']=_0x4add02,_0x4a9741[_0x13c362(0x14c)]=_0x4478f6,_0x4a9741[_0x13c362(0x229)]=_0x21113f,_0x4a9741[_0x13c362(0x116)]=_0x3d6168,_0x4a9741[_0x13c362(0x1db)]=_0x46dbdd,_0x4a9741[_0x13c362(0x15d)]=_0x1ae4e4,_0x4a9741[_0x13c362(0x143)]=_0x56ba4d,_0x4a9741[_0x13c362(0x213)]=_0x59ffe1,_0x4a9741[_0x13c362(0x1ab)]=_0x4db562,_0x4a9741[_0x13c362(0x1f2)]=_0x2a8a19;const _0x351388=await _0x4a9741['save'](),_0xcba49b=await warehouse[_0x13c362(0x199)]({'name':_0x5ee133[_0x13c362(0x184)][_0x13c362(0x229)],'room':_0x5ee133[_0x13c362(0x184)][_0x13c362(0x159)]});_0x4a9741[_0x13c362(0x116)]['forEach'](_0x1adaf8=>{var _0x56dd0d=_0x13c362,_0x3a12e6=0x0;const _0x2b57a0=_0xcba49b[_0x56dd0d(0x22f)][_0x56dd0d(0x16b)](_0x59f094=>{var _0x268514=_0x56dd0d;_0x59f094['product_name']==_0x1adaf8['product_name']&&_0x59f094['bay']==_0x1adaf8[_0x268514(0xfa)]&&(_0x59f094[_0x268514(0x124)]=parseInt(_0x59f094[_0x268514(0x124)])+parseInt(_0x1adaf8[_0x268514(0x14d)]),_0x3a12e6++);});_0x3a12e6=='0'&&(_0xcba49b[_0x56dd0d(0x22f)]=_0xcba49b[_0x56dd0d(0x22f)]['concat']({'product_name':_0x1adaf8[_0x56dd0d(0x1c7)],'product_stock':_0x1adaf8[_0x56dd0d(0x14d)],'primary_code':_0x1adaf8[_0x56dd0d(0x17f)],'secondary_code':_0x1adaf8['secondary_code'],'product_code':_0x1adaf8[_0x56dd0d(0x16d)],'bay':_0x1adaf8[_0x56dd0d(0xfa)],'maxProducts':_0x1adaf8['maxStocks'],'unit':_0x1adaf8['standard_unit'],'secondary_unit':_0x1adaf8[_0x56dd0d(0x16e)],'expiry_date':_0x1adaf8[_0x56dd0d(0x179)]}));}),await _0xcba49b[_0x13c362(0x166)]();const _0x494615=await s_payment_data['findOne']({'invoice':_0x5ee133[_0x13c362(0x184)][_0x13c362(0x228)]});if(_0x494615===null){}else console[_0x13c362(0x10e)](_0x13c362(0x222),_0x494615,_0x5ee133[_0x13c362(0x184)][_0x13c362(0x228)]),_0x494615[_0x13c362(0x222)]=_0x5ee133[_0x13c362(0x184)][_0x13c362(0x222)],await _0x494615[_0x13c362(0x166)]();_0x5ee133[_0x13c362(0x13a)]('success','purchase\x20data\x20update\x20successfully'),_0x3db7e0[_0x13c362(0x218)]('/all_purchases_finished/view');}catch(_0x2c980f){console[_0x13c362(0x10e)](_0x2c980f);}}),router[a0_0x243e5b(0x17a)](a0_0x243e5b(0x13e),auth,async(_0x38eda1,_0x2a4237)=>{var _0x5d6493=a0_0x243e5b;try{const _0x5a30f2=_0x38eda1[_0x5d6493(0x11f)]['id'],{invoice:_0x476424,suppliers:_0x1977bf,payable:_0x3324c3,due_amount:_0x524870}=_0x38eda1[_0x5d6493(0x184)],_0x50702f=await purchases[_0x5d6493(0x18a)](_0x5a30f2);var _0x2a9275=_0x3324c3-_0x524870;_0x50702f[_0x5d6493(0x15d)]=parseFloat(_0x50702f[_0x5d6493(0x15d)])+parseFloat(_0x524870),_0x50702f['due_amount']=_0x2a9275;const _0x49c96b=await _0x50702f[_0x5d6493(0x166)]();console[_0x5d6493(0x10e)](_0x49c96b);const _0x290a19=await s_payment_data[_0x5d6493(0x199)]({'invoice':_0x476424});_0x290a19[_0x5d6493(0x118)]=_0x2a9275,await _0x290a19[_0x5d6493(0x166)]();let _0x4cbf05=new Date(),_0x4c9b67=('0'+_0x4cbf05[_0x5d6493(0x215)]())[_0x5d6493(0x1ef)](-0x2),_0x4b3d75=('0'+(_0x4cbf05[_0x5d6493(0x17c)]()+0x1))[_0x5d6493(0x1ef)](-0x2),_0x40e409=_0x4cbf05[_0x5d6493(0x185)](),_0x4bfbb2=_0x40e409+'-'+_0x4b3d75+'-'+_0x4c9b67;const _0x4ae17c=new suppliers_payment({'invoice':_0x476424,'date':_0x40e409+'-'+_0x4b3d75+'-'+_0x4c9b67,'suppliers':_0x1977bf,'reason':_0x5d6493(0x1d1),'amount':_0x524870}),_0x4970ec=await _0x4ae17c['save']();_0x38eda1[_0x5d6493(0x13a)](_0x5d6493(0x195),_0x5d6493(0x167)),_0x2a4237[_0x5d6493(0x218)](_0x5d6493(0x150));}catch(_0x484046){console[_0x5d6493(0x10e)](_0x484046);}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x1c2),auth,async(_0x5e95b8,_0x4f5510)=>{var _0x122b50=a0_0x243e5b;try{const {username:_0x791637,email:_0x10dde2,role:_0x1347c7}=_0x5e95b8[_0x122b50(0x1ce)],_0x2bf28b=_0x5e95b8['user'],_0x1af041=await profile[_0x122b50(0x199)]({'email':_0x2bf28b['email']}),_0x2d6bba=await master_shop[_0x122b50(0x1c4)]();console[_0x122b50(0x10e)](_0x122b50(0x1a1),_0x2d6bba);const _0x212953=_0x5e95b8[_0x122b50(0x11f)]['id'],_0x25affe=await purchases[_0x122b50(0x18a)](_0x212953);console['log'](_0x25affe);const _0x3938f8=await suppliers[_0x122b50(0x199)]({'name':_0x25affe[_0x122b50(0x222)]});console[_0x122b50(0x10e)](_0x3938f8);if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x1e8)){var _0x4f5403=users[_0x122b50(0x190)];console[_0x122b50(0x10e)](_0x4f5403);}else{if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x15a))var _0x4f5403=users[_0x122b50(0x15a)];else{if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x12e))var _0x4f5403=users[_0x122b50(0x12e)];else{if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x15e))var _0x4f5403=users[_0x122b50(0x15e)];else{if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x16a))var _0x4f5403=users[_0x122b50(0x16a)];else{if(_0x2d6bba[0x0]['language']==_0x122b50(0x148))var _0x4f5403=users[_0x122b50(0x1a8)];else{if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x1c3))var _0x4f5403=users[_0x122b50(0x1c3)];else{if(_0x2d6bba[0x0][_0x122b50(0x20e)]==_0x122b50(0x186))var _0x4f5403=users[_0x122b50(0x1fe)];}}}}}}}_0x4f5510[_0x122b50(0x18f)](_0x122b50(0x197),{'success':_0x5e95b8[_0x122b50(0x13a)](_0x122b50(0x195)),'errors':_0x5e95b8[_0x122b50(0x13a)](_0x122b50(0x126)),'role':_0x2bf28b,'profile':_0x1af041,'master_shop':_0x2d6bba,'supplier':_0x3938f8,'purchase':_0x25affe,'language':_0x4f5403});}catch(_0x2c3d57){console['log'](_0x2c3d57);}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x13f),auth,async(_0x3bfa91,_0x2afcaa)=>{var _0x5bd45d=a0_0x243e5b;try{const {username:_0xd6ccf8,email:_0x57e02f,role:_0x2f278e}=_0x3bfa91['user'],_0x18ada1=_0x3bfa91['user'],_0xf12ef5=await profile['findOne']({'email':_0x18ada1['email']}),_0x563c57=await master_shop[_0x5bd45d(0x1c4)]();console[_0x5bd45d(0x10e)]('master',_0x563c57);const _0x5ba04c=_0x3bfa91[_0x5bd45d(0x11f)]['id'];console[_0x5bd45d(0x10e)](_0x5ba04c);const _0x5f15e5=await purchases_finished['findById'](_0x5ba04c);console['log'](_0x5bd45d(0x152),_0x5f15e5);const _0x187cb8=await product[_0x5bd45d(0x1c4)]({}),_0x53a3ab=await warehouse[_0x5bd45d(0x183)]([{'$match':{'name':_0x5f15e5[_0x5bd45d(0x229)],'room':_0x5f15e5[_0x5bd45d(0x213)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5bd45d(0x18b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5bd45d(0x19b)},'bin':{'$first':_0x5bd45d(0x1ed)},'type':{'$first':_0x5bd45d(0x158)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5bd45d(0x227)},'secondary_code':{'$first':_0x5bd45d(0x115)},'product_code':{'$first':_0x5bd45d(0x10a)},'storage':{'$first':_0x5bd45d(0x233)},'rack':{'$first':_0x5bd45d(0x214)}}}]);console[_0x5bd45d(0x10e)](_0x5bd45d(0x103),_0x53a3ab);let _0x4555e2;if(_0x18ada1[_0x5bd45d(0xf7)]==_0x5bd45d(0x165)){const _0x3d9a60=await staff['findOne']({'email':_0x18ada1[_0x5bd45d(0x1bd)]});_0x4555e2=await warehouse[_0x5bd45d(0x1c4)]({'status':_0x5bd45d(0x1bc),'name':_0x3d9a60['warehouse'],'warehouse_category':_0x5bd45d(0x10d),'name':'Return\x20Goods'});}else _0x4555e2=await warehouse[_0x5bd45d(0x183)]([{'$match':{'status':_0x5bd45d(0x1bc),'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':_0x5bd45d(0x217),'name':{'$first':_0x5bd45d(0x217)}}}]);if(_0x563c57[0x0][_0x5bd45d(0x20e)]==_0x5bd45d(0x1e8)){var _0xf1e930=users['English'];console['log'](_0xf1e930);}else{if(_0x563c57[0x0]['language']==_0x5bd45d(0x15a))var _0xf1e930=users[_0x5bd45d(0x15a)];else{if(_0x563c57[0x0][_0x5bd45d(0x20e)]==_0x5bd45d(0x12e))var _0xf1e930=users[_0x5bd45d(0x12e)];else{if(_0x563c57[0x0][_0x5bd45d(0x20e)]==_0x5bd45d(0x15e))var _0xf1e930=users[_0x5bd45d(0x15e)];else{if(_0x563c57[0x0][_0x5bd45d(0x20e)]=='French')var _0xf1e930=users[_0x5bd45d(0x16a)];else{if(_0x563c57[0x0][_0x5bd45d(0x20e)]=='Portuguese\x20(BR)')var _0xf1e930=users[_0x5bd45d(0x1a8)];else{if(_0x563c57[0x0][_0x5bd45d(0x20e)]==_0x5bd45d(0x1c3))var _0xf1e930=users[_0x5bd45d(0x1c3)];else{if(_0x563c57[0x0][_0x5bd45d(0x20e)]==_0x5bd45d(0x186))var _0xf1e930=users[_0x5bd45d(0x1fe)];}}}}}}}_0x2afcaa[_0x5bd45d(0x18f)]('return_purchase_finished',{'success':_0x3bfa91[_0x5bd45d(0x13a)](_0x5bd45d(0x195)),'errors':_0x3bfa91[_0x5bd45d(0x13a)](_0x5bd45d(0x126)),'role':_0x18ada1,'profile':_0xf12ef5,'user':_0x5f15e5,'stock':_0x53a3ab,'master_shop':_0x563c57,'product':_0x187cb8,'language':_0xf1e930,'warehouse':_0x4555e2});}catch(_0x24f467){console[_0x5bd45d(0x10e)](_0x24f467);}}),router[a0_0x243e5b(0x17a)](a0_0x243e5b(0x13f),auth,async(_0x292641,_0x5ebd6b)=>{var _0x11e8f5=a0_0x243e5b;try{const {invoice:_0x350dde,date:_0x465ef8,warehouse_name:_0x2bea00,Room_name:_0x3ff233,product_name:_0x1255f6,purchase_quantity:_0x4b1a67,stocks:_0x5e9226,return_qty:_0x4b0e1b,note:_0xf0bdd,level:_0x414294,isle:_0x4e85e2,pallet:_0x1c63fb,to_warehouse_name:_0x3d0814,to_Room_name:_0x3139ba}=_0x292641[_0x11e8f5(0x184)],_0xd11dc2=await purchases_finished[_0x11e8f5(0x199)]({'_id':_0x292641['params']['id']}),_0x3447a3=await warehouse[_0x11e8f5(0x199)]({'name':_0x2bea00,'room':_0x3ff233,'warehouse_category':'Finished\x20Goods'});if(typeof _0x1255f6=='string')var _0x212cb8=[_0x292641[_0x11e8f5(0x184)]['product_name']],_0xad3423=[_0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x1cb)]],_0x572e7d=[_0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x135)]],_0x19c0e4=[_0x292641['body'][_0x11e8f5(0x206)]],_0x46fe01=[_0x292641['body']['level']],_0x40cd8f=[_0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x196)]],_0x3372f9=[_0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x21f)]],_0x15607f=[_0x292641[_0x11e8f5(0x184)]['secondary_code_hide']];else var _0x212cb8=[..._0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x1c7)]],_0xad3423=[..._0x292641[_0x11e8f5(0x184)]['purchase_quantity']],_0x572e7d=[..._0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x135)]],_0x19c0e4=[..._0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x206)]],_0x46fe01=[..._0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x1a2)]],_0x40cd8f=[..._0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x196)]],_0x3372f9=[..._0x292641[_0x11e8f5(0x184)]['primary_code_hide']],_0x15607f=[..._0x292641['body'][_0x11e8f5(0x221)]];const _0x386c62=_0x212cb8[_0x11e8f5(0x16b)](_0xef2542=>{return _0xef2542={'product_name':_0xef2542};});_0xad3423[_0x11e8f5(0x181)]((_0xcf597e,_0x476a4f)=>{_0x386c62[_0x476a4f]['purchase_quantity']=_0xcf597e;}),_0x572e7d[_0x11e8f5(0x181)]((_0x2d95be,_0xf3015a)=>{var _0x45d0e6=_0x11e8f5;_0x386c62[_0xf3015a][_0x45d0e6(0x1f3)]=_0x2d95be;}),_0x19c0e4[_0x11e8f5(0x181)]((_0x58af88,_0x2bead8)=>{var _0x43b4e6=_0x11e8f5;_0x386c62[_0x2bead8][_0x43b4e6(0x206)]=_0x58af88;}),_0x46fe01['forEach']((_0x4e67be,_0x18a726)=>{var _0x43a104=_0x11e8f5;_0x386c62[_0x18a726][_0x43a104(0xfa)]=_0x4e67be;}),_0x40cd8f[_0x11e8f5(0x181)]((_0xba9c2,_0x3f2554)=>{var _0x17cdaf=_0x11e8f5;_0x386c62[_0x3f2554][_0x17cdaf(0x16d)]=_0xba9c2;}),_0x3372f9[_0x11e8f5(0x181)]((_0x3c571f,_0x20b34b)=>{var _0xbcab02=_0x11e8f5;_0x386c62[_0x20b34b][_0xbcab02(0x17f)]=_0x3c571f;}),_0x15607f[_0x11e8f5(0x181)]((_0x386dd4,_0x2f7887)=>{var _0x77e998=_0x11e8f5;_0x386c62[_0x2f7887][_0x77e998(0x18e)]=_0x386dd4;}),_0x386c62[_0x11e8f5(0x181)](_0x513120=>{var _0x59b268=_0x11e8f5;console['log'](_0x513120);const _0xc4924e=_0x3447a3['product_details'][_0x59b268(0x16b)](_0x4a72fc=>{var _0x3b5422=_0x59b268;_0x4a72fc[_0x3b5422(0x1c7)]==_0x513120['product_name']&&_0x4a72fc[_0x3b5422(0xfa)]==_0x513120[_0x3b5422(0xfa)]&&(console[_0x3b5422(0x10e)](parseInt(_0x4a72fc[_0x3b5422(0x124)])+'\x20<>\x20'+parseInt(_0x513120[_0x3b5422(0x206)])),_0x4a72fc[_0x3b5422(0x124)]=parseInt(_0x4a72fc[_0x3b5422(0x124)])-parseInt(_0x513120['return_qty']));});}),await _0x3447a3[_0x11e8f5(0x166)]();var _0x2ff98f=0x0;_0x386c62[_0x11e8f5(0x181)](_0xb681a0=>{var _0x122fde=_0x11e8f5;(parseInt(_0xb681a0[_0x122fde(0x1cb)])<parseInt(_0xb681a0[_0x122fde(0x206)])||parseInt(_0xb681a0['stock_quantity'])<parseInt(_0xb681a0[_0x122fde(0x206)]))&&_0x2ff98f++;});if(_0x2ff98f!=0x0)return _0x292641[_0x11e8f5(0x13a)]('errors',_0x11e8f5(0x223)),_0x5ebd6b['redirect'](_0x11e8f5(0x173));const _0x5b703f=new purchases_return_finished({'invoice':_0x350dde,'suppliers':_0x292641['body']['suppliers'],'date':_0x465ef8,'warehouse_name':_0x2bea00,'return_product':_0x386c62,'note':_0xf0bdd,'room':_0x3ff233,'to_warehouse_name':_0x3d0814,'to_room':_0x3139ba}),_0x48ea5b=await _0x5b703f[_0x11e8f5(0x166)](),_0x576df0=await purchases_return_finished[_0x11e8f5(0x199)]({'invoice':_0x350dde}),_0x33f5a3=await warehouse[_0x11e8f5(0x199)]({'name':_0x3d0814,'room':_0x3139ba,'warehouse_category':_0x11e8f5(0x10d)});_0x576df0[_0x11e8f5(0x127)][_0x11e8f5(0x181)](_0x35ba0b=>{var _0x466899=_0x11e8f5,_0x16b22f=0x0;const _0x19e8e0=_0x33f5a3[_0x466899(0x22f)][_0x466899(0x16b)](_0x52b540=>{var _0x4113f8=_0x466899;console[_0x4113f8(0x10e)](_0x52b540['product_name']+'=='+_0x35ba0b[_0x4113f8(0x1c7)]+'&&'+_0x52b540[_0x4113f8(0xfa)]+'=='+_0x35ba0b[_0x4113f8(0xfa)]),_0x52b540['product_name']==_0x35ba0b[_0x4113f8(0x1c7)]&&_0x52b540['bay']==_0x35ba0b[_0x4113f8(0xfa)]&&(_0x52b540[_0x4113f8(0x124)]=parseInt(_0x52b540[_0x4113f8(0x124)])-parseInt(_0x35ba0b[_0x4113f8(0x206)]),_0x16b22f++);});_0x16b22f=='0'&&(_0x33f5a3[_0x466899(0x22f)]=_0x33f5a3[_0x466899(0x22f)][_0x466899(0x139)]({'product_name':_0x35ba0b[_0x466899(0x1c7)],'product_stock':_0x35ba0b[_0x466899(0x206)],'primary_code':_0x35ba0b['primary_code'],'secondary_code':_0x35ba0b[_0x466899(0x18e)],'product_code':_0x35ba0b[_0x466899(0x16d)],'bay':_0x35ba0b['bay'],'maxProducts':0xf423f}));}),await _0x33f5a3['save']();const _0x436894=await purchases_finished['findOne']({'invoice':_0x350dde});_0x436894['return_data']='True';const _0x26be6d=await _0x436894[_0x11e8f5(0x166)](),_0x5593c2=new s_payment_data({'invoice':_0x350dde,'suppliers':_0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x222)],'reason':_0x11e8f5(0x122)});await _0x5593c2[_0x11e8f5(0x166)]();const _0x57f5dd=await master_shop[_0x11e8f5(0x1c4)](),_0x429aac=await email_settings[_0x11e8f5(0x199)](),_0x261f3d=await suppliers[_0x11e8f5(0x199)]({'name':_0x292641[_0x11e8f5(0x184)][_0x11e8f5(0x222)]});_0x57f5dd[0x0][_0x11e8f5(0x19f)]==0x1?(right_currency=_0x57f5dd[0x0][_0x11e8f5(0x22c)],left_currency=''):(right_currency='',left_currency=_0x57f5dd[0x0]['currency']);var _0x39dd60=_0x212cb8,_0x540a91=_0x19c0e4,_0x3eb817='',_0x1c7e4a;for(_0x1c7e4a in _0x39dd60){_0x3eb817+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x39dd60[_0x1c7e4a]+_0x11e8f5(0x18d)+_0x11e8f5(0x1ee)+_0x540a91[_0x1c7e4a]+'</td>'+_0x11e8f5(0x132);}let _0x35704c=nodemailer[_0x11e8f5(0x1b9)]({'service':_0x11e8f5(0x1d0),'auth':{'user':_0x429aac[_0x11e8f5(0x1bd)],'pass':_0x429aac[_0x11e8f5(0x157)]}}),_0x34fa65={'from':_0x429aac[_0x11e8f5(0x1bd)],'to':_0x261f3d['email'],'subject':_0x11e8f5(0x108),'attachments':[{'filename':_0x11e8f5(0x211),'path':__dirname+_0x11e8f5(0x1a4)+_0x11e8f5(0x216)+_0x57f5dd[0x0][_0x11e8f5(0x1d9)],'cid':_0x11e8f5(0x1f4)}],'html':_0x11e8f5(0x113)+_0x11e8f5(0x1cc)+_0x11e8f5(0x220)+_0x11e8f5(0x193)+_0x11e8f5(0x1dc)+_0x11e8f5(0x193)+_0x11e8f5(0x1c0)+_0x11e8f5(0x1df)+_0x11e8f5(0x193)+_0x11e8f5(0x1d8)+_0x57f5dd[0x0][_0x11e8f5(0x236)]+_0x11e8f5(0x1e7)+_0x11e8f5(0x1df)+_0x11e8f5(0x1df)+_0x11e8f5(0x136)+'<div>'+_0x11e8f5(0x182)+_0x11e8f5(0x22a)+_0x350dde+'\x20'+_0x11e8f5(0x1c9)+'\x20Order\x20Date\x20:\x20'+_0x465ef8+'\x20'+_0x11e8f5(0x1f7)+_0x11e8f5(0x16c)+'</div>'+_0x11e8f5(0x13c)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x11e8f5(0x1b1)+_0x11e8f5(0x1a5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x11e8f5(0x200)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x11e8f5(0x132)+_0x11e8f5(0xfd)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3eb817+'\x20'+_0x11e8f5(0x20d)+_0x11e8f5(0x11b)+'<div>'+_0x11e8f5(0x21b)+_0x11e8f5(0x128)+_0x57f5dd[0x0][_0x11e8f5(0x236)]+'</h5>'+_0x11e8f5(0x1df)+_0x11e8f5(0x1df)+'</body></html>'};_0x35704c[_0x11e8f5(0x10b)](_0x34fa65,function(_0x2e8f34,_0xa42c1d){var _0x5032c8=_0x11e8f5;_0x2e8f34?console[_0x5032c8(0x10e)](_0x5032c8(0x1f6)):console[_0x5032c8(0x10e)](_0x5032c8(0x162));}),_0x292641['flash']('success',_0x11e8f5(0x13b)),_0x5ebd6b['redirect'](_0x11e8f5(0x144));}catch(_0x141920){_0x5ebd6b['status'](0xc8)[_0x11e8f5(0x142)]({'message':_0x141920[_0x11e8f5(0x14a)]});}}),router[a0_0x243e5b(0x21a)](a0_0x243e5b(0x1e4),auth,async(_0x90a00c,_0x3bf24f)=>{var _0x4a42bf=a0_0x243e5b;try{const {username:_0x10c5dd,email:_0x1b3ade,role:_0x1cd878}=_0x90a00c[_0x4a42bf(0x1ce)],_0x171039=_0x90a00c[_0x4a42bf(0x1ce)],_0x24739a=await profile['findOne']({'email':_0x171039[_0x4a42bf(0x1bd)]}),_0x406d0f=await master_shop[_0x4a42bf(0x1c4)](),_0x221a45=_0x90a00c[_0x4a42bf(0x11f)]['id'],_0x3366cf=await purchases_finished[_0x4a42bf(0x18a)](_0x221a45);if(_0x406d0f[0x0][_0x4a42bf(0x20e)]==_0x4a42bf(0x1e8))var _0x1e9556=users[_0x4a42bf(0x190)];else{if(_0x406d0f[0x0][_0x4a42bf(0x20e)]==_0x4a42bf(0x15a))var _0x1e9556=users[_0x4a42bf(0x15a)];else{if(_0x406d0f[0x0][_0x4a42bf(0x20e)]==_0x4a42bf(0x12e))var _0x1e9556=users['German'];else{if(_0x406d0f[0x0][_0x4a42bf(0x20e)]==_0x4a42bf(0x15e))var _0x1e9556=users['Spanish'];else{if(_0x406d0f[0x0][_0x4a42bf(0x20e)]=='French')var _0x1e9556=users[_0x4a42bf(0x16a)];else{if(_0x406d0f[0x0]['language']==_0x4a42bf(0x148))var _0x1e9556=users[_0x4a42bf(0x1a8)];else{if(_0x406d0f[0x0][_0x4a42bf(0x20e)]==_0x4a42bf(0x1c3))var _0x1e9556=users['Chinese'];else{if(_0x406d0f[0x0][_0x4a42bf(0x20e)]==_0x4a42bf(0x186))var _0x1e9556=users[_0x4a42bf(0x1fe)];}}}}}}}_0x3bf24f[_0x4a42bf(0x18f)](_0x4a42bf(0x15b),{'success':_0x90a00c[_0x4a42bf(0x13a)](_0x4a42bf(0x195)),'errors':_0x90a00c[_0x4a42bf(0x13a)](_0x4a42bf(0x126)),'role':_0x171039,'profile':_0x24739a,'alldata':_0x3366cf,'master_shop':_0x406d0f,'language':_0x1e9556}),console[_0x4a42bf(0x10e)](alldata);}catch(_0x57225b){console[_0x4a42bf(0x10e)](_0x57225b);}}),router[a0_0x243e5b(0x17a)](a0_0x243e5b(0x133),async(_0x4a9bb5,_0x2e6a34)=>{var _0x36af7e=a0_0x243e5b;const {product_code:_0x26a357}=_0x4a9bb5['body'];var _0xcb7ae5;const _0x29f950=await product['aggregate']([{'$match':{'primary_code':_0x26a357}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x36af7e(0x188)},'brand':{'$first':_0x36af7e(0x160)},'unit':{'$first':_0x36af7e(0x1ca)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x36af7e(0x1fb)},'secondary_code':{'$first':_0x36af7e(0x12f)},'maxStocks':{'$first':_0x36af7e(0x14e)},'maxProdPerUnit':{'$first':_0x36af7e(0x137)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x36af7e(0x201)},'gross_price':{'$first':_0x36af7e(0x1e5)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x573dd8=await product[_0x36af7e(0x183)]([{'$match':{'secondary_code':_0x26a357}},{'$group':{'_id':_0x36af7e(0x156),'name':{'$first':_0x36af7e(0x217)},'category':{'$first':_0x36af7e(0x188)},'brand':{'$first':'$brand'},'unit':{'$first':_0x36af7e(0x1ca)},'alertquantity':{'$first':_0x36af7e(0x219)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x36af7e(0x1fb)},'secondary_code':{'$first':_0x36af7e(0x12f)},'maxStocks':{'$first':_0x36af7e(0x14e)},'maxProdPerUnit':{'$first':_0x36af7e(0x137)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x36af7e(0x201)},'gross_price':{'$first':_0x36af7e(0x1e5)},'sales_category':{'$first':_0x36af7e(0xfe)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x29f950[_0x36af7e(0x1fa)]>0x0)_0xcb7ae5=_0x29f950;else _0x573dd8[_0x36af7e(0x1fa)]>0x0&&(_0xcb7ae5=_0x573dd8);_0x2e6a34['json'](_0xcb7ae5);}),router[a0_0x243e5b(0x17a)]('/CheckingWarehouse',async(_0x52dcc7,_0x1465b6)=>{var _0x38d9b0=a0_0x243e5b;const {productCode:_0x440adb,bay:_0x46acb0,warehouses:_0x32f6bd,room:_0x5ec867}=_0x52dcc7[_0x38d9b0(0x184)];console['log'](_0x52dcc7[_0x38d9b0(0x184)]);try{const _0x36541d=await warehouse['aggregate']([{'$match':{'name':_0x32f6bd,'room':_0x5ec867}},{'$unwind':_0x38d9b0(0x141)},{'$match':{'product_details.bay':parseInt(_0x46acb0)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x38d9b0(0x20f)},'product_stock':{'$first':_0x38d9b0(0x109)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x38d9b0(0x1d7)}}}]);_0x1465b6['status'](0xc8)[_0x38d9b0(0x142)](_0x36541d);}catch(_0x57e6f0){_0x1465b6[_0x38d9b0(0x1c1)](0x194)[_0x38d9b0(0x142)]({'message':_0x57e6f0['message']});}}),router['post'](a0_0x243e5b(0x172),async(_0x1414a8,_0x57d4a6)=>{var _0x128824=a0_0x243e5b;const {product_code:_0x3947fd}=_0x1414a8['body'];var _0x37e5d8;const _0x6ff032=await product[_0x128824(0x183)]([{'$match':{'primary_code':_0x3947fd,'type_products':_0x128824(0x10e)}},{'$group':{'_id':_0x128824(0x156),'name':{'$first':_0x128824(0x217)},'category':{'$first':_0x128824(0x188)},'brand':{'$first':_0x128824(0x160)},'unit':{'$first':_0x128824(0x1ca)},'alertquantity':{'$first':_0x128824(0x219)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x128824(0x1fb)},'secondary_code':{'$first':_0x128824(0x12f)},'maxStocks':{'$first':_0x128824(0x14e)},'maxProdPerUnit':{'$first':_0x128824(0x137)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x128824(0x201)},'gross_price':{'$first':_0x128824(0x1e5)},'sales_category':{'$first':_0x128824(0xfe)},'type_products':{'$first':_0x128824(0x125)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x128824(0x10e)](_0x6ff032);const _0x1f4272=await product[_0x128824(0x183)]([{'$match':{'secondary_code':_0x3947fd,'type_products':_0x128824(0x10e)}},{'$group':{'_id':'$_id','name':{'$first':_0x128824(0x217)},'category':{'$first':_0x128824(0x188)},'brand':{'$first':_0x128824(0x160)},'unit':{'$first':_0x128824(0x1ca)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x128824(0x1fb)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x128824(0x14e)},'maxProdPerUnit':{'$first':_0x128824(0x137)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x128824(0x201)},'gross_price':{'$first':_0x128824(0x1e5)},'sales_category':{'$first':_0x128824(0xfe)},'type_products':{'$first':_0x128824(0x125)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x6ff032[_0x128824(0x1fa)]>0x0)_0x37e5d8=_0x6ff032;else _0x1f4272['length']>0x0&&(_0x37e5d8=_0x1f4272);_0x57d4a6[_0x128824(0x142)](_0x37e5d8);}),module[a0_0x243e5b(0x1e2)]=router;