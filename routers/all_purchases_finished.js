var a0_0x48f119=a0_0x5bee;(function(_0x4c5cf2,_0x5e9747){var _0x2265ec=a0_0x5bee,_0x1bcc99=_0x4c5cf2();while(!![]){try{var _0x17142b=parseInt(_0x2265ec(0x1af))/0x1*(parseInt(_0x2265ec(0x270))/0x2)+parseInt(_0x2265ec(0x2da))/0x3+parseInt(_0x2265ec(0x1f4))/0x4*(-parseInt(_0x2265ec(0x2a3))/0x5)+parseInt(_0x2265ec(0x25a))/0x6+parseInt(_0x2265ec(0x221))/0x7+parseInt(_0x2265ec(0x23b))/0x8+parseInt(_0x2265ec(0x2a0))/0x9;if(_0x17142b===_0x5e9747)break;else _0x1bcc99['push'](_0x1bcc99['shift']());}catch(_0x4b80c4){_0x1bcc99['push'](_0x1bcc99['shift']());}}}(a0_0x5da5,0xb9d9d));function a0_0x5da5(){var _0x3b942b=['product','<strong>\x20Regards\x20</strong>','concat','findById','2-digit','isProcess','post','add_purchases\x20error','Finished\x20Goods','then','/preview/:id','2207178UsrdGg','back','English','5564140BysvmH','$_id','max_product_unit','True','date_recieved','incoming_add','<h2>\x20','$product.floorlevel','</table>','flash','/view/add_purchases_logs','redirect','../middleware/auth','own','to_room_name','\x20</h2>','product_cat','paid_amount','edit_purchases_finished','master','match','batch_code','to_bay','room_name','<h5>','string','message','/view/add_purchases','Portuguese','body','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Distributing\x20','product_id','suppliers_docs','user','type_of_products_type','standard_unit','\x20<>\x20','to_quantity','/getTRF','toString','payment\x20successfull','$invoice','item_code','params','$maxStocks','/invoice/:id','exports','Spanish','image','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product.type','stock_data','1958172yGOzTS','$product.room_name','prod_cat','log','filter','Arabic\x20(ae)','$batch_code','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','map','JO_number','sales_category','There\x20is\x20','all_purchases_finished_logs','Return\x20Goods','Enabled','Ambient','\x20Order\x20Date\x20:\x20','Purchase\x20Mail','min','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','\x20<=>\x20','43chAsBz','$product.bay','getFullYear','secondary_code_hide','product_code_hide','Rack\x201','/incoming/add','valueOf','maxPerUnit','/view/:id','$product_details.storage','purchases\x20item\x20return\x20successfull','$product','site_title','primary_code','prod_Qty','$date','currency','Logo.png','/process/:id','/barcode_scanner','$product_details','$name','FGSEmail','<div>','/view/add_purchases/:id','gross_price','$room','forEach','staff','edit_purchases_finished_view','maxperunit','length','prod_name','Rack\x202','Purchase\x20Return','name','stock_quantity','product_data','Asia/Manila','purchase\x20data\x20add\x20successfully','save','currency_placement','$suppliers_docs','all','<!DOCTYPE\x20html>','sendMail','$secondary_code','../models/all_models','date','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','get','quantity','$category','Enclosed','room','$product_details.bay','note','success','port','catch','maxStocks','Error\x20occurred\x20while\x20processing\x20product:','/give_payment/:id','path','due_amount','$paid_amount','unit','purchases_process','4jaxUuC','</tbody>','FROZEN\x20GOODS','false','<h5\x20style=\x22text-align:\x20left;\x22>','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_primunit','type_of_products','return_data','/view_log','Transfer\x20Finalize\x20Successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','bin','$product_code','RoomAssign','An\x20error\x20occurred.','product_stock','slice','uuid','prod_code','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','</h5>','json','$product_details.product_stock','$suppliers','Portuguese\x20(BR)','$product_details.product_code','en-CA','/getinvoicetrf','render','true','undefined','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_unit','POnumber','</head><body>','findOne','$type_products','Chinese','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','MaxStocks_data','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','error','4450684ndDztf','logo','$secondary_unit','warehouse','Error\x20Occurs','return_product','Room_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<hr\x20class=\x22my-3\x22>','Router','primary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','production_date','$product_details.secondary_code','INC','find','German','$product.quantity','Email\x20sent\x20successfully','return_purchase_finished','numeric','product_details','<tr>','express','prod_level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','615768RDveIJ','role','</div>','expiry_date','all_purchases_barcode','product_code','secondary_code','</td>','$note','bay','</span>','Arabic','Hindi','$alertquantity','aggregate','/barcode_scanner_logs','language','$product_details._id','purchase_quantity','prod_secondunit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','_id','$warehouse_name','</tr>','$gross_price','</body></html>','getDate','status','random','INCF-','567810VFByFB','createTransport','</thead>','user_id','to_recieved','warehouse_name','$due_amount','/picking_list/pdf_puchases_fin_own_trf/','$expiry_date','all_purchases_finished','suppliers','errors','email','$unit','DRY\x20GOODS','LOG-INC-',',\x20bin:\x20','sales_data_cateory','$brand','/all_purchases_finished/process/','product_name','/all_purchases/view','7846HONznx','/view/return_purchase/:id','INC-','updateOne','English\x20(US)','../public/language/languages.json','maxProducts','stocks','prod_qty','/all_purchases_finished/view','padStart','password','secondary_unit','getMonth','$return_data','\x20units\x20to\x20warehouse:\x20','product_date','/CheckingWarehouse','$primary_code','toLocaleDateString','to_warehouse','$product.bin','invoice','French','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','invoice_init','floor','abs','/barcode/:id','/all_purchases_finished/preview/','table\x20page','$product_details.floorlevel','logs','$product_details.rack','purchase\x20data\x20update\x20successfully','/../public','$maxProdPerUnit'];a0_0x5da5=function(){return _0x3b942b;};return a0_0x5da5();}const express=require(a0_0x48f119(0x238)),app=express(),router=express[a0_0x48f119(0x22a)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x48f119(0x1df)),auth=require(a0_0x48f119(0x2af)),nodemailer=require('nodemailer');function a0_0x5bee(_0x467a58,_0x4b1bdc){var _0x5da5e6=a0_0x5da5();return a0_0x5bee=function(_0x5beedf,_0x45feed){_0x5beedf=_0x5beedf-0x1a5;var _0xd2ec4=_0x5da5e6[_0x5beedf];return _0xd2ec4;},a0_0x5bee(_0x467a58,_0x4b1bdc);}var ejs=require('ejs');const path=require(a0_0x48f119(0x1ef)),users=require(a0_0x48f119(0x275)),{isNull}=require('util');router[a0_0x48f119(0x1e2)]('/incoming',auth,async(_0xee9133,_0x527c69)=>{var _0x40655b=a0_0x48f119;try{const {username:_0x19de17,email:_0x2b5319,role:_0x2ac42f}=_0xee9133['user'],_0x26a82e=_0xee9133['user'],_0x5a9b1c=await profile[_0x40655b(0x219)]({'email':_0x26a82e['email']}),_0x1a79a9=await staff[_0x40655b(0x219)]({'email':_0x26a82e[_0x40655b(0x266)]}),_0x544fbe=await master_shop[_0x40655b(0x230)]();let _0x54e408=await transfers_finished[_0x40655b(0x249)]([{'$match':{'to_warehouse':_0x1a79a9[_0x40655b(0x224)]}}]);if(_0x544fbe[0x0][_0x40655b(0x24b)]==_0x40655b(0x274))var _0x359024=users[_0x40655b(0x2a2)];else{if(_0x544fbe[0x0][_0x40655b(0x24b)]==_0x40655b(0x247))var _0x359024=users['Hindi'];else{if(_0x544fbe[0x0]['language']==_0x40655b(0x231))var _0x359024=users[_0x40655b(0x231)];else{if(_0x544fbe[0x0][_0x40655b(0x24b)]==_0x40655b(0x2d4))var _0x359024=users[_0x40655b(0x2d4)];else{if(_0x544fbe[0x0][_0x40655b(0x24b)]==_0x40655b(0x287))var _0x359024=users[_0x40655b(0x287)];else{if(_0x544fbe[0x0][_0x40655b(0x24b)]==_0x40655b(0x20e))var _0x359024=users['Portuguese'];else{if(_0x544fbe[0x0][_0x40655b(0x24b)]==_0x40655b(0x21b))var _0x359024=users[_0x40655b(0x21b)];else{if(_0x544fbe[0x0][_0x40655b(0x24b)]=='Arabic\x20(ae)')var _0x359024=users[_0x40655b(0x246)];}}}}}}}_0x527c69[_0x40655b(0x212)]('incoming_view',{'success':_0xee9133[_0x40655b(0x2ac)](_0x40655b(0x1e9)),'errors':_0xee9133[_0x40655b(0x2ac)](_0x40655b(0x265)),'purchases':_0x54e408,'role':_0x26a82e,'profile':_0x5a9b1c,'master_shop':_0x544fbe,'language':_0x359024,'staff_data':_0x1a79a9});}catch(_0x183e24){console['log'](_0x40655b(0x28e),_0x183e24),_0x527c69['status'](0xc8)[_0x40655b(0x20b)]({'message':_0x183e24[_0x40655b(0x2bd)]});}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x1b5),auth,async(_0x5c54f1,_0x4e45eb)=>{var _0xcbf79a=a0_0x48f119;try{const {username:_0x5e5969,email:_0x5d58cb,role:_0x46d179}=_0x5c54f1['user'],_0xe9be90=_0x5c54f1[_0xcbf79a(0x2c6)],_0x3ea1c0=await profile[_0xcbf79a(0x219)]({'email':_0xe9be90['email']}),_0x122c26=await staff[_0xcbf79a(0x219)]({'email':_0xe9be90[_0xcbf79a(0x266)]}),_0xb14ebe=await master_shop[_0xcbf79a(0x230)]();let _0x2facc6=await transfers_finished[_0xcbf79a(0x249)]([{'$match':{'to_warehouse':_0x122c26[_0xcbf79a(0x224)],'to_recieved':_0xcbf79a(0x1f7)}}]);if(_0xb14ebe[0x0][_0xcbf79a(0x24b)]==_0xcbf79a(0x274))var _0x3b811c=users[_0xcbf79a(0x2a2)];else{if(_0xb14ebe[0x0][_0xcbf79a(0x24b)]=='Hindi')var _0x3b811c=users['Hindi'];else{if(_0xb14ebe[0x0][_0xcbf79a(0x24b)]==_0xcbf79a(0x231))var _0x3b811c=users[_0xcbf79a(0x231)];else{if(_0xb14ebe[0x0][_0xcbf79a(0x24b)]==_0xcbf79a(0x2d4))var _0x3b811c=users[_0xcbf79a(0x2d4)];else{if(_0xb14ebe[0x0]['language']=='French')var _0x3b811c=users[_0xcbf79a(0x287)];else{if(_0xb14ebe[0x0]['language']==_0xcbf79a(0x20e))var _0x3b811c=users[_0xcbf79a(0x2bf)];else{if(_0xb14ebe[0x0]['language']=='Chinese')var _0x3b811c=users['Chinese'];else{if(_0xb14ebe[0x0]['language']==_0xcbf79a(0x2df))var _0x3b811c=users['Arabic'];}}}}}}}_0x4e45eb[_0xcbf79a(0x212)](_0xcbf79a(0x2a8),{'success':_0x5c54f1[_0xcbf79a(0x2ac)](_0xcbf79a(0x1e9)),'errors':_0x5c54f1[_0xcbf79a(0x2ac)](_0xcbf79a(0x265)),'purchases':_0x2facc6,'role':_0xe9be90,'profile':_0x3ea1c0,'master_shop':_0xb14ebe,'language':_0x3b811c,'staff_data':_0x122c26});}catch(_0xeccc72){console[_0xcbf79a(0x2dd)](_0xcbf79a(0x28e),_0xeccc72),_0x4e45eb[_0xcbf79a(0x257)](0xc8)[_0xcbf79a(0x20b)]({'message':_0xeccc72['message']});}});const createLog=async _0x936b51=>{var _0x1e2c6d=a0_0x48f119;const _0x382862=new datalogs({'location':_0x936b51});return await _0x382862[_0x1e2c6d(0x1d8)](),_0x382862[_0x1e2c6d(0x289)];};router[a0_0x48f119(0x29b)]('/incoming/add',auth,async(_0x1a07f4,_0x3b5cb3)=>{var _0x12a666=a0_0x48f119;try{const {invoice_trf_data:_0x280f3a,item_code:_0x17246c,SCRN:_0x1db1f9,ReqBy:_0x2d2bd3,type_of_products:_0x3ab8f9,dateofreq:_0x13031d,PO_number:_0x2b2803,date:_0x44eb0d,warehouse_name:_0x3884ef,typeservicesData:_0x5dc243,typevehicle:_0x4b89d7,driver:_0x2b762e,plate:_0x2b6b05,van:_0x50a5bc,DRSI:_0x2beebe,TSU:_0x71a2ff,TFU:_0x2e0777,note:_0x398bdb}=_0x1a07f4[_0x12a666(0x2c0)],_0xd32486=await transfers_finished[_0x12a666(0x298)](_0x280f3a);if(typeof _0x17246c==_0x12a666(0x2bc))var _0x4953c5=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x26e)]],_0x1d94c7=[_0x1a07f4[_0x12a666(0x2c0)]['item_code']],_0x67db3d=[_0x1a07f4['body'][_0x12a666(0x2ca)]],_0x318dee=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x1f2)]],_0x231068=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x24e)]],_0x13032f=[_0x1a07f4[_0x12a666(0x2c0)]['bin']],_0x3f168d=[_0x1a07f4['body'][_0x12a666(0x1bd)]],_0x345113=[_0x1a07f4['body'][_0x12a666(0x241)]],_0x2d9213=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x2b8)]],_0x241ecd=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x23e)]],_0x245ee9=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x22d)]],_0x542a6a=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x2a5)]],_0x4ab091=[_0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x1e6)]];else var _0x4953c5=[..._0x1a07f4['body']['product_name']],_0x1d94c7=[..._0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x2cf)]],_0x67db3d=[..._0x1a07f4[_0x12a666(0x2c0)]['to_quantity']],_0x318dee=[..._0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x1f2)]],_0x231068=[..._0x1a07f4['body'][_0x12a666(0x24e)]],_0x13032f=[..._0x1a07f4[_0x12a666(0x2c0)]['bin']],_0x3f168d=[..._0x1a07f4['body'][_0x12a666(0x1bd)]],_0x345113=[..._0x1a07f4[_0x12a666(0x2c0)]['secondary_code']],_0x2d9213=[..._0x1a07f4[_0x12a666(0x2c0)]['batch_code']],_0x241ecd=[..._0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x23e)]],_0x245ee9=[..._0x1a07f4['body']['production_date']],_0x542a6a=[..._0x1a07f4[_0x12a666(0x2c0)][_0x12a666(0x2a5)]],_0x4ab091=[..._0x1a07f4[_0x12a666(0x2c0)]['room']];const _0x250d78=_0x4953c5['map'](_0x589009=>{return _0x589009={'product_name':_0x589009};});_0x1d94c7[_0x12a666(0x1cb)]((_0x72cd12,_0xdbefa)=>{var _0x3a5e89=_0x12a666;_0x250d78[_0xdbefa][_0x3a5e89(0x240)]=_0x72cd12;}),_0x67db3d[_0x12a666(0x1cb)]((_0x4d0c46,_0x29f6e6)=>{var _0x1691f6=_0x12a666;_0x250d78[_0x29f6e6][_0x1691f6(0x1e3)]=Math[_0x1691f6(0x28b)](_0x4d0c46);}),_0x318dee['forEach']((_0x4d9d4d,_0x5f5149)=>{var _0x1a3d84=_0x12a666;_0x250d78[_0x5f5149][_0x1a3d84(0x2c8)]=_0x4d9d4d;}),_0x231068[_0x12a666(0x1cb)]((_0x52f244,_0x3d57f1)=>{var _0x5743e5=_0x12a666;_0x250d78[_0x3d57f1][_0x5743e5(0x27c)]=_0x52f244;}),_0x13032f['forEach']((_0x150f6b,_0xab37c8)=>{var _0xc1ef78=_0x12a666,_0xaf822=_0x150f6b[_0xc1ef78(0x2b7)](/[A-Za-z]+/)[0x0],_0x4f795b=parseInt(_0x150f6b[_0xc1ef78(0x2b7)](/\d+/)[0x0]);_0x250d78[_0xab37c8][_0xc1ef78(0x21c)]=_0xaf822,_0x250d78[_0xab37c8][_0xc1ef78(0x244)]=_0x4f795b;}),_0x3f168d[_0x12a666(0x1cb)]((_0x3e34e3,_0x57e8e0)=>{var _0x8f7d55=_0x12a666;_0x250d78[_0x57e8e0][_0x8f7d55(0x1bd)]=_0x3e34e3;}),_0x345113['forEach']((_0x17001c,_0x455b93)=>{var _0x55ccba=_0x12a666;_0x250d78[_0x455b93][_0x55ccba(0x241)]=_0x17001c;}),_0x2d9213[_0x12a666(0x1cb)]((_0x1243cf,_0x1f274b)=>{_0x250d78[_0x1f274b]['batch_code']=_0x1243cf;}),_0x241ecd[_0x12a666(0x1cb)]((_0x276afb,_0x140eab)=>{var _0x31203f=_0x12a666;_0x250d78[_0x140eab][_0x31203f(0x23e)]=_0x276afb;}),_0x245ee9[_0x12a666(0x1cb)]((_0xf433c7,_0x557f71)=>{_0x250d78[_0x557f71]['production_date']=_0xf433c7;}),_0x542a6a[_0x12a666(0x1cb)]((_0x338c26,_0x360c8e)=>{var _0x2d89dc=_0x12a666;_0x250d78[_0x360c8e][_0x2d89dc(0x1ce)]=_0x338c26;}),_0x4ab091[_0x12a666(0x1cb)]((_0x29f31e,_0x5942b4)=>{var _0x4a7909=_0x12a666;_0x250d78[_0x5942b4][_0x4a7909(0x2ba)]=_0x29f31e;});const _0x106dff=await createLog(_0x12a666(0x22f));_0x4ab091[_0x12a666(0x1cb)]((_0x521bbb,_0x1218e8)=>{var _0x31f1be=_0x12a666;_0x250d78[_0x1218e8][_0x31f1be(0x286)]='INC-'+_0x106dff['toString']()[_0x31f1be(0x27a)](0x8,'0');});const _0xea2f75=_0x250d78[_0x12a666(0x2de)](_0x1839ca=>_0x1839ca['quantity']!=='0'&&_0x1839ca['quantity']!==''),_0x455884=new purchases_incoming({'invoice':'INC-'+_0x106dff[_0x12a666(0x2cc)]()['padStart'](0x8,'0'),'date':_0x44eb0d,'warehouse_name':_0x3884ef,'product':_0xea2f75,'note':_0x398bdb,'POnumber':_0x2b2803,'SCRN':_0x1db1f9,'ReqBy':_0x2d2bd3,'dateofreq':_0x13031d,'typeservicesData':_0x5dc243,'van':_0x50a5bc,'typevehicle':_0x4b89d7,'driver':_0x2b762e,'plate':_0x2b6b05,'DRSI':_0x2beebe,'TSU':_0x71a2ff,'TFU':_0x2e0777,'typeOfProducts':_0x3ab8f9}),_0x330dd8=await _0x455884[_0x12a666(0x1d8)](),_0x2dc015=_0x330dd8[_0x12a666(0x295)][_0x12a666(0x2e3)](async _0x3fbe37=>{var _0x5cce60=_0x12a666,_0x52d2d8=await warehouse[_0x5cce60(0x219)]({'name':_0x3884ef,'room':_0x3fbe37[_0x5cce60(0x2ba)]});if(_0x3fbe37['quantity']>0x0){var _0x1e08d8=0x0;const _0x8cbc1c=_0x52d2d8[_0x5cce60(0x236)][_0x5cce60(0x2e3)](_0x2bf161=>{var _0x1f1384=_0x5cce60;_0x2bf161[_0x1f1384(0x26e)]==_0x3fbe37[_0x1f1384(0x26e)]&&_0x2bf161[_0x1f1384(0x244)]==_0x3fbe37[_0x1f1384(0x2b9)]&&_0x2bf161[_0x1f1384(0x23e)]==_0x3fbe37[_0x1f1384(0x23e)]&&_0x2bf161[_0x1f1384(0x22d)]==_0x3fbe37[_0x1f1384(0x22d)]&&_0x2bf161[_0x1f1384(0x2b8)]==_0x3fbe37[_0x1f1384(0x2b8)]&&_0x2bf161[_0x1f1384(0x286)]==_0x3fbe37[_0x1f1384(0x286)]&&(typeof _0x3fbe37['id_transaction']==_0x1f1384(0x214)?(console[_0x1f1384(0x2dd)]('here2',_0x2bf161[_0x1f1384(0x205)]+'\x20<>\x20'+_0x2bf161[_0x1f1384(0x251)]+_0x1f1384(0x1ae)+Math[_0x1f1384(0x28b)](_0x2bf161['product_stock'])+Math[_0x1f1384(0x28b)](_0x3fbe37[_0x1f1384(0x2ca)])),_0x2bf161[_0x1f1384(0x205)]=Math['abs'](_0x2bf161[_0x1f1384(0x205)])+Math[_0x1f1384(0x28b)](_0x3fbe37[_0x1f1384(0x1e3)])):(_0x2bf161['product_stock']=Math[_0x1f1384(0x28b)](_0x2bf161[_0x1f1384(0x205)])+Math[_0x1f1384(0x28b)](_0x3fbe37[_0x1f1384(0x1e3)]),_0x1e08d8++));});_0x1e08d8=='0'&&(_0x52d2d8[_0x5cce60(0x236)]=_0x52d2d8['product_details'][_0x5cce60(0x297)]({'product_name':_0x3fbe37[_0x5cce60(0x26e)],'product_stock':_0x3fbe37['quantity'],'bay':_0x3fbe37[_0x5cce60(0x244)],'level':_0x3fbe37[_0x5cce60(0x21c)],'product_code':_0x3fbe37['product_code'],'primary_code':_0x3fbe37[_0x5cce60(0x1bd)],'secondary_code':_0x3fbe37['secondary_code'],'expiry_date':_0x3fbe37[_0x5cce60(0x23e)],'production_date':_0x3fbe37['production_date'],'maxProducts':_0x3fbe37['maxProducts'],'batch_code':_0x3fbe37[_0x5cce60(0x2b8)],'secondary_unit':_0x3fbe37['secondary_unit'],'unit':_0x3fbe37[_0x5cce60(0x2c8)],'maxProducts':_0x3fbe37[_0x5cce60(0x276)],'maxPerUnit':_0x3fbe37[_0x5cce60(0x1b7)],'invoice':_0x3fbe37[_0x5cce60(0x286)]}));}return _0x52d2d8;});Promise[_0x12a666(0x1db)](_0x2dc015)['then'](async _0x2a47e6=>{var _0x5647f0=_0x12a666;try{for(const _0x379f48 of _0x2a47e6){await warehouse[_0x5647f0(0x273)]({'_id':_0x379f48['_id']},{'$addToSet':{'product_details':{'$each':_0x379f48['product_details']}}});}_0xd32486[_0x5647f0(0x25e)]=_0x5647f0(0x213);const _0x55de93=await _0xd32486[_0x5647f0(0x1d8)](),_0x5b14ac=await master_shop['find'](),_0x2aa0ad=await email_settings[_0x5647f0(0x219)](),_0x395941=await supervisor_settings['find']();var _0xd9509a=_0x455884[_0x5647f0(0x295)],_0x42cdc1='',_0x12e921;for(_0x12e921 in _0xd9509a){var _0x2a2726='FG';_0x455884['to_warehouse']==_0x5647f0(0x268)&&(_0x2a2726='DG'),_0x42cdc1+=_0x5647f0(0x237)+_0x5647f0(0x21f)+_0xd9509a[_0x12e921][_0x5647f0(0x26e)]+_0x5647f0(0x242)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd9509a[_0x12e921][_0x5647f0(0x240)]+'</td>'+_0x5647f0(0x21f)+_0xd9509a[_0x12e921][_0x5647f0(0x2ca)]+_0x5647f0(0x242)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd9509a[_0x12e921][_0x5647f0(0x1f2)]+'</td>'+_0x5647f0(0x21f)+_0xd9509a[_0x12e921][_0x5647f0(0x27c)]+_0x5647f0(0x242)+_0x5647f0(0x21f)+_0x455884[_0x5647f0(0x284)]+_0x5647f0(0x242)+_0x5647f0(0x21f)+_0xd9509a[_0x12e921][_0x5647f0(0x2b1)]+_0x5647f0(0x242)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a2726+_0xd9509a[_0x12e921][_0x5647f0(0x2b9)]+_0x5647f0(0x242)+_0x5647f0(0x253);}_0x1a07f4[_0x5647f0(0x2ac)]('success',_0x5647f0(0x1ff)),_0x3b5cb3['redirect'](_0x5647f0(0x261)+_0x330dd8[_0x5647f0(0x251)]);}catch(_0x2c0728){console[_0x5647f0(0x220)](_0x2c0728),_0x3b5cb3[_0x5647f0(0x257)](0x1f4)[_0x5647f0(0x20b)]({'error':_0x5647f0(0x1e1)});}})['catch'](_0x3b17f5=>{var _0x48a641=_0x12a666;console[_0x48a641(0x220)](_0x3b17f5),_0x3b5cb3[_0x48a641(0x257)](0x1f4)['json']({'error':_0x48a641(0x204)});});}catch(_0x3d5a7a){}}),router['post'](a0_0x48f119(0x2cb),auth,async(_0xe6567f,_0x50ebd0)=>{var _0x346849=a0_0x48f119;try{const {warehouse:_0x4dde54}=_0xe6567f[_0x346849(0x2c0)],_0x809a09=await transfers_finished['find']({'to_warehouse':_0x4dde54,'to_recieved':'false'});_0x50ebd0[_0x346849(0x20b)](_0x809a09);}catch(_0x1fe6b3){}}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x211),auth,async(_0x1c19a5,_0x149ac0)=>{var _0x404a7e=a0_0x48f119;try{const {invoice:_0x3b9200}=_0x1c19a5[_0x404a7e(0x2c0)],_0x3f01cc=await transfers_finished[_0x404a7e(0x230)]({'_id':_0x3b9200,'to_recieved':_0x404a7e(0x1f7)});_0x149ac0[_0x404a7e(0x20b)](_0x3f01cc);}catch(_0x16cb77){}}),router[a0_0x48f119(0x1e2)]('/view',auth,async(_0x5c41c1,_0x3ba5fa)=>{var _0x23798e=a0_0x48f119;try{const {username:_0x33a524,email:_0x139a8e,role:_0x38c529}=_0x5c41c1[_0x23798e(0x2c6)],_0xbd2141=_0x5c41c1['user'],_0x4631a8=await profile[_0x23798e(0x219)]({'email':_0xbd2141[_0x23798e(0x266)]}),_0x49db21=await staff['findOne']({'email':_0xbd2141[_0x23798e(0x266)]});if(_0xbd2141[_0x23798e(0x23c)]==_0x23798e(0x1cc)){const _0xb85a84=await staff[_0x23798e(0x219)]({'email':_0xbd2141[_0x23798e(0x266)]});}const _0x186ddd=await master_shop[_0x23798e(0x230)]();let _0x439782;if(_0xbd2141[_0x23798e(0x23c)]==_0x23798e(0x1cc)){const _0x34c193=await staff['findOne']({'email':_0xbd2141[_0x23798e(0x266)]});_0x439782=await purchases_finished[_0x23798e(0x249)]([{'$match':{'warehouse_name':_0x34c193[_0x23798e(0x224)],'typeOfProducts':_0x23798e(0x2b0)}},{'$lookup':{'from':_0x23798e(0x264),'localField':_0x23798e(0x264),'foreignField':_0x23798e(0x1d3),'as':_0x23798e(0x2c5)}},{'$unwind':_0x23798e(0x1da)},{'$unwind':'$product'},{'$group':{'_id':_0x23798e(0x2a4),'invoice':{'$first':_0x23798e(0x2ce)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x23798e(0x252)},'room':{'$first':_0x23798e(0x1ca)},'product':{'$push':'$product'},'note':{'$first':_0x23798e(0x243)},'paid_amount':{'$first':_0x23798e(0x1f1)},'due_amount':{'$first':_0x23798e(0x260)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x23798e(0x2e0)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x23798e(0x232)},'level':{'$addToSet':_0x23798e(0x1b0)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x23798e(0x2d8)},'floorlevel':{'$addToSet':_0x23798e(0x2aa)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x439782=await purchases_finished[_0x23798e(0x249)]([{'$match':{'typeOfProducts':_0x23798e(0x2b0)}},{'$unwind':_0x23798e(0x1bb)},{'$group':{'_id':'$_id','invoice':{'$first':_0x23798e(0x2ce)},'suppliers':{'$first':_0x23798e(0x20d)},'date':{'$first':_0x23798e(0x1bf)},'warehouse_name':{'$first':_0x23798e(0x252)},'room':{'$addToSet':_0x23798e(0x2db)},'product':{'$push':_0x23798e(0x1bb)},'note':{'$first':_0x23798e(0x243)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x23798e(0x27e)},'batch_code':{'$first':_0x23798e(0x2e0)},'expiry_date':{'$first':_0x23798e(0x262)},'suppliers_docs':{'$first':_0x23798e(0x1da)},'total_product_quantity':{'$sum':_0x23798e(0x232)},'level':{'$addToSet':_0x23798e(0x1b0)},'isle':{'$addToSet':_0x23798e(0x285)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x23798e(0x2aa)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x186ddd[0x0][_0x23798e(0x24b)]==_0x23798e(0x274))var _0x22690c=users[_0x23798e(0x2a2)];else{if(_0x186ddd[0x0]['language']==_0x23798e(0x247))var _0x22690c=users[_0x23798e(0x247)];else{if(_0x186ddd[0x0][_0x23798e(0x24b)]==_0x23798e(0x231))var _0x22690c=users[_0x23798e(0x231)];else{if(_0x186ddd[0x0]['language']==_0x23798e(0x2d4))var _0x22690c=users['Spanish'];else{if(_0x186ddd[0x0][_0x23798e(0x24b)]==_0x23798e(0x287))var _0x22690c=users['French'];else{if(_0x186ddd[0x0]['language']==_0x23798e(0x20e))var _0x22690c=users['Portuguese'];else{if(_0x186ddd[0x0][_0x23798e(0x24b)]==_0x23798e(0x21b))var _0x22690c=users[_0x23798e(0x21b)];else{if(_0x186ddd[0x0]['language']==_0x23798e(0x2df))var _0x22690c=users['Arabic'];}}}}}}}_0x3ba5fa[_0x23798e(0x212)](_0x23798e(0x263),{'success':_0x5c41c1[_0x23798e(0x2ac)]('success'),'errors':_0x5c41c1[_0x23798e(0x2ac)]('errors'),'purchases':_0x439782,'role':_0xbd2141,'profile':_0x4631a8,'master_shop':_0x186ddd,'language':_0x22690c});}catch(_0x497185){console['log']('table\x20page',_0x497185),_0x3ba5fa[_0x23798e(0x257)](0xc8)[_0x23798e(0x20b)]({'message':_0x497185[_0x23798e(0x2bd)]});}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x1fe),auth,async(_0x5ae1a4,_0xcbf9ff)=>{var _0x398c83=a0_0x48f119;try{const {username:_0x218060,email:_0x316c82,role:_0x30e2cf}=_0x5ae1a4[_0x398c83(0x2c6)],_0x298879=_0x5ae1a4[_0x398c83(0x2c6)],_0x88d3de=await profile[_0x398c83(0x219)]({'email':_0x298879[_0x398c83(0x266)]}),_0x333cbd=await staff['findOne']({'email':_0x298879['email']});if(_0x298879['role']==_0x398c83(0x1cc)){const _0xfeceb3=await staff[_0x398c83(0x219)]({'email':_0x298879[_0x398c83(0x266)]});}const _0xbea827=await master_shop['find']();let _0x158cad;if(_0x298879[_0x398c83(0x23c)]=='staff'){const _0xda1950=await staff[_0x398c83(0x219)]({'email':_0x298879[_0x398c83(0x266)]});_0x158cad=await purchases_finished[_0x398c83(0x249)]([{'$match':{'warehouse_name':_0xda1950[_0x398c83(0x224)]}},{'$lookup':{'from':_0x398c83(0x264),'localField':_0x398c83(0x264),'foreignField':_0x398c83(0x1d3),'as':_0x398c83(0x2c5)}},{'$unwind':_0x398c83(0x1da)},{'$unwind':_0x398c83(0x1bb)},{'$group':{'_id':_0x398c83(0x2a4),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x398c83(0x20d)},'date':{'$first':_0x398c83(0x1bf)},'warehouse_name':{'$first':_0x398c83(0x252)},'room':{'$first':_0x398c83(0x1ca)},'product':{'$push':_0x398c83(0x1bb)},'note':{'$first':_0x398c83(0x243)},'paid_amount':{'$first':_0x398c83(0x1f1)},'due_amount':{'$first':_0x398c83(0x260)},'return_data':{'$first':_0x398c83(0x27e)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x398c83(0x262)},'suppliers_docs':{'$first':_0x398c83(0x1da)},'total_product_quantity':{'$sum':_0x398c83(0x232)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x398c83(0x285)},'type':{'$addToSet':_0x398c83(0x2d8)},'floorlevel':{'$addToSet':_0x398c83(0x2aa)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x158cad=await purchases_finished[_0x398c83(0x249)]([{'$match':{'typeOfProducts':_0x398c83(0x290)}},{'$unwind':_0x398c83(0x1bb)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x398c83(0x20d)},'date':{'$first':_0x398c83(0x1bf)},'warehouse_name':{'$first':_0x398c83(0x252)},'room':{'$addToSet':_0x398c83(0x2db)},'product':{'$push':_0x398c83(0x1bb)},'note':{'$first':_0x398c83(0x243)},'paid_amount':{'$first':_0x398c83(0x1f1)},'due_amount':{'$first':_0x398c83(0x260)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x398c83(0x1da)},'total_product_quantity':{'$sum':_0x398c83(0x232)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x398c83(0x285)},'type':{'$addToSet':_0x398c83(0x2d8)},'floorlevel':{'$addToSet':_0x398c83(0x2aa)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xbea827[0x0][_0x398c83(0x24b)]==_0x398c83(0x274))var _0xadf22c=users[_0x398c83(0x2a2)];else{if(_0xbea827[0x0]['language']==_0x398c83(0x247))var _0xadf22c=users[_0x398c83(0x247)];else{if(_0xbea827[0x0][_0x398c83(0x24b)]==_0x398c83(0x231))var _0xadf22c=users['German'];else{if(_0xbea827[0x0][_0x398c83(0x24b)]==_0x398c83(0x2d4))var _0xadf22c=users[_0x398c83(0x2d4)];else{if(_0xbea827[0x0][_0x398c83(0x24b)]==_0x398c83(0x287))var _0xadf22c=users[_0x398c83(0x287)];else{if(_0xbea827[0x0][_0x398c83(0x24b)]==_0x398c83(0x20e))var _0xadf22c=users[_0x398c83(0x2bf)];else{if(_0xbea827[0x0][_0x398c83(0x24b)]=='Chinese')var _0xadf22c=users['Chinese'];else{if(_0xbea827[0x0]['language']=='Arabic\x20(ae)')var _0xadf22c=users[_0x398c83(0x246)];}}}}}}}_0xcbf9ff[_0x398c83(0x212)](_0x398c83(0x1a6),{'success':_0x5ae1a4['flash'](_0x398c83(0x1e9)),'errors':_0x5ae1a4[_0x398c83(0x2ac)](_0x398c83(0x265)),'purchases':_0x158cad,'role':_0x298879,'profile':_0x88d3de,'master_shop':_0xbea827,'language':_0xadf22c});}catch(_0x33f467){console[_0x398c83(0x2dd)](_0x398c83(0x28e),_0x33f467),_0xcbf9ff['status'](0xc8)[_0x398c83(0x20b)]({'message':_0x33f467[_0x398c83(0x2bd)]});}});function BayBinSelected(_0x27402d,_0x5bc768){var _0x385f62=a0_0x48f119,_0x53065f=[],_0x3231f5=[];if(_0x27402d==_0x385f62(0x268)){switch(_0x5bc768){case _0x385f62(0x1b4):_0x53065f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x385f62(0x1d1):_0x53065f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3231f5=['DG'];}else{if(_0x27402d==_0x385f62(0x1f6)){switch(_0x5bc768){case _0x385f62(0x1b4):_0x53065f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x385f62(0x1d1):_0x53065f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3231f5=['FG'];}}return{'levels':_0x53065f,'identify':_0x3231f5};}async function getRandom8DigitNumber(){var _0x2b89e9=a0_0x48f119;const _0x3c5cf9=0x989680,_0x5c7cdf=0x5f5e0ff,_0x3339dc=Math[_0x2b89e9(0x28a)](Math[_0x2b89e9(0x258)]()*(_0x5c7cdf-_0x3c5cf9+0x1))+_0x3c5cf9;var _0x430286;const _0x45409c=await purchases_finished[_0x2b89e9(0x219)]({'invoice':_0x2b89e9(0x259)+_0x3339dc});return _0x45409c&&_0x45409c['length']>0x0?_0x430286='INCF-'+_0x3339dc:_0x430286=_0x2b89e9(0x259)+_0x3339dc,_0x430286;}router[a0_0x48f119(0x1e2)](a0_0x48f119(0x2be),auth,async(_0x3bfe2f,_0x409d7a)=>{var _0x8aaa52=a0_0x48f119;try{const {username:_0x14f05b,email:_0x44f4b2,role:_0xbd36e9}=_0x3bfe2f[_0x8aaa52(0x2c6)],_0x20519e=_0x3bfe2f[_0x8aaa52(0x2c6)],_0xf9866d=await profile[_0x8aaa52(0x219)]({'email':_0x20519e['email']}),_0x2569fb=await master_shop[_0x8aaa52(0x230)](),_0x3fcf84=await staff[_0x8aaa52(0x219)]({'email':_0x20519e[_0x8aaa52(0x266)]}),_0x3b1226=await suppliers[_0x8aaa52(0x230)]({});let _0x3ad209;if(_0x20519e[_0x8aaa52(0x23c)]==_0x8aaa52(0x1cc)){const _0x4808ae=await staff[_0x8aaa52(0x219)]({'email':_0x20519e['email']});_0x3ad209=await warehouse[_0x8aaa52(0x249)]([{'$match':{'status':_0x8aaa52(0x1a8),'name':_0x4808ae['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x8aaa52(0x1c5)}}}]);}else _0x3ad209=await warehouse['aggregate']([{'$match':{'status':_0x8aaa52(0x1a8)}},{'$group':{'_id':_0x8aaa52(0x1c5),'name':{'$first':_0x8aaa52(0x1c5)}}}]);const _0x23f73d=await product['find']({}),_0x23c13c=await warehouse['find']({'status':_0x8aaa52(0x1a8)}),_0x182ef9=await purchases_finished[_0x8aaa52(0x230)]({}),_0x5aeda2=_0x182ef9['length']+0x1,_0x1da394=_0x8aaa52(0x259)+_0x5aeda2[_0x8aaa52(0x2cc)]()[_0x8aaa52(0x27a)](0x5,'0');var _0x53cee7=[_0x8aaa52(0x1a9),'Enclosed'];if(_0x2569fb[0x0][_0x8aaa52(0x24b)]==_0x8aaa52(0x274))var _0x389e55=users[_0x8aaa52(0x2a2)];else{if(_0x2569fb[0x0]['language']==_0x8aaa52(0x247))var _0x389e55=users[_0x8aaa52(0x247)];else{if(_0x2569fb[0x0][_0x8aaa52(0x24b)]=='German')var _0x389e55=users['German'];else{if(_0x2569fb[0x0][_0x8aaa52(0x24b)]==_0x8aaa52(0x2d4))var _0x389e55=users[_0x8aaa52(0x2d4)];else{if(_0x2569fb[0x0][_0x8aaa52(0x24b)]==_0x8aaa52(0x287))var _0x389e55=users[_0x8aaa52(0x287)];else{if(_0x2569fb[0x0]['language']=='Portuguese\x20(BR)')var _0x389e55=users[_0x8aaa52(0x2bf)];else{if(_0x2569fb[0x0]['language']==_0x8aaa52(0x21b))var _0x389e55=users[_0x8aaa52(0x21b)];else{if(_0x2569fb[0x0][_0x8aaa52(0x24b)]==_0x8aaa52(0x2df))var _0x389e55=users[_0x8aaa52(0x246)];}}}}}}}const _0x3fa1bf=getRandom8DigitNumber(),_0x56ec03=new Date(),_0x4360f9={'year':_0x8aaa52(0x235),'month':_0x8aaa52(0x299),'day':_0x8aaa52(0x299),'timeZone':_0x8aaa52(0x1d6)},_0x46532e=_0x56ec03[_0x8aaa52(0x283)](_0x8aaa52(0x210),_0x4360f9);console[_0x8aaa52(0x2dd)](_0x46532e),_0x3fa1bf[_0x8aaa52(0x29e)](_0x4092a2=>{var _0x50cfa9=_0x8aaa52;_0x409d7a[_0x50cfa9(0x212)]('add_purchases_finished',{'success':_0x3bfe2f[_0x50cfa9(0x2ac)](_0x50cfa9(0x1e9)),'errors':_0x3bfe2f[_0x50cfa9(0x2ac)](_0x50cfa9(0x265)),'role':_0x20519e,'profile':_0xf9866d,'suppliers':_0x3b1226,'warehouse':_0x3ad209,'product':_0x23f73d,'invoice':_0x4092a2,'master_shop':_0x2569fb,'language':_0x389e55,'find_data':_0x23c13c,'rooms_data':_0x53cee7,'formattedDate':_0x46532e});})[_0x8aaa52(0x1eb)](_0x828f8=>{var _0x43fd78=_0x8aaa52;_0x3bfe2f[_0x43fd78(0x2ac)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x409d7a[_0x43fd78(0x2ae)]('/all_purchases_finished/view');});}catch(_0x44213c){console[_0x8aaa52(0x2dd)](_0x44213c);}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x2ad),auth,async(_0x5d46a4,_0x225ce1)=>{var _0xa8b701=a0_0x48f119;try{const {username:_0x1e336c,email:_0x567f94,role:_0x539e31}=_0x5d46a4[_0xa8b701(0x2c6)],_0x1b948a=_0x5d46a4[_0xa8b701(0x2c6)],_0x25f55c=await profile[_0xa8b701(0x219)]({'email':_0x1b948a[_0xa8b701(0x266)]}),_0x2f95fb=await master_shop['find'](),_0x2cb972=await staff[_0xa8b701(0x219)]({'email':_0x1b948a[_0xa8b701(0x266)]}),_0x2f47c3=await suppliers[_0xa8b701(0x230)]({});let _0x1a5dbb;if(_0x1b948a[_0xa8b701(0x23c)]==_0xa8b701(0x1cc)){const _0xbce8c3=await staff['findOne']({'email':_0x1b948a[_0xa8b701(0x266)]});_0x1a5dbb=await warehouse[_0xa8b701(0x249)]([{'$match':{'status':_0xa8b701(0x1a8),'name':_0xbce8c3[_0xa8b701(0x224)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1a5dbb=await warehouse[_0xa8b701(0x249)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0xa8b701(0x1c5)}}}]);const _0x61c620=await product[_0xa8b701(0x230)]({}),_0x5e5e81=await warehouse[_0xa8b701(0x230)]({'status':'Enabled'}),_0x1926fb=await purchases_finished[_0xa8b701(0x230)]({}),_0x262b43=_0x1926fb[_0xa8b701(0x1cf)]+0x1,_0x21310b=_0xa8b701(0x259)+_0x262b43[_0xa8b701(0x2cc)]()[_0xa8b701(0x27a)](0x5,'0');var _0x3e9810=[_0xa8b701(0x1a9),_0xa8b701(0x1e5)];if(_0x2f95fb[0x0][_0xa8b701(0x24b)]==_0xa8b701(0x274))var _0x2b7f17=users['English'];else{if(_0x2f95fb[0x0]['language']==_0xa8b701(0x247))var _0x2b7f17=users[_0xa8b701(0x247)];else{if(_0x2f95fb[0x0][_0xa8b701(0x24b)]==_0xa8b701(0x231))var _0x2b7f17=users[_0xa8b701(0x231)];else{if(_0x2f95fb[0x0][_0xa8b701(0x24b)]==_0xa8b701(0x2d4))var _0x2b7f17=users['Spanish'];else{if(_0x2f95fb[0x0]['language']==_0xa8b701(0x287))var _0x2b7f17=users[_0xa8b701(0x287)];else{if(_0x2f95fb[0x0][_0xa8b701(0x24b)]==_0xa8b701(0x20e))var _0x2b7f17=users[_0xa8b701(0x2bf)];else{if(_0x2f95fb[0x0]['language']==_0xa8b701(0x21b))var _0x2b7f17=users[_0xa8b701(0x21b)];else{if(_0x2f95fb[0x0]['language']==_0xa8b701(0x2df))var _0x2b7f17=users[_0xa8b701(0x246)];}}}}}}}const _0x141cb3=getRandom8DigitNumber();_0x141cb3[_0xa8b701(0x29e)](_0x1a80b5=>{var _0x3f45d5=_0xa8b701;_0x225ce1[_0x3f45d5(0x212)]('add_purchases_finished_logs',{'success':_0x5d46a4[_0x3f45d5(0x2ac)](_0x3f45d5(0x1e9)),'errors':_0x5d46a4[_0x3f45d5(0x2ac)](_0x3f45d5(0x265)),'role':_0x1b948a,'profile':_0x25f55c,'suppliers':_0x2f47c3,'warehouse':_0x1a5dbb,'product':_0x61c620,'invoice':_0x1a80b5,'master_shop':_0x2f95fb,'language':_0x2b7f17,'find_data':_0x5e5e81,'rooms_data':_0x3e9810});})[_0xa8b701(0x1eb)](_0x1c3d67=>{var _0x289669=_0xa8b701;_0x5d46a4[_0x289669(0x2ac)](_0x289669(0x265),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x225ce1[_0x289669(0x2ae)]('/all_purchases_finished/view');});}catch(_0x424de7){console[_0xa8b701(0x2dd)](_0x424de7);}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x1c8),auth,async(_0xccf282,_0x18e741)=>{var _0x209de2=a0_0x48f119;try{const _0x2b70b3=_0xccf282[_0x209de2(0x2d0)]['id'];console[_0x209de2(0x2dd)](_0x2b70b3);const _0x3ee78e=await master_shop[_0x209de2(0x230)]();console[_0x209de2(0x2dd)](_0x209de2(0x2b6),_0x3ee78e);const _0x25723e=await product['findOne']({'name':_0x2b70b3});console[_0x209de2(0x2dd)](_0x209de2(0x295),_0x25723e),_0x18e741[_0x209de2(0x257)](0xc8)[_0x209de2(0x20b)]({'product_data':_0x25723e,'master':_0x3ee78e});}catch(_0x18e153){console[_0x209de2(0x2dd)](_0x209de2(0x29c),_0x18e153);}}),router['post'](a0_0x48f119(0x2be),auth,async(_0x2cd5e7,_0x56ca66)=>{var _0x37e8cf=a0_0x48f119;try{const {invoice:_0x27521d,date:_0xcaf589,warehouse_name:_0xc18159,prod_name:_0x16f599,note:_0xa5d24a,due_amount:_0x2f1ba8,Room_name:_0x43eddb,PO_number:_0x28bd40,SCRN:_0x277cb1,ReqBy:_0x4f2de6,dateofreq:_0x5d090d,suppliers:_0x2525bf,typeservicesData:_0x3b180f,van:_0x725522,typevehicle:_0x4fc13c,driver:_0x1a3dcb,plate:_0x25a670,DRSI:_0x43be85,TSU:_0x1ac287,TFU:_0x4b5e4e,JO_number:_0x416f7d,type_of_products:_0x21e2e1}=_0x2cd5e7['body'];if(typeof _0x16f599==_0x37e8cf(0x2bc))var _0x415435=[_0x2cd5e7['body'][_0x37e8cf(0x1d0)]],_0x4d0423=[_0x2cd5e7['body'][_0x37e8cf(0x208)]],_0x5701a6=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x1be)]],_0x59edbc=[_0x2cd5e7['body'][_0x37e8cf(0x1fb)]],_0x2a9219=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x24e)]],_0x5ddc98=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x239)]],_0x3346fd=[_0x2cd5e7['body'][_0x37e8cf(0x1bd)]],_0x16278d=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x241)]],_0x51b1eb=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x21e)]],_0x451943=[_0x2cd5e7['body'][_0x37e8cf(0x2b8)]],_0x5cbc22=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x23e)]],_0x329696=[_0x2cd5e7['body'][_0x37e8cf(0x280)]],_0x5a6159=[_0x2cd5e7['body'][_0x37e8cf(0x2a5)]],_0x1509d7=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x2dc)]],_0x3b47e6=[_0x2cd5e7[_0x37e8cf(0x2c0)]['RoomAssign']],_0x2281a3=[_0x2cd5e7[_0x37e8cf(0x2c0)]['gross_price']],_0x2e923d=[_0x2cd5e7[_0x37e8cf(0x2c0)]['uuid']],_0x49001e=[_0x2cd5e7[_0x37e8cf(0x2c0)]['sales_data_cateory']],_0x48e70f=[_0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x2c4)]];else var _0x415435=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x1d0)]],_0x4d0423=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x208)]],_0x5701a6=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x1be)]],_0x59edbc=[..._0x2cd5e7['body'][_0x37e8cf(0x1fb)]],_0x2a9219=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x24e)]],_0x5ddc98=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x239)]],_0x3346fd=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x1bd)]],_0x16278d=[..._0x2cd5e7['body'][_0x37e8cf(0x241)]],_0x51b1eb=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x21e)]],_0x451943=[..._0x2cd5e7['body'][_0x37e8cf(0x2b8)]],_0x5cbc22=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x23e)]],_0x329696=[..._0x2cd5e7['body'][_0x37e8cf(0x280)]],_0x5a6159=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x2a5)]],_0x1509d7=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x2dc)]],_0x3b47e6=[..._0x2cd5e7[_0x37e8cf(0x2c0)]['RoomAssign']],_0x2281a3=[..._0x2cd5e7['body'][_0x37e8cf(0x1c9)]],_0x2e923d=[..._0x2cd5e7['body'][_0x37e8cf(0x207)]],_0x49001e=[..._0x2cd5e7[_0x37e8cf(0x2c0)][_0x37e8cf(0x26b)]],_0x48e70f=[..._0x2cd5e7['body']['product_id']];const _0x53857c=_0x415435['map'](_0x1aa9d5=>{return _0x1aa9d5={'product_name':_0x1aa9d5};});_0x48e70f[_0x37e8cf(0x1cb)]((_0x40430d,_0x543d76)=>{var _0x5e6fb6=_0x37e8cf;_0x53857c[_0x543d76][_0x5e6fb6(0x2c4)]=_0x40430d,_0x53857c[_0x543d76][_0x5e6fb6(0x2a7)]=_0xcaf589;}),_0x49001e[_0x37e8cf(0x1cb)]((_0x292861,_0x329615)=>{var _0x1c4f23=_0x37e8cf;_0x53857c[_0x329615][_0x1c4f23(0x2e5)]=_0x292861;}),_0x4d0423[_0x37e8cf(0x1cb)]((_0x2c9d1a,_0x46410f)=>{var _0x3e1efc=_0x37e8cf;_0x53857c[_0x46410f][_0x3e1efc(0x240)]=_0x2c9d1a;}),_0x2e923d['forEach']((_0x5cc66e,_0xfb0dcd)=>{var _0x19c7a7=_0x37e8cf;_0x53857c[_0xfb0dcd][_0x19c7a7(0x207)]=_0x5cc66e;}),_0x5701a6[_0x37e8cf(0x1cb)]((_0x152f14,_0x37af76)=>{var _0xa1431=_0x37e8cf;_0x53857c[_0x37af76][_0xa1431(0x1e3)]=Math[_0xa1431(0x28b)](_0x152f14);}),_0x59edbc[_0x37e8cf(0x1cb)]((_0x5ef813,_0x4c24c7)=>{var _0x473599=_0x37e8cf;_0x53857c[_0x4c24c7][_0x473599(0x2c8)]=_0x5ef813;}),_0x2a9219[_0x37e8cf(0x1cb)]((_0x26461e,_0x5f108c)=>{var _0x582caa=_0x37e8cf;_0x53857c[_0x5f108c][_0x582caa(0x27c)]=_0x26461e;}),_0x3346fd[_0x37e8cf(0x1cb)]((_0xdb05a0,_0x16df7d)=>{var _0x328f93=_0x37e8cf;_0x53857c[_0x16df7d][_0x328f93(0x1bd)]=_0xdb05a0;}),_0x16278d[_0x37e8cf(0x1cb)]((_0x15b7af,_0x1c118b)=>{_0x53857c[_0x1c118b]['secondary_code']=_0x15b7af;}),_0x51b1eb['forEach']((_0x52a8fc,_0x47bd6e)=>{var _0x5bb943=_0x37e8cf;_0x53857c[_0x47bd6e][_0x5bb943(0x1ec)]=_0x52a8fc;}),_0x451943['forEach']((_0x424016,_0x2deb26)=>{var _0x5aa23d=_0x37e8cf;_0x53857c[_0x2deb26][_0x5aa23d(0x2b8)]=_0x424016;}),_0x5cbc22[_0x37e8cf(0x1cb)]((_0x4a9db3,_0x3feb19)=>{var _0x44e604=_0x37e8cf;_0x53857c[_0x3feb19][_0x44e604(0x23e)]=_0x4a9db3;}),_0x329696['forEach']((_0x142b84,_0x265185)=>{var _0x232342=_0x37e8cf;_0x53857c[_0x265185][_0x232342(0x22d)]=_0x142b84;}),_0x5a6159[_0x37e8cf(0x1cb)]((_0x433d56,_0x2f9c8d)=>{var _0x5dc6b0=_0x37e8cf;_0x53857c[_0x2f9c8d][_0x5dc6b0(0x1ce)]=_0x433d56;}),_0x1509d7[_0x37e8cf(0x1cb)]((_0x5cbc14,_0x36ceab)=>{var _0x3ca7d2=_0x37e8cf;_0x53857c[_0x36ceab][_0x3ca7d2(0x2b3)]=_0x5cbc14;}),_0x3b47e6['forEach']((_0x275cb4,_0x175942)=>{var _0x1d59b8=_0x37e8cf;_0x53857c[_0x175942][_0x1d59b8(0x2ba)]=_0x275cb4;}),_0x2281a3[_0x37e8cf(0x1cb)]((_0x186d0e,_0x1cb42d)=>{var _0x254c0c=_0x37e8cf;_0x53857c[_0x1cb42d][_0x254c0c(0x1c9)]=_0x186d0e;});const _0x1ad894=new invoice_for_incoming();await _0x1ad894[_0x37e8cf(0x1d8)]();for(let _0xc55b88=0x0;_0xc55b88<=_0x3b47e6[_0x37e8cf(0x1cf)]-0x1;_0xc55b88++){_0x53857c[_0xc55b88]['invoice']=_0x37e8cf(0x272)+_0x1ad894[_0x37e8cf(0x289)][_0x37e8cf(0x2cc)]()[_0x37e8cf(0x27a)](0x8,'0');}const _0x7957ca=await warehouse_validation_setup[_0x37e8cf(0x249)]([{'$match':{'warehouse_name':_0xc18159}}]);let _0x2762ad=[];for(let _0x3460e0=0x0;_0x3460e0<=_0x53857c['length']-0x1;_0x3460e0++){const _0x30abab=_0x53857c[_0x3460e0];for(let _0x37f343=0x0;_0x37f343<=_0x7957ca[_0x37e8cf(0x1cf)]-0x1;_0x37f343++){const _0x48b861=_0x7957ca[_0x37f343];for(let _0x46f7c2=0x0;_0x46f7c2<=_0x48b861[_0x37e8cf(0x1d5)][_0x37e8cf(0x1cf)]-0x1;_0x46f7c2++){const _0x48e6a9=_0x48b861[_0x37e8cf(0x1d5)][_0x46f7c2];if(_0x48e6a9[_0x37e8cf(0x240)]===_0x30abab[_0x37e8cf(0x240)]){let _0xe6624a=_0x30abab[_0x37e8cf(0x1e3)];const _0x1c748a=await warehouse[_0x37e8cf(0x249)]([{'$match':{'name':_0xc18159,'room':_0x48b861[_0x37e8cf(0x1e6)]}},{'$unwind':'$product_details'},{'$match':{'level':_0x48e6a9[_0x37e8cf(0x244)],'bay':_0x48e6a9[_0x37e8cf(0x201)]}}]);if(_0x1c748a[_0x37e8cf(0x1cf)]==0x0){for(let _0x2318e7=0x0;_0x2318e7<=_0x48b861['product_data'][_0x37e8cf(0x1cf)]-0x1&&_0xe6624a>0x0;_0x2318e7++){const _0x9dd1a1=_0x48b861[_0x37e8cf(0x1d5)][_0x2318e7];if(_0x30abab[_0x37e8cf(0x240)]===_0x9dd1a1[_0x37e8cf(0x240)]){_0x2762ad[_0x2318e7]={};const _0x56c424=parseInt(_0x9dd1a1[_0x37e8cf(0x2c1)]),_0x2f17b3=0x0;let _0x2d22fc=_0x56c424-_0x2f17b3,_0x5f48e8=Math[_0x37e8cf(0x1ac)](_0xe6624a,_0x2d22fc);console[_0x37e8cf(0x2dd)](_0x37e8cf(0x2c3)+_0x5f48e8+_0x37e8cf(0x27f)+_0x48b861['warehouse_name']+',\x20room:\x20'+_0x48b861[_0x37e8cf(0x1e6)]+',\x20bay:\x20'+_0x9dd1a1['bay']+_0x37e8cf(0x26a)+_0x9dd1a1[_0x37e8cf(0x201)]),_0x2762ad[_0x2318e7][_0x37e8cf(0x26e)]=_0x30abab[_0x37e8cf(0x26e)],_0x2762ad[_0x2318e7][_0x37e8cf(0x240)]=_0x30abab[_0x37e8cf(0x240)],_0x2762ad[_0x2318e7][_0x37e8cf(0x2c4)]=_0x30abab['product_id'],_0x2762ad[_0x2318e7][_0x37e8cf(0x2a7)]=_0x30abab['date_recieved'],_0x2762ad[_0x2318e7][_0x37e8cf(0x2e5)]=_0x30abab['sales_category'],_0x2762ad[_0x2318e7][_0x37e8cf(0x207)]=_0x30abab[_0x37e8cf(0x207)],_0x2762ad[_0x2318e7][_0x37e8cf(0x1e3)]=_0x5f48e8,_0x2762ad[_0x2318e7][_0x37e8cf(0x2c8)]=_0x30abab[_0x37e8cf(0x2c8)],_0x2762ad[_0x2318e7][_0x37e8cf(0x27c)]=_0x30abab[_0x37e8cf(0x27c)],_0x2762ad[_0x2318e7][_0x37e8cf(0x1bd)]=_0x30abab[_0x37e8cf(0x1bd)],_0x2762ad[_0x2318e7][_0x37e8cf(0x241)]=_0x30abab[_0x37e8cf(0x241)],_0x2762ad[_0x2318e7][_0x37e8cf(0x1ec)]=_0x30abab[_0x37e8cf(0x1ec)],_0x2762ad[_0x2318e7][_0x37e8cf(0x2b8)]=_0x30abab['batch_code'],_0x2762ad[_0x2318e7][_0x37e8cf(0x23e)]=_0x30abab[_0x37e8cf(0x23e)],_0x2762ad[_0x2318e7][_0x37e8cf(0x22d)]=_0x30abab[_0x37e8cf(0x22d)],_0x2762ad[_0x2318e7][_0x37e8cf(0x1ce)]=_0x30abab[_0x37e8cf(0x1ce)],_0x2762ad[_0x2318e7][_0x37e8cf(0x2b3)]=_0x30abab['product_cat'],_0x2762ad[_0x2318e7][_0x37e8cf(0x286)]=_0x30abab['invoice'],_0x2762ad[_0x2318e7][_0x37e8cf(0x1c9)]=_0x30abab['gross_price'],_0x2762ad[_0x2318e7]['room_name']=_0x48b861[_0x37e8cf(0x1e6)],_0x2762ad[_0x2318e7][_0x37e8cf(0x21c)]=_0x9dd1a1['bay'],_0x2762ad[_0x2318e7][_0x37e8cf(0x244)]=_0x9dd1a1['bin'],_0xe6624a-=_0x5f48e8;if(_0xe6624a<=0x0)break;}}if(_0xe6624a<=0x0)break;_0xe6624a>0x0&&console['log'](_0x37e8cf(0x1a5)+_0xe6624a+_0x37e8cf(0x209));}}}}}const _0x459999=_0x2762ad[_0x37e8cf(0x2de)]((_0x3345c4,_0x181226)=>{if(_0x181226>0x0)return{'item':_0x3345c4};}),_0x34347c=_0x459999[_0x37e8cf(0x2de)](_0x2e2620=>_0x2e2620['quantity']!=='0'&&_0x2e2620[_0x37e8cf(0x1e3)]!==''),_0x2da436=new purchases_finished({'invoice':_0x37e8cf(0x272)+_0x1ad894[_0x37e8cf(0x289)]['toString']()[_0x37e8cf(0x27a)](0x8,'0'),'suppliers':_0x2525bf,'date':_0xcaf589,'warehouse_name':_0xc18159,'product':_0x34347c,'note':_0xa5d24a,'due_amount':_0x2f1ba8,'room':_0x43eddb,'POnumber':_0x28bd40,'SCRN':_0x277cb1,'JO_number':_0x416f7d,'ReqBy':_0x4f2de6,'dateofreq':_0x5d090d,'typeservicesData':_0x3b180f,'van':_0x725522,'typevehicle':_0x4fc13c,'driver':_0x1a3dcb,'plate':_0x25a670,'DRSI':_0x43be85,'TSU':_0x1ac287,'TFU':_0x4b5e4e,'typeOfProducts':_0x21e2e1}),_0x3d444c=await _0x2da436[_0x37e8cf(0x1d8)](),_0x213d14=await purchases_finished['findOne']({'_id':_0x3d444c[_0x37e8cf(0x251)]['valueOf']()});_0x2cd5e7['flash']('success',_0x37e8cf(0x1d7)),_0x56ca66[_0x37e8cf(0x2ae)]('/all_purchases_finished/process/'+_0x213d14['_id'][_0x37e8cf(0x1b6)]());}catch(_0x50c15d){console['log'](_0x50c15d);}}),router['get'](a0_0x48f119(0x1c2),auth,async(_0x3ef572,_0x581830)=>{var _0x57af44=a0_0x48f119;try{const {username:_0x1fdf34,email:_0xb71e87,role:_0x4002c9}=_0x3ef572['user'],_0x236368=_0x3ef572['user'],_0x2512f5=_0x3ef572[_0x57af44(0x2d0)]['id'],_0x448da3=await profile['findOne']({'email':_0x236368[_0x57af44(0x266)]}),_0x1c9c4b=await master_shop[_0x57af44(0x230)](),_0x5ca78f=await staff[_0x57af44(0x219)]({'email':_0x236368['email']}),_0x554895=await suppliers['find']({});let _0x4140cf;if(_0x236368['role']==_0x57af44(0x1cc)){const _0x21039a=await staff[_0x57af44(0x219)]({'email':_0x236368[_0x57af44(0x266)]});_0x4140cf=await warehouse['aggregate']([{'$match':{'status':_0x57af44(0x1a8),'name':_0x21039a['warehouse']}},{'$group':{'_id':_0x57af44(0x1c5),'name':{'$first':_0x57af44(0x1c5)}}}]);}else _0x4140cf=await warehouse['aggregate']([{'$match':{'status':_0x57af44(0x1a8)}},{'$group':{'_id':_0x57af44(0x1c5),'name':{'$first':_0x57af44(0x1c5)}}}]);const _0x46e80d=await purchases_finished['findById'](_0x2512f5);if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x274))var _0x4a6edd=users[_0x57af44(0x2a2)];else{if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x247))var _0x4a6edd=users[_0x57af44(0x247)];else{if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x231))var _0x4a6edd=users[_0x57af44(0x231)];else{if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x2d4))var _0x4a6edd=users[_0x57af44(0x2d4)];else{if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x287))var _0x4a6edd=users[_0x57af44(0x287)];else{if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x20e))var _0x4a6edd=users[_0x57af44(0x2bf)];else{if(_0x1c9c4b[0x0]['language']==_0x57af44(0x21b))var _0x4a6edd=users[_0x57af44(0x21b)];else{if(_0x1c9c4b[0x0][_0x57af44(0x24b)]==_0x57af44(0x2df))var _0x4a6edd=users[_0x57af44(0x246)];}}}}}}}_0x581830[_0x57af44(0x212)](_0x57af44(0x1f3),{'success':_0x3ef572[_0x57af44(0x2ac)](_0x57af44(0x1e9)),'errors':_0x3ef572['flash'](_0x57af44(0x265)),'role':_0x236368,'profile':_0x448da3,'suppliers':_0x554895,'warehouse':_0x4140cf,'master_shop':_0x1c9c4b,'language':_0x4a6edd,'purchases_data':_0x46e80d});}catch(_0x411dd5){console['log'](_0x411dd5);}});async function get_warehouse_data(_0x567cd2,_0x23c160){var _0x55153e=a0_0x48f119;try{const _0x432ef7=await warehouse_temporary[_0x55153e(0x219)]({'name':_0x567cd2,'room':_0x23c160});if(!_0x432ef7){const _0x4569ef=new warehouse_temporary({'name':_0x567cd2,'address':_0x567cd2,'status':_0x55153e(0x1a8),'room':_0x23c160,'isStaging':_0x55153e(0x1f7)});return await _0x4569ef['save'](),_0x4569ef;}else return _0x432ef7;}catch(_0x17d01e){console[_0x55153e(0x220)](_0x55153e(0x2e1),_0x17d01e);throw _0x17d01e;}}router['post'](a0_0x48f119(0x1c2),auth,async(_0x4c1153,_0x1baf33)=>{var _0x53f0db=a0_0x48f119;try{const _0x1b6945=_0x4c1153[_0x53f0db(0x2d0)]['id'],_0x3eb730=await purchases_finished[_0x53f0db(0x298)](_0x1b6945);let _0x100a38=[];_0x3eb730[_0x53f0db(0x295)]['forEach']((_0x38d966,_0x387bb0)=>{var _0x21d967=_0x53f0db;_0x100a38[_0x387bb0]={},_0x100a38[_0x387bb0][_0x21d967(0x224)]=_0x3eb730[_0x21d967(0x25f)],_0x100a38[_0x387bb0][_0x21d967(0x2c4)]=_0x38d966[_0x21d967(0x2c4)],_0x100a38[_0x387bb0][_0x21d967(0x26e)]=_0x38d966['product_name'],_0x100a38[_0x387bb0][_0x21d967(0x240)]=_0x38d966['product_code'],_0x100a38[_0x387bb0][_0x21d967(0x1e3)]=_0x38d966[_0x21d967(0x1e3)],_0x100a38[_0x387bb0][_0x21d967(0x2c8)]=_0x38d966['standard_unit'],_0x100a38[_0x387bb0][_0x21d967(0x27c)]=_0x38d966[_0x21d967(0x27c)],_0x100a38[_0x387bb0][_0x21d967(0x21c)]=_0x38d966[_0x21d967(0x21c)],_0x100a38[_0x387bb0][_0x21d967(0x244)]=_0x38d966['bay'],_0x100a38[_0x387bb0]['primary_code']=_0x38d966[_0x21d967(0x1bd)],_0x100a38[_0x387bb0][_0x21d967(0x241)]=_0x38d966['secondary_code'],_0x100a38[_0x387bb0][_0x21d967(0x1ec)]=_0x38d966[_0x21d967(0x1ec)],_0x100a38[_0x387bb0][_0x21d967(0x2b8)]=_0x38d966[_0x21d967(0x2b8)],_0x100a38[_0x387bb0]['expiry_date']=_0x38d966[_0x21d967(0x23e)],_0x100a38[_0x387bb0][_0x21d967(0x22d)]=_0x38d966[_0x21d967(0x22d)],_0x100a38[_0x387bb0][_0x21d967(0x1ce)]=_0x38d966[_0x21d967(0x1ce)],_0x100a38[_0x387bb0][_0x21d967(0x2b3)]=_0x38d966[_0x21d967(0x2b3)],_0x100a38[_0x387bb0]['room_name']=_0x38d966[_0x21d967(0x2ba)],_0x100a38[_0x387bb0][_0x21d967(0x286)]=_0x38d966[_0x21d967(0x286)],_0x100a38[_0x387bb0][_0x21d967(0x207)]=_0x38d966[_0x21d967(0x207)],_0x100a38[_0x387bb0][_0x21d967(0x1c9)]=_0x38d966[_0x21d967(0x1c9)],_0x100a38[_0x387bb0]['sales_category']=_0x38d966[_0x21d967(0x2e5)],_0x100a38[_0x387bb0][_0x21d967(0x2a7)]=_0x38d966[_0x21d967(0x2a7)],_0x100a38[_0x387bb0]['purchases_id']=_0x38d966['_id'][_0x21d967(0x1b6)]();});for(let _0x57a368=0x0;_0x57a368<=_0x100a38[_0x53f0db(0x1cf)]-0x1;_0x57a368++){const _0x5092cc=_0x100a38[_0x57a368],_0x1943e5=new warehouse_temporary(_0x5092cc);await _0x1943e5['save']();}_0x3eb730[_0x53f0db(0x29a)]=_0x53f0db(0x213),await _0x3eb730[_0x53f0db(0x1d8)](),_0x4c1153[_0x53f0db(0x2ac)](_0x53f0db(0x1e9),_0x53f0db(0x1f9)),_0x1baf33[_0x53f0db(0x2ae)](_0x53f0db(0x26d)+_0x3eb730['_id'][_0x53f0db(0x1b6)]());}catch(_0x2bed0c){}}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x2ad),auth,async(_0x3cf131,_0x171ea2)=>{var _0x99e963=a0_0x48f119;try{const {invoice:_0x1fef94,date:_0x473740,warehouse_name:_0x4ae75d,prod_name:_0x809af2,note:_0x38d21d,due_amount:_0x42b8f7,Room_name:_0x2fcfac,PO_number:_0x522038,SCRN:_0x50e92a,ReqBy:_0x5d433f,dateofreq:_0x49f410,suppliers:_0x54ea6b,typeservicesData:_0x422aa5,van:_0x128012,typevehicle:_0x20146f,driver:_0x1dd72c,plate:_0x5745ff,DRSI:_0x12a85b,TSU:_0x54c995,TFU:_0x1688cf,JO_number:_0x2cdaf9,type_of_products:_0x1f8bde}=_0x3cf131[_0x99e963(0x2c0)];if(typeof _0x809af2==_0x99e963(0x2bc))var _0x540daa=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1d0)]],_0x3ec5e6=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x208)]],_0x1ab497=[_0x3cf131[_0x99e963(0x2c0)]['prod_Qty']],_0x11f834=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1fb)]],_0x13b138=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x24e)]],_0x371a50=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x239)]],_0x461897=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1bd)]],_0x12393f=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x241)]],_0x4e7bbe=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x21e)]],_0x140e44=[_0x3cf131['body'][_0x99e963(0x2b8)]],_0x463c1d=[_0x3cf131['body']['expiry_date']],_0x528b7f=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x280)]],_0x3cfaf4=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x2a5)]],_0x4963fd=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x2dc)]],_0xb75e31=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x203)]],_0x5f2544=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1c9)]],_0x92e64f=[_0x3cf131[_0x99e963(0x2c0)]['uuid']],_0x58a2a3=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x26b)]],_0x591390=[_0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x2c7)]];else var _0x540daa=[..._0x3cf131['body'][_0x99e963(0x1d0)]],_0x3ec5e6=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x208)]],_0x1ab497=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1be)]],_0x11f834=[..._0x3cf131['body'][_0x99e963(0x1fb)]],_0x13b138=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x24e)]],_0x371a50=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x239)]],_0x461897=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1bd)]],_0x12393f=[..._0x3cf131['body'][_0x99e963(0x241)]],_0x4e7bbe=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x21e)]],_0x140e44=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x2b8)]],_0x463c1d=[..._0x3cf131['body'][_0x99e963(0x23e)]],_0x528b7f=[..._0x3cf131['body'][_0x99e963(0x280)]],_0x3cfaf4=[..._0x3cf131['body'][_0x99e963(0x2a5)]],_0x4963fd=[..._0x3cf131['body']['prod_cat']],_0xb75e31=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x203)]],_0x5f2544=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x1c9)]],_0x92e64f=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x207)]],_0x58a2a3=[..._0x3cf131[_0x99e963(0x2c0)][_0x99e963(0x26b)]],_0x591390=[..._0x3cf131[_0x99e963(0x2c0)]['type_of_products_type']];const _0xf17f92=_0x540daa[_0x99e963(0x2e3)](_0x241dd2=>{return _0x241dd2={'product_name':_0x241dd2};});_0x591390[_0x99e963(0x1cb)]((_0x247c1e,_0x41c4ba)=>{var _0x14585b=_0x99e963;_0xf17f92[_0x41c4ba][_0x14585b(0x1fc)]=_0x247c1e;}),_0x58a2a3[_0x99e963(0x1cb)]((_0x30cf27,_0x41bf8b)=>{var _0x4b7093=_0x99e963;_0xf17f92[_0x41bf8b][_0x4b7093(0x2e5)]=_0x30cf27;}),_0x3ec5e6['forEach']((_0x43526e,_0x693457)=>{var _0x537e14=_0x99e963;_0xf17f92[_0x693457][_0x537e14(0x240)]=_0x43526e;}),_0x92e64f['forEach']((_0x2581a7,_0xf6dd60)=>{var _0xee6b38=_0x99e963;_0xf17f92[_0xf6dd60][_0xee6b38(0x207)]=_0x2581a7;}),_0x1ab497[_0x99e963(0x1cb)]((_0x1aa55a,_0x24c18d)=>{var _0x2d550c=_0x99e963;_0xf17f92[_0x24c18d][_0x2d550c(0x1e3)]=Math[_0x2d550c(0x28b)](_0x1aa55a);}),_0x11f834[_0x99e963(0x1cb)]((_0x41f468,_0x40dd8c)=>{var _0xd71fc4=_0x99e963;_0xf17f92[_0x40dd8c][_0xd71fc4(0x2c8)]=_0x41f468;}),_0x13b138[_0x99e963(0x1cb)]((_0x53b78f,_0x2af136)=>{var _0x48700=_0x99e963;_0xf17f92[_0x2af136][_0x48700(0x27c)]=_0x53b78f;}),_0x371a50[_0x99e963(0x1cb)]((_0x4f5999,_0x1c02c6)=>{var _0x1a0422=_0x99e963,_0xbdee1e=_0x4f5999[_0x1a0422(0x2b7)](/[A-Za-z]+/)[0x0],_0x5215db=parseInt(_0x4f5999['match'](/\d+/)[0x0]);_0xf17f92[_0x1c02c6]['level']=_0xbdee1e,_0xf17f92[_0x1c02c6][_0x1a0422(0x244)]=_0x5215db;}),_0x461897['forEach']((_0x513ecd,_0x5f3352)=>{var _0x2e2ee4=_0x99e963;_0xf17f92[_0x5f3352][_0x2e2ee4(0x1bd)]=_0x513ecd;}),_0x12393f[_0x99e963(0x1cb)]((_0x825ffb,_0x125df4)=>{var _0xabf1c6=_0x99e963;_0xf17f92[_0x125df4][_0xabf1c6(0x241)]=_0x825ffb;}),_0x4e7bbe[_0x99e963(0x1cb)]((_0x59a8f2,_0x3e3055)=>{var _0x48dad2=_0x99e963;_0xf17f92[_0x3e3055][_0x48dad2(0x1ec)]=_0x59a8f2;}),_0x140e44[_0x99e963(0x1cb)]((_0x5157f1,_0xf8b433)=>{var _0x29792a=_0x99e963;_0xf17f92[_0xf8b433][_0x29792a(0x2b8)]=_0x5157f1;}),_0x463c1d[_0x99e963(0x1cb)]((_0x1910be,_0x54f349)=>{var _0x12e545=_0x99e963;_0xf17f92[_0x54f349][_0x12e545(0x23e)]=_0x1910be;}),_0x528b7f[_0x99e963(0x1cb)]((_0x5a6e1c,_0x43a70b)=>{var _0x138e1a=_0x99e963;_0xf17f92[_0x43a70b][_0x138e1a(0x22d)]=_0x5a6e1c;}),_0x3cfaf4[_0x99e963(0x1cb)]((_0x17199e,_0x3d55c2)=>{var _0x321e13=_0x99e963;_0xf17f92[_0x3d55c2][_0x321e13(0x1ce)]=_0x17199e;}),_0x4963fd['forEach']((_0x91ebbd,_0x4cf5be)=>{_0xf17f92[_0x4cf5be]['product_cat']=_0x91ebbd;}),_0xb75e31['forEach']((_0x3de347,_0x2352c1)=>{var _0x539632=_0x99e963;_0xf17f92[_0x2352c1][_0x539632(0x2ba)]=_0x3de347;}),_0x5f2544[_0x99e963(0x1cb)]((_0x93dbe5,_0x253159)=>{_0xf17f92[_0x253159]['gross_price']=_0x93dbe5;});const _0x2c2305=new purchases_logs();await _0x2c2305[_0x99e963(0x1d8)]();for(let _0xb9f02a=0x0;_0xb9f02a<=_0xb75e31['length']-0x1;_0xb9f02a++){_0xf17f92[_0xb9f02a][_0x99e963(0x286)]=_0x99e963(0x269)+_0x2c2305[_0x99e963(0x289)]['toString']()['padStart'](0x8,'0');}const _0x2ea0fb=_0xf17f92[_0x99e963(0x2de)](_0x4f2cb0=>_0x4f2cb0[_0x99e963(0x1e3)]!=='0'&&_0x4f2cb0[_0x99e963(0x1e3)]!==''),_0x226e87=new purchases_finished({'invoice':'LOG-INC-'+_0x2c2305['invoice_init']['toString']()[_0x99e963(0x27a)](0x8,'0'),'suppliers':_0x54ea6b,'date':_0x473740,'warehouse_name':_0x4ae75d,'product':_0x2ea0fb,'note':_0x38d21d,'due_amount':_0x42b8f7,'room':_0x2fcfac,'POnumber':_0x522038,'SCRN':_0x50e92a,'JO_number':_0x2cdaf9,'ReqBy':_0x5d433f,'dateofreq':_0x49f410,'typeservicesData':_0x422aa5,'van':_0x128012,'typevehicle':_0x20146f,'driver':_0x1dd72c,'plate':_0x5745ff,'DRSI':_0x12a85b,'TSU':_0x54c995,'TFU':_0x1688cf,'typeOfProducts':_0x1f8bde}),_0x5a2536=await _0x226e87[_0x99e963(0x1d8)](),_0x3ce649=await purchases_finished[_0x99e963(0x219)]({'_id':_0x5a2536[_0x99e963(0x251)][_0x99e963(0x1b6)]()}),_0x30622e=_0x3ce649[_0x99e963(0x295)][_0x99e963(0x2e3)](async _0x3b3362=>{var _0x305a8c=_0x99e963;try{var _0x196754=await warehouse[_0x305a8c(0x219)]({'name':_0x4ae75d,'room':_0x3b3362[_0x305a8c(0x2ba)]}),_0x1cfb36=0x0;const _0x2d6a1b=_0x196754[_0x305a8c(0x236)][_0x305a8c(0x2e3)](_0x1bbc8d=>{var _0x43d63c=_0x305a8c;console[_0x43d63c(0x2dd)](_0x1bbc8d['product_name']+'=='+_0x3b3362[_0x43d63c(0x26e)]+'&&'+_0x1bbc8d['bay']+'=='+_0x3b3362[_0x43d63c(0x244)]+'&&'+_0x1bbc8d['expiry_date']+'=='+_0x3b3362['expiry_date']+'&&'+_0x1bbc8d[_0x43d63c(0x22d)]+'=='+_0x3b3362[_0x43d63c(0x22d)]+'&&'+_0x1bbc8d[_0x43d63c(0x2b8)]+'=='+_0x3b3362['batch_code']+'&&'+_0x1bbc8d[_0x43d63c(0x286)]+'=='+_0x3ce649[_0x43d63c(0x286)]),_0x1bbc8d[_0x43d63c(0x26e)]==_0x3b3362[_0x43d63c(0x26e)]&&_0x1bbc8d[_0x43d63c(0x244)]==_0x3b3362[_0x43d63c(0x244)]&&_0x1bbc8d[_0x43d63c(0x21c)]==_0x3b3362['level']&&_0x1bbc8d[_0x43d63c(0x23e)]==_0x3b3362[_0x43d63c(0x23e)]&&_0x1bbc8d[_0x43d63c(0x22d)]==_0x3b3362[_0x43d63c(0x22d)]&&_0x1bbc8d[_0x43d63c(0x2b8)]==_0x3b3362[_0x43d63c(0x2b8)]&&_0x1bbc8d[_0x43d63c(0x286)]==_0x3ce649[_0x43d63c(0x286)]&&(_0x1bbc8d[_0x43d63c(0x205)]=Math[_0x43d63c(0x28b)](_0x1bbc8d[_0x43d63c(0x205)])+Math['abs'](_0x3b3362['quantity']),_0x1cfb36++);});return _0x1cfb36==0x0&&(_0x196754['product_details']=_0x196754['product_details'][_0x305a8c(0x297)]({'product_name':_0x3b3362[_0x305a8c(0x26e)],'product_stock':Math[_0x305a8c(0x28b)](_0x3b3362['quantity']),'primary_code':_0x3b3362[_0x305a8c(0x1bd)],'secondary_code':_0x3b3362[_0x305a8c(0x241)],'product_code':_0x3b3362[_0x305a8c(0x240)],'bay':_0x3b3362[_0x305a8c(0x244)],'level':_0x3b3362[_0x305a8c(0x21c)],'maxProducts':_0x3b3362[_0x305a8c(0x1ec)],'unit':_0x3b3362[_0x305a8c(0x2c8)],'secondary_unit':_0x3b3362[_0x305a8c(0x27c)],'expiry_date':_0x3b3362[_0x305a8c(0x23e)],'production_date':_0x3b3362[_0x305a8c(0x22d)],'maxProducts':_0x3b3362[_0x305a8c(0x1ec)],'maxPerUnit':_0x3b3362[_0x305a8c(0x1ce)],'batch_code':_0x3b3362[_0x305a8c(0x2b8)],'product_cat':_0x3b3362[_0x305a8c(0x2b3)],'invoice':_0x3b3362['invoice'],'id_incoming':_0x3b3362[_0x305a8c(0x251)],'uuid':_0x3b3362[_0x305a8c(0x207)],'gross_price':_0x3b3362[_0x305a8c(0x1c9)],'sales_category':_0x3b3362[_0x305a8c(0x2e5)],'type_products':_0x3b3362['type_of_products']})),_0x196754;}catch(_0x1c1524){return console[_0x305a8c(0x220)](_0x305a8c(0x1ed),_0x1c1524),null;}});Promise[_0x99e963(0x1db)](_0x30622e)[_0x99e963(0x29e)](async _0x5935a5=>{var _0x27d693=_0x99e963;try{for(const _0x254d2f of _0x5935a5){await warehouse[_0x27d693(0x273)]({'_id':_0x254d2f[_0x27d693(0x251)]},{'$addToSet':{'product_details':{'$each':_0x254d2f['product_details']}}});}const _0x316e7a=await master_shop[_0x27d693(0x230)](),_0x54bb58=await email_settings['findOne'](),_0x210200=await supervisor_settings[_0x27d693(0x230)]();var _0x4bb301=_0x3ce649[_0x27d693(0x295)],_0x4c2a34='',_0x15b7ff;for(_0x15b7ff in _0x4bb301){var _0x14fa14='FG';_0x3ce649[_0x27d693(0x25f)]==_0x27d693(0x268)&&(_0x14fa14='DG'),_0x4c2a34+=_0x27d693(0x237)+_0x27d693(0x21f)+_0x4bb301[_0x15b7ff][_0x27d693(0x26e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bb301[_0x15b7ff]['product_code']+_0x27d693(0x242)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bb301[_0x15b7ff][_0x27d693(0x1e3)]+_0x27d693(0x242)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bb301[_0x15b7ff][_0x27d693(0x2c8)]+_0x27d693(0x242)+_0x27d693(0x21f)+_0x4bb301[_0x15b7ff]['secondary_unit']+_0x27d693(0x242)+_0x27d693(0x21f)+_0x3ce649['warehouse_name']+_0x27d693(0x242)+_0x27d693(0x21f)+_0x4bb301[_0x15b7ff][_0x27d693(0x2ba)]+_0x27d693(0x242)+_0x27d693(0x21f)+_0x14fa14+_0x4bb301[_0x15b7ff][_0x27d693(0x244)]+_0x27d693(0x242),_0x27d693(0x253);}let _0x2e8d69=nodemailer[_0x27d693(0x25b)]({'host':_0x54bb58['host'],'port':Number(_0x54bb58[_0x27d693(0x1ea)]),'secure':![],'auth':{'user':_0x54bb58[_0x27d693(0x266)],'pass':_0x54bb58[_0x27d693(0x27b)]}}),_0x2ddcec={'from':_0x54bb58[_0x27d693(0x266)],'to':_0x210200[0x0][_0x27d693(0x1c6)],'subject':_0x27d693(0x1ab),'attachments':[{'filename':_0x27d693(0x1c1),'path':__dirname+_0x27d693(0x293)+'/upload/'+_0x316e7a[0x0][_0x27d693(0x2d5)],'cid':_0x27d693(0x222)}],'html':_0x27d693(0x1dc)+'<html><head><title></title>'+_0x27d693(0x218)+_0x27d693(0x1c7)+_0x27d693(0x2e2)+_0x27d693(0x1c7)+_0x27d693(0x288)+'</div>'+_0x27d693(0x1c7)+_0x27d693(0x2a9)+_0x316e7a[0x0][_0x27d693(0x1bc)]+_0x27d693(0x2b2)+_0x27d693(0x23d)+_0x27d693(0x23d)+_0x27d693(0x229)+_0x27d693(0x1c7)+_0x27d693(0x1f8)+'\x20Order\x20Number\x20:\x20'+_0x3ce649['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x3ce649[_0x27d693(0x1e0)]+'\x20'+_0x27d693(0x245)+_0x27d693(0x20a)+_0x27d693(0x23d)+_0x27d693(0x228)+_0x27d693(0x24f)+_0x27d693(0x237)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x27d693(0x215)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x27d693(0x200)+_0x27d693(0x23a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x27d693(0x2c2)+_0x27d693(0x1fa)+_0x27d693(0x253)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4c2a34+'\x20'+_0x27d693(0x1f5)+_0x27d693(0x2ab)+_0x27d693(0x1c7)+'<strong>\x20Regards\x20</strong>'+_0x27d693(0x2bb)+_0x316e7a[0x0]['site_title']+'</h5>'+_0x27d693(0x23d)+_0x27d693(0x23d)+_0x27d693(0x255)};_0x2e8d69[_0x27d693(0x1dd)](_0x2ddcec,function(_0x36422a,_0x55a460){var _0x38b010=_0x27d693;_0x36422a?(console[_0x38b010(0x2dd)](_0x36422a),console[_0x38b010(0x2dd)](_0x38b010(0x225))):console[_0x38b010(0x2dd)]('Email\x20sent\x20successfully');});}catch(_0x3c69c0){console['error'](_0x3c69c0),_0x171ea2[_0x27d693(0x257)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x3c69c0[_0x27d693(0x2bd)]});}})[_0x99e963(0x1eb)](_0x7f01a5=>{var _0x5ec472=_0x99e963;console[_0x5ec472(0x220)](_0x7f01a5);}),_0x3cf131['flash']('success',_0x99e963(0x1d7)),_0x171ea2[_0x99e963(0x2ae)](_0x99e963(0x28d)+_0x3ce649[_0x99e963(0x251)][_0x99e963(0x1b6)]());}catch(_0x4f1e4a){console['log'](_0x4f1e4a);}}),router['get'](a0_0x48f119(0x29f),auth,async(_0x2fca01,_0x5bb6e9)=>{var _0x52e015=a0_0x48f119;try{const {username:_0x525ff9,email:_0x522640,role:_0x5eb17a}=_0x2fca01['user'],_0x468295=_0x2fca01[_0x52e015(0x2c6)],_0x10257a=await profile[_0x52e015(0x219)]({'email':_0x468295['email']}),_0x438404=await master_shop[_0x52e015(0x230)](),_0xb2063e=_0x2fca01[_0x52e015(0x2d0)]['id'],_0x24b12=await purchases_finished['findById'](_0xb2063e),_0x32e130=await suppliers[_0x52e015(0x230)]({});let _0x35aa03;if(_0x468295['role']==_0x52e015(0x1cc)){const _0x2284d8=await staff[_0x52e015(0x219)]({'email':_0x468295[_0x52e015(0x266)]});_0x35aa03=await warehouse['find']({'status':'Enabled','name':_0x2284d8['warehouse'],'warehouse_category':_0x52e015(0x29d)});}else _0x35aa03=await warehouse[_0x52e015(0x249)]([{'$match':{'status':_0x52e015(0x1a8),'warehouse_category':_0x52e015(0x29d)}},{'$group':{'_id':_0x52e015(0x1c5),'name':{'$first':_0x52e015(0x1c5)}}}]);const _0x956e3f=await product['find']({}),_0x1d6fde=BayBinSelected(_0x24b12['warehouse_name'],_0x24b12[_0x52e015(0x1e6)]);let _0x152e6a=new Date(_0x24b12[_0x52e015(0x23e)]),_0x1a694c=('0'+_0x152e6a[_0x52e015(0x256)]())['slice'](-0x2),_0x2337a0=('0'+(_0x152e6a[_0x52e015(0x27d)]()+0x1))['slice'](-0x2),_0x4fbc5f=_0x152e6a['getFullYear'](),_0x4bb8ea=_0x4fbc5f+'-'+_0x2337a0+'-'+_0x1a694c;if(_0x438404[0x0][_0x52e015(0x24b)]=='English\x20(US)'){var _0x1412a7=users[_0x52e015(0x2a2)];console[_0x52e015(0x2dd)](_0x1412a7);}else{if(_0x438404[0x0][_0x52e015(0x24b)]=='Hindi')var _0x1412a7=users[_0x52e015(0x247)];else{if(_0x438404[0x0][_0x52e015(0x24b)]=='German')var _0x1412a7=users[_0x52e015(0x231)];else{if(_0x438404[0x0]['language']==_0x52e015(0x2d4))var _0x1412a7=users[_0x52e015(0x2d4)];else{if(_0x438404[0x0][_0x52e015(0x24b)]==_0x52e015(0x287))var _0x1412a7=users['French'];else{if(_0x438404[0x0]['language']==_0x52e015(0x20e))var _0x1412a7=users[_0x52e015(0x2bf)];else{if(_0x438404[0x0]['language']=='Chinese')var _0x1412a7=users['Chinese'];else{if(_0x438404[0x0][_0x52e015(0x24b)]==_0x52e015(0x2df))var _0x1412a7=users[_0x52e015(0x246)];}}}}}}}_0x5bb6e9[_0x52e015(0x212)](_0x52e015(0x1cd),{'success':_0x2fca01[_0x52e015(0x2ac)]('success'),'errors':_0x2fca01[_0x52e015(0x2ac)](_0x52e015(0x265)),'role':_0x468295,'profile':_0x10257a,'purchases':_0x24b12,'suppliers':_0x32e130,'warehouse':_0x35aa03,'product':_0x956e3f,'master_shop':_0x438404,'language':_0x1412a7,'ed_fullDate':_0x4bb8ea,'dataSelected':_0x1d6fde});}catch(_0x36a66e){console[_0x52e015(0x2dd)](_0x36a66e);}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x1b8),auth,async(_0x478a1f,_0x5a7845)=>{var _0x5b075e=a0_0x48f119;try{const {username:_0x5aab28,email:_0xd8e447,role:_0x25a49c}=_0x478a1f[_0x5b075e(0x2c6)],_0x111246=_0x478a1f[_0x5b075e(0x2c6)],_0x20c64a=await profile[_0x5b075e(0x219)]({'email':_0x111246['email']}),_0x298977=await master_shop[_0x5b075e(0x230)](),_0x4c82a4=_0x478a1f[_0x5b075e(0x2d0)]['id'],_0x473d6d=await purchases_finished[_0x5b075e(0x298)](_0x4c82a4),_0x27bf4c=await suppliers[_0x5b075e(0x230)]({});let _0x52ac2d;if(_0x111246[_0x5b075e(0x23c)]==_0x5b075e(0x1cc)){const _0x3c97a1=await staff[_0x5b075e(0x219)]({'email':_0x111246[_0x5b075e(0x266)]});_0x52ac2d=await warehouse['find']({'status':_0x5b075e(0x1a8),'name':_0x3c97a1[_0x5b075e(0x224)],'warehouse_category':_0x5b075e(0x29d)});}else _0x52ac2d=await warehouse['aggregate']([{'$match':{'status':_0x5b075e(0x1a8),'warehouse_category':_0x5b075e(0x29d)}},{'$group':{'_id':_0x5b075e(0x1c5),'name':{'$first':_0x5b075e(0x1c5)}}}]);const _0xfce1ff=await product[_0x5b075e(0x230)]({}),_0x2082d8=BayBinSelected(_0x473d6d[_0x5b075e(0x25f)],_0x473d6d[_0x5b075e(0x1e6)]);let _0x809dd0=new Date(_0x473d6d[_0x5b075e(0x23e)]),_0xad5506=('0'+_0x809dd0[_0x5b075e(0x256)]())['slice'](-0x2),_0x4ba5cb=('0'+(_0x809dd0['getMonth']()+0x1))[_0x5b075e(0x206)](-0x2),_0x1b1f64=_0x809dd0[_0x5b075e(0x1b1)](),_0x571c19=_0x1b1f64+'-'+_0x4ba5cb+'-'+_0xad5506;if(_0x298977[0x0][_0x5b075e(0x24b)]=='English\x20(US)'){var _0x2a68f3=users[_0x5b075e(0x2a2)];console[_0x5b075e(0x2dd)](_0x2a68f3);}else{if(_0x298977[0x0]['language']=='Hindi')var _0x2a68f3=users[_0x5b075e(0x247)];else{if(_0x298977[0x0][_0x5b075e(0x24b)]==_0x5b075e(0x231))var _0x2a68f3=users[_0x5b075e(0x231)];else{if(_0x298977[0x0][_0x5b075e(0x24b)]==_0x5b075e(0x2d4))var _0x2a68f3=users[_0x5b075e(0x2d4)];else{if(_0x298977[0x0][_0x5b075e(0x24b)]=='French')var _0x2a68f3=users[_0x5b075e(0x287)];else{if(_0x298977[0x0][_0x5b075e(0x24b)]=='Portuguese\x20(BR)')var _0x2a68f3=users['Portuguese'];else{if(_0x298977[0x0][_0x5b075e(0x24b)]==_0x5b075e(0x21b))var _0x2a68f3=users['Chinese'];else{if(_0x298977[0x0][_0x5b075e(0x24b)]==_0x5b075e(0x2df))var _0x2a68f3=users[_0x5b075e(0x246)];}}}}}}}_0x5a7845[_0x5b075e(0x212)](_0x5b075e(0x2b5),{'success':_0x478a1f['flash'](_0x5b075e(0x1e9)),'errors':_0x478a1f[_0x5b075e(0x2ac)](_0x5b075e(0x265)),'role':_0x111246,'profile':_0x20c64a,'purchases':_0x473d6d,'suppliers':_0x27bf4c,'warehouse':_0x52ac2d,'product':_0xfce1ff,'master_shop':_0x298977,'language':_0x2a68f3,'ed_fullDate':_0x571c19,'dataSelected':_0x2082d8});}catch(_0x2f3ee2){console[_0x5b075e(0x2dd)](_0x2f3ee2);}}),router['post']('/view/:id',auth,async(_0x1e701a,_0x42781c)=>{var _0x3b55a0=a0_0x48f119;try{const _0x47a558=_0x1e701a['params']['id'],_0x2c5bc0=await purchases_finished[_0x3b55a0(0x219)]({'_id':_0x1e701a['params']['id']}),_0x1ddc1e=await warehouse['findOne']({'name':_0x2c5bc0[_0x3b55a0(0x25f)],'room':_0x2c5bc0[_0x3b55a0(0x1e6)]});_0x2c5bc0[_0x3b55a0(0x295)][_0x3b55a0(0x1cb)](_0x59042d=>{var _0x4571c8=_0x3b55a0;const _0x11a13b=_0x1ddc1e[_0x4571c8(0x236)][_0x4571c8(0x2e3)](_0x1683e2=>{var _0x4f7399=_0x4571c8;_0x1683e2[_0x4f7399(0x26e)]==_0x59042d[_0x4f7399(0x26e)]&&_0x1683e2['bay']==_0x59042d[_0x4f7399(0x244)]&&(_0x1683e2[_0x4f7399(0x205)]=parseInt(_0x1683e2['product_stock'])-parseInt(_0x59042d[_0x4f7399(0x1e3)]));});}),await _0x1ddc1e[_0x3b55a0(0x1d8)]();const {invoice:_0x14284e,suppliers:_0x548c65,date:_0x571c25,warehouse_name:_0x29460d,prod_name:_0x22fbbf,prod_code:_0x119978,prod_qty:_0x20a50c,prod_unit:_0x2d3ad6,prod_secondunit:_0x4bcbee,prod_level:_0x2fb5dc,prod_isle:_0x237b0e,prod_pallet:_0x43e569,note:_0x3ba750,expiry_date:_0x56af54,batch_code:_0x5b4eea,paid_amount:_0xfe293e,due_amount:_0x5ba581,Room_name:_0x4960d7,primary_code:_0x3598aa,secondary_code:_0x4a51e0,PO_number:_0x1198cb,JO_number:_0x313392}=_0x1e701a[_0x3b55a0(0x2c0)];if(typeof _0x22fbbf=='string')var _0x5d0203=[_0x1e701a['body'][_0x3b55a0(0x1d0)]],_0x496d86=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x208)]],_0x35637f=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x278)]],_0x218106=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x216)]],_0x49ed33=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x24e)]],_0x5a1605=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x239)]],_0x3beaf8=[_0x1e701a['body'][_0x3b55a0(0x1bd)]],_0x4fbff4=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x241)]],_0x5a692b=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x21e)]],_0x11ce2a=[_0x1e701a['body'][_0x3b55a0(0x2b8)]],_0x1d589b=[_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x23e)]];else var _0x5d0203=[..._0x1e701a[_0x3b55a0(0x2c0)]['prod_name']],_0x496d86=[..._0x1e701a['body'][_0x3b55a0(0x208)]],_0x35637f=[..._0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x278)]],_0x218106=[..._0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x216)]],_0x49ed33=[..._0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x24e)]],_0x5a1605=[..._0x1e701a['body'][_0x3b55a0(0x239)]],_0x3beaf8=[..._0x1e701a['body']['primary_code']],_0x4fbff4=[..._0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x241)]],_0x5a692b=[..._0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x21e)]],_0x11ce2a=[..._0x1e701a[_0x3b55a0(0x2c0)]['batch_code']],_0x1d589b=[..._0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x23e)]];const _0x2cccd5=_0x5d0203[_0x3b55a0(0x2e3)](_0x2139f7=>{return _0x2139f7={'product_name':_0x2139f7};});_0x496d86['forEach']((_0x45cd48,_0x57577c)=>{var _0x3ea902=_0x3b55a0;_0x2cccd5[_0x57577c][_0x3ea902(0x240)]=_0x45cd48;}),_0x35637f[_0x3b55a0(0x1cb)]((_0x32814e,_0x4772d8)=>{_0x2cccd5[_0x4772d8]['quantity']=_0x32814e;}),_0x218106['forEach']((_0x50e75d,_0x183db5)=>{var _0x1621e4=_0x3b55a0;_0x2cccd5[_0x183db5][_0x1621e4(0x2c8)]=_0x50e75d;}),_0x49ed33[_0x3b55a0(0x1cb)]((_0x455fbf,_0x529083)=>{var _0x5199be=_0x3b55a0;_0x2cccd5[_0x529083][_0x5199be(0x27c)]=_0x455fbf;}),_0x5a1605[_0x3b55a0(0x1cb)]((_0x4c16c8,_0x598de0)=>{var _0x34b41=_0x3b55a0;_0x2cccd5[_0x598de0][_0x34b41(0x244)]=_0x4c16c8;}),_0x3beaf8[_0x3b55a0(0x1cb)]((_0x4d8824,_0x20d01f)=>{var _0x1f6172=_0x3b55a0;_0x2cccd5[_0x20d01f][_0x1f6172(0x1bd)]=_0x4d8824;}),_0x4fbff4[_0x3b55a0(0x1cb)]((_0x2593eb,_0x47718d)=>{var _0x2df4eb=_0x3b55a0;_0x2cccd5[_0x47718d][_0x2df4eb(0x241)]=_0x2593eb;}),_0x5a692b[_0x3b55a0(0x1cb)]((_0x43db73,_0x5a0ca3)=>{var _0x21ffc9=_0x3b55a0;_0x2cccd5[_0x5a0ca3][_0x21ffc9(0x1ec)]=_0x43db73;}),_0x11ce2a[_0x3b55a0(0x1cb)]((_0x573dc7,_0x280184)=>{var _0x57dc3f=_0x3b55a0;_0x2cccd5[_0x280184][_0x57dc3f(0x2b8)]=_0x573dc7;}),_0x1d589b[_0x3b55a0(0x1cb)]((_0x33c5a9,_0x21041f)=>{_0x2cccd5[_0x21041f]['expiry_date']=_0x33c5a9;});const _0x399ed9=_0x2cccd5[_0x3b55a0(0x2de)](_0x5063db=>_0x5063db[_0x3b55a0(0x1e3)]!=='0'&&_0x5063db[_0x3b55a0(0x1e3)]!=='');_0x2c5bc0[_0x3b55a0(0x286)]=_0x14284e,_0x2c5bc0['suppliers']=_0x548c65,_0x2c5bc0[_0x3b55a0(0x1e0)]=_0x571c25,_0x2c5bc0['warehouse_name']=_0x29460d,_0x2c5bc0[_0x3b55a0(0x295)]=_0x399ed9,_0x2c5bc0[_0x3b55a0(0x1e8)]=_0x3ba750,_0x2c5bc0[_0x3b55a0(0x2b4)]=_0xfe293e,_0x2c5bc0[_0x3b55a0(0x1f0)]=_0x5ba581,_0x2c5bc0[_0x3b55a0(0x1e6)]=_0x4960d7,_0x2c5bc0[_0x3b55a0(0x217)]=_0x1198cb,_0x2c5bc0[_0x3b55a0(0x2e4)]=_0x313392;const _0x309dcd=await _0x2c5bc0[_0x3b55a0(0x1d8)](),_0x2c3ac2=await warehouse['findOne']({'name':_0x1e701a[_0x3b55a0(0x2c0)]['warehouse_name'],'room':_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x227)]});_0x2c5bc0[_0x3b55a0(0x295)]['forEach'](_0x1ff972=>{var _0x1957c0=_0x3b55a0,_0x3e2e09=0x0;const _0x31edb5=_0x2c3ac2[_0x1957c0(0x236)][_0x1957c0(0x2e3)](_0x3c81a0=>{var _0x187c60=_0x1957c0;_0x3c81a0[_0x187c60(0x26e)]==_0x1ff972[_0x187c60(0x26e)]&&_0x3c81a0[_0x187c60(0x244)]==_0x1ff972[_0x187c60(0x244)]&&(_0x3c81a0['product_stock']=parseInt(_0x3c81a0[_0x187c60(0x205)])+parseInt(_0x1ff972[_0x187c60(0x1e3)]),_0x3e2e09++);});_0x3e2e09=='0'&&(_0x2c3ac2[_0x1957c0(0x236)]=_0x2c3ac2[_0x1957c0(0x236)][_0x1957c0(0x297)]({'product_name':_0x1ff972[_0x1957c0(0x26e)],'product_stock':_0x1ff972[_0x1957c0(0x1e3)],'primary_code':_0x1ff972['primary_code'],'secondary_code':_0x1ff972[_0x1957c0(0x241)],'product_code':_0x1ff972['product_code'],'bay':_0x1ff972[_0x1957c0(0x244)],'maxProducts':_0x1ff972[_0x1957c0(0x1ec)],'unit':_0x1ff972['standard_unit'],'secondary_unit':_0x1ff972[_0x1957c0(0x27c)],'expiry_date':_0x1ff972[_0x1957c0(0x23e)]}));}),await _0x2c3ac2[_0x3b55a0(0x1d8)]();const _0x179138=await s_payment_data['findOne']({'invoice':_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x286)]});if(_0x179138===null){}else console['log'](_0x3b55a0(0x264),_0x179138,_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x286)]),_0x179138[_0x3b55a0(0x264)]=_0x1e701a[_0x3b55a0(0x2c0)][_0x3b55a0(0x264)],await _0x179138['save']();_0x1e701a['flash'](_0x3b55a0(0x1e9),_0x3b55a0(0x292)),_0x42781c[_0x3b55a0(0x2ae)](_0x3b55a0(0x279));}catch(_0x3f5ead){console['log'](_0x3f5ead);}}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x1ee),auth,async(_0x20becd,_0x3752b8)=>{var _0x3bba53=a0_0x48f119;try{const _0x201fa5=_0x20becd[_0x3bba53(0x2d0)]['id'],{invoice:_0x21a859,suppliers:_0x472b3e,payable:_0x1cef88,due_amount:_0x1a4ded}=_0x20becd[_0x3bba53(0x2c0)],_0x267ac0=await purchases[_0x3bba53(0x298)](_0x201fa5);var _0x435f6b=_0x1cef88-_0x1a4ded;_0x267ac0['paid_amount']=parseFloat(_0x267ac0[_0x3bba53(0x2b4)])+parseFloat(_0x1a4ded),_0x267ac0[_0x3bba53(0x1f0)]=_0x435f6b;const _0x24a2d8=await _0x267ac0[_0x3bba53(0x1d8)]();console['log'](_0x24a2d8);const _0x4736bd=await s_payment_data[_0x3bba53(0x219)]({'invoice':_0x21a859});_0x4736bd['amount']=_0x435f6b,await _0x4736bd[_0x3bba53(0x1d8)]();let _0x29279a=new Date(),_0xe9d7e2=('0'+_0x29279a['getDate']())[_0x3bba53(0x206)](-0x2),_0x116fe6=('0'+(_0x29279a[_0x3bba53(0x27d)]()+0x1))[_0x3bba53(0x206)](-0x2),_0x9d38fe=_0x29279a['getFullYear'](),_0x579fd2=_0x9d38fe+'-'+_0x116fe6+'-'+_0xe9d7e2;const _0x557681=new suppliers_payment({'invoice':_0x21a859,'date':_0x9d38fe+'-'+_0x116fe6+'-'+_0xe9d7e2,'suppliers':_0x472b3e,'reason':'Paid\x20For\x20Purchase','amount':_0x1a4ded}),_0x33dded=await _0x557681[_0x3bba53(0x1d8)]();_0x20becd[_0x3bba53(0x2ac)](_0x3bba53(0x1e9),_0x3bba53(0x2cd)),_0x3752b8[_0x3bba53(0x2ae)](_0x3bba53(0x26f));}catch(_0x5b4f62){console[_0x3bba53(0x2dd)](_0x5b4f62);}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x2d2),auth,async(_0x55d117,_0x54af01)=>{var _0x16d0ab=a0_0x48f119;try{const {username:_0x26d090,email:_0x4b9e8b,role:_0xd92dab}=_0x55d117[_0x16d0ab(0x2c6)],_0x1a5a7e=_0x55d117[_0x16d0ab(0x2c6)],_0x9f867a=await profile[_0x16d0ab(0x219)]({'email':_0x1a5a7e[_0x16d0ab(0x266)]}),_0x4dab39=await master_shop['find']();console[_0x16d0ab(0x2dd)](_0x16d0ab(0x2b6),_0x4dab39);const _0x1f61eb=_0x55d117[_0x16d0ab(0x2d0)]['id'],_0x1f139b=await purchases['findById'](_0x1f61eb);console[_0x16d0ab(0x2dd)](_0x1f139b);const _0x15fa57=await suppliers[_0x16d0ab(0x219)]({'name':_0x1f139b[_0x16d0ab(0x264)]});console[_0x16d0ab(0x2dd)](_0x15fa57);if(_0x4dab39[0x0]['language']=='English\x20(US)'){var _0x4ab73b=users['English'];console[_0x16d0ab(0x2dd)](_0x4ab73b);}else{if(_0x4dab39[0x0][_0x16d0ab(0x24b)]==_0x16d0ab(0x247))var _0x4ab73b=users[_0x16d0ab(0x247)];else{if(_0x4dab39[0x0]['language']==_0x16d0ab(0x231))var _0x4ab73b=users[_0x16d0ab(0x231)];else{if(_0x4dab39[0x0]['language']==_0x16d0ab(0x2d4))var _0x4ab73b=users[_0x16d0ab(0x2d4)];else{if(_0x4dab39[0x0]['language']==_0x16d0ab(0x287))var _0x4ab73b=users[_0x16d0ab(0x287)];else{if(_0x4dab39[0x0]['language']=='Portuguese\x20(BR)')var _0x4ab73b=users[_0x16d0ab(0x2bf)];else{if(_0x4dab39[0x0][_0x16d0ab(0x24b)]==_0x16d0ab(0x21b))var _0x4ab73b=users['Chinese'];else{if(_0x4dab39[0x0][_0x16d0ab(0x24b)]=='Arabic\x20(ae)')var _0x4ab73b=users[_0x16d0ab(0x246)];}}}}}}}_0x54af01[_0x16d0ab(0x212)]('purchase_invoice',{'success':_0x55d117[_0x16d0ab(0x2ac)]('success'),'errors':_0x55d117['flash'](_0x16d0ab(0x265)),'role':_0x1a5a7e,'profile':_0x9f867a,'master_shop':_0x4dab39,'supplier':_0x15fa57,'purchase':_0x1f139b,'language':_0x4ab73b});}catch(_0x2684b7){console['log'](_0x2684b7);}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x271),auth,async(_0x541d8d,_0x1f8424)=>{var _0x128b6c=a0_0x48f119;try{const {username:_0x3eee25,email:_0x7c4554,role:_0x3c3591}=_0x541d8d[_0x128b6c(0x2c6)],_0xb99834=_0x541d8d[_0x128b6c(0x2c6)],_0x2e4960=await profile[_0x128b6c(0x219)]({'email':_0xb99834[_0x128b6c(0x266)]}),_0x5ca315=await master_shop[_0x128b6c(0x230)]();console[_0x128b6c(0x2dd)](_0x128b6c(0x2b6),_0x5ca315);const _0x51bf41=_0x541d8d[_0x128b6c(0x2d0)]['id'];console['log'](_0x51bf41);const _0x4f586d=await purchases_finished['findById'](_0x51bf41);console[_0x128b6c(0x2dd)](_0x128b6c(0x25d),_0x4f586d);const _0x518c67=await product['find']({}),_0x4e6af9=await warehouse[_0x128b6c(0x249)]([{'$match':{'name':_0x4f586d['warehouse_name'],'room':_0x4f586d[_0x128b6c(0x1e6)]}},{'$unwind':_0x128b6c(0x1c4)},{'$group':{'_id':_0x128b6c(0x24c),'name':{'$first':_0x128b6c(0x250)},'product_stock':{'$first':_0x128b6c(0x20c)},'bay':{'$first':_0x128b6c(0x1e7)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x128b6c(0x28f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x128b6c(0x22e)},'product_code':{'$first':_0x128b6c(0x20f)},'storage':{'$first':_0x128b6c(0x1b9)},'rack':{'$first':_0x128b6c(0x291)}}}]);console[_0x128b6c(0x2dd)](_0x128b6c(0x2d9),_0x4e6af9);let _0x56b57d;if(_0xb99834[_0x128b6c(0x23c)]==_0x128b6c(0x1cc)){const _0x34fbfd=await staff[_0x128b6c(0x219)]({'email':_0xb99834['email']});_0x56b57d=await warehouse[_0x128b6c(0x230)]({'status':'Enabled','name':_0x34fbfd[_0x128b6c(0x224)],'warehouse_category':_0x128b6c(0x29d),'name':_0x128b6c(0x1a7)});}else _0x56b57d=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x128b6c(0x29d),'name':_0x128b6c(0x1a7)}},{'$group':{'_id':_0x128b6c(0x1c5),'name':{'$first':_0x128b6c(0x1c5)}}}]);if(_0x5ca315[0x0][_0x128b6c(0x24b)]==_0x128b6c(0x274)){var _0x45009a=users[_0x128b6c(0x2a2)];console['log'](_0x45009a);}else{if(_0x5ca315[0x0][_0x128b6c(0x24b)]==_0x128b6c(0x247))var _0x45009a=users[_0x128b6c(0x247)];else{if(_0x5ca315[0x0][_0x128b6c(0x24b)]==_0x128b6c(0x231))var _0x45009a=users[_0x128b6c(0x231)];else{if(_0x5ca315[0x0][_0x128b6c(0x24b)]==_0x128b6c(0x2d4))var _0x45009a=users['Spanish'];else{if(_0x5ca315[0x0][_0x128b6c(0x24b)]==_0x128b6c(0x287))var _0x45009a=users[_0x128b6c(0x287)];else{if(_0x5ca315[0x0][_0x128b6c(0x24b)]=='Portuguese\x20(BR)')var _0x45009a=users[_0x128b6c(0x2bf)];else{if(_0x5ca315[0x0]['language']==_0x128b6c(0x21b))var _0x45009a=users['Chinese'];else{if(_0x5ca315[0x0][_0x128b6c(0x24b)]=='Arabic\x20(ae)')var _0x45009a=users[_0x128b6c(0x246)];}}}}}}}_0x1f8424['render'](_0x128b6c(0x234),{'success':_0x541d8d[_0x128b6c(0x2ac)](_0x128b6c(0x1e9)),'errors':_0x541d8d[_0x128b6c(0x2ac)](_0x128b6c(0x265)),'role':_0xb99834,'profile':_0x2e4960,'user':_0x4f586d,'stock':_0x4e6af9,'master_shop':_0x5ca315,'product':_0x518c67,'language':_0x45009a,'warehouse':_0x56b57d});}catch(_0x30d94b){console['log'](_0x30d94b);}}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x271),auth,async(_0x22d1bb,_0x4ffb10)=>{var _0x1eb8a0=a0_0x48f119;try{const {invoice:_0x1acc09,date:_0x5eaa2c,warehouse_name:_0x46e5ba,Room_name:_0x2db35f,product_name:_0x14a1bc,purchase_quantity:_0x5d1df4,stocks:_0x4cd973,return_qty:_0x401e0a,note:_0x30c90c,level:_0x545aba,isle:_0x48af06,pallet:_0x1b96d6,to_warehouse_name:_0xc4768d,to_Room_name:_0x444e68}=_0x22d1bb[_0x1eb8a0(0x2c0)],_0x1867d0=await purchases_finished[_0x1eb8a0(0x219)]({'_id':_0x22d1bb[_0x1eb8a0(0x2d0)]['id']}),_0x55ce3e=await warehouse[_0x1eb8a0(0x219)]({'name':_0x46e5ba,'room':_0x2db35f,'warehouse_category':_0x1eb8a0(0x29d)});if(typeof _0x14a1bc==_0x1eb8a0(0x2bc))var _0x256d38=[_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x26e)]],_0x41d14b=[_0x22d1bb['body'][_0x1eb8a0(0x24d)]],_0x3599b2=[_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x277)]],_0x4995af=[_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x2d6)]],_0x3d077f=[_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x21c)]],_0x25987c=[_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x1b3)]],_0x3a1fa0=[_0x22d1bb['body'][_0x1eb8a0(0x22b)]],_0x466aae=[_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x1b2)]];else var _0x256d38=[..._0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x26e)]],_0x41d14b=[..._0x22d1bb['body']['purchase_quantity']],_0x3599b2=[..._0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x277)]],_0x4995af=[..._0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x2d6)]],_0x3d077f=[..._0x22d1bb['body'][_0x1eb8a0(0x21c)]],_0x25987c=[..._0x22d1bb[_0x1eb8a0(0x2c0)]['product_code_hide']],_0x3a1fa0=[..._0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x22b)]],_0x466aae=[..._0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x1b2)]];const _0x4ac5d0=_0x256d38['map'](_0x3dfa3e=>{return _0x3dfa3e={'product_name':_0x3dfa3e};});_0x41d14b[_0x1eb8a0(0x1cb)]((_0x5b5380,_0x1a192d)=>{_0x4ac5d0[_0x1a192d]['purchase_quantity']=_0x5b5380;}),_0x3599b2[_0x1eb8a0(0x1cb)]((_0x267f30,_0x5a24b2)=>{_0x4ac5d0[_0x5a24b2]['stock_quantity']=_0x267f30;}),_0x4995af[_0x1eb8a0(0x1cb)]((_0x44b1ef,_0x217abf)=>{var _0x41b9e3=_0x1eb8a0;_0x4ac5d0[_0x217abf][_0x41b9e3(0x2d6)]=_0x44b1ef;}),_0x3d077f['forEach']((_0x465ae2,_0x4f9433)=>{var _0x479c81=_0x1eb8a0;_0x4ac5d0[_0x4f9433][_0x479c81(0x244)]=_0x465ae2;}),_0x25987c['forEach']((_0x1c1d6b,_0xce18e7)=>{var _0x55f830=_0x1eb8a0;_0x4ac5d0[_0xce18e7][_0x55f830(0x240)]=_0x1c1d6b;}),_0x3a1fa0[_0x1eb8a0(0x1cb)]((_0x3a89f3,_0x3c0666)=>{var _0x46e657=_0x1eb8a0;_0x4ac5d0[_0x3c0666][_0x46e657(0x1bd)]=_0x3a89f3;}),_0x466aae[_0x1eb8a0(0x1cb)]((_0x355057,_0x22b493)=>{var _0x5cdf58=_0x1eb8a0;_0x4ac5d0[_0x22b493][_0x5cdf58(0x241)]=_0x355057;}),_0x4ac5d0[_0x1eb8a0(0x1cb)](_0x164997=>{var _0x3f6241=_0x1eb8a0;console[_0x3f6241(0x2dd)](_0x164997);const _0x5cd413=_0x55ce3e['product_details'][_0x3f6241(0x2e3)](_0x2ba6a5=>{var _0x4fc5b3=_0x3f6241;_0x2ba6a5[_0x4fc5b3(0x26e)]==_0x164997[_0x4fc5b3(0x26e)]&&_0x2ba6a5[_0x4fc5b3(0x244)]==_0x164997[_0x4fc5b3(0x244)]&&(console['log'](parseInt(_0x2ba6a5[_0x4fc5b3(0x205)])+_0x4fc5b3(0x2c9)+parseInt(_0x164997[_0x4fc5b3(0x2d6)])),_0x2ba6a5[_0x4fc5b3(0x205)]=parseInt(_0x2ba6a5[_0x4fc5b3(0x205)])-parseInt(_0x164997[_0x4fc5b3(0x2d6)]));});}),await _0x55ce3e[_0x1eb8a0(0x1d8)]();var _0x4294e9=0x0;_0x4ac5d0[_0x1eb8a0(0x1cb)](_0x4dd51e=>{var _0x5a1d51=_0x1eb8a0;(parseInt(_0x4dd51e[_0x5a1d51(0x24d)])<parseInt(_0x4dd51e[_0x5a1d51(0x2d6)])||parseInt(_0x4dd51e[_0x5a1d51(0x1d4)])<parseInt(_0x4dd51e[_0x5a1d51(0x2d6)]))&&_0x4294e9++;});if(_0x4294e9!=0x0)return _0x22d1bb['flash'](_0x1eb8a0(0x265),_0x1eb8a0(0x1ad)),_0x4ffb10[_0x1eb8a0(0x2ae)](_0x1eb8a0(0x2a1));const _0x3184f4=new purchases_return_finished({'invoice':_0x1acc09,'suppliers':_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x264)],'date':_0x5eaa2c,'warehouse_name':_0x46e5ba,'return_product':_0x4ac5d0,'note':_0x30c90c,'room':_0x2db35f,'to_warehouse_name':_0xc4768d,'to_room':_0x444e68}),_0x269e73=await _0x3184f4[_0x1eb8a0(0x1d8)](),_0x3a27f4=await purchases_return_finished[_0x1eb8a0(0x219)]({'invoice':_0x1acc09}),_0x21d913=await warehouse['findOne']({'name':_0xc4768d,'room':_0x444e68,'warehouse_category':_0x1eb8a0(0x29d)});_0x3a27f4[_0x1eb8a0(0x226)][_0x1eb8a0(0x1cb)](_0x540aee=>{var _0x5a4dcc=_0x1eb8a0,_0xc8099=0x0;const _0x388091=_0x21d913[_0x5a4dcc(0x236)][_0x5a4dcc(0x2e3)](_0x54316e=>{var _0x2f022d=_0x5a4dcc;console['log'](_0x54316e[_0x2f022d(0x26e)]+'=='+_0x540aee[_0x2f022d(0x26e)]+'&&'+_0x54316e[_0x2f022d(0x244)]+'=='+_0x540aee['bay']),_0x54316e[_0x2f022d(0x26e)]==_0x540aee[_0x2f022d(0x26e)]&&_0x54316e[_0x2f022d(0x244)]==_0x540aee[_0x2f022d(0x244)]&&(_0x54316e[_0x2f022d(0x205)]=parseInt(_0x54316e[_0x2f022d(0x205)])-parseInt(_0x540aee[_0x2f022d(0x2d6)]),_0xc8099++);});_0xc8099=='0'&&(_0x21d913[_0x5a4dcc(0x236)]=_0x21d913[_0x5a4dcc(0x236)][_0x5a4dcc(0x297)]({'product_name':_0x540aee[_0x5a4dcc(0x26e)],'product_stock':_0x540aee[_0x5a4dcc(0x2d6)],'primary_code':_0x540aee['primary_code'],'secondary_code':_0x540aee[_0x5a4dcc(0x241)],'product_code':_0x540aee[_0x5a4dcc(0x240)],'bay':_0x540aee[_0x5a4dcc(0x244)],'maxProducts':0xf423f}));}),await _0x21d913['save']();const _0x296834=await purchases_finished[_0x1eb8a0(0x219)]({'invoice':_0x1acc09});_0x296834[_0x1eb8a0(0x1fd)]=_0x1eb8a0(0x2a6);const _0x419070=await _0x296834['save'](),_0x28a1b3=new s_payment_data({'invoice':_0x1acc09,'suppliers':_0x22d1bb[_0x1eb8a0(0x2c0)][_0x1eb8a0(0x264)],'reason':_0x1eb8a0(0x1d2)});await _0x28a1b3['save']();const _0x4d08f0=await master_shop[_0x1eb8a0(0x230)](),_0x462022=await email_settings[_0x1eb8a0(0x219)](),_0x3591ad=await suppliers['findOne']({'name':_0x22d1bb['body']['suppliers']});_0x4d08f0[0x0][_0x1eb8a0(0x1d9)]==0x1?(right_currency=_0x4d08f0[0x0][_0x1eb8a0(0x1c0)],left_currency=''):(right_currency='',left_currency=_0x4d08f0[0x0][_0x1eb8a0(0x1c0)]);var _0x2172d1=_0x256d38,_0x558be3=_0x4995af,_0x23bddd='',_0x31c145;for(_0x31c145 in _0x2172d1){_0x23bddd+=_0x1eb8a0(0x237)+_0x1eb8a0(0x21f)+_0x2172d1[_0x31c145]+_0x1eb8a0(0x242)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x558be3[_0x31c145]+_0x1eb8a0(0x242)+_0x1eb8a0(0x253);}let _0xfa9e9c=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x462022[_0x1eb8a0(0x266)],'pass':_0x462022[_0x1eb8a0(0x27b)]}}),_0x51b96b={'from':_0x462022[_0x1eb8a0(0x266)],'to':_0x3591ad[_0x1eb8a0(0x266)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x1eb8a0(0x1c1),'path':__dirname+_0x1eb8a0(0x293)+'/upload/'+_0x4d08f0[0x0][_0x1eb8a0(0x2d5)],'cid':_0x1eb8a0(0x222)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1eb8a0(0x218)+_0x1eb8a0(0x1c7)+_0x1eb8a0(0x2e2)+'<div>'+_0x1eb8a0(0x288)+_0x1eb8a0(0x23d)+_0x1eb8a0(0x1c7)+_0x1eb8a0(0x2a9)+_0x4d08f0[0x0]['site_title']+_0x1eb8a0(0x2b2)+_0x1eb8a0(0x23d)+_0x1eb8a0(0x23d)+'<hr\x20class=\x22my-3\x22>'+_0x1eb8a0(0x1c7)+_0x1eb8a0(0x1f8)+'\x20Order\x20Number\x20:\x20'+_0x1acc09+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1eb8a0(0x1aa)+_0x5eaa2c+'\x20'+'</span>'+'</h5>'+_0x1eb8a0(0x23d)+_0x1eb8a0(0x228)+_0x1eb8a0(0x24f)+_0x1eb8a0(0x237)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1eb8a0(0x2d7)+_0x1eb8a0(0x21d)+_0x1eb8a0(0x22c)+_0x1eb8a0(0x253)+_0x1eb8a0(0x25c)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x23bddd+'\x20'+_0x1eb8a0(0x1f5)+_0x1eb8a0(0x2ab)+'<div>'+_0x1eb8a0(0x296)+_0x1eb8a0(0x2bb)+_0x4d08f0[0x0]['site_title']+_0x1eb8a0(0x20a)+_0x1eb8a0(0x23d)+_0x1eb8a0(0x23d)+_0x1eb8a0(0x255)};_0xfa9e9c[_0x1eb8a0(0x1dd)](_0x51b96b,function(_0x36e095,_0x4bb124){var _0x105eae=_0x1eb8a0;_0x36e095?console['log'](_0x105eae(0x225)):console[_0x105eae(0x2dd)](_0x105eae(0x233));}),_0x22d1bb[_0x1eb8a0(0x2ac)]('success',_0x1eb8a0(0x1ba)),_0x4ffb10[_0x1eb8a0(0x2ae)](_0x1eb8a0(0x279));}catch(_0x25519d){_0x4ffb10[_0x1eb8a0(0x257)](0xc8)['json']({'message':_0x25519d[_0x1eb8a0(0x2bd)]});}}),router[a0_0x48f119(0x1e2)](a0_0x48f119(0x28c),auth,async(_0x22a39e,_0x17b944)=>{var _0x1e80c9=a0_0x48f119;try{const {username:_0x14ff90,email:_0x275f18,role:_0x594c0d}=_0x22a39e['user'],_0x9f0145=_0x22a39e[_0x1e80c9(0x2c6)],_0x47f592=await profile[_0x1e80c9(0x219)]({'email':_0x9f0145['email']}),_0x4800de=await master_shop[_0x1e80c9(0x230)](),_0x1292f2=_0x22a39e[_0x1e80c9(0x2d0)]['id'],_0x1344c1=await purchases_finished['findById'](_0x1292f2);if(_0x4800de[0x0][_0x1e80c9(0x24b)]==_0x1e80c9(0x274))var _0x137372=users[_0x1e80c9(0x2a2)];else{if(_0x4800de[0x0][_0x1e80c9(0x24b)]==_0x1e80c9(0x247))var _0x137372=users['Hindi'];else{if(_0x4800de[0x0][_0x1e80c9(0x24b)]==_0x1e80c9(0x231))var _0x137372=users[_0x1e80c9(0x231)];else{if(_0x4800de[0x0][_0x1e80c9(0x24b)]=='Spanish')var _0x137372=users[_0x1e80c9(0x2d4)];else{if(_0x4800de[0x0]['language']==_0x1e80c9(0x287))var _0x137372=users['French'];else{if(_0x4800de[0x0][_0x1e80c9(0x24b)]==_0x1e80c9(0x20e))var _0x137372=users[_0x1e80c9(0x2bf)];else{if(_0x4800de[0x0][_0x1e80c9(0x24b)]=='Chinese')var _0x137372=users[_0x1e80c9(0x21b)];else{if(_0x4800de[0x0][_0x1e80c9(0x24b)]==_0x1e80c9(0x2df))var _0x137372=users[_0x1e80c9(0x246)];}}}}}}}_0x17b944['render'](_0x1e80c9(0x23f),{'success':_0x22a39e[_0x1e80c9(0x2ac)](_0x1e80c9(0x1e9)),'errors':_0x22a39e[_0x1e80c9(0x2ac)]('errors'),'role':_0x9f0145,'profile':_0x47f592,'alldata':_0x1344c1,'master_shop':_0x4800de,'language':_0x137372}),console['log'](alldata);}catch(_0x409fcb){console[_0x1e80c9(0x2dd)](_0x409fcb);}}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x1c3),async(_0xda2f24,_0x3d3fdf)=>{var _0x26540f=a0_0x48f119;const {product_code:_0x4170a8}=_0xda2f24[_0x26540f(0x2c0)];var _0x288442;const _0x54594a=await product['aggregate']([{'$match':{'primary_code':_0x4170a8}},{'$group':{'_id':_0x26540f(0x2a4),'name':{'$first':_0x26540f(0x1c5)},'category':{'$first':_0x26540f(0x1e4)},'brand':{'$first':_0x26540f(0x26c)},'unit':{'$first':_0x26540f(0x267)},'alertquantity':{'$first':_0x26540f(0x248)},'product_code':{'$first':_0x26540f(0x202)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x26540f(0x294)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x26540f(0x223)},'gross_price':{'$first':_0x26540f(0x254)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x554ecd=await product[_0x26540f(0x249)]([{'$match':{'secondary_code':_0x4170a8}},{'$group':{'_id':_0x26540f(0x2a4),'name':{'$first':_0x26540f(0x1c5)},'category':{'$first':_0x26540f(0x1e4)},'brand':{'$first':_0x26540f(0x26c)},'unit':{'$first':_0x26540f(0x267)},'alertquantity':{'$first':_0x26540f(0x248)},'product_code':{'$first':_0x26540f(0x202)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x26540f(0x1de)},'maxStocks':{'$first':_0x26540f(0x2d1)},'maxProdPerUnit':{'$first':_0x26540f(0x294)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x54594a[_0x26540f(0x1cf)]>0x0)_0x288442=_0x54594a;else _0x554ecd[_0x26540f(0x1cf)]>0x0&&(_0x288442=_0x554ecd);_0x3d3fdf[_0x26540f(0x20b)](_0x288442);}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x281),async(_0x230cc7,_0x4aee71)=>{var _0x17cb54=a0_0x48f119;const {productCode:_0x7623a5,bay:_0x4f5d99,warehouses:_0x17f052,room:_0x3ac340}=_0x230cc7['body'];console[_0x17cb54(0x2dd)](_0x230cc7[_0x17cb54(0x2c0)]);try{const _0xdd4685=await warehouse[_0x17cb54(0x249)]([{'$match':{'name':_0x17f052,'room':_0x3ac340}},{'$unwind':_0x17cb54(0x1c4)},{'$match':{'product_details.bay':parseInt(_0x4f5d99)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x17cb54(0x250)},'product_stock':{'$first':_0x17cb54(0x20c)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4aee71[_0x17cb54(0x257)](0xc8)[_0x17cb54(0x20b)](_0xdd4685);}catch(_0x964a5e){_0x4aee71[_0x17cb54(0x257)](0x194)['json']({'message':_0x964a5e[_0x17cb54(0x2bd)]});}}),router[a0_0x48f119(0x29b)](a0_0x48f119(0x24a),async(_0x15bb02,_0xa12e0c)=>{var _0x8421a2=a0_0x48f119;const {product_code:_0x4ff337}=_0x15bb02[_0x8421a2(0x2c0)];var _0x37372b;const _0x3524a7=await product[_0x8421a2(0x249)]([{'$match':{'primary_code':_0x4ff337,'type_products':_0x8421a2(0x2dd)}},{'$group':{'_id':_0x8421a2(0x2a4),'name':{'$first':_0x8421a2(0x1c5)},'category':{'$first':'$category'},'brand':{'$first':_0x8421a2(0x26c)},'unit':{'$first':_0x8421a2(0x267)},'alertquantity':{'$first':_0x8421a2(0x248)},'product_code':{'$first':_0x8421a2(0x202)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x8421a2(0x1de)},'maxStocks':{'$first':_0x8421a2(0x2d1)},'maxProdPerUnit':{'$first':_0x8421a2(0x294)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x8421a2(0x223)},'gross_price':{'$first':_0x8421a2(0x254)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x8421a2(0x21a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console['log'](_0x3524a7);const _0x2939d4=await product[_0x8421a2(0x249)]([{'$match':{'secondary_code':_0x4ff337,'type_products':_0x8421a2(0x2dd)}},{'$group':{'_id':_0x8421a2(0x2a4),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x8421a2(0x26c)},'unit':{'$first':_0x8421a2(0x267)},'alertquantity':{'$first':_0x8421a2(0x248)},'product_code':{'$first':_0x8421a2(0x202)},'primary_code':{'$first':_0x8421a2(0x282)},'secondary_code':{'$first':_0x8421a2(0x1de)},'maxStocks':{'$first':_0x8421a2(0x2d1)},'maxProdPerUnit':{'$first':_0x8421a2(0x294)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x8421a2(0x254)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':_0x8421a2(0x21a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x3524a7[_0x8421a2(0x1cf)]>0x0)_0x37372b=_0x3524a7;else _0x2939d4['length']>0x0&&(_0x37372b=_0x2939d4);_0xa12e0c[_0x8421a2(0x20b)](_0x37372b);}),module[a0_0x48f119(0x2d3)]=router;