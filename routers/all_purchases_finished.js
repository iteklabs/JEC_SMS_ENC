var a0_0x27564f=a0_0x1565;(function(_0x5496e6,_0x3fe30f){var _0x35d748=a0_0x1565,_0x37caf5=_0x5496e6();while(!![]){try{var _0x4ee9b7=-parseInt(_0x35d748(0x22c))/0x1*(-parseInt(_0x35d748(0x29c))/0x2)+-parseInt(_0x35d748(0x217))/0x3*(-parseInt(_0x35d748(0x199))/0x4)+parseInt(_0x35d748(0x290))/0x5+-parseInt(_0x35d748(0x16b))/0x6+-parseInt(_0x35d748(0x20e))/0x7+-parseInt(_0x35d748(0x21e))/0x8+parseInt(_0x35d748(0x1ba))/0x9*(-parseInt(_0x35d748(0x254))/0xa);if(_0x4ee9b7===_0x3fe30f)break;else _0x37caf5['push'](_0x37caf5['shift']());}catch(_0xdade35){_0x37caf5['push'](_0x37caf5['shift']());}}}(a0_0x4fe4,0x4f390));const express=require(a0_0x27564f(0x288)),app=express(),router=express[a0_0x27564f(0x25d)](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x27564f(0x244)),auth=require(a0_0x27564f(0x267)),nodemailer=require(a0_0x27564f(0x176));var ejs=require(a0_0x27564f(0x1a9));const path=require(a0_0x27564f(0x1ea)),users=require(a0_0x27564f(0x257)),{isNull}=require(a0_0x27564f(0x1f6));router[a0_0x27564f(0x1d9)](a0_0x27564f(0x202),auth,async(_0xa5b124,_0x493e63)=>{var _0x284f95=a0_0x27564f;try{const {username:_0x503b5b,email:_0x56a990,role:_0x2626de}=_0xa5b124[_0x284f95(0x23d)],_0x5b3321=_0xa5b124[_0x284f95(0x23d)],_0x1320ae=await profile['findOne']({'email':_0x5b3321[_0x284f95(0x240)]}),_0x332543=await staff[_0x284f95(0x1dc)]({'email':_0x5b3321[_0x284f95(0x240)]}),_0x3f7aa5=await master_shop[_0x284f95(0x188)]();let _0x33d5a8=await transfers_finished[_0x284f95(0x185)]([{'$match':{'to_warehouse':_0x332543['warehouse']}}]);if(_0x3f7aa5[0x0][_0x284f95(0x1e4)]=='English\x20(US)')var _0x4fde2c=users[_0x284f95(0x170)];else{if(_0x3f7aa5[0x0]['language']==_0x284f95(0x16c))var _0x4fde2c=users[_0x284f95(0x16c)];else{if(_0x3f7aa5[0x0][_0x284f95(0x1e4)]==_0x284f95(0x174))var _0x4fde2c=users[_0x284f95(0x174)];else{if(_0x3f7aa5[0x0][_0x284f95(0x1e4)]==_0x284f95(0x1f1))var _0x4fde2c=users[_0x284f95(0x1f1)];else{if(_0x3f7aa5[0x0]['language']==_0x284f95(0x253))var _0x4fde2c=users[_0x284f95(0x253)];else{if(_0x3f7aa5[0x0][_0x284f95(0x1e4)]=='Portuguese\x20(BR)')var _0x4fde2c=users[_0x284f95(0x1db)];else{if(_0x3f7aa5[0x0]['language']==_0x284f95(0x287))var _0x4fde2c=users['Chinese'];else{if(_0x3f7aa5[0x0][_0x284f95(0x1e4)]==_0x284f95(0x228))var _0x4fde2c=users[_0x284f95(0x1c9)];}}}}}}}_0x493e63[_0x284f95(0x255)]('incoming_view',{'success':_0xa5b124['flash'](_0x284f95(0x179)),'errors':_0xa5b124[_0x284f95(0x1a7)]('errors'),'purchases':_0x33d5a8,'role':_0x5b3321,'profile':_0x1320ae,'master_shop':_0x3f7aa5,'language':_0x4fde2c,'staff_data':_0x332543});}catch(_0x4729d0){console[_0x284f95(0x19f)](_0x284f95(0x260),_0x4729d0),_0x493e63['status'](0xc8)['json']({'message':_0x4729d0[_0x284f95(0x19b)]});}}),router[a0_0x27564f(0x1d9)](a0_0x27564f(0x222),auth,async(_0x417893,_0x57f7eb)=>{var _0xc37f45=a0_0x27564f;try{const {username:_0x315154,email:_0x487214,role:_0x231177}=_0x417893[_0xc37f45(0x23d)],_0x537a50=_0x417893['user'],_0x55779a=await profile[_0xc37f45(0x1dc)]({'email':_0x537a50[_0xc37f45(0x240)]}),_0x11ef7c=await staff[_0xc37f45(0x1dc)]({'email':_0x537a50[_0xc37f45(0x240)]}),_0x43e7f2=await master_shop[_0xc37f45(0x188)]();let _0x2ba89e=await transfers_finished[_0xc37f45(0x185)]([{'$match':{'to_warehouse':_0x11ef7c[_0xc37f45(0x221)],'to_recieved':'false'}}]);if(_0x43e7f2[0x0][_0xc37f45(0x1e4)]==_0xc37f45(0x239))var _0x1e22f5=users[_0xc37f45(0x170)];else{if(_0x43e7f2[0x0]['language']=='Hindi')var _0x1e22f5=users[_0xc37f45(0x16c)];else{if(_0x43e7f2[0x0]['language']=='German')var _0x1e22f5=users[_0xc37f45(0x174)];else{if(_0x43e7f2[0x0][_0xc37f45(0x1e4)]==_0xc37f45(0x1f1))var _0x1e22f5=users[_0xc37f45(0x1f1)];else{if(_0x43e7f2[0x0][_0xc37f45(0x1e4)]==_0xc37f45(0x253))var _0x1e22f5=users[_0xc37f45(0x253)];else{if(_0x43e7f2[0x0][_0xc37f45(0x1e4)]=='Portuguese\x20(BR)')var _0x1e22f5=users[_0xc37f45(0x1db)];else{if(_0x43e7f2[0x0][_0xc37f45(0x1e4)]==_0xc37f45(0x287))var _0x1e22f5=users[_0xc37f45(0x287)];else{if(_0x43e7f2[0x0][_0xc37f45(0x1e4)]==_0xc37f45(0x228))var _0x1e22f5=users[_0xc37f45(0x1c9)];}}}}}}}_0x57f7eb['render'](_0xc37f45(0x22f),{'success':_0x417893[_0xc37f45(0x1a7)]('success'),'errors':_0x417893[_0xc37f45(0x1a7)](_0xc37f45(0x1e5)),'purchases':_0x2ba89e,'role':_0x537a50,'profile':_0x55779a,'master_shop':_0x43e7f2,'language':_0x1e22f5,'staff_data':_0x11ef7c});}catch(_0x423bab){console[_0xc37f45(0x19f)]('table\x20page',_0x423bab),_0x57f7eb['status'](0xc8)[_0xc37f45(0x1e6)]({'message':_0x423bab[_0xc37f45(0x19b)]});}});function a0_0x4fe4(){var _0x6b54ba=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$invoice','amount','type_of_products','product_cat','toString','purchase\x20data\x20update\x20successfully','INC-','$product.bay','return_data','</tr>','/incoming','</tbody>','true','false','JO_number','Purchase\x20Return\x20Mail','name','floor','\x20to\x20warehouse:\x20','prod_primunit','$secondary_unit','_id','1149834PJkZDz','$maxProdPerUnit','date_recieved','all_purchases_finished_logs','save','/view','$product_details.product_code','$product_details.product_stock','paid_amount','582UVmBIw','</head><body>','Asia/Manila','primary_code','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','production_date','4643664bsAdkG','/all_purchases_finished/process/','sendMail','warehouse','/incoming/add','<tr>','batch_code','logs','/view_log','logo','Arabic\x20(ae)','invoice_init','filter','secondary_unit','427381LsaZmD','\x20Order\x20Number\x20:\x20','purchases\x20item\x20return\x20successfull','incoming_add','Logo.png','unit','quantity','prod_name','$sales_category','product','$room','INC','prod_secondunit','English\x20(US)','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$paid_amount','stock_quantity','user','/picking_list/pdf_puchases_fin_own_trf/','Rack\x201','email','$product_details.rack','all','to_warehouse','../models/all_models','$product_details.primary_code','status','/CheckingWarehouse','undefined',',\x20bay:\x20','currency_placement','findById','$product_details.product_name','</td>','/give_payment/:id','post','map','$product_details','bay','French','2357850KbuMFW','render','\x20Order\x20Date\x20:\x20','../public/language/languages.json','updateOne','prod_Qty','forEach','purchase\x20data\x20add\x20successfully','sales_category','Router','$product.floorlevel','redirect','table\x20page','/all_purchases_finished/preview/','$batch_code','exports','Portuguese\x20(BR)','user_id','return_purchase_finished','../middleware/auth','purchase_invoice','expiry_date','POnumber','back','/process/:id','level','Finished\x20Goods','\x20===\x20','suppliers_docs','maxperunit','port','$name','$due_amount','room_name','date','maxProducts','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','$return_data','$alertquantity','uuid','concat','here2','catch','\x20<>\x20','\x20</h2>','$expiry_date','return_qty','RoomAssign','There\x20is\x20','password','random','Chinese','express','$gross_price','product_data','secondary_code_hide',',\x20bin:\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_level','$secondary_code','2661915XFUPle','Email\x20sent\x20successfully','<h2>\x20','Ambient','staff','purchases_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stocks','$product_details._id','createTransport','/upload/','$brand','2oFoFSM','/preview/:id','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','min','all_purchases_finished','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','valueOf','getMonth','$product','<table\x20style=\x22width:\x20100%\x20!important;\x22>','isAvailable','</div>','$category','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','purchases_process','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','/view/add_purchases','$product.quantity','/barcode_scanner_logs','en-CA','$product_details.storage','</h5>','$primary_code','<!DOCTYPE\x20html>','An\x20error\x20occurred\x20while\x20saving\x20data.','Transfer\x20Finalize\x20Successfully','523134gKVAvI','Hindi','match','isProcess','product_name','English','</body></html>','/invoice/:id','True','German','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','nodemailer','$product_details.type','product_details','success','\x20units\x20of\x20','Purchase\x20Return','prod_code','product_id','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','to_quantity','product_date','The\x20Other\x20','item_code','aggregate','max_product_unit','due_amount','find','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sales_data_cateory','then','$product_details.floorlevel','<h5\x20style=\x22text-align:\x20left;\x22>','image','site_title','getFullYear','/barcode_scanner','secondary_code','<span\x20style=\x22float:\x20right;\x22>','Purchase\x20Mail','Return\x20Goods','purchase_quantity','DRY\x20GOODS','<strong>\x20Regards\x20</strong>','8916rrmIvz','$product.room_name','message','own','add_purchases\x20error','getDate','log','$product_details.bay',',\x20room:\x20','edit_purchases_finished','FROZEN\x20GOODS','currency','</thead>','add_purchases_finished','flash','max','ejs','gmail','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','suppliers','maxPerUnit','product_code','/all_purchases_finished/view','$_id','invoice','/view/:id','Rack\x202','2-digit','return_product','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','9Iukipd','error','$product_details.secondary_code','$product.type','An\x20error\x20occurred.','STAGING\x20AREA\x201','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','maxStocks','type_of_products_type','$product.bin','Error\x20Occurs','primary_code_hide','product_code_hide','$warehouse_name','body','Arabic','numeric','gross_price','$maxStocks','$suppliers','slice','params','master','</span>','</table>','<html><head><title></title>','$product_code','$suppliers_docs','$note','<h5>','string','get','host','Portuguese','findOne','toLocaleDateString','$unit','$date','role','MaxStocks_data','standard_unit','/view/add_purchases/:id','language','errors','json','bin','room','all_purchases_barcode','path','abs','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/../public','FGSEmail','padStart','Spanish','INCF-','Enabled','Enclosed','product_stock','util'];a0_0x4fe4=function(){return _0x6b54ba;};return a0_0x4fe4();}const createLog=async _0x124480=>{var _0x105b84=a0_0x27564f;const _0x30aae4=new datalogs({'location':_0x124480});return await _0x30aae4[_0x105b84(0x212)](),_0x30aae4[_0x105b84(0x229)];};router[a0_0x27564f(0x24f)](a0_0x27564f(0x222),auth,async(_0x41ddc4,_0x1a139c)=>{var _0x688e83=a0_0x27564f;try{const {invoice_trf_data:_0x5f5146,item_code:_0x211631,SCRN:_0x26615a,ReqBy:_0x4ef888,type_of_products:_0x4e64a9,dateofreq:_0xf9016,PO_number:_0x3c45fc,date:_0x420f8f,warehouse_name:_0xc6742a,typeservicesData:_0x1f289f,typevehicle:_0x43e8a1,driver:_0x13eaf7,plate:_0x4a554f,van:_0x514630,DRSI:_0x1c7e37,TSU:_0x219cea,TFU:_0x3352ae,note:_0x2170d3}=_0x41ddc4[_0x688e83(0x1c8)],_0x15e690=await transfers_finished[_0x688e83(0x24b)](_0x5f5146);if(typeof _0x211631==_0x688e83(0x1d8))var _0x29ce20=[_0x41ddc4['body'][_0x688e83(0x16f)]],_0x498420=[_0x41ddc4['body'][_0x688e83(0x184)]],_0x175df7=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x181)]],_0x557d99=[_0x41ddc4[_0x688e83(0x1c8)]['unit']],_0x4029f4=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x238)]],_0x30fc22=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x1e7)]],_0x87fc1b=[_0x41ddc4[_0x688e83(0x1c8)]['primary_code']],_0xf18359=[_0x41ddc4['body'][_0x688e83(0x192)]],_0x572692=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x224)]],_0xc23ad0=[_0x41ddc4['body'][_0x688e83(0x269)]],_0x1dffa1=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x21d)]],_0x2c7db6=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x186)]],_0x306b3a=[_0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x1e8)]];else var _0x29ce20=[..._0x41ddc4[_0x688e83(0x1c8)]['product_name']],_0x498420=[..._0x41ddc4['body'][_0x688e83(0x184)]],_0x175df7=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x181)]],_0x557d99=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x231)]],_0x4029f4=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x238)]],_0x30fc22=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x1e7)]],_0x87fc1b=[..._0x41ddc4['body'][_0x688e83(0x21a)]],_0xf18359=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x192)]],_0x572692=[..._0x41ddc4['body'][_0x688e83(0x224)]],_0xc23ad0=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x269)]],_0x1dffa1=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x21d)]],_0x2c7db6=[..._0x41ddc4[_0x688e83(0x1c8)][_0x688e83(0x186)]],_0x306b3a=[..._0x41ddc4['body'][_0x688e83(0x1e8)]];const _0x145123=_0x29ce20[_0x688e83(0x250)](_0x14e21a=>{return _0x14e21a={'product_name':_0x14e21a};});_0x498420['forEach']((_0x16b26f,_0x1332cf)=>{var _0x2b64df=_0x688e83;_0x145123[_0x1332cf][_0x2b64df(0x1ae)]=_0x16b26f;}),_0x175df7['forEach']((_0x2cb216,_0x477a57)=>{var _0x4c842d=_0x688e83;_0x145123[_0x477a57][_0x4c842d(0x232)]=Math[_0x4c842d(0x1eb)](_0x2cb216);}),_0x557d99[_0x688e83(0x25a)]((_0x2b5a11,_0x268391)=>{var _0x310d02=_0x688e83;_0x145123[_0x268391][_0x310d02(0x1e2)]=_0x2b5a11;}),_0x4029f4[_0x688e83(0x25a)]((_0x2d6b7e,_0x1e185c)=>{var _0x15f14d=_0x688e83;_0x145123[_0x1e185c][_0x15f14d(0x22b)]=_0x2d6b7e;}),_0x30fc22[_0x688e83(0x25a)]((_0xe72260,_0x381a69)=>{var _0xd9981f=_0x688e83,_0x19833c=_0xe72260[_0xd9981f(0x16d)](/[A-Za-z]+/)[0x0],_0x1d79dc=parseInt(_0xe72260[_0xd9981f(0x16d)](/\d+/)[0x0]);_0x145123[_0x381a69][_0xd9981f(0x26d)]=_0x19833c,_0x145123[_0x381a69][_0xd9981f(0x252)]=_0x1d79dc;}),_0x87fc1b['forEach']((_0x30296,_0x1f80ca)=>{var _0x337640=_0x688e83;_0x145123[_0x1f80ca][_0x337640(0x21a)]=_0x30296;}),_0xf18359['forEach']((_0x35f0b3,_0x28829f)=>{_0x145123[_0x28829f]['secondary_code']=_0x35f0b3;}),_0x572692[_0x688e83(0x25a)]((_0xf1e395,_0x5af201)=>{_0x145123[_0x5af201]['batch_code']=_0xf1e395;}),_0xc23ad0[_0x688e83(0x25a)]((_0x46fa0b,_0x18a30e)=>{var _0x508001=_0x688e83;_0x145123[_0x18a30e][_0x508001(0x269)]=_0x46fa0b;}),_0x1dffa1[_0x688e83(0x25a)]((_0x285e54,_0x5eb1e2)=>{var _0x2615c2=_0x688e83;_0x145123[_0x5eb1e2][_0x2615c2(0x21d)]=_0x285e54;}),_0x2c7db6[_0x688e83(0x25a)]((_0x16ffde,_0xb6e250)=>{var _0x3842b9=_0x688e83;_0x145123[_0xb6e250][_0x3842b9(0x271)]=_0x16ffde;}),_0x306b3a[_0x688e83(0x25a)]((_0x5b2eeb,_0x2e5bc5)=>{var _0x5d5f12=_0x688e83;_0x145123[_0x2e5bc5][_0x5d5f12(0x275)]=_0x5b2eeb;});const _0xa94681=await createLog(_0x688e83(0x237));_0x306b3a[_0x688e83(0x25a)]((_0x512f8c,_0x565fb2)=>{var _0x1ac964=_0x688e83;_0x145123[_0x565fb2][_0x1ac964(0x1b1)]=_0x1ac964(0x1fe)+_0xa94681[_0x1ac964(0x1fc)]()['padStart'](0x8,'0');});const _0x25a553=_0x145123[_0x688e83(0x22a)](_0x135779=>_0x135779[_0x688e83(0x232)]!=='0'&&_0x135779['quantity']!==''),_0x1f4eb6=new purchases_incoming({'invoice':_0x688e83(0x1fe)+_0xa94681['toString']()[_0x688e83(0x1f0)](0x8,'0'),'date':_0x420f8f,'warehouse_name':_0xc6742a,'product':_0x25a553,'note':_0x2170d3,'POnumber':_0x3c45fc,'SCRN':_0x26615a,'ReqBy':_0x4ef888,'dateofreq':_0xf9016,'typeservicesData':_0x1f289f,'van':_0x514630,'typevehicle':_0x43e8a1,'driver':_0x13eaf7,'plate':_0x4a554f,'DRSI':_0x1c7e37,'TSU':_0x219cea,'TFU':_0x3352ae,'typeOfProducts':_0x4e64a9}),_0x26b4df=await _0x1f4eb6[_0x688e83(0x212)](),_0x16980b=_0x26b4df[_0x688e83(0x235)][_0x688e83(0x250)](async _0x3414f3=>{var _0x1b744a=_0x688e83,_0x390695=await warehouse[_0x1b744a(0x1dc)]({'name':_0xc6742a,'room':_0x3414f3[_0x1b744a(0x275)]});if(_0x3414f3['quantity']>0x0){var _0x4472d7=0x0;const _0x3a73c0=_0x390695['product_details'][_0x1b744a(0x250)](_0x114803=>{var _0x5e5294=_0x1b744a;_0x114803[_0x5e5294(0x16f)]==_0x3414f3[_0x5e5294(0x16f)]&&_0x114803[_0x5e5294(0x252)]==_0x3414f3['to_bay']&&_0x114803['expiry_date']==_0x3414f3[_0x5e5294(0x269)]&&_0x114803[_0x5e5294(0x21d)]==_0x3414f3[_0x5e5294(0x21d)]&&_0x114803[_0x5e5294(0x224)]==_0x3414f3['batch_code']&&_0x114803[_0x5e5294(0x1b1)]==_0x3414f3[_0x5e5294(0x1b1)]&&(typeof _0x3414f3['id_transaction']==_0x5e5294(0x248)?(console[_0x5e5294(0x19f)](_0x5e5294(0x27d),_0x114803[_0x5e5294(0x1f5)]+_0x5e5294(0x27f)+_0x114803['_id']+'\x20<=>\x20'+Math['abs'](_0x114803[_0x5e5294(0x1f5)])+Math[_0x5e5294(0x1eb)](_0x3414f3['to_quantity'])),_0x114803[_0x5e5294(0x1f5)]=Math['abs'](_0x114803[_0x5e5294(0x1f5)])+Math[_0x5e5294(0x1eb)](_0x3414f3['quantity'])):(_0x114803[_0x5e5294(0x1f5)]=Math[_0x5e5294(0x1eb)](_0x114803['product_stock'])+Math['abs'](_0x3414f3[_0x5e5294(0x232)]),_0x4472d7++));});_0x4472d7=='0'&&(_0x390695['product_details']=_0x390695['product_details']['concat']({'product_name':_0x3414f3[_0x1b744a(0x16f)],'product_stock':_0x3414f3[_0x1b744a(0x232)],'bay':_0x3414f3['bay'],'level':_0x3414f3[_0x1b744a(0x26d)],'product_code':_0x3414f3[_0x1b744a(0x1ae)],'primary_code':_0x3414f3[_0x1b744a(0x21a)],'secondary_code':_0x3414f3[_0x1b744a(0x192)],'expiry_date':_0x3414f3[_0x1b744a(0x269)],'production_date':_0x3414f3[_0x1b744a(0x21d)],'maxProducts':_0x3414f3[_0x1b744a(0x277)],'batch_code':_0x3414f3['batch_code'],'secondary_unit':_0x3414f3['secondary_unit'],'unit':_0x3414f3[_0x1b744a(0x1e2)],'maxProducts':_0x3414f3['maxProducts'],'maxPerUnit':_0x3414f3[_0x1b744a(0x1ad)],'invoice':_0x3414f3['invoice']}));}return _0x390695;});Promise['all'](_0x16980b)[_0x688e83(0x18b)](async _0x23c770=>{var _0x49c74c=_0x688e83;try{for(const _0x57242d of _0x23c770){await warehouse['updateOne']({'_id':_0x57242d['_id']},{'$addToSet':{'product_details':{'$each':_0x57242d[_0x49c74c(0x178)]}}});}_0x15e690['to_recieved']='true';const _0x2072e=await _0x15e690['save'](),_0x3a11c9=await master_shop[_0x49c74c(0x188)](),_0x2ea93a=await email_settings[_0x49c74c(0x1dc)](),_0x86e07d=await supervisor_settings[_0x49c74c(0x188)]();var _0x111cef=_0x1f4eb6[_0x49c74c(0x235)],_0x5bee30='',_0x341f54;for(_0x341f54 in _0x111cef){var _0x239400='FG';_0x1f4eb6[_0x49c74c(0x243)]==_0x49c74c(0x197)&&(_0x239400='DG'),_0x5bee30+='<tr>'+_0x49c74c(0x28d)+_0x111cef[_0x341f54][_0x49c74c(0x16f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x111cef[_0x341f54][_0x49c74c(0x1ae)]+_0x49c74c(0x24d)+_0x49c74c(0x28d)+_0x111cef[_0x341f54]['to_quantity']+'</td>'+_0x49c74c(0x28d)+_0x111cef[_0x341f54][_0x49c74c(0x231)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x111cef[_0x341f54][_0x49c74c(0x22b)]+_0x49c74c(0x24d)+_0x49c74c(0x28d)+_0x1f4eb6['to_warehouse']+_0x49c74c(0x24d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x111cef[_0x341f54]['to_room_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x239400+_0x111cef[_0x341f54]['to_bay']+_0x49c74c(0x24d)+'</tr>';}_0x41ddc4['flash']('success',_0x49c74c(0x16a)),_0x1a139c[_0x49c74c(0x25f)](_0x49c74c(0x23e)+_0x26b4df[_0x49c74c(0x20d)]);}catch(_0x144def){console['error'](_0x144def),_0x1a139c['status'](0x1f4)[_0x49c74c(0x1e6)]({'error':_0x49c74c(0x23a)});}})[_0x688e83(0x27e)](_0x35bf53=>{var _0x22d11d=_0x688e83;console[_0x22d11d(0x1bb)](_0x35bf53),_0x1a139c[_0x22d11d(0x246)](0x1f4)[_0x22d11d(0x1e6)]({'error':_0x22d11d(0x1be)});});}catch(_0x5d1122){}}),router[a0_0x27564f(0x24f)]('/getTRF',auth,async(_0x1d93f2,_0x46865e)=>{var _0x31a661=a0_0x27564f;try{const {warehouse:_0x33abc8}=_0x1d93f2[_0x31a661(0x1c8)],_0x57a0b0=await transfers_finished[_0x31a661(0x188)]({'to_warehouse':_0x33abc8,'to_recieved':_0x31a661(0x205)});_0x46865e['json'](_0x57a0b0);}catch(_0x5775b7){}}),router[a0_0x27564f(0x24f)]('/getinvoicetrf',auth,async(_0x4ad956,_0x51aa03)=>{var _0x13144e=a0_0x27564f;try{const {invoice:_0x3e6871}=_0x4ad956[_0x13144e(0x1c8)],_0x959865=await transfers_finished[_0x13144e(0x188)]({'_id':_0x3e6871,'to_recieved':_0x13144e(0x205)});_0x51aa03[_0x13144e(0x1e6)](_0x959865);}catch(_0x2f99db){}}),router[a0_0x27564f(0x1d9)](a0_0x27564f(0x213),auth,async(_0x4c17e8,_0x2965ea)=>{var _0x50df19=a0_0x27564f;try{const {username:_0x1f3373,email:_0xc531a9,role:_0x22447c}=_0x4c17e8[_0x50df19(0x23d)],_0x140e8b=_0x4c17e8[_0x50df19(0x23d)],_0xfbcdb9=await profile[_0x50df19(0x1dc)]({'email':_0x140e8b[_0x50df19(0x240)]}),_0x2146d7=await staff['findOne']({'email':_0x140e8b['email']});if(_0x140e8b[_0x50df19(0x1e0)]==_0x50df19(0x294)){const _0x21f1c6=await staff[_0x50df19(0x1dc)]({'email':_0x140e8b[_0x50df19(0x240)]});}const _0xeb26a5=await master_shop[_0x50df19(0x188)]();let _0x58542e;if(_0x140e8b['role']=='staff'){const _0x24ced2=await staff[_0x50df19(0x1dc)]({'email':_0x140e8b[_0x50df19(0x240)]});_0x58542e=await purchases_finished[_0x50df19(0x185)]([{'$match':{'warehouse_name':_0x24ced2[_0x50df19(0x221)],'typeOfProducts':_0x50df19(0x19c)}},{'$lookup':{'from':'suppliers','localField':_0x50df19(0x1ac),'foreignField':_0x50df19(0x208),'as':_0x50df19(0x270)}},{'$unwind':_0x50df19(0x1d5)},{'$unwind':_0x50df19(0x2a5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x50df19(0x1f8)},'suppliers':{'$first':_0x50df19(0x1cd)},'date':{'$first':_0x50df19(0x1df)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x50df19(0x236)},'product':{'$push':_0x50df19(0x2a5)},'note':{'$first':_0x50df19(0x1d6)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x50df19(0x279)},'batch_code':{'$first':_0x50df19(0x262)},'expiry_date':{'$first':_0x50df19(0x281)},'suppliers_docs':{'$first':_0x50df19(0x1d5)},'total_product_quantity':{'$sum':_0x50df19(0x2af)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x50df19(0x1c3)},'type':{'$addToSet':_0x50df19(0x1bd)},'floorlevel':{'$addToSet':_0x50df19(0x25e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x58542e=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x50df19(0x19c)}},{'$unwind':_0x50df19(0x2a5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x50df19(0x1f8)},'suppliers':{'$first':_0x50df19(0x1cd)},'date':{'$first':_0x50df19(0x1df)},'warehouse_name':{'$first':_0x50df19(0x1c7)},'room':{'$addToSet':_0x50df19(0x19a)},'product':{'$push':_0x50df19(0x2a5)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x50df19(0x23b)},'due_amount':{'$first':_0x50df19(0x274)},'return_data':{'$first':_0x50df19(0x279)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x50df19(0x281)},'suppliers_docs':{'$first':_0x50df19(0x1d5)},'total_product_quantity':{'$sum':_0x50df19(0x2af)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x50df19(0x1c3)},'type':{'$addToSet':_0x50df19(0x1bd)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xeb26a5[0x0][_0x50df19(0x1e4)]==_0x50df19(0x239))var _0x1934f1=users['English'];else{if(_0xeb26a5[0x0][_0x50df19(0x1e4)]=='Hindi')var _0x1934f1=users[_0x50df19(0x16c)];else{if(_0xeb26a5[0x0]['language']==_0x50df19(0x174))var _0x1934f1=users[_0x50df19(0x174)];else{if(_0xeb26a5[0x0]['language']==_0x50df19(0x1f1))var _0x1934f1=users[_0x50df19(0x1f1)];else{if(_0xeb26a5[0x0]['language']==_0x50df19(0x253))var _0x1934f1=users[_0x50df19(0x253)];else{if(_0xeb26a5[0x0][_0x50df19(0x1e4)]==_0x50df19(0x264))var _0x1934f1=users[_0x50df19(0x1db)];else{if(_0xeb26a5[0x0][_0x50df19(0x1e4)]=='Chinese')var _0x1934f1=users[_0x50df19(0x287)];else{if(_0xeb26a5[0x0][_0x50df19(0x1e4)]==_0x50df19(0x228))var _0x1934f1=users[_0x50df19(0x1c9)];}}}}}}}_0x2965ea[_0x50df19(0x255)](_0x50df19(0x2a0),{'success':_0x4c17e8[_0x50df19(0x1a7)](_0x50df19(0x179)),'errors':_0x4c17e8[_0x50df19(0x1a7)](_0x50df19(0x1e5)),'purchases':_0x58542e,'role':_0x140e8b,'profile':_0xfbcdb9,'master_shop':_0xeb26a5,'language':_0x1934f1});}catch(_0xfd30cf){console[_0x50df19(0x19f)]('table\x20page',_0xfd30cf),_0x2965ea[_0x50df19(0x246)](0xc8)[_0x50df19(0x1e6)]({'message':_0xfd30cf['message']});}}),router[a0_0x27564f(0x1d9)](a0_0x27564f(0x226),auth,async(_0x1ba583,_0x2a37e3)=>{var _0x4eaf86=a0_0x27564f;try{const {username:_0x3f3bfb,email:_0x66f43e,role:_0x3488d9}=_0x1ba583['user'],_0x3e855a=_0x1ba583[_0x4eaf86(0x23d)],_0x7204d8=await profile[_0x4eaf86(0x1dc)]({'email':_0x3e855a[_0x4eaf86(0x240)]}),_0x313a32=await staff['findOne']({'email':_0x3e855a[_0x4eaf86(0x240)]});if(_0x3e855a[_0x4eaf86(0x1e0)]==_0x4eaf86(0x294)){const _0x40cf7e=await staff[_0x4eaf86(0x1dc)]({'email':_0x3e855a[_0x4eaf86(0x240)]});}const _0x31ccc9=await master_shop['find']();let _0x367adf;if(_0x3e855a[_0x4eaf86(0x1e0)]==_0x4eaf86(0x294)){const _0x46e773=await staff['findOne']({'email':_0x3e855a['email']});_0x367adf=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x46e773[_0x4eaf86(0x221)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x4eaf86(0x208),'as':'suppliers_docs'}},{'$unwind':_0x4eaf86(0x1d5)},{'$unwind':_0x4eaf86(0x2a5)},{'$group':{'_id':_0x4eaf86(0x1b0),'invoice':{'$first':_0x4eaf86(0x1f8)},'suppliers':{'$first':_0x4eaf86(0x1cd)},'date':{'$first':_0x4eaf86(0x1df)},'warehouse_name':{'$first':_0x4eaf86(0x1c7)},'room':{'$first':_0x4eaf86(0x236)},'product':{'$push':'$product'},'note':{'$first':_0x4eaf86(0x1d6)},'paid_amount':{'$first':_0x4eaf86(0x23b)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4eaf86(0x279)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x4eaf86(0x281)},'suppliers_docs':{'$first':_0x4eaf86(0x1d5)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4eaf86(0x1ff)},'isle':{'$addToSet':_0x4eaf86(0x1c3)},'type':{'$addToSet':_0x4eaf86(0x1bd)},'floorlevel':{'$addToSet':_0x4eaf86(0x25e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x367adf=await purchases_finished['aggregate']([{'$match':{'typeOfProducts':_0x4eaf86(0x225)}},{'$unwind':_0x4eaf86(0x2a5)},{'$group':{'_id':_0x4eaf86(0x1b0),'invoice':{'$first':_0x4eaf86(0x1f8)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4eaf86(0x1df)},'warehouse_name':{'$first':_0x4eaf86(0x1c7)},'room':{'$addToSet':_0x4eaf86(0x19a)},'product':{'$push':'$product'},'note':{'$first':_0x4eaf86(0x1d6)},'paid_amount':{'$first':_0x4eaf86(0x23b)},'due_amount':{'$first':_0x4eaf86(0x274)},'return_data':{'$first':_0x4eaf86(0x279)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4eaf86(0x1d5)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4eaf86(0x1ff)},'isle':{'$addToSet':_0x4eaf86(0x1c3)},'type':{'$addToSet':_0x4eaf86(0x1bd)},'floorlevel':{'$addToSet':_0x4eaf86(0x25e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x31ccc9[0x0][_0x4eaf86(0x1e4)]==_0x4eaf86(0x239))var _0x4eab3d=users[_0x4eaf86(0x170)];else{if(_0x31ccc9[0x0][_0x4eaf86(0x1e4)]==_0x4eaf86(0x16c))var _0x4eab3d=users[_0x4eaf86(0x16c)];else{if(_0x31ccc9[0x0]['language']==_0x4eaf86(0x174))var _0x4eab3d=users[_0x4eaf86(0x174)];else{if(_0x31ccc9[0x0][_0x4eaf86(0x1e4)]=='Spanish')var _0x4eab3d=users[_0x4eaf86(0x1f1)];else{if(_0x31ccc9[0x0][_0x4eaf86(0x1e4)]==_0x4eaf86(0x253))var _0x4eab3d=users[_0x4eaf86(0x253)];else{if(_0x31ccc9[0x0][_0x4eaf86(0x1e4)]==_0x4eaf86(0x264))var _0x4eab3d=users[_0x4eaf86(0x1db)];else{if(_0x31ccc9[0x0]['language']==_0x4eaf86(0x287))var _0x4eab3d=users[_0x4eaf86(0x287)];else{if(_0x31ccc9[0x0][_0x4eaf86(0x1e4)]=='Arabic\x20(ae)')var _0x4eab3d=users['Arabic'];}}}}}}}_0x2a37e3[_0x4eaf86(0x255)](_0x4eaf86(0x211),{'success':_0x1ba583[_0x4eaf86(0x1a7)](_0x4eaf86(0x179)),'errors':_0x1ba583[_0x4eaf86(0x1a7)](_0x4eaf86(0x1e5)),'purchases':_0x367adf,'role':_0x3e855a,'profile':_0x7204d8,'master_shop':_0x31ccc9,'language':_0x4eab3d});}catch(_0x3ecb9a){console['log'](_0x4eaf86(0x260),_0x3ecb9a),_0x2a37e3[_0x4eaf86(0x246)](0xc8)[_0x4eaf86(0x1e6)]({'message':_0x3ecb9a[_0x4eaf86(0x19b)]});}});function a0_0x1565(_0x327b18,_0xf28773){var _0x4fe420=a0_0x4fe4();return a0_0x1565=function(_0x156510,_0x37596b){_0x156510=_0x156510-0x163;var _0x3ab273=_0x4fe420[_0x156510];return _0x3ab273;},a0_0x1565(_0x327b18,_0xf28773);}function BayBinSelected(_0x173a27,_0x589d40){var _0x42dff7=a0_0x27564f,_0x52f40f=[],_0x50e5e1=[];if(_0x173a27==_0x42dff7(0x197)){switch(_0x589d40){case _0x42dff7(0x23f):_0x52f40f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x52f40f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x50e5e1=['DG'];}else{if(_0x173a27==_0x42dff7(0x1a3)){switch(_0x589d40){case'Rack\x201':_0x52f40f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x42dff7(0x1b3):_0x52f40f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x50e5e1=['FG'];}}return{'levels':_0x52f40f,'identify':_0x50e5e1};}async function getRandom8DigitNumber(){var _0xa5184f=a0_0x27564f;const _0x3b118e=0x989680,_0x302628=0x5f5e0ff,_0x97257b=Math[_0xa5184f(0x209)](Math[_0xa5184f(0x286)]()*(_0x302628-_0x3b118e+0x1))+_0x3b118e;var _0x207cf9;const _0x3f3c46=await purchases_finished[_0xa5184f(0x1dc)]({'invoice':_0xa5184f(0x1f2)+_0x97257b});return _0x3f3c46&&_0x3f3c46[_0xa5184f(0x21b)]>0x0?_0x207cf9=_0xa5184f(0x1f2)+_0x97257b:_0x207cf9=_0xa5184f(0x1f2)+_0x97257b,_0x207cf9;}router['get'](a0_0x27564f(0x2ae),auth,async(_0x12abb6,_0x1a941c)=>{var _0x4ce094=a0_0x27564f;try{const {username:_0x173954,email:_0x225d85,role:_0x5ceb84}=_0x12abb6[_0x4ce094(0x23d)],_0x10d209=_0x12abb6[_0x4ce094(0x23d)],_0x39bb3e=await profile['findOne']({'email':_0x10d209[_0x4ce094(0x240)]}),_0x35fe99=await master_shop['find'](),_0x49726c=await staff[_0x4ce094(0x1dc)]({'email':_0x10d209[_0x4ce094(0x240)]}),_0x4affa8=await suppliers[_0x4ce094(0x188)]({});let _0x55f569;if(_0x10d209[_0x4ce094(0x1e0)]=='staff'){const _0x543833=await staff[_0x4ce094(0x1dc)]({'email':_0x10d209['email']});_0x55f569=await warehouse[_0x4ce094(0x185)]([{'$match':{'status':'Enabled','name':_0x543833[_0x4ce094(0x221)]}},{'$group':{'_id':_0x4ce094(0x273),'name':{'$first':_0x4ce094(0x273)}}}]);}else _0x55f569=await warehouse[_0x4ce094(0x185)]([{'$match':{'status':_0x4ce094(0x1f3)}},{'$group':{'_id':'$name','name':{'$first':_0x4ce094(0x273)}}}]);const _0x13e8ef=await product[_0x4ce094(0x188)]({}),_0x194cdd=await warehouse['find']({'status':_0x4ce094(0x1f3)}),_0x34928a=await purchases_finished['find']({}),_0x353c3a=_0x34928a['length']+0x1,_0x251d9c=_0x4ce094(0x1f2)+_0x353c3a['toString']()[_0x4ce094(0x1f0)](0x5,'0');var _0x4dff68=['Ambient',_0x4ce094(0x1f4)];if(_0x35fe99[0x0][_0x4ce094(0x1e4)]==_0x4ce094(0x239))var _0x3b3c92=users[_0x4ce094(0x170)];else{if(_0x35fe99[0x0][_0x4ce094(0x1e4)]=='Hindi')var _0x3b3c92=users[_0x4ce094(0x16c)];else{if(_0x35fe99[0x0][_0x4ce094(0x1e4)]==_0x4ce094(0x174))var _0x3b3c92=users[_0x4ce094(0x174)];else{if(_0x35fe99[0x0]['language']=='Spanish')var _0x3b3c92=users[_0x4ce094(0x1f1)];else{if(_0x35fe99[0x0][_0x4ce094(0x1e4)]==_0x4ce094(0x253))var _0x3b3c92=users[_0x4ce094(0x253)];else{if(_0x35fe99[0x0][_0x4ce094(0x1e4)]==_0x4ce094(0x264))var _0x3b3c92=users[_0x4ce094(0x1db)];else{if(_0x35fe99[0x0]['language']==_0x4ce094(0x287))var _0x3b3c92=users['Chinese'];else{if(_0x35fe99[0x0][_0x4ce094(0x1e4)]==_0x4ce094(0x228))var _0x3b3c92=users[_0x4ce094(0x1c9)];}}}}}}}const _0x13d95a=getRandom8DigitNumber(),_0x45ce36=new Date(),_0x5f4686={'year':_0x4ce094(0x1ca),'month':_0x4ce094(0x1b4),'day':'2-digit','timeZone':_0x4ce094(0x219)},_0x1fc7bf=_0x45ce36[_0x4ce094(0x1dd)](_0x4ce094(0x164),_0x5f4686);console[_0x4ce094(0x19f)](_0x1fc7bf),_0x13d95a[_0x4ce094(0x18b)](_0x390832=>{var _0x1f1316=_0x4ce094;_0x1a941c[_0x1f1316(0x255)](_0x1f1316(0x1a6),{'success':_0x12abb6[_0x1f1316(0x1a7)](_0x1f1316(0x179)),'errors':_0x12abb6[_0x1f1316(0x1a7)]('errors'),'role':_0x10d209,'profile':_0x39bb3e,'suppliers':_0x4affa8,'warehouse':_0x55f569,'product':_0x13e8ef,'invoice':_0x390832,'master_shop':_0x35fe99,'language':_0x3b3c92,'find_data':_0x194cdd,'rooms_data':_0x4dff68,'formattedDate':_0x1fc7bf});})[_0x4ce094(0x27e)](_0x10c02c=>{var _0xee0440=_0x4ce094;_0x12abb6[_0xee0440(0x1a7)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1a941c[_0xee0440(0x25f)](_0xee0440(0x1af));});}catch(_0x3a5fa1){console[_0x4ce094(0x19f)](_0x3a5fa1);}}),router['get']('/view/add_purchases_logs',auth,async(_0x15b797,_0xb283a6)=>{var _0x415e83=a0_0x27564f;try{const {username:_0x29cd39,email:_0x4aec50,role:_0x4202c0}=_0x15b797['user'],_0xdbf91=_0x15b797[_0x415e83(0x23d)],_0x437dcd=await profile['findOne']({'email':_0xdbf91['email']}),_0x126e43=await master_shop[_0x415e83(0x188)](),_0x1f23d3=await staff['findOne']({'email':_0xdbf91[_0x415e83(0x240)]}),_0x583103=await suppliers[_0x415e83(0x188)]({});let _0x123ab7;if(_0xdbf91['role']==_0x415e83(0x294)){const _0x1e7a66=await staff[_0x415e83(0x1dc)]({'email':_0xdbf91['email']});_0x123ab7=await warehouse[_0x415e83(0x185)]([{'$match':{'status':_0x415e83(0x1f3),'name':_0x1e7a66[_0x415e83(0x221)]}},{'$group':{'_id':_0x415e83(0x273),'name':{'$first':_0x415e83(0x273)}}}]);}else _0x123ab7=await warehouse[_0x415e83(0x185)]([{'$match':{'status':_0x415e83(0x1f3)}},{'$group':{'_id':_0x415e83(0x273),'name':{'$first':_0x415e83(0x273)}}}]);const _0x37dd93=await product['find']({}),_0xd065b=await warehouse[_0x415e83(0x188)]({'status':_0x415e83(0x1f3)}),_0x3cc8d4=await purchases_finished['find']({}),_0x17da5d=_0x3cc8d4['length']+0x1,_0x305ee6=_0x415e83(0x1f2)+_0x17da5d[_0x415e83(0x1fc)]()['padStart'](0x5,'0');var _0x5ca13f=[_0x415e83(0x293),_0x415e83(0x1f4)];if(_0x126e43[0x0]['language']==_0x415e83(0x239))var _0x4edcd5=users[_0x415e83(0x170)];else{if(_0x126e43[0x0][_0x415e83(0x1e4)]=='Hindi')var _0x4edcd5=users[_0x415e83(0x16c)];else{if(_0x126e43[0x0]['language']=='German')var _0x4edcd5=users[_0x415e83(0x174)];else{if(_0x126e43[0x0][_0x415e83(0x1e4)]=='Spanish')var _0x4edcd5=users[_0x415e83(0x1f1)];else{if(_0x126e43[0x0]['language']==_0x415e83(0x253))var _0x4edcd5=users['French'];else{if(_0x126e43[0x0][_0x415e83(0x1e4)]==_0x415e83(0x264))var _0x4edcd5=users['Portuguese'];else{if(_0x126e43[0x0][_0x415e83(0x1e4)]==_0x415e83(0x287))var _0x4edcd5=users[_0x415e83(0x287)];else{if(_0x126e43[0x0][_0x415e83(0x1e4)]==_0x415e83(0x228))var _0x4edcd5=users[_0x415e83(0x1c9)];}}}}}}}const _0x1aee0b=getRandom8DigitNumber();_0x1aee0b[_0x415e83(0x18b)](_0x41e1aa=>{var _0x54605e=_0x415e83;_0xb283a6[_0x54605e(0x255)]('add_purchases_finished_logs',{'success':_0x15b797['flash']('success'),'errors':_0x15b797[_0x54605e(0x1a7)](_0x54605e(0x1e5)),'role':_0xdbf91,'profile':_0x437dcd,'suppliers':_0x583103,'warehouse':_0x123ab7,'product':_0x37dd93,'invoice':_0x41e1aa,'master_shop':_0x126e43,'language':_0x4edcd5,'find_data':_0xd065b,'rooms_data':_0x5ca13f});})[_0x415e83(0x27e)](_0x2d98e8=>{var _0x3fbcdd=_0x415e83;_0x15b797[_0x3fbcdd(0x1a7)](_0x3fbcdd(0x1e5),_0x3fbcdd(0x1b6)),_0xb283a6[_0x3fbcdd(0x25f)](_0x3fbcdd(0x1af));});}catch(_0x434b6d){console[_0x415e83(0x19f)](_0x434b6d);}}),router[a0_0x27564f(0x1d9)](a0_0x27564f(0x1e3),auth,async(_0x241ff2,_0x3f978c)=>{var _0x22ae83=a0_0x27564f;try{const _0x2321e2=_0x241ff2[_0x22ae83(0x1cf)]['id'];console[_0x22ae83(0x19f)](_0x2321e2);const _0x3f967a=await master_shop[_0x22ae83(0x188)]();console[_0x22ae83(0x19f)]('master',_0x3f967a);const _0x12ae9d=await product[_0x22ae83(0x1dc)]({'name':_0x2321e2});console[_0x22ae83(0x19f)]('product',_0x12ae9d),_0x3f978c[_0x22ae83(0x246)](0xc8)[_0x22ae83(0x1e6)]({'product_data':_0x12ae9d,'master':_0x3f967a});}catch(_0x124902){console[_0x22ae83(0x19f)](_0x22ae83(0x19d),_0x124902);}}),router[a0_0x27564f(0x24f)](a0_0x27564f(0x2ae),auth,async(_0x2b26f7,_0x4d3156)=>{var _0x1e7e53=a0_0x27564f;try{const {invoice:_0x20bff9,date:_0x299a8f,warehouse_name:_0x3e7ba4,prod_name:_0x14a7f2,note:_0x2c2dc0,due_amount:_0x4f63c3,Room_name:_0x510123,PO_number:_0x129533,SCRN:_0x1d03a6,ReqBy:_0x34d366,dateofreq:_0x2481a6,suppliers:_0x15f393,typeservicesData:_0x5346c5,van:_0x4c9c87,typevehicle:_0x49af05,driver:_0x44c71c,plate:_0x1f630e,DRSI:_0x34f19c,TSU:_0x27ff4e,TFU:_0x6b006c,JO_number:_0x2beca0,type_of_products:_0x247188}=_0x2b26f7['body'];if(typeof _0x14a7f2==_0x1e7e53(0x1d8))var _0xe60ea=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x233)]],_0x820e33=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x17c)]],_0xf600e6=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x259)]],_0x59d2b4=[_0x2b26f7[_0x1e7e53(0x1c8)]['prod_primunit']],_0x5ea519=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x238)]],_0x42a3e5=[_0x2b26f7[_0x1e7e53(0x1c8)]['primary_code']],_0x390e18=[_0x2b26f7['body']['secondary_code']],_0x68d774=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x1e1)]],_0x1f8751=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x224)]],_0x56914b=[_0x2b26f7['body'][_0x1e7e53(0x269)]],_0x269ad8=[_0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x182)]],_0x2124e1=[_0x2b26f7[_0x1e7e53(0x1c8)]['max_product_unit']],_0x5b1358=[_0x2b26f7['body']['prod_cat']],_0x395408=[_0x2b26f7['body'][_0x1e7e53(0x1cb)]],_0xc3d51a=[_0x2b26f7[_0x1e7e53(0x1c8)]['uuid']],_0x26045f=[_0x2b26f7['body'][_0x1e7e53(0x18a)]],_0x37b46b=[_0x2b26f7[_0x1e7e53(0x1c8)]['product_id']];else var _0xe60ea=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x233)]],_0x820e33=[..._0x2b26f7['body']['prod_code']],_0xf600e6=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x259)]],_0x59d2b4=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x20b)]],_0x5ea519=[..._0x2b26f7['body'][_0x1e7e53(0x238)]],_0x42a3e5=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x21a)]],_0x390e18=[..._0x2b26f7['body'][_0x1e7e53(0x192)]],_0x68d774=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x1e1)]],_0x1f8751=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x224)]],_0x56914b=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x269)]],_0x269ad8=[..._0x2b26f7['body']['product_date']],_0x2124e1=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x186)]],_0x5b1358=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x2ad)]],_0x395408=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x1cb)]],_0xc3d51a=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x27b)]],_0x26045f=[..._0x2b26f7['body'][_0x1e7e53(0x18a)]],_0x37b46b=[..._0x2b26f7[_0x1e7e53(0x1c8)][_0x1e7e53(0x17d)]];const _0x54821e=_0xe60ea[_0x1e7e53(0x250)](_0xe3a03=>{return _0xe3a03={'product_name':_0xe3a03};});_0x37b46b[_0x1e7e53(0x25a)]((_0x3566d0,_0x24842c)=>{var _0x27aa8b=_0x1e7e53;_0x54821e[_0x24842c][_0x27aa8b(0x17d)]=_0x3566d0,_0x54821e[_0x24842c][_0x27aa8b(0x210)]=_0x299a8f;}),_0x26045f['forEach']((_0x11d7c7,_0x1113f3)=>{var _0x82738c=_0x1e7e53;_0x54821e[_0x1113f3][_0x82738c(0x25c)]=_0x11d7c7;}),_0x820e33['forEach']((_0x149430,_0x2c5725)=>{var _0xa50a4f=_0x1e7e53;_0x54821e[_0x2c5725][_0xa50a4f(0x1ae)]=_0x149430;}),_0xc3d51a[_0x1e7e53(0x25a)]((_0x2c4393,_0x54286b)=>{var _0x2f0f36=_0x1e7e53;_0x54821e[_0x54286b][_0x2f0f36(0x27b)]=_0x2c4393;}),_0xf600e6[_0x1e7e53(0x25a)]((_0x2cf953,_0x1671a2)=>{var _0x545782=_0x1e7e53;_0x54821e[_0x1671a2][_0x545782(0x232)]=Math['abs'](_0x2cf953);}),_0x59d2b4[_0x1e7e53(0x25a)]((_0x43b77d,_0x45b124)=>{_0x54821e[_0x45b124]['standard_unit']=_0x43b77d;}),_0x5ea519[_0x1e7e53(0x25a)]((_0x2d7243,_0x2dda27)=>{var _0x56f5bc=_0x1e7e53;_0x54821e[_0x2dda27][_0x56f5bc(0x22b)]=_0x2d7243;}),_0x42a3e5[_0x1e7e53(0x25a)]((_0xeb6552,_0x4b96cf)=>{var _0x892537=_0x1e7e53;_0x54821e[_0x4b96cf][_0x892537(0x21a)]=_0xeb6552;}),_0x390e18[_0x1e7e53(0x25a)]((_0x58bbf6,_0x13eb56)=>{_0x54821e[_0x13eb56]['secondary_code']=_0x58bbf6;}),_0x68d774['forEach']((_0x1683f9,_0x290f1b)=>{var _0x25844c=_0x1e7e53;_0x54821e[_0x290f1b][_0x25844c(0x1c1)]=_0x1683f9;}),_0x1f8751[_0x1e7e53(0x25a)]((_0x15c4b3,_0x55e8bb)=>{var _0x1f27a9=_0x1e7e53;_0x54821e[_0x55e8bb][_0x1f27a9(0x224)]=_0x15c4b3;}),_0x56914b[_0x1e7e53(0x25a)]((_0x118a89,_0x418193)=>{var _0x53ddaf=_0x1e7e53;_0x54821e[_0x418193][_0x53ddaf(0x269)]=_0x118a89;}),_0x269ad8[_0x1e7e53(0x25a)]((_0x199ce6,_0x2f721c)=>{var _0x2ab00d=_0x1e7e53;_0x54821e[_0x2f721c][_0x2ab00d(0x21d)]=_0x199ce6;}),_0x2124e1['forEach']((_0x4865e5,_0x6c047b)=>{var _0x2ab12d=_0x1e7e53;_0x54821e[_0x6c047b][_0x2ab12d(0x271)]=_0x4865e5;}),_0x5b1358[_0x1e7e53(0x25a)]((_0x342ad3,_0x31f40e)=>{_0x54821e[_0x31f40e]['product_cat']=_0x342ad3;}),_0x395408[_0x1e7e53(0x25a)]((_0x3424db,_0x3d2dcb)=>{_0x54821e[_0x3d2dcb]['gross_price']=_0x3424db;});const _0x5e731a=new invoice_for_incoming();await _0x5e731a[_0x1e7e53(0x212)]();for(let _0x5dd42b=0x0;_0x5dd42b<=_0xe60ea[_0x1e7e53(0x21b)]-0x1;_0x5dd42b++){_0x54821e[_0x5dd42b][_0x1e7e53(0x1b1)]='INC-'+_0x5e731a[_0x1e7e53(0x229)]['toString']()['padStart'](0x8,'0');}const _0x448789=await warehouse_validation_setup['aggregate']([{'$match':{'warehouse_name':_0x3e7ba4}}]);for(let _0x570c75=0x0;_0x570c75<=_0x448789[_0x1e7e53(0x21b)]-0x1;_0x570c75++){const _0x55f015=_0x448789[_0x570c75];for(let _0x2afac2=0x0;_0x2afac2<=_0x55f015['product_data'][_0x1e7e53(0x21b)]-0x1;_0x2afac2++){const _0x5b823c=_0x55f015[_0x1e7e53(0x28a)][_0x2afac2],_0xa4cf13=await warehouse[_0x1e7e53(0x185)]([{'$match':{'name':_0x55f015[_0x1e7e53(0x2a1)],'room':_0x55f015[_0x1e7e53(0x1e8)]}},{'$unwind':'$product_details'},{'$match':{'product_details.level':_0x5b823c[_0x1e7e53(0x252)],'product_details.bay':parseInt(_0x5b823c['bin']),'product_details.product_code':_0x5b823c[_0x1e7e53(0x1ae)]}}]);for(let _0x5262eb=0x0;_0x5262eb<=_0xa4cf13[_0x1e7e53(0x21b)]-0x1;_0x5262eb++){let _0x34d793=_0xa4cf13[_0x5262eb],_0x1c2878=0x0;_0x34d793[_0x1e7e53(0x178)]['product_code']==_0x5b823c['product_code']&&_0x34d793[_0x1e7e53(0x178)][_0x1e7e53(0x252)]==_0x5b823c[_0x1e7e53(0x1e7)]&&_0x34d793[_0x1e7e53(0x178)]['level']==_0x5b823c[_0x1e7e53(0x252)]&&(_0x5b823c[_0x1e7e53(0x1a8)]=parseInt(_0x5b823c[_0x1e7e53(0x1a8)])-parseInt(_0x34d793[_0x1e7e53(0x178)]['product_stock']),_0x1c2878++),_0x1c2878=='0'&&(parseInt(_0x5b823c[_0x1e7e53(0x1a8)])>0x0&&(_0x448789[_0x570c75][_0x1e7e53(0x28a)]=_0x448789[_0x570c75][_0x1e7e53(0x28a)][_0x1e7e53(0x27c)]({'bay':_0x5b823c[_0x1e7e53(0x252)],'bin':_0x5b823c[_0x1e7e53(0x1e7)],'max':_0x5b823c['max'],'min':_0x5b823c['min'],'product_code':_0x5b823c[_0x1e7e53(0x1ae)],'product_id':_0x5b823c[_0x1e7e53(0x17d)],'product_name':_0x5b823c[_0x1e7e53(0x16f)]})));}}_0x448789[_0x570c75][_0x1e7e53(0x28a)]=_0x448789[_0x570c75][_0x1e7e53(0x28a)][_0x1e7e53(0x22a)](_0x2c4f21=>parseInt(_0x2c4f21[_0x1e7e53(0x1a8)])>0x0);}for(let _0x7d0990=0x0;_0x7d0990<=_0x448789[_0x1e7e53(0x21b)]-0x1;_0x7d0990++){const _0x483290=_0x448789[_0x7d0990];for(let _0x3c4121=0x0;_0x3c4121<=_0x483290[_0x1e7e53(0x28a)][_0x1e7e53(0x21b)]-0x1;_0x3c4121++){const _0x516e37=_0x483290['product_data'][_0x3c4121],_0x3b25a6=await warehouse_temporary[_0x1e7e53(0x185)]([{'$match':{'warehouse':_0x483290[_0x1e7e53(0x2a1)],'room_name':_0x483290[_0x1e7e53(0x1e8)],'isConfirm':'false','data_type':'inc','product_code':_0x516e37[_0x1e7e53(0x1ae)],'level':_0x516e37[_0x1e7e53(0x252)],'bay':parseInt(_0x516e37[_0x1e7e53(0x1e7)])}}]);for(let _0x498809=0x0;_0x498809<=_0x3b25a6[_0x1e7e53(0x21b)]-0x1;_0x498809++){let _0x6aadee=_0x3b25a6[_0x498809];console[_0x1e7e53(0x19f)](_0x6aadee);let _0x5663d0=0x0;_0x6aadee[_0x1e7e53(0x1ae)]==_0x516e37[_0x1e7e53(0x1ae)]&&_0x6aadee[_0x1e7e53(0x252)]==_0x516e37[_0x1e7e53(0x1e7)]&&_0x6aadee['level']==_0x516e37[_0x1e7e53(0x252)]&&(_0x516e37['max']=parseInt(_0x516e37['max'])-parseInt(_0x6aadee['product_stock']),_0x5663d0++),_0x5663d0=='0'&&(parseInt(_0x516e37[_0x1e7e53(0x1a8)])>0x0&&(_0x448789[_0x7d0990][_0x1e7e53(0x28a)]=_0x448789[_0x7d0990][_0x1e7e53(0x28a)]['concat']({'bay':_0x516e37[_0x1e7e53(0x252)],'bin':_0x516e37[_0x1e7e53(0x1e7)],'max':_0x516e37['max'],'min':_0x516e37[_0x1e7e53(0x29f)],'product_code':_0x516e37[_0x1e7e53(0x1ae)],'product_id':_0x516e37['product_id'],'product_name':_0x516e37[_0x1e7e53(0x16f)]})));}}_0x448789[_0x7d0990][_0x1e7e53(0x28a)]=_0x448789[_0x7d0990]['product_data']['filter'](_0x54691c=>parseInt(_0x54691c['max'])>0x0);}let _0x46f26d=[],_0x50e091=0x0;for(let _0x2b7ca6=0x0;_0x2b7ca6<=_0x54821e[_0x1e7e53(0x21b)]-0x1;_0x2b7ca6++){const _0xe0e694=_0x54821e[_0x2b7ca6];let _0x308ff4=_0xe0e694['quantity'];for(let _0x235103=0x0;_0x235103<=_0x448789[_0x1e7e53(0x21b)]-0x1;_0x235103++){const _0x3feb56=_0x448789[_0x235103];for(let _0x678612=0x0;_0x678612<=_0x3feb56[_0x1e7e53(0x28a)][_0x1e7e53(0x21b)]-0x1;_0x678612++){const _0x5dc122=_0x3feb56['product_data'][_0x678612];if(_0x5dc122[_0x1e7e53(0x1ae)]===_0xe0e694[_0x1e7e53(0x1ae)]){const _0x1088b6=await warehouse[_0x1e7e53(0x185)]([{'$match':{'name':_0x3e7ba4,'room':_0x3feb56[_0x1e7e53(0x1e8)]}},{'$unwind':_0x1e7e53(0x251)},{'$match':{'product_details.level':_0x5dc122[_0x1e7e53(0x252)],'product_details.bay':parseInt(_0x5dc122[_0x1e7e53(0x1e7)])}}]);if(_0x1088b6[_0x1e7e53(0x21b)]==0x0){for(let _0x3e9c07=0x0;_0x3e9c07<=_0x3feb56[_0x1e7e53(0x28a)][_0x1e7e53(0x21b)]-0x1&&_0x308ff4>0x0;_0x3e9c07++){const _0x33cb3c=_0x3feb56[_0x1e7e53(0x28a)][_0x3e9c07];console[_0x1e7e53(0x19f)](_0xe0e694[_0x1e7e53(0x1ae)]+'==='+_0x33cb3c[_0x1e7e53(0x1ae)]+'\x20<>\x20'+_0x33cb3c[_0x1e7e53(0x29f)]+'\x20<>\x20'+_0x33cb3c[_0x1e7e53(0x1a8)]+'\x20<>\x20'+_0x33cb3c[_0x1e7e53(0x252)]+_0x1e7e53(0x27f)+_0x33cb3c[_0x1e7e53(0x1e7)]);if(_0xe0e694[_0x1e7e53(0x1ae)]===_0x33cb3c[_0x1e7e53(0x1ae)]){_0x46f26d[_0x50e091]={};const _0x3f757a=parseInt(_0x33cb3c[_0x1e7e53(0x1a8)]),_0x95bcd1=0x0;let _0x3fef70=_0x3f757a-_0x95bcd1,_0x3c7c19=Math['min'](_0x308ff4,_0x3fef70);console[_0x1e7e53(0x19f)]('Distributing\x20'+_0x3c7c19+_0x1e7e53(0x17a)+_0xe0e694[_0x1e7e53(0x16f)]+_0x1e7e53(0x20a)+_0x3feb56[_0x1e7e53(0x2a1)]+_0x1e7e53(0x1a1)+_0x3feb56[_0x1e7e53(0x1e8)]+_0x1e7e53(0x249)+_0x33cb3c[_0x1e7e53(0x252)]+_0x1e7e53(0x28c)+_0x33cb3c[_0x1e7e53(0x1e7)]+'\x20inc\x20=\x20'+_0x50e091),_0x46f26d[_0x50e091][_0x1e7e53(0x16f)]=_0xe0e694[_0x1e7e53(0x16f)],_0x46f26d[_0x50e091]['product_code']=_0xe0e694['product_code'],_0x46f26d[_0x50e091][_0x1e7e53(0x17d)]=_0xe0e694[_0x1e7e53(0x17d)],_0x46f26d[_0x50e091][_0x1e7e53(0x210)]=_0xe0e694[_0x1e7e53(0x210)],_0x46f26d[_0x50e091][_0x1e7e53(0x25c)]=_0xe0e694['sales_category'],_0x46f26d[_0x50e091][_0x1e7e53(0x27b)]=_0xe0e694['uuid'],_0x46f26d[_0x50e091][_0x1e7e53(0x232)]=_0x3c7c19,_0x46f26d[_0x50e091][_0x1e7e53(0x1e2)]=_0xe0e694[_0x1e7e53(0x1e2)],_0x46f26d[_0x50e091][_0x1e7e53(0x22b)]=_0xe0e694[_0x1e7e53(0x22b)],_0x46f26d[_0x50e091]['primary_code']=_0xe0e694[_0x1e7e53(0x21a)],_0x46f26d[_0x50e091][_0x1e7e53(0x192)]=_0xe0e694['secondary_code'],_0x46f26d[_0x50e091][_0x1e7e53(0x1c1)]=_0xe0e694[_0x1e7e53(0x1c1)],_0x46f26d[_0x50e091]['batch_code']=_0xe0e694[_0x1e7e53(0x224)],_0x46f26d[_0x50e091][_0x1e7e53(0x269)]=_0xe0e694[_0x1e7e53(0x269)],_0x46f26d[_0x50e091][_0x1e7e53(0x21d)]=_0xe0e694[_0x1e7e53(0x21d)],_0x46f26d[_0x50e091][_0x1e7e53(0x271)]=_0xe0e694[_0x1e7e53(0x271)],_0x46f26d[_0x50e091][_0x1e7e53(0x1fb)]=_0xe0e694[_0x1e7e53(0x1fb)],_0x46f26d[_0x50e091]['invoice']=_0xe0e694[_0x1e7e53(0x1b1)],_0x46f26d[_0x50e091][_0x1e7e53(0x1cb)]=_0xe0e694[_0x1e7e53(0x1cb)],_0x46f26d[_0x50e091][_0x1e7e53(0x275)]=_0x3feb56['room'],_0x46f26d[_0x50e091][_0x1e7e53(0x26d)]=_0x33cb3c['bay'],_0x46f26d[_0x50e091][_0x1e7e53(0x252)]=_0x33cb3c[_0x1e7e53(0x1e7)],_0x308ff4-=_0x3c7c19,_0x50e091++;if(_0x308ff4<=0x0)break;}}if(_0x308ff4<=0x0){_0x2b26f7['flash'](_0x1e7e53(0x1e5),_0x1e7e53(0x183)+_0x308ff4+_0x1e7e53(0x278));break;}if(_0x308ff4>0x0){console['log'](_0x1e7e53(0x284)+_0x308ff4+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202');break;}}}}}if(_0x308ff4>0x0){const _0x18edaf=await warehouse[_0x1e7e53(0x185)]([{'$match':{'name':_0x3e7ba4,'isStaging':_0x1e7e53(0x204)}}]);_0x46f26d[_0x50e091]={},_0x46f26d[_0x50e091]['product_name']=_0xe0e694[_0x1e7e53(0x16f)],_0x46f26d[_0x50e091][_0x1e7e53(0x1ae)]=_0xe0e694[_0x1e7e53(0x1ae)],_0x46f26d[_0x50e091][_0x1e7e53(0x17d)]=_0xe0e694['product_id'],_0x46f26d[_0x50e091][_0x1e7e53(0x210)]=_0xe0e694[_0x1e7e53(0x210)],_0x46f26d[_0x50e091][_0x1e7e53(0x25c)]=_0xe0e694['sales_category'],_0x46f26d[_0x50e091][_0x1e7e53(0x27b)]=_0xe0e694[_0x1e7e53(0x27b)],_0x46f26d[_0x50e091][_0x1e7e53(0x232)]=_0x308ff4,_0x46f26d[_0x50e091][_0x1e7e53(0x1e2)]=_0xe0e694[_0x1e7e53(0x1e2)],_0x46f26d[_0x50e091][_0x1e7e53(0x22b)]=_0xe0e694[_0x1e7e53(0x22b)],_0x46f26d[_0x50e091][_0x1e7e53(0x21a)]=_0xe0e694[_0x1e7e53(0x21a)],_0x46f26d[_0x50e091][_0x1e7e53(0x192)]=_0xe0e694[_0x1e7e53(0x192)],_0x46f26d[_0x50e091][_0x1e7e53(0x1c1)]=_0xe0e694[_0x1e7e53(0x1c1)],_0x46f26d[_0x50e091][_0x1e7e53(0x224)]=_0xe0e694[_0x1e7e53(0x224)],_0x46f26d[_0x50e091][_0x1e7e53(0x269)]=_0xe0e694['expiry_date'],_0x46f26d[_0x50e091][_0x1e7e53(0x21d)]=_0xe0e694[_0x1e7e53(0x21d)],_0x46f26d[_0x50e091][_0x1e7e53(0x271)]=_0xe0e694[_0x1e7e53(0x271)],_0x46f26d[_0x50e091][_0x1e7e53(0x1fb)]=_0xe0e694[_0x1e7e53(0x1fb)],_0x46f26d[_0x50e091][_0x1e7e53(0x1b1)]=_0xe0e694[_0x1e7e53(0x1b1)],_0x46f26d[_0x50e091][_0x1e7e53(0x1cb)]=_0xe0e694[_0x1e7e53(0x1cb)],_0x46f26d[_0x50e091][_0x1e7e53(0x275)]=_0x18edaf[0x0][_0x1e7e53(0x1e8)],_0x46f26d[_0x50e091][_0x1e7e53(0x26d)]='STAGING',_0x46f26d[_0x50e091][_0x1e7e53(0x252)]='1',console['log'](_0x1e7e53(0x1bf)+_0x1e7e53(0x27f)+_0xe0e694['product_code']+_0x1e7e53(0x26f)+_0xe0e694['product_code']+_0x1e7e53(0x27f)+_0x50e091+_0x1e7e53(0x27f)+_0x308ff4),_0x2b26f7[_0x1e7e53(0x1a7)](_0x1e7e53(0x1e5),_0x1e7e53(0x183)+_0x308ff4+_0x1e7e53(0x1ab));}}const _0x157a67=_0x46f26d[_0x1e7e53(0x22a)](_0x15c560=>_0x15c560[_0x1e7e53(0x232)]!=='0'&&_0x15c560[_0x1e7e53(0x232)]!==''),_0x3d11e4=new purchases_finished({'invoice':_0x1e7e53(0x1fe)+_0x5e731a['invoice_init'][_0x1e7e53(0x1fc)]()[_0x1e7e53(0x1f0)](0x8,'0'),'suppliers':_0x15f393,'date':_0x299a8f,'warehouse_name':_0x3e7ba4,'product':_0x157a67,'note':_0x2c2dc0,'due_amount':_0x4f63c3,'room':_0x510123,'POnumber':_0x129533,'SCRN':_0x1d03a6,'JO_number':_0x2beca0,'ReqBy':_0x34d366,'dateofreq':_0x2481a6,'typeservicesData':_0x5346c5,'van':_0x4c9c87,'typevehicle':_0x49af05,'driver':_0x44c71c,'plate':_0x1f630e,'DRSI':_0x34f19c,'TSU':_0x27ff4e,'TFU':_0x6b006c,'typeOfProducts':_0x247188}),_0x583f1d=await _0x3d11e4[_0x1e7e53(0x212)](),_0x418b92=await purchases_finished[_0x1e7e53(0x1dc)]({'_id':_0x583f1d[_0x1e7e53(0x20d)][_0x1e7e53(0x2a3)]()});_0x2b26f7['flash'](_0x1e7e53(0x179),'purchase\x20data\x20add\x20successfully'),_0x4d3156[_0x1e7e53(0x25f)](_0x1e7e53(0x21f)+_0x418b92[_0x1e7e53(0x20d)][_0x1e7e53(0x2a3)]());}catch(_0x360d97){console[_0x1e7e53(0x19f)](_0x360d97);}}),router['get'](a0_0x27564f(0x26c),auth,async(_0x371db2,_0xacd9b5)=>{var _0x1226b1=a0_0x27564f;try{const {username:_0x2b4cae,email:_0x4215c9,role:_0x54d329}=_0x371db2['user'],_0x3c24dc=_0x371db2[_0x1226b1(0x23d)],_0x452538=_0x371db2['params']['id'],_0x3045a4=await profile[_0x1226b1(0x1dc)]({'email':_0x3c24dc[_0x1226b1(0x240)]}),_0x4210c9=await master_shop[_0x1226b1(0x188)](),_0x711e4d=await staff[_0x1226b1(0x1dc)]({'email':_0x3c24dc[_0x1226b1(0x240)]}),_0x26f193=await suppliers['find']({});let _0x455f90;if(_0x3c24dc[_0x1226b1(0x1e0)]==_0x1226b1(0x294)){const _0xff208b=await staff[_0x1226b1(0x1dc)]({'email':_0x3c24dc['email']});_0x455f90=await warehouse['aggregate']([{'$match':{'status':_0x1226b1(0x1f3),'name':_0xff208b[_0x1226b1(0x221)]}},{'$group':{'_id':_0x1226b1(0x273),'name':{'$first':_0x1226b1(0x273)}}}]);}else _0x455f90=await warehouse['aggregate']([{'$match':{'status':_0x1226b1(0x1f3)}},{'$group':{'_id':_0x1226b1(0x273),'name':{'$first':_0x1226b1(0x273)}}}]);const _0x408209=await purchases_finished[_0x1226b1(0x24b)](_0x452538);if(_0x4210c9[0x0][_0x1226b1(0x1e4)]==_0x1226b1(0x239))var _0x4a8d44=users[_0x1226b1(0x170)];else{if(_0x4210c9[0x0][_0x1226b1(0x1e4)]==_0x1226b1(0x16c))var _0x4a8d44=users[_0x1226b1(0x16c)];else{if(_0x4210c9[0x0][_0x1226b1(0x1e4)]==_0x1226b1(0x174))var _0x4a8d44=users['German'];else{if(_0x4210c9[0x0][_0x1226b1(0x1e4)]=='Spanish')var _0x4a8d44=users[_0x1226b1(0x1f1)];else{if(_0x4210c9[0x0][_0x1226b1(0x1e4)]==_0x1226b1(0x253))var _0x4a8d44=users['French'];else{if(_0x4210c9[0x0][_0x1226b1(0x1e4)]==_0x1226b1(0x264))var _0x4a8d44=users[_0x1226b1(0x1db)];else{if(_0x4210c9[0x0][_0x1226b1(0x1e4)]==_0x1226b1(0x287))var _0x4a8d44=users[_0x1226b1(0x287)];else{if(_0x4210c9[0x0]['language']=='Arabic\x20(ae)')var _0x4a8d44=users[_0x1226b1(0x1c9)];}}}}}}}_0xacd9b5[_0x1226b1(0x255)](_0x1226b1(0x2ab),{'success':_0x371db2[_0x1226b1(0x1a7)](_0x1226b1(0x179)),'errors':_0x371db2[_0x1226b1(0x1a7)]('errors'),'role':_0x3c24dc,'profile':_0x3045a4,'suppliers':_0x26f193,'warehouse':_0x455f90,'master_shop':_0x4210c9,'language':_0x4a8d44,'purchases_data':_0x408209});}catch(_0x3dd69d){console[_0x1226b1(0x19f)](_0x3dd69d);}});async function get_warehouse_data(_0x58cc3e,_0x5460b1){var _0x5244ae=a0_0x27564f;try{const _0xd7a3e7=await warehouse_temporary[_0x5244ae(0x1dc)]({'name':_0x58cc3e,'room':_0x5460b1});if(!_0xd7a3e7){const _0x2adf97=new warehouse_temporary({'name':_0x58cc3e,'address':_0x58cc3e,'status':_0x5244ae(0x1f3),'room':_0x5460b1,'isStaging':_0x5244ae(0x205)});return await _0x2adf97[_0x5244ae(0x212)](),_0x2adf97;}else return _0xd7a3e7;}catch(_0x535162){console['error']('Error\x20fetching\x20or\x20saving\x20warehouse\x20data:',_0x535162);throw _0x535162;}}router[a0_0x27564f(0x24f)]('/process/:id',auth,async(_0x514f8f,_0x5a43df)=>{var _0x2d35ad=a0_0x27564f;try{const _0x3e818d=_0x514f8f['params']['id'],_0xf8ef1a=await purchases_finished['findById'](_0x3e818d);let _0x32a219=[];_0xf8ef1a[_0x2d35ad(0x235)][_0x2d35ad(0x25a)]((_0x197879,_0x4efa5b)=>{var _0x43912a=_0x2d35ad;_0x32a219[_0x4efa5b]={},_0x32a219[_0x4efa5b][_0x43912a(0x221)]=_0xf8ef1a[_0x43912a(0x2a1)],_0x32a219[_0x4efa5b][_0x43912a(0x17d)]=_0x197879[_0x43912a(0x17d)],_0x32a219[_0x4efa5b]['product_name']=_0x197879['product_name'],_0x32a219[_0x4efa5b][_0x43912a(0x1ae)]=_0x197879[_0x43912a(0x1ae)],_0x32a219[_0x4efa5b][_0x43912a(0x1f5)]=_0x197879[_0x43912a(0x232)],_0x32a219[_0x4efa5b][_0x43912a(0x231)]=_0x197879[_0x43912a(0x1e2)],_0x32a219[_0x4efa5b][_0x43912a(0x22b)]=_0x197879['secondary_unit'],_0x32a219[_0x4efa5b][_0x43912a(0x26d)]=_0x197879['level'],_0x32a219[_0x4efa5b]['bay']=_0x197879[_0x43912a(0x252)],_0x32a219[_0x4efa5b]['primary_code']=_0x197879[_0x43912a(0x21a)],_0x32a219[_0x4efa5b][_0x43912a(0x192)]=_0x197879[_0x43912a(0x192)],_0x32a219[_0x4efa5b][_0x43912a(0x1c1)]=_0x197879['maxStocks'],_0x32a219[_0x4efa5b]['batch_code']=_0x197879[_0x43912a(0x224)],_0x32a219[_0x4efa5b][_0x43912a(0x269)]=_0x197879['expiry_date'],_0x32a219[_0x4efa5b][_0x43912a(0x21d)]=_0x197879[_0x43912a(0x21d)],_0x32a219[_0x4efa5b]['maxperunit']=_0x197879['maxperunit'],_0x32a219[_0x4efa5b]['product_cat']=_0x197879['product_cat'],_0x32a219[_0x4efa5b][_0x43912a(0x275)]=_0x197879[_0x43912a(0x275)],_0x32a219[_0x4efa5b][_0x43912a(0x1b1)]=_0x197879[_0x43912a(0x1b1)],_0x32a219[_0x4efa5b][_0x43912a(0x27b)]=_0x197879['uuid'],_0x32a219[_0x4efa5b][_0x43912a(0x1cb)]=_0x197879[_0x43912a(0x1cb)],_0x32a219[_0x4efa5b][_0x43912a(0x25c)]=_0x197879[_0x43912a(0x25c)],_0x32a219[_0x4efa5b][_0x43912a(0x210)]=_0x197879[_0x43912a(0x210)],_0x32a219[_0x4efa5b][_0x43912a(0x295)]=_0x197879['_id']['valueOf'](),_0x32a219[_0x4efa5b]['data_type']='inc',_0x32a219[_0x4efa5b][_0x43912a(0x2a7)]=_0x43912a(0x204),_0x32a219[_0x4efa5b]['isUsed']=_0x43912a(0x205);});for(let _0xfbf5c9=0x0;_0xfbf5c9<=_0x32a219[_0x2d35ad(0x21b)]-0x1;_0xfbf5c9++){const _0x1cdcdc=_0x32a219[_0xfbf5c9],_0x5ec497=new warehouse_temporary(_0x1cdcdc);await _0x5ec497[_0x2d35ad(0x212)]();}_0xf8ef1a[_0x2d35ad(0x16e)]=_0x2d35ad(0x204),await _0xf8ef1a[_0x2d35ad(0x212)](),_0x514f8f[_0x2d35ad(0x1a7)](_0x2d35ad(0x179),'Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks'),_0x5a43df[_0x2d35ad(0x25f)](_0x2d35ad(0x21f)+_0xf8ef1a[_0x2d35ad(0x20d)][_0x2d35ad(0x2a3)]());}catch(_0x2c82b1){}}),router[a0_0x27564f(0x24f)]('/view/add_purchases_logs',auth,async(_0x1bac0e,_0x2d9682)=>{var _0x4ea8b7=a0_0x27564f;try{const {invoice:_0x48e9be,date:_0x298e38,warehouse_name:_0x5e84ea,prod_name:_0x3a247c,note:_0x51a4f3,due_amount:_0x1f9212,Room_name:_0x542f50,PO_number:_0x5a3fbb,SCRN:_0x29a72f,ReqBy:_0x4c8d9b,dateofreq:_0x2f2e28,suppliers:_0x18d6cd,typeservicesData:_0x3b6e77,van:_0x30c34d,typevehicle:_0x45c303,driver:_0x316d51,plate:_0x11293a,DRSI:_0x47ba96,TSU:_0x83efc1,TFU:_0x532a16,JO_number:_0x5a8a56,type_of_products:_0x3b1fe9}=_0x1bac0e['body'];if(typeof _0x3a247c==_0x4ea8b7(0x1d8))var _0x1cca7e=[_0x1bac0e[_0x4ea8b7(0x1c8)]['prod_name']],_0x47c510=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x17c)]],_0x269b16=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x259)]],_0x2706ac=[_0x1bac0e['body'][_0x4ea8b7(0x20b)]],_0x1d5de5=[_0x1bac0e['body'][_0x4ea8b7(0x238)]],_0xbd170c=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x28e)]],_0x391e4f=[_0x1bac0e['body'][_0x4ea8b7(0x21a)]],_0x4d91ee=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x192)]],_0x59c699=[_0x1bac0e['body']['MaxStocks_data']],_0x2ccbfd=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x224)]],_0x5aaadc=[_0x1bac0e['body'][_0x4ea8b7(0x269)]],_0x354540=[_0x1bac0e['body'][_0x4ea8b7(0x182)]],_0x3f34dd=[_0x1bac0e[_0x4ea8b7(0x1c8)]['max_product_unit']],_0x2ee2aa=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x2ad)]],_0x24543d=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x283)]],_0x2afc8f=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x1cb)]],_0x487b3e=[_0x1bac0e['body'][_0x4ea8b7(0x27b)]],_0x40cffd=[_0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x18a)]],_0x11de09=[_0x1bac0e['body'][_0x4ea8b7(0x1c2)]];else var _0x1cca7e=[..._0x1bac0e[_0x4ea8b7(0x1c8)]['prod_name']],_0x47c510=[..._0x1bac0e['body'][_0x4ea8b7(0x17c)]],_0x269b16=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x259)]],_0x2706ac=[..._0x1bac0e[_0x4ea8b7(0x1c8)]['prod_primunit']],_0x1d5de5=[..._0x1bac0e['body'][_0x4ea8b7(0x238)]],_0xbd170c=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x28e)]],_0x391e4f=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x21a)]],_0x4d91ee=[..._0x1bac0e['body'][_0x4ea8b7(0x192)]],_0x59c699=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x1e1)]],_0x2ccbfd=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x224)]],_0x5aaadc=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x269)]],_0x354540=[..._0x1bac0e['body']['product_date']],_0x3f34dd=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x186)]],_0x2ee2aa=[..._0x1bac0e['body'][_0x4ea8b7(0x2ad)]],_0x24543d=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x283)]],_0x2afc8f=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x1cb)]],_0x487b3e=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x27b)]],_0x40cffd=[..._0x1bac0e['body']['sales_data_cateory']],_0x11de09=[..._0x1bac0e[_0x4ea8b7(0x1c8)][_0x4ea8b7(0x1c2)]];const _0x2ffffb=_0x1cca7e['map'](_0xfc2aeb=>{return _0xfc2aeb={'product_name':_0xfc2aeb};});_0x11de09[_0x4ea8b7(0x25a)]((_0x109ca8,_0x53e52a)=>{_0x2ffffb[_0x53e52a]['type_of_products']=_0x109ca8;}),_0x40cffd[_0x4ea8b7(0x25a)]((_0xd45fd,_0x56e30f)=>{var _0x55f725=_0x4ea8b7;_0x2ffffb[_0x56e30f][_0x55f725(0x25c)]=_0xd45fd;}),_0x47c510['forEach']((_0x66c330,_0x436f50)=>{var _0xc556bc=_0x4ea8b7;_0x2ffffb[_0x436f50][_0xc556bc(0x1ae)]=_0x66c330;}),_0x487b3e[_0x4ea8b7(0x25a)]((_0x7828a2,_0x231ffe)=>{var _0x57f52d=_0x4ea8b7;_0x2ffffb[_0x231ffe][_0x57f52d(0x27b)]=_0x7828a2;}),_0x269b16[_0x4ea8b7(0x25a)]((_0xc1a61b,_0x5aee22)=>{var _0x589d64=_0x4ea8b7;_0x2ffffb[_0x5aee22][_0x589d64(0x232)]=Math[_0x589d64(0x1eb)](_0xc1a61b);}),_0x2706ac[_0x4ea8b7(0x25a)]((_0x487150,_0x3b841f)=>{var _0x199deb=_0x4ea8b7;_0x2ffffb[_0x3b841f][_0x199deb(0x1e2)]=_0x487150;}),_0x1d5de5[_0x4ea8b7(0x25a)]((_0x5ab13a,_0x25b623)=>{var _0x452fd3=_0x4ea8b7;_0x2ffffb[_0x25b623][_0x452fd3(0x22b)]=_0x5ab13a;}),_0xbd170c[_0x4ea8b7(0x25a)]((_0x2b507f,_0xdfa8cc)=>{var _0x5842e7=_0x4ea8b7,_0x4813b1=_0x2b507f[_0x5842e7(0x16d)](/[A-Za-z]+/)[0x0],_0x2f8dec=parseInt(_0x2b507f['match'](/\d+/)[0x0]);_0x2ffffb[_0xdfa8cc]['level']=_0x4813b1,_0x2ffffb[_0xdfa8cc]['bay']=_0x2f8dec;}),_0x391e4f['forEach']((_0x2fea1e,_0x40fe5b)=>{_0x2ffffb[_0x40fe5b]['primary_code']=_0x2fea1e;}),_0x4d91ee[_0x4ea8b7(0x25a)]((_0x4c5446,_0x493ec3)=>{var _0x37f2de=_0x4ea8b7;_0x2ffffb[_0x493ec3][_0x37f2de(0x192)]=_0x4c5446;}),_0x59c699[_0x4ea8b7(0x25a)]((_0x84915e,_0x5c2278)=>{var _0x543493=_0x4ea8b7;_0x2ffffb[_0x5c2278][_0x543493(0x1c1)]=_0x84915e;}),_0x2ccbfd['forEach']((_0x184633,_0x281357)=>{var _0x53d8b0=_0x4ea8b7;_0x2ffffb[_0x281357][_0x53d8b0(0x224)]=_0x184633;}),_0x5aaadc[_0x4ea8b7(0x25a)]((_0x249659,_0x541da2)=>{var _0x4a1439=_0x4ea8b7;_0x2ffffb[_0x541da2][_0x4a1439(0x269)]=_0x249659;}),_0x354540[_0x4ea8b7(0x25a)]((_0x52807a,_0x2c71e5)=>{var _0x4fd8fd=_0x4ea8b7;_0x2ffffb[_0x2c71e5][_0x4fd8fd(0x21d)]=_0x52807a;}),_0x3f34dd['forEach']((_0x5d6160,_0x36b341)=>{var _0x13a699=_0x4ea8b7;_0x2ffffb[_0x36b341][_0x13a699(0x271)]=_0x5d6160;}),_0x2ee2aa[_0x4ea8b7(0x25a)]((_0x227067,_0x5c0850)=>{_0x2ffffb[_0x5c0850]['product_cat']=_0x227067;}),_0x24543d[_0x4ea8b7(0x25a)]((_0x583bb7,_0x1eb802)=>{var _0xf6dfae=_0x4ea8b7;_0x2ffffb[_0x1eb802][_0xf6dfae(0x275)]=_0x583bb7;}),_0x2afc8f['forEach']((_0x4c3285,_0x4ad6d2)=>{_0x2ffffb[_0x4ad6d2]['gross_price']=_0x4c3285;});const _0x485d1e=new purchases_logs();await _0x485d1e[_0x4ea8b7(0x212)]();for(let _0x3110e5=0x0;_0x3110e5<=_0x24543d['length']-0x1;_0x3110e5++){_0x2ffffb[_0x3110e5]['invoice']='LOG-INC-'+_0x485d1e['invoice_init']['toString']()[_0x4ea8b7(0x1f0)](0x8,'0');}const _0x2ec883=_0x2ffffb[_0x4ea8b7(0x22a)](_0x551650=>_0x551650[_0x4ea8b7(0x232)]!=='0'&&_0x551650[_0x4ea8b7(0x232)]!==''),_0x4d24d3=new purchases_finished({'invoice':'LOG-INC-'+_0x485d1e['invoice_init'][_0x4ea8b7(0x1fc)]()[_0x4ea8b7(0x1f0)](0x8,'0'),'suppliers':_0x18d6cd,'date':_0x298e38,'warehouse_name':_0x5e84ea,'product':_0x2ec883,'note':_0x51a4f3,'due_amount':_0x1f9212,'room':_0x542f50,'POnumber':_0x5a3fbb,'SCRN':_0x29a72f,'JO_number':_0x5a8a56,'ReqBy':_0x4c8d9b,'dateofreq':_0x2f2e28,'typeservicesData':_0x3b6e77,'van':_0x30c34d,'typevehicle':_0x45c303,'driver':_0x316d51,'plate':_0x11293a,'DRSI':_0x47ba96,'TSU':_0x83efc1,'TFU':_0x532a16,'typeOfProducts':_0x3b1fe9}),_0x5a4a1c=await _0x4d24d3[_0x4ea8b7(0x212)](),_0x12e1fd=await purchases_finished[_0x4ea8b7(0x1dc)]({'_id':_0x5a4a1c[_0x4ea8b7(0x20d)][_0x4ea8b7(0x2a3)]()}),_0x58d070=_0x12e1fd[_0x4ea8b7(0x235)][_0x4ea8b7(0x250)](async _0x4bd8a9=>{var _0x2b62ed=_0x4ea8b7;try{var _0x32521b=await warehouse[_0x2b62ed(0x1dc)]({'name':_0x5e84ea,'room':_0x4bd8a9['room_name']}),_0x45f346=0x0;const _0x27ba7a=_0x32521b[_0x2b62ed(0x178)][_0x2b62ed(0x250)](_0x156829=>{var _0xef187=_0x2b62ed;console[_0xef187(0x19f)](_0x156829['product_name']+'=='+_0x4bd8a9[_0xef187(0x16f)]+'&&'+_0x156829['bay']+'=='+_0x4bd8a9[_0xef187(0x252)]+'&&'+_0x156829[_0xef187(0x269)]+'=='+_0x4bd8a9[_0xef187(0x269)]+'&&'+_0x156829[_0xef187(0x21d)]+'=='+_0x4bd8a9[_0xef187(0x21d)]+'&&'+_0x156829['batch_code']+'=='+_0x4bd8a9[_0xef187(0x224)]+'&&'+_0x156829[_0xef187(0x1b1)]+'=='+_0x12e1fd[_0xef187(0x1b1)]),_0x156829[_0xef187(0x16f)]==_0x4bd8a9[_0xef187(0x16f)]&&_0x156829[_0xef187(0x252)]==_0x4bd8a9[_0xef187(0x252)]&&_0x156829[_0xef187(0x26d)]==_0x4bd8a9[_0xef187(0x26d)]&&_0x156829[_0xef187(0x269)]==_0x4bd8a9[_0xef187(0x269)]&&_0x156829[_0xef187(0x21d)]==_0x4bd8a9[_0xef187(0x21d)]&&_0x156829[_0xef187(0x224)]==_0x4bd8a9['batch_code']&&_0x156829['invoice']==_0x12e1fd[_0xef187(0x1b1)]&&(_0x156829[_0xef187(0x1f5)]=Math[_0xef187(0x1eb)](_0x156829[_0xef187(0x1f5)])+Math[_0xef187(0x1eb)](_0x4bd8a9[_0xef187(0x232)]),_0x45f346++);});return _0x45f346==0x0&&(_0x32521b['product_details']=_0x32521b['product_details']['concat']({'product_name':_0x4bd8a9[_0x2b62ed(0x16f)],'product_stock':Math[_0x2b62ed(0x1eb)](_0x4bd8a9['quantity']),'primary_code':_0x4bd8a9['primary_code'],'secondary_code':_0x4bd8a9[_0x2b62ed(0x192)],'product_code':_0x4bd8a9[_0x2b62ed(0x1ae)],'bay':_0x4bd8a9[_0x2b62ed(0x252)],'level':_0x4bd8a9[_0x2b62ed(0x26d)],'maxProducts':_0x4bd8a9[_0x2b62ed(0x1c1)],'unit':_0x4bd8a9['standard_unit'],'secondary_unit':_0x4bd8a9[_0x2b62ed(0x22b)],'expiry_date':_0x4bd8a9[_0x2b62ed(0x269)],'production_date':_0x4bd8a9[_0x2b62ed(0x21d)],'maxProducts':_0x4bd8a9[_0x2b62ed(0x1c1)],'maxPerUnit':_0x4bd8a9[_0x2b62ed(0x271)],'batch_code':_0x4bd8a9[_0x2b62ed(0x224)],'product_cat':_0x4bd8a9[_0x2b62ed(0x1fb)],'invoice':_0x4bd8a9['invoice'],'id_incoming':_0x4bd8a9['_id'],'uuid':_0x4bd8a9[_0x2b62ed(0x27b)],'gross_price':_0x4bd8a9[_0x2b62ed(0x1cb)],'sales_category':_0x4bd8a9['sales_category'],'type_products':_0x4bd8a9[_0x2b62ed(0x1fa)]})),_0x32521b;}catch(_0x4c796c){return console['error']('Error\x20occurred\x20while\x20processing\x20product:',_0x4c796c),null;}});Promise[_0x4ea8b7(0x242)](_0x58d070)[_0x4ea8b7(0x18b)](async _0x3b788d=>{var _0x488692=_0x4ea8b7;try{for(const _0x1642e6 of _0x3b788d){await warehouse[_0x488692(0x258)]({'_id':_0x1642e6['_id']},{'$addToSet':{'product_details':{'$each':_0x1642e6[_0x488692(0x178)]}}});}const _0x907710=await master_shop[_0x488692(0x188)](),_0x3986a5=await email_settings['findOne'](),_0x1e2d3c=await supervisor_settings['find']();var _0x5193e5=_0x12e1fd[_0x488692(0x235)],_0x57bf03='',_0x376011;for(_0x376011 in _0x5193e5){var _0x1fe6c5='FG';_0x12e1fd[_0x488692(0x2a1)]==_0x488692(0x197)&&(_0x1fe6c5='DG'),_0x57bf03+='<tr>'+_0x488692(0x28d)+_0x5193e5[_0x376011]['product_name']+_0x488692(0x24d)+_0x488692(0x28d)+_0x5193e5[_0x376011][_0x488692(0x1ae)]+_0x488692(0x24d)+_0x488692(0x28d)+_0x5193e5[_0x376011]['quantity']+_0x488692(0x24d)+_0x488692(0x28d)+_0x5193e5[_0x376011][_0x488692(0x1e2)]+_0x488692(0x24d)+_0x488692(0x28d)+_0x5193e5[_0x376011][_0x488692(0x22b)]+_0x488692(0x24d)+_0x488692(0x28d)+_0x12e1fd[_0x488692(0x2a1)]+_0x488692(0x24d)+_0x488692(0x28d)+_0x5193e5[_0x376011][_0x488692(0x275)]+_0x488692(0x24d)+_0x488692(0x28d)+_0x1fe6c5+_0x5193e5[_0x376011][_0x488692(0x252)]+_0x488692(0x24d),'</tr>';}let _0x25f2ea=nodemailer['createTransport']({'host':_0x3986a5[_0x488692(0x1da)],'port':Number(_0x3986a5[_0x488692(0x272)]),'secure':![],'auth':{'user':_0x3986a5['email'],'pass':_0x3986a5['password']}}),_0x4e1b3f={'from':_0x3986a5['email'],'to':_0x1e2d3c[0x0][_0x488692(0x1ef)],'subject':_0x488692(0x194),'attachments':[{'filename':_0x488692(0x230),'path':__dirname+_0x488692(0x1ee)+_0x488692(0x29a)+_0x907710[0x0][_0x488692(0x18e)],'cid':_0x488692(0x227)}],'html':_0x488692(0x168)+_0x488692(0x1d3)+_0x488692(0x218)+_0x488692(0x17e)+_0x488692(0x1b7)+_0x488692(0x17e)+_0x488692(0x175)+_0x488692(0x2a8)+'<div>'+_0x488692(0x292)+_0x907710[0x0][_0x488692(0x18f)]+_0x488692(0x280)+_0x488692(0x2a8)+_0x488692(0x2a8)+'<hr\x20class=\x22my-3\x22>'+_0x488692(0x17e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x12e1fd[_0x488692(0x1b1)]+'\x20'+_0x488692(0x193)+_0x488692(0x256)+_0x12e1fd[_0x488692(0x276)]+'\x20'+_0x488692(0x1d1)+_0x488692(0x166)+_0x488692(0x2a8)+_0x488692(0x2a6)+_0x488692(0x189)+'<tr>'+_0x488692(0x2aa)+_0x488692(0x1f7)+_0x488692(0x17f)+_0x488692(0x1ed)+_0x488692(0x21c)+_0x488692(0x1b9)+_0x488692(0x296)+_0x488692(0x2a2)+_0x488692(0x201)+'</thead>'+_0x488692(0x2ac)+'\x20'+_0x57bf03+'\x20'+_0x488692(0x203)+_0x488692(0x1d2)+_0x488692(0x17e)+_0x488692(0x198)+_0x488692(0x1d7)+_0x907710[0x0][_0x488692(0x18f)]+_0x488692(0x166)+'</div>'+'</div>'+_0x488692(0x171)};_0x25f2ea['sendMail'](_0x4e1b3f,function(_0x524dd3,_0x2ddee4){var _0x3932d8=_0x488692;_0x524dd3?(console[_0x3932d8(0x19f)](_0x524dd3),console[_0x3932d8(0x19f)](_0x3932d8(0x1c4))):console[_0x3932d8(0x19f)](_0x3932d8(0x291));});}catch(_0xcf1ebf){console[_0x488692(0x1bb)](_0xcf1ebf),_0x2d9682['status'](0x1f4)[_0x488692(0x1e6)]({'error':_0x488692(0x169),'message':_0xcf1ebf[_0x488692(0x19b)]});}})['catch'](_0xda0cf9=>{console['error'](_0xda0cf9);}),_0x1bac0e['flash'](_0x4ea8b7(0x179),_0x4ea8b7(0x25b)),_0x2d9682[_0x4ea8b7(0x25f)](_0x4ea8b7(0x261)+_0x12e1fd[_0x4ea8b7(0x20d)][_0x4ea8b7(0x2a3)]());}catch(_0x34641c){console[_0x4ea8b7(0x19f)](_0x34641c);}}),router[a0_0x27564f(0x1d9)](a0_0x27564f(0x29d),auth,async(_0x306898,_0x408e74)=>{var _0x351bad=a0_0x27564f;try{const {username:_0x4f81a2,email:_0x449f67,role:_0x35d5cd}=_0x306898[_0x351bad(0x23d)],_0x2de880=_0x306898[_0x351bad(0x23d)],_0x32cfbb=await profile[_0x351bad(0x1dc)]({'email':_0x2de880[_0x351bad(0x240)]}),_0x32e068=await master_shop[_0x351bad(0x188)](),_0x1698e0=_0x306898[_0x351bad(0x1cf)]['id'],_0x41348c=await purchases_finished[_0x351bad(0x24b)](_0x1698e0),_0x34dbd2=await suppliers['find']({});let _0x62e4f0;if(_0x2de880[_0x351bad(0x1e0)]==_0x351bad(0x294)){const _0x43d333=await staff[_0x351bad(0x1dc)]({'email':_0x2de880[_0x351bad(0x240)]});_0x62e4f0=await warehouse['find']({'status':'Enabled','name':_0x43d333['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x62e4f0=await warehouse['aggregate']([{'$match':{'status':_0x351bad(0x1f3),'warehouse_category':_0x351bad(0x26e)}},{'$group':{'_id':_0x351bad(0x273),'name':{'$first':'$name'}}}]);const _0x23abbf=await product[_0x351bad(0x188)]({}),_0x4342e1=BayBinSelected(_0x41348c['warehouse_name'],_0x41348c[_0x351bad(0x1e8)]);let _0xa17360=new Date(_0x41348c[_0x351bad(0x269)]),_0x3a9d26=('0'+_0xa17360['getDate']())[_0x351bad(0x1ce)](-0x2),_0x1d784a=('0'+(_0xa17360[_0x351bad(0x2a4)]()+0x1))[_0x351bad(0x1ce)](-0x2),_0x409294=_0xa17360[_0x351bad(0x190)](),_0x2fee63=_0x409294+'-'+_0x1d784a+'-'+_0x3a9d26;if(_0x32e068[0x0][_0x351bad(0x1e4)]==_0x351bad(0x239)){var _0x207c77=users[_0x351bad(0x170)];console[_0x351bad(0x19f)](_0x207c77);}else{if(_0x32e068[0x0][_0x351bad(0x1e4)]==_0x351bad(0x16c))var _0x207c77=users['Hindi'];else{if(_0x32e068[0x0][_0x351bad(0x1e4)]=='German')var _0x207c77=users[_0x351bad(0x174)];else{if(_0x32e068[0x0]['language']==_0x351bad(0x1f1))var _0x207c77=users[_0x351bad(0x1f1)];else{if(_0x32e068[0x0][_0x351bad(0x1e4)]==_0x351bad(0x253))var _0x207c77=users[_0x351bad(0x253)];else{if(_0x32e068[0x0][_0x351bad(0x1e4)]==_0x351bad(0x264))var _0x207c77=users[_0x351bad(0x1db)];else{if(_0x32e068[0x0][_0x351bad(0x1e4)]==_0x351bad(0x287))var _0x207c77=users[_0x351bad(0x287)];else{if(_0x32e068[0x0][_0x351bad(0x1e4)]==_0x351bad(0x228))var _0x207c77=users[_0x351bad(0x1c9)];}}}}}}}_0x408e74[_0x351bad(0x255)]('edit_purchases_finished_view',{'success':_0x306898['flash'](_0x351bad(0x179)),'errors':_0x306898[_0x351bad(0x1a7)](_0x351bad(0x1e5)),'role':_0x2de880,'profile':_0x32cfbb,'purchases':_0x41348c,'suppliers':_0x34dbd2,'warehouse':_0x62e4f0,'product':_0x23abbf,'master_shop':_0x32e068,'language':_0x207c77,'ed_fullDate':_0x2fee63,'dataSelected':_0x4342e1});}catch(_0x46c028){console[_0x351bad(0x19f)](_0x46c028);}}),router[a0_0x27564f(0x1d9)]('/view/:id',auth,async(_0x1ba110,_0x50858c)=>{var _0x48a3dc=a0_0x27564f;try{const {username:_0x1ec4d0,email:_0x12e7ab,role:_0xbef0e6}=_0x1ba110['user'],_0x5ad3e4=_0x1ba110[_0x48a3dc(0x23d)],_0x134ed8=await profile[_0x48a3dc(0x1dc)]({'email':_0x5ad3e4['email']}),_0x17954c=await master_shop[_0x48a3dc(0x188)](),_0x1b1666=_0x1ba110[_0x48a3dc(0x1cf)]['id'],_0x5b8097=await purchases_finished['findById'](_0x1b1666),_0x4dd421=await suppliers[_0x48a3dc(0x188)]({});let _0x4e7658;if(_0x5ad3e4[_0x48a3dc(0x1e0)]=='staff'){const _0x3d7968=await staff[_0x48a3dc(0x1dc)]({'email':_0x5ad3e4[_0x48a3dc(0x240)]});_0x4e7658=await warehouse[_0x48a3dc(0x188)]({'status':_0x48a3dc(0x1f3),'name':_0x3d7968[_0x48a3dc(0x221)],'warehouse_category':_0x48a3dc(0x26e)});}else _0x4e7658=await warehouse[_0x48a3dc(0x185)]([{'$match':{'status':_0x48a3dc(0x1f3),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x48a3dc(0x273)}}}]);const _0x325cc0=await product[_0x48a3dc(0x188)]({}),_0xc35546=BayBinSelected(_0x5b8097['warehouse_name'],_0x5b8097[_0x48a3dc(0x1e8)]);let _0x27a354=new Date(_0x5b8097[_0x48a3dc(0x269)]),_0x14ded2=('0'+_0x27a354[_0x48a3dc(0x19e)]())[_0x48a3dc(0x1ce)](-0x2),_0x5f58ae=('0'+(_0x27a354['getMonth']()+0x1))[_0x48a3dc(0x1ce)](-0x2),_0x54a19f=_0x27a354[_0x48a3dc(0x190)](),_0x55d9c6=_0x54a19f+'-'+_0x5f58ae+'-'+_0x14ded2;if(_0x17954c[0x0][_0x48a3dc(0x1e4)]==_0x48a3dc(0x239)){var _0x4ac572=users['English'];console[_0x48a3dc(0x19f)](_0x4ac572);}else{if(_0x17954c[0x0][_0x48a3dc(0x1e4)]==_0x48a3dc(0x16c))var _0x4ac572=users[_0x48a3dc(0x16c)];else{if(_0x17954c[0x0]['language']=='German')var _0x4ac572=users['German'];else{if(_0x17954c[0x0]['language']==_0x48a3dc(0x1f1))var _0x4ac572=users['Spanish'];else{if(_0x17954c[0x0][_0x48a3dc(0x1e4)]==_0x48a3dc(0x253))var _0x4ac572=users[_0x48a3dc(0x253)];else{if(_0x17954c[0x0]['language']==_0x48a3dc(0x264))var _0x4ac572=users[_0x48a3dc(0x1db)];else{if(_0x17954c[0x0][_0x48a3dc(0x1e4)]==_0x48a3dc(0x287))var _0x4ac572=users['Chinese'];else{if(_0x17954c[0x0][_0x48a3dc(0x1e4)]==_0x48a3dc(0x228))var _0x4ac572=users[_0x48a3dc(0x1c9)];}}}}}}}_0x50858c['render'](_0x48a3dc(0x1a2),{'success':_0x1ba110[_0x48a3dc(0x1a7)]('success'),'errors':_0x1ba110['flash'](_0x48a3dc(0x1e5)),'role':_0x5ad3e4,'profile':_0x134ed8,'purchases':_0x5b8097,'suppliers':_0x4dd421,'warehouse':_0x4e7658,'product':_0x325cc0,'master_shop':_0x17954c,'language':_0x4ac572,'ed_fullDate':_0x55d9c6,'dataSelected':_0xc35546});}catch(_0x44797a){console[_0x48a3dc(0x19f)](_0x44797a);}}),router[a0_0x27564f(0x24f)](a0_0x27564f(0x1b2),auth,async(_0x2d92db,_0x19d1be)=>{var _0x1e42e7=a0_0x27564f;try{const _0x3a5801=_0x2d92db[_0x1e42e7(0x1cf)]['id'],_0x316051=await purchases_finished[_0x1e42e7(0x1dc)]({'_id':_0x2d92db[_0x1e42e7(0x1cf)]['id']}),_0x1f7c8d=await warehouse[_0x1e42e7(0x1dc)]({'name':_0x316051[_0x1e42e7(0x2a1)],'room':_0x316051['room']});_0x316051[_0x1e42e7(0x235)][_0x1e42e7(0x25a)](_0xb26d38=>{var _0x1d5710=_0x1e42e7;const _0x52f2aa=_0x1f7c8d['product_details'][_0x1d5710(0x250)](_0x178db7=>{var _0x3df5fb=_0x1d5710;_0x178db7[_0x3df5fb(0x16f)]==_0xb26d38[_0x3df5fb(0x16f)]&&_0x178db7['bay']==_0xb26d38[_0x3df5fb(0x252)]&&(_0x178db7[_0x3df5fb(0x1f5)]=parseInt(_0x178db7[_0x3df5fb(0x1f5)])-parseInt(_0xb26d38['quantity']));});}),await _0x1f7c8d[_0x1e42e7(0x212)]();const {invoice:_0xedf63d,suppliers:_0x13d819,date:_0x18de08,warehouse_name:_0x4f1de5,prod_name:_0x51321b,prod_code:_0x42b09,prod_qty:_0x95e9b2,prod_unit:_0x56a60b,prod_secondunit:_0x194bd0,prod_level:_0x53847a,prod_isle:_0x378566,prod_pallet:_0x411f29,note:_0x411ac9,expiry_date:_0x55e522,batch_code:_0x2d0eea,paid_amount:_0x117a09,due_amount:_0x401f0d,Room_name:_0x53f3c3,primary_code:_0x3ebc1f,secondary_code:_0x778787,PO_number:_0x3079d3,JO_number:_0xeb1042}=_0x2d92db[_0x1e42e7(0x1c8)];if(typeof _0x51321b==_0x1e42e7(0x1d8))var _0x27109f=[_0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x233)]],_0x548041=[_0x2d92db['body'][_0x1e42e7(0x17c)]],_0x470e89=[_0x2d92db[_0x1e42e7(0x1c8)]['prod_qty']],_0x2f2728=[_0x2d92db['body'][_0x1e42e7(0x1b8)]],_0x49be34=[_0x2d92db['body'][_0x1e42e7(0x238)]],_0x41be86=[_0x2d92db[_0x1e42e7(0x1c8)]['prod_level']],_0x16d4c0=[_0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x21a)]],_0x5dec16=[_0x2d92db['body'][_0x1e42e7(0x192)]],_0x520913=[_0x2d92db['body'][_0x1e42e7(0x1e1)]],_0x3e5d17=[_0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x224)]],_0x3d672e=[_0x2d92db[_0x1e42e7(0x1c8)]['expiry_date']];else var _0x27109f=[..._0x2d92db['body']['prod_name']],_0x548041=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x17c)]],_0x470e89=[..._0x2d92db[_0x1e42e7(0x1c8)]['prod_qty']],_0x2f2728=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x1b8)]],_0x49be34=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x238)]],_0x41be86=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x28e)]],_0x16d4c0=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x21a)]],_0x5dec16=[..._0x2d92db[_0x1e42e7(0x1c8)]['secondary_code']],_0x520913=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x1e1)]],_0x3e5d17=[..._0x2d92db['body'][_0x1e42e7(0x224)]],_0x3d672e=[..._0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x269)]];const _0x5e64dd=_0x27109f[_0x1e42e7(0x250)](_0x52ca66=>{return _0x52ca66={'product_name':_0x52ca66};});_0x548041['forEach']((_0x217a37,_0x1456d1)=>{_0x5e64dd[_0x1456d1]['product_code']=_0x217a37;}),_0x470e89[_0x1e42e7(0x25a)]((_0x131bc3,_0x414a74)=>{var _0x1790fd=_0x1e42e7;_0x5e64dd[_0x414a74][_0x1790fd(0x232)]=_0x131bc3;}),_0x2f2728[_0x1e42e7(0x25a)]((_0xd31e39,_0x4d6b42)=>{var _0xf45290=_0x1e42e7;_0x5e64dd[_0x4d6b42][_0xf45290(0x1e2)]=_0xd31e39;}),_0x49be34[_0x1e42e7(0x25a)]((_0x3cd8c5,_0x263733)=>{var _0x387e3f=_0x1e42e7;_0x5e64dd[_0x263733][_0x387e3f(0x22b)]=_0x3cd8c5;}),_0x41be86[_0x1e42e7(0x25a)]((_0x869c29,_0x4c0d01)=>{var _0x130fde=_0x1e42e7;_0x5e64dd[_0x4c0d01][_0x130fde(0x252)]=_0x869c29;}),_0x16d4c0[_0x1e42e7(0x25a)]((_0x397f64,_0xe97f5e)=>{var _0x2f83fc=_0x1e42e7;_0x5e64dd[_0xe97f5e][_0x2f83fc(0x21a)]=_0x397f64;}),_0x5dec16[_0x1e42e7(0x25a)]((_0x30e61a,_0x26f6c2)=>{_0x5e64dd[_0x26f6c2]['secondary_code']=_0x30e61a;}),_0x520913[_0x1e42e7(0x25a)]((_0x3381c8,_0x2516a9)=>{var _0x1813c6=_0x1e42e7;_0x5e64dd[_0x2516a9][_0x1813c6(0x1c1)]=_0x3381c8;}),_0x3e5d17[_0x1e42e7(0x25a)]((_0x182d5d,_0x190141)=>{var _0x2d3681=_0x1e42e7;_0x5e64dd[_0x190141][_0x2d3681(0x224)]=_0x182d5d;}),_0x3d672e[_0x1e42e7(0x25a)]((_0x33e3d5,_0x19511b)=>{var _0xbf2148=_0x1e42e7;_0x5e64dd[_0x19511b][_0xbf2148(0x269)]=_0x33e3d5;});const _0x52e8c6=_0x5e64dd[_0x1e42e7(0x22a)](_0x4056b6=>_0x4056b6[_0x1e42e7(0x232)]!=='0'&&_0x4056b6[_0x1e42e7(0x232)]!=='');_0x316051['invoice']=_0xedf63d,_0x316051[_0x1e42e7(0x1ac)]=_0x13d819,_0x316051['date']=_0x18de08,_0x316051[_0x1e42e7(0x2a1)]=_0x4f1de5,_0x316051[_0x1e42e7(0x235)]=_0x52e8c6,_0x316051['note']=_0x411ac9,_0x316051['paid_amount']=_0x117a09,_0x316051[_0x1e42e7(0x187)]=_0x401f0d,_0x316051[_0x1e42e7(0x1e8)]=_0x53f3c3,_0x316051[_0x1e42e7(0x26a)]=_0x3079d3,_0x316051[_0x1e42e7(0x206)]=_0xeb1042;const _0x1a7b97=await _0x316051[_0x1e42e7(0x212)](),_0x1da523=await warehouse[_0x1e42e7(0x1dc)]({'name':_0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x2a1)],'room':_0x2d92db[_0x1e42e7(0x1c8)]['Room_name']});_0x316051[_0x1e42e7(0x235)]['forEach'](_0x160ad5=>{var _0x16ea2a=_0x1e42e7,_0x369ab9=0x0;const _0x31fcd8=_0x1da523[_0x16ea2a(0x178)][_0x16ea2a(0x250)](_0xb7df5f=>{var _0x344dd1=_0x16ea2a;_0xb7df5f[_0x344dd1(0x16f)]==_0x160ad5['product_name']&&_0xb7df5f[_0x344dd1(0x252)]==_0x160ad5[_0x344dd1(0x252)]&&(_0xb7df5f[_0x344dd1(0x1f5)]=parseInt(_0xb7df5f[_0x344dd1(0x1f5)])+parseInt(_0x160ad5[_0x344dd1(0x232)]),_0x369ab9++);});_0x369ab9=='0'&&(_0x1da523[_0x16ea2a(0x178)]=_0x1da523[_0x16ea2a(0x178)][_0x16ea2a(0x27c)]({'product_name':_0x160ad5[_0x16ea2a(0x16f)],'product_stock':_0x160ad5['quantity'],'primary_code':_0x160ad5[_0x16ea2a(0x21a)],'secondary_code':_0x160ad5[_0x16ea2a(0x192)],'product_code':_0x160ad5[_0x16ea2a(0x1ae)],'bay':_0x160ad5[_0x16ea2a(0x252)],'maxProducts':_0x160ad5['maxStocks'],'unit':_0x160ad5[_0x16ea2a(0x1e2)],'secondary_unit':_0x160ad5[_0x16ea2a(0x22b)],'expiry_date':_0x160ad5[_0x16ea2a(0x269)]}));}),await _0x1da523['save']();const _0x451136=await s_payment_data[_0x1e42e7(0x1dc)]({'invoice':_0x2d92db['body'][_0x1e42e7(0x1b1)]});if(_0x451136===null){}else console[_0x1e42e7(0x19f)]('suppliers',_0x451136,_0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x1b1)]),_0x451136['suppliers']=_0x2d92db[_0x1e42e7(0x1c8)][_0x1e42e7(0x1ac)],await _0x451136[_0x1e42e7(0x212)]();_0x2d92db[_0x1e42e7(0x1a7)](_0x1e42e7(0x179),_0x1e42e7(0x1fd)),_0x19d1be['redirect']('/all_purchases_finished/view');}catch(_0x563741){console[_0x1e42e7(0x19f)](_0x563741);}}),router[a0_0x27564f(0x24f)](a0_0x27564f(0x24e),auth,async(_0x5003f1,_0x55dc2c)=>{var _0x3b081b=a0_0x27564f;try{const _0xa8c732=_0x5003f1['params']['id'],{invoice:_0x1f2cd8,suppliers:_0x4898dd,payable:_0x598b6a,due_amount:_0x58c7a3}=_0x5003f1[_0x3b081b(0x1c8)],_0x6abe53=await purchases[_0x3b081b(0x24b)](_0xa8c732);var _0x1f2353=_0x598b6a-_0x58c7a3;_0x6abe53[_0x3b081b(0x216)]=parseFloat(_0x6abe53['paid_amount'])+parseFloat(_0x58c7a3),_0x6abe53['due_amount']=_0x1f2353;const _0x562cb2=await _0x6abe53[_0x3b081b(0x212)]();console[_0x3b081b(0x19f)](_0x562cb2);const _0xf41968=await s_payment_data['findOne']({'invoice':_0x1f2cd8});_0xf41968[_0x3b081b(0x1f9)]=_0x1f2353,await _0xf41968['save']();let _0x32ac2e=new Date(),_0x481097=('0'+_0x32ac2e[_0x3b081b(0x19e)]())[_0x3b081b(0x1ce)](-0x2),_0x5bca59=('0'+(_0x32ac2e[_0x3b081b(0x2a4)]()+0x1))['slice'](-0x2),_0x36cf4a=_0x32ac2e[_0x3b081b(0x190)](),_0x158e07=_0x36cf4a+'-'+_0x5bca59+'-'+_0x481097;const _0xf47ceb=new suppliers_payment({'invoice':_0x1f2cd8,'date':_0x36cf4a+'-'+_0x5bca59+'-'+_0x481097,'suppliers':_0x4898dd,'reason':'Paid\x20For\x20Purchase','amount':_0x58c7a3}),_0x14a672=await _0xf47ceb[_0x3b081b(0x212)]();_0x5003f1[_0x3b081b(0x1a7)](_0x3b081b(0x179),'payment\x20successfull'),_0x55dc2c[_0x3b081b(0x25f)]('/all_purchases/view');}catch(_0xc6bdb6){console[_0x3b081b(0x19f)](_0xc6bdb6);}}),router[a0_0x27564f(0x1d9)](a0_0x27564f(0x172),auth,async(_0xad0e47,_0x5ebde3)=>{var _0x38c49a=a0_0x27564f;try{const {username:_0x1b800a,email:_0xf78f35,role:_0x2c2b4f}=_0xad0e47[_0x38c49a(0x23d)],_0x416af9=_0xad0e47[_0x38c49a(0x23d)],_0x49277e=await profile[_0x38c49a(0x1dc)]({'email':_0x416af9[_0x38c49a(0x240)]}),_0xf4a2ff=await master_shop[_0x38c49a(0x188)]();console[_0x38c49a(0x19f)]('master',_0xf4a2ff);const _0x4a91ce=_0xad0e47[_0x38c49a(0x1cf)]['id'],_0x43102c=await purchases[_0x38c49a(0x24b)](_0x4a91ce);console[_0x38c49a(0x19f)](_0x43102c);const _0x49cecc=await suppliers[_0x38c49a(0x1dc)]({'name':_0x43102c[_0x38c49a(0x1ac)]});console['log'](_0x49cecc);if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]==_0x38c49a(0x239)){var _0xcab7f9=users[_0x38c49a(0x170)];console[_0x38c49a(0x19f)](_0xcab7f9);}else{if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]==_0x38c49a(0x16c))var _0xcab7f9=users['Hindi'];else{if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]=='German')var _0xcab7f9=users[_0x38c49a(0x174)];else{if(_0xf4a2ff[0x0]['language']==_0x38c49a(0x1f1))var _0xcab7f9=users[_0x38c49a(0x1f1)];else{if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]==_0x38c49a(0x253))var _0xcab7f9=users[_0x38c49a(0x253)];else{if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]=='Portuguese\x20(BR)')var _0xcab7f9=users[_0x38c49a(0x1db)];else{if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]=='Chinese')var _0xcab7f9=users[_0x38c49a(0x287)];else{if(_0xf4a2ff[0x0][_0x38c49a(0x1e4)]=='Arabic\x20(ae)')var _0xcab7f9=users[_0x38c49a(0x1c9)];}}}}}}}_0x5ebde3[_0x38c49a(0x255)](_0x38c49a(0x268),{'success':_0xad0e47[_0x38c49a(0x1a7)](_0x38c49a(0x179)),'errors':_0xad0e47[_0x38c49a(0x1a7)]('errors'),'role':_0x416af9,'profile':_0x49277e,'master_shop':_0xf4a2ff,'supplier':_0x49cecc,'purchase':_0x43102c,'language':_0xcab7f9});}catch(_0x4ad154){console[_0x38c49a(0x19f)](_0x4ad154);}}),router[a0_0x27564f(0x1d9)]('/view/return_purchase/:id',auth,async(_0x445294,_0x18e022)=>{var _0x4eaa52=a0_0x27564f;try{const {username:_0x3f8f88,email:_0x4cf312,role:_0x151b07}=_0x445294['user'],_0x5d71aa=_0x445294[_0x4eaa52(0x23d)],_0x2c6673=await profile['findOne']({'email':_0x5d71aa[_0x4eaa52(0x240)]}),_0x395f88=await master_shop[_0x4eaa52(0x188)]();console['log'](_0x4eaa52(0x1d0),_0x395f88);const _0x4e16e9=_0x445294[_0x4eaa52(0x1cf)]['id'];console[_0x4eaa52(0x19f)](_0x4e16e9);const _0xe7ec4b=await purchases_finished['findById'](_0x4e16e9);console[_0x4eaa52(0x19f)](_0x4eaa52(0x265),_0xe7ec4b);const _0x3e9032=await product[_0x4eaa52(0x188)]({}),_0x4e23c1=await warehouse[_0x4eaa52(0x185)]([{'$match':{'name':_0xe7ec4b[_0x4eaa52(0x2a1)],'room':_0xe7ec4b[_0x4eaa52(0x1e8)]}},{'$unwind':_0x4eaa52(0x251)},{'$group':{'_id':_0x4eaa52(0x298),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4eaa52(0x215)},'bay':{'$first':_0x4eaa52(0x1a0)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4eaa52(0x177)},'floorlevel':{'$first':_0x4eaa52(0x18c)},'primary_code':{'$first':_0x4eaa52(0x245)},'secondary_code':{'$first':_0x4eaa52(0x1bc)},'product_code':{'$first':_0x4eaa52(0x214)},'storage':{'$first':_0x4eaa52(0x165)},'rack':{'$first':_0x4eaa52(0x241)}}}]);console['log']('stock_data',_0x4e23c1);let _0x595fed;if(_0x5d71aa[_0x4eaa52(0x1e0)]==_0x4eaa52(0x294)){const _0x376ac1=await staff[_0x4eaa52(0x1dc)]({'email':_0x5d71aa[_0x4eaa52(0x240)]});_0x595fed=await warehouse[_0x4eaa52(0x188)]({'status':_0x4eaa52(0x1f3),'name':_0x376ac1['warehouse'],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x595fed=await warehouse[_0x4eaa52(0x185)]([{'$match':{'status':_0x4eaa52(0x1f3),'warehouse_category':_0x4eaa52(0x26e),'name':_0x4eaa52(0x195)}},{'$group':{'_id':_0x4eaa52(0x273),'name':{'$first':_0x4eaa52(0x273)}}}]);if(_0x395f88[0x0][_0x4eaa52(0x1e4)]==_0x4eaa52(0x239)){var _0x509467=users['English'];console['log'](_0x509467);}else{if(_0x395f88[0x0]['language']=='Hindi')var _0x509467=users[_0x4eaa52(0x16c)];else{if(_0x395f88[0x0][_0x4eaa52(0x1e4)]==_0x4eaa52(0x174))var _0x509467=users[_0x4eaa52(0x174)];else{if(_0x395f88[0x0][_0x4eaa52(0x1e4)]==_0x4eaa52(0x1f1))var _0x509467=users[_0x4eaa52(0x1f1)];else{if(_0x395f88[0x0][_0x4eaa52(0x1e4)]==_0x4eaa52(0x253))var _0x509467=users[_0x4eaa52(0x253)];else{if(_0x395f88[0x0]['language']=='Portuguese\x20(BR)')var _0x509467=users[_0x4eaa52(0x1db)];else{if(_0x395f88[0x0][_0x4eaa52(0x1e4)]==_0x4eaa52(0x287))var _0x509467=users[_0x4eaa52(0x287)];else{if(_0x395f88[0x0][_0x4eaa52(0x1e4)]=='Arabic\x20(ae)')var _0x509467=users[_0x4eaa52(0x1c9)];}}}}}}}_0x18e022[_0x4eaa52(0x255)](_0x4eaa52(0x266),{'success':_0x445294['flash']('success'),'errors':_0x445294[_0x4eaa52(0x1a7)](_0x4eaa52(0x1e5)),'role':_0x5d71aa,'profile':_0x2c6673,'user':_0xe7ec4b,'stock':_0x4e23c1,'master_shop':_0x395f88,'product':_0x3e9032,'language':_0x509467,'warehouse':_0x595fed});}catch(_0x414d34){console['log'](_0x414d34);}}),router['post']('/view/return_purchase/:id',auth,async(_0x5751cb,_0x4ffc91)=>{var _0x47ac2a=a0_0x27564f;try{const {invoice:_0xe5da6d,date:_0x6b5159,warehouse_name:_0x2feaf9,Room_name:_0x44bcde,product_name:_0x253bca,purchase_quantity:_0x4e973d,stocks:_0x38468f,return_qty:_0x54173a,note:_0x417307,level:_0x2d0e0b,isle:_0xe942e,pallet:_0xe8e8b,to_warehouse_name:_0x4e390e,to_Room_name:_0x165bfc}=_0x5751cb['body'],_0x22c8f3=await purchases_finished[_0x47ac2a(0x1dc)]({'_id':_0x5751cb[_0x47ac2a(0x1cf)]['id']}),_0x4dba90=await warehouse[_0x47ac2a(0x1dc)]({'name':_0x2feaf9,'room':_0x44bcde,'warehouse_category':_0x47ac2a(0x26e)});if(typeof _0x253bca==_0x47ac2a(0x1d8))var _0x382324=[_0x5751cb['body'][_0x47ac2a(0x16f)]],_0x44f428=[_0x5751cb[_0x47ac2a(0x1c8)]['purchase_quantity']],_0x11ebab=[_0x5751cb['body'][_0x47ac2a(0x297)]],_0x5f5156=[_0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x282)]],_0x132d3b=[_0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x26d)]],_0x468fb6=[_0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x1c6)]],_0x5d5239=[_0x5751cb[_0x47ac2a(0x1c8)]['primary_code_hide']],_0x411fe4=[_0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x28b)]];else var _0x382324=[..._0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x16f)]],_0x44f428=[..._0x5751cb[_0x47ac2a(0x1c8)]['purchase_quantity']],_0x11ebab=[..._0x5751cb[_0x47ac2a(0x1c8)]['stocks']],_0x5f5156=[..._0x5751cb[_0x47ac2a(0x1c8)]['return_qty']],_0x132d3b=[..._0x5751cb[_0x47ac2a(0x1c8)]['level']],_0x468fb6=[..._0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x1c6)]],_0x5d5239=[..._0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x1c5)]],_0x411fe4=[..._0x5751cb[_0x47ac2a(0x1c8)]['secondary_code_hide']];const _0x40b1f7=_0x382324[_0x47ac2a(0x250)](_0x11f89c=>{return _0x11f89c={'product_name':_0x11f89c};});_0x44f428[_0x47ac2a(0x25a)]((_0x173e76,_0x6f186f)=>{_0x40b1f7[_0x6f186f]['purchase_quantity']=_0x173e76;}),_0x11ebab[_0x47ac2a(0x25a)]((_0x1eb224,_0x158c8d)=>{var _0x58605f=_0x47ac2a;_0x40b1f7[_0x158c8d][_0x58605f(0x23c)]=_0x1eb224;}),_0x5f5156['forEach']((_0x496472,_0x57eef2)=>{var _0x239f25=_0x47ac2a;_0x40b1f7[_0x57eef2][_0x239f25(0x282)]=_0x496472;}),_0x132d3b[_0x47ac2a(0x25a)]((_0x10e8f6,_0x42acd)=>{var _0x420191=_0x47ac2a;_0x40b1f7[_0x42acd][_0x420191(0x252)]=_0x10e8f6;}),_0x468fb6[_0x47ac2a(0x25a)]((_0x34b6a8,_0x2665dd)=>{_0x40b1f7[_0x2665dd]['product_code']=_0x34b6a8;}),_0x5d5239[_0x47ac2a(0x25a)]((_0x4ea019,_0x85a45f)=>{var _0x231f0c=_0x47ac2a;_0x40b1f7[_0x85a45f][_0x231f0c(0x21a)]=_0x4ea019;}),_0x411fe4['forEach']((_0x2cc13f,_0x4926b0)=>{var _0x5c8399=_0x47ac2a;_0x40b1f7[_0x4926b0][_0x5c8399(0x192)]=_0x2cc13f;}),_0x40b1f7[_0x47ac2a(0x25a)](_0x3be955=>{var _0x42db55=_0x47ac2a;console[_0x42db55(0x19f)](_0x3be955);const _0x392f77=_0x4dba90[_0x42db55(0x178)][_0x42db55(0x250)](_0x369bae=>{var _0x26dadf=_0x42db55;_0x369bae[_0x26dadf(0x16f)]==_0x3be955[_0x26dadf(0x16f)]&&_0x369bae[_0x26dadf(0x252)]==_0x3be955[_0x26dadf(0x252)]&&(console['log'](parseInt(_0x369bae[_0x26dadf(0x1f5)])+_0x26dadf(0x27f)+parseInt(_0x3be955[_0x26dadf(0x282)])),_0x369bae[_0x26dadf(0x1f5)]=parseInt(_0x369bae['product_stock'])-parseInt(_0x3be955[_0x26dadf(0x282)]));});}),await _0x4dba90[_0x47ac2a(0x212)]();var _0x251558=0x0;_0x40b1f7[_0x47ac2a(0x25a)](_0x481737=>{var _0x54148d=_0x47ac2a;(parseInt(_0x481737[_0x54148d(0x196)])<parseInt(_0x481737[_0x54148d(0x282)])||parseInt(_0x481737[_0x54148d(0x23c)])<parseInt(_0x481737[_0x54148d(0x282)]))&&_0x251558++;});if(_0x251558!=0x0)return _0x5751cb['flash'](_0x47ac2a(0x1e5),_0x47ac2a(0x29e)),_0x4ffc91[_0x47ac2a(0x25f)](_0x47ac2a(0x26b));const _0x1da3fd=new purchases_return_finished({'invoice':_0xe5da6d,'suppliers':_0x5751cb['body'][_0x47ac2a(0x1ac)],'date':_0x6b5159,'warehouse_name':_0x2feaf9,'return_product':_0x40b1f7,'note':_0x417307,'room':_0x44bcde,'to_warehouse_name':_0x4e390e,'to_room':_0x165bfc}),_0x201209=await _0x1da3fd['save'](),_0x795f65=await purchases_return_finished['findOne']({'invoice':_0xe5da6d}),_0x4ac940=await warehouse[_0x47ac2a(0x1dc)]({'name':_0x4e390e,'room':_0x165bfc,'warehouse_category':_0x47ac2a(0x26e)});_0x795f65[_0x47ac2a(0x1b5)][_0x47ac2a(0x25a)](_0x52acb1=>{var _0x242448=_0x47ac2a,_0x5c6a41=0x0;const _0x11081a=_0x4ac940['product_details'][_0x242448(0x250)](_0x28e7cb=>{var _0x2c6e6a=_0x242448;console[_0x2c6e6a(0x19f)](_0x28e7cb[_0x2c6e6a(0x16f)]+'=='+_0x52acb1[_0x2c6e6a(0x16f)]+'&&'+_0x28e7cb['bay']+'=='+_0x52acb1['bay']),_0x28e7cb[_0x2c6e6a(0x16f)]==_0x52acb1[_0x2c6e6a(0x16f)]&&_0x28e7cb['bay']==_0x52acb1['bay']&&(_0x28e7cb[_0x2c6e6a(0x1f5)]=parseInt(_0x28e7cb[_0x2c6e6a(0x1f5)])-parseInt(_0x52acb1['return_qty']),_0x5c6a41++);});_0x5c6a41=='0'&&(_0x4ac940[_0x242448(0x178)]=_0x4ac940[_0x242448(0x178)]['concat']({'product_name':_0x52acb1[_0x242448(0x16f)],'product_stock':_0x52acb1[_0x242448(0x282)],'primary_code':_0x52acb1[_0x242448(0x21a)],'secondary_code':_0x52acb1['secondary_code'],'product_code':_0x52acb1[_0x242448(0x1ae)],'bay':_0x52acb1[_0x242448(0x252)],'maxProducts':0xf423f}));}),await _0x4ac940[_0x47ac2a(0x212)]();const _0x213af2=await purchases_finished[_0x47ac2a(0x1dc)]({'invoice':_0xe5da6d});_0x213af2[_0x47ac2a(0x200)]=_0x47ac2a(0x173);const _0x16c31e=await _0x213af2[_0x47ac2a(0x212)](),_0x5c817f=new s_payment_data({'invoice':_0xe5da6d,'suppliers':_0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x1ac)],'reason':_0x47ac2a(0x17b)});await _0x5c817f[_0x47ac2a(0x212)]();const _0x53d6a0=await master_shop[_0x47ac2a(0x188)](),_0xd8db6a=await email_settings[_0x47ac2a(0x1dc)](),_0x2b87c6=await suppliers[_0x47ac2a(0x1dc)]({'name':_0x5751cb[_0x47ac2a(0x1c8)][_0x47ac2a(0x1ac)]});_0x53d6a0[0x0][_0x47ac2a(0x24a)]==0x1?(right_currency=_0x53d6a0[0x0][_0x47ac2a(0x1a4)],left_currency=''):(right_currency='',left_currency=_0x53d6a0[0x0][_0x47ac2a(0x1a4)]);var _0x35fc77=_0x382324,_0x297d28=_0x5f5156,_0x3d9eee='',_0x4f7847;for(_0x4f7847 in _0x35fc77){_0x3d9eee+='<tr>'+_0x47ac2a(0x28d)+_0x35fc77[_0x4f7847]+'</td>'+_0x47ac2a(0x28d)+_0x297d28[_0x4f7847]+_0x47ac2a(0x24d)+'</tr>';}let _0xb9398c=nodemailer[_0x47ac2a(0x299)]({'service':_0x47ac2a(0x1aa),'auth':{'user':_0xd8db6a[_0x47ac2a(0x240)],'pass':_0xd8db6a[_0x47ac2a(0x285)]}}),_0x330272={'from':_0xd8db6a[_0x47ac2a(0x240)],'to':_0x2b87c6[_0x47ac2a(0x240)],'subject':_0x47ac2a(0x207),'attachments':[{'filename':_0x47ac2a(0x230),'path':__dirname+_0x47ac2a(0x1ee)+_0x47ac2a(0x29a)+_0x53d6a0[0x0][_0x47ac2a(0x18e)],'cid':_0x47ac2a(0x227)}],'html':_0x47ac2a(0x168)+_0x47ac2a(0x1d3)+_0x47ac2a(0x218)+_0x47ac2a(0x17e)+_0x47ac2a(0x1b7)+_0x47ac2a(0x17e)+_0x47ac2a(0x175)+_0x47ac2a(0x2a8)+_0x47ac2a(0x17e)+_0x47ac2a(0x292)+_0x53d6a0[0x0][_0x47ac2a(0x18f)]+_0x47ac2a(0x280)+'</div>'+_0x47ac2a(0x2a8)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x47ac2a(0x18d)+_0x47ac2a(0x22d)+_0xe5da6d+'\x20'+_0x47ac2a(0x193)+'\x20Order\x20Date\x20:\x20'+_0x6b5159+'\x20'+_0x47ac2a(0x1d1)+'</h5>'+_0x47ac2a(0x2a8)+_0x47ac2a(0x2a6)+_0x47ac2a(0x189)+_0x47ac2a(0x223)+_0x47ac2a(0x2aa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x47ac2a(0x1c0)+_0x47ac2a(0x180)+_0x47ac2a(0x201)+_0x47ac2a(0x1a5)+_0x47ac2a(0x2ac)+'\x20'+_0x3d9eee+'\x20'+_0x47ac2a(0x203)+_0x47ac2a(0x1d2)+_0x47ac2a(0x17e)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x53d6a0[0x0][_0x47ac2a(0x18f)]+'</h5>'+'</div>'+_0x47ac2a(0x2a8)+'</body></html>'};_0xb9398c[_0x47ac2a(0x220)](_0x330272,function(_0x13d3d2,_0x2b2ab9){var _0x2bff70=_0x47ac2a;_0x13d3d2?console[_0x2bff70(0x19f)](_0x2bff70(0x1c4)):console['log']('Email\x20sent\x20successfully');}),_0x5751cb[_0x47ac2a(0x1a7)](_0x47ac2a(0x179),_0x47ac2a(0x22e)),_0x4ffc91[_0x47ac2a(0x25f)](_0x47ac2a(0x1af));}catch(_0x2f4e3f){_0x4ffc91['status'](0xc8)['json']({'message':_0x2f4e3f['message']});}}),router['get'](a0_0x27564f(0x1ec),auth,async(_0x38144e,_0x229e64)=>{var _0x41a689=a0_0x27564f;try{const {username:_0x1f7986,email:_0x519fa0,role:_0x59a094}=_0x38144e[_0x41a689(0x23d)],_0x5963aa=_0x38144e[_0x41a689(0x23d)],_0x1d3348=await profile[_0x41a689(0x1dc)]({'email':_0x5963aa[_0x41a689(0x240)]}),_0x5b701f=await master_shop[_0x41a689(0x188)](),_0x5062d4=_0x38144e[_0x41a689(0x1cf)]['id'],_0x3ab83f=await purchases_finished[_0x41a689(0x24b)](_0x5062d4);if(_0x5b701f[0x0][_0x41a689(0x1e4)]=='English\x20(US)')var _0x3a14c7=users[_0x41a689(0x170)];else{if(_0x5b701f[0x0]['language']==_0x41a689(0x16c))var _0x3a14c7=users[_0x41a689(0x16c)];else{if(_0x5b701f[0x0][_0x41a689(0x1e4)]==_0x41a689(0x174))var _0x3a14c7=users[_0x41a689(0x174)];else{if(_0x5b701f[0x0][_0x41a689(0x1e4)]==_0x41a689(0x1f1))var _0x3a14c7=users[_0x41a689(0x1f1)];else{if(_0x5b701f[0x0]['language']=='French')var _0x3a14c7=users[_0x41a689(0x253)];else{if(_0x5b701f[0x0][_0x41a689(0x1e4)]==_0x41a689(0x264))var _0x3a14c7=users[_0x41a689(0x1db)];else{if(_0x5b701f[0x0][_0x41a689(0x1e4)]==_0x41a689(0x287))var _0x3a14c7=users[_0x41a689(0x287)];else{if(_0x5b701f[0x0][_0x41a689(0x1e4)]==_0x41a689(0x228))var _0x3a14c7=users[_0x41a689(0x1c9)];}}}}}}}_0x229e64[_0x41a689(0x255)](_0x41a689(0x1e9),{'success':_0x38144e[_0x41a689(0x1a7)]('success'),'errors':_0x38144e[_0x41a689(0x1a7)](_0x41a689(0x1e5)),'role':_0x5963aa,'profile':_0x1d3348,'alldata':_0x3ab83f,'master_shop':_0x5b701f,'language':_0x3a14c7}),console['log'](alldata);}catch(_0x51d664){console[_0x41a689(0x19f)](_0x51d664);}}),router['post'](a0_0x27564f(0x191),async(_0x2b05e8,_0x232ee1)=>{var _0x340f69=a0_0x27564f;const {product_code:_0x2e1e14}=_0x2b05e8[_0x340f69(0x1c8)];var _0x294be3;const _0x38c4c9=await product[_0x340f69(0x185)]([{'$match':{'primary_code':_0x2e1e14}},{'$group':{'_id':_0x340f69(0x1b0),'name':{'$first':_0x340f69(0x273)},'category':{'$first':'$category'},'brand':{'$first':_0x340f69(0x29b)},'unit':{'$first':_0x340f69(0x1de)},'alertquantity':{'$first':_0x340f69(0x27a)},'product_code':{'$first':_0x340f69(0x1d4)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x340f69(0x28f)},'maxStocks':{'$first':_0x340f69(0x1cc)},'maxProdPerUnit':{'$first':_0x340f69(0x20f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x340f69(0x20c)},'gross_price':{'$first':_0x340f69(0x289)},'sales_category':{'$first':_0x340f69(0x234)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x242f2f=await product['aggregate']([{'$match':{'secondary_code':_0x2e1e14}},{'$group':{'_id':_0x340f69(0x1b0),'name':{'$first':_0x340f69(0x273)},'category':{'$first':_0x340f69(0x2a9)},'brand':{'$first':_0x340f69(0x29b)},'unit':{'$first':_0x340f69(0x1de)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x340f69(0x28f)},'maxStocks':{'$first':_0x340f69(0x1cc)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x340f69(0x20c)},'gross_price':{'$first':_0x340f69(0x289)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x38c4c9[_0x340f69(0x21b)]>0x0)_0x294be3=_0x38c4c9;else _0x242f2f['length']>0x0&&(_0x294be3=_0x242f2f);_0x232ee1[_0x340f69(0x1e6)](_0x294be3);}),router[a0_0x27564f(0x24f)](a0_0x27564f(0x247),async(_0x5ef521,_0x1ff581)=>{var _0x36280f=a0_0x27564f;const {productCode:_0x48e868,bay:_0x360cbb,warehouses:_0x892dad,room:_0x3dcfe5}=_0x5ef521[_0x36280f(0x1c8)];console['log'](_0x5ef521[_0x36280f(0x1c8)]);try{const _0x3e400d=await warehouse[_0x36280f(0x185)]([{'$match':{'name':_0x892dad,'room':_0x3dcfe5}},{'$unwind':_0x36280f(0x251)},{'$match':{'product_details.bay':parseInt(_0x360cbb)}},{'$group':{'_id':_0x36280f(0x298),'name':{'$first':_0x36280f(0x24c)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x36280f(0x1a0)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1ff581[_0x36280f(0x246)](0xc8)[_0x36280f(0x1e6)](_0x3e400d);}catch(_0x59e78a){_0x1ff581[_0x36280f(0x246)](0x194)[_0x36280f(0x1e6)]({'message':_0x59e78a['message']});}}),router['post'](a0_0x27564f(0x163),async(_0x5abaf8,_0x337637)=>{var _0x1d4e20=a0_0x27564f;const {product_code:_0x1fbd27}=_0x5abaf8[_0x1d4e20(0x1c8)];var _0x13b78b;const _0x305d46=await product['aggregate']([{'$match':{'primary_code':_0x1fbd27,'type_products':_0x1d4e20(0x19f)}},{'$group':{'_id':_0x1d4e20(0x1b0),'name':{'$first':_0x1d4e20(0x273)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x1d4e20(0x1de)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1d4e20(0x1d4)},'primary_code':{'$first':_0x1d4e20(0x167)},'secondary_code':{'$first':_0x1d4e20(0x28f)},'maxStocks':{'$first':_0x1d4e20(0x1cc)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1d4e20(0x20c)},'gross_price':{'$first':_0x1d4e20(0x289)},'sales_category':{'$first':_0x1d4e20(0x234)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x1d4e20(0x19f)](_0x305d46);const _0x2e6256=await product[_0x1d4e20(0x185)]([{'$match':{'secondary_code':_0x1fbd27,'type_products':_0x1d4e20(0x19f)}},{'$group':{'_id':_0x1d4e20(0x1b0),'name':{'$first':_0x1d4e20(0x273)},'category':{'$first':_0x1d4e20(0x2a9)},'brand':{'$first':_0x1d4e20(0x29b)},'unit':{'$first':_0x1d4e20(0x1de)},'alertquantity':{'$first':_0x1d4e20(0x27a)},'product_code':{'$first':_0x1d4e20(0x1d4)},'primary_code':{'$first':_0x1d4e20(0x167)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1d4e20(0x1cc)},'maxProdPerUnit':{'$first':_0x1d4e20(0x20f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1d4e20(0x20c)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x1d4e20(0x234)},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x305d46['length']>0x0)_0x13b78b=_0x305d46;else _0x2e6256['length']>0x0&&(_0x13b78b=_0x2e6256);_0x337637[_0x1d4e20(0x1e6)](_0x13b78b);}),module[a0_0x27564f(0x263)]=router;