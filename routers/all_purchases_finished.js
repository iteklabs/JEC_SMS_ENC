var a0_0x2edef6=a0_0x5e84;(function(_0x51acd0,_0x4fee80){var _0x5dce84=a0_0x5e84,_0x5a2ccc=_0x51acd0();while(!![]){try{var _0xb8cbdf=parseInt(_0x5dce84(0xeb))/0x1+parseInt(_0x5dce84(0xb3))/0x2*(-parseInt(_0x5dce84(0x1be))/0x3)+parseInt(_0x5dce84(0xf3))/0x4+parseInt(_0x5dce84(0x105))/0x5*(parseInt(_0x5dce84(0xa3))/0x6)+parseInt(_0x5dce84(0x1bb))/0x7+-parseInt(_0x5dce84(0x119))/0x8+-parseInt(_0x5dce84(0xd8))/0x9*(parseInt(_0x5dce84(0x13e))/0xa);if(_0xb8cbdf===_0x4fee80)break;else _0x5a2ccc['push'](_0x5a2ccc['shift']());}catch(_0x5acaa6){_0x5a2ccc['push'](_0x5a2ccc['shift']());}}}(a0_0x16b2,0x32fd1));const express=require(a0_0x2edef6(0x19f)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse_temporary,warehouse_validation_setup,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings,invoice_for_incoming,purchases_logs,transfers_finished,datalogs,purchases_incoming}=require(a0_0x2edef6(0xc2)),auth=require(a0_0x2edef6(0xa8)),nodemailer=require(a0_0x2edef6(0xae));var ejs=require(a0_0x2edef6(0x194));function a0_0x16b2(){var _0x3d7f73=['/give_payment/:id','master','\x20<=>\x20','note','bin','type_of_products_type','$alertquantity','Asia/Manila','INCF-','INC-','prod_secondunit','suppliers','181050WgvScw','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_level','$secondary_unit','Please\x20wait\x20warehouse\x20checker\x20to\x20confirm\x20the\x20Products\x20stocks','</head><body>','random','\x20</h2>','1478648DgzqbE','Chinese','Purchase\x20Return\x20Mail','$expiry_date','prod_primunit','JO_number','<!DOCTYPE\x20html>','errors','</span>','<strong>\x20Regards\x20</strong>','purchases_process','save','uuid','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','findById','message','port','762595sjOpbH','\x20===\x20','date_recieved','prod_code','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','body','/all_purchases_finished/process/','$maxProdPerUnit','Room_name','</body></html>','purchase_quantity','gross_price','return_qty','secondary_code_hide','room_name','isAvailable','purchase\x20data\x20update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<h5>','Finished\x20Goods','2199736RaOXIT','Rack\x201','quantity','prod_unit','return_data','currency','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','path','util','aggregate','<h5\x20style=\x22text-align:\x20left;\x22>','../public/language/languages.json','$product.type','then','An\x20error\x20occurred.','logo','edit_purchases_finished_view','isUsed','Purchase\x20Return','$name','en-CA','user_id','to_bay','add_purchases_finished','$product_details.bay','secondary_unit','\x20quantity\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.','An\x20error\x20occurred\x20while\x20saving\x20data.','<span\x20style=\x22float:\x20right;\x22>','$product.floorlevel','$product_details.floorlevel','catch','Email\x20sent\x20successfully','maxPerUnit','getDate','MaxStocks_data','/all_purchases_finished/view','870QENoOe','room','FGSEmail','DRY\x20GOODS','$product.bin','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.secondary_code','updateOne','/getTRF','staff','$room','/invoice/:id','$product.quantity','2-digit','add_purchases_finished_logs','$product','createTransport','STAGING','getFullYear','/all_purchases_finished/preview/','product_id','incoming_view','</table>','POnumber','Logo.png','suppliers_docs','maxperunit','English','$product.room_name','True','</h5>','\x20to\x20warehouse:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','get','site_title','</td>','product_stock','email','$return_data','all_purchases_finished_logs','name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Paid\x20For\x20Purchase','getMonth','/upload/','product_cat','$maxStocks','$date','purchase\x20data\x20add\x20successfully','Enclosed','/incoming/add','prod_Qty','Portuguese','all_purchases_finished','Error\x20occurred\x20while\x20processing\x20product:','/view/:id','$product_details._id','$product_details.product_code','purchases_id','numeric','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','table\x20page','\x20units\x20of\x20','slice','product_details','production_date','host','padStart','success','\x20quantity\x20that\x20could\x20be\x20place\x20in\x20Staging\x20Area','<hr\x20class=\x22my-3\x22>','map','/../public','$batch_code','filter','purchases\x20item\x20return\x20successfull','/incoming','Transfer\x20Finalize\x20Successfully','Error\x20fetching\x20or\x20saving\x20warehouse\x20data:','maxProducts','$gross_price','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$paid_amount','status','ejs','$secondary_code','$primary_code','/picking_list/pdf_puchases_fin_own_trf/','LOG-INC-','product_name','Arabic\x20(ae)','product_date','_id','to_warehouse','$suppliers','express','image','/view','match','batch_code','flash','$product_details.primary_code','json','amount','date','$sales_category','string','purchase_invoice','$product_details.maxProducts','RoomAssign','to_room_name','\x20Order\x20Number\x20:\x20','true','$_id','item_code','forEach','stocks','Arabic','redirect','maxStocks','length','warehouse_name','<tbody\x20style=\x22text-align:\x20center;\x22>','800737MqWvEk','level','min','24gmknAl','toLocaleDateString','prod_cat','\x20<>\x20','password','/preview/:id','Distributing\x20','params','product','concat','STAGING\x20AREA\x201',',\x20bin:\x20','/view/add_purchases_logs','to_quantity','floor','Error\x20Occurs','payment\x20successfull','product_data','toString','</tbody>','all_purchases_barcode','error','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<div>','findOne','prod_name','/barcode/:id','post','\x20Order\x20Date\x20:\x20','<html><head><title></title>','Enabled','max','secondary_code','$brand','$invoice','type_of_products','$product_details.product_stock','$suppliers_docs','data_type','stock_quantity','warehouse','$unit','sales_data_cateory','gmail','German','own','due_amount','add_purchases\x20error','sendMail','There\x20is\x20','12hTLQRp','<tr>','all','French','$note','../middleware/auth','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$warehouse_name','valueOf','$category','role','nodemailer','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x202','sales_category',',\x20bay:\x20','\x20inc\x20=\x20','60790eyEKcY','paid_amount','unit','invoice','English\x20(US)','Hindi','$product_details.storage','invoice_init','undefined','expiry_date','$product_code','/barcode_scanner',',\x20room:\x20','incoming_add','abs','../models/all_models','return_purchase_finished','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','standard_unit','prod_qty','language','user','inc','primary_code_hide','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$type_products','primary_code','</tr>','bay','log','false','Purchase\x20Mail','stock_data','find','max_product_unit','25155OIzHvj','render','</div>','product_code_hide','product_code','$product_details','$due_amount'];a0_0x16b2=function(){return _0x3d7f73;};return a0_0x16b2();}const path=require(a0_0x2edef6(0x120)),users=require(a0_0x2edef6(0x124)),{isNull}=require(a0_0x2edef6(0x121));router[a0_0x2edef6(0x161)](a0_0x2edef6(0x18c),auth,async(_0x2c2aab,_0x3e52d3)=>{var _0x47677a=a0_0x2edef6;try{const {username:_0x57d2d8,email:_0x2721fd,role:_0x3ab20a}=_0x2c2aab[_0x47677a(0xc8)],_0x31ef62=_0x2c2aab[_0x47677a(0xc8)],_0x51a04b=await profile[_0x47677a(0x1d6)]({'email':_0x31ef62[_0x47677a(0x165)]}),_0x256f3c=await staff['findOne']({'email':_0x31ef62['email']}),_0x5d833a=await master_shop[_0x47677a(0xd6)]();let _0x356faa=await transfers_finished['aggregate']([{'$match':{'to_warehouse':_0x256f3c[_0x47677a(0x99)]}}]);if(_0x5d833a[0x0][_0x47677a(0xc7)]==_0x47677a(0xb7))var _0x235c58=users['English'];else{if(_0x5d833a[0x0][_0x47677a(0xc7)]==_0x47677a(0xb8))var _0x235c58=users[_0x47677a(0xb8)];else{if(_0x5d833a[0x0]['language']==_0x47677a(0x9d))var _0x235c58=users[_0x47677a(0x9d)];else{if(_0x5d833a[0x0][_0x47677a(0xc7)]=='Spanish')var _0x235c58=users[_0x47677a(0x100)];else{if(_0x5d833a[0x0]['language']==_0x47677a(0xa6))var _0x235c58=users[_0x47677a(0xa6)];else{if(_0x5d833a[0x0][_0x47677a(0xc7)]==_0x47677a(0x143))var _0x235c58=users[_0x47677a(0x174)];else{if(_0x5d833a[0x0][_0x47677a(0xc7)]==_0x47677a(0xf4))var _0x235c58=users[_0x47677a(0xf4)];else{if(_0x5d833a[0x0][_0x47677a(0xc7)]=='Arabic\x20(ae)')var _0x235c58=users[_0x47677a(0x1b5)];}}}}}}}_0x3e52d3[_0x47677a(0xd9)](_0x47677a(0x155),{'success':_0x2c2aab[_0x47677a(0x1a4)](_0x47677a(0x184)),'errors':_0x2c2aab['flash'](_0x47677a(0xfa)),'purchases':_0x356faa,'role':_0x31ef62,'profile':_0x51a04b,'master_shop':_0x5d833a,'language':_0x235c58,'staff_data':_0x256f3c});}catch(_0x22db2d){console[_0x47677a(0xd2)](_0x47677a(0x17d),_0x22db2d),_0x3e52d3[_0x47677a(0x193)](0xc8)['json']({'message':_0x22db2d[_0x47677a(0x103)]});}}),router[a0_0x2edef6(0x161)](a0_0x2edef6(0x172),auth,async(_0x276133,_0x4013ab)=>{var _0x4370bc=a0_0x2edef6;try{const {username:_0x4073f6,email:_0x4f1af7,role:_0xc0d2f6}=_0x276133[_0x4370bc(0xc8)],_0x910a71=_0x276133[_0x4370bc(0xc8)],_0x11bef8=await profile['findOne']({'email':_0x910a71[_0x4370bc(0x165)]}),_0x5dce6b=await staff[_0x4370bc(0x1d6)]({'email':_0x910a71[_0x4370bc(0x165)]}),_0x3f8818=await master_shop[_0x4370bc(0xd6)]();let _0x1d9897=await transfers_finished[_0x4370bc(0x122)]([{'$match':{'to_warehouse':_0x5dce6b[_0x4370bc(0x99)],'to_recieved':_0x4370bc(0xd3)}}]);if(_0x3f8818[0x0][_0x4370bc(0xc7)]==_0x4370bc(0xb7))var _0x305f63=users[_0x4370bc(0x15b)];else{if(_0x3f8818[0x0]['language']=='Hindi')var _0x305f63=users[_0x4370bc(0xb8)];else{if(_0x3f8818[0x0][_0x4370bc(0xc7)]==_0x4370bc(0x9d))var _0x305f63=users[_0x4370bc(0x9d)];else{if(_0x3f8818[0x0][_0x4370bc(0xc7)]=='Spanish')var _0x305f63=users['Spanish'];else{if(_0x3f8818[0x0][_0x4370bc(0xc7)]==_0x4370bc(0xa6))var _0x305f63=users['French'];else{if(_0x3f8818[0x0][_0x4370bc(0xc7)]==_0x4370bc(0x143))var _0x305f63=users[_0x4370bc(0x174)];else{if(_0x3f8818[0x0]['language']==_0x4370bc(0xf4))var _0x305f63=users[_0x4370bc(0xf4)];else{if(_0x3f8818[0x0][_0x4370bc(0xc7)]==_0x4370bc(0x19a))var _0x305f63=users['Arabic'];}}}}}}}_0x4013ab['render'](_0x4370bc(0xc0),{'success':_0x276133[_0x4370bc(0x1a4)](_0x4370bc(0x184)),'errors':_0x276133[_0x4370bc(0x1a4)](_0x4370bc(0xfa)),'purchases':_0x1d9897,'role':_0x910a71,'profile':_0x11bef8,'master_shop':_0x3f8818,'language':_0x305f63,'staff_data':_0x5dce6b});}catch(_0xbb1451){console[_0x4370bc(0xd2)](_0x4370bc(0x17d),_0xbb1451),_0x4013ab[_0x4370bc(0x193)](0xc8)['json']({'message':_0xbb1451[_0x4370bc(0x103)]});}});const createLog=async _0x5a3b4f=>{var _0x1a97e0=a0_0x2edef6;const _0x52df72=new datalogs({'location':_0x5a3b4f});return await _0x52df72['save'](),_0x52df72[_0x1a97e0(0xba)];};router['post']('/incoming/add',auth,async(_0x2dca1c,_0x535f81)=>{var _0x5cbf2d=a0_0x2edef6;try{const {invoice_trf_data:_0x2268f6,item_code:_0x54693d,SCRN:_0x5a35ce,ReqBy:_0x37a012,type_of_products:_0x39f489,dateofreq:_0x33bed8,PO_number:_0x2d426d,date:_0x58b7d1,warehouse_name:_0x132d0b,typeservicesData:_0x3a2c26,typevehicle:_0x3ed7dd,driver:_0x49acad,plate:_0x280ddb,van:_0xfade5d,DRSI:_0x564ac0,TSU:_0x50e14b,TFU:_0x4b899b,note:_0x2c26ed}=_0x2dca1c['body'],_0x3a59ca=await transfers_finished[_0x5cbf2d(0x102)](_0x2268f6);if(typeof _0x54693d==_0x5cbf2d(0x1aa))var _0x19ecd0=[_0x2dca1c[_0x5cbf2d(0x10a)]['product_name']],_0x2a1fab=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1b2)]],_0x4859a2=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1cb)]],_0x2ccd32=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xb5)]],_0x30ddac=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xe9)]],_0x3f5a6d=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xe3)]],_0x1bff37=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xcf)]],_0x46f1df=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1de)]],_0x5aea24=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1a3)]],_0x561072=[_0x2dca1c['body'][_0x5cbf2d(0xbc)]],_0x36aa4a=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x181)]],_0x1b75d8=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xd7)]],_0x11725b=[_0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x13f)]];else var _0x19ecd0=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x199)]],_0x2a1fab=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1b2)]],_0x4859a2=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1cb)]],_0x2ccd32=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xb5)]],_0x30ddac=[..._0x2dca1c['body']['prod_secondunit']],_0x3f5a6d=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xe3)]],_0x1bff37=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xcf)]],_0x46f1df=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x1de)]],_0x5aea24=[..._0x2dca1c[_0x5cbf2d(0x10a)]['batch_code']],_0x561072=[..._0x2dca1c[_0x5cbf2d(0x10a)]['expiry_date']],_0x36aa4a=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0x181)]],_0x1b75d8=[..._0x2dca1c[_0x5cbf2d(0x10a)][_0x5cbf2d(0xd7)]],_0x11725b=[..._0x2dca1c[_0x5cbf2d(0x10a)]['room']];const _0x55728f=_0x19ecd0[_0x5cbf2d(0x187)](_0x593f29=>{return _0x593f29={'product_name':_0x593f29};});_0x2a1fab['forEach']((_0x5f09b2,_0x1f5e99)=>{var _0x1d76b8=_0x5cbf2d;_0x55728f[_0x1f5e99][_0x1d76b8(0xdc)]=_0x5f09b2;}),_0x4859a2[_0x5cbf2d(0x1b3)]((_0x547f46,_0x5b49c8)=>{var _0x569516=_0x5cbf2d;_0x55728f[_0x5b49c8][_0x569516(0x11b)]=Math[_0x569516(0xc1)](_0x547f46);}),_0x2ccd32['forEach']((_0xa4ba06,_0x2eb884)=>{_0x55728f[_0x2eb884]['standard_unit']=_0xa4ba06;}),_0x30ddac[_0x5cbf2d(0x1b3)]((_0x3aa871,_0x191968)=>{var _0xec287=_0x5cbf2d;_0x55728f[_0x191968][_0xec287(0x132)]=_0x3aa871;}),_0x3f5a6d['forEach']((_0x36355f,_0x1f2eaa)=>{var _0x27acad=_0x5cbf2d,_0x21ffd2=_0x36355f[_0x27acad(0x1a2)](/[A-Za-z]+/)[0x0],_0x2ea0a2=parseInt(_0x36355f['match'](/\d+/)[0x0]);_0x55728f[_0x1f2eaa]['level']=_0x21ffd2,_0x55728f[_0x1f2eaa][_0x27acad(0xd1)]=_0x2ea0a2;}),_0x1bff37[_0x5cbf2d(0x1b3)]((_0x4dfbdb,_0x222773)=>{_0x55728f[_0x222773]['primary_code']=_0x4dfbdb;}),_0x46f1df[_0x5cbf2d(0x1b3)]((_0x19ed26,_0x16ab4e)=>{var _0x175c25=_0x5cbf2d;_0x55728f[_0x16ab4e][_0x175c25(0x1de)]=_0x19ed26;}),_0x5aea24['forEach']((_0x4bedd2,_0x331277)=>{_0x55728f[_0x331277]['batch_code']=_0x4bedd2;}),_0x561072['forEach']((_0x339588,_0x6d0e9a)=>{_0x55728f[_0x6d0e9a]['expiry_date']=_0x339588;}),_0x36aa4a[_0x5cbf2d(0x1b3)]((_0x4e6d24,_0x375e9a)=>{_0x55728f[_0x375e9a]['production_date']=_0x4e6d24;}),_0x1b75d8['forEach']((_0x51b920,_0xaddfcc)=>{_0x55728f[_0xaddfcc]['maxperunit']=_0x51b920;}),_0x11725b[_0x5cbf2d(0x1b3)]((_0x2aeb1f,_0x362a99)=>{_0x55728f[_0x362a99]['room_name']=_0x2aeb1f;});const _0x2cb4a6=await createLog('INC');_0x11725b[_0x5cbf2d(0x1b3)]((_0x4dd2ce,_0x468764)=>{var _0x805f50=_0x5cbf2d;_0x55728f[_0x468764][_0x805f50(0xb6)]=_0x805f50(0xe8)+_0x2cb4a6[_0x805f50(0x1d0)]()[_0x805f50(0x183)](0x8,'0');});const _0x151a3a=_0x55728f['filter'](_0x1231c9=>_0x1231c9[_0x5cbf2d(0x11b)]!=='0'&&_0x1231c9['quantity']!==''),_0x1d42db=new purchases_incoming({'invoice':_0x5cbf2d(0xe8)+_0x2cb4a6[_0x5cbf2d(0x1d0)]()[_0x5cbf2d(0x183)](0x8,'0'),'date':_0x58b7d1,'warehouse_name':_0x132d0b,'product':_0x151a3a,'note':_0x2c26ed,'POnumber':_0x2d426d,'SCRN':_0x5a35ce,'ReqBy':_0x37a012,'dateofreq':_0x33bed8,'typeservicesData':_0x3a2c26,'van':_0xfade5d,'typevehicle':_0x3ed7dd,'driver':_0x49acad,'plate':_0x280ddb,'DRSI':_0x564ac0,'TSU':_0x50e14b,'TFU':_0x4b899b,'typeOfProducts':_0x39f489}),_0x20885f=await _0x1d42db[_0x5cbf2d(0xfe)](),_0x542df3=_0x20885f['product'][_0x5cbf2d(0x187)](async _0xda0a1c=>{var _0x8211dc=_0x5cbf2d,_0x5de2bd=await warehouse[_0x8211dc(0x1d6)]({'name':_0x132d0b,'room':_0xda0a1c[_0x8211dc(0x113)]});if(_0xda0a1c[_0x8211dc(0x11b)]>0x0){var _0x28880c=0x0;const _0x5aa722=_0x5de2bd[_0x8211dc(0x180)][_0x8211dc(0x187)](_0x32f5ff=>{var _0x48690b=_0x8211dc;_0x32f5ff[_0x48690b(0x199)]==_0xda0a1c[_0x48690b(0x199)]&&_0x32f5ff[_0x48690b(0xd1)]==_0xda0a1c[_0x48690b(0x12f)]&&_0x32f5ff[_0x48690b(0xbc)]==_0xda0a1c[_0x48690b(0xbc)]&&_0x32f5ff[_0x48690b(0x181)]==_0xda0a1c[_0x48690b(0x181)]&&_0x32f5ff['batch_code']==_0xda0a1c['batch_code']&&_0x32f5ff[_0x48690b(0xb6)]==_0xda0a1c[_0x48690b(0xb6)]&&(typeof _0xda0a1c['id_transaction']==_0x48690b(0xbb)?(console['log']('here2',_0x32f5ff[_0x48690b(0x164)]+_0x48690b(0x1c1)+_0x32f5ff[_0x48690b(0x19c)]+_0x48690b(0xe1)+Math[_0x48690b(0xc1)](_0x32f5ff[_0x48690b(0x164)])+Math[_0x48690b(0xc1)](_0xda0a1c['to_quantity'])),_0x32f5ff['product_stock']=Math[_0x48690b(0xc1)](_0x32f5ff[_0x48690b(0x164)])+Math[_0x48690b(0xc1)](_0xda0a1c[_0x48690b(0x11b)])):(_0x32f5ff[_0x48690b(0x164)]=Math[_0x48690b(0xc1)](_0x32f5ff[_0x48690b(0x164)])+Math[_0x48690b(0xc1)](_0xda0a1c[_0x48690b(0x11b)]),_0x28880c++));});_0x28880c=='0'&&(_0x5de2bd['product_details']=_0x5de2bd[_0x8211dc(0x180)]['concat']({'product_name':_0xda0a1c[_0x8211dc(0x199)],'product_stock':_0xda0a1c[_0x8211dc(0x11b)],'bay':_0xda0a1c['bay'],'level':_0xda0a1c[_0x8211dc(0x1bc)],'product_code':_0xda0a1c[_0x8211dc(0xdc)],'primary_code':_0xda0a1c['primary_code'],'secondary_code':_0xda0a1c['secondary_code'],'expiry_date':_0xda0a1c[_0x8211dc(0xbc)],'production_date':_0xda0a1c[_0x8211dc(0x181)],'maxProducts':_0xda0a1c[_0x8211dc(0x18f)],'batch_code':_0xda0a1c[_0x8211dc(0x1a3)],'secondary_unit':_0xda0a1c[_0x8211dc(0x132)],'unit':_0xda0a1c[_0x8211dc(0xc5)],'maxProducts':_0xda0a1c[_0x8211dc(0x18f)],'maxPerUnit':_0xda0a1c[_0x8211dc(0x13a)],'invoice':_0xda0a1c[_0x8211dc(0xb6)]}));}return _0x5de2bd;});Promise[_0x5cbf2d(0xa5)](_0x542df3)[_0x5cbf2d(0x126)](async _0x4f68cc=>{var _0xcb171=_0x5cbf2d;try{for(const _0x32b032 of _0x4f68cc){await warehouse[_0xcb171(0x147)]({'_id':_0x32b032[_0xcb171(0x19c)]},{'$addToSet':{'product_details':{'$each':_0x32b032['product_details']}}});}_0x3a59ca['to_recieved']=_0xcb171(0x1b0);const _0x281d47=await _0x3a59ca[_0xcb171(0xfe)](),_0x3d61ea=await master_shop[_0xcb171(0xd6)](),_0x45806f=await email_settings['findOne'](),_0x362b78=await supervisor_settings[_0xcb171(0xd6)]();var _0xd4bbdd=_0x1d42db[_0xcb171(0x1c6)],_0x3214c0='',_0xcd6362;for(_0xcd6362 in _0xd4bbdd){var _0x9054a5='FG';_0x1d42db[_0xcb171(0x19d)]==_0xcb171(0x141)&&(_0x9054a5='DG'),_0x3214c0+='<tr>'+_0xcb171(0x145)+_0xd4bbdd[_0xcd6362][_0xcb171(0x199)]+'</td>'+_0xcb171(0x145)+_0xd4bbdd[_0xcd6362][_0xcb171(0xdc)]+_0xcb171(0x163)+_0xcb171(0x145)+_0xd4bbdd[_0xcd6362][_0xcb171(0x1cb)]+_0xcb171(0x163)+_0xcb171(0x145)+_0xd4bbdd[_0xcd6362]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd4bbdd[_0xcd6362]['secondary_unit']+_0xcb171(0x163)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d42db[_0xcb171(0x19d)]+_0xcb171(0x163)+_0xcb171(0x145)+_0xd4bbdd[_0xcd6362][_0xcb171(0x1ae)]+'</td>'+_0xcb171(0x145)+_0x9054a5+_0xd4bbdd[_0xcd6362][_0xcb171(0x12f)]+'</td>'+'</tr>';}_0x2dca1c[_0xcb171(0x1a4)]('success',_0xcb171(0x18d)),_0x535f81[_0xcb171(0x1b6)](_0xcb171(0x197)+_0x20885f[_0xcb171(0x19c)]);}catch(_0x4fbd20){console[_0xcb171(0x1d3)](_0x4fbd20),_0x535f81[_0xcb171(0x193)](0x1f4)[_0xcb171(0x1a6)]({'error':_0xcb171(0x11f)});}})['catch'](_0x15a1c4=>{var _0x5d21d1=_0x5cbf2d;console[_0x5d21d1(0x1d3)](_0x15a1c4),_0x535f81[_0x5d21d1(0x193)](0x1f4)[_0x5d21d1(0x1a6)]({'error':_0x5d21d1(0x127)});});}catch(_0x1b25a2){}}),router['post'](a0_0x2edef6(0x148),auth,async(_0x571401,_0x239dea)=>{var _0x336f89=a0_0x2edef6;try{const {warehouse:_0x14affa}=_0x571401[_0x336f89(0x10a)],_0x3079d9=await transfers_finished[_0x336f89(0xd6)]({'to_warehouse':_0x14affa,'to_recieved':_0x336f89(0xd3)});_0x239dea[_0x336f89(0x1a6)](_0x3079d9);}catch(_0x15355e){}}),router[a0_0x2edef6(0x1d9)]('/getinvoicetrf',auth,async(_0x39208a,_0x54111f)=>{var _0xfc69b7=a0_0x2edef6;try{const {invoice:_0x245163}=_0x39208a[_0xfc69b7(0x10a)],_0x20e292=await transfers_finished[_0xfc69b7(0xd6)]({'_id':_0x245163,'to_recieved':_0xfc69b7(0xd3)});_0x54111f['json'](_0x20e292);}catch(_0x272195){}}),router[a0_0x2edef6(0x161)](a0_0x2edef6(0x1a1),auth,async(_0x1979b8,_0x397d26)=>{var _0x5202b5=a0_0x2edef6;try{const {username:_0x2a6b5b,email:_0x56decd,role:_0xbd552b}=_0x1979b8['user'],_0x1e15c8=_0x1979b8[_0x5202b5(0xc8)],_0x5c6276=await profile[_0x5202b5(0x1d6)]({'email':_0x1e15c8['email']}),_0x18e6d8=await staff[_0x5202b5(0x1d6)]({'email':_0x1e15c8[_0x5202b5(0x165)]});if(_0x1e15c8['role']==_0x5202b5(0x149)){const _0x5d7a96=await staff['findOne']({'email':_0x1e15c8[_0x5202b5(0x165)]});}const _0x2b9f5f=await master_shop['find']();let _0x3e53c5;if(_0x1e15c8[_0x5202b5(0xad)]=='staff'){const _0x5be75e=await staff['findOne']({'email':_0x1e15c8[_0x5202b5(0x165)]});_0x3e53c5=await purchases_finished[_0x5202b5(0x122)]([{'$match':{'warehouse_name':_0x5be75e['warehouse'],'typeOfProducts':_0x5202b5(0x9e)}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x5202b5(0x168),'as':_0x5202b5(0x159)}},{'$unwind':_0x5202b5(0x1e3)},{'$unwind':_0x5202b5(0x14f)},{'$group':{'_id':_0x5202b5(0x1b1),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x5202b5(0x19e)},'date':{'$first':_0x5202b5(0x16f)},'warehouse_name':{'$first':_0x5202b5(0xaa)},'room':{'$first':_0x5202b5(0x14a)},'product':{'$push':_0x5202b5(0x14f)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5202b5(0x192)},'due_amount':{'$first':_0x5202b5(0xde)},'return_data':{'$first':_0x5202b5(0x166)},'batch_code':{'$first':_0x5202b5(0x189)},'expiry_date':{'$first':_0x5202b5(0xf6)},'suppliers_docs':{'$first':_0x5202b5(0x1e3)},'total_product_quantity':{'$sum':_0x5202b5(0x14c)},'level':{'$addToSet':_0x5202b5(0xcc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x5202b5(0x125)},'floorlevel':{'$addToSet':_0x5202b5(0x136)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3e53c5=await purchases_finished[_0x5202b5(0x122)]([{'$match':{'typeOfProducts':_0x5202b5(0x9e)}},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x5202b5(0x19e)},'date':{'$first':_0x5202b5(0x16f)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x5202b5(0x15c)},'product':{'$push':_0x5202b5(0x14f)},'note':{'$first':_0x5202b5(0xa7)},'paid_amount':{'$first':_0x5202b5(0x192)},'due_amount':{'$first':_0x5202b5(0xde)},'return_data':{'$first':_0x5202b5(0x166)},'batch_code':{'$first':_0x5202b5(0x189)},'expiry_date':{'$first':_0x5202b5(0xf6)},'suppliers_docs':{'$first':_0x5202b5(0x1e3)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x5202b5(0xcc)},'isle':{'$addToSet':_0x5202b5(0x142)},'type':{'$addToSet':_0x5202b5(0x125)},'floorlevel':{'$addToSet':_0x5202b5(0x136)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2b9f5f[0x0][_0x5202b5(0xc7)]=='English\x20(US)')var _0x36954a=users[_0x5202b5(0x15b)];else{if(_0x2b9f5f[0x0][_0x5202b5(0xc7)]==_0x5202b5(0xb8))var _0x36954a=users[_0x5202b5(0xb8)];else{if(_0x2b9f5f[0x0][_0x5202b5(0xc7)]==_0x5202b5(0x9d))var _0x36954a=users['German'];else{if(_0x2b9f5f[0x0]['language']==_0x5202b5(0x100))var _0x36954a=users['Spanish'];else{if(_0x2b9f5f[0x0][_0x5202b5(0xc7)]==_0x5202b5(0xa6))var _0x36954a=users[_0x5202b5(0xa6)];else{if(_0x2b9f5f[0x0]['language']==_0x5202b5(0x143))var _0x36954a=users[_0x5202b5(0x174)];else{if(_0x2b9f5f[0x0][_0x5202b5(0xc7)]==_0x5202b5(0xf4))var _0x36954a=users[_0x5202b5(0xf4)];else{if(_0x2b9f5f[0x0][_0x5202b5(0xc7)]==_0x5202b5(0x19a))var _0x36954a=users[_0x5202b5(0x1b5)];}}}}}}}_0x397d26['render'](_0x5202b5(0x175),{'success':_0x1979b8[_0x5202b5(0x1a4)](_0x5202b5(0x184)),'errors':_0x1979b8['flash']('errors'),'purchases':_0x3e53c5,'role':_0x1e15c8,'profile':_0x5c6276,'master_shop':_0x2b9f5f,'language':_0x36954a});}catch(_0x59f784){console[_0x5202b5(0xd2)](_0x5202b5(0x17d),_0x59f784),_0x397d26[_0x5202b5(0x193)](0xc8)[_0x5202b5(0x1a6)]({'message':_0x59f784[_0x5202b5(0x103)]});}}),router['get']('/view_log',auth,async(_0x47fdcf,_0x46b56d)=>{var _0x4f8b20=a0_0x2edef6;try{const {username:_0x3fde6a,email:_0x506a97,role:_0x513d6c}=_0x47fdcf['user'],_0x3c4e5e=_0x47fdcf[_0x4f8b20(0xc8)],_0x20d757=await profile['findOne']({'email':_0x3c4e5e['email']}),_0x525325=await staff[_0x4f8b20(0x1d6)]({'email':_0x3c4e5e[_0x4f8b20(0x165)]});if(_0x3c4e5e[_0x4f8b20(0xad)]==_0x4f8b20(0x149)){const _0x18947e=await staff['findOne']({'email':_0x3c4e5e[_0x4f8b20(0x165)]});}const _0x384b5f=await master_shop['find']();let _0xbeff23;if(_0x3c4e5e['role']=='staff'){const _0x51d406=await staff[_0x4f8b20(0x1d6)]({'email':_0x3c4e5e[_0x4f8b20(0x165)]});_0xbeff23=await purchases_finished[_0x4f8b20(0x122)]([{'$match':{'warehouse_name':_0x51d406[_0x4f8b20(0x99)]}},{'$lookup':{'from':_0x4f8b20(0xea),'localField':_0x4f8b20(0xea),'foreignField':_0x4f8b20(0x168),'as':_0x4f8b20(0x159)}},{'$unwind':_0x4f8b20(0x1e3)},{'$unwind':_0x4f8b20(0x14f)},{'$group':{'_id':_0x4f8b20(0x1b1),'invoice':{'$first':_0x4f8b20(0x1e0)},'suppliers':{'$first':_0x4f8b20(0x19e)},'date':{'$first':_0x4f8b20(0x16f)},'warehouse_name':{'$first':_0x4f8b20(0xaa)},'room':{'$first':_0x4f8b20(0x14a)},'product':{'$push':_0x4f8b20(0x14f)},'note':{'$first':_0x4f8b20(0xa7)},'paid_amount':{'$first':_0x4f8b20(0x192)},'due_amount':{'$first':_0x4f8b20(0xde)},'return_data':{'$first':_0x4f8b20(0x166)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x4f8b20(0xf6)},'suppliers_docs':{'$first':_0x4f8b20(0x1e3)},'total_product_quantity':{'$sum':_0x4f8b20(0x14c)},'level':{'$addToSet':_0x4f8b20(0xcc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4f8b20(0x125)},'floorlevel':{'$addToSet':_0x4f8b20(0x136)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xbeff23=await purchases_finished[_0x4f8b20(0x122)]([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x4f8b20(0x14f)},{'$group':{'_id':_0x4f8b20(0x1b1),'invoice':{'$first':_0x4f8b20(0x1e0)},'suppliers':{'$first':_0x4f8b20(0x19e)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x4f8b20(0x15c)},'product':{'$push':'$product'},'note':{'$first':_0x4f8b20(0xa7)},'paid_amount':{'$first':_0x4f8b20(0x192)},'due_amount':{'$first':_0x4f8b20(0xde)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4f8b20(0x189)},'expiry_date':{'$first':_0x4f8b20(0xf6)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x4f8b20(0x14c)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x4f8b20(0x142)},'type':{'$addToSet':_0x4f8b20(0x125)},'floorlevel':{'$addToSet':_0x4f8b20(0x136)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x384b5f[0x0][_0x4f8b20(0xc7)]=='English\x20(US)')var _0xc445b5=users[_0x4f8b20(0x15b)];else{if(_0x384b5f[0x0][_0x4f8b20(0xc7)]==_0x4f8b20(0xb8))var _0xc445b5=users['Hindi'];else{if(_0x384b5f[0x0][_0x4f8b20(0xc7)]==_0x4f8b20(0x9d))var _0xc445b5=users[_0x4f8b20(0x9d)];else{if(_0x384b5f[0x0]['language']==_0x4f8b20(0x100))var _0xc445b5=users[_0x4f8b20(0x100)];else{if(_0x384b5f[0x0][_0x4f8b20(0xc7)]==_0x4f8b20(0xa6))var _0xc445b5=users['French'];else{if(_0x384b5f[0x0][_0x4f8b20(0xc7)]=='Portuguese\x20(BR)')var _0xc445b5=users['Portuguese'];else{if(_0x384b5f[0x0]['language']==_0x4f8b20(0xf4))var _0xc445b5=users[_0x4f8b20(0xf4)];else{if(_0x384b5f[0x0]['language']==_0x4f8b20(0x19a))var _0xc445b5=users['Arabic'];}}}}}}}_0x46b56d['render'](_0x4f8b20(0x167),{'success':_0x47fdcf[_0x4f8b20(0x1a4)](_0x4f8b20(0x184)),'errors':_0x47fdcf[_0x4f8b20(0x1a4)](_0x4f8b20(0xfa)),'purchases':_0xbeff23,'role':_0x3c4e5e,'profile':_0x20d757,'master_shop':_0x384b5f,'language':_0xc445b5});}catch(_0x337ab5){console[_0x4f8b20(0xd2)](_0x4f8b20(0x17d),_0x337ab5),_0x46b56d[_0x4f8b20(0x193)](0xc8)['json']({'message':_0x337ab5[_0x4f8b20(0x103)]});}});function BayBinSelected(_0x1a82f2,_0xb3ae95){var _0x1aabac=a0_0x2edef6,_0x2f80ca=[],_0x18ef4c=[];if(_0x1a82f2==_0x1aabac(0x141)){switch(_0xb3ae95){case'Rack\x201':_0x2f80ca=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x2f80ca=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x18ef4c=['DG'];}else{if(_0x1a82f2=='FROZEN\x20GOODS'){switch(_0xb3ae95){case _0x1aabac(0x11a):_0x2f80ca=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x2f80ca=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x18ef4c=['FG'];}}return{'levels':_0x2f80ca,'identify':_0x18ef4c};}async function getRandom8DigitNumber(){var _0x455da4=a0_0x2edef6;const _0x1ad979=0x989680,_0xc201ba=0x5f5e0ff,_0x92d0dc=Math[_0x455da4(0x1cc)](Math[_0x455da4(0xf1)]()*(_0xc201ba-_0x1ad979+0x1))+_0x1ad979;var _0x87aa;const _0x4c72b6=await purchases_finished[_0x455da4(0x1d6)]({'invoice':_0x455da4(0xe7)+_0x92d0dc});return _0x4c72b6&&_0x4c72b6[_0x455da4(0x1b8)]>0x0?_0x87aa=_0x455da4(0xe7)+_0x92d0dc:_0x87aa=_0x455da4(0xe7)+_0x92d0dc,_0x87aa;}router[a0_0x2edef6(0x161)]('/view/add_purchases',auth,async(_0x4c169c,_0x4abaf6)=>{var _0x4ef9a8=a0_0x2edef6;try{const {username:_0x3d7c7f,email:_0x59cb56,role:_0x3684ed}=_0x4c169c['user'],_0x1578cf=_0x4c169c[_0x4ef9a8(0xc8)],_0x3dcc25=await profile[_0x4ef9a8(0x1d6)]({'email':_0x1578cf['email']}),_0x21eb39=await master_shop[_0x4ef9a8(0xd6)](),_0x413bcb=await staff[_0x4ef9a8(0x1d6)]({'email':_0x1578cf[_0x4ef9a8(0x165)]}),_0x3f20eb=await suppliers['find']({});let _0x4a28f9;if(_0x1578cf[_0x4ef9a8(0xad)]==_0x4ef9a8(0x149)){const _0x51bafb=await staff[_0x4ef9a8(0x1d6)]({'email':_0x1578cf[_0x4ef9a8(0x165)]});_0x4a28f9=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x51bafb[_0x4ef9a8(0x99)]}},{'$group':{'_id':_0x4ef9a8(0x12c),'name':{'$first':_0x4ef9a8(0x12c)}}}]);}else _0x4a28f9=await warehouse[_0x4ef9a8(0x122)]([{'$match':{'status':_0x4ef9a8(0x1dc)}},{'$group':{'_id':_0x4ef9a8(0x12c),'name':{'$first':_0x4ef9a8(0x12c)}}}]);const _0x2d7c13=await product[_0x4ef9a8(0xd6)]({}),_0x585911=await warehouse[_0x4ef9a8(0xd6)]({'status':_0x4ef9a8(0x1dc)}),_0x33be8f=await purchases_finished['find']({}),_0x18f1da=_0x33be8f[_0x4ef9a8(0x1b8)]+0x1,_0x3406a2=_0x4ef9a8(0xe7)+_0x18f1da['toString']()[_0x4ef9a8(0x183)](0x5,'0');var _0x4268c4=['Ambient',_0x4ef9a8(0x171)];if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]==_0x4ef9a8(0xb7))var _0x274b92=users['English'];else{if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]=='Hindi')var _0x274b92=users[_0x4ef9a8(0xb8)];else{if(_0x21eb39[0x0]['language']=='German')var _0x274b92=users[_0x4ef9a8(0x9d)];else{if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]==_0x4ef9a8(0x100))var _0x274b92=users[_0x4ef9a8(0x100)];else{if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]=='French')var _0x274b92=users[_0x4ef9a8(0xa6)];else{if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]=='Portuguese\x20(BR)')var _0x274b92=users[_0x4ef9a8(0x174)];else{if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]==_0x4ef9a8(0xf4))var _0x274b92=users[_0x4ef9a8(0xf4)];else{if(_0x21eb39[0x0][_0x4ef9a8(0xc7)]==_0x4ef9a8(0x19a))var _0x274b92=users[_0x4ef9a8(0x1b5)];}}}}}}}const _0x52ded0=getRandom8DigitNumber(),_0x308dd8=new Date(),_0x2a4a0e={'year':_0x4ef9a8(0x17b),'month':_0x4ef9a8(0x14d),'day':'2-digit','timeZone':_0x4ef9a8(0xe6)},_0x26e78a=_0x308dd8[_0x4ef9a8(0x1bf)](_0x4ef9a8(0x12d),_0x2a4a0e);console[_0x4ef9a8(0xd2)](_0x26e78a),_0x52ded0[_0x4ef9a8(0x126)](_0x1e4b2d=>{var _0x11b519=_0x4ef9a8;_0x4abaf6[_0x11b519(0xd9)](_0x11b519(0x130),{'success':_0x4c169c[_0x11b519(0x1a4)](_0x11b519(0x184)),'errors':_0x4c169c[_0x11b519(0x1a4)](_0x11b519(0xfa)),'role':_0x1578cf,'profile':_0x3dcc25,'suppliers':_0x3f20eb,'warehouse':_0x4a28f9,'product':_0x2d7c13,'invoice':_0x1e4b2d,'master_shop':_0x21eb39,'language':_0x274b92,'find_data':_0x585911,'rooms_data':_0x4268c4,'formattedDate':_0x26e78a});})[_0x4ef9a8(0x138)](_0x1965b4=>{var _0x4d138f=_0x4ef9a8;_0x4c169c[_0x4d138f(0x1a4)](_0x4d138f(0xfa),_0x4d138f(0x169)),_0x4abaf6[_0x4d138f(0x1b6)](_0x4d138f(0x13d));});}catch(_0x448b30){console[_0x4ef9a8(0xd2)](_0x448b30);}}),router[a0_0x2edef6(0x161)](a0_0x2edef6(0x1ca),auth,async(_0x5b2d1f,_0x3db596)=>{var _0x6b76c1=a0_0x2edef6;try{const {username:_0x50b879,email:_0x239c68,role:_0x70080}=_0x5b2d1f['user'],_0x18d2e8=_0x5b2d1f[_0x6b76c1(0xc8)],_0x40e55d=await profile[_0x6b76c1(0x1d6)]({'email':_0x18d2e8[_0x6b76c1(0x165)]}),_0x222715=await master_shop[_0x6b76c1(0xd6)](),_0x94f1e3=await staff[_0x6b76c1(0x1d6)]({'email':_0x18d2e8[_0x6b76c1(0x165)]}),_0x3d080e=await suppliers['find']({});let _0x202b36;if(_0x18d2e8[_0x6b76c1(0xad)]=='staff'){const _0x5c799c=await staff[_0x6b76c1(0x1d6)]({'email':_0x18d2e8[_0x6b76c1(0x165)]});_0x202b36=await warehouse[_0x6b76c1(0x122)]([{'$match':{'status':_0x6b76c1(0x1dc),'name':_0x5c799c[_0x6b76c1(0x99)]}},{'$group':{'_id':_0x6b76c1(0x12c),'name':{'$first':'$name'}}}]);}else _0x202b36=await warehouse[_0x6b76c1(0x122)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x6b76c1(0x12c),'name':{'$first':_0x6b76c1(0x12c)}}}]);const _0x3a6d7f=await product[_0x6b76c1(0xd6)]({}),_0x2a3db0=await warehouse[_0x6b76c1(0xd6)]({'status':_0x6b76c1(0x1dc)}),_0x2bc980=await purchases_finished[_0x6b76c1(0xd6)]({}),_0x36a686=_0x2bc980[_0x6b76c1(0x1b8)]+0x1,_0x1beb8c=_0x6b76c1(0xe7)+_0x36a686['toString']()[_0x6b76c1(0x183)](0x5,'0');var _0x11f349=['Ambient',_0x6b76c1(0x171)];if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0xb7))var _0x5a9efb=users[_0x6b76c1(0x15b)];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0xb8))var _0x5a9efb=users[_0x6b76c1(0xb8)];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0x9d))var _0x5a9efb=users[_0x6b76c1(0x9d)];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]=='Spanish')var _0x5a9efb=users[_0x6b76c1(0x100)];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0xa6))var _0x5a9efb=users[_0x6b76c1(0xa6)];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0x143))var _0x5a9efb=users[_0x6b76c1(0x174)];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0xf4))var _0x5a9efb=users['Chinese'];else{if(_0x222715[0x0][_0x6b76c1(0xc7)]==_0x6b76c1(0x19a))var _0x5a9efb=users['Arabic'];}}}}}}}const _0x4afa16=getRandom8DigitNumber();_0x4afa16['then'](_0x2dc48f=>{var _0xb8ef09=_0x6b76c1;_0x3db596[_0xb8ef09(0xd9)](_0xb8ef09(0x14e),{'success':_0x5b2d1f[_0xb8ef09(0x1a4)](_0xb8ef09(0x184)),'errors':_0x5b2d1f[_0xb8ef09(0x1a4)](_0xb8ef09(0xfa)),'role':_0x18d2e8,'profile':_0x40e55d,'suppliers':_0x3d080e,'warehouse':_0x202b36,'product':_0x3a6d7f,'invoice':_0x2dc48f,'master_shop':_0x222715,'language':_0x5a9efb,'find_data':_0x2a3db0,'rooms_data':_0x11f349});})[_0x6b76c1(0x138)](_0x3e3190=>{var _0xcb91af=_0x6b76c1;_0x5b2d1f['flash'](_0xcb91af(0xfa),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3db596[_0xcb91af(0x1b6)](_0xcb91af(0x13d));});}catch(_0x127a12){console[_0x6b76c1(0xd2)](_0x127a12);}}),router[a0_0x2edef6(0x161)]('/view/add_purchases/:id',auth,async(_0x4b664b,_0x3925bd)=>{var _0x45ca88=a0_0x2edef6;try{const _0x333fb1=_0x4b664b[_0x45ca88(0x1c5)]['id'];console[_0x45ca88(0xd2)](_0x333fb1);const _0x183508=await master_shop['find']();console[_0x45ca88(0xd2)](_0x45ca88(0xe0),_0x183508);const _0xd3535=await product[_0x45ca88(0x1d6)]({'name':_0x333fb1});console['log'](_0x45ca88(0x1c6),_0xd3535),_0x3925bd[_0x45ca88(0x193)](0xc8)[_0x45ca88(0x1a6)]({'product_data':_0xd3535,'master':_0x183508});}catch(_0x2c618d){console['log'](_0x45ca88(0xa0),_0x2c618d);}}),router['post']('/view/add_purchases',auth,async(_0x552466,_0xa1174a)=>{var _0x2fba99=a0_0x2edef6;try{const {invoice:_0x4de5ee,date:_0x1325ca,warehouse_name:_0x1ee4aa,prod_name:_0x5ce6aa,note:_0x3f188d,due_amount:_0x513d65,Room_name:_0x4cc77a,PO_number:_0x33f3d5,SCRN:_0x437c76,ReqBy:_0x49e7fe,dateofreq:_0x594577,suppliers:_0x401b52,typeservicesData:_0x264987,van:_0x2268a9,typevehicle:_0x247c41,driver:_0xbe713f,plate:_0x2ee31b,DRSI:_0x4c7735,TSU:_0x49f9c9,TFU:_0x2728ae,JO_number:_0x242e42,type_of_products:_0x205451}=_0x552466[_0x2fba99(0x10a)];if(typeof _0x5ce6aa==_0x2fba99(0x1aa))var _0x11c133=[_0x552466[_0x2fba99(0x10a)]['prod_name']],_0x1a6c87=[_0x552466['body']['prod_code']],_0x4de88f=[_0x552466[_0x2fba99(0x10a)]['prod_Qty']],_0x9e56f4=[_0x552466['body']['prod_primunit']],_0x197eae=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0xe9)]],_0x280890=[_0x552466[_0x2fba99(0x10a)]['primary_code']],_0xcd095b=[_0x552466[_0x2fba99(0x10a)]['secondary_code']],_0x15fe70=[_0x552466[_0x2fba99(0x10a)]['MaxStocks_data']],_0x16a46b=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0x1a3)]],_0x2e55d3=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0xbc)]],_0x832af0=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0x19b)]],_0x4dbb9d=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0xd7)]],_0x4caf10=[_0x552466[_0x2fba99(0x10a)]['prod_cat']],_0x53202e=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0x110)]],_0x469d35=[_0x552466[_0x2fba99(0x10a)][_0x2fba99(0xff)]],_0x5de8b8=[_0x552466[_0x2fba99(0x10a)]['sales_data_cateory']],_0xc03171=[_0x552466['body'][_0x2fba99(0x154)]];else var _0x11c133=[..._0x552466['body'][_0x2fba99(0x1d7)]],_0x1a6c87=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0x108)]],_0x4de88f=[..._0x552466['body'][_0x2fba99(0x173)]],_0x9e56f4=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0xf7)]],_0x197eae=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0xe9)]],_0x280890=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0xcf)]],_0xcd095b=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0x1de)]],_0x15fe70=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0x13c)]],_0x16a46b=[..._0x552466['body'][_0x2fba99(0x1a3)]],_0x2e55d3=[..._0x552466[_0x2fba99(0x10a)]['expiry_date']],_0x832af0=[..._0x552466[_0x2fba99(0x10a)]['product_date']],_0x4dbb9d=[..._0x552466['body'][_0x2fba99(0xd7)]],_0x4caf10=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0x1c0)]],_0x53202e=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0x110)]],_0x469d35=[..._0x552466[_0x2fba99(0x10a)][_0x2fba99(0xff)]],_0x5de8b8=[..._0x552466[_0x2fba99(0x10a)]['sales_data_cateory']],_0xc03171=[..._0x552466['body'][_0x2fba99(0x154)]];const _0x45fd4b=_0x11c133[_0x2fba99(0x187)](_0x252905=>{return _0x252905={'product_name':_0x252905};});_0xc03171[_0x2fba99(0x1b3)]((_0xe2b459,_0x5b9b70)=>{var _0x41909e=_0x2fba99;_0x45fd4b[_0x5b9b70][_0x41909e(0x154)]=_0xe2b459,_0x45fd4b[_0x5b9b70][_0x41909e(0x107)]=_0x1325ca;}),_0x5de8b8[_0x2fba99(0x1b3)]((_0x4d7391,_0x377f3c)=>{var _0x93cc37=_0x2fba99;_0x45fd4b[_0x377f3c][_0x93cc37(0xb0)]=_0x4d7391;}),_0x1a6c87[_0x2fba99(0x1b3)]((_0x5c681c,_0x4849c5)=>{var _0xb4986d=_0x2fba99;_0x45fd4b[_0x4849c5][_0xb4986d(0xdc)]=_0x5c681c;}),_0x469d35[_0x2fba99(0x1b3)]((_0x58f0d2,_0x4db6ce)=>{_0x45fd4b[_0x4db6ce]['uuid']=_0x58f0d2;}),_0x4de88f['forEach']((_0x85e5bc,_0x509b44)=>{var _0x290961=_0x2fba99;_0x45fd4b[_0x509b44][_0x290961(0x11b)]=Math['abs'](_0x85e5bc);}),_0x9e56f4[_0x2fba99(0x1b3)]((_0x2db5b8,_0x40a99c)=>{var _0x533a8b=_0x2fba99;_0x45fd4b[_0x40a99c][_0x533a8b(0xc5)]=_0x2db5b8;}),_0x197eae[_0x2fba99(0x1b3)]((_0x49a4fc,_0x31f298)=>{_0x45fd4b[_0x31f298]['secondary_unit']=_0x49a4fc;}),_0x280890['forEach']((_0xdfe4f1,_0x1af89b)=>{var _0x1a6114=_0x2fba99;_0x45fd4b[_0x1af89b][_0x1a6114(0xcf)]=_0xdfe4f1;}),_0xcd095b[_0x2fba99(0x1b3)]((_0x33b774,_0x26a7d2)=>{var _0x330d97=_0x2fba99;_0x45fd4b[_0x26a7d2][_0x330d97(0x1de)]=_0x33b774;}),_0x15fe70[_0x2fba99(0x1b3)]((_0x1cd51a,_0x523c41)=>{var _0x1a0329=_0x2fba99;_0x45fd4b[_0x523c41][_0x1a0329(0x1b7)]=_0x1cd51a;}),_0x16a46b[_0x2fba99(0x1b3)]((_0x9fd14c,_0x19edca)=>{var _0x934eb2=_0x2fba99;_0x45fd4b[_0x19edca][_0x934eb2(0x1a3)]=_0x9fd14c;}),_0x2e55d3[_0x2fba99(0x1b3)]((_0x16c37c,_0x591b43)=>{var _0x502da5=_0x2fba99;_0x45fd4b[_0x591b43][_0x502da5(0xbc)]=_0x16c37c;}),_0x832af0[_0x2fba99(0x1b3)]((_0x4ebd9d,_0x26ffd4)=>{var _0x38e371=_0x2fba99;_0x45fd4b[_0x26ffd4][_0x38e371(0x181)]=_0x4ebd9d;}),_0x4dbb9d['forEach']((_0x5c008d,_0x38f31b)=>{_0x45fd4b[_0x38f31b]['maxperunit']=_0x5c008d;}),_0x4caf10[_0x2fba99(0x1b3)]((_0x2ab3a4,_0x52dba3)=>{var _0x3d1d3d=_0x2fba99;_0x45fd4b[_0x52dba3][_0x3d1d3d(0x16d)]=_0x2ab3a4;}),_0x53202e[_0x2fba99(0x1b3)]((_0x992bf2,_0x7a185)=>{var _0x16a22d=_0x2fba99;_0x45fd4b[_0x7a185][_0x16a22d(0x110)]=_0x992bf2;});const _0x574206=new invoice_for_incoming();await _0x574206[_0x2fba99(0xfe)]();for(let _0x47f24c=0x0;_0x47f24c<=_0x11c133[_0x2fba99(0x1b8)]-0x1;_0x47f24c++){_0x45fd4b[_0x47f24c][_0x2fba99(0xb6)]='INC-'+_0x574206[_0x2fba99(0xba)][_0x2fba99(0x1d0)]()[_0x2fba99(0x183)](0x8,'0');}const _0x9cd5a7=await warehouse_validation_setup[_0x2fba99(0x122)]([{'$match':{'warehouse_name':_0x1ee4aa}}]);for(let _0x705707=0x0;_0x705707<=_0x9cd5a7[_0x2fba99(0x1b8)]-0x1;_0x705707++){const _0x360ccd=_0x9cd5a7[_0x705707];for(let _0x45f242=0x0;_0x45f242<=_0x360ccd[_0x2fba99(0x1cf)][_0x2fba99(0x1b8)]-0x1;_0x45f242++){const _0x36a0b8=_0x360ccd[_0x2fba99(0x1cf)][_0x45f242],_0x3b5121=await warehouse['aggregate']([{'$match':{'name':_0x360ccd[_0x2fba99(0x1b9)],'room':_0x360ccd[_0x2fba99(0x13f)]}},{'$unwind':_0x2fba99(0xdd)},{'$match':{'product_details.level':_0x36a0b8[_0x2fba99(0xd1)],'product_details.bay':parseInt(_0x36a0b8[_0x2fba99(0xe3)]),'product_details.product_code':_0x36a0b8[_0x2fba99(0xdc)]}}]);for(let _0x50e5d8=0x0;_0x50e5d8<=_0x3b5121['length']-0x1;_0x50e5d8++){let _0x284b85=_0x3b5121[_0x50e5d8],_0x250d25=0x0;_0x284b85[_0x2fba99(0x180)]['product_code']==_0x36a0b8[_0x2fba99(0xdc)]&&_0x284b85[_0x2fba99(0x180)][_0x2fba99(0xd1)]==_0x36a0b8[_0x2fba99(0xe3)]&&_0x284b85[_0x2fba99(0x180)]['level']==_0x36a0b8['bay']&&(_0x36a0b8[_0x2fba99(0x1dd)]=parseInt(_0x36a0b8[_0x2fba99(0x1dd)])-parseInt(_0x284b85[_0x2fba99(0x180)][_0x2fba99(0x164)]),_0x250d25++),_0x250d25=='0'&&(parseInt(_0x36a0b8[_0x2fba99(0x1dd)])>0x0&&(_0x9cd5a7[_0x705707][_0x2fba99(0x1cf)]=_0x9cd5a7[_0x705707]['product_data'][_0x2fba99(0x1c7)]({'bay':_0x36a0b8[_0x2fba99(0xd1)],'bin':_0x36a0b8[_0x2fba99(0xe3)],'max':_0x36a0b8[_0x2fba99(0x1dd)],'min':_0x36a0b8[_0x2fba99(0x1bd)],'product_code':_0x36a0b8[_0x2fba99(0xdc)],'product_id':_0x36a0b8[_0x2fba99(0x154)],'product_name':_0x36a0b8['product_name']})));}}_0x9cd5a7[_0x705707]['product_data']=_0x9cd5a7[_0x705707][_0x2fba99(0x1cf)]['filter'](_0x5f139d=>parseInt(_0x5f139d['max'])>0x0);}for(let _0x26fc05=0x0;_0x26fc05<=_0x9cd5a7[_0x2fba99(0x1b8)]-0x1;_0x26fc05++){const _0x33a78d=_0x9cd5a7[_0x26fc05];for(let _0x27f17a=0x0;_0x27f17a<=_0x33a78d[_0x2fba99(0x1cf)]['length']-0x1;_0x27f17a++){const _0x28ed9b=_0x33a78d[_0x2fba99(0x1cf)][_0x27f17a],_0x2816ea=await warehouse_temporary[_0x2fba99(0x122)]([{'$match':{'warehouse':_0x33a78d[_0x2fba99(0x1b9)],'room_name':_0x33a78d['room'],'isConfirm':_0x2fba99(0xd3),'data_type':'inc','product_code':_0x28ed9b[_0x2fba99(0xdc)],'level':_0x28ed9b[_0x2fba99(0xd1)],'bay':parseInt(_0x28ed9b[_0x2fba99(0xe3)])}}]);for(let _0x4403f1=0x0;_0x4403f1<=_0x2816ea[_0x2fba99(0x1b8)]-0x1;_0x4403f1++){let _0x5f02d8=_0x2816ea[_0x4403f1];console[_0x2fba99(0xd2)](_0x5f02d8);let _0x3201f0=0x0;_0x5f02d8[_0x2fba99(0xdc)]==_0x28ed9b[_0x2fba99(0xdc)]&&_0x5f02d8[_0x2fba99(0xd1)]==_0x28ed9b[_0x2fba99(0xe3)]&&_0x5f02d8['level']==_0x28ed9b[_0x2fba99(0xd1)]&&(_0x28ed9b['max']=parseInt(_0x28ed9b['max'])-parseInt(_0x5f02d8[_0x2fba99(0x164)]),_0x3201f0++),_0x3201f0=='0'&&(parseInt(_0x28ed9b[_0x2fba99(0x1dd)])>0x0&&(_0x9cd5a7[_0x26fc05][_0x2fba99(0x1cf)]=_0x9cd5a7[_0x26fc05][_0x2fba99(0x1cf)]['concat']({'bay':_0x28ed9b[_0x2fba99(0xd1)],'bin':_0x28ed9b[_0x2fba99(0xe3)],'max':_0x28ed9b[_0x2fba99(0x1dd)],'min':_0x28ed9b[_0x2fba99(0x1bd)],'product_code':_0x28ed9b[_0x2fba99(0xdc)],'product_id':_0x28ed9b[_0x2fba99(0x154)],'product_name':_0x28ed9b[_0x2fba99(0x199)]})));}}_0x9cd5a7[_0x26fc05][_0x2fba99(0x1cf)]=_0x9cd5a7[_0x26fc05][_0x2fba99(0x1cf)][_0x2fba99(0x18a)](_0x2281ef=>parseInt(_0x2281ef['max'])>0x0);}let _0x2915ce=[],_0x2d4ffe=0x0;for(let _0x7d80a1=0x0;_0x7d80a1<=_0x45fd4b[_0x2fba99(0x1b8)]-0x1;_0x7d80a1++){const _0x4068a1=_0x45fd4b[_0x7d80a1];let _0x3bb6f4=_0x4068a1[_0x2fba99(0x11b)];for(let _0x4846af=0x0;_0x4846af<=_0x9cd5a7['length']-0x1;_0x4846af++){const _0x5de029=_0x9cd5a7[_0x4846af];for(let _0xa84a77=0x0;_0xa84a77<=_0x5de029['product_data'][_0x2fba99(0x1b8)]-0x1;_0xa84a77++){const _0x3fd806=_0x5de029[_0x2fba99(0x1cf)][_0xa84a77];if(_0x3fd806[_0x2fba99(0xdc)]===_0x4068a1[_0x2fba99(0xdc)]){const _0x38fad0=await warehouse[_0x2fba99(0x122)]([{'$match':{'name':_0x1ee4aa,'room':_0x5de029[_0x2fba99(0x13f)]}},{'$unwind':_0x2fba99(0xdd)},{'$match':{'product_details.level':_0x3fd806[_0x2fba99(0xd1)],'product_details.bay':parseInt(_0x3fd806[_0x2fba99(0xe3)])}}]);if(_0x38fad0[_0x2fba99(0x1b8)]==0x0){for(let _0x332c11=0x0;_0x332c11<=_0x5de029[_0x2fba99(0x1cf)][_0x2fba99(0x1b8)]-0x1&&_0x3bb6f4>0x0;_0x332c11++){const _0x2bf451=_0x5de029['product_data'][_0x332c11];console[_0x2fba99(0xd2)](_0x4068a1[_0x2fba99(0xdc)]+'==='+_0x2bf451[_0x2fba99(0xdc)]+_0x2fba99(0x1c1)+_0x2bf451[_0x2fba99(0x1bd)]+_0x2fba99(0x1c1)+_0x2bf451[_0x2fba99(0x1dd)]+_0x2fba99(0x1c1)+_0x2bf451[_0x2fba99(0xd1)]+'\x20<>\x20'+_0x2bf451['bin']);if(_0x4068a1[_0x2fba99(0xdc)]===_0x2bf451['product_code']){_0x2915ce[_0x2d4ffe]={};const _0x3abb47=parseInt(_0x2bf451[_0x2fba99(0x1dd)]),_0x27ed1d=0x0;let _0x1ae3f5=_0x3abb47-_0x27ed1d,_0x38e53c=Math[_0x2fba99(0x1bd)](_0x3bb6f4,_0x1ae3f5);console['log'](_0x2fba99(0x1c4)+_0x38e53c+_0x2fba99(0x17e)+_0x4068a1[_0x2fba99(0x199)]+_0x2fba99(0x15f)+_0x5de029['warehouse_name']+_0x2fba99(0xbf)+_0x5de029[_0x2fba99(0x13f)]+_0x2fba99(0xb1)+_0x2bf451[_0x2fba99(0xd1)]+_0x2fba99(0x1c9)+_0x2bf451[_0x2fba99(0xe3)]+_0x2fba99(0xb2)+_0x2d4ffe),_0x2915ce[_0x2d4ffe][_0x2fba99(0x199)]=_0x4068a1[_0x2fba99(0x199)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xdc)]=_0x4068a1[_0x2fba99(0xdc)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x154)]=_0x4068a1['product_id'],_0x2915ce[_0x2d4ffe][_0x2fba99(0x107)]=_0x4068a1['date_recieved'],_0x2915ce[_0x2d4ffe][_0x2fba99(0xb0)]=_0x4068a1[_0x2fba99(0xb0)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xff)]=_0x4068a1[_0x2fba99(0xff)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x11b)]=_0x38e53c,_0x2915ce[_0x2d4ffe]['standard_unit']=_0x4068a1[_0x2fba99(0xc5)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x132)]=_0x4068a1[_0x2fba99(0x132)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xcf)]=_0x4068a1[_0x2fba99(0xcf)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1de)]=_0x4068a1[_0x2fba99(0x1de)],_0x2915ce[_0x2d4ffe]['maxStocks']=_0x4068a1[_0x2fba99(0x1b7)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1a3)]=_0x4068a1[_0x2fba99(0x1a3)],_0x2915ce[_0x2d4ffe]['expiry_date']=_0x4068a1[_0x2fba99(0xbc)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x181)]=_0x4068a1[_0x2fba99(0x181)],_0x2915ce[_0x2d4ffe]['maxperunit']=_0x4068a1[_0x2fba99(0x15a)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x16d)]=_0x4068a1['product_cat'],_0x2915ce[_0x2d4ffe]['invoice']=_0x4068a1['invoice'],_0x2915ce[_0x2d4ffe][_0x2fba99(0x110)]=_0x4068a1[_0x2fba99(0x110)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x113)]=_0x5de029[_0x2fba99(0x13f)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1bc)]=_0x2bf451[_0x2fba99(0xd1)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xd1)]=_0x2bf451[_0x2fba99(0xe3)],_0x3bb6f4-=_0x38e53c,_0x2d4ffe++;if(_0x3bb6f4<=0x0)break;}}if(_0x3bb6f4<=0x0){_0x552466['flash'](_0x2fba99(0xfa),'The\x20Other\x20'+_0x3bb6f4+_0x2fba99(0x133));break;}if(_0x3bb6f4>0x0){console[_0x2fba99(0xd2)](_0x2fba99(0xa2)+_0x3bb6f4+_0x2fba99(0xaf));break;}}}}}if(_0x3bb6f4>0x0){const _0x20c325=await warehouse[_0x2fba99(0x122)]([{'$match':{'name':_0x1ee4aa,'isStaging':_0x2fba99(0x1b0)}}]);_0x2915ce[_0x2d4ffe]={},_0x2915ce[_0x2d4ffe][_0x2fba99(0x199)]=_0x4068a1[_0x2fba99(0x199)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xdc)]=_0x4068a1[_0x2fba99(0xdc)],_0x2915ce[_0x2d4ffe]['product_id']=_0x4068a1[_0x2fba99(0x154)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x107)]=_0x4068a1[_0x2fba99(0x107)],_0x2915ce[_0x2d4ffe]['sales_category']=_0x4068a1[_0x2fba99(0xb0)],_0x2915ce[_0x2d4ffe]['uuid']=_0x4068a1['uuid'],_0x2915ce[_0x2d4ffe]['quantity']=_0x3bb6f4,_0x2915ce[_0x2d4ffe]['standard_unit']=_0x4068a1['standard_unit'],_0x2915ce[_0x2d4ffe][_0x2fba99(0x132)]=_0x4068a1[_0x2fba99(0x132)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xcf)]=_0x4068a1[_0x2fba99(0xcf)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1de)]=_0x4068a1[_0x2fba99(0x1de)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1b7)]=_0x4068a1[_0x2fba99(0x1b7)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1a3)]=_0x4068a1[_0x2fba99(0x1a3)],_0x2915ce[_0x2d4ffe][_0x2fba99(0xbc)]=_0x4068a1[_0x2fba99(0xbc)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x181)]=_0x4068a1['production_date'],_0x2915ce[_0x2d4ffe]['maxperunit']=_0x4068a1[_0x2fba99(0x15a)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x16d)]=_0x4068a1['product_cat'],_0x2915ce[_0x2d4ffe][_0x2fba99(0xb6)]=_0x4068a1[_0x2fba99(0xb6)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x110)]=_0x4068a1[_0x2fba99(0x110)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x113)]=_0x20c325[0x0][_0x2fba99(0x13f)],_0x2915ce[_0x2d4ffe][_0x2fba99(0x1bc)]=_0x2fba99(0x151),_0x2915ce[_0x2d4ffe][_0x2fba99(0xd1)]='1',console[_0x2fba99(0xd2)](_0x2fba99(0x1c8)+'\x20<>\x20'+_0x4068a1[_0x2fba99(0xdc)]+_0x2fba99(0x106)+_0x4068a1[_0x2fba99(0xdc)]+'\x20<>\x20'+_0x2d4ffe+'\x20<>\x20'+_0x3bb6f4),_0x552466['flash']('errors','The\x20Other\x20'+_0x3bb6f4+_0x2fba99(0x185));}}const _0x53df13=_0x2915ce[_0x2fba99(0x18a)](_0x517a28=>_0x517a28[_0x2fba99(0x11b)]!=='0'&&_0x517a28[_0x2fba99(0x11b)]!==''),_0x5b36cc=new purchases_finished({'invoice':_0x2fba99(0xe8)+_0x574206['invoice_init'][_0x2fba99(0x1d0)]()['padStart'](0x8,'0'),'suppliers':_0x401b52,'date':_0x1325ca,'warehouse_name':_0x1ee4aa,'product':_0x53df13,'note':_0x3f188d,'due_amount':_0x513d65,'room':_0x4cc77a,'POnumber':_0x33f3d5,'SCRN':_0x437c76,'JO_number':_0x242e42,'ReqBy':_0x49e7fe,'dateofreq':_0x594577,'typeservicesData':_0x264987,'van':_0x2268a9,'typevehicle':_0x247c41,'driver':_0xbe713f,'plate':_0x2ee31b,'DRSI':_0x4c7735,'TSU':_0x49f9c9,'TFU':_0x2728ae,'typeOfProducts':_0x205451}),_0x19db10=await _0x5b36cc['save'](),_0xecaea=await purchases_finished['findOne']({'_id':_0x19db10[_0x2fba99(0x19c)][_0x2fba99(0xab)]()});_0x552466[_0x2fba99(0x1a4)](_0x2fba99(0x184),_0x2fba99(0x170)),_0xa1174a[_0x2fba99(0x1b6)](_0x2fba99(0x10b)+_0xecaea[_0x2fba99(0x19c)][_0x2fba99(0xab)]());}catch(_0x4d8194){console[_0x2fba99(0xd2)](_0x4d8194);}}),router['get']('/process/:id',auth,async(_0x4b7b4c,_0xe3143f)=>{var _0x2587ab=a0_0x2edef6;try{const {username:_0x198b99,email:_0x30da96,role:_0x3971f2}=_0x4b7b4c['user'],_0x327aad=_0x4b7b4c[_0x2587ab(0xc8)],_0x530bef=_0x4b7b4c[_0x2587ab(0x1c5)]['id'],_0x25d1c6=await profile[_0x2587ab(0x1d6)]({'email':_0x327aad['email']}),_0x4090ef=await master_shop[_0x2587ab(0xd6)](),_0x2a2033=await staff[_0x2587ab(0x1d6)]({'email':_0x327aad['email']}),_0x4ad6c7=await suppliers['find']({});let _0x2d656f;if(_0x327aad['role']==_0x2587ab(0x149)){const _0x27759e=await staff[_0x2587ab(0x1d6)]({'email':_0x327aad[_0x2587ab(0x165)]});_0x2d656f=await warehouse[_0x2587ab(0x122)]([{'$match':{'status':_0x2587ab(0x1dc),'name':_0x27759e[_0x2587ab(0x99)]}},{'$group':{'_id':_0x2587ab(0x12c),'name':{'$first':_0x2587ab(0x12c)}}}]);}else _0x2d656f=await warehouse[_0x2587ab(0x122)]([{'$match':{'status':_0x2587ab(0x1dc)}},{'$group':{'_id':_0x2587ab(0x12c),'name':{'$first':_0x2587ab(0x12c)}}}]);const _0x4903cd=await purchases_finished[_0x2587ab(0x102)](_0x530bef);if(_0x4090ef[0x0][_0x2587ab(0xc7)]==_0x2587ab(0xb7))var _0x524fbd=users[_0x2587ab(0x15b)];else{if(_0x4090ef[0x0][_0x2587ab(0xc7)]==_0x2587ab(0xb8))var _0x524fbd=users[_0x2587ab(0xb8)];else{if(_0x4090ef[0x0][_0x2587ab(0xc7)]==_0x2587ab(0x9d))var _0x524fbd=users[_0x2587ab(0x9d)];else{if(_0x4090ef[0x0][_0x2587ab(0xc7)]==_0x2587ab(0x100))var _0x524fbd=users[_0x2587ab(0x100)];else{if(_0x4090ef[0x0]['language']=='French')var _0x524fbd=users[_0x2587ab(0xa6)];else{if(_0x4090ef[0x0][_0x2587ab(0xc7)]=='Portuguese\x20(BR)')var _0x524fbd=users[_0x2587ab(0x174)];else{if(_0x4090ef[0x0][_0x2587ab(0xc7)]==_0x2587ab(0xf4))var _0x524fbd=users[_0x2587ab(0xf4)];else{if(_0x4090ef[0x0][_0x2587ab(0xc7)]==_0x2587ab(0x19a))var _0x524fbd=users['Arabic'];}}}}}}}_0xe3143f[_0x2587ab(0xd9)](_0x2587ab(0xfd),{'success':_0x4b7b4c[_0x2587ab(0x1a4)](_0x2587ab(0x184)),'errors':_0x4b7b4c['flash'](_0x2587ab(0xfa)),'role':_0x327aad,'profile':_0x25d1c6,'suppliers':_0x4ad6c7,'warehouse':_0x2d656f,'master_shop':_0x4090ef,'language':_0x524fbd,'purchases_data':_0x4903cd});}catch(_0xf19563){console[_0x2587ab(0xd2)](_0xf19563);}});async function get_warehouse_data(_0x47dfa3,_0x434126){var _0x490638=a0_0x2edef6;try{const _0x5dcf11=await warehouse_temporary[_0x490638(0x1d6)]({'name':_0x47dfa3,'room':_0x434126});if(!_0x5dcf11){const _0x438668=new warehouse_temporary({'name':_0x47dfa3,'address':_0x47dfa3,'status':_0x490638(0x1dc),'room':_0x434126,'isStaging':_0x490638(0xd3)});return await _0x438668[_0x490638(0xfe)](),_0x438668;}else return _0x5dcf11;}catch(_0x45075f){console['error'](_0x490638(0x18e),_0x45075f);throw _0x45075f;}}function a0_0x5e84(_0x1bebd7,_0x241549){var _0x16b29f=a0_0x16b2();return a0_0x5e84=function(_0x5e84b4,_0x20f9bc){_0x5e84b4=_0x5e84b4-0x97;var _0x12741b=_0x16b29f[_0x5e84b4];return _0x12741b;},a0_0x5e84(_0x1bebd7,_0x241549);}router[a0_0x2edef6(0x1d9)]('/process/:id',auth,async(_0x1bf78c,_0x3421a3)=>{var _0x1b9244=a0_0x2edef6;try{const _0xe3250a=_0x1bf78c[_0x1b9244(0x1c5)]['id'],_0x394887=await purchases_finished[_0x1b9244(0x102)](_0xe3250a);let _0x2e6caa=[];_0x394887[_0x1b9244(0x1c6)][_0x1b9244(0x1b3)]((_0x3bd059,_0x5eaf06)=>{var _0x3b030a=_0x1b9244;_0x2e6caa[_0x5eaf06]={},_0x2e6caa[_0x5eaf06][_0x3b030a(0x99)]=_0x394887[_0x3b030a(0x1b9)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x154)]=_0x3bd059[_0x3b030a(0x154)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x199)]=_0x3bd059[_0x3b030a(0x199)],_0x2e6caa[_0x5eaf06][_0x3b030a(0xdc)]=_0x3bd059['product_code'],_0x2e6caa[_0x5eaf06]['product_stock']=_0x3bd059['quantity'],_0x2e6caa[_0x5eaf06]['unit']=_0x3bd059[_0x3b030a(0xc5)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x132)]=_0x3bd059[_0x3b030a(0x132)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x1bc)]=_0x3bd059[_0x3b030a(0x1bc)],_0x2e6caa[_0x5eaf06][_0x3b030a(0xd1)]=_0x3bd059[_0x3b030a(0xd1)],_0x2e6caa[_0x5eaf06][_0x3b030a(0xcf)]=_0x3bd059['primary_code'],_0x2e6caa[_0x5eaf06][_0x3b030a(0x1de)]=_0x3bd059[_0x3b030a(0x1de)],_0x2e6caa[_0x5eaf06]['maxStocks']=_0x3bd059[_0x3b030a(0x1b7)],_0x2e6caa[_0x5eaf06]['batch_code']=_0x3bd059[_0x3b030a(0x1a3)],_0x2e6caa[_0x5eaf06][_0x3b030a(0xbc)]=_0x3bd059[_0x3b030a(0xbc)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x181)]=_0x3bd059[_0x3b030a(0x181)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x15a)]=_0x3bd059[_0x3b030a(0x15a)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x16d)]=_0x3bd059[_0x3b030a(0x16d)],_0x2e6caa[_0x5eaf06]['room_name']=_0x3bd059[_0x3b030a(0x113)],_0x2e6caa[_0x5eaf06][_0x3b030a(0xb6)]=_0x3bd059[_0x3b030a(0xb6)],_0x2e6caa[_0x5eaf06][_0x3b030a(0xff)]=_0x3bd059[_0x3b030a(0xff)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x110)]=_0x3bd059['gross_price'],_0x2e6caa[_0x5eaf06][_0x3b030a(0xb0)]=_0x3bd059[_0x3b030a(0xb0)],_0x2e6caa[_0x5eaf06]['date_recieved']=_0x3bd059[_0x3b030a(0x107)],_0x2e6caa[_0x5eaf06][_0x3b030a(0x17a)]=_0x3bd059[_0x3b030a(0x19c)][_0x3b030a(0xab)](),_0x2e6caa[_0x5eaf06][_0x3b030a(0x97)]=_0x3b030a(0xc9),_0x2e6caa[_0x5eaf06][_0x3b030a(0x114)]=_0x3b030a(0x1b0),_0x2e6caa[_0x5eaf06][_0x3b030a(0x12a)]=_0x3b030a(0xd3);});for(let _0x16b570=0x0;_0x16b570<=_0x2e6caa[_0x1b9244(0x1b8)]-0x1;_0x16b570++){const _0x541369=_0x2e6caa[_0x16b570],_0x3ae47b=new warehouse_temporary(_0x541369);await _0x3ae47b[_0x1b9244(0xfe)]();}_0x394887['isProcess']=_0x1b9244(0x1b0),await _0x394887[_0x1b9244(0xfe)](),_0x1bf78c[_0x1b9244(0x1a4)](_0x1b9244(0x184),_0x1b9244(0xef)),_0x3421a3[_0x1b9244(0x1b6)]('/all_purchases_finished/process/'+_0x394887[_0x1b9244(0x19c)][_0x1b9244(0xab)]());}catch(_0x43ef01){}}),router[a0_0x2edef6(0x1d9)]('/view/add_purchases_logs',auth,async(_0x3bf575,_0x292367)=>{var _0x4de0cd=a0_0x2edef6;try{const {invoice:_0x594fec,date:_0x3fe20b,warehouse_name:_0x142fe3,prod_name:_0x4abcd8,note:_0xbb9661,due_amount:_0x2febf6,Room_name:_0x5efa01,PO_number:_0x15b91b,SCRN:_0x2f6f15,ReqBy:_0xb0625d,dateofreq:_0x36638b,suppliers:_0x13e8e3,typeservicesData:_0x1377f,van:_0x145f64,typevehicle:_0x4d1d6c,driver:_0x36ec1b,plate:_0x374f9c,DRSI:_0x177295,TSU:_0x17403e,TFU:_0x3a829b,JO_number:_0x723db5,type_of_products:_0x2442d5}=_0x3bf575[_0x4de0cd(0x10a)];if(typeof _0x4abcd8=='string')var _0xc001c2=[_0x3bf575['body']['prod_name']],_0x17ca33=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x108)]],_0x16a063=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x173)]],_0x171944=[_0x3bf575['body'][_0x4de0cd(0xf7)]],_0x581e63=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xe9)]],_0x43e7eb=[_0x3bf575[_0x4de0cd(0x10a)]['prod_level']],_0x52a37c=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xcf)]],_0x5b6eee=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x1de)]],_0x5f051a=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x13c)]],_0x45ab56=[_0x3bf575['body'][_0x4de0cd(0x1a3)]],_0x311e5e=[_0x3bf575[_0x4de0cd(0x10a)]['expiry_date']],_0x374eb0=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x19b)]],_0x1413a7=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xd7)]],_0x10ff6e=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x1c0)]],_0x38cbc6=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x1ad)]],_0x5eb5db=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x110)]],_0x55bb5d=[_0x3bf575[_0x4de0cd(0x10a)]['uuid']],_0x3529f3=[_0x3bf575['body'][_0x4de0cd(0x9b)]],_0x5601d6=[_0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xe4)]];else var _0xc001c2=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x1d7)]],_0x17ca33=[..._0x3bf575[_0x4de0cd(0x10a)]['prod_code']],_0x16a063=[..._0x3bf575[_0x4de0cd(0x10a)]['prod_Qty']],_0x171944=[..._0x3bf575['body'][_0x4de0cd(0xf7)]],_0x581e63=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xe9)]],_0x43e7eb=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xed)]],_0x52a37c=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xcf)]],_0x5b6eee=[..._0x3bf575['body'][_0x4de0cd(0x1de)]],_0x5f051a=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x13c)]],_0x45ab56=[..._0x3bf575[_0x4de0cd(0x10a)]['batch_code']],_0x311e5e=[..._0x3bf575[_0x4de0cd(0x10a)]['expiry_date']],_0x374eb0=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x19b)]],_0x1413a7=[..._0x3bf575[_0x4de0cd(0x10a)]['max_product_unit']],_0x10ff6e=[..._0x3bf575[_0x4de0cd(0x10a)]['prod_cat']],_0x38cbc6=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0x1ad)]],_0x5eb5db=[..._0x3bf575[_0x4de0cd(0x10a)]['gross_price']],_0x55bb5d=[..._0x3bf575['body'][_0x4de0cd(0xff)]],_0x3529f3=[..._0x3bf575[_0x4de0cd(0x10a)]['sales_data_cateory']],_0x5601d6=[..._0x3bf575[_0x4de0cd(0x10a)][_0x4de0cd(0xe4)]];const _0x19f31b=_0xc001c2[_0x4de0cd(0x187)](_0x2b3332=>{return _0x2b3332={'product_name':_0x2b3332};});_0x5601d6['forEach']((_0x32adc7,_0x461d27)=>{_0x19f31b[_0x461d27]['type_of_products']=_0x32adc7;}),_0x3529f3['forEach']((_0x31f36c,_0x38bbc9)=>{var _0x3c1918=_0x4de0cd;_0x19f31b[_0x38bbc9][_0x3c1918(0xb0)]=_0x31f36c;}),_0x17ca33[_0x4de0cd(0x1b3)]((_0xa3e327,_0x534985)=>{var _0x993d5e=_0x4de0cd;_0x19f31b[_0x534985][_0x993d5e(0xdc)]=_0xa3e327;}),_0x55bb5d['forEach']((_0x45cc63,_0x8194aa)=>{var _0x4908a2=_0x4de0cd;_0x19f31b[_0x8194aa][_0x4908a2(0xff)]=_0x45cc63;}),_0x16a063[_0x4de0cd(0x1b3)]((_0x402b91,_0x2793e9)=>{var _0x2e453c=_0x4de0cd;_0x19f31b[_0x2793e9]['quantity']=Math[_0x2e453c(0xc1)](_0x402b91);}),_0x171944['forEach']((_0x549f8d,_0x41a8c2)=>{var _0x12310e=_0x4de0cd;_0x19f31b[_0x41a8c2][_0x12310e(0xc5)]=_0x549f8d;}),_0x581e63[_0x4de0cd(0x1b3)]((_0x1050fd,_0x512786)=>{_0x19f31b[_0x512786]['secondary_unit']=_0x1050fd;}),_0x43e7eb[_0x4de0cd(0x1b3)]((_0x2e8467,_0x802b51)=>{var _0x3d27da=_0x4de0cd,_0x492e91=_0x2e8467[_0x3d27da(0x1a2)](/[A-Za-z]+/)[0x0],_0x3ae3d5=parseInt(_0x2e8467[_0x3d27da(0x1a2)](/\d+/)[0x0]);_0x19f31b[_0x802b51][_0x3d27da(0x1bc)]=_0x492e91,_0x19f31b[_0x802b51][_0x3d27da(0xd1)]=_0x3ae3d5;}),_0x52a37c[_0x4de0cd(0x1b3)]((_0xe849a,_0x275ad0)=>{var _0x3a624b=_0x4de0cd;_0x19f31b[_0x275ad0][_0x3a624b(0xcf)]=_0xe849a;}),_0x5b6eee[_0x4de0cd(0x1b3)]((_0x224914,_0x39fd25)=>{var _0x5d2cb3=_0x4de0cd;_0x19f31b[_0x39fd25][_0x5d2cb3(0x1de)]=_0x224914;}),_0x5f051a[_0x4de0cd(0x1b3)]((_0x58ca02,_0x52daaa)=>{var _0x5b4e43=_0x4de0cd;_0x19f31b[_0x52daaa][_0x5b4e43(0x1b7)]=_0x58ca02;}),_0x45ab56[_0x4de0cd(0x1b3)]((_0x1da999,_0x4d5a9d)=>{_0x19f31b[_0x4d5a9d]['batch_code']=_0x1da999;}),_0x311e5e[_0x4de0cd(0x1b3)]((_0x3705ae,_0x390877)=>{var _0x24aef4=_0x4de0cd;_0x19f31b[_0x390877][_0x24aef4(0xbc)]=_0x3705ae;}),_0x374eb0[_0x4de0cd(0x1b3)]((_0xd85538,_0x1ee13c)=>{var _0x4b4d5f=_0x4de0cd;_0x19f31b[_0x1ee13c][_0x4b4d5f(0x181)]=_0xd85538;}),_0x1413a7[_0x4de0cd(0x1b3)]((_0x3e2d32,_0x4a5a13)=>{var _0x1476e3=_0x4de0cd;_0x19f31b[_0x4a5a13][_0x1476e3(0x15a)]=_0x3e2d32;}),_0x10ff6e[_0x4de0cd(0x1b3)]((_0x4dee84,_0x4c446f)=>{_0x19f31b[_0x4c446f]['product_cat']=_0x4dee84;}),_0x38cbc6[_0x4de0cd(0x1b3)]((_0x2db9ce,_0x368711)=>{var _0x4a24f6=_0x4de0cd;_0x19f31b[_0x368711][_0x4a24f6(0x113)]=_0x2db9ce;}),_0x5eb5db[_0x4de0cd(0x1b3)]((_0x149f73,_0x23a2fa)=>{var _0x4677f9=_0x4de0cd;_0x19f31b[_0x23a2fa][_0x4677f9(0x110)]=_0x149f73;});const _0x34ef66=new purchases_logs();await _0x34ef66[_0x4de0cd(0xfe)]();for(let _0x1f2409=0x0;_0x1f2409<=_0x38cbc6[_0x4de0cd(0x1b8)]-0x1;_0x1f2409++){_0x19f31b[_0x1f2409][_0x4de0cd(0xb6)]=_0x4de0cd(0x198)+_0x34ef66[_0x4de0cd(0xba)][_0x4de0cd(0x1d0)]()[_0x4de0cd(0x183)](0x8,'0');}const _0x2c8cdb=_0x19f31b[_0x4de0cd(0x18a)](_0x32f6be=>_0x32f6be[_0x4de0cd(0x11b)]!=='0'&&_0x32f6be[_0x4de0cd(0x11b)]!==''),_0x19eb70=new purchases_finished({'invoice':'LOG-INC-'+_0x34ef66[_0x4de0cd(0xba)][_0x4de0cd(0x1d0)]()[_0x4de0cd(0x183)](0x8,'0'),'suppliers':_0x13e8e3,'date':_0x3fe20b,'warehouse_name':_0x142fe3,'product':_0x2c8cdb,'note':_0xbb9661,'due_amount':_0x2febf6,'room':_0x5efa01,'POnumber':_0x15b91b,'SCRN':_0x2f6f15,'JO_number':_0x723db5,'ReqBy':_0xb0625d,'dateofreq':_0x36638b,'typeservicesData':_0x1377f,'van':_0x145f64,'typevehicle':_0x4d1d6c,'driver':_0x36ec1b,'plate':_0x374f9c,'DRSI':_0x177295,'TSU':_0x17403e,'TFU':_0x3a829b,'typeOfProducts':_0x2442d5}),_0x4ce4c3=await _0x19eb70[_0x4de0cd(0xfe)](),_0x429c82=await purchases_finished[_0x4de0cd(0x1d6)]({'_id':_0x4ce4c3[_0x4de0cd(0x19c)][_0x4de0cd(0xab)]()}),_0x24a9e9=_0x429c82[_0x4de0cd(0x1c6)][_0x4de0cd(0x187)](async _0x424772=>{var _0x4a7da8=_0x4de0cd;try{var _0x3af338=await warehouse['findOne']({'name':_0x142fe3,'room':_0x424772[_0x4a7da8(0x113)]}),_0x13d905=0x0;const _0x3f5320=_0x3af338['product_details'][_0x4a7da8(0x187)](_0x312066=>{var _0x4af367=_0x4a7da8;console[_0x4af367(0xd2)](_0x312066['product_name']+'=='+_0x424772['product_name']+'&&'+_0x312066[_0x4af367(0xd1)]+'=='+_0x424772[_0x4af367(0xd1)]+'&&'+_0x312066['expiry_date']+'=='+_0x424772[_0x4af367(0xbc)]+'&&'+_0x312066[_0x4af367(0x181)]+'=='+_0x424772['production_date']+'&&'+_0x312066[_0x4af367(0x1a3)]+'=='+_0x424772[_0x4af367(0x1a3)]+'&&'+_0x312066[_0x4af367(0xb6)]+'=='+_0x429c82['invoice']),_0x312066['product_name']==_0x424772[_0x4af367(0x199)]&&_0x312066[_0x4af367(0xd1)]==_0x424772[_0x4af367(0xd1)]&&_0x312066[_0x4af367(0x1bc)]==_0x424772[_0x4af367(0x1bc)]&&_0x312066['expiry_date']==_0x424772[_0x4af367(0xbc)]&&_0x312066[_0x4af367(0x181)]==_0x424772[_0x4af367(0x181)]&&_0x312066['batch_code']==_0x424772[_0x4af367(0x1a3)]&&_0x312066['invoice']==_0x429c82[_0x4af367(0xb6)]&&(_0x312066[_0x4af367(0x164)]=Math['abs'](_0x312066['product_stock'])+Math['abs'](_0x424772[_0x4af367(0x11b)]),_0x13d905++);});return _0x13d905==0x0&&(_0x3af338['product_details']=_0x3af338['product_details'][_0x4a7da8(0x1c7)]({'product_name':_0x424772[_0x4a7da8(0x199)],'product_stock':Math['abs'](_0x424772[_0x4a7da8(0x11b)]),'primary_code':_0x424772[_0x4a7da8(0xcf)],'secondary_code':_0x424772['secondary_code'],'product_code':_0x424772[_0x4a7da8(0xdc)],'bay':_0x424772[_0x4a7da8(0xd1)],'level':_0x424772[_0x4a7da8(0x1bc)],'maxProducts':_0x424772[_0x4a7da8(0x1b7)],'unit':_0x424772['standard_unit'],'secondary_unit':_0x424772['secondary_unit'],'expiry_date':_0x424772[_0x4a7da8(0xbc)],'production_date':_0x424772[_0x4a7da8(0x181)],'maxProducts':_0x424772[_0x4a7da8(0x1b7)],'maxPerUnit':_0x424772['maxperunit'],'batch_code':_0x424772[_0x4a7da8(0x1a3)],'product_cat':_0x424772['product_cat'],'invoice':_0x424772['invoice'],'id_incoming':_0x424772[_0x4a7da8(0x19c)],'uuid':_0x424772[_0x4a7da8(0xff)],'gross_price':_0x424772[_0x4a7da8(0x110)],'sales_category':_0x424772[_0x4a7da8(0xb0)],'type_products':_0x424772[_0x4a7da8(0x1e1)]})),_0x3af338;}catch(_0x58f30a){return console[_0x4a7da8(0x1d3)](_0x4a7da8(0x176),_0x58f30a),null;}});Promise['all'](_0x24a9e9)['then'](async _0x3abf47=>{var _0x5b4f29=_0x4de0cd;try{for(const _0x12bfaf of _0x3abf47){await warehouse[_0x5b4f29(0x147)]({'_id':_0x12bfaf[_0x5b4f29(0x19c)]},{'$addToSet':{'product_details':{'$each':_0x12bfaf[_0x5b4f29(0x180)]}}});}const _0x448cbd=await master_shop[_0x5b4f29(0xd6)](),_0x2ecd0f=await email_settings['findOne'](),_0x238d25=await supervisor_settings[_0x5b4f29(0xd6)]();var _0x5269f1=_0x429c82[_0x5b4f29(0x1c6)],_0x2f309a='',_0xe0d5e7;for(_0xe0d5e7 in _0x5269f1){var _0x2693b8='FG';_0x429c82['warehouse_name']==_0x5b4f29(0x141)&&(_0x2693b8='DG'),_0x2f309a+=_0x5b4f29(0xa4)+_0x5b4f29(0x145)+_0x5269f1[_0xe0d5e7][_0x5b4f29(0x199)]+'</td>'+_0x5b4f29(0x145)+_0x5269f1[_0xe0d5e7]['product_code']+_0x5b4f29(0x163)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5269f1[_0xe0d5e7]['quantity']+_0x5b4f29(0x163)+_0x5b4f29(0x145)+_0x5269f1[_0xe0d5e7][_0x5b4f29(0xc5)]+'</td>'+_0x5b4f29(0x145)+_0x5269f1[_0xe0d5e7]['secondary_unit']+_0x5b4f29(0x163)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x429c82[_0x5b4f29(0x1b9)]+_0x5b4f29(0x163)+_0x5b4f29(0x145)+_0x5269f1[_0xe0d5e7][_0x5b4f29(0x113)]+_0x5b4f29(0x163)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2693b8+_0x5269f1[_0xe0d5e7][_0x5b4f29(0xd1)]+_0x5b4f29(0x163),_0x5b4f29(0xd0);}let _0x2fd835=nodemailer['createTransport']({'host':_0x2ecd0f[_0x5b4f29(0x182)],'port':Number(_0x2ecd0f[_0x5b4f29(0x104)]),'secure':![],'auth':{'user':_0x2ecd0f['email'],'pass':_0x2ecd0f[_0x5b4f29(0x1c2)]}}),_0xa4420c={'from':_0x2ecd0f[_0x5b4f29(0x165)],'to':_0x238d25[0x0][_0x5b4f29(0x140)],'subject':_0x5b4f29(0xd4),'attachments':[{'filename':_0x5b4f29(0x158),'path':__dirname+'/../public'+_0x5b4f29(0x16c)+_0x448cbd[0x0][_0x5b4f29(0x1a0)],'cid':_0x5b4f29(0x128)}],'html':_0x5b4f29(0xf9)+_0x5b4f29(0x1db)+_0x5b4f29(0xf0)+_0x5b4f29(0x1d5)+_0x5b4f29(0xcb)+'<div>'+_0x5b4f29(0xc4)+_0x5b4f29(0xda)+_0x5b4f29(0x1d5)+'<h2>\x20'+_0x448cbd[0x0][_0x5b4f29(0x162)]+_0x5b4f29(0xf2)+_0x5b4f29(0xda)+_0x5b4f29(0xda)+_0x5b4f29(0x186)+_0x5b4f29(0x1d5)+_0x5b4f29(0x123)+_0x5b4f29(0x1af)+_0x429c82[_0x5b4f29(0xb6)]+'\x20'+_0x5b4f29(0x135)+_0x5b4f29(0x1da)+_0x429c82[_0x5b4f29(0x1a8)]+'\x20'+_0x5b4f29(0xfb)+_0x5b4f29(0x15e)+_0x5b4f29(0xda)+_0x5b4f29(0xa9)+_0x5b4f29(0x1d4)+_0x5b4f29(0xa4)+_0x5b4f29(0x17c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5b4f29(0x101)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5b4f29(0x160)+_0x5b4f29(0x116)+_0x5b4f29(0xcd)+_0x5b4f29(0x191)+_0x5b4f29(0xd0)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2f309a+'\x20'+_0x5b4f29(0x1d1)+'</table>'+_0x5b4f29(0x1d5)+_0x5b4f29(0xfc)+'<h5>'+_0x448cbd[0x0]['site_title']+_0x5b4f29(0x15e)+_0x5b4f29(0xda)+_0x5b4f29(0xda)+'</body></html>'};_0x2fd835['sendMail'](_0xa4420c,function(_0x372f5e,_0x32cf84){var _0x560f43=_0x5b4f29;_0x372f5e?(console[_0x560f43(0xd2)](_0x372f5e),console[_0x560f43(0xd2)]('Error\x20Occurs')):console[_0x560f43(0xd2)](_0x560f43(0x139));});}catch(_0x1661b7){console[_0x5b4f29(0x1d3)](_0x1661b7),_0x292367[_0x5b4f29(0x193)](0x1f4)[_0x5b4f29(0x1a6)]({'error':_0x5b4f29(0x134),'message':_0x1661b7[_0x5b4f29(0x103)]});}})[_0x4de0cd(0x138)](_0x344d5c=>{var _0x474a8d=_0x4de0cd;console[_0x474a8d(0x1d3)](_0x344d5c);}),_0x3bf575[_0x4de0cd(0x1a4)](_0x4de0cd(0x184),_0x4de0cd(0x170)),_0x292367[_0x4de0cd(0x1b6)](_0x4de0cd(0x153)+_0x429c82['_id'][_0x4de0cd(0xab)]());}catch(_0x52a3da){console[_0x4de0cd(0xd2)](_0x52a3da);}}),router[a0_0x2edef6(0x161)](a0_0x2edef6(0x1c3),auth,async(_0xbf121,_0x2ab0b5)=>{var _0x1be345=a0_0x2edef6;try{const {username:_0x323f3b,email:_0xad0a7,role:_0x31fc81}=_0xbf121['user'],_0x2c09b7=_0xbf121[_0x1be345(0xc8)],_0x254474=await profile[_0x1be345(0x1d6)]({'email':_0x2c09b7[_0x1be345(0x165)]}),_0x10b555=await master_shop['find'](),_0x509c0f=_0xbf121['params']['id'],_0x1e2390=await purchases_finished[_0x1be345(0x102)](_0x509c0f),_0x428c14=await suppliers[_0x1be345(0xd6)]({});let _0x4b979b;if(_0x2c09b7[_0x1be345(0xad)]=='staff'){const _0x50d78=await staff[_0x1be345(0x1d6)]({'email':_0x2c09b7[_0x1be345(0x165)]});_0x4b979b=await warehouse[_0x1be345(0xd6)]({'status':'Enabled','name':_0x50d78['warehouse'],'warehouse_category':_0x1be345(0x118)});}else _0x4b979b=await warehouse[_0x1be345(0x122)]([{'$match':{'status':_0x1be345(0x1dc),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x1be345(0x12c),'name':{'$first':_0x1be345(0x12c)}}}]);const _0x25a290=await product[_0x1be345(0xd6)]({}),_0x143ed9=BayBinSelected(_0x1e2390[_0x1be345(0x1b9)],_0x1e2390[_0x1be345(0x13f)]);let _0x16f1f1=new Date(_0x1e2390['expiry_date']),_0x105f7e=('0'+_0x16f1f1[_0x1be345(0x13b)]())[_0x1be345(0x17f)](-0x2),_0xadc21e=('0'+(_0x16f1f1[_0x1be345(0x16b)]()+0x1))[_0x1be345(0x17f)](-0x2),_0x216652=_0x16f1f1['getFullYear'](),_0x596053=_0x216652+'-'+_0xadc21e+'-'+_0x105f7e;if(_0x10b555[0x0]['language']==_0x1be345(0xb7)){var _0x5a92aa=users[_0x1be345(0x15b)];console[_0x1be345(0xd2)](_0x5a92aa);}else{if(_0x10b555[0x0]['language']==_0x1be345(0xb8))var _0x5a92aa=users[_0x1be345(0xb8)];else{if(_0x10b555[0x0][_0x1be345(0xc7)]=='German')var _0x5a92aa=users[_0x1be345(0x9d)];else{if(_0x10b555[0x0][_0x1be345(0xc7)]=='Spanish')var _0x5a92aa=users['Spanish'];else{if(_0x10b555[0x0][_0x1be345(0xc7)]==_0x1be345(0xa6))var _0x5a92aa=users[_0x1be345(0xa6)];else{if(_0x10b555[0x0][_0x1be345(0xc7)]=='Portuguese\x20(BR)')var _0x5a92aa=users[_0x1be345(0x174)];else{if(_0x10b555[0x0][_0x1be345(0xc7)]==_0x1be345(0xf4))var _0x5a92aa=users['Chinese'];else{if(_0x10b555[0x0][_0x1be345(0xc7)]==_0x1be345(0x19a))var _0x5a92aa=users[_0x1be345(0x1b5)];}}}}}}}_0x2ab0b5['render'](_0x1be345(0x129),{'success':_0xbf121[_0x1be345(0x1a4)](_0x1be345(0x184)),'errors':_0xbf121[_0x1be345(0x1a4)](_0x1be345(0xfa)),'role':_0x2c09b7,'profile':_0x254474,'purchases':_0x1e2390,'suppliers':_0x428c14,'warehouse':_0x4b979b,'product':_0x25a290,'master_shop':_0x10b555,'language':_0x5a92aa,'ed_fullDate':_0x596053,'dataSelected':_0x143ed9});}catch(_0x3e80d7){console[_0x1be345(0xd2)](_0x3e80d7);}}),router['get']('/view/:id',auth,async(_0x12e340,_0x2fc9f7)=>{var _0x15da5a=a0_0x2edef6;try{const {username:_0x2f27f1,email:_0x9dcf34,role:_0x4a981c}=_0x12e340[_0x15da5a(0xc8)],_0x16c059=_0x12e340[_0x15da5a(0xc8)],_0x4fb60d=await profile[_0x15da5a(0x1d6)]({'email':_0x16c059['email']}),_0x42fefd=await master_shop[_0x15da5a(0xd6)](),_0x493437=_0x12e340[_0x15da5a(0x1c5)]['id'],_0x175ecc=await purchases_finished[_0x15da5a(0x102)](_0x493437),_0x3073fd=await suppliers[_0x15da5a(0xd6)]({});let _0x4cadf5;if(_0x16c059[_0x15da5a(0xad)]==_0x15da5a(0x149)){const _0x2aa2e9=await staff[_0x15da5a(0x1d6)]({'email':_0x16c059['email']});_0x4cadf5=await warehouse['find']({'status':'Enabled','name':_0x2aa2e9['warehouse'],'warehouse_category':_0x15da5a(0x118)});}else _0x4cadf5=await warehouse[_0x15da5a(0x122)]([{'$match':{'status':_0x15da5a(0x1dc),'warehouse_category':_0x15da5a(0x118)}},{'$group':{'_id':_0x15da5a(0x12c),'name':{'$first':_0x15da5a(0x12c)}}}]);const _0x220147=await product[_0x15da5a(0xd6)]({}),_0x5857ef=BayBinSelected(_0x175ecc['warehouse_name'],_0x175ecc['room']);let _0x2c4ff6=new Date(_0x175ecc['expiry_date']),_0x1e44f9=('0'+_0x2c4ff6[_0x15da5a(0x13b)]())['slice'](-0x2),_0xe0de53=('0'+(_0x2c4ff6[_0x15da5a(0x16b)]()+0x1))['slice'](-0x2),_0x59bc95=_0x2c4ff6[_0x15da5a(0x152)](),_0x352b09=_0x59bc95+'-'+_0xe0de53+'-'+_0x1e44f9;if(_0x42fefd[0x0]['language']==_0x15da5a(0xb7)){var _0xe5578e=users[_0x15da5a(0x15b)];console[_0x15da5a(0xd2)](_0xe5578e);}else{if(_0x42fefd[0x0][_0x15da5a(0xc7)]==_0x15da5a(0xb8))var _0xe5578e=users[_0x15da5a(0xb8)];else{if(_0x42fefd[0x0][_0x15da5a(0xc7)]==_0x15da5a(0x9d))var _0xe5578e=users[_0x15da5a(0x9d)];else{if(_0x42fefd[0x0]['language']==_0x15da5a(0x100))var _0xe5578e=users['Spanish'];else{if(_0x42fefd[0x0][_0x15da5a(0xc7)]==_0x15da5a(0xa6))var _0xe5578e=users[_0x15da5a(0xa6)];else{if(_0x42fefd[0x0][_0x15da5a(0xc7)]=='Portuguese\x20(BR)')var _0xe5578e=users[_0x15da5a(0x174)];else{if(_0x42fefd[0x0][_0x15da5a(0xc7)]==_0x15da5a(0xf4))var _0xe5578e=users[_0x15da5a(0xf4)];else{if(_0x42fefd[0x0][_0x15da5a(0xc7)]==_0x15da5a(0x19a))var _0xe5578e=users['Arabic'];}}}}}}}_0x2fc9f7[_0x15da5a(0xd9)]('edit_purchases_finished',{'success':_0x12e340[_0x15da5a(0x1a4)]('success'),'errors':_0x12e340[_0x15da5a(0x1a4)](_0x15da5a(0xfa)),'role':_0x16c059,'profile':_0x4fb60d,'purchases':_0x175ecc,'suppliers':_0x3073fd,'warehouse':_0x4cadf5,'product':_0x220147,'master_shop':_0x42fefd,'language':_0xe5578e,'ed_fullDate':_0x352b09,'dataSelected':_0x5857ef});}catch(_0x14055f){console['log'](_0x14055f);}}),router[a0_0x2edef6(0x1d9)](a0_0x2edef6(0x177),auth,async(_0x46b272,_0x237ee5)=>{var _0x2875b8=a0_0x2edef6;try{const _0x3e46a5=_0x46b272[_0x2875b8(0x1c5)]['id'],_0x4c25c3=await purchases_finished['findOne']({'_id':_0x46b272['params']['id']}),_0x3070aa=await warehouse[_0x2875b8(0x1d6)]({'name':_0x4c25c3[_0x2875b8(0x1b9)],'room':_0x4c25c3[_0x2875b8(0x13f)]});_0x4c25c3['product'][_0x2875b8(0x1b3)](_0x5ddd38=>{var _0x1cf7cd=_0x2875b8;const _0xec6a9b=_0x3070aa[_0x1cf7cd(0x180)][_0x1cf7cd(0x187)](_0x2a9190=>{var _0x7da2db=_0x1cf7cd;_0x2a9190['product_name']==_0x5ddd38[_0x7da2db(0x199)]&&_0x2a9190[_0x7da2db(0xd1)]==_0x5ddd38[_0x7da2db(0xd1)]&&(_0x2a9190[_0x7da2db(0x164)]=parseInt(_0x2a9190['product_stock'])-parseInt(_0x5ddd38[_0x7da2db(0x11b)]));});}),await _0x3070aa['save']();const {invoice:_0x5f6663,suppliers:_0x589935,date:_0x5857da,warehouse_name:_0x157425,prod_name:_0x3ad8cc,prod_code:_0x3a9776,prod_qty:_0x147c3d,prod_unit:_0x946bba,prod_secondunit:_0x2cb611,prod_level:_0x492232,prod_isle:_0x4f455a,prod_pallet:_0x8055b7,note:_0x2259ff,expiry_date:_0x193e75,batch_code:_0x355fa8,paid_amount:_0x5bf8b3,due_amount:_0x1865d6,Room_name:_0x3f192f,primary_code:_0x2dfae1,secondary_code:_0x4f7488,PO_number:_0x3010c8,JO_number:_0x12ac71}=_0x46b272['body'];if(typeof _0x3ad8cc==_0x2875b8(0x1aa))var _0x2647ef=[_0x46b272['body']['prod_name']],_0x355060=[_0x46b272['body']['prod_code']],_0x4cfec1=[_0x46b272['body'][_0x2875b8(0xc6)]],_0x3a1127=[_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0x11c)]],_0x4a020b=[_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xe9)]],_0x45ed4e=[_0x46b272['body']['prod_level']],_0xe7da18=[_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xcf)]],_0x27b582=[_0x46b272[_0x2875b8(0x10a)]['secondary_code']],_0xf48526=[_0x46b272['body'][_0x2875b8(0x13c)]],_0x5e169e=[_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0x1a3)]],_0x4ba6f8=[_0x46b272['body'][_0x2875b8(0xbc)]];else var _0x2647ef=[..._0x46b272['body'][_0x2875b8(0x1d7)]],_0x355060=[..._0x46b272[_0x2875b8(0x10a)][_0x2875b8(0x108)]],_0x4cfec1=[..._0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xc6)]],_0x3a1127=[..._0x46b272[_0x2875b8(0x10a)][_0x2875b8(0x11c)]],_0x4a020b=[..._0x46b272['body'][_0x2875b8(0xe9)]],_0x45ed4e=[..._0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xed)]],_0xe7da18=[..._0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xcf)]],_0x27b582=[..._0x46b272[_0x2875b8(0x10a)][_0x2875b8(0x1de)]],_0xf48526=[..._0x46b272['body'][_0x2875b8(0x13c)]],_0x5e169e=[..._0x46b272[_0x2875b8(0x10a)]['batch_code']],_0x4ba6f8=[..._0x46b272[_0x2875b8(0x10a)]['expiry_date']];const _0x206acf=_0x2647ef[_0x2875b8(0x187)](_0x4ac50d=>{return _0x4ac50d={'product_name':_0x4ac50d};});_0x355060['forEach']((_0x4e527d,_0x635b97)=>{var _0xa590d=_0x2875b8;_0x206acf[_0x635b97][_0xa590d(0xdc)]=_0x4e527d;}),_0x4cfec1[_0x2875b8(0x1b3)]((_0x18cbdd,_0x208f2d)=>{_0x206acf[_0x208f2d]['quantity']=_0x18cbdd;}),_0x3a1127[_0x2875b8(0x1b3)]((_0x2bf43a,_0x5c988b)=>{_0x206acf[_0x5c988b]['standard_unit']=_0x2bf43a;}),_0x4a020b['forEach']((_0x232bd2,_0x56e21a)=>{_0x206acf[_0x56e21a]['secondary_unit']=_0x232bd2;}),_0x45ed4e['forEach']((_0x1c00b1,_0x8f6403)=>{var _0x241825=_0x2875b8;_0x206acf[_0x8f6403][_0x241825(0xd1)]=_0x1c00b1;}),_0xe7da18[_0x2875b8(0x1b3)]((_0x2a17dd,_0x4d45e8)=>{var _0x449834=_0x2875b8;_0x206acf[_0x4d45e8][_0x449834(0xcf)]=_0x2a17dd;}),_0x27b582[_0x2875b8(0x1b3)]((_0x27a2cb,_0x14d262)=>{var _0x54997c=_0x2875b8;_0x206acf[_0x14d262][_0x54997c(0x1de)]=_0x27a2cb;}),_0xf48526[_0x2875b8(0x1b3)]((_0xac10c2,_0x2fdf6e)=>{var _0x15a658=_0x2875b8;_0x206acf[_0x2fdf6e][_0x15a658(0x1b7)]=_0xac10c2;}),_0x5e169e[_0x2875b8(0x1b3)]((_0x292418,_0x273fd3)=>{_0x206acf[_0x273fd3]['batch_code']=_0x292418;}),_0x4ba6f8[_0x2875b8(0x1b3)]((_0x4ae9c3,_0x5c7206)=>{var _0x173af5=_0x2875b8;_0x206acf[_0x5c7206][_0x173af5(0xbc)]=_0x4ae9c3;});const _0x166f2b=_0x206acf[_0x2875b8(0x18a)](_0x29ec6d=>_0x29ec6d[_0x2875b8(0x11b)]!=='0'&&_0x29ec6d['quantity']!=='');_0x4c25c3[_0x2875b8(0xb6)]=_0x5f6663,_0x4c25c3[_0x2875b8(0xea)]=_0x589935,_0x4c25c3['date']=_0x5857da,_0x4c25c3[_0x2875b8(0x1b9)]=_0x157425,_0x4c25c3[_0x2875b8(0x1c6)]=_0x166f2b,_0x4c25c3[_0x2875b8(0xe2)]=_0x2259ff,_0x4c25c3[_0x2875b8(0xb4)]=_0x5bf8b3,_0x4c25c3[_0x2875b8(0x9f)]=_0x1865d6,_0x4c25c3[_0x2875b8(0x13f)]=_0x3f192f,_0x4c25c3[_0x2875b8(0x157)]=_0x3010c8,_0x4c25c3[_0x2875b8(0xf8)]=_0x12ac71;const _0x101bf8=await _0x4c25c3[_0x2875b8(0xfe)](),_0x1f6004=await warehouse[_0x2875b8(0x1d6)]({'name':_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0x1b9)],'room':_0x46b272['body'][_0x2875b8(0x10d)]});_0x4c25c3[_0x2875b8(0x1c6)][_0x2875b8(0x1b3)](_0x1b9ef1=>{var _0x303908=_0x2875b8,_0x1f3dfc=0x0;const _0x4e7537=_0x1f6004[_0x303908(0x180)][_0x303908(0x187)](_0x238069=>{var _0x36ecb0=_0x303908;_0x238069[_0x36ecb0(0x199)]==_0x1b9ef1[_0x36ecb0(0x199)]&&_0x238069[_0x36ecb0(0xd1)]==_0x1b9ef1[_0x36ecb0(0xd1)]&&(_0x238069[_0x36ecb0(0x164)]=parseInt(_0x238069[_0x36ecb0(0x164)])+parseInt(_0x1b9ef1[_0x36ecb0(0x11b)]),_0x1f3dfc++);});_0x1f3dfc=='0'&&(_0x1f6004[_0x303908(0x180)]=_0x1f6004['product_details']['concat']({'product_name':_0x1b9ef1[_0x303908(0x199)],'product_stock':_0x1b9ef1[_0x303908(0x11b)],'primary_code':_0x1b9ef1[_0x303908(0xcf)],'secondary_code':_0x1b9ef1[_0x303908(0x1de)],'product_code':_0x1b9ef1[_0x303908(0xdc)],'bay':_0x1b9ef1[_0x303908(0xd1)],'maxProducts':_0x1b9ef1[_0x303908(0x1b7)],'unit':_0x1b9ef1[_0x303908(0xc5)],'secondary_unit':_0x1b9ef1[_0x303908(0x132)],'expiry_date':_0x1b9ef1[_0x303908(0xbc)]}));}),await _0x1f6004[_0x2875b8(0xfe)]();const _0x11a57e=await s_payment_data[_0x2875b8(0x1d6)]({'invoice':_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xb6)]});if(_0x11a57e===null){}else console['log']('suppliers',_0x11a57e,_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xb6)]),_0x11a57e[_0x2875b8(0xea)]=_0x46b272[_0x2875b8(0x10a)][_0x2875b8(0xea)],await _0x11a57e[_0x2875b8(0xfe)]();_0x46b272[_0x2875b8(0x1a4)](_0x2875b8(0x184),_0x2875b8(0x115)),_0x237ee5[_0x2875b8(0x1b6)]('/all_purchases_finished/view');}catch(_0x3ddfa2){console[_0x2875b8(0xd2)](_0x3ddfa2);}}),router[a0_0x2edef6(0x1d9)](a0_0x2edef6(0xdf),auth,async(_0x559607,_0x2395bd)=>{var _0x42a5c2=a0_0x2edef6;try{const _0x4f9f91=_0x559607[_0x42a5c2(0x1c5)]['id'],{invoice:_0x10abf7,suppliers:_0x158a9c,payable:_0x4ec74c,due_amount:_0x2b3ccb}=_0x559607[_0x42a5c2(0x10a)],_0x1f61e8=await purchases[_0x42a5c2(0x102)](_0x4f9f91);var _0x17631c=_0x4ec74c-_0x2b3ccb;_0x1f61e8[_0x42a5c2(0xb4)]=parseFloat(_0x1f61e8[_0x42a5c2(0xb4)])+parseFloat(_0x2b3ccb),_0x1f61e8[_0x42a5c2(0x9f)]=_0x17631c;const _0x213ae8=await _0x1f61e8[_0x42a5c2(0xfe)]();console[_0x42a5c2(0xd2)](_0x213ae8);const _0x49ea24=await s_payment_data[_0x42a5c2(0x1d6)]({'invoice':_0x10abf7});_0x49ea24[_0x42a5c2(0x1a7)]=_0x17631c,await _0x49ea24[_0x42a5c2(0xfe)]();let _0x2380a7=new Date(),_0x10814e=('0'+_0x2380a7[_0x42a5c2(0x13b)]())[_0x42a5c2(0x17f)](-0x2),_0x403915=('0'+(_0x2380a7[_0x42a5c2(0x16b)]()+0x1))['slice'](-0x2),_0x28d6dd=_0x2380a7[_0x42a5c2(0x152)](),_0x4163eb=_0x28d6dd+'-'+_0x403915+'-'+_0x10814e;const _0x685be2=new suppliers_payment({'invoice':_0x10abf7,'date':_0x28d6dd+'-'+_0x403915+'-'+_0x10814e,'suppliers':_0x158a9c,'reason':_0x42a5c2(0x16a),'amount':_0x2b3ccb}),_0x467d89=await _0x685be2[_0x42a5c2(0xfe)]();_0x559607['flash']('success',_0x42a5c2(0x1ce)),_0x2395bd['redirect']('/all_purchases/view');}catch(_0x40e0b8){console['log'](_0x40e0b8);}}),router[a0_0x2edef6(0x161)](a0_0x2edef6(0x14b),auth,async(_0x338b86,_0x34f7f3)=>{var _0x4c46e9=a0_0x2edef6;try{const {username:_0x2cd8db,email:_0x50ff07,role:_0x4a521f}=_0x338b86[_0x4c46e9(0xc8)],_0x3e359c=_0x338b86['user'],_0x354d71=await profile[_0x4c46e9(0x1d6)]({'email':_0x3e359c[_0x4c46e9(0x165)]}),_0x1fa9ef=await master_shop[_0x4c46e9(0xd6)]();console[_0x4c46e9(0xd2)](_0x4c46e9(0xe0),_0x1fa9ef);const _0x5697f7=_0x338b86[_0x4c46e9(0x1c5)]['id'],_0x3b60ee=await purchases[_0x4c46e9(0x102)](_0x5697f7);console[_0x4c46e9(0xd2)](_0x3b60ee);const _0x3e5a65=await suppliers[_0x4c46e9(0x1d6)]({'name':_0x3b60ee[_0x4c46e9(0xea)]});console[_0x4c46e9(0xd2)](_0x3e5a65);if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0xb7)){var _0xee6a3d=users[_0x4c46e9(0x15b)];console[_0x4c46e9(0xd2)](_0xee6a3d);}else{if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0xb8))var _0xee6a3d=users[_0x4c46e9(0xb8)];else{if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0x9d))var _0xee6a3d=users['German'];else{if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0x100))var _0xee6a3d=users[_0x4c46e9(0x100)];else{if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0xa6))var _0xee6a3d=users[_0x4c46e9(0xa6)];else{if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0x143))var _0xee6a3d=users[_0x4c46e9(0x174)];else{if(_0x1fa9ef[0x0][_0x4c46e9(0xc7)]==_0x4c46e9(0xf4))var _0xee6a3d=users['Chinese'];else{if(_0x1fa9ef[0x0]['language']=='Arabic\x20(ae)')var _0xee6a3d=users[_0x4c46e9(0x1b5)];}}}}}}}_0x34f7f3['render'](_0x4c46e9(0x1ab),{'success':_0x338b86[_0x4c46e9(0x1a4)](_0x4c46e9(0x184)),'errors':_0x338b86[_0x4c46e9(0x1a4)]('errors'),'role':_0x3e359c,'profile':_0x354d71,'master_shop':_0x1fa9ef,'supplier':_0x3e5a65,'purchase':_0x3b60ee,'language':_0xee6a3d});}catch(_0x31fd84){console[_0x4c46e9(0xd2)](_0x31fd84);}}),router[a0_0x2edef6(0x161)]('/view/return_purchase/:id',auth,async(_0x173003,_0xee696)=>{var _0x2122ba=a0_0x2edef6;try{const {username:_0x33b45a,email:_0x2f24b9,role:_0x362c0d}=_0x173003[_0x2122ba(0xc8)],_0x1264d4=_0x173003[_0x2122ba(0xc8)],_0x10552d=await profile[_0x2122ba(0x1d6)]({'email':_0x1264d4[_0x2122ba(0x165)]}),_0x2a8548=await master_shop[_0x2122ba(0xd6)]();console['log'](_0x2122ba(0xe0),_0x2a8548);const _0xf5465a=_0x173003[_0x2122ba(0x1c5)]['id'];console[_0x2122ba(0xd2)](_0xf5465a);const _0x3092ad=await purchases_finished[_0x2122ba(0x102)](_0xf5465a);console[_0x2122ba(0xd2)](_0x2122ba(0x12e),_0x3092ad);const _0x28f298=await product['find']({}),_0x3828af=await warehouse[_0x2122ba(0x122)]([{'$match':{'name':_0x3092ad[_0x2122ba(0x1b9)],'room':_0x3092ad[_0x2122ba(0x13f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2122ba(0x178),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2122ba(0x1e2)},'bay':{'$first':_0x2122ba(0x131)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2122ba(0x137)},'primary_code':{'$first':_0x2122ba(0x1a5)},'secondary_code':{'$first':_0x2122ba(0x146)},'product_code':{'$first':_0x2122ba(0x179)},'storage':{'$first':_0x2122ba(0xb9)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x2122ba(0xd2)](_0x2122ba(0xd5),_0x3828af);let _0x298af3;if(_0x1264d4[_0x2122ba(0xad)]==_0x2122ba(0x149)){const _0x86c9b3=await staff[_0x2122ba(0x1d6)]({'email':_0x1264d4[_0x2122ba(0x165)]});_0x298af3=await warehouse[_0x2122ba(0xd6)]({'status':'Enabled','name':_0x86c9b3[_0x2122ba(0x99)],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x298af3=await warehouse[_0x2122ba(0x122)]([{'$match':{'status':_0x2122ba(0x1dc),'warehouse_category':_0x2122ba(0x118),'name':'Return\x20Goods'}},{'$group':{'_id':_0x2122ba(0x12c),'name':{'$first':_0x2122ba(0x12c)}}}]);if(_0x2a8548[0x0]['language']==_0x2122ba(0xb7)){var _0x3d4fa9=users['English'];console[_0x2122ba(0xd2)](_0x3d4fa9);}else{if(_0x2a8548[0x0][_0x2122ba(0xc7)]==_0x2122ba(0xb8))var _0x3d4fa9=users[_0x2122ba(0xb8)];else{if(_0x2a8548[0x0][_0x2122ba(0xc7)]=='German')var _0x3d4fa9=users['German'];else{if(_0x2a8548[0x0]['language']==_0x2122ba(0x100))var _0x3d4fa9=users[_0x2122ba(0x100)];else{if(_0x2a8548[0x0][_0x2122ba(0xc7)]==_0x2122ba(0xa6))var _0x3d4fa9=users[_0x2122ba(0xa6)];else{if(_0x2a8548[0x0]['language']==_0x2122ba(0x143))var _0x3d4fa9=users['Portuguese'];else{if(_0x2a8548[0x0][_0x2122ba(0xc7)]==_0x2122ba(0xf4))var _0x3d4fa9=users[_0x2122ba(0xf4)];else{if(_0x2a8548[0x0]['language']==_0x2122ba(0x19a))var _0x3d4fa9=users[_0x2122ba(0x1b5)];}}}}}}}_0xee696['render'](_0x2122ba(0xc3),{'success':_0x173003[_0x2122ba(0x1a4)](_0x2122ba(0x184)),'errors':_0x173003[_0x2122ba(0x1a4)](_0x2122ba(0xfa)),'role':_0x1264d4,'profile':_0x10552d,'user':_0x3092ad,'stock':_0x3828af,'master_shop':_0x2a8548,'product':_0x28f298,'language':_0x3d4fa9,'warehouse':_0x298af3});}catch(_0x1fa562){console[_0x2122ba(0xd2)](_0x1fa562);}}),router[a0_0x2edef6(0x1d9)]('/view/return_purchase/:id',auth,async(_0x15cb8a,_0x5a8590)=>{var _0x42f2d3=a0_0x2edef6;try{const {invoice:_0x2163d8,date:_0x574fa9,warehouse_name:_0x4cb5f7,Room_name:_0x38f425,product_name:_0x16dcc5,purchase_quantity:_0x2ed1bb,stocks:_0x126ee9,return_qty:_0x310887,note:_0x5cf03c,level:_0x3be752,isle:_0x3174dd,pallet:_0x1d43c1,to_warehouse_name:_0x29c290,to_Room_name:_0x472bfe}=_0x15cb8a[_0x42f2d3(0x10a)],_0x27219e=await purchases_finished[_0x42f2d3(0x1d6)]({'_id':_0x15cb8a[_0x42f2d3(0x1c5)]['id']}),_0x2bd4be=await warehouse[_0x42f2d3(0x1d6)]({'name':_0x4cb5f7,'room':_0x38f425,'warehouse_category':_0x42f2d3(0x118)});if(typeof _0x16dcc5=='string')var _0x2f3311=[_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x199)]],_0x360129=[_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x10f)]],_0x15c9d8=[_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x1b4)]],_0x31a752=[_0x15cb8a['body'][_0x42f2d3(0x111)]],_0x59d11f=[_0x15cb8a[_0x42f2d3(0x10a)]['level']],_0x257822=[_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0xdb)]],_0x424c14=[_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0xca)]],_0x59c2f4=[_0x15cb8a[_0x42f2d3(0x10a)]['secondary_code_hide']];else var _0x2f3311=[..._0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x199)]],_0x360129=[..._0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x10f)]],_0x15c9d8=[..._0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x1b4)]],_0x31a752=[..._0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x111)]],_0x59d11f=[..._0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0x1bc)]],_0x257822=[..._0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0xdb)]],_0x424c14=[..._0x15cb8a[_0x42f2d3(0x10a)]['primary_code_hide']],_0x59c2f4=[..._0x15cb8a['body'][_0x42f2d3(0x112)]];const _0x3450ec=_0x2f3311[_0x42f2d3(0x187)](_0x5dd1c4=>{return _0x5dd1c4={'product_name':_0x5dd1c4};});_0x360129['forEach']((_0x366217,_0x26c66e)=>{var _0x196610=_0x42f2d3;_0x3450ec[_0x26c66e][_0x196610(0x10f)]=_0x366217;}),_0x15c9d8[_0x42f2d3(0x1b3)]((_0x410f85,_0x2bac57)=>{var _0x3c7420=_0x42f2d3;_0x3450ec[_0x2bac57][_0x3c7420(0x98)]=_0x410f85;}),_0x31a752[_0x42f2d3(0x1b3)]((_0x2bef9d,_0x1a38dd)=>{var _0x16e58b=_0x42f2d3;_0x3450ec[_0x1a38dd][_0x16e58b(0x111)]=_0x2bef9d;}),_0x59d11f[_0x42f2d3(0x1b3)]((_0x22862a,_0x1cd298)=>{var _0x44a1ff=_0x42f2d3;_0x3450ec[_0x1cd298][_0x44a1ff(0xd1)]=_0x22862a;}),_0x257822[_0x42f2d3(0x1b3)]((_0x37893e,_0x46ed15)=>{var _0xb65aa9=_0x42f2d3;_0x3450ec[_0x46ed15][_0xb65aa9(0xdc)]=_0x37893e;}),_0x424c14['forEach']((_0x39ee2f,_0x205679)=>{var _0x3ce74a=_0x42f2d3;_0x3450ec[_0x205679][_0x3ce74a(0xcf)]=_0x39ee2f;}),_0x59c2f4[_0x42f2d3(0x1b3)]((_0x3b926f,_0x688150)=>{var _0x3830fc=_0x42f2d3;_0x3450ec[_0x688150][_0x3830fc(0x1de)]=_0x3b926f;}),_0x3450ec[_0x42f2d3(0x1b3)](_0x462fcd=>{var _0x46f179=_0x42f2d3;console[_0x46f179(0xd2)](_0x462fcd);const _0x195c23=_0x2bd4be['product_details']['map'](_0x4e2a33=>{var _0x5eb143=_0x46f179;_0x4e2a33[_0x5eb143(0x199)]==_0x462fcd[_0x5eb143(0x199)]&&_0x4e2a33[_0x5eb143(0xd1)]==_0x462fcd[_0x5eb143(0xd1)]&&(console[_0x5eb143(0xd2)](parseInt(_0x4e2a33['product_stock'])+_0x5eb143(0x1c1)+parseInt(_0x462fcd[_0x5eb143(0x111)])),_0x4e2a33[_0x5eb143(0x164)]=parseInt(_0x4e2a33[_0x5eb143(0x164)])-parseInt(_0x462fcd[_0x5eb143(0x111)]));});}),await _0x2bd4be[_0x42f2d3(0xfe)]();var _0x2a4866=0x0;_0x3450ec['forEach'](_0x19d1a3=>{var _0x40866c=_0x42f2d3;(parseInt(_0x19d1a3[_0x40866c(0x10f)])<parseInt(_0x19d1a3[_0x40866c(0x111)])||parseInt(_0x19d1a3[_0x40866c(0x98)])<parseInt(_0x19d1a3[_0x40866c(0x111)]))&&_0x2a4866++;});if(_0x2a4866!=0x0)return _0x15cb8a[_0x42f2d3(0x1a4)](_0x42f2d3(0xfa),_0x42f2d3(0x109)),_0x5a8590['redirect']('back');const _0x4ffd47=new purchases_return_finished({'invoice':_0x2163d8,'suppliers':_0x15cb8a['body'][_0x42f2d3(0xea)],'date':_0x574fa9,'warehouse_name':_0x4cb5f7,'return_product':_0x3450ec,'note':_0x5cf03c,'room':_0x38f425,'to_warehouse_name':_0x29c290,'to_room':_0x472bfe}),_0x136b6c=await _0x4ffd47[_0x42f2d3(0xfe)](),_0x2160fc=await purchases_return_finished['findOne']({'invoice':_0x2163d8}),_0xb3492b=await warehouse['findOne']({'name':_0x29c290,'room':_0x472bfe,'warehouse_category':_0x42f2d3(0x118)});_0x2160fc['return_product']['forEach'](_0x5eea58=>{var _0x4a0c82=_0x42f2d3,_0x17ad49=0x0;const _0x134570=_0xb3492b[_0x4a0c82(0x180)]['map'](_0x4e481d=>{var _0x4c00dd=_0x4a0c82;console[_0x4c00dd(0xd2)](_0x4e481d['product_name']+'=='+_0x5eea58[_0x4c00dd(0x199)]+'&&'+_0x4e481d['bay']+'=='+_0x5eea58['bay']),_0x4e481d[_0x4c00dd(0x199)]==_0x5eea58[_0x4c00dd(0x199)]&&_0x4e481d[_0x4c00dd(0xd1)]==_0x5eea58[_0x4c00dd(0xd1)]&&(_0x4e481d[_0x4c00dd(0x164)]=parseInt(_0x4e481d[_0x4c00dd(0x164)])-parseInt(_0x5eea58[_0x4c00dd(0x111)]),_0x17ad49++);});_0x17ad49=='0'&&(_0xb3492b['product_details']=_0xb3492b[_0x4a0c82(0x180)]['concat']({'product_name':_0x5eea58['product_name'],'product_stock':_0x5eea58[_0x4a0c82(0x111)],'primary_code':_0x5eea58['primary_code'],'secondary_code':_0x5eea58[_0x4a0c82(0x1de)],'product_code':_0x5eea58[_0x4a0c82(0xdc)],'bay':_0x5eea58['bay'],'maxProducts':0xf423f}));}),await _0xb3492b['save']();const _0x135e6c=await purchases_finished[_0x42f2d3(0x1d6)]({'invoice':_0x2163d8});_0x135e6c[_0x42f2d3(0x11d)]=_0x42f2d3(0x15d);const _0x36f7f7=await _0x135e6c[_0x42f2d3(0xfe)](),_0x547ded=new s_payment_data({'invoice':_0x2163d8,'suppliers':_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0xea)],'reason':_0x42f2d3(0x12b)});await _0x547ded[_0x42f2d3(0xfe)]();const _0x1a94b0=await master_shop[_0x42f2d3(0xd6)](),_0x3ec4c6=await email_settings[_0x42f2d3(0x1d6)](),_0x4e2e74=await suppliers[_0x42f2d3(0x1d6)]({'name':_0x15cb8a[_0x42f2d3(0x10a)][_0x42f2d3(0xea)]});_0x1a94b0[0x0]['currency_placement']==0x1?(right_currency=_0x1a94b0[0x0][_0x42f2d3(0x11e)],left_currency=''):(right_currency='',left_currency=_0x1a94b0[0x0]['currency']);var _0x1e2d36=_0x2f3311,_0x352181=_0x31a752,_0x31b3ed='',_0x293660;for(_0x293660 in _0x1e2d36){_0x31b3ed+=_0x42f2d3(0xa4)+_0x42f2d3(0x145)+_0x1e2d36[_0x293660]+_0x42f2d3(0x163)+_0x42f2d3(0x145)+_0x352181[_0x293660]+_0x42f2d3(0x163)+_0x42f2d3(0xd0);}let _0x3d9b30=nodemailer[_0x42f2d3(0x150)]({'service':_0x42f2d3(0x9c),'auth':{'user':_0x3ec4c6['email'],'pass':_0x3ec4c6[_0x42f2d3(0x1c2)]}}),_0x1dd02e={'from':_0x3ec4c6[_0x42f2d3(0x165)],'to':_0x4e2e74[_0x42f2d3(0x165)],'subject':_0x42f2d3(0xf5),'attachments':[{'filename':_0x42f2d3(0x158),'path':__dirname+_0x42f2d3(0x188)+'/upload/'+_0x1a94b0[0x0][_0x42f2d3(0x1a0)],'cid':_0x42f2d3(0x128)}],'html':_0x42f2d3(0xf9)+_0x42f2d3(0x1db)+_0x42f2d3(0xf0)+_0x42f2d3(0x1d5)+_0x42f2d3(0xcb)+_0x42f2d3(0x1d5)+_0x42f2d3(0xc4)+_0x42f2d3(0xda)+'<div>'+'<h2>\x20'+_0x1a94b0[0x0][_0x42f2d3(0x162)]+_0x42f2d3(0xf2)+_0x42f2d3(0xda)+_0x42f2d3(0xda)+_0x42f2d3(0x186)+'<div>'+_0x42f2d3(0x123)+'\x20Order\x20Number\x20:\x20'+_0x2163d8+'\x20'+_0x42f2d3(0x135)+'\x20Order\x20Date\x20:\x20'+_0x574fa9+'\x20'+_0x42f2d3(0xfb)+_0x42f2d3(0x15e)+_0x42f2d3(0xda)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x42f2d3(0x1d4)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x42f2d3(0x144)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x42f2d3(0xec)+_0x42f2d3(0xd0)+'</thead>'+_0x42f2d3(0x1ba)+'\x20'+_0x31b3ed+'\x20'+_0x42f2d3(0x1d1)+_0x42f2d3(0x156)+'<div>'+_0x42f2d3(0xfc)+_0x42f2d3(0x117)+_0x1a94b0[0x0][_0x42f2d3(0x162)]+'</h5>'+_0x42f2d3(0xda)+'</div>'+_0x42f2d3(0x10e)};_0x3d9b30[_0x42f2d3(0xa1)](_0x1dd02e,function(_0x2a801d,_0x526929){var _0x289f88=_0x42f2d3;_0x2a801d?console[_0x289f88(0xd2)](_0x289f88(0x1cd)):console['log'](_0x289f88(0x139));}),_0x15cb8a[_0x42f2d3(0x1a4)]('success',_0x42f2d3(0x18b)),_0x5a8590['redirect'](_0x42f2d3(0x13d));}catch(_0x129cee){_0x5a8590[_0x42f2d3(0x193)](0xc8)[_0x42f2d3(0x1a6)]({'message':_0x129cee['message']});}}),router[a0_0x2edef6(0x161)](a0_0x2edef6(0x1d8),auth,async(_0x23b2c5,_0x5a613d)=>{var _0x4d3990=a0_0x2edef6;try{const {username:_0xcecb84,email:_0x13a8c0,role:_0x356314}=_0x23b2c5[_0x4d3990(0xc8)],_0x3d29d9=_0x23b2c5[_0x4d3990(0xc8)],_0x2d1bc9=await profile[_0x4d3990(0x1d6)]({'email':_0x3d29d9[_0x4d3990(0x165)]}),_0xb60a4a=await master_shop[_0x4d3990(0xd6)](),_0x91b7bf=_0x23b2c5['params']['id'],_0x5ab914=await purchases_finished['findById'](_0x91b7bf);if(_0xb60a4a[0x0][_0x4d3990(0xc7)]==_0x4d3990(0xb7))var _0x42e141=users[_0x4d3990(0x15b)];else{if(_0xb60a4a[0x0][_0x4d3990(0xc7)]==_0x4d3990(0xb8))var _0x42e141=users['Hindi'];else{if(_0xb60a4a[0x0][_0x4d3990(0xc7)]==_0x4d3990(0x9d))var _0x42e141=users[_0x4d3990(0x9d)];else{if(_0xb60a4a[0x0][_0x4d3990(0xc7)]==_0x4d3990(0x100))var _0x42e141=users[_0x4d3990(0x100)];else{if(_0xb60a4a[0x0][_0x4d3990(0xc7)]=='French')var _0x42e141=users[_0x4d3990(0xa6)];else{if(_0xb60a4a[0x0][_0x4d3990(0xc7)]=='Portuguese\x20(BR)')var _0x42e141=users['Portuguese'];else{if(_0xb60a4a[0x0][_0x4d3990(0xc7)]==_0x4d3990(0xf4))var _0x42e141=users[_0x4d3990(0xf4)];else{if(_0xb60a4a[0x0]['language']==_0x4d3990(0x19a))var _0x42e141=users[_0x4d3990(0x1b5)];}}}}}}}_0x5a613d[_0x4d3990(0xd9)](_0x4d3990(0x1d2),{'success':_0x23b2c5[_0x4d3990(0x1a4)]('success'),'errors':_0x23b2c5['flash'](_0x4d3990(0xfa)),'role':_0x3d29d9,'profile':_0x2d1bc9,'alldata':_0x5ab914,'master_shop':_0xb60a4a,'language':_0x42e141}),console[_0x4d3990(0xd2)](alldata);}catch(_0x14f9d4){console['log'](_0x14f9d4);}}),router[a0_0x2edef6(0x1d9)](a0_0x2edef6(0xbe),async(_0x5b6f8c,_0x23bbe6)=>{var _0x16fd8e=a0_0x2edef6;const {product_code:_0x337b9b}=_0x5b6f8c[_0x16fd8e(0x10a)];var _0x1347a6;const _0x11f318=await product[_0x16fd8e(0x122)]([{'$match':{'primary_code':_0x337b9b}},{'$group':{'_id':_0x16fd8e(0x1b1),'name':{'$first':_0x16fd8e(0x12c)},'category':{'$first':_0x16fd8e(0xac)},'brand':{'$first':'$brand'},'unit':{'$first':_0x16fd8e(0x9a)},'alertquantity':{'$first':_0x16fd8e(0xe5)},'product_code':{'$first':_0x16fd8e(0xbd)},'primary_code':{'$first':_0x16fd8e(0x196)},'secondary_code':{'$first':_0x16fd8e(0x195)},'maxStocks':{'$first':_0x16fd8e(0x16e)},'maxProdPerUnit':{'$first':_0x16fd8e(0x10c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x16fd8e(0xee)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x16fd8e(0x1a9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x9cd0f=await product[_0x16fd8e(0x122)]([{'$match':{'secondary_code':_0x337b9b}},{'$group':{'_id':_0x16fd8e(0x1b1),'name':{'$first':_0x16fd8e(0x12c)},'category':{'$first':'$category'},'brand':{'$first':_0x16fd8e(0x1df)},'unit':{'$first':_0x16fd8e(0x9a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x16fd8e(0xbd)},'primary_code':{'$first':_0x16fd8e(0x196)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x16fd8e(0x16e)},'maxProdPerUnit':{'$first':_0x16fd8e(0x10c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x16fd8e(0xee)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x16fd8e(0x1a9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x11f318[_0x16fd8e(0x1b8)]>0x0)_0x1347a6=_0x11f318;else _0x9cd0f[_0x16fd8e(0x1b8)]>0x0&&(_0x1347a6=_0x9cd0f);_0x23bbe6[_0x16fd8e(0x1a6)](_0x1347a6);}),router[a0_0x2edef6(0x1d9)]('/CheckingWarehouse',async(_0x28eafa,_0x8e1b3e)=>{var _0xd64404=a0_0x2edef6;const {productCode:_0x1e843b,bay:_0xd39f40,warehouses:_0x18290a,room:_0x1ffc5}=_0x28eafa[_0xd64404(0x10a)];console[_0xd64404(0xd2)](_0x28eafa[_0xd64404(0x10a)]);try{const _0x2f79e4=await warehouse[_0xd64404(0x122)]([{'$match':{'name':_0x18290a,'room':_0x1ffc5}},{'$unwind':_0xd64404(0xdd)},{'$match':{'product_details.bay':parseInt(_0xd39f40)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xd64404(0x1e2)},'bay':{'$first':_0xd64404(0x131)},'maxProducts':{'$first':_0xd64404(0x1ac)}}}]);_0x8e1b3e[_0xd64404(0x193)](0xc8)[_0xd64404(0x1a6)](_0x2f79e4);}catch(_0x19abd9){_0x8e1b3e['status'](0x194)['json']({'message':_0x19abd9[_0xd64404(0x103)]});}}),router['post']('/barcode_scanner_logs',async(_0x499b01,_0x325141)=>{var _0x2f2de4=a0_0x2edef6;const {product_code:_0x4e120a}=_0x499b01[_0x2f2de4(0x10a)];var _0x566cb6;const _0x4aaf99=await product[_0x2f2de4(0x122)]([{'$match':{'primary_code':_0x4e120a,'type_products':'log'}},{'$group':{'_id':_0x2f2de4(0x1b1),'name':{'$first':_0x2f2de4(0x12c)},'category':{'$first':_0x2f2de4(0xac)},'brand':{'$first':_0x2f2de4(0x1df)},'unit':{'$first':_0x2f2de4(0x9a)},'alertquantity':{'$first':_0x2f2de4(0xe5)},'product_code':{'$first':_0x2f2de4(0xbd)},'primary_code':{'$first':_0x2f2de4(0x196)},'secondary_code':{'$first':_0x2f2de4(0x195)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2f2de4(0x10c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x2f2de4(0x190)},'sales_category':{'$first':'$sales_category'},'type_products':{'$first':'$type_products'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);console[_0x2f2de4(0xd2)](_0x4aaf99);const _0x662ec8=await product[_0x2f2de4(0x122)]([{'$match':{'secondary_code':_0x4e120a,'type_products':_0x2f2de4(0xd2)}},{'$group':{'_id':'$_id','name':{'$first':_0x2f2de4(0x12c)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x2f2de4(0x9a)},'alertquantity':{'$first':_0x2f2de4(0xe5)},'product_code':{'$first':_0x2f2de4(0xbd)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2f2de4(0x195)},'maxStocks':{'$first':_0x2f2de4(0x16e)},'maxProdPerUnit':{'$first':_0x2f2de4(0x10c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x2f2de4(0x190)},'sales_category':{'$first':_0x2f2de4(0x1a9)},'type_products':{'$first':_0x2f2de4(0xce)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1,'type_products':0x1}}]);if(_0x4aaf99[_0x2f2de4(0x1b8)]>0x0)_0x566cb6=_0x4aaf99;else _0x662ec8['length']>0x0&&(_0x566cb6=_0x662ec8);_0x325141['json'](_0x566cb6);}),module['exports']=router;