const a0_0x2358fb=a0_0x297e;(function(_0xff0a30,_0x542141){const _0x5d2fb5=a0_0x297e,_0x485433=_0xff0a30();while(!![]){try{const _0x430766=-parseInt(_0x5d2fb5(0x1e8))/0x1+-parseInt(_0x5d2fb5(0x1e2))/0x2*(parseInt(_0x5d2fb5(0x20e))/0x3)+-parseInt(_0x5d2fb5(0x1f4))/0x4*(-parseInt(_0x5d2fb5(0x1fe))/0x5)+parseInt(_0x5d2fb5(0x1ff))/0x6+parseInt(_0x5d2fb5(0x211))/0x7*(-parseInt(_0x5d2fb5(0x1da))/0x8)+-parseInt(_0x5d2fb5(0x1de))/0x9+parseInt(_0x5d2fb5(0x1d7))/0xa;if(_0x430766===_0x542141)break;else _0x485433['push'](_0x485433['shift']());}catch(_0xb375c8){_0x485433['push'](_0x485433['shift']());}}}(a0_0x5b09,0x7a6ff));const express=require(a0_0x2358fb(0x1d5)),app=express(),router=express[a0_0x2358fb(0x209)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x2358fb(0x1f7));function a0_0x297e(_0x461fc4,_0x5b7bfb){const _0x5b0944=a0_0x5b09();return a0_0x297e=function(_0x297ed3,_0x1a886c){_0x297ed3=_0x297ed3-0x1d3;let _0x1fe420=_0x5b0944[_0x297ed3];return _0x1fe420;},a0_0x297e(_0x461fc4,_0x5b7bfb);}function a0_0x5b09(){const _0x4c236a=['$sale_product.product_name','3064032ZLDCGq','$$invoice','push','monitor','652nPuTag','$product_details.product_code','render','INCF-52068316','table\x20page','aggregate','117402AKRGjt','all','data_sales','$product.id_transaction_from','$product_details.product_stock','$product_details','_id','flash','$product','$product.id_transaction_id','/negative','$product.product_code','216XYAeBK','map','warehouse_data','../../models/all_models','log','length','$product.product_name','$sale_product.room_name','$product_details._id','14800005047429','39085YtkseR','1372704jiWxtR','$product.room_names','/warehouse_monitor','invoice','$product.invoice','valueOf','json','$product.to_quantity','$product.new_adjust_qty','data_transfer','Router','warehouses','success','$product._id','$room','2364RtaunS','message','$product.to_room_name','222103PAFoRk','$product_details.product_name','get','$to_warehouse','status','$sale_product','express','data_adjustment','11681900lwAWnQ','$name','errors','152fGTTbK','$invoice','/checking'];a0_0x5b09=function(){return _0x4c236a;};return a0_0x5b09();}router[a0_0x2358fb(0x213)](a0_0x2358fb(0x1f2),async(_0x4e31e3,_0x47857b)=>{const _0x25163d=a0_0x2358fb;try{const _0x284e60=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x47857b['json']({'status':_0x284e60['modifiedCount']+'\x20documents\x20updated'});}catch(_0x38009f){console[_0x25163d(0x1f8)](_0x25163d(0x1e6),_0x38009f),_0x47857b['status'](0xc8)['json']({'message':_0x38009f[_0x25163d(0x20f)]});}}),router['get'](a0_0x2358fb(0x1dc),async(_0x49305b,_0x59088f)=>{const _0x2a2b6a=a0_0x2358fb;try{const _0x5bd575=await warehouse[_0x2a2b6a(0x1e7)]([{'$unwind':_0x2a2b6a(0x1ed)},{'$match':{'product_details.invoice':_0x2a2b6a(0x1e5),'product_details.primary_code':_0x2a2b6a(0x1fd)}},{'$group':{'_id':{'name':_0x2a2b6a(0x1d8),'room':_0x2a2b6a(0x20d)},'products':{'$push':_0x2a2b6a(0x1ed)}}}]);_0x59088f[_0x2a2b6a(0x205)](_0x5bd575);}catch(_0x826be0){console[_0x2a2b6a(0x1f8)](_0x2a2b6a(0x1e6),_0x826be0),_0x59088f[_0x2a2b6a(0x1d3)](0xc8)[_0x2a2b6a(0x205)]({'message':_0x826be0['message']});}}),router[a0_0x2358fb(0x213)](a0_0x2358fb(0x201),async(_0x389692,_0x48d2d6)=>{const _0x4cd6c0=a0_0x2358fb;_0x48d2d6[_0x4cd6c0(0x1e4)](_0x4cd6c0(0x1e1),{'success':_0x389692[_0x4cd6c0(0x1ef)](_0x4cd6c0(0x20b)),'errors':_0x389692[_0x4cd6c0(0x1ef)](_0x4cd6c0(0x1d9))});}),router[a0_0x2358fb(0x213)]('/join',async(_0x7f45be,_0x3c3a64)=>{const _0x427cfb=a0_0x2358fb;var _0x1a3c9c=await purchases[_0x427cfb(0x1e7)]([{'$lookup':{'from':_0x427cfb(0x20a),'let':{'invoice':_0x427cfb(0x1db)},'pipeline':[{'$unwind':_0x427cfb(0x1ed)},{'$match':{'$expr':{'$eq':[_0x427cfb(0x1df),'$product_details.invoice']}}},{'$project':{'_id':_0x427cfb(0x1fc),'product_name':_0x427cfb(0x212),'product_code':_0x427cfb(0x1e3),'quantity_available':_0x427cfb(0x1ec),'warehouse_name':_0x427cfb(0x1d8),'warehouse_room':_0x427cfb(0x20d),'invoice':'$product_details.invoice'}}],'as':_0x427cfb(0x1f6)}}]);_0x1a3c9c[_0x427cfb(0x1ea)]={},await Promise[_0x427cfb(0x1e9)](_0x1a3c9c[_0x427cfb(0x1f5)](async _0x199904=>{const _0x316da9=_0x427cfb;_0x1a3c9c['data_sales'][_0x199904[_0x316da9(0x202)]]=[],await Promise[_0x316da9(0x1e9)](_0x199904[_0x316da9(0x1f6)]['map'](async _0x67990f=>{const _0xaa73ac=_0x316da9,_0x233bf5=await sales[_0xaa73ac(0x1e7)]([{'$unwind':_0xaa73ac(0x1d4)},{'$match':{'sale_product.id_transaction_from':_0x67990f[_0xaa73ac(0x1ee)]['valueOf'](),'sale_product.invoice':_0x67990f[_0xaa73ac(0x202)]}},{'$project':{'_id':'$sale_product._id','product_name':_0xaa73ac(0x1dd),'product_code':'$sale_product.product_code','quantity_available':'$sale_product.quantity','warehouse_name':'$warehouse_name','warehouse_room':_0xaa73ac(0x1fb),'product_invoice':'$sale_product.invoice','invoice':_0xaa73ac(0x1db),'id_transaction_from':'$sale_product.id_transaction_from'}}]);_0x233bf5['length']>0x0&&_0x1a3c9c['data_sales'][_0x199904['invoice']][_0xaa73ac(0x1e0)](..._0x233bf5);}));})),_0x1a3c9c[_0x427cfb(0x1ea)]=_0x1a3c9c[_0x427cfb(0x1ea)],_0x1a3c9c[_0x427cfb(0x1d6)]={},await Promise['all'](_0x1a3c9c[_0x427cfb(0x1f5)](async _0x46cad3=>{const _0x243c12=_0x427cfb;_0x1a3c9c[_0x243c12(0x1d6)][_0x46cad3['invoice']]=[],await Promise[_0x243c12(0x1e9)](_0x46cad3[_0x243c12(0x1f6)][_0x243c12(0x1f5)](async _0x136962=>{const _0x473448=_0x243c12,_0x1dbedb=await adjustment['aggregate']([{'$unwind':_0x473448(0x1f0)},{'$match':{'product.id_transaction_from':_0x136962[_0x473448(0x1ee)][_0x473448(0x204)](),'product.invoice':_0x136962['invoice']}},{'$project':{'_id':'$product._id','product_name':_0x473448(0x1fa),'product_code':_0x473448(0x1f3),'quantity_available':_0x473448(0x207),'warehouse_name':'$warehouse_name','warehouse_room':_0x473448(0x200),'product_invoice':_0x473448(0x203),'invoice':_0x473448(0x1db),'id_transaction_from':_0x473448(0x1eb)}}]);_0x1dbedb[_0x473448(0x1f9)]>0x0&&_0x1a3c9c[_0x473448(0x1d6)][_0x46cad3['invoice']][_0x473448(0x1e0)](..._0x1dbedb);}));})),_0x1a3c9c['data_transfer']={},await Promise[_0x427cfb(0x1e9)](_0x1a3c9c[_0x427cfb(0x1f5)](async _0xf0d2ef=>{const _0x32dec4=_0x427cfb;_0x1a3c9c[_0x32dec4(0x208)][_0xf0d2ef[_0x32dec4(0x202)]]=[],await Promise[_0x32dec4(0x1e9)](_0xf0d2ef[_0x32dec4(0x1f6)][_0x32dec4(0x1f5)](async _0x580908=>{const _0x2df688=_0x32dec4,_0x295a61=await transfers[_0x2df688(0x1e7)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_id':_0x580908[_0x2df688(0x1ee)][_0x2df688(0x204)](),'product.To_invoice':_0x580908[_0x2df688(0x202)]}},{'$project':{'_id':_0x2df688(0x20c),'product_name':_0x2df688(0x1fa),'product_code':'$product.product_code','quantity_available':_0x2df688(0x206),'warehouse_name':_0x2df688(0x214),'warehouse_room':_0x2df688(0x200),'product_invoice':_0x2df688(0x210),'invoice':_0x2df688(0x1db),'id_transaction_id':_0x2df688(0x1f1)}}]);console['log'](_0x295a61),_0x295a61[_0x2df688(0x1f9)]>0x0&&_0x1a3c9c[_0x2df688(0x208)][_0xf0d2ef[_0x2df688(0x202)]][_0x2df688(0x1e0)](..._0x295a61);}));})),_0x3c3a64['json']({'purchases_warehouse':_0x1a3c9c,'data_sales':_0x1a3c9c['data_sales'],'data_adjustment':_0x1a3c9c[_0x427cfb(0x1d6)],'data_transfer':_0x1a3c9c['data_transfer']});}),module['exports']=router;