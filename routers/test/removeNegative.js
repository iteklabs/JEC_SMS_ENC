const a0_0x597cc5=a0_0x29f0;function a0_0x11e9(){const _0x5cdd25=['$sale_product.quantity','json','modifiedCount','$product.to_room_name','5335WHUYdm','$product.id_transaction_from','$sale_product.room_name','4143136Mugcru','map','$product.new_adjust_qty','$product.invoice','monitor','357Bescnz','14800005047429','$product._id','$room','$product_details.invoice','$product.room_names','$invoice','23093xXmlrv','1632ZCQKQm','invoice','$name','$product_details.product_name','warehouse_data','$sale_product.product_code','475240KwGftv','Router','get','$product_details._id','valueOf','$sale_product._id','$sale_product.invoice','data_adjustment','status','length','warehouses','126fDWfrf','$product.product_code','log','$product_details.product_stock','/negative','3650438yoMHKs','1034748nfMPUA','\x20documents\x20updated','/warehouse_monitor','$sale_product','4404LbegYr','$product.product_name','$$invoice','all','data_transfer','$sale_product.id_transaction_from','aggregate','message','$warehouse_name','$product','data_sales','_id','exports','4336tuvQmU','flash','$sale_product.product_name','$product_details','$product.id_transaction_id','INCF-52068316','$to_warehouse','/join','push'];a0_0x11e9=function(){return _0x5cdd25;};return a0_0x11e9();}(function(_0x138723,_0x226420){const _0x2896ec=a0_0x29f0,_0x1692b6=_0x138723();while(!![]){try{const _0x5bb6d8=parseInt(_0x2896ec(0x20d))/0x1+-parseInt(_0x2896ec(0x211))/0x2*(-parseInt(_0x2896ec(0x1ee))/0x3)+-parseInt(_0x2896ec(0x21e))/0x4*(parseInt(_0x2896ec(0x1e6))/0x5)+-parseInt(_0x2896ec(0x1f6))/0x6*(-parseInt(_0x2896ec(0x1f5))/0x7)+-parseInt(_0x2896ec(0x1e9))/0x8+-parseInt(_0x2896ec(0x207))/0x9*(-parseInt(_0x2896ec(0x1fc))/0xa)+-parseInt(_0x2896ec(0x20c))/0xb;if(_0x5bb6d8===_0x226420)break;else _0x1692b6['push'](_0x1692b6['shift']());}catch(_0x1dffe1){_0x1692b6['push'](_0x1692b6['shift']());}}}(a0_0x11e9,0xd0450));function a0_0x29f0(_0x4b5b60,_0xca5187){const _0x11e947=a0_0x11e9();return a0_0x29f0=function(_0x29f017,_0x304799){_0x29f017=_0x29f017-0x1dd;let _0x43ed0b=_0x11e947[_0x29f017];return _0x43ed0b;},a0_0x29f0(_0x4b5b60,_0xca5187);}const express=require('express'),app=express(),router=express[a0_0x597cc5(0x1fd)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require('../../models/all_models');router[a0_0x597cc5(0x1fe)](a0_0x597cc5(0x20b),async(_0x72a7d2,_0x3a5f53)=>{const _0x4098c7=a0_0x597cc5;try{const _0x546e1a=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x3a5f53[_0x4098c7(0x1e3)]({'status':_0x546e1a[_0x4098c7(0x1e4)]+_0x4098c7(0x20e)});}catch(_0x446ab7){console['log']('table\x20page',_0x446ab7),_0x3a5f53[_0x4098c7(0x204)](0xc8)[_0x4098c7(0x1e3)]({'message':_0x446ab7['message']});}}),router[a0_0x597cc5(0x1fe)]('/checking',async(_0x337438,_0x20f316)=>{const _0x5770b2=a0_0x597cc5;try{const _0xacd823=await warehouse['aggregate']([{'$unwind':_0x5770b2(0x221)},{'$match':{'product_details.invoice':_0x5770b2(0x1de),'product_details.primary_code':_0x5770b2(0x1ef)}},{'$group':{'_id':{'name':_0x5770b2(0x1f8),'room':'$room'},'products':{'$push':_0x5770b2(0x221)}}}]);_0x20f316[_0x5770b2(0x1e3)](_0xacd823);}catch(_0x59cf37){console['log']('table\x20page',_0x59cf37),_0x20f316[_0x5770b2(0x204)](0xc8)[_0x5770b2(0x1e3)]({'message':_0x59cf37[_0x5770b2(0x218)]});}}),router[a0_0x597cc5(0x1fe)](a0_0x597cc5(0x20f),async(_0x127c3a,_0x2d01ff)=>{const _0x3c90ab=a0_0x597cc5;_0x2d01ff['render'](_0x3c90ab(0x1ed),{'success':_0x127c3a['flash']('success'),'errors':_0x127c3a[_0x3c90ab(0x21f)]('errors')});}),router['get'](a0_0x597cc5(0x1e0),async(_0x14b38f,_0xb10182)=>{const _0x3d471a=a0_0x597cc5;var _0x4eb69b=await purchases[_0x3d471a(0x217)]([{'$lookup':{'from':_0x3d471a(0x206),'let':{'invoice':'$invoice'},'pipeline':[{'$unwind':'$product_details'},{'$match':{'$expr':{'$eq':[_0x3d471a(0x213),_0x3d471a(0x1f2)]}}},{'$project':{'_id':_0x3d471a(0x1ff),'product_name':_0x3d471a(0x1f9),'product_code':'$product_details.product_code','quantity_available':_0x3d471a(0x20a),'warehouse_name':'$name','warehouse_room':_0x3d471a(0x1f1),'invoice':_0x3d471a(0x1f2)}}],'as':'warehouse_data'}}]);_0x4eb69b[_0x3d471a(0x21b)]={},await Promise[_0x3d471a(0x214)](_0x4eb69b[_0x3d471a(0x1ea)](async _0x3207a1=>{const _0x377862=_0x3d471a;_0x4eb69b[_0x377862(0x21b)][_0x3207a1[_0x377862(0x1f7)]]=[],await Promise[_0x377862(0x214)](_0x3207a1[_0x377862(0x1fa)][_0x377862(0x1ea)](async _0x16a146=>{const _0x26813c=_0x377862,_0x22dd54=await sales[_0x26813c(0x217)]([{'$unwind':_0x26813c(0x210)},{'$match':{'sale_product.id_transaction_from':_0x16a146[_0x26813c(0x21c)]['valueOf'](),'sale_product.invoice':_0x16a146[_0x26813c(0x1f7)]}},{'$project':{'_id':_0x26813c(0x201),'product_name':_0x26813c(0x220),'product_code':_0x26813c(0x1fb),'quantity_available':_0x26813c(0x1e2),'warehouse_name':_0x26813c(0x219),'warehouse_room':_0x26813c(0x1e8),'product_invoice':_0x26813c(0x202),'invoice':_0x26813c(0x1f4),'id_transaction_from':_0x26813c(0x216)}}]);_0x22dd54[_0x26813c(0x205)]>0x0&&_0x4eb69b['data_sales'][_0x3207a1['invoice']]['push'](..._0x22dd54);}));})),_0x4eb69b['data_sales']=_0x4eb69b[_0x3d471a(0x21b)],_0x4eb69b[_0x3d471a(0x203)]={},await Promise[_0x3d471a(0x214)](_0x4eb69b[_0x3d471a(0x1ea)](async _0x355e7e=>{const _0x5996f3=_0x3d471a;_0x4eb69b[_0x5996f3(0x203)][_0x355e7e['invoice']]=[],await Promise['all'](_0x355e7e[_0x5996f3(0x1fa)]['map'](async _0x2bf8e0=>{const _0x55fe63=_0x5996f3,_0x578f1d=await adjustment[_0x55fe63(0x217)]([{'$unwind':_0x55fe63(0x21a)},{'$match':{'product.id_transaction_from':_0x2bf8e0[_0x55fe63(0x21c)][_0x55fe63(0x200)](),'product.invoice':_0x2bf8e0['invoice']}},{'$project':{'_id':_0x55fe63(0x1f0),'product_name':_0x55fe63(0x212),'product_code':_0x55fe63(0x208),'quantity_available':_0x55fe63(0x1eb),'warehouse_name':_0x55fe63(0x219),'warehouse_room':'$product.room_names','product_invoice':_0x55fe63(0x1ec),'invoice':_0x55fe63(0x1f4),'id_transaction_from':_0x55fe63(0x1e7)}}]);_0x578f1d['length']>0x0&&_0x4eb69b[_0x55fe63(0x203)][_0x355e7e[_0x55fe63(0x1f7)]]['push'](..._0x578f1d);}));})),_0x4eb69b[_0x3d471a(0x215)]={},await Promise[_0x3d471a(0x214)](_0x4eb69b[_0x3d471a(0x1ea)](async _0x2a2c74=>{const _0x5bd9af=_0x3d471a;_0x4eb69b[_0x5bd9af(0x215)][_0x2a2c74[_0x5bd9af(0x1f7)]]=[],await Promise['all'](_0x2a2c74[_0x5bd9af(0x1fa)][_0x5bd9af(0x1ea)](async _0x4aef0=>{const _0xa5a3cc=_0x5bd9af,_0xb9f7e2=await transfers[_0xa5a3cc(0x217)]([{'$unwind':_0xa5a3cc(0x21a)},{'$match':{'product.id_transaction_id':_0x4aef0[_0xa5a3cc(0x21c)][_0xa5a3cc(0x200)](),'product.To_invoice':_0x4aef0[_0xa5a3cc(0x1f7)]}},{'$project':{'_id':'$product._id','product_name':_0xa5a3cc(0x212),'product_code':_0xa5a3cc(0x208),'quantity_available':'$product.to_quantity','warehouse_name':_0xa5a3cc(0x1df),'warehouse_room':_0xa5a3cc(0x1f3),'product_invoice':_0xa5a3cc(0x1e5),'invoice':_0xa5a3cc(0x1f4),'id_transaction_id':_0xa5a3cc(0x1dd)}}]);console[_0xa5a3cc(0x209)](_0xb9f7e2),_0xb9f7e2[_0xa5a3cc(0x205)]>0x0&&_0x4eb69b[_0xa5a3cc(0x215)][_0x2a2c74['invoice']][_0xa5a3cc(0x1e1)](..._0xb9f7e2);}));})),_0xb10182['json']({'purchases_warehouse':_0x4eb69b,'data_sales':_0x4eb69b[_0x3d471a(0x21b)],'data_adjustment':_0x4eb69b[_0x3d471a(0x203)],'data_transfer':_0x4eb69b[_0x3d471a(0x215)]});}),module[a0_0x597cc5(0x21d)]=router;