const a0_0x578288=a0_0x4ff2;(function(_0x4c2b20,_0x23c92b){const _0x205f81=a0_0x4ff2,_0x232253=_0x4c2b20();while(!![]){try{const _0x575496=-parseInt(_0x205f81(0x115))/0x1*(parseInt(_0x205f81(0x12e))/0x2)+parseInt(_0x205f81(0x126))/0x3+-parseInt(_0x205f81(0x125))/0x4+-parseInt(_0x205f81(0x109))/0x5*(parseInt(_0x205f81(0x129))/0x6)+-parseInt(_0x205f81(0x10d))/0x7*(parseInt(_0x205f81(0x108))/0x8)+parseInt(_0x205f81(0x106))/0x9*(parseInt(_0x205f81(0x10a))/0xa)+parseInt(_0x205f81(0x112))/0xb*(parseInt(_0x205f81(0x133))/0xc);if(_0x575496===_0x23c92b)break;else _0x232253['push'](_0x232253['shift']());}catch(_0x2f75d6){_0x232253['push'](_0x232253['shift']());}}}(a0_0xea74,0xa5f77));const express=require('express'),app=express(),router=express[a0_0x578288(0x113)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x578288(0xfc));function a0_0xea74(){const _0x328b0e=['$product._id','data_adjustment','/join','$sale_product.invoice','$sale_product','map','status','$invoice','6759FyaDZy','$product_details.product_stock','8640GQzqvI','5yKSyLi','6010KNtjKc','invoice','$product.invoice','5579pQLFwk','$product.new_adjust_qty','$product.room_names','warehouse_data','$name','22oeFiac','Router','aggregate','29RMnBmP','data_sales','get','$sale_product.room_name','/negative','$sale_product.product_name','log','render','14800005047429','$to_warehouse','$$invoice','length','$product_details.product_name','$sale_product.quantity','exports','data_transfer','5184360eJSxfe','860826JFcNFR','json','$product_details._id','5584662ryyTuS','$product.id_transaction_from','_id','$product.product_name','$room','72146BwNpOA','$product','message','$product.to_quantity','valueOf','24451500PYMSqE','$warehouse_name','all','/checking','$product_details.product_code','$sale_product._id','$product_details.invoice','$sale_product.product_code','$product.product_code','$product_details','table\x20page','flash','../../models/all_models','push'];a0_0xea74=function(){return _0x328b0e;};return a0_0xea74();}function a0_0x4ff2(_0x1d1175,_0x440966){const _0xea7423=a0_0xea74();return a0_0x4ff2=function(_0x4ff23d,_0x1ae53a){_0x4ff23d=_0x4ff23d-0xf6;let _0x2f80cd=_0xea7423[_0x4ff23d];return _0x2f80cd;},a0_0x4ff2(_0x1d1175,_0x440966);}router['get'](a0_0x578288(0x119),async(_0x11bde8,_0x446bd4)=>{const _0x48081d=a0_0x578288;try{const _0x16670e=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x446bd4[_0x48081d(0x127)]({'status':_0x16670e['modifiedCount']+'\x20documents\x20updated'});}catch(_0x197acc){console[_0x48081d(0x11b)](_0x48081d(0xfa),_0x197acc),_0x446bd4[_0x48081d(0x104)](0xc8)[_0x48081d(0x127)]({'message':_0x197acc[_0x48081d(0x130)]});}}),router[a0_0x578288(0x117)](a0_0x578288(0x136),async(_0x5489cf,_0xb4a726)=>{const _0x105172=a0_0x578288;try{const _0x580d98=await warehouse[_0x105172(0x114)]([{'$unwind':_0x105172(0xf9)},{'$match':{'product_details.invoice':'INCF-52068316','product_details.primary_code':_0x105172(0x11d)}},{'$group':{'_id':{'name':_0x105172(0x111),'room':'$room'},'products':{'$push':_0x105172(0xf9)}}}]);_0xb4a726['json'](_0x580d98);}catch(_0x5738f7){console[_0x105172(0x11b)](_0x105172(0xfa),_0x5738f7),_0xb4a726[_0x105172(0x104)](0xc8)[_0x105172(0x127)]({'message':_0x5738f7[_0x105172(0x130)]});}}),router[a0_0x578288(0x117)]('/warehouse_monitor',async(_0x168355,_0x518fbf)=>{const _0x47b297=a0_0x578288;_0x518fbf[_0x47b297(0x11c)]('monitor',{'success':_0x168355['flash']('success'),'errors':_0x168355[_0x47b297(0xfb)]('errors')});}),router[a0_0x578288(0x117)](a0_0x578288(0x100),async(_0x5b6c5f,_0x10ec0f)=>{const _0x509268=a0_0x578288;var _0x23cecc=await purchases[_0x509268(0x114)]([{'$lookup':{'from':'warehouses','let':{'invoice':_0x509268(0x105)},'pipeline':[{'$unwind':_0x509268(0xf9)},{'$match':{'$expr':{'$eq':[_0x509268(0x11f),_0x509268(0xf6)]}}},{'$project':{'_id':_0x509268(0x128),'product_name':_0x509268(0x121),'product_code':_0x509268(0x137),'quantity_available':_0x509268(0x107),'warehouse_name':'$name','warehouse_room':_0x509268(0x12d),'invoice':_0x509268(0xf6)}}],'as':'warehouse_data'}}]);_0x23cecc[_0x509268(0x116)]={},await Promise['all'](_0x23cecc[_0x509268(0x103)](async _0xf5409d=>{const _0x27919c=_0x509268;_0x23cecc['data_sales'][_0xf5409d[_0x27919c(0x10b)]]=[],await Promise[_0x27919c(0x135)](_0xf5409d[_0x27919c(0x110)]['map'](async _0x48d355=>{const _0x41e601=_0x27919c,_0x1dc090=await sales[_0x41e601(0x114)]([{'$unwind':_0x41e601(0x102)},{'$match':{'sale_product.id_transaction_from':_0x48d355[_0x41e601(0x12b)][_0x41e601(0x132)](),'sale_product.invoice':_0x48d355['invoice']}},{'$project':{'_id':_0x41e601(0x138),'product_name':_0x41e601(0x11a),'product_code':_0x41e601(0xf7),'quantity_available':_0x41e601(0x122),'warehouse_name':_0x41e601(0x134),'warehouse_room':_0x41e601(0x118),'product_invoice':_0x41e601(0x101),'invoice':_0x41e601(0x105),'id_transaction_from':'$sale_product.id_transaction_from'}}]);_0x1dc090[_0x41e601(0x120)]>0x0&&_0x23cecc[_0x41e601(0x116)][_0xf5409d[_0x41e601(0x10b)]]['push'](..._0x1dc090);}));})),_0x23cecc[_0x509268(0x116)]=_0x23cecc[_0x509268(0x116)],_0x23cecc[_0x509268(0xff)]={},await Promise[_0x509268(0x135)](_0x23cecc[_0x509268(0x103)](async _0x33058d=>{const _0x2c097f=_0x509268;_0x23cecc[_0x2c097f(0xff)][_0x33058d[_0x2c097f(0x10b)]]=[],await Promise[_0x2c097f(0x135)](_0x33058d['warehouse_data'][_0x2c097f(0x103)](async _0xa80a7c=>{const _0xd881fd=_0x2c097f,_0x29d79a=await adjustment[_0xd881fd(0x114)]([{'$unwind':_0xd881fd(0x12f)},{'$match':{'product.id_transaction_from':_0xa80a7c[_0xd881fd(0x12b)][_0xd881fd(0x132)](),'product.invoice':_0xa80a7c[_0xd881fd(0x10b)]}},{'$project':{'_id':'$product._id','product_name':_0xd881fd(0x12c),'product_code':_0xd881fd(0xf8),'quantity_available':_0xd881fd(0x10e),'warehouse_name':_0xd881fd(0x134),'warehouse_room':'$product.room_names','product_invoice':_0xd881fd(0x10c),'invoice':_0xd881fd(0x105),'id_transaction_from':_0xd881fd(0x12a)}}]);_0x29d79a[_0xd881fd(0x120)]>0x0&&_0x23cecc['data_adjustment'][_0x33058d[_0xd881fd(0x10b)]]['push'](..._0x29d79a);}));})),_0x23cecc[_0x509268(0x124)]={},await Promise['all'](_0x23cecc[_0x509268(0x103)](async _0x251b8d=>{const _0x37d646=_0x509268;_0x23cecc[_0x37d646(0x124)][_0x251b8d[_0x37d646(0x10b)]]=[],await Promise['all'](_0x251b8d['warehouse_data'][_0x37d646(0x103)](async _0x2db797=>{const _0x448a9c=_0x37d646,_0x1cfac0=await transfers[_0x448a9c(0x114)]([{'$unwind':_0x448a9c(0x12f)},{'$match':{'product.id_transaction_id':_0x2db797[_0x448a9c(0x12b)]['valueOf'](),'product.To_invoice':_0x2db797[_0x448a9c(0x10b)]}},{'$project':{'_id':_0x448a9c(0xfe),'product_name':'$product.product_name','product_code':_0x448a9c(0xf8),'quantity_available':_0x448a9c(0x131),'warehouse_name':_0x448a9c(0x11e),'warehouse_room':_0x448a9c(0x10f),'product_invoice':'$product.to_room_name','invoice':_0x448a9c(0x105),'id_transaction_id':'$product.id_transaction_id'}}]);console[_0x448a9c(0x11b)](_0x1cfac0),_0x1cfac0[_0x448a9c(0x120)]>0x0&&_0x23cecc[_0x448a9c(0x124)][_0x251b8d[_0x448a9c(0x10b)]][_0x448a9c(0xfd)](..._0x1cfac0);}));})),_0x10ec0f[_0x509268(0x127)]({'purchases_warehouse':_0x23cecc,'data_sales':_0x23cecc[_0x509268(0x116)],'data_adjustment':_0x23cecc[_0x509268(0xff)],'data_transfer':_0x23cecc[_0x509268(0x124)]});}),module[a0_0x578288(0x123)]=router;