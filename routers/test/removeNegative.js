const a0_0x5cde87=a0_0x51d2;(function(_0x599df4,_0x54bdbb){const _0x1379bc=a0_0x51d2,_0x11f7c4=_0x599df4();while(!![]){try{const _0x14b060=-parseInt(_0x1379bc(0x1ff))/0x1+parseInt(_0x1379bc(0x1e8))/0x2+parseInt(_0x1379bc(0x20e))/0x3+parseInt(_0x1379bc(0x1cf))/0x4+-parseInt(_0x1379bc(0x1e7))/0x5+parseInt(_0x1379bc(0x1e0))/0x6+-parseInt(_0x1379bc(0x1fe))/0x7*(parseInt(_0x1379bc(0x1f7))/0x8);if(_0x14b060===_0x54bdbb)break;else _0x11f7c4['push'](_0x11f7c4['shift']());}catch(_0x325261){_0x11f7c4['push'](_0x11f7c4['shift']());}}}(a0_0x20aa,0x82d5d));function a0_0x20aa(){const _0x12ce2c=['length','$product','$product.id_transaction_from','$product_details.invoice','json','status','15547Cumnrb','137336YgbeTN','data_sales','$sale_product.room_name','data_adjustment','modifiedCount','$product.new_adjust_qty','$product.product_name','\x20documents\x20updated','$sale_product._id','$product_details.product_code','$product._id','aggregate','$product.product_code','/checking','_id','901473KAaYWe','map','flash','4108900elrVeT','$sale_product','$product.to_room_name','updateMany','valueOf','/warehouse_monitor','$product_details.product_stock','/negative','invoice','$product_details.product_name','data_transfer','../../models/all_models','14800005047429','$name','$$invoice','$warehouse_name','$invoice','346302pLxMxj','INCF-52068316','$product.room_names','$product_details._id','log','message','$product_details','5100975JGSLtc','1055756HvJcDS','push','$product.to_quantity','$sale_product.product_code','$sale_product.product_name','table\x20page','$room','$sale_product.id_transaction_from','warehouses','get','errors','Router','warehouse_data','$sale_product.invoice','all','792WBeenG'];a0_0x20aa=function(){return _0x12ce2c;};return a0_0x20aa();}function a0_0x51d2(_0x3090cb,_0x4d30ff){const _0x20aaee=a0_0x20aa();return a0_0x51d2=function(_0x51d2bc,_0x45d24b){_0x51d2bc=_0x51d2bc-0x1cd;let _0x3fb032=_0x20aaee[_0x51d2bc];return _0x3fb032;},a0_0x51d2(_0x3090cb,_0x4d30ff);}const express=require('express'),app=express(),router=express[a0_0x5cde87(0x1f3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x5cde87(0x1da));router[a0_0x5cde87(0x1f1)](a0_0x5cde87(0x1d6),async(_0xb5ef0e,_0x7a046)=>{const _0xca589e=a0_0x5cde87;try{const _0x1ceb48=await warehouse[_0xca589e(0x1d2)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x7a046[_0xca589e(0x1fc)]({'status':_0x1ceb48[_0xca589e(0x203)]+_0xca589e(0x206)});}catch(_0x460770){console['log'](_0xca589e(0x1ed),_0x460770),_0x7a046[_0xca589e(0x1fd)](0xc8)['json']({'message':_0x460770[_0xca589e(0x1e5)]});}}),router[a0_0x5cde87(0x1f1)](a0_0x5cde87(0x20c),async(_0xf44a1a,_0xa08cce)=>{const _0x76422b=a0_0x5cde87;try{const _0x336cda=await warehouse[_0x76422b(0x20a)]([{'$unwind':_0x76422b(0x1e6)},{'$match':{'product_details.invoice':_0x76422b(0x1e1),'product_details.primary_code':_0x76422b(0x1db)}},{'$group':{'_id':{'name':_0x76422b(0x1dc),'room':_0x76422b(0x1ee)},'products':{'$push':_0x76422b(0x1e6)}}}]);_0xa08cce[_0x76422b(0x1fc)](_0x336cda);}catch(_0x6fe18f){console[_0x76422b(0x1e4)](_0x76422b(0x1ed),_0x6fe18f),_0xa08cce[_0x76422b(0x1fd)](0xc8)[_0x76422b(0x1fc)]({'message':_0x6fe18f[_0x76422b(0x1e5)]});}}),router[a0_0x5cde87(0x1f1)](a0_0x5cde87(0x1d4),async(_0x20f16e,_0x1c4fa5)=>{const _0x1355d2=a0_0x5cde87;_0x1c4fa5['render']('monitor',{'success':_0x20f16e[_0x1355d2(0x1ce)]('success'),'errors':_0x20f16e[_0x1355d2(0x1ce)](_0x1355d2(0x1f2))});}),router['get']('/join',async(_0x1d3082,_0x5992fa)=>{const _0x2e96ee=a0_0x5cde87;var _0x555a94=await purchases[_0x2e96ee(0x20a)]([{'$lookup':{'from':_0x2e96ee(0x1f0),'let':{'invoice':'$invoice'},'pipeline':[{'$unwind':'$product_details'},{'$match':{'$expr':{'$eq':[_0x2e96ee(0x1dd),_0x2e96ee(0x1fb)]}}},{'$project':{'_id':_0x2e96ee(0x1e3),'product_name':_0x2e96ee(0x1d8),'product_code':_0x2e96ee(0x208),'quantity_available':_0x2e96ee(0x1d5),'warehouse_name':'$name','warehouse_room':_0x2e96ee(0x1ee),'invoice':_0x2e96ee(0x1fb)}}],'as':_0x2e96ee(0x1f4)}}]);_0x555a94['data_sales']={},await Promise[_0x2e96ee(0x1f6)](_0x555a94[_0x2e96ee(0x1cd)](async _0x2209a1=>{const _0x35127b=_0x2e96ee;_0x555a94[_0x35127b(0x200)][_0x2209a1[_0x35127b(0x1d7)]]=[],await Promise['all'](_0x2209a1[_0x35127b(0x1f4)][_0x35127b(0x1cd)](async _0x43e6a0=>{const _0x50f706=_0x35127b,_0x16e549=await sales[_0x50f706(0x20a)]([{'$unwind':_0x50f706(0x1d0)},{'$match':{'sale_product.id_transaction_from':_0x43e6a0[_0x50f706(0x20d)][_0x50f706(0x1d3)](),'sale_product.invoice':_0x43e6a0['invoice']}},{'$project':{'_id':_0x50f706(0x207),'product_name':_0x50f706(0x1ec),'product_code':_0x50f706(0x1eb),'quantity_available':'$sale_product.quantity','warehouse_name':_0x50f706(0x1de),'warehouse_room':_0x50f706(0x201),'product_invoice':_0x50f706(0x1f5),'invoice':'$invoice','id_transaction_from':_0x50f706(0x1ef)}}]);_0x16e549[_0x50f706(0x1f8)]>0x0&&_0x555a94[_0x50f706(0x200)][_0x2209a1[_0x50f706(0x1d7)]][_0x50f706(0x1e9)](..._0x16e549);}));})),_0x555a94[_0x2e96ee(0x200)]=_0x555a94[_0x2e96ee(0x200)],_0x555a94['data_adjustment']={},await Promise[_0x2e96ee(0x1f6)](_0x555a94[_0x2e96ee(0x1cd)](async _0x56e94c=>{const _0x5476b9=_0x2e96ee;_0x555a94[_0x5476b9(0x202)][_0x56e94c['invoice']]=[],await Promise['all'](_0x56e94c[_0x5476b9(0x1f4)]['map'](async _0x5b28e2=>{const _0x7d5823=_0x5476b9,_0x3d3796=await adjustment['aggregate']([{'$unwind':_0x7d5823(0x1f9)},{'$match':{'product.id_transaction_from':_0x5b28e2[_0x7d5823(0x20d)][_0x7d5823(0x1d3)](),'product.invoice':_0x5b28e2[_0x7d5823(0x1d7)]}},{'$project':{'_id':_0x7d5823(0x209),'product_name':'$product.product_name','product_code':_0x7d5823(0x20b),'quantity_available':_0x7d5823(0x204),'warehouse_name':'$warehouse_name','warehouse_room':_0x7d5823(0x1e2),'product_invoice':'$product.invoice','invoice':_0x7d5823(0x1df),'id_transaction_from':_0x7d5823(0x1fa)}}]);_0x3d3796[_0x7d5823(0x1f8)]>0x0&&_0x555a94[_0x7d5823(0x202)][_0x56e94c[_0x7d5823(0x1d7)]]['push'](..._0x3d3796);}));})),_0x555a94[_0x2e96ee(0x1d9)]={},await Promise[_0x2e96ee(0x1f6)](_0x555a94[_0x2e96ee(0x1cd)](async _0x48f4f3=>{const _0x51c85d=_0x2e96ee;_0x555a94['data_transfer'][_0x48f4f3[_0x51c85d(0x1d7)]]=[],await Promise[_0x51c85d(0x1f6)](_0x48f4f3['warehouse_data'][_0x51c85d(0x1cd)](async _0x49e3bc=>{const _0x1be9ae=_0x51c85d,_0x120ad0=await transfers[_0x1be9ae(0x20a)]([{'$unwind':_0x1be9ae(0x1f9)},{'$match':{'product.id_transaction_id':_0x49e3bc[_0x1be9ae(0x20d)][_0x1be9ae(0x1d3)](),'product.To_invoice':_0x49e3bc[_0x1be9ae(0x1d7)]}},{'$project':{'_id':_0x1be9ae(0x209),'product_name':_0x1be9ae(0x205),'product_code':_0x1be9ae(0x20b),'quantity_available':_0x1be9ae(0x1ea),'warehouse_name':'$to_warehouse','warehouse_room':_0x1be9ae(0x1e2),'product_invoice':_0x1be9ae(0x1d1),'invoice':_0x1be9ae(0x1df),'id_transaction_id':'$product.id_transaction_id'}}]);console[_0x1be9ae(0x1e4)](_0x120ad0),_0x120ad0['length']>0x0&&_0x555a94[_0x1be9ae(0x1d9)][_0x48f4f3[_0x1be9ae(0x1d7)]][_0x1be9ae(0x1e9)](..._0x120ad0);}));})),_0x5992fa[_0x2e96ee(0x1fc)]({'purchases_warehouse':_0x555a94,'data_sales':_0x555a94[_0x2e96ee(0x200)],'data_adjustment':_0x555a94[_0x2e96ee(0x202)],'data_transfer':_0x555a94[_0x2e96ee(0x1d9)]});}),module['exports']=router;