var a0_0x326140=a0_0x12cb;(function(_0x3bad25,_0x6e0ddc){var _0x5bb28e=a0_0x12cb,_0x497825=_0x3bad25();while(!![]){try{var _0x1d6299=parseInt(_0x5bb28e(0x1cf))/0x1*(-parseInt(_0x5bb28e(0x1c2))/0x2)+parseInt(_0x5bb28e(0x1a9))/0x3+-parseInt(_0x5bb28e(0xf5))/0x4+-parseInt(_0x5bb28e(0x178))/0x5*(-parseInt(_0x5bb28e(0x99))/0x6)+-parseInt(_0x5bb28e(0xbb))/0x7*(parseInt(_0x5bb28e(0x109))/0x8)+parseInt(_0x5bb28e(0x156))/0x9+parseInt(_0x5bb28e(0x1af))/0xa*(parseInt(_0x5bb28e(0x1b1))/0xb);if(_0x1d6299===_0x6e0ddc)break;else _0x497825['push'](_0x497825['shift']());}catch(_0x3747fc){_0x497825['push'](_0x497825['shift']());}}}(a0_0x126e,0xb401e));const express=require(a0_0x326140(0x1cd)),app=express(),router=express[a0_0x326140(0x1cc)](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_validation_setup}=require(a0_0x326140(0x188)),auth=require(a0_0x326140(0x166)),nodemailer=require(a0_0x326140(0x16a)),users=require(a0_0x326140(0x1a6));function a0_0x12cb(_0x49c024,_0x5f0ac1){var _0x126e6f=a0_0x126e();return a0_0x12cb=function(_0x12cb7b,_0x24913c){_0x12cb7b=_0x12cb7b-0x93;var _0x88be20=_0x126e6f[_0x12cb7b];return _0x88be20;},a0_0x12cb(_0x49c024,_0x5f0ac1);}router[a0_0x326140(0x110)](a0_0x326140(0xea),auth,async(_0x24494f,_0x495c5b)=>{var _0x376ae5=a0_0x326140;try{const {username:_0x401ffd,email:_0x188ab0,role:_0x326a3d}=_0x24494f[_0x376ae5(0x18f)],_0x14929b=_0x24494f[_0x376ae5(0x18f)],_0x5d5e03=await profile['findOne']({'email':_0x14929b[_0x376ae5(0x1c4)]}),_0x11d7c8=await master_shop[_0x376ae5(0x101)]();let _0x340ed4;if(_0x14929b['role']==_0x376ae5(0x163)){const _0x2987d7=await staff['findOne']({'email':_0x14929b[_0x376ae5(0x1c4)]});_0x340ed4=await sales_finished[_0x376ae5(0x141)]([{'$match':{'typeOfProducts':_0x376ae5(0x19c)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x376ae5(0xfa),'invoice':{'$first':_0x376ae5(0x1ce)},'customers':{'$first':_0x376ae5(0x11a)},'date':{'$first':_0x376ae5(0x9f)},'warehouse_name':{'$first':_0x376ae5(0xef)},'sale_product':{'$push':_0x376ae5(0x193)},'note':{'$first':_0x376ae5(0xcc)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x376ae5(0x19d)},'total_saleproduct_quantity':{'$sum':_0x376ae5(0x11d)},'level':{'$addToSet':_0x376ae5(0xe9)},'isle':{'$addToSet':_0x376ae5(0x1dd)},'type':{'$addToSet':_0x376ae5(0xd8)},'pallet':{'$addToSet':_0x376ae5(0xeb)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x340ed4=await sales_finished[_0x376ae5(0x141)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x376ae5(0xfa),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x376ae5(0x9f)},'warehouse_name':{'$first':_0x376ae5(0xef)},'sale_product':{'$push':_0x376ae5(0x193)},'note':{'$first':_0x376ae5(0xcc)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x376ae5(0x19d)},'total_saleproduct_quantity':{'$sum':_0x376ae5(0x11d)},'level':{'$addToSet':_0x376ae5(0xe9)},'isle':{'$addToSet':_0x376ae5(0x1dd)},'type':{'$addToSet':_0x376ae5(0xd8)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x11d7c8[0x0][_0x376ae5(0x145)]==_0x376ae5(0x1ca)){var _0x491101=users['English'];console[_0x376ae5(0xfb)](_0x491101);}else{if(_0x11d7c8[0x0][_0x376ae5(0x145)]==_0x376ae5(0xe1))var _0x491101=users[_0x376ae5(0xe1)];else{if(_0x11d7c8[0x0]['language']==_0x376ae5(0x97))var _0x491101=users[_0x376ae5(0x97)];else{if(_0x11d7c8[0x0][_0x376ae5(0x145)]==_0x376ae5(0xb2))var _0x491101=users[_0x376ae5(0xb2)];else{if(_0x11d7c8[0x0][_0x376ae5(0x145)]=='French')var _0x491101=users['French'];else{if(_0x11d7c8[0x0][_0x376ae5(0x145)]==_0x376ae5(0x1b2))var _0x491101=users[_0x376ae5(0x16d)];else{if(_0x11d7c8[0x0][_0x376ae5(0x145)]==_0x376ae5(0xe7))var _0x491101=users[_0x376ae5(0xe7)];else{if(_0x11d7c8[0x0][_0x376ae5(0x145)]==_0x376ae5(0x1c5))var _0x491101=users['Arabic'];}}}}}}}_0x495c5b[_0x376ae5(0x131)](_0x376ae5(0x98),{'success':_0x24494f['flash'](_0x376ae5(0x164)),'errors':_0x24494f['flash'](_0x376ae5(0x1de)),'sales':_0x340ed4,'profile':_0x5d5e03,'role':_0x14929b,'master_shop':_0x11d7c8,'language':_0x491101});}catch(_0x38001c){console[_0x376ae5(0xfb)](_0x38001c);}}),router[a0_0x326140(0x110)](a0_0x326140(0x10d),auth,async(_0x4d26ab,_0x3894da)=>{var _0x331c47=a0_0x326140;try{const {username:_0x28c815,email:_0x5f5cfc,role:_0x364340}=_0x4d26ab[_0x331c47(0x18f)],_0x2e866f=_0x4d26ab['user'],_0x1bf6de=await profile[_0x331c47(0x1bb)]({'email':_0x2e866f[_0x331c47(0x1c4)]}),_0x7ffe04=await master_shop['find']();let _0x4638ab;if(_0x2e866f[_0x331c47(0x121)]==_0x331c47(0x163)){const _0x212eed=await staff[_0x331c47(0x1bb)]({'email':_0x2e866f[_0x331c47(0x1c4)]});_0x4638ab=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x331c47(0xb8)}},{'$unwind':_0x331c47(0x193)},{'$group':{'_id':_0x331c47(0xfa),'invoice':{'$first':_0x331c47(0x1ce)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x331c47(0xef)},'sale_product':{'$push':_0x331c47(0x193)},'note':{'$first':_0x331c47(0xcc)},'return_data':{'$first':_0x331c47(0x195)},'customers_docs':{'$first':_0x331c47(0x19d)},'total_saleproduct_quantity':{'$sum':_0x331c47(0x11d)},'level':{'$addToSet':_0x331c47(0xe9)},'isle':{'$addToSet':_0x331c47(0x1dd)},'type':{'$addToSet':_0x331c47(0xd8)},'pallet':{'$addToSet':_0x331c47(0xeb)},'finalize':{'$first':_0x331c47(0x1d1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4638ab=await sales_finished[_0x331c47(0x141)]([{'$match':{'typeOfProducts':_0x331c47(0xb8)}},{'$unwind':_0x331c47(0x193)},{'$group':{'_id':_0x331c47(0xfa),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x331c47(0x11a)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x331c47(0x193)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x331c47(0x19d)},'total_saleproduct_quantity':{'$sum':_0x331c47(0x11d)},'level':{'$addToSet':_0x331c47(0xe9)},'isle':{'$addToSet':_0x331c47(0x1dd)},'type':{'$addToSet':_0x331c47(0xd8)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x331c47(0x1d1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x7ffe04[0x0][_0x331c47(0x145)]==_0x331c47(0x1ca)){var _0x55db67=users['English'];console[_0x331c47(0xfb)](_0x55db67);}else{if(_0x7ffe04[0x0][_0x331c47(0x145)]==_0x331c47(0xe1))var _0x55db67=users[_0x331c47(0xe1)];else{if(_0x7ffe04[0x0]['language']==_0x331c47(0x97))var _0x55db67=users[_0x331c47(0x97)];else{if(_0x7ffe04[0x0][_0x331c47(0x145)]==_0x331c47(0xb2))var _0x55db67=users[_0x331c47(0xb2)];else{if(_0x7ffe04[0x0]['language']==_0x331c47(0xa8))var _0x55db67=users[_0x331c47(0xa8)];else{if(_0x7ffe04[0x0][_0x331c47(0x145)]==_0x331c47(0x1b2))var _0x55db67=users[_0x331c47(0x16d)];else{if(_0x7ffe04[0x0][_0x331c47(0x145)]==_0x331c47(0xe7))var _0x55db67=users[_0x331c47(0xe7)];else{if(_0x7ffe04[0x0][_0x331c47(0x145)]=='Arabic\x20(ae)')var _0x55db67=users[_0x331c47(0xff)];}}}}}}}_0x3894da['render']('all_sales_finished_logs',{'success':_0x4d26ab[_0x331c47(0x12e)](_0x331c47(0x164)),'errors':_0x4d26ab[_0x331c47(0x12e)]('errors'),'sales':_0x4638ab,'profile':_0x1bf6de,'role':_0x2e866f,'master_shop':_0x7ffe04,'language':_0x55db67});}catch(_0x55be03){console['log'](_0x55be03);}});function a0_0x126e(){var _0x220f27=['$product_details.type_products','$product_details.product_cat','Sale\x20Return','French','warehouse_id','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sales_quantity','<h5\x20style=\x22text-align:\x20left;\x22>','product_details','stock_data','updateOne','sales_quantity_QA','Spanish','Logo.png','Error\x20Occurs','$gross_price','Sale\x20Return\x20Mail','product_stock','logs','/all_sales_finished/view','/view/return_sales/:id','70DfwXMU','/../public','\x20Date:\x20','body','add_sales_finished_logs','$product','purchases_data','<span\x20style=\x22float:\x20right;\x22>','sendMail','max','<h5>','due_amount','Sales\x20Update\x20successfully','status','secondary_code_QA','sale_qty','/picking_list/pdf/','$note','<tr>','carton','<hr\x20class=\x22my-3\x22>','quantity','maxStocks','room',',\x20Location:\x20','for_categorize','level2','_id','/view/:id','$sale_product.type','password','push','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','site_title','<html><head><title></title>','Ambient','product_cat','sales\x20item\x20return\x20successfull','Hindi','$alertquantity','product','<div>','$product_details.product_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Chinese','</tr>','$sale_product.bay','/view','$sale_product.floorlevel','foreach\x20newproduct','redirect','post','$warehouse_name','sale_product','match','$product_details.batch_code','production_date','RoomAssigned','4873836cPakaV','$product_details.expiry_date','$secondary_code','room_name','product_name','$_id','log','$product_details.storage','$product_details.secondary_code','min','Arabic','agent_id','find','$product_details.date_recieved','group_ids','batch_code','\x20Name:\x20','$secondary_unit','add\x20post','</head><body>','20952HJzDWb','barcode\x20Product\x20master','\x20Order\x20Number\x20:\x20','maxPerUnit','/view_log','<strong>\x20Regards\x20</strong>','string','get','filter','getMonth','barcode\x20user_id','<!DOCTYPE\x20html>','warehouse_name','return_sale_QA','$product_details.floorlevel','customer','$product_details.maxPerUnit','$customer','<h2>\x20','return_sale_finished','$sale_product.quantity','OUT-','valueOf','$product_details.room_name','role','abs','$product.product_name','return_sale','date_data','$product_details.secondary_unit','Distributing\x20','currency','\x20<>\x20','$unit','$product_details.primary_code','$product_details.gross_price','expiry_date_QA','flash','/view/add_sales','/view/add_sales/:id','render','toString','/view/add_sales_logs','<tbody\x20style=\x22text-align:\x20center;\x22>','note','/barcode_scanner_auto','secondary_unit_QA','stocks_QA','getFullYear','secondary_unit','unit_QA','$maxStocks','back','/barcode_scanner','$category','maxPerUnit_QA','aggregate','Enclosed','secondary_code','floor','language','$maxProdPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Received\x20Payment\x20For\x20Sale','/all_sales_finished/preview/','</span>','prod_cat','\x20</h2>','date_recieved','There\x27s\x20a\x20error\x20in\x20this\x20transaction','\x20Order\x20Date\x20:\x20','$name','product_name_QA1','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.product_code','$product_details.bin','False','6072678hKILFt','createTransport','maxProducts_QA','received_amount','level','</div>','false','product_list','sales_category','$sales_category','concat','currency_placement','outgoing_invoice','staff','success','Return\x20Goods','../middleware/auth','name','edit_sales_finished','image','nodemailer','$product_details.type','json','Portuguese','int','</thead>','return_data','OUTF-','$product_details.production_date','maxProducts','standard_unit','prod_invoice','LOG-OUT-','invoice_init','51495hBHTBe','$room','master','params','unit','map','id_transaction_from','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.sales_category','$product_details','random','<table\x20style=\x22width:\x20100%\x20!important;\x22>','customer_data','batch_code_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','length','../models/all_models','production_date_QA','/view/add_sale/product','$brand','$product_details.unit','$product_details.uuid','Enabled','user','product_date','gross_price','prod_code','$sale_product','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$return_data','$product_details.invoice','product_id','uuid','True','all','$product_details.bay','own','$customers_docs','$product_details._id','roomNamed','</tbody>','$primary_code','sort','/process/view','stock','date','../public/language/languages.json','invoice','English','3563904mDwlCr','/invoice/:id','getDate','return_qty_QA','primary_code','suppliers','102610mStEix','gmail','1430MMRTNN','Portuguese\x20(BR)','/preview/:id','forEach','</h5>','date_received','primary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/upload/','</td>','findOne','$product_details.level','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Finished\x20Goods','bay','save','\x20==\x20','8TWrdck','max_per_unit','email','Arabic\x20(ae)','$product_code','catch','sales_invoice','Email\x20sent\x20successfully','English\x20(US)','message','Router','express','$invoice','347441uMPuQB','\x20&&\x20','$finalize','</body></html>','/all_sales/view','product_code','findById','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','all_sales_barcode','split','product_code_QA','second_unit','$product_details.rack','padStart','$sale_product.bin','errors','maxProdPerUnit','expiry_date','return_qty','adjust_qty','German','all_sales_finished','102PTpjGS','then','maxperunit','product_data','final','warehouse','$date','primary_code_QA','/barcode_scanner_logs','here','sales','slice'];a0_0x126e=function(){return _0x220f27;};return a0_0x126e();}async function getRandom8DigitNumber(){var _0x51d6c1=a0_0x326140;const _0x4c9a38=0x989680,_0x4cae08=0x5f5e0ff,_0x5014be=Math[_0x51d6c1(0x144)](Math[_0x51d6c1(0x182)]()*(_0x4cae08-_0x4c9a38+0x1))+_0x4c9a38;var _0x4969e8;const _0x6ee087=await sales_finished[_0x51d6c1(0x1bb)]({'invoice':_0x51d6c1(0x171)+_0x5014be});return _0x6ee087&&_0x6ee087['length']>0x0?_0x4969e8='OUTF-'+_0x5014be:_0x4969e8='OUTF-'+_0x5014be,_0x4969e8;}router[a0_0x326140(0x110)](a0_0x326140(0x12f),auth,async(_0x28ccd0,_0x498a58)=>{var _0x1f600c=a0_0x326140;try{const {username:_0x4d069c,email:_0x50a866,role:_0x4f80de}=_0x28ccd0['user'],_0x54fa80=_0x28ccd0[_0x1f600c(0x18f)],_0xaabbee=await profile[_0x1f600c(0x1bb)]({'email':_0x54fa80[_0x1f600c(0x1c4)]}),_0x20abad=await master_shop[_0x1f600c(0x101)](),_0x356f5b=await customer[_0x1f600c(0x101)]({});let _0x2f26df;if(_0x54fa80[_0x1f600c(0x121)]=='staff'){const _0x33e622=await staff[_0x1f600c(0x1bb)]({'email':_0x54fa80[_0x1f600c(0x1c4)]});_0x2f26df=await warehouse[_0x1f600c(0x141)]([{'$match':{'status':'Enabled','name':_0x33e622[_0x1f600c(0x9e)]}},{'$group':{'_id':_0x1f600c(0x150),'name':{'$first':_0x1f600c(0x150)}}},{'$sort':{'name':0x1}}]);}else _0x2f26df=await warehouse[_0x1f600c(0x141)]([{'$match':{'status':_0x1f600c(0x18e)}},{'$group':{'_id':_0x1f600c(0x150),'name':{'$first':_0x1f600c(0x150)}}},{'$sort':{'name':0x1}}]);const _0x234836=await product[_0x1f600c(0x101)]({});var _0x32d0b9=[_0x1f600c(0xde),_0x1f600c(0x142)];const _0x1003f4=await sales_finished[_0x1f600c(0x101)]({}),_0x2b0392=_0x1003f4[_0x1f600c(0x187)]+0x1,_0x1405ea=_0x1f600c(0x171)+_0x2b0392[_0x1f600c(0x132)]()['padStart'](0x5,'0');if(_0x20abad[0x0][_0x1f600c(0x145)]==_0x1f600c(0x1ca)){var _0x6a6f73=users[_0x1f600c(0x1a8)];console[_0x1f600c(0xfb)](_0x6a6f73);}else{if(_0x20abad[0x0][_0x1f600c(0x145)]==_0x1f600c(0xe1))var _0x6a6f73=users[_0x1f600c(0xe1)];else{if(_0x20abad[0x0][_0x1f600c(0x145)]=='German')var _0x6a6f73=users[_0x1f600c(0x97)];else{if(_0x20abad[0x0][_0x1f600c(0x145)]==_0x1f600c(0xb2))var _0x6a6f73=users['Spanish'];else{if(_0x20abad[0x0][_0x1f600c(0x145)]==_0x1f600c(0xa8))var _0x6a6f73=users['French'];else{if(_0x20abad[0x0][_0x1f600c(0x145)]=='Portuguese\x20(BR)')var _0x6a6f73=users['Portuguese'];else{if(_0x20abad[0x0]['language']=='Chinese')var _0x6a6f73=users[_0x1f600c(0xe7)];else{if(_0x20abad[0x0][_0x1f600c(0x145)]==_0x1f600c(0x1c5))var _0x6a6f73=users[_0x1f600c(0xff)];}}}}}}}const _0x3f2c5b=getRandom8DigitNumber();_0x3f2c5b[_0x1f600c(0x9a)](_0x172e43=>{var _0x3f84fc=_0x1f600c;_0x498a58[_0x3f84fc(0x131)]('add_sales_finished',{'success':_0x28ccd0[_0x3f84fc(0x12e)]('success'),'errors':_0x28ccd0[_0x3f84fc(0x12e)](_0x3f84fc(0x1de)),'role':_0x54fa80,'profile':_0xaabbee,'customer':_0x356f5b,'warehouse':_0x2f26df,'product':_0x234836,'invoice':_0x172e43,'master_shop':_0x20abad,'language':_0x6a6f73,'rooms_data':_0x32d0b9});})[_0x1f600c(0x1c7)](_0x53d1da=>{var _0x1bbc90=_0x1f600c;_0x28ccd0['flash']('errors',_0x1bbc90(0x14e)),_0x498a58[_0x1bbc90(0xed)]('/all_sales_finished/view');});}catch(_0x2760ce){console['log'](_0x2760ce);}}),router[a0_0x326140(0x110)](a0_0x326140(0x133),auth,async(_0x2a0c06,_0x4dd923)=>{var _0x559754=a0_0x326140;try{const {username:_0x3e8248,email:_0x35ed5f,role:_0xafddbd}=_0x2a0c06[_0x559754(0x18f)],_0x2d0d01=_0x2a0c06[_0x559754(0x18f)],_0x5c21ee=await profile['findOne']({'email':_0x2d0d01[_0x559754(0x1c4)]}),_0xe1aea1=await master_shop[_0x559754(0x101)](),_0x28463b=await customer['find']({});let _0x3e8c8d;if(_0x2d0d01[_0x559754(0x121)]==_0x559754(0x163)){const _0x4385a9=await staff[_0x559754(0x1bb)]({'email':_0x2d0d01[_0x559754(0x1c4)]});_0x3e8c8d=await warehouse[_0x559754(0x141)]([{'$match':{'status':_0x559754(0x18e),'name':_0x4385a9[_0x559754(0x9e)]}},{'$group':{'_id':_0x559754(0x150),'name':{'$first':_0x559754(0x150)}}},{'$sort':{'name':0x1}}]);}else _0x3e8c8d=await warehouse[_0x559754(0x141)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x559754(0x150),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x18b554=await product[_0x559754(0x101)]({});var _0x4c1d87=[_0x559754(0xde),_0x559754(0x142)];const _0x9133f9=await sales_finished[_0x559754(0x101)]({}),_0x55139f=_0x9133f9[_0x559754(0x187)]+0x1,_0x94a48b=_0x559754(0x171)+_0x55139f[_0x559754(0x132)]()['padStart'](0x5,'0');if(_0xe1aea1[0x0][_0x559754(0x145)]=='English\x20(US)'){var _0x20c8ec=users[_0x559754(0x1a8)];console[_0x559754(0xfb)](_0x20c8ec);}else{if(_0xe1aea1[0x0][_0x559754(0x145)]==_0x559754(0xe1))var _0x20c8ec=users['Hindi'];else{if(_0xe1aea1[0x0][_0x559754(0x145)]==_0x559754(0x97))var _0x20c8ec=users['German'];else{if(_0xe1aea1[0x0][_0x559754(0x145)]==_0x559754(0xb2))var _0x20c8ec=users['Spanish'];else{if(_0xe1aea1[0x0][_0x559754(0x145)]=='French')var _0x20c8ec=users['French'];else{if(_0xe1aea1[0x0][_0x559754(0x145)]==_0x559754(0x1b2))var _0x20c8ec=users[_0x559754(0x16d)];else{if(_0xe1aea1[0x0]['language']=='Chinese')var _0x20c8ec=users[_0x559754(0xe7)];else{if(_0xe1aea1[0x0]['language']=='Arabic\x20(ae)')var _0x20c8ec=users[_0x559754(0xff)];}}}}}}}const _0x1471d9=getRandom8DigitNumber();_0x1471d9[_0x559754(0x9a)](_0x43e3e6=>{var _0x2e8fb4=_0x559754;_0x4dd923['render'](_0x2e8fb4(0xbf),{'success':_0x2a0c06[_0x2e8fb4(0x12e)](_0x2e8fb4(0x164)),'errors':_0x2a0c06[_0x2e8fb4(0x12e)](_0x2e8fb4(0x1de)),'role':_0x2d0d01,'profile':_0x5c21ee,'customer':_0x28463b,'warehouse':_0x3e8c8d,'product':_0x18b554,'invoice':_0x43e3e6,'master_shop':_0xe1aea1,'language':_0x20c8ec,'rooms_data':_0x4c1d87});})[_0x559754(0x1c7)](_0x35619b=>{var _0x336198=_0x559754;_0x2a0c06[_0x336198(0x12e)](_0x336198(0x1de),_0x336198(0x14e)),_0x4dd923[_0x336198(0xed)](_0x336198(0xb9));});}catch(_0xa03372){console[_0x559754(0xfb)](_0xa03372);}}),router['post']('/view/add_sales_logs',auth,async(_0x321432,_0x2af721)=>{var _0x3c0f0e=a0_0x326140;try{const {invoice:_0x547e99,date:_0x6739d6,warehouse_name:_0x16abb1,product_name:_0x33129b,note:_0x349982,room:_0x4cf4b8,primary_code:_0x4c8da4,secondary_code:_0x3de6c6,prod_code:_0x7740f0,SCRN:_0x6029e6,ReqBy:_0x19f6da,dateofreq:_0x5d9455,PO_number:_0x5a2047,typeservicesData:_0x1f5f37,typevehicle:_0x584f77,destination:_0x57e75e,deliverydate:_0x2856d7,driver:_0x64c27a,plate:_0x45c974,van:_0x1fb602,DRSI:_0x490b7a,TSU:_0x2e3960,TFU:_0x40d900,mode_transpo:_0x19d610,name_driver:_0x82f446,type_of_products:_0x1d715a}=_0x321432['body'];if(typeof _0x33129b==_0x3c0f0e(0x10f))var _0x412bcc=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0xf9)]],_0x326cde=[_0x321432[_0x3c0f0e(0xbe)]['stock']],_0x5376f9=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0xce)]],_0x3d49d1=[_0x321432[_0x3c0f0e(0xbe)]['primary_code']],_0x3ab88f=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x143)]],_0x14e331=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x192)]],_0x11277c=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0xd5)]],_0x1b24f4=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x1b7)]],_0x1a4314=[_0x321432[_0x3c0f0e(0xbe)]['secondary_unit']],_0x336884=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x104)]],_0x3e2cf0=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x94)]],_0x5873ab=[_0x321432[_0x3c0f0e(0xbe)]['product_date']],_0x3eeb17=[_0x321432['body'][_0x3c0f0e(0x1c3)]],_0x5bfe63=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x14b)]],_0x3d4fac=[_0x321432['body'][_0x3c0f0e(0xf4)]],_0x3f8ddf=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x175)]],_0x245ea7=[_0x321432['body'][_0x3c0f0e(0x17e)]],_0x168635=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x198)]],_0x383c33=[_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x191)]];else var _0x412bcc=[..._0x321432['body'][_0x3c0f0e(0xf9)]],_0x326cde=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x1a4)]],_0x5376f9=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0xce)]],_0x3d49d1=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x1ad)]],_0x3ab88f=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x143)]],_0x14e331=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x192)]],_0x11277c=[..._0x321432[_0x3c0f0e(0xbe)]['level2']],_0x1b24f4=[..._0x321432[_0x3c0f0e(0xbe)]['primary_unit']],_0x1a4314=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x13a)]],_0x336884=[..._0x321432['body'][_0x3c0f0e(0x104)]],_0x3e2cf0=[..._0x321432['body'][_0x3c0f0e(0x94)]],_0x5873ab=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x190)]],_0x3eeb17=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x1c3)]],_0x5bfe63=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x14b)]],_0x3d4fac=[..._0x321432['body']['RoomAssigned']],_0x3f8ddf=[..._0x321432[_0x3c0f0e(0xbe)]['prod_invoice']],_0x245ea7=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x17e)]],_0x168635=[..._0x321432['body']['uuid']],_0x383c33=[..._0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0x191)]];const _0x1e6aa7=_0x412bcc[_0x3c0f0e(0x17d)](_0x44c911=>{return _0x44c911={'product_name':_0x44c911};});_0x326cde[_0x3c0f0e(0x1b4)]((_0x5e00b0,_0x2fa4bf)=>{var _0x34d566=_0x3c0f0e;_0x1e6aa7[_0x2fa4bf][_0x34d566(0x1a4)]=_0x5e00b0;}),_0x5376f9[_0x3c0f0e(0x1b4)]((_0x3c3074,_0x56004f)=>{_0x1e6aa7[_0x56004f]['quantity']=Math['abs'](_0x3c3074);}),_0x412bcc[_0x3c0f0e(0x1b4)]((_0x2699d5,_0x46db69)=>{var _0x201095=_0x3c0f0e;_0x1e6aa7[_0x46db69]['agent_id']=_0x321432[_0x201095(0xbe)]['sales'];}),_0x383c33[_0x3c0f0e(0x1b4)]((_0x5963cf,_0x2dc33e)=>{var _0x4eab2e=_0x3c0f0e;_0x1e6aa7[_0x2dc33e][_0x4eab2e(0x191)]=_0x5963cf;}),_0x168635[_0x3c0f0e(0x1b4)]((_0x55409f,_0x520b09)=>{_0x1e6aa7[_0x520b09]['uuid']=_0x55409f;}),_0x245ea7[_0x3c0f0e(0x1b4)]((_0x1c68b2,_0x355ff4)=>{var _0x101020=_0x3c0f0e;_0x1e6aa7[_0x355ff4][_0x101020(0x17e)]=_0x1c68b2;}),_0x3d49d1['forEach']((_0xa7861e,_0x26f8ed)=>{var _0x59a820=_0x3c0f0e;_0x1e6aa7[_0x26f8ed][_0x59a820(0x1ad)]=_0xa7861e;}),_0x3ab88f[_0x3c0f0e(0x1b4)]((_0x19f6fd,_0x496156)=>{var _0x207670=_0x3c0f0e;_0x1e6aa7[_0x496156][_0x207670(0x143)]=_0x19f6fd;}),_0x14e331[_0x3c0f0e(0x1b4)]((_0x2a11d9,_0xc006a8)=>{var _0x132ede=_0x3c0f0e;_0x1e6aa7[_0xc006a8][_0x132ede(0x1d4)]=_0x2a11d9;}),_0x11277c['forEach']((_0x59b8a0,_0x41b8ab)=>{var _0x57daf0=_0x3c0f0e,_0x1de230=_0x59b8a0[_0x57daf0(0xf1)](/[A-Za-z]+/)[0x0],_0x293ce4=parseInt(_0x59b8a0[_0x57daf0(0xf1)](/\d+/)[0x0]);_0x1e6aa7[_0x41b8ab][_0x57daf0(0x1bf)]=_0x293ce4,_0x1e6aa7[_0x41b8ab][_0x57daf0(0x15a)]=_0x1de230;}),_0x1b24f4[_0x3c0f0e(0x1b4)]((_0x367fbf,_0x3a3196)=>{var _0x47a287=_0x3c0f0e;_0x1e6aa7[_0x3a3196][_0x47a287(0x17c)]=_0x367fbf;}),_0x1a4314[_0x3c0f0e(0x1b4)]((_0x1b2594,_0x300f47)=>{_0x1e6aa7[_0x300f47]['secondary_unit']=_0x1b2594;}),_0x336884['forEach']((_0x204190,_0x7e646)=>{var _0x1a63b1=_0x3c0f0e;_0x1e6aa7[_0x7e646][_0x1a63b1(0x104)]=_0x204190;}),_0x3e2cf0[_0x3c0f0e(0x1b4)]((_0x4ecd09,_0x31fee6)=>{_0x1e6aa7[_0x31fee6]['expiry_date']=_0x4ecd09;}),_0x5873ab[_0x3c0f0e(0x1b4)]((_0xc5d911,_0x9ce49f)=>{var _0x20f095=_0x3c0f0e;_0x1e6aa7[_0x9ce49f][_0x20f095(0xf3)]=_0xc5d911;}),_0x3eeb17[_0x3c0f0e(0x1b4)]((_0x3d178b,_0x3104c0)=>{_0x1e6aa7[_0x3104c0]['maxperunit']=_0x3d178b;}),_0x5bfe63[_0x3c0f0e(0x1b4)]((_0x38d28b,_0x31591f)=>{_0x1e6aa7[_0x31591f]['prod_cat']=_0x38d28b;}),_0x3d4fac[_0x3c0f0e(0x1b4)]((_0x58b294,_0x134e3c)=>{_0x1e6aa7[_0x134e3c]['room_name']=_0x58b294;}),_0x3f8ddf[_0x3c0f0e(0x1b4)]((_0x15af30,_0x367f04)=>{var _0x356135=_0x3c0f0e;_0x1e6aa7[_0x367f04]['invoice']=_0x15af30,_0x1e6aa7[_0x367f04][_0x356135(0x125)]=_0x6739d6;});const _0x16ae93=new sales_logs();await _0x16ae93[_0x3c0f0e(0x1c0)](),_0x3f8ddf[_0x3c0f0e(0x1b4)]((_0x33f61b,_0x5c5826)=>{var _0x3d1480=_0x3c0f0e;_0x1e6aa7[_0x5c5826][_0x3d1480(0x162)]=_0x3d1480(0x176)+_0x16ae93[_0x3d1480(0x177)]['toString']()[_0x3d1480(0x1dc)](0x8,'0');});var _0x39ab51=0x0;_0x1e6aa7[_0x3c0f0e(0x1b4)](_0x4b8e07=>{var _0x230f25=_0x3c0f0e;parseFloat(_0x4b8e07[_0x230f25(0x1a4)])<parseFloat(_0x4b8e07[_0x230f25(0xd0)])&&parseFloat(_0x4b8e07['quantity'])>parseFloat(_0x4b8e07['stock'])&&(console['log'](_0x4b8e07['stock']+_0x230f25(0x129)+_0x4b8e07['quantity']),_0x39ab51++);});if(_0x39ab51!=0x0)return _0x321432['flash']('errors',_0x3c0f0e(0xdb)),_0x2af721[_0x3c0f0e(0xed)](_0x3c0f0e(0x13d));const _0x2be642=_0x1e6aa7['filter'](_0x31a4ee=>_0x31a4ee[_0x3c0f0e(0xd0)]!=='0'&&_0x31a4ee[_0x3c0f0e(0xd0)]!==''),_0x214bac=new sales_finished({'invoice':_0x3c0f0e(0x176)+_0x16ae93['invoice_init']['toString']()['padStart'](0x8,'0'),'sales_data':_0x321432[_0x3c0f0e(0xbe)][_0x3c0f0e(0xa3)],'customer':_0x321432[_0x3c0f0e(0xbe)]['customer'],'date':_0x6739d6,'warehouse_name':_0x16abb1,'sale_product':_0x2be642,'note':_0x349982,'room':_0x4cf4b8,'primary_code':_0x4c8da4,'secondary_code':_0x3de6c6,'prod_code':_0x7740f0,'SCRN':_0x6029e6,'finalize':_0x3c0f0e(0x155),'mode_transpo':_0x19d610,'name_driver':_0x82f446,'ReqBy':_0x19f6da,'dateofreq':_0x5d9455,'PO_number':_0x5a2047,'typeservicesData':_0x1f5f37,'typevehicle':_0x584f77,'destination':_0x57e75e,'deliverydate':_0x2856d7,'driver':_0x64c27a,'plate':_0x45c974,'van':_0x1fb602,'DRSI':_0x490b7a,'TSU':_0x2e3960,'TFU':_0x40d900,'typeOfProducts':_0x1d715a}),_0x460d29=await _0x214bac['save'](),_0x2cdba0=await sales_finished['findOne']({'invoice':_0x547e99});_0x321432[_0x3c0f0e(0x12e)](_0x3c0f0e(0x164),'Sales\x20Add\x20successfully'),_0x2af721[_0x3c0f0e(0xed)](_0x3c0f0e(0x149)+_0x460d29[_0x3c0f0e(0xd6)]);}catch(_0x52acd1){console[_0x3c0f0e(0xfb)](_0x52acd1);}}),router[a0_0x326140(0x110)](a0_0x326140(0x130),auth,async(_0x450789,_0x513912)=>{var _0x338edc=a0_0x326140;try{const _0x20f7c0=_0x450789[_0x338edc(0x17b)]['id'];console['log'](_0x20f7c0);const _0x23445a=await product[_0x338edc(0x101)](),_0x2038ea=await purchases[_0x338edc(0x141)]([{'$match':{'warehouse_name':_0x20f7c0}},{'$unwind':_0x338edc(0xc0)},{'$group':{'_id':_0x338edc(0x123)}}]);console[_0x338edc(0xfb)](_0x338edc(0xc1),_0x2038ea),_0x513912[_0x338edc(0xc8)](0xc8)[_0x338edc(0x16c)]({'purchases_data':_0x2038ea,'product_data':_0x23445a});}catch(_0x496672){console[_0x338edc(0xfb)](_0x496672);}}),router['post'](a0_0x326140(0x18a),auth,async(_0x2635b7,_0x2a37a2)=>{var _0x691d06=a0_0x326140;try{const {warehouse_data:_0x26298a,product_data:_0x2f0b61}=_0x2635b7[_0x691d06(0xbe)];console[_0x691d06(0xfb)](_0x2635b7['body'][_0x691d06(0x9c)]);;const _0x1a537e=await master_shop['find']();console[_0x691d06(0xfb)](_0x691d06(0x17a),_0x1a537e);const _0x2c0bf1=await product['findOne']({'name':_0x2f0b61});console[_0x691d06(0xfb)](_0x691d06(0xe3),_0x2c0bf1);const _0x1c9d87=await warehouse[_0x691d06(0x141)]([{'$match':{'name':_0x26298a}},{'$unwind':_0x691d06(0x181)},{'$match':{'product_details.product_name':_0x2f0b61}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x691d06(0xaa)}}}]);console['log'](_0x691d06(0xaf),_0x1c9d87),_0x2a37a2[_0x691d06(0xc8)](0xc8)[_0x691d06(0x16c)]({'master':_0x1a537e,'new_product':_0x2c0bf1,'stock_data':_0x1c9d87});}catch(_0x421b71){console['log'](_0x421b71);}}),router[a0_0x326140(0xee)]('/view/add_sales',auth,async(_0x2c09d1,_0x50233b)=>{var _0x1808da=a0_0x326140;try{const {invoice:_0x201acf,date:_0xb29aed,warehouse_name:_0x54d98f,product_name:_0x17e92c,note:_0x196d15,room:_0x4a7133,primary_code:_0x1a66a5,secondary_code:_0x43bd58,prod_code:_0x4b853a,SCRN:_0x10de88,ReqBy:_0x1f0ace,dateofreq:_0x4b44a1,PO_number:_0x49f07b,typeservicesData:_0x161bb6,typevehicle:_0x5b24de,destination:_0x52a735,deliverydate:_0x4f9a85,driver:_0x3ad98c,plate:_0x4f4d5d,van:_0x3e899e,DRSI:_0x3ad33f,TSU:_0xe4356d,TFU:_0x43aea3,mode_transpo:_0x1a1433,name_driver:_0x82338b,pull_out_date:_0x33f3d3,actual_delivery_date:_0xe5e9c4}=_0x2c09d1[_0x1808da(0xbe)];_0x50233b['json'](_0x2c09d1[_0x1808da(0xbe)]);return;if(typeof _0x17e92c=='string')var _0x682912=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0xf9)]],_0x5eac73=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x1a4)]],_0x46a4a6=[_0x2c09d1['body'][_0x1808da(0xce)]],_0xf30b62=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x1ad)]],_0x43ea56=[_0x2c09d1[_0x1808da(0xbe)]['secondary_code']],_0x2d67bd=[_0x2c09d1['body'][_0x1808da(0x192)]],_0x4ab8c8=[_0x2c09d1['body']['level2']],_0x59ec36=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x1b7)]],_0xac8760=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x13a)]],_0x142ff1=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x104)]],_0x403248=[_0x2c09d1['body']['expiry_date']],_0x2f6895=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x190)]],_0x5912e0=[_0x2c09d1[_0x1808da(0xbe)]['max_per_unit']],_0x5958bf=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x14b)]],_0x5c9d76=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0xf4)]],_0x310eff=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x175)]],_0x209e9c=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x17e)]],_0x4605d1=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x198)]],_0x3f768b=[_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x191)]];else var _0x682912=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0xf9)]],_0x5eac73=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x1a4)]],_0x46a4a6=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0xce)]],_0xf30b62=[..._0x2c09d1['body'][_0x1808da(0x1ad)]],_0x43ea56=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x143)]],_0x2d67bd=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x192)]],_0x4ab8c8=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0xd5)]],_0x59ec36=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x1b7)]],_0xac8760=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x13a)]],_0x142ff1=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x104)]],_0x403248=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x94)]],_0x2f6895=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x190)]],_0x5912e0=[..._0x2c09d1['body'][_0x1808da(0x1c3)]],_0x5958bf=[..._0x2c09d1[_0x1808da(0xbe)]['prod_cat']],_0x5c9d76=[..._0x2c09d1['body'][_0x1808da(0xf4)]],_0x310eff=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x175)]],_0x209e9c=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x17e)]],_0x4605d1=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x198)]],_0x3f768b=[..._0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x191)]];const _0x46d332=_0x682912[_0x1808da(0x17d)](_0x2db574=>{return _0x2db574={'product_name':_0x2db574};});_0x5eac73['forEach']((_0x25ec22,_0x426e4d)=>{var _0x4a2272=_0x1808da;_0x46d332[_0x426e4d][_0x4a2272(0x1a4)]=_0x25ec22;}),_0x46a4a6[_0x1808da(0x1b4)]((_0x3dd8a9,_0x494f9f)=>{var _0x32bfaa=_0x1808da;_0x46d332[_0x494f9f][_0x32bfaa(0xd0)]=Math[_0x32bfaa(0x122)](_0x3dd8a9);}),_0x682912[_0x1808da(0x1b4)]((_0x2c0217,_0x51e061)=>{var _0x510192=_0x1808da;_0x46d332[_0x51e061][_0x510192(0x100)]=_0x2c09d1[_0x510192(0xbe)][_0x510192(0xa3)];}),_0x3f768b[_0x1808da(0x1b4)]((_0x2ff8f7,_0xb6dcbf)=>{var _0x3a6685=_0x1808da;_0x46d332[_0xb6dcbf][_0x3a6685(0x191)]=_0x2ff8f7;}),_0x4605d1[_0x1808da(0x1b4)]((_0x2e4589,_0x5b510d)=>{var _0x40e797=_0x1808da;_0x46d332[_0x5b510d][_0x40e797(0x198)]=_0x2e4589;}),_0x209e9c['forEach']((_0x39f36b,_0x19155c)=>{var _0x50ff23=_0x1808da;_0x46d332[_0x19155c][_0x50ff23(0x17e)]=_0x39f36b;}),_0xf30b62[_0x1808da(0x1b4)]((_0x519ca4,_0x731999)=>{var _0x333830=_0x1808da;_0x46d332[_0x731999][_0x333830(0x1ad)]=_0x519ca4;}),_0x43ea56['forEach']((_0x2508b0,_0x37be87)=>{var _0x3a0e33=_0x1808da;_0x46d332[_0x37be87][_0x3a0e33(0x143)]=_0x2508b0;}),_0x2d67bd[_0x1808da(0x1b4)]((_0x5750c0,_0x228c4e)=>{var _0x18d211=_0x1808da;_0x46d332[_0x228c4e][_0x18d211(0x1d4)]=_0x5750c0;}),_0x4ab8c8[_0x1808da(0x1b4)]((_0x16835e,_0x40b716)=>{var _0x105db4=_0x1808da,_0x51000d=_0x16835e['match'](/[A-Za-z]+/)[0x0],_0x43e400=parseInt(_0x16835e[_0x105db4(0xf1)](/\d+/)[0x0]);_0x46d332[_0x40b716][_0x105db4(0x1bf)]=_0x43e400,_0x46d332[_0x40b716]['level']=_0x51000d;}),_0x59ec36[_0x1808da(0x1b4)]((_0x8f01ec,_0x250904)=>{_0x46d332[_0x250904]['unit']=_0x8f01ec;}),_0xac8760[_0x1808da(0x1b4)]((_0x15cf07,_0x4f54f3)=>{var _0x43a528=_0x1808da;_0x46d332[_0x4f54f3][_0x43a528(0x13a)]=_0x15cf07;}),_0x142ff1['forEach']((_0x35da0b,_0x84dc71)=>{var _0x5c0ab3=_0x1808da;_0x46d332[_0x84dc71][_0x5c0ab3(0x104)]=_0x35da0b;}),_0x403248[_0x1808da(0x1b4)]((_0x2b5c20,_0x11eff8)=>{var _0x38857a=_0x1808da;_0x46d332[_0x11eff8][_0x38857a(0x94)]=_0x2b5c20;}),_0x2f6895[_0x1808da(0x1b4)]((_0x3fc1b9,_0x5dbe11)=>{var _0x1d0f77=_0x1808da;_0x46d332[_0x5dbe11][_0x1d0f77(0xf3)]=_0x3fc1b9;}),_0x5912e0['forEach']((_0x1bf220,_0x540f34)=>{var _0x56d3a8=_0x1808da;_0x46d332[_0x540f34][_0x56d3a8(0x9b)]=_0x1bf220;}),_0x5958bf[_0x1808da(0x1b4)]((_0x3086ef,_0x39e68b)=>{var _0x198599=_0x1808da;_0x46d332[_0x39e68b][_0x198599(0x14b)]=_0x3086ef;}),_0x5c9d76[_0x1808da(0x1b4)]((_0x74b7a5,_0x42a60b)=>{var _0x5db779=_0x1808da;_0x46d332[_0x42a60b][_0x5db779(0xf8)]=_0x74b7a5;}),_0x310eff['forEach']((_0x2f95e4,_0x4a7179)=>{var _0xe995d=_0x1808da;_0x46d332[_0x4a7179][_0xe995d(0x1a7)]=_0x2f95e4,_0x46d332[_0x4a7179]['date_data']=_0xb29aed;});const _0x427644=new invoice_for_outgoing();await _0x427644[_0x1808da(0x1c0)](),_0x310eff['forEach']((_0x19885f,_0x1d69aa)=>{var _0x397140=_0x1808da;_0x46d332[_0x1d69aa][_0x397140(0x162)]=_0x397140(0x11e)+_0x427644[_0x397140(0x177)]['toString']()[_0x397140(0x1dc)](0x8,'0');});var _0x2b48c4=0x0;_0x46d332['forEach'](_0x414c70=>{var _0x454d04=_0x1808da;parseFloat(_0x414c70['stock'])<parseFloat(_0x414c70[_0x454d04(0xd0)])&&parseFloat(_0x414c70[_0x454d04(0xd0)])>parseFloat(_0x414c70['stock'])&&(console[_0x454d04(0xfb)](_0x414c70[_0x454d04(0x1a4)]+_0x454d04(0x129)+_0x414c70[_0x454d04(0xd0)]),_0x2b48c4++);});if(_0x2b48c4!=0x0)return _0x2c09d1[_0x1808da(0x12e)](_0x1808da(0x1de),_0x1808da(0xdb)),_0x50233b[_0x1808da(0xed)](_0x1808da(0x13d));const _0x5f3d83=_0x46d332[_0x1808da(0x111)](_0x87a11b=>_0x87a11b['quantity']!=='0'&&_0x87a11b[_0x1808da(0xd0)]!==''),_0x3973d3=new sales_finished({'invoice':_0x1808da(0x11e)+_0x427644[_0x1808da(0x177)][_0x1808da(0x132)]()['padStart'](0x8,'0'),'sales_data':_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0xa3)],'customer':_0x2c09d1[_0x1808da(0xbe)][_0x1808da(0x118)],'date':_0xb29aed,'warehouse_name':_0x54d98f,'sale_product':_0x5f3d83,'note':_0x196d15,'room':_0x4a7133,'primary_code':_0x1a66a5,'secondary_code':_0x43bd58,'prod_code':_0x4b853a,'SCRN':_0x10de88,'finalize':'False','mode_transpo':_0x1a1433,'name_driver':_0x82338b,'ReqBy':_0x1f0ace,'dateofreq':_0x4b44a1,'PO_number':_0x49f07b,'typeservicesData':_0x161bb6,'typevehicle':_0x5b24de,'destination':_0x52a735,'deliverydate':_0x4f9a85,'driver':_0x3ad98c,'plate':_0x4f4d5d,'van':_0x3e899e,'DRSI':_0x3ad33f,'TSU':_0xe4356d,'TFU':_0x43aea3,'pullout_date':_0x33f3d3,'actualdelivery_date':_0xe5e9c4,'typeOfProducts':_0x1808da(0x19c)}),_0x57a809=await _0x3973d3[_0x1808da(0x1c0)](),_0x5a95f1=await sales_finished['findOne']({'invoice':_0x201acf});_0x2c09d1[_0x1808da(0x12e)](_0x1808da(0x164),'Sales\x20Add\x20successfully'),_0x50233b[_0x1808da(0xed)](_0x1808da(0x149)+_0x57a809[_0x1808da(0xd6)]);}catch(_0x5c5e51){console['log'](_0x5c5e51);}}),router['get'](a0_0x326140(0x1b3),auth,async(_0x63882c,_0x2cdfca)=>{var _0x418e53=a0_0x326140;try{const {username:_0x332d5c,email:_0x14dd17,role:_0x59ed58}=_0x63882c[_0x418e53(0x18f)],_0x38dda1=_0x63882c[_0x418e53(0x18f)],_0x2cd05c=await profile[_0x418e53(0x1bb)]({'email':_0x38dda1[_0x418e53(0x1c4)]}),_0x19d65b=await master_shop['find'](),_0x17d799=_0x63882c['params']['id'],_0x4e4b37=await sales_finished['findById'](_0x17d799),_0x162f24=await warehouse['aggregate']([{'$match':{'name':_0x4e4b37[_0x418e53(0x115)]}},{'$unwind':_0x418e53(0x181)},{'$group':{'_id':_0x418e53(0x19e),'name':{'$first':_0x418e53(0xe5)},'product_stock':{'$first':_0x418e53(0xaa)},'bay':{'$first':_0x418e53(0x19b)},'bin':{'$first':_0x418e53(0x154)},'type':{'$first':_0x418e53(0x16b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x418e53(0xfc)},'rack':{'$first':_0x418e53(0x1db)},'expiry_date':{'$first':_0x418e53(0xf6)},'production_date':{'$first':_0x418e53(0x172)},'batch_code':{'$first':_0x418e53(0xf2)},'room':{'$first':'$room'},'room_data':{'$first':_0x418e53(0x120)}}}]),_0x4a68da=await customer[_0x418e53(0x101)]({});let _0x2ecc5a;if(_0x38dda1[_0x418e53(0x121)]==_0x418e53(0x163)){const _0x280504=await staff[_0x418e53(0x1bb)]({'email':_0x38dda1[_0x418e53(0x1c4)]});_0x2ecc5a=await warehouse[_0x418e53(0x141)]([{'$match':{'status':_0x418e53(0x18e),'name':_0x280504[_0x418e53(0x9e)]}},{'$group':{'_id':_0x418e53(0x150),'name':{'$first':_0x418e53(0x150)}}}]);}else _0x2ecc5a=await warehouse[_0x418e53(0x141)]([{'$match':{'status':_0x418e53(0x18e)}},{'$group':{'_id':_0x418e53(0x150),'name':{'$first':_0x418e53(0x150)}}}]);const _0x56a764=await product['find']({});if(_0x19d65b[0x0][_0x418e53(0x145)]==_0x418e53(0x1ca)){var _0x28b021=users[_0x418e53(0x1a8)];console[_0x418e53(0xfb)](_0x28b021);}else{if(_0x19d65b[0x0][_0x418e53(0x145)]==_0x418e53(0xe1))var _0x28b021=users[_0x418e53(0xe1)];else{if(_0x19d65b[0x0][_0x418e53(0x145)]=='German')var _0x28b021=users[_0x418e53(0x97)];else{if(_0x19d65b[0x0][_0x418e53(0x145)]==_0x418e53(0xb2))var _0x28b021=users[_0x418e53(0xb2)];else{if(_0x19d65b[0x0]['language']==_0x418e53(0xa8))var _0x28b021=users[_0x418e53(0xa8)];else{if(_0x19d65b[0x0][_0x418e53(0x145)]==_0x418e53(0x1b2))var _0x28b021=users[_0x418e53(0x16d)];else{if(_0x19d65b[0x0][_0x418e53(0x145)]=='Chinese')var _0x28b021=users[_0x418e53(0xe7)];else{if(_0x19d65b[0x0][_0x418e53(0x145)]==_0x418e53(0x1c5))var _0x28b021=users[_0x418e53(0xff)];}}}}}}}_0x2cdfca[_0x418e53(0x131)]('edit_sales_finished_view',{'success':_0x63882c[_0x418e53(0x12e)]('success'),'errors':_0x63882c['flash']('errors'),'role':_0x38dda1,'profile':_0x2cd05c,'customer':_0x4a68da,'warehouse':_0x2ecc5a,'product':_0x162f24,'user':_0x4e4b37,'master_shop':_0x19d65b,'unit':_0x56a764,'language':_0x28b021});}catch(_0x2c3dae){console[_0x418e53(0xfb)](_0x2c3dae);}});async function dataUpdate(_0x52ff61,_0x1017a8,_0x1ea27a){var _0x8397b1=a0_0x326140;return await warehouse[_0x8397b1(0xb0)]({'_id':_0x52ff61,'product_details._id':_0x1017a8},{'$set':{'product_details.$.product_stock':_0x1ea27a}}),await warehouse[_0x8397b1(0x1d5)](_0x52ff61);}router[a0_0x326140(0xee)](a0_0x326140(0x1b3),auth,async(_0x20018f,_0x43bc39)=>{var _0x57a9fc=a0_0x326140;try{const _0x33cd8f=_0x20018f['params']['id'],{invoice:_0x59084b,warehouse_name:_0x3caa82,room:_0x2db4ec}=_0x20018f['body'],_0x373058=await sales_finished['findOne']({'invoice':_0x59084b});for(let _0x5db731=0x0;_0x5db731<=_0x373058['sale_product']['length']-0x1;_0x5db731++){const _0x43dfb8=_0x373058[_0x57a9fc(0xf0)][_0x5db731];var _0x205490=await warehouse[_0x57a9fc(0x1bb)]({'name':_0x3caa82,'room':_0x43dfb8[_0x57a9fc(0xf8)]}),_0x3c9183=0x0;for(let _0x4acf9b=0x0;_0x4acf9b<=_0x205490[_0x57a9fc(0xae)][_0x57a9fc(0x187)]-0x1;_0x4acf9b++){const _0x56beca=_0x205490['product_details'][_0x4acf9b];_0x56beca['_id']==_0x43dfb8[_0x57a9fc(0x17e)]&&_0x56beca[_0x57a9fc(0x198)]==_0x43dfb8[_0x57a9fc(0x198)]&&(_0x3c9183=Math[_0x57a9fc(0xc4)](0x0,Math[_0x57a9fc(0x122)](_0x56beca['product_stock'])-Math[_0x57a9fc(0x122)](_0x43dfb8[_0x57a9fc(0xd0)])),await warehouse[_0x57a9fc(0xb0)]({'_id':_0x205490[_0x57a9fc(0xd6)][_0x57a9fc(0x11f)](),'product_details._id':_0x56beca[_0x57a9fc(0xd6)][_0x57a9fc(0x11f)](),'product_details.uuid':_0x43dfb8[_0x57a9fc(0x198)]},{'$set':{'product_details.$.product_stock':_0x3c9183}}));}console[_0x57a9fc(0xfb)](typeof _0x43dfb8[_0x57a9fc(0x100)]);if(typeof _0x43dfb8[_0x57a9fc(0x100)]!=='undefined'){var _0x2d43d9=await staff[_0x57a9fc(0x1d5)](_0x43dfb8[_0x57a9fc(0x100)]);console['log'](_0x57a9fc(0xa2));var _0x10b7ba=0x0;for(let _0x524c90=0x0;_0x524c90<=_0x2d43d9[_0x57a9fc(0x15d)][_0x57a9fc(0x187)]-0x1;_0x524c90++){const _0x4a388e=_0x2d43d9['product_list'][_0x524c90];console[_0x57a9fc(0xfb)](_0x43dfb8[_0x57a9fc(0x17e)]+_0x57a9fc(0x1c1)+_0x4a388e[_0x57a9fc(0xa9)]+_0x57a9fc(0x1d0)+_0x43dfb8[_0x57a9fc(0xd6)]+_0x57a9fc(0x1c1)+_0x43dfb8[_0x57a9fc(0xd6)]),_0x43dfb8[_0x57a9fc(0x17e)]==_0x4a388e['warehouse_id']&&_0x43dfb8[_0x57a9fc(0xd6)]==0x1&&(_0x4a388e[_0x57a9fc(0xb7)]=Math[_0x57a9fc(0x122)](_0x4a388e[_0x57a9fc(0xb7)])+Math[_0x57a9fc(0x122)](_0x43dfb8[_0x57a9fc(0xd0)]),_0x10b7ba++);}console['log'](_0x57a9fc(0x16e),_0x10b7ba),_0x10b7ba=='0'&&(_0x2d43d9[_0x57a9fc(0x15d)]=_0x2d43d9[_0x57a9fc(0x15d)][_0x57a9fc(0x160)]({'product_name':_0x43dfb8[_0x57a9fc(0xf9)],'product_stock':_0x43dfb8[_0x57a9fc(0xd0)],'bay':_0x43dfb8[_0x57a9fc(0x1bf)],'level':_0x43dfb8[_0x57a9fc(0x15a)],'product_code':_0x43dfb8['product_code'],'primary_code':_0x43dfb8['primary_code'],'secondary_code':_0x43dfb8[_0x57a9fc(0x143)],'expiry_date':_0x43dfb8[_0x57a9fc(0x94)],'production_date':_0x43dfb8[_0x57a9fc(0xf3)],'maxProducts':_0x43dfb8[_0x57a9fc(0x173)],'batch_code':_0x43dfb8[_0x57a9fc(0x104)],'secondary_unit':_0x43dfb8[_0x57a9fc(0x13a)],'unit':_0x43dfb8[_0x57a9fc(0x17c)],'maxProducts':_0x43dfb8[_0x57a9fc(0x173)],'maxPerUnit':_0x43dfb8[_0x57a9fc(0x9b)],'invoice':_0x43dfb8['invoice'],'warehouse_id':_0x43dfb8[_0x57a9fc(0x17e)],'id_incoming':_0x43dfb8[_0x57a9fc(0xd6)],'uuid':_0x43dfb8['uuid'],'gross_price':_0x43dfb8[_0x57a9fc(0x191)],'date_incoming':_0x43dfb8['date_data'],'outgoing_invoice':_0x43dfb8['outgoing_invoice']}),await _0x2d43d9[_0x57a9fc(0x1c0)]());}}_0x373058['finalize']=_0x57a9fc(0x199);const _0xff54cf=await _0x373058[_0x57a9fc(0x1c0)](),_0x3f2129=await master_shop['find'](),_0x61e32d=await email_settings[_0x57a9fc(0x1bb)](),_0x5bd33c=await supervisor_settings[_0x57a9fc(0x101)]();var _0x469ef4=_0x373058['sale_product'],_0x1b8161='',_0x20818b;for(_0x20818b in _0x469ef4){_0x1b8161+=_0x57a9fc(0xcd)+_0x57a9fc(0x1d6)+_0x469ef4[_0x20818b]['product_name']+_0x57a9fc(0x1ba)+_0x57a9fc(0x1d6)+_0x469ef4[_0x20818b][_0x57a9fc(0x1d4)]+_0x57a9fc(0x1ba)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x469ef4[_0x20818b][_0x57a9fc(0xd0)]+_0x57a9fc(0x1ba)+_0x57a9fc(0x1d6)+_0x469ef4[_0x20818b]['unit']+_0x57a9fc(0x1ba)+_0x57a9fc(0x1d6)+_0x469ef4[_0x20818b]['secondary_unit']+_0x57a9fc(0x1ba)+_0x57a9fc(0x1d6)+_0x373058[_0x57a9fc(0x115)]+_0x57a9fc(0x1ba)+_0x57a9fc(0x1d6)+_0x469ef4[_0x20818b][_0x57a9fc(0xf8)]+_0x57a9fc(0x1ba)+_0x57a9fc(0x1d6)+_0x469ef4[_0x20818b][_0x57a9fc(0x1bf)]+_0x57a9fc(0x1ba);}_0x20018f[_0x57a9fc(0x12e)]('success',_0x57a9fc(0xc7)),_0x43bc39['redirect'](_0x57a9fc(0xcb)+_0x33cd8f);}catch(_0x2eeffc){console[_0x57a9fc(0xfb)](_0x2eeffc);}}),router[a0_0x326140(0x110)](a0_0x326140(0xd7),auth,async(_0x24ef80,_0xd83541)=>{var _0x1b7360=a0_0x326140;try{const {username:_0x82ad9c,email:_0x3d665e,role:_0x34913b}=_0x24ef80[_0x1b7360(0x18f)],_0x31e165=_0x24ef80[_0x1b7360(0x18f)],_0xd5ef2b=await profile[_0x1b7360(0x1bb)]({'email':_0x31e165['email']}),_0x176174=await master_shop['find'](),_0x321c24=_0x24ef80['params']['id'],_0x4ac916=await sales_finished[_0x1b7360(0x1d5)](_0x321c24);let _0x21eab9=new Date(_0x4ac916[_0x1b7360(0x94)]),_0x14c7ce=('0'+_0x21eab9['getDate']())[_0x1b7360(0xa4)](-0x2),_0x5ebb2d=('0'+(_0x21eab9['getMonth']()+0x1))['slice'](-0x2),_0x43aec1=_0x21eab9[_0x1b7360(0x139)](),_0x151f9d=_0x43aec1+'-'+_0x5ebb2d+'-'+_0x14c7ce;var _0x2a133f=[_0x1b7360(0xde),_0x1b7360(0x142)];const _0x43e6e3=await warehouse[_0x1b7360(0x141)]([{'$match':{'name':_0x4ac916[_0x1b7360(0x115)],'room':_0x4ac916['room']}},{'$unwind':_0x1b7360(0x181)},{'$group':{'_id':_0x1b7360(0x19e),'name':{'$first':_0x1b7360(0xe5)},'product_stock':{'$first':_0x1b7360(0xaa)},'bay':{'$first':_0x1b7360(0x19b)},'bin':{'$first':_0x1b7360(0x154)},'type':{'$first':_0x1b7360(0x16b)},'floorlevel':{'$first':_0x1b7360(0x117)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1b7360(0xfd)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1b7360(0x1db)}}}]),_0x4956a8=await customer[_0x1b7360(0x101)]({});let _0x1cb025;if(_0x31e165[_0x1b7360(0x121)]=='staff'){const _0xfd13dc=await staff[_0x1b7360(0x1bb)]({'email':_0x31e165[_0x1b7360(0x1c4)]});_0x1cb025=await warehouse[_0x1b7360(0x141)]([{'$match':{'status':'Enabled','name':_0xfd13dc['warehouse']}},{'$group':{'_id':_0x1b7360(0x150),'name':{'$first':_0x1b7360(0x150)}}}]);}else _0x1cb025=await warehouse[_0x1b7360(0x141)]([{'$match':{'status':_0x1b7360(0x18e)}},{'$group':{'_id':_0x1b7360(0x150),'name':{'$first':_0x1b7360(0x150)}}}]);const _0x1b6c02=await product['find']({});if(_0x176174[0x0][_0x1b7360(0x145)]==_0x1b7360(0x1ca)){var _0x13139f=users['English'];console[_0x1b7360(0xfb)](_0x13139f);}else{if(_0x176174[0x0][_0x1b7360(0x145)]=='Hindi')var _0x13139f=users[_0x1b7360(0xe1)];else{if(_0x176174[0x0][_0x1b7360(0x145)]==_0x1b7360(0x97))var _0x13139f=users['German'];else{if(_0x176174[0x0][_0x1b7360(0x145)]=='Spanish')var _0x13139f=users[_0x1b7360(0xb2)];else{if(_0x176174[0x0][_0x1b7360(0x145)]=='French')var _0x13139f=users[_0x1b7360(0xa8)];else{if(_0x176174[0x0][_0x1b7360(0x145)]==_0x1b7360(0x1b2))var _0x13139f=users[_0x1b7360(0x16d)];else{if(_0x176174[0x0]['language']==_0x1b7360(0xe7))var _0x13139f=users[_0x1b7360(0xe7)];else{if(_0x176174[0x0][_0x1b7360(0x145)]==_0x1b7360(0x1c5))var _0x13139f=users['Arabic'];}}}}}}}_0xd83541[_0x1b7360(0x131)](_0x1b7360(0x168),{'success':_0x24ef80['flash'](_0x1b7360(0x164)),'errors':_0x24ef80[_0x1b7360(0x12e)](_0x1b7360(0x1de)),'role':_0x31e165,'profile':_0xd5ef2b,'customer':_0x4956a8,'warehouse':_0x1cb025,'product':_0x43e6e3,'user':_0x4ac916,'master_shop':_0x176174,'unit':_0x1b6c02,'language':_0x13139f,'rooms_data':_0x2a133f,'ed_fullDate':_0x151f9d});}catch(_0x181138){console[_0x1b7360(0xfb)](_0x181138);}}),router[a0_0x326140(0xee)]('/view/:id',auth,async(_0x4dfd56,_0x1e596b)=>{var _0x55f7fc=a0_0x326140;try{const _0x2c12c5=_0x4dfd56['params']['id'],_0x5283c5=await sales_finished[_0x55f7fc(0x1bb)]({'_id':_0x4dfd56[_0x55f7fc(0x17b)]['id']}),_0x51762c=await warehouse[_0x55f7fc(0x1bb)]({'name':_0x5283c5[_0x55f7fc(0x115)],'room':_0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0xd2)],'warehouse_category':_0x55f7fc(0x1be)}),{invoice:_0x4c2427,customer:_0x1a4577,date:_0xc96b4f,warehouse_name:_0x44366d,product_name:_0x1b3663,stock:_0x483949,adjust_qty:_0x9bc8a5,note:_0x1fe6db,room:_0x132498,primary_code:_0x20dcf6,secondary_code:_0x437170,prod_code:_0x2e78aa,level:_0x241ef6,isle:_0x5a1916,pallet:_0x5e14b0,expiry_date:_0x535698}=_0x4dfd56[_0x55f7fc(0xbe)];if(typeof _0x1b3663==_0x55f7fc(0x10f))var _0x5c3450=[_0x4dfd56['body'][_0x55f7fc(0xf9)]],_0x3d820a=[_0x4dfd56[_0x55f7fc(0xbe)]['stock']],_0x5d4edc=[_0x4dfd56['body'][_0x55f7fc(0x96)]],_0x242c52=[_0x4dfd56[_0x55f7fc(0xbe)]['primary_code']],_0x54266f=[_0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0x143)]],_0x5eee0a=[_0x4dfd56['body'][_0x55f7fc(0x192)]],_0x4c446b=[_0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0x15a)]],_0x4f2425=[_0x4dfd56[_0x55f7fc(0xbe)]['expiry_date']];else var _0x5c3450=[..._0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0xf9)]],_0x3d820a=[..._0x4dfd56['body'][_0x55f7fc(0x1a4)]],_0x5d4edc=[..._0x4dfd56[_0x55f7fc(0xbe)]['adjust_qty']],_0x242c52=[..._0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0x1ad)]],_0x54266f=[..._0x4dfd56['body'][_0x55f7fc(0x143)]],_0x5eee0a=[..._0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0x192)]],_0x4c446b=[..._0x4dfd56[_0x55f7fc(0xbe)]['level']],_0x4f2425=[..._0x4dfd56['body'][_0x55f7fc(0x94)]];const _0x4212e1=_0x5c3450['map'](_0x5ac02d=>{return _0x5ac02d={'product_name':_0x5ac02d};});_0x3d820a['forEach']((_0xa12d3,_0x2749be)=>{var _0x4f7e26=_0x55f7fc;_0x4212e1[_0x2749be][_0x4f7e26(0x1a4)]=_0xa12d3;}),_0x5d4edc[_0x55f7fc(0x1b4)]((_0x35f4fe,_0x3d2811)=>{var _0xe101a4=_0x55f7fc;_0x4212e1[_0x3d2811][_0xe101a4(0xd0)]=_0x35f4fe;}),_0x242c52[_0x55f7fc(0x1b4)]((_0x534c2f,_0x4c1f02)=>{var _0x25f79b=_0x55f7fc;_0x4212e1[_0x4c1f02][_0x25f79b(0x1ad)]=_0x534c2f;}),_0x54266f[_0x55f7fc(0x1b4)]((_0x35a5b1,_0x4d2842)=>{var _0x32fb0b=_0x55f7fc;_0x4212e1[_0x4d2842][_0x32fb0b(0x143)]=_0x35a5b1;}),_0x5eee0a[_0x55f7fc(0x1b4)]((_0x24a9a6,_0x21cd8a)=>{var _0x2df0ca=_0x55f7fc;_0x4212e1[_0x21cd8a][_0x2df0ca(0x1d4)]=_0x24a9a6;}),_0x4c446b[_0x55f7fc(0x1b4)]((_0x5a19bd,_0x1118ba)=>{_0x4212e1[_0x1118ba]['level']=_0x5a19bd;}),_0x4f2425[_0x55f7fc(0x1b4)]((_0x566a73,_0x51a44a)=>{_0x4212e1[_0x51a44a]['expiry_date']=_0x566a73;});var _0x5b32ff=0x0;_0x4212e1[_0x55f7fc(0x1b4)](_0x55e632=>{var _0x458087=_0x55f7fc;console[_0x458087(0xfb)](_0x458087(0xec),_0x55e632),(parseInt(_0x55e632[_0x458087(0x1a4)])<parseInt(_0x55e632[_0x458087(0xd0)])||parseInt(_0x55e632[_0x458087(0xd0)])==0x0)&&_0x5b32ff++;});if(_0x5b32ff!=0x0)return _0x4dfd56[_0x55f7fc(0x12e)](_0x55f7fc(0x1de),_0x55f7fc(0x152)),_0x1e596b['redirect'](_0x55f7fc(0x13d));_0x5283c5[_0x55f7fc(0xf0)][_0x55f7fc(0x1b4)](_0x149ae1=>{var _0x1f7589=_0x55f7fc;const _0xcbdf95=_0x51762c[_0x1f7589(0xae)][_0x1f7589(0x17d)](_0x5dfd90=>{var _0x5eecf3=_0x1f7589;_0x5dfd90[_0x5eecf3(0xf9)]==_0x149ae1[_0x5eecf3(0xf9)]&&_0x5dfd90[_0x5eecf3(0x1bf)]==_0x149ae1['bay']&&(_0x5dfd90[_0x5eecf3(0xb7)]=parseInt(_0x5dfd90[_0x5eecf3(0xb7)])+parseInt(_0x149ae1[_0x5eecf3(0xd0)]));});}),await _0x51762c[_0x55f7fc(0x1c0)]();const _0x5ebf5a=_0x4212e1[_0x55f7fc(0x111)](_0x46259e=>_0x46259e[_0x55f7fc(0xd0)]!=='0'&&_0x46259e[_0x55f7fc(0xd0)]!=='');_0x5283c5[_0x55f7fc(0x1a7)]=_0x4c2427,_0x5283c5[_0x55f7fc(0x118)]=_0x1a4577,_0x5283c5[_0x55f7fc(0x1a5)]=_0xc96b4f,_0x5283c5[_0x55f7fc(0x115)]=_0x44366d,_0x5283c5[_0x55f7fc(0xf0)]=_0x5ebf5a,_0x5283c5[_0x55f7fc(0x135)]=_0x1fe6db,_0x5283c5[_0x55f7fc(0xd2)]=_0x132498;const _0x5c4e63=await _0x5283c5[_0x55f7fc(0x1c0)](),_0x42f302=await sales_finished[_0x55f7fc(0x1bb)]({'_id':_0x4dfd56[_0x55f7fc(0x17b)]['id']}),_0xd5836b=await warehouse[_0x55f7fc(0x1bb)]({'name':_0x44366d,'room':_0x132498,'warehouse_category':_0x55f7fc(0x1be)});_0x42f302['sale_product'][_0x55f7fc(0x1b4)](_0x4874fd=>{var _0x388ea6=_0x55f7fc;const _0x4b7b2c=_0xd5836b[_0x388ea6(0xae)]['map'](_0xa3e64=>{var _0x4b4c27=_0x388ea6;_0xa3e64[_0x4b4c27(0xf9)]==_0x4874fd[_0x4b4c27(0xf9)]&&_0xa3e64['bay']==_0x4874fd[_0x4b4c27(0x1bf)]&&(_0xa3e64[_0x4b4c27(0xb7)]=parseInt(_0xa3e64['product_stock'])-parseInt(_0x4874fd[_0x4b4c27(0xd0)]));});}),console[_0x55f7fc(0xfb)](_0x55f7fc(0x9d),_0xd5836b),await _0xd5836b[_0x55f7fc(0x1c0)]();const _0x527dbe=await c_payment_data[_0x55f7fc(0x1bb)]({'invoice':_0x4dfd56[_0x55f7fc(0xbe)][_0x55f7fc(0x1a7)]});_0x527dbe[_0x55f7fc(0x1ae)]=_0x4dfd56[_0x55f7fc(0xbe)]['suppliers'],await _0x527dbe['save'](),_0x4dfd56['flash']('success',_0x55f7fc(0xc7)),_0x1e596b['redirect'](_0x55f7fc(0xb9));}catch(_0x13fcee){console['log'](_0x13fcee);}}),router[a0_0x326140(0xee)]('/give_payment/:id',auth,async(_0x282904,_0x45ff47)=>{var _0x1d0d15=a0_0x326140;try{const _0x33618c=_0x282904[_0x1d0d15(0x17b)]['id'],{invoice:_0x46e628,customer:_0x38dd3d,receivable_amount:_0x120e55,received_amount:_0x3d710e}=_0x282904['body'],_0x42755b=await sales[_0x1d0d15(0x1d5)](_0x33618c);console[_0x1d0d15(0xfb)](_0x42755b);var _0x2a055d=_0x120e55-_0x3d710e;console['log'](_0x3d710e),_0x42755b[_0x1d0d15(0x159)]=parseFloat(_0x3d710e)+parseFloat(_0x42755b[_0x1d0d15(0x159)]),_0x42755b[_0x1d0d15(0xc6)]=_0x2a055d,console[_0x1d0d15(0xfb)](_0x42755b);const _0x3b7611=await _0x42755b['save'](),_0x375691=await c_payment_data['findOne']({'invoice':_0x46e628});_0x375691['amount']=_0x2a055d,await _0x375691[_0x1d0d15(0x1c0)]();let _0x1d8408=new Date(),_0x3f1c0a=('0'+_0x1d8408[_0x1d0d15(0x1ab)]())['slice'](-0x2),_0x1a7f32=('0'+(_0x1d8408[_0x1d0d15(0x112)]()+0x1))[_0x1d0d15(0xa4)](-0x2),_0x328dd6=_0x1d8408['getFullYear'](),_0xc93684=_0x328dd6+'-'+_0x1a7f32+'-'+_0x3f1c0a;const _0xdf4af5=new customer_payment({'invoice':_0x46e628,'date':_0x328dd6+'-'+_0x1a7f32+'-'+_0x3f1c0a,'customer':_0x38dd3d,'reason':_0x1d0d15(0x148),'amount':_0x3d710e}),_0x34f9c3=await _0xdf4af5['save']();_0x282904['flash'](_0x1d0d15(0x164),'payment\x20successfull'),_0x45ff47['redirect'](_0x1d0d15(0x1d3));}catch(_0xfe978e){console[_0x1d0d15(0xfb)](_0xfe978e);}}),router[a0_0x326140(0x110)](a0_0x326140(0x1aa),auth,async(_0x5decf6,_0x5bdf8a)=>{var _0x1ee090=a0_0x326140;try{const {username:_0x570195,email:_0x48f009,role:_0x44702a}=_0x5decf6[_0x1ee090(0x18f)],_0x31632d=_0x5decf6['user'],_0x16fc73=await profile[_0x1ee090(0x1bb)]({'email':_0x31632d[_0x1ee090(0x1c4)]}),_0x16f365=await master_shop[_0x1ee090(0x101)]();console['log'](_0x1ee090(0x17a),_0x16f365);const _0x4a6b60=_0x5decf6[_0x1ee090(0x17b)]['id'],_0x529cd7=await sales[_0x1ee090(0x1d5)](_0x4a6b60);console['log'](_0x529cd7);const _0x3676d1=await customer[_0x1ee090(0x1bb)]({'name':_0x529cd7[_0x1ee090(0x118)]});console[_0x1ee090(0xfb)](_0x3676d1);if(_0x16f365[0x0]['language']=='English\x20(US)'){var _0x20e18b=users[_0x1ee090(0x1a8)];console[_0x1ee090(0xfb)](_0x20e18b);}else{if(_0x16f365[0x0][_0x1ee090(0x145)]==_0x1ee090(0xe1))var _0x20e18b=users[_0x1ee090(0xe1)];else{if(_0x16f365[0x0][_0x1ee090(0x145)]==_0x1ee090(0x97))var _0x20e18b=users[_0x1ee090(0x97)];else{if(_0x16f365[0x0][_0x1ee090(0x145)]==_0x1ee090(0xb2))var _0x20e18b=users[_0x1ee090(0xb2)];else{if(_0x16f365[0x0][_0x1ee090(0x145)]==_0x1ee090(0xa8))var _0x20e18b=users[_0x1ee090(0xa8)];else{if(_0x16f365[0x0][_0x1ee090(0x145)]=='Portuguese\x20(BR)')var _0x20e18b=users[_0x1ee090(0x16d)];else{if(_0x16f365[0x0][_0x1ee090(0x145)]==_0x1ee090(0xe7))var _0x20e18b=users[_0x1ee090(0xe7)];else{if(_0x16f365[0x0][_0x1ee090(0x145)]=='Arabic\x20(ae)')var _0x20e18b=users[_0x1ee090(0xff)];}}}}}}}_0x5bdf8a[_0x1ee090(0x131)](_0x1ee090(0x1c8),{'success':_0x5decf6[_0x1ee090(0x12e)](_0x1ee090(0x164)),'errors':_0x5decf6[_0x1ee090(0x12e)]('errors'),'role':_0x31632d,'profile':_0x16fc73,'master_shop':_0x16f365,'customers':_0x3676d1,'sales':_0x529cd7,'language':_0x20e18b});}catch(_0x50e114){console['log'](_0x50e114);}}),router[a0_0x326140(0x110)](a0_0x326140(0xba),auth,async(_0xc45de8,_0x4c57e6)=>{var _0x298b33=a0_0x326140;try{const {username:_0x45cbc6,email:_0x11928f,role:_0x32abf9}=_0xc45de8[_0x298b33(0x18f)],_0x46a827=_0xc45de8[_0x298b33(0x18f)],_0x37171c=await profile[_0x298b33(0x1bb)]({'email':_0x46a827[_0x298b33(0x1c4)]}),_0x381561=await master_shop[_0x298b33(0x101)](),_0x8f71cc=_0xc45de8['params']['id'],_0x573812=await sales_finished[_0x298b33(0x1d5)](_0x8f71cc),_0x5ee5c2=await warehouse['aggregate']([{'$match':{'name':_0x573812[_0x298b33(0x115)]}},{'$unwind':_0x298b33(0x181)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x298b33(0xe5)},'product_stock':{'$first':_0x298b33(0xaa)},'bay':{'$first':_0x298b33(0x19b)},'bin':{'$first':_0x298b33(0x154)},'type':{'$first':_0x298b33(0x16b)},'floorlevel':{'$first':_0x298b33(0x117)},'primary_code':{'$first':_0x298b33(0x12b)},'secondary_code':{'$first':_0x298b33(0xfd)},'product_code':{'$first':_0x298b33(0x153)},'storage':{'$first':_0x298b33(0xfc)},'rack':{'$first':_0x298b33(0x1db)},'expiry_date':{'$first':_0x298b33(0xf6)},'production_date':{'$first':_0x298b33(0x172)},'unit':{'$first':_0x298b33(0x18c)},'secondary_unit':{'$first':_0x298b33(0x126)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x298b33(0x119)}}}]),_0x5618ee=await product[_0x298b33(0x101)]({}),_0x5c44cf=await warehouse[_0x298b33(0x141)]([{'$match':{'status':'Enabled','warehouse_category':_0x298b33(0x1be),'name':{'$ne':_0x298b33(0x165),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x298b33(0x150),'name':{'$first':_0x298b33(0x150)}}},{'$sort':{'name':0x1}}]);var _0xe91b07=['Return\x20Rooms'];const _0x1247b2=await warehouse[_0x298b33(0x141)]([{'$match':{'status':_0x298b33(0x18e),'name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':_0x298b33(0x150)}}},{'$sort':{'name':0x1}}]);if(_0x381561[0x0][_0x298b33(0x145)]==_0x298b33(0x1ca)){var _0x504844=users[_0x298b33(0x1a8)];console[_0x298b33(0xfb)](_0x504844);}else{if(_0x381561[0x0]['language']==_0x298b33(0xe1))var _0x504844=users['Hindi'];else{if(_0x381561[0x0]['language']==_0x298b33(0x97))var _0x504844=users[_0x298b33(0x97)];else{if(_0x381561[0x0][_0x298b33(0x145)]==_0x298b33(0xb2))var _0x504844=users[_0x298b33(0xb2)];else{if(_0x381561[0x0][_0x298b33(0x145)]=='French')var _0x504844=users[_0x298b33(0xa8)];else{if(_0x381561[0x0][_0x298b33(0x145)]==_0x298b33(0x1b2))var _0x504844=users[_0x298b33(0x16d)];else{if(_0x381561[0x0][_0x298b33(0x145)]==_0x298b33(0xe7))var _0x504844=users[_0x298b33(0xe7)];else{if(_0x381561[0x0][_0x298b33(0x145)]=='Arabic\x20(ae)')var _0x504844=users[_0x298b33(0xff)];}}}}}}}_0x4c57e6['render'](_0x298b33(0x11c),{'success':_0xc45de8['flash'](_0x298b33(0x164)),'errors':_0xc45de8[_0x298b33(0x12e)](_0x298b33(0x1de)),'role':_0x46a827,'profile':_0x37171c,'user':_0x573812,'stock':_0x5ee5c2,'master_shop':_0x381561,'unit':_0x5618ee,'language':_0x504844,'warehouses':_0x5c44cf,'rooms':_0xe91b07,'warehouse_QA':_0x1247b2});}catch(_0x4ce9cd){console['log'](_0x4ce9cd),_0x4c57e6[_0x298b33(0xc8)](0xc8)[_0x298b33(0x16c)]({'message':_0x4ce9cd[_0x298b33(0x1cb)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x2f1d4c,_0x3fd70d)=>{var _0x3528ac=a0_0x326140;if(_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xd4)]=='QA')try{const {invoice:_0x34c1cf,date:_0x1b880c,warehouse_name:_0x4ce95a,product_name:_0x1745c0,primary_code:_0x1fa44f,secondary_code:_0x2b2f66,product_code:_0x18609c,sales_quantity:_0x328d19,stocks:_0x3afe7c,return_qty:_0x61caa0,Room_name:_0x58e05b,to_warehouse_name_QA:_0x174151,to_Room_name_QA:_0x5ab882,note:_0x360aba,for_categorize:_0x1d8759,product_name_QA1:_0x4e26d8}=_0x2f1d4c[_0x3528ac(0xbe)];if(typeof _0x4e26d8==_0x3528ac(0x10f))var _0x72b11=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x151)]],_0xa1e194=[_0x2f1d4c['body'][_0x3528ac(0xa0)]],_0xc73f56=[_0x2f1d4c[_0x3528ac(0xbe)]['secondary_code_QA']],_0x2d1618=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x1d9)]],_0x548358=[_0x2f1d4c['body'][_0x3528ac(0xb1)]],_0x20982a=[_0x2f1d4c['body'][_0x3528ac(0x138)]],_0xe64707=[_0x2f1d4c['body'][_0x3528ac(0x1ac)]],_0x49d518=[_0x2f1d4c['body'][_0x3528ac(0x140)]],_0x4c1920=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x158)]],_0x7050c8=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x185)]],_0x46f918=[_0x2f1d4c['body'][_0x3528ac(0x137)]],_0x50465f=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x13b)]],_0x2f90d3=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x189)]],_0x2dbfe0=[_0x2f1d4c[_0x3528ac(0xbe)]['expiry_date_QA']];else var _0x72b11=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x151)]],_0xa1e194=[..._0x2f1d4c['body']['primary_code_QA']],_0xc73f56=[..._0x2f1d4c['body'][_0x3528ac(0xc9)]],_0x2d1618=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x1d9)]],_0x548358=[..._0x2f1d4c[_0x3528ac(0xbe)]['sales_quantity_QA']],_0x20982a=[..._0x2f1d4c['body'][_0x3528ac(0x138)]],_0xe64707=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x1ac)]],_0x49d518=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x140)]],_0x4c1920=[..._0x2f1d4c['body'][_0x3528ac(0x158)]],_0x7050c8=[..._0x2f1d4c['body'][_0x3528ac(0x185)]],_0x46f918=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x137)]],_0x50465f=[..._0x2f1d4c['body'][_0x3528ac(0x13b)]],_0x2f90d3=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x189)]],_0x2dbfe0=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x12d)]];const _0x12c4be=_0x72b11[_0x3528ac(0x17d)](_0x55edfc=>{return _0x55edfc={'product_name':_0x55edfc};});_0xa1e194[_0x3528ac(0x1b4)]((_0x1efb7e,_0x22906c)=>{var _0x254f44=_0x3528ac;_0x12c4be[_0x22906c][_0x254f44(0x1ad)]=_0x1efb7e;}),_0xc73f56[_0x3528ac(0x1b4)]((_0x1b3a31,_0x457012)=>{var _0x5095c0=_0x3528ac;_0x12c4be[_0x457012][_0x5095c0(0x143)]=_0x1b3a31;}),_0x2d1618[_0x3528ac(0x1b4)]((_0x1c7661,_0x2bdcd0)=>{var _0x13be9e=_0x3528ac;_0x12c4be[_0x2bdcd0][_0x13be9e(0x1d4)]=_0x1c7661;}),_0x548358[_0x3528ac(0x1b4)]((_0x2b6a0b,_0x3949a6)=>{_0x12c4be[_0x3949a6]['sale_qty']=_0x2b6a0b;}),_0x20982a['forEach']((_0x33144a,_0x11430a)=>{var _0xb7c0ef=_0x3528ac;_0x12c4be[_0x11430a][_0xb7c0ef(0x1a4)]=_0x33144a;}),_0xe64707[_0x3528ac(0x1b4)]((_0x28fd7f,_0x35fd16)=>{var _0x4caf73=_0x3528ac;_0x12c4be[_0x35fd16][_0x4caf73(0x95)]=_0x28fd7f;}),_0x49d518[_0x3528ac(0x1b4)]((_0x393c1c,_0x81e02c)=>{var _0x56460a=_0x3528ac;_0x12c4be[_0x81e02c][_0x56460a(0x10c)]=_0x393c1c;}),_0x4c1920['forEach']((_0x317051,_0x1a950f)=>{var _0x97ad30=_0x3528ac;_0x12c4be[_0x1a950f][_0x97ad30(0x173)]=_0x317051;}),_0x7050c8[_0x3528ac(0x1b4)]((_0x59b6d7,_0x161fac)=>{var _0x5c1ac8=_0x3528ac;_0x12c4be[_0x161fac][_0x5c1ac8(0x104)]=_0x59b6d7;}),_0x46f918[_0x3528ac(0x1b4)]((_0x25d16a,_0x407d5a)=>{var _0x2d694f=_0x3528ac;_0x12c4be[_0x407d5a][_0x2d694f(0x13a)]=_0x25d16a;}),_0x50465f[_0x3528ac(0x1b4)]((_0x40dab6,_0x5c4a43)=>{var _0xbee53d=_0x3528ac;_0x12c4be[_0x5c4a43][_0xbee53d(0x17c)]=_0x40dab6;}),_0x2f90d3[_0x3528ac(0x1b4)]((_0x3a7d8d,_0x258897)=>{var _0x45d0ba=_0x3528ac;_0x12c4be[_0x258897][_0x45d0ba(0xf3)]=_0x3a7d8d;}),_0x2dbfe0[_0x3528ac(0x1b4)]((_0x4cd5e8,_0x49e034)=>{var _0x1cf34f=_0x3528ac;_0x12c4be[_0x49e034][_0x1cf34f(0x94)]=_0x4cd5e8;});const _0x13acfb=await sales_finished[_0x3528ac(0x1bb)]({'invoice':_0x34c1cf});_0x13acfb[_0x3528ac(0x170)]='True';const _0x2e4070=await _0x13acfb[_0x3528ac(0x1c0)](),_0x2af16f=new sales_return_finished({'invoice':_0x34c1cf,'customer':_0x2f1d4c['body']['customer'],'date':_0x1b880c,'warehouse_name':_0x4ce95a,'room':_0x58e05b,'ToWarehouse':_0x174151,'ToRoom':_0x5ab882,'return_sale_QA':_0x12c4be,'note':_0x360aba,'warehouse_cat':_0x1d8759}),_0x1eaf1b=await _0x2af16f[_0x3528ac(0x1c0)](),_0x209af1=await sales_return_finished[_0x3528ac(0x1bb)]({'invoice':_0x34c1cf}),_0x432b97=await warehouse[_0x3528ac(0x1bb)]({'name':_0x174151,'room':_0x5ab882});_0x209af1[_0x3528ac(0x116)][_0x3528ac(0x1b4)](_0x59f912=>{var _0x3a6cc9=_0x3528ac,_0x31f6c6=0x0;const _0xec67b9=_0x432b97[_0x3a6cc9(0xae)][_0x3a6cc9(0x17d)](_0x3d8ee6=>{var _0x113d45=_0x3a6cc9;_0x3d8ee6['product_name']==_0x59f912[_0x113d45(0xf9)]&&_0x3d8ee6[_0x113d45(0x94)]==_0x59f912[_0x113d45(0x94)]&&_0x3d8ee6[_0x113d45(0xf3)]==_0x59f912['production_date']&&_0x3d8ee6[_0x113d45(0x104)]==_0x59f912['batch_code']&&(_0x3d8ee6[_0x113d45(0xb7)]=parseInt(_0x3d8ee6['product_stock'])+parseInt(_0x59f912['return_qty']),_0x31f6c6++);});_0x31f6c6=='0'&&(_0x432b97[_0x3a6cc9(0xae)]=_0x432b97[_0x3a6cc9(0xae)][_0x3a6cc9(0x160)]({'product_name':_0x59f912[_0x3a6cc9(0xf9)],'product_stock':_0x59f912['return_qty'],'primary_code':_0x59f912[_0x3a6cc9(0x1ad)],'secondary_code':_0x59f912[_0x3a6cc9(0x143)],'product_code':_0x59f912[_0x3a6cc9(0x1d4)],'batch_code':_0x59f912['batch_code'],'maxPerUnit':_0x59f912['maxPerUnit'],'production_date':_0x59f912[_0x3a6cc9(0xf3)],'expiry_date':_0x59f912[_0x3a6cc9(0x94)],'secondary_unit':_0x59f912['secondary_unit'],'unit':_0x59f912[_0x3a6cc9(0x17c)],'maxProducts':_0x59f912[_0x3a6cc9(0x173)],'bay':_0x59f912['bay']}));}),await _0x432b97[_0x3528ac(0x1c0)]();const _0x763e28=new c_payment_data({'invoice':_0x34c1cf,'customer':_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x118)],'reason':_0x3528ac(0xa7)});await _0x763e28[_0x3528ac(0x1c0)]();const _0x47d115=await master_shop['find'](),_0x24a223=await email_settings[_0x3528ac(0x1bb)](),_0x4aa266=await customer['findOne']({'name':_0x2f1d4c['body'][_0x3528ac(0x118)]});_0x47d115[0x0][_0x3528ac(0x161)]==0x1?(right_currency=_0x47d115[0x0][_0x3528ac(0x128)],left_currency=''):(right_currency='',left_currency=_0x47d115[0x0][_0x3528ac(0x128)]);var _0x266de9=_0x72b11,_0x3145fc=_0xe64707,_0x1cc893='',_0x25d773;for(_0x25d773 in _0x266de9){_0x1cc893+=_0x3528ac(0xcd)+_0x3528ac(0x1d6)+_0x266de9[_0x25d773]+_0x3528ac(0x1ba)+_0x3528ac(0x1d6)+_0x3145fc[_0x25d773]+_0x3528ac(0x1ba)+_0x3528ac(0xe8);}console[_0x3528ac(0xfb)](_0x3528ac(0x15d),_0x1cc893);let _0x10af5a=nodemailer[_0x3528ac(0x157)]({'service':_0x3528ac(0x1b0),'auth':{'user':_0x24a223[_0x3528ac(0x1c4)],'pass':_0x24a223[_0x3528ac(0xd9)]}}),_0x3819be={'from':_0x24a223[_0x3528ac(0x1c4)],'to':_0x4aa266[_0x3528ac(0x1c4)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x3528ac(0xb3),'path':__dirname+_0x3528ac(0xbc)+_0x3528ac(0x1b9)+_0x47d115[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x3528ac(0xdd)+_0x3528ac(0x108)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3528ac(0xe4)+_0x3528ac(0xe6)+_0x3528ac(0x15b)+_0x3528ac(0xe4)+_0x3528ac(0x11b)+_0x47d115[0x0][_0x3528ac(0xdc)]+_0x3528ac(0x14c)+_0x3528ac(0x15b)+_0x3528ac(0x15b)+_0x3528ac(0xcf)+_0x3528ac(0xe4)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3528ac(0x10b)+_0x34c1cf+'\x20'+_0x3528ac(0xc2)+_0x3528ac(0x14f)+_0x1b880c+'\x20'+_0x3528ac(0x14a)+'</h5>'+_0x3528ac(0x15b)+_0x3528ac(0x183)+_0x3528ac(0x1bd)+_0x3528ac(0xcd)+_0x3528ac(0x147)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3528ac(0x186)+_0x3528ac(0xab)+_0x3528ac(0xe8)+_0x3528ac(0x16f)+_0x3528ac(0x134)+'\x20'+_0x1cc893+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x3528ac(0x10e)+_0x3528ac(0xc5)+_0x47d115[0x0][_0x3528ac(0xdc)]+_0x3528ac(0x1b5)+_0x3528ac(0x15b)+_0x3528ac(0x15b)+'</body></html>'};_0x10af5a[_0x3528ac(0xc3)](_0x3819be,function(_0x3ae978,_0x4e0c92){var _0x21bddd=_0x3528ac;_0x3ae978?(console[_0x21bddd(0xfb)](_0x3ae978),console[_0x21bddd(0xfb)](_0x21bddd(0xb4))):console[_0x21bddd(0xfb)](_0x21bddd(0x1c9));}),_0x2f1d4c[_0x3528ac(0x12e)](_0x3528ac(0x164),_0x3528ac(0xe0)),_0x3fd70d['redirect'](_0x3528ac(0xb9));}catch(_0x5c6b59){_0x3fd70d['status'](0xc8)[_0x3528ac(0x16c)]({'message1':_0x5c6b59[_0x3528ac(0x1cb)]});}else{if(_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xd4)]=='GS')try{const {invoice:_0x1184c6,date:_0x7a3ec7,warehouse_name:_0x1767a3,product_name:_0x37d1bf,primary_code:_0x214ddf,secondary_code:_0x54d129,product_code:_0x19f8e3,sales_quantity:_0x9301d1,stocks:_0x446489,return_qty:_0xf0ac,Room_name:_0x584ad6,to_warehouse_name:_0x2dceca,to_Room_name:_0x43d66f,note:_0x21374b,level:_0x777777,isle:_0x1e4019,pallet:_0x311259,for_categorize:_0x2fe308}=_0x2f1d4c[_0x3528ac(0xbe)];if(typeof _0x37d1bf==_0x3528ac(0x10f))var _0x72b11=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xf9)]],_0xa1e194=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x1ad)]],_0xc73f56=[_0x2f1d4c[_0x3528ac(0xbe)]['secondary_code']],_0x2d1618=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x1d4)]],_0x548358=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xac)]],_0xe64707=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x95)]],_0x38331e=[_0x2f1d4c[_0x3528ac(0xbe)]['bay']],_0x49d518=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x10c)]],_0x4c1920=[_0x2f1d4c['body'][_0x3528ac(0x173)]],_0x7050c8=[_0x2f1d4c['body'][_0x3528ac(0x104)]],_0x46f918=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x13a)]],_0x50465f=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x17c)]],_0x2f90d3=[_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xf3)]],_0x2dbfe0=[_0x2f1d4c[_0x3528ac(0xbe)]['expiry_date']];else var _0x72b11=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xf9)]],_0xa1e194=[..._0x2f1d4c['body'][_0x3528ac(0x1ad)]],_0xc73f56=[..._0x2f1d4c[_0x3528ac(0xbe)]['secondary_code']],_0x2d1618=[..._0x2f1d4c[_0x3528ac(0xbe)]['product_code']],_0x548358=[..._0x2f1d4c['body'][_0x3528ac(0xac)]],_0xe64707=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x95)]],_0x38331e=[..._0x2f1d4c['body'][_0x3528ac(0x1bf)]],_0x49d518=[..._0x2f1d4c['body'][_0x3528ac(0x10c)]],_0x4c1920=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x173)]],_0x7050c8=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x104)]],_0x46f918=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x13a)]],_0x50465f=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x17c)]],_0x2f90d3=[..._0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0xf3)]],_0x2dbfe0=[..._0x2f1d4c[_0x3528ac(0xbe)]['expiry_date']];const _0x39bc0b=_0x72b11['map'](_0x551263=>{return _0x551263={'product_name':_0x551263};});_0xa1e194[_0x3528ac(0x1b4)]((_0x249613,_0x45f792)=>{_0x39bc0b[_0x45f792]['primary_code']=_0x249613;}),_0xc73f56[_0x3528ac(0x1b4)]((_0x26e89b,_0x31e0de)=>{var _0x5023a7=_0x3528ac;_0x39bc0b[_0x31e0de][_0x5023a7(0x143)]=_0x26e89b;}),_0x2d1618['forEach']((_0x3dcfca,_0x30aa2e)=>{_0x39bc0b[_0x30aa2e]['product_code']=_0x3dcfca;}),_0x548358['forEach']((_0x37b764,_0x52ed77)=>{_0x39bc0b[_0x52ed77]['sale_qty']=_0x37b764;}),_0xe64707[_0x3528ac(0x1b4)]((_0x3cea0c,_0x3af87d)=>{var _0x220605=_0x3528ac;_0x39bc0b[_0x3af87d][_0x220605(0x95)]=_0x3cea0c;}),_0x38331e[_0x3528ac(0x1b4)]((_0xe75289,_0x14df44)=>{var _0x37e8d9=_0x3528ac;_0x39bc0b[_0x14df44][_0x37e8d9(0x1bf)]=_0xe75289;}),_0x49d518[_0x3528ac(0x1b4)]((_0x51d833,_0x36ab1a)=>{var _0x3c81be=_0x3528ac;_0x39bc0b[_0x36ab1a][_0x3c81be(0x10c)]=_0x51d833;}),_0x4c1920['forEach']((_0x171e76,_0x22c163)=>{var _0x415109=_0x3528ac;_0x39bc0b[_0x22c163][_0x415109(0x173)]=_0x171e76;}),_0x7050c8['forEach']((_0x586da5,_0x16fc0c)=>{var _0x216dc2=_0x3528ac;_0x39bc0b[_0x16fc0c][_0x216dc2(0x104)]=_0x586da5;}),_0x46f918[_0x3528ac(0x1b4)]((_0x1e727c,_0x1e5090)=>{var _0x18bbb2=_0x3528ac;_0x39bc0b[_0x1e5090][_0x18bbb2(0x13a)]=_0x1e727c;}),_0x50465f[_0x3528ac(0x1b4)]((_0x23c061,_0x5cf349)=>{var _0x55f3be=_0x3528ac;_0x39bc0b[_0x5cf349][_0x55f3be(0x17c)]=_0x23c061;}),_0x2f90d3['forEach']((_0x4dfb90,_0x54b82d)=>{var _0x14b264=_0x3528ac;_0x39bc0b[_0x54b82d][_0x14b264(0xf3)]=_0x4dfb90;}),_0x2dbfe0[_0x3528ac(0x1b4)]((_0x2bc493,_0x43bedd)=>{_0x39bc0b[_0x43bedd]['expiry_date']=_0x2bc493;});var _0x47ac31=0x0;_0x39bc0b['forEach'](_0x2eadd3=>{var _0x11668a=_0x3528ac;(parseInt(_0x2eadd3[_0x11668a(0xca)])<parseInt(_0x2eadd3[_0x11668a(0x95)])||parseInt(_0x2eadd3[_0x11668a(0x1a4)])<parseInt(_0x2eadd3['return_qty'])&&parseInt(_0x2eadd3[_0x11668a(0xca)])>parseInt(_0x2eadd3[_0x11668a(0x95)])||parseInt(_0x2eadd3[_0x11668a(0x95)])==0x0)&&_0x47ac31++;});if(_0x47ac31!=0x0)return _0x2f1d4c[_0x3528ac(0x12e)](_0x3528ac(0x1de),_0x3528ac(0x194)),_0x3fd70d[_0x3528ac(0xed)]('back');const _0x15390e=await sales_finished[_0x3528ac(0x1bb)]({'invoice':_0x1184c6});_0x15390e['return_data']='True';const _0x4b858b=await _0x15390e[_0x3528ac(0x1c0)](),_0x4b0eb8=new sales_return_finished({'invoice':_0x1184c6,'customer':_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x118)],'date':_0x7a3ec7,'warehouse_name':_0x1767a3,'room':_0x584ad6,'ToWarehouse':_0x2dceca,'ToRoom':_0x43d66f,'return_sale':_0x39bc0b,'note':_0x21374b,'warehouse_cat':_0x2fe308}),_0x59430a=await _0x4b0eb8['save'](),_0x3e4b79=await sales_return_finished[_0x3528ac(0x1bb)]({'invoice':_0x1184c6}),_0x14a2e0=await warehouse['findOne']({'name':_0x2dceca,'room':_0x43d66f,'warehouse_category':_0x3528ac(0x1be)});_0x3e4b79[_0x3528ac(0x124)]['forEach'](_0x57ca13=>{var _0x5b3433=_0x3528ac,_0x5d6af9=0x0;const _0xdb4278=_0x14a2e0['product_details'][_0x5b3433(0x17d)](_0x26a8d9=>{var _0x4456c3=_0x5b3433;_0x26a8d9[_0x4456c3(0xf9)]==_0x57ca13[_0x4456c3(0xf9)]&&_0x26a8d9[_0x4456c3(0x1bf)]==_0x57ca13['bay']&&_0x26a8d9[_0x4456c3(0x94)]==_0x57ca13[_0x4456c3(0x94)]&&_0x26a8d9[_0x4456c3(0xf3)]==_0x57ca13[_0x4456c3(0xf3)]&&_0x26a8d9[_0x4456c3(0x104)]==_0x57ca13[_0x4456c3(0x104)]&&(_0x26a8d9[_0x4456c3(0xb7)]=parseInt(_0x26a8d9[_0x4456c3(0xb7)])+parseInt(_0x57ca13['return_qty']),_0x5d6af9++);});_0x5d6af9=='0'&&(_0x14a2e0[_0x5b3433(0xae)]=_0x14a2e0[_0x5b3433(0xae)][_0x5b3433(0x160)]({'product_name':_0x57ca13[_0x5b3433(0xf9)],'product_stock':_0x57ca13[_0x5b3433(0x95)],'primary_code':_0x57ca13[_0x5b3433(0x1ad)],'secondary_code':_0x57ca13[_0x5b3433(0x143)],'product_code':_0x57ca13[_0x5b3433(0x1d4)],'bay':_0x57ca13[_0x5b3433(0x1bf)],'batch_code':_0x57ca13[_0x5b3433(0x104)],'maxPerUnit':_0x57ca13[_0x5b3433(0x10c)],'production_date':_0x57ca13['production_date'],'expiry_date':_0x57ca13['expiry_date'],'secondary_unit':_0x57ca13['secondary_unit'],'unit':_0x57ca13[_0x5b3433(0x17c)],'maxProducts':_0x57ca13[_0x5b3433(0x173)]}));}),await _0x14a2e0['save'](),console[_0x3528ac(0xfb)](_0x2f1d4c[_0x3528ac(0xbe)]);const _0x24f6d3=new c_payment_data({'invoice':_0x1184c6,'customer':_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x118)],'reason':_0x3528ac(0xa7)});await _0x24f6d3['save']();const _0x290504=await master_shop[_0x3528ac(0x101)]();console[_0x3528ac(0xfb)](_0x3528ac(0x107),_0x290504[0x0][_0x3528ac(0x169)]);const _0x5e8479=await email_settings[_0x3528ac(0x1bb)](),_0x5b6848=await customer[_0x3528ac(0x1bb)]({'name':_0x2f1d4c[_0x3528ac(0xbe)][_0x3528ac(0x118)]});console[_0x3528ac(0xfb)](_0x3528ac(0x184),_0x5b6848);_0x290504[0x0][_0x3528ac(0x161)]==0x1?(right_currency=_0x290504[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x290504[0x0][_0x3528ac(0x128)]);var _0x266de9=_0x72b11,_0x3145fc=_0xe64707,_0x1cc893='',_0x25d773;for(_0x25d773 in _0x266de9){_0x1cc893+=_0x3528ac(0xcd)+_0x3528ac(0x1d6)+_0x266de9[_0x25d773]+_0x3528ac(0x1ba)+_0x3528ac(0x1d6)+_0x3145fc[_0x25d773]+'</td>'+_0x3528ac(0xe8);}console[_0x3528ac(0xfb)](_0x3528ac(0x15d),_0x1cc893);let _0x35dd24=nodemailer['createTransport']({'service':_0x3528ac(0x1b0),'auth':{'user':_0x5e8479[_0x3528ac(0x1c4)],'pass':_0x5e8479['password']}}),_0x3da5ac={'from':_0x5e8479[_0x3528ac(0x1c4)],'to':_0x5b6848[_0x3528ac(0x1c4)],'subject':_0x3528ac(0xb6),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3528ac(0xbc)+_0x3528ac(0x1b9)+_0x290504[0x0]['image'],'cid':'logo'}],'html':_0x3528ac(0x114)+_0x3528ac(0xdd)+_0x3528ac(0x108)+_0x3528ac(0xe4)+_0x3528ac(0x17f)+_0x3528ac(0xe4)+_0x3528ac(0xe6)+_0x3528ac(0x15b)+'<div>'+'<h2>\x20'+_0x290504[0x0][_0x3528ac(0xdc)]+'\x20</h2>'+_0x3528ac(0x15b)+_0x3528ac(0x15b)+_0x3528ac(0xcf)+_0x3528ac(0xe4)+_0x3528ac(0xad)+_0x3528ac(0x10b)+_0x1184c6+'\x20'+_0x3528ac(0xc2)+_0x3528ac(0x14f)+_0x7a3ec7+'\x20'+_0x3528ac(0x14a)+'</h5>'+_0x3528ac(0x15b)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3528ac(0x1bd)+_0x3528ac(0xcd)+_0x3528ac(0x147)+_0x3528ac(0x1b8)+_0x3528ac(0x186)+_0x3528ac(0xab)+_0x3528ac(0xe8)+_0x3528ac(0x16f)+_0x3528ac(0x134)+'\x20'+_0x1cc893+'\x20'+_0x3528ac(0x1a0)+'</table>'+_0x3528ac(0xe4)+_0x3528ac(0x10e)+_0x3528ac(0xc5)+_0x290504[0x0]['site_title']+'</h5>'+_0x3528ac(0x15b)+_0x3528ac(0x15b)+_0x3528ac(0x1d2)};_0x35dd24['sendMail'](_0x3da5ac,function(_0x2cd393,_0x38a05f){var _0x552079=_0x3528ac;_0x2cd393?(console['log'](_0x2cd393),console[_0x552079(0xfb)](_0x552079(0xb4))):console[_0x552079(0xfb)](_0x552079(0x1c9));}),_0x2f1d4c[_0x3528ac(0x12e)](_0x3528ac(0x164),_0x3528ac(0xe0)),_0x3fd70d['redirect']('/all_sales_finished/view');}catch(_0x268474){console[_0x3528ac(0xfb)](_0x268474),_0x3fd70d[_0x3528ac(0xc8)](0xc8)['json']({'message1':_0x268474[_0x3528ac(0x1cb)]});}}}),router[a0_0x326140(0x110)]('/barcode/:id',auth,async(_0x10c39d,_0xfa0921)=>{var _0x4b12bb=a0_0x326140;try{const {username:_0x383b40,email:_0x40805a,role:_0x2bc4b4}=_0x10c39d['user'],_0x165589=_0x10c39d['user'],_0x53ec93=await profile[_0x4b12bb(0x1bb)]({'email':_0x165589[_0x4b12bb(0x1c4)]}),_0x2df892=await master_shop['find']();console[_0x4b12bb(0xfb)](_0x4b12bb(0x10a),_0x2df892);const _0x1122f8=_0x10c39d[_0x4b12bb(0x17b)]['id'],_0x124f91=await sales['findById'](_0x1122f8);console[_0x4b12bb(0xfb)](_0x4b12bb(0x113),_0x124f91);if(_0x2df892[0x0][_0x4b12bb(0x145)]==_0x4b12bb(0x1ca))var _0x40484e=users[_0x4b12bb(0x1a8)];else{if(_0x2df892[0x0][_0x4b12bb(0x145)]==_0x4b12bb(0xe1))var _0x40484e=users[_0x4b12bb(0xe1)];else{if(_0x2df892[0x0][_0x4b12bb(0x145)]=='German')var _0x40484e=users['German'];else{if(_0x2df892[0x0][_0x4b12bb(0x145)]==_0x4b12bb(0xb2))var _0x40484e=users[_0x4b12bb(0xb2)];else{if(_0x2df892[0x0][_0x4b12bb(0x145)]==_0x4b12bb(0xa8))var _0x40484e=users[_0x4b12bb(0xa8)];else{if(_0x2df892[0x0][_0x4b12bb(0x145)]==_0x4b12bb(0x1b2))var _0x40484e=users[_0x4b12bb(0x16d)];else{if(_0x2df892[0x0][_0x4b12bb(0x145)]==_0x4b12bb(0xe7))var _0x40484e=users[_0x4b12bb(0xe7)];else{if(_0x2df892[0x0]['language']==_0x4b12bb(0x1c5))var _0x40484e=users['Arabic'];}}}}}}}_0xfa0921[_0x4b12bb(0x131)](_0x4b12bb(0x1d7),{'success':_0x10c39d[_0x4b12bb(0x12e)](_0x4b12bb(0x164)),'errors':_0x10c39d['flash'](_0x4b12bb(0x1de)),'role':_0x165589,'profile':_0x53ec93,'alldata':_0x124f91,'master_shop':_0x2df892,'language':_0x40484e});}catch(_0x410b3d){console[_0x4b12bb(0xfb)](_0x410b3d);}}),router[a0_0x326140(0xee)](a0_0x326140(0x13e),async(_0x102341,_0xa624ec)=>{var _0x5dd207=a0_0x326140;const {product_code:_0x36a72a,warehouse_name:_0xb44216,rooms_data:_0x3dde6f,Roomslist:_0xa672be,sales_category:_0x226670}=_0x102341[_0x5dd207(0xbe)],_0x44dc9c=_0xa672be['split'](','),_0x477798=[];async function _0xab49e4(_0x4faef6){var _0x33c1af=_0x5dd207;const _0x3dc45=await warehouse['aggregate']([{'$match':{'name':_0xb44216,'room':_0x4faef6}},{'$unwind':_0x33c1af(0x181)},{'$match':{'product_details.primary_code':_0x36a72a}},{'$group':{'_id':_0x33c1af(0x19e),'name':{'$first':_0x33c1af(0xe5)},'product_stock':{'$first':_0x33c1af(0xaa)},'primary_code':{'$first':_0x33c1af(0x12b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x33c1af(0x153)},'level':{'$first':_0x33c1af(0x1bc)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x33c1af(0x16b)},'pallet':{'$first':_0x33c1af(0x117)},'unit':{'$first':_0x33c1af(0x18c)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x33c1af(0x1db)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x33c1af(0x172)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x33c1af(0xf2)},'product_cat':{'$first':_0x33c1af(0xa6)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x33c1af(0x179)},'invoice':{'$first':_0x33c1af(0x196)},'uuid':{'$first':_0x33c1af(0x18d)},'gross_price':{'$first':_0x33c1af(0x12c)},'sales_category':{'$first':'$product_details.sales_category'}}}]),_0x2d8a02=await warehouse['aggregate']([{'$match':{'name':_0xb44216,'room':_0x4faef6}},{'$unwind':_0x33c1af(0x181)},{'$match':{'product_details.secondary_code':_0x36a72a}},{'$group':{'_id':_0x33c1af(0x19e),'name':{'$first':_0x33c1af(0xe5)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x33c1af(0xfd)},'product_code':{'$first':_0x33c1af(0x153)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x33c1af(0x154)},'type':{'$first':_0x33c1af(0x16b)},'pallet':{'$first':_0x33c1af(0x117)},'unit':{'$first':_0x33c1af(0x18c)},'secondary_unit':{'$first':_0x33c1af(0x126)},'storage':{'$first':_0x33c1af(0xfc)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x33c1af(0x172)},'maxPerUnit':{'$first':_0x33c1af(0x119)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x33c1af(0x179)},'invoice':{'$first':_0x33c1af(0x196)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0x33c1af(0x12c)},'sales_category':{'$first':'$product_details.sales_category'}}}]);if(_0x3dc45[_0x33c1af(0x187)]>0x0)_0x477798[_0x33c1af(0xda)](_0x3dc45);else _0x2d8a02[_0x33c1af(0x187)]>0x0&&_0x477798['push'](_0x2d8a02);}const _0x46460d=_0x44dc9c['map'](_0x18815e=>_0xab49e4(_0x18815e));await Promise[_0x5dd207(0x19a)](_0x46460d),_0xa624ec[_0x5dd207(0x16c)](_0x477798);}),router[a0_0x326140(0xee)](a0_0x326140(0xa1),async(_0x2e9a53,_0x2fe4e2)=>{var _0x3536ba=a0_0x326140;const {product_code:_0x55cceb,warehouse_name:_0x2cc902,rooms_data:_0x520d21,Roomslist:_0x24ed45,sales_category:_0x36e29b}=_0x2e9a53[_0x3536ba(0xbe)],_0x4add34=_0x24ed45[_0x3536ba(0x1d8)](','),_0x2550c7=[];async function _0x135d1b(_0x4e81b4){var _0x733e6d=_0x3536ba;const _0x37da69=await warehouse[_0x733e6d(0x141)]([{'$match':{'name':_0x2cc902,'room':_0x4e81b4}},{'$unwind':_0x733e6d(0x181)},{'$match':{'product_details.primary_code':_0x55cceb,'product_details.sales_category':_0x36e29b,'product_details.type_products':_0x733e6d(0xfb)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x733e6d(0xe5)},'product_stock':{'$first':_0x733e6d(0xaa)},'primary_code':{'$first':_0x733e6d(0x12b)},'secondary_code':{'$first':_0x733e6d(0xfd)},'product_code':{'$first':_0x733e6d(0x153)},'level':{'$first':_0x733e6d(0x1bc)},'bay':{'$first':_0x733e6d(0x19b)},'type':{'$first':_0x733e6d(0x16b)},'pallet':{'$first':_0x733e6d(0x117)},'unit':{'$first':_0x733e6d(0x18c)},'secondary_unit':{'$first':_0x733e6d(0x126)},'storage':{'$first':_0x733e6d(0xfc)},'rack':{'$first':_0x733e6d(0x1db)},'expiry_date':{'$first':_0x733e6d(0xf6)},'production_date':{'$first':_0x733e6d(0x172)},'maxPerUnit':{'$first':_0x733e6d(0x119)},'batch_code':{'$first':_0x733e6d(0xf2)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x733e6d(0x196)},'uuid':{'$first':_0x733e6d(0x18d)},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x733e6d(0x180)},'type_products':{'$first':_0x733e6d(0xa5)}}}]);console['log'](_0x733e6d(0xfb)+'\x20<>\x20'+_0x55cceb+_0x733e6d(0x129)+_0x36e29b);const _0x4fdee7=await warehouse[_0x733e6d(0x141)]([{'$match':{'name':_0x2cc902,'room':_0x4e81b4}},{'$unwind':_0x733e6d(0x181)},{'$match':{'product_details.secondary_code':_0x55cceb,'product_details.sales_category':_0x36e29b,'product_details.type_products':_0x733e6d(0xfb)}},{'$group':{'_id':_0x733e6d(0x19e),'name':{'$first':_0x733e6d(0xe5)},'product_stock':{'$first':_0x733e6d(0xaa)},'primary_code':{'$first':_0x733e6d(0x12b)},'secondary_code':{'$first':_0x733e6d(0xfd)},'product_code':{'$first':_0x733e6d(0x153)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x733e6d(0x16b)},'pallet':{'$first':_0x733e6d(0x117)},'unit':{'$first':_0x733e6d(0x18c)},'secondary_unit':{'$first':_0x733e6d(0x126)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x733e6d(0xf6)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x733e6d(0x119)},'batch_code':{'$first':_0x733e6d(0xf2)},'product_cat':{'$first':_0x733e6d(0xa6)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x733e6d(0x179)},'invoice':{'$first':_0x733e6d(0x196)},'uuid':{'$first':_0x733e6d(0x18d)},'gross_price':{'$first':_0x733e6d(0x12c)},'sales_category':{'$first':_0x733e6d(0x180)},'type_products':{'$first':'$product_details.type_products'}}}]);if(_0x37da69['length']>0x0)_0x2550c7[_0x733e6d(0xda)](_0x37da69);else _0x4fdee7[_0x733e6d(0x187)]>0x0&&_0x2550c7[_0x733e6d(0xda)](_0x4fdee7);}const _0x5b136f=_0x4add34[_0x3536ba(0x17d)](_0x5bdef8=>_0x135d1b(_0x5bdef8));await Promise[_0x3536ba(0x19a)](_0x5b136f),_0x2fe4e2[_0x3536ba(0x16c)](_0x2550c7);}),router[a0_0x326140(0xee)]('/barcode_scanner_auto_data',async(_0x12d713,_0xdf18c8)=>{var _0x3b82f0=a0_0x326140;try{const {prduct_code:_0x492e22,warehouse_data:_0x2eeb14,qty_req:_0x1ec53e}=_0x12d713[_0x3b82f0(0xbe)];let _0x2ca951=_0x492e22[_0x3b82f0(0x1d8)]('~'),_0x41f8c1=_0x1ec53e[_0x3b82f0(0x1d8)]('~'),_0x1ea584=[],_0x2050f1=0x0;for(let _0x40f463=0x0;_0x40f463<=_0x2ca951[_0x3b82f0(0x187)]-0x1;_0x40f463++){const _0x4dbf78=_0x2ca951[_0x40f463],_0x24ccb8=_0x41f8c1[_0x40f463],_0x276ec1=await warehouse[_0x3b82f0(0x141)]([{'$match':{'name':_0x2eeb14}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x4dbf78}},{'$sort':{'product_details.date_received':0x1}},{'$group':{'_id':_0x3b82f0(0x19e),'name':{'$first':_0x3b82f0(0xe5)},'product_stock':{'$first':_0x3b82f0(0xaa)},'primary_code':{'$first':_0x3b82f0(0x12b)},'secondary_code':{'$first':_0x3b82f0(0xfd)},'product_code':{'$first':_0x3b82f0(0x153)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x3b82f0(0x19b)},'type':{'$first':_0x3b82f0(0x16b)},'pallet':{'$first':_0x3b82f0(0x117)},'unit':{'$first':_0x3b82f0(0x18c)},'secondary_unit':{'$first':_0x3b82f0(0x126)},'storage':{'$first':_0x3b82f0(0xfc)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x3b82f0(0xf2)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3b82f0(0x179)},'invoice':{'$first':_0x3b82f0(0x196)},'uuid':{'$first':_0x3b82f0(0x18d)},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x3b82f0(0x180)},'date_received':{'$first':_0x3b82f0(0x102)},'warehouse_id':{'$first':_0x3b82f0(0xfa)}}}]),_0x4b96ec=_0x276ec1[_0x3b82f0(0x1a2)]((_0x74bd5b,_0x40ef07)=>new Date(_0x74bd5b[_0x3b82f0(0x1b6)])-new Date(_0x40ef07['date_received']));let _0xae90db=_0x24ccb8;for(let _0x328e86=0x0;_0x328e86<=_0x4b96ec[_0x3b82f0(0x187)]-0x1&&_0xae90db>0x0;_0x328e86++){const _0x25c33f=_0x4b96ec[_0x328e86];if(_0x25c33f[_0x3b82f0(0x1d4)]==_0x4dbf78){_0x1ea584[_0x2050f1]={};const _0x344505=parseInt(_0x25c33f[_0x3b82f0(0xb7)]),_0x330e70=0x0;let _0x3221a2=_0x344505-_0x330e70,_0x204f0c=Math[_0x3b82f0(0xfe)](_0xae90db,_0x3221a2);console['log'](_0x3b82f0(0x127)+_0x204f0c+'\x20units\x20to\x20warehouse:\x20'+_0x2eeb14+',\x20room:\x20'+_0x25c33f[_0x3b82f0(0x19f)]+_0x3b82f0(0xd3)+(_0x25c33f[_0x3b82f0(0x15a)]+_0x25c33f[_0x3b82f0(0x1bf)])+_0x3b82f0(0xbd)+_0x25c33f[_0x3b82f0(0x1b6)]+_0x3b82f0(0x105)+_0x25c33f[_0x3b82f0(0x167)]),_0x1ea584[_0x2050f1][_0x3b82f0(0x103)]=_0x25c33f['warehouse_id']+'~'+_0x25c33f[_0x3b82f0(0xd6)]+'~'+_0x204f0c,_0x1ea584[_0x2050f1]['product_name']=_0x25c33f[_0x3b82f0(0x167)],_0x1ea584[_0x2050f1][_0x3b82f0(0x1d4)]=_0x25c33f[_0x3b82f0(0x1d4)],_0x1ea584[_0x2050f1]['product_id']=_0x25c33f[_0x3b82f0(0x197)],_0x1ea584[_0x2050f1][_0x3b82f0(0x14d)]=_0x25c33f['date_recieved'],_0x1ea584[_0x2050f1]['sales_category']=_0x25c33f[_0x3b82f0(0x15e)],_0x1ea584[_0x2050f1]['uuid']=_0x25c33f['uuid'],_0x1ea584[_0x2050f1][_0x3b82f0(0xd0)]=_0x204f0c,_0x1ea584[_0x2050f1]['standard_unit']=_0x25c33f[_0x3b82f0(0x174)],_0x1ea584[_0x2050f1][_0x3b82f0(0x13a)]=_0x25c33f['secondary_unit'],_0x1ea584[_0x2050f1][_0x3b82f0(0x1ad)]=_0x25c33f[_0x3b82f0(0x1ad)],_0x1ea584[_0x2050f1]['secondary_code']=_0x25c33f[_0x3b82f0(0x143)],_0x1ea584[_0x2050f1]['maxStocks']=_0x25c33f['maxStocks'],_0x1ea584[_0x2050f1]['batch_code']=_0x25c33f[_0x3b82f0(0x104)],_0x1ea584[_0x2050f1][_0x3b82f0(0x94)]=_0x25c33f[_0x3b82f0(0x94)],_0x1ea584[_0x2050f1][_0x3b82f0(0xf3)]=_0x25c33f[_0x3b82f0(0xf3)],_0x1ea584[_0x2050f1][_0x3b82f0(0x9b)]=_0x25c33f['maxperunit'],_0x1ea584[_0x2050f1]['product_cat']=_0x25c33f[_0x3b82f0(0xdf)],_0x1ea584[_0x2050f1][_0x3b82f0(0x1a7)]=_0x25c33f[_0x3b82f0(0x1a7)],_0x1ea584[_0x2050f1]['gross_price']=_0x25c33f[_0x3b82f0(0x191)],_0x1ea584[_0x2050f1][_0x3b82f0(0xf8)]=_0x25c33f['roomNamed'],_0x1ea584[_0x2050f1]['level']=_0x25c33f[_0x3b82f0(0x15a)],_0x1ea584[_0x2050f1][_0x3b82f0(0x1bf)]=_0x25c33f[_0x3b82f0(0x1bf)],_0x1ea584[_0x2050f1][_0x3b82f0(0xc8)]='true',console[_0x3b82f0(0xfb)]('1',_0x2050f1),_0xae90db-=_0x204f0c,_0x2050f1++;if(_0xae90db<=0x0)break;}}if(_0xae90db>0x0){var _0x4a7658=await product[_0x3b82f0(0x1bb)]({'product_code':_0x4dbf78});console[_0x3b82f0(0xfb)]('2',_0x2050f1),_0x1ea584[_0x2050f1]={},_0x1ea584[_0x2050f1][_0x3b82f0(0xf9)]=_0x4a7658[_0x3b82f0(0x167)],_0x1ea584[_0x2050f1]['product_code']=_0x4dbf78,_0x1ea584[_0x2050f1]['product_id']=_0x4a7658[_0x3b82f0(0xd6)]['valueOf'](),_0x1ea584[_0x2050f1][_0x3b82f0(0xd0)]=_0xae90db,_0x1ea584[_0x2050f1][_0x3b82f0(0x174)]=_0x4a7658['unit'],_0x1ea584[_0x2050f1][_0x3b82f0(0x13a)]=_0x4a7658[_0x3b82f0(0x1da)],_0x1ea584[_0x2050f1]['primary_code']=_0x4a7658[_0x3b82f0(0x1ad)],_0x1ea584[_0x2050f1]['secondary_code']=_0x4a7658['secondary_code'],_0x1ea584[_0x2050f1][_0x3b82f0(0xd1)]=_0x4a7658[_0x3b82f0(0xd1)],_0x1ea584[_0x2050f1][_0x3b82f0(0x9b)]=_0x4a7658[_0x3b82f0(0x93)],_0x1ea584[_0x2050f1][_0x3b82f0(0x191)]=_0x4a7658[_0x3b82f0(0x191)],_0x1ea584[_0x2050f1][_0x3b82f0(0xc8)]=_0x3b82f0(0x15c),console[_0x3b82f0(0xfb)]('There\x20is\x20'+_0xae90db+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20'+_0x2050f1+_0x3b82f0(0x129)+_0x4dbf78),_0x2050f1++;}}_0xdf18c8[_0x3b82f0(0x16c)](_0x1ea584);}catch(_0x344030){console[_0x3b82f0(0xfb)](_0x344030);}}),router[a0_0x326140(0xee)](a0_0x326140(0x136),async(_0x1f20ae,_0x1f9cfc)=>{var _0x99e8fa=a0_0x326140;const {product_code:_0x20ad6c}=_0x1f20ae[_0x99e8fa(0xbe)];var _0x5513c9;const _0xc72264=await product[_0x99e8fa(0x141)]([{'$match':{'primary_code':_0x20ad6c}},{'$group':{'_id':_0x99e8fa(0xfa),'name':{'$first':_0x99e8fa(0x150)},'category':{'$first':_0x99e8fa(0x13f)},'brand':{'$first':_0x99e8fa(0x18b)},'unit':{'$first':_0x99e8fa(0x12a)},'alertquantity':{'$first':_0x99e8fa(0xe2)},'product_code':{'$first':_0x99e8fa(0x1c6)},'primary_code':{'$first':_0x99e8fa(0x1a1)},'secondary_code':{'$first':_0x99e8fa(0xf7)},'maxStocks':{'$first':_0x99e8fa(0x13c)},'maxProdPerUnit':{'$first':_0x99e8fa(0x146)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x99e8fa(0x106)},'gross_price':{'$first':_0x99e8fa(0xb5)},'sales_category':{'$first':_0x99e8fa(0x15f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x23b186=await product[_0x99e8fa(0x141)]([{'$match':{'secondary_code':_0x20ad6c}},{'$group':{'_id':_0x99e8fa(0xfa),'name':{'$first':_0x99e8fa(0x150)},'category':{'$first':_0x99e8fa(0x13f)},'brand':{'$first':'$brand'},'unit':{'$first':_0x99e8fa(0x12a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x99e8fa(0x1a1)},'secondary_code':{'$first':_0x99e8fa(0xf7)},'maxStocks':{'$first':_0x99e8fa(0x13c)},'maxProdPerUnit':{'$first':_0x99e8fa(0x146)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x99e8fa(0x106)},'gross_price':{'$first':_0x99e8fa(0xb5)},'sales_category':{'$first':_0x99e8fa(0x15f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0xc72264[_0x99e8fa(0x187)]>0x0)_0x5513c9=_0xc72264;else _0x23b186[_0x99e8fa(0x187)]>0x0&&(_0x5513c9=_0x23b186);_0x1f9cfc['json'](_0x5513c9);}),router['post'](a0_0x326140(0x1a3),async(_0x22ee53,_0x29334a)=>{var _0x3075b2=a0_0x326140;try{const {group_id:_0x2fd98a,DRSI:_0x131715,dateofreq:_0x35dca6,PO_number:_0x3fdd19,date:_0x4748f0,warehouse_name:_0x222ac6,typevehicle:_0x27f9d4,deliverydate:_0x166eaf,driver:_0x325155,plate:_0x1ec293,van:_0x17b0eb,TSU:_0xbdfba4,actual_delivery_date:_0x38c175,TFU:_0x38167a,pull_out_date:_0x56b5d2,sales:_0x4f168a,Customer_data:_0x19da87,note:_0xb8778f}=_0x22ee53[_0x3075b2(0xbe)];console[_0x3075b2(0xfb)](typeof _0x2fd98a);for(let _0x3941bc=0x0;_0x3941bc<=_0x2fd98a[_0x3075b2(0x187)]-0x1;_0x3941bc++){const _0x4e5eae=_0x2fd98a[_0x3941bc];let _0x39a246=_0x4e5eae['split']('~');var _0x330db6=_0x39a246[0x0],_0x11edaf=_0x39a246[0x1],_0x568c73=_0x39a246[0x2];}_0x29334a[_0x3075b2(0x16c)](_0x22ee53[_0x3075b2(0xbe)]['group_id']);}catch(_0xcedf8c){console[_0x3075b2(0xfb)](_0xcedf8c);}}),module['exports']=router;