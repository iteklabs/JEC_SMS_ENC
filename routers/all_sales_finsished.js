var a0_0xeb5024=a0_0x1796;(function(_0x5a04bd,_0x5a88bc){var _0x69c173=a0_0x1796,_0x38b702=_0x5a04bd();while(!![]){try{var _0x5881c8=-parseInt(_0x69c173(0x106))/0x1+parseInt(_0x69c173(0xae))/0x2+parseInt(_0x69c173(0xf7))/0x3+-parseInt(_0x69c173(0xc8))/0x4*(-parseInt(_0x69c173(0x187))/0x5)+-parseInt(_0x69c173(0x159))/0x6+-parseInt(_0x69c173(0x14e))/0x7*(-parseInt(_0x69c173(0x16d))/0x8)+-parseInt(_0x69c173(0xd6))/0x9;if(_0x5881c8===_0x5a88bc)break;else _0x38b702['push'](_0x38b702['shift']());}catch(_0x1cbd1c){_0x38b702['push'](_0x38b702['shift']());}}}(a0_0x407c,0x62a18));const express=require('express'),app=express(),router=express[a0_0xeb5024(0x157)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs}=require(a0_0xeb5024(0xec)),auth=require('../middleware/auth'),nodemailer=require(a0_0xeb5024(0x117)),users=require(a0_0xeb5024(0x15a));router[a0_0xeb5024(0xc2)]('/view',auth,async(_0x21680c,_0x9e4f71)=>{var _0x2b6358=a0_0xeb5024;try{const {username:_0x563326,email:_0x499dd6,role:_0x1e4a6}=_0x21680c[_0x2b6358(0x109)],_0x422a15=_0x21680c[_0x2b6358(0x109)],_0x2d7407=await profile[_0x2b6358(0x198)]({'email':_0x422a15[_0x2b6358(0xbc)]}),_0x29bd49=await master_shop[_0x2b6358(0xf4)]();let _0xf3971;if(_0x422a15[_0x2b6358(0x14a)]==_0x2b6358(0x19a)){const _0x12a9d2=await staff[_0x2b6358(0x198)]({'email':_0x422a15['email']});_0xf3971=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x2b6358(0x111)}},{'$unwind':_0x2b6358(0xa7)},{'$group':{'_id':_0x2b6358(0x100),'invoice':{'$first':_0x2b6358(0x108)},'customers':{'$first':'$customer'},'date':{'$first':_0x2b6358(0xf9)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x2b6358(0x1a8)},'total_saleproduct_quantity':{'$sum':_0x2b6358(0xcb)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x2b6358(0x19d)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x2b6358(0x1a1)},'finalize':{'$first':_0x2b6358(0x156)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xf3971=await sales_finished[_0x2b6358(0x140)]([{'$match':{'typeOfProducts':_0x2b6358(0x111)}},{'$unwind':_0x2b6358(0xa7)},{'$group':{'_id':_0x2b6358(0x100),'invoice':{'$first':_0x2b6358(0x108)},'customers':{'$first':_0x2b6358(0x1b1)},'date':{'$first':_0x2b6358(0xf9)},'warehouse_name':{'$first':_0x2b6358(0x11e)},'sale_product':{'$push':_0x2b6358(0xa7)},'note':{'$first':_0x2b6358(0x138)},'return_data':{'$first':_0x2b6358(0x1b0)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x2b6358(0xcb)},'level':{'$addToSet':_0x2b6358(0xbd)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2b6358(0x156)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x29bd49[0x0][_0x2b6358(0x1b5)]==_0x2b6358(0x1a5)){var _0x556f70=users['English'];console['log'](_0x556f70);}else{if(_0x29bd49[0x0][_0x2b6358(0x1b5)]==_0x2b6358(0xbf))var _0x556f70=users['Hindi'];else{if(_0x29bd49[0x0][_0x2b6358(0x1b5)]==_0x2b6358(0x18d))var _0x556f70=users['German'];else{if(_0x29bd49[0x0]['language']==_0x2b6358(0xf2))var _0x556f70=users[_0x2b6358(0xf2)];else{if(_0x29bd49[0x0][_0x2b6358(0x1b5)]=='French')var _0x556f70=users[_0x2b6358(0x19c)];else{if(_0x29bd49[0x0][_0x2b6358(0x1b5)]=='Portuguese\x20(BR)')var _0x556f70=users[_0x2b6358(0xc3)];else{if(_0x29bd49[0x0][_0x2b6358(0x1b5)]=='Chinese')var _0x556f70=users[_0x2b6358(0x197)];else{if(_0x29bd49[0x0]['language']==_0x2b6358(0xc0))var _0x556f70=users[_0x2b6358(0xe7)];}}}}}}}_0x9e4f71[_0x2b6358(0x182)](_0x2b6358(0x17a),{'success':_0x21680c[_0x2b6358(0x155)]('success'),'errors':_0x21680c[_0x2b6358(0x155)]('errors'),'sales':_0xf3971,'profile':_0x2d7407,'role':_0x422a15,'master_shop':_0x29bd49,'language':_0x556f70});}catch(_0x5da6d8){console[_0x2b6358(0xed)](_0x5da6d8);}}),router[a0_0xeb5024(0xc2)](a0_0xeb5024(0xb6),auth,async(_0xfab23e,_0x291cea)=>{var _0x2d0f18=a0_0xeb5024;try{const {username:_0x4a2e26,email:_0x5b7f15,role:_0x3162dd}=_0xfab23e[_0x2d0f18(0x109)],_0x2e3b27=_0xfab23e['user'],_0x285146=await profile['findOne']({'email':_0x2e3b27[_0x2d0f18(0xbc)]}),_0x4312da=await master_shop[_0x2d0f18(0xf4)]();let _0x140179;if(_0x2e3b27[_0x2d0f18(0x14a)]==_0x2d0f18(0x19a)){const _0x17272a=await staff[_0x2d0f18(0x198)]({'email':_0x2e3b27[_0x2d0f18(0xbc)]});_0x140179=await sales_finished[_0x2d0f18(0x140)]([{'$match':{'typeOfProducts':_0x2d0f18(0x18b)}},{'$unwind':_0x2d0f18(0xa7)},{'$group':{'_id':_0x2d0f18(0x100),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x2d0f18(0x1b1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2d0f18(0x11e)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x2d0f18(0x138)},'return_data':{'$first':_0x2d0f18(0x1b0)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2d0f18(0xbd)},'isle':{'$addToSet':_0x2d0f18(0x19d)},'type':{'$addToSet':_0x2d0f18(0x97)},'pallet':{'$addToSet':_0x2d0f18(0x1a1)},'finalize':{'$first':_0x2d0f18(0x156)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x140179=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x2d0f18(0x18b)}},{'$unwind':_0x2d0f18(0xa7)},{'$group':{'_id':_0x2d0f18(0x100),'invoice':{'$first':_0x2d0f18(0x108)},'customers':{'$first':_0x2d0f18(0x1b1)},'date':{'$first':_0x2d0f18(0xf9)},'warehouse_name':{'$first':_0x2d0f18(0x11e)},'sale_product':{'$push':_0x2d0f18(0xa7)},'note':{'$first':_0x2d0f18(0x138)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x2d0f18(0x1a8)},'total_saleproduct_quantity':{'$sum':_0x2d0f18(0xcb)},'level':{'$addToSet':_0x2d0f18(0xbd)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2d0f18(0x97)},'pallet':{'$addToSet':_0x2d0f18(0x1a1)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4312da[0x0][_0x2d0f18(0x1b5)]==_0x2d0f18(0x1a5)){var _0x498009=users[_0x2d0f18(0x165)];console[_0x2d0f18(0xed)](_0x498009);}else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]=='Hindi')var _0x498009=users[_0x2d0f18(0xbf)];else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]==_0x2d0f18(0x18d))var _0x498009=users[_0x2d0f18(0x18d)];else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]=='Spanish')var _0x498009=users[_0x2d0f18(0xf2)];else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]==_0x2d0f18(0x19c))var _0x498009=users['French'];else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]==_0x2d0f18(0x12b))var _0x498009=users['Portuguese'];else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]==_0x2d0f18(0x197))var _0x498009=users[_0x2d0f18(0x197)];else{if(_0x4312da[0x0][_0x2d0f18(0x1b5)]==_0x2d0f18(0xc0))var _0x498009=users[_0x2d0f18(0xe7)];}}}}}}}_0x291cea[_0x2d0f18(0x182)]('all_sales_finished_logs',{'success':_0xfab23e[_0x2d0f18(0x155)](_0x2d0f18(0x188)),'errors':_0xfab23e[_0x2d0f18(0x155)](_0x2d0f18(0x9f)),'sales':_0x140179,'profile':_0x285146,'role':_0x2e3b27,'master_shop':_0x4312da,'language':_0x498009});}catch(_0x4718a0){console['log'](_0x4718a0);}});function a0_0x1796(_0x1262b6,_0x566313){var _0x407c0d=a0_0x407c();return a0_0x1796=function(_0x1796ca,_0x3d0479){_0x1796ca=_0x1796ca-0x96;var _0x55e71b=_0x407c0d[_0x1796ca];return _0x55e71b;},a0_0x1796(_0x1262b6,_0x566313);}async function getRandom8DigitNumber(){var _0x573104=a0_0xeb5024;const _0x4251e0=0x989680,_0x4b2b7b=0x5f5e0ff,_0x5be35f=Math[_0x573104(0x112)](Math[_0x573104(0xef)]()*(_0x4b2b7b-_0x4251e0+0x1))+_0x4251e0;var _0x5276ee;const _0x58cbb0=await sales_finished[_0x573104(0x198)]({'invoice':_0x573104(0x195)+_0x5be35f});return _0x58cbb0&&_0x58cbb0[_0x573104(0x1ac)]>0x0?_0x5276ee=_0x573104(0x195)+_0x5be35f:_0x5276ee=_0x573104(0x195)+_0x5be35f,_0x5276ee;}router['get'](a0_0xeb5024(0xa3),auth,async(_0x22875f,_0x13bdeb)=>{var _0xd7e967=a0_0xeb5024;try{const {username:_0x44f7b1,email:_0xd561d5,role:_0x2d3ff6}=_0x22875f[_0xd7e967(0x109)],_0x295cd4=_0x22875f['user'],_0xdeb495=await profile['findOne']({'email':_0x295cd4['email']}),_0x4bc231=await master_shop[_0xd7e967(0xf4)](),_0x8835c1=await customer[_0xd7e967(0xf4)]({});let _0x5cd459;if(_0x295cd4[_0xd7e967(0x14a)]==_0xd7e967(0x19a)){const _0x197a65=await staff[_0xd7e967(0x198)]({'email':_0x295cd4[_0xd7e967(0xbc)]});_0x5cd459=await warehouse[_0xd7e967(0x140)]([{'$match':{'status':_0xd7e967(0xa8),'name':_0x197a65['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0xd7e967(0x192)}}},{'$sort':{'name':0x1}}]);}else _0x5cd459=await warehouse[_0xd7e967(0x140)]([{'$match':{'status':_0xd7e967(0xa8)}},{'$group':{'_id':_0xd7e967(0x192),'name':{'$first':_0xd7e967(0x192)}}},{'$sort':{'name':0x1}}]);const _0x2b6f12=await product[_0xd7e967(0xf4)]({});var _0x445368=['Ambient','Enclosed'];const _0x4b17c4=await sales_finished[_0xd7e967(0xf4)]({}),_0x555634=_0x4b17c4[_0xd7e967(0x1ac)]+0x1,_0x52a3c2=_0xd7e967(0x195)+_0x555634[_0xd7e967(0x18a)]()['padStart'](0x5,'0');if(_0x4bc231[0x0]['language']==_0xd7e967(0x1a5)){var _0x1bd793=users[_0xd7e967(0x165)];console[_0xd7e967(0xed)](_0x1bd793);}else{if(_0x4bc231[0x0][_0xd7e967(0x1b5)]==_0xd7e967(0xbf))var _0x1bd793=users[_0xd7e967(0xbf)];else{if(_0x4bc231[0x0][_0xd7e967(0x1b5)]==_0xd7e967(0x18d))var _0x1bd793=users[_0xd7e967(0x18d)];else{if(_0x4bc231[0x0][_0xd7e967(0x1b5)]=='Spanish')var _0x1bd793=users['Spanish'];else{if(_0x4bc231[0x0]['language']==_0xd7e967(0x19c))var _0x1bd793=users['French'];else{if(_0x4bc231[0x0][_0xd7e967(0x1b5)]==_0xd7e967(0x12b))var _0x1bd793=users[_0xd7e967(0xc3)];else{if(_0x4bc231[0x0][_0xd7e967(0x1b5)]==_0xd7e967(0x197))var _0x1bd793=users[_0xd7e967(0x197)];else{if(_0x4bc231[0x0][_0xd7e967(0x1b5)]=='Arabic\x20(ae)')var _0x1bd793=users['Arabic'];}}}}}}}const _0x498c4a=getRandom8DigitNumber();_0x498c4a[_0xd7e967(0x185)](_0x5a6e44=>{var _0x323d36=_0xd7e967;_0x13bdeb['render'](_0x323d36(0x9d),{'success':_0x22875f[_0x323d36(0x155)](_0x323d36(0x188)),'errors':_0x22875f['flash']('errors'),'role':_0x295cd4,'profile':_0xdeb495,'customer':_0x8835c1,'warehouse':_0x5cd459,'product':_0x2b6f12,'invoice':_0x5a6e44,'master_shop':_0x4bc231,'language':_0x1bd793,'rooms_data':_0x445368});})[_0xd7e967(0x153)](_0x218b6b=>{var _0x3c39dd=_0xd7e967;_0x22875f[_0x3c39dd(0x155)]('errors',_0x3c39dd(0x1ad)),_0x13bdeb[_0x3c39dd(0x15b)]('/all_sales_finished/view');});}catch(_0x11b719){console['log'](_0x11b719);}}),router[a0_0xeb5024(0xc2)](a0_0xeb5024(0xe8),auth,async(_0x4b067c,_0x445bf2)=>{var _0x3867f2=a0_0xeb5024;try{const {username:_0x983581,email:_0x13f047,role:_0x84d2c4}=_0x4b067c[_0x3867f2(0x109)],_0x40efd5=_0x4b067c[_0x3867f2(0x109)],_0x2f30d1=await profile[_0x3867f2(0x198)]({'email':_0x40efd5['email']}),_0x5e4783=await master_shop[_0x3867f2(0xf4)](),_0x22adc2=await customer[_0x3867f2(0xf4)]({});let _0x58dc89;if(_0x40efd5[_0x3867f2(0x14a)]==_0x3867f2(0x19a)){const _0x55cf5d=await staff[_0x3867f2(0x198)]({'email':_0x40efd5[_0x3867f2(0xbc)]});_0x58dc89=await warehouse[_0x3867f2(0x140)]([{'$match':{'status':_0x3867f2(0xa8),'name':_0x55cf5d[_0x3867f2(0xdb)]}},{'$group':{'_id':_0x3867f2(0x192),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x58dc89=await warehouse[_0x3867f2(0x140)]([{'$match':{'status':_0x3867f2(0xa8)}},{'$group':{'_id':'$name','name':{'$first':_0x3867f2(0x192)}}},{'$sort':{'name':0x1}}]);const _0x5d62b5=await product['find']({});var _0x4e0b9a=[_0x3867f2(0x119),_0x3867f2(0x14b)];const _0xcecde2=await sales_finished[_0x3867f2(0xf4)]({}),_0x5cb939=_0xcecde2['length']+0x1,_0x25f338=_0x3867f2(0x195)+_0x5cb939[_0x3867f2(0x18a)]()[_0x3867f2(0x16b)](0x5,'0');if(_0x5e4783[0x0][_0x3867f2(0x1b5)]==_0x3867f2(0x1a5)){var _0x1fc48f=users[_0x3867f2(0x165)];console[_0x3867f2(0xed)](_0x1fc48f);}else{if(_0x5e4783[0x0][_0x3867f2(0x1b5)]==_0x3867f2(0xbf))var _0x1fc48f=users[_0x3867f2(0xbf)];else{if(_0x5e4783[0x0][_0x3867f2(0x1b5)]=='German')var _0x1fc48f=users[_0x3867f2(0x18d)];else{if(_0x5e4783[0x0][_0x3867f2(0x1b5)]==_0x3867f2(0xf2))var _0x1fc48f=users['Spanish'];else{if(_0x5e4783[0x0][_0x3867f2(0x1b5)]=='French')var _0x1fc48f=users[_0x3867f2(0x19c)];else{if(_0x5e4783[0x0][_0x3867f2(0x1b5)]=='Portuguese\x20(BR)')var _0x1fc48f=users[_0x3867f2(0xc3)];else{if(_0x5e4783[0x0]['language']==_0x3867f2(0x197))var _0x1fc48f=users[_0x3867f2(0x197)];else{if(_0x5e4783[0x0][_0x3867f2(0x1b5)]=='Arabic\x20(ae)')var _0x1fc48f=users[_0x3867f2(0xe7)];}}}}}}}const _0x31f2db=getRandom8DigitNumber();_0x31f2db['then'](_0xa717ee=>{var _0x49f129=_0x3867f2;_0x445bf2[_0x49f129(0x182)]('add_sales_finished_logs',{'success':_0x4b067c[_0x49f129(0x155)](_0x49f129(0x188)),'errors':_0x4b067c[_0x49f129(0x155)](_0x49f129(0x9f)),'role':_0x40efd5,'profile':_0x2f30d1,'customer':_0x22adc2,'warehouse':_0x58dc89,'product':_0x5d62b5,'invoice':_0xa717ee,'master_shop':_0x5e4783,'language':_0x1fc48f,'rooms_data':_0x4e0b9a});})[_0x3867f2(0x153)](_0x1c1f20=>{var _0x2959b8=_0x3867f2;_0x4b067c[_0x2959b8(0x155)]('errors',_0x2959b8(0x1ad)),_0x445bf2[_0x2959b8(0x15b)](_0x2959b8(0xe9));});}catch(_0x1aa578){console[_0x3867f2(0xed)](_0x1aa578);}}),router['post'](a0_0xeb5024(0xe8),auth,async(_0x3bd9b9,_0x12b18a)=>{var _0x291416=a0_0xeb5024;try{const {invoice:_0x1b170d,date:_0x5c693d,warehouse_name:_0x474069,product_name:_0x26472a,note:_0xb6175d,room:_0x227eda,primary_code:_0x5cd70c,secondary_code:_0x898c22,prod_code:_0x33b86e,SCRN:_0xa81b02,ReqBy:_0x739e2a,dateofreq:_0x5d4235,PO_number:_0x47de1d,typeservicesData:_0x59a6ed,typevehicle:_0xe7f5d0,destination:_0xcb5f25,deliverydate:_0x5b8a78,driver:_0x215fff,plate:_0x2a84d1,van:_0x2445fc,DRSI:_0x28e767,TSU:_0x11658a,TFU:_0x491385,mode_transpo:_0x10308c,name_driver:_0x45facd,type_of_products:_0xb5ac59}=_0x3bd9b9[_0x291416(0x105)];if(typeof _0x26472a=='string')var _0xbe1919=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xa0)]],_0x21ebb7=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xa4)]],_0x5962f2=[_0x3bd9b9['body']['carton']],_0x5ab739=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0x173)]],_0x293541=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0x158)]],_0x219d59=[_0x3bd9b9[_0x291416(0x105)]['prod_code']],_0x1e3af1=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0x160)]],_0x46fc5f=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xda)]],_0x5bce50=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xbe)]],_0x1bee66=[_0x3bd9b9[_0x291416(0x105)]['batch_code']],_0x2919cb=[_0x3bd9b9['body']['expiry_date']],_0x186d38=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0x1a0)]],_0x2e4a1a=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xfa)]],_0x1260e5=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xd5)]],_0x594ddb=[_0x3bd9b9[_0x291416(0x105)]['RoomAssigned']],_0x422430=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xea)]],_0x40fa07=[_0x3bd9b9['body'][_0x291416(0x15d)]],_0x2e0331=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0x168)]],_0x4be57e=[_0x3bd9b9[_0x291416(0x105)][_0x291416(0xb5)]];else var _0xbe1919=[..._0x3bd9b9['body'][_0x291416(0xa0)]],_0x21ebb7=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0xa4)]],_0x5962f2=[..._0x3bd9b9['body'][_0x291416(0x16a)]],_0x5ab739=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0x173)]],_0x293541=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0x158)]],_0x219d59=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0xb8)]],_0x1e3af1=[..._0x3bd9b9['body'][_0x291416(0x160)]],_0x46fc5f=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0xda)]],_0x5bce50=[..._0x3bd9b9['body'][_0x291416(0xbe)]],_0x1bee66=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0xfd)]],_0x2919cb=[..._0x3bd9b9['body']['expiry_date']],_0x186d38=[..._0x3bd9b9['body'][_0x291416(0x1a0)]],_0x2e4a1a=[..._0x3bd9b9['body']['max_per_unit']],_0x1260e5=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0xd5)]],_0x594ddb=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0x10e)]],_0x422430=[..._0x3bd9b9[_0x291416(0x105)]['prod_invoice']],_0x40fa07=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0x15d)]],_0x2e0331=[..._0x3bd9b9[_0x291416(0x105)][_0x291416(0x168)]],_0x4be57e=[..._0x3bd9b9['body'][_0x291416(0xb5)]];const _0x1b3e51=_0xbe1919['map'](_0x2067c0=>{return _0x2067c0={'product_name':_0x2067c0};});_0x21ebb7[_0x291416(0xaf)]((_0x5966bf,_0x36c741)=>{var _0x4622a6=_0x291416;_0x1b3e51[_0x36c741][_0x4622a6(0xa4)]=_0x5966bf;}),_0x5962f2[_0x291416(0xaf)]((_0xbc47d6,_0x2c4817)=>{var _0x561ec9=_0x291416;_0x1b3e51[_0x2c4817]['quantity']=Math[_0x561ec9(0x1a4)](_0xbc47d6);}),_0xbe1919[_0x291416(0xaf)]((_0x3d144a,_0x588438)=>{var _0x46d555=_0x291416;_0x1b3e51[_0x588438][_0x46d555(0x13c)]=_0x3bd9b9[_0x46d555(0x105)][_0x46d555(0x164)];}),_0x4be57e['forEach']((_0xde597b,_0x3be232)=>{var _0x50563e=_0x291416;_0x1b3e51[_0x3be232][_0x50563e(0xb5)]=_0xde597b;}),_0x2e0331['forEach']((_0xb4efb8,_0x9854ec)=>{var _0x3e8bff=_0x291416;_0x1b3e51[_0x9854ec][_0x3e8bff(0x168)]=_0xb4efb8;}),_0x40fa07[_0x291416(0xaf)]((_0x4c5d48,_0x3f3e2a)=>{_0x1b3e51[_0x3f3e2a]['id_transaction_from']=_0x4c5d48;}),_0x5ab739[_0x291416(0xaf)]((_0x3e7da2,_0x2f1d8a)=>{var _0x1517c8=_0x291416;_0x1b3e51[_0x2f1d8a][_0x1517c8(0x173)]=_0x3e7da2;}),_0x293541['forEach']((_0x184701,_0x3237ff)=>{_0x1b3e51[_0x3237ff]['secondary_code']=_0x184701;}),_0x219d59[_0x291416(0xaf)]((_0x467968,_0x19810c)=>{var _0x3a262f=_0x291416;_0x1b3e51[_0x19810c][_0x3a262f(0x116)]=_0x467968;}),_0x1e3af1[_0x291416(0xaf)]((_0x48cd9e,_0x240542)=>{var _0x365fa4=_0x291416,_0xb023=_0x48cd9e[_0x365fa4(0x102)](/[A-Za-z]+/)[0x0],_0x40efac=parseInt(_0x48cd9e[_0x365fa4(0x102)](/\d+/)[0x0]);_0x1b3e51[_0x240542]['bay']=_0x40efac,_0x1b3e51[_0x240542][_0x365fa4(0xd1)]=_0xb023;}),_0x46fc5f[_0x291416(0xaf)]((_0x226187,_0x35f6ec)=>{var _0x1accd2=_0x291416;_0x1b3e51[_0x35f6ec][_0x1accd2(0xb1)]=_0x226187;}),_0x5bce50[_0x291416(0xaf)]((_0x27c14d,_0x51bdfa)=>{var _0x37a42e=_0x291416;_0x1b3e51[_0x51bdfa][_0x37a42e(0xbe)]=_0x27c14d;}),_0x1bee66['forEach']((_0x3e3fb2,_0x1255a1)=>{var _0x387a21=_0x291416;_0x1b3e51[_0x1255a1][_0x387a21(0xfd)]=_0x3e3fb2;}),_0x2919cb[_0x291416(0xaf)]((_0x27d294,_0x55ce65)=>{var _0x5afd0f=_0x291416;_0x1b3e51[_0x55ce65][_0x5afd0f(0xf0)]=_0x27d294;}),_0x186d38[_0x291416(0xaf)]((_0x48668e,_0x4ca803)=>{var _0x48fe4d=_0x291416;_0x1b3e51[_0x4ca803][_0x48fe4d(0xd0)]=_0x48668e;}),_0x2e4a1a[_0x291416(0xaf)]((_0x1f690a,_0x29e258)=>{_0x1b3e51[_0x29e258]['maxperunit']=_0x1f690a;}),_0x1260e5['forEach']((_0x309b5c,_0xe681ae)=>{var _0x25e33e=_0x291416;_0x1b3e51[_0xe681ae][_0x25e33e(0xd5)]=_0x309b5c;}),_0x594ddb[_0x291416(0xaf)]((_0x443cfb,_0x535968)=>{var _0x2fbdf0=_0x291416;_0x1b3e51[_0x535968][_0x2fbdf0(0x145)]=_0x443cfb;}),_0x422430[_0x291416(0xaf)]((_0xfd5c2e,_0x1cc586)=>{var _0x3c52ac=_0x291416;_0x1b3e51[_0x1cc586][_0x3c52ac(0xab)]=_0xfd5c2e,_0x1b3e51[_0x1cc586][_0x3c52ac(0x166)]=_0x5c693d;});const _0x78edc4=new sales_logs();await _0x78edc4[_0x291416(0x128)](),_0x422430[_0x291416(0xaf)]((_0x39b81b,_0x16fe14)=>{var _0x278059=_0x291416;_0x1b3e51[_0x16fe14][_0x278059(0x12f)]=_0x278059(0xdc)+_0x78edc4[_0x278059(0x189)][_0x278059(0x18a)]()[_0x278059(0x16b)](0x8,'0');});var _0x24c55e=0x0;_0x1b3e51[_0x291416(0xaf)](_0x5edd6a=>{var _0x5c5946=_0x291416;parseFloat(_0x5edd6a['stock'])<parseFloat(_0x5edd6a[_0x5c5946(0x14d)])&&parseFloat(_0x5edd6a[_0x5c5946(0x14d)])>parseFloat(_0x5edd6a[_0x5c5946(0xa4)])&&(console[_0x5c5946(0xed)](_0x5edd6a[_0x5c5946(0xa4)]+_0x5c5946(0x17f)+_0x5edd6a[_0x5c5946(0x14d)]),_0x24c55e++);});if(_0x24c55e!=0x0)return _0x3bd9b9['flash']('errors',_0x291416(0x15c)),_0x12b18a[_0x291416(0x15b)](_0x291416(0x175));const _0x1419e2=_0x1b3e51[_0x291416(0x16f)](_0x3b4a0c=>_0x3b4a0c[_0x291416(0x14d)]!=='0'&&_0x3b4a0c[_0x291416(0x14d)]!==''),_0x4b759f=new sales_finished({'invoice':'LOG-OUT-'+_0x78edc4[_0x291416(0x189)][_0x291416(0x18a)]()['padStart'](0x8,'0'),'sales_data':_0x3bd9b9[_0x291416(0x105)][_0x291416(0x164)],'customer':_0x3bd9b9[_0x291416(0x105)][_0x291416(0x17b)],'date':_0x5c693d,'warehouse_name':_0x474069,'sale_product':_0x1419e2,'note':_0xb6175d,'room':_0x227eda,'primary_code':_0x5cd70c,'secondary_code':_0x898c22,'prod_code':_0x33b86e,'SCRN':_0xa81b02,'finalize':'False','mode_transpo':_0x10308c,'name_driver':_0x45facd,'ReqBy':_0x739e2a,'dateofreq':_0x5d4235,'PO_number':_0x47de1d,'typeservicesData':_0x59a6ed,'typevehicle':_0xe7f5d0,'destination':_0xcb5f25,'deliverydate':_0x5b8a78,'driver':_0x215fff,'plate':_0x2a84d1,'van':_0x2445fc,'DRSI':_0x28e767,'TSU':_0x11658a,'TFU':_0x491385,'typeOfProducts':_0xb5ac59}),_0x4e44f8=await _0x4b759f['save'](),_0x5d1f59=await sales_finished[_0x291416(0x198)]({'invoice':_0x1b170d});_0x3bd9b9[_0x291416(0x155)]('success','Sales\x20Add\x20successfully'),_0x12b18a[_0x291416(0x15b)]('/all_sales_finished/preview/'+_0x4e44f8[_0x291416(0x110)]);}catch(_0x54f869){console[_0x291416(0xed)](_0x54f869);}}),router[a0_0xeb5024(0xc2)]('/view/add_sales/:id',auth,async(_0x4d8908,_0x10f985)=>{var _0x31bcfa=a0_0xeb5024;try{const _0x1d9de2=_0x4d8908['params']['id'];console[_0x31bcfa(0xed)](_0x1d9de2);const _0x3f0b37=await product[_0x31bcfa(0xf4)](),_0x52e331=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1d9de2}},{'$unwind':_0x31bcfa(0x176)},{'$group':{'_id':_0x31bcfa(0x177)}}]);console[_0x31bcfa(0xed)](_0x31bcfa(0x121),_0x52e331),_0x10f985[_0x31bcfa(0x1a7)](0xc8)[_0x31bcfa(0xe2)]({'purchases_data':_0x52e331,'product_data':_0x3f0b37});}catch(_0xa5343a){console[_0x31bcfa(0xed)](_0xa5343a);}}),router['post'](a0_0xeb5024(0x12d),auth,async(_0x1f7a48,_0x17d402)=>{var _0x27f936=a0_0xeb5024;try{const {warehouse_data:_0xcf6ea6,product_data:_0x132ff1}=_0x1f7a48[_0x27f936(0x105)];console[_0x27f936(0xed)](_0x1f7a48[_0x27f936(0x105)][_0x27f936(0x126)]);;const _0x3ee5e9=await master_shop['find']();console[_0x27f936(0xed)](_0x27f936(0x13f),_0x3ee5e9);const _0x1586be=await product[_0x27f936(0x198)]({'name':_0x132ff1});console[_0x27f936(0xed)](_0x27f936(0xf1),_0x1586be);const _0x3515d6=await warehouse[_0x27f936(0x140)]([{'$match':{'name':_0xcf6ea6}},{'$unwind':_0x27f936(0xc9)},{'$match':{'product_details.product_name':_0x132ff1}},{'$group':{'_id':_0x27f936(0x122),'product_stock':{'$first':_0x27f936(0xde)}}}]);console[_0x27f936(0xed)](_0x27f936(0xd8),_0x3515d6),_0x17d402[_0x27f936(0x1a7)](0xc8)[_0x27f936(0xe2)]({'master':_0x3ee5e9,'new_product':_0x1586be,'stock_data':_0x3515d6});}catch(_0x56effe){console['log'](_0x56effe);}}),router[a0_0xeb5024(0x179)]('/view/add_sales',auth,async(_0x420288,_0x2d18d4)=>{var _0x4ab7c2=a0_0xeb5024;try{const {invoice:_0x42ebd6,date:_0x43dafe,warehouse_name:_0x321929,product_name:_0x5a05ce,note:_0x482a57,room:_0x59bc6d,primary_code:_0x101eb6,secondary_code:_0x49d0f2,prod_code:_0x3a60e8,SCRN:_0x30d6a6,ReqBy:_0x225a5c,dateofreq:_0x18bb2e,PO_number:_0x19c3d3,typeservicesData:_0x57e3a6,typevehicle:_0x59b41c,destination:_0x5bbf60,deliverydate:_0x323199,driver:_0x5c4336,plate:_0x178a84,van:_0x11942d,DRSI:_0x32de15,TSU:_0x57054f,TFU:_0x14a7c5,mode_transpo:_0x31207d,name_driver:_0x2e2269,pull_out_date:_0x5c263a,actual_delivery_date:_0x3a07f2}=_0x420288[_0x4ab7c2(0x105)];if(typeof _0x5a05ce==_0x4ab7c2(0x13d))var _0x46285c=[_0x420288['body'][_0x4ab7c2(0xa0)]],_0x1d6a7c=[_0x420288['body']['stock']],_0x40172b=[_0x420288['body'][_0x4ab7c2(0x16a)]],_0x1d6f49=[_0x420288['body']['primary_code']],_0x175819=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x158)]],_0x5dcfd6=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xb8)]],_0x5f5ab7=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x160)]],_0x187a6b=[_0x420288[_0x4ab7c2(0x105)]['primary_unit']],_0x25d69a=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xbe)]],_0x2f2ec5=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xfd)]],_0x16cbaf=[_0x420288[_0x4ab7c2(0x105)]['expiry_date']],_0x1115d8=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x1a0)]],_0x1646e8=[_0x420288['body']['max_per_unit']],_0x4cf48d=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xd5)]],_0x4a9b8d=[_0x420288[_0x4ab7c2(0x105)]['RoomAssigned']],_0x1fc3e6=[_0x420288['body'][_0x4ab7c2(0xea)]],_0x4ca9cc=[_0x420288['body'][_0x4ab7c2(0x15d)]],_0x4f3d4b=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x168)]],_0x22288e=[_0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xb5)]];else var _0x46285c=[..._0x420288['body']['product_name']],_0x1d6a7c=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xa4)]],_0x40172b=[..._0x420288[_0x4ab7c2(0x105)]['carton']],_0x1d6f49=[..._0x420288[_0x4ab7c2(0x105)]['primary_code']],_0x175819=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x158)]],_0x5dcfd6=[..._0x420288[_0x4ab7c2(0x105)]['prod_code']],_0x5f5ab7=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x160)]],_0x187a6b=[..._0x420288[_0x4ab7c2(0x105)]['primary_unit']],_0x25d69a=[..._0x420288[_0x4ab7c2(0x105)]['secondary_unit']],_0x2f2ec5=[..._0x420288['body'][_0x4ab7c2(0xfd)]],_0x16cbaf=[..._0x420288['body'][_0x4ab7c2(0xf0)]],_0x1115d8=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x1a0)]],_0x1646e8=[..._0x420288['body'][_0x4ab7c2(0xfa)]],_0x4cf48d=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xd5)]],_0x4a9b8d=[..._0x420288['body'][_0x4ab7c2(0x10e)]],_0x1fc3e6=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0xea)]],_0x4ca9cc=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x15d)]],_0x4f3d4b=[..._0x420288[_0x4ab7c2(0x105)][_0x4ab7c2(0x168)]],_0x22288e=[..._0x420288[_0x4ab7c2(0x105)]['gross_price']];const _0x4bf590=_0x46285c[_0x4ab7c2(0x1a2)](_0x3408af=>{return _0x3408af={'product_name':_0x3408af};});_0x1d6a7c[_0x4ab7c2(0xaf)]((_0x28e5e8,_0x4804b9)=>{var _0x5a82df=_0x4ab7c2;_0x4bf590[_0x4804b9][_0x5a82df(0xa4)]=_0x28e5e8;}),_0x40172b['forEach']((_0x4d877a,_0x476ae0)=>{var _0x14af5d=_0x4ab7c2;_0x4bf590[_0x476ae0][_0x14af5d(0x14d)]=Math['abs'](_0x4d877a);}),_0x46285c[_0x4ab7c2(0xaf)]((_0x2d6135,_0x331b91)=>{var _0x7b71a1=_0x4ab7c2;_0x4bf590[_0x331b91][_0x7b71a1(0x13c)]=_0x420288[_0x7b71a1(0x105)][_0x7b71a1(0x164)];}),_0x22288e['forEach']((_0x274f17,_0x52bd65)=>{var _0x418087=_0x4ab7c2;_0x4bf590[_0x52bd65][_0x418087(0xb5)]=_0x274f17;}),_0x4f3d4b['forEach']((_0x3e408c,_0x155fa4)=>{var _0x11d073=_0x4ab7c2;_0x4bf590[_0x155fa4][_0x11d073(0x168)]=_0x3e408c;}),_0x4ca9cc[_0x4ab7c2(0xaf)]((_0x2bbe3d,_0x498db2)=>{var _0x1f7117=_0x4ab7c2;_0x4bf590[_0x498db2][_0x1f7117(0x15d)]=_0x2bbe3d;}),_0x1d6f49[_0x4ab7c2(0xaf)]((_0x57e633,_0x32870f)=>{var _0x4c2bc3=_0x4ab7c2;_0x4bf590[_0x32870f][_0x4c2bc3(0x173)]=_0x57e633;}),_0x175819[_0x4ab7c2(0xaf)]((_0x46d7c9,_0x377934)=>{_0x4bf590[_0x377934]['secondary_code']=_0x46d7c9;}),_0x5dcfd6[_0x4ab7c2(0xaf)]((_0x4e2746,_0x584afe)=>{_0x4bf590[_0x584afe]['product_code']=_0x4e2746;}),_0x5f5ab7[_0x4ab7c2(0xaf)]((_0x127ce4,_0x1c8488)=>{var _0x106487=_0x4ab7c2,_0x3db2f3=_0x127ce4[_0x106487(0x102)](/[A-Za-z]+/)[0x0],_0x7d45e7=parseInt(_0x127ce4['match'](/\d+/)[0x0]);_0x4bf590[_0x1c8488]['bay']=_0x7d45e7,_0x4bf590[_0x1c8488][_0x106487(0xd1)]=_0x3db2f3;}),_0x187a6b[_0x4ab7c2(0xaf)]((_0x2303b5,_0x17247c)=>{var _0x3c2fb8=_0x4ab7c2;_0x4bf590[_0x17247c][_0x3c2fb8(0xb1)]=_0x2303b5;}),_0x25d69a['forEach']((_0x3dab89,_0x1975d4)=>{_0x4bf590[_0x1975d4]['secondary_unit']=_0x3dab89;}),_0x2f2ec5['forEach']((_0x3d316c,_0x1c963d)=>{_0x4bf590[_0x1c963d]['batch_code']=_0x3d316c;}),_0x16cbaf[_0x4ab7c2(0xaf)]((_0x3aa9b0,_0x345aa5)=>{var _0x33b68f=_0x4ab7c2;_0x4bf590[_0x345aa5][_0x33b68f(0xf0)]=_0x3aa9b0;}),_0x1115d8[_0x4ab7c2(0xaf)]((_0x5a37af,_0x3a06b8)=>{var _0x4a653a=_0x4ab7c2;_0x4bf590[_0x3a06b8][_0x4a653a(0xd0)]=_0x5a37af;}),_0x1646e8[_0x4ab7c2(0xaf)]((_0x965568,_0x220ec6)=>{var _0x3e0ebe=_0x4ab7c2;_0x4bf590[_0x220ec6][_0x3e0ebe(0x193)]=_0x965568;}),_0x4cf48d[_0x4ab7c2(0xaf)]((_0x2391d8,_0xbeb4a8)=>{var _0x3e1410=_0x4ab7c2;_0x4bf590[_0xbeb4a8][_0x3e1410(0xd5)]=_0x2391d8;}),_0x4a9b8d[_0x4ab7c2(0xaf)]((_0x2719de,_0x2984df)=>{var _0x247b9b=_0x4ab7c2;_0x4bf590[_0x2984df][_0x247b9b(0x145)]=_0x2719de;}),_0x1fc3e6[_0x4ab7c2(0xaf)]((_0x2be6b9,_0x3f9f94)=>{var _0x59d40f=_0x4ab7c2;_0x4bf590[_0x3f9f94][_0x59d40f(0xab)]=_0x2be6b9,_0x4bf590[_0x3f9f94][_0x59d40f(0x166)]=_0x43dafe;});const _0x52deab=new invoice_for_outgoing();await _0x52deab[_0x4ab7c2(0x128)](),_0x1fc3e6['forEach']((_0x3e9b81,_0x2dc8e8)=>{var _0xd8085=_0x4ab7c2;_0x4bf590[_0x2dc8e8][_0xd8085(0x12f)]='OUT-'+_0x52deab[_0xd8085(0x189)][_0xd8085(0x18a)]()[_0xd8085(0x16b)](0x8,'0');});var _0x46f609=0x0;_0x4bf590[_0x4ab7c2(0xaf)](_0x5540f9=>{var _0x25fa5e=_0x4ab7c2;parseFloat(_0x5540f9[_0x25fa5e(0xa4)])<parseFloat(_0x5540f9[_0x25fa5e(0x14d)])&&parseFloat(_0x5540f9[_0x25fa5e(0x14d)])>parseFloat(_0x5540f9['stock'])&&(console[_0x25fa5e(0xed)](_0x5540f9[_0x25fa5e(0xa4)]+_0x25fa5e(0x17f)+_0x5540f9[_0x25fa5e(0x14d)]),_0x46f609++);});if(_0x46f609!=0x0)return _0x420288[_0x4ab7c2(0x155)](_0x4ab7c2(0x9f),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x2d18d4[_0x4ab7c2(0x15b)](_0x4ab7c2(0x175));const _0x533b4e=_0x4bf590['filter'](_0x4d6a2b=>_0x4d6a2b[_0x4ab7c2(0x14d)]!=='0'&&_0x4d6a2b['quantity']!==''),_0x47fea1=new sales_finished({'invoice':_0x4ab7c2(0x1b7)+_0x52deab[_0x4ab7c2(0x189)][_0x4ab7c2(0x18a)]()[_0x4ab7c2(0x16b)](0x8,'0'),'sales_data':_0x420288['body'][_0x4ab7c2(0x164)],'customer':_0x420288[_0x4ab7c2(0x105)]['customer'],'date':_0x43dafe,'warehouse_name':_0x321929,'sale_product':_0x533b4e,'note':_0x482a57,'room':_0x59bc6d,'primary_code':_0x101eb6,'secondary_code':_0x49d0f2,'prod_code':_0x3a60e8,'SCRN':_0x30d6a6,'finalize':_0x4ab7c2(0x171),'mode_transpo':_0x31207d,'name_driver':_0x2e2269,'ReqBy':_0x225a5c,'dateofreq':_0x18bb2e,'PO_number':_0x19c3d3,'typeservicesData':_0x57e3a6,'typevehicle':_0x59b41c,'destination':_0x5bbf60,'deliverydate':_0x323199,'driver':_0x5c4336,'plate':_0x178a84,'van':_0x11942d,'DRSI':_0x32de15,'TSU':_0x57054f,'TFU':_0x14a7c5,'pullout_date':_0x5c263a,'actualdelivery_date':_0x3a07f2,'typeOfProducts':_0x4ab7c2(0x111)}),_0x3075f6=await _0x47fea1[_0x4ab7c2(0x128)](),_0x4fa95d=await sales_finished['findOne']({'invoice':_0x42ebd6});_0x420288[_0x4ab7c2(0x155)]('success',_0x4ab7c2(0x190)),_0x2d18d4['redirect']('/all_sales_finished/preview/'+_0x3075f6[_0x4ab7c2(0x110)]);}catch(_0x531956){console['log'](_0x531956);}}),router['get'](a0_0xeb5024(0x19f),auth,async(_0x36d9c3,_0x5a30a5)=>{var _0x4e562f=a0_0xeb5024;try{const {username:_0x2d5dc9,email:_0x546c70,role:_0x59bb1b}=_0x36d9c3['user'],_0x584868=_0x36d9c3[_0x4e562f(0x109)],_0x24fe81=await profile[_0x4e562f(0x198)]({'email':_0x584868['email']}),_0x1fab61=await master_shop[_0x4e562f(0xf4)](),_0x334d6=_0x36d9c3[_0x4e562f(0x136)]['id'],_0x26411b=await sales_finished['findById'](_0x334d6),_0x26b694=await warehouse['aggregate']([{'$match':{'name':_0x26411b[_0x4e562f(0x9a)]}},{'$unwind':_0x4e562f(0xc9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4e562f(0x122)},'product_stock':{'$first':_0x4e562f(0xde)},'bay':{'$first':_0x4e562f(0x9e)},'bin':{'$first':_0x4e562f(0x130)},'type':{'$first':_0x4e562f(0xcf)},'floorlevel':{'$first':_0x4e562f(0xb0)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4e562f(0xd3)},'product_code':{'$first':_0x4e562f(0x181)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4e562f(0x199)},'expiry_date':{'$first':_0x4e562f(0x125)},'production_date':{'$first':_0x4e562f(0xa5)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':'$room'},'room_data':{'$first':_0x4e562f(0x152)}}}]),_0x115046=await customer['find']({});let _0x55a57f;if(_0x584868['role']==_0x4e562f(0x19a)){const _0x34aba7=await staff['findOne']({'email':_0x584868[_0x4e562f(0xbc)]});_0x55a57f=await warehouse[_0x4e562f(0x140)]([{'$match':{'status':_0x4e562f(0xa8),'name':_0x34aba7['warehouse']}},{'$group':{'_id':_0x4e562f(0x192),'name':{'$first':_0x4e562f(0x192)}}}]);}else _0x55a57f=await warehouse[_0x4e562f(0x140)]([{'$match':{'status':_0x4e562f(0xa8)}},{'$group':{'_id':'$name','name':{'$first':_0x4e562f(0x192)}}}]);const _0x272e14=await product[_0x4e562f(0xf4)]({});if(_0x1fab61[0x0][_0x4e562f(0x1b5)]==_0x4e562f(0x1a5)){var _0x4e3961=users[_0x4e562f(0x165)];console[_0x4e562f(0xed)](_0x4e3961);}else{if(_0x1fab61[0x0][_0x4e562f(0x1b5)]=='Hindi')var _0x4e3961=users[_0x4e562f(0xbf)];else{if(_0x1fab61[0x0][_0x4e562f(0x1b5)]==_0x4e562f(0x18d))var _0x4e3961=users[_0x4e562f(0x18d)];else{if(_0x1fab61[0x0][_0x4e562f(0x1b5)]==_0x4e562f(0xf2))var _0x4e3961=users['Spanish'];else{if(_0x1fab61[0x0][_0x4e562f(0x1b5)]==_0x4e562f(0x19c))var _0x4e3961=users[_0x4e562f(0x19c)];else{if(_0x1fab61[0x0][_0x4e562f(0x1b5)]=='Portuguese\x20(BR)')var _0x4e3961=users[_0x4e562f(0xc3)];else{if(_0x1fab61[0x0][_0x4e562f(0x1b5)]==_0x4e562f(0x197))var _0x4e3961=users['Chinese'];else{if(_0x1fab61[0x0]['language']==_0x4e562f(0xc0))var _0x4e3961=users[_0x4e562f(0xe7)];}}}}}}}_0x5a30a5['render'](_0x4e562f(0x163),{'success':_0x36d9c3[_0x4e562f(0x155)](_0x4e562f(0x188)),'errors':_0x36d9c3[_0x4e562f(0x155)](_0x4e562f(0x9f)),'role':_0x584868,'profile':_0x24fe81,'customer':_0x115046,'warehouse':_0x55a57f,'product':_0x26b694,'user':_0x26411b,'master_shop':_0x1fab61,'unit':_0x272e14,'language':_0x4e3961});}catch(_0x59f88a){console[_0x4e562f(0xed)](_0x59f88a);}});async function dataUpdate(_0x3803f2,_0x12777c,_0x3e3903){var _0x63d72e=a0_0xeb5024;return await warehouse['updateOne']({'_id':_0x3803f2,'product_details._id':_0x12777c},{'$set':{'product_details.$.product_stock':_0x3e3903}}),await warehouse[_0x63d72e(0x115)](_0x3803f2);}function a0_0x407c(){var _0x18cc20=['batch_code','valueOf','/invoice/:id','$_id','sendMail','match','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','return_data','body','281745JPbALU','maxPerUnit','$invoice','user','/barcode_scanner','/../public','/upload/','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssigned','warehouse_id','_id','own','floor','return_sale_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','findById','product_code','nodemailer','secondary_unit_QA','Ambient','<h2>\x20','sales\x20item\x20return\x20successfull','logo','True','$warehouse_name','$product_details.batch_code','stocks_QA','purchases_data','$product_details.product_name','$product_details.maxPerUnit','maxProducts','$product_details.expiry_date','product_data','$product_details.maxProducts','save','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Portuguese\x20(BR)','gmail','/view/add_sale/product','concat','outgoing_invoice','$product_details.bin','$product_details.unit','</thead>','<div>','\x20Order\x20Number\x20:\x20','Received\x20Payment\x20For\x20Sale','params','return_qty','$note','getFullYear','$product_details._id','secondary_code_QA','agent_id','string','</h5>','master','aggregate','unit_QA','return_sale','suppliers','Error\x20Occurs','room_name','/view/return_sales/:id','edit_sales_finished','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','undefined','role','Enclosed','product_name_QA1','quantity','28nyryen','sales_quantity','split','$product_details.uuid','$product_details.room_name','catch','</tr>','flash','$finalize','Router','secondary_code','329346HDrrKS','../public/language/languages.json','redirect','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','id_transaction_from','Finished\x20Goods','batch_code_QA','level2','room','product_code_QA','edit_sales_finished_view','sales','English','date_data','Sale\x20Return','uuid','image','carton','padStart','</head><body>','839208FAYZge','Return\x20Rooms','filter','/barcode/:id','False','sale_qty','primary_code','$room','back','$product','$product.product_name','foreach\x20newproduct','post','all_sales_finished','customer','/picking_list/pdf/','$product_details.gross_price','here','\x20<>\x20','password','$product_details.product_code','render','<tbody\x20style=\x22text-align:\x20center;\x22>','bay','then','all_sales_barcode','1055155ysXPGS','success','invoice_init','toString','logs','</body></html>','German','updateOne','</td>','Sales\x20Add\x20successfully','production_date_QA','$name','maxperunit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','OUTF-','$product_details.product_cat','Chinese','findOne','$product_details.rack','staff','message','French','$sale_product.bin','Email\x20sent\x20successfully','/preview/:id','product_date','$sale_product.floorlevel','map','amount','abs','English\x20(US)','/view/:id','status','$customers_docs','product_list','createTransport','$product_details.type_products','length','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_stock','customer_data','$return_data','$customer','<tr>','slice','return_sale_finished','language','return_qty_QA','OUT-','$product_details.invoice','$sale_product.type','all','product_details','warehouse_name','final','maxPerUnit_QA','add_sales_finished','$product_details.bay','errors','product_name','date','push','/view/add_sales','stock','$product_details.production_date','<hr\x20class=\x22my-3\x22>','$sale_product','Enabled','</div>','</table>','invoice','</span>','/all_sales/view','860192YyYkiD','forEach','$product_details.floorlevel','unit','maxProducts_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','gross_price','/view_log','/give_payment/:id','prod_code','\x20Order\x20Date\x20:\x20','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','email','$sale_product.bay','secondary_unit','Hindi','Arabic\x20(ae)','<h5>','get','Portuguese','sales_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','getDate','\x20</h2>','8heAdfm','$product_details','/barcode_scanner_logs','$sale_product.quantity','adjust_qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','exports','$product_details.type','production_date','level','$product_details.level','$product_details.secondary_code','currency','prod_cat','11859606ePLfcT','payment\x20successfull','stock_data','$product_details.sales_category','primary_unit','warehouse','LOG-OUT-','$product_details.secondary_unit','$product_details.product_stock','site_title','$product_details.storage','max','json','getMonth','received_amount','\x20==\x20','<html><head><title></title>','Arabic','/view/add_sales_logs','/all_sales_finished/view','prod_invoice','</tbody>','../models/all_models','log','currency_placement','random','expiry_date','product','Spanish','Logo.png','find','$product_details.primary_code','<!DOCTYPE\x20html>','2359800fYSjHk','add\x20post','$date','max_per_unit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sale_product'];a0_0x407c=function(){return _0x18cc20;};return a0_0x407c();}router['post'](a0_0xeb5024(0x19f),auth,async(_0x2b01b5,_0x3ee60e)=>{var _0x1b8b98=a0_0xeb5024;try{const _0x4843c7=_0x2b01b5[_0x1b8b98(0x136)]['id'],{invoice:_0x375011,warehouse_name:_0x124f59,room:_0x1ba376}=_0x2b01b5[_0x1b8b98(0x105)],_0x5dec85=await sales_finished[_0x1b8b98(0x198)]({'invoice':_0x375011});for(let _0xab0ea5=0x0;_0xab0ea5<=_0x5dec85[_0x1b8b98(0xfc)]['length']-0x1;_0xab0ea5++){const _0x5ccb4d=_0x5dec85[_0x1b8b98(0xfc)][_0xab0ea5];var _0x2ac69d=await warehouse[_0x1b8b98(0x198)]({'name':_0x124f59,'room':_0x5ccb4d[_0x1b8b98(0x145)]}),_0x4217ae=0x0;for(let _0x35c7a4=0x0;_0x35c7a4<=_0x2ac69d[_0x1b8b98(0x99)]['length']-0x1;_0x35c7a4++){const _0x2ef8ea=_0x2ac69d['product_details'][_0x35c7a4];_0x2ef8ea[_0x1b8b98(0x110)]==_0x5ccb4d[_0x1b8b98(0x15d)]&&_0x2ef8ea[_0x1b8b98(0x168)]==_0x5ccb4d[_0x1b8b98(0x168)]&&(_0x4217ae=Math[_0x1b8b98(0xe1)](0x0,Math[_0x1b8b98(0x1a4)](_0x2ef8ea[_0x1b8b98(0x1ae)])-Math['abs'](_0x5ccb4d[_0x1b8b98(0x14d)])),await warehouse[_0x1b8b98(0x18e)]({'_id':_0x2ac69d[_0x1b8b98(0x110)][_0x1b8b98(0xfe)](),'product_details._id':_0x2ef8ea['_id'][_0x1b8b98(0xfe)](),'product_details.uuid':_0x5ccb4d[_0x1b8b98(0x168)]},{'$set':{'product_details.$.product_stock':_0x4217ae}}));}console[_0x1b8b98(0xed)](typeof _0x5ccb4d[_0x1b8b98(0x13c)]);if(typeof _0x5ccb4d[_0x1b8b98(0x13c)]!==_0x1b8b98(0x149)){var _0x4f3c24=await staff['findById'](_0x5ccb4d['agent_id']);console[_0x1b8b98(0xed)](_0x1b8b98(0x17e));var _0x34e06d=0x0;for(let _0x314e48=0x0;_0x314e48<=_0x4f3c24[_0x1b8b98(0x1a9)][_0x1b8b98(0x1ac)]-0x1;_0x314e48++){const _0x155e80=_0x4f3c24[_0x1b8b98(0x1a9)][_0x314e48];console[_0x1b8b98(0xed)](_0x5ccb4d['id_transaction_from']+'\x20==\x20'+_0x155e80['warehouse_id']+'\x20&&\x20'+_0x5ccb4d[_0x1b8b98(0x110)]+_0x1b8b98(0xe5)+_0x5ccb4d['_id']),_0x5ccb4d['id_transaction_from']==_0x155e80[_0x1b8b98(0x10f)]&&_0x5ccb4d['_id']==0x1&&(_0x155e80[_0x1b8b98(0x1ae)]=Math['abs'](_0x155e80['product_stock'])+Math[_0x1b8b98(0x1a4)](_0x5ccb4d[_0x1b8b98(0x14d)]),_0x34e06d++);}console[_0x1b8b98(0xed)]('int',_0x34e06d),_0x34e06d=='0'&&(_0x4f3c24[_0x1b8b98(0x1a9)]=_0x4f3c24[_0x1b8b98(0x1a9)][_0x1b8b98(0x12e)]({'product_name':_0x5ccb4d[_0x1b8b98(0xa0)],'product_stock':_0x5ccb4d[_0x1b8b98(0x14d)],'bay':_0x5ccb4d[_0x1b8b98(0x184)],'level':_0x5ccb4d[_0x1b8b98(0xd1)],'product_code':_0x5ccb4d[_0x1b8b98(0x116)],'primary_code':_0x5ccb4d['primary_code'],'secondary_code':_0x5ccb4d[_0x1b8b98(0x158)],'expiry_date':_0x5ccb4d[_0x1b8b98(0xf0)],'production_date':_0x5ccb4d[_0x1b8b98(0xd0)],'maxProducts':_0x5ccb4d[_0x1b8b98(0x124)],'batch_code':_0x5ccb4d['batch_code'],'secondary_unit':_0x5ccb4d[_0x1b8b98(0xbe)],'unit':_0x5ccb4d[_0x1b8b98(0xb1)],'maxProducts':_0x5ccb4d[_0x1b8b98(0x124)],'maxPerUnit':_0x5ccb4d[_0x1b8b98(0x193)],'invoice':_0x5ccb4d['invoice'],'warehouse_id':_0x5ccb4d[_0x1b8b98(0x15d)],'id_incoming':_0x5ccb4d['_id'],'uuid':_0x5ccb4d[_0x1b8b98(0x168)],'gross_price':_0x5ccb4d['gross_price'],'date_incoming':_0x5ccb4d[_0x1b8b98(0x166)],'outgoing_invoice':_0x5ccb4d[_0x1b8b98(0x12f)]}),await _0x4f3c24['save']());}}_0x5dec85['finalize']=_0x1b8b98(0x11d);const _0x43fee7=await _0x5dec85[_0x1b8b98(0x128)](),_0xe03fbf=await master_shop[_0x1b8b98(0xf4)](),_0x35149e=await email_settings[_0x1b8b98(0x198)](),_0x35a0ee=await supervisor_settings[_0x1b8b98(0xf4)]();var _0xf34f4b=_0x5dec85[_0x1b8b98(0xfc)],_0x444cf3='',_0x5b6561;for(_0x5b6561 in _0xf34f4b){_0x444cf3+=_0x1b8b98(0x1b2)+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0xa0)]+_0x1b8b98(0x18f)+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0x116)]+_0x1b8b98(0x18f)+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0x14d)]+_0x1b8b98(0x18f)+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0xb1)]+'</td>'+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0xbe)]+'</td>'+_0x1b8b98(0xb3)+_0x5dec85[_0x1b8b98(0x9a)]+_0x1b8b98(0x18f)+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0x145)]+'</td>'+_0x1b8b98(0xb3)+_0xf34f4b[_0x5b6561][_0x1b8b98(0x184)]+_0x1b8b98(0x18f);}_0x2b01b5['flash'](_0x1b8b98(0x188),'Sales\x20Update\x20successfully'),_0x3ee60e[_0x1b8b98(0x15b)](_0x1b8b98(0x17c)+_0x4843c7);}catch(_0x35ab19){console['log'](_0x35ab19);}}),router['get'](a0_0xeb5024(0x1a6),auth,async(_0x5d554,_0x47fd76)=>{var _0x1a66e9=a0_0xeb5024;try{const {username:_0x370d55,email:_0x5063de,role:_0x4dc7df}=_0x5d554['user'],_0x13221d=_0x5d554['user'],_0x25bb5b=await profile[_0x1a66e9(0x198)]({'email':_0x13221d[_0x1a66e9(0xbc)]}),_0x357fea=await master_shop['find'](),_0x78a45e=_0x5d554[_0x1a66e9(0x136)]['id'],_0xb5d35d=await sales_finished[_0x1a66e9(0x115)](_0x78a45e);let _0x96ff3d=new Date(_0xb5d35d['expiry_date']),_0x22dd98=('0'+_0x96ff3d['getDate']())[_0x1a66e9(0x1b3)](-0x2),_0xb0e60b=('0'+(_0x96ff3d[_0x1a66e9(0xe3)]()+0x1))[_0x1a66e9(0x1b3)](-0x2),_0x2d2c7f=_0x96ff3d['getFullYear'](),_0x2df785=_0x2d2c7f+'-'+_0xb0e60b+'-'+_0x22dd98;var _0x5a58fd=[_0x1a66e9(0x119),_0x1a66e9(0x14b)];const _0x372956=await warehouse['aggregate']([{'$match':{'name':_0xb5d35d[_0x1a66e9(0x9a)],'room':_0xb5d35d['room']}},{'$unwind':_0x1a66e9(0xc9)},{'$group':{'_id':_0x1a66e9(0x13a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1a66e9(0xde)},'bay':{'$first':_0x1a66e9(0x9e)},'bin':{'$first':_0x1a66e9(0x130)},'type':{'$first':_0x1a66e9(0xcf)},'floorlevel':{'$first':_0x1a66e9(0xb0)},'primary_code':{'$first':_0x1a66e9(0xf5)},'secondary_code':{'$first':_0x1a66e9(0xd3)},'product_code':{'$first':_0x1a66e9(0x181)},'storage':{'$first':_0x1a66e9(0xe0)},'rack':{'$first':_0x1a66e9(0x199)}}}]),_0x577951=await customer[_0x1a66e9(0xf4)]({});let _0x314c40;if(_0x13221d[_0x1a66e9(0x14a)]==_0x1a66e9(0x19a)){const _0x47dcf5=await staff[_0x1a66e9(0x198)]({'email':_0x13221d[_0x1a66e9(0xbc)]});_0x314c40=await warehouse[_0x1a66e9(0x140)]([{'$match':{'status':_0x1a66e9(0xa8),'name':_0x47dcf5[_0x1a66e9(0xdb)]}},{'$group':{'_id':'$name','name':{'$first':_0x1a66e9(0x192)}}}]);}else _0x314c40=await warehouse[_0x1a66e9(0x140)]([{'$match':{'status':_0x1a66e9(0xa8)}},{'$group':{'_id':_0x1a66e9(0x192),'name':{'$first':_0x1a66e9(0x192)}}}]);const _0x25bd42=await product[_0x1a66e9(0xf4)]({});if(_0x357fea[0x0][_0x1a66e9(0x1b5)]=='English\x20(US)'){var _0x47ebd5=users[_0x1a66e9(0x165)];console[_0x1a66e9(0xed)](_0x47ebd5);}else{if(_0x357fea[0x0][_0x1a66e9(0x1b5)]==_0x1a66e9(0xbf))var _0x47ebd5=users['Hindi'];else{if(_0x357fea[0x0][_0x1a66e9(0x1b5)]==_0x1a66e9(0x18d))var _0x47ebd5=users['German'];else{if(_0x357fea[0x0]['language']==_0x1a66e9(0xf2))var _0x47ebd5=users[_0x1a66e9(0xf2)];else{if(_0x357fea[0x0]['language']==_0x1a66e9(0x19c))var _0x47ebd5=users[_0x1a66e9(0x19c)];else{if(_0x357fea[0x0]['language']==_0x1a66e9(0x12b))var _0x47ebd5=users[_0x1a66e9(0xc3)];else{if(_0x357fea[0x0]['language']==_0x1a66e9(0x197))var _0x47ebd5=users['Chinese'];else{if(_0x357fea[0x0][_0x1a66e9(0x1b5)]==_0x1a66e9(0xc0))var _0x47ebd5=users[_0x1a66e9(0xe7)];}}}}}}}_0x47fd76[_0x1a66e9(0x182)](_0x1a66e9(0x147),{'success':_0x5d554[_0x1a66e9(0x155)](_0x1a66e9(0x188)),'errors':_0x5d554['flash']('errors'),'role':_0x13221d,'profile':_0x25bb5b,'customer':_0x577951,'warehouse':_0x314c40,'product':_0x372956,'user':_0xb5d35d,'master_shop':_0x357fea,'unit':_0x25bd42,'language':_0x47ebd5,'rooms_data':_0x5a58fd,'ed_fullDate':_0x2df785});}catch(_0x36de6f){console[_0x1a66e9(0xed)](_0x36de6f);}}),router[a0_0xeb5024(0x179)](a0_0xeb5024(0x1a6),auth,async(_0x2f1741,_0x19aeb9)=>{var _0x2e375e=a0_0xeb5024;try{const _0x2d5dd4=_0x2f1741[_0x2e375e(0x136)]['id'],_0x445744=await sales_finished[_0x2e375e(0x198)]({'_id':_0x2f1741[_0x2e375e(0x136)]['id']}),_0xac9a4e=await warehouse['findOne']({'name':_0x445744[_0x2e375e(0x9a)],'room':_0x2f1741[_0x2e375e(0x105)]['room'],'warehouse_category':_0x2e375e(0x15e)}),{invoice:_0x21df44,customer:_0x56f027,date:_0x290d34,warehouse_name:_0x430ddf,product_name:_0x4767bc,stock:_0x18b931,adjust_qty:_0x2ceb7f,note:_0x499ce0,room:_0x34c9b6,primary_code:_0x68a1b8,secondary_code:_0x125cbe,prod_code:_0x1a0aca,level:_0x22b798,isle:_0x53c897,pallet:_0x5da7e1,expiry_date:_0x317e34}=_0x2f1741[_0x2e375e(0x105)];if(typeof _0x4767bc==_0x2e375e(0x13d))var _0x2671cc=[_0x2f1741[_0x2e375e(0x105)][_0x2e375e(0xa0)]],_0x14d7de=[_0x2f1741[_0x2e375e(0x105)][_0x2e375e(0xa4)]],_0x422c73=[_0x2f1741['body']['adjust_qty']],_0x436e7f=[_0x2f1741[_0x2e375e(0x105)]['primary_code']],_0x13ff5f=[_0x2f1741['body'][_0x2e375e(0x158)]],_0x3947ed=[_0x2f1741['body'][_0x2e375e(0xb8)]],_0x55617f=[_0x2f1741[_0x2e375e(0x105)][_0x2e375e(0xd1)]],_0x3c879c=[_0x2f1741[_0x2e375e(0x105)][_0x2e375e(0xf0)]];else var _0x2671cc=[..._0x2f1741['body'][_0x2e375e(0xa0)]],_0x14d7de=[..._0x2f1741['body']['stock']],_0x422c73=[..._0x2f1741['body'][_0x2e375e(0xcc)]],_0x436e7f=[..._0x2f1741[_0x2e375e(0x105)]['primary_code']],_0x13ff5f=[..._0x2f1741['body'][_0x2e375e(0x158)]],_0x3947ed=[..._0x2f1741[_0x2e375e(0x105)][_0x2e375e(0xb8)]],_0x55617f=[..._0x2f1741['body'][_0x2e375e(0xd1)]],_0x3c879c=[..._0x2f1741[_0x2e375e(0x105)]['expiry_date']];const _0x2f76b2=_0x2671cc[_0x2e375e(0x1a2)](_0x419ec3=>{return _0x419ec3={'product_name':_0x419ec3};});_0x14d7de[_0x2e375e(0xaf)]((_0x1ba2f2,_0x2f861e)=>{var _0x1432bc=_0x2e375e;_0x2f76b2[_0x2f861e][_0x1432bc(0xa4)]=_0x1ba2f2;}),_0x422c73['forEach']((_0x25c96c,_0x2c034c)=>{var _0x2106a9=_0x2e375e;_0x2f76b2[_0x2c034c][_0x2106a9(0x14d)]=_0x25c96c;}),_0x436e7f[_0x2e375e(0xaf)]((_0x34b216,_0x11d774)=>{var _0x5d40cf=_0x2e375e;_0x2f76b2[_0x11d774][_0x5d40cf(0x173)]=_0x34b216;}),_0x13ff5f[_0x2e375e(0xaf)]((_0x211d8c,_0x48e12e)=>{var _0x558fcb=_0x2e375e;_0x2f76b2[_0x48e12e][_0x558fcb(0x158)]=_0x211d8c;}),_0x3947ed[_0x2e375e(0xaf)]((_0x568b79,_0xd64e01)=>{_0x2f76b2[_0xd64e01]['product_code']=_0x568b79;}),_0x55617f[_0x2e375e(0xaf)]((_0x157bc5,_0x41e7f1)=>{var _0x49866f=_0x2e375e;_0x2f76b2[_0x41e7f1][_0x49866f(0xd1)]=_0x157bc5;}),_0x3c879c['forEach']((_0x2a99cd,_0x7eeb25)=>{var _0x93f002=_0x2e375e;_0x2f76b2[_0x7eeb25][_0x93f002(0xf0)]=_0x2a99cd;});var _0x35d67f=0x0;_0x2f76b2[_0x2e375e(0xaf)](_0x2931e7=>{var _0x38c3ce=_0x2e375e;console[_0x38c3ce(0xed)](_0x38c3ce(0x178),_0x2931e7),(parseInt(_0x2931e7['stock'])<parseInt(_0x2931e7[_0x38c3ce(0x14d)])||parseInt(_0x2931e7[_0x38c3ce(0x14d)])==0x0)&&_0x35d67f++;});if(_0x35d67f!=0x0)return _0x2f1741[_0x2e375e(0x155)](_0x2e375e(0x9f),_0x2e375e(0x148)),_0x19aeb9[_0x2e375e(0x15b)](_0x2e375e(0x175));_0x445744[_0x2e375e(0xfc)][_0x2e375e(0xaf)](_0x3c71ed=>{var _0x31a4dc=_0x2e375e;const _0x412a4e=_0xac9a4e[_0x31a4dc(0x99)][_0x31a4dc(0x1a2)](_0xc493=>{var _0xf3bcfa=_0x31a4dc;_0xc493[_0xf3bcfa(0xa0)]==_0x3c71ed['product_name']&&_0xc493[_0xf3bcfa(0x184)]==_0x3c71ed[_0xf3bcfa(0x184)]&&(_0xc493[_0xf3bcfa(0x1ae)]=parseInt(_0xc493[_0xf3bcfa(0x1ae)])+parseInt(_0x3c71ed[_0xf3bcfa(0x14d)]));});}),await _0xac9a4e[_0x2e375e(0x128)]();const _0x3b673b=_0x2f76b2[_0x2e375e(0x16f)](_0x31fe30=>_0x31fe30[_0x2e375e(0x14d)]!=='0'&&_0x31fe30[_0x2e375e(0x14d)]!=='');_0x445744[_0x2e375e(0xab)]=_0x21df44,_0x445744[_0x2e375e(0x17b)]=_0x56f027,_0x445744[_0x2e375e(0xa1)]=_0x290d34,_0x445744[_0x2e375e(0x9a)]=_0x430ddf,_0x445744[_0x2e375e(0xfc)]=_0x3b673b,_0x445744[_0x2e375e(0x129)]=_0x499ce0,_0x445744[_0x2e375e(0x161)]=_0x34c9b6;const _0x407857=await _0x445744['save'](),_0x363cf6=await sales_finished[_0x2e375e(0x198)]({'_id':_0x2f1741[_0x2e375e(0x136)]['id']}),_0xb81c9b=await warehouse[_0x2e375e(0x198)]({'name':_0x430ddf,'room':_0x34c9b6,'warehouse_category':_0x2e375e(0x15e)});_0x363cf6[_0x2e375e(0xfc)]['forEach'](_0x4f1748=>{var _0x5a2893=_0x2e375e;const _0x56674e=_0xb81c9b[_0x5a2893(0x99)][_0x5a2893(0x1a2)](_0x231100=>{var _0x6a777b=_0x5a2893;_0x231100[_0x6a777b(0xa0)]==_0x4f1748[_0x6a777b(0xa0)]&&_0x231100[_0x6a777b(0x184)]==_0x4f1748['bay']&&(_0x231100['product_stock']=parseInt(_0x231100['product_stock'])-parseInt(_0x4f1748['quantity']));});}),console[_0x2e375e(0xed)](_0x2e375e(0x9b),_0xb81c9b),await _0xb81c9b[_0x2e375e(0x128)]();const _0x5bee60=await c_payment_data['findOne']({'invoice':_0x2f1741['body'][_0x2e375e(0xab)]});_0x5bee60[_0x2e375e(0x143)]=_0x2f1741[_0x2e375e(0x105)][_0x2e375e(0x143)],await _0x5bee60[_0x2e375e(0x128)](),_0x2f1741[_0x2e375e(0x155)](_0x2e375e(0x188),'Sales\x20Update\x20successfully'),_0x19aeb9['redirect']('/all_sales_finished/view');}catch(_0x3142f4){console[_0x2e375e(0xed)](_0x3142f4);}}),router[a0_0xeb5024(0x179)](a0_0xeb5024(0xb7),auth,async(_0x3c49bc,_0x510737)=>{var _0x217d50=a0_0xeb5024;try{const _0x2f71bb=_0x3c49bc[_0x217d50(0x136)]['id'],{invoice:_0x113a57,customer:_0x37b057,receivable_amount:_0x22ce0a,received_amount:_0x352d64}=_0x3c49bc['body'],_0xbd55cf=await sales[_0x217d50(0x115)](_0x2f71bb);console[_0x217d50(0xed)](_0xbd55cf);var _0x53f023=_0x22ce0a-_0x352d64;console[_0x217d50(0xed)](_0x352d64),_0xbd55cf[_0x217d50(0xe4)]=parseFloat(_0x352d64)+parseFloat(_0xbd55cf[_0x217d50(0xe4)]),_0xbd55cf['due_amount']=_0x53f023,console[_0x217d50(0xed)](_0xbd55cf);const _0x3ef14b=await _0xbd55cf[_0x217d50(0x128)](),_0x1cebb2=await c_payment_data[_0x217d50(0x198)]({'invoice':_0x113a57});_0x1cebb2[_0x217d50(0x1a3)]=_0x53f023,await _0x1cebb2[_0x217d50(0x128)]();let _0x5238c7=new Date(),_0x3c6066=('0'+_0x5238c7[_0x217d50(0xc6)]())[_0x217d50(0x1b3)](-0x2),_0x159a3a=('0'+(_0x5238c7['getMonth']()+0x1))[_0x217d50(0x1b3)](-0x2),_0x4ecb86=_0x5238c7[_0x217d50(0x139)](),_0x2a13ae=_0x4ecb86+'-'+_0x159a3a+'-'+_0x3c6066;const _0x49dd79=new customer_payment({'invoice':_0x113a57,'date':_0x4ecb86+'-'+_0x159a3a+'-'+_0x3c6066,'customer':_0x37b057,'reason':_0x217d50(0x135),'amount':_0x352d64}),_0x5a846e=await _0x49dd79[_0x217d50(0x128)]();_0x3c49bc['flash'](_0x217d50(0x188),_0x217d50(0xd7)),_0x510737['redirect'](_0x217d50(0xad));}catch(_0x52d1f7){console[_0x217d50(0xed)](_0x52d1f7);}}),router[a0_0xeb5024(0xc2)](a0_0xeb5024(0xff),auth,async(_0x146476,_0x17656e)=>{var _0x37aac7=a0_0xeb5024;try{const {username:_0x2216f2,email:_0x52c45e,role:_0x123aa3}=_0x146476[_0x37aac7(0x109)],_0x4a69b0=_0x146476[_0x37aac7(0x109)],_0x4bbf3a=await profile[_0x37aac7(0x198)]({'email':_0x4a69b0[_0x37aac7(0xbc)]}),_0x1a5502=await master_shop[_0x37aac7(0xf4)]();console[_0x37aac7(0xed)](_0x37aac7(0x13f),_0x1a5502);const _0x2d24aa=_0x146476[_0x37aac7(0x136)]['id'],_0x4a9aa7=await sales[_0x37aac7(0x115)](_0x2d24aa);console['log'](_0x4a9aa7);const _0x28c3bc=await customer['findOne']({'name':_0x4a9aa7[_0x37aac7(0x17b)]});console[_0x37aac7(0xed)](_0x28c3bc);if(_0x1a5502[0x0]['language']==_0x37aac7(0x1a5)){var _0x10ec15=users[_0x37aac7(0x165)];console[_0x37aac7(0xed)](_0x10ec15);}else{if(_0x1a5502[0x0][_0x37aac7(0x1b5)]=='Hindi')var _0x10ec15=users['Hindi'];else{if(_0x1a5502[0x0][_0x37aac7(0x1b5)]==_0x37aac7(0x18d))var _0x10ec15=users[_0x37aac7(0x18d)];else{if(_0x1a5502[0x0]['language']==_0x37aac7(0xf2))var _0x10ec15=users[_0x37aac7(0xf2)];else{if(_0x1a5502[0x0]['language']==_0x37aac7(0x19c))var _0x10ec15=users['French'];else{if(_0x1a5502[0x0]['language']==_0x37aac7(0x12b))var _0x10ec15=users[_0x37aac7(0xc3)];else{if(_0x1a5502[0x0][_0x37aac7(0x1b5)]==_0x37aac7(0x197))var _0x10ec15=users[_0x37aac7(0x197)];else{if(_0x1a5502[0x0][_0x37aac7(0x1b5)]==_0x37aac7(0xc0))var _0x10ec15=users[_0x37aac7(0xe7)];}}}}}}}_0x17656e['render'](_0x37aac7(0xc4),{'success':_0x146476[_0x37aac7(0x155)](_0x37aac7(0x188)),'errors':_0x146476['flash'](_0x37aac7(0x9f)),'role':_0x4a69b0,'profile':_0x4bbf3a,'master_shop':_0x1a5502,'customers':_0x28c3bc,'sales':_0x4a9aa7,'language':_0x10ec15});}catch(_0x58a2d5){console[_0x37aac7(0xed)](_0x58a2d5);}}),router[a0_0xeb5024(0xc2)]('/view/return_sales/:id',auth,async(_0x33edf9,_0x1c2691)=>{var _0x123b40=a0_0xeb5024;try{const {username:_0x36f60b,email:_0x427ce6,role:_0xd9d0c1}=_0x33edf9[_0x123b40(0x109)],_0x479fc5=_0x33edf9[_0x123b40(0x109)],_0x200fd3=await profile[_0x123b40(0x198)]({'email':_0x479fc5['email']}),_0x11981b=await master_shop[_0x123b40(0xf4)](),_0x7b7851=_0x33edf9['params']['id'],_0x5256e1=await sales_finished[_0x123b40(0x115)](_0x7b7851),_0x36c712=await warehouse[_0x123b40(0x140)]([{'$match':{'name':_0x5256e1['warehouse_name']}},{'$unwind':_0x123b40(0xc9)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x123b40(0x9e)},'bin':{'$first':_0x123b40(0x130)},'type':{'$first':_0x123b40(0xcf)},'floorlevel':{'$first':_0x123b40(0xb0)},'primary_code':{'$first':_0x123b40(0xf5)},'secondary_code':{'$first':_0x123b40(0xd3)},'product_code':{'$first':_0x123b40(0x181)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x123b40(0x125)},'production_date':{'$first':_0x123b40(0xa5)},'unit':{'$first':_0x123b40(0x131)},'secondary_unit':{'$first':_0x123b40(0xdd)},'maxProducts':{'$first':_0x123b40(0x127)},'batch_code':{'$first':_0x123b40(0x11f)},'maxPerUnit':{'$first':_0x123b40(0x123)}}}]),_0xd5b819=await product['find']({}),_0x56912c=await warehouse[_0x123b40(0x140)]([{'$match':{'status':_0x123b40(0xa8),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x123b40(0xba),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x123b40(0x192),'name':{'$first':_0x123b40(0x192)}}},{'$sort':{'name':0x1}}]);var _0x835fdf=[_0x123b40(0x16e)];const _0x1a3927=await warehouse[_0x123b40(0x140)]([{'$match':{'status':_0x123b40(0xa8),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0x123b40(0x192),'name':{'$first':_0x123b40(0x192)}}},{'$sort':{'name':0x1}}]);if(_0x11981b[0x0][_0x123b40(0x1b5)]=='English\x20(US)'){var _0x94026=users[_0x123b40(0x165)];console[_0x123b40(0xed)](_0x94026);}else{if(_0x11981b[0x0][_0x123b40(0x1b5)]==_0x123b40(0xbf))var _0x94026=users[_0x123b40(0xbf)];else{if(_0x11981b[0x0]['language']==_0x123b40(0x18d))var _0x94026=users[_0x123b40(0x18d)];else{if(_0x11981b[0x0]['language']==_0x123b40(0xf2))var _0x94026=users[_0x123b40(0xf2)];else{if(_0x11981b[0x0][_0x123b40(0x1b5)]=='French')var _0x94026=users[_0x123b40(0x19c)];else{if(_0x11981b[0x0][_0x123b40(0x1b5)]=='Portuguese\x20(BR)')var _0x94026=users[_0x123b40(0xc3)];else{if(_0x11981b[0x0][_0x123b40(0x1b5)]==_0x123b40(0x197))var _0x94026=users[_0x123b40(0x197)];else{if(_0x11981b[0x0]['language']=='Arabic\x20(ae)')var _0x94026=users[_0x123b40(0xe7)];}}}}}}}_0x1c2691['render'](_0x123b40(0x1b4),{'success':_0x33edf9['flash'](_0x123b40(0x188)),'errors':_0x33edf9['flash']('errors'),'role':_0x479fc5,'profile':_0x200fd3,'user':_0x5256e1,'stock':_0x36c712,'master_shop':_0x11981b,'unit':_0xd5b819,'language':_0x94026,'warehouses':_0x56912c,'rooms':_0x835fdf,'warehouse_QA':_0x1a3927});}catch(_0x341590){console[_0x123b40(0xed)](_0x341590),_0x1c2691[_0x123b40(0x1a7)](0xc8)[_0x123b40(0xe2)]({'message':_0x341590[_0x123b40(0x19b)]});}}),router[a0_0xeb5024(0x179)](a0_0xeb5024(0x146),auth,async(_0x4dd1d1,_0x378f17)=>{var _0x2e9072=a0_0xeb5024;if(_0x4dd1d1[_0x2e9072(0x105)]['for_categorize']=='QA')try{const {invoice:_0x3d987c,date:_0x139402,warehouse_name:_0xd03ef3,product_name:_0x28afd6,primary_code:_0xff2b7,secondary_code:_0x2c563a,product_code:_0x4a9010,sales_quantity:_0xd2704b,stocks:_0x1e43a9,return_qty:_0x5dd97a,Room_name:_0x1fe3fe,to_warehouse_name_QA:_0x1927a1,to_Room_name_QA:_0x1316d1,note:_0x568577,for_categorize:_0x4f7004,product_name_QA1:_0x52c786}=_0x4dd1d1['body'];if(typeof _0x52c786==_0x2e9072(0x13d))var _0x1550bc=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x14c)]],_0x5ccb6b=[_0x4dd1d1['body']['primary_code_QA']],_0x468238=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x13b)]],_0x3e9ebf=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x162)]],_0x6f029b=[_0x4dd1d1[_0x2e9072(0x105)]['sales_quantity_QA']],_0x1668da=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x120)]],_0x11fddc=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x1b6)]],_0x430510=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x9c)]],_0x525392=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xb2)]],_0x53c91c=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x15f)]],_0xb816ce=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x118)]],_0x1e4b72=[_0x4dd1d1['body'][_0x2e9072(0x141)]],_0xdb5298=[_0x4dd1d1['body'][_0x2e9072(0x191)]],_0x227cf9=[_0x4dd1d1[_0x2e9072(0x105)]['expiry_date_QA']];else var _0x1550bc=[..._0x4dd1d1['body'][_0x2e9072(0x14c)]],_0x5ccb6b=[..._0x4dd1d1['body']['primary_code_QA']],_0x468238=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x13b)]],_0x3e9ebf=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x162)]],_0x6f029b=[..._0x4dd1d1[_0x2e9072(0x105)]['sales_quantity_QA']],_0x1668da=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x120)]],_0x11fddc=[..._0x4dd1d1[_0x2e9072(0x105)]['return_qty_QA']],_0x430510=[..._0x4dd1d1['body'][_0x2e9072(0x9c)]],_0x525392=[..._0x4dd1d1['body']['maxProducts_QA']],_0x53c91c=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x15f)]],_0xb816ce=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x118)]],_0x1e4b72=[..._0x4dd1d1[_0x2e9072(0x105)]['unit_QA']],_0xdb5298=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x191)]],_0x227cf9=[..._0x4dd1d1[_0x2e9072(0x105)]['expiry_date_QA']];const _0x37d9e9=_0x1550bc[_0x2e9072(0x1a2)](_0x167d32=>{return _0x167d32={'product_name':_0x167d32};});_0x5ccb6b[_0x2e9072(0xaf)]((_0x2e51f8,_0x38ff94)=>{var _0x4e39f5=_0x2e9072;_0x37d9e9[_0x38ff94][_0x4e39f5(0x173)]=_0x2e51f8;}),_0x468238[_0x2e9072(0xaf)]((_0x5ac9cc,_0x36f4bf)=>{var _0x480eb7=_0x2e9072;_0x37d9e9[_0x36f4bf][_0x480eb7(0x158)]=_0x5ac9cc;}),_0x3e9ebf[_0x2e9072(0xaf)]((_0x446ade,_0xba4b30)=>{_0x37d9e9[_0xba4b30]['product_code']=_0x446ade;}),_0x6f029b[_0x2e9072(0xaf)]((_0x6ecf6a,_0x4b832c)=>{var _0x188da3=_0x2e9072;_0x37d9e9[_0x4b832c][_0x188da3(0x172)]=_0x6ecf6a;}),_0x1668da[_0x2e9072(0xaf)]((_0x5291ad,_0x54fea5)=>{var _0x1665d1=_0x2e9072;_0x37d9e9[_0x54fea5][_0x1665d1(0xa4)]=_0x5291ad;}),_0x11fddc[_0x2e9072(0xaf)]((_0x92c71a,_0x25c961)=>{var _0x30cff7=_0x2e9072;_0x37d9e9[_0x25c961][_0x30cff7(0x137)]=_0x92c71a;}),_0x430510[_0x2e9072(0xaf)]((_0x1af292,_0x529ab0)=>{var _0x5b260d=_0x2e9072;_0x37d9e9[_0x529ab0][_0x5b260d(0x107)]=_0x1af292;}),_0x525392[_0x2e9072(0xaf)]((_0x418a88,_0x34bfc4)=>{var _0x5ecd7f=_0x2e9072;_0x37d9e9[_0x34bfc4][_0x5ecd7f(0x124)]=_0x418a88;}),_0x53c91c[_0x2e9072(0xaf)]((_0x18dd6f,_0x18758b)=>{var _0x1a7f8b=_0x2e9072;_0x37d9e9[_0x18758b][_0x1a7f8b(0xfd)]=_0x18dd6f;}),_0xb816ce[_0x2e9072(0xaf)]((_0x3c18bf,_0xa50ddb)=>{var _0xf02409=_0x2e9072;_0x37d9e9[_0xa50ddb][_0xf02409(0xbe)]=_0x3c18bf;}),_0x1e4b72['forEach']((_0x4eb3ab,_0x587417)=>{_0x37d9e9[_0x587417]['unit']=_0x4eb3ab;}),_0xdb5298['forEach']((_0x3ef0de,_0x126dc8)=>{var _0x422e8c=_0x2e9072;_0x37d9e9[_0x126dc8][_0x422e8c(0xd0)]=_0x3ef0de;}),_0x227cf9[_0x2e9072(0xaf)]((_0x5b43b4,_0x40d96f)=>{var _0x1495a8=_0x2e9072;_0x37d9e9[_0x40d96f][_0x1495a8(0xf0)]=_0x5b43b4;});const _0x380dee=await sales_finished[_0x2e9072(0x198)]({'invoice':_0x3d987c});_0x380dee[_0x2e9072(0x104)]=_0x2e9072(0x11d);const _0x388c96=await _0x380dee['save'](),_0x1cb069=new sales_return_finished({'invoice':_0x3d987c,'customer':_0x4dd1d1['body'][_0x2e9072(0x17b)],'date':_0x139402,'warehouse_name':_0xd03ef3,'room':_0x1fe3fe,'ToWarehouse':_0x1927a1,'ToRoom':_0x1316d1,'return_sale_QA':_0x37d9e9,'note':_0x568577,'warehouse_cat':_0x4f7004}),_0x13397d=await _0x1cb069[_0x2e9072(0x128)](),_0x2d17b8=await sales_return_finished[_0x2e9072(0x198)]({'invoice':_0x3d987c}),_0x496ad9=await warehouse['findOne']({'name':_0x1927a1,'room':_0x1316d1});_0x2d17b8[_0x2e9072(0x113)][_0x2e9072(0xaf)](_0x3d849f=>{var _0x376c44=_0x2e9072,_0x194adc=0x0;const _0x3487c4=_0x496ad9[_0x376c44(0x99)][_0x376c44(0x1a2)](_0x19d803=>{var _0x4326f0=_0x376c44;_0x19d803[_0x4326f0(0xa0)]==_0x3d849f[_0x4326f0(0xa0)]&&_0x19d803['expiry_date']==_0x3d849f['expiry_date']&&_0x19d803['production_date']==_0x3d849f[_0x4326f0(0xd0)]&&_0x19d803[_0x4326f0(0xfd)]==_0x3d849f['batch_code']&&(_0x19d803[_0x4326f0(0x1ae)]=parseInt(_0x19d803['product_stock'])+parseInt(_0x3d849f[_0x4326f0(0x137)]),_0x194adc++);});_0x194adc=='0'&&(_0x496ad9[_0x376c44(0x99)]=_0x496ad9[_0x376c44(0x99)][_0x376c44(0x12e)]({'product_name':_0x3d849f['product_name'],'product_stock':_0x3d849f[_0x376c44(0x137)],'primary_code':_0x3d849f['primary_code'],'secondary_code':_0x3d849f[_0x376c44(0x158)],'product_code':_0x3d849f[_0x376c44(0x116)],'batch_code':_0x3d849f[_0x376c44(0xfd)],'maxPerUnit':_0x3d849f[_0x376c44(0x107)],'production_date':_0x3d849f['production_date'],'expiry_date':_0x3d849f['expiry_date'],'secondary_unit':_0x3d849f[_0x376c44(0xbe)],'unit':_0x3d849f[_0x376c44(0xb1)],'maxProducts':_0x3d849f[_0x376c44(0x124)],'bay':_0x3d849f['bay']}));}),await _0x496ad9[_0x2e9072(0x128)]();const _0x582f60=new c_payment_data({'invoice':_0x3d987c,'customer':_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x17b)],'reason':_0x2e9072(0x167)});await _0x582f60[_0x2e9072(0x128)]();const _0x2d6944=await master_shop[_0x2e9072(0xf4)](),_0x1df67b=await email_settings['findOne'](),_0xe16db=await customer[_0x2e9072(0x198)]({'name':_0x4dd1d1[_0x2e9072(0x105)]['customer']});_0x2d6944[0x0][_0x2e9072(0xee)]==0x1?(right_currency=_0x2d6944[0x0][_0x2e9072(0xd4)],left_currency=''):(right_currency='',left_currency=_0x2d6944[0x0][_0x2e9072(0xd4)]);var _0x370bca=_0x1550bc,_0x39b0de=_0x11fddc,_0x444816='',_0x2ff804;for(_0x2ff804 in _0x370bca){_0x444816+=_0x2e9072(0x1b2)+_0x2e9072(0xb3)+_0x370bca[_0x2ff804]+'</td>'+_0x2e9072(0xb3)+_0x39b0de[_0x2ff804]+'</td>'+_0x2e9072(0x154);}console[_0x2e9072(0xed)](_0x2e9072(0x1a9),_0x444816);let _0x187596=nodemailer[_0x2e9072(0x1aa)]({'service':_0x2e9072(0x12c),'auth':{'user':_0x1df67b[_0x2e9072(0xbc)],'pass':_0x1df67b[_0x2e9072(0x180)]}}),_0x470c9f={'from':_0x1df67b[_0x2e9072(0xbc)],'to':_0xe16db[_0x2e9072(0xbc)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2e9072(0xf3),'path':__dirname+_0x2e9072(0x10b)+_0x2e9072(0x10c)+_0x2d6944[0x0]['image'],'cid':_0x2e9072(0x11c)}],'html':_0x2e9072(0xf6)+_0x2e9072(0xe6)+_0x2e9072(0x16c)+_0x2e9072(0x133)+_0x2e9072(0xfb)+'<div>'+_0x2e9072(0x194)+_0x2e9072(0xa9)+_0x2e9072(0x133)+_0x2e9072(0x11a)+_0x2d6944[0x0][_0x2e9072(0xdf)]+_0x2e9072(0xc7)+_0x2e9072(0xa9)+_0x2e9072(0xa9)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2e9072(0x134)+_0x3d987c+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x139402+'\x20'+_0x2e9072(0xac)+_0x2e9072(0x13e)+'</div>'+_0x2e9072(0xcd)+_0x2e9072(0x10d)+_0x2e9072(0x1b2)+_0x2e9072(0xc5)+_0x2e9072(0xbb)+_0x2e9072(0x12a)+_0x2e9072(0x114)+_0x2e9072(0x154)+_0x2e9072(0x132)+_0x2e9072(0x183)+'\x20'+_0x444816+'\x20'+_0x2e9072(0xeb)+_0x2e9072(0xaa)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x2e9072(0xc1)+_0x2d6944[0x0]['site_title']+'</h5>'+_0x2e9072(0xa9)+_0x2e9072(0xa9)+_0x2e9072(0x18c)};_0x187596[_0x2e9072(0x101)](_0x470c9f,function(_0x7dbd7f,_0x5d6c0f){var _0x5813f7=_0x2e9072;_0x7dbd7f?(console[_0x5813f7(0xed)](_0x7dbd7f),console[_0x5813f7(0xed)](_0x5813f7(0x144))):console[_0x5813f7(0xed)]('Email\x20sent\x20successfully');}),_0x4dd1d1['flash'](_0x2e9072(0x188),_0x2e9072(0x11b)),_0x378f17[_0x2e9072(0x15b)](_0x2e9072(0xe9));}catch(_0x40ba76){_0x378f17['status'](0xc8)[_0x2e9072(0xe2)]({'message1':_0x40ba76[_0x2e9072(0x19b)]});}else{if(_0x4dd1d1[_0x2e9072(0x105)]['for_categorize']=='GS')try{const {invoice:_0x596e63,date:_0x4ba2e6,warehouse_name:_0x176b98,product_name:_0xbc0f5b,primary_code:_0x52a982,secondary_code:_0x3252aa,product_code:_0x539b9d,sales_quantity:_0xc2dfe5,stocks:_0x13e9f7,return_qty:_0x5e2327,Room_name:_0x34b747,to_warehouse_name:_0x5709d8,to_Room_name:_0x347159,note:_0x461675,level:_0xed8f60,isle:_0xa55f4e,pallet:_0xddfefe,for_categorize:_0x470d79}=_0x4dd1d1[_0x2e9072(0x105)];if(typeof _0xbc0f5b==_0x2e9072(0x13d))var _0x1550bc=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xa0)]],_0x5ccb6b=[_0x4dd1d1['body'][_0x2e9072(0x173)]],_0x468238=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x158)]],_0x3e9ebf=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x116)]],_0x6f029b=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x14f)]],_0x11fddc=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x137)]],_0x3c7643=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x184)]],_0x430510=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x107)]],_0x525392=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x124)]],_0x53c91c=[_0x4dd1d1['body'][_0x2e9072(0xfd)]],_0xb816ce=[_0x4dd1d1['body'][_0x2e9072(0xbe)]],_0x1e4b72=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xb1)]],_0xdb5298=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xd0)]],_0x227cf9=[_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xf0)]];else var _0x1550bc=[..._0x4dd1d1['body'][_0x2e9072(0xa0)]],_0x5ccb6b=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x173)]],_0x468238=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x158)]],_0x3e9ebf=[..._0x4dd1d1['body'][_0x2e9072(0x116)]],_0x6f029b=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x14f)]],_0x11fddc=[..._0x4dd1d1['body'][_0x2e9072(0x137)]],_0x3c7643=[..._0x4dd1d1['body'][_0x2e9072(0x184)]],_0x430510=[..._0x4dd1d1['body']['maxPerUnit']],_0x525392=[..._0x4dd1d1['body'][_0x2e9072(0x124)]],_0x53c91c=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xfd)]],_0xb816ce=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xbe)]],_0x1e4b72=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xb1)]],_0xdb5298=[..._0x4dd1d1[_0x2e9072(0x105)]['production_date']],_0x227cf9=[..._0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0xf0)]];const _0x4f8b31=_0x1550bc['map'](_0x268f8a=>{return _0x268f8a={'product_name':_0x268f8a};});_0x5ccb6b['forEach']((_0x523528,_0xc1c09e)=>{_0x4f8b31[_0xc1c09e]['primary_code']=_0x523528;}),_0x468238['forEach']((_0x1352b3,_0x1125d3)=>{var _0x46736f=_0x2e9072;_0x4f8b31[_0x1125d3][_0x46736f(0x158)]=_0x1352b3;}),_0x3e9ebf['forEach']((_0x1025f9,_0x2e4734)=>{_0x4f8b31[_0x2e4734]['product_code']=_0x1025f9;}),_0x6f029b[_0x2e9072(0xaf)]((_0x43d3da,_0x4a4d8e)=>{var _0xb34207=_0x2e9072;_0x4f8b31[_0x4a4d8e][_0xb34207(0x172)]=_0x43d3da;}),_0x11fddc[_0x2e9072(0xaf)]((_0x595db1,_0x485b94)=>{var _0x7f592f=_0x2e9072;_0x4f8b31[_0x485b94][_0x7f592f(0x137)]=_0x595db1;}),_0x3c7643[_0x2e9072(0xaf)]((_0x35e8a7,_0x1308af)=>{_0x4f8b31[_0x1308af]['bay']=_0x35e8a7;}),_0x430510[_0x2e9072(0xaf)]((_0x2094cd,_0x39437b)=>{var _0x3e7432=_0x2e9072;_0x4f8b31[_0x39437b][_0x3e7432(0x107)]=_0x2094cd;}),_0x525392[_0x2e9072(0xaf)]((_0x29b78c,_0x5d6433)=>{var _0xb81108=_0x2e9072;_0x4f8b31[_0x5d6433][_0xb81108(0x124)]=_0x29b78c;}),_0x53c91c['forEach']((_0x4edd32,_0x4ce3e3)=>{_0x4f8b31[_0x4ce3e3]['batch_code']=_0x4edd32;}),_0xb816ce[_0x2e9072(0xaf)]((_0x101615,_0x26fcf9)=>{_0x4f8b31[_0x26fcf9]['secondary_unit']=_0x101615;}),_0x1e4b72['forEach']((_0x3b8c40,_0x72c2fb)=>{_0x4f8b31[_0x72c2fb]['unit']=_0x3b8c40;}),_0xdb5298['forEach']((_0x4562bb,_0xb8f8ea)=>{_0x4f8b31[_0xb8f8ea]['production_date']=_0x4562bb;}),_0x227cf9[_0x2e9072(0xaf)]((_0x5187f9,_0x1f132b)=>{_0x4f8b31[_0x1f132b]['expiry_date']=_0x5187f9;});var _0x596029=0x0;_0x4f8b31['forEach'](_0x1cd219=>{var _0x40856d=_0x2e9072;(parseInt(_0x1cd219['sale_qty'])<parseInt(_0x1cd219[_0x40856d(0x137)])||parseInt(_0x1cd219[_0x40856d(0xa4)])<parseInt(_0x1cd219[_0x40856d(0x137)])&&parseInt(_0x1cd219[_0x40856d(0x172)])>parseInt(_0x1cd219['return_qty'])||parseInt(_0x1cd219[_0x40856d(0x137)])==0x0)&&_0x596029++;});if(_0x596029!=0x0)return _0x4dd1d1[_0x2e9072(0x155)]('errors',_0x2e9072(0x103)),_0x378f17[_0x2e9072(0x15b)](_0x2e9072(0x175));const _0x198308=await sales_finished[_0x2e9072(0x198)]({'invoice':_0x596e63});_0x198308[_0x2e9072(0x104)]=_0x2e9072(0x11d);const _0x1b1eb2=await _0x198308[_0x2e9072(0x128)](),_0x26afe5=new sales_return_finished({'invoice':_0x596e63,'customer':_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x17b)],'date':_0x4ba2e6,'warehouse_name':_0x176b98,'room':_0x34b747,'ToWarehouse':_0x5709d8,'ToRoom':_0x347159,'return_sale':_0x4f8b31,'note':_0x461675,'warehouse_cat':_0x470d79}),_0x2e90f2=await _0x26afe5[_0x2e9072(0x128)](),_0x5e5ed3=await sales_return_finished['findOne']({'invoice':_0x596e63}),_0x318487=await warehouse['findOne']({'name':_0x5709d8,'room':_0x347159,'warehouse_category':_0x2e9072(0x15e)});_0x5e5ed3[_0x2e9072(0x142)]['forEach'](_0x186b3e=>{var _0x342330=_0x2e9072,_0x2ed2c0=0x0;const _0x3dc4e1=_0x318487['product_details'][_0x342330(0x1a2)](_0x5173d7=>{var _0x18b2a7=_0x342330;_0x5173d7['product_name']==_0x186b3e[_0x18b2a7(0xa0)]&&_0x5173d7[_0x18b2a7(0x184)]==_0x186b3e[_0x18b2a7(0x184)]&&_0x5173d7['expiry_date']==_0x186b3e['expiry_date']&&_0x5173d7[_0x18b2a7(0xd0)]==_0x186b3e[_0x18b2a7(0xd0)]&&_0x5173d7[_0x18b2a7(0xfd)]==_0x186b3e[_0x18b2a7(0xfd)]&&(_0x5173d7[_0x18b2a7(0x1ae)]=parseInt(_0x5173d7[_0x18b2a7(0x1ae)])+parseInt(_0x186b3e['return_qty']),_0x2ed2c0++);});_0x2ed2c0=='0'&&(_0x318487[_0x342330(0x99)]=_0x318487[_0x342330(0x99)]['concat']({'product_name':_0x186b3e[_0x342330(0xa0)],'product_stock':_0x186b3e[_0x342330(0x137)],'primary_code':_0x186b3e['primary_code'],'secondary_code':_0x186b3e[_0x342330(0x158)],'product_code':_0x186b3e[_0x342330(0x116)],'bay':_0x186b3e[_0x342330(0x184)],'batch_code':_0x186b3e[_0x342330(0xfd)],'maxPerUnit':_0x186b3e[_0x342330(0x107)],'production_date':_0x186b3e[_0x342330(0xd0)],'expiry_date':_0x186b3e[_0x342330(0xf0)],'secondary_unit':_0x186b3e[_0x342330(0xbe)],'unit':_0x186b3e[_0x342330(0xb1)],'maxProducts':_0x186b3e[_0x342330(0x124)]}));}),await _0x318487[_0x2e9072(0x128)](),console[_0x2e9072(0xed)](_0x4dd1d1[_0x2e9072(0x105)]);const _0x3e7be5=new c_payment_data({'invoice':_0x596e63,'customer':_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x17b)],'reason':'Sale\x20Return'});await _0x3e7be5[_0x2e9072(0x128)]();const _0x3d4a6b=await master_shop[_0x2e9072(0xf4)]();console[_0x2e9072(0xed)](_0x2e9072(0xf8),_0x3d4a6b[0x0][_0x2e9072(0x169)]);const _0x29e463=await email_settings[_0x2e9072(0x198)](),_0x59944b=await customer[_0x2e9072(0x198)]({'name':_0x4dd1d1[_0x2e9072(0x105)][_0x2e9072(0x17b)]});console['log'](_0x2e9072(0x1af),_0x59944b);_0x3d4a6b[0x0][_0x2e9072(0xee)]==0x1?(right_currency=_0x3d4a6b[0x0][_0x2e9072(0xd4)],left_currency=''):(right_currency='',left_currency=_0x3d4a6b[0x0][_0x2e9072(0xd4)]);var _0x370bca=_0x1550bc,_0x39b0de=_0x11fddc,_0x444816='',_0x2ff804;for(_0x2ff804 in _0x370bca){_0x444816+=_0x2e9072(0x1b2)+_0x2e9072(0xb3)+_0x370bca[_0x2ff804]+_0x2e9072(0x18f)+_0x2e9072(0xb3)+_0x39b0de[_0x2ff804]+_0x2e9072(0x18f)+'</tr>';}console[_0x2e9072(0xed)](_0x2e9072(0x1a9),_0x444816);let _0xea5748=nodemailer[_0x2e9072(0x1aa)]({'service':_0x2e9072(0x12c),'auth':{'user':_0x29e463[_0x2e9072(0xbc)],'pass':_0x29e463['password']}}),_0x236598={'from':_0x29e463['email'],'to':_0x59944b[_0x2e9072(0xbc)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2e9072(0xf3),'path':__dirname+_0x2e9072(0x10b)+_0x2e9072(0x10c)+_0x3d4a6b[0x0]['image'],'cid':_0x2e9072(0x11c)}],'html':_0x2e9072(0xf6)+'<html><head><title></title>'+_0x2e9072(0x16c)+'<div>'+_0x2e9072(0xfb)+'<div>'+_0x2e9072(0x194)+_0x2e9072(0xa9)+_0x2e9072(0x133)+_0x2e9072(0x11a)+_0x3d4a6b[0x0][_0x2e9072(0xdf)]+_0x2e9072(0xc7)+_0x2e9072(0xa9)+_0x2e9072(0xa9)+_0x2e9072(0xa6)+'<div>'+_0x2e9072(0xb4)+_0x2e9072(0x134)+_0x596e63+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2e9072(0xb9)+_0x4ba2e6+'\x20'+_0x2e9072(0xac)+'</h5>'+_0x2e9072(0xa9)+_0x2e9072(0xcd)+_0x2e9072(0x10d)+_0x2e9072(0x1b2)+_0x2e9072(0xc5)+_0x2e9072(0xbb)+_0x2e9072(0x12a)+_0x2e9072(0x114)+_0x2e9072(0x154)+'</thead>'+_0x2e9072(0x183)+'\x20'+_0x444816+'\x20'+'</tbody>'+_0x2e9072(0xaa)+_0x2e9072(0x133)+'<strong>\x20Regards\x20</strong>'+_0x2e9072(0xc1)+_0x3d4a6b[0x0]['site_title']+_0x2e9072(0x13e)+_0x2e9072(0xa9)+'</div>'+_0x2e9072(0x18c)};_0xea5748[_0x2e9072(0x101)](_0x236598,function(_0x1c68f8,_0x40acf6){var _0x445e6b=_0x2e9072;_0x1c68f8?(console['log'](_0x1c68f8),console['log'](_0x445e6b(0x144))):console[_0x445e6b(0xed)](_0x445e6b(0x19e));}),_0x4dd1d1[_0x2e9072(0x155)](_0x2e9072(0x188),_0x2e9072(0x11b)),_0x378f17[_0x2e9072(0x15b)](_0x2e9072(0xe9));}catch(_0x5ec573){console['log'](_0x5ec573),_0x378f17['status'](0xc8)[_0x2e9072(0xe2)]({'message1':_0x5ec573[_0x2e9072(0x19b)]});}}}),router[a0_0xeb5024(0xc2)](a0_0xeb5024(0x170),auth,async(_0x57f2,_0xd6d690)=>{var _0x139b77=a0_0xeb5024;try{const {username:_0x333c55,email:_0x9d60e4,role:_0x52e669}=_0x57f2[_0x139b77(0x109)],_0x319976=_0x57f2[_0x139b77(0x109)],_0x8ce14e=await profile[_0x139b77(0x198)]({'email':_0x319976[_0x139b77(0xbc)]}),_0x1720a9=await master_shop[_0x139b77(0xf4)]();console[_0x139b77(0xed)]('barcode\x20Product\x20master',_0x1720a9);const _0x1cbe87=_0x57f2[_0x139b77(0x136)]['id'],_0x1f3966=await sales[_0x139b77(0x115)](_0x1cbe87);console[_0x139b77(0xed)]('barcode\x20user_id',_0x1f3966);if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0x1a5))var _0x6fd5f5=users[_0x139b77(0x165)];else{if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0xbf))var _0x6fd5f5=users['Hindi'];else{if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0x18d))var _0x6fd5f5=users['German'];else{if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0xf2))var _0x6fd5f5=users['Spanish'];else{if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0x19c))var _0x6fd5f5=users[_0x139b77(0x19c)];else{if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0x12b))var _0x6fd5f5=users['Portuguese'];else{if(_0x1720a9[0x0][_0x139b77(0x1b5)]==_0x139b77(0x197))var _0x6fd5f5=users[_0x139b77(0x197)];else{if(_0x1720a9[0x0]['language']=='Arabic\x20(ae)')var _0x6fd5f5=users[_0x139b77(0xe7)];}}}}}}}_0xd6d690[_0x139b77(0x182)](_0x139b77(0x186),{'success':_0x57f2[_0x139b77(0x155)](_0x139b77(0x188)),'errors':_0x57f2[_0x139b77(0x155)]('errors'),'role':_0x319976,'profile':_0x8ce14e,'alldata':_0x1f3966,'master_shop':_0x1720a9,'language':_0x6fd5f5});}catch(_0x5ef618){console[_0x139b77(0xed)](_0x5ef618);}}),router[a0_0xeb5024(0x179)](a0_0xeb5024(0x10a),async(_0xd60d14,_0x2f0d65)=>{var _0x5607af=a0_0xeb5024;const {product_code:_0x2fb309,warehouse_name:_0x99112b,rooms_data:_0x4dadc0,Roomslist:_0x3a7028,sales_category:_0x92069}=_0xd60d14[_0x5607af(0x105)],_0x5535f8=_0x3a7028[_0x5607af(0x150)](','),_0x184224=[];async function _0x513bec(_0x502e6d){var _0x10ebb0=_0x5607af;const _0x92bb9a=await warehouse[_0x10ebb0(0x140)]([{'$match':{'name':_0x99112b,'room':_0x502e6d}},{'$unwind':_0x10ebb0(0xc9)},{'$match':{'product_details.primary_code':_0x2fb309}},{'$group':{'_id':_0x10ebb0(0x13a),'name':{'$first':_0x10ebb0(0x122)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x10ebb0(0xf5)},'secondary_code':{'$first':_0x10ebb0(0xd3)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x10ebb0(0xd2)},'bay':{'$first':_0x10ebb0(0x9e)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x10ebb0(0xb0)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x10ebb0(0xdd)},'storage':{'$first':_0x10ebb0(0xe0)},'rack':{'$first':_0x10ebb0(0x199)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x10ebb0(0x123)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x10ebb0(0x196)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x10ebb0(0x96)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0x10ebb0(0x17d)},'sales_category':{'$first':_0x10ebb0(0xd9)}}}]),_0x556a8b=await warehouse[_0x10ebb0(0x140)]([{'$match':{'name':_0x99112b,'room':_0x502e6d}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x2fb309}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x10ebb0(0x122)},'product_stock':{'$first':_0x10ebb0(0xde)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10ebb0(0xd3)},'product_code':{'$first':_0x10ebb0(0x181)},'level':{'$first':_0x10ebb0(0x9e)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x10ebb0(0xcf)},'pallet':{'$first':_0x10ebb0(0xb0)},'unit':{'$first':_0x10ebb0(0x131)},'secondary_unit':{'$first':_0x10ebb0(0xdd)},'storage':{'$first':_0x10ebb0(0xe0)},'rack':{'$first':_0x10ebb0(0x199)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x10ebb0(0xa5)},'maxPerUnit':{'$first':_0x10ebb0(0x123)},'batch_code':{'$first':_0x10ebb0(0x11f)},'product_cat':{'$first':_0x10ebb0(0x196)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x10ebb0(0x96)},'uuid':{'$first':_0x10ebb0(0x151)},'gross_price':{'$first':_0x10ebb0(0x17d)},'sales_category':{'$first':'$product_details.sales_category'}}}]);if(_0x92bb9a[_0x10ebb0(0x1ac)]>0x0)_0x184224[_0x10ebb0(0xa2)](_0x92bb9a);else _0x556a8b[_0x10ebb0(0x1ac)]>0x0&&_0x184224[_0x10ebb0(0xa2)](_0x556a8b);}const _0x22a1fd=_0x5535f8[_0x5607af(0x1a2)](_0x68ced6=>_0x513bec(_0x68ced6));await Promise[_0x5607af(0x98)](_0x22a1fd),_0x2f0d65[_0x5607af(0xe2)](_0x184224);}),router[a0_0xeb5024(0x179)](a0_0xeb5024(0xca),async(_0x3cf9ce,_0x39b7e4)=>{var _0x511430=a0_0xeb5024;const {product_code:_0x575fd2,warehouse_name:_0x1da475,rooms_data:_0x598bd8,Roomslist:_0x11b963,sales_category:_0x22e1b3}=_0x3cf9ce['body'],_0x4b26c7=_0x11b963['split'](','),_0x4ad9ee=[];async function _0x49ab27(_0x2f1b81){var _0xe5528b=a0_0x1796;const _0x58a886=await warehouse[_0xe5528b(0x140)]([{'$match':{'name':_0x1da475,'room':_0x2f1b81}},{'$unwind':_0xe5528b(0xc9)},{'$match':{'product_details.primary_code':_0x575fd2,'product_details.sales_category':_0x22e1b3,'product_details.type_products':_0xe5528b(0xed)}},{'$group':{'_id':_0xe5528b(0x13a),'name':{'$first':_0xe5528b(0x122)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xe5528b(0xd3)},'product_code':{'$first':_0xe5528b(0x181)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0xe5528b(0x9e)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xe5528b(0x131)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0xe5528b(0xe0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xe5528b(0x125)},'production_date':{'$first':_0xe5528b(0xa5)},'maxPerUnit':{'$first':_0xe5528b(0x123)},'batch_code':{'$first':_0xe5528b(0x11f)},'product_cat':{'$first':_0xe5528b(0x196)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xe5528b(0x174)},'invoice':{'$first':_0xe5528b(0x96)},'uuid':{'$first':_0xe5528b(0x151)},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0xe5528b(0xd9)},'type_products':{'$first':_0xe5528b(0x1ab)}}}]);console[_0xe5528b(0xed)](_0xe5528b(0xed)+'\x20<>\x20'+_0x575fd2+_0xe5528b(0x17f)+_0x22e1b3);const _0x3cf415=await warehouse[_0xe5528b(0x140)]([{'$match':{'name':_0x1da475,'room':_0x2f1b81}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x575fd2,'product_details.sales_category':_0x22e1b3,'product_details.type_products':_0xe5528b(0xed)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xe5528b(0x122)},'product_stock':{'$first':_0xe5528b(0xde)},'primary_code':{'$first':_0xe5528b(0xf5)},'secondary_code':{'$first':_0xe5528b(0xd3)},'product_code':{'$first':_0xe5528b(0x181)},'level':{'$first':_0xe5528b(0x9e)},'isle':{'$first':_0xe5528b(0x130)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xe5528b(0xb0)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xe5528b(0xdd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xe5528b(0x199)},'expiry_date':{'$first':_0xe5528b(0x125)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0xe5528b(0x123)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0xe5528b(0x196)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xe5528b(0x174)},'invoice':{'$first':_0xe5528b(0x96)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0xe5528b(0x17d)},'sales_category':{'$first':_0xe5528b(0xd9)},'type_products':{'$first':_0xe5528b(0x1ab)}}}]);if(_0x58a886[_0xe5528b(0x1ac)]>0x0)_0x4ad9ee['push'](_0x58a886);else _0x3cf415[_0xe5528b(0x1ac)]>0x0&&_0x4ad9ee[_0xe5528b(0xa2)](_0x3cf415);}const _0x156f93=_0x4b26c7['map'](_0x46748f=>_0x49ab27(_0x46748f));await Promise[_0x511430(0x98)](_0x156f93),_0x39b7e4[_0x511430(0xe2)](_0x4ad9ee);}),module[a0_0xeb5024(0xce)]=router;