var a0_0x4fd025=a0_0x7afb;(function(_0x39d424,_0x159708){var _0x559440=a0_0x7afb,_0xdc6282=_0x39d424();while(!![]){try{var _0x3c81be=parseInt(_0x559440(0x257))/0x1+parseInt(_0x559440(0x12c))/0x2*(parseInt(_0x559440(0x267))/0x3)+parseInt(_0x559440(0x198))/0x4*(parseInt(_0x559440(0x1a7))/0x5)+-parseInt(_0x559440(0x25f))/0x6+-parseInt(_0x559440(0x264))/0x7+-parseInt(_0x559440(0x247))/0x8*(-parseInt(_0x559440(0x268))/0x9)+-parseInt(_0x559440(0x1e8))/0xa*(parseInt(_0x559440(0x20c))/0xb);if(_0x3c81be===_0x159708)break;else _0xdc6282['push'](_0xdc6282['shift']());}catch(_0x4bb1c7){_0xdc6282['push'](_0xdc6282['shift']());}}}(a0_0x3e6d,0xde35c));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require(a0_0x4fd025(0x225)),auth=require('../middleware/auth'),nodemailer=require(a0_0x4fd025(0x1ca)),users=require(a0_0x4fd025(0x1e7)),mongoose=require(a0_0x4fd025(0x219));router[a0_0x4fd025(0x18e)](a0_0x4fd025(0x1a4),auth,async(_0x17a92b,_0x2ab359)=>{var _0x3f8cf8=a0_0x4fd025;try{const {username:_0x28f902,email:_0x403177,role:_0x2812ea}=_0x17a92b[_0x3f8cf8(0x256)],_0x4fab35=_0x17a92b[_0x3f8cf8(0x256)],_0x27fbf3=await profile[_0x3f8cf8(0x232)]({'email':_0x4fab35['email']}),_0xe218c0=await master_shop[_0x3f8cf8(0x271)]();let _0x58d586;if(_0x4fab35[_0x3f8cf8(0x193)]==_0x3f8cf8(0x224)){const _0x2e6749=await staff['findOne']({'email':_0x4fab35['email']});_0x58d586=await sales_finished[_0x3f8cf8(0x270)]([{'$match':{'typeOfProducts':_0x3f8cf8(0x13d)}},{'$unwind':_0x3f8cf8(0x13f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3f8cf8(0x1d5)},'customers':{'$first':_0x3f8cf8(0x208)},'date':{'$first':_0x3f8cf8(0x17f)},'warehouse_name':{'$first':_0x3f8cf8(0x201)},'sale_product':{'$push':_0x3f8cf8(0x13f)},'note':{'$first':_0x3f8cf8(0x18a)},'return_data':{'$first':_0x3f8cf8(0x1e2)},'customers_docs':{'$first':_0x3f8cf8(0x278)},'total_saleproduct_quantity':{'$sum':_0x3f8cf8(0x143)},'level':{'$addToSet':_0x3f8cf8(0x23a)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3f8cf8(0x19b)},'pallet':{'$addToSet':_0x3f8cf8(0x1af)},'finalize':{'$first':_0x3f8cf8(0x24d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x58d586=await sales_finished[_0x3f8cf8(0x270)]([{'$match':{'typeOfProducts':_0x3f8cf8(0x13d)}},{'$unwind':_0x3f8cf8(0x13f)},{'$group':{'_id':_0x3f8cf8(0x14c),'invoice':{'$first':_0x3f8cf8(0x1d5)},'customers':{'$first':_0x3f8cf8(0x208)},'date':{'$first':_0x3f8cf8(0x17f)},'warehouse_name':{'$first':_0x3f8cf8(0x201)},'sale_product':{'$push':_0x3f8cf8(0x13f)},'note':{'$first':'$note'},'return_data':{'$first':_0x3f8cf8(0x1e2)},'customers_docs':{'$first':_0x3f8cf8(0x278)},'total_saleproduct_quantity':{'$sum':_0x3f8cf8(0x143)},'level':{'$addToSet':_0x3f8cf8(0x23a)},'isle':{'$addToSet':_0x3f8cf8(0x214)},'type':{'$addToSet':_0x3f8cf8(0x19b)},'pallet':{'$addToSet':_0x3f8cf8(0x1af)},'finalize':{'$first':_0x3f8cf8(0x24d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x176)){var _0x10e49b=users[_0x3f8cf8(0x275)];console[_0x3f8cf8(0x22a)](_0x10e49b);}else{if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x16c))var _0x10e49b=users['Hindi'];else{if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x1a2))var _0x10e49b=users[_0x3f8cf8(0x1a2)];else{if(_0xe218c0[0x0]['language']=='Spanish')var _0x10e49b=users['Spanish'];else{if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x1fc))var _0x10e49b=users[_0x3f8cf8(0x1fc)];else{if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x1bb))var _0x10e49b=users[_0x3f8cf8(0x160)];else{if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x1f0))var _0x10e49b=users['Chinese'];else{if(_0xe218c0[0x0][_0x3f8cf8(0x252)]==_0x3f8cf8(0x1e1))var _0x10e49b=users[_0x3f8cf8(0x141)];}}}}}}}_0x2ab359[_0x3f8cf8(0x1a8)](_0x3f8cf8(0x16a),{'success':_0x17a92b[_0x3f8cf8(0x147)]('success'),'errors':_0x17a92b[_0x3f8cf8(0x147)](_0x3f8cf8(0x1da)),'sales':_0x58d586,'profile':_0x27fbf3,'role':_0x4fab35,'master_shop':_0xe218c0,'language':_0x10e49b});}catch(_0x1bf21f){console[_0x3f8cf8(0x22a)](_0x1bf21f);}}),router[a0_0x4fd025(0x18e)]('/view_log',auth,async(_0x3aa17c,_0x58cd22)=>{var _0x3e13f9=a0_0x4fd025;try{const {username:_0x1eedd7,email:_0x1d16f5,role:_0x5166a2}=_0x3aa17c[_0x3e13f9(0x256)],_0x176d31=_0x3aa17c[_0x3e13f9(0x256)],_0x77f73f=await profile[_0x3e13f9(0x232)]({'email':_0x176d31['email']}),_0x501d0f=await master_shop[_0x3e13f9(0x271)]();let _0xa8bbc2;if(_0x176d31[_0x3e13f9(0x193)]=='staff'){const _0x1b32b9=await staff[_0x3e13f9(0x232)]({'email':_0x176d31[_0x3e13f9(0x1a0)]});_0xa8bbc2=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x3e13f9(0x245)}},{'$unwind':_0x3e13f9(0x13f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3e13f9(0x1d5)},'customers':{'$first':_0x3e13f9(0x208)},'date':{'$first':_0x3e13f9(0x17f)},'warehouse_name':{'$first':_0x3e13f9(0x201)},'sale_product':{'$push':_0x3e13f9(0x13f)},'note':{'$first':_0x3e13f9(0x18a)},'return_data':{'$first':_0x3e13f9(0x1e2)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x3e13f9(0x143)},'level':{'$addToSet':_0x3e13f9(0x23a)},'isle':{'$addToSet':_0x3e13f9(0x214)},'type':{'$addToSet':_0x3e13f9(0x19b)},'pallet':{'$addToSet':_0x3e13f9(0x1af)},'finalize':{'$first':_0x3e13f9(0x24d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xa8bbc2=await sales_finished['aggregate']([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x3e13f9(0x13f)},{'$group':{'_id':_0x3e13f9(0x14c),'invoice':{'$first':_0x3e13f9(0x1d5)},'customers':{'$first':_0x3e13f9(0x208)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3e13f9(0x13f)},'note':{'$first':'$note'},'return_data':{'$first':_0x3e13f9(0x1e2)},'customers_docs':{'$first':_0x3e13f9(0x278)},'total_saleproduct_quantity':{'$sum':_0x3e13f9(0x143)},'level':{'$addToSet':_0x3e13f9(0x23a)},'isle':{'$addToSet':_0x3e13f9(0x214)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x3e13f9(0x1af)},'finalize':{'$first':_0x3e13f9(0x24d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x501d0f[0x0][_0x3e13f9(0x252)]==_0x3e13f9(0x176)){var _0x5dc767=users[_0x3e13f9(0x275)];console[_0x3e13f9(0x22a)](_0x5dc767);}else{if(_0x501d0f[0x0]['language']==_0x3e13f9(0x16c))var _0x5dc767=users[_0x3e13f9(0x16c)];else{if(_0x501d0f[0x0]['language']=='German')var _0x5dc767=users[_0x3e13f9(0x1a2)];else{if(_0x501d0f[0x0][_0x3e13f9(0x252)]==_0x3e13f9(0x20b))var _0x5dc767=users['Spanish'];else{if(_0x501d0f[0x0][_0x3e13f9(0x252)]=='French')var _0x5dc767=users[_0x3e13f9(0x1fc)];else{if(_0x501d0f[0x0]['language']==_0x3e13f9(0x1bb))var _0x5dc767=users[_0x3e13f9(0x160)];else{if(_0x501d0f[0x0]['language']==_0x3e13f9(0x1f0))var _0x5dc767=users['Chinese'];else{if(_0x501d0f[0x0][_0x3e13f9(0x252)]=='Arabic\x20(ae)')var _0x5dc767=users['Arabic'];}}}}}}}_0x58cd22[_0x3e13f9(0x1a8)]('all_sales_finished_logs',{'success':_0x3aa17c['flash']('success'),'errors':_0x3aa17c[_0x3e13f9(0x147)]('errors'),'sales':_0xa8bbc2,'profile':_0x77f73f,'role':_0x176d31,'master_shop':_0x501d0f,'language':_0x5dc767});}catch(_0xcb4748){console[_0x3e13f9(0x22a)](_0xcb4748);}});function a0_0x7afb(_0x189ba9,_0x141273){var _0x3e6d13=a0_0x3e6d();return a0_0x7afb=function(_0x7afb9a,_0x3d3374){_0x7afb9a=_0x7afb9a-0x12a;var _0x2596a9=_0x3e6d13[_0x7afb9a];return _0x2596a9;},a0_0x7afb(_0x189ba9,_0x141273);}async function getRandom8DigitNumber(){var _0x5acdfc=a0_0x4fd025;const _0x244ec1=0x989680,_0x29f5ae=0x5f5e0ff,_0x47e604=Math[_0x5acdfc(0x244)](Math[_0x5acdfc(0x27e)]()*(_0x29f5ae-_0x244ec1+0x1))+_0x244ec1;var _0x3230bf;const _0x4dd054=await sales_finished[_0x5acdfc(0x232)]({'invoice':_0x5acdfc(0x131)+_0x47e604});return _0x4dd054&&_0x4dd054[_0x5acdfc(0x251)]>0x0?_0x3230bf=_0x5acdfc(0x131)+_0x47e604:_0x3230bf=_0x5acdfc(0x131)+_0x47e604,_0x3230bf;}router[a0_0x4fd025(0x18e)]('/view/add_sales',auth,async(_0x1c3ede,_0x459330)=>{var _0x1d8cf5=a0_0x4fd025;try{const {username:_0x10ea5,email:_0xf8e395,role:_0x414a2f}=_0x1c3ede[_0x1d8cf5(0x256)],_0x2437e8=_0x1c3ede[_0x1d8cf5(0x256)],_0x1433b6=await profile[_0x1d8cf5(0x232)]({'email':_0x2437e8[_0x1d8cf5(0x1a0)]}),_0x452521=await master_shop[_0x1d8cf5(0x271)](),_0x1f2d8e=await customer[_0x1d8cf5(0x271)]({});let _0x23857b;if(_0x2437e8[_0x1d8cf5(0x193)]==_0x1d8cf5(0x224)){const _0x40e639=await staff[_0x1d8cf5(0x232)]({'email':_0x2437e8[_0x1d8cf5(0x1a0)]});_0x23857b=await warehouse['aggregate']([{'$match':{'status':_0x1d8cf5(0x185),'name':_0x40e639['warehouse']}},{'$group':{'_id':_0x1d8cf5(0x24c),'name':{'$first':_0x1d8cf5(0x24c)}}},{'$sort':{'name':0x1}}]);}else _0x23857b=await warehouse[_0x1d8cf5(0x270)]([{'$match':{'status':_0x1d8cf5(0x185)}},{'$group':{'_id':_0x1d8cf5(0x24c),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x289962=await product[_0x1d8cf5(0x271)]({});var _0x2e29ee=[_0x1d8cf5(0x22b),_0x1d8cf5(0x23b)];const _0x5e811c=await sales_finished[_0x1d8cf5(0x271)]({}),_0x133388=_0x5e811c['length']+0x1,_0x210562=_0x1d8cf5(0x131)+_0x133388[_0x1d8cf5(0x168)]()[_0x1d8cf5(0x16e)](0x5,'0');if(_0x452521[0x0]['language']==_0x1d8cf5(0x176)){var _0x4f6782=users[_0x1d8cf5(0x275)];console['log'](_0x4f6782);}else{if(_0x452521[0x0]['language']==_0x1d8cf5(0x16c))var _0x4f6782=users['Hindi'];else{if(_0x452521[0x0][_0x1d8cf5(0x252)]==_0x1d8cf5(0x1a2))var _0x4f6782=users[_0x1d8cf5(0x1a2)];else{if(_0x452521[0x0]['language']=='Spanish')var _0x4f6782=users[_0x1d8cf5(0x20b)];else{if(_0x452521[0x0][_0x1d8cf5(0x252)]=='French')var _0x4f6782=users['French'];else{if(_0x452521[0x0][_0x1d8cf5(0x252)]==_0x1d8cf5(0x1bb))var _0x4f6782=users[_0x1d8cf5(0x160)];else{if(_0x452521[0x0][_0x1d8cf5(0x252)]==_0x1d8cf5(0x1f0))var _0x4f6782=users[_0x1d8cf5(0x1f0)];else{if(_0x452521[0x0][_0x1d8cf5(0x252)]==_0x1d8cf5(0x1e1))var _0x4f6782=users['Arabic'];}}}}}}}const _0x5153d2=getRandom8DigitNumber();_0x5153d2['then'](_0x5c2ab1=>{var _0x19d436=_0x1d8cf5;_0x459330[_0x19d436(0x1a8)](_0x19d436(0x170),{'success':_0x1c3ede['flash'](_0x19d436(0x22d)),'errors':_0x1c3ede[_0x19d436(0x147)]('errors'),'role':_0x2437e8,'profile':_0x1433b6,'customer':_0x1f2d8e,'warehouse':_0x23857b,'product':_0x289962,'invoice':_0x5c2ab1,'master_shop':_0x452521,'language':_0x4f6782,'rooms_data':_0x2e29ee});})[_0x1d8cf5(0x243)](_0x532213=>{var _0x1de3e6=_0x1d8cf5;_0x1c3ede[_0x1de3e6(0x147)](_0x1de3e6(0x1da),_0x1de3e6(0x22f)),_0x459330['redirect'](_0x1de3e6(0x240));});}catch(_0xb81067){console['log'](_0xb81067);}}),router[a0_0x4fd025(0x18e)](a0_0x4fd025(0x195),auth,async(_0x293104,_0x235544)=>{var _0x2429e2=a0_0x4fd025;try{const {username:_0x5ac2fc,email:_0xd0bb8d,role:_0x1d0b79}=_0x293104[_0x2429e2(0x256)],_0x102cfe=_0x293104['user'],_0x107475=await profile['findOne']({'email':_0x102cfe[_0x2429e2(0x1a0)]}),_0x21f6e4=await master_shop['find'](),_0x5c36f9=await customer[_0x2429e2(0x271)]({});let _0x161923;if(_0x102cfe[_0x2429e2(0x193)]==_0x2429e2(0x224)){const _0x44659c=await staff[_0x2429e2(0x232)]({'email':_0x102cfe[_0x2429e2(0x1a0)]});_0x161923=await warehouse['aggregate']([{'$match':{'status':_0x2429e2(0x185),'name':_0x44659c['warehouse']}},{'$group':{'_id':_0x2429e2(0x24c),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x161923=await warehouse[_0x2429e2(0x270)]([{'$match':{'status':_0x2429e2(0x185)}},{'$group':{'_id':_0x2429e2(0x24c),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x125acf=await product[_0x2429e2(0x271)]({});var _0x5b2232=[_0x2429e2(0x22b),_0x2429e2(0x23b)];const _0x314f55=await sales_finished[_0x2429e2(0x271)]({}),_0x519977=_0x314f55[_0x2429e2(0x251)]+0x1,_0x2239fc=_0x2429e2(0x131)+_0x519977[_0x2429e2(0x168)]()[_0x2429e2(0x16e)](0x5,'0');if(_0x21f6e4[0x0][_0x2429e2(0x252)]==_0x2429e2(0x176)){var _0x2a1225=users[_0x2429e2(0x275)];console[_0x2429e2(0x22a)](_0x2a1225);}else{if(_0x21f6e4[0x0][_0x2429e2(0x252)]==_0x2429e2(0x16c))var _0x2a1225=users[_0x2429e2(0x16c)];else{if(_0x21f6e4[0x0][_0x2429e2(0x252)]==_0x2429e2(0x1a2))var _0x2a1225=users[_0x2429e2(0x1a2)];else{if(_0x21f6e4[0x0]['language']=='Spanish')var _0x2a1225=users[_0x2429e2(0x20b)];else{if(_0x21f6e4[0x0]['language']==_0x2429e2(0x1fc))var _0x2a1225=users['French'];else{if(_0x21f6e4[0x0][_0x2429e2(0x252)]==_0x2429e2(0x1bb))var _0x2a1225=users[_0x2429e2(0x160)];else{if(_0x21f6e4[0x0][_0x2429e2(0x252)]==_0x2429e2(0x1f0))var _0x2a1225=users[_0x2429e2(0x1f0)];else{if(_0x21f6e4[0x0][_0x2429e2(0x252)]==_0x2429e2(0x1e1))var _0x2a1225=users[_0x2429e2(0x141)];}}}}}}}const _0xf37426=getRandom8DigitNumber();_0xf37426[_0x2429e2(0x13b)](_0x1257cf=>{var _0x10b935=_0x2429e2;_0x235544['render']('add_sales_finished_logs',{'success':_0x293104[_0x10b935(0x147)]('success'),'errors':_0x293104[_0x10b935(0x147)](_0x10b935(0x1da)),'role':_0x102cfe,'profile':_0x107475,'customer':_0x5c36f9,'warehouse':_0x161923,'product':_0x125acf,'invoice':_0x1257cf,'master_shop':_0x21f6e4,'language':_0x2a1225,'rooms_data':_0x5b2232});})[_0x2429e2(0x243)](_0x530fa4=>{var _0x3c3e38=_0x2429e2;_0x293104[_0x3c3e38(0x147)](_0x3c3e38(0x1da),_0x3c3e38(0x22f)),_0x235544[_0x3c3e38(0x27a)](_0x3c3e38(0x240));});}catch(_0x4725df){console[_0x2429e2(0x22a)](_0x4725df);}}),router[a0_0x4fd025(0x26a)]('/view/add_sales_logs',auth,async(_0x501ad9,_0x125ef6)=>{var _0x2b9649=a0_0x4fd025;try{const {invoice:_0x3abd1d,date:_0x1c419d,warehouse_name:_0x44c303,product_name:_0x35a903,note:_0x26e153,room:_0x5bed4f,primary_code:_0x473745,secondary_code:_0x1f2a47,prod_code:_0xdb9a20,SCRN:_0x1a2ade,ReqBy:_0x1bb340,dateofreq:_0x1458a0,PO_number:_0x4ad358,typeservicesData:_0x15e162,typevehicle:_0x58a2d5,destination:_0x370aec,deliverydate:_0x340d89,driver:_0x19b64e,plate:_0x3584eb,van:_0x1d238f,DRSI:_0x5e22c8,TSU:_0x497164,TFU:_0x1bc75e,mode_transpo:_0x2af3f2,name_driver:_0x36812c,type_of_products:_0x160fe4}=_0x501ad9[_0x2b9649(0x138)];if(typeof _0x35a903=='string')var _0x2f1356=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x137)]],_0x442f10=[_0x501ad9[_0x2b9649(0x138)]['stock']],_0x212ba7=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x15e)]],_0x292905=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x162)]],_0x3c6ff2=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x19a)]],_0x5b1ec8=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x1d8)]],_0x35f30b=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x26e)]],_0x135bd2=[_0x501ad9[_0x2b9649(0x138)]['primary_unit']],_0x2d1662=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x178)]],_0x12404e=[_0x501ad9['body'][_0x2b9649(0x1ee)]],_0xabba8f=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x241)]],_0x1a4235=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x13e)]],_0xf6ca3a=[_0x501ad9['body']['max_per_unit']],_0x4fe1ec=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x161)]],_0x42c0de=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x24f)]],_0xfcbece=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x250)]],_0x3347e7=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x1ba)]],_0x5425ca=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x16b)]],_0x597d7f=[_0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x25b)]];else var _0x2f1356=[..._0x501ad9[_0x2b9649(0x138)]['product_name']],_0x442f10=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x22c)]],_0x212ba7=[..._0x501ad9[_0x2b9649(0x138)]['carton']],_0x292905=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x162)]],_0x3c6ff2=[..._0x501ad9['body'][_0x2b9649(0x19a)]],_0x5b1ec8=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x1d8)]],_0x35f30b=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x26e)]],_0x135bd2=[..._0x501ad9[_0x2b9649(0x138)]['primary_unit']],_0x2d1662=[..._0x501ad9[_0x2b9649(0x138)]['secondary_unit']],_0x12404e=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x1ee)]],_0xabba8f=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x241)]],_0x1a4235=[..._0x501ad9['body']['product_date']],_0xf6ca3a=[..._0x501ad9['body'][_0x2b9649(0x17b)]],_0x4fe1ec=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x161)]],_0x42c0de=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x24f)]],_0xfcbece=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x250)]],_0x3347e7=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x1ba)]],_0x5425ca=[..._0x501ad9[_0x2b9649(0x138)][_0x2b9649(0x16b)]],_0x597d7f=[..._0x501ad9['body'][_0x2b9649(0x25b)]];const _0x5b1b1c=_0x2f1356['map'](_0x2c7a45=>{return _0x2c7a45={'product_name':_0x2c7a45};});_0x442f10['forEach']((_0x3a3da7,_0x126268)=>{_0x5b1b1c[_0x126268]['stock']=_0x3a3da7;}),_0x212ba7['forEach']((_0xec2d3,_0x43d484)=>{var _0x151a59=_0x2b9649;_0x5b1b1c[_0x43d484][_0x151a59(0x163)]=Math[_0x151a59(0x130)](_0xec2d3);}),_0x2f1356['forEach']((_0x176007,_0x4e82f3)=>{var _0x34ade6=_0x2b9649;_0x5b1b1c[_0x4e82f3]['agent_id']=_0x501ad9['body'][_0x34ade6(0x1c5)];}),_0x597d7f['forEach']((_0x127ec6,_0x39502d)=>{_0x5b1b1c[_0x39502d]['gross_price']=_0x127ec6;}),_0x5425ca[_0x2b9649(0x1db)]((_0x3b6a91,_0x1bf51a)=>{var _0x39aaae=_0x2b9649;_0x5b1b1c[_0x1bf51a][_0x39aaae(0x16b)]=_0x3b6a91;}),_0x3347e7[_0x2b9649(0x1db)]((_0x10ed36,_0x403569)=>{_0x5b1b1c[_0x403569]['id_transaction_from']=_0x10ed36;}),_0x292905[_0x2b9649(0x1db)]((_0x303c0d,_0xa94f1a)=>{var _0x3bb26c=_0x2b9649;_0x5b1b1c[_0xa94f1a][_0x3bb26c(0x162)]=_0x303c0d;}),_0x3c6ff2[_0x2b9649(0x1db)]((_0x40c191,_0x4f85ad)=>{_0x5b1b1c[_0x4f85ad]['secondary_code']=_0x40c191;}),_0x5b1ec8['forEach']((_0x48b60b,_0x46d983)=>{var _0x4bc5fd=_0x2b9649;_0x5b1b1c[_0x46d983][_0x4bc5fd(0x1e9)]=_0x48b60b;}),_0x35f30b[_0x2b9649(0x1db)]((_0x9a21d,_0x85661)=>{var _0x570970=_0x2b9649,_0x32c72f=_0x9a21d[_0x570970(0x27d)](/[A-Za-z]+/)[0x0],_0x4671a1=parseInt(_0x9a21d['match'](/\d+/)[0x0]);_0x5b1b1c[_0x85661][_0x570970(0x1ad)]=_0x4671a1,_0x5b1b1c[_0x85661][_0x570970(0x1b3)]=_0x32c72f;}),_0x135bd2['forEach']((_0x3cbb6f,_0x40ce1d)=>{var _0x3d48e0=_0x2b9649;_0x5b1b1c[_0x40ce1d][_0x3d48e0(0x12b)]=_0x3cbb6f;}),_0x2d1662[_0x2b9649(0x1db)]((_0x23b6f4,_0x273bcb)=>{var _0x5456f7=_0x2b9649;_0x5b1b1c[_0x273bcb][_0x5456f7(0x178)]=_0x23b6f4;}),_0x12404e[_0x2b9649(0x1db)]((_0x37c7de,_0xaaa6d9)=>{var _0x4de842=_0x2b9649;_0x5b1b1c[_0xaaa6d9][_0x4de842(0x1ee)]=_0x37c7de;}),_0xabba8f['forEach']((_0x113b26,_0xedba01)=>{_0x5b1b1c[_0xedba01]['expiry_date']=_0x113b26;}),_0x1a4235[_0x2b9649(0x1db)]((_0x12a2c1,_0x34c140)=>{var _0x23a6f1=_0x2b9649;_0x5b1b1c[_0x34c140][_0x23a6f1(0x14d)]=_0x12a2c1;}),_0xf6ca3a['forEach']((_0x225244,_0x518550)=>{var _0x3f5b95=_0x2b9649;_0x5b1b1c[_0x518550][_0x3f5b95(0x1d4)]=_0x225244;}),_0x4fe1ec[_0x2b9649(0x1db)]((_0x51e57e,_0x4f62cd)=>{_0x5b1b1c[_0x4f62cd]['prod_cat']=_0x51e57e;}),_0x42c0de[_0x2b9649(0x1db)]((_0x3976a6,_0x29c95b)=>{var _0x4a4fa1=_0x2b9649;_0x5b1b1c[_0x29c95b][_0x4a4fa1(0x1c4)]=_0x3976a6;}),_0xfcbece['forEach']((_0x431927,_0xd6e81c)=>{var _0x1a8dbc=_0x2b9649;_0x5b1b1c[_0xd6e81c][_0x1a8dbc(0x213)]=_0x431927,_0x5b1b1c[_0xd6e81c][_0x1a8dbc(0x279)]=_0x1c419d;});const _0x1e3943=new sales_logs();await _0x1e3943[_0x2b9649(0x1f6)](),_0xfcbece[_0x2b9649(0x1db)]((_0x50b409,_0x1a766c)=>{var _0x268b07=_0x2b9649;_0x5b1b1c[_0x1a766c][_0x268b07(0x1cf)]=_0x268b07(0x1cb)+_0x1e3943[_0x268b07(0x262)][_0x268b07(0x168)]()['padStart'](0x8,'0');});var _0x49091d=0x0;_0x5b1b1c[_0x2b9649(0x1db)](_0xfa9224=>{var _0x2ad195=_0x2b9649;parseFloat(_0xfa9224[_0x2ad195(0x22c)])<parseFloat(_0xfa9224[_0x2ad195(0x163)])&&parseFloat(_0xfa9224[_0x2ad195(0x163)])>parseFloat(_0xfa9224[_0x2ad195(0x22c)])&&(console[_0x2ad195(0x22a)](_0xfa9224['stock']+_0x2ad195(0x136)+_0xfa9224[_0x2ad195(0x163)]),_0x49091d++);});if(_0x49091d!=0x0)return _0x501ad9[_0x2b9649(0x147)]('errors',_0x2b9649(0x151)),_0x125ef6['redirect']('back');const _0x48a70a=_0x5b1b1c[_0x2b9649(0x1bf)](_0x570b86=>_0x570b86[_0x2b9649(0x163)]!=='0'&&_0x570b86[_0x2b9649(0x163)]!==''),_0x5109f4=new sales_finished({'invoice':_0x2b9649(0x1cb)+_0x1e3943[_0x2b9649(0x262)]['toString']()[_0x2b9649(0x16e)](0x8,'0'),'sales_data':_0x501ad9['body'][_0x2b9649(0x1c5)],'customer':_0x501ad9[_0x2b9649(0x138)]['customer'],'date':_0x1c419d,'warehouse_name':_0x44c303,'sale_product':_0x48a70a,'note':_0x26e153,'room':_0x5bed4f,'primary_code':_0x473745,'secondary_code':_0x1f2a47,'prod_code':_0xdb9a20,'SCRN':_0x1a2ade,'finalize':'False','mode_transpo':_0x2af3f2,'name_driver':_0x36812c,'ReqBy':_0x1bb340,'dateofreq':_0x1458a0,'PO_number':_0x4ad358,'typeservicesData':_0x15e162,'typevehicle':_0x58a2d5,'destination':_0x370aec,'deliverydate':_0x340d89,'driver':_0x19b64e,'plate':_0x3584eb,'van':_0x1d238f,'DRSI':_0x5e22c8,'TSU':_0x497164,'TFU':_0x1bc75e,'typeOfProducts':_0x160fe4}),_0x19cd7d=await _0x5109f4[_0x2b9649(0x1f6)](),_0x28f5ab=await sales_finished[_0x2b9649(0x232)]({'invoice':_0x3abd1d});_0x501ad9[_0x2b9649(0x147)]('success',_0x2b9649(0x1f5)),_0x125ef6[_0x2b9649(0x27a)]('/all_sales_finished/preview/'+_0x19cd7d[_0x2b9649(0x21e)]);}catch(_0x5a3bdb){console[_0x2b9649(0x22a)](_0x5a3bdb);}}),router['get'](a0_0x4fd025(0x1ec),auth,async(_0x463fc0,_0x23afc3)=>{var _0x2d0fc0=a0_0x4fd025;try{const _0x2a5c54=_0x463fc0[_0x2d0fc0(0x14e)]['id'];console[_0x2d0fc0(0x22a)](_0x2a5c54);const _0x575008=await product[_0x2d0fc0(0x271)](),_0x33dd43=await purchases['aggregate']([{'$match':{'warehouse_name':_0x2a5c54}},{'$unwind':_0x2d0fc0(0x16f)},{'$group':{'_id':_0x2d0fc0(0x134)}}]);console[_0x2d0fc0(0x22a)](_0x2d0fc0(0x237),_0x33dd43),_0x23afc3['status'](0xc8)[_0x2d0fc0(0x27b)]({'purchases_data':_0x33dd43,'product_data':_0x575008});}catch(_0x1b434a){console[_0x2d0fc0(0x22a)](_0x1b434a);}}),router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x1df),auth,async(_0x17fac9,_0x296289)=>{var _0x260427=a0_0x4fd025;try{const {warehouse_data:_0x5abc5f,product_data:_0x4d6c3d}=_0x17fac9[_0x260427(0x138)];console['log'](_0x17fac9['body']['product_data']);;const _0xcea826=await master_shop['find']();console[_0x260427(0x22a)](_0x260427(0x272),_0xcea826);const _0x37f16a=await product[_0x260427(0x232)]({'name':_0x4d6c3d});console[_0x260427(0x22a)](_0x260427(0x19d),_0x37f16a);const _0x13f215=await warehouse[_0x260427(0x270)]([{'$match':{'name':_0x5abc5f}},{'$unwind':_0x260427(0x133)},{'$match':{'product_details.product_name':_0x4d6c3d}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x260427(0x212)}}}]);console['log'](_0x260427(0x205),_0x13f215),_0x296289[_0x260427(0x258)](0xc8)['json']({'master':_0xcea826,'new_product':_0x37f16a,'stock_data':_0x13f215});}catch(_0x5118ef){console['log'](_0x5118ef);}}),router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x12a),auth,async(_0x32f621,_0x1adab5)=>{var _0x4ff706=a0_0x4fd025;try{const {invoice:_0xc6e2f7,date:_0x402fae,warehouse_name:_0x1e36f6,product_name:_0x378cf2,note:_0x529a6a,room:_0x5b51d1,primary_code:_0xb9f55e,secondary_code:_0x486d71,prod_code:_0x5df2c7,SCRN:_0x5e526b,ReqBy:_0x274e2,dateofreq:_0xe82bef,PO_number:_0x390495,typeservicesData:_0x2eca08,typevehicle:_0x13f553,destination:_0xb5bc78,deliverydate:_0x323668,driver:_0x3a3a9e,plate:_0x573230,van:_0x35e9a5,DRSI:_0x75d671,TSU:_0x3b6261,TFU:_0x5e2fb4,mode_transpo:_0x24510b,name_driver:_0x1db8bd,pull_out_date:_0x59671b,actual_delivery_date:_0x321c2f}=_0x32f621[_0x4ff706(0x138)];_0x1adab5[_0x4ff706(0x27b)](_0x32f621[_0x4ff706(0x138)]);return;if(typeof _0x378cf2==_0x4ff706(0x18f))var _0x203987=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x137)]],_0x4865f8=[_0x32f621['body']['stock']],_0xe28df7=[_0x32f621[_0x4ff706(0x138)]['carton']],_0x541e43=[_0x32f621['body'][_0x4ff706(0x162)]],_0x3cae92=[_0x32f621[_0x4ff706(0x138)]['secondary_code']],_0x4f1818=[_0x32f621['body'][_0x4ff706(0x1d8)]],_0x118598=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x26e)]],_0x5b3bae=[_0x32f621['body'][_0x4ff706(0x183)]],_0x214ef6=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x178)]],_0x349b8f=[_0x32f621['body'][_0x4ff706(0x1ee)]],_0x38f93d=[_0x32f621[_0x4ff706(0x138)]['expiry_date']],_0x34745a=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x13e)]],_0x1f5a45=[_0x32f621['body']['max_per_unit']],_0x15dfe0=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x161)]],_0x119543=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x24f)]],_0x828b42=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x250)]],_0x41ca23=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x1ba)]],_0x1a2b12=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x16b)]],_0x377e8d=[_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x25b)]];else var _0x203987=[..._0x32f621[_0x4ff706(0x138)]['product_name']],_0x4865f8=[..._0x32f621[_0x4ff706(0x138)]['stock']],_0xe28df7=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x15e)]],_0x541e43=[..._0x32f621[_0x4ff706(0x138)]['primary_code']],_0x3cae92=[..._0x32f621['body'][_0x4ff706(0x19a)]],_0x4f1818=[..._0x32f621['body'][_0x4ff706(0x1d8)]],_0x118598=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x26e)]],_0x5b3bae=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x183)]],_0x214ef6=[..._0x32f621[_0x4ff706(0x138)]['secondary_unit']],_0x349b8f=[..._0x32f621['body'][_0x4ff706(0x1ee)]],_0x38f93d=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x241)]],_0x34745a=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x13e)]],_0x1f5a45=[..._0x32f621['body']['max_per_unit']],_0x15dfe0=[..._0x32f621['body'][_0x4ff706(0x161)]],_0x119543=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x24f)]],_0x828b42=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x250)]],_0x41ca23=[..._0x32f621[_0x4ff706(0x138)]['id_transaction_from']],_0x1a2b12=[..._0x32f621['body'][_0x4ff706(0x16b)]],_0x377e8d=[..._0x32f621[_0x4ff706(0x138)][_0x4ff706(0x25b)]];const _0x2733b6=_0x203987['map'](_0x1eb32c=>{return _0x1eb32c={'product_name':_0x1eb32c};});_0x4865f8[_0x4ff706(0x1db)]((_0x473863,_0x5c7432)=>{var _0x369bf2=_0x4ff706;_0x2733b6[_0x5c7432][_0x369bf2(0x22c)]=_0x473863;}),_0xe28df7[_0x4ff706(0x1db)]((_0x505383,_0x4c4a07)=>{var _0x4f35ec=_0x4ff706;_0x2733b6[_0x4c4a07][_0x4f35ec(0x163)]=Math['abs'](_0x505383);}),_0x203987['forEach']((_0x8ce297,_0x4947cc)=>{var _0x3a27c0=_0x4ff706;_0x2733b6[_0x4947cc]['agent_id']=_0x32f621[_0x3a27c0(0x138)][_0x3a27c0(0x1c5)];}),_0x377e8d[_0x4ff706(0x1db)]((_0x229053,_0x2dfdf8)=>{_0x2733b6[_0x2dfdf8]['gross_price']=_0x229053;}),_0x1a2b12['forEach']((_0x26589a,_0x238666)=>{var _0x12ae9e=_0x4ff706;_0x2733b6[_0x238666][_0x12ae9e(0x16b)]=_0x26589a;}),_0x41ca23[_0x4ff706(0x1db)]((_0x32f763,_0x4b5c43)=>{var _0x1c0963=_0x4ff706;_0x2733b6[_0x4b5c43][_0x1c0963(0x1ba)]=_0x32f763;}),_0x541e43['forEach']((_0x5b1e2d,_0x3dd394)=>{var _0x7a8979=_0x4ff706;_0x2733b6[_0x3dd394][_0x7a8979(0x162)]=_0x5b1e2d;}),_0x3cae92[_0x4ff706(0x1db)]((_0x441622,_0x31a6e8)=>{var _0x54fcac=_0x4ff706;_0x2733b6[_0x31a6e8][_0x54fcac(0x19a)]=_0x441622;}),_0x4f1818[_0x4ff706(0x1db)]((_0xad7251,_0x198903)=>{var _0x58b828=_0x4ff706;_0x2733b6[_0x198903][_0x58b828(0x1e9)]=_0xad7251;}),_0x118598[_0x4ff706(0x1db)]((_0x83f15a,_0x4455ea)=>{var _0x28cbca=_0x4ff706,_0x374844=_0x83f15a[_0x28cbca(0x27d)](/[A-Za-z]+/)[0x0],_0x68733b=parseInt(_0x83f15a[_0x28cbca(0x27d)](/\d+/)[0x0]);_0x2733b6[_0x4455ea][_0x28cbca(0x1ad)]=_0x68733b,_0x2733b6[_0x4455ea]['level']=_0x374844;}),_0x5b3bae[_0x4ff706(0x1db)]((_0x185a2b,_0x1f21cd)=>{var _0x1df275=_0x4ff706;_0x2733b6[_0x1f21cd][_0x1df275(0x12b)]=_0x185a2b;}),_0x214ef6[_0x4ff706(0x1db)]((_0x586b95,_0x8109bb)=>{var _0x3f864b=_0x4ff706;_0x2733b6[_0x8109bb][_0x3f864b(0x178)]=_0x586b95;}),_0x349b8f[_0x4ff706(0x1db)]((_0x1b7b04,_0x2d69ae)=>{_0x2733b6[_0x2d69ae]['batch_code']=_0x1b7b04;}),_0x38f93d[_0x4ff706(0x1db)]((_0x21b824,_0x512b47)=>{_0x2733b6[_0x512b47]['expiry_date']=_0x21b824;}),_0x34745a[_0x4ff706(0x1db)]((_0x295d46,_0x1ec989)=>{var _0x39b123=_0x4ff706;_0x2733b6[_0x1ec989][_0x39b123(0x14d)]=_0x295d46;}),_0x1f5a45['forEach']((_0x359494,_0x467e4d)=>{var _0x2f458d=_0x4ff706;_0x2733b6[_0x467e4d][_0x2f458d(0x1d4)]=_0x359494;}),_0x15dfe0['forEach']((_0x3987f7,_0x1c9e73)=>{var _0x1b2f68=_0x4ff706;_0x2733b6[_0x1c9e73][_0x1b2f68(0x161)]=_0x3987f7;}),_0x119543[_0x4ff706(0x1db)]((_0x33eddc,_0x5a220d)=>{_0x2733b6[_0x5a220d]['room_name']=_0x33eddc;}),_0x828b42['forEach']((_0x100084,_0x17ca83)=>{var _0x2b6140=_0x4ff706;_0x2733b6[_0x17ca83]['invoice']=_0x100084,_0x2733b6[_0x17ca83][_0x2b6140(0x279)]=_0x402fae;});const _0x50f55a=new invoice_for_outgoing();await _0x50f55a[_0x4ff706(0x1f6)](),_0x828b42['forEach']((_0x6def71,_0x5b4307)=>{var _0x44db40=_0x4ff706;_0x2733b6[_0x5b4307][_0x44db40(0x1cf)]='OUT-'+_0x50f55a['invoice_init']['toString']()[_0x44db40(0x16e)](0x8,'0');});var _0x1e0407=0x0;_0x2733b6[_0x4ff706(0x1db)](_0x3e7ea1=>{var _0x45c86f=_0x4ff706;parseFloat(_0x3e7ea1[_0x45c86f(0x22c)])<parseFloat(_0x3e7ea1[_0x45c86f(0x163)])&&parseFloat(_0x3e7ea1[_0x45c86f(0x163)])>parseFloat(_0x3e7ea1[_0x45c86f(0x22c)])&&(console[_0x45c86f(0x22a)](_0x3e7ea1[_0x45c86f(0x22c)]+_0x45c86f(0x136)+_0x3e7ea1[_0x45c86f(0x163)]),_0x1e0407++);});if(_0x1e0407!=0x0)return _0x32f621['flash'](_0x4ff706(0x1da),_0x4ff706(0x151)),_0x1adab5[_0x4ff706(0x27a)]('back');const _0x4a4792=_0x2733b6[_0x4ff706(0x1bf)](_0x153fe2=>_0x153fe2[_0x4ff706(0x163)]!=='0'&&_0x153fe2[_0x4ff706(0x163)]!==''),_0x167d57=new sales_finished({'invoice':_0x4ff706(0x20f)+_0x50f55a[_0x4ff706(0x262)][_0x4ff706(0x168)]()[_0x4ff706(0x16e)](0x8,'0'),'sales_data':_0x32f621['body'][_0x4ff706(0x1c5)],'customer':_0x32f621[_0x4ff706(0x138)][_0x4ff706(0x20e)],'date':_0x402fae,'warehouse_name':_0x1e36f6,'sale_product':_0x4a4792,'note':_0x529a6a,'room':_0x5b51d1,'primary_code':_0xb9f55e,'secondary_code':_0x486d71,'prod_code':_0x5df2c7,'SCRN':_0x5e526b,'finalize':'False','mode_transpo':_0x24510b,'name_driver':_0x1db8bd,'ReqBy':_0x274e2,'dateofreq':_0xe82bef,'PO_number':_0x390495,'typeservicesData':_0x2eca08,'typevehicle':_0x13f553,'destination':_0xb5bc78,'deliverydate':_0x323668,'driver':_0x3a3a9e,'plate':_0x573230,'van':_0x35e9a5,'DRSI':_0x75d671,'TSU':_0x3b6261,'TFU':_0x5e2fb4,'pullout_date':_0x59671b,'actualdelivery_date':_0x321c2f,'typeOfProducts':_0x4ff706(0x13d)}),_0x45a519=await _0x167d57[_0x4ff706(0x1f6)](),_0x461c4b=await sales_finished['findOne']({'invoice':_0xc6e2f7});_0x32f621[_0x4ff706(0x147)](_0x4ff706(0x22d),_0x4ff706(0x1f5)),_0x1adab5[_0x4ff706(0x27a)](_0x4ff706(0x146)+_0x45a519[_0x4ff706(0x21e)]);}catch(_0x1ee0e1){console['log'](_0x1ee0e1);}}),router[a0_0x4fd025(0x18e)]('/preview/:id',auth,async(_0x19f24c,_0x386194)=>{var _0x10221c=a0_0x4fd025;try{const {username:_0x4dc646,email:_0x50bfd3,role:_0x141123}=_0x19f24c['user'],_0x5206d0=_0x19f24c['user'],_0x574d75=await profile[_0x10221c(0x232)]({'email':_0x5206d0[_0x10221c(0x1a0)]}),_0x5bf342=await master_shop['find'](),_0x42bfd7=_0x19f24c[_0x10221c(0x14e)]['id'],_0x52567a=await sales_finished[_0x10221c(0x1d1)](_0x42bfd7),_0x2ad064=await warehouse[_0x10221c(0x270)]([{'$match':{'name':_0x52567a[_0x10221c(0x234)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x10221c(0x157),'name':{'$first':_0x10221c(0x1dd)},'product_stock':{'$first':_0x10221c(0x212)},'bay':{'$first':_0x10221c(0x15d)},'bin':{'$first':_0x10221c(0x19f)},'type':{'$first':_0x10221c(0x27c)},'floorlevel':{'$first':_0x10221c(0x14b)},'primary_code':{'$first':_0x10221c(0x1b4)},'secondary_code':{'$first':_0x10221c(0x180)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x10221c(0x24b)},'rack':{'$first':_0x10221c(0x1e5)},'expiry_date':{'$first':_0x10221c(0x209)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x10221c(0x17a)},'room':{'$first':_0x10221c(0x19c)},'room_data':{'$first':_0x10221c(0x1ff)}}}]),_0x2dbb1a=await customer['find']({});let _0x37f632;if(_0x5206d0[_0x10221c(0x193)]==_0x10221c(0x224)){const _0x94a85d=await staff[_0x10221c(0x232)]({'email':_0x5206d0['email']});_0x37f632=await warehouse[_0x10221c(0x270)]([{'$match':{'status':_0x10221c(0x185),'name':_0x94a85d['warehouse']}},{'$group':{'_id':_0x10221c(0x24c),'name':{'$first':_0x10221c(0x24c)}}}]);}else _0x37f632=await warehouse[_0x10221c(0x270)]([{'$match':{'status':_0x10221c(0x185)}},{'$group':{'_id':_0x10221c(0x24c),'name':{'$first':_0x10221c(0x24c)}}}]);const _0x3ac887=await product[_0x10221c(0x271)]({});if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x176)){var _0x1226a6=users[_0x10221c(0x275)];console['log'](_0x1226a6);}else{if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x16c))var _0x1226a6=users['Hindi'];else{if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x1a2))var _0x1226a6=users[_0x10221c(0x1a2)];else{if(_0x5bf342[0x0][_0x10221c(0x252)]=='Spanish')var _0x1226a6=users[_0x10221c(0x20b)];else{if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x1fc))var _0x1226a6=users[_0x10221c(0x1fc)];else{if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x1bb))var _0x1226a6=users[_0x10221c(0x160)];else{if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x1f0))var _0x1226a6=users[_0x10221c(0x1f0)];else{if(_0x5bf342[0x0][_0x10221c(0x252)]==_0x10221c(0x1e1))var _0x1226a6=users[_0x10221c(0x141)];}}}}}}}_0x386194[_0x10221c(0x1a8)](_0x10221c(0x1f4),{'success':_0x19f24c['flash'](_0x10221c(0x22d)),'errors':_0x19f24c[_0x10221c(0x147)]('errors'),'role':_0x5206d0,'profile':_0x574d75,'customer':_0x2dbb1a,'warehouse':_0x37f632,'product':_0x2ad064,'user':_0x52567a,'master_shop':_0x5bf342,'unit':_0x3ac887,'language':_0x1226a6});}catch(_0x14c8a3){console['log'](_0x14c8a3);}});function a0_0x3e6d(){var _0x402f67=['$finalize','/give_payment/:id','RoomAssigned','prod_invoice','length','language','getDate','/upload/','<!DOCTYPE\x20html>','user','1086126lovUtN','status','product_details','min','gross_price','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','return_sale_QA','foreach\x20newproduct','3127470KVzNtX','outgoiug_inv','return_sale_finished','invoice_init','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','4751460bPGNRA','<hr\x20class=\x22my-3\x22>','maxProducts','54uEmxCc','13239657UUgtmb','return_qty','post','getFullYear','message','/barcode_scanner_logs','level2','suppliers','aggregate','find','master','maxStocks','roomNamed','English','<h5>','unit_QA','$customers_docs','date_data','redirect','json','$product_details.type','match','random','$secondary_unit','/view/add_sales','unit','171952SiDlpS','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','int','</div>','abs','OUTF-','product_name_QA1','$product_details','$product.product_name','image','\x20<>\x20','product_name','body','production_date_QA','warehouse_id_detl','then','Quality\x20Inspection','own','product_date','$sale_product','Types','Arabic','Sale\x20Return\x20Mail','$sale_product.quantity','sales_id','date_recieved','/all_sales_finished/preview/','flash','data_type','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.floorlevel','$_id','production_date','params','\x20&&\x20','False','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','sales_quantity','amount','$product_details.product_cat','There\x20is\x20','adjust_qty','$product_details._id','site_title','$product_details.uuid','<strong>\x20Regards\x20</strong>','second_unit','product_list','$product_details.bay','carton','$maxStocks','Portuguese','prod_cat','primary_code','quantity','warehouse','Finished\x20Goods','$product_details.product_code','$product_details.sales_category','toString','map','all_sales_finished','uuid','Hindi','$product_details.gross_price','padStart','$product','add_sales_finished','edit_sales_finished','<table\x20style=\x22width:\x20100%\x20!important;\x22>','back','undefined','Sales\x20Update\x20successfully','English\x20(US)','maxPerUnit_QA','secondary_unit','$product_details.production_date','$product_details.batch_code','max_per_unit','Return\x20Rooms','</span>','date','$date','$product_details.secondary_code','true','<tbody\x20style=\x22text-align:\x20center;\x22>','primary_unit','$gross_price','Enabled','$product_details.type_products','currency_placement','<tr>','\x20==\x20','$note','Received\x20Payment\x20For\x20Sale','password','createTransport','get','string','\x20Date:\x20','sales\x20item\x20return\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','role','/picking_list/pdf/','/view/add_sales_logs',',\x20room:\x20','Logo.png','3585380IqYVNY','ObjectId','secondary_code','$sale_product.type','$room','product','Sale\x20Return','$product_details.bin','email','\x20Name:\x20','German','concat','/view','Email\x20sent\x20successfully','Error\x20Occurs','5VNyZFd','render','$alertquantity','/../public','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','barcode\x20user_id','bay','</thead>','$sale_product.floorlevel','updateOne','push','\x20units\x20to\x20warehouse:\x20','level','$product_details.primary_code','</tr>','getMonth','final','</body></html>','add\x20post','id_transaction_from','Portuguese\x20(BR)','<div>','out','/view/:id','filter','product_stock','$product_details.level','</tbody>','<h5\x20style=\x22text-align:\x20left;\x22>','room_name','sales','</head><body>','$unit','$product_code','warehouse_id','nodemailer','LOG-OUT-','\x20Order\x20Number\x20:\x20','agent_id','product_id','outgoing_invoice','\x20</h2>','findById','sendMail','maxProducts_QA','maxperunit','$invoice','primary_code_QA','maxPerUnit','prod_code','/barcode_scanner_auto_data','errors','forEach','$product_details.invoice','$product_details.product_name','$secondary_code','/view/add_sale/product',',\x20Location:\x20','Arabic\x20(ae)','$return_data','/all_sales/view','finalize','$product_details.rack','here','../public/language/languages.json','50FxQttQ','product_code','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/view/add_sales/:id','slice','batch_code','True','Chinese','$product_details.unit','product_code_QA','$maxProdPerUnit','edit_sales_finished_view','Sales\x20Add\x20successfully','save','maxProdPerUnit','$sales_category','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20','<html><head><title></title>','</td>','French','$product_details.secondary_unit','valueOf','$product_details.room_name','sort','$warehouse_name','barcode\x20Product\x20master','exports','false','stock_data','sales_category','</table>','$customer','$product_details.expiry_date','<span\x20style=\x22float:\x20right;\x22>','Spanish','6360013hoPiVn','secondary_code_QA','customer','OUT-','date_received','logo','$product_details.product_stock','invoice','$sale_product.bin','/view/return_sales/:id','$primary_code','batch_code_QA','$product_details.date_recieved','mongoose','<h2>\x20','return_sale','stocks_QA','room','_id','product_cat','\x20Order\x20Date\x20:\x20','return_data','currency','secondary_unit_QA','staff','../models/all_models','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','received_amount','sale_qty','log','Ambient','stock','success','$brand','There\x27s\x20a\x20error\x20in\x20this\x20transaction','expiry_date_QA','name','findOne','sale_product','warehouse_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/preview/:id','purchases_data','customer_data','for_categorize','$sale_product.bay','Enclosed','/invoice/:id','/barcode_scanner_auto','$product_details.maxPerUnit','Return\x20Goods','/all_sales_finished/view','expiry_date','payment\x20successfull','catch','floor','logs','/barcode/:id','8fqlUTQ','split','$category','sales_quantity_QA','$product_details.storage','$name'];a0_0x3e6d=function(){return _0x402f67;};return a0_0x3e6d();}async function dataUpdate(_0x4246a1,_0x582f4f,_0x22a8f5){var _0x1bedfe=a0_0x4fd025;return await warehouse['updateOne']({'_id':_0x4246a1,'product_details._id':_0x582f4f},{'$set':{'product_details.$.product_stock':_0x22a8f5}}),await warehouse[_0x1bedfe(0x1d1)](_0x4246a1);}router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x236),auth,async(_0x400fbc,_0x19fc9b)=>{var _0x2f5f82=a0_0x4fd025;try{const _0x113ee4=_0x400fbc[_0x2f5f82(0x14e)]['id'],{invoice:_0x2097da,warehouse_name:_0x108b5a,room:_0x489814}=_0x400fbc[_0x2f5f82(0x138)],_0x37f17b=await sales_finished['findOne']({'invoice':_0x2097da});for(let _0x88e938=0x0;_0x88e938<=_0x37f17b[_0x2f5f82(0x233)][_0x2f5f82(0x251)]-0x1;_0x88e938++){const _0xc4c467=_0x37f17b[_0x2f5f82(0x233)][_0x88e938];var _0x4f8c67=await warehouse[_0x2f5f82(0x232)]({'name':_0x108b5a,'room':_0xc4c467[_0x2f5f82(0x1c4)]}),_0x2d3239=0x0;for(let _0x48a0b9=0x0;_0x48a0b9<=_0x4f8c67[_0x2f5f82(0x259)][_0x2f5f82(0x251)]-0x1;_0x48a0b9++){const _0x4e3d0f=_0x4f8c67['product_details'][_0x48a0b9];_0x4e3d0f['_id']==_0xc4c467[_0x2f5f82(0x1ba)]&&_0x4e3d0f[_0x2f5f82(0x16b)]==_0xc4c467[_0x2f5f82(0x16b)]&&(_0x2d3239=Math['max'](0x0,Math[_0x2f5f82(0x130)](_0x4e3d0f[_0x2f5f82(0x1c0)])-Math[_0x2f5f82(0x130)](_0xc4c467[_0x2f5f82(0x163)])),await warehouse[_0x2f5f82(0x1b0)]({'_id':_0x4f8c67[_0x2f5f82(0x21e)][_0x2f5f82(0x1fe)](),'product_details._id':_0x4e3d0f['_id']['valueOf'](),'product_details.uuid':_0xc4c467[_0x2f5f82(0x16b)]},{'$set':{'product_details.$.product_stock':_0x2d3239}}));}console['log'](typeof _0xc4c467[_0x2f5f82(0x1cd)]);if(typeof _0xc4c467[_0x2f5f82(0x1cd)]!==_0x2f5f82(0x174)){var _0x37cc15=await staff[_0x2f5f82(0x1d1)](_0xc4c467[_0x2f5f82(0x1cd)]);console[_0x2f5f82(0x22a)](_0x2f5f82(0x1e6));var _0x2d3cec=0x0;for(let _0x1c2239=0x0;_0x1c2239<=_0x37cc15['product_list'][_0x2f5f82(0x251)]-0x1;_0x1c2239++){const _0x514a00=_0x37cc15[_0x2f5f82(0x15c)][_0x1c2239];console[_0x2f5f82(0x22a)](_0xc4c467['id_transaction_from']+_0x2f5f82(0x189)+_0x514a00[_0x2f5f82(0x1c9)]+_0x2f5f82(0x14f)+_0xc4c467[_0x2f5f82(0x21e)]+_0x2f5f82(0x189)+_0xc4c467[_0x2f5f82(0x21e)]),_0xc4c467[_0x2f5f82(0x1ba)]==_0x514a00[_0x2f5f82(0x1c9)]&&_0xc4c467[_0x2f5f82(0x21e)]==0x1&&(_0x514a00[_0x2f5f82(0x1c0)]=Math[_0x2f5f82(0x130)](_0x514a00['product_stock'])+Math[_0x2f5f82(0x130)](_0xc4c467['quantity']),_0x2d3cec++);}console[_0x2f5f82(0x22a)](_0x2f5f82(0x12e),_0x2d3cec),_0x2d3cec=='0'&&(_0x37cc15['product_list']=_0x37cc15[_0x2f5f82(0x15c)][_0x2f5f82(0x1a3)]({'product_name':_0xc4c467[_0x2f5f82(0x137)],'product_stock':_0xc4c467[_0x2f5f82(0x163)],'bay':_0xc4c467[_0x2f5f82(0x1ad)],'level':_0xc4c467[_0x2f5f82(0x1b3)],'product_code':_0xc4c467[_0x2f5f82(0x1e9)],'primary_code':_0xc4c467[_0x2f5f82(0x162)],'secondary_code':_0xc4c467[_0x2f5f82(0x19a)],'expiry_date':_0xc4c467[_0x2f5f82(0x241)],'production_date':_0xc4c467['production_date'],'maxProducts':_0xc4c467[_0x2f5f82(0x266)],'batch_code':_0xc4c467[_0x2f5f82(0x1ee)],'secondary_unit':_0xc4c467[_0x2f5f82(0x178)],'unit':_0xc4c467[_0x2f5f82(0x12b)],'maxProducts':_0xc4c467[_0x2f5f82(0x266)],'maxPerUnit':_0xc4c467[_0x2f5f82(0x1d4)],'invoice':_0xc4c467[_0x2f5f82(0x213)],'warehouse_id':_0xc4c467[_0x2f5f82(0x1ba)],'id_incoming':_0xc4c467[_0x2f5f82(0x21e)],'uuid':_0xc4c467[_0x2f5f82(0x16b)],'gross_price':_0xc4c467[_0x2f5f82(0x25b)],'date_incoming':_0xc4c467[_0x2f5f82(0x279)],'outgoing_invoice':_0xc4c467[_0x2f5f82(0x1cf)]}),await _0x37cc15[_0x2f5f82(0x1f6)]());}}_0x37f17b[_0x2f5f82(0x1e4)]=_0x2f5f82(0x1ef);const _0x37869d=await _0x37f17b[_0x2f5f82(0x1f6)](),_0x4c1c00=await master_shop['find'](),_0x1c6497=await email_settings[_0x2f5f82(0x232)](),_0x1d1bc5=await supervisor_settings['find']();var _0x4f54ec=_0x37f17b['sale_product'],_0x202331='',_0x3a3b0f;for(_0x3a3b0f in _0x4f54ec){_0x202331+=_0x2f5f82(0x188)+_0x2f5f82(0x263)+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x137)]+_0x2f5f82(0x1fb)+_0x2f5f82(0x263)+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x1e9)]+_0x2f5f82(0x1fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x163)]+_0x2f5f82(0x1fb)+_0x2f5f82(0x263)+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x12b)]+'</td>'+_0x2f5f82(0x263)+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x178)]+'</td>'+_0x2f5f82(0x263)+_0x37f17b['warehouse_name']+_0x2f5f82(0x1fb)+_0x2f5f82(0x263)+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x1c4)]+_0x2f5f82(0x1fb)+_0x2f5f82(0x263)+_0x4f54ec[_0x3a3b0f][_0x2f5f82(0x1ad)]+_0x2f5f82(0x1fb);}_0x400fbc[_0x2f5f82(0x147)](_0x2f5f82(0x22d),_0x2f5f82(0x175)),_0x19fc9b[_0x2f5f82(0x27a)](_0x2f5f82(0x194)+_0x113ee4);}catch(_0x4a1bf7){console[_0x2f5f82(0x22a)](_0x4a1bf7);}}),router[a0_0x4fd025(0x18e)](a0_0x4fd025(0x1be),auth,async(_0x3124c5,_0xc88921)=>{var _0x5606f2=a0_0x4fd025;try{const {username:_0x46e4a7,email:_0x5c572f,role:_0x4d9f57}=_0x3124c5[_0x5606f2(0x256)],_0x24845b=_0x3124c5[_0x5606f2(0x256)],_0x32ea23=await profile[_0x5606f2(0x232)]({'email':_0x24845b[_0x5606f2(0x1a0)]}),_0x1d25b8=await master_shop[_0x5606f2(0x271)](),_0x187d45=_0x3124c5['params']['id'],_0x231f4d=await sales_finished['findById'](_0x187d45);let _0x308f7e=new Date(_0x231f4d[_0x5606f2(0x241)]),_0x3e83c1=('0'+_0x308f7e[_0x5606f2(0x253)]())[_0x5606f2(0x1ed)](-0x2),_0x515f66=('0'+(_0x308f7e[_0x5606f2(0x1b6)]()+0x1))['slice'](-0x2),_0x5c5bf3=_0x308f7e[_0x5606f2(0x26b)](),_0x87be81=_0x5c5bf3+'-'+_0x515f66+'-'+_0x3e83c1;var _0x256944=[_0x5606f2(0x22b),'Enclosed'];const _0xd1e835=await warehouse['aggregate']([{'$match':{'name':_0x231f4d[_0x5606f2(0x234)],'room':_0x231f4d['room']}},{'$unwind':_0x5606f2(0x133)},{'$group':{'_id':_0x5606f2(0x157),'name':{'$first':_0x5606f2(0x1dd)},'product_stock':{'$first':_0x5606f2(0x212)},'bay':{'$first':_0x5606f2(0x15d)},'bin':{'$first':_0x5606f2(0x19f)},'type':{'$first':_0x5606f2(0x27c)},'floorlevel':{'$first':_0x5606f2(0x14b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5606f2(0x166)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x254ed2=await customer[_0x5606f2(0x271)]({});let _0x270dc9;if(_0x24845b[_0x5606f2(0x193)]==_0x5606f2(0x224)){const _0x454c99=await staff[_0x5606f2(0x232)]({'email':_0x24845b[_0x5606f2(0x1a0)]});_0x270dc9=await warehouse[_0x5606f2(0x270)]([{'$match':{'status':_0x5606f2(0x185),'name':_0x454c99[_0x5606f2(0x164)]}},{'$group':{'_id':_0x5606f2(0x24c),'name':{'$first':'$name'}}}]);}else _0x270dc9=await warehouse[_0x5606f2(0x270)]([{'$match':{'status':_0x5606f2(0x185)}},{'$group':{'_id':_0x5606f2(0x24c),'name':{'$first':_0x5606f2(0x24c)}}}]);const _0x4bed1b=await product[_0x5606f2(0x271)]({});if(_0x1d25b8[0x0][_0x5606f2(0x252)]==_0x5606f2(0x176)){var _0x4e55fd=users[_0x5606f2(0x275)];console[_0x5606f2(0x22a)](_0x4e55fd);}else{if(_0x1d25b8[0x0][_0x5606f2(0x252)]=='Hindi')var _0x4e55fd=users[_0x5606f2(0x16c)];else{if(_0x1d25b8[0x0][_0x5606f2(0x252)]==_0x5606f2(0x1a2))var _0x4e55fd=users[_0x5606f2(0x1a2)];else{if(_0x1d25b8[0x0][_0x5606f2(0x252)]==_0x5606f2(0x20b))var _0x4e55fd=users['Spanish'];else{if(_0x1d25b8[0x0][_0x5606f2(0x252)]==_0x5606f2(0x1fc))var _0x4e55fd=users[_0x5606f2(0x1fc)];else{if(_0x1d25b8[0x0]['language']==_0x5606f2(0x1bb))var _0x4e55fd=users[_0x5606f2(0x160)];else{if(_0x1d25b8[0x0][_0x5606f2(0x252)]==_0x5606f2(0x1f0))var _0x4e55fd=users[_0x5606f2(0x1f0)];else{if(_0x1d25b8[0x0][_0x5606f2(0x252)]==_0x5606f2(0x1e1))var _0x4e55fd=users[_0x5606f2(0x141)];}}}}}}}_0xc88921[_0x5606f2(0x1a8)](_0x5606f2(0x171),{'success':_0x3124c5['flash'](_0x5606f2(0x22d)),'errors':_0x3124c5[_0x5606f2(0x147)](_0x5606f2(0x1da)),'role':_0x24845b,'profile':_0x32ea23,'customer':_0x254ed2,'warehouse':_0x270dc9,'product':_0xd1e835,'user':_0x231f4d,'master_shop':_0x1d25b8,'unit':_0x4bed1b,'language':_0x4e55fd,'rooms_data':_0x256944,'ed_fullDate':_0x87be81});}catch(_0x3ab444){console[_0x5606f2(0x22a)](_0x3ab444);}}),router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x1be),auth,async(_0x1bec4c,_0x80267d)=>{var _0x2836c0=a0_0x4fd025;try{const _0x3ed0b9=_0x1bec4c[_0x2836c0(0x14e)]['id'],_0x2aa23f=await sales_finished[_0x2836c0(0x232)]({'_id':_0x1bec4c[_0x2836c0(0x14e)]['id']}),_0x5a2c06=await warehouse['findOne']({'name':_0x2aa23f[_0x2836c0(0x234)],'room':_0x1bec4c['body'][_0x2836c0(0x21d)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x26b92a,customer:_0x489168,date:_0x19a22f,warehouse_name:_0x2c2f99,product_name:_0x391248,stock:_0x156f72,adjust_qty:_0x49295a,note:_0x17e54e,room:_0x5e9630,primary_code:_0x342b72,secondary_code:_0x2ab004,prod_code:_0x2f6650,level:_0x22bf10,isle:_0x521fcf,pallet:_0x18253e,expiry_date:_0x5d47fd}=_0x1bec4c['body'];if(typeof _0x391248==_0x2836c0(0x18f))var _0x208807=[_0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x137)]],_0x5257c1=[_0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x22c)]],_0x26bc47=[_0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x156)]],_0x18f069=[_0x1bec4c['body'][_0x2836c0(0x162)]],_0x2b0b90=[_0x1bec4c['body'][_0x2836c0(0x19a)]],_0x314f37=[_0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x1d8)]],_0x1b21f0=[_0x1bec4c['body'][_0x2836c0(0x1b3)]],_0x303aa4=[_0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x241)]];else var _0x208807=[..._0x1bec4c['body'][_0x2836c0(0x137)]],_0x5257c1=[..._0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x22c)]],_0x26bc47=[..._0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x156)]],_0x18f069=[..._0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x162)]],_0x2b0b90=[..._0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x19a)]],_0x314f37=[..._0x1bec4c[_0x2836c0(0x138)]['prod_code']],_0x1b21f0=[..._0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x1b3)]],_0x303aa4=[..._0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x241)]];const _0x18c817=_0x208807[_0x2836c0(0x169)](_0xa2d890=>{return _0xa2d890={'product_name':_0xa2d890};});_0x5257c1[_0x2836c0(0x1db)]((_0x5e764c,_0x545c85)=>{var _0x1d15ee=_0x2836c0;_0x18c817[_0x545c85][_0x1d15ee(0x22c)]=_0x5e764c;}),_0x26bc47['forEach']((_0xd8f7f2,_0x235789)=>{var _0x3ee979=_0x2836c0;_0x18c817[_0x235789][_0x3ee979(0x163)]=_0xd8f7f2;}),_0x18f069[_0x2836c0(0x1db)]((_0x35b453,_0x407c8a)=>{_0x18c817[_0x407c8a]['primary_code']=_0x35b453;}),_0x2b0b90[_0x2836c0(0x1db)]((_0xe4b2ff,_0x17da82)=>{_0x18c817[_0x17da82]['secondary_code']=_0xe4b2ff;}),_0x314f37[_0x2836c0(0x1db)]((_0x3325a0,_0x35b2a1)=>{var _0x1493a2=_0x2836c0;_0x18c817[_0x35b2a1][_0x1493a2(0x1e9)]=_0x3325a0;}),_0x1b21f0['forEach']((_0x567cd7,_0x31cbd6)=>{_0x18c817[_0x31cbd6]['level']=_0x567cd7;}),_0x303aa4[_0x2836c0(0x1db)]((_0x448d85,_0x247d8a)=>{var _0x1e596b=_0x2836c0;_0x18c817[_0x247d8a][_0x1e596b(0x241)]=_0x448d85;});var _0x3b2a31=0x0;_0x18c817['forEach'](_0x4cb141=>{var _0x257b19=_0x2836c0;console[_0x257b19(0x22a)](_0x257b19(0x25e),_0x4cb141),(parseInt(_0x4cb141['stock'])<parseInt(_0x4cb141['quantity'])||parseInt(_0x4cb141[_0x257b19(0x163)])==0x0)&&_0x3b2a31++;});if(_0x3b2a31!=0x0)return _0x1bec4c[_0x2836c0(0x147)](_0x2836c0(0x1da),_0x2836c0(0x235)),_0x80267d['redirect'](_0x2836c0(0x173));_0x2aa23f[_0x2836c0(0x233)][_0x2836c0(0x1db)](_0x3afeff=>{var _0x324a5c=_0x2836c0;const _0x8279b1=_0x5a2c06['product_details'][_0x324a5c(0x169)](_0x27e792=>{var _0x2ae46a=_0x324a5c;_0x27e792[_0x2ae46a(0x137)]==_0x3afeff['product_name']&&_0x27e792[_0x2ae46a(0x1ad)]==_0x3afeff['bay']&&(_0x27e792[_0x2ae46a(0x1c0)]=parseInt(_0x27e792[_0x2ae46a(0x1c0)])+parseInt(_0x3afeff[_0x2ae46a(0x163)]));});}),await _0x5a2c06['save']();const _0x3f55c3=_0x18c817['filter'](_0x350e6b=>_0x350e6b['quantity']!=='0'&&_0x350e6b['quantity']!=='');_0x2aa23f['invoice']=_0x26b92a,_0x2aa23f[_0x2836c0(0x20e)]=_0x489168,_0x2aa23f[_0x2836c0(0x17e)]=_0x19a22f,_0x2aa23f[_0x2836c0(0x234)]=_0x2c2f99,_0x2aa23f['sale_product']=_0x3f55c3,_0x2aa23f['note']=_0x17e54e,_0x2aa23f[_0x2836c0(0x21d)]=_0x5e9630;const _0x520e02=await _0x2aa23f[_0x2836c0(0x1f6)](),_0x68adbe=await sales_finished[_0x2836c0(0x232)]({'_id':_0x1bec4c[_0x2836c0(0x14e)]['id']}),_0x17535e=await warehouse[_0x2836c0(0x232)]({'name':_0x2c2f99,'room':_0x5e9630,'warehouse_category':_0x2836c0(0x165)});_0x68adbe[_0x2836c0(0x233)][_0x2836c0(0x1db)](_0x3019ec=>{var _0x2aefe8=_0x2836c0;const _0x1442cc=_0x17535e[_0x2aefe8(0x259)]['map'](_0x567dfe=>{var _0x48574e=_0x2aefe8;_0x567dfe[_0x48574e(0x137)]==_0x3019ec[_0x48574e(0x137)]&&_0x567dfe[_0x48574e(0x1ad)]==_0x3019ec[_0x48574e(0x1ad)]&&(_0x567dfe['product_stock']=parseInt(_0x567dfe[_0x48574e(0x1c0)])-parseInt(_0x3019ec[_0x48574e(0x163)]));});}),console[_0x2836c0(0x22a)](_0x2836c0(0x1b7),_0x17535e),await _0x17535e[_0x2836c0(0x1f6)]();const _0x51a3e9=await c_payment_data['findOne']({'invoice':_0x1bec4c[_0x2836c0(0x138)][_0x2836c0(0x213)]});_0x51a3e9[_0x2836c0(0x26f)]=_0x1bec4c[_0x2836c0(0x138)]['suppliers'],await _0x51a3e9[_0x2836c0(0x1f6)](),_0x1bec4c[_0x2836c0(0x147)](_0x2836c0(0x22d),_0x2836c0(0x175)),_0x80267d[_0x2836c0(0x27a)]('/all_sales_finished/view');}catch(_0x1db432){console[_0x2836c0(0x22a)](_0x1db432);}}),router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x24e),auth,async(_0x43ed64,_0x49177d)=>{var _0x4642d9=a0_0x4fd025;try{const _0x107188=_0x43ed64['params']['id'],{invoice:_0xa91d0f,customer:_0x1b5416,receivable_amount:_0x4c729a,received_amount:_0x4dbcde}=_0x43ed64['body'],_0x57914f=await sales[_0x4642d9(0x1d1)](_0x107188);console['log'](_0x57914f);var _0x14e7cd=_0x4c729a-_0x4dbcde;console[_0x4642d9(0x22a)](_0x4dbcde),_0x57914f[_0x4642d9(0x228)]=parseFloat(_0x4dbcde)+parseFloat(_0x57914f[_0x4642d9(0x228)]),_0x57914f['due_amount']=_0x14e7cd,console[_0x4642d9(0x22a)](_0x57914f);const _0x59a6a4=await _0x57914f[_0x4642d9(0x1f6)](),_0x4ec821=await c_payment_data[_0x4642d9(0x232)]({'invoice':_0xa91d0f});_0x4ec821[_0x4642d9(0x153)]=_0x14e7cd,await _0x4ec821[_0x4642d9(0x1f6)]();let _0x182c85=new Date(),_0x4c79cb=('0'+_0x182c85[_0x4642d9(0x253)]())[_0x4642d9(0x1ed)](-0x2),_0x40ff8f=('0'+(_0x182c85['getMonth']()+0x1))[_0x4642d9(0x1ed)](-0x2),_0x15b4b0=_0x182c85[_0x4642d9(0x26b)](),_0x530694=_0x15b4b0+'-'+_0x40ff8f+'-'+_0x4c79cb;const _0x7cf0b1=new customer_payment({'invoice':_0xa91d0f,'date':_0x15b4b0+'-'+_0x40ff8f+'-'+_0x4c79cb,'customer':_0x1b5416,'reason':_0x4642d9(0x18b),'amount':_0x4dbcde}),_0x1506b6=await _0x7cf0b1[_0x4642d9(0x1f6)]();_0x43ed64[_0x4642d9(0x147)](_0x4642d9(0x22d),_0x4642d9(0x242)),_0x49177d[_0x4642d9(0x27a)](_0x4642d9(0x1e3));}catch(_0x33ba1f){console['log'](_0x33ba1f);}}),router[a0_0x4fd025(0x18e)](a0_0x4fd025(0x23c),auth,async(_0x22cb9c,_0x39e30e)=>{var _0x1cff3b=a0_0x4fd025;try{const {username:_0x42401b,email:_0x311a24,role:_0x4d0311}=_0x22cb9c[_0x1cff3b(0x256)],_0x24eea1=_0x22cb9c[_0x1cff3b(0x256)],_0x3f95a5=await profile[_0x1cff3b(0x232)]({'email':_0x24eea1[_0x1cff3b(0x1a0)]}),_0x399d44=await master_shop[_0x1cff3b(0x271)]();console[_0x1cff3b(0x22a)]('master',_0x399d44);const _0x51ee16=_0x22cb9c[_0x1cff3b(0x14e)]['id'],_0x439548=await sales[_0x1cff3b(0x1d1)](_0x51ee16);console[_0x1cff3b(0x22a)](_0x439548);const _0x2bcf7a=await customer[_0x1cff3b(0x232)]({'name':_0x439548[_0x1cff3b(0x20e)]});console[_0x1cff3b(0x22a)](_0x2bcf7a);if(_0x399d44[0x0]['language']==_0x1cff3b(0x176)){var _0x358166=users[_0x1cff3b(0x275)];console[_0x1cff3b(0x22a)](_0x358166);}else{if(_0x399d44[0x0][_0x1cff3b(0x252)]==_0x1cff3b(0x16c))var _0x358166=users['Hindi'];else{if(_0x399d44[0x0][_0x1cff3b(0x252)]==_0x1cff3b(0x1a2))var _0x358166=users['German'];else{if(_0x399d44[0x0][_0x1cff3b(0x252)]=='Spanish')var _0x358166=users[_0x1cff3b(0x20b)];else{if(_0x399d44[0x0][_0x1cff3b(0x252)]=='French')var _0x358166=users['French'];else{if(_0x399d44[0x0][_0x1cff3b(0x252)]==_0x1cff3b(0x1bb))var _0x358166=users[_0x1cff3b(0x160)];else{if(_0x399d44[0x0][_0x1cff3b(0x252)]=='Chinese')var _0x358166=users[_0x1cff3b(0x1f0)];else{if(_0x399d44[0x0]['language']==_0x1cff3b(0x1e1))var _0x358166=users[_0x1cff3b(0x141)];}}}}}}}_0x39e30e[_0x1cff3b(0x1a8)]('sales_invoice',{'success':_0x22cb9c['flash'](_0x1cff3b(0x22d)),'errors':_0x22cb9c[_0x1cff3b(0x147)](_0x1cff3b(0x1da)),'role':_0x24eea1,'profile':_0x3f95a5,'master_shop':_0x399d44,'customers':_0x2bcf7a,'sales':_0x439548,'language':_0x358166});}catch(_0x4a6ad2){console['log'](_0x4a6ad2);}}),router['get'](a0_0x4fd025(0x215),auth,async(_0xbf7443,_0x305344)=>{var _0x1ecec7=a0_0x4fd025;try{const {username:_0x575330,email:_0x34237f,role:_0x11e81f}=_0xbf7443[_0x1ecec7(0x256)],_0x2c3256=_0xbf7443[_0x1ecec7(0x256)],_0x321a04=await profile[_0x1ecec7(0x232)]({'email':_0x2c3256['email']}),_0x40a020=await master_shop[_0x1ecec7(0x271)](),_0x570cdc=_0xbf7443[_0x1ecec7(0x14e)]['id'],_0x1e7a9e=await sales_finished[_0x1ecec7(0x1d1)](_0x570cdc),_0x16ae7a=await warehouse[_0x1ecec7(0x270)]([{'$match':{'name':_0x1e7a9e[_0x1ecec7(0x234)]}},{'$unwind':_0x1ecec7(0x133)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1ecec7(0x1dd)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1ecec7(0x19f)},'type':{'$first':_0x1ecec7(0x27c)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1ecec7(0x1b4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1ecec7(0x166)},'storage':{'$first':_0x1ecec7(0x24b)},'rack':{'$first':_0x1ecec7(0x1e5)},'expiry_date':{'$first':_0x1ecec7(0x209)},'production_date':{'$first':_0x1ecec7(0x179)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1ecec7(0x1fd)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x1ecec7(0x23e)}}}]),_0x3ed5c4=await product['find']({}),_0x5d3f35=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x1ecec7(0x165),'name':{'$ne':_0x1ecec7(0x23f),'$ne':_0x1ecec7(0x13c)}}},{'$group':{'_id':_0x1ecec7(0x24c),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x4a9d16=[_0x1ecec7(0x17c)];const _0x18dd5d=await warehouse[_0x1ecec7(0x270)]([{'$match':{'status':'Enabled','name':'Quality\x20Inspection'}},{'$group':{'_id':_0x1ecec7(0x24c),'name':{'$first':_0x1ecec7(0x24c)}}},{'$sort':{'name':0x1}}]);if(_0x40a020[0x0][_0x1ecec7(0x252)]==_0x1ecec7(0x176)){var _0x216166=users['English'];console[_0x1ecec7(0x22a)](_0x216166);}else{if(_0x40a020[0x0][_0x1ecec7(0x252)]==_0x1ecec7(0x16c))var _0x216166=users['Hindi'];else{if(_0x40a020[0x0][_0x1ecec7(0x252)]==_0x1ecec7(0x1a2))var _0x216166=users['German'];else{if(_0x40a020[0x0][_0x1ecec7(0x252)]==_0x1ecec7(0x20b))var _0x216166=users[_0x1ecec7(0x20b)];else{if(_0x40a020[0x0][_0x1ecec7(0x252)]==_0x1ecec7(0x1fc))var _0x216166=users[_0x1ecec7(0x1fc)];else{if(_0x40a020[0x0]['language']=='Portuguese\x20(BR)')var _0x216166=users['Portuguese'];else{if(_0x40a020[0x0][_0x1ecec7(0x252)]=='Chinese')var _0x216166=users['Chinese'];else{if(_0x40a020[0x0][_0x1ecec7(0x252)]=='Arabic\x20(ae)')var _0x216166=users[_0x1ecec7(0x141)];}}}}}}}_0x305344[_0x1ecec7(0x1a8)](_0x1ecec7(0x261),{'success':_0xbf7443[_0x1ecec7(0x147)](_0x1ecec7(0x22d)),'errors':_0xbf7443['flash'](_0x1ecec7(0x1da)),'role':_0x2c3256,'profile':_0x321a04,'user':_0x1e7a9e,'stock':_0x16ae7a,'master_shop':_0x40a020,'unit':_0x3ed5c4,'language':_0x216166,'warehouses':_0x5d3f35,'rooms':_0x4a9d16,'warehouse_QA':_0x18dd5d});}catch(_0x431662){console['log'](_0x431662),_0x305344[_0x1ecec7(0x258)](0xc8)[_0x1ecec7(0x27b)]({'message':_0x431662['message']});}}),router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x215),auth,async(_0x573def,_0x4fb00a)=>{var _0x4ea011=a0_0x4fd025;if(_0x573def[_0x4ea011(0x138)][_0x4ea011(0x239)]=='QA')try{const {invoice:_0x10fb98,date:_0x56ff44,warehouse_name:_0x2ff826,product_name:_0xc4c7dd,primary_code:_0xd4e35e,secondary_code:_0x48c258,product_code:_0xc5fbf8,sales_quantity:_0xdbbb8a,stocks:_0x7efe93,return_qty:_0x23f97b,Room_name:_0x26e32e,to_warehouse_name_QA:_0x27d017,to_Room_name_QA:_0x424c04,note:_0x289413,for_categorize:_0x27dc8a,product_name_QA1:_0x1d2b71}=_0x573def[_0x4ea011(0x138)];if(typeof _0x1d2b71=='string')var _0x2caf02=[_0x573def[_0x4ea011(0x138)]['product_name_QA1']],_0x5a0959=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x1d6)]],_0x7fda83=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20d)]],_0x376667=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x1f2)]],_0x212dba=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x24a)]],_0x1c0e46=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x21c)]],_0x2d69b8=[_0x573def['body']['return_qty_QA']],_0x4c8ff9=[_0x573def['body'][_0x4ea011(0x177)]],_0x3e2e06=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x1d3)]],_0x200dbe=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x217)]],_0x2019a9=[_0x573def[_0x4ea011(0x138)]['secondary_unit_QA']],_0x34fdaa=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x277)]],_0x24e96a=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x139)]],_0xdc9a2=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x230)]];else var _0x2caf02=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x132)]],_0x5a0959=[..._0x573def['body'][_0x4ea011(0x1d6)]],_0x7fda83=[..._0x573def[_0x4ea011(0x138)]['secondary_code_QA']],_0x376667=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x1f2)]],_0x212dba=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x24a)]],_0x1c0e46=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x21c)]],_0x2d69b8=[..._0x573def[_0x4ea011(0x138)]['return_qty_QA']],_0x4c8ff9=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x177)]],_0x3e2e06=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x1d3)]],_0x200dbe=[..._0x573def['body']['batch_code_QA']],_0x2019a9=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x223)]],_0x34fdaa=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x277)]],_0x24e96a=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x139)]],_0xdc9a2=[..._0x573def['body']['expiry_date_QA']];const _0x4f7c1a=_0x2caf02[_0x4ea011(0x169)](_0x191652=>{return _0x191652={'product_name':_0x191652};});_0x5a0959['forEach']((_0x55ea54,_0x7eee64)=>{var _0x45a68b=_0x4ea011;_0x4f7c1a[_0x7eee64][_0x45a68b(0x162)]=_0x55ea54;}),_0x7fda83[_0x4ea011(0x1db)]((_0x563a39,_0x3bf9ea)=>{_0x4f7c1a[_0x3bf9ea]['secondary_code']=_0x563a39;}),_0x376667[_0x4ea011(0x1db)]((_0x5b8c4d,_0x21f735)=>{var _0x5e20df=_0x4ea011;_0x4f7c1a[_0x21f735][_0x5e20df(0x1e9)]=_0x5b8c4d;}),_0x212dba['forEach']((_0x5176de,_0x24c266)=>{_0x4f7c1a[_0x24c266]['sale_qty']=_0x5176de;}),_0x1c0e46['forEach']((_0x52457d,_0x593a5)=>{var _0x4f3c65=_0x4ea011;_0x4f7c1a[_0x593a5][_0x4f3c65(0x22c)]=_0x52457d;}),_0x2d69b8[_0x4ea011(0x1db)]((_0x45f62c,_0x26913c)=>{var _0x16fd8b=_0x4ea011;_0x4f7c1a[_0x26913c][_0x16fd8b(0x269)]=_0x45f62c;}),_0x4c8ff9[_0x4ea011(0x1db)]((_0x1a5743,_0xdf64b3)=>{_0x4f7c1a[_0xdf64b3]['maxPerUnit']=_0x1a5743;}),_0x3e2e06[_0x4ea011(0x1db)]((_0x21bc93,_0x4b1998)=>{var _0x29c8fb=_0x4ea011;_0x4f7c1a[_0x4b1998][_0x29c8fb(0x266)]=_0x21bc93;}),_0x200dbe[_0x4ea011(0x1db)]((_0x25389e,_0x59d272)=>{var _0x2d248f=_0x4ea011;_0x4f7c1a[_0x59d272][_0x2d248f(0x1ee)]=_0x25389e;}),_0x2019a9[_0x4ea011(0x1db)]((_0x282d49,_0x18f8e4)=>{_0x4f7c1a[_0x18f8e4]['secondary_unit']=_0x282d49;}),_0x34fdaa[_0x4ea011(0x1db)]((_0x47ae3e,_0xfbf195)=>{var _0x5fd8d9=_0x4ea011;_0x4f7c1a[_0xfbf195][_0x5fd8d9(0x12b)]=_0x47ae3e;}),_0x24e96a[_0x4ea011(0x1db)]((_0x3a5c6b,_0xf46fcc)=>{var _0x2eff58=_0x4ea011;_0x4f7c1a[_0xf46fcc][_0x2eff58(0x14d)]=_0x3a5c6b;}),_0xdc9a2[_0x4ea011(0x1db)]((_0x86262e,_0x3b6532)=>{_0x4f7c1a[_0x3b6532]['expiry_date']=_0x86262e;});const _0x5b2230=await sales_finished[_0x4ea011(0x232)]({'invoice':_0x10fb98});_0x5b2230['return_data']=_0x4ea011(0x1ef);const _0x454d91=await _0x5b2230[_0x4ea011(0x1f6)](),_0x19d5fe=new sales_return_finished({'invoice':_0x10fb98,'customer':_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20e)],'date':_0x56ff44,'warehouse_name':_0x2ff826,'room':_0x26e32e,'ToWarehouse':_0x27d017,'ToRoom':_0x424c04,'return_sale_QA':_0x4f7c1a,'note':_0x289413,'warehouse_cat':_0x27dc8a}),_0x177f71=await _0x19d5fe['save'](),_0x2d5128=await sales_return_finished[_0x4ea011(0x232)]({'invoice':_0x10fb98}),_0x2625ae=await warehouse['findOne']({'name':_0x27d017,'room':_0x424c04});_0x2d5128[_0x4ea011(0x25d)][_0x4ea011(0x1db)](_0x144a7f=>{var _0x29e63b=_0x4ea011,_0x13cdb2=0x0;const _0x4a7532=_0x2625ae[_0x29e63b(0x259)][_0x29e63b(0x169)](_0xaf5186=>{var _0x20e86d=_0x29e63b;_0xaf5186[_0x20e86d(0x137)]==_0x144a7f[_0x20e86d(0x137)]&&_0xaf5186[_0x20e86d(0x241)]==_0x144a7f[_0x20e86d(0x241)]&&_0xaf5186[_0x20e86d(0x14d)]==_0x144a7f['production_date']&&_0xaf5186[_0x20e86d(0x1ee)]==_0x144a7f[_0x20e86d(0x1ee)]&&(_0xaf5186['product_stock']=parseInt(_0xaf5186['product_stock'])+parseInt(_0x144a7f[_0x20e86d(0x269)]),_0x13cdb2++);});_0x13cdb2=='0'&&(_0x2625ae[_0x29e63b(0x259)]=_0x2625ae[_0x29e63b(0x259)]['concat']({'product_name':_0x144a7f[_0x29e63b(0x137)],'product_stock':_0x144a7f[_0x29e63b(0x269)],'primary_code':_0x144a7f['primary_code'],'secondary_code':_0x144a7f['secondary_code'],'product_code':_0x144a7f[_0x29e63b(0x1e9)],'batch_code':_0x144a7f[_0x29e63b(0x1ee)],'maxPerUnit':_0x144a7f[_0x29e63b(0x1d7)],'production_date':_0x144a7f[_0x29e63b(0x14d)],'expiry_date':_0x144a7f[_0x29e63b(0x241)],'secondary_unit':_0x144a7f[_0x29e63b(0x178)],'unit':_0x144a7f[_0x29e63b(0x12b)],'maxProducts':_0x144a7f[_0x29e63b(0x266)],'bay':_0x144a7f[_0x29e63b(0x1ad)]}));}),await _0x2625ae[_0x4ea011(0x1f6)]();const _0x1226ab=new c_payment_data({'invoice':_0x10fb98,'customer':_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20e)],'reason':_0x4ea011(0x19e)});await _0x1226ab['save']();const _0xe5571f=await master_shop[_0x4ea011(0x271)](),_0x1c4ddd=await email_settings[_0x4ea011(0x232)](),_0x5a8944=await customer[_0x4ea011(0x232)]({'name':_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20e)]});_0xe5571f[0x0][_0x4ea011(0x187)]==0x1?(right_currency=_0xe5571f[0x0][_0x4ea011(0x222)],left_currency=''):(right_currency='',left_currency=_0xe5571f[0x0][_0x4ea011(0x222)]);var _0x41af71=_0x2caf02,_0x976b77=_0x2d69b8,_0x5293f1='',_0x85e4f6;for(_0x85e4f6 in _0x41af71){_0x5293f1+='<tr>'+_0x4ea011(0x263)+_0x41af71[_0x85e4f6]+'</td>'+_0x4ea011(0x263)+_0x976b77[_0x85e4f6]+_0x4ea011(0x1fb)+'</tr>';}console[_0x4ea011(0x22a)](_0x4ea011(0x15c),_0x5293f1);let _0x48201f=nodemailer[_0x4ea011(0x18d)]({'service':'gmail','auth':{'user':_0x1c4ddd[_0x4ea011(0x1a0)],'pass':_0x1c4ddd[_0x4ea011(0x18c)]}}),_0x356112={'from':_0x1c4ddd[_0x4ea011(0x1a0)],'to':_0x5a8944[_0x4ea011(0x1a0)],'subject':_0x4ea011(0x142),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4ea011(0x1aa)+_0x4ea011(0x254)+_0xe5571f[0x0][_0x4ea011(0x135)],'cid':_0x4ea011(0x211)}],'html':_0x4ea011(0x255)+_0x4ea011(0x1fa)+_0x4ea011(0x1c6)+_0x4ea011(0x1bc)+_0x4ea011(0x1ab)+_0x4ea011(0x1bc)+_0x4ea011(0x192)+_0x4ea011(0x12f)+_0x4ea011(0x1bc)+_0x4ea011(0x21a)+_0xe5571f[0x0][_0x4ea011(0x158)]+_0x4ea011(0x1d0)+_0x4ea011(0x12f)+_0x4ea011(0x12f)+'<hr\x20class=\x22my-3\x22>'+_0x4ea011(0x1bc)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4ea011(0x1cc)+_0x10fb98+'\x20'+_0x4ea011(0x20a)+_0x4ea011(0x220)+_0x56ff44+'\x20'+_0x4ea011(0x17d)+_0x4ea011(0x149)+_0x4ea011(0x12f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4ea011(0x226)+_0x4ea011(0x188)+_0x4ea011(0x25c)+_0x4ea011(0x14a)+_0x4ea011(0x227)+_0x4ea011(0x1eb)+_0x4ea011(0x1b5)+_0x4ea011(0x1ae)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5293f1+'\x20'+_0x4ea011(0x1c2)+_0x4ea011(0x207)+'<div>'+_0x4ea011(0x15a)+_0x4ea011(0x276)+_0xe5571f[0x0][_0x4ea011(0x158)]+'</h5>'+_0x4ea011(0x12f)+_0x4ea011(0x12f)+_0x4ea011(0x1b8)};_0x48201f[_0x4ea011(0x1d2)](_0x356112,function(_0x272f62,_0x91f09a){var _0x2083db=_0x4ea011;_0x272f62?(console[_0x2083db(0x22a)](_0x272f62),console[_0x2083db(0x22a)](_0x2083db(0x1a6))):console[_0x2083db(0x22a)](_0x2083db(0x1a5));}),_0x573def[_0x4ea011(0x147)]('success','sales\x20item\x20return\x20successfull'),_0x4fb00a[_0x4ea011(0x27a)]('/all_sales_finished/view');}catch(_0x3e7535){_0x4fb00a['status'](0xc8)[_0x4ea011(0x27b)]({'message1':_0x3e7535[_0x4ea011(0x26c)]});}else{if(_0x573def[_0x4ea011(0x138)]['for_categorize']=='GS')try{const {invoice:_0x554f86,date:_0x38c170,warehouse_name:_0x5acfe3,product_name:_0x15191b,primary_code:_0x535edd,secondary_code:_0x472694,product_code:_0x32d5eb,sales_quantity:_0x42d771,stocks:_0x542274,return_qty:_0x5a8604,Room_name:_0x5bbcf9,to_warehouse_name:_0x842da7,to_Room_name:_0x5df8d4,note:_0x5d2e9b,level:_0x87d628,isle:_0xdef430,pallet:_0x4df09b,for_categorize:_0x59ef00}=_0x573def[_0x4ea011(0x138)];if(typeof _0x15191b==_0x4ea011(0x18f))var _0x2caf02=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x137)]],_0x5a0959=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x162)]],_0x7fda83=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x19a)]],_0x376667=[_0x573def['body'][_0x4ea011(0x1e9)]],_0x212dba=[_0x573def[_0x4ea011(0x138)][_0x4ea011(0x152)]],_0x2d69b8=[_0x573def['body']['return_qty']],_0x2da27d=[_0x573def['body']['bay']],_0x4c8ff9=[_0x573def[_0x4ea011(0x138)]['maxPerUnit']],_0x3e2e06=[_0x573def['body'][_0x4ea011(0x266)]],_0x200dbe=[_0x573def['body'][_0x4ea011(0x1ee)]],_0x2019a9=[_0x573def['body'][_0x4ea011(0x178)]],_0x34fdaa=[_0x573def['body'][_0x4ea011(0x12b)]],_0x24e96a=[_0x573def['body'][_0x4ea011(0x14d)]],_0xdc9a2=[_0x573def['body'][_0x4ea011(0x241)]];else var _0x2caf02=[..._0x573def[_0x4ea011(0x138)]['product_name']],_0x5a0959=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x162)]],_0x7fda83=[..._0x573def['body']['secondary_code']],_0x376667=[..._0x573def[_0x4ea011(0x138)]['product_code']],_0x212dba=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x152)]],_0x2d69b8=[..._0x573def[_0x4ea011(0x138)]['return_qty']],_0x2da27d=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x1ad)]],_0x4c8ff9=[..._0x573def[_0x4ea011(0x138)]['maxPerUnit']],_0x3e2e06=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x266)]],_0x200dbe=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x1ee)]],_0x2019a9=[..._0x573def['body']['secondary_unit']],_0x34fdaa=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x12b)]],_0x24e96a=[..._0x573def['body'][_0x4ea011(0x14d)]],_0xdc9a2=[..._0x573def[_0x4ea011(0x138)][_0x4ea011(0x241)]];const _0x3387e2=_0x2caf02[_0x4ea011(0x169)](_0x42790c=>{return _0x42790c={'product_name':_0x42790c};});_0x5a0959[_0x4ea011(0x1db)]((_0x2e96f4,_0x48d864)=>{var _0x2f1d9b=_0x4ea011;_0x3387e2[_0x48d864][_0x2f1d9b(0x162)]=_0x2e96f4;}),_0x7fda83[_0x4ea011(0x1db)]((_0x95ee08,_0x3dd65e)=>{var _0x4b5ea8=_0x4ea011;_0x3387e2[_0x3dd65e][_0x4b5ea8(0x19a)]=_0x95ee08;}),_0x376667[_0x4ea011(0x1db)]((_0xc34221,_0x2af451)=>{_0x3387e2[_0x2af451]['product_code']=_0xc34221;}),_0x212dba[_0x4ea011(0x1db)]((_0x1269bf,_0xec2833)=>{var _0x11b45b=_0x4ea011;_0x3387e2[_0xec2833][_0x11b45b(0x229)]=_0x1269bf;}),_0x2d69b8[_0x4ea011(0x1db)]((_0x27d119,_0x256365)=>{_0x3387e2[_0x256365]['return_qty']=_0x27d119;}),_0x2da27d[_0x4ea011(0x1db)]((_0x192a87,_0x21dc09)=>{_0x3387e2[_0x21dc09]['bay']=_0x192a87;}),_0x4c8ff9[_0x4ea011(0x1db)]((_0x347c5c,_0x310e99)=>{_0x3387e2[_0x310e99]['maxPerUnit']=_0x347c5c;}),_0x3e2e06['forEach']((_0x471f7e,_0x4fd16d)=>{var _0x21378e=_0x4ea011;_0x3387e2[_0x4fd16d][_0x21378e(0x266)]=_0x471f7e;}),_0x200dbe[_0x4ea011(0x1db)]((_0x390dde,_0xf14f54)=>{var _0xfde75a=_0x4ea011;_0x3387e2[_0xf14f54][_0xfde75a(0x1ee)]=_0x390dde;}),_0x2019a9[_0x4ea011(0x1db)]((_0x5bbc31,_0x1d6f26)=>{var _0x5c829=_0x4ea011;_0x3387e2[_0x1d6f26][_0x5c829(0x178)]=_0x5bbc31;}),_0x34fdaa[_0x4ea011(0x1db)]((_0x2c26b7,_0x2ceb06)=>{var _0x1688d5=_0x4ea011;_0x3387e2[_0x2ceb06][_0x1688d5(0x12b)]=_0x2c26b7;}),_0x24e96a['forEach']((_0x403a3f,_0x4cb3fc)=>{var _0x314a9a=_0x4ea011;_0x3387e2[_0x4cb3fc][_0x314a9a(0x14d)]=_0x403a3f;}),_0xdc9a2[_0x4ea011(0x1db)]((_0x2370a1,_0x5eed0d)=>{var _0x57f9ec=_0x4ea011;_0x3387e2[_0x5eed0d][_0x57f9ec(0x241)]=_0x2370a1;});var _0x2a0c39=0x0;_0x3387e2[_0x4ea011(0x1db)](_0x5c1d3f=>{var _0x1103b9=_0x4ea011;(parseInt(_0x5c1d3f[_0x1103b9(0x229)])<parseInt(_0x5c1d3f['return_qty'])||parseInt(_0x5c1d3f[_0x1103b9(0x22c)])<parseInt(_0x5c1d3f['return_qty'])&&parseInt(_0x5c1d3f[_0x1103b9(0x229)])>parseInt(_0x5c1d3f[_0x1103b9(0x269)])||parseInt(_0x5c1d3f['return_qty'])==0x0)&&_0x2a0c39++;});if(_0x2a0c39!=0x0)return _0x573def['flash'](_0x4ea011(0x1da),_0x4ea011(0x12d)),_0x4fb00a['redirect']('back');const _0x88d0e3=await sales_finished[_0x4ea011(0x232)]({'invoice':_0x554f86});_0x88d0e3[_0x4ea011(0x221)]=_0x4ea011(0x1ef);const _0x246c4=await _0x88d0e3[_0x4ea011(0x1f6)](),_0x1d0745=new sales_return_finished({'invoice':_0x554f86,'customer':_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20e)],'date':_0x38c170,'warehouse_name':_0x5acfe3,'room':_0x5bbcf9,'ToWarehouse':_0x842da7,'ToRoom':_0x5df8d4,'return_sale':_0x3387e2,'note':_0x5d2e9b,'warehouse_cat':_0x59ef00}),_0xf9347c=await _0x1d0745[_0x4ea011(0x1f6)](),_0x506cf2=await sales_return_finished[_0x4ea011(0x232)]({'invoice':_0x554f86}),_0x13f3dd=await warehouse['findOne']({'name':_0x842da7,'room':_0x5df8d4,'warehouse_category':_0x4ea011(0x165)});_0x506cf2[_0x4ea011(0x21b)][_0x4ea011(0x1db)](_0x480271=>{var _0x59825d=_0x4ea011,_0x52ad80=0x0;const _0x1b4be6=_0x13f3dd[_0x59825d(0x259)][_0x59825d(0x169)](_0x3961d1=>{var _0x530672=_0x59825d;_0x3961d1[_0x530672(0x137)]==_0x480271[_0x530672(0x137)]&&_0x3961d1['bay']==_0x480271['bay']&&_0x3961d1[_0x530672(0x241)]==_0x480271[_0x530672(0x241)]&&_0x3961d1[_0x530672(0x14d)]==_0x480271[_0x530672(0x14d)]&&_0x3961d1[_0x530672(0x1ee)]==_0x480271[_0x530672(0x1ee)]&&(_0x3961d1[_0x530672(0x1c0)]=parseInt(_0x3961d1[_0x530672(0x1c0)])+parseInt(_0x480271[_0x530672(0x269)]),_0x52ad80++);});_0x52ad80=='0'&&(_0x13f3dd[_0x59825d(0x259)]=_0x13f3dd[_0x59825d(0x259)][_0x59825d(0x1a3)]({'product_name':_0x480271['product_name'],'product_stock':_0x480271[_0x59825d(0x269)],'primary_code':_0x480271[_0x59825d(0x162)],'secondary_code':_0x480271[_0x59825d(0x19a)],'product_code':_0x480271[_0x59825d(0x1e9)],'bay':_0x480271[_0x59825d(0x1ad)],'batch_code':_0x480271[_0x59825d(0x1ee)],'maxPerUnit':_0x480271[_0x59825d(0x1d7)],'production_date':_0x480271[_0x59825d(0x14d)],'expiry_date':_0x480271[_0x59825d(0x241)],'secondary_unit':_0x480271['secondary_unit'],'unit':_0x480271['unit'],'maxProducts':_0x480271[_0x59825d(0x266)]}));}),await _0x13f3dd[_0x4ea011(0x1f6)](),console['log'](_0x573def[_0x4ea011(0x138)]);const _0x31f4ba=new c_payment_data({'invoice':_0x554f86,'customer':_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20e)],'reason':_0x4ea011(0x19e)});await _0x31f4ba[_0x4ea011(0x1f6)]();const _0x222d9f=await master_shop[_0x4ea011(0x271)]();console[_0x4ea011(0x22a)](_0x4ea011(0x1b9),_0x222d9f[0x0][_0x4ea011(0x135)]);const _0x5d3a4b=await email_settings[_0x4ea011(0x232)](),_0x57e286=await customer[_0x4ea011(0x232)]({'name':_0x573def[_0x4ea011(0x138)][_0x4ea011(0x20e)]});console[_0x4ea011(0x22a)](_0x4ea011(0x238),_0x57e286);_0x222d9f[0x0][_0x4ea011(0x187)]==0x1?(right_currency=_0x222d9f[0x0][_0x4ea011(0x222)],left_currency=''):(right_currency='',left_currency=_0x222d9f[0x0]['currency']);var _0x41af71=_0x2caf02,_0x976b77=_0x2d69b8,_0x5293f1='',_0x85e4f6;for(_0x85e4f6 in _0x41af71){_0x5293f1+=_0x4ea011(0x188)+_0x4ea011(0x263)+_0x41af71[_0x85e4f6]+'</td>'+_0x4ea011(0x263)+_0x976b77[_0x85e4f6]+_0x4ea011(0x1fb)+_0x4ea011(0x1b5);}console[_0x4ea011(0x22a)]('product_list',_0x5293f1);let _0x5896ea=nodemailer[_0x4ea011(0x18d)]({'service':'gmail','auth':{'user':_0x5d3a4b['email'],'pass':_0x5d3a4b[_0x4ea011(0x18c)]}}),_0x567f96={'from':_0x5d3a4b['email'],'to':_0x57e286[_0x4ea011(0x1a0)],'subject':_0x4ea011(0x142),'attachments':[{'filename':_0x4ea011(0x197),'path':__dirname+_0x4ea011(0x1aa)+'/upload/'+_0x222d9f[0x0][_0x4ea011(0x135)],'cid':'logo'}],'html':_0x4ea011(0x255)+_0x4ea011(0x1fa)+'</head><body>'+'<div>'+_0x4ea011(0x1ab)+_0x4ea011(0x1bc)+_0x4ea011(0x192)+_0x4ea011(0x12f)+'<div>'+'<h2>\x20'+_0x222d9f[0x0]['site_title']+'\x20</h2>'+_0x4ea011(0x12f)+_0x4ea011(0x12f)+_0x4ea011(0x265)+_0x4ea011(0x1bc)+_0x4ea011(0x1c3)+_0x4ea011(0x1cc)+_0x554f86+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4ea011(0x220)+_0x38c170+'\x20'+_0x4ea011(0x17d)+'</h5>'+_0x4ea011(0x12f)+_0x4ea011(0x172)+_0x4ea011(0x226)+_0x4ea011(0x188)+_0x4ea011(0x25c)+_0x4ea011(0x14a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4ea011(0x1b5)+'</thead>'+_0x4ea011(0x182)+'\x20'+_0x5293f1+'\x20'+_0x4ea011(0x1c2)+'</table>'+_0x4ea011(0x1bc)+_0x4ea011(0x15a)+_0x4ea011(0x276)+_0x222d9f[0x0]['site_title']+_0x4ea011(0x149)+_0x4ea011(0x12f)+'</div>'+_0x4ea011(0x1b8)};_0x5896ea[_0x4ea011(0x1d2)](_0x567f96,function(_0x195552,_0x1d9ae4){var _0x1b906d=_0x4ea011;_0x195552?(console[_0x1b906d(0x22a)](_0x195552),console[_0x1b906d(0x22a)](_0x1b906d(0x1a6))):console[_0x1b906d(0x22a)](_0x1b906d(0x1a5));}),_0x573def[_0x4ea011(0x147)](_0x4ea011(0x22d),_0x4ea011(0x191)),_0x4fb00a[_0x4ea011(0x27a)]('/all_sales_finished/view');}catch(_0x2706ba){console[_0x4ea011(0x22a)](_0x2706ba),_0x4fb00a[_0x4ea011(0x258)](0xc8)['json']({'message1':_0x2706ba[_0x4ea011(0x26c)]});}}}),router[a0_0x4fd025(0x18e)](a0_0x4fd025(0x246),auth,async(_0x511165,_0x3c0e7d)=>{var _0x4b66b9=a0_0x4fd025;try{const {username:_0x2c31b1,email:_0x3b476b,role:_0x279dcc}=_0x511165[_0x4b66b9(0x256)],_0x4901cf=_0x511165[_0x4b66b9(0x256)],_0x202212=await profile[_0x4b66b9(0x232)]({'email':_0x4901cf[_0x4b66b9(0x1a0)]}),_0x20de5c=await master_shop[_0x4b66b9(0x271)]();console[_0x4b66b9(0x22a)](_0x4b66b9(0x202),_0x20de5c);const _0x5eca18=_0x511165[_0x4b66b9(0x14e)]['id'],_0x1a52fe=await sales['findById'](_0x5eca18);console[_0x4b66b9(0x22a)](_0x4b66b9(0x1ac),_0x1a52fe);if(_0x20de5c[0x0][_0x4b66b9(0x252)]=='English\x20(US)')var _0x5bbc4f=users[_0x4b66b9(0x275)];else{if(_0x20de5c[0x0]['language']==_0x4b66b9(0x16c))var _0x5bbc4f=users[_0x4b66b9(0x16c)];else{if(_0x20de5c[0x0][_0x4b66b9(0x252)]==_0x4b66b9(0x1a2))var _0x5bbc4f=users[_0x4b66b9(0x1a2)];else{if(_0x20de5c[0x0][_0x4b66b9(0x252)]==_0x4b66b9(0x20b))var _0x5bbc4f=users[_0x4b66b9(0x20b)];else{if(_0x20de5c[0x0]['language']==_0x4b66b9(0x1fc))var _0x5bbc4f=users[_0x4b66b9(0x1fc)];else{if(_0x20de5c[0x0][_0x4b66b9(0x252)]==_0x4b66b9(0x1bb))var _0x5bbc4f=users[_0x4b66b9(0x160)];else{if(_0x20de5c[0x0][_0x4b66b9(0x252)]==_0x4b66b9(0x1f0))var _0x5bbc4f=users[_0x4b66b9(0x1f0)];else{if(_0x20de5c[0x0][_0x4b66b9(0x252)]==_0x4b66b9(0x1e1))var _0x5bbc4f=users[_0x4b66b9(0x141)];}}}}}}}_0x3c0e7d[_0x4b66b9(0x1a8)]('all_sales_barcode',{'success':_0x511165[_0x4b66b9(0x147)](_0x4b66b9(0x22d)),'errors':_0x511165[_0x4b66b9(0x147)]('errors'),'role':_0x4901cf,'profile':_0x202212,'alldata':_0x1a52fe,'master_shop':_0x20de5c,'language':_0x5bbc4f});}catch(_0x428b27){console[_0x4b66b9(0x22a)](_0x428b27);}}),router['post']('/barcode_scanner',async(_0x3ad520,_0x447563)=>{var _0x20fbea=a0_0x4fd025;const {product_code:_0x4d20e1,warehouse_name:_0x1e3b23,rooms_data:_0x553a5b,Roomslist:_0x5f39e2,sales_category:_0x1caaa9}=_0x3ad520[_0x20fbea(0x138)],_0x11c5b5=_0x5f39e2[_0x20fbea(0x248)](','),_0x2527af=[];async function _0xa1f177(_0x49139b){var _0x421a8a=_0x20fbea;const _0x6c07c=await warehouse[_0x421a8a(0x270)]([{'$match':{'name':_0x1e3b23,'room':_0x49139b}},{'$unwind':_0x421a8a(0x133)},{'$match':{'product_details.primary_code':_0x4d20e1}},{'$group':{'_id':_0x421a8a(0x157),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x421a8a(0x212)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x421a8a(0x180)},'product_code':{'$first':_0x421a8a(0x166)},'level':{'$first':_0x421a8a(0x1c1)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x421a8a(0x27c)},'pallet':{'$first':_0x421a8a(0x14b)},'unit':{'$first':_0x421a8a(0x1f1)},'secondary_unit':{'$first':_0x421a8a(0x1fd)},'storage':{'$first':_0x421a8a(0x24b)},'rack':{'$first':_0x421a8a(0x1e5)},'expiry_date':{'$first':_0x421a8a(0x209)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x421a8a(0x23e)},'batch_code':{'$first':_0x421a8a(0x17a)},'product_cat':{'$first':_0x421a8a(0x154)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x421a8a(0x19c)},'invoice':{'$first':_0x421a8a(0x1dc)},'uuid':{'$first':_0x421a8a(0x159)},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x421a8a(0x167)}}}]),_0x53b7a0=await warehouse[_0x421a8a(0x270)]([{'$match':{'name':_0x1e3b23,'room':_0x49139b}},{'$unwind':_0x421a8a(0x133)},{'$match':{'product_details.secondary_code':_0x4d20e1}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x421a8a(0x212)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x421a8a(0x166)},'level':{'$first':_0x421a8a(0x15d)},'isle':{'$first':_0x421a8a(0x19f)},'type':{'$first':_0x421a8a(0x27c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x421a8a(0x1f1)},'secondary_unit':{'$first':_0x421a8a(0x1fd)},'storage':{'$first':_0x421a8a(0x24b)},'rack':{'$first':_0x421a8a(0x1e5)},'expiry_date':{'$first':_0x421a8a(0x209)},'production_date':{'$first':_0x421a8a(0x179)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x421a8a(0x17a)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x421a8a(0x1dc)},'uuid':{'$first':_0x421a8a(0x159)},'gross_price':{'$first':_0x421a8a(0x16d)},'sales_category':{'$first':_0x421a8a(0x167)}}}]);if(_0x6c07c[_0x421a8a(0x251)]>0x0)_0x2527af['push'](_0x6c07c);else _0x53b7a0[_0x421a8a(0x251)]>0x0&&_0x2527af[_0x421a8a(0x1b1)](_0x53b7a0);}const _0xde5f75=_0x11c5b5[_0x20fbea(0x169)](_0x4e9e31=>_0xa1f177(_0x4e9e31));await Promise[_0x20fbea(0x1ea)](_0xde5f75),_0x447563['json'](_0x2527af);}),router[a0_0x4fd025(0x26a)](a0_0x4fd025(0x26d),async(_0x3a7a01,_0x380cbd)=>{var _0x231547=a0_0x4fd025;const {product_code:_0x5c07d4,warehouse_name:_0x144613,rooms_data:_0x4b80a5,Roomslist:_0x5aa774,sales_category:_0x42c767}=_0x3a7a01[_0x231547(0x138)],_0x42ac2c=_0x5aa774[_0x231547(0x248)](','),_0x1a14c2=[];async function _0x1af46b(_0x2ca354){var _0x8445af=_0x231547;const _0x557d8a=await warehouse[_0x8445af(0x270)]([{'$match':{'name':_0x144613,'room':_0x2ca354}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x5c07d4,'product_details.sales_category':_0x42c767,'product_details.type_products':'log'}},{'$group':{'_id':_0x8445af(0x157),'name':{'$first':_0x8445af(0x1dd)},'product_stock':{'$first':_0x8445af(0x212)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x8445af(0x180)},'product_code':{'$first':_0x8445af(0x166)},'level':{'$first':_0x8445af(0x1c1)},'bay':{'$first':_0x8445af(0x15d)},'type':{'$first':_0x8445af(0x27c)},'pallet':{'$first':_0x8445af(0x14b)},'unit':{'$first':_0x8445af(0x1f1)},'secondary_unit':{'$first':_0x8445af(0x1fd)},'storage':{'$first':_0x8445af(0x24b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x8445af(0x209)},'production_date':{'$first':_0x8445af(0x179)},'maxPerUnit':{'$first':_0x8445af(0x23e)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x8445af(0x154)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x8445af(0x19c)},'invoice':{'$first':_0x8445af(0x1dc)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x8445af(0x167)},'type_products':{'$first':_0x8445af(0x186)}}}]);console[_0x8445af(0x22a)](_0x8445af(0x22a)+_0x8445af(0x136)+_0x5c07d4+_0x8445af(0x136)+_0x42c767);const _0x145c7c=await warehouse['aggregate']([{'$match':{'name':_0x144613,'room':_0x2ca354}},{'$unwind':_0x8445af(0x133)},{'$match':{'product_details.secondary_code':_0x5c07d4,'product_details.sales_category':_0x42c767,'product_details.type_products':'log'}},{'$group':{'_id':_0x8445af(0x157),'name':{'$first':_0x8445af(0x1dd)},'product_stock':{'$first':_0x8445af(0x212)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x8445af(0x166)},'level':{'$first':_0x8445af(0x15d)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x8445af(0x27c)},'pallet':{'$first':_0x8445af(0x14b)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x8445af(0x1fd)},'storage':{'$first':_0x8445af(0x24b)},'rack':{'$first':_0x8445af(0x1e5)},'expiry_date':{'$first':_0x8445af(0x209)},'production_date':{'$first':_0x8445af(0x179)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x8445af(0x17a)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x8445af(0x1dc)},'uuid':{'$first':_0x8445af(0x159)},'gross_price':{'$first':_0x8445af(0x16d)},'sales_category':{'$first':'$product_details.sales_category'},'type_products':{'$first':_0x8445af(0x186)}}}]);if(_0x557d8a[_0x8445af(0x251)]>0x0)_0x1a14c2['push'](_0x557d8a);else _0x145c7c[_0x8445af(0x251)]>0x0&&_0x1a14c2[_0x8445af(0x1b1)](_0x145c7c);}const _0x44061c=_0x42ac2c[_0x231547(0x169)](_0x46e128=>_0x1af46b(_0x46e128));await Promise[_0x231547(0x1ea)](_0x44061c),_0x380cbd[_0x231547(0x27b)](_0x1a14c2);}),router['post'](a0_0x4fd025(0x1d9),async(_0x22fdf9,_0xb2c041)=>{var _0xf4231b=a0_0x4fd025;try{const {prduct_code:_0x2c8e93,warehouse_data:_0x2bcf9e,qty_req:_0xe09eac}=_0x22fdf9[_0xf4231b(0x138)];let _0x44b0a4=_0x2c8e93[_0xf4231b(0x248)]('~'),_0x2ba4c2=_0xe09eac['split']('~'),_0x3553bc=[],_0x43640a=0x0;for(let _0x5dc94c=0x0;_0x5dc94c<=_0x44b0a4[_0xf4231b(0x251)]-0x1;_0x5dc94c++){const _0x8cec3e=_0x44b0a4[_0x5dc94c],_0x2cc6d2=_0x2ba4c2[_0x5dc94c],_0x23264b=await warehouse[_0xf4231b(0x270)]([{'$match':{'name':_0x2bcf9e}},{'$unwind':_0xf4231b(0x133)},{'$match':{'product_details.product_code':_0x8cec3e,'product_details.isAvailable':_0xf4231b(0x181),'product_details.isUsed':_0xf4231b(0x204)}},{'$sort':{'product_details.date_received':0x1,'product_details.level':-0x1,'product_details.bay':-0x1}},{'$group':{'_id':_0xf4231b(0x157),'name':{'$first':_0xf4231b(0x1dd)},'product_stock':{'$first':_0xf4231b(0x212)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xf4231b(0x180)},'product_code':{'$first':_0xf4231b(0x166)},'level':{'$first':_0xf4231b(0x1c1)},'bay':{'$first':_0xf4231b(0x15d)},'type':{'$first':_0xf4231b(0x27c)},'pallet':{'$first':_0xf4231b(0x14b)},'unit':{'$first':_0xf4231b(0x1f1)},'secondary_unit':{'$first':_0xf4231b(0x1fd)},'storage':{'$first':_0xf4231b(0x24b)},'rack':{'$first':_0xf4231b(0x1e5)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xf4231b(0x179)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0xf4231b(0x17a)},'product_cat':{'$first':_0xf4231b(0x154)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xf4231b(0x19c)},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0xf4231b(0x159)},'gross_price':{'$first':_0xf4231b(0x16d)},'sales_category':{'$first':_0xf4231b(0x167)},'date_received':{'$first':_0xf4231b(0x218)},'warehouse_id':{'$first':'$_id'}}}]),_0x386508=_0x23264b[_0xf4231b(0x200)]((_0x3ed84b,_0xd2e110)=>new Date(_0x3ed84b[_0xf4231b(0x210)])-new Date(_0xd2e110['date_received']));let _0x544df7=_0x2cc6d2;for(let _0x1cd259=0x0;_0x1cd259<=_0x386508['length']-0x1&&_0x544df7>0x0;_0x1cd259++){const _0xf8e563=_0x386508[_0x1cd259];if(_0xf8e563['product_code']==_0x8cec3e){_0x3553bc[_0x43640a]={};const _0x196100=parseInt(_0xf8e563[_0xf4231b(0x1c0)]),_0x358c3b=0x0;let _0x292860=_0x196100-_0x358c3b,_0x1115e1=Math[_0xf4231b(0x25a)](_0x544df7,_0x292860);console['log']('Distributing\x20'+_0x1115e1+_0xf4231b(0x1b2)+_0x2bcf9e+_0xf4231b(0x196)+_0xf8e563[_0xf4231b(0x274)]+_0xf4231b(0x1e0)+(_0xf8e563[_0xf4231b(0x1b3)]+_0xf8e563['bay'])+_0xf4231b(0x190)+_0xf8e563[_0xf4231b(0x210)]+_0xf4231b(0x1a1)+_0xf8e563[_0xf4231b(0x231)]),_0x3553bc[_0x43640a]['group_ids']=_0xf8e563['warehouse_id']+'~'+_0xf8e563[_0xf4231b(0x21e)]+'~'+_0x1115e1,_0x3553bc[_0x43640a][_0xf4231b(0x137)]=_0xf8e563[_0xf4231b(0x231)],_0x3553bc[_0x43640a][_0xf4231b(0x1e9)]=_0xf8e563[_0xf4231b(0x1e9)],_0x3553bc[_0x43640a][_0xf4231b(0x1ce)]=_0xf8e563[_0xf4231b(0x1ce)],_0x3553bc[_0x43640a]['date_recieved']=_0xf8e563[_0xf4231b(0x145)],_0x3553bc[_0x43640a][_0xf4231b(0x206)]=_0xf8e563['sales_category'],_0x3553bc[_0x43640a]['uuid']=_0xf8e563['uuid'],_0x3553bc[_0x43640a][_0xf4231b(0x163)]=_0x1115e1,_0x3553bc[_0x43640a][_0xf4231b(0x12b)]=_0xf8e563[_0xf4231b(0x12b)],_0x3553bc[_0x43640a][_0xf4231b(0x178)]=_0xf8e563[_0xf4231b(0x178)],_0x3553bc[_0x43640a][_0xf4231b(0x162)]=_0xf8e563[_0xf4231b(0x162)],_0x3553bc[_0x43640a][_0xf4231b(0x19a)]=_0xf8e563['secondary_code'],_0x3553bc[_0x43640a]['maxStocks']=_0xf8e563[_0xf4231b(0x273)],_0x3553bc[_0x43640a]['batch_code']=_0xf8e563[_0xf4231b(0x1ee)],_0x3553bc[_0x43640a]['expiry_date']=_0xf8e563['expiry_date'],_0x3553bc[_0x43640a][_0xf4231b(0x14d)]=_0xf8e563['production_date'],_0x3553bc[_0x43640a][_0xf4231b(0x1d4)]=_0xf8e563[_0xf4231b(0x1d4)],_0x3553bc[_0x43640a]['product_cat']=_0xf8e563[_0xf4231b(0x21f)],_0x3553bc[_0x43640a][_0xf4231b(0x213)]=_0xf8e563[_0xf4231b(0x213)],_0x3553bc[_0x43640a][_0xf4231b(0x25b)]=_0xf8e563['gross_price'],_0x3553bc[_0x43640a][_0xf4231b(0x1c4)]=_0xf8e563['roomNamed'],_0x3553bc[_0x43640a][_0xf4231b(0x1b3)]=_0xf8e563['level'],_0x3553bc[_0x43640a][_0xf4231b(0x1ad)]=_0xf8e563[_0xf4231b(0x1ad)],_0x3553bc[_0x43640a][_0xf4231b(0x258)]=_0xf4231b(0x181),console[_0xf4231b(0x22a)]('1',_0x43640a),_0x544df7-=_0x1115e1,_0x43640a++;if(_0x544df7<=0x0)break;}}if(_0x544df7>0x0){var _0x2936dc=await product['findOne']({'product_code':_0x8cec3e});console['log']('2',_0x43640a),_0x3553bc[_0x43640a]={},_0x3553bc[_0x43640a][_0xf4231b(0x137)]=_0x2936dc[_0xf4231b(0x231)],_0x3553bc[_0x43640a]['product_code']=_0x8cec3e,_0x3553bc[_0x43640a][_0xf4231b(0x1ce)]=_0x2936dc[_0xf4231b(0x21e)][_0xf4231b(0x1fe)](),_0x3553bc[_0x43640a][_0xf4231b(0x163)]=_0x544df7,_0x3553bc[_0x43640a]['standard_unit']=_0x2936dc[_0xf4231b(0x12b)],_0x3553bc[_0x43640a][_0xf4231b(0x178)]=_0x2936dc[_0xf4231b(0x15b)],_0x3553bc[_0x43640a][_0xf4231b(0x162)]=_0x2936dc['primary_code'],_0x3553bc[_0x43640a][_0xf4231b(0x19a)]=_0x2936dc['secondary_code'],_0x3553bc[_0x43640a]['maxStocks']=_0x2936dc[_0xf4231b(0x273)],_0x3553bc[_0x43640a]['maxperunit']=_0x2936dc[_0xf4231b(0x1f7)],_0x3553bc[_0x43640a]['gross_price']=_0x2936dc[_0xf4231b(0x25b)],_0x3553bc[_0x43640a]['status']='false',console[_0xf4231b(0x22a)](_0xf4231b(0x155)+_0x544df7+_0xf4231b(0x1f9)+_0x43640a+_0xf4231b(0x136)+_0x8cec3e),_0x43640a++;}}_0xb2c041['json'](_0x3553bc);}catch(_0x42cb4a){console[_0xf4231b(0x22a)](_0x42cb4a);}}),router['post'](a0_0x4fd025(0x23d),async(_0xca6504,_0x404e8b)=>{var _0x1860a7=a0_0x4fd025;const {product_code:_0x1cbee8}=_0xca6504[_0x1860a7(0x138)];var _0x4a6c63;const _0xd9562f=await product[_0x1860a7(0x270)]([{'$match':{'primary_code':_0x1cbee8}},{'$group':{'_id':_0x1860a7(0x14c),'name':{'$first':_0x1860a7(0x24c)},'category':{'$first':_0x1860a7(0x249)},'brand':{'$first':_0x1860a7(0x22e)},'unit':{'$first':_0x1860a7(0x1c7)},'alertquantity':{'$first':_0x1860a7(0x1a9)},'product_code':{'$first':_0x1860a7(0x1c8)},'primary_code':{'$first':_0x1860a7(0x216)},'secondary_code':{'$first':_0x1860a7(0x1de)},'maxStocks':{'$first':_0x1860a7(0x15f)},'maxProdPerUnit':{'$first':_0x1860a7(0x1f3)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x1860a7(0x184)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x226bd3=await product[_0x1860a7(0x270)]([{'$match':{'secondary_code':_0x1cbee8}},{'$group':{'_id':_0x1860a7(0x14c),'name':{'$first':_0x1860a7(0x24c)},'category':{'$first':'$category'},'brand':{'$first':_0x1860a7(0x22e)},'unit':{'$first':_0x1860a7(0x1c7)},'alertquantity':{'$first':_0x1860a7(0x1a9)},'product_code':{'$first':_0x1860a7(0x1c8)},'primary_code':{'$first':_0x1860a7(0x216)},'secondary_code':{'$first':_0x1860a7(0x1de)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1860a7(0x1f3)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1860a7(0x27f)},'gross_price':{'$first':_0x1860a7(0x184)},'sales_category':{'$first':_0x1860a7(0x1f8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0xd9562f[_0x1860a7(0x251)]>0x0)_0x4a6c63=_0xd9562f;else _0x226bd3[_0x1860a7(0x251)]>0x0&&(_0x4a6c63=_0x226bd3);_0x404e8b[_0x1860a7(0x27b)](_0x4a6c63);}),router[a0_0x4fd025(0x26a)]('/process/view',async(_0x578c83,_0x4a2f17)=>{var _0x1f9858=a0_0x4fd025;try{const {group_id:_0x1c4514,DRSI:_0x48eab6,dateofreq:_0x5707f2,PO_number:_0x32a9bb,date:_0x1a92cc,warehouse_name:_0x436ca3,typevehicle:_0x4a1dda,deliverydate:_0xb6b364,driver:_0x222980,plate:_0x34dd6b,van:_0x44735a,TSU:_0x1bc9a7,actual_delivery_date:_0x2b9e90,TFU:_0x472d44,pull_out_date:_0x269d9b,sales:_0x2a7ef9,Customer_data:_0x39ce6c,note:_0x39927a}=_0x578c83[_0x1f9858(0x138)],_0x323fdc=mongoose[_0x1f9858(0x140)][_0x1f9858(0x199)];let _0x15363c=[];const _0x16e0a6=new invoice_for_outgoing();await _0x16e0a6[_0x1f9858(0x1f6)]();const _0x493e15=_0x1f9858(0x20f)+_0x16e0a6[_0x1f9858(0x262)][_0x1f9858(0x168)]()[_0x1f9858(0x16e)](0x8,'0');if(typeof _0x1c4514==_0x1f9858(0x18f)){let _0x1f0869=_0x1c4514[_0x1f9858(0x248)]('~');var _0x2b01de=_0x323fdc(_0x1f0869[0x0]),_0x15817e=_0x323fdc(_0x1f0869[0x1]),_0x27133c=_0x1f0869[0x2];let _0x568194=0x0;const _0x75c29e=await warehouse['aggregate']([{'$match':{'_id':_0x2b01de}},{'$unwind':'$product_details'},{'$match':{'product_details._id':_0x15817e}}]);await warehouse[_0x1f9858(0x1b0)]({'_id':_0x323fdc(_0x2b01de),'product_details._id':_0x323fdc(_0x15817e)},{'$set':{'product_details.$.isUsed':_0x1f9858(0x181)}}),_0x15363c[_0x568194]={};for(let _0x53fecc=0x0;_0x53fecc<=_0x75c29e[_0x1f9858(0x251)]-0x1;_0x53fecc++){const _0x24e0ca=_0x75c29e[_0x53fecc];console[_0x1f9858(0x22a)](_0x24e0ca),_0x15363c[_0x568194][_0x1f9858(0x164)]=_0x24e0ca['name'],_0x15363c[_0x568194]['product_id']=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x1ce)],_0x15363c[_0x568194][_0x1f9858(0x137)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x137)],_0x15363c[_0x568194][_0x1f9858(0x1e9)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x1e9)],_0x15363c[_0x568194][_0x1f9858(0x1c0)]=_0x27133c,_0x15363c[_0x568194][_0x1f9858(0x163)]=_0x27133c,_0x15363c[_0x568194][_0x1f9858(0x12b)]=_0x24e0ca[_0x1f9858(0x259)]['unit'],_0x15363c[_0x568194][_0x1f9858(0x178)]=_0x24e0ca[_0x1f9858(0x259)]['secondary_unit'],_0x15363c[_0x568194][_0x1f9858(0x1b3)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x1b3)],_0x15363c[_0x568194]['bay']=_0x24e0ca[_0x1f9858(0x259)]['bay'],_0x15363c[_0x568194][_0x1f9858(0x162)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x162)],_0x15363c[_0x568194][_0x1f9858(0x19a)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x19a)],_0x15363c[_0x568194][_0x1f9858(0x273)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x273)],_0x15363c[_0x568194][_0x1f9858(0x1ee)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x1ee)],_0x15363c[_0x568194][_0x1f9858(0x241)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x241)],_0x15363c[_0x568194]['production_date']=_0x24e0ca['product_details'][_0x1f9858(0x14d)],_0x15363c[_0x568194][_0x1f9858(0x1d4)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x1d4)],_0x15363c[_0x568194][_0x1f9858(0x21f)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x21f)],_0x15363c[_0x568194][_0x1f9858(0x1c4)]=_0x24e0ca[_0x1f9858(0x21d)],_0x15363c[_0x568194][_0x1f9858(0x213)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x213)],_0x15363c[_0x568194][_0x1f9858(0x16b)]=_0x24e0ca['product_details'][_0x1f9858(0x16b)],_0x15363c[_0x568194][_0x1f9858(0x25b)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x25b)],_0x15363c[_0x568194][_0x1f9858(0x206)]=_0x24e0ca[_0x1f9858(0x259)]['sales'],_0x15363c[_0x568194][_0x1f9858(0x145)]=_0x24e0ca[_0x1f9858(0x259)]['date_recieved'],_0x15363c[_0x568194][_0x1f9858(0x144)]=_0x24e0ca[_0x1f9858(0x259)][_0x1f9858(0x1c5)],_0x15363c[_0x568194][_0x1f9858(0x1c9)]=_0x24e0ca[_0x1f9858(0x21e)][_0x1f9858(0x1fe)](),_0x15363c[_0x568194][_0x1f9858(0x13a)]=_0x24e0ca['product_details'][_0x1f9858(0x21e)][_0x1f9858(0x1fe)](),_0x15363c[_0x568194][_0x1f9858(0x148)]=_0x1f9858(0x1bd),_0x15363c[_0x568194]['agent_id']=_0x24e0ca[_0x1f9858(0x259)]['sales'];}_0x15363c[_0x568194][_0x1f9858(0x260)]=_0x493e15;}else for(let _0x45f38f=0x0;_0x45f38f<=_0x1c4514[_0x1f9858(0x251)]-0x1;_0x45f38f++){const _0x40dea8=_0x1c4514[_0x45f38f];let _0x2fd3bd=_0x40dea8['split']('~');console[_0x1f9858(0x22a)](_0x2fd3bd);var _0x2b01de=_0x323fdc(_0x2fd3bd[0x0]),_0x15817e=_0x323fdc(_0x2fd3bd[0x1]),_0x27133c=_0x2fd3bd[0x2];const _0x585af0=await warehouse['aggregate']([{'$match':{'_id':_0x2b01de}},{'$unwind':_0x1f9858(0x133)},{'$match':{'product_details._id':_0x15817e}}]);await warehouse[_0x1f9858(0x1b0)]({'_id':_0x323fdc(_0x2b01de),'product_details._id':_0x323fdc(_0x15817e)},{'$set':{'product_details.$.isUsed':_0x1f9858(0x181)}}),_0x15363c[_0x45f38f]={};for(let _0x2380f9=0x0;_0x2380f9<=_0x585af0['length']-0x1;_0x2380f9++){const _0xb6eeb2=_0x585af0[_0x2380f9];_0x15363c[_0x45f38f][_0x1f9858(0x164)]=_0xb6eeb2[_0x1f9858(0x231)],_0x15363c[_0x45f38f][_0x1f9858(0x1ce)]=_0xb6eeb2['product_details'][_0x1f9858(0x1ce)],_0x15363c[_0x45f38f][_0x1f9858(0x137)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x137)],_0x15363c[_0x45f38f][_0x1f9858(0x1e9)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x1e9)],_0x15363c[_0x45f38f][_0x1f9858(0x1c0)]=_0x27133c,_0x15363c[_0x45f38f][_0x1f9858(0x163)]=_0x27133c,_0x15363c[_0x45f38f][_0x1f9858(0x12b)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x12b)],_0x15363c[_0x45f38f][_0x1f9858(0x178)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x178)],_0x15363c[_0x45f38f][_0x1f9858(0x1b3)]=_0xb6eeb2['product_details']['level'],_0x15363c[_0x45f38f][_0x1f9858(0x1ad)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x1ad)],_0x15363c[_0x45f38f]['primary_code']=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x162)],_0x15363c[_0x45f38f][_0x1f9858(0x19a)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x19a)],_0x15363c[_0x45f38f][_0x1f9858(0x273)]=_0xb6eeb2['product_details'][_0x1f9858(0x273)],_0x15363c[_0x45f38f]['batch_code']=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x1ee)],_0x15363c[_0x45f38f]['expiry_date']=_0xb6eeb2['product_details'][_0x1f9858(0x241)],_0x15363c[_0x45f38f][_0x1f9858(0x14d)]=_0xb6eeb2[_0x1f9858(0x259)]['production_date'],_0x15363c[_0x45f38f][_0x1f9858(0x1d4)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x1d4)],_0x15363c[_0x45f38f][_0x1f9858(0x21f)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x21f)],_0x15363c[_0x45f38f][_0x1f9858(0x1c4)]=_0xb6eeb2[_0x1f9858(0x21d)],_0x15363c[_0x45f38f]['invoice']=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x213)],_0x15363c[_0x45f38f][_0x1f9858(0x16b)]=_0xb6eeb2[_0x1f9858(0x259)]['uuid'],_0x15363c[_0x45f38f]['gross_price']=_0xb6eeb2['product_details'][_0x1f9858(0x25b)],_0x15363c[_0x45f38f][_0x1f9858(0x206)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x1c5)],_0x15363c[_0x45f38f][_0x1f9858(0x145)]=_0xb6eeb2[_0x1f9858(0x259)][_0x1f9858(0x145)],_0x15363c[_0x45f38f][_0x1f9858(0x144)]=_0xb6eeb2[_0x1f9858(0x259)]['sales'],_0x15363c[_0x45f38f][_0x1f9858(0x1c9)]=_0xb6eeb2[_0x1f9858(0x21e)]['valueOf'](),_0x15363c[_0x45f38f][_0x1f9858(0x13a)]=_0xb6eeb2['product_details'][_0x1f9858(0x21e)][_0x1f9858(0x1fe)](),_0x15363c[_0x45f38f][_0x1f9858(0x148)]='out',_0x15363c[_0x45f38f][_0x1f9858(0x1cd)]=_0xb6eeb2[_0x1f9858(0x259)]['sales'];}_0x15363c[_0x45f38f][_0x1f9858(0x260)]=_0x493e15;}for(let _0x3e55fe=0x0;_0x3e55fe<=_0x15363c[_0x1f9858(0x251)]-0x1;_0x3e55fe++){const _0x344038=_0x15363c[_0x3e55fe],_0x2a5c3d=new warehouse_temporary(_0x344038);await _0x2a5c3d[_0x1f9858(0x1f6)]();}const _0x2e4153=new sales_finished({'invoice':_0x493e15,'sales_data':_0x2a7ef9,'customer':_0x39ce6c,'date':_0x1a92cc,'warehouse_name':_0x436ca3,'sale_product':_0x15363c,'note':_0x39927a,'finalize':_0x1f9858(0x150),'dateofreq':_0x5707f2,'PO_number':_0x32a9bb,'typevehicle':_0x4a1dda,'deliverydate':_0xb6b364,'driver':_0x222980,'plate':_0x34dd6b,'van':_0x44735a,'DRSI':_0x48eab6,'TSU':_0x1bc9a7,'TFU':_0x472d44,'pullout_date':_0x269d9b,'actualdelivery_date':_0x2b9e90,'typeOfProducts':_0x1f9858(0x13d)}),_0x56d638=await _0x2e4153[_0x1f9858(0x1f6)]();_0x578c83['flash'](_0x1f9858(0x22d),_0x1f9858(0x1f5)),_0x4a2f17[_0x1f9858(0x27a)]('/all_sales_finished/preview/'+_0x56d638[_0x1f9858(0x21e)]);}catch(_0x3c91a6){console[_0x1f9858(0x22a)](_0x3c91a6);}}),module[a0_0x4fd025(0x203)]=router;