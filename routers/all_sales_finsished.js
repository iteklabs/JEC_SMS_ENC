var a0_0x4e7bd2=a0_0x30df;(function(_0x398417,_0x2113b1){var _0x37bb66=a0_0x30df,_0x124fee=_0x398417();while(!![]){try{var _0x1b55b4=parseInt(_0x37bb66(0x149))/0x1+-parseInt(_0x37bb66(0x123))/0x2*(-parseInt(_0x37bb66(0x1ae))/0x3)+parseInt(_0x37bb66(0xfa))/0x4*(-parseInt(_0x37bb66(0xfe))/0x5)+-parseInt(_0x37bb66(0x1d3))/0x6*(parseInt(_0x37bb66(0x1a9))/0x7)+-parseInt(_0x37bb66(0xf2))/0x8*(-parseInt(_0x37bb66(0xf1))/0x9)+-parseInt(_0x37bb66(0x12b))/0xa+parseInt(_0x37bb66(0x234))/0xb*(-parseInt(_0x37bb66(0x14c))/0xc);if(_0x1b55b4===_0x2113b1)break;else _0x124fee['push'](_0x124fee['shift']());}catch(_0xbf3c29){_0x124fee['push'](_0x124fee['shift']());}}}(a0_0x1bb7,0x7621e));const express=require('express'),app=express(),router=express[a0_0x4e7bd2(0xf6)](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require(a0_0x4e7bd2(0x1f0)),auth=require(a0_0x4e7bd2(0x12e)),nodemailer=require('nodemailer'),users=require('../public/language/languages.json'),mongoose=require(a0_0x4e7bd2(0xef));router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0x22a),auth,async(_0x590a89,_0x13c92a)=>{var _0x4f6773=a0_0x4e7bd2;try{const {username:_0x5ebc76,email:_0x5e8241,role:_0x181ae4}=_0x590a89[_0x4f6773(0x155)],_0xbff371=_0x590a89[_0x4f6773(0x155)],_0x4f0886=await profile[_0x4f6773(0x213)]({'email':_0xbff371[_0x4f6773(0x1ab)]}),_0x3b12e3=await master_shop[_0x4f6773(0x1d7)]();let _0x41a1ca;if(_0xbff371[_0x4f6773(0x1e5)]==_0x4f6773(0x11b)){const _0x404119=await staff[_0x4f6773(0x213)]({'email':_0xbff371[_0x4f6773(0x1ab)]});_0x41a1ca=await sales_finished[_0x4f6773(0x172)]([{'$match':{'typeOfProducts':_0x4f6773(0x109)}},{'$unwind':_0x4f6773(0x1ce)},{'$group':{'_id':_0x4f6773(0x12f),'invoice':{'$first':_0x4f6773(0x16f)},'customers':{'$first':_0x4f6773(0x138)},'date':{'$first':_0x4f6773(0x135)},'warehouse_name':{'$first':_0x4f6773(0x10e)},'sale_product':{'$push':_0x4f6773(0x1ce)},'note':{'$first':_0x4f6773(0x107)},'return_data':{'$first':_0x4f6773(0x14e)},'customers_docs':{'$first':_0x4f6773(0x117)},'total_saleproduct_quantity':{'$sum':_0x4f6773(0x1ed)},'level':{'$addToSet':_0x4f6773(0x1b8)},'isle':{'$addToSet':_0x4f6773(0x12d)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4f6773(0x22d)},'finalize':{'$first':_0x4f6773(0x224)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x41a1ca=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x4f6773(0x109)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4f6773(0x12f),'invoice':{'$first':_0x4f6773(0x16f)},'customers':{'$first':_0x4f6773(0x138)},'date':{'$first':_0x4f6773(0x135)},'warehouse_name':{'$first':_0x4f6773(0x10e)},'sale_product':{'$push':_0x4f6773(0x1ce)},'note':{'$first':_0x4f6773(0x107)},'return_data':{'$first':_0x4f6773(0x14e)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4f6773(0x1b8)},'isle':{'$addToSet':_0x4f6773(0x12d)},'type':{'$addToSet':_0x4f6773(0x21b)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x4f6773(0x224)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x3b12e3[0x0][_0x4f6773(0x177)]=='English\x20(US)'){var _0x16bb68=users['English'];console[_0x4f6773(0x1df)](_0x16bb68);}else{if(_0x3b12e3[0x0][_0x4f6773(0x177)]==_0x4f6773(0x17c))var _0x16bb68=users['Hindi'];else{if(_0x3b12e3[0x0][_0x4f6773(0x177)]==_0x4f6773(0x1cd))var _0x16bb68=users[_0x4f6773(0x1cd)];else{if(_0x3b12e3[0x0][_0x4f6773(0x177)]==_0x4f6773(0x20b))var _0x16bb68=users[_0x4f6773(0x20b)];else{if(_0x3b12e3[0x0][_0x4f6773(0x177)]=='French')var _0x16bb68=users[_0x4f6773(0x1eb)];else{if(_0x3b12e3[0x0][_0x4f6773(0x177)]=='Portuguese\x20(BR)')var _0x16bb68=users[_0x4f6773(0xee)];else{if(_0x3b12e3[0x0][_0x4f6773(0x177)]==_0x4f6773(0x1a0))var _0x16bb68=users[_0x4f6773(0x1a0)];else{if(_0x3b12e3[0x0]['language']==_0x4f6773(0x1fd))var _0x16bb68=users['Arabic'];}}}}}}}_0x13c92a[_0x4f6773(0x192)](_0x4f6773(0x201),{'success':_0x590a89[_0x4f6773(0x14b)]('success'),'errors':_0x590a89[_0x4f6773(0x14b)]('errors'),'sales':_0x41a1ca,'profile':_0x4f0886,'role':_0xbff371,'master_shop':_0x3b12e3,'language':_0x16bb68});}catch(_0x238208){console[_0x4f6773(0x1df)](_0x238208);}}),router['get'](a0_0x4e7bd2(0x204),auth,async(_0x10f124,_0x11e249)=>{var _0x45d951=a0_0x4e7bd2;try{const {username:_0x3b969b,email:_0x286e5f,role:_0x59a3ce}=_0x10f124['user'],_0x1301a4=_0x10f124[_0x45d951(0x155)],_0x56663c=await profile[_0x45d951(0x213)]({'email':_0x1301a4[_0x45d951(0x1ab)]}),_0x5a317e=await master_shop[_0x45d951(0x1d7)]();let _0x5195ef;if(_0x1301a4[_0x45d951(0x1e5)]=='staff'){const _0xc4e064=await staff[_0x45d951(0x213)]({'email':_0x1301a4['email']});_0x5195ef=await sales_finished[_0x45d951(0x172)]([{'$match':{'typeOfProducts':_0x45d951(0xea)}},{'$unwind':_0x45d951(0x1ce)},{'$group':{'_id':_0x45d951(0x12f),'invoice':{'$first':_0x45d951(0x16f)},'customers':{'$first':_0x45d951(0x138)},'date':{'$first':_0x45d951(0x135)},'warehouse_name':{'$first':_0x45d951(0x10e)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x45d951(0x107)},'return_data':{'$first':_0x45d951(0x14e)},'customers_docs':{'$first':_0x45d951(0x117)},'total_saleproduct_quantity':{'$sum':_0x45d951(0x1ed)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x45d951(0x21b)},'pallet':{'$addToSet':_0x45d951(0x22d)},'finalize':{'$first':_0x45d951(0x224)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x5195ef=await sales_finished[_0x45d951(0x172)]([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x45d951(0x1ce)},{'$group':{'_id':_0x45d951(0x12f),'invoice':{'$first':_0x45d951(0x16f)},'customers':{'$first':_0x45d951(0x138)},'date':{'$first':_0x45d951(0x135)},'warehouse_name':{'$first':_0x45d951(0x10e)},'sale_product':{'$push':_0x45d951(0x1ce)},'note':{'$first':_0x45d951(0x107)},'return_data':{'$first':_0x45d951(0x14e)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x45d951(0x1ed)},'level':{'$addToSet':_0x45d951(0x1b8)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x45d951(0x21b)},'pallet':{'$addToSet':_0x45d951(0x22d)},'finalize':{'$first':_0x45d951(0x224)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x5a317e[0x0]['language']==_0x45d951(0x1bd)){var _0x573bc3=users[_0x45d951(0x1a8)];console['log'](_0x573bc3);}else{if(_0x5a317e[0x0][_0x45d951(0x177)]==_0x45d951(0x17c))var _0x573bc3=users[_0x45d951(0x17c)];else{if(_0x5a317e[0x0][_0x45d951(0x177)]==_0x45d951(0x1cd))var _0x573bc3=users[_0x45d951(0x1cd)];else{if(_0x5a317e[0x0]['language']=='Spanish')var _0x573bc3=users['Spanish'];else{if(_0x5a317e[0x0][_0x45d951(0x177)]==_0x45d951(0x1eb))var _0x573bc3=users[_0x45d951(0x1eb)];else{if(_0x5a317e[0x0][_0x45d951(0x177)]=='Portuguese\x20(BR)')var _0x573bc3=users[_0x45d951(0xee)];else{if(_0x5a317e[0x0][_0x45d951(0x177)]==_0x45d951(0x1a0))var _0x573bc3=users[_0x45d951(0x1a0)];else{if(_0x5a317e[0x0][_0x45d951(0x177)]==_0x45d951(0x1fd))var _0x573bc3=users[_0x45d951(0x145)];}}}}}}}_0x11e249['render']('all_sales_finished_logs',{'success':_0x10f124[_0x45d951(0x14b)](_0x45d951(0x101)),'errors':_0x10f124[_0x45d951(0x14b)]('errors'),'sales':_0x5195ef,'profile':_0x56663c,'role':_0x1301a4,'master_shop':_0x5a317e,'language':_0x573bc3});}catch(_0x42d64a){console['log'](_0x42d64a);}});async function getRandom8DigitNumber(){var _0x41e6e0=a0_0x4e7bd2;const _0x47724f=0x989680,_0x375be9=0x5f5e0ff,_0x325339=Math[_0x41e6e0(0x220)](Math[_0x41e6e0(0x168)]()*(_0x375be9-_0x47724f+0x1))+_0x47724f;var _0x46d6a2;const _0x433f41=await sales_finished[_0x41e6e0(0x213)]({'invoice':'OUTF-'+_0x325339});return _0x433f41&&_0x433f41[_0x41e6e0(0x1b1)]>0x0?_0x46d6a2=_0x41e6e0(0x151)+_0x325339:_0x46d6a2=_0x41e6e0(0x151)+_0x325339,_0x46d6a2;}function a0_0x1bb7(){var _0x2b228c=['LOG-OUT-','password','warehouse_id_detl','$name','English\x20(US)','agent_id','unit_QA','stock','sales_invoice','$product_details','foreach\x20newproduct','sales_id','prod_code','expiry_date','$product_details.level','Ambient','sales_quantity','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_code','ObjectId','German','$sale_product','$product_details.room_name','\x20==\x20','$gross_price','product_cat','563772ZekXoT','abs','sales','catch','find','$unit','Sale\x20Return\x20Mail','/view/return_sales/:id','primary_code_QA','barcode\x20Product\x20master','False','Logo.png','log','maxProducts','$product','product_name_QA1','$product_details.date_recieved','secondary_code_QA','role','<hr\x20class=\x22my-3\x22>','product_id','\x20Name:\x20','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','French','$product_details.type_products','$sale_product.quantity','add_sales_finished','primary_unit','../models/all_models','getDate','roomNamed','stocks_QA','$product_details.floorlevel','purchases_data','sales_quantity_QA','match','undefined','Portuguese\x20(BR)','adjust_qty','all_sales_barcode','\x20units\x20to\x20warehouse:\x20','Arabic\x20(ae)','sales_category','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view/add_sales','all_sales_finished','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','getFullYear','/view_log','warehouse','Sales\x20Add\x20successfully','sale_qty','$product_details.bin','map',',\x20room:\x20','Spanish','push','$product_details.sales_category','for_categorize','Sale\x20Return','<tbody\x20style=\x22text-align:\x20center;\x22>','RoomAssigned','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20','findOne','uuid','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','body','<h5\x20style=\x22text-align:\x20left;\x22>','sale_product','product_name','$sale_product.type','_id','return_sale_QA','int','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','floor','stock_data','$secondary_code','Enclosed','$finalize','warehouse_id','group_ids','then','$product_details.invoice','secondary_unit_QA','/view','$product_details.product_code','/preview/:id','$sale_product.floorlevel','\x20Order\x20Date\x20:\x20','customer_data','Return\x20Rooms','</h5>','$product_details._id','$product_details.product_cat','17292nmdRox','findById','level','true','</tr>','logs','$maxStocks','max','$product_details.secondary_code','Portuguese','mongoose','</td>','9IFjqgD','5649272rOqdSo','carton','id_transaction_from','false','Router','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/add_sales/:id','</span>','232umkyKS','maxProducts_QA','return_sale','$product_details.type','53955zlWXqT','room_name','/give_payment/:id','success','batch_code','product_details','return_qty','date_recieved','add\x20post','$note','/view/add_sale/product','own',',\x20Location:\x20','$product_details.maxProducts','save','<tr>','$warehouse_name','standard_unit','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','filter','toString','return_data','exports','batch_code_QA','outgoiug_inv','$customers_docs','product_data','product_stock','$product_details.product_name','staff','\x20&&\x20','</table>','invoice','secondary_unit','$product_details.primary_code','\x20<>\x20','image','958lDZKbc','$product_details.storage','updateOne','<html><head><title></title>','currency_placement','/view/:id','valueOf','edit_sales_finished_view','3334630NDpmub','/barcode_scanner_auto','$sale_product.bin','../middleware/auth','$_id','\x20</h2>','$product_details.product_stock','maxPerUnit_QA','return_qty_QA','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$date','concat','True','$customer','string','createTransport','bay','date_data','/all_sales_finished/view','split','second_unit','<!DOCTYPE\x20html>','sendMail','Enabled','out','maxperunit','Arabic','Distributing\x20','$primary_code','$product_details.bay','294069IunFcI','room','flash','1236DBONhF','<strong>\x20Regards\x20</strong>','$return_data','$product_details.unit','sales\x20item\x20return\x20successfull','OUTF-','max_per_unit','gross_price','$product_details.batch_code','user','outgoing_invoice','forEach','message','primary_code','<span\x20style=\x22float:\x20right;\x22>','$product_details.rack','prod_cat','finalize','$alertquantity','$product.product_name','logo','production_date','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','OUT-','$product_details.maxPerUnit','$sales_category','warehouse_name','$product_details.secondary_unit','random','<h2>\x20','/picking_list/pdf/','params','maxStocks','product_date','/barcode_scanner_logs','$invoice','Quality\x20Inspection','$maxProdPerUnit','aggregate','$product_details.production_date','errors','/all_sales_finished/preview/','level2','language','expiry_date_QA','/view/add_sales_logs','$secondary_unit','sort','Hindi','json','prod_invoice','secondary_code','customer','all','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</head><body>','product_code','$product_details.gross_price','back','slice','get','\x20Order\x20Number\x20:\x20','</div>','getMonth','min','product_list','Finished\x20Goods','maxPerUnit','$product_details.uuid','render','product_code_QA','site_title','amount','<div>','date_received','unit','padStart','/barcode/:id','Error\x20Occurs','production_date_QA','invoice_init','Email\x20sent\x20successfully','gmail','Chinese','final','</thead>','/process/view','master','name','$room','suppliers','English','7LTxtop','here','email','post','edit_sales_finished','4377Bkdqkn','status','quantity','length','$brand','received_amount','product','$product_details.expiry_date','currency','$category','$sale_product.bay'];a0_0x1bb7=function(){return _0x2b228c;};return a0_0x1bb7();}function a0_0x30df(_0x586af8,_0x2fd8c7){var _0x1bb770=a0_0x1bb7();return a0_0x30df=function(_0x30df57,_0x3a1a5d){_0x30df57=_0x30df57-0xe6;var _0xbf7e33=_0x1bb770[_0x30df57];return _0xbf7e33;},a0_0x30df(_0x586af8,_0x2fd8c7);}router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0x200),auth,async(_0x1d51ca,_0x341428)=>{var _0x29d1ff=a0_0x4e7bd2;try{const {username:_0x8bdbfc,email:_0x20fad5,role:_0x5241e3}=_0x1d51ca['user'],_0x3d06e2=_0x1d51ca[_0x29d1ff(0x155)],_0x35b44e=await profile[_0x29d1ff(0x213)]({'email':_0x3d06e2['email']}),_0x2ad251=await master_shop[_0x29d1ff(0x1d7)](),_0x478c17=await customer[_0x29d1ff(0x1d7)]({});let _0x1a33dc;if(_0x3d06e2[_0x29d1ff(0x1e5)]=='staff'){const _0x4fc4ed=await staff[_0x29d1ff(0x213)]({'email':_0x3d06e2['email']});_0x1a33dc=await warehouse[_0x29d1ff(0x172)]([{'$match':{'status':_0x29d1ff(0x142),'name':_0x4fc4ed[_0x29d1ff(0x205)]}},{'$group':{'_id':_0x29d1ff(0x1bc),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x1a33dc=await warehouse[_0x29d1ff(0x172)]([{'$match':{'status':_0x29d1ff(0x142)}},{'$group':{'_id':_0x29d1ff(0x1bc),'name':{'$first':_0x29d1ff(0x1bc)}}},{'$sort':{'name':0x1}}]);const _0x302cb2=await product[_0x29d1ff(0x1d7)]({});var _0x4afdaf=['Ambient',_0x29d1ff(0x223)];const _0x263702=await sales_finished[_0x29d1ff(0x1d7)]({}),_0x3f31ce=_0x263702[_0x29d1ff(0x1b1)]+0x1,_0x2a298d=_0x29d1ff(0x151)+_0x3f31ce[_0x29d1ff(0x112)]()[_0x29d1ff(0x199)](0x5,'0');if(_0x2ad251[0x0][_0x29d1ff(0x177)]=='English\x20(US)'){var _0x458059=users[_0x29d1ff(0x1a8)];console[_0x29d1ff(0x1df)](_0x458059);}else{if(_0x2ad251[0x0][_0x29d1ff(0x177)]=='Hindi')var _0x458059=users[_0x29d1ff(0x17c)];else{if(_0x2ad251[0x0][_0x29d1ff(0x177)]==_0x29d1ff(0x1cd))var _0x458059=users[_0x29d1ff(0x1cd)];else{if(_0x2ad251[0x0]['language']==_0x29d1ff(0x20b))var _0x458059=users[_0x29d1ff(0x20b)];else{if(_0x2ad251[0x0][_0x29d1ff(0x177)]==_0x29d1ff(0x1eb))var _0x458059=users[_0x29d1ff(0x1eb)];else{if(_0x2ad251[0x0][_0x29d1ff(0x177)]=='Portuguese\x20(BR)')var _0x458059=users[_0x29d1ff(0xee)];else{if(_0x2ad251[0x0][_0x29d1ff(0x177)]==_0x29d1ff(0x1a0))var _0x458059=users[_0x29d1ff(0x1a0)];else{if(_0x2ad251[0x0]['language']==_0x29d1ff(0x1fd))var _0x458059=users[_0x29d1ff(0x145)];}}}}}}}const _0x4cbad0=getRandom8DigitNumber();_0x4cbad0[_0x29d1ff(0x227)](_0x1b82d1=>{var _0x3ee374=_0x29d1ff;_0x341428[_0x3ee374(0x192)](_0x3ee374(0x1ee),{'success':_0x1d51ca[_0x3ee374(0x14b)](_0x3ee374(0x101)),'errors':_0x1d51ca[_0x3ee374(0x14b)](_0x3ee374(0x174)),'role':_0x3d06e2,'profile':_0x35b44e,'customer':_0x478c17,'warehouse':_0x1a33dc,'product':_0x302cb2,'invoice':_0x1b82d1,'master_shop':_0x2ad251,'language':_0x458059,'rooms_data':_0x4afdaf});})[_0x29d1ff(0x1d6)](_0xd6dad3=>{var _0x34b2ca=_0x29d1ff;_0x1d51ca['flash'](_0x34b2ca(0x174),_0x34b2ca(0x1ff)),_0x341428[_0x34b2ca(0x182)](_0x34b2ca(0x13d));});}catch(_0xc0a6bc){console[_0x29d1ff(0x1df)](_0xc0a6bc);}}),router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0x179),auth,async(_0x47c9f9,_0x45f736)=>{var _0x2f3116=a0_0x4e7bd2;try{const {username:_0x195854,email:_0x536987,role:_0x3ed36b}=_0x47c9f9[_0x2f3116(0x155)],_0x36894d=_0x47c9f9['user'],_0x2a5ce8=await profile[_0x2f3116(0x213)]({'email':_0x36894d['email']}),_0x46b543=await master_shop[_0x2f3116(0x1d7)](),_0xdad0ea=await customer[_0x2f3116(0x1d7)]({});let _0x176904;if(_0x36894d[_0x2f3116(0x1e5)]==_0x2f3116(0x11b)){const _0x48460b=await staff['findOne']({'email':_0x36894d['email']});_0x176904=await warehouse[_0x2f3116(0x172)]([{'$match':{'status':_0x2f3116(0x142),'name':_0x48460b[_0x2f3116(0x205)]}},{'$group':{'_id':'$name','name':{'$first':_0x2f3116(0x1bc)}}},{'$sort':{'name':0x1}}]);}else _0x176904=await warehouse[_0x2f3116(0x172)]([{'$match':{'status':_0x2f3116(0x142)}},{'$group':{'_id':_0x2f3116(0x1bc),'name':{'$first':_0x2f3116(0x1bc)}}},{'$sort':{'name':0x1}}]);const _0x233f31=await product[_0x2f3116(0x1d7)]({});var _0x3e91d6=[_0x2f3116(0x1c8),'Enclosed'];const _0x3df208=await sales_finished[_0x2f3116(0x1d7)]({}),_0x3e8d6e=_0x3df208[_0x2f3116(0x1b1)]+0x1,_0xda693f=_0x2f3116(0x151)+_0x3e8d6e[_0x2f3116(0x112)]()['padStart'](0x5,'0');if(_0x46b543[0x0][_0x2f3116(0x177)]==_0x2f3116(0x1bd)){var _0x4d6e7c=users[_0x2f3116(0x1a8)];console[_0x2f3116(0x1df)](_0x4d6e7c);}else{if(_0x46b543[0x0][_0x2f3116(0x177)]==_0x2f3116(0x17c))var _0x4d6e7c=users[_0x2f3116(0x17c)];else{if(_0x46b543[0x0][_0x2f3116(0x177)]==_0x2f3116(0x1cd))var _0x4d6e7c=users[_0x2f3116(0x1cd)];else{if(_0x46b543[0x0][_0x2f3116(0x177)]=='Spanish')var _0x4d6e7c=users['Spanish'];else{if(_0x46b543[0x0][_0x2f3116(0x177)]=='French')var _0x4d6e7c=users[_0x2f3116(0x1eb)];else{if(_0x46b543[0x0]['language']=='Portuguese\x20(BR)')var _0x4d6e7c=users['Portuguese'];else{if(_0x46b543[0x0]['language']==_0x2f3116(0x1a0))var _0x4d6e7c=users[_0x2f3116(0x1a0)];else{if(_0x46b543[0x0][_0x2f3116(0x177)]==_0x2f3116(0x1fd))var _0x4d6e7c=users[_0x2f3116(0x145)];}}}}}}}const _0x38b13f=getRandom8DigitNumber();_0x38b13f[_0x2f3116(0x227)](_0x3e4e8c=>{var _0x3efc0a=_0x2f3116;_0x45f736['render']('add_sales_finished_logs',{'success':_0x47c9f9[_0x3efc0a(0x14b)](_0x3efc0a(0x101)),'errors':_0x47c9f9[_0x3efc0a(0x14b)]('errors'),'role':_0x36894d,'profile':_0x2a5ce8,'customer':_0xdad0ea,'warehouse':_0x176904,'product':_0x233f31,'invoice':_0x3e4e8c,'master_shop':_0x46b543,'language':_0x4d6e7c,'rooms_data':_0x3e91d6});})[_0x2f3116(0x1d6)](_0x4d67ab=>{var _0x51f146=_0x2f3116;_0x47c9f9['flash'](_0x51f146(0x174),_0x51f146(0x1ff)),_0x45f736[_0x51f146(0x182)](_0x51f146(0x13d));});}catch(_0xffe59b){console[_0x2f3116(0x1df)](_0xffe59b);}}),router[a0_0x4e7bd2(0x1ac)](a0_0x4e7bd2(0x179),auth,async(_0x3fbade,_0x5d9e32)=>{var _0x49dbdb=a0_0x4e7bd2;try{const {invoice:_0x1f4944,date:_0x411572,warehouse_name:_0x45ee0e,product_name:_0x201c1c,note:_0x264778,room:_0x329e58,primary_code:_0x360e61,secondary_code:_0x38808e,prod_code:_0x52387d,SCRN:_0x4c4e9c,ReqBy:_0x35aadc,dateofreq:_0x3ec51b,PO_number:_0x3918c8,typeservicesData:_0x10ab59,typevehicle:_0x15f72a,destination:_0x224b76,deliverydate:_0x1fc35f,driver:_0x28c847,plate:_0x3c17b6,van:_0x1e024d,DRSI:_0x335332,TSU:_0x1837a6,TFU:_0x57e855,mode_transpo:_0x81e7d5,name_driver:_0x130794,type_of_products:_0x3f6261}=_0x3fbade[_0x49dbdb(0x217)];if(typeof _0x201c1c==_0x49dbdb(0x139))var _0x502b25=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x21a)]],_0x2b33b6=[_0x3fbade[_0x49dbdb(0x217)]['stock']],_0x370a25=[_0x3fbade['body'][_0x49dbdb(0xf3)]],_0x21688b=[_0x3fbade['body'][_0x49dbdb(0x159)]],_0x4af89e=[_0x3fbade[_0x49dbdb(0x217)]['secondary_code']],_0x1757cb=[_0x3fbade['body'][_0x49dbdb(0x1c5)]],_0xa967d5=[_0x3fbade['body'][_0x49dbdb(0x176)]],_0x2424a0=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x1ef)]],_0x2fabd4=[_0x3fbade[_0x49dbdb(0x217)]['secondary_unit']],_0x37985f=[_0x3fbade[_0x49dbdb(0x217)]['batch_code']],_0x27e3cb=[_0x3fbade[_0x49dbdb(0x217)]['expiry_date']],_0x421cfa=[_0x3fbade['body']['product_date']],_0xc704fe=[_0x3fbade[_0x49dbdb(0x217)]['max_per_unit']],_0x5f5073=[_0x3fbade['body'][_0x49dbdb(0x15c)]],_0x19f13d=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x211)]],_0x4d2426=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x17e)]],_0x76d48c=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0xf4)]],_0x15d254=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x214)]],_0x1289a2=[_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x153)]];else var _0x502b25=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x21a)]],_0x2b33b6=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x1c0)]],_0x370a25=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0xf3)]],_0x21688b=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x159)]],_0x4af89e=[..._0x3fbade[_0x49dbdb(0x217)]['secondary_code']],_0x1757cb=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x1c5)]],_0xa967d5=[..._0x3fbade['body'][_0x49dbdb(0x176)]],_0x2424a0=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x1ef)]],_0x2fabd4=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x11f)]],_0x37985f=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x102)]],_0x27e3cb=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x1c6)]],_0x421cfa=[..._0x3fbade['body']['product_date']],_0xc704fe=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x152)]],_0x5f5073=[..._0x3fbade[_0x49dbdb(0x217)]['prod_cat']],_0x19f13d=[..._0x3fbade['body']['RoomAssigned']],_0x4d2426=[..._0x3fbade[_0x49dbdb(0x217)]['prod_invoice']],_0x76d48c=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0xf4)]],_0x15d254=[..._0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x214)]],_0x1289a2=[..._0x3fbade['body'][_0x49dbdb(0x153)]];const _0x3bc38f=_0x502b25['map'](_0x49ae95=>{return _0x49ae95={'product_name':_0x49ae95};});_0x2b33b6[_0x49dbdb(0x157)]((_0x4b7725,_0x42cc0e)=>{var _0x358720=_0x49dbdb;_0x3bc38f[_0x42cc0e][_0x358720(0x1c0)]=_0x4b7725;}),_0x370a25[_0x49dbdb(0x157)]((_0x5714cd,_0x5d4823)=>{var _0x1f5059=_0x49dbdb;_0x3bc38f[_0x5d4823][_0x1f5059(0x1b0)]=Math['abs'](_0x5714cd);}),_0x502b25[_0x49dbdb(0x157)]((_0x229996,_0x45d671)=>{var _0x4b74c1=_0x49dbdb;_0x3bc38f[_0x45d671][_0x4b74c1(0x1be)]=_0x3fbade['body'][_0x4b74c1(0x1d5)];}),_0x1289a2['forEach']((_0x48b8d6,_0x1163a8)=>{var _0x49f18f=_0x49dbdb;_0x3bc38f[_0x1163a8][_0x49f18f(0x153)]=_0x48b8d6;}),_0x15d254[_0x49dbdb(0x157)]((_0x4fccdd,_0x5b095b)=>{var _0x31253d=_0x49dbdb;_0x3bc38f[_0x5b095b][_0x31253d(0x214)]=_0x4fccdd;}),_0x76d48c[_0x49dbdb(0x157)]((_0x1721c3,_0x480abe)=>{var _0x3dc9ac=_0x49dbdb;_0x3bc38f[_0x480abe][_0x3dc9ac(0xf4)]=_0x1721c3;}),_0x21688b[_0x49dbdb(0x157)]((_0x3ffbb6,_0x4482a2)=>{var _0x4b4479=_0x49dbdb;_0x3bc38f[_0x4482a2][_0x4b4479(0x159)]=_0x3ffbb6;}),_0x4af89e[_0x49dbdb(0x157)]((_0x81008c,_0x34a19e)=>{var _0x3b47fd=_0x49dbdb;_0x3bc38f[_0x34a19e][_0x3b47fd(0x17f)]=_0x81008c;}),_0x1757cb[_0x49dbdb(0x157)]((_0xbbbbc5,_0x57802e)=>{var _0x4eb2d9=_0x49dbdb;_0x3bc38f[_0x57802e][_0x4eb2d9(0x185)]=_0xbbbbc5;}),_0xa967d5['forEach']((_0x3fd124,_0x5a9697)=>{var _0x381278=_0x49dbdb,_0x327f11=_0x3fd124[_0x381278(0x1f7)](/[A-Za-z]+/)[0x0],_0x51b12a=parseInt(_0x3fd124['match'](/\d+/)[0x0]);_0x3bc38f[_0x5a9697]['bay']=_0x51b12a,_0x3bc38f[_0x5a9697]['level']=_0x327f11;}),_0x2424a0[_0x49dbdb(0x157)]((_0x233407,_0x250261)=>{var _0xdbf875=_0x49dbdb;_0x3bc38f[_0x250261][_0xdbf875(0x198)]=_0x233407;}),_0x2fabd4['forEach']((_0xf1d5d4,_0x5ca5ff)=>{var _0x7d5c85=_0x49dbdb;_0x3bc38f[_0x5ca5ff][_0x7d5c85(0x11f)]=_0xf1d5d4;}),_0x37985f[_0x49dbdb(0x157)]((_0x5d8f1b,_0x51db8f)=>{var _0x1f6a30=_0x49dbdb;_0x3bc38f[_0x51db8f][_0x1f6a30(0x102)]=_0x5d8f1b;}),_0x27e3cb[_0x49dbdb(0x157)]((_0x1421ff,_0x16d98f)=>{var _0xed1801=_0x49dbdb;_0x3bc38f[_0x16d98f][_0xed1801(0x1c6)]=_0x1421ff;}),_0x421cfa[_0x49dbdb(0x157)]((_0x4b4be0,_0x4247d3)=>{_0x3bc38f[_0x4247d3]['production_date']=_0x4b4be0;}),_0xc704fe[_0x49dbdb(0x157)]((_0x48d601,_0x46e882)=>{var _0x501a88=_0x49dbdb;_0x3bc38f[_0x46e882][_0x501a88(0x144)]=_0x48d601;}),_0x5f5073[_0x49dbdb(0x157)]((_0x32fadf,_0x2edcbe)=>{var _0x1a8531=_0x49dbdb;_0x3bc38f[_0x2edcbe][_0x1a8531(0x15c)]=_0x32fadf;}),_0x19f13d[_0x49dbdb(0x157)]((_0x2b057e,_0x5361f7)=>{_0x3bc38f[_0x5361f7]['room_name']=_0x2b057e;}),_0x4d2426[_0x49dbdb(0x157)]((_0x43b9d9,_0x2957c1)=>{var _0x50e862=_0x49dbdb;_0x3bc38f[_0x2957c1][_0x50e862(0x11e)]=_0x43b9d9,_0x3bc38f[_0x2957c1]['date_data']=_0x411572;});const _0x539313=new sales_logs();await _0x539313[_0x49dbdb(0x10c)](),_0x4d2426[_0x49dbdb(0x157)]((_0xba84f9,_0x4a4f02)=>{var _0x3f08b1=_0x49dbdb;_0x3bc38f[_0x4a4f02][_0x3f08b1(0x156)]=_0x3f08b1(0x1b9)+_0x539313[_0x3f08b1(0x19d)][_0x3f08b1(0x112)]()[_0x3f08b1(0x199)](0x8,'0');});var _0x3129ea=0x0;_0x3bc38f[_0x49dbdb(0x157)](_0x50f747=>{var _0x211f74=_0x49dbdb;parseFloat(_0x50f747['stock'])<parseFloat(_0x50f747[_0x211f74(0x1b0)])&&parseFloat(_0x50f747['quantity'])>parseFloat(_0x50f747['stock'])&&(console['log'](_0x50f747['stock']+_0x211f74(0x121)+_0x50f747[_0x211f74(0x1b0)]),_0x3129ea++);});if(_0x3129ea!=0x0)return _0x3fbade[_0x49dbdb(0x14b)](_0x49dbdb(0x174),_0x49dbdb(0x202)),_0x5d9e32['redirect'](_0x49dbdb(0x187));const _0x178f2b=_0x3bc38f[_0x49dbdb(0x111)](_0x35a426=>_0x35a426['quantity']!=='0'&&_0x35a426[_0x49dbdb(0x1b0)]!==''),_0x129686=new sales_finished({'invoice':_0x49dbdb(0x1b9)+_0x539313['invoice_init'][_0x49dbdb(0x112)]()[_0x49dbdb(0x199)](0x8,'0'),'sales_data':_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x1d5)],'customer':_0x3fbade[_0x49dbdb(0x217)][_0x49dbdb(0x180)],'date':_0x411572,'warehouse_name':_0x45ee0e,'sale_product':_0x178f2b,'note':_0x264778,'room':_0x329e58,'primary_code':_0x360e61,'secondary_code':_0x38808e,'prod_code':_0x52387d,'SCRN':_0x4c4e9c,'finalize':_0x49dbdb(0x1dd),'mode_transpo':_0x81e7d5,'name_driver':_0x130794,'ReqBy':_0x35aadc,'dateofreq':_0x3ec51b,'PO_number':_0x3918c8,'typeservicesData':_0x10ab59,'typevehicle':_0x15f72a,'destination':_0x224b76,'deliverydate':_0x1fc35f,'driver':_0x28c847,'plate':_0x3c17b6,'van':_0x1e024d,'DRSI':_0x335332,'TSU':_0x1837a6,'TFU':_0x57e855,'typeOfProducts':_0x3f6261}),_0x4a035f=await _0x129686[_0x49dbdb(0x10c)](),_0x4d6d04=await sales_finished[_0x49dbdb(0x213)]({'invoice':_0x1f4944});_0x3fbade['flash'](_0x49dbdb(0x101),'Sales\x20Add\x20successfully'),_0x5d9e32['redirect'](_0x49dbdb(0x175)+_0x4a035f['_id']);}catch(_0x5ea174){console[_0x49dbdb(0x1df)](_0x5ea174);}}),router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0xf8),auth,async(_0x496d68,_0x456bf7)=>{var _0x8827d0=a0_0x4e7bd2;try{const _0x3db938=_0x496d68[_0x8827d0(0x16b)]['id'];console[_0x8827d0(0x1df)](_0x3db938);const _0x1bc78d=await product[_0x8827d0(0x1d7)](),_0x396bb1=await purchases[_0x8827d0(0x172)]([{'$match':{'warehouse_name':_0x3db938}},{'$unwind':_0x8827d0(0x1e1)},{'$group':{'_id':_0x8827d0(0x15f)}}]);console[_0x8827d0(0x1df)](_0x8827d0(0x1f5),_0x396bb1),_0x456bf7[_0x8827d0(0x1af)](0xc8)['json']({'purchases_data':_0x396bb1,'product_data':_0x1bc78d});}catch(_0x3aa4ad){console['log'](_0x3aa4ad);}}),router[a0_0x4e7bd2(0x1ac)](a0_0x4e7bd2(0x108),auth,async(_0x2934ca,_0x1b6ee2)=>{var _0x2904d1=a0_0x4e7bd2;try{const {warehouse_data:_0x1808a5,product_data:_0x1abe6c}=_0x2934ca[_0x2904d1(0x217)];console[_0x2904d1(0x1df)](_0x2934ca[_0x2904d1(0x217)][_0x2904d1(0x118)]);;const _0x182c42=await master_shop[_0x2904d1(0x1d7)]();console['log'](_0x2904d1(0x1a4),_0x182c42);const _0x561e35=await product[_0x2904d1(0x213)]({'name':_0x1abe6c});console[_0x2904d1(0x1df)](_0x2904d1(0x1b4),_0x561e35);const _0x529f1d=await warehouse['aggregate']([{'$match':{'name':_0x1808a5}},{'$unwind':_0x2904d1(0x1c2)},{'$match':{'product_details.product_name':_0x1abe6c}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x2904d1(0x1df)](_0x2904d1(0x221),_0x529f1d),_0x1b6ee2[_0x2904d1(0x1af)](0xc8)[_0x2904d1(0x17d)]({'master':_0x182c42,'new_product':_0x561e35,'stock_data':_0x529f1d});}catch(_0x227937){console[_0x2904d1(0x1df)](_0x227937);}}),router['post'](a0_0x4e7bd2(0x200),auth,async(_0x2846a2,_0x2bda1c)=>{var _0x4bad3a=a0_0x4e7bd2;try{const {invoice:_0x3caa66,date:_0x283781,warehouse_name:_0x207b21,product_name:_0x31f3f1,note:_0x37add9,room:_0xa03bf7,primary_code:_0x40febb,secondary_code:_0x4140b1,prod_code:_0x23b6a1,SCRN:_0x1ad4b8,ReqBy:_0x221b4f,dateofreq:_0x303bdf,PO_number:_0x4760bd,typeservicesData:_0x317f75,typevehicle:_0xe5b2c1,destination:_0x3a7ce3,deliverydate:_0x49c036,driver:_0x1d7533,plate:_0x4848ac,van:_0x49853c,DRSI:_0x4691cf,TSU:_0x34980e,TFU:_0x26c36c,mode_transpo:_0x5ac854,name_driver:_0x4f9a68,pull_out_date:_0x798468,actual_delivery_date:_0x249819}=_0x2846a2['body'];_0x2bda1c[_0x4bad3a(0x17d)](_0x2846a2[_0x4bad3a(0x217)]);return;if(typeof _0x31f3f1==_0x4bad3a(0x139))var _0x4edbc0=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x21a)]],_0x47d742=[_0x2846a2['body'][_0x4bad3a(0x1c0)]],_0xb39bf5=[_0x2846a2['body'][_0x4bad3a(0xf3)]],_0x552104=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x159)]],_0x39452f=[_0x2846a2[_0x4bad3a(0x217)]['secondary_code']],_0x2edab9=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x1c5)]],_0x526eec=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x176)]],_0x4657e2=[_0x2846a2[_0x4bad3a(0x217)]['primary_unit']],_0x378551=[_0x2846a2['body'][_0x4bad3a(0x11f)]],_0x281a42=[_0x2846a2[_0x4bad3a(0x217)]['batch_code']],_0x384d3c=[_0x2846a2['body'][_0x4bad3a(0x1c6)]],_0x5ad29e=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x16d)]],_0x249382=[_0x2846a2['body'][_0x4bad3a(0x152)]],_0x34a7a4=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x15c)]],_0x1671f1=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x211)]],_0x22f7ec=[_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x17e)]],_0x1740aa=[_0x2846a2[_0x4bad3a(0x217)]['id_transaction_from']],_0x3e28d9=[_0x2846a2[_0x4bad3a(0x217)]['uuid']],_0x6a8130=[_0x2846a2['body'][_0x4bad3a(0x153)]];else var _0x4edbc0=[..._0x2846a2['body'][_0x4bad3a(0x21a)]],_0x47d742=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x1c0)]],_0xb39bf5=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0xf3)]],_0x552104=[..._0x2846a2[_0x4bad3a(0x217)]['primary_code']],_0x39452f=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x17f)]],_0x2edab9=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x1c5)]],_0x526eec=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x176)]],_0x4657e2=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x1ef)]],_0x378551=[..._0x2846a2['body'][_0x4bad3a(0x11f)]],_0x281a42=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x102)]],_0x384d3c=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x1c6)]],_0x5ad29e=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x16d)]],_0x249382=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x152)]],_0x34a7a4=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x15c)]],_0x1671f1=[..._0x2846a2['body'][_0x4bad3a(0x211)]],_0x22f7ec=[..._0x2846a2['body'][_0x4bad3a(0x17e)]],_0x1740aa=[..._0x2846a2['body'][_0x4bad3a(0xf4)]],_0x3e28d9=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x214)]],_0x6a8130=[..._0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x153)]];const _0x42d0d7=_0x4edbc0[_0x4bad3a(0x209)](_0x14f307=>{return _0x14f307={'product_name':_0x14f307};});_0x47d742['forEach']((_0x2eb6c0,_0x1dd973)=>{_0x42d0d7[_0x1dd973]['stock']=_0x2eb6c0;}),_0xb39bf5[_0x4bad3a(0x157)]((_0x1c4380,_0x55f5e7)=>{var _0x503d70=_0x4bad3a;_0x42d0d7[_0x55f5e7]['quantity']=Math[_0x503d70(0x1d4)](_0x1c4380);}),_0x4edbc0[_0x4bad3a(0x157)]((_0x2990eb,_0x1b7998)=>{var _0x594dea=_0x4bad3a;_0x42d0d7[_0x1b7998]['agent_id']=_0x2846a2[_0x594dea(0x217)][_0x594dea(0x1d5)];}),_0x6a8130[_0x4bad3a(0x157)]((_0x20ed1d,_0x227e76)=>{var _0x1d5547=_0x4bad3a;_0x42d0d7[_0x227e76][_0x1d5547(0x153)]=_0x20ed1d;}),_0x3e28d9['forEach']((_0x52241f,_0x1abbc3)=>{var _0x36e04a=_0x4bad3a;_0x42d0d7[_0x1abbc3][_0x36e04a(0x214)]=_0x52241f;}),_0x1740aa[_0x4bad3a(0x157)]((_0x2846e2,_0x17beeb)=>{var _0x7de0e1=_0x4bad3a;_0x42d0d7[_0x17beeb][_0x7de0e1(0xf4)]=_0x2846e2;}),_0x552104[_0x4bad3a(0x157)]((_0x4b4b3b,_0x597bfb)=>{var _0x44d0d1=_0x4bad3a;_0x42d0d7[_0x597bfb][_0x44d0d1(0x159)]=_0x4b4b3b;}),_0x39452f[_0x4bad3a(0x157)]((_0x368a00,_0x16be1f)=>{var _0x524584=_0x4bad3a;_0x42d0d7[_0x16be1f][_0x524584(0x17f)]=_0x368a00;}),_0x2edab9[_0x4bad3a(0x157)]((_0x272f7e,_0x4dd9d9)=>{_0x42d0d7[_0x4dd9d9]['product_code']=_0x272f7e;}),_0x526eec[_0x4bad3a(0x157)]((_0x3128df,_0x5ae808)=>{var _0x108b49=_0x4bad3a,_0x5444aa=_0x3128df['match'](/[A-Za-z]+/)[0x0],_0xade3f7=parseInt(_0x3128df[_0x108b49(0x1f7)](/\d+/)[0x0]);_0x42d0d7[_0x5ae808]['bay']=_0xade3f7,_0x42d0d7[_0x5ae808][_0x108b49(0xe7)]=_0x5444aa;}),_0x4657e2[_0x4bad3a(0x157)]((_0x556021,_0x4b780e)=>{var _0x427b99=_0x4bad3a;_0x42d0d7[_0x4b780e][_0x427b99(0x198)]=_0x556021;}),_0x378551[_0x4bad3a(0x157)]((_0x57b44a,_0x1afa00)=>{var _0x1879a9=_0x4bad3a;_0x42d0d7[_0x1afa00][_0x1879a9(0x11f)]=_0x57b44a;}),_0x281a42['forEach']((_0x4266c8,_0x48f974)=>{var _0x4820b0=_0x4bad3a;_0x42d0d7[_0x48f974][_0x4820b0(0x102)]=_0x4266c8;}),_0x384d3c[_0x4bad3a(0x157)]((_0x13f55b,_0x85e140)=>{var _0x29adac=_0x4bad3a;_0x42d0d7[_0x85e140][_0x29adac(0x1c6)]=_0x13f55b;}),_0x5ad29e[_0x4bad3a(0x157)]((_0x374312,_0xc087f8)=>{var _0x38ae1f=_0x4bad3a;_0x42d0d7[_0xc087f8][_0x38ae1f(0x161)]=_0x374312;}),_0x249382[_0x4bad3a(0x157)]((_0x4f6663,_0x4febc6)=>{var _0x2b4ba8=_0x4bad3a;_0x42d0d7[_0x4febc6][_0x2b4ba8(0x144)]=_0x4f6663;}),_0x34a7a4[_0x4bad3a(0x157)]((_0x37c2ce,_0x5d718f)=>{var _0x2ec945=_0x4bad3a;_0x42d0d7[_0x5d718f][_0x2ec945(0x15c)]=_0x37c2ce;}),_0x1671f1[_0x4bad3a(0x157)]((_0x18812d,_0x511f7e)=>{var _0x53e417=_0x4bad3a;_0x42d0d7[_0x511f7e][_0x53e417(0xff)]=_0x18812d;}),_0x22f7ec[_0x4bad3a(0x157)]((_0x2489e7,_0x4de3c0)=>{var _0xff3b5=_0x4bad3a;_0x42d0d7[_0x4de3c0][_0xff3b5(0x11e)]=_0x2489e7,_0x42d0d7[_0x4de3c0][_0xff3b5(0x13c)]=_0x283781;});const _0x23716c=new invoice_for_outgoing();await _0x23716c['save'](),_0x22f7ec[_0x4bad3a(0x157)]((_0x35434a,_0x54f692)=>{var _0x48fef0=_0x4bad3a;_0x42d0d7[_0x54f692][_0x48fef0(0x156)]=_0x48fef0(0x163)+_0x23716c['invoice_init'][_0x48fef0(0x112)]()[_0x48fef0(0x199)](0x8,'0');});var _0x14217c=0x0;_0x42d0d7[_0x4bad3a(0x157)](_0x427dfd=>{var _0x23d73c=_0x4bad3a;parseFloat(_0x427dfd['stock'])<parseFloat(_0x427dfd[_0x23d73c(0x1b0)])&&parseFloat(_0x427dfd[_0x23d73c(0x1b0)])>parseFloat(_0x427dfd[_0x23d73c(0x1c0)])&&(console[_0x23d73c(0x1df)](_0x427dfd[_0x23d73c(0x1c0)]+_0x23d73c(0x121)+_0x427dfd[_0x23d73c(0x1b0)]),_0x14217c++);});if(_0x14217c!=0x0)return _0x2846a2[_0x4bad3a(0x14b)](_0x4bad3a(0x174),_0x4bad3a(0x202)),_0x2bda1c[_0x4bad3a(0x182)]('back');const _0x4771b1=_0x42d0d7[_0x4bad3a(0x111)](_0x36f175=>_0x36f175[_0x4bad3a(0x1b0)]!=='0'&&_0x36f175[_0x4bad3a(0x1b0)]!==''),_0x16001c=new sales_finished({'invoice':_0x4bad3a(0x163)+_0x23716c['invoice_init'][_0x4bad3a(0x112)]()['padStart'](0x8,'0'),'sales_data':_0x2846a2[_0x4bad3a(0x217)][_0x4bad3a(0x1d5)],'customer':_0x2846a2['body']['customer'],'date':_0x283781,'warehouse_name':_0x207b21,'sale_product':_0x4771b1,'note':_0x37add9,'room':_0xa03bf7,'primary_code':_0x40febb,'secondary_code':_0x4140b1,'prod_code':_0x23b6a1,'SCRN':_0x1ad4b8,'finalize':_0x4bad3a(0x1dd),'mode_transpo':_0x5ac854,'name_driver':_0x4f9a68,'ReqBy':_0x221b4f,'dateofreq':_0x303bdf,'PO_number':_0x4760bd,'typeservicesData':_0x317f75,'typevehicle':_0xe5b2c1,'destination':_0x3a7ce3,'deliverydate':_0x49c036,'driver':_0x1d7533,'plate':_0x4848ac,'van':_0x49853c,'DRSI':_0x4691cf,'TSU':_0x34980e,'TFU':_0x26c36c,'pullout_date':_0x798468,'actualdelivery_date':_0x249819,'typeOfProducts':_0x4bad3a(0x109)}),_0x24b940=await _0x16001c[_0x4bad3a(0x10c)](),_0x4873b2=await sales_finished[_0x4bad3a(0x213)]({'invoice':_0x3caa66});_0x2846a2[_0x4bad3a(0x14b)](_0x4bad3a(0x101),_0x4bad3a(0x206)),_0x2bda1c[_0x4bad3a(0x182)](_0x4bad3a(0x175)+_0x24b940['_id']);}catch(_0x22f5f7){console[_0x4bad3a(0x1df)](_0x22f5f7);}}),router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0x22c),auth,async(_0x2223c2,_0x13f658)=>{var _0x3f5672=a0_0x4e7bd2;try{const {username:_0x1d7180,email:_0x196edd,role:_0x3ca4a3}=_0x2223c2['user'],_0x2d8ab8=_0x2223c2[_0x3f5672(0x155)],_0x283c51=await profile[_0x3f5672(0x213)]({'email':_0x2d8ab8[_0x3f5672(0x1ab)]}),_0x4c8599=await master_shop[_0x3f5672(0x1d7)](),_0xdca08=_0x2223c2[_0x3f5672(0x16b)]['id'],_0x19a515=await sales_finished['findById'](_0xdca08),_0x3e2da0=await warehouse['aggregate']([{'$match':{'name':_0x19a515[_0x3f5672(0x166)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3f5672(0x232),'name':{'$first':_0x3f5672(0x11a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3f5672(0x208)},'type':{'$first':_0x3f5672(0xfd)},'floorlevel':{'$first':_0x3f5672(0x1f4)},'primary_code':{'$first':_0x3f5672(0x120)},'secondary_code':{'$first':_0x3f5672(0xed)},'product_code':{'$first':_0x3f5672(0x22b)},'storage':{'$first':_0x3f5672(0x124)},'rack':{'$first':_0x3f5672(0x15b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3f5672(0x173)},'batch_code':{'$first':_0x3f5672(0x154)},'room':{'$first':'$room'},'room_data':{'$first':_0x3f5672(0x1cf)}}}]),_0x3557c1=await customer[_0x3f5672(0x1d7)]({});let _0x5021df;if(_0x2d8ab8[_0x3f5672(0x1e5)]=='staff'){const _0x33d256=await staff[_0x3f5672(0x213)]({'email':_0x2d8ab8[_0x3f5672(0x1ab)]});_0x5021df=await warehouse['aggregate']([{'$match':{'status':_0x3f5672(0x142),'name':_0x33d256[_0x3f5672(0x205)]}},{'$group':{'_id':_0x3f5672(0x1bc),'name':{'$first':_0x3f5672(0x1bc)}}}]);}else _0x5021df=await warehouse[_0x3f5672(0x172)]([{'$match':{'status':_0x3f5672(0x142)}},{'$group':{'_id':_0x3f5672(0x1bc),'name':{'$first':_0x3f5672(0x1bc)}}}]);const _0x4eee45=await product[_0x3f5672(0x1d7)]({});if(_0x4c8599[0x0]['language']==_0x3f5672(0x1bd)){var _0x25957a=users['English'];console[_0x3f5672(0x1df)](_0x25957a);}else{if(_0x4c8599[0x0][_0x3f5672(0x177)]==_0x3f5672(0x17c))var _0x25957a=users[_0x3f5672(0x17c)];else{if(_0x4c8599[0x0][_0x3f5672(0x177)]==_0x3f5672(0x1cd))var _0x25957a=users['German'];else{if(_0x4c8599[0x0][_0x3f5672(0x177)]==_0x3f5672(0x20b))var _0x25957a=users[_0x3f5672(0x20b)];else{if(_0x4c8599[0x0][_0x3f5672(0x177)]==_0x3f5672(0x1eb))var _0x25957a=users['French'];else{if(_0x4c8599[0x0][_0x3f5672(0x177)]=='Portuguese\x20(BR)')var _0x25957a=users[_0x3f5672(0xee)];else{if(_0x4c8599[0x0][_0x3f5672(0x177)]==_0x3f5672(0x1a0))var _0x25957a=users[_0x3f5672(0x1a0)];else{if(_0x4c8599[0x0][_0x3f5672(0x177)]==_0x3f5672(0x1fd))var _0x25957a=users[_0x3f5672(0x145)];}}}}}}}_0x13f658[_0x3f5672(0x192)](_0x3f5672(0x12a),{'success':_0x2223c2[_0x3f5672(0x14b)]('success'),'errors':_0x2223c2[_0x3f5672(0x14b)]('errors'),'role':_0x2d8ab8,'profile':_0x283c51,'customer':_0x3557c1,'warehouse':_0x5021df,'product':_0x3e2da0,'user':_0x19a515,'master_shop':_0x4c8599,'unit':_0x4eee45,'language':_0x25957a});}catch(_0x266e6d){console[_0x3f5672(0x1df)](_0x266e6d);}});async function dataUpdate(_0x2a1f3f,_0x1e69eb,_0x565740){var _0x532252=a0_0x4e7bd2;return await warehouse['updateOne']({'_id':_0x2a1f3f,'product_details._id':_0x1e69eb},{'$set':{'product_details.$.product_stock':_0x565740}}),await warehouse[_0x532252(0xe6)](_0x2a1f3f);}router['post'](a0_0x4e7bd2(0x22c),auth,async(_0x2fd3d0,_0x339800)=>{var _0xb7a90a=a0_0x4e7bd2;try{const _0x58067b=_0x2fd3d0[_0xb7a90a(0x16b)]['id'],{invoice:_0x17c37e,warehouse_name:_0x441a89,room:_0x31ecca}=_0x2fd3d0['body'],_0x1fbfbb=await sales_finished['findOne']({'invoice':_0x17c37e});for(let _0x49f807=0x0;_0x49f807<=_0x1fbfbb[_0xb7a90a(0x219)][_0xb7a90a(0x1b1)]-0x1;_0x49f807++){const _0x2c5bad=_0x1fbfbb['sale_product'][_0x49f807];var _0x45dc1e=await warehouse[_0xb7a90a(0x213)]({'name':_0x441a89,'room':_0x2c5bad[_0xb7a90a(0xff)]}),_0xc19aff=0x0;for(let _0xb46e2f=0x0;_0xb46e2f<=_0x45dc1e[_0xb7a90a(0x103)]['length']-0x1;_0xb46e2f++){const _0x1946bf=_0x45dc1e['product_details'][_0xb46e2f];_0x1946bf[_0xb7a90a(0x21c)]==_0x2c5bad[_0xb7a90a(0xf4)]&&_0x1946bf['uuid']==_0x2c5bad[_0xb7a90a(0x214)]&&(_0xc19aff=Math[_0xb7a90a(0xec)](0x0,Math[_0xb7a90a(0x1d4)](_0x1946bf['product_stock'])-Math['abs'](_0x2c5bad[_0xb7a90a(0x1b0)])),await warehouse[_0xb7a90a(0x125)]({'_id':_0x45dc1e['_id']['valueOf'](),'product_details._id':_0x1946bf[_0xb7a90a(0x21c)][_0xb7a90a(0x129)](),'product_details.uuid':_0x2c5bad[_0xb7a90a(0x214)]},{'$set':{'product_details.$.product_stock':_0xc19aff}}));}console[_0xb7a90a(0x1df)](typeof _0x2c5bad['agent_id']);if(typeof _0x2c5bad[_0xb7a90a(0x1be)]!==_0xb7a90a(0x1f8)){var _0x2e358c=await staff[_0xb7a90a(0xe6)](_0x2c5bad['agent_id']);console[_0xb7a90a(0x1df)](_0xb7a90a(0x1aa));var _0x108643=0x0;for(let _0x5c3ff5=0x0;_0x5c3ff5<=_0x2e358c['product_list'][_0xb7a90a(0x1b1)]-0x1;_0x5c3ff5++){const _0x5179a7=_0x2e358c[_0xb7a90a(0x18e)][_0x5c3ff5];console[_0xb7a90a(0x1df)](_0x2c5bad[_0xb7a90a(0xf4)]+_0xb7a90a(0x1d0)+_0x5179a7[_0xb7a90a(0x225)]+_0xb7a90a(0x11c)+_0x2c5bad[_0xb7a90a(0x21c)]+_0xb7a90a(0x1d0)+_0x2c5bad[_0xb7a90a(0x21c)]),_0x2c5bad[_0xb7a90a(0xf4)]==_0x5179a7[_0xb7a90a(0x225)]&&_0x2c5bad[_0xb7a90a(0x21c)]==0x1&&(_0x5179a7[_0xb7a90a(0x119)]=Math['abs'](_0x5179a7['product_stock'])+Math[_0xb7a90a(0x1d4)](_0x2c5bad[_0xb7a90a(0x1b0)]),_0x108643++);}console['log'](_0xb7a90a(0x21e),_0x108643),_0x108643=='0'&&(_0x2e358c['product_list']=_0x2e358c[_0xb7a90a(0x18e)][_0xb7a90a(0x136)]({'product_name':_0x2c5bad[_0xb7a90a(0x21a)],'product_stock':_0x2c5bad[_0xb7a90a(0x1b0)],'bay':_0x2c5bad[_0xb7a90a(0x13b)],'level':_0x2c5bad['level'],'product_code':_0x2c5bad[_0xb7a90a(0x185)],'primary_code':_0x2c5bad[_0xb7a90a(0x159)],'secondary_code':_0x2c5bad[_0xb7a90a(0x17f)],'expiry_date':_0x2c5bad['expiry_date'],'production_date':_0x2c5bad[_0xb7a90a(0x161)],'maxProducts':_0x2c5bad['maxProducts'],'batch_code':_0x2c5bad[_0xb7a90a(0x102)],'secondary_unit':_0x2c5bad['secondary_unit'],'unit':_0x2c5bad[_0xb7a90a(0x198)],'maxProducts':_0x2c5bad[_0xb7a90a(0x1e0)],'maxPerUnit':_0x2c5bad[_0xb7a90a(0x144)],'invoice':_0x2c5bad[_0xb7a90a(0x11e)],'warehouse_id':_0x2c5bad[_0xb7a90a(0xf4)],'id_incoming':_0x2c5bad[_0xb7a90a(0x21c)],'uuid':_0x2c5bad['uuid'],'gross_price':_0x2c5bad[_0xb7a90a(0x153)],'date_incoming':_0x2c5bad[_0xb7a90a(0x13c)],'outgoing_invoice':_0x2c5bad[_0xb7a90a(0x156)]}),await _0x2e358c[_0xb7a90a(0x10c)]());}}_0x1fbfbb[_0xb7a90a(0x15d)]=_0xb7a90a(0x137);const _0x24c1ad=await _0x1fbfbb[_0xb7a90a(0x10c)](),_0x4c3583=await master_shop[_0xb7a90a(0x1d7)](),_0x4c12ee=await email_settings[_0xb7a90a(0x213)](),_0x44c17f=await supervisor_settings[_0xb7a90a(0x1d7)]();var _0x1aaa89=_0x1fbfbb[_0xb7a90a(0x219)],_0x2bd3bc='',_0x4d4724;for(_0x4d4724 in _0x1aaa89){_0x2bd3bc+=_0xb7a90a(0x10d)+_0xb7a90a(0xf7)+_0x1aaa89[_0x4d4724]['product_name']+_0xb7a90a(0xf0)+_0xb7a90a(0xf7)+_0x1aaa89[_0x4d4724][_0xb7a90a(0x185)]+'</td>'+_0xb7a90a(0xf7)+_0x1aaa89[_0x4d4724][_0xb7a90a(0x1b0)]+_0xb7a90a(0xf0)+_0xb7a90a(0xf7)+_0x1aaa89[_0x4d4724][_0xb7a90a(0x198)]+_0xb7a90a(0xf0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1aaa89[_0x4d4724][_0xb7a90a(0x11f)]+_0xb7a90a(0xf0)+_0xb7a90a(0xf7)+_0x1fbfbb[_0xb7a90a(0x166)]+_0xb7a90a(0xf0)+_0xb7a90a(0xf7)+_0x1aaa89[_0x4d4724]['room_name']+_0xb7a90a(0xf0)+_0xb7a90a(0xf7)+_0x1aaa89[_0x4d4724][_0xb7a90a(0x13b)]+_0xb7a90a(0xf0);}_0x2fd3d0[_0xb7a90a(0x14b)](_0xb7a90a(0x101),_0xb7a90a(0x1e9)),_0x339800['redirect'](_0xb7a90a(0x16a)+_0x58067b);}catch(_0x13274c){console[_0xb7a90a(0x1df)](_0x13274c);}}),router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0x128),auth,async(_0x42b028,_0x34db40)=>{var _0x13d35b=a0_0x4e7bd2;try{const {username:_0xfc3921,email:_0x3abca9,role:_0x3470fb}=_0x42b028['user'],_0x20b0e4=_0x42b028[_0x13d35b(0x155)],_0x2ff9cb=await profile[_0x13d35b(0x213)]({'email':_0x20b0e4['email']}),_0xf67e3d=await master_shop[_0x13d35b(0x1d7)](),_0x443766=_0x42b028[_0x13d35b(0x16b)]['id'],_0x86bb6=await sales_finished[_0x13d35b(0xe6)](_0x443766);let _0x47346c=new Date(_0x86bb6[_0x13d35b(0x1c6)]),_0x30d8e2=('0'+_0x47346c[_0x13d35b(0x1f1)]())[_0x13d35b(0x188)](-0x2),_0x191434=('0'+(_0x47346c['getMonth']()+0x1))[_0x13d35b(0x188)](-0x2),_0x442d12=_0x47346c['getFullYear'](),_0x3e6272=_0x442d12+'-'+_0x191434+'-'+_0x30d8e2;var _0x32a9cd=[_0x13d35b(0x1c8),_0x13d35b(0x223)];const _0x2135a5=await warehouse['aggregate']([{'$match':{'name':_0x86bb6['warehouse_name'],'room':_0x86bb6[_0x13d35b(0x14a)]}},{'$unwind':_0x13d35b(0x1c2)},{'$group':{'_id':_0x13d35b(0x232),'name':{'$first':_0x13d35b(0x11a)},'product_stock':{'$first':_0x13d35b(0x131)},'bay':{'$first':_0x13d35b(0x148)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x13d35b(0xfd)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x13d35b(0x120)},'secondary_code':{'$first':_0x13d35b(0xed)},'product_code':{'$first':_0x13d35b(0x22b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x44b431=await customer[_0x13d35b(0x1d7)]({});let _0x1bc7cd;if(_0x20b0e4[_0x13d35b(0x1e5)]==_0x13d35b(0x11b)){const _0x4ef244=await staff[_0x13d35b(0x213)]({'email':_0x20b0e4['email']});_0x1bc7cd=await warehouse[_0x13d35b(0x172)]([{'$match':{'status':_0x13d35b(0x142),'name':_0x4ef244['warehouse']}},{'$group':{'_id':_0x13d35b(0x1bc),'name':{'$first':_0x13d35b(0x1bc)}}}]);}else _0x1bc7cd=await warehouse['aggregate']([{'$match':{'status':_0x13d35b(0x142)}},{'$group':{'_id':_0x13d35b(0x1bc),'name':{'$first':'$name'}}}]);const _0x5c5742=await product['find']({});if(_0xf67e3d[0x0][_0x13d35b(0x177)]==_0x13d35b(0x1bd)){var _0x54c4cd=users[_0x13d35b(0x1a8)];console[_0x13d35b(0x1df)](_0x54c4cd);}else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]==_0x13d35b(0x17c))var _0x54c4cd=users[_0x13d35b(0x17c)];else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]==_0x13d35b(0x1cd))var _0x54c4cd=users['German'];else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]=='Spanish')var _0x54c4cd=users[_0x13d35b(0x20b)];else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]=='French')var _0x54c4cd=users[_0x13d35b(0x1eb)];else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]==_0x13d35b(0x1f9))var _0x54c4cd=users[_0x13d35b(0xee)];else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]==_0x13d35b(0x1a0))var _0x54c4cd=users[_0x13d35b(0x1a0)];else{if(_0xf67e3d[0x0][_0x13d35b(0x177)]==_0x13d35b(0x1fd))var _0x54c4cd=users['Arabic'];}}}}}}}_0x34db40[_0x13d35b(0x192)](_0x13d35b(0x1ad),{'success':_0x42b028['flash'](_0x13d35b(0x101)),'errors':_0x42b028[_0x13d35b(0x14b)](_0x13d35b(0x174)),'role':_0x20b0e4,'profile':_0x2ff9cb,'customer':_0x44b431,'warehouse':_0x1bc7cd,'product':_0x2135a5,'user':_0x86bb6,'master_shop':_0xf67e3d,'unit':_0x5c5742,'language':_0x54c4cd,'rooms_data':_0x32a9cd,'ed_fullDate':_0x3e6272});}catch(_0xd685fd){console[_0x13d35b(0x1df)](_0xd685fd);}}),router['post'](a0_0x4e7bd2(0x128),auth,async(_0x418939,_0xe3376d)=>{var _0x52a6af=a0_0x4e7bd2;try{const _0x23693a=_0x418939[_0x52a6af(0x16b)]['id'],_0x1ddab3=await sales_finished['findOne']({'_id':_0x418939['params']['id']}),_0x41ea06=await warehouse[_0x52a6af(0x213)]({'name':_0x1ddab3['warehouse_name'],'room':_0x418939[_0x52a6af(0x217)][_0x52a6af(0x14a)],'warehouse_category':_0x52a6af(0x18f)}),{invoice:_0x5a3434,customer:_0x74ed96,date:_0x208ff0,warehouse_name:_0x5dd3c7,product_name:_0x47b502,stock:_0x57552e,adjust_qty:_0x25b6f7,note:_0x41344d,room:_0x3a480b,primary_code:_0x299a55,secondary_code:_0x346bee,prod_code:_0x27811c,level:_0x515983,isle:_0x2d47fe,pallet:_0x530864,expiry_date:_0x4b9f54}=_0x418939[_0x52a6af(0x217)];if(typeof _0x47b502==_0x52a6af(0x139))var _0x5bfe30=[_0x418939[_0x52a6af(0x217)][_0x52a6af(0x21a)]],_0x5be5c8=[_0x418939['body'][_0x52a6af(0x1c0)]],_0x21b365=[_0x418939[_0x52a6af(0x217)][_0x52a6af(0x1fa)]],_0x2a20a4=[_0x418939[_0x52a6af(0x217)][_0x52a6af(0x159)]],_0x39e2e1=[_0x418939['body'][_0x52a6af(0x17f)]],_0x262c89=[_0x418939[_0x52a6af(0x217)][_0x52a6af(0x1c5)]],_0x15a557=[_0x418939[_0x52a6af(0x217)][_0x52a6af(0xe7)]],_0x9ddb79=[_0x418939[_0x52a6af(0x217)][_0x52a6af(0x1c6)]];else var _0x5bfe30=[..._0x418939[_0x52a6af(0x217)][_0x52a6af(0x21a)]],_0x5be5c8=[..._0x418939['body']['stock']],_0x21b365=[..._0x418939[_0x52a6af(0x217)][_0x52a6af(0x1fa)]],_0x2a20a4=[..._0x418939[_0x52a6af(0x217)]['primary_code']],_0x39e2e1=[..._0x418939[_0x52a6af(0x217)]['secondary_code']],_0x262c89=[..._0x418939['body'][_0x52a6af(0x1c5)]],_0x15a557=[..._0x418939[_0x52a6af(0x217)]['level']],_0x9ddb79=[..._0x418939[_0x52a6af(0x217)][_0x52a6af(0x1c6)]];const _0x23873c=_0x5bfe30[_0x52a6af(0x209)](_0x21ac01=>{return _0x21ac01={'product_name':_0x21ac01};});_0x5be5c8[_0x52a6af(0x157)]((_0x38c997,_0x227d71)=>{var _0x5f451e=_0x52a6af;_0x23873c[_0x227d71][_0x5f451e(0x1c0)]=_0x38c997;}),_0x21b365[_0x52a6af(0x157)]((_0x4ca18d,_0x3da374)=>{_0x23873c[_0x3da374]['quantity']=_0x4ca18d;}),_0x2a20a4[_0x52a6af(0x157)]((_0x1b654b,_0x5ee75d)=>{var _0x4f7d04=_0x52a6af;_0x23873c[_0x5ee75d][_0x4f7d04(0x159)]=_0x1b654b;}),_0x39e2e1[_0x52a6af(0x157)]((_0x5ec370,_0x2a9748)=>{var _0x4de6bb=_0x52a6af;_0x23873c[_0x2a9748][_0x4de6bb(0x17f)]=_0x5ec370;}),_0x262c89['forEach']((_0xd3aa60,_0x162263)=>{var _0x251cf4=_0x52a6af;_0x23873c[_0x162263][_0x251cf4(0x185)]=_0xd3aa60;}),_0x15a557['forEach']((_0x4ac9e2,_0x443890)=>{_0x23873c[_0x443890]['level']=_0x4ac9e2;}),_0x9ddb79['forEach']((_0x465658,_0x1e3ebe)=>{var _0x4262fc=_0x52a6af;_0x23873c[_0x1e3ebe][_0x4262fc(0x1c6)]=_0x465658;});var _0x2bcde7=0x0;_0x23873c[_0x52a6af(0x157)](_0xbd4e=>{var _0xd16932=_0x52a6af;console['log'](_0xd16932(0x1c3),_0xbd4e),(parseInt(_0xbd4e[_0xd16932(0x1c0)])<parseInt(_0xbd4e['quantity'])||parseInt(_0xbd4e[_0xd16932(0x1b0)])==0x0)&&_0x2bcde7++;});if(_0x2bcde7!=0x0)return _0x418939['flash'](_0x52a6af(0x174),_0x52a6af(0x216)),_0xe3376d[_0x52a6af(0x182)]('back');_0x1ddab3['sale_product'][_0x52a6af(0x157)](_0x5e8527=>{var _0x4c8fb9=_0x52a6af;const _0x19b4c1=_0x41ea06[_0x4c8fb9(0x103)][_0x4c8fb9(0x209)](_0x4a18fe=>{var _0x3261de=_0x4c8fb9;_0x4a18fe[_0x3261de(0x21a)]==_0x5e8527[_0x3261de(0x21a)]&&_0x4a18fe[_0x3261de(0x13b)]==_0x5e8527[_0x3261de(0x13b)]&&(_0x4a18fe[_0x3261de(0x119)]=parseInt(_0x4a18fe[_0x3261de(0x119)])+parseInt(_0x5e8527[_0x3261de(0x1b0)]));});}),await _0x41ea06[_0x52a6af(0x10c)]();const _0x44a0aa=_0x23873c['filter'](_0x81cfa2=>_0x81cfa2['quantity']!=='0'&&_0x81cfa2[_0x52a6af(0x1b0)]!=='');_0x1ddab3[_0x52a6af(0x11e)]=_0x5a3434,_0x1ddab3['customer']=_0x74ed96,_0x1ddab3['date']=_0x208ff0,_0x1ddab3[_0x52a6af(0x166)]=_0x5dd3c7,_0x1ddab3[_0x52a6af(0x219)]=_0x44a0aa,_0x1ddab3['note']=_0x41344d,_0x1ddab3[_0x52a6af(0x14a)]=_0x3a480b;const _0x415ddf=await _0x1ddab3[_0x52a6af(0x10c)](),_0x2b9544=await sales_finished[_0x52a6af(0x213)]({'_id':_0x418939[_0x52a6af(0x16b)]['id']}),_0x3d6b0c=await warehouse[_0x52a6af(0x213)]({'name':_0x5dd3c7,'room':_0x3a480b,'warehouse_category':_0x52a6af(0x18f)});_0x2b9544[_0x52a6af(0x219)][_0x52a6af(0x157)](_0x4decf9=>{var _0x3f4168=_0x52a6af;const _0x3d2915=_0x3d6b0c[_0x3f4168(0x103)][_0x3f4168(0x209)](_0x5b8099=>{var _0x371ed6=_0x3f4168;_0x5b8099[_0x371ed6(0x21a)]==_0x4decf9[_0x371ed6(0x21a)]&&_0x5b8099['bay']==_0x4decf9['bay']&&(_0x5b8099[_0x371ed6(0x119)]=parseInt(_0x5b8099[_0x371ed6(0x119)])-parseInt(_0x4decf9[_0x371ed6(0x1b0)]));});}),console['log'](_0x52a6af(0x1a1),_0x3d6b0c),await _0x3d6b0c[_0x52a6af(0x10c)]();const _0x1144e0=await c_payment_data[_0x52a6af(0x213)]({'invoice':_0x418939[_0x52a6af(0x217)][_0x52a6af(0x11e)]});_0x1144e0[_0x52a6af(0x1a7)]=_0x418939['body'][_0x52a6af(0x1a7)],await _0x1144e0[_0x52a6af(0x10c)](),_0x418939['flash'](_0x52a6af(0x101),_0x52a6af(0x1e9)),_0xe3376d['redirect'](_0x52a6af(0x13d));}catch(_0x231df7){console['log'](_0x231df7);}}),router[a0_0x4e7bd2(0x1ac)](a0_0x4e7bd2(0x100),auth,async(_0x4743af,_0xbf593)=>{var _0x3fff3c=a0_0x4e7bd2;try{const _0x40029b=_0x4743af[_0x3fff3c(0x16b)]['id'],{invoice:_0xce22bd,customer:_0x3af83b,receivable_amount:_0x21fa86,received_amount:_0x35ee4b}=_0x4743af[_0x3fff3c(0x217)],_0x54142e=await sales[_0x3fff3c(0xe6)](_0x40029b);console[_0x3fff3c(0x1df)](_0x54142e);var _0x3c7605=_0x21fa86-_0x35ee4b;console[_0x3fff3c(0x1df)](_0x35ee4b),_0x54142e[_0x3fff3c(0x1b3)]=parseFloat(_0x35ee4b)+parseFloat(_0x54142e['received_amount']),_0x54142e['due_amount']=_0x3c7605,console[_0x3fff3c(0x1df)](_0x54142e);const _0x505cb7=await _0x54142e[_0x3fff3c(0x10c)](),_0x267f45=await c_payment_data[_0x3fff3c(0x213)]({'invoice':_0xce22bd});_0x267f45[_0x3fff3c(0x195)]=_0x3c7605,await _0x267f45[_0x3fff3c(0x10c)]();let _0x30dd7c=new Date(),_0x41cf6f=('0'+_0x30dd7c[_0x3fff3c(0x1f1)]())[_0x3fff3c(0x188)](-0x2),_0x132ae5=('0'+(_0x30dd7c[_0x3fff3c(0x18c)]()+0x1))[_0x3fff3c(0x188)](-0x2),_0x110324=_0x30dd7c[_0x3fff3c(0x203)](),_0x198861=_0x110324+'-'+_0x132ae5+'-'+_0x41cf6f;const _0x11d7d0=new customer_payment({'invoice':_0xce22bd,'date':_0x110324+'-'+_0x132ae5+'-'+_0x41cf6f,'customer':_0x3af83b,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x35ee4b}),_0x4b7959=await _0x11d7d0['save']();_0x4743af['flash'](_0x3fff3c(0x101),'payment\x20successfull'),_0xbf593[_0x3fff3c(0x182)]('/all_sales/view');}catch(_0x3b9ed2){console[_0x3fff3c(0x1df)](_0x3b9ed2);}}),router['get']('/invoice/:id',auth,async(_0xd416f9,_0x487756)=>{var _0x2684da=a0_0x4e7bd2;try{const {username:_0x314f60,email:_0x38159b,role:_0x112059}=_0xd416f9['user'],_0x3db07c=_0xd416f9[_0x2684da(0x155)],_0x268b0a=await profile['findOne']({'email':_0x3db07c[_0x2684da(0x1ab)]}),_0x49871e=await master_shop[_0x2684da(0x1d7)]();console[_0x2684da(0x1df)](_0x2684da(0x1a4),_0x49871e);const _0x3bb7d5=_0xd416f9['params']['id'],_0x45e1f7=await sales[_0x2684da(0xe6)](_0x3bb7d5);console['log'](_0x45e1f7);const _0x44e324=await customer[_0x2684da(0x213)]({'name':_0x45e1f7['customer']});console['log'](_0x44e324);if(_0x49871e[0x0][_0x2684da(0x177)]==_0x2684da(0x1bd)){var _0x4eb9d8=users[_0x2684da(0x1a8)];console['log'](_0x4eb9d8);}else{if(_0x49871e[0x0][_0x2684da(0x177)]=='Hindi')var _0x4eb9d8=users[_0x2684da(0x17c)];else{if(_0x49871e[0x0][_0x2684da(0x177)]==_0x2684da(0x1cd))var _0x4eb9d8=users[_0x2684da(0x1cd)];else{if(_0x49871e[0x0][_0x2684da(0x177)]==_0x2684da(0x20b))var _0x4eb9d8=users[_0x2684da(0x20b)];else{if(_0x49871e[0x0]['language']==_0x2684da(0x1eb))var _0x4eb9d8=users[_0x2684da(0x1eb)];else{if(_0x49871e[0x0][_0x2684da(0x177)]==_0x2684da(0x1f9))var _0x4eb9d8=users[_0x2684da(0xee)];else{if(_0x49871e[0x0][_0x2684da(0x177)]==_0x2684da(0x1a0))var _0x4eb9d8=users[_0x2684da(0x1a0)];else{if(_0x49871e[0x0]['language']==_0x2684da(0x1fd))var _0x4eb9d8=users[_0x2684da(0x145)];}}}}}}}_0x487756[_0x2684da(0x192)](_0x2684da(0x1c1),{'success':_0xd416f9[_0x2684da(0x14b)](_0x2684da(0x101)),'errors':_0xd416f9[_0x2684da(0x14b)](_0x2684da(0x174)),'role':_0x3db07c,'profile':_0x268b0a,'master_shop':_0x49871e,'customers':_0x44e324,'sales':_0x45e1f7,'language':_0x4eb9d8});}catch(_0x249988){console[_0x2684da(0x1df)](_0x249988);}}),router[a0_0x4e7bd2(0x189)](a0_0x4e7bd2(0x1da),auth,async(_0x57b3ef,_0xd30659)=>{var _0x1f44fc=a0_0x4e7bd2;try{const {username:_0x17614c,email:_0x4673bf,role:_0x32ecc1}=_0x57b3ef[_0x1f44fc(0x155)],_0x4da267=_0x57b3ef[_0x1f44fc(0x155)],_0x4100de=await profile[_0x1f44fc(0x213)]({'email':_0x4da267[_0x1f44fc(0x1ab)]}),_0x942399=await master_shop[_0x1f44fc(0x1d7)](),_0x40f522=_0x57b3ef['params']['id'],_0x452315=await sales_finished[_0x1f44fc(0xe6)](_0x40f522),_0x429453=await warehouse[_0x1f44fc(0x172)]([{'$match':{'name':_0x452315[_0x1f44fc(0x166)]}},{'$unwind':_0x1f44fc(0x1c2)},{'$group':{'_id':_0x1f44fc(0x232),'name':{'$first':_0x1f44fc(0x11a)},'product_stock':{'$first':_0x1f44fc(0x131)},'bay':{'$first':_0x1f44fc(0x148)},'bin':{'$first':_0x1f44fc(0x208)},'type':{'$first':_0x1f44fc(0xfd)},'floorlevel':{'$first':_0x1f44fc(0x1f4)},'primary_code':{'$first':_0x1f44fc(0x120)},'secondary_code':{'$first':_0x1f44fc(0xed)},'product_code':{'$first':_0x1f44fc(0x22b)},'storage':{'$first':_0x1f44fc(0x124)},'rack':{'$first':_0x1f44fc(0x15b)},'expiry_date':{'$first':_0x1f44fc(0x1b5)},'production_date':{'$first':_0x1f44fc(0x173)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1f44fc(0x167)},'maxProducts':{'$first':_0x1f44fc(0x10b)},'batch_code':{'$first':_0x1f44fc(0x154)},'maxPerUnit':{'$first':_0x1f44fc(0x164)}}}]),_0x8d1c60=await product[_0x1f44fc(0x1d7)]({}),_0x1fa644=await warehouse[_0x1f44fc(0x172)]([{'$match':{'status':_0x1f44fc(0x142),'warehouse_category':_0x1f44fc(0x18f),'name':{'$ne':'Return\x20Goods','$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x1f44fc(0x1bc),'name':{'$first':_0x1f44fc(0x1bc)}}},{'$sort':{'name':0x1}}]);var _0x36db09=[_0x1f44fc(0x230)];const _0x578d35=await warehouse[_0x1f44fc(0x172)]([{'$match':{'status':'Enabled','name':_0x1f44fc(0x170)}},{'$group':{'_id':_0x1f44fc(0x1bc),'name':{'$first':_0x1f44fc(0x1bc)}}},{'$sort':{'name':0x1}}]);if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x1bd)){var _0x4fe4ce=users[_0x1f44fc(0x1a8)];console['log'](_0x4fe4ce);}else{if(_0x942399[0x0]['language']==_0x1f44fc(0x17c))var _0x4fe4ce=users['Hindi'];else{if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x1cd))var _0x4fe4ce=users['German'];else{if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x20b))var _0x4fe4ce=users[_0x1f44fc(0x20b)];else{if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x1eb))var _0x4fe4ce=users[_0x1f44fc(0x1eb)];else{if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x1f9))var _0x4fe4ce=users['Portuguese'];else{if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x1a0))var _0x4fe4ce=users['Chinese'];else{if(_0x942399[0x0][_0x1f44fc(0x177)]==_0x1f44fc(0x1fd))var _0x4fe4ce=users[_0x1f44fc(0x145)];}}}}}}}_0xd30659[_0x1f44fc(0x192)]('return_sale_finished',{'success':_0x57b3ef[_0x1f44fc(0x14b)](_0x1f44fc(0x101)),'errors':_0x57b3ef['flash'](_0x1f44fc(0x174)),'role':_0x4da267,'profile':_0x4100de,'user':_0x452315,'stock':_0x429453,'master_shop':_0x942399,'unit':_0x8d1c60,'language':_0x4fe4ce,'warehouses':_0x1fa644,'rooms':_0x36db09,'warehouse_QA':_0x578d35});}catch(_0x205dc6){console[_0x1f44fc(0x1df)](_0x205dc6),_0xd30659[_0x1f44fc(0x1af)](0xc8)[_0x1f44fc(0x17d)]({'message':_0x205dc6[_0x1f44fc(0x158)]});}}),router['post'](a0_0x4e7bd2(0x1da),auth,async(_0x241efb,_0x138388)=>{var _0x53d423=a0_0x4e7bd2;if(_0x241efb[_0x53d423(0x217)]['for_categorize']=='QA')try{const {invoice:_0xade0b0,date:_0x2a7cb8,warehouse_name:_0x23f517,product_name:_0x2f2de6,primary_code:_0x52da35,secondary_code:_0x2c4fe6,product_code:_0x2107bf,sales_quantity:_0x2fe02,stocks:_0xd833bb,return_qty:_0x147876,Room_name:_0x50479e,to_warehouse_name_QA:_0x3b53c0,to_Room_name_QA:_0x221bfc,note:_0xe52e0c,for_categorize:_0x118e53,product_name_QA1:_0x1bf964}=_0x241efb[_0x53d423(0x217)];if(typeof _0x1bf964=='string')var _0x10e7ae=[_0x241efb['body']['product_name_QA1']],_0x53440c=[_0x241efb['body'][_0x53d423(0x1db)]],_0x38cd87=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x1e4)]],_0x1a80e1=[_0x241efb['body'][_0x53d423(0x193)]],_0x348dad=[_0x241efb['body'][_0x53d423(0x1f6)]],_0x9ba054=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x1f3)]],_0x3b58c8=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x133)]],_0x322a71=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x132)]],_0x2e7470=[_0x241efb['body'][_0x53d423(0xfb)]],_0xee1f22=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x115)]],_0x320058=[_0x241efb['body'][_0x53d423(0x229)]],_0x15d299=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x1bf)]],_0x38d4bc=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x19c)]],_0x649e94=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x178)]];else var _0x10e7ae=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x1e2)]],_0x53440c=[..._0x241efb['body'][_0x53d423(0x1db)]],_0x38cd87=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x1e4)]],_0x1a80e1=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x193)]],_0x348dad=[..._0x241efb[_0x53d423(0x217)]['sales_quantity_QA']],_0x9ba054=[..._0x241efb['body'][_0x53d423(0x1f3)]],_0x3b58c8=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x133)]],_0x322a71=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x132)]],_0x2e7470=[..._0x241efb['body'][_0x53d423(0xfb)]],_0xee1f22=[..._0x241efb[_0x53d423(0x217)]['batch_code_QA']],_0x320058=[..._0x241efb[_0x53d423(0x217)]['secondary_unit_QA']],_0x15d299=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x1bf)]],_0x38d4bc=[..._0x241efb['body'][_0x53d423(0x19c)]],_0x649e94=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x178)]];const _0x498f29=_0x10e7ae[_0x53d423(0x209)](_0x27a780=>{return _0x27a780={'product_name':_0x27a780};});_0x53440c['forEach']((_0x2ce15d,_0x2687b1)=>{var _0x11fd3a=_0x53d423;_0x498f29[_0x2687b1][_0x11fd3a(0x159)]=_0x2ce15d;}),_0x38cd87[_0x53d423(0x157)]((_0x589adc,_0x2f59c1)=>{var _0x5f29f5=_0x53d423;_0x498f29[_0x2f59c1][_0x5f29f5(0x17f)]=_0x589adc;}),_0x1a80e1[_0x53d423(0x157)]((_0xf01234,_0x50799a)=>{var _0x179ce8=_0x53d423;_0x498f29[_0x50799a][_0x179ce8(0x185)]=_0xf01234;}),_0x348dad['forEach']((_0x1cf8bf,_0x38d38e)=>{var _0x1bb4f1=_0x53d423;_0x498f29[_0x38d38e][_0x1bb4f1(0x207)]=_0x1cf8bf;}),_0x9ba054[_0x53d423(0x157)]((_0x12d048,_0x384135)=>{var _0x1f68fb=_0x53d423;_0x498f29[_0x384135][_0x1f68fb(0x1c0)]=_0x12d048;}),_0x3b58c8[_0x53d423(0x157)]((_0x35cdda,_0x38bd16)=>{var _0x1a0c21=_0x53d423;_0x498f29[_0x38bd16][_0x1a0c21(0x104)]=_0x35cdda;}),_0x322a71[_0x53d423(0x157)]((_0x17cf1d,_0xd567b2)=>{var _0x35b424=_0x53d423;_0x498f29[_0xd567b2][_0x35b424(0x190)]=_0x17cf1d;}),_0x2e7470['forEach']((_0x1e08fb,_0x31c96c)=>{var _0x48dd47=_0x53d423;_0x498f29[_0x31c96c][_0x48dd47(0x1e0)]=_0x1e08fb;}),_0xee1f22[_0x53d423(0x157)]((_0x53eaa2,_0x41fd8e)=>{var _0x24a2c6=_0x53d423;_0x498f29[_0x41fd8e][_0x24a2c6(0x102)]=_0x53eaa2;}),_0x320058[_0x53d423(0x157)]((_0x2571c6,_0x5cdd9e)=>{var _0x565d0c=_0x53d423;_0x498f29[_0x5cdd9e][_0x565d0c(0x11f)]=_0x2571c6;}),_0x15d299[_0x53d423(0x157)]((_0x1557cf,_0x1a7f1a)=>{_0x498f29[_0x1a7f1a]['unit']=_0x1557cf;}),_0x38d4bc[_0x53d423(0x157)]((_0x2d7585,_0x1a55e3)=>{var _0x3dc76e=_0x53d423;_0x498f29[_0x1a55e3][_0x3dc76e(0x161)]=_0x2d7585;}),_0x649e94[_0x53d423(0x157)]((_0x35f434,_0x5e25a7)=>{var _0x4a8b7e=_0x53d423;_0x498f29[_0x5e25a7][_0x4a8b7e(0x1c6)]=_0x35f434;});const _0x366515=await sales_finished[_0x53d423(0x213)]({'invoice':_0xade0b0});_0x366515[_0x53d423(0x113)]=_0x53d423(0x137);const _0x2a1928=await _0x366515[_0x53d423(0x10c)](),_0xa232a0=new sales_return_finished({'invoice':_0xade0b0,'customer':_0x241efb[_0x53d423(0x217)][_0x53d423(0x180)],'date':_0x2a7cb8,'warehouse_name':_0x23f517,'room':_0x50479e,'ToWarehouse':_0x3b53c0,'ToRoom':_0x221bfc,'return_sale_QA':_0x498f29,'note':_0xe52e0c,'warehouse_cat':_0x118e53}),_0x5da7ac=await _0xa232a0[_0x53d423(0x10c)](),_0x1c16f9=await sales_return_finished[_0x53d423(0x213)]({'invoice':_0xade0b0}),_0x481c02=await warehouse[_0x53d423(0x213)]({'name':_0x3b53c0,'room':_0x221bfc});_0x1c16f9[_0x53d423(0x21d)]['forEach'](_0x51ce88=>{var _0x18cc14=_0x53d423,_0x3be9e3=0x0;const _0x43d75c=_0x481c02['product_details'][_0x18cc14(0x209)](_0x36ca96=>{var _0x37f658=_0x18cc14;_0x36ca96[_0x37f658(0x21a)]==_0x51ce88[_0x37f658(0x21a)]&&_0x36ca96[_0x37f658(0x1c6)]==_0x51ce88[_0x37f658(0x1c6)]&&_0x36ca96[_0x37f658(0x161)]==_0x51ce88[_0x37f658(0x161)]&&_0x36ca96[_0x37f658(0x102)]==_0x51ce88[_0x37f658(0x102)]&&(_0x36ca96[_0x37f658(0x119)]=parseInt(_0x36ca96['product_stock'])+parseInt(_0x51ce88[_0x37f658(0x104)]),_0x3be9e3++);});_0x3be9e3=='0'&&(_0x481c02[_0x18cc14(0x103)]=_0x481c02[_0x18cc14(0x103)]['concat']({'product_name':_0x51ce88['product_name'],'product_stock':_0x51ce88[_0x18cc14(0x104)],'primary_code':_0x51ce88[_0x18cc14(0x159)],'secondary_code':_0x51ce88['secondary_code'],'product_code':_0x51ce88[_0x18cc14(0x185)],'batch_code':_0x51ce88[_0x18cc14(0x102)],'maxPerUnit':_0x51ce88[_0x18cc14(0x190)],'production_date':_0x51ce88[_0x18cc14(0x161)],'expiry_date':_0x51ce88['expiry_date'],'secondary_unit':_0x51ce88[_0x18cc14(0x11f)],'unit':_0x51ce88[_0x18cc14(0x198)],'maxProducts':_0x51ce88['maxProducts'],'bay':_0x51ce88[_0x18cc14(0x13b)]}));}),await _0x481c02[_0x53d423(0x10c)]();const _0x48d6ab=new c_payment_data({'invoice':_0xade0b0,'customer':_0x241efb[_0x53d423(0x217)][_0x53d423(0x180)],'reason':_0x53d423(0x20f)});await _0x48d6ab['save']();const _0x4965ee=await master_shop[_0x53d423(0x1d7)](),_0x30e47d=await email_settings[_0x53d423(0x213)](),_0x2bc87f=await customer[_0x53d423(0x213)]({'name':_0x241efb[_0x53d423(0x217)][_0x53d423(0x180)]});_0x4965ee[0x0][_0x53d423(0x127)]==0x1?(right_currency=_0x4965ee[0x0][_0x53d423(0x1b6)],left_currency=''):(right_currency='',left_currency=_0x4965ee[0x0][_0x53d423(0x1b6)]);var _0x5aa1aa=_0x10e7ae,_0x56dcd7=_0x3b58c8,_0x45d114='',_0x2b9a0f;for(_0x2b9a0f in _0x5aa1aa){_0x45d114+=_0x53d423(0x10d)+_0x53d423(0xf7)+_0x5aa1aa[_0x2b9a0f]+_0x53d423(0xf0)+_0x53d423(0xf7)+_0x56dcd7[_0x2b9a0f]+_0x53d423(0xf0)+_0x53d423(0xe9);}console[_0x53d423(0x1df)](_0x53d423(0x18e),_0x45d114);let _0x5276c9=nodemailer[_0x53d423(0x13a)]({'service':'gmail','auth':{'user':_0x30e47d['email'],'pass':_0x30e47d['password']}}),_0x347b43={'from':_0x30e47d[_0x53d423(0x1ab)],'to':_0x2bc87f[_0x53d423(0x1ab)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x4965ee[0x0][_0x53d423(0x122)],'cid':'logo'}],'html':_0x53d423(0x140)+_0x53d423(0x126)+'</head><body>'+_0x53d423(0x196)+_0x53d423(0x215)+_0x53d423(0x196)+_0x53d423(0x134)+_0x53d423(0x18b)+_0x53d423(0x196)+'<h2>\x20'+_0x4965ee[0x0][_0x53d423(0x194)]+_0x53d423(0x130)+_0x53d423(0x18b)+_0x53d423(0x18b)+_0x53d423(0x1e6)+_0x53d423(0x196)+_0x53d423(0x218)+_0x53d423(0x18a)+_0xade0b0+'\x20'+_0x53d423(0x15a)+_0x53d423(0x22e)+_0x2a7cb8+'\x20'+_0x53d423(0xf9)+_0x53d423(0x231)+_0x53d423(0x18b)+_0x53d423(0x1ca)+_0x53d423(0x162)+'<tr>'+_0x53d423(0x1ea)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x53d423(0x183)+_0x53d423(0xe9)+_0x53d423(0x1a2)+_0x53d423(0x210)+'\x20'+_0x45d114+'\x20'+'</tbody>'+_0x53d423(0x11d)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x4965ee[0x0]['site_title']+_0x53d423(0x231)+_0x53d423(0x18b)+_0x53d423(0x18b)+'</body></html>'};_0x5276c9['sendMail'](_0x347b43,function(_0x27694e,_0x220766){var _0x251ef2=_0x53d423;_0x27694e?(console[_0x251ef2(0x1df)](_0x27694e),console[_0x251ef2(0x1df)]('Error\x20Occurs')):console[_0x251ef2(0x1df)](_0x251ef2(0x19e));}),_0x241efb[_0x53d423(0x14b)](_0x53d423(0x101),_0x53d423(0x150)),_0x138388[_0x53d423(0x182)]('/all_sales_finished/view');}catch(_0x4d5674){_0x138388[_0x53d423(0x1af)](0xc8)['json']({'message1':_0x4d5674[_0x53d423(0x158)]});}else{if(_0x241efb[_0x53d423(0x217)][_0x53d423(0x20e)]=='GS')try{const {invoice:_0x27637d,date:_0x4015a0,warehouse_name:_0x4c6110,product_name:_0x5370ab,primary_code:_0xb1e7c,secondary_code:_0x4fdae0,product_code:_0x3baa42,sales_quantity:_0xe07199,stocks:_0x2ebbe8,return_qty:_0xbb71df,Room_name:_0x5994c6,to_warehouse_name:_0x31d9b9,to_Room_name:_0x380dec,note:_0x1a719a,level:_0x4b11d1,isle:_0x333167,pallet:_0x3d3223,for_categorize:_0x515ac0}=_0x241efb[_0x53d423(0x217)];if(typeof _0x5370ab==_0x53d423(0x139))var _0x10e7ae=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x21a)]],_0x53440c=[_0x241efb['body'][_0x53d423(0x159)]],_0x38cd87=[_0x241efb['body']['secondary_code']],_0x1a80e1=[_0x241efb[_0x53d423(0x217)]['product_code']],_0x348dad=[_0x241efb['body']['sales_quantity']],_0x3b58c8=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x104)]],_0x3ee62d=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x13b)]],_0x322a71=[_0x241efb[_0x53d423(0x217)]['maxPerUnit']],_0x2e7470=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x1e0)]],_0xee1f22=[_0x241efb['body']['batch_code']],_0x320058=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x11f)]],_0x15d299=[_0x241efb['body'][_0x53d423(0x198)]],_0x38d4bc=[_0x241efb[_0x53d423(0x217)][_0x53d423(0x161)]],_0x649e94=[_0x241efb[_0x53d423(0x217)]['expiry_date']];else var _0x10e7ae=[..._0x241efb['body'][_0x53d423(0x21a)]],_0x53440c=[..._0x241efb[_0x53d423(0x217)]['primary_code']],_0x38cd87=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x17f)]],_0x1a80e1=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x185)]],_0x348dad=[..._0x241efb['body'][_0x53d423(0x1c9)]],_0x3b58c8=[..._0x241efb['body']['return_qty']],_0x3ee62d=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x13b)]],_0x322a71=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x190)]],_0x2e7470=[..._0x241efb[_0x53d423(0x217)]['maxProducts']],_0xee1f22=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x102)]],_0x320058=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x11f)]],_0x15d299=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x198)]],_0x38d4bc=[..._0x241efb[_0x53d423(0x217)]['production_date']],_0x649e94=[..._0x241efb[_0x53d423(0x217)][_0x53d423(0x1c6)]];const _0x343d42=_0x10e7ae['map'](_0xd98a52=>{return _0xd98a52={'product_name':_0xd98a52};});_0x53440c[_0x53d423(0x157)]((_0x1fa49c,_0x2c9412)=>{var _0x519f9d=_0x53d423;_0x343d42[_0x2c9412][_0x519f9d(0x159)]=_0x1fa49c;}),_0x38cd87[_0x53d423(0x157)]((_0x31dc0b,_0x103b3b)=>{var _0x398a60=_0x53d423;_0x343d42[_0x103b3b][_0x398a60(0x17f)]=_0x31dc0b;}),_0x1a80e1[_0x53d423(0x157)]((_0x1f9607,_0x327232)=>{_0x343d42[_0x327232]['product_code']=_0x1f9607;}),_0x348dad['forEach']((_0x4e5015,_0x5c4efd)=>{var _0x40e118=_0x53d423;_0x343d42[_0x5c4efd][_0x40e118(0x207)]=_0x4e5015;}),_0x3b58c8[_0x53d423(0x157)]((_0x31ed91,_0x18e7dc)=>{var _0x1ab4ec=_0x53d423;_0x343d42[_0x18e7dc][_0x1ab4ec(0x104)]=_0x31ed91;}),_0x3ee62d[_0x53d423(0x157)]((_0x2019e9,_0x194733)=>{var _0x1e952a=_0x53d423;_0x343d42[_0x194733][_0x1e952a(0x13b)]=_0x2019e9;}),_0x322a71[_0x53d423(0x157)]((_0x5cb3ea,_0x30d41c)=>{var _0x37bd96=_0x53d423;_0x343d42[_0x30d41c][_0x37bd96(0x190)]=_0x5cb3ea;}),_0x2e7470[_0x53d423(0x157)]((_0x27b552,_0x2e81f0)=>{var _0x46bb3e=_0x53d423;_0x343d42[_0x2e81f0][_0x46bb3e(0x1e0)]=_0x27b552;}),_0xee1f22[_0x53d423(0x157)]((_0x18e9ad,_0x342986)=>{var _0xe936d2=_0x53d423;_0x343d42[_0x342986][_0xe936d2(0x102)]=_0x18e9ad;}),_0x320058[_0x53d423(0x157)]((_0x57527c,_0x425eb0)=>{var _0x415701=_0x53d423;_0x343d42[_0x425eb0][_0x415701(0x11f)]=_0x57527c;}),_0x15d299[_0x53d423(0x157)]((_0x240c3a,_0x23ab4c)=>{var _0x4fc568=_0x53d423;_0x343d42[_0x23ab4c][_0x4fc568(0x198)]=_0x240c3a;}),_0x38d4bc[_0x53d423(0x157)]((_0x582f15,_0x4df83b)=>{var _0x173eaa=_0x53d423;_0x343d42[_0x4df83b][_0x173eaa(0x161)]=_0x582f15;}),_0x649e94[_0x53d423(0x157)]((_0xec04f5,_0x156925)=>{var _0x39753d=_0x53d423;_0x343d42[_0x156925][_0x39753d(0x1c6)]=_0xec04f5;});var _0x47a765=0x0;_0x343d42[_0x53d423(0x157)](_0x2fc32e=>{var _0x2d3910=_0x53d423;(parseInt(_0x2fc32e['sale_qty'])<parseInt(_0x2fc32e['return_qty'])||parseInt(_0x2fc32e[_0x2d3910(0x1c0)])<parseInt(_0x2fc32e['return_qty'])&&parseInt(_0x2fc32e[_0x2d3910(0x207)])>parseInt(_0x2fc32e[_0x2d3910(0x104)])||parseInt(_0x2fc32e[_0x2d3910(0x104)])==0x0)&&_0x47a765++;});if(_0x47a765!=0x0)return _0x241efb['flash'](_0x53d423(0x174),_0x53d423(0x110)),_0x138388[_0x53d423(0x182)](_0x53d423(0x187));const _0x50424d=await sales_finished[_0x53d423(0x213)]({'invoice':_0x27637d});_0x50424d[_0x53d423(0x113)]=_0x53d423(0x137);const _0x1e9a3f=await _0x50424d[_0x53d423(0x10c)](),_0x25e3a8=new sales_return_finished({'invoice':_0x27637d,'customer':_0x241efb[_0x53d423(0x217)][_0x53d423(0x180)],'date':_0x4015a0,'warehouse_name':_0x4c6110,'room':_0x5994c6,'ToWarehouse':_0x31d9b9,'ToRoom':_0x380dec,'return_sale':_0x343d42,'note':_0x1a719a,'warehouse_cat':_0x515ac0}),_0x2b4768=await _0x25e3a8['save'](),_0x197231=await sales_return_finished[_0x53d423(0x213)]({'invoice':_0x27637d}),_0x4dfbcc=await warehouse[_0x53d423(0x213)]({'name':_0x31d9b9,'room':_0x380dec,'warehouse_category':_0x53d423(0x18f)});_0x197231[_0x53d423(0xfc)][_0x53d423(0x157)](_0x10faa6=>{var _0x513604=_0x53d423,_0x40d4b0=0x0;const _0x41fdc8=_0x4dfbcc[_0x513604(0x103)][_0x513604(0x209)](_0x884148=>{var _0x1e0ee9=_0x513604;_0x884148[_0x1e0ee9(0x21a)]==_0x10faa6[_0x1e0ee9(0x21a)]&&_0x884148[_0x1e0ee9(0x13b)]==_0x10faa6[_0x1e0ee9(0x13b)]&&_0x884148[_0x1e0ee9(0x1c6)]==_0x10faa6['expiry_date']&&_0x884148[_0x1e0ee9(0x161)]==_0x10faa6[_0x1e0ee9(0x161)]&&_0x884148['batch_code']==_0x10faa6[_0x1e0ee9(0x102)]&&(_0x884148['product_stock']=parseInt(_0x884148[_0x1e0ee9(0x119)])+parseInt(_0x10faa6['return_qty']),_0x40d4b0++);});_0x40d4b0=='0'&&(_0x4dfbcc[_0x513604(0x103)]=_0x4dfbcc[_0x513604(0x103)][_0x513604(0x136)]({'product_name':_0x10faa6['product_name'],'product_stock':_0x10faa6[_0x513604(0x104)],'primary_code':_0x10faa6[_0x513604(0x159)],'secondary_code':_0x10faa6[_0x513604(0x17f)],'product_code':_0x10faa6['product_code'],'bay':_0x10faa6[_0x513604(0x13b)],'batch_code':_0x10faa6[_0x513604(0x102)],'maxPerUnit':_0x10faa6['maxPerUnit'],'production_date':_0x10faa6['production_date'],'expiry_date':_0x10faa6[_0x513604(0x1c6)],'secondary_unit':_0x10faa6[_0x513604(0x11f)],'unit':_0x10faa6[_0x513604(0x198)],'maxProducts':_0x10faa6['maxProducts']}));}),await _0x4dfbcc[_0x53d423(0x10c)](),console[_0x53d423(0x1df)](_0x241efb[_0x53d423(0x217)]);const _0x3ad28d=new c_payment_data({'invoice':_0x27637d,'customer':_0x241efb[_0x53d423(0x217)][_0x53d423(0x180)],'reason':_0x53d423(0x20f)});await _0x3ad28d[_0x53d423(0x10c)]();const _0xea80ba=await master_shop[_0x53d423(0x1d7)]();console[_0x53d423(0x1df)](_0x53d423(0x106),_0xea80ba[0x0][_0x53d423(0x122)]);const _0x5223e6=await email_settings[_0x53d423(0x213)](),_0x58fe0a=await customer[_0x53d423(0x213)]({'name':_0x241efb[_0x53d423(0x217)][_0x53d423(0x180)]});console[_0x53d423(0x1df)](_0x53d423(0x22f),_0x58fe0a);_0xea80ba[0x0]['currency_placement']==0x1?(right_currency=_0xea80ba[0x0][_0x53d423(0x1b6)],left_currency=''):(right_currency='',left_currency=_0xea80ba[0x0][_0x53d423(0x1b6)]);var _0x5aa1aa=_0x10e7ae,_0x56dcd7=_0x3b58c8,_0x45d114='',_0x2b9a0f;for(_0x2b9a0f in _0x5aa1aa){_0x45d114+=_0x53d423(0x10d)+_0x53d423(0xf7)+_0x5aa1aa[_0x2b9a0f]+_0x53d423(0xf0)+_0x53d423(0xf7)+_0x56dcd7[_0x2b9a0f]+_0x53d423(0xf0)+_0x53d423(0xe9);}console[_0x53d423(0x1df)](_0x53d423(0x18e),_0x45d114);let _0xf2bb74=nodemailer[_0x53d423(0x13a)]({'service':_0x53d423(0x19f),'auth':{'user':_0x5223e6[_0x53d423(0x1ab)],'pass':_0x5223e6[_0x53d423(0x1ba)]}}),_0x26df3c={'from':_0x5223e6['email'],'to':_0x58fe0a[_0x53d423(0x1ab)],'subject':_0x53d423(0x1d9),'attachments':[{'filename':_0x53d423(0x1de),'path':__dirname+'/../public'+'/upload/'+_0xea80ba[0x0][_0x53d423(0x122)],'cid':_0x53d423(0x160)}],'html':_0x53d423(0x140)+_0x53d423(0x126)+_0x53d423(0x184)+'<div>'+_0x53d423(0x215)+_0x53d423(0x196)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x53d423(0x18b)+'<div>'+_0x53d423(0x169)+_0xea80ba[0x0][_0x53d423(0x194)]+_0x53d423(0x130)+'</div>'+_0x53d423(0x18b)+_0x53d423(0x1e6)+_0x53d423(0x196)+_0x53d423(0x218)+_0x53d423(0x18a)+_0x27637d+'\x20'+_0x53d423(0x15a)+_0x53d423(0x22e)+_0x4015a0+'\x20'+'</span>'+_0x53d423(0x231)+_0x53d423(0x18b)+_0x53d423(0x1ca)+_0x53d423(0x162)+_0x53d423(0x10d)+_0x53d423(0x1ea)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x53d423(0x21f)+_0x53d423(0x183)+_0x53d423(0xe9)+_0x53d423(0x1a2)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x45d114+'\x20'+'</tbody>'+_0x53d423(0x11d)+'<div>'+_0x53d423(0x14d)+'<h5>'+_0xea80ba[0x0][_0x53d423(0x194)]+_0x53d423(0x231)+_0x53d423(0x18b)+'</div>'+'</body></html>'};_0xf2bb74[_0x53d423(0x141)](_0x26df3c,function(_0x210e1e,_0x43259e){var _0x4be615=_0x53d423;_0x210e1e?(console[_0x4be615(0x1df)](_0x210e1e),console[_0x4be615(0x1df)](_0x4be615(0x19b))):console['log'](_0x4be615(0x19e));}),_0x241efb['flash'](_0x53d423(0x101),'sales\x20item\x20return\x20successfull'),_0x138388[_0x53d423(0x182)](_0x53d423(0x13d));}catch(_0x2d8a23){console[_0x53d423(0x1df)](_0x2d8a23),_0x138388[_0x53d423(0x1af)](0xc8)[_0x53d423(0x17d)]({'message1':_0x2d8a23['message']});}}}),router['get'](a0_0x4e7bd2(0x19a),auth,async(_0x36a735,_0x3d003a)=>{var _0x271ac5=a0_0x4e7bd2;try{const {username:_0x5ad2e2,email:_0x59229d,role:_0x1d4f04}=_0x36a735[_0x271ac5(0x155)],_0x4bf218=_0x36a735[_0x271ac5(0x155)],_0x5f4e2d=await profile['findOne']({'email':_0x4bf218[_0x271ac5(0x1ab)]}),_0x23fa90=await master_shop['find']();console['log'](_0x271ac5(0x1dc),_0x23fa90);const _0x4f2c33=_0x36a735[_0x271ac5(0x16b)]['id'],_0x58c7d6=await sales[_0x271ac5(0xe6)](_0x4f2c33);console['log']('barcode\x20user_id',_0x58c7d6);if(_0x23fa90[0x0][_0x271ac5(0x177)]==_0x271ac5(0x1bd))var _0x3e7a44=users[_0x271ac5(0x1a8)];else{if(_0x23fa90[0x0][_0x271ac5(0x177)]==_0x271ac5(0x17c))var _0x3e7a44=users[_0x271ac5(0x17c)];else{if(_0x23fa90[0x0]['language']==_0x271ac5(0x1cd))var _0x3e7a44=users[_0x271ac5(0x1cd)];else{if(_0x23fa90[0x0][_0x271ac5(0x177)]==_0x271ac5(0x20b))var _0x3e7a44=users[_0x271ac5(0x20b)];else{if(_0x23fa90[0x0][_0x271ac5(0x177)]==_0x271ac5(0x1eb))var _0x3e7a44=users[_0x271ac5(0x1eb)];else{if(_0x23fa90[0x0]['language']==_0x271ac5(0x1f9))var _0x3e7a44=users['Portuguese'];else{if(_0x23fa90[0x0]['language']==_0x271ac5(0x1a0))var _0x3e7a44=users[_0x271ac5(0x1a0)];else{if(_0x23fa90[0x0][_0x271ac5(0x177)]==_0x271ac5(0x1fd))var _0x3e7a44=users[_0x271ac5(0x145)];}}}}}}}_0x3d003a[_0x271ac5(0x192)](_0x271ac5(0x1fb),{'success':_0x36a735[_0x271ac5(0x14b)]('success'),'errors':_0x36a735[_0x271ac5(0x14b)]('errors'),'role':_0x4bf218,'profile':_0x5f4e2d,'alldata':_0x58c7d6,'master_shop':_0x23fa90,'language':_0x3e7a44});}catch(_0x727871){console[_0x271ac5(0x1df)](_0x727871);}}),router[a0_0x4e7bd2(0x1ac)]('/barcode_scanner',async(_0x350e5e,_0x2a8bc4)=>{var _0x3a8960=a0_0x4e7bd2;const {product_code:_0x3cd7a5,warehouse_name:_0x5668be,rooms_data:_0x2ba132,Roomslist:_0x1f43a6,sales_category:_0x2be97a}=_0x350e5e[_0x3a8960(0x217)],_0x3a0bd3=_0x1f43a6['split'](','),_0x2324bb=[];async function _0x4860f2(_0x48799e){var _0x55cdae=_0x3a8960;const _0x5afd29=await warehouse[_0x55cdae(0x172)]([{'$match':{'name':_0x5668be,'room':_0x48799e}},{'$unwind':_0x55cdae(0x1c2)},{'$match':{'product_details.primary_code':_0x3cd7a5}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x55cdae(0x11a)},'product_stock':{'$first':_0x55cdae(0x131)},'primary_code':{'$first':_0x55cdae(0x120)},'secondary_code':{'$first':_0x55cdae(0xed)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x55cdae(0x1c7)},'bay':{'$first':_0x55cdae(0x148)},'type':{'$first':_0x55cdae(0xfd)},'pallet':{'$first':_0x55cdae(0x1f4)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x55cdae(0x167)},'storage':{'$first':_0x55cdae(0x124)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x55cdae(0x1b5)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x55cdae(0x164)},'batch_code':{'$first':_0x55cdae(0x154)},'product_cat':{'$first':_0x55cdae(0x233)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x55cdae(0x1a6)},'invoice':{'$first':_0x55cdae(0x228)},'uuid':{'$first':_0x55cdae(0x191)},'gross_price':{'$first':_0x55cdae(0x186)},'sales_category':{'$first':_0x55cdae(0x20d)}}}]),_0x5cd2c2=await warehouse[_0x55cdae(0x172)]([{'$match':{'name':_0x5668be,'room':_0x48799e}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3cd7a5}},{'$group':{'_id':_0x55cdae(0x232),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x55cdae(0x131)},'primary_code':{'$first':_0x55cdae(0x120)},'secondary_code':{'$first':_0x55cdae(0xed)},'product_code':{'$first':_0x55cdae(0x22b)},'level':{'$first':_0x55cdae(0x148)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x55cdae(0xfd)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x55cdae(0x14f)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x55cdae(0x124)},'rack':{'$first':_0x55cdae(0x15b)},'expiry_date':{'$first':_0x55cdae(0x1b5)},'production_date':{'$first':_0x55cdae(0x173)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x55cdae(0x154)},'product_cat':{'$first':_0x55cdae(0x233)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x55cdae(0x1a6)},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0x55cdae(0x191)},'gross_price':{'$first':_0x55cdae(0x186)},'sales_category':{'$first':_0x55cdae(0x20d)}}}]);if(_0x5afd29[_0x55cdae(0x1b1)]>0x0)_0x2324bb[_0x55cdae(0x20c)](_0x5afd29);else _0x5cd2c2[_0x55cdae(0x1b1)]>0x0&&_0x2324bb['push'](_0x5cd2c2);}const _0x3ada4b=_0x3a0bd3['map'](_0x528c3d=>_0x4860f2(_0x528c3d));await Promise[_0x3a8960(0x181)](_0x3ada4b),_0x2a8bc4['json'](_0x2324bb);}),router[a0_0x4e7bd2(0x1ac)](a0_0x4e7bd2(0x16e),async(_0x4c4d10,_0x4c313a)=>{var _0x5b37c9=a0_0x4e7bd2;const {product_code:_0x5bfd7e,warehouse_name:_0x23a928,rooms_data:_0x3c6144,Roomslist:_0x2a3c85,sales_category:_0x1e7ceb}=_0x4c4d10['body'],_0x126873=_0x2a3c85[_0x5b37c9(0x13e)](','),_0x57f731=[];async function _0x13fffa(_0xb6ad76){var _0x597849=_0x5b37c9;const _0x258b62=await warehouse[_0x597849(0x172)]([{'$match':{'name':_0x23a928,'room':_0xb6ad76}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x5bfd7e,'product_details.sales_category':_0x1e7ceb,'product_details.type_products':'log'}},{'$group':{'_id':_0x597849(0x232),'name':{'$first':_0x597849(0x11a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x597849(0xed)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x597849(0x1c7)},'bay':{'$first':_0x597849(0x148)},'type':{'$first':_0x597849(0xfd)},'pallet':{'$first':_0x597849(0x1f4)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x597849(0x167)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x597849(0x15b)},'expiry_date':{'$first':_0x597849(0x1b5)},'production_date':{'$first':_0x597849(0x173)},'maxPerUnit':{'$first':_0x597849(0x164)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x597849(0x233)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x597849(0x1a6)},'invoice':{'$first':_0x597849(0x228)},'uuid':{'$first':_0x597849(0x191)},'gross_price':{'$first':_0x597849(0x186)},'sales_category':{'$first':_0x597849(0x20d)},'type_products':{'$first':_0x597849(0x1ec)}}}]);console['log']('log'+_0x597849(0x121)+_0x5bfd7e+_0x597849(0x121)+_0x1e7ceb);const _0x39964a=await warehouse[_0x597849(0x172)]([{'$match':{'name':_0x23a928,'room':_0xb6ad76}},{'$unwind':_0x597849(0x1c2)},{'$match':{'product_details.secondary_code':_0x5bfd7e,'product_details.sales_category':_0x1e7ceb,'product_details.type_products':_0x597849(0x1df)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x597849(0x131)},'primary_code':{'$first':_0x597849(0x120)},'secondary_code':{'$first':_0x597849(0xed)},'product_code':{'$first':_0x597849(0x22b)},'level':{'$first':_0x597849(0x148)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x597849(0xfd)},'pallet':{'$first':_0x597849(0x1f4)},'unit':{'$first':_0x597849(0x14f)},'secondary_unit':{'$first':_0x597849(0x167)},'storage':{'$first':_0x597849(0x124)},'rack':{'$first':_0x597849(0x15b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x597849(0x173)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x597849(0x154)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x597849(0x228)},'uuid':{'$first':_0x597849(0x191)},'gross_price':{'$first':_0x597849(0x186)},'sales_category':{'$first':_0x597849(0x20d)},'type_products':{'$first':'$product_details.type_products'}}}]);if(_0x258b62[_0x597849(0x1b1)]>0x0)_0x57f731['push'](_0x258b62);else _0x39964a['length']>0x0&&_0x57f731[_0x597849(0x20c)](_0x39964a);}const _0x374112=_0x126873['map'](_0x24de12=>_0x13fffa(_0x24de12));await Promise[_0x5b37c9(0x181)](_0x374112),_0x4c313a['json'](_0x57f731);}),router['post']('/barcode_scanner_auto_data',async(_0x59075f,_0x1b39df)=>{var _0x345732=a0_0x4e7bd2;try{const {prduct_code:_0x717ff6,warehouse_data:_0x35d505,qty_req:_0xc5fa65}=_0x59075f[_0x345732(0x217)];let _0x23d31a=_0x717ff6[_0x345732(0x13e)]('~'),_0x41406a=_0xc5fa65[_0x345732(0x13e)]('~'),_0x3d39e8=[],_0x1fc7b7=0x0;for(let _0x4022e9=0x0;_0x4022e9<=_0x23d31a[_0x345732(0x1b1)]-0x1;_0x4022e9++){const _0x36f5af=_0x23d31a[_0x4022e9],_0x3e1b88=_0x41406a[_0x4022e9],_0x35c313=await warehouse[_0x345732(0x172)]([{'$match':{'name':_0x35d505}},{'$unwind':_0x345732(0x1c2)},{'$match':{'product_details.product_code':_0x36f5af,'product_details.isAvailable':_0x345732(0xe8),'product_details.isUsed':_0x345732(0xf5)}},{'$sort':{'product_details.date_received':0x1,'product_details.level':-0x1,'product_details.bay':-0x1}},{'$group':{'_id':_0x345732(0x232),'name':{'$first':_0x345732(0x11a)},'product_stock':{'$first':_0x345732(0x131)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x345732(0x22b)},'level':{'$first':_0x345732(0x1c7)},'bay':{'$first':_0x345732(0x148)},'type':{'$first':_0x345732(0xfd)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x345732(0x14f)},'secondary_unit':{'$first':_0x345732(0x167)},'storage':{'$first':_0x345732(0x124)},'rack':{'$first':_0x345732(0x15b)},'expiry_date':{'$first':_0x345732(0x1b5)},'production_date':{'$first':_0x345732(0x173)},'maxPerUnit':{'$first':_0x345732(0x164)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x345732(0x1a6)},'invoice':{'$first':_0x345732(0x228)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x345732(0x20d)},'date_received':{'$first':_0x345732(0x1e3)},'warehouse_id':{'$first':_0x345732(0x12f)}}}]),_0x446f3c=_0x35c313[_0x345732(0x17b)]((_0x5943bf,_0x1cb09c)=>new Date(_0x5943bf[_0x345732(0x197)])-new Date(_0x1cb09c[_0x345732(0x197)]));let _0xe31318=_0x3e1b88;for(let _0x22602e=0x0;_0x22602e<=_0x446f3c[_0x345732(0x1b1)]-0x1&&_0xe31318>0x0;_0x22602e++){const _0x21bda3=_0x446f3c[_0x22602e];if(_0x21bda3[_0x345732(0x185)]==_0x36f5af){_0x3d39e8[_0x1fc7b7]={};const _0x32508b=parseInt(_0x21bda3[_0x345732(0x119)]),_0x44c525=0x0;let _0x1c4c7c=_0x32508b-_0x44c525,_0x43cbdd=Math[_0x345732(0x18d)](_0xe31318,_0x1c4c7c);console['log'](_0x345732(0x146)+_0x43cbdd+_0x345732(0x1fc)+_0x35d505+_0x345732(0x20a)+_0x21bda3[_0x345732(0x1f2)]+_0x345732(0x10a)+(_0x21bda3[_0x345732(0xe7)]+_0x21bda3[_0x345732(0x13b)])+'\x20Date:\x20'+_0x21bda3['date_received']+_0x345732(0x1e8)+_0x21bda3['name']),_0x3d39e8[_0x1fc7b7][_0x345732(0x226)]=_0x21bda3[_0x345732(0x225)]+'~'+_0x21bda3[_0x345732(0x21c)]+'~'+_0x43cbdd,_0x3d39e8[_0x1fc7b7][_0x345732(0x21a)]=_0x21bda3[_0x345732(0x1a5)],_0x3d39e8[_0x1fc7b7][_0x345732(0x185)]=_0x21bda3['product_code'],_0x3d39e8[_0x1fc7b7][_0x345732(0x1e7)]=_0x21bda3[_0x345732(0x1e7)],_0x3d39e8[_0x1fc7b7][_0x345732(0x105)]=_0x21bda3[_0x345732(0x105)],_0x3d39e8[_0x1fc7b7][_0x345732(0x1fe)]=_0x21bda3[_0x345732(0x1fe)],_0x3d39e8[_0x1fc7b7][_0x345732(0x214)]=_0x21bda3[_0x345732(0x214)],_0x3d39e8[_0x1fc7b7]['quantity']=_0x43cbdd,_0x3d39e8[_0x1fc7b7][_0x345732(0x198)]=_0x21bda3['unit'],_0x3d39e8[_0x1fc7b7]['secondary_unit']=_0x21bda3[_0x345732(0x11f)],_0x3d39e8[_0x1fc7b7][_0x345732(0x159)]=_0x21bda3[_0x345732(0x159)],_0x3d39e8[_0x1fc7b7]['secondary_code']=_0x21bda3['secondary_code'],_0x3d39e8[_0x1fc7b7]['maxStocks']=_0x21bda3['maxStocks'],_0x3d39e8[_0x1fc7b7][_0x345732(0x102)]=_0x21bda3[_0x345732(0x102)],_0x3d39e8[_0x1fc7b7][_0x345732(0x1c6)]=_0x21bda3[_0x345732(0x1c6)],_0x3d39e8[_0x1fc7b7][_0x345732(0x161)]=_0x21bda3[_0x345732(0x161)],_0x3d39e8[_0x1fc7b7][_0x345732(0x144)]=_0x21bda3['maxperunit'],_0x3d39e8[_0x1fc7b7]['product_cat']=_0x21bda3[_0x345732(0x1d2)],_0x3d39e8[_0x1fc7b7][_0x345732(0x11e)]=_0x21bda3[_0x345732(0x11e)],_0x3d39e8[_0x1fc7b7][_0x345732(0x153)]=_0x21bda3[_0x345732(0x153)],_0x3d39e8[_0x1fc7b7][_0x345732(0xff)]=_0x21bda3[_0x345732(0x1f2)],_0x3d39e8[_0x1fc7b7][_0x345732(0xe7)]=_0x21bda3[_0x345732(0xe7)],_0x3d39e8[_0x1fc7b7]['bay']=_0x21bda3[_0x345732(0x13b)],_0x3d39e8[_0x1fc7b7]['status']=_0x345732(0xe8),console[_0x345732(0x1df)]('1',_0x1fc7b7),_0xe31318-=_0x43cbdd,_0x1fc7b7++;if(_0xe31318<=0x0)break;}}if(_0xe31318>0x0){var _0x5da47c=await product[_0x345732(0x213)]({'product_code':_0x36f5af});console[_0x345732(0x1df)]('2',_0x1fc7b7),_0x3d39e8[_0x1fc7b7]={},_0x3d39e8[_0x1fc7b7]['product_name']=_0x5da47c[_0x345732(0x1a5)],_0x3d39e8[_0x1fc7b7][_0x345732(0x185)]=_0x36f5af,_0x3d39e8[_0x1fc7b7][_0x345732(0x1e7)]=_0x5da47c['_id'][_0x345732(0x129)](),_0x3d39e8[_0x1fc7b7][_0x345732(0x1b0)]=_0xe31318,_0x3d39e8[_0x1fc7b7][_0x345732(0x10f)]=_0x5da47c['unit'],_0x3d39e8[_0x1fc7b7][_0x345732(0x11f)]=_0x5da47c[_0x345732(0x13f)],_0x3d39e8[_0x1fc7b7]['primary_code']=_0x5da47c[_0x345732(0x159)],_0x3d39e8[_0x1fc7b7]['secondary_code']=_0x5da47c['secondary_code'],_0x3d39e8[_0x1fc7b7][_0x345732(0x16c)]=_0x5da47c[_0x345732(0x16c)],_0x3d39e8[_0x1fc7b7][_0x345732(0x144)]=_0x5da47c['maxProdPerUnit'],_0x3d39e8[_0x1fc7b7][_0x345732(0x153)]=_0x5da47c[_0x345732(0x153)],_0x3d39e8[_0x1fc7b7]['status']=_0x345732(0xf5),console[_0x345732(0x1df)]('There\x20is\x20'+_0xe31318+_0x345732(0x212)+_0x1fc7b7+'\x20<>\x20'+_0x36f5af),_0x1fc7b7++;}}_0x1b39df['json'](_0x3d39e8);}catch(_0x50a862){console[_0x345732(0x1df)](_0x50a862);}}),router[a0_0x4e7bd2(0x1ac)](a0_0x4e7bd2(0x12c),async(_0x35bd73,_0x26d69c)=>{var _0x1a6c6c=a0_0x4e7bd2;const {product_code:_0x3dd114}=_0x35bd73[_0x1a6c6c(0x217)];var _0x417cb0;const _0x342a68=await product[_0x1a6c6c(0x172)]([{'$match':{'primary_code':_0x3dd114}},{'$group':{'_id':_0x1a6c6c(0x12f),'name':{'$first':'$name'},'category':{'$first':_0x1a6c6c(0x1b7)},'brand':{'$first':_0x1a6c6c(0x1b2)},'unit':{'$first':_0x1a6c6c(0x1d8)},'alertquantity':{'$first':_0x1a6c6c(0x15e)},'product_code':{'$first':_0x1a6c6c(0x1cb)},'primary_code':{'$first':_0x1a6c6c(0x147)},'secondary_code':{'$first':_0x1a6c6c(0x222)},'maxStocks':{'$first':_0x1a6c6c(0xeb)},'maxProdPerUnit':{'$first':_0x1a6c6c(0x171)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0x1a6c6c(0x165)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x4716fd=await product[_0x1a6c6c(0x172)]([{'$match':{'secondary_code':_0x3dd114}},{'$group':{'_id':_0x1a6c6c(0x12f),'name':{'$first':_0x1a6c6c(0x1bc)},'category':{'$first':_0x1a6c6c(0x1b7)},'brand':{'$first':_0x1a6c6c(0x1b2)},'unit':{'$first':_0x1a6c6c(0x1d8)},'alertquantity':{'$first':_0x1a6c6c(0x15e)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1a6c6c(0x147)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1a6c6c(0x171)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1a6c6c(0x17a)},'gross_price':{'$first':_0x1a6c6c(0x1d1)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x342a68[_0x1a6c6c(0x1b1)]>0x0)_0x417cb0=_0x342a68;else _0x4716fd[_0x1a6c6c(0x1b1)]>0x0&&(_0x417cb0=_0x4716fd);_0x26d69c['json'](_0x417cb0);}),router[a0_0x4e7bd2(0x1ac)](a0_0x4e7bd2(0x1a3),async(_0xcdd75b,_0x21b500)=>{var _0x123603=a0_0x4e7bd2;try{const {group_id:_0x32b1d3,DRSI:_0x204cbf,dateofreq:_0x2feb57,PO_number:_0x21b223,date:_0x27f139,warehouse_name:_0x24430c,typevehicle:_0xfef50d,deliverydate:_0x303ad4,driver:_0x340025,plate:_0xa66b80,van:_0x11cb55,TSU:_0x52319f,actual_delivery_date:_0xfafd13,TFU:_0x33d6d2,pull_out_date:_0x5626a0,sales:_0xe9c368,Customer_data:_0x176064,note:_0x36aa73}=_0xcdd75b['body'],_0x2d4629=mongoose['Types'][_0x123603(0x1cc)];let _0x3dee32=[];const _0x313607=new invoice_for_outgoing();await _0x313607['save']();const _0x1ea115=_0x123603(0x163)+_0x313607[_0x123603(0x19d)][_0x123603(0x112)]()['padStart'](0x8,'0');if(typeof _0x32b1d3==_0x123603(0x139)){let _0x5315eb=_0x32b1d3[_0x123603(0x13e)]('~');var _0x33ad25=_0x2d4629(_0x5315eb[0x0]),_0x59306c=_0x2d4629(_0x5315eb[0x1]),_0x24ed2e=_0x5315eb[0x2];let _0x264634=0x0;const _0x4ed074=await warehouse[_0x123603(0x172)]([{'$match':{'_id':_0x33ad25}},{'$unwind':_0x123603(0x1c2)},{'$match':{'product_details._id':_0x59306c}}]);await warehouse[_0x123603(0x125)]({'_id':_0x2d4629(_0x33ad25),'product_details._id':_0x2d4629(_0x59306c)},{'$set':{'product_details.$.isUsed':'true'}}),_0x3dee32[_0x264634]={};for(let _0x35d824=0x0;_0x35d824<=_0x4ed074[_0x123603(0x1b1)]-0x1;_0x35d824++){const _0x4cbc5f=_0x4ed074[_0x35d824];console[_0x123603(0x1df)](_0x4cbc5f),_0x3dee32[_0x264634][_0x123603(0x205)]=_0x4cbc5f[_0x123603(0x1a5)],_0x3dee32[_0x264634][_0x123603(0x1e7)]=_0x4cbc5f[_0x123603(0x103)]['product_id'],_0x3dee32[_0x264634][_0x123603(0x21a)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x21a)],_0x3dee32[_0x264634][_0x123603(0x185)]=_0x4cbc5f['product_details'][_0x123603(0x185)],_0x3dee32[_0x264634][_0x123603(0x119)]=_0x24ed2e,_0x3dee32[_0x264634][_0x123603(0x1b0)]=_0x24ed2e,_0x3dee32[_0x264634][_0x123603(0x198)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x198)],_0x3dee32[_0x264634][_0x123603(0x11f)]=_0x4cbc5f[_0x123603(0x103)]['secondary_unit'],_0x3dee32[_0x264634]['level']=_0x4cbc5f[_0x123603(0x103)][_0x123603(0xe7)],_0x3dee32[_0x264634]['bay']=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x13b)],_0x3dee32[_0x264634]['primary_code']=_0x4cbc5f['product_details'][_0x123603(0x159)],_0x3dee32[_0x264634][_0x123603(0x17f)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x17f)],_0x3dee32[_0x264634][_0x123603(0x16c)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x16c)],_0x3dee32[_0x264634]['batch_code']=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x102)],_0x3dee32[_0x264634]['expiry_date']=_0x4cbc5f['product_details'][_0x123603(0x1c6)],_0x3dee32[_0x264634][_0x123603(0x161)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x161)],_0x3dee32[_0x264634][_0x123603(0x144)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x144)],_0x3dee32[_0x264634][_0x123603(0x1d2)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x1d2)],_0x3dee32[_0x264634][_0x123603(0xff)]=_0x4cbc5f[_0x123603(0x14a)],_0x3dee32[_0x264634][_0x123603(0x11e)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x11e)],_0x3dee32[_0x264634][_0x123603(0x214)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x214)],_0x3dee32[_0x264634]['gross_price']=_0x4cbc5f['product_details']['gross_price'],_0x3dee32[_0x264634][_0x123603(0x1fe)]=_0x4cbc5f['product_details'][_0x123603(0x1d5)],_0x3dee32[_0x264634][_0x123603(0x105)]=_0x4cbc5f[_0x123603(0x103)][_0x123603(0x105)],_0x3dee32[_0x264634][_0x123603(0x1c4)]=_0x4cbc5f['product_details'][_0x123603(0x1d5)],_0x3dee32[_0x264634][_0x123603(0x225)]=_0x4cbc5f[_0x123603(0x21c)][_0x123603(0x129)](),_0x3dee32[_0x264634][_0x123603(0x1bb)]=_0x4cbc5f[_0x123603(0x103)]['_id'][_0x123603(0x129)](),_0x3dee32[_0x264634]['data_type']=_0x123603(0x143),_0x3dee32[_0x264634]['agent_id']=_0x4cbc5f['product_details']['sales'];}_0x3dee32[_0x264634][_0x123603(0x116)]=_0x1ea115;}else for(let _0x443510=0x0;_0x443510<=_0x32b1d3['length']-0x1;_0x443510++){const _0x23a985=_0x32b1d3[_0x443510];let _0x6a7bba=_0x23a985[_0x123603(0x13e)]('~');console[_0x123603(0x1df)](_0x6a7bba);var _0x33ad25=_0x2d4629(_0x6a7bba[0x0]),_0x59306c=_0x2d4629(_0x6a7bba[0x1]),_0x24ed2e=_0x6a7bba[0x2];const _0x34359e=await warehouse[_0x123603(0x172)]([{'$match':{'_id':_0x33ad25}},{'$unwind':'$product_details'},{'$match':{'product_details._id':_0x59306c}}]);await warehouse[_0x123603(0x125)]({'_id':_0x2d4629(_0x33ad25),'product_details._id':_0x2d4629(_0x59306c)},{'$set':{'product_details.$.isUsed':_0x123603(0xe8)}}),_0x3dee32[_0x443510]={};for(let _0x54eb9b=0x0;_0x54eb9b<=_0x34359e[_0x123603(0x1b1)]-0x1;_0x54eb9b++){const _0x1dc342=_0x34359e[_0x54eb9b];_0x3dee32[_0x443510][_0x123603(0x205)]=_0x1dc342[_0x123603(0x1a5)],_0x3dee32[_0x443510][_0x123603(0x1e7)]=_0x1dc342[_0x123603(0x103)]['product_id'],_0x3dee32[_0x443510][_0x123603(0x21a)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x21a)],_0x3dee32[_0x443510][_0x123603(0x185)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x185)],_0x3dee32[_0x443510]['product_stock']=_0x24ed2e,_0x3dee32[_0x443510][_0x123603(0x1b0)]=_0x24ed2e,_0x3dee32[_0x443510]['unit']=_0x1dc342[_0x123603(0x103)][_0x123603(0x198)],_0x3dee32[_0x443510][_0x123603(0x11f)]=_0x1dc342['product_details'][_0x123603(0x11f)],_0x3dee32[_0x443510]['level']=_0x1dc342[_0x123603(0x103)][_0x123603(0xe7)],_0x3dee32[_0x443510][_0x123603(0x13b)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x13b)],_0x3dee32[_0x443510][_0x123603(0x159)]=_0x1dc342['product_details'][_0x123603(0x159)],_0x3dee32[_0x443510][_0x123603(0x17f)]=_0x1dc342['product_details']['secondary_code'],_0x3dee32[_0x443510][_0x123603(0x16c)]=_0x1dc342['product_details'][_0x123603(0x16c)],_0x3dee32[_0x443510]['batch_code']=_0x1dc342['product_details'][_0x123603(0x102)],_0x3dee32[_0x443510][_0x123603(0x1c6)]=_0x1dc342[_0x123603(0x103)]['expiry_date'],_0x3dee32[_0x443510][_0x123603(0x161)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x161)],_0x3dee32[_0x443510][_0x123603(0x144)]=_0x1dc342[_0x123603(0x103)]['maxperunit'],_0x3dee32[_0x443510][_0x123603(0x1d2)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x1d2)],_0x3dee32[_0x443510][_0x123603(0xff)]=_0x1dc342[_0x123603(0x14a)],_0x3dee32[_0x443510][_0x123603(0x11e)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x11e)],_0x3dee32[_0x443510][_0x123603(0x214)]=_0x1dc342['product_details']['uuid'],_0x3dee32[_0x443510]['gross_price']=_0x1dc342[_0x123603(0x103)][_0x123603(0x153)],_0x3dee32[_0x443510][_0x123603(0x1fe)]=_0x1dc342[_0x123603(0x103)][_0x123603(0x1d5)],_0x3dee32[_0x443510]['date_recieved']=_0x1dc342['product_details']['date_recieved'],_0x3dee32[_0x443510][_0x123603(0x1c4)]=_0x1dc342['product_details'][_0x123603(0x1d5)],_0x3dee32[_0x443510][_0x123603(0x225)]=_0x1dc342['_id'][_0x123603(0x129)](),_0x3dee32[_0x443510]['warehouse_id_detl']=_0x1dc342[_0x123603(0x103)]['_id'][_0x123603(0x129)](),_0x3dee32[_0x443510]['data_type']='out',_0x3dee32[_0x443510]['agent_id']=_0x1dc342['product_details']['sales'];}_0x3dee32[_0x443510]['outgoiug_inv']=_0x1ea115;}for(let _0x35b146=0x0;_0x35b146<=_0x3dee32[_0x123603(0x1b1)]-0x1;_0x35b146++){const _0x23537d=_0x3dee32[_0x35b146],_0x3222ee=new warehouse_temporary(_0x23537d);await _0x3222ee[_0x123603(0x10c)]();}const _0x5925f8=new sales_finished({'invoice':_0x1ea115,'sales_data':_0xe9c368,'customer':_0x176064,'date':_0x27f139,'warehouse_name':_0x24430c,'sale_product':_0x3dee32,'note':_0x36aa73,'finalize':'False','dateofreq':_0x2feb57,'PO_number':_0x21b223,'typevehicle':_0xfef50d,'deliverydate':_0x303ad4,'driver':_0x340025,'plate':_0xa66b80,'van':_0x11cb55,'DRSI':_0x204cbf,'TSU':_0x52319f,'TFU':_0x33d6d2,'pullout_date':_0x5626a0,'actualdelivery_date':_0xfafd13,'typeOfProducts':'own'}),_0x5ad63d=await _0x5925f8[_0x123603(0x10c)]();_0xcdd75b[_0x123603(0x14b)](_0x123603(0x101),'Sales\x20Add\x20successfully'),_0x21b500['redirect'](_0x123603(0x175)+_0x5ad63d[_0x123603(0x21c)]);}catch(_0x23eb59){console[_0x123603(0x1df)](_0x23eb59);}}),module[a0_0x4e7bd2(0x114)]=router;