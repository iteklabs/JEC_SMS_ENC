var a0_0x308003=a0_0x52b8;(function(_0x31f62f,_0x523e){var _0x30dd0a=a0_0x52b8,_0x3a5855=_0x31f62f();while(!![]){try{var _0x4b26a7=-parseInt(_0x30dd0a(0xef))/0x1+-parseInt(_0x30dd0a(0xf1))/0x2+parseInt(_0x30dd0a(0x101))/0x3*(parseInt(_0x30dd0a(0xcb))/0x4)+parseInt(_0x30dd0a(0xea))/0x5+parseInt(_0x30dd0a(0x1b5))/0x6*(parseInt(_0x30dd0a(0x142))/0x7)+-parseInt(_0x30dd0a(0x16e))/0x8+-parseInt(_0x30dd0a(0x195))/0x9*(parseInt(_0x30dd0a(0x1be))/0xa);if(_0x4b26a7===_0x523e)break;else _0x3a5855['push'](_0x3a5855['shift']());}catch(_0x5623cd){_0x3a5855['push'](_0x3a5855['shift']());}}}(a0_0x1958,0x7cd9f));const express=require(a0_0x308003(0xfe)),app=express(),router=express['Router'](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require(a0_0x308003(0xb6)),auth=require(a0_0x308003(0x1f1)),nodemailer=require(a0_0x308003(0x178)),users=require(a0_0x308003(0x11d)),mongoose=require(a0_0x308003(0x174));function a0_0x52b8(_0x387371,_0x2a4010){var _0x1958e1=a0_0x1958();return a0_0x52b8=function(_0x52b898,_0x47660b){_0x52b898=_0x52b898-0xa5;var _0x5a0cc4=_0x1958e1[_0x52b898];return _0x5a0cc4;},a0_0x52b8(_0x387371,_0x2a4010);}function a0_0x1958(){var _0x529269=['sales\x20item\x20return\x20successfull','post','due_amount','date','finalize','maxStocks','sort','2517850alZIhR','match','/invoice/:id','success','$product_details.unit','<hr\x20class=\x22my-3\x22>','then','updateOne','Sale\x20Return','Received\x20Payment\x20For\x20Sale','string','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Portuguese\x20(BR)','customer_data','email','primary_unit','message','invoice','abs','out','Enabled','stock','secondary_unit','product_name','prod_cat','/view/add_sale/product','suppliers','get','Logo.png','/view_log','product_details','received_amount','purchases_data','$product_code','batch_code_QA','/all_sales_finished/view','$primary_code','sale_qty','all_sales_barcode','Types','log','$product_details.product_stock','maxPerUnit_QA','$product_details.level','English\x20(US)','$product_details.floorlevel','$product_details.bin','amount','params','invoice_init','../middleware/auth','true','primary_code_QA','prod_invoice','German','product_cat','primary_code','maxProducts','return_sale_QA','Distributing\x20','\x20<>\x20','$product_details.invoice','$product_details.batch_code','adjust_qty',',\x20room:\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$maxProdPerUnit','bay','There\x27s\x20a\x20error\x20in\x20this\x20transaction','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20','getMonth','filter','$room','$secondary_code','$name','$warehouse_name','return_qty_QA','../models/all_models','<!DOCTYPE\x20html>','errors','$product_details.bay','standard_unit','getDate','prod_code','level','$customers_docs','sales_id','sendMail','$product_details.uuid','warehouse_id_detl','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','user','$return_data','product_code_QA','maxperunit','\x20&&\x20','map','production_date','12xaFJRT','quantity','return_data','There\x20is\x20','unit','<html><head><title></title>','slice','/barcode_scanner_auto_data','product_id','concat','$product_details.primary_code','room','$product_details.maxPerUnit','<div>','</span>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</table>','Sales\x20Update\x20successfully','payment\x20successfull','/preview/:id','$product_details.product_code','$product_details.maxProducts','sales_quantity','date_recieved','save','</body></html>','Email\x20sent\x20successfully','max_per_unit','$_id','valueOf','barcode\x20Product\x20master','4037835SIJyzD','</head><body>','createTransport','$sale_product','$product_details.type_products','247494ekOvJl','floor','1499108heWVzo','product_list','<tr>','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$customer','length','_id','maxPerUnit','$maxStocks','$alertquantity','gmail','<span\x20style=\x22float:\x20right;\x22>','express','/process/view','warehouse','763986WoTexc','sale_product','findOne','sales_quantity_QA','random','$product_details.expiry_date','redirect','English','$product_details','Chinese','add_sales_finished','Portuguese','image','exports','maxProducts_QA','status','find','room_name','$note','$product_details.secondary_code','/all_sales_finished/preview/','$product_details.type','$product_details.gross_price','roomNamed','$product_details.secondary_unit','batch_code','currency_placement','padStart','../public/language/languages.json','$sales_category','$product_details.product_name','OUT-','/barcode_scanner','outgoing_invoice','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','carton','</thead>','site_title','secondary_code_QA','warehouse_name','production_date_QA','$category','$product_details.sales_category','currency','product_stock','Arabic','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_code','</h5>','split','stock_data','body','\x20Date:\x20','$product.product_name','date_received','maxProdPerUnit','product_name_QA1','for_categorize','/barcode_scanner_logs','gross_price','/view/add_sales_logs','French','<tbody\x20style=\x22text-align:\x20center;\x22>','2667fzHTCL','$finalize','second_unit','$product_details._id','data_type','catch','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','return_qty','OUTF-','Sale\x20Return\x20Mail','staff','/view','back','<h5>','</tbody>','all_sales_finished','/../public','name','min','render','ObjectId','Return\x20Rooms','/upload/','Hindi','$product_details.production_date','role',',\x20Location:\x20','$sale_product.type','expiry_date_QA','$secondary_unit','password','sales_category','$product_details.rack','level2','Return\x20Goods','LOG-OUT-','final','outgoiug_inv','\x20Order\x20Number\x20:\x20','\x20==\x20','$date','False','uuid','/give_payment/:id','1240376LDSMcO','forEach','Arabic\x20(ae)','$invoice','$sale_product.quantity','language','mongoose','$gross_price','secondary_unit_QA','RoomAssigned','nodemailer','product_date','findById','/view/add_sales','Finished\x20Goods','</tr>','/barcode/:id','$product_details.product_cat','edit_sales_finished_view','logo','$product_details.storage','push','all','edit_sales_finished','/view/:id','id_transaction_from','Spanish','Error\x20Occurs','product_data','group_ids','Quality\x20Inspection','/picking_list/pdf/','unit_QA','warehouse_id','$brand','date_data','$unit','Ambient','</div>','18hMxmjy','secondary_code','getFullYear','customer','foreach\x20newproduct','add_sales_finished_logs','expiry_date','stocks_QA','<strong>\x20Regards\x20</strong>','int','sales_invoice','toString','barcode\x20user_id','$sale_product.bin','agent_id','flash','$sale_product.bay','sales','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','own','false','all_sales_finished_logs','Sales\x20Add\x20successfully','logs','\x20</h2>','$sale_product.floorlevel','here','return_sale','</td>','/barcode_scanner_auto','$product_details.room_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','9378sIHnlW','json'];a0_0x1958=function(){return _0x529269;};return a0_0x1958();}router['get'](a0_0x308003(0x14d),auth,async(_0x41d75a,_0x2ec72a)=>{var _0xd106d=a0_0x308003;try{const {username:_0x53f37f,email:_0x1ac617,role:_0x5bf905}=_0x41d75a['user'],_0x12db7d=_0x41d75a[_0xd106d(0xc4)],_0x2a9e3e=await profile[_0xd106d(0x103)]({'email':_0x12db7d['email']}),_0x236692=await master_shop[_0xd106d(0x111)]();let _0x328b50;if(_0x12db7d['role']=='staff'){const _0x1136e0=await staff[_0xd106d(0x103)]({'email':_0x12db7d['email']});_0x328b50=await sales_finished[_0xd106d(0x130)]([{'$match':{'typeOfProducts':_0xd106d(0x1a8)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0xd106d(0xe7),'invoice':{'$first':_0xd106d(0x171)},'customers':{'$first':_0xd106d(0xf6)},'date':{'$first':_0xd106d(0x16a)},'warehouse_name':{'$first':_0xd106d(0xb4)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0xd106d(0x113)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0xd106d(0x172)},'level':{'$addToSet':_0xd106d(0x1a5)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0xd106d(0x15d)},'pallet':{'$addToSet':_0xd106d(0x1ae)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x328b50=await sales_finished[_0xd106d(0x130)]([{'$match':{'typeOfProducts':_0xd106d(0x1a8)}},{'$unwind':_0xd106d(0xed)},{'$group':{'_id':_0xd106d(0xe7),'invoice':{'$first':_0xd106d(0x171)},'customers':{'$first':_0xd106d(0xf6)},'date':{'$first':_0xd106d(0x16a)},'warehouse_name':{'$first':_0xd106d(0xb4)},'sale_product':{'$push':_0xd106d(0xed)},'note':{'$first':_0xd106d(0x113)},'return_data':{'$first':_0xd106d(0xc5)},'customers_docs':{'$first':_0xd106d(0xbe)},'total_saleproduct_quantity':{'$sum':_0xd106d(0x172)},'level':{'$addToSet':_0xd106d(0x1a5)},'isle':{'$addToSet':_0xd106d(0x1a2)},'type':{'$addToSet':_0xd106d(0x15d)},'pallet':{'$addToSet':_0xd106d(0x1ae)},'finalize':{'$first':_0xd106d(0x143)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x236692[0x0]['language']==_0xd106d(0x1eb)){var _0x3752d5=users['English'];console[_0xd106d(0x1e7)](_0x3752d5);}else{if(_0x236692[0x0][_0xd106d(0x173)]==_0xd106d(0x159))var _0x3752d5=users[_0xd106d(0x159)];else{if(_0x236692[0x0][_0xd106d(0x173)]==_0xd106d(0x1f5))var _0x3752d5=users[_0xd106d(0x1f5)];else{if(_0x236692[0x0][_0xd106d(0x173)]==_0xd106d(0x188))var _0x3752d5=users[_0xd106d(0x188)];else{if(_0x236692[0x0][_0xd106d(0x173)]==_0xd106d(0x140))var _0x3752d5=users['French'];else{if(_0x236692[0x0][_0xd106d(0x173)]==_0xd106d(0x1cb))var _0x3752d5=users[_0xd106d(0x10c)];else{if(_0x236692[0x0]['language']==_0xd106d(0x10a))var _0x3752d5=users[_0xd106d(0x10a)];else{if(_0x236692[0x0][_0xd106d(0x173)]=='Arabic\x20(ae)')var _0x3752d5=users['Arabic'];}}}}}}}_0x2ec72a[_0xd106d(0x155)](_0xd106d(0x151),{'success':_0x41d75a[_0xd106d(0x1a4)](_0xd106d(0x1c1)),'errors':_0x41d75a[_0xd106d(0x1a4)]('errors'),'sales':_0x328b50,'profile':_0x2a9e3e,'role':_0x12db7d,'master_shop':_0x236692,'language':_0x3752d5});}catch(_0x3f120c){console[_0xd106d(0x1e7)](_0x3f120c);}}),router[a0_0x308003(0x1da)](a0_0x308003(0x1dc),auth,async(_0x4f40e3,_0x2e91aa)=>{var _0x52561a=a0_0x308003;try{const {username:_0x42861b,email:_0x4138bb,role:_0x5df3cd}=_0x4f40e3[_0x52561a(0xc4)],_0x3280fa=_0x4f40e3[_0x52561a(0xc4)],_0x365b6c=await profile['findOne']({'email':_0x3280fa['email']}),_0x1b45bf=await master_shop[_0x52561a(0x111)]();let _0xacb1c5;if(_0x3280fa[_0x52561a(0x15b)]==_0x52561a(0x14c)){const _0x52d35a=await staff[_0x52561a(0x103)]({'email':_0x3280fa[_0x52561a(0x1cd)]});_0xacb1c5=await sales_finished['aggregate']([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x52561a(0xed)},{'$group':{'_id':'$_id','invoice':{'$first':_0x52561a(0x171)},'customers':{'$first':_0x52561a(0xf6)},'date':{'$first':_0x52561a(0x16a)},'warehouse_name':{'$first':_0x52561a(0xb4)},'sale_product':{'$push':_0x52561a(0xed)},'note':{'$first':_0x52561a(0x113)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x52561a(0xbe)},'total_saleproduct_quantity':{'$sum':_0x52561a(0x172)},'level':{'$addToSet':_0x52561a(0x1a5)},'isle':{'$addToSet':_0x52561a(0x1a2)},'type':{'$addToSet':_0x52561a(0x15d)},'pallet':{'$addToSet':_0x52561a(0x1ae)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xacb1c5=await sales_finished[_0x52561a(0x130)]([{'$match':{'typeOfProducts':_0x52561a(0x1ac)}},{'$unwind':_0x52561a(0xed)},{'$group':{'_id':_0x52561a(0xe7),'invoice':{'$first':_0x52561a(0x171)},'customers':{'$first':'$customer'},'date':{'$first':_0x52561a(0x16a)},'warehouse_name':{'$first':_0x52561a(0xb4)},'sale_product':{'$push':_0x52561a(0xed)},'note':{'$first':_0x52561a(0x113)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x52561a(0xbe)},'total_saleproduct_quantity':{'$sum':_0x52561a(0x172)},'level':{'$addToSet':_0x52561a(0x1a5)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x52561a(0x15d)},'pallet':{'$addToSet':_0x52561a(0x1ae)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x1b45bf[0x0][_0x52561a(0x173)]==_0x52561a(0x1eb)){var _0x9597ad=users[_0x52561a(0x108)];console[_0x52561a(0x1e7)](_0x9597ad);}else{if(_0x1b45bf[0x0][_0x52561a(0x173)]=='Hindi')var _0x9597ad=users[_0x52561a(0x159)];else{if(_0x1b45bf[0x0][_0x52561a(0x173)]==_0x52561a(0x1f5))var _0x9597ad=users[_0x52561a(0x1f5)];else{if(_0x1b45bf[0x0]['language']==_0x52561a(0x188))var _0x9597ad=users[_0x52561a(0x188)];else{if(_0x1b45bf[0x0][_0x52561a(0x173)]==_0x52561a(0x140))var _0x9597ad=users['French'];else{if(_0x1b45bf[0x0][_0x52561a(0x173)]=='Portuguese\x20(BR)')var _0x9597ad=users['Portuguese'];else{if(_0x1b45bf[0x0][_0x52561a(0x173)]=='Chinese')var _0x9597ad=users['Chinese'];else{if(_0x1b45bf[0x0][_0x52561a(0x173)]=='Arabic\x20(ae)')var _0x9597ad=users[_0x52561a(0x12f)];}}}}}}}_0x2e91aa[_0x52561a(0x155)](_0x52561a(0x1aa),{'success':_0x4f40e3['flash']('success'),'errors':_0x4f40e3[_0x52561a(0x1a4)](_0x52561a(0xb8)),'sales':_0xacb1c5,'profile':_0x365b6c,'role':_0x3280fa,'master_shop':_0x1b45bf,'language':_0x9597ad});}catch(_0x3555ed){console[_0x52561a(0x1e7)](_0x3555ed);}});async function getRandom8DigitNumber(){var _0xff209a=a0_0x308003;const _0x53f75d=0x989680,_0x3b017a=0x5f5e0ff,_0x5563ea=Math[_0xff209a(0xf0)](Math[_0xff209a(0x105)]()*(_0x3b017a-_0x53f75d+0x1))+_0x53f75d;var _0x1d7c73;const _0x2ef69a=await sales_finished[_0xff209a(0x103)]({'invoice':_0xff209a(0x14a)+_0x5563ea});return _0x2ef69a&&_0x2ef69a[_0xff209a(0xf7)]>0x0?_0x1d7c73='OUTF-'+_0x5563ea:_0x1d7c73=_0xff209a(0x14a)+_0x5563ea,_0x1d7c73;}router[a0_0x308003(0x1da)]('/view/add_sales',auth,async(_0x2ec67c,_0x64dd60)=>{var _0x35d53d=a0_0x308003;try{const {username:_0x5af79f,email:_0x4cd00b,role:_0x2cf7f4}=_0x2ec67c[_0x35d53d(0xc4)],_0x50ef05=_0x2ec67c['user'],_0x38a88f=await profile['findOne']({'email':_0x50ef05[_0x35d53d(0x1cd)]}),_0x5291d8=await master_shop['find'](),_0x148632=await customer[_0x35d53d(0x111)]({});let _0x10e4d2;if(_0x50ef05[_0x35d53d(0x15b)]==_0x35d53d(0x14c)){const _0x55d755=await staff[_0x35d53d(0x103)]({'email':_0x50ef05['email']});_0x10e4d2=await warehouse[_0x35d53d(0x130)]([{'$match':{'status':_0x35d53d(0x1d3),'name':_0x55d755[_0x35d53d(0x100)]}},{'$group':{'_id':_0x35d53d(0xb3),'name':{'$first':_0x35d53d(0xb3)}}},{'$sort':{'name':0x1}}]);}else _0x10e4d2=await warehouse[_0x35d53d(0x130)]([{'$match':{'status':_0x35d53d(0x1d3)}},{'$group':{'_id':_0x35d53d(0xb3),'name':{'$first':_0x35d53d(0xb3)}}},{'$sort':{'name':0x1}}]);const _0x1ae6f2=await product['find']({});var _0x247b8d=[_0x35d53d(0x193),'Enclosed'];const _0x3ebb16=await sales_finished['find']({}),_0x322d69=_0x3ebb16['length']+0x1,_0x5b61b1=_0x35d53d(0x14a)+_0x322d69[_0x35d53d(0x1a0)]()['padStart'](0x5,'0');if(_0x5291d8[0x0]['language']=='English\x20(US)'){var _0x4a34e1=users[_0x35d53d(0x108)];console[_0x35d53d(0x1e7)](_0x4a34e1);}else{if(_0x5291d8[0x0]['language']==_0x35d53d(0x159))var _0x4a34e1=users[_0x35d53d(0x159)];else{if(_0x5291d8[0x0]['language']==_0x35d53d(0x1f5))var _0x4a34e1=users[_0x35d53d(0x1f5)];else{if(_0x5291d8[0x0][_0x35d53d(0x173)]==_0x35d53d(0x188))var _0x4a34e1=users[_0x35d53d(0x188)];else{if(_0x5291d8[0x0][_0x35d53d(0x173)]==_0x35d53d(0x140))var _0x4a34e1=users[_0x35d53d(0x140)];else{if(_0x5291d8[0x0][_0x35d53d(0x173)]=='Portuguese\x20(BR)')var _0x4a34e1=users['Portuguese'];else{if(_0x5291d8[0x0][_0x35d53d(0x173)]==_0x35d53d(0x10a))var _0x4a34e1=users[_0x35d53d(0x10a)];else{if(_0x5291d8[0x0][_0x35d53d(0x173)]==_0x35d53d(0x170))var _0x4a34e1=users[_0x35d53d(0x12f)];}}}}}}}const _0x1eb71d=getRandom8DigitNumber();_0x1eb71d[_0x35d53d(0x1c4)](_0x696ac2=>{var _0x3d9013=_0x35d53d;_0x64dd60['render'](_0x3d9013(0x10b),{'success':_0x2ec67c[_0x3d9013(0x1a4)](_0x3d9013(0x1c1)),'errors':_0x2ec67c['flash'](_0x3d9013(0xb8)),'role':_0x50ef05,'profile':_0x38a88f,'customer':_0x148632,'warehouse':_0x10e4d2,'product':_0x1ae6f2,'invoice':_0x696ac2,'master_shop':_0x5291d8,'language':_0x4a34e1,'rooms_data':_0x247b8d});})[_0x35d53d(0x147)](_0xe51470=>{var _0x54a032=_0x35d53d;_0x2ec67c[_0x54a032(0x1a4)](_0x54a032(0xb8),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x64dd60[_0x54a032(0x107)](_0x54a032(0x1e2));});}catch(_0x505285){console[_0x35d53d(0x1e7)](_0x505285);}}),router['get'](a0_0x308003(0x13f),auth,async(_0x459bb6,_0x59490d)=>{var _0x95ee88=a0_0x308003;try{const {username:_0x2eaa8f,email:_0x51365e,role:_0xad1aae}=_0x459bb6[_0x95ee88(0xc4)],_0xbd2b9b=_0x459bb6['user'],_0x50993b=await profile['findOne']({'email':_0xbd2b9b[_0x95ee88(0x1cd)]}),_0x5400c5=await master_shop['find'](),_0x5209c1=await customer['find']({});let _0x290140;if(_0xbd2b9b[_0x95ee88(0x15b)]=='staff'){const _0x164827=await staff[_0x95ee88(0x103)]({'email':_0xbd2b9b[_0x95ee88(0x1cd)]});_0x290140=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x164827[_0x95ee88(0x100)]}},{'$group':{'_id':'$name','name':{'$first':_0x95ee88(0xb3)}}},{'$sort':{'name':0x1}}]);}else _0x290140=await warehouse[_0x95ee88(0x130)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x95ee88(0xb3),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x1e6c2d=await product[_0x95ee88(0x111)]({});var _0x4a7071=['Ambient','Enclosed'];const _0x5f1509=await sales_finished[_0x95ee88(0x111)]({}),_0x2c1f44=_0x5f1509['length']+0x1,_0x5ae779=_0x95ee88(0x14a)+_0x2c1f44[_0x95ee88(0x1a0)]()[_0x95ee88(0x11c)](0x5,'0');if(_0x5400c5[0x0][_0x95ee88(0x173)]==_0x95ee88(0x1eb)){var _0x498d89=users[_0x95ee88(0x108)];console['log'](_0x498d89);}else{if(_0x5400c5[0x0][_0x95ee88(0x173)]==_0x95ee88(0x159))var _0x498d89=users[_0x95ee88(0x159)];else{if(_0x5400c5[0x0][_0x95ee88(0x173)]=='German')var _0x498d89=users['German'];else{if(_0x5400c5[0x0]['language']==_0x95ee88(0x188))var _0x498d89=users[_0x95ee88(0x188)];else{if(_0x5400c5[0x0][_0x95ee88(0x173)]=='French')var _0x498d89=users['French'];else{if(_0x5400c5[0x0][_0x95ee88(0x173)]==_0x95ee88(0x1cb))var _0x498d89=users[_0x95ee88(0x10c)];else{if(_0x5400c5[0x0][_0x95ee88(0x173)]=='Chinese')var _0x498d89=users[_0x95ee88(0x10a)];else{if(_0x5400c5[0x0][_0x95ee88(0x173)]=='Arabic\x20(ae)')var _0x498d89=users[_0x95ee88(0x12f)];}}}}}}}const _0x2537b0=getRandom8DigitNumber();_0x2537b0[_0x95ee88(0x1c4)](_0x416cf4=>{var _0x970dd9=_0x95ee88;_0x59490d[_0x970dd9(0x155)](_0x970dd9(0x19a),{'success':_0x459bb6[_0x970dd9(0x1a4)]('success'),'errors':_0x459bb6[_0x970dd9(0x1a4)](_0x970dd9(0xb8)),'role':_0xbd2b9b,'profile':_0x50993b,'customer':_0x5209c1,'warehouse':_0x290140,'product':_0x1e6c2d,'invoice':_0x416cf4,'master_shop':_0x5400c5,'language':_0x498d89,'rooms_data':_0x4a7071});})[_0x95ee88(0x147)](_0x58c757=>{var _0x4328e5=_0x95ee88;_0x459bb6[_0x4328e5(0x1a4)]('errors',_0x4328e5(0xad)),_0x59490d[_0x4328e5(0x107)](_0x4328e5(0x1e2));});}catch(_0x34cf5e){console[_0x95ee88(0x1e7)](_0x34cf5e);}}),router['post']('/view/add_sales_logs',auth,async(_0x254087,_0x536fa8)=>{var _0x415a54=a0_0x308003;try{const {invoice:_0x44b22e,date:_0x432c35,warehouse_name:_0x521877,product_name:_0x11f9c5,note:_0x141961,room:_0x231d14,primary_code:_0x753f28,secondary_code:_0x695621,prod_code:_0x5f2d16,SCRN:_0x72bd3e,ReqBy:_0x59b816,dateofreq:_0x633413,PO_number:_0x98973a,typeservicesData:_0xfd54db,typevehicle:_0x32967b,destination:_0x6a4572,deliverydate:_0x5b952c,driver:_0x58b3b2,plate:_0xa64209,van:_0x5899ac,DRSI:_0x4045e1,TSU:_0x219e20,TFU:_0x3d103b,mode_transpo:_0x32c8de,name_driver:_0x2de2f0,type_of_products:_0x17440c}=_0x254087[_0x415a54(0x136)];if(typeof _0x11f9c5==_0x415a54(0x1c8))var _0x37f556=[_0x254087['body'][_0x415a54(0x1d6)]],_0x4d92e0=[_0x254087[_0x415a54(0x136)][_0x415a54(0x1d4)]],_0x2ec353=[_0x254087[_0x415a54(0x136)][_0x415a54(0x125)]],_0x53ec0b=[_0x254087[_0x415a54(0x136)]['primary_code']],_0x4240ec=[_0x254087[_0x415a54(0x136)][_0x415a54(0x196)]],_0x4db905=[_0x254087[_0x415a54(0x136)][_0x415a54(0xbc)]],_0x18f88a=[_0x254087['body'][_0x415a54(0x163)]],_0x457e3b=[_0x254087[_0x415a54(0x136)][_0x415a54(0x1ce)]],_0x5754f3=[_0x254087[_0x415a54(0x136)][_0x415a54(0x1d5)]],_0x941db=[_0x254087[_0x415a54(0x136)][_0x415a54(0x11a)]],_0x2d53b3=[_0x254087['body'][_0x415a54(0x19b)]],_0x5f3dea=[_0x254087[_0x415a54(0x136)][_0x415a54(0x179)]],_0x3ee331=[_0x254087[_0x415a54(0x136)][_0x415a54(0xe6)]],_0x535cfb=[_0x254087[_0x415a54(0x136)][_0x415a54(0x1d7)]],_0x2a68cc=[_0x254087['body']['RoomAssigned']],_0x581c47=[_0x254087[_0x415a54(0x136)][_0x415a54(0x1f4)]],_0x3dd5f9=[_0x254087[_0x415a54(0x136)][_0x415a54(0x187)]],_0xf18fe=[_0x254087[_0x415a54(0x136)][_0x415a54(0x16c)]],_0x13b4ce=[_0x254087['body'][_0x415a54(0x13e)]];else var _0x37f556=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x1d6)]],_0x4d92e0=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x1d4)]],_0x2ec353=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x125)]],_0x53ec0b=[..._0x254087['body'][_0x415a54(0x1f7)]],_0x4240ec=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x196)]],_0x4db905=[..._0x254087[_0x415a54(0x136)][_0x415a54(0xbc)]],_0x18f88a=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x163)]],_0x457e3b=[..._0x254087[_0x415a54(0x136)]['primary_unit']],_0x5754f3=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x1d5)]],_0x941db=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x11a)]],_0x2d53b3=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x19b)]],_0x5f3dea=[..._0x254087['body'][_0x415a54(0x179)]],_0x3ee331=[..._0x254087[_0x415a54(0x136)]['max_per_unit']],_0x535cfb=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x1d7)]],_0x2a68cc=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x177)]],_0x581c47=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x1f4)]],_0x3dd5f9=[..._0x254087['body'][_0x415a54(0x187)]],_0xf18fe=[..._0x254087[_0x415a54(0x136)]['uuid']],_0x13b4ce=[..._0x254087[_0x415a54(0x136)][_0x415a54(0x13e)]];const _0x31527c=_0x37f556[_0x415a54(0xc9)](_0x165568=>{return _0x165568={'product_name':_0x165568};});_0x4d92e0[_0x415a54(0x16f)]((_0x5649a1,_0x274c49)=>{var _0x5a8e1f=_0x415a54;_0x31527c[_0x274c49][_0x5a8e1f(0x1d4)]=_0x5649a1;}),_0x2ec353[_0x415a54(0x16f)]((_0x282819,_0x464e9e)=>{var _0x4e29ec=_0x415a54;_0x31527c[_0x464e9e][_0x4e29ec(0xcc)]=Math[_0x4e29ec(0x1d1)](_0x282819);}),_0x37f556[_0x415a54(0x16f)]((_0x4a5cec,_0x5d39a0)=>{var _0xe6ea61=_0x415a54;_0x31527c[_0x5d39a0][_0xe6ea61(0x1a3)]=_0x254087[_0xe6ea61(0x136)][_0xe6ea61(0x1a6)];}),_0x13b4ce['forEach']((_0x977a92,_0x225ed8)=>{_0x31527c[_0x225ed8]['gross_price']=_0x977a92;}),_0xf18fe['forEach']((_0xa6d150,_0x2a14da)=>{var _0x26ebb6=_0x415a54;_0x31527c[_0x2a14da][_0x26ebb6(0x16c)]=_0xa6d150;}),_0x3dd5f9[_0x415a54(0x16f)]((_0x24d96a,_0x4d78b0)=>{var _0x2dc824=_0x415a54;_0x31527c[_0x4d78b0][_0x2dc824(0x187)]=_0x24d96a;}),_0x53ec0b[_0x415a54(0x16f)]((_0x5c582,_0x481cf9)=>{var _0x3fdffd=_0x415a54;_0x31527c[_0x481cf9][_0x3fdffd(0x1f7)]=_0x5c582;}),_0x4240ec[_0x415a54(0x16f)]((_0x2712c9,_0x2b15e)=>{var _0x3b4159=_0x415a54;_0x31527c[_0x2b15e][_0x3b4159(0x196)]=_0x2712c9;}),_0x4db905[_0x415a54(0x16f)]((_0x5cfbd5,_0x4d7fee)=>{var _0x2a0718=_0x415a54;_0x31527c[_0x4d7fee][_0x2a0718(0x132)]=_0x5cfbd5;}),_0x18f88a[_0x415a54(0x16f)]((_0x14c650,_0x2519df)=>{var _0x3bdae8=_0x415a54,_0x43ffb2=_0x14c650[_0x3bdae8(0x1bf)](/[A-Za-z]+/)[0x0],_0xbc6933=parseInt(_0x14c650[_0x3bdae8(0x1bf)](/\d+/)[0x0]);_0x31527c[_0x2519df][_0x3bdae8(0xac)]=_0xbc6933,_0x31527c[_0x2519df][_0x3bdae8(0xbd)]=_0x43ffb2;}),_0x457e3b[_0x415a54(0x16f)]((_0x1d7034,_0x39a220)=>{var _0x542f51=_0x415a54;_0x31527c[_0x39a220][_0x542f51(0xcf)]=_0x1d7034;}),_0x5754f3[_0x415a54(0x16f)]((_0x283671,_0xa9dfb6)=>{var _0x10559d=_0x415a54;_0x31527c[_0xa9dfb6][_0x10559d(0x1d5)]=_0x283671;}),_0x941db[_0x415a54(0x16f)]((_0x5aafaf,_0x4a50ca)=>{var _0x3f7c64=_0x415a54;_0x31527c[_0x4a50ca][_0x3f7c64(0x11a)]=_0x5aafaf;}),_0x2d53b3[_0x415a54(0x16f)]((_0x3655ea,_0x408751)=>{var _0x2019cf=_0x415a54;_0x31527c[_0x408751][_0x2019cf(0x19b)]=_0x3655ea;}),_0x5f3dea[_0x415a54(0x16f)]((_0x37cffa,_0x232940)=>{var _0x4405b6=_0x415a54;_0x31527c[_0x232940][_0x4405b6(0xca)]=_0x37cffa;}),_0x3ee331['forEach']((_0x2b3273,_0x495fef)=>{var _0x202073=_0x415a54;_0x31527c[_0x495fef][_0x202073(0xc7)]=_0x2b3273;}),_0x535cfb[_0x415a54(0x16f)]((_0x17ad30,_0x14c116)=>{var _0x128eac=_0x415a54;_0x31527c[_0x14c116][_0x128eac(0x1d7)]=_0x17ad30;}),_0x2a68cc[_0x415a54(0x16f)]((_0x37f7ba,_0x75340d)=>{_0x31527c[_0x75340d]['room_name']=_0x37f7ba;}),_0x581c47['forEach']((_0x1e04e6,_0x4b4df6)=>{var _0x4a174e=_0x415a54;_0x31527c[_0x4b4df6][_0x4a174e(0x1d0)]=_0x1e04e6,_0x31527c[_0x4b4df6][_0x4a174e(0x191)]=_0x432c35;});const _0x5a8c6e=new sales_logs();await _0x5a8c6e['save'](),_0x581c47[_0x415a54(0x16f)]((_0x10fef8,_0x772059)=>{var _0x1fc915=_0x415a54;_0x31527c[_0x772059]['outgoing_invoice']='LOG-OUT-'+_0x5a8c6e[_0x1fc915(0x1f0)]['toString']()['padStart'](0x8,'0');});var _0x2142e5=0x0;_0x31527c['forEach'](_0x144b5c=>{var _0x33d3e0=_0x415a54;parseFloat(_0x144b5c[_0x33d3e0(0x1d4)])<parseFloat(_0x144b5c[_0x33d3e0(0xcc)])&&parseFloat(_0x144b5c[_0x33d3e0(0xcc)])>parseFloat(_0x144b5c[_0x33d3e0(0x1d4)])&&(console[_0x33d3e0(0x1e7)](_0x144b5c[_0x33d3e0(0x1d4)]+_0x33d3e0(0xa5)+_0x144b5c[_0x33d3e0(0xcc)]),_0x2142e5++);});if(_0x2142e5!=0x0)return _0x254087[_0x415a54(0x1a4)](_0x415a54(0xb8),_0x415a54(0x1c9)),_0x536fa8[_0x415a54(0x107)]('back');const _0x3d017b=_0x31527c[_0x415a54(0xb0)](_0x4c8c5f=>_0x4c8c5f[_0x415a54(0xcc)]!=='0'&&_0x4c8c5f[_0x415a54(0xcc)]!==''),_0x345a6c=new sales_finished({'invoice':_0x415a54(0x165)+_0x5a8c6e[_0x415a54(0x1f0)][_0x415a54(0x1a0)]()[_0x415a54(0x11c)](0x8,'0'),'sales_data':_0x254087['body'][_0x415a54(0x1a6)],'customer':_0x254087[_0x415a54(0x136)][_0x415a54(0x198)],'date':_0x432c35,'warehouse_name':_0x521877,'sale_product':_0x3d017b,'note':_0x141961,'room':_0x231d14,'primary_code':_0x753f28,'secondary_code':_0x695621,'prod_code':_0x5f2d16,'SCRN':_0x72bd3e,'finalize':_0x415a54(0x16b),'mode_transpo':_0x32c8de,'name_driver':_0x2de2f0,'ReqBy':_0x59b816,'dateofreq':_0x633413,'PO_number':_0x98973a,'typeservicesData':_0xfd54db,'typevehicle':_0x32967b,'destination':_0x6a4572,'deliverydate':_0x5b952c,'driver':_0x58b3b2,'plate':_0xa64209,'van':_0x5899ac,'DRSI':_0x4045e1,'TSU':_0x219e20,'TFU':_0x3d103b,'typeOfProducts':_0x17440c}),_0x9a2860=await _0x345a6c['save'](),_0x1bab5a=await sales_finished[_0x415a54(0x103)]({'invoice':_0x44b22e});_0x254087['flash'](_0x415a54(0x1c1),_0x415a54(0x1ab)),_0x536fa8[_0x415a54(0x107)](_0x415a54(0x115)+_0x9a2860[_0x415a54(0xf8)]);}catch(_0x469845){console[_0x415a54(0x1e7)](_0x469845);}}),router[a0_0x308003(0x1da)]('/view/add_sales/:id',auth,async(_0x5e2607,_0x33ed0f)=>{var _0x1cd13e=a0_0x308003;try{const _0x509e4b=_0x5e2607['params']['id'];console[_0x1cd13e(0x1e7)](_0x509e4b);const _0x3601fa=await product[_0x1cd13e(0x111)](),_0x4301ba=await purchases[_0x1cd13e(0x130)]([{'$match':{'warehouse_name':_0x509e4b}},{'$unwind':'$product'},{'$group':{'_id':_0x1cd13e(0x138)}}]);console['log'](_0x1cd13e(0x1df),_0x4301ba),_0x33ed0f['status'](0xc8)[_0x1cd13e(0x1b6)]({'purchases_data':_0x4301ba,'product_data':_0x3601fa});}catch(_0x243656){console[_0x1cd13e(0x1e7)](_0x243656);}}),router[a0_0x308003(0x1b8)](a0_0x308003(0x1d8),auth,async(_0x7d7cc9,_0x3e1c76)=>{var _0x465884=a0_0x308003;try{const {warehouse_data:_0x21f962,product_data:_0x3c44b2}=_0x7d7cc9[_0x465884(0x136)];console['log'](_0x7d7cc9[_0x465884(0x136)][_0x465884(0x18a)]);;const _0x14a651=await master_shop[_0x465884(0x111)]();console['log']('master',_0x14a651);const _0x5a5e2c=await product[_0x465884(0x103)]({'name':_0x3c44b2});console[_0x465884(0x1e7)](_0x465884(0xf4),_0x5a5e2c);const _0x130e55=await warehouse['aggregate']([{'$match':{'name':_0x21f962}},{'$unwind':_0x465884(0x109)},{'$match':{'product_details.product_name':_0x3c44b2}},{'$group':{'_id':_0x465884(0x11f),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x465884(0x1e7)](_0x465884(0x135),_0x130e55),_0x3e1c76[_0x465884(0x110)](0xc8)['json']({'master':_0x14a651,'new_product':_0x5a5e2c,'stock_data':_0x130e55});}catch(_0x4f1c33){console['log'](_0x4f1c33);}}),router[a0_0x308003(0x1b8)](a0_0x308003(0x17b),auth,async(_0xd402e4,_0x49ddf0)=>{var _0x4f62e5=a0_0x308003;try{const {invoice:_0x426b91,date:_0x296ee3,warehouse_name:_0x32c4fb,product_name:_0x815f66,note:_0x10f448,room:_0x498f72,primary_code:_0x42fd4c,secondary_code:_0x380766,prod_code:_0x10c349,SCRN:_0x4c1026,ReqBy:_0x3e8e98,dateofreq:_0x36803e,PO_number:_0x4f8102,typeservicesData:_0x46691b,typevehicle:_0x165443,destination:_0x320265,deliverydate:_0x5c04bc,driver:_0x124414,plate:_0x24b492,van:_0xd95354,DRSI:_0x87b11d,TSU:_0x485dfa,TFU:_0x38d990,mode_transpo:_0x1aa5dc,name_driver:_0x88f471,pull_out_date:_0x15554c,actual_delivery_date:_0x9a41c6}=_0xd402e4['body'];_0x49ddf0[_0x4f62e5(0x1b6)](_0xd402e4['body']);return;if(typeof _0x815f66==_0x4f62e5(0x1c8))var _0x4dec00=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1d6)]],_0x4f18c9=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1d4)]],_0x109cbc=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x125)]],_0x5d94ca=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1f7)]],_0x134575=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x196)]],_0x1314a6=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0xbc)]],_0xd31762=[_0xd402e4['body']['level2']],_0x3178f8=[_0xd402e4[_0x4f62e5(0x136)]['primary_unit']],_0x1c5157=[_0xd402e4[_0x4f62e5(0x136)]['secondary_unit']],_0x110585=[_0xd402e4[_0x4f62e5(0x136)]['batch_code']],_0xd429e7=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x19b)]],_0x4288dc=[_0xd402e4['body']['product_date']],_0x36fe9e=[_0xd402e4['body'][_0x4f62e5(0xe6)]],_0xe59b38=[_0xd402e4[_0x4f62e5(0x136)]['prod_cat']],_0x47faff=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x177)]],_0x563298=[_0xd402e4[_0x4f62e5(0x136)]['prod_invoice']],_0x164286=[_0xd402e4['body'][_0x4f62e5(0x187)]],_0x5468af=[_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x16c)]],_0xfd972e=[_0xd402e4['body']['gross_price']];else var _0x4dec00=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1d6)]],_0x4f18c9=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1d4)]],_0x109cbc=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x125)]],_0x5d94ca=[..._0xd402e4['body'][_0x4f62e5(0x1f7)]],_0x134575=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x196)]],_0x1314a6=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0xbc)]],_0xd31762=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x163)]],_0x3178f8=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1ce)]],_0x1c5157=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1d5)]],_0x110585=[..._0xd402e4[_0x4f62e5(0x136)]['batch_code']],_0xd429e7=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x19b)]],_0x4288dc=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x179)]],_0x36fe9e=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0xe6)]],_0xe59b38=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1d7)]],_0x47faff=[..._0xd402e4['body'][_0x4f62e5(0x177)]],_0x563298=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1f4)]],_0x164286=[..._0xd402e4['body'][_0x4f62e5(0x187)]],_0x5468af=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x16c)]],_0xfd972e=[..._0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x13e)]];const _0x20aa4c=_0x4dec00[_0x4f62e5(0xc9)](_0x100c6d=>{return _0x100c6d={'product_name':_0x100c6d};});_0x4f18c9[_0x4f62e5(0x16f)]((_0x8450c4,_0x18442e)=>{var _0x3a181f=_0x4f62e5;_0x20aa4c[_0x18442e][_0x3a181f(0x1d4)]=_0x8450c4;}),_0x109cbc[_0x4f62e5(0x16f)]((_0x57ef67,_0x551ba0)=>{var _0x53bb2c=_0x4f62e5;_0x20aa4c[_0x551ba0][_0x53bb2c(0xcc)]=Math['abs'](_0x57ef67);}),_0x4dec00['forEach']((_0x48b5ff,_0x3e151d)=>{var _0x3b16e2=_0x4f62e5;_0x20aa4c[_0x3e151d][_0x3b16e2(0x1a3)]=_0xd402e4[_0x3b16e2(0x136)][_0x3b16e2(0x1a6)];}),_0xfd972e[_0x4f62e5(0x16f)]((_0x5b8b25,_0x3e5ff9)=>{var _0x227c6f=_0x4f62e5;_0x20aa4c[_0x3e5ff9][_0x227c6f(0x13e)]=_0x5b8b25;}),_0x5468af['forEach']((_0x13150b,_0x315f53)=>{var _0x3c7bad=_0x4f62e5;_0x20aa4c[_0x315f53][_0x3c7bad(0x16c)]=_0x13150b;}),_0x164286['forEach']((_0x149edb,_0x2f5a20)=>{var _0x221275=_0x4f62e5;_0x20aa4c[_0x2f5a20][_0x221275(0x187)]=_0x149edb;}),_0x5d94ca[_0x4f62e5(0x16f)]((_0x6a5cc0,_0x136040)=>{_0x20aa4c[_0x136040]['primary_code']=_0x6a5cc0;}),_0x134575[_0x4f62e5(0x16f)]((_0x5f2bc2,_0x3a4cec)=>{var _0x5a5ecf=_0x4f62e5;_0x20aa4c[_0x3a4cec][_0x5a5ecf(0x196)]=_0x5f2bc2;}),_0x1314a6[_0x4f62e5(0x16f)]((_0x5f5352,_0x58c936)=>{_0x20aa4c[_0x58c936]['product_code']=_0x5f5352;}),_0xd31762['forEach']((_0x17eb5f,_0x245ed1)=>{var _0x5e0da2=_0x4f62e5,_0x2f0004=_0x17eb5f[_0x5e0da2(0x1bf)](/[A-Za-z]+/)[0x0],_0x33021a=parseInt(_0x17eb5f[_0x5e0da2(0x1bf)](/\d+/)[0x0]);_0x20aa4c[_0x245ed1]['bay']=_0x33021a,_0x20aa4c[_0x245ed1]['level']=_0x2f0004;}),_0x3178f8[_0x4f62e5(0x16f)]((_0x2c8bef,_0x3b5c55)=>{var _0x3bad3f=_0x4f62e5;_0x20aa4c[_0x3b5c55][_0x3bad3f(0xcf)]=_0x2c8bef;}),_0x1c5157[_0x4f62e5(0x16f)]((_0x29b0ec,_0x3295c9)=>{var _0x469e60=_0x4f62e5;_0x20aa4c[_0x3295c9][_0x469e60(0x1d5)]=_0x29b0ec;}),_0x110585[_0x4f62e5(0x16f)]((_0xcea4ec,_0x18a1bd)=>{_0x20aa4c[_0x18a1bd]['batch_code']=_0xcea4ec;}),_0xd429e7[_0x4f62e5(0x16f)]((_0x49b8a9,_0x292464)=>{_0x20aa4c[_0x292464]['expiry_date']=_0x49b8a9;}),_0x4288dc[_0x4f62e5(0x16f)]((_0x1e9512,_0x484ae3)=>{var _0x36d67d=_0x4f62e5;_0x20aa4c[_0x484ae3][_0x36d67d(0xca)]=_0x1e9512;}),_0x36fe9e[_0x4f62e5(0x16f)]((_0x409c27,_0x3ba0f3)=>{_0x20aa4c[_0x3ba0f3]['maxperunit']=_0x409c27;}),_0xe59b38[_0x4f62e5(0x16f)]((_0xf08773,_0x9f46cc)=>{var _0x2c83c9=_0x4f62e5;_0x20aa4c[_0x9f46cc][_0x2c83c9(0x1d7)]=_0xf08773;}),_0x47faff[_0x4f62e5(0x16f)]((_0xdda6b3,_0x13448a)=>{var _0x3b794c=_0x4f62e5;_0x20aa4c[_0x13448a][_0x3b794c(0x112)]=_0xdda6b3;}),_0x563298[_0x4f62e5(0x16f)]((_0xade7f7,_0xbaa3d1)=>{var _0x32fa2d=_0x4f62e5;_0x20aa4c[_0xbaa3d1]['invoice']=_0xade7f7,_0x20aa4c[_0xbaa3d1][_0x32fa2d(0x191)]=_0x296ee3;});const _0x25c355=new invoice_for_outgoing();await _0x25c355[_0x4f62e5(0xe3)](),_0x563298[_0x4f62e5(0x16f)]((_0x3e32aa,_0x2d6b4e)=>{var _0x2c5b31=_0x4f62e5;_0x20aa4c[_0x2d6b4e]['outgoing_invoice']='OUT-'+_0x25c355[_0x2c5b31(0x1f0)][_0x2c5b31(0x1a0)]()['padStart'](0x8,'0');});var _0x3d4e7c=0x0;_0x20aa4c[_0x4f62e5(0x16f)](_0x2a9731=>{var _0x3cda01=_0x4f62e5;parseFloat(_0x2a9731[_0x3cda01(0x1d4)])<parseFloat(_0x2a9731['quantity'])&&parseFloat(_0x2a9731['quantity'])>parseFloat(_0x2a9731['stock'])&&(console[_0x3cda01(0x1e7)](_0x2a9731[_0x3cda01(0x1d4)]+'\x20<>\x20'+_0x2a9731[_0x3cda01(0xcc)]),_0x3d4e7c++);});if(_0x3d4e7c!=0x0)return _0xd402e4['flash'](_0x4f62e5(0xb8),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x49ddf0[_0x4f62e5(0x107)](_0x4f62e5(0x14e));const _0x3dae37=_0x20aa4c[_0x4f62e5(0xb0)](_0x1a547c=>_0x1a547c[_0x4f62e5(0xcc)]!=='0'&&_0x1a547c[_0x4f62e5(0xcc)]!==''),_0x39a3bf=new sales_finished({'invoice':_0x4f62e5(0x120)+_0x25c355[_0x4f62e5(0x1f0)][_0x4f62e5(0x1a0)]()['padStart'](0x8,'0'),'sales_data':_0xd402e4[_0x4f62e5(0x136)][_0x4f62e5(0x1a6)],'customer':_0xd402e4[_0x4f62e5(0x136)]['customer'],'date':_0x296ee3,'warehouse_name':_0x32c4fb,'sale_product':_0x3dae37,'note':_0x10f448,'room':_0x498f72,'primary_code':_0x42fd4c,'secondary_code':_0x380766,'prod_code':_0x10c349,'SCRN':_0x4c1026,'finalize':_0x4f62e5(0x16b),'mode_transpo':_0x1aa5dc,'name_driver':_0x88f471,'ReqBy':_0x3e8e98,'dateofreq':_0x36803e,'PO_number':_0x4f8102,'typeservicesData':_0x46691b,'typevehicle':_0x165443,'destination':_0x320265,'deliverydate':_0x5c04bc,'driver':_0x124414,'plate':_0x24b492,'van':_0xd95354,'DRSI':_0x87b11d,'TSU':_0x485dfa,'TFU':_0x38d990,'pullout_date':_0x15554c,'actualdelivery_date':_0x9a41c6,'typeOfProducts':'own'}),_0x43fcb8=await _0x39a3bf[_0x4f62e5(0xe3)](),_0x4a839b=await sales_finished[_0x4f62e5(0x103)]({'invoice':_0x426b91});_0xd402e4[_0x4f62e5(0x1a4)](_0x4f62e5(0x1c1),_0x4f62e5(0x1ab)),_0x49ddf0[_0x4f62e5(0x107)]('/all_sales_finished/preview/'+_0x43fcb8[_0x4f62e5(0xf8)]);}catch(_0x3d58d7){console[_0x4f62e5(0x1e7)](_0x3d58d7);}}),router[a0_0x308003(0x1da)](a0_0x308003(0xde),auth,async(_0x5c29c1,_0x3baa3f)=>{var _0x12d56b=a0_0x308003;try{const {username:_0x347d3f,email:_0x37e89a,role:_0x2e8d5a}=_0x5c29c1[_0x12d56b(0xc4)],_0x53f208=_0x5c29c1[_0x12d56b(0xc4)],_0x76c308=await profile['findOne']({'email':_0x53f208[_0x12d56b(0x1cd)]}),_0x1b7afd=await master_shop[_0x12d56b(0x111)](),_0x571581=_0x5c29c1[_0x12d56b(0x1ef)]['id'],_0x4b8570=await sales_finished[_0x12d56b(0x17a)](_0x571581),_0x4cc314=await warehouse[_0x12d56b(0x130)]([{'$match':{'name':_0x4b8570['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x12d56b(0x11f)},'product_stock':{'$first':_0x12d56b(0x1e8)},'bay':{'$first':_0x12d56b(0xb9)},'bin':{'$first':_0x12d56b(0x1ed)},'type':{'$first':_0x12d56b(0x116)},'floorlevel':{'$first':_0x12d56b(0x1ec)},'primary_code':{'$first':_0x12d56b(0xd5)},'secondary_code':{'$first':_0x12d56b(0x114)},'product_code':{'$first':_0x12d56b(0xdf)},'storage':{'$first':_0x12d56b(0x182)},'rack':{'$first':_0x12d56b(0x162)},'expiry_date':{'$first':_0x12d56b(0x106)},'production_date':{'$first':_0x12d56b(0x15a)},'batch_code':{'$first':_0x12d56b(0xa7)},'room':{'$first':_0x12d56b(0xb1)},'room_data':{'$first':_0x12d56b(0x1b3)}}}]),_0x525732=await customer[_0x12d56b(0x111)]({});let _0x389b93;if(_0x53f208[_0x12d56b(0x15b)]==_0x12d56b(0x14c)){const _0x1c858d=await staff[_0x12d56b(0x103)]({'email':_0x53f208[_0x12d56b(0x1cd)]});_0x389b93=await warehouse[_0x12d56b(0x130)]([{'$match':{'status':_0x12d56b(0x1d3),'name':_0x1c858d['warehouse']}},{'$group':{'_id':_0x12d56b(0xb3),'name':{'$first':_0x12d56b(0xb3)}}}]);}else _0x389b93=await warehouse[_0x12d56b(0x130)]([{'$match':{'status':_0x12d56b(0x1d3)}},{'$group':{'_id':'$name','name':{'$first':_0x12d56b(0xb3)}}}]);const _0x4f0c1b=await product[_0x12d56b(0x111)]({});if(_0x1b7afd[0x0][_0x12d56b(0x173)]==_0x12d56b(0x1eb)){var _0x568b92=users[_0x12d56b(0x108)];console['log'](_0x568b92);}else{if(_0x1b7afd[0x0][_0x12d56b(0x173)]==_0x12d56b(0x159))var _0x568b92=users['Hindi'];else{if(_0x1b7afd[0x0][_0x12d56b(0x173)]==_0x12d56b(0x1f5))var _0x568b92=users[_0x12d56b(0x1f5)];else{if(_0x1b7afd[0x0][_0x12d56b(0x173)]=='Spanish')var _0x568b92=users[_0x12d56b(0x188)];else{if(_0x1b7afd[0x0]['language']==_0x12d56b(0x140))var _0x568b92=users['French'];else{if(_0x1b7afd[0x0][_0x12d56b(0x173)]==_0x12d56b(0x1cb))var _0x568b92=users[_0x12d56b(0x10c)];else{if(_0x1b7afd[0x0][_0x12d56b(0x173)]==_0x12d56b(0x10a))var _0x568b92=users[_0x12d56b(0x10a)];else{if(_0x1b7afd[0x0][_0x12d56b(0x173)]==_0x12d56b(0x170))var _0x568b92=users['Arabic'];}}}}}}}_0x3baa3f[_0x12d56b(0x155)](_0x12d56b(0x180),{'success':_0x5c29c1[_0x12d56b(0x1a4)](_0x12d56b(0x1c1)),'errors':_0x5c29c1[_0x12d56b(0x1a4)](_0x12d56b(0xb8)),'role':_0x53f208,'profile':_0x76c308,'customer':_0x525732,'warehouse':_0x389b93,'product':_0x4cc314,'user':_0x4b8570,'master_shop':_0x1b7afd,'unit':_0x4f0c1b,'language':_0x568b92});}catch(_0x1297ba){console[_0x12d56b(0x1e7)](_0x1297ba);}});async function dataUpdate(_0x34250e,_0x24342a,_0x5bbd25){var _0x30c462=a0_0x308003;return await warehouse[_0x30c462(0x1c5)]({'_id':_0x34250e,'product_details._id':_0x24342a},{'$set':{'product_details.$.product_stock':_0x5bbd25}}),await warehouse[_0x30c462(0x17a)](_0x34250e);}router['post'](a0_0x308003(0xde),auth,async(_0x2584a0,_0x1573f0)=>{var _0xf4200c=a0_0x308003;try{const _0x1becbe=_0x2584a0[_0xf4200c(0x1ef)]['id'],{invoice:_0x442583,warehouse_name:_0x3e6515,room:_0x34f1bd}=_0x2584a0[_0xf4200c(0x136)],_0x2f94e5=await sales_finished[_0xf4200c(0x103)]({'invoice':_0x442583});for(let _0x3deec9=0x0;_0x3deec9<=_0x2f94e5[_0xf4200c(0x102)][_0xf4200c(0xf7)]-0x1;_0x3deec9++){const _0x3deb57=_0x2f94e5[_0xf4200c(0x102)][_0x3deec9];var _0x1c3602=await warehouse['findOne']({'name':_0x3e6515,'room':_0x3deb57[_0xf4200c(0x112)]}),_0x49fbed=0x0;for(let _0x5d60fc=0x0;_0x5d60fc<=_0x1c3602[_0xf4200c(0x1dd)][_0xf4200c(0xf7)]-0x1;_0x5d60fc++){const _0x36f86a=_0x1c3602[_0xf4200c(0x1dd)][_0x5d60fc];_0x36f86a[_0xf4200c(0xf8)]==_0x3deb57[_0xf4200c(0x187)]&&_0x36f86a[_0xf4200c(0x16c)]==_0x3deb57[_0xf4200c(0x16c)]&&(_0x49fbed=Math['max'](0x0,Math[_0xf4200c(0x1d1)](_0x36f86a[_0xf4200c(0x12e)])-Math[_0xf4200c(0x1d1)](_0x3deb57['quantity'])),await warehouse[_0xf4200c(0x1c5)]({'_id':_0x1c3602['_id']['valueOf'](),'product_details._id':_0x36f86a[_0xf4200c(0xf8)][_0xf4200c(0xe8)](),'product_details.uuid':_0x3deb57['uuid']},{'$set':{'product_details.$.product_stock':_0x49fbed}}));}console[_0xf4200c(0x1e7)](typeof _0x3deb57[_0xf4200c(0x1a3)]);if(typeof _0x3deb57[_0xf4200c(0x1a3)]!=='undefined'){var _0x4ef516=await staff[_0xf4200c(0x17a)](_0x3deb57[_0xf4200c(0x1a3)]);console[_0xf4200c(0x1e7)](_0xf4200c(0x1af));var _0x326ea6=0x0;for(let _0x251931=0x0;_0x251931<=_0x4ef516[_0xf4200c(0xf2)]['length']-0x1;_0x251931++){const _0x471143=_0x4ef516['product_list'][_0x251931];console[_0xf4200c(0x1e7)](_0x3deb57[_0xf4200c(0x187)]+'\x20==\x20'+_0x471143[_0xf4200c(0x18f)]+_0xf4200c(0xc8)+_0x3deb57[_0xf4200c(0xf8)]+_0xf4200c(0x169)+_0x3deb57['_id']),_0x3deb57[_0xf4200c(0x187)]==_0x471143['warehouse_id']&&_0x3deb57[_0xf4200c(0xf8)]==0x1&&(_0x471143[_0xf4200c(0x12e)]=Math[_0xf4200c(0x1d1)](_0x471143['product_stock'])+Math[_0xf4200c(0x1d1)](_0x3deb57[_0xf4200c(0xcc)]),_0x326ea6++);}console[_0xf4200c(0x1e7)](_0xf4200c(0x19e),_0x326ea6),_0x326ea6=='0'&&(_0x4ef516[_0xf4200c(0xf2)]=_0x4ef516[_0xf4200c(0xf2)]['concat']({'product_name':_0x3deb57[_0xf4200c(0x1d6)],'product_stock':_0x3deb57[_0xf4200c(0xcc)],'bay':_0x3deb57[_0xf4200c(0xac)],'level':_0x3deb57[_0xf4200c(0xbd)],'product_code':_0x3deb57[_0xf4200c(0x132)],'primary_code':_0x3deb57[_0xf4200c(0x1f7)],'secondary_code':_0x3deb57[_0xf4200c(0x196)],'expiry_date':_0x3deb57[_0xf4200c(0x19b)],'production_date':_0x3deb57[_0xf4200c(0xca)],'maxProducts':_0x3deb57[_0xf4200c(0x1f8)],'batch_code':_0x3deb57['batch_code'],'secondary_unit':_0x3deb57[_0xf4200c(0x1d5)],'unit':_0x3deb57[_0xf4200c(0xcf)],'maxProducts':_0x3deb57[_0xf4200c(0x1f8)],'maxPerUnit':_0x3deb57[_0xf4200c(0xc7)],'invoice':_0x3deb57[_0xf4200c(0x1d0)],'warehouse_id':_0x3deb57['id_transaction_from'],'id_incoming':_0x3deb57[_0xf4200c(0xf8)],'uuid':_0x3deb57[_0xf4200c(0x16c)],'gross_price':_0x3deb57['gross_price'],'date_incoming':_0x3deb57[_0xf4200c(0x191)],'outgoing_invoice':_0x3deb57[_0xf4200c(0x122)]}),await _0x4ef516[_0xf4200c(0xe3)]());}}_0x2f94e5[_0xf4200c(0x1bb)]=_0xf4200c(0x123);const _0x5923cb=await _0x2f94e5[_0xf4200c(0xe3)](),_0x4cc768=await master_shop['find'](),_0x37c22d=await email_settings[_0xf4200c(0x103)](),_0x287cda=await supervisor_settings[_0xf4200c(0x111)]();var _0x2067c3=_0x2f94e5[_0xf4200c(0x102)],_0x122113='',_0x15b797;for(_0x15b797 in _0x2067c3){_0x122113+=_0xf4200c(0xf3)+_0xf4200c(0xda)+_0x2067c3[_0x15b797]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2067c3[_0x15b797][_0xf4200c(0x132)]+_0xf4200c(0x1b1)+_0xf4200c(0xda)+_0x2067c3[_0x15b797][_0xf4200c(0xcc)]+_0xf4200c(0x1b1)+_0xf4200c(0xda)+_0x2067c3[_0x15b797][_0xf4200c(0xcf)]+_0xf4200c(0x1b1)+_0xf4200c(0xda)+_0x2067c3[_0x15b797]['secondary_unit']+'</td>'+_0xf4200c(0xda)+_0x2f94e5[_0xf4200c(0x129)]+'</td>'+_0xf4200c(0xda)+_0x2067c3[_0x15b797][_0xf4200c(0x112)]+_0xf4200c(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2067c3[_0x15b797][_0xf4200c(0xac)]+_0xf4200c(0x1b1);}_0x2584a0[_0xf4200c(0x1a4)](_0xf4200c(0x1c1),'Sales\x20Update\x20successfully'),_0x1573f0[_0xf4200c(0x107)](_0xf4200c(0x18d)+_0x1becbe);}catch(_0x216c11){console['log'](_0x216c11);}}),router[a0_0x308003(0x1da)](a0_0x308003(0x186),auth,async(_0x30bb66,_0x319c97)=>{var _0x318284=a0_0x308003;try{const {username:_0xbbac8b,email:_0x15067c,role:_0x423e0a}=_0x30bb66[_0x318284(0xc4)],_0x520ee9=_0x30bb66[_0x318284(0xc4)],_0x3ef58a=await profile['findOne']({'email':_0x520ee9[_0x318284(0x1cd)]}),_0x5b5dad=await master_shop[_0x318284(0x111)](),_0x39112b=_0x30bb66[_0x318284(0x1ef)]['id'],_0x500698=await sales_finished[_0x318284(0x17a)](_0x39112b);let _0x56b6a0=new Date(_0x500698['expiry_date']),_0x38d07c=('0'+_0x56b6a0['getDate']())[_0x318284(0xd1)](-0x2),_0x54ba72=('0'+(_0x56b6a0['getMonth']()+0x1))['slice'](-0x2),_0x3d0772=_0x56b6a0['getFullYear'](),_0x3e0969=_0x3d0772+'-'+_0x54ba72+'-'+_0x38d07c;var _0x288346=[_0x318284(0x193),'Enclosed'];const _0x2c0a4b=await warehouse[_0x318284(0x130)]([{'$match':{'name':_0x500698['warehouse_name'],'room':_0x500698[_0x318284(0xd6)]}},{'$unwind':_0x318284(0x109)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x318284(0x11f)},'product_stock':{'$first':_0x318284(0x1e8)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x318284(0x1ed)},'type':{'$first':_0x318284(0x116)},'floorlevel':{'$first':_0x318284(0x1ec)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x318284(0xdf)},'storage':{'$first':_0x318284(0x182)},'rack':{'$first':'$product_details.rack'}}}]),_0x21723b=await customer[_0x318284(0x111)]({});let _0x510b90;if(_0x520ee9['role']==_0x318284(0x14c)){const _0x2f48ec=await staff[_0x318284(0x103)]({'email':_0x520ee9['email']});_0x510b90=await warehouse['aggregate']([{'$match':{'status':_0x318284(0x1d3),'name':_0x2f48ec[_0x318284(0x100)]}},{'$group':{'_id':_0x318284(0xb3),'name':{'$first':_0x318284(0xb3)}}}]);}else _0x510b90=await warehouse['aggregate']([{'$match':{'status':_0x318284(0x1d3)}},{'$group':{'_id':_0x318284(0xb3),'name':{'$first':_0x318284(0xb3)}}}]);const _0x1e9188=await product['find']({});if(_0x5b5dad[0x0][_0x318284(0x173)]==_0x318284(0x1eb)){var _0x519f87=users[_0x318284(0x108)];console[_0x318284(0x1e7)](_0x519f87);}else{if(_0x5b5dad[0x0][_0x318284(0x173)]==_0x318284(0x159))var _0x519f87=users[_0x318284(0x159)];else{if(_0x5b5dad[0x0]['language']==_0x318284(0x1f5))var _0x519f87=users[_0x318284(0x1f5)];else{if(_0x5b5dad[0x0]['language']==_0x318284(0x188))var _0x519f87=users[_0x318284(0x188)];else{if(_0x5b5dad[0x0][_0x318284(0x173)]==_0x318284(0x140))var _0x519f87=users[_0x318284(0x140)];else{if(_0x5b5dad[0x0]['language']=='Portuguese\x20(BR)')var _0x519f87=users[_0x318284(0x10c)];else{if(_0x5b5dad[0x0]['language']==_0x318284(0x10a))var _0x519f87=users['Chinese'];else{if(_0x5b5dad[0x0][_0x318284(0x173)]==_0x318284(0x170))var _0x519f87=users['Arabic'];}}}}}}}_0x319c97[_0x318284(0x155)](_0x318284(0x185),{'success':_0x30bb66['flash'](_0x318284(0x1c1)),'errors':_0x30bb66[_0x318284(0x1a4)](_0x318284(0xb8)),'role':_0x520ee9,'profile':_0x3ef58a,'customer':_0x21723b,'warehouse':_0x510b90,'product':_0x2c0a4b,'user':_0x500698,'master_shop':_0x5b5dad,'unit':_0x1e9188,'language':_0x519f87,'rooms_data':_0x288346,'ed_fullDate':_0x3e0969});}catch(_0x4e6961){console[_0x318284(0x1e7)](_0x4e6961);}}),router[a0_0x308003(0x1b8)](a0_0x308003(0x186),auth,async(_0x569c16,_0x22d557)=>{var _0x1e8ab9=a0_0x308003;try{const _0xfb3921=_0x569c16[_0x1e8ab9(0x1ef)]['id'],_0x4d3c05=await sales_finished['findOne']({'_id':_0x569c16[_0x1e8ab9(0x1ef)]['id']}),_0x49a68a=await warehouse['findOne']({'name':_0x4d3c05['warehouse_name'],'room':_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0xd6)],'warehouse_category':_0x1e8ab9(0x17c)}),{invoice:_0x2d783c,customer:_0x56888a,date:_0x2be77d,warehouse_name:_0x1cc163,product_name:_0x4b8b9b,stock:_0x49c505,adjust_qty:_0x2bc09a,note:_0xfe023e,room:_0x4b1ab6,primary_code:_0x1de1f4,secondary_code:_0x94689,prod_code:_0x4a1f6a,level:_0x52ac3a,isle:_0x8e57af,pallet:_0x507b3e,expiry_date:_0x438be4}=_0x569c16['body'];if(typeof _0x4b8b9b==_0x1e8ab9(0x1c8))var _0x4a7752=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1d6)]],_0x348c96=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1d4)]],_0x2e88bb=[_0x569c16[_0x1e8ab9(0x136)]['adjust_qty']],_0x5c1614=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1f7)]],_0x2ea10a=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x196)]],_0x2c6e39=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0xbc)]],_0x240ee0=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0xbd)]],_0xb320e5=[_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x19b)]];else var _0x4a7752=[..._0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1d6)]],_0x348c96=[..._0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1d4)]],_0x2e88bb=[..._0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0xa8)]],_0x5c1614=[..._0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1f7)]],_0x2ea10a=[..._0x569c16[_0x1e8ab9(0x136)]['secondary_code']],_0x2c6e39=[..._0x569c16['body'][_0x1e8ab9(0xbc)]],_0x240ee0=[..._0x569c16['body'][_0x1e8ab9(0xbd)]],_0xb320e5=[..._0x569c16['body'][_0x1e8ab9(0x19b)]];const _0x159e75=_0x4a7752[_0x1e8ab9(0xc9)](_0x7dfee=>{return _0x7dfee={'product_name':_0x7dfee};});_0x348c96[_0x1e8ab9(0x16f)]((_0x264172,_0xa4c954)=>{var _0x5da504=_0x1e8ab9;_0x159e75[_0xa4c954][_0x5da504(0x1d4)]=_0x264172;}),_0x2e88bb[_0x1e8ab9(0x16f)]((_0x38ef83,_0x282c28)=>{var _0x4803ad=_0x1e8ab9;_0x159e75[_0x282c28][_0x4803ad(0xcc)]=_0x38ef83;}),_0x5c1614[_0x1e8ab9(0x16f)]((_0x3dfb9d,_0x4c4f54)=>{_0x159e75[_0x4c4f54]['primary_code']=_0x3dfb9d;}),_0x2ea10a[_0x1e8ab9(0x16f)]((_0x25f391,_0x199e07)=>{var _0x17c6b4=_0x1e8ab9;_0x159e75[_0x199e07][_0x17c6b4(0x196)]=_0x25f391;}),_0x2c6e39['forEach']((_0x259d31,_0x3d7c5a)=>{var _0x2d005c=_0x1e8ab9;_0x159e75[_0x3d7c5a][_0x2d005c(0x132)]=_0x259d31;}),_0x240ee0[_0x1e8ab9(0x16f)]((_0x35bc60,_0x145feb)=>{var _0x14c922=_0x1e8ab9;_0x159e75[_0x145feb][_0x14c922(0xbd)]=_0x35bc60;}),_0xb320e5[_0x1e8ab9(0x16f)]((_0x45705a,_0x41fe0f)=>{var _0x4855f4=_0x1e8ab9;_0x159e75[_0x41fe0f][_0x4855f4(0x19b)]=_0x45705a;});var _0x3ea297=0x0;_0x159e75[_0x1e8ab9(0x16f)](_0x58af3e=>{var _0x3d4340=_0x1e8ab9;console['log'](_0x3d4340(0x199),_0x58af3e),(parseInt(_0x58af3e[_0x3d4340(0x1d4)])<parseInt(_0x58af3e['quantity'])||parseInt(_0x58af3e[_0x3d4340(0xcc)])==0x0)&&_0x3ea297++;});if(_0x3ea297!=0x0)return _0x569c16['flash'](_0x1e8ab9(0xb8),_0x1e8ab9(0x148)),_0x22d557[_0x1e8ab9(0x107)](_0x1e8ab9(0x14e));_0x4d3c05['sale_product'][_0x1e8ab9(0x16f)](_0x4ed73f=>{var _0x591ed7=_0x1e8ab9;const _0x1ef44b=_0x49a68a[_0x591ed7(0x1dd)]['map'](_0x19ba9d=>{var _0xa006f5=_0x591ed7;_0x19ba9d[_0xa006f5(0x1d6)]==_0x4ed73f[_0xa006f5(0x1d6)]&&_0x19ba9d[_0xa006f5(0xac)]==_0x4ed73f[_0xa006f5(0xac)]&&(_0x19ba9d[_0xa006f5(0x12e)]=parseInt(_0x19ba9d[_0xa006f5(0x12e)])+parseInt(_0x4ed73f['quantity']));});}),await _0x49a68a[_0x1e8ab9(0xe3)]();const _0x4121c6=_0x159e75[_0x1e8ab9(0xb0)](_0x23fd9e=>_0x23fd9e['quantity']!=='0'&&_0x23fd9e[_0x1e8ab9(0xcc)]!=='');_0x4d3c05[_0x1e8ab9(0x1d0)]=_0x2d783c,_0x4d3c05[_0x1e8ab9(0x198)]=_0x56888a,_0x4d3c05[_0x1e8ab9(0x1ba)]=_0x2be77d,_0x4d3c05[_0x1e8ab9(0x129)]=_0x1cc163,_0x4d3c05[_0x1e8ab9(0x102)]=_0x4121c6,_0x4d3c05['note']=_0xfe023e,_0x4d3c05['room']=_0x4b1ab6;const _0x35442a=await _0x4d3c05[_0x1e8ab9(0xe3)](),_0x9c5271=await sales_finished['findOne']({'_id':_0x569c16[_0x1e8ab9(0x1ef)]['id']}),_0x560f67=await warehouse[_0x1e8ab9(0x103)]({'name':_0x1cc163,'room':_0x4b1ab6,'warehouse_category':'Finished\x20Goods'});_0x9c5271['sale_product']['forEach'](_0x110c29=>{var _0x1ee1f6=_0x1e8ab9;const _0x445de5=_0x560f67[_0x1ee1f6(0x1dd)]['map'](_0x441deb=>{var _0x5996c0=_0x1ee1f6;_0x441deb['product_name']==_0x110c29['product_name']&&_0x441deb['bay']==_0x110c29[_0x5996c0(0xac)]&&(_0x441deb['product_stock']=parseInt(_0x441deb[_0x5996c0(0x12e)])-parseInt(_0x110c29['quantity']));});}),console[_0x1e8ab9(0x1e7)](_0x1e8ab9(0x166),_0x560f67),await _0x560f67[_0x1e8ab9(0xe3)]();const _0x52f918=await c_payment_data[_0x1e8ab9(0x103)]({'invoice':_0x569c16[_0x1e8ab9(0x136)]['invoice']});_0x52f918[_0x1e8ab9(0x1d9)]=_0x569c16[_0x1e8ab9(0x136)][_0x1e8ab9(0x1d9)],await _0x52f918['save'](),_0x569c16[_0x1e8ab9(0x1a4)]('success',_0x1e8ab9(0xdc)),_0x22d557[_0x1e8ab9(0x107)](_0x1e8ab9(0x1e2));}catch(_0x411bf8){console[_0x1e8ab9(0x1e7)](_0x411bf8);}}),router['post'](a0_0x308003(0x16d),auth,async(_0x5e10cd,_0x4cb13d)=>{var _0x3185c9=a0_0x308003;try{const _0x331525=_0x5e10cd[_0x3185c9(0x1ef)]['id'],{invoice:_0x7268cf,customer:_0x39fd7c,receivable_amount:_0x203d3f,received_amount:_0x5e8c22}=_0x5e10cd['body'],_0x53baf2=await sales[_0x3185c9(0x17a)](_0x331525);console[_0x3185c9(0x1e7)](_0x53baf2);var _0x5de060=_0x203d3f-_0x5e8c22;console[_0x3185c9(0x1e7)](_0x5e8c22),_0x53baf2['received_amount']=parseFloat(_0x5e8c22)+parseFloat(_0x53baf2[_0x3185c9(0x1de)]),_0x53baf2[_0x3185c9(0x1b9)]=_0x5de060,console['log'](_0x53baf2);const _0x2b4f7a=await _0x53baf2[_0x3185c9(0xe3)](),_0x431c80=await c_payment_data[_0x3185c9(0x103)]({'invoice':_0x7268cf});_0x431c80[_0x3185c9(0x1ee)]=_0x5de060,await _0x431c80[_0x3185c9(0xe3)]();let _0x564bd7=new Date(),_0x2c7b81=('0'+_0x564bd7[_0x3185c9(0xbb)]())[_0x3185c9(0xd1)](-0x2),_0x25577c=('0'+(_0x564bd7[_0x3185c9(0xaf)]()+0x1))[_0x3185c9(0xd1)](-0x2),_0x4be256=_0x564bd7[_0x3185c9(0x197)](),_0x134816=_0x4be256+'-'+_0x25577c+'-'+_0x2c7b81;const _0x14592a=new customer_payment({'invoice':_0x7268cf,'date':_0x4be256+'-'+_0x25577c+'-'+_0x2c7b81,'customer':_0x39fd7c,'reason':_0x3185c9(0x1c7),'amount':_0x5e8c22}),_0x3acc57=await _0x14592a['save']();_0x5e10cd[_0x3185c9(0x1a4)](_0x3185c9(0x1c1),_0x3185c9(0xdd)),_0x4cb13d[_0x3185c9(0x107)]('/all_sales/view');}catch(_0x470706){console[_0x3185c9(0x1e7)](_0x470706);}}),router['get'](a0_0x308003(0x1c0),auth,async(_0x15b452,_0x445af6)=>{var _0xd56812=a0_0x308003;try{const {username:_0x5d5fb6,email:_0xd29679,role:_0x5bcde9}=_0x15b452[_0xd56812(0xc4)],_0x35f2eb=_0x15b452[_0xd56812(0xc4)],_0x5aef31=await profile[_0xd56812(0x103)]({'email':_0x35f2eb[_0xd56812(0x1cd)]}),_0x2b546b=await master_shop[_0xd56812(0x111)]();console[_0xd56812(0x1e7)]('master',_0x2b546b);const _0x572522=_0x15b452[_0xd56812(0x1ef)]['id'],_0x466641=await sales[_0xd56812(0x17a)](_0x572522);console[_0xd56812(0x1e7)](_0x466641);const _0xbf2708=await customer[_0xd56812(0x103)]({'name':_0x466641[_0xd56812(0x198)]});console[_0xd56812(0x1e7)](_0xbf2708);if(_0x2b546b[0x0][_0xd56812(0x173)]=='English\x20(US)'){var _0x3bf56d=users['English'];console[_0xd56812(0x1e7)](_0x3bf56d);}else{if(_0x2b546b[0x0][_0xd56812(0x173)]==_0xd56812(0x159))var _0x3bf56d=users[_0xd56812(0x159)];else{if(_0x2b546b[0x0][_0xd56812(0x173)]==_0xd56812(0x1f5))var _0x3bf56d=users[_0xd56812(0x1f5)];else{if(_0x2b546b[0x0]['language']==_0xd56812(0x188))var _0x3bf56d=users[_0xd56812(0x188)];else{if(_0x2b546b[0x0][_0xd56812(0x173)]=='French')var _0x3bf56d=users[_0xd56812(0x140)];else{if(_0x2b546b[0x0][_0xd56812(0x173)]==_0xd56812(0x1cb))var _0x3bf56d=users['Portuguese'];else{if(_0x2b546b[0x0][_0xd56812(0x173)]==_0xd56812(0x10a))var _0x3bf56d=users[_0xd56812(0x10a)];else{if(_0x2b546b[0x0][_0xd56812(0x173)]==_0xd56812(0x170))var _0x3bf56d=users[_0xd56812(0x12f)];}}}}}}}_0x445af6[_0xd56812(0x155)](_0xd56812(0x19f),{'success':_0x15b452['flash'](_0xd56812(0x1c1)),'errors':_0x15b452['flash'](_0xd56812(0xb8)),'role':_0x35f2eb,'profile':_0x5aef31,'master_shop':_0x2b546b,'customers':_0xbf2708,'sales':_0x466641,'language':_0x3bf56d});}catch(_0x5b9bfb){console[_0xd56812(0x1e7)](_0x5b9bfb);}}),router[a0_0x308003(0x1da)]('/view/return_sales/:id',auth,async(_0x1b0b38,_0x1604bb)=>{var _0x5d884a=a0_0x308003;try{const {username:_0x4a1a0d,email:_0x3c154b,role:_0x30ca6e}=_0x1b0b38[_0x5d884a(0xc4)],_0x51154c=_0x1b0b38[_0x5d884a(0xc4)],_0x26e9ee=await profile[_0x5d884a(0x103)]({'email':_0x51154c[_0x5d884a(0x1cd)]}),_0x3e45b2=await master_shop['find'](),_0x18afb3=_0x1b0b38[_0x5d884a(0x1ef)]['id'],_0x49ec5e=await sales_finished[_0x5d884a(0x17a)](_0x18afb3),_0x4805f3=await warehouse[_0x5d884a(0x130)]([{'$match':{'name':_0x49ec5e['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5d884a(0x145),'name':{'$first':_0x5d884a(0x11f)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5d884a(0xb9)},'bin':{'$first':_0x5d884a(0x1ed)},'type':{'$first':_0x5d884a(0x116)},'floorlevel':{'$first':_0x5d884a(0x1ec)},'primary_code':{'$first':_0x5d884a(0xd5)},'secondary_code':{'$first':_0x5d884a(0x114)},'product_code':{'$first':_0x5d884a(0xdf)},'storage':{'$first':_0x5d884a(0x182)},'rack':{'$first':_0x5d884a(0x162)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5d884a(0x15a)},'unit':{'$first':_0x5d884a(0x1c2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x5d884a(0xe0)},'batch_code':{'$first':_0x5d884a(0xa7)},'maxPerUnit':{'$first':_0x5d884a(0xd7)}}}]),_0x522e39=await product[_0x5d884a(0x111)]({}),_0x3bee8a=await warehouse['aggregate']([{'$match':{'status':_0x5d884a(0x1d3),'warehouse_category':_0x5d884a(0x17c),'name':{'$ne':_0x5d884a(0x164),'$ne':_0x5d884a(0x18c)}}},{'$group':{'_id':_0x5d884a(0xb3),'name':{'$first':_0x5d884a(0xb3)}}},{'$sort':{'name':0x1}}]);var _0x4a5513=[_0x5d884a(0x157)];const _0x24966a=await warehouse['aggregate']([{'$match':{'status':_0x5d884a(0x1d3),'name':_0x5d884a(0x18c)}},{'$group':{'_id':_0x5d884a(0xb3),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x3e45b2[0x0][_0x5d884a(0x173)]==_0x5d884a(0x1eb)){var _0x3701e6=users[_0x5d884a(0x108)];console[_0x5d884a(0x1e7)](_0x3701e6);}else{if(_0x3e45b2[0x0][_0x5d884a(0x173)]==_0x5d884a(0x159))var _0x3701e6=users[_0x5d884a(0x159)];else{if(_0x3e45b2[0x0][_0x5d884a(0x173)]=='German')var _0x3701e6=users[_0x5d884a(0x1f5)];else{if(_0x3e45b2[0x0][_0x5d884a(0x173)]=='Spanish')var _0x3701e6=users['Spanish'];else{if(_0x3e45b2[0x0]['language']==_0x5d884a(0x140))var _0x3701e6=users[_0x5d884a(0x140)];else{if(_0x3e45b2[0x0][_0x5d884a(0x173)]=='Portuguese\x20(BR)')var _0x3701e6=users[_0x5d884a(0x10c)];else{if(_0x3e45b2[0x0][_0x5d884a(0x173)]=='Chinese')var _0x3701e6=users[_0x5d884a(0x10a)];else{if(_0x3e45b2[0x0][_0x5d884a(0x173)]==_0x5d884a(0x170))var _0x3701e6=users[_0x5d884a(0x12f)];}}}}}}}_0x1604bb['render']('return_sale_finished',{'success':_0x1b0b38[_0x5d884a(0x1a4)](_0x5d884a(0x1c1)),'errors':_0x1b0b38['flash'](_0x5d884a(0xb8)),'role':_0x51154c,'profile':_0x26e9ee,'user':_0x49ec5e,'stock':_0x4805f3,'master_shop':_0x3e45b2,'unit':_0x522e39,'language':_0x3701e6,'warehouses':_0x3bee8a,'rooms':_0x4a5513,'warehouse_QA':_0x24966a});}catch(_0x6bfa3e){console['log'](_0x6bfa3e),_0x1604bb[_0x5d884a(0x110)](0xc8)[_0x5d884a(0x1b6)]({'message':_0x6bfa3e[_0x5d884a(0x1cf)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x2fad4b,_0x59f286)=>{var _0x5c46a1=a0_0x308003;if(_0x2fad4b['body'][_0x5c46a1(0x13c)]=='QA')try{const {invoice:_0x1b8513,date:_0x536dcb,warehouse_name:_0x352dc2,product_name:_0x3581e6,primary_code:_0x2a61de,secondary_code:_0x520f14,product_code:_0x41b109,sales_quantity:_0x399e1f,stocks:_0x243d3b,return_qty:_0x2450ef,Room_name:_0x13c257,to_warehouse_name_QA:_0x15e675,to_Room_name_QA:_0x20b764,note:_0x394648,for_categorize:_0x224f12,product_name_QA1:_0x1872c8}=_0x2fad4b['body'];if(typeof _0x1872c8==_0x5c46a1(0x1c8))var _0x20ed3d=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x13b)]],_0x105a68=[_0x2fad4b['body'][_0x5c46a1(0x1f3)]],_0x4d526a=[_0x2fad4b['body'][_0x5c46a1(0x128)]],_0x213f68=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xc6)]],_0x5860d1=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x104)]],_0x2d03af=[_0x2fad4b['body'][_0x5c46a1(0x19c)]],_0x2c8383=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xb5)]],_0x5eba4b=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x1e9)]],_0x432e24=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x10f)]],_0x15843c=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x1e1)]],_0x85d0ef=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x176)]],_0x176752=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x18e)]],_0x4f2355=[_0x2fad4b[_0x5c46a1(0x136)]['production_date_QA']],_0x328fef=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x15e)]];else var _0x20ed3d=[..._0x2fad4b['body'][_0x5c46a1(0x13b)]],_0x105a68=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x1f3)]],_0x4d526a=[..._0x2fad4b[_0x5c46a1(0x136)]['secondary_code_QA']],_0x213f68=[..._0x2fad4b[_0x5c46a1(0x136)]['product_code_QA']],_0x5860d1=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x104)]],_0x2d03af=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x19c)]],_0x2c8383=[..._0x2fad4b[_0x5c46a1(0x136)]['return_qty_QA']],_0x5eba4b=[..._0x2fad4b['body'][_0x5c46a1(0x1e9)]],_0x432e24=[..._0x2fad4b[_0x5c46a1(0x136)]['maxProducts_QA']],_0x15843c=[..._0x2fad4b['body']['batch_code_QA']],_0x85d0ef=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x176)]],_0x176752=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x18e)]],_0x4f2355=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x12a)]],_0x328fef=[..._0x2fad4b[_0x5c46a1(0x136)]['expiry_date_QA']];const _0x48a2fd=_0x20ed3d[_0x5c46a1(0xc9)](_0x362dec=>{return _0x362dec={'product_name':_0x362dec};});_0x105a68['forEach']((_0x103ecd,_0x822842)=>{var _0x2c4f8e=_0x5c46a1;_0x48a2fd[_0x822842][_0x2c4f8e(0x1f7)]=_0x103ecd;}),_0x4d526a[_0x5c46a1(0x16f)]((_0x555672,_0x209e81)=>{var _0x414240=_0x5c46a1;_0x48a2fd[_0x209e81][_0x414240(0x196)]=_0x555672;}),_0x213f68[_0x5c46a1(0x16f)]((_0x211dc5,_0x443455)=>{var _0x42265d=_0x5c46a1;_0x48a2fd[_0x443455][_0x42265d(0x132)]=_0x211dc5;}),_0x5860d1[_0x5c46a1(0x16f)]((_0x154537,_0x4eccfb)=>{var _0x5da04a=_0x5c46a1;_0x48a2fd[_0x4eccfb][_0x5da04a(0x1e4)]=_0x154537;}),_0x2d03af[_0x5c46a1(0x16f)]((_0x12e3bb,_0x38ef9b)=>{_0x48a2fd[_0x38ef9b]['stock']=_0x12e3bb;}),_0x2c8383[_0x5c46a1(0x16f)]((_0x2a9aff,_0x33184f)=>{var _0x115e47=_0x5c46a1;_0x48a2fd[_0x33184f][_0x115e47(0x149)]=_0x2a9aff;}),_0x5eba4b[_0x5c46a1(0x16f)]((_0x43dfc7,_0x12944a)=>{var _0x54050c=_0x5c46a1;_0x48a2fd[_0x12944a][_0x54050c(0xf9)]=_0x43dfc7;}),_0x432e24['forEach']((_0x27effc,_0x57ecc0)=>{var _0x2fd060=_0x5c46a1;_0x48a2fd[_0x57ecc0][_0x2fd060(0x1f8)]=_0x27effc;}),_0x15843c[_0x5c46a1(0x16f)]((_0x42424e,_0x5043fd)=>{var _0x80c685=_0x5c46a1;_0x48a2fd[_0x5043fd][_0x80c685(0x11a)]=_0x42424e;}),_0x85d0ef[_0x5c46a1(0x16f)]((_0x5e13f2,_0x26dc93)=>{var _0x2fe246=_0x5c46a1;_0x48a2fd[_0x26dc93][_0x2fe246(0x1d5)]=_0x5e13f2;}),_0x176752[_0x5c46a1(0x16f)]((_0x104aab,_0x22ad60)=>{var _0x3f7a96=_0x5c46a1;_0x48a2fd[_0x22ad60][_0x3f7a96(0xcf)]=_0x104aab;}),_0x4f2355[_0x5c46a1(0x16f)]((_0x5893be,_0x24ea28)=>{var _0x18c1a9=_0x5c46a1;_0x48a2fd[_0x24ea28][_0x18c1a9(0xca)]=_0x5893be;}),_0x328fef[_0x5c46a1(0x16f)]((_0x11841b,_0x1992ef)=>{var _0x3c1df6=_0x5c46a1;_0x48a2fd[_0x1992ef][_0x3c1df6(0x19b)]=_0x11841b;});const _0x2d3972=await sales_finished['findOne']({'invoice':_0x1b8513});_0x2d3972[_0x5c46a1(0xcd)]=_0x5c46a1(0x123);const _0x2b8032=await _0x2d3972[_0x5c46a1(0xe3)](),_0x58e134=new sales_return_finished({'invoice':_0x1b8513,'customer':_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x198)],'date':_0x536dcb,'warehouse_name':_0x352dc2,'room':_0x13c257,'ToWarehouse':_0x15e675,'ToRoom':_0x20b764,'return_sale_QA':_0x48a2fd,'note':_0x394648,'warehouse_cat':_0x224f12}),_0x20d0e4=await _0x58e134[_0x5c46a1(0xe3)](),_0x818772=await sales_return_finished[_0x5c46a1(0x103)]({'invoice':_0x1b8513}),_0x64892b=await warehouse[_0x5c46a1(0x103)]({'name':_0x15e675,'room':_0x20b764});_0x818772[_0x5c46a1(0x1f9)][_0x5c46a1(0x16f)](_0xb09f97=>{var _0x21be8a=_0x5c46a1,_0x375d36=0x0;const _0x12d0fb=_0x64892b[_0x21be8a(0x1dd)][_0x21be8a(0xc9)](_0x7081a1=>{var _0x551edc=_0x21be8a;_0x7081a1[_0x551edc(0x1d6)]==_0xb09f97[_0x551edc(0x1d6)]&&_0x7081a1[_0x551edc(0x19b)]==_0xb09f97[_0x551edc(0x19b)]&&_0x7081a1['production_date']==_0xb09f97[_0x551edc(0xca)]&&_0x7081a1['batch_code']==_0xb09f97[_0x551edc(0x11a)]&&(_0x7081a1['product_stock']=parseInt(_0x7081a1[_0x551edc(0x12e)])+parseInt(_0xb09f97['return_qty']),_0x375d36++);});_0x375d36=='0'&&(_0x64892b[_0x21be8a(0x1dd)]=_0x64892b[_0x21be8a(0x1dd)][_0x21be8a(0xd4)]({'product_name':_0xb09f97['product_name'],'product_stock':_0xb09f97[_0x21be8a(0x149)],'primary_code':_0xb09f97[_0x21be8a(0x1f7)],'secondary_code':_0xb09f97['secondary_code'],'product_code':_0xb09f97[_0x21be8a(0x132)],'batch_code':_0xb09f97[_0x21be8a(0x11a)],'maxPerUnit':_0xb09f97['maxPerUnit'],'production_date':_0xb09f97[_0x21be8a(0xca)],'expiry_date':_0xb09f97[_0x21be8a(0x19b)],'secondary_unit':_0xb09f97[_0x21be8a(0x1d5)],'unit':_0xb09f97[_0x21be8a(0xcf)],'maxProducts':_0xb09f97[_0x21be8a(0x1f8)],'bay':_0xb09f97['bay']}));}),await _0x64892b[_0x5c46a1(0xe3)]();const _0x20218a=new c_payment_data({'invoice':_0x1b8513,'customer':_0x2fad4b[_0x5c46a1(0x136)]['customer'],'reason':_0x5c46a1(0x1c6)});await _0x20218a[_0x5c46a1(0xe3)]();const _0x4407d8=await master_shop[_0x5c46a1(0x111)](),_0x2c26c0=await email_settings[_0x5c46a1(0x103)](),_0x51dc1d=await customer[_0x5c46a1(0x103)]({'name':_0x2fad4b[_0x5c46a1(0x136)]['customer']});_0x4407d8[0x0][_0x5c46a1(0x11b)]==0x1?(right_currency=_0x4407d8[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4407d8[0x0][_0x5c46a1(0x12d)]);var _0xc7cd17=_0x20ed3d,_0x3f7e24=_0x2c8383,_0x14e488='',_0x49c6bf;for(_0x49c6bf in _0xc7cd17){_0x14e488+=_0x5c46a1(0xf3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc7cd17[_0x49c6bf]+_0x5c46a1(0x1b1)+_0x5c46a1(0xda)+_0x3f7e24[_0x49c6bf]+_0x5c46a1(0x1b1)+_0x5c46a1(0x17d);}console[_0x5c46a1(0x1e7)](_0x5c46a1(0xf2),_0x14e488);let _0x45d0b3=nodemailer[_0x5c46a1(0xec)]({'service':_0x5c46a1(0xfc),'auth':{'user':_0x2c26c0[_0x5c46a1(0x1cd)],'pass':_0x2c26c0[_0x5c46a1(0x160)]}}),_0x310159={'from':_0x2c26c0[_0x5c46a1(0x1cd)],'to':_0x51dc1d[_0x5c46a1(0x1cd)],'subject':_0x5c46a1(0x14b),'attachments':[{'filename':_0x5c46a1(0x1db),'path':__dirname+_0x5c46a1(0x152)+'/upload/'+_0x4407d8[0x0][_0x5c46a1(0x10d)],'cid':_0x5c46a1(0x181)}],'html':_0x5c46a1(0xb7)+_0x5c46a1(0xd0)+_0x5c46a1(0xeb)+_0x5c46a1(0xd8)+_0x5c46a1(0x1b4)+_0x5c46a1(0xd8)+_0x5c46a1(0xaa)+_0x5c46a1(0x194)+_0x5c46a1(0xd8)+'<h2>\x20'+_0x4407d8[0x0][_0x5c46a1(0x127)]+_0x5c46a1(0x1ad)+_0x5c46a1(0x194)+'</div>'+_0x5c46a1(0x1c3)+_0x5c46a1(0xd8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5c46a1(0x168)+_0x1b8513+'\x20'+_0x5c46a1(0xfd)+'\x20Order\x20Date\x20:\x20'+_0x536dcb+'\x20'+_0x5c46a1(0xd9)+'</h5>'+_0x5c46a1(0x194)+_0x5c46a1(0x1ca)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5c46a1(0xf3)+_0x5c46a1(0x131)+_0x5c46a1(0xc3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x5c46a1(0x17d)+_0x5c46a1(0x126)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x14e488+'\x20'+'</tbody>'+_0x5c46a1(0xdb)+_0x5c46a1(0xd8)+_0x5c46a1(0x19d)+_0x5c46a1(0x14f)+_0x4407d8[0x0][_0x5c46a1(0x127)]+_0x5c46a1(0x133)+_0x5c46a1(0x194)+_0x5c46a1(0x194)+_0x5c46a1(0xe4)};_0x45d0b3['sendMail'](_0x310159,function(_0x1e2d1d,_0x54231c){var _0x5751e4=_0x5c46a1;_0x1e2d1d?(console[_0x5751e4(0x1e7)](_0x1e2d1d),console[_0x5751e4(0x1e7)](_0x5751e4(0x189))):console[_0x5751e4(0x1e7)](_0x5751e4(0xe5));}),_0x2fad4b[_0x5c46a1(0x1a4)](_0x5c46a1(0x1c1),_0x5c46a1(0x1b7)),_0x59f286[_0x5c46a1(0x107)](_0x5c46a1(0x1e2));}catch(_0x3b5105){_0x59f286[_0x5c46a1(0x110)](0xc8)[_0x5c46a1(0x1b6)]({'message1':_0x3b5105[_0x5c46a1(0x1cf)]});}else{if(_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x13c)]=='GS')try{const {invoice:_0x2b48f7,date:_0x384f66,warehouse_name:_0x3d0e14,product_name:_0x1b5f96,primary_code:_0x4edd05,secondary_code:_0x34a18e,product_code:_0x2b3abd,sales_quantity:_0xb33235,stocks:_0x106b6d,return_qty:_0x1bcfec,Room_name:_0x252380,to_warehouse_name:_0x12582a,to_Room_name:_0x2a8ac3,note:_0x733935,level:_0x35e85b,isle:_0x5aea07,pallet:_0x3f3409,for_categorize:_0x453bab}=_0x2fad4b[_0x5c46a1(0x136)];if(typeof _0x1b5f96==_0x5c46a1(0x1c8))var _0x20ed3d=[_0x2fad4b['body'][_0x5c46a1(0x1d6)]],_0x105a68=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x1f7)]],_0x4d526a=[_0x2fad4b['body']['secondary_code']],_0x213f68=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x132)]],_0x5860d1=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xe1)]],_0x2c8383=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x149)]],_0x52342a=[_0x2fad4b[_0x5c46a1(0x136)]['bay']],_0x5eba4b=[_0x2fad4b['body'][_0x5c46a1(0xf9)]],_0x432e24=[_0x2fad4b['body'][_0x5c46a1(0x1f8)]],_0x15843c=[_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x11a)]],_0x85d0ef=[_0x2fad4b['body'][_0x5c46a1(0x1d5)]],_0x176752=[_0x2fad4b[_0x5c46a1(0x136)]['unit']],_0x4f2355=[_0x2fad4b['body'][_0x5c46a1(0xca)]],_0x328fef=[_0x2fad4b[_0x5c46a1(0x136)]['expiry_date']];else var _0x20ed3d=[..._0x2fad4b['body'][_0x5c46a1(0x1d6)]],_0x105a68=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x1f7)]],_0x4d526a=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x196)]],_0x213f68=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x132)]],_0x5860d1=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xe1)]],_0x2c8383=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x149)]],_0x52342a=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xac)]],_0x5eba4b=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xf9)]],_0x432e24=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x1f8)]],_0x15843c=[..._0x2fad4b[_0x5c46a1(0x136)]['batch_code']],_0x85d0ef=[..._0x2fad4b['body']['secondary_unit']],_0x176752=[..._0x2fad4b['body'][_0x5c46a1(0xcf)]],_0x4f2355=[..._0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0xca)]],_0x328fef=[..._0x2fad4b['body'][_0x5c46a1(0x19b)]];const _0x3bcb7a=_0x20ed3d['map'](_0x2e9d64=>{return _0x2e9d64={'product_name':_0x2e9d64};});_0x105a68[_0x5c46a1(0x16f)]((_0x48c142,_0x5d9427)=>{var _0x17fc3c=_0x5c46a1;_0x3bcb7a[_0x5d9427][_0x17fc3c(0x1f7)]=_0x48c142;}),_0x4d526a[_0x5c46a1(0x16f)]((_0x10e8b8,_0x4d9ab3)=>{var _0x2ce513=_0x5c46a1;_0x3bcb7a[_0x4d9ab3][_0x2ce513(0x196)]=_0x10e8b8;}),_0x213f68['forEach']((_0x3e8d45,_0x597caa)=>{var _0x304b63=_0x5c46a1;_0x3bcb7a[_0x597caa][_0x304b63(0x132)]=_0x3e8d45;}),_0x5860d1[_0x5c46a1(0x16f)]((_0xc8a40b,_0x340f13)=>{var _0x203009=_0x5c46a1;_0x3bcb7a[_0x340f13][_0x203009(0x1e4)]=_0xc8a40b;}),_0x2c8383[_0x5c46a1(0x16f)]((_0x1ad63e,_0x4ac3c6)=>{_0x3bcb7a[_0x4ac3c6]['return_qty']=_0x1ad63e;}),_0x52342a['forEach']((_0x51566f,_0x19a535)=>{_0x3bcb7a[_0x19a535]['bay']=_0x51566f;}),_0x5eba4b[_0x5c46a1(0x16f)]((_0x5cbbae,_0x17d7f3)=>{var _0x70a24b=_0x5c46a1;_0x3bcb7a[_0x17d7f3][_0x70a24b(0xf9)]=_0x5cbbae;}),_0x432e24['forEach']((_0x5c2558,_0x2215e8)=>{var _0x3dc959=_0x5c46a1;_0x3bcb7a[_0x2215e8][_0x3dc959(0x1f8)]=_0x5c2558;}),_0x15843c[_0x5c46a1(0x16f)]((_0x4c4a20,_0x386595)=>{_0x3bcb7a[_0x386595]['batch_code']=_0x4c4a20;}),_0x85d0ef[_0x5c46a1(0x16f)]((_0x3435e8,_0x543d75)=>{var _0x23930f=_0x5c46a1;_0x3bcb7a[_0x543d75][_0x23930f(0x1d5)]=_0x3435e8;}),_0x176752['forEach']((_0x1fe777,_0x3d61fc)=>{var _0x38a898=_0x5c46a1;_0x3bcb7a[_0x3d61fc][_0x38a898(0xcf)]=_0x1fe777;}),_0x4f2355[_0x5c46a1(0x16f)]((_0x4793f5,_0x24faa5)=>{var _0xe7111f=_0x5c46a1;_0x3bcb7a[_0x24faa5][_0xe7111f(0xca)]=_0x4793f5;}),_0x328fef[_0x5c46a1(0x16f)]((_0x4d380e,_0x33f21f)=>{var _0x4db32d=_0x5c46a1;_0x3bcb7a[_0x33f21f][_0x4db32d(0x19b)]=_0x4d380e;});var _0x1d790a=0x0;_0x3bcb7a[_0x5c46a1(0x16f)](_0xf9aebf=>{var _0x5be0aa=_0x5c46a1;(parseInt(_0xf9aebf[_0x5be0aa(0x1e4)])<parseInt(_0xf9aebf[_0x5be0aa(0x149)])||parseInt(_0xf9aebf[_0x5be0aa(0x1d4)])<parseInt(_0xf9aebf['return_qty'])&&parseInt(_0xf9aebf['sale_qty'])>parseInt(_0xf9aebf['return_qty'])||parseInt(_0xf9aebf[_0x5be0aa(0x149)])==0x0)&&_0x1d790a++;});if(_0x1d790a!=0x0)return _0x2fad4b['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x59f286[_0x5c46a1(0x107)](_0x5c46a1(0x14e));const _0x1c17d5=await sales_finished[_0x5c46a1(0x103)]({'invoice':_0x2b48f7});_0x1c17d5[_0x5c46a1(0xcd)]='True';const _0x3e37c8=await _0x1c17d5[_0x5c46a1(0xe3)](),_0x196725=new sales_return_finished({'invoice':_0x2b48f7,'customer':_0x2fad4b[_0x5c46a1(0x136)]['customer'],'date':_0x384f66,'warehouse_name':_0x3d0e14,'room':_0x252380,'ToWarehouse':_0x12582a,'ToRoom':_0x2a8ac3,'return_sale':_0x3bcb7a,'note':_0x733935,'warehouse_cat':_0x453bab}),_0x1dc2d3=await _0x196725[_0x5c46a1(0xe3)](),_0x2e580c=await sales_return_finished[_0x5c46a1(0x103)]({'invoice':_0x2b48f7}),_0x233a5f=await warehouse[_0x5c46a1(0x103)]({'name':_0x12582a,'room':_0x2a8ac3,'warehouse_category':'Finished\x20Goods'});_0x2e580c[_0x5c46a1(0x1b0)][_0x5c46a1(0x16f)](_0x5993cc=>{var _0x5d3025=_0x5c46a1,_0x5c9812=0x0;const _0x3da399=_0x233a5f[_0x5d3025(0x1dd)][_0x5d3025(0xc9)](_0x2fe37f=>{var _0x406d72=_0x5d3025;_0x2fe37f[_0x406d72(0x1d6)]==_0x5993cc[_0x406d72(0x1d6)]&&_0x2fe37f[_0x406d72(0xac)]==_0x5993cc['bay']&&_0x2fe37f[_0x406d72(0x19b)]==_0x5993cc['expiry_date']&&_0x2fe37f['production_date']==_0x5993cc['production_date']&&_0x2fe37f[_0x406d72(0x11a)]==_0x5993cc[_0x406d72(0x11a)]&&(_0x2fe37f['product_stock']=parseInt(_0x2fe37f[_0x406d72(0x12e)])+parseInt(_0x5993cc['return_qty']),_0x5c9812++);});_0x5c9812=='0'&&(_0x233a5f[_0x5d3025(0x1dd)]=_0x233a5f['product_details'][_0x5d3025(0xd4)]({'product_name':_0x5993cc[_0x5d3025(0x1d6)],'product_stock':_0x5993cc['return_qty'],'primary_code':_0x5993cc['primary_code'],'secondary_code':_0x5993cc[_0x5d3025(0x196)],'product_code':_0x5993cc[_0x5d3025(0x132)],'bay':_0x5993cc[_0x5d3025(0xac)],'batch_code':_0x5993cc['batch_code'],'maxPerUnit':_0x5993cc[_0x5d3025(0xf9)],'production_date':_0x5993cc[_0x5d3025(0xca)],'expiry_date':_0x5993cc[_0x5d3025(0x19b)],'secondary_unit':_0x5993cc[_0x5d3025(0x1d5)],'unit':_0x5993cc[_0x5d3025(0xcf)],'maxProducts':_0x5993cc['maxProducts']}));}),await _0x233a5f[_0x5c46a1(0xe3)](),console['log'](_0x2fad4b[_0x5c46a1(0x136)]);const _0x27b6e0=new c_payment_data({'invoice':_0x2b48f7,'customer':_0x2fad4b[_0x5c46a1(0x136)]['customer'],'reason':'Sale\x20Return'});await _0x27b6e0[_0x5c46a1(0xe3)]();const _0x1eabd9=await master_shop[_0x5c46a1(0x111)]();console[_0x5c46a1(0x1e7)]('add\x20post',_0x1eabd9[0x0][_0x5c46a1(0x10d)]);const _0x2d2835=await email_settings[_0x5c46a1(0x103)](),_0x3251ed=await customer[_0x5c46a1(0x103)]({'name':_0x2fad4b[_0x5c46a1(0x136)][_0x5c46a1(0x198)]});console[_0x5c46a1(0x1e7)](_0x5c46a1(0x1cc),_0x3251ed);_0x1eabd9[0x0][_0x5c46a1(0x11b)]==0x1?(right_currency=_0x1eabd9[0x0][_0x5c46a1(0x12d)],left_currency=''):(right_currency='',left_currency=_0x1eabd9[0x0]['currency']);var _0xc7cd17=_0x20ed3d,_0x3f7e24=_0x2c8383,_0x14e488='',_0x49c6bf;for(_0x49c6bf in _0xc7cd17){_0x14e488+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc7cd17[_0x49c6bf]+'</td>'+_0x5c46a1(0xda)+_0x3f7e24[_0x49c6bf]+_0x5c46a1(0x1b1)+_0x5c46a1(0x17d);}console[_0x5c46a1(0x1e7)](_0x5c46a1(0xf2),_0x14e488);let _0x52a72b=nodemailer[_0x5c46a1(0xec)]({'service':'gmail','auth':{'user':_0x2d2835[_0x5c46a1(0x1cd)],'pass':_0x2d2835[_0x5c46a1(0x160)]}}),_0x4ad23a={'from':_0x2d2835['email'],'to':_0x3251ed[_0x5c46a1(0x1cd)],'subject':_0x5c46a1(0x14b),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5c46a1(0x152)+_0x5c46a1(0x158)+_0x1eabd9[0x0]['image'],'cid':_0x5c46a1(0x181)}],'html':_0x5c46a1(0xb7)+_0x5c46a1(0xd0)+_0x5c46a1(0xeb)+_0x5c46a1(0xd8)+_0x5c46a1(0x1b4)+'<div>'+_0x5c46a1(0xaa)+_0x5c46a1(0x194)+_0x5c46a1(0xd8)+'<h2>\x20'+_0x1eabd9[0x0][_0x5c46a1(0x127)]+_0x5c46a1(0x1ad)+_0x5c46a1(0x194)+'</div>'+_0x5c46a1(0x1c3)+_0x5c46a1(0xd8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5c46a1(0x168)+_0x2b48f7+'\x20'+_0x5c46a1(0xfd)+'\x20Order\x20Date\x20:\x20'+_0x384f66+'\x20'+_0x5c46a1(0xd9)+'</h5>'+_0x5c46a1(0x194)+_0x5c46a1(0x1ca)+_0x5c46a1(0x1a7)+_0x5c46a1(0xf3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5c46a1(0xc3)+_0x5c46a1(0x124)+_0x5c46a1(0xf5)+'</tr>'+'</thead>'+_0x5c46a1(0x141)+'\x20'+_0x14e488+'\x20'+_0x5c46a1(0x150)+_0x5c46a1(0xdb)+_0x5c46a1(0xd8)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x1eabd9[0x0][_0x5c46a1(0x127)]+_0x5c46a1(0x133)+'</div>'+'</div>'+_0x5c46a1(0xe4)};_0x52a72b[_0x5c46a1(0xc0)](_0x4ad23a,function(_0x56d5c4,_0x48d533){var _0xb9a237=_0x5c46a1;_0x56d5c4?(console[_0xb9a237(0x1e7)](_0x56d5c4),console['log'](_0xb9a237(0x189))):console[_0xb9a237(0x1e7)]('Email\x20sent\x20successfully');}),_0x2fad4b[_0x5c46a1(0x1a4)](_0x5c46a1(0x1c1),_0x5c46a1(0x1b7)),_0x59f286[_0x5c46a1(0x107)]('/all_sales_finished/view');}catch(_0x6a4099){console[_0x5c46a1(0x1e7)](_0x6a4099),_0x59f286[_0x5c46a1(0x110)](0xc8)[_0x5c46a1(0x1b6)]({'message1':_0x6a4099['message']});}}}),router['get'](a0_0x308003(0x17e),auth,async(_0x261c3f,_0x4faf60)=>{var _0x30a7ec=a0_0x308003;try{const {username:_0x262dd2,email:_0x513dbd,role:_0x244e71}=_0x261c3f[_0x30a7ec(0xc4)],_0x398751=_0x261c3f['user'],_0x4028c3=await profile[_0x30a7ec(0x103)]({'email':_0x398751[_0x30a7ec(0x1cd)]}),_0x48dd79=await master_shop[_0x30a7ec(0x111)]();console[_0x30a7ec(0x1e7)](_0x30a7ec(0xe9),_0x48dd79);const _0x3b5a62=_0x261c3f[_0x30a7ec(0x1ef)]['id'],_0x4c3827=await sales['findById'](_0x3b5a62);console[_0x30a7ec(0x1e7)](_0x30a7ec(0x1a1),_0x4c3827);if(_0x48dd79[0x0][_0x30a7ec(0x173)]=='English\x20(US)')var _0x305299=users[_0x30a7ec(0x108)];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]==_0x30a7ec(0x159))var _0x305299=users['Hindi'];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]==_0x30a7ec(0x1f5))var _0x305299=users[_0x30a7ec(0x1f5)];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]=='Spanish')var _0x305299=users[_0x30a7ec(0x188)];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]==_0x30a7ec(0x140))var _0x305299=users[_0x30a7ec(0x140)];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]==_0x30a7ec(0x1cb))var _0x305299=users[_0x30a7ec(0x10c)];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]==_0x30a7ec(0x10a))var _0x305299=users['Chinese'];else{if(_0x48dd79[0x0][_0x30a7ec(0x173)]==_0x30a7ec(0x170))var _0x305299=users[_0x30a7ec(0x12f)];}}}}}}}_0x4faf60[_0x30a7ec(0x155)](_0x30a7ec(0x1e5),{'success':_0x261c3f[_0x30a7ec(0x1a4)](_0x30a7ec(0x1c1)),'errors':_0x261c3f[_0x30a7ec(0x1a4)](_0x30a7ec(0xb8)),'role':_0x398751,'profile':_0x4028c3,'alldata':_0x4c3827,'master_shop':_0x48dd79,'language':_0x305299});}catch(_0x859dc1){console[_0x30a7ec(0x1e7)](_0x859dc1);}}),router[a0_0x308003(0x1b8)](a0_0x308003(0x121),async(_0x26d6aa,_0x203d6e)=>{var _0x5d5615=a0_0x308003;const {product_code:_0x2334dc,warehouse_name:_0x12f85f,rooms_data:_0x205fb5,Roomslist:_0x18dc05,sales_category:_0x381859}=_0x26d6aa['body'],_0x28f912=_0x18dc05[_0x5d5615(0x134)](','),_0x1700f4=[];async function _0x486f85(_0x4498d6){var _0xd26c61=_0x5d5615;const _0x51b578=await warehouse[_0xd26c61(0x130)]([{'$match':{'name':_0x12f85f,'room':_0x4498d6}},{'$unwind':_0xd26c61(0x109)},{'$match':{'product_details.primary_code':_0x2334dc}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xd26c61(0x11f)},'product_stock':{'$first':_0xd26c61(0x1e8)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xd26c61(0x114)},'product_code':{'$first':_0xd26c61(0xdf)},'level':{'$first':_0xd26c61(0x1ea)},'bay':{'$first':_0xd26c61(0xb9)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xd26c61(0x1c2)},'secondary_unit':{'$first':_0xd26c61(0x119)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xd26c61(0x162)},'expiry_date':{'$first':_0xd26c61(0x106)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0xd26c61(0xd7)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xd26c61(0xb1)},'invoice':{'$first':_0xd26c61(0xa6)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0xd26c61(0x117)},'sales_category':{'$first':_0xd26c61(0x12c)}}}]),_0x27ff03=await warehouse['aggregate']([{'$match':{'name':_0x12f85f,'room':_0x4498d6}},{'$unwind':_0xd26c61(0x109)},{'$match':{'product_details.secondary_code':_0x2334dc}},{'$group':{'_id':_0xd26c61(0x145),'name':{'$first':_0xd26c61(0x11f)},'product_stock':{'$first':_0xd26c61(0x1e8)},'primary_code':{'$first':_0xd26c61(0xd5)},'secondary_code':{'$first':_0xd26c61(0x114)},'product_code':{'$first':_0xd26c61(0xdf)},'level':{'$first':_0xd26c61(0xb9)},'isle':{'$first':_0xd26c61(0x1ed)},'type':{'$first':_0xd26c61(0x116)},'pallet':{'$first':_0xd26c61(0x1ec)},'unit':{'$first':_0xd26c61(0x1c2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0xd26c61(0x182)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xd26c61(0x106)},'production_date':{'$first':_0xd26c61(0x15a)},'maxPerUnit':{'$first':_0xd26c61(0xd7)},'batch_code':{'$first':_0xd26c61(0xa7)},'product_cat':{'$first':_0xd26c61(0x17f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xd26c61(0xb1)},'invoice':{'$first':_0xd26c61(0xa6)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':'$product_details.sales_category'}}}]);if(_0x51b578[_0xd26c61(0xf7)]>0x0)_0x1700f4['push'](_0x51b578);else _0x27ff03[_0xd26c61(0xf7)]>0x0&&_0x1700f4[_0xd26c61(0x183)](_0x27ff03);}const _0x348153=_0x28f912['map'](_0x5aada7=>_0x486f85(_0x5aada7));await Promise['all'](_0x348153),_0x203d6e['json'](_0x1700f4);}),router['post'](a0_0x308003(0x13d),async(_0x392862,_0x35fb98)=>{var _0x5a13a4=a0_0x308003;const {product_code:_0x3c9b95,warehouse_name:_0x70b68,rooms_data:_0x4e9322,Roomslist:_0x4cfc56,sales_category:_0x218cd3}=_0x392862[_0x5a13a4(0x136)],_0x2959e6=_0x4cfc56[_0x5a13a4(0x134)](','),_0x4945a0=[];async function _0x382d41(_0x4cd45f){var _0x1ec6cc=_0x5a13a4;const _0x4e85f8=await warehouse[_0x1ec6cc(0x130)]([{'$match':{'name':_0x70b68,'room':_0x4cd45f}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x3c9b95,'product_details.sales_category':_0x218cd3,'product_details.type_products':'log'}},{'$group':{'_id':_0x1ec6cc(0x145),'name':{'$first':_0x1ec6cc(0x11f)},'product_stock':{'$first':_0x1ec6cc(0x1e8)},'primary_code':{'$first':_0x1ec6cc(0xd5)},'secondary_code':{'$first':_0x1ec6cc(0x114)},'product_code':{'$first':_0x1ec6cc(0xdf)},'level':{'$first':_0x1ec6cc(0x1ea)},'bay':{'$first':'$product_details.bay'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1ec6cc(0x1c2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1ec6cc(0x162)},'expiry_date':{'$first':_0x1ec6cc(0x106)},'production_date':{'$first':_0x1ec6cc(0x15a)},'maxPerUnit':{'$first':_0x1ec6cc(0xd7)},'batch_code':{'$first':_0x1ec6cc(0xa7)},'product_cat':{'$first':_0x1ec6cc(0x17f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0x1ec6cc(0xc1)},'gross_price':{'$first':_0x1ec6cc(0x117)},'sales_category':{'$first':'$product_details.sales_category'},'type_products':{'$first':_0x1ec6cc(0xee)}}}]);console[_0x1ec6cc(0x1e7)]('log'+'\x20<>\x20'+_0x3c9b95+'\x20<>\x20'+_0x218cd3);const _0x50f570=await warehouse[_0x1ec6cc(0x130)]([{'$match':{'name':_0x70b68,'room':_0x4cd45f}},{'$unwind':_0x1ec6cc(0x109)},{'$match':{'product_details.secondary_code':_0x3c9b95,'product_details.sales_category':_0x218cd3,'product_details.type_products':'log'}},{'$group':{'_id':_0x1ec6cc(0x145),'name':{'$first':_0x1ec6cc(0x11f)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1ec6cc(0xd5)},'secondary_code':{'$first':_0x1ec6cc(0x114)},'product_code':{'$first':_0x1ec6cc(0xdf)},'level':{'$first':_0x1ec6cc(0xb9)},'isle':{'$first':_0x1ec6cc(0x1ed)},'type':{'$first':_0x1ec6cc(0x116)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1ec6cc(0x1c2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1ec6cc(0x182)},'rack':{'$first':_0x1ec6cc(0x162)},'expiry_date':{'$first':_0x1ec6cc(0x106)},'production_date':{'$first':_0x1ec6cc(0x15a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x1ec6cc(0xa7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1ec6cc(0xb1)},'invoice':{'$first':_0x1ec6cc(0xa6)},'uuid':{'$first':_0x1ec6cc(0xc1)},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x1ec6cc(0x12c)},'type_products':{'$first':_0x1ec6cc(0xee)}}}]);if(_0x4e85f8[_0x1ec6cc(0xf7)]>0x0)_0x4945a0['push'](_0x4e85f8);else _0x50f570['length']>0x0&&_0x4945a0[_0x1ec6cc(0x183)](_0x50f570);}const _0x4e7019=_0x2959e6[_0x5a13a4(0xc9)](_0x5b478c=>_0x382d41(_0x5b478c));await Promise[_0x5a13a4(0x184)](_0x4e7019),_0x35fb98['json'](_0x4945a0);}),router[a0_0x308003(0x1b8)](a0_0x308003(0xd2),async(_0x21e3ca,_0x4f5f96)=>{var _0x420e8a=a0_0x308003;try{const {prduct_code:_0x828453,warehouse_data:_0x2d76e1,qty_req:_0xde7c01}=_0x21e3ca[_0x420e8a(0x136)];let _0x4d80bc=_0x828453['split']('~'),_0x28fb7e=_0xde7c01['split']('~'),_0x39f7fb=[],_0x2d3bb1=0x0;for(let _0x4e8818=0x0;_0x4e8818<=_0x4d80bc[_0x420e8a(0xf7)]-0x1;_0x4e8818++){const _0x92a9a6=_0x4d80bc[_0x4e8818],_0x4b3be9=_0x28fb7e[_0x4e8818],_0xefa13=await warehouse[_0x420e8a(0x130)]([{'$match':{'name':_0x2d76e1}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x92a9a6,'product_details.isAvailable':_0x420e8a(0x1f2),'product_details.isUsed':'false'}},{'$sort':{'product_details.date_received':0x1}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x420e8a(0x11f)},'product_stock':{'$first':_0x420e8a(0x1e8)},'primary_code':{'$first':_0x420e8a(0xd5)},'secondary_code':{'$first':_0x420e8a(0x114)},'product_code':{'$first':_0x420e8a(0xdf)},'level':{'$first':_0x420e8a(0x1ea)},'bay':{'$first':_0x420e8a(0xb9)},'type':{'$first':_0x420e8a(0x116)},'pallet':{'$first':_0x420e8a(0x1ec)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x420e8a(0x162)},'expiry_date':{'$first':_0x420e8a(0x106)},'production_date':{'$first':_0x420e8a(0x15a)},'maxPerUnit':{'$first':_0x420e8a(0xd7)},'batch_code':{'$first':_0x420e8a(0xa7)},'product_cat':{'$first':_0x420e8a(0x17f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x420e8a(0xb1)},'invoice':{'$first':_0x420e8a(0xa6)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0x420e8a(0x117)},'sales_category':{'$first':_0x420e8a(0x12c)},'date_received':{'$first':'$product_details.date_recieved'},'warehouse_id':{'$first':'$_id'}}}]),_0x2b3b85=_0xefa13[_0x420e8a(0x1bd)]((_0x3871b9,_0x40ac92)=>new Date(_0x3871b9[_0x420e8a(0x139)])-new Date(_0x40ac92[_0x420e8a(0x139)]));let _0x6eb370=_0x4b3be9;for(let _0x46d287=0x0;_0x46d287<=_0x2b3b85['length']-0x1&&_0x6eb370>0x0;_0x46d287++){const _0x2e0b94=_0x2b3b85[_0x46d287];if(_0x2e0b94[_0x420e8a(0x132)]==_0x92a9a6){_0x39f7fb[_0x2d3bb1]={};const _0x56d5ec=parseInt(_0x2e0b94['product_stock']),_0xf73229=0x0;let _0x1a6711=_0x56d5ec-_0xf73229,_0x84d38c=Math[_0x420e8a(0x154)](_0x6eb370,_0x1a6711);console[_0x420e8a(0x1e7)](_0x420e8a(0x1fa)+_0x84d38c+'\x20units\x20to\x20warehouse:\x20'+_0x2d76e1+_0x420e8a(0xa9)+_0x2e0b94[_0x420e8a(0x118)]+_0x420e8a(0x15c)+(_0x2e0b94['level']+_0x2e0b94[_0x420e8a(0xac)])+_0x420e8a(0x137)+_0x2e0b94[_0x420e8a(0x139)]+'\x20Name:\x20'+_0x2e0b94[_0x420e8a(0x153)]),_0x39f7fb[_0x2d3bb1][_0x420e8a(0x18b)]=_0x2e0b94[_0x420e8a(0x18f)]+'~'+_0x2e0b94[_0x420e8a(0xf8)]+'~'+_0x84d38c,_0x39f7fb[_0x2d3bb1]['product_name']=_0x2e0b94[_0x420e8a(0x153)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x132)]=_0x2e0b94[_0x420e8a(0x132)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0xd3)]=_0x2e0b94[_0x420e8a(0xd3)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0xe2)]=_0x2e0b94[_0x420e8a(0xe2)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x161)]=_0x2e0b94[_0x420e8a(0x161)],_0x39f7fb[_0x2d3bb1]['uuid']=_0x2e0b94['uuid'],_0x39f7fb[_0x2d3bb1][_0x420e8a(0xcc)]=_0x84d38c,_0x39f7fb[_0x2d3bb1]['unit']=_0x2e0b94[_0x420e8a(0xcf)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1d5)]=_0x2e0b94['secondary_unit'],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1f7)]=_0x2e0b94[_0x420e8a(0x1f7)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x196)]=_0x2e0b94[_0x420e8a(0x196)],_0x39f7fb[_0x2d3bb1]['maxStocks']=_0x2e0b94[_0x420e8a(0x1bc)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x11a)]=_0x2e0b94[_0x420e8a(0x11a)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x19b)]=_0x2e0b94[_0x420e8a(0x19b)],_0x39f7fb[_0x2d3bb1]['production_date']=_0x2e0b94[_0x420e8a(0xca)],_0x39f7fb[_0x2d3bb1]['maxperunit']=_0x2e0b94[_0x420e8a(0xc7)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1f6)]=_0x2e0b94[_0x420e8a(0x1f6)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1d0)]=_0x2e0b94[_0x420e8a(0x1d0)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x13e)]=_0x2e0b94[_0x420e8a(0x13e)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x112)]=_0x2e0b94[_0x420e8a(0x118)],_0x39f7fb[_0x2d3bb1]['level']=_0x2e0b94['level'],_0x39f7fb[_0x2d3bb1]['bay']=_0x2e0b94[_0x420e8a(0xac)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x110)]=_0x420e8a(0x1f2),console[_0x420e8a(0x1e7)]('1',_0x2d3bb1),_0x6eb370-=_0x84d38c,_0x2d3bb1++;if(_0x6eb370<=0x0)break;}}if(_0x6eb370>0x0){var _0x437795=await product[_0x420e8a(0x103)]({'product_code':_0x92a9a6});console[_0x420e8a(0x1e7)]('2',_0x2d3bb1),_0x39f7fb[_0x2d3bb1]={},_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1d6)]=_0x437795[_0x420e8a(0x153)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x132)]=_0x92a9a6,_0x39f7fb[_0x2d3bb1][_0x420e8a(0xd3)]=_0x437795[_0x420e8a(0xf8)][_0x420e8a(0xe8)](),_0x39f7fb[_0x2d3bb1][_0x420e8a(0xcc)]=_0x6eb370,_0x39f7fb[_0x2d3bb1][_0x420e8a(0xba)]=_0x437795['unit'],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1d5)]=_0x437795[_0x420e8a(0x144)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1f7)]=_0x437795['primary_code'],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x196)]=_0x437795[_0x420e8a(0x196)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x1bc)]=_0x437795[_0x420e8a(0x1bc)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0xc7)]=_0x437795[_0x420e8a(0x13a)],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x13e)]=_0x437795['gross_price'],_0x39f7fb[_0x2d3bb1][_0x420e8a(0x110)]=_0x420e8a(0x1a9),console['log'](_0x420e8a(0xce)+_0x6eb370+_0x420e8a(0xae)+_0x2d3bb1+'\x20<>\x20'+_0x92a9a6),_0x2d3bb1++;}}_0x4f5f96[_0x420e8a(0x1b6)](_0x39f7fb);}catch(_0x287320){console[_0x420e8a(0x1e7)](_0x287320);}}),router['post'](a0_0x308003(0x1b2),async(_0x44a323,_0x5786dd)=>{var _0x38f7a8=a0_0x308003;const {product_code:_0x2be7b3}=_0x44a323[_0x38f7a8(0x136)];var _0x5ed30a;const _0x284f5a=await product['aggregate']([{'$match':{'primary_code':_0x2be7b3}},{'$group':{'_id':_0x38f7a8(0xe7),'name':{'$first':_0x38f7a8(0xb3)},'category':{'$first':_0x38f7a8(0x12b)},'brand':{'$first':'$brand'},'unit':{'$first':_0x38f7a8(0x192)},'alertquantity':{'$first':_0x38f7a8(0xfb)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x38f7a8(0x1e3)},'secondary_code':{'$first':_0x38f7a8(0xb2)},'maxStocks':{'$first':_0x38f7a8(0xfa)},'maxProdPerUnit':{'$first':_0x38f7a8(0xab)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x38f7a8(0x15f)},'gross_price':{'$first':_0x38f7a8(0x175)},'sales_category':{'$first':_0x38f7a8(0x11e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x456f0b=await product['aggregate']([{'$match':{'secondary_code':_0x2be7b3}},{'$group':{'_id':_0x38f7a8(0xe7),'name':{'$first':_0x38f7a8(0xb3)},'category':{'$first':_0x38f7a8(0x12b)},'brand':{'$first':_0x38f7a8(0x190)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x38f7a8(0xfb)},'product_code':{'$first':_0x38f7a8(0x1e0)},'primary_code':{'$first':_0x38f7a8(0x1e3)},'secondary_code':{'$first':_0x38f7a8(0xb2)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x38f7a8(0xab)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x38f7a8(0x15f)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x284f5a[_0x38f7a8(0xf7)]>0x0)_0x5ed30a=_0x284f5a;else _0x456f0b[_0x38f7a8(0xf7)]>0x0&&(_0x5ed30a=_0x456f0b);_0x5786dd[_0x38f7a8(0x1b6)](_0x5ed30a);}),router[a0_0x308003(0x1b8)](a0_0x308003(0xff),async(_0x43204f,_0xdb5e90)=>{var _0x56bba5=a0_0x308003;try{const {group_id:_0x36cf81,DRSI:_0x1e0983,dateofreq:_0x524f09,PO_number:_0x178986,date:_0xfdc27e,warehouse_name:_0x4d6bc1,typevehicle:_0x53aa7d,deliverydate:_0x3dce6c,driver:_0x1b527c,plate:_0x4cc828,van:_0x2ce5ed,TSU:_0x72cee5,actual_delivery_date:_0x4bc2a6,TFU:_0x375abc,pull_out_date:_0x57a34e,sales:_0x289e27,Customer_data:_0x2388dc,note:_0x1d20d5}=_0x43204f[_0x56bba5(0x136)],_0x31e0ae=mongoose[_0x56bba5(0x1e6)][_0x56bba5(0x156)];let _0x58ca2c=[];const _0x242362=new invoice_for_outgoing();await _0x242362[_0x56bba5(0xe3)]();const _0x4c9295='OUT-'+_0x242362[_0x56bba5(0x1f0)]['toString']()[_0x56bba5(0x11c)](0x8,'0');if(typeof _0x36cf81=='string'){let _0x788c16=_0x36cf81[_0x56bba5(0x134)]('~');var _0x230794=_0x31e0ae(_0x788c16[0x0]),_0x2da5b2=_0x31e0ae(_0x788c16[0x1]),_0x313a8d=_0x788c16[0x2];let _0x48be58=0x0;const _0x1e8c91=await warehouse[_0x56bba5(0x130)]([{'$match':{'_id':_0x230794}},{'$unwind':_0x56bba5(0x109)},{'$match':{'product_details._id':_0x2da5b2}}]);await warehouse[_0x56bba5(0x1c5)]({'_id':_0x31e0ae(_0x230794),'product_details._id':_0x31e0ae(_0x2da5b2)},{'$set':{'product_details.$.isUsed':'true'}}),_0x58ca2c[_0x48be58]={};for(let _0xcb299e=0x0;_0xcb299e<=_0x1e8c91['length']-0x1;_0xcb299e++){const _0x2d7224=_0x1e8c91[_0xcb299e];console[_0x56bba5(0x1e7)](_0x2d7224),_0x58ca2c[_0x48be58][_0x56bba5(0x100)]=_0x2d7224[_0x56bba5(0x153)],_0x58ca2c[_0x48be58][_0x56bba5(0xd3)]=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0xd3)],_0x58ca2c[_0x48be58][_0x56bba5(0x1d6)]=_0x2d7224[_0x56bba5(0x1dd)]['product_name'],_0x58ca2c[_0x48be58]['product_code']=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x132)],_0x58ca2c[_0x48be58][_0x56bba5(0x12e)]=_0x313a8d,_0x58ca2c[_0x48be58][_0x56bba5(0xcc)]=_0x313a8d,_0x58ca2c[_0x48be58]['unit']=_0x2d7224[_0x56bba5(0x1dd)]['unit'],_0x58ca2c[_0x48be58]['secondary_unit']=_0x2d7224['product_details'][_0x56bba5(0x1d5)],_0x58ca2c[_0x48be58]['level']=_0x2d7224['product_details']['level'],_0x58ca2c[_0x48be58][_0x56bba5(0xac)]=_0x2d7224[_0x56bba5(0x1dd)]['bay'],_0x58ca2c[_0x48be58]['primary_code']=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x1f7)],_0x58ca2c[_0x48be58][_0x56bba5(0x196)]=_0x2d7224[_0x56bba5(0x1dd)]['secondary_code'],_0x58ca2c[_0x48be58][_0x56bba5(0x1bc)]=_0x2d7224['product_details'][_0x56bba5(0x1bc)],_0x58ca2c[_0x48be58][_0x56bba5(0x11a)]=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x11a)],_0x58ca2c[_0x48be58][_0x56bba5(0x19b)]=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x19b)],_0x58ca2c[_0x48be58]['production_date']=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0xca)],_0x58ca2c[_0x48be58]['maxperunit']=_0x2d7224[_0x56bba5(0x1dd)]['maxperunit'],_0x58ca2c[_0x48be58][_0x56bba5(0x1f6)]=_0x2d7224['product_details'][_0x56bba5(0x1f6)],_0x58ca2c[_0x48be58]['room_name']=_0x2d7224[_0x56bba5(0xd6)],_0x58ca2c[_0x48be58]['invoice']=_0x2d7224['product_details'][_0x56bba5(0x1d0)],_0x58ca2c[_0x48be58]['uuid']=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x16c)],_0x58ca2c[_0x48be58][_0x56bba5(0x13e)]=_0x2d7224['product_details']['gross_price'],_0x58ca2c[_0x48be58][_0x56bba5(0x161)]=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x1a6)],_0x58ca2c[_0x48be58][_0x56bba5(0xe2)]=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0xe2)],_0x58ca2c[_0x48be58]['sales_id']=_0x2d7224[_0x56bba5(0x1dd)]['sales'],_0x58ca2c[_0x48be58]['warehouse_id']=_0x2d7224[_0x56bba5(0xf8)][_0x56bba5(0xe8)](),_0x58ca2c[_0x48be58][_0x56bba5(0xc2)]=_0x2d7224[_0x56bba5(0x1dd)]['_id'][_0x56bba5(0xe8)](),_0x58ca2c[_0x48be58]['data_type']='out',_0x58ca2c[_0x48be58]['agent_id']=_0x2d7224[_0x56bba5(0x1dd)][_0x56bba5(0x1a6)];}_0x58ca2c[_0x48be58][_0x56bba5(0x167)]=_0x4c9295;}else for(let _0x277e13=0x0;_0x277e13<=_0x36cf81['length']-0x1;_0x277e13++){const _0x245783=_0x36cf81[_0x277e13];let _0x4c1ee5=_0x245783[_0x56bba5(0x134)]('~');console[_0x56bba5(0x1e7)](_0x4c1ee5);var _0x230794=_0x31e0ae(_0x4c1ee5[0x0]),_0x2da5b2=_0x31e0ae(_0x4c1ee5[0x1]),_0x313a8d=_0x4c1ee5[0x2];const _0x2559da=await warehouse[_0x56bba5(0x130)]([{'$match':{'_id':_0x230794}},{'$unwind':_0x56bba5(0x109)},{'$match':{'product_details._id':_0x2da5b2}}]);await warehouse[_0x56bba5(0x1c5)]({'_id':_0x31e0ae(_0x230794),'product_details._id':_0x31e0ae(_0x2da5b2)},{'$set':{'product_details.$.isUsed':_0x56bba5(0x1f2)}}),_0x58ca2c[_0x277e13]={};for(let _0x5c76c4=0x0;_0x5c76c4<=_0x2559da[_0x56bba5(0xf7)]-0x1;_0x5c76c4++){const _0x573c9d=_0x2559da[_0x5c76c4];_0x58ca2c[_0x277e13][_0x56bba5(0x100)]=_0x573c9d[_0x56bba5(0x153)],_0x58ca2c[_0x277e13][_0x56bba5(0xd3)]=_0x573c9d[_0x56bba5(0x1dd)]['product_id'],_0x58ca2c[_0x277e13][_0x56bba5(0x1d6)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x1d6)],_0x58ca2c[_0x277e13]['product_code']=_0x573c9d[_0x56bba5(0x1dd)]['product_code'],_0x58ca2c[_0x277e13][_0x56bba5(0x12e)]=_0x313a8d,_0x58ca2c[_0x277e13]['quantity']=_0x313a8d,_0x58ca2c[_0x277e13]['unit']=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0xcf)],_0x58ca2c[_0x277e13][_0x56bba5(0x1d5)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x1d5)],_0x58ca2c[_0x277e13]['level']=_0x573c9d['product_details']['level'],_0x58ca2c[_0x277e13][_0x56bba5(0xac)]=_0x573c9d['product_details']['bay'],_0x58ca2c[_0x277e13][_0x56bba5(0x1f7)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x1f7)],_0x58ca2c[_0x277e13][_0x56bba5(0x196)]=_0x573c9d[_0x56bba5(0x1dd)]['secondary_code'],_0x58ca2c[_0x277e13][_0x56bba5(0x1bc)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x1bc)],_0x58ca2c[_0x277e13][_0x56bba5(0x11a)]=_0x573c9d['product_details'][_0x56bba5(0x11a)],_0x58ca2c[_0x277e13][_0x56bba5(0x19b)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x19b)],_0x58ca2c[_0x277e13][_0x56bba5(0xca)]=_0x573c9d['product_details']['production_date'],_0x58ca2c[_0x277e13]['maxperunit']=_0x573c9d['product_details']['maxperunit'],_0x58ca2c[_0x277e13][_0x56bba5(0x1f6)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x1f6)],_0x58ca2c[_0x277e13][_0x56bba5(0x112)]=_0x573c9d[_0x56bba5(0xd6)],_0x58ca2c[_0x277e13][_0x56bba5(0x1d0)]=_0x573c9d['product_details'][_0x56bba5(0x1d0)],_0x58ca2c[_0x277e13]['uuid']=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x16c)],_0x58ca2c[_0x277e13][_0x56bba5(0x13e)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x13e)],_0x58ca2c[_0x277e13][_0x56bba5(0x161)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0x1a6)],_0x58ca2c[_0x277e13][_0x56bba5(0xe2)]=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0xe2)],_0x58ca2c[_0x277e13][_0x56bba5(0xbf)]=_0x573c9d[_0x56bba5(0x1dd)]['sales'],_0x58ca2c[_0x277e13][_0x56bba5(0x18f)]=_0x573c9d['_id'][_0x56bba5(0xe8)](),_0x58ca2c[_0x277e13]['warehouse_id_detl']=_0x573c9d[_0x56bba5(0x1dd)][_0x56bba5(0xf8)]['valueOf'](),_0x58ca2c[_0x277e13][_0x56bba5(0x146)]=_0x56bba5(0x1d2),_0x58ca2c[_0x277e13][_0x56bba5(0x1a3)]=_0x573c9d['product_details'][_0x56bba5(0x1a6)];}_0x58ca2c[_0x277e13][_0x56bba5(0x167)]=_0x4c9295;}for(let _0x135eec=0x0;_0x135eec<=_0x58ca2c[_0x56bba5(0xf7)]-0x1;_0x135eec++){const _0x312643=_0x58ca2c[_0x135eec],_0xd0c8bd=new warehouse_temporary(_0x312643);await _0xd0c8bd[_0x56bba5(0xe3)]();}const _0x37fc74=new sales_finished({'invoice':_0x4c9295,'sales_data':_0x289e27,'customer':_0x2388dc,'date':_0xfdc27e,'warehouse_name':_0x4d6bc1,'sale_product':_0x58ca2c,'note':_0x1d20d5,'finalize':_0x56bba5(0x16b),'dateofreq':_0x524f09,'PO_number':_0x178986,'typevehicle':_0x53aa7d,'deliverydate':_0x3dce6c,'driver':_0x1b527c,'plate':_0x4cc828,'van':_0x2ce5ed,'DRSI':_0x1e0983,'TSU':_0x72cee5,'TFU':_0x375abc,'pullout_date':_0x57a34e,'actualdelivery_date':_0x4bc2a6,'typeOfProducts':_0x56bba5(0x1a8)}),_0x49fc86=await _0x37fc74['save']();_0x43204f['flash'](_0x56bba5(0x1c1),_0x56bba5(0x1ab)),_0xdb5e90[_0x56bba5(0x107)](_0x56bba5(0x115)+_0x49fc86['_id']);}catch(_0x369732){console['log'](_0x369732);}}),module[a0_0x308003(0x10e)]=router;