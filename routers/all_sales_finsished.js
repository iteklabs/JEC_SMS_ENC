var a0_0x4b8988=a0_0x30e9;function a0_0x30e9(_0x1eb9ff,_0x1db434){var _0xbeb33f=a0_0xbeb3();return a0_0x30e9=function(_0x30e9ff,_0x35b1c6){_0x30e9ff=_0x30e9ff-0x1e2;var _0x670e28=_0xbeb33f[_0x30e9ff];return _0x670e28;},a0_0x30e9(_0x1eb9ff,_0x1db434);}(function(_0xfa207b,_0x4ceb7f){var _0x433386=a0_0x30e9,_0x438796=_0xfa207b();while(!![]){try{var _0x219852=parseInt(_0x433386(0x229))/0x1+-parseInt(_0x433386(0x2b8))/0x2*(-parseInt(_0x433386(0x270))/0x3)+-parseInt(_0x433386(0x23f))/0x4+-parseInt(_0x433386(0x27e))/0x5+-parseInt(_0x433386(0x256))/0x6+parseInt(_0x433386(0x2be))/0x7*(-parseInt(_0x433386(0x2f4))/0x8)+-parseInt(_0x433386(0x234))/0x9*(-parseInt(_0x433386(0x2d7))/0xa);if(_0x219852===_0x4ceb7f)break;else _0x438796['push'](_0x438796['shift']());}catch(_0x19036b){_0x438796['push'](_0x438796['shift']());}}}(a0_0xbeb3,0xcdb28));const express=require('express'),app=express(),router=express[a0_0x4b8988(0x275)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs}=require(a0_0x4b8988(0x243)),auth=require(a0_0x4b8988(0x27c)),nodemailer=require('nodemailer'),users=require(a0_0x4b8988(0x22e));router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x2fe),auth,async(_0x2078e1,_0x554356)=>{var _0x4f95a4=a0_0x4b8988;try{const {username:_0x1a2ea7,email:_0x23a544,role:_0x40ecbd}=_0x2078e1[_0x4f95a4(0x2a8)],_0x3546f8=_0x2078e1[_0x4f95a4(0x2a8)],_0x2da3c1=await profile['findOne']({'email':_0x3546f8[_0x4f95a4(0x21a)]}),_0x392f62=await master_shop[_0x4f95a4(0x253)]();let _0x3d4956;if(_0x3546f8[_0x4f95a4(0x219)]==_0x4f95a4(0x2bb)){const _0x3a1069=await staff[_0x4f95a4(0x1e3)]({'email':_0x3546f8['email']});_0x3d4956=await sales_finished[_0x4f95a4(0x2cf)]([{'$match':{'typeOfProducts':_0x4f95a4(0x302)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4f95a4(0x2b6),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x4f95a4(0x27f)},'date':{'$first':_0x4f95a4(0x2ff)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4f95a4(0x2e2)},'note':{'$first':_0x4f95a4(0x24a)},'return_data':{'$first':_0x4f95a4(0x2db)},'customers_docs':{'$first':_0x4f95a4(0x2dd)},'total_saleproduct_quantity':{'$sum':_0x4f95a4(0x280)},'level':{'$addToSet':_0x4f95a4(0x21d)},'isle':{'$addToSet':_0x4f95a4(0x24c)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4f95a4(0x291)},'finalize':{'$first':_0x4f95a4(0x22f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x3d4956=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x4f95a4(0x302)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4f95a4(0x2b6),'invoice':{'$first':_0x4f95a4(0x2ca)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4f95a4(0x24a)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4f95a4(0x21d)},'isle':{'$addToSet':_0x4f95a4(0x24c)},'type':{'$addToSet':_0x4f95a4(0x211)},'pallet':{'$addToSet':_0x4f95a4(0x291)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x392f62[0x0][_0x4f95a4(0x2bf)]==_0x4f95a4(0x216)){var _0x405fc2=users[_0x4f95a4(0x281)];console[_0x4f95a4(0x242)](_0x405fc2);}else{if(_0x392f62[0x0][_0x4f95a4(0x2bf)]=='Hindi')var _0x405fc2=users[_0x4f95a4(0x271)];else{if(_0x392f62[0x0][_0x4f95a4(0x2bf)]=='German')var _0x405fc2=users['German'];else{if(_0x392f62[0x0][_0x4f95a4(0x2bf)]==_0x4f95a4(0x20f))var _0x405fc2=users[_0x4f95a4(0x20f)];else{if(_0x392f62[0x0][_0x4f95a4(0x2bf)]==_0x4f95a4(0x1fd))var _0x405fc2=users[_0x4f95a4(0x1fd)];else{if(_0x392f62[0x0]['language']==_0x4f95a4(0x23c))var _0x405fc2=users['Portuguese'];else{if(_0x392f62[0x0][_0x4f95a4(0x2bf)]==_0x4f95a4(0x264))var _0x405fc2=users['Chinese'];else{if(_0x392f62[0x0][_0x4f95a4(0x2bf)]==_0x4f95a4(0x2ef))var _0x405fc2=users['Arabic'];}}}}}}}_0x554356[_0x4f95a4(0x287)](_0x4f95a4(0x2fc),{'success':_0x2078e1['flash'](_0x4f95a4(0x292)),'errors':_0x2078e1['flash']('errors'),'sales':_0x3d4956,'profile':_0x2da3c1,'role':_0x3546f8,'master_shop':_0x392f62,'language':_0x405fc2});}catch(_0x122417){console[_0x4f95a4(0x242)](_0x122417);}}),router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x1ec),auth,async(_0x1769bc,_0x1efb70)=>{var _0xf63be6=a0_0x4b8988;try{const {username:_0x4b97c0,email:_0x28d83a,role:_0x2e0025}=_0x1769bc[_0xf63be6(0x2a8)],_0x5021b7=_0x1769bc[_0xf63be6(0x2a8)],_0x35c028=await profile[_0xf63be6(0x1e3)]({'email':_0x5021b7['email']}),_0x24b839=await master_shop['find']();let _0x4a0d34;if(_0x5021b7['role']==_0xf63be6(0x2bb)){const _0x5b3a57=await staff[_0xf63be6(0x1e3)]({'email':_0x5021b7[_0xf63be6(0x21a)]});_0x4a0d34=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0xf63be6(0x210)}},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0xf63be6(0x2ca)},'customers':{'$first':_0xf63be6(0x27f)},'date':{'$first':_0xf63be6(0x2ff)},'warehouse_name':{'$first':_0xf63be6(0x24f)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0xf63be6(0x24a)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xf63be6(0x2dd)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xf63be6(0x21d)},'isle':{'$addToSet':_0xf63be6(0x24c)},'type':{'$addToSet':_0xf63be6(0x211)},'pallet':{'$addToSet':_0xf63be6(0x291)},'finalize':{'$first':_0xf63be6(0x22f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4a0d34=await sales_finished[_0xf63be6(0x2cf)]([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0xf63be6(0x2e2)},{'$group':{'_id':_0xf63be6(0x2b6),'invoice':{'$first':_0xf63be6(0x2ca)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xf63be6(0x24f)},'sale_product':{'$push':_0xf63be6(0x2e2)},'note':{'$first':_0xf63be6(0x24a)},'return_data':{'$first':_0xf63be6(0x2db)},'customers_docs':{'$first':_0xf63be6(0x2dd)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0xf63be6(0x24c)},'type':{'$addToSet':_0xf63be6(0x211)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0xf63be6(0x22f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x24b839[0x0][_0xf63be6(0x2bf)]==_0xf63be6(0x216)){var _0x156d05=users['English'];console['log'](_0x156d05);}else{if(_0x24b839[0x0]['language']=='Hindi')var _0x156d05=users[_0xf63be6(0x271)];else{if(_0x24b839[0x0][_0xf63be6(0x2bf)]==_0xf63be6(0x1f5))var _0x156d05=users[_0xf63be6(0x1f5)];else{if(_0x24b839[0x0][_0xf63be6(0x2bf)]=='Spanish')var _0x156d05=users['Spanish'];else{if(_0x24b839[0x0][_0xf63be6(0x2bf)]=='French')var _0x156d05=users[_0xf63be6(0x1fd)];else{if(_0x24b839[0x0][_0xf63be6(0x2bf)]==_0xf63be6(0x23c))var _0x156d05=users[_0xf63be6(0x2fb)];else{if(_0x24b839[0x0][_0xf63be6(0x2bf)]==_0xf63be6(0x264))var _0x156d05=users[_0xf63be6(0x264)];else{if(_0x24b839[0x0]['language']==_0xf63be6(0x2ef))var _0x156d05=users[_0xf63be6(0x2dc)];}}}}}}}_0x1efb70[_0xf63be6(0x287)](_0xf63be6(0x2f3),{'success':_0x1769bc[_0xf63be6(0x29f)](_0xf63be6(0x292)),'errors':_0x1769bc[_0xf63be6(0x29f)](_0xf63be6(0x2b2)),'sales':_0x4a0d34,'profile':_0x35c028,'role':_0x5021b7,'master_shop':_0x24b839,'language':_0x156d05});}catch(_0x313f39){console[_0xf63be6(0x242)](_0x313f39);}});async function getRandom8DigitNumber(){var _0xd33ab7=a0_0x4b8988;const _0xf4a7e2=0x989680,_0x40e03e=0x5f5e0ff,_0x4f428d=Math[_0xd33ab7(0x209)](Math[_0xd33ab7(0x225)]()*(_0x40e03e-_0xf4a7e2+0x1))+_0xf4a7e2;var _0x57b7cb;const _0x59367b=await sales_finished[_0xd33ab7(0x1e3)]({'invoice':_0xd33ab7(0x24d)+_0x4f428d});return _0x59367b&&_0x59367b[_0xd33ab7(0x266)]>0x0?_0x57b7cb=_0xd33ab7(0x24d)+_0x4f428d:_0x57b7cb=_0xd33ab7(0x24d)+_0x4f428d,_0x57b7cb;}router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x1e4),auth,async(_0x54f518,_0x2631fc)=>{var _0x1c9b6d=a0_0x4b8988;try{const {username:_0x1e5494,email:_0x314f81,role:_0x364ae3}=_0x54f518[_0x1c9b6d(0x2a8)],_0x8b5a4f=_0x54f518[_0x1c9b6d(0x2a8)],_0x4465f9=await profile[_0x1c9b6d(0x1e3)]({'email':_0x8b5a4f[_0x1c9b6d(0x21a)]}),_0x32d8a2=await master_shop[_0x1c9b6d(0x253)](),_0x4b304d=await customer[_0x1c9b6d(0x253)]({});let _0x2d4d04;if(_0x8b5a4f[_0x1c9b6d(0x219)]==_0x1c9b6d(0x2bb)){const _0x25f72c=await staff['findOne']({'email':_0x8b5a4f['email']});_0x2d4d04=await warehouse[_0x1c9b6d(0x2cf)]([{'$match':{'status':_0x1c9b6d(0x29c),'name':_0x25f72c[_0x1c9b6d(0x259)]}},{'$group':{'_id':_0x1c9b6d(0x203),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2d4d04=await warehouse['aggregate']([{'$match':{'status':_0x1c9b6d(0x29c)}},{'$group':{'_id':_0x1c9b6d(0x203),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x59a91f=await product[_0x1c9b6d(0x253)]({});var _0x1a0847=['Ambient',_0x1c9b6d(0x205)];const _0x2613c0=await sales_finished[_0x1c9b6d(0x253)]({}),_0xb749d7=_0x2613c0[_0x1c9b6d(0x266)]+0x1,_0xb0876f=_0x1c9b6d(0x24d)+_0xb749d7[_0x1c9b6d(0x2e8)]()[_0x1c9b6d(0x27a)](0x5,'0');if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]==_0x1c9b6d(0x216)){var _0x45985d=users[_0x1c9b6d(0x281)];console[_0x1c9b6d(0x242)](_0x45985d);}else{if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]=='Hindi')var _0x45985d=users[_0x1c9b6d(0x271)];else{if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]==_0x1c9b6d(0x1f5))var _0x45985d=users[_0x1c9b6d(0x1f5)];else{if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]==_0x1c9b6d(0x20f))var _0x45985d=users[_0x1c9b6d(0x20f)];else{if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]==_0x1c9b6d(0x1fd))var _0x45985d=users['French'];else{if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]==_0x1c9b6d(0x23c))var _0x45985d=users[_0x1c9b6d(0x2fb)];else{if(_0x32d8a2[0x0][_0x1c9b6d(0x2bf)]==_0x1c9b6d(0x264))var _0x45985d=users[_0x1c9b6d(0x264)];else{if(_0x32d8a2[0x0]['language']==_0x1c9b6d(0x2ef))var _0x45985d=users[_0x1c9b6d(0x2dc)];}}}}}}}const _0x4f34ad=getRandom8DigitNumber();_0x4f34ad[_0x1c9b6d(0x2d0)](_0x46d310=>{var _0x6726f2=_0x1c9b6d;_0x2631fc[_0x6726f2(0x287)]('add_sales_finished',{'success':_0x54f518[_0x6726f2(0x29f)](_0x6726f2(0x292)),'errors':_0x54f518[_0x6726f2(0x29f)](_0x6726f2(0x2b2)),'role':_0x8b5a4f,'profile':_0x4465f9,'customer':_0x4b304d,'warehouse':_0x2d4d04,'product':_0x59a91f,'invoice':_0x46d310,'master_shop':_0x32d8a2,'language':_0x45985d,'rooms_data':_0x1a0847});})['catch'](_0x39e80b=>{var _0x5ca86e=_0x1c9b6d;_0x54f518['flash'](_0x5ca86e(0x2b2),_0x5ca86e(0x206)),_0x2631fc['redirect'](_0x5ca86e(0x240));});}catch(_0x9e227b){console['log'](_0x9e227b);}}),router[a0_0x4b8988(0x2d8)]('/view/add_sales_logs',auth,async(_0x1dea16,_0x53f533)=>{var _0x45456d=a0_0x4b8988;try{const {username:_0x3521d9,email:_0x298d6f,role:_0x4fafff}=_0x1dea16['user'],_0x15b4e9=_0x1dea16[_0x45456d(0x2a8)],_0x3b79de=await profile[_0x45456d(0x1e3)]({'email':_0x15b4e9[_0x45456d(0x21a)]}),_0x4fb6b0=await master_shop[_0x45456d(0x253)](),_0x4b8b85=await customer[_0x45456d(0x253)]({});let _0xca6f54;if(_0x15b4e9[_0x45456d(0x219)]==_0x45456d(0x2bb)){const _0x200d34=await staff[_0x45456d(0x1e3)]({'email':_0x15b4e9['email']});_0xca6f54=await warehouse[_0x45456d(0x2cf)]([{'$match':{'status':'Enabled','name':_0x200d34['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x45456d(0x203)}}},{'$sort':{'name':0x1}}]);}else _0xca6f54=await warehouse[_0x45456d(0x2cf)]([{'$match':{'status':_0x45456d(0x29c)}},{'$group':{'_id':'$name','name':{'$first':_0x45456d(0x203)}}},{'$sort':{'name':0x1}}]);const _0x5c7d97=await product[_0x45456d(0x253)]({});var _0x5c8080=[_0x45456d(0x2c2),'Enclosed'];const _0x239b4a=await sales_finished[_0x45456d(0x253)]({}),_0x3167d4=_0x239b4a[_0x45456d(0x266)]+0x1,_0x2386ce=_0x45456d(0x24d)+_0x3167d4[_0x45456d(0x2e8)]()[_0x45456d(0x27a)](0x5,'0');if(_0x4fb6b0[0x0]['language']==_0x45456d(0x216)){var _0x26d54e=users['English'];console[_0x45456d(0x242)](_0x26d54e);}else{if(_0x4fb6b0[0x0][_0x45456d(0x2bf)]=='Hindi')var _0x26d54e=users[_0x45456d(0x271)];else{if(_0x4fb6b0[0x0]['language']==_0x45456d(0x1f5))var _0x26d54e=users['German'];else{if(_0x4fb6b0[0x0]['language']==_0x45456d(0x20f))var _0x26d54e=users[_0x45456d(0x20f)];else{if(_0x4fb6b0[0x0][_0x45456d(0x2bf)]==_0x45456d(0x1fd))var _0x26d54e=users[_0x45456d(0x1fd)];else{if(_0x4fb6b0[0x0][_0x45456d(0x2bf)]=='Portuguese\x20(BR)')var _0x26d54e=users[_0x45456d(0x2fb)];else{if(_0x4fb6b0[0x0][_0x45456d(0x2bf)]==_0x45456d(0x264))var _0x26d54e=users[_0x45456d(0x264)];else{if(_0x4fb6b0[0x0]['language']==_0x45456d(0x2ef))var _0x26d54e=users['Arabic'];}}}}}}}const _0x5daae2=getRandom8DigitNumber();_0x5daae2[_0x45456d(0x2d0)](_0x4208b7=>{var _0xbcea22=_0x45456d;_0x53f533[_0xbcea22(0x287)](_0xbcea22(0x285),{'success':_0x1dea16[_0xbcea22(0x29f)](_0xbcea22(0x292)),'errors':_0x1dea16[_0xbcea22(0x29f)](_0xbcea22(0x2b2)),'role':_0x15b4e9,'profile':_0x3b79de,'customer':_0x4b8b85,'warehouse':_0xca6f54,'product':_0x5c7d97,'invoice':_0x4208b7,'master_shop':_0x4fb6b0,'language':_0x26d54e,'rooms_data':_0x5c8080});})[_0x45456d(0x288)](_0x31e515=>{var _0x22a167=_0x45456d;_0x1dea16[_0x22a167(0x29f)]('errors',_0x22a167(0x206)),_0x53f533['redirect'](_0x22a167(0x240));});}catch(_0xeb19fc){console[_0x45456d(0x242)](_0xeb19fc);}}),router[a0_0x4b8988(0x2a4)](a0_0x4b8988(0x2ea),auth,async(_0xd59410,_0x3e8781)=>{var _0x118316=a0_0x4b8988;try{const {invoice:_0x3b142f,date:_0x1e7769,warehouse_name:_0x2ec50a,product_name:_0x324e83,note:_0x108796,room:_0x49a317,primary_code:_0x28e046,secondary_code:_0x578744,prod_code:_0x4487d1,SCRN:_0x217df6,ReqBy:_0x2f61fc,dateofreq:_0x21f908,PO_number:_0x2d68e7,typeservicesData:_0x33f388,typevehicle:_0x41693a,destination:_0xdde242,deliverydate:_0x15918a,driver:_0x598baf,plate:_0x491ebe,van:_0x5c2def,DRSI:_0x5923bb,TSU:_0x2fff5b,TFU:_0x7977fa,mode_transpo:_0x2c2601,name_driver:_0x37551b,type_of_products:_0x52c29d}=_0xd59410['body'];if(typeof _0x324e83==_0x118316(0x227))var _0x18aa78=[_0xd59410['body'][_0x118316(0x1ff)]],_0xcc3b23=[_0xd59410[_0x118316(0x303)][_0x118316(0x2cd)]],_0xb3ef31=[_0xd59410[_0x118316(0x303)][_0x118316(0x296)]],_0x109683=[_0xd59410['body'][_0x118316(0x20c)]],_0x58f28a=[_0xd59410[_0x118316(0x303)][_0x118316(0x2da)]],_0x558582=[_0xd59410[_0x118316(0x303)][_0x118316(0x22c)]],_0x3087ad=[_0xd59410['body']['level2']],_0x42c07c=[_0xd59410[_0x118316(0x303)][_0x118316(0x298)]],_0x12b611=[_0xd59410[_0x118316(0x303)][_0x118316(0x262)]],_0x4c6841=[_0xd59410['body'][_0x118316(0x2d2)]],_0x4e5c10=[_0xd59410[_0x118316(0x303)][_0x118316(0x2d3)]],_0x42419c=[_0xd59410[_0x118316(0x303)]['product_date']],_0x50080d=[_0xd59410[_0x118316(0x303)][_0x118316(0x2f6)]],_0x45b21a=[_0xd59410[_0x118316(0x303)][_0x118316(0x29e)]],_0x3282d5=[_0xd59410['body']['RoomAssigned']],_0x2d517f=[_0xd59410[_0x118316(0x303)]['prod_invoice']],_0x475ecc=[_0xd59410['body']['id_transaction_from']],_0x1e02e3=[_0xd59410[_0x118316(0x303)][_0x118316(0x226)]],_0xb80b40=[_0xd59410['body'][_0x118316(0x2a5)]];else var _0x18aa78=[..._0xd59410[_0x118316(0x303)][_0x118316(0x1ff)]],_0xcc3b23=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2cd)]],_0xb3ef31=[..._0xd59410[_0x118316(0x303)][_0x118316(0x296)]],_0x109683=[..._0xd59410[_0x118316(0x303)][_0x118316(0x20c)]],_0x58f28a=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2da)]],_0x558582=[..._0xd59410[_0x118316(0x303)][_0x118316(0x22c)]],_0x3087ad=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2b5)]],_0x42c07c=[..._0xd59410[_0x118316(0x303)][_0x118316(0x298)]],_0x12b611=[..._0xd59410[_0x118316(0x303)][_0x118316(0x262)]],_0x4c6841=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2d2)]],_0x4e5c10=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2d3)]],_0x42419c=[..._0xd59410['body']['product_date']],_0x50080d=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2f6)]],_0x45b21a=[..._0xd59410[_0x118316(0x303)][_0x118316(0x29e)]],_0x3282d5=[..._0xd59410[_0x118316(0x303)][_0x118316(0x218)]],_0x2d517f=[..._0xd59410[_0x118316(0x303)][_0x118316(0x1f0)]],_0x475ecc=[..._0xd59410[_0x118316(0x303)]['id_transaction_from']],_0x1e02e3=[..._0xd59410['body']['uuid']],_0xb80b40=[..._0xd59410[_0x118316(0x303)][_0x118316(0x2a5)]];const _0x590e15=_0x18aa78[_0x118316(0x301)](_0x380444=>{return _0x380444={'product_name':_0x380444};});_0xcc3b23['forEach']((_0x5bd83d,_0x6c7cbd)=>{_0x590e15[_0x6c7cbd]['stock']=_0x5bd83d;}),_0xb3ef31[_0x118316(0x2a7)]((_0x3d9119,_0x12e030)=>{var _0x305105=_0x118316;_0x590e15[_0x12e030][_0x305105(0x24e)]=Math[_0x305105(0x1e7)](_0x3d9119);}),_0x18aa78[_0x118316(0x2a7)]((_0x5591c1,_0x5cdc8d)=>{var _0x22c0c5=_0x118316;_0x590e15[_0x5cdc8d][_0x22c0c5(0x2fd)]=_0xd59410['body'][_0x22c0c5(0x2ec)];}),_0xb80b40['forEach']((_0x2e996c,_0x11d03e)=>{_0x590e15[_0x11d03e]['gross_price']=_0x2e996c;}),_0x1e02e3[_0x118316(0x2a7)]((_0x24ad95,_0x5a8394)=>{var _0x190ee0=_0x118316;_0x590e15[_0x5a8394][_0x190ee0(0x226)]=_0x24ad95;}),_0x475ecc['forEach']((_0x39e9ec,_0x500c16)=>{var _0x5c2ad9=_0x118316;_0x590e15[_0x500c16][_0x5c2ad9(0x21c)]=_0x39e9ec;}),_0x109683[_0x118316(0x2a7)]((_0x128157,_0x3011d7)=>{_0x590e15[_0x3011d7]['primary_code']=_0x128157;}),_0x58f28a[_0x118316(0x2a7)]((_0x271b22,_0x54c01e)=>{_0x590e15[_0x54c01e]['secondary_code']=_0x271b22;}),_0x558582[_0x118316(0x2a7)]((_0xe2f921,_0x7a4487)=>{var _0x222513=_0x118316;_0x590e15[_0x7a4487][_0x222513(0x2eb)]=_0xe2f921;}),_0x3087ad['forEach']((_0x2fb67a,_0xae91c0)=>{var _0xd60323=_0x118316,_0x123ea6=_0x2fb67a[_0xd60323(0x25b)](/[A-Za-z]+/)[0x0],_0x3d3d99=parseInt(_0x2fb67a['match'](/\d+/)[0x0]);_0x590e15[_0xae91c0]['bay']=_0x3d3d99,_0x590e15[_0xae91c0][_0xd60323(0x257)]=_0x123ea6;}),_0x42c07c[_0x118316(0x2a7)]((_0x468c3d,_0x1531a7)=>{var _0x3c8a4e=_0x118316;_0x590e15[_0x1531a7][_0x3c8a4e(0x267)]=_0x468c3d;}),_0x12b611[_0x118316(0x2a7)]((_0x1f99b1,_0x471616)=>{_0x590e15[_0x471616]['secondary_unit']=_0x1f99b1;}),_0x4c6841[_0x118316(0x2a7)]((_0x4f1328,_0x5f22d1)=>{var _0x5cd93c=_0x118316;_0x590e15[_0x5f22d1][_0x5cd93c(0x2d2)]=_0x4f1328;}),_0x4e5c10[_0x118316(0x2a7)]((_0x520cca,_0x44e194)=>{var _0x3f1a3d=_0x118316;_0x590e15[_0x44e194][_0x3f1a3d(0x2d3)]=_0x520cca;}),_0x42419c[_0x118316(0x2a7)]((_0x222eac,_0x1395e9)=>{var _0x3c73f9=_0x118316;_0x590e15[_0x1395e9][_0x3c73f9(0x29a)]=_0x222eac;}),_0x50080d[_0x118316(0x2a7)]((_0x14c728,_0x53e407)=>{_0x590e15[_0x53e407]['maxperunit']=_0x14c728;}),_0x45b21a[_0x118316(0x2a7)]((_0x2be321,_0x395a1b)=>{var _0x10810c=_0x118316;_0x590e15[_0x395a1b][_0x10810c(0x29e)]=_0x2be321;}),_0x3282d5[_0x118316(0x2a7)]((_0x17a6f2,_0x77c0a7)=>{var _0x5536c1=_0x118316;_0x590e15[_0x77c0a7][_0x5536c1(0x23e)]=_0x17a6f2;}),_0x2d517f['forEach']((_0x2e88bd,_0x292420)=>{var _0x15ed69=_0x118316;_0x590e15[_0x292420]['invoice']=_0x2e88bd,_0x590e15[_0x292420][_0x15ed69(0x26b)]=_0x1e7769;});const _0x203a50=new sales_logs();await _0x203a50[_0x118316(0x300)](),_0x2d517f[_0x118316(0x2a7)]((_0x227c2e,_0xf970eb)=>{var _0x560d78=_0x118316;_0x590e15[_0xf970eb][_0x560d78(0x22d)]=_0x560d78(0x2f5)+_0x203a50[_0x560d78(0x265)]['toString']()[_0x560d78(0x27a)](0x8,'0');});var _0xc24fd9=0x0;_0x590e15[_0x118316(0x2a7)](_0x1ad1e3=>{var _0x445ad2=_0x118316;parseFloat(_0x1ad1e3[_0x445ad2(0x2cd)])<parseFloat(_0x1ad1e3['quantity'])&&parseFloat(_0x1ad1e3[_0x445ad2(0x24e)])>parseFloat(_0x1ad1e3['stock'])&&(console[_0x445ad2(0x242)](_0x1ad1e3[_0x445ad2(0x2cd)]+_0x445ad2(0x282)+_0x1ad1e3[_0x445ad2(0x24e)]),_0xc24fd9++);});if(_0xc24fd9!=0x0)return _0xd59410[_0x118316(0x29f)](_0x118316(0x2b2),_0x118316(0x2a6)),_0x3e8781['redirect'](_0x118316(0x273));const _0x350866=_0x590e15['filter'](_0x12af3a=>_0x12af3a[_0x118316(0x24e)]!=='0'&&_0x12af3a[_0x118316(0x24e)]!==''),_0x7e4299=new sales_finished({'invoice':_0x118316(0x2f5)+_0x203a50['invoice_init'][_0x118316(0x2e8)]()['padStart'](0x8,'0'),'sales_data':_0xd59410[_0x118316(0x303)][_0x118316(0x2ec)],'customer':_0xd59410[_0x118316(0x303)][_0x118316(0x2c6)],'date':_0x1e7769,'warehouse_name':_0x2ec50a,'sale_product':_0x350866,'note':_0x108796,'room':_0x49a317,'primary_code':_0x28e046,'secondary_code':_0x578744,'prod_code':_0x4487d1,'SCRN':_0x217df6,'finalize':_0x118316(0x1ea),'mode_transpo':_0x2c2601,'name_driver':_0x37551b,'ReqBy':_0x2f61fc,'dateofreq':_0x21f908,'PO_number':_0x2d68e7,'typeservicesData':_0x33f388,'typevehicle':_0x41693a,'destination':_0xdde242,'deliverydate':_0x15918a,'driver':_0x598baf,'plate':_0x491ebe,'van':_0x5c2def,'DRSI':_0x5923bb,'TSU':_0x2fff5b,'TFU':_0x7977fa,'typeOfProducts':_0x52c29d}),_0x1c086c=await _0x7e4299['save'](),_0x4b0616=await sales_finished['findOne']({'invoice':_0x3b142f});_0xd59410[_0x118316(0x29f)](_0x118316(0x292),_0x118316(0x2a3)),_0x3e8781[_0x118316(0x25a)](_0x118316(0x23d)+_0x1c086c[_0x118316(0x2bc)]);}catch(_0x2894bf){console[_0x118316(0x242)](_0x2894bf);}}),router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x217),auth,async(_0xa68fa3,_0x14b7f7)=>{var _0x455392=a0_0x4b8988;try{const _0x4a6b3e=_0xa68fa3[_0x455392(0x2ac)]['id'];console[_0x455392(0x242)](_0x4a6b3e);const _0x48d477=await product[_0x455392(0x253)](),_0x263121=await purchases[_0x455392(0x2cf)]([{'$match':{'warehouse_name':_0x4a6b3e}},{'$unwind':'$product'},{'$group':{'_id':_0x455392(0x277)}}]);console[_0x455392(0x242)](_0x455392(0x294),_0x263121),_0x14b7f7[_0x455392(0x200)](0xc8)[_0x455392(0x293)]({'purchases_data':_0x263121,'product_data':_0x48d477});}catch(_0x2efdff){console['log'](_0x2efdff);}}),router['post'](a0_0x4b8988(0x2de),auth,async(_0x54ccc7,_0x476008)=>{var _0x57ff2e=a0_0x4b8988;try{const {warehouse_data:_0x3ae033,product_data:_0x17b92f}=_0x54ccc7[_0x57ff2e(0x303)];console[_0x57ff2e(0x242)](_0x54ccc7[_0x57ff2e(0x303)]['product_data']);;const _0x23676c=await master_shop[_0x57ff2e(0x253)]();console[_0x57ff2e(0x242)](_0x57ff2e(0x248),_0x23676c);const _0x1e57a3=await product[_0x57ff2e(0x1e3)]({'name':_0x17b92f});console[_0x57ff2e(0x242)](_0x57ff2e(0x2c3),_0x1e57a3);const _0x2b689f=await warehouse['aggregate']([{'$match':{'name':_0x3ae033}},{'$unwind':_0x57ff2e(0x28b)},{'$match':{'product_details.product_name':_0x17b92f}},{'$group':{'_id':_0x57ff2e(0x260),'product_stock':{'$first':_0x57ff2e(0x2f2)}}}]);console['log'](_0x57ff2e(0x239),_0x2b689f),_0x476008[_0x57ff2e(0x200)](0xc8)[_0x57ff2e(0x293)]({'master':_0x23676c,'new_product':_0x1e57a3,'stock_data':_0x2b689f});}catch(_0x3e34fb){console[_0x57ff2e(0x242)](_0x3e34fb);}}),router['post']('/view/add_sales',auth,async(_0x48e822,_0x29d349)=>{var _0x46bd07=a0_0x4b8988;try{const {invoice:_0x4291f2,date:_0x4f4cf0,warehouse_name:_0x2710bf,product_name:_0x494510,note:_0x37a416,room:_0x35e71b,primary_code:_0x5d3689,secondary_code:_0x54a8f2,prod_code:_0x355371,SCRN:_0x96e9fa,ReqBy:_0x14cc8e,dateofreq:_0x142da8,PO_number:_0x597917,typeservicesData:_0x34da43,typevehicle:_0x20e678,destination:_0x149d8b,deliverydate:_0x1fecc2,driver:_0xbc2467,plate:_0x293ecc,van:_0x5869f7,DRSI:_0x2d89a9,TSU:_0x3f9464,TFU:_0x59066e,mode_transpo:_0x5ab919,name_driver:_0x4ec2f1,pull_out_date:_0x55f770,actual_delivery_date:_0x585e2a}=_0x48e822[_0x46bd07(0x303)];if(typeof _0x494510==_0x46bd07(0x227))var _0x3bf160=[_0x48e822['body'][_0x46bd07(0x1ff)]],_0x4fe132=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2cd)]],_0xd1f38d=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x296)]],_0x4408e6=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x20c)]],_0x170431=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2da)]],_0x5653a0=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x22c)]],_0x149f8e=[_0x48e822['body'][_0x46bd07(0x2b5)]],_0x11b080=[_0x48e822[_0x46bd07(0x303)]['primary_unit']],_0xf831ba=[_0x48e822[_0x46bd07(0x303)]['secondary_unit']],_0x2695f5=[_0x48e822['body'][_0x46bd07(0x2d2)]],_0x3d03a7=[_0x48e822[_0x46bd07(0x303)]['expiry_date']],_0x317961=[_0x48e822[_0x46bd07(0x303)]['product_date']],_0x418bc7=[_0x48e822[_0x46bd07(0x303)]['max_per_unit']],_0x3a2b89=[_0x48e822['body'][_0x46bd07(0x29e)]],_0x41c761=[_0x48e822['body'][_0x46bd07(0x218)]],_0x5c6bbd=[_0x48e822[_0x46bd07(0x303)]['prod_invoice']],_0x240673=[_0x48e822['body'][_0x46bd07(0x21c)]],_0x30a1c8=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x226)]],_0x31401d=[_0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2a5)]];else var _0x3bf160=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x1ff)]],_0x4fe132=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2cd)]],_0xd1f38d=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x296)]],_0x4408e6=[..._0x48e822['body'][_0x46bd07(0x20c)]],_0x170431=[..._0x48e822['body'][_0x46bd07(0x2da)]],_0x5653a0=[..._0x48e822[_0x46bd07(0x303)]['prod_code']],_0x149f8e=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2b5)]],_0x11b080=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x298)]],_0xf831ba=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x262)]],_0x2695f5=[..._0x48e822[_0x46bd07(0x303)]['batch_code']],_0x3d03a7=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2d3)]],_0x317961=[..._0x48e822[_0x46bd07(0x303)]['product_date']],_0x418bc7=[..._0x48e822['body']['max_per_unit']],_0x3a2b89=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x29e)]],_0x41c761=[..._0x48e822[_0x46bd07(0x303)]['RoomAssigned']],_0x5c6bbd=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x1f0)]],_0x240673=[..._0x48e822['body']['id_transaction_from']],_0x30a1c8=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x226)]],_0x31401d=[..._0x48e822[_0x46bd07(0x303)][_0x46bd07(0x2a5)]];const _0x2231c3=_0x3bf160[_0x46bd07(0x301)](_0x1a14b1=>{return _0x1a14b1={'product_name':_0x1a14b1};});_0x4fe132[_0x46bd07(0x2a7)]((_0x5bde6e,_0x2713ae)=>{_0x2231c3[_0x2713ae]['stock']=_0x5bde6e;}),_0xd1f38d[_0x46bd07(0x2a7)]((_0x3235d3,_0x357721)=>{var _0x24bc74=_0x46bd07;_0x2231c3[_0x357721][_0x24bc74(0x24e)]=Math['abs'](_0x3235d3);}),_0x3bf160[_0x46bd07(0x2a7)]((_0x2d76da,_0x3aca55)=>{var _0xd73417=_0x46bd07;_0x2231c3[_0x3aca55][_0xd73417(0x2fd)]=_0x48e822[_0xd73417(0x303)][_0xd73417(0x2ec)];}),_0x31401d['forEach']((_0x1b2130,_0xfbc799)=>{var _0x4b058d=_0x46bd07;_0x2231c3[_0xfbc799][_0x4b058d(0x2a5)]=_0x1b2130;}),_0x30a1c8[_0x46bd07(0x2a7)]((_0x1d2e3c,_0x58ef18)=>{var _0x4e4362=_0x46bd07;_0x2231c3[_0x58ef18][_0x4e4362(0x226)]=_0x1d2e3c;}),_0x240673[_0x46bd07(0x2a7)]((_0x17690d,_0x5af329)=>{var _0xf09d26=_0x46bd07;_0x2231c3[_0x5af329][_0xf09d26(0x21c)]=_0x17690d;}),_0x4408e6['forEach']((_0x5f1bae,_0x4623f1)=>{var _0x5732db=_0x46bd07;_0x2231c3[_0x4623f1][_0x5732db(0x20c)]=_0x5f1bae;}),_0x170431['forEach']((_0x11dc84,_0x5033f2)=>{var _0x34c5ef=_0x46bd07;_0x2231c3[_0x5033f2][_0x34c5ef(0x2da)]=_0x11dc84;}),_0x5653a0[_0x46bd07(0x2a7)]((_0x62b35f,_0x2b852d)=>{var _0x3a2b68=_0x46bd07;_0x2231c3[_0x2b852d][_0x3a2b68(0x2eb)]=_0x62b35f;}),_0x149f8e[_0x46bd07(0x2a7)]((_0x1b2322,_0x3410d7)=>{var _0x4197cc=_0x46bd07,_0x510b84=_0x1b2322['match'](/[A-Za-z]+/)[0x0],_0x1b2014=parseInt(_0x1b2322[_0x4197cc(0x25b)](/\d+/)[0x0]);_0x2231c3[_0x3410d7][_0x4197cc(0x237)]=_0x1b2014,_0x2231c3[_0x3410d7][_0x4197cc(0x257)]=_0x510b84;}),_0x11b080[_0x46bd07(0x2a7)]((_0x6db1d3,_0x27f456)=>{var _0x240850=_0x46bd07;_0x2231c3[_0x27f456][_0x240850(0x267)]=_0x6db1d3;}),_0xf831ba[_0x46bd07(0x2a7)]((_0x13904d,_0x265871)=>{var _0x26df1d=_0x46bd07;_0x2231c3[_0x265871][_0x26df1d(0x262)]=_0x13904d;}),_0x2695f5['forEach']((_0xb971d4,_0x16d47b)=>{var _0x219ba0=_0x46bd07;_0x2231c3[_0x16d47b][_0x219ba0(0x2d2)]=_0xb971d4;}),_0x3d03a7[_0x46bd07(0x2a7)]((_0x150b46,_0x542793)=>{var _0x45b6ad=_0x46bd07;_0x2231c3[_0x542793][_0x45b6ad(0x2d3)]=_0x150b46;}),_0x317961[_0x46bd07(0x2a7)]((_0x313dc3,_0x2eb1a9)=>{var _0x19b697=_0x46bd07;_0x2231c3[_0x2eb1a9][_0x19b697(0x29a)]=_0x313dc3;}),_0x418bc7['forEach']((_0x4b9f5e,_0x10bdef)=>{var _0x5aefd1=_0x46bd07;_0x2231c3[_0x10bdef][_0x5aefd1(0x1e2)]=_0x4b9f5e;}),_0x3a2b89[_0x46bd07(0x2a7)]((_0x2a1b0c,_0x47636e)=>{_0x2231c3[_0x47636e]['prod_cat']=_0x2a1b0c;}),_0x41c761[_0x46bd07(0x2a7)]((_0x21123b,_0x337aa3)=>{var _0x1d9974=_0x46bd07;_0x2231c3[_0x337aa3][_0x1d9974(0x23e)]=_0x21123b;}),_0x5c6bbd[_0x46bd07(0x2a7)]((_0x3b3689,_0x18b9d3)=>{var _0xbed9a=_0x46bd07;_0x2231c3[_0x18b9d3][_0xbed9a(0x224)]=_0x3b3689,_0x2231c3[_0x18b9d3][_0xbed9a(0x26b)]=_0x4f4cf0;});const _0x38205a=new invoice_for_outgoing();await _0x38205a[_0x46bd07(0x300)](),_0x5c6bbd[_0x46bd07(0x2a7)]((_0x55e4fc,_0x216ed2)=>{var _0x55b34b=_0x46bd07;_0x2231c3[_0x216ed2][_0x55b34b(0x22d)]=_0x55b34b(0x297)+_0x38205a[_0x55b34b(0x265)]['toString']()[_0x55b34b(0x27a)](0x8,'0');});var _0x39e08b=0x0;_0x2231c3[_0x46bd07(0x2a7)](_0x328472=>{var _0x38c3ba=_0x46bd07;parseFloat(_0x328472['stock'])<parseFloat(_0x328472[_0x38c3ba(0x24e)])&&parseFloat(_0x328472[_0x38c3ba(0x24e)])>parseFloat(_0x328472[_0x38c3ba(0x2cd)])&&(console[_0x38c3ba(0x242)](_0x328472[_0x38c3ba(0x2cd)]+_0x38c3ba(0x282)+_0x328472['quantity']),_0x39e08b++);});if(_0x39e08b!=0x0)return _0x48e822[_0x46bd07(0x29f)](_0x46bd07(0x2b2),_0x46bd07(0x2a6)),_0x29d349[_0x46bd07(0x25a)](_0x46bd07(0x273));const _0x2962c0=_0x2231c3['filter'](_0x1e9349=>_0x1e9349[_0x46bd07(0x24e)]!=='0'&&_0x1e9349[_0x46bd07(0x24e)]!==''),_0x7f8671=new sales_finished({'invoice':_0x46bd07(0x297)+_0x38205a[_0x46bd07(0x265)][_0x46bd07(0x2e8)]()['padStart'](0x8,'0'),'sales_data':_0x48e822['body']['sales'],'customer':_0x48e822['body']['customer'],'date':_0x4f4cf0,'warehouse_name':_0x2710bf,'sale_product':_0x2962c0,'note':_0x37a416,'room':_0x35e71b,'primary_code':_0x5d3689,'secondary_code':_0x54a8f2,'prod_code':_0x355371,'SCRN':_0x96e9fa,'finalize':_0x46bd07(0x1ea),'mode_transpo':_0x5ab919,'name_driver':_0x4ec2f1,'ReqBy':_0x14cc8e,'dateofreq':_0x142da8,'PO_number':_0x597917,'typeservicesData':_0x34da43,'typevehicle':_0x20e678,'destination':_0x149d8b,'deliverydate':_0x1fecc2,'driver':_0xbc2467,'plate':_0x293ecc,'van':_0x5869f7,'DRSI':_0x2d89a9,'TSU':_0x3f9464,'TFU':_0x59066e,'pullout_date':_0x55f770,'actualdelivery_date':_0x585e2a,'typeOfProducts':'own'}),_0x542e8e=await _0x7f8671[_0x46bd07(0x300)](),_0x3f2af5=await sales_finished[_0x46bd07(0x1e3)]({'invoice':_0x4291f2});_0x48e822['flash'](_0x46bd07(0x292),_0x46bd07(0x2a3)),_0x29d349[_0x46bd07(0x25a)](_0x46bd07(0x23d)+_0x542e8e['_id']);}catch(_0x279188){console['log'](_0x279188);}}),router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x2c1),auth,async(_0x6c70bb,_0x3a5138)=>{var _0x54e026=a0_0x4b8988;try{const {username:_0x3aab44,email:_0x267242,role:_0x595320}=_0x6c70bb[_0x54e026(0x2a8)],_0x3e7077=_0x6c70bb[_0x54e026(0x2a8)],_0x350912=await profile[_0x54e026(0x1e3)]({'email':_0x3e7077[_0x54e026(0x21a)]}),_0xcf8deb=await master_shop['find'](),_0x519489=_0x6c70bb['params']['id'],_0x57d232=await sales_finished[_0x54e026(0x26d)](_0x519489),_0x5827f2=await warehouse[_0x54e026(0x2cf)]([{'$match':{'name':_0x57d232[_0x54e026(0x2d5)]}},{'$unwind':_0x54e026(0x28b)},{'$group':{'_id':_0x54e026(0x25c),'name':{'$first':_0x54e026(0x260)},'product_stock':{'$first':_0x54e026(0x2f2)},'bay':{'$first':_0x54e026(0x1ed)},'bin':{'$first':_0x54e026(0x2c9)},'type':{'$first':_0x54e026(0x20b)},'floorlevel':{'$first':_0x54e026(0x213)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x54e026(0x247)},'product_code':{'$first':_0x54e026(0x2b4)},'storage':{'$first':_0x54e026(0x305)},'rack':{'$first':_0x54e026(0x2d1)},'expiry_date':{'$first':_0x54e026(0x2b0)},'production_date':{'$first':_0x54e026(0x2e5)},'batch_code':{'$first':_0x54e026(0x2fa)},'room':{'$first':'$room'},'room_data':{'$first':'$product_details.room_name'}}}]),_0xd2dc6=await customer[_0x54e026(0x253)]({});let _0x1c3fd0;if(_0x3e7077[_0x54e026(0x219)]==_0x54e026(0x2bb)){const _0x2ac71f=await staff['findOne']({'email':_0x3e7077[_0x54e026(0x21a)]});_0x1c3fd0=await warehouse[_0x54e026(0x2cf)]([{'$match':{'status':_0x54e026(0x29c),'name':_0x2ac71f[_0x54e026(0x259)]}},{'$group':{'_id':_0x54e026(0x203),'name':{'$first':_0x54e026(0x203)}}}]);}else _0x1c3fd0=await warehouse['aggregate']([{'$match':{'status':_0x54e026(0x29c)}},{'$group':{'_id':_0x54e026(0x203),'name':{'$first':_0x54e026(0x203)}}}]);const _0x2cd82d=await product['find']({});if(_0xcf8deb[0x0][_0x54e026(0x2bf)]==_0x54e026(0x216)){var _0x2f749b=users[_0x54e026(0x281)];console[_0x54e026(0x242)](_0x2f749b);}else{if(_0xcf8deb[0x0][_0x54e026(0x2bf)]==_0x54e026(0x271))var _0x2f749b=users[_0x54e026(0x271)];else{if(_0xcf8deb[0x0][_0x54e026(0x2bf)]=='German')var _0x2f749b=users['German'];else{if(_0xcf8deb[0x0][_0x54e026(0x2bf)]==_0x54e026(0x20f))var _0x2f749b=users['Spanish'];else{if(_0xcf8deb[0x0][_0x54e026(0x2bf)]==_0x54e026(0x1fd))var _0x2f749b=users[_0x54e026(0x1fd)];else{if(_0xcf8deb[0x0][_0x54e026(0x2bf)]==_0x54e026(0x23c))var _0x2f749b=users[_0x54e026(0x2fb)];else{if(_0xcf8deb[0x0][_0x54e026(0x2bf)]==_0x54e026(0x264))var _0x2f749b=users[_0x54e026(0x264)];else{if(_0xcf8deb[0x0]['language']==_0x54e026(0x2ef))var _0x2f749b=users['Arabic'];}}}}}}}_0x3a5138[_0x54e026(0x287)]('edit_sales_finished_view',{'success':_0x6c70bb[_0x54e026(0x29f)](_0x54e026(0x292)),'errors':_0x6c70bb[_0x54e026(0x29f)]('errors'),'role':_0x3e7077,'profile':_0x350912,'customer':_0xd2dc6,'warehouse':_0x1c3fd0,'product':_0x5827f2,'user':_0x57d232,'master_shop':_0xcf8deb,'unit':_0x2cd82d,'language':_0x2f749b});}catch(_0x4babbd){console[_0x54e026(0x242)](_0x4babbd);}});async function dataUpdate(_0x215f66,_0x1ab386,_0x5d53b8){var _0x58e669=a0_0x4b8988;return await warehouse[_0x58e669(0x2c4)]({'_id':_0x215f66,'product_details._id':_0x1ab386},{'$set':{'product_details.$.product_stock':_0x5d53b8}}),await warehouse[_0x58e669(0x26d)](_0x215f66);}function a0_0xbeb3(){var _0x347db1=['prod_invoice','add\x20post','foreach\x20newproduct','stocks_QA','maxPerUnit_QA','German','all','<!DOCTYPE\x20html>','$product_details.sales_category','return_sale_finished','split','\x20Order\x20Date\x20:\x20','Sale\x20Return\x20Mail','French','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_name','status','Sale\x20Return','secondary_code_QA','$name','warehouse_id','Enclosed','There\x27s\x20a\x20error\x20in\x20this\x20transaction','sendMail','barcode\x20Product\x20master','floor','return_data','$product_details.type','primary_code','createTransport','product_details','Spanish','logs','$sale_product.type','received_amount','$product_details.floorlevel','secondary_unit_QA','$product_details.level','English\x20(US)','/view/add_sales/:id','RoomAssigned','role','email','production_date_QA','id_transaction_from','$sale_product.bay','gmail','$product_details.secondary_unit','here','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','sale_qty','invoice','random','uuid','string','maxPerUnit','1208115NfmVoN','$product_details.primary_code','valueOf','prod_code','outgoing_invoice','../public/language/languages.json','$finalize','adjust_qty','/barcode_scanner','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','password','39258981FEceSG','sales\x20item\x20return\x20successfull','barcode\x20user_id','bay','Finished\x20Goods','stock_data','</head><body>','$product_details.maxPerUnit','Portuguese\x20(BR)','/all_sales_finished/preview/','room_name','5536456GFUOSC','/all_sales_finished/view','<h2>\x20','log','../models/all_models','<tr>','maxProducts_QA','site_title','$product_details.secondary_code','master','\x20</h2>','$note','expiry_date_QA','$sale_product.bin','OUTF-','quantity','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sales_quantity_QA','$product_details.product_cat','find','\x20Order\x20Number\x20:\x20','max','9309888hZHLaw','level','primary_code_QA','warehouse','redirect','match','$product_details._id','</span>','due_amount','suppliers','$product_details.product_name','image','secondary_unit','<html><head><title></title>','Chinese','invoice_init','length','unit','all_sales_barcode','return_qty_QA','logo','date_data','</div>','findById','push','slice','21cfjHHg','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','back','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Router','<h5\x20style=\x22text-align:\x20left;\x22>','$product.product_name','concat','sales_quantity','padStart','$product_details.unit','../middleware/auth','/view/return_sales/:id','4802915dCSRSY','$customer','$sale_product.quantity','English','\x20<>\x20','<div>','</td>','add_sales_finished_logs','$product_details.invoice','render','catch','batch_code_QA','\x20==\x20','$product_details','Return\x20Rooms','currency_placement','True','sale_product','for_categorize','$sale_product.floorlevel','success','json','purchases_data','sales_invoice','carton','OUT-','primary_unit','<span\x20style=\x22float:\x20right;\x22>','production_date','Logo.png','Enabled','message','prod_cat','flash','</tbody>','/invoice/:id','product_code_QA','Sales\x20Add\x20successfully','post','gross_price','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','forEach','user','product_stock','maxProducts','/give_payment/:id','params','\x20&&\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/all_sales/view','$product_details.expiry_date','/view/:id','errors','return_sale_QA','$product_details.product_code','level2','$_id','return_sale','28610OegOGC','/../public','$room','staff','_id','note','14EeaoBG','language','<h5>','/preview/:id','Ambient','product','updateOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','customer','Received\x20Payment\x20For\x20Sale','currency','$product_details.bin','$invoice','room','/upload/','stock','</table>','aggregate','then','$product_details.rack','batch_code','expiry_date','unit_QA','warehouse_name','$product_details.uuid','10vhkXpa','get','date','secondary_code','$return_data','Arabic','$customers_docs','/view/add_sale/product','amount','int','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$sale_product','$product_details.type_products','product_list','$product_details.production_date','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Sales\x20Update\x20successfully','toString','<hr\x20class=\x22my-3\x22>','/view/add_sales_logs','product_code','sales','/barcode_scanner_logs','Error\x20Occurs','Arabic\x20(ae)','edit_sales_finished','/picking_list/pdf/','$product_details.product_stock','all_sales_finished_logs','3725912jgNvQp','LOG-OUT-','max_per_unit','Return\x20Goods','finalize','</body></html>','$product_details.batch_code','Portuguese','all_sales_finished','agent_id','/view','$date','save','map','own','body','</thead>','$product_details.storage','maxperunit','findOne','/view/add_sales','<tbody\x20style=\x22text-align:\x20center;\x22>','</tr>','abs','$product_details.gross_price','getMonth','False','Email\x20sent\x20successfully','/view_log','$product_details.bay','Quality\x20Inspection','return_qty'];a0_0xbeb3=function(){return _0x347db1;};return a0_0xbeb3();}router['post']('/preview/:id',auth,async(_0x47fe2b,_0x181edb)=>{var _0x23e0d0=a0_0x4b8988;try{const _0x4fc301=_0x47fe2b[_0x23e0d0(0x2ac)]['id'],{invoice:_0x51fa0e,warehouse_name:_0xf420af,room:_0x58cacd}=_0x47fe2b[_0x23e0d0(0x303)],_0x20b44f=await sales_finished[_0x23e0d0(0x1e3)]({'invoice':_0x51fa0e});for(let _0x4161d7=0x0;_0x4161d7<=_0x20b44f[_0x23e0d0(0x28f)][_0x23e0d0(0x266)]-0x1;_0x4161d7++){const _0x2f116f=_0x20b44f[_0x23e0d0(0x28f)][_0x4161d7];var _0x170ece=await warehouse[_0x23e0d0(0x1e3)]({'name':_0xf420af,'room':_0x2f116f[_0x23e0d0(0x23e)]}),_0x27d75e=0x0;for(let _0x1635dd=0x0;_0x1635dd<=_0x170ece[_0x23e0d0(0x20e)][_0x23e0d0(0x266)]-0x1;_0x1635dd++){const _0x466b69=_0x170ece[_0x23e0d0(0x20e)][_0x1635dd];_0x466b69[_0x23e0d0(0x2bc)]==_0x2f116f[_0x23e0d0(0x21c)]&&_0x466b69[_0x23e0d0(0x226)]==_0x2f116f['uuid']&&(_0x27d75e=Math[_0x23e0d0(0x255)](0x0,Math['abs'](_0x466b69[_0x23e0d0(0x2a9)])-Math['abs'](_0x2f116f[_0x23e0d0(0x24e)])),await warehouse[_0x23e0d0(0x2c4)]({'_id':_0x170ece[_0x23e0d0(0x2bc)][_0x23e0d0(0x22b)](),'product_details._id':_0x466b69['_id']['valueOf'](),'product_details.uuid':_0x2f116f[_0x23e0d0(0x226)]},{'$set':{'product_details.$.product_stock':_0x27d75e}}));}console[_0x23e0d0(0x242)](typeof _0x2f116f[_0x23e0d0(0x2fd)]);if(typeof _0x2f116f[_0x23e0d0(0x2fd)]!=='undefined'){var _0x43c73e=await staff[_0x23e0d0(0x26d)](_0x2f116f['agent_id']);console['log'](_0x23e0d0(0x220));var _0x460553=0x0;for(let _0x491afa=0x0;_0x491afa<=_0x43c73e[_0x23e0d0(0x2e4)][_0x23e0d0(0x266)]-0x1;_0x491afa++){const _0x4e93c9=_0x43c73e[_0x23e0d0(0x2e4)][_0x491afa];console[_0x23e0d0(0x242)](_0x2f116f[_0x23e0d0(0x21c)]+_0x23e0d0(0x28a)+_0x4e93c9[_0x23e0d0(0x204)]+_0x23e0d0(0x2ad)+_0x2f116f[_0x23e0d0(0x2bc)]+_0x23e0d0(0x28a)+_0x2f116f[_0x23e0d0(0x2bc)]),_0x2f116f[_0x23e0d0(0x21c)]==_0x4e93c9['warehouse_id']&&_0x2f116f[_0x23e0d0(0x2bc)]==0x1&&(_0x4e93c9[_0x23e0d0(0x2a9)]=Math[_0x23e0d0(0x1e7)](_0x4e93c9['product_stock'])+Math[_0x23e0d0(0x1e7)](_0x2f116f['quantity']),_0x460553++);}console[_0x23e0d0(0x242)](_0x23e0d0(0x2e0),_0x460553),_0x460553=='0'&&(_0x43c73e[_0x23e0d0(0x2e4)]=_0x43c73e[_0x23e0d0(0x2e4)][_0x23e0d0(0x278)]({'product_name':_0x2f116f['product_name'],'product_stock':_0x2f116f[_0x23e0d0(0x24e)],'bay':_0x2f116f[_0x23e0d0(0x237)],'level':_0x2f116f[_0x23e0d0(0x257)],'product_code':_0x2f116f[_0x23e0d0(0x2eb)],'primary_code':_0x2f116f[_0x23e0d0(0x20c)],'secondary_code':_0x2f116f[_0x23e0d0(0x2da)],'expiry_date':_0x2f116f[_0x23e0d0(0x2d3)],'production_date':_0x2f116f['production_date'],'maxProducts':_0x2f116f['maxProducts'],'batch_code':_0x2f116f[_0x23e0d0(0x2d2)],'secondary_unit':_0x2f116f[_0x23e0d0(0x262)],'unit':_0x2f116f[_0x23e0d0(0x267)],'maxProducts':_0x2f116f[_0x23e0d0(0x2aa)],'maxPerUnit':_0x2f116f[_0x23e0d0(0x1e2)],'invoice':_0x2f116f[_0x23e0d0(0x224)],'warehouse_id':_0x2f116f[_0x23e0d0(0x21c)],'id_incoming':_0x2f116f[_0x23e0d0(0x2bc)],'uuid':_0x2f116f[_0x23e0d0(0x226)],'gross_price':_0x2f116f[_0x23e0d0(0x2a5)],'date_incoming':_0x2f116f[_0x23e0d0(0x26b)],'outgoing_invoice':_0x2f116f[_0x23e0d0(0x22d)]}),await _0x43c73e[_0x23e0d0(0x300)]());}}_0x20b44f[_0x23e0d0(0x2f8)]=_0x23e0d0(0x28e);const _0x181a4c=await _0x20b44f['save'](),_0x47ed9a=await master_shop[_0x23e0d0(0x253)](),_0x2a9ba1=await email_settings[_0x23e0d0(0x1e3)](),_0x5ecb3a=await supervisor_settings[_0x23e0d0(0x253)]();var _0x23d07a=_0x20b44f['sale_product'],_0x1a4467='',_0x85cf26;for(_0x85cf26 in _0x23d07a){_0x1a4467+=_0x23e0d0(0x244)+_0x23e0d0(0x2ae)+_0x23d07a[_0x85cf26][_0x23e0d0(0x1ff)]+'</td>'+_0x23e0d0(0x2ae)+_0x23d07a[_0x85cf26]['product_code']+'</td>'+_0x23e0d0(0x2ae)+_0x23d07a[_0x85cf26][_0x23e0d0(0x24e)]+_0x23e0d0(0x284)+_0x23e0d0(0x2ae)+_0x23d07a[_0x85cf26][_0x23e0d0(0x267)]+_0x23e0d0(0x284)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x23d07a[_0x85cf26]['secondary_unit']+'</td>'+_0x23e0d0(0x2ae)+_0x20b44f[_0x23e0d0(0x2d5)]+_0x23e0d0(0x284)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x23d07a[_0x85cf26][_0x23e0d0(0x23e)]+_0x23e0d0(0x284)+_0x23e0d0(0x2ae)+_0x23d07a[_0x85cf26][_0x23e0d0(0x237)]+_0x23e0d0(0x284);}_0x47fe2b[_0x23e0d0(0x29f)](_0x23e0d0(0x292),_0x23e0d0(0x2e7)),_0x181edb[_0x23e0d0(0x25a)](_0x23e0d0(0x2f1)+_0x4fc301);}catch(_0x4d1342){console[_0x23e0d0(0x242)](_0x4d1342);}}),router[a0_0x4b8988(0x2d8)]('/view/:id',auth,async(_0x4cc4d3,_0x458579)=>{var _0x429079=a0_0x4b8988;try{const {username:_0x3fc5ab,email:_0x4ddde4,role:_0x261c09}=_0x4cc4d3[_0x429079(0x2a8)],_0x1c7971=_0x4cc4d3[_0x429079(0x2a8)],_0x59be52=await profile[_0x429079(0x1e3)]({'email':_0x1c7971[_0x429079(0x21a)]}),_0x1aebb9=await master_shop[_0x429079(0x253)](),_0x4c0c21=_0x4cc4d3[_0x429079(0x2ac)]['id'],_0x17d5e0=await sales_finished[_0x429079(0x26d)](_0x4c0c21);let _0x578aaa=new Date(_0x17d5e0[_0x429079(0x2d3)]),_0x321e1a=('0'+_0x578aaa['getDate']())[_0x429079(0x26f)](-0x2),_0x267264=('0'+(_0x578aaa[_0x429079(0x1e9)]()+0x1))[_0x429079(0x26f)](-0x2),_0x202a60=_0x578aaa['getFullYear'](),_0x5205f2=_0x202a60+'-'+_0x267264+'-'+_0x321e1a;var _0x2a115c=['Ambient',_0x429079(0x205)];const _0x3d4e7f=await warehouse['aggregate']([{'$match':{'name':_0x17d5e0[_0x429079(0x2d5)],'room':_0x17d5e0[_0x429079(0x2cb)]}},{'$unwind':_0x429079(0x28b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x429079(0x260)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x429079(0x20b)},'floorlevel':{'$first':_0x429079(0x213)},'primary_code':{'$first':_0x429079(0x22a)},'secondary_code':{'$first':_0x429079(0x247)},'product_code':{'$first':_0x429079(0x2b4)},'storage':{'$first':_0x429079(0x305)},'rack':{'$first':_0x429079(0x2d1)}}}]),_0x11c107=await customer[_0x429079(0x253)]({});let _0x5bf142;if(_0x1c7971['role']=='staff'){const _0x35a691=await staff[_0x429079(0x1e3)]({'email':_0x1c7971[_0x429079(0x21a)]});_0x5bf142=await warehouse[_0x429079(0x2cf)]([{'$match':{'status':_0x429079(0x29c),'name':_0x35a691['warehouse']}},{'$group':{'_id':_0x429079(0x203),'name':{'$first':'$name'}}}]);}else _0x5bf142=await warehouse[_0x429079(0x2cf)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x429079(0x203),'name':{'$first':_0x429079(0x203)}}}]);const _0x493b70=await product[_0x429079(0x253)]({});if(_0x1aebb9[0x0][_0x429079(0x2bf)]==_0x429079(0x216)){var _0x3bf25e=users[_0x429079(0x281)];console['log'](_0x3bf25e);}else{if(_0x1aebb9[0x0]['language']==_0x429079(0x271))var _0x3bf25e=users[_0x429079(0x271)];else{if(_0x1aebb9[0x0][_0x429079(0x2bf)]=='German')var _0x3bf25e=users['German'];else{if(_0x1aebb9[0x0]['language']==_0x429079(0x20f))var _0x3bf25e=users[_0x429079(0x20f)];else{if(_0x1aebb9[0x0][_0x429079(0x2bf)]==_0x429079(0x1fd))var _0x3bf25e=users[_0x429079(0x1fd)];else{if(_0x1aebb9[0x0][_0x429079(0x2bf)]==_0x429079(0x23c))var _0x3bf25e=users[_0x429079(0x2fb)];else{if(_0x1aebb9[0x0][_0x429079(0x2bf)]=='Chinese')var _0x3bf25e=users[_0x429079(0x264)];else{if(_0x1aebb9[0x0][_0x429079(0x2bf)]==_0x429079(0x2ef))var _0x3bf25e=users['Arabic'];}}}}}}}_0x458579[_0x429079(0x287)](_0x429079(0x2f0),{'success':_0x4cc4d3[_0x429079(0x29f)]('success'),'errors':_0x4cc4d3[_0x429079(0x29f)](_0x429079(0x2b2)),'role':_0x1c7971,'profile':_0x59be52,'customer':_0x11c107,'warehouse':_0x5bf142,'product':_0x3d4e7f,'user':_0x17d5e0,'master_shop':_0x1aebb9,'unit':_0x493b70,'language':_0x3bf25e,'rooms_data':_0x2a115c,'ed_fullDate':_0x5205f2});}catch(_0x19d311){console[_0x429079(0x242)](_0x19d311);}}),router[a0_0x4b8988(0x2a4)](a0_0x4b8988(0x2b1),auth,async(_0x218eef,_0xf2d725)=>{var _0x5237a4=a0_0x4b8988;try{const _0x159b1b=_0x218eef[_0x5237a4(0x2ac)]['id'],_0x11c9bd=await sales_finished[_0x5237a4(0x1e3)]({'_id':_0x218eef['params']['id']}),_0x29b17d=await warehouse[_0x5237a4(0x1e3)]({'name':_0x11c9bd['warehouse_name'],'room':_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x2cb)],'warehouse_category':_0x5237a4(0x238)}),{invoice:_0x3433a7,customer:_0x3cf557,date:_0x594654,warehouse_name:_0x33945a,product_name:_0x38945f,stock:_0x2bfcef,adjust_qty:_0x48b15a,note:_0x1133ba,room:_0xd7ef53,primary_code:_0x3a2404,secondary_code:_0x44a16e,prod_code:_0x1589e7,level:_0x5c3ccd,isle:_0x5bd4e4,pallet:_0x244fbc,expiry_date:_0x1fabcb}=_0x218eef['body'];if(typeof _0x38945f==_0x5237a4(0x227))var _0x360f5f=[_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x1ff)]],_0x3cd221=[_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x2cd)]],_0x363be3=[_0x218eef['body'][_0x5237a4(0x230)]],_0x53e1b2=[_0x218eef['body']['primary_code']],_0x320b74=[_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x2da)]],_0x4a9d31=[_0x218eef['body'][_0x5237a4(0x22c)]],_0x23543d=[_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x257)]],_0xe8cfe0=[_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x2d3)]];else var _0x360f5f=[..._0x218eef[_0x5237a4(0x303)][_0x5237a4(0x1ff)]],_0x3cd221=[..._0x218eef[_0x5237a4(0x303)]['stock']],_0x363be3=[..._0x218eef[_0x5237a4(0x303)][_0x5237a4(0x230)]],_0x53e1b2=[..._0x218eef[_0x5237a4(0x303)][_0x5237a4(0x20c)]],_0x320b74=[..._0x218eef[_0x5237a4(0x303)][_0x5237a4(0x2da)]],_0x4a9d31=[..._0x218eef[_0x5237a4(0x303)][_0x5237a4(0x22c)]],_0x23543d=[..._0x218eef[_0x5237a4(0x303)]['level']],_0xe8cfe0=[..._0x218eef['body']['expiry_date']];const _0x10625c=_0x360f5f['map'](_0x2c2756=>{return _0x2c2756={'product_name':_0x2c2756};});_0x3cd221[_0x5237a4(0x2a7)]((_0x1b33ea,_0x2f667d)=>{_0x10625c[_0x2f667d]['stock']=_0x1b33ea;}),_0x363be3[_0x5237a4(0x2a7)]((_0x1f78f3,_0x2beca1)=>{var _0x33309a=_0x5237a4;_0x10625c[_0x2beca1][_0x33309a(0x24e)]=_0x1f78f3;}),_0x53e1b2[_0x5237a4(0x2a7)]((_0xf5a12a,_0x38e898)=>{_0x10625c[_0x38e898]['primary_code']=_0xf5a12a;}),_0x320b74[_0x5237a4(0x2a7)]((_0x404c60,_0x2fec01)=>{var _0x2f05a7=_0x5237a4;_0x10625c[_0x2fec01][_0x2f05a7(0x2da)]=_0x404c60;}),_0x4a9d31[_0x5237a4(0x2a7)]((_0x46b8e5,_0x497dad)=>{var _0x39dfc0=_0x5237a4;_0x10625c[_0x497dad][_0x39dfc0(0x2eb)]=_0x46b8e5;}),_0x23543d[_0x5237a4(0x2a7)]((_0x44dc44,_0x25900a)=>{var _0x158281=_0x5237a4;_0x10625c[_0x25900a][_0x158281(0x257)]=_0x44dc44;}),_0xe8cfe0[_0x5237a4(0x2a7)]((_0x4b50c4,_0x27d86c)=>{var _0x528c54=_0x5237a4;_0x10625c[_0x27d86c][_0x528c54(0x2d3)]=_0x4b50c4;});var _0x31c0a0=0x0;_0x10625c[_0x5237a4(0x2a7)](_0x7a2a77=>{var _0x3a4b7f=_0x5237a4;console[_0x3a4b7f(0x242)](_0x3a4b7f(0x1f2),_0x7a2a77),(parseInt(_0x7a2a77[_0x3a4b7f(0x2cd)])<parseInt(_0x7a2a77[_0x3a4b7f(0x24e)])||parseInt(_0x7a2a77[_0x3a4b7f(0x24e)])==0x0)&&_0x31c0a0++;});if(_0x31c0a0!=0x0)return _0x218eef['flash'](_0x5237a4(0x2b2),_0x5237a4(0x2e6)),_0xf2d725['redirect'](_0x5237a4(0x273));_0x11c9bd[_0x5237a4(0x28f)]['forEach'](_0x1fc32f=>{var _0x2785fe=_0x5237a4;const _0x5302b3=_0x29b17d['product_details'][_0x2785fe(0x301)](_0x51c609=>{var _0x3ff336=_0x2785fe;_0x51c609[_0x3ff336(0x1ff)]==_0x1fc32f['product_name']&&_0x51c609['bay']==_0x1fc32f[_0x3ff336(0x237)]&&(_0x51c609['product_stock']=parseInt(_0x51c609[_0x3ff336(0x2a9)])+parseInt(_0x1fc32f[_0x3ff336(0x24e)]));});}),await _0x29b17d[_0x5237a4(0x300)]();const _0x259e25=_0x10625c['filter'](_0x309a58=>_0x309a58[_0x5237a4(0x24e)]!=='0'&&_0x309a58[_0x5237a4(0x24e)]!=='');_0x11c9bd[_0x5237a4(0x224)]=_0x3433a7,_0x11c9bd['customer']=_0x3cf557,_0x11c9bd[_0x5237a4(0x2d9)]=_0x594654,_0x11c9bd[_0x5237a4(0x2d5)]=_0x33945a,_0x11c9bd['sale_product']=_0x259e25,_0x11c9bd[_0x5237a4(0x2bd)]=_0x1133ba,_0x11c9bd[_0x5237a4(0x2cb)]=_0xd7ef53;const _0x303003=await _0x11c9bd[_0x5237a4(0x300)](),_0x1406cb=await sales_finished[_0x5237a4(0x1e3)]({'_id':_0x218eef[_0x5237a4(0x2ac)]['id']}),_0x562a79=await warehouse['findOne']({'name':_0x33945a,'room':_0xd7ef53,'warehouse_category':_0x5237a4(0x238)});_0x1406cb['sale_product'][_0x5237a4(0x2a7)](_0x2a27b2=>{var _0x109a76=_0x5237a4;const _0x23dd6e=_0x562a79['product_details'][_0x109a76(0x301)](_0x1a386d=>{var _0x2d375c=_0x109a76;_0x1a386d[_0x2d375c(0x1ff)]==_0x2a27b2[_0x2d375c(0x1ff)]&&_0x1a386d[_0x2d375c(0x237)]==_0x2a27b2['bay']&&(_0x1a386d[_0x2d375c(0x2a9)]=parseInt(_0x1a386d['product_stock'])-parseInt(_0x2a27b2[_0x2d375c(0x24e)]));});}),console[_0x5237a4(0x242)]('final',_0x562a79),await _0x562a79[_0x5237a4(0x300)]();const _0x3bba44=await c_payment_data[_0x5237a4(0x1e3)]({'invoice':_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x224)]});_0x3bba44['suppliers']=_0x218eef[_0x5237a4(0x303)][_0x5237a4(0x25f)],await _0x3bba44[_0x5237a4(0x300)](),_0x218eef[_0x5237a4(0x29f)](_0x5237a4(0x292),_0x5237a4(0x2e7)),_0xf2d725[_0x5237a4(0x25a)](_0x5237a4(0x240));}catch(_0x4b64c9){console[_0x5237a4(0x242)](_0x4b64c9);}}),router[a0_0x4b8988(0x2a4)](a0_0x4b8988(0x2ab),auth,async(_0x3ce8bb,_0x33d128)=>{var _0x26a7dd=a0_0x4b8988;try{const _0x408341=_0x3ce8bb[_0x26a7dd(0x2ac)]['id'],{invoice:_0x544a0d,customer:_0x422a5f,receivable_amount:_0x54d4f5,received_amount:_0x37bff5}=_0x3ce8bb[_0x26a7dd(0x303)],_0x182e80=await sales[_0x26a7dd(0x26d)](_0x408341);console[_0x26a7dd(0x242)](_0x182e80);var _0x100a2d=_0x54d4f5-_0x37bff5;console[_0x26a7dd(0x242)](_0x37bff5),_0x182e80[_0x26a7dd(0x212)]=parseFloat(_0x37bff5)+parseFloat(_0x182e80[_0x26a7dd(0x212)]),_0x182e80[_0x26a7dd(0x25e)]=_0x100a2d,console[_0x26a7dd(0x242)](_0x182e80);const _0x4d9afc=await _0x182e80[_0x26a7dd(0x300)](),_0xf780b0=await c_payment_data[_0x26a7dd(0x1e3)]({'invoice':_0x544a0d});_0xf780b0[_0x26a7dd(0x2df)]=_0x100a2d,await _0xf780b0[_0x26a7dd(0x300)]();let _0x13617e=new Date(),_0x1abb79=('0'+_0x13617e['getDate']())['slice'](-0x2),_0x1f4509=('0'+(_0x13617e[_0x26a7dd(0x1e9)]()+0x1))[_0x26a7dd(0x26f)](-0x2),_0x30b4da=_0x13617e['getFullYear'](),_0x56a575=_0x30b4da+'-'+_0x1f4509+'-'+_0x1abb79;const _0x1aea49=new customer_payment({'invoice':_0x544a0d,'date':_0x30b4da+'-'+_0x1f4509+'-'+_0x1abb79,'customer':_0x422a5f,'reason':_0x26a7dd(0x2c7),'amount':_0x37bff5}),_0x367aa4=await _0x1aea49[_0x26a7dd(0x300)]();_0x3ce8bb[_0x26a7dd(0x29f)]('success','payment\x20successfull'),_0x33d128[_0x26a7dd(0x25a)](_0x26a7dd(0x2af));}catch(_0x1e7645){console[_0x26a7dd(0x242)](_0x1e7645);}}),router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x2a1),auth,async(_0x1866f6,_0x2033dc)=>{var _0x44e3b1=a0_0x4b8988;try{const {username:_0x37d42e,email:_0x3139f8,role:_0x546d5a}=_0x1866f6[_0x44e3b1(0x2a8)],_0x51aeaf=_0x1866f6[_0x44e3b1(0x2a8)],_0x158a28=await profile[_0x44e3b1(0x1e3)]({'email':_0x51aeaf[_0x44e3b1(0x21a)]}),_0x4b03b1=await master_shop[_0x44e3b1(0x253)]();console[_0x44e3b1(0x242)](_0x44e3b1(0x248),_0x4b03b1);const _0x29c73e=_0x1866f6[_0x44e3b1(0x2ac)]['id'],_0x3d7a7a=await sales['findById'](_0x29c73e);console[_0x44e3b1(0x242)](_0x3d7a7a);const _0x3dce16=await customer['findOne']({'name':_0x3d7a7a[_0x44e3b1(0x2c6)]});console[_0x44e3b1(0x242)](_0x3dce16);if(_0x4b03b1[0x0]['language']==_0x44e3b1(0x216)){var _0x45e203=users['English'];console['log'](_0x45e203);}else{if(_0x4b03b1[0x0][_0x44e3b1(0x2bf)]==_0x44e3b1(0x271))var _0x45e203=users['Hindi'];else{if(_0x4b03b1[0x0][_0x44e3b1(0x2bf)]==_0x44e3b1(0x1f5))var _0x45e203=users[_0x44e3b1(0x1f5)];else{if(_0x4b03b1[0x0]['language']==_0x44e3b1(0x20f))var _0x45e203=users[_0x44e3b1(0x20f)];else{if(_0x4b03b1[0x0][_0x44e3b1(0x2bf)]==_0x44e3b1(0x1fd))var _0x45e203=users[_0x44e3b1(0x1fd)];else{if(_0x4b03b1[0x0][_0x44e3b1(0x2bf)]==_0x44e3b1(0x23c))var _0x45e203=users[_0x44e3b1(0x2fb)];else{if(_0x4b03b1[0x0]['language']=='Chinese')var _0x45e203=users[_0x44e3b1(0x264)];else{if(_0x4b03b1[0x0][_0x44e3b1(0x2bf)]=='Arabic\x20(ae)')var _0x45e203=users[_0x44e3b1(0x2dc)];}}}}}}}_0x2033dc[_0x44e3b1(0x287)](_0x44e3b1(0x295),{'success':_0x1866f6['flash']('success'),'errors':_0x1866f6[_0x44e3b1(0x29f)](_0x44e3b1(0x2b2)),'role':_0x51aeaf,'profile':_0x158a28,'master_shop':_0x4b03b1,'customers':_0x3dce16,'sales':_0x3d7a7a,'language':_0x45e203});}catch(_0x50ec76){console[_0x44e3b1(0x242)](_0x50ec76);}}),router[a0_0x4b8988(0x2d8)](a0_0x4b8988(0x27d),auth,async(_0x306434,_0x4582d0)=>{var _0x7213f5=a0_0x4b8988;try{const {username:_0x551544,email:_0x2834ef,role:_0x3fc672}=_0x306434[_0x7213f5(0x2a8)],_0x34c512=_0x306434[_0x7213f5(0x2a8)],_0x25b24=await profile[_0x7213f5(0x1e3)]({'email':_0x34c512[_0x7213f5(0x21a)]}),_0x52937f=await master_shop['find'](),_0x42654f=_0x306434['params']['id'],_0x7334b5=await sales_finished[_0x7213f5(0x26d)](_0x42654f),_0x9fc7a5=await warehouse[_0x7213f5(0x2cf)]([{'$match':{'name':_0x7334b5['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x7213f5(0x25c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x7213f5(0x1ed)},'bin':{'$first':_0x7213f5(0x2c9)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x7213f5(0x213)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x7213f5(0x247)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x7213f5(0x305)},'rack':{'$first':_0x7213f5(0x2d1)},'expiry_date':{'$first':_0x7213f5(0x2b0)},'production_date':{'$first':_0x7213f5(0x2e5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0x7213f5(0x2fa)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x2c0cc2=await product[_0x7213f5(0x253)]({}),_0x20d13c=await warehouse[_0x7213f5(0x2cf)]([{'$match':{'status':_0x7213f5(0x29c),'warehouse_category':_0x7213f5(0x238),'name':{'$ne':_0x7213f5(0x2f7),'$ne':_0x7213f5(0x1ee)}}},{'$group':{'_id':_0x7213f5(0x203),'name':{'$first':_0x7213f5(0x203)}}},{'$sort':{'name':0x1}}]);var _0x25bd17=[_0x7213f5(0x28c)];const _0x18a222=await warehouse[_0x7213f5(0x2cf)]([{'$match':{'status':_0x7213f5(0x29c),'name':_0x7213f5(0x1ee)}},{'$group':{'_id':_0x7213f5(0x203),'name':{'$first':_0x7213f5(0x203)}}},{'$sort':{'name':0x1}}]);if(_0x52937f[0x0][_0x7213f5(0x2bf)]=='English\x20(US)'){var _0x30f7bc=users[_0x7213f5(0x281)];console['log'](_0x30f7bc);}else{if(_0x52937f[0x0][_0x7213f5(0x2bf)]=='Hindi')var _0x30f7bc=users[_0x7213f5(0x271)];else{if(_0x52937f[0x0][_0x7213f5(0x2bf)]==_0x7213f5(0x1f5))var _0x30f7bc=users[_0x7213f5(0x1f5)];else{if(_0x52937f[0x0]['language']=='Spanish')var _0x30f7bc=users[_0x7213f5(0x20f)];else{if(_0x52937f[0x0]['language']=='French')var _0x30f7bc=users[_0x7213f5(0x1fd)];else{if(_0x52937f[0x0][_0x7213f5(0x2bf)]==_0x7213f5(0x23c))var _0x30f7bc=users[_0x7213f5(0x2fb)];else{if(_0x52937f[0x0]['language']=='Chinese')var _0x30f7bc=users['Chinese'];else{if(_0x52937f[0x0]['language']==_0x7213f5(0x2ef))var _0x30f7bc=users[_0x7213f5(0x2dc)];}}}}}}}_0x4582d0[_0x7213f5(0x287)](_0x7213f5(0x1f9),{'success':_0x306434[_0x7213f5(0x29f)]('success'),'errors':_0x306434[_0x7213f5(0x29f)](_0x7213f5(0x2b2)),'role':_0x34c512,'profile':_0x25b24,'user':_0x7334b5,'stock':_0x9fc7a5,'master_shop':_0x52937f,'unit':_0x2c0cc2,'language':_0x30f7bc,'warehouses':_0x20d13c,'rooms':_0x25bd17,'warehouse_QA':_0x18a222});}catch(_0x5af820){console['log'](_0x5af820),_0x4582d0[_0x7213f5(0x200)](0xc8)['json']({'message':_0x5af820[_0x7213f5(0x29d)]});}}),router[a0_0x4b8988(0x2a4)](a0_0x4b8988(0x27d),auth,async(_0x4ec8ea,_0x1eb90c)=>{var _0x4d8aba=a0_0x4b8988;if(_0x4ec8ea['body'][_0x4d8aba(0x290)]=='QA')try{const {invoice:_0x5b8e60,date:_0xec3d75,warehouse_name:_0x162eff,product_name:_0xaf6eb7,primary_code:_0x732ea4,secondary_code:_0x395d91,product_code:_0x3c0701,sales_quantity:_0x5b107c,stocks:_0x113810,return_qty:_0x59d34b,Room_name:_0x4b7939,to_warehouse_name_QA:_0x1958ca,to_Room_name_QA:_0x186db5,note:_0x2e4cf3,for_categorize:_0x33d164,product_name_QA1:_0x310da6}=_0x4ec8ea['body'];if(typeof _0x310da6==_0x4d8aba(0x227))var _0x704a5c=[_0x4ec8ea['body']['product_name_QA1']],_0xe63280=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x258)]],_0x1899d5=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x202)]],_0x438e12=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2a2)]],_0x22a63b=[_0x4ec8ea['body'][_0x4d8aba(0x251)]],_0x2e76a7=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x1f3)]],_0x16dc02=[_0x4ec8ea['body']['return_qty_QA']],_0x29bcb8=[_0x4ec8ea['body'][_0x4d8aba(0x1f4)]],_0x125a7e=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x245)]],_0x449059=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x289)]],_0x42f9ac=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x214)]],_0x1dc478=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2d4)]],_0x36fdbb=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x21b)]],_0x3eba13=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x24b)]];else var _0x704a5c=[..._0x4ec8ea[_0x4d8aba(0x303)]['product_name_QA1']],_0xe63280=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x258)]],_0x1899d5=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x202)]],_0x438e12=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2a2)]],_0x22a63b=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x251)]],_0x2e76a7=[..._0x4ec8ea['body']['stocks_QA']],_0x16dc02=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x269)]],_0x29bcb8=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x1f4)]],_0x125a7e=[..._0x4ec8ea[_0x4d8aba(0x303)]['maxProducts_QA']],_0x449059=[..._0x4ec8ea['body'][_0x4d8aba(0x289)]],_0x42f9ac=[..._0x4ec8ea['body'][_0x4d8aba(0x214)]],_0x1dc478=[..._0x4ec8ea['body'][_0x4d8aba(0x2d4)]],_0x36fdbb=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x21b)]],_0x3eba13=[..._0x4ec8ea['body']['expiry_date_QA']];const _0x5b39f8=_0x704a5c[_0x4d8aba(0x301)](_0x1c2443=>{return _0x1c2443={'product_name':_0x1c2443};});_0xe63280[_0x4d8aba(0x2a7)]((_0x1c7461,_0x2c22e2)=>{var _0x5a9454=_0x4d8aba;_0x5b39f8[_0x2c22e2][_0x5a9454(0x20c)]=_0x1c7461;}),_0x1899d5[_0x4d8aba(0x2a7)]((_0x335329,_0x3f139e)=>{var _0x2f4643=_0x4d8aba;_0x5b39f8[_0x3f139e][_0x2f4643(0x2da)]=_0x335329;}),_0x438e12[_0x4d8aba(0x2a7)]((_0x544220,_0x54cfaf)=>{var _0x5ccb54=_0x4d8aba;_0x5b39f8[_0x54cfaf][_0x5ccb54(0x2eb)]=_0x544220;}),_0x22a63b[_0x4d8aba(0x2a7)]((_0x1954b8,_0x2ec99f)=>{var _0xfe8753=_0x4d8aba;_0x5b39f8[_0x2ec99f][_0xfe8753(0x223)]=_0x1954b8;}),_0x2e76a7[_0x4d8aba(0x2a7)]((_0xa16f16,_0x2bded9)=>{_0x5b39f8[_0x2bded9]['stock']=_0xa16f16;}),_0x16dc02['forEach']((_0x5a395a,_0x14a253)=>{var _0x23114e=_0x4d8aba;_0x5b39f8[_0x14a253][_0x23114e(0x1ef)]=_0x5a395a;}),_0x29bcb8[_0x4d8aba(0x2a7)]((_0x37afd3,_0x4ee06c)=>{var _0x142da3=_0x4d8aba;_0x5b39f8[_0x4ee06c][_0x142da3(0x228)]=_0x37afd3;}),_0x125a7e['forEach']((_0x302806,_0x18a393)=>{var _0x2975ab=_0x4d8aba;_0x5b39f8[_0x18a393][_0x2975ab(0x2aa)]=_0x302806;}),_0x449059[_0x4d8aba(0x2a7)]((_0x4391dc,_0x4a05e8)=>{_0x5b39f8[_0x4a05e8]['batch_code']=_0x4391dc;}),_0x42f9ac[_0x4d8aba(0x2a7)]((_0x3efae1,_0x23c1e8)=>{var _0x270170=_0x4d8aba;_0x5b39f8[_0x23c1e8][_0x270170(0x262)]=_0x3efae1;}),_0x1dc478[_0x4d8aba(0x2a7)]((_0x2434aa,_0x48917e)=>{_0x5b39f8[_0x48917e]['unit']=_0x2434aa;}),_0x36fdbb[_0x4d8aba(0x2a7)]((_0x3d52e9,_0x3b6ad5)=>{_0x5b39f8[_0x3b6ad5]['production_date']=_0x3d52e9;}),_0x3eba13[_0x4d8aba(0x2a7)]((_0x5ec5ce,_0x34e90e)=>{var _0x323c28=_0x4d8aba;_0x5b39f8[_0x34e90e][_0x323c28(0x2d3)]=_0x5ec5ce;});const _0x2de447=await sales_finished[_0x4d8aba(0x1e3)]({'invoice':_0x5b8e60});_0x2de447[_0x4d8aba(0x20a)]=_0x4d8aba(0x28e);const _0x47fdbc=await _0x2de447[_0x4d8aba(0x300)](),_0x20683c=new sales_return_finished({'invoice':_0x5b8e60,'customer':_0x4ec8ea[_0x4d8aba(0x303)]['customer'],'date':_0xec3d75,'warehouse_name':_0x162eff,'room':_0x4b7939,'ToWarehouse':_0x1958ca,'ToRoom':_0x186db5,'return_sale_QA':_0x5b39f8,'note':_0x2e4cf3,'warehouse_cat':_0x33d164}),_0x3a238e=await _0x20683c['save'](),_0x73d5c8=await sales_return_finished['findOne']({'invoice':_0x5b8e60}),_0x2ceaea=await warehouse[_0x4d8aba(0x1e3)]({'name':_0x1958ca,'room':_0x186db5});_0x73d5c8[_0x4d8aba(0x2b3)]['forEach'](_0x37df3a=>{var _0x2f3891=_0x4d8aba,_0x4b57f3=0x0;const _0x3c5e29=_0x2ceaea[_0x2f3891(0x20e)][_0x2f3891(0x301)](_0x68a677=>{var _0x5242e6=_0x2f3891;_0x68a677[_0x5242e6(0x1ff)]==_0x37df3a['product_name']&&_0x68a677[_0x5242e6(0x2d3)]==_0x37df3a['expiry_date']&&_0x68a677[_0x5242e6(0x29a)]==_0x37df3a['production_date']&&_0x68a677[_0x5242e6(0x2d2)]==_0x37df3a[_0x5242e6(0x2d2)]&&(_0x68a677['product_stock']=parseInt(_0x68a677['product_stock'])+parseInt(_0x37df3a[_0x5242e6(0x1ef)]),_0x4b57f3++);});_0x4b57f3=='0'&&(_0x2ceaea['product_details']=_0x2ceaea['product_details'][_0x2f3891(0x278)]({'product_name':_0x37df3a[_0x2f3891(0x1ff)],'product_stock':_0x37df3a[_0x2f3891(0x1ef)],'primary_code':_0x37df3a[_0x2f3891(0x20c)],'secondary_code':_0x37df3a['secondary_code'],'product_code':_0x37df3a[_0x2f3891(0x2eb)],'batch_code':_0x37df3a[_0x2f3891(0x2d2)],'maxPerUnit':_0x37df3a['maxPerUnit'],'production_date':_0x37df3a[_0x2f3891(0x29a)],'expiry_date':_0x37df3a[_0x2f3891(0x2d3)],'secondary_unit':_0x37df3a[_0x2f3891(0x262)],'unit':_0x37df3a[_0x2f3891(0x267)],'maxProducts':_0x37df3a['maxProducts'],'bay':_0x37df3a['bay']}));}),await _0x2ceaea[_0x4d8aba(0x300)]();const _0xee22f0=new c_payment_data({'invoice':_0x5b8e60,'customer':_0x4ec8ea['body'][_0x4d8aba(0x2c6)],'reason':_0x4d8aba(0x201)});await _0xee22f0[_0x4d8aba(0x300)]();const _0x5566c7=await master_shop[_0x4d8aba(0x253)](),_0x3c40a1=await email_settings[_0x4d8aba(0x1e3)](),_0x3a6bb9=await customer[_0x4d8aba(0x1e3)]({'name':_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2c6)]});_0x5566c7[0x0][_0x4d8aba(0x28d)]==0x1?(right_currency=_0x5566c7[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5566c7[0x0]['currency']);var _0x5a18dd=_0x704a5c,_0x4301a6=_0x16dc02,_0x35e564='',_0x231638;for(_0x231638 in _0x5a18dd){_0x35e564+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5a18dd[_0x231638]+_0x4d8aba(0x284)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4301a6[_0x231638]+_0x4d8aba(0x284)+_0x4d8aba(0x1e6);}console[_0x4d8aba(0x242)](_0x4d8aba(0x2e4),_0x35e564);let _0xf5add0=nodemailer['createTransport']({'service':_0x4d8aba(0x21e),'auth':{'user':_0x3c40a1['email'],'pass':_0x3c40a1[_0x4d8aba(0x233)]}}),_0x2bd25f={'from':_0x3c40a1[_0x4d8aba(0x21a)],'to':_0x3a6bb9[_0x4d8aba(0x21a)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x4d8aba(0x29b),'path':__dirname+_0x4d8aba(0x2b9)+'/upload/'+_0x5566c7[0x0]['image'],'cid':_0x4d8aba(0x26a)}],'html':'<!DOCTYPE\x20html>'+_0x4d8aba(0x263)+_0x4d8aba(0x23a)+_0x4d8aba(0x283)+_0x4d8aba(0x2c5)+_0x4d8aba(0x283)+_0x4d8aba(0x2e1)+_0x4d8aba(0x26c)+_0x4d8aba(0x283)+_0x4d8aba(0x241)+_0x5566c7[0x0][_0x4d8aba(0x246)]+_0x4d8aba(0x249)+_0x4d8aba(0x26c)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4d8aba(0x254)+_0x5b8e60+'\x20'+_0x4d8aba(0x299)+_0x4d8aba(0x1fb)+_0xec3d75+'\x20'+'</span>'+_0x4d8aba(0x221)+_0x4d8aba(0x26c)+_0x4d8aba(0x1fe)+_0x4d8aba(0x232)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4d8aba(0x222)+_0x4d8aba(0x272)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4d8aba(0x1e6)+_0x4d8aba(0x304)+_0x4d8aba(0x1e5)+'\x20'+_0x35e564+'\x20'+_0x4d8aba(0x2a0)+_0x4d8aba(0x2ce)+_0x4d8aba(0x283)+'<strong>\x20Regards\x20</strong>'+_0x4d8aba(0x2c0)+_0x5566c7[0x0][_0x4d8aba(0x246)]+_0x4d8aba(0x221)+_0x4d8aba(0x26c)+_0x4d8aba(0x26c)+_0x4d8aba(0x2f9)};_0xf5add0[_0x4d8aba(0x207)](_0x2bd25f,function(_0x617968,_0x45dcd8){var _0x4cfa5f=_0x4d8aba;_0x617968?(console[_0x4cfa5f(0x242)](_0x617968),console[_0x4cfa5f(0x242)](_0x4cfa5f(0x2ee))):console[_0x4cfa5f(0x242)](_0x4cfa5f(0x1eb));}),_0x4ec8ea[_0x4d8aba(0x29f)](_0x4d8aba(0x292),'sales\x20item\x20return\x20successfull'),_0x1eb90c['redirect']('/all_sales_finished/view');}catch(_0x1f25e2){_0x1eb90c[_0x4d8aba(0x200)](0xc8)[_0x4d8aba(0x293)]({'message1':_0x1f25e2[_0x4d8aba(0x29d)]});}else{if(_0x4ec8ea[_0x4d8aba(0x303)]['for_categorize']=='GS')try{const {invoice:_0x449364,date:_0x2f35d1,warehouse_name:_0x4e5445,product_name:_0x3c826a,primary_code:_0x3dd117,secondary_code:_0xaf3374,product_code:_0x3e24bd,sales_quantity:_0x8e416e,stocks:_0x1f9c99,return_qty:_0x391b6e,Room_name:_0x311729,to_warehouse_name:_0x27adb1,to_Room_name:_0x1c9eff,note:_0x5786ee,level:_0x36e690,isle:_0x3a71bf,pallet:_0x4b045b,for_categorize:_0x34abc1}=_0x4ec8ea['body'];if(typeof _0x3c826a==_0x4d8aba(0x227))var _0x704a5c=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x1ff)]],_0xe63280=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x20c)]],_0x1899d5=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2da)]],_0x438e12=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2eb)]],_0x22a63b=[_0x4ec8ea['body'][_0x4d8aba(0x279)]],_0x16dc02=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x1ef)]],_0x57290f=[_0x4ec8ea['body'][_0x4d8aba(0x237)]],_0x29bcb8=[_0x4ec8ea[_0x4d8aba(0x303)]['maxPerUnit']],_0x125a7e=[_0x4ec8ea['body']['maxProducts']],_0x449059=[_0x4ec8ea['body']['batch_code']],_0x42f9ac=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x262)]],_0x1dc478=[_0x4ec8ea['body'][_0x4d8aba(0x267)]],_0x36fdbb=[_0x4ec8ea[_0x4d8aba(0x303)]['production_date']],_0x3eba13=[_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2d3)]];else var _0x704a5c=[..._0x4ec8ea['body'][_0x4d8aba(0x1ff)]],_0xe63280=[..._0x4ec8ea[_0x4d8aba(0x303)]['primary_code']],_0x1899d5=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2da)]],_0x438e12=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2eb)]],_0x22a63b=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x279)]],_0x16dc02=[..._0x4ec8ea[_0x4d8aba(0x303)]['return_qty']],_0x57290f=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x237)]],_0x29bcb8=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x228)]],_0x125a7e=[..._0x4ec8ea['body'][_0x4d8aba(0x2aa)]],_0x449059=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2d2)]],_0x42f9ac=[..._0x4ec8ea['body'][_0x4d8aba(0x262)]],_0x1dc478=[..._0x4ec8ea['body'][_0x4d8aba(0x267)]],_0x36fdbb=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x29a)]],_0x3eba13=[..._0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2d3)]];const _0x54382f=_0x704a5c[_0x4d8aba(0x301)](_0x1ffa3f=>{return _0x1ffa3f={'product_name':_0x1ffa3f};});_0xe63280[_0x4d8aba(0x2a7)]((_0x444c05,_0x2d722b)=>{var _0x23f9b8=_0x4d8aba;_0x54382f[_0x2d722b][_0x23f9b8(0x20c)]=_0x444c05;}),_0x1899d5[_0x4d8aba(0x2a7)]((_0x59a4bd,_0x507df5)=>{var _0x52920a=_0x4d8aba;_0x54382f[_0x507df5][_0x52920a(0x2da)]=_0x59a4bd;}),_0x438e12[_0x4d8aba(0x2a7)]((_0x51d53c,_0x4e6b8f)=>{var _0x4f05dc=_0x4d8aba;_0x54382f[_0x4e6b8f][_0x4f05dc(0x2eb)]=_0x51d53c;}),_0x22a63b[_0x4d8aba(0x2a7)]((_0x2d492c,_0x7a6cb3)=>{var _0x5b57d9=_0x4d8aba;_0x54382f[_0x7a6cb3][_0x5b57d9(0x223)]=_0x2d492c;}),_0x16dc02[_0x4d8aba(0x2a7)]((_0x2f2958,_0x37de93)=>{var _0xc5d9fb=_0x4d8aba;_0x54382f[_0x37de93][_0xc5d9fb(0x1ef)]=_0x2f2958;}),_0x57290f[_0x4d8aba(0x2a7)]((_0x2817d5,_0x1e8054)=>{var _0x6f3433=_0x4d8aba;_0x54382f[_0x1e8054][_0x6f3433(0x237)]=_0x2817d5;}),_0x29bcb8[_0x4d8aba(0x2a7)]((_0x3a69dc,_0x41eb6d)=>{var _0x30e353=_0x4d8aba;_0x54382f[_0x41eb6d][_0x30e353(0x228)]=_0x3a69dc;}),_0x125a7e[_0x4d8aba(0x2a7)]((_0x32db50,_0x2fd1fe)=>{var _0x12bda4=_0x4d8aba;_0x54382f[_0x2fd1fe][_0x12bda4(0x2aa)]=_0x32db50;}),_0x449059['forEach']((_0x1fa899,_0x382738)=>{var _0x40e168=_0x4d8aba;_0x54382f[_0x382738][_0x40e168(0x2d2)]=_0x1fa899;}),_0x42f9ac[_0x4d8aba(0x2a7)]((_0x5e19b3,_0x6786f)=>{var _0x5c81b8=_0x4d8aba;_0x54382f[_0x6786f][_0x5c81b8(0x262)]=_0x5e19b3;}),_0x1dc478['forEach']((_0xe557d1,_0xb56c9b)=>{_0x54382f[_0xb56c9b]['unit']=_0xe557d1;}),_0x36fdbb[_0x4d8aba(0x2a7)]((_0xbb62e8,_0x436202)=>{var _0x270e97=_0x4d8aba;_0x54382f[_0x436202][_0x270e97(0x29a)]=_0xbb62e8;}),_0x3eba13[_0x4d8aba(0x2a7)]((_0x5e4438,_0x425e3b)=>{var _0x6af27f=_0x4d8aba;_0x54382f[_0x425e3b][_0x6af27f(0x2d3)]=_0x5e4438;});var _0x4101a3=0x0;_0x54382f[_0x4d8aba(0x2a7)](_0x1ed40b=>{var _0xcc61eb=_0x4d8aba;(parseInt(_0x1ed40b[_0xcc61eb(0x223)])<parseInt(_0x1ed40b[_0xcc61eb(0x1ef)])||parseInt(_0x1ed40b[_0xcc61eb(0x2cd)])<parseInt(_0x1ed40b['return_qty'])&&parseInt(_0x1ed40b[_0xcc61eb(0x223)])>parseInt(_0x1ed40b[_0xcc61eb(0x1ef)])||parseInt(_0x1ed40b[_0xcc61eb(0x1ef)])==0x0)&&_0x4101a3++;});if(_0x4101a3!=0x0)return _0x4ec8ea['flash']('errors',_0x4d8aba(0x274)),_0x1eb90c[_0x4d8aba(0x25a)](_0x4d8aba(0x273));const _0x2863e7=await sales_finished[_0x4d8aba(0x1e3)]({'invoice':_0x449364});_0x2863e7[_0x4d8aba(0x20a)]=_0x4d8aba(0x28e);const _0x29adab=await _0x2863e7[_0x4d8aba(0x300)](),_0x35989c=new sales_return_finished({'invoice':_0x449364,'customer':_0x4ec8ea['body'][_0x4d8aba(0x2c6)],'date':_0x2f35d1,'warehouse_name':_0x4e5445,'room':_0x311729,'ToWarehouse':_0x27adb1,'ToRoom':_0x1c9eff,'return_sale':_0x54382f,'note':_0x5786ee,'warehouse_cat':_0x34abc1}),_0x57282d=await _0x35989c['save'](),_0x5d75c7=await sales_return_finished[_0x4d8aba(0x1e3)]({'invoice':_0x449364}),_0x5be814=await warehouse[_0x4d8aba(0x1e3)]({'name':_0x27adb1,'room':_0x1c9eff,'warehouse_category':_0x4d8aba(0x238)});_0x5d75c7[_0x4d8aba(0x2b7)][_0x4d8aba(0x2a7)](_0x461110=>{var _0xa4ea7=_0x4d8aba,_0x1a42e7=0x0;const _0x5b13cf=_0x5be814['product_details'][_0xa4ea7(0x301)](_0x144bd0=>{var _0x4c1557=_0xa4ea7;_0x144bd0['product_name']==_0x461110['product_name']&&_0x144bd0[_0x4c1557(0x237)]==_0x461110[_0x4c1557(0x237)]&&_0x144bd0[_0x4c1557(0x2d3)]==_0x461110[_0x4c1557(0x2d3)]&&_0x144bd0['production_date']==_0x461110[_0x4c1557(0x29a)]&&_0x144bd0[_0x4c1557(0x2d2)]==_0x461110['batch_code']&&(_0x144bd0[_0x4c1557(0x2a9)]=parseInt(_0x144bd0[_0x4c1557(0x2a9)])+parseInt(_0x461110[_0x4c1557(0x1ef)]),_0x1a42e7++);});_0x1a42e7=='0'&&(_0x5be814[_0xa4ea7(0x20e)]=_0x5be814[_0xa4ea7(0x20e)]['concat']({'product_name':_0x461110[_0xa4ea7(0x1ff)],'product_stock':_0x461110[_0xa4ea7(0x1ef)],'primary_code':_0x461110[_0xa4ea7(0x20c)],'secondary_code':_0x461110['secondary_code'],'product_code':_0x461110[_0xa4ea7(0x2eb)],'bay':_0x461110[_0xa4ea7(0x237)],'batch_code':_0x461110[_0xa4ea7(0x2d2)],'maxPerUnit':_0x461110['maxPerUnit'],'production_date':_0x461110['production_date'],'expiry_date':_0x461110[_0xa4ea7(0x2d3)],'secondary_unit':_0x461110[_0xa4ea7(0x262)],'unit':_0x461110[_0xa4ea7(0x267)],'maxProducts':_0x461110['maxProducts']}));}),await _0x5be814[_0x4d8aba(0x300)](),console[_0x4d8aba(0x242)](_0x4ec8ea[_0x4d8aba(0x303)]);const _0x879238=new c_payment_data({'invoice':_0x449364,'customer':_0x4ec8ea['body']['customer'],'reason':_0x4d8aba(0x201)});await _0x879238[_0x4d8aba(0x300)]();const _0xd5d92f=await master_shop[_0x4d8aba(0x253)]();console[_0x4d8aba(0x242)](_0x4d8aba(0x1f1),_0xd5d92f[0x0][_0x4d8aba(0x261)]);const _0xa4894e=await email_settings[_0x4d8aba(0x1e3)](),_0x121171=await customer[_0x4d8aba(0x1e3)]({'name':_0x4ec8ea[_0x4d8aba(0x303)][_0x4d8aba(0x2c6)]});console[_0x4d8aba(0x242)]('customer_data',_0x121171);_0xd5d92f[0x0][_0x4d8aba(0x28d)]==0x1?(right_currency=_0xd5d92f[0x0][_0x4d8aba(0x2c8)],left_currency=''):(right_currency='',left_currency=_0xd5d92f[0x0][_0x4d8aba(0x2c8)]);var _0x5a18dd=_0x704a5c,_0x4301a6=_0x16dc02,_0x35e564='',_0x231638;for(_0x231638 in _0x5a18dd){_0x35e564+=_0x4d8aba(0x244)+_0x4d8aba(0x2ae)+_0x5a18dd[_0x231638]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4301a6[_0x231638]+_0x4d8aba(0x284)+_0x4d8aba(0x1e6);}console['log'](_0x4d8aba(0x2e4),_0x35e564);let _0x3461b3=nodemailer[_0x4d8aba(0x20d)]({'service':'gmail','auth':{'user':_0xa4894e[_0x4d8aba(0x21a)],'pass':_0xa4894e[_0x4d8aba(0x233)]}}),_0x5b8f1c={'from':_0xa4894e[_0x4d8aba(0x21a)],'to':_0x121171[_0x4d8aba(0x21a)],'subject':_0x4d8aba(0x1fc),'attachments':[{'filename':_0x4d8aba(0x29b),'path':__dirname+'/../public'+_0x4d8aba(0x2cc)+_0xd5d92f[0x0][_0x4d8aba(0x261)],'cid':_0x4d8aba(0x26a)}],'html':_0x4d8aba(0x1f7)+'<html><head><title></title>'+_0x4d8aba(0x23a)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4d8aba(0x283)+_0x4d8aba(0x2e1)+'</div>'+_0x4d8aba(0x283)+_0x4d8aba(0x241)+_0xd5d92f[0x0][_0x4d8aba(0x246)]+'\x20</h2>'+_0x4d8aba(0x26c)+'</div>'+_0x4d8aba(0x2e9)+_0x4d8aba(0x283)+_0x4d8aba(0x276)+_0x4d8aba(0x254)+_0x449364+'\x20'+_0x4d8aba(0x299)+'\x20Order\x20Date\x20:\x20'+_0x2f35d1+'\x20'+_0x4d8aba(0x25d)+_0x4d8aba(0x221)+_0x4d8aba(0x26c)+_0x4d8aba(0x1fe)+_0x4d8aba(0x232)+_0x4d8aba(0x244)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4d8aba(0x222)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4d8aba(0x250)+'</tr>'+_0x4d8aba(0x304)+_0x4d8aba(0x1e5)+'\x20'+_0x35e564+'\x20'+'</tbody>'+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x4d8aba(0x2c0)+_0xd5d92f[0x0][_0x4d8aba(0x246)]+_0x4d8aba(0x221)+_0x4d8aba(0x26c)+_0x4d8aba(0x26c)+_0x4d8aba(0x2f9)};_0x3461b3['sendMail'](_0x5b8f1c,function(_0x227685,_0x3bc103){var _0x1be2c3=_0x4d8aba;_0x227685?(console[_0x1be2c3(0x242)](_0x227685),console[_0x1be2c3(0x242)]('Error\x20Occurs')):console['log'](_0x1be2c3(0x1eb));}),_0x4ec8ea[_0x4d8aba(0x29f)]('success',_0x4d8aba(0x235)),_0x1eb90c[_0x4d8aba(0x25a)]('/all_sales_finished/view');}catch(_0x4968ec){console['log'](_0x4968ec),_0x1eb90c[_0x4d8aba(0x200)](0xc8)[_0x4d8aba(0x293)]({'message1':_0x4968ec[_0x4d8aba(0x29d)]});}}}),router[a0_0x4b8988(0x2d8)]('/barcode/:id',auth,async(_0x115933,_0x18ea0b)=>{var _0x4ffebf=a0_0x4b8988;try{const {username:_0x409213,email:_0x34641a,role:_0x5dbc0f}=_0x115933[_0x4ffebf(0x2a8)],_0x3e93c1=_0x115933[_0x4ffebf(0x2a8)],_0xdae74=await profile[_0x4ffebf(0x1e3)]({'email':_0x3e93c1[_0x4ffebf(0x21a)]}),_0x34a513=await master_shop[_0x4ffebf(0x253)]();console[_0x4ffebf(0x242)](_0x4ffebf(0x208),_0x34a513);const _0x42b16b=_0x115933[_0x4ffebf(0x2ac)]['id'],_0x22cf86=await sales[_0x4ffebf(0x26d)](_0x42b16b);console[_0x4ffebf(0x242)](_0x4ffebf(0x236),_0x22cf86);if(_0x34a513[0x0][_0x4ffebf(0x2bf)]==_0x4ffebf(0x216))var _0x9eff08=users[_0x4ffebf(0x281)];else{if(_0x34a513[0x0][_0x4ffebf(0x2bf)]==_0x4ffebf(0x271))var _0x9eff08=users[_0x4ffebf(0x271)];else{if(_0x34a513[0x0][_0x4ffebf(0x2bf)]==_0x4ffebf(0x1f5))var _0x9eff08=users[_0x4ffebf(0x1f5)];else{if(_0x34a513[0x0][_0x4ffebf(0x2bf)]==_0x4ffebf(0x20f))var _0x9eff08=users[_0x4ffebf(0x20f)];else{if(_0x34a513[0x0]['language']==_0x4ffebf(0x1fd))var _0x9eff08=users[_0x4ffebf(0x1fd)];else{if(_0x34a513[0x0][_0x4ffebf(0x2bf)]==_0x4ffebf(0x23c))var _0x9eff08=users['Portuguese'];else{if(_0x34a513[0x0][_0x4ffebf(0x2bf)]=='Chinese')var _0x9eff08=users['Chinese'];else{if(_0x34a513[0x0][_0x4ffebf(0x2bf)]==_0x4ffebf(0x2ef))var _0x9eff08=users[_0x4ffebf(0x2dc)];}}}}}}}_0x18ea0b[_0x4ffebf(0x287)](_0x4ffebf(0x268),{'success':_0x115933['flash']('success'),'errors':_0x115933[_0x4ffebf(0x29f)](_0x4ffebf(0x2b2)),'role':_0x3e93c1,'profile':_0xdae74,'alldata':_0x22cf86,'master_shop':_0x34a513,'language':_0x9eff08});}catch(_0x2dd25c){console['log'](_0x2dd25c);}}),router[a0_0x4b8988(0x2a4)](a0_0x4b8988(0x231),async(_0x6a923c,_0x1aff06)=>{var _0x16ed36=a0_0x4b8988;const {product_code:_0x1ba922,warehouse_name:_0x97b489,rooms_data:_0x3dafec,Roomslist:_0x539bc3,sales_category:_0xe03f5}=_0x6a923c[_0x16ed36(0x303)],_0x19d14a=_0x539bc3[_0x16ed36(0x1fa)](','),_0x2ef7d6=[];async function _0x529cf0(_0x358452){var _0xb5a9a5=_0x16ed36;const _0x1a672a=await warehouse[_0xb5a9a5(0x2cf)]([{'$match':{'name':_0x97b489,'room':_0x358452}},{'$unwind':_0xb5a9a5(0x28b)},{'$match':{'product_details.primary_code':_0x1ba922}},{'$group':{'_id':_0xb5a9a5(0x25c),'name':{'$first':_0xb5a9a5(0x260)},'product_stock':{'$first':_0xb5a9a5(0x2f2)},'primary_code':{'$first':_0xb5a9a5(0x22a)},'secondary_code':{'$first':_0xb5a9a5(0x247)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xb5a9a5(0x215)},'bay':{'$first':'$product_details.bay'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xb5a9a5(0x213)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xb5a9a5(0x21f)},'storage':{'$first':_0xb5a9a5(0x305)},'rack':{'$first':_0xb5a9a5(0x2d1)},'expiry_date':{'$first':_0xb5a9a5(0x2b0)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0xb5a9a5(0x23b)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0xb5a9a5(0x286)},'uuid':{'$first':_0xb5a9a5(0x2d6)},'gross_price':{'$first':_0xb5a9a5(0x1e8)},'sales_category':{'$first':'$product_details.sales_category'}}}]),_0xddf49b=await warehouse[_0xb5a9a5(0x2cf)]([{'$match':{'name':_0x97b489,'room':_0x358452}},{'$unwind':_0xb5a9a5(0x28b)},{'$match':{'product_details.secondary_code':_0x1ba922}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xb5a9a5(0x260)},'product_stock':{'$first':_0xb5a9a5(0x2f2)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xb5a9a5(0x247)},'product_code':{'$first':_0xb5a9a5(0x2b4)},'level':{'$first':_0xb5a9a5(0x1ed)},'isle':{'$first':_0xb5a9a5(0x2c9)},'type':{'$first':_0xb5a9a5(0x20b)},'pallet':{'$first':_0xb5a9a5(0x213)},'unit':{'$first':_0xb5a9a5(0x27b)},'secondary_unit':{'$first':_0xb5a9a5(0x21f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xb5a9a5(0x2d1)},'expiry_date':{'$first':_0xb5a9a5(0x2b0)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0xb5a9a5(0x23b)},'batch_code':{'$first':_0xb5a9a5(0x2fa)},'product_cat':{'$first':_0xb5a9a5(0x252)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0xb5a9a5(0x286)},'uuid':{'$first':_0xb5a9a5(0x2d6)},'gross_price':{'$first':_0xb5a9a5(0x1e8)},'sales_category':{'$first':_0xb5a9a5(0x1f8)}}}]);if(_0x1a672a[_0xb5a9a5(0x266)]>0x0)_0x2ef7d6['push'](_0x1a672a);else _0xddf49b[_0xb5a9a5(0x266)]>0x0&&_0x2ef7d6['push'](_0xddf49b);}const _0x508893=_0x19d14a['map'](_0x1acc5c=>_0x529cf0(_0x1acc5c));await Promise[_0x16ed36(0x1f6)](_0x508893),_0x1aff06['json'](_0x2ef7d6);}),router['post'](a0_0x4b8988(0x2ed),async(_0x128e28,_0x2ee4e0)=>{var _0x14a54f=a0_0x4b8988;const {product_code:_0x34eecd,warehouse_name:_0x10b736,rooms_data:_0x53748f,Roomslist:_0x47b9c8,sales_category:_0x521f87}=_0x128e28[_0x14a54f(0x303)],_0x50acd6=_0x47b9c8[_0x14a54f(0x1fa)](','),_0x35de41=[];async function _0x3ff0b1(_0x71ce3f){var _0x48fb3c=_0x14a54f;const _0xfcc88a=await warehouse[_0x48fb3c(0x2cf)]([{'$match':{'name':_0x10b736,'room':_0x71ce3f}},{'$unwind':_0x48fb3c(0x28b)},{'$match':{'product_details.primary_code':_0x34eecd,'product_details.sales_category':_0x521f87,'product_details.type_products':_0x48fb3c(0x242)}},{'$group':{'_id':_0x48fb3c(0x25c),'name':{'$first':_0x48fb3c(0x260)},'product_stock':{'$first':_0x48fb3c(0x2f2)},'primary_code':{'$first':_0x48fb3c(0x22a)},'secondary_code':{'$first':_0x48fb3c(0x247)},'product_code':{'$first':_0x48fb3c(0x2b4)},'level':{'$first':_0x48fb3c(0x215)},'bay':{'$first':_0x48fb3c(0x1ed)},'type':{'$first':_0x48fb3c(0x20b)},'pallet':{'$first':_0x48fb3c(0x213)},'unit':{'$first':_0x48fb3c(0x27b)},'secondary_unit':{'$first':_0x48fb3c(0x21f)},'storage':{'$first':_0x48fb3c(0x305)},'rack':{'$first':_0x48fb3c(0x2d1)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x48fb3c(0x23b)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x48fb3c(0x252)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x48fb3c(0x2ba)},'invoice':{'$first':_0x48fb3c(0x286)},'uuid':{'$first':_0x48fb3c(0x2d6)},'gross_price':{'$first':_0x48fb3c(0x1e8)},'sales_category':{'$first':_0x48fb3c(0x1f8)},'type_products':{'$first':_0x48fb3c(0x2e3)}}}]);console[_0x48fb3c(0x242)](_0x48fb3c(0x242)+'\x20<>\x20'+_0x34eecd+_0x48fb3c(0x282)+_0x521f87);const _0x9f7348=await warehouse['aggregate']([{'$match':{'name':_0x10b736,'room':_0x71ce3f}},{'$unwind':_0x48fb3c(0x28b)},{'$match':{'product_details.secondary_code':_0x34eecd,'product_details.sales_category':_0x521f87,'product_details.type_products':'log'}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x48fb3c(0x2f2)},'primary_code':{'$first':_0x48fb3c(0x22a)},'secondary_code':{'$first':_0x48fb3c(0x247)},'product_code':{'$first':_0x48fb3c(0x2b4)},'level':{'$first':_0x48fb3c(0x1ed)},'isle':{'$first':_0x48fb3c(0x2c9)},'type':{'$first':_0x48fb3c(0x20b)},'pallet':{'$first':_0x48fb3c(0x213)},'unit':{'$first':_0x48fb3c(0x27b)},'secondary_unit':{'$first':_0x48fb3c(0x21f)},'storage':{'$first':_0x48fb3c(0x305)},'rack':{'$first':_0x48fb3c(0x2d1)},'expiry_date':{'$first':_0x48fb3c(0x2b0)},'production_date':{'$first':_0x48fb3c(0x2e5)},'maxPerUnit':{'$first':_0x48fb3c(0x23b)},'batch_code':{'$first':_0x48fb3c(0x2fa)},'product_cat':{'$first':_0x48fb3c(0x252)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x48fb3c(0x2ba)},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0x48fb3c(0x2d6)},'gross_price':{'$first':_0x48fb3c(0x1e8)},'sales_category':{'$first':_0x48fb3c(0x1f8)},'type_products':{'$first':_0x48fb3c(0x2e3)}}}]);if(_0xfcc88a[_0x48fb3c(0x266)]>0x0)_0x35de41[_0x48fb3c(0x26e)](_0xfcc88a);else _0x9f7348[_0x48fb3c(0x266)]>0x0&&_0x35de41[_0x48fb3c(0x26e)](_0x9f7348);}const _0x33a72b=_0x50acd6[_0x14a54f(0x301)](_0x5ee0bc=>_0x3ff0b1(_0x5ee0bc));await Promise[_0x14a54f(0x1f6)](_0x33a72b),_0x2ee4e0['json'](_0x35de41);}),module['exports']=router;