var a0_0x542edf=a0_0x53b0;(function(_0x667805,_0x54d8b5){var _0x967109=a0_0x53b0,_0x584018=_0x667805();while(!![]){try{var _0x23b6c9=parseInt(_0x967109(0x191))/0x1+-parseInt(_0x967109(0x114))/0x2+-parseInt(_0x967109(0x15c))/0x3+parseInt(_0x967109(0x14b))/0x4*(-parseInt(_0x967109(0xa8))/0x5)+-parseInt(_0x967109(0x19b))/0x6+parseInt(_0x967109(0xd9))/0x7*(parseInt(_0x967109(0x150))/0x8)+parseInt(_0x967109(0x182))/0x9;if(_0x23b6c9===_0x54d8b5)break;else _0x584018['push'](_0x584018['shift']());}catch(_0xacb2c4){_0x584018['push'](_0x584018['shift']());}}}(a0_0x2b68,0x81413));const express=require(a0_0x542edf(0x174)),app=express(),router=express[a0_0x542edf(0x1b8)](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require('../models/all_models'),auth=require(a0_0x542edf(0x9f)),nodemailer=require(a0_0x542edf(0xe8)),users=require('../public/language/languages.json'),mongoose=require(a0_0x542edf(0x1aa));function a0_0x53b0(_0x533333,_0x491880){var _0x2b682f=a0_0x2b68();return a0_0x53b0=function(_0x53b0a2,_0x515a3c){_0x53b0a2=_0x53b0a2-0x6d;var _0x26dd58=_0x2b682f[_0x53b0a2];return _0x26dd58;},a0_0x53b0(_0x533333,_0x491880);}function a0_0x2b68(){var _0x44a202=['then','return_qty_QA','sort','$sale_product.bin','$product_details.invoice','Ambient','barcode\x20user_id','<!DOCTYPE\x20html>','Types','\x20Name:\x20','$product_details.bin','warehouse_id_detl','$finalize','payment\x20successfull','sendMail','invoice','$product_details.floorlevel','/view/add_sales_logs','$customer','createTransport','forEach','/barcode_scanner_auto_data','abs','$product_details.product_code','maxperunit','$product_details.bay','320201YxTbgS','<h2>\x20','redirect','staff','Logo.png','/view/add_sales','expiry_date_QA','maxStocks','customer_data','user','/view_log','$product_details.primary_code','\x20Order\x20Number\x20:\x20','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20','due_amount','nodemailer','$product_details.product_cat','purchases_data','for_categorize','customer','$warehouse_name','post','aggregate','maxProdPerUnit','sale_qty','product_details','expiry_date','getMonth','updateOne','$product_details.storage','<h5\x20style=\x22text-align:\x20left;\x22>','<h5>','currency_placement','$sale_product.quantity','int','room','<span\x20style=\x22float:\x20right;\x22>','$product_details.room_name','$product_details.product_stock','prod_invoice','received_amount','product_data','production_date_QA','getFullYear','return_sale_QA','body','amount','$return_data','/view/add_sales/:id','/upload/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','stocks_QA','gross_price','Return\x20Goods','concat','product_code','floor','product_code_QA','padStart','2055418wyQiTC','ObjectId','map','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','_id','$product_details.maxPerUnit','$date','site_title','second_unit','findById','sales','$product.product_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','currency','Enclosed','/give_payment/:id','log','valueOf','group_ids','$sale_product','</body></html>','outgoing_invoice','product_name','<tr>','$alertquantity','</td>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','maxPerUnit_QA','push','Hindi','Sales\x20Update\x20successfully','<div>','own','</head><body>','Finished\x20Goods','all_sales_barcode','warehouse_name','English\x20(US)','Quality\x20Inspection','$maxStocks','$primary_code','date','$product_details.batch_code','outgoiug_inv','date_data','findOne','unit_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details._id','</span>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/view','product_list','</tbody>','role','1376932etLlZS','production_date','toString','$invoice','secondary_code_QA','104PpSOTr','LOG-OUT-','invoice_init','match','/view/add_sale/product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','render','\x20units\x20to\x20warehouse:\x20','OUTF-','/../public','\x20Date:\x20','Portuguese\x20(BR)','858522oPTxGD','$room','<tbody\x20style=\x22text-align:\x20center;\x22>','/barcode_scanner_logs','final','bay','Enabled','room_name','maxProducts_QA','sales_quantity','date_recieved','$sale_product.type','params','logs','\x20<>\x20','$product_details.level','string','Sales\x20Add\x20successfully','$product_details.sales_category','Chinese','secondary_unit_QA','</h5>','out','sales_id','express','image','$product_details.secondary_code','primary_unit','name','id_transaction_from','Received\x20Payment\x20For\x20Sale','$maxProdPerUnit','warehouse','sales_category','quantity','return_qty','split','$product_details.date_recieved','24892542XGCISp','$product','email','Email\x20sent\x20successfully','date_received','return_data','edit_sales_finished','product_stock','\x20</h2>','product_cat','success','json','Sale\x20Return','all_sales_finished','Arabic','249217TpppuT','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$gross_price','$product_details.maxProducts','$product_details.type_products','/preview/:id','stock','slice','uuid','getDate','4402230jtBbXv','suppliers','prod_cat','back','Arabic\x20(ae)','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','$product_details.expiry_date','add_sales_finished_logs','French','$category','$brand','false','foreach\x20newproduct','/view/return_sales/:id','stock_data','mongoose','False','$product_details.uuid','secondary_code','$product_code','product_date','\x20==\x20','</div>','$product_details.secondary_unit','</thead>','add\x20post','$sale_product.floorlevel','logo','sales_quantity_QA','Router',',\x20room:\x20','status','gmail','$product_details','$secondary_unit','prod_code','English','$_id','true','warehouse_id','$sale_product.bay','$secondary_code','roomNamed','flash','/view/:id','/barcode/:id','$product_details.gross_price','True','/picking_list/pdf/','$product_details.rack','Spanish','$sales_category','data_type','message','maxProducts','length','barcode\x20Product\x20master','$product_details.type','RoomAssigned','carton','finalize','/all_sales_finished/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<html><head><title></title>','random','all','sales_invoice','$unit','sale_product','$product_details.production_date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Portuguese','$customers_docs','$note','find','add_sales_finished','$name','password','batch_code_QA','</tr>','standard_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','../middleware/auth','maxPerUnit','max_per_unit','product','$product_details.unit','all_sales_finished_logs','language','exports','primary_code','15ZWhlMW','errors','level2','save','product_id','sales\x20item\x20return\x20successfull','</table>','level','master','OUT-','$product_details.product_name','/all_sales_finished/view','batch_code','return_sale_finished','agent_id','Sale\x20Return\x20Mail','get','German','unit','Return\x20Rooms','secondary_unit','Error\x20Occurs','filter'];a0_0x2b68=function(){return _0x44a202;};return a0_0x2b68();}router['get'](a0_0x542edf(0x147),auth,async(_0x364d23,_0x45eb9c)=>{var _0x12954f=a0_0x542edf;try{const {username:_0x114f54,email:_0x268e9e,role:_0x522eca}=_0x364d23[_0x12954f(0xe2)],_0x148d0b=_0x364d23[_0x12954f(0xe2)],_0x325618=await profile[_0x12954f(0x141)]({'email':_0x148d0b[_0x12954f(0x184)]}),_0x22d901=await master_shop[_0x12954f(0x97)]();let _0x39cdac;if(_0x148d0b['role']==_0x12954f(0xdc)){const _0x5ecfbe=await staff['findOne']({'email':_0x148d0b[_0x12954f(0x184)]});_0x39cdac=await sales_finished['aggregate']([{'$match':{'typeOfProducts':_0x12954f(0x134)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x12954f(0x72),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x12954f(0xd1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x12954f(0xed)},'sale_product':{'$push':_0x12954f(0x127)},'note':{'$first':_0x12954f(0x96)},'return_data':{'$first':_0x12954f(0x108)},'customers_docs':{'$first':_0x12954f(0x95)},'total_saleproduct_quantity':{'$sum':_0x12954f(0xfa)},'level':{'$addToSet':_0x12954f(0x75)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x12954f(0x167)},'pallet':{'$addToSet':_0x12954f(0x1b5)},'finalize':{'$first':_0x12954f(0xcb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x39cdac=await sales_finished[_0x12954f(0xef)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':_0x12954f(0x127)},{'$group':{'_id':_0x12954f(0x72),'invoice':{'$first':_0x12954f(0x14e)},'customers':{'$first':_0x12954f(0xd1)},'date':{'$first':_0x12954f(0x11a)},'warehouse_name':{'$first':_0x12954f(0xed)},'sale_product':{'$push':_0x12954f(0x127)},'note':{'$first':_0x12954f(0x96)},'return_data':{'$first':_0x12954f(0x108)},'customers_docs':{'$first':_0x12954f(0x95)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x12954f(0x75)},'isle':{'$addToSet':_0x12954f(0xc2)},'type':{'$addToSet':_0x12954f(0x167)},'pallet':{'$addToSet':_0x12954f(0x1b5)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x22d901[0x0][_0x12954f(0xa5)]==_0x12954f(0x139)){var _0xfae5fb=users[_0x12954f(0x71)];console['log'](_0xfae5fb);}else{if(_0x22d901[0x0][_0x12954f(0xa5)]=='Hindi')var _0xfae5fb=users['Hindi'];else{if(_0x22d901[0x0][_0x12954f(0xa5)]==_0x12954f(0xb9))var _0xfae5fb=users[_0x12954f(0xb9)];else{if(_0x22d901[0x0][_0x12954f(0xa5)]=='Spanish')var _0xfae5fb=users[_0x12954f(0x7f)];else{if(_0x22d901[0x0][_0x12954f(0xa5)]==_0x12954f(0x1a3))var _0xfae5fb=users[_0x12954f(0x1a3)];else{if(_0x22d901[0x0][_0x12954f(0xa5)]=='Portuguese\x20(BR)')var _0xfae5fb=users[_0x12954f(0x94)];else{if(_0x22d901[0x0][_0x12954f(0xa5)]=='Chinese')var _0xfae5fb=users[_0x12954f(0x16f)];else{if(_0x22d901[0x0][_0x12954f(0xa5)]=='Arabic\x20(ae)')var _0xfae5fb=users[_0x12954f(0x190)];}}}}}}}_0x45eb9c[_0x12954f(0x156)](_0x12954f(0x18f),{'success':_0x364d23['flash']('success'),'errors':_0x364d23['flash'](_0x12954f(0xa9)),'sales':_0x39cdac,'profile':_0x325618,'role':_0x148d0b,'master_shop':_0x22d901,'language':_0xfae5fb});}catch(_0x3c4f4b){console[_0x12954f(0x124)](_0x3c4f4b);}}),router[a0_0x542edf(0xb8)](a0_0x542edf(0xe3),auth,async(_0x32123c,_0x201699)=>{var _0x3f4a95=a0_0x542edf;try{const {username:_0x599c95,email:_0x33bc0d,role:_0x3df535}=_0x32123c['user'],_0x5c9baa=_0x32123c[_0x3f4a95(0xe2)],_0x537d19=await profile[_0x3f4a95(0x141)]({'email':_0x5c9baa[_0x3f4a95(0x184)]}),_0x490bc8=await master_shop[_0x3f4a95(0x97)]();let _0x2bd5d6;if(_0x5c9baa[_0x3f4a95(0x14a)]==_0x3f4a95(0xdc)){const _0x3f4d66=await staff[_0x3f4a95(0x141)]({'email':_0x5c9baa['email']});_0x2bd5d6=await sales_finished['aggregate']([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x3f4a95(0x127)},{'$group':{'_id':_0x3f4a95(0x72),'invoice':{'$first':_0x3f4a95(0x14e)},'customers':{'$first':_0x3f4a95(0xd1)},'date':{'$first':_0x3f4a95(0x11a)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3f4a95(0x127)},'note':{'$first':'$note'},'return_data':{'$first':_0x3f4a95(0x108)},'customers_docs':{'$first':_0x3f4a95(0x95)},'total_saleproduct_quantity':{'$sum':_0x3f4a95(0xfa)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x3f4a95(0xc2)},'type':{'$addToSet':_0x3f4a95(0x167)},'pallet':{'$addToSet':_0x3f4a95(0x1b5)},'finalize':{'$first':_0x3f4a95(0xcb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2bd5d6=await sales_finished[_0x3f4a95(0xef)]([{'$match':{'typeOfProducts':_0x3f4a95(0x169)}},{'$unwind':_0x3f4a95(0x127)},{'$group':{'_id':_0x3f4a95(0x72),'invoice':{'$first':_0x3f4a95(0x14e)},'customers':{'$first':_0x3f4a95(0xd1)},'date':{'$first':_0x3f4a95(0x11a)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x3f4a95(0x108)},'customers_docs':{'$first':_0x3f4a95(0x95)},'total_saleproduct_quantity':{'$sum':_0x3f4a95(0xfa)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x3f4a95(0xc2)},'type':{'$addToSet':_0x3f4a95(0x167)},'pallet':{'$addToSet':_0x3f4a95(0x1b5)},'finalize':{'$first':_0x3f4a95(0xcb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x490bc8[0x0]['language']=='English\x20(US)'){var _0xcde67b=users[_0x3f4a95(0x71)];console[_0x3f4a95(0x124)](_0xcde67b);}else{if(_0x490bc8[0x0][_0x3f4a95(0xa5)]=='Hindi')var _0xcde67b=users[_0x3f4a95(0x131)];else{if(_0x490bc8[0x0][_0x3f4a95(0xa5)]=='German')var _0xcde67b=users[_0x3f4a95(0xb9)];else{if(_0x490bc8[0x0][_0x3f4a95(0xa5)]==_0x3f4a95(0x7f))var _0xcde67b=users[_0x3f4a95(0x7f)];else{if(_0x490bc8[0x0][_0x3f4a95(0xa5)]==_0x3f4a95(0x1a3))var _0xcde67b=users[_0x3f4a95(0x1a3)];else{if(_0x490bc8[0x0][_0x3f4a95(0xa5)]==_0x3f4a95(0x15b))var _0xcde67b=users[_0x3f4a95(0x94)];else{if(_0x490bc8[0x0]['language']=='Chinese')var _0xcde67b=users[_0x3f4a95(0x16f)];else{if(_0x490bc8[0x0]['language']==_0x3f4a95(0x19f))var _0xcde67b=users[_0x3f4a95(0x190)];}}}}}}}_0x201699[_0x3f4a95(0x156)](_0x3f4a95(0xa4),{'success':_0x32123c[_0x3f4a95(0x78)](_0x3f4a95(0x18c)),'errors':_0x32123c[_0x3f4a95(0x78)](_0x3f4a95(0xa9)),'sales':_0x2bd5d6,'profile':_0x537d19,'role':_0x5c9baa,'master_shop':_0x490bc8,'language':_0xcde67b});}catch(_0x36bde9){console[_0x3f4a95(0x124)](_0x36bde9);}});async function getRandom8DigitNumber(){var _0x4ea950=a0_0x542edf;const _0x454e20=0x989680,_0x47668b=0x5f5e0ff,_0x33bbcc=Math[_0x4ea950(0x111)](Math[_0x4ea950(0x8d)]()*(_0x47668b-_0x454e20+0x1))+_0x454e20;var _0x289d6c;const _0x13067b=await sales_finished[_0x4ea950(0x141)]({'invoice':_0x4ea950(0x158)+_0x33bbcc});return _0x13067b&&_0x13067b['length']>0x0?_0x289d6c='OUTF-'+_0x33bbcc:_0x289d6c=_0x4ea950(0x158)+_0x33bbcc,_0x289d6c;}router[a0_0x542edf(0xb8)]('/view/add_sales',auth,async(_0x1e3d51,_0x3f12b6)=>{var _0x17604c=a0_0x542edf;try{const {username:_0x3490de,email:_0x494123,role:_0x429950}=_0x1e3d51[_0x17604c(0xe2)],_0x4cd233=_0x1e3d51[_0x17604c(0xe2)],_0x4ff51c=await profile['findOne']({'email':_0x4cd233[_0x17604c(0x184)]}),_0x2bd7ce=await master_shop[_0x17604c(0x97)](),_0x2205dd=await customer[_0x17604c(0x97)]({});let _0x15f863;if(_0x4cd233[_0x17604c(0x14a)]=='staff'){const _0x53a555=await staff[_0x17604c(0x141)]({'email':_0x4cd233[_0x17604c(0x184)]});_0x15f863=await warehouse[_0x17604c(0xef)]([{'$match':{'status':'Enabled','name':_0x53a555[_0x17604c(0x17c)]}},{'$group':{'_id':_0x17604c(0x99),'name':{'$first':_0x17604c(0x99)}}},{'$sort':{'name':0x1}}]);}else _0x15f863=await warehouse['aggregate']([{'$match':{'status':_0x17604c(0x162)}},{'$group':{'_id':_0x17604c(0x99),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x2c19a8=await product[_0x17604c(0x97)]({});var _0x41955b=['Ambient',_0x17604c(0x122)];const _0x40a867=await sales_finished[_0x17604c(0x97)]({}),_0xb7fcb1=_0x40a867['length']+0x1,_0x283103='OUTF-'+_0xb7fcb1['toString']()[_0x17604c(0x113)](0x5,'0');if(_0x2bd7ce[0x0]['language']=='English\x20(US)'){var _0x43bb67=users[_0x17604c(0x71)];console['log'](_0x43bb67);}else{if(_0x2bd7ce[0x0][_0x17604c(0xa5)]==_0x17604c(0x131))var _0x43bb67=users[_0x17604c(0x131)];else{if(_0x2bd7ce[0x0][_0x17604c(0xa5)]==_0x17604c(0xb9))var _0x43bb67=users[_0x17604c(0xb9)];else{if(_0x2bd7ce[0x0][_0x17604c(0xa5)]=='Spanish')var _0x43bb67=users['Spanish'];else{if(_0x2bd7ce[0x0][_0x17604c(0xa5)]==_0x17604c(0x1a3))var _0x43bb67=users[_0x17604c(0x1a3)];else{if(_0x2bd7ce[0x0][_0x17604c(0xa5)]=='Portuguese\x20(BR)')var _0x43bb67=users[_0x17604c(0x94)];else{if(_0x2bd7ce[0x0][_0x17604c(0xa5)]=='Chinese')var _0x43bb67=users[_0x17604c(0x16f)];else{if(_0x2bd7ce[0x0]['language']==_0x17604c(0x19f))var _0x43bb67=users[_0x17604c(0x190)];}}}}}}}const _0x589ccc=getRandom8DigitNumber();_0x589ccc[_0x17604c(0xbf)](_0x428708=>{var _0x3d5880=_0x17604c;_0x3f12b6[_0x3d5880(0x156)](_0x3d5880(0x98),{'success':_0x1e3d51[_0x3d5880(0x78)](_0x3d5880(0x18c)),'errors':_0x1e3d51[_0x3d5880(0x78)](_0x3d5880(0xa9)),'role':_0x4cd233,'profile':_0x4ff51c,'customer':_0x2205dd,'warehouse':_0x15f863,'product':_0x2c19a8,'invoice':_0x428708,'master_shop':_0x2bd7ce,'language':_0x43bb67,'rooms_data':_0x41955b});})['catch'](_0xcd990=>{var _0x23551e=_0x17604c;_0x1e3d51[_0x23551e(0x78)](_0x23551e(0xa9),_0x23551e(0x93)),_0x3f12b6['redirect']('/all_sales_finished/view');});}catch(_0xbcab00){console[_0x17604c(0x124)](_0xbcab00);}}),router['get'](a0_0x542edf(0xd0),auth,async(_0x2375f2,_0x4363db)=>{var _0x3d5f40=a0_0x542edf;try{const {username:_0x2c0622,email:_0x179f95,role:_0x2c27e3}=_0x2375f2['user'],_0x38ff95=_0x2375f2[_0x3d5f40(0xe2)],_0x55883d=await profile[_0x3d5f40(0x141)]({'email':_0x38ff95[_0x3d5f40(0x184)]}),_0x17148f=await master_shop[_0x3d5f40(0x97)](),_0x2253a2=await customer['find']({});let _0x370a7d;if(_0x38ff95[_0x3d5f40(0x14a)]==_0x3d5f40(0xdc)){const _0x224457=await staff[_0x3d5f40(0x141)]({'email':_0x38ff95[_0x3d5f40(0x184)]});_0x370a7d=await warehouse[_0x3d5f40(0xef)]([{'$match':{'status':_0x3d5f40(0x162),'name':_0x224457[_0x3d5f40(0x17c)]}},{'$group':{'_id':'$name','name':{'$first':_0x3d5f40(0x99)}}},{'$sort':{'name':0x1}}]);}else _0x370a7d=await warehouse['aggregate']([{'$match':{'status':_0x3d5f40(0x162)}},{'$group':{'_id':_0x3d5f40(0x99),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x3c9897=await product[_0x3d5f40(0x97)]({});var _0x5bd6a1=[_0x3d5f40(0xc4),_0x3d5f40(0x122)];const _0xeec802=await sales_finished[_0x3d5f40(0x97)]({}),_0x491b53=_0xeec802[_0x3d5f40(0x84)]+0x1,_0x5dc93b='OUTF-'+_0x491b53['toString']()['padStart'](0x5,'0');if(_0x17148f[0x0][_0x3d5f40(0xa5)]=='English\x20(US)'){var _0xb293fd=users['English'];console[_0x3d5f40(0x124)](_0xb293fd);}else{if(_0x17148f[0x0]['language']==_0x3d5f40(0x131))var _0xb293fd=users['Hindi'];else{if(_0x17148f[0x0]['language']==_0x3d5f40(0xb9))var _0xb293fd=users[_0x3d5f40(0xb9)];else{if(_0x17148f[0x0]['language']==_0x3d5f40(0x7f))var _0xb293fd=users['Spanish'];else{if(_0x17148f[0x0][_0x3d5f40(0xa5)]==_0x3d5f40(0x1a3))var _0xb293fd=users[_0x3d5f40(0x1a3)];else{if(_0x17148f[0x0][_0x3d5f40(0xa5)]==_0x3d5f40(0x15b))var _0xb293fd=users[_0x3d5f40(0x94)];else{if(_0x17148f[0x0][_0x3d5f40(0xa5)]=='Chinese')var _0xb293fd=users[_0x3d5f40(0x16f)];else{if(_0x17148f[0x0]['language']==_0x3d5f40(0x19f))var _0xb293fd=users['Arabic'];}}}}}}}const _0x2f782d=getRandom8DigitNumber();_0x2f782d[_0x3d5f40(0xbf)](_0x28ec87=>{var _0x20b673=_0x3d5f40;_0x4363db[_0x20b673(0x156)](_0x20b673(0x1a2),{'success':_0x2375f2[_0x20b673(0x78)](_0x20b673(0x18c)),'errors':_0x2375f2[_0x20b673(0x78)]('errors'),'role':_0x38ff95,'profile':_0x55883d,'customer':_0x2253a2,'warehouse':_0x370a7d,'product':_0x3c9897,'invoice':_0x28ec87,'master_shop':_0x17148f,'language':_0xb293fd,'rooms_data':_0x5bd6a1});})['catch'](_0x2958ff=>{var _0x5db8e7=_0x3d5f40;_0x2375f2[_0x5db8e7(0x78)]('errors',_0x5db8e7(0x93)),_0x4363db[_0x5db8e7(0xdb)]('/all_sales_finished/view');});}catch(_0x18b503){console[_0x3d5f40(0x124)](_0x18b503);}}),router[a0_0x542edf(0xee)](a0_0x542edf(0xd0),auth,async(_0x10448d,_0x43d314)=>{var _0x332ced=a0_0x542edf;try{const {invoice:_0x11ef8c,date:_0x3fbe10,warehouse_name:_0x1b0e3c,product_name:_0x29c9d4,note:_0x5c8b13,room:_0x3f6b12,primary_code:_0x4f7a20,secondary_code:_0x548e17,prod_code:_0x57ba85,SCRN:_0x42b882,ReqBy:_0x488039,dateofreq:_0x4639a6,PO_number:_0x2eb104,typeservicesData:_0x1e0cfe,typevehicle:_0x12ec46,destination:_0x4aea01,deliverydate:_0x23a6f0,driver:_0xee5df4,plate:_0x5eb179,van:_0x112689,DRSI:_0x393e3c,TSU:_0xe6ca51,TFU:_0x48f2eb,mode_transpo:_0x32d090,name_driver:_0x3e107d,type_of_products:_0x4984c8}=_0x10448d[_0x332ced(0x106)];if(typeof _0x29c9d4==_0x332ced(0x16c))var _0xd5e46a=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x12a)]],_0x49e7d5=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x197)]],_0x2faba0=[_0x10448d[_0x332ced(0x106)]['carton']],_0x4f4bbd=[_0x10448d[_0x332ced(0x106)][_0x332ced(0xa7)]],_0x3592dc=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x1ad)]],_0x54e82f=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x70)]],_0x2ab1c9=[_0x10448d[_0x332ced(0x106)][_0x332ced(0xaa)]],_0x4b8d9e=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x177)]],_0x490d4b=[_0x10448d[_0x332ced(0x106)][_0x332ced(0xbc)]],_0x458e41=[_0x10448d['body']['batch_code']],_0x474595=[_0x10448d[_0x332ced(0x106)][_0x332ced(0xf3)]],_0x20a96b=[_0x10448d[_0x332ced(0x106)]['product_date']],_0x197d86=[_0x10448d[_0x332ced(0x106)][_0x332ced(0xa1)]],_0x5b4e16=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x19d)]],_0x2a2c3d=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x87)]],_0x342fc7=[_0x10448d['body'][_0x332ced(0x100)]],_0x77d95c=[_0x10448d[_0x332ced(0x106)]['id_transaction_from']],_0x3378ac=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x199)]],_0x38c1cb=[_0x10448d[_0x332ced(0x106)][_0x332ced(0x10d)]];else var _0xd5e46a=[..._0x10448d[_0x332ced(0x106)]['product_name']],_0x49e7d5=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x197)]],_0x2faba0=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x88)]],_0x4f4bbd=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0xa7)]],_0x3592dc=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x1ad)]],_0x54e82f=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x70)]],_0x2ab1c9=[..._0x10448d[_0x332ced(0x106)]['level2']],_0x4b8d9e=[..._0x10448d[_0x332ced(0x106)]['primary_unit']],_0x490d4b=[..._0x10448d['body'][_0x332ced(0xbc)]],_0x458e41=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0xb4)]],_0x474595=[..._0x10448d[_0x332ced(0x106)]['expiry_date']],_0x20a96b=[..._0x10448d['body'][_0x332ced(0x1af)]],_0x197d86=[..._0x10448d['body'][_0x332ced(0xa1)]],_0x5b4e16=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x19d)]],_0x2a2c3d=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x87)]],_0x342fc7=[..._0x10448d['body'][_0x332ced(0x100)]],_0x77d95c=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x179)]],_0x3378ac=[..._0x10448d[_0x332ced(0x106)]['uuid']],_0x38c1cb=[..._0x10448d[_0x332ced(0x106)][_0x332ced(0x10d)]];const _0x389219=_0xd5e46a[_0x332ced(0x116)](_0x5e37cf=>{return _0x5e37cf={'product_name':_0x5e37cf};});_0x49e7d5[_0x332ced(0xd3)]((_0x50be5f,_0x11a22d)=>{var _0x15f9a7=_0x332ced;_0x389219[_0x11a22d][_0x15f9a7(0x197)]=_0x50be5f;}),_0x2faba0[_0x332ced(0xd3)]((_0xe82274,_0x31c3a1)=>{var _0x170b6e=_0x332ced;_0x389219[_0x31c3a1][_0x170b6e(0x17e)]=Math[_0x170b6e(0xd5)](_0xe82274);}),_0xd5e46a[_0x332ced(0xd3)]((_0x326080,_0x2e7943)=>{var _0x5d4eab=_0x332ced;_0x389219[_0x2e7943][_0x5d4eab(0xb6)]=_0x10448d[_0x5d4eab(0x106)][_0x5d4eab(0x11e)];}),_0x38c1cb[_0x332ced(0xd3)]((_0x2ad019,_0x45ba7c)=>{var _0x3b5127=_0x332ced;_0x389219[_0x45ba7c][_0x3b5127(0x10d)]=_0x2ad019;}),_0x3378ac['forEach']((_0x1020ce,_0x41e05a)=>{var _0xd0512b=_0x332ced;_0x389219[_0x41e05a][_0xd0512b(0x199)]=_0x1020ce;}),_0x77d95c[_0x332ced(0xd3)]((_0x53f0d0,_0x30cdbc)=>{_0x389219[_0x30cdbc]['id_transaction_from']=_0x53f0d0;}),_0x4f4bbd['forEach']((_0x8e996f,_0x4f2a7e)=>{var _0x32b300=_0x332ced;_0x389219[_0x4f2a7e][_0x32b300(0xa7)]=_0x8e996f;}),_0x3592dc[_0x332ced(0xd3)]((_0x154e18,_0x12ca51)=>{var _0x2c09c8=_0x332ced;_0x389219[_0x12ca51][_0x2c09c8(0x1ad)]=_0x154e18;}),_0x54e82f[_0x332ced(0xd3)]((_0x1bfa06,_0x38241a)=>{var _0x563f9f=_0x332ced;_0x389219[_0x38241a][_0x563f9f(0x110)]=_0x1bfa06;}),_0x2ab1c9[_0x332ced(0xd3)]((_0xa1a2d0,_0xd486d6)=>{var _0x51865c=_0x332ced,_0x281562=_0xa1a2d0[_0x51865c(0x153)](/[A-Za-z]+/)[0x0],_0x1543ab=parseInt(_0xa1a2d0[_0x51865c(0x153)](/\d+/)[0x0]);_0x389219[_0xd486d6][_0x51865c(0x161)]=_0x1543ab,_0x389219[_0xd486d6][_0x51865c(0xaf)]=_0x281562;}),_0x4b8d9e[_0x332ced(0xd3)]((_0x25a136,_0x3a8f64)=>{_0x389219[_0x3a8f64]['unit']=_0x25a136;}),_0x490d4b[_0x332ced(0xd3)]((_0x43d3a6,_0x48060b)=>{var _0x253821=_0x332ced;_0x389219[_0x48060b][_0x253821(0xbc)]=_0x43d3a6;}),_0x458e41[_0x332ced(0xd3)]((_0x4a6795,_0x4565b2)=>{var _0x2e0b39=_0x332ced;_0x389219[_0x4565b2][_0x2e0b39(0xb4)]=_0x4a6795;}),_0x474595['forEach']((_0x1625a7,_0x38422f)=>{_0x389219[_0x38422f]['expiry_date']=_0x1625a7;}),_0x20a96b[_0x332ced(0xd3)]((_0x31261c,_0x45e06d)=>{var _0x355dac=_0x332ced;_0x389219[_0x45e06d][_0x355dac(0x14c)]=_0x31261c;}),_0x197d86[_0x332ced(0xd3)]((_0x561a52,_0xbf363f)=>{var _0x4fa622=_0x332ced;_0x389219[_0xbf363f][_0x4fa622(0xd7)]=_0x561a52;}),_0x5b4e16['forEach']((_0x28f825,_0x360faf)=>{_0x389219[_0x360faf]['prod_cat']=_0x28f825;}),_0x2a2c3d['forEach']((_0x2dc972,_0x369123)=>{var _0x56cede=_0x332ced;_0x389219[_0x369123][_0x56cede(0x163)]=_0x2dc972;}),_0x342fc7[_0x332ced(0xd3)]((_0x359813,_0x200d85)=>{var _0x3a061f=_0x332ced;_0x389219[_0x200d85][_0x3a061f(0xce)]=_0x359813,_0x389219[_0x200d85][_0x3a061f(0x140)]=_0x3fbe10;});const _0x4667f8=new sales_logs();await _0x4667f8[_0x332ced(0xab)](),_0x342fc7[_0x332ced(0xd3)]((_0x35ee0e,_0x258ff0)=>{var _0x4bd052=_0x332ced;_0x389219[_0x258ff0][_0x4bd052(0x129)]=_0x4bd052(0x151)+_0x4667f8[_0x4bd052(0x152)][_0x4bd052(0x14d)]()[_0x4bd052(0x113)](0x8,'0');});var _0x488a50=0x0;_0x389219[_0x332ced(0xd3)](_0x40f06f=>{var _0x3b72b1=_0x332ced;parseFloat(_0x40f06f[_0x3b72b1(0x197)])<parseFloat(_0x40f06f[_0x3b72b1(0x17e)])&&parseFloat(_0x40f06f[_0x3b72b1(0x17e)])>parseFloat(_0x40f06f[_0x3b72b1(0x197)])&&(console[_0x3b72b1(0x124)](_0x40f06f['stock']+_0x3b72b1(0x16a)+_0x40f06f[_0x3b72b1(0x17e)]),_0x488a50++);});if(_0x488a50!=0x0)return _0x10448d[_0x332ced(0x78)](_0x332ced(0xa9),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x43d314[_0x332ced(0xdb)](_0x332ced(0x19e));const _0x414806=_0x389219[_0x332ced(0xbe)](_0x296b3e=>_0x296b3e['quantity']!=='0'&&_0x296b3e[_0x332ced(0x17e)]!==''),_0x3976e7=new sales_finished({'invoice':_0x332ced(0x151)+_0x4667f8[_0x332ced(0x152)][_0x332ced(0x14d)]()[_0x332ced(0x113)](0x8,'0'),'sales_data':_0x10448d['body']['sales'],'customer':_0x10448d['body'][_0x332ced(0xec)],'date':_0x3fbe10,'warehouse_name':_0x1b0e3c,'sale_product':_0x414806,'note':_0x5c8b13,'room':_0x3f6b12,'primary_code':_0x4f7a20,'secondary_code':_0x548e17,'prod_code':_0x57ba85,'SCRN':_0x42b882,'finalize':_0x332ced(0x1ab),'mode_transpo':_0x32d090,'name_driver':_0x3e107d,'ReqBy':_0x488039,'dateofreq':_0x4639a6,'PO_number':_0x2eb104,'typeservicesData':_0x1e0cfe,'typevehicle':_0x12ec46,'destination':_0x4aea01,'deliverydate':_0x23a6f0,'driver':_0xee5df4,'plate':_0x5eb179,'van':_0x112689,'DRSI':_0x393e3c,'TSU':_0xe6ca51,'TFU':_0x48f2eb,'typeOfProducts':_0x4984c8}),_0x368abd=await _0x3976e7[_0x332ced(0xab)](),_0xd59b6f=await sales_finished[_0x332ced(0x141)]({'invoice':_0x11ef8c});_0x10448d[_0x332ced(0x78)](_0x332ced(0x18c),_0x332ced(0x16d)),_0x43d314[_0x332ced(0xdb)](_0x332ced(0x8a)+_0x368abd['_id']);}catch(_0x3b6ce4){console['log'](_0x3b6ce4);}}),router[a0_0x542edf(0xb8)](a0_0x542edf(0x109),auth,async(_0x1860eb,_0x531e33)=>{var _0x1c20f9=a0_0x542edf;try{const _0x54fc09=_0x1860eb['params']['id'];console[_0x1c20f9(0x124)](_0x54fc09);const _0x20a96e=await product[_0x1c20f9(0x97)](),_0x2e84bd=await purchases[_0x1c20f9(0xef)]([{'$match':{'warehouse_name':_0x54fc09}},{'$unwind':_0x1c20f9(0x183)},{'$group':{'_id':_0x1c20f9(0x11f)}}]);console[_0x1c20f9(0x124)](_0x1c20f9(0xea),_0x2e84bd),_0x531e33['status'](0xc8)[_0x1c20f9(0x18d)]({'purchases_data':_0x2e84bd,'product_data':_0x20a96e});}catch(_0x4d6faf){console[_0x1c20f9(0x124)](_0x4d6faf);}}),router[a0_0x542edf(0xee)](a0_0x542edf(0x154),auth,async(_0x4869dd,_0x8d159f)=>{var _0x18fed7=a0_0x542edf;try{const {warehouse_data:_0x4e8d39,product_data:_0x249545}=_0x4869dd[_0x18fed7(0x106)];console[_0x18fed7(0x124)](_0x4869dd[_0x18fed7(0x106)][_0x18fed7(0x102)]);;const _0x262b41=await master_shop[_0x18fed7(0x97)]();console[_0x18fed7(0x124)]('master',_0x262b41);const _0x5f570b=await product['findOne']({'name':_0x249545});console[_0x18fed7(0x124)](_0x18fed7(0xa2),_0x5f570b);const _0x3ec0d8=await warehouse[_0x18fed7(0xef)]([{'$match':{'name':_0x4e8d39}},{'$unwind':_0x18fed7(0x6e)},{'$match':{'product_details.product_name':_0x249545}},{'$group':{'_id':_0x18fed7(0xb2),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x18fed7(0x124)](_0x18fed7(0x1a9),_0x3ec0d8),_0x8d159f[_0x18fed7(0x1ba)](0xc8)[_0x18fed7(0x18d)]({'master':_0x262b41,'new_product':_0x5f570b,'stock_data':_0x3ec0d8});}catch(_0xcde03f){console[_0x18fed7(0x124)](_0xcde03f);}}),router[a0_0x542edf(0xee)](a0_0x542edf(0xde),auth,async(_0x3a4f37,_0x3746f3)=>{var _0x5a53de=a0_0x542edf;try{const {invoice:_0x1a4063,date:_0x136d34,warehouse_name:_0x1cbadb,product_name:_0x46477a,note:_0x3d4097,room:_0x2524da,primary_code:_0xba1748,secondary_code:_0x21bf4a,prod_code:_0x9bbec9,SCRN:_0x4a8aab,ReqBy:_0x22affa,dateofreq:_0x9d9844,PO_number:_0x5147ff,typeservicesData:_0x44c58a,typevehicle:_0x1ec5d4,destination:_0x498d30,deliverydate:_0x259f56,driver:_0x26fa4a,plate:_0x5d2f27,van:_0x2414b4,DRSI:_0x21a51e,TSU:_0x1505c3,TFU:_0x2ecb01,mode_transpo:_0x4fa5c8,name_driver:_0x2d90e8,pull_out_date:_0x34b4d8,actual_delivery_date:_0x1bfa7f}=_0x3a4f37[_0x5a53de(0x106)];_0x3746f3[_0x5a53de(0x18d)](_0x3a4f37[_0x5a53de(0x106)]);return;if(typeof _0x46477a=='string')var _0x43bd4a=[_0x3a4f37['body']['product_name']],_0x126ef5=[_0x3a4f37['body'][_0x5a53de(0x197)]],_0x2a38bc=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x88)]],_0x376bce=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xa7)]],_0x1647d5=[_0x3a4f37['body'][_0x5a53de(0x1ad)]],_0x2668bf=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x70)]],_0x223492=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xaa)]],_0x27b052=[_0x3a4f37['body'][_0x5a53de(0x177)]],_0x5e274e=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xbc)]],_0x247e50=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xb4)]],_0x535000=[_0x3a4f37[_0x5a53de(0x106)]['expiry_date']],_0x2c3c99=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x1af)]],_0x45f4a6=[_0x3a4f37['body']['max_per_unit']],_0x1d3a7a=[_0x3a4f37[_0x5a53de(0x106)]['prod_cat']],_0x57a672=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x87)]],_0x51b0aa=[_0x3a4f37[_0x5a53de(0x106)]['prod_invoice']],_0xdb2885=[_0x3a4f37[_0x5a53de(0x106)]['id_transaction_from']],_0x129f22=[_0x3a4f37['body'][_0x5a53de(0x199)]],_0x504538=[_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x10d)]];else var _0x43bd4a=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x12a)]],_0x126ef5=[..._0x3a4f37[_0x5a53de(0x106)]['stock']],_0x2a38bc=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x88)]],_0x376bce=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xa7)]],_0x1647d5=[..._0x3a4f37[_0x5a53de(0x106)]['secondary_code']],_0x2668bf=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x70)]],_0x223492=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xaa)]],_0x27b052=[..._0x3a4f37['body'][_0x5a53de(0x177)]],_0x5e274e=[..._0x3a4f37[_0x5a53de(0x106)]['secondary_unit']],_0x247e50=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xb4)]],_0x535000=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xf3)]],_0x2c3c99=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x1af)]],_0x45f4a6=[..._0x3a4f37[_0x5a53de(0x106)]['max_per_unit']],_0x1d3a7a=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x19d)]],_0x57a672=[..._0x3a4f37[_0x5a53de(0x106)]['RoomAssigned']],_0x51b0aa=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x100)]],_0xdb2885=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x179)]],_0x129f22=[..._0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0x199)]],_0x504538=[..._0x3a4f37[_0x5a53de(0x106)]['gross_price']];const _0x3a0033=_0x43bd4a[_0x5a53de(0x116)](_0x1ba7ac=>{return _0x1ba7ac={'product_name':_0x1ba7ac};});_0x126ef5['forEach']((_0x50553e,_0x47aaf0)=>{var _0x479c8c=_0x5a53de;_0x3a0033[_0x47aaf0][_0x479c8c(0x197)]=_0x50553e;}),_0x2a38bc['forEach']((_0x4ab54c,_0xc6f148)=>{var _0x30fe5c=_0x5a53de;_0x3a0033[_0xc6f148][_0x30fe5c(0x17e)]=Math['abs'](_0x4ab54c);}),_0x43bd4a[_0x5a53de(0xd3)]((_0x355c87,_0x26cae3)=>{var _0x339003=_0x5a53de;_0x3a0033[_0x26cae3]['agent_id']=_0x3a4f37[_0x339003(0x106)][_0x339003(0x11e)];}),_0x504538[_0x5a53de(0xd3)]((_0x4b48e0,_0x301227)=>{_0x3a0033[_0x301227]['gross_price']=_0x4b48e0;}),_0x129f22[_0x5a53de(0xd3)]((_0x50b2fe,_0x1aff12)=>{var _0x5d821b=_0x5a53de;_0x3a0033[_0x1aff12][_0x5d821b(0x199)]=_0x50b2fe;}),_0xdb2885[_0x5a53de(0xd3)]((_0x18e7d1,_0xca76e1)=>{var _0x1a4f5a=_0x5a53de;_0x3a0033[_0xca76e1][_0x1a4f5a(0x179)]=_0x18e7d1;}),_0x376bce[_0x5a53de(0xd3)]((_0x5015b2,_0xb63495)=>{var _0xb85e3d=_0x5a53de;_0x3a0033[_0xb63495][_0xb85e3d(0xa7)]=_0x5015b2;}),_0x1647d5[_0x5a53de(0xd3)]((_0x5b36af,_0x18116f)=>{var _0x2a814e=_0x5a53de;_0x3a0033[_0x18116f][_0x2a814e(0x1ad)]=_0x5b36af;}),_0x2668bf[_0x5a53de(0xd3)]((_0x22bcc9,_0x1f4418)=>{var _0x1d6b2d=_0x5a53de;_0x3a0033[_0x1f4418][_0x1d6b2d(0x110)]=_0x22bcc9;}),_0x223492[_0x5a53de(0xd3)]((_0x206343,_0x828ec2)=>{var _0x138e96=_0x5a53de,_0x1a22a5=_0x206343[_0x138e96(0x153)](/[A-Za-z]+/)[0x0],_0x33dfe9=parseInt(_0x206343[_0x138e96(0x153)](/\d+/)[0x0]);_0x3a0033[_0x828ec2][_0x138e96(0x161)]=_0x33dfe9,_0x3a0033[_0x828ec2][_0x138e96(0xaf)]=_0x1a22a5;}),_0x27b052[_0x5a53de(0xd3)]((_0x4a3781,_0x321508)=>{var _0x13c076=_0x5a53de;_0x3a0033[_0x321508][_0x13c076(0xba)]=_0x4a3781;}),_0x5e274e['forEach']((_0x50cb5e,_0x2d7afd)=>{var _0xc41f8e=_0x5a53de;_0x3a0033[_0x2d7afd][_0xc41f8e(0xbc)]=_0x50cb5e;}),_0x247e50[_0x5a53de(0xd3)]((_0x168291,_0x40069e)=>{_0x3a0033[_0x40069e]['batch_code']=_0x168291;}),_0x535000[_0x5a53de(0xd3)]((_0x45d2c1,_0x54e1dd)=>{_0x3a0033[_0x54e1dd]['expiry_date']=_0x45d2c1;}),_0x2c3c99[_0x5a53de(0xd3)]((_0x3b5c77,_0x308267)=>{var _0x4a563f=_0x5a53de;_0x3a0033[_0x308267][_0x4a563f(0x14c)]=_0x3b5c77;}),_0x45f4a6[_0x5a53de(0xd3)]((_0x5082e9,_0x955c97)=>{var _0x3d4798=_0x5a53de;_0x3a0033[_0x955c97][_0x3d4798(0xd7)]=_0x5082e9;}),_0x1d3a7a[_0x5a53de(0xd3)]((_0x17c8b2,_0x3877db)=>{var _0x54e040=_0x5a53de;_0x3a0033[_0x3877db][_0x54e040(0x19d)]=_0x17c8b2;}),_0x57a672[_0x5a53de(0xd3)]((_0x3667d5,_0x314fbb)=>{var _0x4cccd1=_0x5a53de;_0x3a0033[_0x314fbb][_0x4cccd1(0x163)]=_0x3667d5;}),_0x51b0aa[_0x5a53de(0xd3)]((_0x4d3c9f,_0x4036c9)=>{var _0x35928c=_0x5a53de;_0x3a0033[_0x4036c9][_0x35928c(0xce)]=_0x4d3c9f,_0x3a0033[_0x4036c9]['date_data']=_0x136d34;});const _0xddbb8c=new invoice_for_outgoing();await _0xddbb8c[_0x5a53de(0xab)](),_0x51b0aa['forEach']((_0x1cd8b7,_0x5ae142)=>{var _0xb7713e=_0x5a53de;_0x3a0033[_0x5ae142][_0xb7713e(0x129)]=_0xb7713e(0xb1)+_0xddbb8c[_0xb7713e(0x152)][_0xb7713e(0x14d)]()[_0xb7713e(0x113)](0x8,'0');});var _0x57f1c3=0x0;_0x3a0033[_0x5a53de(0xd3)](_0x485090=>{var _0x4d276e=_0x5a53de;parseFloat(_0x485090[_0x4d276e(0x197)])<parseFloat(_0x485090[_0x4d276e(0x17e)])&&parseFloat(_0x485090[_0x4d276e(0x17e)])>parseFloat(_0x485090[_0x4d276e(0x197)])&&(console[_0x4d276e(0x124)](_0x485090[_0x4d276e(0x197)]+_0x4d276e(0x16a)+_0x485090[_0x4d276e(0x17e)]),_0x57f1c3++);});if(_0x57f1c3!=0x0)return _0x3a4f37['flash'](_0x5a53de(0xa9),_0x5a53de(0x1a0)),_0x3746f3['redirect'](_0x5a53de(0x19e));const _0x27fb2e=_0x3a0033[_0x5a53de(0xbe)](_0x13d01c=>_0x13d01c[_0x5a53de(0x17e)]!=='0'&&_0x13d01c[_0x5a53de(0x17e)]!==''),_0x11ab50=new sales_finished({'invoice':_0x5a53de(0xb1)+_0xddbb8c[_0x5a53de(0x152)][_0x5a53de(0x14d)]()[_0x5a53de(0x113)](0x8,'0'),'sales_data':_0x3a4f37[_0x5a53de(0x106)]['sales'],'customer':_0x3a4f37[_0x5a53de(0x106)][_0x5a53de(0xec)],'date':_0x136d34,'warehouse_name':_0x1cbadb,'sale_product':_0x27fb2e,'note':_0x3d4097,'room':_0x2524da,'primary_code':_0xba1748,'secondary_code':_0x21bf4a,'prod_code':_0x9bbec9,'SCRN':_0x4a8aab,'finalize':'False','mode_transpo':_0x4fa5c8,'name_driver':_0x2d90e8,'ReqBy':_0x22affa,'dateofreq':_0x9d9844,'PO_number':_0x5147ff,'typeservicesData':_0x44c58a,'typevehicle':_0x1ec5d4,'destination':_0x498d30,'deliverydate':_0x259f56,'driver':_0x26fa4a,'plate':_0x5d2f27,'van':_0x2414b4,'DRSI':_0x21a51e,'TSU':_0x1505c3,'TFU':_0x2ecb01,'pullout_date':_0x34b4d8,'actualdelivery_date':_0x1bfa7f,'typeOfProducts':_0x5a53de(0x134)}),_0x44d194=await _0x11ab50[_0x5a53de(0xab)](),_0x4c145e=await sales_finished[_0x5a53de(0x141)]({'invoice':_0x1a4063});_0x3a4f37[_0x5a53de(0x78)](_0x5a53de(0x18c),_0x5a53de(0x16d)),_0x3746f3['redirect'](_0x5a53de(0x8a)+_0x44d194[_0x5a53de(0x118)]);}catch(_0x21f8cb){console[_0x5a53de(0x124)](_0x21f8cb);}}),router[a0_0x542edf(0xb8)](a0_0x542edf(0x196),auth,async(_0x1d5a06,_0x1c0962)=>{var _0x1608a7=a0_0x542edf;try{const {username:_0x35db73,email:_0x508f75,role:_0x4e74f0}=_0x1d5a06['user'],_0x53c009=_0x1d5a06[_0x1608a7(0xe2)],_0x7ea167=await profile[_0x1608a7(0x141)]({'email':_0x53c009[_0x1608a7(0x184)]}),_0x2e14d2=await master_shop[_0x1608a7(0x97)](),_0x3b17e5=_0x1d5a06['params']['id'],_0x46d997=await sales_finished['findById'](_0x3b17e5),_0x17e12e=await warehouse[_0x1608a7(0xef)]([{'$match':{'name':_0x46d997['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1608a7(0x144),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1608a7(0xff)},'bay':{'$first':_0x1608a7(0xd8)},'bin':{'$first':_0x1608a7(0xc9)},'type':{'$first':_0x1608a7(0x86)},'floorlevel':{'$first':_0x1608a7(0xcf)},'primary_code':{'$first':_0x1608a7(0xe4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1608a7(0xd6)},'storage':{'$first':_0x1608a7(0xf6)},'rack':{'$first':_0x1608a7(0x7e)},'expiry_date':{'$first':_0x1608a7(0x1a1)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1608a7(0x13e)},'room':{'$first':'$room'},'room_data':{'$first':_0x1608a7(0xfe)}}}]),_0x16bc86=await customer[_0x1608a7(0x97)]({});let _0x3a58bc;if(_0x53c009[_0x1608a7(0x14a)]==_0x1608a7(0xdc)){const _0x1f246a=await staff[_0x1608a7(0x141)]({'email':_0x53c009[_0x1608a7(0x184)]});_0x3a58bc=await warehouse[_0x1608a7(0xef)]([{'$match':{'status':_0x1608a7(0x162),'name':_0x1f246a[_0x1608a7(0x17c)]}},{'$group':{'_id':_0x1608a7(0x99),'name':{'$first':_0x1608a7(0x99)}}}]);}else _0x3a58bc=await warehouse[_0x1608a7(0xef)]([{'$match':{'status':_0x1608a7(0x162)}},{'$group':{'_id':_0x1608a7(0x99),'name':{'$first':'$name'}}}]);const _0x38e7dc=await product['find']({});if(_0x2e14d2[0x0][_0x1608a7(0xa5)]=='English\x20(US)'){var _0x523530=users['English'];console[_0x1608a7(0x124)](_0x523530);}else{if(_0x2e14d2[0x0]['language']==_0x1608a7(0x131))var _0x523530=users[_0x1608a7(0x131)];else{if(_0x2e14d2[0x0][_0x1608a7(0xa5)]=='German')var _0x523530=users[_0x1608a7(0xb9)];else{if(_0x2e14d2[0x0][_0x1608a7(0xa5)]==_0x1608a7(0x7f))var _0x523530=users['Spanish'];else{if(_0x2e14d2[0x0][_0x1608a7(0xa5)]==_0x1608a7(0x1a3))var _0x523530=users[_0x1608a7(0x1a3)];else{if(_0x2e14d2[0x0]['language']==_0x1608a7(0x15b))var _0x523530=users[_0x1608a7(0x94)];else{if(_0x2e14d2[0x0][_0x1608a7(0xa5)]==_0x1608a7(0x16f))var _0x523530=users[_0x1608a7(0x16f)];else{if(_0x2e14d2[0x0]['language']=='Arabic\x20(ae)')var _0x523530=users['Arabic'];}}}}}}}_0x1c0962[_0x1608a7(0x156)]('edit_sales_finished_view',{'success':_0x1d5a06[_0x1608a7(0x78)](_0x1608a7(0x18c)),'errors':_0x1d5a06[_0x1608a7(0x78)](_0x1608a7(0xa9)),'role':_0x53c009,'profile':_0x7ea167,'customer':_0x16bc86,'warehouse':_0x3a58bc,'product':_0x17e12e,'user':_0x46d997,'master_shop':_0x2e14d2,'unit':_0x38e7dc,'language':_0x523530});}catch(_0xd945f5){console['log'](_0xd945f5);}});async function dataUpdate(_0x5330f4,_0x3426ca,_0xb5fda3){var _0x4f1a66=a0_0x542edf;return await warehouse[_0x4f1a66(0xf5)]({'_id':_0x5330f4,'product_details._id':_0x3426ca},{'$set':{'product_details.$.product_stock':_0xb5fda3}}),await warehouse[_0x4f1a66(0x11d)](_0x5330f4);}router[a0_0x542edf(0xee)](a0_0x542edf(0x196),auth,async(_0x4207f2,_0x2fbfc0)=>{var _0x1a3fdb=a0_0x542edf;try{const _0x11693f=_0x4207f2[_0x1a3fdb(0x168)]['id'],{invoice:_0x3a74bb,warehouse_name:_0xcea86e,room:_0x46e06a}=_0x4207f2[_0x1a3fdb(0x106)],_0x11e006=await sales_finished[_0x1a3fdb(0x141)]({'invoice':_0x3a74bb});for(let _0x706d96=0x0;_0x706d96<=_0x11e006[_0x1a3fdb(0x91)][_0x1a3fdb(0x84)]-0x1;_0x706d96++){const _0x3a5b6c=_0x11e006['sale_product'][_0x706d96];var _0x444af3=await warehouse['findOne']({'name':_0xcea86e,'room':_0x3a5b6c[_0x1a3fdb(0x163)]}),_0x59abf1=0x0;for(let _0x21997a=0x0;_0x21997a<=_0x444af3[_0x1a3fdb(0xf2)][_0x1a3fdb(0x84)]-0x1;_0x21997a++){const _0x3c017e=_0x444af3[_0x1a3fdb(0xf2)][_0x21997a];_0x3c017e[_0x1a3fdb(0x118)]==_0x3a5b6c[_0x1a3fdb(0x179)]&&_0x3c017e['uuid']==_0x3a5b6c[_0x1a3fdb(0x199)]&&(_0x59abf1=Math['max'](0x0,Math['abs'](_0x3c017e[_0x1a3fdb(0x189)])-Math[_0x1a3fdb(0xd5)](_0x3a5b6c[_0x1a3fdb(0x17e)])),await warehouse[_0x1a3fdb(0xf5)]({'_id':_0x444af3[_0x1a3fdb(0x118)][_0x1a3fdb(0x125)](),'product_details._id':_0x3c017e['_id']['valueOf'](),'product_details.uuid':_0x3a5b6c['uuid']},{'$set':{'product_details.$.product_stock':_0x59abf1}}));}console[_0x1a3fdb(0x124)](typeof _0x3a5b6c[_0x1a3fdb(0xb6)]);if(typeof _0x3a5b6c['agent_id']!=='undefined'){var _0x295ff4=await staff[_0x1a3fdb(0x11d)](_0x3a5b6c[_0x1a3fdb(0xb6)]);console['log']('here');var _0x80b113=0x0;for(let _0x44fac9=0x0;_0x44fac9<=_0x295ff4[_0x1a3fdb(0x148)][_0x1a3fdb(0x84)]-0x1;_0x44fac9++){const _0x2227e8=_0x295ff4[_0x1a3fdb(0x148)][_0x44fac9];console['log'](_0x3a5b6c[_0x1a3fdb(0x179)]+_0x1a3fdb(0x1b0)+_0x2227e8['warehouse_id']+'\x20&&\x20'+_0x3a5b6c[_0x1a3fdb(0x118)]+_0x1a3fdb(0x1b0)+_0x3a5b6c[_0x1a3fdb(0x118)]),_0x3a5b6c[_0x1a3fdb(0x179)]==_0x2227e8[_0x1a3fdb(0x74)]&&_0x3a5b6c[_0x1a3fdb(0x118)]==0x1&&(_0x2227e8[_0x1a3fdb(0x189)]=Math[_0x1a3fdb(0xd5)](_0x2227e8[_0x1a3fdb(0x189)])+Math[_0x1a3fdb(0xd5)](_0x3a5b6c['quantity']),_0x80b113++);}console[_0x1a3fdb(0x124)](_0x1a3fdb(0xfb),_0x80b113),_0x80b113=='0'&&(_0x295ff4[_0x1a3fdb(0x148)]=_0x295ff4[_0x1a3fdb(0x148)][_0x1a3fdb(0x10f)]({'product_name':_0x3a5b6c['product_name'],'product_stock':_0x3a5b6c[_0x1a3fdb(0x17e)],'bay':_0x3a5b6c[_0x1a3fdb(0x161)],'level':_0x3a5b6c[_0x1a3fdb(0xaf)],'product_code':_0x3a5b6c['product_code'],'primary_code':_0x3a5b6c[_0x1a3fdb(0xa7)],'secondary_code':_0x3a5b6c[_0x1a3fdb(0x1ad)],'expiry_date':_0x3a5b6c[_0x1a3fdb(0xf3)],'production_date':_0x3a5b6c[_0x1a3fdb(0x14c)],'maxProducts':_0x3a5b6c[_0x1a3fdb(0x83)],'batch_code':_0x3a5b6c[_0x1a3fdb(0xb4)],'secondary_unit':_0x3a5b6c[_0x1a3fdb(0xbc)],'unit':_0x3a5b6c[_0x1a3fdb(0xba)],'maxProducts':_0x3a5b6c[_0x1a3fdb(0x83)],'maxPerUnit':_0x3a5b6c[_0x1a3fdb(0xd7)],'invoice':_0x3a5b6c[_0x1a3fdb(0xce)],'warehouse_id':_0x3a5b6c['id_transaction_from'],'id_incoming':_0x3a5b6c[_0x1a3fdb(0x118)],'uuid':_0x3a5b6c['uuid'],'gross_price':_0x3a5b6c[_0x1a3fdb(0x10d)],'date_incoming':_0x3a5b6c[_0x1a3fdb(0x140)],'outgoing_invoice':_0x3a5b6c[_0x1a3fdb(0x129)]}),await _0x295ff4[_0x1a3fdb(0xab)]());}}_0x11e006[_0x1a3fdb(0x89)]=_0x1a3fdb(0x7c);const _0x2c3e3d=await _0x11e006[_0x1a3fdb(0xab)](),_0x579953=await master_shop['find'](),_0x5bc5e2=await email_settings[_0x1a3fdb(0x141)](),_0x4d3bf=await supervisor_settings[_0x1a3fdb(0x97)]();var _0x1da79a=_0x11e006[_0x1a3fdb(0x91)],_0x2a0f75='',_0x44caa8;for(_0x44caa8 in _0x1da79a){_0x2a0f75+=_0x1a3fdb(0x12b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1da79a[_0x44caa8]['product_name']+'</td>'+_0x1a3fdb(0x143)+_0x1da79a[_0x44caa8][_0x1a3fdb(0x110)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1da79a[_0x44caa8]['quantity']+'</td>'+_0x1a3fdb(0x143)+_0x1da79a[_0x44caa8][_0x1a3fdb(0xba)]+_0x1a3fdb(0x12d)+_0x1a3fdb(0x143)+_0x1da79a[_0x44caa8][_0x1a3fdb(0xbc)]+'</td>'+_0x1a3fdb(0x143)+_0x11e006[_0x1a3fdb(0x138)]+'</td>'+_0x1a3fdb(0x143)+_0x1da79a[_0x44caa8][_0x1a3fdb(0x163)]+_0x1a3fdb(0x12d)+_0x1a3fdb(0x143)+_0x1da79a[_0x44caa8][_0x1a3fdb(0x161)]+_0x1a3fdb(0x12d);}_0x4207f2[_0x1a3fdb(0x78)](_0x1a3fdb(0x18c),_0x1a3fdb(0x132)),_0x2fbfc0['redirect'](_0x1a3fdb(0x7d)+_0x11693f);}catch(_0x15210c){console[_0x1a3fdb(0x124)](_0x15210c);}}),router['get'](a0_0x542edf(0x79),auth,async(_0x29050b,_0x10b0f6)=>{var _0xfefdd0=a0_0x542edf;try{const {username:_0x54230d,email:_0x2db1c0,role:_0x56625f}=_0x29050b[_0xfefdd0(0xe2)],_0x1aaba2=_0x29050b['user'],_0x1531dd=await profile[_0xfefdd0(0x141)]({'email':_0x1aaba2[_0xfefdd0(0x184)]}),_0x1e8628=await master_shop[_0xfefdd0(0x97)](),_0xec2f69=_0x29050b[_0xfefdd0(0x168)]['id'],_0xeee54=await sales_finished[_0xfefdd0(0x11d)](_0xec2f69);let _0xfc713e=new Date(_0xeee54[_0xfefdd0(0xf3)]),_0x1333a0=('0'+_0xfc713e[_0xfefdd0(0x19a)]())[_0xfefdd0(0x198)](-0x2),_0x38baac=('0'+(_0xfc713e[_0xfefdd0(0xf4)]()+0x1))[_0xfefdd0(0x198)](-0x2),_0x238ed2=_0xfc713e[_0xfefdd0(0x104)](),_0x32aa5b=_0x238ed2+'-'+_0x38baac+'-'+_0x1333a0;var _0x28f415=['Ambient','Enclosed'];const _0x221822=await warehouse[_0xfefdd0(0xef)]([{'$match':{'name':_0xeee54[_0xfefdd0(0x138)],'room':_0xeee54[_0xfefdd0(0xfc)]}},{'$unwind':_0xfefdd0(0x6e)},{'$group':{'_id':_0xfefdd0(0x144),'name':{'$first':_0xfefdd0(0xb2)},'product_stock':{'$first':_0xfefdd0(0xff)},'bay':{'$first':_0xfefdd0(0xd8)},'bin':{'$first':_0xfefdd0(0xc9)},'type':{'$first':_0xfefdd0(0x86)},'floorlevel':{'$first':_0xfefdd0(0xcf)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xfefdd0(0x176)},'product_code':{'$first':_0xfefdd0(0xd6)},'storage':{'$first':_0xfefdd0(0xf6)},'rack':{'$first':'$product_details.rack'}}}]),_0x5d87b0=await customer[_0xfefdd0(0x97)]({});let _0x14317f;if(_0x1aaba2[_0xfefdd0(0x14a)]==_0xfefdd0(0xdc)){const _0x31fb06=await staff['findOne']({'email':_0x1aaba2[_0xfefdd0(0x184)]});_0x14317f=await warehouse[_0xfefdd0(0xef)]([{'$match':{'status':'Enabled','name':_0x31fb06[_0xfefdd0(0x17c)]}},{'$group':{'_id':_0xfefdd0(0x99),'name':{'$first':'$name'}}}]);}else _0x14317f=await warehouse['aggregate']([{'$match':{'status':_0xfefdd0(0x162)}},{'$group':{'_id':_0xfefdd0(0x99),'name':{'$first':_0xfefdd0(0x99)}}}]);const _0x49b609=await product['find']({});if(_0x1e8628[0x0][_0xfefdd0(0xa5)]=='English\x20(US)'){var _0xad3b68=users[_0xfefdd0(0x71)];console[_0xfefdd0(0x124)](_0xad3b68);}else{if(_0x1e8628[0x0][_0xfefdd0(0xa5)]=='Hindi')var _0xad3b68=users['Hindi'];else{if(_0x1e8628[0x0][_0xfefdd0(0xa5)]==_0xfefdd0(0xb9))var _0xad3b68=users[_0xfefdd0(0xb9)];else{if(_0x1e8628[0x0]['language']==_0xfefdd0(0x7f))var _0xad3b68=users['Spanish'];else{if(_0x1e8628[0x0][_0xfefdd0(0xa5)]==_0xfefdd0(0x1a3))var _0xad3b68=users[_0xfefdd0(0x1a3)];else{if(_0x1e8628[0x0][_0xfefdd0(0xa5)]=='Portuguese\x20(BR)')var _0xad3b68=users[_0xfefdd0(0x94)];else{if(_0x1e8628[0x0][_0xfefdd0(0xa5)]==_0xfefdd0(0x16f))var _0xad3b68=users[_0xfefdd0(0x16f)];else{if(_0x1e8628[0x0][_0xfefdd0(0xa5)]=='Arabic\x20(ae)')var _0xad3b68=users[_0xfefdd0(0x190)];}}}}}}}_0x10b0f6[_0xfefdd0(0x156)](_0xfefdd0(0x188),{'success':_0x29050b[_0xfefdd0(0x78)](_0xfefdd0(0x18c)),'errors':_0x29050b[_0xfefdd0(0x78)]('errors'),'role':_0x1aaba2,'profile':_0x1531dd,'customer':_0x5d87b0,'warehouse':_0x14317f,'product':_0x221822,'user':_0xeee54,'master_shop':_0x1e8628,'unit':_0x49b609,'language':_0xad3b68,'rooms_data':_0x28f415,'ed_fullDate':_0x32aa5b});}catch(_0x422521){console[_0xfefdd0(0x124)](_0x422521);}}),router[a0_0x542edf(0xee)](a0_0x542edf(0x79),auth,async(_0x36bebf,_0x20be72)=>{var _0x339a6b=a0_0x542edf;try{const _0x357fa1=_0x36bebf['params']['id'],_0x339c5b=await sales_finished[_0x339a6b(0x141)]({'_id':_0x36bebf[_0x339a6b(0x168)]['id']}),_0x1e1d8e=await warehouse[_0x339a6b(0x141)]({'name':_0x339c5b['warehouse_name'],'room':_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0xfc)],'warehouse_category':_0x339a6b(0x136)}),{invoice:_0x4d23fc,customer:_0x251764,date:_0x355981,warehouse_name:_0xb967e,product_name:_0x45210b,stock:_0x405407,adjust_qty:_0x4946ba,note:_0x53f495,room:_0x3b9c8b,primary_code:_0x54da59,secondary_code:_0x15d1fe,prod_code:_0x4e5da4,level:_0x24f0cc,isle:_0x3d67e6,pallet:_0xe8dc26,expiry_date:_0x4dbfbb}=_0x36bebf[_0x339a6b(0x106)];if(typeof _0x45210b==_0x339a6b(0x16c))var _0x41b120=[_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x12a)]],_0x193c3a=[_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x197)]],_0x287101=[_0x36bebf[_0x339a6b(0x106)]['adjust_qty']],_0x2766d9=[_0x36bebf[_0x339a6b(0x106)]['primary_code']],_0x4409a5=[_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x1ad)]],_0x3aba7d=[_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x70)]],_0x126a3d=[_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0xaf)]],_0x251778=[_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0xf3)]];else var _0x41b120=[..._0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x12a)]],_0x193c3a=[..._0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x197)]],_0x287101=[..._0x36bebf[_0x339a6b(0x106)]['adjust_qty']],_0x2766d9=[..._0x36bebf[_0x339a6b(0x106)]['primary_code']],_0x4409a5=[..._0x36bebf[_0x339a6b(0x106)]['secondary_code']],_0x3aba7d=[..._0x36bebf['body']['prod_code']],_0x126a3d=[..._0x36bebf[_0x339a6b(0x106)][_0x339a6b(0xaf)]],_0x251778=[..._0x36bebf[_0x339a6b(0x106)]['expiry_date']];const _0x2a9426=_0x41b120[_0x339a6b(0x116)](_0x15c62f=>{return _0x15c62f={'product_name':_0x15c62f};});_0x193c3a[_0x339a6b(0xd3)]((_0x465690,_0x411e1f)=>{var _0x2db123=_0x339a6b;_0x2a9426[_0x411e1f][_0x2db123(0x197)]=_0x465690;}),_0x287101[_0x339a6b(0xd3)]((_0x3ce346,_0x5473d7)=>{var _0x3a9176=_0x339a6b;_0x2a9426[_0x5473d7][_0x3a9176(0x17e)]=_0x3ce346;}),_0x2766d9['forEach']((_0x5ea1c5,_0x1d44bf)=>{_0x2a9426[_0x1d44bf]['primary_code']=_0x5ea1c5;}),_0x4409a5[_0x339a6b(0xd3)]((_0x3f6b09,_0x5ce1a6)=>{var _0x1dbcb5=_0x339a6b;_0x2a9426[_0x5ce1a6][_0x1dbcb5(0x1ad)]=_0x3f6b09;}),_0x3aba7d[_0x339a6b(0xd3)]((_0x34208a,_0x48e7ed)=>{_0x2a9426[_0x48e7ed]['product_code']=_0x34208a;}),_0x126a3d[_0x339a6b(0xd3)]((_0x537bbf,_0x4edf20)=>{var _0x1d2372=_0x339a6b;_0x2a9426[_0x4edf20][_0x1d2372(0xaf)]=_0x537bbf;}),_0x251778[_0x339a6b(0xd3)]((_0xb5f4e9,_0x915622)=>{var _0xc60f53=_0x339a6b;_0x2a9426[_0x915622][_0xc60f53(0xf3)]=_0xb5f4e9;});var _0xb46e63=0x0;_0x2a9426[_0x339a6b(0xd3)](_0x22a826=>{var _0x5efd3c=_0x339a6b;console[_0x5efd3c(0x124)](_0x5efd3c(0x1a7),_0x22a826),(parseInt(_0x22a826['stock'])<parseInt(_0x22a826[_0x5efd3c(0x17e)])||parseInt(_0x22a826['quantity'])==0x0)&&_0xb46e63++;});if(_0xb46e63!=0x0)return _0x36bebf['flash'](_0x339a6b(0xa9),_0x339a6b(0x146)),_0x20be72[_0x339a6b(0xdb)](_0x339a6b(0x19e));_0x339c5b[_0x339a6b(0x91)]['forEach'](_0x1d1f61=>{var _0xfadf28=_0x339a6b;const _0x4f0eea=_0x1e1d8e[_0xfadf28(0xf2)]['map'](_0x50a2c2=>{var _0x2ab495=_0xfadf28;_0x50a2c2['product_name']==_0x1d1f61[_0x2ab495(0x12a)]&&_0x50a2c2['bay']==_0x1d1f61[_0x2ab495(0x161)]&&(_0x50a2c2[_0x2ab495(0x189)]=parseInt(_0x50a2c2[_0x2ab495(0x189)])+parseInt(_0x1d1f61['quantity']));});}),await _0x1e1d8e[_0x339a6b(0xab)]();const _0x78fcff=_0x2a9426[_0x339a6b(0xbe)](_0x1be41d=>_0x1be41d[_0x339a6b(0x17e)]!=='0'&&_0x1be41d[_0x339a6b(0x17e)]!=='');_0x339c5b['invoice']=_0x4d23fc,_0x339c5b[_0x339a6b(0xec)]=_0x251764,_0x339c5b[_0x339a6b(0x13d)]=_0x355981,_0x339c5b[_0x339a6b(0x138)]=_0xb967e,_0x339c5b[_0x339a6b(0x91)]=_0x78fcff,_0x339c5b['note']=_0x53f495,_0x339c5b[_0x339a6b(0xfc)]=_0x3b9c8b;const _0x55ec4c=await _0x339c5b[_0x339a6b(0xab)](),_0x14cca4=await sales_finished[_0x339a6b(0x141)]({'_id':_0x36bebf[_0x339a6b(0x168)]['id']}),_0xfede7a=await warehouse[_0x339a6b(0x141)]({'name':_0xb967e,'room':_0x3b9c8b,'warehouse_category':_0x339a6b(0x136)});_0x14cca4['sale_product'][_0x339a6b(0xd3)](_0x35619a=>{var _0x50db78=_0x339a6b;const _0x168553=_0xfede7a['product_details'][_0x50db78(0x116)](_0x45d02d=>{var _0x580a81=_0x50db78;_0x45d02d[_0x580a81(0x12a)]==_0x35619a[_0x580a81(0x12a)]&&_0x45d02d[_0x580a81(0x161)]==_0x35619a['bay']&&(_0x45d02d['product_stock']=parseInt(_0x45d02d['product_stock'])-parseInt(_0x35619a[_0x580a81(0x17e)]));});}),console['log'](_0x339a6b(0x160),_0xfede7a),await _0xfede7a['save']();const _0x2cba52=await c_payment_data[_0x339a6b(0x141)]({'invoice':_0x36bebf['body']['invoice']});_0x2cba52[_0x339a6b(0x19c)]=_0x36bebf[_0x339a6b(0x106)][_0x339a6b(0x19c)],await _0x2cba52[_0x339a6b(0xab)](),_0x36bebf['flash'](_0x339a6b(0x18c),_0x339a6b(0x132)),_0x20be72[_0x339a6b(0xdb)]('/all_sales_finished/view');}catch(_0xdfa5f6){console[_0x339a6b(0x124)](_0xdfa5f6);}}),router['post'](a0_0x542edf(0x123),auth,async(_0x47fc65,_0x3d95c8)=>{var _0x2f69bf=a0_0x542edf;try{const _0x55c10a=_0x47fc65[_0x2f69bf(0x168)]['id'],{invoice:_0x4ccffa,customer:_0x499934,receivable_amount:_0x2fb991,received_amount:_0x6f0d32}=_0x47fc65[_0x2f69bf(0x106)],_0x2992bd=await sales['findById'](_0x55c10a);console[_0x2f69bf(0x124)](_0x2992bd);var _0x26d144=_0x2fb991-_0x6f0d32;console[_0x2f69bf(0x124)](_0x6f0d32),_0x2992bd[_0x2f69bf(0x101)]=parseFloat(_0x6f0d32)+parseFloat(_0x2992bd[_0x2f69bf(0x101)]),_0x2992bd[_0x2f69bf(0xe7)]=_0x26d144,console[_0x2f69bf(0x124)](_0x2992bd);const _0x5aacdf=await _0x2992bd['save'](),_0x3fd54c=await c_payment_data[_0x2f69bf(0x141)]({'invoice':_0x4ccffa});_0x3fd54c[_0x2f69bf(0x107)]=_0x26d144,await _0x3fd54c[_0x2f69bf(0xab)]();let _0x334971=new Date(),_0xef059a=('0'+_0x334971['getDate']())[_0x2f69bf(0x198)](-0x2),_0x5572ff=('0'+(_0x334971['getMonth']()+0x1))['slice'](-0x2),_0x115f3d=_0x334971['getFullYear'](),_0x4ffbe5=_0x115f3d+'-'+_0x5572ff+'-'+_0xef059a;const _0x5f10c6=new customer_payment({'invoice':_0x4ccffa,'date':_0x115f3d+'-'+_0x5572ff+'-'+_0xef059a,'customer':_0x499934,'reason':_0x2f69bf(0x17a),'amount':_0x6f0d32}),_0x500811=await _0x5f10c6['save']();_0x47fc65[_0x2f69bf(0x78)](_0x2f69bf(0x18c),_0x2f69bf(0xcc)),_0x3d95c8[_0x2f69bf(0xdb)]('/all_sales/view');}catch(_0x659c5d){console[_0x2f69bf(0x124)](_0x659c5d);}}),router[a0_0x542edf(0xb8)]('/invoice/:id',auth,async(_0x389cb9,_0x3cf58e)=>{var _0x4f77de=a0_0x542edf;try{const {username:_0x243f02,email:_0x2002f9,role:_0x31cfa7}=_0x389cb9[_0x4f77de(0xe2)],_0x19a25a=_0x389cb9[_0x4f77de(0xe2)],_0x1e423a=await profile[_0x4f77de(0x141)]({'email':_0x19a25a['email']}),_0x7ac26=await master_shop['find']();console[_0x4f77de(0x124)](_0x4f77de(0xb0),_0x7ac26);const _0x3bd954=_0x389cb9[_0x4f77de(0x168)]['id'],_0x464a0b=await sales[_0x4f77de(0x11d)](_0x3bd954);console[_0x4f77de(0x124)](_0x464a0b);const _0x28c635=await customer[_0x4f77de(0x141)]({'name':_0x464a0b['customer']});console[_0x4f77de(0x124)](_0x28c635);if(_0x7ac26[0x0][_0x4f77de(0xa5)]==_0x4f77de(0x139)){var _0x4d3646=users[_0x4f77de(0x71)];console['log'](_0x4d3646);}else{if(_0x7ac26[0x0][_0x4f77de(0xa5)]==_0x4f77de(0x131))var _0x4d3646=users[_0x4f77de(0x131)];else{if(_0x7ac26[0x0][_0x4f77de(0xa5)]==_0x4f77de(0xb9))var _0x4d3646=users[_0x4f77de(0xb9)];else{if(_0x7ac26[0x0]['language']==_0x4f77de(0x7f))var _0x4d3646=users[_0x4f77de(0x7f)];else{if(_0x7ac26[0x0]['language']==_0x4f77de(0x1a3))var _0x4d3646=users[_0x4f77de(0x1a3)];else{if(_0x7ac26[0x0][_0x4f77de(0xa5)]==_0x4f77de(0x15b))var _0x4d3646=users[_0x4f77de(0x94)];else{if(_0x7ac26[0x0][_0x4f77de(0xa5)]=='Chinese')var _0x4d3646=users['Chinese'];else{if(_0x7ac26[0x0][_0x4f77de(0xa5)]==_0x4f77de(0x19f))var _0x4d3646=users[_0x4f77de(0x190)];}}}}}}}_0x3cf58e['render'](_0x4f77de(0x8f),{'success':_0x389cb9[_0x4f77de(0x78)]('success'),'errors':_0x389cb9[_0x4f77de(0x78)](_0x4f77de(0xa9)),'role':_0x19a25a,'profile':_0x1e423a,'master_shop':_0x7ac26,'customers':_0x28c635,'sales':_0x464a0b,'language':_0x4d3646});}catch(_0x11a481){console[_0x4f77de(0x124)](_0x11a481);}}),router[a0_0x542edf(0xb8)](a0_0x542edf(0x1a8),auth,async(_0x2b9033,_0x47642b)=>{var _0x29fdc8=a0_0x542edf;try{const {username:_0x44e23d,email:_0x56942a,role:_0x145ab3}=_0x2b9033[_0x29fdc8(0xe2)],_0x943547=_0x2b9033[_0x29fdc8(0xe2)],_0x3c7001=await profile[_0x29fdc8(0x141)]({'email':_0x943547['email']}),_0x1c93f6=await master_shop['find'](),_0xea7b93=_0x2b9033[_0x29fdc8(0x168)]['id'],_0x15e712=await sales_finished[_0x29fdc8(0x11d)](_0xea7b93),_0x272c51=await warehouse[_0x29fdc8(0xef)]([{'$match':{'name':_0x15e712[_0x29fdc8(0x138)]}},{'$unwind':_0x29fdc8(0x6e)},{'$group':{'_id':_0x29fdc8(0x144),'name':{'$first':_0x29fdc8(0xb2)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x29fdc8(0xd8)},'bin':{'$first':_0x29fdc8(0xc9)},'type':{'$first':_0x29fdc8(0x86)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x29fdc8(0x176)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x29fdc8(0xf6)},'rack':{'$first':_0x29fdc8(0x7e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x29fdc8(0x92)},'unit':{'$first':_0x29fdc8(0xa3)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x29fdc8(0x194)},'batch_code':{'$first':_0x29fdc8(0x13e)},'maxPerUnit':{'$first':_0x29fdc8(0x119)}}}]),_0x40de5b=await product[_0x29fdc8(0x97)]({}),_0x16e835=await warehouse[_0x29fdc8(0xef)]([{'$match':{'status':_0x29fdc8(0x162),'warehouse_category':_0x29fdc8(0x136),'name':{'$ne':_0x29fdc8(0x10e),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x29fdc8(0x99),'name':{'$first':_0x29fdc8(0x99)}}},{'$sort':{'name':0x1}}]);var _0x2e93ec=[_0x29fdc8(0xbb)];const _0x28ea29=await warehouse[_0x29fdc8(0xef)]([{'$match':{'status':_0x29fdc8(0x162),'name':_0x29fdc8(0x13a)}},{'$group':{'_id':'$name','name':{'$first':_0x29fdc8(0x99)}}},{'$sort':{'name':0x1}}]);if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]==_0x29fdc8(0x139)){var _0x1a624d=users[_0x29fdc8(0x71)];console[_0x29fdc8(0x124)](_0x1a624d);}else{if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]==_0x29fdc8(0x131))var _0x1a624d=users[_0x29fdc8(0x131)];else{if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]==_0x29fdc8(0xb9))var _0x1a624d=users['German'];else{if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]==_0x29fdc8(0x7f))var _0x1a624d=users['Spanish'];else{if(_0x1c93f6[0x0]['language']==_0x29fdc8(0x1a3))var _0x1a624d=users['French'];else{if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]==_0x29fdc8(0x15b))var _0x1a624d=users[_0x29fdc8(0x94)];else{if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]==_0x29fdc8(0x16f))var _0x1a624d=users[_0x29fdc8(0x16f)];else{if(_0x1c93f6[0x0][_0x29fdc8(0xa5)]=='Arabic\x20(ae)')var _0x1a624d=users[_0x29fdc8(0x190)];}}}}}}}_0x47642b[_0x29fdc8(0x156)](_0x29fdc8(0xb5),{'success':_0x2b9033[_0x29fdc8(0x78)](_0x29fdc8(0x18c)),'errors':_0x2b9033[_0x29fdc8(0x78)](_0x29fdc8(0xa9)),'role':_0x943547,'profile':_0x3c7001,'user':_0x15e712,'stock':_0x272c51,'master_shop':_0x1c93f6,'unit':_0x40de5b,'language':_0x1a624d,'warehouses':_0x16e835,'rooms':_0x2e93ec,'warehouse_QA':_0x28ea29});}catch(_0x19ebd3){console[_0x29fdc8(0x124)](_0x19ebd3),_0x47642b[_0x29fdc8(0x1ba)](0xc8)[_0x29fdc8(0x18d)]({'message':_0x19ebd3[_0x29fdc8(0x82)]});}}),router[a0_0x542edf(0xee)](a0_0x542edf(0x1a8),auth,async(_0x3c137f,_0x583dc0)=>{var _0x5bdde5=a0_0x542edf;if(_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xeb)]=='QA')try{const {invoice:_0x4faf35,date:_0x1384c6,warehouse_name:_0x3f0e2d,product_name:_0x59773b,primary_code:_0x4c3834,secondary_code:_0x48e460,product_code:_0x457f7a,sales_quantity:_0x552368,stocks:_0x122bf7,return_qty:_0x387e4f,Room_name:_0x389f75,to_warehouse_name_QA:_0x36c1a0,to_Room_name_QA:_0x9066ec,note:_0x2d6997,for_categorize:_0x22c819,product_name_QA1:_0x5ea373}=_0x3c137f[_0x5bdde5(0x106)];if(typeof _0x5ea373==_0x5bdde5(0x16c))var _0x163042=[_0x3c137f[_0x5bdde5(0x106)]['product_name_QA1']],_0x217837=[_0x3c137f[_0x5bdde5(0x106)]['primary_code_QA']],_0x197ca3=[_0x3c137f[_0x5bdde5(0x106)]['secondary_code_QA']],_0x525a5c=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x112)]],_0x539e25=[_0x3c137f[_0x5bdde5(0x106)]['sales_quantity_QA']],_0x181cbe=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x10c)]],_0x353199=[_0x3c137f['body'][_0x5bdde5(0xc0)]],_0x2c758d=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x12f)]],_0x172765=[_0x3c137f['body'][_0x5bdde5(0x164)]],_0x26dff6=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x9b)]],_0x3d5f80=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x170)]],_0x43e41c=[_0x3c137f[_0x5bdde5(0x106)]['unit_QA']],_0x49a353=[_0x3c137f['body'][_0x5bdde5(0x103)]],_0x3c042c=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xdf)]];else var _0x163042=[..._0x3c137f['body']['product_name_QA1']],_0x217837=[..._0x3c137f[_0x5bdde5(0x106)]['primary_code_QA']],_0x197ca3=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x14f)]],_0x525a5c=[..._0x3c137f['body'][_0x5bdde5(0x112)]],_0x539e25=[..._0x3c137f['body'][_0x5bdde5(0x1b7)]],_0x181cbe=[..._0x3c137f['body']['stocks_QA']],_0x353199=[..._0x3c137f['body']['return_qty_QA']],_0x2c758d=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x12f)]],_0x172765=[..._0x3c137f[_0x5bdde5(0x106)]['maxProducts_QA']],_0x26dff6=[..._0x3c137f['body'][_0x5bdde5(0x9b)]],_0x3d5f80=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x170)]],_0x43e41c=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x142)]],_0x49a353=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x103)]],_0x3c042c=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xdf)]];const _0x551474=_0x163042[_0x5bdde5(0x116)](_0x19d76a=>{return _0x19d76a={'product_name':_0x19d76a};});_0x217837[_0x5bdde5(0xd3)]((_0x3d9401,_0x552ea3)=>{var _0x15dd74=_0x5bdde5;_0x551474[_0x552ea3][_0x15dd74(0xa7)]=_0x3d9401;}),_0x197ca3[_0x5bdde5(0xd3)]((_0xd26ede,_0x44626e)=>{var _0x36832b=_0x5bdde5;_0x551474[_0x44626e][_0x36832b(0x1ad)]=_0xd26ede;}),_0x525a5c[_0x5bdde5(0xd3)]((_0x589791,_0x53dfd7)=>{var _0x24e6ec=_0x5bdde5;_0x551474[_0x53dfd7][_0x24e6ec(0x110)]=_0x589791;}),_0x539e25[_0x5bdde5(0xd3)]((_0x25324f,_0x61be86)=>{_0x551474[_0x61be86]['sale_qty']=_0x25324f;}),_0x181cbe['forEach']((_0x5414a5,_0x11c70b)=>{_0x551474[_0x11c70b]['stock']=_0x5414a5;}),_0x353199[_0x5bdde5(0xd3)]((_0x2a078b,_0x51ef38)=>{var _0xd3bf62=_0x5bdde5;_0x551474[_0x51ef38][_0xd3bf62(0x17f)]=_0x2a078b;}),_0x2c758d[_0x5bdde5(0xd3)]((_0x4e035f,_0x278d14)=>{var _0x3aa829=_0x5bdde5;_0x551474[_0x278d14][_0x3aa829(0xa0)]=_0x4e035f;}),_0x172765[_0x5bdde5(0xd3)]((_0x533afa,_0x4e3255)=>{_0x551474[_0x4e3255]['maxProducts']=_0x533afa;}),_0x26dff6[_0x5bdde5(0xd3)]((_0x5be387,_0x4b9340)=>{_0x551474[_0x4b9340]['batch_code']=_0x5be387;}),_0x3d5f80['forEach']((_0xa34f3a,_0x51d46c)=>{_0x551474[_0x51d46c]['secondary_unit']=_0xa34f3a;}),_0x43e41c['forEach']((_0x7c0dc3,_0x462979)=>{var _0x1ee1f0=_0x5bdde5;_0x551474[_0x462979][_0x1ee1f0(0xba)]=_0x7c0dc3;}),_0x49a353[_0x5bdde5(0xd3)]((_0x1d1bfc,_0x3ba307)=>{var _0x53c134=_0x5bdde5;_0x551474[_0x3ba307][_0x53c134(0x14c)]=_0x1d1bfc;}),_0x3c042c[_0x5bdde5(0xd3)]((_0x5acfd6,_0x5cbff6)=>{var _0x22860e=_0x5bdde5;_0x551474[_0x5cbff6][_0x22860e(0xf3)]=_0x5acfd6;});const _0x2e34ba=await sales_finished[_0x5bdde5(0x141)]({'invoice':_0x4faf35});_0x2e34ba[_0x5bdde5(0x187)]='True';const _0x185bf6=await _0x2e34ba[_0x5bdde5(0xab)](),_0x1b2f10=new sales_return_finished({'invoice':_0x4faf35,'customer':_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xec)],'date':_0x1384c6,'warehouse_name':_0x3f0e2d,'room':_0x389f75,'ToWarehouse':_0x36c1a0,'ToRoom':_0x9066ec,'return_sale_QA':_0x551474,'note':_0x2d6997,'warehouse_cat':_0x22c819}),_0xde5065=await _0x1b2f10[_0x5bdde5(0xab)](),_0x190f9b=await sales_return_finished[_0x5bdde5(0x141)]({'invoice':_0x4faf35}),_0x5bbbc6=await warehouse[_0x5bdde5(0x141)]({'name':_0x36c1a0,'room':_0x9066ec});_0x190f9b[_0x5bdde5(0x105)][_0x5bdde5(0xd3)](_0x4e441f=>{var _0x500e9c=_0x5bdde5,_0x4a3515=0x0;const _0x53d552=_0x5bbbc6['product_details'][_0x500e9c(0x116)](_0x59f5e2=>{var _0xc9a122=_0x500e9c;_0x59f5e2[_0xc9a122(0x12a)]==_0x4e441f['product_name']&&_0x59f5e2[_0xc9a122(0xf3)]==_0x4e441f[_0xc9a122(0xf3)]&&_0x59f5e2[_0xc9a122(0x14c)]==_0x4e441f[_0xc9a122(0x14c)]&&_0x59f5e2[_0xc9a122(0xb4)]==_0x4e441f[_0xc9a122(0xb4)]&&(_0x59f5e2[_0xc9a122(0x189)]=parseInt(_0x59f5e2[_0xc9a122(0x189)])+parseInt(_0x4e441f['return_qty']),_0x4a3515++);});_0x4a3515=='0'&&(_0x5bbbc6['product_details']=_0x5bbbc6['product_details']['concat']({'product_name':_0x4e441f['product_name'],'product_stock':_0x4e441f[_0x500e9c(0x17f)],'primary_code':_0x4e441f[_0x500e9c(0xa7)],'secondary_code':_0x4e441f[_0x500e9c(0x1ad)],'product_code':_0x4e441f[_0x500e9c(0x110)],'batch_code':_0x4e441f[_0x500e9c(0xb4)],'maxPerUnit':_0x4e441f[_0x500e9c(0xa0)],'production_date':_0x4e441f[_0x500e9c(0x14c)],'expiry_date':_0x4e441f[_0x500e9c(0xf3)],'secondary_unit':_0x4e441f[_0x500e9c(0xbc)],'unit':_0x4e441f[_0x500e9c(0xba)],'maxProducts':_0x4e441f[_0x500e9c(0x83)],'bay':_0x4e441f[_0x500e9c(0x161)]}));}),await _0x5bbbc6['save']();const _0x41788e=new c_payment_data({'invoice':_0x4faf35,'customer':_0x3c137f[_0x5bdde5(0x106)]['customer'],'reason':'Sale\x20Return'});await _0x41788e[_0x5bdde5(0xab)]();const _0x1e6bd1=await master_shop[_0x5bdde5(0x97)](),_0x40ff5d=await email_settings[_0x5bdde5(0x141)](),_0x42ef6c=await customer[_0x5bdde5(0x141)]({'name':_0x3c137f['body'][_0x5bdde5(0xec)]});_0x1e6bd1[0x0][_0x5bdde5(0xf9)]==0x1?(right_currency=_0x1e6bd1[0x0][_0x5bdde5(0x121)],left_currency=''):(right_currency='',left_currency=_0x1e6bd1[0x0][_0x5bdde5(0x121)]);var _0x2ef16a=_0x163042,_0x44155d=_0x353199,_0x39c13a='',_0x5dfea8;for(_0x5dfea8 in _0x2ef16a){_0x39c13a+=_0x5bdde5(0x12b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ef16a[_0x5dfea8]+'</td>'+_0x5bdde5(0x143)+_0x44155d[_0x5dfea8]+_0x5bdde5(0x12d)+_0x5bdde5(0x9c);}console['log'](_0x5bdde5(0x148),_0x39c13a);let _0x3ec0c6=nodemailer[_0x5bdde5(0xd2)]({'service':_0x5bdde5(0x6d),'auth':{'user':_0x40ff5d[_0x5bdde5(0x184)],'pass':_0x40ff5d['password']}}),_0x58ddc2={'from':_0x40ff5d[_0x5bdde5(0x184)],'to':_0x42ef6c[_0x5bdde5(0x184)],'subject':_0x5bdde5(0xb7),'attachments':[{'filename':_0x5bdde5(0xdd),'path':__dirname+_0x5bdde5(0x159)+_0x5bdde5(0x10a)+_0x1e6bd1[0x0]['image'],'cid':'logo'}],'html':_0x5bdde5(0xc6)+_0x5bdde5(0x8c)+_0x5bdde5(0x135)+_0x5bdde5(0x133)+_0x5bdde5(0x192)+_0x5bdde5(0x133)+_0x5bdde5(0x12e)+_0x5bdde5(0x1b1)+'<div>'+_0x5bdde5(0xda)+_0x1e6bd1[0x0]['site_title']+_0x5bdde5(0x18a)+_0x5bdde5(0x1b1)+_0x5bdde5(0x1b1)+'<hr\x20class=\x22my-3\x22>'+_0x5bdde5(0x133)+_0x5bdde5(0xf7)+_0x5bdde5(0xe5)+_0x4faf35+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x1384c6+'\x20'+_0x5bdde5(0x145)+_0x5bdde5(0x171)+'</div>'+_0x5bdde5(0x10b)+_0x5bdde5(0x120)+_0x5bdde5(0x12b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5bdde5(0x8b)+_0x5bdde5(0x155)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x5bdde5(0x15e)+'\x20'+_0x39c13a+'\x20'+_0x5bdde5(0x149)+_0x5bdde5(0xae)+_0x5bdde5(0x133)+'<strong>\x20Regards\x20</strong>'+_0x5bdde5(0xf8)+_0x1e6bd1[0x0][_0x5bdde5(0x11b)]+'</h5>'+'</div>'+_0x5bdde5(0x1b1)+_0x5bdde5(0x128)};_0x3ec0c6[_0x5bdde5(0xcd)](_0x58ddc2,function(_0x1dfcc3,_0x1e649f){var _0x459c35=_0x5bdde5;_0x1dfcc3?(console[_0x459c35(0x124)](_0x1dfcc3),console[_0x459c35(0x124)](_0x459c35(0xbd))):console['log'](_0x459c35(0x185));}),_0x3c137f[_0x5bdde5(0x78)]('success',_0x5bdde5(0xad)),_0x583dc0[_0x5bdde5(0xdb)](_0x5bdde5(0xb3));}catch(_0x3c4bd3){_0x583dc0[_0x5bdde5(0x1ba)](0xc8)[_0x5bdde5(0x18d)]({'message1':_0x3c4bd3[_0x5bdde5(0x82)]});}else{if(_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xeb)]=='GS')try{const {invoice:_0x67b609,date:_0x5cf1ec,warehouse_name:_0x52953d,product_name:_0xadc554,primary_code:_0x4a39ac,secondary_code:_0x11caec,product_code:_0x11bddb,sales_quantity:_0x485634,stocks:_0x4bac3a,return_qty:_0x302c04,Room_name:_0x5cfac8,to_warehouse_name:_0xe4228d,to_Room_name:_0x23fbb7,note:_0x130863,level:_0x2efcb3,isle:_0x50bf8c,pallet:_0xb923ed,for_categorize:_0x13c291}=_0x3c137f[_0x5bdde5(0x106)];if(typeof _0xadc554==_0x5bdde5(0x16c))var _0x163042=[_0x3c137f['body'][_0x5bdde5(0x12a)]],_0x217837=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xa7)]],_0x197ca3=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x1ad)]],_0x525a5c=[_0x3c137f[_0x5bdde5(0x106)]['product_code']],_0x539e25=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x165)]],_0x353199=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x17f)]],_0x5e47bb=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x161)]],_0x2c758d=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xa0)]],_0x172765=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x83)]],_0x26dff6=[_0x3c137f['body'][_0x5bdde5(0xb4)]],_0x3d5f80=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xbc)]],_0x43e41c=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xba)]],_0x49a353=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x14c)]],_0x3c042c=[_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xf3)]];else var _0x163042=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x12a)]],_0x217837=[..._0x3c137f['body'][_0x5bdde5(0xa7)]],_0x197ca3=[..._0x3c137f[_0x5bdde5(0x106)]['secondary_code']],_0x525a5c=[..._0x3c137f[_0x5bdde5(0x106)]['product_code']],_0x539e25=[..._0x3c137f[_0x5bdde5(0x106)]['sales_quantity']],_0x353199=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x17f)]],_0x5e47bb=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x161)]],_0x2c758d=[..._0x3c137f[_0x5bdde5(0x106)]['maxPerUnit']],_0x172765=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x83)]],_0x26dff6=[..._0x3c137f['body']['batch_code']],_0x3d5f80=[..._0x3c137f['body'][_0x5bdde5(0xbc)]],_0x43e41c=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xba)]],_0x49a353=[..._0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0x14c)]],_0x3c042c=[..._0x3c137f[_0x5bdde5(0x106)]['expiry_date']];const _0xa2d11=_0x163042['map'](_0xccd819=>{return _0xccd819={'product_name':_0xccd819};});_0x217837[_0x5bdde5(0xd3)]((_0x43d7b6,_0x1721b0)=>{var _0x17b010=_0x5bdde5;_0xa2d11[_0x1721b0][_0x17b010(0xa7)]=_0x43d7b6;}),_0x197ca3[_0x5bdde5(0xd3)]((_0x15a02c,_0x1af65e)=>{var _0x15857a=_0x5bdde5;_0xa2d11[_0x1af65e][_0x15857a(0x1ad)]=_0x15a02c;}),_0x525a5c[_0x5bdde5(0xd3)]((_0x4672dc,_0x37d4dd)=>{var _0x319c51=_0x5bdde5;_0xa2d11[_0x37d4dd][_0x319c51(0x110)]=_0x4672dc;}),_0x539e25[_0x5bdde5(0xd3)]((_0x474f7d,_0x2d48ab)=>{var _0x7af90d=_0x5bdde5;_0xa2d11[_0x2d48ab][_0x7af90d(0xf1)]=_0x474f7d;}),_0x353199[_0x5bdde5(0xd3)]((_0x15942c,_0x27ebcb)=>{var _0x40aa08=_0x5bdde5;_0xa2d11[_0x27ebcb][_0x40aa08(0x17f)]=_0x15942c;}),_0x5e47bb[_0x5bdde5(0xd3)]((_0x123be5,_0x5554a2)=>{var _0x439db6=_0x5bdde5;_0xa2d11[_0x5554a2][_0x439db6(0x161)]=_0x123be5;}),_0x2c758d[_0x5bdde5(0xd3)]((_0x3e30b5,_0x1dcb78)=>{_0xa2d11[_0x1dcb78]['maxPerUnit']=_0x3e30b5;}),_0x172765[_0x5bdde5(0xd3)]((_0x5bd191,_0x530a79)=>{var _0x2f1510=_0x5bdde5;_0xa2d11[_0x530a79][_0x2f1510(0x83)]=_0x5bd191;}),_0x26dff6[_0x5bdde5(0xd3)]((_0x35156c,_0x15dbb3)=>{var _0x3abc24=_0x5bdde5;_0xa2d11[_0x15dbb3][_0x3abc24(0xb4)]=_0x35156c;}),_0x3d5f80[_0x5bdde5(0xd3)]((_0x380218,_0x1deaf2)=>{var _0x3c56ca=_0x5bdde5;_0xa2d11[_0x1deaf2][_0x3c56ca(0xbc)]=_0x380218;}),_0x43e41c[_0x5bdde5(0xd3)]((_0x1e12f0,_0x9ffdf2)=>{_0xa2d11[_0x9ffdf2]['unit']=_0x1e12f0;}),_0x49a353[_0x5bdde5(0xd3)]((_0x48cd61,_0x47613f)=>{var _0x642916=_0x5bdde5;_0xa2d11[_0x47613f][_0x642916(0x14c)]=_0x48cd61;}),_0x3c042c[_0x5bdde5(0xd3)]((_0x13da6f,_0x430928)=>{var _0x2d2423=_0x5bdde5;_0xa2d11[_0x430928][_0x2d2423(0xf3)]=_0x13da6f;});var _0x505574=0x0;_0xa2d11[_0x5bdde5(0xd3)](_0x4ff2a8=>{var _0x1a5b24=_0x5bdde5;(parseInt(_0x4ff2a8[_0x1a5b24(0xf1)])<parseInt(_0x4ff2a8[_0x1a5b24(0x17f)])||parseInt(_0x4ff2a8[_0x1a5b24(0x197)])<parseInt(_0x4ff2a8[_0x1a5b24(0x17f)])&&parseInt(_0x4ff2a8[_0x1a5b24(0xf1)])>parseInt(_0x4ff2a8[_0x1a5b24(0x17f)])||parseInt(_0x4ff2a8[_0x1a5b24(0x17f)])==0x0)&&_0x505574++;});if(_0x505574!=0x0)return _0x3c137f[_0x5bdde5(0x78)]('errors',_0x5bdde5(0x117)),_0x583dc0[_0x5bdde5(0xdb)](_0x5bdde5(0x19e));const _0x24b47c=await sales_finished[_0x5bdde5(0x141)]({'invoice':_0x67b609});_0x24b47c[_0x5bdde5(0x187)]=_0x5bdde5(0x7c);const _0x4f89fe=await _0x24b47c[_0x5bdde5(0xab)](),_0x4eef58=new sales_return_finished({'invoice':_0x67b609,'customer':_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xec)],'date':_0x5cf1ec,'warehouse_name':_0x52953d,'room':_0x5cfac8,'ToWarehouse':_0xe4228d,'ToRoom':_0x23fbb7,'return_sale':_0xa2d11,'note':_0x130863,'warehouse_cat':_0x13c291}),_0x3c8737=await _0x4eef58[_0x5bdde5(0xab)](),_0x5aed6a=await sales_return_finished['findOne']({'invoice':_0x67b609}),_0x518b40=await warehouse['findOne']({'name':_0xe4228d,'room':_0x23fbb7,'warehouse_category':_0x5bdde5(0x136)});_0x5aed6a['return_sale'][_0x5bdde5(0xd3)](_0x19b338=>{var _0x5ee5a2=_0x5bdde5,_0x3861a5=0x0;const _0x281f50=_0x518b40[_0x5ee5a2(0xf2)][_0x5ee5a2(0x116)](_0x1190f2=>{var _0xf5d757=_0x5ee5a2;_0x1190f2[_0xf5d757(0x12a)]==_0x19b338[_0xf5d757(0x12a)]&&_0x1190f2[_0xf5d757(0x161)]==_0x19b338[_0xf5d757(0x161)]&&_0x1190f2[_0xf5d757(0xf3)]==_0x19b338[_0xf5d757(0xf3)]&&_0x1190f2[_0xf5d757(0x14c)]==_0x19b338['production_date']&&_0x1190f2[_0xf5d757(0xb4)]==_0x19b338[_0xf5d757(0xb4)]&&(_0x1190f2[_0xf5d757(0x189)]=parseInt(_0x1190f2[_0xf5d757(0x189)])+parseInt(_0x19b338[_0xf5d757(0x17f)]),_0x3861a5++);});_0x3861a5=='0'&&(_0x518b40[_0x5ee5a2(0xf2)]=_0x518b40[_0x5ee5a2(0xf2)][_0x5ee5a2(0x10f)]({'product_name':_0x19b338['product_name'],'product_stock':_0x19b338[_0x5ee5a2(0x17f)],'primary_code':_0x19b338['primary_code'],'secondary_code':_0x19b338[_0x5ee5a2(0x1ad)],'product_code':_0x19b338[_0x5ee5a2(0x110)],'bay':_0x19b338[_0x5ee5a2(0x161)],'batch_code':_0x19b338[_0x5ee5a2(0xb4)],'maxPerUnit':_0x19b338[_0x5ee5a2(0xa0)],'production_date':_0x19b338[_0x5ee5a2(0x14c)],'expiry_date':_0x19b338[_0x5ee5a2(0xf3)],'secondary_unit':_0x19b338['secondary_unit'],'unit':_0x19b338[_0x5ee5a2(0xba)],'maxProducts':_0x19b338[_0x5ee5a2(0x83)]}));}),await _0x518b40[_0x5bdde5(0xab)](),console[_0x5bdde5(0x124)](_0x3c137f[_0x5bdde5(0x106)]);const _0x4832a1=new c_payment_data({'invoice':_0x67b609,'customer':_0x3c137f[_0x5bdde5(0x106)][_0x5bdde5(0xec)],'reason':_0x5bdde5(0x18e)});await _0x4832a1[_0x5bdde5(0xab)]();const _0x4cbcb3=await master_shop[_0x5bdde5(0x97)]();console[_0x5bdde5(0x124)](_0x5bdde5(0x1b4),_0x4cbcb3[0x0][_0x5bdde5(0x175)]);const _0x4fca64=await email_settings['findOne'](),_0x195f99=await customer[_0x5bdde5(0x141)]({'name':_0x3c137f[_0x5bdde5(0x106)]['customer']});console['log'](_0x5bdde5(0xe1),_0x195f99);_0x4cbcb3[0x0][_0x5bdde5(0xf9)]==0x1?(right_currency=_0x4cbcb3[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4cbcb3[0x0]['currency']);var _0x2ef16a=_0x163042,_0x44155d=_0x353199,_0x39c13a='',_0x5dfea8;for(_0x5dfea8 in _0x2ef16a){_0x39c13a+=_0x5bdde5(0x12b)+_0x5bdde5(0x143)+_0x2ef16a[_0x5dfea8]+_0x5bdde5(0x12d)+_0x5bdde5(0x143)+_0x44155d[_0x5dfea8]+'</td>'+_0x5bdde5(0x9c);}console[_0x5bdde5(0x124)](_0x5bdde5(0x148),_0x39c13a);let _0x478ced=nodemailer['createTransport']({'service':_0x5bdde5(0x6d),'auth':{'user':_0x4fca64[_0x5bdde5(0x184)],'pass':_0x4fca64[_0x5bdde5(0x9a)]}}),_0x5e3f7e={'from':_0x4fca64[_0x5bdde5(0x184)],'to':_0x195f99[_0x5bdde5(0x184)],'subject':_0x5bdde5(0xb7),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x4cbcb3[0x0]['image'],'cid':_0x5bdde5(0x1b6)}],'html':_0x5bdde5(0xc6)+_0x5bdde5(0x8c)+_0x5bdde5(0x135)+_0x5bdde5(0x133)+_0x5bdde5(0x192)+'<div>'+_0x5bdde5(0x12e)+_0x5bdde5(0x1b1)+_0x5bdde5(0x133)+'<h2>\x20'+_0x4cbcb3[0x0][_0x5bdde5(0x11b)]+_0x5bdde5(0x18a)+_0x5bdde5(0x1b1)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x5bdde5(0x133)+_0x5bdde5(0xf7)+_0x5bdde5(0xe5)+_0x67b609+'\x20'+_0x5bdde5(0xfd)+'\x20Order\x20Date\x20:\x20'+_0x5cf1ec+'\x20'+_0x5bdde5(0x145)+_0x5bdde5(0x171)+_0x5bdde5(0x1b1)+_0x5bdde5(0x10b)+_0x5bdde5(0x120)+_0x5bdde5(0x12b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5bdde5(0x8b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x5bdde5(0x9e)+_0x5bdde5(0x9c)+_0x5bdde5(0x1b3)+_0x5bdde5(0x15e)+'\x20'+_0x39c13a+'\x20'+_0x5bdde5(0x149)+'</table>'+_0x5bdde5(0x133)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x4cbcb3[0x0][_0x5bdde5(0x11b)]+_0x5bdde5(0x171)+_0x5bdde5(0x1b1)+'</div>'+'</body></html>'};_0x478ced[_0x5bdde5(0xcd)](_0x5e3f7e,function(_0x40c7ef,_0x35bfc6){var _0xc49356=_0x5bdde5;_0x40c7ef?(console[_0xc49356(0x124)](_0x40c7ef),console[_0xc49356(0x124)](_0xc49356(0xbd))):console['log'](_0xc49356(0x185));}),_0x3c137f['flash'](_0x5bdde5(0x18c),_0x5bdde5(0xad)),_0x583dc0[_0x5bdde5(0xdb)](_0x5bdde5(0xb3));}catch(_0x2b9a1d){console[_0x5bdde5(0x124)](_0x2b9a1d),_0x583dc0['status'](0xc8)[_0x5bdde5(0x18d)]({'message1':_0x2b9a1d[_0x5bdde5(0x82)]});}}}),router['get'](a0_0x542edf(0x7a),auth,async(_0x218f05,_0x3ef732)=>{var _0x133ec1=a0_0x542edf;try{const {username:_0x22d1ef,email:_0x54c200,role:_0x2f4511}=_0x218f05['user'],_0x237563=_0x218f05[_0x133ec1(0xe2)],_0x34318c=await profile['findOne']({'email':_0x237563[_0x133ec1(0x184)]}),_0x95894a=await master_shop['find']();console[_0x133ec1(0x124)](_0x133ec1(0x85),_0x95894a);const _0x3d570d=_0x218f05[_0x133ec1(0x168)]['id'],_0x2fec99=await sales[_0x133ec1(0x11d)](_0x3d570d);console[_0x133ec1(0x124)](_0x133ec1(0xc5),_0x2fec99);if(_0x95894a[0x0][_0x133ec1(0xa5)]==_0x133ec1(0x139))var _0x112940=users['English'];else{if(_0x95894a[0x0][_0x133ec1(0xa5)]==_0x133ec1(0x131))var _0x112940=users['Hindi'];else{if(_0x95894a[0x0][_0x133ec1(0xa5)]==_0x133ec1(0xb9))var _0x112940=users[_0x133ec1(0xb9)];else{if(_0x95894a[0x0]['language']==_0x133ec1(0x7f))var _0x112940=users[_0x133ec1(0x7f)];else{if(_0x95894a[0x0][_0x133ec1(0xa5)]==_0x133ec1(0x1a3))var _0x112940=users[_0x133ec1(0x1a3)];else{if(_0x95894a[0x0]['language']==_0x133ec1(0x15b))var _0x112940=users['Portuguese'];else{if(_0x95894a[0x0][_0x133ec1(0xa5)]==_0x133ec1(0x16f))var _0x112940=users['Chinese'];else{if(_0x95894a[0x0][_0x133ec1(0xa5)]==_0x133ec1(0x19f))var _0x112940=users[_0x133ec1(0x190)];}}}}}}}_0x3ef732[_0x133ec1(0x156)](_0x133ec1(0x137),{'success':_0x218f05[_0x133ec1(0x78)](_0x133ec1(0x18c)),'errors':_0x218f05['flash']('errors'),'role':_0x237563,'profile':_0x34318c,'alldata':_0x2fec99,'master_shop':_0x95894a,'language':_0x112940});}catch(_0x405178){console[_0x133ec1(0x124)](_0x405178);}}),router[a0_0x542edf(0xee)]('/barcode_scanner',async(_0xd3049,_0xb419d)=>{var _0x13bb7a=a0_0x542edf;const {product_code:_0x1ee531,warehouse_name:_0x28fb98,rooms_data:_0x25c1b2,Roomslist:_0x1b4884,sales_category:_0x5f36e0}=_0xd3049[_0x13bb7a(0x106)],_0x500a69=_0x1b4884['split'](','),_0x3a1844=[];async function _0x29293c(_0x12d28c){var _0x541af2=_0x13bb7a;const _0x17b7bf=await warehouse[_0x541af2(0xef)]([{'$match':{'name':_0x28fb98,'room':_0x12d28c}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1ee531}},{'$group':{'_id':_0x541af2(0x144),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x541af2(0xff)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x541af2(0xd6)},'level':{'$first':_0x541af2(0x16b)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x541af2(0x86)},'pallet':{'$first':_0x541af2(0xcf)},'unit':{'$first':_0x541af2(0xa3)},'secondary_unit':{'$first':_0x541af2(0x1b2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x541af2(0x1a1)},'production_date':{'$first':_0x541af2(0x92)},'maxPerUnit':{'$first':_0x541af2(0x119)},'batch_code':{'$first':_0x541af2(0x13e)},'product_cat':{'$first':_0x541af2(0xe9)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x541af2(0x15d)},'invoice':{'$first':_0x541af2(0xc3)},'uuid':{'$first':_0x541af2(0x1ac)},'gross_price':{'$first':_0x541af2(0x7b)},'sales_category':{'$first':_0x541af2(0x16e)}}}]),_0x26ceea=await warehouse[_0x541af2(0xef)]([{'$match':{'name':_0x28fb98,'room':_0x12d28c}},{'$unwind':_0x541af2(0x6e)},{'$match':{'product_details.secondary_code':_0x1ee531}},{'$group':{'_id':_0x541af2(0x144),'name':{'$first':_0x541af2(0xb2)},'product_stock':{'$first':_0x541af2(0xff)},'primary_code':{'$first':_0x541af2(0xe4)},'secondary_code':{'$first':_0x541af2(0x176)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x541af2(0xd8)},'isle':{'$first':_0x541af2(0xc9)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x541af2(0xa3)},'secondary_unit':{'$first':_0x541af2(0x1b2)},'storage':{'$first':_0x541af2(0xf6)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x541af2(0x92)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x541af2(0x13e)},'product_cat':{'$first':_0x541af2(0xe9)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x541af2(0xc3)},'uuid':{'$first':_0x541af2(0x1ac)},'gross_price':{'$first':_0x541af2(0x7b)},'sales_category':{'$first':_0x541af2(0x16e)}}}]);if(_0x17b7bf[_0x541af2(0x84)]>0x0)_0x3a1844[_0x541af2(0x130)](_0x17b7bf);else _0x26ceea[_0x541af2(0x84)]>0x0&&_0x3a1844[_0x541af2(0x130)](_0x26ceea);}const _0x26ad1f=_0x500a69[_0x13bb7a(0x116)](_0x39543a=>_0x29293c(_0x39543a));await Promise[_0x13bb7a(0x8e)](_0x26ad1f),_0xb419d[_0x13bb7a(0x18d)](_0x3a1844);}),router['post'](a0_0x542edf(0x15f),async(_0x37b637,_0x1cfcaa)=>{var _0x2ab5d5=a0_0x542edf;const {product_code:_0x47bc09,warehouse_name:_0x5c64a,rooms_data:_0x4396cd,Roomslist:_0x1fa5ba,sales_category:_0x5d8c1f}=_0x37b637[_0x2ab5d5(0x106)],_0x8f6968=_0x1fa5ba[_0x2ab5d5(0x180)](','),_0x58fc70=[];async function _0x15acfe(_0x5ed4f2){var _0x17c887=_0x2ab5d5;const _0x58705f=await warehouse[_0x17c887(0xef)]([{'$match':{'name':_0x5c64a,'room':_0x5ed4f2}},{'$unwind':_0x17c887(0x6e)},{'$match':{'product_details.primary_code':_0x47bc09,'product_details.sales_category':_0x5d8c1f,'product_details.type_products':_0x17c887(0x124)}},{'$group':{'_id':_0x17c887(0x144),'name':{'$first':_0x17c887(0xb2)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x17c887(0xe4)},'secondary_code':{'$first':_0x17c887(0x176)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.level'},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x17c887(0x86)},'pallet':{'$first':_0x17c887(0xcf)},'unit':{'$first':_0x17c887(0xa3)},'secondary_unit':{'$first':_0x17c887(0x1b2)},'storage':{'$first':_0x17c887(0xf6)},'rack':{'$first':_0x17c887(0x7e)},'expiry_date':{'$first':_0x17c887(0x1a1)},'production_date':{'$first':_0x17c887(0x92)},'maxPerUnit':{'$first':_0x17c887(0x119)},'batch_code':{'$first':_0x17c887(0x13e)},'product_cat':{'$first':_0x17c887(0xe9)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x17c887(0x15d)},'invoice':{'$first':_0x17c887(0xc3)},'uuid':{'$first':_0x17c887(0x1ac)},'gross_price':{'$first':_0x17c887(0x7b)},'sales_category':{'$first':'$product_details.sales_category'},'type_products':{'$first':'$product_details.type_products'}}}]);console['log'](_0x17c887(0x124)+_0x17c887(0x16a)+_0x47bc09+_0x17c887(0x16a)+_0x5d8c1f);const _0x511e19=await warehouse[_0x17c887(0xef)]([{'$match':{'name':_0x5c64a,'room':_0x5ed4f2}},{'$unwind':_0x17c887(0x6e)},{'$match':{'product_details.secondary_code':_0x47bc09,'product_details.sales_category':_0x5d8c1f,'product_details.type_products':_0x17c887(0x124)}},{'$group':{'_id':_0x17c887(0x144),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x17c887(0xff)},'primary_code':{'$first':_0x17c887(0xe4)},'secondary_code':{'$first':_0x17c887(0x176)},'product_code':{'$first':_0x17c887(0xd6)},'level':{'$first':_0x17c887(0xd8)},'isle':{'$first':_0x17c887(0xc9)},'type':{'$first':_0x17c887(0x86)},'pallet':{'$first':_0x17c887(0xcf)},'unit':{'$first':_0x17c887(0xa3)},'secondary_unit':{'$first':_0x17c887(0x1b2)},'storage':{'$first':_0x17c887(0xf6)},'rack':{'$first':_0x17c887(0x7e)},'expiry_date':{'$first':_0x17c887(0x1a1)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x17c887(0x119)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x17c887(0xe9)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x17c887(0x15d)},'invoice':{'$first':_0x17c887(0xc3)},'uuid':{'$first':_0x17c887(0x1ac)},'gross_price':{'$first':_0x17c887(0x7b)},'sales_category':{'$first':_0x17c887(0x16e)},'type_products':{'$first':_0x17c887(0x195)}}}]);if(_0x58705f[_0x17c887(0x84)]>0x0)_0x58fc70['push'](_0x58705f);else _0x511e19[_0x17c887(0x84)]>0x0&&_0x58fc70[_0x17c887(0x130)](_0x511e19);}const _0x43ff6a=_0x8f6968['map'](_0x48b114=>_0x15acfe(_0x48b114));await Promise[_0x2ab5d5(0x8e)](_0x43ff6a),_0x1cfcaa[_0x2ab5d5(0x18d)](_0x58fc70);}),router[a0_0x542edf(0xee)](a0_0x542edf(0xd4),async(_0xa87ce5,_0x49a30f)=>{var _0x402bf1=a0_0x542edf;try{const {prduct_code:_0x3ba847,warehouse_data:_0x7bf5ca,qty_req:_0x52fdf3}=_0xa87ce5[_0x402bf1(0x106)];let _0xe854c3=_0x3ba847[_0x402bf1(0x180)]('~'),_0x2e3e81=_0x52fdf3['split']('~'),_0x42d3d9=[],_0x3ab21c=0x0;for(let _0x441369=0x0;_0x441369<=_0xe854c3['length']-0x1;_0x441369++){const _0x122685=_0xe854c3[_0x441369],_0x129772=_0x2e3e81[_0x441369],_0x65b9bb=await warehouse[_0x402bf1(0xef)]([{'$match':{'name':_0x7bf5ca}},{'$unwind':_0x402bf1(0x6e)},{'$match':{'product_details.product_code':_0x122685,'product_details.isAvailable':'true','product_details.isUsed':_0x402bf1(0x1a6)}},{'$sort':{'product_details.date_received':0x1,'product_details.level':-0x1,'product_details.bay':-0x1}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x402bf1(0xb2)},'product_stock':{'$first':_0x402bf1(0xff)},'primary_code':{'$first':_0x402bf1(0xe4)},'secondary_code':{'$first':_0x402bf1(0x176)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x402bf1(0x16b)},'bay':{'$first':_0x402bf1(0xd8)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x402bf1(0xcf)},'unit':{'$first':_0x402bf1(0xa3)},'secondary_unit':{'$first':_0x402bf1(0x1b2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x402bf1(0x7e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x402bf1(0x13e)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x402bf1(0x15d)},'invoice':{'$first':_0x402bf1(0xc3)},'uuid':{'$first':_0x402bf1(0x1ac)},'gross_price':{'$first':_0x402bf1(0x7b)},'sales_category':{'$first':'$product_details.sales_category'},'date_received':{'$first':_0x402bf1(0x181)},'warehouse_id':{'$first':_0x402bf1(0x72)}}}]),_0x2d9fbe=_0x65b9bb[_0x402bf1(0xc1)]((_0x17c303,_0x371af1)=>new Date(_0x17c303['date_received'])-new Date(_0x371af1[_0x402bf1(0x186)]));let _0x21b5b8=_0x129772;for(let _0x49071b=0x0;_0x49071b<=_0x2d9fbe[_0x402bf1(0x84)]-0x1&&_0x21b5b8>0x0;_0x49071b++){const _0xa63ebc=_0x2d9fbe[_0x49071b];if(_0xa63ebc[_0x402bf1(0x110)]==_0x122685){_0x42d3d9[_0x3ab21c]={};const _0x55edff=parseInt(_0xa63ebc[_0x402bf1(0x189)]),_0x4566d0=0x0;let _0x4d8541=_0x55edff-_0x4566d0,_0x28c388=Math['min'](_0x21b5b8,_0x4d8541);console[_0x402bf1(0x124)]('Distributing\x20'+_0x28c388+_0x402bf1(0x157)+_0x7bf5ca+_0x402bf1(0x1b9)+_0xa63ebc['roomNamed']+',\x20Location:\x20'+(_0xa63ebc['level']+_0xa63ebc['bay'])+_0x402bf1(0x15a)+_0xa63ebc[_0x402bf1(0x186)]+_0x402bf1(0xc8)+_0xa63ebc[_0x402bf1(0x178)]),_0x42d3d9[_0x3ab21c][_0x402bf1(0x126)]=_0xa63ebc['warehouse_id']+'~'+_0xa63ebc[_0x402bf1(0x118)]+'~'+_0x28c388,_0x42d3d9[_0x3ab21c]['product_name']=_0xa63ebc[_0x402bf1(0x178)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x110)]=_0xa63ebc['product_code'],_0x42d3d9[_0x3ab21c][_0x402bf1(0xac)]=_0xa63ebc[_0x402bf1(0xac)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x166)]=_0xa63ebc['date_recieved'],_0x42d3d9[_0x3ab21c][_0x402bf1(0x17d)]=_0xa63ebc[_0x402bf1(0x17d)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x199)]=_0xa63ebc[_0x402bf1(0x199)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x17e)]=_0x28c388,_0x42d3d9[_0x3ab21c][_0x402bf1(0xba)]=_0xa63ebc[_0x402bf1(0xba)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xbc)]=_0xa63ebc[_0x402bf1(0xbc)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xa7)]=_0xa63ebc[_0x402bf1(0xa7)],_0x42d3d9[_0x3ab21c]['secondary_code']=_0xa63ebc['secondary_code'],_0x42d3d9[_0x3ab21c][_0x402bf1(0xe0)]=_0xa63ebc['maxStocks'],_0x42d3d9[_0x3ab21c][_0x402bf1(0xb4)]=_0xa63ebc[_0x402bf1(0xb4)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xf3)]=_0xa63ebc['expiry_date'],_0x42d3d9[_0x3ab21c][_0x402bf1(0x14c)]=_0xa63ebc[_0x402bf1(0x14c)],_0x42d3d9[_0x3ab21c]['maxperunit']=_0xa63ebc[_0x402bf1(0xd7)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x18b)]=_0xa63ebc[_0x402bf1(0x18b)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xce)]=_0xa63ebc[_0x402bf1(0xce)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x10d)]=_0xa63ebc[_0x402bf1(0x10d)],_0x42d3d9[_0x3ab21c]['room_name']=_0xa63ebc[_0x402bf1(0x77)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xaf)]=_0xa63ebc['level'],_0x42d3d9[_0x3ab21c][_0x402bf1(0x161)]=_0xa63ebc[_0x402bf1(0x161)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x1ba)]='true',console[_0x402bf1(0x124)]('1',_0x3ab21c),_0x21b5b8-=_0x28c388,_0x3ab21c++;if(_0x21b5b8<=0x0)break;}}if(_0x21b5b8>0x0){var _0x140eba=await product[_0x402bf1(0x141)]({'product_code':_0x122685});console['log']('2',_0x3ab21c),_0x42d3d9[_0x3ab21c]={},_0x42d3d9[_0x3ab21c][_0x402bf1(0x12a)]=_0x140eba[_0x402bf1(0x178)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x110)]=_0x122685,_0x42d3d9[_0x3ab21c][_0x402bf1(0xac)]=_0x140eba[_0x402bf1(0x118)]['valueOf'](),_0x42d3d9[_0x3ab21c][_0x402bf1(0x17e)]=_0x21b5b8,_0x42d3d9[_0x3ab21c][_0x402bf1(0x9d)]=_0x140eba[_0x402bf1(0xba)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xbc)]=_0x140eba[_0x402bf1(0x11c)],_0x42d3d9[_0x3ab21c][_0x402bf1(0xa7)]=_0x140eba['primary_code'],_0x42d3d9[_0x3ab21c]['secondary_code']=_0x140eba['secondary_code'],_0x42d3d9[_0x3ab21c][_0x402bf1(0xe0)]=_0x140eba['maxStocks'],_0x42d3d9[_0x3ab21c][_0x402bf1(0xd7)]=_0x140eba[_0x402bf1(0xf0)],_0x42d3d9[_0x3ab21c]['gross_price']=_0x140eba[_0x402bf1(0x10d)],_0x42d3d9[_0x3ab21c][_0x402bf1(0x1ba)]=_0x402bf1(0x1a6),console[_0x402bf1(0x124)]('There\x20is\x20'+_0x21b5b8+_0x402bf1(0xe6)+_0x3ab21c+_0x402bf1(0x16a)+_0x122685),_0x3ab21c++;}}_0x49a30f[_0x402bf1(0x18d)](_0x42d3d9);}catch(_0x3b0d6b){console[_0x402bf1(0x124)](_0x3b0d6b);}}),router[a0_0x542edf(0xee)]('/barcode_scanner_auto',async(_0x32ce80,_0x516740)=>{var _0x52ec09=a0_0x542edf;const {product_code:_0x564b8a}=_0x32ce80[_0x52ec09(0x106)];var _0x4ff50e;const _0x29697d=await product[_0x52ec09(0xef)]([{'$match':{'primary_code':_0x564b8a}},{'$group':{'_id':_0x52ec09(0x72),'name':{'$first':'$name'},'category':{'$first':_0x52ec09(0x1a4)},'brand':{'$first':_0x52ec09(0x1a5)},'unit':{'$first':_0x52ec09(0x90)},'alertquantity':{'$first':_0x52ec09(0x12c)},'product_code':{'$first':_0x52ec09(0x1ae)},'primary_code':{'$first':_0x52ec09(0x13c)},'secondary_code':{'$first':_0x52ec09(0x76)},'maxStocks':{'$first':_0x52ec09(0x13b)},'maxProdPerUnit':{'$first':_0x52ec09(0x17b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x52ec09(0x6f)},'gross_price':{'$first':_0x52ec09(0x193)},'sales_category':{'$first':_0x52ec09(0x80)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x3691a8=await product[_0x52ec09(0xef)]([{'$match':{'secondary_code':_0x564b8a}},{'$group':{'_id':_0x52ec09(0x72),'name':{'$first':_0x52ec09(0x99)},'category':{'$first':_0x52ec09(0x1a4)},'brand':{'$first':_0x52ec09(0x1a5)},'unit':{'$first':_0x52ec09(0x90)},'alertquantity':{'$first':_0x52ec09(0x12c)},'product_code':{'$first':_0x52ec09(0x1ae)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x52ec09(0x13b)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x52ec09(0x6f)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x29697d[_0x52ec09(0x84)]>0x0)_0x4ff50e=_0x29697d;else _0x3691a8[_0x52ec09(0x84)]>0x0&&(_0x4ff50e=_0x3691a8);_0x516740[_0x52ec09(0x18d)](_0x4ff50e);}),router['post']('/process/view',async(_0x1b8f78,_0x307f5b)=>{var _0x48900f=a0_0x542edf;try{const {group_id:_0xca11be,DRSI:_0x196a76,dateofreq:_0x50c14d,PO_number:_0x1f2e3e,date:_0x5afe6a,warehouse_name:_0x3d8f36,typevehicle:_0x57a2ff,deliverydate:_0x37790e,driver:_0x11f14c,plate:_0x4e8f5c,van:_0x1a0cbe,TSU:_0x1effbe,actual_delivery_date:_0x502d87,TFU:_0x44a30d,pull_out_date:_0x17dc91,sales:_0x3a4b54,Customer_data:_0x26f283,note:_0xb2e27}=_0x1b8f78[_0x48900f(0x106)],_0x411991=mongoose[_0x48900f(0xc7)][_0x48900f(0x115)];let _0x5503eb=[];const _0x4fce2b=new invoice_for_outgoing();await _0x4fce2b[_0x48900f(0xab)]();const _0x35d6e1='OUT-'+_0x4fce2b[_0x48900f(0x152)][_0x48900f(0x14d)]()[_0x48900f(0x113)](0x8,'0');if(typeof _0xca11be=='string'){let _0x342ed2=_0xca11be[_0x48900f(0x180)]('~');var _0x4029a9=_0x411991(_0x342ed2[0x0]),_0x32ca26=_0x411991(_0x342ed2[0x1]),_0x4a90c1=_0x342ed2[0x2];let _0x2c76ec=0x0;const _0x307ea0=await warehouse[_0x48900f(0xef)]([{'$match':{'_id':_0x4029a9}},{'$unwind':'$product_details'},{'$match':{'product_details._id':_0x32ca26}}]);await warehouse[_0x48900f(0xf5)]({'_id':_0x411991(_0x4029a9),'product_details._id':_0x411991(_0x32ca26)},{'$set':{'product_details.$.isUsed':_0x48900f(0x73)}}),_0x5503eb[_0x2c76ec]={};for(let _0x31ccd9=0x0;_0x31ccd9<=_0x307ea0[_0x48900f(0x84)]-0x1;_0x31ccd9++){const _0x1df6c8=_0x307ea0[_0x31ccd9];console[_0x48900f(0x124)](_0x1df6c8),_0x5503eb[_0x2c76ec][_0x48900f(0x17c)]=_0x1df6c8[_0x48900f(0x178)],_0x5503eb[_0x2c76ec]['product_id']=_0x1df6c8[_0x48900f(0xf2)]['product_id'],_0x5503eb[_0x2c76ec][_0x48900f(0x12a)]=_0x1df6c8[_0x48900f(0xf2)]['product_name'],_0x5503eb[_0x2c76ec]['product_code']=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x110)],_0x5503eb[_0x2c76ec][_0x48900f(0x189)]=_0x4a90c1,_0x5503eb[_0x2c76ec][_0x48900f(0x17e)]=_0x4a90c1,_0x5503eb[_0x2c76ec][_0x48900f(0xba)]=_0x1df6c8[_0x48900f(0xf2)]['unit'],_0x5503eb[_0x2c76ec][_0x48900f(0xbc)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xbc)],_0x5503eb[_0x2c76ec][_0x48900f(0xaf)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xaf)],_0x5503eb[_0x2c76ec][_0x48900f(0x161)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x161)],_0x5503eb[_0x2c76ec][_0x48900f(0xa7)]=_0x1df6c8['product_details'][_0x48900f(0xa7)],_0x5503eb[_0x2c76ec][_0x48900f(0x1ad)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x1ad)],_0x5503eb[_0x2c76ec][_0x48900f(0xe0)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xe0)],_0x5503eb[_0x2c76ec][_0x48900f(0xb4)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xb4)],_0x5503eb[_0x2c76ec][_0x48900f(0xf3)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xf3)],_0x5503eb[_0x2c76ec][_0x48900f(0x14c)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x14c)],_0x5503eb[_0x2c76ec]['maxperunit']=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xd7)],_0x5503eb[_0x2c76ec][_0x48900f(0x18b)]=_0x1df6c8['product_details']['product_cat'],_0x5503eb[_0x2c76ec]['room_name']=_0x1df6c8['room'],_0x5503eb[_0x2c76ec][_0x48900f(0xce)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0xce)],_0x5503eb[_0x2c76ec][_0x48900f(0x199)]=_0x1df6c8['product_details'][_0x48900f(0x199)],_0x5503eb[_0x2c76ec][_0x48900f(0x10d)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x10d)],_0x5503eb[_0x2c76ec][_0x48900f(0x17d)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x11e)],_0x5503eb[_0x2c76ec][_0x48900f(0x166)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x166)],_0x5503eb[_0x2c76ec][_0x48900f(0x173)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x11e)],_0x5503eb[_0x2c76ec][_0x48900f(0x74)]=_0x1df6c8[_0x48900f(0x118)]['valueOf'](),_0x5503eb[_0x2c76ec][_0x48900f(0xca)]=_0x1df6c8['product_details'][_0x48900f(0x118)][_0x48900f(0x125)](),_0x5503eb[_0x2c76ec][_0x48900f(0x81)]=_0x48900f(0x172),_0x5503eb[_0x2c76ec][_0x48900f(0xb6)]=_0x1df6c8[_0x48900f(0xf2)][_0x48900f(0x11e)];}_0x5503eb[_0x2c76ec][_0x48900f(0x13f)]=_0x35d6e1;}else for(let _0x100c14=0x0;_0x100c14<=_0xca11be[_0x48900f(0x84)]-0x1;_0x100c14++){const _0x7b8a18=_0xca11be[_0x100c14];let _0xf45dab=_0x7b8a18[_0x48900f(0x180)]('~');console[_0x48900f(0x124)](_0xf45dab);var _0x4029a9=_0x411991(_0xf45dab[0x0]),_0x32ca26=_0x411991(_0xf45dab[0x1]),_0x4a90c1=_0xf45dab[0x2];const _0x104187=await warehouse[_0x48900f(0xef)]([{'$match':{'_id':_0x4029a9}},{'$unwind':_0x48900f(0x6e)},{'$match':{'product_details._id':_0x32ca26}}]);await warehouse[_0x48900f(0xf5)]({'_id':_0x411991(_0x4029a9),'product_details._id':_0x411991(_0x32ca26)},{'$set':{'product_details.$.isUsed':_0x48900f(0x73)}}),_0x5503eb[_0x100c14]={};for(let _0x5ea250=0x0;_0x5ea250<=_0x104187[_0x48900f(0x84)]-0x1;_0x5ea250++){const _0x271b1b=_0x104187[_0x5ea250];_0x5503eb[_0x100c14]['warehouse']=_0x271b1b[_0x48900f(0x178)],_0x5503eb[_0x100c14]['product_id']=_0x271b1b['product_details'][_0x48900f(0xac)],_0x5503eb[_0x100c14][_0x48900f(0x12a)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x12a)],_0x5503eb[_0x100c14][_0x48900f(0x110)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x110)],_0x5503eb[_0x100c14]['product_stock']=_0x4a90c1,_0x5503eb[_0x100c14][_0x48900f(0x17e)]=_0x4a90c1,_0x5503eb[_0x100c14][_0x48900f(0xba)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0xba)],_0x5503eb[_0x100c14][_0x48900f(0xbc)]=_0x271b1b[_0x48900f(0xf2)]['secondary_unit'],_0x5503eb[_0x100c14][_0x48900f(0xaf)]=_0x271b1b['product_details'][_0x48900f(0xaf)],_0x5503eb[_0x100c14]['bay']=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x161)],_0x5503eb[_0x100c14][_0x48900f(0xa7)]=_0x271b1b['product_details'][_0x48900f(0xa7)],_0x5503eb[_0x100c14][_0x48900f(0x1ad)]=_0x271b1b[_0x48900f(0xf2)]['secondary_code'],_0x5503eb[_0x100c14][_0x48900f(0xe0)]=_0x271b1b['product_details'][_0x48900f(0xe0)],_0x5503eb[_0x100c14][_0x48900f(0xb4)]=_0x271b1b['product_details'][_0x48900f(0xb4)],_0x5503eb[_0x100c14]['expiry_date']=_0x271b1b[_0x48900f(0xf2)]['expiry_date'],_0x5503eb[_0x100c14][_0x48900f(0x14c)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x14c)],_0x5503eb[_0x100c14][_0x48900f(0xd7)]=_0x271b1b[_0x48900f(0xf2)]['maxperunit'],_0x5503eb[_0x100c14]['product_cat']=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x18b)],_0x5503eb[_0x100c14][_0x48900f(0x163)]=_0x271b1b[_0x48900f(0xfc)],_0x5503eb[_0x100c14]['invoice']=_0x271b1b[_0x48900f(0xf2)]['invoice'],_0x5503eb[_0x100c14][_0x48900f(0x199)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x199)],_0x5503eb[_0x100c14][_0x48900f(0x10d)]=_0x271b1b['product_details'][_0x48900f(0x10d)],_0x5503eb[_0x100c14]['sales_category']=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x11e)],_0x5503eb[_0x100c14][_0x48900f(0x166)]=_0x271b1b['product_details'][_0x48900f(0x166)],_0x5503eb[_0x100c14][_0x48900f(0x173)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x11e)],_0x5503eb[_0x100c14]['warehouse_id']=_0x271b1b[_0x48900f(0x118)][_0x48900f(0x125)](),_0x5503eb[_0x100c14][_0x48900f(0xca)]=_0x271b1b[_0x48900f(0xf2)][_0x48900f(0x118)][_0x48900f(0x125)](),_0x5503eb[_0x100c14][_0x48900f(0x81)]=_0x48900f(0x172),_0x5503eb[_0x100c14][_0x48900f(0xb6)]=_0x271b1b[_0x48900f(0xf2)]['sales'];}_0x5503eb[_0x100c14][_0x48900f(0x13f)]=_0x35d6e1;}for(let _0x2c3765=0x0;_0x2c3765<=_0x5503eb[_0x48900f(0x84)]-0x1;_0x2c3765++){const _0x2cfe22=_0x5503eb[_0x2c3765],_0xde56e1=new warehouse_temporary(_0x2cfe22);await _0xde56e1[_0x48900f(0xab)]();}const _0x53e7a2=new sales_finished({'invoice':_0x35d6e1,'sales_data':_0x3a4b54,'customer':_0x26f283,'date':_0x5afe6a,'warehouse_name':_0x3d8f36,'sale_product':_0x5503eb,'note':_0xb2e27,'finalize':_0x48900f(0x1ab),'dateofreq':_0x50c14d,'PO_number':_0x1f2e3e,'typevehicle':_0x57a2ff,'deliverydate':_0x37790e,'driver':_0x11f14c,'plate':_0x4e8f5c,'van':_0x1a0cbe,'DRSI':_0x196a76,'TSU':_0x1effbe,'TFU':_0x44a30d,'pullout_date':_0x17dc91,'actualdelivery_date':_0x502d87,'typeOfProducts':_0x48900f(0x134)}),_0x1126b4=await _0x53e7a2[_0x48900f(0xab)]();_0x1b8f78[_0x48900f(0x78)]('success','Sales\x20Add\x20successfully'),_0x307f5b[_0x48900f(0xdb)](_0x48900f(0x8a)+_0x1126b4[_0x48900f(0x118)]);}catch(_0x12e798){console[_0x48900f(0x124)](_0x12e798);}}),module[a0_0x542edf(0xa6)]=router;