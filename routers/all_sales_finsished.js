var a0_0x3468ff=a0_0x4ef8;(function(_0x466c9a,_0x3407b5){var _0x3575ce=a0_0x4ef8,_0x3a9a7b=_0x466c9a();while(!![]){try{var _0x221985=parseInt(_0x3575ce(0x2c5))/0x1*(-parseInt(_0x3575ce(0x2cb))/0x2)+-parseInt(_0x3575ce(0x222))/0x3+parseInt(_0x3575ce(0x1da))/0x4*(-parseInt(_0x3575ce(0x1d6))/0x5)+-parseInt(_0x3575ce(0x1c3))/0x6*(parseInt(_0x3575ce(0x1fe))/0x7)+-parseInt(_0x3575ce(0x286))/0x8+-parseInt(_0x3575ce(0x1ce))/0x9*(-parseInt(_0x3575ce(0x1f5))/0xa)+parseInt(_0x3575ce(0x2d1))/0xb*(parseInt(_0x3575ce(0x1cb))/0xc);if(_0x221985===_0x3407b5)break;else _0x3a9a7b['push'](_0x3a9a7b['shift']());}catch(_0x43ae21){_0x3a9a7b['push'](_0x3a9a7b['shift']());}}}(a0_0x73ba,0xbf406));const express=require(a0_0x3468ff(0x20e)),app=express(),router=express[a0_0x3468ff(0x2aa)](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require(a0_0x3468ff(0x281)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3468ff(0x1ae)),users=require('../public/language/languages.json'),mongoose=require(a0_0x3468ff(0x1d0));function a0_0x73ba(){var _0x431830=['Ambient','render','note','filter','$finalize','express','then','invoice','getMonth','<!DOCTYPE\x20html>','primary_code_QA','/preview/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_unit_QA','_id','Spanish','group_ids','max','body','padStart','room_name',',\x20room:\x20','data_type','redirect','product_data','1735947YtCIxq','$name','user','OUT-','$primary_code','unit','/invoice/:id','Received\x20Payment\x20For\x20Sale','currency','purchases_data','master','</div>','stocks_QA','ObjectId','language','$product_details.secondary_code','sale_product','product_code','$customers_docs','German','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','\x20<>\x20','</body></html>','RoomAssigned','finalize','message','uuid','</tbody>','Enclosed','batch_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','barcode\x20user_id','findOne','split','false','floor','prod_code','primary_code','sales_category','/barcode_scanner_auto_data','secondary_code','currency_placement','maxperunit','abs','forEach','Finished\x20Goods','\x20Order\x20Date\x20:\x20','sales_id','getFullYear','product_name_QA1','$product_details.product_code','$product_details.invoice','product_id','received_amount','</tr>','/barcode/:id','$product_details.maxProducts','$product_details.rack','</h5>','/view','amount','/view/:id','maxProducts','$product_details.bin','\x20&&\x20','French','Hindi','$customer','warehouse_id','Logo.png','agent_id','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20','Arabic','/barcode_scanner_auto','all','all_sales_finished','$invoice','maxProducts_QA','production_date_QA','quantity','$maxProdPerUnit','$brand','second_unit','out','slice','$product_details.maxPerUnit','There\x20is\x20','$sale_product.bin','<html><head><title></title>','$sale_product.bay','$sale_product.type','Error\x20Occurs','product_list','prod_invoice','\x20Name:\x20','../models/all_models','warehouse_id_detl','/all_sales_finished/preview/','$product_details.expiry_date','sendMail','4024720ONnmAm','Enabled','room','customer','return_qty_QA','date_recieved','edit_sales_finished_view','flash','password','Types','\x20Order\x20Number\x20:\x20','barcode\x20Product\x20master','Portuguese\x20(BR)','Portuguese','product_stock','$warehouse_name','push','bay','level','product_date','<h2>\x20','<h5\x20style=\x22text-align:\x20left;\x22>','<div>','\x20Date:\x20','email','Sale\x20Return\x20Mail','$product_details.level','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Chinese','\x20</h2>','logo','toString','valueOf','secondary_unit','length','$product_details.floorlevel','Router','$gross_price','$product','Sales\x20Add\x20successfully','Sale\x20Return','foreach\x20newproduct','<tbody\x20style=\x22text-align:\x20center;\x22>','Return\x20Rooms','expiry_date_QA','</head><body>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$_id','here','gmail','catch','$product_details.sales_category','add_sales_finished','/upload/','/view/add_sales','suppliers','</td>','sales_quantity_QA','success','return_data','site_title','$maxStocks','$product_details.uuid','3MMrcpZ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','getDate','edit_sales_finished','sales_quantity','$product_details.bay','930094MNEegc','sale_qty','all_sales_barcode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Return\x20Goods','find','71269YYMKlP','maxPerUnit_QA','product_name','False','product','LOG-OUT-','$product_details.product_cat','warehouse_name','image','random','$product_details.storage','$product_code','staff','sales','OUTF-','$product_details.product_name','params','product_code_QA','product_cat','warehouse','string','$product_details.primary_code','<strong>\x20Regards\x20</strong>','Arabic\x20(ae)','/view/add_sales_logs','Quality\x20Inspection','$product_details.type','back','standard_unit','prod_cat','/view_log','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stock_data','/barcode_scanner','$category','save','sort','$product_details.date_recieved','primary_unit','date_data','status','add_sales_finished_logs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Sales\x20Update\x20successfully','nodemailer','$product_details.room_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction',',\x20Location:\x20','createTransport','return_qty','$product_details.gross_price','$secondary_code','$sale_product.floorlevel','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','match','$secondary_unit','$date','$alertquantity','get','outgoing_invoice','Distributing\x20','$room','own','$note','sales\x20item\x20return\x20successfull','354642fffMVu','\x20units\x20to\x20warehouse:\x20','return_sale_finished','$product_details.product_stock','$product_details.secondary_unit','all_sales_finished_logs','post','id_transaction_from','7248ieZpSP','</thead>','errors','279KVEZIw','level2','mongoose','date','carton','true','/../public','$product_details','25MDbxpT','/all_sales_finished/view','batch_code_QA','invoice_init','1013576zpSIWh','$return_data','$sale_product','max_per_unit','<tr>','$product_details.production_date','$sale_product.quantity','due_amount','/barcode_scanner_logs','logs','name','$product_details.type_products','Email\x20sent\x20successfully','date_received','outgoiug_inv','role','English','True','maxPerUnit','map','maxStocks','$product_details._id','production_date','</span>','/view/return_sales/:id','json','gross_price','388700qLCvnr','$sales_category','adjust_qty','findById','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_details','for_categorize','maxProdPerUnit','updateOne','70QIyKFI','$unit','expiry_date','log','concat','stock','aggregate','$product_details.unit','English\x20(US)','undefined','<span\x20style=\x22float:\x20right;\x22>'];a0_0x73ba=function(){return _0x431830;};return a0_0x73ba();}router[a0_0x3468ff(0x1bc)](a0_0x3468ff(0x25d),auth,async(_0x3e4a78,_0x1c5125)=>{var _0x38f567=a0_0x3468ff;try{const {username:_0x41a8fb,email:_0xbcda83,role:_0x5e4765}=_0x3e4a78[_0x38f567(0x224)],_0x2158dd=_0x3e4a78['user'],_0x94e506=await profile['findOne']({'email':_0x2158dd[_0x38f567(0x29e)]}),_0x59d970=await master_shop[_0x38f567(0x2d0)]();let _0xdc65f3;if(_0x2158dd[_0x38f567(0x1e9)]==_0x38f567(0x2dd)){const _0x3c9b8b=await staff['findOne']({'email':_0x2158dd[_0x38f567(0x29e)]});_0xdc65f3=await sales_finished[_0x38f567(0x204)]([{'$match':{'typeOfProducts':_0x38f567(0x1c0)}},{'$unwind':_0x38f567(0x1dc)},{'$group':{'_id':'$_id','invoice':{'$first':_0x38f567(0x26e)},'customers':{'$first':'$customer'},'date':{'$first':_0x38f567(0x1ba)},'warehouse_name':{'$first':_0x38f567(0x295)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x38f567(0x1db)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x38f567(0x1e0)},'level':{'$addToSet':_0x38f567(0x27b)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x38f567(0x27c)},'pallet':{'$addToSet':_0x38f567(0x1b6)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xdc65f3=await sales_finished[_0x38f567(0x204)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':_0x38f567(0x1dc)},{'$group':{'_id':_0x38f567(0x2b5),'invoice':{'$first':_0x38f567(0x26e)},'customers':{'$first':_0x38f567(0x265)},'date':{'$first':_0x38f567(0x1ba)},'warehouse_name':{'$first':_0x38f567(0x295)},'sale_product':{'$push':_0x38f567(0x1dc)},'note':{'$first':_0x38f567(0x1c1)},'return_data':{'$first':_0x38f567(0x1db)},'customers_docs':{'$first':_0x38f567(0x234)},'total_saleproduct_quantity':{'$sum':_0x38f567(0x1e0)},'level':{'$addToSet':_0x38f567(0x27b)},'isle':{'$addToSet':_0x38f567(0x279)},'type':{'$addToSet':_0x38f567(0x27c)},'pallet':{'$addToSet':_0x38f567(0x1b6)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x59d970[0x0][_0x38f567(0x230)]==_0x38f567(0x206)){var _0x3419ee=users[_0x38f567(0x1ea)];console[_0x38f567(0x201)](_0x3419ee);}else{if(_0x59d970[0x0][_0x38f567(0x230)]=='Hindi')var _0x3419ee=users[_0x38f567(0x264)];else{if(_0x59d970[0x0][_0x38f567(0x230)]=='German')var _0x3419ee=users[_0x38f567(0x235)];else{if(_0x59d970[0x0][_0x38f567(0x230)]==_0x38f567(0x218))var _0x3419ee=users['Spanish'];else{if(_0x59d970[0x0]['language']==_0x38f567(0x263))var _0x3419ee=users['French'];else{if(_0x59d970[0x0][_0x38f567(0x230)]==_0x38f567(0x292))var _0x3419ee=users[_0x38f567(0x293)];else{if(_0x59d970[0x0][_0x38f567(0x230)]==_0x38f567(0x2a2))var _0x3419ee=users[_0x38f567(0x2a2)];else{if(_0x59d970[0x0][_0x38f567(0x230)]==_0x38f567(0x2e8))var _0x3419ee=users[_0x38f567(0x26a)];}}}}}}}_0x1c5125[_0x38f567(0x20a)](_0x38f567(0x26d),{'success':_0x3e4a78[_0x38f567(0x28d)](_0x38f567(0x2c0)),'errors':_0x3e4a78['flash'](_0x38f567(0x1cd)),'sales':_0xdc65f3,'profile':_0x94e506,'role':_0x2158dd,'master_shop':_0x59d970,'language':_0x3419ee});}catch(_0x525ff1){console[_0x38f567(0x201)](_0x525ff1);}}),router[a0_0x3468ff(0x1bc)](a0_0x3468ff(0x2ef),auth,async(_0x18c31f,_0xb91113)=>{var _0x44a210=a0_0x3468ff;try{const {username:_0xef4122,email:_0x26f0c7,role:_0x3b812b}=_0x18c31f['user'],_0x3c3dc1=_0x18c31f[_0x44a210(0x224)],_0xe2f6c0=await profile[_0x44a210(0x242)]({'email':_0x3c3dc1['email']}),_0x1b2e8d=await master_shop['find']();let _0x912add;if(_0x3c3dc1[_0x44a210(0x1e9)]=='staff'){const _0x4e1c7c=await staff[_0x44a210(0x242)]({'email':_0x3c3dc1['email']});_0x912add=await sales_finished[_0x44a210(0x204)]([{'$match':{'typeOfProducts':_0x44a210(0x1e3)}},{'$unwind':_0x44a210(0x1dc)},{'$group':{'_id':_0x44a210(0x2b5),'invoice':{'$first':_0x44a210(0x26e)},'customers':{'$first':_0x44a210(0x265)},'date':{'$first':_0x44a210(0x1ba)},'warehouse_name':{'$first':_0x44a210(0x295)},'sale_product':{'$push':_0x44a210(0x1dc)},'note':{'$first':_0x44a210(0x1c1)},'return_data':{'$first':_0x44a210(0x1db)},'customers_docs':{'$first':_0x44a210(0x234)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x44a210(0x279)},'type':{'$addToSet':_0x44a210(0x27c)},'pallet':{'$addToSet':_0x44a210(0x1b6)},'finalize':{'$first':_0x44a210(0x20d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x912add=await sales_finished[_0x44a210(0x204)]([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x44a210(0x1dc)},{'$group':{'_id':_0x44a210(0x2b5),'invoice':{'$first':_0x44a210(0x26e)},'customers':{'$first':_0x44a210(0x265)},'date':{'$first':_0x44a210(0x1ba)},'warehouse_name':{'$first':_0x44a210(0x295)},'sale_product':{'$push':_0x44a210(0x1dc)},'note':{'$first':'$note'},'return_data':{'$first':_0x44a210(0x1db)},'customers_docs':{'$first':_0x44a210(0x234)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x44a210(0x279)},'type':{'$addToSet':_0x44a210(0x27c)},'pallet':{'$addToSet':_0x44a210(0x1b6)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x1b2e8d[0x0]['language']==_0x44a210(0x206)){var _0x55f11f=users[_0x44a210(0x1ea)];console[_0x44a210(0x201)](_0x55f11f);}else{if(_0x1b2e8d[0x0][_0x44a210(0x230)]=='Hindi')var _0x55f11f=users['Hindi'];else{if(_0x1b2e8d[0x0][_0x44a210(0x230)]==_0x44a210(0x235))var _0x55f11f=users[_0x44a210(0x235)];else{if(_0x1b2e8d[0x0][_0x44a210(0x230)]==_0x44a210(0x218))var _0x55f11f=users[_0x44a210(0x218)];else{if(_0x1b2e8d[0x0][_0x44a210(0x230)]==_0x44a210(0x263))var _0x55f11f=users[_0x44a210(0x263)];else{if(_0x1b2e8d[0x0]['language']==_0x44a210(0x292))var _0x55f11f=users[_0x44a210(0x293)];else{if(_0x1b2e8d[0x0][_0x44a210(0x230)]==_0x44a210(0x2a2))var _0x55f11f=users[_0x44a210(0x2a2)];else{if(_0x1b2e8d[0x0]['language']==_0x44a210(0x2e8))var _0x55f11f=users[_0x44a210(0x26a)];}}}}}}}_0xb91113[_0x44a210(0x20a)](_0x44a210(0x1c8),{'success':_0x18c31f['flash'](_0x44a210(0x2c0)),'errors':_0x18c31f[_0x44a210(0x28d)]('errors'),'sales':_0x912add,'profile':_0xe2f6c0,'role':_0x3c3dc1,'master_shop':_0x1b2e8d,'language':_0x55f11f});}catch(_0x1a75f1){console['log'](_0x1a75f1);}});async function getRandom8DigitNumber(){var _0xf23668=a0_0x3468ff;const _0x58ef42=0x989680,_0x4f24b6=0x5f5e0ff,_0x417d92=Math[_0xf23668(0x245)](Math[_0xf23668(0x2da)]()*(_0x4f24b6-_0x58ef42+0x1))+_0x58ef42;var _0x46515e;const _0x194e42=await sales_finished['findOne']({'invoice':_0xf23668(0x2df)+_0x417d92});return _0x194e42&&_0x194e42['length']>0x0?_0x46515e=_0xf23668(0x2df)+_0x417d92:_0x46515e=_0xf23668(0x2df)+_0x417d92,_0x46515e;}router['get'](a0_0x3468ff(0x2bc),auth,async(_0x55cb0a,_0x5738f1)=>{var _0x478f00=a0_0x3468ff;try{const {username:_0x490eb7,email:_0xcd4908,role:_0x4d7cd0}=_0x55cb0a[_0x478f00(0x224)],_0x1c1443=_0x55cb0a[_0x478f00(0x224)],_0x1b8968=await profile['findOne']({'email':_0x1c1443['email']}),_0x4c8e2c=await master_shop[_0x478f00(0x2d0)](),_0x3e34d8=await customer[_0x478f00(0x2d0)]({});let _0x256e9b;if(_0x1c1443['role']==_0x478f00(0x2dd)){const _0xfa17eb=await staff[_0x478f00(0x242)]({'email':_0x1c1443[_0x478f00(0x29e)]});_0x256e9b=await warehouse[_0x478f00(0x204)]([{'$match':{'status':'Enabled','name':_0xfa17eb[_0x478f00(0x2e4)]}},{'$group':{'_id':_0x478f00(0x223),'name':{'$first':_0x478f00(0x223)}}},{'$sort':{'name':0x1}}]);}else _0x256e9b=await warehouse['aggregate']([{'$match':{'status':_0x478f00(0x287)}},{'$group':{'_id':_0x478f00(0x223),'name':{'$first':_0x478f00(0x223)}}},{'$sort':{'name':0x1}}]);const _0xe2e501=await product['find']({});var _0xc71699=[_0x478f00(0x209),_0x478f00(0x23e)];const _0x25d84e=await sales_finished[_0x478f00(0x2d0)]({}),_0x41eb17=_0x25d84e[_0x478f00(0x2a8)]+0x1,_0x4fe270=_0x478f00(0x2df)+_0x41eb17[_0x478f00(0x2a5)]()[_0x478f00(0x21c)](0x5,'0');if(_0x4c8e2c[0x0]['language']==_0x478f00(0x206)){var _0x4f2d82=users[_0x478f00(0x1ea)];console[_0x478f00(0x201)](_0x4f2d82);}else{if(_0x4c8e2c[0x0][_0x478f00(0x230)]==_0x478f00(0x264))var _0x4f2d82=users[_0x478f00(0x264)];else{if(_0x4c8e2c[0x0]['language']==_0x478f00(0x235))var _0x4f2d82=users[_0x478f00(0x235)];else{if(_0x4c8e2c[0x0][_0x478f00(0x230)]==_0x478f00(0x218))var _0x4f2d82=users[_0x478f00(0x218)];else{if(_0x4c8e2c[0x0][_0x478f00(0x230)]=='French')var _0x4f2d82=users['French'];else{if(_0x4c8e2c[0x0][_0x478f00(0x230)]=='Portuguese\x20(BR)')var _0x4f2d82=users['Portuguese'];else{if(_0x4c8e2c[0x0][_0x478f00(0x230)]=='Chinese')var _0x4f2d82=users['Chinese'];else{if(_0x4c8e2c[0x0]['language']=='Arabic\x20(ae)')var _0x4f2d82=users['Arabic'];}}}}}}}const _0x2cf91e=getRandom8DigitNumber();_0x2cf91e[_0x478f00(0x20f)](_0x25dd6b=>{var _0x13d53e=_0x478f00;_0x5738f1[_0x13d53e(0x20a)](_0x13d53e(0x2ba),{'success':_0x55cb0a[_0x13d53e(0x28d)](_0x13d53e(0x2c0)),'errors':_0x55cb0a[_0x13d53e(0x28d)]('errors'),'role':_0x1c1443,'profile':_0x1b8968,'customer':_0x3e34d8,'warehouse':_0x256e9b,'product':_0xe2e501,'invoice':_0x25dd6b,'master_shop':_0x4c8e2c,'language':_0x4f2d82,'rooms_data':_0xc71699});})[_0x478f00(0x2b8)](_0x364bea=>{var _0x2d687d=_0x478f00;_0x55cb0a[_0x2d687d(0x28d)](_0x2d687d(0x1cd),_0x2d687d(0x1b0)),_0x5738f1[_0x2d687d(0x220)](_0x2d687d(0x1d7));});}catch(_0x11082a){console[_0x478f00(0x201)](_0x11082a);}}),router[a0_0x3468ff(0x1bc)](a0_0x3468ff(0x2e9),auth,async(_0x3465a3,_0x34ff27)=>{var _0x4b3681=a0_0x3468ff;try{const {username:_0x2e11dd,email:_0x23bbf9,role:_0xd1a5f2}=_0x3465a3[_0x4b3681(0x224)],_0x32902a=_0x3465a3[_0x4b3681(0x224)],_0x2d6346=await profile[_0x4b3681(0x242)]({'email':_0x32902a['email']}),_0x2b465b=await master_shop[_0x4b3681(0x2d0)](),_0x102fcc=await customer[_0x4b3681(0x2d0)]({});let _0x52ed3b;if(_0x32902a[_0x4b3681(0x1e9)]==_0x4b3681(0x2dd)){const _0x2bb340=await staff[_0x4b3681(0x242)]({'email':_0x32902a[_0x4b3681(0x29e)]});_0x52ed3b=await warehouse[_0x4b3681(0x204)]([{'$match':{'status':'Enabled','name':_0x2bb340[_0x4b3681(0x2e4)]}},{'$group':{'_id':_0x4b3681(0x223),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x52ed3b=await warehouse[_0x4b3681(0x204)]([{'$match':{'status':_0x4b3681(0x287)}},{'$group':{'_id':_0x4b3681(0x223),'name':{'$first':_0x4b3681(0x223)}}},{'$sort':{'name':0x1}}]);const _0x49e89a=await product['find']({});var _0x1d3f58=[_0x4b3681(0x209),_0x4b3681(0x23e)];const _0x4e8450=await sales_finished[_0x4b3681(0x2d0)]({}),_0x3f8997=_0x4e8450[_0x4b3681(0x2a8)]+0x1,_0x421ba8=_0x4b3681(0x2df)+_0x3f8997[_0x4b3681(0x2a5)]()[_0x4b3681(0x21c)](0x5,'0');if(_0x2b465b[0x0][_0x4b3681(0x230)]=='English\x20(US)'){var _0x5950b5=users[_0x4b3681(0x1ea)];console[_0x4b3681(0x201)](_0x5950b5);}else{if(_0x2b465b[0x0][_0x4b3681(0x230)]=='Hindi')var _0x5950b5=users[_0x4b3681(0x264)];else{if(_0x2b465b[0x0][_0x4b3681(0x230)]==_0x4b3681(0x235))var _0x5950b5=users[_0x4b3681(0x235)];else{if(_0x2b465b[0x0]['language']==_0x4b3681(0x218))var _0x5950b5=users[_0x4b3681(0x218)];else{if(_0x2b465b[0x0]['language']==_0x4b3681(0x263))var _0x5950b5=users[_0x4b3681(0x263)];else{if(_0x2b465b[0x0]['language']==_0x4b3681(0x292))var _0x5950b5=users[_0x4b3681(0x293)];else{if(_0x2b465b[0x0][_0x4b3681(0x230)]=='Chinese')var _0x5950b5=users[_0x4b3681(0x2a2)];else{if(_0x2b465b[0x0][_0x4b3681(0x230)]==_0x4b3681(0x2e8))var _0x5950b5=users[_0x4b3681(0x26a)];}}}}}}}const _0x103a32=getRandom8DigitNumber();_0x103a32[_0x4b3681(0x20f)](_0x2c0b53=>{var _0x5ee7c9=_0x4b3681;_0x34ff27[_0x5ee7c9(0x20a)](_0x5ee7c9(0x2fb),{'success':_0x3465a3[_0x5ee7c9(0x28d)](_0x5ee7c9(0x2c0)),'errors':_0x3465a3['flash'](_0x5ee7c9(0x1cd)),'role':_0x32902a,'profile':_0x2d6346,'customer':_0x102fcc,'warehouse':_0x52ed3b,'product':_0x49e89a,'invoice':_0x2c0b53,'master_shop':_0x2b465b,'language':_0x5950b5,'rooms_data':_0x1d3f58});})[_0x4b3681(0x2b8)](_0x7e9d1=>{var _0x124610=_0x4b3681;_0x3465a3[_0x124610(0x28d)](_0x124610(0x1cd),_0x124610(0x1b0)),_0x34ff27[_0x124610(0x220)](_0x124610(0x1d7));});}catch(_0x2114e8){console[_0x4b3681(0x201)](_0x2114e8);}}),router['post'](a0_0x3468ff(0x2e9),auth,async(_0x254a03,_0x5f2c05)=>{var _0x55f303=a0_0x3468ff;try{const {invoice:_0x58a46b,date:_0xa8bb11,warehouse_name:_0x254be0,product_name:_0x7287f7,note:_0x2bbc6b,room:_0x4af9bb,primary_code:_0x414d42,secondary_code:_0x1843a1,prod_code:_0x575b3a,SCRN:_0x21b740,ReqBy:_0x2d83d4,dateofreq:_0x478589,PO_number:_0x1e5725,typeservicesData:_0xa1053a,typevehicle:_0x233cb3,destination:_0x7a5354,deliverydate:_0x553e9a,driver:_0x202e09,plate:_0x57f90b,van:_0x23af04,DRSI:_0x3bbb6d,TSU:_0x5206de,TFU:_0x34b29,mode_transpo:_0xc6aa4d,name_driver:_0x671fa6,type_of_products:_0x36bbfa}=_0x254a03['body'];if(typeof _0x7287f7==_0x55f303(0x2e5))var _0x27a561=[_0x254a03[_0x55f303(0x21b)]['product_name']],_0x4c12b9=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x203)]],_0x4500e9=[_0x254a03['body'][_0x55f303(0x1d2)]],_0x56a96e=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x247)]],_0x46446f=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x24a)]],_0x352545=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x246)]],_0x1ce404=[_0x254a03['body'][_0x55f303(0x1cf)]],_0x1f033b=[_0x254a03['body'][_0x55f303(0x2f8)]],_0x40620c=[_0x254a03['body'][_0x55f303(0x2a7)]],_0x1f8ba2=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x23f)]],_0x257f29=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x200)]],_0x1d1091=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x299)]],_0xc357cf=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x1dd)]],_0x526ad3=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x2ee)]],_0x14aa33=[_0x254a03['body'][_0x55f303(0x239)]],_0xaf99f6=[_0x254a03[_0x55f303(0x21b)][_0x55f303(0x27f)]],_0x1db6b1=[_0x254a03['body']['id_transaction_from']],_0x4f5844=[_0x254a03['body']['uuid']],_0x550898=[_0x254a03['body'][_0x55f303(0x1f4)]];else var _0x27a561=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x2d3)]],_0x4c12b9=[..._0x254a03[_0x55f303(0x21b)]['stock']],_0x4500e9=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x1d2)]],_0x56a96e=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x247)]],_0x46446f=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x24a)]],_0x352545=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x246)]],_0x1ce404=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x1cf)]],_0x1f033b=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x2f8)]],_0x40620c=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x2a7)]],_0x1f8ba2=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x23f)]],_0x257f29=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x200)]],_0x1d1091=[..._0x254a03[_0x55f303(0x21b)]['product_date']],_0xc357cf=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x1dd)]],_0x526ad3=[..._0x254a03['body'][_0x55f303(0x2ee)]],_0x14aa33=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x239)]],_0xaf99f6=[..._0x254a03[_0x55f303(0x21b)]['prod_invoice']],_0x1db6b1=[..._0x254a03[_0x55f303(0x21b)]['id_transaction_from']],_0x4f5844=[..._0x254a03[_0x55f303(0x21b)]['uuid']],_0x550898=[..._0x254a03[_0x55f303(0x21b)][_0x55f303(0x1f4)]];const _0x45f055=_0x27a561[_0x55f303(0x1ed)](_0x10f0c9=>{return _0x10f0c9={'product_name':_0x10f0c9};});_0x4c12b9[_0x55f303(0x24e)]((_0x438b10,_0x20fc4a)=>{var _0x48a6b8=_0x55f303;_0x45f055[_0x20fc4a][_0x48a6b8(0x203)]=_0x438b10;}),_0x4500e9[_0x55f303(0x24e)]((_0xe947ad,_0x45ab69)=>{var _0x941445=_0x55f303;_0x45f055[_0x45ab69][_0x941445(0x271)]=Math[_0x941445(0x24d)](_0xe947ad);}),_0x27a561['forEach']((_0x4d6db9,_0x2621fd)=>{var _0x58d809=_0x55f303;_0x45f055[_0x2621fd][_0x58d809(0x268)]=_0x254a03[_0x58d809(0x21b)][_0x58d809(0x2de)];}),_0x550898[_0x55f303(0x24e)]((_0x5ca20c,_0x2b0266)=>{var _0x1e8058=_0x55f303;_0x45f055[_0x2b0266][_0x1e8058(0x1f4)]=_0x5ca20c;}),_0x4f5844[_0x55f303(0x24e)]((_0x152d7b,_0x48c30b)=>{_0x45f055[_0x48c30b]['uuid']=_0x152d7b;}),_0x1db6b1[_0x55f303(0x24e)]((_0xf376d1,_0x40f2c9)=>{var _0x3da538=_0x55f303;_0x45f055[_0x40f2c9][_0x3da538(0x1ca)]=_0xf376d1;}),_0x56a96e[_0x55f303(0x24e)]((_0x2d4e5e,_0x5706eb)=>{var _0x142343=_0x55f303;_0x45f055[_0x5706eb][_0x142343(0x247)]=_0x2d4e5e;}),_0x46446f[_0x55f303(0x24e)]((_0x55bfd4,_0x5932bc)=>{var _0x52f06e=_0x55f303;_0x45f055[_0x5932bc][_0x52f06e(0x24a)]=_0x55bfd4;}),_0x352545[_0x55f303(0x24e)]((_0x2ab22e,_0x511ad1)=>{var _0x5142f8=_0x55f303;_0x45f055[_0x511ad1][_0x5142f8(0x233)]=_0x2ab22e;}),_0x1ce404[_0x55f303(0x24e)]((_0x3ee02d,_0x432e89)=>{var _0x357035=_0x55f303,_0x333570=_0x3ee02d[_0x357035(0x1b8)](/[A-Za-z]+/)[0x0],_0x7f64a6=parseInt(_0x3ee02d[_0x357035(0x1b8)](/\d+/)[0x0]);_0x45f055[_0x432e89][_0x357035(0x297)]=_0x7f64a6,_0x45f055[_0x432e89]['level']=_0x333570;}),_0x1f033b[_0x55f303(0x24e)]((_0x52ef04,_0x5c3378)=>{var _0x3a740c=_0x55f303;_0x45f055[_0x5c3378][_0x3a740c(0x227)]=_0x52ef04;}),_0x40620c[_0x55f303(0x24e)]((_0x3ee769,_0xe996bd)=>{var _0x45db24=_0x55f303;_0x45f055[_0xe996bd][_0x45db24(0x2a7)]=_0x3ee769;}),_0x1f8ba2['forEach']((_0x2cc8c2,_0x45f205)=>{_0x45f055[_0x45f205]['batch_code']=_0x2cc8c2;}),_0x257f29[_0x55f303(0x24e)]((_0x366b32,_0x326a1a)=>{_0x45f055[_0x326a1a]['expiry_date']=_0x366b32;}),_0x1d1091[_0x55f303(0x24e)]((_0x5256bb,_0x54efaf)=>{var _0x6c1b51=_0x55f303;_0x45f055[_0x54efaf][_0x6c1b51(0x1f0)]=_0x5256bb;}),_0xc357cf['forEach']((_0x4dc946,_0x4d24be)=>{var _0x2d959a=_0x55f303;_0x45f055[_0x4d24be][_0x2d959a(0x24c)]=_0x4dc946;}),_0x526ad3[_0x55f303(0x24e)]((_0x43ba65,_0x3c75be)=>{_0x45f055[_0x3c75be]['prod_cat']=_0x43ba65;}),_0x14aa33[_0x55f303(0x24e)]((_0x1adbe3,_0x29896d)=>{var _0x3e3c8c=_0x55f303;_0x45f055[_0x29896d][_0x3e3c8c(0x21d)]=_0x1adbe3;}),_0xaf99f6[_0x55f303(0x24e)]((_0x53ca7f,_0x90710)=>{var _0x58165b=_0x55f303;_0x45f055[_0x90710][_0x58165b(0x210)]=_0x53ca7f,_0x45f055[_0x90710][_0x58165b(0x2f9)]=_0xa8bb11;});const _0x1813d3=new sales_logs();await _0x1813d3[_0x55f303(0x2f5)](),_0xaf99f6[_0x55f303(0x24e)]((_0xb7a64b,_0x1269a3)=>{var _0x53af84=_0x55f303;_0x45f055[_0x1269a3]['outgoing_invoice']='LOG-OUT-'+_0x1813d3[_0x53af84(0x1d9)][_0x53af84(0x2a5)]()[_0x53af84(0x21c)](0x8,'0');});var _0x5377b8=0x0;_0x45f055[_0x55f303(0x24e)](_0x2abd8f=>{var _0x10d1c7=_0x55f303;parseFloat(_0x2abd8f[_0x10d1c7(0x203)])<parseFloat(_0x2abd8f[_0x10d1c7(0x271)])&&parseFloat(_0x2abd8f[_0x10d1c7(0x271)])>parseFloat(_0x2abd8f[_0x10d1c7(0x203)])&&(console[_0x10d1c7(0x201)](_0x2abd8f[_0x10d1c7(0x203)]+'\x20<>\x20'+_0x2abd8f[_0x10d1c7(0x271)]),_0x5377b8++);});if(_0x5377b8!=0x0)return _0x254a03[_0x55f303(0x28d)](_0x55f303(0x1cd),_0x55f303(0x236)),_0x5f2c05[_0x55f303(0x220)](_0x55f303(0x2ec));const _0x3f671b=_0x45f055[_0x55f303(0x20c)](_0x2772b6=>_0x2772b6[_0x55f303(0x271)]!=='0'&&_0x2772b6['quantity']!==''),_0x4d66f8=new sales_finished({'invoice':_0x55f303(0x2d6)+_0x1813d3[_0x55f303(0x1d9)][_0x55f303(0x2a5)]()[_0x55f303(0x21c)](0x8,'0'),'sales_data':_0x254a03[_0x55f303(0x21b)][_0x55f303(0x2de)],'customer':_0x254a03['body'][_0x55f303(0x289)],'date':_0xa8bb11,'warehouse_name':_0x254be0,'sale_product':_0x3f671b,'note':_0x2bbc6b,'room':_0x4af9bb,'primary_code':_0x414d42,'secondary_code':_0x1843a1,'prod_code':_0x575b3a,'SCRN':_0x21b740,'finalize':_0x55f303(0x2d4),'mode_transpo':_0xc6aa4d,'name_driver':_0x671fa6,'ReqBy':_0x2d83d4,'dateofreq':_0x478589,'PO_number':_0x1e5725,'typeservicesData':_0xa1053a,'typevehicle':_0x233cb3,'destination':_0x7a5354,'deliverydate':_0x553e9a,'driver':_0x202e09,'plate':_0x57f90b,'van':_0x23af04,'DRSI':_0x3bbb6d,'TSU':_0x5206de,'TFU':_0x34b29,'typeOfProducts':_0x36bbfa}),_0x23dab8=await _0x4d66f8[_0x55f303(0x2f5)](),_0x12a7e4=await sales_finished[_0x55f303(0x242)]({'invoice':_0x58a46b});_0x254a03[_0x55f303(0x28d)](_0x55f303(0x2c0),_0x55f303(0x2ad)),_0x5f2c05[_0x55f303(0x220)]('/all_sales_finished/preview/'+_0x23dab8[_0x55f303(0x217)]);}catch(_0x46ed2a){console['log'](_0x46ed2a);}}),router['get']('/view/add_sales/:id',auth,async(_0x186288,_0x26ce7f)=>{var _0x5a1c15=a0_0x3468ff;try{const _0x4623fb=_0x186288[_0x5a1c15(0x2e1)]['id'];console[_0x5a1c15(0x201)](_0x4623fb);const _0xf95e1a=await product['find'](),_0x3effed=await purchases[_0x5a1c15(0x204)]([{'$match':{'warehouse_name':_0x4623fb}},{'$unwind':_0x5a1c15(0x2ac)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x5a1c15(0x22b),_0x3effed),_0x26ce7f[_0x5a1c15(0x2fa)](0xc8)[_0x5a1c15(0x1f3)]({'purchases_data':_0x3effed,'product_data':_0xf95e1a});}catch(_0x5e7263){console[_0x5a1c15(0x201)](_0x5e7263);}}),router[a0_0x3468ff(0x1c9)]('/view/add_sale/product',auth,async(_0x296d25,_0x2671c3)=>{var _0x5ab3fa=a0_0x3468ff;try{const {warehouse_data:_0x3e366c,product_data:_0x7f62ed}=_0x296d25['body'];console[_0x5ab3fa(0x201)](_0x296d25[_0x5ab3fa(0x21b)][_0x5ab3fa(0x221)]);;const _0xf7ed5f=await master_shop[_0x5ab3fa(0x2d0)]();console[_0x5ab3fa(0x201)](_0x5ab3fa(0x22c),_0xf7ed5f);const _0xe2342b=await product[_0x5ab3fa(0x242)]({'name':_0x7f62ed});console[_0x5ab3fa(0x201)](_0x5ab3fa(0x2d5),_0xe2342b);const _0x44d5a5=await warehouse['aggregate']([{'$match':{'name':_0x3e366c}},{'$unwind':_0x5ab3fa(0x1d5)},{'$match':{'product_details.product_name':_0x7f62ed}},{'$group':{'_id':_0x5ab3fa(0x2e0),'product_stock':{'$first':_0x5ab3fa(0x1c6)}}}]);console[_0x5ab3fa(0x201)](_0x5ab3fa(0x2f2),_0x44d5a5),_0x2671c3[_0x5ab3fa(0x2fa)](0xc8)[_0x5ab3fa(0x1f3)]({'master':_0xf7ed5f,'new_product':_0xe2342b,'stock_data':_0x44d5a5});}catch(_0x131afb){console[_0x5ab3fa(0x201)](_0x131afb);}}),router[a0_0x3468ff(0x1c9)](a0_0x3468ff(0x2bc),auth,async(_0x35fc30,_0x2f8455)=>{var _0x4bcbcd=a0_0x3468ff;try{const {invoice:_0x329932,date:_0x31e5da,warehouse_name:_0x554a3d,product_name:_0x3b653d,note:_0x334d3e,room:_0x3586bc,primary_code:_0x4869f5,secondary_code:_0x495563,prod_code:_0xac7392,SCRN:_0x213a01,ReqBy:_0x258d9e,dateofreq:_0x2eab77,PO_number:_0x51b026,typeservicesData:_0x540a33,typevehicle:_0x183ff2,destination:_0x1471f1,deliverydate:_0x3e48ad,driver:_0x8da172,plate:_0x317f7e,van:_0x4b8c55,DRSI:_0x1943fc,TSU:_0x2cda1b,TFU:_0x4836c4,mode_transpo:_0x1213e9,name_driver:_0x21a173,pull_out_date:_0x461c65,actual_delivery_date:_0xd703fe}=_0x35fc30[_0x4bcbcd(0x21b)];_0x2f8455['json'](_0x35fc30[_0x4bcbcd(0x21b)]);return;if(typeof _0x3b653d==_0x4bcbcd(0x2e5))var _0x20eaf6=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x2d3)]],_0x4882e6=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x203)]],_0x95ea5f=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x1d2)]],_0x426e18=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x247)]],_0x3ee368=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x24a)]],_0x189461=[_0x35fc30[_0x4bcbcd(0x21b)]['prod_code']],_0x44ab5d=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x1cf)]],_0x4d8de5=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x2f8)]],_0x52264f=[_0x35fc30[_0x4bcbcd(0x21b)]['secondary_unit']],_0x147428=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x23f)]],_0x7ee1ae=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x200)]],_0x41746a=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x299)]],_0x268ab0=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x1dd)]],_0x39afed=[_0x35fc30['body']['prod_cat']],_0x5d5b87=[_0x35fc30['body']['RoomAssigned']],_0x103db5=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x27f)]],_0x13eee7=[_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x1ca)]],_0x184b06=[_0x35fc30['body']['uuid']],_0x49ad4b=[_0x35fc30['body'][_0x4bcbcd(0x1f4)]];else var _0x20eaf6=[..._0x35fc30[_0x4bcbcd(0x21b)]['product_name']],_0x4882e6=[..._0x35fc30['body'][_0x4bcbcd(0x203)]],_0x95ea5f=[..._0x35fc30[_0x4bcbcd(0x21b)]['carton']],_0x426e18=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x247)]],_0x3ee368=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x24a)]],_0x189461=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x246)]],_0x44ab5d=[..._0x35fc30[_0x4bcbcd(0x21b)]['level2']],_0x4d8de5=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x2f8)]],_0x52264f=[..._0x35fc30['body'][_0x4bcbcd(0x2a7)]],_0x147428=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x23f)]],_0x7ee1ae=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x200)]],_0x41746a=[..._0x35fc30[_0x4bcbcd(0x21b)]['product_date']],_0x268ab0=[..._0x35fc30['body'][_0x4bcbcd(0x1dd)]],_0x39afed=[..._0x35fc30[_0x4bcbcd(0x21b)]['prod_cat']],_0x5d5b87=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x239)]],_0x103db5=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x27f)]],_0x13eee7=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x1ca)]],_0x184b06=[..._0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x23c)]],_0x49ad4b=[..._0x35fc30[_0x4bcbcd(0x21b)]['gross_price']];const _0x49c89b=_0x20eaf6[_0x4bcbcd(0x1ed)](_0x472884=>{return _0x472884={'product_name':_0x472884};});_0x4882e6['forEach']((_0x574fe3,_0x1a4620)=>{_0x49c89b[_0x1a4620]['stock']=_0x574fe3;}),_0x95ea5f[_0x4bcbcd(0x24e)]((_0x45a44d,_0x346d91)=>{var _0x1756fa=_0x4bcbcd;_0x49c89b[_0x346d91][_0x1756fa(0x271)]=Math['abs'](_0x45a44d);}),_0x20eaf6[_0x4bcbcd(0x24e)]((_0x1b1dd8,_0x219bff)=>{var _0x5b4fca=_0x4bcbcd;_0x49c89b[_0x219bff][_0x5b4fca(0x268)]=_0x35fc30['body']['sales'];}),_0x49ad4b[_0x4bcbcd(0x24e)]((_0x55239a,_0x35593f)=>{var _0x446afd=_0x4bcbcd;_0x49c89b[_0x35593f][_0x446afd(0x1f4)]=_0x55239a;}),_0x184b06[_0x4bcbcd(0x24e)]((_0x1d5e2a,_0x1cb453)=>{_0x49c89b[_0x1cb453]['uuid']=_0x1d5e2a;}),_0x13eee7[_0x4bcbcd(0x24e)]((_0x107322,_0x4a4e44)=>{var _0x1ee612=_0x4bcbcd;_0x49c89b[_0x4a4e44][_0x1ee612(0x1ca)]=_0x107322;}),_0x426e18[_0x4bcbcd(0x24e)]((_0x5d719a,_0x4f8835)=>{_0x49c89b[_0x4f8835]['primary_code']=_0x5d719a;}),_0x3ee368['forEach']((_0x2ba9cc,_0x145c93)=>{var _0x560a06=_0x4bcbcd;_0x49c89b[_0x145c93][_0x560a06(0x24a)]=_0x2ba9cc;}),_0x189461[_0x4bcbcd(0x24e)]((_0x3f0657,_0x3e1091)=>{var _0x1e8545=_0x4bcbcd;_0x49c89b[_0x3e1091][_0x1e8545(0x233)]=_0x3f0657;}),_0x44ab5d[_0x4bcbcd(0x24e)]((_0x24fc2f,_0x42fea8)=>{var _0x2748bc=_0x4bcbcd,_0x94d8ab=_0x24fc2f['match'](/[A-Za-z]+/)[0x0],_0x5940b5=parseInt(_0x24fc2f['match'](/\d+/)[0x0]);_0x49c89b[_0x42fea8][_0x2748bc(0x297)]=_0x5940b5,_0x49c89b[_0x42fea8][_0x2748bc(0x298)]=_0x94d8ab;}),_0x4d8de5[_0x4bcbcd(0x24e)]((_0x521274,_0x4bad0d)=>{var _0x46d9cb=_0x4bcbcd;_0x49c89b[_0x4bad0d][_0x46d9cb(0x227)]=_0x521274;}),_0x52264f[_0x4bcbcd(0x24e)]((_0x5c77c4,_0x139a7a)=>{var _0x210cab=_0x4bcbcd;_0x49c89b[_0x139a7a][_0x210cab(0x2a7)]=_0x5c77c4;}),_0x147428[_0x4bcbcd(0x24e)]((_0x376e5f,_0x245d58)=>{_0x49c89b[_0x245d58]['batch_code']=_0x376e5f;}),_0x7ee1ae['forEach']((_0x456fd5,_0xf05718)=>{var _0x5c19e9=_0x4bcbcd;_0x49c89b[_0xf05718][_0x5c19e9(0x200)]=_0x456fd5;}),_0x41746a[_0x4bcbcd(0x24e)]((_0x4b73ba,_0x5f67e8)=>{var _0x2a5937=_0x4bcbcd;_0x49c89b[_0x5f67e8][_0x2a5937(0x1f0)]=_0x4b73ba;}),_0x268ab0[_0x4bcbcd(0x24e)]((_0x16185c,_0x2145bb)=>{var _0x1228cd=_0x4bcbcd;_0x49c89b[_0x2145bb][_0x1228cd(0x24c)]=_0x16185c;}),_0x39afed['forEach']((_0x55b6bf,_0x1ff90c)=>{var _0x4840f3=_0x4bcbcd;_0x49c89b[_0x1ff90c][_0x4840f3(0x2ee)]=_0x55b6bf;}),_0x5d5b87[_0x4bcbcd(0x24e)]((_0x47f697,_0x397b97)=>{_0x49c89b[_0x397b97]['room_name']=_0x47f697;}),_0x103db5[_0x4bcbcd(0x24e)]((_0x1e1f6c,_0xd3daa4)=>{var _0x480678=_0x4bcbcd;_0x49c89b[_0xd3daa4][_0x480678(0x210)]=_0x1e1f6c,_0x49c89b[_0xd3daa4]['date_data']=_0x31e5da;});const _0x4d93d2=new invoice_for_outgoing();await _0x4d93d2[_0x4bcbcd(0x2f5)](),_0x103db5[_0x4bcbcd(0x24e)]((_0x4c8df6,_0x5f9673)=>{var _0xcf8c68=_0x4bcbcd;_0x49c89b[_0x5f9673][_0xcf8c68(0x1bd)]='OUT-'+_0x4d93d2[_0xcf8c68(0x1d9)][_0xcf8c68(0x2a5)]()[_0xcf8c68(0x21c)](0x8,'0');});var _0x382bde=0x0;_0x49c89b[_0x4bcbcd(0x24e)](_0xa17d9d=>{var _0x6c331a=_0x4bcbcd;parseFloat(_0xa17d9d[_0x6c331a(0x203)])<parseFloat(_0xa17d9d['quantity'])&&parseFloat(_0xa17d9d[_0x6c331a(0x271)])>parseFloat(_0xa17d9d[_0x6c331a(0x203)])&&(console[_0x6c331a(0x201)](_0xa17d9d[_0x6c331a(0x203)]+_0x6c331a(0x237)+_0xa17d9d[_0x6c331a(0x271)]),_0x382bde++);});if(_0x382bde!=0x0)return _0x35fc30[_0x4bcbcd(0x28d)]('errors',_0x4bcbcd(0x236)),_0x2f8455[_0x4bcbcd(0x220)](_0x4bcbcd(0x2ec));const _0xded28f=_0x49c89b['filter'](_0x1d709e=>_0x1d709e[_0x4bcbcd(0x271)]!=='0'&&_0x1d709e[_0x4bcbcd(0x271)]!==''),_0x21d947=new sales_finished({'invoice':_0x4bcbcd(0x225)+_0x4d93d2[_0x4bcbcd(0x1d9)][_0x4bcbcd(0x2a5)]()[_0x4bcbcd(0x21c)](0x8,'0'),'sales_data':_0x35fc30[_0x4bcbcd(0x21b)][_0x4bcbcd(0x2de)],'customer':_0x35fc30['body']['customer'],'date':_0x31e5da,'warehouse_name':_0x554a3d,'sale_product':_0xded28f,'note':_0x334d3e,'room':_0x3586bc,'primary_code':_0x4869f5,'secondary_code':_0x495563,'prod_code':_0xac7392,'SCRN':_0x213a01,'finalize':_0x4bcbcd(0x2d4),'mode_transpo':_0x1213e9,'name_driver':_0x21a173,'ReqBy':_0x258d9e,'dateofreq':_0x2eab77,'PO_number':_0x51b026,'typeservicesData':_0x540a33,'typevehicle':_0x183ff2,'destination':_0x1471f1,'deliverydate':_0x3e48ad,'driver':_0x8da172,'plate':_0x317f7e,'van':_0x4b8c55,'DRSI':_0x1943fc,'TSU':_0x2cda1b,'TFU':_0x4836c4,'pullout_date':_0x461c65,'actualdelivery_date':_0xd703fe,'typeOfProducts':_0x4bcbcd(0x1c0)}),_0x3239b2=await _0x21d947[_0x4bcbcd(0x2f5)](),_0x5d111a=await sales_finished[_0x4bcbcd(0x242)]({'invoice':_0x329932});_0x35fc30[_0x4bcbcd(0x28d)]('success','Sales\x20Add\x20successfully'),_0x2f8455[_0x4bcbcd(0x220)](_0x4bcbcd(0x283)+_0x3239b2[_0x4bcbcd(0x217)]);}catch(_0x552951){console[_0x4bcbcd(0x201)](_0x552951);}}),router[a0_0x3468ff(0x1bc)](a0_0x3468ff(0x214),auth,async(_0xec28c9,_0xd10ff0)=>{var _0x222edf=a0_0x3468ff;try{const {username:_0x4a3da3,email:_0x2dc6dc,role:_0x3c8b7f}=_0xec28c9['user'],_0x56b9c2=_0xec28c9[_0x222edf(0x224)],_0x44d78b=await profile[_0x222edf(0x242)]({'email':_0x56b9c2[_0x222edf(0x29e)]}),_0x35e906=await master_shop[_0x222edf(0x2d0)](),_0x4262e1=_0xec28c9[_0x222edf(0x2e1)]['id'],_0x516cf2=await sales_finished['findById'](_0x4262e1),_0x2f7394=await warehouse[_0x222edf(0x204)]([{'$match':{'name':_0x516cf2[_0x222edf(0x2d8)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x222edf(0x1ef),'name':{'$first':_0x222edf(0x2e0)},'product_stock':{'$first':_0x222edf(0x1c6)},'bay':{'$first':_0x222edf(0x2ca)},'bin':{'$first':_0x222edf(0x261)},'type':{'$first':_0x222edf(0x2eb)},'floorlevel':{'$first':_0x222edf(0x2a9)},'primary_code':{'$first':_0x222edf(0x2e6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x222edf(0x254)},'storage':{'$first':_0x222edf(0x2db)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x222edf(0x1df)},'batch_code':{'$first':_0x222edf(0x2f0)},'room':{'$first':_0x222edf(0x1bf)},'room_data':{'$first':_0x222edf(0x1af)}}}]),_0x111dcd=await customer[_0x222edf(0x2d0)]({});let _0x1aa573;if(_0x56b9c2[_0x222edf(0x1e9)]==_0x222edf(0x2dd)){const _0x1e53a5=await staff[_0x222edf(0x242)]({'email':_0x56b9c2[_0x222edf(0x29e)]});_0x1aa573=await warehouse[_0x222edf(0x204)]([{'$match':{'status':_0x222edf(0x287),'name':_0x1e53a5['warehouse']}},{'$group':{'_id':_0x222edf(0x223),'name':{'$first':'$name'}}}]);}else _0x1aa573=await warehouse[_0x222edf(0x204)]([{'$match':{'status':_0x222edf(0x287)}},{'$group':{'_id':_0x222edf(0x223),'name':{'$first':_0x222edf(0x223)}}}]);const _0x348b4a=await product[_0x222edf(0x2d0)]({});if(_0x35e906[0x0][_0x222edf(0x230)]==_0x222edf(0x206)){var _0x48752e=users[_0x222edf(0x1ea)];console[_0x222edf(0x201)](_0x48752e);}else{if(_0x35e906[0x0][_0x222edf(0x230)]==_0x222edf(0x264))var _0x48752e=users[_0x222edf(0x264)];else{if(_0x35e906[0x0][_0x222edf(0x230)]==_0x222edf(0x235))var _0x48752e=users['German'];else{if(_0x35e906[0x0]['language']==_0x222edf(0x218))var _0x48752e=users[_0x222edf(0x218)];else{if(_0x35e906[0x0][_0x222edf(0x230)]=='French')var _0x48752e=users[_0x222edf(0x263)];else{if(_0x35e906[0x0][_0x222edf(0x230)]==_0x222edf(0x292))var _0x48752e=users[_0x222edf(0x293)];else{if(_0x35e906[0x0]['language']=='Chinese')var _0x48752e=users[_0x222edf(0x2a2)];else{if(_0x35e906[0x0]['language']==_0x222edf(0x2e8))var _0x48752e=users['Arabic'];}}}}}}}_0xd10ff0['render'](_0x222edf(0x28c),{'success':_0xec28c9[_0x222edf(0x28d)](_0x222edf(0x2c0)),'errors':_0xec28c9[_0x222edf(0x28d)]('errors'),'role':_0x56b9c2,'profile':_0x44d78b,'customer':_0x111dcd,'warehouse':_0x1aa573,'product':_0x2f7394,'user':_0x516cf2,'master_shop':_0x35e906,'unit':_0x348b4a,'language':_0x48752e});}catch(_0x9f1b){console[_0x222edf(0x201)](_0x9f1b);}});function a0_0x4ef8(_0x1dc4a6,_0x3d786b){var _0x73baa4=a0_0x73ba();return a0_0x4ef8=function(_0x4ef88e,_0x38054f){_0x4ef88e=_0x4ef88e-0x1ad;var _0x4ca40f=_0x73baa4[_0x4ef88e];return _0x4ca40f;},a0_0x4ef8(_0x1dc4a6,_0x3d786b);}async function dataUpdate(_0x2a56ac,_0x2910bc,_0x29bb2e){var _0x4add2b=a0_0x3468ff;return await warehouse[_0x4add2b(0x1fd)]({'_id':_0x2a56ac,'product_details._id':_0x2910bc},{'$set':{'product_details.$.product_stock':_0x29bb2e}}),await warehouse[_0x4add2b(0x1f8)](_0x2a56ac);}router[a0_0x3468ff(0x1c9)]('/preview/:id',auth,async(_0x5d12df,_0x2528d9)=>{var _0x68acc4=a0_0x3468ff;try{const _0x1f9f73=_0x5d12df[_0x68acc4(0x2e1)]['id'],{invoice:_0x2acd2e,warehouse_name:_0x4059f8,room:_0x52602d}=_0x5d12df['body'],_0xf4fc66=await sales_finished[_0x68acc4(0x242)]({'invoice':_0x2acd2e});for(let _0x36595d=0x0;_0x36595d<=_0xf4fc66[_0x68acc4(0x232)]['length']-0x1;_0x36595d++){const _0xf222f5=_0xf4fc66['sale_product'][_0x36595d];var _0x599478=await warehouse[_0x68acc4(0x242)]({'name':_0x4059f8,'room':_0xf222f5[_0x68acc4(0x21d)]}),_0x5597f0=0x0;for(let _0x2858b5=0x0;_0x2858b5<=_0x599478[_0x68acc4(0x1fa)]['length']-0x1;_0x2858b5++){const _0x4c34fe=_0x599478[_0x68acc4(0x1fa)][_0x2858b5];_0x4c34fe[_0x68acc4(0x217)]==_0xf222f5[_0x68acc4(0x1ca)]&&_0x4c34fe[_0x68acc4(0x23c)]==_0xf222f5[_0x68acc4(0x23c)]&&(_0x5597f0=Math[_0x68acc4(0x21a)](0x0,Math['abs'](_0x4c34fe[_0x68acc4(0x294)])-Math[_0x68acc4(0x24d)](_0xf222f5[_0x68acc4(0x271)])),await warehouse['updateOne']({'_id':_0x599478[_0x68acc4(0x217)]['valueOf'](),'product_details._id':_0x4c34fe[_0x68acc4(0x217)]['valueOf'](),'product_details.uuid':_0xf222f5[_0x68acc4(0x23c)]},{'$set':{'product_details.$.product_stock':_0x5597f0}}));}console[_0x68acc4(0x201)](typeof _0xf222f5[_0x68acc4(0x268)]);if(typeof _0xf222f5[_0x68acc4(0x268)]!==_0x68acc4(0x207)){var _0x5d8a8e=await staff[_0x68acc4(0x1f8)](_0xf222f5['agent_id']);console[_0x68acc4(0x201)](_0x68acc4(0x2b6));var _0x1810f7=0x0;for(let _0x10dd99=0x0;_0x10dd99<=_0x5d8a8e[_0x68acc4(0x27e)]['length']-0x1;_0x10dd99++){const _0x4d7ecc=_0x5d8a8e[_0x68acc4(0x27e)][_0x10dd99];console['log'](_0xf222f5[_0x68acc4(0x1ca)]+'\x20==\x20'+_0x4d7ecc[_0x68acc4(0x266)]+_0x68acc4(0x262)+_0xf222f5['_id']+'\x20==\x20'+_0xf222f5[_0x68acc4(0x217)]),_0xf222f5[_0x68acc4(0x1ca)]==_0x4d7ecc[_0x68acc4(0x266)]&&_0xf222f5[_0x68acc4(0x217)]==0x1&&(_0x4d7ecc['product_stock']=Math[_0x68acc4(0x24d)](_0x4d7ecc[_0x68acc4(0x294)])+Math[_0x68acc4(0x24d)](_0xf222f5[_0x68acc4(0x271)]),_0x1810f7++);}console[_0x68acc4(0x201)]('int',_0x1810f7),_0x1810f7=='0'&&(_0x5d8a8e[_0x68acc4(0x27e)]=_0x5d8a8e[_0x68acc4(0x27e)][_0x68acc4(0x202)]({'product_name':_0xf222f5[_0x68acc4(0x2d3)],'product_stock':_0xf222f5['quantity'],'bay':_0xf222f5[_0x68acc4(0x297)],'level':_0xf222f5[_0x68acc4(0x298)],'product_code':_0xf222f5[_0x68acc4(0x233)],'primary_code':_0xf222f5[_0x68acc4(0x247)],'secondary_code':_0xf222f5[_0x68acc4(0x24a)],'expiry_date':_0xf222f5['expiry_date'],'production_date':_0xf222f5[_0x68acc4(0x1f0)],'maxProducts':_0xf222f5[_0x68acc4(0x260)],'batch_code':_0xf222f5['batch_code'],'secondary_unit':_0xf222f5[_0x68acc4(0x2a7)],'unit':_0xf222f5[_0x68acc4(0x227)],'maxProducts':_0xf222f5[_0x68acc4(0x260)],'maxPerUnit':_0xf222f5['maxperunit'],'invoice':_0xf222f5['invoice'],'warehouse_id':_0xf222f5['id_transaction_from'],'id_incoming':_0xf222f5[_0x68acc4(0x217)],'uuid':_0xf222f5[_0x68acc4(0x23c)],'gross_price':_0xf222f5[_0x68acc4(0x1f4)],'date_incoming':_0xf222f5[_0x68acc4(0x2f9)],'outgoing_invoice':_0xf222f5['outgoing_invoice']}),await _0x5d8a8e['save']());}}_0xf4fc66[_0x68acc4(0x23a)]=_0x68acc4(0x1eb);const _0x5072d6=await _0xf4fc66[_0x68acc4(0x2f5)](),_0x549613=await master_shop[_0x68acc4(0x2d0)](),_0x3e1f17=await email_settings[_0x68acc4(0x242)](),_0x159be7=await supervisor_settings[_0x68acc4(0x2d0)]();var _0x34cc30=_0xf4fc66[_0x68acc4(0x232)],_0x1c87d0='',_0x5e06f6;for(_0x5e06f6 in _0x34cc30){_0x1c87d0+=_0x68acc4(0x1de)+_0x68acc4(0x240)+_0x34cc30[_0x5e06f6][_0x68acc4(0x2d3)]+_0x68acc4(0x2be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34cc30[_0x5e06f6]['product_code']+_0x68acc4(0x2be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34cc30[_0x5e06f6][_0x68acc4(0x271)]+_0x68acc4(0x2be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34cc30[_0x5e06f6]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34cc30[_0x5e06f6][_0x68acc4(0x2a7)]+_0x68acc4(0x2be)+_0x68acc4(0x240)+_0xf4fc66[_0x68acc4(0x2d8)]+_0x68acc4(0x2be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34cc30[_0x5e06f6]['room_name']+_0x68acc4(0x2be)+_0x68acc4(0x240)+_0x34cc30[_0x5e06f6][_0x68acc4(0x297)]+_0x68acc4(0x2be);}_0x5d12df[_0x68acc4(0x28d)]('success',_0x68acc4(0x1ad)),_0x2528d9[_0x68acc4(0x220)]('/picking_list/pdf/'+_0x1f9f73);}catch(_0x29a912){console[_0x68acc4(0x201)](_0x29a912);}}),router['get'](a0_0x3468ff(0x25f),auth,async(_0x292b4f,_0x3a0497)=>{var _0x40ae8f=a0_0x3468ff;try{const {username:_0x4b32ba,email:_0x53c4f7,role:_0x3ca75d}=_0x292b4f[_0x40ae8f(0x224)],_0x5dcc94=_0x292b4f[_0x40ae8f(0x224)],_0x2c60cd=await profile[_0x40ae8f(0x242)]({'email':_0x5dcc94[_0x40ae8f(0x29e)]}),_0x45751d=await master_shop[_0x40ae8f(0x2d0)](),_0x390ea1=_0x292b4f[_0x40ae8f(0x2e1)]['id'],_0x16a393=await sales_finished['findById'](_0x390ea1);let _0x23618a=new Date(_0x16a393['expiry_date']),_0xbe33a=('0'+_0x23618a['getDate']())[_0x40ae8f(0x276)](-0x2),_0x3cbffe=('0'+(_0x23618a[_0x40ae8f(0x211)]()+0x1))[_0x40ae8f(0x276)](-0x2),_0x255e8c=_0x23618a[_0x40ae8f(0x252)](),_0x5de759=_0x255e8c+'-'+_0x3cbffe+'-'+_0xbe33a;var _0x165eb4=[_0x40ae8f(0x209),_0x40ae8f(0x23e)];const _0x2b79b3=await warehouse[_0x40ae8f(0x204)]([{'$match':{'name':_0x16a393[_0x40ae8f(0x2d8)],'room':_0x16a393['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x40ae8f(0x1ef),'name':{'$first':_0x40ae8f(0x2e0)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x40ae8f(0x2ca)},'bin':{'$first':_0x40ae8f(0x261)},'type':{'$first':_0x40ae8f(0x2eb)},'floorlevel':{'$first':_0x40ae8f(0x2a9)},'primary_code':{'$first':_0x40ae8f(0x2e6)},'secondary_code':{'$first':_0x40ae8f(0x231)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x40ae8f(0x2db)},'rack':{'$first':'$product_details.rack'}}}]),_0x454a18=await customer[_0x40ae8f(0x2d0)]({});let _0x53b972;if(_0x5dcc94[_0x40ae8f(0x1e9)]==_0x40ae8f(0x2dd)){const _0x1d16f2=await staff[_0x40ae8f(0x242)]({'email':_0x5dcc94[_0x40ae8f(0x29e)]});_0x53b972=await warehouse[_0x40ae8f(0x204)]([{'$match':{'status':_0x40ae8f(0x287),'name':_0x1d16f2[_0x40ae8f(0x2e4)]}},{'$group':{'_id':_0x40ae8f(0x223),'name':{'$first':_0x40ae8f(0x223)}}}]);}else _0x53b972=await warehouse[_0x40ae8f(0x204)]([{'$match':{'status':_0x40ae8f(0x287)}},{'$group':{'_id':_0x40ae8f(0x223),'name':{'$first':_0x40ae8f(0x223)}}}]);const _0x56dff6=await product[_0x40ae8f(0x2d0)]({});if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x206)){var _0x291cf8=users[_0x40ae8f(0x1ea)];console[_0x40ae8f(0x201)](_0x291cf8);}else{if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x264))var _0x291cf8=users[_0x40ae8f(0x264)];else{if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x235))var _0x291cf8=users['German'];else{if(_0x45751d[0x0][_0x40ae8f(0x230)]=='Spanish')var _0x291cf8=users[_0x40ae8f(0x218)];else{if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x263))var _0x291cf8=users['French'];else{if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x292))var _0x291cf8=users['Portuguese'];else{if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x2a2))var _0x291cf8=users[_0x40ae8f(0x2a2)];else{if(_0x45751d[0x0][_0x40ae8f(0x230)]==_0x40ae8f(0x2e8))var _0x291cf8=users[_0x40ae8f(0x26a)];}}}}}}}_0x3a0497[_0x40ae8f(0x20a)](_0x40ae8f(0x2c8),{'success':_0x292b4f[_0x40ae8f(0x28d)](_0x40ae8f(0x2c0)),'errors':_0x292b4f[_0x40ae8f(0x28d)]('errors'),'role':_0x5dcc94,'profile':_0x2c60cd,'customer':_0x454a18,'warehouse':_0x53b972,'product':_0x2b79b3,'user':_0x16a393,'master_shop':_0x45751d,'unit':_0x56dff6,'language':_0x291cf8,'rooms_data':_0x165eb4,'ed_fullDate':_0x5de759});}catch(_0x4e272c){console[_0x40ae8f(0x201)](_0x4e272c);}}),router[a0_0x3468ff(0x1c9)](a0_0x3468ff(0x25f),auth,async(_0x3603d4,_0x3b817e)=>{var _0x44d048=a0_0x3468ff;try{const _0x28cca4=_0x3603d4[_0x44d048(0x2e1)]['id'],_0xf7aace=await sales_finished[_0x44d048(0x242)]({'_id':_0x3603d4[_0x44d048(0x2e1)]['id']}),_0x2ca96d=await warehouse[_0x44d048(0x242)]({'name':_0xf7aace[_0x44d048(0x2d8)],'room':_0x3603d4[_0x44d048(0x21b)][_0x44d048(0x288)],'warehouse_category':_0x44d048(0x24f)}),{invoice:_0x2e5a00,customer:_0x22f742,date:_0x41934e,warehouse_name:_0x69c071,product_name:_0x198273,stock:_0x105f55,adjust_qty:_0xd00167,note:_0xeac95f,room:_0x484380,primary_code:_0x2aeedb,secondary_code:_0x453042,prod_code:_0x407c04,level:_0xddcdeb,isle:_0x3592ad,pallet:_0x747b15,expiry_date:_0x2999a7}=_0x3603d4['body'];if(typeof _0x198273=='string')var _0x421d41=[_0x3603d4[_0x44d048(0x21b)][_0x44d048(0x2d3)]],_0x7e2f74=[_0x3603d4[_0x44d048(0x21b)]['stock']],_0x10da84=[_0x3603d4[_0x44d048(0x21b)][_0x44d048(0x1f7)]],_0x2926eb=[_0x3603d4[_0x44d048(0x21b)][_0x44d048(0x247)]],_0x3aaf4b=[_0x3603d4['body']['secondary_code']],_0x56666e=[_0x3603d4[_0x44d048(0x21b)]['prod_code']],_0x4789c6=[_0x3603d4[_0x44d048(0x21b)]['level']],_0x17b6b4=[_0x3603d4[_0x44d048(0x21b)][_0x44d048(0x200)]];else var _0x421d41=[..._0x3603d4[_0x44d048(0x21b)][_0x44d048(0x2d3)]],_0x7e2f74=[..._0x3603d4[_0x44d048(0x21b)][_0x44d048(0x203)]],_0x10da84=[..._0x3603d4[_0x44d048(0x21b)][_0x44d048(0x1f7)]],_0x2926eb=[..._0x3603d4[_0x44d048(0x21b)][_0x44d048(0x247)]],_0x3aaf4b=[..._0x3603d4[_0x44d048(0x21b)][_0x44d048(0x24a)]],_0x56666e=[..._0x3603d4[_0x44d048(0x21b)][_0x44d048(0x246)]],_0x4789c6=[..._0x3603d4[_0x44d048(0x21b)]['level']],_0x17b6b4=[..._0x3603d4[_0x44d048(0x21b)]['expiry_date']];const _0xe49512=_0x421d41['map'](_0x38423d=>{return _0x38423d={'product_name':_0x38423d};});_0x7e2f74[_0x44d048(0x24e)]((_0x352e3e,_0x50d5ad)=>{var _0x5d9754=_0x44d048;_0xe49512[_0x50d5ad][_0x5d9754(0x203)]=_0x352e3e;}),_0x10da84[_0x44d048(0x24e)]((_0x106598,_0x428a9d)=>{_0xe49512[_0x428a9d]['quantity']=_0x106598;}),_0x2926eb[_0x44d048(0x24e)]((_0x45a652,_0x1ade3b)=>{_0xe49512[_0x1ade3b]['primary_code']=_0x45a652;}),_0x3aaf4b[_0x44d048(0x24e)]((_0x4c43c9,_0x11ac5d)=>{_0xe49512[_0x11ac5d]['secondary_code']=_0x4c43c9;}),_0x56666e['forEach']((_0x571501,_0xb44ac6)=>{var _0x52028e=_0x44d048;_0xe49512[_0xb44ac6][_0x52028e(0x233)]=_0x571501;}),_0x4789c6[_0x44d048(0x24e)]((_0x3e6f8a,_0x350f0f)=>{var _0x5d0fa7=_0x44d048;_0xe49512[_0x350f0f][_0x5d0fa7(0x298)]=_0x3e6f8a;}),_0x17b6b4[_0x44d048(0x24e)]((_0x2aef04,_0x4f6a14)=>{_0xe49512[_0x4f6a14]['expiry_date']=_0x2aef04;});var _0x276e6f=0x0;_0xe49512[_0x44d048(0x24e)](_0x430e51=>{var _0x55281a=_0x44d048;console['log'](_0x55281a(0x2af),_0x430e51),(parseInt(_0x430e51[_0x55281a(0x203)])<parseInt(_0x430e51[_0x55281a(0x271)])||parseInt(_0x430e51['quantity'])==0x0)&&_0x276e6f++;});if(_0x276e6f!=0x0)return _0x3603d4[_0x44d048(0x28d)](_0x44d048(0x1cd),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3b817e[_0x44d048(0x220)](_0x44d048(0x2ec));_0xf7aace[_0x44d048(0x232)]['forEach'](_0x171cd4=>{var _0xd5ce84=_0x44d048;const _0x4c3e25=_0x2ca96d[_0xd5ce84(0x1fa)][_0xd5ce84(0x1ed)](_0x65caf1=>{var _0x16487b=_0xd5ce84;_0x65caf1[_0x16487b(0x2d3)]==_0x171cd4[_0x16487b(0x2d3)]&&_0x65caf1[_0x16487b(0x297)]==_0x171cd4[_0x16487b(0x297)]&&(_0x65caf1[_0x16487b(0x294)]=parseInt(_0x65caf1[_0x16487b(0x294)])+parseInt(_0x171cd4[_0x16487b(0x271)]));});}),await _0x2ca96d[_0x44d048(0x2f5)]();const _0x14d23f=_0xe49512['filter'](_0xd8c8e3=>_0xd8c8e3['quantity']!=='0'&&_0xd8c8e3[_0x44d048(0x271)]!=='');_0xf7aace[_0x44d048(0x210)]=_0x2e5a00,_0xf7aace[_0x44d048(0x289)]=_0x22f742,_0xf7aace[_0x44d048(0x1d1)]=_0x41934e,_0xf7aace[_0x44d048(0x2d8)]=_0x69c071,_0xf7aace[_0x44d048(0x232)]=_0x14d23f,_0xf7aace[_0x44d048(0x20b)]=_0xeac95f,_0xf7aace[_0x44d048(0x288)]=_0x484380;const _0x1c88a2=await _0xf7aace[_0x44d048(0x2f5)](),_0x590842=await sales_finished[_0x44d048(0x242)]({'_id':_0x3603d4[_0x44d048(0x2e1)]['id']}),_0x124325=await warehouse['findOne']({'name':_0x69c071,'room':_0x484380,'warehouse_category':_0x44d048(0x24f)});_0x590842['sale_product']['forEach'](_0x1448b0=>{var _0xecd858=_0x44d048;const _0x531ba5=_0x124325[_0xecd858(0x1fa)][_0xecd858(0x1ed)](_0x4d868a=>{var _0xe34ad4=_0xecd858;_0x4d868a[_0xe34ad4(0x2d3)]==_0x1448b0['product_name']&&_0x4d868a[_0xe34ad4(0x297)]==_0x1448b0['bay']&&(_0x4d868a[_0xe34ad4(0x294)]=parseInt(_0x4d868a['product_stock'])-parseInt(_0x1448b0[_0xe34ad4(0x271)]));});}),console[_0x44d048(0x201)]('final',_0x124325),await _0x124325[_0x44d048(0x2f5)]();const _0x58f643=await c_payment_data[_0x44d048(0x242)]({'invoice':_0x3603d4['body']['invoice']});_0x58f643[_0x44d048(0x2bd)]=_0x3603d4[_0x44d048(0x21b)]['suppliers'],await _0x58f643[_0x44d048(0x2f5)](),_0x3603d4[_0x44d048(0x28d)](_0x44d048(0x2c0),_0x44d048(0x1ad)),_0x3b817e[_0x44d048(0x220)](_0x44d048(0x1d7));}catch(_0x345025){console['log'](_0x345025);}}),router[a0_0x3468ff(0x1c9)]('/give_payment/:id',auth,async(_0x5c5512,_0x5cf12f)=>{var _0x27321e=a0_0x3468ff;try{const _0x583371=_0x5c5512[_0x27321e(0x2e1)]['id'],{invoice:_0x53dacd,customer:_0x2f6c96,receivable_amount:_0x56e38e,received_amount:_0x32804c}=_0x5c5512[_0x27321e(0x21b)],_0xedf1a5=await sales[_0x27321e(0x1f8)](_0x583371);console[_0x27321e(0x201)](_0xedf1a5);var _0x463a4a=_0x56e38e-_0x32804c;console[_0x27321e(0x201)](_0x32804c),_0xedf1a5[_0x27321e(0x257)]=parseFloat(_0x32804c)+parseFloat(_0xedf1a5[_0x27321e(0x257)]),_0xedf1a5[_0x27321e(0x1e1)]=_0x463a4a,console[_0x27321e(0x201)](_0xedf1a5);const _0x13c9f3=await _0xedf1a5[_0x27321e(0x2f5)](),_0x124c8e=await c_payment_data['findOne']({'invoice':_0x53dacd});_0x124c8e[_0x27321e(0x25e)]=_0x463a4a,await _0x124c8e[_0x27321e(0x2f5)]();let _0x2fcbee=new Date(),_0x1460e6=('0'+_0x2fcbee[_0x27321e(0x2c7)]())[_0x27321e(0x276)](-0x2),_0x3671ce=('0'+(_0x2fcbee[_0x27321e(0x211)]()+0x1))[_0x27321e(0x276)](-0x2),_0x30cca0=_0x2fcbee[_0x27321e(0x252)](),_0x29b053=_0x30cca0+'-'+_0x3671ce+'-'+_0x1460e6;const _0x33ba03=new customer_payment({'invoice':_0x53dacd,'date':_0x30cca0+'-'+_0x3671ce+'-'+_0x1460e6,'customer':_0x2f6c96,'reason':_0x27321e(0x229),'amount':_0x32804c}),_0x2eff16=await _0x33ba03['save']();_0x5c5512[_0x27321e(0x28d)](_0x27321e(0x2c0),'payment\x20successfull'),_0x5cf12f[_0x27321e(0x220)]('/all_sales/view');}catch(_0x1a94e4){console['log'](_0x1a94e4);}}),router['get'](a0_0x3468ff(0x228),auth,async(_0x57ba29,_0x25db5d)=>{var _0x3a064d=a0_0x3468ff;try{const {username:_0x1d34fb,email:_0x596570,role:_0x38a5a4}=_0x57ba29[_0x3a064d(0x224)],_0x23f69e=_0x57ba29['user'],_0x29c367=await profile[_0x3a064d(0x242)]({'email':_0x23f69e['email']}),_0x3746f6=await master_shop[_0x3a064d(0x2d0)]();console[_0x3a064d(0x201)](_0x3a064d(0x22c),_0x3746f6);const _0x11f373=_0x57ba29[_0x3a064d(0x2e1)]['id'],_0x2cbde5=await sales[_0x3a064d(0x1f8)](_0x11f373);console['log'](_0x2cbde5);const _0x47a96e=await customer[_0x3a064d(0x242)]({'name':_0x2cbde5[_0x3a064d(0x289)]});console[_0x3a064d(0x201)](_0x47a96e);if(_0x3746f6[0x0]['language']==_0x3a064d(0x206)){var _0x5c49c5=users['English'];console[_0x3a064d(0x201)](_0x5c49c5);}else{if(_0x3746f6[0x0][_0x3a064d(0x230)]=='Hindi')var _0x5c49c5=users['Hindi'];else{if(_0x3746f6[0x0][_0x3a064d(0x230)]==_0x3a064d(0x235))var _0x5c49c5=users[_0x3a064d(0x235)];else{if(_0x3746f6[0x0][_0x3a064d(0x230)]==_0x3a064d(0x218))var _0x5c49c5=users['Spanish'];else{if(_0x3746f6[0x0][_0x3a064d(0x230)]==_0x3a064d(0x263))var _0x5c49c5=users[_0x3a064d(0x263)];else{if(_0x3746f6[0x0][_0x3a064d(0x230)]==_0x3a064d(0x292))var _0x5c49c5=users[_0x3a064d(0x293)];else{if(_0x3746f6[0x0]['language']==_0x3a064d(0x2a2))var _0x5c49c5=users[_0x3a064d(0x2a2)];else{if(_0x3746f6[0x0][_0x3a064d(0x230)]==_0x3a064d(0x2e8))var _0x5c49c5=users[_0x3a064d(0x26a)];}}}}}}}_0x25db5d['render']('sales_invoice',{'success':_0x57ba29[_0x3a064d(0x28d)](_0x3a064d(0x2c0)),'errors':_0x57ba29[_0x3a064d(0x28d)](_0x3a064d(0x1cd)),'role':_0x23f69e,'profile':_0x29c367,'master_shop':_0x3746f6,'customers':_0x47a96e,'sales':_0x2cbde5,'language':_0x5c49c5});}catch(_0x22399e){console[_0x3a064d(0x201)](_0x22399e);}}),router[a0_0x3468ff(0x1bc)]('/view/return_sales/:id',auth,async(_0xeb355f,_0x3fc493)=>{var _0x95f2b4=a0_0x3468ff;try{const {username:_0x2ad420,email:_0x424040,role:_0x408094}=_0xeb355f['user'],_0x423b63=_0xeb355f['user'],_0x3ca7fe=await profile[_0x95f2b4(0x242)]({'email':_0x423b63[_0x95f2b4(0x29e)]}),_0x1a0813=await master_shop['find'](),_0x4ab7b7=_0xeb355f['params']['id'],_0x32b967=await sales_finished[_0x95f2b4(0x1f8)](_0x4ab7b7),_0x121189=await warehouse['aggregate']([{'$match':{'name':_0x32b967[_0x95f2b4(0x2d8)]}},{'$unwind':_0x95f2b4(0x1d5)},{'$group':{'_id':_0x95f2b4(0x1ef),'name':{'$first':_0x95f2b4(0x2e0)},'product_stock':{'$first':_0x95f2b4(0x1c6)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x95f2b4(0x261)},'type':{'$first':_0x95f2b4(0x2eb)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x95f2b4(0x2e6)},'secondary_code':{'$first':_0x95f2b4(0x231)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x95f2b4(0x205)},'secondary_unit':{'$first':_0x95f2b4(0x1c7)},'maxProducts':{'$first':_0x95f2b4(0x25a)},'batch_code':{'$first':_0x95f2b4(0x2f0)},'maxPerUnit':{'$first':_0x95f2b4(0x277)}}}]),_0x584a4c=await product['find']({}),_0x59a728=await warehouse[_0x95f2b4(0x204)]([{'$match':{'status':_0x95f2b4(0x287),'warehouse_category':_0x95f2b4(0x24f),'name':{'$ne':_0x95f2b4(0x2cf),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x95f2b4(0x223),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x398655=[_0x95f2b4(0x2b1)];const _0x3a074b=await warehouse[_0x95f2b4(0x204)]([{'$match':{'status':_0x95f2b4(0x287),'name':_0x95f2b4(0x2ea)}},{'$group':{'_id':_0x95f2b4(0x223),'name':{'$first':_0x95f2b4(0x223)}}},{'$sort':{'name':0x1}}]);if(_0x1a0813[0x0][_0x95f2b4(0x230)]==_0x95f2b4(0x206)){var _0x51250f=users[_0x95f2b4(0x1ea)];console[_0x95f2b4(0x201)](_0x51250f);}else{if(_0x1a0813[0x0][_0x95f2b4(0x230)]==_0x95f2b4(0x264))var _0x51250f=users[_0x95f2b4(0x264)];else{if(_0x1a0813[0x0][_0x95f2b4(0x230)]==_0x95f2b4(0x235))var _0x51250f=users[_0x95f2b4(0x235)];else{if(_0x1a0813[0x0]['language']==_0x95f2b4(0x218))var _0x51250f=users[_0x95f2b4(0x218)];else{if(_0x1a0813[0x0][_0x95f2b4(0x230)]==_0x95f2b4(0x263))var _0x51250f=users[_0x95f2b4(0x263)];else{if(_0x1a0813[0x0]['language']==_0x95f2b4(0x292))var _0x51250f=users['Portuguese'];else{if(_0x1a0813[0x0][_0x95f2b4(0x230)]=='Chinese')var _0x51250f=users[_0x95f2b4(0x2a2)];else{if(_0x1a0813[0x0][_0x95f2b4(0x230)]=='Arabic\x20(ae)')var _0x51250f=users['Arabic'];}}}}}}}_0x3fc493[_0x95f2b4(0x20a)](_0x95f2b4(0x1c5),{'success':_0xeb355f[_0x95f2b4(0x28d)](_0x95f2b4(0x2c0)),'errors':_0xeb355f[_0x95f2b4(0x28d)](_0x95f2b4(0x1cd)),'role':_0x423b63,'profile':_0x3ca7fe,'user':_0x32b967,'stock':_0x121189,'master_shop':_0x1a0813,'unit':_0x584a4c,'language':_0x51250f,'warehouses':_0x59a728,'rooms':_0x398655,'warehouse_QA':_0x3a074b});}catch(_0x2ac695){console[_0x95f2b4(0x201)](_0x2ac695),_0x3fc493[_0x95f2b4(0x2fa)](0xc8)['json']({'message':_0x2ac695['message']});}}),router[a0_0x3468ff(0x1c9)](a0_0x3468ff(0x1f2),auth,async(_0x5aa7ec,_0x8922b6)=>{var _0x52818b=a0_0x3468ff;if(_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x1fb)]=='QA')try{const {invoice:_0x35be82,date:_0x5d7664,warehouse_name:_0x1de89c,product_name:_0x216a9e,primary_code:_0x350f72,secondary_code:_0x3cd40e,product_code:_0x389b9b,sales_quantity:_0x522f16,stocks:_0x3aeda8,return_qty:_0x12f65a,Room_name:_0x16ebe5,to_warehouse_name_QA:_0x305ef2,to_Room_name_QA:_0x1205a7,note:_0xcff876,for_categorize:_0x3ad968,product_name_QA1:_0x205478}=_0x5aa7ec[_0x52818b(0x21b)];if(typeof _0x205478==_0x52818b(0x2e5))var _0xd2a8b4=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x253)]],_0x18357a=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x213)]],_0xedea06=[_0x5aa7ec[_0x52818b(0x21b)]['secondary_code_QA']],_0x2c1d62=[_0x5aa7ec['body'][_0x52818b(0x2e2)]],_0x59a613=[_0x5aa7ec[_0x52818b(0x21b)]['sales_quantity_QA']],_0x34a210=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x22e)]],_0x4c4af=[_0x5aa7ec[_0x52818b(0x21b)]['return_qty_QA']],_0x9a52ca=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2d2)]],_0x24ae45=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x26f)]],_0x5ad5f1=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x1d8)]],_0x4eb0de=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x216)]],_0x4754bf=[_0x5aa7ec[_0x52818b(0x21b)]['unit_QA']],_0x14348f=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x270)]],_0xfba86e=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2b2)]];else var _0xd2a8b4=[..._0x5aa7ec['body'][_0x52818b(0x253)]],_0x18357a=[..._0x5aa7ec[_0x52818b(0x21b)]['primary_code_QA']],_0xedea06=[..._0x5aa7ec['body']['secondary_code_QA']],_0x2c1d62=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2e2)]],_0x59a613=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2bf)]],_0x34a210=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x22e)]],_0x4c4af=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x28a)]],_0x9a52ca=[..._0x5aa7ec['body'][_0x52818b(0x2d2)]],_0x24ae45=[..._0x5aa7ec['body'][_0x52818b(0x26f)]],_0x5ad5f1=[..._0x5aa7ec['body'][_0x52818b(0x1d8)]],_0x4eb0de=[..._0x5aa7ec['body'][_0x52818b(0x216)]],_0x4754bf=[..._0x5aa7ec['body']['unit_QA']],_0x14348f=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x270)]],_0xfba86e=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2b2)]];const _0x51e4d0=_0xd2a8b4[_0x52818b(0x1ed)](_0x56f7da=>{return _0x56f7da={'product_name':_0x56f7da};});_0x18357a[_0x52818b(0x24e)]((_0x58c5a0,_0x3ca9a3)=>{var _0x1afe74=_0x52818b;_0x51e4d0[_0x3ca9a3][_0x1afe74(0x247)]=_0x58c5a0;}),_0xedea06[_0x52818b(0x24e)]((_0x46a0f0,_0x682cab)=>{var _0xc8c43a=_0x52818b;_0x51e4d0[_0x682cab][_0xc8c43a(0x24a)]=_0x46a0f0;}),_0x2c1d62['forEach']((_0x364436,_0x47ca2e)=>{var _0x21048c=_0x52818b;_0x51e4d0[_0x47ca2e][_0x21048c(0x233)]=_0x364436;}),_0x59a613[_0x52818b(0x24e)]((_0x34fffc,_0x66394f)=>{_0x51e4d0[_0x66394f]['sale_qty']=_0x34fffc;}),_0x34a210['forEach']((_0x1d92d0,_0x5de92a)=>{var _0x3c9d54=_0x52818b;_0x51e4d0[_0x5de92a][_0x3c9d54(0x203)]=_0x1d92d0;}),_0x4c4af[_0x52818b(0x24e)]((_0x1d5b42,_0x4ffb39)=>{var _0x5d8cfd=_0x52818b;_0x51e4d0[_0x4ffb39][_0x5d8cfd(0x1b3)]=_0x1d5b42;}),_0x9a52ca['forEach']((_0x986723,_0x3f93f4)=>{var _0x52d204=_0x52818b;_0x51e4d0[_0x3f93f4][_0x52d204(0x1ec)]=_0x986723;}),_0x24ae45[_0x52818b(0x24e)]((_0x1d72a7,_0x1b3666)=>{var _0x5ce3cc=_0x52818b;_0x51e4d0[_0x1b3666][_0x5ce3cc(0x260)]=_0x1d72a7;}),_0x5ad5f1[_0x52818b(0x24e)]((_0xa7cac0,_0x4f1f97)=>{var _0xf68b31=_0x52818b;_0x51e4d0[_0x4f1f97][_0xf68b31(0x23f)]=_0xa7cac0;}),_0x4eb0de['forEach']((_0x189490,_0x47ddf1)=>{var _0x7ce0b=_0x52818b;_0x51e4d0[_0x47ddf1][_0x7ce0b(0x2a7)]=_0x189490;}),_0x4754bf[_0x52818b(0x24e)]((_0x3718dc,_0x32f896)=>{_0x51e4d0[_0x32f896]['unit']=_0x3718dc;}),_0x14348f[_0x52818b(0x24e)]((_0x299f60,_0x4cd9f6)=>{var _0x353060=_0x52818b;_0x51e4d0[_0x4cd9f6][_0x353060(0x1f0)]=_0x299f60;}),_0xfba86e[_0x52818b(0x24e)]((_0xe3f642,_0x239a4a)=>{var _0x15fbc8=_0x52818b;_0x51e4d0[_0x239a4a][_0x15fbc8(0x200)]=_0xe3f642;});const _0x4c63f1=await sales_finished[_0x52818b(0x242)]({'invoice':_0x35be82});_0x4c63f1[_0x52818b(0x2c1)]=_0x52818b(0x1eb);const _0x4c1b06=await _0x4c63f1[_0x52818b(0x2f5)](),_0x369981=new sales_return_finished({'invoice':_0x35be82,'customer':_0x5aa7ec['body'][_0x52818b(0x289)],'date':_0x5d7664,'warehouse_name':_0x1de89c,'room':_0x16ebe5,'ToWarehouse':_0x305ef2,'ToRoom':_0x1205a7,'return_sale_QA':_0x51e4d0,'note':_0xcff876,'warehouse_cat':_0x3ad968}),_0x213ea4=await _0x369981['save'](),_0x459ca2=await sales_return_finished[_0x52818b(0x242)]({'invoice':_0x35be82}),_0x329784=await warehouse[_0x52818b(0x242)]({'name':_0x305ef2,'room':_0x1205a7});_0x459ca2['return_sale_QA']['forEach'](_0x260f72=>{var _0x4af504=_0x52818b,_0x2f08ba=0x0;const _0x4df856=_0x329784[_0x4af504(0x1fa)][_0x4af504(0x1ed)](_0x501e87=>{var _0x9f4304=_0x4af504;_0x501e87[_0x9f4304(0x2d3)]==_0x260f72[_0x9f4304(0x2d3)]&&_0x501e87['expiry_date']==_0x260f72[_0x9f4304(0x200)]&&_0x501e87['production_date']==_0x260f72[_0x9f4304(0x1f0)]&&_0x501e87[_0x9f4304(0x23f)]==_0x260f72[_0x9f4304(0x23f)]&&(_0x501e87[_0x9f4304(0x294)]=parseInt(_0x501e87[_0x9f4304(0x294)])+parseInt(_0x260f72['return_qty']),_0x2f08ba++);});_0x2f08ba=='0'&&(_0x329784[_0x4af504(0x1fa)]=_0x329784[_0x4af504(0x1fa)][_0x4af504(0x202)]({'product_name':_0x260f72[_0x4af504(0x2d3)],'product_stock':_0x260f72[_0x4af504(0x1b3)],'primary_code':_0x260f72[_0x4af504(0x247)],'secondary_code':_0x260f72[_0x4af504(0x24a)],'product_code':_0x260f72[_0x4af504(0x233)],'batch_code':_0x260f72['batch_code'],'maxPerUnit':_0x260f72[_0x4af504(0x1ec)],'production_date':_0x260f72[_0x4af504(0x1f0)],'expiry_date':_0x260f72['expiry_date'],'secondary_unit':_0x260f72['secondary_unit'],'unit':_0x260f72[_0x4af504(0x227)],'maxProducts':_0x260f72['maxProducts'],'bay':_0x260f72[_0x4af504(0x297)]}));}),await _0x329784['save']();const _0x3749e3=new c_payment_data({'invoice':_0x35be82,'customer':_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x289)],'reason':'Sale\x20Return'});await _0x3749e3['save']();const _0x34017b=await master_shop[_0x52818b(0x2d0)](),_0x40f7da=await email_settings[_0x52818b(0x242)](),_0x5210cf=await customer[_0x52818b(0x242)]({'name':_0x5aa7ec[_0x52818b(0x21b)]['customer']});_0x34017b[0x0][_0x52818b(0x24b)]==0x1?(right_currency=_0x34017b[0x0][_0x52818b(0x22a)],left_currency=''):(right_currency='',left_currency=_0x34017b[0x0][_0x52818b(0x22a)]);var _0xa42c96=_0xd2a8b4,_0x15fbea=_0x4c4af,_0xb660ea='',_0x275695;for(_0x275695 in _0xa42c96){_0xb660ea+=_0x52818b(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa42c96[_0x275695]+_0x52818b(0x2be)+_0x52818b(0x240)+_0x15fbea[_0x275695]+_0x52818b(0x2be)+'</tr>';}console['log'](_0x52818b(0x27e),_0xb660ea);let _0xdf59b0=nodemailer[_0x52818b(0x1b2)]({'service':_0x52818b(0x2b7),'auth':{'user':_0x40f7da[_0x52818b(0x29e)],'pass':_0x40f7da[_0x52818b(0x28e)]}}),_0x2ea0d6={'from':_0x40f7da[_0x52818b(0x29e)],'to':_0x5210cf[_0x52818b(0x29e)],'subject':_0x52818b(0x29f),'attachments':[{'filename':_0x52818b(0x267),'path':__dirname+'/../public'+_0x52818b(0x2bb)+_0x34017b[0x0][_0x52818b(0x2d9)],'cid':_0x52818b(0x2a4)}],'html':_0x52818b(0x212)+_0x52818b(0x27a)+_0x52818b(0x2b3)+_0x52818b(0x29c)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x52818b(0x29c)+_0x52818b(0x2a1)+_0x52818b(0x22d)+_0x52818b(0x29c)+_0x52818b(0x29a)+_0x34017b[0x0][_0x52818b(0x2c2)]+_0x52818b(0x2a3)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x52818b(0x29c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x52818b(0x290)+_0x35be82+'\x20'+_0x52818b(0x208)+_0x52818b(0x250)+_0x5d7664+'\x20'+_0x52818b(0x1f1)+_0x52818b(0x25c)+'</div>'+_0x52818b(0x215)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x52818b(0x1de)+_0x52818b(0x2ce)+_0x52818b(0x2f1)+_0x52818b(0x2fc)+_0x52818b(0x2c6)+'</tr>'+_0x52818b(0x1cc)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xb660ea+'\x20'+_0x52818b(0x23d)+'</table>'+_0x52818b(0x29c)+_0x52818b(0x2e7)+'<h5>'+_0x34017b[0x0][_0x52818b(0x2c2)]+_0x52818b(0x25c)+'</div>'+_0x52818b(0x22d)+_0x52818b(0x238)};_0xdf59b0[_0x52818b(0x285)](_0x2ea0d6,function(_0x441289,_0x1acc5e){var _0x5246df=_0x52818b;_0x441289?(console['log'](_0x441289),console[_0x5246df(0x201)](_0x5246df(0x27d))):console[_0x5246df(0x201)](_0x5246df(0x1e6));}),_0x5aa7ec[_0x52818b(0x28d)]('success','sales\x20item\x20return\x20successfull'),_0x8922b6[_0x52818b(0x220)](_0x52818b(0x1d7));}catch(_0x5e401d){_0x8922b6[_0x52818b(0x2fa)](0xc8)[_0x52818b(0x1f3)]({'message1':_0x5e401d['message']});}else{if(_0x5aa7ec['body']['for_categorize']=='GS')try{const {invoice:_0xdcc6aa,date:_0x4f8514,warehouse_name:_0x14daa0,product_name:_0x4b089c,primary_code:_0x1f40f2,secondary_code:_0x167080,product_code:_0x3cdc23,sales_quantity:_0x284e17,stocks:_0x5b9803,return_qty:_0x531ab2,Room_name:_0xc2d0e,to_warehouse_name:_0x432aa5,to_Room_name:_0x492b32,note:_0x2ef261,level:_0x572faa,isle:_0x4e8b6a,pallet:_0x5d6983,for_categorize:_0x3dd5c1}=_0x5aa7ec[_0x52818b(0x21b)];if(typeof _0x4b089c==_0x52818b(0x2e5))var _0xd2a8b4=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2d3)]],_0x18357a=[_0x5aa7ec[_0x52818b(0x21b)]['primary_code']],_0xedea06=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x24a)]],_0x2c1d62=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x233)]],_0x59a613=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2c9)]],_0x4c4af=[_0x5aa7ec['body'][_0x52818b(0x1b3)]],_0x4a795a=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x297)]],_0x9a52ca=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x1ec)]],_0x24ae45=[_0x5aa7ec['body'][_0x52818b(0x260)]],_0x5ad5f1=[_0x5aa7ec['body'][_0x52818b(0x23f)]],_0x4eb0de=[_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2a7)]],_0x4754bf=[_0x5aa7ec['body'][_0x52818b(0x227)]],_0x14348f=[_0x5aa7ec[_0x52818b(0x21b)]['production_date']],_0xfba86e=[_0x5aa7ec[_0x52818b(0x21b)]['expiry_date']];else var _0xd2a8b4=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2d3)]],_0x18357a=[..._0x5aa7ec['body']['primary_code']],_0xedea06=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x24a)]],_0x2c1d62=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x233)]],_0x59a613=[..._0x5aa7ec['body'][_0x52818b(0x2c9)]],_0x4c4af=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x1b3)]],_0x4a795a=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x297)]],_0x9a52ca=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x1ec)]],_0x24ae45=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x260)]],_0x5ad5f1=[..._0x5aa7ec['body'][_0x52818b(0x23f)]],_0x4eb0de=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x2a7)]],_0x4754bf=[..._0x5aa7ec['body']['unit']],_0x14348f=[..._0x5aa7ec['body']['production_date']],_0xfba86e=[..._0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x200)]];const _0x45a33f=_0xd2a8b4[_0x52818b(0x1ed)](_0xa7ab3d=>{return _0xa7ab3d={'product_name':_0xa7ab3d};});_0x18357a[_0x52818b(0x24e)]((_0x2ea4dc,_0x2fb26e)=>{var _0x31e123=_0x52818b;_0x45a33f[_0x2fb26e][_0x31e123(0x247)]=_0x2ea4dc;}),_0xedea06[_0x52818b(0x24e)]((_0x2ac9eb,_0x203b54)=>{var _0x17985e=_0x52818b;_0x45a33f[_0x203b54][_0x17985e(0x24a)]=_0x2ac9eb;}),_0x2c1d62[_0x52818b(0x24e)]((_0xae37f2,_0x862813)=>{var _0x1b4d94=_0x52818b;_0x45a33f[_0x862813][_0x1b4d94(0x233)]=_0xae37f2;}),_0x59a613[_0x52818b(0x24e)]((_0x3d8a76,_0x5e55cd)=>{var _0x743659=_0x52818b;_0x45a33f[_0x5e55cd][_0x743659(0x2cc)]=_0x3d8a76;}),_0x4c4af[_0x52818b(0x24e)]((_0x5869ff,_0x66532c)=>{_0x45a33f[_0x66532c]['return_qty']=_0x5869ff;}),_0x4a795a[_0x52818b(0x24e)]((_0x3a813f,_0x105991)=>{var _0x215552=_0x52818b;_0x45a33f[_0x105991][_0x215552(0x297)]=_0x3a813f;}),_0x9a52ca[_0x52818b(0x24e)]((_0x115ffa,_0x33f953)=>{var _0x153c85=_0x52818b;_0x45a33f[_0x33f953][_0x153c85(0x1ec)]=_0x115ffa;}),_0x24ae45[_0x52818b(0x24e)]((_0x897e18,_0x28c8ec)=>{_0x45a33f[_0x28c8ec]['maxProducts']=_0x897e18;}),_0x5ad5f1[_0x52818b(0x24e)]((_0x36c8eb,_0x590b6e)=>{_0x45a33f[_0x590b6e]['batch_code']=_0x36c8eb;}),_0x4eb0de[_0x52818b(0x24e)]((_0x5024a8,_0x2490dd)=>{var _0x351999=_0x52818b;_0x45a33f[_0x2490dd][_0x351999(0x2a7)]=_0x5024a8;}),_0x4754bf[_0x52818b(0x24e)]((_0x389166,_0x2ae64e)=>{_0x45a33f[_0x2ae64e]['unit']=_0x389166;}),_0x14348f[_0x52818b(0x24e)]((_0x435a06,_0x4306ad)=>{var _0x2bdfcd=_0x52818b;_0x45a33f[_0x4306ad][_0x2bdfcd(0x1f0)]=_0x435a06;}),_0xfba86e[_0x52818b(0x24e)]((_0x9c1a20,_0x2aea34)=>{var _0x1b9d2e=_0x52818b;_0x45a33f[_0x2aea34][_0x1b9d2e(0x200)]=_0x9c1a20;});var _0x5bcd6e=0x0;_0x45a33f['forEach'](_0xdf1341=>{var _0x408232=_0x52818b;(parseInt(_0xdf1341[_0x408232(0x2cc)])<parseInt(_0xdf1341[_0x408232(0x1b3)])||parseInt(_0xdf1341[_0x408232(0x203)])<parseInt(_0xdf1341[_0x408232(0x1b3)])&&parseInt(_0xdf1341[_0x408232(0x2cc)])>parseInt(_0xdf1341[_0x408232(0x1b3)])||parseInt(_0xdf1341[_0x408232(0x1b3)])==0x0)&&_0x5bcd6e++;});if(_0x5bcd6e!=0x0)return _0x5aa7ec[_0x52818b(0x28d)](_0x52818b(0x1cd),_0x52818b(0x1b7)),_0x8922b6[_0x52818b(0x220)]('back');const _0x2d0e8f=await sales_finished[_0x52818b(0x242)]({'invoice':_0xdcc6aa});_0x2d0e8f['return_data']=_0x52818b(0x1eb);const _0x2b6146=await _0x2d0e8f[_0x52818b(0x2f5)](),_0x4215a9=new sales_return_finished({'invoice':_0xdcc6aa,'customer':_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x289)],'date':_0x4f8514,'warehouse_name':_0x14daa0,'room':_0xc2d0e,'ToWarehouse':_0x432aa5,'ToRoom':_0x492b32,'return_sale':_0x45a33f,'note':_0x2ef261,'warehouse_cat':_0x3dd5c1}),_0x24f3ac=await _0x4215a9[_0x52818b(0x2f5)](),_0x521ee1=await sales_return_finished[_0x52818b(0x242)]({'invoice':_0xdcc6aa}),_0x42becf=await warehouse['findOne']({'name':_0x432aa5,'room':_0x492b32,'warehouse_category':_0x52818b(0x24f)});_0x521ee1['return_sale'][_0x52818b(0x24e)](_0x26b90b=>{var _0x3b34d0=_0x52818b,_0x3f9db7=0x0;const _0x13cbb0=_0x42becf[_0x3b34d0(0x1fa)][_0x3b34d0(0x1ed)](_0x37c83f=>{var _0x1ea374=_0x3b34d0;_0x37c83f[_0x1ea374(0x2d3)]==_0x26b90b[_0x1ea374(0x2d3)]&&_0x37c83f['bay']==_0x26b90b[_0x1ea374(0x297)]&&_0x37c83f[_0x1ea374(0x200)]==_0x26b90b[_0x1ea374(0x200)]&&_0x37c83f[_0x1ea374(0x1f0)]==_0x26b90b[_0x1ea374(0x1f0)]&&_0x37c83f[_0x1ea374(0x23f)]==_0x26b90b[_0x1ea374(0x23f)]&&(_0x37c83f[_0x1ea374(0x294)]=parseInt(_0x37c83f['product_stock'])+parseInt(_0x26b90b[_0x1ea374(0x1b3)]),_0x3f9db7++);});_0x3f9db7=='0'&&(_0x42becf[_0x3b34d0(0x1fa)]=_0x42becf[_0x3b34d0(0x1fa)]['concat']({'product_name':_0x26b90b[_0x3b34d0(0x2d3)],'product_stock':_0x26b90b['return_qty'],'primary_code':_0x26b90b['primary_code'],'secondary_code':_0x26b90b['secondary_code'],'product_code':_0x26b90b[_0x3b34d0(0x233)],'bay':_0x26b90b[_0x3b34d0(0x297)],'batch_code':_0x26b90b[_0x3b34d0(0x23f)],'maxPerUnit':_0x26b90b[_0x3b34d0(0x1ec)],'production_date':_0x26b90b[_0x3b34d0(0x1f0)],'expiry_date':_0x26b90b['expiry_date'],'secondary_unit':_0x26b90b[_0x3b34d0(0x2a7)],'unit':_0x26b90b[_0x3b34d0(0x227)],'maxProducts':_0x26b90b[_0x3b34d0(0x260)]}));}),await _0x42becf['save'](),console[_0x52818b(0x201)](_0x5aa7ec[_0x52818b(0x21b)]);const _0x2d4e64=new c_payment_data({'invoice':_0xdcc6aa,'customer':_0x5aa7ec[_0x52818b(0x21b)]['customer'],'reason':_0x52818b(0x2ae)});await _0x2d4e64[_0x52818b(0x2f5)]();const _0x53c9ff=await master_shop[_0x52818b(0x2d0)]();console[_0x52818b(0x201)]('add\x20post',_0x53c9ff[0x0][_0x52818b(0x2d9)]);const _0x4408a7=await email_settings[_0x52818b(0x242)](),_0x2c7c48=await customer[_0x52818b(0x242)]({'name':_0x5aa7ec[_0x52818b(0x21b)][_0x52818b(0x289)]});console[_0x52818b(0x201)]('customer_data',_0x2c7c48);_0x53c9ff[0x0][_0x52818b(0x24b)]==0x1?(right_currency=_0x53c9ff[0x0][_0x52818b(0x22a)],left_currency=''):(right_currency='',left_currency=_0x53c9ff[0x0]['currency']);var _0xa42c96=_0xd2a8b4,_0x15fbea=_0x4c4af,_0xb660ea='',_0x275695;for(_0x275695 in _0xa42c96){_0xb660ea+=_0x52818b(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa42c96[_0x275695]+'</td>'+_0x52818b(0x240)+_0x15fbea[_0x275695]+'</td>'+_0x52818b(0x258);}console[_0x52818b(0x201)](_0x52818b(0x27e),_0xb660ea);let _0x4776ef=nodemailer[_0x52818b(0x1b2)]({'service':_0x52818b(0x2b7),'auth':{'user':_0x4408a7[_0x52818b(0x29e)],'pass':_0x4408a7[_0x52818b(0x28e)]}}),_0x1ccf1c={'from':_0x4408a7[_0x52818b(0x29e)],'to':_0x2c7c48['email'],'subject':_0x52818b(0x29f),'attachments':[{'filename':_0x52818b(0x267),'path':__dirname+_0x52818b(0x1d4)+_0x52818b(0x2bb)+_0x53c9ff[0x0][_0x52818b(0x2d9)],'cid':_0x52818b(0x2a4)}],'html':_0x52818b(0x212)+_0x52818b(0x27a)+_0x52818b(0x2b3)+_0x52818b(0x29c)+_0x52818b(0x2b4)+_0x52818b(0x29c)+_0x52818b(0x2a1)+_0x52818b(0x22d)+_0x52818b(0x29c)+'<h2>\x20'+_0x53c9ff[0x0][_0x52818b(0x2c2)]+'\x20</h2>'+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x52818b(0x29b)+_0x52818b(0x290)+_0xdcc6aa+'\x20'+_0x52818b(0x208)+_0x52818b(0x250)+_0x4f8514+'\x20'+_0x52818b(0x1f1)+_0x52818b(0x25c)+_0x52818b(0x22d)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x52818b(0x1f9)+_0x52818b(0x1de)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x52818b(0x2fc)+_0x52818b(0x2c6)+'</tr>'+_0x52818b(0x1cc)+_0x52818b(0x2b0)+'\x20'+_0xb660ea+'\x20'+_0x52818b(0x23d)+'</table>'+_0x52818b(0x29c)+_0x52818b(0x2e7)+'<h5>'+_0x53c9ff[0x0][_0x52818b(0x2c2)]+_0x52818b(0x25c)+'</div>'+_0x52818b(0x22d)+'</body></html>'};_0x4776ef[_0x52818b(0x285)](_0x1ccf1c,function(_0x294f2c,_0x50ad85){var _0x4a309a=_0x52818b;_0x294f2c?(console[_0x4a309a(0x201)](_0x294f2c),console['log']('Error\x20Occurs')):console[_0x4a309a(0x201)](_0x4a309a(0x1e6));}),_0x5aa7ec[_0x52818b(0x28d)]('success',_0x52818b(0x1c2)),_0x8922b6[_0x52818b(0x220)]('/all_sales_finished/view');}catch(_0x44c5b0){console[_0x52818b(0x201)](_0x44c5b0),_0x8922b6[_0x52818b(0x2fa)](0xc8)[_0x52818b(0x1f3)]({'message1':_0x44c5b0[_0x52818b(0x23b)]});}}}),router[a0_0x3468ff(0x1bc)](a0_0x3468ff(0x259),auth,async(_0x26c182,_0x37c811)=>{var _0x201ae6=a0_0x3468ff;try{const {username:_0x1592ec,email:_0x3f0b99,role:_0xa63df5}=_0x26c182[_0x201ae6(0x224)],_0x296884=_0x26c182[_0x201ae6(0x224)],_0x3407ef=await profile[_0x201ae6(0x242)]({'email':_0x296884[_0x201ae6(0x29e)]}),_0xbb97b=await master_shop[_0x201ae6(0x2d0)]();console[_0x201ae6(0x201)](_0x201ae6(0x291),_0xbb97b);const _0x1c4cae=_0x26c182[_0x201ae6(0x2e1)]['id'],_0x4a6b12=await sales['findById'](_0x1c4cae);console[_0x201ae6(0x201)](_0x201ae6(0x241),_0x4a6b12);if(_0xbb97b[0x0]['language']==_0x201ae6(0x206))var _0x12a374=users[_0x201ae6(0x1ea)];else{if(_0xbb97b[0x0]['language']==_0x201ae6(0x264))var _0x12a374=users[_0x201ae6(0x264)];else{if(_0xbb97b[0x0][_0x201ae6(0x230)]==_0x201ae6(0x235))var _0x12a374=users['German'];else{if(_0xbb97b[0x0][_0x201ae6(0x230)]==_0x201ae6(0x218))var _0x12a374=users[_0x201ae6(0x218)];else{if(_0xbb97b[0x0][_0x201ae6(0x230)]==_0x201ae6(0x263))var _0x12a374=users[_0x201ae6(0x263)];else{if(_0xbb97b[0x0][_0x201ae6(0x230)]==_0x201ae6(0x292))var _0x12a374=users[_0x201ae6(0x293)];else{if(_0xbb97b[0x0][_0x201ae6(0x230)]==_0x201ae6(0x2a2))var _0x12a374=users[_0x201ae6(0x2a2)];else{if(_0xbb97b[0x0]['language']==_0x201ae6(0x2e8))var _0x12a374=users[_0x201ae6(0x26a)];}}}}}}}_0x37c811[_0x201ae6(0x20a)](_0x201ae6(0x2cd),{'success':_0x26c182['flash'](_0x201ae6(0x2c0)),'errors':_0x26c182['flash'](_0x201ae6(0x1cd)),'role':_0x296884,'profile':_0x3407ef,'alldata':_0x4a6b12,'master_shop':_0xbb97b,'language':_0x12a374});}catch(_0x219975){console[_0x201ae6(0x201)](_0x219975);}}),router['post'](a0_0x3468ff(0x2f3),async(_0x2594d9,_0x253c5f)=>{var _0x2b113b=a0_0x3468ff;const {product_code:_0xfb19d5,warehouse_name:_0x32e93c,rooms_data:_0x526597,Roomslist:_0x55ee92,sales_category:_0x35fa16}=_0x2594d9['body'],_0x25efae=_0x55ee92['split'](','),_0x266a30=[];async function _0x184f64(_0x2c4636){var _0x309a98=a0_0x4ef8;const _0x11c02f=await warehouse['aggregate']([{'$match':{'name':_0x32e93c,'room':_0x2c4636}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0xfb19d5}},{'$group':{'_id':_0x309a98(0x1ef),'name':{'$first':_0x309a98(0x2e0)},'product_stock':{'$first':_0x309a98(0x1c6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x309a98(0x254)},'level':{'$first':_0x309a98(0x2a0)},'bay':{'$first':_0x309a98(0x2ca)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x309a98(0x2a9)},'unit':{'$first':_0x309a98(0x205)},'secondary_unit':{'$first':_0x309a98(0x1c7)},'storage':{'$first':_0x309a98(0x2db)},'rack':{'$first':_0x309a98(0x25b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x309a98(0x1df)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x309a98(0x2d7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x309a98(0x1bf)},'invoice':{'$first':_0x309a98(0x255)},'uuid':{'$first':_0x309a98(0x2c4)},'gross_price':{'$first':_0x309a98(0x1b4)},'sales_category':{'$first':_0x309a98(0x2b9)}}}]),_0x2849f8=await warehouse[_0x309a98(0x204)]([{'$match':{'name':_0x32e93c,'room':_0x2c4636}},{'$unwind':_0x309a98(0x1d5)},{'$match':{'product_details.secondary_code':_0xfb19d5}},{'$group':{'_id':_0x309a98(0x1ef),'name':{'$first':_0x309a98(0x2e0)},'product_stock':{'$first':_0x309a98(0x1c6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x309a98(0x254)},'level':{'$first':_0x309a98(0x2ca)},'isle':{'$first':_0x309a98(0x261)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x309a98(0x2a9)},'unit':{'$first':_0x309a98(0x205)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x309a98(0x2db)},'rack':{'$first':_0x309a98(0x25b)},'expiry_date':{'$first':_0x309a98(0x284)},'production_date':{'$first':_0x309a98(0x1df)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x309a98(0x2f0)},'product_cat':{'$first':_0x309a98(0x2d7)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x309a98(0x255)},'uuid':{'$first':_0x309a98(0x2c4)},'gross_price':{'$first':'$product_details.gross_price'},'sales_category':{'$first':_0x309a98(0x2b9)}}}]);if(_0x11c02f[_0x309a98(0x2a8)]>0x0)_0x266a30[_0x309a98(0x296)](_0x11c02f);else _0x2849f8[_0x309a98(0x2a8)]>0x0&&_0x266a30['push'](_0x2849f8);}const _0x4b256c=_0x25efae[_0x2b113b(0x1ed)](_0x34ead7=>_0x184f64(_0x34ead7));await Promise[_0x2b113b(0x26c)](_0x4b256c),_0x253c5f[_0x2b113b(0x1f3)](_0x266a30);}),router[a0_0x3468ff(0x1c9)](a0_0x3468ff(0x1e2),async(_0xef5178,_0x5d0728)=>{var _0x3adc58=a0_0x3468ff;const {product_code:_0x496cf3,warehouse_name:_0x16b00a,rooms_data:_0x1a8d1f,Roomslist:_0x258ad5,sales_category:_0x47aba8}=_0xef5178[_0x3adc58(0x21b)],_0x3fa788=_0x258ad5[_0x3adc58(0x243)](','),_0x1cb056=[];async function _0x3e4888(_0x3cb347){var _0x13a5a4=_0x3adc58;const _0x52784a=await warehouse[_0x13a5a4(0x204)]([{'$match':{'name':_0x16b00a,'room':_0x3cb347}},{'$unwind':_0x13a5a4(0x1d5)},{'$match':{'product_details.primary_code':_0x496cf3,'product_details.sales_category':_0x47aba8,'product_details.type_products':_0x13a5a4(0x201)}},{'$group':{'_id':_0x13a5a4(0x1ef),'name':{'$first':_0x13a5a4(0x2e0)},'product_stock':{'$first':_0x13a5a4(0x1c6)},'primary_code':{'$first':_0x13a5a4(0x2e6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x13a5a4(0x254)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x13a5a4(0x2ca)},'type':{'$first':_0x13a5a4(0x2eb)},'pallet':{'$first':_0x13a5a4(0x2a9)},'unit':{'$first':_0x13a5a4(0x205)},'secondary_unit':{'$first':_0x13a5a4(0x1c7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x13a5a4(0x25b)},'expiry_date':{'$first':_0x13a5a4(0x284)},'production_date':{'$first':_0x13a5a4(0x1df)},'maxPerUnit':{'$first':_0x13a5a4(0x277)},'batch_code':{'$first':_0x13a5a4(0x2f0)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x13a5a4(0x255)},'uuid':{'$first':_0x13a5a4(0x2c4)},'gross_price':{'$first':_0x13a5a4(0x1b4)},'sales_category':{'$first':_0x13a5a4(0x2b9)},'type_products':{'$first':_0x13a5a4(0x1e5)}}}]);console[_0x13a5a4(0x201)](_0x13a5a4(0x201)+_0x13a5a4(0x237)+_0x496cf3+_0x13a5a4(0x237)+_0x47aba8);const _0x23321f=await warehouse[_0x13a5a4(0x204)]([{'$match':{'name':_0x16b00a,'room':_0x3cb347}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x496cf3,'product_details.sales_category':_0x47aba8,'product_details.type_products':_0x13a5a4(0x201)}},{'$group':{'_id':_0x13a5a4(0x1ef),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x13a5a4(0x2e6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x13a5a4(0x2ca)},'isle':{'$first':_0x13a5a4(0x261)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x13a5a4(0x2a9)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x13a5a4(0x1c7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x13a5a4(0x25b)},'expiry_date':{'$first':_0x13a5a4(0x284)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x13a5a4(0x277)},'batch_code':{'$first':_0x13a5a4(0x2f0)},'product_cat':{'$first':_0x13a5a4(0x2d7)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x13a5a4(0x1bf)},'invoice':{'$first':_0x13a5a4(0x255)},'uuid':{'$first':_0x13a5a4(0x2c4)},'gross_price':{'$first':_0x13a5a4(0x1b4)},'sales_category':{'$first':'$product_details.sales_category'},'type_products':{'$first':'$product_details.type_products'}}}]);if(_0x52784a['length']>0x0)_0x1cb056['push'](_0x52784a);else _0x23321f[_0x13a5a4(0x2a8)]>0x0&&_0x1cb056[_0x13a5a4(0x296)](_0x23321f);}const _0x4d4330=_0x3fa788[_0x3adc58(0x1ed)](_0x404ee3=>_0x3e4888(_0x404ee3));await Promise[_0x3adc58(0x26c)](_0x4d4330),_0x5d0728['json'](_0x1cb056);}),router[a0_0x3468ff(0x1c9)](a0_0x3468ff(0x249),async(_0x12c8de,_0xccdfb5)=>{var _0xb2de9d=a0_0x3468ff;try{const {prduct_code:_0x1233c6,warehouse_data:_0x42174f,qty_req:_0x42e090}=_0x12c8de[_0xb2de9d(0x21b)];let _0x108c89=_0x1233c6['split']('~'),_0x4ad0e2=_0x42e090[_0xb2de9d(0x243)]('~'),_0x544729=[],_0x209f91=0x0;for(let _0xbd40ea=0x0;_0xbd40ea<=_0x108c89[_0xb2de9d(0x2a8)]-0x1;_0xbd40ea++){const _0x46d907=_0x108c89[_0xbd40ea],_0x214e4f=_0x4ad0e2[_0xbd40ea],_0xf33918=await warehouse['aggregate']([{'$match':{'name':_0x42174f}},{'$unwind':_0xb2de9d(0x1d5)},{'$match':{'product_details.product_code':_0x46d907,'product_details.isAvailable':_0xb2de9d(0x1d3),'product_details.isUsed':_0xb2de9d(0x244)}},{'$sort':{'product_details.date_received':0x1,'product_details.level':-0x1,'product_details.bay':-0x1}},{'$group':{'_id':_0xb2de9d(0x1ef),'name':{'$first':_0xb2de9d(0x2e0)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xb2de9d(0x231)},'product_code':{'$first':_0xb2de9d(0x254)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0xb2de9d(0x2ca)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xb2de9d(0x2a9)},'unit':{'$first':_0xb2de9d(0x205)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0xb2de9d(0x2db)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xb2de9d(0x284)},'production_date':{'$first':_0xb2de9d(0x1df)},'maxPerUnit':{'$first':_0xb2de9d(0x277)},'batch_code':{'$first':_0xb2de9d(0x2f0)},'product_cat':{'$first':_0xb2de9d(0x2d7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xb2de9d(0x1bf)},'invoice':{'$first':_0xb2de9d(0x255)},'uuid':{'$first':_0xb2de9d(0x2c4)},'gross_price':{'$first':_0xb2de9d(0x1b4)},'sales_category':{'$first':'$product_details.sales_category'},'date_received':{'$first':_0xb2de9d(0x2f7)},'warehouse_id':{'$first':_0xb2de9d(0x2b5)}}}]),_0x3ed8c7=_0xf33918[_0xb2de9d(0x2f6)]((_0x89d4ed,_0x31017b)=>new Date(_0x89d4ed['date_received'])-new Date(_0x31017b['date_received']));let _0x4a255a=_0x214e4f;for(let _0x29139a=0x0;_0x29139a<=_0x3ed8c7[_0xb2de9d(0x2a8)]-0x1&&_0x4a255a>0x0;_0x29139a++){const _0x1944aa=_0x3ed8c7[_0x29139a];if(_0x1944aa[_0xb2de9d(0x233)]==_0x46d907){_0x544729[_0x209f91]={};const _0x55f042=parseInt(_0x1944aa['product_stock']),_0x5a30a8=0x0;let _0xc4ae2b=_0x55f042-_0x5a30a8,_0x325dd9=Math['min'](_0x4a255a,_0xc4ae2b);console['log'](_0xb2de9d(0x1be)+_0x325dd9+_0xb2de9d(0x1c4)+_0x42174f+_0xb2de9d(0x21e)+_0x1944aa['roomNamed']+_0xb2de9d(0x1b1)+(_0x1944aa[_0xb2de9d(0x298)]+_0x1944aa[_0xb2de9d(0x297)])+_0xb2de9d(0x29d)+_0x1944aa[_0xb2de9d(0x1e7)]+_0xb2de9d(0x280)+_0x1944aa[_0xb2de9d(0x1e4)]),_0x544729[_0x209f91][_0xb2de9d(0x219)]=_0x1944aa[_0xb2de9d(0x266)]+'~'+_0x1944aa[_0xb2de9d(0x217)]+'~'+_0x325dd9,_0x544729[_0x209f91][_0xb2de9d(0x2d3)]=_0x1944aa['name'],_0x544729[_0x209f91][_0xb2de9d(0x233)]=_0x1944aa[_0xb2de9d(0x233)],_0x544729[_0x209f91][_0xb2de9d(0x256)]=_0x1944aa[_0xb2de9d(0x256)],_0x544729[_0x209f91]['date_recieved']=_0x1944aa[_0xb2de9d(0x28b)],_0x544729[_0x209f91][_0xb2de9d(0x248)]=_0x1944aa[_0xb2de9d(0x248)],_0x544729[_0x209f91][_0xb2de9d(0x23c)]=_0x1944aa[_0xb2de9d(0x23c)],_0x544729[_0x209f91][_0xb2de9d(0x271)]=_0x325dd9,_0x544729[_0x209f91][_0xb2de9d(0x227)]=_0x1944aa['unit'],_0x544729[_0x209f91][_0xb2de9d(0x2a7)]=_0x1944aa[_0xb2de9d(0x2a7)],_0x544729[_0x209f91][_0xb2de9d(0x247)]=_0x1944aa['primary_code'],_0x544729[_0x209f91][_0xb2de9d(0x24a)]=_0x1944aa[_0xb2de9d(0x24a)],_0x544729[_0x209f91][_0xb2de9d(0x1ee)]=_0x1944aa[_0xb2de9d(0x1ee)],_0x544729[_0x209f91][_0xb2de9d(0x23f)]=_0x1944aa[_0xb2de9d(0x23f)],_0x544729[_0x209f91][_0xb2de9d(0x200)]=_0x1944aa[_0xb2de9d(0x200)],_0x544729[_0x209f91][_0xb2de9d(0x1f0)]=_0x1944aa['production_date'],_0x544729[_0x209f91]['maxperunit']=_0x1944aa[_0xb2de9d(0x24c)],_0x544729[_0x209f91][_0xb2de9d(0x2e3)]=_0x1944aa[_0xb2de9d(0x2e3)],_0x544729[_0x209f91][_0xb2de9d(0x210)]=_0x1944aa['invoice'],_0x544729[_0x209f91]['gross_price']=_0x1944aa[_0xb2de9d(0x1f4)],_0x544729[_0x209f91][_0xb2de9d(0x21d)]=_0x1944aa['roomNamed'],_0x544729[_0x209f91][_0xb2de9d(0x298)]=_0x1944aa['level'],_0x544729[_0x209f91][_0xb2de9d(0x297)]=_0x1944aa['bay'],_0x544729[_0x209f91][_0xb2de9d(0x2fa)]=_0xb2de9d(0x1d3),console[_0xb2de9d(0x201)]('1',_0x209f91),_0x4a255a-=_0x325dd9,_0x209f91++;if(_0x4a255a<=0x0)break;}}if(_0x4a255a>0x0){var _0x18baaa=await product['findOne']({'product_code':_0x46d907});console['log']('2',_0x209f91),_0x544729[_0x209f91]={},_0x544729[_0x209f91][_0xb2de9d(0x2d3)]=_0x18baaa[_0xb2de9d(0x1e4)],_0x544729[_0x209f91]['product_code']=_0x46d907,_0x544729[_0x209f91][_0xb2de9d(0x256)]=_0x18baaa[_0xb2de9d(0x217)][_0xb2de9d(0x2a6)](),_0x544729[_0x209f91][_0xb2de9d(0x271)]=_0x4a255a,_0x544729[_0x209f91][_0xb2de9d(0x2ed)]=_0x18baaa['unit'],_0x544729[_0x209f91]['secondary_unit']=_0x18baaa[_0xb2de9d(0x274)],_0x544729[_0x209f91][_0xb2de9d(0x247)]=_0x18baaa[_0xb2de9d(0x247)],_0x544729[_0x209f91][_0xb2de9d(0x24a)]=_0x18baaa['secondary_code'],_0x544729[_0x209f91]['maxStocks']=_0x18baaa['maxStocks'],_0x544729[_0x209f91][_0xb2de9d(0x24c)]=_0x18baaa[_0xb2de9d(0x1fc)],_0x544729[_0x209f91][_0xb2de9d(0x1f4)]=_0x18baaa['gross_price'],_0x544729[_0x209f91][_0xb2de9d(0x2fa)]=_0xb2de9d(0x244),console[_0xb2de9d(0x201)](_0xb2de9d(0x278)+_0x4a255a+_0xb2de9d(0x269)+_0x209f91+_0xb2de9d(0x237)+_0x46d907),_0x209f91++;}}_0xccdfb5[_0xb2de9d(0x1f3)](_0x544729);}catch(_0xb8e0f9){console['log'](_0xb8e0f9);}}),router[a0_0x3468ff(0x1c9)](a0_0x3468ff(0x26b),async(_0x5cd3a1,_0x20d509)=>{var _0x4358f4=a0_0x3468ff;const {product_code:_0x358ea4}=_0x5cd3a1[_0x4358f4(0x21b)];var _0x21447b;const _0x1a1391=await product[_0x4358f4(0x204)]([{'$match':{'primary_code':_0x358ea4}},{'$group':{'_id':'$_id','name':{'$first':_0x4358f4(0x223)},'category':{'$first':_0x4358f4(0x2f4)},'brand':{'$first':_0x4358f4(0x273)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x4358f4(0x1bb)},'product_code':{'$first':_0x4358f4(0x2dc)},'primary_code':{'$first':_0x4358f4(0x226)},'secondary_code':{'$first':_0x4358f4(0x1b5)},'maxStocks':{'$first':_0x4358f4(0x2c3)},'maxProdPerUnit':{'$first':_0x4358f4(0x272)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4358f4(0x1b9)},'gross_price':{'$first':_0x4358f4(0x2ab)},'sales_category':{'$first':_0x4358f4(0x1f6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x389cfb=await product['aggregate']([{'$match':{'secondary_code':_0x358ea4}},{'$group':{'_id':_0x4358f4(0x2b5),'name':{'$first':_0x4358f4(0x223)},'category':{'$first':_0x4358f4(0x2f4)},'brand':{'$first':_0x4358f4(0x273)},'unit':{'$first':_0x4358f4(0x1ff)},'alertquantity':{'$first':_0x4358f4(0x1bb)},'product_code':{'$first':_0x4358f4(0x2dc)},'primary_code':{'$first':_0x4358f4(0x226)},'secondary_code':{'$first':_0x4358f4(0x1b5)},'maxStocks':{'$first':_0x4358f4(0x2c3)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'},'gross_price':{'$first':_0x4358f4(0x2ab)},'sales_category':{'$first':_0x4358f4(0x1f6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x1a1391[_0x4358f4(0x2a8)]>0x0)_0x21447b=_0x1a1391;else _0x389cfb[_0x4358f4(0x2a8)]>0x0&&(_0x21447b=_0x389cfb);_0x20d509[_0x4358f4(0x1f3)](_0x21447b);}),router[a0_0x3468ff(0x1c9)]('/process/view',async(_0x43fcf9,_0x5681ad)=>{var _0x267ad0=a0_0x3468ff;try{const {group_id:_0x34c7e3,DRSI:_0x5e5f69,dateofreq:_0x3a12fc,PO_number:_0x19dc06,date:_0x175ec3,warehouse_name:_0x3a207a,typevehicle:_0x3641db,deliverydate:_0x3058a4,driver:_0x15240a,plate:_0x5df85c,van:_0x5739fd,TSU:_0x1302eb,actual_delivery_date:_0xaf4d84,TFU:_0x482766,pull_out_date:_0xd35873,sales:_0x49cdec,Customer_data:_0x56e185,note:_0x3495d7}=_0x43fcf9[_0x267ad0(0x21b)],_0x32cb0e=mongoose[_0x267ad0(0x28f)][_0x267ad0(0x22f)];let _0x56a5b2=[];const _0x58ab4=new invoice_for_outgoing();await _0x58ab4[_0x267ad0(0x2f5)]();const _0x505687='OUT-'+_0x58ab4[_0x267ad0(0x1d9)][_0x267ad0(0x2a5)]()[_0x267ad0(0x21c)](0x8,'0');if(typeof _0x34c7e3==_0x267ad0(0x2e5)){let _0x241b53=_0x34c7e3['split']('~');var _0x393f34=_0x32cb0e(_0x241b53[0x0]),_0x3a0caf=_0x32cb0e(_0x241b53[0x1]),_0x243d4b=_0x241b53[0x2];let _0x272098=0x0;const _0x13d2ee=await warehouse[_0x267ad0(0x204)]([{'$match':{'_id':_0x393f34}},{'$unwind':_0x267ad0(0x1d5)},{'$match':{'product_details._id':_0x3a0caf}}]);await warehouse[_0x267ad0(0x1fd)]({'_id':_0x32cb0e(_0x393f34),'product_details._id':_0x32cb0e(_0x3a0caf)},{'$set':{'product_details.$.isUsed':'true'}}),_0x56a5b2[_0x272098]={};for(let _0x107313=0x0;_0x107313<=_0x13d2ee[_0x267ad0(0x2a8)]-0x1;_0x107313++){const _0x808f20=_0x13d2ee[_0x107313];console[_0x267ad0(0x201)](_0x808f20),_0x56a5b2[_0x272098][_0x267ad0(0x2e4)]=_0x808f20['name'],_0x56a5b2[_0x272098]['product_id']=_0x808f20['product_details']['product_id'],_0x56a5b2[_0x272098][_0x267ad0(0x2d3)]=_0x808f20['product_details'][_0x267ad0(0x2d3)],_0x56a5b2[_0x272098]['product_code']=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x233)],_0x56a5b2[_0x272098][_0x267ad0(0x294)]=_0x243d4b,_0x56a5b2[_0x272098]['quantity']=_0x243d4b,_0x56a5b2[_0x272098][_0x267ad0(0x227)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x227)],_0x56a5b2[_0x272098]['secondary_unit']=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x2a7)],_0x56a5b2[_0x272098][_0x267ad0(0x298)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x298)],_0x56a5b2[_0x272098]['bay']=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x297)],_0x56a5b2[_0x272098][_0x267ad0(0x247)]=_0x808f20[_0x267ad0(0x1fa)]['primary_code'],_0x56a5b2[_0x272098][_0x267ad0(0x24a)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x24a)],_0x56a5b2[_0x272098]['maxStocks']=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x1ee)],_0x56a5b2[_0x272098][_0x267ad0(0x23f)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x23f)],_0x56a5b2[_0x272098][_0x267ad0(0x200)]=_0x808f20['product_details'][_0x267ad0(0x200)],_0x56a5b2[_0x272098][_0x267ad0(0x1f0)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x1f0)],_0x56a5b2[_0x272098][_0x267ad0(0x24c)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x24c)],_0x56a5b2[_0x272098][_0x267ad0(0x2e3)]=_0x808f20[_0x267ad0(0x1fa)]['product_cat'],_0x56a5b2[_0x272098][_0x267ad0(0x21d)]=_0x808f20[_0x267ad0(0x288)],_0x56a5b2[_0x272098]['invoice']=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x210)],_0x56a5b2[_0x272098][_0x267ad0(0x23c)]=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x23c)],_0x56a5b2[_0x272098][_0x267ad0(0x1f4)]=_0x808f20['product_details'][_0x267ad0(0x1f4)],_0x56a5b2[_0x272098]['sales_category']=_0x808f20[_0x267ad0(0x1fa)][_0x267ad0(0x2de)],_0x56a5b2[_0x272098]['date_recieved']=_0x808f20[_0x267ad0(0x1fa)]['date_recieved'],_0x56a5b2[_0x272098][_0x267ad0(0x251)]=_0x808f20[_0x267ad0(0x1fa)]['sales'],_0x56a5b2[_0x272098]['warehouse_id']=_0x808f20[_0x267ad0(0x217)]['valueOf'](),_0x56a5b2[_0x272098]['warehouse_id_detl']=_0x808f20['product_details']['_id']['valueOf'](),_0x56a5b2[_0x272098][_0x267ad0(0x21f)]='out',_0x56a5b2[_0x272098][_0x267ad0(0x268)]=_0x808f20[_0x267ad0(0x1fa)]['sales'];}_0x56a5b2[_0x272098]['outgoiug_inv']=_0x505687;}else for(let _0x3d64a9=0x0;_0x3d64a9<=_0x34c7e3['length']-0x1;_0x3d64a9++){const _0x33a56e=_0x34c7e3[_0x3d64a9];let _0xc2e2ef=_0x33a56e[_0x267ad0(0x243)]('~');console[_0x267ad0(0x201)](_0xc2e2ef);var _0x393f34=_0x32cb0e(_0xc2e2ef[0x0]),_0x3a0caf=_0x32cb0e(_0xc2e2ef[0x1]),_0x243d4b=_0xc2e2ef[0x2];const _0x338611=await warehouse[_0x267ad0(0x204)]([{'$match':{'_id':_0x393f34}},{'$unwind':_0x267ad0(0x1d5)},{'$match':{'product_details._id':_0x3a0caf}}]);await warehouse[_0x267ad0(0x1fd)]({'_id':_0x32cb0e(_0x393f34),'product_details._id':_0x32cb0e(_0x3a0caf)},{'$set':{'product_details.$.isUsed':_0x267ad0(0x1d3)}}),_0x56a5b2[_0x3d64a9]={};for(let _0x52569b=0x0;_0x52569b<=_0x338611[_0x267ad0(0x2a8)]-0x1;_0x52569b++){const _0x21902a=_0x338611[_0x52569b];_0x56a5b2[_0x3d64a9][_0x267ad0(0x2e4)]=_0x21902a[_0x267ad0(0x1e4)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x256)]=_0x21902a[_0x267ad0(0x1fa)]['product_id'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x2d3)]=_0x21902a['product_details'][_0x267ad0(0x2d3)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x233)]=_0x21902a['product_details'][_0x267ad0(0x233)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x294)]=_0x243d4b,_0x56a5b2[_0x3d64a9]['quantity']=_0x243d4b,_0x56a5b2[_0x3d64a9][_0x267ad0(0x227)]=_0x21902a['product_details'][_0x267ad0(0x227)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x2a7)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x2a7)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x298)]=_0x21902a[_0x267ad0(0x1fa)]['level'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x297)]=_0x21902a[_0x267ad0(0x1fa)]['bay'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x247)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x247)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x24a)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x24a)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x1ee)]=_0x21902a['product_details']['maxStocks'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x23f)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x23f)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x200)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x200)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x1f0)]=_0x21902a[_0x267ad0(0x1fa)]['production_date'],_0x56a5b2[_0x3d64a9]['maxperunit']=_0x21902a['product_details'][_0x267ad0(0x24c)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x2e3)]=_0x21902a['product_details'][_0x267ad0(0x2e3)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x21d)]=_0x21902a['room'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x210)]=_0x21902a[_0x267ad0(0x1fa)]['invoice'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x23c)]=_0x21902a[_0x267ad0(0x1fa)]['uuid'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x1f4)]=_0x21902a['product_details'][_0x267ad0(0x1f4)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x248)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x2de)],_0x56a5b2[_0x3d64a9]['date_recieved']=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x28b)],_0x56a5b2[_0x3d64a9][_0x267ad0(0x251)]=_0x21902a[_0x267ad0(0x1fa)]['sales'],_0x56a5b2[_0x3d64a9][_0x267ad0(0x266)]=_0x21902a[_0x267ad0(0x217)][_0x267ad0(0x2a6)](),_0x56a5b2[_0x3d64a9][_0x267ad0(0x282)]=_0x21902a[_0x267ad0(0x1fa)]['_id'][_0x267ad0(0x2a6)](),_0x56a5b2[_0x3d64a9][_0x267ad0(0x21f)]=_0x267ad0(0x275),_0x56a5b2[_0x3d64a9][_0x267ad0(0x268)]=_0x21902a[_0x267ad0(0x1fa)][_0x267ad0(0x2de)];}_0x56a5b2[_0x3d64a9][_0x267ad0(0x1e8)]=_0x505687;}for(let _0x29632d=0x0;_0x29632d<=_0x56a5b2['length']-0x1;_0x29632d++){const _0x4ba664=_0x56a5b2[_0x29632d],_0x145da5=new warehouse_temporary(_0x4ba664);await _0x145da5[_0x267ad0(0x2f5)]();}const _0x591f7c=new sales_finished({'invoice':_0x505687,'sales_data':_0x49cdec,'customer':_0x56e185,'date':_0x175ec3,'warehouse_name':_0x3a207a,'sale_product':_0x56a5b2,'note':_0x3495d7,'finalize':'False','dateofreq':_0x3a12fc,'PO_number':_0x19dc06,'typevehicle':_0x3641db,'deliverydate':_0x3058a4,'driver':_0x15240a,'plate':_0x5df85c,'van':_0x5739fd,'DRSI':_0x5e5f69,'TSU':_0x1302eb,'TFU':_0x482766,'pullout_date':_0xd35873,'actualdelivery_date':_0xaf4d84,'typeOfProducts':_0x267ad0(0x1c0)}),_0x2c32d6=await _0x591f7c[_0x267ad0(0x2f5)]();_0x43fcf9[_0x267ad0(0x28d)]('success',_0x267ad0(0x2ad)),_0x5681ad['redirect'](_0x267ad0(0x283)+_0x2c32d6['_id']);}catch(_0x46d92b){console[_0x267ad0(0x201)](_0x46d92b);}}),module['exports']=router;