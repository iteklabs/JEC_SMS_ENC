var a0_0x56e626=a0_0x1233;(function(_0x593840,_0x2fc1e1){var _0x5c8104=a0_0x1233,_0x5de165=_0x593840();while(!![]){try{var _0xe58e8c=-parseInt(_0x5c8104(0x178))/0x1+-parseInt(_0x5c8104(0x14f))/0x2+parseInt(_0x5c8104(0x146))/0x3*(parseInt(_0x5c8104(0xd1))/0x4)+-parseInt(_0x5c8104(0x1b9))/0x5*(parseInt(_0x5c8104(0x14c))/0x6)+parseInt(_0x5c8104(0x15a))/0x7*(parseInt(_0x5c8104(0x17d))/0x8)+parseInt(_0x5c8104(0x1ec))/0x9*(-parseInt(_0x5c8104(0xef))/0xa)+parseInt(_0x5c8104(0xfc))/0xb*(parseInt(_0x5c8104(0xb7))/0xc);if(_0xe58e8c===_0x2fc1e1)break;else _0x5de165['push'](_0x5de165['shift']());}catch(_0x3a648f){_0x5de165['push'](_0x5de165['shift']());}}}(a0_0x1d88,0x6966c));function a0_0x1d88(){var _0x279bfa=['Portuguese','body','$sale_product.quantity','$product_details.level','$maxStocks','product_cat','floor','true','min','Enclosed','false','/view/add_sales_logs','padStart','$product_details.bay','2161175rNRlja','Spanish','$customer','add_sales_finished_logs','$name','</td>','</span>','date_received','Sale\x20Return','/barcode_scanner','updateOne','edit_sales_finished_view','/give_payment/:id','$product_details._id','primary_unit','$invoice','name','$product_details.product_code','purchases_data','outgoiug_inv','group_ids','concat','date_data','email','$sale_product.floorlevel','prod_invoice','<h2>\x20','maxperunit','$finalize','room','</thead>','image','product','user','status','for_categorize','log','$product_details','$product_details.maxProducts','finalize','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$customers_docs','valueOf','Types','invoice','/view/return_sales/:id','carton','</div>','createTransport','product_name_QA1','sales','486YAFScN','return_data','max_per_unit','$product.product_name','currency_placement','getFullYear','own','nodemailer','$product_details.sales_category','$brand','sales_quantity','$return_data','Distributing\x20','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sales\x20item\x20return\x20successfull','Chinese','</h5>','primary_code','master','/process/view','redirect','$unit','production_date','outgoing_invoice','secondary_unit','LOG-OUT-','slice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','all','../public/language/languages.json','2784924IhdkQj','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','catch','$room','render','findOne','French','<div>','forEach','date_recieved','primary_code_QA','length','$alertquantity','product_id','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','get','bay','currency','maxProducts','date','max','There\x20is\x20','secondary_code_QA','map','Logo.png','</body></html>','732QjZCcI','roomNamed','There\x27s\x20a\x20error\x20in\x20this\x20transaction','OUTF-','sale_qty','aggregate','$product_details.uuid','\x20Order\x20Number\x20:\x20','level2','batch_code','/invoice/:id','/view/add_sale/product','$sale_product.bay','split','agent_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.secondary_unit','maxPerUnit_QA','json','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.unit','room_name','$product_details.floorlevel','received_amount','<html><head><title></title>','quantity','find','<tbody\x20style=\x22text-align:\x20center;\x22>','True','express','6100IPMuKt','maxProducts_QA','/all_sales_finished/view','False','return_qty_QA','Received\x20Payment\x20For\x20Sale','$product_details.product_stock','German','English','expiry_date_QA','unit','<h5>','../middleware/auth','11xVfOWZ','$product_details.room_name','site_title','<hr\x20class=\x22my-3\x22>','string','filter','product_details','expiry_date','$sale_product.bin','Arabic\x20(ae)','standard_unit','product_stock','</table>','success','language','batch_code_QA','product_list','Return\x20Goods','../models/all_models','$product_details.product_cat','\x20Name:\x20','logs','gross_price','return_qty','$sale_product','<strong>\x20Regards\x20</strong>','ObjectId','/../public','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','Arabic','$gross_price','$product_details.bin','barcode\x20Product\x20master','all_sales_barcode','invoice_init','match','$date','uuid','$secondary_unit','maxStocks','second_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Portuguese\x20(BR)','back','OUT-','then','$product_details.rack','amount','Finished\x20Goods','$product_details.maxPerUnit','$product_code','_id','sendMail','product_code','product_code_QA','$product_details.production_date','product_data','$product_details.type','/view_log','prod_cat','Error\x20Occurs','\x20Date:\x20','/barcode_scanner_auto_data','add_sales_finished','Router','</head><body>','/barcode_scanner_logs','/all_sales_finished/preview/','\x20Order\x20Date\x20:\x20','id_transaction_from','stocks_QA','$warehouse_name','warehouse_name','/view','8448UhOiSP','findById','$maxProdPerUnit','warehouse_id_detl','\x20<>\x20','out','6rqRqbK','suppliers','message','820352afOLnd','role','$sale_product.type','Email\x20sent\x20successfully','prod_code','due_amount','<!DOCTYPE\x20html>','Sales\x20Update\x20successfully','stock','maxProdPerUnit','$sales_category','49aSIvGh','$product_details.secondary_code','product_date','Ambient','post','secondary_unit_QA','mongoose','</tbody>','sales_quantity_QA','logo','flash','\x20==\x20','level','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','$note','/view/add_sales','<tr>','push','$product_details.expiry_date','int','customer','/view/:id','$primary_code','RoomAssigned','$product_details.product_name','$category','secondary_code','data_type','exports','24669XoccMp','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.storage','Hindi','$product_details.batch_code','667816TvsBkQ','production_date_QA','Sales\x20Add\x20successfully','return_sale','Quality\x20Inspection','\x20&&\x20','sale_product','Sale\x20Return\x20Mail','unit_QA','<h5\x20style=\x22text-align:\x20left;\x22>','password','$product_details.type_products','toString','</tr>','warehouse_id','$product_details.primary_code','sales_category','$product_details.invoice','return_sale_QA','Enabled','sales_id','/preview/:id','$_id','all_sales_finished_logs','save','abs','errors','undefined','/picking_list/pdf/','getMonth','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','here','gmail','\x20units\x20to\x20warehouse:\x20','$secondary_code','$product_details.gross_price','/all_sales/view','<span\x20style=\x22float:\x20right;\x22>','edit_sales_finished','warehouse','customer_data','payment\x20successfull','English\x20(US)','maxPerUnit','params','staff'];a0_0x1d88=function(){return _0x279bfa;};return a0_0x1d88();}const express=require(a0_0x56e626(0xee)),app=express(),router=express[a0_0x56e626(0x13c)](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require(a0_0x56e626(0x10e)),auth=require(a0_0x56e626(0xfb)),nodemailer=require(a0_0x56e626(0x1f3)),users=require(a0_0x56e626(0xb6)),mongoose=require(a0_0x56e626(0x160));router['get'](a0_0x56e626(0x145),auth,async(_0x5f1afd,_0x141ed4)=>{var _0x2c8d65=a0_0x56e626;try{const {username:_0x5e2e85,email:_0x2fed1c,role:_0x4f50d6}=_0x5f1afd[_0x2c8d65(0x1da)],_0x3ddf1e=_0x5f1afd['user'],_0xaafefb=await profile[_0x2c8d65(0xbc)]({'email':_0x3ddf1e[_0x2c8d65(0x1d0)]}),_0x136237=await master_shop[_0x2c8d65(0xeb)]();let _0x2628c3;if(_0x3ddf1e[_0x2c8d65(0x150)]==_0x2c8d65(0x1aa)){const _0x100b7b=await staff[_0x2c8d65(0xbc)]({'email':_0x3ddf1e[_0x2c8d65(0x1d0)]});_0x2628c3=await sales_finished['aggregate']([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2c8d65(0x1c8)},'customers':{'$first':_0x2c8d65(0x1bb)},'date':{'$first':_0x2c8d65(0x120)},'warehouse_name':{'$first':_0x2c8d65(0x143)},'sale_product':{'$push':_0x2c8d65(0x114)},'note':{'$first':_0x2c8d65(0x169)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x2c8d65(0x1e2)},'total_saleproduct_quantity':{'$sum':_0x2c8d65(0x1ad)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x2c8d65(0x104)},'type':{'$addToSet':_0x2c8d65(0x151)},'pallet':{'$addToSet':_0x2c8d65(0x1d1)},'finalize':{'$first':_0x2c8d65(0x1d5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2628c3=await sales_finished[_0x2c8d65(0xd6)]([{'$match':{'typeOfProducts':'own'}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x2c8d65(0x193),'invoice':{'$first':_0x2c8d65(0x1c8)},'customers':{'$first':_0x2c8d65(0x1bb)},'date':{'$first':_0x2c8d65(0x120)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x2c8d65(0x114)},'note':{'$first':_0x2c8d65(0x169)},'return_data':{'$first':_0x2c8d65(0x1f7)},'customers_docs':{'$first':_0x2c8d65(0x1e2)},'total_saleproduct_quantity':{'$sum':_0x2c8d65(0x1ad)},'level':{'$addToSet':_0x2c8d65(0xdd)},'isle':{'$addToSet':_0x2c8d65(0x104)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x2c8d65(0x1d1)},'finalize':{'$first':_0x2c8d65(0x1d5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x136237[0x0][_0x2c8d65(0x10a)]==_0x2c8d65(0x1a7)){var _0x54ba1d=users[_0x2c8d65(0xf7)];console[_0x2c8d65(0x1dd)](_0x54ba1d);}else{if(_0x136237[0x0][_0x2c8d65(0x10a)]==_0x2c8d65(0x17b))var _0x54ba1d=users[_0x2c8d65(0x17b)];else{if(_0x136237[0x0][_0x2c8d65(0x10a)]==_0x2c8d65(0xf6))var _0x54ba1d=users[_0x2c8d65(0xf6)];else{if(_0x136237[0x0][_0x2c8d65(0x10a)]==_0x2c8d65(0x1ba))var _0x54ba1d=users[_0x2c8d65(0x1ba)];else{if(_0x136237[0x0][_0x2c8d65(0x10a)]==_0x2c8d65(0xbd))var _0x54ba1d=users[_0x2c8d65(0xbd)];else{if(_0x136237[0x0][_0x2c8d65(0x10a)]=='Portuguese\x20(BR)')var _0x54ba1d=users[_0x2c8d65(0x1ab)];else{if(_0x136237[0x0][_0x2c8d65(0x10a)]=='Chinese')var _0x54ba1d=users['Chinese'];else{if(_0x136237[0x0][_0x2c8d65(0x10a)]=='Arabic\x20(ae)')var _0x54ba1d=users[_0x2c8d65(0x119)];}}}}}}}_0x141ed4[_0x2c8d65(0xbb)]('all_sales_finished',{'success':_0x5f1afd[_0x2c8d65(0x164)](_0x2c8d65(0x109)),'errors':_0x5f1afd['flash'](_0x2c8d65(0x197)),'sales':_0x2628c3,'profile':_0xaafefb,'role':_0x3ddf1e,'master_shop':_0x136237,'language':_0x54ba1d});}catch(_0x1da273){console[_0x2c8d65(0x1dd)](_0x1da273);}}),router[a0_0x56e626(0xc6)](a0_0x56e626(0x136),auth,async(_0x1714ef,_0x15208b)=>{var _0x3ba871=a0_0x56e626;try{const {username:_0x410165,email:_0x34b045,role:_0x3eb099}=_0x1714ef[_0x3ba871(0x1da)],_0x42964e=_0x1714ef['user'],_0x229ee8=await profile[_0x3ba871(0xbc)]({'email':_0x42964e[_0x3ba871(0x1d0)]}),_0x4500cc=await master_shop[_0x3ba871(0xeb)]();let _0x6156fa;if(_0x42964e[_0x3ba871(0x150)]=='staff'){const _0x49b0e0=await staff['findOne']({'email':_0x42964e[_0x3ba871(0x1d0)]});_0x6156fa=await sales_finished['aggregate']([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0x3ba871(0x114)},{'$group':{'_id':_0x3ba871(0x193),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3ba871(0x1bb)},'date':{'$first':_0x3ba871(0x120)},'warehouse_name':{'$first':_0x3ba871(0x143)},'sale_product':{'$push':_0x3ba871(0x114)},'note':{'$first':'$note'},'return_data':{'$first':_0x3ba871(0x1f7)},'customers_docs':{'$first':_0x3ba871(0x1e2)},'total_saleproduct_quantity':{'$sum':_0x3ba871(0x1ad)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3ba871(0x151)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3ba871(0x1d5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x6156fa=await sales_finished[_0x3ba871(0xd6)]([{'$match':{'typeOfProducts':_0x3ba871(0x111)}},{'$unwind':_0x3ba871(0x114)},{'$group':{'_id':_0x3ba871(0x193),'invoice':{'$first':_0x3ba871(0x1c8)},'customers':{'$first':_0x3ba871(0x1bb)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3ba871(0x143)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x3ba871(0x1f7)},'customers_docs':{'$first':_0x3ba871(0x1e2)},'total_saleproduct_quantity':{'$sum':_0x3ba871(0x1ad)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3ba871(0x1d5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4500cc[0x0][_0x3ba871(0x10a)]==_0x3ba871(0x1a7)){var _0x143c12=users[_0x3ba871(0xf7)];console['log'](_0x143c12);}else{if(_0x4500cc[0x0][_0x3ba871(0x10a)]==_0x3ba871(0x17b))var _0x143c12=users[_0x3ba871(0x17b)];else{if(_0x4500cc[0x0]['language']==_0x3ba871(0xf6))var _0x143c12=users[_0x3ba871(0xf6)];else{if(_0x4500cc[0x0][_0x3ba871(0x10a)]==_0x3ba871(0x1ba))var _0x143c12=users[_0x3ba871(0x1ba)];else{if(_0x4500cc[0x0]['language']==_0x3ba871(0xbd))var _0x143c12=users[_0x3ba871(0xbd)];else{if(_0x4500cc[0x0][_0x3ba871(0x10a)]==_0x3ba871(0x126))var _0x143c12=users[_0x3ba871(0x1ab)];else{if(_0x4500cc[0x0]['language']==_0x3ba871(0x1fc))var _0x143c12=users[_0x3ba871(0x1fc)];else{if(_0x4500cc[0x0]['language']==_0x3ba871(0x105))var _0x143c12=users[_0x3ba871(0x119)];}}}}}}}_0x15208b[_0x3ba871(0xbb)](_0x3ba871(0x194),{'success':_0x1714ef[_0x3ba871(0x164)](_0x3ba871(0x109)),'errors':_0x1714ef[_0x3ba871(0x164)]('errors'),'sales':_0x6156fa,'profile':_0x229ee8,'role':_0x42964e,'master_shop':_0x4500cc,'language':_0x143c12});}catch(_0x2cd777){console[_0x3ba871(0x1dd)](_0x2cd777);}});async function getRandom8DigitNumber(){var _0x34232f=a0_0x56e626;const _0x118fa0=0x989680,_0x5382d0=0x5f5e0ff,_0x478d0d=Math[_0x34232f(0x1b1)](Math['random']()*(_0x5382d0-_0x118fa0+0x1))+_0x118fa0;var _0x4d8fdc;const _0x3058ab=await sales_finished[_0x34232f(0xbc)]({'invoice':_0x34232f(0xd4)+_0x478d0d});return _0x3058ab&&_0x3058ab[_0x34232f(0xc2)]>0x0?_0x4d8fdc=_0x34232f(0xd4)+_0x478d0d:_0x4d8fdc=_0x34232f(0xd4)+_0x478d0d,_0x4d8fdc;}function a0_0x1233(_0x823990,_0x5e164c){var _0x1d8875=a0_0x1d88();return a0_0x1233=function(_0x123399,_0x2fb849){_0x123399=_0x123399-0xa9;var _0x224bc3=_0x1d8875[_0x123399];return _0x224bc3;},a0_0x1233(_0x823990,_0x5e164c);}router[a0_0x56e626(0xc6)]('/view/add_sales',auth,async(_0x31cf26,_0x11f725)=>{var _0x4608cb=a0_0x56e626;try{const {username:_0x45ebfe,email:_0x3630f2,role:_0x16a5ba}=_0x31cf26[_0x4608cb(0x1da)],_0x4657dc=_0x31cf26[_0x4608cb(0x1da)],_0x925cf7=await profile['findOne']({'email':_0x4657dc['email']}),_0xb8ca92=await master_shop[_0x4608cb(0xeb)](),_0x5777a7=await customer[_0x4608cb(0xeb)]({});let _0xfedfb6;if(_0x4657dc[_0x4608cb(0x150)]==_0x4608cb(0x1aa)){const _0x377e09=await staff[_0x4608cb(0xbc)]({'email':_0x4657dc[_0x4608cb(0x1d0)]});_0xfedfb6=await warehouse[_0x4608cb(0xd6)]([{'$match':{'status':_0x4608cb(0x190),'name':_0x377e09['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x4608cb(0x1bd)}}},{'$sort':{'name':0x1}}]);}else _0xfedfb6=await warehouse[_0x4608cb(0xd6)]([{'$match':{'status':_0x4608cb(0x190)}},{'$group':{'_id':_0x4608cb(0x1bd),'name':{'$first':_0x4608cb(0x1bd)}}},{'$sort':{'name':0x1}}]);const _0x4f7120=await product[_0x4608cb(0xeb)]({});var _0x2576c1=[_0x4608cb(0x15d),_0x4608cb(0x1b4)];const _0x1daec1=await sales_finished['find']({}),_0x511de1=_0x1daec1[_0x4608cb(0xc2)]+0x1,_0x194ccf=_0x4608cb(0xd4)+_0x511de1['toString']()[_0x4608cb(0x1b7)](0x5,'0');if(_0xb8ca92[0x0][_0x4608cb(0x10a)]==_0x4608cb(0x1a7)){var _0x340281=users[_0x4608cb(0xf7)];console[_0x4608cb(0x1dd)](_0x340281);}else{if(_0xb8ca92[0x0][_0x4608cb(0x10a)]=='Hindi')var _0x340281=users[_0x4608cb(0x17b)];else{if(_0xb8ca92[0x0]['language']==_0x4608cb(0xf6))var _0x340281=users[_0x4608cb(0xf6)];else{if(_0xb8ca92[0x0]['language']==_0x4608cb(0x1ba))var _0x340281=users[_0x4608cb(0x1ba)];else{if(_0xb8ca92[0x0][_0x4608cb(0x10a)]==_0x4608cb(0xbd))var _0x340281=users[_0x4608cb(0xbd)];else{if(_0xb8ca92[0x0]['language']==_0x4608cb(0x126))var _0x340281=users[_0x4608cb(0x1ab)];else{if(_0xb8ca92[0x0][_0x4608cb(0x10a)]=='Chinese')var _0x340281=users[_0x4608cb(0x1fc)];else{if(_0xb8ca92[0x0]['language']==_0x4608cb(0x105))var _0x340281=users['Arabic'];}}}}}}}const _0x4317a5=getRandom8DigitNumber();_0x4317a5[_0x4608cb(0x129)](_0x1cc00f=>{var _0x215933=_0x4608cb;_0x11f725['render'](_0x215933(0x13b),{'success':_0x31cf26[_0x215933(0x164)](_0x215933(0x109)),'errors':_0x31cf26[_0x215933(0x164)]('errors'),'role':_0x4657dc,'profile':_0x925cf7,'customer':_0x5777a7,'warehouse':_0xfedfb6,'product':_0x4f7120,'invoice':_0x1cc00f,'master_shop':_0xb8ca92,'language':_0x340281,'rooms_data':_0x2576c1});})[_0x4608cb(0xb9)](_0x17564a=>{var _0xff53f=_0x4608cb;_0x31cf26['flash']('errors',_0xff53f(0xd3)),_0x11f725['redirect'](_0xff53f(0xf1));});}catch(_0x359f9d){console[_0x4608cb(0x1dd)](_0x359f9d);}}),router[a0_0x56e626(0xc6)](a0_0x56e626(0x1b6),auth,async(_0x307db6,_0x442375)=>{var _0x107de8=a0_0x56e626;try{const {username:_0x39303e,email:_0x40f252,role:_0x54f23a}=_0x307db6[_0x107de8(0x1da)],_0x4d1f5a=_0x307db6[_0x107de8(0x1da)],_0x52c8f3=await profile[_0x107de8(0xbc)]({'email':_0x4d1f5a[_0x107de8(0x1d0)]}),_0x226b25=await master_shop['find'](),_0x2066a3=await customer[_0x107de8(0xeb)]({});let _0x32482d;if(_0x4d1f5a[_0x107de8(0x150)]==_0x107de8(0x1aa)){const _0x196d2b=await staff[_0x107de8(0xbc)]({'email':_0x4d1f5a[_0x107de8(0x1d0)]});_0x32482d=await warehouse[_0x107de8(0xd6)]([{'$match':{'status':_0x107de8(0x190),'name':_0x196d2b[_0x107de8(0x1a4)]}},{'$group':{'_id':_0x107de8(0x1bd),'name':{'$first':_0x107de8(0x1bd)}}},{'$sort':{'name':0x1}}]);}else _0x32482d=await warehouse[_0x107de8(0xd6)]([{'$match':{'status':_0x107de8(0x190)}},{'$group':{'_id':'$name','name':{'$first':_0x107de8(0x1bd)}}},{'$sort':{'name':0x1}}]);const _0x3ba02b=await product['find']({});var _0x3e5db6=[_0x107de8(0x15d),_0x107de8(0x1b4)];const _0x13932e=await sales_finished[_0x107de8(0xeb)]({}),_0x2a0ceb=_0x13932e[_0x107de8(0xc2)]+0x1,_0x3ea3b6=_0x107de8(0xd4)+_0x2a0ceb[_0x107de8(0x189)]()[_0x107de8(0x1b7)](0x5,'0');if(_0x226b25[0x0]['language']==_0x107de8(0x1a7)){var _0x5d184e=users[_0x107de8(0xf7)];console['log'](_0x5d184e);}else{if(_0x226b25[0x0]['language']=='Hindi')var _0x5d184e=users[_0x107de8(0x17b)];else{if(_0x226b25[0x0][_0x107de8(0x10a)]==_0x107de8(0xf6))var _0x5d184e=users['German'];else{if(_0x226b25[0x0][_0x107de8(0x10a)]==_0x107de8(0x1ba))var _0x5d184e=users[_0x107de8(0x1ba)];else{if(_0x226b25[0x0][_0x107de8(0x10a)]=='French')var _0x5d184e=users[_0x107de8(0xbd)];else{if(_0x226b25[0x0]['language']==_0x107de8(0x126))var _0x5d184e=users[_0x107de8(0x1ab)];else{if(_0x226b25[0x0][_0x107de8(0x10a)]==_0x107de8(0x1fc))var _0x5d184e=users[_0x107de8(0x1fc)];else{if(_0x226b25[0x0][_0x107de8(0x10a)]==_0x107de8(0x105))var _0x5d184e=users['Arabic'];}}}}}}}const _0x3cae24=getRandom8DigitNumber();_0x3cae24['then'](_0x5781f5=>{var _0x422994=_0x107de8;_0x442375['render'](_0x422994(0x1bc),{'success':_0x307db6[_0x422994(0x164)](_0x422994(0x109)),'errors':_0x307db6[_0x422994(0x164)](_0x422994(0x197)),'role':_0x4d1f5a,'profile':_0x52c8f3,'customer':_0x2066a3,'warehouse':_0x32482d,'product':_0x3ba02b,'invoice':_0x5781f5,'master_shop':_0x226b25,'language':_0x5d184e,'rooms_data':_0x3e5db6});})[_0x107de8(0xb9)](_0x20ffc1=>{var _0xa50a6d=_0x107de8;_0x307db6['flash']('errors',_0xa50a6d(0xd3)),_0x442375[_0xa50a6d(0xad)]('/all_sales_finished/view');});}catch(_0x32f930){console[_0x107de8(0x1dd)](_0x32f930);}}),router[a0_0x56e626(0x15e)]('/view/add_sales_logs',auth,async(_0x299be7,_0x1fd295)=>{var _0xec7a55=a0_0x56e626;try{const {invoice:_0x164e6c,date:_0x1e1ec7,warehouse_name:_0x25095f,product_name:_0x5e97d7,note:_0x1ebde7,room:_0x558415,primary_code:_0xab9002,secondary_code:_0x1e73c8,prod_code:_0x2829a7,SCRN:_0x26e89a,ReqBy:_0x2f322f,dateofreq:_0x3129cc,PO_number:_0x4d3ed2,typeservicesData:_0x358528,typevehicle:_0x36d191,destination:_0xe89b02,deliverydate:_0x33cc29,driver:_0x478514,plate:_0x1b2212,van:_0x31b613,DRSI:_0x54469a,TSU:_0xc4962e,TFU:_0x2a2a8a,mode_transpo:_0x1e9084,name_driver:_0x111285,type_of_products:_0x47def4}=_0x299be7[_0xec7a55(0x1ac)];if(typeof _0x5e97d7=='string')var _0x4d733a=[_0x299be7['body'][_0xec7a55(0x168)]],_0x417415=[_0x299be7['body'][_0xec7a55(0x157)]],_0x330c64=[_0x299be7['body'][_0xec7a55(0x1e7)]],_0x394cc8=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0xaa)]],_0x9e98e=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x175)]],_0x285a2f=[_0x299be7[_0xec7a55(0x1ac)]['prod_code']],_0x2bc446=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0xd9)]],_0x48c842=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x1c7)]],_0x328aee=[_0x299be7[_0xec7a55(0x1ac)]['secondary_unit']],_0xd36291=[_0x299be7[_0xec7a55(0x1ac)]['batch_code']],_0x4cf7dc=[_0x299be7[_0xec7a55(0x1ac)]['expiry_date']],_0x1aed46=[_0x299be7['body']['product_date']],_0x5e4b1c=[_0x299be7['body']['max_per_unit']],_0x285dd8=[_0x299be7['body'][_0xec7a55(0x137)]],_0x4c69c4=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x172)]],_0x9462f4=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x1d2)]],_0x201a07=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x141)]],_0x2dfadb=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x121)]],_0x937587=[_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x112)]];else var _0x4d733a=[..._0x299be7['body'][_0xec7a55(0x168)]],_0x417415=[..._0x299be7[_0xec7a55(0x1ac)]['stock']],_0x330c64=[..._0x299be7[_0xec7a55(0x1ac)]['carton']],_0x394cc8=[..._0x299be7['body'][_0xec7a55(0xaa)]],_0x9e98e=[..._0x299be7['body'][_0xec7a55(0x175)]],_0x285a2f=[..._0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x153)]],_0x2bc446=[..._0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0xd9)]],_0x48c842=[..._0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x1c7)]],_0x328aee=[..._0x299be7['body']['secondary_unit']],_0xd36291=[..._0x299be7[_0xec7a55(0x1ac)]['batch_code']],_0x4cf7dc=[..._0x299be7[_0xec7a55(0x1ac)]['expiry_date']],_0x1aed46=[..._0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x15c)]],_0x5e4b1c=[..._0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x1ee)]],_0x285dd8=[..._0x299be7[_0xec7a55(0x1ac)]['prod_cat']],_0x4c69c4=[..._0x299be7[_0xec7a55(0x1ac)]['RoomAssigned']],_0x9462f4=[..._0x299be7[_0xec7a55(0x1ac)]['prod_invoice']],_0x201a07=[..._0x299be7['body']['id_transaction_from']],_0x2dfadb=[..._0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x121)]],_0x937587=[..._0x299be7['body'][_0xec7a55(0x112)]];const _0x3c5b36=_0x4d733a[_0xec7a55(0xce)](_0x8ddb8e=>{return _0x8ddb8e={'product_name':_0x8ddb8e};});_0x417415['forEach']((_0x45605e,_0x485b80)=>{var _0x4bb439=_0xec7a55;_0x3c5b36[_0x485b80][_0x4bb439(0x157)]=_0x45605e;}),_0x330c64[_0xec7a55(0xbf)]((_0x1c9519,_0x201285)=>{var _0x1bbe66=_0xec7a55;_0x3c5b36[_0x201285]['quantity']=Math[_0x1bbe66(0x196)](_0x1c9519);}),_0x4d733a['forEach']((_0x312c2d,_0x107035)=>{var _0x22b122=_0xec7a55;_0x3c5b36[_0x107035][_0x22b122(0xdf)]=_0x299be7[_0x22b122(0x1ac)][_0x22b122(0x1eb)];}),_0x937587[_0xec7a55(0xbf)]((_0x19e80f,_0x627d30)=>{_0x3c5b36[_0x627d30]['gross_price']=_0x19e80f;}),_0x2dfadb[_0xec7a55(0xbf)]((_0x7d6cd5,_0x57d656)=>{var _0x15e86c=_0xec7a55;_0x3c5b36[_0x57d656][_0x15e86c(0x121)]=_0x7d6cd5;}),_0x201a07[_0xec7a55(0xbf)]((_0x2b8c7f,_0x21eb2c)=>{var _0x187e15=_0xec7a55;_0x3c5b36[_0x21eb2c][_0x187e15(0x141)]=_0x2b8c7f;}),_0x394cc8[_0xec7a55(0xbf)]((_0x51a4bc,_0xa65d10)=>{_0x3c5b36[_0xa65d10]['primary_code']=_0x51a4bc;}),_0x9e98e[_0xec7a55(0xbf)]((_0x2986be,_0x40f325)=>{_0x3c5b36[_0x40f325]['secondary_code']=_0x2986be;}),_0x285a2f['forEach']((_0x2dda88,_0x19718e)=>{_0x3c5b36[_0x19718e]['product_code']=_0x2dda88;}),_0x2bc446[_0xec7a55(0xbf)]((_0x2fd0d7,_0x424284)=>{var _0xf279dd=_0xec7a55,_0x4828fb=_0x2fd0d7[_0xf279dd(0x11f)](/[A-Za-z]+/)[0x0],_0x1d7566=parseInt(_0x2fd0d7[_0xf279dd(0x11f)](/\d+/)[0x0]);_0x3c5b36[_0x424284][_0xf279dd(0xc7)]=_0x1d7566,_0x3c5b36[_0x424284][_0xf279dd(0x166)]=_0x4828fb;}),_0x48c842[_0xec7a55(0xbf)]((_0x5b3ca3,_0x1dd990)=>{var _0x4f27f4=_0xec7a55;_0x3c5b36[_0x1dd990][_0x4f27f4(0xf9)]=_0x5b3ca3;}),_0x328aee[_0xec7a55(0xbf)]((_0x51cb0e,_0x2fb99d)=>{var _0x31a628=_0xec7a55;_0x3c5b36[_0x2fb99d][_0x31a628(0xb1)]=_0x51cb0e;}),_0xd36291[_0xec7a55(0xbf)]((_0x591630,_0x3f62e7)=>{var _0x4f9238=_0xec7a55;_0x3c5b36[_0x3f62e7][_0x4f9238(0xda)]=_0x591630;}),_0x4cf7dc[_0xec7a55(0xbf)]((_0x597247,_0x4a295c)=>{var _0x1b6176=_0xec7a55;_0x3c5b36[_0x4a295c][_0x1b6176(0x103)]=_0x597247;}),_0x1aed46[_0xec7a55(0xbf)]((_0x181771,_0x3a23a0)=>{var _0x147007=_0xec7a55;_0x3c5b36[_0x3a23a0][_0x147007(0xaf)]=_0x181771;}),_0x5e4b1c['forEach']((_0x26d1bf,_0x4571cd)=>{var _0x124650=_0xec7a55;_0x3c5b36[_0x4571cd][_0x124650(0x1d4)]=_0x26d1bf;}),_0x285dd8[_0xec7a55(0xbf)]((_0x560ef8,_0x4471e2)=>{var _0x3776bd=_0xec7a55;_0x3c5b36[_0x4471e2][_0x3776bd(0x137)]=_0x560ef8;}),_0x4c69c4['forEach']((_0x19ebcc,_0x4e6e9a)=>{var _0x3d7f70=_0xec7a55;_0x3c5b36[_0x4e6e9a][_0x3d7f70(0xe6)]=_0x19ebcc;}),_0x9462f4['forEach']((_0x29dbd6,_0x23e54b)=>{var _0x567d90=_0xec7a55;_0x3c5b36[_0x23e54b][_0x567d90(0x1e5)]=_0x29dbd6,_0x3c5b36[_0x23e54b]['date_data']=_0x1e1ec7;});const _0x294036=new sales_logs();await _0x294036[_0xec7a55(0x195)](),_0x9462f4['forEach']((_0x27a150,_0x2e4580)=>{var _0x23a4ab=_0xec7a55;_0x3c5b36[_0x2e4580]['outgoing_invoice']='LOG-OUT-'+_0x294036['invoice_init']['toString']()[_0x23a4ab(0x1b7)](0x8,'0');});var _0x147000=0x0;_0x3c5b36[_0xec7a55(0xbf)](_0x4d3420=>{var _0x2134f1=_0xec7a55;parseFloat(_0x4d3420[_0x2134f1(0x157)])<parseFloat(_0x4d3420['quantity'])&&parseFloat(_0x4d3420[_0x2134f1(0xea)])>parseFloat(_0x4d3420['stock'])&&(console[_0x2134f1(0x1dd)](_0x4d3420[_0x2134f1(0x157)]+_0x2134f1(0x14a)+_0x4d3420[_0x2134f1(0xea)]),_0x147000++);});if(_0x147000!=0x0)return _0x299be7[_0xec7a55(0x164)](_0xec7a55(0x197),_0xec7a55(0x118)),_0x1fd295[_0xec7a55(0xad)](_0xec7a55(0x127));const _0x2dd74c=_0x3c5b36[_0xec7a55(0x101)](_0x70f8c=>_0x70f8c['quantity']!=='0'&&_0x70f8c[_0xec7a55(0xea)]!==''),_0x55f95e=new sales_finished({'invoice':_0xec7a55(0xb2)+_0x294036['invoice_init'][_0xec7a55(0x189)]()[_0xec7a55(0x1b7)](0x8,'0'),'sales_data':_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x1eb)],'customer':_0x299be7[_0xec7a55(0x1ac)][_0xec7a55(0x16f)],'date':_0x1e1ec7,'warehouse_name':_0x25095f,'sale_product':_0x2dd74c,'note':_0x1ebde7,'room':_0x558415,'primary_code':_0xab9002,'secondary_code':_0x1e73c8,'prod_code':_0x2829a7,'SCRN':_0x26e89a,'finalize':_0xec7a55(0xf2),'mode_transpo':_0x1e9084,'name_driver':_0x111285,'ReqBy':_0x2f322f,'dateofreq':_0x3129cc,'PO_number':_0x4d3ed2,'typeservicesData':_0x358528,'typevehicle':_0x36d191,'destination':_0xe89b02,'deliverydate':_0x33cc29,'driver':_0x478514,'plate':_0x1b2212,'van':_0x31b613,'DRSI':_0x54469a,'TSU':_0xc4962e,'TFU':_0x2a2a8a,'typeOfProducts':_0x47def4}),_0x2331ac=await _0x55f95e['save'](),_0x253634=await sales_finished[_0xec7a55(0xbc)]({'invoice':_0x164e6c});_0x299be7['flash']('success',_0xec7a55(0x17f)),_0x1fd295[_0xec7a55(0xad)](_0xec7a55(0x13f)+_0x2331ac[_0xec7a55(0x12f)]);}catch(_0x57a114){console[_0xec7a55(0x1dd)](_0x57a114);}}),router[a0_0x56e626(0xc6)]('/view/add_sales/:id',auth,async(_0x43ae05,_0x565eb8)=>{var _0x3b0353=a0_0x56e626;try{const _0xb67451=_0x43ae05[_0x3b0353(0x1a9)]['id'];console[_0x3b0353(0x1dd)](_0xb67451);const _0x44a2dd=await product['find'](),_0x353acc=await purchases['aggregate']([{'$match':{'warehouse_name':_0xb67451}},{'$unwind':'$product'},{'$group':{'_id':_0x3b0353(0x1ef)}}]);console[_0x3b0353(0x1dd)](_0x3b0353(0x1cb),_0x353acc),_0x565eb8['status'](0xc8)[_0x3b0353(0xe3)]({'purchases_data':_0x353acc,'product_data':_0x44a2dd});}catch(_0x4dec0d){console['log'](_0x4dec0d);}}),router[a0_0x56e626(0x15e)](a0_0x56e626(0xdc),auth,async(_0x4fcfe7,_0x263962)=>{var _0x56c32c=a0_0x56e626;try{const {warehouse_data:_0x551dab,product_data:_0x256370}=_0x4fcfe7[_0x56c32c(0x1ac)];console[_0x56c32c(0x1dd)](_0x4fcfe7[_0x56c32c(0x1ac)][_0x56c32c(0x134)]);;const _0x1a00cc=await master_shop[_0x56c32c(0xeb)]();console['log']('master',_0x1a00cc);const _0x5c93db=await product[_0x56c32c(0xbc)]({'name':_0x256370});console['log'](_0x56c32c(0x1d9),_0x5c93db);const _0x5603d2=await warehouse[_0x56c32c(0xd6)]([{'$match':{'name':_0x551dab}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x256370}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x56c32c(0xf5)}}}]);console['log'](_0x56c32c(0x1f9),_0x5603d2),_0x263962['status'](0xc8)[_0x56c32c(0xe3)]({'master':_0x1a00cc,'new_product':_0x5c93db,'stock_data':_0x5603d2});}catch(_0x5c4412){console[_0x56c32c(0x1dd)](_0x5c4412);}}),router[a0_0x56e626(0x15e)](a0_0x56e626(0x16a),auth,async(_0x5e586c,_0x7a91ab)=>{var _0x3273a4=a0_0x56e626;try{const {invoice:_0x30ed28,date:_0x621e81,warehouse_name:_0x4c94f5,product_name:_0x399621,note:_0x2abd7e,room:_0x5cadb1,primary_code:_0x4f4ef4,secondary_code:_0x5ec810,prod_code:_0x3376db,SCRN:_0x2b14a3,ReqBy:_0x30e877,dateofreq:_0x57b354,PO_number:_0x55e707,typeservicesData:_0x2d8c05,typevehicle:_0x202cac,destination:_0x5c2c3d,deliverydate:_0x42b89f,driver:_0x33fd89,plate:_0x3c2ecf,van:_0x175b2f,DRSI:_0x1d9cb4,TSU:_0x22bb4e,TFU:_0x40a670,mode_transpo:_0x5b70d7,name_driver:_0x19e3ab,pull_out_date:_0x3ff649,actual_delivery_date:_0x2e46b4}=_0x5e586c[_0x3273a4(0x1ac)];_0x7a91ab['json'](_0x5e586c[_0x3273a4(0x1ac)]);return;if(typeof _0x399621==_0x3273a4(0x100))var _0x24b1c8=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x168)]],_0x45d517=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x157)]],_0x95a5c8=[_0x5e586c[_0x3273a4(0x1ac)]['carton']],_0x24597b=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0xaa)]],_0x1e4267=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x175)]],_0x1a73a5=[_0x5e586c['body'][_0x3273a4(0x153)]],_0x229ee2=[_0x5e586c[_0x3273a4(0x1ac)]['level2']],_0x5dba91=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x1c7)]],_0x2d4747=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0xb1)]],_0x3d0eec=[_0x5e586c[_0x3273a4(0x1ac)]['batch_code']],_0x271e10=[_0x5e586c[_0x3273a4(0x1ac)]['expiry_date']],_0x4af864=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x15c)]],_0x3e1ce1=[_0x5e586c[_0x3273a4(0x1ac)]['max_per_unit']],_0x2673e7=[_0x5e586c['body'][_0x3273a4(0x137)]],_0x248377=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x172)]],_0x2fa747=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x1d2)]],_0x2218fb=[_0x5e586c[_0x3273a4(0x1ac)]['id_transaction_from']],_0x4ef943=[_0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x121)]],_0x11f32c=[_0x5e586c[_0x3273a4(0x1ac)]['gross_price']];else var _0x24b1c8=[..._0x5e586c[_0x3273a4(0x1ac)]['product_name']],_0x45d517=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x157)]],_0x95a5c8=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x1e7)]],_0x24597b=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0xaa)]],_0x1e4267=[..._0x5e586c['body'][_0x3273a4(0x175)]],_0x1a73a5=[..._0x5e586c['body']['prod_code']],_0x229ee2=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0xd9)]],_0x5dba91=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x1c7)]],_0x2d4747=[..._0x5e586c['body'][_0x3273a4(0xb1)]],_0x3d0eec=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0xda)]],_0x271e10=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x103)]],_0x4af864=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x15c)]],_0x3e1ce1=[..._0x5e586c['body']['max_per_unit']],_0x2673e7=[..._0x5e586c['body']['prod_cat']],_0x248377=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x172)]],_0x2fa747=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x1d2)]],_0x2218fb=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x141)]],_0x4ef943=[..._0x5e586c[_0x3273a4(0x1ac)]['uuid']],_0x11f32c=[..._0x5e586c[_0x3273a4(0x1ac)][_0x3273a4(0x112)]];const _0x90fd09=_0x24b1c8['map'](_0x2d80e3=>{return _0x2d80e3={'product_name':_0x2d80e3};});_0x45d517[_0x3273a4(0xbf)]((_0x46d579,_0x180981)=>{var _0x2d707f=_0x3273a4;_0x90fd09[_0x180981][_0x2d707f(0x157)]=_0x46d579;}),_0x95a5c8[_0x3273a4(0xbf)]((_0x1a643a,_0x536e4d)=>{var _0x1b0d1b=_0x3273a4;_0x90fd09[_0x536e4d][_0x1b0d1b(0xea)]=Math['abs'](_0x1a643a);}),_0x24b1c8[_0x3273a4(0xbf)]((_0x35cec4,_0x1a8445)=>{var _0x117218=_0x3273a4;_0x90fd09[_0x1a8445]['agent_id']=_0x5e586c['body'][_0x117218(0x1eb)];}),_0x11f32c['forEach']((_0x5e8015,_0x29a420)=>{_0x90fd09[_0x29a420]['gross_price']=_0x5e8015;}),_0x4ef943[_0x3273a4(0xbf)]((_0x149dd6,_0x5bed40)=>{var _0x4680b6=_0x3273a4;_0x90fd09[_0x5bed40][_0x4680b6(0x121)]=_0x149dd6;}),_0x2218fb['forEach']((_0xf7170a,_0x1c2b71)=>{_0x90fd09[_0x1c2b71]['id_transaction_from']=_0xf7170a;}),_0x24597b[_0x3273a4(0xbf)]((_0x453a00,_0x25dced)=>{_0x90fd09[_0x25dced]['primary_code']=_0x453a00;}),_0x1e4267[_0x3273a4(0xbf)]((_0xabd150,_0x5d5b4a)=>{var _0x45aef4=_0x3273a4;_0x90fd09[_0x5d5b4a][_0x45aef4(0x175)]=_0xabd150;}),_0x1a73a5[_0x3273a4(0xbf)]((_0x32bac1,_0x58952f)=>{var _0x2d59ac=_0x3273a4;_0x90fd09[_0x58952f][_0x2d59ac(0x131)]=_0x32bac1;}),_0x229ee2[_0x3273a4(0xbf)]((_0x222ff9,_0x4dc710)=>{var _0x4ba846=_0x3273a4,_0x1cf0ec=_0x222ff9[_0x4ba846(0x11f)](/[A-Za-z]+/)[0x0],_0x1fd61a=parseInt(_0x222ff9['match'](/\d+/)[0x0]);_0x90fd09[_0x4dc710][_0x4ba846(0xc7)]=_0x1fd61a,_0x90fd09[_0x4dc710]['level']=_0x1cf0ec;}),_0x5dba91[_0x3273a4(0xbf)]((_0x33c40f,_0x2735e2)=>{_0x90fd09[_0x2735e2]['unit']=_0x33c40f;}),_0x2d4747['forEach']((_0x4f29e8,_0x3e39af)=>{var _0x4f8992=_0x3273a4;_0x90fd09[_0x3e39af][_0x4f8992(0xb1)]=_0x4f29e8;}),_0x3d0eec[_0x3273a4(0xbf)]((_0xa41ff7,_0x1c6353)=>{var _0xaa90b9=_0x3273a4;_0x90fd09[_0x1c6353][_0xaa90b9(0xda)]=_0xa41ff7;}),_0x271e10[_0x3273a4(0xbf)]((_0x426410,_0x35cb62)=>{var _0x2201d0=_0x3273a4;_0x90fd09[_0x35cb62][_0x2201d0(0x103)]=_0x426410;}),_0x4af864[_0x3273a4(0xbf)]((_0x257ea0,_0x41349c)=>{_0x90fd09[_0x41349c]['production_date']=_0x257ea0;}),_0x3e1ce1[_0x3273a4(0xbf)]((_0x1ee09a,_0x45ad51)=>{var _0x201561=_0x3273a4;_0x90fd09[_0x45ad51][_0x201561(0x1d4)]=_0x1ee09a;}),_0x2673e7[_0x3273a4(0xbf)]((_0x3e0a0a,_0x55ac7c)=>{_0x90fd09[_0x55ac7c]['prod_cat']=_0x3e0a0a;}),_0x248377[_0x3273a4(0xbf)]((_0x3e08e2,_0x1e4d65)=>{var _0x1d0d7a=_0x3273a4;_0x90fd09[_0x1e4d65][_0x1d0d7a(0xe6)]=_0x3e08e2;}),_0x2fa747[_0x3273a4(0xbf)]((_0x14f5a4,_0x66ec4e)=>{var _0x4bd935=_0x3273a4;_0x90fd09[_0x66ec4e][_0x4bd935(0x1e5)]=_0x14f5a4,_0x90fd09[_0x66ec4e]['date_data']=_0x621e81;});const _0x53b36d=new invoice_for_outgoing();await _0x53b36d['save'](),_0x2fa747[_0x3273a4(0xbf)]((_0xf1da67,_0x494fb7)=>{var _0x2714b5=_0x3273a4;_0x90fd09[_0x494fb7][_0x2714b5(0xb0)]=_0x2714b5(0x128)+_0x53b36d['invoice_init'][_0x2714b5(0x189)]()['padStart'](0x8,'0');});var _0x56966b=0x0;_0x90fd09[_0x3273a4(0xbf)](_0x3f9725=>{var _0x4f8a43=_0x3273a4;parseFloat(_0x3f9725[_0x4f8a43(0x157)])<parseFloat(_0x3f9725['quantity'])&&parseFloat(_0x3f9725[_0x4f8a43(0xea)])>parseFloat(_0x3f9725['stock'])&&(console[_0x4f8a43(0x1dd)](_0x3f9725[_0x4f8a43(0x157)]+_0x4f8a43(0x14a)+_0x3f9725[_0x4f8a43(0xea)]),_0x56966b++);});if(_0x56966b!=0x0)return _0x5e586c[_0x3273a4(0x164)]('errors',_0x3273a4(0x118)),_0x7a91ab['redirect']('back');const _0x2a2f13=_0x90fd09[_0x3273a4(0x101)](_0x369fdc=>_0x369fdc[_0x3273a4(0xea)]!=='0'&&_0x369fdc[_0x3273a4(0xea)]!==''),_0x2d42dc=new sales_finished({'invoice':_0x3273a4(0x128)+_0x53b36d[_0x3273a4(0x11e)]['toString']()[_0x3273a4(0x1b7)](0x8,'0'),'sales_data':_0x5e586c['body'][_0x3273a4(0x1eb)],'customer':_0x5e586c['body']['customer'],'date':_0x621e81,'warehouse_name':_0x4c94f5,'sale_product':_0x2a2f13,'note':_0x2abd7e,'room':_0x5cadb1,'primary_code':_0x4f4ef4,'secondary_code':_0x5ec810,'prod_code':_0x3376db,'SCRN':_0x2b14a3,'finalize':'False','mode_transpo':_0x5b70d7,'name_driver':_0x19e3ab,'ReqBy':_0x30e877,'dateofreq':_0x57b354,'PO_number':_0x55e707,'typeservicesData':_0x2d8c05,'typevehicle':_0x202cac,'destination':_0x5c2c3d,'deliverydate':_0x42b89f,'driver':_0x33fd89,'plate':_0x3c2ecf,'van':_0x175b2f,'DRSI':_0x1d9cb4,'TSU':_0x22bb4e,'TFU':_0x40a670,'pullout_date':_0x3ff649,'actualdelivery_date':_0x2e46b4,'typeOfProducts':_0x3273a4(0x1f2)}),_0xe41af7=await _0x2d42dc['save'](),_0x4b5117=await sales_finished[_0x3273a4(0xbc)]({'invoice':_0x30ed28});_0x5e586c[_0x3273a4(0x164)](_0x3273a4(0x109),_0x3273a4(0x17f)),_0x7a91ab['redirect']('/all_sales_finished/preview/'+_0xe41af7['_id']);}catch(_0x5649fa){console[_0x3273a4(0x1dd)](_0x5649fa);}}),router[a0_0x56e626(0xc6)](a0_0x56e626(0x192),auth,async(_0x368094,_0x365076)=>{var _0x48138d=a0_0x56e626;try{const {username:_0x393885,email:_0x44960d,role:_0x295a83}=_0x368094['user'],_0x421c79=_0x368094[_0x48138d(0x1da)],_0x2a36ef=await profile[_0x48138d(0xbc)]({'email':_0x421c79[_0x48138d(0x1d0)]}),_0x1d5a40=await master_shop[_0x48138d(0xeb)](),_0x565b19=_0x368094['params']['id'],_0x33099b=await sales_finished[_0x48138d(0x147)](_0x565b19),_0x246bef=await warehouse[_0x48138d(0xd6)]([{'$match':{'name':_0x33099b['warehouse_name']}},{'$unwind':_0x48138d(0x1de)},{'$group':{'_id':_0x48138d(0x1c6),'name':{'$first':_0x48138d(0x173)},'product_stock':{'$first':_0x48138d(0xf5)},'bay':{'$first':_0x48138d(0x1b8)},'bin':{'$first':_0x48138d(0x11b)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x48138d(0xe7)},'primary_code':{'$first':_0x48138d(0x18c)},'secondary_code':{'$first':_0x48138d(0x15b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x48138d(0x17a)},'rack':{'$first':_0x48138d(0x12a)},'expiry_date':{'$first':_0x48138d(0x16d)},'production_date':{'$first':_0x48138d(0x133)},'batch_code':{'$first':_0x48138d(0x17c)},'room':{'$first':'$room'},'room_data':{'$first':_0x48138d(0xfd)}}}]),_0x2da0ac=await customer[_0x48138d(0xeb)]({});let _0x528fa3;if(_0x421c79['role']==_0x48138d(0x1aa)){const _0xab9e91=await staff[_0x48138d(0xbc)]({'email':_0x421c79['email']});_0x528fa3=await warehouse['aggregate']([{'$match':{'status':_0x48138d(0x190),'name':_0xab9e91['warehouse']}},{'$group':{'_id':_0x48138d(0x1bd),'name':{'$first':_0x48138d(0x1bd)}}}]);}else _0x528fa3=await warehouse[_0x48138d(0xd6)]([{'$match':{'status':_0x48138d(0x190)}},{'$group':{'_id':_0x48138d(0x1bd),'name':{'$first':_0x48138d(0x1bd)}}}]);const _0x1a4712=await product[_0x48138d(0xeb)]({});if(_0x1d5a40[0x0][_0x48138d(0x10a)]=='English\x20(US)'){var _0x2efc53=users[_0x48138d(0xf7)];console[_0x48138d(0x1dd)](_0x2efc53);}else{if(_0x1d5a40[0x0]['language']==_0x48138d(0x17b))var _0x2efc53=users[_0x48138d(0x17b)];else{if(_0x1d5a40[0x0][_0x48138d(0x10a)]==_0x48138d(0xf6))var _0x2efc53=users[_0x48138d(0xf6)];else{if(_0x1d5a40[0x0][_0x48138d(0x10a)]==_0x48138d(0x1ba))var _0x2efc53=users['Spanish'];else{if(_0x1d5a40[0x0]['language']==_0x48138d(0xbd))var _0x2efc53=users[_0x48138d(0xbd)];else{if(_0x1d5a40[0x0][_0x48138d(0x10a)]==_0x48138d(0x126))var _0x2efc53=users['Portuguese'];else{if(_0x1d5a40[0x0][_0x48138d(0x10a)]=='Chinese')var _0x2efc53=users['Chinese'];else{if(_0x1d5a40[0x0][_0x48138d(0x10a)]==_0x48138d(0x105))var _0x2efc53=users['Arabic'];}}}}}}}_0x365076[_0x48138d(0xbb)](_0x48138d(0x1c4),{'success':_0x368094['flash']('success'),'errors':_0x368094[_0x48138d(0x164)](_0x48138d(0x197)),'role':_0x421c79,'profile':_0x2a36ef,'customer':_0x2da0ac,'warehouse':_0x528fa3,'product':_0x246bef,'user':_0x33099b,'master_shop':_0x1d5a40,'unit':_0x1a4712,'language':_0x2efc53});}catch(_0x24cc22){console[_0x48138d(0x1dd)](_0x24cc22);}});async function dataUpdate(_0x44428b,_0x48663a,_0x52d10d){var _0x1448da=a0_0x56e626;return await warehouse[_0x1448da(0x1c3)]({'_id':_0x44428b,'product_details._id':_0x48663a},{'$set':{'product_details.$.product_stock':_0x52d10d}}),await warehouse[_0x1448da(0x147)](_0x44428b);}router[a0_0x56e626(0x15e)](a0_0x56e626(0x192),auth,async(_0x559003,_0x4b1b12)=>{var _0x218748=a0_0x56e626;try{const _0x46e077=_0x559003[_0x218748(0x1a9)]['id'],{invoice:_0x1fe9a7,warehouse_name:_0x35c815,room:_0x277d0b}=_0x559003[_0x218748(0x1ac)],_0x50fc97=await sales_finished[_0x218748(0xbc)]({'invoice':_0x1fe9a7});for(let _0x3526a=0x0;_0x3526a<=_0x50fc97['sale_product'][_0x218748(0xc2)]-0x1;_0x3526a++){const _0x139244=_0x50fc97[_0x218748(0x183)][_0x3526a];var _0x5b95b7=await warehouse[_0x218748(0xbc)]({'name':_0x35c815,'room':_0x139244[_0x218748(0xe6)]}),_0x1f2dbc=0x0;for(let _0x2ac1f3=0x0;_0x2ac1f3<=_0x5b95b7[_0x218748(0x102)]['length']-0x1;_0x2ac1f3++){const _0x557796=_0x5b95b7['product_details'][_0x2ac1f3];_0x557796['_id']==_0x139244['id_transaction_from']&&_0x557796[_0x218748(0x121)]==_0x139244[_0x218748(0x121)]&&(_0x1f2dbc=Math[_0x218748(0xcb)](0x0,Math[_0x218748(0x196)](_0x557796[_0x218748(0x107)])-Math[_0x218748(0x196)](_0x139244[_0x218748(0xea)])),await warehouse[_0x218748(0x1c3)]({'_id':_0x5b95b7[_0x218748(0x12f)][_0x218748(0x1e3)](),'product_details._id':_0x557796[_0x218748(0x12f)][_0x218748(0x1e3)](),'product_details.uuid':_0x139244[_0x218748(0x121)]},{'$set':{'product_details.$.product_stock':_0x1f2dbc}}));}console[_0x218748(0x1dd)](typeof _0x139244[_0x218748(0xdf)]);if(typeof _0x139244[_0x218748(0xdf)]!==_0x218748(0x198)){var _0x3cca0e=await staff['findById'](_0x139244[_0x218748(0xdf)]);console[_0x218748(0x1dd)](_0x218748(0x19c));var _0x289d0f=0x0;for(let _0x302983=0x0;_0x302983<=_0x3cca0e['product_list'][_0x218748(0xc2)]-0x1;_0x302983++){const _0x4646c4=_0x3cca0e[_0x218748(0x10c)][_0x302983];console[_0x218748(0x1dd)](_0x139244[_0x218748(0x141)]+_0x218748(0x165)+_0x4646c4[_0x218748(0x18b)]+_0x218748(0x182)+_0x139244[_0x218748(0x12f)]+_0x218748(0x165)+_0x139244['_id']),_0x139244[_0x218748(0x141)]==_0x4646c4['warehouse_id']&&_0x139244[_0x218748(0x12f)]==0x1&&(_0x4646c4[_0x218748(0x107)]=Math['abs'](_0x4646c4[_0x218748(0x107)])+Math['abs'](_0x139244[_0x218748(0xea)]),_0x289d0f++);}console['log'](_0x218748(0x16e),_0x289d0f),_0x289d0f=='0'&&(_0x3cca0e[_0x218748(0x10c)]=_0x3cca0e[_0x218748(0x10c)][_0x218748(0x1ce)]({'product_name':_0x139244[_0x218748(0x168)],'product_stock':_0x139244['quantity'],'bay':_0x139244[_0x218748(0xc7)],'level':_0x139244[_0x218748(0x166)],'product_code':_0x139244['product_code'],'primary_code':_0x139244[_0x218748(0xaa)],'secondary_code':_0x139244[_0x218748(0x175)],'expiry_date':_0x139244[_0x218748(0x103)],'production_date':_0x139244[_0x218748(0xaf)],'maxProducts':_0x139244[_0x218748(0xc9)],'batch_code':_0x139244['batch_code'],'secondary_unit':_0x139244[_0x218748(0xb1)],'unit':_0x139244['unit'],'maxProducts':_0x139244['maxProducts'],'maxPerUnit':_0x139244[_0x218748(0x1d4)],'invoice':_0x139244[_0x218748(0x1e5)],'warehouse_id':_0x139244[_0x218748(0x141)],'id_incoming':_0x139244[_0x218748(0x12f)],'uuid':_0x139244[_0x218748(0x121)],'gross_price':_0x139244[_0x218748(0x112)],'date_incoming':_0x139244[_0x218748(0x1cf)],'outgoing_invoice':_0x139244[_0x218748(0xb0)]}),await _0x3cca0e[_0x218748(0x195)]());}}_0x50fc97[_0x218748(0x1e0)]='True';const _0x3db298=await _0x50fc97[_0x218748(0x195)](),_0x3983cf=await master_shop[_0x218748(0xeb)](),_0x2545b0=await email_settings[_0x218748(0xbc)](),_0x1e65bd=await supervisor_settings['find']();var _0x32ab65=_0x50fc97[_0x218748(0x183)],_0x111b5f='',_0x32d028;for(_0x32d028 in _0x32ab65){_0x111b5f+=_0x218748(0x16b)+_0x218748(0xb4)+_0x32ab65[_0x32d028][_0x218748(0x168)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32ab65[_0x32d028]['product_code']+_0x218748(0x1be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32ab65[_0x32d028]['quantity']+_0x218748(0x1be)+_0x218748(0xb4)+_0x32ab65[_0x32d028][_0x218748(0xf9)]+_0x218748(0x1be)+_0x218748(0xb4)+_0x32ab65[_0x32d028][_0x218748(0xb1)]+'</td>'+_0x218748(0xb4)+_0x50fc97[_0x218748(0x144)]+'</td>'+_0x218748(0xb4)+_0x32ab65[_0x32d028][_0x218748(0xe6)]+_0x218748(0x1be)+_0x218748(0xb4)+_0x32ab65[_0x32d028][_0x218748(0xc7)]+_0x218748(0x1be);}_0x559003[_0x218748(0x164)](_0x218748(0x109),_0x218748(0x156)),_0x4b1b12['redirect'](_0x218748(0x199)+_0x46e077);}catch(_0x44e1d8){console[_0x218748(0x1dd)](_0x44e1d8);}}),router[a0_0x56e626(0xc6)](a0_0x56e626(0x170),auth,async(_0x5b825c,_0x36fe66)=>{var _0x4ee65b=a0_0x56e626;try{const {username:_0x355951,email:_0x235d2b,role:_0x3a2cab}=_0x5b825c[_0x4ee65b(0x1da)],_0x2960a6=_0x5b825c['user'],_0x1dae72=await profile['findOne']({'email':_0x2960a6['email']}),_0x354dc9=await master_shop['find'](),_0x522a3c=_0x5b825c[_0x4ee65b(0x1a9)]['id'],_0x23cbfe=await sales_finished['findById'](_0x522a3c);let _0x24c5d6=new Date(_0x23cbfe[_0x4ee65b(0x103)]),_0x5f3ea4=('0'+_0x24c5d6['getDate']())[_0x4ee65b(0xb3)](-0x2),_0x125c92=('0'+(_0x24c5d6[_0x4ee65b(0x19a)]()+0x1))[_0x4ee65b(0xb3)](-0x2),_0x3bc8c7=_0x24c5d6[_0x4ee65b(0x1f1)](),_0x530507=_0x3bc8c7+'-'+_0x125c92+'-'+_0x5f3ea4;var _0x111cb3=[_0x4ee65b(0x15d),_0x4ee65b(0x1b4)];const _0x3e4cf6=await warehouse[_0x4ee65b(0xd6)]([{'$match':{'name':_0x23cbfe['warehouse_name'],'room':_0x23cbfe[_0x4ee65b(0x1d6)]}},{'$unwind':_0x4ee65b(0x1de)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4ee65b(0xf5)},'bay':{'$first':_0x4ee65b(0x1b8)},'bin':{'$first':_0x4ee65b(0x11b)},'type':{'$first':_0x4ee65b(0x135)},'floorlevel':{'$first':_0x4ee65b(0xe7)},'primary_code':{'$first':_0x4ee65b(0x18c)},'secondary_code':{'$first':_0x4ee65b(0x15b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4ee65b(0x12a)}}}]),_0x420013=await customer[_0x4ee65b(0xeb)]({});let _0x1d1767;if(_0x2960a6[_0x4ee65b(0x150)]==_0x4ee65b(0x1aa)){const _0x4c2ba3=await staff[_0x4ee65b(0xbc)]({'email':_0x2960a6[_0x4ee65b(0x1d0)]});_0x1d1767=await warehouse[_0x4ee65b(0xd6)]([{'$match':{'status':_0x4ee65b(0x190),'name':_0x4c2ba3['warehouse']}},{'$group':{'_id':_0x4ee65b(0x1bd),'name':{'$first':_0x4ee65b(0x1bd)}}}]);}else _0x1d1767=await warehouse[_0x4ee65b(0xd6)]([{'$match':{'status':_0x4ee65b(0x190)}},{'$group':{'_id':_0x4ee65b(0x1bd),'name':{'$first':'$name'}}}]);const _0x17f926=await product['find']({});if(_0x354dc9[0x0]['language']==_0x4ee65b(0x1a7)){var _0x5f1e49=users[_0x4ee65b(0xf7)];console['log'](_0x5f1e49);}else{if(_0x354dc9[0x0][_0x4ee65b(0x10a)]==_0x4ee65b(0x17b))var _0x5f1e49=users[_0x4ee65b(0x17b)];else{if(_0x354dc9[0x0][_0x4ee65b(0x10a)]=='German')var _0x5f1e49=users['German'];else{if(_0x354dc9[0x0][_0x4ee65b(0x10a)]==_0x4ee65b(0x1ba))var _0x5f1e49=users[_0x4ee65b(0x1ba)];else{if(_0x354dc9[0x0][_0x4ee65b(0x10a)]==_0x4ee65b(0xbd))var _0x5f1e49=users[_0x4ee65b(0xbd)];else{if(_0x354dc9[0x0][_0x4ee65b(0x10a)]=='Portuguese\x20(BR)')var _0x5f1e49=users['Portuguese'];else{if(_0x354dc9[0x0]['language']==_0x4ee65b(0x1fc))var _0x5f1e49=users['Chinese'];else{if(_0x354dc9[0x0][_0x4ee65b(0x10a)]==_0x4ee65b(0x105))var _0x5f1e49=users['Arabic'];}}}}}}}_0x36fe66[_0x4ee65b(0xbb)](_0x4ee65b(0x1a3),{'success':_0x5b825c[_0x4ee65b(0x164)](_0x4ee65b(0x109)),'errors':_0x5b825c[_0x4ee65b(0x164)]('errors'),'role':_0x2960a6,'profile':_0x1dae72,'customer':_0x420013,'warehouse':_0x1d1767,'product':_0x3e4cf6,'user':_0x23cbfe,'master_shop':_0x354dc9,'unit':_0x17f926,'language':_0x5f1e49,'rooms_data':_0x111cb3,'ed_fullDate':_0x530507});}catch(_0x188acc){console[_0x4ee65b(0x1dd)](_0x188acc);}}),router[a0_0x56e626(0x15e)](a0_0x56e626(0x170),auth,async(_0x34510a,_0x4c4ee3)=>{var _0x585949=a0_0x56e626;try{const _0x23be71=_0x34510a[_0x585949(0x1a9)]['id'],_0x167876=await sales_finished['findOne']({'_id':_0x34510a[_0x585949(0x1a9)]['id']}),_0x3ae218=await warehouse[_0x585949(0xbc)]({'name':_0x167876[_0x585949(0x144)],'room':_0x34510a[_0x585949(0x1ac)][_0x585949(0x1d6)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x5bea8a,customer:_0x2f51f9,date:_0x1ed8ce,warehouse_name:_0xc735a0,product_name:_0x2c8a87,stock:_0x189acc,adjust_qty:_0x6fc41c,note:_0xea0a1a,room:_0xfa92e1,primary_code:_0x3b4ada,secondary_code:_0x263585,prod_code:_0x5a7a21,level:_0x3c1559,isle:_0x2967ee,pallet:_0x46dd31,expiry_date:_0x3df1e6}=_0x34510a['body'];if(typeof _0x2c8a87==_0x585949(0x100))var _0x5e90ac=[_0x34510a[_0x585949(0x1ac)]['product_name']],_0x4c18ec=[_0x34510a[_0x585949(0x1ac)][_0x585949(0x157)]],_0xae7a6a=[_0x34510a[_0x585949(0x1ac)]['adjust_qty']],_0x5663ab=[_0x34510a['body'][_0x585949(0xaa)]],_0x117a12=[_0x34510a[_0x585949(0x1ac)]['secondary_code']],_0x251d92=[_0x34510a[_0x585949(0x1ac)]['prod_code']],_0xe15850=[_0x34510a[_0x585949(0x1ac)][_0x585949(0x166)]],_0x52b457=[_0x34510a[_0x585949(0x1ac)][_0x585949(0x103)]];else var _0x5e90ac=[..._0x34510a['body'][_0x585949(0x168)]],_0x4c18ec=[..._0x34510a['body'][_0x585949(0x157)]],_0xae7a6a=[..._0x34510a[_0x585949(0x1ac)]['adjust_qty']],_0x5663ab=[..._0x34510a['body']['primary_code']],_0x117a12=[..._0x34510a[_0x585949(0x1ac)][_0x585949(0x175)]],_0x251d92=[..._0x34510a[_0x585949(0x1ac)][_0x585949(0x153)]],_0xe15850=[..._0x34510a['body'][_0x585949(0x166)]],_0x52b457=[..._0x34510a[_0x585949(0x1ac)][_0x585949(0x103)]];const _0x58497e=_0x5e90ac[_0x585949(0xce)](_0x22e654=>{return _0x22e654={'product_name':_0x22e654};});_0x4c18ec[_0x585949(0xbf)]((_0x46ed72,_0x19e8c4)=>{var _0x3b8b4a=_0x585949;_0x58497e[_0x19e8c4][_0x3b8b4a(0x157)]=_0x46ed72;}),_0xae7a6a[_0x585949(0xbf)]((_0x5aa9eb,_0x3ed8e4)=>{_0x58497e[_0x3ed8e4]['quantity']=_0x5aa9eb;}),_0x5663ab[_0x585949(0xbf)]((_0x35e9d6,_0x1f3414)=>{_0x58497e[_0x1f3414]['primary_code']=_0x35e9d6;}),_0x117a12[_0x585949(0xbf)]((_0x37d52d,_0x3b8b24)=>{var _0x52e592=_0x585949;_0x58497e[_0x3b8b24][_0x52e592(0x175)]=_0x37d52d;}),_0x251d92[_0x585949(0xbf)]((_0x14d572,_0x7cf7a5)=>{var _0x4db35d=_0x585949;_0x58497e[_0x7cf7a5][_0x4db35d(0x131)]=_0x14d572;}),_0xe15850[_0x585949(0xbf)]((_0x27d3b8,_0x3a3072)=>{var _0x48b75a=_0x585949;_0x58497e[_0x3a3072][_0x48b75a(0x166)]=_0x27d3b8;}),_0x52b457[_0x585949(0xbf)]((_0x247a58,_0x1cdfdf)=>{_0x58497e[_0x1cdfdf]['expiry_date']=_0x247a58;});var _0x36c380=0x0;_0x58497e['forEach'](_0x326d82=>{var _0x550f1b=_0x585949;console[_0x550f1b(0x1dd)]('foreach\x20newproduct',_0x326d82),(parseInt(_0x326d82[_0x550f1b(0x157)])<parseInt(_0x326d82[_0x550f1b(0xea)])||parseInt(_0x326d82['quantity'])==0x0)&&_0x36c380++;});if(_0x36c380!=0x0)return _0x34510a[_0x585949(0x164)](_0x585949(0x197),_0x585949(0xc5)),_0x4c4ee3[_0x585949(0xad)]('back');_0x167876['sale_product']['forEach'](_0x1aa7b4=>{var _0x504036=_0x585949;const _0x31deb9=_0x3ae218[_0x504036(0x102)]['map'](_0x3042eb=>{var _0x8f8c2f=_0x504036;_0x3042eb[_0x8f8c2f(0x168)]==_0x1aa7b4[_0x8f8c2f(0x168)]&&_0x3042eb['bay']==_0x1aa7b4[_0x8f8c2f(0xc7)]&&(_0x3042eb[_0x8f8c2f(0x107)]=parseInt(_0x3042eb[_0x8f8c2f(0x107)])+parseInt(_0x1aa7b4[_0x8f8c2f(0xea)]));});}),await _0x3ae218['save']();const _0x2246f=_0x58497e[_0x585949(0x101)](_0x43a75f=>_0x43a75f['quantity']!=='0'&&_0x43a75f[_0x585949(0xea)]!=='');_0x167876[_0x585949(0x1e5)]=_0x5bea8a,_0x167876[_0x585949(0x16f)]=_0x2f51f9,_0x167876[_0x585949(0xca)]=_0x1ed8ce,_0x167876[_0x585949(0x144)]=_0xc735a0,_0x167876[_0x585949(0x183)]=_0x2246f,_0x167876['note']=_0xea0a1a,_0x167876[_0x585949(0x1d6)]=_0xfa92e1;const _0x4175b9=await _0x167876[_0x585949(0x195)](),_0x3f472c=await sales_finished[_0x585949(0xbc)]({'_id':_0x34510a[_0x585949(0x1a9)]['id']}),_0x1d9203=await warehouse[_0x585949(0xbc)]({'name':_0xc735a0,'room':_0xfa92e1,'warehouse_category':_0x585949(0x12c)});_0x3f472c['sale_product'][_0x585949(0xbf)](_0x26ccda=>{var _0x49ac15=_0x585949;const _0x22c388=_0x1d9203[_0x49ac15(0x102)][_0x49ac15(0xce)](_0x1664d3=>{var _0x4365b1=_0x49ac15;_0x1664d3['product_name']==_0x26ccda[_0x4365b1(0x168)]&&_0x1664d3[_0x4365b1(0xc7)]==_0x26ccda[_0x4365b1(0xc7)]&&(_0x1664d3[_0x4365b1(0x107)]=parseInt(_0x1664d3['product_stock'])-parseInt(_0x26ccda['quantity']));});}),console[_0x585949(0x1dd)]('final',_0x1d9203),await _0x1d9203[_0x585949(0x195)]();const _0x554d6d=await c_payment_data[_0x585949(0xbc)]({'invoice':_0x34510a[_0x585949(0x1ac)][_0x585949(0x1e5)]});_0x554d6d[_0x585949(0x14d)]=_0x34510a[_0x585949(0x1ac)][_0x585949(0x14d)],await _0x554d6d[_0x585949(0x195)](),_0x34510a[_0x585949(0x164)]('success',_0x585949(0x156)),_0x4c4ee3[_0x585949(0xad)]('/all_sales_finished/view');}catch(_0x3897e0){console[_0x585949(0x1dd)](_0x3897e0);}}),router[a0_0x56e626(0x15e)](a0_0x56e626(0x1c5),auth,async(_0x2ab263,_0xa6f1ab)=>{var _0x3782e2=a0_0x56e626;try{const _0x56b5c0=_0x2ab263['params']['id'],{invoice:_0x1d9bb4,customer:_0x5d711b,receivable_amount:_0x3c33ea,received_amount:_0x2574ef}=_0x2ab263[_0x3782e2(0x1ac)],_0x35e5dc=await sales['findById'](_0x56b5c0);console[_0x3782e2(0x1dd)](_0x35e5dc);var _0x563872=_0x3c33ea-_0x2574ef;console[_0x3782e2(0x1dd)](_0x2574ef),_0x35e5dc[_0x3782e2(0xe8)]=parseFloat(_0x2574ef)+parseFloat(_0x35e5dc[_0x3782e2(0xe8)]),_0x35e5dc[_0x3782e2(0x154)]=_0x563872,console['log'](_0x35e5dc);const _0x12ed2a=await _0x35e5dc['save'](),_0x522768=await c_payment_data[_0x3782e2(0xbc)]({'invoice':_0x1d9bb4});_0x522768[_0x3782e2(0x12b)]=_0x563872,await _0x522768[_0x3782e2(0x195)]();let _0x2e1617=new Date(),_0x3efda7=('0'+_0x2e1617['getDate']())[_0x3782e2(0xb3)](-0x2),_0x2e6b8c=('0'+(_0x2e1617[_0x3782e2(0x19a)]()+0x1))[_0x3782e2(0xb3)](-0x2),_0x3dfebf=_0x2e1617[_0x3782e2(0x1f1)](),_0x59f460=_0x3dfebf+'-'+_0x2e6b8c+'-'+_0x3efda7;const _0x33686f=new customer_payment({'invoice':_0x1d9bb4,'date':_0x3dfebf+'-'+_0x2e6b8c+'-'+_0x3efda7,'customer':_0x5d711b,'reason':_0x3782e2(0xf4),'amount':_0x2574ef}),_0x39c388=await _0x33686f[_0x3782e2(0x195)]();_0x2ab263[_0x3782e2(0x164)](_0x3782e2(0x109),_0x3782e2(0x1a6)),_0xa6f1ab[_0x3782e2(0xad)](_0x3782e2(0x1a1));}catch(_0x3acd6c){console[_0x3782e2(0x1dd)](_0x3acd6c);}}),router[a0_0x56e626(0xc6)](a0_0x56e626(0xdb),auth,async(_0x4de266,_0x1ba61f)=>{var _0x5d232d=a0_0x56e626;try{const {username:_0x4a47bd,email:_0x5ce6a5,role:_0x19d721}=_0x4de266[_0x5d232d(0x1da)],_0x404d58=_0x4de266[_0x5d232d(0x1da)],_0x1f77aa=await profile[_0x5d232d(0xbc)]({'email':_0x404d58[_0x5d232d(0x1d0)]}),_0x5cc932=await master_shop[_0x5d232d(0xeb)]();console[_0x5d232d(0x1dd)](_0x5d232d(0xab),_0x5cc932);const _0x44ee40=_0x4de266['params']['id'],_0x1b14f9=await sales[_0x5d232d(0x147)](_0x44ee40);console[_0x5d232d(0x1dd)](_0x1b14f9);const _0x1d387f=await customer['findOne']({'name':_0x1b14f9['customer']});console[_0x5d232d(0x1dd)](_0x1d387f);if(_0x5cc932[0x0][_0x5d232d(0x10a)]==_0x5d232d(0x1a7)){var _0x1530c9=users['English'];console['log'](_0x1530c9);}else{if(_0x5cc932[0x0]['language']==_0x5d232d(0x17b))var _0x1530c9=users['Hindi'];else{if(_0x5cc932[0x0][_0x5d232d(0x10a)]==_0x5d232d(0xf6))var _0x1530c9=users[_0x5d232d(0xf6)];else{if(_0x5cc932[0x0][_0x5d232d(0x10a)]==_0x5d232d(0x1ba))var _0x1530c9=users[_0x5d232d(0x1ba)];else{if(_0x5cc932[0x0][_0x5d232d(0x10a)]=='French')var _0x1530c9=users[_0x5d232d(0xbd)];else{if(_0x5cc932[0x0][_0x5d232d(0x10a)]==_0x5d232d(0x126))var _0x1530c9=users['Portuguese'];else{if(_0x5cc932[0x0][_0x5d232d(0x10a)]==_0x5d232d(0x1fc))var _0x1530c9=users['Chinese'];else{if(_0x5cc932[0x0][_0x5d232d(0x10a)]=='Arabic\x20(ae)')var _0x1530c9=users['Arabic'];}}}}}}}_0x1ba61f[_0x5d232d(0xbb)]('sales_invoice',{'success':_0x4de266['flash'](_0x5d232d(0x109)),'errors':_0x4de266[_0x5d232d(0x164)](_0x5d232d(0x197)),'role':_0x404d58,'profile':_0x1f77aa,'master_shop':_0x5cc932,'customers':_0x1d387f,'sales':_0x1b14f9,'language':_0x1530c9});}catch(_0x4335db){console[_0x5d232d(0x1dd)](_0x4335db);}}),router[a0_0x56e626(0xc6)](a0_0x56e626(0x1e6),auth,async(_0x56be09,_0x1eb54e)=>{var _0x38f11d=a0_0x56e626;try{const {username:_0x382ed4,email:_0x32b36b,role:_0x4f9783}=_0x56be09[_0x38f11d(0x1da)],_0x581a7a=_0x56be09[_0x38f11d(0x1da)],_0x55b589=await profile[_0x38f11d(0xbc)]({'email':_0x581a7a[_0x38f11d(0x1d0)]}),_0x47ee7f=await master_shop['find'](),_0xcfbcfc=_0x56be09[_0x38f11d(0x1a9)]['id'],_0x1470ea=await sales_finished[_0x38f11d(0x147)](_0xcfbcfc),_0x5590dc=await warehouse[_0x38f11d(0xd6)]([{'$match':{'name':_0x1470ea['warehouse_name']}},{'$unwind':_0x38f11d(0x1de)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x38f11d(0x173)},'product_stock':{'$first':_0x38f11d(0xf5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x38f11d(0x11b)},'type':{'$first':_0x38f11d(0x135)},'floorlevel':{'$first':_0x38f11d(0xe7)},'primary_code':{'$first':_0x38f11d(0x18c)},'secondary_code':{'$first':_0x38f11d(0x15b)},'product_code':{'$first':_0x38f11d(0x1ca)},'storage':{'$first':_0x38f11d(0x17a)},'rack':{'$first':_0x38f11d(0x12a)},'expiry_date':{'$first':_0x38f11d(0x16d)},'production_date':{'$first':_0x38f11d(0x133)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x38f11d(0xe1)},'maxProducts':{'$first':_0x38f11d(0x1df)},'batch_code':{'$first':_0x38f11d(0x17c)},'maxPerUnit':{'$first':_0x38f11d(0x12d)}}}]),_0x2b2a1f=await product[_0x38f11d(0xeb)]({}),_0x52fa20=await warehouse[_0x38f11d(0xd6)]([{'$match':{'status':_0x38f11d(0x190),'warehouse_category':_0x38f11d(0x12c),'name':{'$ne':_0x38f11d(0x10d),'$ne':_0x38f11d(0x181)}}},{'$group':{'_id':_0x38f11d(0x1bd),'name':{'$first':_0x38f11d(0x1bd)}}},{'$sort':{'name':0x1}}]);var _0x2c50cb=['Return\x20Rooms'];const _0x1ff5da=await warehouse[_0x38f11d(0xd6)]([{'$match':{'status':_0x38f11d(0x190),'name':_0x38f11d(0x181)}},{'$group':{'_id':_0x38f11d(0x1bd),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x47ee7f[0x0][_0x38f11d(0x10a)]=='English\x20(US)'){var _0x1ef854=users['English'];console[_0x38f11d(0x1dd)](_0x1ef854);}else{if(_0x47ee7f[0x0][_0x38f11d(0x10a)]=='Hindi')var _0x1ef854=users[_0x38f11d(0x17b)];else{if(_0x47ee7f[0x0]['language']=='German')var _0x1ef854=users[_0x38f11d(0xf6)];else{if(_0x47ee7f[0x0][_0x38f11d(0x10a)]==_0x38f11d(0x1ba))var _0x1ef854=users[_0x38f11d(0x1ba)];else{if(_0x47ee7f[0x0]['language']==_0x38f11d(0xbd))var _0x1ef854=users[_0x38f11d(0xbd)];else{if(_0x47ee7f[0x0][_0x38f11d(0x10a)]==_0x38f11d(0x126))var _0x1ef854=users['Portuguese'];else{if(_0x47ee7f[0x0]['language']==_0x38f11d(0x1fc))var _0x1ef854=users[_0x38f11d(0x1fc)];else{if(_0x47ee7f[0x0][_0x38f11d(0x10a)]==_0x38f11d(0x105))var _0x1ef854=users[_0x38f11d(0x119)];}}}}}}}_0x1eb54e[_0x38f11d(0xbb)]('return_sale_finished',{'success':_0x56be09[_0x38f11d(0x164)](_0x38f11d(0x109)),'errors':_0x56be09[_0x38f11d(0x164)](_0x38f11d(0x197)),'role':_0x581a7a,'profile':_0x55b589,'user':_0x1470ea,'stock':_0x5590dc,'master_shop':_0x47ee7f,'unit':_0x2b2a1f,'language':_0x1ef854,'warehouses':_0x52fa20,'rooms':_0x2c50cb,'warehouse_QA':_0x1ff5da});}catch(_0x2dc061){console[_0x38f11d(0x1dd)](_0x2dc061),_0x1eb54e[_0x38f11d(0x1db)](0xc8)[_0x38f11d(0xe3)]({'message':_0x2dc061[_0x38f11d(0x14e)]});}}),router[a0_0x56e626(0x15e)](a0_0x56e626(0x1e6),auth,async(_0x30a5e1,_0x25cbc9)=>{var _0x59306b=a0_0x56e626;if(_0x30a5e1[_0x59306b(0x1ac)]['for_categorize']=='QA')try{const {invoice:_0x2cc6f4,date:_0x48ca0b,warehouse_name:_0x101db2,product_name:_0x498a6f,primary_code:_0x21fdcd,secondary_code:_0x5afffa,product_code:_0x1db320,sales_quantity:_0x1d295c,stocks:_0x1609e7,return_qty:_0x2eef81,Room_name:_0x4467bd,to_warehouse_name_QA:_0x339e2f,to_Room_name_QA:_0x4bb96d,note:_0x21fbc7,for_categorize:_0x429f11,product_name_QA1:_0x597c8d}=_0x30a5e1[_0x59306b(0x1ac)];if(typeof _0x597c8d==_0x59306b(0x100))var _0x215a69=[_0x30a5e1['body'][_0x59306b(0x1ea)]],_0x524f17=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xc1)]],_0x4fe704=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xcd)]],_0x56a1bc=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x132)]],_0x582e8c=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x162)]],_0x5982a8=[_0x30a5e1[_0x59306b(0x1ac)]['stocks_QA']],_0x9ccca7=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xf3)]],_0x1b959d=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xe2)]],_0x30460a=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xf0)]],_0x5dc6d3=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x10b)]],_0x4de11a=[_0x30a5e1['body'][_0x59306b(0x15f)]],_0x55ef09=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x185)]],_0x3e0a83=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x17e)]],_0x24b89e=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xf8)]];else var _0x215a69=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x1ea)]],_0x524f17=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xc1)]],_0x4fe704=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xcd)]],_0x56a1bc=[..._0x30a5e1['body'][_0x59306b(0x132)]],_0x582e8c=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x162)]],_0x5982a8=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x142)]],_0x9ccca7=[..._0x30a5e1['body'][_0x59306b(0xf3)]],_0x1b959d=[..._0x30a5e1[_0x59306b(0x1ac)]['maxPerUnit_QA']],_0x30460a=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xf0)]],_0x5dc6d3=[..._0x30a5e1['body'][_0x59306b(0x10b)]],_0x4de11a=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x15f)]],_0x55ef09=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x185)]],_0x3e0a83=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x17e)]],_0x24b89e=[..._0x30a5e1['body'][_0x59306b(0xf8)]];const _0x7636c7=_0x215a69[_0x59306b(0xce)](_0x1b1dc1=>{return _0x1b1dc1={'product_name':_0x1b1dc1};});_0x524f17['forEach']((_0x1b63b2,_0x468e2c)=>{var _0x2aa053=_0x59306b;_0x7636c7[_0x468e2c][_0x2aa053(0xaa)]=_0x1b63b2;}),_0x4fe704['forEach']((_0x54838e,_0x6594e5)=>{var _0x2f66c2=_0x59306b;_0x7636c7[_0x6594e5][_0x2f66c2(0x175)]=_0x54838e;}),_0x56a1bc[_0x59306b(0xbf)]((_0x150833,_0x4d310f)=>{_0x7636c7[_0x4d310f]['product_code']=_0x150833;}),_0x582e8c[_0x59306b(0xbf)]((_0x29249b,_0x54e0f5)=>{var _0x2d5445=_0x59306b;_0x7636c7[_0x54e0f5][_0x2d5445(0xd5)]=_0x29249b;}),_0x5982a8[_0x59306b(0xbf)]((_0x52646d,_0x4d0618)=>{var _0x184433=_0x59306b;_0x7636c7[_0x4d0618][_0x184433(0x157)]=_0x52646d;}),_0x9ccca7[_0x59306b(0xbf)]((_0x53dee5,_0x1f296d)=>{var _0x5afafd=_0x59306b;_0x7636c7[_0x1f296d][_0x5afafd(0x113)]=_0x53dee5;}),_0x1b959d[_0x59306b(0xbf)]((_0x42ccaf,_0x461ad6)=>{var _0x3ed030=_0x59306b;_0x7636c7[_0x461ad6][_0x3ed030(0x1a8)]=_0x42ccaf;}),_0x30460a[_0x59306b(0xbf)]((_0x107023,_0x234d33)=>{var _0x5edc1c=_0x59306b;_0x7636c7[_0x234d33][_0x5edc1c(0xc9)]=_0x107023;}),_0x5dc6d3[_0x59306b(0xbf)]((_0x3e1f50,_0x4b213d)=>{var _0x57917e=_0x59306b;_0x7636c7[_0x4b213d][_0x57917e(0xda)]=_0x3e1f50;}),_0x4de11a[_0x59306b(0xbf)]((_0x3df120,_0x1ea285)=>{var _0x331449=_0x59306b;_0x7636c7[_0x1ea285][_0x331449(0xb1)]=_0x3df120;}),_0x55ef09[_0x59306b(0xbf)]((_0x3f7a23,_0x19d871)=>{var _0x4287e0=_0x59306b;_0x7636c7[_0x19d871][_0x4287e0(0xf9)]=_0x3f7a23;}),_0x3e0a83[_0x59306b(0xbf)]((_0x2fa10a,_0x42ebc1)=>{var _0x3c9534=_0x59306b;_0x7636c7[_0x42ebc1][_0x3c9534(0xaf)]=_0x2fa10a;}),_0x24b89e['forEach']((_0x3ac6c9,_0x4ff648)=>{_0x7636c7[_0x4ff648]['expiry_date']=_0x3ac6c9;});const _0x386242=await sales_finished[_0x59306b(0xbc)]({'invoice':_0x2cc6f4});_0x386242[_0x59306b(0x1ed)]='True';const _0x5f31ba=await _0x386242[_0x59306b(0x195)](),_0x11d248=new sales_return_finished({'invoice':_0x2cc6f4,'customer':_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x16f)],'date':_0x48ca0b,'warehouse_name':_0x101db2,'room':_0x4467bd,'ToWarehouse':_0x339e2f,'ToRoom':_0x4bb96d,'return_sale_QA':_0x7636c7,'note':_0x21fbc7,'warehouse_cat':_0x429f11}),_0x27d091=await _0x11d248[_0x59306b(0x195)](),_0x2fc15c=await sales_return_finished[_0x59306b(0xbc)]({'invoice':_0x2cc6f4}),_0x51ae68=await warehouse['findOne']({'name':_0x339e2f,'room':_0x4bb96d});_0x2fc15c[_0x59306b(0x18f)][_0x59306b(0xbf)](_0x50b1db=>{var _0x4ae7c6=_0x59306b,_0x221b6c=0x0;const _0x3edd48=_0x51ae68[_0x4ae7c6(0x102)]['map'](_0x2f33e4=>{var _0x3b81b4=_0x4ae7c6;_0x2f33e4[_0x3b81b4(0x168)]==_0x50b1db['product_name']&&_0x2f33e4[_0x3b81b4(0x103)]==_0x50b1db[_0x3b81b4(0x103)]&&_0x2f33e4[_0x3b81b4(0xaf)]==_0x50b1db[_0x3b81b4(0xaf)]&&_0x2f33e4[_0x3b81b4(0xda)]==_0x50b1db[_0x3b81b4(0xda)]&&(_0x2f33e4[_0x3b81b4(0x107)]=parseInt(_0x2f33e4[_0x3b81b4(0x107)])+parseInt(_0x50b1db[_0x3b81b4(0x113)]),_0x221b6c++);});_0x221b6c=='0'&&(_0x51ae68['product_details']=_0x51ae68[_0x4ae7c6(0x102)]['concat']({'product_name':_0x50b1db['product_name'],'product_stock':_0x50b1db['return_qty'],'primary_code':_0x50b1db['primary_code'],'secondary_code':_0x50b1db[_0x4ae7c6(0x175)],'product_code':_0x50b1db[_0x4ae7c6(0x131)],'batch_code':_0x50b1db[_0x4ae7c6(0xda)],'maxPerUnit':_0x50b1db[_0x4ae7c6(0x1a8)],'production_date':_0x50b1db[_0x4ae7c6(0xaf)],'expiry_date':_0x50b1db['expiry_date'],'secondary_unit':_0x50b1db[_0x4ae7c6(0xb1)],'unit':_0x50b1db[_0x4ae7c6(0xf9)],'maxProducts':_0x50b1db[_0x4ae7c6(0xc9)],'bay':_0x50b1db[_0x4ae7c6(0xc7)]}));}),await _0x51ae68[_0x59306b(0x195)]();const _0x33bc83=new c_payment_data({'invoice':_0x2cc6f4,'customer':_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x16f)],'reason':'Sale\x20Return'});await _0x33bc83['save']();const _0x52d3c0=await master_shop[_0x59306b(0xeb)](),_0xf827bd=await email_settings['findOne'](),_0x14ddac=await customer[_0x59306b(0xbc)]({'name':_0x30a5e1['body']['customer']});_0x52d3c0[0x0]['currency_placement']==0x1?(right_currency=_0x52d3c0[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x52d3c0[0x0][_0x59306b(0xc8)]);var _0x205368=_0x215a69,_0x344159=_0x9ccca7,_0x292b80='',_0x454e08;for(_0x454e08 in _0x205368){_0x292b80+=_0x59306b(0x16b)+_0x59306b(0xb4)+_0x205368[_0x454e08]+_0x59306b(0x1be)+_0x59306b(0xb4)+_0x344159[_0x454e08]+_0x59306b(0x1be)+_0x59306b(0x18a);}console[_0x59306b(0x1dd)](_0x59306b(0x10c),_0x292b80);let _0x32b490=nodemailer[_0x59306b(0x1e9)]({'service':_0x59306b(0x19d),'auth':{'user':_0xf827bd[_0x59306b(0x1d0)],'pass':_0xf827bd[_0x59306b(0x187)]}}),_0x242744={'from':_0xf827bd[_0x59306b(0x1d0)],'to':_0x14ddac[_0x59306b(0x1d0)],'subject':_0x59306b(0x184),'attachments':[{'filename':_0x59306b(0xcf),'path':__dirname+'/../public'+'/upload/'+_0x52d3c0[0x0]['image'],'cid':_0x59306b(0x163)}],'html':_0x59306b(0x155)+_0x59306b(0xe9)+_0x59306b(0x13d)+_0x59306b(0xbe)+_0x59306b(0x167)+_0x59306b(0xbe)+_0x59306b(0x179)+_0x59306b(0x1e8)+_0x59306b(0xbe)+_0x59306b(0x1d3)+_0x52d3c0[0x0][_0x59306b(0xfe)]+'\x20</h2>'+'</div>'+_0x59306b(0x1e8)+_0x59306b(0xff)+_0x59306b(0xbe)+_0x59306b(0x186)+_0x59306b(0xd8)+_0x2cc6f4+'\x20'+_0x59306b(0x1a2)+_0x59306b(0x140)+_0x48ca0b+'\x20'+_0x59306b(0x1bf)+_0x59306b(0xa9)+_0x59306b(0x1e8)+_0x59306b(0x1e1)+_0x59306b(0xe4)+_0x59306b(0x16b)+_0x59306b(0xe0)+_0x59306b(0x125)+_0x59306b(0xb8)+_0x59306b(0x1fa)+_0x59306b(0x18a)+_0x59306b(0x1d7)+_0x59306b(0xec)+'\x20'+_0x292b80+'\x20'+'</tbody>'+_0x59306b(0x108)+_0x59306b(0xbe)+_0x59306b(0x115)+_0x59306b(0xfa)+_0x52d3c0[0x0]['site_title']+_0x59306b(0xa9)+'</div>'+_0x59306b(0x1e8)+_0x59306b(0xd0)};_0x32b490['sendMail'](_0x242744,function(_0x3a9644,_0x46e1f2){var _0x35ee5e=_0x59306b;_0x3a9644?(console[_0x35ee5e(0x1dd)](_0x3a9644),console[_0x35ee5e(0x1dd)](_0x35ee5e(0x138))):console['log'](_0x35ee5e(0x152));}),_0x30a5e1['flash'](_0x59306b(0x109),_0x59306b(0x1fb)),_0x25cbc9[_0x59306b(0xad)]('/all_sales_finished/view');}catch(_0x51be8b){_0x25cbc9[_0x59306b(0x1db)](0xc8)['json']({'message1':_0x51be8b[_0x59306b(0x14e)]});}else{if(_0x30a5e1['body'][_0x59306b(0x1dc)]=='GS')try{const {invoice:_0x2ad4f7,date:_0x218a82,warehouse_name:_0x590a49,product_name:_0x322799,primary_code:_0x312713,secondary_code:_0x1205b4,product_code:_0x102e9c,sales_quantity:_0x1c7ffb,stocks:_0x6d2a6f,return_qty:_0x309555,Room_name:_0xabb3bf,to_warehouse_name:_0x30d376,to_Room_name:_0x37bafa,note:_0x1a19c2,level:_0x47bcac,isle:_0x1b9173,pallet:_0x351ebf,for_categorize:_0x114348}=_0x30a5e1[_0x59306b(0x1ac)];if(typeof _0x322799==_0x59306b(0x100))var _0x215a69=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x168)]],_0x524f17=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xaa)]],_0x4fe704=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x175)]],_0x56a1bc=[_0x30a5e1['body'][_0x59306b(0x131)]],_0x582e8c=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x1f6)]],_0x9ccca7=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x113)]],_0x3086c8=[_0x30a5e1['body'][_0x59306b(0xc7)]],_0x1b959d=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x1a8)]],_0x30460a=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xc9)]],_0x5dc6d3=[_0x30a5e1[_0x59306b(0x1ac)]['batch_code']],_0x4de11a=[_0x30a5e1[_0x59306b(0x1ac)]['secondary_unit']],_0x55ef09=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xf9)]],_0x3e0a83=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xaf)]],_0x24b89e=[_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x103)]];else var _0x215a69=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x168)]],_0x524f17=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xaa)]],_0x4fe704=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x175)]],_0x56a1bc=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x131)]],_0x582e8c=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x1f6)]],_0x9ccca7=[..._0x30a5e1[_0x59306b(0x1ac)]['return_qty']],_0x3086c8=[..._0x30a5e1['body'][_0x59306b(0xc7)]],_0x1b959d=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x1a8)]],_0x30460a=[..._0x30a5e1[_0x59306b(0x1ac)]['maxProducts']],_0x5dc6d3=[..._0x30a5e1[_0x59306b(0x1ac)]['batch_code']],_0x4de11a=[..._0x30a5e1['body'][_0x59306b(0xb1)]],_0x55ef09=[..._0x30a5e1['body'][_0x59306b(0xf9)]],_0x3e0a83=[..._0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0xaf)]],_0x24b89e=[..._0x30a5e1['body'][_0x59306b(0x103)]];const _0x3b2998=_0x215a69[_0x59306b(0xce)](_0x1840cb=>{return _0x1840cb={'product_name':_0x1840cb};});_0x524f17[_0x59306b(0xbf)]((_0x19677e,_0x4f15b3)=>{var _0x5ddc00=_0x59306b;_0x3b2998[_0x4f15b3][_0x5ddc00(0xaa)]=_0x19677e;}),_0x4fe704[_0x59306b(0xbf)]((_0x362546,_0x3d1588)=>{var _0x4ea081=_0x59306b;_0x3b2998[_0x3d1588][_0x4ea081(0x175)]=_0x362546;}),_0x56a1bc[_0x59306b(0xbf)]((_0x1cb8fb,_0x29253e)=>{var _0x531997=_0x59306b;_0x3b2998[_0x29253e][_0x531997(0x131)]=_0x1cb8fb;}),_0x582e8c[_0x59306b(0xbf)]((_0x1e78f2,_0x3765c7)=>{_0x3b2998[_0x3765c7]['sale_qty']=_0x1e78f2;}),_0x9ccca7[_0x59306b(0xbf)]((_0x1d7b62,_0x12d30d)=>{var _0x594cc1=_0x59306b;_0x3b2998[_0x12d30d][_0x594cc1(0x113)]=_0x1d7b62;}),_0x3086c8[_0x59306b(0xbf)]((_0x534bfa,_0x348552)=>{var _0x362c36=_0x59306b;_0x3b2998[_0x348552][_0x362c36(0xc7)]=_0x534bfa;}),_0x1b959d[_0x59306b(0xbf)]((_0x1b49bb,_0x829491)=>{_0x3b2998[_0x829491]['maxPerUnit']=_0x1b49bb;}),_0x30460a[_0x59306b(0xbf)]((_0x55cab7,_0x49d426)=>{var _0x4bb296=_0x59306b;_0x3b2998[_0x49d426][_0x4bb296(0xc9)]=_0x55cab7;}),_0x5dc6d3[_0x59306b(0xbf)]((_0x559c5b,_0x52de47)=>{var _0x550f60=_0x59306b;_0x3b2998[_0x52de47][_0x550f60(0xda)]=_0x559c5b;}),_0x4de11a[_0x59306b(0xbf)]((_0x50e3d1,_0x5e92c5)=>{var _0x2a6d95=_0x59306b;_0x3b2998[_0x5e92c5][_0x2a6d95(0xb1)]=_0x50e3d1;}),_0x55ef09[_0x59306b(0xbf)]((_0x8f530e,_0x3d7925)=>{var _0x124cc6=_0x59306b;_0x3b2998[_0x3d7925][_0x124cc6(0xf9)]=_0x8f530e;}),_0x3e0a83[_0x59306b(0xbf)]((_0x41a9f5,_0x405ecf)=>{var _0x26c12d=_0x59306b;_0x3b2998[_0x405ecf][_0x26c12d(0xaf)]=_0x41a9f5;}),_0x24b89e[_0x59306b(0xbf)]((_0xc1c4f2,_0x423a6e)=>{var _0x10902f=_0x59306b;_0x3b2998[_0x423a6e][_0x10902f(0x103)]=_0xc1c4f2;});var _0x5df927=0x0;_0x3b2998[_0x59306b(0xbf)](_0x46b90f=>{var _0x5edeab=_0x59306b;(parseInt(_0x46b90f['sale_qty'])<parseInt(_0x46b90f[_0x5edeab(0x113)])||parseInt(_0x46b90f[_0x5edeab(0x157)])<parseInt(_0x46b90f['return_qty'])&&parseInt(_0x46b90f['sale_qty'])>parseInt(_0x46b90f[_0x5edeab(0x113)])||parseInt(_0x46b90f[_0x5edeab(0x113)])==0x0)&&_0x5df927++;});if(_0x5df927!=0x0)return _0x30a5e1[_0x59306b(0x164)]('errors',_0x59306b(0x19b)),_0x25cbc9[_0x59306b(0xad)](_0x59306b(0x127));const _0x5421f0=await sales_finished[_0x59306b(0xbc)]({'invoice':_0x2ad4f7});_0x5421f0[_0x59306b(0x1ed)]=_0x59306b(0xed);const _0x43f0c0=await _0x5421f0['save'](),_0x1201a0=new sales_return_finished({'invoice':_0x2ad4f7,'customer':_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x16f)],'date':_0x218a82,'warehouse_name':_0x590a49,'room':_0xabb3bf,'ToWarehouse':_0x30d376,'ToRoom':_0x37bafa,'return_sale':_0x3b2998,'note':_0x1a19c2,'warehouse_cat':_0x114348}),_0x15a1b8=await _0x1201a0[_0x59306b(0x195)](),_0x19327f=await sales_return_finished['findOne']({'invoice':_0x2ad4f7}),_0x2d6840=await warehouse[_0x59306b(0xbc)]({'name':_0x30d376,'room':_0x37bafa,'warehouse_category':_0x59306b(0x12c)});_0x19327f[_0x59306b(0x180)]['forEach'](_0xa98cdc=>{var _0x1fe773=_0x59306b,_0x4e43d2=0x0;const _0x1b48fa=_0x2d6840['product_details'][_0x1fe773(0xce)](_0x518aad=>{var _0x5d0099=_0x1fe773;_0x518aad[_0x5d0099(0x168)]==_0xa98cdc['product_name']&&_0x518aad[_0x5d0099(0xc7)]==_0xa98cdc['bay']&&_0x518aad['expiry_date']==_0xa98cdc[_0x5d0099(0x103)]&&_0x518aad[_0x5d0099(0xaf)]==_0xa98cdc['production_date']&&_0x518aad[_0x5d0099(0xda)]==_0xa98cdc[_0x5d0099(0xda)]&&(_0x518aad[_0x5d0099(0x107)]=parseInt(_0x518aad['product_stock'])+parseInt(_0xa98cdc['return_qty']),_0x4e43d2++);});_0x4e43d2=='0'&&(_0x2d6840[_0x1fe773(0x102)]=_0x2d6840[_0x1fe773(0x102)][_0x1fe773(0x1ce)]({'product_name':_0xa98cdc[_0x1fe773(0x168)],'product_stock':_0xa98cdc[_0x1fe773(0x113)],'primary_code':_0xa98cdc[_0x1fe773(0xaa)],'secondary_code':_0xa98cdc[_0x1fe773(0x175)],'product_code':_0xa98cdc['product_code'],'bay':_0xa98cdc[_0x1fe773(0xc7)],'batch_code':_0xa98cdc['batch_code'],'maxPerUnit':_0xa98cdc['maxPerUnit'],'production_date':_0xa98cdc[_0x1fe773(0xaf)],'expiry_date':_0xa98cdc['expiry_date'],'secondary_unit':_0xa98cdc[_0x1fe773(0xb1)],'unit':_0xa98cdc['unit'],'maxProducts':_0xa98cdc[_0x1fe773(0xc9)]}));}),await _0x2d6840['save'](),console[_0x59306b(0x1dd)](_0x30a5e1[_0x59306b(0x1ac)]);const _0x629fa0=new c_payment_data({'invoice':_0x2ad4f7,'customer':_0x30a5e1[_0x59306b(0x1ac)][_0x59306b(0x16f)],'reason':_0x59306b(0x1c1)});await _0x629fa0[_0x59306b(0x195)]();const _0x23ff23=await master_shop[_0x59306b(0xeb)]();console[_0x59306b(0x1dd)]('add\x20post',_0x23ff23[0x0][_0x59306b(0x1d8)]);const _0x4b2a2a=await email_settings[_0x59306b(0xbc)](),_0x558323=await customer[_0x59306b(0xbc)]({'name':_0x30a5e1['body'][_0x59306b(0x16f)]});console['log'](_0x59306b(0x1a5),_0x558323);_0x23ff23[0x0][_0x59306b(0x1f0)]==0x1?(right_currency=_0x23ff23[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x23ff23[0x0][_0x59306b(0xc8)]);var _0x205368=_0x215a69,_0x344159=_0x9ccca7,_0x292b80='',_0x454e08;for(_0x454e08 in _0x205368){_0x292b80+=_0x59306b(0x16b)+_0x59306b(0xb4)+_0x205368[_0x454e08]+_0x59306b(0x1be)+_0x59306b(0xb4)+_0x344159[_0x454e08]+'</td>'+'</tr>';}console[_0x59306b(0x1dd)](_0x59306b(0x10c),_0x292b80);let _0x8ee24e=nodemailer[_0x59306b(0x1e9)]({'service':_0x59306b(0x19d),'auth':{'user':_0x4b2a2a['email'],'pass':_0x4b2a2a[_0x59306b(0x187)]}}),_0x319f04={'from':_0x4b2a2a[_0x59306b(0x1d0)],'to':_0x558323['email'],'subject':_0x59306b(0x184),'attachments':[{'filename':_0x59306b(0xcf),'path':__dirname+_0x59306b(0x117)+'/upload/'+_0x23ff23[0x0][_0x59306b(0x1d8)],'cid':_0x59306b(0x163)}],'html':_0x59306b(0x155)+_0x59306b(0xe9)+_0x59306b(0x13d)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x59306b(0xbe)+_0x59306b(0x179)+_0x59306b(0x1e8)+_0x59306b(0xbe)+_0x59306b(0x1d3)+_0x23ff23[0x0][_0x59306b(0xfe)]+'\x20</h2>'+'</div>'+_0x59306b(0x1e8)+_0x59306b(0xff)+_0x59306b(0xbe)+_0x59306b(0x186)+'\x20Order\x20Number\x20:\x20'+_0x2ad4f7+'\x20'+_0x59306b(0x1a2)+_0x59306b(0x140)+_0x218a82+'\x20'+_0x59306b(0x1bf)+_0x59306b(0xa9)+_0x59306b(0x1e8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x59306b(0x16b)+_0x59306b(0xe0)+_0x59306b(0x125)+_0x59306b(0xb8)+_0x59306b(0x1fa)+_0x59306b(0x18a)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x292b80+'\x20'+_0x59306b(0x161)+_0x59306b(0x108)+_0x59306b(0xbe)+_0x59306b(0x115)+_0x59306b(0xfa)+_0x23ff23[0x0]['site_title']+_0x59306b(0xa9)+_0x59306b(0x1e8)+'</div>'+'</body></html>'};_0x8ee24e[_0x59306b(0x130)](_0x319f04,function(_0x355be8,_0x49be4f){var _0x353e9d=_0x59306b;_0x355be8?(console[_0x353e9d(0x1dd)](_0x355be8),console[_0x353e9d(0x1dd)](_0x353e9d(0x138))):console[_0x353e9d(0x1dd)](_0x353e9d(0x152));}),_0x30a5e1[_0x59306b(0x164)](_0x59306b(0x109),_0x59306b(0x1fb)),_0x25cbc9['redirect'](_0x59306b(0xf1));}catch(_0x49a835){console[_0x59306b(0x1dd)](_0x49a835),_0x25cbc9['status'](0xc8)[_0x59306b(0xe3)]({'message1':_0x49a835[_0x59306b(0x14e)]});}}}),router[a0_0x56e626(0xc6)]('/barcode/:id',auth,async(_0x4d72eb,_0x365afe)=>{var _0x1952fc=a0_0x56e626;try{const {username:_0x368b41,email:_0x39c312,role:_0x4ba61e}=_0x4d72eb[_0x1952fc(0x1da)],_0x26fa16=_0x4d72eb[_0x1952fc(0x1da)],_0x49a8e3=await profile[_0x1952fc(0xbc)]({'email':_0x26fa16[_0x1952fc(0x1d0)]}),_0x1ece79=await master_shop[_0x1952fc(0xeb)]();console['log'](_0x1952fc(0x11c),_0x1ece79);const _0x5bd142=_0x4d72eb[_0x1952fc(0x1a9)]['id'],_0x2b50da=await sales[_0x1952fc(0x147)](_0x5bd142);console[_0x1952fc(0x1dd)]('barcode\x20user_id',_0x2b50da);if(_0x1ece79[0x0][_0x1952fc(0x10a)]=='English\x20(US)')var _0x13fe11=users[_0x1952fc(0xf7)];else{if(_0x1ece79[0x0][_0x1952fc(0x10a)]==_0x1952fc(0x17b))var _0x13fe11=users[_0x1952fc(0x17b)];else{if(_0x1ece79[0x0][_0x1952fc(0x10a)]==_0x1952fc(0xf6))var _0x13fe11=users[_0x1952fc(0xf6)];else{if(_0x1ece79[0x0][_0x1952fc(0x10a)]==_0x1952fc(0x1ba))var _0x13fe11=users[_0x1952fc(0x1ba)];else{if(_0x1ece79[0x0]['language']==_0x1952fc(0xbd))var _0x13fe11=users[_0x1952fc(0xbd)];else{if(_0x1ece79[0x0]['language']=='Portuguese\x20(BR)')var _0x13fe11=users[_0x1952fc(0x1ab)];else{if(_0x1ece79[0x0][_0x1952fc(0x10a)]=='Chinese')var _0x13fe11=users[_0x1952fc(0x1fc)];else{if(_0x1ece79[0x0][_0x1952fc(0x10a)]==_0x1952fc(0x105))var _0x13fe11=users[_0x1952fc(0x119)];}}}}}}}_0x365afe[_0x1952fc(0xbb)](_0x1952fc(0x11d),{'success':_0x4d72eb['flash'](_0x1952fc(0x109)),'errors':_0x4d72eb[_0x1952fc(0x164)](_0x1952fc(0x197)),'role':_0x26fa16,'profile':_0x49a8e3,'alldata':_0x2b50da,'master_shop':_0x1ece79,'language':_0x13fe11});}catch(_0x8ed946){console[_0x1952fc(0x1dd)](_0x8ed946);}}),router['post'](a0_0x56e626(0x1c2),async(_0x38f27f,_0x3a1abb)=>{var _0x218367=a0_0x56e626;const {product_code:_0x14fdc0,warehouse_name:_0x4f7213,rooms_data:_0x47dc4d,Roomslist:_0x34bd4c,sales_category:_0x420508}=_0x38f27f[_0x218367(0x1ac)],_0x28969c=_0x34bd4c[_0x218367(0xde)](','),_0x2d86df=[];async function _0xfa3144(_0x8f799d){var _0x457099=_0x218367;const _0x2c7297=await warehouse[_0x457099(0xd6)]([{'$match':{'name':_0x4f7213,'room':_0x8f799d}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x14fdc0}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x457099(0x173)},'product_stock':{'$first':_0x457099(0xf5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x457099(0x15b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x457099(0x1ae)},'bay':{'$first':'$product_details.bay'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x457099(0xe7)},'unit':{'$first':_0x457099(0xe5)},'secondary_unit':{'$first':_0x457099(0xe1)},'storage':{'$first':_0x457099(0x17a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x457099(0x16d)},'production_date':{'$first':_0x457099(0x133)},'maxPerUnit':{'$first':_0x457099(0x12d)},'batch_code':{'$first':_0x457099(0x17c)},'product_cat':{'$first':_0x457099(0x10f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x457099(0xba)},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0x457099(0xd7)},'gross_price':{'$first':_0x457099(0x1a0)},'sales_category':{'$first':'$product_details.sales_category'}}}]),_0x2b3603=await warehouse[_0x457099(0xd6)]([{'$match':{'name':_0x4f7213,'room':_0x8f799d}},{'$unwind':_0x457099(0x1de)},{'$match':{'product_details.secondary_code':_0x14fdc0}},{'$group':{'_id':_0x457099(0x1c6),'name':{'$first':_0x457099(0x173)},'product_stock':{'$first':_0x457099(0xf5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x457099(0x15b)},'product_code':{'$first':_0x457099(0x1ca)},'level':{'$first':_0x457099(0x1b8)},'isle':{'$first':_0x457099(0x11b)},'type':{'$first':_0x457099(0x135)},'pallet':{'$first':_0x457099(0xe7)},'unit':{'$first':_0x457099(0xe5)},'secondary_unit':{'$first':_0x457099(0xe1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x457099(0x12a)},'expiry_date':{'$first':_0x457099(0x16d)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x457099(0x12d)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x457099(0x10f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x457099(0xba)},'invoice':{'$first':_0x457099(0x18e)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0x457099(0x1a0)},'sales_category':{'$first':_0x457099(0x1f4)}}}]);if(_0x2c7297['length']>0x0)_0x2d86df[_0x457099(0x16c)](_0x2c7297);else _0x2b3603[_0x457099(0xc2)]>0x0&&_0x2d86df[_0x457099(0x16c)](_0x2b3603);}const _0x3af42c=_0x28969c[_0x218367(0xce)](_0x2aa7bc=>_0xfa3144(_0x2aa7bc));await Promise[_0x218367(0xb5)](_0x3af42c),_0x3a1abb[_0x218367(0xe3)](_0x2d86df);}),router[a0_0x56e626(0x15e)](a0_0x56e626(0x13e),async(_0x106fda,_0x3ef439)=>{var _0x32cf36=a0_0x56e626;const {product_code:_0x2e8bc3,warehouse_name:_0x6d4b89,rooms_data:_0xc65a3e,Roomslist:_0x216bc9,sales_category:_0x4166eb}=_0x106fda[_0x32cf36(0x1ac)],_0x47d0ce=_0x216bc9[_0x32cf36(0xde)](','),_0x7a2aa0=[];async function _0x47bc10(_0x28ab7e){var _0x497e95=_0x32cf36;const _0x250209=await warehouse[_0x497e95(0xd6)]([{'$match':{'name':_0x6d4b89,'room':_0x28ab7e}},{'$unwind':_0x497e95(0x1de)},{'$match':{'product_details.primary_code':_0x2e8bc3,'product_details.sales_category':_0x4166eb,'product_details.type_products':_0x497e95(0x1dd)}},{'$group':{'_id':_0x497e95(0x1c6),'name':{'$first':_0x497e95(0x173)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x497e95(0x18c)},'secondary_code':{'$first':_0x497e95(0x15b)},'product_code':{'$first':_0x497e95(0x1ca)},'level':{'$first':_0x497e95(0x1ae)},'bay':{'$first':_0x497e95(0x1b8)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x497e95(0xe7)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x497e95(0x17a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x497e95(0x133)},'maxPerUnit':{'$first':_0x497e95(0x12d)},'batch_code':{'$first':_0x497e95(0x17c)},'product_cat':{'$first':_0x497e95(0x10f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x497e95(0xba)},'invoice':{'$first':_0x497e95(0x18e)},'uuid':{'$first':_0x497e95(0xd7)},'gross_price':{'$first':_0x497e95(0x1a0)},'sales_category':{'$first':_0x497e95(0x1f4)},'type_products':{'$first':_0x497e95(0x188)}}}]);console[_0x497e95(0x1dd)]('log'+_0x497e95(0x14a)+_0x2e8bc3+_0x497e95(0x14a)+_0x4166eb);const _0x50b87a=await warehouse[_0x497e95(0xd6)]([{'$match':{'name':_0x6d4b89,'room':_0x28ab7e}},{'$unwind':_0x497e95(0x1de)},{'$match':{'product_details.secondary_code':_0x2e8bc3,'product_details.sales_category':_0x4166eb,'product_details.type_products':_0x497e95(0x1dd)}},{'$group':{'_id':_0x497e95(0x1c6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x497e95(0x18c)},'secondary_code':{'$first':_0x497e95(0x15b)},'product_code':{'$first':_0x497e95(0x1ca)},'level':{'$first':_0x497e95(0x1b8)},'isle':{'$first':_0x497e95(0x11b)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x497e95(0xe7)},'unit':{'$first':_0x497e95(0xe5)},'secondary_unit':{'$first':_0x497e95(0xe1)},'storage':{'$first':_0x497e95(0x17a)},'rack':{'$first':_0x497e95(0x12a)},'expiry_date':{'$first':_0x497e95(0x16d)},'production_date':{'$first':_0x497e95(0x133)},'maxPerUnit':{'$first':_0x497e95(0x12d)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x497e95(0x10f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x497e95(0x18e)},'uuid':{'$first':_0x497e95(0xd7)},'gross_price':{'$first':_0x497e95(0x1a0)},'sales_category':{'$first':_0x497e95(0x1f4)},'type_products':{'$first':_0x497e95(0x188)}}}]);if(_0x250209[_0x497e95(0xc2)]>0x0)_0x7a2aa0[_0x497e95(0x16c)](_0x250209);else _0x50b87a[_0x497e95(0xc2)]>0x0&&_0x7a2aa0['push'](_0x50b87a);}const _0x20aee3=_0x47d0ce[_0x32cf36(0xce)](_0x16f5a7=>_0x47bc10(_0x16f5a7));await Promise[_0x32cf36(0xb5)](_0x20aee3),_0x3ef439[_0x32cf36(0xe3)](_0x7a2aa0);}),router[a0_0x56e626(0x15e)](a0_0x56e626(0x13a),async(_0x22f410,_0x56f968)=>{var _0x2c5f54=a0_0x56e626;try{const {prduct_code:_0x5ba8a3,warehouse_data:_0x117c3d,qty_req:_0x3b71f5}=_0x22f410[_0x2c5f54(0x1ac)];let _0xcbc2aa=_0x5ba8a3['split']('~'),_0x3c46a1=_0x3b71f5[_0x2c5f54(0xde)]('~'),_0x22db49=[],_0x2981b1=0x0;for(let _0x4b2e78=0x0;_0x4b2e78<=_0xcbc2aa[_0x2c5f54(0xc2)]-0x1;_0x4b2e78++){const _0x466963=_0xcbc2aa[_0x4b2e78],_0x5d48ac=_0x3c46a1[_0x4b2e78],_0x2fd800=await warehouse['aggregate']([{'$match':{'name':_0x117c3d}},{'$unwind':_0x2c5f54(0x1de)},{'$match':{'product_details.product_code':_0x466963,'product_details.isAvailable':_0x2c5f54(0x1b2),'product_details.isUsed':_0x2c5f54(0x1b5)}},{'$sort':{'product_details.date_received':0x1,'product_details.level':-0x1,'product_details.bay':-0x1}},{'$group':{'_id':_0x2c5f54(0x1c6),'name':{'$first':_0x2c5f54(0x173)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2c5f54(0x18c)},'secondary_code':{'$first':_0x2c5f54(0x15b)},'product_code':{'$first':_0x2c5f54(0x1ca)},'level':{'$first':_0x2c5f54(0x1ae)},'bay':{'$first':_0x2c5f54(0x1b8)},'type':{'$first':_0x2c5f54(0x135)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2c5f54(0xe1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2c5f54(0x12a)},'expiry_date':{'$first':_0x2c5f54(0x16d)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x2c5f54(0x12d)},'batch_code':{'$first':_0x2c5f54(0x17c)},'product_cat':{'$first':_0x2c5f54(0x10f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2c5f54(0x18e)},'uuid':{'$first':_0x2c5f54(0xd7)},'gross_price':{'$first':_0x2c5f54(0x1a0)},'sales_category':{'$first':_0x2c5f54(0x1f4)},'date_received':{'$first':'$product_details.date_recieved'},'warehouse_id':{'$first':_0x2c5f54(0x193)}}}]),_0x528a97=_0x2fd800['sort']((_0x18378c,_0x34acbb)=>new Date(_0x18378c[_0x2c5f54(0x1c0)])-new Date(_0x34acbb['date_received']));let _0x2daeab=_0x5d48ac;for(let _0x257553=0x0;_0x257553<=_0x528a97[_0x2c5f54(0xc2)]-0x1&&_0x2daeab>0x0;_0x257553++){const _0x2e2ca2=_0x528a97[_0x257553];if(_0x2e2ca2[_0x2c5f54(0x131)]==_0x466963){_0x22db49[_0x2981b1]={};const _0x53b169=parseInt(_0x2e2ca2['product_stock']),_0x5aa250=0x0;let _0x551d35=_0x53b169-_0x5aa250,_0x3545bf=Math[_0x2c5f54(0x1b3)](_0x2daeab,_0x551d35);console[_0x2c5f54(0x1dd)](_0x2c5f54(0x1f8)+_0x3545bf+_0x2c5f54(0x19e)+_0x117c3d+',\x20room:\x20'+_0x2e2ca2[_0x2c5f54(0xd2)]+',\x20Location:\x20'+(_0x2e2ca2['level']+_0x2e2ca2[_0x2c5f54(0xc7)])+_0x2c5f54(0x139)+_0x2e2ca2[_0x2c5f54(0x1c0)]+_0x2c5f54(0x110)+_0x2e2ca2[_0x2c5f54(0x1c9)]),_0x22db49[_0x2981b1][_0x2c5f54(0x1cd)]=_0x2e2ca2[_0x2c5f54(0x18b)]+'~'+_0x2e2ca2[_0x2c5f54(0x12f)]+'~'+_0x3545bf,_0x22db49[_0x2981b1][_0x2c5f54(0x168)]=_0x2e2ca2[_0x2c5f54(0x1c9)],_0x22db49[_0x2981b1][_0x2c5f54(0x131)]=_0x2e2ca2[_0x2c5f54(0x131)],_0x22db49[_0x2981b1][_0x2c5f54(0xc4)]=_0x2e2ca2[_0x2c5f54(0xc4)],_0x22db49[_0x2981b1][_0x2c5f54(0xc0)]=_0x2e2ca2['date_recieved'],_0x22db49[_0x2981b1][_0x2c5f54(0x18d)]=_0x2e2ca2['sales_category'],_0x22db49[_0x2981b1][_0x2c5f54(0x121)]=_0x2e2ca2[_0x2c5f54(0x121)],_0x22db49[_0x2981b1][_0x2c5f54(0xea)]=_0x3545bf,_0x22db49[_0x2981b1][_0x2c5f54(0xf9)]=_0x2e2ca2[_0x2c5f54(0xf9)],_0x22db49[_0x2981b1][_0x2c5f54(0xb1)]=_0x2e2ca2[_0x2c5f54(0xb1)],_0x22db49[_0x2981b1][_0x2c5f54(0xaa)]=_0x2e2ca2['primary_code'],_0x22db49[_0x2981b1]['secondary_code']=_0x2e2ca2[_0x2c5f54(0x175)],_0x22db49[_0x2981b1][_0x2c5f54(0x123)]=_0x2e2ca2['maxStocks'],_0x22db49[_0x2981b1]['batch_code']=_0x2e2ca2[_0x2c5f54(0xda)],_0x22db49[_0x2981b1][_0x2c5f54(0x103)]=_0x2e2ca2['expiry_date'],_0x22db49[_0x2981b1][_0x2c5f54(0xaf)]=_0x2e2ca2[_0x2c5f54(0xaf)],_0x22db49[_0x2981b1][_0x2c5f54(0x1d4)]=_0x2e2ca2[_0x2c5f54(0x1d4)],_0x22db49[_0x2981b1][_0x2c5f54(0x1b0)]=_0x2e2ca2[_0x2c5f54(0x1b0)],_0x22db49[_0x2981b1][_0x2c5f54(0x1e5)]=_0x2e2ca2[_0x2c5f54(0x1e5)],_0x22db49[_0x2981b1][_0x2c5f54(0x112)]=_0x2e2ca2[_0x2c5f54(0x112)],_0x22db49[_0x2981b1][_0x2c5f54(0xe6)]=_0x2e2ca2['roomNamed'],_0x22db49[_0x2981b1][_0x2c5f54(0x166)]=_0x2e2ca2['level'],_0x22db49[_0x2981b1][_0x2c5f54(0xc7)]=_0x2e2ca2[_0x2c5f54(0xc7)],_0x22db49[_0x2981b1][_0x2c5f54(0x1db)]='true',console[_0x2c5f54(0x1dd)]('1',_0x2981b1),_0x2daeab-=_0x3545bf,_0x2981b1++;if(_0x2daeab<=0x0)break;}}if(_0x2daeab>0x0){var _0x57dba2=await product[_0x2c5f54(0xbc)]({'product_code':_0x466963});console[_0x2c5f54(0x1dd)]('2',_0x2981b1),_0x22db49[_0x2981b1]={},_0x22db49[_0x2981b1][_0x2c5f54(0x168)]=_0x57dba2[_0x2c5f54(0x1c9)],_0x22db49[_0x2981b1]['product_code']=_0x466963,_0x22db49[_0x2981b1]['product_id']=_0x57dba2[_0x2c5f54(0x12f)][_0x2c5f54(0x1e3)](),_0x22db49[_0x2981b1][_0x2c5f54(0xea)]=_0x2daeab,_0x22db49[_0x2981b1][_0x2c5f54(0x106)]=_0x57dba2[_0x2c5f54(0xf9)],_0x22db49[_0x2981b1][_0x2c5f54(0xb1)]=_0x57dba2[_0x2c5f54(0x124)],_0x22db49[_0x2981b1]['primary_code']=_0x57dba2[_0x2c5f54(0xaa)],_0x22db49[_0x2981b1][_0x2c5f54(0x175)]=_0x57dba2['secondary_code'],_0x22db49[_0x2981b1][_0x2c5f54(0x123)]=_0x57dba2[_0x2c5f54(0x123)],_0x22db49[_0x2981b1][_0x2c5f54(0x1d4)]=_0x57dba2[_0x2c5f54(0x158)],_0x22db49[_0x2981b1][_0x2c5f54(0x112)]=_0x57dba2[_0x2c5f54(0x112)],_0x22db49[_0x2981b1][_0x2c5f54(0x1db)]=_0x2c5f54(0x1b5),console['log'](_0x2c5f54(0xcc)+_0x2daeab+'\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20'+_0x2981b1+_0x2c5f54(0x14a)+_0x466963),_0x2981b1++;}}_0x56f968['json'](_0x22db49);}catch(_0x354e2b){console[_0x2c5f54(0x1dd)](_0x354e2b);}}),router[a0_0x56e626(0x15e)]('/barcode_scanner_auto',async(_0x45b4cd,_0x5e2dde)=>{var _0xc0e8f6=a0_0x56e626;const {product_code:_0x2dabbd}=_0x45b4cd[_0xc0e8f6(0x1ac)];var _0x3b9e4a;const _0x2ca5ae=await product[_0xc0e8f6(0xd6)]([{'$match':{'primary_code':_0x2dabbd}},{'$group':{'_id':_0xc0e8f6(0x193),'name':{'$first':_0xc0e8f6(0x1bd)},'category':{'$first':_0xc0e8f6(0x174)},'brand':{'$first':_0xc0e8f6(0x1f5)},'unit':{'$first':_0xc0e8f6(0xae)},'alertquantity':{'$first':_0xc0e8f6(0xc3)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xc0e8f6(0x171)},'secondary_code':{'$first':_0xc0e8f6(0x19f)},'maxStocks':{'$first':_0xc0e8f6(0x1af)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xc0e8f6(0x122)},'gross_price':{'$first':'$gross_price'},'sales_category':{'$first':_0xc0e8f6(0x159)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0xe4ecef=await product[_0xc0e8f6(0xd6)]([{'$match':{'secondary_code':_0x2dabbd}},{'$group':{'_id':_0xc0e8f6(0x193),'name':{'$first':_0xc0e8f6(0x1bd)},'category':{'$first':_0xc0e8f6(0x174)},'brand':{'$first':'$brand'},'unit':{'$first':_0xc0e8f6(0xae)},'alertquantity':{'$first':_0xc0e8f6(0xc3)},'product_code':{'$first':_0xc0e8f6(0x12e)},'primary_code':{'$first':_0xc0e8f6(0x171)},'secondary_code':{'$first':_0xc0e8f6(0x19f)},'maxStocks':{'$first':_0xc0e8f6(0x1af)},'maxProdPerUnit':{'$first':_0xc0e8f6(0x148)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xc0e8f6(0x122)},'gross_price':{'$first':_0xc0e8f6(0x11a)},'sales_category':{'$first':_0xc0e8f6(0x159)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x2ca5ae[_0xc0e8f6(0xc2)]>0x0)_0x3b9e4a=_0x2ca5ae;else _0xe4ecef[_0xc0e8f6(0xc2)]>0x0&&(_0x3b9e4a=_0xe4ecef);_0x5e2dde['json'](_0x3b9e4a);}),router[a0_0x56e626(0x15e)](a0_0x56e626(0xac),async(_0x280517,_0x44ca0e)=>{var _0x141cd4=a0_0x56e626;try{const {group_id:_0x23f824,DRSI:_0x4b9b7f,dateofreq:_0x18f3ae,PO_number:_0x17c179,date:_0x597a53,warehouse_name:_0x4d8271,typevehicle:_0x1f86b2,deliverydate:_0x39f47b,driver:_0x43d5ee,plate:_0x16bd76,van:_0x506825,TSU:_0x5991dd,actual_delivery_date:_0x1699bd,TFU:_0x39e626,pull_out_date:_0x4a296b,sales:_0x2447cf,Customer_data:_0x820c53,note:_0x1242ff}=_0x280517['body'],_0x5b4ec2=mongoose[_0x141cd4(0x1e4)][_0x141cd4(0x116)];let _0x4920cc=[];const _0x31b626=new invoice_for_outgoing();await _0x31b626['save']();const _0x9584f1=_0x141cd4(0x128)+_0x31b626[_0x141cd4(0x11e)][_0x141cd4(0x189)]()[_0x141cd4(0x1b7)](0x8,'0');if(typeof _0x23f824==_0x141cd4(0x100)){let _0x2ecf1b=_0x23f824['split']('~');var _0x2fd725=_0x5b4ec2(_0x2ecf1b[0x0]),_0x19ecf9=_0x5b4ec2(_0x2ecf1b[0x1]),_0x2f2bbc=_0x2ecf1b[0x2];let _0xc602f3=0x0;const _0x19b953=await warehouse['aggregate']([{'$match':{'_id':_0x2fd725}},{'$unwind':_0x141cd4(0x1de)},{'$match':{'product_details._id':_0x19ecf9}}]);await warehouse['updateOne']({'_id':_0x5b4ec2(_0x2fd725),'product_details._id':_0x5b4ec2(_0x19ecf9)},{'$set':{'product_details.$.isUsed':_0x141cd4(0x1b2)}}),_0x4920cc[_0xc602f3]={};for(let _0x58b678=0x0;_0x58b678<=_0x19b953[_0x141cd4(0xc2)]-0x1;_0x58b678++){const _0x3bbc86=_0x19b953[_0x58b678];console[_0x141cd4(0x1dd)](_0x3bbc86),_0x4920cc[_0xc602f3]['warehouse']=_0x3bbc86[_0x141cd4(0x1c9)],_0x4920cc[_0xc602f3][_0x141cd4(0xc4)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xc4)],_0x4920cc[_0xc602f3][_0x141cd4(0x168)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x168)],_0x4920cc[_0xc602f3][_0x141cd4(0x131)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x131)],_0x4920cc[_0xc602f3]['product_stock']=_0x2f2bbc,_0x4920cc[_0xc602f3][_0x141cd4(0xea)]=_0x2f2bbc,_0x4920cc[_0xc602f3][_0x141cd4(0xf9)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xf9)],_0x4920cc[_0xc602f3][_0x141cd4(0xb1)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xb1)],_0x4920cc[_0xc602f3][_0x141cd4(0x166)]=_0x3bbc86['product_details'][_0x141cd4(0x166)],_0x4920cc[_0xc602f3][_0x141cd4(0xc7)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xc7)],_0x4920cc[_0xc602f3][_0x141cd4(0xaa)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xaa)],_0x4920cc[_0xc602f3]['secondary_code']=_0x3bbc86['product_details'][_0x141cd4(0x175)],_0x4920cc[_0xc602f3][_0x141cd4(0x123)]=_0x3bbc86[_0x141cd4(0x102)]['maxStocks'],_0x4920cc[_0xc602f3][_0x141cd4(0xda)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xda)],_0x4920cc[_0xc602f3][_0x141cd4(0x103)]=_0x3bbc86['product_details']['expiry_date'],_0x4920cc[_0xc602f3][_0x141cd4(0xaf)]=_0x3bbc86['product_details']['production_date'],_0x4920cc[_0xc602f3]['maxperunit']=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x1d4)],_0x4920cc[_0xc602f3][_0x141cd4(0x1b0)]=_0x3bbc86[_0x141cd4(0x102)]['product_cat'],_0x4920cc[_0xc602f3][_0x141cd4(0xe6)]=_0x3bbc86['room'],_0x4920cc[_0xc602f3][_0x141cd4(0x1e5)]=_0x3bbc86[_0x141cd4(0x102)]['invoice'],_0x4920cc[_0xc602f3][_0x141cd4(0x121)]=_0x3bbc86['product_details']['uuid'],_0x4920cc[_0xc602f3]['gross_price']=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x112)],_0x4920cc[_0xc602f3][_0x141cd4(0x18d)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x1eb)],_0x4920cc[_0xc602f3][_0x141cd4(0xc0)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0xc0)],_0x4920cc[_0xc602f3]['sales_id']=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x1eb)],_0x4920cc[_0xc602f3][_0x141cd4(0x18b)]=_0x3bbc86[_0x141cd4(0x12f)][_0x141cd4(0x1e3)](),_0x4920cc[_0xc602f3][_0x141cd4(0x149)]=_0x3bbc86[_0x141cd4(0x102)][_0x141cd4(0x12f)][_0x141cd4(0x1e3)](),_0x4920cc[_0xc602f3][_0x141cd4(0x176)]=_0x141cd4(0x14b),_0x4920cc[_0xc602f3]['agent_id']=_0x3bbc86[_0x141cd4(0x102)]['sales'];}_0x4920cc[_0xc602f3][_0x141cd4(0x1cc)]=_0x9584f1;}else for(let _0x2b6705=0x0;_0x2b6705<=_0x23f824[_0x141cd4(0xc2)]-0x1;_0x2b6705++){const _0x3e1cd3=_0x23f824[_0x2b6705];let _0x1e31f7=_0x3e1cd3[_0x141cd4(0xde)]('~');console[_0x141cd4(0x1dd)](_0x1e31f7);var _0x2fd725=_0x5b4ec2(_0x1e31f7[0x0]),_0x19ecf9=_0x5b4ec2(_0x1e31f7[0x1]),_0x2f2bbc=_0x1e31f7[0x2];const _0x18e71c=await warehouse[_0x141cd4(0xd6)]([{'$match':{'_id':_0x2fd725}},{'$unwind':_0x141cd4(0x1de)},{'$match':{'product_details._id':_0x19ecf9}}]);await warehouse['updateOne']({'_id':_0x5b4ec2(_0x2fd725),'product_details._id':_0x5b4ec2(_0x19ecf9)},{'$set':{'product_details.$.isUsed':_0x141cd4(0x1b2)}}),_0x4920cc[_0x2b6705]={};for(let _0x4c917f=0x0;_0x4c917f<=_0x18e71c[_0x141cd4(0xc2)]-0x1;_0x4c917f++){const _0x2c4808=_0x18e71c[_0x4c917f];_0x4920cc[_0x2b6705]['warehouse']=_0x2c4808['name'],_0x4920cc[_0x2b6705][_0x141cd4(0xc4)]=_0x2c4808[_0x141cd4(0x102)]['product_id'],_0x4920cc[_0x2b6705][_0x141cd4(0x168)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x168)],_0x4920cc[_0x2b6705]['product_code']=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x131)],_0x4920cc[_0x2b6705][_0x141cd4(0x107)]=_0x2f2bbc,_0x4920cc[_0x2b6705][_0x141cd4(0xea)]=_0x2f2bbc,_0x4920cc[_0x2b6705][_0x141cd4(0xf9)]=_0x2c4808['product_details'][_0x141cd4(0xf9)],_0x4920cc[_0x2b6705][_0x141cd4(0xb1)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0xb1)],_0x4920cc[_0x2b6705][_0x141cd4(0x166)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x166)],_0x4920cc[_0x2b6705]['bay']=_0x2c4808['product_details'][_0x141cd4(0xc7)],_0x4920cc[_0x2b6705]['primary_code']=_0x2c4808[_0x141cd4(0x102)]['primary_code'],_0x4920cc[_0x2b6705]['secondary_code']=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x175)],_0x4920cc[_0x2b6705][_0x141cd4(0x123)]=_0x2c4808['product_details'][_0x141cd4(0x123)],_0x4920cc[_0x2b6705]['batch_code']=_0x2c4808['product_details']['batch_code'],_0x4920cc[_0x2b6705]['expiry_date']=_0x2c4808[_0x141cd4(0x102)]['expiry_date'],_0x4920cc[_0x2b6705][_0x141cd4(0xaf)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0xaf)],_0x4920cc[_0x2b6705][_0x141cd4(0x1d4)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x1d4)],_0x4920cc[_0x2b6705][_0x141cd4(0x1b0)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x1b0)],_0x4920cc[_0x2b6705][_0x141cd4(0xe6)]=_0x2c4808[_0x141cd4(0x1d6)],_0x4920cc[_0x2b6705][_0x141cd4(0x1e5)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x1e5)],_0x4920cc[_0x2b6705][_0x141cd4(0x121)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x121)],_0x4920cc[_0x2b6705]['gross_price']=_0x2c4808['product_details']['gross_price'],_0x4920cc[_0x2b6705][_0x141cd4(0x18d)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x1eb)],_0x4920cc[_0x2b6705][_0x141cd4(0xc0)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0xc0)],_0x4920cc[_0x2b6705][_0x141cd4(0x191)]=_0x2c4808[_0x141cd4(0x102)]['sales'],_0x4920cc[_0x2b6705]['warehouse_id']=_0x2c4808[_0x141cd4(0x12f)]['valueOf'](),_0x4920cc[_0x2b6705]['warehouse_id_detl']=_0x2c4808['product_details'][_0x141cd4(0x12f)][_0x141cd4(0x1e3)](),_0x4920cc[_0x2b6705][_0x141cd4(0x176)]=_0x141cd4(0x14b),_0x4920cc[_0x2b6705][_0x141cd4(0xdf)]=_0x2c4808[_0x141cd4(0x102)][_0x141cd4(0x1eb)];}_0x4920cc[_0x2b6705][_0x141cd4(0x1cc)]=_0x9584f1;}for(let _0x401f8c=0x0;_0x401f8c<=_0x4920cc[_0x141cd4(0xc2)]-0x1;_0x401f8c++){const _0x412696=_0x4920cc[_0x401f8c],_0xb89e54=new warehouse_temporary(_0x412696);await _0xb89e54['save']();}const _0xd7f0a=new sales_finished({'invoice':_0x9584f1,'sales_data':_0x2447cf,'customer':_0x820c53,'date':_0x597a53,'warehouse_name':_0x4d8271,'sale_product':_0x4920cc,'note':_0x1242ff,'finalize':_0x141cd4(0xf2),'dateofreq':_0x18f3ae,'PO_number':_0x17c179,'typevehicle':_0x1f86b2,'deliverydate':_0x39f47b,'driver':_0x43d5ee,'plate':_0x16bd76,'van':_0x506825,'DRSI':_0x4b9b7f,'TSU':_0x5991dd,'TFU':_0x39e626,'pullout_date':_0x4a296b,'actualdelivery_date':_0x1699bd,'typeOfProducts':_0x141cd4(0x1f2)}),_0x32a7bd=await _0xd7f0a[_0x141cd4(0x195)]();_0x280517['flash'](_0x141cd4(0x109),'Sales\x20Add\x20successfully'),_0x44ca0e[_0x141cd4(0xad)](_0x141cd4(0x13f)+_0x32a7bd[_0x141cd4(0x12f)]);}catch(_0x39f9cd){console['log'](_0x39f9cd);}}),module[a0_0x56e626(0x177)]=router;