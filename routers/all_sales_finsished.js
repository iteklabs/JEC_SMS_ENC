var a0_0x5dca55=a0_0x2a53;function a0_0x41f5(){var _0x2c8a47=['$gross_price','product_data','<h5>','\x20Order\x20Number\x20:\x20','true','product_stock','bay','RoomAssigned','site_title','product_list','OUTF-','$product_details.room_name','Email\x20sent\x20successfully','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/:id','\x20<>\x20','maxProducts','$maxStocks','$product_details.maxProducts','False','<h5\x20style=\x22text-align:\x20left;\x22>','max_per_unit','/view_log','filter','secondary_code_QA','</tr>','return_qty_QA','all_sales_finished_logs','aggregate','uuid','return_qty','194625UkEqKK','then','$customer','abs','$product','stock_data','flash','$room','$product_details.rack','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','6707327vFTIDt','$secondary_unit','invoice','$finalize','Ambient','../public/language/languages.json','Enclosed','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','suppliers','Quality\x20Inspection','/all_sales_finished/view','/../public','<h2>\x20','sales_quantity','id_transaction_from','\x20</h2>','<tbody\x20style=\x22text-align:\x20center;\x22>','add_sales_finished','ObjectId','role','sort','$return_data','prod_code','production_date_QA','/all_sales_finished/preview/','OUT-','English\x20(US)','</thead>','$product_details.batch_code','$product_details.storage','currency_placement','5aDiYQC','4384828uCbsCr','expiry_date','/view/add_sales_logs','find','sale_product','Portuguese','1957656KpjYvy','secondary_unit','maxperunit','$product_details.uuid','add\x20post','/view/add_sale/product','Arabic','getFullYear','int','success','date_recieved','findOne','render','<html><head><title></title>','body','</tbody>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','valueOf','image','/upload/','product_code_QA','language','post','all','$invoice','findById','$product_code','batch_code_QA','sales_invoice','agent_id','sendMail','customer','batch_code','Sale\x20Return\x20Mail','product_details','$product_details.product_stock','$customers_docs','concat','$sale_product.bin','params','9989950wjzInj','message','$secondary_code','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Sales\x20Update\x20successfully','Error\x20Occurs','random','data_type','</h5>','Sales\x20Add\x20successfully','_id','stock','primary_unit','get','date_received','English','$product_details','$_id','\x20units\x20to\x20warehouse:\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Enabled','product','$product_details.product_code','outgoing_invoice','received_amount','$product_details.product_name','</body></html>','110810mWZsqQ','\x20&&\x20','master','maxStocks','$primary_code','unit','$product_details.unit','product_date','/view','$product_details.level','level2','$sale_product.floorlevel','3GNwVPr','save','warehouse_name','\x20Order\x20Date\x20:\x20','$product.product_name','currency','LOG-OUT-','prod_invoice','Received\x20Payment\x20For\x20Sale','$note','errors','Portuguese\x20(BR)','email','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','logo','\x20Name:\x20','max','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_name_QA1','adjust_qty','status','Types','gmail','getMonth','staff','maxProducts_QA','invoice_init','mongoose','carton','all_sales_barcode','True','sales','production_date','date_data','stocks_QA','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Finished\x20Goods','outgoiug_inv','split','$alertquantity','all_sales_finished','$sale_product.bay','product_code','sales_id','toString','/give_payment/:id','$product_details.bin','$product_details.gross_price','here','roomNamed','floor','logs','string','quantity','$name','<tr>','$product_details.invoice','out','secondary_code','return_sale_QA','$product_details.secondary_unit','product_name','</head><body>','forEach','payment\x20successfull','/process/view','<div>','French','Spanish','There\x20is\x20','push','/picking_list/pdf/','user','room','barcode\x20Product\x20master','$product_details.production_date','$brand','/view/add_sales','German','$product_details.bay','Hindi','min','createTransport','expiry_date_QA','edit_sales_finished_view','gross_price','edit_sales_finished','<hr\x20class=\x22my-3\x22>','warehouse_id_detl','Router','product_cat','name','primary_code','/view/return_sales/:id','standard_unit','$product_details.sales_category','undefined','secondary_unit_QA',',\x20room:\x20','purchases_data','note','log','\x20units\x20left\x20that\x20couldn\x27t\x20be\x20placed\x20in\x20any\x20bin.\x20<>\x20\x20','/barcode_scanner_auto_data','maxPerUnit_QA','</span>','maxPerUnit','Arabic\x20(ae)','$sales_category','$warehouse_name','second_unit','updateOne','$date','return_data','$maxProdPerUnit','exports','map','/barcode_scanner','2HpzVie','$product_details.product_cat','barcode\x20user_id','<!DOCTYPE\x20html>','password','maxProdPerUnit','$sale_product.quantity','redirect','warehouse_id','length','\x20==\x20','room_name','padStart','warehouse','prod_cat','<span\x20style=\x22float:\x20right;\x22>','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Logo.png','/preview/:id','catch','$product_details._id','primary_code_QA','216858mpRYYX','$product_details.maxPerUnit','$product_details.primary_code','$product_details.floorlevel','own','slice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Sale\x20Return','Distributing\x20','$sale_product','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</td>','sales_category','$unit','$product_details.type','sale_qty','$sale_product.type','unit_QA','sales\x20item\x20return\x20successfull','for_categorize','$product_details.expiry_date','json','product_id','$product_details.type_products','false','$product_details.date_recieved','</table>','Chinese','16QOEFca'];a0_0x41f5=function(){return _0x2c8a47;};return a0_0x41f5();}(function(_0x1db1a4,_0x26048e){var _0x4a7799=a0_0x2a53,_0x29b8b7=_0x1db1a4();while(!![]){try{var _0x2adde4=parseInt(_0x4a7799(0x192))/0x1*(-parseInt(_0x4a7799(0xcb))/0x2)+-parseInt(_0x4a7799(0x19e))/0x3*(-parseInt(_0x4a7799(0x14f))/0x4)+parseInt(_0x4a7799(0x148))/0x5*(-parseInt(_0x4a7799(0xe2))/0x6)+parseInt(_0x4a7799(0x149))/0x7+parseInt(_0x4a7799(0xff))/0x8*(-parseInt(_0x4a7799(0x11f))/0x9)+-parseInt(_0x4a7799(0x177))/0xa+parseInt(_0x4a7799(0x129))/0xb;if(_0x2adde4===_0x26048e)break;else _0x29b8b7['push'](_0x29b8b7['shift']());}catch(_0x5bad3b){_0x29b8b7['push'](_0x29b8b7['shift']());}}}(a0_0x41f5,0x82f39));function a0_0x2a53(_0x5ad44c,_0x5ebfdf){var _0x41f5d9=a0_0x41f5();return a0_0x2a53=function(_0x2a530b,_0x113392){_0x2a530b=_0x2a530b-0x9d;var _0x2a27e7=_0x41f5d9[_0x2a530b];return _0x2a27e7;},a0_0x2a53(_0x5ad44c,_0x5ebfdf);}const express=require('express'),app=express(),router=express[a0_0x5dca55(0xae)](),{profile,master_shop,product,warehouse,staff,customer,purchases,sales,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs,warehouse_temporary,warehouse_validation_setup}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x5dca55(0x12e)),mongoose=require(a0_0x5dca55(0x1ba));router['get'](a0_0x5dca55(0x19a),auth,async(_0x49394e,_0x398e1a)=>{var _0x3a20da=a0_0x5dca55;try{const {username:_0x1d8527,email:_0x389c59,role:_0x5695cb}=_0x49394e['user'],_0x3c560b=_0x49394e[_0x3a20da(0x9d)],_0x3d1bf9=await profile['findOne']({'email':_0x3c560b['email']}),_0x57bce9=await master_shop[_0x3a20da(0x14c)]();let _0x273a51;if(_0x3c560b[_0x3a20da(0x13c)]==_0x3a20da(0x1b7)){const _0x4408b1=await staff[_0x3a20da(0x15a)]({'email':_0x3c560b[_0x3a20da(0x1aa)]});_0x273a51=await sales_finished[_0x3a20da(0x11c)]([{'$match':{'typeOfProducts':_0x3a20da(0xe6)}},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3a20da(0x188),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3a20da(0x121)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3a20da(0xc2)},'sale_product':{'$push':_0x3a20da(0xeb)},'note':{'$first':'$note'},'return_data':{'$first':_0x3a20da(0x13e)},'customers_docs':{'$first':_0x3a20da(0x173)},'total_saleproduct_quantity':{'$sum':_0x3a20da(0xd1)},'level':{'$addToSet':_0x3a20da(0x1c9)},'isle':{'$addToSet':_0x3a20da(0x175)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3a20da(0x12c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x273a51=await sales_finished[_0x3a20da(0x11c)]([{'$match':{'typeOfProducts':_0x3a20da(0xe6)}},{'$unwind':_0x3a20da(0xeb)},{'$group':{'_id':_0x3a20da(0x188),'invoice':{'$first':_0x3a20da(0x167)},'customers':{'$first':_0x3a20da(0x121)},'date':{'$first':_0x3a20da(0xc5)},'warehouse_name':{'$first':_0x3a20da(0xc2)},'sale_product':{'$push':_0x3a20da(0xeb)},'note':{'$first':_0x3a20da(0x1a7)},'return_data':{'$first':_0x3a20da(0x13e)},'customers_docs':{'$first':_0x3a20da(0x173)},'total_saleproduct_quantity':{'$sum':_0x3a20da(0xd1)},'level':{'$addToSet':_0x3a20da(0x1c9)},'isle':{'$addToSet':_0x3a20da(0x175)},'type':{'$addToSet':_0x3a20da(0xf3)},'pallet':{'$addToSet':_0x3a20da(0x19d)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x57bce9[0x0][_0x3a20da(0x164)]==_0x3a20da(0x143)){var _0x3593cd=users[_0x3a20da(0x186)];console[_0x3a20da(0xba)](_0x3593cd);}else{if(_0x57bce9[0x0]['language']=='Hindi')var _0x3593cd=users[_0x3a20da(0xa5)];else{if(_0x57bce9[0x0][_0x3a20da(0x164)]==_0x3a20da(0xa3))var _0x3593cd=users[_0x3a20da(0xa3)];else{if(_0x57bce9[0x0][_0x3a20da(0x164)]=='Spanish')var _0x3593cd=users['Spanish'];else{if(_0x57bce9[0x0][_0x3a20da(0x164)]==_0x3a20da(0x1e3))var _0x3593cd=users['French'];else{if(_0x57bce9[0x0][_0x3a20da(0x164)]==_0x3a20da(0x1a9))var _0x3593cd=users['Portuguese'];else{if(_0x57bce9[0x0][_0x3a20da(0x164)]==_0x3a20da(0xfe))var _0x3593cd=users[_0x3a20da(0xfe)];else{if(_0x57bce9[0x0]['language']=='Arabic\x20(ae)')var _0x3593cd=users[_0x3a20da(0x155)];}}}}}}}_0x398e1a[_0x3a20da(0x15b)](_0x3a20da(0x1c8),{'success':_0x49394e[_0x3a20da(0x125)](_0x3a20da(0x158)),'errors':_0x49394e['flash'](_0x3a20da(0x1a8)),'sales':_0x273a51,'profile':_0x3d1bf9,'role':_0x3c560b,'master_shop':_0x57bce9,'language':_0x3593cd});}catch(_0x49ae08){console[_0x3a20da(0xba)](_0x49ae08);}}),router[a0_0x5dca55(0x184)](a0_0x5dca55(0x116),auth,async(_0x3c506a,_0x2e4be4)=>{var _0xdc9585=a0_0x5dca55;try{const {username:_0x5a1b1c,email:_0x57ddb4,role:_0x48fdcf}=_0x3c506a['user'],_0xe837e9=_0x3c506a[_0xdc9585(0x9d)],_0x11dc25=await profile[_0xdc9585(0x15a)]({'email':_0xe837e9[_0xdc9585(0x1aa)]}),_0x4586af=await master_shop[_0xdc9585(0x14c)]();let _0x1701ae;if(_0xe837e9['role']==_0xdc9585(0x1b7)){const _0x16b4be=await staff['findOne']({'email':_0xe837e9['email']});_0x1701ae=await sales_finished[_0xdc9585(0x11c)]([{'$match':{'typeOfProducts':_0xdc9585(0x1d3)}},{'$unwind':_0xdc9585(0xeb)},{'$group':{'_id':_0xdc9585(0x188),'invoice':{'$first':_0xdc9585(0x167)},'customers':{'$first':_0xdc9585(0x121)},'date':{'$first':_0xdc9585(0xc5)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0xdc9585(0xeb)},'note':{'$first':_0xdc9585(0x1a7)},'return_data':{'$first':_0xdc9585(0x13e)},'customers_docs':{'$first':_0xdc9585(0x173)},'total_saleproduct_quantity':{'$sum':_0xdc9585(0xd1)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0xdc9585(0x175)},'type':{'$addToSet':_0xdc9585(0xf3)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0xdc9585(0x12c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x1701ae=await sales_finished[_0xdc9585(0x11c)]([{'$match':{'typeOfProducts':'logs'}},{'$unwind':_0xdc9585(0xeb)},{'$group':{'_id':_0xdc9585(0x188),'invoice':{'$first':_0xdc9585(0x167)},'customers':{'$first':_0xdc9585(0x121)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xdc9585(0xc2)},'sale_product':{'$push':_0xdc9585(0xeb)},'note':{'$first':_0xdc9585(0x1a7)},'return_data':{'$first':_0xdc9585(0x13e)},'customers_docs':{'$first':_0xdc9585(0x173)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xdc9585(0x1c9)},'isle':{'$addToSet':_0xdc9585(0x175)},'type':{'$addToSet':_0xdc9585(0xf3)},'pallet':{'$addToSet':_0xdc9585(0x19d)},'finalize':{'$first':_0xdc9585(0x12c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4586af[0x0]['language']==_0xdc9585(0x143)){var _0x27375f=users[_0xdc9585(0x186)];console['log'](_0x27375f);}else{if(_0x4586af[0x0][_0xdc9585(0x164)]=='Hindi')var _0x27375f=users[_0xdc9585(0xa5)];else{if(_0x4586af[0x0]['language']=='German')var _0x27375f=users['German'];else{if(_0x4586af[0x0][_0xdc9585(0x164)]==_0xdc9585(0x1e4))var _0x27375f=users[_0xdc9585(0x1e4)];else{if(_0x4586af[0x0][_0xdc9585(0x164)]==_0xdc9585(0x1e3))var _0x27375f=users['French'];else{if(_0x4586af[0x0][_0xdc9585(0x164)]==_0xdc9585(0x1a9))var _0x27375f=users['Portuguese'];else{if(_0x4586af[0x0][_0xdc9585(0x164)]==_0xdc9585(0xfe))var _0x27375f=users['Chinese'];else{if(_0x4586af[0x0][_0xdc9585(0x164)]=='Arabic\x20(ae)')var _0x27375f=users[_0xdc9585(0x155)];}}}}}}}_0x2e4be4[_0xdc9585(0x15b)](_0xdc9585(0x11b),{'success':_0x3c506a[_0xdc9585(0x125)](_0xdc9585(0x158)),'errors':_0x3c506a[_0xdc9585(0x125)]('errors'),'sales':_0x1701ae,'profile':_0x11dc25,'role':_0xe837e9,'master_shop':_0x4586af,'language':_0x27375f});}catch(_0x31d131){console[_0xdc9585(0xba)](_0x31d131);}});async function getRandom8DigitNumber(){var _0x123fe7=a0_0x5dca55;const _0x2b21ca=0x989680,_0x1a86a7=0x5f5e0ff,_0x1898ed=Math[_0x123fe7(0x1d2)](Math[_0x123fe7(0x17d)]()*(_0x1a86a7-_0x2b21ca+0x1))+_0x2b21ca;var _0x4b659d;const _0x4aecdb=await sales_finished[_0x123fe7(0x15a)]({'invoice':'OUTF-'+_0x1898ed});return _0x4aecdb&&_0x4aecdb['length']>0x0?_0x4b659d=_0x123fe7(0x10a)+_0x1898ed:_0x4b659d=_0x123fe7(0x10a)+_0x1898ed,_0x4b659d;}router['get'](a0_0x5dca55(0xa2),auth,async(_0x59a1e2,_0x2db7e5)=>{var _0x447785=a0_0x5dca55;try{const {username:_0x443024,email:_0x526201,role:_0x32d249}=_0x59a1e2[_0x447785(0x9d)],_0x25154d=_0x59a1e2['user'],_0x2e6c65=await profile[_0x447785(0x15a)]({'email':_0x25154d[_0x447785(0x1aa)]}),_0x290d7b=await master_shop[_0x447785(0x14c)](),_0x3b8367=await customer[_0x447785(0x14c)]({});let _0x32086;if(_0x25154d[_0x447785(0x13c)]==_0x447785(0x1b7)){const _0xa73877=await staff[_0x447785(0x15a)]({'email':_0x25154d[_0x447785(0x1aa)]});_0x32086=await warehouse['aggregate']([{'$match':{'status':_0x447785(0x18b),'name':_0xa73877[_0x447785(0xd8)]}},{'$group':{'_id':_0x447785(0x1d6),'name':{'$first':_0x447785(0x1d6)}}},{'$sort':{'name':0x1}}]);}else _0x32086=await warehouse[_0x447785(0x11c)]([{'$match':{'status':_0x447785(0x18b)}},{'$group':{'_id':_0x447785(0x1d6),'name':{'$first':_0x447785(0x1d6)}}},{'$sort':{'name':0x1}}]);const _0x115647=await product['find']({});var _0x3c5af3=[_0x447785(0x12d),_0x447785(0x12f)];const _0x3979db=await sales_finished[_0x447785(0x14c)]({}),_0x4dfd90=_0x3979db[_0x447785(0xd4)]+0x1,_0x36ce3e='OUTF-'+_0x4dfd90[_0x447785(0x1cc)]()[_0x447785(0xd7)](0x5,'0');if(_0x290d7b[0x0][_0x447785(0x164)]==_0x447785(0x143)){var _0x288a04=users[_0x447785(0x186)];console[_0x447785(0xba)](_0x288a04);}else{if(_0x290d7b[0x0][_0x447785(0x164)]=='Hindi')var _0x288a04=users[_0x447785(0xa5)];else{if(_0x290d7b[0x0][_0x447785(0x164)]=='German')var _0x288a04=users[_0x447785(0xa3)];else{if(_0x290d7b[0x0]['language']==_0x447785(0x1e4))var _0x288a04=users[_0x447785(0x1e4)];else{if(_0x290d7b[0x0][_0x447785(0x164)]==_0x447785(0x1e3))var _0x288a04=users[_0x447785(0x1e3)];else{if(_0x290d7b[0x0]['language']==_0x447785(0x1a9))var _0x288a04=users[_0x447785(0x14e)];else{if(_0x290d7b[0x0][_0x447785(0x164)]==_0x447785(0xfe))var _0x288a04=users[_0x447785(0xfe)];else{if(_0x290d7b[0x0][_0x447785(0x164)]==_0x447785(0xc0))var _0x288a04=users[_0x447785(0x155)];}}}}}}}const _0x4655b5=getRandom8DigitNumber();_0x4655b5[_0x447785(0x120)](_0x578ca9=>{var _0x2403e6=_0x447785;_0x2db7e5[_0x2403e6(0x15b)](_0x2403e6(0x13a),{'success':_0x59a1e2['flash']('success'),'errors':_0x59a1e2[_0x2403e6(0x125)](_0x2403e6(0x1a8)),'role':_0x25154d,'profile':_0x2e6c65,'customer':_0x3b8367,'warehouse':_0x32086,'product':_0x115647,'invoice':_0x578ca9,'master_shop':_0x290d7b,'language':_0x288a04,'rooms_data':_0x3c5af3});})[_0x447785(0xdf)](_0x3e4a0f=>{var _0x3bb473=_0x447785;_0x59a1e2[_0x3bb473(0x125)](_0x3bb473(0x1a8),_0x3bb473(0xe8)),_0x2db7e5[_0x3bb473(0xd2)](_0x3bb473(0x133));});}catch(_0x329c72){console[_0x447785(0xba)](_0x329c72);}}),router[a0_0x5dca55(0x184)](a0_0x5dca55(0x14b),auth,async(_0x45f209,_0x19730e)=>{var _0xe783fe=a0_0x5dca55;try{const {username:_0x58a336,email:_0xbd8a11,role:_0x43ea88}=_0x45f209[_0xe783fe(0x9d)],_0x3f2322=_0x45f209['user'],_0xe4ec01=await profile[_0xe783fe(0x15a)]({'email':_0x3f2322[_0xe783fe(0x1aa)]}),_0x5d7445=await master_shop[_0xe783fe(0x14c)](),_0x4b5f29=await customer['find']({});let _0x334aea;if(_0x3f2322[_0xe783fe(0x13c)]=='staff'){const _0x59bb9a=await staff[_0xe783fe(0x15a)]({'email':_0x3f2322[_0xe783fe(0x1aa)]});_0x334aea=await warehouse[_0xe783fe(0x11c)]([{'$match':{'status':_0xe783fe(0x18b),'name':_0x59bb9a[_0xe783fe(0xd8)]}},{'$group':{'_id':'$name','name':{'$first':_0xe783fe(0x1d6)}}},{'$sort':{'name':0x1}}]);}else _0x334aea=await warehouse[_0xe783fe(0x11c)]([{'$match':{'status':_0xe783fe(0x18b)}},{'$group':{'_id':_0xe783fe(0x1d6),'name':{'$first':_0xe783fe(0x1d6)}}},{'$sort':{'name':0x1}}]);const _0x267371=await product[_0xe783fe(0x14c)]({});var _0x172a2b=[_0xe783fe(0x12d),'Enclosed'];const _0x48db3c=await sales_finished[_0xe783fe(0x14c)]({}),_0x1961c3=_0x48db3c[_0xe783fe(0xd4)]+0x1,_0x29eccb=_0xe783fe(0x10a)+_0x1961c3[_0xe783fe(0x1cc)]()[_0xe783fe(0xd7)](0x5,'0');if(_0x5d7445[0x0][_0xe783fe(0x164)]==_0xe783fe(0x143)){var _0x201264=users[_0xe783fe(0x186)];console[_0xe783fe(0xba)](_0x201264);}else{if(_0x5d7445[0x0][_0xe783fe(0x164)]=='Hindi')var _0x201264=users[_0xe783fe(0xa5)];else{if(_0x5d7445[0x0][_0xe783fe(0x164)]==_0xe783fe(0xa3))var _0x201264=users[_0xe783fe(0xa3)];else{if(_0x5d7445[0x0][_0xe783fe(0x164)]=='Spanish')var _0x201264=users[_0xe783fe(0x1e4)];else{if(_0x5d7445[0x0][_0xe783fe(0x164)]==_0xe783fe(0x1e3))var _0x201264=users['French'];else{if(_0x5d7445[0x0][_0xe783fe(0x164)]=='Portuguese\x20(BR)')var _0x201264=users[_0xe783fe(0x14e)];else{if(_0x5d7445[0x0]['language']=='Chinese')var _0x201264=users[_0xe783fe(0xfe)];else{if(_0x5d7445[0x0][_0xe783fe(0x164)]==_0xe783fe(0xc0))var _0x201264=users[_0xe783fe(0x155)];}}}}}}}const _0x4d79b9=getRandom8DigitNumber();_0x4d79b9[_0xe783fe(0x120)](_0x24e4f1=>{var _0x4156d1=_0xe783fe;_0x19730e[_0x4156d1(0x15b)]('add_sales_finished_logs',{'success':_0x45f209[_0x4156d1(0x125)](_0x4156d1(0x158)),'errors':_0x45f209[_0x4156d1(0x125)](_0x4156d1(0x1a8)),'role':_0x3f2322,'profile':_0xe4ec01,'customer':_0x4b5f29,'warehouse':_0x334aea,'product':_0x267371,'invoice':_0x24e4f1,'master_shop':_0x5d7445,'language':_0x201264,'rooms_data':_0x172a2b});})[_0xe783fe(0xdf)](_0x418a3e=>{var _0x53ef86=_0xe783fe;_0x45f209['flash'](_0x53ef86(0x1a8),_0x53ef86(0xe8)),_0x19730e['redirect'](_0x53ef86(0x133));});}catch(_0x35d8c9){console[_0xe783fe(0xba)](_0x35d8c9);}}),router[a0_0x5dca55(0x165)]('/view/add_sales_logs',auth,async(_0x5a16fe,_0x55bc44)=>{var _0x33db9c=a0_0x5dca55;try{const {invoice:_0x4d1c66,date:_0x2d5085,warehouse_name:_0x249e1c,product_name:_0x5132ce,note:_0x264979,room:_0x3e882b,primary_code:_0x1d6160,secondary_code:_0x4b25dd,prod_code:_0x1b427a,SCRN:_0x52b4e4,ReqBy:_0xbc74fe,dateofreq:_0x49a245,PO_number:_0x35a020,typeservicesData:_0x113070,typevehicle:_0x43c855,destination:_0x3af601,deliverydate:_0x38c6e6,driver:_0x2a8c65,plate:_0x2d9ef7,van:_0x599027,DRSI:_0x4bad4c,TSU:_0x44f63e,TFU:_0x490a93,mode_transpo:_0x22d589,name_driver:_0x233f07,type_of_products:_0x330b01}=_0x5a16fe[_0x33db9c(0x15d)];if(typeof _0x5132ce==_0x33db9c(0x1d4))var _0x526c10=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1dd)]],_0x2984f1=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x182)]],_0x5e49cb=[_0x5a16fe[_0x33db9c(0x15d)]['carton']],_0x1f5ae7=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0xb1)]],_0x208b8b=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1da)]],_0x1a7efd=[_0x5a16fe['body'][_0x33db9c(0x13f)]],_0x598b7f=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x19c)]],_0x48c0e1=[_0x5a16fe['body'][_0x33db9c(0x183)]],_0x48b311=[_0x5a16fe['body'][_0x33db9c(0x150)]],_0x28e28f=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x16f)]],_0x3b8a57=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x14a)]],_0x14523f=[_0x5a16fe[_0x33db9c(0x15d)]['product_date']],_0x55ecfa=[_0x5a16fe['body'][_0x33db9c(0x115)]],_0x3bbc58=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0xd9)]],_0x1022e0=[_0x5a16fe['body'][_0x33db9c(0x107)]],_0x5009b2=[_0x5a16fe['body'][_0x33db9c(0x1a5)]],_0x4a20c0=[_0x5a16fe[_0x33db9c(0x15d)]['id_transaction_from']],_0x2b1adc=[_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x11d)]],_0x312173=[_0x5a16fe['body'][_0x33db9c(0xaa)]];else var _0x526c10=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1dd)]],_0x2984f1=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x182)]],_0x5e49cb=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1bb)]],_0x1f5ae7=[..._0x5a16fe['body'][_0x33db9c(0xb1)]],_0x208b8b=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1da)]],_0x1a7efd=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x13f)]],_0x598b7f=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x19c)]],_0x48c0e1=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x183)]],_0x48b311=[..._0x5a16fe[_0x33db9c(0x15d)]['secondary_unit']],_0x28e28f=[..._0x5a16fe['body']['batch_code']],_0x3b8a57=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x14a)]],_0x14523f=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x199)]],_0x55ecfa=[..._0x5a16fe[_0x33db9c(0x15d)]['max_per_unit']],_0x3bbc58=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0xd9)]],_0x1022e0=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x107)]],_0x5009b2=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1a5)]],_0x4a20c0=[..._0x5a16fe[_0x33db9c(0x15d)]['id_transaction_from']],_0x2b1adc=[..._0x5a16fe[_0x33db9c(0x15d)]['uuid']],_0x312173=[..._0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0xaa)]];const _0x19534c=_0x526c10[_0x33db9c(0xc9)](_0x53af69=>{return _0x53af69={'product_name':_0x53af69};});_0x2984f1['forEach']((_0x3de69f,_0x4a53a4)=>{var _0x2e2679=_0x33db9c;_0x19534c[_0x4a53a4][_0x2e2679(0x182)]=_0x3de69f;}),_0x5e49cb[_0x33db9c(0x1df)]((_0x23d7d7,_0x2e7395)=>{var _0x50495f=_0x33db9c;_0x19534c[_0x2e7395][_0x50495f(0x1d5)]=Math[_0x50495f(0x122)](_0x23d7d7);}),_0x526c10[_0x33db9c(0x1df)]((_0x1c18bb,_0x3e6548)=>{var _0x633d92=_0x33db9c;_0x19534c[_0x3e6548]['agent_id']=_0x5a16fe['body'][_0x633d92(0x1be)];}),_0x312173[_0x33db9c(0x1df)]((_0x4859df,_0x1808fa)=>{_0x19534c[_0x1808fa]['gross_price']=_0x4859df;}),_0x2b1adc[_0x33db9c(0x1df)]((_0x39ccb,_0x174609)=>{var _0x1ce587=_0x33db9c;_0x19534c[_0x174609][_0x1ce587(0x11d)]=_0x39ccb;}),_0x4a20c0['forEach']((_0x480eaa,_0x133b04)=>{var _0x377459=_0x33db9c;_0x19534c[_0x133b04][_0x377459(0x137)]=_0x480eaa;}),_0x1f5ae7[_0x33db9c(0x1df)]((_0x104b4c,_0x195177)=>{var _0x33daae=_0x33db9c;_0x19534c[_0x195177][_0x33daae(0xb1)]=_0x104b4c;}),_0x208b8b['forEach']((_0x121d5c,_0x23af2b)=>{_0x19534c[_0x23af2b]['secondary_code']=_0x121d5c;}),_0x1a7efd[_0x33db9c(0x1df)]((_0x574a9a,_0x287e45)=>{_0x19534c[_0x287e45]['product_code']=_0x574a9a;}),_0x598b7f[_0x33db9c(0x1df)]((_0x4266e2,_0x1ba7cb)=>{var _0x384d1e=_0x33db9c,_0x6bf585=_0x4266e2['match'](/[A-Za-z]+/)[0x0],_0x3e5d0c=parseInt(_0x4266e2['match'](/\d+/)[0x0]);_0x19534c[_0x1ba7cb]['bay']=_0x3e5d0c,_0x19534c[_0x1ba7cb][_0x384d1e(0x1ab)]=_0x6bf585;}),_0x48c0e1[_0x33db9c(0x1df)]((_0x14da24,_0x3132b8)=>{_0x19534c[_0x3132b8]['unit']=_0x14da24;}),_0x48b311[_0x33db9c(0x1df)]((_0x198077,_0x470773)=>{var _0x11f9cb=_0x33db9c;_0x19534c[_0x470773][_0x11f9cb(0x150)]=_0x198077;}),_0x28e28f[_0x33db9c(0x1df)]((_0x1f251b,_0x424cce)=>{var _0x1914eb=_0x33db9c;_0x19534c[_0x424cce][_0x1914eb(0x16f)]=_0x1f251b;}),_0x3b8a57[_0x33db9c(0x1df)]((_0x5d8894,_0x337de4)=>{var _0x3af2e6=_0x33db9c;_0x19534c[_0x337de4][_0x3af2e6(0x14a)]=_0x5d8894;}),_0x14523f[_0x33db9c(0x1df)]((_0x412212,_0x49c913)=>{var _0xc83db7=_0x33db9c;_0x19534c[_0x49c913][_0xc83db7(0x1bf)]=_0x412212;}),_0x55ecfa[_0x33db9c(0x1df)]((_0xf79d6a,_0xeac464)=>{var _0x4e877d=_0x33db9c;_0x19534c[_0xeac464][_0x4e877d(0x151)]=_0xf79d6a;}),_0x3bbc58['forEach']((_0x46f6ec,_0x29ab4f)=>{_0x19534c[_0x29ab4f]['prod_cat']=_0x46f6ec;}),_0x1022e0[_0x33db9c(0x1df)]((_0x5088f6,_0x539fcb)=>{var _0x3732a2=_0x33db9c;_0x19534c[_0x539fcb][_0x3732a2(0xd6)]=_0x5088f6;}),_0x5009b2['forEach']((_0x5a1a9e,_0x1a29cb)=>{var _0x4d3f6b=_0x33db9c;_0x19534c[_0x1a29cb][_0x4d3f6b(0x12b)]=_0x5a1a9e,_0x19534c[_0x1a29cb]['date_data']=_0x2d5085;});const _0x1fce61=new sales_logs();await _0x1fce61[_0x33db9c(0x19f)](),_0x5009b2['forEach']((_0x515b8a,_0x2ec270)=>{var _0x41a72c=_0x33db9c;_0x19534c[_0x2ec270][_0x41a72c(0x18e)]=_0x41a72c(0x1a4)+_0x1fce61[_0x41a72c(0x1b9)]['toString']()[_0x41a72c(0xd7)](0x8,'0');});var _0x28d818=0x0;_0x19534c[_0x33db9c(0x1df)](_0x35688c=>{var _0xad14d0=_0x33db9c;parseFloat(_0x35688c[_0xad14d0(0x182)])<parseFloat(_0x35688c[_0xad14d0(0x1d5)])&&parseFloat(_0x35688c[_0xad14d0(0x1d5)])>parseFloat(_0x35688c[_0xad14d0(0x182)])&&(console[_0xad14d0(0xba)](_0x35688c[_0xad14d0(0x182)]+'\x20<>\x20'+_0x35688c['quantity']),_0x28d818++);});if(_0x28d818!=0x0)return _0x5a16fe['flash'](_0x33db9c(0x1a8),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x55bc44['redirect']('back');const _0x5bcfc4=_0x19534c[_0x33db9c(0x117)](_0x35e043=>_0x35e043[_0x33db9c(0x1d5)]!=='0'&&_0x35e043[_0x33db9c(0x1d5)]!==''),_0x345023=new sales_finished({'invoice':_0x33db9c(0x1a4)+_0x1fce61[_0x33db9c(0x1b9)][_0x33db9c(0x1cc)]()['padStart'](0x8,'0'),'sales_data':_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x1be)],'customer':_0x5a16fe[_0x33db9c(0x15d)][_0x33db9c(0x16e)],'date':_0x2d5085,'warehouse_name':_0x249e1c,'sale_product':_0x5bcfc4,'note':_0x264979,'room':_0x3e882b,'primary_code':_0x1d6160,'secondary_code':_0x4b25dd,'prod_code':_0x1b427a,'SCRN':_0x52b4e4,'finalize':'False','mode_transpo':_0x22d589,'name_driver':_0x233f07,'ReqBy':_0xbc74fe,'dateofreq':_0x49a245,'PO_number':_0x35a020,'typeservicesData':_0x113070,'typevehicle':_0x43c855,'destination':_0x3af601,'deliverydate':_0x38c6e6,'driver':_0x2a8c65,'plate':_0x2d9ef7,'van':_0x599027,'DRSI':_0x4bad4c,'TSU':_0x44f63e,'TFU':_0x490a93,'typeOfProducts':_0x330b01}),_0x5276d6=await _0x345023[_0x33db9c(0x19f)](),_0x3b062f=await sales_finished[_0x33db9c(0x15a)]({'invoice':_0x4d1c66});_0x5a16fe[_0x33db9c(0x125)](_0x33db9c(0x158),_0x33db9c(0x180)),_0x55bc44[_0x33db9c(0xd2)](_0x33db9c(0x141)+_0x5276d6[_0x33db9c(0x181)]);}catch(_0x1edffc){console[_0x33db9c(0xba)](_0x1edffc);}}),router[a0_0x5dca55(0x184)]('/view/add_sales/:id',auth,async(_0x2a39b9,_0x31bd1a)=>{var _0x2f3a9f=a0_0x5dca55;try{const _0x95776c=_0x2a39b9[_0x2f3a9f(0x176)]['id'];console[_0x2f3a9f(0xba)](_0x95776c);const _0x2696cd=await product[_0x2f3a9f(0x14c)](),_0x1758f4=await purchases[_0x2f3a9f(0x11c)]([{'$match':{'warehouse_name':_0x95776c}},{'$unwind':_0x2f3a9f(0x123)},{'$group':{'_id':_0x2f3a9f(0x1a2)}}]);console[_0x2f3a9f(0xba)](_0x2f3a9f(0xb8),_0x1758f4),_0x31bd1a[_0x2f3a9f(0x1b3)](0xc8)['json']({'purchases_data':_0x1758f4,'product_data':_0x2696cd});}catch(_0x3208fb){console[_0x2f3a9f(0xba)](_0x3208fb);}}),router[a0_0x5dca55(0x165)](a0_0x5dca55(0x154),auth,async(_0x399792,_0x45d0c2)=>{var _0x438fb5=a0_0x5dca55;try{const {warehouse_data:_0x2e8083,product_data:_0x5b8fe5}=_0x399792[_0x438fb5(0x15d)];console[_0x438fb5(0xba)](_0x399792[_0x438fb5(0x15d)][_0x438fb5(0x101)]);;const _0x3de72f=await master_shop[_0x438fb5(0x14c)]();console[_0x438fb5(0xba)](_0x438fb5(0x194),_0x3de72f);const _0x4b77fa=await product[_0x438fb5(0x15a)]({'name':_0x5b8fe5});console['log'](_0x438fb5(0x18c),_0x4b77fa);const _0x4e0d35=await warehouse[_0x438fb5(0x11c)]([{'$match':{'name':_0x2e8083}},{'$unwind':_0x438fb5(0x187)},{'$match':{'product_details.product_name':_0x5b8fe5}},{'$group':{'_id':_0x438fb5(0x190),'product_stock':{'$first':_0x438fb5(0x172)}}}]);console[_0x438fb5(0xba)](_0x438fb5(0x124),_0x4e0d35),_0x45d0c2[_0x438fb5(0x1b3)](0xc8)['json']({'master':_0x3de72f,'new_product':_0x4b77fa,'stock_data':_0x4e0d35});}catch(_0x8fad9b){console[_0x438fb5(0xba)](_0x8fad9b);}}),router['post'](a0_0x5dca55(0xa2),auth,async(_0x4c1754,_0x583b40)=>{var _0x4b1e6d=a0_0x5dca55;try{const {invoice:_0x43757a,date:_0x3e7a5e,warehouse_name:_0x478ad5,product_name:_0x2f8a4c,note:_0x63733a,room:_0xeac5bb,primary_code:_0x5f4c02,secondary_code:_0xacf08d,prod_code:_0x5e759d,SCRN:_0x52002d,ReqBy:_0x2cb5a1,dateofreq:_0x7e0ac9,PO_number:_0x552bc0,typeservicesData:_0x32c99f,typevehicle:_0x261b76,destination:_0x1742d2,deliverydate:_0x457676,driver:_0x28ce7e,plate:_0x213416,van:_0x51ffe3,DRSI:_0x516a45,TSU:_0x31482f,TFU:_0x2d5a08,mode_transpo:_0x385be6,name_driver:_0x4e1d68,pull_out_date:_0x433d9b,actual_delivery_date:_0x48361a}=_0x4c1754[_0x4b1e6d(0x15d)];_0x583b40['json'](_0x4c1754[_0x4b1e6d(0x15d)]);return;if(typeof _0x2f8a4c==_0x4b1e6d(0x1d4))var _0x5565ed=[_0x4c1754[_0x4b1e6d(0x15d)]['product_name']],_0x4276af=[_0x4c1754[_0x4b1e6d(0x15d)]['stock']],_0x9b0781=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x1bb)]],_0x286d64=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0xb1)]],_0x18e931=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x1da)]],_0x582b28=[_0x4c1754['body'][_0x4b1e6d(0x13f)]],_0x52adb0=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x19c)]],_0x41ea8e=[_0x4c1754['body']['primary_unit']],_0x106d47=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x150)]],_0x5e564b=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x16f)]],_0x1fd3f5=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x14a)]],_0x3ddd0c=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x199)]],_0x11c7a7=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x115)]],_0x838713=[_0x4c1754['body'][_0x4b1e6d(0xd9)]],_0x48d8d8=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x107)]],_0xbda024=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x1a5)]],_0x897ef8=[_0x4c1754['body'][_0x4b1e6d(0x137)]],_0x118a2d=[_0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x11d)]],_0x25b2ed=[_0x4c1754['body'][_0x4b1e6d(0xaa)]];else var _0x5565ed=[..._0x4c1754[_0x4b1e6d(0x15d)]['product_name']],_0x4276af=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x182)]],_0x9b0781=[..._0x4c1754['body'][_0x4b1e6d(0x1bb)]],_0x286d64=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0xb1)]],_0x18e931=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x1da)]],_0x582b28=[..._0x4c1754['body'][_0x4b1e6d(0x13f)]],_0x52adb0=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x19c)]],_0x41ea8e=[..._0x4c1754[_0x4b1e6d(0x15d)]['primary_unit']],_0x106d47=[..._0x4c1754['body']['secondary_unit']],_0x5e564b=[..._0x4c1754['body'][_0x4b1e6d(0x16f)]],_0x1fd3f5=[..._0x4c1754[_0x4b1e6d(0x15d)]['expiry_date']],_0x3ddd0c=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x199)]],_0x11c7a7=[..._0x4c1754['body'][_0x4b1e6d(0x115)]],_0x838713=[..._0x4c1754[_0x4b1e6d(0x15d)]['prod_cat']],_0x48d8d8=[..._0x4c1754['body']['RoomAssigned']],_0xbda024=[..._0x4c1754[_0x4b1e6d(0x15d)]['prod_invoice']],_0x897ef8=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x137)]],_0x118a2d=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0x11d)]],_0x25b2ed=[..._0x4c1754[_0x4b1e6d(0x15d)][_0x4b1e6d(0xaa)]];const _0x54157d=_0x5565ed[_0x4b1e6d(0xc9)](_0x4bd2c7=>{return _0x4bd2c7={'product_name':_0x4bd2c7};});_0x4276af[_0x4b1e6d(0x1df)]((_0x447949,_0x3036ec)=>{var _0x2e2386=_0x4b1e6d;_0x54157d[_0x3036ec][_0x2e2386(0x182)]=_0x447949;}),_0x9b0781['forEach']((_0x4b5aee,_0x1f0762)=>{var _0x507fd1=_0x4b1e6d;_0x54157d[_0x1f0762]['quantity']=Math[_0x507fd1(0x122)](_0x4b5aee);}),_0x5565ed['forEach']((_0xf63450,_0x47d95f)=>{var _0xdd8352=_0x4b1e6d;_0x54157d[_0x47d95f][_0xdd8352(0x16c)]=_0x4c1754['body'][_0xdd8352(0x1be)];}),_0x25b2ed[_0x4b1e6d(0x1df)]((_0x3d6520,_0x43c92a)=>{var _0x359a64=_0x4b1e6d;_0x54157d[_0x43c92a][_0x359a64(0xaa)]=_0x3d6520;}),_0x118a2d[_0x4b1e6d(0x1df)]((_0x4ffe07,_0x49df6d)=>{var _0x116be5=_0x4b1e6d;_0x54157d[_0x49df6d][_0x116be5(0x11d)]=_0x4ffe07;}),_0x897ef8[_0x4b1e6d(0x1df)]((_0x2f4b2e,_0x27422f)=>{_0x54157d[_0x27422f]['id_transaction_from']=_0x2f4b2e;}),_0x286d64['forEach']((_0x5c5ba2,_0x552d66)=>{var _0x10039a=_0x4b1e6d;_0x54157d[_0x552d66][_0x10039a(0xb1)]=_0x5c5ba2;}),_0x18e931[_0x4b1e6d(0x1df)]((_0x228dc7,_0x3d6621)=>{_0x54157d[_0x3d6621]['secondary_code']=_0x228dc7;}),_0x582b28['forEach']((_0x2fb60e,_0xc929df)=>{var _0x2ff99f=_0x4b1e6d;_0x54157d[_0xc929df][_0x2ff99f(0x1ca)]=_0x2fb60e;}),_0x52adb0[_0x4b1e6d(0x1df)]((_0x295218,_0x50e1b7)=>{var _0x3ac72c=_0x4b1e6d,_0x215d5c=_0x295218['match'](/[A-Za-z]+/)[0x0],_0x36e6e4=parseInt(_0x295218['match'](/\d+/)[0x0]);_0x54157d[_0x50e1b7][_0x3ac72c(0x106)]=_0x36e6e4,_0x54157d[_0x50e1b7][_0x3ac72c(0x1ab)]=_0x215d5c;}),_0x41ea8e[_0x4b1e6d(0x1df)]((_0x224eb6,_0xfbe700)=>{var _0x3a94e3=_0x4b1e6d;_0x54157d[_0xfbe700][_0x3a94e3(0x197)]=_0x224eb6;}),_0x106d47['forEach']((_0x206d62,_0x101311)=>{var _0x3d6d93=_0x4b1e6d;_0x54157d[_0x101311][_0x3d6d93(0x150)]=_0x206d62;}),_0x5e564b[_0x4b1e6d(0x1df)]((_0x369d32,_0x10e132)=>{var _0x458b89=_0x4b1e6d;_0x54157d[_0x10e132][_0x458b89(0x16f)]=_0x369d32;}),_0x1fd3f5[_0x4b1e6d(0x1df)]((_0x235725,_0x2c3238)=>{var _0x76c836=_0x4b1e6d;_0x54157d[_0x2c3238][_0x76c836(0x14a)]=_0x235725;}),_0x3ddd0c[_0x4b1e6d(0x1df)]((_0x5516e5,_0x1b785b)=>{var _0x37f014=_0x4b1e6d;_0x54157d[_0x1b785b][_0x37f014(0x1bf)]=_0x5516e5;}),_0x11c7a7[_0x4b1e6d(0x1df)]((_0x4e36aa,_0x137df9)=>{var _0x1def10=_0x4b1e6d;_0x54157d[_0x137df9][_0x1def10(0x151)]=_0x4e36aa;}),_0x838713[_0x4b1e6d(0x1df)]((_0x7bf84e,_0x2cff47)=>{var _0x1dcf89=_0x4b1e6d;_0x54157d[_0x2cff47][_0x1dcf89(0xd9)]=_0x7bf84e;}),_0x48d8d8[_0x4b1e6d(0x1df)]((_0x1ac644,_0x13899d)=>{var _0x2a0d32=_0x4b1e6d;_0x54157d[_0x13899d][_0x2a0d32(0xd6)]=_0x1ac644;}),_0xbda024[_0x4b1e6d(0x1df)]((_0x165c71,_0x3e2cb0)=>{var _0x2107c0=_0x4b1e6d;_0x54157d[_0x3e2cb0][_0x2107c0(0x12b)]=_0x165c71,_0x54157d[_0x3e2cb0]['date_data']=_0x3e7a5e;});const _0x1ec927=new invoice_for_outgoing();await _0x1ec927[_0x4b1e6d(0x19f)](),_0xbda024[_0x4b1e6d(0x1df)]((_0x1a75a3,_0x49e866)=>{var _0x255cda=_0x4b1e6d;_0x54157d[_0x49e866][_0x255cda(0x18e)]=_0x255cda(0x142)+_0x1ec927[_0x255cda(0x1b9)][_0x255cda(0x1cc)]()[_0x255cda(0xd7)](0x8,'0');});var _0xf78928=0x0;_0x54157d[_0x4b1e6d(0x1df)](_0x32b23d=>{var _0xea49b0=_0x4b1e6d;parseFloat(_0x32b23d[_0xea49b0(0x182)])<parseFloat(_0x32b23d[_0xea49b0(0x1d5)])&&parseFloat(_0x32b23d[_0xea49b0(0x1d5)])>parseFloat(_0x32b23d[_0xea49b0(0x182)])&&(console[_0xea49b0(0xba)](_0x32b23d[_0xea49b0(0x182)]+_0xea49b0(0x10f)+_0x32b23d['quantity']),_0xf78928++);});if(_0xf78928!=0x0)return _0x4c1754[_0x4b1e6d(0x125)](_0x4b1e6d(0x1a8),_0x4b1e6d(0x130)),_0x583b40[_0x4b1e6d(0xd2)]('back');const _0x30ca16=_0x54157d[_0x4b1e6d(0x117)](_0x3fb482=>_0x3fb482[_0x4b1e6d(0x1d5)]!=='0'&&_0x3fb482[_0x4b1e6d(0x1d5)]!==''),_0x5518d7=new sales_finished({'invoice':_0x4b1e6d(0x142)+_0x1ec927['invoice_init'][_0x4b1e6d(0x1cc)]()[_0x4b1e6d(0xd7)](0x8,'0'),'sales_data':_0x4c1754[_0x4b1e6d(0x15d)]['sales'],'customer':_0x4c1754[_0x4b1e6d(0x15d)]['customer'],'date':_0x3e7a5e,'warehouse_name':_0x478ad5,'sale_product':_0x30ca16,'note':_0x63733a,'room':_0xeac5bb,'primary_code':_0x5f4c02,'secondary_code':_0xacf08d,'prod_code':_0x5e759d,'SCRN':_0x52002d,'finalize':_0x4b1e6d(0x113),'mode_transpo':_0x385be6,'name_driver':_0x4e1d68,'ReqBy':_0x2cb5a1,'dateofreq':_0x7e0ac9,'PO_number':_0x552bc0,'typeservicesData':_0x32c99f,'typevehicle':_0x261b76,'destination':_0x1742d2,'deliverydate':_0x457676,'driver':_0x28ce7e,'plate':_0x213416,'van':_0x51ffe3,'DRSI':_0x516a45,'TSU':_0x31482f,'TFU':_0x2d5a08,'pullout_date':_0x433d9b,'actualdelivery_date':_0x48361a,'typeOfProducts':_0x4b1e6d(0xe6)}),_0xfcc77b=await _0x5518d7[_0x4b1e6d(0x19f)](),_0x3fdf08=await sales_finished[_0x4b1e6d(0x15a)]({'invoice':_0x43757a});_0x4c1754['flash'](_0x4b1e6d(0x158),'Sales\x20Add\x20successfully'),_0x583b40[_0x4b1e6d(0xd2)](_0x4b1e6d(0x141)+_0xfcc77b[_0x4b1e6d(0x181)]);}catch(_0x4f3558){console[_0x4b1e6d(0xba)](_0x4f3558);}}),router[a0_0x5dca55(0x184)]('/preview/:id',auth,async(_0x1f4e38,_0x3eadce)=>{var _0x84820a=a0_0x5dca55;try{const {username:_0x334a5d,email:_0x48c0ff,role:_0xb7c1ca}=_0x1f4e38[_0x84820a(0x9d)],_0x4e5410=_0x1f4e38[_0x84820a(0x9d)],_0x5ee33f=await profile[_0x84820a(0x15a)]({'email':_0x4e5410[_0x84820a(0x1aa)]}),_0x37de70=await master_shop[_0x84820a(0x14c)](),_0x1b0b15=_0x1f4e38[_0x84820a(0x176)]['id'],_0x33e217=await sales_finished[_0x84820a(0x168)](_0x1b0b15),_0x5e32fa=await warehouse[_0x84820a(0x11c)]([{'$match':{'name':_0x33e217[_0x84820a(0x1a0)]}},{'$unwind':_0x84820a(0x187)},{'$group':{'_id':_0x84820a(0xe0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x84820a(0xa4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x84820a(0xe5)},'primary_code':{'$first':_0x84820a(0xe4)},'secondary_code':{'$first':_0x84820a(0xdb)},'product_code':{'$first':_0x84820a(0x18d)},'storage':{'$first':_0x84820a(0x146)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x84820a(0xf7)},'production_date':{'$first':_0x84820a(0xa0)},'batch_code':{'$first':_0x84820a(0x145)},'room':{'$first':_0x84820a(0x126)},'room_data':{'$first':_0x84820a(0x10b)}}}]),_0x539544=await customer['find']({});let _0x18a9de;if(_0x4e5410['role']==_0x84820a(0x1b7)){const _0x2f83e7=await staff[_0x84820a(0x15a)]({'email':_0x4e5410[_0x84820a(0x1aa)]});_0x18a9de=await warehouse[_0x84820a(0x11c)]([{'$match':{'status':'Enabled','name':_0x2f83e7[_0x84820a(0xd8)]}},{'$group':{'_id':_0x84820a(0x1d6),'name':{'$first':_0x84820a(0x1d6)}}}]);}else _0x18a9de=await warehouse[_0x84820a(0x11c)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x84820a(0x1d6),'name':{'$first':_0x84820a(0x1d6)}}}]);const _0xbc8395=await product[_0x84820a(0x14c)]({});if(_0x37de70[0x0]['language']=='English\x20(US)'){var _0x1ef0af=users[_0x84820a(0x186)];console[_0x84820a(0xba)](_0x1ef0af);}else{if(_0x37de70[0x0]['language']=='Hindi')var _0x1ef0af=users['Hindi'];else{if(_0x37de70[0x0][_0x84820a(0x164)]=='German')var _0x1ef0af=users[_0x84820a(0xa3)];else{if(_0x37de70[0x0][_0x84820a(0x164)]==_0x84820a(0x1e4))var _0x1ef0af=users[_0x84820a(0x1e4)];else{if(_0x37de70[0x0][_0x84820a(0x164)]==_0x84820a(0x1e3))var _0x1ef0af=users[_0x84820a(0x1e3)];else{if(_0x37de70[0x0][_0x84820a(0x164)]==_0x84820a(0x1a9))var _0x1ef0af=users['Portuguese'];else{if(_0x37de70[0x0]['language']=='Chinese')var _0x1ef0af=users[_0x84820a(0xfe)];else{if(_0x37de70[0x0][_0x84820a(0x164)]=='Arabic\x20(ae)')var _0x1ef0af=users[_0x84820a(0x155)];}}}}}}}_0x3eadce[_0x84820a(0x15b)](_0x84820a(0xa9),{'success':_0x1f4e38[_0x84820a(0x125)](_0x84820a(0x158)),'errors':_0x1f4e38[_0x84820a(0x125)]('errors'),'role':_0x4e5410,'profile':_0x5ee33f,'customer':_0x539544,'warehouse':_0x18a9de,'product':_0x5e32fa,'user':_0x33e217,'master_shop':_0x37de70,'unit':_0xbc8395,'language':_0x1ef0af});}catch(_0x953787){console[_0x84820a(0xba)](_0x953787);}});async function dataUpdate(_0x1ca012,_0x337ba9,_0x505d39){var _0x292145=a0_0x5dca55;return await warehouse[_0x292145(0xc4)]({'_id':_0x1ca012,'product_details._id':_0x337ba9},{'$set':{'product_details.$.product_stock':_0x505d39}}),await warehouse[_0x292145(0x168)](_0x1ca012);}router[a0_0x5dca55(0x165)](a0_0x5dca55(0xde),auth,async(_0xf67697,_0x170110)=>{var _0x435717=a0_0x5dca55;try{const _0x3f75dd=_0xf67697[_0x435717(0x176)]['id'],{invoice:_0x2c6f6c,warehouse_name:_0x1bbe57,room:_0x2ca5df}=_0xf67697[_0x435717(0x15d)],_0xd6b7c5=await sales_finished[_0x435717(0x15a)]({'invoice':_0x2c6f6c});for(let _0x2fed11=0x0;_0x2fed11<=_0xd6b7c5['sale_product'][_0x435717(0xd4)]-0x1;_0x2fed11++){const _0x4e778d=_0xd6b7c5[_0x435717(0x14d)][_0x2fed11];var _0x42fdd6=await warehouse[_0x435717(0x15a)]({'name':_0x1bbe57,'room':_0x4e778d[_0x435717(0xd6)]}),_0x5a72e7=0x0;for(let _0x39993d=0x0;_0x39993d<=_0x42fdd6[_0x435717(0x171)][_0x435717(0xd4)]-0x1;_0x39993d++){const _0x71de1d=_0x42fdd6[_0x435717(0x171)][_0x39993d];_0x71de1d[_0x435717(0x181)]==_0x4e778d[_0x435717(0x137)]&&_0x71de1d[_0x435717(0x11d)]==_0x4e778d['uuid']&&(_0x5a72e7=Math[_0x435717(0x1af)](0x0,Math[_0x435717(0x122)](_0x71de1d[_0x435717(0x105)])-Math['abs'](_0x4e778d[_0x435717(0x1d5)])),await warehouse['updateOne']({'_id':_0x42fdd6[_0x435717(0x181)][_0x435717(0x160)](),'product_details._id':_0x71de1d[_0x435717(0x181)][_0x435717(0x160)](),'product_details.uuid':_0x4e778d[_0x435717(0x11d)]},{'$set':{'product_details.$.product_stock':_0x5a72e7}}));}console[_0x435717(0xba)](typeof _0x4e778d[_0x435717(0x16c)]);if(typeof _0x4e778d['agent_id']!==_0x435717(0xb5)){var _0x3a9de2=await staff[_0x435717(0x168)](_0x4e778d[_0x435717(0x16c)]);console[_0x435717(0xba)](_0x435717(0x1d0));var _0x5f0626=0x0;for(let _0x1465d1=0x0;_0x1465d1<=_0x3a9de2[_0x435717(0x109)][_0x435717(0xd4)]-0x1;_0x1465d1++){const _0x8946bf=_0x3a9de2[_0x435717(0x109)][_0x1465d1];console['log'](_0x4e778d[_0x435717(0x137)]+_0x435717(0xd5)+_0x8946bf[_0x435717(0xd3)]+_0x435717(0x193)+_0x4e778d[_0x435717(0x181)]+_0x435717(0xd5)+_0x4e778d[_0x435717(0x181)]),_0x4e778d[_0x435717(0x137)]==_0x8946bf[_0x435717(0xd3)]&&_0x4e778d[_0x435717(0x181)]==0x1&&(_0x8946bf[_0x435717(0x105)]=Math[_0x435717(0x122)](_0x8946bf['product_stock'])+Math[_0x435717(0x122)](_0x4e778d['quantity']),_0x5f0626++);}console['log'](_0x435717(0x157),_0x5f0626),_0x5f0626=='0'&&(_0x3a9de2[_0x435717(0x109)]=_0x3a9de2[_0x435717(0x109)][_0x435717(0x174)]({'product_name':_0x4e778d[_0x435717(0x1dd)],'product_stock':_0x4e778d[_0x435717(0x1d5)],'bay':_0x4e778d[_0x435717(0x106)],'level':_0x4e778d[_0x435717(0x1ab)],'product_code':_0x4e778d[_0x435717(0x1ca)],'primary_code':_0x4e778d[_0x435717(0xb1)],'secondary_code':_0x4e778d[_0x435717(0x1da)],'expiry_date':_0x4e778d[_0x435717(0x14a)],'production_date':_0x4e778d['production_date'],'maxProducts':_0x4e778d['maxProducts'],'batch_code':_0x4e778d[_0x435717(0x16f)],'secondary_unit':_0x4e778d[_0x435717(0x150)],'unit':_0x4e778d[_0x435717(0x197)],'maxProducts':_0x4e778d['maxProducts'],'maxPerUnit':_0x4e778d['maxperunit'],'invoice':_0x4e778d[_0x435717(0x12b)],'warehouse_id':_0x4e778d[_0x435717(0x137)],'id_incoming':_0x4e778d[_0x435717(0x181)],'uuid':_0x4e778d['uuid'],'gross_price':_0x4e778d[_0x435717(0xaa)],'date_incoming':_0x4e778d[_0x435717(0x1c0)],'outgoing_invoice':_0x4e778d[_0x435717(0x18e)]}),await _0x3a9de2[_0x435717(0x19f)]());}}_0xd6b7c5['finalize']=_0x435717(0x1bd);const _0x3297c6=await _0xd6b7c5[_0x435717(0x19f)](),_0x137a51=await master_shop[_0x435717(0x14c)](),_0x3f5332=await email_settings[_0x435717(0x15a)](),_0x457a3e=await supervisor_settings['find']();var _0x358cc2=_0xd6b7c5['sale_product'],_0x2b35fe='',_0x1994fc;for(_0x1994fc in _0x358cc2){_0x2b35fe+='<tr>'+_0x435717(0x1b0)+_0x358cc2[_0x1994fc][_0x435717(0x1dd)]+'</td>'+_0x435717(0x1b0)+_0x358cc2[_0x1994fc][_0x435717(0x1ca)]+_0x435717(0xee)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x358cc2[_0x1994fc][_0x435717(0x1d5)]+'</td>'+_0x435717(0x1b0)+_0x358cc2[_0x1994fc][_0x435717(0x197)]+_0x435717(0xee)+_0x435717(0x1b0)+_0x358cc2[_0x1994fc][_0x435717(0x150)]+_0x435717(0xee)+_0x435717(0x1b0)+_0xd6b7c5[_0x435717(0x1a0)]+'</td>'+_0x435717(0x1b0)+_0x358cc2[_0x1994fc][_0x435717(0xd6)]+_0x435717(0xee)+_0x435717(0x1b0)+_0x358cc2[_0x1994fc][_0x435717(0x106)]+_0x435717(0xee);}_0xf67697[_0x435717(0x125)](_0x435717(0x158),_0x435717(0x17b)),_0x170110[_0x435717(0xd2)](_0x435717(0x1e7)+_0x3f75dd);}catch(_0x390ae0){console[_0x435717(0xba)](_0x390ae0);}}),router[a0_0x5dca55(0x184)](a0_0x5dca55(0x10e),auth,async(_0x3eefbb,_0x38c02c)=>{var _0x4b1b75=a0_0x5dca55;try{const {username:_0x389b0c,email:_0x2e6ac7,role:_0xa05ee2}=_0x3eefbb[_0x4b1b75(0x9d)],_0x3a1571=_0x3eefbb['user'],_0x11c1cd=await profile[_0x4b1b75(0x15a)]({'email':_0x3a1571['email']}),_0x58bd2a=await master_shop['find'](),_0x1d1a17=_0x3eefbb[_0x4b1b75(0x176)]['id'],_0xc7c137=await sales_finished[_0x4b1b75(0x168)](_0x1d1a17);let _0x121ef2=new Date(_0xc7c137['expiry_date']),_0x200ae8=('0'+_0x121ef2[_0x4b1b75(0x1c2)]())[_0x4b1b75(0xe7)](-0x2),_0x23a3a5=('0'+(_0x121ef2[_0x4b1b75(0x1b6)]()+0x1))['slice'](-0x2),_0x5f4087=_0x121ef2['getFullYear'](),_0x307581=_0x5f4087+'-'+_0x23a3a5+'-'+_0x200ae8;var _0x27ddb6=['Ambient',_0x4b1b75(0x12f)];const _0x3f6d93=await warehouse[_0x4b1b75(0x11c)]([{'$match':{'name':_0xc7c137[_0x4b1b75(0x1a0)],'room':_0xc7c137[_0x4b1b75(0x9e)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4b1b75(0xe0),'name':{'$first':_0x4b1b75(0x190)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4b1b75(0xa4)},'bin':{'$first':_0x4b1b75(0x1ce)},'type':{'$first':_0x4b1b75(0xf1)},'floorlevel':{'$first':_0x4b1b75(0xe5)},'primary_code':{'$first':_0x4b1b75(0xe4)},'secondary_code':{'$first':_0x4b1b75(0xdb)},'product_code':{'$first':_0x4b1b75(0x18d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4b1b75(0x127)}}}]),_0xf8135f=await customer[_0x4b1b75(0x14c)]({});let _0x4acf10;if(_0x3a1571[_0x4b1b75(0x13c)]==_0x4b1b75(0x1b7)){const _0x2ef3ea=await staff['findOne']({'email':_0x3a1571[_0x4b1b75(0x1aa)]});_0x4acf10=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2ef3ea[_0x4b1b75(0xd8)]}},{'$group':{'_id':_0x4b1b75(0x1d6),'name':{'$first':'$name'}}}]);}else _0x4acf10=await warehouse[_0x4b1b75(0x11c)]([{'$match':{'status':_0x4b1b75(0x18b)}},{'$group':{'_id':_0x4b1b75(0x1d6),'name':{'$first':_0x4b1b75(0x1d6)}}}]);const _0x4a3c32=await product['find']({});if(_0x58bd2a[0x0]['language']==_0x4b1b75(0x143)){var _0x21f8fb=users[_0x4b1b75(0x186)];console[_0x4b1b75(0xba)](_0x21f8fb);}else{if(_0x58bd2a[0x0]['language']=='Hindi')var _0x21f8fb=users['Hindi'];else{if(_0x58bd2a[0x0][_0x4b1b75(0x164)]=='German')var _0x21f8fb=users[_0x4b1b75(0xa3)];else{if(_0x58bd2a[0x0][_0x4b1b75(0x164)]==_0x4b1b75(0x1e4))var _0x21f8fb=users[_0x4b1b75(0x1e4)];else{if(_0x58bd2a[0x0][_0x4b1b75(0x164)]=='French')var _0x21f8fb=users[_0x4b1b75(0x1e3)];else{if(_0x58bd2a[0x0]['language']==_0x4b1b75(0x1a9))var _0x21f8fb=users[_0x4b1b75(0x14e)];else{if(_0x58bd2a[0x0][_0x4b1b75(0x164)]==_0x4b1b75(0xfe))var _0x21f8fb=users[_0x4b1b75(0xfe)];else{if(_0x58bd2a[0x0]['language']==_0x4b1b75(0xc0))var _0x21f8fb=users[_0x4b1b75(0x155)];}}}}}}}_0x38c02c[_0x4b1b75(0x15b)](_0x4b1b75(0xab),{'success':_0x3eefbb[_0x4b1b75(0x125)](_0x4b1b75(0x158)),'errors':_0x3eefbb[_0x4b1b75(0x125)](_0x4b1b75(0x1a8)),'role':_0x3a1571,'profile':_0x11c1cd,'customer':_0xf8135f,'warehouse':_0x4acf10,'product':_0x3f6d93,'user':_0xc7c137,'master_shop':_0x58bd2a,'unit':_0x4a3c32,'language':_0x21f8fb,'rooms_data':_0x27ddb6,'ed_fullDate':_0x307581});}catch(_0x23e611){console['log'](_0x23e611);}}),router[a0_0x5dca55(0x165)](a0_0x5dca55(0x10e),auth,async(_0x565a3d,_0x4cbef0)=>{var _0x5b0705=a0_0x5dca55;try{const _0x2d1c2a=_0x565a3d[_0x5b0705(0x176)]['id'],_0x247f21=await sales_finished[_0x5b0705(0x15a)]({'_id':_0x565a3d[_0x5b0705(0x176)]['id']}),_0x2f0f5c=await warehouse[_0x5b0705(0x15a)]({'name':_0x247f21[_0x5b0705(0x1a0)],'room':_0x565a3d[_0x5b0705(0x15d)]['room'],'warehouse_category':_0x5b0705(0x1c4)}),{invoice:_0x43cc53,customer:_0x2006ab,date:_0x4b6756,warehouse_name:_0xa0ce59,product_name:_0x4d6510,stock:_0x1a2fde,adjust_qty:_0x19d883,note:_0x1bd8da,room:_0x55b2be,primary_code:_0x1ec2ac,secondary_code:_0x2c155d,prod_code:_0xb2f7ec,level:_0x1734e8,isle:_0x1ce484,pallet:_0x248ec0,expiry_date:_0xa1a749}=_0x565a3d[_0x5b0705(0x15d)];if(typeof _0x4d6510=='string')var _0x3d0f8f=[_0x565a3d['body']['product_name']],_0x3b9ba0=[_0x565a3d['body'][_0x5b0705(0x182)]],_0x1163e2=[_0x565a3d['body'][_0x5b0705(0x1b2)]],_0x5c15bc=[_0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0xb1)]],_0x21614d=[_0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x1da)]],_0x132b20=[_0x565a3d['body'][_0x5b0705(0x13f)]],_0x3fc016=[_0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x1ab)]],_0x182043=[_0x565a3d[_0x5b0705(0x15d)]['expiry_date']];else var _0x3d0f8f=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x1dd)]],_0x3b9ba0=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x182)]],_0x1163e2=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x1b2)]],_0x5c15bc=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0xb1)]],_0x21614d=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x1da)]],_0x132b20=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x13f)]],_0x3fc016=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x1ab)]],_0x182043=[..._0x565a3d[_0x5b0705(0x15d)][_0x5b0705(0x14a)]];const _0x3aa530=_0x3d0f8f['map'](_0x88338=>{return _0x88338={'product_name':_0x88338};});_0x3b9ba0[_0x5b0705(0x1df)]((_0x4329de,_0x33cdab)=>{var _0xe3f299=_0x5b0705;_0x3aa530[_0x33cdab][_0xe3f299(0x182)]=_0x4329de;}),_0x1163e2[_0x5b0705(0x1df)]((_0x4a6a57,_0x155a54)=>{_0x3aa530[_0x155a54]['quantity']=_0x4a6a57;}),_0x5c15bc['forEach']((_0x5f2484,_0x48c50e)=>{var _0xecbdd1=_0x5b0705;_0x3aa530[_0x48c50e][_0xecbdd1(0xb1)]=_0x5f2484;}),_0x21614d[_0x5b0705(0x1df)]((_0x29fe18,_0x38aa58)=>{var _0x5364a3=_0x5b0705;_0x3aa530[_0x38aa58][_0x5364a3(0x1da)]=_0x29fe18;}),_0x132b20[_0x5b0705(0x1df)]((_0x5d5e91,_0x18af3f)=>{var _0x3be93f=_0x5b0705;_0x3aa530[_0x18af3f][_0x3be93f(0x1ca)]=_0x5d5e91;}),_0x3fc016[_0x5b0705(0x1df)]((_0x44cac6,_0x23d211)=>{var _0x3ec980=_0x5b0705;_0x3aa530[_0x23d211][_0x3ec980(0x1ab)]=_0x44cac6;}),_0x182043[_0x5b0705(0x1df)]((_0x370567,_0x281863)=>{var _0x5513de=_0x5b0705;_0x3aa530[_0x281863][_0x5513de(0x14a)]=_0x370567;});var _0x450b06=0x0;_0x3aa530[_0x5b0705(0x1df)](_0x79a42a=>{var _0x29252a=_0x5b0705;console[_0x29252a(0xba)]('foreach\x20newproduct',_0x79a42a),(parseInt(_0x79a42a[_0x29252a(0x182)])<parseInt(_0x79a42a[_0x29252a(0x1d5)])||parseInt(_0x79a42a[_0x29252a(0x1d5)])==0x0)&&_0x450b06++;});if(_0x450b06!=0x0)return _0x565a3d['flash']('errors',_0x5b0705(0x17a)),_0x4cbef0['redirect']('back');_0x247f21[_0x5b0705(0x14d)][_0x5b0705(0x1df)](_0x412b4e=>{var _0x18a056=_0x5b0705;const _0x54f44e=_0x2f0f5c[_0x18a056(0x171)][_0x18a056(0xc9)](_0x1ab624=>{var _0x28894e=_0x18a056;_0x1ab624[_0x28894e(0x1dd)]==_0x412b4e[_0x28894e(0x1dd)]&&_0x1ab624[_0x28894e(0x106)]==_0x412b4e['bay']&&(_0x1ab624['product_stock']=parseInt(_0x1ab624[_0x28894e(0x105)])+parseInt(_0x412b4e['quantity']));});}),await _0x2f0f5c[_0x5b0705(0x19f)]();const _0x224549=_0x3aa530['filter'](_0x277525=>_0x277525[_0x5b0705(0x1d5)]!=='0'&&_0x277525['quantity']!=='');_0x247f21[_0x5b0705(0x12b)]=_0x43cc53,_0x247f21[_0x5b0705(0x16e)]=_0x2006ab,_0x247f21['date']=_0x4b6756,_0x247f21[_0x5b0705(0x1a0)]=_0xa0ce59,_0x247f21['sale_product']=_0x224549,_0x247f21[_0x5b0705(0xb9)]=_0x1bd8da,_0x247f21[_0x5b0705(0x9e)]=_0x55b2be;const _0x3552cf=await _0x247f21['save'](),_0x3acda2=await sales_finished[_0x5b0705(0x15a)]({'_id':_0x565a3d[_0x5b0705(0x176)]['id']}),_0x3c699d=await warehouse[_0x5b0705(0x15a)]({'name':_0xa0ce59,'room':_0x55b2be,'warehouse_category':_0x5b0705(0x1c4)});_0x3acda2['sale_product'][_0x5b0705(0x1df)](_0x396802=>{var _0x3cf724=_0x5b0705;const _0x13fb19=_0x3c699d[_0x3cf724(0x171)]['map'](_0x108afd=>{var _0x4d38e7=_0x3cf724;_0x108afd[_0x4d38e7(0x1dd)]==_0x396802[_0x4d38e7(0x1dd)]&&_0x108afd[_0x4d38e7(0x106)]==_0x396802[_0x4d38e7(0x106)]&&(_0x108afd['product_stock']=parseInt(_0x108afd[_0x4d38e7(0x105)])-parseInt(_0x396802['quantity']));});}),console[_0x5b0705(0xba)]('final',_0x3c699d),await _0x3c699d[_0x5b0705(0x19f)]();const _0x5324c3=await c_payment_data[_0x5b0705(0x15a)]({'invoice':_0x565a3d[_0x5b0705(0x15d)]['invoice']});_0x5324c3[_0x5b0705(0x131)]=_0x565a3d[_0x5b0705(0x15d)]['suppliers'],await _0x5324c3[_0x5b0705(0x19f)](),_0x565a3d['flash'](_0x5b0705(0x158),'Sales\x20Update\x20successfully'),_0x4cbef0[_0x5b0705(0xd2)]('/all_sales_finished/view');}catch(_0x5b4bdf){console[_0x5b0705(0xba)](_0x5b4bdf);}}),router['post'](a0_0x5dca55(0x1cd),auth,async(_0x44155f,_0x2d1201)=>{var _0x5a8145=a0_0x5dca55;try{const _0x452cc5=_0x44155f[_0x5a8145(0x176)]['id'],{invoice:_0x3dc96f,customer:_0x583ec2,receivable_amount:_0x37bece,received_amount:_0x437092}=_0x44155f['body'],_0x58ae26=await sales['findById'](_0x452cc5);console[_0x5a8145(0xba)](_0x58ae26);var _0x21c045=_0x37bece-_0x437092;console[_0x5a8145(0xba)](_0x437092),_0x58ae26[_0x5a8145(0x18f)]=parseFloat(_0x437092)+parseFloat(_0x58ae26['received_amount']),_0x58ae26['due_amount']=_0x21c045,console[_0x5a8145(0xba)](_0x58ae26);const _0x13ee29=await _0x58ae26[_0x5a8145(0x19f)](),_0x41b48c=await c_payment_data[_0x5a8145(0x15a)]({'invoice':_0x3dc96f});_0x41b48c['amount']=_0x21c045,await _0x41b48c[_0x5a8145(0x19f)]();let _0x5670fc=new Date(),_0x501fac=('0'+_0x5670fc[_0x5a8145(0x1c2)]())[_0x5a8145(0xe7)](-0x2),_0x2b6041=('0'+(_0x5670fc[_0x5a8145(0x1b6)]()+0x1))[_0x5a8145(0xe7)](-0x2),_0xf68520=_0x5670fc[_0x5a8145(0x156)](),_0x31d5f7=_0xf68520+'-'+_0x2b6041+'-'+_0x501fac;const _0x283fc4=new customer_payment({'invoice':_0x3dc96f,'date':_0xf68520+'-'+_0x2b6041+'-'+_0x501fac,'customer':_0x583ec2,'reason':_0x5a8145(0x1a6),'amount':_0x437092}),_0x145689=await _0x283fc4[_0x5a8145(0x19f)]();_0x44155f[_0x5a8145(0x125)]('success',_0x5a8145(0x1e0)),_0x2d1201[_0x5a8145(0xd2)]('/all_sales/view');}catch(_0x129ea6){console[_0x5a8145(0xba)](_0x129ea6);}}),router[a0_0x5dca55(0x184)]('/invoice/:id',auth,async(_0x5baffd,_0x1c9daf)=>{var _0xeae668=a0_0x5dca55;try{const {username:_0x146866,email:_0x49063b,role:_0x312eda}=_0x5baffd[_0xeae668(0x9d)],_0x481359=_0x5baffd[_0xeae668(0x9d)],_0x4cda3d=await profile[_0xeae668(0x15a)]({'email':_0x481359[_0xeae668(0x1aa)]}),_0x42732b=await master_shop[_0xeae668(0x14c)]();console[_0xeae668(0xba)]('master',_0x42732b);const _0x291d8a=_0x5baffd[_0xeae668(0x176)]['id'],_0x767179=await sales['findById'](_0x291d8a);console[_0xeae668(0xba)](_0x767179);const _0x13d432=await customer['findOne']({'name':_0x767179[_0xeae668(0x16e)]});console[_0xeae668(0xba)](_0x13d432);if(_0x42732b[0x0]['language']==_0xeae668(0x143)){var _0x13448f=users[_0xeae668(0x186)];console[_0xeae668(0xba)](_0x13448f);}else{if(_0x42732b[0x0]['language']==_0xeae668(0xa5))var _0x13448f=users[_0xeae668(0xa5)];else{if(_0x42732b[0x0][_0xeae668(0x164)]==_0xeae668(0xa3))var _0x13448f=users[_0xeae668(0xa3)];else{if(_0x42732b[0x0][_0xeae668(0x164)]==_0xeae668(0x1e4))var _0x13448f=users[_0xeae668(0x1e4)];else{if(_0x42732b[0x0][_0xeae668(0x164)]==_0xeae668(0x1e3))var _0x13448f=users['French'];else{if(_0x42732b[0x0][_0xeae668(0x164)]==_0xeae668(0x1a9))var _0x13448f=users['Portuguese'];else{if(_0x42732b[0x0][_0xeae668(0x164)]==_0xeae668(0xfe))var _0x13448f=users['Chinese'];else{if(_0x42732b[0x0][_0xeae668(0x164)]==_0xeae668(0xc0))var _0x13448f=users[_0xeae668(0x155)];}}}}}}}_0x1c9daf[_0xeae668(0x15b)](_0xeae668(0x16b),{'success':_0x5baffd[_0xeae668(0x125)]('success'),'errors':_0x5baffd[_0xeae668(0x125)](_0xeae668(0x1a8)),'role':_0x481359,'profile':_0x4cda3d,'master_shop':_0x42732b,'customers':_0x13d432,'sales':_0x767179,'language':_0x13448f});}catch(_0x2166dc){console[_0xeae668(0xba)](_0x2166dc);}}),router[a0_0x5dca55(0x184)](a0_0x5dca55(0xb2),auth,async(_0x48c4c7,_0xaf21e)=>{var _0x2208f4=a0_0x5dca55;try{const {username:_0x5e69b9,email:_0x22e66d,role:_0x47484d}=_0x48c4c7[_0x2208f4(0x9d)],_0x895e66=_0x48c4c7[_0x2208f4(0x9d)],_0x3d9bc3=await profile[_0x2208f4(0x15a)]({'email':_0x895e66[_0x2208f4(0x1aa)]}),_0x3c512a=await master_shop['find'](),_0x8534cf=_0x48c4c7['params']['id'],_0xadb041=await sales_finished['findById'](_0x8534cf),_0x4dc685=await warehouse[_0x2208f4(0x11c)]([{'$match':{'name':_0xadb041[_0x2208f4(0x1a0)]}},{'$unwind':_0x2208f4(0x187)},{'$group':{'_id':_0x2208f4(0xe0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2208f4(0x172)},'bay':{'$first':_0x2208f4(0xa4)},'bin':{'$first':_0x2208f4(0x1ce)},'type':{'$first':_0x2208f4(0xf1)},'floorlevel':{'$first':_0x2208f4(0xe5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2208f4(0xdb)},'product_code':{'$first':_0x2208f4(0x18d)},'storage':{'$first':_0x2208f4(0x146)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2208f4(0xa0)},'unit':{'$first':_0x2208f4(0x198)},'secondary_unit':{'$first':_0x2208f4(0x1dc)},'maxProducts':{'$first':_0x2208f4(0x112)},'batch_code':{'$first':_0x2208f4(0x145)},'maxPerUnit':{'$first':_0x2208f4(0xe3)}}}]),_0x508fba=await product[_0x2208f4(0x14c)]({}),_0x58d259=await warehouse['aggregate']([{'$match':{'status':_0x2208f4(0x18b),'warehouse_category':_0x2208f4(0x1c4),'name':{'$ne':'Return\x20Goods','$ne':_0x2208f4(0x132)}}},{'$group':{'_id':_0x2208f4(0x1d6),'name':{'$first':_0x2208f4(0x1d6)}}},{'$sort':{'name':0x1}}]);var _0x295b30=['Return\x20Rooms'];const _0xfdc340=await warehouse[_0x2208f4(0x11c)]([{'$match':{'status':_0x2208f4(0x18b),'name':_0x2208f4(0x132)}},{'$group':{'_id':_0x2208f4(0x1d6),'name':{'$first':_0x2208f4(0x1d6)}}},{'$sort':{'name':0x1}}]);if(_0x3c512a[0x0]['language']=='English\x20(US)'){var _0x4644d1=users[_0x2208f4(0x186)];console[_0x2208f4(0xba)](_0x4644d1);}else{if(_0x3c512a[0x0][_0x2208f4(0x164)]==_0x2208f4(0xa5))var _0x4644d1=users[_0x2208f4(0xa5)];else{if(_0x3c512a[0x0]['language']==_0x2208f4(0xa3))var _0x4644d1=users[_0x2208f4(0xa3)];else{if(_0x3c512a[0x0][_0x2208f4(0x164)]==_0x2208f4(0x1e4))var _0x4644d1=users[_0x2208f4(0x1e4)];else{if(_0x3c512a[0x0][_0x2208f4(0x164)]==_0x2208f4(0x1e3))var _0x4644d1=users[_0x2208f4(0x1e3)];else{if(_0x3c512a[0x0]['language']==_0x2208f4(0x1a9))var _0x4644d1=users['Portuguese'];else{if(_0x3c512a[0x0][_0x2208f4(0x164)]==_0x2208f4(0xfe))var _0x4644d1=users[_0x2208f4(0xfe)];else{if(_0x3c512a[0x0]['language']==_0x2208f4(0xc0))var _0x4644d1=users['Arabic'];}}}}}}}_0xaf21e[_0x2208f4(0x15b)]('return_sale_finished',{'success':_0x48c4c7[_0x2208f4(0x125)]('success'),'errors':_0x48c4c7[_0x2208f4(0x125)]('errors'),'role':_0x895e66,'profile':_0x3d9bc3,'user':_0xadb041,'stock':_0x4dc685,'master_shop':_0x3c512a,'unit':_0x508fba,'language':_0x4644d1,'warehouses':_0x58d259,'rooms':_0x295b30,'warehouse_QA':_0xfdc340});}catch(_0x1f517f){console['log'](_0x1f517f),_0xaf21e[_0x2208f4(0x1b3)](0xc8)[_0x2208f4(0xf8)]({'message':_0x1f517f['message']});}}),router[a0_0x5dca55(0x165)](a0_0x5dca55(0xb2),auth,async(_0x2233ec,_0x3c9bdd)=>{var _0x51451b=a0_0x5dca55;if(_0x2233ec[_0x51451b(0x15d)]['for_categorize']=='QA')try{const {invoice:_0x3beee3,date:_0x555618,warehouse_name:_0x4606e1,product_name:_0x25452e,primary_code:_0x3235a2,secondary_code:_0xed9001,product_code:_0x522f09,sales_quantity:_0x4042d8,stocks:_0x59f1bc,return_qty:_0x4ebbe8,Room_name:_0x50b813,to_warehouse_name_QA:_0x39f6cf,to_Room_name_QA:_0xf38a3f,note:_0x3bcb85,for_categorize:_0x45c895,product_name_QA1:_0x116353}=_0x2233ec[_0x51451b(0x15d)];if(typeof _0x116353=='string')var _0x48649d=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1b1)]],_0x727649=[_0x2233ec[_0x51451b(0x15d)]['primary_code_QA']],_0x25ba52=[_0x2233ec['body'][_0x51451b(0x118)]],_0x4a9668=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x163)]],_0x35174c=[_0x2233ec['body']['sales_quantity_QA']],_0x4c24e9=[_0x2233ec['body'][_0x51451b(0x1c1)]],_0x8349f7=[_0x2233ec['body']['return_qty_QA']],_0x31822f=[_0x2233ec[_0x51451b(0x15d)]['maxPerUnit_QA']],_0x475847=[_0x2233ec['body'][_0x51451b(0x1b8)]],_0x50df58=[_0x2233ec['body'][_0x51451b(0x16a)]],_0x12ba24=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0xb6)]],_0x5f1990=[_0x2233ec['body'][_0x51451b(0xf4)]],_0x46274c=[_0x2233ec[_0x51451b(0x15d)]['production_date_QA']],_0x23371c=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0xa8)]];else var _0x48649d=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1b1)]],_0x727649=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0xe1)]],_0x25ba52=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x118)]],_0x4a9668=[..._0x2233ec['body']['product_code_QA']],_0x35174c=[..._0x2233ec[_0x51451b(0x15d)]['sales_quantity_QA']],_0x4c24e9=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1c1)]],_0x8349f7=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x11a)]],_0x31822f=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0xbd)]],_0x475847=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1b8)]],_0x50df58=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x16a)]],_0x12ba24=[..._0x2233ec[_0x51451b(0x15d)]['secondary_unit_QA']],_0x5f1990=[..._0x2233ec[_0x51451b(0x15d)]['unit_QA']],_0x46274c=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x140)]],_0x23371c=[..._0x2233ec['body'][_0x51451b(0xa8)]];const _0x3815e4=_0x48649d['map'](_0x143dc1=>{return _0x143dc1={'product_name':_0x143dc1};});_0x727649[_0x51451b(0x1df)]((_0x544aff,_0x433e55)=>{var _0x3cd17a=_0x51451b;_0x3815e4[_0x433e55][_0x3cd17a(0xb1)]=_0x544aff;}),_0x25ba52[_0x51451b(0x1df)]((_0x5c9f71,_0x1dbc98)=>{var _0x3b03b1=_0x51451b;_0x3815e4[_0x1dbc98][_0x3b03b1(0x1da)]=_0x5c9f71;}),_0x4a9668[_0x51451b(0x1df)]((_0x21beea,_0x2f64dd)=>{_0x3815e4[_0x2f64dd]['product_code']=_0x21beea;}),_0x35174c['forEach']((_0x544431,_0x37b668)=>{var _0x57210f=_0x51451b;_0x3815e4[_0x37b668][_0x57210f(0xf2)]=_0x544431;}),_0x4c24e9[_0x51451b(0x1df)]((_0x57c150,_0x187081)=>{var _0x3521df=_0x51451b;_0x3815e4[_0x187081][_0x3521df(0x182)]=_0x57c150;}),_0x8349f7[_0x51451b(0x1df)]((_0x1cbb88,_0x3c061c)=>{var _0x191444=_0x51451b;_0x3815e4[_0x3c061c][_0x191444(0x11e)]=_0x1cbb88;}),_0x31822f[_0x51451b(0x1df)]((_0x10a734,_0x3e82be)=>{var _0x401fac=_0x51451b;_0x3815e4[_0x3e82be][_0x401fac(0xbf)]=_0x10a734;}),_0x475847[_0x51451b(0x1df)]((_0x31a75f,_0x33860f)=>{_0x3815e4[_0x33860f]['maxProducts']=_0x31a75f;}),_0x50df58['forEach']((_0x5b93b4,_0x36964a)=>{var _0x32c67b=_0x51451b;_0x3815e4[_0x36964a][_0x32c67b(0x16f)]=_0x5b93b4;}),_0x12ba24[_0x51451b(0x1df)]((_0x317104,_0x86cdc9)=>{var _0x446720=_0x51451b;_0x3815e4[_0x86cdc9][_0x446720(0x150)]=_0x317104;}),_0x5f1990['forEach']((_0xd5d143,_0x1ba9e2)=>{_0x3815e4[_0x1ba9e2]['unit']=_0xd5d143;}),_0x46274c[_0x51451b(0x1df)]((_0x2c64e0,_0x63bfe2)=>{var _0x47fdb1=_0x51451b;_0x3815e4[_0x63bfe2][_0x47fdb1(0x1bf)]=_0x2c64e0;}),_0x23371c[_0x51451b(0x1df)]((_0x2e0044,_0x4f04e4)=>{var _0x248d8b=_0x51451b;_0x3815e4[_0x4f04e4][_0x248d8b(0x14a)]=_0x2e0044;});const _0x1d9fab=await sales_finished['findOne']({'invoice':_0x3beee3});_0x1d9fab[_0x51451b(0xc6)]=_0x51451b(0x1bd);const _0x56cd16=await _0x1d9fab[_0x51451b(0x19f)](),_0x289b7b=new sales_return_finished({'invoice':_0x3beee3,'customer':_0x2233ec['body'][_0x51451b(0x16e)],'date':_0x555618,'warehouse_name':_0x4606e1,'room':_0x50b813,'ToWarehouse':_0x39f6cf,'ToRoom':_0xf38a3f,'return_sale_QA':_0x3815e4,'note':_0x3bcb85,'warehouse_cat':_0x45c895}),_0x2ed571=await _0x289b7b['save'](),_0x430801=await sales_return_finished[_0x51451b(0x15a)]({'invoice':_0x3beee3}),_0x3f22ab=await warehouse[_0x51451b(0x15a)]({'name':_0x39f6cf,'room':_0xf38a3f});_0x430801[_0x51451b(0x1db)][_0x51451b(0x1df)](_0x212abf=>{var _0x1b7219=_0x51451b,_0x3f865d=0x0;const _0x1e1cbd=_0x3f22ab[_0x1b7219(0x171)]['map'](_0x83809f=>{var _0xbca9cd=_0x1b7219;_0x83809f[_0xbca9cd(0x1dd)]==_0x212abf[_0xbca9cd(0x1dd)]&&_0x83809f[_0xbca9cd(0x14a)]==_0x212abf[_0xbca9cd(0x14a)]&&_0x83809f[_0xbca9cd(0x1bf)]==_0x212abf[_0xbca9cd(0x1bf)]&&_0x83809f['batch_code']==_0x212abf[_0xbca9cd(0x16f)]&&(_0x83809f[_0xbca9cd(0x105)]=parseInt(_0x83809f[_0xbca9cd(0x105)])+parseInt(_0x212abf[_0xbca9cd(0x11e)]),_0x3f865d++);});_0x3f865d=='0'&&(_0x3f22ab[_0x1b7219(0x171)]=_0x3f22ab[_0x1b7219(0x171)][_0x1b7219(0x174)]({'product_name':_0x212abf[_0x1b7219(0x1dd)],'product_stock':_0x212abf[_0x1b7219(0x11e)],'primary_code':_0x212abf[_0x1b7219(0xb1)],'secondary_code':_0x212abf['secondary_code'],'product_code':_0x212abf[_0x1b7219(0x1ca)],'batch_code':_0x212abf['batch_code'],'maxPerUnit':_0x212abf[_0x1b7219(0xbf)],'production_date':_0x212abf[_0x1b7219(0x1bf)],'expiry_date':_0x212abf[_0x1b7219(0x14a)],'secondary_unit':_0x212abf[_0x1b7219(0x150)],'unit':_0x212abf['unit'],'maxProducts':_0x212abf[_0x1b7219(0x110)],'bay':_0x212abf[_0x1b7219(0x106)]}));}),await _0x3f22ab[_0x51451b(0x19f)]();const _0x80b60=new c_payment_data({'invoice':_0x3beee3,'customer':_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x16e)],'reason':_0x51451b(0xe9)});await _0x80b60[_0x51451b(0x19f)]();const _0x57b756=await master_shop['find'](),_0x4d78a8=await email_settings[_0x51451b(0x15a)](),_0x30754c=await customer[_0x51451b(0x15a)]({'name':_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x16e)]});_0x57b756[0x0][_0x51451b(0x147)]==0x1?(right_currency=_0x57b756[0x0][_0x51451b(0x1a3)],left_currency=''):(right_currency='',left_currency=_0x57b756[0x0][_0x51451b(0x1a3)]);var _0x971632=_0x48649d,_0x228423=_0x8349f7,_0x7e9759='',_0xd44d71;for(_0xd44d71 in _0x971632){_0x7e9759+=_0x51451b(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x971632[_0xd44d71]+_0x51451b(0xee)+_0x51451b(0x1b0)+_0x228423[_0xd44d71]+_0x51451b(0xee)+_0x51451b(0x119);}console['log'](_0x51451b(0x109),_0x7e9759);let _0x483dfe=nodemailer[_0x51451b(0xa7)]({'service':_0x51451b(0x1b5),'auth':{'user':_0x4d78a8[_0x51451b(0x1aa)],'pass':_0x4d78a8[_0x51451b(0xcf)]}}),_0xdcd094={'from':_0x4d78a8[_0x51451b(0x1aa)],'to':_0x30754c['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x51451b(0xdd),'path':__dirname+'/../public'+_0x51451b(0x162)+_0x57b756[0x0][_0x51451b(0x161)],'cid':_0x51451b(0x1ad)}],'html':_0x51451b(0xce)+_0x51451b(0x15c)+_0x51451b(0x1de)+_0x51451b(0x1e2)+_0x51451b(0x18a)+_0x51451b(0x1e2)+_0x51451b(0x10d)+_0x51451b(0xec)+_0x51451b(0x1e2)+_0x51451b(0x135)+_0x57b756[0x0]['site_title']+_0x51451b(0x138)+_0x51451b(0xec)+_0x51451b(0xec)+_0x51451b(0xac)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x51451b(0x103)+_0x3beee3+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x51451b(0x1a1)+_0x555618+'\x20'+'</span>'+_0x51451b(0x17f)+_0x51451b(0xec)+_0x51451b(0x15f)+_0x51451b(0x128)+_0x51451b(0x1d7)+_0x51451b(0xed)+_0x51451b(0x1ac)+_0x51451b(0x1c3)+_0x51451b(0xdc)+'</tr>'+_0x51451b(0x144)+_0x51451b(0x139)+'\x20'+_0x7e9759+'\x20'+_0x51451b(0x15e)+_0x51451b(0xfd)+_0x51451b(0x1e2)+'<strong>\x20Regards\x20</strong>'+_0x51451b(0x102)+_0x57b756[0x0][_0x51451b(0x108)]+_0x51451b(0x17f)+_0x51451b(0xec)+_0x51451b(0xec)+_0x51451b(0x191)};_0x483dfe[_0x51451b(0x16d)](_0xdcd094,function(_0x3279bc,_0x21992b){var _0x1662bb=_0x51451b;_0x3279bc?(console[_0x1662bb(0xba)](_0x3279bc),console[_0x1662bb(0xba)](_0x1662bb(0x17c))):console[_0x1662bb(0xba)](_0x1662bb(0x10c));}),_0x2233ec[_0x51451b(0x125)](_0x51451b(0x158),_0x51451b(0xf5)),_0x3c9bdd[_0x51451b(0xd2)](_0x51451b(0x133));}catch(_0x3d786d){_0x3c9bdd['status'](0xc8)[_0x51451b(0xf8)]({'message1':_0x3d786d['message']});}else{if(_0x2233ec[_0x51451b(0x15d)][_0x51451b(0xf6)]=='GS')try{const {invoice:_0x43dd53,date:_0x5d4614,warehouse_name:_0x3a2a9c,product_name:_0x4942d6,primary_code:_0x584791,secondary_code:_0x5d8ca6,product_code:_0x2a5a23,sales_quantity:_0x17e205,stocks:_0x235163,return_qty:_0x1dc9d9,Room_name:_0x407244,to_warehouse_name:_0x4f4925,to_Room_name:_0x23e135,note:_0x33c665,level:_0x5353ed,isle:_0xcf7543,pallet:_0xc85d8c,for_categorize:_0x88e4ff}=_0x2233ec[_0x51451b(0x15d)];if(typeof _0x4942d6==_0x51451b(0x1d4))var _0x48649d=[_0x2233ec[_0x51451b(0x15d)]['product_name']],_0x727649=[_0x2233ec['body']['primary_code']],_0x25ba52=[_0x2233ec['body'][_0x51451b(0x1da)]],_0x4a9668=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1ca)]],_0x35174c=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x136)]],_0x8349f7=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x11e)]],_0x15d442=[_0x2233ec['body'][_0x51451b(0x106)]],_0x31822f=[_0x2233ec['body']['maxPerUnit']],_0x475847=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x110)]],_0x50df58=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x16f)]],_0x12ba24=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x150)]],_0x5f1990=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x197)]],_0x46274c=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1bf)]],_0x23371c=[_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x14a)]];else var _0x48649d=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1dd)]],_0x727649=[..._0x2233ec[_0x51451b(0x15d)]['primary_code']],_0x25ba52=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x1da)]],_0x4a9668=[..._0x2233ec[_0x51451b(0x15d)]['product_code']],_0x35174c=[..._0x2233ec[_0x51451b(0x15d)]['sales_quantity']],_0x8349f7=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x11e)]],_0x15d442=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x106)]],_0x31822f=[..._0x2233ec['body'][_0x51451b(0xbf)]],_0x475847=[..._0x2233ec[_0x51451b(0x15d)]['maxProducts']],_0x50df58=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x16f)]],_0x12ba24=[..._0x2233ec[_0x51451b(0x15d)]['secondary_unit']],_0x5f1990=[..._0x2233ec['body'][_0x51451b(0x197)]],_0x46274c=[..._0x2233ec['body'][_0x51451b(0x1bf)]],_0x23371c=[..._0x2233ec[_0x51451b(0x15d)][_0x51451b(0x14a)]];const _0x2f6ecb=_0x48649d[_0x51451b(0xc9)](_0x708a72=>{return _0x708a72={'product_name':_0x708a72};});_0x727649[_0x51451b(0x1df)]((_0x5ffb7a,_0x2507f0)=>{var _0x578d88=_0x51451b;_0x2f6ecb[_0x2507f0][_0x578d88(0xb1)]=_0x5ffb7a;}),_0x25ba52[_0x51451b(0x1df)]((_0x30d1b4,_0x383276)=>{var _0x3531d2=_0x51451b;_0x2f6ecb[_0x383276][_0x3531d2(0x1da)]=_0x30d1b4;}),_0x4a9668['forEach']((_0x28cbc2,_0x190b41)=>{var _0x11e3ec=_0x51451b;_0x2f6ecb[_0x190b41][_0x11e3ec(0x1ca)]=_0x28cbc2;}),_0x35174c[_0x51451b(0x1df)]((_0xe3be99,_0x32bb0e)=>{var _0x580cb8=_0x51451b;_0x2f6ecb[_0x32bb0e][_0x580cb8(0xf2)]=_0xe3be99;}),_0x8349f7[_0x51451b(0x1df)]((_0x1eff73,_0x190bf7)=>{var _0x47b2b4=_0x51451b;_0x2f6ecb[_0x190bf7][_0x47b2b4(0x11e)]=_0x1eff73;}),_0x15d442[_0x51451b(0x1df)]((_0x196cab,_0x400079)=>{var _0x5a5f19=_0x51451b;_0x2f6ecb[_0x400079][_0x5a5f19(0x106)]=_0x196cab;}),_0x31822f[_0x51451b(0x1df)]((_0x2ad2a3,_0x287d31)=>{var _0x21a9ee=_0x51451b;_0x2f6ecb[_0x287d31][_0x21a9ee(0xbf)]=_0x2ad2a3;}),_0x475847[_0x51451b(0x1df)]((_0x159c26,_0x364368)=>{var _0x23bd2a=_0x51451b;_0x2f6ecb[_0x364368][_0x23bd2a(0x110)]=_0x159c26;}),_0x50df58[_0x51451b(0x1df)]((_0x463288,_0x4fb7b2)=>{_0x2f6ecb[_0x4fb7b2]['batch_code']=_0x463288;}),_0x12ba24[_0x51451b(0x1df)]((_0x146fdc,_0x41ea22)=>{var _0x14b916=_0x51451b;_0x2f6ecb[_0x41ea22][_0x14b916(0x150)]=_0x146fdc;}),_0x5f1990[_0x51451b(0x1df)]((_0x1caa06,_0x55b583)=>{var _0x366bf5=_0x51451b;_0x2f6ecb[_0x55b583][_0x366bf5(0x197)]=_0x1caa06;}),_0x46274c[_0x51451b(0x1df)]((_0x4b8c76,_0x2ca81e)=>{var _0x2deccd=_0x51451b;_0x2f6ecb[_0x2ca81e][_0x2deccd(0x1bf)]=_0x4b8c76;}),_0x23371c['forEach']((_0x4d2827,_0x244254)=>{var _0x141921=_0x51451b;_0x2f6ecb[_0x244254][_0x141921(0x14a)]=_0x4d2827;});var _0x5823a8=0x0;_0x2f6ecb['forEach'](_0x428a2b=>{var _0x2b045c=_0x51451b;(parseInt(_0x428a2b[_0x2b045c(0xf2)])<parseInt(_0x428a2b[_0x2b045c(0x11e)])||parseInt(_0x428a2b[_0x2b045c(0x182)])<parseInt(_0x428a2b[_0x2b045c(0x11e)])&&parseInt(_0x428a2b['sale_qty'])>parseInt(_0x428a2b[_0x2b045c(0x11e)])||parseInt(_0x428a2b['return_qty'])==0x0)&&_0x5823a8++;});if(_0x5823a8!=0x0)return _0x2233ec['flash'](_0x51451b(0x1a8),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x3c9bdd[_0x51451b(0xd2)]('back');const _0x101360=await sales_finished[_0x51451b(0x15a)]({'invoice':_0x43dd53});_0x101360[_0x51451b(0xc6)]=_0x51451b(0x1bd);const _0x1df09d=await _0x101360[_0x51451b(0x19f)](),_0x29cbd8=new sales_return_finished({'invoice':_0x43dd53,'customer':_0x2233ec[_0x51451b(0x15d)][_0x51451b(0x16e)],'date':_0x5d4614,'warehouse_name':_0x3a2a9c,'room':_0x407244,'ToWarehouse':_0x4f4925,'ToRoom':_0x23e135,'return_sale':_0x2f6ecb,'note':_0x33c665,'warehouse_cat':_0x88e4ff}),_0x2f1e6=await _0x29cbd8[_0x51451b(0x19f)](),_0x4c2bb1=await sales_return_finished[_0x51451b(0x15a)]({'invoice':_0x43dd53}),_0xde56bf=await warehouse[_0x51451b(0x15a)]({'name':_0x4f4925,'room':_0x23e135,'warehouse_category':_0x51451b(0x1c4)});_0x4c2bb1['return_sale'][_0x51451b(0x1df)](_0x24a88a=>{var _0x33791a=_0x51451b,_0x914bf6=0x0;const _0x54ce94=_0xde56bf[_0x33791a(0x171)][_0x33791a(0xc9)](_0x323e87=>{var _0x187200=_0x33791a;_0x323e87['product_name']==_0x24a88a[_0x187200(0x1dd)]&&_0x323e87[_0x187200(0x106)]==_0x24a88a['bay']&&_0x323e87['expiry_date']==_0x24a88a['expiry_date']&&_0x323e87[_0x187200(0x1bf)]==_0x24a88a['production_date']&&_0x323e87[_0x187200(0x16f)]==_0x24a88a[_0x187200(0x16f)]&&(_0x323e87[_0x187200(0x105)]=parseInt(_0x323e87[_0x187200(0x105)])+parseInt(_0x24a88a['return_qty']),_0x914bf6++);});_0x914bf6=='0'&&(_0xde56bf[_0x33791a(0x171)]=_0xde56bf['product_details'][_0x33791a(0x174)]({'product_name':_0x24a88a[_0x33791a(0x1dd)],'product_stock':_0x24a88a[_0x33791a(0x11e)],'primary_code':_0x24a88a[_0x33791a(0xb1)],'secondary_code':_0x24a88a[_0x33791a(0x1da)],'product_code':_0x24a88a[_0x33791a(0x1ca)],'bay':_0x24a88a[_0x33791a(0x106)],'batch_code':_0x24a88a[_0x33791a(0x16f)],'maxPerUnit':_0x24a88a[_0x33791a(0xbf)],'production_date':_0x24a88a['production_date'],'expiry_date':_0x24a88a[_0x33791a(0x14a)],'secondary_unit':_0x24a88a['secondary_unit'],'unit':_0x24a88a[_0x33791a(0x197)],'maxProducts':_0x24a88a[_0x33791a(0x110)]}));}),await _0xde56bf[_0x51451b(0x19f)](),console[_0x51451b(0xba)](_0x2233ec['body']);const _0x2c7058=new c_payment_data({'invoice':_0x43dd53,'customer':_0x2233ec[_0x51451b(0x15d)]['customer'],'reason':_0x51451b(0xe9)});await _0x2c7058['save']();const _0x20448b=await master_shop[_0x51451b(0x14c)]();console['log'](_0x51451b(0x153),_0x20448b[0x0][_0x51451b(0x161)]);const _0x2fd527=await email_settings[_0x51451b(0x15a)](),_0x3aac7e=await customer[_0x51451b(0x15a)]({'name':_0x2233ec[_0x51451b(0x15d)]['customer']});console[_0x51451b(0xba)]('customer_data',_0x3aac7e);_0x20448b[0x0][_0x51451b(0x147)]==0x1?(right_currency=_0x20448b[0x0][_0x51451b(0x1a3)],left_currency=''):(right_currency='',left_currency=_0x20448b[0x0]['currency']);var _0x971632=_0x48649d,_0x228423=_0x8349f7,_0x7e9759='',_0xd44d71;for(_0xd44d71 in _0x971632){_0x7e9759+='<tr>'+_0x51451b(0x1b0)+_0x971632[_0xd44d71]+_0x51451b(0xee)+_0x51451b(0x1b0)+_0x228423[_0xd44d71]+_0x51451b(0xee)+_0x51451b(0x119);}console['log']('product_list',_0x7e9759);let _0x192bc0=nodemailer[_0x51451b(0xa7)]({'service':_0x51451b(0x1b5),'auth':{'user':_0x2fd527[_0x51451b(0x1aa)],'pass':_0x2fd527[_0x51451b(0xcf)]}}),_0x4f4f33={'from':_0x2fd527['email'],'to':_0x3aac7e[_0x51451b(0x1aa)],'subject':_0x51451b(0x170),'attachments':[{'filename':'Logo.png','path':__dirname+_0x51451b(0x134)+_0x51451b(0x162)+_0x20448b[0x0][_0x51451b(0x161)],'cid':_0x51451b(0x1ad)}],'html':_0x51451b(0xce)+'<html><head><title></title>'+_0x51451b(0x1de)+_0x51451b(0x1e2)+_0x51451b(0x18a)+_0x51451b(0x1e2)+_0x51451b(0x10d)+_0x51451b(0xec)+_0x51451b(0x1e2)+'<h2>\x20'+_0x20448b[0x0][_0x51451b(0x108)]+_0x51451b(0x138)+_0x51451b(0xec)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x51451b(0x1e2)+_0x51451b(0x114)+_0x51451b(0x103)+_0x43dd53+'\x20'+_0x51451b(0xda)+_0x51451b(0x1a1)+_0x5d4614+'\x20'+_0x51451b(0xbe)+_0x51451b(0x17f)+_0x51451b(0xec)+_0x51451b(0x15f)+_0x51451b(0x128)+_0x51451b(0x1d7)+_0x51451b(0xed)+_0x51451b(0x1ac)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x51451b(0xdc)+_0x51451b(0x119)+_0x51451b(0x144)+_0x51451b(0x139)+'\x20'+_0x7e9759+'\x20'+'</tbody>'+_0x51451b(0xfd)+_0x51451b(0x1e2)+'<strong>\x20Regards\x20</strong>'+_0x51451b(0x102)+_0x20448b[0x0]['site_title']+_0x51451b(0x17f)+_0x51451b(0xec)+_0x51451b(0xec)+_0x51451b(0x191)};_0x192bc0[_0x51451b(0x16d)](_0x4f4f33,function(_0x5b6ff5,_0xd6072b){var _0x6f01bb=_0x51451b;_0x5b6ff5?(console[_0x6f01bb(0xba)](_0x5b6ff5),console['log'](_0x6f01bb(0x17c))):console['log']('Email\x20sent\x20successfully');}),_0x2233ec[_0x51451b(0x125)](_0x51451b(0x158),_0x51451b(0xf5)),_0x3c9bdd[_0x51451b(0xd2)]('/all_sales_finished/view');}catch(_0x52f596){console[_0x51451b(0xba)](_0x52f596),_0x3c9bdd[_0x51451b(0x1b3)](0xc8)[_0x51451b(0xf8)]({'message1':_0x52f596[_0x51451b(0x178)]});}}}),router['get']('/barcode/:id',auth,async(_0x45029a,_0x401068)=>{var _0x44e187=a0_0x5dca55;try{const {username:_0x5a7178,email:_0x24a12e,role:_0x135d6e}=_0x45029a[_0x44e187(0x9d)],_0x35ef50=_0x45029a[_0x44e187(0x9d)],_0x324e7c=await profile[_0x44e187(0x15a)]({'email':_0x35ef50[_0x44e187(0x1aa)]}),_0x3fd712=await master_shop['find']();console[_0x44e187(0xba)](_0x44e187(0x9f),_0x3fd712);const _0x452ce3=_0x45029a[_0x44e187(0x176)]['id'],_0x14787c=await sales[_0x44e187(0x168)](_0x452ce3);console[_0x44e187(0xba)](_0x44e187(0xcd),_0x14787c);if(_0x3fd712[0x0][_0x44e187(0x164)]==_0x44e187(0x143))var _0x4aaa0c=users[_0x44e187(0x186)];else{if(_0x3fd712[0x0][_0x44e187(0x164)]==_0x44e187(0xa5))var _0x4aaa0c=users[_0x44e187(0xa5)];else{if(_0x3fd712[0x0][_0x44e187(0x164)]=='German')var _0x4aaa0c=users[_0x44e187(0xa3)];else{if(_0x3fd712[0x0][_0x44e187(0x164)]==_0x44e187(0x1e4))var _0x4aaa0c=users[_0x44e187(0x1e4)];else{if(_0x3fd712[0x0][_0x44e187(0x164)]==_0x44e187(0x1e3))var _0x4aaa0c=users[_0x44e187(0x1e3)];else{if(_0x3fd712[0x0][_0x44e187(0x164)]==_0x44e187(0x1a9))var _0x4aaa0c=users['Portuguese'];else{if(_0x3fd712[0x0]['language']==_0x44e187(0xfe))var _0x4aaa0c=users[_0x44e187(0xfe)];else{if(_0x3fd712[0x0]['language']==_0x44e187(0xc0))var _0x4aaa0c=users[_0x44e187(0x155)];}}}}}}}_0x401068[_0x44e187(0x15b)](_0x44e187(0x1bc),{'success':_0x45029a[_0x44e187(0x125)](_0x44e187(0x158)),'errors':_0x45029a[_0x44e187(0x125)]('errors'),'role':_0x35ef50,'profile':_0x324e7c,'alldata':_0x14787c,'master_shop':_0x3fd712,'language':_0x4aaa0c});}catch(_0x179723){console[_0x44e187(0xba)](_0x179723);}}),router[a0_0x5dca55(0x165)](a0_0x5dca55(0xca),async(_0x3119c7,_0x2adb14)=>{var _0x3a10c9=a0_0x5dca55;const {product_code:_0x1ffb1a,warehouse_name:_0x31cb39,rooms_data:_0x73d91f,Roomslist:_0x4bc281,sales_category:_0x3e831f}=_0x3119c7[_0x3a10c9(0x15d)],_0x4f57e9=_0x4bc281['split'](','),_0xd6d4a0=[];async function _0x528ec3(_0x4823bc){var _0x564dc3=_0x3a10c9;const _0x2c10f8=await warehouse['aggregate']([{'$match':{'name':_0x31cb39,'room':_0x4823bc}},{'$unwind':_0x564dc3(0x187)},{'$match':{'product_details.primary_code':_0x1ffb1a}},{'$group':{'_id':_0x564dc3(0xe0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x564dc3(0x172)},'primary_code':{'$first':_0x564dc3(0xe4)},'secondary_code':{'$first':_0x564dc3(0xdb)},'product_code':{'$first':_0x564dc3(0x18d)},'level':{'$first':_0x564dc3(0x19b)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x564dc3(0xf1)},'pallet':{'$first':_0x564dc3(0xe5)},'unit':{'$first':_0x564dc3(0x198)},'secondary_unit':{'$first':_0x564dc3(0x1dc)},'storage':{'$first':_0x564dc3(0x146)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x564dc3(0xf7)},'production_date':{'$first':_0x564dc3(0xa0)},'maxPerUnit':{'$first':_0x564dc3(0xe3)},'batch_code':{'$first':_0x564dc3(0x145)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x564dc3(0x126)},'invoice':{'$first':_0x564dc3(0x1d8)},'uuid':{'$first':_0x564dc3(0x152)},'gross_price':{'$first':_0x564dc3(0x1cf)},'sales_category':{'$first':_0x564dc3(0xb4)}}}]),_0x5669ab=await warehouse[_0x564dc3(0x11c)]([{'$match':{'name':_0x31cb39,'room':_0x4823bc}},{'$unwind':_0x564dc3(0x187)},{'$match':{'product_details.secondary_code':_0x1ffb1a}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x564dc3(0xe4)},'secondary_code':{'$first':_0x564dc3(0xdb)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x564dc3(0x1ce)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x564dc3(0xe5)},'unit':{'$first':_0x564dc3(0x198)},'secondary_unit':{'$first':_0x564dc3(0x1dc)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x564dc3(0x127)},'expiry_date':{'$first':_0x564dc3(0xf7)},'production_date':{'$first':_0x564dc3(0xa0)},'maxPerUnit':{'$first':_0x564dc3(0xe3)},'batch_code':{'$first':_0x564dc3(0x145)},'product_cat':{'$first':_0x564dc3(0xcc)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x564dc3(0x126)},'invoice':{'$first':_0x564dc3(0x1d8)},'uuid':{'$first':_0x564dc3(0x152)},'gross_price':{'$first':_0x564dc3(0x1cf)},'sales_category':{'$first':_0x564dc3(0xb4)}}}]);if(_0x2c10f8[_0x564dc3(0xd4)]>0x0)_0xd6d4a0['push'](_0x2c10f8);else _0x5669ab[_0x564dc3(0xd4)]>0x0&&_0xd6d4a0[_0x564dc3(0x1e6)](_0x5669ab);}const _0x44f3d7=_0x4f57e9[_0x3a10c9(0xc9)](_0x4456aa=>_0x528ec3(_0x4456aa));await Promise[_0x3a10c9(0x166)](_0x44f3d7),_0x2adb14[_0x3a10c9(0xf8)](_0xd6d4a0);}),router[a0_0x5dca55(0x165)]('/barcode_scanner_logs',async(_0x332c4b,_0x2edcd5)=>{var _0x25f21e=a0_0x5dca55;const {product_code:_0x288ebd,warehouse_name:_0x4fb04b,rooms_data:_0x16cb6f,Roomslist:_0x463bcc,sales_category:_0x8b8ac7}=_0x332c4b['body'],_0x1f3330=_0x463bcc[_0x25f21e(0x1c6)](','),_0x4ac86f=[];async function _0x481e7d(_0x1bcbb9){var _0x2f9f9b=_0x25f21e;const _0x1a1d59=await warehouse[_0x2f9f9b(0x11c)]([{'$match':{'name':_0x4fb04b,'room':_0x1bcbb9}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x288ebd,'product_details.sales_category':_0x8b8ac7,'product_details.type_products':_0x2f9f9b(0xba)}},{'$group':{'_id':_0x2f9f9b(0xe0),'name':{'$first':_0x2f9f9b(0x190)},'product_stock':{'$first':_0x2f9f9b(0x172)},'primary_code':{'$first':_0x2f9f9b(0xe4)},'secondary_code':{'$first':_0x2f9f9b(0xdb)},'product_code':{'$first':_0x2f9f9b(0x18d)},'level':{'$first':_0x2f9f9b(0x19b)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x2f9f9b(0xf1)},'pallet':{'$first':_0x2f9f9b(0xe5)},'unit':{'$first':_0x2f9f9b(0x198)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2f9f9b(0x146)},'rack':{'$first':_0x2f9f9b(0x127)},'expiry_date':{'$first':_0x2f9f9b(0xf7)},'production_date':{'$first':_0x2f9f9b(0xa0)},'maxPerUnit':{'$first':_0x2f9f9b(0xe3)},'batch_code':{'$first':_0x2f9f9b(0x145)},'product_cat':{'$first':_0x2f9f9b(0xcc)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2f9f9b(0x126)},'invoice':{'$first':_0x2f9f9b(0x1d8)},'uuid':{'$first':'$product_details.uuid'},'gross_price':{'$first':_0x2f9f9b(0x1cf)},'sales_category':{'$first':_0x2f9f9b(0xb4)},'type_products':{'$first':_0x2f9f9b(0xfa)}}}]);console['log'](_0x2f9f9b(0xba)+_0x2f9f9b(0x10f)+_0x288ebd+_0x2f9f9b(0x10f)+_0x8b8ac7);const _0xc9473c=await warehouse[_0x2f9f9b(0x11c)]([{'$match':{'name':_0x4fb04b,'room':_0x1bcbb9}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x288ebd,'product_details.sales_category':_0x8b8ac7,'product_details.type_products':'log'}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2f9f9b(0x172)},'primary_code':{'$first':_0x2f9f9b(0xe4)},'secondary_code':{'$first':_0x2f9f9b(0xdb)},'product_code':{'$first':_0x2f9f9b(0x18d)},'level':{'$first':_0x2f9f9b(0xa4)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2f9f9b(0xf1)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2f9f9b(0x198)},'secondary_unit':{'$first':_0x2f9f9b(0x1dc)},'storage':{'$first':_0x2f9f9b(0x146)},'rack':{'$first':_0x2f9f9b(0x127)},'expiry_date':{'$first':_0x2f9f9b(0xf7)},'production_date':{'$first':_0x2f9f9b(0xa0)},'maxPerUnit':{'$first':_0x2f9f9b(0xe3)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2f9f9b(0xcc)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2f9f9b(0x126)},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0x2f9f9b(0x152)},'gross_price':{'$first':_0x2f9f9b(0x1cf)},'sales_category':{'$first':_0x2f9f9b(0xb4)},'type_products':{'$first':_0x2f9f9b(0xfa)}}}]);if(_0x1a1d59[_0x2f9f9b(0xd4)]>0x0)_0x4ac86f['push'](_0x1a1d59);else _0xc9473c[_0x2f9f9b(0xd4)]>0x0&&_0x4ac86f['push'](_0xc9473c);}const _0x5a7e87=_0x1f3330[_0x25f21e(0xc9)](_0xa1747e=>_0x481e7d(_0xa1747e));await Promise[_0x25f21e(0x166)](_0x5a7e87),_0x2edcd5[_0x25f21e(0xf8)](_0x4ac86f);}),router['post'](a0_0x5dca55(0xbc),async(_0x1aed11,_0x24cbe0)=>{var _0x4780ea=a0_0x5dca55;try{const {prduct_code:_0x37ec98,warehouse_data:_0x41a314,qty_req:_0x441d5a}=_0x1aed11[_0x4780ea(0x15d)];let _0x524f2d=_0x37ec98[_0x4780ea(0x1c6)]('~'),_0x19787b=_0x441d5a[_0x4780ea(0x1c6)]('~'),_0x1a54b0=[],_0x1eb1e2=0x0;for(let _0x372ea7=0x0;_0x372ea7<=_0x524f2d[_0x4780ea(0xd4)]-0x1;_0x372ea7++){const _0xe36930=_0x524f2d[_0x372ea7],_0x1d03cc=_0x19787b[_0x372ea7],_0x15ed6e=await warehouse[_0x4780ea(0x11c)]([{'$match':{'name':_0x41a314}},{'$unwind':_0x4780ea(0x187)},{'$match':{'product_details.product_code':_0xe36930,'product_details.isAvailable':'true','product_details.isUsed':_0x4780ea(0xfb)}},{'$sort':{'product_details.date_received':0x1,'product_details.level':-0x1,'product_details.bay':-0x1}},{'$group':{'_id':_0x4780ea(0xe0),'name':{'$first':_0x4780ea(0x190)},'product_stock':{'$first':_0x4780ea(0x172)},'primary_code':{'$first':_0x4780ea(0xe4)},'secondary_code':{'$first':_0x4780ea(0xdb)},'product_code':{'$first':_0x4780ea(0x18d)},'level':{'$first':_0x4780ea(0x19b)},'bay':{'$first':'$product_details.bay'},'type':{'$first':_0x4780ea(0xf1)},'pallet':{'$first':_0x4780ea(0xe5)},'unit':{'$first':_0x4780ea(0x198)},'secondary_unit':{'$first':_0x4780ea(0x1dc)},'storage':{'$first':_0x4780ea(0x146)},'rack':{'$first':_0x4780ea(0x127)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4780ea(0xa0)},'maxPerUnit':{'$first':_0x4780ea(0xe3)},'batch_code':{'$first':_0x4780ea(0x145)},'product_cat':{'$first':_0x4780ea(0xcc)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4780ea(0x126)},'invoice':{'$first':_0x4780ea(0x1d8)},'uuid':{'$first':_0x4780ea(0x152)},'gross_price':{'$first':_0x4780ea(0x1cf)},'sales_category':{'$first':_0x4780ea(0xb4)},'date_received':{'$first':_0x4780ea(0xfc)},'warehouse_id':{'$first':'$_id'}}}]),_0x467d0b=_0x15ed6e[_0x4780ea(0x13d)]((_0x31608b,_0xb6ec1a)=>new Date(_0x31608b[_0x4780ea(0x185)])-new Date(_0xb6ec1a[_0x4780ea(0x185)]));let _0x2609c1=_0x1d03cc;for(let _0x56b510=0x0;_0x56b510<=_0x467d0b[_0x4780ea(0xd4)]-0x1&&_0x2609c1>0x0;_0x56b510++){const _0x58a256=_0x467d0b[_0x56b510];if(_0x58a256['product_code']==_0xe36930){_0x1a54b0[_0x1eb1e2]={};const _0x35261b=parseInt(_0x58a256[_0x4780ea(0x105)]),_0x5be4cf=0x0;let _0x59ea36=_0x35261b-_0x5be4cf,_0x1b9f25=Math[_0x4780ea(0xa6)](_0x2609c1,_0x59ea36);console[_0x4780ea(0xba)](_0x4780ea(0xea)+_0x1b9f25+_0x4780ea(0x189)+_0x41a314+_0x4780ea(0xb7)+_0x58a256[_0x4780ea(0x1d1)]+',\x20Location:\x20'+(_0x58a256[_0x4780ea(0x1ab)]+_0x58a256['bay'])+'\x20Date:\x20'+_0x58a256[_0x4780ea(0x185)]+_0x4780ea(0x1ae)+_0x58a256[_0x4780ea(0xb0)]),_0x1a54b0[_0x1eb1e2]['group_ids']=_0x58a256[_0x4780ea(0xd3)]+'~'+_0x58a256[_0x4780ea(0x181)]+'~'+_0x1b9f25,_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1dd)]=_0x58a256[_0x4780ea(0xb0)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1ca)]=_0x58a256[_0x4780ea(0x1ca)],_0x1a54b0[_0x1eb1e2]['product_id']=_0x58a256[_0x4780ea(0xf9)],_0x1a54b0[_0x1eb1e2]['date_recieved']=_0x58a256['date_recieved'],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xef)]=_0x58a256[_0x4780ea(0xef)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x11d)]=_0x58a256[_0x4780ea(0x11d)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1d5)]=_0x1b9f25,_0x1a54b0[_0x1eb1e2]['unit']=_0x58a256[_0x4780ea(0x197)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x150)]=_0x58a256[_0x4780ea(0x150)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xb1)]=_0x58a256[_0x4780ea(0xb1)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1da)]=_0x58a256[_0x4780ea(0x1da)],_0x1a54b0[_0x1eb1e2]['maxStocks']=_0x58a256[_0x4780ea(0x195)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x16f)]=_0x58a256[_0x4780ea(0x16f)],_0x1a54b0[_0x1eb1e2]['expiry_date']=_0x58a256[_0x4780ea(0x14a)],_0x1a54b0[_0x1eb1e2]['production_date']=_0x58a256[_0x4780ea(0x1bf)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x151)]=_0x58a256[_0x4780ea(0x151)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xaf)]=_0x58a256['product_cat'],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x12b)]=_0x58a256[_0x4780ea(0x12b)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xaa)]=_0x58a256[_0x4780ea(0xaa)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xd6)]=_0x58a256['roomNamed'],_0x1a54b0[_0x1eb1e2]['level']=_0x58a256[_0x4780ea(0x1ab)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x106)]=_0x58a256['bay'],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1b3)]=_0x4780ea(0x104),console[_0x4780ea(0xba)]('1',_0x1eb1e2),_0x2609c1-=_0x1b9f25,_0x1eb1e2++;if(_0x2609c1<=0x0)break;}}if(_0x2609c1>0x0){var _0x50a940=await product[_0x4780ea(0x15a)]({'product_code':_0xe36930});console['log']('2',_0x1eb1e2),_0x1a54b0[_0x1eb1e2]={},_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1dd)]=_0x50a940[_0x4780ea(0xb0)],_0x1a54b0[_0x1eb1e2]['product_code']=_0xe36930,_0x1a54b0[_0x1eb1e2][_0x4780ea(0xf9)]=_0x50a940[_0x4780ea(0x181)][_0x4780ea(0x160)](),_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1d5)]=_0x2609c1,_0x1a54b0[_0x1eb1e2][_0x4780ea(0xb3)]=_0x50a940[_0x4780ea(0x197)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x150)]=_0x50a940[_0x4780ea(0xc3)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xb1)]=_0x50a940[_0x4780ea(0xb1)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1da)]=_0x50a940[_0x4780ea(0x1da)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x195)]=_0x50a940[_0x4780ea(0x195)],_0x1a54b0[_0x1eb1e2]['maxperunit']=_0x50a940[_0x4780ea(0xd0)],_0x1a54b0[_0x1eb1e2][_0x4780ea(0xaa)]=_0x50a940['gross_price'],_0x1a54b0[_0x1eb1e2][_0x4780ea(0x1b3)]=_0x4780ea(0xfb),console['log'](_0x4780ea(0x1e5)+_0x2609c1+_0x4780ea(0xbb)+_0x1eb1e2+_0x4780ea(0x10f)+_0xe36930),_0x1eb1e2++;}}_0x24cbe0[_0x4780ea(0xf8)](_0x1a54b0);}catch(_0x622f2e){console[_0x4780ea(0xba)](_0x622f2e);}}),router[a0_0x5dca55(0x165)]('/barcode_scanner_auto',async(_0x22f93a,_0x3cec0f)=>{var _0x543fd9=a0_0x5dca55;const {product_code:_0x403693}=_0x22f93a[_0x543fd9(0x15d)];var _0x2df9a2;const _0x461d50=await product[_0x543fd9(0x11c)]([{'$match':{'primary_code':_0x403693}},{'$group':{'_id':_0x543fd9(0x188),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x543fd9(0xa1)},'unit':{'$first':_0x543fd9(0xf0)},'alertquantity':{'$first':_0x543fd9(0x1c7)},'product_code':{'$first':_0x543fd9(0x169)},'primary_code':{'$first':_0x543fd9(0x196)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x543fd9(0x111)},'maxProdPerUnit':{'$first':_0x543fd9(0xc7)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x543fd9(0x12a)},'gross_price':{'$first':_0x543fd9(0x100)},'sales_category':{'$first':'$sales_category'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]),_0x370c7a=await product['aggregate']([{'$match':{'secondary_code':_0x403693}},{'$group':{'_id':'$_id','name':{'$first':_0x543fd9(0x1d6)},'category':{'$first':'$category'},'brand':{'$first':_0x543fd9(0xa1)},'unit':{'$first':_0x543fd9(0xf0)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x543fd9(0x169)},'primary_code':{'$first':_0x543fd9(0x196)},'secondary_code':{'$first':_0x543fd9(0x179)},'maxStocks':{'$first':_0x543fd9(0x111)},'maxProdPerUnit':{'$first':_0x543fd9(0xc7)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x543fd9(0x12a)},'gross_price':{'$first':_0x543fd9(0x100)},'sales_category':{'$first':_0x543fd9(0xc1)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'gross_price':0x1,'sales_category':0x1}}]);if(_0x461d50['length']>0x0)_0x2df9a2=_0x461d50;else _0x370c7a['length']>0x0&&(_0x2df9a2=_0x370c7a);_0x3cec0f[_0x543fd9(0xf8)](_0x2df9a2);}),router[a0_0x5dca55(0x165)](a0_0x5dca55(0x1e1),async(_0x2233c2,_0x1e26c5)=>{var _0x5f57fd=a0_0x5dca55;try{const {group_id:_0x2f465e,DRSI:_0xbb01c0,dateofreq:_0x4f4900,PO_number:_0x1f8d17,date:_0x10b0d8,warehouse_name:_0xf80a13,typevehicle:_0x1f66cf,deliverydate:_0x573087,driver:_0x116b84,plate:_0x2618a7,van:_0xd41761,TSU:_0x466a4c,actual_delivery_date:_0xbbc23c,TFU:_0x2973f2,pull_out_date:_0x27579e,sales:_0x5cd5d0,Customer_data:_0x11c191,note:_0x1253f0}=_0x2233c2['body'],_0x5eb362=mongoose[_0x5f57fd(0x1b4)][_0x5f57fd(0x13b)];let _0x377501=[];const _0x477b26=new invoice_for_outgoing();await _0x477b26['save']();const _0x1dc864=_0x5f57fd(0x142)+_0x477b26[_0x5f57fd(0x1b9)][_0x5f57fd(0x1cc)]()['padStart'](0x8,'0');if(typeof _0x2f465e==_0x5f57fd(0x1d4)){let _0x151a62=_0x2f465e[_0x5f57fd(0x1c6)]('~');var _0x4239d6=_0x5eb362(_0x151a62[0x0]),_0x660a11=_0x5eb362(_0x151a62[0x1]),_0x40a8d2=_0x151a62[0x2];let _0x5b69f1=0x0;const _0x5f3c4b=await warehouse[_0x5f57fd(0x11c)]([{'$match':{'_id':_0x4239d6}},{'$unwind':_0x5f57fd(0x187)},{'$match':{'product_details._id':_0x660a11}}]);await warehouse[_0x5f57fd(0xc4)]({'_id':_0x5eb362(_0x4239d6),'product_details._id':_0x5eb362(_0x660a11)},{'$set':{'product_details.$.isUsed':_0x5f57fd(0x104)}}),_0x377501[_0x5b69f1]={};for(let _0x45c44b=0x0;_0x45c44b<=_0x5f3c4b['length']-0x1;_0x45c44b++){const _0x17836e=_0x5f3c4b[_0x45c44b];console[_0x5f57fd(0xba)](_0x17836e),_0x377501[_0x5b69f1][_0x5f57fd(0xd8)]=_0x17836e[_0x5f57fd(0xb0)],_0x377501[_0x5b69f1][_0x5f57fd(0xf9)]=_0x17836e['product_details']['product_id'],_0x377501[_0x5b69f1][_0x5f57fd(0x1dd)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x1dd)],_0x377501[_0x5b69f1]['product_code']=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x1ca)],_0x377501[_0x5b69f1]['product_stock']=_0x40a8d2,_0x377501[_0x5b69f1][_0x5f57fd(0x1d5)]=_0x40a8d2,_0x377501[_0x5b69f1][_0x5f57fd(0x197)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x197)],_0x377501[_0x5b69f1]['secondary_unit']=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x150)],_0x377501[_0x5b69f1][_0x5f57fd(0x1ab)]=_0x17836e['product_details']['level'],_0x377501[_0x5b69f1][_0x5f57fd(0x106)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x106)],_0x377501[_0x5b69f1]['primary_code']=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0xb1)],_0x377501[_0x5b69f1]['secondary_code']=_0x17836e[_0x5f57fd(0x171)]['secondary_code'],_0x377501[_0x5b69f1]['maxStocks']=_0x17836e['product_details'][_0x5f57fd(0x195)],_0x377501[_0x5b69f1]['batch_code']=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x16f)],_0x377501[_0x5b69f1][_0x5f57fd(0x14a)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x14a)],_0x377501[_0x5b69f1][_0x5f57fd(0x1bf)]=_0x17836e['product_details']['production_date'],_0x377501[_0x5b69f1][_0x5f57fd(0x151)]=_0x17836e['product_details'][_0x5f57fd(0x151)],_0x377501[_0x5b69f1][_0x5f57fd(0xaf)]=_0x17836e['product_details'][_0x5f57fd(0xaf)],_0x377501[_0x5b69f1][_0x5f57fd(0xd6)]=_0x17836e[_0x5f57fd(0x9e)],_0x377501[_0x5b69f1][_0x5f57fd(0x12b)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x12b)],_0x377501[_0x5b69f1][_0x5f57fd(0x11d)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x11d)],_0x377501[_0x5b69f1][_0x5f57fd(0xaa)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0xaa)],_0x377501[_0x5b69f1][_0x5f57fd(0xef)]=_0x17836e[_0x5f57fd(0x171)]['sales'],_0x377501[_0x5b69f1][_0x5f57fd(0x159)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x159)],_0x377501[_0x5b69f1][_0x5f57fd(0x1cb)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x1be)],_0x377501[_0x5b69f1][_0x5f57fd(0xd3)]=_0x17836e[_0x5f57fd(0x181)][_0x5f57fd(0x160)](),_0x377501[_0x5b69f1][_0x5f57fd(0xad)]=_0x17836e[_0x5f57fd(0x171)]['_id'][_0x5f57fd(0x160)](),_0x377501[_0x5b69f1][_0x5f57fd(0x17e)]=_0x5f57fd(0x1d9),_0x377501[_0x5b69f1][_0x5f57fd(0x16c)]=_0x17836e[_0x5f57fd(0x171)][_0x5f57fd(0x1be)];}_0x377501[_0x5b69f1][_0x5f57fd(0x1c5)]=_0x1dc864;}else for(let _0x15f0f0=0x0;_0x15f0f0<=_0x2f465e[_0x5f57fd(0xd4)]-0x1;_0x15f0f0++){const _0x13904c=_0x2f465e[_0x15f0f0];let _0x13cf6f=_0x13904c['split']('~');console['log'](_0x13cf6f);var _0x4239d6=_0x5eb362(_0x13cf6f[0x0]),_0x660a11=_0x5eb362(_0x13cf6f[0x1]),_0x40a8d2=_0x13cf6f[0x2];const _0x18a29e=await warehouse[_0x5f57fd(0x11c)]([{'$match':{'_id':_0x4239d6}},{'$unwind':'$product_details'},{'$match':{'product_details._id':_0x660a11}}]);await warehouse['updateOne']({'_id':_0x5eb362(_0x4239d6),'product_details._id':_0x5eb362(_0x660a11)},{'$set':{'product_details.$.isUsed':_0x5f57fd(0x104)}}),_0x377501[_0x15f0f0]={};for(let _0x89d5e3=0x0;_0x89d5e3<=_0x18a29e['length']-0x1;_0x89d5e3++){const _0x10f152=_0x18a29e[_0x89d5e3];_0x377501[_0x15f0f0][_0x5f57fd(0xd8)]=_0x10f152['name'],_0x377501[_0x15f0f0][_0x5f57fd(0xf9)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0xf9)],_0x377501[_0x15f0f0][_0x5f57fd(0x1dd)]=_0x10f152['product_details'][_0x5f57fd(0x1dd)],_0x377501[_0x15f0f0][_0x5f57fd(0x1ca)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x1ca)],_0x377501[_0x15f0f0][_0x5f57fd(0x105)]=_0x40a8d2,_0x377501[_0x15f0f0][_0x5f57fd(0x1d5)]=_0x40a8d2,_0x377501[_0x15f0f0][_0x5f57fd(0x197)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x197)],_0x377501[_0x15f0f0][_0x5f57fd(0x150)]=_0x10f152[_0x5f57fd(0x171)]['secondary_unit'],_0x377501[_0x15f0f0][_0x5f57fd(0x1ab)]=_0x10f152[_0x5f57fd(0x171)]['level'],_0x377501[_0x15f0f0]['bay']=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x106)],_0x377501[_0x15f0f0][_0x5f57fd(0xb1)]=_0x10f152[_0x5f57fd(0x171)]['primary_code'],_0x377501[_0x15f0f0][_0x5f57fd(0x1da)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x1da)],_0x377501[_0x15f0f0][_0x5f57fd(0x195)]=_0x10f152[_0x5f57fd(0x171)]['maxStocks'],_0x377501[_0x15f0f0][_0x5f57fd(0x16f)]=_0x10f152['product_details'][_0x5f57fd(0x16f)],_0x377501[_0x15f0f0][_0x5f57fd(0x14a)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x14a)],_0x377501[_0x15f0f0][_0x5f57fd(0x1bf)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x1bf)],_0x377501[_0x15f0f0]['maxperunit']=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x151)],_0x377501[_0x15f0f0][_0x5f57fd(0xaf)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0xaf)],_0x377501[_0x15f0f0][_0x5f57fd(0xd6)]=_0x10f152['room'],_0x377501[_0x15f0f0][_0x5f57fd(0x12b)]=_0x10f152['product_details']['invoice'],_0x377501[_0x15f0f0]['uuid']=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x11d)],_0x377501[_0x15f0f0]['gross_price']=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0xaa)],_0x377501[_0x15f0f0][_0x5f57fd(0xef)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x1be)],_0x377501[_0x15f0f0][_0x5f57fd(0x159)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x159)],_0x377501[_0x15f0f0][_0x5f57fd(0x1cb)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x1be)],_0x377501[_0x15f0f0][_0x5f57fd(0xd3)]=_0x10f152['_id'][_0x5f57fd(0x160)](),_0x377501[_0x15f0f0][_0x5f57fd(0xad)]=_0x10f152['product_details']['_id']['valueOf'](),_0x377501[_0x15f0f0][_0x5f57fd(0x17e)]=_0x5f57fd(0x1d9),_0x377501[_0x15f0f0][_0x5f57fd(0x16c)]=_0x10f152[_0x5f57fd(0x171)][_0x5f57fd(0x1be)];}_0x377501[_0x15f0f0][_0x5f57fd(0x1c5)]=_0x1dc864;}for(let _0x207061=0x0;_0x207061<=_0x377501[_0x5f57fd(0xd4)]-0x1;_0x207061++){const _0x5af6ba=_0x377501[_0x207061],_0x1809e2=new warehouse_temporary(_0x5af6ba);await _0x1809e2[_0x5f57fd(0x19f)]();}const _0x5a0b6e=new sales_finished({'invoice':_0x1dc864,'sales_data':_0x5cd5d0,'customer':_0x11c191,'date':_0x10b0d8,'warehouse_name':_0xf80a13,'sale_product':_0x377501,'note':_0x1253f0,'finalize':_0x5f57fd(0x113),'dateofreq':_0x4f4900,'PO_number':_0x1f8d17,'typevehicle':_0x1f66cf,'deliverydate':_0x573087,'driver':_0x116b84,'plate':_0x2618a7,'van':_0xd41761,'DRSI':_0xbb01c0,'TSU':_0x466a4c,'TFU':_0x2973f2,'pullout_date':_0x27579e,'actualdelivery_date':_0xbbc23c,'typeOfProducts':_0x5f57fd(0xe6)}),_0x47ca1e=await _0x5a0b6e[_0x5f57fd(0x19f)]();_0x2233c2[_0x5f57fd(0x125)](_0x5f57fd(0x158),'Sales\x20Add\x20successfully'),_0x1e26c5[_0x5f57fd(0xd2)](_0x5f57fd(0x141)+_0x47ca1e[_0x5f57fd(0x181)]);}catch(_0x49a8ed){console[_0x5f57fd(0xba)](_0x49a8ed);}}),module[a0_0x5dca55(0xc8)]=router;