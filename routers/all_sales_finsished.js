var a0_0x4a5a05=a0_0x5bef;(function(_0x40d4dc,_0x53d511){var _0x37999b=a0_0x5bef,_0x261739=_0x40d4dc();while(!![]){try{var _0x39b3fc=-parseInt(_0x37999b(0x289))/0x1+parseInt(_0x37999b(0x2a9))/0x2*(-parseInt(_0x37999b(0x23e))/0x3)+-parseInt(_0x37999b(0x2d3))/0x4*(-parseInt(_0x37999b(0x272))/0x5)+-parseInt(_0x37999b(0x260))/0x6+parseInt(_0x37999b(0x2d1))/0x7+-parseInt(_0x37999b(0x237))/0x8+parseInt(_0x37999b(0x1fa))/0x9;if(_0x39b3fc===_0x53d511)break;else _0x261739['push'](_0x261739['shift']());}catch(_0x46cd44){_0x261739['push'](_0x261739['shift']());}}}(a0_0xdd45,0xdf912));const express=require(a0_0x4a5a05(0x23f)),app=express(),router=express[a0_0x4a5a05(0x273)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings,invoice_for_outgoing,sales_logs}=require(a0_0x4a5a05(0x29f)),auth=require(a0_0x4a5a05(0x2b8)),nodemailer=require('nodemailer'),users=require(a0_0x4a5a05(0x1b6));router['get'](a0_0x4a5a05(0x2ac),auth,async(_0x31188e,_0x11cf9a)=>{var _0x4fb95d=a0_0x4a5a05;try{const {username:_0x2be6a9,email:_0x12d53d,role:_0x15e389}=_0x31188e['user'],_0x51300d=_0x31188e[_0x4fb95d(0x2af)],_0x17fa0a=await profile['findOne']({'email':_0x51300d[_0x4fb95d(0x233)]}),_0x1ccff2=await master_shop[_0x4fb95d(0x20d)]();let _0x185ae3;if(_0x51300d[_0x4fb95d(0x270)]==_0x4fb95d(0x2c4)){const _0x206e2f=await staff['findOne']({'email':_0x51300d[_0x4fb95d(0x233)]});_0x185ae3=await sales_finished[_0x4fb95d(0x1fd)]([{'$match':{'typeOfProducts':_0x4fb95d(0x228)}},{'$unwind':_0x4fb95d(0x219)},{'$group':{'_id':_0x4fb95d(0x20c),'invoice':{'$first':_0x4fb95d(0x268)},'customers':{'$first':'$customer'},'date':{'$first':_0x4fb95d(0x1e2)},'warehouse_name':{'$first':_0x4fb95d(0x1e7)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4fb95d(0x2a0)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4fb95d(0x28c)},'pallet':{'$addToSet':_0x4fb95d(0x1f7)},'finalize':{'$first':_0x4fb95d(0x28f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x185ae3=await sales_finished[_0x4fb95d(0x1fd)]([{'$match':{'typeOfProducts':_0x4fb95d(0x228)}},{'$unwind':_0x4fb95d(0x219)},{'$group':{'_id':_0x4fb95d(0x20c),'invoice':{'$first':_0x4fb95d(0x268)},'customers':{'$first':_0x4fb95d(0x1c3)},'date':{'$first':_0x4fb95d(0x1e2)},'warehouse_name':{'$first':_0x4fb95d(0x1e7)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4fb95d(0x1db)},'return_data':{'$first':_0x4fb95d(0x250)},'customers_docs':{'$first':_0x4fb95d(0x224)},'total_saleproduct_quantity':{'$sum':_0x4fb95d(0x202)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x4fb95d(0x1ca)},'type':{'$addToSet':_0x4fb95d(0x28c)},'pallet':{'$addToSet':_0x4fb95d(0x1f7)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x1ccff2[0x0]['language']==_0x4fb95d(0x221)){var _0x1a94f8=users[_0x4fb95d(0x1d3)];console['log'](_0x1a94f8);}else{if(_0x1ccff2[0x0]['language']==_0x4fb95d(0x25a))var _0x1a94f8=users[_0x4fb95d(0x25a)];else{if(_0x1ccff2[0x0][_0x4fb95d(0x1c4)]==_0x4fb95d(0x2cb))var _0x1a94f8=users['German'];else{if(_0x1ccff2[0x0]['language']==_0x4fb95d(0x235))var _0x1a94f8=users[_0x4fb95d(0x235)];else{if(_0x1ccff2[0x0][_0x4fb95d(0x1c4)]=='French')var _0x1a94f8=users[_0x4fb95d(0x27b)];else{if(_0x1ccff2[0x0]['language']==_0x4fb95d(0x242))var _0x1a94f8=users[_0x4fb95d(0x251)];else{if(_0x1ccff2[0x0][_0x4fb95d(0x1c4)]==_0x4fb95d(0x293))var _0x1a94f8=users[_0x4fb95d(0x293)];else{if(_0x1ccff2[0x0][_0x4fb95d(0x1c4)]=='Arabic\x20(ae)')var _0x1a94f8=users['Arabic'];}}}}}}}_0x11cf9a[_0x4fb95d(0x21a)](_0x4fb95d(0x21f),{'success':_0x31188e['flash'](_0x4fb95d(0x227)),'errors':_0x31188e[_0x4fb95d(0x253)]('errors'),'sales':_0x185ae3,'profile':_0x17fa0a,'role':_0x51300d,'master_shop':_0x1ccff2,'language':_0x1a94f8});}catch(_0x28752f){console[_0x4fb95d(0x28a)](_0x28752f);}}),router['get']('/view_log',auth,async(_0x26017d,_0x51fe68)=>{var _0x247170=a0_0x4a5a05;try{const {username:_0xd61370,email:_0x1f7c5b,role:_0xb53e0a}=_0x26017d['user'],_0x130735=_0x26017d[_0x247170(0x2af)],_0x1f3eea=await profile[_0x247170(0x286)]({'email':_0x130735[_0x247170(0x233)]}),_0x41c619=await master_shop[_0x247170(0x20d)]();let _0x48f33d;if(_0x130735[_0x247170(0x270)]==_0x247170(0x2c4)){const _0x4b197e=await staff[_0x247170(0x286)]({'email':_0x130735[_0x247170(0x233)]});_0x48f33d=await sales_finished[_0x247170(0x1fd)]([{'$match':{'typeOfProducts':_0x247170(0x1ed)}},{'$unwind':_0x247170(0x219)},{'$group':{'_id':_0x247170(0x20c),'invoice':{'$first':_0x247170(0x268)},'customers':{'$first':_0x247170(0x1c3)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x247170(0x1e7)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x247170(0x1db)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x247170(0x224)},'total_saleproduct_quantity':{'$sum':_0x247170(0x202)},'level':{'$addToSet':_0x247170(0x2a0)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x247170(0x28c)},'pallet':{'$addToSet':_0x247170(0x1f7)},'finalize':{'$first':_0x247170(0x28f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x48f33d=await sales_finished[_0x247170(0x1fd)]([{'$match':{'typeOfProducts':_0x247170(0x1ed)}},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x247170(0x268)},'customers':{'$first':'$customer'},'date':{'$first':_0x247170(0x1e2)},'warehouse_name':{'$first':_0x247170(0x1e7)},'sale_product':{'$push':_0x247170(0x219)},'note':{'$first':_0x247170(0x1db)},'return_data':{'$first':_0x247170(0x250)},'customers_docs':{'$first':_0x247170(0x224)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x247170(0x2a0)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x247170(0x28c)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x247170(0x28f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x41c619[0x0][_0x247170(0x1c4)]=='English\x20(US)'){var _0x48fdcb=users[_0x247170(0x1d3)];console[_0x247170(0x28a)](_0x48fdcb);}else{if(_0x41c619[0x0][_0x247170(0x1c4)]==_0x247170(0x25a))var _0x48fdcb=users[_0x247170(0x25a)];else{if(_0x41c619[0x0]['language']=='German')var _0x48fdcb=users[_0x247170(0x2cb)];else{if(_0x41c619[0x0]['language']==_0x247170(0x235))var _0x48fdcb=users['Spanish'];else{if(_0x41c619[0x0][_0x247170(0x1c4)]=='French')var _0x48fdcb=users[_0x247170(0x27b)];else{if(_0x41c619[0x0][_0x247170(0x1c4)]==_0x247170(0x242))var _0x48fdcb=users[_0x247170(0x251)];else{if(_0x41c619[0x0][_0x247170(0x1c4)]==_0x247170(0x293))var _0x48fdcb=users[_0x247170(0x293)];else{if(_0x41c619[0x0]['language']==_0x247170(0x238))var _0x48fdcb=users[_0x247170(0x1ec)];}}}}}}}_0x51fe68['render'](_0x247170(0x215),{'success':_0x26017d[_0x247170(0x253)](_0x247170(0x227)),'errors':_0x26017d[_0x247170(0x253)]('errors'),'sales':_0x48f33d,'profile':_0x1f3eea,'role':_0x130735,'master_shop':_0x41c619,'language':_0x48fdcb});}catch(_0x322552){console[_0x247170(0x28a)](_0x322552);}});async function getRandom8DigitNumber(){var _0x26f41d=a0_0x4a5a05;const _0x34b1d8=0x989680,_0x46527a=0x5f5e0ff,_0x37a869=Math[_0x26f41d(0x1e4)](Math[_0x26f41d(0x2b6)]()*(_0x46527a-_0x34b1d8+0x1))+_0x34b1d8;var _0x5b63eb;const _0x15b56f=await sales_finished[_0x26f41d(0x286)]({'invoice':_0x26f41d(0x2bf)+_0x37a869});return _0x15b56f&&_0x15b56f['length']>0x0?_0x5b63eb='OUTF-'+_0x37a869:_0x5b63eb=_0x26f41d(0x2bf)+_0x37a869,_0x5b63eb;}router[a0_0x4a5a05(0x25f)]('/view/add_sales',auth,async(_0x1b9fca,_0x461ec5)=>{var _0x5e7fe6=a0_0x4a5a05;try{const {username:_0x40c25d,email:_0x4f069e,role:_0x57db40}=_0x1b9fca[_0x5e7fe6(0x2af)],_0x411912=_0x1b9fca['user'],_0x30449c=await profile['findOne']({'email':_0x411912['email']}),_0x8ea772=await master_shop[_0x5e7fe6(0x20d)](),_0x5d70a2=await customer[_0x5e7fe6(0x20d)]({});let _0x21107d;if(_0x411912[_0x5e7fe6(0x270)]==_0x5e7fe6(0x2c4)){const _0x51e96c=await staff[_0x5e7fe6(0x286)]({'email':_0x411912['email']});_0x21107d=await warehouse[_0x5e7fe6(0x1fd)]([{'$match':{'status':'Enabled','name':_0x51e96c['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x21107d=await warehouse[_0x5e7fe6(0x1fd)]([{'$match':{'status':_0x5e7fe6(0x23b)}},{'$group':{'_id':_0x5e7fe6(0x231),'name':{'$first':_0x5e7fe6(0x231)}}},{'$sort':{'name':0x1}}]);const _0x2ea5f8=await product[_0x5e7fe6(0x20d)]({});var _0x50c5fc=['Ambient',_0x5e7fe6(0x1fb)];const _0x478018=await sales_finished[_0x5e7fe6(0x20d)]({}),_0x1503da=_0x478018['length']+0x1,_0x559981=_0x5e7fe6(0x2bf)+_0x1503da[_0x5e7fe6(0x1d1)]()[_0x5e7fe6(0x1f1)](0x5,'0');if(_0x8ea772[0x0]['language']=='English\x20(US)'){var _0x17fb84=users['English'];console[_0x5e7fe6(0x28a)](_0x17fb84);}else{if(_0x8ea772[0x0][_0x5e7fe6(0x1c4)]==_0x5e7fe6(0x25a))var _0x17fb84=users[_0x5e7fe6(0x25a)];else{if(_0x8ea772[0x0]['language']==_0x5e7fe6(0x2cb))var _0x17fb84=users[_0x5e7fe6(0x2cb)];else{if(_0x8ea772[0x0][_0x5e7fe6(0x1c4)]==_0x5e7fe6(0x235))var _0x17fb84=users[_0x5e7fe6(0x235)];else{if(_0x8ea772[0x0][_0x5e7fe6(0x1c4)]=='French')var _0x17fb84=users['French'];else{if(_0x8ea772[0x0][_0x5e7fe6(0x1c4)]=='Portuguese\x20(BR)')var _0x17fb84=users['Portuguese'];else{if(_0x8ea772[0x0][_0x5e7fe6(0x1c4)]==_0x5e7fe6(0x293))var _0x17fb84=users[_0x5e7fe6(0x293)];else{if(_0x8ea772[0x0]['language']==_0x5e7fe6(0x238))var _0x17fb84=users[_0x5e7fe6(0x1ec)];}}}}}}}const _0x385eae=getRandom8DigitNumber();_0x385eae[_0x5e7fe6(0x1dd)](_0x39b461=>{var _0x501cee=_0x5e7fe6;_0x461ec5[_0x501cee(0x21a)](_0x501cee(0x1e5),{'success':_0x1b9fca[_0x501cee(0x253)](_0x501cee(0x227)),'errors':_0x1b9fca[_0x501cee(0x253)]('errors'),'role':_0x411912,'profile':_0x30449c,'customer':_0x5d70a2,'warehouse':_0x21107d,'product':_0x2ea5f8,'invoice':_0x39b461,'master_shop':_0x8ea772,'language':_0x17fb84,'rooms_data':_0x50c5fc});})[_0x5e7fe6(0x24e)](_0x3f4e3c=>{var _0x53035a=_0x5e7fe6;_0x1b9fca[_0x53035a(0x253)](_0x53035a(0x1ff),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x461ec5['redirect']('/all_sales_finished/view');});}catch(_0x2f0dd6){console[_0x5e7fe6(0x28a)](_0x2f0dd6);}}),router[a0_0x4a5a05(0x25f)]('/view/add_sales_logs',auth,async(_0x39b59b,_0x4a50d6)=>{var _0x3b7efa=a0_0x4a5a05;try{const {username:_0x1ef1c0,email:_0x1408e0,role:_0x553455}=_0x39b59b['user'],_0x509e31=_0x39b59b['user'],_0x5cfe41=await profile[_0x3b7efa(0x286)]({'email':_0x509e31[_0x3b7efa(0x233)]}),_0x4ef144=await master_shop[_0x3b7efa(0x20d)](),_0x3d0ed3=await customer[_0x3b7efa(0x20d)]({});let _0xd29b1;if(_0x509e31[_0x3b7efa(0x270)]==_0x3b7efa(0x2c4)){const _0x3e11b3=await staff['findOne']({'email':_0x509e31[_0x3b7efa(0x233)]});_0xd29b1=await warehouse[_0x3b7efa(0x1fd)]([{'$match':{'status':_0x3b7efa(0x23b),'name':_0x3e11b3[_0x3b7efa(0x1b7)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0xd29b1=await warehouse[_0x3b7efa(0x1fd)]([{'$match':{'status':_0x3b7efa(0x23b)}},{'$group':{'_id':_0x3b7efa(0x231),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x3d4f30=await product[_0x3b7efa(0x20d)]({});var _0x5ef4de=[_0x3b7efa(0x2b1),'Enclosed'];const _0x318ac9=await sales_finished['find']({}),_0x361e3c=_0x318ac9['length']+0x1,_0x285402='OUTF-'+_0x361e3c[_0x3b7efa(0x1d1)]()[_0x3b7efa(0x1f1)](0x5,'0');if(_0x4ef144[0x0][_0x3b7efa(0x1c4)]=='English\x20(US)'){var _0x1b7abb=users['English'];console[_0x3b7efa(0x28a)](_0x1b7abb);}else{if(_0x4ef144[0x0][_0x3b7efa(0x1c4)]==_0x3b7efa(0x25a))var _0x1b7abb=users[_0x3b7efa(0x25a)];else{if(_0x4ef144[0x0][_0x3b7efa(0x1c4)]==_0x3b7efa(0x2cb))var _0x1b7abb=users[_0x3b7efa(0x2cb)];else{if(_0x4ef144[0x0]['language']==_0x3b7efa(0x235))var _0x1b7abb=users['Spanish'];else{if(_0x4ef144[0x0]['language']==_0x3b7efa(0x27b))var _0x1b7abb=users[_0x3b7efa(0x27b)];else{if(_0x4ef144[0x0]['language']==_0x3b7efa(0x242))var _0x1b7abb=users[_0x3b7efa(0x251)];else{if(_0x4ef144[0x0][_0x3b7efa(0x1c4)]==_0x3b7efa(0x293))var _0x1b7abb=users[_0x3b7efa(0x293)];else{if(_0x4ef144[0x0][_0x3b7efa(0x1c4)]==_0x3b7efa(0x238))var _0x1b7abb=users['Arabic'];}}}}}}}const _0x2facab=getRandom8DigitNumber();_0x2facab[_0x3b7efa(0x1dd)](_0x4ae16b=>{var _0x3e5acf=_0x3b7efa;_0x4a50d6[_0x3e5acf(0x21a)]('add_sales_finished_logs',{'success':_0x39b59b[_0x3e5acf(0x253)](_0x3e5acf(0x227)),'errors':_0x39b59b[_0x3e5acf(0x253)]('errors'),'role':_0x509e31,'profile':_0x5cfe41,'customer':_0x3d0ed3,'warehouse':_0xd29b1,'product':_0x3d4f30,'invoice':_0x4ae16b,'master_shop':_0x4ef144,'language':_0x1b7abb,'rooms_data':_0x5ef4de});})[_0x3b7efa(0x24e)](_0x167aaf=>{var _0x2b9c7c=_0x3b7efa;_0x39b59b[_0x2b9c7c(0x253)]('errors',_0x2b9c7c(0x29d)),_0x4a50d6[_0x2b9c7c(0x1e9)](_0x2b9c7c(0x2b0));});}catch(_0x39f3b0){console['log'](_0x39f3b0);}}),router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x277),auth,async(_0x5b7645,_0x16c161)=>{var _0x36ab55=a0_0x4a5a05;try{const {invoice:_0x5beb8c,date:_0x513071,warehouse_name:_0x9a5eaf,product_name:_0x1f7ba6,note:_0x59f91a,room:_0x1cfb07,primary_code:_0x307660,secondary_code:_0x306a85,prod_code:_0x593a85,SCRN:_0x445d7d,ReqBy:_0x1f84de,dateofreq:_0x2037c4,PO_number:_0x5991b2,typeservicesData:_0x1e186f,typevehicle:_0x13c22f,destination:_0x19c842,deliverydate:_0x5952ca,driver:_0x28bd99,plate:_0x57c7c6,van:_0x39b1e3,DRSI:_0x5900c6,TSU:_0xe51ad5,TFU:_0x16cf43,mode_transpo:_0x2baa1b,name_driver:_0x2d4d7c,type_of_products:_0x42f7b9}=_0x5b7645[_0x36ab55(0x205)];if(typeof _0x1f7ba6=='string')var _0x484c5a=[_0x5b7645['body'][_0x36ab55(0x1bb)]],_0x4613c2=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x2b7)]],_0x19efc3=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x267)]],_0x4c9f90=[_0x5b7645['body'][_0x36ab55(0x2c9)]],_0x137cca=[_0x5b7645['body'][_0x36ab55(0x241)]],_0x391de6=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x21e)]],_0x2c72fd=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1eb)]],_0x207751=[_0x5b7645['body'][_0x36ab55(0x1cf)]],_0x642fdf=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x21c)]],_0x509951=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x2bb)]],_0x344f43=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x29a)]],_0x491f3f=[_0x5b7645['body'][_0x36ab55(0x25d)]],_0x332808=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x2ab)]],_0x529c4e=[_0x5b7645[_0x36ab55(0x205)]['prod_cat']],_0x1c1b8f=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x298)]],_0x550cee=[_0x5b7645['body'][_0x36ab55(0x292)]],_0x42e983=[_0x5b7645[_0x36ab55(0x205)]['id_transaction_from']],_0x1bad68=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1d6)]],_0x4277a3=[_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x285)]];else var _0x484c5a=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1bb)]],_0x4613c2=[..._0x5b7645['body'][_0x36ab55(0x2b7)]],_0x19efc3=[..._0x5b7645['body']['carton']],_0x4c9f90=[..._0x5b7645['body']['primary_code']],_0x137cca=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x241)]],_0x391de6=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x21e)]],_0x2c72fd=[..._0x5b7645['body']['level2']],_0x207751=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1cf)]],_0x642fdf=[..._0x5b7645['body'][_0x36ab55(0x21c)]],_0x509951=[..._0x5b7645[_0x36ab55(0x205)]['batch_code']],_0x344f43=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x29a)]],_0x491f3f=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x25d)]],_0x332808=[..._0x5b7645['body'][_0x36ab55(0x2ab)]],_0x529c4e=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1b5)]],_0x1c1b8f=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x298)]],_0x550cee=[..._0x5b7645['body'][_0x36ab55(0x292)]],_0x42e983=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1bd)]],_0x1bad68=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x1d6)]],_0x4277a3=[..._0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x285)]];const _0x8aa5b3=_0x484c5a[_0x36ab55(0x257)](_0x1df6a3=>{return _0x1df6a3={'product_name':_0x1df6a3};});_0x4613c2[_0x36ab55(0x26e)]((_0x2007f8,_0x59ada1)=>{var _0x2ec76c=_0x36ab55;_0x8aa5b3[_0x59ada1][_0x2ec76c(0x2b7)]=_0x2007f8;}),_0x19efc3['forEach']((_0x38467a,_0x1eb179)=>{var _0x348d00=_0x36ab55;_0x8aa5b3[_0x1eb179][_0x348d00(0x2a2)]=Math[_0x348d00(0x1d7)](_0x38467a);}),_0x484c5a[_0x36ab55(0x26e)]((_0x2b9d78,_0x2379b0)=>{_0x8aa5b3[_0x2379b0]['agent_id']=_0x5b7645['body']['sales'];}),_0x4277a3[_0x36ab55(0x26e)]((_0x426a79,_0x4faee1)=>{_0x8aa5b3[_0x4faee1]['gross_price']=_0x426a79;}),_0x1bad68[_0x36ab55(0x26e)]((_0x5c1023,_0x5d1cef)=>{var _0x4f16c9=_0x36ab55;_0x8aa5b3[_0x5d1cef][_0x4f16c9(0x1d6)]=_0x5c1023;}),_0x42e983[_0x36ab55(0x26e)]((_0x2ed2ba,_0x680d9e)=>{var _0x3da4b5=_0x36ab55;_0x8aa5b3[_0x680d9e][_0x3da4b5(0x1bd)]=_0x2ed2ba;}),_0x4c9f90[_0x36ab55(0x26e)]((_0x4fd428,_0x1a86c9)=>{var _0x443f87=_0x36ab55;_0x8aa5b3[_0x1a86c9][_0x443f87(0x2c9)]=_0x4fd428;}),_0x137cca['forEach']((_0x3d7e1b,_0x5e1209)=>{var _0x562dcc=_0x36ab55;_0x8aa5b3[_0x5e1209][_0x562dcc(0x241)]=_0x3d7e1b;}),_0x391de6[_0x36ab55(0x26e)]((_0x144497,_0x3a42f3)=>{var _0x1bba3e=_0x36ab55;_0x8aa5b3[_0x3a42f3][_0x1bba3e(0x255)]=_0x144497;}),_0x2c72fd[_0x36ab55(0x26e)]((_0x17f490,_0xbf8232)=>{var _0x3a0590=_0x36ab55,_0x36dcaf=_0x17f490['match'](/[A-Za-z]+/)[0x0],_0xc08024=parseInt(_0x17f490[_0x3a0590(0x2ba)](/\d+/)[0x0]);_0x8aa5b3[_0xbf8232][_0x3a0590(0x28d)]=_0xc08024,_0x8aa5b3[_0xbf8232]['level']=_0x36dcaf;}),_0x207751[_0x36ab55(0x26e)]((_0x14b791,_0x5bafee)=>{var _0x4a6de7=_0x36ab55;_0x8aa5b3[_0x5bafee][_0x4a6de7(0x22d)]=_0x14b791;}),_0x642fdf['forEach']((_0x1a67dd,_0x1a78c2)=>{var _0x18ede8=_0x36ab55;_0x8aa5b3[_0x1a78c2][_0x18ede8(0x21c)]=_0x1a67dd;}),_0x509951['forEach']((_0x109d17,_0x17f428)=>{var _0x4911fe=_0x36ab55;_0x8aa5b3[_0x17f428][_0x4911fe(0x2bb)]=_0x109d17;}),_0x344f43['forEach']((_0x4a8cf5,_0x43a066)=>{var _0x2c8344=_0x36ab55;_0x8aa5b3[_0x43a066][_0x2c8344(0x29a)]=_0x4a8cf5;}),_0x491f3f[_0x36ab55(0x26e)]((_0x3df94a,_0x5e7759)=>{var _0x1f5f35=_0x36ab55;_0x8aa5b3[_0x5e7759][_0x1f5f35(0x299)]=_0x3df94a;}),_0x332808[_0x36ab55(0x26e)]((_0x273d26,_0x265eb2)=>{var _0xc9133f=_0x36ab55;_0x8aa5b3[_0x265eb2][_0xc9133f(0x1c5)]=_0x273d26;}),_0x529c4e[_0x36ab55(0x26e)]((_0x30096f,_0x53fe07)=>{var _0xb503f5=_0x36ab55;_0x8aa5b3[_0x53fe07][_0xb503f5(0x1b5)]=_0x30096f;}),_0x1c1b8f[_0x36ab55(0x26e)]((_0x669b9,_0x17a258)=>{var _0x572180=_0x36ab55;_0x8aa5b3[_0x17a258][_0x572180(0x230)]=_0x669b9;}),_0x550cee[_0x36ab55(0x26e)]((_0x119a29,_0x1addd8)=>{var _0x302f81=_0x36ab55;_0x8aa5b3[_0x1addd8][_0x302f81(0x1c8)]=_0x119a29,_0x8aa5b3[_0x1addd8][_0x302f81(0x1f9)]=_0x513071;});const _0x1454f9=new sales_logs();await _0x1454f9[_0x36ab55(0x2b4)](),_0x550cee['forEach']((_0x2d39b9,_0x5de568)=>{var _0x42b54f=_0x36ab55;_0x8aa5b3[_0x5de568][_0x42b54f(0x244)]=_0x42b54f(0x259)+_0x1454f9[_0x42b54f(0x229)][_0x42b54f(0x1d1)]()[_0x42b54f(0x1f1)](0x8,'0');});var _0x1ed4af=0x0;_0x8aa5b3[_0x36ab55(0x26e)](_0x1d4e4e=>{var _0x14d329=_0x36ab55;parseFloat(_0x1d4e4e[_0x14d329(0x2b7)])<parseFloat(_0x1d4e4e[_0x14d329(0x2a2)])&&parseFloat(_0x1d4e4e[_0x14d329(0x2a2)])>parseFloat(_0x1d4e4e[_0x14d329(0x2b7)])&&(console[_0x14d329(0x28a)](_0x1d4e4e[_0x14d329(0x2b7)]+_0x14d329(0x284)+_0x1d4e4e[_0x14d329(0x2a2)]),_0x1ed4af++);});if(_0x1ed4af!=0x0)return _0x5b7645[_0x36ab55(0x253)](_0x36ab55(0x1ff),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x16c161[_0x36ab55(0x1e9)](_0x36ab55(0x236));const _0x3387ef=_0x8aa5b3[_0x36ab55(0x206)](_0x1e5ead=>_0x1e5ead[_0x36ab55(0x2a2)]!=='0'&&_0x1e5ead[_0x36ab55(0x2a2)]!==''),_0x3659c6=new sales_finished({'invoice':_0x36ab55(0x259)+_0x1454f9[_0x36ab55(0x229)][_0x36ab55(0x1d1)]()[_0x36ab55(0x1f1)](0x8,'0'),'sales_data':_0x5b7645[_0x36ab55(0x205)][_0x36ab55(0x2b3)],'customer':_0x5b7645['body'][_0x36ab55(0x207)],'date':_0x513071,'warehouse_name':_0x9a5eaf,'sale_product':_0x3387ef,'note':_0x59f91a,'room':_0x1cfb07,'primary_code':_0x307660,'secondary_code':_0x306a85,'prod_code':_0x593a85,'SCRN':_0x445d7d,'finalize':'False','mode_transpo':_0x2baa1b,'name_driver':_0x2d4d7c,'ReqBy':_0x1f84de,'dateofreq':_0x2037c4,'PO_number':_0x5991b2,'typeservicesData':_0x1e186f,'typevehicle':_0x13c22f,'destination':_0x19c842,'deliverydate':_0x5952ca,'driver':_0x28bd99,'plate':_0x57c7c6,'van':_0x39b1e3,'DRSI':_0x5900c6,'TSU':_0xe51ad5,'TFU':_0x16cf43,'typeOfProducts':_0x42f7b9}),_0x31dcf1=await _0x3659c6[_0x36ab55(0x2b4)](),_0x549478=await sales_finished[_0x36ab55(0x286)]({'invoice':_0x5beb8c});_0x5b7645[_0x36ab55(0x253)](_0x36ab55(0x227),_0x36ab55(0x252)),_0x16c161[_0x36ab55(0x1e9)]('/all_sales_finished/preview/'+_0x31dcf1[_0x36ab55(0x262)]);}catch(_0x27e268){console[_0x36ab55(0x28a)](_0x27e268);}}),router[a0_0x4a5a05(0x25f)]('/view/add_sales/:id',auth,async(_0x3216e0,_0x233fe7)=>{var _0x446719=a0_0x4a5a05;try{const _0x404c87=_0x3216e0[_0x446719(0x296)]['id'];console['log'](_0x404c87);const _0x535ea1=await product['find'](),_0x4cba25=await purchases['aggregate']([{'$match':{'warehouse_name':_0x404c87}},{'$unwind':_0x446719(0x1df)},{'$group':{'_id':_0x446719(0x2c7)}}]);console[_0x446719(0x28a)](_0x446719(0x26d),_0x4cba25),_0x233fe7[_0x446719(0x26a)](0xc8)[_0x446719(0x1c9)]({'purchases_data':_0x4cba25,'product_data':_0x535ea1});}catch(_0x1e5000){console[_0x446719(0x28a)](_0x1e5000);}}),router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x283),auth,async(_0x44fa8b,_0x17a192)=>{var _0xedbd92=a0_0x4a5a05;try{const {warehouse_data:_0x37c00c,product_data:_0x25b877}=_0x44fa8b[_0xedbd92(0x205)];console[_0xedbd92(0x28a)](_0x44fa8b[_0xedbd92(0x205)]['product_data']);;const _0x3f433f=await master_shop[_0xedbd92(0x20d)]();console[_0xedbd92(0x28a)]('master',_0x3f433f);const _0x51740c=await product[_0xedbd92(0x286)]({'name':_0x25b877});console['log']('product',_0x51740c);const _0x2e44b0=await warehouse[_0xedbd92(0x1fd)]([{'$match':{'name':_0x37c00c}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x25b877}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0xedbd92(0x2c3)}}}]);console[_0xedbd92(0x28a)](_0xedbd92(0x2ca),_0x2e44b0),_0x17a192['status'](0xc8)[_0xedbd92(0x1c9)]({'master':_0x3f433f,'new_product':_0x51740c,'stock_data':_0x2e44b0});}catch(_0x1e39f7){console[_0xedbd92(0x28a)](_0x1e39f7);}}),router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x290),auth,async(_0x4ad895,_0x3f33af)=>{var _0x54e820=a0_0x4a5a05;try{const {invoice:_0x129f23,date:_0x5ec65a,warehouse_name:_0x36afdc,product_name:_0x2a423e,note:_0x3567c8,room:_0x40045a,primary_code:_0x156cbd,secondary_code:_0x561afb,prod_code:_0x4bbdb5,SCRN:_0x547ed0,ReqBy:_0xca3ac1,dateofreq:_0x37a32b,PO_number:_0xe68036,typeservicesData:_0x37acd3,typevehicle:_0x4ff74d,destination:_0x75f2b,deliverydate:_0x4d9003,driver:_0x369a0c,plate:_0x4b2b09,van:_0x338514,DRSI:_0x2806a5,TSU:_0x244ed9,TFU:_0x1ec74e,mode_transpo:_0x1b99ba,name_driver:_0x5a8917,pull_out_date:_0x286c29,actual_delivery_date:_0x3a2ce3}=_0x4ad895[_0x54e820(0x205)];if(typeof _0x2a423e==_0x54e820(0x1c2))var _0x592e49=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x1bb)]],_0xc877bb=[_0x4ad895['body'][_0x54e820(0x2b7)]],_0x55cf57=[_0x4ad895[_0x54e820(0x205)]['carton']],_0x4e5fe7=[_0x4ad895[_0x54e820(0x205)]['primary_code']],_0x1dc390=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x241)]],_0x2f88ba=[_0x4ad895['body'][_0x54e820(0x21e)]],_0x2bb194=[_0x4ad895['body'][_0x54e820(0x1eb)]],_0x385e3b=[_0x4ad895['body']['primary_unit']],_0x4bf31c=[_0x4ad895['body'][_0x54e820(0x21c)]],_0x4fd008=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x2bb)]],_0x4bb6b0=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x29a)]],_0x13c120=[_0x4ad895['body'][_0x54e820(0x25d)]],_0x94277d=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x2ab)]],_0x5e0e31=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x1b5)]],_0x626c8d=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x298)]],_0x412ada=[_0x4ad895['body']['prod_invoice']],_0x2db99c=[_0x4ad895[_0x54e820(0x205)][_0x54e820(0x1bd)]],_0x4f7e66=[_0x4ad895['body']['uuid']],_0xb2b32a=[_0x4ad895[_0x54e820(0x205)]['gross_price']];else var _0x592e49=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x1bb)]],_0xc877bb=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x2b7)]],_0x55cf57=[..._0x4ad895[_0x54e820(0x205)]['carton']],_0x4e5fe7=[..._0x4ad895['body']['primary_code']],_0x1dc390=[..._0x4ad895[_0x54e820(0x205)]['secondary_code']],_0x2f88ba=[..._0x4ad895['body'][_0x54e820(0x21e)]],_0x2bb194=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x1eb)]],_0x385e3b=[..._0x4ad895['body'][_0x54e820(0x1cf)]],_0x4bf31c=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x21c)]],_0x4fd008=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x2bb)]],_0x4bb6b0=[..._0x4ad895[_0x54e820(0x205)]['expiry_date']],_0x13c120=[..._0x4ad895['body'][_0x54e820(0x25d)]],_0x94277d=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x2ab)]],_0x5e0e31=[..._0x4ad895['body']['prod_cat']],_0x626c8d=[..._0x4ad895[_0x54e820(0x205)]['RoomAssigned']],_0x412ada=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x292)]],_0x2db99c=[..._0x4ad895['body'][_0x54e820(0x1bd)]],_0x4f7e66=[..._0x4ad895['body'][_0x54e820(0x1d6)]],_0xb2b32a=[..._0x4ad895[_0x54e820(0x205)][_0x54e820(0x285)]];const _0x550745=_0x592e49[_0x54e820(0x257)](_0x24aec4=>{return _0x24aec4={'product_name':_0x24aec4};});_0xc877bb[_0x54e820(0x26e)]((_0x579324,_0x34bcdf)=>{_0x550745[_0x34bcdf]['stock']=_0x579324;}),_0x55cf57[_0x54e820(0x26e)]((_0x139ce9,_0xaae594)=>{var _0x1916a7=_0x54e820;_0x550745[_0xaae594][_0x1916a7(0x2a2)]=Math['abs'](_0x139ce9);}),_0x592e49[_0x54e820(0x26e)]((_0x45648f,_0x53a53b)=>{var _0x4a1a4a=_0x54e820;_0x550745[_0x53a53b][_0x4a1a4a(0x246)]=_0x4ad895['body'][_0x4a1a4a(0x2b3)];}),_0xb2b32a[_0x54e820(0x26e)]((_0x20590,_0x50ad02)=>{var _0x27780a=_0x54e820;_0x550745[_0x50ad02][_0x27780a(0x285)]=_0x20590;}),_0x4f7e66[_0x54e820(0x26e)]((_0xa68548,_0x493a71)=>{_0x550745[_0x493a71]['uuid']=_0xa68548;}),_0x2db99c[_0x54e820(0x26e)]((_0x4cb399,_0x131d47)=>{var _0x2fce02=_0x54e820;_0x550745[_0x131d47][_0x2fce02(0x1bd)]=_0x4cb399;}),_0x4e5fe7[_0x54e820(0x26e)]((_0x1e891e,_0x214ca0)=>{_0x550745[_0x214ca0]['primary_code']=_0x1e891e;}),_0x1dc390[_0x54e820(0x26e)]((_0x3fcb27,_0x48c3ed)=>{_0x550745[_0x48c3ed]['secondary_code']=_0x3fcb27;}),_0x2f88ba[_0x54e820(0x26e)]((_0x5bb27f,_0x52d9ff)=>{var _0x2cb415=_0x54e820;_0x550745[_0x52d9ff][_0x2cb415(0x255)]=_0x5bb27f;}),_0x2bb194[_0x54e820(0x26e)]((_0x1be0a7,_0x232a0b)=>{var _0x481792=_0x54e820,_0x138219=_0x1be0a7[_0x481792(0x2ba)](/[A-Za-z]+/)[0x0],_0x3c17b6=parseInt(_0x1be0a7[_0x481792(0x2ba)](/\d+/)[0x0]);_0x550745[_0x232a0b][_0x481792(0x28d)]=_0x3c17b6,_0x550745[_0x232a0b][_0x481792(0x287)]=_0x138219;}),_0x385e3b[_0x54e820(0x26e)]((_0x536033,_0x3d0be0)=>{var _0x15ce59=_0x54e820;_0x550745[_0x3d0be0][_0x15ce59(0x22d)]=_0x536033;}),_0x4bf31c[_0x54e820(0x26e)]((_0x4abd79,_0x572cfc)=>{var _0x670a83=_0x54e820;_0x550745[_0x572cfc][_0x670a83(0x21c)]=_0x4abd79;}),_0x4fd008['forEach']((_0x5a0a44,_0x492a2f)=>{_0x550745[_0x492a2f]['batch_code']=_0x5a0a44;}),_0x4bb6b0['forEach']((_0x355754,_0xf49ced)=>{var _0x59f16b=_0x54e820;_0x550745[_0xf49ced][_0x59f16b(0x29a)]=_0x355754;}),_0x13c120['forEach']((_0x2029e3,_0x10609f)=>{_0x550745[_0x10609f]['production_date']=_0x2029e3;}),_0x94277d[_0x54e820(0x26e)]((_0x227f62,_0x4c29b2)=>{var _0x3d0a61=_0x54e820;_0x550745[_0x4c29b2][_0x3d0a61(0x1c5)]=_0x227f62;}),_0x5e0e31['forEach']((_0x11839d,_0x28693b)=>{var _0x3113a4=_0x54e820;_0x550745[_0x28693b][_0x3113a4(0x1b5)]=_0x11839d;}),_0x626c8d['forEach']((_0x23c611,_0x146ab8)=>{var _0x4a812e=_0x54e820;_0x550745[_0x146ab8][_0x4a812e(0x230)]=_0x23c611;}),_0x412ada[_0x54e820(0x26e)]((_0x1bca73,_0x7e7751)=>{var _0x7fe6db=_0x54e820;_0x550745[_0x7e7751][_0x7fe6db(0x1c8)]=_0x1bca73,_0x550745[_0x7e7751][_0x7fe6db(0x1f9)]=_0x5ec65a;});const _0x29dce5=new invoice_for_outgoing();await _0x29dce5['save'](),_0x412ada['forEach']((_0x184e4b,_0x3e02e0)=>{var _0x12d77e=_0x54e820;_0x550745[_0x3e02e0]['outgoing_invoice']=_0x12d77e(0x1bc)+_0x29dce5['invoice_init'][_0x12d77e(0x1d1)]()[_0x12d77e(0x1f1)](0x8,'0');});var _0x3c8896=0x0;_0x550745['forEach'](_0x2a273e=>{var _0x3f8198=_0x54e820;parseFloat(_0x2a273e[_0x3f8198(0x2b7)])<parseFloat(_0x2a273e[_0x3f8198(0x2a2)])&&parseFloat(_0x2a273e[_0x3f8198(0x2a2)])>parseFloat(_0x2a273e[_0x3f8198(0x2b7)])&&(console[_0x3f8198(0x28a)](_0x2a273e['stock']+_0x3f8198(0x284)+_0x2a273e[_0x3f8198(0x2a2)]),_0x3c8896++);});if(_0x3c8896!=0x0)return _0x4ad895[_0x54e820(0x253)](_0x54e820(0x1ff),_0x54e820(0x1ea)),_0x3f33af[_0x54e820(0x1e9)](_0x54e820(0x236));const _0x3ff19e=_0x550745['filter'](_0x369efe=>_0x369efe['quantity']!=='0'&&_0x369efe['quantity']!==''),_0x4d7347=new sales_finished({'invoice':_0x54e820(0x1bc)+_0x29dce5[_0x54e820(0x229)][_0x54e820(0x1d1)]()[_0x54e820(0x1f1)](0x8,'0'),'sales_data':_0x4ad895[_0x54e820(0x205)][_0x54e820(0x2b3)],'customer':_0x4ad895[_0x54e820(0x205)][_0x54e820(0x207)],'date':_0x5ec65a,'warehouse_name':_0x36afdc,'sale_product':_0x3ff19e,'note':_0x3567c8,'room':_0x40045a,'primary_code':_0x156cbd,'secondary_code':_0x561afb,'prod_code':_0x4bbdb5,'SCRN':_0x547ed0,'finalize':_0x54e820(0x1d4),'mode_transpo':_0x1b99ba,'name_driver':_0x5a8917,'ReqBy':_0xca3ac1,'dateofreq':_0x37a32b,'PO_number':_0xe68036,'typeservicesData':_0x37acd3,'typevehicle':_0x4ff74d,'destination':_0x75f2b,'deliverydate':_0x4d9003,'driver':_0x369a0c,'plate':_0x4b2b09,'van':_0x338514,'DRSI':_0x2806a5,'TSU':_0x244ed9,'TFU':_0x1ec74e,'pullout_date':_0x286c29,'actualdelivery_date':_0x3a2ce3,'typeOfProducts':_0x54e820(0x228)}),_0x269674=await _0x4d7347[_0x54e820(0x2b4)](),_0x562425=await sales_finished[_0x54e820(0x286)]({'invoice':_0x129f23});_0x4ad895[_0x54e820(0x253)]('success',_0x54e820(0x252)),_0x3f33af[_0x54e820(0x1e9)]('/all_sales_finished/preview/'+_0x269674[_0x54e820(0x262)]);}catch(_0x5b5eb9){console[_0x54e820(0x28a)](_0x5b5eb9);}}),router[a0_0x4a5a05(0x25f)](a0_0x4a5a05(0x294),auth,async(_0x41830a,_0x5a3fe8)=>{var _0x348680=a0_0x4a5a05;try{const {username:_0x18fbe4,email:_0x5e071f,role:_0xc4921f}=_0x41830a[_0x348680(0x2af)],_0x4ad986=_0x41830a[_0x348680(0x2af)],_0x55cef6=await profile[_0x348680(0x286)]({'email':_0x4ad986[_0x348680(0x233)]}),_0x3b8f89=await master_shop[_0x348680(0x20d)](),_0x4181d3=_0x41830a[_0x348680(0x296)]['id'],_0xc2e53b=await sales_finished[_0x348680(0x27c)](_0x4181d3),_0x7437e9=await warehouse[_0x348680(0x1fd)]([{'$match':{'name':_0xc2e53b[_0x348680(0x1e8)]}},{'$unwind':_0x348680(0x29c)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x348680(0x223)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x348680(0x2a7)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x348680(0x226)},'floorlevel':{'$first':_0x348680(0x2cc)},'primary_code':{'$first':_0x348680(0x2a6)},'secondary_code':{'$first':_0x348680(0x22b)},'product_code':{'$first':_0x348680(0x1f8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x348680(0x222)},'expiry_date':{'$first':_0x348680(0x1c0)},'production_date':{'$first':_0x348680(0x2c2)},'batch_code':{'$first':_0x348680(0x2cf)},'room':{'$first':_0x348680(0x218)},'room_data':{'$first':'$product_details.room_name'}}}]),_0x55c869=await customer[_0x348680(0x20d)]({});let _0x388068;if(_0x4ad986[_0x348680(0x270)]==_0x348680(0x2c4)){const _0x5416a2=await staff[_0x348680(0x286)]({'email':_0x4ad986[_0x348680(0x233)]});_0x388068=await warehouse[_0x348680(0x1fd)]([{'$match':{'status':_0x348680(0x23b),'name':_0x5416a2[_0x348680(0x1b7)]}},{'$group':{'_id':_0x348680(0x231),'name':{'$first':_0x348680(0x231)}}}]);}else _0x388068=await warehouse[_0x348680(0x1fd)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x348680(0x231)}}}]);const _0x18649c=await product['find']({});if(_0x3b8f89[0x0][_0x348680(0x1c4)]==_0x348680(0x221)){var _0x605813=users[_0x348680(0x1d3)];console[_0x348680(0x28a)](_0x605813);}else{if(_0x3b8f89[0x0][_0x348680(0x1c4)]==_0x348680(0x25a))var _0x605813=users[_0x348680(0x25a)];else{if(_0x3b8f89[0x0][_0x348680(0x1c4)]==_0x348680(0x2cb))var _0x605813=users[_0x348680(0x2cb)];else{if(_0x3b8f89[0x0]['language']==_0x348680(0x235))var _0x605813=users[_0x348680(0x235)];else{if(_0x3b8f89[0x0]['language']=='French')var _0x605813=users[_0x348680(0x27b)];else{if(_0x3b8f89[0x0][_0x348680(0x1c4)]==_0x348680(0x242))var _0x605813=users[_0x348680(0x251)];else{if(_0x3b8f89[0x0][_0x348680(0x1c4)]==_0x348680(0x293))var _0x605813=users[_0x348680(0x293)];else{if(_0x3b8f89[0x0][_0x348680(0x1c4)]==_0x348680(0x238))var _0x605813=users[_0x348680(0x1ec)];}}}}}}}_0x5a3fe8[_0x348680(0x21a)](_0x348680(0x2c5),{'success':_0x41830a[_0x348680(0x253)](_0x348680(0x227)),'errors':_0x41830a[_0x348680(0x253)](_0x348680(0x1ff)),'role':_0x4ad986,'profile':_0x55cef6,'customer':_0x55c869,'warehouse':_0x388068,'product':_0x7437e9,'user':_0xc2e53b,'master_shop':_0x3b8f89,'unit':_0x18649c,'language':_0x605813});}catch(_0x26b232){console[_0x348680(0x28a)](_0x26b232);}});function a0_0xdd45(){var _0x1ba9af=['date','$product_details.level','primary_unit','message','toString','int','English','False','return_data','uuid','abs','valueOf','Return\x20Rooms','split','$note','push','then','</h5>','$product','True','<html><head><title></title>','$date','$product_details.gross_price','floor','add_sales_finished','due_amount','$warehouse_name','warehouse_name','redirect','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','level2','Arabic','logs','getFullYear','return_qty','return_sale','padStart','/barcode_scanner_logs','sendMail','Sale\x20Return\x20Mail','\x20==\x20','maxPerUnit_QA','$sale_product.floorlevel','$product_details.product_code','date_data','39019797RcBdvN','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','aggregate','product_details','errors','maxProducts','<!DOCTYPE\x20html>','$sale_product.quantity','Return\x20Goods','sales_invoice','body','filter','customer','stocks_QA','undefined','getMonth','expiry_date_QA','$_id','find','Error\x20Occurs','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','site_title','/upload/','final','\x20</h2>','barcode\x20Product\x20master','all_sales_finished_logs','logo','secondary_unit_QA','$room','$sale_product','render','sales_quantity_QA','secondary_unit','</td>','prod_code','all_sales_finished','Finished\x20Goods','English\x20(US)','$product_details.rack','$product_details.product_name','$customers_docs','post','$product_details.type','success','own','invoice_init','updateOne','$product_details.secondary_code','slice','unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/barcode/:id','room_name','$name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','email','$product_details.secondary_unit','Spanish','back','5736080nCIftf','Arabic\x20(ae)','/view/:id','<h5\x20style=\x22text-align:\x20left;\x22>','Enabled','length','maxProducts_QA','3102222niDiqL','express','return_sale_finished','secondary_code','Portuguese\x20(BR)','sale_qty','outgoing_invoice','payment\x20successfull','agent_id','master','$product_details.invoice','amount','Sales\x20Update\x20successfully','secondary_code_QA','$product_details.product_cat','<span\x20style=\x22float:\x20right;\x22>','catch','sales\x20item\x20return\x20successfull','$return_data','Portuguese','Sales\x20Add\x20successfully','flash','</tr>','product_code','/../public','map','<tbody\x20style=\x22text-align:\x20center;\x22>','LOG-OUT-','Hindi','here','exports','product_date','$product_details.type_products','get','7102644nTbGoL','/barcode_scanner','_id','sale_product','\x20&&\x20','password','$product_details.sales_category','carton','$invoice','suppliers','status','$product_details._id','</tbody>','purchases_data','forEach','production_date_QA','role','/view/return_sales/:id','110OtFWeo','Router','</div>','getDate','$product_details.maxProducts','/view/add_sales_logs','$product_details.storage','<tr>','</span>','French','findById','sales_quantity','/invoice/:id','unit_QA','concat','<strong>\x20Regards\x20</strong>','for_categorize','/view/add_sale/product','\x20<>\x20','gross_price','findOne','level','/picking_list/pdf/','1172951OIhtea','log','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.type','bay','foreach\x20newproduct','$finalize','/view/add_sales','$product_details.bin','prod_invoice','Chinese','/preview/:id','product_stock','params','adjust_qty','RoomAssigned','production_date','expiry_date','all_sales_barcode','$product_details','There\x27s\x20a\x20error\x20in\x20this\x20transaction','batch_code_QA','../models/all_models','$sale_product.bay','</head><body>','quantity','/give_payment/:id','primary_code_QA','</body></html>','$product_details.primary_code','$product_details.bay','\x20Order\x20Date\x20:\x20','2WyXhjy','$product_details.uuid','max_per_unit','/view','warehouse_id','<hr\x20class=\x22my-3\x22>','user','/all_sales_finished/view','Ambient','/all_sales/view','sales','save','image','random','stock','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','match','batch_code','Logo.png','currency_placement','$product_details.maxPerUnit','OUTF-','<h2>\x20','gmail','$product_details.production_date','$product_details.product_stock','staff','edit_sales_finished_view','finalize','$product.product_name','product_list','primary_code','stock_data','German','$product_details.floorlevel','Sale\x20Return','Quality\x20Inspection','$product_details.batch_code','note','4033414tJEtKf','<h5>','20328nttqwp','maxPerUnit','$product_details.unit','barcode\x20user_id','</table>','prod_cat','../public/language/languages.json','warehouse','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_code_QA','product_name','OUT-','id_transaction_from','return_qty_QA','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','string','$customer','language','maxperunit','\x20Order\x20Number\x20:\x20','room','invoice','json','$sale_product.bin','<div>','received_amount'];a0_0xdd45=function(){return _0x1ba9af;};return a0_0xdd45();}async function dataUpdate(_0x21ae89,_0x474318,_0xe769de){var _0x2d6768=a0_0x4a5a05;return await warehouse[_0x2d6768(0x22a)]({'_id':_0x21ae89,'product_details._id':_0x474318},{'$set':{'product_details.$.product_stock':_0xe769de}}),await warehouse[_0x2d6768(0x27c)](_0x21ae89);}function a0_0x5bef(_0x5bf59c,_0x39c298){var _0xdd455c=a0_0xdd45();return a0_0x5bef=function(_0x5bef9d,_0x4e07ed){_0x5bef9d=_0x5bef9d-0x1b1;var _0x581c46=_0xdd455c[_0x5bef9d];return _0x581c46;},a0_0x5bef(_0x5bf59c,_0x39c298);}router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x294),auth,async(_0x2dd15e,_0x23b6ae)=>{var _0x56f641=a0_0x4a5a05;try{const _0x3b2f26=_0x2dd15e[_0x56f641(0x296)]['id'],{invoice:_0x37ad9d,warehouse_name:_0x126d99,room:_0x3bde03}=_0x2dd15e[_0x56f641(0x205)],_0x1afddb=await sales_finished['findOne']({'invoice':_0x37ad9d});for(let _0x17c421=0x0;_0x17c421<=_0x1afddb[_0x56f641(0x263)]['length']-0x1;_0x17c421++){const _0x194e52=_0x1afddb['sale_product'][_0x17c421];var _0x5b3c42=await warehouse[_0x56f641(0x286)]({'name':_0x126d99,'room':_0x194e52[_0x56f641(0x230)]}),_0x1c0629=0x0;for(let _0x4f7057=0x0;_0x4f7057<=_0x5b3c42[_0x56f641(0x1fe)][_0x56f641(0x23c)]-0x1;_0x4f7057++){const _0x2955f8=_0x5b3c42[_0x56f641(0x1fe)][_0x4f7057];_0x2955f8[_0x56f641(0x262)]==_0x194e52[_0x56f641(0x1bd)]&&_0x2955f8['uuid']==_0x194e52['uuid']&&(_0x1c0629=Math['max'](0x0,Math[_0x56f641(0x1d7)](_0x2955f8[_0x56f641(0x295)])-Math['abs'](_0x194e52[_0x56f641(0x2a2)])),await warehouse[_0x56f641(0x22a)]({'_id':_0x5b3c42[_0x56f641(0x262)][_0x56f641(0x1d8)](),'product_details._id':_0x2955f8['_id']['valueOf'](),'product_details.uuid':_0x194e52['uuid']},{'$set':{'product_details.$.product_stock':_0x1c0629}}));}console[_0x56f641(0x28a)](typeof _0x194e52['agent_id']);if(typeof _0x194e52[_0x56f641(0x246)]!==_0x56f641(0x209)){var _0x5a8ff3=await staff['findById'](_0x194e52[_0x56f641(0x246)]);console[_0x56f641(0x28a)](_0x56f641(0x25b));var _0x5bd820=0x0;for(let _0x1d8210=0x0;_0x1d8210<=_0x5a8ff3[_0x56f641(0x2c8)][_0x56f641(0x23c)]-0x1;_0x1d8210++){const _0x25a23b=_0x5a8ff3['product_list'][_0x1d8210];console['log'](_0x194e52[_0x56f641(0x1bd)]+'\x20==\x20'+_0x25a23b[_0x56f641(0x2ad)]+_0x56f641(0x264)+_0x194e52[_0x56f641(0x262)]+_0x56f641(0x1f5)+_0x194e52[_0x56f641(0x262)]),_0x194e52[_0x56f641(0x1bd)]==_0x25a23b['warehouse_id']&&_0x194e52[_0x56f641(0x262)]==0x1&&(_0x25a23b[_0x56f641(0x295)]=Math['abs'](_0x25a23b[_0x56f641(0x295)])+Math[_0x56f641(0x1d7)](_0x194e52['quantity']),_0x5bd820++);}console['log'](_0x56f641(0x1d2),_0x5bd820),_0x5bd820=='0'&&(_0x5a8ff3[_0x56f641(0x2c8)]=_0x5a8ff3['product_list'][_0x56f641(0x280)]({'product_name':_0x194e52['product_name'],'product_stock':_0x194e52[_0x56f641(0x2a2)],'bay':_0x194e52[_0x56f641(0x28d)],'level':_0x194e52['level'],'product_code':_0x194e52[_0x56f641(0x255)],'primary_code':_0x194e52[_0x56f641(0x2c9)],'secondary_code':_0x194e52['secondary_code'],'expiry_date':_0x194e52[_0x56f641(0x29a)],'production_date':_0x194e52[_0x56f641(0x299)],'maxProducts':_0x194e52['maxProducts'],'batch_code':_0x194e52['batch_code'],'secondary_unit':_0x194e52[_0x56f641(0x21c)],'unit':_0x194e52[_0x56f641(0x22d)],'maxProducts':_0x194e52['maxProducts'],'maxPerUnit':_0x194e52['maxperunit'],'invoice':_0x194e52[_0x56f641(0x1c8)],'warehouse_id':_0x194e52['id_transaction_from'],'id_incoming':_0x194e52[_0x56f641(0x262)],'uuid':_0x194e52[_0x56f641(0x1d6)],'gross_price':_0x194e52[_0x56f641(0x285)],'date_incoming':_0x194e52[_0x56f641(0x1f9)],'outgoing_invoice':_0x194e52[_0x56f641(0x244)]}),await _0x5a8ff3[_0x56f641(0x2b4)]());}}_0x1afddb[_0x56f641(0x2c6)]=_0x56f641(0x1e0);const _0x1af421=await _0x1afddb[_0x56f641(0x2b4)](),_0x3523b3=await master_shop[_0x56f641(0x20d)](),_0x1ccba7=await email_settings['findOne'](),_0xa00fcf=await supervisor_settings[_0x56f641(0x20d)]();var _0x5d2e7b=_0x1afddb['sale_product'],_0x4b7233='',_0x2540b6;for(_0x2540b6 in _0x5d2e7b){_0x4b7233+=_0x56f641(0x279)+_0x56f641(0x22e)+_0x5d2e7b[_0x2540b6]['product_name']+_0x56f641(0x21d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d2e7b[_0x2540b6][_0x56f641(0x255)]+'</td>'+_0x56f641(0x22e)+_0x5d2e7b[_0x2540b6][_0x56f641(0x2a2)]+_0x56f641(0x21d)+_0x56f641(0x22e)+_0x5d2e7b[_0x2540b6][_0x56f641(0x22d)]+_0x56f641(0x21d)+_0x56f641(0x22e)+_0x5d2e7b[_0x2540b6][_0x56f641(0x21c)]+_0x56f641(0x21d)+_0x56f641(0x22e)+_0x1afddb[_0x56f641(0x1e8)]+_0x56f641(0x21d)+_0x56f641(0x22e)+_0x5d2e7b[_0x2540b6][_0x56f641(0x230)]+_0x56f641(0x21d)+_0x56f641(0x22e)+_0x5d2e7b[_0x2540b6]['bay']+_0x56f641(0x21d);}_0x2dd15e[_0x56f641(0x253)]('success',_0x56f641(0x24a)),_0x23b6ae[_0x56f641(0x1e9)](_0x56f641(0x288)+_0x3b2f26);}catch(_0x17caa9){console[_0x56f641(0x28a)](_0x17caa9);}}),router[a0_0x4a5a05(0x25f)](a0_0x4a5a05(0x239),auth,async(_0x3485e5,_0xcc5c7b)=>{var _0x298e23=a0_0x4a5a05;try{const {username:_0x4dc37b,email:_0x34cc5c,role:_0x429c12}=_0x3485e5[_0x298e23(0x2af)],_0xf46fb6=_0x3485e5[_0x298e23(0x2af)],_0x1c7789=await profile[_0x298e23(0x286)]({'email':_0xf46fb6[_0x298e23(0x233)]}),_0x3ec807=await master_shop['find'](),_0x569aed=_0x3485e5[_0x298e23(0x296)]['id'],_0x320add=await sales_finished[_0x298e23(0x27c)](_0x569aed);let _0x357d8d=new Date(_0x320add[_0x298e23(0x29a)]),_0x263420=('0'+_0x357d8d[_0x298e23(0x275)]())[_0x298e23(0x22c)](-0x2),_0x2a983f=('0'+(_0x357d8d[_0x298e23(0x20a)]()+0x1))['slice'](-0x2),_0x531657=_0x357d8d[_0x298e23(0x1ee)](),_0x3a0265=_0x531657+'-'+_0x2a983f+'-'+_0x263420;var _0x539bc1=[_0x298e23(0x2b1),_0x298e23(0x1fb)];const _0x5eb144=await warehouse['aggregate']([{'$match':{'name':_0x320add[_0x298e23(0x1e8)],'room':_0x320add[_0x298e23(0x1c7)]}},{'$unwind':_0x298e23(0x29c)},{'$group':{'_id':_0x298e23(0x26b),'name':{'$first':_0x298e23(0x223)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x298e23(0x2a7)},'bin':{'$first':_0x298e23(0x291)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x298e23(0x2a6)},'secondary_code':{'$first':_0x298e23(0x22b)},'product_code':{'$first':_0x298e23(0x1f8)},'storage':{'$first':_0x298e23(0x278)},'rack':{'$first':_0x298e23(0x222)}}}]),_0xdb415=await customer[_0x298e23(0x20d)]({});let _0x257498;if(_0xf46fb6['role']==_0x298e23(0x2c4)){const _0x2acdfe=await staff['findOne']({'email':_0xf46fb6[_0x298e23(0x233)]});_0x257498=await warehouse['aggregate']([{'$match':{'status':_0x298e23(0x23b),'name':_0x2acdfe[_0x298e23(0x1b7)]}},{'$group':{'_id':_0x298e23(0x231),'name':{'$first':'$name'}}}]);}else _0x257498=await warehouse[_0x298e23(0x1fd)]([{'$match':{'status':_0x298e23(0x23b)}},{'$group':{'_id':_0x298e23(0x231),'name':{'$first':_0x298e23(0x231)}}}]);const _0x2b726a=await product[_0x298e23(0x20d)]({});if(_0x3ec807[0x0][_0x298e23(0x1c4)]==_0x298e23(0x221)){var _0x58404d=users[_0x298e23(0x1d3)];console[_0x298e23(0x28a)](_0x58404d);}else{if(_0x3ec807[0x0][_0x298e23(0x1c4)]==_0x298e23(0x25a))var _0x58404d=users[_0x298e23(0x25a)];else{if(_0x3ec807[0x0]['language']==_0x298e23(0x2cb))var _0x58404d=users['German'];else{if(_0x3ec807[0x0][_0x298e23(0x1c4)]==_0x298e23(0x235))var _0x58404d=users[_0x298e23(0x235)];else{if(_0x3ec807[0x0][_0x298e23(0x1c4)]==_0x298e23(0x27b))var _0x58404d=users[_0x298e23(0x27b)];else{if(_0x3ec807[0x0][_0x298e23(0x1c4)]=='Portuguese\x20(BR)')var _0x58404d=users[_0x298e23(0x251)];else{if(_0x3ec807[0x0][_0x298e23(0x1c4)]==_0x298e23(0x293))var _0x58404d=users[_0x298e23(0x293)];else{if(_0x3ec807[0x0][_0x298e23(0x1c4)]==_0x298e23(0x238))var _0x58404d=users[_0x298e23(0x1ec)];}}}}}}}_0xcc5c7b[_0x298e23(0x21a)]('edit_sales_finished',{'success':_0x3485e5[_0x298e23(0x253)](_0x298e23(0x227)),'errors':_0x3485e5[_0x298e23(0x253)](_0x298e23(0x1ff)),'role':_0xf46fb6,'profile':_0x1c7789,'customer':_0xdb415,'warehouse':_0x257498,'product':_0x5eb144,'user':_0x320add,'master_shop':_0x3ec807,'unit':_0x2b726a,'language':_0x58404d,'rooms_data':_0x539bc1,'ed_fullDate':_0x3a0265});}catch(_0x1bda6f){console['log'](_0x1bda6f);}}),router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x239),auth,async(_0x294ea5,_0x41ee96)=>{var _0x118ea5=a0_0x4a5a05;try{const _0x146e60=_0x294ea5[_0x118ea5(0x296)]['id'],_0x4a5136=await sales_finished[_0x118ea5(0x286)]({'_id':_0x294ea5[_0x118ea5(0x296)]['id']}),_0x2f1e22=await warehouse[_0x118ea5(0x286)]({'name':_0x4a5136[_0x118ea5(0x1e8)],'room':_0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x1c7)],'warehouse_category':_0x118ea5(0x220)}),{invoice:_0x272337,customer:_0x162dae,date:_0x2ba035,warehouse_name:_0x38543f,product_name:_0x4aa9d7,stock:_0xb68f2e,adjust_qty:_0x229b6f,note:_0x4b21d5,room:_0x2ef95b,primary_code:_0xa178,secondary_code:_0x3a3f8d,prod_code:_0x25cf90,level:_0x6e645f,isle:_0x4a5303,pallet:_0x3fabc8,expiry_date:_0x5677a8}=_0x294ea5[_0x118ea5(0x205)];if(typeof _0x4aa9d7==_0x118ea5(0x1c2))var _0x584a8c=[_0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x1bb)]],_0x524fb4=[_0x294ea5['body'][_0x118ea5(0x2b7)]],_0xbb9fe1=[_0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x297)]],_0x1a76a1=[_0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x2c9)]],_0x15663c=[_0x294ea5[_0x118ea5(0x205)]['secondary_code']],_0x314d5c=[_0x294ea5[_0x118ea5(0x205)]['prod_code']],_0x2b0d86=[_0x294ea5['body'][_0x118ea5(0x287)]],_0x5904a2=[_0x294ea5['body'][_0x118ea5(0x29a)]];else var _0x584a8c=[..._0x294ea5['body'][_0x118ea5(0x1bb)]],_0x524fb4=[..._0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x2b7)]],_0xbb9fe1=[..._0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x297)]],_0x1a76a1=[..._0x294ea5[_0x118ea5(0x205)]['primary_code']],_0x15663c=[..._0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x241)]],_0x314d5c=[..._0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x21e)]],_0x2b0d86=[..._0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x287)]],_0x5904a2=[..._0x294ea5[_0x118ea5(0x205)]['expiry_date']];const _0x3f2452=_0x584a8c[_0x118ea5(0x257)](_0x5b438b=>{return _0x5b438b={'product_name':_0x5b438b};});_0x524fb4[_0x118ea5(0x26e)]((_0x58b418,_0x5eae1d)=>{var _0x1b2ffb=_0x118ea5;_0x3f2452[_0x5eae1d][_0x1b2ffb(0x2b7)]=_0x58b418;}),_0xbb9fe1['forEach']((_0x4cec1,_0x3713ee)=>{_0x3f2452[_0x3713ee]['quantity']=_0x4cec1;}),_0x1a76a1['forEach']((_0x19d11e,_0x35736a)=>{_0x3f2452[_0x35736a]['primary_code']=_0x19d11e;}),_0x15663c[_0x118ea5(0x26e)]((_0x140c7a,_0x3d6d48)=>{var _0x203140=_0x118ea5;_0x3f2452[_0x3d6d48][_0x203140(0x241)]=_0x140c7a;}),_0x314d5c[_0x118ea5(0x26e)]((_0x2bebf0,_0x3fd723)=>{var _0x34d95a=_0x118ea5;_0x3f2452[_0x3fd723][_0x34d95a(0x255)]=_0x2bebf0;}),_0x2b0d86['forEach']((_0x4412e7,_0x1bff3a)=>{_0x3f2452[_0x1bff3a]['level']=_0x4412e7;}),_0x5904a2[_0x118ea5(0x26e)]((_0x901c7f,_0x5da548)=>{_0x3f2452[_0x5da548]['expiry_date']=_0x901c7f;});var _0x50023e=0x0;_0x3f2452[_0x118ea5(0x26e)](_0x2d98fe=>{var _0x3c89d6=_0x118ea5;console[_0x3c89d6(0x28a)](_0x3c89d6(0x28e),_0x2d98fe),(parseInt(_0x2d98fe[_0x3c89d6(0x2b7)])<parseInt(_0x2d98fe['quantity'])||parseInt(_0x2d98fe[_0x3c89d6(0x2a2)])==0x0)&&_0x50023e++;});if(_0x50023e!=0x0)return _0x294ea5[_0x118ea5(0x253)](_0x118ea5(0x1ff),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x41ee96[_0x118ea5(0x1e9)]('back');_0x4a5136[_0x118ea5(0x263)][_0x118ea5(0x26e)](_0x1282cf=>{var _0x1cbc19=_0x118ea5;const _0x4753a3=_0x2f1e22[_0x1cbc19(0x1fe)]['map'](_0xdec73e=>{var _0x15d758=_0x1cbc19;_0xdec73e[_0x15d758(0x1bb)]==_0x1282cf[_0x15d758(0x1bb)]&&_0xdec73e[_0x15d758(0x28d)]==_0x1282cf['bay']&&(_0xdec73e['product_stock']=parseInt(_0xdec73e['product_stock'])+parseInt(_0x1282cf[_0x15d758(0x2a2)]));});}),await _0x2f1e22[_0x118ea5(0x2b4)]();const _0x9a37af=_0x3f2452[_0x118ea5(0x206)](_0x77db31=>_0x77db31['quantity']!=='0'&&_0x77db31['quantity']!=='');_0x4a5136['invoice']=_0x272337,_0x4a5136['customer']=_0x162dae,_0x4a5136[_0x118ea5(0x1cd)]=_0x2ba035,_0x4a5136[_0x118ea5(0x1e8)]=_0x38543f,_0x4a5136[_0x118ea5(0x263)]=_0x9a37af,_0x4a5136[_0x118ea5(0x2d0)]=_0x4b21d5,_0x4a5136[_0x118ea5(0x1c7)]=_0x2ef95b;const _0x42f78e=await _0x4a5136['save'](),_0x4b8d80=await sales_finished[_0x118ea5(0x286)]({'_id':_0x294ea5[_0x118ea5(0x296)]['id']}),_0x3a539c=await warehouse[_0x118ea5(0x286)]({'name':_0x38543f,'room':_0x2ef95b,'warehouse_category':_0x118ea5(0x220)});_0x4b8d80[_0x118ea5(0x263)][_0x118ea5(0x26e)](_0x22b06c=>{var _0x2dba19=_0x118ea5;const _0x26bd31=_0x3a539c[_0x2dba19(0x1fe)][_0x2dba19(0x257)](_0x37e3a8=>{var _0x6bccea=_0x2dba19;_0x37e3a8[_0x6bccea(0x1bb)]==_0x22b06c[_0x6bccea(0x1bb)]&&_0x37e3a8[_0x6bccea(0x28d)]==_0x22b06c[_0x6bccea(0x28d)]&&(_0x37e3a8[_0x6bccea(0x295)]=parseInt(_0x37e3a8['product_stock'])-parseInt(_0x22b06c[_0x6bccea(0x2a2)]));});}),console[_0x118ea5(0x28a)](_0x118ea5(0x212),_0x3a539c),await _0x3a539c[_0x118ea5(0x2b4)]();const _0x31e2c8=await c_payment_data['findOne']({'invoice':_0x294ea5[_0x118ea5(0x205)][_0x118ea5(0x1c8)]});_0x31e2c8['suppliers']=_0x294ea5['body'][_0x118ea5(0x269)],await _0x31e2c8[_0x118ea5(0x2b4)](),_0x294ea5['flash'](_0x118ea5(0x227),_0x118ea5(0x24a)),_0x41ee96[_0x118ea5(0x1e9)](_0x118ea5(0x2b0));}catch(_0x1ef2ce){console[_0x118ea5(0x28a)](_0x1ef2ce);}}),router['post'](a0_0x4a5a05(0x2a3),auth,async(_0x5e78c7,_0x3d4680)=>{var _0x1c52f3=a0_0x4a5a05;try{const _0x4bf809=_0x5e78c7[_0x1c52f3(0x296)]['id'],{invoice:_0x446ea7,customer:_0xf0a34c,receivable_amount:_0x1629a5,received_amount:_0x41e559}=_0x5e78c7[_0x1c52f3(0x205)],_0x48bb42=await sales[_0x1c52f3(0x27c)](_0x4bf809);console[_0x1c52f3(0x28a)](_0x48bb42);var _0x3dd1e4=_0x1629a5-_0x41e559;console[_0x1c52f3(0x28a)](_0x41e559),_0x48bb42['received_amount']=parseFloat(_0x41e559)+parseFloat(_0x48bb42[_0x1c52f3(0x1cc)]),_0x48bb42[_0x1c52f3(0x1e6)]=_0x3dd1e4,console[_0x1c52f3(0x28a)](_0x48bb42);const _0x42b9b7=await _0x48bb42[_0x1c52f3(0x2b4)](),_0xb5a393=await c_payment_data[_0x1c52f3(0x286)]({'invoice':_0x446ea7});_0xb5a393[_0x1c52f3(0x249)]=_0x3dd1e4,await _0xb5a393[_0x1c52f3(0x2b4)]();let _0x8db4e7=new Date(),_0x5209be=('0'+_0x8db4e7[_0x1c52f3(0x275)]())[_0x1c52f3(0x22c)](-0x2),_0xd5e4d2=('0'+(_0x8db4e7[_0x1c52f3(0x20a)]()+0x1))['slice'](-0x2),_0x1b61a8=_0x8db4e7[_0x1c52f3(0x1ee)](),_0x43a766=_0x1b61a8+'-'+_0xd5e4d2+'-'+_0x5209be;const _0x3dd2d8=new customer_payment({'invoice':_0x446ea7,'date':_0x1b61a8+'-'+_0xd5e4d2+'-'+_0x5209be,'customer':_0xf0a34c,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x41e559}),_0x4ffbb2=await _0x3dd2d8[_0x1c52f3(0x2b4)]();_0x5e78c7[_0x1c52f3(0x253)]('success',_0x1c52f3(0x245)),_0x3d4680[_0x1c52f3(0x1e9)](_0x1c52f3(0x2b2));}catch(_0x18251d){console[_0x1c52f3(0x28a)](_0x18251d);}}),router[a0_0x4a5a05(0x25f)](a0_0x4a5a05(0x27e),auth,async(_0x2c4d45,_0x24588b)=>{var _0x5bd106=a0_0x4a5a05;try{const {username:_0x26246c,email:_0x31601d,role:_0x246dbe}=_0x2c4d45['user'],_0x3d3dd2=_0x2c4d45[_0x5bd106(0x2af)],_0x419aa8=await profile[_0x5bd106(0x286)]({'email':_0x3d3dd2['email']}),_0x5c0f3b=await master_shop[_0x5bd106(0x20d)]();console[_0x5bd106(0x28a)](_0x5bd106(0x247),_0x5c0f3b);const _0x56d9c0=_0x2c4d45[_0x5bd106(0x296)]['id'],_0xc12175=await sales[_0x5bd106(0x27c)](_0x56d9c0);console[_0x5bd106(0x28a)](_0xc12175);const _0x498308=await customer[_0x5bd106(0x286)]({'name':_0xc12175['customer']});console[_0x5bd106(0x28a)](_0x498308);if(_0x5c0f3b[0x0]['language']==_0x5bd106(0x221)){var _0x33443e=users[_0x5bd106(0x1d3)];console[_0x5bd106(0x28a)](_0x33443e);}else{if(_0x5c0f3b[0x0][_0x5bd106(0x1c4)]==_0x5bd106(0x25a))var _0x33443e=users['Hindi'];else{if(_0x5c0f3b[0x0]['language']==_0x5bd106(0x2cb))var _0x33443e=users[_0x5bd106(0x2cb)];else{if(_0x5c0f3b[0x0][_0x5bd106(0x1c4)]==_0x5bd106(0x235))var _0x33443e=users['Spanish'];else{if(_0x5c0f3b[0x0]['language']=='French')var _0x33443e=users[_0x5bd106(0x27b)];else{if(_0x5c0f3b[0x0][_0x5bd106(0x1c4)]==_0x5bd106(0x242))var _0x33443e=users[_0x5bd106(0x251)];else{if(_0x5c0f3b[0x0][_0x5bd106(0x1c4)]==_0x5bd106(0x293))var _0x33443e=users[_0x5bd106(0x293)];else{if(_0x5c0f3b[0x0][_0x5bd106(0x1c4)]=='Arabic\x20(ae)')var _0x33443e=users[_0x5bd106(0x1ec)];}}}}}}}_0x24588b[_0x5bd106(0x21a)](_0x5bd106(0x204),{'success':_0x2c4d45[_0x5bd106(0x253)](_0x5bd106(0x227)),'errors':_0x2c4d45[_0x5bd106(0x253)](_0x5bd106(0x1ff)),'role':_0x3d3dd2,'profile':_0x419aa8,'master_shop':_0x5c0f3b,'customers':_0x498308,'sales':_0xc12175,'language':_0x33443e});}catch(_0x16c0a4){console[_0x5bd106(0x28a)](_0x16c0a4);}}),router['get'](a0_0x4a5a05(0x271),auth,async(_0x3af1eb,_0x49c15b)=>{var _0xd6a651=a0_0x4a5a05;try{const {username:_0x4ad151,email:_0x3a304f,role:_0x21ece1}=_0x3af1eb['user'],_0x38eef1=_0x3af1eb[_0xd6a651(0x2af)],_0x28a00b=await profile['findOne']({'email':_0x38eef1[_0xd6a651(0x233)]}),_0x4d7094=await master_shop[_0xd6a651(0x20d)](),_0x5194e6=_0x3af1eb[_0xd6a651(0x296)]['id'],_0x2f514f=await sales_finished['findById'](_0x5194e6),_0x5be1da=await warehouse[_0xd6a651(0x1fd)]([{'$match':{'name':_0x2f514f['warehouse_name']}},{'$unwind':_0xd6a651(0x29c)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xd6a651(0x223)},'product_stock':{'$first':_0xd6a651(0x2c3)},'bay':{'$first':_0xd6a651(0x2a7)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xd6a651(0x226)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xd6a651(0x2a6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xd6a651(0x1f8)},'storage':{'$first':_0xd6a651(0x278)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xd6a651(0x1c0)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0xd6a651(0x1b2)},'secondary_unit':{'$first':_0xd6a651(0x234)},'maxProducts':{'$first':_0xd6a651(0x276)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x4d50ef=await product[_0xd6a651(0x20d)]({}),_0xbcbc2d=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xd6a651(0x220),'name':{'$ne':_0xd6a651(0x203),'$ne':_0xd6a651(0x2ce)}}},{'$group':{'_id':'$name','name':{'$first':_0xd6a651(0x231)}}},{'$sort':{'name':0x1}}]);var _0x5969e4=[_0xd6a651(0x1d9)];const _0xd60959=await warehouse[_0xd6a651(0x1fd)]([{'$match':{'status':_0xd6a651(0x23b),'name':_0xd6a651(0x2ce)}},{'$group':{'_id':'$name','name':{'$first':_0xd6a651(0x231)}}},{'$sort':{'name':0x1}}]);if(_0x4d7094[0x0][_0xd6a651(0x1c4)]==_0xd6a651(0x221)){var _0x13eed0=users['English'];console[_0xd6a651(0x28a)](_0x13eed0);}else{if(_0x4d7094[0x0][_0xd6a651(0x1c4)]==_0xd6a651(0x25a))var _0x13eed0=users['Hindi'];else{if(_0x4d7094[0x0]['language']==_0xd6a651(0x2cb))var _0x13eed0=users[_0xd6a651(0x2cb)];else{if(_0x4d7094[0x0][_0xd6a651(0x1c4)]==_0xd6a651(0x235))var _0x13eed0=users['Spanish'];else{if(_0x4d7094[0x0][_0xd6a651(0x1c4)]==_0xd6a651(0x27b))var _0x13eed0=users[_0xd6a651(0x27b)];else{if(_0x4d7094[0x0]['language']==_0xd6a651(0x242))var _0x13eed0=users[_0xd6a651(0x251)];else{if(_0x4d7094[0x0][_0xd6a651(0x1c4)]==_0xd6a651(0x293))var _0x13eed0=users['Chinese'];else{if(_0x4d7094[0x0][_0xd6a651(0x1c4)]==_0xd6a651(0x238))var _0x13eed0=users['Arabic'];}}}}}}}_0x49c15b['render'](_0xd6a651(0x240),{'success':_0x3af1eb[_0xd6a651(0x253)](_0xd6a651(0x227)),'errors':_0x3af1eb[_0xd6a651(0x253)]('errors'),'role':_0x38eef1,'profile':_0x28a00b,'user':_0x2f514f,'stock':_0x5be1da,'master_shop':_0x4d7094,'unit':_0x4d50ef,'language':_0x13eed0,'warehouses':_0xbcbc2d,'rooms':_0x5969e4,'warehouse_QA':_0xd60959});}catch(_0x28c337){console[_0xd6a651(0x28a)](_0x28c337),_0x49c15b[_0xd6a651(0x26a)](0xc8)[_0xd6a651(0x1c9)]({'message':_0x28c337[_0xd6a651(0x1d0)]});}}),router['post'](a0_0x4a5a05(0x271),auth,async(_0x39c136,_0x3f9ce8)=>{var _0x5c8aec=a0_0x4a5a05;if(_0x39c136['body']['for_categorize']=='QA')try{const {invoice:_0x4d6b27,date:_0x51c972,warehouse_name:_0x3c3443,product_name:_0x445c13,primary_code:_0x4f52a1,secondary_code:_0x544c05,product_code:_0x302544,sales_quantity:_0x2846c0,stocks:_0x4ad1f8,return_qty:_0x149ed5,Room_name:_0x49747e,to_warehouse_name_QA:_0x67de49,to_Room_name_QA:_0x216689,note:_0x9ec6af,for_categorize:_0xf0ba7d,product_name_QA1:_0x1587e0}=_0x39c136['body'];if(typeof _0x1587e0==_0x5c8aec(0x1c2))var _0x3079df=[_0x39c136['body']['product_name_QA1']],_0x4845ed=[_0x39c136[_0x5c8aec(0x205)]['primary_code_QA']],_0x44aa40=[_0x39c136['body'][_0x5c8aec(0x24b)]],_0xae5df=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x1ba)]],_0x131654=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x21b)]],_0x1858da=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x208)]],_0x36eb35=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x1be)]],_0x1bb62b=[_0x39c136['body'][_0x5c8aec(0x1f6)]],_0x7520c9=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x23d)]],_0xc21164=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x29e)]],_0x3f283d=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x217)]],_0x5a7ed1=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x27f)]],_0x330797=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x26f)]],_0x2400c4=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x20b)]];else var _0x3079df=[..._0x39c136[_0x5c8aec(0x205)]['product_name_QA1']],_0x4845ed=[..._0x39c136['body'][_0x5c8aec(0x2a4)]],_0x44aa40=[..._0x39c136['body']['secondary_code_QA']],_0xae5df=[..._0x39c136['body'][_0x5c8aec(0x1ba)]],_0x131654=[..._0x39c136['body'][_0x5c8aec(0x21b)]],_0x1858da=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x208)]],_0x36eb35=[..._0x39c136[_0x5c8aec(0x205)]['return_qty_QA']],_0x1bb62b=[..._0x39c136['body'][_0x5c8aec(0x1f6)]],_0x7520c9=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x23d)]],_0xc21164=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x29e)]],_0x3f283d=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x217)]],_0x5a7ed1=[..._0x39c136['body'][_0x5c8aec(0x27f)]],_0x330797=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x26f)]],_0x2400c4=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x20b)]];const _0x487409=_0x3079df[_0x5c8aec(0x257)](_0x876fd9=>{return _0x876fd9={'product_name':_0x876fd9};});_0x4845ed[_0x5c8aec(0x26e)]((_0x319015,_0x29cd23)=>{var _0x165f62=_0x5c8aec;_0x487409[_0x29cd23][_0x165f62(0x2c9)]=_0x319015;}),_0x44aa40[_0x5c8aec(0x26e)]((_0x518000,_0xd94d9c)=>{var _0x5c220e=_0x5c8aec;_0x487409[_0xd94d9c][_0x5c220e(0x241)]=_0x518000;}),_0xae5df['forEach']((_0x167286,_0x327880)=>{var _0x1b99c3=_0x5c8aec;_0x487409[_0x327880][_0x1b99c3(0x255)]=_0x167286;}),_0x131654['forEach']((_0x358a8a,_0x366fb5)=>{var _0x5464cb=_0x5c8aec;_0x487409[_0x366fb5][_0x5464cb(0x243)]=_0x358a8a;}),_0x1858da[_0x5c8aec(0x26e)]((_0x3c83a3,_0x51bc45)=>{_0x487409[_0x51bc45]['stock']=_0x3c83a3;}),_0x36eb35['forEach']((_0x6da77,_0x27345b)=>{var _0x471c2c=_0x5c8aec;_0x487409[_0x27345b][_0x471c2c(0x1ef)]=_0x6da77;}),_0x1bb62b[_0x5c8aec(0x26e)]((_0x1a142b,_0x3a0cc4)=>{_0x487409[_0x3a0cc4]['maxPerUnit']=_0x1a142b;}),_0x7520c9[_0x5c8aec(0x26e)]((_0x14e4c9,_0x461a0f)=>{var _0x469c46=_0x5c8aec;_0x487409[_0x461a0f][_0x469c46(0x200)]=_0x14e4c9;}),_0xc21164[_0x5c8aec(0x26e)]((_0x295899,_0x43ed7e)=>{var _0x2a184e=_0x5c8aec;_0x487409[_0x43ed7e][_0x2a184e(0x2bb)]=_0x295899;}),_0x3f283d['forEach']((_0x58dabc,_0x196229)=>{var _0x161889=_0x5c8aec;_0x487409[_0x196229][_0x161889(0x21c)]=_0x58dabc;}),_0x5a7ed1[_0x5c8aec(0x26e)]((_0x824224,_0x186b14)=>{var _0x24daaa=_0x5c8aec;_0x487409[_0x186b14][_0x24daaa(0x22d)]=_0x824224;}),_0x330797[_0x5c8aec(0x26e)]((_0x593f9c,_0x45ec00)=>{var _0x26c8e8=_0x5c8aec;_0x487409[_0x45ec00][_0x26c8e8(0x299)]=_0x593f9c;}),_0x2400c4[_0x5c8aec(0x26e)]((_0x3b0c0b,_0x435c5b)=>{var _0x1f27a7=_0x5c8aec;_0x487409[_0x435c5b][_0x1f27a7(0x29a)]=_0x3b0c0b;});const _0x2db355=await sales_finished[_0x5c8aec(0x286)]({'invoice':_0x4d6b27});_0x2db355[_0x5c8aec(0x1d5)]=_0x5c8aec(0x1e0);const _0x44ec69=await _0x2db355[_0x5c8aec(0x2b4)](),_0x5eccba=new sales_return_finished({'invoice':_0x4d6b27,'customer':_0x39c136['body'][_0x5c8aec(0x207)],'date':_0x51c972,'warehouse_name':_0x3c3443,'room':_0x49747e,'ToWarehouse':_0x67de49,'ToRoom':_0x216689,'return_sale_QA':_0x487409,'note':_0x9ec6af,'warehouse_cat':_0xf0ba7d}),_0x5936b4=await _0x5eccba[_0x5c8aec(0x2b4)](),_0x11e9e0=await sales_return_finished[_0x5c8aec(0x286)]({'invoice':_0x4d6b27}),_0x85e336=await warehouse[_0x5c8aec(0x286)]({'name':_0x67de49,'room':_0x216689});_0x11e9e0['return_sale_QA'][_0x5c8aec(0x26e)](_0x5898be=>{var _0x39be45=_0x5c8aec,_0x4a3c46=0x0;const _0x41beed=_0x85e336[_0x39be45(0x1fe)][_0x39be45(0x257)](_0x520332=>{var _0x5a243e=_0x39be45;_0x520332[_0x5a243e(0x1bb)]==_0x5898be[_0x5a243e(0x1bb)]&&_0x520332[_0x5a243e(0x29a)]==_0x5898be[_0x5a243e(0x29a)]&&_0x520332['production_date']==_0x5898be[_0x5a243e(0x299)]&&_0x520332['batch_code']==_0x5898be[_0x5a243e(0x2bb)]&&(_0x520332[_0x5a243e(0x295)]=parseInt(_0x520332['product_stock'])+parseInt(_0x5898be[_0x5a243e(0x1ef)]),_0x4a3c46++);});_0x4a3c46=='0'&&(_0x85e336[_0x39be45(0x1fe)]=_0x85e336['product_details'][_0x39be45(0x280)]({'product_name':_0x5898be[_0x39be45(0x1bb)],'product_stock':_0x5898be[_0x39be45(0x1ef)],'primary_code':_0x5898be[_0x39be45(0x2c9)],'secondary_code':_0x5898be[_0x39be45(0x241)],'product_code':_0x5898be['product_code'],'batch_code':_0x5898be['batch_code'],'maxPerUnit':_0x5898be['maxPerUnit'],'production_date':_0x5898be['production_date'],'expiry_date':_0x5898be[_0x39be45(0x29a)],'secondary_unit':_0x5898be[_0x39be45(0x21c)],'unit':_0x5898be[_0x39be45(0x22d)],'maxProducts':_0x5898be[_0x39be45(0x200)],'bay':_0x5898be[_0x39be45(0x28d)]}));}),await _0x85e336[_0x5c8aec(0x2b4)]();const _0x140b63=new c_payment_data({'invoice':_0x4d6b27,'customer':_0x39c136['body']['customer'],'reason':_0x5c8aec(0x2cd)});await _0x140b63[_0x5c8aec(0x2b4)]();const _0x58808c=await master_shop[_0x5c8aec(0x20d)](),_0xc8892c=await email_settings[_0x5c8aec(0x286)](),_0x4e3294=await customer[_0x5c8aec(0x286)]({'name':_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x207)]});_0x58808c[0x0][_0x5c8aec(0x2bd)]==0x1?(right_currency=_0x58808c[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x58808c[0x0][_0x5c8aec(0x1b8)]);var _0x1997e4=_0x3079df,_0x3d35e5=_0x36eb35,_0x19541f='',_0x5757a6;for(_0x5757a6 in _0x1997e4){_0x19541f+=_0x5c8aec(0x279)+_0x5c8aec(0x22e)+_0x1997e4[_0x5757a6]+_0x5c8aec(0x21d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d35e5[_0x5757a6]+'</td>'+_0x5c8aec(0x254);}console['log'](_0x5c8aec(0x2c8),_0x19541f);let _0x5cc569=nodemailer['createTransport']({'service':_0x5c8aec(0x2c1),'auth':{'user':_0xc8892c[_0x5c8aec(0x233)],'pass':_0xc8892c[_0x5c8aec(0x265)]}}),_0x3542f={'from':_0xc8892c['email'],'to':_0x4e3294[_0x5c8aec(0x233)],'subject':_0x5c8aec(0x1f4),'attachments':[{'filename':_0x5c8aec(0x2bc),'path':__dirname+_0x5c8aec(0x256)+_0x5c8aec(0x211)+_0x58808c[0x0]['image'],'cid':_0x5c8aec(0x216)}],'html':_0x5c8aec(0x201)+_0x5c8aec(0x1e1)+_0x5c8aec(0x2a1)+'<div>'+_0x5c8aec(0x232)+_0x5c8aec(0x1cb)+_0x5c8aec(0x1bf)+_0x5c8aec(0x274)+_0x5c8aec(0x1cb)+_0x5c8aec(0x2c0)+_0x58808c[0x0]['site_title']+'\x20</h2>'+_0x5c8aec(0x274)+'</div>'+_0x5c8aec(0x2ae)+_0x5c8aec(0x1cb)+_0x5c8aec(0x23a)+_0x5c8aec(0x1c6)+_0x4d6b27+'\x20'+_0x5c8aec(0x24d)+'\x20Order\x20Date\x20:\x20'+_0x51c972+'\x20'+_0x5c8aec(0x27a)+_0x5c8aec(0x1de)+_0x5c8aec(0x274)+_0x5c8aec(0x28b)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5c8aec(0x279)+_0x5c8aec(0x1b9)+_0x5c8aec(0x1fc)+_0x5c8aec(0x2b9)+_0x5c8aec(0x1c1)+_0x5c8aec(0x254)+'</thead>'+_0x5c8aec(0x258)+'\x20'+_0x19541f+'\x20'+'</tbody>'+_0x5c8aec(0x1b4)+_0x5c8aec(0x1cb)+_0x5c8aec(0x281)+_0x5c8aec(0x2d2)+_0x58808c[0x0][_0x5c8aec(0x210)]+_0x5c8aec(0x1de)+'</div>'+_0x5c8aec(0x274)+_0x5c8aec(0x2a5)};_0x5cc569[_0x5c8aec(0x1f3)](_0x3542f,function(_0x57c611,_0x86bbb){var _0x4f92bc=_0x5c8aec;_0x57c611?(console[_0x4f92bc(0x28a)](_0x57c611),console[_0x4f92bc(0x28a)](_0x4f92bc(0x20e))):console['log']('Email\x20sent\x20successfully');}),_0x39c136[_0x5c8aec(0x253)](_0x5c8aec(0x227),_0x5c8aec(0x24f)),_0x3f9ce8[_0x5c8aec(0x1e9)](_0x5c8aec(0x2b0));}catch(_0xee169b){_0x3f9ce8['status'](0xc8)[_0x5c8aec(0x1c9)]({'message1':_0xee169b[_0x5c8aec(0x1d0)]});}else{if(_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x282)]=='GS')try{const {invoice:_0x2dee37,date:_0x2a3f15,warehouse_name:_0x1c1182,product_name:_0x26b6e8,primary_code:_0x540b06,secondary_code:_0xc730f3,product_code:_0x3dc75f,sales_quantity:_0x5a6e72,stocks:_0x24e97f,return_qty:_0x119406,Room_name:_0x5544a3,to_warehouse_name:_0x17006d,to_Room_name:_0x202108,note:_0xccbada,level:_0x1532f5,isle:_0x4b27d5,pallet:_0x463867,for_categorize:_0x44ddfc}=_0x39c136[_0x5c8aec(0x205)];if(typeof _0x26b6e8=='string')var _0x3079df=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x1bb)]],_0x4845ed=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x2c9)]],_0x44aa40=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x241)]],_0xae5df=[_0x39c136[_0x5c8aec(0x205)]['product_code']],_0x131654=[_0x39c136[_0x5c8aec(0x205)]['sales_quantity']],_0x36eb35=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x1ef)]],_0x400fff=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x28d)]],_0x1bb62b=[_0x39c136['body'][_0x5c8aec(0x1b1)]],_0x7520c9=[_0x39c136[_0x5c8aec(0x205)]['maxProducts']],_0xc21164=[_0x39c136[_0x5c8aec(0x205)]['batch_code']],_0x3f283d=[_0x39c136['body'][_0x5c8aec(0x21c)]],_0x5a7ed1=[_0x39c136[_0x5c8aec(0x205)]['unit']],_0x330797=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x299)]],_0x2400c4=[_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x29a)]];else var _0x3079df=[..._0x39c136['body'][_0x5c8aec(0x1bb)]],_0x4845ed=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x2c9)]],_0x44aa40=[..._0x39c136['body']['secondary_code']],_0xae5df=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x255)]],_0x131654=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x27d)]],_0x36eb35=[..._0x39c136['body'][_0x5c8aec(0x1ef)]],_0x400fff=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x28d)]],_0x1bb62b=[..._0x39c136[_0x5c8aec(0x205)]['maxPerUnit']],_0x7520c9=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x200)]],_0xc21164=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x2bb)]],_0x3f283d=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x21c)]],_0x5a7ed1=[..._0x39c136['body'][_0x5c8aec(0x22d)]],_0x330797=[..._0x39c136[_0x5c8aec(0x205)]['production_date']],_0x2400c4=[..._0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x29a)]];const _0xef2560=_0x3079df[_0x5c8aec(0x257)](_0x5ee286=>{return _0x5ee286={'product_name':_0x5ee286};});_0x4845ed[_0x5c8aec(0x26e)]((_0x1c9d2c,_0x31d58)=>{var _0x8a2183=_0x5c8aec;_0xef2560[_0x31d58][_0x8a2183(0x2c9)]=_0x1c9d2c;}),_0x44aa40['forEach']((_0x216daa,_0x3ae3ab)=>{var _0x968206=_0x5c8aec;_0xef2560[_0x3ae3ab][_0x968206(0x241)]=_0x216daa;}),_0xae5df[_0x5c8aec(0x26e)]((_0x272805,_0x31efca)=>{var _0x12b3b9=_0x5c8aec;_0xef2560[_0x31efca][_0x12b3b9(0x255)]=_0x272805;}),_0x131654[_0x5c8aec(0x26e)]((_0x23ea7b,_0x37f84c)=>{_0xef2560[_0x37f84c]['sale_qty']=_0x23ea7b;}),_0x36eb35[_0x5c8aec(0x26e)]((_0x300692,_0x1a43c6)=>{_0xef2560[_0x1a43c6]['return_qty']=_0x300692;}),_0x400fff['forEach']((_0x166fea,_0x6f09c7)=>{var _0x1ced08=_0x5c8aec;_0xef2560[_0x6f09c7][_0x1ced08(0x28d)]=_0x166fea;}),_0x1bb62b[_0x5c8aec(0x26e)]((_0x1c6568,_0x4a214c)=>{var _0x3c0111=_0x5c8aec;_0xef2560[_0x4a214c][_0x3c0111(0x1b1)]=_0x1c6568;}),_0x7520c9[_0x5c8aec(0x26e)]((_0x3c9a59,_0xe2fea9)=>{var _0xc8200d=_0x5c8aec;_0xef2560[_0xe2fea9][_0xc8200d(0x200)]=_0x3c9a59;}),_0xc21164[_0x5c8aec(0x26e)]((_0x47a3be,_0xf0ec6c)=>{var _0x23577b=_0x5c8aec;_0xef2560[_0xf0ec6c][_0x23577b(0x2bb)]=_0x47a3be;}),_0x3f283d[_0x5c8aec(0x26e)]((_0x529a1c,_0x1a77f7)=>{_0xef2560[_0x1a77f7]['secondary_unit']=_0x529a1c;}),_0x5a7ed1['forEach']((_0x5a07b0,_0x157cd8)=>{var _0xa15026=_0x5c8aec;_0xef2560[_0x157cd8][_0xa15026(0x22d)]=_0x5a07b0;}),_0x330797[_0x5c8aec(0x26e)]((_0x4b7b82,_0x2aad87)=>{var _0x3972c7=_0x5c8aec;_0xef2560[_0x2aad87][_0x3972c7(0x299)]=_0x4b7b82;}),_0x2400c4['forEach']((_0x56f57a,_0x4f7347)=>{var _0x2a2330=_0x5c8aec;_0xef2560[_0x4f7347][_0x2a2330(0x29a)]=_0x56f57a;});var _0x3b8284=0x0;_0xef2560[_0x5c8aec(0x26e)](_0x24bb2e=>{var _0x2b607f=_0x5c8aec;(parseInt(_0x24bb2e[_0x2b607f(0x243)])<parseInt(_0x24bb2e['return_qty'])||parseInt(_0x24bb2e[_0x2b607f(0x2b7)])<parseInt(_0x24bb2e[_0x2b607f(0x1ef)])&&parseInt(_0x24bb2e['sale_qty'])>parseInt(_0x24bb2e[_0x2b607f(0x1ef)])||parseInt(_0x24bb2e[_0x2b607f(0x1ef)])==0x0)&&_0x3b8284++;});if(_0x3b8284!=0x0)return _0x39c136[_0x5c8aec(0x253)]('errors',_0x5c8aec(0x20f)),_0x3f9ce8[_0x5c8aec(0x1e9)](_0x5c8aec(0x236));const _0x42c131=await sales_finished['findOne']({'invoice':_0x2dee37});_0x42c131[_0x5c8aec(0x1d5)]=_0x5c8aec(0x1e0);const _0x47d28f=await _0x42c131[_0x5c8aec(0x2b4)](),_0x2b3e5c=new sales_return_finished({'invoice':_0x2dee37,'customer':_0x39c136['body'][_0x5c8aec(0x207)],'date':_0x2a3f15,'warehouse_name':_0x1c1182,'room':_0x5544a3,'ToWarehouse':_0x17006d,'ToRoom':_0x202108,'return_sale':_0xef2560,'note':_0xccbada,'warehouse_cat':_0x44ddfc}),_0x27995a=await _0x2b3e5c['save'](),_0x59bfc7=await sales_return_finished[_0x5c8aec(0x286)]({'invoice':_0x2dee37}),_0x30b5c6=await warehouse[_0x5c8aec(0x286)]({'name':_0x17006d,'room':_0x202108,'warehouse_category':_0x5c8aec(0x220)});_0x59bfc7[_0x5c8aec(0x1f0)][_0x5c8aec(0x26e)](_0x2467fc=>{var _0x512fe0=_0x5c8aec,_0x5aca25=0x0;const _0x49bee9=_0x30b5c6[_0x512fe0(0x1fe)][_0x512fe0(0x257)](_0x278cbb=>{var _0x36d459=_0x512fe0;_0x278cbb['product_name']==_0x2467fc[_0x36d459(0x1bb)]&&_0x278cbb[_0x36d459(0x28d)]==_0x2467fc[_0x36d459(0x28d)]&&_0x278cbb[_0x36d459(0x29a)]==_0x2467fc['expiry_date']&&_0x278cbb[_0x36d459(0x299)]==_0x2467fc[_0x36d459(0x299)]&&_0x278cbb['batch_code']==_0x2467fc[_0x36d459(0x2bb)]&&(_0x278cbb['product_stock']=parseInt(_0x278cbb['product_stock'])+parseInt(_0x2467fc['return_qty']),_0x5aca25++);});_0x5aca25=='0'&&(_0x30b5c6[_0x512fe0(0x1fe)]=_0x30b5c6[_0x512fe0(0x1fe)][_0x512fe0(0x280)]({'product_name':_0x2467fc[_0x512fe0(0x1bb)],'product_stock':_0x2467fc[_0x512fe0(0x1ef)],'primary_code':_0x2467fc[_0x512fe0(0x2c9)],'secondary_code':_0x2467fc['secondary_code'],'product_code':_0x2467fc['product_code'],'bay':_0x2467fc[_0x512fe0(0x28d)],'batch_code':_0x2467fc[_0x512fe0(0x2bb)],'maxPerUnit':_0x2467fc[_0x512fe0(0x1b1)],'production_date':_0x2467fc[_0x512fe0(0x299)],'expiry_date':_0x2467fc[_0x512fe0(0x29a)],'secondary_unit':_0x2467fc[_0x512fe0(0x21c)],'unit':_0x2467fc[_0x512fe0(0x22d)],'maxProducts':_0x2467fc[_0x512fe0(0x200)]}));}),await _0x30b5c6['save'](),console['log'](_0x39c136[_0x5c8aec(0x205)]);const _0x460e07=new c_payment_data({'invoice':_0x2dee37,'customer':_0x39c136['body'][_0x5c8aec(0x207)],'reason':_0x5c8aec(0x2cd)});await _0x460e07[_0x5c8aec(0x2b4)]();const _0x3f9d45=await master_shop['find']();console[_0x5c8aec(0x28a)]('add\x20post',_0x3f9d45[0x0][_0x5c8aec(0x2b5)]);const _0x1d7008=await email_settings['findOne'](),_0x43e67f=await customer['findOne']({'name':_0x39c136[_0x5c8aec(0x205)][_0x5c8aec(0x207)]});console[_0x5c8aec(0x28a)]('customer_data',_0x43e67f);_0x3f9d45[0x0]['currency_placement']==0x1?(right_currency=_0x3f9d45[0x0][_0x5c8aec(0x1b8)],left_currency=''):(right_currency='',left_currency=_0x3f9d45[0x0][_0x5c8aec(0x1b8)]);var _0x1997e4=_0x3079df,_0x3d35e5=_0x36eb35,_0x19541f='',_0x5757a6;for(_0x5757a6 in _0x1997e4){_0x19541f+=_0x5c8aec(0x279)+_0x5c8aec(0x22e)+_0x1997e4[_0x5757a6]+_0x5c8aec(0x21d)+_0x5c8aec(0x22e)+_0x3d35e5[_0x5757a6]+_0x5c8aec(0x21d)+_0x5c8aec(0x254);}console[_0x5c8aec(0x28a)]('product_list',_0x19541f);let _0x4b5c25=nodemailer['createTransport']({'service':_0x5c8aec(0x2c1),'auth':{'user':_0x1d7008[_0x5c8aec(0x233)],'pass':_0x1d7008[_0x5c8aec(0x265)]}}),_0x3cb646={'from':_0x1d7008[_0x5c8aec(0x233)],'to':_0x43e67f[_0x5c8aec(0x233)],'subject':_0x5c8aec(0x1f4),'attachments':[{'filename':_0x5c8aec(0x2bc),'path':__dirname+_0x5c8aec(0x256)+'/upload/'+_0x3f9d45[0x0]['image'],'cid':_0x5c8aec(0x216)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x5c8aec(0x2a1)+'<div>'+_0x5c8aec(0x232)+_0x5c8aec(0x1cb)+_0x5c8aec(0x1bf)+_0x5c8aec(0x274)+_0x5c8aec(0x1cb)+_0x5c8aec(0x2c0)+_0x3f9d45[0x0][_0x5c8aec(0x210)]+_0x5c8aec(0x213)+_0x5c8aec(0x274)+_0x5c8aec(0x274)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x5c8aec(0x23a)+_0x5c8aec(0x1c6)+_0x2dee37+'\x20'+_0x5c8aec(0x24d)+_0x5c8aec(0x2a8)+_0x2a3f15+'\x20'+_0x5c8aec(0x27a)+_0x5c8aec(0x1de)+_0x5c8aec(0x274)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5c8aec(0x1fc)+_0x5c8aec(0x2b9)+_0x5c8aec(0x1c1)+_0x5c8aec(0x254)+'</thead>'+_0x5c8aec(0x258)+'\x20'+_0x19541f+'\x20'+_0x5c8aec(0x26c)+_0x5c8aec(0x1b4)+_0x5c8aec(0x1cb)+_0x5c8aec(0x281)+'<h5>'+_0x3f9d45[0x0]['site_title']+_0x5c8aec(0x1de)+_0x5c8aec(0x274)+_0x5c8aec(0x274)+_0x5c8aec(0x2a5)};_0x4b5c25[_0x5c8aec(0x1f3)](_0x3cb646,function(_0x9e4583,_0xe1c582){var _0x2ab8cf=_0x5c8aec;_0x9e4583?(console[_0x2ab8cf(0x28a)](_0x9e4583),console[_0x2ab8cf(0x28a)]('Error\x20Occurs')):console[_0x2ab8cf(0x28a)]('Email\x20sent\x20successfully');}),_0x39c136[_0x5c8aec(0x253)](_0x5c8aec(0x227),'sales\x20item\x20return\x20successfull'),_0x3f9ce8[_0x5c8aec(0x1e9)]('/all_sales_finished/view');}catch(_0x315dff){console[_0x5c8aec(0x28a)](_0x315dff),_0x3f9ce8[_0x5c8aec(0x26a)](0xc8)[_0x5c8aec(0x1c9)]({'message1':_0x315dff[_0x5c8aec(0x1d0)]});}}}),router[a0_0x4a5a05(0x25f)](a0_0x4a5a05(0x22f),auth,async(_0x15d4da,_0x969da3)=>{var _0x24cd9a=a0_0x4a5a05;try{const {username:_0x371bea,email:_0x2c47b5,role:_0x4acbaa}=_0x15d4da[_0x24cd9a(0x2af)],_0x48ef01=_0x15d4da[_0x24cd9a(0x2af)],_0x419bc6=await profile[_0x24cd9a(0x286)]({'email':_0x48ef01[_0x24cd9a(0x233)]}),_0x2ce92b=await master_shop[_0x24cd9a(0x20d)]();console['log'](_0x24cd9a(0x214),_0x2ce92b);const _0x764380=_0x15d4da['params']['id'],_0x43bc84=await sales[_0x24cd9a(0x27c)](_0x764380);console['log'](_0x24cd9a(0x1b3),_0x43bc84);if(_0x2ce92b[0x0]['language']==_0x24cd9a(0x221))var _0x2c62db=users[_0x24cd9a(0x1d3)];else{if(_0x2ce92b[0x0]['language']==_0x24cd9a(0x25a))var _0x2c62db=users['Hindi'];else{if(_0x2ce92b[0x0]['language']==_0x24cd9a(0x2cb))var _0x2c62db=users[_0x24cd9a(0x2cb)];else{if(_0x2ce92b[0x0][_0x24cd9a(0x1c4)]=='Spanish')var _0x2c62db=users[_0x24cd9a(0x235)];else{if(_0x2ce92b[0x0][_0x24cd9a(0x1c4)]==_0x24cd9a(0x27b))var _0x2c62db=users[_0x24cd9a(0x27b)];else{if(_0x2ce92b[0x0][_0x24cd9a(0x1c4)]==_0x24cd9a(0x242))var _0x2c62db=users[_0x24cd9a(0x251)];else{if(_0x2ce92b[0x0][_0x24cd9a(0x1c4)]==_0x24cd9a(0x293))var _0x2c62db=users['Chinese'];else{if(_0x2ce92b[0x0][_0x24cd9a(0x1c4)]==_0x24cd9a(0x238))var _0x2c62db=users[_0x24cd9a(0x1ec)];}}}}}}}_0x969da3[_0x24cd9a(0x21a)](_0x24cd9a(0x29b),{'success':_0x15d4da[_0x24cd9a(0x253)]('success'),'errors':_0x15d4da['flash']('errors'),'role':_0x48ef01,'profile':_0x419bc6,'alldata':_0x43bc84,'master_shop':_0x2ce92b,'language':_0x2c62db});}catch(_0x242d78){console[_0x24cd9a(0x28a)](_0x242d78);}}),router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x261),async(_0xa28b96,_0x389145)=>{var _0x290da7=a0_0x4a5a05;const {product_code:_0x2231d3,warehouse_name:_0x373dca,rooms_data:_0x1e84e1,Roomslist:_0x5171ee,sales_category:_0x4e10aa}=_0xa28b96[_0x290da7(0x205)],_0x2404aa=_0x5171ee[_0x290da7(0x1da)](','),_0x3a5d28=[];async function _0x478d88(_0x2e1d20){var _0x1f67a8=_0x290da7;const _0x5f3200=await warehouse[_0x1f67a8(0x1fd)]([{'$match':{'name':_0x373dca,'room':_0x2e1d20}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x2231d3}},{'$group':{'_id':_0x1f67a8(0x26b),'name':{'$first':_0x1f67a8(0x223)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1f67a8(0x2a6)},'secondary_code':{'$first':_0x1f67a8(0x22b)},'product_code':{'$first':_0x1f67a8(0x1f8)},'level':{'$first':_0x1f67a8(0x1ce)},'bay':{'$first':_0x1f67a8(0x2a7)},'type':{'$first':_0x1f67a8(0x226)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1f67a8(0x1b2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1f67a8(0x278)},'rack':{'$first':_0x1f67a8(0x222)},'expiry_date':{'$first':_0x1f67a8(0x1c0)},'production_date':{'$first':_0x1f67a8(0x2c2)},'maxPerUnit':{'$first':_0x1f67a8(0x2be)},'batch_code':{'$first':_0x1f67a8(0x2cf)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'},'uuid':{'$first':_0x1f67a8(0x2aa)},'gross_price':{'$first':_0x1f67a8(0x1e3)},'sales_category':{'$first':_0x1f67a8(0x266)}}}]),_0x4eac95=await warehouse[_0x1f67a8(0x1fd)]([{'$match':{'name':_0x373dca,'room':_0x2e1d20}},{'$unwind':_0x1f67a8(0x29c)},{'$match':{'product_details.secondary_code':_0x2231d3}},{'$group':{'_id':_0x1f67a8(0x26b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1f67a8(0x2c3)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1f67a8(0x1f8)},'level':{'$first':_0x1f67a8(0x2a7)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1f67a8(0x226)},'pallet':{'$first':_0x1f67a8(0x2cc)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1f67a8(0x234)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1f67a8(0x222)},'expiry_date':{'$first':_0x1f67a8(0x1c0)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x1f67a8(0x2be)},'batch_code':{'$first':_0x1f67a8(0x2cf)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1f67a8(0x218)},'invoice':{'$first':_0x1f67a8(0x248)},'uuid':{'$first':_0x1f67a8(0x2aa)},'gross_price':{'$first':_0x1f67a8(0x1e3)},'sales_category':{'$first':_0x1f67a8(0x266)}}}]);if(_0x5f3200[_0x1f67a8(0x23c)]>0x0)_0x3a5d28[_0x1f67a8(0x1dc)](_0x5f3200);else _0x4eac95[_0x1f67a8(0x23c)]>0x0&&_0x3a5d28[_0x1f67a8(0x1dc)](_0x4eac95);}const _0xb32bf6=_0x2404aa[_0x290da7(0x257)](_0x2811de=>_0x478d88(_0x2811de));await Promise['all'](_0xb32bf6),_0x389145[_0x290da7(0x1c9)](_0x3a5d28);}),router[a0_0x4a5a05(0x225)](a0_0x4a5a05(0x1f2),async(_0x27a258,_0x29606b)=>{var _0x1e9866=a0_0x4a5a05;const {product_code:_0x254417,warehouse_name:_0x6ca30b,rooms_data:_0x4302b6,Roomslist:_0x205396,sales_category:_0x18190d}=_0x27a258[_0x1e9866(0x205)],_0x1ebfb9=_0x205396[_0x1e9866(0x1da)](','),_0x5a4fca=[];async function _0x28ac9b(_0x4c6127){var _0x4a9f5c=_0x1e9866;const _0x4843ff=await warehouse[_0x4a9f5c(0x1fd)]([{'$match':{'name':_0x6ca30b,'room':_0x4c6127}},{'$unwind':_0x4a9f5c(0x29c)},{'$match':{'product_details.primary_code':_0x254417,'product_details.sales_category':_0x18190d,'product_details.type_products':_0x4a9f5c(0x28a)}},{'$group':{'_id':_0x4a9f5c(0x26b),'name':{'$first':_0x4a9f5c(0x223)},'product_stock':{'$first':_0x4a9f5c(0x2c3)},'primary_code':{'$first':_0x4a9f5c(0x2a6)},'secondary_code':{'$first':_0x4a9f5c(0x22b)},'product_code':{'$first':_0x4a9f5c(0x1f8)},'level':{'$first':'$product_details.level'},'bay':{'$first':_0x4a9f5c(0x2a7)},'type':{'$first':_0x4a9f5c(0x226)},'pallet':{'$first':_0x4a9f5c(0x2cc)},'unit':{'$first':_0x4a9f5c(0x1b2)},'secondary_unit':{'$first':_0x4a9f5c(0x234)},'storage':{'$first':_0x4a9f5c(0x278)},'rack':{'$first':_0x4a9f5c(0x222)},'expiry_date':{'$first':_0x4a9f5c(0x1c0)},'production_date':{'$first':_0x4a9f5c(0x2c2)},'maxPerUnit':{'$first':_0x4a9f5c(0x2be)},'batch_code':{'$first':_0x4a9f5c(0x2cf)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4a9f5c(0x218)},'invoice':{'$first':_0x4a9f5c(0x248)},'uuid':{'$first':_0x4a9f5c(0x2aa)},'gross_price':{'$first':_0x4a9f5c(0x1e3)},'sales_category':{'$first':_0x4a9f5c(0x266)},'type_products':{'$first':'$product_details.type_products'}}}]);console[_0x4a9f5c(0x28a)](_0x4a9f5c(0x28a)+'\x20<>\x20'+_0x254417+_0x4a9f5c(0x284)+_0x18190d);const _0x2130a0=await warehouse[_0x4a9f5c(0x1fd)]([{'$match':{'name':_0x6ca30b,'room':_0x4c6127}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x254417,'product_details.sales_category':_0x18190d,'product_details.type_products':_0x4a9f5c(0x28a)}},{'$group':{'_id':_0x4a9f5c(0x26b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4a9f5c(0x2c3)},'primary_code':{'$first':_0x4a9f5c(0x2a6)},'secondary_code':{'$first':_0x4a9f5c(0x22b)},'product_code':{'$first':_0x4a9f5c(0x1f8)},'level':{'$first':_0x4a9f5c(0x2a7)},'isle':{'$first':_0x4a9f5c(0x291)},'type':{'$first':_0x4a9f5c(0x226)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4a9f5c(0x1b2)},'secondary_unit':{'$first':_0x4a9f5c(0x234)},'storage':{'$first':_0x4a9f5c(0x278)},'rack':{'$first':_0x4a9f5c(0x222)},'expiry_date':{'$first':_0x4a9f5c(0x1c0)},'production_date':{'$first':_0x4a9f5c(0x2c2)},'maxPerUnit':{'$first':_0x4a9f5c(0x2be)},'batch_code':{'$first':_0x4a9f5c(0x2cf)},'product_cat':{'$first':_0x4a9f5c(0x24c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4a9f5c(0x218)},'invoice':{'$first':_0x4a9f5c(0x248)},'uuid':{'$first':_0x4a9f5c(0x2aa)},'gross_price':{'$first':_0x4a9f5c(0x1e3)},'sales_category':{'$first':'$product_details.sales_category'},'type_products':{'$first':_0x4a9f5c(0x25e)}}}]);if(_0x4843ff[_0x4a9f5c(0x23c)]>0x0)_0x5a4fca[_0x4a9f5c(0x1dc)](_0x4843ff);else _0x2130a0['length']>0x0&&_0x5a4fca[_0x4a9f5c(0x1dc)](_0x2130a0);}const _0x1535fb=_0x1ebfb9[_0x1e9866(0x257)](_0x1fcc16=>_0x28ac9b(_0x1fcc16));await Promise['all'](_0x1535fb),_0x29606b[_0x1e9866(0x1c9)](_0x5a4fca);}),module[a0_0x4a5a05(0x25c)]=router;