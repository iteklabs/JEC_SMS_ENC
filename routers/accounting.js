const a0_0x507cd5=a0_0x4566;function a0_0x19ae(){const _0x8c16a8=['</body></html>','quantity','$warehouse_info','<tr>','prod_id','/accounting_approval/view_sales_order/','express','sale_product','errors','Sales\x20Order\x20is\x20changed\x20status','accounting_approval','<table\x20style=\x22width:\x20100%\x20!important;\x22>','email','$accounting_account_id','<br><br>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Logo.png','Types','view_accounting_approval','$wms_account_id','English','flash','createTransport','</head><body>','$member.name','/warehouse_approval/','7010nNhTmE','get','Portuguese\x20(BR)','<div\x20style=\x22text-align:\x20center;\x22>','Spanish','3521889KUNNIn','post','exports','<hr\x20class=\x22my-3\x22>','2656576WPGsiN','updateOne','success','</td>','password','</div>','813UfKdFw','mongodb','params','27163953MjLyvO','1054870PsWVaA','<html><head><title></title>','christian.villamer@jakagroup.com','host','date','\x22>Change\x20Status</a>','save','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','No\x20Approvers\x20Set\x20Please\x20contact\x20admin\x20to\x20setup','<h2>\x20JEC\x20SMS\x20</h2>','accounting_approval_All','headers','Portuguese','</tr>','Chinese','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','German','redirect','map','/../public','Hindi','_id','wms_data','</b>,\x20</span><br>','Error\x20Occurs','forEach','wms_account_id','logo','name','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Arabic','<strong>\x20Regards\x20</strong>','accounting_account_date','<br><br><span>\x20The\x20total\x20quantity\x20for\x20these\x20items\x20is\x20<b>','Arabic\x20(ae)','<div>','</thead>','sendMail','warehouse_info','<span>\x20Thank\x20you\x20for\x20your\x20prompt\x20attention\x20to\x20this\x20matter.\x20</span>','</b></span>\x20<br><br>','findOne','account_data','sttaff_id','ObjectId','<span>\x20Requested\x20By:\x20<b>','toLocaleDateString','language','../models/all_models','8zGJFTO','</b>.\x20These\x20products\x20are\x20essential\x20to\x20improve\x20our\x20warehouse\x20efficiency\x20and\x20ensure\x20smooth\x20operations.\x20</span>','../public/language/languages.json','body','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','</table>','xlsx','<span>\x20Dear\x20<b>','<link\x20href=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\x22\x20rel=\x22stylesheet\x22\x20integrity=\x22sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\x22\x20crossorigin=\x22anonymous\x22>','English\x20(US)','protocol','1847045DIWKGI','aggregate','staffs','valueOf','<span>\x20lease\x20review\x20the\x20request\x20and\x20approve\x20it\x20if\x20it\x20aligns\x20with\x20our\x20operational\x20needs.\x20If\x20you\x20have\x20any\x20questions\x20or\x20require\x20further\x20information,\x20please\x20feel\x20free\x20to\x20reach\x20out\x20to\x20the\x20Sales\x20Department.\x20</span>','<span>\x20A\x20product\x20request\x20has\x20been\x20submitted\x20by\x20the\x20Sales\x20Department\x20and\x20Approved\x20by\x20Accounting\x20that\x20requires\x20your\x20approval.\x20Below\x20are\x20the\x20details:\x20</span>\x20<br><br>','Router','<a\x20style=\x22background-color:\x20#007bff;\x20color:\x20#ffffff;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x205px;\x22\x20href=\x22','../middleware/auth','6983040KDdHuR','$wms_data','log','find','render','/:id','accounting_discount','user','</b></span>\x20<br>','product_code','French','length','findById','<!DOCTYPE\x20html>','invoice','<h5>\x20JEC\x20SMS\x20</h5>'];a0_0x19ae=function(){return _0x8c16a8;};return a0_0x19ae();}(function(_0x327c65,_0x4015ab){const _0x244025=a0_0x4566,_0x4e9904=_0x327c65();while(!![]){try{const _0x4313f6=-parseInt(_0x244025(0x112))/0x1+parseInt(_0x244025(0xff))/0x2*(-parseInt(_0x244025(0x10e))/0x3)+parseInt(_0x244025(0x108))/0x4+-parseInt(_0x244025(0xcc))/0x5+-parseInt(_0x244025(0xd5))/0x6+parseInt(_0x244025(0x104))/0x7+-parseInt(_0x244025(0xbf))/0x8*(-parseInt(_0x244025(0x111))/0x9);if(_0x4313f6===_0x4015ab)break;else _0x4e9904['push'](_0x4e9904['shift']());}catch(_0x48a7b){_0x4e9904['push'](_0x4e9904['shift']());}}}(a0_0x19ae,0x9e15a));function a0_0x4566(_0xc9fd6c,_0x330eba){const _0x19ae08=a0_0x19ae();return a0_0x4566=function(_0x45665c,_0x4dbff5){_0x45665c=_0x45665c-0x98;let _0x169705=_0x19ae08[_0x45665c];return _0x169705;},a0_0x4566(_0xc9fd6c,_0x330eba);}const express=require(a0_0x507cd5(0xeb)),app=express(),router=express[a0_0x507cd5(0xd2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sales_order,invoice_sa,sales_sa,invoice_for_sales_order,approver_acct,email_settings}=require(a0_0x507cd5(0xbe)),auth=require(a0_0x507cd5(0xd4)),users=require(a0_0x507cd5(0xc1)),excelJS=require('exceljs'),xlsx=require(a0_0x507cd5(0xc7)),mongoose=require('mongoose'),{ObjectId}=require(a0_0x507cd5(0x10f)),nodemailer=require(a0_0x507cd5(0xc3));router['get'](a0_0x507cd5(0xda),auth,async(_0x5e9d65,_0xf12c33)=>{const _0x22c444=a0_0x507cd5;try{const _0x424bfe=await master_shop[_0x22c444(0xd8)](),_0x30fb15=_0x5e9d65[_0x22c444(0xdc)],_0xcbde51=await profile['findOne']({'email':_0x30fb15[_0x22c444(0xf1)]}),_0x4b489d=await staff[_0x22c444(0xb7)]({'email':_0x30fb15[_0x22c444(0xf1)]}),_0xa11fe7=await customer['find']({'agent_id':_0x4b489d[_0x22c444(0xa2)]}),_0x517ce8=mongoose[_0x22c444(0xf6)][_0x22c444(0xba)],_0x30f731=_0x5e9d65[_0x22c444(0x110)]['id'],_0x13dcd2=await sales_order[_0x22c444(0xe1)](_0x30f731),_0x1bd1ce=await sales_order['aggregate']([{'$match':{'_id':_0x517ce8(_0x30f731)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x22c444(0xf2)}}},{'$addFields':{'wms_account_id':{'$toObjectId':'$wms_account_id'}}},{'$lookup':{'from':'staffs','localField':'accounting_account_id','foreignField':'_id','as':_0x22c444(0xb8)}},{'$unwind':'$account_data'},{'$lookup':{'from':_0x22c444(0xce),'localField':_0x22c444(0xa7),'foreignField':_0x22c444(0xa2),'as':_0x22c444(0xa3)}},{'$unwind':{'path':'$wms_data','preserveNullAndEmptyArrays':!![]}}]);if(_0x424bfe[0x0][_0x22c444(0xbd)]=='English\x20(US)')var _0xa043df=users['English'];else{if(_0x424bfe[0x0][_0x22c444(0xbd)]==_0x22c444(0xa1))var _0xa043df=users[_0x22c444(0xa1)];else{if(_0x424bfe[0x0][_0x22c444(0xbd)]=='German')var _0xa043df=users[_0x22c444(0x9d)];else{if(_0x424bfe[0x0][_0x22c444(0xbd)]==_0x22c444(0x103))var _0xa043df=users[_0x22c444(0x103)];else{if(_0x424bfe[0x0][_0x22c444(0xbd)]==_0x22c444(0xdf))var _0xa043df=users[_0x22c444(0xdf)];else{if(_0x424bfe[0x0][_0x22c444(0xbd)]==_0x22c444(0x101))var _0xa043df=users[_0x22c444(0x99)];else{if(_0x424bfe[0x0]['language']==_0x22c444(0x9b))var _0xa043df=users[_0x22c444(0x9b)];else{if(_0x424bfe[0x0]['language']==_0x22c444(0xb0))var _0xa043df=users[_0x22c444(0xac)];}}}}}}}_0xf12c33[_0x22c444(0xd9)](_0x22c444(0xef),{'success':_0x5e9d65['flash'](_0x22c444(0x10a)),'errors':_0x5e9d65[_0x22c444(0xfa)]('errors'),'master_shop':_0x424bfe,'profile':_0xcbde51,'role':_0x30fb15,'language':_0xa043df,'customer':_0xa11fe7,'sales_sa':_0x13dcd2,'approvers':_0x1bd1ce[0x0],'the_id':_0x30f731});}catch(_0x1b309a){console['log'](_0x1b309a);}}),router[a0_0x507cd5(0x105)](a0_0x507cd5(0xda),auth,async(_0x38a8c3,_0x9556e0)=>{const _0x7e2398=a0_0x507cd5;try{const {accounting_discount:_0x25ff98,accounting_confirm:_0x328e53,wms_confirm:_0x4f61d7,the_id_val:_0x3ce193,invoice:_0xe45728,prod_id:_0x415bf5}=_0x38a8c3[_0x7e2398(0xc2)],_0x48b41b=await sales_order[_0x7e2398(0xe1)](_0x3ce193),_0x48b500=_0x38a8c3['user'],_0x371914=await staff[_0x7e2398(0xb7)]({'email':_0x48b500[_0x7e2398(0xf1)]});if(typeof _0x415bf5=='string')var _0x56ca68=[_0x38a8c3[_0x7e2398(0xc2)][_0x7e2398(0xe9)]],_0xf5f00a=[_0x38a8c3[_0x7e2398(0xc2)][_0x7e2398(0xdb)]];else var _0x56ca68=[..._0x38a8c3['body']['prod_id']],_0xf5f00a=[..._0x38a8c3['body'][_0x7e2398(0xdb)]];const _0x3fa3ab=await approver_acct['aggregate']([{'$unwind':'$member'},{'$match':{'head_id_staff':_0x38a8c3['user'][_0x7e2398(0xb9)]}},{'$group':{'_id':{'id_member':'$member.id_member','name':_0x7e2398(0xfd)},'warehouse_staff_id':{'$first':'$warehouse_staff_id'}}},{'$addFields':{'warehouse_staff_id':{'$toObjectId':'$warehouse_staff_id'}}},{'$lookup':{'from':_0x7e2398(0xce),'localField':'warehouse_staff_id','foreignField':_0x7e2398(0xa2),'as':_0x7e2398(0xb4)}},{'$unwind':_0x7e2398(0xe7)}]);if(_0x3fa3ab['length']==0x0)return _0x38a8c3[_0x7e2398(0xfa)](_0x7e2398(0xed),_0x7e2398(0x11a)),_0x9556e0[_0x7e2398(0x9e)]('back');const _0x4632d6=_0x56ca68[_0x7e2398(0x9f)](_0xd7b50f=>{return _0xd7b50f={'prod_id':_0xd7b50f};});_0xf5f00a[_0x7e2398(0xa6)]((_0x11ef02,_0x22353e)=>{_0x4632d6[_0x22353e]['accounting_discount']=_0x11ef02;});for(let _0x1878c6=0x0;_0x1878c6<=_0x48b41b[_0x7e2398(0xec)][_0x7e2398(0xe0)]-0x1;_0x1878c6++){const _0x126c58=_0x48b41b[_0x7e2398(0xec)][_0x1878c6];for(let _0x314e03=0x0;_0x314e03<=_0x4632d6[_0x7e2398(0xe0)]-0x1;_0x314e03++){const _0x300e3d=_0x4632d6[_0x314e03];_0x126c58[_0x7e2398(0xa2)][_0x7e2398(0xcf)]()==_0x300e3d[_0x7e2398(0xe9)]&&await sales_order[_0x7e2398(0x109)]({'_id':_0x3ce193,'sale_product._id':_0x300e3d[_0x7e2398(0xe9)]},{'$set':{'sale_product.$.accounting_discount':_0x300e3d[_0x7e2398(0xdb)]}});}}const _0x2eb3f3=new Date(),_0x31f958=_0x2eb3f3[_0x7e2398(0xbc)]();_0x48b41b['accounting_account_confirm']=_0x328e53,_0x48b41b[_0x7e2398(0xae)]=_0x31f958,_0x48b41b[_0x7e2398(0xa7)]=_0x3fa3ab[0x0][_0x7e2398(0xb4)]['_id'],await _0x48b41b[_0x7e2398(0x118)]();const _0x3de268=await master_shop['find'](),_0x8439b3=await email_settings[_0x7e2398(0xb7)]();let _0x3812b1=nodemailer[_0x7e2398(0xfb)]({'host':_0x8439b3[_0x7e2398(0x115)],'port':Number(_0x8439b3['port']),'secure':![],'auth':{'user':_0x8439b3['email'],'pass':_0x8439b3[_0x7e2398(0x10c)]}});const _0x2cf256=_0x38a8c3[_0x7e2398(0xcb)]+'://'+_0x38a8c3[_0x7e2398(0x98)]['host'];var _0x11c025=_0x48b41b[_0x7e2398(0xec)],_0x1ed335='',_0x11a786,_0x1347cb=0x0;for(_0x11a786 in _0x11c025){_0x1ed335+='<tr>'+_0x7e2398(0x9c)+_0x11c025[_0x11a786][_0x7e2398(0xaa)]+'</td>'+_0x7e2398(0x9c)+_0x11c025[_0x11a786][_0x7e2398(0xde)]+_0x7e2398(0x10b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x11c025[_0x11a786][_0x7e2398(0xe6)]+_0x7e2398(0x10b)+_0x7e2398(0x9c)+_0x11c025[_0x11a786]['unit']+_0x7e2398(0x10b)+_0x7e2398(0x9a),_0x1347cb+=parseInt(_0x11c025[_0x11a786]['quantity']);}let _0x405685={'from':_0x8439b3[_0x7e2398(0xf1)],'to':_0x7e2398(0x114),'subject':'Approval\x20for\x20'+_0x48b41b[_0x7e2398(0xe3)],'attachments':[{'filename':_0x7e2398(0xf5),'path':__dirname+_0x7e2398(0xa0)+'/upload/'+_0x3de268[0x0]['image'],'cid':_0x7e2398(0xa8)}],'html':_0x7e2398(0xe2)+_0x7e2398(0x113)+_0x7e2398(0xc9)+_0x7e2398(0xfc)+'<div>'+_0x7e2398(0x119)+_0x7e2398(0xb1)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x7e2398(0xb1)+_0x7e2398(0x11b)+_0x7e2398(0x10d)+_0x7e2398(0x10d)+_0x7e2398(0x107)+_0x7e2398(0xb1)+_0x7e2398(0xc8)+_0x3fa3ab[0x0]['warehouse_info'][_0x7e2398(0xa9)]+_0x7e2398(0xa4)+_0x7e2398(0x10d)+_0x7e2398(0xb1)+_0x7e2398(0xd1)+_0x7e2398(0x10d)+_0x7e2398(0xb1)+'<span>\x20Request\x20ID:\x20<b>'+_0x48b41b[_0x7e2398(0xe3)]+_0x7e2398(0xdd)+_0x7e2398(0xbb)+_0x371914[_0x7e2398(0xa9)]+_0x7e2398(0xdd)+'<span>\x20Request\x20Date:\x20<b>'+_0x48b41b[_0x7e2398(0x116)]+_0x7e2398(0xb6)+_0x7e2398(0x10d)+_0x7e2398(0xf0)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x7e2398(0xe8)+_0x7e2398(0xf4)+_0x7e2398(0xc4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x7e2398(0xab)+_0x7e2398(0x9a)+_0x7e2398(0xb2)+_0x7e2398(0xc5)+'\x20'+_0x1ed335+'\x20'+'</tbody>'+_0x7e2398(0xc6)+_0x7e2398(0xb1)+_0x7e2398(0xaf)+_0x1347cb+_0x7e2398(0xc0)+_0x7e2398(0xd0)+_0x7e2398(0xb5)+'<br><br><br>'+_0x7e2398(0x10d)+_0x7e2398(0x102)+_0x7e2398(0xd3)+_0x2cf256+_0x7e2398(0xfe)+_0x48b41b[_0x7e2398(0xa2)]+_0x7e2398(0x117)+_0x7e2398(0xf3)+_0x7e2398(0x10d)+'<div>'+_0x7e2398(0xad)+_0x7e2398(0xe4)+_0x7e2398(0x10d)+_0x7e2398(0x10d)+'<script\x20src=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\x22\x20integrity=\x22sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz\x22\x20crossorigin=\x22anonymous\x22></script>'+_0x7e2398(0xe5)};_0x3812b1[_0x7e2398(0xb3)](_0x405685,function(_0x417683,_0x5a3631){const _0x47cb87=_0x7e2398;_0x417683?(console['log'](_0x417683),console[_0x47cb87(0xd7)](_0x47cb87(0xa5))):console[_0x47cb87(0xd7)]('Email\x20sent\x20successfully');}),_0x38a8c3[_0x7e2398(0xfa)]('success',_0x7e2398(0xee)),_0x9556e0[_0x7e2398(0x9e)](_0x7e2398(0xea)+_0x48b41b[_0x7e2398(0xa2)]);}catch(_0x1e0de1){}}),router[a0_0x507cd5(0x100)]('/view_sales_order/:id',auth,async(_0x291e95,_0x236bb8)=>{const _0x218968=a0_0x507cd5;try{const _0x356327=await master_shop[_0x218968(0xd8)](),_0x3a864c=_0x291e95[_0x218968(0xdc)],_0x2d1a68=await profile['findOne']({'email':_0x3a864c[_0x218968(0xf1)]}),_0xa14f51=await staff['findOne']({'email':_0x3a864c['email']}),_0x4726a5=await customer[_0x218968(0xd8)]({'agent_id':_0xa14f51[_0x218968(0xa2)]}),_0x1e3d01=mongoose['Types'][_0x218968(0xba)],_0x45dbf0=_0x291e95['params']['id'],_0x4d0f3f=await sales_order[_0x218968(0xe1)](_0x45dbf0),_0xa4f59f=await sales_order[_0x218968(0xcd)]([{'$match':{'_id':_0x1e3d01(_0x45dbf0)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x218968(0xf2)}}},{'$addFields':{'wms_account_id':{'$toObjectId':_0x218968(0xf8)}}},{'$lookup':{'from':_0x218968(0xce),'localField':'accounting_account_id','foreignField':_0x218968(0xa2),'as':_0x218968(0xb8)}},{'$unwind':'$account_data'},{'$lookup':{'from':_0x218968(0xce),'localField':'wms_account_id','foreignField':'_id','as':_0x218968(0xa3)}},{'$unwind':_0x218968(0xd6)}]);if(_0x356327[0x0]['language']==_0x218968(0xca))var _0x2d4f24=users['English'];else{if(_0x356327[0x0]['language']==_0x218968(0xa1))var _0x2d4f24=users[_0x218968(0xa1)];else{if(_0x356327[0x0][_0x218968(0xbd)]==_0x218968(0x9d))var _0x2d4f24=users[_0x218968(0x9d)];else{if(_0x356327[0x0][_0x218968(0xbd)]==_0x218968(0x103))var _0x2d4f24=users[_0x218968(0x103)];else{if(_0x356327[0x0][_0x218968(0xbd)]==_0x218968(0xdf))var _0x2d4f24=users[_0x218968(0xdf)];else{if(_0x356327[0x0][_0x218968(0xbd)]=='Portuguese\x20(BR)')var _0x2d4f24=users[_0x218968(0x99)];else{if(_0x356327[0x0][_0x218968(0xbd)]==_0x218968(0x9b))var _0x2d4f24=users[_0x218968(0x9b)];else{if(_0x356327[0x0][_0x218968(0xbd)]=='Arabic\x20(ae)')var _0x2d4f24=users[_0x218968(0xac)];}}}}}}}_0x236bb8['render'](_0x218968(0xf7),{'success':_0x291e95['flash'](_0x218968(0x10a)),'errors':_0x291e95[_0x218968(0xfa)]('errors'),'master_shop':_0x356327,'profile':_0x2d1a68,'role':_0x3a864c,'language':_0x2d4f24,'customer':_0x4726a5,'sales_sa':_0x4d0f3f,'approvers':_0xa4f59f[0x0],'the_id':_0x45dbf0});}catch(_0x15bfb7){console[_0x218968(0xd7)](_0x15bfb7);}}),router[a0_0x507cd5(0x100)]('/data/All',auth,async(_0x1d3935,_0x281f84)=>{const _0x169702=a0_0x507cd5;try{const {sttaff_id:_0x5e5477,email:_0x5812fe,warehouse:_0x543339}=_0x1d3935[_0x169702(0xdc)],_0x402142=await master_shop[_0x169702(0xd8)](),_0xabd4e1=_0x1d3935[_0x169702(0xdc)],_0x351ecd=await profile[_0x169702(0xb7)]({'email':_0xabd4e1['email']}),_0x64c67=await sales_order[_0x169702(0xd8)]({'accounting_account_id':_0x5e5477});if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0xca))var _0x6a3ad3=users[_0x169702(0xf9)];else{if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0xa1))var _0x6a3ad3=users[_0x169702(0xa1)];else{if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0x9d))var _0x6a3ad3=users['German'];else{if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0x103))var _0x6a3ad3=users[_0x169702(0x103)];else{if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0xdf))var _0x6a3ad3=users['French'];else{if(_0x402142[0x0]['language']==_0x169702(0x101))var _0x6a3ad3=users[_0x169702(0x99)];else{if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0x9b))var _0x6a3ad3=users[_0x169702(0x9b)];else{if(_0x402142[0x0][_0x169702(0xbd)]==_0x169702(0xb0))var _0x6a3ad3=users['Arabic'];}}}}}}}_0x281f84['render'](_0x169702(0x11c),{'success':_0x1d3935['flash'](_0x169702(0x10a)),'errors':_0x1d3935['flash'](_0x169702(0xed)),'master_shop':_0x402142,'profile':_0x351ecd,'role':_0xabd4e1,'language':_0x6a3ad3,'sales_order':_0x64c67});}catch(_0x499e2d){}}),module[a0_0x507cd5(0x106)]=router;