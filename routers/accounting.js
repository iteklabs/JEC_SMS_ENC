const a0_0x2a948a=a0_0x522a;(function(_0x8e0f8b,_0x5aedcd){const _0x3f2c56=a0_0x522a,_0x4e8311=_0x8e0f8b();while(!![]){try{const _0x4b4241=-parseInt(_0x3f2c56(0xe2))/0x1+-parseInt(_0x3f2c56(0x91))/0x2+-parseInt(_0x3f2c56(0x8a))/0x3+-parseInt(_0x3f2c56(0x7a))/0x4+-parseInt(_0x3f2c56(0x76))/0x5+-parseInt(_0x3f2c56(0x8d))/0x6*(-parseInt(_0x3f2c56(0x7f))/0x7)+parseInt(_0x3f2c56(0xa9))/0x8;if(_0x4b4241===_0x5aedcd)break;else _0x4e8311['push'](_0x4e8311['shift']());}catch(_0x596829){_0x4e8311['push'](_0x4e8311['shift']());}}}(a0_0x595e,0xb94d9));const express=require(a0_0x2a948a(0xb4)),app=express(),router=express[a0_0x2a948a(0xdb)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sales_order,invoice_sa,sales_sa,invoice_for_sales_order,approver_acct,email_settings}=require(a0_0x2a948a(0xa1)),auth=require(a0_0x2a948a(0xdd)),users=require('../public/language/languages.json'),excelJS=require(a0_0x2a948a(0xcf)),xlsx=require(a0_0x2a948a(0xd6)),mongoose=require(a0_0x2a948a(0x7c)),{ObjectId}=require(a0_0x2a948a(0x88)),nodemailer=require('nodemailer');function a0_0x522a(_0x4b0a7e,_0x18a0e4){const _0x595e09=a0_0x595e();return a0_0x522a=function(_0x522ae3,_0x31433f){_0x522ae3=_0x522ae3-0x6d;let _0x5093f8=_0x595e09[_0x522ae3];return _0x5093f8;},a0_0x522a(_0x4b0a7e,_0x18a0e4);}function a0_0x595e(){const _0x197e3f=['accounting_account_confirm','port','<br><br><br>','staffs','exceljs','prod_id','<hr\x20class=\x22my-3\x22>','</b></span>\x20<br><br>','<div>','Arabic','/../public','xlsx','save','</thead>','render','<tr>','Router','logo','../middleware/auth','christian.villamer@jakagroup.com','<html><head><title></title>','accounting_approval','<span>\x20Request\x20ID:\x20<b>','875829RVgdFg','No\x20Approvers\x20Set\x20Please\x20contact\x20admin\x20to\x20setup','</tr>','wms_data','$account_data','password','German','body','</b>,\x20</span><br>','<h5>\x20JEC\x20SMS\x20</h5>','redirect','date','forEach','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/:id','<div\x20style=\x22text-align:\x20center;\x22>','findById','</div>','/view_sales_order/:id','protocol','$wms_account_id','view_accounting_approval','942695bxauXO','headers','ObjectId','accounting_discount','4690852NFNRtl','Hindi','mongoose','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','4489324sIvYRC','quantity','params','<span>\x20lease\x20review\x20the\x20request\x20and\x20approve\x20it\x20if\x20it\x20aligns\x20with\x20our\x20operational\x20needs.\x20If\x20you\x20have\x20any\x20questions\x20or\x20require\x20further\x20information,\x20please\x20feel\x20free\x20to\x20reach\x20out\x20to\x20the\x20Sales\x20Department.\x20</span>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Spanish','aggregate','host','English\x20(US)','mongodb','accounting_account_id','2680209tuNZGe','find','flash','12ceBVrK','length','$member.id_member','createTransport','1986194AhmUWr','warehouse_info','</b></span>\x20<br>','wms_account_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','get','<link\x20href=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\x22\x20rel=\x22stylesheet\x22\x20integrity=\x22sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\x22\x20crossorigin=\x22anonymous\x22>','/upload/','<span>\x20A\x20product\x20request\x20has\x20been\x20submitted\x20by\x20the\x20Sales\x20Department\x20and\x20Approved\x20by\x20Accounting\x20that\x20requires\x20your\x20approval.\x20Below\x20are\x20the\x20details:\x20</span>\x20<br><br>','</head><body>','accounting_approval_All','French','user','$member.name','/accounting_approval/view_sales_order/','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','../models/all_models','Chinese','Portuguese','account_data','name','$warehouse_staff_id','$accounting_account_id','warehouse_staff_id','28799344wDkgbp','$warehouse_info','Sales\x20Order\x20is\x20changed\x20status','Arabic\x20(ae)','product_name','sale_product','success','Logo.png','accounting_account_date','English','</tbody>','express','toLocaleDateString','$wms_data','<script\x20src=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\x22\x20integrity=\x22sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz\x22\x20crossorigin=\x22anonymous\x22></script>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<span>\x20Request\x20Date:\x20<b>','string','invoice','_id','exports','language','sttaff_id','Error\x20Occurs','findOne','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</td>','email','errors','valueOf','</body></html>','log','back','<a\x20style=\x22background-color:\x20#007bff;\x20color:\x20#ffffff;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x205px;\x22\x20href=\x22'];a0_0x595e=function(){return _0x197e3f;};return a0_0x595e();}router[a0_0x2a948a(0x96)](a0_0x2a948a(0x6e),auth,async(_0x2d9a5e,_0x1a48cb)=>{const _0x385545=a0_0x2a948a;try{const _0x2ec07d=await master_shop['find'](),_0x27ab25=_0x2d9a5e[_0x385545(0x9d)],_0x2e4eb3=await profile['findOne']({'email':_0x27ab25[_0x385545(0xc4)]}),_0x596f99=await staff['findOne']({'email':_0x27ab25['email']}),_0x19a0b7=await customer[_0x385545(0x8b)]({'agent_id':_0x596f99['_id']}),_0x58674a=mongoose['Types'][_0x385545(0x78)],_0x4fd137=_0x2d9a5e[_0x385545(0x81)]['id'],_0x1fbec5=await sales_order[_0x385545(0x70)](_0x4fd137),_0x3b7e29=await sales_order[_0x385545(0x85)]([{'$match':{'_id':_0x58674a(_0x4fd137)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x385545(0xa7)}}},{'$addFields':{'wms_account_id':{'$toObjectId':_0x385545(0x74)}}},{'$lookup':{'from':'staffs','localField':_0x385545(0x89),'foreignField':_0x385545(0xbc),'as':_0x385545(0xa4)}},{'$unwind':_0x385545(0xe6)},{'$lookup':{'from':_0x385545(0xce),'localField':_0x385545(0x94),'foreignField':_0x385545(0xbc),'as':'wms_data'}},{'$unwind':{'path':_0x385545(0xb6),'preserveNullAndEmptyArrays':!![]}}]);if(_0x2ec07d[0x0][_0x385545(0xbe)]==_0x385545(0x87))var _0x4bb209=users[_0x385545(0xb2)];else{if(_0x2ec07d[0x0][_0x385545(0xbe)]==_0x385545(0x7b))var _0x4bb209=users[_0x385545(0x7b)];else{if(_0x2ec07d[0x0][_0x385545(0xbe)]==_0x385545(0xe8))var _0x4bb209=users[_0x385545(0xe8)];else{if(_0x2ec07d[0x0]['language']=='Spanish')var _0x4bb209=users[_0x385545(0x84)];else{if(_0x2ec07d[0x0]['language']==_0x385545(0x9c))var _0x4bb209=users['French'];else{if(_0x2ec07d[0x0]['language']==_0x385545(0x7d))var _0x4bb209=users[_0x385545(0xa3)];else{if(_0x2ec07d[0x0][_0x385545(0xbe)]==_0x385545(0xa2))var _0x4bb209=users[_0x385545(0xa2)];else{if(_0x2ec07d[0x0][_0x385545(0xbe)]=='Arabic\x20(ae)')var _0x4bb209=users[_0x385545(0xd4)];}}}}}}}_0x1a48cb[_0x385545(0xd9)](_0x385545(0xe0),{'success':_0x2d9a5e['flash'](_0x385545(0xaf)),'errors':_0x2d9a5e[_0x385545(0x8c)](_0x385545(0xc5)),'master_shop':_0x2ec07d,'profile':_0x2e4eb3,'role':_0x27ab25,'language':_0x4bb209,'customer':_0x19a0b7,'sales_sa':_0x1fbec5,'approvers':_0x3b7e29[0x0],'the_id':_0x4fd137});}catch(_0x3793b7){console['log'](_0x3793b7);}}),router['post'](a0_0x2a948a(0x6e),auth,async(_0x3400ef,_0x4ecf45)=>{const _0x47e145=a0_0x2a948a;try{const {accounting_discount:_0x114f8d,accounting_confirm:_0x5e9f2d,wms_confirm:_0x3bed70,the_id_val:_0xc4a715,invoice:_0xf7c4,prod_id:_0x280f60}=_0x3400ef[_0x47e145(0xe9)],_0x1104b7=await sales_order[_0x47e145(0x70)](_0xc4a715),_0x4b88b0=_0x3400ef[_0x47e145(0x9d)],_0x27b2e4=await staff[_0x47e145(0xc1)]({'email':_0x4b88b0[_0x47e145(0xc4)]});if(typeof _0x280f60==_0x47e145(0xba))var _0x59b001=[_0x3400ef[_0x47e145(0xe9)]['prod_id']],_0xb9e881=[_0x3400ef[_0x47e145(0xe9)]['accounting_discount']];else var _0x59b001=[..._0x3400ef[_0x47e145(0xe9)][_0x47e145(0xd0)]],_0xb9e881=[..._0x3400ef['body'][_0x47e145(0x79)]];const _0x365fc0=await approver_acct[_0x47e145(0x85)]([{'$unwind':'$member'},{'$match':{'head_id_staff':_0x3400ef[_0x47e145(0x9d)][_0x47e145(0xbf)]}},{'$group':{'_id':{'id_member':_0x47e145(0x8f),'name':_0x47e145(0x9e)},'warehouse_staff_id':{'$first':_0x47e145(0xa6)}}},{'$addFields':{'warehouse_staff_id':{'$toObjectId':_0x47e145(0xa6)}}},{'$lookup':{'from':_0x47e145(0xce),'localField':_0x47e145(0xa8),'foreignField':_0x47e145(0xbc),'as':_0x47e145(0x92)}},{'$unwind':_0x47e145(0xaa)}]);if(_0x365fc0[_0x47e145(0x8e)]==0x0)return _0x3400ef[_0x47e145(0x8c)]('errors',_0x47e145(0xe3)),_0x4ecf45[_0x47e145(0xec)](_0x47e145(0xc9));const _0x27b8c3=_0x59b001['map'](_0x2a1a52=>{return _0x2a1a52={'prod_id':_0x2a1a52};});_0xb9e881[_0x47e145(0xee)]((_0x2a4a8d,_0x337ed6)=>{const _0x50b748=_0x47e145;_0x27b8c3[_0x337ed6][_0x50b748(0x79)]=_0x2a4a8d;});for(let _0x315680=0x0;_0x315680<=_0x1104b7[_0x47e145(0xae)][_0x47e145(0x8e)]-0x1;_0x315680++){const _0x2c9728=_0x1104b7['sale_product'][_0x315680];for(let _0x46a320=0x0;_0x46a320<=_0x27b8c3[_0x47e145(0x8e)]-0x1;_0x46a320++){const _0x1ddec2=_0x27b8c3[_0x46a320];_0x2c9728[_0x47e145(0xbc)][_0x47e145(0xc6)]()==_0x1ddec2[_0x47e145(0xd0)]&&await sales_order['updateOne']({'_id':_0xc4a715,'sale_product._id':_0x1ddec2[_0x47e145(0xd0)]},{'$set':{'sale_product.$.accounting_discount':_0x1ddec2[_0x47e145(0x79)]}});}}const _0xd00144=new Date(),_0x4a4dac=_0xd00144[_0x47e145(0xb5)]();_0x1104b7[_0x47e145(0xcb)]=_0x5e9f2d,_0x1104b7[_0x47e145(0xb1)]=_0x4a4dac,_0x1104b7[_0x47e145(0x94)]=_0x365fc0[0x0][_0x47e145(0x92)][_0x47e145(0xbc)],await _0x1104b7[_0x47e145(0xd7)]();const _0x324bd6=await master_shop[_0x47e145(0x8b)](),_0x2386de=await email_settings[_0x47e145(0xc1)]();let _0x1bfcfa=nodemailer[_0x47e145(0x90)]({'host':_0x2386de[_0x47e145(0x86)],'port':Number(_0x2386de[_0x47e145(0xcc)]),'secure':![],'auth':{'user':_0x2386de['email'],'pass':_0x2386de[_0x47e145(0xe7)]}});const _0xb73e18=_0x3400ef[_0x47e145(0x73)]+'://'+_0x3400ef[_0x47e145(0x77)]['host'];var _0x4b53e0=_0x1104b7['sale_product'],_0x2eddec='',_0x34736c,_0x5c95a6=0x0;for(_0x34736c in _0x4b53e0){_0x2eddec+=_0x47e145(0xda)+_0x47e145(0xc2)+_0x4b53e0[_0x34736c][_0x47e145(0xad)]+_0x47e145(0xc3)+_0x47e145(0xc2)+_0x4b53e0[_0x34736c]['product_code']+_0x47e145(0xc3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b53e0[_0x34736c][_0x47e145(0x80)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b53e0[_0x34736c]['unit']+_0x47e145(0xc3)+_0x47e145(0xe4),_0x5c95a6+=parseInt(_0x4b53e0[_0x34736c][_0x47e145(0x80)]);}let _0x392e49={'from':_0x2386de[_0x47e145(0xc4)],'to':_0x47e145(0xde),'subject':'Approval\x20for\x20'+_0x1104b7[_0x47e145(0xbb)],'attachments':[{'filename':_0x47e145(0xb0),'path':__dirname+_0x47e145(0xd5)+_0x47e145(0x98)+_0x324bd6[0x0]['image'],'cid':_0x47e145(0xdc)}],'html':'<!DOCTYPE\x20html>'+_0x47e145(0xdf)+_0x47e145(0x97)+_0x47e145(0x9a)+_0x47e145(0xd3)+_0x47e145(0xef)+_0x47e145(0xd3)+_0x47e145(0x83)+_0x47e145(0x71)+_0x47e145(0xd3)+'<h2>\x20JEC\x20SMS\x20</h2>'+_0x47e145(0x71)+_0x47e145(0x71)+_0x47e145(0xd1)+'<div>'+'<span>\x20Dear\x20<b>'+_0x365fc0[0x0][_0x47e145(0x92)]['name']+_0x47e145(0xea)+_0x47e145(0x71)+_0x47e145(0xd3)+_0x47e145(0x99)+'</div>'+_0x47e145(0xd3)+_0x47e145(0xe1)+_0x1104b7['invoice']+_0x47e145(0x93)+'<span>\x20Requested\x20By:\x20<b>'+_0x27b2e4[_0x47e145(0xa5)]+_0x47e145(0x93)+_0x47e145(0xb9)+_0x1104b7[_0x47e145(0xed)]+_0x47e145(0xd2)+_0x47e145(0x71)+_0x47e145(0x6d)+_0x47e145(0xa0)+_0x47e145(0xda)+_0x47e145(0x95)+_0x47e145(0xb8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x47e145(0x7e)+'</tr>'+_0x47e145(0xd8)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2eddec+'\x20'+_0x47e145(0xb3)+'</table>'+'<div>'+'<br><br><span>\x20The\x20total\x20quantity\x20for\x20these\x20items\x20is\x20<b>'+_0x5c95a6+'</b>.\x20These\x20products\x20are\x20essential\x20to\x20improve\x20our\x20warehouse\x20efficiency\x20and\x20ensure\x20smooth\x20operations.\x20</span>'+_0x47e145(0x82)+'<span>\x20Thank\x20you\x20for\x20your\x20prompt\x20attention\x20to\x20this\x20matter.\x20</span>'+_0x47e145(0xcd)+_0x47e145(0x71)+_0x47e145(0x6f)+_0x47e145(0xca)+_0xb73e18+'/warehouse_approval/'+_0x1104b7[_0x47e145(0xbc)]+'\x22>Change\x20Status</a>'+'<br><br>'+_0x47e145(0x71)+_0x47e145(0xd3)+'<strong>\x20Regards\x20</strong>'+_0x47e145(0xeb)+_0x47e145(0x71)+_0x47e145(0x71)+_0x47e145(0xb7)+_0x47e145(0xc7)};_0x1bfcfa['sendMail'](_0x392e49,function(_0x2ce5fe,_0x2efaa5){const _0x585a79=_0x47e145;_0x2ce5fe?(console['log'](_0x2ce5fe),console[_0x585a79(0xc8)](_0x585a79(0xc0))):console[_0x585a79(0xc8)]('Email\x20sent\x20successfully');}),_0x3400ef['flash'](_0x47e145(0xaf),_0x47e145(0xab)),_0x4ecf45[_0x47e145(0xec)](_0x47e145(0x9f)+_0x1104b7[_0x47e145(0xbc)]);}catch(_0x549fe0){}}),router[a0_0x2a948a(0x96)](a0_0x2a948a(0x72),auth,async(_0x260a17,_0x51771e)=>{const _0x55a616=a0_0x2a948a;try{const _0x7dfc54=await master_shop[_0x55a616(0x8b)](),_0x39cfba=_0x260a17[_0x55a616(0x9d)],_0x50139c=await profile[_0x55a616(0xc1)]({'email':_0x39cfba[_0x55a616(0xc4)]}),_0x3dfbab=await staff[_0x55a616(0xc1)]({'email':_0x39cfba[_0x55a616(0xc4)]}),_0xe72cc0=await customer[_0x55a616(0x8b)]({'agent_id':_0x3dfbab['_id']}),_0xc5e111=mongoose['Types'][_0x55a616(0x78)],_0x439a82=_0x260a17[_0x55a616(0x81)]['id'],_0xa97d94=await sales_order['findById'](_0x439a82),_0x639bfb=await sales_order[_0x55a616(0x85)]([{'$match':{'_id':_0xc5e111(_0x439a82)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x55a616(0xa7)}}},{'$addFields':{'wms_account_id':{'$toObjectId':_0x55a616(0x74)}}},{'$lookup':{'from':'staffs','localField':_0x55a616(0x89),'foreignField':'_id','as':'account_data'}},{'$unwind':_0x55a616(0xe6)},{'$lookup':{'from':_0x55a616(0xce),'localField':'wms_account_id','foreignField':_0x55a616(0xbc),'as':_0x55a616(0xe5)}},{'$unwind':_0x55a616(0xb6)}]);if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0x87))var _0x57d186=users[_0x55a616(0xb2)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0x7b))var _0x57d186=users[_0x55a616(0x7b)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0xe8))var _0x57d186=users[_0x55a616(0xe8)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0x84))var _0x57d186=users[_0x55a616(0x84)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]=='French')var _0x57d186=users[_0x55a616(0x9c)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0x7d))var _0x57d186=users[_0x55a616(0xa3)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0xa2))var _0x57d186=users[_0x55a616(0xa2)];else{if(_0x7dfc54[0x0][_0x55a616(0xbe)]==_0x55a616(0xac))var _0x57d186=users[_0x55a616(0xd4)];}}}}}}}_0x51771e['render'](_0x55a616(0x75),{'success':_0x260a17[_0x55a616(0x8c)](_0x55a616(0xaf)),'errors':_0x260a17[_0x55a616(0x8c)](_0x55a616(0xc5)),'master_shop':_0x7dfc54,'profile':_0x50139c,'role':_0x39cfba,'language':_0x57d186,'customer':_0xe72cc0,'sales_sa':_0xa97d94,'approvers':_0x639bfb[0x0],'the_id':_0x439a82});}catch(_0x2e4ecc){console[_0x55a616(0xc8)](_0x2e4ecc);}}),router[a0_0x2a948a(0x96)]('/data/All',auth,async(_0x3e1585,_0x14a518)=>{const _0x262320=a0_0x2a948a;try{const {sttaff_id:_0x4da7e4,email:_0x4f3e06,warehouse:_0x5368f7}=_0x3e1585[_0x262320(0x9d)],_0x4f860e=await master_shop[_0x262320(0x8b)](),_0x1917ae=_0x3e1585['user'],_0x47c138=await profile['findOne']({'email':_0x1917ae['email']}),_0x1ed108=await sales_order[_0x262320(0x8b)]({'accounting_account_id':_0x4da7e4});if(_0x4f860e[0x0]['language']==_0x262320(0x87))var _0xaf18cc=users[_0x262320(0xb2)];else{if(_0x4f860e[0x0][_0x262320(0xbe)]=='Hindi')var _0xaf18cc=users[_0x262320(0x7b)];else{if(_0x4f860e[0x0][_0x262320(0xbe)]==_0x262320(0xe8))var _0xaf18cc=users[_0x262320(0xe8)];else{if(_0x4f860e[0x0][_0x262320(0xbe)]==_0x262320(0x84))var _0xaf18cc=users[_0x262320(0x84)];else{if(_0x4f860e[0x0][_0x262320(0xbe)]==_0x262320(0x9c))var _0xaf18cc=users[_0x262320(0x9c)];else{if(_0x4f860e[0x0]['language']==_0x262320(0x7d))var _0xaf18cc=users[_0x262320(0xa3)];else{if(_0x4f860e[0x0][_0x262320(0xbe)]==_0x262320(0xa2))var _0xaf18cc=users['Chinese'];else{if(_0x4f860e[0x0]['language']==_0x262320(0xac))var _0xaf18cc=users['Arabic'];}}}}}}}_0x14a518['render'](_0x262320(0x9b),{'success':_0x3e1585[_0x262320(0x8c)]('success'),'errors':_0x3e1585['flash'](_0x262320(0xc5)),'master_shop':_0x4f860e,'profile':_0x47c138,'role':_0x1917ae,'language':_0xaf18cc,'sales_order':_0x1ed108});}catch(_0xd6b3c){}}),module[a0_0x2a948a(0xbd)]=router;