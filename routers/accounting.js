const a0_0x1f672a=a0_0x20b5;function a0_0x20b5(_0x20d40a,_0x361511){const _0x227a28=a0_0x227a();return a0_0x20b5=function(_0x20b500,_0x12432b){_0x20b500=_0x20b500-0x127;let _0x55aef3=_0x227a28[_0x20b500];return _0x55aef3;},a0_0x20b5(_0x20d40a,_0x361511);}(function(_0x55e78a,_0x3bca6c){const _0x2b8a1c=a0_0x20b5,_0x22381b=_0x55e78a();while(!![]){try{const _0x3beac3=parseInt(_0x2b8a1c(0x150))/0x1+parseInt(_0x2b8a1c(0x198))/0x2+-parseInt(_0x2b8a1c(0x191))/0x3+parseInt(_0x2b8a1c(0x18b))/0x4*(parseInt(_0x2b8a1c(0x141))/0x5)+-parseInt(_0x2b8a1c(0x1a7))/0x6+-parseInt(_0x2b8a1c(0x12a))/0x7+-parseInt(_0x2b8a1c(0x187))/0x8*(-parseInt(_0x2b8a1c(0x12b))/0x9);if(_0x3beac3===_0x3bca6c)break;else _0x22381b['push'](_0x22381b['shift']());}catch(_0x3f125b){_0x22381b['push'](_0x22381b['shift']());}}}(a0_0x227a,0xe4519));function a0_0x227a(){const _0x4d1669=['<a\x20style=\x22background-color:\x20#007bff;\x20color:\x20#ffffff;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x205px;\x22\x20href=\x22','<tr>','Hindi','German','</body></html>','params','/view_sales_order/:id','_id','<html><head><title></title>','<span>\x20Request\x20Date:\x20<b>','</div>','</b></span>\x20<br>','accounting_discount','language','updateOne','4955boFsBr','<span>\x20Requested\x20By:\x20<b>','warehouse_info','name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</b>,\x20</span><br>','redirect','Logo.png','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','back','English\x20(US)','/warehouse_approval/','log','Portuguese','warehouse_staff_id','434332gZWlVP','$accounting_account_id','flash','../middleware/auth','account_data','$warehouse_staff_id','<link\x20href=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\x22\x20rel=\x22stylesheet\x22\x20integrity=\x22sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\x22\x20crossorigin=\x22anonymous\x22>','$account_data','<strong>\x20Regards\x20</strong>','wms_account_id','<span>\x20Request\x20ID:\x20<b>','mongoose','sttaff_id','French','toLocaleDateString','/accounting_approval/view_sales_order/','prod_id','$member','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','success','headers','/:id','quantity','Arabic','valueOf','length','string','$wms_data','date','mongodb','English','Router','createTransport','sendMail','$member.name','ObjectId','<span>\x20A\x20product\x20request\x20has\x20been\x20submitted\x20by\x20the\x20Sales\x20Department\x20and\x20Approved\x20by\x20Accounting\x20that\x20requires\x20your\x20approval.\x20Below\x20are\x20the\x20details:\x20</span>\x20<br><br>','product_code','get','body','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Sales\x20Order\x20is\x20changed\x20status','<span>\x20Thank\x20you\x20for\x20your\x20prompt\x20attention\x20to\x20this\x20matter.\x20</span>','render','<table\x20style=\x22width:\x20100%\x20!important;\x22>','email','product_name','accounting_account_id','sale_product','<!DOCTYPE\x20html>','<br><br>','find','user','3213992MXxAlC','<div>','$warehouse_info','staffs','5492eopoel','aggregate','<span>\x20Dear\x20<b>','forEach','port','Portuguese\x20(BR)','2553255eCBWJc','express','/upload/','</b>.\x20These\x20products\x20are\x20essential\x20to\x20improve\x20our\x20warehouse\x20efficiency\x20and\x20ensure\x20smooth\x20operations.\x20</span>','Error\x20Occurs','Approval\x20for\x20','Arabic\x20(ae)','1377334dRYuoe','/../public','findById','</thead>','unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','nodemailer','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','findOne','Types','<script\x20src=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\x22\x20integrity=\x22sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz\x22\x20crossorigin=\x22anonymous\x22></script>','view_accounting_approval','No\x20Approvers\x20Set\x20Please\x20contact\x20admin\x20to\x20setup','<hr\x20class=\x22my-3\x22>','</tr>','3646536VnjrqQ','xlsx','Spanish','</table>','errors','6251742IvhYqz','18YcRkjf','Chinese','christian.villamer@jakagroup.com','<h2>\x20JEC\x20SMS\x20</h2>','exports','wms_data','accounting_approval'];a0_0x227a=function(){return _0x4d1669;};return a0_0x227a();}const express=require(a0_0x1f672a(0x192)),app=express(),router=express[a0_0x1f672a(0x170)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sales_order,invoice_sa,sales_sa,invoice_for_sales_order,approver_acct,email_settings}=require('../models/all_models'),auth=require(a0_0x1f672a(0x153)),users=require('../public/language/languages.json'),excelJS=require('exceljs'),xlsx=require(a0_0x1f672a(0x1a8)),mongoose=require(a0_0x1f672a(0x15b)),{ObjectId}=require(a0_0x1f672a(0x16e)),nodemailer=require(a0_0x1f672a(0x19e));router[a0_0x1f672a(0x177)]('/:id',auth,async(_0x2ed33c,_0x26e491)=>{const _0xf4516c=a0_0x1f672a;try{const _0x16648e=await master_shop['find'](),_0x2e23dc=_0x2ed33c[_0xf4516c(0x186)],_0x4b50a9=await profile[_0xf4516c(0x1a0)]({'email':_0x2e23dc[_0xf4516c(0x17f)]}),_0x350258=await staff[_0xf4516c(0x1a0)]({'email':_0x2e23dc[_0xf4516c(0x17f)]}),_0x1117d6=await customer[_0xf4516c(0x185)]({'agent_id':_0x350258[_0xf4516c(0x139)]}),_0x2bbf37=mongoose[_0xf4516c(0x1a1)][_0xf4516c(0x174)],_0x44fb36=_0x2ed33c[_0xf4516c(0x137)]['id'],_0x332829=await sales_order[_0xf4516c(0x19a)](_0x44fb36),_0x9b996=await sales_order[_0xf4516c(0x18c)]([{'$match':{'_id':_0x2bbf37(_0x44fb36)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0xf4516c(0x151)}}},{'$addFields':{'wms_account_id':{'$toObjectId':'$wms_account_id'}}},{'$lookup':{'from':_0xf4516c(0x18a),'localField':_0xf4516c(0x181),'foreignField':_0xf4516c(0x139),'as':_0xf4516c(0x154)}},{'$unwind':_0xf4516c(0x157)},{'$lookup':{'from':_0xf4516c(0x18a),'localField':'wms_account_id','foreignField':_0xf4516c(0x139),'as':_0xf4516c(0x130)}},{'$unwind':{'path':_0xf4516c(0x16c),'preserveNullAndEmptyArrays':!![]}}]);if(_0x16648e[0x0]['language']==_0xf4516c(0x14b))var _0x46ff3d=users['English'];else{if(_0x16648e[0x0]['language']==_0xf4516c(0x134))var _0x46ff3d=users['Hindi'];else{if(_0x16648e[0x0][_0xf4516c(0x13f)]==_0xf4516c(0x135))var _0x46ff3d=users[_0xf4516c(0x135)];else{if(_0x16648e[0x0][_0xf4516c(0x13f)]==_0xf4516c(0x127))var _0x46ff3d=users[_0xf4516c(0x127)];else{if(_0x16648e[0x0][_0xf4516c(0x13f)]==_0xf4516c(0x15d))var _0x46ff3d=users[_0xf4516c(0x15d)];else{if(_0x16648e[0x0][_0xf4516c(0x13f)]==_0xf4516c(0x190))var _0x46ff3d=users['Portuguese'];else{if(_0x16648e[0x0]['language']==_0xf4516c(0x12c))var _0x46ff3d=users['Chinese'];else{if(_0x16648e[0x0][_0xf4516c(0x13f)]=='Arabic\x20(ae)')var _0x46ff3d=users[_0xf4516c(0x168)];}}}}}}}_0x26e491['render'](_0xf4516c(0x131),{'success':_0x2ed33c[_0xf4516c(0x152)]('success'),'errors':_0x2ed33c[_0xf4516c(0x152)](_0xf4516c(0x129)),'master_shop':_0x16648e,'profile':_0x4b50a9,'role':_0x2e23dc,'language':_0x46ff3d,'customer':_0x1117d6,'sales_sa':_0x332829,'approvers':_0x9b996[0x0],'the_id':_0x44fb36});}catch(_0x17cc4a){console[_0xf4516c(0x14d)](_0x17cc4a);}}),router['post'](a0_0x1f672a(0x166),auth,async(_0x4e3f9d,_0x15be15)=>{const _0x47f662=a0_0x1f672a;try{const {accounting_discount:_0x2cc1a5,accounting_confirm:_0x12f337,wms_confirm:_0x575ecf,the_id_val:_0x228e1c,invoice:_0xeb537e,prod_id:_0x4e0de1}=_0x4e3f9d[_0x47f662(0x178)],_0x47e186=await sales_order[_0x47f662(0x19a)](_0x228e1c),_0x1989e6=_0x4e3f9d[_0x47f662(0x186)],_0x58d4a2=await staff['findOne']({'email':_0x1989e6[_0x47f662(0x17f)]});if(typeof _0x4e0de1==_0x47f662(0x16b))var _0x382e01=[_0x4e3f9d[_0x47f662(0x178)][_0x47f662(0x160)]],_0x5148e5=[_0x4e3f9d['body']['accounting_discount']];else var _0x382e01=[..._0x4e3f9d[_0x47f662(0x178)][_0x47f662(0x160)]],_0x5148e5=[..._0x4e3f9d[_0x47f662(0x178)][_0x47f662(0x13e)]];const _0x305fa0=await approver_acct[_0x47f662(0x18c)]([{'$unwind':_0x47f662(0x161)},{'$match':{'head_id_staff':_0x4e3f9d[_0x47f662(0x186)][_0x47f662(0x15c)]}},{'$group':{'_id':{'id_member':'$member.id_member','name':_0x47f662(0x173)},'warehouse_staff_id':{'$first':_0x47f662(0x155)}}},{'$addFields':{'warehouse_staff_id':{'$toObjectId':_0x47f662(0x155)}}},{'$lookup':{'from':_0x47f662(0x18a),'localField':_0x47f662(0x14f),'foreignField':_0x47f662(0x139),'as':_0x47f662(0x143)}},{'$unwind':_0x47f662(0x189)}]);if(_0x305fa0['length']==0x0)return _0x4e3f9d['flash'](_0x47f662(0x129),_0x47f662(0x1a4)),_0x15be15['redirect'](_0x47f662(0x14a));const _0x4584cb=_0x382e01['map'](_0x1167c8=>{return _0x1167c8={'prod_id':_0x1167c8};});_0x5148e5[_0x47f662(0x18e)]((_0x3f6155,_0x31e105)=>{const _0x231dfd=_0x47f662;_0x4584cb[_0x31e105][_0x231dfd(0x13e)]=_0x3f6155;});for(let _0x6a3a7=0x0;_0x6a3a7<=_0x47e186[_0x47f662(0x182)][_0x47f662(0x16a)]-0x1;_0x6a3a7++){const _0x477723=_0x47e186[_0x47f662(0x182)][_0x6a3a7];for(let _0x27121d=0x0;_0x27121d<=_0x4584cb[_0x47f662(0x16a)]-0x1;_0x27121d++){const _0x54e765=_0x4584cb[_0x27121d];_0x477723[_0x47f662(0x139)][_0x47f662(0x169)]()==_0x54e765[_0x47f662(0x160)]&&await sales_order[_0x47f662(0x140)]({'_id':_0x228e1c,'sale_product._id':_0x54e765['prod_id']},{'$set':{'sale_product.$.accounting_discount':_0x54e765[_0x47f662(0x13e)]}});}}const _0x13bd94=new Date(),_0x1758e6=_0x13bd94[_0x47f662(0x15e)]();_0x47e186['accounting_account_confirm']=_0x12f337,_0x47e186['accounting_account_date']=_0x1758e6,_0x47e186[_0x47f662(0x159)]=_0x305fa0[0x0]['warehouse_info'][_0x47f662(0x139)],await _0x47e186['save']();const _0x58e038=await master_shop[_0x47f662(0x185)](),_0x582a5e=await email_settings['findOne']();let _0x458946=nodemailer[_0x47f662(0x171)]({'host':_0x582a5e['host'],'port':Number(_0x582a5e[_0x47f662(0x18f)]),'secure':![],'auth':{'user':_0x582a5e[_0x47f662(0x17f)],'pass':_0x582a5e['password']}});const _0x508c3c=_0x4e3f9d['protocol']+'://'+_0x4e3f9d[_0x47f662(0x165)]['host'];var _0x3def1e=_0x47e186['sale_product'],_0x3d4084='',_0x4c2d75,_0x15c596=0x0;for(_0x4c2d75 in _0x3def1e){_0x3d4084+=_0x47f662(0x133)+_0x47f662(0x145)+_0x3def1e[_0x4c2d75][_0x47f662(0x180)]+_0x47f662(0x162)+_0x47f662(0x145)+_0x3def1e[_0x4c2d75][_0x47f662(0x176)]+'</td>'+_0x47f662(0x145)+_0x3def1e[_0x4c2d75][_0x47f662(0x167)]+'</td>'+_0x47f662(0x145)+_0x3def1e[_0x4c2d75][_0x47f662(0x19c)]+_0x47f662(0x162)+_0x47f662(0x1a6),_0x15c596+=parseInt(_0x3def1e[_0x4c2d75][_0x47f662(0x167)]);}let _0x54c2fc={'from':_0x582a5e[_0x47f662(0x17f)],'to':_0x47f662(0x12d),'subject':_0x47f662(0x196)+_0x47e186[_0x47f662(0x179)],'attachments':[{'filename':_0x47f662(0x148),'path':__dirname+_0x47f662(0x199)+_0x47f662(0x193)+_0x58e038[0x0]['image'],'cid':'logo'}],'html':_0x47f662(0x183)+_0x47f662(0x13a)+_0x47f662(0x156)+'</head><body>'+_0x47f662(0x188)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x47f662(0x188)+_0x47f662(0x149)+_0x47f662(0x13c)+_0x47f662(0x188)+_0x47f662(0x12e)+'</div>'+_0x47f662(0x13c)+_0x47f662(0x1a5)+_0x47f662(0x188)+_0x47f662(0x18d)+_0x305fa0[0x0][_0x47f662(0x143)][_0x47f662(0x144)]+_0x47f662(0x146)+_0x47f662(0x13c)+_0x47f662(0x188)+_0x47f662(0x175)+_0x47f662(0x13c)+_0x47f662(0x188)+_0x47f662(0x15a)+_0x47e186['invoice']+_0x47f662(0x13d)+_0x47f662(0x142)+_0x58d4a2[_0x47f662(0x144)]+'</b></span>\x20<br>'+_0x47f662(0x13b)+_0x47e186[_0x47f662(0x16d)]+'</b></span>\x20<br><br>'+_0x47f662(0x13c)+_0x47f662(0x17e)+_0x47f662(0x19f)+_0x47f662(0x133)+_0x47f662(0x19d)+_0x47f662(0x163)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x47f662(0x17a)+_0x47f662(0x1a6)+_0x47f662(0x19b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3d4084+'\x20'+'</tbody>'+_0x47f662(0x128)+_0x47f662(0x188)+'<br><br><span>\x20The\x20total\x20quantity\x20for\x20these\x20items\x20is\x20<b>'+_0x15c596+_0x47f662(0x194)+'<span>\x20lease\x20review\x20the\x20request\x20and\x20approve\x20it\x20if\x20it\x20aligns\x20with\x20our\x20operational\x20needs.\x20If\x20you\x20have\x20any\x20questions\x20or\x20require\x20further\x20information,\x20please\x20feel\x20free\x20to\x20reach\x20out\x20to\x20the\x20Sales\x20Department.\x20</span>'+_0x47f662(0x17c)+'<br><br><br>'+_0x47f662(0x13c)+'<div\x20style=\x22text-align:\x20center;\x22>'+_0x47f662(0x132)+_0x508c3c+_0x47f662(0x14c)+_0x47e186['_id']+'\x22>Change\x20Status</a>'+_0x47f662(0x184)+_0x47f662(0x13c)+'<div>'+_0x47f662(0x158)+'<h5>\x20JEC\x20SMS\x20</h5>'+_0x47f662(0x13c)+_0x47f662(0x13c)+_0x47f662(0x1a2)+_0x47f662(0x136)};_0x458946[_0x47f662(0x172)](_0x54c2fc,function(_0x4e4acc,_0x122626){const _0x92aaea=_0x47f662;_0x4e4acc?(console[_0x92aaea(0x14d)](_0x4e4acc),console[_0x92aaea(0x14d)](_0x92aaea(0x195))):console[_0x92aaea(0x14d)]('Email\x20sent\x20successfully');}),_0x4e3f9d[_0x47f662(0x152)](_0x47f662(0x164),_0x47f662(0x17b)),_0x15be15[_0x47f662(0x147)](_0x47f662(0x15f)+_0x47e186['_id']);}catch(_0x2341f9){}}),router['get'](a0_0x1f672a(0x138),auth,async(_0x1066b2,_0x452b7d)=>{const _0x217e45=a0_0x1f672a;try{const _0x4171c9=await master_shop[_0x217e45(0x185)](),_0x4fbe16=_0x1066b2['user'],_0x29bc97=await profile['findOne']({'email':_0x4fbe16[_0x217e45(0x17f)]}),_0x553e5e=await staff['findOne']({'email':_0x4fbe16[_0x217e45(0x17f)]}),_0x396e42=await customer[_0x217e45(0x185)]({'agent_id':_0x553e5e['_id']}),_0x3a6369=mongoose[_0x217e45(0x1a1)][_0x217e45(0x174)],_0x2a5ff9=_0x1066b2['params']['id'],_0x4f1ea7=await sales_order['findById'](_0x2a5ff9),_0x1eaa6a=await sales_order[_0x217e45(0x18c)]([{'$match':{'_id':_0x3a6369(_0x2a5ff9)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x217e45(0x151)}}},{'$addFields':{'wms_account_id':{'$toObjectId':'$wms_account_id'}}},{'$lookup':{'from':'staffs','localField':_0x217e45(0x181),'foreignField':_0x217e45(0x139),'as':_0x217e45(0x154)}},{'$unwind':_0x217e45(0x157)},{'$lookup':{'from':_0x217e45(0x18a),'localField':_0x217e45(0x159),'foreignField':_0x217e45(0x139),'as':_0x217e45(0x130)}},{'$unwind':'$wms_data'}]);if(_0x4171c9[0x0][_0x217e45(0x13f)]==_0x217e45(0x14b))var _0x37744f=users[_0x217e45(0x16f)];else{if(_0x4171c9[0x0][_0x217e45(0x13f)]==_0x217e45(0x134))var _0x37744f=users[_0x217e45(0x134)];else{if(_0x4171c9[0x0][_0x217e45(0x13f)]==_0x217e45(0x135))var _0x37744f=users['German'];else{if(_0x4171c9[0x0][_0x217e45(0x13f)]==_0x217e45(0x127))var _0x37744f=users[_0x217e45(0x127)];else{if(_0x4171c9[0x0][_0x217e45(0x13f)]==_0x217e45(0x15d))var _0x37744f=users['French'];else{if(_0x4171c9[0x0]['language']==_0x217e45(0x190))var _0x37744f=users[_0x217e45(0x14e)];else{if(_0x4171c9[0x0][_0x217e45(0x13f)]==_0x217e45(0x12c))var _0x37744f=users[_0x217e45(0x12c)];else{if(_0x4171c9[0x0][_0x217e45(0x13f)]=='Arabic\x20(ae)')var _0x37744f=users[_0x217e45(0x168)];}}}}}}}_0x452b7d[_0x217e45(0x17d)](_0x217e45(0x1a3),{'success':_0x1066b2[_0x217e45(0x152)](_0x217e45(0x164)),'errors':_0x1066b2[_0x217e45(0x152)](_0x217e45(0x129)),'master_shop':_0x4171c9,'profile':_0x29bc97,'role':_0x4fbe16,'language':_0x37744f,'customer':_0x396e42,'sales_sa':_0x4f1ea7,'approvers':_0x1eaa6a[0x0],'the_id':_0x2a5ff9});}catch(_0x5cb569){console['log'](_0x5cb569);}}),router[a0_0x1f672a(0x177)]('/data/All',auth,async(_0x804ec6,_0x472bdd)=>{const _0x5d40f5=a0_0x1f672a;try{const {sttaff_id:_0x51f8ab,email:_0x3f7b2a,warehouse:_0x513e15}=_0x804ec6[_0x5d40f5(0x186)],_0x445490=await master_shop[_0x5d40f5(0x185)](),_0x373bf2=_0x804ec6[_0x5d40f5(0x186)],_0x333a8a=await profile[_0x5d40f5(0x1a0)]({'email':_0x373bf2[_0x5d40f5(0x17f)]}),_0x8577eb=await sales_order[_0x5d40f5(0x185)]({'accounting_account_id':_0x51f8ab});if(_0x445490[0x0][_0x5d40f5(0x13f)]==_0x5d40f5(0x14b))var _0x49075d=users[_0x5d40f5(0x16f)];else{if(_0x445490[0x0][_0x5d40f5(0x13f)]==_0x5d40f5(0x134))var _0x49075d=users[_0x5d40f5(0x134)];else{if(_0x445490[0x0][_0x5d40f5(0x13f)]==_0x5d40f5(0x135))var _0x49075d=users[_0x5d40f5(0x135)];else{if(_0x445490[0x0][_0x5d40f5(0x13f)]==_0x5d40f5(0x127))var _0x49075d=users[_0x5d40f5(0x127)];else{if(_0x445490[0x0]['language']==_0x5d40f5(0x15d))var _0x49075d=users['French'];else{if(_0x445490[0x0]['language']==_0x5d40f5(0x190))var _0x49075d=users[_0x5d40f5(0x14e)];else{if(_0x445490[0x0]['language']==_0x5d40f5(0x12c))var _0x49075d=users['Chinese'];else{if(_0x445490[0x0]['language']==_0x5d40f5(0x197))var _0x49075d=users[_0x5d40f5(0x168)];}}}}}}}_0x472bdd['render']('accounting_approval_All',{'success':_0x804ec6[_0x5d40f5(0x152)](_0x5d40f5(0x164)),'errors':_0x804ec6[_0x5d40f5(0x152)](_0x5d40f5(0x129)),'master_shop':_0x445490,'profile':_0x333a8a,'role':_0x373bf2,'language':_0x49075d,'sales_order':_0x8577eb});}catch(_0x24ec3e){}}),module[a0_0x1f672a(0x12f)]=router;