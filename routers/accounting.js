const a0_0x3cc028=a0_0x5614;(function(_0x268509,_0x25d6e0){const _0x5107ed=a0_0x5614,_0x456aab=_0x268509();while(!![]){try{const _0x15c8a2=-parseInt(_0x5107ed(0x100))/0x1+parseInt(_0x5107ed(0xb4))/0x2+-parseInt(_0x5107ed(0xfe))/0x3+parseInt(_0x5107ed(0xa6))/0x4+-parseInt(_0x5107ed(0xa5))/0x5+-parseInt(_0x5107ed(0xcd))/0x6+parseInt(_0x5107ed(0xa4))/0x7*(parseInt(_0x5107ed(0xaa))/0x8);if(_0x15c8a2===_0x25d6e0)break;else _0x456aab['push'](_0x456aab['shift']());}catch(_0x37ca62){_0x456aab['push'](_0x456aab['shift']());}}}(a0_0x132a,0xb264e));function a0_0x5614(_0xfe82fd,_0x5cbc4a){const _0x132a4e=a0_0x132a();return a0_0x5614=function(_0x5614bc,_0x2080ea){_0x5614bc=_0x5614bc-0x9f;let _0x596a12=_0x132a4e[_0x5614bc];return _0x596a12;},a0_0x5614(_0xfe82fd,_0x5cbc4a);}const express=require('express'),app=express(),router=express[a0_0x3cc028(0xd9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sales_order,invoice_sa,sales_sa,invoice_for_sales_order,approver_acct,email_settings}=require(a0_0x3cc028(0xc2)),auth=require(a0_0x3cc028(0xde)),users=require(a0_0x3cc028(0xdf)),excelJS=require('exceljs'),xlsx=require('xlsx'),mongoose=require(a0_0x3cc028(0xd0)),{ObjectId}=require(a0_0x3cc028(0x118)),nodemailer=require(a0_0x3cc028(0xc9));function a0_0x132a(){const _0x5f38a7=['account_data','$accounting_account_id','$member','log','sttaff_id','length','</thead>','accounting_approval','<html><head><title></title>','<span>\x20Dear\x20<b>','back','Email\x20sent\x20successfully','accounting_account_confirm','/warehouse_approval/','sendMail','/accounting_approval/view_sales_order/','logo','warehouse_info','params','host','save','password','product_name','findById','$warehouse_info','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Error\x20Occurs','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h2>\x20JEC\x20SMS\x20</h2>','3624003IqKbxp','<span>\x20lease\x20review\x20the\x20request\x20and\x20approve\x20it\x20if\x20it\x20aligns\x20with\x20our\x20operational\x20needs.\x20If\x20you\x20have\x20any\x20questions\x20or\x20require\x20further\x20information,\x20please\x20feel\x20free\x20to\x20reach\x20out\x20to\x20the\x20Sales\x20Department.\x20</span>','1139619buYbqZ','$member.id_member','ObjectId','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<div>','</div>','sale_product','aggregate','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','success','map','view_accounting_approval','$warehouse_staff_id','product_code','render','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','French','staffs','_id','findOne','<h5>\x20JEC\x20SMS\x20</h5>','<br><br><br>','<div\x20style=\x22text-align:\x20center;\x22>','<span>\x20Request\x20Date:\x20<b>','mongodb','quantity','Portuguese','Approval\x20for\x20','<span>\x20Requested\x20By:\x20<b>','Arabic','<link\x20href=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\x22\x20rel=\x22stylesheet\x22\x20integrity=\x22sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\x22\x20crossorigin=\x22anonymous\x22>','protocol','post','German','English\x20(US)','headers','<br><br>','exports','valueOf','wms_account_id','warehouse_staff_id','<a\x20style=\x22background-color:\x20#007bff;\x20color:\x20#ffffff;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x205px;\x22\x20href=\x22','get','14dcaVnO','6253320beqCoI','3504976buoSWb','language','<span>\x20Request\x20ID:\x20<b>','invoice','13516784vGBWhD','</tbody>','body','://','email','$wms_data','<span>\x20A\x20product\x20request\x20has\x20been\x20submitted\x20by\x20the\x20Sales\x20Department\x20and\x20Approved\x20by\x20Accounting\x20that\x20requires\x20your\x20approval.\x20Below\x20are\x20the\x20details:\x20</span>\x20<br><br>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<span>\x20Thank\x20you\x20for\x20your\x20prompt\x20attention\x20to\x20this\x20matter.\x20</span>','Chinese','2629190YdwtIp','Portuguese\x20(BR)','English','accounting_discount','Arabic\x20(ae)','wms_data','redirect','/upload/','createTransport','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$account_data','Logo.png','image','accounting_account_id','../models/all_models','accounting_account_date','</head><body>','</b>,\x20</span><br>','<!DOCTYPE\x20html>','Hindi','name','nodemailer','prod_id','</table>','</b>.\x20These\x20products\x20are\x20essential\x20to\x20improve\x20our\x20warehouse\x20efficiency\x20and\x20ensure\x20smooth\x20operations.\x20</span>','7446294ORZjiw','Spanish','<tbody\x20style=\x22text-align:\x20center;\x22>','mongoose','No\x20Approvers\x20Set\x20Please\x20contact\x20admin\x20to\x20setup','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/../public','\x22>Change\x20Status</a>','<strong>\x20Regards\x20</strong>','find','</tr>','</td>','Router','user','flash','forEach','errors','../middleware/auth','../public/language/languages.json','<br><br><span>\x20The\x20total\x20quantity\x20for\x20these\x20items\x20is\x20<b>'];a0_0x132a=function(){return _0x5f38a7;};return a0_0x132a();}router[a0_0x3cc028(0xa3)]('/:id',auth,async(_0x4433f6,_0x5867a0)=>{const _0x340519=a0_0x3cc028;try{const _0x5179d7=await master_shop[_0x340519(0xd6)](),_0x23416f=_0x4433f6['user'],_0x316aec=await profile[_0x340519(0x113)]({'email':_0x23416f[_0x340519(0xae)]}),_0x3af56a=await staff[_0x340519(0x113)]({'email':_0x23416f[_0x340519(0xae)]}),_0x35f154=await customer[_0x340519(0xd6)]({'agent_id':_0x3af56a[_0x340519(0x112)]}),_0x34d5b3=mongoose['Types'][_0x340519(0x102)],_0x729525=_0x4433f6['params']['id'],_0x116213=await sales_order[_0x340519(0xf8)](_0x729525),_0x59c441=await sales_order[_0x340519(0x107)]([{'$match':{'_id':_0x34d5b3(_0x729525)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x340519(0xe2)}}},{'$addFields':{'wms_account_id':{'$toObjectId':'$wms_account_id'}}},{'$lookup':{'from':_0x340519(0x111),'localField':_0x340519(0xc1),'foreignField':_0x340519(0x112),'as':_0x340519(0xe1)}},{'$unwind':_0x340519(0xbe)},{'$lookup':{'from':_0x340519(0x111),'localField':_0x340519(0xa0),'foreignField':_0x340519(0x112),'as':_0x340519(0xb9)}},{'$unwind':{'path':_0x340519(0xaf),'preserveNullAndEmptyArrays':!![]}}]);if(_0x5179d7[0x0][_0x340519(0xa7)]=='English\x20(US)')var _0x1dd625=users[_0x340519(0xb6)];else{if(_0x5179d7[0x0][_0x340519(0xa7)]==_0x340519(0xc7))var _0x1dd625=users[_0x340519(0xc7)];else{if(_0x5179d7[0x0][_0x340519(0xa7)]==_0x340519(0x121))var _0x1dd625=users['German'];else{if(_0x5179d7[0x0][_0x340519(0xa7)]=='Spanish')var _0x1dd625=users[_0x340519(0xce)];else{if(_0x5179d7[0x0][_0x340519(0xa7)]=='French')var _0x1dd625=users[_0x340519(0x110)];else{if(_0x5179d7[0x0][_0x340519(0xa7)]==_0x340519(0xb5))var _0x1dd625=users[_0x340519(0x11a)];else{if(_0x5179d7[0x0][_0x340519(0xa7)]=='Chinese')var _0x1dd625=users['Chinese'];else{if(_0x5179d7[0x0][_0x340519(0xa7)]==_0x340519(0xb8))var _0x1dd625=users[_0x340519(0x11d)];}}}}}}}_0x5867a0[_0x340519(0x10e)](_0x340519(0xe8),{'success':_0x4433f6[_0x340519(0xdb)](_0x340519(0x109)),'errors':_0x4433f6[_0x340519(0xdb)](_0x340519(0xdd)),'master_shop':_0x5179d7,'profile':_0x316aec,'role':_0x23416f,'language':_0x1dd625,'customer':_0x35f154,'sales_sa':_0x116213,'approvers':_0x59c441[0x0],'the_id':_0x729525});}catch(_0x250846){console['log'](_0x250846);}}),router[a0_0x3cc028(0x120)]('/:id',auth,async(_0x5e8172,_0x3db4a7)=>{const _0x251121=a0_0x3cc028;try{const {accounting_discount:_0xc2352a,accounting_confirm:_0x23d105,wms_confirm:_0x244ec6,the_id_val:_0x6fc33c,invoice:_0x41dae4,prod_id:_0x2f3ab4}=_0x5e8172['body'],_0x167e97=await sales_order['findById'](_0x6fc33c),_0x326e54=_0x5e8172[_0x251121(0xda)],_0x30f58d=await staff[_0x251121(0x113)]({'email':_0x326e54[_0x251121(0xae)]});if(typeof _0x2f3ab4=='string')var _0x647d9b=[_0x5e8172['body'][_0x251121(0xca)]],_0xad21ff=[_0x5e8172[_0x251121(0xac)]['accounting_discount']];else var _0x647d9b=[..._0x5e8172[_0x251121(0xac)][_0x251121(0xca)]],_0xad21ff=[..._0x5e8172[_0x251121(0xac)][_0x251121(0xb7)]];const _0x5c3f0c=await approver_acct[_0x251121(0x107)]([{'$unwind':_0x251121(0xe3)},{'$match':{'head_id_staff':_0x5e8172[_0x251121(0xda)][_0x251121(0xe5)]}},{'$group':{'_id':{'id_member':_0x251121(0x101),'name':'$member.name'},'warehouse_staff_id':{'$first':_0x251121(0x10c)}}},{'$addFields':{'warehouse_staff_id':{'$toObjectId':_0x251121(0x10c)}}},{'$lookup':{'from':_0x251121(0x111),'localField':_0x251121(0xa1),'foreignField':_0x251121(0x112),'as':_0x251121(0xf2)}},{'$unwind':_0x251121(0xf9)}]);if(_0x5c3f0c['length']==0x0)return _0x5e8172['flash'](_0x251121(0xdd),_0x251121(0xd1)),_0x3db4a7[_0x251121(0xba)](_0x251121(0xeb));const _0x43313e=_0x647d9b[_0x251121(0x10a)](_0x11739b=>{return _0x11739b={'prod_id':_0x11739b};});_0xad21ff[_0x251121(0xdc)]((_0x4ebb65,_0x3218d9)=>{_0x43313e[_0x3218d9]['accounting_discount']=_0x4ebb65;});for(let _0x7cda8c=0x0;_0x7cda8c<=_0x167e97[_0x251121(0x106)][_0x251121(0xe6)]-0x1;_0x7cda8c++){const _0xe5bfa=_0x167e97[_0x251121(0x106)][_0x7cda8c];for(let _0x1f2b12=0x0;_0x1f2b12<=_0x43313e[_0x251121(0xe6)]-0x1;_0x1f2b12++){const _0x1e5969=_0x43313e[_0x1f2b12];_0xe5bfa[_0x251121(0x112)][_0x251121(0x9f)]()==_0x1e5969[_0x251121(0xca)]&&await sales_order['updateOne']({'_id':_0x6fc33c,'sale_product._id':_0x1e5969[_0x251121(0xca)]},{'$set':{'sale_product.$.accounting_discount':_0x1e5969[_0x251121(0xb7)]}});}}const _0x3242d7=new Date(),_0x18d635=_0x3242d7['toLocaleDateString']();_0x167e97[_0x251121(0xed)]=_0x23d105,_0x167e97[_0x251121(0xc3)]=_0x18d635,_0x167e97['wms_account_id']=_0x5c3f0c[0x0]['warehouse_info'][_0x251121(0x112)],await _0x167e97[_0x251121(0xf5)]();const _0x4e0d3e=await master_shop['find'](),_0x488537=await email_settings['findOne']();let _0x1b236b=nodemailer[_0x251121(0xbc)]({'host':_0x488537[_0x251121(0xf4)],'port':Number(_0x488537['port']),'secure':![],'auth':{'user':_0x488537['email'],'pass':_0x488537[_0x251121(0xf6)]}});const _0x181c69=_0x5e8172[_0x251121(0x11f)]+_0x251121(0xad)+_0x5e8172[_0x251121(0x123)][_0x251121(0xf4)];var _0x5c0b2e=_0x167e97['sale_product'],_0xd16bb='',_0x1a53ce,_0x2770e7=0x0;for(_0x1a53ce in _0x5c0b2e){_0xd16bb+='<tr>'+_0x251121(0xfc)+_0x5c0b2e[_0x1a53ce][_0x251121(0xf7)]+'</td>'+_0x251121(0xfc)+_0x5c0b2e[_0x1a53ce][_0x251121(0x10d)]+_0x251121(0xd8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c0b2e[_0x1a53ce][_0x251121(0x119)]+_0x251121(0xd8)+_0x251121(0xfc)+_0x5c0b2e[_0x1a53ce]['unit']+_0x251121(0xd8)+_0x251121(0xd7),_0x2770e7+=parseInt(_0x5c0b2e[_0x1a53ce]['quantity']);}let _0x392b67={'from':_0x488537[_0x251121(0xae)],'to':'christian.villamer@jakagroup.com','subject':_0x251121(0x11b)+_0x167e97['invoice'],'attachments':[{'filename':_0x251121(0xbf),'path':__dirname+_0x251121(0xd3)+_0x251121(0xbb)+_0x4e0d3e[0x0][_0x251121(0xc0)],'cid':_0x251121(0xf1)}],'html':_0x251121(0xc6)+_0x251121(0xe9)+_0x251121(0x11e)+_0x251121(0xc4)+_0x251121(0x104)+_0x251121(0x10f)+'<div>'+_0x251121(0x108)+'</div>'+_0x251121(0x104)+_0x251121(0xfd)+_0x251121(0x105)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x251121(0x104)+_0x251121(0xea)+_0x5c3f0c[0x0][_0x251121(0xf2)][_0x251121(0xc8)]+_0x251121(0xc5)+_0x251121(0x105)+_0x251121(0x104)+_0x251121(0xb0)+'</div>'+_0x251121(0x104)+_0x251121(0xa8)+_0x167e97[_0x251121(0xa9)]+'</b></span>\x20<br>'+_0x251121(0x11c)+_0x30f58d[_0x251121(0xc8)]+'</b></span>\x20<br>'+_0x251121(0x117)+_0x167e97['date']+'</b></span>\x20<br><br>'+_0x251121(0x105)+_0x251121(0x103)+_0x251121(0xbd)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x251121(0xb1)+_0x251121(0xd2)+_0x251121(0xfa)+'</tr>'+_0x251121(0xe7)+_0x251121(0xcf)+'\x20'+_0xd16bb+'\x20'+_0x251121(0xab)+_0x251121(0xcb)+_0x251121(0x104)+_0x251121(0xe0)+_0x2770e7+_0x251121(0xcc)+_0x251121(0xff)+_0x251121(0xb2)+_0x251121(0x115)+_0x251121(0x105)+_0x251121(0x116)+_0x251121(0xa2)+_0x181c69+_0x251121(0xee)+_0x167e97['_id']+_0x251121(0xd4)+_0x251121(0x124)+_0x251121(0x105)+'<div>'+_0x251121(0xd5)+_0x251121(0x114)+_0x251121(0x105)+_0x251121(0x105)+'<script\x20src=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\x22\x20integrity=\x22sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz\x22\x20crossorigin=\x22anonymous\x22></script>'+'</body></html>'};_0x1b236b[_0x251121(0xef)](_0x392b67,function(_0x5d353f,_0x1ecdef){const _0x17602b=_0x251121;_0x5d353f?(console[_0x17602b(0xe4)](_0x5d353f),console[_0x17602b(0xe4)](_0x17602b(0xfb))):console['log'](_0x17602b(0xec));}),_0x5e8172['flash'](_0x251121(0x109),'Sales\x20Order\x20is\x20changed\x20status'),_0x3db4a7['redirect'](_0x251121(0xf0)+_0x167e97[_0x251121(0x112)]);}catch(_0x14c396){}}),router['get']('/view_sales_order/:id',auth,async(_0x21b08e,_0x31c77f)=>{const _0x18e57e=a0_0x3cc028;try{const _0x22017d=await master_shop[_0x18e57e(0xd6)](),_0x3953a1=_0x21b08e[_0x18e57e(0xda)],_0x5b05ae=await profile[_0x18e57e(0x113)]({'email':_0x3953a1[_0x18e57e(0xae)]}),_0x29e82a=await staff['findOne']({'email':_0x3953a1[_0x18e57e(0xae)]}),_0x5dd2eb=await customer[_0x18e57e(0xd6)]({'agent_id':_0x29e82a['_id']}),_0x3bca52=mongoose['Types'][_0x18e57e(0x102)],_0x159ae2=_0x21b08e[_0x18e57e(0xf3)]['id'],_0x3bf08c=await sales_order[_0x18e57e(0xf8)](_0x159ae2),_0x347c9a=await sales_order[_0x18e57e(0x107)]([{'$match':{'_id':_0x3bca52(_0x159ae2)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0x18e57e(0xe2)}}},{'$addFields':{'wms_account_id':{'$toObjectId':'$wms_account_id'}}},{'$lookup':{'from':_0x18e57e(0x111),'localField':'accounting_account_id','foreignField':'_id','as':_0x18e57e(0xe1)}},{'$unwind':_0x18e57e(0xbe)},{'$lookup':{'from':_0x18e57e(0x111),'localField':_0x18e57e(0xa0),'foreignField':_0x18e57e(0x112),'as':'wms_data'}},{'$unwind':_0x18e57e(0xaf)}]);if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0x122))var _0x1e563a=users[_0x18e57e(0xb6)];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]=='Hindi')var _0x1e563a=users[_0x18e57e(0xc7)];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0x121))var _0x1e563a=users['German'];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0xce))var _0x1e563a=users[_0x18e57e(0xce)];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0x110))var _0x1e563a=users['French'];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0xb5))var _0x1e563a=users[_0x18e57e(0x11a)];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0xb3))var _0x1e563a=users[_0x18e57e(0xb3)];else{if(_0x22017d[0x0][_0x18e57e(0xa7)]==_0x18e57e(0xb8))var _0x1e563a=users['Arabic'];}}}}}}}_0x31c77f[_0x18e57e(0x10e)](_0x18e57e(0x10b),{'success':_0x21b08e['flash'](_0x18e57e(0x109)),'errors':_0x21b08e[_0x18e57e(0xdb)](_0x18e57e(0xdd)),'master_shop':_0x22017d,'profile':_0x5b05ae,'role':_0x3953a1,'language':_0x1e563a,'customer':_0x5dd2eb,'sales_sa':_0x3bf08c,'approvers':_0x347c9a[0x0],'the_id':_0x159ae2});}catch(_0x546da8){console[_0x18e57e(0xe4)](_0x546da8);}}),router[a0_0x3cc028(0xa3)]('/data/All',auth,async(_0x551af1,_0xc353ee)=>{const _0x243623=a0_0x3cc028;try{const {sttaff_id:_0x598c8c,email:_0x3d0444,warehouse:_0x10910a}=_0x551af1[_0x243623(0xda)],_0x3f70c7=await master_shop[_0x243623(0xd6)](),_0x2cbc86=_0x551af1[_0x243623(0xda)],_0x2df4a2=await profile['findOne']({'email':_0x2cbc86[_0x243623(0xae)]}),_0x1ebc95=await sales_order[_0x243623(0xd6)]({'accounting_account_id':_0x598c8c});if(_0x3f70c7[0x0]['language']==_0x243623(0x122))var _0x270f83=users[_0x243623(0xb6)];else{if(_0x3f70c7[0x0][_0x243623(0xa7)]==_0x243623(0xc7))var _0x270f83=users['Hindi'];else{if(_0x3f70c7[0x0][_0x243623(0xa7)]==_0x243623(0x121))var _0x270f83=users[_0x243623(0x121)];else{if(_0x3f70c7[0x0][_0x243623(0xa7)]=='Spanish')var _0x270f83=users[_0x243623(0xce)];else{if(_0x3f70c7[0x0][_0x243623(0xa7)]=='French')var _0x270f83=users[_0x243623(0x110)];else{if(_0x3f70c7[0x0]['language']==_0x243623(0xb5))var _0x270f83=users['Portuguese'];else{if(_0x3f70c7[0x0]['language']=='Chinese')var _0x270f83=users['Chinese'];else{if(_0x3f70c7[0x0][_0x243623(0xa7)]==_0x243623(0xb8))var _0x270f83=users[_0x243623(0x11d)];}}}}}}}_0xc353ee[_0x243623(0x10e)]('accounting_approval_All',{'success':_0x551af1['flash'](_0x243623(0x109)),'errors':_0x551af1[_0x243623(0xdb)](_0x243623(0xdd)),'master_shop':_0x3f70c7,'profile':_0x2df4a2,'role':_0x2cbc86,'language':_0x270f83,'sales_order':_0x1ebc95});}catch(_0x586cda){}}),module[a0_0x3cc028(0x125)]=router;