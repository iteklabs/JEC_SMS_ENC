const a0_0x2d446b=a0_0x2f6a;function a0_0x2f6a(_0x51d250,_0x38924a){const _0x142794=a0_0x1427();return a0_0x2f6a=function(_0x2f6abf,_0x148e8c){_0x2f6abf=_0x2f6abf-0x1bc;let _0x1e729b=_0x142794[_0x2f6abf];return _0x1e729b;},a0_0x2f6a(_0x51d250,_0x38924a);}(function(_0x365658,_0x2caad4){const _0x1cd51e=a0_0x2f6a,_0x235fab=_0x365658();while(!![]){try{const _0x783965=-parseInt(_0x1cd51e(0x1d0))/0x1*(-parseInt(_0x1cd51e(0x21d))/0x2)+parseInt(_0x1cd51e(0x1e3))/0x3+parseInt(_0x1cd51e(0x216))/0x4+-parseInt(_0x1cd51e(0x1cf))/0x5+parseInt(_0x1cd51e(0x200))/0x6*(-parseInt(_0x1cd51e(0x21b))/0x7)+-parseInt(_0x1cd51e(0x1fe))/0x8+-parseInt(_0x1cd51e(0x1c7))/0x9*(parseInt(_0x1cd51e(0x1d9))/0xa);if(_0x783965===_0x2caad4)break;else _0x235fab['push'](_0x235fab['shift']());}catch(_0x5b69ad){_0x235fab['push'](_0x235fab['shift']());}}}(a0_0x1427,0xaee79));const express=require('express'),app=express(),router=express[a0_0x2d446b(0x1de)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require('../models/all_models'),auth=require(a0_0x2d446b(0x213)),users=require('../public/language/languages.json'),excelJS=require(a0_0x2d446b(0x1c2)),xlsx=require(a0_0x2d446b(0x1ec)),multer=require(a0_0x2d446b(0x1d7));router['get'](a0_0x2d446b(0x1d1),auth,async(_0x363d95,_0x3183cd)=>{const _0x368065=a0_0x2d446b;try{const {username:_0x13f5a2,email:_0x428491,role:_0x9e1fab}=_0x363d95['user'],_0x4b45ea=_0x363d95['user'],_0x5eaf01=await profile[_0x368065(0x204)]({'email':_0x4b45ea['email']}),_0x408220=await master_shop[_0x368065(0x1d5)]();console[_0x368065(0x1fd)](_0x368065(0x21a),_0x408220);const _0x3277ff=await suppliers['find']();console[_0x368065(0x1fd)](_0x3277ff);const _0x2d4032=await suppliers[_0x368065(0x1c0)]([{'$lookup':{'from':_0x368065(0x20a),'localField':_0x368065(0x1e2),'foreignField':'suppliers','as':'suppliers_docs'}}]),_0x41b8e0=_0x2d4032[_0x368065(0x214)](_0x5935d6=>{const _0x500543=_0x368065;console['log']('data',_0x5935d6);var _0x42388a=0x0,_0x397ebf=0x0;return _0x5935d6['suppliers_docs'][_0x500543(0x1dc)](_0x851cd9=>{const _0x24537a=_0x500543;console[_0x24537a(0x1fd)](_0x24537a(0x1f5),_0x851cd9),_0x851cd9[_0x24537a(0x1f0)]==_0x24537a(0x1e8)?_0x42388a+=_0x851cd9['amount']:_0x397ebf+=_0x851cd9[_0x24537a(0x1d3)];}),_0x5935d6['purchase']=_0x42388a,_0x5935d6['purchase_return']=_0x397ebf,_0x5935d6;});console[_0x368065(0x1fd)](_0x368065(0x20c),_0x41b8e0);if(_0x408220[0x0][_0x368065(0x20f)]==_0x368065(0x1ca)){var _0x729289=users[_0x368065(0x1ef)];console[_0x368065(0x1fd)](_0x729289);}else{if(_0x408220[0x0][_0x368065(0x20f)]=='Hindi')var _0x729289=users['Hindi'];else{if(_0x408220[0x0][_0x368065(0x20f)]==_0x368065(0x1df))var _0x729289=users[_0x368065(0x1df)];else{if(_0x408220[0x0][_0x368065(0x20f)]==_0x368065(0x201))var _0x729289=users[_0x368065(0x201)];else{if(_0x408220[0x0][_0x368065(0x20f)]=='French')var _0x729289=users[_0x368065(0x1f8)];else{if(_0x408220[0x0]['language']==_0x368065(0x215))var _0x729289=users['Portuguese'];else{if(_0x408220[0x0]['language']=='Chinese')var _0x729289=users[_0x368065(0x1e5)];else{if(_0x408220[0x0][_0x368065(0x20f)]==_0x368065(0x1e7))var _0x729289=users[_0x368065(0x21c)];}}}}}}}_0x3183cd[_0x368065(0x1e1)](_0x368065(0x1cc),{'success':_0x363d95[_0x368065(0x1ce)](_0x368065(0x1cb)),'errors':_0x363d95[_0x368065(0x1ce)](_0x368065(0x219)),'user':_0x3277ff,'profile':_0x5eaf01,'master_shop':_0x408220,'role':_0x4b45ea,'payment':_0x41b8e0,'language':_0x729289});}catch(_0x4b2870){console[_0x368065(0x1fd)](_0x4b2870);}}),router['post'](a0_0x2d446b(0x1d1),auth,async(_0x99a25a,_0x238fd7)=>{const _0xc67790=a0_0x2d446b;try{const {name:_0x1f5441,email:_0x4eb3ef,mobile:_0x3f0ca9,company:_0x4a7fa7,address:_0x19fcd5,receivable:_0x3f3c90,payable:_0x1c1aeb,code:_0x8322e4,contactperson:_0x4d5325,landline:_0x441ae2}=_0x99a25a[_0xc67790(0x1be)],_0x2a1995=new suppliers({'name':_0x1f5441,'email':_0x4eb3ef,'mobile':_0x3f0ca9,'company':_0x4a7fa7,'address':_0x19fcd5,'receivable':_0x3f3c90,'payable':_0x1c1aeb,'suppliers_code':_0x8322e4,'contactperson':_0x4d5325,'landline':_0x441ae2}),_0x487e35=await _0x2a1995[_0xc67790(0x1ea)]();_0x99a25a['flash']('success','supplier\x20data\x20add\x20successfully'),_0x238fd7[_0xc67790(0x1d2)](_0xc67790(0x207));}catch(_0xc9c47d){console[_0xc67790(0x1fd)](_0xc9c47d);}}),router[a0_0x2d446b(0x217)](a0_0x2d446b(0x1c5),auth,async(_0x259f2f,_0x4da1c3)=>{const _0x2c2353=a0_0x2d446b;try{const {username:_0x12decd,email:_0x1d375a,role:_0x1e30a4}=_0x259f2f['user'],_0x4f2700=_0x259f2f[_0x2c2353(0x1f1)],_0x753b0e=await profile[_0x2c2353(0x204)]({'email':_0x4f2700[_0x2c2353(0x1c9)]}),_0x2e5552=await master_shop[_0x2c2353(0x1d5)]();console['log'](_0x2c2353(0x21a),_0x2e5552);const _0x49e48f=_0x259f2f['params']['id'],_0x1dfffb=await suppliers[_0x2c2353(0x1c1)](_0x49e48f);console[_0x2c2353(0x1fd)](_0x1dfffb);if(_0x2e5552[0x0][_0x2c2353(0x20f)]=='English\x20(US)'){var _0xa7d7d5=users['English'];console['log'](_0xa7d7d5);}else{if(_0x2e5552[0x0][_0x2c2353(0x20f)]==_0x2c2353(0x1fb))var _0xa7d7d5=users[_0x2c2353(0x1fb)];else{if(_0x2e5552[0x0][_0x2c2353(0x20f)]==_0x2c2353(0x1df))var _0xa7d7d5=users[_0x2c2353(0x1df)];else{if(_0x2e5552[0x0]['language']==_0x2c2353(0x201))var _0xa7d7d5=users[_0x2c2353(0x201)];else{if(_0x2e5552[0x0][_0x2c2353(0x20f)]=='French')var _0xa7d7d5=users[_0x2c2353(0x1f8)];else{if(_0x2e5552[0x0][_0x2c2353(0x20f)]==_0x2c2353(0x215))var _0xa7d7d5=users[_0x2c2353(0x1c4)];else{if(_0x2e5552[0x0]['language']=='Chinese')var _0xa7d7d5=users[_0x2c2353(0x1e5)];else{if(_0x2e5552[0x0][_0x2c2353(0x20f)]==_0x2c2353(0x1e7))var _0xa7d7d5=users[_0x2c2353(0x21c)];}}}}}}}_0x4da1c3['render'](_0x2c2353(0x1cc),{'success':_0x259f2f[_0x2c2353(0x1ce)](_0x2c2353(0x1cb)),'errors':_0x259f2f['flash'](_0x2c2353(0x219)),'role':_0x4f2700,'profile':_0x753b0e,'master_shop':_0x2e5552,'user':_0x1dfffb,'language':_0xa7d7d5});}catch(_0x10f38d){console[_0x2c2353(0x1fd)](_0x10f38d);}}),router['post'](a0_0x2d446b(0x1c5),auth,async(_0x218dc2,_0x33ecc9)=>{const _0x377e77=a0_0x2d446b;try{const _0x3e9159=_0x218dc2[_0x377e77(0x203)]['id'],_0x22e3b2=await suppliers[_0x377e77(0x1c1)](_0x3e9159),{name:_0x397fb3,email:_0x2341eb,mobile:_0x5bf2ae,company:_0x385c16,address:_0x3fa095,receivable:_0x171433,payable:_0x43709c,code:_0x108cbd,contactperson:_0x242b53,landline:_0x2363eb}=_0x218dc2[_0x377e77(0x1be)];_0x22e3b2[_0x377e77(0x1e2)]=_0x397fb3,_0x22e3b2[_0x377e77(0x1c9)]=_0x2341eb,_0x22e3b2[_0x377e77(0x1f9)]=_0x5bf2ae,_0x22e3b2[_0x377e77(0x1d4)]=_0x385c16,_0x22e3b2[_0x377e77(0x1f2)]=_0x3fa095,_0x22e3b2[_0x377e77(0x1da)]=_0x171433,_0x22e3b2[_0x377e77(0x1d6)]=_0x43709c,_0x22e3b2[_0x377e77(0x1f6)]=_0x108cbd,_0x22e3b2[_0x377e77(0x21f)]=_0x242b53,_0x22e3b2[_0x377e77(0x209)]=_0x2363eb;const _0x1156ce=await _0x22e3b2[_0x377e77(0x1ea)]();_0x218dc2[_0x377e77(0x1ce)](_0x377e77(0x1cb),'supplier\x20data\x20update\x20successfully'),_0x33ecc9[_0x377e77(0x1d2)](_0x377e77(0x207));}catch(_0x182997){console[_0x377e77(0x1fd)](_0x182997);}}),router[a0_0x2d446b(0x217)]('/view/payment/:id',auth,async(_0x14bbea,_0x34bb7c)=>{const _0x840425=a0_0x2d446b;try{const {username:_0x35f6c1,email:_0xe8dddb,role:_0x5713e0}=_0x14bbea['user'],_0x38efa1=_0x14bbea['user'],_0x5699f0=await profile['findOne']({'email':_0x38efa1['email']}),_0x250a3d=await master_shop['find']();console[_0x840425(0x1fd)](_0x840425(0x21a),_0x250a3d),console[_0x840425(0x1fd)](_0x14bbea[_0x840425(0x203)]['id']);const _0x288498=await suppliers[_0x840425(0x204)]({'_id':_0x14bbea['params']['id']});console[_0x840425(0x1fd)](_0x288498);const _0x21ee44=await s_payment_data['find']({'suppliers':_0x288498[_0x840425(0x1e2)]});console['log'](_0x21ee44);const _0x59624f=await s_payment_data['aggregate']([{'$match':{'suppliers':_0x288498[_0x840425(0x1e2)]}},{'$match':{'reason':_0x840425(0x1e8)}},{'$group':{'_id':_0x840425(0x1c8),'sum':{'$sum':_0x840425(0x1cd)}}}]);console['log'](_0x840425(0x1ee),_0x59624f);const _0x458d51=await s_payment_data[_0x840425(0x1c0)]([{'$match':{'suppliers':_0x288498[_0x840425(0x1e2)]}},{'$match':{'reason':'Purchase\x20Return'}},{'$group':{'_id':_0x840425(0x1c8),'sum':{'$sum':_0x840425(0x1cd)}}}]);console['log'](_0x840425(0x1c3),_0x458d51);if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x1ca)){var _0x18cc05=users[_0x840425(0x1ef)];console[_0x840425(0x1fd)](_0x18cc05);}else{if(_0x250a3d[0x0][_0x840425(0x20f)]=='Hindi')var _0x18cc05=users[_0x840425(0x1fb)];else{if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x1df))var _0x18cc05=users[_0x840425(0x1df)];else{if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x201))var _0x18cc05=users['Spanish'];else{if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x1f8))var _0x18cc05=users[_0x840425(0x1f8)];else{if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x215))var _0x18cc05=users[_0x840425(0x1c4)];else{if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x1e5))var _0x18cc05=users['Chinese'];else{if(_0x250a3d[0x0][_0x840425(0x20f)]==_0x840425(0x1e7))var _0x18cc05=users[_0x840425(0x21c)];}}}}}}}_0x34bb7c[_0x840425(0x1e1)]('supplier_payment',{'success':_0x14bbea[_0x840425(0x1ce)]('success'),'errors':_0x14bbea['flash'](_0x840425(0x219)),'role':_0x38efa1,'profile':_0x5699f0,'master_shop':_0x250a3d,'payment':_0x21ee44,'payable':_0x59624f,'receivable':_0x458d51,'language':_0x18cc05});}catch(_0x3e099e){console[_0x840425(0x1fd)](_0x3e099e);}}),router[a0_0x2d446b(0x217)]('/products_export_migrate_file',auth,async(_0x247dae,_0x458892)=>{const _0x5122d6=a0_0x2d446b;try{const _0x1c0f40=new excelJS[(_0x5122d6(0x20e))](),_0x9fae9c=_0x1c0f40['addWorksheet'](_0x5122d6(0x208));return _0x9fae9c[_0x5122d6(0x1eb)]=[{'header':'Name','key':'PBrands','width':0xa},{'header':_0x5122d6(0x20d),'key':_0x5122d6(0x1c6),'width':0xa},{'header':_0x5122d6(0x1fa),'key':_0x5122d6(0x218),'width':0xa},{'header':_0x5122d6(0x211),'key':'address','width':0xa},{'header':_0x5122d6(0x210),'key':'mobile','width':0xa},{'header':_0x5122d6(0x1f2),'key':_0x5122d6(0x1c9),'width':0xa}],_0x458892[_0x5122d6(0x1dd)](_0x5122d6(0x206),_0x5122d6(0x1e4)),_0x458892[_0x5122d6(0x1dd)]('Content-Disposition','attachment;\x20filename=supplier_Migration_File.xlsx'),_0x1c0f40[_0x5122d6(0x1ec)][_0x5122d6(0x1fc)](_0x458892)[_0x5122d6(0x1e0)](()=>{const _0x27cf8b=_0x5122d6;_0x458892[_0x27cf8b(0x1d8)](0xc8);});}catch(_0x3b198a){_0x458892[_0x5122d6(0x1d8)](0x190)['send']({'errors':_0x3b198a[_0x5122d6(0x1e6)]});}});const storage1=multer[a0_0x2d446b(0x1ff)]({'destination':(_0x166b65,_0x31ffe4,_0x4af387)=>{_0x4af387(null,'public/Migration');},'filename':(_0x1699b3,_0x3a464d,_0x21b04e)=>{const _0x28f502=a0_0x2d446b;_0x21b04e(null,Date[_0x28f502(0x1e9)]()+_0x3a464d[_0x28f502(0x21e)]);}}),uploadMigrate=multer({'storage':storage1});router['post']('/supplier_import_migrate_file',auth,uploadMigrate[a0_0x2d446b(0x212)]('supplier_product_file'),async(_0x4a3334,_0x446637)=>{const _0x48fccc=a0_0x2d446b,_0x16267a=_0x4a3334[_0x48fccc(0x202)][_0x48fccc(0x1f7)],_0x534cfd=await xlsx[_0x48fccc(0x1db)](_0x48fccc(0x1f3)+_0x16267a);let _0x29b4be=_0x534cfd[_0x48fccc(0x205)],_0x55bba1=xlsx[_0x48fccc(0x20b)][_0x48fccc(0x1ed)](_0x534cfd[_0x48fccc(0x1bf)][_0x29b4be[0x0]]);for(const _0x1cc4b5 of _0x55bba1){const _0x43c270=_0x1cc4b5['Name'],_0x306460=_0x1cc4b5[_0x48fccc(0x20d)],_0x5891ef=_0x1cc4b5['address'],_0x32f749=_0x1cc4b5[_0x48fccc(0x211)],_0x36872d=_0x1cc4b5[_0x48fccc(0x1fa)],_0x4f260a=_0x1cc4b5[_0x48fccc(0x210)];try{let _0x407b40=await suppliers[_0x48fccc(0x204)]({'name':_0x43c270});if(!_0x407b40){const _0x174213=new suppliers({'name':_0x43c270,'suppliers_code':_0x306460,'address':_0x5891ef,'mobile':_0x32f749,'email':_0x36872d,'company':_0x4f260a});_0x407b40=await _0x174213['save'](),_0x4a3334[_0x48fccc(0x1ce)](_0x48fccc(0x1cb),_0x43c270+'\x20added\x20successfully');}else _0x4a3334[_0x48fccc(0x1ce)](_0x48fccc(0x1f4),_0x43c270+_0x48fccc(0x1bc));}catch(_0x48d0d8){_0x446637[_0x48fccc(0x1d8)](0x1f4)[_0x48fccc(0x220)]({'proderror':_0x48d0d8[_0x48fccc(0x1e6)],'aproduct':ProductName});}}_0x446637[_0x48fccc(0x1d2)](_0x48fccc(0x207));}),module[a0_0x2d446b(0x1bd)]=router;function a0_0x1427(){const _0x19041e=['$amount','flash','1786575vDmVcZ','13OHtutl','/view','redirect','amount','company','find','payable','multer','status','31370bFylRm','receivable','readFile','forEach','setHeader','Router','German','then','render','name','2170233lzgpAo','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','Chinese','message','Arabic\x20(ae)','Purchase','now','save','columns','xlsx','sheet_to_json','payable_sum','English','reason','user','address','public/Migration/','error','doc','suppliers_code','filename','French','mobile','Email','Hindi','write','log','551520iaYahm','diskStorage','2297076gMouiD','Spanish','file','params','findOne','SheetNames','Content-Type','/supplier/view','Customers','landline','s_payments','utils','supplier.js\x20payment_data','Supplier_Code','Workbook','language','Company_Name','Mobile_number','single','../middleware/auth','map','Portuguese\x20(BR)','3742572qClkss','get','SalesmanName','errors','master','21WOxHto','Arabic','149376cbZTTE','originalname','contactperson','json','\x20Failed','exports','body','Sheets','aggregate','findById','exceljs','receivable_sum','Portuguese','/view/:id','PUnits','972piAFMc','$reason','email','English\x20(US)','success','supplier'];a0_0x1427=function(){return _0x19041e;};return a0_0x1427();}