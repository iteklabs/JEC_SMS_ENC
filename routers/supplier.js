const a0_0x22e08d=a0_0x5b1b;function a0_0x79ce(){const _0x538a73=['receivable_sum','Workbook','$amount','Name','json','Supplier_Code','Content-Type','Mobile_number','117GCDtwm','post','multer','German','body','findOne','PBrands','redirect','279005DXsoKn','company','mobile','English','/view','public/Migration/','doc','supplier_product_file','Portuguese\x20(BR)','exports','28JBuiVT','Router','518350CMfnIy','utils','PUnits','columns','Portuguese','Customers','addWorksheet','landline','success','Spanish','public/Migration','976472ZRdLGs','../public/language/languages.json','diskStorage','Sheets','language','get','$reason','Chinese','reason','Arabic','Hindi','errors','purchase_return','contactperson','115568EEzHQo','now','params','amount','supplier','Arabic\x20(ae)','SalesmanName','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','supplier\x20data\x20add\x20successfully','357513RykfIx','send','supplier.js\x20payment_data','/supplier_import_migrate_file','single','user','express','11mmroGt','Purchase','findById','aggregate','message','exceljs','620078VTAQNh','Email','find','sheet_to_json','email','3sCMkNw','master','French','../middleware/auth','suppliers_code','save','flash','Purchase\x20Return','/view/:id','attachment;\x20filename=supplier_Migration_File.xlsx','render','/supplier/view','write','data','xlsx','status','log','error','forEach','1834464ucLKBb','name','English\x20(US)','address','\x20Failed','suppliers','supplier_payment'];a0_0x79ce=function(){return _0x538a73;};return a0_0x79ce();}(function(_0x396541,_0x44cde1){const _0xcc123d=a0_0x5b1b,_0x2886ae=_0x396541();while(!![]){try{const _0xdcc5f5=parseInt(_0xcc123d(0xe4))/0x1+parseInt(_0xcc123d(0x87))/0x2*(parseInt(_0xcc123d(0x8c))/0x3)+-parseInt(_0xcc123d(0xc0))/0x4*(parseInt(_0xcc123d(0xb6))/0x5)+parseInt(_0xcc123d(0x9f))/0x6+-parseInt(_0xcc123d(0xcd))/0x7+parseInt(_0xcc123d(0xdb))/0x8*(-parseInt(_0xcc123d(0xae))/0x9)+parseInt(_0xcc123d(0xc2))/0xa*(-parseInt(_0xcc123d(0x81))/0xb);if(_0xdcc5f5===_0x44cde1)break;else _0x2886ae['push'](_0x2886ae['shift']());}catch(_0x5b56aa){_0x2886ae['push'](_0x2886ae['shift']());}}}(a0_0x79ce,0x31b28));const express=require(a0_0x22e08d(0x80)),app=express(),router=express[a0_0x22e08d(0xc1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require('../models/all_models'),auth=require(a0_0x22e08d(0x8f)),users=require(a0_0x22e08d(0xce)),excelJS=require(a0_0x22e08d(0x86)),xlsx=require(a0_0x22e08d(0x9a)),multer=require(a0_0x22e08d(0xb0));router['get'](a0_0x22e08d(0xba),auth,async(_0x5a255c,_0x4d7eb0)=>{const _0x23d98c=a0_0x22e08d;try{const {username:_0xb8c37,email:_0xcc5c72,role:_0xff0dc6}=_0x5a255c[_0x23d98c(0x7f)],_0xc517a0=_0x5a255c[_0x23d98c(0x7f)],_0x35e5cb=await profile[_0x23d98c(0xb3)]({'email':_0xc517a0[_0x23d98c(0x8b)]}),_0x3f4b30=await master_shop[_0x23d98c(0x89)]();console[_0x23d98c(0x9c)]('master',_0x3f4b30);const _0xf00042=await suppliers[_0x23d98c(0x89)]();console[_0x23d98c(0x9c)](_0xf00042);const _0x171757=await suppliers[_0x23d98c(0x84)]([{'$lookup':{'from':'s_payments','localField':_0x23d98c(0xa0),'foreignField':_0x23d98c(0xa4),'as':'suppliers_docs'}}]),_0x3a63d9=_0x171757['map'](_0x4aa67e=>{const _0x45a4e9=_0x23d98c;console[_0x45a4e9(0x9c)](_0x45a4e9(0x99),_0x4aa67e);var _0x48cc09=0x0,_0x51a3ed=0x0;return _0x4aa67e['suppliers_docs'][_0x45a4e9(0x9e)](_0x527359=>{const _0x438299=_0x45a4e9;console[_0x438299(0x9c)](_0x438299(0xbc),_0x527359),_0x527359[_0x438299(0xd5)]==_0x438299(0x82)?_0x48cc09+=_0x527359[_0x438299(0xde)]:_0x51a3ed+=_0x527359[_0x438299(0xde)];}),_0x4aa67e['purchase']=_0x48cc09,_0x4aa67e[_0x45a4e9(0xd9)]=_0x51a3ed,_0x4aa67e;});console[_0x23d98c(0x9c)](_0x23d98c(0x7c),_0x3a63d9);if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0xa1)){var _0x5e0c44=users[_0x23d98c(0xb9)];console[_0x23d98c(0x9c)](_0x5e0c44);}else{if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0xd7))var _0x5e0c44=users[_0x23d98c(0xd7)];else{if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0xb1))var _0x5e0c44=users[_0x23d98c(0xb1)];else{if(_0x3f4b30[0x0]['language']==_0x23d98c(0xcb))var _0x5e0c44=users['Spanish'];else{if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0x8e))var _0x5e0c44=users[_0x23d98c(0x8e)];else{if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0xbe))var _0x5e0c44=users[_0x23d98c(0xc6)];else{if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0xd4))var _0x5e0c44=users[_0x23d98c(0xd4)];else{if(_0x3f4b30[0x0][_0x23d98c(0xd1)]==_0x23d98c(0xe0))var _0x5e0c44=users[_0x23d98c(0xd6)];}}}}}}}_0x4d7eb0['render'](_0x23d98c(0xdf),{'success':_0x5a255c['flash'](_0x23d98c(0xca)),'errors':_0x5a255c['flash'](_0x23d98c(0xd8)),'user':_0xf00042,'profile':_0x35e5cb,'master_shop':_0x3f4b30,'role':_0xc517a0,'payment':_0x3a63d9,'language':_0x5e0c44});}catch(_0x18e608){console[_0x23d98c(0x9c)](_0x18e608);}}),router[a0_0x22e08d(0xaf)](a0_0x22e08d(0xba),auth,async(_0x423194,_0x3991f6)=>{const _0x246a70=a0_0x22e08d;try{const {name:_0x4c1d09,email:_0x44cc93,mobile:_0x37e3d5,company:_0x56570d,address:_0x5b3d12,receivable:_0xef0e01,payable:_0x1a0a0b,code:_0x137dc7,contactperson:_0x44895a,landline:_0x582c91}=_0x423194[_0x246a70(0xb2)],_0xbafc6=new suppliers({'name':_0x4c1d09,'email':_0x44cc93,'mobile':_0x37e3d5,'company':_0x56570d,'address':_0x5b3d12,'receivable':_0xef0e01,'payable':_0x1a0a0b,'suppliers_code':_0x137dc7,'contactperson':_0x44895a,'landline':_0x582c91}),_0x5adf5e=await _0xbafc6[_0x246a70(0x91)]();_0x423194['flash']('success',_0x246a70(0xe3)),_0x3991f6['redirect'](_0x246a70(0x97));}catch(_0x1c93e5){console[_0x246a70(0x9c)](_0x1c93e5);}}),router[a0_0x22e08d(0xd2)](a0_0x22e08d(0x94),auth,async(_0x4ba663,_0x2e5471)=>{const _0x4b8006=a0_0x22e08d;try{const {username:_0x10e10d,email:_0xdac4e2,role:_0x3be97c}=_0x4ba663['user'],_0x3ba7b=_0x4ba663[_0x4b8006(0x7f)],_0x109b11=await profile[_0x4b8006(0xb3)]({'email':_0x3ba7b['email']}),_0x26cd0a=await master_shop['find']();console['log'](_0x4b8006(0x8d),_0x26cd0a);const _0x60fa60=_0x4ba663['params']['id'],_0x3e036e=await suppliers[_0x4b8006(0x83)](_0x60fa60);console[_0x4b8006(0x9c)](_0x3e036e);if(_0x26cd0a[0x0]['language']==_0x4b8006(0xa1)){var _0x24cc9e=users[_0x4b8006(0xb9)];console[_0x4b8006(0x9c)](_0x24cc9e);}else{if(_0x26cd0a[0x0][_0x4b8006(0xd1)]=='Hindi')var _0x24cc9e=users[_0x4b8006(0xd7)];else{if(_0x26cd0a[0x0]['language']==_0x4b8006(0xb1))var _0x24cc9e=users[_0x4b8006(0xb1)];else{if(_0x26cd0a[0x0]['language']==_0x4b8006(0xcb))var _0x24cc9e=users['Spanish'];else{if(_0x26cd0a[0x0][_0x4b8006(0xd1)]==_0x4b8006(0x8e))var _0x24cc9e=users['French'];else{if(_0x26cd0a[0x0][_0x4b8006(0xd1)]==_0x4b8006(0xbe))var _0x24cc9e=users[_0x4b8006(0xc6)];else{if(_0x26cd0a[0x0]['language']==_0x4b8006(0xd4))var _0x24cc9e=users[_0x4b8006(0xd4)];else{if(_0x26cd0a[0x0][_0x4b8006(0xd1)]==_0x4b8006(0xe0))var _0x24cc9e=users['Arabic'];}}}}}}}_0x2e5471['render']('supplier',{'success':_0x4ba663[_0x4b8006(0x92)]('success'),'errors':_0x4ba663[_0x4b8006(0x92)](_0x4b8006(0xd8)),'role':_0x3ba7b,'profile':_0x109b11,'master_shop':_0x26cd0a,'user':_0x3e036e,'language':_0x24cc9e});}catch(_0x334358){console[_0x4b8006(0x9c)](_0x334358);}}),router[a0_0x22e08d(0xaf)]('/view/:id',auth,async(_0x37b12b,_0x2df98c)=>{const _0x46f07d=a0_0x22e08d;try{const _0x5147a6=_0x37b12b['params']['id'],_0x43b90f=await suppliers[_0x46f07d(0x83)](_0x5147a6),{name:_0x6680f,email:_0x23f29f,mobile:_0x3fd83b,company:_0x2411bc,address:_0x258799,receivable:_0x28fb3b,payable:_0x57b8d5,code:_0x47fe9f,contactperson:_0x21d469,landline:_0x44d8e3}=_0x37b12b[_0x46f07d(0xb2)];_0x43b90f[_0x46f07d(0xa0)]=_0x6680f,_0x43b90f[_0x46f07d(0x8b)]=_0x23f29f,_0x43b90f[_0x46f07d(0xb8)]=_0x3fd83b,_0x43b90f[_0x46f07d(0xb7)]=_0x2411bc,_0x43b90f['address']=_0x258799,_0x43b90f['receivable']=_0x28fb3b,_0x43b90f['payable']=_0x57b8d5,_0x43b90f[_0x46f07d(0x90)]=_0x47fe9f,_0x43b90f[_0x46f07d(0xda)]=_0x21d469,_0x43b90f[_0x46f07d(0xc9)]=_0x44d8e3;const _0xd98dd0=await _0x43b90f[_0x46f07d(0x91)]();_0x37b12b[_0x46f07d(0x92)]('success','supplier\x20data\x20update\x20successfully'),_0x2df98c[_0x46f07d(0xb5)](_0x46f07d(0x97));}catch(_0x460082){console['log'](_0x460082);}}),router[a0_0x22e08d(0xd2)]('/view/payment/:id',auth,async(_0xf69908,_0x36e076)=>{const _0x15d5b1=a0_0x22e08d;try{const {username:_0x395d82,email:_0x30526d,role:_0x17de4b}=_0xf69908[_0x15d5b1(0x7f)],_0xb3c57b=_0xf69908[_0x15d5b1(0x7f)],_0x48e424=await profile[_0x15d5b1(0xb3)]({'email':_0xb3c57b['email']}),_0x2b27d1=await master_shop['find']();console[_0x15d5b1(0x9c)](_0x15d5b1(0x8d),_0x2b27d1),console['log'](_0xf69908['params']['id']);const _0x171367=await suppliers[_0x15d5b1(0xb3)]({'_id':_0xf69908[_0x15d5b1(0xdd)]['id']});console[_0x15d5b1(0x9c)](_0x171367);const _0x105c7d=await s_payment_data[_0x15d5b1(0x89)]({'suppliers':_0x171367[_0x15d5b1(0xa0)]});console[_0x15d5b1(0x9c)](_0x105c7d);const _0x35d172=await s_payment_data[_0x15d5b1(0x84)]([{'$match':{'suppliers':_0x171367[_0x15d5b1(0xa0)]}},{'$match':{'reason':_0x15d5b1(0x82)}},{'$group':{'_id':_0x15d5b1(0xd3),'sum':{'$sum':_0x15d5b1(0xa8)}}}]);console['log']('payable_sum',_0x35d172);const _0x36c6e1=await s_payment_data[_0x15d5b1(0x84)]([{'$match':{'suppliers':_0x171367[_0x15d5b1(0xa0)]}},{'$match':{'reason':_0x15d5b1(0x93)}},{'$group':{'_id':_0x15d5b1(0xd3),'sum':{'$sum':_0x15d5b1(0xa8)}}}]);console[_0x15d5b1(0x9c)](_0x15d5b1(0xa6),_0x36c6e1);if(_0x2b27d1[0x0][_0x15d5b1(0xd1)]=='English\x20(US)'){var _0x465f64=users[_0x15d5b1(0xb9)];console['log'](_0x465f64);}else{if(_0x2b27d1[0x0]['language']==_0x15d5b1(0xd7))var _0x465f64=users[_0x15d5b1(0xd7)];else{if(_0x2b27d1[0x0]['language']=='German')var _0x465f64=users['German'];else{if(_0x2b27d1[0x0]['language']==_0x15d5b1(0xcb))var _0x465f64=users['Spanish'];else{if(_0x2b27d1[0x0][_0x15d5b1(0xd1)]==_0x15d5b1(0x8e))var _0x465f64=users[_0x15d5b1(0x8e)];else{if(_0x2b27d1[0x0][_0x15d5b1(0xd1)]=='Portuguese\x20(BR)')var _0x465f64=users[_0x15d5b1(0xc6)];else{if(_0x2b27d1[0x0][_0x15d5b1(0xd1)]=='Chinese')var _0x465f64=users['Chinese'];else{if(_0x2b27d1[0x0]['language']==_0x15d5b1(0xe0))var _0x465f64=users[_0x15d5b1(0xd6)];}}}}}}}_0x36e076[_0x15d5b1(0x96)](_0x15d5b1(0xa5),{'success':_0xf69908['flash'](_0x15d5b1(0xca)),'errors':_0xf69908[_0x15d5b1(0x92)](_0x15d5b1(0xd8)),'role':_0xb3c57b,'profile':_0x48e424,'master_shop':_0x2b27d1,'payment':_0x105c7d,'payable':_0x35d172,'receivable':_0x36c6e1,'language':_0x465f64});}catch(_0x43fb73){console['log'](_0x43fb73);}}),router[a0_0x22e08d(0xd2)]('/products_export_migrate_file',auth,async(_0xf41c70,_0x408b45)=>{const _0x7c68e7=a0_0x22e08d;try{const _0x10a080=new excelJS[(_0x7c68e7(0xa7))](),_0x2d2864=_0x10a080[_0x7c68e7(0xc8)](_0x7c68e7(0xc7));return _0x2d2864[_0x7c68e7(0xc5)]=[{'header':_0x7c68e7(0xa9),'key':_0x7c68e7(0xb4),'width':0xa},{'header':_0x7c68e7(0xab),'key':_0x7c68e7(0xc4),'width':0xa},{'header':_0x7c68e7(0x88),'key':_0x7c68e7(0xe1),'width':0xa},{'header':_0x7c68e7(0xad),'key':'address','width':0xa},{'header':'Company_Name','key':_0x7c68e7(0xb8),'width':0xa},{'header':_0x7c68e7(0xa2),'key':_0x7c68e7(0x8b),'width':0xa}],_0x408b45['setHeader'](_0x7c68e7(0xac),_0x7c68e7(0xe2)),_0x408b45['setHeader']('Content-Disposition',_0x7c68e7(0x95)),_0x10a080[_0x7c68e7(0x9a)][_0x7c68e7(0x98)](_0x408b45)['then'](()=>{_0x408b45['status'](0xc8);});}catch(_0x45b9e5){_0x408b45[_0x7c68e7(0x9b)](0x190)[_0x7c68e7(0x7b)]({'errors':_0x45b9e5[_0x7c68e7(0x85)]});}});const storage1=multer[a0_0x22e08d(0xcf)]({'destination':(_0x355127,_0x31eb85,_0x4acbca)=>{const _0x475ee0=a0_0x22e08d;_0x4acbca(null,_0x475ee0(0xcc));},'filename':(_0x44325c,_0x1c315e,_0x407a30)=>{const _0x31ba40=a0_0x22e08d;_0x407a30(null,Date[_0x31ba40(0xdc)]()+_0x1c315e['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0x5b1b(_0x2f771c,_0x41db2c){const _0x79ce92=a0_0x79ce();return a0_0x5b1b=function(_0x5b1b75,_0x2c31f2){_0x5b1b75=_0x5b1b75-0x7b;let _0x1ee454=_0x79ce92[_0x5b1b75];return _0x1ee454;},a0_0x5b1b(_0x2f771c,_0x41db2c);}router[a0_0x22e08d(0xaf)](a0_0x22e08d(0x7d),auth,uploadMigrate[a0_0x22e08d(0x7e)](a0_0x22e08d(0xbd)),async(_0x292564,_0x13e02f)=>{const _0x5a7bb1=a0_0x22e08d,_0x199014=_0x292564['file']['filename'],_0x414fde=await xlsx['readFile'](_0x5a7bb1(0xbb)+_0x199014);let _0x3ecfac=_0x414fde['SheetNames'],_0x2d66b3=xlsx[_0x5a7bb1(0xc3)][_0x5a7bb1(0x8a)](_0x414fde[_0x5a7bb1(0xd0)][_0x3ecfac[0x0]]);for(const _0x9f4a22 of _0x2d66b3){const _0x16fec4=_0x9f4a22['Name'],_0x1c9be9=_0x9f4a22['Supplier_Code'],_0x56bfea=_0x9f4a22[_0x5a7bb1(0xa2)],_0x258ce7=_0x9f4a22[_0x5a7bb1(0xad)],_0x2454c4=_0x9f4a22[_0x5a7bb1(0x88)],_0x2a17f4=_0x9f4a22['Company_Name'];try{let _0x10750a=await suppliers['findOne']({'name':_0x16fec4});if(!_0x10750a){const _0x52f0d5=new suppliers({'name':_0x16fec4,'suppliers_code':_0x1c9be9,'address':_0x56bfea,'mobile':_0x258ce7,'email':_0x2454c4,'company':_0x2a17f4});_0x10750a=await _0x52f0d5['save'](),_0x292564['flash']('success',_0x16fec4+'\x20added\x20successfully');}else _0x292564[_0x5a7bb1(0x92)](_0x5a7bb1(0x9d),_0x16fec4+_0x5a7bb1(0xa3));}catch(_0x5d8201){_0x13e02f['status'](0x1f4)[_0x5a7bb1(0xaa)]({'proderror':_0x5d8201[_0x5a7bb1(0x85)],'aproduct':ProductName});}}_0x13e02f['redirect']('/supplier/view');}),module[a0_0x22e08d(0xbf)]=router;