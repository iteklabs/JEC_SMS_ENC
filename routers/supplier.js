const a0_0x4942ea=a0_0x5069;(function(_0x1af093,_0x1169e1){const _0x11d075=a0_0x5069,_0x231f4f=_0x1af093();while(!![]){try{const _0x20657f=-parseInt(_0x11d075(0x160))/0x1*(parseInt(_0x11d075(0x14e))/0x2)+parseInt(_0x11d075(0x17a))/0x3+-parseInt(_0x11d075(0x158))/0x4+parseInt(_0x11d075(0x16c))/0x5+parseInt(_0x11d075(0x153))/0x6*(-parseInt(_0x11d075(0x184))/0x7)+parseInt(_0x11d075(0x19a))/0x8+-parseInt(_0x11d075(0x167))/0x9*(-parseInt(_0x11d075(0x171))/0xa);if(_0x20657f===_0x1169e1)break;else _0x231f4f['push'](_0x231f4f['shift']());}catch(_0x51583d){_0x231f4f['push'](_0x231f4f['shift']());}}}(a0_0x3b06,0xcaf19));function a0_0x3b06(){const _0x2de291=['data','company','find','sheet_to_json','4IEKPtV','redirect','findById','landline','Spanish','Portuguese','single','18hLkACp','columns','mobile','message','forEach','1259225BlHWrh','/products_export_migrate_file','supplier_product_file','suppliers_docs','Sheets','5006680MnAmfo','Arabic\x20(ae)','payable_sum','xlsx','English\x20(US)','then','German','originalname','filename','339153Bmderq','Purchase','supplier','suppliers_code','public/Migration/','email','render','language','success','Purchase\x20Return','7063847QCCGzV','Router','payable','/view/:id','/supplier/view','PUnits','status','setHeader','Hindi','Arabic','aggregate','s_payments','public/Migration','address','$amount','\x20Failed','supplier\x20data\x20add\x20successfully','contactperson','express','name','purchase_return','receivable','12304648PlCDjI','/view/payment/:id','$reason','supplier\x20data\x20update\x20successfully','readFile','SheetNames','post','params','Email','Name','addWorksheet','Chinese','../middleware/auth','amount','\x20added\x20successfully','flash','English','Workbook','get','multer','file','user','send','log','supplier_payment','French','Portuguese\x20(BR)','Company_Name','482244miXQph','/view','exports','reason','master','6XrGPXK','Mobile_number','/supplier_import_migrate_file','utils','findOne','397788mlzojS','save','../public/language/languages.json','errors'];a0_0x3b06=function(){return _0x2de291;};return a0_0x3b06();}const express=require(a0_0x4942ea(0x196)),app=express(),router=express[a0_0x4942ea(0x185)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require('../models/all_models'),auth=require(a0_0x4942ea(0x1a6)),users=require(a0_0x4942ea(0x15a)),excelJS=require('exceljs'),xlsx=require('xlsx'),multer=require(a0_0x4942ea(0x145));router[a0_0x4942ea(0x144)]('/view',auth,async(_0xad6412,_0x31e92d)=>{const _0x1432a7=a0_0x4942ea;try{const {username:_0x4ba36e,email:_0x28e06a,role:_0x5eabb1}=_0xad6412[_0x1432a7(0x147)],_0x2565d3=_0xad6412['user'],_0x27e379=await profile[_0x1432a7(0x157)]({'email':_0x2565d3[_0x1432a7(0x17f)]}),_0x1dfa37=await master_shop['find']();console[_0x1432a7(0x149)](_0x1432a7(0x152),_0x1dfa37);const _0x5d2fca=await suppliers['find']();console[_0x1432a7(0x149)](_0x5d2fca);const _0x322fb3=await suppliers[_0x1432a7(0x18e)]([{'$lookup':{'from':_0x1432a7(0x18f),'localField':'name','foreignField':'suppliers','as':'suppliers_docs'}}]),_0x26fdd4=_0x322fb3['map'](_0x2ad048=>{const _0x490a32=_0x1432a7;console['log'](_0x490a32(0x15c),_0x2ad048);var _0x50f6dc=0x0,_0x100025=0x0;return _0x2ad048[_0x490a32(0x16f)][_0x490a32(0x16b)](_0x5da123=>{const _0x559fb9=_0x490a32;console[_0x559fb9(0x149)]('doc',_0x5da123),_0x5da123[_0x559fb9(0x151)]==_0x559fb9(0x17b)?_0x50f6dc+=_0x5da123[_0x559fb9(0x13f)]:_0x100025+=_0x5da123[_0x559fb9(0x13f)];}),_0x2ad048['purchase']=_0x50f6dc,_0x2ad048[_0x490a32(0x198)]=_0x100025,_0x2ad048;});console[_0x1432a7(0x149)]('supplier.js\x20payment_data',_0x26fdd4);if(_0x1dfa37[0x0][_0x1432a7(0x181)]==_0x1432a7(0x175)){var _0x46a333=users['English'];console[_0x1432a7(0x149)](_0x46a333);}else{if(_0x1dfa37[0x0]['language']==_0x1432a7(0x18c))var _0x46a333=users[_0x1432a7(0x18c)];else{if(_0x1dfa37[0x0][_0x1432a7(0x181)]==_0x1432a7(0x177))var _0x46a333=users[_0x1432a7(0x177)];else{if(_0x1dfa37[0x0][_0x1432a7(0x181)]==_0x1432a7(0x164))var _0x46a333=users['Spanish'];else{if(_0x1dfa37[0x0][_0x1432a7(0x181)]=='French')var _0x46a333=users[_0x1432a7(0x14b)];else{if(_0x1dfa37[0x0][_0x1432a7(0x181)]==_0x1432a7(0x14c))var _0x46a333=users['Portuguese'];else{if(_0x1dfa37[0x0][_0x1432a7(0x181)]=='Chinese')var _0x46a333=users[_0x1432a7(0x1a5)];else{if(_0x1dfa37[0x0][_0x1432a7(0x181)]==_0x1432a7(0x172))var _0x46a333=users[_0x1432a7(0x18d)];}}}}}}}_0x31e92d[_0x1432a7(0x180)](_0x1432a7(0x17c),{'success':_0xad6412[_0x1432a7(0x141)]('success'),'errors':_0xad6412['flash']('errors'),'user':_0x5d2fca,'profile':_0x27e379,'master_shop':_0x1dfa37,'role':_0x2565d3,'payment':_0x26fdd4,'language':_0x46a333});}catch(_0x42b213){console[_0x1432a7(0x149)](_0x42b213);}}),router[a0_0x4942ea(0x1a0)](a0_0x4942ea(0x14f),auth,async(_0x12179c,_0xfc1d75)=>{const _0x4bcf4e=a0_0x4942ea;try{const {name:_0x50902c,email:_0x3bc04c,mobile:_0x43c074,company:_0xf84deb,address:_0x1ec72c,receivable:_0x276138,payable:_0x21c4d5,code:_0xbd3592,contactperson:_0x6572a6,landline:_0x5415fb}=_0x12179c['body'],_0x18a315=new suppliers({'name':_0x50902c,'email':_0x3bc04c,'mobile':_0x43c074,'company':_0xf84deb,'address':_0x1ec72c,'receivable':_0x276138,'payable':_0x21c4d5,'suppliers_code':_0xbd3592,'contactperson':_0x6572a6,'landline':_0x5415fb}),_0x4c0f13=await _0x18a315[_0x4bcf4e(0x159)]();_0x12179c[_0x4bcf4e(0x141)]('success',_0x4bcf4e(0x194)),_0xfc1d75['redirect']('/supplier/view');}catch(_0x249a0d){console[_0x4bcf4e(0x149)](_0x249a0d);}}),router[a0_0x4942ea(0x144)](a0_0x4942ea(0x187),auth,async(_0x4bda44,_0x26ce3d)=>{const _0x1981ec=a0_0x4942ea;try{const {username:_0x193dbb,email:_0x2a39b4,role:_0x5dc8d8}=_0x4bda44['user'],_0x389314=_0x4bda44['user'],_0x5082de=await profile[_0x1981ec(0x157)]({'email':_0x389314[_0x1981ec(0x17f)]}),_0x583d87=await master_shop[_0x1981ec(0x15e)]();console[_0x1981ec(0x149)](_0x1981ec(0x152),_0x583d87);const _0x2e1404=_0x4bda44[_0x1981ec(0x1a1)]['id'],_0x3eb130=await suppliers['findById'](_0x2e1404);console['log'](_0x3eb130);if(_0x583d87[0x0]['language']==_0x1981ec(0x175)){var _0x5ac0ff=users['English'];console[_0x1981ec(0x149)](_0x5ac0ff);}else{if(_0x583d87[0x0][_0x1981ec(0x181)]==_0x1981ec(0x18c))var _0x5ac0ff=users[_0x1981ec(0x18c)];else{if(_0x583d87[0x0][_0x1981ec(0x181)]==_0x1981ec(0x177))var _0x5ac0ff=users[_0x1981ec(0x177)];else{if(_0x583d87[0x0]['language']==_0x1981ec(0x164))var _0x5ac0ff=users[_0x1981ec(0x164)];else{if(_0x583d87[0x0]['language']==_0x1981ec(0x14b))var _0x5ac0ff=users[_0x1981ec(0x14b)];else{if(_0x583d87[0x0][_0x1981ec(0x181)]==_0x1981ec(0x14c))var _0x5ac0ff=users[_0x1981ec(0x165)];else{if(_0x583d87[0x0][_0x1981ec(0x181)]==_0x1981ec(0x1a5))var _0x5ac0ff=users[_0x1981ec(0x1a5)];else{if(_0x583d87[0x0]['language']==_0x1981ec(0x172))var _0x5ac0ff=users[_0x1981ec(0x18d)];}}}}}}}_0x26ce3d[_0x1981ec(0x180)](_0x1981ec(0x17c),{'success':_0x4bda44[_0x1981ec(0x141)](_0x1981ec(0x182)),'errors':_0x4bda44[_0x1981ec(0x141)](_0x1981ec(0x15b)),'role':_0x389314,'profile':_0x5082de,'master_shop':_0x583d87,'user':_0x3eb130,'language':_0x5ac0ff});}catch(_0x4b609a){console['log'](_0x4b609a);}}),router['post'](a0_0x4942ea(0x187),auth,async(_0x5141c7,_0x39673d)=>{const _0x3e431f=a0_0x4942ea;try{const _0x3c0f75=_0x5141c7[_0x3e431f(0x1a1)]['id'],_0x83dfbc=await suppliers[_0x3e431f(0x162)](_0x3c0f75),{name:_0x4dd965,email:_0x3c69ff,mobile:_0x1a5f4b,company:_0xdbab1a,address:_0x1d685a,receivable:_0x5578eb,payable:_0xb31234,code:_0x123b8d,contactperson:_0x2e02a0,landline:_0x2a5829}=_0x5141c7['body'];_0x83dfbc['name']=_0x4dd965,_0x83dfbc[_0x3e431f(0x17f)]=_0x3c69ff,_0x83dfbc[_0x3e431f(0x169)]=_0x1a5f4b,_0x83dfbc[_0x3e431f(0x15d)]=_0xdbab1a,_0x83dfbc[_0x3e431f(0x191)]=_0x1d685a,_0x83dfbc[_0x3e431f(0x199)]=_0x5578eb,_0x83dfbc[_0x3e431f(0x186)]=_0xb31234,_0x83dfbc[_0x3e431f(0x17d)]=_0x123b8d,_0x83dfbc[_0x3e431f(0x195)]=_0x2e02a0,_0x83dfbc[_0x3e431f(0x163)]=_0x2a5829;const _0x4a18d1=await _0x83dfbc[_0x3e431f(0x159)]();_0x5141c7['flash']('success',_0x3e431f(0x19d)),_0x39673d['redirect'](_0x3e431f(0x188));}catch(_0x270c17){console[_0x3e431f(0x149)](_0x270c17);}}),router[a0_0x4942ea(0x144)](a0_0x4942ea(0x19b),auth,async(_0x1da03b,_0x2ecee3)=>{const _0x422e34=a0_0x4942ea;try{const {username:_0x56f0d3,email:_0x4e2524,role:_0x1384bd}=_0x1da03b[_0x422e34(0x147)],_0x457f75=_0x1da03b[_0x422e34(0x147)],_0x46bf25=await profile[_0x422e34(0x157)]({'email':_0x457f75['email']}),_0x465d81=await master_shop[_0x422e34(0x15e)]();console['log']('master',_0x465d81),console[_0x422e34(0x149)](_0x1da03b[_0x422e34(0x1a1)]['id']);const _0x28fbfc=await suppliers[_0x422e34(0x157)]({'_id':_0x1da03b[_0x422e34(0x1a1)]['id']});console[_0x422e34(0x149)](_0x28fbfc);const _0x20d46=await s_payment_data[_0x422e34(0x15e)]({'suppliers':_0x28fbfc['name']});console[_0x422e34(0x149)](_0x20d46);const _0xcbdb7c=await s_payment_data[_0x422e34(0x18e)]([{'$match':{'suppliers':_0x28fbfc[_0x422e34(0x197)]}},{'$match':{'reason':_0x422e34(0x17b)}},{'$group':{'_id':_0x422e34(0x19c),'sum':{'$sum':'$amount'}}}]);console[_0x422e34(0x149)](_0x422e34(0x173),_0xcbdb7c);const _0x4f5f7e=await s_payment_data['aggregate']([{'$match':{'suppliers':_0x28fbfc[_0x422e34(0x197)]}},{'$match':{'reason':_0x422e34(0x183)}},{'$group':{'_id':_0x422e34(0x19c),'sum':{'$sum':_0x422e34(0x192)}}}]);console['log']('receivable_sum',_0x4f5f7e);if(_0x465d81[0x0][_0x422e34(0x181)]==_0x422e34(0x175)){var _0x11493e=users[_0x422e34(0x142)];console['log'](_0x11493e);}else{if(_0x465d81[0x0][_0x422e34(0x181)]=='Hindi')var _0x11493e=users[_0x422e34(0x18c)];else{if(_0x465d81[0x0][_0x422e34(0x181)]==_0x422e34(0x177))var _0x11493e=users[_0x422e34(0x177)];else{if(_0x465d81[0x0][_0x422e34(0x181)]==_0x422e34(0x164))var _0x11493e=users['Spanish'];else{if(_0x465d81[0x0][_0x422e34(0x181)]==_0x422e34(0x14b))var _0x11493e=users[_0x422e34(0x14b)];else{if(_0x465d81[0x0][_0x422e34(0x181)]=='Portuguese\x20(BR)')var _0x11493e=users[_0x422e34(0x165)];else{if(_0x465d81[0x0][_0x422e34(0x181)]=='Chinese')var _0x11493e=users[_0x422e34(0x1a5)];else{if(_0x465d81[0x0][_0x422e34(0x181)]==_0x422e34(0x172))var _0x11493e=users[_0x422e34(0x18d)];}}}}}}}_0x2ecee3[_0x422e34(0x180)](_0x422e34(0x14a),{'success':_0x1da03b[_0x422e34(0x141)](_0x422e34(0x182)),'errors':_0x1da03b[_0x422e34(0x141)](_0x422e34(0x15b)),'role':_0x457f75,'profile':_0x46bf25,'master_shop':_0x465d81,'payment':_0x20d46,'payable':_0xcbdb7c,'receivable':_0x4f5f7e,'language':_0x11493e});}catch(_0x1d6278){console[_0x422e34(0x149)](_0x1d6278);}}),router['get'](a0_0x4942ea(0x16d),auth,async(_0x56e358,_0x9670c3)=>{const _0x511072=a0_0x4942ea;try{const _0x565514=new excelJS[(_0x511072(0x143))](),_0x357f54=_0x565514[_0x511072(0x1a4)]('Customers');return _0x357f54[_0x511072(0x168)]=[{'header':_0x511072(0x1a3),'key':'PBrands','width':0xa},{'header':'Supplier_Code','key':_0x511072(0x189),'width':0xa},{'header':_0x511072(0x1a2),'key':'SalesmanName','width':0xa},{'header':'Mobile_number','key':_0x511072(0x191),'width':0xa},{'header':_0x511072(0x14d),'key':_0x511072(0x169),'width':0xa},{'header':_0x511072(0x191),'key':_0x511072(0x17f),'width':0xa}],_0x9670c3[_0x511072(0x18b)]('Content-Type','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x9670c3['setHeader']('Content-Disposition','attachment;\x20filename=supplier_Migration_File.xlsx'),_0x565514[_0x511072(0x174)]['write'](_0x9670c3)[_0x511072(0x176)](()=>{const _0x4ce6cf=_0x511072;_0x9670c3[_0x4ce6cf(0x18a)](0xc8);});}catch(_0x25efd4){_0x9670c3[_0x511072(0x18a)](0x190)[_0x511072(0x148)]({'errors':_0x25efd4[_0x511072(0x16a)]});}});const storage1=multer['diskStorage']({'destination':(_0xb90363,_0x51cc67,_0x10d6c2)=>{const _0x33cdc7=a0_0x4942ea;_0x10d6c2(null,_0x33cdc7(0x190));},'filename':(_0x4666c2,_0x32e64b,_0x16c30a)=>{const _0x76c41a=a0_0x4942ea;_0x16c30a(null,Date['now']()+_0x32e64b[_0x76c41a(0x178)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x5069(_0x106d6b,_0x23585e){const _0x3b0662=a0_0x3b06();return a0_0x5069=function(_0x506946,_0x5bd7a5){_0x506946=_0x506946-0x13f;let _0x246380=_0x3b0662[_0x506946];return _0x246380;},a0_0x5069(_0x106d6b,_0x23585e);}router[a0_0x4942ea(0x1a0)](a0_0x4942ea(0x155),auth,uploadMigrate[a0_0x4942ea(0x166)](a0_0x4942ea(0x16e)),async(_0x4ace96,_0x5672a1)=>{const _0xa96330=a0_0x4942ea,_0x5dc3ec=_0x4ace96[_0xa96330(0x146)][_0xa96330(0x179)],_0x35ecf6=await xlsx[_0xa96330(0x19e)](_0xa96330(0x17e)+_0x5dc3ec);let _0xf80039=_0x35ecf6[_0xa96330(0x19f)],_0x491761=xlsx[_0xa96330(0x156)][_0xa96330(0x15f)](_0x35ecf6[_0xa96330(0x170)][_0xf80039[0x0]]);for(const _0x5c7b4c of _0x491761){const _0x4426f7=_0x5c7b4c[_0xa96330(0x1a3)],_0x302b40=_0x5c7b4c['Supplier_Code'],_0x21d0f9=_0x5c7b4c['address'],_0x131074=_0x5c7b4c[_0xa96330(0x154)],_0x297577=_0x5c7b4c['Email'],_0x31f8ab=_0x5c7b4c['Company_Name'];try{let _0x5a884c=await suppliers['findOne']({'name':_0x4426f7});if(!_0x5a884c){const _0x525fc4=new suppliers({'name':_0x4426f7,'suppliers_code':_0x302b40,'address':_0x21d0f9,'mobile':_0x131074,'email':_0x297577,'company':_0x31f8ab});_0x5a884c=await _0x525fc4['save'](),_0x4ace96[_0xa96330(0x141)](_0xa96330(0x182),_0x4426f7+_0xa96330(0x140));}else _0x4ace96[_0xa96330(0x141)]('error',_0x4426f7+_0xa96330(0x193));}catch(_0x4e7dd5){_0x5672a1['status'](0x1f4)['json']({'proderror':_0x4e7dd5[_0xa96330(0x16a)],'aproduct':ProductName});}}_0x5672a1[_0xa96330(0x161)](_0xa96330(0x188));}),module[a0_0x4942ea(0x150)]=router;