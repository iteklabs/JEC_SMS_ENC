const a0_0x2e8364=a0_0x5662;(function(_0x40bd23,_0x54df0d){const _0x12f0ce=a0_0x5662,_0x74c2af=_0x40bd23();while(!![]){try{const _0x2e15ba=-parseInt(_0x12f0ce(0xc0))/0x1*(-parseInt(_0x12f0ce(0xc2))/0x2)+-parseInt(_0x12f0ce(0xa6))/0x3*(parseInt(_0x12f0ce(0xa5))/0x4)+parseInt(_0x12f0ce(0xac))/0x5+parseInt(_0x12f0ce(0xda))/0x6*(-parseInt(_0x12f0ce(0x89))/0x7)+parseInt(_0x12f0ce(0xe1))/0x8*(-parseInt(_0x12f0ce(0xa3))/0x9)+parseInt(_0x12f0ce(0x8d))/0xa*(-parseInt(_0x12f0ce(0xce))/0xb)+-parseInt(_0x12f0ce(0xa1))/0xc*(-parseInt(_0x12f0ce(0xc7))/0xd);if(_0x2e15ba===_0x54df0d)break;else _0x74c2af['push'](_0x74c2af['shift']());}catch(_0x3e2848){_0x74c2af['push'](_0x74c2af['shift']());}}}(a0_0x3d51,0xd3215));const express=require(a0_0x2e8364(0xc3)),app=express(),router=express[a0_0x2e8364(0xcf)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require('../models/all_models'),auth=require(a0_0x2e8364(0x96)),users=require('../public/language/languages.json'),excelJS=require(a0_0x2e8364(0x93)),xlsx=require(a0_0x2e8364(0x9b)),multer=require('multer');router[a0_0x2e8364(0x9f)]('/view',auth,async(_0x13d1a1,_0x2c474d)=>{const _0x422019=a0_0x2e8364;try{const {username:_0x585f94,email:_0x56a26b,role:_0x3b8729}=_0x13d1a1[_0x422019(0xdc)],_0x5d42b8=_0x13d1a1[_0x422019(0xdc)],_0x40ab75=await profile[_0x422019(0x8f)]({'email':_0x5d42b8[_0x422019(0xd1)]}),_0x57a0b7=await master_shop[_0x422019(0xbe)]();console[_0x422019(0xe0)](_0x422019(0xcb),_0x57a0b7);const _0xb195bc=await suppliers['find']();console['log'](_0xb195bc);const _0x1785a7=await suppliers[_0x422019(0xd5)]([{'$lookup':{'from':_0x422019(0xd9),'localField':'name','foreignField':_0x422019(0xa9),'as':_0x422019(0xe4)}}]),_0x38d3a0=_0x1785a7[_0x422019(0xe5)](_0x2578ae=>{const _0x2553d4=_0x422019;console['log']('data',_0x2578ae);var _0x328e19=0x0,_0x2feec6=0x0;return _0x2578ae['suppliers_docs']['forEach'](_0x5ac5cc=>{const _0x3cf52d=a0_0x5662;console[_0x3cf52d(0xe0)](_0x3cf52d(0xd4),_0x5ac5cc),_0x5ac5cc['reason']==_0x3cf52d(0xb1)?_0x328e19+=_0x5ac5cc[_0x3cf52d(0xc5)]:_0x2feec6+=_0x5ac5cc[_0x3cf52d(0xc5)];}),_0x2578ae[_0x2553d4(0xb6)]=_0x328e19,_0x2578ae[_0x2553d4(0xb7)]=_0x2feec6,_0x2578ae;});console[_0x422019(0xe0)](_0x422019(0x90),_0x38d3a0);if(_0x57a0b7[0x0][_0x422019(0xaf)]==_0x422019(0x8b)){var _0x40ebe4=users[_0x422019(0xd2)];console[_0x422019(0xe0)](_0x40ebe4);}else{if(_0x57a0b7[0x0]['language']==_0x422019(0xd7))var _0x40ebe4=users[_0x422019(0xd7)];else{if(_0x57a0b7[0x0][_0x422019(0xaf)]==_0x422019(0xd8))var _0x40ebe4=users[_0x422019(0xd8)];else{if(_0x57a0b7[0x0]['language']==_0x422019(0xaa))var _0x40ebe4=users[_0x422019(0xaa)];else{if(_0x57a0b7[0x0][_0x422019(0xaf)]==_0x422019(0xbd))var _0x40ebe4=users[_0x422019(0xbd)];else{if(_0x57a0b7[0x0][_0x422019(0xaf)]==_0x422019(0x94))var _0x40ebe4=users['Portuguese'];else{if(_0x57a0b7[0x0][_0x422019(0xaf)]==_0x422019(0xe6))var _0x40ebe4=users[_0x422019(0xe6)];else{if(_0x57a0b7[0x0][_0x422019(0xaf)]==_0x422019(0xcc))var _0x40ebe4=users[_0x422019(0xdb)];}}}}}}}_0x2c474d['render'](_0x422019(0xbb),{'success':_0x13d1a1['flash'](_0x422019(0xb0)),'errors':_0x13d1a1[_0x422019(0xb4)](_0x422019(0xa0)),'user':_0xb195bc,'profile':_0x40ab75,'master_shop':_0x57a0b7,'role':_0x5d42b8,'payment':_0x38d3a0,'language':_0x40ebe4});}catch(_0x23c48e){console[_0x422019(0xe0)](_0x23c48e);}}),router['post']('/view',auth,async(_0xa52c07,_0x226455)=>{const _0x1067b8=a0_0x2e8364;try{const {name:_0x4881da,email:_0x5d956d,mobile:_0x3611ca,company:_0x41aefb,address:_0x49754e,receivable:_0x18b193,payable:_0x44b3da,code:_0x1e9bca,contactperson:_0x2ec41c,landline:_0x27cdd9}=_0xa52c07[_0x1067b8(0xae)],_0x5c3267=new suppliers({'name':_0x4881da,'email':_0x5d956d,'mobile':_0x3611ca,'company':_0x41aefb,'address':_0x49754e,'receivable':_0x18b193,'payable':_0x44b3da,'suppliers_code':_0x1e9bca,'contactperson':_0x2ec41c,'landline':_0x27cdd9}),_0x20aa7e=await _0x5c3267['save']();_0xa52c07['flash'](_0x1067b8(0xb0),_0x1067b8(0xc4)),_0x226455[_0x1067b8(0xb2)]('/supplier/view');}catch(_0x27278d){console[_0x1067b8(0xe0)](_0x27278d);}}),router[a0_0x2e8364(0x9f)](a0_0x2e8364(0x8c),auth,async(_0xf364cd,_0x316570)=>{const _0x210638=a0_0x2e8364;try{const {username:_0x4ae1cf,email:_0x51ccb4,role:_0x20af4b}=_0xf364cd['user'],_0x3a4365=_0xf364cd[_0x210638(0xdc)],_0x2b7122=await profile[_0x210638(0x8f)]({'email':_0x3a4365[_0x210638(0xd1)]}),_0x50715f=await master_shop['find']();console[_0x210638(0xe0)](_0x210638(0xcb),_0x50715f);const _0x4a4ecf=_0xf364cd[_0x210638(0x91)]['id'],_0x2576be=await suppliers['findById'](_0x4a4ecf);console['log'](_0x2576be);if(_0x50715f[0x0][_0x210638(0xaf)]=='English\x20(US)'){var _0x56fa9f=users[_0x210638(0xd2)];console[_0x210638(0xe0)](_0x56fa9f);}else{if(_0x50715f[0x0][_0x210638(0xaf)]==_0x210638(0xd7))var _0x56fa9f=users[_0x210638(0xd7)];else{if(_0x50715f[0x0]['language']==_0x210638(0xd8))var _0x56fa9f=users['German'];else{if(_0x50715f[0x0][_0x210638(0xaf)]==_0x210638(0xaa))var _0x56fa9f=users['Spanish'];else{if(_0x50715f[0x0]['language']==_0x210638(0xbd))var _0x56fa9f=users[_0x210638(0xbd)];else{if(_0x50715f[0x0][_0x210638(0xaf)]=='Portuguese\x20(BR)')var _0x56fa9f=users['Portuguese'];else{if(_0x50715f[0x0][_0x210638(0xaf)]==_0x210638(0xe6))var _0x56fa9f=users[_0x210638(0xe6)];else{if(_0x50715f[0x0][_0x210638(0xaf)]==_0x210638(0xcc))var _0x56fa9f=users[_0x210638(0xdb)];}}}}}}}_0x316570['render'](_0x210638(0xbb),{'success':_0xf364cd[_0x210638(0xb4)](_0x210638(0xb0)),'errors':_0xf364cd['flash']('errors'),'role':_0x3a4365,'profile':_0x2b7122,'master_shop':_0x50715f,'user':_0x2576be,'language':_0x56fa9f});}catch(_0x2b379a){console[_0x210638(0xe0)](_0x2b379a);}}),router['post']('/view/:id',auth,async(_0x508f8e,_0x66322)=>{const _0x251072=a0_0x2e8364;try{const _0x5d154c=_0x508f8e[_0x251072(0x91)]['id'],_0x585358=await suppliers[_0x251072(0xb8)](_0x5d154c),{name:_0x16906e,email:_0x272a3d,mobile:_0x35fb9e,company:_0x1ef309,address:_0x230ef8,receivable:_0x764497,payable:_0x2d5eb7,code:_0x48f967,contactperson:_0xc8c473,landline:_0x4b5b9e}=_0x508f8e['body'];_0x585358[_0x251072(0x99)]=_0x16906e,_0x585358[_0x251072(0xd1)]=_0x272a3d,_0x585358[_0x251072(0x92)]=_0x35fb9e,_0x585358['company']=_0x1ef309,_0x585358[_0x251072(0xb9)]=_0x230ef8,_0x585358['receivable']=_0x764497,_0x585358[_0x251072(0x98)]=_0x2d5eb7,_0x585358['suppliers_code']=_0x48f967,_0x585358[_0x251072(0x9d)]=_0xc8c473,_0x585358['landline']=_0x4b5b9e;const _0x521de8=await _0x585358[_0x251072(0x95)]();_0x508f8e[_0x251072(0xb4)](_0x251072(0xb0),'supplier\x20data\x20update\x20successfully'),_0x66322[_0x251072(0xb2)](_0x251072(0xc9));}catch(_0x27e730){console[_0x251072(0xe0)](_0x27e730);}}),router[a0_0x2e8364(0x9f)](a0_0x2e8364(0xba),auth,async(_0x5ad3c8,_0x46554b)=>{const _0x16fa55=a0_0x2e8364;try{const {username:_0x25dc84,email:_0x5b7acb,role:_0x2a2b38}=_0x5ad3c8[_0x16fa55(0xdc)],_0x1ce90b=_0x5ad3c8[_0x16fa55(0xdc)],_0x59e0f0=await profile[_0x16fa55(0x8f)]({'email':_0x1ce90b[_0x16fa55(0xd1)]}),_0x2a6985=await master_shop[_0x16fa55(0xbe)]();console[_0x16fa55(0xe0)]('master',_0x2a6985),console[_0x16fa55(0xe0)](_0x5ad3c8[_0x16fa55(0x91)]['id']);const _0x46a7f4=await suppliers['findOne']({'_id':_0x5ad3c8[_0x16fa55(0x91)]['id']});console[_0x16fa55(0xe0)](_0x46a7f4);const _0xf2062=await s_payment_data[_0x16fa55(0xbe)]({'suppliers':_0x46a7f4['name']});console['log'](_0xf2062);const _0x2cf1ba=await s_payment_data[_0x16fa55(0xd5)]([{'$match':{'suppliers':_0x46a7f4[_0x16fa55(0x99)]}},{'$match':{'reason':'Purchase'}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x16fa55(0xe0)](_0x16fa55(0xca),_0x2cf1ba);const _0x2dbaac=await s_payment_data[_0x16fa55(0xd5)]([{'$match':{'suppliers':_0x46a7f4[_0x16fa55(0x99)]}},{'$match':{'reason':_0x16fa55(0xde)}},{'$group':{'_id':_0x16fa55(0xd6),'sum':{'$sum':_0x16fa55(0x97)}}}]);console[_0x16fa55(0xe0)]('receivable_sum',_0x2dbaac);if(_0x2a6985[0x0]['language']==_0x16fa55(0x8b)){var _0x4bbe7b=users[_0x16fa55(0xd2)];console[_0x16fa55(0xe0)](_0x4bbe7b);}else{if(_0x2a6985[0x0]['language']==_0x16fa55(0xd7))var _0x4bbe7b=users[_0x16fa55(0xd7)];else{if(_0x2a6985[0x0][_0x16fa55(0xaf)]==_0x16fa55(0xd8))var _0x4bbe7b=users[_0x16fa55(0xd8)];else{if(_0x2a6985[0x0][_0x16fa55(0xaf)]=='Spanish')var _0x4bbe7b=users[_0x16fa55(0xaa)];else{if(_0x2a6985[0x0][_0x16fa55(0xaf)]==_0x16fa55(0xbd))var _0x4bbe7b=users['French'];else{if(_0x2a6985[0x0]['language']=='Portuguese\x20(BR)')var _0x4bbe7b=users['Portuguese'];else{if(_0x2a6985[0x0][_0x16fa55(0xaf)]==_0x16fa55(0xe6))var _0x4bbe7b=users[_0x16fa55(0xe6)];else{if(_0x2a6985[0x0]['language']==_0x16fa55(0xcc))var _0x4bbe7b=users[_0x16fa55(0xdb)];}}}}}}}_0x46554b['render'](_0x16fa55(0x85),{'success':_0x5ad3c8[_0x16fa55(0xb4)](_0x16fa55(0xb0)),'errors':_0x5ad3c8[_0x16fa55(0xb4)](_0x16fa55(0xa0)),'role':_0x1ce90b,'profile':_0x59e0f0,'master_shop':_0x2a6985,'payment':_0xf2062,'payable':_0x2cf1ba,'receivable':_0x2dbaac,'language':_0x4bbe7b});}catch(_0x598108){console[_0x16fa55(0xe0)](_0x598108);}}),router['get'](a0_0x2e8364(0xdf),auth,async(_0x2f8765,_0x397603)=>{const _0x23721f=a0_0x2e8364;try{const _0x45efa4=new excelJS[(_0x23721f(0xbf))](),_0x4d8952=_0x45efa4['addWorksheet'](_0x23721f(0xbc));return _0x4d8952[_0x23721f(0xa2)]=[{'header':'Name','key':_0x23721f(0xb3),'width':0xa},{'header':_0x23721f(0xd0),'key':_0x23721f(0x88),'width':0xa},{'header':_0x23721f(0xab),'key':'SalesmanName','width':0xa},{'header':_0x23721f(0xdd),'key':_0x23721f(0xb9),'width':0xa},{'header':_0x23721f(0xa7),'key':_0x23721f(0x92),'width':0xa},{'header':'address','key':_0x23721f(0xd1),'width':0xa}],_0x397603['setHeader']('Content-Type','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x397603[_0x23721f(0x8a)](_0x23721f(0xe3),'attachment;\x20filename=supplier_Migration_File.xlsx'),_0x45efa4['xlsx'][_0x23721f(0xe2)](_0x397603)[_0x23721f(0xad)](()=>{_0x397603['status'](0xc8);});}catch(_0x4a3f4d){_0x397603[_0x23721f(0x87)](0x190)[_0x23721f(0xd3)]({'errors':_0x4a3f4d['message']});}});function a0_0x3d51(){const _0x45ba45=['save','../middleware/auth','$amount','payable','name','utils','xlsx','public/Migration','contactperson','readFile','get','errors','30588IDzbaJ','columns','801ORCuAY','diskStorage','128276UgNioE','39IIWjPk','Company_Name','public/Migration/','suppliers','Spanish','Email','475935vAXiEf','then','body','language','success','Purchase','redirect','PBrands','flash','\x20Failed','purchase','purchase_return','findById','address','/view/payment/:id','supplier','Customers','French','find','Workbook','1kLIFIo','error','3211116DyRHRw','express','supplier\x20data\x20add\x20successfully','amount','json','6487RIuiRv','originalname','/supplier/view','payable_sum','master','Arabic\x20(ae)','exports','22uuIfyK','Router','Supplier_Code','email','English','send','doc','aggregate','$reason','Hindi','German','s_payments','300858GNhmBT','Arabic','user','Mobile_number','Purchase\x20Return','/products_export_migrate_file','log','45432aTyGqW','write','Content-Disposition','suppliers_docs','map','Chinese','file','supplier_payment','filename','status','PUnits','77qgRolT','setHeader','English\x20(US)','/view/:id','3170030qwTAMF','Name','findOne','supplier.js\x20payment_data','params','mobile','exceljs','Portuguese\x20(BR)'];a0_0x3d51=function(){return _0x45ba45;};return a0_0x3d51();}const storage1=multer[a0_0x2e8364(0xa4)]({'destination':(_0x17710a,_0x3ac32a,_0x194fc2)=>{const _0x57ecad=a0_0x2e8364;_0x194fc2(null,_0x57ecad(0x9c));},'filename':(_0x74340c,_0xf9146c,_0x3a1f8a)=>{const _0x70d086=a0_0x2e8364;_0x3a1f8a(null,Date['now']()+_0xf9146c[_0x70d086(0xc8)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x5662(_0x2dea3d,_0x27dc2a){const _0x3d517a=a0_0x3d51();return a0_0x5662=function(_0x566202,_0x34c2af){_0x566202=_0x566202-0x84;let _0x34a40c=_0x3d517a[_0x566202];return _0x34a40c;},a0_0x5662(_0x2dea3d,_0x27dc2a);}router['post']('/supplier_import_migrate_file',auth,uploadMigrate['single']('supplier_product_file'),async(_0x31c19c,_0x59f01e)=>{const _0x1b40dc=a0_0x2e8364,_0x4bfdd1=_0x31c19c[_0x1b40dc(0x84)][_0x1b40dc(0x86)],_0x47c94f=await xlsx[_0x1b40dc(0x9e)](_0x1b40dc(0xa8)+_0x4bfdd1);let _0x4c9cf5=_0x47c94f['SheetNames'],_0x2c2dbd=xlsx[_0x1b40dc(0x9a)]['sheet_to_json'](_0x47c94f['Sheets'][_0x4c9cf5[0x0]]);for(const _0x70e6d3 of _0x2c2dbd){const _0x52e856=_0x70e6d3[_0x1b40dc(0x8e)],_0x412a71=_0x70e6d3[_0x1b40dc(0xd0)],_0x5adb5e=_0x70e6d3[_0x1b40dc(0xb9)],_0x33e394=_0x70e6d3[_0x1b40dc(0xdd)],_0x48fdf0=_0x70e6d3['Email'],_0x34861f=_0x70e6d3['Company_Name'];try{let _0x56fb4e=await suppliers[_0x1b40dc(0x8f)]({'name':_0x52e856});if(!_0x56fb4e){const _0x1e6153=new suppliers({'name':_0x52e856,'suppliers_code':_0x412a71,'address':_0x5adb5e,'mobile':_0x33e394,'email':_0x48fdf0,'company':_0x34861f});_0x56fb4e=await _0x1e6153['save'](),_0x31c19c[_0x1b40dc(0xb4)](_0x1b40dc(0xb0),_0x52e856+'\x20added\x20successfully');}else _0x31c19c[_0x1b40dc(0xb4)](_0x1b40dc(0xc1),_0x52e856+_0x1b40dc(0xb5));}catch(_0x3123c4){_0x59f01e[_0x1b40dc(0x87)](0x1f4)[_0x1b40dc(0xc6)]({'proderror':_0x3123c4['message'],'aproduct':ProductName});}}_0x59f01e[_0x1b40dc(0xb2)](_0x1b40dc(0xc9));}),module[a0_0x2e8364(0xcd)]=router;