const a0_0x341225=a0_0x234e;(function(_0x2f5e34,_0x12e06d){const _0x574e90=a0_0x234e,_0x391c23=_0x2f5e34();while(!![]){try{const _0xb62329=-parseInt(_0x574e90(0x142))/0x1+-parseInt(_0x574e90(0x17e))/0x2*(-parseInt(_0x574e90(0x14d))/0x3)+parseInt(_0x574e90(0x197))/0x4+parseInt(_0x574e90(0x14b))/0x5+parseInt(_0x574e90(0x134))/0x6*(parseInt(_0x574e90(0x181))/0x7)+-parseInt(_0x574e90(0x161))/0x8*(-parseInt(_0x574e90(0x168))/0x9)+parseInt(_0x574e90(0x166))/0xa*(-parseInt(_0x574e90(0x17c))/0xb);if(_0xb62329===_0x12e06d)break;else _0x391c23['push'](_0x391c23['shift']());}catch(_0x1bf20b){_0x391c23['push'](_0x391c23['shift']());}}}(a0_0x420e,0x5429c));function a0_0x234e(_0xc1d3fe,_0x4d2a21){const _0x420ee8=a0_0x420e();return a0_0x234e=function(_0x234eb6,_0x3f775f){_0x234eb6=_0x234eb6-0x134;let _0x3b61ba=_0x420ee8[_0x234eb6];return _0x3b61ba;},a0_0x234e(_0xc1d3fe,_0x4d2a21);}function a0_0x420e(){const _0x1dcbc1=['log','12249ToNpFk','English\x20(US)','$amount','../models/all_models','customer\x20add\x20successfully','SalesmanCode','columns','payable','/view/payment/:id','PBrands','amount','name','forEach','Hindi','errors','../middleware/auth','Content-Type','Customers','save','then','1342qnFFhS','map','4022WUvKgq','/view/:id','single','7UUurAD','exceljs','reason','/products_export_migrate_file','payable_sum','master','email','findById','public/Migration/','Arabic\x20(ae)','mobile','file','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','customer_data','aggregate','/customer_import_migrate_file','filename','SheetNames','receivable_sum','Portuguese\x20(BR)','Arabic','c_payments','1441952ryZwwB','Chinese','element','SalesmanName','\x20Failed','$reason','French','1804806DdXBVV','receivable','error','utils','user','sale_return','readFile','/view','find','/customer/view','language','customer_docs','success','customer_payment','251980YREWgn','post','flash','get','Content-Disposition','Spanish','params','English','sheet_to_json','124070BJIcBc','PName','24BZEOTB','Sale','PUnits','Workbook','addWorksheet','message','customer_product_fule','multer','Name','setHeader','address','redirect','contactperson','diskStorage','customer\x20update\x20successfully','payment_data','Sheets','originalname','German','status','792xjXFlX','data','findOne','Portuguese','write','19690yTkqwd'];a0_0x420e=function(){return _0x1dcbc1;};return a0_0x420e();}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x341225(0x16b)),auth=require(a0_0x341225(0x177)),users=require('../public/language/languages.json'),excelJS=require(a0_0x341225(0x182)),xlsx=require('xlsx'),multer=require(a0_0x341225(0x154));router[a0_0x341225(0x145)]('/view',auth,async(_0xd4b799,_0x34ca48)=>{const _0x2a2230=a0_0x341225;try{const {username:_0x57252a,email:_0x51af0c,role:_0x255542}=_0xd4b799['user'],_0xc1c278=_0xd4b799[_0x2a2230(0x138)],_0x9ea4a7=await profile[_0x2a2230(0x163)]({'email':_0xc1c278['email']}),_0x2b1f97=await master_shop[_0x2a2230(0x13c)]();console[_0x2a2230(0x167)](_0x2a2230(0x186),_0x2b1f97);const _0x5a936d=await customer['find'](),_0x520017=await customer[_0x2a2230(0x18f)]([{'$lookup':{'from':_0x2a2230(0x196),'localField':_0x2a2230(0x173),'foreignField':'customer','as':'customer_docs'}}]);console[_0x2a2230(0x167)](_0x520017);const _0x339563=_0x520017[_0x2a2230(0x17d)](_0x15013d=>{const _0x20c8c3=_0x2a2230;console[_0x20c8c3(0x167)](_0x20c8c3(0x162),_0x15013d);var _0x3a2a6d=0x0,_0x41fc2d=0x0;return _0x15013d[_0x20c8c3(0x13f)][_0x20c8c3(0x174)](_0x46a98d=>{const _0x452251=_0x20c8c3;console[_0x452251(0x167)](_0x452251(0x199),_0x46a98d),_0x46a98d[_0x452251(0x183)]==_0x452251(0x14e)?_0x3a2a6d+=_0x46a98d[_0x452251(0x172)]:_0x41fc2d+=_0x46a98d['amount'];}),_0x15013d['sale']=parseFloat(_0x3a2a6d)+0x0,_0x15013d[_0x20c8c3(0x139)]=parseFloat(_0x41fc2d)+0x0,_0x15013d;});console[_0x2a2230(0x167)](_0x2a2230(0x15c),_0x339563);if(_0x2b1f97[0x0]['language']==_0x2a2230(0x169)){var _0x38c048=users[_0x2a2230(0x149)];console[_0x2a2230(0x167)](_0x38c048);}else{if(_0x2b1f97[0x0]['language']==_0x2a2230(0x175))var _0x38c048=users[_0x2a2230(0x175)];else{if(_0x2b1f97[0x0][_0x2a2230(0x13e)]==_0x2a2230(0x15f))var _0x38c048=users[_0x2a2230(0x15f)];else{if(_0x2b1f97[0x0]['language']==_0x2a2230(0x147))var _0x38c048=users[_0x2a2230(0x147)];else{if(_0x2b1f97[0x0][_0x2a2230(0x13e)]==_0x2a2230(0x19d))var _0x38c048=users['French'];else{if(_0x2b1f97[0x0][_0x2a2230(0x13e)]==_0x2a2230(0x194))var _0x38c048=users[_0x2a2230(0x164)];else{if(_0x2b1f97[0x0][_0x2a2230(0x13e)]==_0x2a2230(0x198))var _0x38c048=users[_0x2a2230(0x198)];else{if(_0x2b1f97[0x0][_0x2a2230(0x13e)]==_0x2a2230(0x18a))var _0x38c048=users[_0x2a2230(0x195)];}}}}}}}_0x34ca48['render']('customer',{'success':_0xd4b799[_0x2a2230(0x144)](_0x2a2230(0x140)),'errors':_0xd4b799[_0x2a2230(0x144)](_0x2a2230(0x176)),'user':_0x5a936d,'role':_0xc1c278,'profile':_0x9ea4a7,'payment':_0x339563,'master_shop':_0x2b1f97,'language':_0x38c048});}catch(_0xe20614){console[_0x2a2230(0x167)](_0xe20614);}}),router['post'](a0_0x341225(0x13b),auth,async(_0x3d112e,_0x3fdff3)=>{const _0x57a5ce=a0_0x341225;try{const {name:_0x53a5c8,address:_0x2ff382,mobile:_0x306505,email:_0x5d34ba,receivable:_0x56a152,payable:_0x39ed3f,contactperson:_0x299c46,landline:_0x108a93}=_0x3d112e['body'],_0x501fb5=new customer({'name':_0x53a5c8,'address':_0x2ff382,'mobile':_0x306505,'email':_0x5d34ba,'receivable':_0x56a152,'payable':_0x39ed3f,'contactperson':_0x299c46,'landline':_0x108a93}),_0x1078a4=await _0x501fb5[_0x57a5ce(0x17a)]();_0x3d112e[_0x57a5ce(0x144)](_0x57a5ce(0x140),_0x57a5ce(0x16c)),_0x3fdff3[_0x57a5ce(0x158)](_0x57a5ce(0x13d));}catch(_0x37c237){console[_0x57a5ce(0x167)](_0x37c237);}}),router[a0_0x341225(0x145)]('/view/:id',auth,async(_0x31cfb1,_0x436a27)=>{const _0x40cc97=a0_0x341225;try{const {username:_0x500aed,email:_0x34adfd,role:_0xb376a4}=_0x31cfb1[_0x40cc97(0x138)],_0x3ec8b3=_0x31cfb1['user'],_0x23606c=await profile['findOne']({'email':_0x3ec8b3['email']}),_0x18774a=await master_shop[_0x40cc97(0x13c)]();console['log'](_0x40cc97(0x186),_0x18774a);const _0xf870c1=_0x31cfb1['params']['id'],_0x468d30=await customer[_0x40cc97(0x188)](_0xf870c1);if(_0x18774a[0x0][_0x40cc97(0x13e)]==_0x40cc97(0x169)){var _0x405f15=users['English'];console[_0x40cc97(0x167)](_0x405f15);}else{if(_0x18774a[0x0][_0x40cc97(0x13e)]==_0x40cc97(0x175))var _0x405f15=users[_0x40cc97(0x175)];else{if(_0x18774a[0x0][_0x40cc97(0x13e)]==_0x40cc97(0x15f))var _0x405f15=users['German'];else{if(_0x18774a[0x0][_0x40cc97(0x13e)]=='Spanish')var _0x405f15=users[_0x40cc97(0x147)];else{if(_0x18774a[0x0][_0x40cc97(0x13e)]=='French')var _0x405f15=users['French'];else{if(_0x18774a[0x0][_0x40cc97(0x13e)]==_0x40cc97(0x194))var _0x405f15=users[_0x40cc97(0x164)];else{if(_0x18774a[0x0][_0x40cc97(0x13e)]==_0x40cc97(0x198))var _0x405f15=users[_0x40cc97(0x198)];else{if(_0x18774a[0x0][_0x40cc97(0x13e)]=='Arabic\x20(ae)')var _0x405f15=users[_0x40cc97(0x195)];}}}}}}}_0x436a27['render']('customer',{'success':_0x31cfb1[_0x40cc97(0x144)]('success'),'errors':_0x31cfb1[_0x40cc97(0x144)](_0x40cc97(0x176)),'role':_0x3ec8b3,'profile':_0x23606c,'user':_0x468d30,'master_shop':_0x18774a,'language':_0x405f15});}catch(_0x17354e){console['log'](_0x17354e);}}),router['post'](a0_0x341225(0x17f),auth,async(_0x52498c,_0x23dd0e)=>{const _0x4c5ac=a0_0x341225;try{const _0x28df53=_0x52498c['params']['id'],_0x96d680=await customer['findById'](_0x28df53),{name:_0x83c6be,address:_0x255a43,mobile:_0x467d7c,email:_0x5273df,receivable:_0x1ebb7a,payable:_0x9dde8f,contactperson:_0x3cf86a,landline:_0x509b50}=_0x52498c['body'];_0x96d680['name']=_0x83c6be,_0x96d680[_0x4c5ac(0x157)]=_0x255a43,_0x96d680[_0x4c5ac(0x18b)]=_0x467d7c,_0x96d680[_0x4c5ac(0x187)]=_0x5273df,_0x96d680[_0x4c5ac(0x135)]=_0x1ebb7a,_0x96d680[_0x4c5ac(0x16f)]=_0x9dde8f,_0x96d680[_0x4c5ac(0x159)]=_0x3cf86a,_0x96d680['landline']=_0x509b50;const _0x289c89=await _0x96d680['save']();_0x52498c[_0x4c5ac(0x144)](_0x4c5ac(0x140),_0x4c5ac(0x15b)),_0x23dd0e['redirect']('/customer/view');}catch(_0x996035){console[_0x4c5ac(0x167)](_0x996035);}}),router[a0_0x341225(0x145)](a0_0x341225(0x170),auth,async(_0x308fe0,_0x45b994)=>{const _0x1d5626=a0_0x341225;try{const {username:_0x41e2bf,email:_0x17c652,role:_0x32bb15}=_0x308fe0[_0x1d5626(0x138)],_0x42e6a9=_0x308fe0['user'],_0x3d217b=await profile[_0x1d5626(0x163)]({'email':_0x42e6a9[_0x1d5626(0x187)]}),_0x284694=await master_shop[_0x1d5626(0x13c)]();console['log'](_0x1d5626(0x186),_0x284694),console[_0x1d5626(0x167)](_0x308fe0['params']['id']);const _0x13abef=await customer[_0x1d5626(0x163)]({'_id':_0x308fe0[_0x1d5626(0x148)]['id']});console[_0x1d5626(0x167)](_0x1d5626(0x18e),_0x13abef);const _0x39049b=await c_payment_data[_0x1d5626(0x13c)]({'customer':_0x13abef[_0x1d5626(0x173)]});console[_0x1d5626(0x167)](_0x39049b);const _0x319936=await c_payment_data[_0x1d5626(0x18f)]([{'$match':{'customer':_0x13abef[_0x1d5626(0x173)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x1d5626(0x16a)}}}]);console[_0x1d5626(0x167)](_0x1d5626(0x185),_0x319936);const _0x3307d2=await c_payment_data[_0x1d5626(0x18f)]([{'$match':{'customer':_0x13abef[_0x1d5626(0x173)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x1d5626(0x19c),'sum':{'$sum':_0x1d5626(0x16a)}}}]);console[_0x1d5626(0x167)](_0x1d5626(0x193),_0x3307d2);if(_0x284694[0x0][_0x1d5626(0x13e)]==_0x1d5626(0x169)){var _0x4231ee=users[_0x1d5626(0x149)];console['log'](_0x4231ee);}else{if(_0x284694[0x0][_0x1d5626(0x13e)]==_0x1d5626(0x175))var _0x4231ee=users[_0x1d5626(0x175)];else{if(_0x284694[0x0][_0x1d5626(0x13e)]=='German')var _0x4231ee=users[_0x1d5626(0x15f)];else{if(_0x284694[0x0][_0x1d5626(0x13e)]==_0x1d5626(0x147))var _0x4231ee=users['Spanish'];else{if(_0x284694[0x0][_0x1d5626(0x13e)]==_0x1d5626(0x19d))var _0x4231ee=users['French'];else{if(_0x284694[0x0]['language']==_0x1d5626(0x194))var _0x4231ee=users[_0x1d5626(0x164)];else{if(_0x284694[0x0]['language']==_0x1d5626(0x198))var _0x4231ee=users[_0x1d5626(0x198)];else{if(_0x284694[0x0][_0x1d5626(0x13e)]=='Arabic\x20(ae)')var _0x4231ee=users['Arabic'];}}}}}}}_0x45b994['render'](_0x1d5626(0x141),{'success':_0x308fe0[_0x1d5626(0x144)](_0x1d5626(0x140)),'errors':_0x308fe0[_0x1d5626(0x144)]('errors'),'role':_0x42e6a9,'profile':_0x3d217b,'payment':_0x39049b,'payable':_0x319936,'receivable':_0x3307d2,'master_shop':_0x284694,'language':_0x4231ee});}catch(_0x5aeeb8){console[_0x1d5626(0x167)](_0x5aeeb8);}}),router['get'](a0_0x341225(0x184),auth,async(_0x401458,_0x29a8e6)=>{const _0x560c34=a0_0x341225;try{const _0xae9cf1=new excelJS[(_0x560c34(0x150))](),_0x2772bc=_0xae9cf1[_0x560c34(0x151)](_0x560c34(0x179));return _0x2772bc[_0x560c34(0x16e)]=[{'header':'ID','key':_0x560c34(0x14c),'width':0xa},{'header':_0x560c34(0x155),'key':_0x560c34(0x171),'width':0xa},{'header':_0x560c34(0x16d),'key':_0x560c34(0x14f),'width':0xa},{'header':_0x560c34(0x19a),'key':_0x560c34(0x19a),'width':0xa},{'header':'address','key':'address','width':0xa},{'header':_0x560c34(0x18b),'key':_0x560c34(0x18b),'width':0xa},{'header':'email','key':_0x560c34(0x187),'width':0xa}],_0x29a8e6[_0x560c34(0x156)](_0x560c34(0x178),_0x560c34(0x18d)),_0x29a8e6[_0x560c34(0x156)](_0x560c34(0x146),'attachment;\x20filename=customer_Migration_File.xlsx'),_0xae9cf1['xlsx'][_0x560c34(0x165)](_0x29a8e6)[_0x560c34(0x17b)](()=>{const _0x78e1f6=_0x560c34;_0x29a8e6[_0x78e1f6(0x160)](0xc8);});}catch(_0x3617fb){_0x29a8e6['status'](0x190)['send']({'errors':_0x3617fb[_0x560c34(0x152)]});}});const storage1=multer[a0_0x341225(0x15a)]({'destination':(_0x19a319,_0x4d435e,_0xeca530)=>{_0xeca530(null,'public/Migration');},'filename':(_0x3cd0ab,_0x217e64,_0x347b74)=>{const _0x516a99=a0_0x341225;_0x347b74(null,Date['now']()+_0x217e64[_0x516a99(0x15e)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x341225(0x143)](a0_0x341225(0x190),auth,uploadMigrate[a0_0x341225(0x180)](a0_0x341225(0x153)),async(_0x3f3a36,_0x206982)=>{const _0x3e06d4=a0_0x341225,_0x119e3f=_0x3f3a36[_0x3e06d4(0x18c)][_0x3e06d4(0x191)],_0x3d0e19=await xlsx[_0x3e06d4(0x13a)](_0x3e06d4(0x189)+_0x119e3f);let _0x1d13f8=_0x3d0e19[_0x3e06d4(0x192)],_0x343394=xlsx[_0x3e06d4(0x137)][_0x3e06d4(0x14a)](_0x3d0e19[_0x3e06d4(0x15d)][_0x1d13f8[0x0]]);for(const _0x2d5602 of _0x343394){const _0x229d3a=_0x2d5602['ID'],_0x30ff56=_0x2d5602[_0x3e06d4(0x155)],_0x370e89=_0x2d5602[_0x3e06d4(0x16d)],_0xfd6899=_0x2d5602[_0x3e06d4(0x19a)],_0x27b3b4=_0x2d5602[_0x3e06d4(0x157)],_0x39acf9=_0x2d5602[_0x3e06d4(0x18b)],_0x539c95=_0x2d5602[_0x3e06d4(0x187)];try{let _0x347db2=await customer[_0x3e06d4(0x163)]({'name':_0x30ff56});if(!_0x347db2){const _0x4318bd=new customer({'name':_0x30ff56,'ID':_0x229d3a,'SalesmanCode':_0x370e89,'SalesmanName':_0xfd6899,'address':_0x27b3b4,'mobile':_0x39acf9,'email':_0x539c95});_0x347db2=await _0x4318bd['save'](),_0x3f3a36['flash']('success',_0x30ff56+'\x20added\x20successfully');}else _0x3f3a36[_0x3e06d4(0x144)](_0x3e06d4(0x136),_0x30ff56+_0x3e06d4(0x19b));}catch(_0x56c856){_0x206982[_0x3e06d4(0x160)](0x1f4)['json']({'proderror':_0x56c856[_0x3e06d4(0x152)],'aproduct':ProductName});}}_0x206982['redirect']('/customer/view');}),module['exports']=router;