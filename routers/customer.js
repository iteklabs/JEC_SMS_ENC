const a0_0x3f65c8=a0_0x1153;(function(_0x3030ef,_0x55706f){const _0x350bed=a0_0x1153,_0x5d1adf=_0x3030ef();while(!![]){try{const _0x4ca2a8=parseInt(_0x350bed(0x1c2))/0x1+parseInt(_0x350bed(0x18b))/0x2*(-parseInt(_0x350bed(0x1ad))/0x3)+-parseInt(_0x350bed(0x1bb))/0x4*(-parseInt(_0x350bed(0x1d2))/0x5)+-parseInt(_0x350bed(0x1a1))/0x6+parseInt(_0x350bed(0x1a5))/0x7+parseInt(_0x350bed(0x180))/0x8+-parseInt(_0x350bed(0x19a))/0x9;if(_0x4ca2a8===_0x55706f)break;else _0x5d1adf['push'](_0x5d1adf['shift']());}catch(_0x25aa6e){_0x5d1adf['push'](_0x5d1adf['shift']());}}}(a0_0xbe84,0x9bdbd));function a0_0xbe84(){const _0x2880f2=['name','findOne','address','/view/:id','receivable','reason','diskStorage','customer_payment','master','send','\x20Failed','sale','xlsx','55316RWOjjm','render','French','$reason','Portuguese\x20(BR)','columns','save','647004vCYPVX','Arabic','user','redirect','German','mobile','/customer/view','filename','utils','then','Sale','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','post','customer\x20add\x20successfully','map','../middleware/auth','445iOenbb','email','exceljs','public/Migration','Name','PBrands','customer','../public/language/languages.json','setHeader','$amount','exports','errors','flash','log','English\x20(US)','params','8319760Trcmym','addWorksheet','Sale\x20Return','now','findById','c_payments','/view','receivable_sum','English','amount','Spanish','6IsiTLi','/products_export_migrate_file','../models/all_models','get','sheet_to_json','data','readFile','Content-Type','landline','express','Chinese','SalesmanName','SheetNames','message','contactperson','28624896cqSNIp','customer_data','status','Portuguese','find','language','error','1036440wywumh','Arabic\x20(ae)','\x20added\x20successfully','Customers','7548961GViTiK','SalesmanCode','aggregate','payment_data','customer_docs','Hindi','Content-Disposition','success','4497yiYSYI'];a0_0xbe84=function(){return _0x2880f2;};return a0_0xbe84();}const express=require(a0_0x3f65c8(0x194)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x3f65c8(0x18d)),auth=require(a0_0x3f65c8(0x1d1)),users=require(a0_0x3f65c8(0x177)),excelJS=require(a0_0x3f65c8(0x1d4)),xlsx=require(a0_0x3f65c8(0x1ba)),multer=require('multer');router[a0_0x3f65c8(0x18e)](a0_0x3f65c8(0x186),auth,async(_0x2aee0f,_0x4bc8aa)=>{const _0x9eaedf=a0_0x3f65c8;try{const {username:_0x5cbc54,email:_0x485723,role:_0x350602}=_0x2aee0f[_0x9eaedf(0x1c4)],_0x25b51c=_0x2aee0f['user'],_0x485fc5=await profile[_0x9eaedf(0x1af)]({'email':_0x25b51c[_0x9eaedf(0x1d3)]}),_0x42f1bd=await master_shop['find']();console[_0x9eaedf(0x17d)](_0x9eaedf(0x1b6),_0x42f1bd);const _0x29d0fc=await customer[_0x9eaedf(0x19e)](),_0x2806dc=await customer[_0x9eaedf(0x1a7)]([{'$lookup':{'from':_0x9eaedf(0x185),'localField':'name','foreignField':_0x9eaedf(0x1d8),'as':_0x9eaedf(0x1a9)}}]);console[_0x9eaedf(0x17d)](_0x2806dc);const _0x34059b=_0x2806dc[_0x9eaedf(0x1d0)](_0x203ae7=>{const _0x2a761d=_0x9eaedf;console['log'](_0x2a761d(0x190),_0x203ae7);var _0x5c73cb=0x0,_0x5d3ef0=0x0;return _0x203ae7[_0x2a761d(0x1a9)]['forEach'](_0x3d6dcc=>{const _0x57402e=_0x2a761d;console['log']('element',_0x3d6dcc),_0x3d6dcc[_0x57402e(0x1b3)]==_0x57402e(0x1cc)?_0x5c73cb+=_0x3d6dcc[_0x57402e(0x189)]:_0x5d3ef0+=_0x3d6dcc[_0x57402e(0x189)];}),_0x203ae7[_0x2a761d(0x1b9)]=parseFloat(_0x5c73cb)+0x0,_0x203ae7['sale_return']=parseFloat(_0x5d3ef0)+0x0,_0x203ae7;});console[_0x9eaedf(0x17d)](_0x9eaedf(0x1a8),_0x34059b);if(_0x42f1bd[0x0][_0x9eaedf(0x19f)]=='English\x20(US)'){var _0x2bf9c3=users[_0x9eaedf(0x188)];console[_0x9eaedf(0x17d)](_0x2bf9c3);}else{if(_0x42f1bd[0x0]['language']==_0x9eaedf(0x1aa))var _0x2bf9c3=users[_0x9eaedf(0x1aa)];else{if(_0x42f1bd[0x0][_0x9eaedf(0x19f)]==_0x9eaedf(0x1c6))var _0x2bf9c3=users[_0x9eaedf(0x1c6)];else{if(_0x42f1bd[0x0]['language']=='Spanish')var _0x2bf9c3=users[_0x9eaedf(0x18a)];else{if(_0x42f1bd[0x0]['language']==_0x9eaedf(0x1bd))var _0x2bf9c3=users[_0x9eaedf(0x1bd)];else{if(_0x42f1bd[0x0][_0x9eaedf(0x19f)]==_0x9eaedf(0x1bf))var _0x2bf9c3=users[_0x9eaedf(0x19d)];else{if(_0x42f1bd[0x0][_0x9eaedf(0x19f)]==_0x9eaedf(0x195))var _0x2bf9c3=users[_0x9eaedf(0x195)];else{if(_0x42f1bd[0x0]['language']==_0x9eaedf(0x1a2))var _0x2bf9c3=users[_0x9eaedf(0x1c3)];}}}}}}}_0x4bc8aa[_0x9eaedf(0x1bc)](_0x9eaedf(0x1d8),{'success':_0x2aee0f[_0x9eaedf(0x17c)]('success'),'errors':_0x2aee0f['flash'](_0x9eaedf(0x17b)),'user':_0x29d0fc,'role':_0x25b51c,'profile':_0x485fc5,'payment':_0x34059b,'master_shop':_0x42f1bd,'language':_0x2bf9c3});}catch(_0x3b29c0){console['log'](_0x3b29c0);}}),router[a0_0x3f65c8(0x1ce)](a0_0x3f65c8(0x186),auth,async(_0x1830bd,_0x4bfae2)=>{const _0x28a9d8=a0_0x3f65c8;try{const {name:_0x4b4670,address:_0xd09657,mobile:_0x2af2f0,email:_0x364eda,receivable:_0x49d9a1,payable:_0x481924,contactperson:_0x45c123,landline:_0x9d624f}=_0x1830bd['body'],_0x43ae7b=new customer({'name':_0x4b4670,'address':_0xd09657,'mobile':_0x2af2f0,'email':_0x364eda,'receivable':_0x49d9a1,'payable':_0x481924,'contactperson':_0x45c123,'landline':_0x9d624f}),_0x322ba8=await _0x43ae7b[_0x28a9d8(0x1c1)]();_0x1830bd[_0x28a9d8(0x17c)](_0x28a9d8(0x1ac),_0x28a9d8(0x1cf)),_0x4bfae2[_0x28a9d8(0x1c5)](_0x28a9d8(0x1c8));}catch(_0x1c0cd9){console['log'](_0x1c0cd9);}}),router[a0_0x3f65c8(0x18e)](a0_0x3f65c8(0x1b1),auth,async(_0x3fc2dd,_0x3c3d75)=>{const _0x1e08ac=a0_0x3f65c8;try{const {username:_0x5e9d4e,email:_0x155126,role:_0x47f9f7}=_0x3fc2dd['user'],_0x262194=_0x3fc2dd[_0x1e08ac(0x1c4)],_0x5f3d93=await profile['findOne']({'email':_0x262194['email']}),_0x41d8e5=await master_shop[_0x1e08ac(0x19e)]();console['log'](_0x1e08ac(0x1b6),_0x41d8e5);const _0x3f7468=_0x3fc2dd[_0x1e08ac(0x17f)]['id'],_0x1ef5de=await customer[_0x1e08ac(0x184)](_0x3f7468);if(_0x41d8e5[0x0][_0x1e08ac(0x19f)]==_0x1e08ac(0x17e)){var _0x2270b5=users[_0x1e08ac(0x188)];console[_0x1e08ac(0x17d)](_0x2270b5);}else{if(_0x41d8e5[0x0][_0x1e08ac(0x19f)]==_0x1e08ac(0x1aa))var _0x2270b5=users[_0x1e08ac(0x1aa)];else{if(_0x41d8e5[0x0][_0x1e08ac(0x19f)]==_0x1e08ac(0x1c6))var _0x2270b5=users[_0x1e08ac(0x1c6)];else{if(_0x41d8e5[0x0][_0x1e08ac(0x19f)]==_0x1e08ac(0x18a))var _0x2270b5=users[_0x1e08ac(0x18a)];else{if(_0x41d8e5[0x0]['language']==_0x1e08ac(0x1bd))var _0x2270b5=users['French'];else{if(_0x41d8e5[0x0]['language']==_0x1e08ac(0x1bf))var _0x2270b5=users['Portuguese'];else{if(_0x41d8e5[0x0][_0x1e08ac(0x19f)]==_0x1e08ac(0x195))var _0x2270b5=users[_0x1e08ac(0x195)];else{if(_0x41d8e5[0x0]['language']==_0x1e08ac(0x1a2))var _0x2270b5=users[_0x1e08ac(0x1c3)];}}}}}}}_0x3c3d75[_0x1e08ac(0x1bc)]('customer',{'success':_0x3fc2dd[_0x1e08ac(0x17c)](_0x1e08ac(0x1ac)),'errors':_0x3fc2dd['flash'](_0x1e08ac(0x17b)),'role':_0x262194,'profile':_0x5f3d93,'user':_0x1ef5de,'master_shop':_0x41d8e5,'language':_0x2270b5});}catch(_0x2fea6c){console[_0x1e08ac(0x17d)](_0x2fea6c);}}),router[a0_0x3f65c8(0x1ce)](a0_0x3f65c8(0x1b1),auth,async(_0x39c33e,_0x352679)=>{const _0x237c7f=a0_0x3f65c8;try{const _0x350e98=_0x39c33e[_0x237c7f(0x17f)]['id'],_0x307f5b=await customer[_0x237c7f(0x184)](_0x350e98),{name:_0x1a6c02,address:_0x4c2785,mobile:_0x5564a7,email:_0xabdaad,receivable:_0xa313d5,payable:_0x5bbd4c,contactperson:_0xc101fe,landline:_0x597857}=_0x39c33e['body'];_0x307f5b['name']=_0x1a6c02,_0x307f5b[_0x237c7f(0x1b0)]=_0x4c2785,_0x307f5b[_0x237c7f(0x1c7)]=_0x5564a7,_0x307f5b[_0x237c7f(0x1d3)]=_0xabdaad,_0x307f5b[_0x237c7f(0x1b2)]=_0xa313d5,_0x307f5b['payable']=_0x5bbd4c,_0x307f5b[_0x237c7f(0x199)]=_0xc101fe,_0x307f5b[_0x237c7f(0x193)]=_0x597857;const _0x233861=await _0x307f5b[_0x237c7f(0x1c1)]();_0x39c33e[_0x237c7f(0x17c)]('success','customer\x20update\x20successfully'),_0x352679['redirect'](_0x237c7f(0x1c8));}catch(_0x1dfb8f){console['log'](_0x1dfb8f);}}),router[a0_0x3f65c8(0x18e)]('/view/payment/:id',auth,async(_0x40f5fb,_0xb54e42)=>{const _0x4ff834=a0_0x3f65c8;try{const {username:_0x5859a9,email:_0x5e444a,role:_0x4b6635}=_0x40f5fb[_0x4ff834(0x1c4)],_0x513bc4=_0x40f5fb['user'],_0x3eb835=await profile['findOne']({'email':_0x513bc4['email']}),_0x29fa12=await master_shop['find']();console[_0x4ff834(0x17d)](_0x4ff834(0x1b6),_0x29fa12),console[_0x4ff834(0x17d)](_0x40f5fb[_0x4ff834(0x17f)]['id']);const _0x3c334a=await customer['findOne']({'_id':_0x40f5fb['params']['id']});console['log'](_0x4ff834(0x19b),_0x3c334a);const _0x5bf631=await c_payment_data['find']({'customer':_0x3c334a[_0x4ff834(0x1ae)]});console[_0x4ff834(0x17d)](_0x5bf631);const _0x451b1c=await c_payment_data[_0x4ff834(0x1a7)]([{'$match':{'customer':_0x3c334a[_0x4ff834(0x1ae)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x4ff834(0x1be),'sum':{'$sum':'$amount'}}}]);console['log']('payable_sum',_0x451b1c);const _0x631d09=await c_payment_data[_0x4ff834(0x1a7)]([{'$match':{'customer':_0x3c334a[_0x4ff834(0x1ae)]}},{'$match':{'reason':_0x4ff834(0x182)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x4ff834(0x179)}}}]);console[_0x4ff834(0x17d)](_0x4ff834(0x187),_0x631d09);if(_0x29fa12[0x0]['language']==_0x4ff834(0x17e)){var _0x4e280c=users['English'];console['log'](_0x4e280c);}else{if(_0x29fa12[0x0][_0x4ff834(0x19f)]==_0x4ff834(0x1aa))var _0x4e280c=users[_0x4ff834(0x1aa)];else{if(_0x29fa12[0x0][_0x4ff834(0x19f)]==_0x4ff834(0x1c6))var _0x4e280c=users[_0x4ff834(0x1c6)];else{if(_0x29fa12[0x0][_0x4ff834(0x19f)]==_0x4ff834(0x18a))var _0x4e280c=users[_0x4ff834(0x18a)];else{if(_0x29fa12[0x0][_0x4ff834(0x19f)]==_0x4ff834(0x1bd))var _0x4e280c=users['French'];else{if(_0x29fa12[0x0]['language']==_0x4ff834(0x1bf))var _0x4e280c=users['Portuguese'];else{if(_0x29fa12[0x0][_0x4ff834(0x19f)]==_0x4ff834(0x195))var _0x4e280c=users['Chinese'];else{if(_0x29fa12[0x0][_0x4ff834(0x19f)]=='Arabic\x20(ae)')var _0x4e280c=users[_0x4ff834(0x1c3)];}}}}}}}_0xb54e42[_0x4ff834(0x1bc)](_0x4ff834(0x1b5),{'success':_0x40f5fb[_0x4ff834(0x17c)](_0x4ff834(0x1ac)),'errors':_0x40f5fb[_0x4ff834(0x17c)](_0x4ff834(0x17b)),'role':_0x513bc4,'profile':_0x3eb835,'payment':_0x5bf631,'payable':_0x451b1c,'receivable':_0x631d09,'master_shop':_0x29fa12,'language':_0x4e280c});}catch(_0x513d80){console[_0x4ff834(0x17d)](_0x513d80);}}),router[a0_0x3f65c8(0x18e)](a0_0x3f65c8(0x18c),auth,async(_0x370534,_0x2ee122)=>{const _0x30a4b8=a0_0x3f65c8;try{const _0x45e28f=new excelJS['Workbook'](),_0x59600c=_0x45e28f[_0x30a4b8(0x181)](_0x30a4b8(0x1a4));return _0x59600c[_0x30a4b8(0x1c0)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x30a4b8(0x1d6),'key':_0x30a4b8(0x1d7),'width':0xa},{'header':_0x30a4b8(0x1a6),'key':'PUnits','width':0xa},{'header':'SalesmanName','key':_0x30a4b8(0x196),'width':0xa},{'header':_0x30a4b8(0x1b0),'key':_0x30a4b8(0x1b0),'width':0xa},{'header':_0x30a4b8(0x1c7),'key':_0x30a4b8(0x1c7),'width':0xa},{'header':_0x30a4b8(0x1d3),'key':_0x30a4b8(0x1d3),'width':0xa}],_0x2ee122[_0x30a4b8(0x178)](_0x30a4b8(0x192),_0x30a4b8(0x1cd)),_0x2ee122[_0x30a4b8(0x178)](_0x30a4b8(0x1ab),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x45e28f['xlsx']['write'](_0x2ee122)[_0x30a4b8(0x1cb)](()=>{_0x2ee122['status'](0xc8);});}catch(_0x246ada){_0x2ee122[_0x30a4b8(0x19c)](0x190)[_0x30a4b8(0x1b7)]({'errors':_0x246ada[_0x30a4b8(0x198)]});}});const storage1=multer[a0_0x3f65c8(0x1b4)]({'destination':(_0x3f482b,_0x4f735d,_0x19267b)=>{const _0x23da62=a0_0x3f65c8;_0x19267b(null,_0x23da62(0x1d5));},'filename':(_0xb3f1da,_0x548311,_0x309be1)=>{const _0x5387ce=a0_0x3f65c8;_0x309be1(null,Date[_0x5387ce(0x183)]()+_0x548311['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0x1153(_0x398581,_0x3f24cb){const _0xbe84c0=a0_0xbe84();return a0_0x1153=function(_0x1153cd,_0xd70373){_0x1153cd=_0x1153cd-0x177;let _0x5c0ee7=_0xbe84c0[_0x1153cd];return _0x5c0ee7;},a0_0x1153(_0x398581,_0x3f24cb);}router[a0_0x3f65c8(0x1ce)]('/customer_import_migrate_file',auth,uploadMigrate['single']('customer_product_fule'),async(_0x560fc5,_0x832ef0)=>{const _0x2d976e=a0_0x3f65c8,_0x46ea50=_0x560fc5['file'][_0x2d976e(0x1c9)],_0x26f67d=await xlsx[_0x2d976e(0x191)]('public/Migration/'+_0x46ea50);let _0x3e7b20=_0x26f67d[_0x2d976e(0x197)],_0x36c5da=xlsx[_0x2d976e(0x1ca)][_0x2d976e(0x18f)](_0x26f67d['Sheets'][_0x3e7b20[0x0]]);for(const _0x2c348f of _0x36c5da){const _0x3dfc49=_0x2c348f['ID'],_0x3f6abd=_0x2c348f[_0x2d976e(0x1d6)],_0x806ca3=_0x2c348f[_0x2d976e(0x1a6)],_0x18f213=_0x2c348f[_0x2d976e(0x196)],_0x556976=_0x2c348f['address'],_0x48bf14=_0x2c348f[_0x2d976e(0x1c7)],_0x46d723=_0x2c348f[_0x2d976e(0x1d3)];try{let _0x226fef=await customer['findOne']({'name':_0x3f6abd});if(!_0x226fef){const _0xdf58fc=new customer({'name':_0x3f6abd,'ID':_0x3dfc49,'SalesmanCode':_0x806ca3,'SalesmanName':_0x18f213,'address':_0x556976,'mobile':_0x48bf14,'email':_0x46d723});_0x226fef=await _0xdf58fc['save'](),_0x560fc5['flash'](_0x2d976e(0x1ac),_0x3f6abd+_0x2d976e(0x1a3));}else _0x560fc5[_0x2d976e(0x17c)](_0x2d976e(0x1a0),_0x3f6abd+_0x2d976e(0x1b8));}catch(_0x164be5){_0x832ef0['status'](0x1f4)['json']({'proderror':_0x164be5[_0x2d976e(0x198)],'aproduct':ProductName});}}_0x832ef0[_0x2d976e(0x1c5)](_0x2d976e(0x1c8));}),module[a0_0x3f65c8(0x17a)]=router;