const a0_0x4664a7=a0_0x19f6;(function(_0x14a175,_0x5833ce){const _0x155062=a0_0x19f6,_0x5e7ced=_0x14a175();while(!![]){try{const _0x16cfee=-parseInt(_0x155062(0x1a6))/0x1+parseInt(_0x155062(0x1a1))/0x2*(-parseInt(_0x155062(0x19b))/0x3)+parseInt(_0x155062(0x1e2))/0x4+-parseInt(_0x155062(0x1c2))/0x5+-parseInt(_0x155062(0x203))/0x6+parseInt(_0x155062(0x1c4))/0x7*(parseInt(_0x155062(0x1a2))/0x8)+-parseInt(_0x155062(0x1f4))/0x9*(-parseInt(_0x155062(0x1ff))/0xa);if(_0x16cfee===_0x5833ce)break;else _0x5e7ced['push'](_0x5e7ced['shift']());}catch(_0x5ad8a0){_0x5e7ced['push'](_0x5e7ced['shift']());}}}(a0_0x1333,0x44183));function a0_0x1333(){const _0x1bc240=['redirect','now','203268KiXVYj','French','columns','success','/products_export_migrate_file','PBrands','sale','address','Name','Customers','amount','../public/language/languages.json','errors','setHeader','German','email','findById','receivable','99zuGlQS','get','attachment;\x20filename=customer_Migration_File.xlsx','Hindi','Arabic','contactperson','message','log','Chinese','single','Spanish','727930FaVIjS','Content-Type','status','error','1283466KrNGHI','customer_data','filename','2397lBOBIl','payment_data','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','/customer/view','customer','$reason','300bjxNSk','1208ucivWJ','mobile','\x20Failed','customer_docs','316122dDzQuv','find','SheetNames','Content-Disposition','params','Router','user','addWorksheet','render','Sale\x20Return','Workbook','name','English','receivable_sum','/customer_import_migrate_file','element','exports','language','originalname','English\x20(US)','Sheets','landline','flash','payable_sum','Sale','public/Migration/','PName','/view/payment/:id','792265LSuPBD','Arabic\x20(ae)','10927HqUSQq','readFile','customer\x20add\x20successfully','sale_return','file','express','c_payments','exceljs','findOne','then','SalesmanCode','$amount','payable','body','SalesmanName','forEach','customer\x20update\x20successfully','xlsx','Portuguese','save','master','../models/all_models','Portuguese\x20(BR)','/view/:id','../middleware/auth','customer_payment','aggregate','post'];a0_0x1333=function(){return _0x1bc240;};return a0_0x1333();}const express=require(a0_0x4664a7(0x1c9)),app=express(),router=express[a0_0x4664a7(0x1ab)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x4664a7(0x1d9)),auth=require(a0_0x4664a7(0x1dc)),users=require(a0_0x4664a7(0x1ed)),excelJS=require(a0_0x4664a7(0x1cb)),xlsx=require(a0_0x4664a7(0x1d5)),multer=require('multer');router[a0_0x4664a7(0x1f5)]('/view',auth,async(_0x5e5484,_0x2a2554)=>{const _0x2b4bdb=a0_0x4664a7;try{const {username:_0x1da26d,email:_0x1eb160,role:_0x3085f3}=_0x5e5484['user'],_0x220184=_0x5e5484[_0x2b4bdb(0x1ac)],_0x40b177=await profile[_0x2b4bdb(0x1cc)]({'email':_0x220184[_0x2b4bdb(0x1f1)]}),_0x110c2e=await master_shop['find']();console['log'](_0x2b4bdb(0x1d8),_0x110c2e);const _0x520d0b=await customer[_0x2b4bdb(0x1a7)](),_0xf18c71=await customer[_0x2b4bdb(0x1de)]([{'$lookup':{'from':_0x2b4bdb(0x1ca),'localField':_0x2b4bdb(0x1b1),'foreignField':'customer','as':_0x2b4bdb(0x1a5)}}]);console[_0x2b4bdb(0x1fb)](_0xf18c71);const _0x96df9c=_0xf18c71['map'](_0x1ee204=>{const _0x269a2d=_0x2b4bdb;console['log']('data',_0x1ee204);var _0x58fb8e=0x0,_0x5b0f5a=0x0;return _0x1ee204[_0x269a2d(0x1a5)][_0x269a2d(0x1d3)](_0x1d605d=>{const _0x4d8e3e=_0x269a2d;console[_0x4d8e3e(0x1fb)](_0x4d8e3e(0x1b5),_0x1d605d),_0x1d605d['reason']=='Sale'?_0x58fb8e+=_0x1d605d[_0x4d8e3e(0x1ec)]:_0x5b0f5a+=_0x1d605d[_0x4d8e3e(0x1ec)];}),_0x1ee204[_0x269a2d(0x1e8)]=parseFloat(_0x58fb8e)+0x0,_0x1ee204[_0x269a2d(0x1c7)]=parseFloat(_0x5b0f5a)+0x0,_0x1ee204;});console[_0x2b4bdb(0x1fb)](_0x2b4bdb(0x19c),_0x96df9c);if(_0x110c2e[0x0]['language']==_0x2b4bdb(0x1b9)){var _0x28de49=users[_0x2b4bdb(0x1b2)];console[_0x2b4bdb(0x1fb)](_0x28de49);}else{if(_0x110c2e[0x0]['language']==_0x2b4bdb(0x1f7))var _0x28de49=users[_0x2b4bdb(0x1f7)];else{if(_0x110c2e[0x0][_0x2b4bdb(0x1b7)]==_0x2b4bdb(0x1f0))var _0x28de49=users[_0x2b4bdb(0x1f0)];else{if(_0x110c2e[0x0]['language']=='Spanish')var _0x28de49=users['Spanish'];else{if(_0x110c2e[0x0]['language']==_0x2b4bdb(0x1e3))var _0x28de49=users['French'];else{if(_0x110c2e[0x0][_0x2b4bdb(0x1b7)]==_0x2b4bdb(0x1da))var _0x28de49=users[_0x2b4bdb(0x1d6)];else{if(_0x110c2e[0x0][_0x2b4bdb(0x1b7)]==_0x2b4bdb(0x1fc))var _0x28de49=users[_0x2b4bdb(0x1fc)];else{if(_0x110c2e[0x0][_0x2b4bdb(0x1b7)]==_0x2b4bdb(0x1c3))var _0x28de49=users[_0x2b4bdb(0x1f8)];}}}}}}}_0x2a2554[_0x2b4bdb(0x1ae)](_0x2b4bdb(0x19f),{'success':_0x5e5484[_0x2b4bdb(0x1bc)](_0x2b4bdb(0x1e5)),'errors':_0x5e5484[_0x2b4bdb(0x1bc)](_0x2b4bdb(0x1ee)),'user':_0x520d0b,'role':_0x220184,'profile':_0x40b177,'payment':_0x96df9c,'master_shop':_0x110c2e,'language':_0x28de49});}catch(_0x212353){console[_0x2b4bdb(0x1fb)](_0x212353);}}),router[a0_0x4664a7(0x1df)]('/view',auth,async(_0x55cd33,_0x55b703)=>{const _0x561b5f=a0_0x4664a7;try{const {name:_0x48623f,address:_0x35904d,mobile:_0x47d140,email:_0xaffea,receivable:_0x4a1c53,payable:_0x44c58e,contactperson:_0x1ddbde,landline:_0xd4e89b}=_0x55cd33[_0x561b5f(0x1d1)],_0x353aef=new customer({'name':_0x48623f,'address':_0x35904d,'mobile':_0x47d140,'email':_0xaffea,'receivable':_0x4a1c53,'payable':_0x44c58e,'contactperson':_0x1ddbde,'landline':_0xd4e89b}),_0x51a898=await _0x353aef[_0x561b5f(0x1d7)]();_0x55cd33[_0x561b5f(0x1bc)](_0x561b5f(0x1e5),_0x561b5f(0x1c6)),_0x55b703['redirect'](_0x561b5f(0x19e));}catch(_0x28992e){console[_0x561b5f(0x1fb)](_0x28992e);}}),router[a0_0x4664a7(0x1f5)](a0_0x4664a7(0x1db),auth,async(_0x507af6,_0x2ca3f7)=>{const _0x40315a=a0_0x4664a7;try{const {username:_0x2c68d0,email:_0x38426d,role:_0x191da8}=_0x507af6[_0x40315a(0x1ac)],_0x55f46b=_0x507af6['user'],_0x5e4f77=await profile[_0x40315a(0x1cc)]({'email':_0x55f46b['email']}),_0x27f8c3=await master_shop[_0x40315a(0x1a7)]();console[_0x40315a(0x1fb)](_0x40315a(0x1d8),_0x27f8c3);const _0x1b36b3=_0x507af6[_0x40315a(0x1aa)]['id'],_0x917cdd=await customer['findById'](_0x1b36b3);if(_0x27f8c3[0x0]['language']==_0x40315a(0x1b9)){var _0x4db75d=users[_0x40315a(0x1b2)];console[_0x40315a(0x1fb)](_0x4db75d);}else{if(_0x27f8c3[0x0][_0x40315a(0x1b7)]==_0x40315a(0x1f7))var _0x4db75d=users['Hindi'];else{if(_0x27f8c3[0x0][_0x40315a(0x1b7)]==_0x40315a(0x1f0))var _0x4db75d=users[_0x40315a(0x1f0)];else{if(_0x27f8c3[0x0][_0x40315a(0x1b7)]==_0x40315a(0x1fe))var _0x4db75d=users[_0x40315a(0x1fe)];else{if(_0x27f8c3[0x0][_0x40315a(0x1b7)]==_0x40315a(0x1e3))var _0x4db75d=users[_0x40315a(0x1e3)];else{if(_0x27f8c3[0x0]['language']==_0x40315a(0x1da))var _0x4db75d=users['Portuguese'];else{if(_0x27f8c3[0x0]['language']==_0x40315a(0x1fc))var _0x4db75d=users[_0x40315a(0x1fc)];else{if(_0x27f8c3[0x0]['language']==_0x40315a(0x1c3))var _0x4db75d=users[_0x40315a(0x1f8)];}}}}}}}_0x2ca3f7[_0x40315a(0x1ae)](_0x40315a(0x19f),{'success':_0x507af6[_0x40315a(0x1bc)](_0x40315a(0x1e5)),'errors':_0x507af6[_0x40315a(0x1bc)](_0x40315a(0x1ee)),'role':_0x55f46b,'profile':_0x5e4f77,'user':_0x917cdd,'master_shop':_0x27f8c3,'language':_0x4db75d});}catch(_0x8b0416){console[_0x40315a(0x1fb)](_0x8b0416);}}),router[a0_0x4664a7(0x1df)](a0_0x4664a7(0x1db),auth,async(_0x4757f1,_0x3ba4ec)=>{const _0x11fce4=a0_0x4664a7;try{const _0x25e49f=_0x4757f1['params']['id'],_0x2fced=await customer[_0x11fce4(0x1f2)](_0x25e49f),{name:_0xbdd37,address:_0x33ae52,mobile:_0x145a8b,email:_0x233d6f,receivable:_0x3f9993,payable:_0x57b633,contactperson:_0x2df2a8,landline:_0x32e2ab}=_0x4757f1[_0x11fce4(0x1d1)];_0x2fced[_0x11fce4(0x1b1)]=_0xbdd37,_0x2fced[_0x11fce4(0x1e9)]=_0x33ae52,_0x2fced[_0x11fce4(0x1a3)]=_0x145a8b,_0x2fced['email']=_0x233d6f,_0x2fced[_0x11fce4(0x1f3)]=_0x3f9993,_0x2fced[_0x11fce4(0x1d0)]=_0x57b633,_0x2fced[_0x11fce4(0x1f9)]=_0x2df2a8,_0x2fced[_0x11fce4(0x1bb)]=_0x32e2ab;const _0x1c029f=await _0x2fced[_0x11fce4(0x1d7)]();_0x4757f1[_0x11fce4(0x1bc)](_0x11fce4(0x1e5),_0x11fce4(0x1d4)),_0x3ba4ec[_0x11fce4(0x1e0)](_0x11fce4(0x19e));}catch(_0x454231){console[_0x11fce4(0x1fb)](_0x454231);}}),router[a0_0x4664a7(0x1f5)](a0_0x4664a7(0x1c1),auth,async(_0x253a95,_0x5dea4b)=>{const _0x513e43=a0_0x4664a7;try{const {username:_0x3f72d2,email:_0x2e2386,role:_0x47f666}=_0x253a95['user'],_0x2bf564=_0x253a95[_0x513e43(0x1ac)],_0x48432f=await profile[_0x513e43(0x1cc)]({'email':_0x2bf564['email']}),_0x5a9b57=await master_shop['find']();console[_0x513e43(0x1fb)](_0x513e43(0x1d8),_0x5a9b57),console[_0x513e43(0x1fb)](_0x253a95[_0x513e43(0x1aa)]['id']);const _0x307a11=await customer['findOne']({'_id':_0x253a95[_0x513e43(0x1aa)]['id']});console[_0x513e43(0x1fb)](_0x513e43(0x204),_0x307a11);const _0xbc0a83=await c_payment_data[_0x513e43(0x1a7)]({'customer':_0x307a11[_0x513e43(0x1b1)]});console[_0x513e43(0x1fb)](_0xbc0a83);const _0x1acb5e=await c_payment_data[_0x513e43(0x1de)]([{'$match':{'customer':_0x307a11['name']}},{'$match':{'reason':_0x513e43(0x1be)}},{'$group':{'_id':_0x513e43(0x1a0),'sum':{'$sum':_0x513e43(0x1cf)}}}]);console[_0x513e43(0x1fb)](_0x513e43(0x1bd),_0x1acb5e);const _0x59b0d5=await c_payment_data[_0x513e43(0x1de)]([{'$match':{'customer':_0x307a11[_0x513e43(0x1b1)]}},{'$match':{'reason':_0x513e43(0x1af)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x513e43(0x1cf)}}}]);console['log'](_0x513e43(0x1b3),_0x59b0d5);if(_0x5a9b57[0x0][_0x513e43(0x1b7)]==_0x513e43(0x1b9)){var _0x3fc56e=users['English'];console[_0x513e43(0x1fb)](_0x3fc56e);}else{if(_0x5a9b57[0x0][_0x513e43(0x1b7)]==_0x513e43(0x1f7))var _0x3fc56e=users[_0x513e43(0x1f7)];else{if(_0x5a9b57[0x0][_0x513e43(0x1b7)]==_0x513e43(0x1f0))var _0x3fc56e=users['German'];else{if(_0x5a9b57[0x0][_0x513e43(0x1b7)]=='Spanish')var _0x3fc56e=users[_0x513e43(0x1fe)];else{if(_0x5a9b57[0x0][_0x513e43(0x1b7)]=='French')var _0x3fc56e=users['French'];else{if(_0x5a9b57[0x0]['language']==_0x513e43(0x1da))var _0x3fc56e=users[_0x513e43(0x1d6)];else{if(_0x5a9b57[0x0][_0x513e43(0x1b7)]==_0x513e43(0x1fc))var _0x3fc56e=users['Chinese'];else{if(_0x5a9b57[0x0][_0x513e43(0x1b7)]==_0x513e43(0x1c3))var _0x3fc56e=users[_0x513e43(0x1f8)];}}}}}}}_0x5dea4b[_0x513e43(0x1ae)](_0x513e43(0x1dd),{'success':_0x253a95['flash'](_0x513e43(0x1e5)),'errors':_0x253a95[_0x513e43(0x1bc)](_0x513e43(0x1ee)),'role':_0x2bf564,'profile':_0x48432f,'payment':_0xbc0a83,'payable':_0x1acb5e,'receivable':_0x59b0d5,'master_shop':_0x5a9b57,'language':_0x3fc56e});}catch(_0xcfae58){console[_0x513e43(0x1fb)](_0xcfae58);}}),router[a0_0x4664a7(0x1f5)](a0_0x4664a7(0x1e6),auth,async(_0xbdfa67,_0x117fe6)=>{const _0x278ae3=a0_0x4664a7;try{const _0x8b0e0f=new excelJS[(_0x278ae3(0x1b0))](),_0x33f0aa=_0x8b0e0f[_0x278ae3(0x1ad)](_0x278ae3(0x1eb));return _0x33f0aa[_0x278ae3(0x1e4)]=[{'header':'ID','key':_0x278ae3(0x1c0),'width':0xa},{'header':_0x278ae3(0x1ea),'key':_0x278ae3(0x1e7),'width':0xa},{'header':_0x278ae3(0x1ce),'key':'PUnits','width':0xa},{'header':_0x278ae3(0x1d2),'key':_0x278ae3(0x1d2),'width':0xa},{'header':_0x278ae3(0x1e9),'key':_0x278ae3(0x1e9),'width':0xa},{'header':_0x278ae3(0x1a3),'key':_0x278ae3(0x1a3),'width':0xa},{'header':_0x278ae3(0x1f1),'key':_0x278ae3(0x1f1),'width':0xa}],_0x117fe6['setHeader'](_0x278ae3(0x200),_0x278ae3(0x19d)),_0x117fe6[_0x278ae3(0x1ef)](_0x278ae3(0x1a9),_0x278ae3(0x1f6)),_0x8b0e0f[_0x278ae3(0x1d5)]['write'](_0x117fe6)[_0x278ae3(0x1cd)](()=>{const _0x5c37ed=_0x278ae3;_0x117fe6[_0x5c37ed(0x201)](0xc8);});}catch(_0x3292df){_0x117fe6[_0x278ae3(0x201)](0x190)['send']({'errors':_0x3292df[_0x278ae3(0x1fa)]});}});const storage1=multer['diskStorage']({'destination':(_0x5ed426,_0x44957a,_0x223d30)=>{_0x223d30(null,'public/Migration');},'filename':(_0x334b37,_0x6b234b,_0x113700)=>{const _0x37fdfd=a0_0x4664a7;_0x113700(null,Date[_0x37fdfd(0x1e1)]()+_0x6b234b[_0x37fdfd(0x1b8)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x19f6(_0x5784be,_0x2eae8b){const _0x1333dc=a0_0x1333();return a0_0x19f6=function(_0x19f61c,_0x4c65a4){_0x19f61c=_0x19f61c-0x19a;let _0x471c59=_0x1333dc[_0x19f61c];return _0x471c59;},a0_0x19f6(_0x5784be,_0x2eae8b);}router[a0_0x4664a7(0x1df)](a0_0x4664a7(0x1b4),auth,uploadMigrate[a0_0x4664a7(0x1fd)]('customer_product_fule'),async(_0x3430ec,_0x16645d)=>{const _0x4fecdf=a0_0x4664a7,_0x4176c5=_0x3430ec[_0x4fecdf(0x1c8)][_0x4fecdf(0x19a)],_0x29e317=await xlsx[_0x4fecdf(0x1c5)](_0x4fecdf(0x1bf)+_0x4176c5);let _0x576602=_0x29e317[_0x4fecdf(0x1a8)],_0x1544ee=xlsx['utils']['sheet_to_json'](_0x29e317[_0x4fecdf(0x1ba)][_0x576602[0x0]]);for(const _0x50d645 of _0x1544ee){const _0x1c096f=_0x50d645['ID'],_0x561f23=_0x50d645[_0x4fecdf(0x1ea)],_0x1c3f94=_0x50d645['SalesmanCode'],_0x33d476=_0x50d645[_0x4fecdf(0x1d2)],_0x115868=_0x50d645['address'],_0x12b51d=_0x50d645[_0x4fecdf(0x1a3)],_0x5a2147=_0x50d645[_0x4fecdf(0x1f1)];try{let _0x27c8d3=await customer[_0x4fecdf(0x1cc)]({'name':_0x561f23});if(!_0x27c8d3){const _0x2eb7f3=new customer({'name':_0x561f23,'ID':_0x1c096f,'SalesmanCode':_0x1c3f94,'SalesmanName':_0x33d476,'address':_0x115868,'mobile':_0x12b51d,'email':_0x5a2147});_0x27c8d3=await _0x2eb7f3[_0x4fecdf(0x1d7)](),_0x3430ec[_0x4fecdf(0x1bc)](_0x4fecdf(0x1e5),_0x561f23+'\x20added\x20successfully');}else _0x3430ec['flash'](_0x4fecdf(0x202),_0x561f23+_0x4fecdf(0x1a4));}catch(_0x35d386){_0x16645d[_0x4fecdf(0x201)](0x1f4)['json']({'proderror':_0x35d386[_0x4fecdf(0x1fa)],'aproduct':ProductName});}}_0x16645d[_0x4fecdf(0x1e0)](_0x4fecdf(0x19e));}),module[a0_0x4664a7(0x1b6)]=router;