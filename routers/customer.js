const a0_0x455b73=a0_0x5386;function a0_0x1969(){const _0x5584af=['mobile','address','973672GyxUgV','find','\x20added\x20successfully','readFile','write','originalname','Sheets','2954500PmGzLU','now','exports','English\x20(US)','aggregate','get','$reason','customer_payment','payable_sum','findOne','setHeader','payable','express','Arabic','status','861478Kreidz','post','success','customer_docs','/customer_import_migrate_file','German','/view/:id','public/Migration','7763iBJfAb','diskStorage','99QkPUMs','body','filename','message','Chinese','5904480hBIAJZ','Sale\x20Return','errors','../models/all_models','34HRkUGE','language','receivable_sum','English','Hindi','multer','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','email','addWorksheet','Router','master','send','xlsx','flash','Arabic\x20(ae)','Sale','customer\x20update\x20successfully','Customers','user','SalesmanName','customer','reason','Portuguese','French','9561cHllBg','Portuguese\x20(BR)','receivable','columns','error','6282MHDwfK','PBrands','/view','data','render','SheetNames','$amount','forEach','sale_return','landline','attachment;\x20filename=customer_Migration_File.xlsx','save','17651120LFCAcM','then','redirect','customer\x20add\x20successfully','payment_data','log','findById','params','name','exceljs','/customer/view','/view/payment/:id','PName','amount','Spanish'];a0_0x1969=function(){return _0x5584af;};return a0_0x1969();}function a0_0x5386(_0x497f75,_0x510df1){const _0x1969b4=a0_0x1969();return a0_0x5386=function(_0x5386b7,_0x45f413){_0x5386b7=_0x5386b7-0x1ac;let _0x316bba=_0x1969b4[_0x5386b7];return _0x316bba;},a0_0x5386(_0x497f75,_0x510df1);}(function(_0x18866c,_0x30794a){const _0x10a058=a0_0x5386,_0x5e3edc=_0x18866c();while(!![]){try{const _0x222e9a=parseInt(_0x10a058(0x1e9))/0x1+parseInt(_0x10a058(0x1fc))/0x2*(parseInt(_0x10a058(0x1b1))/0x3)+-parseInt(_0x10a058(0x1f8))/0x4+-parseInt(_0x10a058(0x1da))/0x5+-parseInt(_0x10a058(0x1b6))/0x6*(parseInt(_0x10a058(0x1f1))/0x7)+parseInt(_0x10a058(0x1d3))/0x8*(parseInt(_0x10a058(0x1f3))/0x9)+parseInt(_0x10a058(0x1c2))/0xa;if(_0x222e9a===_0x30794a)break;else _0x5e3edc['push'](_0x5e3edc['shift']());}catch(_0x460d06){_0x5e3edc['push'](_0x5e3edc['shift']());}}}(a0_0x1969,0xc1381));const express=require(a0_0x455b73(0x1e6)),app=express(),router=express[a0_0x455b73(0x205)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x455b73(0x1fb)),auth=require('../middleware/auth'),users=require('../public/language/languages.json'),excelJS=require(a0_0x455b73(0x1cb)),xlsx=require(a0_0x455b73(0x208)),multer=require(a0_0x455b73(0x201));router['get'](a0_0x455b73(0x1b8),auth,async(_0x33ab3e,_0xfc4860)=>{const _0x2431f7=a0_0x455b73;try{const {username:_0xf9fd6d,email:_0x25c3f8,role:_0x5dd8a7}=_0x33ab3e[_0x2431f7(0x20e)],_0x39dca5=_0x33ab3e[_0x2431f7(0x20e)],_0x53c93a=await profile[_0x2431f7(0x1e3)]({'email':_0x39dca5['email']}),_0x435826=await master_shop[_0x2431f7(0x1d4)]();console[_0x2431f7(0x1c7)](_0x2431f7(0x206),_0x435826);const _0xaf1e4f=await customer[_0x2431f7(0x1d4)](),_0x7e45b6=await customer[_0x2431f7(0x1de)]([{'$lookup':{'from':'c_payments','localField':_0x2431f7(0x1ca),'foreignField':_0x2431f7(0x1ad),'as':_0x2431f7(0x1ec)}}]);console[_0x2431f7(0x1c7)](_0x7e45b6);const _0x3a38e6=_0x7e45b6['map'](_0x2019b3=>{const _0x5b0e69=_0x2431f7;console[_0x5b0e69(0x1c7)](_0x5b0e69(0x1b9),_0x2019b3);var _0x1ad6f1=0x0,_0x2933ff=0x0;return _0x2019b3[_0x5b0e69(0x1ec)][_0x5b0e69(0x1bd)](_0x2f1a47=>{const _0x3e3131=_0x5b0e69;console[_0x3e3131(0x1c7)]('element',_0x2f1a47),_0x2f1a47[_0x3e3131(0x1ae)]==_0x3e3131(0x20b)?_0x1ad6f1+=_0x2f1a47[_0x3e3131(0x1cf)]:_0x2933ff+=_0x2f1a47[_0x3e3131(0x1cf)];}),_0x2019b3['sale']=parseFloat(_0x1ad6f1)+0x0,_0x2019b3[_0x5b0e69(0x1be)]=parseFloat(_0x2933ff)+0x0,_0x2019b3;});console[_0x2431f7(0x1c7)](_0x2431f7(0x1c6),_0x3a38e6);if(_0x435826[0x0][_0x2431f7(0x1fd)]=='English\x20(US)'){var _0x2d5d18=users[_0x2431f7(0x1ff)];console[_0x2431f7(0x1c7)](_0x2d5d18);}else{if(_0x435826[0x0]['language']==_0x2431f7(0x200))var _0x2d5d18=users[_0x2431f7(0x200)];else{if(_0x435826[0x0][_0x2431f7(0x1fd)]==_0x2431f7(0x1ee))var _0x2d5d18=users[_0x2431f7(0x1ee)];else{if(_0x435826[0x0]['language']==_0x2431f7(0x1d0))var _0x2d5d18=users[_0x2431f7(0x1d0)];else{if(_0x435826[0x0][_0x2431f7(0x1fd)]=='French')var _0x2d5d18=users[_0x2431f7(0x1b0)];else{if(_0x435826[0x0][_0x2431f7(0x1fd)]==_0x2431f7(0x1b2))var _0x2d5d18=users[_0x2431f7(0x1af)];else{if(_0x435826[0x0][_0x2431f7(0x1fd)]==_0x2431f7(0x1f7))var _0x2d5d18=users[_0x2431f7(0x1f7)];else{if(_0x435826[0x0]['language']==_0x2431f7(0x20a))var _0x2d5d18=users[_0x2431f7(0x1e7)];}}}}}}}_0xfc4860[_0x2431f7(0x1ba)]('customer',{'success':_0x33ab3e[_0x2431f7(0x209)](_0x2431f7(0x1eb)),'errors':_0x33ab3e['flash'](_0x2431f7(0x1fa)),'user':_0xaf1e4f,'role':_0x39dca5,'profile':_0x53c93a,'payment':_0x3a38e6,'master_shop':_0x435826,'language':_0x2d5d18});}catch(_0x405e8b){console['log'](_0x405e8b);}}),router[a0_0x455b73(0x1ea)](a0_0x455b73(0x1b8),auth,async(_0x506ef1,_0x455120)=>{const _0x46f954=a0_0x455b73;try{const {name:_0x3ecfad,address:_0x14bb6c,mobile:_0x10a72d,email:_0x243fcd,receivable:_0x2889df,payable:_0x26c392,contactperson:_0x4e86f8,landline:_0xb0ecb7}=_0x506ef1['body'],_0x3f0683=new customer({'name':_0x3ecfad,'address':_0x14bb6c,'mobile':_0x10a72d,'email':_0x243fcd,'receivable':_0x2889df,'payable':_0x26c392,'contactperson':_0x4e86f8,'landline':_0xb0ecb7}),_0x503db3=await _0x3f0683[_0x46f954(0x1c1)]();_0x506ef1['flash']('success',_0x46f954(0x1c5)),_0x455120[_0x46f954(0x1c4)](_0x46f954(0x1cc));}catch(_0xf1ffa8){console[_0x46f954(0x1c7)](_0xf1ffa8);}}),router[a0_0x455b73(0x1df)](a0_0x455b73(0x1ef),auth,async(_0x351136,_0x1f2934)=>{const _0x20fbaa=a0_0x455b73;try{const {username:_0x59901e,email:_0x184716,role:_0x2f2555}=_0x351136[_0x20fbaa(0x20e)],_0x584320=_0x351136[_0x20fbaa(0x20e)],_0x43ad49=await profile[_0x20fbaa(0x1e3)]({'email':_0x584320[_0x20fbaa(0x203)]}),_0x311998=await master_shop[_0x20fbaa(0x1d4)]();console[_0x20fbaa(0x1c7)](_0x20fbaa(0x206),_0x311998);const _0x4d17b5=_0x351136[_0x20fbaa(0x1c9)]['id'],_0x11acf7=await customer['findById'](_0x4d17b5);if(_0x311998[0x0]['language']==_0x20fbaa(0x1dd)){var _0x492d75=users[_0x20fbaa(0x1ff)];console['log'](_0x492d75);}else{if(_0x311998[0x0][_0x20fbaa(0x1fd)]=='Hindi')var _0x492d75=users[_0x20fbaa(0x200)];else{if(_0x311998[0x0][_0x20fbaa(0x1fd)]==_0x20fbaa(0x1ee))var _0x492d75=users[_0x20fbaa(0x1ee)];else{if(_0x311998[0x0][_0x20fbaa(0x1fd)]==_0x20fbaa(0x1d0))var _0x492d75=users[_0x20fbaa(0x1d0)];else{if(_0x311998[0x0]['language']==_0x20fbaa(0x1b0))var _0x492d75=users[_0x20fbaa(0x1b0)];else{if(_0x311998[0x0]['language']==_0x20fbaa(0x1b2))var _0x492d75=users[_0x20fbaa(0x1af)];else{if(_0x311998[0x0]['language']==_0x20fbaa(0x1f7))var _0x492d75=users[_0x20fbaa(0x1f7)];else{if(_0x311998[0x0]['language']==_0x20fbaa(0x20a))var _0x492d75=users[_0x20fbaa(0x1e7)];}}}}}}}_0x1f2934[_0x20fbaa(0x1ba)](_0x20fbaa(0x1ad),{'success':_0x351136[_0x20fbaa(0x209)](_0x20fbaa(0x1eb)),'errors':_0x351136[_0x20fbaa(0x209)](_0x20fbaa(0x1fa)),'role':_0x584320,'profile':_0x43ad49,'user':_0x11acf7,'master_shop':_0x311998,'language':_0x492d75});}catch(_0x2b6d64){console['log'](_0x2b6d64);}}),router[a0_0x455b73(0x1ea)](a0_0x455b73(0x1ef),auth,async(_0x306567,_0x42f2fe)=>{const _0x519ad4=a0_0x455b73;try{const _0x3284e1=_0x306567[_0x519ad4(0x1c9)]['id'],_0x12ff72=await customer[_0x519ad4(0x1c8)](_0x3284e1),{name:_0x3b8a25,address:_0x3f0709,mobile:_0x2bee15,email:_0x3396a4,receivable:_0x44768a,payable:_0x106c0e,contactperson:_0x591c87,landline:_0x3a1515}=_0x306567[_0x519ad4(0x1f4)];_0x12ff72['name']=_0x3b8a25,_0x12ff72[_0x519ad4(0x1d2)]=_0x3f0709,_0x12ff72[_0x519ad4(0x1d1)]=_0x2bee15,_0x12ff72[_0x519ad4(0x203)]=_0x3396a4,_0x12ff72[_0x519ad4(0x1b3)]=_0x44768a,_0x12ff72[_0x519ad4(0x1e5)]=_0x106c0e,_0x12ff72['contactperson']=_0x591c87,_0x12ff72[_0x519ad4(0x1bf)]=_0x3a1515;const _0x4d8b29=await _0x12ff72[_0x519ad4(0x1c1)]();_0x306567[_0x519ad4(0x209)](_0x519ad4(0x1eb),_0x519ad4(0x20c)),_0x42f2fe['redirect'](_0x519ad4(0x1cc));}catch(_0x57185b){console[_0x519ad4(0x1c7)](_0x57185b);}}),router[a0_0x455b73(0x1df)](a0_0x455b73(0x1cd),auth,async(_0x49cf61,_0xaace62)=>{const _0xf32cab=a0_0x455b73;try{const {username:_0x184071,email:_0x517727,role:_0x3154c5}=_0x49cf61[_0xf32cab(0x20e)],_0x2c03e8=_0x49cf61[_0xf32cab(0x20e)],_0x1177ed=await profile[_0xf32cab(0x1e3)]({'email':_0x2c03e8['email']}),_0xac9de9=await master_shop[_0xf32cab(0x1d4)]();console['log']('master',_0xac9de9),console[_0xf32cab(0x1c7)](_0x49cf61[_0xf32cab(0x1c9)]['id']);const _0x1a672f=await customer['findOne']({'_id':_0x49cf61['params']['id']});console['log']('customer_data',_0x1a672f);const _0x38f1f4=await c_payment_data['find']({'customer':_0x1a672f['name']});console[_0xf32cab(0x1c7)](_0x38f1f4);const _0x30bea8=await c_payment_data[_0xf32cab(0x1de)]([{'$match':{'customer':_0x1a672f[_0xf32cab(0x1ca)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0xf32cab(0x1e0),'sum':{'$sum':_0xf32cab(0x1bc)}}}]);console[_0xf32cab(0x1c7)](_0xf32cab(0x1e2),_0x30bea8);const _0x344eb5=await c_payment_data['aggregate']([{'$match':{'customer':_0x1a672f[_0xf32cab(0x1ca)]}},{'$match':{'reason':_0xf32cab(0x1f9)}},{'$group':{'_id':_0xf32cab(0x1e0),'sum':{'$sum':_0xf32cab(0x1bc)}}}]);console['log'](_0xf32cab(0x1fe),_0x344eb5);if(_0xac9de9[0x0]['language']==_0xf32cab(0x1dd)){var _0x53d0ef=users[_0xf32cab(0x1ff)];console[_0xf32cab(0x1c7)](_0x53d0ef);}else{if(_0xac9de9[0x0][_0xf32cab(0x1fd)]==_0xf32cab(0x200))var _0x53d0ef=users[_0xf32cab(0x200)];else{if(_0xac9de9[0x0]['language']==_0xf32cab(0x1ee))var _0x53d0ef=users[_0xf32cab(0x1ee)];else{if(_0xac9de9[0x0][_0xf32cab(0x1fd)]==_0xf32cab(0x1d0))var _0x53d0ef=users[_0xf32cab(0x1d0)];else{if(_0xac9de9[0x0][_0xf32cab(0x1fd)]==_0xf32cab(0x1b0))var _0x53d0ef=users[_0xf32cab(0x1b0)];else{if(_0xac9de9[0x0]['language']==_0xf32cab(0x1b2))var _0x53d0ef=users[_0xf32cab(0x1af)];else{if(_0xac9de9[0x0][_0xf32cab(0x1fd)]==_0xf32cab(0x1f7))var _0x53d0ef=users[_0xf32cab(0x1f7)];else{if(_0xac9de9[0x0][_0xf32cab(0x1fd)]==_0xf32cab(0x20a))var _0x53d0ef=users['Arabic'];}}}}}}}_0xaace62['render'](_0xf32cab(0x1e1),{'success':_0x49cf61[_0xf32cab(0x209)]('success'),'errors':_0x49cf61[_0xf32cab(0x209)](_0xf32cab(0x1fa)),'role':_0x2c03e8,'profile':_0x1177ed,'payment':_0x38f1f4,'payable':_0x30bea8,'receivable':_0x344eb5,'master_shop':_0xac9de9,'language':_0x53d0ef});}catch(_0xeaa3be){console[_0xf32cab(0x1c7)](_0xeaa3be);}}),router[a0_0x455b73(0x1df)]('/products_export_migrate_file',auth,async(_0x5d9239,_0x1bb15b)=>{const _0x407cf4=a0_0x455b73;try{const _0x47bd53=new excelJS['Workbook'](),_0x5306b5=_0x47bd53[_0x407cf4(0x204)](_0x407cf4(0x20d));return _0x5306b5[_0x407cf4(0x1b4)]=[{'header':'ID','key':_0x407cf4(0x1ce),'width':0xa},{'header':'Name','key':_0x407cf4(0x1b7),'width':0xa},{'header':'SalesmanCode','key':'PUnits','width':0xa},{'header':'SalesmanName','key':_0x407cf4(0x1ac),'width':0xa},{'header':'address','key':_0x407cf4(0x1d2),'width':0xa},{'header':'mobile','key':_0x407cf4(0x1d1),'width':0xa},{'header':_0x407cf4(0x203),'key':'email','width':0xa}],_0x1bb15b[_0x407cf4(0x1e4)]('Content-Type',_0x407cf4(0x202)),_0x1bb15b[_0x407cf4(0x1e4)]('Content-Disposition',_0x407cf4(0x1c0)),_0x47bd53['xlsx'][_0x407cf4(0x1d7)](_0x1bb15b)[_0x407cf4(0x1c3)](()=>{const _0x21c270=_0x407cf4;_0x1bb15b[_0x21c270(0x1e8)](0xc8);});}catch(_0x4fe01e){_0x1bb15b[_0x407cf4(0x1e8)](0x190)[_0x407cf4(0x207)]({'errors':_0x4fe01e[_0x407cf4(0x1f6)]});}});const storage1=multer[a0_0x455b73(0x1f2)]({'destination':(_0xfeecea,_0x27cff1,_0x378001)=>{const _0x4a3535=a0_0x455b73;_0x378001(null,_0x4a3535(0x1f0));},'filename':(_0x36a882,_0x1b24c6,_0x235142)=>{const _0x4a018f=a0_0x455b73;_0x235142(null,Date[_0x4a018f(0x1db)]()+_0x1b24c6[_0x4a018f(0x1d8)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x455b73(0x1ea)](a0_0x455b73(0x1ed),auth,uploadMigrate['single']('customer_product_fule'),async(_0x4b633c,_0x2ea478)=>{const _0x5b1033=a0_0x455b73,_0x56843a=_0x4b633c['file'][_0x5b1033(0x1f5)],_0x19af88=await xlsx[_0x5b1033(0x1d6)]('public/Migration/'+_0x56843a);let _0x59a0cb=_0x19af88[_0x5b1033(0x1bb)],_0x37757c=xlsx['utils']['sheet_to_json'](_0x19af88[_0x5b1033(0x1d9)][_0x59a0cb[0x0]]);for(const _0x17afa4 of _0x37757c){const _0x3288a4=_0x17afa4['ID'],_0x47e7f1=_0x17afa4['Name'],_0x169170=_0x17afa4['SalesmanCode'],_0xc4bfe5=_0x17afa4[_0x5b1033(0x1ac)],_0x27ce63=_0x17afa4[_0x5b1033(0x1d2)],_0xd407e4=_0x17afa4['mobile'],_0x11f313=_0x17afa4[_0x5b1033(0x203)];try{let _0x3cea44=await customer[_0x5b1033(0x1e3)]({'name':_0x47e7f1});if(!_0x3cea44){const _0x3e2e28=new customer({'name':_0x47e7f1,'ID':_0x3288a4,'SalesmanCode':_0x169170,'SalesmanName':_0xc4bfe5,'address':_0x27ce63,'mobile':_0xd407e4,'email':_0x11f313});_0x3cea44=await _0x3e2e28[_0x5b1033(0x1c1)](),_0x4b633c['flash'](_0x5b1033(0x1eb),_0x47e7f1+_0x5b1033(0x1d5));}else _0x4b633c[_0x5b1033(0x209)](_0x5b1033(0x1b5),_0x47e7f1+'\x20Failed');}catch(_0x249c52){_0x2ea478['status'](0x1f4)['json']({'proderror':_0x249c52[_0x5b1033(0x1f6)],'aproduct':ProductName});}}_0x2ea478['redirect'](_0x5b1033(0x1cc));}),module[a0_0x455b73(0x1dc)]=router;