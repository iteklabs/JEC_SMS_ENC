const a0_0x265922=a0_0x1c17;(function(_0x48cfc7,_0x2023df){const _0x1aaf3c=a0_0x1c17,_0x46923e=_0x48cfc7();while(!![]){try{const _0x4ae2b2=-parseInt(_0x1aaf3c(0x174))/0x1+-parseInt(_0x1aaf3c(0x177))/0x2*(-parseInt(_0x1aaf3c(0x18e))/0x3)+parseInt(_0x1aaf3c(0x168))/0x4+parseInt(_0x1aaf3c(0x164))/0x5+-parseInt(_0x1aaf3c(0x198))/0x6+parseInt(_0x1aaf3c(0x18d))/0x7+-parseInt(_0x1aaf3c(0x1a7))/0x8;if(_0x4ae2b2===_0x2023df)break;else _0x46923e['push'](_0x46923e['shift']());}catch(_0xb0830b){_0x46923e['push'](_0x46923e['shift']());}}}(a0_0x48fb,0xec7b1));const express=require('express'),app=express(),router=express[a0_0x265922(0x19a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x265922(0x151)),auth=require(a0_0x265922(0x17e)),users=require(a0_0x265922(0x1a4)),excelJS=require(a0_0x265922(0x159)),xlsx=require('xlsx'),multer=require(a0_0x265922(0x169));router['get'](a0_0x265922(0x16d),auth,async(_0x2ab94d,_0x2ccacb)=>{const _0x1ca23c=a0_0x265922;try{const {username:_0x593692,email:_0x3e05e3,role:_0x458f6d}=_0x2ab94d[_0x1ca23c(0x192)],_0x1e84df=_0x2ab94d[_0x1ca23c(0x192)],_0x118597=await profile['findOne']({'email':_0x1e84df['email']}),_0x35a650=await master_shop['find']();console['log']('master',_0x35a650);const _0x17343d=await customer['find'](),_0x4543f8=await customer['aggregate']([{'$lookup':{'from':_0x1ca23c(0x18b),'localField':'name','foreignField':_0x1ca23c(0x171),'as':_0x1ca23c(0x154)}}]);console[_0x1ca23c(0x1a6)](_0x4543f8);const _0x4ee1da=_0x4543f8['map'](_0x42adaa=>{const _0x420d50=_0x1ca23c;console[_0x420d50(0x1a6)]('data',_0x42adaa);var _0x3360b2=0x0,_0x6f951c=0x0;return _0x42adaa[_0x420d50(0x154)]['forEach'](_0x3eef4a=>{const _0xecfac4=_0x420d50;console[_0xecfac4(0x1a6)](_0xecfac4(0x170),_0x3eef4a),_0x3eef4a[_0xecfac4(0x15d)]==_0xecfac4(0x14c)?_0x3360b2+=_0x3eef4a[_0xecfac4(0x19b)]:_0x6f951c+=_0x3eef4a[_0xecfac4(0x19b)];}),_0x42adaa[_0x420d50(0x19f)]=parseFloat(_0x3360b2)+0x0,_0x42adaa[_0x420d50(0x15b)]=parseFloat(_0x6f951c)+0x0,_0x42adaa;});console[_0x1ca23c(0x1a6)](_0x1ca23c(0x15c),_0x4ee1da);if(_0x35a650[0x0][_0x1ca23c(0x167)]==_0x1ca23c(0x150)){var _0x2b0d79=users[_0x1ca23c(0x182)];console[_0x1ca23c(0x1a6)](_0x2b0d79);}else{if(_0x35a650[0x0][_0x1ca23c(0x167)]==_0x1ca23c(0x16b))var _0x2b0d79=users[_0x1ca23c(0x16b)];else{if(_0x35a650[0x0][_0x1ca23c(0x167)]==_0x1ca23c(0x165))var _0x2b0d79=users['German'];else{if(_0x35a650[0x0]['language']==_0x1ca23c(0x184))var _0x2b0d79=users[_0x1ca23c(0x184)];else{if(_0x35a650[0x0][_0x1ca23c(0x167)]==_0x1ca23c(0x172))var _0x2b0d79=users[_0x1ca23c(0x172)];else{if(_0x35a650[0x0][_0x1ca23c(0x167)]==_0x1ca23c(0x162))var _0x2b0d79=users[_0x1ca23c(0x149)];else{if(_0x35a650[0x0][_0x1ca23c(0x167)]==_0x1ca23c(0x176))var _0x2b0d79=users[_0x1ca23c(0x176)];else{if(_0x35a650[0x0][_0x1ca23c(0x167)]=='Arabic\x20(ae)')var _0x2b0d79=users['Arabic'];}}}}}}}_0x2ccacb[_0x1ca23c(0x191)]('customer',{'success':_0x2ab94d[_0x1ca23c(0x197)](_0x1ca23c(0x14f)),'errors':_0x2ab94d[_0x1ca23c(0x197)](_0x1ca23c(0x175)),'user':_0x17343d,'role':_0x1e84df,'profile':_0x118597,'payment':_0x4ee1da,'master_shop':_0x35a650,'language':_0x2b0d79});}catch(_0x1e014e){console[_0x1ca23c(0x1a6)](_0x1e014e);}}),router[a0_0x265922(0x19c)](a0_0x265922(0x16d),auth,async(_0x1afed9,_0x2ba77e)=>{const _0x3a922d=a0_0x265922;try{const {name:_0x56e8d1,address:_0x523f6e,mobile:_0x48017b,email:_0x25cb0d,receivable:_0x5ead6b,payable:_0x1bef35,contactperson:_0x1c0212,landline:_0x4289cd}=_0x1afed9[_0x3a922d(0x1aa)],_0x47c270=new customer({'name':_0x56e8d1,'address':_0x523f6e,'mobile':_0x48017b,'email':_0x25cb0d,'receivable':_0x5ead6b,'payable':_0x1bef35,'contactperson':_0x1c0212,'landline':_0x4289cd}),_0x4041cb=await _0x47c270[_0x3a922d(0x17b)]();_0x1afed9[_0x3a922d(0x197)]('success',_0x3a922d(0x179)),_0x2ba77e[_0x3a922d(0x178)](_0x3a922d(0x163));}catch(_0x3d0718){console['log'](_0x3d0718);}}),router['get']('/view/:id',auth,async(_0x293056,_0x2e04b3)=>{const _0x422b97=a0_0x265922;try{const {username:_0x3e6702,email:_0x103a71,role:_0x523696}=_0x293056[_0x422b97(0x192)],_0x3d1748=_0x293056[_0x422b97(0x192)],_0x7578e4=await profile[_0x422b97(0x153)]({'email':_0x3d1748['email']}),_0x409c2a=await master_shop[_0x422b97(0x18c)]();console[_0x422b97(0x1a6)]('master',_0x409c2a);const _0x2606c2=_0x293056['params']['id'],_0x16a99b=await customer['findById'](_0x2606c2);if(_0x409c2a[0x0][_0x422b97(0x167)]=='English\x20(US)'){var _0x5ebf45=users[_0x422b97(0x182)];console[_0x422b97(0x1a6)](_0x5ebf45);}else{if(_0x409c2a[0x0][_0x422b97(0x167)]=='Hindi')var _0x5ebf45=users[_0x422b97(0x16b)];else{if(_0x409c2a[0x0][_0x422b97(0x167)]==_0x422b97(0x165))var _0x5ebf45=users[_0x422b97(0x165)];else{if(_0x409c2a[0x0][_0x422b97(0x167)]==_0x422b97(0x184))var _0x5ebf45=users['Spanish'];else{if(_0x409c2a[0x0]['language']==_0x422b97(0x172))var _0x5ebf45=users[_0x422b97(0x172)];else{if(_0x409c2a[0x0][_0x422b97(0x167)]==_0x422b97(0x162))var _0x5ebf45=users[_0x422b97(0x149)];else{if(_0x409c2a[0x0][_0x422b97(0x167)]=='Chinese')var _0x5ebf45=users['Chinese'];else{if(_0x409c2a[0x0][_0x422b97(0x167)]==_0x422b97(0x180))var _0x5ebf45=users[_0x422b97(0x173)];}}}}}}}_0x2e04b3['render'](_0x422b97(0x171),{'success':_0x293056['flash'](_0x422b97(0x14f)),'errors':_0x293056[_0x422b97(0x197)](_0x422b97(0x175)),'role':_0x3d1748,'profile':_0x7578e4,'user':_0x16a99b,'master_shop':_0x409c2a,'language':_0x5ebf45});}catch(_0x45bbb9){console[_0x422b97(0x1a6)](_0x45bbb9);}}),router[a0_0x265922(0x19c)](a0_0x265922(0x17f),auth,async(_0x548342,_0x4c1b54)=>{const _0x338166=a0_0x265922;try{const _0x4a0208=_0x548342[_0x338166(0x187)]['id'],_0x2062e2=await customer[_0x338166(0x16a)](_0x4a0208),{name:_0x5637ae,address:_0x3dd6ca,mobile:_0x51c722,email:_0x40d8af,receivable:_0x38b989,payable:_0x3f98a9,contactperson:_0x1f12f0,landline:_0x165cb6}=_0x548342['body'];_0x2062e2[_0x338166(0x147)]=_0x5637ae,_0x2062e2[_0x338166(0x1a9)]=_0x3dd6ca,_0x2062e2['mobile']=_0x51c722,_0x2062e2[_0x338166(0x18f)]=_0x40d8af,_0x2062e2[_0x338166(0x186)]=_0x38b989,_0x2062e2['payable']=_0x3f98a9,_0x2062e2[_0x338166(0x194)]=_0x1f12f0,_0x2062e2[_0x338166(0x156)]=_0x165cb6;const _0x3d043d=await _0x2062e2['save']();_0x548342[_0x338166(0x197)](_0x338166(0x14f),_0x338166(0x185)),_0x4c1b54[_0x338166(0x178)](_0x338166(0x163));}catch(_0x5e1e4e){console[_0x338166(0x1a6)](_0x5e1e4e);}}),router[a0_0x265922(0x183)]('/view/payment/:id',auth,async(_0x46d63a,_0xd8af8b)=>{const _0x5b1479=a0_0x265922;try{const {username:_0x32cef5,email:_0x29e22b,role:_0x12fb39}=_0x46d63a[_0x5b1479(0x192)],_0xe2cb76=_0x46d63a[_0x5b1479(0x192)],_0xf53bd5=await profile[_0x5b1479(0x153)]({'email':_0xe2cb76[_0x5b1479(0x18f)]}),_0x31d4d9=await master_shop['find']();console[_0x5b1479(0x1a6)](_0x5b1479(0x1ab),_0x31d4d9),console[_0x5b1479(0x1a6)](_0x46d63a['params']['id']);const _0x2857c2=await customer[_0x5b1479(0x153)]({'_id':_0x46d63a['params']['id']});console[_0x5b1479(0x1a6)](_0x5b1479(0x19d),_0x2857c2);const _0x2b07e0=await c_payment_data[_0x5b1479(0x18c)]({'customer':_0x2857c2[_0x5b1479(0x147)]});console[_0x5b1479(0x1a6)](_0x2b07e0);const _0x180c10=await c_payment_data['aggregate']([{'$match':{'customer':_0x2857c2[_0x5b1479(0x147)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x5b1479(0x1a1),'sum':{'$sum':_0x5b1479(0x157)}}}]);console[_0x5b1479(0x1a6)]('payable_sum',_0x180c10);const _0x119173=await c_payment_data[_0x5b1479(0x160)]([{'$match':{'customer':_0x2857c2['name']}},{'$match':{'reason':_0x5b1479(0x15a)}},{'$group':{'_id':_0x5b1479(0x1a1),'sum':{'$sum':'$amount'}}}]);console['log'](_0x5b1479(0x195),_0x119173);if(_0x31d4d9[0x0][_0x5b1479(0x167)]==_0x5b1479(0x150)){var _0x365e9f=users[_0x5b1479(0x182)];console[_0x5b1479(0x1a6)](_0x365e9f);}else{if(_0x31d4d9[0x0][_0x5b1479(0x167)]=='Hindi')var _0x365e9f=users[_0x5b1479(0x16b)];else{if(_0x31d4d9[0x0][_0x5b1479(0x167)]==_0x5b1479(0x165))var _0x365e9f=users[_0x5b1479(0x165)];else{if(_0x31d4d9[0x0]['language']==_0x5b1479(0x184))var _0x365e9f=users['Spanish'];else{if(_0x31d4d9[0x0][_0x5b1479(0x167)]=='French')var _0x365e9f=users[_0x5b1479(0x172)];else{if(_0x31d4d9[0x0][_0x5b1479(0x167)]==_0x5b1479(0x162))var _0x365e9f=users['Portuguese'];else{if(_0x31d4d9[0x0]['language']=='Chinese')var _0x365e9f=users[_0x5b1479(0x176)];else{if(_0x31d4d9[0x0][_0x5b1479(0x167)]==_0x5b1479(0x180))var _0x365e9f=users[_0x5b1479(0x173)];}}}}}}}_0xd8af8b[_0x5b1479(0x191)](_0x5b1479(0x166),{'success':_0x46d63a[_0x5b1479(0x197)](_0x5b1479(0x14f)),'errors':_0x46d63a[_0x5b1479(0x197)]('errors'),'role':_0xe2cb76,'profile':_0xf53bd5,'payment':_0x2b07e0,'payable':_0x180c10,'receivable':_0x119173,'master_shop':_0x31d4d9,'language':_0x365e9f});}catch(_0x4725b6){console[_0x5b1479(0x1a6)](_0x4725b6);}}),router[a0_0x265922(0x183)]('/products_export_migrate_file',auth,async(_0x3f4073,_0x422080)=>{const _0x3007c5=a0_0x265922;try{const _0x253af1=new excelJS['Workbook'](),_0x361dae=_0x253af1[_0x3007c5(0x16c)](_0x3007c5(0x1a0));return _0x361dae[_0x3007c5(0x18a)]=[{'header':'ID','key':_0x3007c5(0x190),'width':0xa},{'header':_0x3007c5(0x1a2),'key':_0x3007c5(0x19e),'width':0xa},{'header':_0x3007c5(0x14e),'key':_0x3007c5(0x17c),'width':0xa},{'header':_0x3007c5(0x14d),'key':'SalesmanName','width':0xa},{'header':'address','key':_0x3007c5(0x1a9),'width':0xa},{'header':_0x3007c5(0x1a5),'key':_0x3007c5(0x1a5),'width':0xa},{'header':'email','key':'email','width':0xa}],_0x422080[_0x3007c5(0x189)](_0x3007c5(0x16e),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x422080[_0x3007c5(0x189)](_0x3007c5(0x193),_0x3007c5(0x16f)),_0x253af1['xlsx'][_0x3007c5(0x148)](_0x422080)['then'](()=>{const _0x4d7bd4=_0x3007c5;_0x422080[_0x4d7bd4(0x1a8)](0xc8);});}catch(_0x3daaf0){_0x422080['status'](0x190)[_0x3007c5(0x146)]({'errors':_0x3daaf0[_0x3007c5(0x14b)]});}});function a0_0x48fb(){const _0x2d9f8b=['name','write','Portuguese','\x20Failed','message','Sale','SalesmanName','SalesmanCode','success','English\x20(US)','../models/all_models','single','findOne','customer_docs','public/Migration/','landline','$amount','originalname','exceljs','Sale\x20Return','sale_return','payment_data','reason','\x20added\x20successfully','SheetNames','aggregate','utils','Portuguese\x20(BR)','/customer/view','9308625tnkVDo','German','customer_payment','language','2310280bxGyDs','multer','findById','Hindi','addWorksheet','/view','Content-Type','attachment;\x20filename=customer_Migration_File.xlsx','element','customer','French','Arabic','360785bQntfN','errors','Chinese','61752DrTOfB','redirect','customer\x20add\x20successfully','customer_product_fule','save','PUnits','readFile','../middleware/auth','/view/:id','Arabic\x20(ae)','sheet_to_json','English','get','Spanish','customer\x20update\x20successfully','receivable','params','file','setHeader','columns','c_payments','find','13339249LgpzPh','93cPoftL','email','PName','render','user','Content-Disposition','contactperson','receivable_sum','json','flash','6911094DLIibX','error','Router','amount','post','customer_data','PBrands','sale','Customers','$reason','Name','Sheets','../public/language/languages.json','mobile','log','22566392NQJzmb','status','address','body','master','send'];a0_0x48fb=function(){return _0x2d9f8b;};return a0_0x48fb();}const storage1=multer['diskStorage']({'destination':(_0x94fc42,_0x46784c,_0x4ce3ba)=>{_0x4ce3ba(null,'public/Migration');},'filename':(_0xbb2c48,_0x532f1f,_0x2c9f7c)=>{const _0x3902a8=a0_0x265922;_0x2c9f7c(null,Date['now']()+_0x532f1f[_0x3902a8(0x158)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x1c17(_0x52094d,_0xb62ae9){const _0x48fbe2=a0_0x48fb();return a0_0x1c17=function(_0x1c1799,_0x5329fb){_0x1c1799=_0x1c1799-0x146;let _0x4bd2f1=_0x48fbe2[_0x1c1799];return _0x4bd2f1;},a0_0x1c17(_0x52094d,_0xb62ae9);}router['post']('/customer_import_migrate_file',auth,uploadMigrate[a0_0x265922(0x152)](a0_0x265922(0x17a)),async(_0x227c2f,_0x35360c)=>{const _0x1ea66a=a0_0x265922,_0x484aba=_0x227c2f[_0x1ea66a(0x188)]['filename'],_0x7046c5=await xlsx[_0x1ea66a(0x17d)](_0x1ea66a(0x155)+_0x484aba);let _0x1b5506=_0x7046c5[_0x1ea66a(0x15f)],_0xc2bb14=xlsx[_0x1ea66a(0x161)][_0x1ea66a(0x181)](_0x7046c5[_0x1ea66a(0x1a3)][_0x1b5506[0x0]]);for(const _0x49d557 of _0xc2bb14){const _0x551546=_0x49d557['ID'],_0x57e5c6=_0x49d557[_0x1ea66a(0x1a2)],_0x1266e7=_0x49d557['SalesmanCode'],_0x5f3abc=_0x49d557['SalesmanName'],_0x1d2802=_0x49d557['address'],_0x1a820d=_0x49d557[_0x1ea66a(0x1a5)],_0x2a5721=_0x49d557[_0x1ea66a(0x18f)];try{let _0x3ecbcf=await customer[_0x1ea66a(0x153)]({'name':_0x57e5c6});if(!_0x3ecbcf){const _0x38f6dd=new customer({'name':_0x57e5c6,'ID':_0x551546,'SalesmanCode':_0x1266e7,'SalesmanName':_0x5f3abc,'address':_0x1d2802,'mobile':_0x1a820d,'email':_0x2a5721});_0x3ecbcf=await _0x38f6dd['save'](),_0x227c2f['flash'](_0x1ea66a(0x14f),_0x57e5c6+_0x1ea66a(0x15e));}else _0x227c2f[_0x1ea66a(0x197)](_0x1ea66a(0x199),_0x57e5c6+_0x1ea66a(0x14a));}catch(_0x4fbebb){_0x35360c['status'](0x1f4)[_0x1ea66a(0x196)]({'proderror':_0x4fbebb[_0x1ea66a(0x14b)],'aproduct':ProductName});}}_0x35360c[_0x1ea66a(0x178)](_0x1ea66a(0x163));}),module['exports']=router;