const a0_0x258b95=a0_0x521c;(function(_0x5580d1,_0x5c9794){const _0x55c6de=a0_0x521c,_0x14ef61=_0x5580d1();while(!![]){try{const _0x4d17a1=-parseInt(_0x55c6de(0x75))/0x1*(-parseInt(_0x55c6de(0xc0))/0x2)+-parseInt(_0x55c6de(0xaf))/0x3*(parseInt(_0x55c6de(0xb3))/0x4)+parseInt(_0x55c6de(0xc6))/0x5+-parseInt(_0x55c6de(0xc2))/0x6+parseInt(_0x55c6de(0xb7))/0x7*(parseInt(_0x55c6de(0x89))/0x8)+parseInt(_0x55c6de(0x84))/0x9*(parseInt(_0x55c6de(0x87))/0xa)+-parseInt(_0x55c6de(0x8e))/0xb*(parseInt(_0x55c6de(0x90))/0xc);if(_0x4d17a1===_0x5c9794)break;else _0x14ef61['push'](_0x14ef61['shift']());}catch(_0x574212){_0x14ef61['push'](_0x14ef61['shift']());}}}(a0_0x37ea,0x7ceea));function a0_0x37ea(){const _0x4a09d3=['Content-Type','French','message','Sheets','status','then','customer_data','columns','payment_data','exports','flash','landline','payable','customer_product_fule','reason','c_payments','Name','file','Router','params','/customer_import_migrate_file','321FCwNjJ','success','Sale','Spanish','34520CmhjyU','now','/view/payment/:id','render','7pKgYNg','sale_return','PUnits','write','user','$amount','save','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','PName','2azmdBQ','customer','4979256tBgSwT','log','/view/:id','diskStorage','1353635OVZpRk','/view','$reason','Hindi','findOne','German','/products_export_migrate_file','Chinese','findById','single','address','English\x20(US)','../middleware/auth','customer_docs','map','sheet_to_json','get','post','data','PBrands','name','mobile','\x20Failed','\x20added\x20successfully','setHeader','multer','718303Whqyqc','sale','public/Migration','Content-Disposition','master','errors','email','aggregate','readFile','customer\x20update\x20successfully','Sale\x20Return','customer\x20add\x20successfully','find','SheetNames','SalesmanName','18jZfjak','payable_sum','xlsx','3319090BzGFdJ','utils','8000648eBkWqI','customer_payment','language','exceljs','SalesmanCode','1422377JSwwtf','/customer/view','36rgDski','Portuguese','originalname','English','addWorksheet','Arabic\x20(ae)','redirect','Portuguese\x20(BR)','body','Arabic'];a0_0x37ea=function(){return _0x4a09d3;};return a0_0x37ea();}const express=require('express'),app=express(),router=express[a0_0x258b95(0xac)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x258b95(0xd2)),users=require('../public/language/languages.json'),excelJS=require(a0_0x258b95(0x8c)),xlsx=require(a0_0x258b95(0x86)),multer=require(a0_0x258b95(0x74));function a0_0x521c(_0x46a04b,_0x58e5cb){const _0x37ea59=a0_0x37ea();return a0_0x521c=function(_0x521c4e,_0x1b9ac5){_0x521c4e=_0x521c4e-0x6e;let _0x57bc7c=_0x37ea59[_0x521c4e];return _0x57bc7c;},a0_0x521c(_0x46a04b,_0x58e5cb);}router[a0_0x258b95(0xd6)](a0_0x258b95(0xc7),auth,async(_0x595a3d,_0x58d6d6)=>{const _0x33fd6f=a0_0x258b95;try{const {username:_0x370357,email:_0x5dfe18,role:_0x1a382e}=_0x595a3d[_0x33fd6f(0xbb)],_0x33550e=_0x595a3d['user'],_0x31d30c=await profile[_0x33fd6f(0xca)]({'email':_0x33550e['email']}),_0x35f4d7=await master_shop['find']();console[_0x33fd6f(0xc3)](_0x33fd6f(0x79),_0x35f4d7);const _0x218cc7=await customer[_0x33fd6f(0x81)](),_0xdbad73=await customer[_0x33fd6f(0x7c)]([{'$lookup':{'from':_0x33fd6f(0xa9),'localField':_0x33fd6f(0x6f),'foreignField':_0x33fd6f(0xc1),'as':_0x33fd6f(0xd3)}}]);console[_0x33fd6f(0xc3)](_0xdbad73);const _0x4b1919=_0xdbad73[_0x33fd6f(0xd4)](_0x198a36=>{const _0x3e2264=_0x33fd6f;console[_0x3e2264(0xc3)](_0x3e2264(0xd8),_0x198a36);var _0x312c3f=0x0,_0x4da481=0x0;return _0x198a36['customer_docs']['forEach'](_0x54ac61=>{const _0x5d7773=_0x3e2264;console[_0x5d7773(0xc3)]('element',_0x54ac61),_0x54ac61[_0x5d7773(0xa8)]==_0x5d7773(0xb1)?_0x312c3f+=_0x54ac61['amount']:_0x4da481+=_0x54ac61['amount'];}),_0x198a36[_0x3e2264(0x76)]=parseFloat(_0x312c3f)+0x0,_0x198a36[_0x3e2264(0xb8)]=parseFloat(_0x4da481)+0x0,_0x198a36;});console[_0x33fd6f(0xc3)](_0x33fd6f(0xa2),_0x4b1919);if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]=='English\x20(US)'){var _0xf427ab=users[_0x33fd6f(0x93)];console[_0x33fd6f(0xc3)](_0xf427ab);}else{if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]==_0x33fd6f(0xc9))var _0xf427ab=users[_0x33fd6f(0xc9)];else{if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]=='German')var _0xf427ab=users['German'];else{if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]==_0x33fd6f(0xb2))var _0xf427ab=users[_0x33fd6f(0xb2)];else{if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]==_0x33fd6f(0x9b))var _0xf427ab=users[_0x33fd6f(0x9b)];else{if(_0x35f4d7[0x0]['language']=='Portuguese\x20(BR)')var _0xf427ab=users['Portuguese'];else{if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]==_0x33fd6f(0xcd))var _0xf427ab=users[_0x33fd6f(0xcd)];else{if(_0x35f4d7[0x0][_0x33fd6f(0x8b)]=='Arabic\x20(ae)')var _0xf427ab=users[_0x33fd6f(0x99)];}}}}}}}_0x58d6d6[_0x33fd6f(0xb6)](_0x33fd6f(0xc1),{'success':_0x595a3d['flash']('success'),'errors':_0x595a3d[_0x33fd6f(0xa4)](_0x33fd6f(0x7a)),'user':_0x218cc7,'role':_0x33550e,'profile':_0x31d30c,'payment':_0x4b1919,'master_shop':_0x35f4d7,'language':_0xf427ab});}catch(_0x305972){console['log'](_0x305972);}}),router[a0_0x258b95(0xd7)](a0_0x258b95(0xc7),auth,async(_0x26e945,_0x48b41d)=>{const _0x2c72a9=a0_0x258b95;try{const {name:_0x31ca30,address:_0x57fe9e,mobile:_0x30705e,email:_0x3d0914,receivable:_0x2ce55e,payable:_0x1a2a1c,contactperson:_0x64d64,landline:_0x1701ec}=_0x26e945[_0x2c72a9(0x98)],_0x31fab5=new customer({'name':_0x31ca30,'address':_0x57fe9e,'mobile':_0x30705e,'email':_0x3d0914,'receivable':_0x2ce55e,'payable':_0x1a2a1c,'contactperson':_0x64d64,'landline':_0x1701ec}),_0x158404=await _0x31fab5[_0x2c72a9(0xbd)]();_0x26e945['flash'](_0x2c72a9(0xb0),_0x2c72a9(0x80)),_0x48b41d[_0x2c72a9(0x96)]('/customer/view');}catch(_0x40143b){console[_0x2c72a9(0xc3)](_0x40143b);}}),router[a0_0x258b95(0xd6)]('/view/:id',auth,async(_0x1d6a00,_0x3cbdce)=>{const _0x17cd44=a0_0x258b95;try{const {username:_0x44e973,email:_0x525de6,role:_0x303a50}=_0x1d6a00[_0x17cd44(0xbb)],_0x3beb6f=_0x1d6a00[_0x17cd44(0xbb)],_0x5a52c8=await profile[_0x17cd44(0xca)]({'email':_0x3beb6f[_0x17cd44(0x7b)]}),_0x767fd7=await master_shop[_0x17cd44(0x81)]();console[_0x17cd44(0xc3)](_0x17cd44(0x79),_0x767fd7);const _0x5dc0ee=_0x1d6a00[_0x17cd44(0xad)]['id'],_0x5a945f=await customer[_0x17cd44(0xce)](_0x5dc0ee);if(_0x767fd7[0x0]['language']==_0x17cd44(0xd1)){var _0x557ec2=users[_0x17cd44(0x93)];console[_0x17cd44(0xc3)](_0x557ec2);}else{if(_0x767fd7[0x0]['language']==_0x17cd44(0xc9))var _0x557ec2=users[_0x17cd44(0xc9)];else{if(_0x767fd7[0x0]['language']=='German')var _0x557ec2=users[_0x17cd44(0xcb)];else{if(_0x767fd7[0x0][_0x17cd44(0x8b)]==_0x17cd44(0xb2))var _0x557ec2=users[_0x17cd44(0xb2)];else{if(_0x767fd7[0x0][_0x17cd44(0x8b)]=='French')var _0x557ec2=users[_0x17cd44(0x9b)];else{if(_0x767fd7[0x0][_0x17cd44(0x8b)]=='Portuguese\x20(BR)')var _0x557ec2=users[_0x17cd44(0x91)];else{if(_0x767fd7[0x0]['language']==_0x17cd44(0xcd))var _0x557ec2=users[_0x17cd44(0xcd)];else{if(_0x767fd7[0x0][_0x17cd44(0x8b)]=='Arabic\x20(ae)')var _0x557ec2=users['Arabic'];}}}}}}}_0x3cbdce['render'](_0x17cd44(0xc1),{'success':_0x1d6a00['flash'](_0x17cd44(0xb0)),'errors':_0x1d6a00[_0x17cd44(0xa4)]('errors'),'role':_0x3beb6f,'profile':_0x5a52c8,'user':_0x5a945f,'master_shop':_0x767fd7,'language':_0x557ec2});}catch(_0x34e418){console[_0x17cd44(0xc3)](_0x34e418);}}),router[a0_0x258b95(0xd7)](a0_0x258b95(0xc4),auth,async(_0x38e85e,_0x9a465f)=>{const _0x471819=a0_0x258b95;try{const _0x3191bc=_0x38e85e[_0x471819(0xad)]['id'],_0x5d1a1a=await customer['findById'](_0x3191bc),{name:_0x2f9a6b,address:_0x273fc8,mobile:_0x5e8b5b,email:_0x5760e3,receivable:_0x30695e,payable:_0x460b2f,contactperson:_0x3b9746,landline:_0x162985}=_0x38e85e[_0x471819(0x98)];_0x5d1a1a[_0x471819(0x6f)]=_0x2f9a6b,_0x5d1a1a[_0x471819(0xd0)]=_0x273fc8,_0x5d1a1a[_0x471819(0x70)]=_0x5e8b5b,_0x5d1a1a[_0x471819(0x7b)]=_0x5760e3,_0x5d1a1a['receivable']=_0x30695e,_0x5d1a1a[_0x471819(0xa6)]=_0x460b2f,_0x5d1a1a['contactperson']=_0x3b9746,_0x5d1a1a[_0x471819(0xa5)]=_0x162985;const _0x4ca175=await _0x5d1a1a['save']();_0x38e85e[_0x471819(0xa4)](_0x471819(0xb0),_0x471819(0x7e)),_0x9a465f[_0x471819(0x96)]('/customer/view');}catch(_0x39bb35){console[_0x471819(0xc3)](_0x39bb35);}}),router[a0_0x258b95(0xd6)](a0_0x258b95(0xb5),auth,async(_0x674557,_0x394e65)=>{const _0x49848e=a0_0x258b95;try{const {username:_0x286b72,email:_0x421104,role:_0x34ff29}=_0x674557[_0x49848e(0xbb)],_0x2114a4=_0x674557['user'],_0x673e38=await profile[_0x49848e(0xca)]({'email':_0x2114a4[_0x49848e(0x7b)]}),_0x338e34=await master_shop[_0x49848e(0x81)]();console[_0x49848e(0xc3)]('master',_0x338e34),console[_0x49848e(0xc3)](_0x674557[_0x49848e(0xad)]['id']);const _0x49ed73=await customer[_0x49848e(0xca)]({'_id':_0x674557[_0x49848e(0xad)]['id']});console[_0x49848e(0xc3)](_0x49848e(0xa0),_0x49ed73);const _0x4e16d5=await c_payment_data[_0x49848e(0x81)]({'customer':_0x49ed73[_0x49848e(0x6f)]});console[_0x49848e(0xc3)](_0x4e16d5);const _0x4f44d5=await c_payment_data[_0x49848e(0x7c)]([{'$match':{'customer':_0x49ed73[_0x49848e(0x6f)]}},{'$match':{'reason':_0x49848e(0xb1)}},{'$group':{'_id':_0x49848e(0xc8),'sum':{'$sum':_0x49848e(0xbc)}}}]);console[_0x49848e(0xc3)](_0x49848e(0x85),_0x4f44d5);const _0x5d6a86=await c_payment_data[_0x49848e(0x7c)]([{'$match':{'customer':_0x49ed73[_0x49848e(0x6f)]}},{'$match':{'reason':_0x49848e(0x7f)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x49848e(0xbc)}}}]);console[_0x49848e(0xc3)]('receivable_sum',_0x5d6a86);if(_0x338e34[0x0][_0x49848e(0x8b)]=='English\x20(US)'){var _0x3dd7a4=users[_0x49848e(0x93)];console[_0x49848e(0xc3)](_0x3dd7a4);}else{if(_0x338e34[0x0][_0x49848e(0x8b)]=='Hindi')var _0x3dd7a4=users[_0x49848e(0xc9)];else{if(_0x338e34[0x0][_0x49848e(0x8b)]==_0x49848e(0xcb))var _0x3dd7a4=users['German'];else{if(_0x338e34[0x0][_0x49848e(0x8b)]=='Spanish')var _0x3dd7a4=users[_0x49848e(0xb2)];else{if(_0x338e34[0x0][_0x49848e(0x8b)]=='French')var _0x3dd7a4=users[_0x49848e(0x9b)];else{if(_0x338e34[0x0][_0x49848e(0x8b)]==_0x49848e(0x97))var _0x3dd7a4=users[_0x49848e(0x91)];else{if(_0x338e34[0x0][_0x49848e(0x8b)]==_0x49848e(0xcd))var _0x3dd7a4=users[_0x49848e(0xcd)];else{if(_0x338e34[0x0][_0x49848e(0x8b)]==_0x49848e(0x95))var _0x3dd7a4=users[_0x49848e(0x99)];}}}}}}}_0x394e65['render'](_0x49848e(0x8a),{'success':_0x674557[_0x49848e(0xa4)]('success'),'errors':_0x674557[_0x49848e(0xa4)](_0x49848e(0x7a)),'role':_0x2114a4,'profile':_0x673e38,'payment':_0x4e16d5,'payable':_0x4f44d5,'receivable':_0x5d6a86,'master_shop':_0x338e34,'language':_0x3dd7a4});}catch(_0xa3bd48){console['log'](_0xa3bd48);}}),router[a0_0x258b95(0xd6)](a0_0x258b95(0xcc),auth,async(_0x2be98a,_0x79576)=>{const _0x144a27=a0_0x258b95;try{const _0x18215c=new excelJS['Workbook'](),_0x55ea79=_0x18215c[_0x144a27(0x94)]('Customers');return _0x55ea79[_0x144a27(0xa1)]=[{'header':'ID','key':_0x144a27(0xbf),'width':0xa},{'header':'Name','key':_0x144a27(0x6e),'width':0xa},{'header':_0x144a27(0x8d),'key':_0x144a27(0xb9),'width':0xa},{'header':_0x144a27(0x83),'key':_0x144a27(0x83),'width':0xa},{'header':_0x144a27(0xd0),'key':_0x144a27(0xd0),'width':0xa},{'header':_0x144a27(0x70),'key':_0x144a27(0x70),'width':0xa},{'header':_0x144a27(0x7b),'key':'email','width':0xa}],_0x79576['setHeader'](_0x144a27(0x9a),_0x144a27(0xbe)),_0x79576[_0x144a27(0x73)](_0x144a27(0x78),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x18215c[_0x144a27(0x86)][_0x144a27(0xba)](_0x79576)[_0x144a27(0x9f)](()=>{_0x79576['status'](0xc8);});}catch(_0x38a90f){_0x79576[_0x144a27(0x9e)](0x190)['send']({'errors':_0x38a90f['message']});}});const storage1=multer[a0_0x258b95(0xc5)]({'destination':(_0x4dd1cf,_0x505f0e,_0x3a89ae)=>{const _0x5b1a42=a0_0x258b95;_0x3a89ae(null,_0x5b1a42(0x77));},'filename':(_0x4c7f8b,_0x136432,_0x160d5b)=>{const _0x217db3=a0_0x258b95;_0x160d5b(null,Date[_0x217db3(0xb4)]()+_0x136432[_0x217db3(0x92)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x258b95(0xd7)](a0_0x258b95(0xae),auth,uploadMigrate[a0_0x258b95(0xcf)](a0_0x258b95(0xa7)),async(_0x3f6679,_0x3acfbe)=>{const _0x135bb2=a0_0x258b95,_0x2ff579=_0x3f6679[_0x135bb2(0xab)]['filename'],_0x26c385=await xlsx[_0x135bb2(0x7d)]('public/Migration/'+_0x2ff579);let _0x429bd2=_0x26c385[_0x135bb2(0x82)],_0x5378e0=xlsx[_0x135bb2(0x88)][_0x135bb2(0xd5)](_0x26c385[_0x135bb2(0x9d)][_0x429bd2[0x0]]);for(const _0x618373 of _0x5378e0){const _0x3237e6=_0x618373['ID'],_0x497eea=_0x618373[_0x135bb2(0xaa)],_0x1f6d24=_0x618373['SalesmanCode'],_0x132750=_0x618373[_0x135bb2(0x83)],_0x7be3cd=_0x618373[_0x135bb2(0xd0)],_0x1330c4=_0x618373['mobile'],_0x207af9=_0x618373[_0x135bb2(0x7b)];try{let _0x5e79da=await customer[_0x135bb2(0xca)]({'name':_0x497eea});if(!_0x5e79da){const _0x5a3d15=new customer({'name':_0x497eea,'ID':_0x3237e6,'SalesmanCode':_0x1f6d24,'SalesmanName':_0x132750,'address':_0x7be3cd,'mobile':_0x1330c4,'email':_0x207af9});_0x5e79da=await _0x5a3d15['save'](),_0x3f6679[_0x135bb2(0xa4)]('success',_0x497eea+_0x135bb2(0x72));}else _0x3f6679[_0x135bb2(0xa4)]('error',_0x497eea+_0x135bb2(0x71));}catch(_0x4022bc){_0x3acfbe['status'](0x1f4)['json']({'proderror':_0x4022bc[_0x135bb2(0x9c)],'aproduct':ProductName});}}_0x3acfbe['redirect'](_0x135bb2(0x8f));}),module[a0_0x258b95(0xa3)]=router;