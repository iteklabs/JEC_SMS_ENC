const a0_0x31fb50=a0_0x392c;(function(_0x518160,_0x2e93df){const _0x59d6a8=a0_0x392c,_0x4dbd6a=_0x518160();while(!![]){try{const _0x4a3a32=parseInt(_0x59d6a8(0x181))/0x1*(-parseInt(_0x59d6a8(0x142))/0x2)+-parseInt(_0x59d6a8(0x152))/0x3*(parseInt(_0x59d6a8(0x190))/0x4)+-parseInt(_0x59d6a8(0x13d))/0x5*(-parseInt(_0x59d6a8(0x173))/0x6)+parseInt(_0x59d6a8(0x168))/0x7*(-parseInt(_0x59d6a8(0x143))/0x8)+parseInt(_0x59d6a8(0x17c))/0x9+parseInt(_0x59d6a8(0x137))/0xa+parseInt(_0x59d6a8(0x195))/0xb;if(_0x4a3a32===_0x2e93df)break;else _0x4dbd6a['push'](_0x4dbd6a['shift']());}catch(_0x3632bd){_0x4dbd6a['push'](_0x4dbd6a['shift']());}}}(a0_0x4d92,0x746c5));function a0_0x392c(_0x2c3d6b,_0x3464e4){const _0x4d9288=a0_0x4d92();return a0_0x392c=function(_0x392c23,_0x580be9){_0x392c23=_0x392c23-0x130;let _0x551962=_0x4d9288[_0x392c23];return _0x551962;},a0_0x392c(_0x2c3d6b,_0x3464e4);}const express=require(a0_0x31fb50(0x13a)),app=express(),router=express[a0_0x31fb50(0x130)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x31fb50(0x175)),auth=require(a0_0x31fb50(0x14e)),users=require(a0_0x31fb50(0x184)),excelJS=require(a0_0x31fb50(0x199)),xlsx=require(a0_0x31fb50(0x194)),multer=require(a0_0x31fb50(0x172));function a0_0x4d92(){const _0x5ea4f9=['11179971kKZXwx','attachment;\x20filename=customer_Migration_File.xlsx','filename','Customers','exceljs','customer_data','SalesmanCode','Router','find','params','landline','Chinese','Sale','customer\x20update\x20successfully','1013090TfRSYm','addWorksheet','save','express','PBrands','status','5870TvBbvf','render','receivable','Arabic\x20(ae)','receivable_sum','4BCFrCZ','112vkLrYc','findOne','payment_data','sheet_to_json','Name','aggregate','mobile','Sheets','reason','customer_docs','\x20Failed','../middleware/auth','$amount','\x20added\x20successfully','Workbook','107979gZZmNb','SalesmanName','log','user','PName','Content-Type','element','findById','Arabic','Hindi','master','post','language','/products_export_migrate_file','message','body','write','address','amount','/view','German','setHeader','399042whsrjJ','English\x20(US)','utils','columns','data','/customer_import_migrate_file','errors','originalname','c_payments','name','multer','3102KjlePq','customer','../models/all_models','customer_product_fule','customer\x20add\x20successfully','send','French','public/Migration','$reason','4311162lxzDtA','/view/payment/:id','SheetNames','redirect','now','14434gaLDSk','readFile','email','../public/language/languages.json','Spanish','Portuguese','English','error','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','success','/view/:id','Portuguese\x20(BR)','/customer/view','json','get','100nYqdhR','file','diskStorage','flash','xlsx'];a0_0x4d92=function(){return _0x5ea4f9;};return a0_0x4d92();}router[a0_0x31fb50(0x18f)](a0_0x31fb50(0x165),auth,async(_0xf32835,_0x591618)=>{const _0x10333b=a0_0x31fb50;try{const {username:_0x1b0679,email:_0x2e883a,role:_0x352655}=_0xf32835['user'],_0xed4d11=_0xf32835[_0x10333b(0x155)],_0x302944=await profile[_0x10333b(0x144)]({'email':_0xed4d11[_0x10333b(0x183)]}),_0x2bc73a=await master_shop[_0x10333b(0x131)]();console['log'](_0x10333b(0x15c),_0x2bc73a);const _0x5dc126=await customer[_0x10333b(0x131)](),_0x325ff4=await customer[_0x10333b(0x148)]([{'$lookup':{'from':_0x10333b(0x170),'localField':_0x10333b(0x171),'foreignField':_0x10333b(0x174),'as':_0x10333b(0x14c)}}]);console[_0x10333b(0x154)](_0x325ff4);const _0x9c90ac=_0x325ff4['map'](_0x4fe415=>{const _0x461075=_0x10333b;console[_0x461075(0x154)](_0x461075(0x16c),_0x4fe415);var _0x24082c=0x0,_0x5f0bed=0x0;return _0x4fe415[_0x461075(0x14c)]['forEach'](_0x58b0f0=>{const _0x238064=_0x461075;console[_0x238064(0x154)](_0x238064(0x158),_0x58b0f0),_0x58b0f0[_0x238064(0x14b)]=='Sale'?_0x24082c+=_0x58b0f0['amount']:_0x5f0bed+=_0x58b0f0[_0x238064(0x164)];}),_0x4fe415['sale']=parseFloat(_0x24082c)+0x0,_0x4fe415['sale_return']=parseFloat(_0x5f0bed)+0x0,_0x4fe415;});console[_0x10333b(0x154)](_0x10333b(0x145),_0x9c90ac);if(_0x2bc73a[0x0]['language']==_0x10333b(0x169)){var _0x44917a=users['English'];console[_0x10333b(0x154)](_0x44917a);}else{if(_0x2bc73a[0x0]['language']=='Hindi')var _0x44917a=users[_0x10333b(0x15b)];else{if(_0x2bc73a[0x0][_0x10333b(0x15e)]==_0x10333b(0x166))var _0x44917a=users[_0x10333b(0x166)];else{if(_0x2bc73a[0x0][_0x10333b(0x15e)]==_0x10333b(0x185))var _0x44917a=users[_0x10333b(0x185)];else{if(_0x2bc73a[0x0][_0x10333b(0x15e)]==_0x10333b(0x179))var _0x44917a=users[_0x10333b(0x179)];else{if(_0x2bc73a[0x0][_0x10333b(0x15e)]==_0x10333b(0x18c))var _0x44917a=users[_0x10333b(0x186)];else{if(_0x2bc73a[0x0][_0x10333b(0x15e)]==_0x10333b(0x134))var _0x44917a=users['Chinese'];else{if(_0x2bc73a[0x0][_0x10333b(0x15e)]==_0x10333b(0x140))var _0x44917a=users[_0x10333b(0x15a)];}}}}}}}_0x591618[_0x10333b(0x13e)](_0x10333b(0x174),{'success':_0xf32835[_0x10333b(0x193)](_0x10333b(0x18a)),'errors':_0xf32835[_0x10333b(0x193)](_0x10333b(0x16e)),'user':_0x5dc126,'role':_0xed4d11,'profile':_0x302944,'payment':_0x9c90ac,'master_shop':_0x2bc73a,'language':_0x44917a});}catch(_0x527ec3){console['log'](_0x527ec3);}}),router[a0_0x31fb50(0x15d)](a0_0x31fb50(0x165),auth,async(_0x2eb0fa,_0x32b6a2)=>{const _0x521dc3=a0_0x31fb50;try{const {name:_0x5a2022,address:_0x531a39,mobile:_0x379ec3,email:_0x10dd5c,receivable:_0x49807a,payable:_0x18775e,contactperson:_0x4fa4a0,landline:_0x2e0f4e}=_0x2eb0fa[_0x521dc3(0x161)],_0x4ffc29=new customer({'name':_0x5a2022,'address':_0x531a39,'mobile':_0x379ec3,'email':_0x10dd5c,'receivable':_0x49807a,'payable':_0x18775e,'contactperson':_0x4fa4a0,'landline':_0x2e0f4e}),_0x53f6c5=await _0x4ffc29['save']();_0x2eb0fa['flash'](_0x521dc3(0x18a),_0x521dc3(0x177)),_0x32b6a2[_0x521dc3(0x17f)](_0x521dc3(0x18d));}catch(_0x5e05ad){console['log'](_0x5e05ad);}}),router[a0_0x31fb50(0x18f)](a0_0x31fb50(0x18b),auth,async(_0x3429cf,_0x38da8d)=>{const _0x3726e3=a0_0x31fb50;try{const {username:_0x9544dd,email:_0x5a9631,role:_0x47f251}=_0x3429cf[_0x3726e3(0x155)],_0x3693fa=_0x3429cf['user'],_0xf1b2f8=await profile[_0x3726e3(0x144)]({'email':_0x3693fa[_0x3726e3(0x183)]}),_0x55e4db=await master_shop[_0x3726e3(0x131)]();console[_0x3726e3(0x154)]('master',_0x55e4db);const _0x246638=_0x3429cf[_0x3726e3(0x132)]['id'],_0x24474a=await customer[_0x3726e3(0x159)](_0x246638);if(_0x55e4db[0x0][_0x3726e3(0x15e)]==_0x3726e3(0x169)){var _0xecb51d=users[_0x3726e3(0x187)];console['log'](_0xecb51d);}else{if(_0x55e4db[0x0][_0x3726e3(0x15e)]==_0x3726e3(0x15b))var _0xecb51d=users[_0x3726e3(0x15b)];else{if(_0x55e4db[0x0][_0x3726e3(0x15e)]=='German')var _0xecb51d=users['German'];else{if(_0x55e4db[0x0][_0x3726e3(0x15e)]==_0x3726e3(0x185))var _0xecb51d=users['Spanish'];else{if(_0x55e4db[0x0][_0x3726e3(0x15e)]==_0x3726e3(0x179))var _0xecb51d=users[_0x3726e3(0x179)];else{if(_0x55e4db[0x0][_0x3726e3(0x15e)]==_0x3726e3(0x18c))var _0xecb51d=users[_0x3726e3(0x186)];else{if(_0x55e4db[0x0]['language']==_0x3726e3(0x134))var _0xecb51d=users[_0x3726e3(0x134)];else{if(_0x55e4db[0x0][_0x3726e3(0x15e)]==_0x3726e3(0x140))var _0xecb51d=users[_0x3726e3(0x15a)];}}}}}}}_0x38da8d[_0x3726e3(0x13e)]('customer',{'success':_0x3429cf[_0x3726e3(0x193)]('success'),'errors':_0x3429cf['flash'](_0x3726e3(0x16e)),'role':_0x3693fa,'profile':_0xf1b2f8,'user':_0x24474a,'master_shop':_0x55e4db,'language':_0xecb51d});}catch(_0x1d7138){console['log'](_0x1d7138);}}),router[a0_0x31fb50(0x15d)](a0_0x31fb50(0x18b),auth,async(_0x587587,_0x58834f)=>{const _0x1da650=a0_0x31fb50;try{const _0x5ec693=_0x587587[_0x1da650(0x132)]['id'],_0x592d15=await customer[_0x1da650(0x159)](_0x5ec693),{name:_0x4d2d39,address:_0x429605,mobile:_0x2c22ee,email:_0x33c630,receivable:_0x14fc69,payable:_0x47a923,contactperson:_0x33fc2f,landline:_0x10961c}=_0x587587['body'];_0x592d15[_0x1da650(0x171)]=_0x4d2d39,_0x592d15[_0x1da650(0x163)]=_0x429605,_0x592d15[_0x1da650(0x149)]=_0x2c22ee,_0x592d15['email']=_0x33c630,_0x592d15[_0x1da650(0x13f)]=_0x14fc69,_0x592d15['payable']=_0x47a923,_0x592d15['contactperson']=_0x33fc2f,_0x592d15[_0x1da650(0x133)]=_0x10961c;const _0x48d9e1=await _0x592d15[_0x1da650(0x139)]();_0x587587[_0x1da650(0x193)](_0x1da650(0x18a),_0x1da650(0x136)),_0x58834f[_0x1da650(0x17f)](_0x1da650(0x18d));}catch(_0x5cdc9e){console[_0x1da650(0x154)](_0x5cdc9e);}}),router[a0_0x31fb50(0x18f)](a0_0x31fb50(0x17d),auth,async(_0x3626fa,_0x47a6e0)=>{const _0x4989aa=a0_0x31fb50;try{const {username:_0x50d9b2,email:_0x19aa76,role:_0x3604cc}=_0x3626fa['user'],_0x2be36a=_0x3626fa['user'],_0x1030de=await profile[_0x4989aa(0x144)]({'email':_0x2be36a[_0x4989aa(0x183)]}),_0x73e19b=await master_shop[_0x4989aa(0x131)]();console['log'](_0x4989aa(0x15c),_0x73e19b),console[_0x4989aa(0x154)](_0x3626fa[_0x4989aa(0x132)]['id']);const _0x3c4b04=await customer[_0x4989aa(0x144)]({'_id':_0x3626fa['params']['id']});console['log'](_0x4989aa(0x19a),_0x3c4b04);const _0x49a5e=await c_payment_data[_0x4989aa(0x131)]({'customer':_0x3c4b04[_0x4989aa(0x171)]});console[_0x4989aa(0x154)](_0x49a5e);const _0x4029e0=await c_payment_data['aggregate']([{'$match':{'customer':_0x3c4b04[_0x4989aa(0x171)]}},{'$match':{'reason':_0x4989aa(0x135)}},{'$group':{'_id':_0x4989aa(0x17b),'sum':{'$sum':_0x4989aa(0x14f)}}}]);console[_0x4989aa(0x154)]('payable_sum',_0x4029e0);const _0x15d419=await c_payment_data['aggregate']([{'$match':{'customer':_0x3c4b04['name']}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x4989aa(0x17b),'sum':{'$sum':_0x4989aa(0x14f)}}}]);console['log'](_0x4989aa(0x141),_0x15d419);if(_0x73e19b[0x0]['language']=='English\x20(US)'){var _0x24c8b7=users[_0x4989aa(0x187)];console[_0x4989aa(0x154)](_0x24c8b7);}else{if(_0x73e19b[0x0][_0x4989aa(0x15e)]==_0x4989aa(0x15b))var _0x24c8b7=users[_0x4989aa(0x15b)];else{if(_0x73e19b[0x0][_0x4989aa(0x15e)]==_0x4989aa(0x166))var _0x24c8b7=users[_0x4989aa(0x166)];else{if(_0x73e19b[0x0]['language']=='Spanish')var _0x24c8b7=users['Spanish'];else{if(_0x73e19b[0x0][_0x4989aa(0x15e)]==_0x4989aa(0x179))var _0x24c8b7=users[_0x4989aa(0x179)];else{if(_0x73e19b[0x0][_0x4989aa(0x15e)]==_0x4989aa(0x18c))var _0x24c8b7=users[_0x4989aa(0x186)];else{if(_0x73e19b[0x0][_0x4989aa(0x15e)]==_0x4989aa(0x134))var _0x24c8b7=users[_0x4989aa(0x134)];else{if(_0x73e19b[0x0][_0x4989aa(0x15e)]==_0x4989aa(0x140))var _0x24c8b7=users[_0x4989aa(0x15a)];}}}}}}}_0x47a6e0[_0x4989aa(0x13e)]('customer_payment',{'success':_0x3626fa[_0x4989aa(0x193)](_0x4989aa(0x18a)),'errors':_0x3626fa[_0x4989aa(0x193)](_0x4989aa(0x16e)),'role':_0x2be36a,'profile':_0x1030de,'payment':_0x49a5e,'payable':_0x4029e0,'receivable':_0x15d419,'master_shop':_0x73e19b,'language':_0x24c8b7});}catch(_0x3ed975){console['log'](_0x3ed975);}}),router['get'](a0_0x31fb50(0x15f),auth,async(_0x11f904,_0x5384b8)=>{const _0x59a4cd=a0_0x31fb50;try{const _0x147bdd=new excelJS[(_0x59a4cd(0x151))](),_0x8e7d82=_0x147bdd[_0x59a4cd(0x138)](_0x59a4cd(0x198));return _0x8e7d82[_0x59a4cd(0x16b)]=[{'header':'ID','key':_0x59a4cd(0x156),'width':0xa},{'header':_0x59a4cd(0x147),'key':_0x59a4cd(0x13b),'width':0xa},{'header':_0x59a4cd(0x19b),'key':'PUnits','width':0xa},{'header':_0x59a4cd(0x153),'key':_0x59a4cd(0x153),'width':0xa},{'header':_0x59a4cd(0x163),'key':_0x59a4cd(0x163),'width':0xa},{'header':_0x59a4cd(0x149),'key':_0x59a4cd(0x149),'width':0xa},{'header':'email','key':'email','width':0xa}],_0x5384b8['setHeader'](_0x59a4cd(0x157),_0x59a4cd(0x189)),_0x5384b8[_0x59a4cd(0x167)]('Content-Disposition',_0x59a4cd(0x196)),_0x147bdd[_0x59a4cd(0x194)][_0x59a4cd(0x162)](_0x5384b8)['then'](()=>{const _0x130655=_0x59a4cd;_0x5384b8[_0x130655(0x13c)](0xc8);});}catch(_0x146150){_0x5384b8['status'](0x190)[_0x59a4cd(0x178)]({'errors':_0x146150['message']});}});const storage1=multer[a0_0x31fb50(0x192)]({'destination':(_0x32c59e,_0x48215d,_0x1c339b)=>{const _0x1d9158=a0_0x31fb50;_0x1c339b(null,_0x1d9158(0x17a));},'filename':(_0x319479,_0x283f88,_0xc5ef78)=>{const _0x398769=a0_0x31fb50;_0xc5ef78(null,Date[_0x398769(0x180)]()+_0x283f88[_0x398769(0x16f)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x31fb50(0x15d)](a0_0x31fb50(0x16d),auth,uploadMigrate['single'](a0_0x31fb50(0x176)),async(_0x5e58ef,_0x5ab5bd)=>{const _0x2eb459=a0_0x31fb50,_0x3ab359=_0x5e58ef[_0x2eb459(0x191)][_0x2eb459(0x197)],_0x3d79a0=await xlsx[_0x2eb459(0x182)]('public/Migration/'+_0x3ab359);let _0x104e98=_0x3d79a0[_0x2eb459(0x17e)],_0x49190f=xlsx[_0x2eb459(0x16a)][_0x2eb459(0x146)](_0x3d79a0[_0x2eb459(0x14a)][_0x104e98[0x0]]);for(const _0x5ed92f of _0x49190f){const _0x54c75a=_0x5ed92f['ID'],_0x39e225=_0x5ed92f['Name'],_0x5966ac=_0x5ed92f['SalesmanCode'],_0x36c18d=_0x5ed92f[_0x2eb459(0x153)],_0x7d48a4=_0x5ed92f[_0x2eb459(0x163)],_0x38f90c=_0x5ed92f[_0x2eb459(0x149)],_0x4f0329=_0x5ed92f[_0x2eb459(0x183)];try{let _0x3872ae=await customer[_0x2eb459(0x144)]({'name':_0x39e225});if(!_0x3872ae){const _0x14c20a=new customer({'name':_0x39e225,'ID':_0x54c75a,'SalesmanCode':_0x5966ac,'SalesmanName':_0x36c18d,'address':_0x7d48a4,'mobile':_0x38f90c,'email':_0x4f0329});_0x3872ae=await _0x14c20a[_0x2eb459(0x139)](),_0x5e58ef[_0x2eb459(0x193)](_0x2eb459(0x18a),_0x39e225+_0x2eb459(0x150));}else _0x5e58ef[_0x2eb459(0x193)](_0x2eb459(0x188),_0x39e225+_0x2eb459(0x14d));}catch(_0x151d48){_0x5ab5bd[_0x2eb459(0x13c)](0x1f4)[_0x2eb459(0x18e)]({'proderror':_0x151d48[_0x2eb459(0x160)],'aproduct':ProductName});}}_0x5ab5bd[_0x2eb459(0x17f)](_0x2eb459(0x18d));}),module['exports']=router;