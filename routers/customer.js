const a0_0x2b00f9=a0_0x4100;(function(_0x288526,_0x22fbad){const _0x5c57f0=a0_0x4100,_0x3975f2=_0x288526();while(!![]){try{const _0x305cd5=-parseInt(_0x5c57f0(0x20f))/0x1+-parseInt(_0x5c57f0(0x1d3))/0x2+-parseInt(_0x5c57f0(0x1dd))/0x3*(-parseInt(_0x5c57f0(0x205))/0x4)+parseInt(_0x5c57f0(0x1d1))/0x5*(-parseInt(_0x5c57f0(0x1d0))/0x6)+parseInt(_0x5c57f0(0x1e5))/0x7*(parseInt(_0x5c57f0(0x1e9))/0x8)+parseInt(_0x5c57f0(0x1c5))/0x9+parseInt(_0x5c57f0(0x1cb))/0xa;if(_0x305cd5===_0x22fbad)break;else _0x3975f2['push'](_0x3975f2['shift']());}catch(_0x13f713){_0x3975f2['push'](_0x3975f2['shift']());}}}(a0_0x51a0,0xacc0f));const express=require(a0_0x2b00f9(0x21f)),app=express(),router=express[a0_0x2b00f9(0x1c6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x2b00f9(0x21a)),auth=require('../middleware/auth'),users=require(a0_0x2b00f9(0x1d6)),excelJS=require('exceljs'),xlsx=require(a0_0x2b00f9(0x21c)),multer=require(a0_0x2b00f9(0x22b));router[a0_0x2b00f9(0x219)](a0_0x2b00f9(0x20a),auth,async(_0x87d673,_0x27554c)=>{const _0x2e6c1e=a0_0x2b00f9;try{const {username:_0x20f26c,email:_0x416dac,role:_0x20b08e}=_0x87d673['user'],_0x58f784=_0x87d673['user'],_0x3973a6=await profile[_0x2e6c1e(0x1ff)]({'email':_0x58f784[_0x2e6c1e(0x21d)]}),_0x35a288=await master_shop['find']();console[_0x2e6c1e(0x1cf)](_0x2e6c1e(0x206),_0x35a288);const _0x34d50d=await customer['find'](),_0x57d852=await customer[_0x2e6c1e(0x224)]([{'$lookup':{'from':_0x2e6c1e(0x1f7),'localField':_0x2e6c1e(0x1f3),'foreignField':_0x2e6c1e(0x225),'as':'customer_docs'}}]);console['log'](_0x57d852);const _0x253dee=_0x57d852[_0x2e6c1e(0x21b)](_0x127a66=>{const _0x23c220=_0x2e6c1e;console[_0x23c220(0x1cf)](_0x23c220(0x221),_0x127a66);var _0x59a141=0x0,_0x29025b=0x0;return _0x127a66['customer_docs']['forEach'](_0x272e14=>{const _0x159ba5=_0x23c220;console[_0x159ba5(0x1cf)](_0x159ba5(0x21e),_0x272e14),_0x272e14[_0x159ba5(0x1f0)]=='Sale'?_0x59a141+=_0x272e14[_0x159ba5(0x1df)]:_0x29025b+=_0x272e14[_0x159ba5(0x1df)];}),_0x127a66[_0x23c220(0x1e8)]=parseFloat(_0x59a141)+0x0,_0x127a66[_0x23c220(0x204)]=parseFloat(_0x29025b)+0x0,_0x127a66;});console['log'](_0x2e6c1e(0x212),_0x253dee);if(_0x35a288[0x0][_0x2e6c1e(0x216)]=='English\x20(US)'){var _0x39a228=users[_0x2e6c1e(0x1f1)];console[_0x2e6c1e(0x1cf)](_0x39a228);}else{if(_0x35a288[0x0][_0x2e6c1e(0x216)]==_0x2e6c1e(0x207))var _0x39a228=users['Hindi'];else{if(_0x35a288[0x0][_0x2e6c1e(0x216)]==_0x2e6c1e(0x1ed))var _0x39a228=users[_0x2e6c1e(0x1ed)];else{if(_0x35a288[0x0]['language']==_0x2e6c1e(0x1ec))var _0x39a228=users[_0x2e6c1e(0x1ec)];else{if(_0x35a288[0x0][_0x2e6c1e(0x216)]==_0x2e6c1e(0x202))var _0x39a228=users['French'];else{if(_0x35a288[0x0][_0x2e6c1e(0x216)]==_0x2e6c1e(0x1e0))var _0x39a228=users['Portuguese'];else{if(_0x35a288[0x0][_0x2e6c1e(0x216)]==_0x2e6c1e(0x1ea))var _0x39a228=users[_0x2e6c1e(0x1ea)];else{if(_0x35a288[0x0]['language']==_0x2e6c1e(0x229))var _0x39a228=users['Arabic'];}}}}}}}_0x27554c[_0x2e6c1e(0x1f9)]('customer',{'success':_0x87d673['flash']('success'),'errors':_0x87d673['flash'](_0x2e6c1e(0x1fb)),'user':_0x34d50d,'role':_0x58f784,'profile':_0x3973a6,'payment':_0x253dee,'master_shop':_0x35a288,'language':_0x39a228});}catch(_0x2a7b00){console[_0x2e6c1e(0x1cf)](_0x2a7b00);}}),router[a0_0x2b00f9(0x1e2)](a0_0x2b00f9(0x20a),auth,async(_0x42ed02,_0x5890a0)=>{const _0x2826c7=a0_0x2b00f9;try{const {name:_0x4ad337,address:_0x57e1d6,mobile:_0x26dd40,email:_0x575451,receivable:_0x8b3323,payable:_0x50b03b,contactperson:_0x25705f,landline:_0x3ec5ee}=_0x42ed02[_0x2826c7(0x1c9)],_0x5e4517=new customer({'name':_0x4ad337,'address':_0x57e1d6,'mobile':_0x26dd40,'email':_0x575451,'receivable':_0x8b3323,'payable':_0x50b03b,'contactperson':_0x25705f,'landline':_0x3ec5ee}),_0x54c728=await _0x5e4517['save']();_0x42ed02['flash'](_0x2826c7(0x1d4),_0x2826c7(0x1e7)),_0x5890a0[_0x2826c7(0x1d7)](_0x2826c7(0x1d5));}catch(_0x53d889){console[_0x2826c7(0x1cf)](_0x53d889);}}),router[a0_0x2b00f9(0x219)](a0_0x2b00f9(0x218),auth,async(_0x200fa0,_0x3eec8f)=>{const _0x307fd0=a0_0x2b00f9;try{const {username:_0x33a5c3,email:_0x430859,role:_0xddf48e}=_0x200fa0[_0x307fd0(0x226)],_0x2efa7e=_0x200fa0['user'],_0x5e7589=await profile[_0x307fd0(0x1ff)]({'email':_0x2efa7e[_0x307fd0(0x21d)]}),_0x27a8bf=await master_shop[_0x307fd0(0x211)]();console['log'](_0x307fd0(0x206),_0x27a8bf);const _0x577b87=_0x200fa0[_0x307fd0(0x220)]['id'],_0x1e56c8=await customer[_0x307fd0(0x1cc)](_0x577b87);if(_0x27a8bf[0x0]['language']=='English\x20(US)'){var _0x5de911=users[_0x307fd0(0x1f1)];console[_0x307fd0(0x1cf)](_0x5de911);}else{if(_0x27a8bf[0x0]['language']==_0x307fd0(0x207))var _0x5de911=users[_0x307fd0(0x207)];else{if(_0x27a8bf[0x0]['language']==_0x307fd0(0x1ed))var _0x5de911=users['German'];else{if(_0x27a8bf[0x0][_0x307fd0(0x216)]=='Spanish')var _0x5de911=users[_0x307fd0(0x1ec)];else{if(_0x27a8bf[0x0][_0x307fd0(0x216)]==_0x307fd0(0x202))var _0x5de911=users['French'];else{if(_0x27a8bf[0x0][_0x307fd0(0x216)]==_0x307fd0(0x1e0))var _0x5de911=users[_0x307fd0(0x1e3)];else{if(_0x27a8bf[0x0]['language']=='Chinese')var _0x5de911=users[_0x307fd0(0x1ea)];else{if(_0x27a8bf[0x0]['language']==_0x307fd0(0x229))var _0x5de911=users[_0x307fd0(0x215)];}}}}}}}_0x3eec8f[_0x307fd0(0x1f9)](_0x307fd0(0x225),{'success':_0x200fa0['flash'](_0x307fd0(0x1d4)),'errors':_0x200fa0['flash']('errors'),'role':_0x2efa7e,'profile':_0x5e7589,'user':_0x1e56c8,'master_shop':_0x27a8bf,'language':_0x5de911});}catch(_0x5e6b0e){console[_0x307fd0(0x1cf)](_0x5e6b0e);}}),router[a0_0x2b00f9(0x1e2)](a0_0x2b00f9(0x218),auth,async(_0x54fd43,_0x25e03c)=>{const _0x1a3e15=a0_0x2b00f9;try{const _0x26fe81=_0x54fd43[_0x1a3e15(0x220)]['id'],_0x45c732=await customer[_0x1a3e15(0x1cc)](_0x26fe81),{name:_0x41c32a,address:_0x17ed81,mobile:_0xc763a1,email:_0x177dbb,receivable:_0x491db2,payable:_0x26a0cb,contactperson:_0x1ffd77,landline:_0x337d63}=_0x54fd43[_0x1a3e15(0x1c9)];_0x45c732[_0x1a3e15(0x1f3)]=_0x41c32a,_0x45c732[_0x1a3e15(0x1dc)]=_0x17ed81,_0x45c732[_0x1a3e15(0x203)]=_0xc763a1,_0x45c732[_0x1a3e15(0x21d)]=_0x177dbb,_0x45c732[_0x1a3e15(0x1fc)]=_0x491db2,_0x45c732[_0x1a3e15(0x1d2)]=_0x26a0cb,_0x45c732[_0x1a3e15(0x201)]=_0x1ffd77,_0x45c732[_0x1a3e15(0x1f4)]=_0x337d63;const _0x399b6b=await _0x45c732[_0x1a3e15(0x213)]();_0x54fd43[_0x1a3e15(0x1f5)](_0x1a3e15(0x1d4),'customer\x20update\x20successfully'),_0x25e03c[_0x1a3e15(0x1d7)](_0x1a3e15(0x1d5));}catch(_0x5a4a7a){console['log'](_0x5a4a7a);}}),router[a0_0x2b00f9(0x219)](a0_0x2b00f9(0x1db),auth,async(_0x492624,_0x5efe1b)=>{const _0x2ab118=a0_0x2b00f9;try{const {username:_0x734100,email:_0x2c48a7,role:_0x9e1920}=_0x492624[_0x2ab118(0x226)],_0x43c932=_0x492624['user'],_0x36c82b=await profile[_0x2ab118(0x1ff)]({'email':_0x43c932[_0x2ab118(0x21d)]}),_0x437bbc=await master_shop[_0x2ab118(0x211)]();console[_0x2ab118(0x1cf)](_0x2ab118(0x206),_0x437bbc),console[_0x2ab118(0x1cf)](_0x492624[_0x2ab118(0x220)]['id']);const _0x20a2b7=await customer[_0x2ab118(0x1ff)]({'_id':_0x492624[_0x2ab118(0x220)]['id']});console[_0x2ab118(0x1cf)](_0x2ab118(0x214),_0x20a2b7);const _0x4a61b4=await c_payment_data[_0x2ab118(0x211)]({'customer':_0x20a2b7['name']});console['log'](_0x4a61b4);const _0x2940a6=await c_payment_data[_0x2ab118(0x224)]([{'$match':{'customer':_0x20a2b7['name']}},{'$match':{'reason':_0x2ab118(0x20e)}},{'$group':{'_id':_0x2ab118(0x1c3),'sum':{'$sum':_0x2ab118(0x1ca)}}}]);console[_0x2ab118(0x1cf)](_0x2ab118(0x22a),_0x2940a6);const _0x9b762d=await c_payment_data[_0x2ab118(0x224)]([{'$match':{'customer':_0x20a2b7[_0x2ab118(0x1f3)]}},{'$match':{'reason':_0x2ab118(0x1fe)}},{'$group':{'_id':_0x2ab118(0x1c3),'sum':{'$sum':_0x2ab118(0x1ca)}}}]);console[_0x2ab118(0x1cf)](_0x2ab118(0x209),_0x9b762d);if(_0x437bbc[0x0]['language']==_0x2ab118(0x20d)){var _0x226188=users['English'];console['log'](_0x226188);}else{if(_0x437bbc[0x0][_0x2ab118(0x216)]==_0x2ab118(0x207))var _0x226188=users[_0x2ab118(0x207)];else{if(_0x437bbc[0x0][_0x2ab118(0x216)]=='German')var _0x226188=users['German'];else{if(_0x437bbc[0x0][_0x2ab118(0x216)]==_0x2ab118(0x1ec))var _0x226188=users[_0x2ab118(0x1ec)];else{if(_0x437bbc[0x0][_0x2ab118(0x216)]=='French')var _0x226188=users[_0x2ab118(0x202)];else{if(_0x437bbc[0x0]['language']==_0x2ab118(0x1e0))var _0x226188=users[_0x2ab118(0x1e3)];else{if(_0x437bbc[0x0][_0x2ab118(0x216)]=='Chinese')var _0x226188=users[_0x2ab118(0x1ea)];else{if(_0x437bbc[0x0]['language']=='Arabic\x20(ae)')var _0x226188=users['Arabic'];}}}}}}}_0x5efe1b[_0x2ab118(0x1f9)]('customer_payment',{'success':_0x492624[_0x2ab118(0x1f5)](_0x2ab118(0x1d4)),'errors':_0x492624['flash'](_0x2ab118(0x1fb)),'role':_0x43c932,'profile':_0x36c82b,'payment':_0x4a61b4,'payable':_0x2940a6,'receivable':_0x9b762d,'master_shop':_0x437bbc,'language':_0x226188});}catch(_0x16e784){console[_0x2ab118(0x1cf)](_0x16e784);}}),router['get']('/products_export_migrate_file',auth,async(_0x85c889,_0xfedf1f)=>{const _0x58529f=a0_0x2b00f9;try{const _0xc09a46=new excelJS['Workbook'](),_0x567d67=_0xc09a46[_0x58529f(0x227)](_0x58529f(0x1c8));return _0x567d67[_0x58529f(0x1ce)]=[{'header':'ID','key':'PName','width':0xa},{'header':'Name','key':'PBrands','width':0xa},{'header':_0x58529f(0x217),'key':_0x58529f(0x208),'width':0xa},{'header':'SalesmanName','key':'SalesmanName','width':0xa},{'header':_0x58529f(0x1dc),'key':_0x58529f(0x1dc),'width':0xa},{'header':_0x58529f(0x203),'key':'mobile','width':0xa},{'header':'email','key':_0x58529f(0x21d),'width':0xa}],_0xfedf1f[_0x58529f(0x1ee)]('Content-Type',_0x58529f(0x1e4)),_0xfedf1f['setHeader']('Content-Disposition',_0x58529f(0x20b)),_0xc09a46[_0x58529f(0x21c)][_0x58529f(0x228)](_0xfedf1f)[_0x58529f(0x20c)](()=>{const _0x1779b6=_0x58529f;_0xfedf1f[_0x1779b6(0x223)](0xc8);});}catch(_0x1afeb5){_0xfedf1f[_0x58529f(0x223)](0x190)[_0x58529f(0x1e1)]({'errors':_0x1afeb5[_0x58529f(0x210)]});}});const storage1=multer['diskStorage']({'destination':(_0x1ee755,_0x468011,_0x3fac6f)=>{const _0x3c7a4a=a0_0x2b00f9;_0x3fac6f(null,_0x3c7a4a(0x1f8));},'filename':(_0xbea598,_0x73e883,_0x598e8e)=>{const _0x42dc1d=a0_0x2b00f9;_0x598e8e(null,Date[_0x42dc1d(0x1d8)]()+_0x73e883['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0x51a0(){const _0x2ac33a=['Spanish','German','setHeader','utils','reason','English','sheet_to_json','name','landline','flash','exports','c_payments','public/Migration','render','file','errors','receivable','Sheets','Sale\x20Return','findOne','\x20added\x20successfully','contactperson','French','mobile','sale_return','3273532XrAcXT','master','Hindi','PUnits','receivable_sum','/view','attachment;\x20filename=customer_Migration_File.xlsx','then','English\x20(US)','Sale','547601hxoHuy','message','find','payment_data','save','customer_data','Arabic','language','SalesmanCode','/view/:id','get','../models/all_models','map','xlsx','email','element','express','params','data','\x20Failed','status','aggregate','customer','user','addWorksheet','write','Arabic\x20(ae)','payable_sum','multer','$reason','customer_product_fule','2122254ZuCQoA','Router','readFile','Customers','body','$amount','13259140msiiMJ','findById','/customer_import_migrate_file','columns','log','156DBHlGB','249620gmoFmn','payable','254814LRVfRY','success','/customer/view','../public/language/languages.json','redirect','now','single','json','/view/payment/:id','address','3QZctJR','Name','amount','Portuguese\x20(BR)','send','post','Portuguese','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','21sqKaOd','public/Migration/','customer\x20add\x20successfully','sale','801408oTgqZx','Chinese','filename'];a0_0x51a0=function(){return _0x2ac33a;};return a0_0x51a0();}function a0_0x4100(_0x4578b4,_0x521722){const _0x51a007=a0_0x51a0();return a0_0x4100=function(_0x4100fc,_0x23a2e0){_0x4100fc=_0x4100fc-0x1c3;let _0x5a660c=_0x51a007[_0x4100fc];return _0x5a660c;},a0_0x4100(_0x4578b4,_0x521722);}router[a0_0x2b00f9(0x1e2)](a0_0x2b00f9(0x1cd),auth,uploadMigrate[a0_0x2b00f9(0x1d9)](a0_0x2b00f9(0x1c4)),async(_0x439f88,_0x193d94)=>{const _0x9a1f9a=a0_0x2b00f9,_0x22483b=_0x439f88[_0x9a1f9a(0x1fa)][_0x9a1f9a(0x1eb)],_0x25eeef=await xlsx[_0x9a1f9a(0x1c7)](_0x9a1f9a(0x1e6)+_0x22483b);let _0x285297=_0x25eeef['SheetNames'],_0x25bdd4=xlsx[_0x9a1f9a(0x1ef)][_0x9a1f9a(0x1f2)](_0x25eeef[_0x9a1f9a(0x1fd)][_0x285297[0x0]]);for(const _0x501dc7 of _0x25bdd4){const _0x4bb2b5=_0x501dc7['ID'],_0x1f2d5c=_0x501dc7[_0x9a1f9a(0x1de)],_0x17cc90=_0x501dc7[_0x9a1f9a(0x217)],_0x306253=_0x501dc7['SalesmanName'],_0x3b98b3=_0x501dc7[_0x9a1f9a(0x1dc)],_0x3e0f53=_0x501dc7[_0x9a1f9a(0x203)],_0x3bc2fd=_0x501dc7[_0x9a1f9a(0x21d)];try{let _0x1bcf82=await customer[_0x9a1f9a(0x1ff)]({'name':_0x1f2d5c});if(!_0x1bcf82){const _0x5c2b88=new customer({'name':_0x1f2d5c,'ID':_0x4bb2b5,'SalesmanCode':_0x17cc90,'SalesmanName':_0x306253,'address':_0x3b98b3,'mobile':_0x3e0f53,'email':_0x3bc2fd});_0x1bcf82=await _0x5c2b88[_0x9a1f9a(0x213)](),_0x439f88[_0x9a1f9a(0x1f5)](_0x9a1f9a(0x1d4),_0x1f2d5c+_0x9a1f9a(0x200));}else _0x439f88[_0x9a1f9a(0x1f5)]('error',_0x1f2d5c+_0x9a1f9a(0x222));}catch(_0x1027a8){_0x193d94[_0x9a1f9a(0x223)](0x1f4)[_0x9a1f9a(0x1da)]({'proderror':_0x1027a8['message'],'aproduct':ProductName});}}_0x193d94[_0x9a1f9a(0x1d7)]('/customer/view');}),module[a0_0x2b00f9(0x1f6)]=router;