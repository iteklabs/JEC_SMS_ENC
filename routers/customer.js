const a0_0x3edadd=a0_0x229e;(function(_0x55a09d,_0x350615){const _0xd7bea3=a0_0x229e,_0x2f7fb0=_0x55a09d();while(!![]){try{const _0x135350=parseInt(_0xd7bea3(0x1a4))/0x1+-parseInt(_0xd7bea3(0x178))/0x2*(-parseInt(_0xd7bea3(0x176))/0x3)+parseInt(_0xd7bea3(0x173))/0x4*(-parseInt(_0xd7bea3(0x1cb))/0x5)+parseInt(_0xd7bea3(0x18d))/0x6*(parseInt(_0xd7bea3(0x1bd))/0x7)+parseInt(_0xd7bea3(0x175))/0x8*(parseInt(_0xd7bea3(0x177))/0x9)+-parseInt(_0xd7bea3(0x165))/0xa*(parseInt(_0xd7bea3(0x1d3))/0xb)+-parseInt(_0xd7bea3(0x16e))/0xc*(-parseInt(_0xd7bea3(0x192))/0xd);if(_0x135350===_0x350615)break;else _0x2f7fb0['push'](_0x2f7fb0['shift']());}catch(_0x2fd901){_0x2f7fb0['push'](_0x2f7fb0['shift']());}}}(a0_0x4060,0x6e7d4));const express=require(a0_0x3edadd(0x1b4)),app=express(),router=express[a0_0x3edadd(0x1b1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x3edadd(0x17d)),users=require(a0_0x3edadd(0x1c3)),excelJS=require('exceljs'),xlsx=require(a0_0x3edadd(0x186)),multer=require('multer');router[a0_0x3edadd(0x185)](a0_0x3edadd(0x16c),auth,async(_0x2e639e,_0x2e5861)=>{const _0x3ac888=a0_0x3edadd;try{const {username:_0x3af76d,email:_0x271930,role:_0x37bb06}=_0x2e639e[_0x3ac888(0x1c7)],_0x1aeedc=_0x2e639e['user'],_0x193771=await profile[_0x3ac888(0x1a2)]({'email':_0x1aeedc[_0x3ac888(0x1d0)]}),_0x4b9898=await master_shop['find']();console[_0x3ac888(0x1a1)](_0x3ac888(0x1a8),_0x4b9898);const _0x42236e=await customer[_0x3ac888(0x1d2)](),_0x49b4fb=await customer[_0x3ac888(0x1bb)]([{'$lookup':{'from':_0x3ac888(0x196),'localField':'name','foreignField':_0x3ac888(0x1ad),'as':_0x3ac888(0x16a)}}]);console[_0x3ac888(0x1a1)](_0x49b4fb);const _0x59714d=_0x49b4fb['map'](_0x38430b=>{const _0x202b80=_0x3ac888;console['log']('data',_0x38430b);var _0x1b691a=0x0,_0x5ec2a3=0x0;return _0x38430b[_0x202b80(0x16a)][_0x202b80(0x171)](_0x44333b=>{const _0x169ecb=_0x202b80;console[_0x169ecb(0x1a1)](_0x169ecb(0x1b3),_0x44333b),_0x44333b[_0x169ecb(0x19a)]==_0x169ecb(0x1be)?_0x1b691a+=_0x44333b[_0x169ecb(0x191)]:_0x5ec2a3+=_0x44333b['amount'];}),_0x38430b[_0x202b80(0x1ab)]=parseFloat(_0x1b691a)+0x0,_0x38430b[_0x202b80(0x1c4)]=parseFloat(_0x5ec2a3)+0x0,_0x38430b;});console[_0x3ac888(0x1a1)](_0x3ac888(0x1b5),_0x59714d);if(_0x4b9898[0x0][_0x3ac888(0x1a6)]=='English\x20(US)'){var _0x33c255=users[_0x3ac888(0x1af)];console[_0x3ac888(0x1a1)](_0x33c255);}else{if(_0x4b9898[0x0][_0x3ac888(0x1a6)]==_0x3ac888(0x1c9))var _0x33c255=users[_0x3ac888(0x1c9)];else{if(_0x4b9898[0x0][_0x3ac888(0x1a6)]==_0x3ac888(0x187))var _0x33c255=users[_0x3ac888(0x187)];else{if(_0x4b9898[0x0][_0x3ac888(0x1a6)]==_0x3ac888(0x18c))var _0x33c255=users['Spanish'];else{if(_0x4b9898[0x0][_0x3ac888(0x1a6)]==_0x3ac888(0x169))var _0x33c255=users[_0x3ac888(0x169)];else{if(_0x4b9898[0x0][_0x3ac888(0x1a6)]==_0x3ac888(0x183))var _0x33c255=users[_0x3ac888(0x18e)];else{if(_0x4b9898[0x0][_0x3ac888(0x1a6)]==_0x3ac888(0x1cd))var _0x33c255=users['Chinese'];else{if(_0x4b9898[0x0]['language']==_0x3ac888(0x1ac))var _0x33c255=users['Arabic'];}}}}}}}_0x2e5861[_0x3ac888(0x174)](_0x3ac888(0x1ad),{'success':_0x2e639e[_0x3ac888(0x182)](_0x3ac888(0x16f)),'errors':_0x2e639e['flash'](_0x3ac888(0x19d)),'user':_0x42236e,'role':_0x1aeedc,'profile':_0x193771,'payment':_0x59714d,'master_shop':_0x4b9898,'language':_0x33c255});}catch(_0x29524a){console['log'](_0x29524a);}}),router['post'](a0_0x3edadd(0x16c),auth,async(_0x38100b,_0x1673e4)=>{const _0x330b3c=a0_0x3edadd;try{const {name:_0x1f3c6f,address:_0x67b8a6,mobile:_0x1d3d27,email:_0x322568,receivable:_0x2988ac,payable:_0x16c7ef,contactperson:_0x3d6d0f,landline:_0x165be3}=_0x38100b['body'],_0x16d81d=new customer({'name':_0x1f3c6f,'address':_0x67b8a6,'mobile':_0x1d3d27,'email':_0x322568,'receivable':_0x2988ac,'payable':_0x16c7ef,'contactperson':_0x3d6d0f,'landline':_0x165be3}),_0x30972c=await _0x16d81d[_0x330b3c(0x1a9)]();_0x38100b['flash'](_0x330b3c(0x16f),_0x330b3c(0x17a)),_0x1673e4[_0x330b3c(0x181)](_0x330b3c(0x1a0));}catch(_0xb77acf){console[_0x330b3c(0x1a1)](_0xb77acf);}}),router[a0_0x3edadd(0x185)](a0_0x3edadd(0x1bc),auth,async(_0x40ab6c,_0x4ad588)=>{const _0x12ca08=a0_0x3edadd;try{const {username:_0x4ed614,email:_0x208d1e,role:_0x21ba16}=_0x40ab6c[_0x12ca08(0x1c7)],_0x10cce4=_0x40ab6c[_0x12ca08(0x1c7)],_0x43fa9a=await profile[_0x12ca08(0x1a2)]({'email':_0x10cce4['email']}),_0x367e21=await master_shop[_0x12ca08(0x1d2)]();console['log'](_0x12ca08(0x1a8),_0x367e21);const _0x3191a9=_0x40ab6c['params']['id'],_0x547e4f=await customer[_0x12ca08(0x1b0)](_0x3191a9);if(_0x367e21[0x0][_0x12ca08(0x1a6)]==_0x12ca08(0x1c6)){var _0x19b4e0=users[_0x12ca08(0x1af)];console[_0x12ca08(0x1a1)](_0x19b4e0);}else{if(_0x367e21[0x0][_0x12ca08(0x1a6)]==_0x12ca08(0x1c9))var _0x19b4e0=users['Hindi'];else{if(_0x367e21[0x0][_0x12ca08(0x1a6)]==_0x12ca08(0x187))var _0x19b4e0=users[_0x12ca08(0x187)];else{if(_0x367e21[0x0][_0x12ca08(0x1a6)]==_0x12ca08(0x18c))var _0x19b4e0=users[_0x12ca08(0x18c)];else{if(_0x367e21[0x0]['language']==_0x12ca08(0x169))var _0x19b4e0=users[_0x12ca08(0x169)];else{if(_0x367e21[0x0][_0x12ca08(0x1a6)]=='Portuguese\x20(BR)')var _0x19b4e0=users[_0x12ca08(0x18e)];else{if(_0x367e21[0x0][_0x12ca08(0x1a6)]=='Chinese')var _0x19b4e0=users['Chinese'];else{if(_0x367e21[0x0][_0x12ca08(0x1a6)]==_0x12ca08(0x1ac))var _0x19b4e0=users[_0x12ca08(0x17c)];}}}}}}}_0x4ad588[_0x12ca08(0x174)](_0x12ca08(0x1ad),{'success':_0x40ab6c[_0x12ca08(0x182)]('success'),'errors':_0x40ab6c[_0x12ca08(0x182)](_0x12ca08(0x19d)),'role':_0x10cce4,'profile':_0x43fa9a,'user':_0x547e4f,'master_shop':_0x367e21,'language':_0x19b4e0});}catch(_0xdd9316){console[_0x12ca08(0x1a1)](_0xdd9316);}}),router[a0_0x3edadd(0x199)](a0_0x3edadd(0x1bc),auth,async(_0x4639ac,_0x1e62eb)=>{const _0x4a107a=a0_0x3edadd;try{const _0x4a57df=_0x4639ac[_0x4a107a(0x1b8)]['id'],_0x2a32c3=await customer[_0x4a107a(0x1b0)](_0x4a57df),{name:_0x5b5932,address:_0x56741e,mobile:_0x1da649,email:_0x55c4c4,receivable:_0x21d152,payable:_0x1f4363,contactperson:_0xec60ed,landline:_0x3e3d4f}=_0x4639ac[_0x4a107a(0x188)];_0x2a32c3[_0x4a107a(0x1b6)]=_0x5b5932,_0x2a32c3['address']=_0x56741e,_0x2a32c3[_0x4a107a(0x197)]=_0x1da649,_0x2a32c3[_0x4a107a(0x1d0)]=_0x55c4c4,_0x2a32c3[_0x4a107a(0x1d1)]=_0x21d152,_0x2a32c3[_0x4a107a(0x189)]=_0x1f4363,_0x2a32c3['contactperson']=_0xec60ed,_0x2a32c3[_0x4a107a(0x179)]=_0x3e3d4f;const _0x143066=await _0x2a32c3[_0x4a107a(0x1a9)]();_0x4639ac['flash'](_0x4a107a(0x16f),_0x4a107a(0x1cc)),_0x1e62eb['redirect'](_0x4a107a(0x1a0));}catch(_0xf9a7dc){console['log'](_0xf9a7dc);}}),router['get'](a0_0x3edadd(0x172),auth,async(_0x4da5d1,_0xd98b88)=>{const _0x2c42a7=a0_0x3edadd;try{const {username:_0x396f0a,email:_0xf4cfc7,role:_0x5602f6}=_0x4da5d1[_0x2c42a7(0x1c7)],_0x5e0915=_0x4da5d1[_0x2c42a7(0x1c7)],_0x41f032=await profile['findOne']({'email':_0x5e0915['email']}),_0x37c766=await master_shop['find']();console[_0x2c42a7(0x1a1)](_0x2c42a7(0x1a8),_0x37c766),console[_0x2c42a7(0x1a1)](_0x4da5d1[_0x2c42a7(0x1b8)]['id']);const _0x5a065a=await customer[_0x2c42a7(0x1a2)]({'_id':_0x4da5d1[_0x2c42a7(0x1b8)]['id']});console[_0x2c42a7(0x1a1)]('customer_data',_0x5a065a);const _0x3b54d6=await c_payment_data[_0x2c42a7(0x1d2)]({'customer':_0x5a065a['name']});console['log'](_0x3b54d6);const _0x4d1e47=await c_payment_data[_0x2c42a7(0x1bb)]([{'$match':{'customer':_0x5a065a[_0x2c42a7(0x1b6)]}},{'$match':{'reason':_0x2c42a7(0x1be)}},{'$group':{'_id':_0x2c42a7(0x1c0),'sum':{'$sum':_0x2c42a7(0x1a3)}}}]);console[_0x2c42a7(0x1a1)](_0x2c42a7(0x19e),_0x4d1e47);const _0x44afe7=await c_payment_data[_0x2c42a7(0x1bb)]([{'$match':{'customer':_0x5a065a['name']}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x2c42a7(0x1c0),'sum':{'$sum':'$amount'}}}]);console[_0x2c42a7(0x1a1)](_0x2c42a7(0x1ca),_0x44afe7);if(_0x37c766[0x0][_0x2c42a7(0x1a6)]==_0x2c42a7(0x1c6)){var _0x5d843e=users['English'];console['log'](_0x5d843e);}else{if(_0x37c766[0x0]['language']==_0x2c42a7(0x1c9))var _0x5d843e=users['Hindi'];else{if(_0x37c766[0x0][_0x2c42a7(0x1a6)]==_0x2c42a7(0x187))var _0x5d843e=users['German'];else{if(_0x37c766[0x0][_0x2c42a7(0x1a6)]==_0x2c42a7(0x18c))var _0x5d843e=users[_0x2c42a7(0x18c)];else{if(_0x37c766[0x0][_0x2c42a7(0x1a6)]==_0x2c42a7(0x169))var _0x5d843e=users[_0x2c42a7(0x169)];else{if(_0x37c766[0x0][_0x2c42a7(0x1a6)]==_0x2c42a7(0x183))var _0x5d843e=users[_0x2c42a7(0x18e)];else{if(_0x37c766[0x0]['language']=='Chinese')var _0x5d843e=users[_0x2c42a7(0x1cd)];else{if(_0x37c766[0x0][_0x2c42a7(0x1a6)]=='Arabic\x20(ae)')var _0x5d843e=users[_0x2c42a7(0x17c)];}}}}}}}_0xd98b88[_0x2c42a7(0x174)](_0x2c42a7(0x1c2),{'success':_0x4da5d1['flash']('success'),'errors':_0x4da5d1[_0x2c42a7(0x182)](_0x2c42a7(0x19d)),'role':_0x5e0915,'profile':_0x41f032,'payment':_0x3b54d6,'payable':_0x4d1e47,'receivable':_0x44afe7,'master_shop':_0x37c766,'language':_0x5d843e});}catch(_0x3277ba){console[_0x2c42a7(0x1a1)](_0x3277ba);}}),router[a0_0x3edadd(0x185)](a0_0x3edadd(0x166),auth,async(_0x240498,_0xa864a5)=>{const _0x2b95f4=a0_0x3edadd;try{const _0x2e9bcd=new excelJS[(_0x2b95f4(0x168))](),_0x8c0062=_0x2e9bcd['addWorksheet'](_0x2b95f4(0x18f));return _0x8c0062[_0x2b95f4(0x19b)]=[{'header':'ID','key':_0x2b95f4(0x1c5),'width':0xa},{'header':_0x2b95f4(0x1a7),'key':_0x2b95f4(0x1ce),'width':0xa},{'header':_0x2b95f4(0x184),'key':_0x2b95f4(0x194),'width':0xa},{'header':_0x2b95f4(0x1aa),'key':_0x2b95f4(0x1aa),'width':0xa},{'header':'address','key':'address','width':0xa},{'header':_0x2b95f4(0x197),'key':_0x2b95f4(0x197),'width':0xa},{'header':_0x2b95f4(0x1d0),'key':_0x2b95f4(0x1d0),'width':0xa}],_0xa864a5[_0x2b95f4(0x17f)](_0x2b95f4(0x190),_0x2b95f4(0x1d4)),_0xa864a5[_0x2b95f4(0x17f)](_0x2b95f4(0x1b9),_0x2b95f4(0x1bf)),_0x2e9bcd[_0x2b95f4(0x186)]['write'](_0xa864a5)[_0x2b95f4(0x18b)](()=>{const _0x55fa9d=_0x2b95f4;_0xa864a5[_0x55fa9d(0x16d)](0xc8);});}catch(_0x4e10e8){_0xa864a5[_0x2b95f4(0x16d)](0x190)[_0x2b95f4(0x19c)]({'errors':_0x4e10e8['message']});}});const storage1=multer[a0_0x3edadd(0x1ba)]({'destination':(_0x57bd9d,_0xfeb295,_0x4046bb)=>{const _0x5ddd05=a0_0x3edadd;_0x4046bb(null,_0x5ddd05(0x1b2));},'filename':(_0x27842c,_0x14eda7,_0x34e45f)=>{const _0x4efd99=a0_0x3edadd;_0x34e45f(null,Date[_0x4efd99(0x193)]()+_0x14eda7[_0x4efd99(0x170)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x4060(){const _0x5d0b00=['336UNuZDq','success','originalname','forEach','/view/payment/:id','4868pWJINx','render','8YlVWft','3VUpLOd','1233297NWWzkY','606946TKCyiW','landline','customer\x20add\x20successfully','json','Arabic','../middleware/auth','error','setHeader','sheet_to_json','redirect','flash','Portuguese\x20(BR)','SalesmanCode','get','xlsx','German','body','payable','single','then','Spanish','2247732cdyzrg','Portuguese','Customers','Content-Type','amount','116350RmWlCj','now','PUnits','file','c_payments','mobile','/customer_import_migrate_file','post','reason','columns','send','errors','payable_sum','\x20Failed','/customer/view','log','findOne','$amount','184682AJCENZ','public/Migration/','language','Name','master','save','SalesmanName','sale','Arabic\x20(ae)','customer','SheetNames','English','findById','Router','public/Migration','element','express','payment_data','name','exports','params','Content-Disposition','diskStorage','aggregate','/view/:id','14GCKIRa','Sale','attachment;\x20filename=customer_Migration_File.xlsx','$reason','\x20added\x20successfully','customer_payment','../public/language/languages.json','sale_return','PName','English\x20(US)','user','customer_product_fule','Hindi','receivable_sum','2610UVMuXL','customer\x20update\x20successfully','Chinese','PBrands','readFile','email','receivable','find','2954567elXwWs','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','filename','20HCHVFg','/products_export_migrate_file','message','Workbook','French','customer_docs','Sheets','/view','status'];a0_0x4060=function(){return _0x5d0b00;};return a0_0x4060();}function a0_0x229e(_0x42906e,_0x33f67f){const _0x4060c0=a0_0x4060();return a0_0x229e=function(_0x229ed5,_0x2883ca){_0x229ed5=_0x229ed5-0x164;let _0x1d04f0=_0x4060c0[_0x229ed5];return _0x1d04f0;},a0_0x229e(_0x42906e,_0x33f67f);}router[a0_0x3edadd(0x199)](a0_0x3edadd(0x198),auth,uploadMigrate[a0_0x3edadd(0x18a)](a0_0x3edadd(0x1c8)),async(_0x1cfe33,_0x55020c)=>{const _0x15173d=a0_0x3edadd,_0x459747=_0x1cfe33[_0x15173d(0x195)][_0x15173d(0x164)],_0x5621a2=await xlsx[_0x15173d(0x1cf)](_0x15173d(0x1a5)+_0x459747);let _0x5aaa0e=_0x5621a2[_0x15173d(0x1ae)],_0x4c6821=xlsx['utils'][_0x15173d(0x180)](_0x5621a2[_0x15173d(0x16b)][_0x5aaa0e[0x0]]);for(const _0x27c4f1 of _0x4c6821){const _0x3de555=_0x27c4f1['ID'],_0x1c0c76=_0x27c4f1[_0x15173d(0x1a7)],_0x5e1059=_0x27c4f1['SalesmanCode'],_0x3f65c9=_0x27c4f1[_0x15173d(0x1aa)],_0x5d0a58=_0x27c4f1['address'],_0x2eb5f0=_0x27c4f1[_0x15173d(0x197)],_0xcbe7be=_0x27c4f1[_0x15173d(0x1d0)];try{let _0x5439ca=await customer[_0x15173d(0x1a2)]({'name':_0x1c0c76});if(!_0x5439ca){const _0x321d51=new customer({'name':_0x1c0c76,'ID':_0x3de555,'SalesmanCode':_0x5e1059,'SalesmanName':_0x3f65c9,'address':_0x5d0a58,'mobile':_0x2eb5f0,'email':_0xcbe7be});_0x5439ca=await _0x321d51[_0x15173d(0x1a9)](),_0x1cfe33[_0x15173d(0x182)]('success',_0x1c0c76+_0x15173d(0x1c1));}else _0x1cfe33[_0x15173d(0x182)](_0x15173d(0x17e),_0x1c0c76+_0x15173d(0x19f));}catch(_0x31367e){_0x55020c['status'](0x1f4)[_0x15173d(0x17b)]({'proderror':_0x31367e[_0x15173d(0x167)],'aproduct':ProductName});}}_0x55020c[_0x15173d(0x181)](_0x15173d(0x1a0));}),module[a0_0x3edadd(0x1b7)]=router;