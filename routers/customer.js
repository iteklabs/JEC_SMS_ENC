const a0_0x347877=a0_0x30fd;function a0_0x4507(){const _0x2f9e06=['email','German','Chinese','../middleware/auth','errors','body','express','PUnits','flash','SalesmanName','3cLTbuj','get','Arabic\x20(ae)','findOne','find','receivable_sum','/customer_import_migrate_file','public/Migration','save','Customers','customer','../models/all_models','Hindi','amount','Arabic','language','French','aggregate','1579388IpeLPd','user','exceljs','English','attachment;\x20filename=customer_Migration_File.xlsx','1656320RtQEye','forEach','/customer/view','address','$amount','payment_data','Portuguese\x20(BR)','Sheets','status','Name','findById','render','setHeader','SalesmanCode','Router','customer\x20update\x20successfully','master','Content-Disposition','sale_return','customer_docs','Portuguese','3811347nDYjXx','$reason','16231nsGXet','mobile','10WsLFyg','reason','receivable','PName','\x20Failed','21xCxnNn','single','multer','Content-Type','1355560KNUFEg','then','name','sheet_to_json','post','../public/language/languages.json','Workbook','utils','6476404RGyeZD','2118486RYwmBn','xlsx','Spanish','/view/:id','filename','message','sale','customer_payment','customer_product_fule','send','success','Sale','log','English\x20(US)','params'];a0_0x4507=function(){return _0x2f9e06;};return a0_0x4507();}(function(_0x1bece9,_0x4440cb){const _0x1a10fb=a0_0x30fd,_0x2f8baf=_0x1bece9();while(!![]){try{const _0x229d7b=parseInt(_0x1a10fb(0x143))/0x1+parseInt(_0x1a10fb(0x182))/0x2+-parseInt(_0x1a10fb(0x170))/0x3*(parseInt(_0x1a10fb(0x156))/0x4)+parseInt(_0x1a10fb(0x187))/0x5+-parseInt(_0x1a10fb(0x157))/0x6*(-parseInt(_0x1a10fb(0x14a))/0x7)+-parseInt(_0x1a10fb(0x14e))/0x8+-parseInt(_0x1a10fb(0x141))/0x9*(-parseInt(_0x1a10fb(0x145))/0xa);if(_0x229d7b===_0x4440cb)break;else _0x2f8baf['push'](_0x2f8baf['shift']());}catch(_0x161447){_0x2f8baf['push'](_0x2f8baf['shift']());}}}(a0_0x4507,0xcaf89));const express=require(a0_0x347877(0x16c)),app=express(),router=express[a0_0x347877(0x13a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x347877(0x17b)),auth=require(a0_0x347877(0x169)),users=require(a0_0x347877(0x153)),excelJS=require(a0_0x347877(0x184)),xlsx=require(a0_0x347877(0x158)),multer=require(a0_0x347877(0x14c));function a0_0x30fd(_0x3cb926,_0x28e4d2){const _0x450710=a0_0x4507();return a0_0x30fd=function(_0x30fdd2,_0x421aab){_0x30fdd2=_0x30fdd2-0x138;let _0x592efb=_0x450710[_0x30fdd2];return _0x592efb;},a0_0x30fd(_0x3cb926,_0x28e4d2);}router[a0_0x347877(0x171)]('/view',auth,async(_0x3fc66e,_0x219948)=>{const _0x2f1292=a0_0x347877;try{const {username:_0x3654b2,email:_0x5f56b1,role:_0x292f7b}=_0x3fc66e[_0x2f1292(0x183)],_0x2bc42b=_0x3fc66e[_0x2f1292(0x183)],_0x549081=await profile[_0x2f1292(0x173)]({'email':_0x2bc42b[_0x2f1292(0x166)]}),_0x2e20c7=await master_shop['find']();console[_0x2f1292(0x163)]('master',_0x2e20c7);const _0x3e5515=await customer[_0x2f1292(0x174)](),_0x3ce187=await customer[_0x2f1292(0x181)]([{'$lookup':{'from':'c_payments','localField':'name','foreignField':_0x2f1292(0x17a),'as':'customer_docs'}}]);console[_0x2f1292(0x163)](_0x3ce187);const _0x5893df=_0x3ce187['map'](_0x1cad13=>{const _0x39766a=_0x2f1292;console['log']('data',_0x1cad13);var _0x44a539=0x0,_0x149dcd=0x0;return _0x1cad13[_0x39766a(0x13f)][_0x39766a(0x188)](_0x39acdd=>{const _0x24ed39=_0x39766a;console[_0x24ed39(0x163)]('element',_0x39acdd),_0x39acdd[_0x24ed39(0x146)]==_0x24ed39(0x162)?_0x44a539+=_0x39acdd[_0x24ed39(0x17d)]:_0x149dcd+=_0x39acdd[_0x24ed39(0x17d)];}),_0x1cad13[_0x39766a(0x15d)]=parseFloat(_0x44a539)+0x0,_0x1cad13[_0x39766a(0x13e)]=parseFloat(_0x149dcd)+0x0,_0x1cad13;});console['log'](_0x2f1292(0x18c),_0x5893df);if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x164)){var _0x342db3=users['English'];console[_0x2f1292(0x163)](_0x342db3);}else{if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x17c))var _0x342db3=users[_0x2f1292(0x17c)];else{if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x167))var _0x342db3=users[_0x2f1292(0x167)];else{if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x159))var _0x342db3=users[_0x2f1292(0x159)];else{if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x180))var _0x342db3=users[_0x2f1292(0x180)];else{if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x18d))var _0x342db3=users[_0x2f1292(0x140)];else{if(_0x2e20c7[0x0][_0x2f1292(0x17f)]==_0x2f1292(0x168))var _0x342db3=users[_0x2f1292(0x168)];else{if(_0x2e20c7[0x0]['language']=='Arabic\x20(ae)')var _0x342db3=users[_0x2f1292(0x17e)];}}}}}}}_0x219948[_0x2f1292(0x192)]('customer',{'success':_0x3fc66e[_0x2f1292(0x16e)](_0x2f1292(0x161)),'errors':_0x3fc66e[_0x2f1292(0x16e)](_0x2f1292(0x16a)),'user':_0x3e5515,'role':_0x2bc42b,'profile':_0x549081,'payment':_0x5893df,'master_shop':_0x2e20c7,'language':_0x342db3});}catch(_0x342e6f){console['log'](_0x342e6f);}}),router['post']('/view',auth,async(_0x5c488f,_0x43e2b4)=>{const _0x1e1cc5=a0_0x347877;try{const {name:_0x4b6596,address:_0x21edec,mobile:_0x4ee14c,email:_0x151979,receivable:_0x4df8ff,payable:_0x56d23f,contactperson:_0x4f6681,landline:_0x58f587}=_0x5c488f[_0x1e1cc5(0x16b)],_0x2039b2=new customer({'name':_0x4b6596,'address':_0x21edec,'mobile':_0x4ee14c,'email':_0x151979,'receivable':_0x4df8ff,'payable':_0x56d23f,'contactperson':_0x4f6681,'landline':_0x58f587}),_0x19ab0d=await _0x2039b2[_0x1e1cc5(0x178)]();_0x5c488f[_0x1e1cc5(0x16e)]('success','customer\x20add\x20successfully'),_0x43e2b4['redirect'](_0x1e1cc5(0x189));}catch(_0x5a1132){console['log'](_0x5a1132);}}),router[a0_0x347877(0x171)](a0_0x347877(0x15a),auth,async(_0xaf7740,_0x3b91d9)=>{const _0x2994db=a0_0x347877;try{const {username:_0x74846f,email:_0x2af271,role:_0x25c70e}=_0xaf7740[_0x2994db(0x183)],_0x388eb1=_0xaf7740[_0x2994db(0x183)],_0x5b8d30=await profile['findOne']({'email':_0x388eb1[_0x2994db(0x166)]}),_0x497dd7=await master_shop['find']();console[_0x2994db(0x163)](_0x2994db(0x13c),_0x497dd7);const _0x4b787e=_0xaf7740[_0x2994db(0x165)]['id'],_0x56ea16=await customer[_0x2994db(0x191)](_0x4b787e);if(_0x497dd7[0x0]['language']=='English\x20(US)'){var _0x2f0771=users[_0x2994db(0x185)];console[_0x2994db(0x163)](_0x2f0771);}else{if(_0x497dd7[0x0][_0x2994db(0x17f)]=='Hindi')var _0x2f0771=users[_0x2994db(0x17c)];else{if(_0x497dd7[0x0][_0x2994db(0x17f)]==_0x2994db(0x167))var _0x2f0771=users[_0x2994db(0x167)];else{if(_0x497dd7[0x0]['language']=='Spanish')var _0x2f0771=users[_0x2994db(0x159)];else{if(_0x497dd7[0x0]['language']==_0x2994db(0x180))var _0x2f0771=users[_0x2994db(0x180)];else{if(_0x497dd7[0x0][_0x2994db(0x17f)]=='Portuguese\x20(BR)')var _0x2f0771=users[_0x2994db(0x140)];else{if(_0x497dd7[0x0][_0x2994db(0x17f)]=='Chinese')var _0x2f0771=users['Chinese'];else{if(_0x497dd7[0x0][_0x2994db(0x17f)]=='Arabic\x20(ae)')var _0x2f0771=users['Arabic'];}}}}}}}_0x3b91d9[_0x2994db(0x192)](_0x2994db(0x17a),{'success':_0xaf7740[_0x2994db(0x16e)]('success'),'errors':_0xaf7740[_0x2994db(0x16e)]('errors'),'role':_0x388eb1,'profile':_0x5b8d30,'user':_0x56ea16,'master_shop':_0x497dd7,'language':_0x2f0771});}catch(_0xfa68df){console['log'](_0xfa68df);}}),router[a0_0x347877(0x152)]('/view/:id',auth,async(_0x4af94c,_0x4e7787)=>{const _0x42f6a0=a0_0x347877;try{const _0x3afb40=_0x4af94c[_0x42f6a0(0x165)]['id'],_0x149fdd=await customer[_0x42f6a0(0x191)](_0x3afb40),{name:_0x301fd5,address:_0x4c9947,mobile:_0x4983c4,email:_0x255ebf,receivable:_0x2d69ec,payable:_0x84b95d,contactperson:_0x5cd6ad,landline:_0x5ec33d}=_0x4af94c[_0x42f6a0(0x16b)];_0x149fdd[_0x42f6a0(0x150)]=_0x301fd5,_0x149fdd[_0x42f6a0(0x18a)]=_0x4c9947,_0x149fdd[_0x42f6a0(0x144)]=_0x4983c4,_0x149fdd[_0x42f6a0(0x166)]=_0x255ebf,_0x149fdd[_0x42f6a0(0x147)]=_0x2d69ec,_0x149fdd['payable']=_0x84b95d,_0x149fdd['contactperson']=_0x5cd6ad,_0x149fdd['landline']=_0x5ec33d;const _0x266fa6=await _0x149fdd[_0x42f6a0(0x178)]();_0x4af94c[_0x42f6a0(0x16e)](_0x42f6a0(0x161),_0x42f6a0(0x13b)),_0x4e7787['redirect'](_0x42f6a0(0x189));}catch(_0x20bf0c){console[_0x42f6a0(0x163)](_0x20bf0c);}}),router[a0_0x347877(0x171)]('/view/payment/:id',auth,async(_0x3d75c9,_0x30bdfa)=>{const _0x347c17=a0_0x347877;try{const {username:_0x26d9e9,email:_0x47d38a,role:_0x1d9f99}=_0x3d75c9[_0x347c17(0x183)],_0x247671=_0x3d75c9[_0x347c17(0x183)],_0x31d23e=await profile[_0x347c17(0x173)]({'email':_0x247671[_0x347c17(0x166)]}),_0x93ce2e=await master_shop[_0x347c17(0x174)]();console['log'](_0x347c17(0x13c),_0x93ce2e),console[_0x347c17(0x163)](_0x3d75c9['params']['id']);const _0x35817c=await customer[_0x347c17(0x173)]({'_id':_0x3d75c9[_0x347c17(0x165)]['id']});console['log']('customer_data',_0x35817c);const _0x957c42=await c_payment_data[_0x347c17(0x174)]({'customer':_0x35817c[_0x347c17(0x150)]});console[_0x347c17(0x163)](_0x957c42);const _0x468a8b=await c_payment_data['aggregate']([{'$match':{'customer':_0x35817c[_0x347c17(0x150)]}},{'$match':{'reason':_0x347c17(0x162)}},{'$group':{'_id':_0x347c17(0x142),'sum':{'$sum':_0x347c17(0x18b)}}}]);console[_0x347c17(0x163)]('payable_sum',_0x468a8b);const _0x48c2b9=await c_payment_data['aggregate']([{'$match':{'customer':_0x35817c[_0x347c17(0x150)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x347c17(0x142),'sum':{'$sum':'$amount'}}}]);console[_0x347c17(0x163)](_0x347c17(0x175),_0x48c2b9);if(_0x93ce2e[0x0][_0x347c17(0x17f)]=='English\x20(US)'){var _0x27ef3d=users['English'];console[_0x347c17(0x163)](_0x27ef3d);}else{if(_0x93ce2e[0x0]['language']==_0x347c17(0x17c))var _0x27ef3d=users[_0x347c17(0x17c)];else{if(_0x93ce2e[0x0][_0x347c17(0x17f)]==_0x347c17(0x167))var _0x27ef3d=users[_0x347c17(0x167)];else{if(_0x93ce2e[0x0][_0x347c17(0x17f)]==_0x347c17(0x159))var _0x27ef3d=users[_0x347c17(0x159)];else{if(_0x93ce2e[0x0][_0x347c17(0x17f)]==_0x347c17(0x180))var _0x27ef3d=users[_0x347c17(0x180)];else{if(_0x93ce2e[0x0]['language']=='Portuguese\x20(BR)')var _0x27ef3d=users[_0x347c17(0x140)];else{if(_0x93ce2e[0x0]['language']=='Chinese')var _0x27ef3d=users[_0x347c17(0x168)];else{if(_0x93ce2e[0x0][_0x347c17(0x17f)]==_0x347c17(0x172))var _0x27ef3d=users[_0x347c17(0x17e)];}}}}}}}_0x30bdfa[_0x347c17(0x192)](_0x347c17(0x15e),{'success':_0x3d75c9['flash'](_0x347c17(0x161)),'errors':_0x3d75c9[_0x347c17(0x16e)](_0x347c17(0x16a)),'role':_0x247671,'profile':_0x31d23e,'payment':_0x957c42,'payable':_0x468a8b,'receivable':_0x48c2b9,'master_shop':_0x93ce2e,'language':_0x27ef3d});}catch(_0x5cc6e9){console[_0x347c17(0x163)](_0x5cc6e9);}}),router[a0_0x347877(0x171)]('/products_export_migrate_file',auth,async(_0x3e2375,_0x383eb3)=>{const _0x15e43a=a0_0x347877;try{const _0x129991=new excelJS[(_0x15e43a(0x154))](),_0x5d525a=_0x129991['addWorksheet'](_0x15e43a(0x179));return _0x5d525a['columns']=[{'header':'ID','key':_0x15e43a(0x148),'width':0xa},{'header':_0x15e43a(0x190),'key':'PBrands','width':0xa},{'header':_0x15e43a(0x139),'key':_0x15e43a(0x16d),'width':0xa},{'header':'SalesmanName','key':_0x15e43a(0x16f),'width':0xa},{'header':_0x15e43a(0x18a),'key':_0x15e43a(0x18a),'width':0xa},{'header':'mobile','key':_0x15e43a(0x144),'width':0xa},{'header':_0x15e43a(0x166),'key':_0x15e43a(0x166),'width':0xa}],_0x383eb3[_0x15e43a(0x138)](_0x15e43a(0x14d),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x383eb3[_0x15e43a(0x138)](_0x15e43a(0x13d),_0x15e43a(0x186)),_0x129991[_0x15e43a(0x158)]['write'](_0x383eb3)[_0x15e43a(0x14f)](()=>{_0x383eb3['status'](0xc8);});}catch(_0x4f20dd){_0x383eb3['status'](0x190)[_0x15e43a(0x160)]({'errors':_0x4f20dd['message']});}});const storage1=multer['diskStorage']({'destination':(_0x3c2ffb,_0xd0b6ef,_0x2b98d8)=>{const _0x27942d=a0_0x347877;_0x2b98d8(null,_0x27942d(0x177));},'filename':(_0x23dc0f,_0x2ef782,_0x1c3ee5)=>{_0x1c3ee5(null,Date['now']()+_0x2ef782['originalname']);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x347877(0x152)](a0_0x347877(0x176),auth,uploadMigrate[a0_0x347877(0x14b)](a0_0x347877(0x15f)),async(_0x20dfd6,_0x41acc5)=>{const _0x3b0d70=a0_0x347877,_0x480f49=_0x20dfd6['file'][_0x3b0d70(0x15b)],_0x44218d=await xlsx['readFile']('public/Migration/'+_0x480f49);let _0x57cdbc=_0x44218d['SheetNames'],_0x2ed56f=xlsx[_0x3b0d70(0x155)][_0x3b0d70(0x151)](_0x44218d[_0x3b0d70(0x18e)][_0x57cdbc[0x0]]);for(const _0x1a1a64 of _0x2ed56f){const _0x2ce2a0=_0x1a1a64['ID'],_0x284027=_0x1a1a64[_0x3b0d70(0x190)],_0x131839=_0x1a1a64['SalesmanCode'],_0x230914=_0x1a1a64[_0x3b0d70(0x16f)],_0xb2a575=_0x1a1a64[_0x3b0d70(0x18a)],_0x204825=_0x1a1a64[_0x3b0d70(0x144)],_0x50dbd0=_0x1a1a64[_0x3b0d70(0x166)];try{let _0x2f2907=await customer[_0x3b0d70(0x173)]({'name':_0x284027});if(!_0x2f2907){const _0x35f744=new customer({'name':_0x284027,'ID':_0x2ce2a0,'SalesmanCode':_0x131839,'SalesmanName':_0x230914,'address':_0xb2a575,'mobile':_0x204825,'email':_0x50dbd0});_0x2f2907=await _0x35f744[_0x3b0d70(0x178)](),_0x20dfd6[_0x3b0d70(0x16e)](_0x3b0d70(0x161),_0x284027+'\x20added\x20successfully');}else _0x20dfd6[_0x3b0d70(0x16e)]('error',_0x284027+_0x3b0d70(0x149));}catch(_0x4e7b49){_0x41acc5[_0x3b0d70(0x18f)](0x1f4)['json']({'proderror':_0x4e7b49[_0x3b0d70(0x15c)],'aproduct':ProductName});}}_0x41acc5['redirect'](_0x3b0d70(0x189));}),module['exports']=router;