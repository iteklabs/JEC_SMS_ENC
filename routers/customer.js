const a0_0x1bb301=a0_0x4747;(function(_0x865b7,_0x5b49a6){const _0x35d1b4=a0_0x4747,_0x578b04=_0x865b7();while(!![]){try{const _0x15a36c=parseInt(_0x35d1b4(0xc3))/0x1+parseInt(_0x35d1b4(0xc4))/0x2+parseInt(_0x35d1b4(0x8c))/0x3*(-parseInt(_0x35d1b4(0x9b))/0x4)+-parseInt(_0x35d1b4(0xac))/0x5*(-parseInt(_0x35d1b4(0xa1))/0x6)+-parseInt(_0x35d1b4(0xd7))/0x7*(-parseInt(_0x35d1b4(0xa8))/0x8)+-parseInt(_0x35d1b4(0xcb))/0x9*(-parseInt(_0x35d1b4(0xb4))/0xa)+parseInt(_0x35d1b4(0xb5))/0xb*(-parseInt(_0x35d1b4(0xd4))/0xc);if(_0x15a36c===_0x5b49a6)break;else _0x578b04['push'](_0x578b04['shift']());}catch(_0x306e74){_0x578b04['push'](_0x578b04['shift']());}}}(a0_0x27a5,0x9220b));function a0_0x27a5(){const _0x5de230=['now','send','email','../models/all_models','columns','attachment;\x20filename=customer_Migration_File.xlsx','errors','mobile','xlsx','aggregate','Chinese','customer_docs','Hindi','redirect','sale_return','address','render','payable','utils','message','SheetNames','3zfyBeL','user','sale','/customer_import_migrate_file','findOne','customer_data','French','Router','receivable','success','save','body','forEach','customer_payment','English','2874580FoOjyl','params','name','map','get','customer','426VyIZnF','public/Migration/','exports','Customers','log','setHeader','Portuguese\x20(BR)','5218328ySNnyu','error','payment_data','post','80785MlUxmw','Workbook','SalesmanCode','file','Arabic\x20(ae)','/view/:id','Sale\x20Return','then','88070TCnivB','1227314WxtRgr','amount','Sheets','/products_export_migrate_file','language','Portuguese','exceljs','single','find','Name','SalesmanName','public/Migration','Spanish','master','993117nAsHdq','1953016Alnbhi','Content-Type','flash','Arabic','multer','English\x20(US)','Sale','1143vKXFUY','../middleware/auth','customer\x20update\x20successfully','/view','customer_product_fule','PBrands','$amount','PName','/customer/view','384UuqvlW','status','write','7pnmhNu','\x20Failed','German','\x20added\x20successfully','findById','$reason'];a0_0x27a5=function(){return _0x5de230;};return a0_0x27a5();}const express=require('express'),app=express(),router=express[a0_0x1bb301(0x93)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x1bb301(0x7a)),auth=require(a0_0x1bb301(0xcc)),users=require('../public/language/languages.json'),excelJS=require(a0_0x1bb301(0xbb)),xlsx=require(a0_0x1bb301(0x7f)),multer=require(a0_0x1bb301(0xc8));router[a0_0x1bb301(0x9f)](a0_0x1bb301(0xce),auth,async(_0x6446ad,_0xdbcec8)=>{const _0x12ea35=a0_0x1bb301;try{const {username:_0x3cbb1a,email:_0x201d02,role:_0x48f4e0}=_0x6446ad[_0x12ea35(0x8d)],_0x248c86=_0x6446ad['user'],_0x3fb197=await profile['findOne']({'email':_0x248c86[_0x12ea35(0x79)]}),_0x2e7393=await master_shop[_0x12ea35(0xbd)]();console[_0x12ea35(0xa5)](_0x12ea35(0xc2),_0x2e7393);const _0x2e32cc=await customer[_0x12ea35(0xbd)](),_0xe83c52=await customer[_0x12ea35(0x80)]([{'$lookup':{'from':'c_payments','localField':_0x12ea35(0x9d),'foreignField':'customer','as':_0x12ea35(0x82)}}]);console['log'](_0xe83c52);const _0x2b7854=_0xe83c52[_0x12ea35(0x9e)](_0x1cb9d4=>{const _0x230090=_0x12ea35;console['log']('data',_0x1cb9d4);var _0x403d6b=0x0,_0x1ff91e=0x0;return _0x1cb9d4['customer_docs'][_0x230090(0x98)](_0x1814d6=>{const _0x44a66e=_0x230090;console[_0x44a66e(0xa5)]('element',_0x1814d6),_0x1814d6['reason']==_0x44a66e(0xca)?_0x403d6b+=_0x1814d6[_0x44a66e(0xb6)]:_0x1ff91e+=_0x1814d6[_0x44a66e(0xb6)];}),_0x1cb9d4[_0x230090(0x8e)]=parseFloat(_0x403d6b)+0x0,_0x1cb9d4[_0x230090(0x85)]=parseFloat(_0x1ff91e)+0x0,_0x1cb9d4;});console[_0x12ea35(0xa5)](_0x12ea35(0xaa),_0x2b7854);if(_0x2e7393[0x0][_0x12ea35(0xb9)]=='English\x20(US)'){var _0xa86d26=users[_0x12ea35(0x9a)];console[_0x12ea35(0xa5)](_0xa86d26);}else{if(_0x2e7393[0x0][_0x12ea35(0xb9)]==_0x12ea35(0x83))var _0xa86d26=users[_0x12ea35(0x83)];else{if(_0x2e7393[0x0][_0x12ea35(0xb9)]==_0x12ea35(0x73))var _0xa86d26=users['German'];else{if(_0x2e7393[0x0]['language']==_0x12ea35(0xc1))var _0xa86d26=users[_0x12ea35(0xc1)];else{if(_0x2e7393[0x0][_0x12ea35(0xb9)]=='French')var _0xa86d26=users[_0x12ea35(0x92)];else{if(_0x2e7393[0x0][_0x12ea35(0xb9)]==_0x12ea35(0xa7))var _0xa86d26=users[_0x12ea35(0xba)];else{if(_0x2e7393[0x0][_0x12ea35(0xb9)]=='Chinese')var _0xa86d26=users[_0x12ea35(0x81)];else{if(_0x2e7393[0x0][_0x12ea35(0xb9)]==_0x12ea35(0xb0))var _0xa86d26=users[_0x12ea35(0xc7)];}}}}}}}_0xdbcec8[_0x12ea35(0x87)](_0x12ea35(0xa0),{'success':_0x6446ad[_0x12ea35(0xc6)](_0x12ea35(0x95)),'errors':_0x6446ad['flash'](_0x12ea35(0x7d)),'user':_0x2e32cc,'role':_0x248c86,'profile':_0x3fb197,'payment':_0x2b7854,'master_shop':_0x2e7393,'language':_0xa86d26});}catch(_0x21f5ff){console[_0x12ea35(0xa5)](_0x21f5ff);}}),router[a0_0x1bb301(0xab)]('/view',auth,async(_0x42d572,_0xf24b42)=>{const _0x21604e=a0_0x1bb301;try{const {name:_0x521d14,address:_0x5a6074,mobile:_0xf7231d,email:_0x157cc5,receivable:_0x506efb,payable:_0x51b667,contactperson:_0x2d3003,landline:_0x1a80e2}=_0x42d572['body'],_0x2d8223=new customer({'name':_0x521d14,'address':_0x5a6074,'mobile':_0xf7231d,'email':_0x157cc5,'receivable':_0x506efb,'payable':_0x51b667,'contactperson':_0x2d3003,'landline':_0x1a80e2}),_0x27de7b=await _0x2d8223[_0x21604e(0x96)]();_0x42d572[_0x21604e(0xc6)]('success','customer\x20add\x20successfully'),_0xf24b42[_0x21604e(0x84)](_0x21604e(0xd3));}catch(_0x1373c7){console[_0x21604e(0xa5)](_0x1373c7);}}),router[a0_0x1bb301(0x9f)](a0_0x1bb301(0xb1),auth,async(_0x93fb54,_0x53d007)=>{const _0x42f6b1=a0_0x1bb301;try{const {username:_0x412881,email:_0x5b349b,role:_0x223ff0}=_0x93fb54['user'],_0x1dd945=_0x93fb54[_0x42f6b1(0x8d)],_0x4c9820=await profile[_0x42f6b1(0x90)]({'email':_0x1dd945['email']}),_0x594cf8=await master_shop[_0x42f6b1(0xbd)]();console[_0x42f6b1(0xa5)]('master',_0x594cf8);const _0x4315fe=_0x93fb54[_0x42f6b1(0x9c)]['id'],_0x1c6472=await customer[_0x42f6b1(0x75)](_0x4315fe);if(_0x594cf8[0x0][_0x42f6b1(0xb9)]==_0x42f6b1(0xc9)){var _0x31b827=users[_0x42f6b1(0x9a)];console[_0x42f6b1(0xa5)](_0x31b827);}else{if(_0x594cf8[0x0][_0x42f6b1(0xb9)]==_0x42f6b1(0x83))var _0x31b827=users[_0x42f6b1(0x83)];else{if(_0x594cf8[0x0]['language']==_0x42f6b1(0x73))var _0x31b827=users[_0x42f6b1(0x73)];else{if(_0x594cf8[0x0]['language']==_0x42f6b1(0xc1))var _0x31b827=users[_0x42f6b1(0xc1)];else{if(_0x594cf8[0x0][_0x42f6b1(0xb9)]==_0x42f6b1(0x92))var _0x31b827=users[_0x42f6b1(0x92)];else{if(_0x594cf8[0x0][_0x42f6b1(0xb9)]==_0x42f6b1(0xa7))var _0x31b827=users['Portuguese'];else{if(_0x594cf8[0x0][_0x42f6b1(0xb9)]==_0x42f6b1(0x81))var _0x31b827=users[_0x42f6b1(0x81)];else{if(_0x594cf8[0x0]['language']==_0x42f6b1(0xb0))var _0x31b827=users['Arabic'];}}}}}}}_0x53d007[_0x42f6b1(0x87)]('customer',{'success':_0x93fb54['flash'](_0x42f6b1(0x95)),'errors':_0x93fb54['flash'](_0x42f6b1(0x7d)),'role':_0x1dd945,'profile':_0x4c9820,'user':_0x1c6472,'master_shop':_0x594cf8,'language':_0x31b827});}catch(_0x2445a5){console[_0x42f6b1(0xa5)](_0x2445a5);}}),router[a0_0x1bb301(0xab)](a0_0x1bb301(0xb1),auth,async(_0xa3ee41,_0x43582d)=>{const _0x2aaee1=a0_0x1bb301;try{const _0x47c4f6=_0xa3ee41[_0x2aaee1(0x9c)]['id'],_0x1df525=await customer['findById'](_0x47c4f6),{name:_0x105294,address:_0x30eb31,mobile:_0x2043bc,email:_0x1f63f1,receivable:_0x3f4f61,payable:_0x147e89,contactperson:_0x3a821d,landline:_0x21b567}=_0xa3ee41[_0x2aaee1(0x97)];_0x1df525[_0x2aaee1(0x9d)]=_0x105294,_0x1df525['address']=_0x30eb31,_0x1df525['mobile']=_0x2043bc,_0x1df525[_0x2aaee1(0x79)]=_0x1f63f1,_0x1df525[_0x2aaee1(0x94)]=_0x3f4f61,_0x1df525[_0x2aaee1(0x88)]=_0x147e89,_0x1df525['contactperson']=_0x3a821d,_0x1df525['landline']=_0x21b567;const _0x266cdc=await _0x1df525[_0x2aaee1(0x96)]();_0xa3ee41[_0x2aaee1(0xc6)](_0x2aaee1(0x95),_0x2aaee1(0xcd)),_0x43582d[_0x2aaee1(0x84)]('/customer/view');}catch(_0x2483fd){console[_0x2aaee1(0xa5)](_0x2483fd);}}),router[a0_0x1bb301(0x9f)]('/view/payment/:id',auth,async(_0x21843d,_0x11a3c1)=>{const _0x107cfd=a0_0x1bb301;try{const {username:_0x16bebd,email:_0x25a7cf,role:_0x73ab01}=_0x21843d[_0x107cfd(0x8d)],_0x5a4c1b=_0x21843d[_0x107cfd(0x8d)],_0x147e29=await profile[_0x107cfd(0x90)]({'email':_0x5a4c1b[_0x107cfd(0x79)]}),_0x3d594d=await master_shop[_0x107cfd(0xbd)]();console[_0x107cfd(0xa5)](_0x107cfd(0xc2),_0x3d594d),console[_0x107cfd(0xa5)](_0x21843d[_0x107cfd(0x9c)]['id']);const _0xa9af79=await customer[_0x107cfd(0x90)]({'_id':_0x21843d['params']['id']});console[_0x107cfd(0xa5)](_0x107cfd(0x91),_0xa9af79);const _0x13f194=await c_payment_data['find']({'customer':_0xa9af79[_0x107cfd(0x9d)]});console[_0x107cfd(0xa5)](_0x13f194);const _0x3b95d8=await c_payment_data['aggregate']([{'$match':{'customer':_0xa9af79['name']}},{'$match':{'reason':_0x107cfd(0xca)}},{'$group':{'_id':_0x107cfd(0x76),'sum':{'$sum':_0x107cfd(0xd1)}}}]);console['log']('payable_sum',_0x3b95d8);const _0x21fe88=await c_payment_data[_0x107cfd(0x80)]([{'$match':{'customer':_0xa9af79[_0x107cfd(0x9d)]}},{'$match':{'reason':_0x107cfd(0xb2)}},{'$group':{'_id':_0x107cfd(0x76),'sum':{'$sum':_0x107cfd(0xd1)}}}]);console['log']('receivable_sum',_0x21fe88);if(_0x3d594d[0x0][_0x107cfd(0xb9)]==_0x107cfd(0xc9)){var _0x17d30d=users[_0x107cfd(0x9a)];console[_0x107cfd(0xa5)](_0x17d30d);}else{if(_0x3d594d[0x0][_0x107cfd(0xb9)]==_0x107cfd(0x83))var _0x17d30d=users[_0x107cfd(0x83)];else{if(_0x3d594d[0x0]['language']==_0x107cfd(0x73))var _0x17d30d=users[_0x107cfd(0x73)];else{if(_0x3d594d[0x0][_0x107cfd(0xb9)]==_0x107cfd(0xc1))var _0x17d30d=users[_0x107cfd(0xc1)];else{if(_0x3d594d[0x0][_0x107cfd(0xb9)]==_0x107cfd(0x92))var _0x17d30d=users[_0x107cfd(0x92)];else{if(_0x3d594d[0x0]['language']==_0x107cfd(0xa7))var _0x17d30d=users[_0x107cfd(0xba)];else{if(_0x3d594d[0x0][_0x107cfd(0xb9)]==_0x107cfd(0x81))var _0x17d30d=users[_0x107cfd(0x81)];else{if(_0x3d594d[0x0][_0x107cfd(0xb9)]==_0x107cfd(0xb0))var _0x17d30d=users[_0x107cfd(0xc7)];}}}}}}}_0x11a3c1['render'](_0x107cfd(0x99),{'success':_0x21843d[_0x107cfd(0xc6)]('success'),'errors':_0x21843d[_0x107cfd(0xc6)](_0x107cfd(0x7d)),'role':_0x5a4c1b,'profile':_0x147e29,'payment':_0x13f194,'payable':_0x3b95d8,'receivable':_0x21fe88,'master_shop':_0x3d594d,'language':_0x17d30d});}catch(_0x45dac8){console['log'](_0x45dac8);}}),router[a0_0x1bb301(0x9f)](a0_0x1bb301(0xb8),auth,async(_0x12a421,_0x36a78e)=>{const _0x150e3e=a0_0x1bb301;try{const _0x492be9=new excelJS[(_0x150e3e(0xad))](),_0x1961df=_0x492be9['addWorksheet'](_0x150e3e(0xa4));return _0x1961df[_0x150e3e(0x7b)]=[{'header':'ID','key':_0x150e3e(0xd2),'width':0xa},{'header':_0x150e3e(0xbe),'key':_0x150e3e(0xd0),'width':0xa},{'header':_0x150e3e(0xae),'key':'PUnits','width':0xa},{'header':_0x150e3e(0xbf),'key':'SalesmanName','width':0xa},{'header':_0x150e3e(0x86),'key':_0x150e3e(0x86),'width':0xa},{'header':_0x150e3e(0x7e),'key':_0x150e3e(0x7e),'width':0xa},{'header':'email','key':'email','width':0xa}],_0x36a78e[_0x150e3e(0xa6)](_0x150e3e(0xc5),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x36a78e[_0x150e3e(0xa6)]('Content-Disposition',_0x150e3e(0x7c)),_0x492be9['xlsx'][_0x150e3e(0xd6)](_0x36a78e)[_0x150e3e(0xb3)](()=>{_0x36a78e['status'](0xc8);});}catch(_0x548fc8){_0x36a78e[_0x150e3e(0xd5)](0x190)[_0x150e3e(0x78)]({'errors':_0x548fc8[_0x150e3e(0x8a)]});}});function a0_0x4747(_0x4870b7,_0x592a31){const _0x27a55c=a0_0x27a5();return a0_0x4747=function(_0x4747df,_0x2929ed){_0x4747df=_0x4747df-0x72;let _0x556aeb=_0x27a55c[_0x4747df];return _0x556aeb;},a0_0x4747(_0x4870b7,_0x592a31);}const storage1=multer['diskStorage']({'destination':(_0x5d5ea0,_0x39f043,_0x13bf2d)=>{const _0x57e137=a0_0x1bb301;_0x13bf2d(null,_0x57e137(0xc0));},'filename':(_0x3e7b99,_0x3b8ca9,_0x1f485f)=>{const _0x152c0d=a0_0x1bb301;_0x1f485f(null,Date[_0x152c0d(0x77)]()+_0x3b8ca9['originalname']);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x1bb301(0xab)](a0_0x1bb301(0x8f),auth,uploadMigrate[a0_0x1bb301(0xbc)](a0_0x1bb301(0xcf)),async(_0x4e8017,_0x58b215)=>{const _0x510e0d=a0_0x1bb301,_0x514147=_0x4e8017[_0x510e0d(0xaf)]['filename'],_0x9ed5bb=await xlsx['readFile'](_0x510e0d(0xa2)+_0x514147);let _0x21d9bf=_0x9ed5bb[_0x510e0d(0x8b)],_0x1de8f0=xlsx[_0x510e0d(0x89)]['sheet_to_json'](_0x9ed5bb[_0x510e0d(0xb7)][_0x21d9bf[0x0]]);for(const _0x1a7841 of _0x1de8f0){const _0x3054d2=_0x1a7841['ID'],_0x42815d=_0x1a7841['Name'],_0x444bfb=_0x1a7841[_0x510e0d(0xae)],_0x3ca2be=_0x1a7841[_0x510e0d(0xbf)],_0x27e698=_0x1a7841[_0x510e0d(0x86)],_0x54503e=_0x1a7841['mobile'],_0xf60fda=_0x1a7841['email'];try{let _0x5bcc3f=await customer[_0x510e0d(0x90)]({'name':_0x42815d});if(!_0x5bcc3f){const _0xa1964=new customer({'name':_0x42815d,'ID':_0x3054d2,'SalesmanCode':_0x444bfb,'SalesmanName':_0x3ca2be,'address':_0x27e698,'mobile':_0x54503e,'email':_0xf60fda});_0x5bcc3f=await _0xa1964[_0x510e0d(0x96)](),_0x4e8017[_0x510e0d(0xc6)]('success',_0x42815d+_0x510e0d(0x74));}else _0x4e8017[_0x510e0d(0xc6)](_0x510e0d(0xa9),_0x42815d+_0x510e0d(0x72));}catch(_0x594ee6){_0x58b215[_0x510e0d(0xd5)](0x1f4)['json']({'proderror':_0x594ee6['message'],'aproduct':ProductName});}}_0x58b215['redirect'](_0x510e0d(0xd3));}),module[a0_0x1bb301(0xa3)]=router;