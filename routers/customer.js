const a0_0x1c386a=a0_0x418e;(function(_0x1e3315,_0x2fda70){const _0x1f53f2=a0_0x418e,_0x2763e2=_0x1e3315();while(!![]){try{const _0x1ba397=-parseInt(_0x1f53f2(0x224))/0x1+parseInt(_0x1f53f2(0x223))/0x2+-parseInt(_0x1f53f2(0x236))/0x3+parseInt(_0x1f53f2(0x241))/0x4+-parseInt(_0x1f53f2(0x1fa))/0x5+parseInt(_0x1f53f2(0x23d))/0x6+parseInt(_0x1f53f2(0x201))/0x7;if(_0x1ba397===_0x2fda70)break;else _0x2763e2['push'](_0x2763e2['shift']());}catch(_0x199299){_0x2763e2['push'](_0x2763e2['shift']());}}}(a0_0x13d6,0x23b5f));function a0_0x418e(_0x33653b,_0x3a8a8d){const _0x13d63b=a0_0x13d6();return a0_0x418e=function(_0x418e8e,_0x13b133){_0x418e8e=_0x418e8e-0x1dc;let _0x4f502d=_0x13d63b[_0x418e8e];return _0x4f502d;},a0_0x418e(_0x33653b,_0x3a8a8d);}const express=require('express'),app=express(),router=express[a0_0x1c386a(0x23f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x1c386a(0x222)),users=require(a0_0x1c386a(0x20f)),excelJS=require(a0_0x1c386a(0x20d)),xlsx=require(a0_0x1c386a(0x1f4)),multer=require(a0_0x1c386a(0x1f2));function a0_0x13d6(){const _0x3bc4ab=['Portuguese','744335zbPTHz','findById','English','message','SalesmanName','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','file','1689338FQDruy','body','payment_data','$amount','columns','Customers','\x20Failed','$reason','receivable','sheet_to_json','element','SalesmanCode','exceljs','exports','../public/language/languages.json','/view/:id','email','/view','render','single','post','data','French','PBrands','forEach','master','mobile','address','English\x20(US)','errors','customer\x20update\x20successfully','filename','Portuguese\x20(BR)','../middleware/auth','427548hZdLYq','194907ZZHHkk','customer','customer_payment','aggregate','Sheets','json','payable_sum','error','diskStorage','Chinese','/view/payment/:id','sale','originalname','setHeader','redirect','success','log','findOne','805611rriTWa','Content-Type','get','landline','receivable_sum','c_payments','utils','947538TytCrs','German','Router','amount','582204YUTRWc','Name','Hindi','params','user','Arabic\x20(ae)','customer_docs','attachment;\x20filename=customer_Migration_File.xlsx','status','addWorksheet','Content-Disposition','Workbook','SheetNames','PName','find','language','flash','Sale\x20Return','Arabic','name','now','Spanish','readFile','\x20added\x20successfully','map','save','reason','multer','customer_product_fule','xlsx','contactperson','PUnits','sale_return','Sale'];a0_0x13d6=function(){return _0x3bc4ab;};return a0_0x13d6();}router['get']('/view',auth,async(_0x7370d4,_0xca9e1)=>{const _0x3a3b0b=a0_0x1c386a;try{const {username:_0x2f3ffa,email:_0x5ca412,role:_0x39bc39}=_0x7370d4[_0x3a3b0b(0x245)],_0x6caee8=_0x7370d4[_0x3a3b0b(0x245)],_0x29840c=await profile[_0x3a3b0b(0x235)]({'email':_0x6caee8['email']}),_0x509578=await master_shop[_0x3a3b0b(0x1e5)]();console['log'](_0x3a3b0b(0x21a),_0x509578);const _0x22045f=await customer[_0x3a3b0b(0x1e5)](),_0x119b58=await customer[_0x3a3b0b(0x227)]([{'$lookup':{'from':_0x3a3b0b(0x23b),'localField':_0x3a3b0b(0x1ea),'foreignField':'customer','as':_0x3a3b0b(0x1dd)}}]);console[_0x3a3b0b(0x234)](_0x119b58);const _0x56acfc=_0x119b58[_0x3a3b0b(0x1ef)](_0x114de3=>{const _0x3f2b0d=_0x3a3b0b;console[_0x3f2b0d(0x234)](_0x3f2b0d(0x216),_0x114de3);var _0x3fd3a3=0x0,_0x2280f6=0x0;return _0x114de3[_0x3f2b0d(0x1dd)][_0x3f2b0d(0x219)](_0x7d85e3=>{const _0x30e916=_0x3f2b0d;console[_0x30e916(0x234)](_0x30e916(0x20b),_0x7d85e3),_0x7d85e3[_0x30e916(0x1f1)]=='Sale'?_0x3fd3a3+=_0x7d85e3[_0x30e916(0x240)]:_0x2280f6+=_0x7d85e3[_0x30e916(0x240)];}),_0x114de3[_0x3f2b0d(0x22f)]=parseFloat(_0x3fd3a3)+0x0,_0x114de3[_0x3f2b0d(0x1f7)]=parseFloat(_0x2280f6)+0x0,_0x114de3;});console[_0x3a3b0b(0x234)](_0x3a3b0b(0x203),_0x56acfc);if(_0x509578[0x0][_0x3a3b0b(0x1e6)]==_0x3a3b0b(0x21d)){var _0x4b42a0=users[_0x3a3b0b(0x1fc)];console[_0x3a3b0b(0x234)](_0x4b42a0);}else{if(_0x509578[0x0][_0x3a3b0b(0x1e6)]==_0x3a3b0b(0x243))var _0x4b42a0=users[_0x3a3b0b(0x243)];else{if(_0x509578[0x0]['language']==_0x3a3b0b(0x23e))var _0x4b42a0=users[_0x3a3b0b(0x23e)];else{if(_0x509578[0x0][_0x3a3b0b(0x1e6)]==_0x3a3b0b(0x1ec))var _0x4b42a0=users['Spanish'];else{if(_0x509578[0x0][_0x3a3b0b(0x1e6)]==_0x3a3b0b(0x217))var _0x4b42a0=users[_0x3a3b0b(0x217)];else{if(_0x509578[0x0][_0x3a3b0b(0x1e6)]==_0x3a3b0b(0x221))var _0x4b42a0=users['Portuguese'];else{if(_0x509578[0x0]['language']==_0x3a3b0b(0x22d))var _0x4b42a0=users[_0x3a3b0b(0x22d)];else{if(_0x509578[0x0][_0x3a3b0b(0x1e6)]==_0x3a3b0b(0x1dc))var _0x4b42a0=users[_0x3a3b0b(0x1e9)];}}}}}}}_0xca9e1[_0x3a3b0b(0x213)]('customer',{'success':_0x7370d4[_0x3a3b0b(0x1e7)](_0x3a3b0b(0x233)),'errors':_0x7370d4[_0x3a3b0b(0x1e7)]('errors'),'user':_0x22045f,'role':_0x6caee8,'profile':_0x29840c,'payment':_0x56acfc,'master_shop':_0x509578,'language':_0x4b42a0});}catch(_0x19510d){console['log'](_0x19510d);}}),router[a0_0x1c386a(0x215)](a0_0x1c386a(0x212),auth,async(_0x294f38,_0x47854e)=>{const _0x337282=a0_0x1c386a;try{const {name:_0x2aaece,address:_0x1b9d17,mobile:_0x361481,email:_0x4ed1ac,receivable:_0x101ed7,payable:_0x427411,contactperson:_0x1be83c,landline:_0x83aa77}=_0x294f38[_0x337282(0x202)],_0x651619=new customer({'name':_0x2aaece,'address':_0x1b9d17,'mobile':_0x361481,'email':_0x4ed1ac,'receivable':_0x101ed7,'payable':_0x427411,'contactperson':_0x1be83c,'landline':_0x83aa77}),_0x1c671a=await _0x651619['save']();_0x294f38[_0x337282(0x1e7)]('success','customer\x20add\x20successfully'),_0x47854e[_0x337282(0x232)]('/customer/view');}catch(_0x35ba42){console[_0x337282(0x234)](_0x35ba42);}}),router['get'](a0_0x1c386a(0x210),auth,async(_0x31f5a5,_0x4996e4)=>{const _0x8656af=a0_0x1c386a;try{const {username:_0x189873,email:_0x1970d3,role:_0xe1daac}=_0x31f5a5['user'],_0x459759=_0x31f5a5['user'],_0x2fbe0b=await profile['findOne']({'email':_0x459759[_0x8656af(0x211)]}),_0x377631=await master_shop[_0x8656af(0x1e5)]();console[_0x8656af(0x234)]('master',_0x377631);const _0x5799f3=_0x31f5a5[_0x8656af(0x244)]['id'],_0xbcb68=await customer[_0x8656af(0x1fb)](_0x5799f3);if(_0x377631[0x0][_0x8656af(0x1e6)]==_0x8656af(0x21d)){var _0x2aa14e=users[_0x8656af(0x1fc)];console[_0x8656af(0x234)](_0x2aa14e);}else{if(_0x377631[0x0][_0x8656af(0x1e6)]==_0x8656af(0x243))var _0x2aa14e=users[_0x8656af(0x243)];else{if(_0x377631[0x0][_0x8656af(0x1e6)]=='German')var _0x2aa14e=users[_0x8656af(0x23e)];else{if(_0x377631[0x0][_0x8656af(0x1e6)]==_0x8656af(0x1ec))var _0x2aa14e=users[_0x8656af(0x1ec)];else{if(_0x377631[0x0][_0x8656af(0x1e6)]==_0x8656af(0x217))var _0x2aa14e=users['French'];else{if(_0x377631[0x0][_0x8656af(0x1e6)]==_0x8656af(0x221))var _0x2aa14e=users[_0x8656af(0x1f9)];else{if(_0x377631[0x0][_0x8656af(0x1e6)]=='Chinese')var _0x2aa14e=users[_0x8656af(0x22d)];else{if(_0x377631[0x0][_0x8656af(0x1e6)]=='Arabic\x20(ae)')var _0x2aa14e=users[_0x8656af(0x1e9)];}}}}}}}_0x4996e4[_0x8656af(0x213)](_0x8656af(0x225),{'success':_0x31f5a5[_0x8656af(0x1e7)](_0x8656af(0x233)),'errors':_0x31f5a5[_0x8656af(0x1e7)]('errors'),'role':_0x459759,'profile':_0x2fbe0b,'user':_0xbcb68,'master_shop':_0x377631,'language':_0x2aa14e});}catch(_0x18c05f){console['log'](_0x18c05f);}}),router[a0_0x1c386a(0x215)](a0_0x1c386a(0x210),auth,async(_0x5d321b,_0x3bb5b9)=>{const _0x158ca4=a0_0x1c386a;try{const _0x1b0912=_0x5d321b[_0x158ca4(0x244)]['id'],_0x46395c=await customer[_0x158ca4(0x1fb)](_0x1b0912),{name:_0x1e5920,address:_0x7af1e9,mobile:_0x385dce,email:_0x110364,receivable:_0x305f0e,payable:_0x246951,contactperson:_0x2a2992,landline:_0x190fce}=_0x5d321b['body'];_0x46395c['name']=_0x1e5920,_0x46395c[_0x158ca4(0x21c)]=_0x7af1e9,_0x46395c[_0x158ca4(0x21b)]=_0x385dce,_0x46395c['email']=_0x110364,_0x46395c[_0x158ca4(0x209)]=_0x305f0e,_0x46395c['payable']=_0x246951,_0x46395c[_0x158ca4(0x1f5)]=_0x2a2992,_0x46395c[_0x158ca4(0x239)]=_0x190fce;const _0x475fd7=await _0x46395c[_0x158ca4(0x1f0)]();_0x5d321b['flash'](_0x158ca4(0x233),_0x158ca4(0x21f)),_0x3bb5b9[_0x158ca4(0x232)]('/customer/view');}catch(_0x6e8578){console['log'](_0x6e8578);}}),router[a0_0x1c386a(0x238)](a0_0x1c386a(0x22e),auth,async(_0x3881ed,_0x23a0d7)=>{const _0x3d9a1e=a0_0x1c386a;try{const {username:_0x37e28d,email:_0x1cc581,role:_0x4dde71}=_0x3881ed[_0x3d9a1e(0x245)],_0x54f6c3=_0x3881ed[_0x3d9a1e(0x245)],_0x8b8c31=await profile['findOne']({'email':_0x54f6c3[_0x3d9a1e(0x211)]}),_0x48c7ce=await master_shop[_0x3d9a1e(0x1e5)]();console['log'](_0x3d9a1e(0x21a),_0x48c7ce),console[_0x3d9a1e(0x234)](_0x3881ed[_0x3d9a1e(0x244)]['id']);const _0x407c7f=await customer[_0x3d9a1e(0x235)]({'_id':_0x3881ed[_0x3d9a1e(0x244)]['id']});console[_0x3d9a1e(0x234)]('customer_data',_0x407c7f);const _0x43ac05=await c_payment_data['find']({'customer':_0x407c7f[_0x3d9a1e(0x1ea)]});console[_0x3d9a1e(0x234)](_0x43ac05);const _0x282546=await c_payment_data[_0x3d9a1e(0x227)]([{'$match':{'customer':_0x407c7f['name']}},{'$match':{'reason':_0x3d9a1e(0x1f8)}},{'$group':{'_id':_0x3d9a1e(0x208),'sum':{'$sum':'$amount'}}}]);console[_0x3d9a1e(0x234)](_0x3d9a1e(0x22a),_0x282546);const _0x5da8cb=await c_payment_data[_0x3d9a1e(0x227)]([{'$match':{'customer':_0x407c7f[_0x3d9a1e(0x1ea)]}},{'$match':{'reason':_0x3d9a1e(0x1e8)}},{'$group':{'_id':_0x3d9a1e(0x208),'sum':{'$sum':_0x3d9a1e(0x204)}}}]);console[_0x3d9a1e(0x234)](_0x3d9a1e(0x23a),_0x5da8cb);if(_0x48c7ce[0x0][_0x3d9a1e(0x1e6)]==_0x3d9a1e(0x21d)){var _0x15fee8=users['English'];console['log'](_0x15fee8);}else{if(_0x48c7ce[0x0][_0x3d9a1e(0x1e6)]=='Hindi')var _0x15fee8=users[_0x3d9a1e(0x243)];else{if(_0x48c7ce[0x0][_0x3d9a1e(0x1e6)]=='German')var _0x15fee8=users['German'];else{if(_0x48c7ce[0x0][_0x3d9a1e(0x1e6)]==_0x3d9a1e(0x1ec))var _0x15fee8=users[_0x3d9a1e(0x1ec)];else{if(_0x48c7ce[0x0][_0x3d9a1e(0x1e6)]=='French')var _0x15fee8=users[_0x3d9a1e(0x217)];else{if(_0x48c7ce[0x0][_0x3d9a1e(0x1e6)]=='Portuguese\x20(BR)')var _0x15fee8=users[_0x3d9a1e(0x1f9)];else{if(_0x48c7ce[0x0]['language']=='Chinese')var _0x15fee8=users[_0x3d9a1e(0x22d)];else{if(_0x48c7ce[0x0]['language']==_0x3d9a1e(0x1dc))var _0x15fee8=users[_0x3d9a1e(0x1e9)];}}}}}}}_0x23a0d7[_0x3d9a1e(0x213)](_0x3d9a1e(0x226),{'success':_0x3881ed['flash']('success'),'errors':_0x3881ed[_0x3d9a1e(0x1e7)](_0x3d9a1e(0x21e)),'role':_0x54f6c3,'profile':_0x8b8c31,'payment':_0x43ac05,'payable':_0x282546,'receivable':_0x5da8cb,'master_shop':_0x48c7ce,'language':_0x15fee8});}catch(_0x4606b3){console[_0x3d9a1e(0x234)](_0x4606b3);}}),router['get']('/products_export_migrate_file',auth,async(_0x40409d,_0x1bf70e)=>{const _0x578157=a0_0x1c386a;try{const _0x435434=new excelJS[(_0x578157(0x1e2))](),_0x20d30c=_0x435434[_0x578157(0x1e0)](_0x578157(0x206));return _0x20d30c[_0x578157(0x205)]=[{'header':'ID','key':_0x578157(0x1e4),'width':0xa},{'header':_0x578157(0x242),'key':_0x578157(0x218),'width':0xa},{'header':'SalesmanCode','key':_0x578157(0x1f6),'width':0xa},{'header':_0x578157(0x1fe),'key':_0x578157(0x1fe),'width':0xa},{'header':_0x578157(0x21c),'key':_0x578157(0x21c),'width':0xa},{'header':'mobile','key':'mobile','width':0xa},{'header':_0x578157(0x211),'key':_0x578157(0x211),'width':0xa}],_0x1bf70e['setHeader'](_0x578157(0x237),_0x578157(0x1ff)),_0x1bf70e[_0x578157(0x231)](_0x578157(0x1e1),_0x578157(0x1de)),_0x435434['xlsx']['write'](_0x1bf70e)['then'](()=>{const _0x6ad5ed=_0x578157;_0x1bf70e[_0x6ad5ed(0x1df)](0xc8);});}catch(_0xf78e07){_0x1bf70e[_0x578157(0x1df)](0x190)['send']({'errors':_0xf78e07[_0x578157(0x1fd)]});}});const storage1=multer[a0_0x1c386a(0x22c)]({'destination':(_0x218a8b,_0x413710,_0x2fc997)=>{_0x2fc997(null,'public/Migration');},'filename':(_0x2c2075,_0xe82f2,_0x137d99)=>{const _0x4b0fae=a0_0x1c386a;_0x137d99(null,Date[_0x4b0fae(0x1eb)]()+_0xe82f2[_0x4b0fae(0x230)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x1c386a(0x215)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x1c386a(0x214)](a0_0x1c386a(0x1f3)),async(_0x3037b2,_0x506be3)=>{const _0x45e805=a0_0x1c386a,_0x46cb66=_0x3037b2[_0x45e805(0x200)][_0x45e805(0x220)],_0x38a8fd=await xlsx[_0x45e805(0x1ed)]('public/Migration/'+_0x46cb66);let _0x40f12a=_0x38a8fd[_0x45e805(0x1e3)],_0x13900d=xlsx[_0x45e805(0x23c)][_0x45e805(0x20a)](_0x38a8fd[_0x45e805(0x228)][_0x40f12a[0x0]]);for(const _0x371920 of _0x13900d){const _0x947456=_0x371920['ID'],_0x47a985=_0x371920[_0x45e805(0x242)],_0x38111f=_0x371920[_0x45e805(0x20c)],_0x39c7fe=_0x371920[_0x45e805(0x1fe)],_0x2894e0=_0x371920['address'],_0x43309b=_0x371920['mobile'],_0x314864=_0x371920[_0x45e805(0x211)];try{let _0x16caa3=await customer[_0x45e805(0x235)]({'name':_0x47a985});if(!_0x16caa3){const _0x359558=new customer({'name':_0x47a985,'ID':_0x947456,'SalesmanCode':_0x38111f,'SalesmanName':_0x39c7fe,'address':_0x2894e0,'mobile':_0x43309b,'email':_0x314864});_0x16caa3=await _0x359558[_0x45e805(0x1f0)](),_0x3037b2[_0x45e805(0x1e7)]('success',_0x47a985+_0x45e805(0x1ee));}else _0x3037b2[_0x45e805(0x1e7)](_0x45e805(0x22b),_0x47a985+_0x45e805(0x207));}catch(_0x4e9ec5){_0x506be3['status'](0x1f4)[_0x45e805(0x229)]({'proderror':_0x4e9ec5[_0x45e805(0x1fd)],'aproduct':ProductName});}}_0x506be3['redirect']('/customer/view');}),module[a0_0x1c386a(0x20e)]=router;