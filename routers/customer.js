const a0_0x50aa3f=a0_0xc340;(function(_0x36301a,_0x2b311f){const _0x3ae494=a0_0xc340,_0x565c24=_0x36301a();while(!![]){try{const _0x7d95b5=-parseInt(_0x3ae494(0xd0))/0x1*(-parseInt(_0x3ae494(0xcc))/0x2)+parseInt(_0x3ae494(0x91))/0x3+parseInt(_0x3ae494(0xa0))/0x4+-parseInt(_0x3ae494(0x83))/0x5+-parseInt(_0x3ae494(0xb8))/0x6+parseInt(_0x3ae494(0xb0))/0x7+parseInt(_0x3ae494(0xc7))/0x8*(parseInt(_0x3ae494(0x9e))/0x9);if(_0x7d95b5===_0x2b311f)break;else _0x565c24['push'](_0x565c24['shift']());}catch(_0x3493d7){_0x565c24['push'](_0x565c24['shift']());}}}(a0_0x35a3,0x848dc));const express=require(a0_0x50aa3f(0x82)),app=express(),router=express[a0_0x50aa3f(0xa6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x50aa3f(0xd3)),users=require(a0_0x50aa3f(0xbc)),excelJS=require(a0_0x50aa3f(0xb9)),xlsx=require('xlsx'),multer=require(a0_0x50aa3f(0xca));function a0_0x35a3(){const _0x2e9821=['save','express','3092430lzameI','master','success','amount','send','utils','Sheets','/view','find','json','body','receivable_sum','/customer_import_migrate_file','c_payments','29718XpAQHJ','attachment;\x20filename=customer_Migration_File.xlsx','findOne','params','SalesmanCode','PBrands','payment_data','$reason','Chinese','flash','Customers','public/Migration','get','9wuJFkl','reason','48896TkiwfF','email','message','language','SheetNames','redirect','Router','name','log','Arabic\x20(ae)','findById','render','map','filename','Spanish','Sale','2581278pjVnsW','$amount','/customer/view','payable_sum','error','\x20Failed','originalname','file','62526utVvoK','exceljs','errors','German','../public/language/languages.json','Workbook','Arabic','Portuguese','readFile','setHeader','sale_return','French','post','public/Migration/','customer\x20add\x20successfully','5180248slJiOq','customer','Content-Disposition','multer','English','8ihLmlX','/products_export_migrate_file','contactperson','/view/:id','33358FvJJqq','payable','customer_docs','../middleware/auth','PName','SalesmanName','Content-Type','element','\x20added\x20successfully','customer_product_fule','Hindi','address','single','data','customer_payment','Portuguese\x20(BR)','user','English\x20(US)','status','aggregate','mobile'];a0_0x35a3=function(){return _0x2e9821;};return a0_0x35a3();}router[a0_0x50aa3f(0x9d)](a0_0x50aa3f(0x8a),auth,async(_0x288090,_0x37f224)=>{const _0x3c68cb=a0_0x50aa3f;try{const {username:_0x8c4581,email:_0x4e0494,role:_0x3c32d5}=_0x288090['user'],_0x425c5e=_0x288090[_0x3c68cb(0x7c)],_0x4312ff=await profile[_0x3c68cb(0x93)]({'email':_0x425c5e[_0x3c68cb(0xa1)]}),_0x581b15=await master_shop[_0x3c68cb(0x8b)]();console['log']('master',_0x581b15);const _0x23aedd=await customer['find'](),_0x23c4e0=await customer['aggregate']([{'$lookup':{'from':_0x3c68cb(0x90),'localField':'name','foreignField':_0x3c68cb(0xc8),'as':_0x3c68cb(0xd2)}}]);console['log'](_0x23c4e0);const _0x1c4086=_0x23c4e0[_0x3c68cb(0xac)](_0x34a4cb=>{const _0x25b7a6=_0x3c68cb;console[_0x25b7a6(0xa8)](_0x25b7a6(0xdd),_0x34a4cb);var _0x475bf3=0x0,_0x457632=0x0;return _0x34a4cb['customer_docs']['forEach'](_0x2242b2=>{const _0x13b3d2=_0x25b7a6;console['log'](_0x13b3d2(0xd7),_0x2242b2),_0x2242b2[_0x13b3d2(0x9f)]==_0x13b3d2(0xaf)?_0x475bf3+=_0x2242b2[_0x13b3d2(0x86)]:_0x457632+=_0x2242b2['amount'];}),_0x34a4cb['sale']=parseFloat(_0x475bf3)+0x0,_0x34a4cb[_0x25b7a6(0xc2)]=parseFloat(_0x457632)+0x0,_0x34a4cb;});console[_0x3c68cb(0xa8)](_0x3c68cb(0x97),_0x1c4086);if(_0x581b15[0x0][_0x3c68cb(0xa3)]==_0x3c68cb(0x7d)){var _0x47e285=users['English'];console['log'](_0x47e285);}else{if(_0x581b15[0x0][_0x3c68cb(0xa3)]==_0x3c68cb(0xda))var _0x47e285=users[_0x3c68cb(0xda)];else{if(_0x581b15[0x0][_0x3c68cb(0xa3)]==_0x3c68cb(0xbb))var _0x47e285=users[_0x3c68cb(0xbb)];else{if(_0x581b15[0x0]['language']==_0x3c68cb(0xae))var _0x47e285=users[_0x3c68cb(0xae)];else{if(_0x581b15[0x0][_0x3c68cb(0xa3)]==_0x3c68cb(0xc3))var _0x47e285=users[_0x3c68cb(0xc3)];else{if(_0x581b15[0x0][_0x3c68cb(0xa3)]==_0x3c68cb(0x7b))var _0x47e285=users['Portuguese'];else{if(_0x581b15[0x0]['language']==_0x3c68cb(0x99))var _0x47e285=users[_0x3c68cb(0x99)];else{if(_0x581b15[0x0]['language']==_0x3c68cb(0xa9))var _0x47e285=users[_0x3c68cb(0xbe)];}}}}}}}_0x37f224[_0x3c68cb(0xab)]('customer',{'success':_0x288090[_0x3c68cb(0x9a)]('success'),'errors':_0x288090[_0x3c68cb(0x9a)](_0x3c68cb(0xba)),'user':_0x23aedd,'role':_0x425c5e,'profile':_0x4312ff,'payment':_0x1c4086,'master_shop':_0x581b15,'language':_0x47e285});}catch(_0x3fbce5){console['log'](_0x3fbce5);}}),router['post']('/view',auth,async(_0x3944a6,_0xf69c7a)=>{const _0x578324=a0_0x50aa3f;try{const {name:_0x2c46c3,address:_0x1b6725,mobile:_0x512dca,email:_0x12f03a,receivable:_0x28b9bd,payable:_0x5555bd,contactperson:_0xd7a5c2,landline:_0x33f4db}=_0x3944a6[_0x578324(0x8d)],_0x52f3b6=new customer({'name':_0x2c46c3,'address':_0x1b6725,'mobile':_0x512dca,'email':_0x12f03a,'receivable':_0x28b9bd,'payable':_0x5555bd,'contactperson':_0xd7a5c2,'landline':_0x33f4db}),_0x3a986a=await _0x52f3b6[_0x578324(0x81)]();_0x3944a6[_0x578324(0x9a)](_0x578324(0x85),_0x578324(0xc6)),_0xf69c7a[_0x578324(0xa5)](_0x578324(0xb2));}catch(_0x10836d){console['log'](_0x10836d);}}),router[a0_0x50aa3f(0x9d)]('/view/:id',auth,async(_0x4c208a,_0xad38bf)=>{const _0x200d5c=a0_0x50aa3f;try{const {username:_0x1e59fa,email:_0x33b4b6,role:_0x39c771}=_0x4c208a[_0x200d5c(0x7c)],_0x12a35f=_0x4c208a[_0x200d5c(0x7c)],_0x421856=await profile[_0x200d5c(0x93)]({'email':_0x12a35f['email']}),_0x181600=await master_shop[_0x200d5c(0x8b)]();console[_0x200d5c(0xa8)](_0x200d5c(0x84),_0x181600);const _0x443cf7=_0x4c208a[_0x200d5c(0x94)]['id'],_0x5c8950=await customer[_0x200d5c(0xaa)](_0x443cf7);if(_0x181600[0x0]['language']=='English\x20(US)'){var _0x27cab7=users['English'];console[_0x200d5c(0xa8)](_0x27cab7);}else{if(_0x181600[0x0][_0x200d5c(0xa3)]==_0x200d5c(0xda))var _0x27cab7=users[_0x200d5c(0xda)];else{if(_0x181600[0x0][_0x200d5c(0xa3)]==_0x200d5c(0xbb))var _0x27cab7=users[_0x200d5c(0xbb)];else{if(_0x181600[0x0][_0x200d5c(0xa3)]==_0x200d5c(0xae))var _0x27cab7=users[_0x200d5c(0xae)];else{if(_0x181600[0x0][_0x200d5c(0xa3)]==_0x200d5c(0xc3))var _0x27cab7=users[_0x200d5c(0xc3)];else{if(_0x181600[0x0]['language']==_0x200d5c(0x7b))var _0x27cab7=users[_0x200d5c(0xbf)];else{if(_0x181600[0x0][_0x200d5c(0xa3)]==_0x200d5c(0x99))var _0x27cab7=users['Chinese'];else{if(_0x181600[0x0][_0x200d5c(0xa3)]==_0x200d5c(0xa9))var _0x27cab7=users[_0x200d5c(0xbe)];}}}}}}}_0xad38bf[_0x200d5c(0xab)](_0x200d5c(0xc8),{'success':_0x4c208a['flash'](_0x200d5c(0x85)),'errors':_0x4c208a[_0x200d5c(0x9a)](_0x200d5c(0xba)),'role':_0x12a35f,'profile':_0x421856,'user':_0x5c8950,'master_shop':_0x181600,'language':_0x27cab7});}catch(_0x2d8012){console['log'](_0x2d8012);}}),router[a0_0x50aa3f(0xc4)](a0_0x50aa3f(0xcf),auth,async(_0x4c2e25,_0x1b9f7f)=>{const _0x4bb3eb=a0_0x50aa3f;try{const _0x30eff2=_0x4c2e25[_0x4bb3eb(0x94)]['id'],_0x5312e7=await customer[_0x4bb3eb(0xaa)](_0x30eff2),{name:_0x2a454a,address:_0x6fd754,mobile:_0x2a47ff,email:_0x547ad0,receivable:_0x8d1158,payable:_0x23db70,contactperson:_0x2df66c,landline:_0x2f3910}=_0x4c2e25[_0x4bb3eb(0x8d)];_0x5312e7[_0x4bb3eb(0xa7)]=_0x2a454a,_0x5312e7[_0x4bb3eb(0xdb)]=_0x6fd754,_0x5312e7[_0x4bb3eb(0x80)]=_0x2a47ff,_0x5312e7[_0x4bb3eb(0xa1)]=_0x547ad0,_0x5312e7['receivable']=_0x8d1158,_0x5312e7[_0x4bb3eb(0xd1)]=_0x23db70,_0x5312e7[_0x4bb3eb(0xce)]=_0x2df66c,_0x5312e7['landline']=_0x2f3910;const _0x5486e7=await _0x5312e7[_0x4bb3eb(0x81)]();_0x4c2e25[_0x4bb3eb(0x9a)](_0x4bb3eb(0x85),'customer\x20update\x20successfully'),_0x1b9f7f[_0x4bb3eb(0xa5)](_0x4bb3eb(0xb2));}catch(_0x4143ef){console['log'](_0x4143ef);}}),router[a0_0x50aa3f(0x9d)]('/view/payment/:id',auth,async(_0x54e90d,_0x14700d)=>{const _0x54bffe=a0_0x50aa3f;try{const {username:_0x5b4425,email:_0x24e215,role:_0x4725ce}=_0x54e90d['user'],_0x3d4bc8=_0x54e90d[_0x54bffe(0x7c)],_0x50a4e3=await profile[_0x54bffe(0x93)]({'email':_0x3d4bc8[_0x54bffe(0xa1)]}),_0x2da4c2=await master_shop[_0x54bffe(0x8b)]();console['log'](_0x54bffe(0x84),_0x2da4c2),console[_0x54bffe(0xa8)](_0x54e90d[_0x54bffe(0x94)]['id']);const _0x236871=await customer[_0x54bffe(0x93)]({'_id':_0x54e90d[_0x54bffe(0x94)]['id']});console['log']('customer_data',_0x236871);const _0x1760ee=await c_payment_data['find']({'customer':_0x236871[_0x54bffe(0xa7)]});console[_0x54bffe(0xa8)](_0x1760ee);const _0x2de4f6=await c_payment_data[_0x54bffe(0x7f)]([{'$match':{'customer':_0x236871['name']}},{'$match':{'reason':_0x54bffe(0xaf)}},{'$group':{'_id':_0x54bffe(0x98),'sum':{'$sum':'$amount'}}}]);console['log'](_0x54bffe(0xb3),_0x2de4f6);const _0x16362d=await c_payment_data[_0x54bffe(0x7f)]([{'$match':{'customer':_0x236871[_0x54bffe(0xa7)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x54bffe(0x98),'sum':{'$sum':_0x54bffe(0xb1)}}}]);console['log'](_0x54bffe(0x8e),_0x16362d);if(_0x2da4c2[0x0][_0x54bffe(0xa3)]==_0x54bffe(0x7d)){var _0xe8d1eb=users[_0x54bffe(0xcb)];console[_0x54bffe(0xa8)](_0xe8d1eb);}else{if(_0x2da4c2[0x0]['language']==_0x54bffe(0xda))var _0xe8d1eb=users[_0x54bffe(0xda)];else{if(_0x2da4c2[0x0]['language']==_0x54bffe(0xbb))var _0xe8d1eb=users[_0x54bffe(0xbb)];else{if(_0x2da4c2[0x0]['language']=='Spanish')var _0xe8d1eb=users[_0x54bffe(0xae)];else{if(_0x2da4c2[0x0][_0x54bffe(0xa3)]==_0x54bffe(0xc3))var _0xe8d1eb=users[_0x54bffe(0xc3)];else{if(_0x2da4c2[0x0]['language']==_0x54bffe(0x7b))var _0xe8d1eb=users['Portuguese'];else{if(_0x2da4c2[0x0][_0x54bffe(0xa3)]==_0x54bffe(0x99))var _0xe8d1eb=users[_0x54bffe(0x99)];else{if(_0x2da4c2[0x0][_0x54bffe(0xa3)]==_0x54bffe(0xa9))var _0xe8d1eb=users['Arabic'];}}}}}}}_0x14700d['render'](_0x54bffe(0x7a),{'success':_0x54e90d[_0x54bffe(0x9a)](_0x54bffe(0x85)),'errors':_0x54e90d[_0x54bffe(0x9a)](_0x54bffe(0xba)),'role':_0x3d4bc8,'profile':_0x50a4e3,'payment':_0x1760ee,'payable':_0x2de4f6,'receivable':_0x16362d,'master_shop':_0x2da4c2,'language':_0xe8d1eb});}catch(_0x42bebc){console['log'](_0x42bebc);}}),router[a0_0x50aa3f(0x9d)](a0_0x50aa3f(0xcd),auth,async(_0x1f0609,_0x50e5bc)=>{const _0x7028c4=a0_0x50aa3f;try{const _0x2e943f=new excelJS[(_0x7028c4(0xbd))](),_0x37f7ff=_0x2e943f['addWorksheet'](_0x7028c4(0x9b));return _0x37f7ff['columns']=[{'header':'ID','key':_0x7028c4(0xd4),'width':0xa},{'header':'Name','key':_0x7028c4(0x96),'width':0xa},{'header':_0x7028c4(0x95),'key':'PUnits','width':0xa},{'header':_0x7028c4(0xd5),'key':_0x7028c4(0xd5),'width':0xa},{'header':_0x7028c4(0xdb),'key':_0x7028c4(0xdb),'width':0xa},{'header':_0x7028c4(0x80),'key':'mobile','width':0xa},{'header':'email','key':_0x7028c4(0xa1),'width':0xa}],_0x50e5bc[_0x7028c4(0xc1)](_0x7028c4(0xd6),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x50e5bc['setHeader'](_0x7028c4(0xc9),_0x7028c4(0x92)),_0x2e943f['xlsx']['write'](_0x50e5bc)['then'](()=>{const _0xd3f617=_0x7028c4;_0x50e5bc[_0xd3f617(0x7e)](0xc8);});}catch(_0x529461){_0x50e5bc['status'](0x190)[_0x7028c4(0x87)]({'errors':_0x529461['message']});}});function a0_0xc340(_0x124c46,_0x57ae57){const _0x35a34c=a0_0x35a3();return a0_0xc340=function(_0xc3407b,_0x20be97){_0xc3407b=_0xc3407b-0x7a;let _0xa5f7b2=_0x35a34c[_0xc3407b];return _0xa5f7b2;},a0_0xc340(_0x124c46,_0x57ae57);}const storage1=multer['diskStorage']({'destination':(_0x24c9f0,_0x276559,_0xc82837)=>{const _0x433c97=a0_0x50aa3f;_0xc82837(null,_0x433c97(0x9c));},'filename':(_0x51e51b,_0x13bcc3,_0x3f29c9)=>{const _0x5be7d8=a0_0x50aa3f;_0x3f29c9(null,Date['now']()+_0x13bcc3[_0x5be7d8(0xb6)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x50aa3f(0x8f),auth,uploadMigrate[a0_0x50aa3f(0xdc)](a0_0x50aa3f(0xd9)),async(_0x5571ff,_0x40e911)=>{const _0x3a45b6=a0_0x50aa3f,_0x2618af=_0x5571ff[_0x3a45b6(0xb7)][_0x3a45b6(0xad)],_0x224995=await xlsx[_0x3a45b6(0xc0)](_0x3a45b6(0xc5)+_0x2618af);let _0x7c91b7=_0x224995[_0x3a45b6(0xa4)],_0x9b4b9=xlsx[_0x3a45b6(0x88)]['sheet_to_json'](_0x224995[_0x3a45b6(0x89)][_0x7c91b7[0x0]]);for(const _0x561cdf of _0x9b4b9){const _0x5a0bd2=_0x561cdf['ID'],_0x1fa1bf=_0x561cdf['Name'],_0x260fd7=_0x561cdf[_0x3a45b6(0x95)],_0x296a94=_0x561cdf[_0x3a45b6(0xd5)],_0x166431=_0x561cdf[_0x3a45b6(0xdb)],_0x4bbce6=_0x561cdf['mobile'],_0x4d86e4=_0x561cdf[_0x3a45b6(0xa1)];try{let _0x579e63=await customer[_0x3a45b6(0x93)]({'name':_0x1fa1bf});if(!_0x579e63){const _0x28aab4=new customer({'name':_0x1fa1bf,'ID':_0x5a0bd2,'SalesmanCode':_0x260fd7,'SalesmanName':_0x296a94,'address':_0x166431,'mobile':_0x4bbce6,'email':_0x4d86e4});_0x579e63=await _0x28aab4[_0x3a45b6(0x81)](),_0x5571ff[_0x3a45b6(0x9a)](_0x3a45b6(0x85),_0x1fa1bf+_0x3a45b6(0xd8));}else _0x5571ff[_0x3a45b6(0x9a)](_0x3a45b6(0xb4),_0x1fa1bf+_0x3a45b6(0xb5));}catch(_0x5a3180){_0x40e911[_0x3a45b6(0x7e)](0x1f4)[_0x3a45b6(0x8c)]({'proderror':_0x5a3180[_0x3a45b6(0xa2)],'aproduct':ProductName});}}_0x40e911[_0x3a45b6(0xa5)](_0x3a45b6(0xb2));}),module['exports']=router;