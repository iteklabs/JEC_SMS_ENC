const a0_0x597861=a0_0xa71c;(function(_0x1b1348,_0x1ba374){const _0x4d8d62=a0_0xa71c,_0x303085=_0x1b1348();while(!![]){try{const _0x58227e=-parseInt(_0x4d8d62(0xfa))/0x1+-parseInt(_0x4d8d62(0xc8))/0x2+-parseInt(_0x4d8d62(0xc5))/0x3*(parseInt(_0x4d8d62(0xb8))/0x4)+parseInt(_0x4d8d62(0x9a))/0x5+parseInt(_0x4d8d62(0xb3))/0x6*(-parseInt(_0x4d8d62(0xc6))/0x7)+parseInt(_0x4d8d62(0xab))/0x8+parseInt(_0x4d8d62(0xb5))/0x9;if(_0x58227e===_0x1ba374)break;else _0x303085['push'](_0x303085['shift']());}catch(_0x267adc){_0x303085['push'](_0x303085['shift']());}}}(a0_0x37e5,0xe3d0f));const express=require('express'),app=express(),router=express[a0_0x597861(0xdd)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x597861(0xb1)),auth=require('../middleware/auth'),users=require(a0_0x597861(0xd0)),excelJS=require(a0_0x597861(0x97)),xlsx=require(a0_0x597861(0xe7)),multer=require(a0_0x597861(0xd1));router[a0_0x597861(0x9c)](a0_0x597861(0xd7),auth,async(_0x10add0,_0x4346e3)=>{const _0x51e42f=a0_0x597861;try{const {username:_0x53c937,email:_0x53269a,role:_0x2354c4}=_0x10add0[_0x51e42f(0xef)],_0xa6e442=_0x10add0[_0x51e42f(0xef)],_0x4a107a=await profile[_0x51e42f(0xe6)]({'email':_0xa6e442[_0x51e42f(0xca)]}),_0x2c3b1f=await master_shop[_0x51e42f(0xb6)]();console[_0x51e42f(0xde)](_0x51e42f(0xdb),_0x2c3b1f);const _0x109683=await customer[_0x51e42f(0xb6)](),_0x1b6129=await customer[_0x51e42f(0xc4)]([{'$lookup':{'from':_0x51e42f(0xc0),'localField':'name','foreignField':_0x51e42f(0xbb),'as':_0x51e42f(0xc7)}}]);console[_0x51e42f(0xde)](_0x1b6129);const _0x46a433=_0x1b6129['map'](_0x5cc65d=>{const _0x297f2c=_0x51e42f;console[_0x297f2c(0xde)](_0x297f2c(0xb0),_0x5cc65d);var _0x546f18=0x0,_0x2d7aea=0x0;return _0x5cc65d[_0x297f2c(0xc7)][_0x297f2c(0xea)](_0xb422fd=>{const _0x3702ed=_0x297f2c;console[_0x3702ed(0xde)](_0x3702ed(0xcc),_0xb422fd),_0xb422fd[_0x3702ed(0xc2)]=='Sale'?_0x546f18+=_0xb422fd[_0x3702ed(0xf2)]:_0x2d7aea+=_0xb422fd[_0x3702ed(0xf2)];}),_0x5cc65d[_0x297f2c(0xd9)]=parseFloat(_0x546f18)+0x0,_0x5cc65d['sale_return']=parseFloat(_0x2d7aea)+0x0,_0x5cc65d;});console[_0x51e42f(0xde)](_0x51e42f(0xb7),_0x46a433);if(_0x2c3b1f[0x0]['language']=='English\x20(US)'){var _0x50bc32=users[_0x51e42f(0xf9)];console[_0x51e42f(0xde)](_0x50bc32);}else{if(_0x2c3b1f[0x0][_0x51e42f(0xb9)]==_0x51e42f(0x9b))var _0x50bc32=users[_0x51e42f(0x9b)];else{if(_0x2c3b1f[0x0][_0x51e42f(0xb9)]=='German')var _0x50bc32=users[_0x51e42f(0xcb)];else{if(_0x2c3b1f[0x0][_0x51e42f(0xb9)]==_0x51e42f(0xc9))var _0x50bc32=users[_0x51e42f(0xc9)];else{if(_0x2c3b1f[0x0][_0x51e42f(0xb9)]==_0x51e42f(0xcd))var _0x50bc32=users[_0x51e42f(0xcd)];else{if(_0x2c3b1f[0x0][_0x51e42f(0xb9)]=='Portuguese\x20(BR)')var _0x50bc32=users[_0x51e42f(0xb2)];else{if(_0x2c3b1f[0x0][_0x51e42f(0xb9)]==_0x51e42f(0xa9))var _0x50bc32=users['Chinese'];else{if(_0x2c3b1f[0x0]['language']==_0x51e42f(0xf8))var _0x50bc32=users[_0x51e42f(0x9e)];}}}}}}}_0x4346e3['render']('customer',{'success':_0x10add0[_0x51e42f(0xe8)](_0x51e42f(0xd2)),'errors':_0x10add0[_0x51e42f(0xe8)](_0x51e42f(0xd8)),'user':_0x109683,'role':_0xa6e442,'profile':_0x4a107a,'payment':_0x46a433,'master_shop':_0x2c3b1f,'language':_0x50bc32});}catch(_0x27915d){console['log'](_0x27915d);}}),router[a0_0x597861(0xc3)](a0_0x597861(0xd7),auth,async(_0x10800d,_0x10de41)=>{const _0x634f31=a0_0x597861;try{const {name:_0x392152,address:_0x313a06,mobile:_0x3a5212,email:_0x530d03,receivable:_0x3e99ca,payable:_0x3afc3e,contactperson:_0x39c09d,landline:_0x1d4c14}=_0x10800d['body'],_0x5ccb75=new customer({'name':_0x392152,'address':_0x313a06,'mobile':_0x3a5212,'email':_0x530d03,'receivable':_0x3e99ca,'payable':_0x3afc3e,'contactperson':_0x39c09d,'landline':_0x1d4c14}),_0x33694c=await _0x5ccb75['save']();_0x10800d[_0x634f31(0xe8)](_0x634f31(0xd2),_0x634f31(0xec)),_0x10de41[_0x634f31(0xa8)](_0x634f31(0xed));}catch(_0x23dd11){console[_0x634f31(0xde)](_0x23dd11);}}),router['get'](a0_0x597861(0xac),auth,async(_0x38d626,_0x88f0d)=>{const _0x2225b2=a0_0x597861;try{const {username:_0x4ccc99,email:_0x1e8bbf,role:_0x189ad8}=_0x38d626[_0x2225b2(0xef)],_0x2ac484=_0x38d626['user'],_0x24216e=await profile[_0x2225b2(0xe6)]({'email':_0x2ac484[_0x2225b2(0xca)]}),_0x1aeb29=await master_shop[_0x2225b2(0xb6)]();console[_0x2225b2(0xde)](_0x2225b2(0xdb),_0x1aeb29);const _0x9bbe6f=_0x38d626[_0x2225b2(0xfe)]['id'],_0x5b13b3=await customer[_0x2225b2(0x9f)](_0x9bbe6f);if(_0x1aeb29[0x0][_0x2225b2(0xb9)]=='English\x20(US)'){var _0xe62dfc=users[_0x2225b2(0xf9)];console['log'](_0xe62dfc);}else{if(_0x1aeb29[0x0]['language']==_0x2225b2(0x9b))var _0xe62dfc=users[_0x2225b2(0x9b)];else{if(_0x1aeb29[0x0]['language']==_0x2225b2(0xcb))var _0xe62dfc=users[_0x2225b2(0xcb)];else{if(_0x1aeb29[0x0]['language']==_0x2225b2(0xc9))var _0xe62dfc=users[_0x2225b2(0xc9)];else{if(_0x1aeb29[0x0]['language']==_0x2225b2(0xcd))var _0xe62dfc=users[_0x2225b2(0xcd)];else{if(_0x1aeb29[0x0][_0x2225b2(0xb9)]==_0x2225b2(0xbd))var _0xe62dfc=users[_0x2225b2(0xb2)];else{if(_0x1aeb29[0x0][_0x2225b2(0xb9)]==_0x2225b2(0xa9))var _0xe62dfc=users[_0x2225b2(0xa9)];else{if(_0x1aeb29[0x0][_0x2225b2(0xb9)]==_0x2225b2(0xf8))var _0xe62dfc=users['Arabic'];}}}}}}}_0x88f0d[_0x2225b2(0xfc)](_0x2225b2(0xbb),{'success':_0x38d626['flash']('success'),'errors':_0x38d626[_0x2225b2(0xe8)](_0x2225b2(0xd8)),'role':_0x2ac484,'profile':_0x24216e,'user':_0x5b13b3,'master_shop':_0x1aeb29,'language':_0xe62dfc});}catch(_0x351def){console[_0x2225b2(0xde)](_0x351def);}}),router[a0_0x597861(0xc3)](a0_0x597861(0xac),auth,async(_0x3fc2df,_0x39f2cf)=>{const _0x30a206=a0_0x597861;try{const _0x2ae3b3=_0x3fc2df[_0x30a206(0xfe)]['id'],_0x17c7a0=await customer[_0x30a206(0x9f)](_0x2ae3b3),{name:_0xc8b243,address:_0x20dd01,mobile:_0x256ddf,email:_0x532631,receivable:_0x5a453e,payable:_0x26499e,contactperson:_0x185a1e,landline:_0x2190ef}=_0x3fc2df[_0x30a206(0xa0)];_0x17c7a0[_0x30a206(0xda)]=_0xc8b243,_0x17c7a0[_0x30a206(0xf6)]=_0x20dd01,_0x17c7a0['mobile']=_0x256ddf,_0x17c7a0[_0x30a206(0xca)]=_0x532631,_0x17c7a0[_0x30a206(0xa6)]=_0x5a453e,_0x17c7a0[_0x30a206(0xd5)]=_0x26499e,_0x17c7a0['contactperson']=_0x185a1e,_0x17c7a0['landline']=_0x2190ef;const _0x5ddef7=await _0x17c7a0['save']();_0x3fc2df['flash'](_0x30a206(0xd2),'customer\x20update\x20successfully'),_0x39f2cf['redirect']('/customer/view');}catch(_0xee354){console[_0x30a206(0xde)](_0xee354);}}),router[a0_0x597861(0x9c)](a0_0x597861(0xe2),auth,async(_0x407064,_0x5c5f72)=>{const _0x30ec6b=a0_0x597861;try{const {username:_0x2e8f90,email:_0x3baded,role:_0x1475b5}=_0x407064[_0x30ec6b(0xef)],_0x28beeb=_0x407064[_0x30ec6b(0xef)],_0x3ee661=await profile[_0x30ec6b(0xe6)]({'email':_0x28beeb[_0x30ec6b(0xca)]}),_0xea2e17=await master_shop[_0x30ec6b(0xb6)]();console[_0x30ec6b(0xde)](_0x30ec6b(0xdb),_0xea2e17),console[_0x30ec6b(0xde)](_0x407064[_0x30ec6b(0xfe)]['id']);const _0x2d7577=await customer[_0x30ec6b(0xe6)]({'_id':_0x407064[_0x30ec6b(0xfe)]['id']});console[_0x30ec6b(0xde)](_0x30ec6b(0xe9),_0x2d7577);const _0x37e8a7=await c_payment_data[_0x30ec6b(0xb6)]({'customer':_0x2d7577[_0x30ec6b(0xda)]});console[_0x30ec6b(0xde)](_0x37e8a7);const _0x63c227=await c_payment_data['aggregate']([{'$match':{'customer':_0x2d7577['name']}},{'$match':{'reason':_0x30ec6b(0xf5)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x30ec6b(0xba)}}}]);console['log'](_0x30ec6b(0xe3),_0x63c227);const _0x415db4=await c_payment_data['aggregate']([{'$match':{'customer':_0x2d7577[_0x30ec6b(0xda)]}},{'$match':{'reason':_0x30ec6b(0xaa)}},{'$group':{'_id':_0x30ec6b(0xe0),'sum':{'$sum':'$amount'}}}]);console[_0x30ec6b(0xde)](_0x30ec6b(0xee),_0x415db4);if(_0xea2e17[0x0][_0x30ec6b(0xb9)]==_0x30ec6b(0xbc)){var _0x28d3f7=users['English'];console[_0x30ec6b(0xde)](_0x28d3f7);}else{if(_0xea2e17[0x0][_0x30ec6b(0xb9)]==_0x30ec6b(0x9b))var _0x28d3f7=users[_0x30ec6b(0x9b)];else{if(_0xea2e17[0x0]['language']==_0x30ec6b(0xcb))var _0x28d3f7=users[_0x30ec6b(0xcb)];else{if(_0xea2e17[0x0][_0x30ec6b(0xb9)]=='Spanish')var _0x28d3f7=users[_0x30ec6b(0xc9)];else{if(_0xea2e17[0x0][_0x30ec6b(0xb9)]==_0x30ec6b(0xcd))var _0x28d3f7=users[_0x30ec6b(0xcd)];else{if(_0xea2e17[0x0][_0x30ec6b(0xb9)]==_0x30ec6b(0xbd))var _0x28d3f7=users['Portuguese'];else{if(_0xea2e17[0x0]['language']==_0x30ec6b(0xa9))var _0x28d3f7=users[_0x30ec6b(0xa9)];else{if(_0xea2e17[0x0][_0x30ec6b(0xb9)]=='Arabic\x20(ae)')var _0x28d3f7=users[_0x30ec6b(0x9e)];}}}}}}}_0x5c5f72[_0x30ec6b(0xfc)]('customer_payment',{'success':_0x407064['flash'](_0x30ec6b(0xd2)),'errors':_0x407064[_0x30ec6b(0xe8)](_0x30ec6b(0xd8)),'role':_0x28beeb,'profile':_0x3ee661,'payment':_0x37e8a7,'payable':_0x63c227,'receivable':_0x415db4,'master_shop':_0xea2e17,'language':_0x28d3f7});}catch(_0x5a4097){console['log'](_0x5a4097);}}),router[a0_0x597861(0x9c)]('/products_export_migrate_file',auth,async(_0xbc326f,_0x361a40)=>{const _0x4df6dd=a0_0x597861;try{const _0x14ff26=new excelJS['Workbook'](),_0x2b0358=_0x14ff26[_0x4df6dd(0xdc)](_0x4df6dd(0xa1));return _0x2b0358[_0x4df6dd(0xdf)]=[{'header':'ID','key':_0x4df6dd(0x98),'width':0xa},{'header':_0x4df6dd(0xbf),'key':_0x4df6dd(0xa3),'width':0xa},{'header':'SalesmanCode','key':'PUnits','width':0xa},{'header':_0x4df6dd(0x96),'key':_0x4df6dd(0x96),'width':0xa},{'header':_0x4df6dd(0xf6),'key':_0x4df6dd(0xf6),'width':0xa},{'header':'mobile','key':_0x4df6dd(0xfd),'width':0xa},{'header':'email','key':_0x4df6dd(0xca),'width':0xa}],_0x361a40[_0x4df6dd(0xe4)](_0x4df6dd(0xc1),_0x4df6dd(0xa7)),_0x361a40[_0x4df6dd(0xe4)](_0x4df6dd(0xce),_0x4df6dd(0xfb)),_0x14ff26[_0x4df6dd(0xe7)][_0x4df6dd(0xd6)](_0x361a40)[_0x4df6dd(0xcf)](()=>{const _0x4ac47c=_0x4df6dd;_0x361a40[_0x4ac47c(0xf4)](0xc8);});}catch(_0xda3a67){_0x361a40['status'](0x190)[_0x4df6dd(0xe5)]({'errors':_0xda3a67['message']});}});function a0_0xa71c(_0x3812ce,_0x28bf23){const _0x37e54d=a0_0x37e5();return a0_0xa71c=function(_0xa71c66,_0x26b83e){_0xa71c66=_0xa71c66-0x96;let _0x278068=_0x37e54d[_0xa71c66];return _0x278068;},a0_0xa71c(_0x3812ce,_0x28bf23);}const storage1=multer[a0_0x597861(0x99)]({'destination':(_0x53071f,_0x119054,_0x467b7d)=>{const _0x483b6e=a0_0x597861;_0x467b7d(null,_0x483b6e(0xa4));},'filename':(_0x33b837,_0x385472,_0x170cd7)=>{const _0x457696=a0_0x597861;_0x170cd7(null,Date['now']()+_0x385472[_0x457696(0x9d)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x37e5(){const _0x525325=['master','addWorksheet','Router','log','columns','$reason','sheet_to_json','/view/payment/:id','payable_sum','setHeader','send','findOne','xlsx','flash','customer_data','forEach','save','customer\x20add\x20successfully','/customer/view','receivable_sum','user','Sheets','\x20Failed','amount','utils','status','Sale','address','exports','Arabic\x20(ae)','English','563640YZgQsZ','attachment;\x20filename=customer_Migration_File.xlsx','render','mobile','params','single','SalesmanName','exceljs','PName','diskStorage','6979645ExIWEu','Hindi','get','originalname','Arabic','findById','body','Customers','json','PBrands','public/Migration','readFile','receivable','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','redirect','Chinese','Sale\x20Return','4451552PqOpze','/view/:id','filename','SalesmanCode','/customer_import_migrate_file','data','../models/all_models','Portuguese','6vJfPID','file','24010812yWNjKF','find','payment_data','12296YXoaNY','language','$amount','customer','English\x20(US)','Portuguese\x20(BR)','message','Name','c_payments','Content-Type','reason','post','aggregate','1731vgfOYp','2155293eSbRhd','customer_docs','2083738HLlqKE','Spanish','email','German','element','French','Content-Disposition','then','../public/language/languages.json','multer','success','SheetNames','public/Migration/','payable','write','/view','errors','sale','name'];a0_0x37e5=function(){return _0x525325;};return a0_0x37e5();}router['post'](a0_0x597861(0xaf),auth,uploadMigrate[a0_0x597861(0xff)]('customer_product_fule'),async(_0x57383c,_0x4d7767)=>{const _0x5d8bc7=a0_0x597861,_0x1504ed=_0x57383c[_0x5d8bc7(0xb4)][_0x5d8bc7(0xad)],_0x3326e5=await xlsx[_0x5d8bc7(0xa5)](_0x5d8bc7(0xd4)+_0x1504ed);let _0x1468be=_0x3326e5[_0x5d8bc7(0xd3)],_0x2825f0=xlsx[_0x5d8bc7(0xf3)][_0x5d8bc7(0xe1)](_0x3326e5[_0x5d8bc7(0xf0)][_0x1468be[0x0]]);for(const _0x31f781 of _0x2825f0){const _0x4d0d8b=_0x31f781['ID'],_0x93dde0=_0x31f781[_0x5d8bc7(0xbf)],_0x40d707=_0x31f781[_0x5d8bc7(0xae)],_0xeac0ec=_0x31f781[_0x5d8bc7(0x96)],_0x57bed7=_0x31f781[_0x5d8bc7(0xf6)],_0x657598=_0x31f781[_0x5d8bc7(0xfd)],_0x5e7ab0=_0x31f781[_0x5d8bc7(0xca)];try{let _0x383573=await customer[_0x5d8bc7(0xe6)]({'name':_0x93dde0});if(!_0x383573){const _0x42b9ef=new customer({'name':_0x93dde0,'ID':_0x4d0d8b,'SalesmanCode':_0x40d707,'SalesmanName':_0xeac0ec,'address':_0x57bed7,'mobile':_0x657598,'email':_0x5e7ab0});_0x383573=await _0x42b9ef[_0x5d8bc7(0xeb)](),_0x57383c[_0x5d8bc7(0xe8)](_0x5d8bc7(0xd2),_0x93dde0+'\x20added\x20successfully');}else _0x57383c[_0x5d8bc7(0xe8)]('error',_0x93dde0+_0x5d8bc7(0xf1));}catch(_0x422db3){_0x4d7767[_0x5d8bc7(0xf4)](0x1f4)[_0x5d8bc7(0xa2)]({'proderror':_0x422db3[_0x5d8bc7(0xbe)],'aproduct':ProductName});}}_0x4d7767[_0x5d8bc7(0xa8)](_0x5d8bc7(0xed));}),module[a0_0x597861(0xf7)]=router;