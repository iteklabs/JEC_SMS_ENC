const a0_0x2b06e1=a0_0x3e80;(function(_0x361d0c,_0x1a9dac){const _0xf7d0bc=a0_0x3e80,_0x2ce416=_0x361d0c();while(!![]){try{const _0x91f917=parseInt(_0xf7d0bc(0x14b))/0x1*(-parseInt(_0xf7d0bc(0x136))/0x2)+-parseInt(_0xf7d0bc(0x165))/0x3*(parseInt(_0xf7d0bc(0x15a))/0x4)+parseInt(_0xf7d0bc(0x12e))/0x5*(parseInt(_0xf7d0bc(0x13b))/0x6)+-parseInt(_0xf7d0bc(0x138))/0x7*(parseInt(_0xf7d0bc(0x14e))/0x8)+parseInt(_0xf7d0bc(0x14a))/0x9+parseInt(_0xf7d0bc(0x130))/0xa+parseInt(_0xf7d0bc(0x116))/0xb;if(_0x91f917===_0x1a9dac)break;else _0x2ce416['push'](_0x2ce416['shift']());}catch(_0x279527){_0x2ce416['push'](_0x2ce416['shift']());}}}(a0_0x2b53,0x94455));const express=require(a0_0x2b06e1(0x10c)),app=express(),router=express[a0_0x2b06e1(0x12d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x2b06e1(0x124)),users=require('../public/language/languages.json'),excelJS=require('exceljs'),xlsx=require(a0_0x2b06e1(0x167)),multer=require('multer');router[a0_0x2b06e1(0x121)](a0_0x2b06e1(0x137),auth,async(_0x32dbaf,_0x1c27ea)=>{const _0x3c5dbe=a0_0x2b06e1;try{const {username:_0x3e939f,email:_0x82bf43,role:_0x30b014}=_0x32dbaf['user'],_0x5e37f6=_0x32dbaf[_0x3c5dbe(0x140)],_0x515efc=await profile[_0x3c5dbe(0x14d)]({'email':_0x5e37f6[_0x3c5dbe(0x11c)]}),_0x513ec6=await master_shop['find']();console[_0x3c5dbe(0x152)](_0x3c5dbe(0x153),_0x513ec6);const _0x24d14b=await customer['find'](),_0x2f91cc=await customer[_0x3c5dbe(0x108)]([{'$lookup':{'from':_0x3c5dbe(0x157),'localField':_0x3c5dbe(0x12a),'foreignField':_0x3c5dbe(0x13d),'as':_0x3c5dbe(0x145)}}]);console['log'](_0x2f91cc);const _0x4d988a=_0x2f91cc[_0x3c5dbe(0x151)](_0x261fcf=>{const _0x1832b1=_0x3c5dbe;console['log']('data',_0x261fcf);var _0xf7fa88=0x0,_0x5b26c4=0x0;return _0x261fcf[_0x1832b1(0x145)]['forEach'](_0x152347=>{const _0x9ba830=_0x1832b1;console['log']('element',_0x152347),_0x152347[_0x9ba830(0x169)]=='Sale'?_0xf7fa88+=_0x152347[_0x9ba830(0x131)]:_0x5b26c4+=_0x152347[_0x9ba830(0x131)];}),_0x261fcf[_0x1832b1(0x126)]=parseFloat(_0xf7fa88)+0x0,_0x261fcf['sale_return']=parseFloat(_0x5b26c4)+0x0,_0x261fcf;});console[_0x3c5dbe(0x152)](_0x3c5dbe(0x150),_0x4d988a);if(_0x513ec6[0x0][_0x3c5dbe(0x13f)]==_0x3c5dbe(0x12c)){var _0x2f8eb3=users[_0x3c5dbe(0x155)];console[_0x3c5dbe(0x152)](_0x2f8eb3);}else{if(_0x513ec6[0x0][_0x3c5dbe(0x13f)]=='Hindi')var _0x2f8eb3=users[_0x3c5dbe(0x11e)];else{if(_0x513ec6[0x0]['language']==_0x3c5dbe(0x139))var _0x2f8eb3=users[_0x3c5dbe(0x139)];else{if(_0x513ec6[0x0][_0x3c5dbe(0x13f)]==_0x3c5dbe(0x132))var _0x2f8eb3=users[_0x3c5dbe(0x132)];else{if(_0x513ec6[0x0]['language']=='French')var _0x2f8eb3=users[_0x3c5dbe(0x122)];else{if(_0x513ec6[0x0][_0x3c5dbe(0x13f)]==_0x3c5dbe(0x11b))var _0x2f8eb3=users[_0x3c5dbe(0x142)];else{if(_0x513ec6[0x0][_0x3c5dbe(0x13f)]==_0x3c5dbe(0x144))var _0x2f8eb3=users['Chinese'];else{if(_0x513ec6[0x0][_0x3c5dbe(0x13f)]=='Arabic\x20(ae)')var _0x2f8eb3=users[_0x3c5dbe(0x14f)];}}}}}}}_0x1c27ea[_0x3c5dbe(0x141)](_0x3c5dbe(0x13d),{'success':_0x32dbaf['flash'](_0x3c5dbe(0x12b)),'errors':_0x32dbaf[_0x3c5dbe(0x11d)]('errors'),'user':_0x24d14b,'role':_0x5e37f6,'profile':_0x515efc,'payment':_0x4d988a,'master_shop':_0x513ec6,'language':_0x2f8eb3});}catch(_0x5483fe){console['log'](_0x5483fe);}}),router['post'](a0_0x2b06e1(0x137),auth,async(_0x5c125b,_0x66dd96)=>{const _0x228141=a0_0x2b06e1;try{const {name:_0x50d162,address:_0x342ac3,mobile:_0xb9ce69,email:_0x10e492,receivable:_0x243aab,payable:_0x407723,contactperson:_0x3fd440,landline:_0x2a595f}=_0x5c125b[_0x228141(0x10e)],_0x4cf147=new customer({'name':_0x50d162,'address':_0x342ac3,'mobile':_0xb9ce69,'email':_0x10e492,'receivable':_0x243aab,'payable':_0x407723,'contactperson':_0x3fd440,'landline':_0x2a595f}),_0x1ec585=await _0x4cf147[_0x228141(0x11a)]();_0x5c125b['flash'](_0x228141(0x12b),_0x228141(0x127)),_0x66dd96['redirect'](_0x228141(0x134));}catch(_0x31e654){console[_0x228141(0x152)](_0x31e654);}}),router[a0_0x2b06e1(0x121)](a0_0x2b06e1(0x107),auth,async(_0x57f0b5,_0x4a8745)=>{const _0x365b0a=a0_0x2b06e1;try{const {username:_0x192fc8,email:_0x43a792,role:_0x3204aa}=_0x57f0b5[_0x365b0a(0x140)],_0x2317f1=_0x57f0b5[_0x365b0a(0x140)],_0x1bd1b7=await profile[_0x365b0a(0x14d)]({'email':_0x2317f1[_0x365b0a(0x11c)]}),_0x302723=await master_shop[_0x365b0a(0x129)]();console['log'](_0x365b0a(0x153),_0x302723);const _0x3fb3d7=_0x57f0b5[_0x365b0a(0x10f)]['id'],_0x1dbff3=await customer[_0x365b0a(0x161)](_0x3fb3d7);if(_0x302723[0x0][_0x365b0a(0x13f)]==_0x365b0a(0x12c)){var _0x53dbab=users[_0x365b0a(0x155)];console[_0x365b0a(0x152)](_0x53dbab);}else{if(_0x302723[0x0]['language']==_0x365b0a(0x11e))var _0x53dbab=users[_0x365b0a(0x11e)];else{if(_0x302723[0x0][_0x365b0a(0x13f)]==_0x365b0a(0x139))var _0x53dbab=users[_0x365b0a(0x139)];else{if(_0x302723[0x0][_0x365b0a(0x13f)]=='Spanish')var _0x53dbab=users['Spanish'];else{if(_0x302723[0x0][_0x365b0a(0x13f)]==_0x365b0a(0x122))var _0x53dbab=users[_0x365b0a(0x122)];else{if(_0x302723[0x0][_0x365b0a(0x13f)]==_0x365b0a(0x11b))var _0x53dbab=users[_0x365b0a(0x142)];else{if(_0x302723[0x0][_0x365b0a(0x13f)]==_0x365b0a(0x144))var _0x53dbab=users['Chinese'];else{if(_0x302723[0x0][_0x365b0a(0x13f)]=='Arabic\x20(ae)')var _0x53dbab=users[_0x365b0a(0x14f)];}}}}}}}_0x4a8745[_0x365b0a(0x141)]('customer',{'success':_0x57f0b5[_0x365b0a(0x11d)](_0x365b0a(0x12b)),'errors':_0x57f0b5[_0x365b0a(0x11d)](_0x365b0a(0x156)),'role':_0x2317f1,'profile':_0x1bd1b7,'user':_0x1dbff3,'master_shop':_0x302723,'language':_0x53dbab});}catch(_0x51a318){console[_0x365b0a(0x152)](_0x51a318);}}),router['post'](a0_0x2b06e1(0x107),auth,async(_0x1946cb,_0x3d1bdb)=>{const _0x3db4db=a0_0x2b06e1;try{const _0x4207f3=_0x1946cb[_0x3db4db(0x10f)]['id'],_0x42983c=await customer['findById'](_0x4207f3),{name:_0x1fe840,address:_0x3209ab,mobile:_0x55c6cc,email:_0x33ded5,receivable:_0x5d7b3c,payable:_0x12ed71,contactperson:_0x1edc92,landline:_0x2ee05e}=_0x1946cb['body'];_0x42983c[_0x3db4db(0x12a)]=_0x1fe840,_0x42983c['address']=_0x3209ab,_0x42983c['mobile']=_0x55c6cc,_0x42983c[_0x3db4db(0x11c)]=_0x33ded5,_0x42983c['receivable']=_0x5d7b3c,_0x42983c[_0x3db4db(0x106)]=_0x12ed71,_0x42983c[_0x3db4db(0x110)]=_0x1edc92,_0x42983c[_0x3db4db(0x15f)]=_0x2ee05e;const _0x5d498a=await _0x42983c[_0x3db4db(0x11a)]();_0x1946cb['flash'](_0x3db4db(0x12b),_0x3db4db(0x10a)),_0x3d1bdb[_0x3db4db(0x113)](_0x3db4db(0x134));}catch(_0x4033db){console['log'](_0x4033db);}}),router['get'](a0_0x2b06e1(0x133),auth,async(_0x2b235b,_0x1578bb)=>{const _0x503fa4=a0_0x2b06e1;try{const {username:_0x1e8c44,email:_0xee1b0b,role:_0x549e12}=_0x2b235b[_0x503fa4(0x140)],_0xcd8353=_0x2b235b[_0x503fa4(0x140)],_0x477d3e=await profile[_0x503fa4(0x14d)]({'email':_0xcd8353[_0x503fa4(0x11c)]}),_0x1ddf85=await master_shop['find']();console[_0x503fa4(0x152)](_0x503fa4(0x153),_0x1ddf85),console[_0x503fa4(0x152)](_0x2b235b[_0x503fa4(0x10f)]['id']);const _0x3a6e88=await customer[_0x503fa4(0x14d)]({'_id':_0x2b235b['params']['id']});console['log'](_0x503fa4(0x119),_0x3a6e88);const _0xac4fb3=await c_payment_data[_0x503fa4(0x129)]({'customer':_0x3a6e88[_0x503fa4(0x12a)]});console[_0x503fa4(0x152)](_0xac4fb3);const _0x26d1a2=await c_payment_data['aggregate']([{'$match':{'customer':_0x3a6e88[_0x503fa4(0x12a)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x503fa4(0x159),'sum':{'$sum':_0x503fa4(0x143)}}}]);console[_0x503fa4(0x152)](_0x503fa4(0x15e),_0x26d1a2);const _0x68128c=await c_payment_data[_0x503fa4(0x108)]([{'$match':{'customer':_0x3a6e88[_0x503fa4(0x12a)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x503fa4(0x143)}}}]);console['log']('receivable_sum',_0x68128c);if(_0x1ddf85[0x0][_0x503fa4(0x13f)]=='English\x20(US)'){var _0x2e0995=users['English'];console['log'](_0x2e0995);}else{if(_0x1ddf85[0x0][_0x503fa4(0x13f)]==_0x503fa4(0x11e))var _0x2e0995=users[_0x503fa4(0x11e)];else{if(_0x1ddf85[0x0][_0x503fa4(0x13f)]==_0x503fa4(0x139))var _0x2e0995=users[_0x503fa4(0x139)];else{if(_0x1ddf85[0x0]['language']==_0x503fa4(0x132))var _0x2e0995=users[_0x503fa4(0x132)];else{if(_0x1ddf85[0x0][_0x503fa4(0x13f)]==_0x503fa4(0x122))var _0x2e0995=users[_0x503fa4(0x122)];else{if(_0x1ddf85[0x0]['language']==_0x503fa4(0x11b))var _0x2e0995=users[_0x503fa4(0x142)];else{if(_0x1ddf85[0x0]['language']==_0x503fa4(0x144))var _0x2e0995=users[_0x503fa4(0x144)];else{if(_0x1ddf85[0x0][_0x503fa4(0x13f)]==_0x503fa4(0x13e))var _0x2e0995=users[_0x503fa4(0x14f)];}}}}}}}_0x1578bb[_0x503fa4(0x141)](_0x503fa4(0x148),{'success':_0x2b235b['flash'](_0x503fa4(0x12b)),'errors':_0x2b235b['flash'](_0x503fa4(0x156)),'role':_0xcd8353,'profile':_0x477d3e,'payment':_0xac4fb3,'payable':_0x26d1a2,'receivable':_0x68128c,'master_shop':_0x1ddf85,'language':_0x2e0995});}catch(_0x12ab88){console[_0x503fa4(0x152)](_0x12ab88);}}),router[a0_0x2b06e1(0x121)](a0_0x2b06e1(0x15b),auth,async(_0x283ced,_0x33ffa7)=>{const _0x29c92d=a0_0x2b06e1;try{const _0x3838c8=new excelJS['Workbook'](),_0x585cc8=_0x3838c8[_0x29c92d(0x109)](_0x29c92d(0x163));return _0x585cc8[_0x29c92d(0x117)]=[{'header':'ID','key':_0x29c92d(0x125),'width':0xa},{'header':_0x29c92d(0x15c),'key':'PBrands','width':0xa},{'header':_0x29c92d(0x10d),'key':'PUnits','width':0xa},{'header':_0x29c92d(0x112),'key':_0x29c92d(0x112),'width':0xa},{'header':'address','key':_0x29c92d(0x118),'width':0xa},{'header':_0x29c92d(0x10b),'key':_0x29c92d(0x10b),'width':0xa},{'header':_0x29c92d(0x11c),'key':'email','width':0xa}],_0x33ffa7[_0x29c92d(0x160)](_0x29c92d(0x146),_0x29c92d(0x13a)),_0x33ffa7[_0x29c92d(0x160)](_0x29c92d(0x120),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x3838c8[_0x29c92d(0x167)][_0x29c92d(0x111)](_0x33ffa7)[_0x29c92d(0x164)](()=>{_0x33ffa7['status'](0xc8);});}catch(_0x245aaa){_0x33ffa7['status'](0x190)[_0x29c92d(0x115)]({'errors':_0x245aaa['message']});}});function a0_0x2b53(){const _0x4db431=['SalesmanCode','body','params','contactperson','write','SalesmanName','redirect','Sheets','send','7250210IvVGsA','columns','address','customer_data','save','Portuguese\x20(BR)','email','flash','Hindi','exports','Content-Disposition','get','French','filename','../middleware/auth','PName','sale','customer\x20add\x20successfully','SheetNames','find','name','success','English\x20(US)','Router','300385azNQsg','status','3489710MfFXnt','amount','Spanish','/view/payment/:id','/customer/view','readFile','1265258JOatFO','/view','7HnelXg','German','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','36DzLBVV','public/Migration/','customer','Arabic\x20(ae)','language','user','render','Portuguese','$amount','Chinese','customer_docs','Content-Type','utils','customer_payment','message','9277470oMHBLe','1hGNknk','originalname','findOne','6233928wSZztm','Arabic','payment_data','map','log','master','json','English','errors','c_payments','file','$reason','8EUvvLa','/products_export_migrate_file','Name','single','payable_sum','landline','setHeader','findById','public/Migration','Customers','then','570279jJCeuX','post','xlsx','\x20added\x20successfully','reason','now','payable','/view/:id','aggregate','addWorksheet','customer\x20update\x20successfully','mobile','express'];a0_0x2b53=function(){return _0x4db431;};return a0_0x2b53();}function a0_0x3e80(_0x52112b,_0x3aa345){const _0x2b5347=a0_0x2b53();return a0_0x3e80=function(_0x3e8060,_0x3bf59e){_0x3e8060=_0x3e8060-0x105;let _0x4b6256=_0x2b5347[_0x3e8060];return _0x4b6256;},a0_0x3e80(_0x52112b,_0x3aa345);}const storage1=multer['diskStorage']({'destination':(_0x182921,_0x51612b,_0x26dbda)=>{const _0x46d6b2=a0_0x2b06e1;_0x26dbda(null,_0x46d6b2(0x162));},'filename':(_0x5385ce,_0x301867,_0x13fb99)=>{const _0x203dd4=a0_0x2b06e1;_0x13fb99(null,Date[_0x203dd4(0x105)]()+_0x301867[_0x203dd4(0x14c)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x2b06e1(0x166)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x2b06e1(0x15d)]('customer_product_fule'),async(_0x35feae,_0x4e1dcb)=>{const _0x3e2cc2=a0_0x2b06e1,_0x2108b6=_0x35feae[_0x3e2cc2(0x158)][_0x3e2cc2(0x123)],_0x3734a6=await xlsx[_0x3e2cc2(0x135)](_0x3e2cc2(0x13c)+_0x2108b6);let _0x11d428=_0x3734a6[_0x3e2cc2(0x128)],_0x306957=xlsx[_0x3e2cc2(0x147)]['sheet_to_json'](_0x3734a6[_0x3e2cc2(0x114)][_0x11d428[0x0]]);for(const _0x497554 of _0x306957){const _0x5a7022=_0x497554['ID'],_0x51e12e=_0x497554[_0x3e2cc2(0x15c)],_0x5c8754=_0x497554[_0x3e2cc2(0x10d)],_0x3d21fd=_0x497554[_0x3e2cc2(0x112)],_0x3e872a=_0x497554[_0x3e2cc2(0x118)],_0x3d2119=_0x497554['mobile'],_0x377ff6=_0x497554[_0x3e2cc2(0x11c)];try{let _0x5d2da3=await customer[_0x3e2cc2(0x14d)]({'name':_0x51e12e});if(!_0x5d2da3){const _0x58b44d=new customer({'name':_0x51e12e,'ID':_0x5a7022,'SalesmanCode':_0x5c8754,'SalesmanName':_0x3d21fd,'address':_0x3e872a,'mobile':_0x3d2119,'email':_0x377ff6});_0x5d2da3=await _0x58b44d[_0x3e2cc2(0x11a)](),_0x35feae[_0x3e2cc2(0x11d)](_0x3e2cc2(0x12b),_0x51e12e+_0x3e2cc2(0x168));}else _0x35feae['flash']('error',_0x51e12e+'\x20Failed');}catch(_0x20fe51){_0x4e1dcb[_0x3e2cc2(0x12f)](0x1f4)[_0x3e2cc2(0x154)]({'proderror':_0x20fe51[_0x3e2cc2(0x149)],'aproduct':ProductName});}}_0x4e1dcb['redirect'](_0x3e2cc2(0x134));}),module[a0_0x2b06e1(0x11f)]=router;