const a0_0x574442=a0_0x6c33;(function(_0x139e2d,_0x4c2f47){const _0x4e58f0=a0_0x6c33,_0x574ddf=_0x139e2d();while(!![]){try{const _0x83e087=parseInt(_0x4e58f0(0x17e))/0x1+-parseInt(_0x4e58f0(0x1bc))/0x2+parseInt(_0x4e58f0(0x1a3))/0x3+parseInt(_0x4e58f0(0x174))/0x4*(parseInt(_0x4e58f0(0x18a))/0x5)+-parseInt(_0x4e58f0(0x1a9))/0x6+-parseInt(_0x4e58f0(0x186))/0x7+parseInt(_0x4e58f0(0x166))/0x8;if(_0x83e087===_0x4c2f47)break;else _0x574ddf['push'](_0x574ddf['shift']());}catch(_0x55ebac){_0x574ddf['push'](_0x574ddf['shift']());}}}(a0_0x4ce5,0xaaaf6));function a0_0x6c33(_0x215a45,_0x510fb5){const _0x4ce5c0=a0_0x4ce5();return a0_0x6c33=function(_0x6c3365,_0x3bfed0){_0x6c3365=_0x6c3365-0x163;let _0x4b18e1=_0x4ce5c0[_0x6c3365];return _0x4b18e1;},a0_0x6c33(_0x215a45,_0x510fb5);}function a0_0x4ce5(){const _0x1763f3=['customer\x20update\x20successfully','findById','forEach','customer\x20add\x20successfully','element','errors','811028OJAOdB','file','landline','customer_product_fule','find','now','findOne','/view','columns','Chinese','183737ybjnKI','English\x20(US)','then','json','Sale\x20Return','language','redirect','SheetNames','3025925JfVIUF','Sheets','/products_export_migrate_file','payment_data','30cHdyuJ','payable','multer','name','success','Hindi','Workbook','flash','German','mobile','post','French','customer_data','$amount','data','Spanish','Arabic','Name','write','utils','render','public/Migration/','../models/all_models','send','receivable','151422nBLTfj','/view/payment/:id','SalesmanName','aggregate','reason','customer','5090250xkMFeS','email','express','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','user','addWorksheet','contactperson','body','amount','/customer_import_migrate_file','status','filename','../middleware/auth','Content-Disposition','\x20Failed','PUnits','Router','customer_docs','save','233702KdNaUq','English','$reason','/view/:id','Sale','Portuguese\x20(BR)','log','Arabic\x20(ae)','Portuguese','params','xlsx','\x20added\x20successfully','address','public/Migration','PBrands','attachment;\x20filename=customer_Migration_File.xlsx','5166992GFLCna','get','originalname','diskStorage','master','sheet_to_json','SalesmanCode','message'];a0_0x4ce5=function(){return _0x1763f3;};return a0_0x4ce5();}const express=require(a0_0x574442(0x1ab)),app=express(),router=express[a0_0x574442(0x1b9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x574442(0x1a0)),auth=require(a0_0x574442(0x1b5)),users=require('../public/language/languages.json'),excelJS=require('exceljs'),xlsx=require(a0_0x574442(0x1c6)),multer=require(a0_0x574442(0x18c));router['get'](a0_0x574442(0x17b),auth,async(_0x9ec5a0,_0x5f290b)=>{const _0x3c28d7=a0_0x574442;try{const {username:_0x29613b,email:_0x1a4871,role:_0x185b9f}=_0x9ec5a0[_0x3c28d7(0x1ad)],_0x4965c1=_0x9ec5a0[_0x3c28d7(0x1ad)],_0x30289d=await profile[_0x3c28d7(0x17a)]({'email':_0x4965c1[_0x3c28d7(0x1aa)]}),_0x236bd2=await master_shop[_0x3c28d7(0x178)]();console[_0x3c28d7(0x1c2)]('master',_0x236bd2);const _0x52a4e8=await customer[_0x3c28d7(0x178)](),_0xb6bbfd=await customer[_0x3c28d7(0x1a6)]([{'$lookup':{'from':'c_payments','localField':_0x3c28d7(0x18d),'foreignField':_0x3c28d7(0x1a8),'as':_0x3c28d7(0x1ba)}}]);console[_0x3c28d7(0x1c2)](_0xb6bbfd);const _0x32370e=_0xb6bbfd['map'](_0x2afb9d=>{const _0x1dbfff=_0x3c28d7;console['log'](_0x1dbfff(0x198),_0x2afb9d);var _0x31db57=0x0,_0x2679d0=0x0;return _0x2afb9d[_0x1dbfff(0x1ba)][_0x1dbfff(0x170)](_0x32dce4=>{const _0x2322be=_0x1dbfff;console[_0x2322be(0x1c2)](_0x2322be(0x172),_0x32dce4),_0x32dce4[_0x2322be(0x1a7)]==_0x2322be(0x1c0)?_0x31db57+=_0x32dce4[_0x2322be(0x1b1)]:_0x2679d0+=_0x32dce4[_0x2322be(0x1b1)];}),_0x2afb9d['sale']=parseFloat(_0x31db57)+0x0,_0x2afb9d['sale_return']=parseFloat(_0x2679d0)+0x0,_0x2afb9d;});console['log'](_0x3c28d7(0x189),_0x32370e);if(_0x236bd2[0x0]['language']=='English\x20(US)'){var _0x431ea3=users[_0x3c28d7(0x1bd)];console['log'](_0x431ea3);}else{if(_0x236bd2[0x0][_0x3c28d7(0x183)]==_0x3c28d7(0x18f))var _0x431ea3=users[_0x3c28d7(0x18f)];else{if(_0x236bd2[0x0]['language']==_0x3c28d7(0x192))var _0x431ea3=users[_0x3c28d7(0x192)];else{if(_0x236bd2[0x0][_0x3c28d7(0x183)]==_0x3c28d7(0x199))var _0x431ea3=users[_0x3c28d7(0x199)];else{if(_0x236bd2[0x0][_0x3c28d7(0x183)]==_0x3c28d7(0x195))var _0x431ea3=users['French'];else{if(_0x236bd2[0x0][_0x3c28d7(0x183)]==_0x3c28d7(0x1c1))var _0x431ea3=users[_0x3c28d7(0x1c4)];else{if(_0x236bd2[0x0][_0x3c28d7(0x183)]==_0x3c28d7(0x17d))var _0x431ea3=users[_0x3c28d7(0x17d)];else{if(_0x236bd2[0x0][_0x3c28d7(0x183)]=='Arabic\x20(ae)')var _0x431ea3=users[_0x3c28d7(0x19a)];}}}}}}}_0x5f290b[_0x3c28d7(0x19e)]('customer',{'success':_0x9ec5a0[_0x3c28d7(0x191)]('success'),'errors':_0x9ec5a0['flash'](_0x3c28d7(0x173)),'user':_0x52a4e8,'role':_0x4965c1,'profile':_0x30289d,'payment':_0x32370e,'master_shop':_0x236bd2,'language':_0x431ea3});}catch(_0x46a066){console['log'](_0x46a066);}}),router[a0_0x574442(0x194)](a0_0x574442(0x17b),auth,async(_0x503355,_0x5a18f0)=>{const _0xaaa5db=a0_0x574442;try{const {name:_0x5e5ff4,address:_0x382f28,mobile:_0x5577a2,email:_0xec5de0,receivable:_0x358165,payable:_0x18e811,contactperson:_0x1d6215,landline:_0x2064a1}=_0x503355[_0xaaa5db(0x1b0)],_0x2da6ae=new customer({'name':_0x5e5ff4,'address':_0x382f28,'mobile':_0x5577a2,'email':_0xec5de0,'receivable':_0x358165,'payable':_0x18e811,'contactperson':_0x1d6215,'landline':_0x2064a1}),_0x552c9f=await _0x2da6ae[_0xaaa5db(0x1bb)]();_0x503355[_0xaaa5db(0x191)](_0xaaa5db(0x18e),_0xaaa5db(0x171)),_0x5a18f0[_0xaaa5db(0x184)]('/customer/view');}catch(_0x4b81f5){console[_0xaaa5db(0x1c2)](_0x4b81f5);}}),router['get'](a0_0x574442(0x1bf),auth,async(_0x317bcf,_0x3297fd)=>{const _0x377c4d=a0_0x574442;try{const {username:_0x30cdbc,email:_0x498aaf,role:_0x3793cc}=_0x317bcf[_0x377c4d(0x1ad)],_0x22a37d=_0x317bcf[_0x377c4d(0x1ad)],_0x29fd15=await profile[_0x377c4d(0x17a)]({'email':_0x22a37d['email']}),_0x23664b=await master_shop['find']();console[_0x377c4d(0x1c2)]('master',_0x23664b);const _0xf4bd41=_0x317bcf[_0x377c4d(0x1c5)]['id'],_0x44385a=await customer[_0x377c4d(0x16f)](_0xf4bd41);if(_0x23664b[0x0][_0x377c4d(0x183)]==_0x377c4d(0x17f)){var _0x4e4103=users[_0x377c4d(0x1bd)];console[_0x377c4d(0x1c2)](_0x4e4103);}else{if(_0x23664b[0x0][_0x377c4d(0x183)]==_0x377c4d(0x18f))var _0x4e4103=users[_0x377c4d(0x18f)];else{if(_0x23664b[0x0][_0x377c4d(0x183)]==_0x377c4d(0x192))var _0x4e4103=users['German'];else{if(_0x23664b[0x0]['language']==_0x377c4d(0x199))var _0x4e4103=users['Spanish'];else{if(_0x23664b[0x0][_0x377c4d(0x183)]=='French')var _0x4e4103=users[_0x377c4d(0x195)];else{if(_0x23664b[0x0][_0x377c4d(0x183)]==_0x377c4d(0x1c1))var _0x4e4103=users['Portuguese'];else{if(_0x23664b[0x0][_0x377c4d(0x183)]==_0x377c4d(0x17d))var _0x4e4103=users['Chinese'];else{if(_0x23664b[0x0][_0x377c4d(0x183)]==_0x377c4d(0x1c3))var _0x4e4103=users[_0x377c4d(0x19a)];}}}}}}}_0x3297fd[_0x377c4d(0x19e)](_0x377c4d(0x1a8),{'success':_0x317bcf[_0x377c4d(0x191)]('success'),'errors':_0x317bcf['flash']('errors'),'role':_0x22a37d,'profile':_0x29fd15,'user':_0x44385a,'master_shop':_0x23664b,'language':_0x4e4103});}catch(_0x56f0c4){console[_0x377c4d(0x1c2)](_0x56f0c4);}}),router[a0_0x574442(0x194)](a0_0x574442(0x1bf),auth,async(_0x3c23e1,_0x101fd4)=>{const _0x17a759=a0_0x574442;try{const _0x2e5f28=_0x3c23e1[_0x17a759(0x1c5)]['id'],_0x50620d=await customer[_0x17a759(0x16f)](_0x2e5f28),{name:_0x4aa9fb,address:_0x1f9c80,mobile:_0x21d12d,email:_0x11ec39,receivable:_0x225621,payable:_0x2afca9,contactperson:_0x3cd4d6,landline:_0x12d013}=_0x3c23e1[_0x17a759(0x1b0)];_0x50620d[_0x17a759(0x18d)]=_0x4aa9fb,_0x50620d[_0x17a759(0x1c8)]=_0x1f9c80,_0x50620d[_0x17a759(0x193)]=_0x21d12d,_0x50620d[_0x17a759(0x1aa)]=_0x11ec39,_0x50620d[_0x17a759(0x1a2)]=_0x225621,_0x50620d[_0x17a759(0x18b)]=_0x2afca9,_0x50620d[_0x17a759(0x1af)]=_0x3cd4d6,_0x50620d[_0x17a759(0x176)]=_0x12d013;const _0x1088ba=await _0x50620d[_0x17a759(0x1bb)]();_0x3c23e1['flash']('success',_0x17a759(0x16e)),_0x101fd4[_0x17a759(0x184)]('/customer/view');}catch(_0x29535a){console[_0x17a759(0x1c2)](_0x29535a);}}),router[a0_0x574442(0x167)](a0_0x574442(0x1a4),auth,async(_0x2fb29a,_0x208187)=>{const _0x2e571e=a0_0x574442;try{const {username:_0x332572,email:_0x3c21cc,role:_0x4b2369}=_0x2fb29a['user'],_0x4c2e04=_0x2fb29a[_0x2e571e(0x1ad)],_0x2acf36=await profile[_0x2e571e(0x17a)]({'email':_0x4c2e04[_0x2e571e(0x1aa)]}),_0x26aa9b=await master_shop[_0x2e571e(0x178)]();console[_0x2e571e(0x1c2)](_0x2e571e(0x16a),_0x26aa9b),console['log'](_0x2fb29a[_0x2e571e(0x1c5)]['id']);const _0x1a4905=await customer[_0x2e571e(0x17a)]({'_id':_0x2fb29a[_0x2e571e(0x1c5)]['id']});console[_0x2e571e(0x1c2)](_0x2e571e(0x196),_0x1a4905);const _0x174ccf=await c_payment_data[_0x2e571e(0x178)]({'customer':_0x1a4905[_0x2e571e(0x18d)]});console[_0x2e571e(0x1c2)](_0x174ccf);const _0x57fc34=await c_payment_data[_0x2e571e(0x1a6)]([{'$match':{'customer':_0x1a4905['name']}},{'$match':{'reason':_0x2e571e(0x1c0)}},{'$group':{'_id':_0x2e571e(0x1be),'sum':{'$sum':_0x2e571e(0x197)}}}]);console['log']('payable_sum',_0x57fc34);const _0x2ceff4=await c_payment_data['aggregate']([{'$match':{'customer':_0x1a4905[_0x2e571e(0x18d)]}},{'$match':{'reason':_0x2e571e(0x182)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x2e571e(0x197)}}}]);console[_0x2e571e(0x1c2)]('receivable_sum',_0x2ceff4);if(_0x26aa9b[0x0]['language']=='English\x20(US)'){var _0x4544f8=users[_0x2e571e(0x1bd)];console[_0x2e571e(0x1c2)](_0x4544f8);}else{if(_0x26aa9b[0x0][_0x2e571e(0x183)]==_0x2e571e(0x18f))var _0x4544f8=users[_0x2e571e(0x18f)];else{if(_0x26aa9b[0x0]['language']=='German')var _0x4544f8=users['German'];else{if(_0x26aa9b[0x0][_0x2e571e(0x183)]==_0x2e571e(0x199))var _0x4544f8=users[_0x2e571e(0x199)];else{if(_0x26aa9b[0x0][_0x2e571e(0x183)]==_0x2e571e(0x195))var _0x4544f8=users['French'];else{if(_0x26aa9b[0x0][_0x2e571e(0x183)]==_0x2e571e(0x1c1))var _0x4544f8=users[_0x2e571e(0x1c4)];else{if(_0x26aa9b[0x0][_0x2e571e(0x183)]==_0x2e571e(0x17d))var _0x4544f8=users['Chinese'];else{if(_0x26aa9b[0x0][_0x2e571e(0x183)]==_0x2e571e(0x1c3))var _0x4544f8=users[_0x2e571e(0x19a)];}}}}}}}_0x208187[_0x2e571e(0x19e)]('customer_payment',{'success':_0x2fb29a[_0x2e571e(0x191)](_0x2e571e(0x18e)),'errors':_0x2fb29a[_0x2e571e(0x191)](_0x2e571e(0x173)),'role':_0x4c2e04,'profile':_0x2acf36,'payment':_0x174ccf,'payable':_0x57fc34,'receivable':_0x2ceff4,'master_shop':_0x26aa9b,'language':_0x4544f8});}catch(_0x506dd0){console[_0x2e571e(0x1c2)](_0x506dd0);}}),router[a0_0x574442(0x167)](a0_0x574442(0x188),auth,async(_0x5740af,_0x5ec8ed)=>{const _0x13b7e8=a0_0x574442;try{const _0x15f34e=new excelJS[(_0x13b7e8(0x190))](),_0x5dc6b2=_0x15f34e[_0x13b7e8(0x1ae)]('Customers');return _0x5dc6b2[_0x13b7e8(0x17c)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x13b7e8(0x19b),'key':_0x13b7e8(0x164),'width':0xa},{'header':_0x13b7e8(0x16c),'key':_0x13b7e8(0x1b8),'width':0xa},{'header':_0x13b7e8(0x1a5),'key':_0x13b7e8(0x1a5),'width':0xa},{'header':_0x13b7e8(0x1c8),'key':_0x13b7e8(0x1c8),'width':0xa},{'header':_0x13b7e8(0x193),'key':_0x13b7e8(0x193),'width':0xa},{'header':_0x13b7e8(0x1aa),'key':'email','width':0xa}],_0x5ec8ed['setHeader']('Content-Type',_0x13b7e8(0x1ac)),_0x5ec8ed['setHeader'](_0x13b7e8(0x1b6),_0x13b7e8(0x165)),_0x15f34e[_0x13b7e8(0x1c6)][_0x13b7e8(0x19c)](_0x5ec8ed)[_0x13b7e8(0x180)](()=>{const _0x3bab46=_0x13b7e8;_0x5ec8ed[_0x3bab46(0x1b3)](0xc8);});}catch(_0x3c55eb){_0x5ec8ed['status'](0x190)[_0x13b7e8(0x1a1)]({'errors':_0x3c55eb['message']});}});const storage1=multer[a0_0x574442(0x169)]({'destination':(_0x4a04f7,_0x5be120,_0xdcf37)=>{const _0x5841d5=a0_0x574442;_0xdcf37(null,_0x5841d5(0x163));},'filename':(_0x25579b,_0x5d910b,_0x4a3e3b)=>{const _0x38d4a3=a0_0x574442;_0x4a3e3b(null,Date[_0x38d4a3(0x179)]()+_0x5d910b[_0x38d4a3(0x168)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x574442(0x194)](a0_0x574442(0x1b2),auth,uploadMigrate['single'](a0_0x574442(0x177)),async(_0x4ef265,_0x2ae2c5)=>{const _0x17b62b=a0_0x574442,_0x107a5b=_0x4ef265[_0x17b62b(0x175)][_0x17b62b(0x1b4)],_0x309faf=await xlsx['readFile'](_0x17b62b(0x19f)+_0x107a5b);let _0x490768=_0x309faf[_0x17b62b(0x185)],_0x324ccf=xlsx[_0x17b62b(0x19d)][_0x17b62b(0x16b)](_0x309faf[_0x17b62b(0x187)][_0x490768[0x0]]);for(const _0x34301f of _0x324ccf){const _0x47e37c=_0x34301f['ID'],_0x287a2e=_0x34301f['Name'],_0x3c767b=_0x34301f['SalesmanCode'],_0x291abc=_0x34301f['SalesmanName'],_0xddb991=_0x34301f[_0x17b62b(0x1c8)],_0x1c11aa=_0x34301f[_0x17b62b(0x193)],_0x160822=_0x34301f[_0x17b62b(0x1aa)];try{let _0x11bc85=await customer['findOne']({'name':_0x287a2e});if(!_0x11bc85){const _0xa1f0b8=new customer({'name':_0x287a2e,'ID':_0x47e37c,'SalesmanCode':_0x3c767b,'SalesmanName':_0x291abc,'address':_0xddb991,'mobile':_0x1c11aa,'email':_0x160822});_0x11bc85=await _0xa1f0b8[_0x17b62b(0x1bb)](),_0x4ef265[_0x17b62b(0x191)](_0x17b62b(0x18e),_0x287a2e+_0x17b62b(0x1c7));}else _0x4ef265[_0x17b62b(0x191)]('error',_0x287a2e+_0x17b62b(0x1b7));}catch(_0x13859d){_0x2ae2c5[_0x17b62b(0x1b3)](0x1f4)[_0x17b62b(0x181)]({'proderror':_0x13859d[_0x17b62b(0x16d)],'aproduct':ProductName});}}_0x2ae2c5[_0x17b62b(0x184)]('/customer/view');}),module['exports']=router;