const a0_0x4dcffd=a0_0x4d66;function a0_0x35e6(){const _0x1a9a70=['$sale_product.invoice','../../models/all_models','176FTOsnj','$product','warehouse_data','$sale_product.room_name','85434sPMMsI','$product_details','valueOf','express','/negative','table\x20page','/join','$product.invoice','push','$name','get','data_transfer','/checking','$sale_product.quantity','$warehouse_name','log','_id','$product._id','monitor','$product.to_quantity','$invoice','$product.product_code','50FXmgtb','$product_details.invoice','$sale_product','aggregate','$product_details.product_name','status','199035KhvJgF','length','26AhFehc','flash','34669690ABTUnS','/warehouse_monitor','exports','$sale_product.product_name','$product.product_name','json','$product.room_names','data_adjustment','errors','$product.new_adjust_qty','12756506wLUlAM','\x20documents\x20updated','modifiedCount','$sale_product.id_transaction_from','$product.id_transaction_from','$sale_product.product_code','$$invoice','invoice','$room','all','1488284vDXimo','message','14800005047429','346851hZkhEz','3116780UgOXkn','map','$product_details._id','render','data_sales','Router','warehouses','$sale_product._id'];a0_0x35e6=function(){return _0x1a9a70;};return a0_0x35e6();}(function(_0x32e2a4,_0x2f2d19){const _0x1f9a27=a0_0x4d66,_0x4faf6b=_0x32e2a4();while(!![]){try{const _0x24cc20=-parseInt(_0x1f9a27(0x1a1))/0x1+parseInt(_0x1f9a27(0x18b))/0x2*(parseInt(_0x1f9a27(0x1cf))/0x3)+-parseInt(_0x1f9a27(0x1a5))/0x4+parseInt(_0x1f9a27(0x1c9))/0x5*(-parseInt(_0x1f9a27(0x1b3))/0x6)+-parseInt(_0x1f9a27(0x197))/0x7+parseInt(_0x1f9a27(0x1af))/0x8*(parseInt(_0x1f9a27(0x1a4))/0x9)+parseInt(_0x1f9a27(0x18d))/0xa;if(_0x24cc20===_0x2f2d19)break;else _0x4faf6b['push'](_0x4faf6b['shift']());}catch(_0x4d45ae){_0x4faf6b['push'](_0x4faf6b['shift']());}}}(a0_0x35e6,0xe6bbd));function a0_0x4d66(_0x425f08,_0x34f00d){const _0x35e602=a0_0x35e6();return a0_0x4d66=function(_0x4d6676,_0x11ad80){_0x4d6676=_0x4d6676-0x18a;let _0x511c59=_0x35e602[_0x4d6676];return _0x511c59;},a0_0x4d66(_0x425f08,_0x34f00d);}const express=require(a0_0x4dcffd(0x1b6)),app=express(),router=express[a0_0x4dcffd(0x1aa)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x4dcffd(0x1ae));router[a0_0x4dcffd(0x1bd)](a0_0x4dcffd(0x1b7),async(_0x29c423,_0x25c212)=>{const _0x5b8dcf=a0_0x4dcffd;try{const _0x21b4ed=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x25c212[_0x5b8dcf(0x192)]({'status':_0x21b4ed[_0x5b8dcf(0x199)]+_0x5b8dcf(0x198)});}catch(_0x3f6b33){console[_0x5b8dcf(0x1c2)](_0x5b8dcf(0x1b8),_0x3f6b33),_0x25c212[_0x5b8dcf(0x1ce)](0xc8)[_0x5b8dcf(0x192)]({'message':_0x3f6b33[_0x5b8dcf(0x1a2)]});}}),router[a0_0x4dcffd(0x1bd)](a0_0x4dcffd(0x1bf),async(_0x5f3b6b,_0x52005d)=>{const _0x2adf07=a0_0x4dcffd;try{const _0x9a51b0=await warehouse[_0x2adf07(0x1cc)]([{'$unwind':_0x2adf07(0x1b4)},{'$match':{'product_details.invoice':'INCF-52068316','product_details.primary_code':_0x2adf07(0x1a3)}},{'$group':{'_id':{'name':_0x2adf07(0x1bc),'room':_0x2adf07(0x19f)},'products':{'$push':_0x2adf07(0x1b4)}}}]);_0x52005d[_0x2adf07(0x192)](_0x9a51b0);}catch(_0xa0acc7){console[_0x2adf07(0x1c2)](_0x2adf07(0x1b8),_0xa0acc7),_0x52005d['status'](0xc8)[_0x2adf07(0x192)]({'message':_0xa0acc7['message']});}}),router[a0_0x4dcffd(0x1bd)](a0_0x4dcffd(0x18e),async(_0xd06f56,_0x53ceb1)=>{const _0x51c5d4=a0_0x4dcffd;_0x53ceb1[_0x51c5d4(0x1a8)](_0x51c5d4(0x1c5),{'success':_0xd06f56[_0x51c5d4(0x18c)]('success'),'errors':_0xd06f56[_0x51c5d4(0x18c)](_0x51c5d4(0x195))});}),router['get'](a0_0x4dcffd(0x1b9),async(_0x15c343,_0x5d2652)=>{const _0x506bb4=a0_0x4dcffd;var _0x2c51be=await purchases[_0x506bb4(0x1cc)]([{'$lookup':{'from':_0x506bb4(0x1ab),'let':{'invoice':_0x506bb4(0x1c7)},'pipeline':[{'$unwind':'$product_details'},{'$match':{'$expr':{'$eq':[_0x506bb4(0x19d),_0x506bb4(0x1ca)]}}},{'$project':{'_id':_0x506bb4(0x1a7),'product_name':_0x506bb4(0x1cd),'product_code':'$product_details.product_code','quantity_available':'$product_details.product_stock','warehouse_name':_0x506bb4(0x1bc),'warehouse_room':'$room','invoice':_0x506bb4(0x1ca)}}],'as':'warehouse_data'}}]);_0x2c51be[_0x506bb4(0x1a9)]={},await Promise[_0x506bb4(0x1a0)](_0x2c51be[_0x506bb4(0x1a6)](async _0x428e4f=>{const _0x3eb08a=_0x506bb4;_0x2c51be[_0x3eb08a(0x1a9)][_0x428e4f[_0x3eb08a(0x19e)]]=[],await Promise[_0x3eb08a(0x1a0)](_0x428e4f[_0x3eb08a(0x1b1)][_0x3eb08a(0x1a6)](async _0x544114=>{const _0x7c59e5=_0x3eb08a,_0x3f63a7=await sales[_0x7c59e5(0x1cc)]([{'$unwind':_0x7c59e5(0x1cb)},{'$match':{'sale_product.id_transaction_from':_0x544114[_0x7c59e5(0x1c3)][_0x7c59e5(0x1b5)](),'sale_product.invoice':_0x544114['invoice']}},{'$project':{'_id':_0x7c59e5(0x1ac),'product_name':_0x7c59e5(0x190),'product_code':_0x7c59e5(0x19c),'quantity_available':_0x7c59e5(0x1c0),'warehouse_name':_0x7c59e5(0x1c1),'warehouse_room':_0x7c59e5(0x1b2),'product_invoice':_0x7c59e5(0x1ad),'invoice':_0x7c59e5(0x1c7),'id_transaction_from':_0x7c59e5(0x19a)}}]);_0x3f63a7[_0x7c59e5(0x18a)]>0x0&&_0x2c51be[_0x7c59e5(0x1a9)][_0x428e4f[_0x7c59e5(0x19e)]][_0x7c59e5(0x1bb)](..._0x3f63a7);}));})),_0x2c51be[_0x506bb4(0x1a9)]=_0x2c51be['data_sales'],_0x2c51be['data_adjustment']={},await Promise[_0x506bb4(0x1a0)](_0x2c51be[_0x506bb4(0x1a6)](async _0x2ffe88=>{const _0x3f4462=_0x506bb4;_0x2c51be[_0x3f4462(0x194)][_0x2ffe88['invoice']]=[],await Promise['all'](_0x2ffe88[_0x3f4462(0x1b1)]['map'](async _0x35795a=>{const _0x3638ff=_0x3f4462,_0x5b69ed=await adjustment[_0x3638ff(0x1cc)]([{'$unwind':_0x3638ff(0x1b0)},{'$match':{'product.id_transaction_from':_0x35795a[_0x3638ff(0x1c3)][_0x3638ff(0x1b5)](),'product.invoice':_0x35795a['invoice']}},{'$project':{'_id':_0x3638ff(0x1c4),'product_name':_0x3638ff(0x191),'product_code':_0x3638ff(0x1c8),'quantity_available':_0x3638ff(0x196),'warehouse_name':_0x3638ff(0x1c1),'warehouse_room':_0x3638ff(0x193),'product_invoice':_0x3638ff(0x1ba),'invoice':_0x3638ff(0x1c7),'id_transaction_from':_0x3638ff(0x19b)}}]);_0x5b69ed['length']>0x0&&_0x2c51be[_0x3638ff(0x194)][_0x2ffe88['invoice']][_0x3638ff(0x1bb)](..._0x5b69ed);}));})),_0x2c51be[_0x506bb4(0x1be)]={},await Promise[_0x506bb4(0x1a0)](_0x2c51be[_0x506bb4(0x1a6)](async _0x181bce=>{const _0x2fbeb2=_0x506bb4;_0x2c51be[_0x2fbeb2(0x1be)][_0x181bce['invoice']]=[],await Promise[_0x2fbeb2(0x1a0)](_0x181bce[_0x2fbeb2(0x1b1)][_0x2fbeb2(0x1a6)](async _0x2f3253=>{const _0x520471=_0x2fbeb2,_0xd9f832=await transfers['aggregate']([{'$unwind':'$product'},{'$match':{'product.id_transaction_id':_0x2f3253[_0x520471(0x1c3)][_0x520471(0x1b5)](),'product.To_invoice':_0x2f3253['invoice']}},{'$project':{'_id':'$product._id','product_name':_0x520471(0x191),'product_code':_0x520471(0x1c8),'quantity_available':_0x520471(0x1c6),'warehouse_name':'$to_warehouse','warehouse_room':_0x520471(0x193),'product_invoice':'$product.to_room_name','invoice':_0x520471(0x1c7),'id_transaction_id':'$product.id_transaction_id'}}]);console['log'](_0xd9f832),_0xd9f832[_0x520471(0x18a)]>0x0&&_0x2c51be[_0x520471(0x1be)][_0x181bce['invoice']][_0x520471(0x1bb)](..._0xd9f832);}));})),_0x5d2652[_0x506bb4(0x192)]({'purchases_warehouse':_0x2c51be,'data_sales':_0x2c51be[_0x506bb4(0x1a9)],'data_adjustment':_0x2c51be[_0x506bb4(0x194)],'data_transfer':_0x2c51be['data_transfer']});}),module[a0_0x4dcffd(0x18f)]=router;