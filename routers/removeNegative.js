const a0_0x2faa76=a0_0x5cda;function a0_0x5cda(_0x17d94d,_0x589386){const _0x1f9f94=a0_0x1f9f();return a0_0x5cda=function(_0x5cdaec,_0x425a9c){_0x5cdaec=_0x5cdaec-0xe9;let _0x2fdac9=_0x1f9f94[_0x5cdaec];return _0x2fdac9;},a0_0x5cda(_0x17d94d,_0x589386);}(function(_0x10fbfc,_0x5d321b){const _0xfa28fd=a0_0x5cda,_0x241aa6=_0x10fbfc();while(!![]){try{const _0xdce4f7=-parseInt(_0xfa28fd(0xfd))/0x1+parseInt(_0xfa28fd(0x129))/0x2+-parseInt(_0xfa28fd(0xfe))/0x3+-parseInt(_0xfa28fd(0x122))/0x4+-parseInt(_0xfa28fd(0xf7))/0x5+-parseInt(_0xfa28fd(0x127))/0x6+-parseInt(_0xfa28fd(0x117))/0x7*(-parseInt(_0xfa28fd(0x111))/0x8);if(_0xdce4f7===_0x5d321b)break;else _0x241aa6['push'](_0x241aa6['shift']());}catch(_0x75437d){_0x241aa6['push'](_0x241aa6['shift']());}}}(a0_0x1f9f,0x3ede2));const express=require(a0_0x2faa76(0xf5)),app=express(),router=express[a0_0x2faa76(0x105)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x2faa76(0x107));function a0_0x1f9f(){const _0x154934=['$sale_product.product_code','$product_details.invoice','$sale_product.quantity','$invoice','16ZxAmzW','$sale_product.id_transaction_from','data_sales','flash','json','data_adjustment','4130413kwWOhO','$product.to_quantity','$room','$product.product_name','$product._id','$sale_product','$sale_product.product_name','table\x20page','\x20documents\x20updated','$sale_product._id','$product.id_transaction_id','1455972qXENix','log','$sale_product.invoice','modifiedCount','exports','1532670GrwTqD','message','407342OzhOGw','$name','$product.product_code','warehouse_data','$product_details.product_code','length','/join','_id','get','map','$product_details','status','success','express','$product','96220XTTThe','data_transfer','aggregate','/negative','valueOf','render','164922SNdsVM','968037IDYXZu','invoice','/warehouse_monitor','updateMany','$sale_product.room_name','$warehouse_name','$product.to_room_name','Router','/checking','../../models/all_models','all','$product.invoice','$product.room_names','warehouses','push'];a0_0x1f9f=function(){return _0x154934;};return a0_0x1f9f();}router['get'](a0_0x2faa76(0xfa),async(_0x38c092,_0x533501)=>{const _0x2368b3=a0_0x2faa76;try{const _0x573fdb=await warehouse[_0x2368b3(0x101)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x533501['json']({'status':_0x573fdb[_0x2368b3(0x125)]+_0x2368b3(0x11f)});}catch(_0x438738){console[_0x2368b3(0x123)](_0x2368b3(0x11e),_0x438738),_0x533501['status'](0xc8)[_0x2368b3(0x115)]({'message':_0x438738[_0x2368b3(0x128)]});}}),router[a0_0x2faa76(0xf0)](a0_0x2faa76(0x106),async(_0x266760,_0x51b62e)=>{const _0x4cc815=a0_0x2faa76;try{const _0x2e6c53=await warehouse[_0x4cc815(0xf9)]([{'$unwind':_0x4cc815(0xf2)},{'$match':{'product_details.invoice':'INCF-52068316','product_details.primary_code':'14800005047429'}},{'$group':{'_id':{'name':_0x4cc815(0xe9),'room':_0x4cc815(0x119)},'products':{'$push':_0x4cc815(0xf2)}}}]);_0x51b62e[_0x4cc815(0x115)](_0x2e6c53);}catch(_0x341464){console[_0x4cc815(0x123)](_0x4cc815(0x11e),_0x341464),_0x51b62e[_0x4cc815(0xf3)](0xc8)[_0x4cc815(0x115)]({'message':_0x341464[_0x4cc815(0x128)]});}}),router['get'](a0_0x2faa76(0x100),async(_0x3410d1,_0x57bef7)=>{const _0x6201dd=a0_0x2faa76;_0x57bef7[_0x6201dd(0xfc)]('monitor',{'success':_0x3410d1[_0x6201dd(0x114)](_0x6201dd(0xf4)),'errors':_0x3410d1['flash']('errors')});}),router[a0_0x2faa76(0xf0)](a0_0x2faa76(0xee),async(_0x46827c,_0x195cce)=>{const _0x44f4cd=a0_0x2faa76;var _0x2307bb=await purchases[_0x44f4cd(0xf9)]([{'$lookup':{'from':_0x44f4cd(0x10b),'let':{'invoice':'$invoice'},'pipeline':[{'$unwind':_0x44f4cd(0xf2)},{'$match':{'$expr':{'$eq':['$$invoice','$product_details.invoice']}}},{'$project':{'_id':'$product_details._id','product_name':'$product_details.product_name','product_code':_0x44f4cd(0xec),'quantity_available':'$product_details.product_stock','warehouse_name':'$name','warehouse_room':'$room','invoice':_0x44f4cd(0x10e)}}],'as':_0x44f4cd(0xeb)}}]);_0x2307bb['data_sales']={},await Promise[_0x44f4cd(0x108)](_0x2307bb['map'](async _0x51e335=>{const _0x3b5fa2=_0x44f4cd;_0x2307bb[_0x3b5fa2(0x113)][_0x51e335[_0x3b5fa2(0xff)]]=[],await Promise[_0x3b5fa2(0x108)](_0x51e335['warehouse_data']['map'](async _0x281644=>{const _0x13c2fa=_0x3b5fa2,_0xf0b755=await sales['aggregate']([{'$unwind':_0x13c2fa(0x11c)},{'$match':{'sale_product.id_transaction_from':_0x281644[_0x13c2fa(0xef)]['valueOf'](),'sale_product.invoice':_0x281644[_0x13c2fa(0xff)]}},{'$project':{'_id':_0x13c2fa(0x120),'product_name':_0x13c2fa(0x11d),'product_code':_0x13c2fa(0x10d),'quantity_available':_0x13c2fa(0x10f),'warehouse_name':_0x13c2fa(0x103),'warehouse_room':_0x13c2fa(0x102),'product_invoice':_0x13c2fa(0x124),'invoice':'$invoice','id_transaction_from':_0x13c2fa(0x112)}}]);_0xf0b755[_0x13c2fa(0xed)]>0x0&&_0x2307bb['data_sales'][_0x51e335[_0x13c2fa(0xff)]]['push'](..._0xf0b755);}));})),_0x2307bb['data_sales']=_0x2307bb[_0x44f4cd(0x113)],_0x2307bb[_0x44f4cd(0x116)]={},await Promise['all'](_0x2307bb[_0x44f4cd(0xf1)](async _0x7d52a5=>{const _0x4a5c75=_0x44f4cd;_0x2307bb[_0x4a5c75(0x116)][_0x7d52a5[_0x4a5c75(0xff)]]=[],await Promise['all'](_0x7d52a5[_0x4a5c75(0xeb)]['map'](async _0x321a96=>{const _0x3f0566=_0x4a5c75,_0x4626fd=await adjustment[_0x3f0566(0xf9)]([{'$unwind':_0x3f0566(0xf6)},{'$match':{'product.id_transaction_from':_0x321a96[_0x3f0566(0xef)][_0x3f0566(0xfb)](),'product.invoice':_0x321a96[_0x3f0566(0xff)]}},{'$project':{'_id':_0x3f0566(0x11b),'product_name':_0x3f0566(0x11a),'product_code':_0x3f0566(0xea),'quantity_available':'$product.new_adjust_qty','warehouse_name':_0x3f0566(0x103),'warehouse_room':_0x3f0566(0x10a),'product_invoice':_0x3f0566(0x109),'invoice':_0x3f0566(0x110),'id_transaction_from':'$product.id_transaction_from'}}]);_0x4626fd[_0x3f0566(0xed)]>0x0&&_0x2307bb[_0x3f0566(0x116)][_0x7d52a5[_0x3f0566(0xff)]][_0x3f0566(0x10c)](..._0x4626fd);}));})),_0x2307bb[_0x44f4cd(0xf8)]={},await Promise['all'](_0x2307bb[_0x44f4cd(0xf1)](async _0x296fe2=>{const _0x94b656=_0x44f4cd;_0x2307bb[_0x94b656(0xf8)][_0x296fe2[_0x94b656(0xff)]]=[],await Promise['all'](_0x296fe2['warehouse_data'][_0x94b656(0xf1)](async _0x5c1b64=>{const _0x5d2246=_0x94b656,_0xe3bd3e=await transfers['aggregate']([{'$unwind':_0x5d2246(0xf6)},{'$match':{'product.id_transaction_id':_0x5c1b64[_0x5d2246(0xef)]['valueOf'](),'product.To_invoice':_0x5c1b64[_0x5d2246(0xff)]}},{'$project':{'_id':'$product._id','product_name':_0x5d2246(0x11a),'product_code':'$product.product_code','quantity_available':_0x5d2246(0x118),'warehouse_name':'$to_warehouse','warehouse_room':_0x5d2246(0x10a),'product_invoice':_0x5d2246(0x104),'invoice':_0x5d2246(0x110),'id_transaction_id':_0x5d2246(0x121)}}]);console[_0x5d2246(0x123)](_0xe3bd3e),_0xe3bd3e[_0x5d2246(0xed)]>0x0&&_0x2307bb['data_transfer'][_0x296fe2[_0x5d2246(0xff)]]['push'](..._0xe3bd3e);}));})),_0x195cce['json']({'purchases_warehouse':_0x2307bb,'data_sales':_0x2307bb['data_sales'],'data_adjustment':_0x2307bb[_0x44f4cd(0x116)],'data_transfer':_0x2307bb[_0x44f4cd(0xf8)]});}),module[a0_0x2faa76(0x126)]=router;