const a0_0x2fff51=a0_0x49fe;function a0_0x49fe(_0x2efed9,_0x45c2dc){const _0x39aa70=a0_0x39aa();return a0_0x49fe=function(_0x49fe7c,_0x214fd6){_0x49fe7c=_0x49fe7c-0xc6;let _0x540bfd=_0x39aa70[_0x49fe7c];return _0x540bfd;},a0_0x49fe(_0x2efed9,_0x45c2dc);}function a0_0x39aa(){const _0x9b1536=['$room','status','$sale_product._id','/warehouse_monitor','12659843nlpEIo','INCF-52068316','6519220RuLRvf','all','$product_details.product_name','14800005047429','get','4197676KnNwAG','valueOf','$product.to_quantity','data_adjustment','/negative','success','$sale_product','$sale_product.invoice','errors','monitor','$product_details.invoice','../../models/all_models','$product.product_code','express','Router','log','map','/checking','warehouses','$invoice','$product_details._id','exports','table\x20page','$product.room_names','invoice','data_sales','modifiedCount','flash','$product.product_name','$name','$product','$product._id','$warehouse_name','2776290vvFYSx','$sale_product.product_code','_id','push','$product.invoice','/join','message','json','938382TbgTzq','aggregate','data_transfer','$product_details','$sale_product.id_transaction_from','$product.id_transaction_id','$$invoice','$sale_product.quantity','$product.new_adjust_qty','warehouse_data','$product_details.product_stock','8093688gQXzEF','729904faKFhG','$product.id_transaction_from'];a0_0x39aa=function(){return _0x9b1536;};return a0_0x39aa();}(function(_0x408e92,_0xa8a523){const _0x59eea2=a0_0x49fe,_0x3f9efc=_0x408e92();while(!![]){try{const _0x56a78b=-parseInt(_0x59eea2(0xe1))/0x1+-parseInt(_0x59eea2(0xd5))/0x2+-parseInt(_0x59eea2(0xcd))/0x3+parseInt(_0x59eea2(0xee))/0x4+-parseInt(_0x59eea2(0xe9))/0x5+parseInt(_0x59eea2(0xe0))/0x6+parseInt(_0x59eea2(0xe7))/0x7;if(_0x56a78b===_0xa8a523)break;else _0x3f9efc['push'](_0x3f9efc['shift']());}catch(_0x54fabb){_0x3f9efc['push'](_0x3f9efc['shift']());}}}(a0_0x39aa,0xbe133));const express=require(a0_0x2fff51(0xfb)),app=express(),router=express[a0_0x2fff51(0xfc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x2fff51(0xf9));router[a0_0x2fff51(0xed)](a0_0x2fff51(0xf2),async(_0x23720e,_0x25735e)=>{const _0x2b856b=a0_0x2fff51;try{const _0x128902=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x25735e['json']({'status':_0x128902[_0x2b856b(0xc6)]+'\x20documents\x20updated'});}catch(_0x3af5c9){console['log'](_0x2b856b(0x104),_0x3af5c9),_0x25735e[_0x2b856b(0xe4)](0xc8)[_0x2b856b(0xd4)]({'message':_0x3af5c9[_0x2b856b(0xd3)]});}}),router[a0_0x2fff51(0xed)](a0_0x2fff51(0xff),async(_0x114697,_0x227f73)=>{const _0x4dff23=a0_0x2fff51;try{const _0x3410ba=await warehouse[_0x4dff23(0xd6)]([{'$unwind':_0x4dff23(0xd8)},{'$match':{'product_details.invoice':_0x4dff23(0xe8),'product_details.primary_code':_0x4dff23(0xec)}},{'$group':{'_id':{'name':'$name','room':'$room'},'products':{'$push':_0x4dff23(0xd8)}}}]);_0x227f73[_0x4dff23(0xd4)](_0x3410ba);}catch(_0x4eb9c9){console[_0x4dff23(0xfd)](_0x4dff23(0x104),_0x4eb9c9),_0x227f73[_0x4dff23(0xe4)](0xc8)['json']({'message':_0x4eb9c9[_0x4dff23(0xd3)]});}}),router[a0_0x2fff51(0xed)](a0_0x2fff51(0xe6),async(_0x3bd277,_0x1e4d3d)=>{const _0x51faa7=a0_0x2fff51;_0x1e4d3d['render'](_0x51faa7(0xf7),{'success':_0x3bd277[_0x51faa7(0xc7)](_0x51faa7(0xf3)),'errors':_0x3bd277['flash'](_0x51faa7(0xf6))});}),router[a0_0x2fff51(0xed)](a0_0x2fff51(0xd2),async(_0x675251,_0x4346c2)=>{const _0xc9c39f=a0_0x2fff51;var _0x1ea8db=await purchases['aggregate']([{'$lookup':{'from':_0xc9c39f(0x100),'let':{'invoice':_0xc9c39f(0x101)},'pipeline':[{'$unwind':'$product_details'},{'$match':{'$expr':{'$eq':[_0xc9c39f(0xdb),_0xc9c39f(0xf8)]}}},{'$project':{'_id':_0xc9c39f(0x102),'product_name':_0xc9c39f(0xeb),'product_code':'$product_details.product_code','quantity_available':_0xc9c39f(0xdf),'warehouse_name':_0xc9c39f(0xc9),'warehouse_room':_0xc9c39f(0xe3),'invoice':_0xc9c39f(0xf8)}}],'as':'warehouse_data'}}]);_0x1ea8db['data_sales']={},await Promise['all'](_0x1ea8db[_0xc9c39f(0xfe)](async _0x1d0967=>{const _0x115292=_0xc9c39f;_0x1ea8db[_0x115292(0x107)][_0x1d0967[_0x115292(0x106)]]=[],await Promise['all'](_0x1d0967[_0x115292(0xde)][_0x115292(0xfe)](async _0x38e76=>{const _0x148d66=_0x115292,_0x20e29d=await sales[_0x148d66(0xd6)]([{'$unwind':_0x148d66(0xf4)},{'$match':{'sale_product.id_transaction_from':_0x38e76['_id']['valueOf'](),'sale_product.invoice':_0x38e76[_0x148d66(0x106)]}},{'$project':{'_id':_0x148d66(0xe5),'product_name':'$sale_product.product_name','product_code':_0x148d66(0xce),'quantity_available':_0x148d66(0xdc),'warehouse_name':_0x148d66(0xcc),'warehouse_room':'$sale_product.room_name','product_invoice':_0x148d66(0xf5),'invoice':_0x148d66(0x101),'id_transaction_from':_0x148d66(0xd9)}}]);_0x20e29d['length']>0x0&&_0x1ea8db['data_sales'][_0x1d0967['invoice']][_0x148d66(0xd0)](..._0x20e29d);}));})),_0x1ea8db['data_sales']=_0x1ea8db['data_sales'],_0x1ea8db[_0xc9c39f(0xf1)]={},await Promise[_0xc9c39f(0xea)](_0x1ea8db[_0xc9c39f(0xfe)](async _0x124d43=>{const _0x1255c8=_0xc9c39f;_0x1ea8db['data_adjustment'][_0x124d43[_0x1255c8(0x106)]]=[],await Promise[_0x1255c8(0xea)](_0x124d43[_0x1255c8(0xde)]['map'](async _0x3997bc=>{const _0x482d6f=_0x1255c8,_0x296be4=await adjustment[_0x482d6f(0xd6)]([{'$unwind':_0x482d6f(0xca)},{'$match':{'product.id_transaction_from':_0x3997bc['_id'][_0x482d6f(0xef)](),'product.invoice':_0x3997bc[_0x482d6f(0x106)]}},{'$project':{'_id':_0x482d6f(0xcb),'product_name':_0x482d6f(0xc8),'product_code':_0x482d6f(0xfa),'quantity_available':_0x482d6f(0xdd),'warehouse_name':_0x482d6f(0xcc),'warehouse_room':_0x482d6f(0x105),'product_invoice':_0x482d6f(0xd1),'invoice':'$invoice','id_transaction_from':_0x482d6f(0xe2)}}]);_0x296be4['length']>0x0&&_0x1ea8db[_0x482d6f(0xf1)][_0x124d43['invoice']][_0x482d6f(0xd0)](..._0x296be4);}));})),_0x1ea8db[_0xc9c39f(0xd7)]={},await Promise['all'](_0x1ea8db['map'](async _0x47a941=>{const _0x1a345e=_0xc9c39f;_0x1ea8db['data_transfer'][_0x47a941[_0x1a345e(0x106)]]=[],await Promise[_0x1a345e(0xea)](_0x47a941['warehouse_data'][_0x1a345e(0xfe)](async _0x136763=>{const _0x440d2d=_0x1a345e,_0x19fbef=await transfers['aggregate']([{'$unwind':_0x440d2d(0xca)},{'$match':{'product.id_transaction_id':_0x136763[_0x440d2d(0xcf)][_0x440d2d(0xef)](),'product.To_invoice':_0x136763[_0x440d2d(0x106)]}},{'$project':{'_id':'$product._id','product_name':_0x440d2d(0xc8),'product_code':_0x440d2d(0xfa),'quantity_available':_0x440d2d(0xf0),'warehouse_name':'$to_warehouse','warehouse_room':_0x440d2d(0x105),'product_invoice':'$product.to_room_name','invoice':_0x440d2d(0x101),'id_transaction_id':_0x440d2d(0xda)}}]);console[_0x440d2d(0xfd)](_0x19fbef),_0x19fbef['length']>0x0&&_0x1ea8db[_0x440d2d(0xd7)][_0x47a941['invoice']][_0x440d2d(0xd0)](..._0x19fbef);}));})),_0x4346c2['json']({'purchases_warehouse':_0x1ea8db,'data_sales':_0x1ea8db[_0xc9c39f(0x107)],'data_adjustment':_0x1ea8db[_0xc9c39f(0xf1)],'data_transfer':_0x1ea8db[_0xc9c39f(0xd7)]});}),module[a0_0x2fff51(0x103)]=router;