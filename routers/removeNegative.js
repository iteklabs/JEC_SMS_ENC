const a0_0x4efc4e=a0_0x3ba8;(function(_0x3622ec,_0x558606){const _0x379cdc=a0_0x3ba8,_0x2ca649=_0x3622ec();while(!![]){try{const _0x1b9de6=-parseInt(_0x379cdc(0x1f3))/0x1+-parseInt(_0x379cdc(0x1d6))/0x2+parseInt(_0x379cdc(0x1c2))/0x3+parseInt(_0x379cdc(0x1c4))/0x4+parseInt(_0x379cdc(0x1f5))/0x5+parseInt(_0x379cdc(0x1ed))/0x6+-parseInt(_0x379cdc(0x1e2))/0x7*(parseInt(_0x379cdc(0x1fa))/0x8);if(_0x1b9de6===_0x558606)break;else _0x2ca649['push'](_0x2ca649['shift']());}catch(_0x2f24a1){_0x2ca649['push'](_0x2ca649['shift']());}}}(a0_0x5866,0x5b170));function a0_0x3ba8(_0xb148c0,_0x3d933d){const _0x58665c=a0_0x5866();return a0_0x3ba8=function(_0x3ba8c7,_0x24d50d){_0x3ba8c7=_0x3ba8c7-0x1c0;let _0x3f6f82=_0x58665c[_0x3ba8c7];return _0x3f6f82;},a0_0x3ba8(_0xb148c0,_0x3d933d);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x4efc4e(0x1d5));function a0_0x5866(){const _0x553171=['success','2120115WoxGWZ','$product.product_name','/negative','$product_details.product_name','map','76832DNChEH','$product_details._id','all','$product.to_room_name','data_transfer','$product.new_adjust_qty','1699164zIACdy','$product.room_names','2338596VMYGeH','errors','$product.id_transaction_id','$product.to_quantity','$sale_product.id_transaction_from','$$invoice','$room','$product_details.product_stock','$sale_product.product_code','data_adjustment','message','$product_details','data_sales','render','_id','length','valueOf','../../models/all_models','392486AbOsQt','$sale_product.room_name','aggregate','flash','warehouse_data','INCF-52068316','$product.id_transaction_from','$product.invoice','$sale_product.invoice','$invoice','updateMany','warehouses','686pYPCgq','log','push','$name','$sale_product._id','$sale_product.product_name','json','invoice','$product._id','$warehouse_name','$product.product_code','1144764dxcPio','\x20documents\x20updated','$product_details.invoice','get','table\x20page','status','255315doTVkE'];a0_0x5866=function(){return _0x553171;};return a0_0x5866();}router[a0_0x4efc4e(0x1f0)](a0_0x4efc4e(0x1f7),async(_0x3ad33e,_0x5ac05a)=>{const _0x5e9117=a0_0x4efc4e;try{const _0x3d1f76=await warehouse[_0x5e9117(0x1e0)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x5ac05a[_0x5e9117(0x1e8)]({'status':_0x3d1f76['modifiedCount']+_0x5e9117(0x1ee)});}catch(_0x4a75b4){console['log'](_0x5e9117(0x1f1),_0x4a75b4),_0x5ac05a[_0x5e9117(0x1f2)](0xc8)[_0x5e9117(0x1e8)]({'message':_0x4a75b4['message']});}}),router[a0_0x4efc4e(0x1f0)]('/checking',async(_0x59a851,_0x25c941)=>{const _0x4e87f9=a0_0x4efc4e;try{const _0x2538cd=await warehouse[_0x4e87f9(0x1d8)]([{'$unwind':'$product_details'},{'$match':{'product_details.invoice':_0x4e87f9(0x1db),'product_details.primary_code':'14800005047429'}},{'$group':{'_id':{'name':_0x4e87f9(0x1e5),'room':_0x4e87f9(0x1ca)},'products':{'$push':_0x4e87f9(0x1cf)}}}]);_0x25c941[_0x4e87f9(0x1e8)](_0x2538cd);}catch(_0x358e5f){console[_0x4e87f9(0x1e3)](_0x4e87f9(0x1f1),_0x358e5f),_0x25c941[_0x4e87f9(0x1f2)](0xc8)[_0x4e87f9(0x1e8)]({'message':_0x358e5f[_0x4e87f9(0x1ce)]});}}),router[a0_0x4efc4e(0x1f0)]('/warehouse_monitor',async(_0x3b369f,_0x167149)=>{const _0x4b92bc=a0_0x4efc4e;_0x167149[_0x4b92bc(0x1d1)]('monitor',{'success':_0x3b369f[_0x4b92bc(0x1d9)](_0x4b92bc(0x1f4)),'errors':_0x3b369f[_0x4b92bc(0x1d9)](_0x4b92bc(0x1c5))});}),router[a0_0x4efc4e(0x1f0)]('/join',async(_0x49d001,_0x56c3f4)=>{const _0x3e02bf=a0_0x4efc4e;var _0x46bdcb=await purchases[_0x3e02bf(0x1d8)]([{'$lookup':{'from':_0x3e02bf(0x1e1),'let':{'invoice':_0x3e02bf(0x1df)},'pipeline':[{'$unwind':_0x3e02bf(0x1cf)},{'$match':{'$expr':{'$eq':[_0x3e02bf(0x1c9),_0x3e02bf(0x1ef)]}}},{'$project':{'_id':_0x3e02bf(0x1fb),'product_name':_0x3e02bf(0x1f8),'product_code':'$product_details.product_code','quantity_available':_0x3e02bf(0x1cb),'warehouse_name':_0x3e02bf(0x1e5),'warehouse_room':_0x3e02bf(0x1ca),'invoice':_0x3e02bf(0x1ef)}}],'as':_0x3e02bf(0x1da)}}]);_0x46bdcb['data_sales']={},await Promise['all'](_0x46bdcb[_0x3e02bf(0x1f9)](async _0x39c62f=>{const _0x33ee46=_0x3e02bf;_0x46bdcb[_0x33ee46(0x1d0)][_0x39c62f[_0x33ee46(0x1e9)]]=[],await Promise[_0x33ee46(0x1fc)](_0x39c62f['warehouse_data']['map'](async _0x2dd096=>{const _0x3faa3f=_0x33ee46,_0x302e3b=await sales[_0x3faa3f(0x1d8)]([{'$unwind':'$sale_product'},{'$match':{'sale_product.id_transaction_from':_0x2dd096[_0x3faa3f(0x1d2)][_0x3faa3f(0x1d4)](),'sale_product.invoice':_0x2dd096[_0x3faa3f(0x1e9)]}},{'$project':{'_id':_0x3faa3f(0x1e6),'product_name':_0x3faa3f(0x1e7),'product_code':_0x3faa3f(0x1cc),'quantity_available':'$sale_product.quantity','warehouse_name':'$warehouse_name','warehouse_room':_0x3faa3f(0x1d7),'product_invoice':_0x3faa3f(0x1de),'invoice':_0x3faa3f(0x1df),'id_transaction_from':_0x3faa3f(0x1c8)}}]);_0x302e3b[_0x3faa3f(0x1d3)]>0x0&&_0x46bdcb[_0x3faa3f(0x1d0)][_0x39c62f[_0x3faa3f(0x1e9)]][_0x3faa3f(0x1e4)](..._0x302e3b);}));})),_0x46bdcb['data_sales']=_0x46bdcb[_0x3e02bf(0x1d0)],_0x46bdcb[_0x3e02bf(0x1cd)]={},await Promise['all'](_0x46bdcb[_0x3e02bf(0x1f9)](async _0x11c346=>{const _0x10f03c=_0x3e02bf;_0x46bdcb[_0x10f03c(0x1cd)][_0x11c346[_0x10f03c(0x1e9)]]=[],await Promise['all'](_0x11c346[_0x10f03c(0x1da)][_0x10f03c(0x1f9)](async _0x5ab657=>{const _0x25ea31=_0x10f03c,_0x446cea=await adjustment[_0x25ea31(0x1d8)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_from':_0x5ab657['_id']['valueOf'](),'product.invoice':_0x5ab657['invoice']}},{'$project':{'_id':_0x25ea31(0x1ea),'product_name':'$product.product_name','product_code':_0x25ea31(0x1ec),'quantity_available':_0x25ea31(0x1c1),'warehouse_name':_0x25ea31(0x1eb),'warehouse_room':'$product.room_names','product_invoice':_0x25ea31(0x1dd),'invoice':_0x25ea31(0x1df),'id_transaction_from':_0x25ea31(0x1dc)}}]);_0x446cea[_0x25ea31(0x1d3)]>0x0&&_0x46bdcb[_0x25ea31(0x1cd)][_0x11c346[_0x25ea31(0x1e9)]][_0x25ea31(0x1e4)](..._0x446cea);}));})),_0x46bdcb[_0x3e02bf(0x1c0)]={},await Promise[_0x3e02bf(0x1fc)](_0x46bdcb[_0x3e02bf(0x1f9)](async _0x35fae3=>{const _0x4617ef=_0x3e02bf;_0x46bdcb[_0x4617ef(0x1c0)][_0x35fae3[_0x4617ef(0x1e9)]]=[],await Promise['all'](_0x35fae3['warehouse_data'][_0x4617ef(0x1f9)](async _0x4022cf=>{const _0x21a116=_0x4617ef,_0xd8d841=await transfers[_0x21a116(0x1d8)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_id':_0x4022cf['_id']['valueOf'](),'product.To_invoice':_0x4022cf[_0x21a116(0x1e9)]}},{'$project':{'_id':_0x21a116(0x1ea),'product_name':_0x21a116(0x1f6),'product_code':_0x21a116(0x1ec),'quantity_available':_0x21a116(0x1c7),'warehouse_name':'$to_warehouse','warehouse_room':_0x21a116(0x1c3),'product_invoice':_0x21a116(0x1fd),'invoice':'$invoice','id_transaction_id':_0x21a116(0x1c6)}}]);console['log'](_0xd8d841),_0xd8d841[_0x21a116(0x1d3)]>0x0&&_0x46bdcb[_0x21a116(0x1c0)][_0x35fae3[_0x21a116(0x1e9)]][_0x21a116(0x1e4)](..._0xd8d841);}));})),_0x56c3f4['json']({'purchases_warehouse':_0x46bdcb,'data_sales':_0x46bdcb['data_sales'],'data_adjustment':_0x46bdcb[_0x3e02bf(0x1cd)],'data_transfer':_0x46bdcb['data_transfer']});}),module['exports']=router;