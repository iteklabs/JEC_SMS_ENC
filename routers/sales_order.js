var a0_0x312771=a0_0x54b5;function a0_0x54b5(_0x26cccd,_0x5d1d1b){var _0x3c7fc6=a0_0x3c7f();return a0_0x54b5=function(_0x54b5df,_0x4f6220){_0x54b5df=_0x54b5df-0x1ba;var _0xf4ea99=_0x3c7fc6[_0x54b5df];return _0xf4ea99;},a0_0x54b5(_0x26cccd,_0x5d1d1b);}function a0_0x3c7f(){var _0x12577a=['port','dicount_price_adjust','name','password','product_list','post','$sale_product.quantity','true','log','mongoose','$account_data','<strong>\x20Regards\x20</strong>','_id','$wms_data','/view_sales/:id','<br><br><span>\x20The\x20total\x20quantity\x20for\x20these\x20items\x20is\x20<b>','<span>\x20Request\x20Date:\x20<b>','4122360UsXEdp','wms_account_id','../models/all_models','</b>.\x20These\x20products\x20are\x20essential\x20to\x20improve\x20our\x20warehouse\x20efficiency\x20and\x20ensure\x20smooth\x20operations.\x20</span>','$head_staff_info','save','xlsx','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Chinese','tmpisFG','</b></span>\x20<br>','500670YVredm','$JD','image','Router','4686660HAdtdw','4sCrrTo','113IVMgwC','invoice','all_sales_order','Email\x20sent\x20successfully','createTransport','head_id_staff_id','conversion_unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','head_staff_info','<!DOCTYPE\x20html>','/product_data','flash','$date','</div>','findOne','</tbody>','</thead>','toString','body','Error\x20Occurs','add_sales_order','prod_cat','$wms_account_id','$accounting_account_id','<h2>\x20JEC\x20SMS\x20</h2>','<tr>','Types','Approval\x20for\x20','</tr>','/add_sales','product_name','language','find','success','/product_list','<br><br><br>','Logo.png','\x22>Change\x20Status</a>',';christian.villamer@jakagroup.com','8902VxRTnD','discount','<h5>\x20JEC\x20SMS\x20</h5>','accounting_account_id','2091152HqozWT','Hindi','../middleware/auth','German','json','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','10tWJduz','../public/language/languages.json','map','findById','sales_category','get','redirect','<span>\x20lease\x20review\x20the\x20request\x20and\x20approve\x20it\x20if\x20it\x20aligns\x20with\x20our\x20operational\x20needs.\x20If\x20you\x20have\x20any\x20questions\x20or\x20require\x20further\x20information,\x20please\x20feel\x20free\x20to\x20reach\x20out\x20to\x20the\x20Sales\x20Department.\x20</span>','unit','sttaff_id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','render','</b></span>\x20<br><br>','/upload/','296067CFyGTE','$member','<hr\x20class=\x22my-3\x22>','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','email','protocol','<link\x20href=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\x22\x20rel=\x22stylesheet\x22\x20integrity=\x22sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\x22\x20crossorigin=\x22anonymous\x22>','ObjectId','English','primary_code','</table>','</td>','totalprice','/accounting_approval/','9458469mMDoyb','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<span>\x20A\x20product\x20request\x20has\x20been\x20submitted\x20by\x20the\x20Sales\x20Department\x20that\x20requires\x20your\x20approval.\x20Below\x20are\x20the\x20details:\x20</span>\x20<br><br>','totalPrice','sendMail','$head_id_staff','$wms_account_confirm','$sale_product','<span>\x20Request\x20ID:\x20<b>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','conversion_data','Portuguese\x20(BR)','</body></html>','<div>','price','user','no_per_unit','errors','French','staffs','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<html><head><title></title>','valueOf','English\x20(US)','<span>\x20Thank\x20you\x20for\x20your\x20prompt\x20attention\x20to\x20this\x20matter.\x20</span>','</head><body>','secondary_unit','headers','<div\x20style=\x22text-align:\x20center;\x22>','Arabic','<script\x20src=\x22https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\x22\x20integrity=\x22sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz\x22\x20crossorigin=\x22anonymous\x22></script>','head_id_staff','real_qty_unit_val','<br><br>','getPrimUnitNo','<a\x20style=\x22background-color:\x20#007bff;\x20color:\x20#ffffff;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x205px;\x22\x20href=\x22','forEach','exports','host','invoice_init','product_id','Spanish','dicount_price','quantity','<span>\x20Dear\x20<b>','aggregate','exceljs','logo','<span>\x20Requested\x20By:\x20<b>','Portuguese','<tbody\x20style=\x22text-align:\x20center;\x22>'];a0_0x3c7f=function(){return _0x12577a;};return a0_0x3c7f();}(function(_0x379df5,_0x288d3){var _0x1d5b76=a0_0x54b5,_0x4047a3=_0x379df5();while(!![]){try{var _0x1eb1db=parseInt(_0x1d5b76(0x23e))/0x1*(parseInt(_0x1d5b76(0x1bf))/0x2)+parseInt(_0x1d5b76(0x1d7))/0x3*(parseInt(_0x1d5b76(0x23d))/0x4)+-parseInt(_0x1d5b76(0x238))/0x5+parseInt(_0x1d5b76(0x23c))/0x6+-parseInt(_0x1d5b76(0x1c3))/0x7+parseInt(_0x1d5b76(0x22c))/0x8+parseInt(_0x1d5b76(0x1e6))/0x9*(-parseInt(_0x1d5b76(0x1c9))/0xa);if(_0x1eb1db===_0x288d3)break;else _0x4047a3['push'](_0x4047a3['shift']());}catch(_0x424d14){_0x4047a3['push'](_0x4047a3['shift']());}}}(a0_0x3c7f,0x6d6f6));const express=require('express'),app=express(),router=express[a0_0x312771(0x23b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sales_order,invoice_sa,sales_sa,invoice_for_sales_order,approver_acct,email_settings}=require(a0_0x312771(0x22e)),auth=require(a0_0x312771(0x1c5)),users=require(a0_0x312771(0x1ca)),excelJS=require(a0_0x312771(0x216)),xlsx=require(a0_0x312771(0x232)),mongoose=require(a0_0x312771(0x224)),{ObjectId}=require('mongodb'),nodemailer=require('nodemailer');router[a0_0x312771(0x1ce)]('/',auth,async(_0x464615,_0x3ed727)=>{var _0x5b44f5=a0_0x312771;try{const _0x32afd0=await master_shop[_0x5b44f5(0x25e)](),_0x154664=_0x464615[_0x5b44f5(0x1f7)],_0x1c99b6=await profile[_0x5b44f5(0x24c)]({'email':_0x154664[_0x5b44f5(0x1dc)]}),_0x5938e8=await staff['findOne']({'email':_0x154664['email']}),_0x10414a=await sales_order[_0x5b44f5(0x215)]([{'$match':{'sales_staff_id':_0x5938e8[_0x5b44f5(0x227)]['valueOf']()}},{'$unwind':_0x5b44f5(0x1ed)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customer':{'$first':'$customer'},'date':{'$first':_0x5b44f5(0x24a)},'JD':{'$first':_0x5b44f5(0x239)},'accounting_account_confirm':{'$first':'$accounting_account_confirm'},'wms_account_confirm':{'$first':_0x5b44f5(0x1ec)},'totalQTY':{'$sum':_0x5b44f5(0x221)}}}]);if(_0x32afd0[0x0]['language']==_0x5b44f5(0x1ff))var _0x509b2f=users[_0x5b44f5(0x1e0)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]==_0x5b44f5(0x1c4))var _0x509b2f=users[_0x5b44f5(0x1c4)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]=='German')var _0x509b2f=users[_0x5b44f5(0x1c6)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]==_0x5b44f5(0x211))var _0x509b2f=users[_0x5b44f5(0x211)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]==_0x5b44f5(0x1fa))var _0x509b2f=users[_0x5b44f5(0x1fa)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]==_0x5b44f5(0x1f3))var _0x509b2f=users[_0x5b44f5(0x219)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]=='Chinese')var _0x509b2f=users[_0x5b44f5(0x235)];else{if(_0x32afd0[0x0][_0x5b44f5(0x25d)]==_0x5b44f5(0x1f0))var _0x509b2f=users[_0x5b44f5(0x205)];}}}}}}}_0x3ed727[_0x5b44f5(0x1d4)](_0x5b44f5(0x240),{'success':_0x464615[_0x5b44f5(0x249)](_0x5b44f5(0x25f)),'errors':_0x464615['flash'](_0x5b44f5(0x1f9)),'master_shop':_0x32afd0,'profile':_0x1c99b6,'role':_0x154664,'language':_0x509b2f,'product_list':_0x5938e8[_0x5b44f5(0x21f)],'sales_mine':_0x10414a,'staff_arr':_0x5938e8});}catch(_0x4d06bd){console[_0x5b44f5(0x223)](_0x4d06bd);}}),router[a0_0x312771(0x1ce)](a0_0x312771(0x25b),auth,async(_0x1a0f65,_0x4517d2)=>{var _0x4f6dae=a0_0x312771;try{const _0x37f6d3=await master_shop[_0x4f6dae(0x25e)](),_0x4fc300=_0x1a0f65[_0x4f6dae(0x1f7)],_0x9e07c2=await profile['findOne']({'email':_0x4fc300[_0x4f6dae(0x1dc)]}),_0xf72901=await staff[_0x4f6dae(0x24c)]({'email':_0x4fc300[_0x4f6dae(0x1dc)]}),_0x44df32=await customer[_0x4f6dae(0x25e)]({'agent_id':_0xf72901['_id']});if(_0x37f6d3[0x0]['language']==_0x4f6dae(0x1ff))var _0x1bc2bd=users['English'];else{if(_0x37f6d3[0x0][_0x4f6dae(0x25d)]==_0x4f6dae(0x1c4))var _0x1bc2bd=users[_0x4f6dae(0x1c4)];else{if(_0x37f6d3[0x0][_0x4f6dae(0x25d)]=='German')var _0x1bc2bd=users[_0x4f6dae(0x1c6)];else{if(_0x37f6d3[0x0][_0x4f6dae(0x25d)]==_0x4f6dae(0x211))var _0x1bc2bd=users[_0x4f6dae(0x211)];else{if(_0x37f6d3[0x0]['language']==_0x4f6dae(0x1fa))var _0x1bc2bd=users[_0x4f6dae(0x1fa)];else{if(_0x37f6d3[0x0]['language']==_0x4f6dae(0x1f3))var _0x1bc2bd=users[_0x4f6dae(0x219)];else{if(_0x37f6d3[0x0]['language']==_0x4f6dae(0x235))var _0x1bc2bd=users[_0x4f6dae(0x235)];else{if(_0x37f6d3[0x0][_0x4f6dae(0x25d)]=='Arabic\x20(ae)')var _0x1bc2bd=users[_0x4f6dae(0x205)];}}}}}}}_0x4517d2[_0x4f6dae(0x1d4)](_0x4f6dae(0x252),{'success':_0x1a0f65[_0x4f6dae(0x249)](_0x4f6dae(0x25f)),'errors':_0x1a0f65[_0x4f6dae(0x249)](_0x4f6dae(0x1f9)),'master_shop':_0x37f6d3,'profile':_0x9e07c2,'role':_0x4fc300,'language':_0x1bc2bd,'customer':_0x44df32,'staff_arr':_0xf72901});}catch(_0x439c45){console[_0x4f6dae(0x223)](_0x439c45);}}),router['get'](a0_0x312771(0x229),auth,async(_0x2e2fb7,_0xa498e3)=>{var _0xc82113=a0_0x312771;try{const _0x25473b=await master_shop[_0xc82113(0x25e)](),_0x275ee0=_0x2e2fb7[_0xc82113(0x1f7)],_0x44ed08=await profile[_0xc82113(0x24c)]({'email':_0x275ee0[_0xc82113(0x1dc)]}),_0x1b2ab3=await staff[_0xc82113(0x24c)]({'email':_0x275ee0[_0xc82113(0x1dc)]}),_0x501e50=await customer[_0xc82113(0x25e)]({'agent_id':_0x1b2ab3['_id']}),_0x476011=mongoose[_0xc82113(0x258)][_0xc82113(0x1df)],_0x15ec1c=_0x2e2fb7['params']['id'],_0x218fb2=await sales_order[_0xc82113(0x1cc)](_0x15ec1c),_0x1f81e7=await sales_order[_0xc82113(0x215)]([{'$match':{'_id':_0x476011(_0x15ec1c)}},{'$addFields':{'accounting_account_id':{'$toObjectId':_0xc82113(0x255)}}},{'$addFields':{'wms_account_id':{'$toObjectId':_0xc82113(0x254)}}},{'$lookup':{'from':_0xc82113(0x1fb),'localField':_0xc82113(0x1c2),'foreignField':_0xc82113(0x227),'as':'account_data'}},{'$unwind':_0xc82113(0x225)},{'$lookup':{'from':_0xc82113(0x1fb),'localField':_0xc82113(0x22d),'foreignField':_0xc82113(0x227),'as':'wms_data'}},{'$unwind':{'path':_0xc82113(0x228),'preserveNullAndEmptyArrays':!![]}}]);if(_0x25473b[0x0]['language']==_0xc82113(0x1ff))var _0x52fe4e=users[_0xc82113(0x1e0)];else{if(_0x25473b[0x0][_0xc82113(0x25d)]==_0xc82113(0x1c4))var _0x52fe4e=users[_0xc82113(0x1c4)];else{if(_0x25473b[0x0][_0xc82113(0x25d)]=='German')var _0x52fe4e=users[_0xc82113(0x1c6)];else{if(_0x25473b[0x0][_0xc82113(0x25d)]==_0xc82113(0x211))var _0x52fe4e=users[_0xc82113(0x211)];else{if(_0x25473b[0x0][_0xc82113(0x25d)]==_0xc82113(0x1fa))var _0x52fe4e=users['French'];else{if(_0x25473b[0x0][_0xc82113(0x25d)]==_0xc82113(0x1f3))var _0x52fe4e=users[_0xc82113(0x219)];else{if(_0x25473b[0x0][_0xc82113(0x25d)]=='Chinese')var _0x52fe4e=users[_0xc82113(0x235)];else{if(_0x25473b[0x0][_0xc82113(0x25d)]=='Arabic\x20(ae)')var _0x52fe4e=users[_0xc82113(0x205)];}}}}}}}_0xa498e3[_0xc82113(0x1d4)]('view_sales_order',{'success':_0x2e2fb7[_0xc82113(0x249)]('success'),'errors':_0x2e2fb7[_0xc82113(0x249)](_0xc82113(0x1f9)),'master_shop':_0x25473b,'profile':_0x44ed08,'role':_0x275ee0,'language':_0x52fe4e,'customer':_0x501e50,'sales_sa':_0x218fb2,'approvers':_0x1f81e7[0x0],'staff_arr':_0x1b2ab3});}catch(_0x3ebc85){console[_0xc82113(0x223)](_0x3ebc85);}}),router[a0_0x312771(0x220)](a0_0x312771(0x25b),auth,async(_0x11389f,_0x3b6193)=>{var _0x4c21f8=a0_0x312771;try{const {customer:_0x3f17c6,date:_0x41f221,prod_code:_0x5e311a,note:_0x582a4b,paid_status:_0x2f37a8,JD:_0x58203e,po_number:_0x62b96b,desire_date:_0x4d5fdc}=_0x11389f['body'];if(typeof _0x5e311a=='string')var _0x10d24d=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x233)]],_0x3d033c=[_0x11389f[_0x4c21f8(0x250)]['prod_name']],_0x480cc1=[_0x11389f[_0x4c21f8(0x250)]['primary_code']],_0x51ca10=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x213)]],_0x130944=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1d1)]],_0x4b0c02=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x210)]],_0xedc85=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1f6)]],_0xf2c300=[_0x11389f[_0x4c21f8(0x250)]['totalPrice']],_0x589af8=[_0x11389f['body'][_0x4c21f8(0x212)]],_0x4d8a40=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x236)]],_0x57e714=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x21c)]],_0x496d75=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1f8)]],_0x101103=[_0x11389f['body']['getPrimUnitNo']],_0x11c4ac=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x253)]],_0x42a015=[_0x11389f[_0x4c21f8(0x250)]['secondary_unit']],_0x577409=[_0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x244)]];else var _0x10d24d=[..._0x11389f['body']['prod_code']],_0x3d033c=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1da)]],_0x480cc1=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1e1)]],_0x51ca10=[..._0x11389f['body'][_0x4c21f8(0x213)]],_0x130944=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1d1)]],_0x4b0c02=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x210)]],_0xedc85=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1f6)]],_0xf2c300=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1e9)]],_0x589af8=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x212)]],_0x4d8a40=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x236)]],_0x57e714=[..._0x11389f['body']['dicount_price_adjust']],_0x496d75=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x1f8)]],_0x101103=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x20a)]],_0x11c4ac=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x253)]],_0x42a015=[..._0x11389f['body'][_0x4c21f8(0x202)]],_0x577409=[..._0x11389f[_0x4c21f8(0x250)][_0x4c21f8(0x244)]];const _0x50e551=_0x10d24d[_0x4c21f8(0x1cb)](_0x13aab6=>{return _0x13aab6={'product_code':_0x13aab6};});_0x3d033c[_0x4c21f8(0x20c)]((_0x50b93a,_0x311f55)=>{_0x50e551[_0x311f55]['product_name']=_0x50b93a;}),_0x480cc1[_0x4c21f8(0x20c)]((_0x434df8,_0x5b9506)=>{var _0x1c05af=_0x4c21f8;_0x50e551[_0x5b9506][_0x1c05af(0x1e1)]=_0x434df8;}),_0x51ca10[_0x4c21f8(0x20c)]((_0x221092,_0x58cdc4)=>{_0x50e551[_0x58cdc4]['quantity']=_0x221092;}),_0x130944['forEach']((_0x101bbb,_0x110285)=>{var _0x5a4fdf=_0x4c21f8;_0x50e551[_0x110285][_0x5a4fdf(0x1d1)]=_0x101bbb;}),_0x4b0c02[_0x4c21f8(0x20c)]((_0x5b206f,_0x594120)=>{var _0x3cb55b=_0x4c21f8;_0x50e551[_0x594120][_0x3cb55b(0x210)]=_0x5b206f;}),_0x57e714[_0x4c21f8(0x20c)]((_0x8d8491,_0x11b6f3)=>{_0x50e551[_0x11b6f3]['adjustment_discount']=_0x8d8491;}),_0xedc85[_0x4c21f8(0x20c)]((_0x379776,_0x3f14a)=>{_0x50e551[_0x3f14a]['price']=_0x379776;}),_0xf2c300[_0x4c21f8(0x20c)]((_0x4c1b18,_0x4f91b5)=>{var _0x29b57c=_0x4c21f8;_0x50e551[_0x4f91b5][_0x29b57c(0x1e4)]=_0x4c1b18;}),_0x589af8[_0x4c21f8(0x20c)]((_0x14648c,_0x57500e)=>{var _0x30006d=_0x4c21f8;_0x50e551[_0x57500e][_0x30006d(0x1c0)]=_0x14648c;}),_0x4d8a40[_0x4c21f8(0x20c)]((_0x21d4c1,_0x49553a)=>{_0x50e551[_0x49553a]['isFG']=_0x21d4c1;}),_0x42a015['forEach']((_0x197cb8,_0x33462c)=>{var _0x391cca=_0x4c21f8;_0x50e551[_0x33462c][_0x391cca(0x202)]=_0x197cb8;}),_0x101103['forEach']((_0x3d61c2,_0x23bad9)=>{var _0xe8d294=_0x4c21f8;_0x50e551[_0x23bad9][_0xe8d294(0x208)]=_0x3d61c2;}),_0x11c4ac['forEach']((_0x562914,_0x1867bf)=>{var _0x52fbce=_0x4c21f8;_0x50e551[_0x1867bf][_0x52fbce(0x253)]=_0x562914;}),_0x577409[_0x4c21f8(0x20c)]((_0x440a75,_0x31dba1)=>{var _0x250ffb=_0x4c21f8;_0x50e551[_0x31dba1][_0x250ffb(0x1f2)]=_0x440a75;}),_0x496d75[_0x4c21f8(0x20c)]((_0x3d5bba,_0x51b667)=>{var _0x2fc89e=_0x4c21f8;_0x50e551[_0x51b667][_0x2fc89e(0x1f8)]=_0x3d5bba;});const _0x5ddd2c=await approver_acct['aggregate']([{'$unwind':_0x4c21f8(0x1d8)},{'$match':{'member.id_member':_0x11389f[_0x4c21f8(0x1f7)][_0x4c21f8(0x1d2)]}},{'$group':{'_id':{'id_member':'$member.id_member','name':'$member.name'},'head_id_staff':{'$first':_0x4c21f8(0x1eb)}}},{'$addFields':{'head_id_staff_id':{'$toObjectId':_0x4c21f8(0x1eb)}}},{'$lookup':{'from':_0x4c21f8(0x1fb),'localField':_0x4c21f8(0x243),'foreignField':_0x4c21f8(0x227),'as':_0x4c21f8(0x246)}},{'$unwind':_0x4c21f8(0x230)}]),_0x2dd448=new invoice_for_sales_order();await _0x2dd448[_0x4c21f8(0x231)]();const _0x55c8ca=_0x11389f['user'],_0x590d35=await staff[_0x4c21f8(0x24c)]({'email':_0x55c8ca[_0x4c21f8(0x1dc)]}),_0x3fc1f0=new sales_order({'invoice':_0x2dd448[_0x4c21f8(0x20f)][_0x4c21f8(0x24f)]()['padStart'](0x8,'0'),'customer':_0x3f17c6,'date':_0x41f221,'sale_product':_0x50e551,'note':_0x582a4b,'sales_staff_id':_0x590d35[_0x4c21f8(0x227)][_0x4c21f8(0x1fe)](),'JD':_0x58203e,'accounting_account_id':_0x5ddd2c[0x0][_0x4c21f8(0x207)],'po_number':_0x62b96b,'desired_delivery':_0x4d5fdc,'wms_account_confirm':_0x4c21f8(0x222),'accounting_account_confirm':_0x4c21f8(0x222)}),_0x470713=await _0x3fc1f0[_0x4c21f8(0x231)]();var _0xbe7d86=_0x470713['sale_product'],_0x3c96d0='',_0x16654c,_0x4d2dcc=0x0;for(_0x16654c in _0xbe7d86){_0x3c96d0+='<tr>'+_0x4c21f8(0x245)+_0xbe7d86[_0x16654c][_0x4c21f8(0x25c)]+_0x4c21f8(0x1e3)+_0x4c21f8(0x245)+_0xbe7d86[_0x16654c]['product_code']+_0x4c21f8(0x1e3)+_0x4c21f8(0x245)+_0xbe7d86[_0x16654c][_0x4c21f8(0x213)]+_0x4c21f8(0x1e3)+_0x4c21f8(0x245)+_0xbe7d86[_0x16654c][_0x4c21f8(0x1d1)]+_0x4c21f8(0x1e3)+_0x4c21f8(0x25a),_0x4d2dcc+=parseInt(_0xbe7d86[_0x16654c]['quantity']);}const _0xbe9897=await master_shop[_0x4c21f8(0x25e)](),_0x291ca3=await email_settings[_0x4c21f8(0x24c)]();let _0x3a7bb3=nodemailer[_0x4c21f8(0x242)]({'port':Number(_0x291ca3[_0x4c21f8(0x21b)]),'secure':![],'auth':{'user':_0x291ca3[_0x4c21f8(0x1dc)],'pass':_0x291ca3[_0x4c21f8(0x21e)]}});const _0x44f41f=_0x11389f[_0x4c21f8(0x1dd)]+'://'+_0x11389f[_0x4c21f8(0x203)][_0x4c21f8(0x20e)];let _0x434ff3={'from':_0x291ca3[_0x4c21f8(0x1dc)],'to':_0x5ddd2c[0x0][_0x4c21f8(0x246)]['email']+_0x4c21f8(0x1be),'subject':_0x4c21f8(0x259)+_0x470713[_0x4c21f8(0x23f)],'attachments':[{'filename':_0x4c21f8(0x1bc),'path':__dirname+'/../public'+_0x4c21f8(0x1d6)+_0xbe9897[0x0][_0x4c21f8(0x23a)],'cid':_0x4c21f8(0x217)}],'html':_0x4c21f8(0x247)+_0x4c21f8(0x1fd)+_0x4c21f8(0x1de)+_0x4c21f8(0x201)+_0x4c21f8(0x1f5)+_0x4c21f8(0x1c8)+_0x4c21f8(0x1f5)+_0x4c21f8(0x1fc)+_0x4c21f8(0x24b)+_0x4c21f8(0x1f5)+_0x4c21f8(0x256)+_0x4c21f8(0x24b)+'</div>'+_0x4c21f8(0x1d9)+_0x4c21f8(0x1f5)+_0x4c21f8(0x214)+_0x5ddd2c[0x0][_0x4c21f8(0x246)]['name']+'</b>,\x20</span><br>'+_0x4c21f8(0x24b)+_0x4c21f8(0x1f5)+_0x4c21f8(0x1e8)+_0x4c21f8(0x24b)+_0x4c21f8(0x1f5)+_0x4c21f8(0x1ee)+_0x470713[_0x4c21f8(0x23f)]+_0x4c21f8(0x237)+_0x4c21f8(0x218)+_0x590d35[_0x4c21f8(0x21d)]+'</b></span>\x20<br>'+_0x4c21f8(0x22b)+_0x470713['date']+_0x4c21f8(0x1d5)+'</div>'+_0x4c21f8(0x1d3)+_0x4c21f8(0x1e7)+_0x4c21f8(0x257)+_0x4c21f8(0x1db)+_0x4c21f8(0x1f1)+_0x4c21f8(0x1ef)+_0x4c21f8(0x234)+'</tr>'+_0x4c21f8(0x24e)+_0x4c21f8(0x21a)+'\x20'+_0x3c96d0+'\x20'+_0x4c21f8(0x24d)+_0x4c21f8(0x1e2)+'<div>'+_0x4c21f8(0x22a)+_0x4d2dcc+_0x4c21f8(0x22f)+_0x4c21f8(0x1d0)+_0x4c21f8(0x200)+_0x4c21f8(0x1bb)+_0x4c21f8(0x24b)+_0x4c21f8(0x204)+_0x4c21f8(0x20b)+_0x44f41f+_0x4c21f8(0x1e5)+_0x470713[_0x4c21f8(0x227)]+_0x4c21f8(0x1bd)+_0x4c21f8(0x209)+_0x4c21f8(0x24b)+_0x4c21f8(0x1f5)+_0x4c21f8(0x226)+_0x4c21f8(0x1c1)+_0x4c21f8(0x24b)+_0x4c21f8(0x24b)+_0x4c21f8(0x206)+_0x4c21f8(0x1f4)};_0x3a7bb3[_0x4c21f8(0x1ea)](_0x434ff3,function(_0x1f3fb3,_0xd4ec78){var _0x2cc3f2=_0x4c21f8;_0x1f3fb3?(console[_0x2cc3f2(0x223)](_0x1f3fb3),console['log'](_0x2cc3f2(0x251))):console[_0x2cc3f2(0x223)](_0x2cc3f2(0x241));}),_0x11389f[_0x4c21f8(0x249)](_0x4c21f8(0x25f),'Sales\x20Order\x20is\x20ongoing'),_0x3b6193[_0x4c21f8(0x1cf)]('/sales_order/view_sales/'+_0x470713[_0x4c21f8(0x227)]);}catch(_0x153d8b){}}),router[a0_0x312771(0x220)](a0_0x312771(0x1ba),auth,async(_0xdb33ee,_0x39f34c)=>{var _0x602299=a0_0x312771;try{const _0x4e013b=_0xdb33ee['user'],_0x192cd6=await profile['findOne']({'email':_0x4e013b[_0x602299(0x1dc)]}),_0x11f9cd=await product[_0x602299(0x25e)]({'sales_category':_0x4e013b[_0x602299(0x1cd)]});_0x39f34c[_0x602299(0x1c7)](_0x11f9cd);}catch(_0xd35878){}}),router['post'](a0_0x312771(0x248),auth,async(_0x189c00,_0x513397)=>{var _0x21a8f3=a0_0x312771;try{const _0x26d899=_0x189c00['user'],{id_data:_0x4e720a}=_0x189c00[_0x21a8f3(0x250)],_0x56115e=await profile[_0x21a8f3(0x24c)]({'email':_0x26d899[_0x21a8f3(0x1dc)]}),_0x1dcc98=mongoose['Types'][_0x21a8f3(0x1df)];var _0x1f8bf7=_0x1dcc98(_0x4e720a);const _0x4cf1b8=await product[_0x21a8f3(0x25e)]({'_id':_0x1f8bf7});_0x513397[_0x21a8f3(0x1c7)](_0x4cf1b8);}catch(_0x2c2c4f){}}),module[a0_0x312771(0x20d)]=router;