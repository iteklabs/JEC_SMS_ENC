var a0_0x4fc6b7=a0_0x182c;function a0_0x182c(_0x58d8ba,_0x405e0a){var _0x37f5e6=a0_0x37f5();return a0_0x182c=function(_0x182c04,_0x420b7f){_0x182c04=_0x182c04-0x1aa;var _0x779889=_0x37f5e6[_0x182c04];return _0x779889;},a0_0x182c(_0x58d8ba,_0x405e0a);}function a0_0x37f5(){var _0x5dc56a=['push','actual_uom','return_qty','warehouse','all','$warehouse_name','Sales\x20Update\x20successfully','secondary_code','$date','2242504nXMauu','$product_details.product_stock','success','product_name','$product_details.level','return_sale','sales\x20item\x20return\x20successfull','186MFhgRe','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/all_sales/view','<hr\x20class=\x22my-3\x22>','$sale_product.floorlevel','port','\x20Order\x20Number\x20:\x20','</span>','<html><head><title></title>','Hindi','forEach','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','quantity_notConverted','customers','13396MauXWY','types','finalize','findById','$product_details.primary_code','batch_code','invoice','logo','max','Received\x20Payment\x20For\x20Sale','findOne','max_per_unit','product_data','product_details','Portuguese','</tbody>','slice','body','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','get','storage','isAllowEdit','/upload/','$sale_product.bin','$product_details.rack','/all_sales/preview/','539450hStsWf','$product','Ambient','1809437LENxUP','user','master','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$customer','delivery_date','password','$product_details.batch_code','currency','sales\x20all_data','params','room','Sale\x20Return','log','Enabled','$product_details.floorlevel','sendMail','render','\x20Order\x20Date\x20:\x20','id_transact','$sale_product.type','string','</body></html>','<h5\x20style=\x22text-align:\x20left;\x22>','/view/:id','758270MtkYgl','actual_qty','$invoice','OUT-','/preview/:id','delivery_code','quantity','abs','bay','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Spanish','product','message','Return\x20Goods','customers_docs','6uTAkZS','stock_data','French','$isAllowEdit','production_date','all_sales_barcode','<!DOCTYPE\x20html>','_id','$note','filter','payment\x20successfull','RoomAssigned','bin','site_title','date','product_code','post','then','length','$product_details.secondary_unit','gmail','$product.product_name','$product_details.invoice','$product_details.bay','sale_product','status','stocks','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','warehouse_name','save','concat','<tbody\x20style=\x22text-align:\x20center;\x22>','</head><body>','secondary_unit','level','/view/return_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','host','<strong>\x20Regards\x20</strong>','nodemailer','barcode\x20user_id','../public/language/languages.json','rack','Shelves','</h5>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','all_sales','maxperunit','<span\x20style=\x22float:\x20right;\x22>','$product_details.product_code','$product_details.secondary_code','staff','map','Return\x20Rooms','expiry_date','customer_data','\x20</h2>','<h2>\x20','prod_invoice','note','</td>','split','find','received_amount','Portuguese\x20(BR)','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$_id','Chinese','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Logo.png','True','id_transaction_from','/barcode_scanner','aggregate','<tr>','add\x20post','image','$product_details.unit','currency_placement','9tYVrNX','Email\x20sent\x20successfully','barcode\x20Product\x20master','sales_invoice','sales_quantity','$finalize','$sale_product','$product_details.pallet','89498WgrbcZ','getMonth','</table>','Router','False','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sale_qty','redirect','../models/all_models','foreach\x20newproduct','prod_code','$product_details','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','role','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/add_sales','$product_details.production_date','</tr>','prod_cat','errors','$customers_docs','<h5>','edit_sales_view','language','</div>','unit','$product_details.actual_qty','../middleware/auth','requested_qty','edit_sales','$product_details.maxPerUnit','product_list','primary_code','error','name','primary_unit','German','Floor','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$name','user_id','An\x20error\x20occurred.','$product_details.bin','Enclosed','back','$product_details.expiry_date','Arabic','Level','floorlevel','flash','room_name','type','$product_details.type','Arabic\x20(ae)','English','due_amount','purchases_data','1577844ZVBXco','createTransport','product_stock','/view/add_sale/product','$sale_product.bay','Receiving\x20Area','$room','email','$product_details.product_cat','/give_payment/:id','$product_details._id','<div>','customer','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','json','$product_details.storage','$product_details.product_name'];a0_0x37f5=function(){return _0x5dc56a;};return a0_0x37f5();}(function(_0x397228,_0xf0f625){var _0x5bfe37=a0_0x182c,_0x3984a0=_0x397228();while(!![]){try{var _0x27f205=parseInt(_0x5bfe37(0x276))/0x1*(-parseInt(_0x5bfe37(0x21d))/0x2)+-parseInt(_0x5bfe37(0x1c6))/0x3*(-parseInt(_0x5bfe37(0x1d5))/0x4)+parseInt(_0x5bfe37(0x20d))/0x5+parseInt(_0x5bfe37(0x2b1))/0x6+parseInt(_0x5bfe37(0x1f3))/0x7+-parseInt(_0x5bfe37(0x1bf))/0x8+parseInt(_0x5bfe37(0x26e))/0x9*(-parseInt(_0x5bfe37(0x1f0))/0xa);if(_0x27f205===_0xf0f625)break;else _0x3984a0['push'](_0x3984a0['shift']());}catch(_0x334e2d){_0x3984a0['push'](_0x3984a0['shift']());}}}(a0_0x37f5,0x43df5));const express=require('express'),app=express(),router=express[a0_0x4fc6b7(0x279)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4fc6b7(0x27f)),auth=require(a0_0x4fc6b7(0x293)),nodemailer=require(a0_0x4fc6b7(0x244)),users=require(a0_0x4fc6b7(0x246));router[a0_0x4fc6b7(0x1e9)]('/view',auth,async(_0x3a1ac4,_0x9d0d0a)=>{var _0x4b721a=a0_0x4fc6b7;try{const {username:_0x22bb1d,email:_0x1802c7,role:_0x27d40b}=_0x3a1ac4[_0x4b721a(0x1f4)],_0x22f837=_0x3a1ac4[_0x4b721a(0x1f4)],_0x1c27b9=await profile['findOne']({'email':_0x22f837[_0x4b721a(0x1ac)]}),_0x595883=await master_shop[_0x4b721a(0x25b)]();let _0x522329;if(_0x22f837[_0x4b721a(0x285)]==_0x4b721a(0x250)){const _0x2754fd=await staff[_0x4b721a(0x1df)]({'email':_0x22f837['email']});_0x522329=await sales[_0x4b721a(0x268)]([{'$lookup':{'from':_0x4b721a(0x1d4),'localField':'customer','foreignField':_0x4b721a(0x29a),'as':_0x4b721a(0x21c)}},{'$unwind':_0x4b721a(0x28c)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4b721a(0x25f),'invoice':{'$first':_0x4b721a(0x20f)},'customers':{'$first':_0x4b721a(0x1f8)},'date':{'$first':_0x4b721a(0x1be)},'warehouse_name':{'$first':_0x4b721a(0x1bb)},'sale_product':{'$push':_0x4b721a(0x274)},'note':{'$first':_0x4b721a(0x225)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x4b721a(0x28c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4b721a(0x2b5)},'isle':{'$addToSet':_0x4b721a(0x1ed)},'type':{'$addToSet':_0x4b721a(0x208)},'pallet':{'$addToSet':_0x4b721a(0x1cb)},'finalize':{'$first':_0x4b721a(0x273)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x522329=await sales[_0x4b721a(0x268)]([{'$lookup':{'from':_0x4b721a(0x1d4),'localField':_0x4b721a(0x1b1),'foreignField':_0x4b721a(0x29a),'as':_0x4b721a(0x21c)}},{'$unwind':_0x4b721a(0x28c)},{'$unwind':_0x4b721a(0x274)},{'$group':{'_id':_0x4b721a(0x25f),'invoice':{'$first':_0x4b721a(0x20f)},'customers':{'$first':_0x4b721a(0x1f8)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4b721a(0x274)},'note':{'$first':_0x4b721a(0x225)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4b721a(0x2b5)},'isle':{'$addToSet':_0x4b721a(0x1ed)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4b721a(0x1cb)},'finalize':{'$first':_0x4b721a(0x273)},'isAllowEdit':{'$first':_0x4b721a(0x220)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4b721a(0x201)](_0x4b721a(0x1fd),_0x522329);if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x1f6)){var _0x477564=users[_0x4b721a(0x2ae)];console[_0x4b721a(0x201)](_0x477564);}else{if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x1d0))var _0x477564=users[_0x4b721a(0x1d0)];else{if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x29c))var _0x477564=users[_0x4b721a(0x29c)];else{if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x218))var _0x477564=users['Spanish'];else{if(_0x595883[0x0][_0x4b721a(0x28f)]=='French')var _0x477564=users[_0x4b721a(0x21f)];else{if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x25d))var _0x477564=users[_0x4b721a(0x1e3)];else{if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x260))var _0x477564=users[_0x4b721a(0x260)];else{if(_0x595883[0x0][_0x4b721a(0x28f)]==_0x4b721a(0x2ad))var _0x477564=users[_0x4b721a(0x2a6)];}}}}}}}_0x9d0d0a[_0x4b721a(0x205)](_0x4b721a(0x24b),{'success':_0x3a1ac4['flash']('success'),'errors':_0x3a1ac4[_0x4b721a(0x2a9)](_0x4b721a(0x28b)),'sales':_0x522329,'profile':_0x1c27b9,'role':_0x22f837,'master_shop':_0x595883,'language':_0x477564});}catch(_0x11e921){console['log'](_0x11e921);}});async function getRandom8DigitNumber(){var _0x2e6e40=a0_0x4fc6b7;const _0x11b725=0x989680,_0x2c6b2c=0x5f5e0ff,_0x57c365=Math['floor'](Math['random']()*(_0x2c6b2c-_0x11b725+0x1))+_0x11b725;var _0x24dfec;const _0x2aa439=await sales[_0x2e6e40(0x1df)]({'invoice':'OUT-'+_0x57c365});return _0x2aa439&&_0x2aa439[_0x2e6e40(0x22f)]>0x0?_0x24dfec='OUT-'+_0x57c365:_0x24dfec=_0x2e6e40(0x210)+_0x57c365,_0x24dfec;}router[a0_0x4fc6b7(0x1e9)]('/view/add_sales',auth,async(_0x34cae6,_0x5e6bcf)=>{var _0x4ebd7c=a0_0x4fc6b7;try{const {username:_0x583e8d,email:_0x28bc4,role:_0x12675e}=_0x34cae6[_0x4ebd7c(0x1f4)],_0x480818=_0x34cae6[_0x4ebd7c(0x1f4)],_0x3a8c50=await profile[_0x4ebd7c(0x1df)]({'email':_0x480818[_0x4ebd7c(0x1ac)]}),_0xaab774=await master_shop['find'](),_0x576f1c=await customer['find']({});let _0x23228a;if(_0x480818[_0x4ebd7c(0x285)]==_0x4ebd7c(0x250)){const _0x168e06=await staff[_0x4ebd7c(0x1df)]({'email':_0x480818[_0x4ebd7c(0x1ac)]});_0x23228a=await warehouse[_0x4ebd7c(0x268)]([{'$match':{'status':_0x4ebd7c(0x202),'name':_0x168e06[_0x4ebd7c(0x1b9)],'warehouse_category':_0x4ebd7c(0x1c7),'name':{'$ne':_0x4ebd7c(0x21b)}}},{'$group':{'_id':_0x4ebd7c(0x29f),'name':{'$first':_0x4ebd7c(0x29f)}}},{'$sort':{'name':0x1}}]);}else _0x23228a=await warehouse[_0x4ebd7c(0x268)]([{'$match':{'status':_0x4ebd7c(0x202),'warehouse_category':_0x4ebd7c(0x1c7),'name':{'$ne':_0x4ebd7c(0x21b)}}},{'$group':{'_id':_0x4ebd7c(0x29f),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x27c5bd=await product[_0x4ebd7c(0x25b)]({});var _0x3b216a=[_0x4ebd7c(0x1f2),_0x4ebd7c(0x2a3)];const _0xe5dd94=await sales[_0x4ebd7c(0x25b)]({}),_0x46c2b4=_0xe5dd94[_0x4ebd7c(0x22f)]+0x1,_0x359860=_0x4ebd7c(0x210)+_0x46c2b4['toString']()['padStart'](0x5,'0');if(_0xaab774[0x0][_0x4ebd7c(0x28f)]==_0x4ebd7c(0x1f6)){var _0x4407c6=users[_0x4ebd7c(0x2ae)];console[_0x4ebd7c(0x201)](_0x4407c6);}else{if(_0xaab774[0x0]['language']=='Hindi')var _0x4407c6=users[_0x4ebd7c(0x1d0)];else{if(_0xaab774[0x0][_0x4ebd7c(0x28f)]==_0x4ebd7c(0x29c))var _0x4407c6=users[_0x4ebd7c(0x29c)];else{if(_0xaab774[0x0][_0x4ebd7c(0x28f)]=='Spanish')var _0x4407c6=users[_0x4ebd7c(0x218)];else{if(_0xaab774[0x0]['language']==_0x4ebd7c(0x21f))var _0x4407c6=users[_0x4ebd7c(0x21f)];else{if(_0xaab774[0x0][_0x4ebd7c(0x28f)]==_0x4ebd7c(0x25d))var _0x4407c6=users[_0x4ebd7c(0x1e3)];else{if(_0xaab774[0x0][_0x4ebd7c(0x28f)]=='Chinese')var _0x4407c6=users['Chinese'];else{if(_0xaab774[0x0][_0x4ebd7c(0x28f)]==_0x4ebd7c(0x2ad))var _0x4407c6=users[_0x4ebd7c(0x2a6)];}}}}}}}const _0x2e6bf4=getRandom8DigitNumber();_0x2e6bf4[_0x4ebd7c(0x22e)](_0x247bd7=>{var _0x4a377c=_0x4ebd7c;_0x5e6bcf[_0x4a377c(0x205)]('add_sales',{'success':_0x34cae6[_0x4a377c(0x2a9)]('success'),'errors':_0x34cae6['flash']('errors'),'role':_0x480818,'profile':_0x3a8c50,'customer':_0x576f1c,'warehouse':_0x23228a,'product':_0x27c5bd,'invoice':_0x247bd7,'master_shop':_0xaab774,'language':_0x4407c6,'rooms_data':_0x3b216a});})[_0x4ebd7c(0x27b)](_0xee3571=>{var _0x48220b=_0x4ebd7c;_0x34cae6[_0x48220b(0x2a9)](_0x48220b(0x28b),_0x48220b(0x263)),_0x5e6bcf[_0x48220b(0x27e)](_0x48220b(0x1c9));});}catch(_0x1b3431){console['log'](_0x1b3431);}}),router[a0_0x4fc6b7(0x1e9)]('/view/add_sales/:id',auth,async(_0x57a89e,_0x3f95e9)=>{var _0x427fff=a0_0x4fc6b7;try{const _0x26e8e5=_0x57a89e[_0x427fff(0x1fe)]['id'];console[_0x427fff(0x201)](_0x26e8e5);const _0x3a836e=await product[_0x427fff(0x25b)](),_0x5279ab=await purchases[_0x427fff(0x268)]([{'$match':{'warehouse_name':_0x26e8e5}},{'$unwind':_0x427fff(0x1f1)},{'$group':{'_id':_0x427fff(0x232)}}]);console[_0x427fff(0x201)](_0x427fff(0x2b0),_0x5279ab),_0x3f95e9['status'](0xc8)[_0x427fff(0x1b3)]({'purchases_data':_0x5279ab,'product_data':_0x3a836e});}catch(_0x2c654f){console[_0x427fff(0x201)](_0x2c654f);}}),router[a0_0x4fc6b7(0x22d)](a0_0x4fc6b7(0x2b4),auth,async(_0x656164,_0x4ef6c8)=>{var _0x55485b=a0_0x4fc6b7;try{const {warehouse_data:_0x3a717a,product_data:_0x211bd8}=_0x656164[_0x55485b(0x1e6)];console[_0x55485b(0x201)](_0x656164[_0x55485b(0x1e6)][_0x55485b(0x1e1)]);;const _0x5986d4=await master_shop['find']();console[_0x55485b(0x201)](_0x55485b(0x1f5),_0x5986d4);const _0x10c03b=await product[_0x55485b(0x1df)]({'name':_0x211bd8});console[_0x55485b(0x201)](_0x55485b(0x219),_0x10c03b);const _0x39c008=await warehouse[_0x55485b(0x268)]([{'$match':{'name':_0x3a717a}},{'$unwind':_0x55485b(0x282)},{'$match':{'product_details.product_name':_0x211bd8}},{'$group':{'_id':_0x55485b(0x1b5),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x55485b(0x201)](_0x55485b(0x21e),_0x39c008),_0x4ef6c8['status'](0xc8)[_0x55485b(0x1b3)]({'master':_0x5986d4,'new_product':_0x10c03b,'stock_data':_0x39c008});}catch(_0x274f01){console['log'](_0x274f01);}}),router[a0_0x4fc6b7(0x22d)](a0_0x4fc6b7(0x287),auth,async(_0x3bbba4,_0x562408)=>{var _0x4fdc24=a0_0x4fc6b7;try{const {invoice:_0x3d08b5,date:_0xf0dcb4,warehouse_name:_0x9f9252,product_name:_0x313cea,stock:_0x2efb45,quantity:_0xfaa346,note:_0x304173,room:_0x3e63ba,primary_code:_0x1dedca,secondary_code:_0x21dd50,prod_code:_0x125059,level:_0x8e91d9,isle:_0x533092,pallet:_0x71c311,batch_code:_0x3ee968,SCRN:_0x4c1d89,expiry_date:_0x505530}=_0x3bbba4[_0x4fdc24(0x1e6)];if(typeof _0x313cea==_0x4fdc24(0x209))var _0x566bd9=[_0x3bbba4[_0x4fdc24(0x1e6)]['product_name']],_0x16e5ba=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x216)]],_0x5a971d=[_0x3bbba4['body'][_0x4fdc24(0x283)]],_0x5c5943=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x298)]],_0x5c1b17=[_0x3bbba4['body'][_0x4fdc24(0x1bd)]],_0x37b5a6=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x281)]],_0xd6975d=[_0x3bbba4[_0x4fdc24(0x1e6)]['level']],_0x444182=[_0x3bbba4[_0x4fdc24(0x1e6)]['primary_unit']],_0x4b1c49=[_0x3bbba4[_0x4fdc24(0x1e6)]['secondary_unit']],_0x487e59=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x1da)]],_0x371cbb=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x253)]],_0x144fda=[_0x3bbba4[_0x4fdc24(0x1e6)]['max_per_unit']],_0x2d5e0c=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x221)]],_0x21c05d=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x294)]],_0x5b3f1e=[_0x3bbba4['body'][_0x4fdc24(0x1f9)]],_0x26742a=[_0x3bbba4['body'][_0x4fdc24(0x212)]],_0x22c35e=[_0x3bbba4['body']['prod_cat']],_0x48a7ad=[_0x3bbba4['body'][_0x4fdc24(0x213)]],_0x4e5e75=[_0x3bbba4[_0x4fdc24(0x1e6)]['RoomAssigned']],_0x286115=[_0x3bbba4[_0x4fdc24(0x1e6)]['prod_invoice']],_0x3e2563=[_0x3bbba4[_0x4fdc24(0x1e6)]['actual_qty']],_0x3cb140=[_0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x1b7)]],_0x5eedc2=[_0x3bbba4['body'][_0x4fdc24(0x207)]];else var _0x566bd9=[..._0x3bbba4['body']['product_name']],_0x16e5ba=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x216)]],_0x5a971d=[..._0x3bbba4[_0x4fdc24(0x1e6)]['carton']],_0x5c5943=[..._0x3bbba4[_0x4fdc24(0x1e6)]['primary_code']],_0x5c1b17=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x1bd)]],_0x37b5a6=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x281)]],_0xd6975d=[..._0x3bbba4['body']['level']],_0x444182=[..._0x3bbba4['body']['primary_unit']],_0x4b1c49=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x23e)]],_0x487e59=[..._0x3bbba4['body'][_0x4fdc24(0x1da)]],_0x371cbb=[..._0x3bbba4['body']['expiry_date']],_0x144fda=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x1e0)]],_0x2d5e0c=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x221)]],_0x21c05d=[..._0x3bbba4[_0x4fdc24(0x1e6)]['requested_qty']],_0x5b3f1e=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x1f9)]],_0x26742a=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x212)]],_0x22c35e=[..._0x3bbba4['body'][_0x4fdc24(0x28a)]],_0x48a7ad=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x213)]],_0x4e5e75=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x228)]],_0x286115=[..._0x3bbba4['body'][_0x4fdc24(0x257)]],_0x3e2563=[..._0x3bbba4[_0x4fdc24(0x1e6)][_0x4fdc24(0x20e)]],_0x3cb140=[..._0x3bbba4['body'][_0x4fdc24(0x1b7)]],_0x5eedc2=[..._0x3bbba4['body'][_0x4fdc24(0x207)]];const _0x4cc184=_0x566bd9[_0x4fdc24(0x251)](_0x4b5fbf=>{return _0x4b5fbf={'product_name':_0x4b5fbf};});_0x16e5ba[_0x4fdc24(0x1d1)]((_0x17b870,_0x559ae2)=>{var _0x7f5546=_0x4fdc24;_0x4cc184[_0x559ae2][_0x7f5546(0x216)]=Math[_0x7f5546(0x214)](_0x17b870);}),_0x3e2563[_0x4fdc24(0x1d1)]((_0x2f84d9,_0x47fd5e)=>{var _0x73079c=_0x4fdc24;_0x4cc184[_0x47fd5e][_0x73079c(0x20e)]=Math['abs'](_0x2f84d9);}),_0x3cb140[_0x4fdc24(0x1d1)]((_0x4d8931,_0x5a9854)=>{var _0x645763=_0x4fdc24;_0x4cc184[_0x5a9854][_0x645763(0x1b7)]=_0x4d8931;}),_0x5eedc2[_0x4fdc24(0x1d1)]((_0x52ee02,_0x4140b0)=>{var _0x1500d0=_0x4fdc24;_0x4cc184[_0x4140b0][_0x1500d0(0x266)]=_0x52ee02;}),_0x5a971d[_0x4fdc24(0x1d1)]((_0x2d2829,_0x5207d2)=>{var _0x5d4540=_0x4fdc24;_0x4cc184[_0x5207d2][_0x5d4540(0x213)]=_0x2d2829;}),_0x5c5943[_0x4fdc24(0x1d1)]((_0x1631ac,_0x1b954d)=>{var _0x575ce3=_0x4fdc24;_0x4cc184[_0x1b954d][_0x575ce3(0x298)]=_0x1631ac;}),_0x5c1b17[_0x4fdc24(0x1d1)]((_0x537558,_0x519422)=>{var _0x5ecbd6=_0x4fdc24;_0x4cc184[_0x519422][_0x5ecbd6(0x1bd)]=_0x537558;}),_0x37b5a6[_0x4fdc24(0x1d1)]((_0x251ce7,_0x5f40d9)=>{var _0xdbd807=_0x4fdc24;_0x4cc184[_0x5f40d9][_0xdbd807(0x22c)]=_0x251ce7;}),_0xd6975d[_0x4fdc24(0x1d1)]((_0x3f6385,_0x495873)=>{var _0x1a4f94=_0x4fdc24;_0x4e5e75[_0x1a4f94(0x1d1)]((_0x246ced,_0x3e5e70)=>{var _0x4f6ba0=_0x1a4f94;if(_0x246ced==_0x4f6ba0(0x1aa)&&_0x495873==_0x3e5e70){var _0x11ac65=_0x3f6385['slice'](0x3);_0x4cc184[_0x495873][_0x4f6ba0(0x1ea)]=_0x3f6385[0x0],_0x4cc184[_0x495873][_0x4f6ba0(0x247)]=_0x3f6385[0x1],_0x4cc184[_0x495873][_0x4f6ba0(0x215)]=0x0,_0x4cc184[_0x495873][_0x4f6ba0(0x229)]=0x0,_0x4cc184[_0x495873][_0x4f6ba0(0x2ab)]=_0x4f6ba0(0x29d),_0x4cc184[_0x495873][_0x4f6ba0(0x2a8)]=_0x11ac65;}else{if(_0x246ced==_0x4f6ba0(0x248)&&_0x495873==_0x3e5e70){var _0x11ac65=_0x3f6385[_0x4f6ba0(0x1e5)](0x3);_0x4cc184[_0x495873][_0x4f6ba0(0x1ea)]=_0x3f6385[0x0],_0x4cc184[_0x495873]['rack']=_0x3f6385[0x1],_0x4cc184[_0x495873][_0x4f6ba0(0x215)]=0x0,_0x4cc184[_0x495873][_0x4f6ba0(0x229)]=0x0,_0x4cc184[_0x495873][_0x4f6ba0(0x2ab)]=_0x4f6ba0(0x29d),_0x4cc184[_0x495873]['floorlevel']=_0x3f6385[0x5];}else{if(_0x495873==_0x3e5e70){var _0x43d3b7;if(_0x3f6385[0x4]=='L')_0x43d3b7='Level';else _0x3f6385[0x4]=='F'&&(_0x43d3b7=_0x4f6ba0(0x29d));_0x4cc184[_0x495873][_0x4f6ba0(0x1ea)]=_0x3f6385[0x0],_0x4cc184[_0x495873][_0x4f6ba0(0x247)]=_0x3f6385[0x1],_0x4cc184[_0x495873][_0x4f6ba0(0x215)]=_0x3f6385[0x2],_0x4cc184[_0x495873]['bin']=_0x3f6385[0x3],_0x4cc184[_0x495873][_0x4f6ba0(0x2ab)]=_0x43d3b7,_0x4cc184[_0x495873][_0x4f6ba0(0x2a8)]=_0x3f6385[0x5];}}}});}),_0x444182['forEach']((_0x24143a,_0x5226ee)=>{var _0x21b942=_0x4fdc24;_0x4cc184[_0x5226ee][_0x21b942(0x291)]=_0x24143a;}),_0x4b1c49[_0x4fdc24(0x1d1)]((_0xdcac,_0x1b86dd)=>{var _0x509762=_0x4fdc24;_0x4cc184[_0x1b86dd][_0x509762(0x23e)]=_0xdcac;}),_0x487e59[_0x4fdc24(0x1d1)]((_0x40a69d,_0x422245)=>{_0x4cc184[_0x422245]['batch_code']=_0x40a69d;}),_0x371cbb[_0x4fdc24(0x1d1)]((_0x5a3853,_0x34eb8b)=>{var _0x2eeb7e=_0x4fdc24;_0x4cc184[_0x34eb8b][_0x2eeb7e(0x253)]=_0x5a3853;}),_0x144fda['forEach']((_0x2c8d91,_0x484c0d)=>{_0x4cc184[_0x484c0d]['maxperunit']=_0x2c8d91;}),_0x2d5e0c[_0x4fdc24(0x1d1)]((_0x12635f,_0x4d74e9)=>{var _0x1c9b53=_0x4fdc24;_0x4cc184[_0x4d74e9][_0x1c9b53(0x221)]=_0x12635f;}),_0x21c05d[_0x4fdc24(0x1d1)]((_0x53936c,_0x566166)=>{var _0x3e9240=_0x4fdc24;_0x4cc184[_0x566166][_0x3e9240(0x294)]=_0x53936c;}),_0x5b3f1e[_0x4fdc24(0x1d1)]((_0x15641e,_0x2465aa)=>{_0x4cc184[_0x2465aa]['delivery_date']=_0x15641e;}),_0x26742a['forEach']((_0x1d2f03,_0x36d7ad)=>{var _0x173d8e=_0x4fdc24;_0x4cc184[_0x36d7ad][_0x173d8e(0x212)]=_0x1d2f03;}),_0x22c35e[_0x4fdc24(0x1d1)]((_0xf68585,_0x4f6b8d)=>{var _0x4f54d9=_0x4fdc24;_0x4cc184[_0x4f6b8d][_0x4f54d9(0x28a)]=_0xf68585;}),_0x48a7ad[_0x4fdc24(0x1d1)]((_0x22f6a5,_0x26eef2)=>{var _0x15d105=_0x4fdc24;_0x4cc184[_0x26eef2][_0x15d105(0x1d3)]=_0x22f6a5;}),_0x4e5e75[_0x4fdc24(0x1d1)]((_0x451be3,_0x158383)=>{var _0x401ed8=_0x4fdc24;_0x4cc184[_0x158383][_0x401ed8(0x2aa)]=_0x451be3;}),_0x286115[_0x4fdc24(0x1d1)]((_0x139317,_0xaf9ec2)=>{var _0xd35071=_0x4fdc24;_0x4cc184[_0xaf9ec2][_0xd35071(0x1db)]=_0x139317;});var _0xba6cf1=0x0;_0x4cc184[_0x4fdc24(0x1d1)](_0x1435bd=>{var _0x4fd5be=_0x4fdc24;(_0x1435bd['stock']<_0x1435bd[_0x4fd5be(0x1d3)]||_0x1435bd[_0x4fd5be(0x1d3)]==0x0)&&(console[_0x4fd5be(0x201)](_0x4fd5be(0x280),_0x1435bd),_0xba6cf1++);});const _0x23398f=_0x4cc184['filter'](_0x52802e=>_0x52802e[_0x4fdc24(0x213)]!=='0'&&_0x52802e[_0x4fdc24(0x213)]!==''),_0x5b51ff=new sales({'invoice':_0x3d08b5,'customer':_0x3bbba4[_0x4fdc24(0x1e6)]['customer'],'date':_0xf0dcb4,'warehouse_name':_0x9f9252,'sale_product':_0x23398f,'note':_0x304173,'room':_0x3e63ba,'primary_code':_0x1dedca,'secondary_code':_0x21dd50,'prod_code':_0x125059,'SCRN':_0x4c1d89}),_0x332f4b=await _0x5b51ff['save']();_0x3bbba4[_0x4fdc24(0x2a9)](_0x4fdc24(0x1c1),'Sales\x20Add\x20successfully'),_0x562408['redirect']('/all_sales/preview/'+_0x332f4b[_0x4fdc24(0x224)]);}catch(_0x413a2c){console[_0x4fdc24(0x201)](_0x413a2c);}}),router[a0_0x4fc6b7(0x1e9)](a0_0x4fc6b7(0x211),auth,async(_0x348402,_0xa0fdea)=>{var _0x4c301b=a0_0x4fc6b7;try{const {username:_0x1e00f6,email:_0x4a6050,role:_0x493357}=_0x348402['user'],_0x28629a=_0x348402[_0x4c301b(0x1f4)],_0x1e681f=await profile['findOne']({'email':_0x28629a[_0x4c301b(0x1ac)]}),_0x45b2e1=await master_shop['find'](),_0xb81017=_0x348402[_0x4c301b(0x1fe)]['id'],_0x20cd20=await sales[_0x4c301b(0x1d8)](_0xb81017),_0x5dfc5c=await warehouse[_0x4c301b(0x268)]([{'$match':{'name':_0x20cd20['warehouse_name']}},{'$unwind':_0x4c301b(0x282)},{'$group':{'_id':_0x4c301b(0x1af),'name':{'$first':_0x4c301b(0x1b5)},'product_stock':{'$first':_0x4c301b(0x1c0)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4c301b(0x2ac)},'floorlevel':{'$first':_0x4c301b(0x203)},'primary_code':{'$first':_0x4c301b(0x1d9)},'secondary_code':{'$first':_0x4c301b(0x24f)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4c301b(0x1b4)},'rack':{'$first':_0x4c301b(0x1ee)},'expiry_date':{'$first':_0x4c301b(0x2a5)},'production_date':{'$first':_0x4c301b(0x288)},'invoice':{'$first':_0x4c301b(0x233)}}}]),_0x2c5c7f=await customer[_0x4c301b(0x25b)]({});let _0x1fe32b;if(_0x28629a['role']=='staff'){const _0x6402af=await staff[_0x4c301b(0x1df)]({'email':_0x28629a[_0x4c301b(0x1ac)]});_0x1fe32b=await warehouse[_0x4c301b(0x268)]([{'$match':{'status':_0x4c301b(0x202),'name':_0x6402af[_0x4c301b(0x1b9)]}},{'$group':{'_id':_0x4c301b(0x29f),'name':{'$first':_0x4c301b(0x29f)}}}]);}else _0x1fe32b=await warehouse[_0x4c301b(0x268)]([{'$match':{'status':_0x4c301b(0x202)}},{'$group':{'_id':_0x4c301b(0x29f),'name':{'$first':'$name'}}}]);const _0x1b05b3=await product['find']({}),_0x38b848=await suppliers['find']({});if(_0x45b2e1[0x0][_0x4c301b(0x28f)]==_0x4c301b(0x1f6)){var _0x42ce8d=users[_0x4c301b(0x2ae)];console[_0x4c301b(0x201)](_0x42ce8d);}else{if(_0x45b2e1[0x0][_0x4c301b(0x28f)]=='Hindi')var _0x42ce8d=users['Hindi'];else{if(_0x45b2e1[0x0][_0x4c301b(0x28f)]==_0x4c301b(0x29c))var _0x42ce8d=users[_0x4c301b(0x29c)];else{if(_0x45b2e1[0x0][_0x4c301b(0x28f)]==_0x4c301b(0x218))var _0x42ce8d=users[_0x4c301b(0x218)];else{if(_0x45b2e1[0x0][_0x4c301b(0x28f)]==_0x4c301b(0x21f))var _0x42ce8d=users[_0x4c301b(0x21f)];else{if(_0x45b2e1[0x0][_0x4c301b(0x28f)]==_0x4c301b(0x25d))var _0x42ce8d=users[_0x4c301b(0x1e3)];else{if(_0x45b2e1[0x0]['language']=='Chinese')var _0x42ce8d=users['Chinese'];else{if(_0x45b2e1[0x0]['language']==_0x4c301b(0x2ad))var _0x42ce8d=users[_0x4c301b(0x2a6)];}}}}}}}_0xa0fdea[_0x4c301b(0x205)](_0x4c301b(0x28e),{'success':_0x348402['flash'](_0x4c301b(0x1c1)),'errors':_0x348402[_0x4c301b(0x2a9)](_0x4c301b(0x28b)),'role':_0x28629a,'profile':_0x1e681f,'customer':_0x2c5c7f,'warehouse':_0x1fe32b,'product':_0x5dfc5c,'user':_0x20cd20,'master_shop':_0x45b2e1,'unit':_0x1b05b3,'language':_0x42ce8d,'suppliers':_0x38b848});}catch(_0x523f24){console[_0x4c301b(0x201)](_0x523f24);}}),router[a0_0x4fc6b7(0x22d)](a0_0x4fc6b7(0x211),auth,async(_0x217dde,_0x5b9a3f)=>{var _0x4a77f7=a0_0x4fc6b7;try{const _0x59ef18=_0x217dde[_0x4a77f7(0x1fe)]['id'],{invoice:_0x7a0d40,warehouse_name:_0x20850a,room:_0x59379f}=_0x217dde['body'],_0x1c6bc6=await sales[_0x4a77f7(0x1df)]({'invoice':_0x7a0d40}),_0x56cb95=_0x1c6bc6['sale_product']['map'](async _0x5ba7e9=>{var _0x265ee4=_0x4a77f7,_0x4ce0fc=await warehouse[_0x265ee4(0x1df)]({'name':_0x20850a,'room':_0x5ba7e9[_0x265ee4(0x2aa)],'warehouse_category':_0x265ee4(0x1c7)});const _0x3f00ca=_0x4ce0fc['product_details']['map'](_0x3f8677=>{var _0xbcbd4c=_0x265ee4;_0x3f8677[_0xbcbd4c(0x1c2)]==_0x5ba7e9['product_name']&&_0x3f8677[_0xbcbd4c(0x2a8)]==_0x5ba7e9['floorlevel']&&_0x3f8677[_0xbcbd4c(0x2ab)]==_0x5ba7e9[_0xbcbd4c(0x2ab)]&&_0x3f8677[_0xbcbd4c(0x229)]==_0x5ba7e9[_0xbcbd4c(0x229)]&&_0x3f8677[_0xbcbd4c(0x215)]==_0x5ba7e9[_0xbcbd4c(0x215)]&&_0x3f8677[_0xbcbd4c(0x247)]==_0x5ba7e9[_0xbcbd4c(0x247)]&&_0x3f8677['storage']==_0x5ba7e9[_0xbcbd4c(0x1ea)]&&_0x3f8677[_0xbcbd4c(0x253)]==_0x5ba7e9[_0xbcbd4c(0x253)]&&_0x3f8677[_0xbcbd4c(0x1da)]==_0x5ba7e9[_0xbcbd4c(0x1da)]&&_0x3f8677[_0xbcbd4c(0x1db)]==_0x5ba7e9['invoice']&&_0x3f8677['_id']==_0x5ba7e9['id_transaction_from']&&(_0x3f8677['product_stock']=Math[_0xbcbd4c(0x1dd)](0x0,Math[_0xbcbd4c(0x214)](_0x3f8677[_0xbcbd4c(0x2b3)])-Math[_0xbcbd4c(0x214)](_0x5ba7e9[_0xbcbd4c(0x213)])));});return _0x4ce0fc;});Promise['all'](_0x56cb95)[_0x4a77f7(0x22e)](async _0x2727c8=>{var _0x26e8d9=_0x4a77f7;try{for(const _0x14ed8b of _0x2727c8){await _0x14ed8b[_0x26e8d9(0x23a)]();}_0x1c6bc6[_0x26e8d9(0x1d7)]=_0x26e8d9(0x265);const _0x37d6a4=await _0x1c6bc6[_0x26e8d9(0x23a)](),_0x18298f=await master_shop[_0x26e8d9(0x25b)](),_0x3b8c0e=await email_settings[_0x26e8d9(0x1df)](),_0x1100ea=await supervisor_settings[_0x26e8d9(0x25b)]();var _0x425754=_0x1c6bc6[_0x26e8d9(0x235)],_0x40616a='',_0x3ba8ab;for(_0x3ba8ab in _0x425754){_0x40616a+=_0x26e8d9(0x269)+_0x26e8d9(0x286)+_0x425754[_0x3ba8ab][_0x26e8d9(0x1c2)]+_0x26e8d9(0x259)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x425754[_0x3ba8ab][_0x26e8d9(0x22c)]+_0x26e8d9(0x259)+_0x26e8d9(0x286)+_0x425754[_0x3ba8ab][_0x26e8d9(0x213)]+_0x26e8d9(0x259)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x425754[_0x3ba8ab][_0x26e8d9(0x291)]+'</td>'+_0x26e8d9(0x286)+_0x425754[_0x3ba8ab][_0x26e8d9(0x23e)]+_0x26e8d9(0x259)+_0x26e8d9(0x286)+_0x1c6bc6[_0x26e8d9(0x239)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x425754[_0x3ba8ab][_0x26e8d9(0x2aa)]+_0x26e8d9(0x259)+_0x26e8d9(0x286)+_0x425754[_0x3ba8ab][_0x26e8d9(0x1ea)]+_0x425754[_0x3ba8ab][_0x26e8d9(0x247)]+_0x425754[_0x3ba8ab][_0x26e8d9(0x215)]+_0x425754[_0x3ba8ab]['bin']+_0x425754[_0x3ba8ab][_0x26e8d9(0x2ab)][0x0]+_0x425754[_0x3ba8ab][_0x26e8d9(0x2a8)]+_0x26e8d9(0x259),_0x26e8d9(0x289);}let _0x60164=nodemailer[_0x26e8d9(0x2b2)]({'host':_0x3b8c0e[_0x26e8d9(0x242)],'port':Number(_0x3b8c0e[_0x26e8d9(0x1cc)]),'secure':![],'auth':{'user':_0x3b8c0e['email'],'pass':_0x3b8c0e[_0x26e8d9(0x1fa)]}}),_0x492167={'from':_0x3b8c0e[_0x26e8d9(0x1ac)],'to':_0x1100ea[0x0]['RMSEmail'],'subject':'Sales\x20Mail','attachments':[{'filename':_0x26e8d9(0x264),'path':__dirname+'/../public'+_0x26e8d9(0x1ec)+_0x18298f[0x0]['image'],'cid':'logo'}],'html':_0x26e8d9(0x223)+_0x26e8d9(0x1cf)+_0x26e8d9(0x23d)+'<div>'+_0x26e8d9(0x29e)+_0x26e8d9(0x1b0)+_0x26e8d9(0x238)+_0x26e8d9(0x290)+_0x26e8d9(0x1b0)+_0x26e8d9(0x256)+_0x18298f[0x0][_0x26e8d9(0x22a)]+_0x26e8d9(0x255)+_0x26e8d9(0x290)+_0x26e8d9(0x290)+_0x26e8d9(0x1ca)+'<div>'+_0x26e8d9(0x20b)+_0x26e8d9(0x1cd)+_0x1c6bc6[_0x26e8d9(0x1db)]+'\x20'+_0x26e8d9(0x24d)+'\x20Order\x20Date\x20:\x20'+_0x1c6bc6[_0x26e8d9(0x22b)]+'\x20'+_0x26e8d9(0x1ce)+_0x26e8d9(0x249)+_0x26e8d9(0x290)+_0x26e8d9(0x25e)+_0x26e8d9(0x1b2)+_0x26e8d9(0x269)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x26e8d9(0x241)+_0x26e8d9(0x262)+_0x26e8d9(0x217)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x26e8d9(0x284)+_0x26e8d9(0x1e8)+_0x26e8d9(0x289)+'</thead>'+_0x26e8d9(0x23c)+'\x20'+_0x40616a+'\x20'+'</tbody>'+_0x26e8d9(0x278)+_0x26e8d9(0x1b0)+_0x26e8d9(0x243)+_0x26e8d9(0x28d)+_0x18298f[0x0][_0x26e8d9(0x22a)]+_0x26e8d9(0x249)+_0x26e8d9(0x290)+_0x26e8d9(0x290)+_0x26e8d9(0x20a)};_0x60164[_0x26e8d9(0x204)](_0x492167,function(_0x24f9b1,_0x226f49){var _0x4538ae=_0x26e8d9;_0x24f9b1?(console[_0x4538ae(0x201)](_0x24f9b1),console[_0x4538ae(0x201)]('Error\x20Occurs')):console[_0x4538ae(0x201)](_0x4538ae(0x26f));}),_0x217dde['flash'](_0x26e8d9(0x1c1),_0x26e8d9(0x1bc)),_0x5b9a3f[_0x26e8d9(0x27e)](_0x26e8d9(0x1ef)+_0x59ef18);}catch(_0xf88ec3){console[_0x26e8d9(0x299)](_0xf88ec3),_0x5b9a3f[_0x26e8d9(0x236)](0x1f4)[_0x26e8d9(0x1b3)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4a77f7(0x27b)](_0x1d3eeb=>{var _0x361071=_0x4a77f7;console[_0x361071(0x299)](_0x1d3eeb),_0x5b9a3f[_0x361071(0x236)](0x1f4)[_0x361071(0x1b3)]({'error':_0x361071(0x2a1)});});}catch(_0x36ddb2){console[_0x4a77f7(0x201)](_0x36ddb2);}}),router[a0_0x4fc6b7(0x1e9)](a0_0x4fc6b7(0x20c),auth,async(_0x33d786,_0x38036b)=>{var _0x211e07=a0_0x4fc6b7;try{const {username:_0x16955f,email:_0x2728b2,role:_0x556ae1}=_0x33d786[_0x211e07(0x1f4)],_0x492415=_0x33d786[_0x211e07(0x1f4)],_0xbdb7f6=await profile[_0x211e07(0x1df)]({'email':_0x492415['email']}),_0x3c20a3=await master_shop[_0x211e07(0x25b)](),_0x25acb3=_0x33d786[_0x211e07(0x1fe)]['id'],_0x131e5b=await sales[_0x211e07(0x1d8)](_0x25acb3);var _0x44b000=[_0x211e07(0x1f2),_0x211e07(0x2a3)];const _0x35dc7e=await warehouse['aggregate']([{'$match':{'name':_0x131e5b[_0x211e07(0x239)],'warehouse_category':_0x211e07(0x1c7)}},{'$unwind':_0x211e07(0x282)},{'$group':{'_id':_0x211e07(0x1af),'name':{'$first':_0x211e07(0x1b5)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x211e07(0x2a2)},'type':{'$first':_0x211e07(0x2ac)},'floorlevel':{'$first':_0x211e07(0x203)},'primary_code':{'$first':_0x211e07(0x1d9)},'secondary_code':{'$first':_0x211e07(0x24f)},'product_code':{'$first':_0x211e07(0x24e)},'storage':{'$first':_0x211e07(0x1b4)},'rack':{'$first':'$product_details.rack'}}}]),_0x51b76e=await customer[_0x211e07(0x25b)]({});let _0x573ecc;if(_0x492415['role']=='staff'){const _0x311cde=await staff[_0x211e07(0x1df)]({'email':_0x492415[_0x211e07(0x1ac)]});_0x573ecc=await warehouse[_0x211e07(0x268)]([{'$match':{'status':'Enabled','name':_0x311cde['warehouse'],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x211e07(0x29f),'name':{'$first':_0x211e07(0x29f)}}}]);}else _0x573ecc=await warehouse[_0x211e07(0x268)]([{'$match':{'status':_0x211e07(0x202),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x211e07(0x29f),'name':{'$first':_0x211e07(0x29f)}}}]);const _0x9f6146=await product['find']({});if(_0x3c20a3[0x0]['language']==_0x211e07(0x1f6)){var _0x307dd8=users[_0x211e07(0x2ae)];console['log'](_0x307dd8);}else{if(_0x3c20a3[0x0]['language']==_0x211e07(0x1d0))var _0x307dd8=users[_0x211e07(0x1d0)];else{if(_0x3c20a3[0x0]['language']==_0x211e07(0x29c))var _0x307dd8=users[_0x211e07(0x29c)];else{if(_0x3c20a3[0x0]['language']==_0x211e07(0x218))var _0x307dd8=users[_0x211e07(0x218)];else{if(_0x3c20a3[0x0][_0x211e07(0x28f)]==_0x211e07(0x21f))var _0x307dd8=users['French'];else{if(_0x3c20a3[0x0][_0x211e07(0x28f)]=='Portuguese\x20(BR)')var _0x307dd8=users['Portuguese'];else{if(_0x3c20a3[0x0][_0x211e07(0x28f)]==_0x211e07(0x260))var _0x307dd8=users[_0x211e07(0x260)];else{if(_0x3c20a3[0x0][_0x211e07(0x28f)]==_0x211e07(0x2ad))var _0x307dd8=users[_0x211e07(0x2a6)];}}}}}}}_0x38036b[_0x211e07(0x205)](_0x211e07(0x295),{'success':_0x33d786['flash'](_0x211e07(0x1c1)),'errors':_0x33d786[_0x211e07(0x2a9)]('errors'),'role':_0x492415,'profile':_0xbdb7f6,'customer':_0x51b76e,'warehouse':_0x573ecc,'product':_0x35dc7e,'user':_0x131e5b,'master_shop':_0x3c20a3,'unit':_0x9f6146,'language':_0x307dd8});}catch(_0x598a0f){console[_0x211e07(0x201)](_0x598a0f);}}),router[a0_0x4fc6b7(0x22d)]('/view/:id',auth,async(_0x185077,_0x245835)=>{var _0x46eea7=a0_0x4fc6b7;try{const _0x11bce7=_0x185077[_0x46eea7(0x1fe)]['id'],_0x1c6c93=await sales['findOne']({'_id':_0x185077[_0x46eea7(0x1fe)]['id']}),_0x19964d=await warehouse[_0x46eea7(0x1df)]({'name':_0x1c6c93[_0x46eea7(0x239)],'room':_0x185077['body'][_0x46eea7(0x1ff)]}),{invoice:_0x57be12,date:_0x42399b,warehouse_name:_0x148378,product_name:_0x331770,stock:_0x388eeb,quantity:_0x2624c6,note:_0x1efe42,room:_0x3347b3,customer:_0x1d8bbb,SCRN:_0x34f865}=_0x185077[_0x46eea7(0x1e6)];if(typeof _0x331770==_0x46eea7(0x209))var _0x1991ce=[_0x185077[_0x46eea7(0x1e6)]['product_name']],_0x502e59=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x216)]],_0x8fbe8=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x283)]],_0x5f1e6e=[_0x185077[_0x46eea7(0x1e6)]['primary_code']],_0x41356e=[_0x185077['body'][_0x46eea7(0x1bd)]],_0x1b2350=[_0x185077[_0x46eea7(0x1e6)]['prod_code']],_0x193ed8=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x23f)]],_0x1091d3=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x29b)]],_0xf48546=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x23e)]],_0x527b89=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x1da)]],_0x467f03=[_0x185077['body'][_0x46eea7(0x253)]],_0x5ed51d=[_0x185077['body']['max_per_unit']],_0x44e177=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x221)]],_0x35b16c=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x294)]],_0x153574=[_0x185077[_0x46eea7(0x1e6)]['delivery_date']],_0xa2536f=[_0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x212)]],_0x41690e=[_0x185077[_0x46eea7(0x1e6)]['prod_cat']],_0x360d51=[_0x185077[_0x46eea7(0x1e6)]['quantity']],_0x35ab33=[_0x185077[_0x46eea7(0x1e6)]['RoomAssigned']];else var _0x1991ce=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x1c2)]],_0x502e59=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x216)]],_0x8fbe8=[..._0x185077['body'][_0x46eea7(0x283)]],_0x5f1e6e=[..._0x185077['body']['primary_code']],_0x41356e=[..._0x185077['body']['secondary_code']],_0x1b2350=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x281)]],_0x193ed8=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x23f)]],_0x1091d3=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x29b)]],_0xf48546=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x23e)]],_0x527b89=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x1da)]],_0x467f03=[..._0x185077[_0x46eea7(0x1e6)]['expiry_date']],_0x5ed51d=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x1e0)]],_0x44e177=[..._0x185077[_0x46eea7(0x1e6)]['production_date']],_0x35b16c=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x294)]],_0x153574=[..._0x185077[_0x46eea7(0x1e6)]['delivery_date']],_0xa2536f=[..._0x185077[_0x46eea7(0x1e6)][_0x46eea7(0x212)]],_0x41690e=[..._0x185077['body'][_0x46eea7(0x28a)]],_0x360d51=[..._0x185077['body']['quantity']],_0x35ab33=[..._0x185077[_0x46eea7(0x1e6)]['RoomAssigned']];const _0x4a5612=_0x1991ce[_0x46eea7(0x251)](_0x4bb0e8=>{return _0x4bb0e8={'product_name':_0x4bb0e8};});_0x502e59[_0x46eea7(0x1d1)]((_0x3a8d11,_0x599b2b)=>{var _0x43fab6=_0x46eea7;_0x4a5612[_0x599b2b]['stock']=Math[_0x43fab6(0x214)](_0x3a8d11);}),_0x8fbe8[_0x46eea7(0x1d1)]((_0x371cb9,_0x4fdc64)=>{_0x4a5612[_0x4fdc64]['quantity']=_0x371cb9;}),_0x5f1e6e[_0x46eea7(0x1d1)]((_0x2ba37f,_0x4910c4)=>{var _0x50dc3a=_0x46eea7;_0x4a5612[_0x4910c4][_0x50dc3a(0x298)]=_0x2ba37f;}),_0x41356e[_0x46eea7(0x1d1)]((_0x3d1a42,_0x49fe12)=>{_0x4a5612[_0x49fe12]['secondary_code']=_0x3d1a42;}),_0x1b2350[_0x46eea7(0x1d1)]((_0x4adbbf,_0x5ef83a)=>{var _0x3706a9=_0x46eea7;_0x4a5612[_0x5ef83a][_0x3706a9(0x22c)]=_0x4adbbf;}),_0x193ed8[_0x46eea7(0x1d1)]((_0x482153,_0x3ca7dc)=>{var _0x52f022=_0x46eea7;_0x35ab33[_0x52f022(0x1d1)]((_0x402e74,_0x430652)=>{var _0x44c43c=_0x52f022;if(_0x402e74==_0x44c43c(0x1aa)&&_0x3ca7dc==_0x430652){var _0x522e3b=_0x482153[_0x44c43c(0x1e5)](0x3);_0x4a5612[_0x3ca7dc][_0x44c43c(0x1ea)]=_0x482153[0x0],_0x4a5612[_0x3ca7dc][_0x44c43c(0x247)]=_0x482153[0x1],_0x4a5612[_0x3ca7dc][_0x44c43c(0x215)]=0x0,_0x4a5612[_0x3ca7dc][_0x44c43c(0x229)]=0x0,_0x4a5612[_0x3ca7dc][_0x44c43c(0x2ab)]=_0x44c43c(0x29d),_0x4a5612[_0x3ca7dc][_0x44c43c(0x2a8)]=_0x522e3b;}else{if(_0x402e74==_0x44c43c(0x248)&&_0x3ca7dc==_0x430652){var _0x522e3b=_0x482153[_0x44c43c(0x1e5)](0x3);_0x4a5612[_0x3ca7dc][_0x44c43c(0x1ea)]=_0x482153[0x0],_0x4a5612[_0x3ca7dc][_0x44c43c(0x247)]=_0x482153[0x1],_0x4a5612[_0x3ca7dc]['bay']=0x0,_0x4a5612[_0x3ca7dc][_0x44c43c(0x229)]=0x0,_0x4a5612[_0x3ca7dc]['type']=_0x44c43c(0x29d),_0x4a5612[_0x3ca7dc][_0x44c43c(0x2a8)]=_0x482153[0x5];}else{if(_0x3ca7dc==_0x430652){var _0xde4b83;if(_0x482153[0x4]=='L')_0xde4b83=_0x44c43c(0x2a7);else _0x482153[0x4]=='F'&&(_0xde4b83=_0x44c43c(0x29d));_0x4a5612[_0x3ca7dc][_0x44c43c(0x1ea)]=_0x482153[0x0],_0x4a5612[_0x3ca7dc][_0x44c43c(0x247)]=_0x482153[0x1],_0x4a5612[_0x3ca7dc][_0x44c43c(0x215)]=_0x482153[0x2],_0x4a5612[_0x3ca7dc]['bin']=_0x482153[0x3],_0x4a5612[_0x3ca7dc][_0x44c43c(0x2ab)]=_0xde4b83,_0x4a5612[_0x3ca7dc][_0x44c43c(0x2a8)]=_0x482153[0x5];}}}});}),_0x1091d3[_0x46eea7(0x1d1)]((_0x1714c1,_0x569e00)=>{var _0x3b626c=_0x46eea7;_0x4a5612[_0x569e00][_0x3b626c(0x291)]=_0x1714c1;}),_0xf48546[_0x46eea7(0x1d1)]((_0x527869,_0x26d8d6)=>{var _0x493cc5=_0x46eea7;_0x4a5612[_0x26d8d6][_0x493cc5(0x23e)]=_0x527869;}),_0x527b89[_0x46eea7(0x1d1)]((_0x39472e,_0x16e2ae)=>{var _0xff73f3=_0x46eea7;_0x4a5612[_0x16e2ae][_0xff73f3(0x1da)]=_0x39472e;}),_0x467f03[_0x46eea7(0x1d1)]((_0x3b49c6,_0x2a10f9)=>{var _0x2fec23=_0x46eea7;_0x4a5612[_0x2a10f9][_0x2fec23(0x253)]=_0x3b49c6;}),_0x5ed51d[_0x46eea7(0x1d1)]((_0x1f1c13,_0x2cd2b0)=>{var _0x4fe14c=_0x46eea7;_0x4a5612[_0x2cd2b0][_0x4fe14c(0x24c)]=_0x1f1c13;}),_0x44e177[_0x46eea7(0x1d1)]((_0x1f3344,_0x1f5fb7)=>{_0x4a5612[_0x1f5fb7]['production_date']=_0x1f3344;}),_0x35b16c[_0x46eea7(0x1d1)]((_0x14092f,_0x5931e4)=>{var _0x47a487=_0x46eea7;_0x4a5612[_0x5931e4][_0x47a487(0x294)]=Math[_0x47a487(0x214)](_0x14092f);}),_0x153574[_0x46eea7(0x1d1)]((_0x141fe6,_0x2a0f44)=>{_0x4a5612[_0x2a0f44]['delivery_date']=_0x141fe6;}),_0xa2536f[_0x46eea7(0x1d1)]((_0x3a275b,_0x287974)=>{_0x4a5612[_0x287974]['delivery_code']=_0x3a275b;}),_0x41690e[_0x46eea7(0x1d1)]((_0x14225d,_0x3da87e)=>{_0x4a5612[_0x3da87e]['prod_cat']=_0x14225d;}),_0x360d51[_0x46eea7(0x1d1)]((_0x79a5a2,_0xafd08)=>{var _0xa9e7eb=_0x46eea7;_0x4a5612[_0xafd08][_0xa9e7eb(0x1d3)]=_0x79a5a2;}),_0x35ab33[_0x46eea7(0x1d1)]((_0x403407,_0x37e9ad)=>{var _0x52d6a8=_0x46eea7;_0x4a5612[_0x37e9ad][_0x52d6a8(0x2aa)]=_0x403407;});var _0x502e0d=0x0;_0x4a5612[_0x46eea7(0x1d1)](_0x108206=>{var _0x2c5733=_0x46eea7;console[_0x2c5733(0x201)]('foreach\x20newproduct',_0x108206),(parseInt(_0x108206[_0x2c5733(0x216)])<parseInt(_0x108206[_0x2c5733(0x213)])||parseInt(_0x108206['quantity'])==0x0)&&_0x502e0d++;});if(_0x502e0d!=0x0)return _0x185077[_0x46eea7(0x2a9)]('errors',_0x46eea7(0x24a)),_0x245835['redirect'](_0x46eea7(0x2a4));const _0x404276=_0x4a5612[_0x46eea7(0x226)](_0x27ca7b=>_0x27ca7b[_0x46eea7(0x213)]!=='0'&&_0x27ca7b[_0x46eea7(0x213)]!=='');_0x1c6c93[_0x46eea7(0x1db)]=_0x57be12,_0x1c6c93[_0x46eea7(0x1b1)]=_0x1d8bbb,_0x1c6c93[_0x46eea7(0x22b)]=_0x42399b,_0x1c6c93[_0x46eea7(0x239)]=_0x148378,_0x1c6c93['sale_product']=_0x404276,_0x1c6c93[_0x46eea7(0x258)]=_0x1efe42,_0x1c6c93['SCRN']=_0x34f865,_0x1c6c93[_0x46eea7(0x1d7)]=_0x46eea7(0x27a),_0x1c6c93[_0x46eea7(0x1eb)]=_0x46eea7(0x27a);const _0x1017cb=await _0x1c6c93[_0x46eea7(0x23a)]();_0x185077[_0x46eea7(0x2a9)](_0x46eea7(0x1c1),'Sales\x20Update\x20successfully'),_0x245835[_0x46eea7(0x27e)]('/all_sales/view');}catch(_0xd102f3){console[_0x46eea7(0x201)](_0xd102f3);}}),router[a0_0x4fc6b7(0x22d)](a0_0x4fc6b7(0x1ae),auth,async(_0xc42bdf,_0x1aa43d)=>{var _0x22d809=a0_0x4fc6b7;try{const _0x3ffaef=_0xc42bdf[_0x22d809(0x1fe)]['id'],{invoice:_0x29c889,customer:_0x1df1a0,receivable_amount:_0x3309bf,received_amount:_0x19c2af}=_0xc42bdf[_0x22d809(0x1e6)],_0xce626b=await sales[_0x22d809(0x1d8)](_0x3ffaef);console[_0x22d809(0x201)](_0xce626b);var _0x26439f=_0x3309bf-_0x19c2af;console[_0x22d809(0x201)](_0x19c2af),_0xce626b[_0x22d809(0x25c)]=parseFloat(_0x19c2af)+parseFloat(_0xce626b['received_amount']),_0xce626b[_0x22d809(0x2af)]=_0x26439f,console[_0x22d809(0x201)](_0xce626b);const _0x163521=await _0xce626b[_0x22d809(0x23a)](),_0x432c87=await c_payment_data['findOne']({'invoice':_0x29c889});_0x432c87['amount']=_0x26439f,await _0x432c87['save']();let _0x3f1f04=new Date(),_0x534da8=('0'+_0x3f1f04['getDate']())[_0x22d809(0x1e5)](-0x2),_0x3774e9=('0'+(_0x3f1f04[_0x22d809(0x277)]()+0x1))[_0x22d809(0x1e5)](-0x2),_0x53ec83=_0x3f1f04['getFullYear'](),_0x170f42=_0x53ec83+'-'+_0x3774e9+'-'+_0x534da8;const _0x47d498=new customer_payment({'invoice':_0x29c889,'date':_0x53ec83+'-'+_0x3774e9+'-'+_0x534da8,'customer':_0x1df1a0,'reason':_0x22d809(0x1de),'amount':_0x19c2af}),_0x5b8f6a=await _0x47d498[_0x22d809(0x23a)]();_0xc42bdf[_0x22d809(0x2a9)]('success',_0x22d809(0x227)),_0x1aa43d['redirect'](_0x22d809(0x1c9));}catch(_0x14632a){console[_0x22d809(0x201)](_0x14632a);}}),router[a0_0x4fc6b7(0x1e9)]('/invoice/:id',auth,async(_0x5aa00f,_0x38db54)=>{var _0x214b7d=a0_0x4fc6b7;try{const {username:_0x2969fa,email:_0xec3cf8,role:_0x374321}=_0x5aa00f[_0x214b7d(0x1f4)],_0x1de2b8=_0x5aa00f[_0x214b7d(0x1f4)],_0x208125=await profile['findOne']({'email':_0x1de2b8[_0x214b7d(0x1ac)]}),_0x4cc8cd=await master_shop[_0x214b7d(0x25b)]();console[_0x214b7d(0x201)](_0x214b7d(0x1f5),_0x4cc8cd);const _0x11d8e2=_0x5aa00f[_0x214b7d(0x1fe)]['id'],_0x5e1c5a=await sales[_0x214b7d(0x1d8)](_0x11d8e2);console['log'](_0x5e1c5a);const _0x5a14f1=await customer['findOne']({'name':_0x5e1c5a['customer']});console[_0x214b7d(0x201)](_0x5a14f1);if(_0x4cc8cd[0x0]['language']==_0x214b7d(0x1f6)){var _0x2529a5=users[_0x214b7d(0x2ae)];console[_0x214b7d(0x201)](_0x2529a5);}else{if(_0x4cc8cd[0x0][_0x214b7d(0x28f)]==_0x214b7d(0x1d0))var _0x2529a5=users[_0x214b7d(0x1d0)];else{if(_0x4cc8cd[0x0]['language']==_0x214b7d(0x29c))var _0x2529a5=users[_0x214b7d(0x29c)];else{if(_0x4cc8cd[0x0][_0x214b7d(0x28f)]==_0x214b7d(0x218))var _0x2529a5=users[_0x214b7d(0x218)];else{if(_0x4cc8cd[0x0][_0x214b7d(0x28f)]==_0x214b7d(0x21f))var _0x2529a5=users[_0x214b7d(0x21f)];else{if(_0x4cc8cd[0x0]['language']=='Portuguese\x20(BR)')var _0x2529a5=users[_0x214b7d(0x1e3)];else{if(_0x4cc8cd[0x0][_0x214b7d(0x28f)]==_0x214b7d(0x260))var _0x2529a5=users['Chinese'];else{if(_0x4cc8cd[0x0]['language']==_0x214b7d(0x2ad))var _0x2529a5=users[_0x214b7d(0x2a6)];}}}}}}}_0x38db54['render'](_0x214b7d(0x271),{'success':_0x5aa00f[_0x214b7d(0x2a9)](_0x214b7d(0x1c1)),'errors':_0x5aa00f['flash'](_0x214b7d(0x28b)),'role':_0x1de2b8,'profile':_0x208125,'master_shop':_0x4cc8cd,'customers':_0x5a14f1,'sales':_0x5e1c5a,'language':_0x2529a5});}catch(_0x512e81){console[_0x214b7d(0x201)](_0x512e81);}}),router[a0_0x4fc6b7(0x1e9)]('/view/return_sales/:id',auth,async(_0x478640,_0x29ec30)=>{var _0x4ad529=a0_0x4fc6b7;try{const {username:_0x42d22d,email:_0x4e6225,role:_0x4793c1}=_0x478640[_0x4ad529(0x1f4)],_0x3634b6=_0x478640[_0x4ad529(0x1f4)],_0x49db76=await profile[_0x4ad529(0x1df)]({'email':_0x3634b6['email']}),_0x48d29c=await master_shop[_0x4ad529(0x25b)]();console[_0x4ad529(0x201)](_0x4ad529(0x1f5),_0x48d29c);const _0x1930c4=_0x478640[_0x4ad529(0x1fe)]['id'];console[_0x4ad529(0x201)](_0x1930c4);const _0x73f250=await sales[_0x4ad529(0x1d8)](_0x1930c4);console[_0x4ad529(0x201)](_0x4ad529(0x2a0),_0x73f250);const _0x29f316=await warehouse[_0x4ad529(0x268)]([{'$match':{'name':_0x4ad529(0x21b),'room':'Return\x20Rooms'}},{'$unwind':_0x4ad529(0x282)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4ad529(0x1b5)},'product_stock':{'$first':_0x4ad529(0x1c0)},'level':{'$first':_0x4ad529(0x1c3)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4ad529(0x275)},'primary_code':{'$first':_0x4ad529(0x1d9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console['log'](_0x4ad529(0x21e),_0x29f316);const _0x46e0b1=await product[_0x4ad529(0x25b)]({});warehouse_data=await warehouse[_0x4ad529(0x268)]([{'$match':{'status':'Enabled','name':_0x4ad529(0x21b),'warehouse_category':_0x4ad529(0x1c7)}},{'$group':{'_id':_0x4ad529(0x29f),'name':{'$first':_0x4ad529(0x29f)}}},{'$sort':{'name':0x1}}]);var _0x3394de=[_0x4ad529(0x252)];if(_0x48d29c[0x0][_0x4ad529(0x28f)]=='English\x20(US)'){var _0x4ffbcd=users[_0x4ad529(0x2ae)];console[_0x4ad529(0x201)](_0x4ffbcd);}else{if(_0x48d29c[0x0][_0x4ad529(0x28f)]==_0x4ad529(0x1d0))var _0x4ffbcd=users[_0x4ad529(0x1d0)];else{if(_0x48d29c[0x0][_0x4ad529(0x28f)]==_0x4ad529(0x29c))var _0x4ffbcd=users['German'];else{if(_0x48d29c[0x0][_0x4ad529(0x28f)]==_0x4ad529(0x218))var _0x4ffbcd=users[_0x4ad529(0x218)];else{if(_0x48d29c[0x0][_0x4ad529(0x28f)]==_0x4ad529(0x21f))var _0x4ffbcd=users[_0x4ad529(0x21f)];else{if(_0x48d29c[0x0][_0x4ad529(0x28f)]==_0x4ad529(0x25d))var _0x4ffbcd=users[_0x4ad529(0x1e3)];else{if(_0x48d29c[0x0][_0x4ad529(0x28f)]=='Chinese')var _0x4ffbcd=users[_0x4ad529(0x260)];else{if(_0x48d29c[0x0]['language']==_0x4ad529(0x2ad))var _0x4ffbcd=users['Arabic'];}}}}}}}_0x29ec30[_0x4ad529(0x205)](_0x4ad529(0x1c4),{'success':_0x478640[_0x4ad529(0x2a9)]('success'),'errors':_0x478640[_0x4ad529(0x2a9)](_0x4ad529(0x28b)),'role':_0x3634b6,'profile':_0x49db76,'user':_0x73f250,'stock':_0x29f316,'master_shop':_0x48d29c,'unit':_0x46e0b1,'language':_0x4ffbcd,'warehouses':warehouse_data,'rooms':_0x3394de});}catch(_0x3f2768){console[_0x4ad529(0x201)](_0x3f2768),_0x29ec30[_0x4ad529(0x236)](0xc8)['json']({'message':_0x3f2768[_0x4ad529(0x21a)]});}}),router[a0_0x4fc6b7(0x22d)](a0_0x4fc6b7(0x240),auth,async(_0x1e8140,_0x1a673f)=>{var _0x2d63df=a0_0x4fc6b7;try{const {invoice:_0xe883df,date:_0x52c837,warehouse_name:_0x5053cf,product_name:_0x340620,primary_code:_0x5b1ac6,secondary_code:_0x464813,product_code:_0x351b16,sales_quantity:_0x836d18,stocks:_0x1577c3,return_qty:_0x19c93a,Room_name:_0x2f77b2,to_warehouse_name:_0x2690b6,to_Roomname:_0x188f70,to_Room_name:_0x18e2eb,note:_0x3fd8f8,level:_0x8ec1fb,isle:_0x3cd59c,pallet:_0x55f5ec}=_0x1e8140['body'];if(typeof _0x340620=='string')var _0x4de767=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x1c2)]],_0x698cd2=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x298)]],_0x4cc794=[_0x1e8140[_0x2d63df(0x1e6)]['secondary_code']],_0x29b10d=[_0x1e8140['body'][_0x2d63df(0x22c)]],_0x4029ec=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x272)]],_0x4b32dc=[_0x1e8140['body'][_0x2d63df(0x237)]],_0x4b19f8=[_0x1e8140['body']['return_qty']],_0x2bcb01=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x215)]],_0x28c913=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x229)]],_0x53e886=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x1d6)]],_0x142332=[_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x2a8)]];else var _0x4de767=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x1c2)]],_0x698cd2=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x298)]],_0x4cc794=[..._0x1e8140['body'][_0x2d63df(0x1bd)]],_0x29b10d=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x22c)]],_0x4029ec=[..._0x1e8140[_0x2d63df(0x1e6)]['sales_quantity']],_0x4b32dc=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x237)]],_0x4b19f8=[..._0x1e8140[_0x2d63df(0x1e6)]['return_qty']],_0x2bcb01=[..._0x1e8140['body'][_0x2d63df(0x215)]],_0x28c913=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x229)]],_0x53e886=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x1d6)]],_0x142332=[..._0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x2a8)]];const _0x537dd3=_0x4de767[_0x2d63df(0x251)](_0x678572=>{return _0x678572={'product_name':_0x678572};});_0x698cd2[_0x2d63df(0x1d1)]((_0xee88bc,_0x28d8a9)=>{var _0x2fa4ba=_0x2d63df;_0x537dd3[_0x28d8a9][_0x2fa4ba(0x298)]=_0xee88bc;}),_0x4cc794[_0x2d63df(0x1d1)]((_0x1c7acc,_0x5953ed)=>{var _0x498442=_0x2d63df;_0x537dd3[_0x5953ed][_0x498442(0x1bd)]=_0x1c7acc;}),_0x29b10d['forEach']((_0x1d3a26,_0x9b7e66)=>{var _0x2e0230=_0x2d63df;_0x537dd3[_0x9b7e66][_0x2e0230(0x22c)]=_0x1d3a26;}),_0x4029ec[_0x2d63df(0x1d1)]((_0x5cbf75,_0x395eca)=>{var _0x1c4b38=_0x2d63df;_0x537dd3[_0x395eca][_0x1c4b38(0x27d)]=_0x5cbf75;}),_0x4b32dc[_0x2d63df(0x1d1)]((_0x365f57,_0x5ea05a)=>{_0x537dd3[_0x5ea05a]['stock']=_0x365f57;}),_0x4b19f8[_0x2d63df(0x1d1)]((_0x280514,_0xdfe21f)=>{var _0x3d6c3e=_0x2d63df;_0x537dd3[_0xdfe21f][_0x3d6c3e(0x1b8)]=_0x280514;}),_0x2bcb01['forEach']((_0x575e2a,_0x30d1b4)=>{var _0x1a595b=_0x2d63df;_0x537dd3[_0x30d1b4][_0x1a595b(0x215)]=_0x575e2a;}),_0x28c913[_0x2d63df(0x1d1)]((_0x2b8953,_0x24b3d1)=>{var _0x210ec0=_0x2d63df;_0x537dd3[_0x24b3d1][_0x210ec0(0x229)]=_0x2b8953;}),_0x53e886[_0x2d63df(0x1d1)]((_0x3dd7e0,_0x51b8a4)=>{var _0x52b506=_0x2d63df;_0x537dd3[_0x51b8a4][_0x52b506(0x2ab)]=_0x3dd7e0;}),_0x142332['forEach']((_0x1f2194,_0x4e3742)=>{var _0x51857e=_0x2d63df;_0x537dd3[_0x4e3742][_0x51857e(0x2a8)]=_0x1f2194;});var _0x2ebeaf=0x0;_0x537dd3[_0x2d63df(0x1d1)](_0x3de938=>{var _0x3bdf6b=_0x2d63df;console['log'](_0x3bdf6b(0x280),_0x3de938),(parseInt(_0x3de938[_0x3bdf6b(0x27d)])<parseInt(_0x3de938[_0x3bdf6b(0x1b8)])||parseInt(_0x3de938[_0x3bdf6b(0x216)])<parseInt(_0x3de938[_0x3bdf6b(0x1b8)])&&parseInt(_0x3de938[_0x3bdf6b(0x27d)])>parseInt(_0x3de938['return_qty'])||parseInt(_0x3de938[_0x3bdf6b(0x1b8)])==0x0)&&_0x2ebeaf++;});if(_0x2ebeaf!=0x0)return _0x1e8140[_0x2d63df(0x2a9)](_0x2d63df(0x28b),_0x2d63df(0x1d2)),_0x1a673f[_0x2d63df(0x27e)](_0x2d63df(0x2a4));const _0x5ee47c=await sales[_0x2d63df(0x1df)]({'invoice':_0xe883df});console[_0x2d63df(0x201)](_0x5ee47c),_0x5ee47c['return_data']=_0x2d63df(0x265);const _0xfc5ee=await _0x5ee47c['save'](),_0x3a614d=new sales_return({'invoice':_0xe883df,'customer':_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x1b1)],'date':_0x52c837,'warehouse_name':_0x5053cf,'room':_0x2f77b2,'ToWarehouse':_0x2690b6,'ToRoom':_0x18e2eb,'return_sale':_0x537dd3,'note':_0x3fd8f8}),_0x24a474=await _0x3a614d[_0x2d63df(0x23a)]();console[_0x2d63df(0x201)](_0x3a614d);const _0x531b1c=await sales_return[_0x2d63df(0x1df)]({'invoice':_0xe883df}),_0x18c17a=await warehouse['findOne']({'name':_0x2690b6,'room':_0x18e2eb});_0x531b1c[_0x2d63df(0x1c4)][_0x2d63df(0x1d1)](_0x3aa52f=>{var _0x28e45f=_0x2d63df,_0x449395=0x0;const _0x1e2620=_0x18c17a[_0x28e45f(0x1e2)][_0x28e45f(0x251)](_0x1bc2aa=>{var _0x412106=_0x28e45f;_0x1bc2aa[_0x412106(0x1c2)]==_0x3aa52f[_0x412106(0x1c2)]&&_0x1bc2aa[_0x412106(0x2a8)]==_0x3aa52f[_0x412106(0x2a8)]&&_0x1bc2aa[_0x412106(0x2ab)]==_0x3aa52f[_0x412106(0x2ab)]&&_0x1bc2aa[_0x412106(0x229)]==_0x3aa52f[_0x412106(0x229)]&&_0x1bc2aa[_0x412106(0x215)]==_0x3aa52f['bay']&&(_0x1bc2aa['product_stock']=parseInt(_0x1bc2aa['product_stock'])+parseInt(_0x3aa52f[_0x412106(0x1b8)]),_0x449395++);});_0x449395=='0'&&(_0x18c17a[_0x28e45f(0x1e2)]=_0x18c17a['product_details'][_0x28e45f(0x23b)]({'product_name':_0x3aa52f['product_name'],'product_stock':_0x3aa52f[_0x28e45f(0x1b8)],'primary_code':_0x3aa52f[_0x28e45f(0x298)],'secondary_code':_0x3aa52f['secondary_code'],'product_code':_0x3aa52f[_0x28e45f(0x22c)],'bay':_0x3aa52f[_0x28e45f(0x215)],'bin':_0x3aa52f[_0x28e45f(0x229)],'type':_0x3aa52f[_0x28e45f(0x2ab)],'floorlevel':_0x3aa52f['floorlevel']})),console[_0x28e45f(0x201)]('final',_0x18c17a);}),await _0x18c17a['save'](),console['log'](_0x1e8140['body']);const _0x241e84=new c_payment_data({'invoice':_0xe883df,'customer':_0x1e8140[_0x2d63df(0x1e6)][_0x2d63df(0x1b1)],'reason':_0x2d63df(0x200)});await _0x241e84[_0x2d63df(0x23a)]();const _0x3e7f3d=await master_shop[_0x2d63df(0x25b)]();console['log'](_0x2d63df(0x26a),_0x3e7f3d[0x0][_0x2d63df(0x26b)]);const _0x1c7bf0=await email_settings[_0x2d63df(0x1df)](),_0x413e0d=await customer[_0x2d63df(0x1df)]({'name':_0x1e8140['body']['customer']});console[_0x2d63df(0x201)](_0x2d63df(0x254),_0x413e0d);_0x3e7f3d[0x0][_0x2d63df(0x26d)]==0x1?(right_currency=_0x3e7f3d[0x0][_0x2d63df(0x1fc)],left_currency=''):(right_currency='',left_currency=_0x3e7f3d[0x0][_0x2d63df(0x1fc)]);var _0x584113=_0x4de767,_0x5f4f87=_0x4b19f8,_0x83a86e='',_0x229bd6;for(_0x229bd6 in _0x584113){_0x83a86e+=_0x2d63df(0x269)+_0x2d63df(0x286)+_0x584113[_0x229bd6]+'</td>'+_0x2d63df(0x286)+_0x5f4f87[_0x229bd6]+'</td>'+_0x2d63df(0x289);}console[_0x2d63df(0x201)](_0x2d63df(0x297),_0x83a86e);let _0x469cc6=nodemailer[_0x2d63df(0x2b2)]({'service':_0x2d63df(0x231),'auth':{'user':_0x1c7bf0[_0x2d63df(0x1ac)],'pass':_0x1c7bf0['password']}}),_0x282feb={'from':_0x1c7bf0[_0x2d63df(0x1ac)],'to':_0x413e0d[_0x2d63df(0x1ac)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2d63df(0x264),'path':__dirname+'/../public'+_0x2d63df(0x1ec)+_0x3e7f3d[0x0]['image'],'cid':_0x2d63df(0x1dc)}],'html':'<!DOCTYPE\x20html>'+_0x2d63df(0x1cf)+_0x2d63df(0x23d)+_0x2d63df(0x1b0)+_0x2d63df(0x29e)+'<div>'+_0x2d63df(0x238)+_0x2d63df(0x290)+_0x2d63df(0x1b0)+'<h2>\x20'+_0x3e7f3d[0x0][_0x2d63df(0x22a)]+_0x2d63df(0x255)+_0x2d63df(0x290)+_0x2d63df(0x290)+_0x2d63df(0x1ca)+_0x2d63df(0x1b0)+_0x2d63df(0x20b)+_0x2d63df(0x1cd)+_0xe883df+'\x20'+_0x2d63df(0x24d)+_0x2d63df(0x206)+_0x52c837+'\x20'+_0x2d63df(0x1ce)+_0x2d63df(0x249)+_0x2d63df(0x290)+_0x2d63df(0x25e)+_0x2d63df(0x1b2)+_0x2d63df(0x269)+_0x2d63df(0x1c8)+_0x2d63df(0x1f7)+_0x2d63df(0x27c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2d63df(0x289)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x83a86e+'\x20'+_0x2d63df(0x1e4)+_0x2d63df(0x278)+'<div>'+_0x2d63df(0x243)+_0x2d63df(0x28d)+_0x3e7f3d[0x0]['site_title']+'</h5>'+'</div>'+_0x2d63df(0x290)+_0x2d63df(0x20a)};_0x469cc6['sendMail'](_0x282feb,function(_0x5581cf,_0x37f16a){var _0x3ece4b=_0x2d63df;_0x5581cf?(console[_0x3ece4b(0x201)](_0x5581cf),console['log'](_0x3ece4b(0x1e7))):console[_0x3ece4b(0x201)]('Email\x20sent\x20successfully');}),_0x1e8140[_0x2d63df(0x2a9)](_0x2d63df(0x1c1),_0x2d63df(0x1c5)),_0x1a673f['redirect'](_0x2d63df(0x1c9));}catch(_0x14e247){console[_0x2d63df(0x201)](_0x14e247),_0x1a673f['status'](0xc8)[_0x2d63df(0x1b3)]({'message1':_0x14e247[_0x2d63df(0x21a)]});}}),router['get'](a0_0x4fc6b7(0x261),auth,async(_0x4f476c,_0x42f661)=>{var _0x1dd380=a0_0x4fc6b7;try{const {username:_0x2021ca,email:_0x1ffff3,role:_0x4f0f30}=_0x4f476c[_0x1dd380(0x1f4)],_0x2d1719=_0x4f476c['user'],_0x366c3f=await profile[_0x1dd380(0x1df)]({'email':_0x2d1719['email']}),_0x13709e=await master_shop[_0x1dd380(0x25b)]();console['log'](_0x1dd380(0x270),_0x13709e);const _0x540ca7=_0x4f476c[_0x1dd380(0x1fe)]['id'],_0x5cfce9=await sales[_0x1dd380(0x1d8)](_0x540ca7);console[_0x1dd380(0x201)](_0x1dd380(0x245),_0x5cfce9);if(_0x13709e[0x0][_0x1dd380(0x28f)]==_0x1dd380(0x1f6))var _0x149600=users['English'];else{if(_0x13709e[0x0][_0x1dd380(0x28f)]=='Hindi')var _0x149600=users[_0x1dd380(0x1d0)];else{if(_0x13709e[0x0]['language']=='German')var _0x149600=users[_0x1dd380(0x29c)];else{if(_0x13709e[0x0]['language']==_0x1dd380(0x218))var _0x149600=users[_0x1dd380(0x218)];else{if(_0x13709e[0x0][_0x1dd380(0x28f)]==_0x1dd380(0x21f))var _0x149600=users[_0x1dd380(0x21f)];else{if(_0x13709e[0x0][_0x1dd380(0x28f)]==_0x1dd380(0x25d))var _0x149600=users['Portuguese'];else{if(_0x13709e[0x0][_0x1dd380(0x28f)]==_0x1dd380(0x260))var _0x149600=users[_0x1dd380(0x260)];else{if(_0x13709e[0x0][_0x1dd380(0x28f)]=='Arabic\x20(ae)')var _0x149600=users['Arabic'];}}}}}}}_0x42f661['render'](_0x1dd380(0x222),{'success':_0x4f476c[_0x1dd380(0x2a9)](_0x1dd380(0x1c1)),'errors':_0x4f476c['flash'](_0x1dd380(0x28b)),'role':_0x2d1719,'profile':_0x366c3f,'alldata':_0x5cfce9,'master_shop':_0x13709e,'language':_0x149600});}catch(_0x36f20d){console['log'](_0x36f20d);}}),router[a0_0x4fc6b7(0x22d)](a0_0x4fc6b7(0x267),async(_0x492e38,_0x19ef8b)=>{var _0x4b914a=a0_0x4fc6b7;const {product_code:_0x129ff2,warehouse_name:_0x198517,rooms_data:_0x49ea2e,Roomslist:_0x47451c}=_0x492e38[_0x4b914a(0x1e6)],_0x8db9e0=_0x47451c[_0x4b914a(0x25a)](','),_0x369626=[];async function _0x1d2960(_0x1f32de){var _0x46a210=_0x4b914a;const _0x3c29e0=await warehouse[_0x46a210(0x268)]([{'$match':{'name':_0x198517,'room':_0x1f32de}},{'$unwind':_0x46a210(0x282)},{'$match':{'product_details.primary_code':_0x129ff2}},{'$group':{'_id':_0x46a210(0x1af),'name':{'$first':_0x46a210(0x1b5)},'product_stock':{'$first':_0x46a210(0x1c0)},'primary_code':{'$first':_0x46a210(0x1d9)},'secondary_code':{'$first':_0x46a210(0x24f)},'product_code':{'$first':_0x46a210(0x24e)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x46a210(0x2a2)},'type':{'$first':_0x46a210(0x2ac)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x46a210(0x26c)},'secondary_unit':{'$first':_0x46a210(0x230)},'storage':{'$first':_0x46a210(0x1b4)},'rack':{'$first':_0x46a210(0x1ee)},'expiry_date':{'$first':_0x46a210(0x2a5)},'production_date':{'$first':_0x46a210(0x288)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x46a210(0x1fb)},'product_cat':{'$first':_0x46a210(0x1ad)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x46a210(0x1ab)},'invoice':{'$first':_0x46a210(0x233)},'actual_qty':{'$first':_0x46a210(0x292)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x1ea9e4=await warehouse[_0x46a210(0x268)]([{'$match':{'name':_0x198517,'room':_0x1f32de}},{'$unwind':_0x46a210(0x282)},{'$match':{'product_details.secondary_code':_0x129ff2}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x46a210(0x1b5)},'product_stock':{'$first':_0x46a210(0x1c0)},'primary_code':{'$first':_0x46a210(0x1d9)},'secondary_code':{'$first':_0x46a210(0x24f)},'product_code':{'$first':_0x46a210(0x24e)},'level':{'$first':_0x46a210(0x234)},'isle':{'$first':_0x46a210(0x2a2)},'type':{'$first':_0x46a210(0x2ac)},'pallet':{'$first':_0x46a210(0x203)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x46a210(0x1ee)},'expiry_date':{'$first':_0x46a210(0x2a5)},'production_date':{'$first':_0x46a210(0x288)},'maxPerUnit':{'$first':_0x46a210(0x296)},'batch_code':{'$first':_0x46a210(0x1fb)},'product_cat':{'$first':_0x46a210(0x1ad)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x46a210(0x1ab)},'invoice':{'$first':_0x46a210(0x233)}}}]);if(_0x3c29e0[_0x46a210(0x22f)]>0x0)_0x369626[_0x46a210(0x1b6)](_0x3c29e0);else _0x1ea9e4['length']>0x0&&_0x369626[_0x46a210(0x1b6)](_0x1ea9e4);}const _0x1d56cd=_0x8db9e0[_0x4b914a(0x251)](_0x55f14a=>_0x1d2960(_0x55f14a));await Promise[_0x4b914a(0x1ba)](_0x1d56cd),_0x19ef8b[_0x4b914a(0x1b3)](_0x369626);}),module['exports']=router;