var a0_0x4df440=a0_0x51ac;(function(_0x1408b3,_0x396e19){var _0x29be66=a0_0x51ac,_0x3c2341=_0x1408b3();while(!![]){try{var _0x32e9cb=parseInt(_0x29be66(0x215))/0x1*(parseInt(_0x29be66(0x29f))/0x2)+parseInt(_0x29be66(0x204))/0x3*(parseInt(_0x29be66(0x232))/0x4)+parseInt(_0x29be66(0x270))/0x5+parseInt(_0x29be66(0x29d))/0x6*(-parseInt(_0x29be66(0x1f0))/0x7)+parseInt(_0x29be66(0x20d))/0x8*(-parseInt(_0x29be66(0x225))/0x9)+parseInt(_0x29be66(0x21f))/0xa+-parseInt(_0x29be66(0x1fc))/0xb*(parseInt(_0x29be66(0x241))/0xc);if(_0x32e9cb===_0x396e19)break;else _0x3c2341['push'](_0x3c2341['shift']());}catch(_0x2b7357){_0x3c2341['push'](_0x3c2341['shift']());}}}(a0_0x3af4,0x32cf9));const express=require(a0_0x4df440(0x2bc)),app=express(),router=express[a0_0x4df440(0x2c0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4df440(0x28f)),auth=require(a0_0x4df440(0x1ff)),nodemailer=require(a0_0x4df440(0x2c1)),users=require(a0_0x4df440(0x28d));router[a0_0x4df440(0x2e9)](a0_0x4df440(0x28b),auth,async(_0x1b9507,_0x2a736f)=>{var _0x58034f=a0_0x4df440;try{const {username:_0x370992,email:_0x13a7c5,role:_0x249dce}=_0x1b9507['user'],_0x673ac4=_0x1b9507[_0x58034f(0x27a)],_0x409f27=await profile[_0x58034f(0x24b)]({'email':_0x673ac4[_0x58034f(0x266)]}),_0x41f02f=await master_shop[_0x58034f(0x24a)]();let _0x556d84;if(_0x673ac4['role']==_0x58034f(0x22e)){const _0x536e0c=await staff[_0x58034f(0x24b)]({'email':_0x673ac4[_0x58034f(0x266)]});_0x556d84=await sales[_0x58034f(0x2b0)]([{'$lookup':{'from':_0x58034f(0x291),'localField':_0x58034f(0x2f6),'foreignField':_0x58034f(0x2a6),'as':'customers_docs'}},{'$unwind':_0x58034f(0x1f1)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x58034f(0x2c9),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x58034f(0x2b9)},'warehouse_name':{'$first':_0x58034f(0x24e)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x58034f(0x29a)},'return_data':{'$first':_0x58034f(0x2e0)},'customers_docs':{'$first':_0x58034f(0x1f1)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x58034f(0x23b)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x58034f(0x2cc)},'pallet':{'$addToSet':_0x58034f(0x2ec)},'finalize':{'$first':_0x58034f(0x218)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x556d84=await sales[_0x58034f(0x2b0)]([{'$lookup':{'from':_0x58034f(0x291),'localField':_0x58034f(0x2f6),'foreignField':_0x58034f(0x2a6),'as':_0x58034f(0x2c8)}},{'$unwind':_0x58034f(0x1f1)},{'$unwind':_0x58034f(0x2aa)},{'$group':{'_id':'$_id','invoice':{'$first':_0x58034f(0x2db)},'customers':{'$first':_0x58034f(0x26a)},'date':{'$first':_0x58034f(0x2b9)},'warehouse_name':{'$first':_0x58034f(0x24e)},'sale_product':{'$push':_0x58034f(0x2aa)},'note':{'$first':_0x58034f(0x29a)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x58034f(0x1f1)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x58034f(0x23b)},'isle':{'$addToSet':_0x58034f(0x288)},'type':{'$addToSet':_0x58034f(0x2cc)},'pallet':{'$addToSet':_0x58034f(0x2ec)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x58034f(0x25a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log']('sales\x20all_data',_0x556d84);if(_0x41f02f[0x0]['language']==_0x58034f(0x2a5)){var _0x32fcce=users[_0x58034f(0x2d3)];console[_0x58034f(0x250)](_0x32fcce);}else{if(_0x41f02f[0x0][_0x58034f(0x23f)]=='Hindi')var _0x32fcce=users[_0x58034f(0x21d)];else{if(_0x41f02f[0x0][_0x58034f(0x23f)]=='German')var _0x32fcce=users['German'];else{if(_0x41f02f[0x0]['language']==_0x58034f(0x275))var _0x32fcce=users[_0x58034f(0x275)];else{if(_0x41f02f[0x0][_0x58034f(0x23f)]==_0x58034f(0x26e))var _0x32fcce=users[_0x58034f(0x26e)];else{if(_0x41f02f[0x0][_0x58034f(0x23f)]==_0x58034f(0x260))var _0x32fcce=users[_0x58034f(0x1f2)];else{if(_0x41f02f[0x0]['language']=='Chinese')var _0x32fcce=users['Chinese'];else{if(_0x41f02f[0x0][_0x58034f(0x23f)]==_0x58034f(0x290))var _0x32fcce=users[_0x58034f(0x1ef)];}}}}}}}_0x2a736f[_0x58034f(0x2eb)]('all_sales',{'success':_0x1b9507[_0x58034f(0x242)](_0x58034f(0x2a0)),'errors':_0x1b9507['flash'](_0x58034f(0x24c)),'sales':_0x556d84,'profile':_0x409f27,'role':_0x673ac4,'master_shop':_0x41f02f,'language':_0x32fcce});}catch(_0x2e523b){console[_0x58034f(0x250)](_0x2e523b);}});function a0_0x51ac(_0x3a9643,_0x56b4f2){var _0x3af445=a0_0x3af4();return a0_0x51ac=function(_0x51ac52,_0x59f8f6){_0x51ac52=_0x51ac52-0x1e4;var _0x547888=_0x3af445[_0x51ac52];return _0x547888;},a0_0x51ac(_0x3a9643,_0x56b4f2);}function a0_0x3af4(){var _0x3d0a30=['$product_details.bin','customer_data','secondary_unit','$note','Level','return_sale','587748yKtgTU','$product_details.product_cat','2nXOJJi','success','$product.product_name','$product_details.floorlevel','length','currency','English\x20(US)','name','maxperunit','</head><body>','warehouse','$sale_product','quantity_notConverted','foreach\x20newproduct','$product_details.rack','barcode\x20Product\x20master','Sales\x20Update\x20successfully','aggregate','error','Return\x20Rooms','\x20Order\x20Date\x20:\x20','\x20Order\x20Number\x20:\x20','unit','sale_qty','filter','True','$date','Sales\x20Add\x20successfully','random','express','/upload/','rack','/../public','Router','nodemailer','<tr>','final','$product_details.bay','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','finalize','customers_docs','$_id','actual_uom','params','$sale_product.type','prod_cat','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','findById','status','$product_details.level','English','bin','/barcode_scanner','$product_details.production_date','$product_details.storage','$product_details.product_name','Sale\x20Return','production_date','$invoice','return_data','role','$product_details.actual_uom','carton','$return_data','map','</tbody>','save','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','password','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','get','/view/add_sales','render','$sale_product.floorlevel','$product_details.primary_code','bay','currency_placement','storage','received_amount','createTransport','$product_details.batch_code','RMSEmail','product_code','customer','product_list','delivery_code','False','forEach','$product_details.maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','id_transaction_from','prod_invoice','invoice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.expiry_date','<html><head><title></title>','Return\x20Goods','</span>','push','Arabic','21BFesvS','$customers_docs','Portuguese','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sales\x20item\x20return\x20successfull','product_name','level','message','getFullYear','return_qty','$product_details.invoice','4972ePFSoR','/view/add_sales/:id','</table>','../middleware/auth','user_id','_id','\x20</h2>','date','3funcaV','/view/return_sales/:id','Raw\x20Materials','Receiving\x20Area','image','floor','sales_quantity','sale_product','getMonth','294776lxjLWb','OUT-','$product_details.pallet','padStart','room_name','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Sale\x20Return\x20Mail','105669xmcafS','German','host','$finalize','Floor','Ambient','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/preview/:id','Hindi','barcode\x20user_id','1817850siyZRx','$product_details._id','abs','batch_code','$product_details.unit','<hr\x20class=\x22my-3\x22>','63feWPIA','</body></html>','</td>','</thead>','primary_code','$name','exports','stock','<!DOCTYPE\x20html>','staff','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','slice','An\x20error\x20occurred.','1333208ZBUdWp','all','</h5>','$product','prod_code','site_title','primary_unit','<div>','port','$sale_product.bay','split','$product_details','id_transact','language','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','3792gQYJWw','flash','secondary_code','requested_qty','isAllowEdit','then','<h5\x20style=\x22text-align:\x20left;\x22>','/view/:id','type','find','findOne','errors','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$warehouse_name','$product_details.actual_qty','log','</div>','product_data','$product_details.product_code','product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','string','An\x20error\x20occurred\x20while\x20saving\x20data.','body','/all_sales/view','$isAllowEdit','RoomAssigned','$product_details.product_stock','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','SCRN','sendMail','Portuguese\x20(BR)','quantity','Error\x20Occurs','json','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Logo.png','email','edit_sales_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$room','$customer','master','redirect','/all_sales/preview/','French','max_per_unit','1410000HJikeK','<strong>\x20Regards\x20</strong>','<h2>\x20','$product_details.secondary_code','/barcode/:id','Spanish','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','product','Received\x20Payment\x20For\x20Sale','user','Enabled','$product_details.type','amount','purchases_data','/view/add_sale/product','floorlevel','logo','$product_details.secondary_unit','warehouse_name','actual_qty','Chinese','types','/invoice/:id','$sale_product.bin','delivery_date','post','/view','gmail','../public/language/languages.json','Shelves','../models/all_models','Arabic\x20(ae)','customers','back','payment\x20successfull','$product_details.isle','</tr>','catch'];a0_0x3af4=function(){return _0x3d0a30;};return a0_0x3af4();}async function getRandom8DigitNumber(){var _0x1555bd=a0_0x4df440;const _0x573c1a=0x989680,_0x5c7b40=0x5f5e0ff,_0x429690=Math[_0x1555bd(0x209)](Math[_0x1555bd(0x2bb)]()*(_0x5c7b40-_0x573c1a+0x1))+_0x573c1a;var _0x1c00e9;const _0xde4b21=await sales[_0x1555bd(0x24b)]({'invoice':'OUT-'+_0x429690});return _0xde4b21&&_0xde4b21[_0x1555bd(0x2a3)]>0x0?_0x1c00e9=_0x1555bd(0x20e)+_0x429690:_0x1c00e9=_0x1555bd(0x20e)+_0x429690,_0x1c00e9;}router['get'](a0_0x4df440(0x2ea),auth,async(_0x500223,_0x41885d)=>{var _0x3e9c47=a0_0x4df440;try{const {username:_0x19888a,email:_0x2037d0,role:_0x2669b5}=_0x500223['user'],_0x3a19ec=_0x500223[_0x3e9c47(0x27a)],_0x396786=await profile[_0x3e9c47(0x24b)]({'email':_0x3a19ec[_0x3e9c47(0x266)]}),_0x2ba236=await master_shop[_0x3e9c47(0x24a)](),_0x3447c4=await customer[_0x3e9c47(0x24a)]({});let _0x280bf0;if(_0x3a19ec['role']==_0x3e9c47(0x22e)){const _0x245a79=await staff[_0x3e9c47(0x24b)]({'email':_0x3a19ec[_0x3e9c47(0x266)]});_0x280bf0=await warehouse['aggregate']([{'$match':{'status':_0x3e9c47(0x27b),'name':_0x245a79[_0x3e9c47(0x2a9)],'warehouse_category':_0x3e9c47(0x206),'name':{'$ne':_0x3e9c47(0x1ec)}}},{'$group':{'_id':_0x3e9c47(0x22a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x280bf0=await warehouse[_0x3e9c47(0x2b0)]([{'$match':{'status':'Enabled','warehouse_category':_0x3e9c47(0x206),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x3e9c47(0x22a),'name':{'$first':_0x3e9c47(0x22a)}}},{'$sort':{'name':0x1}}]);const _0x3f5410=await product[_0x3e9c47(0x24a)]({});var _0x264dc1=['Ambient','Enclosed'];const _0x5b44d4=await sales[_0x3e9c47(0x24a)]({}),_0x57bfb9=_0x5b44d4[_0x3e9c47(0x2a3)]+0x1,_0x3fd73a=_0x3e9c47(0x20e)+_0x57bfb9['toString']()[_0x3e9c47(0x210)](0x5,'0');if(_0x2ba236[0x0]['language']==_0x3e9c47(0x2a5)){var _0x2a9afd=users['English'];console[_0x3e9c47(0x250)](_0x2a9afd);}else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]==_0x3e9c47(0x21d))var _0x2a9afd=users[_0x3e9c47(0x21d)];else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]==_0x3e9c47(0x216))var _0x2a9afd=users['German'];else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]==_0x3e9c47(0x275))var _0x2a9afd=users['Spanish'];else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]==_0x3e9c47(0x26e))var _0x2a9afd=users['French'];else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]==_0x3e9c47(0x260))var _0x2a9afd=users[_0x3e9c47(0x1f2)];else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]==_0x3e9c47(0x285))var _0x2a9afd=users['Chinese'];else{if(_0x2ba236[0x0][_0x3e9c47(0x23f)]=='Arabic\x20(ae)')var _0x2a9afd=users['Arabic'];}}}}}}}const _0x597375=getRandom8DigitNumber();_0x597375[_0x3e9c47(0x246)](_0x2cca5d=>{var _0x542e28=_0x3e9c47;_0x41885d[_0x542e28(0x2eb)]('add_sales',{'success':_0x500223[_0x542e28(0x242)](_0x542e28(0x2a0)),'errors':_0x500223['flash']('errors'),'role':_0x3a19ec,'profile':_0x396786,'customer':_0x3447c4,'warehouse':_0x280bf0,'product':_0x3f5410,'invoice':_0x2cca5d,'master_shop':_0x2ba236,'language':_0x2a9afd,'rooms_data':_0x264dc1});})[_0x3e9c47(0x296)](_0x373762=>{var _0x204fbd=_0x3e9c47;_0x500223[_0x204fbd(0x242)](_0x204fbd(0x24c),_0x204fbd(0x1e9)),_0x41885d[_0x204fbd(0x26c)]('/all_sales/view');});}catch(_0x4021db){console[_0x3e9c47(0x250)](_0x4021db);}}),router[a0_0x4df440(0x2e9)](a0_0x4df440(0x1fd),auth,async(_0x16e3f0,_0xcadede)=>{var _0x2f9ae6=a0_0x4df440;try{const _0x215568=_0x16e3f0['params']['id'];console['log'](_0x215568);const _0x1bd072=await product[_0x2f9ae6(0x24a)](),_0x1e5a96=await purchases[_0x2f9ae6(0x2b0)]([{'$match':{'warehouse_name':_0x215568}},{'$unwind':_0x2f9ae6(0x235)},{'$group':{'_id':_0x2f9ae6(0x2a1)}}]);console[_0x2f9ae6(0x250)](_0x2f9ae6(0x27e),_0x1e5a96),_0xcadede[_0x2f9ae6(0x2d1)](0xc8)['json']({'purchases_data':_0x1e5a96,'product_data':_0x1bd072});}catch(_0x324684){console[_0x2f9ae6(0x250)](_0x324684);}}),router[a0_0x4df440(0x28a)](a0_0x4df440(0x27f),auth,async(_0x1b03aa,_0x39d27d)=>{var _0x452c9c=a0_0x4df440;try{const {warehouse_data:_0x153d2a,product_data:_0x36662c}=_0x1b03aa[_0x452c9c(0x258)];console[_0x452c9c(0x250)](_0x1b03aa[_0x452c9c(0x258)][_0x452c9c(0x252)]);;const _0x5834d7=await master_shop[_0x452c9c(0x24a)]();console[_0x452c9c(0x250)](_0x452c9c(0x26b),_0x5834d7);const _0x4322a9=await product[_0x452c9c(0x24b)]({'name':_0x36662c});console['log'](_0x452c9c(0x278),_0x4322a9);const _0x59f2e2=await warehouse[_0x452c9c(0x2b0)]([{'$match':{'name':_0x153d2a}},{'$unwind':_0x452c9c(0x23d)},{'$match':{'product_details.product_name':_0x36662c}},{'$group':{'_id':_0x452c9c(0x2d8),'product_stock':{'$first':_0x452c9c(0x25c)}}}]);console[_0x452c9c(0x250)]('stock_data',_0x59f2e2),_0x39d27d[_0x452c9c(0x2d1)](0xc8)[_0x452c9c(0x263)]({'master':_0x5834d7,'new_product':_0x4322a9,'stock_data':_0x59f2e2});}catch(_0x3271bf){console[_0x452c9c(0x250)](_0x3271bf);}}),router[a0_0x4df440(0x28a)]('/view/add_sales',auth,async(_0x216904,_0x44feb4)=>{var _0xc78443=a0_0x4df440;try{const {invoice:_0x3a68b8,date:_0x296ea4,warehouse_name:_0x4bb2c0,product_name:_0x55f41c,stock:_0x1b3f59,quantity:_0x5a08f5,note:_0xe5e05d,room:_0x422398,primary_code:_0x49194e,secondary_code:_0x1ad45a,prod_code:_0x5f1b09,level:_0x211737,isle:_0x15ea78,pallet:_0x448c9c,batch_code:_0x35629f,SCRN:_0x37476f,expiry_date:_0x436ea3}=_0x216904[_0xc78443(0x258)];if(typeof _0x55f41c==_0xc78443(0x256))var _0x2935e0=[_0x216904['body'][_0xc78443(0x1f6)]],_0x535a54=[_0x216904[_0xc78443(0x258)][_0xc78443(0x22c)]],_0x39aa5f=[_0x216904[_0xc78443(0x258)]['carton']],_0x2566d8=[_0x216904['body'][_0xc78443(0x229)]],_0x4cab9c=[_0x216904[_0xc78443(0x258)][_0xc78443(0x243)]],_0x1b6def=[_0x216904['body'][_0xc78443(0x236)]],_0x4ec2b2=[_0x216904[_0xc78443(0x258)][_0xc78443(0x1f7)]],_0x182865=[_0x216904[_0xc78443(0x258)][_0xc78443(0x238)]],_0x5ab75b=[_0x216904[_0xc78443(0x258)][_0xc78443(0x299)]],_0x3eaa59=[_0x216904[_0xc78443(0x258)][_0xc78443(0x222)]],_0x1e785b=[_0x216904[_0xc78443(0x258)]['expiry_date']],_0xfeec4b=[_0x216904['body']['max_per_unit']],_0x5bc798=[_0x216904[_0xc78443(0x258)]['production_date']],_0xbb5a03=[_0x216904[_0xc78443(0x258)][_0xc78443(0x244)]],_0x5bb61d=[_0x216904[_0xc78443(0x258)][_0xc78443(0x289)]],_0x1d3f02=[_0x216904[_0xc78443(0x258)][_0xc78443(0x2f8)]],_0x3effca=[_0x216904[_0xc78443(0x258)][_0xc78443(0x2cd)]],_0x174c2c=[_0x216904[_0xc78443(0x258)][_0xc78443(0x261)]],_0x24ef74=[_0x216904[_0xc78443(0x258)][_0xc78443(0x25b)]],_0x36cecf=[_0x216904[_0xc78443(0x258)][_0xc78443(0x1e7)]],_0x59a100=[_0x216904[_0xc78443(0x258)][_0xc78443(0x284)]],_0x184c2d=[_0x216904[_0xc78443(0x258)][_0xc78443(0x2ca)]],_0xe65c07=[_0x216904[_0xc78443(0x258)][_0xc78443(0x23e)]];else var _0x2935e0=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x1f6)]],_0x535a54=[..._0x216904['body']['stock']],_0x39aa5f=[..._0x216904['body'][_0xc78443(0x2df)]],_0x2566d8=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x229)]],_0x4cab9c=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x243)]],_0x1b6def=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x236)]],_0x4ec2b2=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x1f7)]],_0x182865=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x238)]],_0x5ab75b=[..._0x216904['body'][_0xc78443(0x299)]],_0x3eaa59=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x222)]],_0x1e785b=[..._0x216904[_0xc78443(0x258)]['expiry_date']],_0xfeec4b=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x26f)]],_0x5bc798=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x2da)]],_0xbb5a03=[..._0x216904[_0xc78443(0x258)]['requested_qty']],_0x5bb61d=[..._0x216904['body'][_0xc78443(0x289)]],_0x1d3f02=[..._0x216904[_0xc78443(0x258)]['delivery_code']],_0x3effca=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x2cd)]],_0x174c2c=[..._0x216904['body'][_0xc78443(0x261)]],_0x24ef74=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x25b)]],_0x36cecf=[..._0x216904['body'][_0xc78443(0x1e7)]],_0x59a100=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x284)]],_0x184c2d=[..._0x216904['body']['actual_uom']],_0xe65c07=[..._0x216904[_0xc78443(0x258)][_0xc78443(0x23e)]];const _0x194079=_0x2935e0['map'](_0x21593e=>{return _0x21593e={'product_name':_0x21593e};});_0x535a54[_0xc78443(0x2fa)]((_0x285343,_0x1aad10)=>{var _0x3536d6=_0xc78443;_0x194079[_0x1aad10][_0x3536d6(0x22c)]=Math[_0x3536d6(0x221)](_0x285343);}),_0x59a100[_0xc78443(0x2fa)]((_0xad3bd1,_0x4846ea)=>{var _0x10706f=_0xc78443;_0x194079[_0x4846ea][_0x10706f(0x284)]=Math[_0x10706f(0x221)](_0xad3bd1);}),_0x184c2d[_0xc78443(0x2fa)]((_0x35431b,_0x51b3a1)=>{var _0x20eb4c=_0xc78443;_0x194079[_0x51b3a1][_0x20eb4c(0x2ca)]=_0x35431b;}),_0xe65c07[_0xc78443(0x2fa)]((_0x2bb8e9,_0x16f6c6)=>{_0x194079[_0x16f6c6]['id_transaction_from']=_0x2bb8e9;}),_0x39aa5f[_0xc78443(0x2fa)]((_0x57c280,_0x141bb5)=>{_0x194079[_0x141bb5]['quantity']=_0x57c280;}),_0x2566d8[_0xc78443(0x2fa)]((_0x1cf087,_0x5e543c)=>{var _0x54d060=_0xc78443;_0x194079[_0x5e543c][_0x54d060(0x229)]=_0x1cf087;}),_0x4cab9c[_0xc78443(0x2fa)]((_0x4dad99,_0x3b188c)=>{var _0x2cf7a0=_0xc78443;_0x194079[_0x3b188c][_0x2cf7a0(0x243)]=_0x4dad99;}),_0x1b6def['forEach']((_0x33ac87,_0x56fbaf)=>{var _0x3d30be=_0xc78443;_0x194079[_0x56fbaf][_0x3d30be(0x2f5)]=_0x33ac87;}),_0x4ec2b2['forEach']((_0x53e036,_0x348ec2)=>{var _0x53be87=_0xc78443;_0x24ef74[_0x53be87(0x2fa)]((_0x402e14,_0x271304)=>{var _0x3f29f7=_0x53be87;if(_0x402e14==_0x3f29f7(0x207)&&_0x348ec2==_0x271304){var _0x18ada0=_0x53e036['slice'](0x3);_0x194079[_0x348ec2][_0x3f29f7(0x2f0)]=_0x53e036[0x0],_0x194079[_0x348ec2]['rack']=_0x53e036[0x1],_0x194079[_0x348ec2]['bay']=0x0,_0x194079[_0x348ec2][_0x3f29f7(0x2d4)]=0x0,_0x194079[_0x348ec2]['type']='Floor',_0x194079[_0x348ec2][_0x3f29f7(0x280)]=_0x18ada0;}else{if(_0x402e14==_0x3f29f7(0x28e)&&_0x348ec2==_0x271304){var _0x18ada0=_0x53e036[_0x3f29f7(0x230)](0x3);_0x194079[_0x348ec2][_0x3f29f7(0x2f0)]=_0x53e036[0x0],_0x194079[_0x348ec2]['rack']=_0x53e036[0x1],_0x194079[_0x348ec2][_0x3f29f7(0x2ee)]=0x0,_0x194079[_0x348ec2][_0x3f29f7(0x2d4)]=0x0,_0x194079[_0x348ec2]['type']=_0x3f29f7(0x219),_0x194079[_0x348ec2][_0x3f29f7(0x280)]=_0x53e036[0x5];}else{if(_0x348ec2==_0x271304){var _0x58a3db;if(_0x53e036[0x4]=='L')_0x58a3db=_0x3f29f7(0x29b);else _0x53e036[0x4]=='F'&&(_0x58a3db='Floor');_0x194079[_0x348ec2][_0x3f29f7(0x2f0)]=_0x53e036[0x0],_0x194079[_0x348ec2][_0x3f29f7(0x2be)]=_0x53e036[0x1],_0x194079[_0x348ec2][_0x3f29f7(0x2ee)]=_0x53e036[0x2],_0x194079[_0x348ec2][_0x3f29f7(0x2d4)]=_0x53e036[0x3],_0x194079[_0x348ec2]['type']=_0x58a3db,_0x194079[_0x348ec2][_0x3f29f7(0x280)]=_0x53e036[0x5];}}}});}),_0x182865['forEach']((_0x14ee8e,_0xd66cf1)=>{var _0x38ae7e=_0xc78443;_0x194079[_0xd66cf1][_0x38ae7e(0x2b5)]=_0x14ee8e;}),_0x5ab75b[_0xc78443(0x2fa)]((_0x39f540,_0x1a2059)=>{var _0x70927b=_0xc78443;_0x194079[_0x1a2059][_0x70927b(0x299)]=_0x39f540;}),_0x3eaa59[_0xc78443(0x2fa)]((_0xaa48da,_0x58e938)=>{var _0x460e6f=_0xc78443;_0x194079[_0x58e938][_0x460e6f(0x222)]=_0xaa48da;}),_0x1e785b[_0xc78443(0x2fa)]((_0x301c73,_0x353b16)=>{var _0x4f746c=_0xc78443;_0x194079[_0x353b16][_0x4f746c(0x212)]=_0x301c73;}),_0xfeec4b[_0xc78443(0x2fa)]((_0x4cd9f5,_0x7659de)=>{var _0xfbe480=_0xc78443;_0x194079[_0x7659de][_0xfbe480(0x2a7)]=_0x4cd9f5;}),_0x5bc798[_0xc78443(0x2fa)]((_0x5052e2,_0xd90ada)=>{var _0x47640c=_0xc78443;_0x194079[_0xd90ada][_0x47640c(0x2da)]=_0x5052e2;}),_0xbb5a03[_0xc78443(0x2fa)]((_0x4f6d5f,_0x206f1b)=>{var _0x20910c=_0xc78443;_0x194079[_0x206f1b][_0x20910c(0x244)]=_0x4f6d5f;}),_0x5bb61d[_0xc78443(0x2fa)]((_0x37e3ac,_0x4cc0ac)=>{var _0xf2284b=_0xc78443;_0x194079[_0x4cc0ac][_0xf2284b(0x289)]=_0x37e3ac;}),_0x1d3f02['forEach']((_0x39b183,_0x4a69dc)=>{var _0xc4b2c5=_0xc78443;_0x194079[_0x4a69dc][_0xc4b2c5(0x2f8)]=_0x39b183;}),_0x3effca[_0xc78443(0x2fa)]((_0x1e9da6,_0x4efecb)=>{var _0x383945=_0xc78443;_0x194079[_0x4efecb][_0x383945(0x2cd)]=_0x1e9da6;}),_0x174c2c[_0xc78443(0x2fa)]((_0x1a8bc0,_0x53e224)=>{var _0x3d040b=_0xc78443;_0x194079[_0x53e224][_0x3d040b(0x2ab)]=_0x1a8bc0;}),_0x24ef74[_0xc78443(0x2fa)]((_0x421c24,_0x3c0939)=>{var _0x18eb85=_0xc78443;_0x194079[_0x3c0939][_0x18eb85(0x211)]=_0x421c24;}),_0x36cecf[_0xc78443(0x2fa)]((_0x2a85b4,_0x56c2cd)=>{_0x194079[_0x56c2cd]['invoice']=_0x2a85b4;});var _0x5418e2=0x0;_0x194079[_0xc78443(0x2fa)](_0xa748d2=>{var _0x569ef7=_0xc78443;(_0xa748d2[_0x569ef7(0x22c)]<_0xa748d2[_0x569ef7(0x2ab)]||_0xa748d2[_0x569ef7(0x2ab)]==0x0)&&(console[_0x569ef7(0x250)]('foreach\x20newproduct',_0xa748d2),_0x5418e2++);});const _0x576df3=_0x194079[_0xc78443(0x2b7)](_0x5e61a6=>_0x5e61a6['quantity']!=='0'&&_0x5e61a6['quantity']!==''),_0x23ba74=new sales({'invoice':_0x3a68b8,'customer':_0x216904['body'][_0xc78443(0x2f6)],'date':_0x296ea4,'warehouse_name':_0x4bb2c0,'sale_product':_0x576df3,'note':_0xe5e05d,'room':_0x422398,'primary_code':_0x49194e,'secondary_code':_0x1ad45a,'prod_code':_0x5f1b09,'SCRN':_0x37476f}),_0x4066cc=await _0x23ba74[_0xc78443(0x2e3)]();_0x216904[_0xc78443(0x242)](_0xc78443(0x2a0),_0xc78443(0x2ba)),_0x44feb4['redirect'](_0xc78443(0x26d)+_0x4066cc['_id']);}catch(_0x1d5c8b){console['log'](_0x1d5c8b);}}),router[a0_0x4df440(0x2e9)](a0_0x4df440(0x21c),auth,async(_0x1c27a3,_0x2ecaab)=>{var _0x55b966=a0_0x4df440;try{const {username:_0x3fe527,email:_0xfa4516,role:_0x262f29}=_0x1c27a3[_0x55b966(0x27a)],_0x414a4d=_0x1c27a3[_0x55b966(0x27a)],_0x33ce20=await profile['findOne']({'email':_0x414a4d[_0x55b966(0x266)]}),_0x3d98b7=await master_shop[_0x55b966(0x24a)](),_0x5a58c7=_0x1c27a3[_0x55b966(0x2cb)]['id'],_0x14e358=await sales[_0x55b966(0x2d0)](_0x5a58c7),_0x117455=await warehouse[_0x55b966(0x2b0)]([{'$match':{'name':_0x14e358[_0x55b966(0x283)]}},{'$unwind':_0x55b966(0x23d)},{'$group':{'_id':_0x55b966(0x220),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x55b966(0x2c4)},'bin':{'$first':_0x55b966(0x297)},'type':{'$first':_0x55b966(0x27c)},'floorlevel':{'$first':_0x55b966(0x2a2)},'primary_code':{'$first':_0x55b966(0x2ed)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x55b966(0x253)},'storage':{'$first':_0x55b966(0x2d7)},'rack':{'$first':_0x55b966(0x2ad)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x55b966(0x1fb)}}}]),_0x27209b=await customer['find']({});let _0x4233bb;if(_0x414a4d[_0x55b966(0x2dd)]==_0x55b966(0x22e)){const _0x32a4a7=await staff[_0x55b966(0x24b)]({'email':_0x414a4d[_0x55b966(0x266)]});_0x4233bb=await warehouse[_0x55b966(0x2b0)]([{'$match':{'status':_0x55b966(0x27b),'name':_0x32a4a7[_0x55b966(0x2a9)]}},{'$group':{'_id':'$name','name':{'$first':_0x55b966(0x22a)}}}]);}else _0x4233bb=await warehouse[_0x55b966(0x2b0)]([{'$match':{'status':_0x55b966(0x27b)}},{'$group':{'_id':_0x55b966(0x22a),'name':{'$first':_0x55b966(0x22a)}}}]);const _0x4188b6=await product[_0x55b966(0x24a)]({}),_0x57d3e3=await suppliers[_0x55b966(0x24a)]({});if(_0x3d98b7[0x0][_0x55b966(0x23f)]==_0x55b966(0x2a5)){var _0x3adb90=users[_0x55b966(0x2d3)];console[_0x55b966(0x250)](_0x3adb90);}else{if(_0x3d98b7[0x0]['language']==_0x55b966(0x21d))var _0x3adb90=users[_0x55b966(0x21d)];else{if(_0x3d98b7[0x0]['language']==_0x55b966(0x216))var _0x3adb90=users['German'];else{if(_0x3d98b7[0x0][_0x55b966(0x23f)]=='Spanish')var _0x3adb90=users['Spanish'];else{if(_0x3d98b7[0x0][_0x55b966(0x23f)]==_0x55b966(0x26e))var _0x3adb90=users['French'];else{if(_0x3d98b7[0x0]['language']==_0x55b966(0x260))var _0x3adb90=users[_0x55b966(0x1f2)];else{if(_0x3d98b7[0x0][_0x55b966(0x23f)]==_0x55b966(0x285))var _0x3adb90=users[_0x55b966(0x285)];else{if(_0x3d98b7[0x0]['language']==_0x55b966(0x290))var _0x3adb90=users[_0x55b966(0x1ef)];}}}}}}}_0x2ecaab[_0x55b966(0x2eb)](_0x55b966(0x267),{'success':_0x1c27a3[_0x55b966(0x242)](_0x55b966(0x2a0)),'errors':_0x1c27a3[_0x55b966(0x242)](_0x55b966(0x24c)),'role':_0x414a4d,'profile':_0x33ce20,'customer':_0x27209b,'warehouse':_0x4233bb,'product':_0x117455,'user':_0x14e358,'master_shop':_0x3d98b7,'unit':_0x4188b6,'language':_0x3adb90,'suppliers':_0x57d3e3});}catch(_0x4b5c07){console[_0x55b966(0x250)](_0x4b5c07);}}),router[a0_0x4df440(0x28a)](a0_0x4df440(0x21c),auth,async(_0x3517a8,_0x463c76)=>{var _0x20565f=a0_0x4df440;try{const _0x1249d7=_0x3517a8[_0x20565f(0x2cb)]['id'],{invoice:_0x584b31,warehouse_name:_0xe434e2,room:_0x285aa2}=_0x3517a8[_0x20565f(0x258)],_0x3166cb=await sales[_0x20565f(0x24b)]({'invoice':_0x584b31}),_0x876801=_0x3166cb[_0x20565f(0x20b)]['map'](async _0x56bb4d=>{var _0x52ed42=_0x20565f,_0x39f3ad=await warehouse[_0x52ed42(0x24b)]({'name':_0xe434e2,'room':_0x56bb4d['room_name'],'warehouse_category':_0x52ed42(0x206)});const _0x1fff43=_0x39f3ad[_0x52ed42(0x254)][_0x52ed42(0x2e1)](_0x882648=>{var _0x138d3d=_0x52ed42;_0x882648[_0x138d3d(0x1f6)]==_0x56bb4d['product_name']&&_0x882648[_0x138d3d(0x280)]==_0x56bb4d[_0x138d3d(0x280)]&&_0x882648[_0x138d3d(0x249)]==_0x56bb4d[_0x138d3d(0x249)]&&_0x882648['bin']==_0x56bb4d[_0x138d3d(0x2d4)]&&_0x882648[_0x138d3d(0x2ee)]==_0x56bb4d['bay']&&_0x882648[_0x138d3d(0x2be)]==_0x56bb4d[_0x138d3d(0x2be)]&&_0x882648[_0x138d3d(0x2f0)]==_0x56bb4d[_0x138d3d(0x2f0)]&&_0x882648[_0x138d3d(0x212)]==_0x56bb4d[_0x138d3d(0x212)]&&_0x882648['batch_code']==_0x56bb4d[_0x138d3d(0x222)]&&_0x882648[_0x138d3d(0x1e8)]==_0x56bb4d['invoice']&&_0x882648[_0x138d3d(0x201)]==_0x56bb4d[_0x138d3d(0x1e6)]&&(_0x882648['product_stock']=Math[_0x138d3d(0x2c5)](0x0,Math[_0x138d3d(0x221)](_0x882648[_0x138d3d(0x2e7)])-Math[_0x138d3d(0x221)](_0x56bb4d[_0x138d3d(0x261)])));});return _0x39f3ad;});Promise[_0x20565f(0x233)](_0x876801)[_0x20565f(0x246)](async _0x8461b6=>{var _0x4bc4f0=_0x20565f;try{for(const _0x2f0f28 of _0x8461b6){await _0x2f0f28[_0x4bc4f0(0x2e3)]();}_0x3166cb[_0x4bc4f0(0x2c7)]=_0x4bc4f0(0x2b8);const _0x3ecce2=await _0x3166cb[_0x4bc4f0(0x2e3)](),_0x1ba11e=await master_shop[_0x4bc4f0(0x24a)](),_0x365e49=await email_settings['findOne'](),_0xb7bd1e=await supervisor_settings[_0x4bc4f0(0x24a)]();var _0x4eaede=_0x3166cb[_0x4bc4f0(0x20b)],_0x582a97='',_0x46e509;for(_0x46e509 in _0x4eaede){_0x582a97+='<tr>'+_0x4bc4f0(0x22f)+_0x4eaede[_0x46e509][_0x4bc4f0(0x1f6)]+_0x4bc4f0(0x227)+_0x4bc4f0(0x22f)+_0x4eaede[_0x46e509][_0x4bc4f0(0x2f5)]+_0x4bc4f0(0x227)+_0x4bc4f0(0x22f)+_0x4eaede[_0x46e509]['quantity']+_0x4bc4f0(0x227)+_0x4bc4f0(0x22f)+_0x4eaede[_0x46e509][_0x4bc4f0(0x2b5)]+_0x4bc4f0(0x227)+_0x4bc4f0(0x22f)+_0x4eaede[_0x46e509][_0x4bc4f0(0x299)]+_0x4bc4f0(0x227)+_0x4bc4f0(0x22f)+_0x3166cb[_0x4bc4f0(0x283)]+_0x4bc4f0(0x227)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4eaede[_0x46e509]['room_name']+_0x4bc4f0(0x227)+_0x4bc4f0(0x22f)+_0x4eaede[_0x46e509][_0x4bc4f0(0x2f0)]+_0x4eaede[_0x46e509][_0x4bc4f0(0x2be)]+_0x4eaede[_0x46e509][_0x4bc4f0(0x2ee)]+_0x4eaede[_0x46e509][_0x4bc4f0(0x2d4)]+_0x4eaede[_0x46e509][_0x4bc4f0(0x249)][0x0]+_0x4eaede[_0x46e509][_0x4bc4f0(0x280)]+_0x4bc4f0(0x227),_0x4bc4f0(0x295);}let _0x36b583=nodemailer['createTransport']({'host':_0x365e49[_0x4bc4f0(0x217)],'port':Number(_0x365e49[_0x4bc4f0(0x23a)]),'secure':![],'auth':{'user':_0x365e49[_0x4bc4f0(0x266)],'pass':_0x365e49['password']}}),_0x98819e={'from':_0x365e49[_0x4bc4f0(0x266)],'to':_0xb7bd1e[0x0][_0x4bc4f0(0x2f4)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x4bc4f0(0x265),'path':__dirname+_0x4bc4f0(0x2bf)+_0x4bc4f0(0x2bd)+_0x1ba11e[0x0][_0x4bc4f0(0x208)],'cid':_0x4bc4f0(0x281)}],'html':_0x4bc4f0(0x22d)+_0x4bc4f0(0x1eb)+_0x4bc4f0(0x2a8)+_0x4bc4f0(0x239)+_0x4bc4f0(0x21b)+_0x4bc4f0(0x239)+_0x4bc4f0(0x24d)+'</div>'+_0x4bc4f0(0x239)+_0x4bc4f0(0x272)+_0x1ba11e[0x0][_0x4bc4f0(0x237)]+_0x4bc4f0(0x202)+_0x4bc4f0(0x251)+'</div>'+_0x4bc4f0(0x224)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x3166cb[_0x4bc4f0(0x1e8)]+'\x20'+_0x4bc4f0(0x276)+'\x20Order\x20Date\x20:\x20'+_0x3166cb[_0x4bc4f0(0x203)]+'\x20'+_0x4bc4f0(0x1ed)+_0x4bc4f0(0x234)+_0x4bc4f0(0x251)+_0x4bc4f0(0x264)+_0x4bc4f0(0x255)+_0x4bc4f0(0x2c2)+_0x4bc4f0(0x268)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4bc4f0(0x2e5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4bc4f0(0x1e5)+_0x4bc4f0(0x2c6)+_0x4bc4f0(0x2e8)+_0x4bc4f0(0x2cf)+_0x4bc4f0(0x295)+_0x4bc4f0(0x228)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x582a97+'\x20'+_0x4bc4f0(0x2e2)+'</table>'+_0x4bc4f0(0x239)+_0x4bc4f0(0x271)+'<h5>'+_0x1ba11e[0x0][_0x4bc4f0(0x237)]+_0x4bc4f0(0x234)+_0x4bc4f0(0x251)+_0x4bc4f0(0x251)+_0x4bc4f0(0x226)};_0x36b583['sendMail'](_0x98819e,function(_0x31fc0b,_0x3c9bba){var _0x100a91=_0x4bc4f0;_0x31fc0b?(console[_0x100a91(0x250)](_0x31fc0b),console[_0x100a91(0x250)](_0x100a91(0x262))):console['log'](_0x100a91(0x1f3));}),_0x3517a8[_0x4bc4f0(0x242)]('success',_0x4bc4f0(0x2af)),_0x463c76['redirect']('/all_sales/preview/'+_0x1249d7);}catch(_0x35d5ab){console[_0x4bc4f0(0x2b1)](_0x35d5ab),_0x463c76[_0x4bc4f0(0x2d1)](0x1f4)['json']({'error':_0x4bc4f0(0x257)});}})['catch'](_0xd970f8=>{var _0x52ce78=_0x20565f;console['error'](_0xd970f8),_0x463c76[_0x52ce78(0x2d1)](0x1f4)[_0x52ce78(0x263)]({'error':_0x52ce78(0x231)});});}catch(_0x30fe1e){console['log'](_0x30fe1e);}}),router[a0_0x4df440(0x2e9)](a0_0x4df440(0x248),auth,async(_0x4190a7,_0x546c5b)=>{var _0x274b57=a0_0x4df440;try{const {username:_0x150cfa,email:_0x246adc,role:_0x477e05}=_0x4190a7['user'],_0x3cf405=_0x4190a7[_0x274b57(0x27a)],_0x391cee=await profile[_0x274b57(0x24b)]({'email':_0x3cf405[_0x274b57(0x266)]}),_0x3e18f8=await master_shop[_0x274b57(0x24a)](),_0x246756=_0x4190a7[_0x274b57(0x2cb)]['id'],_0x5f1bb6=await sales[_0x274b57(0x2d0)](_0x246756);var _0x433fdf=[_0x274b57(0x21a),'Enclosed'];const _0xc403f=await warehouse[_0x274b57(0x2b0)]([{'$match':{'name':_0x5f1bb6[_0x274b57(0x283)],'warehouse_category':_0x274b57(0x206)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x274b57(0x220),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x274b57(0x25c)},'bay':{'$first':_0x274b57(0x2c4)},'bin':{'$first':_0x274b57(0x297)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x274b57(0x2a2)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x274b57(0x273)},'product_code':{'$first':_0x274b57(0x253)},'storage':{'$first':_0x274b57(0x2d7)},'rack':{'$first':_0x274b57(0x2ad)}}}]),_0x76cd64=await customer[_0x274b57(0x24a)]({});let _0x4ee385;if(_0x3cf405[_0x274b57(0x2dd)]=='staff'){const _0x2e5174=await staff['findOne']({'email':_0x3cf405[_0x274b57(0x266)]});_0x4ee385=await warehouse[_0x274b57(0x2b0)]([{'$match':{'status':_0x274b57(0x27b),'name':_0x2e5174[_0x274b57(0x2a9)],'warehouse_category':_0x274b57(0x206)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x4ee385=await warehouse[_0x274b57(0x2b0)]([{'$match':{'status':_0x274b57(0x27b),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x274b57(0x22a),'name':{'$first':_0x274b57(0x22a)}}}]);const _0x2c8224=await product[_0x274b57(0x24a)]({});if(_0x3e18f8[0x0][_0x274b57(0x23f)]=='English\x20(US)'){var _0x31f0f5=users[_0x274b57(0x2d3)];console['log'](_0x31f0f5);}else{if(_0x3e18f8[0x0][_0x274b57(0x23f)]==_0x274b57(0x21d))var _0x31f0f5=users[_0x274b57(0x21d)];else{if(_0x3e18f8[0x0]['language']==_0x274b57(0x216))var _0x31f0f5=users['German'];else{if(_0x3e18f8[0x0][_0x274b57(0x23f)]==_0x274b57(0x275))var _0x31f0f5=users[_0x274b57(0x275)];else{if(_0x3e18f8[0x0]['language']==_0x274b57(0x26e))var _0x31f0f5=users[_0x274b57(0x26e)];else{if(_0x3e18f8[0x0][_0x274b57(0x23f)]==_0x274b57(0x260))var _0x31f0f5=users[_0x274b57(0x1f2)];else{if(_0x3e18f8[0x0][_0x274b57(0x23f)]=='Chinese')var _0x31f0f5=users[_0x274b57(0x285)];else{if(_0x3e18f8[0x0][_0x274b57(0x23f)]=='Arabic\x20(ae)')var _0x31f0f5=users['Arabic'];}}}}}}}_0x546c5b[_0x274b57(0x2eb)]('edit_sales',{'success':_0x4190a7[_0x274b57(0x242)]('success'),'errors':_0x4190a7[_0x274b57(0x242)](_0x274b57(0x24c)),'role':_0x3cf405,'profile':_0x391cee,'customer':_0x76cd64,'warehouse':_0x4ee385,'product':_0xc403f,'user':_0x5f1bb6,'master_shop':_0x3e18f8,'unit':_0x2c8224,'language':_0x31f0f5});}catch(_0x314cdd){console[_0x274b57(0x250)](_0x314cdd);}}),router[a0_0x4df440(0x28a)]('/view/:id',auth,async(_0x176d80,_0x3d0425)=>{var _0x4453c2=a0_0x4df440;try{const _0x5df31b=_0x176d80['params']['id'],_0x24cc80=await sales['findOne']({'_id':_0x176d80['params']['id']}),_0x11ba70=await warehouse[_0x4453c2(0x24b)]({'name':_0x24cc80['warehouse_name'],'room':_0x176d80[_0x4453c2(0x258)]['room']}),{invoice:_0x50c016,date:_0x2c178b,warehouse_name:_0x5e4f9a,product_name:_0x5c7a10,stock:_0x297207,quantity:_0x43589c,note:_0x5a8b30,room:_0x3efa1b,customer:_0x498214,SCRN:_0x2b7916}=_0x176d80[_0x4453c2(0x258)];if(typeof _0x5c7a10==_0x4453c2(0x256))var _0x4f5e88=[_0x176d80[_0x4453c2(0x258)]['product_name']],_0x5e4ce7=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x22c)]],_0x7e113c=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x2df)]],_0x3c715c=[_0x176d80['body'][_0x4453c2(0x229)]],_0x249312=[_0x176d80['body'][_0x4453c2(0x243)]],_0x55e5cb=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x236)]],_0xfeae7=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x1f7)]],_0x59cd11=[_0x176d80['body'][_0x4453c2(0x238)]],_0x5b70d5=[_0x176d80['body'][_0x4453c2(0x299)]],_0x434004=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x222)]],_0xa72e84=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x212)]],_0x5c291e=[_0x176d80[_0x4453c2(0x258)]['max_per_unit']],_0x161aa8=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x2da)]],_0x12a455=[_0x176d80[_0x4453c2(0x258)]['requested_qty']],_0x1a7bb6=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x289)]],_0x310401=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x2f8)]],_0x50272a=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x2cd)]],_0xfecae5=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x261)]],_0x207871=[_0x176d80[_0x4453c2(0x258)][_0x4453c2(0x25b)]];else var _0x4f5e88=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x1f6)]],_0x5e4ce7=[..._0x176d80[_0x4453c2(0x258)]['stock']],_0x7e113c=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x2df)]],_0x3c715c=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x229)]],_0x249312=[..._0x176d80['body'][_0x4453c2(0x243)]],_0x55e5cb=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x236)]],_0xfeae7=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x1f7)]],_0x59cd11=[..._0x176d80['body'][_0x4453c2(0x238)]],_0x5b70d5=[..._0x176d80['body'][_0x4453c2(0x299)]],_0x434004=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x222)]],_0xa72e84=[..._0x176d80['body'][_0x4453c2(0x212)]],_0x5c291e=[..._0x176d80['body'][_0x4453c2(0x26f)]],_0x161aa8=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x2da)]],_0x12a455=[..._0x176d80[_0x4453c2(0x258)]['requested_qty']],_0x1a7bb6=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x289)]],_0x310401=[..._0x176d80[_0x4453c2(0x258)]['delivery_code']],_0x50272a=[..._0x176d80['body'][_0x4453c2(0x2cd)]],_0xfecae5=[..._0x176d80[_0x4453c2(0x258)][_0x4453c2(0x261)]],_0x207871=[..._0x176d80['body'][_0x4453c2(0x25b)]];const _0x3699b4=_0x4f5e88[_0x4453c2(0x2e1)](_0x4054bf=>{return _0x4054bf={'product_name':_0x4054bf};});_0x5e4ce7[_0x4453c2(0x2fa)]((_0x5f3a9f,_0x4b30ed)=>{var _0x3f9d38=_0x4453c2;_0x3699b4[_0x4b30ed][_0x3f9d38(0x22c)]=Math[_0x3f9d38(0x221)](_0x5f3a9f);}),_0x7e113c[_0x4453c2(0x2fa)]((_0x1db040,_0x1db737)=>{var _0x1ecc83=_0x4453c2;_0x3699b4[_0x1db737][_0x1ecc83(0x261)]=_0x1db040;}),_0x3c715c['forEach']((_0x63c108,_0x4fc08e)=>{var _0x27752a=_0x4453c2;_0x3699b4[_0x4fc08e][_0x27752a(0x229)]=_0x63c108;}),_0x249312[_0x4453c2(0x2fa)]((_0x386d4a,_0x1ded23)=>{_0x3699b4[_0x1ded23]['secondary_code']=_0x386d4a;}),_0x55e5cb[_0x4453c2(0x2fa)]((_0x54d6d7,_0x2255a5)=>{var _0x230e8d=_0x4453c2;_0x3699b4[_0x2255a5][_0x230e8d(0x2f5)]=_0x54d6d7;}),_0xfeae7['forEach']((_0x40c818,_0x1f81cb)=>{var _0x434ff5=_0x4453c2;_0x207871[_0x434ff5(0x2fa)]((_0x55b8d6,_0x489b30)=>{var _0xed89c9=_0x434ff5;if(_0x55b8d6==_0xed89c9(0x207)&&_0x1f81cb==_0x489b30){var _0x57ff0c=_0x40c818['slice'](0x3);_0x3699b4[_0x1f81cb][_0xed89c9(0x2f0)]=_0x40c818[0x0],_0x3699b4[_0x1f81cb][_0xed89c9(0x2be)]=_0x40c818[0x1],_0x3699b4[_0x1f81cb][_0xed89c9(0x2ee)]=0x0,_0x3699b4[_0x1f81cb][_0xed89c9(0x2d4)]=0x0,_0x3699b4[_0x1f81cb][_0xed89c9(0x249)]=_0xed89c9(0x219),_0x3699b4[_0x1f81cb][_0xed89c9(0x280)]=_0x57ff0c;}else{if(_0x55b8d6==_0xed89c9(0x28e)&&_0x1f81cb==_0x489b30){var _0x57ff0c=_0x40c818[_0xed89c9(0x230)](0x3);_0x3699b4[_0x1f81cb][_0xed89c9(0x2f0)]=_0x40c818[0x0],_0x3699b4[_0x1f81cb][_0xed89c9(0x2be)]=_0x40c818[0x1],_0x3699b4[_0x1f81cb][_0xed89c9(0x2ee)]=0x0,_0x3699b4[_0x1f81cb][_0xed89c9(0x2d4)]=0x0,_0x3699b4[_0x1f81cb]['type']=_0xed89c9(0x219),_0x3699b4[_0x1f81cb][_0xed89c9(0x280)]=_0x40c818[0x5];}else{if(_0x1f81cb==_0x489b30){var _0x455e13;if(_0x40c818[0x4]=='L')_0x455e13=_0xed89c9(0x29b);else _0x40c818[0x4]=='F'&&(_0x455e13=_0xed89c9(0x219));_0x3699b4[_0x1f81cb][_0xed89c9(0x2f0)]=_0x40c818[0x0],_0x3699b4[_0x1f81cb]['rack']=_0x40c818[0x1],_0x3699b4[_0x1f81cb][_0xed89c9(0x2ee)]=_0x40c818[0x2],_0x3699b4[_0x1f81cb][_0xed89c9(0x2d4)]=_0x40c818[0x3],_0x3699b4[_0x1f81cb]['type']=_0x455e13,_0x3699b4[_0x1f81cb]['floorlevel']=_0x40c818[0x5];}}}});}),_0x59cd11[_0x4453c2(0x2fa)]((_0x3b055f,_0x21f2a5)=>{_0x3699b4[_0x21f2a5]['unit']=_0x3b055f;}),_0x5b70d5[_0x4453c2(0x2fa)]((_0x255d7b,_0x2f72f6)=>{var _0x5c2582=_0x4453c2;_0x3699b4[_0x2f72f6][_0x5c2582(0x299)]=_0x255d7b;}),_0x434004['forEach']((_0x45ab7d,_0x4180be)=>{var _0x57c9e1=_0x4453c2;_0x3699b4[_0x4180be][_0x57c9e1(0x222)]=_0x45ab7d;}),_0xa72e84[_0x4453c2(0x2fa)]((_0x53ed91,_0x244a12)=>{_0x3699b4[_0x244a12]['expiry_date']=_0x53ed91;}),_0x5c291e[_0x4453c2(0x2fa)]((_0x351ca7,_0x37186d)=>{var _0x1fc3b9=_0x4453c2;_0x3699b4[_0x37186d][_0x1fc3b9(0x2a7)]=_0x351ca7;}),_0x161aa8[_0x4453c2(0x2fa)]((_0xc70e7,_0x3d4584)=>{_0x3699b4[_0x3d4584]['production_date']=_0xc70e7;}),_0x12a455[_0x4453c2(0x2fa)]((_0x128a30,_0x314832)=>{var _0x58d517=_0x4453c2;_0x3699b4[_0x314832][_0x58d517(0x244)]=Math[_0x58d517(0x221)](_0x128a30);}),_0x1a7bb6['forEach']((_0x5e0290,_0x5e6e1c)=>{var _0x103eb8=_0x4453c2;_0x3699b4[_0x5e6e1c][_0x103eb8(0x289)]=_0x5e0290;}),_0x310401[_0x4453c2(0x2fa)]((_0x26ce98,_0x43d996)=>{_0x3699b4[_0x43d996]['delivery_code']=_0x26ce98;}),_0x50272a['forEach']((_0x76c9b1,_0x2cb883)=>{var _0x535bd4=_0x4453c2;_0x3699b4[_0x2cb883][_0x535bd4(0x2cd)]=_0x76c9b1;}),_0xfecae5[_0x4453c2(0x2fa)]((_0x3699c4,_0x37e08a)=>{var _0x330109=_0x4453c2;_0x3699b4[_0x37e08a][_0x330109(0x2ab)]=_0x3699c4;}),_0x207871['forEach']((_0xa863b9,_0x39dd29)=>{var _0x922146=_0x4453c2;_0x3699b4[_0x39dd29][_0x922146(0x211)]=_0xa863b9;});var _0x345f94=0x0;_0x3699b4[_0x4453c2(0x2fa)](_0x4c7dbd=>{var _0x1f35d8=_0x4453c2;console['log']('foreach\x20newproduct',_0x4c7dbd),(parseInt(_0x4c7dbd[_0x1f35d8(0x22c)])<parseInt(_0x4c7dbd[_0x1f35d8(0x261)])||parseInt(_0x4c7dbd[_0x1f35d8(0x261)])==0x0)&&_0x345f94++;});if(_0x345f94!=0x0)return _0x176d80['flash'](_0x4453c2(0x24c),_0x4453c2(0x240)),_0x3d0425[_0x4453c2(0x26c)](_0x4453c2(0x292));const _0x501e08=_0x3699b4[_0x4453c2(0x2b7)](_0x232c4b=>_0x232c4b[_0x4453c2(0x261)]!=='0'&&_0x232c4b[_0x4453c2(0x261)]!=='');_0x24cc80['invoice']=_0x50c016,_0x24cc80[_0x4453c2(0x2f6)]=_0x498214,_0x24cc80[_0x4453c2(0x203)]=_0x2c178b,_0x24cc80['warehouse_name']=_0x5e4f9a,_0x24cc80['sale_product']=_0x501e08,_0x24cc80[_0x4453c2(0x2e4)]=_0x5a8b30,_0x24cc80[_0x4453c2(0x25e)]=_0x2b7916,_0x24cc80[_0x4453c2(0x2c7)]=_0x4453c2(0x2f9),_0x24cc80[_0x4453c2(0x245)]='False';const _0x36d362=await _0x24cc80['save']();_0x176d80['flash'](_0x4453c2(0x2a0),_0x4453c2(0x2af)),_0x3d0425['redirect'](_0x4453c2(0x259));}catch(_0x1e03ad){console[_0x4453c2(0x250)](_0x1e03ad);}}),router[a0_0x4df440(0x28a)]('/give_payment/:id',auth,async(_0x50f9ae,_0x245da1)=>{var _0x141422=a0_0x4df440;try{const _0x185d3c=_0x50f9ae[_0x141422(0x2cb)]['id'],{invoice:_0x25c2cf,customer:_0x5ae753,receivable_amount:_0x2c2fbd,received_amount:_0x41d817}=_0x50f9ae[_0x141422(0x258)],_0x23da71=await sales[_0x141422(0x2d0)](_0x185d3c);console[_0x141422(0x250)](_0x23da71);var _0x55a277=_0x2c2fbd-_0x41d817;console[_0x141422(0x250)](_0x41d817),_0x23da71[_0x141422(0x2f1)]=parseFloat(_0x41d817)+parseFloat(_0x23da71[_0x141422(0x2f1)]),_0x23da71['due_amount']=_0x55a277,console[_0x141422(0x250)](_0x23da71);const _0x1a6ff7=await _0x23da71[_0x141422(0x2e3)](),_0x7cb82a=await c_payment_data['findOne']({'invoice':_0x25c2cf});_0x7cb82a[_0x141422(0x27d)]=_0x55a277,await _0x7cb82a['save']();let _0x2aa098=new Date(),_0x5277b5=('0'+_0x2aa098['getDate']())[_0x141422(0x230)](-0x2),_0x42245c=('0'+(_0x2aa098[_0x141422(0x20c)]()+0x1))['slice'](-0x2),_0x218ada=_0x2aa098[_0x141422(0x1f9)](),_0x31f4e2=_0x218ada+'-'+_0x42245c+'-'+_0x5277b5;const _0x3d7609=new customer_payment({'invoice':_0x25c2cf,'date':_0x218ada+'-'+_0x42245c+'-'+_0x5277b5,'customer':_0x5ae753,'reason':_0x141422(0x279),'amount':_0x41d817}),_0x43616c=await _0x3d7609[_0x141422(0x2e3)]();_0x50f9ae['flash']('success',_0x141422(0x293)),_0x245da1['redirect'](_0x141422(0x259));}catch(_0x72989b){console[_0x141422(0x250)](_0x72989b);}}),router[a0_0x4df440(0x2e9)](a0_0x4df440(0x287),auth,async(_0x574985,_0x4b0baf)=>{var _0x13dfce=a0_0x4df440;try{const {username:_0x57c790,email:_0x301ae2,role:_0x4dfeaa}=_0x574985[_0x13dfce(0x27a)],_0x71c8f0=_0x574985[_0x13dfce(0x27a)],_0x1ca5a8=await profile['findOne']({'email':_0x71c8f0[_0x13dfce(0x266)]}),_0x59e4fd=await master_shop['find']();console[_0x13dfce(0x250)](_0x13dfce(0x26b),_0x59e4fd);const _0x5bfaf5=_0x574985[_0x13dfce(0x2cb)]['id'],_0x404deb=await sales[_0x13dfce(0x2d0)](_0x5bfaf5);console['log'](_0x404deb);const _0x500271=await customer[_0x13dfce(0x24b)]({'name':_0x404deb[_0x13dfce(0x2f6)]});console[_0x13dfce(0x250)](_0x500271);if(_0x59e4fd[0x0]['language']==_0x13dfce(0x2a5)){var _0x46b086=users[_0x13dfce(0x2d3)];console[_0x13dfce(0x250)](_0x46b086);}else{if(_0x59e4fd[0x0]['language']==_0x13dfce(0x21d))var _0x46b086=users[_0x13dfce(0x21d)];else{if(_0x59e4fd[0x0][_0x13dfce(0x23f)]==_0x13dfce(0x216))var _0x46b086=users[_0x13dfce(0x216)];else{if(_0x59e4fd[0x0][_0x13dfce(0x23f)]=='Spanish')var _0x46b086=users[_0x13dfce(0x275)];else{if(_0x59e4fd[0x0][_0x13dfce(0x23f)]=='French')var _0x46b086=users[_0x13dfce(0x26e)];else{if(_0x59e4fd[0x0][_0x13dfce(0x23f)]=='Portuguese\x20(BR)')var _0x46b086=users[_0x13dfce(0x1f2)];else{if(_0x59e4fd[0x0][_0x13dfce(0x23f)]=='Chinese')var _0x46b086=users[_0x13dfce(0x285)];else{if(_0x59e4fd[0x0][_0x13dfce(0x23f)]==_0x13dfce(0x290))var _0x46b086=users['Arabic'];}}}}}}}_0x4b0baf[_0x13dfce(0x2eb)]('sales_invoice',{'success':_0x574985[_0x13dfce(0x242)]('success'),'errors':_0x574985[_0x13dfce(0x242)](_0x13dfce(0x24c)),'role':_0x71c8f0,'profile':_0x1ca5a8,'master_shop':_0x59e4fd,'customers':_0x500271,'sales':_0x404deb,'language':_0x46b086});}catch(_0x556992){console[_0x13dfce(0x250)](_0x556992);}}),router[a0_0x4df440(0x2e9)](a0_0x4df440(0x205),auth,async(_0x17de1a,_0x51f30e)=>{var _0x2d2667=a0_0x4df440;try{const {username:_0x5e150d,email:_0x3d2a3a,role:_0x43218e}=_0x17de1a[_0x2d2667(0x27a)],_0x23325b=_0x17de1a[_0x2d2667(0x27a)],_0x5dc8ad=await profile[_0x2d2667(0x24b)]({'email':_0x23325b[_0x2d2667(0x266)]}),_0x274557=await master_shop['find']();console[_0x2d2667(0x250)](_0x2d2667(0x26b),_0x274557);const _0x33bacc=_0x17de1a[_0x2d2667(0x2cb)]['id'];console[_0x2d2667(0x250)](_0x33bacc);const _0x36298c=await sales[_0x2d2667(0x2d0)](_0x33bacc);console[_0x2d2667(0x250)](_0x2d2667(0x200),_0x36298c);const _0x4c2b42=await warehouse['aggregate']([{'$match':{'name':_0x2d2667(0x1ec),'room':_0x2d2667(0x2b2)}},{'$unwind':_0x2d2667(0x23d)},{'$group':{'_id':_0x2d2667(0x220),'name':{'$first':_0x2d2667(0x2d8)},'product_stock':{'$first':_0x2d2667(0x25c)},'level':{'$first':_0x2d2667(0x2d2)},'isle':{'$first':_0x2d2667(0x294)},'pallet':{'$first':_0x2d2667(0x20f)},'primary_code':{'$first':_0x2d2667(0x2ed)},'secondary_code':{'$first':_0x2d2667(0x273)},'product_code':{'$first':_0x2d2667(0x253)}}}]);console[_0x2d2667(0x250)]('stock_data',_0x4c2b42);const _0x4f72fe=await product[_0x2d2667(0x24a)]({});warehouse_data=await warehouse[_0x2d2667(0x2b0)]([{'$match':{'status':_0x2d2667(0x27b),'name':_0x2d2667(0x1ec),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2d2667(0x22a),'name':{'$first':_0x2d2667(0x22a)}}},{'$sort':{'name':0x1}}]);var _0x5e458a=[_0x2d2667(0x2b2)];if(_0x274557[0x0][_0x2d2667(0x23f)]==_0x2d2667(0x2a5)){var _0x48e5ad=users[_0x2d2667(0x2d3)];console['log'](_0x48e5ad);}else{if(_0x274557[0x0]['language']==_0x2d2667(0x21d))var _0x48e5ad=users[_0x2d2667(0x21d)];else{if(_0x274557[0x0][_0x2d2667(0x23f)]==_0x2d2667(0x216))var _0x48e5ad=users[_0x2d2667(0x216)];else{if(_0x274557[0x0]['language']==_0x2d2667(0x275))var _0x48e5ad=users['Spanish'];else{if(_0x274557[0x0][_0x2d2667(0x23f)]==_0x2d2667(0x26e))var _0x48e5ad=users['French'];else{if(_0x274557[0x0][_0x2d2667(0x23f)]=='Portuguese\x20(BR)')var _0x48e5ad=users['Portuguese'];else{if(_0x274557[0x0]['language']==_0x2d2667(0x285))var _0x48e5ad=users['Chinese'];else{if(_0x274557[0x0][_0x2d2667(0x23f)]==_0x2d2667(0x290))var _0x48e5ad=users[_0x2d2667(0x1ef)];}}}}}}}_0x51f30e['render'](_0x2d2667(0x29c),{'success':_0x17de1a['flash'](_0x2d2667(0x2a0)),'errors':_0x17de1a[_0x2d2667(0x242)](_0x2d2667(0x24c)),'role':_0x23325b,'profile':_0x5dc8ad,'user':_0x36298c,'stock':_0x4c2b42,'master_shop':_0x274557,'unit':_0x4f72fe,'language':_0x48e5ad,'warehouses':warehouse_data,'rooms':_0x5e458a});}catch(_0x4ad295){console[_0x2d2667(0x250)](_0x4ad295),_0x51f30e[_0x2d2667(0x2d1)](0xc8)[_0x2d2667(0x263)]({'message':_0x4ad295[_0x2d2667(0x1f8)]});}}),router['post'](a0_0x4df440(0x205),auth,async(_0x453fcc,_0x47ee42)=>{var _0x3ce4dc=a0_0x4df440;try{const {invoice:_0x30bf5c,date:_0x214700,warehouse_name:_0xe3a200,product_name:_0x375644,primary_code:_0x19605e,secondary_code:_0x5f2488,product_code:_0xbe1ffb,sales_quantity:_0x30572e,stocks:_0x570691,return_qty:_0x379106,Room_name:_0xf2381b,to_warehouse_name:_0x4acd75,to_Roomname:_0x46fc01,to_Room_name:_0x282971,note:_0x50eb94,level:_0xddac96,isle:_0x29b1e5,pallet:_0x44cd68}=_0x453fcc['body'];if(typeof _0x375644==_0x3ce4dc(0x256))var _0x3b261f=[_0x453fcc['body'][_0x3ce4dc(0x1f6)]],_0x2466fe=[_0x453fcc[_0x3ce4dc(0x258)]['primary_code']],_0x879a8f=[_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x243)]],_0x401b0d=[_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2f5)]],_0x3d32e6=[_0x453fcc[_0x3ce4dc(0x258)]['sales_quantity']],_0x3d1037=[_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2ce)]],_0x246db1=[_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x1fa)]],_0x1b9f76=[_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2ee)]],_0x20a2d5=[_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2d4)]],_0x14e122=[_0x453fcc['body']['types']],_0x18fad5=[_0x453fcc['body'][_0x3ce4dc(0x280)]];else var _0x3b261f=[..._0x453fcc['body'][_0x3ce4dc(0x1f6)]],_0x2466fe=[..._0x453fcc['body'][_0x3ce4dc(0x229)]],_0x879a8f=[..._0x453fcc[_0x3ce4dc(0x258)]['secondary_code']],_0x401b0d=[..._0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2f5)]],_0x3d32e6=[..._0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x20a)]],_0x3d1037=[..._0x453fcc['body'][_0x3ce4dc(0x2ce)]],_0x246db1=[..._0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x1fa)]],_0x1b9f76=[..._0x453fcc['body']['bay']],_0x20a2d5=[..._0x453fcc[_0x3ce4dc(0x258)]['bin']],_0x14e122=[..._0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x286)]],_0x18fad5=[..._0x453fcc['body'][_0x3ce4dc(0x280)]];const _0x2dd1e0=_0x3b261f['map'](_0x520bba=>{return _0x520bba={'product_name':_0x520bba};});_0x2466fe[_0x3ce4dc(0x2fa)]((_0x2e73d3,_0x264005)=>{var _0x4d7e32=_0x3ce4dc;_0x2dd1e0[_0x264005][_0x4d7e32(0x229)]=_0x2e73d3;}),_0x879a8f[_0x3ce4dc(0x2fa)]((_0xf07e09,_0x2d7b7a)=>{_0x2dd1e0[_0x2d7b7a]['secondary_code']=_0xf07e09;}),_0x401b0d[_0x3ce4dc(0x2fa)]((_0x3c3976,_0x4726fd)=>{var _0x264808=_0x3ce4dc;_0x2dd1e0[_0x4726fd][_0x264808(0x2f5)]=_0x3c3976;}),_0x3d32e6['forEach']((_0x29b77b,_0x434afc)=>{var _0x35b234=_0x3ce4dc;_0x2dd1e0[_0x434afc][_0x35b234(0x2b6)]=_0x29b77b;}),_0x3d1037['forEach']((_0x261d3e,_0x11c921)=>{var _0x50db8a=_0x3ce4dc;_0x2dd1e0[_0x11c921][_0x50db8a(0x22c)]=_0x261d3e;}),_0x246db1[_0x3ce4dc(0x2fa)]((_0x369b55,_0x515ad4)=>{var _0x1c67c3=_0x3ce4dc;_0x2dd1e0[_0x515ad4][_0x1c67c3(0x1fa)]=_0x369b55;}),_0x1b9f76[_0x3ce4dc(0x2fa)]((_0x46b526,_0x1a626e)=>{var _0x47827e=_0x3ce4dc;_0x2dd1e0[_0x1a626e][_0x47827e(0x2ee)]=_0x46b526;}),_0x20a2d5[_0x3ce4dc(0x2fa)]((_0x1c2b7a,_0x5f0e96)=>{var _0x285168=_0x3ce4dc;_0x2dd1e0[_0x5f0e96][_0x285168(0x2d4)]=_0x1c2b7a;}),_0x14e122[_0x3ce4dc(0x2fa)]((_0x52ad95,_0x2b154d)=>{var _0x22b1ce=_0x3ce4dc;_0x2dd1e0[_0x2b154d][_0x22b1ce(0x249)]=_0x52ad95;}),_0x18fad5[_0x3ce4dc(0x2fa)]((_0xe838a6,_0x14f4e6)=>{var _0x401fa4=_0x3ce4dc;_0x2dd1e0[_0x14f4e6][_0x401fa4(0x280)]=_0xe838a6;});var _0x12d8ad=0x0;_0x2dd1e0['forEach'](_0x2b4038=>{var _0x194625=_0x3ce4dc;console[_0x194625(0x250)](_0x194625(0x2ac),_0x2b4038),(parseInt(_0x2b4038[_0x194625(0x2b6)])<parseInt(_0x2b4038[_0x194625(0x1fa)])||parseInt(_0x2b4038[_0x194625(0x22c)])<parseInt(_0x2b4038[_0x194625(0x1fa)])&&parseInt(_0x2b4038[_0x194625(0x2b6)])>parseInt(_0x2b4038['return_qty'])||parseInt(_0x2b4038[_0x194625(0x1fa)])==0x0)&&_0x12d8ad++;});if(_0x12d8ad!=0x0)return _0x453fcc[_0x3ce4dc(0x242)]('errors',_0x3ce4dc(0x25d)),_0x47ee42[_0x3ce4dc(0x26c)](_0x3ce4dc(0x292));const _0x4b13c9=await sales[_0x3ce4dc(0x24b)]({'invoice':_0x30bf5c});console[_0x3ce4dc(0x250)](_0x4b13c9),_0x4b13c9[_0x3ce4dc(0x2dc)]=_0x3ce4dc(0x2b8);const _0x10238f=await _0x4b13c9[_0x3ce4dc(0x2e3)](),_0x4286c1=new sales_return({'invoice':_0x30bf5c,'customer':_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2f6)],'date':_0x214700,'warehouse_name':_0xe3a200,'room':_0xf2381b,'ToWarehouse':_0x4acd75,'ToRoom':_0x282971,'return_sale':_0x2dd1e0,'note':_0x50eb94}),_0xe326eb=await _0x4286c1[_0x3ce4dc(0x2e3)]();console[_0x3ce4dc(0x250)](_0x4286c1);const _0x1939fd=await sales_return[_0x3ce4dc(0x24b)]({'invoice':_0x30bf5c}),_0x5a7dc0=await warehouse['findOne']({'name':_0x4acd75,'room':_0x282971});_0x1939fd[_0x3ce4dc(0x29c)][_0x3ce4dc(0x2fa)](_0x224aaf=>{var _0x5a4dbf=_0x3ce4dc,_0xee8df=0x0;const _0x4be057=_0x5a7dc0['product_details'][_0x5a4dbf(0x2e1)](_0x1c9f18=>{var _0x467757=_0x5a4dbf;_0x1c9f18[_0x467757(0x1f6)]==_0x224aaf[_0x467757(0x1f6)]&&_0x1c9f18[_0x467757(0x280)]==_0x224aaf[_0x467757(0x280)]&&_0x1c9f18['type']==_0x224aaf[_0x467757(0x249)]&&_0x1c9f18[_0x467757(0x2d4)]==_0x224aaf[_0x467757(0x2d4)]&&_0x1c9f18['bay']==_0x224aaf[_0x467757(0x2ee)]&&(_0x1c9f18[_0x467757(0x2e7)]=parseInt(_0x1c9f18['product_stock'])+parseInt(_0x224aaf[_0x467757(0x1fa)]),_0xee8df++);});_0xee8df=='0'&&(_0x5a7dc0[_0x5a4dbf(0x254)]=_0x5a7dc0[_0x5a4dbf(0x254)]['concat']({'product_name':_0x224aaf[_0x5a4dbf(0x1f6)],'product_stock':_0x224aaf[_0x5a4dbf(0x1fa)],'primary_code':_0x224aaf[_0x5a4dbf(0x229)],'secondary_code':_0x224aaf[_0x5a4dbf(0x243)],'product_code':_0x224aaf['product_code'],'bay':_0x224aaf[_0x5a4dbf(0x2ee)],'bin':_0x224aaf[_0x5a4dbf(0x2d4)],'type':_0x224aaf[_0x5a4dbf(0x249)],'floorlevel':_0x224aaf[_0x5a4dbf(0x280)]})),console['log'](_0x5a4dbf(0x2c3),_0x5a7dc0);}),await _0x5a7dc0[_0x3ce4dc(0x2e3)](),console['log'](_0x453fcc[_0x3ce4dc(0x258)]);const _0x5e5e36=new c_payment_data({'invoice':_0x30bf5c,'customer':_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2f6)],'reason':_0x3ce4dc(0x2d9)});await _0x5e5e36['save']();const _0x4fbeb7=await master_shop['find']();console['log']('add\x20post',_0x4fbeb7[0x0][_0x3ce4dc(0x208)]);const _0x504437=await email_settings[_0x3ce4dc(0x24b)](),_0x1687c6=await customer[_0x3ce4dc(0x24b)]({'name':_0x453fcc[_0x3ce4dc(0x258)][_0x3ce4dc(0x2f6)]});console[_0x3ce4dc(0x250)](_0x3ce4dc(0x298),_0x1687c6);_0x4fbeb7[0x0][_0x3ce4dc(0x2ef)]==0x1?(right_currency=_0x4fbeb7[0x0][_0x3ce4dc(0x2a4)],left_currency=''):(right_currency='',left_currency=_0x4fbeb7[0x0][_0x3ce4dc(0x2a4)]);var _0x12ef80=_0x3b261f,_0xad35c7=_0x246db1,_0x38d373='',_0x582fad;for(_0x582fad in _0x12ef80){_0x38d373+=_0x3ce4dc(0x2c2)+_0x3ce4dc(0x22f)+_0x12ef80[_0x582fad]+'</td>'+_0x3ce4dc(0x22f)+_0xad35c7[_0x582fad]+_0x3ce4dc(0x227)+_0x3ce4dc(0x295);}console[_0x3ce4dc(0x250)](_0x3ce4dc(0x2f7),_0x38d373);let _0x29d987=nodemailer[_0x3ce4dc(0x2f2)]({'service':_0x3ce4dc(0x28c),'auth':{'user':_0x504437['email'],'pass':_0x504437[_0x3ce4dc(0x2e6)]}}),_0x14ad03={'from':_0x504437['email'],'to':_0x1687c6[_0x3ce4dc(0x266)],'subject':_0x3ce4dc(0x214),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3ce4dc(0x2bf)+_0x3ce4dc(0x2bd)+_0x4fbeb7[0x0][_0x3ce4dc(0x208)],'cid':_0x3ce4dc(0x281)}],'html':_0x3ce4dc(0x22d)+'<html><head><title></title>'+_0x3ce4dc(0x2a8)+_0x3ce4dc(0x239)+_0x3ce4dc(0x21b)+_0x3ce4dc(0x239)+_0x3ce4dc(0x24d)+_0x3ce4dc(0x251)+_0x3ce4dc(0x239)+_0x3ce4dc(0x272)+_0x4fbeb7[0x0]['site_title']+_0x3ce4dc(0x202)+_0x3ce4dc(0x251)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x3ce4dc(0x239)+_0x3ce4dc(0x247)+_0x3ce4dc(0x2b4)+_0x30bf5c+'\x20'+_0x3ce4dc(0x276)+_0x3ce4dc(0x2b3)+_0x214700+'\x20'+_0x3ce4dc(0x1ed)+_0x3ce4dc(0x234)+_0x3ce4dc(0x251)+_0x3ce4dc(0x264)+_0x3ce4dc(0x255)+_0x3ce4dc(0x2c2)+_0x3ce4dc(0x268)+_0x3ce4dc(0x277)+_0x3ce4dc(0x1f4)+_0x3ce4dc(0x213)+'</tr>'+_0x3ce4dc(0x228)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x38d373+'\x20'+_0x3ce4dc(0x2e2)+_0x3ce4dc(0x1fe)+'<div>'+_0x3ce4dc(0x271)+'<h5>'+_0x4fbeb7[0x0][_0x3ce4dc(0x237)]+'</h5>'+_0x3ce4dc(0x251)+'</div>'+_0x3ce4dc(0x226)};_0x29d987[_0x3ce4dc(0x25f)](_0x14ad03,function(_0x42188e,_0x4be689){var _0x234170=_0x3ce4dc;_0x42188e?(console[_0x234170(0x250)](_0x42188e),console[_0x234170(0x250)](_0x234170(0x262))):console[_0x234170(0x250)]('Email\x20sent\x20successfully');}),_0x453fcc[_0x3ce4dc(0x242)]('success',_0x3ce4dc(0x1f5)),_0x47ee42[_0x3ce4dc(0x26c)](_0x3ce4dc(0x259));}catch(_0x419bdf){console[_0x3ce4dc(0x250)](_0x419bdf),_0x47ee42[_0x3ce4dc(0x2d1)](0xc8)['json']({'message1':_0x419bdf[_0x3ce4dc(0x1f8)]});}}),router[a0_0x4df440(0x2e9)](a0_0x4df440(0x274),auth,async(_0x3b42fc,_0x37f76b)=>{var _0x302dd1=a0_0x4df440;try{const {username:_0xac603f,email:_0x5b1c6a,role:_0x3d745d}=_0x3b42fc[_0x302dd1(0x27a)],_0x2fe580=_0x3b42fc['user'],_0x1381a3=await profile[_0x302dd1(0x24b)]({'email':_0x2fe580[_0x302dd1(0x266)]}),_0x37ed10=await master_shop[_0x302dd1(0x24a)]();console[_0x302dd1(0x250)](_0x302dd1(0x2ae),_0x37ed10);const _0x48ce40=_0x3b42fc[_0x302dd1(0x2cb)]['id'],_0x2451c1=await sales[_0x302dd1(0x2d0)](_0x48ce40);console['log'](_0x302dd1(0x21e),_0x2451c1);if(_0x37ed10[0x0][_0x302dd1(0x23f)]==_0x302dd1(0x2a5))var _0x4065e9=users[_0x302dd1(0x2d3)];else{if(_0x37ed10[0x0]['language']==_0x302dd1(0x21d))var _0x4065e9=users[_0x302dd1(0x21d)];else{if(_0x37ed10[0x0][_0x302dd1(0x23f)]==_0x302dd1(0x216))var _0x4065e9=users['German'];else{if(_0x37ed10[0x0][_0x302dd1(0x23f)]=='Spanish')var _0x4065e9=users[_0x302dd1(0x275)];else{if(_0x37ed10[0x0][_0x302dd1(0x23f)]=='French')var _0x4065e9=users[_0x302dd1(0x26e)];else{if(_0x37ed10[0x0]['language']==_0x302dd1(0x260))var _0x4065e9=users[_0x302dd1(0x1f2)];else{if(_0x37ed10[0x0][_0x302dd1(0x23f)]==_0x302dd1(0x285))var _0x4065e9=users[_0x302dd1(0x285)];else{if(_0x37ed10[0x0]['language']==_0x302dd1(0x290))var _0x4065e9=users[_0x302dd1(0x1ef)];}}}}}}}_0x37f76b[_0x302dd1(0x2eb)]('all_sales_barcode',{'success':_0x3b42fc['flash'](_0x302dd1(0x2a0)),'errors':_0x3b42fc[_0x302dd1(0x242)](_0x302dd1(0x24c)),'role':_0x2fe580,'profile':_0x1381a3,'alldata':_0x2451c1,'master_shop':_0x37ed10,'language':_0x4065e9});}catch(_0x56b5a7){console[_0x302dd1(0x250)](_0x56b5a7);}}),router['post'](a0_0x4df440(0x2d5),async(_0x48accd,_0x314d38)=>{var _0x2464b3=a0_0x4df440;const {product_code:_0x362a2a,warehouse_name:_0x5744f0,rooms_data:_0x15a347,Roomslist:_0x3d569c}=_0x48accd[_0x2464b3(0x258)],_0x4d51bc=_0x3d569c[_0x2464b3(0x23c)](','),_0x56bbbe=[];async function _0x298828(_0x3caf28){var _0x47cf81=_0x2464b3;const _0x58e5de=await warehouse[_0x47cf81(0x2b0)]([{'$match':{'name':_0x5744f0,'room':_0x3caf28}},{'$unwind':_0x47cf81(0x23d)},{'$match':{'product_details.primary_code':_0x362a2a}},{'$group':{'_id':_0x47cf81(0x220),'name':{'$first':_0x47cf81(0x2d8)},'product_stock':{'$first':_0x47cf81(0x25c)},'primary_code':{'$first':_0x47cf81(0x2ed)},'secondary_code':{'$first':_0x47cf81(0x273)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x47cf81(0x297)},'type':{'$first':_0x47cf81(0x27c)},'pallet':{'$first':_0x47cf81(0x2a2)},'unit':{'$first':_0x47cf81(0x223)},'secondary_unit':{'$first':_0x47cf81(0x282)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x47cf81(0x2ad)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x47cf81(0x2d6)},'maxPerUnit':{'$first':_0x47cf81(0x1e4)},'batch_code':{'$first':_0x47cf81(0x2f3)},'product_cat':{'$first':_0x47cf81(0x29e)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x47cf81(0x269)},'invoice':{'$first':_0x47cf81(0x1fb)},'actual_qty':{'$first':_0x47cf81(0x24f)},'actual_uom':{'$first':_0x47cf81(0x2de)}}}]),_0x2bce6c=await warehouse['aggregate']([{'$match':{'name':_0x5744f0,'room':_0x3caf28}},{'$unwind':_0x47cf81(0x23d)},{'$match':{'product_details.secondary_code':_0x362a2a}},{'$group':{'_id':_0x47cf81(0x220),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x47cf81(0x25c)},'primary_code':{'$first':_0x47cf81(0x2ed)},'secondary_code':{'$first':_0x47cf81(0x273)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x47cf81(0x2c4)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x47cf81(0x282)},'storage':{'$first':_0x47cf81(0x2d7)},'rack':{'$first':_0x47cf81(0x2ad)},'expiry_date':{'$first':_0x47cf81(0x1ea)},'production_date':{'$first':_0x47cf81(0x2d6)},'maxPerUnit':{'$first':_0x47cf81(0x1e4)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x47cf81(0x1fb)}}}]);if(_0x58e5de[_0x47cf81(0x2a3)]>0x0)_0x56bbbe[_0x47cf81(0x1ee)](_0x58e5de);else _0x2bce6c['length']>0x0&&_0x56bbbe[_0x47cf81(0x1ee)](_0x2bce6c);}const _0x1ac9ac=_0x4d51bc[_0x2464b3(0x2e1)](_0x9d6e82=>_0x298828(_0x9d6e82));await Promise['all'](_0x1ac9ac),_0x314d38['json'](_0x56bbbe);}),module[a0_0x4df440(0x22b)]=router;