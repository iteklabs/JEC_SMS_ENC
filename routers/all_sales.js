var a0_0x82d35a=a0_0x3f95;(function(_0x139010,_0x357c93){var _0x4ee7fd=a0_0x3f95,_0x3bb6f7=_0x139010();while(!![]){try{var _0x99bb63=-parseInt(_0x4ee7fd(0x85))/0x1*(-parseInt(_0x4ee7fd(0xf3))/0x2)+-parseInt(_0x4ee7fd(0x115))/0x3*(parseInt(_0x4ee7fd(0x84))/0x4)+parseInt(_0x4ee7fd(0xcc))/0x5*(-parseInt(_0x4ee7fd(0x105))/0x6)+-parseInt(_0x4ee7fd(0x157))/0x7+-parseInt(_0x4ee7fd(0x11d))/0x8*(parseInt(_0x4ee7fd(0xc8))/0x9)+parseInt(_0x4ee7fd(0x13c))/0xa+parseInt(_0x4ee7fd(0x15e))/0xb*(parseInt(_0x4ee7fd(0xf0))/0xc);if(_0x99bb63===_0x357c93)break;else _0x3bb6f7['push'](_0x3bb6f7['shift']());}catch(_0x238c31){_0x3bb6f7['push'](_0x3bb6f7['shift']());}}}(a0_0x3d50,0x665d0));const express=require('express'),app=express(),router=express[a0_0x82d35a(0xa4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x82d35a(0x93)),auth=require(a0_0x82d35a(0x15c)),nodemailer=require(a0_0x82d35a(0x17d)),users=require('../public/language/languages.json');router[a0_0x82d35a(0x141)](a0_0x82d35a(0xf6),auth,async(_0x11efd9,_0x7955d5)=>{var _0x5e4206=a0_0x82d35a;try{const {username:_0xd75b44,email:_0x50d974,role:_0xaaef09}=_0x11efd9[_0x5e4206(0x12e)],_0x4909fe=_0x11efd9[_0x5e4206(0x12e)],_0x3f9870=await profile[_0x5e4206(0x150)]({'email':_0x4909fe['email']}),_0x2befb6=await master_shop[_0x5e4206(0x11c)]();let _0x133427;if(_0x4909fe[_0x5e4206(0x86)]==_0x5e4206(0x9e)){const _0x1cbca8=await staff[_0x5e4206(0x150)]({'email':_0x4909fe['email']});_0x133427=await sales[_0x5e4206(0x162)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x5e4206(0xd9),'as':_0x5e4206(0xcf)}},{'$unwind':_0x5e4206(0xec)},{'$unwind':_0x5e4206(0xa8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5e4206(0xa2)},'customers':{'$first':'$customer'},'date':{'$first':_0x5e4206(0xb1)},'warehouse_name':{'$first':_0x5e4206(0xdc)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x5e4206(0x8d)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x5e4206(0xfd)},'type':{'$addToSet':_0x5e4206(0x7f)},'pallet':{'$addToSet':_0x5e4206(0x104)},'finalize':{'$first':_0x5e4206(0xef)},'isAllowEdit':{'$first':_0x5e4206(0x100)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x133427=await sales[_0x5e4206(0x162)]([{'$lookup':{'from':_0x5e4206(0x121),'localField':_0x5e4206(0x75),'foreignField':_0x5e4206(0xd9),'as':_0x5e4206(0xcf)}},{'$unwind':_0x5e4206(0xec)},{'$unwind':_0x5e4206(0xa8)},{'$group':{'_id':_0x5e4206(0xfc),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5e4206(0xdc)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5e4206(0xc5)},'return_data':{'$first':_0x5e4206(0x8d)},'customers_docs':{'$first':_0x5e4206(0xec)},'total_saleproduct_quantity':{'$sum':_0x5e4206(0xee)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x5e4206(0xfd)},'type':{'$addToSet':_0x5e4206(0x7f)},'pallet':{'$addToSet':_0x5e4206(0x104)},'finalize':{'$first':_0x5e4206(0xef)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5e4206(0x112)]('sales\x20all_data',_0x133427);if(_0x2befb6[0x0]['language']==_0x5e4206(0x159)){var _0x30cb05=users[_0x5e4206(0x131)];console[_0x5e4206(0x112)](_0x30cb05);}else{if(_0x2befb6[0x0][_0x5e4206(0xf8)]==_0x5e4206(0xe1))var _0x30cb05=users[_0x5e4206(0xe1)];else{if(_0x2befb6[0x0]['language']==_0x5e4206(0xbd))var _0x30cb05=users['German'];else{if(_0x2befb6[0x0][_0x5e4206(0xf8)]==_0x5e4206(0xf7))var _0x30cb05=users[_0x5e4206(0xf7)];else{if(_0x2befb6[0x0][_0x5e4206(0xf8)]==_0x5e4206(0x126))var _0x30cb05=users[_0x5e4206(0x126)];else{if(_0x2befb6[0x0][_0x5e4206(0xf8)]=='Portuguese\x20(BR)')var _0x30cb05=users['Portuguese'];else{if(_0x2befb6[0x0][_0x5e4206(0xf8)]=='Chinese')var _0x30cb05=users[_0x5e4206(0x123)];else{if(_0x2befb6[0x0][_0x5e4206(0xf8)]==_0x5e4206(0x80))var _0x30cb05=users[_0x5e4206(0x151)];}}}}}}}_0x7955d5['render'](_0x5e4206(0x98),{'success':_0x11efd9[_0x5e4206(0x76)](_0x5e4206(0xd8)),'errors':_0x11efd9[_0x5e4206(0x76)](_0x5e4206(0xab)),'sales':_0x133427,'profile':_0x3f9870,'role':_0x4909fe,'master_shop':_0x2befb6,'language':_0x30cb05});}catch(_0x240d2f){console[_0x5e4206(0x112)](_0x240d2f);}});async function getRandom8DigitNumber(){var _0x5cdb6b=a0_0x82d35a;const _0x291744=0x989680,_0x1061f3=0x5f5e0ff,_0x1b0671=Math[_0x5cdb6b(0x9c)](Math[_0x5cdb6b(0x135)]()*(_0x1061f3-_0x291744+0x1))+_0x291744;var _0x491239;const _0x523715=await sales[_0x5cdb6b(0x150)]({'invoice':_0x5cdb6b(0xe0)+_0x1b0671});return _0x523715&&_0x523715[_0x5cdb6b(0x173)]>0x0?_0x491239=_0x5cdb6b(0xe0)+_0x1b0671:_0x491239=_0x5cdb6b(0xe0)+_0x1b0671,_0x491239;}function a0_0x3f95(_0x598bc9,_0x13f936){var _0x3d5084=a0_0x3d50();return a0_0x3f95=function(_0x3f95b4,_0x157e22){_0x3f95b4=_0x3f95b4-0x72;var _0x528e95=_0x3d5084[_0x3f95b4];return _0x528e95;},a0_0x3f95(_0x598bc9,_0x13f936);}function a0_0x3d50(){var _0x32cc36=['RMSEmail','due_amount','log','production_date','save','6qtDose','$product_details.isle','Sale\x20Return\x20Mail','edit_sales_view','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/view/add_sales','find','1056qRqoTD','$product_details.batch_code','status','delivery_date','customers','abs','Chinese','<tr>','product_details','French','payment\x20successfull','Sale\x20Return','$product_details.production_date','sale_product','$product_details.expiry_date','$product_details.level','back','user','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.unit','English','prod_cat','actual_uom','Sales\x20Mail','random','sales_quantity','<h2>\x20','return_qty','filter','Shelves','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','6836500fXAwuQ','render','redirect','id_transaction_from','invoice','get','unit','SCRN','types','product_name','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','findById','toString','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Enabled','</tbody>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details._id','findOne','Arabic','/all_sales/view','prod_invoice','sales\x20item\x20return\x20successfull','</span>','bin','4060084zLwgzv','floorlevel','English\x20(US)','actual_qty','Enclosed','../middleware/auth','body','87769NrpqLb','amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','batch_code','aggregate','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','sendMail','rack','primary_unit','/view/return_sales/:id','concat','sale_qty','An\x20error\x20occurred.','<div>','bay','$product_details.product_cat','Receiving\x20Area','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product','$product_details.maxPerUnit','post','length','<strong>\x20Regards\x20</strong>','string','quantity','$product_details.pallet','requested_qty','$product_details.bay','params','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','all','nodemailer','RoomAssigned','Sales\x20Update\x20successfully','error','currency','user_id','$product_details.secondary_unit','$product_details.bin','$product_details.rack','customer','flash','foreach\x20newproduct','$product_details.product_code','Logo.png','<hr\x20class=\x22my-3\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','<span\x20style=\x22float:\x20right;\x22>','/../public','/view/add_sale/product','$sale_product.type','Arabic\x20(ae)','An\x20error\x20occurred\x20while\x20saving\x20data.','<!DOCTYPE\x20html>','</td>','497308WgMyeC','494926mXrgFw','role','product_data','/invoice/:id','password','</div>','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$return_data','note','port','createTransport','add\x20post','catch','../models/all_models','True','$product_details.secondary_code','json','product_list','all_sales','Sales\x20Add\x20successfully','warehouse','maxperunit','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','staff','stocks','Ambient','$product_details.storage','$invoice','currency_placement','Router','secondary_code','_id','\x20Order\x20Date\x20:\x20','$sale_product','</h5>','/all_sales/preview/','errors','host','expiry_date','split','edit_sales','<h5\x20style=\x22text-align:\x20left;\x22>','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Return\x20Rooms','$product_details.invoice','</tr>','$product_details.type','barcode\x20user_id','\x20Order\x20Number\x20:\x20','$product_details.actual_qty','customer_data','$product_details','False','German','getFullYear','delivery_code','slice','</table>','message','date','Portuguese','$note','Floor','</thead>','25713eBAINq','$product.product_name','type','all_sales_barcode','45yvOoSB','add_sales','barcode\x20Product\x20master','customers_docs','secondary_unit','return_sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','map','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','email','purchases_data','success','name','master','</head><body>','$warehouse_name','Portuguese\x20(BR)','image','then','OUT-','Hindi','product','isAllowEdit','carton','level','stock','room_name','/view/:id','Error\x20Occurs','Raw\x20Materials','Return\x20Goods','$customers_docs','Email\x20sent\x20successfully','$sale_product.quantity','$finalize','1068uMNMKr','\x20</h2>','logo','2xWyser','$name','push','/view','Spanish','language','quantity_notConverted','getMonth','max_per_unit','$_id','$sale_product.bin','padStart','exports','$isAllowEdit','id_transact','primary_code','/preview/:id','$sale_product.floorlevel','175758XKfOBZ','product_stock','site_title','<html><head><title></title>','Level','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.floorlevel','gmail','storage','warehouse_name'];a0_0x3d50=function(){return _0x32cc36;};return a0_0x3d50();}router[a0_0x82d35a(0x141)](a0_0x82d35a(0x11b),auth,async(_0x198ff7,_0x112e41)=>{var _0x15144d=a0_0x82d35a;try{const {username:_0x3ea910,email:_0x787d93,role:_0x56f680}=_0x198ff7[_0x15144d(0x12e)],_0x41e73f=_0x198ff7[_0x15144d(0x12e)],_0x190334=await profile[_0x15144d(0x150)]({'email':_0x41e73f['email']}),_0x595301=await master_shop[_0x15144d(0x11c)](),_0x54dcba=await customer[_0x15144d(0x11c)]({});let _0x190b97;if(_0x41e73f[_0x15144d(0x86)]=='staff'){const _0x137bce=await staff[_0x15144d(0x150)]({'email':_0x41e73f['email']});_0x190b97=await warehouse[_0x15144d(0x162)]([{'$match':{'status':'Enabled','name':_0x137bce[_0x15144d(0x9a)],'warehouse_category':_0x15144d(0xea),'name':{'$ne':_0x15144d(0xeb)}}},{'$group':{'_id':_0x15144d(0xf4),'name':{'$first':_0x15144d(0xf4)}}},{'$sort':{'name':0x1}}]);}else _0x190b97=await warehouse[_0x15144d(0x162)]([{'$match':{'status':_0x15144d(0x14c),'warehouse_category':_0x15144d(0xea),'name':{'$ne':_0x15144d(0xeb)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x4bc5cf=await product[_0x15144d(0x11c)]({});var _0x3b03c7=['Ambient',_0x15144d(0x15b)];const _0x270d5c=await sales['find']({}),_0x46a87e=_0x270d5c['length']+0x1,_0x28343b=_0x15144d(0xe0)+_0x46a87e[_0x15144d(0x149)]()[_0x15144d(0xfe)](0x5,'0');if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0x159)){var _0x3b0b1b=users[_0x15144d(0x131)];console[_0x15144d(0x112)](_0x3b0b1b);}else{if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0xe1))var _0x3b0b1b=users['Hindi'];else{if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0xbd))var _0x3b0b1b=users[_0x15144d(0xbd)];else{if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0xf7))var _0x3b0b1b=users['Spanish'];else{if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0x126))var _0x3b0b1b=users[_0x15144d(0x126)];else{if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0xdd))var _0x3b0b1b=users[_0x15144d(0xc4)];else{if(_0x595301[0x0][_0x15144d(0xf8)]==_0x15144d(0x123))var _0x3b0b1b=users[_0x15144d(0x123)];else{if(_0x595301[0x0][_0x15144d(0xf8)]=='Arabic\x20(ae)')var _0x3b0b1b=users['Arabic'];}}}}}}}const _0x3c4fd5=getRandom8DigitNumber();_0x3c4fd5[_0x15144d(0xdf)](_0x7bcfc8=>{var _0x229169=_0x15144d;_0x112e41[_0x229169(0x13d)](_0x229169(0xcd),{'success':_0x198ff7[_0x229169(0x76)](_0x229169(0xd8)),'errors':_0x198ff7[_0x229169(0x76)](_0x229169(0xab)),'role':_0x41e73f,'profile':_0x190334,'customer':_0x54dcba,'warehouse':_0x190b97,'product':_0x4bc5cf,'invoice':_0x7bcfc8,'master_shop':_0x595301,'language':_0x3b0b1b,'rooms_data':_0x3b03c7});})[_0x15144d(0x92)](_0xde559a=>{var _0x1d23af=_0x15144d;_0x198ff7[_0x1d23af(0x76)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x112e41[_0x1d23af(0x13e)](_0x1d23af(0x152));});}catch(_0x24eda5){console['log'](_0x24eda5);}}),router['get']('/view/add_sales/:id',auth,async(_0x360f9d,_0x275788)=>{var _0x1917ae=a0_0x82d35a;try{const _0x3176a9=_0x360f9d[_0x1917ae(0x17a)]['id'];console[_0x1917ae(0x112)](_0x3176a9);const _0x4b3745=await product[_0x1917ae(0x11c)](),_0x5d875d=await purchases[_0x1917ae(0x162)]([{'$match':{'warehouse_name':_0x3176a9}},{'$unwind':_0x1917ae(0x170)},{'$group':{'_id':_0x1917ae(0xc9)}}]);console[_0x1917ae(0x112)](_0x1917ae(0xd7),_0x5d875d),_0x275788[_0x1917ae(0x11f)](0xc8)[_0x1917ae(0x96)]({'purchases_data':_0x5d875d,'product_data':_0x4b3745});}catch(_0x2077c5){console[_0x1917ae(0x112)](_0x2077c5);}}),router[a0_0x82d35a(0x172)](a0_0x82d35a(0x7e),auth,async(_0xcfe3d,_0x2a47b1)=>{var _0x3a738d=a0_0x82d35a;try{const {warehouse_data:_0x46ed12,product_data:_0x1947ed}=_0xcfe3d[_0x3a738d(0x15d)];console['log'](_0xcfe3d[_0x3a738d(0x15d)][_0x3a738d(0x87)]);;const _0x498ba5=await master_shop[_0x3a738d(0x11c)]();console[_0x3a738d(0x112)](_0x3a738d(0xda),_0x498ba5);const _0x29f459=await product[_0x3a738d(0x150)]({'name':_0x1947ed});console[_0x3a738d(0x112)](_0x3a738d(0xe2),_0x29f459);const _0x43a647=await warehouse[_0x3a738d(0x162)]([{'$match':{'name':_0x46ed12}},{'$unwind':_0x3a738d(0xbb)},{'$match':{'product_details.product_name':_0x1947ed}},{'$group':{'_id':_0x3a738d(0xd5),'product_stock':{'$first':_0x3a738d(0x14a)}}}]);console[_0x3a738d(0x112)]('stock_data',_0x43a647),_0x2a47b1[_0x3a738d(0x11f)](0xc8)[_0x3a738d(0x96)]({'master':_0x498ba5,'new_product':_0x29f459,'stock_data':_0x43a647});}catch(_0x207e8a){console[_0x3a738d(0x112)](_0x207e8a);}}),router['post'](a0_0x82d35a(0x11b),auth,async(_0x260adf,_0x15fa65)=>{var _0x24c545=a0_0x82d35a;try{const {invoice:_0x20becf,date:_0x58587f,warehouse_name:_0x43a581,product_name:_0x89acd0,stock:_0x32d1d9,quantity:_0x3b6c36,note:_0x21308e,room:_0x25c7ea,primary_code:_0x3b6862,secondary_code:_0x27ac16,prod_code:_0x38930d,level:_0x4ec94c,isle:_0x34f6df,pallet:_0x166058,batch_code:_0x3589bc,SCRN:_0x347c8c,expiry_date:_0x4f501a}=_0x260adf[_0x24c545(0x15d)];if(typeof _0x89acd0==_0x24c545(0x175))var _0x42698b=[_0x260adf['body']['product_name']],_0x461354=[_0x260adf['body'][_0x24c545(0xe6)]],_0x2d003c=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0xe4)]],_0x2f2514=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x102)]],_0x18a5a1=[_0x260adf[_0x24c545(0x15d)]['secondary_code']],_0x12bced=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x8b)]],_0x4e95f6=[_0x260adf[_0x24c545(0x15d)]['level']],_0x45b072=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x166)]],_0x4cb26f=[_0x260adf['body']['secondary_unit']],_0x52eab4=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x161)]],_0xd63926=[_0x260adf['body'][_0x24c545(0xad)]],_0x590a9b=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0xfb)]],_0x203bd5=[_0x260adf[_0x24c545(0x15d)]['production_date']],_0x416385=[_0x260adf[_0x24c545(0x15d)]['requested_qty']],_0x239a28=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x120)]],_0xfd7256=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0xbf)]],_0xfb0058=[_0x260adf['body']['prod_cat']],_0x28e1b1=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x176)]],_0x1d57a0=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x17e)]],_0x2b50a2=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x153)]],_0x102f72=[_0x260adf[_0x24c545(0x15d)][_0x24c545(0x15a)]],_0x12229b=[_0x260adf['body'][_0x24c545(0x133)]],_0x1d1299=[_0x260adf[_0x24c545(0x15d)]['id_transact']];else var _0x42698b=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x145)]],_0x461354=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0xe6)]],_0x2d003c=[..._0x260adf[_0x24c545(0x15d)]['carton']],_0x2f2514=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x102)]],_0x18a5a1=[..._0x260adf['body'][_0x24c545(0xa5)]],_0x12bced=[..._0x260adf['body'][_0x24c545(0x8b)]],_0x4e95f6=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0xe5)]],_0x45b072=[..._0x260adf['body']['primary_unit']],_0x4cb26f=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0xd0)]],_0x52eab4=[..._0x260adf['body'][_0x24c545(0x161)]],_0xd63926=[..._0x260adf['body'][_0x24c545(0xad)]],_0x590a9b=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0xfb)]],_0x203bd5=[..._0x260adf[_0x24c545(0x15d)]['production_date']],_0x416385=[..._0x260adf['body'][_0x24c545(0x178)]],_0x239a28=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x120)]],_0xfd7256=[..._0x260adf['body'][_0x24c545(0xbf)]],_0xfb0058=[..._0x260adf['body'][_0x24c545(0x132)]],_0x28e1b1=[..._0x260adf['body'][_0x24c545(0x176)]],_0x1d57a0=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x17e)]],_0x2b50a2=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x153)]],_0x102f72=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x15a)]],_0x12229b=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x133)]],_0x1d1299=[..._0x260adf[_0x24c545(0x15d)][_0x24c545(0x101)]];const _0x493184=_0x42698b[_0x24c545(0xd3)](_0x46f049=>{return _0x46f049={'product_name':_0x46f049};});_0x461354[_0x24c545(0x146)]((_0x84cd3c,_0x335e0b)=>{var _0x4e97f6=_0x24c545;_0x493184[_0x335e0b][_0x4e97f6(0xe6)]=Math[_0x4e97f6(0x122)](_0x84cd3c);}),_0x102f72[_0x24c545(0x146)]((_0x4f41e9,_0x15e01e)=>{var _0x51567a=_0x24c545;_0x493184[_0x15e01e][_0x51567a(0x15a)]=Math[_0x51567a(0x122)](_0x4f41e9);}),_0x12229b[_0x24c545(0x146)]((_0x5a5a78,_0x27dff9)=>{_0x493184[_0x27dff9]['actual_uom']=_0x5a5a78;}),_0x1d1299[_0x24c545(0x146)]((_0x5b1e99,_0x235b00)=>{var _0x219bb1=_0x24c545;_0x493184[_0x235b00][_0x219bb1(0x13f)]=_0x5b1e99;}),_0x2d003c[_0x24c545(0x146)]((_0x117e01,_0x29c59c)=>{_0x493184[_0x29c59c]['quantity']=_0x117e01;}),_0x2f2514[_0x24c545(0x146)]((_0x192567,_0x10ed7d)=>{_0x493184[_0x10ed7d]['primary_code']=_0x192567;}),_0x18a5a1[_0x24c545(0x146)]((_0x489f24,_0x2a71ed)=>{var _0xf4f42f=_0x24c545;_0x493184[_0x2a71ed][_0xf4f42f(0xa5)]=_0x489f24;}),_0x12bced[_0x24c545(0x146)]((_0x229137,_0x5518cd)=>{var _0x35d81f=_0x24c545;_0x493184[_0x5518cd][_0x35d81f(0x10a)]=_0x229137;}),_0x4e95f6[_0x24c545(0x146)]((_0x3fedfc,_0x1119a0)=>{var _0x4a37f9=_0x24c545;_0x1d57a0[_0x4a37f9(0x146)]((_0x2239cf,_0x11f7b0)=>{var _0x1bca76=_0x4a37f9;if(_0x2239cf==_0x1bca76(0x16e)&&_0x1119a0==_0x11f7b0){var _0x5d922d=_0x3fedfc['slice'](0x3);_0x493184[_0x1119a0]['storage']=_0x3fedfc[0x0],_0x493184[_0x1119a0][_0x1bca76(0x165)]=_0x3fedfc[0x1],_0x493184[_0x1119a0][_0x1bca76(0x16c)]=0x0,_0x493184[_0x1119a0][_0x1bca76(0x156)]=0x0,_0x493184[_0x1119a0]['type']=_0x1bca76(0xc6),_0x493184[_0x1119a0][_0x1bca76(0x158)]=_0x5d922d;}else{if(_0x2239cf==_0x1bca76(0x13a)&&_0x1119a0==_0x11f7b0){var _0x5d922d=_0x3fedfc['slice'](0x3);_0x493184[_0x1119a0][_0x1bca76(0x10e)]=_0x3fedfc[0x0],_0x493184[_0x1119a0][_0x1bca76(0x165)]=_0x3fedfc[0x1],_0x493184[_0x1119a0][_0x1bca76(0x16c)]=0x0,_0x493184[_0x1119a0]['bin']=0x0,_0x493184[_0x1119a0][_0x1bca76(0xca)]=_0x1bca76(0xc6),_0x493184[_0x1119a0][_0x1bca76(0x158)]=_0x3fedfc[0x5];}else{if(_0x1119a0==_0x11f7b0){var _0x113a23;if(_0x3fedfc[0x4]=='L')_0x113a23=_0x1bca76(0x109);else _0x3fedfc[0x4]=='F'&&(_0x113a23=_0x1bca76(0xc6));_0x493184[_0x1119a0]['storage']=_0x3fedfc[0x0],_0x493184[_0x1119a0]['rack']=_0x3fedfc[0x1],_0x493184[_0x1119a0][_0x1bca76(0x16c)]=_0x3fedfc[0x2],_0x493184[_0x1119a0][_0x1bca76(0x156)]=_0x3fedfc[0x3],_0x493184[_0x1119a0][_0x1bca76(0xca)]=_0x113a23,_0x493184[_0x1119a0][_0x1bca76(0x158)]=_0x3fedfc[0x5];}}}});}),_0x45b072[_0x24c545(0x146)]((_0x5a5a68,_0x51c90f)=>{var _0x52a3ff=_0x24c545;_0x493184[_0x51c90f][_0x52a3ff(0x142)]=_0x5a5a68;}),_0x4cb26f[_0x24c545(0x146)]((_0x322115,_0x2c6961)=>{var _0x4ac95b=_0x24c545;_0x493184[_0x2c6961][_0x4ac95b(0xd0)]=_0x322115;}),_0x52eab4[_0x24c545(0x146)]((_0x174492,_0x306059)=>{_0x493184[_0x306059]['batch_code']=_0x174492;}),_0xd63926[_0x24c545(0x146)]((_0x1c7dd7,_0x171676)=>{var _0x1445b4=_0x24c545;_0x493184[_0x171676][_0x1445b4(0xad)]=_0x1c7dd7;}),_0x590a9b[_0x24c545(0x146)]((_0x38480c,_0x471dad)=>{var _0x378b53=_0x24c545;_0x493184[_0x471dad][_0x378b53(0x9b)]=_0x38480c;}),_0x203bd5[_0x24c545(0x146)]((_0x324de8,_0x549cd9)=>{var _0x552975=_0x24c545;_0x493184[_0x549cd9][_0x552975(0x113)]=_0x324de8;}),_0x416385[_0x24c545(0x146)]((_0xb9c34e,_0x14b413)=>{var _0x3f1cd7=_0x24c545;_0x493184[_0x14b413][_0x3f1cd7(0x178)]=_0xb9c34e;}),_0x239a28['forEach']((_0x55a59a,_0x541625)=>{_0x493184[_0x541625]['delivery_date']=_0x55a59a;}),_0xfd7256[_0x24c545(0x146)]((_0x4bfe09,_0x54b3b6)=>{_0x493184[_0x54b3b6]['delivery_code']=_0x4bfe09;}),_0xfb0058['forEach']((_0x248574,_0x621760)=>{var _0x4ca65f=_0x24c545;_0x493184[_0x621760][_0x4ca65f(0x132)]=_0x248574;}),_0x28e1b1[_0x24c545(0x146)]((_0x5921de,_0x3b995c)=>{var _0x205139=_0x24c545;_0x493184[_0x3b995c][_0x205139(0xf9)]=_0x5921de;}),_0x1d57a0[_0x24c545(0x146)]((_0x13f322,_0x3e5465)=>{var _0xe2e2b9=_0x24c545;_0x493184[_0x3e5465][_0xe2e2b9(0xe7)]=_0x13f322;}),_0x2b50a2['forEach']((_0x2eb93f,_0x5d2b95)=>{_0x493184[_0x5d2b95]['invoice']=_0x2eb93f;});var _0x195144=0x0;_0x493184[_0x24c545(0x146)](_0x4537e7=>{var _0x560f7f=_0x24c545;(_0x4537e7[_0x560f7f(0xe6)]<_0x4537e7['quantity_notConverted']||_0x4537e7[_0x560f7f(0xf9)]==0x0)&&(console[_0x560f7f(0x112)](_0x560f7f(0x77),_0x4537e7),_0x195144++);});const _0x2003e5=_0x493184['filter'](_0x2befdd=>_0x2befdd[_0x24c545(0x176)]!=='0'&&_0x2befdd[_0x24c545(0x176)]!==''),_0x2dc743=new sales({'invoice':_0x20becf,'customer':_0x260adf[_0x24c545(0x15d)][_0x24c545(0x75)],'date':_0x58587f,'warehouse_name':_0x43a581,'sale_product':_0x2003e5,'note':_0x21308e,'room':_0x25c7ea,'primary_code':_0x3b6862,'secondary_code':_0x27ac16,'prod_code':_0x38930d,'SCRN':_0x347c8c}),_0x410646=await _0x2dc743[_0x24c545(0x114)]();_0x260adf[_0x24c545(0x76)](_0x24c545(0xd8),_0x24c545(0x99)),_0x15fa65['redirect'](_0x24c545(0xaa)+_0x410646['_id']);}catch(_0xa09509){console[_0x24c545(0x112)](_0xa09509);}}),router[a0_0x82d35a(0x141)](a0_0x82d35a(0x103),auth,async(_0x35dc7e,_0x947698)=>{var _0x4d93c6=a0_0x82d35a;try{const {username:_0x495305,email:_0x5d65af,role:_0xb543ab}=_0x35dc7e[_0x4d93c6(0x12e)],_0x34a16f=_0x35dc7e['user'],_0xfdf7d3=await profile[_0x4d93c6(0x150)]({'email':_0x34a16f['email']}),_0x4d90e6=await master_shop['find'](),_0x4b7dee=_0x35dc7e[_0x4d93c6(0x17a)]['id'],_0x537339=await sales['findById'](_0x4b7dee),_0xb65a4c=await warehouse[_0x4d93c6(0x162)]([{'$match':{'name':_0x537339[_0x4d93c6(0x10f)]}},{'$unwind':_0x4d93c6(0xbb)},{'$group':{'_id':_0x4d93c6(0x14f),'name':{'$first':_0x4d93c6(0xd5)},'product_stock':{'$first':_0x4d93c6(0x14a)},'bay':{'$first':_0x4d93c6(0x179)},'bin':{'$first':_0x4d93c6(0x73)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4d93c6(0x10c)},'primary_code':{'$first':_0x4d93c6(0x119)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4d93c6(0x78)},'storage':{'$first':_0x4d93c6(0xa1)},'rack':{'$first':_0x4d93c6(0x74)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x4d93c6(0xb4)}}}]),_0x17d1a3=await customer[_0x4d93c6(0x11c)]({});let _0x469196;if(_0x34a16f[_0x4d93c6(0x86)]==_0x4d93c6(0x9e)){const _0x23dc1=await staff[_0x4d93c6(0x150)]({'email':_0x34a16f[_0x4d93c6(0xd6)]});_0x469196=await warehouse['aggregate']([{'$match':{'status':_0x4d93c6(0x14c),'name':_0x23dc1[_0x4d93c6(0x9a)]}},{'$group':{'_id':_0x4d93c6(0xf4),'name':{'$first':_0x4d93c6(0xf4)}}}]);}else _0x469196=await warehouse[_0x4d93c6(0x162)]([{'$match':{'status':_0x4d93c6(0x14c)}},{'$group':{'_id':_0x4d93c6(0xf4),'name':{'$first':_0x4d93c6(0xf4)}}}]);const _0x1b0d05=await product[_0x4d93c6(0x11c)]({}),_0x38be33=await suppliers[_0x4d93c6(0x11c)]({});if(_0x4d90e6[0x0][_0x4d93c6(0xf8)]==_0x4d93c6(0x159)){var _0x3d293c=users['English'];console[_0x4d93c6(0x112)](_0x3d293c);}else{if(_0x4d90e6[0x0][_0x4d93c6(0xf8)]=='Hindi')var _0x3d293c=users[_0x4d93c6(0xe1)];else{if(_0x4d90e6[0x0]['language']==_0x4d93c6(0xbd))var _0x3d293c=users['German'];else{if(_0x4d90e6[0x0][_0x4d93c6(0xf8)]==_0x4d93c6(0xf7))var _0x3d293c=users['Spanish'];else{if(_0x4d90e6[0x0][_0x4d93c6(0xf8)]=='French')var _0x3d293c=users[_0x4d93c6(0x126)];else{if(_0x4d90e6[0x0][_0x4d93c6(0xf8)]==_0x4d93c6(0xdd))var _0x3d293c=users['Portuguese'];else{if(_0x4d90e6[0x0][_0x4d93c6(0xf8)]==_0x4d93c6(0x123))var _0x3d293c=users[_0x4d93c6(0x123)];else{if(_0x4d90e6[0x0]['language']=='Arabic\x20(ae)')var _0x3d293c=users[_0x4d93c6(0x151)];}}}}}}}_0x947698[_0x4d93c6(0x13d)](_0x4d93c6(0x118),{'success':_0x35dc7e[_0x4d93c6(0x76)](_0x4d93c6(0xd8)),'errors':_0x35dc7e[_0x4d93c6(0x76)](_0x4d93c6(0xab)),'role':_0x34a16f,'profile':_0xfdf7d3,'customer':_0x17d1a3,'warehouse':_0x469196,'product':_0xb65a4c,'user':_0x537339,'master_shop':_0x4d90e6,'unit':_0x1b0d05,'language':_0x3d293c,'suppliers':_0x38be33});}catch(_0x57df1f){console['log'](_0x57df1f);}}),router[a0_0x82d35a(0x172)](a0_0x82d35a(0x103),auth,async(_0x189e33,_0x43fd73)=>{var _0x2210f3=a0_0x82d35a;try{const _0x1f401b=_0x189e33[_0x2210f3(0x17a)]['id'],{invoice:_0x300e72,warehouse_name:_0xf8c93a,room:_0xe16e05}=_0x189e33[_0x2210f3(0x15d)],_0x610767=await sales[_0x2210f3(0x150)]({'invoice':_0x300e72}),_0x2d30ec=_0x610767[_0x2210f3(0x12a)]['map'](async _0x43fd9c=>{var _0x3d4ed1=_0x2210f3,_0x21840e=await warehouse[_0x3d4ed1(0x150)]({'name':_0xf8c93a,'room':_0x43fd9c[_0x3d4ed1(0xe7)],'warehouse_category':'Raw\x20Materials'});const _0x403cd8=_0x21840e[_0x3d4ed1(0x125)][_0x3d4ed1(0xd3)](_0x26bc06=>{var _0x339d01=_0x3d4ed1;_0x26bc06[_0x339d01(0x145)]==_0x43fd9c['product_name']&&_0x26bc06[_0x339d01(0x158)]==_0x43fd9c['floorlevel']&&_0x26bc06['type']==_0x43fd9c['type']&&_0x26bc06[_0x339d01(0x156)]==_0x43fd9c[_0x339d01(0x156)]&&_0x26bc06[_0x339d01(0x16c)]==_0x43fd9c[_0x339d01(0x16c)]&&_0x26bc06[_0x339d01(0x165)]==_0x43fd9c[_0x339d01(0x165)]&&_0x26bc06[_0x339d01(0x10e)]==_0x43fd9c[_0x339d01(0x10e)]&&_0x26bc06[_0x339d01(0xad)]==_0x43fd9c['expiry_date']&&_0x26bc06['batch_code']==_0x43fd9c[_0x339d01(0x161)]&&_0x26bc06[_0x339d01(0x140)]==_0x43fd9c[_0x339d01(0x140)]&&_0x26bc06[_0x339d01(0xa6)]==_0x43fd9c[_0x339d01(0x13f)]&&(_0x26bc06[_0x339d01(0x106)]=Math['max'](0x0,Math[_0x339d01(0x122)](_0x26bc06[_0x339d01(0x106)])-Math['abs'](_0x43fd9c[_0x339d01(0x176)])));});return _0x21840e;});Promise[_0x2210f3(0x17c)](_0x2d30ec)[_0x2210f3(0xdf)](async _0x22b3b9=>{var _0x3b6333=_0x2210f3;try{for(const _0x16cf5c of _0x22b3b9){await _0x16cf5c['save']();}_0x610767['finalize']=_0x3b6333(0x94);const _0x14cd0d=await _0x610767['save'](),_0xb3d8d2=await master_shop['find'](),_0x47159a=await email_settings[_0x3b6333(0x150)](),_0x41eb52=await supervisor_settings[_0x3b6333(0x11c)]();var _0x1c1f6d=_0x610767[_0x3b6333(0x12a)],_0x4b6a21='',_0x35a808;for(_0x35a808 in _0x1c1f6d){_0x4b6a21+=_0x3b6333(0x124)+_0x3b6333(0x163)+_0x1c1f6d[_0x35a808][_0x3b6333(0x145)]+_0x3b6333(0x83)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1c1f6d[_0x35a808]['product_code']+'</td>'+_0x3b6333(0x163)+_0x1c1f6d[_0x35a808]['quantity']+_0x3b6333(0x83)+_0x3b6333(0x163)+_0x1c1f6d[_0x35a808][_0x3b6333(0x142)]+_0x3b6333(0x83)+_0x3b6333(0x163)+_0x1c1f6d[_0x35a808]['secondary_unit']+_0x3b6333(0x83)+_0x3b6333(0x163)+_0x610767[_0x3b6333(0x10f)]+_0x3b6333(0x83)+_0x3b6333(0x163)+_0x1c1f6d[_0x35a808][_0x3b6333(0xe7)]+_0x3b6333(0x83)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1c1f6d[_0x35a808][_0x3b6333(0x10e)]+_0x1c1f6d[_0x35a808]['rack']+_0x1c1f6d[_0x35a808][_0x3b6333(0x16c)]+_0x1c1f6d[_0x35a808]['bin']+_0x1c1f6d[_0x35a808][_0x3b6333(0xca)][0x0]+_0x1c1f6d[_0x35a808]['floorlevel']+'</td>',_0x3b6333(0xb5);}let _0x5b8729=nodemailer[_0x3b6333(0x90)]({'host':_0x47159a[_0x3b6333(0xac)],'port':Number(_0x47159a[_0x3b6333(0x8f)]),'secure':![],'auth':{'user':_0x47159a[_0x3b6333(0xd6)],'pass':_0x47159a[_0x3b6333(0x89)]}}),_0x194f45={'from':_0x47159a[_0x3b6333(0xd6)],'to':_0x41eb52[0x0][_0x3b6333(0x110)],'subject':_0x3b6333(0x134),'attachments':[{'filename':_0x3b6333(0x79),'path':__dirname+_0x3b6333(0x7d)+'/upload/'+_0xb3d8d2[0x0][_0x3b6333(0xde)],'cid':_0x3b6333(0xf2)}],'html':_0x3b6333(0x82)+_0x3b6333(0x108)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x3b6333(0x12f)+_0x3b6333(0x8a)+_0x3b6333(0x16b)+_0x3b6333(0x137)+_0xb3d8d2[0x0][_0x3b6333(0x107)]+_0x3b6333(0xf1)+_0x3b6333(0x8a)+_0x3b6333(0x8a)+_0x3b6333(0x7a)+_0x3b6333(0x16b)+_0x3b6333(0xb0)+_0x3b6333(0xb8)+_0x610767['invoice']+'\x20'+_0x3b6333(0x7c)+_0x3b6333(0xa7)+_0x610767[_0x3b6333(0xc3)]+'\x20'+_0x3b6333(0x155)+_0x3b6333(0xa9)+'</div>'+_0x3b6333(0x160)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3b6333(0x124)+_0x3b6333(0x16f)+_0x3b6333(0x8c)+_0x3b6333(0xb2)+_0x3b6333(0x10b)+_0x3b6333(0xd2)+_0x3b6333(0x14b)+_0x3b6333(0x147)+_0x3b6333(0x11a)+_0x3b6333(0xb5)+_0x3b6333(0xc7)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4b6a21+'\x20'+_0x3b6333(0x14d)+'</table>'+_0x3b6333(0x16b)+_0x3b6333(0x174)+'<h5>'+_0xb3d8d2[0x0][_0x3b6333(0x107)]+_0x3b6333(0xa9)+_0x3b6333(0x8a)+_0x3b6333(0x8a)+'</body></html>'};_0x5b8729[_0x3b6333(0x164)](_0x194f45,function(_0x43487c,_0x447ea5){var _0x5c4d33=_0x3b6333;_0x43487c?(console['log'](_0x43487c),console[_0x5c4d33(0x112)](_0x5c4d33(0xe9))):console[_0x5c4d33(0x112)]('Email\x20sent\x20successfully');}),_0x189e33[_0x3b6333(0x76)](_0x3b6333(0xd8),_0x3b6333(0x17f)),_0x43fd73[_0x3b6333(0x13e)]('/all_sales/preview/'+_0x1f401b);}catch(_0x297f5d){console[_0x3b6333(0x180)](_0x297f5d),_0x43fd73[_0x3b6333(0x11f)](0x1f4)['json']({'error':_0x3b6333(0x81)});}})['catch'](_0xb7b9a4=>{var _0x3c456a=_0x2210f3;console[_0x3c456a(0x180)](_0xb7b9a4),_0x43fd73[_0x3c456a(0x11f)](0x1f4)[_0x3c456a(0x96)]({'error':_0x3c456a(0x16a)});});}catch(_0x1e1c4d){console[_0x2210f3(0x112)](_0x1e1c4d);}}),router['get'](a0_0x82d35a(0xe8),auth,async(_0x393ec0,_0x2379cb)=>{var _0x36e0d8=a0_0x82d35a;try{const {username:_0x242415,email:_0x5acfcf,role:_0x1f8504}=_0x393ec0[_0x36e0d8(0x12e)],_0x1ce9dc=_0x393ec0[_0x36e0d8(0x12e)],_0x2c3168=await profile[_0x36e0d8(0x150)]({'email':_0x1ce9dc[_0x36e0d8(0xd6)]}),_0x113818=await master_shop['find'](),_0x556c6e=_0x393ec0[_0x36e0d8(0x17a)]['id'],_0x5c9d13=await sales['findById'](_0x556c6e);var _0x1ac94b=[_0x36e0d8(0xa0),'Enclosed'];const _0x444282=await warehouse[_0x36e0d8(0x162)]([{'$match':{'name':_0x5c9d13[_0x36e0d8(0x10f)],'warehouse_category':_0x36e0d8(0xea)}},{'$unwind':_0x36e0d8(0xbb)},{'$group':{'_id':_0x36e0d8(0x14f),'name':{'$first':_0x36e0d8(0xd5)},'product_stock':{'$first':_0x36e0d8(0x14a)},'bay':{'$first':_0x36e0d8(0x179)},'bin':{'$first':_0x36e0d8(0x73)},'type':{'$first':_0x36e0d8(0xb6)},'floorlevel':{'$first':_0x36e0d8(0x10c)},'primary_code':{'$first':_0x36e0d8(0x119)},'secondary_code':{'$first':_0x36e0d8(0x95)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x36e0d8(0x74)}}}]),_0x7f636f=await customer['find']({});let _0x4df208;if(_0x1ce9dc['role']==_0x36e0d8(0x9e)){const _0x2a15a7=await staff[_0x36e0d8(0x150)]({'email':_0x1ce9dc[_0x36e0d8(0xd6)]});_0x4df208=await warehouse[_0x36e0d8(0x162)]([{'$match':{'status':'Enabled','name':_0x2a15a7['warehouse'],'warehouse_category':_0x36e0d8(0xea)}},{'$group':{'_id':'$name','name':{'$first':_0x36e0d8(0xf4)}}}]);}else _0x4df208=await warehouse[_0x36e0d8(0x162)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x36e0d8(0xf4),'name':{'$first':_0x36e0d8(0xf4)}}}]);const _0xca934d=await product[_0x36e0d8(0x11c)]({});if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0x159)){var _0xbdc795=users[_0x36e0d8(0x131)];console[_0x36e0d8(0x112)](_0xbdc795);}else{if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0xe1))var _0xbdc795=users[_0x36e0d8(0xe1)];else{if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0xbd))var _0xbdc795=users[_0x36e0d8(0xbd)];else{if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0xf7))var _0xbdc795=users['Spanish'];else{if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0x126))var _0xbdc795=users[_0x36e0d8(0x126)];else{if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0xdd))var _0xbdc795=users['Portuguese'];else{if(_0x113818[0x0][_0x36e0d8(0xf8)]==_0x36e0d8(0x123))var _0xbdc795=users[_0x36e0d8(0x123)];else{if(_0x113818[0x0]['language']==_0x36e0d8(0x80))var _0xbdc795=users[_0x36e0d8(0x151)];}}}}}}}_0x2379cb['render'](_0x36e0d8(0xaf),{'success':_0x393ec0[_0x36e0d8(0x76)]('success'),'errors':_0x393ec0['flash']('errors'),'role':_0x1ce9dc,'profile':_0x2c3168,'customer':_0x7f636f,'warehouse':_0x4df208,'product':_0x444282,'user':_0x5c9d13,'master_shop':_0x113818,'unit':_0xca934d,'language':_0xbdc795});}catch(_0x4d6334){console[_0x36e0d8(0x112)](_0x4d6334);}}),router['post'](a0_0x82d35a(0xe8),auth,async(_0x2c2b4c,_0x4a0522)=>{var _0x59d8f6=a0_0x82d35a;try{const _0x1177c4=_0x2c2b4c[_0x59d8f6(0x17a)]['id'],_0x17befe=await sales[_0x59d8f6(0x150)]({'_id':_0x2c2b4c['params']['id']}),_0x11cc93=await warehouse[_0x59d8f6(0x150)]({'name':_0x17befe[_0x59d8f6(0x10f)],'room':_0x2c2b4c[_0x59d8f6(0x15d)]['room']}),{invoice:_0x14efc5,date:_0x2505fa,warehouse_name:_0x359d91,product_name:_0x1482da,stock:_0x24431e,quantity:_0x1bf946,note:_0x1fac12,room:_0x37a743,customer:_0x24dbb3,SCRN:_0x4e8640}=_0x2c2b4c[_0x59d8f6(0x15d)];if(typeof _0x1482da=='string')var _0x5e8e15=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x145)]],_0x3c2e55=[_0x2c2b4c[_0x59d8f6(0x15d)]['stock']],_0x4c7954=[_0x2c2b4c['body'][_0x59d8f6(0xe4)]],_0x4132f6=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x102)]],_0x2744d0=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xa5)]],_0x287337=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x8b)]],_0xfc5bcc=[_0x2c2b4c['body'][_0x59d8f6(0xe5)]],_0x137677=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x166)]],_0x41b74e=[_0x2c2b4c['body'][_0x59d8f6(0xd0)]],_0x1d26fe=[_0x2c2b4c['body']['batch_code']],_0x288c2e=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xad)]],_0x52091f=[_0x2c2b4c['body'][_0x59d8f6(0xfb)]],_0x4ec9a0=[_0x2c2b4c['body'][_0x59d8f6(0x113)]],_0x3df8c8=[_0x2c2b4c['body']['requested_qty']],_0x561818=[_0x2c2b4c['body'][_0x59d8f6(0x120)]],_0x570363=[_0x2c2b4c[_0x59d8f6(0x15d)]['delivery_code']],_0x593d47=[_0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x132)]],_0xad7403=[_0x2c2b4c[_0x59d8f6(0x15d)]['quantity']],_0x18eec7=[_0x2c2b4c['body']['RoomAssigned']];else var _0x5e8e15=[..._0x2c2b4c['body'][_0x59d8f6(0x145)]],_0x3c2e55=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xe6)]],_0x4c7954=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xe4)]],_0x4132f6=[..._0x2c2b4c['body'][_0x59d8f6(0x102)]],_0x2744d0=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xa5)]],_0x287337=[..._0x2c2b4c[_0x59d8f6(0x15d)]['prod_code']],_0xfc5bcc=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xe5)]],_0x137677=[..._0x2c2b4c['body']['primary_unit']],_0x41b74e=[..._0x2c2b4c['body']['secondary_unit']],_0x1d26fe=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x161)]],_0x288c2e=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0xad)]],_0x52091f=[..._0x2c2b4c['body']['max_per_unit']],_0x4ec9a0=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x113)]],_0x3df8c8=[..._0x2c2b4c[_0x59d8f6(0x15d)]['requested_qty']],_0x561818=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x120)]],_0x570363=[..._0x2c2b4c[_0x59d8f6(0x15d)]['delivery_code']],_0x593d47=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x132)]],_0xad7403=[..._0x2c2b4c['body']['quantity']],_0x18eec7=[..._0x2c2b4c[_0x59d8f6(0x15d)][_0x59d8f6(0x17e)]];const _0x319608=_0x5e8e15[_0x59d8f6(0xd3)](_0x41b103=>{return _0x41b103={'product_name':_0x41b103};});_0x3c2e55['forEach']((_0x4cc966,_0x12a055)=>{var _0x5efb3a=_0x59d8f6;_0x319608[_0x12a055][_0x5efb3a(0xe6)]=Math[_0x5efb3a(0x122)](_0x4cc966);}),_0x4c7954[_0x59d8f6(0x146)]((_0xbb6338,_0x29281e)=>{var _0x1c3dc3=_0x59d8f6;_0x319608[_0x29281e][_0x1c3dc3(0x176)]=_0xbb6338;}),_0x4132f6[_0x59d8f6(0x146)]((_0x28020a,_0x53d84e)=>{var _0xace8c0=_0x59d8f6;_0x319608[_0x53d84e][_0xace8c0(0x102)]=_0x28020a;}),_0x2744d0['forEach']((_0x17a0ed,_0x1b87ec)=>{var _0x27e974=_0x59d8f6;_0x319608[_0x1b87ec][_0x27e974(0xa5)]=_0x17a0ed;}),_0x287337['forEach']((_0x5f01e7,_0x1813b0)=>{var _0x20e004=_0x59d8f6;_0x319608[_0x1813b0][_0x20e004(0x10a)]=_0x5f01e7;}),_0xfc5bcc['forEach']((_0x37adf5,_0x26c1cb)=>{var _0x22cf1e=_0x59d8f6;_0x18eec7[_0x22cf1e(0x146)]((_0x394766,_0x10ccec)=>{var _0x2e5f9a=_0x22cf1e;if(_0x394766==_0x2e5f9a(0x16e)&&_0x26c1cb==_0x10ccec){var _0x527b34=_0x37adf5[_0x2e5f9a(0xc0)](0x3);_0x319608[_0x26c1cb][_0x2e5f9a(0x10e)]=_0x37adf5[0x0],_0x319608[_0x26c1cb][_0x2e5f9a(0x165)]=_0x37adf5[0x1],_0x319608[_0x26c1cb][_0x2e5f9a(0x16c)]=0x0,_0x319608[_0x26c1cb][_0x2e5f9a(0x156)]=0x0,_0x319608[_0x26c1cb][_0x2e5f9a(0xca)]='Floor',_0x319608[_0x26c1cb][_0x2e5f9a(0x158)]=_0x527b34;}else{if(_0x394766==_0x2e5f9a(0x13a)&&_0x26c1cb==_0x10ccec){var _0x527b34=_0x37adf5[_0x2e5f9a(0xc0)](0x3);_0x319608[_0x26c1cb][_0x2e5f9a(0x10e)]=_0x37adf5[0x0],_0x319608[_0x26c1cb][_0x2e5f9a(0x165)]=_0x37adf5[0x1],_0x319608[_0x26c1cb][_0x2e5f9a(0x16c)]=0x0,_0x319608[_0x26c1cb][_0x2e5f9a(0x156)]=0x0,_0x319608[_0x26c1cb][_0x2e5f9a(0xca)]=_0x2e5f9a(0xc6),_0x319608[_0x26c1cb][_0x2e5f9a(0x158)]=_0x37adf5[0x5];}else{if(_0x26c1cb==_0x10ccec){var _0x1ad1ff;if(_0x37adf5[0x4]=='L')_0x1ad1ff=_0x2e5f9a(0x109);else _0x37adf5[0x4]=='F'&&(_0x1ad1ff='Floor');_0x319608[_0x26c1cb][_0x2e5f9a(0x10e)]=_0x37adf5[0x0],_0x319608[_0x26c1cb][_0x2e5f9a(0x165)]=_0x37adf5[0x1],_0x319608[_0x26c1cb][_0x2e5f9a(0x16c)]=_0x37adf5[0x2],_0x319608[_0x26c1cb]['bin']=_0x37adf5[0x3],_0x319608[_0x26c1cb][_0x2e5f9a(0xca)]=_0x1ad1ff,_0x319608[_0x26c1cb]['floorlevel']=_0x37adf5[0x5];}}}});}),_0x137677[_0x59d8f6(0x146)]((_0x65538d,_0x5ce768)=>{var _0x407aca=_0x59d8f6;_0x319608[_0x5ce768][_0x407aca(0x142)]=_0x65538d;}),_0x41b74e[_0x59d8f6(0x146)]((_0x3d31f9,_0x4f3100)=>{var _0x4da168=_0x59d8f6;_0x319608[_0x4f3100][_0x4da168(0xd0)]=_0x3d31f9;}),_0x1d26fe[_0x59d8f6(0x146)]((_0x57cb9b,_0x3121c0)=>{_0x319608[_0x3121c0]['batch_code']=_0x57cb9b;}),_0x288c2e['forEach']((_0x5e0e0c,_0x40736f)=>{var _0x12a1a6=_0x59d8f6;_0x319608[_0x40736f][_0x12a1a6(0xad)]=_0x5e0e0c;}),_0x52091f[_0x59d8f6(0x146)]((_0x42dada,_0x42c546)=>{var _0x394ec6=_0x59d8f6;_0x319608[_0x42c546][_0x394ec6(0x9b)]=_0x42dada;}),_0x4ec9a0[_0x59d8f6(0x146)]((_0x5323d1,_0x492b36)=>{var _0x1d2ad4=_0x59d8f6;_0x319608[_0x492b36][_0x1d2ad4(0x113)]=_0x5323d1;}),_0x3df8c8[_0x59d8f6(0x146)]((_0x529417,_0x20475c)=>{var _0x4f0bae=_0x59d8f6;_0x319608[_0x20475c]['requested_qty']=Math[_0x4f0bae(0x122)](_0x529417);}),_0x561818[_0x59d8f6(0x146)]((_0x47029b,_0x24663e)=>{var _0x4ed57c=_0x59d8f6;_0x319608[_0x24663e][_0x4ed57c(0x120)]=_0x47029b;}),_0x570363[_0x59d8f6(0x146)]((_0x50b651,_0x5d3f4b)=>{_0x319608[_0x5d3f4b]['delivery_code']=_0x50b651;}),_0x593d47[_0x59d8f6(0x146)]((_0x25874c,_0x1e4ef0)=>{var _0x1ea422=_0x59d8f6;_0x319608[_0x1e4ef0][_0x1ea422(0x132)]=_0x25874c;}),_0xad7403[_0x59d8f6(0x146)]((_0x351144,_0x14f96d)=>{_0x319608[_0x14f96d]['quantity_notConverted']=_0x351144;}),_0x18eec7[_0x59d8f6(0x146)]((_0x52c1a3,_0x24e5f4)=>{var _0x52e3ad=_0x59d8f6;_0x319608[_0x24e5f4][_0x52e3ad(0xe7)]=_0x52c1a3;});var _0x1628ce=0x0;_0x319608[_0x59d8f6(0x146)](_0x4e1bdd=>{var _0x59df06=_0x59d8f6;console[_0x59df06(0x112)](_0x59df06(0x77),_0x4e1bdd),(parseInt(_0x4e1bdd['stock'])<parseInt(_0x4e1bdd[_0x59df06(0x176)])||parseInt(_0x4e1bdd[_0x59df06(0x176)])==0x0)&&_0x1628ce++;});if(_0x1628ce!=0x0)return _0x2c2b4c['flash'](_0x59d8f6(0xab),_0x59d8f6(0x14e)),_0x4a0522[_0x59d8f6(0x13e)](_0x59d8f6(0x12d));const _0x40f9c4=_0x319608[_0x59d8f6(0x139)](_0x804274=>_0x804274[_0x59d8f6(0x176)]!=='0'&&_0x804274[_0x59d8f6(0x176)]!=='');_0x17befe['invoice']=_0x14efc5,_0x17befe[_0x59d8f6(0x75)]=_0x24dbb3,_0x17befe[_0x59d8f6(0xc3)]=_0x2505fa,_0x17befe[_0x59d8f6(0x10f)]=_0x359d91,_0x17befe[_0x59d8f6(0x12a)]=_0x40f9c4,_0x17befe[_0x59d8f6(0x8e)]=_0x1fac12,_0x17befe[_0x59d8f6(0x143)]=_0x4e8640,_0x17befe['finalize']=_0x59d8f6(0xbc),_0x17befe[_0x59d8f6(0xe3)]='False';const _0x1773a3=await _0x17befe[_0x59d8f6(0x114)]();_0x2c2b4c[_0x59d8f6(0x76)](_0x59d8f6(0xd8),'Sales\x20Update\x20successfully'),_0x4a0522['redirect'](_0x59d8f6(0x152));}catch(_0x46f0d9){console['log'](_0x46f0d9);}}),router['post']('/give_payment/:id',auth,async(_0x250b1f,_0x2de3cb)=>{var _0x3afd38=a0_0x82d35a;try{const _0x433652=_0x250b1f[_0x3afd38(0x17a)]['id'],{invoice:_0x523992,customer:_0xe972fd,receivable_amount:_0x43764c,received_amount:_0x5d4f6a}=_0x250b1f[_0x3afd38(0x15d)],_0x1b89a1=await sales['findById'](_0x433652);console[_0x3afd38(0x112)](_0x1b89a1);var _0x4d1371=_0x43764c-_0x5d4f6a;console[_0x3afd38(0x112)](_0x5d4f6a),_0x1b89a1['received_amount']=parseFloat(_0x5d4f6a)+parseFloat(_0x1b89a1['received_amount']),_0x1b89a1[_0x3afd38(0x111)]=_0x4d1371,console[_0x3afd38(0x112)](_0x1b89a1);const _0x4dc68d=await _0x1b89a1[_0x3afd38(0x114)](),_0x4698b3=await c_payment_data[_0x3afd38(0x150)]({'invoice':_0x523992});_0x4698b3[_0x3afd38(0x15f)]=_0x4d1371,await _0x4698b3[_0x3afd38(0x114)]();let _0x10ce80=new Date(),_0x171cb4=('0'+_0x10ce80['getDate']())[_0x3afd38(0xc0)](-0x2),_0x26d27d=('0'+(_0x10ce80[_0x3afd38(0xfa)]()+0x1))['slice'](-0x2),_0x260c66=_0x10ce80[_0x3afd38(0xbe)](),_0x1dd3b1=_0x260c66+'-'+_0x26d27d+'-'+_0x171cb4;const _0x21ffb3=new customer_payment({'invoice':_0x523992,'date':_0x260c66+'-'+_0x26d27d+'-'+_0x171cb4,'customer':_0xe972fd,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x5d4f6a}),_0x30fc1a=await _0x21ffb3[_0x3afd38(0x114)]();_0x250b1f['flash'](_0x3afd38(0xd8),_0x3afd38(0x127)),_0x2de3cb[_0x3afd38(0x13e)](_0x3afd38(0x152));}catch(_0x3fa96d){console[_0x3afd38(0x112)](_0x3fa96d);}}),router[a0_0x82d35a(0x141)](a0_0x82d35a(0x88),auth,async(_0x1c36e8,_0x5ae5af)=>{var _0x2b35f8=a0_0x82d35a;try{const {username:_0x4e17f2,email:_0x3a956d,role:_0x5f4c17}=_0x1c36e8[_0x2b35f8(0x12e)],_0x20bde3=_0x1c36e8[_0x2b35f8(0x12e)],_0x1cf4f2=await profile[_0x2b35f8(0x150)]({'email':_0x20bde3['email']}),_0x452d7c=await master_shop[_0x2b35f8(0x11c)]();console[_0x2b35f8(0x112)](_0x2b35f8(0xda),_0x452d7c);const _0x244119=_0x1c36e8[_0x2b35f8(0x17a)]['id'],_0x2528c7=await sales[_0x2b35f8(0x148)](_0x244119);console[_0x2b35f8(0x112)](_0x2528c7);const _0x1993e5=await customer[_0x2b35f8(0x150)]({'name':_0x2528c7['customer']});console[_0x2b35f8(0x112)](_0x1993e5);if(_0x452d7c[0x0][_0x2b35f8(0xf8)]==_0x2b35f8(0x159)){var _0x246e7d=users[_0x2b35f8(0x131)];console[_0x2b35f8(0x112)](_0x246e7d);}else{if(_0x452d7c[0x0][_0x2b35f8(0xf8)]==_0x2b35f8(0xe1))var _0x246e7d=users[_0x2b35f8(0xe1)];else{if(_0x452d7c[0x0]['language']==_0x2b35f8(0xbd))var _0x246e7d=users['German'];else{if(_0x452d7c[0x0][_0x2b35f8(0xf8)]=='Spanish')var _0x246e7d=users[_0x2b35f8(0xf7)];else{if(_0x452d7c[0x0][_0x2b35f8(0xf8)]==_0x2b35f8(0x126))var _0x246e7d=users['French'];else{if(_0x452d7c[0x0]['language']==_0x2b35f8(0xdd))var _0x246e7d=users[_0x2b35f8(0xc4)];else{if(_0x452d7c[0x0][_0x2b35f8(0xf8)]==_0x2b35f8(0x123))var _0x246e7d=users['Chinese'];else{if(_0x452d7c[0x0]['language']==_0x2b35f8(0x80))var _0x246e7d=users[_0x2b35f8(0x151)];}}}}}}}_0x5ae5af[_0x2b35f8(0x13d)]('sales_invoice',{'success':_0x1c36e8['flash'](_0x2b35f8(0xd8)),'errors':_0x1c36e8[_0x2b35f8(0x76)](_0x2b35f8(0xab)),'role':_0x20bde3,'profile':_0x1cf4f2,'master_shop':_0x452d7c,'customers':_0x1993e5,'sales':_0x2528c7,'language':_0x246e7d});}catch(_0x319ffa){console[_0x2b35f8(0x112)](_0x319ffa);}}),router[a0_0x82d35a(0x141)](a0_0x82d35a(0x167),auth,async(_0x3848ad,_0x3c26ba)=>{var _0x5d986a=a0_0x82d35a;try{const {username:_0x982ce7,email:_0x14cf4e,role:_0x587d63}=_0x3848ad[_0x5d986a(0x12e)],_0x269ae0=_0x3848ad[_0x5d986a(0x12e)],_0x598747=await profile[_0x5d986a(0x150)]({'email':_0x269ae0['email']}),_0x575485=await master_shop[_0x5d986a(0x11c)]();console[_0x5d986a(0x112)]('master',_0x575485);const _0x22ee28=_0x3848ad[_0x5d986a(0x17a)]['id'];console[_0x5d986a(0x112)](_0x22ee28);const _0x25ae2e=await sales[_0x5d986a(0x148)](_0x22ee28);console['log'](_0x5d986a(0x182),_0x25ae2e);const _0x4e07d7=await warehouse[_0x5d986a(0x162)]([{'$match':{'name':_0x5d986a(0xeb),'room':_0x5d986a(0xb3)}},{'$unwind':_0x5d986a(0xbb)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5d986a(0x14a)},'level':{'$first':_0x5d986a(0x12c)},'isle':{'$first':_0x5d986a(0x116)},'pallet':{'$first':_0x5d986a(0x177)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x5d986a(0x112)]('stock_data',_0x4e07d7);const _0x14dd24=await product[_0x5d986a(0x11c)]({});warehouse_data=await warehouse[_0x5d986a(0x162)]([{'$match':{'status':_0x5d986a(0x14c),'name':_0x5d986a(0xeb),'warehouse_category':_0x5d986a(0xea)}},{'$group':{'_id':'$name','name':{'$first':_0x5d986a(0xf4)}}},{'$sort':{'name':0x1}}]);var _0xdf890e=[_0x5d986a(0xb3)];if(_0x575485[0x0]['language']==_0x5d986a(0x159)){var _0x104208=users[_0x5d986a(0x131)];console[_0x5d986a(0x112)](_0x104208);}else{if(_0x575485[0x0]['language']==_0x5d986a(0xe1))var _0x104208=users[_0x5d986a(0xe1)];else{if(_0x575485[0x0]['language']==_0x5d986a(0xbd))var _0x104208=users[_0x5d986a(0xbd)];else{if(_0x575485[0x0][_0x5d986a(0xf8)]==_0x5d986a(0xf7))var _0x104208=users['Spanish'];else{if(_0x575485[0x0]['language']==_0x5d986a(0x126))var _0x104208=users[_0x5d986a(0x126)];else{if(_0x575485[0x0][_0x5d986a(0xf8)]==_0x5d986a(0xdd))var _0x104208=users[_0x5d986a(0xc4)];else{if(_0x575485[0x0]['language']==_0x5d986a(0x123))var _0x104208=users[_0x5d986a(0x123)];else{if(_0x575485[0x0][_0x5d986a(0xf8)]==_0x5d986a(0x80))var _0x104208=users[_0x5d986a(0x151)];}}}}}}}_0x3c26ba[_0x5d986a(0x13d)](_0x5d986a(0xd1),{'success':_0x3848ad['flash'](_0x5d986a(0xd8)),'errors':_0x3848ad[_0x5d986a(0x76)](_0x5d986a(0xab)),'role':_0x269ae0,'profile':_0x598747,'user':_0x25ae2e,'stock':_0x4e07d7,'master_shop':_0x575485,'unit':_0x14dd24,'language':_0x104208,'warehouses':warehouse_data,'rooms':_0xdf890e});}catch(_0x4f417e){console[_0x5d986a(0x112)](_0x4f417e),_0x3c26ba[_0x5d986a(0x11f)](0xc8)[_0x5d986a(0x96)]({'message':_0x4f417e[_0x5d986a(0xc2)]});}}),router['post'](a0_0x82d35a(0x167),auth,async(_0x205455,_0x56f53e)=>{var _0x5276ec=a0_0x82d35a;try{const {invoice:_0x2d07f5,date:_0x2a941f,warehouse_name:_0xa9bff,product_name:_0x30e955,primary_code:_0x586a84,secondary_code:_0x3d3729,product_code:_0x3be192,sales_quantity:_0x266ed6,stocks:_0x29378c,return_qty:_0x494733,Room_name:_0x296cfd,to_warehouse_name:_0x3c2dfe,to_Roomname:_0xef01ce,to_Room_name:_0x1212fa,note:_0x260fff,level:_0xd1797a,isle:_0x589a69,pallet:_0x238547}=_0x205455[_0x5276ec(0x15d)];if(typeof _0x30e955=='string')var _0x29a738=[_0x205455[_0x5276ec(0x15d)]['product_name']],_0x1463d2=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x102)]],_0x580f10=[_0x205455['body'][_0x5276ec(0xa5)]],_0x52823e=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x10a)]],_0x5a7da8=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x136)]],_0x3ee4f1=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x9f)]],_0x4fe7cd=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x138)]],_0x146c5d=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x16c)]],_0x5cb366=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x156)]],_0x3a48bb=[_0x205455['body']['types']],_0x46e3f2=[_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x158)]];else var _0x29a738=[..._0x205455['body'][_0x5276ec(0x145)]],_0x1463d2=[..._0x205455[_0x5276ec(0x15d)][_0x5276ec(0x102)]],_0x580f10=[..._0x205455[_0x5276ec(0x15d)][_0x5276ec(0xa5)]],_0x52823e=[..._0x205455[_0x5276ec(0x15d)]['product_code']],_0x5a7da8=[..._0x205455['body'][_0x5276ec(0x136)]],_0x3ee4f1=[..._0x205455['body'][_0x5276ec(0x9f)]],_0x4fe7cd=[..._0x205455[_0x5276ec(0x15d)]['return_qty']],_0x146c5d=[..._0x205455[_0x5276ec(0x15d)][_0x5276ec(0x16c)]],_0x5cb366=[..._0x205455[_0x5276ec(0x15d)]['bin']],_0x3a48bb=[..._0x205455[_0x5276ec(0x15d)][_0x5276ec(0x144)]],_0x46e3f2=[..._0x205455[_0x5276ec(0x15d)][_0x5276ec(0x158)]];const _0x31f33e=_0x29a738[_0x5276ec(0xd3)](_0x3b42d0=>{return _0x3b42d0={'product_name':_0x3b42d0};});_0x1463d2['forEach']((_0x5e8660,_0x1c0d66)=>{var _0x90eb65=_0x5276ec;_0x31f33e[_0x1c0d66][_0x90eb65(0x102)]=_0x5e8660;}),_0x580f10[_0x5276ec(0x146)]((_0x521a2f,_0x5c962c)=>{var _0x34f170=_0x5276ec;_0x31f33e[_0x5c962c][_0x34f170(0xa5)]=_0x521a2f;}),_0x52823e['forEach']((_0x5009c3,_0x3cadc4)=>{_0x31f33e[_0x3cadc4]['product_code']=_0x5009c3;}),_0x5a7da8[_0x5276ec(0x146)]((_0x46e7fa,_0x201a27)=>{var _0x46ae43=_0x5276ec;_0x31f33e[_0x201a27][_0x46ae43(0x169)]=_0x46e7fa;}),_0x3ee4f1[_0x5276ec(0x146)]((_0x58ad4f,_0x4a7ae4)=>{var _0x1f8ce2=_0x5276ec;_0x31f33e[_0x4a7ae4][_0x1f8ce2(0xe6)]=_0x58ad4f;}),_0x4fe7cd[_0x5276ec(0x146)]((_0xa5aa1d,_0x5f396e)=>{var _0x28cbe7=_0x5276ec;_0x31f33e[_0x5f396e][_0x28cbe7(0x138)]=_0xa5aa1d;}),_0x146c5d[_0x5276ec(0x146)]((_0x544548,_0x2b5032)=>{_0x31f33e[_0x2b5032]['bay']=_0x544548;}),_0x5cb366['forEach']((_0x55e2e9,_0x44f19c)=>{_0x31f33e[_0x44f19c]['bin']=_0x55e2e9;}),_0x3a48bb['forEach']((_0x59e258,_0x5753ae)=>{_0x31f33e[_0x5753ae]['type']=_0x59e258;}),_0x46e3f2[_0x5276ec(0x146)]((_0xed6e6a,_0x57c834)=>{var _0x5de89c=_0x5276ec;_0x31f33e[_0x57c834][_0x5de89c(0x158)]=_0xed6e6a;});var _0x5098e3=0x0;_0x31f33e['forEach'](_0x31c3c2=>{var _0x2112c9=_0x5276ec;console[_0x2112c9(0x112)](_0x2112c9(0x77),_0x31c3c2),(parseInt(_0x31c3c2['sale_qty'])<parseInt(_0x31c3c2[_0x2112c9(0x138)])||parseInt(_0x31c3c2['stock'])<parseInt(_0x31c3c2['return_qty'])&&parseInt(_0x31c3c2[_0x2112c9(0x169)])>parseInt(_0x31c3c2[_0x2112c9(0x138)])||parseInt(_0x31c3c2['return_qty'])==0x0)&&_0x5098e3++;});if(_0x5098e3!=0x0)return _0x205455[_0x5276ec(0x76)](_0x5276ec(0xab),_0x5276ec(0x13b)),_0x56f53e[_0x5276ec(0x13e)](_0x5276ec(0x12d));const _0x14af8e=await sales[_0x5276ec(0x150)]({'invoice':_0x2d07f5});console[_0x5276ec(0x112)](_0x14af8e),_0x14af8e['return_data']=_0x5276ec(0x94);const _0x5c7b26=await _0x14af8e[_0x5276ec(0x114)](),_0xbc46e9=new sales_return({'invoice':_0x2d07f5,'customer':_0x205455[_0x5276ec(0x15d)]['customer'],'date':_0x2a941f,'warehouse_name':_0xa9bff,'room':_0x296cfd,'ToWarehouse':_0x3c2dfe,'ToRoom':_0x1212fa,'return_sale':_0x31f33e,'note':_0x260fff}),_0x5da825=await _0xbc46e9[_0x5276ec(0x114)]();console['log'](_0xbc46e9);const _0x65f492=await sales_return['findOne']({'invoice':_0x2d07f5}),_0x163054=await warehouse[_0x5276ec(0x150)]({'name':_0x3c2dfe,'room':_0x1212fa});_0x65f492[_0x5276ec(0xd1)]['forEach'](_0x47555d=>{var _0xe3d545=_0x5276ec,_0x55611f=0x0;const _0x345354=_0x163054[_0xe3d545(0x125)][_0xe3d545(0xd3)](_0x4c91a1=>{var _0x1c4b01=_0xe3d545;_0x4c91a1[_0x1c4b01(0x145)]==_0x47555d[_0x1c4b01(0x145)]&&_0x4c91a1['floorlevel']==_0x47555d['floorlevel']&&_0x4c91a1[_0x1c4b01(0xca)]==_0x47555d['type']&&_0x4c91a1[_0x1c4b01(0x156)]==_0x47555d['bin']&&_0x4c91a1[_0x1c4b01(0x16c)]==_0x47555d[_0x1c4b01(0x16c)]&&(_0x4c91a1[_0x1c4b01(0x106)]=parseInt(_0x4c91a1[_0x1c4b01(0x106)])+parseInt(_0x47555d['return_qty']),_0x55611f++);});_0x55611f=='0'&&(_0x163054[_0xe3d545(0x125)]=_0x163054[_0xe3d545(0x125)][_0xe3d545(0x168)]({'product_name':_0x47555d[_0xe3d545(0x145)],'product_stock':_0x47555d['return_qty'],'primary_code':_0x47555d['primary_code'],'secondary_code':_0x47555d[_0xe3d545(0xa5)],'product_code':_0x47555d[_0xe3d545(0x10a)],'bay':_0x47555d['bay'],'bin':_0x47555d[_0xe3d545(0x156)],'type':_0x47555d[_0xe3d545(0xca)],'floorlevel':_0x47555d[_0xe3d545(0x158)]})),console[_0xe3d545(0x112)]('final',_0x163054);}),await _0x163054[_0x5276ec(0x114)](),console[_0x5276ec(0x112)](_0x205455[_0x5276ec(0x15d)]);const _0x13dea2=new c_payment_data({'invoice':_0x2d07f5,'customer':_0x205455[_0x5276ec(0x15d)][_0x5276ec(0x75)],'reason':_0x5276ec(0x128)});await _0x13dea2['save']();const _0x5d9dea=await master_shop['find']();console[_0x5276ec(0x112)](_0x5276ec(0x91),_0x5d9dea[0x0][_0x5276ec(0xde)]);const _0x38f51a=await email_settings['findOne'](),_0x378d6d=await customer[_0x5276ec(0x150)]({'name':_0x205455[_0x5276ec(0x15d)]['customer']});console[_0x5276ec(0x112)](_0x5276ec(0xba),_0x378d6d);_0x5d9dea[0x0][_0x5276ec(0xa3)]==0x1?(right_currency=_0x5d9dea[0x0][_0x5276ec(0x181)],left_currency=''):(right_currency='',left_currency=_0x5d9dea[0x0][_0x5276ec(0x181)]);var _0x1aa873=_0x29a738,_0x50607c=_0x4fe7cd,_0x16b835='',_0x5a3fde;for(_0x5a3fde in _0x1aa873){_0x16b835+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1aa873[_0x5a3fde]+_0x5276ec(0x83)+_0x5276ec(0x163)+_0x50607c[_0x5a3fde]+'</td>'+_0x5276ec(0xb5);}console[_0x5276ec(0x112)](_0x5276ec(0x97),_0x16b835);let _0x1fca2a=nodemailer['createTransport']({'service':_0x5276ec(0x10d),'auth':{'user':_0x38f51a[_0x5276ec(0xd6)],'pass':_0x38f51a[_0x5276ec(0x89)]}}),_0x366eba={'from':_0x38f51a[_0x5276ec(0xd6)],'to':_0x378d6d[_0x5276ec(0xd6)],'subject':_0x5276ec(0x117),'attachments':[{'filename':_0x5276ec(0x79),'path':__dirname+'/../public'+'/upload/'+_0x5d9dea[0x0][_0x5276ec(0xde)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5276ec(0x108)+_0x5276ec(0xdb)+_0x5276ec(0x16b)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x5276ec(0x16b)+_0x5276ec(0x137)+_0x5d9dea[0x0][_0x5276ec(0x107)]+'\x20</h2>'+_0x5276ec(0x8a)+_0x5276ec(0x8a)+_0x5276ec(0x7a)+_0x5276ec(0x16b)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5276ec(0xb8)+_0x2d07f5+'\x20'+_0x5276ec(0x7c)+_0x5276ec(0xa7)+_0x2a941f+'\x20'+'</span>'+_0x5276ec(0xa9)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5276ec(0xd4)+_0x5276ec(0x124)+_0x5276ec(0x16f)+_0x5276ec(0x17b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x5276ec(0x9d)+_0x5276ec(0xb5)+_0x5276ec(0xc7)+_0x5276ec(0x7b)+'\x20'+_0x16b835+'\x20'+_0x5276ec(0x14d)+_0x5276ec(0xc1)+_0x5276ec(0x16b)+_0x5276ec(0x174)+'<h5>'+_0x5d9dea[0x0]['site_title']+_0x5276ec(0xa9)+_0x5276ec(0x8a)+_0x5276ec(0x8a)+'</body></html>'};_0x1fca2a['sendMail'](_0x366eba,function(_0x5af16f,_0x4de31e){var _0xcabbe8=_0x5276ec;_0x5af16f?(console[_0xcabbe8(0x112)](_0x5af16f),console['log'](_0xcabbe8(0xe9))):console[_0xcabbe8(0x112)](_0xcabbe8(0xed));}),_0x205455[_0x5276ec(0x76)]('success',_0x5276ec(0x154)),_0x56f53e[_0x5276ec(0x13e)]('/all_sales/view');}catch(_0x50d761){console[_0x5276ec(0x112)](_0x50d761),_0x56f53e[_0x5276ec(0x11f)](0xc8)[_0x5276ec(0x96)]({'message1':_0x50d761[_0x5276ec(0xc2)]});}}),router[a0_0x82d35a(0x141)]('/barcode/:id',auth,async(_0x41236c,_0x23d632)=>{var _0x1a8cc3=a0_0x82d35a;try{const {username:_0x904f9,email:_0xa2df5b,role:_0x31412c}=_0x41236c[_0x1a8cc3(0x12e)],_0x3050e3=_0x41236c[_0x1a8cc3(0x12e)],_0x2967ed=await profile[_0x1a8cc3(0x150)]({'email':_0x3050e3[_0x1a8cc3(0xd6)]}),_0x11c752=await master_shop[_0x1a8cc3(0x11c)]();console[_0x1a8cc3(0x112)](_0x1a8cc3(0xce),_0x11c752);const _0x59fbac=_0x41236c[_0x1a8cc3(0x17a)]['id'],_0x34f02e=await sales[_0x1a8cc3(0x148)](_0x59fbac);console[_0x1a8cc3(0x112)](_0x1a8cc3(0xb7),_0x34f02e);if(_0x11c752[0x0][_0x1a8cc3(0xf8)]==_0x1a8cc3(0x159))var _0x5e7e1d=users[_0x1a8cc3(0x131)];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]=='Hindi')var _0x5e7e1d=users[_0x1a8cc3(0xe1)];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]==_0x1a8cc3(0xbd))var _0x5e7e1d=users['German'];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]=='Spanish')var _0x5e7e1d=users['Spanish'];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]==_0x1a8cc3(0x126))var _0x5e7e1d=users[_0x1a8cc3(0x126)];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]==_0x1a8cc3(0xdd))var _0x5e7e1d=users[_0x1a8cc3(0xc4)];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]==_0x1a8cc3(0x123))var _0x5e7e1d=users[_0x1a8cc3(0x123)];else{if(_0x11c752[0x0][_0x1a8cc3(0xf8)]==_0x1a8cc3(0x80))var _0x5e7e1d=users[_0x1a8cc3(0x151)];}}}}}}}_0x23d632[_0x1a8cc3(0x13d)](_0x1a8cc3(0xcb),{'success':_0x41236c[_0x1a8cc3(0x76)](_0x1a8cc3(0xd8)),'errors':_0x41236c[_0x1a8cc3(0x76)](_0x1a8cc3(0xab)),'role':_0x3050e3,'profile':_0x2967ed,'alldata':_0x34f02e,'master_shop':_0x11c752,'language':_0x5e7e1d});}catch(_0x370ba1){console['log'](_0x370ba1);}}),router['post']('/barcode_scanner',async(_0x36d9b8,_0x1e0121)=>{var _0x2c225c=a0_0x82d35a;const {product_code:_0x1686a2,warehouse_name:_0x573f68,rooms_data:_0x37f92c,Roomslist:_0x152803}=_0x36d9b8[_0x2c225c(0x15d)],_0x255491=_0x152803[_0x2c225c(0xae)](','),_0x51c31f=[];async function _0xa84966(_0x38d04b){var _0x300782=_0x2c225c;const _0x5b2ce2=await warehouse[_0x300782(0x162)]([{'$match':{'name':_0x573f68,'room':_0x38d04b}},{'$unwind':_0x300782(0xbb)},{'$match':{'product_details.primary_code':_0x1686a2}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x300782(0xd5)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x300782(0x119)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x300782(0x78)},'level':{'$first':_0x300782(0x179)},'isle':{'$first':_0x300782(0x73)},'type':{'$first':_0x300782(0xb6)},'pallet':{'$first':_0x300782(0x10c)},'unit':{'$first':_0x300782(0x130)},'secondary_unit':{'$first':_0x300782(0x72)},'storage':{'$first':_0x300782(0xa1)},'rack':{'$first':_0x300782(0x74)},'expiry_date':{'$first':_0x300782(0x12b)},'production_date':{'$first':_0x300782(0x129)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x300782(0x16d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x300782(0xb4)},'actual_qty':{'$first':_0x300782(0xb9)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x3b423b=await warehouse['aggregate']([{'$match':{'name':_0x573f68,'room':_0x38d04b}},{'$unwind':_0x300782(0xbb)},{'$match':{'product_details.secondary_code':_0x1686a2}},{'$group':{'_id':_0x300782(0x14f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x300782(0x119)},'secondary_code':{'$first':_0x300782(0x95)},'product_code':{'$first':_0x300782(0x78)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x300782(0x73)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x300782(0x10c)},'unit':{'$first':_0x300782(0x130)},'secondary_unit':{'$first':_0x300782(0x72)},'storage':{'$first':_0x300782(0xa1)},'rack':{'$first':_0x300782(0x74)},'expiry_date':{'$first':_0x300782(0x12b)},'production_date':{'$first':_0x300782(0x129)},'maxPerUnit':{'$first':_0x300782(0x171)},'batch_code':{'$first':_0x300782(0x11e)},'product_cat':{'$first':_0x300782(0x16d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x300782(0xb4)}}}]);if(_0x5b2ce2[_0x300782(0x173)]>0x0)_0x51c31f[_0x300782(0xf5)](_0x5b2ce2);else _0x3b423b['length']>0x0&&_0x51c31f[_0x300782(0xf5)](_0x3b423b);}const _0x233495=_0x255491[_0x2c225c(0xd3)](_0x41dbdc=>_0xa84966(_0x41dbdc));await Promise['all'](_0x233495),_0x1e0121[_0x2c225c(0x96)](_0x51c31f);}),module[a0_0x82d35a(0xff)]=router;