var a0_0x701933=a0_0x5275;(function(_0x34e366,_0x41b5e3){var _0xb49080=a0_0x5275,_0x5c963d=_0x34e366();while(!![]){try{var _0x3d0a4d=parseInt(_0xb49080(0x115))/0x1*(parseInt(_0xb49080(0xd1))/0x2)+-parseInt(_0xb49080(0xd6))/0x3*(-parseInt(_0xb49080(0x19b))/0x4)+-parseInt(_0xb49080(0x16c))/0x5*(parseInt(_0xb49080(0x17f))/0x6)+parseInt(_0xb49080(0xc5))/0x7*(-parseInt(_0xb49080(0x178))/0x8)+parseInt(_0xb49080(0x125))/0x9*(-parseInt(_0xb49080(0x124))/0xa)+-parseInt(_0xb49080(0x1a7))/0xb*(parseInt(_0xb49080(0xd4))/0xc)+parseInt(_0xb49080(0x128))/0xd;if(_0x3d0a4d===_0x41b5e3)break;else _0x5c963d['push'](_0x5c963d['shift']());}catch(_0x29c0f6){_0x5c963d['push'](_0x5c963d['shift']());}}}(a0_0x45ba,0xa3534));const express=require('express'),app=express(),router=express[a0_0x701933(0xb5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x701933(0x10b)),nodemailer=require(a0_0x701933(0x168)),users=require('../public/language/languages.json');router[a0_0x701933(0xe5)](a0_0x701933(0x15a),auth,async(_0x4e60f2,_0x132b50)=>{var _0x269ce8=a0_0x701933;try{const {username:_0x27168d,email:_0x1677a2,role:_0x1fd8ab}=_0x4e60f2['user'],_0x1850fc=_0x4e60f2[_0x269ce8(0x14f)],_0x27038a=await profile[_0x269ce8(0x147)]({'email':_0x1850fc['email']}),_0x5848a1=await master_shop[_0x269ce8(0x193)]();let _0x15aa49;if(_0x1850fc[_0x269ce8(0x1b6)]=='staff'){const _0x3f1348=await staff[_0x269ce8(0x147)]({'email':_0x1850fc[_0x269ce8(0xda)]});_0x15aa49=await sales[_0x269ce8(0xad)]([{'$lookup':{'from':_0x269ce8(0x141),'localField':'customer','foreignField':_0x269ce8(0xf4),'as':_0x269ce8(0x102)}},{'$unwind':'$customers_docs'},{'$unwind':_0x269ce8(0x1b7)},{'$group':{'_id':'$_id','invoice':{'$first':_0x269ce8(0x123)},'customers':{'$first':'$customer'},'date':{'$first':_0x269ce8(0xe0)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x269ce8(0x1b7)},'note':{'$first':'$note'},'return_data':{'$first':_0x269ce8(0x174)},'customers_docs':{'$first':_0x269ce8(0x19f)},'total_saleproduct_quantity':{'$sum':_0x269ce8(0x132)},'level':{'$addToSet':_0x269ce8(0x113)},'isle':{'$addToSet':_0x269ce8(0x150)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x269ce8(0x187)},'finalize':{'$first':_0x269ce8(0xdd)},'isAllowEdit':{'$first':_0x269ce8(0x118)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x15aa49=await sales[_0x269ce8(0xad)]([{'$lookup':{'from':_0x269ce8(0x141),'localField':_0x269ce8(0x182),'foreignField':_0x269ce8(0xf4),'as':_0x269ce8(0x102)}},{'$unwind':_0x269ce8(0x19f)},{'$unwind':_0x269ce8(0x1b7)},{'$group':{'_id':_0x269ce8(0x1ac),'invoice':{'$first':_0x269ce8(0x123)},'customers':{'$first':_0x269ce8(0x143)},'date':{'$first':_0x269ce8(0xe0)},'warehouse_name':{'$first':_0x269ce8(0x15b)},'sale_product':{'$push':_0x269ce8(0x1b7)},'note':{'$first':'$note'},'return_data':{'$first':_0x269ce8(0x174)},'customers_docs':{'$first':_0x269ce8(0x19f)},'total_saleproduct_quantity':{'$sum':_0x269ce8(0x132)},'level':{'$addToSet':_0x269ce8(0x113)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x269ce8(0x187)},'finalize':{'$first':_0x269ce8(0xdd)},'isAllowEdit':{'$first':_0x269ce8(0x118)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x269ce8(0x14c)]('sales\x20all_data',_0x15aa49);if(_0x5848a1[0x0]['language']==_0x269ce8(0x1a6)){var _0x5ae09e=users['English'];console[_0x269ce8(0x14c)](_0x5ae09e);}else{if(_0x5848a1[0x0][_0x269ce8(0x162)]==_0x269ce8(0xe9))var _0x5ae09e=users[_0x269ce8(0xe9)];else{if(_0x5848a1[0x0][_0x269ce8(0x162)]==_0x269ce8(0x171))var _0x5ae09e=users['German'];else{if(_0x5848a1[0x0][_0x269ce8(0x162)]==_0x269ce8(0xc2))var _0x5ae09e=users[_0x269ce8(0xc2)];else{if(_0x5848a1[0x0]['language']=='French')var _0x5ae09e=users[_0x269ce8(0x172)];else{if(_0x5848a1[0x0][_0x269ce8(0x162)]==_0x269ce8(0xb7))var _0x5ae09e=users[_0x269ce8(0x137)];else{if(_0x5848a1[0x0][_0x269ce8(0x162)]==_0x269ce8(0x134))var _0x5ae09e=users['Chinese'];else{if(_0x5848a1[0x0][_0x269ce8(0x162)]==_0x269ce8(0xec))var _0x5ae09e=users[_0x269ce8(0x169)];}}}}}}}_0x132b50[_0x269ce8(0x146)](_0x269ce8(0xe2),{'success':_0x4e60f2[_0x269ce8(0x15d)](_0x269ce8(0x1ba)),'errors':_0x4e60f2['flash'](_0x269ce8(0x188)),'sales':_0x15aa49,'profile':_0x27038a,'role':_0x1850fc,'master_shop':_0x5848a1,'language':_0x5ae09e});}catch(_0x536865){console[_0x269ce8(0x14c)](_0x536865);}});function a0_0x5275(_0x167344,_0x5ea45a){var _0x45ba3c=a0_0x45ba();return a0_0x5275=function(_0x5275cd,_0x5f5849){_0x5275cd=_0x5275cd-0xac;var _0x108817=_0x45ba3c[_0x5275cd];return _0x108817;},a0_0x5275(_0x167344,_0x5ea45a);}function a0_0x45ba(){var _0x4d0a7d=['filter','catch','log','params','/view/add_sales/:id','user','$sale_product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Level','error','$product_details.production_date','Sale\x20Return\x20Mail','<hr\x20class=\x22my-3\x22>','/invoice/:id','map','/view','$warehouse_name','Sales\x20Update\x20successfully','flash','$product_details.product_cat','$product_details.actual_uom','Shelves','SCRN','language','</table>','$product.product_name','getMonth','bay','$product_details.storage','nodemailer','Arabic','Raw\x20Materials','amount','725jmNFQN','all','random','$product_details.bay','forEach','German','French','\x20</h2>','$return_data','product_details','customer_data','type','8JsHCdB','Received\x20Payment\x20For\x20Sale','</tr>','RMSEmail','Enabled','$product_details.product_stock','final','37134ECwJCQ','invoice','floorlevel','customer','Sale\x20Return','primary_unit','product_name','note','$sale_product.floorlevel','errors','prod_cat','primary_code','rack','$product','barcode\x20user_id','json','$product_details.secondary_code','\x20Order\x20Date\x20:\x20','</head><body>','staff','find','/view/add_sale/product','$product_details.secondary_unit','An\x20error\x20occurred.','/all_sales/view','OUT-','RoomAssigned','$product_details','464LBGsaW','secondary_code','English','$product_details.rack','$customers_docs','Ambient','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','actual_qty','all_sales_barcode','English\x20(US)','3487vZpwbf','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','createTransport','</thead>','foreach\x20newproduct','$_id','finalize','split','Return\x20Goods','Error\x20Occurs','</td>','sales_invoice','$product_details.pallet','</div>','_id','role','$sale_product','types','product_code','success','</h5>','<h2>\x20','aggregate','<strong>\x20Regards\x20</strong>','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.primary_code','logo','Router','redirect','Portuguese\x20(BR)','/view/return_sales/:id','back','Return\x20Rooms','$product_details.type','add_sales','quantity','barcode\x20Product\x20master','exports','</tbody>','stock_data','Spanish','received_amount','/../public','5788853ZhXICY','$product_details.maxPerUnit','storage','isAllowEdit','<tbody\x20style=\x22text-align:\x20center;\x22>','quantity_notConverted','status','$room','post','sendMail','level','max_per_unit','1354774gFtrZD','save','room_name','47592PdSwRf','add\x20post','17877FCtJCr','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.product_name','port','email','\x20Order\x20Number\x20:\x20','Email\x20sent\x20successfully','$finalize','</body></html>','string','$date','password','all_sales','gmail','/preview/:id','get','bin','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Hindi','/give_payment/:id','expiry_date','Arabic\x20(ae)','getDate','stock','batch_code','unit','host','product_stock','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','name','slice','date','$product_details.invoice','$product_details.actual_qty','$product_details.batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','sale_product','site_title','$product_details.product_code','sale_qty','warehouse','$product_details.bin','image','customers_docs','/view/add_sales','False','actual_uom','prod_code','abs','then','Floor','return_qty','../middleware/auth','<div>','return_sale','delivery_code','max','sales_quantity','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','due_amount','$sale_product.bay','/view/:id','1IToPRa','<html><head><title></title>','edit_sales','$isAllowEdit','$product_details._id','$name','production_date','findById','Sales\x20Add\x20successfully','id_transaction_from','warehouse_name','$product_details.floorlevel','delivery_date','<tr>','$invoice','10DOCifQ','10787058pCiTpB','push','product_data','45246721gbVGNE','Enclosed','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','length','requested_qty','/all_sales/preview/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.unit','<h5\x20style=\x22text-align:\x20left;\x22>','$sale_product.quantity','$product_details.isle','Chinese','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Portuguese','/upload/','prod_invoice','currency','$product_details.expiry_date','stocks','floor','$product_details.level','product','master','customers','<h5>','$customer','<span\x20style=\x22float:\x20right;\x22>','return_data','render','findOne','Receiving\x20Area','There\x27s\x20a\x20error\x20in\x20this\x20transaction'];a0_0x45ba=function(){return _0x4d0a7d;};return a0_0x45ba();}async function getRandom8DigitNumber(){var _0x11b204=a0_0x701933;const _0x58038b=0x989680,_0x3184f1=0x5f5e0ff,_0x25dae8=Math[_0x11b204(0x13d)](Math[_0x11b204(0x16e)]()*(_0x3184f1-_0x58038b+0x1))+_0x58038b;var _0x4e1bbc;const _0xc3f8c8=await sales[_0x11b204(0x147)]({'invoice':_0x11b204(0x198)+_0x25dae8});return _0xc3f8c8&&_0xc3f8c8[_0x11b204(0x12b)]>0x0?_0x4e1bbc='OUT-'+_0x25dae8:_0x4e1bbc=_0x11b204(0x198)+_0x25dae8,_0x4e1bbc;}router[a0_0x701933(0xe5)](a0_0x701933(0x103),auth,async(_0x24d8e7,_0x360581)=>{var _0xf6a3f9=a0_0x701933;try{const {username:_0x181d51,email:_0x1b8a82,role:_0x48e5fb}=_0x24d8e7[_0xf6a3f9(0x14f)],_0x26f1d7=_0x24d8e7[_0xf6a3f9(0x14f)],_0x3e7a5a=await profile[_0xf6a3f9(0x147)]({'email':_0x26f1d7[_0xf6a3f9(0xda)]}),_0x3f1b5f=await master_shop[_0xf6a3f9(0x193)](),_0xe82d17=await customer[_0xf6a3f9(0x193)]({});let _0x36ea15;if(_0x26f1d7['role']==_0xf6a3f9(0x192)){const _0xba5030=await staff['findOne']({'email':_0x26f1d7[_0xf6a3f9(0xda)]});_0x36ea15=await warehouse[_0xf6a3f9(0xad)]([{'$match':{'status':_0xf6a3f9(0x17c),'name':_0xba5030[_0xf6a3f9(0xff)],'warehouse_category':_0xf6a3f9(0x16a),'name':{'$ne':_0xf6a3f9(0x1af)}}},{'$group':{'_id':_0xf6a3f9(0x11a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x36ea15=await warehouse[_0xf6a3f9(0xad)]([{'$match':{'status':_0xf6a3f9(0x17c),'warehouse_category':_0xf6a3f9(0x16a),'name':{'$ne':_0xf6a3f9(0x1af)}}},{'$group':{'_id':_0xf6a3f9(0x11a),'name':{'$first':_0xf6a3f9(0x11a)}}},{'$sort':{'name':0x1}}]);const _0x4670be=await product['find']({});var _0x573df6=[_0xf6a3f9(0x1a0),'Enclosed'];const _0x569e5c=await sales[_0xf6a3f9(0x193)]({}),_0x380e85=_0x569e5c['length']+0x1,_0x562331='OUT-'+_0x380e85['toString']()['padStart'](0x5,'0');if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]==_0xf6a3f9(0x1a6)){var _0x447a9d=users[_0xf6a3f9(0x19d)];console[_0xf6a3f9(0x14c)](_0x447a9d);}else{if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]==_0xf6a3f9(0xe9))var _0x447a9d=users[_0xf6a3f9(0xe9)];else{if(_0x3f1b5f[0x0]['language']==_0xf6a3f9(0x171))var _0x447a9d=users['German'];else{if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]==_0xf6a3f9(0xc2))var _0x447a9d=users[_0xf6a3f9(0xc2)];else{if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]==_0xf6a3f9(0x172))var _0x447a9d=users[_0xf6a3f9(0x172)];else{if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]=='Portuguese\x20(BR)')var _0x447a9d=users[_0xf6a3f9(0x137)];else{if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]==_0xf6a3f9(0x134))var _0x447a9d=users[_0xf6a3f9(0x134)];else{if(_0x3f1b5f[0x0][_0xf6a3f9(0x162)]==_0xf6a3f9(0xec))var _0x447a9d=users['Arabic'];}}}}}}}const _0x54e69d=getRandom8DigitNumber();_0x54e69d[_0xf6a3f9(0x108)](_0x13ec80=>{var _0x318359=_0xf6a3f9;_0x360581['render'](_0x318359(0xbc),{'success':_0x24d8e7[_0x318359(0x15d)](_0x318359(0x1ba)),'errors':_0x24d8e7[_0x318359(0x15d)](_0x318359(0x188)),'role':_0x26f1d7,'profile':_0x3e7a5a,'customer':_0xe82d17,'warehouse':_0x36ea15,'product':_0x4670be,'invoice':_0x13ec80,'master_shop':_0x3f1b5f,'language':_0x447a9d,'rooms_data':_0x573df6});})[_0xf6a3f9(0x14b)](_0xe6d716=>{var _0x16c8a6=_0xf6a3f9;_0x24d8e7[_0x16c8a6(0x15d)](_0x16c8a6(0x188),_0x16c8a6(0x149)),_0x360581[_0x16c8a6(0xb6)](_0x16c8a6(0x197));});}catch(_0x1420b6){console[_0xf6a3f9(0x14c)](_0x1420b6);}}),router[a0_0x701933(0xe5)](a0_0x701933(0x14e),auth,async(_0x550ecd,_0x57e081)=>{var _0x193d2f=a0_0x701933;try{const _0x34fcaf=_0x550ecd['params']['id'];console['log'](_0x34fcaf);const _0x320728=await product[_0x193d2f(0x193)](),_0x30b714=await purchases[_0x193d2f(0xad)]([{'$match':{'warehouse_name':_0x34fcaf}},{'$unwind':_0x193d2f(0x18c)},{'$group':{'_id':_0x193d2f(0x164)}}]);console[_0x193d2f(0x14c)]('purchases_data',_0x30b714),_0x57e081[_0x193d2f(0xcb)](0xc8)[_0x193d2f(0x18e)]({'purchases_data':_0x30b714,'product_data':_0x320728});}catch(_0x5e8c95){console[_0x193d2f(0x14c)](_0x5e8c95);}}),router[a0_0x701933(0xcd)](a0_0x701933(0x194),auth,async(_0x49975e,_0x5b3a16)=>{var _0x51db96=a0_0x701933;try{const {warehouse_data:_0x919a4e,product_data:_0x5d4dad}=_0x49975e['body'];console[_0x51db96(0x14c)](_0x49975e['body'][_0x51db96(0x127)]);;const _0x5948c4=await master_shop[_0x51db96(0x193)]();console[_0x51db96(0x14c)](_0x51db96(0x140),_0x5948c4);const _0x4c24bf=await product[_0x51db96(0x147)]({'name':_0x5d4dad});console[_0x51db96(0x14c)](_0x51db96(0x13f),_0x4c24bf);const _0x5ce7f1=await warehouse[_0x51db96(0xad)]([{'$match':{'name':_0x919a4e}},{'$unwind':_0x51db96(0x19a)},{'$match':{'product_details.product_name':_0x5d4dad}},{'$group':{'_id':_0x51db96(0xd8),'product_stock':{'$first':_0x51db96(0x17d)}}}]);console[_0x51db96(0x14c)](_0x51db96(0xc1),_0x5ce7f1),_0x5b3a16[_0x51db96(0xcb)](0xc8)['json']({'master':_0x5948c4,'new_product':_0x4c24bf,'stock_data':_0x5ce7f1});}catch(_0x1cbd83){console[_0x51db96(0x14c)](_0x1cbd83);}}),router[a0_0x701933(0xcd)](a0_0x701933(0x103),auth,async(_0x2ee21a,_0x13a6fe)=>{var _0x2c9fd6=a0_0x701933;try{const {invoice:_0x17b8c1,date:_0x2f37b3,warehouse_name:_0x1bb4c8,product_name:_0x4e1724,stock:_0x42f88b,quantity:_0x128b9b,note:_0x821ade,room:_0x5c581e,primary_code:_0x1d9037,secondary_code:_0x31b0be,prod_code:_0x139b7e,level:_0x3a336a,isle:_0x336e9f,pallet:_0x279069,batch_code:_0x4439f2,SCRN:_0x52100a,expiry_date:_0x49fb1e}=_0x2ee21a['body'];if(typeof _0x4e1724==_0x2c9fd6(0xdf))var _0x3f9bbc=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x185)]],_0x5ce9bf=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0xee)]],_0x1d7481=[_0x2ee21a[_0x2c9fd6(0x135)]['carton']],_0x261d4=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x18a)]],_0xbe860d=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x19c)]],_0x4fe119=[_0x2ee21a[_0x2c9fd6(0x135)]['prod_code']],_0x180a7e=[_0x2ee21a['body'][_0x2c9fd6(0xcf)]],_0xf1e940=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x184)]],_0xb7c57a=[_0x2ee21a['body'][_0x2c9fd6(0x1a1)]],_0x4e92cd=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0xef)]],_0x429828=[_0x2ee21a['body'][_0x2c9fd6(0xeb)]],_0x25b666=[_0x2ee21a['body'][_0x2c9fd6(0xd0)]],_0x43cfcc=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x11b)]],_0xed7bb7=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x12c)]],_0x98c677=[_0x2ee21a[_0x2c9fd6(0x135)]['delivery_date']],_0x42e566=[_0x2ee21a[_0x2c9fd6(0x135)]['delivery_code']],_0x3aa04c=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x189)]],_0x5f4ad5=[_0x2ee21a['body'][_0x2c9fd6(0xbd)]],_0x2655f1=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x199)]],_0x2f6826=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x139)]],_0xadaca0=[_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x1a4)]],_0x5dece8=[_0x2ee21a[_0x2c9fd6(0x135)]['actual_uom']],_0x3913c0=[_0x2ee21a[_0x2c9fd6(0x135)]['id_transact']];else var _0x3f9bbc=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x185)]],_0x5ce9bf=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0xee)]],_0x1d7481=[..._0x2ee21a[_0x2c9fd6(0x135)]['carton']],_0x261d4=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x18a)]],_0xbe860d=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x19c)]],_0x4fe119=[..._0x2ee21a['body'][_0x2c9fd6(0x106)]],_0x180a7e=[..._0x2ee21a[_0x2c9fd6(0x135)]['level']],_0xf1e940=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x184)]],_0xb7c57a=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x1a1)]],_0x4e92cd=[..._0x2ee21a[_0x2c9fd6(0x135)]['batch_code']],_0x429828=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0xeb)]],_0x25b666=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0xd0)]],_0x43cfcc=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x11b)]],_0xed7bb7=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x12c)]],_0x98c677=[..._0x2ee21a['body'][_0x2c9fd6(0x121)]],_0x42e566=[..._0x2ee21a['body']['delivery_code']],_0x3aa04c=[..._0x2ee21a['body'][_0x2c9fd6(0x189)]],_0x5f4ad5=[..._0x2ee21a['body'][_0x2c9fd6(0xbd)]],_0x2655f1=[..._0x2ee21a[_0x2c9fd6(0x135)]['RoomAssigned']],_0x2f6826=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x139)]],_0xadaca0=[..._0x2ee21a['body'][_0x2c9fd6(0x1a4)]],_0x5dece8=[..._0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x105)]],_0x3913c0=[..._0x2ee21a[_0x2c9fd6(0x135)]['id_transact']];const _0x8a61bb=_0x3f9bbc[_0x2c9fd6(0x159)](_0x58d75c=>{return _0x58d75c={'product_name':_0x58d75c};});_0x5ce9bf[_0x2c9fd6(0x170)]((_0x47646c,_0x1830e0)=>{var _0x451c2e=_0x2c9fd6;_0x8a61bb[_0x1830e0][_0x451c2e(0xee)]=Math[_0x451c2e(0x107)](_0x47646c);}),_0xadaca0[_0x2c9fd6(0x170)]((_0x5305ef,_0x8e73cc)=>{var _0x676f37=_0x2c9fd6;_0x8a61bb[_0x8e73cc]['actual_qty']=Math[_0x676f37(0x107)](_0x5305ef);}),_0x5dece8['forEach']((_0x699f6d,_0x433df3)=>{var _0x5f4f75=_0x2c9fd6;_0x8a61bb[_0x433df3][_0x5f4f75(0x105)]=_0x699f6d;}),_0x3913c0[_0x2c9fd6(0x170)]((_0x603e9a,_0x9ae9ed)=>{var _0x361ed0=_0x2c9fd6;_0x8a61bb[_0x9ae9ed][_0x361ed0(0x11e)]=_0x603e9a;}),_0x1d7481[_0x2c9fd6(0x170)]((_0x3b4bf0,_0x95e969)=>{var _0x4b0fcf=_0x2c9fd6;_0x8a61bb[_0x95e969][_0x4b0fcf(0xbd)]=_0x3b4bf0;}),_0x261d4['forEach']((_0x191eb8,_0x1be3ee)=>{_0x8a61bb[_0x1be3ee]['primary_code']=_0x191eb8;}),_0xbe860d[_0x2c9fd6(0x170)]((_0x156298,_0x356fbb)=>{_0x8a61bb[_0x356fbb]['secondary_code']=_0x156298;}),_0x4fe119[_0x2c9fd6(0x170)]((_0x3d8024,_0x529860)=>{var _0x3d1190=_0x2c9fd6;_0x8a61bb[_0x529860][_0x3d1190(0x1b9)]=_0x3d8024;}),_0x180a7e[_0x2c9fd6(0x170)]((_0x40151d,_0x186d6c)=>{var _0x4c6b9b=_0x2c9fd6;_0x2655f1[_0x4c6b9b(0x170)]((_0x474825,_0x169a63)=>{var _0x534910=_0x4c6b9b;if(_0x474825=='Receiving\x20Area'&&_0x186d6c==_0x169a63){var _0x36cad1=_0x40151d[_0x534910(0xf5)](0x3);_0x8a61bb[_0x186d6c][_0x534910(0xc7)]=_0x40151d[0x0],_0x8a61bb[_0x186d6c][_0x534910(0x18b)]=_0x40151d[0x1],_0x8a61bb[_0x186d6c]['bay']=0x0,_0x8a61bb[_0x186d6c][_0x534910(0xe6)]=0x0,_0x8a61bb[_0x186d6c][_0x534910(0x177)]='Floor',_0x8a61bb[_0x186d6c][_0x534910(0x181)]=_0x36cad1;}else{if(_0x474825==_0x534910(0x160)&&_0x186d6c==_0x169a63){var _0x36cad1=_0x40151d[_0x534910(0xf5)](0x3);_0x8a61bb[_0x186d6c][_0x534910(0xc7)]=_0x40151d[0x0],_0x8a61bb[_0x186d6c][_0x534910(0x18b)]=_0x40151d[0x1],_0x8a61bb[_0x186d6c][_0x534910(0x166)]=0x0,_0x8a61bb[_0x186d6c][_0x534910(0xe6)]=0x0,_0x8a61bb[_0x186d6c][_0x534910(0x177)]=_0x534910(0x109),_0x8a61bb[_0x186d6c]['floorlevel']=_0x40151d[0x5];}else{if(_0x186d6c==_0x169a63){var _0x42ef85;if(_0x40151d[0x4]=='L')_0x42ef85=_0x534910(0x153);else _0x40151d[0x4]=='F'&&(_0x42ef85=_0x534910(0x109));_0x8a61bb[_0x186d6c][_0x534910(0xc7)]=_0x40151d[0x0],_0x8a61bb[_0x186d6c][_0x534910(0x18b)]=_0x40151d[0x1],_0x8a61bb[_0x186d6c]['bay']=_0x40151d[0x2],_0x8a61bb[_0x186d6c]['bin']=_0x40151d[0x3],_0x8a61bb[_0x186d6c][_0x534910(0x177)]=_0x42ef85,_0x8a61bb[_0x186d6c][_0x534910(0x181)]=_0x40151d[0x5];}}}});}),_0xf1e940[_0x2c9fd6(0x170)]((_0x4efef5,_0x26921b)=>{var _0x2298c7=_0x2c9fd6;_0x8a61bb[_0x26921b][_0x2298c7(0xf0)]=_0x4efef5;}),_0xb7c57a[_0x2c9fd6(0x170)]((_0x7aa9f9,_0x174780)=>{_0x8a61bb[_0x174780]['secondary_unit']=_0x7aa9f9;}),_0x4e92cd[_0x2c9fd6(0x170)]((_0x2ccb07,_0x2dbda0)=>{var _0xa77204=_0x2c9fd6;_0x8a61bb[_0x2dbda0][_0xa77204(0xef)]=_0x2ccb07;}),_0x429828['forEach']((_0x38ecc9,_0xa48f42)=>{var _0x363053=_0x2c9fd6;_0x8a61bb[_0xa48f42][_0x363053(0xeb)]=_0x38ecc9;}),_0x25b666[_0x2c9fd6(0x170)]((_0x195549,_0x774a18)=>{_0x8a61bb[_0x774a18]['maxperunit']=_0x195549;}),_0x43cfcc['forEach']((_0x2498b9,_0x58cd08)=>{var _0x1fec57=_0x2c9fd6;_0x8a61bb[_0x58cd08][_0x1fec57(0x11b)]=_0x2498b9;}),_0xed7bb7[_0x2c9fd6(0x170)]((_0x3a963a,_0x29fc67)=>{_0x8a61bb[_0x29fc67]['requested_qty']=_0x3a963a;}),_0x98c677['forEach']((_0x20b123,_0x4ab497)=>{var _0xa672d4=_0x2c9fd6;_0x8a61bb[_0x4ab497][_0xa672d4(0x121)]=_0x20b123;}),_0x42e566[_0x2c9fd6(0x170)]((_0x2a8105,_0xee5a26)=>{var _0x1ee0db=_0x2c9fd6;_0x8a61bb[_0xee5a26][_0x1ee0db(0x10e)]=_0x2a8105;}),_0x3aa04c[_0x2c9fd6(0x170)]((_0x5dd965,_0x3c6323)=>{_0x8a61bb[_0x3c6323]['prod_cat']=_0x5dd965;}),_0x5f4ad5[_0x2c9fd6(0x170)]((_0x534ccc,_0x15bddc)=>{var _0x3a3de4=_0x2c9fd6;_0x8a61bb[_0x15bddc][_0x3a3de4(0xca)]=_0x534ccc;}),_0x2655f1[_0x2c9fd6(0x170)]((_0x5d87d3,_0x35a147)=>{var _0x170ed6=_0x2c9fd6;_0x8a61bb[_0x35a147][_0x170ed6(0xd3)]=_0x5d87d3;}),_0x2f6826[_0x2c9fd6(0x170)]((_0x4a41de,_0x6ebdcc)=>{var _0x5c29d7=_0x2c9fd6;_0x8a61bb[_0x6ebdcc][_0x5c29d7(0x180)]=_0x4a41de;});var _0x19e4a7=0x0;_0x8a61bb[_0x2c9fd6(0x170)](_0x583fc3=>{var _0x17a79d=_0x2c9fd6;(_0x583fc3['stock']<_0x583fc3[_0x17a79d(0xca)]||_0x583fc3[_0x17a79d(0xca)]==0x0)&&(console[_0x17a79d(0x14c)](_0x17a79d(0x1ab),_0x583fc3),_0x19e4a7++);});const _0xc79773=_0x8a61bb[_0x2c9fd6(0x14a)](_0x405c29=>_0x405c29[_0x2c9fd6(0xbd)]!=='0'&&_0x405c29[_0x2c9fd6(0xbd)]!==''),_0x43c905=new sales({'invoice':_0x17b8c1,'customer':_0x2ee21a[_0x2c9fd6(0x135)][_0x2c9fd6(0x182)],'date':_0x2f37b3,'warehouse_name':_0x1bb4c8,'sale_product':_0xc79773,'note':_0x821ade,'room':_0x5c581e,'primary_code':_0x1d9037,'secondary_code':_0x31b0be,'prod_code':_0x139b7e,'SCRN':_0x52100a}),_0x497be4=await _0x43c905[_0x2c9fd6(0xd2)]();_0x2ee21a['flash'](_0x2c9fd6(0x1ba),_0x2c9fd6(0x11d)),_0x13a6fe['redirect']('/all_sales/preview/'+_0x497be4[_0x2c9fd6(0x1b5)]);}catch(_0x1ac38a){console[_0x2c9fd6(0x14c)](_0x1ac38a);}}),router['get'](a0_0x701933(0xe4),auth,async(_0x5dac60,_0x4d3909)=>{var _0xd9db3b=a0_0x701933;try{const {username:_0x347cca,email:_0x586406,role:_0x19558d}=_0x5dac60['user'],_0x1afb4a=_0x5dac60[_0xd9db3b(0x14f)],_0x19ea7f=await profile[_0xd9db3b(0x147)]({'email':_0x1afb4a[_0xd9db3b(0xda)]}),_0x51dbed=await master_shop['find'](),_0x3a2d77=_0x5dac60[_0xd9db3b(0x14d)]['id'],_0x5bbc56=await sales[_0xd9db3b(0x11c)](_0x3a2d77),_0x26e4ee=await warehouse['aggregate']([{'$match':{'name':_0x5bbc56[_0xd9db3b(0x11f)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0xd9db3b(0xd8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xd9db3b(0x16f)},'bin':{'$first':_0xd9db3b(0x100)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0xd9db3b(0x120)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xd9db3b(0x18f)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xd9db3b(0x167)},'rack':{'$first':_0xd9db3b(0x19e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xd9db3b(0x155)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x275733=await customer[_0xd9db3b(0x193)]({});let _0xeef5e9;if(_0x1afb4a['role']==_0xd9db3b(0x192)){const _0x233d18=await staff[_0xd9db3b(0x147)]({'email':_0x1afb4a[_0xd9db3b(0xda)]});_0xeef5e9=await warehouse['aggregate']([{'$match':{'status':_0xd9db3b(0x17c),'name':_0x233d18['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0xd9db3b(0x11a)}}}]);}else _0xeef5e9=await warehouse[_0xd9db3b(0xad)]([{'$match':{'status':_0xd9db3b(0x17c)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x4ae41f=await product[_0xd9db3b(0x193)]({}),_0x19672c=await suppliers[_0xd9db3b(0x193)]({});if(_0x51dbed[0x0][_0xd9db3b(0x162)]==_0xd9db3b(0x1a6)){var _0x1f7210=users['English'];console[_0xd9db3b(0x14c)](_0x1f7210);}else{if(_0x51dbed[0x0][_0xd9db3b(0x162)]=='Hindi')var _0x1f7210=users[_0xd9db3b(0xe9)];else{if(_0x51dbed[0x0]['language']=='German')var _0x1f7210=users[_0xd9db3b(0x171)];else{if(_0x51dbed[0x0][_0xd9db3b(0x162)]=='Spanish')var _0x1f7210=users[_0xd9db3b(0xc2)];else{if(_0x51dbed[0x0][_0xd9db3b(0x162)]==_0xd9db3b(0x172))var _0x1f7210=users['French'];else{if(_0x51dbed[0x0][_0xd9db3b(0x162)]=='Portuguese\x20(BR)')var _0x1f7210=users[_0xd9db3b(0x137)];else{if(_0x51dbed[0x0][_0xd9db3b(0x162)]=='Chinese')var _0x1f7210=users['Chinese'];else{if(_0x51dbed[0x0][_0xd9db3b(0x162)]==_0xd9db3b(0xec))var _0x1f7210=users[_0xd9db3b(0x169)];}}}}}}}_0x4d3909[_0xd9db3b(0x146)]('edit_sales_view',{'success':_0x5dac60[_0xd9db3b(0x15d)](_0xd9db3b(0x1ba)),'errors':_0x5dac60[_0xd9db3b(0x15d)]('errors'),'role':_0x1afb4a,'profile':_0x19ea7f,'customer':_0x275733,'warehouse':_0xeef5e9,'product':_0x26e4ee,'user':_0x5bbc56,'master_shop':_0x51dbed,'unit':_0x4ae41f,'language':_0x1f7210,'suppliers':_0x19672c});}catch(_0x14afd2){console[_0xd9db3b(0x14c)](_0x14afd2);}}),router['post'](a0_0x701933(0xe4),auth,async(_0xe6c858,_0x348483)=>{var _0x404bb5=a0_0x701933;try{const _0x5a2c56=_0xe6c858['params']['id'],{invoice:_0x3513f7,warehouse_name:_0x16726e,room:_0x54f8bc}=_0xe6c858['body'],_0x2c7ac3=await sales[_0x404bb5(0x147)]({'invoice':_0x3513f7}),_0x4402b2=_0x2c7ac3['sale_product'][_0x404bb5(0x159)](async _0x1331b5=>{var _0x570015=_0x404bb5,_0x5c06f5=await warehouse['findOne']({'name':_0x16726e,'room':_0x1331b5['room_name'],'warehouse_category':_0x570015(0x16a)});const _0x5336bf=_0x5c06f5[_0x570015(0x175)][_0x570015(0x159)](_0x47277e=>{var _0x282c65=_0x570015;_0x47277e[_0x282c65(0x185)]==_0x1331b5[_0x282c65(0x185)]&&_0x47277e['floorlevel']==_0x1331b5[_0x282c65(0x181)]&&_0x47277e['type']==_0x1331b5['type']&&_0x47277e[_0x282c65(0xe6)]==_0x1331b5[_0x282c65(0xe6)]&&_0x47277e[_0x282c65(0x166)]==_0x1331b5['bay']&&_0x47277e[_0x282c65(0x18b)]==_0x1331b5[_0x282c65(0x18b)]&&_0x47277e[_0x282c65(0xc7)]==_0x1331b5[_0x282c65(0xc7)]&&_0x47277e[_0x282c65(0xeb)]==_0x1331b5[_0x282c65(0xeb)]&&_0x47277e[_0x282c65(0xef)]==_0x1331b5[_0x282c65(0xef)]&&_0x47277e[_0x282c65(0x180)]==_0x1331b5[_0x282c65(0x180)]&&_0x47277e[_0x282c65(0x1b5)]==_0x1331b5['id_transaction_from']&&(_0x47277e[_0x282c65(0xf2)]=Math[_0x282c65(0x10f)](0x0,Math[_0x282c65(0x107)](_0x47277e['product_stock'])-Math[_0x282c65(0x107)](_0x1331b5['quantity'])));});return _0x5c06f5;});Promise[_0x404bb5(0x16d)](_0x4402b2)[_0x404bb5(0x108)](async _0xe98ccb=>{var _0x373d60=_0x404bb5;try{for(const _0x474d24 of _0xe98ccb){await _0x474d24['save']();}_0x2c7ac3[_0x373d60(0x1ad)]='True';const _0x583b64=await _0x2c7ac3[_0x373d60(0xd2)](),_0x2abbd1=await master_shop[_0x373d60(0x193)](),_0x3619d4=await email_settings[_0x373d60(0x147)](),_0x1b13ca=await supervisor_settings[_0x373d60(0x193)]();var _0x5716cc=_0x2c7ac3[_0x373d60(0xfb)],_0x1d4b6d='',_0x2c31fc;for(_0x2c31fc in _0x5716cc){_0x1d4b6d+=_0x373d60(0x122)+_0x373d60(0x111)+_0x5716cc[_0x2c31fc][_0x373d60(0x185)]+_0x373d60(0x1b1)+_0x373d60(0x111)+_0x5716cc[_0x2c31fc]['product_code']+_0x373d60(0x1b1)+_0x373d60(0x111)+_0x5716cc[_0x2c31fc][_0x373d60(0xbd)]+_0x373d60(0x1b1)+_0x373d60(0x111)+_0x5716cc[_0x2c31fc]['unit']+_0x373d60(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5716cc[_0x2c31fc][_0x373d60(0x1a1)]+_0x373d60(0x1b1)+_0x373d60(0x111)+_0x2c7ac3[_0x373d60(0x11f)]+'</td>'+_0x373d60(0x111)+_0x5716cc[_0x2c31fc][_0x373d60(0xd3)]+'</td>'+_0x373d60(0x111)+_0x5716cc[_0x2c31fc][_0x373d60(0xc7)]+_0x5716cc[_0x2c31fc]['rack']+_0x5716cc[_0x2c31fc][_0x373d60(0x166)]+_0x5716cc[_0x2c31fc][_0x373d60(0xe6)]+_0x5716cc[_0x2c31fc][_0x373d60(0x177)][0x0]+_0x5716cc[_0x2c31fc]['floorlevel']+'</td>',_0x373d60(0x17a);}let _0x179230=nodemailer[_0x373d60(0x1a9)]({'host':_0x3619d4[_0x373d60(0xf1)],'port':Number(_0x3619d4[_0x373d60(0xd9)]),'secure':![],'auth':{'user':_0x3619d4[_0x373d60(0xda)],'pass':_0x3619d4[_0x373d60(0xe1)]}}),_0x32a18a={'from':_0x3619d4['email'],'to':_0x1b13ca[0x0][_0x373d60(0x17b)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x373d60(0x138)+_0x2abbd1[0x0][_0x373d60(0x101)],'cid':_0x373d60(0xb4)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x373d60(0x191)+'<div>'+_0x373d60(0x1a8)+_0x373d60(0x10c)+_0x373d60(0x12a)+_0x373d60(0x1b4)+'<div>'+_0x373d60(0xac)+_0x2abbd1[0x0][_0x373d60(0xfc)]+_0x373d60(0x173)+_0x373d60(0x1b4)+_0x373d60(0x1b4)+_0x373d60(0x157)+_0x373d60(0x10c)+_0x373d60(0x131)+_0x373d60(0xdb)+_0x2c7ac3['invoice']+'\x20'+_0x373d60(0x144)+'\x20Order\x20Date\x20:\x20'+_0x2c7ac3['date']+'\x20'+'</span>'+'</h5>'+_0x373d60(0x1b4)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x373d60(0x12f)+_0x373d60(0x122)+_0x373d60(0xb2)+_0x373d60(0xe8)+_0x373d60(0x1a2)+_0x373d60(0x151)+_0x373d60(0xd7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x373d60(0x1a3)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1d4b6d+'\x20'+_0x373d60(0xc0)+'</table>'+_0x373d60(0x10c)+_0x373d60(0xae)+_0x373d60(0x142)+_0x2abbd1[0x0][_0x373d60(0xfc)]+_0x373d60(0x1bb)+'</div>'+_0x373d60(0x1b4)+_0x373d60(0xde)};_0x179230[_0x373d60(0xce)](_0x32a18a,function(_0x5ad41d,_0x925fee){var _0x2f3760=_0x373d60;_0x5ad41d?(console[_0x2f3760(0x14c)](_0x5ad41d),console[_0x2f3760(0x14c)](_0x2f3760(0x1b0))):console[_0x2f3760(0x14c)](_0x2f3760(0xdc));}),_0xe6c858[_0x373d60(0x15d)]('success',_0x373d60(0x15c)),_0x348483[_0x373d60(0xb6)](_0x373d60(0x12d)+_0x5a2c56);}catch(_0x5fc44b){console[_0x373d60(0x154)](_0x5fc44b),_0x348483[_0x373d60(0xcb)](0x1f4)[_0x373d60(0x18e)]({'error':_0x373d60(0xfa)});}})[_0x404bb5(0x14b)](_0x2cb18b=>{var _0x38a807=_0x404bb5;console[_0x38a807(0x154)](_0x2cb18b),_0x348483[_0x38a807(0xcb)](0x1f4)[_0x38a807(0x18e)]({'error':_0x38a807(0x196)});});}catch(_0x4fbad5){console['log'](_0x4fbad5);}}),router[a0_0x701933(0xe5)]('/view/:id',auth,async(_0xe964a9,_0x11953d)=>{var _0x4ebb4a=a0_0x701933;try{const {username:_0x5c78fc,email:_0x590a12,role:_0xb712a3}=_0xe964a9[_0x4ebb4a(0x14f)],_0x146cc6=_0xe964a9[_0x4ebb4a(0x14f)],_0x2077db=await profile['findOne']({'email':_0x146cc6['email']}),_0x27a172=await master_shop[_0x4ebb4a(0x193)](),_0x1e0cf4=_0xe964a9[_0x4ebb4a(0x14d)]['id'],_0x5ee509=await sales[_0x4ebb4a(0x11c)](_0x1e0cf4);var _0x3a639f=['Ambient',_0x4ebb4a(0x129)];const _0x3f9967=await warehouse['aggregate']([{'$match':{'name':_0x5ee509[_0x4ebb4a(0x11f)],'warehouse_category':_0x4ebb4a(0x16a)}},{'$unwind':_0x4ebb4a(0x19a)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4ebb4a(0x17d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4ebb4a(0x100)},'type':{'$first':_0x4ebb4a(0xbb)},'floorlevel':{'$first':_0x4ebb4a(0x120)},'primary_code':{'$first':_0x4ebb4a(0xb3)},'secondary_code':{'$first':_0x4ebb4a(0x18f)},'product_code':{'$first':_0x4ebb4a(0xfd)},'storage':{'$first':_0x4ebb4a(0x167)},'rack':{'$first':'$product_details.rack'}}}]),_0x1fe991=await customer[_0x4ebb4a(0x193)]({});let _0x5e02e6;if(_0x146cc6[_0x4ebb4a(0x1b6)]==_0x4ebb4a(0x192)){const _0xaab602=await staff[_0x4ebb4a(0x147)]({'email':_0x146cc6[_0x4ebb4a(0xda)]});_0x5e02e6=await warehouse[_0x4ebb4a(0xad)]([{'$match':{'status':_0x4ebb4a(0x17c),'name':_0xaab602[_0x4ebb4a(0xff)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4ebb4a(0x11a),'name':{'$first':'$name'}}}]);}else _0x5e02e6=await warehouse[_0x4ebb4a(0xad)]([{'$match':{'status':_0x4ebb4a(0x17c),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x2a8077=await product[_0x4ebb4a(0x193)]({});if(_0x27a172[0x0][_0x4ebb4a(0x162)]=='English\x20(US)'){var _0x2df007=users[_0x4ebb4a(0x19d)];console[_0x4ebb4a(0x14c)](_0x2df007);}else{if(_0x27a172[0x0][_0x4ebb4a(0x162)]=='Hindi')var _0x2df007=users[_0x4ebb4a(0xe9)];else{if(_0x27a172[0x0][_0x4ebb4a(0x162)]=='German')var _0x2df007=users[_0x4ebb4a(0x171)];else{if(_0x27a172[0x0][_0x4ebb4a(0x162)]=='Spanish')var _0x2df007=users[_0x4ebb4a(0xc2)];else{if(_0x27a172[0x0][_0x4ebb4a(0x162)]=='French')var _0x2df007=users[_0x4ebb4a(0x172)];else{if(_0x27a172[0x0][_0x4ebb4a(0x162)]=='Portuguese\x20(BR)')var _0x2df007=users[_0x4ebb4a(0x137)];else{if(_0x27a172[0x0]['language']=='Chinese')var _0x2df007=users[_0x4ebb4a(0x134)];else{if(_0x27a172[0x0][_0x4ebb4a(0x162)]==_0x4ebb4a(0xec))var _0x2df007=users['Arabic'];}}}}}}}_0x11953d[_0x4ebb4a(0x146)](_0x4ebb4a(0x117),{'success':_0xe964a9['flash'](_0x4ebb4a(0x1ba)),'errors':_0xe964a9[_0x4ebb4a(0x15d)](_0x4ebb4a(0x188)),'role':_0x146cc6,'profile':_0x2077db,'customer':_0x1fe991,'warehouse':_0x5e02e6,'product':_0x3f9967,'user':_0x5ee509,'master_shop':_0x27a172,'unit':_0x2a8077,'language':_0x2df007});}catch(_0x6d4a29){console[_0x4ebb4a(0x14c)](_0x6d4a29);}}),router['post'](a0_0x701933(0x114),auth,async(_0x419b85,_0x62e77b)=>{var _0x5d76f1=a0_0x701933;try{const _0xedcfd2=_0x419b85[_0x5d76f1(0x14d)]['id'],_0x475f4e=await sales[_0x5d76f1(0x147)]({'_id':_0x419b85[_0x5d76f1(0x14d)]['id']}),_0x4e006d=await warehouse[_0x5d76f1(0x147)]({'name':_0x475f4e['warehouse_name'],'room':_0x419b85[_0x5d76f1(0x135)]['room']}),{invoice:_0x57d8b0,date:_0x4e2aac,warehouse_name:_0x413aa1,product_name:_0x32e9bc,stock:_0x47dd46,quantity:_0x381724,note:_0x359a70,room:_0x2a6035,customer:_0x5468ca,SCRN:_0x4915a8}=_0x419b85[_0x5d76f1(0x135)];if(typeof _0x32e9bc==_0x5d76f1(0xdf))var _0x4b67a0=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x185)]],_0x73dc3a=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xee)]],_0x188715=[_0x419b85[_0x5d76f1(0x135)]['carton']],_0x106048=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x18a)]],_0x36c332=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x19c)]],_0x126c68=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x106)]],_0x3b4f46=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xcf)]],_0x40c98b=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x184)]],_0x10261e=[_0x419b85['body'][_0x5d76f1(0x1a1)]],_0x1e29e2=[_0x419b85[_0x5d76f1(0x135)]['batch_code']],_0x3574a5=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xeb)]],_0x47ea36=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xd0)]],_0x44881d=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x11b)]],_0x63761=[_0x419b85['body']['requested_qty']],_0x3238c4=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x121)]],_0x4dc3c9=[_0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x10e)]],_0x1f31d4=[_0x419b85['body'][_0x5d76f1(0x189)]],_0x468127=[_0x419b85['body'][_0x5d76f1(0xbd)]],_0x436a87=[_0x419b85[_0x5d76f1(0x135)]['RoomAssigned']];else var _0x4b67a0=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x185)]],_0x73dc3a=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xee)]],_0x188715=[..._0x419b85[_0x5d76f1(0x135)]['carton']],_0x106048=[..._0x419b85['body'][_0x5d76f1(0x18a)]],_0x36c332=[..._0x419b85['body'][_0x5d76f1(0x19c)]],_0x126c68=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x106)]],_0x3b4f46=[..._0x419b85['body']['level']],_0x40c98b=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x184)]],_0x10261e=[..._0x419b85[_0x5d76f1(0x135)]['secondary_unit']],_0x1e29e2=[..._0x419b85[_0x5d76f1(0x135)]['batch_code']],_0x3574a5=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xeb)]],_0x47ea36=[..._0x419b85[_0x5d76f1(0x135)]['max_per_unit']],_0x44881d=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x11b)]],_0x63761=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x12c)]],_0x3238c4=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0x121)]],_0x4dc3c9=[..._0x419b85['body'][_0x5d76f1(0x10e)]],_0x1f31d4=[..._0x419b85['body'][_0x5d76f1(0x189)]],_0x468127=[..._0x419b85[_0x5d76f1(0x135)][_0x5d76f1(0xbd)]],_0x436a87=[..._0x419b85['body'][_0x5d76f1(0x199)]];const _0x5c1175=_0x4b67a0[_0x5d76f1(0x159)](_0x87aba3=>{return _0x87aba3={'product_name':_0x87aba3};});_0x73dc3a['forEach']((_0x549d73,_0x1d97af)=>{var _0x470969=_0x5d76f1;_0x5c1175[_0x1d97af][_0x470969(0xee)]=Math[_0x470969(0x107)](_0x549d73);}),_0x188715[_0x5d76f1(0x170)]((_0x3fc7ba,_0x180490)=>{_0x5c1175[_0x180490]['quantity']=_0x3fc7ba;}),_0x106048[_0x5d76f1(0x170)]((_0x4a1b52,_0x1e46e0)=>{var _0xf44ed8=_0x5d76f1;_0x5c1175[_0x1e46e0][_0xf44ed8(0x18a)]=_0x4a1b52;}),_0x36c332[_0x5d76f1(0x170)]((_0x4a58f5,_0x426c82)=>{_0x5c1175[_0x426c82]['secondary_code']=_0x4a58f5;}),_0x126c68['forEach']((_0x35c08b,_0x2c44d2)=>{var _0xacfce0=_0x5d76f1;_0x5c1175[_0x2c44d2][_0xacfce0(0x1b9)]=_0x35c08b;}),_0x3b4f46[_0x5d76f1(0x170)]((_0xf8467f,_0x445e45)=>{_0x436a87['forEach']((_0xb0a243,_0x1d5684)=>{var _0x59f427=a0_0x5275;if(_0xb0a243==_0x59f427(0x148)&&_0x445e45==_0x1d5684){var _0x49f944=_0xf8467f[_0x59f427(0xf5)](0x3);_0x5c1175[_0x445e45][_0x59f427(0xc7)]=_0xf8467f[0x0],_0x5c1175[_0x445e45]['rack']=_0xf8467f[0x1],_0x5c1175[_0x445e45][_0x59f427(0x166)]=0x0,_0x5c1175[_0x445e45][_0x59f427(0xe6)]=0x0,_0x5c1175[_0x445e45][_0x59f427(0x177)]=_0x59f427(0x109),_0x5c1175[_0x445e45][_0x59f427(0x181)]=_0x49f944;}else{if(_0xb0a243=='Shelves'&&_0x445e45==_0x1d5684){var _0x49f944=_0xf8467f[_0x59f427(0xf5)](0x3);_0x5c1175[_0x445e45][_0x59f427(0xc7)]=_0xf8467f[0x0],_0x5c1175[_0x445e45][_0x59f427(0x18b)]=_0xf8467f[0x1],_0x5c1175[_0x445e45][_0x59f427(0x166)]=0x0,_0x5c1175[_0x445e45][_0x59f427(0xe6)]=0x0,_0x5c1175[_0x445e45]['type']=_0x59f427(0x109),_0x5c1175[_0x445e45][_0x59f427(0x181)]=_0xf8467f[0x5];}else{if(_0x445e45==_0x1d5684){var _0x16cee6;if(_0xf8467f[0x4]=='L')_0x16cee6=_0x59f427(0x153);else _0xf8467f[0x4]=='F'&&(_0x16cee6='Floor');_0x5c1175[_0x445e45]['storage']=_0xf8467f[0x0],_0x5c1175[_0x445e45]['rack']=_0xf8467f[0x1],_0x5c1175[_0x445e45][_0x59f427(0x166)]=_0xf8467f[0x2],_0x5c1175[_0x445e45][_0x59f427(0xe6)]=_0xf8467f[0x3],_0x5c1175[_0x445e45][_0x59f427(0x177)]=_0x16cee6,_0x5c1175[_0x445e45]['floorlevel']=_0xf8467f[0x5];}}}});}),_0x40c98b['forEach']((_0x5556e7,_0x203d8a)=>{var _0xca386e=_0x5d76f1;_0x5c1175[_0x203d8a][_0xca386e(0xf0)]=_0x5556e7;}),_0x10261e['forEach']((_0x152d2c,_0xf714cf)=>{var _0x263ba9=_0x5d76f1;_0x5c1175[_0xf714cf][_0x263ba9(0x1a1)]=_0x152d2c;}),_0x1e29e2[_0x5d76f1(0x170)]((_0x113f2a,_0x8fa9f7)=>{var _0x562c5f=_0x5d76f1;_0x5c1175[_0x8fa9f7][_0x562c5f(0xef)]=_0x113f2a;}),_0x3574a5[_0x5d76f1(0x170)]((_0x3f6188,_0x55875a)=>{var _0x58fe27=_0x5d76f1;_0x5c1175[_0x55875a][_0x58fe27(0xeb)]=_0x3f6188;}),_0x47ea36[_0x5d76f1(0x170)]((_0xa8789e,_0x5d32a6)=>{_0x5c1175[_0x5d32a6]['maxperunit']=_0xa8789e;}),_0x44881d[_0x5d76f1(0x170)]((_0x46ab10,_0xb0d488)=>{_0x5c1175[_0xb0d488]['production_date']=_0x46ab10;}),_0x63761[_0x5d76f1(0x170)]((_0x272872,_0x1d8bbb)=>{var _0xe41f9f=_0x5d76f1;_0x5c1175[_0x1d8bbb][_0xe41f9f(0x12c)]=Math[_0xe41f9f(0x107)](_0x272872);}),_0x3238c4[_0x5d76f1(0x170)]((_0x14742f,_0x4adab9)=>{var _0x191e9a=_0x5d76f1;_0x5c1175[_0x4adab9][_0x191e9a(0x121)]=_0x14742f;}),_0x4dc3c9[_0x5d76f1(0x170)]((_0x21a4c9,_0x53ec32)=>{var _0x586b20=_0x5d76f1;_0x5c1175[_0x53ec32][_0x586b20(0x10e)]=_0x21a4c9;}),_0x1f31d4[_0x5d76f1(0x170)]((_0x514c2e,_0x4adf1a)=>{var _0x224dee=_0x5d76f1;_0x5c1175[_0x4adf1a][_0x224dee(0x189)]=_0x514c2e;}),_0x468127[_0x5d76f1(0x170)]((_0x5a2be0,_0x1b0640)=>{var _0x4a13cb=_0x5d76f1;_0x5c1175[_0x1b0640][_0x4a13cb(0xca)]=_0x5a2be0;}),_0x436a87['forEach']((_0x56dcd8,_0x482215)=>{var _0x5a5786=_0x5d76f1;_0x5c1175[_0x482215][_0x5a5786(0xd3)]=_0x56dcd8;});var _0x463441=0x0;_0x5c1175['forEach'](_0x45c255=>{var _0x499fa9=_0x5d76f1;console[_0x499fa9(0x14c)]('foreach\x20newproduct',_0x45c255),(parseInt(_0x45c255[_0x499fa9(0xee)])<parseInt(_0x45c255['quantity'])||parseInt(_0x45c255['quantity'])==0x0)&&_0x463441++;});if(_0x463441!=0x0)return _0x419b85[_0x5d76f1(0x15d)](_0x5d76f1(0x188),_0x5d76f1(0xf3)),_0x62e77b[_0x5d76f1(0xb6)](_0x5d76f1(0xb9));const _0x3975b4=_0x5c1175[_0x5d76f1(0x14a)](_0x4bc9a5=>_0x4bc9a5[_0x5d76f1(0xbd)]!=='0'&&_0x4bc9a5['quantity']!=='');_0x475f4e['invoice']=_0x57d8b0,_0x475f4e[_0x5d76f1(0x182)]=_0x5468ca,_0x475f4e[_0x5d76f1(0xf6)]=_0x4e2aac,_0x475f4e[_0x5d76f1(0x11f)]=_0x413aa1,_0x475f4e[_0x5d76f1(0xfb)]=_0x3975b4,_0x475f4e[_0x5d76f1(0x186)]=_0x359a70,_0x475f4e[_0x5d76f1(0x161)]=_0x4915a8,_0x475f4e[_0x5d76f1(0x1ad)]=_0x5d76f1(0x104),_0x475f4e[_0x5d76f1(0xc8)]=_0x5d76f1(0x104);const _0x3c4b95=await _0x475f4e['save']();_0x419b85['flash'](_0x5d76f1(0x1ba),_0x5d76f1(0x15c)),_0x62e77b[_0x5d76f1(0xb6)](_0x5d76f1(0x197));}catch(_0x8c4cd8){console[_0x5d76f1(0x14c)](_0x8c4cd8);}}),router[a0_0x701933(0xcd)](a0_0x701933(0xea),auth,async(_0x2919c8,_0x7d56f4)=>{var _0x3a5fc6=a0_0x701933;try{const _0x4b09a8=_0x2919c8[_0x3a5fc6(0x14d)]['id'],{invoice:_0xa3b353,customer:_0x4420fb,receivable_amount:_0x1f49d6,received_amount:_0x3573b7}=_0x2919c8[_0x3a5fc6(0x135)],_0x11187a=await sales[_0x3a5fc6(0x11c)](_0x4b09a8);console[_0x3a5fc6(0x14c)](_0x11187a);var _0x5981eb=_0x1f49d6-_0x3573b7;console[_0x3a5fc6(0x14c)](_0x3573b7),_0x11187a[_0x3a5fc6(0xc3)]=parseFloat(_0x3573b7)+parseFloat(_0x11187a[_0x3a5fc6(0xc3)]),_0x11187a[_0x3a5fc6(0x112)]=_0x5981eb,console[_0x3a5fc6(0x14c)](_0x11187a);const _0x4e070c=await _0x11187a[_0x3a5fc6(0xd2)](),_0x8b30ce=await c_payment_data[_0x3a5fc6(0x147)]({'invoice':_0xa3b353});_0x8b30ce[_0x3a5fc6(0x16b)]=_0x5981eb,await _0x8b30ce[_0x3a5fc6(0xd2)]();let _0x2c88ca=new Date(),_0x4a02a9=('0'+_0x2c88ca[_0x3a5fc6(0xed)]())[_0x3a5fc6(0xf5)](-0x2),_0x2f62ae=('0'+(_0x2c88ca[_0x3a5fc6(0x165)]()+0x1))[_0x3a5fc6(0xf5)](-0x2),_0x1f93d6=_0x2c88ca['getFullYear'](),_0x23e01c=_0x1f93d6+'-'+_0x2f62ae+'-'+_0x4a02a9;const _0x1bd2f3=new customer_payment({'invoice':_0xa3b353,'date':_0x1f93d6+'-'+_0x2f62ae+'-'+_0x4a02a9,'customer':_0x4420fb,'reason':_0x3a5fc6(0x179),'amount':_0x3573b7}),_0x23b3e7=await _0x1bd2f3['save']();_0x2919c8['flash'](_0x3a5fc6(0x1ba),'payment\x20successfull'),_0x7d56f4[_0x3a5fc6(0xb6)](_0x3a5fc6(0x197));}catch(_0x2eb97a){console[_0x3a5fc6(0x14c)](_0x2eb97a);}}),router[a0_0x701933(0xe5)](a0_0x701933(0x158),auth,async(_0x45ee07,_0x1d9ad7)=>{var _0x417726=a0_0x701933;try{const {username:_0x4a1f21,email:_0x3a736e,role:_0x94845c}=_0x45ee07['user'],_0x257fe7=_0x45ee07['user'],_0x574218=await profile[_0x417726(0x147)]({'email':_0x257fe7[_0x417726(0xda)]}),_0x3c6698=await master_shop[_0x417726(0x193)]();console[_0x417726(0x14c)](_0x417726(0x140),_0x3c6698);const _0x24f342=_0x45ee07[_0x417726(0x14d)]['id'],_0x1772f3=await sales[_0x417726(0x11c)](_0x24f342);console[_0x417726(0x14c)](_0x1772f3);const _0x3fdd6c=await customer[_0x417726(0x147)]({'name':_0x1772f3['customer']});console[_0x417726(0x14c)](_0x3fdd6c);if(_0x3c6698[0x0][_0x417726(0x162)]=='English\x20(US)'){var _0x15670d=users[_0x417726(0x19d)];console[_0x417726(0x14c)](_0x15670d);}else{if(_0x3c6698[0x0]['language']==_0x417726(0xe9))var _0x15670d=users[_0x417726(0xe9)];else{if(_0x3c6698[0x0]['language']==_0x417726(0x171))var _0x15670d=users[_0x417726(0x171)];else{if(_0x3c6698[0x0][_0x417726(0x162)]=='Spanish')var _0x15670d=users['Spanish'];else{if(_0x3c6698[0x0][_0x417726(0x162)]==_0x417726(0x172))var _0x15670d=users['French'];else{if(_0x3c6698[0x0][_0x417726(0x162)]=='Portuguese\x20(BR)')var _0x15670d=users[_0x417726(0x137)];else{if(_0x3c6698[0x0][_0x417726(0x162)]==_0x417726(0x134))var _0x15670d=users[_0x417726(0x134)];else{if(_0x3c6698[0x0][_0x417726(0x162)]==_0x417726(0xec))var _0x15670d=users['Arabic'];}}}}}}}_0x1d9ad7[_0x417726(0x146)](_0x417726(0x1b2),{'success':_0x45ee07[_0x417726(0x15d)]('success'),'errors':_0x45ee07[_0x417726(0x15d)]('errors'),'role':_0x257fe7,'profile':_0x574218,'master_shop':_0x3c6698,'customers':_0x3fdd6c,'sales':_0x1772f3,'language':_0x15670d});}catch(_0x39a4f5){console[_0x417726(0x14c)](_0x39a4f5);}}),router[a0_0x701933(0xe5)](a0_0x701933(0xb8),auth,async(_0x55a2d8,_0x509568)=>{var _0x26cb6b=a0_0x701933;try{const {username:_0x1cfb48,email:_0xc957ea,role:_0x2533e4}=_0x55a2d8[_0x26cb6b(0x14f)],_0x73cdd7=_0x55a2d8[_0x26cb6b(0x14f)],_0x27907a=await profile[_0x26cb6b(0x147)]({'email':_0x73cdd7['email']}),_0x2a61d9=await master_shop['find']();console[_0x26cb6b(0x14c)]('master',_0x2a61d9);const _0x39b19e=_0x55a2d8[_0x26cb6b(0x14d)]['id'];console[_0x26cb6b(0x14c)](_0x39b19e);const _0x2ceb1f=await sales[_0x26cb6b(0x11c)](_0x39b19e);console[_0x26cb6b(0x14c)]('user_id',_0x2ceb1f);const _0x3e3c53=await warehouse[_0x26cb6b(0xad)]([{'$match':{'name':_0x26cb6b(0x1af),'room':_0x26cb6b(0xba)}},{'$unwind':_0x26cb6b(0x19a)},{'$group':{'_id':_0x26cb6b(0x119),'name':{'$first':_0x26cb6b(0xd8)},'product_stock':{'$first':_0x26cb6b(0x17d)},'level':{'$first':_0x26cb6b(0x13e)},'isle':{'$first':_0x26cb6b(0x133)},'pallet':{'$first':_0x26cb6b(0x1b3)},'primary_code':{'$first':_0x26cb6b(0xb3)},'secondary_code':{'$first':_0x26cb6b(0x18f)},'product_code':{'$first':_0x26cb6b(0xfd)}}}]);console['log']('stock_data',_0x3e3c53);const _0xbd5372=await product[_0x26cb6b(0x193)]({});warehouse_data=await warehouse[_0x26cb6b(0xad)]([{'$match':{'status':_0x26cb6b(0x17c),'name':_0x26cb6b(0x1af),'warehouse_category':_0x26cb6b(0x16a)}},{'$group':{'_id':_0x26cb6b(0x11a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0xbb4be5=[_0x26cb6b(0xba)];if(_0x2a61d9[0x0][_0x26cb6b(0x162)]==_0x26cb6b(0x1a6)){var _0x28dace=users['English'];console[_0x26cb6b(0x14c)](_0x28dace);}else{if(_0x2a61d9[0x0][_0x26cb6b(0x162)]==_0x26cb6b(0xe9))var _0x28dace=users[_0x26cb6b(0xe9)];else{if(_0x2a61d9[0x0][_0x26cb6b(0x162)]==_0x26cb6b(0x171))var _0x28dace=users['German'];else{if(_0x2a61d9[0x0][_0x26cb6b(0x162)]=='Spanish')var _0x28dace=users[_0x26cb6b(0xc2)];else{if(_0x2a61d9[0x0]['language']=='French')var _0x28dace=users[_0x26cb6b(0x172)];else{if(_0x2a61d9[0x0][_0x26cb6b(0x162)]=='Portuguese\x20(BR)')var _0x28dace=users[_0x26cb6b(0x137)];else{if(_0x2a61d9[0x0][_0x26cb6b(0x162)]==_0x26cb6b(0x134))var _0x28dace=users[_0x26cb6b(0x134)];else{if(_0x2a61d9[0x0]['language']==_0x26cb6b(0xec))var _0x28dace=users[_0x26cb6b(0x169)];}}}}}}}_0x509568[_0x26cb6b(0x146)](_0x26cb6b(0x10d),{'success':_0x55a2d8[_0x26cb6b(0x15d)](_0x26cb6b(0x1ba)),'errors':_0x55a2d8[_0x26cb6b(0x15d)](_0x26cb6b(0x188)),'role':_0x73cdd7,'profile':_0x27907a,'user':_0x2ceb1f,'stock':_0x3e3c53,'master_shop':_0x2a61d9,'unit':_0xbd5372,'language':_0x28dace,'warehouses':warehouse_data,'rooms':_0xbb4be5});}catch(_0x96b253){console[_0x26cb6b(0x14c)](_0x96b253),_0x509568[_0x26cb6b(0xcb)](0xc8)[_0x26cb6b(0x18e)]({'message':_0x96b253[_0x26cb6b(0xe7)]});}}),router[a0_0x701933(0xcd)](a0_0x701933(0xb8),auth,async(_0x779cd7,_0x165f68)=>{var _0x2cd096=a0_0x701933;try{const {invoice:_0xe8f5a7,date:_0x277121,warehouse_name:_0x1493a4,product_name:_0x4b7176,primary_code:_0x4599fc,secondary_code:_0x46eb9e,product_code:_0x5e5f70,sales_quantity:_0x4709e2,stocks:_0x344213,return_qty:_0x259fcb,Room_name:_0x26c713,to_warehouse_name:_0x4adbb6,to_Roomname:_0x558cac,to_Room_name:_0x4933b9,note:_0x574c20,level:_0x4ff111,isle:_0x9ae529,pallet:_0x263a61}=_0x779cd7[_0x2cd096(0x135)];if(typeof _0x4b7176=='string')var _0x2ec4eb=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x185)]],_0x374490=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x18a)]],_0xbdb39=[_0x779cd7['body']['secondary_code']],_0x566ea8=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x1b9)]],_0x11ebe1=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x110)]],_0x9d42a6=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x13c)]],_0x158ba9=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x10a)]],_0xfc13b9=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x166)]],_0x5253da=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0xe6)]],_0x214e4=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x1b8)]],_0x308960=[_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x181)]];else var _0x2ec4eb=[..._0x779cd7[_0x2cd096(0x135)]['product_name']],_0x374490=[..._0x779cd7['body'][_0x2cd096(0x18a)]],_0xbdb39=[..._0x779cd7['body']['secondary_code']],_0x566ea8=[..._0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x1b9)]],_0x11ebe1=[..._0x779cd7[_0x2cd096(0x135)]['sales_quantity']],_0x9d42a6=[..._0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x13c)]],_0x158ba9=[..._0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x10a)]],_0xfc13b9=[..._0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x166)]],_0x5253da=[..._0x779cd7['body']['bin']],_0x214e4=[..._0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x1b8)]],_0x308960=[..._0x779cd7[_0x2cd096(0x135)]['floorlevel']];const _0x543640=_0x2ec4eb[_0x2cd096(0x159)](_0x4bcba6=>{return _0x4bcba6={'product_name':_0x4bcba6};});_0x374490[_0x2cd096(0x170)]((_0xb8100d,_0x4fe6b1)=>{var _0x22a9ad=_0x2cd096;_0x543640[_0x4fe6b1][_0x22a9ad(0x18a)]=_0xb8100d;}),_0xbdb39[_0x2cd096(0x170)]((_0x21ccf4,_0x8f950d)=>{var _0x41df52=_0x2cd096;_0x543640[_0x8f950d][_0x41df52(0x19c)]=_0x21ccf4;}),_0x566ea8['forEach']((_0x5c5c9d,_0x1263f0)=>{var _0x3ea38a=_0x2cd096;_0x543640[_0x1263f0][_0x3ea38a(0x1b9)]=_0x5c5c9d;}),_0x11ebe1[_0x2cd096(0x170)]((_0x4fb7e6,_0x5d348f)=>{var _0x476338=_0x2cd096;_0x543640[_0x5d348f][_0x476338(0xfe)]=_0x4fb7e6;}),_0x9d42a6['forEach']((_0x11b4e5,_0x1a4ed2)=>{var _0x1333d7=_0x2cd096;_0x543640[_0x1a4ed2][_0x1333d7(0xee)]=_0x11b4e5;}),_0x158ba9[_0x2cd096(0x170)]((_0x4c1354,_0x42f55f)=>{var _0x521289=_0x2cd096;_0x543640[_0x42f55f][_0x521289(0x10a)]=_0x4c1354;}),_0xfc13b9[_0x2cd096(0x170)]((_0x3920cb,_0x4fb3c0)=>{var _0x5f492c=_0x2cd096;_0x543640[_0x4fb3c0][_0x5f492c(0x166)]=_0x3920cb;}),_0x5253da[_0x2cd096(0x170)]((_0x57f482,_0x1139c5)=>{_0x543640[_0x1139c5]['bin']=_0x57f482;}),_0x214e4['forEach']((_0x133776,_0x10f9bd)=>{var _0x2a592c=_0x2cd096;_0x543640[_0x10f9bd][_0x2a592c(0x177)]=_0x133776;}),_0x308960['forEach']((_0x105d40,_0x93ef25)=>{var _0x36522d=_0x2cd096;_0x543640[_0x93ef25][_0x36522d(0x181)]=_0x105d40;});var _0x4bfc58=0x0;_0x543640[_0x2cd096(0x170)](_0x442ba3=>{var _0x5a20e1=_0x2cd096;console[_0x5a20e1(0x14c)]('foreach\x20newproduct',_0x442ba3),(parseInt(_0x442ba3[_0x5a20e1(0xfe)])<parseInt(_0x442ba3[_0x5a20e1(0x10a)])||parseInt(_0x442ba3['stock'])<parseInt(_0x442ba3['return_qty'])&&parseInt(_0x442ba3[_0x5a20e1(0xfe)])>parseInt(_0x442ba3[_0x5a20e1(0x10a)])||parseInt(_0x442ba3['return_qty'])==0x0)&&_0x4bfc58++;});if(_0x4bfc58!=0x0)return _0x779cd7[_0x2cd096(0x15d)]('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x165f68['redirect']('back');const _0x22809d=await sales[_0x2cd096(0x147)]({'invoice':_0xe8f5a7});console[_0x2cd096(0x14c)](_0x22809d),_0x22809d[_0x2cd096(0x145)]='True';const _0x1f27f0=await _0x22809d[_0x2cd096(0xd2)](),_0x514ff1=new sales_return({'invoice':_0xe8f5a7,'customer':_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x182)],'date':_0x277121,'warehouse_name':_0x1493a4,'room':_0x26c713,'ToWarehouse':_0x4adbb6,'ToRoom':_0x4933b9,'return_sale':_0x543640,'note':_0x574c20}),_0x7e1d16=await _0x514ff1[_0x2cd096(0xd2)]();console['log'](_0x514ff1);const _0x4d5212=await sales_return[_0x2cd096(0x147)]({'invoice':_0xe8f5a7}),_0x2aa75e=await warehouse[_0x2cd096(0x147)]({'name':_0x4adbb6,'room':_0x4933b9});_0x4d5212['return_sale'][_0x2cd096(0x170)](_0x49720f=>{var _0xeaf119=_0x2cd096,_0x438155=0x0;const _0x2b6ec5=_0x2aa75e[_0xeaf119(0x175)][_0xeaf119(0x159)](_0x411355=>{var _0x5ae4b=_0xeaf119;_0x411355[_0x5ae4b(0x185)]==_0x49720f[_0x5ae4b(0x185)]&&_0x411355[_0x5ae4b(0x181)]==_0x49720f[_0x5ae4b(0x181)]&&_0x411355['type']==_0x49720f['type']&&_0x411355[_0x5ae4b(0xe6)]==_0x49720f['bin']&&_0x411355[_0x5ae4b(0x166)]==_0x49720f[_0x5ae4b(0x166)]&&(_0x411355[_0x5ae4b(0xf2)]=parseInt(_0x411355['product_stock'])+parseInt(_0x49720f[_0x5ae4b(0x10a)]),_0x438155++);});_0x438155=='0'&&(_0x2aa75e[_0xeaf119(0x175)]=_0x2aa75e[_0xeaf119(0x175)][_0xeaf119(0xaf)]({'product_name':_0x49720f[_0xeaf119(0x185)],'product_stock':_0x49720f[_0xeaf119(0x10a)],'primary_code':_0x49720f[_0xeaf119(0x18a)],'secondary_code':_0x49720f['secondary_code'],'product_code':_0x49720f[_0xeaf119(0x1b9)],'bay':_0x49720f['bay'],'bin':_0x49720f[_0xeaf119(0xe6)],'type':_0x49720f[_0xeaf119(0x177)],'floorlevel':_0x49720f['floorlevel']})),console[_0xeaf119(0x14c)](_0xeaf119(0x17e),_0x2aa75e);}),await _0x2aa75e[_0x2cd096(0xd2)](),console[_0x2cd096(0x14c)](_0x779cd7[_0x2cd096(0x135)]);const _0x29b186=new c_payment_data({'invoice':_0xe8f5a7,'customer':_0x779cd7[_0x2cd096(0x135)][_0x2cd096(0x182)],'reason':_0x2cd096(0x183)});await _0x29b186[_0x2cd096(0xd2)]();const _0x1db22a=await master_shop[_0x2cd096(0x193)]();console[_0x2cd096(0x14c)](_0x2cd096(0xd5),_0x1db22a[0x0][_0x2cd096(0x101)]);const _0x43cb27=await email_settings[_0x2cd096(0x147)](),_0x502fe2=await customer['findOne']({'name':_0x779cd7[_0x2cd096(0x135)]['customer']});console[_0x2cd096(0x14c)](_0x2cd096(0x176),_0x502fe2);_0x1db22a[0x0]['currency_placement']==0x1?(right_currency=_0x1db22a[0x0][_0x2cd096(0x13a)],left_currency=''):(right_currency='',left_currency=_0x1db22a[0x0]['currency']);var _0x4528b2=_0x2ec4eb,_0x13ba55=_0x158ba9,_0x438105='',_0x33028c;for(_0x33028c in _0x4528b2){_0x438105+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4528b2[_0x33028c]+_0x2cd096(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13ba55[_0x33028c]+'</td>'+_0x2cd096(0x17a);}console[_0x2cd096(0x14c)]('product_list',_0x438105);let _0x4d68a2=nodemailer['createTransport']({'service':_0x2cd096(0xe3),'auth':{'user':_0x43cb27[_0x2cd096(0xda)],'pass':_0x43cb27[_0x2cd096(0xe1)]}}),_0x5a62ff={'from':_0x43cb27[_0x2cd096(0xda)],'to':_0x502fe2['email'],'subject':_0x2cd096(0x156),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2cd096(0xc4)+_0x2cd096(0x138)+_0x1db22a[0x0][_0x2cd096(0x101)],'cid':_0x2cd096(0xb4)}],'html':'<!DOCTYPE\x20html>'+_0x2cd096(0x116)+_0x2cd096(0x191)+_0x2cd096(0x10c)+_0x2cd096(0x1a8)+_0x2cd096(0x10c)+_0x2cd096(0x12a)+_0x2cd096(0x1b4)+_0x2cd096(0x10c)+_0x2cd096(0xac)+_0x1db22a[0x0]['site_title']+_0x2cd096(0x173)+'</div>'+_0x2cd096(0x1b4)+_0x2cd096(0x157)+_0x2cd096(0x10c)+_0x2cd096(0x131)+_0x2cd096(0xdb)+_0xe8f5a7+'\x20'+_0x2cd096(0x144)+_0x2cd096(0x190)+_0x277121+'\x20'+'</span>'+_0x2cd096(0x1bb)+_0x2cd096(0x1b4)+_0x2cd096(0x12e)+_0x2cd096(0x12f)+_0x2cd096(0x122)+_0x2cd096(0xb2)+_0x2cd096(0xb0)+_0x2cd096(0x136)+_0x2cd096(0x152)+_0x2cd096(0x17a)+_0x2cd096(0x1aa)+_0x2cd096(0xc9)+'\x20'+_0x438105+'\x20'+_0x2cd096(0xc0)+_0x2cd096(0x163)+_0x2cd096(0x10c)+_0x2cd096(0xae)+_0x2cd096(0x142)+_0x1db22a[0x0][_0x2cd096(0xfc)]+'</h5>'+_0x2cd096(0x1b4)+_0x2cd096(0x1b4)+_0x2cd096(0xde)};_0x4d68a2[_0x2cd096(0xce)](_0x5a62ff,function(_0x55a445,_0x45a031){var _0xeca463=_0x2cd096;_0x55a445?(console[_0xeca463(0x14c)](_0x55a445),console[_0xeca463(0x14c)](_0xeca463(0x1b0))):console[_0xeca463(0x14c)](_0xeca463(0xdc));}),_0x779cd7[_0x2cd096(0x15d)]('success','sales\x20item\x20return\x20successfull'),_0x165f68[_0x2cd096(0xb6)](_0x2cd096(0x197));}catch(_0x59c12b){console[_0x2cd096(0x14c)](_0x59c12b),_0x165f68[_0x2cd096(0xcb)](0xc8)[_0x2cd096(0x18e)]({'message1':_0x59c12b['message']});}}),router['get']('/barcode/:id',auth,async(_0x54e4fd,_0x10b61d)=>{var _0xdbbbb7=a0_0x701933;try{const {username:_0x48bd04,email:_0x41a343,role:_0x51393d}=_0x54e4fd[_0xdbbbb7(0x14f)],_0x1f6b70=_0x54e4fd[_0xdbbbb7(0x14f)],_0x5a10bb=await profile[_0xdbbbb7(0x147)]({'email':_0x1f6b70[_0xdbbbb7(0xda)]}),_0x5787f4=await master_shop['find']();console[_0xdbbbb7(0x14c)](_0xdbbbb7(0xbe),_0x5787f4);const _0x5ae33b=_0x54e4fd['params']['id'],_0x4cff5e=await sales[_0xdbbbb7(0x11c)](_0x5ae33b);console[_0xdbbbb7(0x14c)](_0xdbbbb7(0x18d),_0x4cff5e);if(_0x5787f4[0x0][_0xdbbbb7(0x162)]==_0xdbbbb7(0x1a6))var _0x58f51c=users[_0xdbbbb7(0x19d)];else{if(_0x5787f4[0x0]['language']=='Hindi')var _0x58f51c=users['Hindi'];else{if(_0x5787f4[0x0][_0xdbbbb7(0x162)]==_0xdbbbb7(0x171))var _0x58f51c=users[_0xdbbbb7(0x171)];else{if(_0x5787f4[0x0][_0xdbbbb7(0x162)]==_0xdbbbb7(0xc2))var _0x58f51c=users[_0xdbbbb7(0xc2)];else{if(_0x5787f4[0x0]['language']==_0xdbbbb7(0x172))var _0x58f51c=users[_0xdbbbb7(0x172)];else{if(_0x5787f4[0x0]['language']=='Portuguese\x20(BR)')var _0x58f51c=users['Portuguese'];else{if(_0x5787f4[0x0][_0xdbbbb7(0x162)]==_0xdbbbb7(0x134))var _0x58f51c=users[_0xdbbbb7(0x134)];else{if(_0x5787f4[0x0][_0xdbbbb7(0x162)]=='Arabic\x20(ae)')var _0x58f51c=users[_0xdbbbb7(0x169)];}}}}}}}_0x10b61d[_0xdbbbb7(0x146)](_0xdbbbb7(0x1a5),{'success':_0x54e4fd['flash'](_0xdbbbb7(0x1ba)),'errors':_0x54e4fd[_0xdbbbb7(0x15d)](_0xdbbbb7(0x188)),'role':_0x1f6b70,'profile':_0x5a10bb,'alldata':_0x4cff5e,'master_shop':_0x5787f4,'language':_0x58f51c});}catch(_0x3c303a){console[_0xdbbbb7(0x14c)](_0x3c303a);}}),router[a0_0x701933(0xcd)](a0_0x701933(0xb1),async(_0x4882db,_0x4f0a27)=>{var _0x8c2fe8=a0_0x701933;const {product_code:_0x8cb8ba,warehouse_name:_0x496a2,rooms_data:_0x27ae6a,Roomslist:_0x47c173}=_0x4882db[_0x8c2fe8(0x135)],_0x47302f=_0x47c173[_0x8c2fe8(0x1ae)](','),_0x5c820d=[];async function _0x1d2050(_0x18c0dd){var _0x3e4aff=_0x8c2fe8;const _0x3bc7a7=await warehouse[_0x3e4aff(0xad)]([{'$match':{'name':_0x496a2,'room':_0x18c0dd}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x8cb8ba}},{'$group':{'_id':_0x3e4aff(0x119),'name':{'$first':_0x3e4aff(0xd8)},'product_stock':{'$first':_0x3e4aff(0x17d)},'primary_code':{'$first':_0x3e4aff(0xb3)},'secondary_code':{'$first':_0x3e4aff(0x18f)},'product_code':{'$first':_0x3e4aff(0xfd)},'level':{'$first':_0x3e4aff(0x16f)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3e4aff(0x120)},'unit':{'$first':_0x3e4aff(0x130)},'secondary_unit':{'$first':_0x3e4aff(0x195)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3e4aff(0x19e)},'expiry_date':{'$first':_0x3e4aff(0x13b)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x3e4aff(0xc6)},'batch_code':{'$first':_0x3e4aff(0xf9)},'product_cat':{'$first':_0x3e4aff(0x15e)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3e4aff(0xcc)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x3e4aff(0xf8)},'actual_uom':{'$first':_0x3e4aff(0x15f)}}}]),_0x52dd43=await warehouse[_0x3e4aff(0xad)]([{'$match':{'name':_0x496a2,'room':_0x18c0dd}},{'$unwind':_0x3e4aff(0x19a)},{'$match':{'product_details.secondary_code':_0x8cb8ba}},{'$group':{'_id':_0x3e4aff(0x119),'name':{'$first':_0x3e4aff(0xd8)},'product_stock':{'$first':_0x3e4aff(0x17d)},'primary_code':{'$first':_0x3e4aff(0xb3)},'secondary_code':{'$first':_0x3e4aff(0x18f)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3e4aff(0x16f)},'isle':{'$first':_0x3e4aff(0x100)},'type':{'$first':_0x3e4aff(0xbb)},'pallet':{'$first':_0x3e4aff(0x120)},'unit':{'$first':_0x3e4aff(0x130)},'secondary_unit':{'$first':_0x3e4aff(0x195)},'storage':{'$first':_0x3e4aff(0x167)},'rack':{'$first':_0x3e4aff(0x19e)},'expiry_date':{'$first':_0x3e4aff(0x13b)},'production_date':{'$first':_0x3e4aff(0x155)},'maxPerUnit':{'$first':_0x3e4aff(0xc6)},'batch_code':{'$first':_0x3e4aff(0xf9)},'product_cat':{'$first':_0x3e4aff(0x15e)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3e4aff(0xf7)}}}]);if(_0x3bc7a7[_0x3e4aff(0x12b)]>0x0)_0x5c820d[_0x3e4aff(0x126)](_0x3bc7a7);else _0x52dd43[_0x3e4aff(0x12b)]>0x0&&_0x5c820d['push'](_0x52dd43);}const _0x192ba2=_0x47302f[_0x8c2fe8(0x159)](_0x94b72a=>_0x1d2050(_0x94b72a));await Promise['all'](_0x192ba2),_0x4f0a27['json'](_0x5c820d);}),module[a0_0x701933(0xbf)]=router;