var a0_0x5363ac=a0_0x2ca1;(function(_0x154f0b,_0x2a9388){var _0x1b4276=a0_0x2ca1,_0x4406bf=_0x154f0b();while(!![]){try{var _0x4dc33a=-parseInt(_0x1b4276(0x1b5))/0x1+-parseInt(_0x1b4276(0x1cb))/0x2*(parseInt(_0x1b4276(0x128))/0x3)+parseInt(_0x1b4276(0x154))/0x4+parseInt(_0x1b4276(0xf2))/0x5*(-parseInt(_0x1b4276(0x152))/0x6)+parseInt(_0x1b4276(0x1d2))/0x7+-parseInt(_0x1b4276(0x1ab))/0x8+parseInt(_0x1b4276(0xda))/0x9;if(_0x4dc33a===_0x2a9388)break;else _0x4406bf['push'](_0x4406bf['shift']());}catch(_0x5a2cf9){_0x4406bf['push'](_0x4406bf['shift']());}}}(a0_0x49ad,0x80484));const express=require(a0_0x5363ac(0x120)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x5363ac(0x153)),auth=require(a0_0x5363ac(0x14a)),nodemailer=require(a0_0x5363ac(0x11f)),users=require(a0_0x5363ac(0x198));router['get'](a0_0x5363ac(0x17a),auth,async(_0x2ad518,_0x2e4bfc)=>{var _0x35ffe9=a0_0x5363ac;try{const {username:_0xd70160,email:_0x1c3e05,role:_0x347025}=_0x2ad518[_0x35ffe9(0x1b0)],_0x4e697b=_0x2ad518[_0x35ffe9(0x1b0)],_0x5d396e=await profile['findOne']({'email':_0x4e697b[_0x35ffe9(0x164)]}),_0x3e784d=await master_shop[_0x35ffe9(0x1c2)]();let _0x2b4792;if(_0x4e697b[_0x35ffe9(0x13a)]==_0x35ffe9(0x158)){const _0x4fd790=await staff[_0x35ffe9(0xeb)]({'email':_0x4e697b[_0x35ffe9(0x164)]});_0x2b4792=await sales[_0x35ffe9(0x18c)]([{'$lookup':{'from':_0x35ffe9(0x14c),'localField':_0x35ffe9(0x17c),'foreignField':_0x35ffe9(0x15e),'as':_0x35ffe9(0x194)}},{'$unwind':_0x35ffe9(0x13b)},{'$unwind':_0x35ffe9(0x1c8)},{'$group':{'_id':_0x35ffe9(0x1bf),'invoice':{'$first':_0x35ffe9(0x16b)},'customers':{'$first':_0x35ffe9(0x146)},'date':{'$first':_0x35ffe9(0x101)},'warehouse_name':{'$first':_0x35ffe9(0x1d3)},'sale_product':{'$push':_0x35ffe9(0x1c8)},'note':{'$first':_0x35ffe9(0xf0)},'return_data':{'$first':_0x35ffe9(0x13c)},'customers_docs':{'$first':_0x35ffe9(0x13b)},'total_saleproduct_quantity':{'$sum':_0x35ffe9(0x169)},'level':{'$addToSet':_0x35ffe9(0x107)},'isle':{'$addToSet':_0x35ffe9(0x178)},'type':{'$addToSet':_0x35ffe9(0xf8)},'pallet':{'$addToSet':_0x35ffe9(0x15b)},'finalize':{'$first':_0x35ffe9(0x17b)},'isAllowEdit':{'$first':_0x35ffe9(0xe8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2b4792=await sales[_0x35ffe9(0x18c)]([{'$lookup':{'from':'customers','localField':_0x35ffe9(0x17c),'foreignField':_0x35ffe9(0x15e),'as':_0x35ffe9(0x194)}},{'$unwind':_0x35ffe9(0x13b)},{'$unwind':_0x35ffe9(0x1c8)},{'$group':{'_id':_0x35ffe9(0x1bf),'invoice':{'$first':_0x35ffe9(0x16b)},'customers':{'$first':'$customer'},'date':{'$first':_0x35ffe9(0x101)},'warehouse_name':{'$first':_0x35ffe9(0x1d3)},'sale_product':{'$push':_0x35ffe9(0x1c8)},'note':{'$first':'$note'},'return_data':{'$first':_0x35ffe9(0x13c)},'customers_docs':{'$first':_0x35ffe9(0x13b)},'total_saleproduct_quantity':{'$sum':_0x35ffe9(0x169)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x35ffe9(0x15b)},'finalize':{'$first':_0x35ffe9(0x17b)},'isAllowEdit':{'$first':_0x35ffe9(0xe8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x35ffe9(0x19e)]('sales\x20all_data',_0x2b4792);if(_0x3e784d[0x0][_0x35ffe9(0x187)]=='English\x20(US)'){var _0x5255c3=users[_0x35ffe9(0x110)];console[_0x35ffe9(0x19e)](_0x5255c3);}else{if(_0x3e784d[0x0][_0x35ffe9(0x187)]==_0x35ffe9(0x1b2))var _0x5255c3=users[_0x35ffe9(0x1b2)];else{if(_0x3e784d[0x0][_0x35ffe9(0x187)]=='German')var _0x5255c3=users[_0x35ffe9(0x18f)];else{if(_0x3e784d[0x0][_0x35ffe9(0x187)]=='Spanish')var _0x5255c3=users[_0x35ffe9(0x1ce)];else{if(_0x3e784d[0x0]['language']==_0x35ffe9(0xf9))var _0x5255c3=users['French'];else{if(_0x3e784d[0x0][_0x35ffe9(0x187)]=='Portuguese\x20(BR)')var _0x5255c3=users['Portuguese'];else{if(_0x3e784d[0x0][_0x35ffe9(0x187)]==_0x35ffe9(0xf6))var _0x5255c3=users[_0x35ffe9(0xf6)];else{if(_0x3e784d[0x0][_0x35ffe9(0x187)]==_0x35ffe9(0x168))var _0x5255c3=users[_0x35ffe9(0x149)];}}}}}}}_0x2e4bfc[_0x35ffe9(0x130)](_0x35ffe9(0x14d),{'success':_0x2ad518[_0x35ffe9(0x1c7)](_0x35ffe9(0x123)),'errors':_0x2ad518['flash'](_0x35ffe9(0x12b)),'sales':_0x2b4792,'profile':_0x5d396e,'role':_0x4e697b,'master_shop':_0x3e784d,'language':_0x5255c3});}catch(_0x22a01a){console[_0x35ffe9(0x19e)](_0x22a01a);}});async function getRandom8DigitNumber(){var _0x1f62ee=a0_0x5363ac;const _0x14eb15=0x989680,_0x4d4ea8=0x5f5e0ff,_0x32cb67=Math[_0x1f62ee(0x11d)](Math[_0x1f62ee(0x145)]()*(_0x4d4ea8-_0x14eb15+0x1))+_0x14eb15;var _0x491eeb;const _0xbd7405=await sales[_0x1f62ee(0xeb)]({'invoice':_0x1f62ee(0x115)+_0x32cb67});return _0xbd7405&&_0xbd7405[_0x1f62ee(0x148)]>0x0?_0x491eeb=_0x1f62ee(0x115)+_0x32cb67:_0x491eeb=_0x1f62ee(0x115)+_0x32cb67,_0x491eeb;}router['get'](a0_0x5363ac(0xf5),auth,async(_0x312ca8,_0x259fb7)=>{var _0x455625=a0_0x5363ac;try{const {username:_0x324f7d,email:_0x17a497,role:_0x510d4d}=_0x312ca8[_0x455625(0x1b0)],_0x479310=_0x312ca8['user'],_0x4025f2=await profile[_0x455625(0xeb)]({'email':_0x479310[_0x455625(0x164)]}),_0x5b78f5=await master_shop[_0x455625(0x1c2)](),_0x28f992=await customer[_0x455625(0x1c2)]({});let _0x14af40;if(_0x479310[_0x455625(0x13a)]==_0x455625(0x158)){const _0x4124e9=await staff[_0x455625(0xeb)]({'email':_0x479310[_0x455625(0x164)]});_0x14af40=await warehouse['aggregate']([{'$match':{'status':_0x455625(0x112),'name':_0x4124e9[_0x455625(0xd8)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x455625(0x14e)}}},{'$group':{'_id':_0x455625(0x18d),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x14af40=await warehouse[_0x455625(0x18c)]([{'$match':{'status':_0x455625(0x112),'warehouse_category':_0x455625(0x15f),'name':{'$ne':_0x455625(0x14e)}}},{'$group':{'_id':_0x455625(0x18d),'name':{'$first':_0x455625(0x18d)}}},{'$sort':{'name':0x1}}]);const _0x59b511=await product[_0x455625(0x1c2)]({});var _0x59e740=[_0x455625(0x108),_0x455625(0x1a4)];const _0x4110d1=await sales[_0x455625(0x1c2)]({}),_0x10d730=_0x4110d1[_0x455625(0x148)]+0x1,_0x446f47=_0x455625(0x115)+_0x10d730[_0x455625(0x139)]()[_0x455625(0x151)](0x5,'0');if(_0x5b78f5[0x0][_0x455625(0x187)]==_0x455625(0x19a)){var _0x1ff3a2=users['English'];console[_0x455625(0x19e)](_0x1ff3a2);}else{if(_0x5b78f5[0x0][_0x455625(0x187)]==_0x455625(0x1b2))var _0x1ff3a2=users[_0x455625(0x1b2)];else{if(_0x5b78f5[0x0]['language']==_0x455625(0x18f))var _0x1ff3a2=users[_0x455625(0x18f)];else{if(_0x5b78f5[0x0][_0x455625(0x187)]==_0x455625(0x1ce))var _0x1ff3a2=users[_0x455625(0x1ce)];else{if(_0x5b78f5[0x0][_0x455625(0x187)]=='French')var _0x1ff3a2=users[_0x455625(0xf9)];else{if(_0x5b78f5[0x0]['language']==_0x455625(0x183))var _0x1ff3a2=users[_0x455625(0x1cc)];else{if(_0x5b78f5[0x0][_0x455625(0x187)]==_0x455625(0xf6))var _0x1ff3a2=users[_0x455625(0xf6)];else{if(_0x5b78f5[0x0][_0x455625(0x187)]==_0x455625(0x168))var _0x1ff3a2=users['Arabic'];}}}}}}}const _0x39bf2f=getRandom8DigitNumber();_0x39bf2f['then'](_0x2f0ff1=>{var _0x1d5e9d=_0x455625;_0x259fb7[_0x1d5e9d(0x130)](_0x1d5e9d(0x11a),{'success':_0x312ca8[_0x1d5e9d(0x1c7)](_0x1d5e9d(0x123)),'errors':_0x312ca8[_0x1d5e9d(0x1c7)](_0x1d5e9d(0x12b)),'role':_0x479310,'profile':_0x4025f2,'customer':_0x28f992,'warehouse':_0x14af40,'product':_0x59b511,'invoice':_0x2f0ff1,'master_shop':_0x5b78f5,'language':_0x1ff3a2,'rooms_data':_0x59e740});})[_0x455625(0xfd)](_0x294cde=>{var _0xda755b=_0x455625;_0x312ca8[_0xda755b(0x1c7)]('errors',_0xda755b(0x16f)),_0x259fb7[_0xda755b(0x1c5)](_0xda755b(0x1b4));});}catch(_0x130a99){console['log'](_0x130a99);}}),router[a0_0x5363ac(0x1b1)](a0_0x5363ac(0x10d),auth,async(_0x35a737,_0x569731)=>{var _0x4cddc0=a0_0x5363ac;try{const _0x58e0f4=_0x35a737[_0x4cddc0(0x1b7)]['id'];console[_0x4cddc0(0x19e)](_0x58e0f4);const _0x532669=await product['find'](),_0x65e824=await purchases['aggregate']([{'$match':{'warehouse_name':_0x58e0f4}},{'$unwind':_0x4cddc0(0xd4)},{'$group':{'_id':_0x4cddc0(0x195)}}]);console['log'](_0x4cddc0(0x1ae),_0x65e824),_0x569731[_0x4cddc0(0x1d7)](0xc8)[_0x4cddc0(0xee)]({'purchases_data':_0x65e824,'product_data':_0x532669});}catch(_0x1ee8ef){console[_0x4cddc0(0x19e)](_0x1ee8ef);}}),router['post'](a0_0x5363ac(0xd0),auth,async(_0x18b90a,_0x3b4f27)=>{var _0x151931=a0_0x5363ac;try{const {warehouse_data:_0x54ba86,product_data:_0x531471}=_0x18b90a['body'];console[_0x151931(0x19e)](_0x18b90a[_0x151931(0x1c3)][_0x151931(0x180)]);;const _0x4d764f=await master_shop['find']();console[_0x151931(0x19e)](_0x151931(0x1a3),_0x4d764f);const _0x588065=await product[_0x151931(0xeb)]({'name':_0x531471});console[_0x151931(0x19e)](_0x151931(0x171),_0x588065);const _0x3f3253=await warehouse['aggregate']([{'$match':{'name':_0x54ba86}},{'$unwind':_0x151931(0x1af)},{'$match':{'product_details.product_name':_0x531471}},{'$group':{'_id':_0x151931(0x19c),'product_stock':{'$first':_0x151931(0x147)}}}]);console[_0x151931(0x19e)](_0x151931(0x16d),_0x3f3253),_0x3b4f27['status'](0xc8)[_0x151931(0xee)]({'master':_0x4d764f,'new_product':_0x588065,'stock_data':_0x3f3253});}catch(_0x3d16d7){console[_0x151931(0x19e)](_0x3d16d7);}}),router[a0_0x5363ac(0xdc)]('/view/add_sales',auth,async(_0x521cab,_0xda36b2)=>{var _0x295dfd=a0_0x5363ac;try{const {invoice:_0x4f8464,date:_0x1d1297,warehouse_name:_0x441b9c,product_name:_0x54d12f,stock:_0x1bed7a,quantity:_0x166d5d,note:_0x40533a,room:_0x273510,primary_code:_0x1f7525,secondary_code:_0x44a371,prod_code:_0x27eeff,level:_0x5de12e,isle:_0x598939,pallet:_0x592a14,batch_code:_0x56f832,SCRN:_0x125d07,expiry_date:_0x2ef2f}=_0x521cab['body'];if(typeof _0x54d12f==_0x295dfd(0xdb))var _0xf8bf80=[_0x521cab[_0x295dfd(0x1c3)]['product_name']],_0x4be2c0=[_0x521cab['body'][_0x295dfd(0x1ba)]],_0x2ea572=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x126)]],_0x203a50=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x12d)]],_0x459706=[_0x521cab['body'][_0x295dfd(0x11c)]],_0x253420=[_0x521cab[_0x295dfd(0x1c3)]['prod_code']],_0x4552fa=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x119)]],_0xd66263=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0xdd)]],_0x45b1b0=[_0x521cab[_0x295dfd(0x1c3)]['secondary_unit']],_0x4b88f4=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x13e)]],_0x11ec00=[_0x521cab['body'][_0x295dfd(0x1dc)]],_0x264935=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x135)]],_0x3008f0=[_0x521cab['body'][_0x295dfd(0x160)]],_0x2cd9d1=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x17d)]],_0xfaebbe=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x1b9)]],_0x258bd1=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x18a)]],_0x44e915=[_0x521cab[_0x295dfd(0x1c3)]['prod_cat']],_0x126dea=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x1c1)]],_0x329c82=[_0x521cab['body'][_0x295dfd(0x156)]],_0x5a7a71=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0xe5)]],_0x5a5685=[_0x521cab['body']['actual_qty']],_0x2f2cb6=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x182)]],_0x2a21b7=[_0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x1d9)]];else var _0xf8bf80=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x193)]],_0x4be2c0=[..._0x521cab['body'][_0x295dfd(0x1ba)]],_0x2ea572=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x126)]],_0x203a50=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x12d)]],_0x459706=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x11c)]],_0x253420=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x125)]],_0x4552fa=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x119)]],_0xd66263=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0xdd)]],_0x45b1b0=[..._0x521cab['body'][_0x295dfd(0xf4)]],_0x4b88f4=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x13e)]],_0x11ec00=[..._0x521cab['body'][_0x295dfd(0x1dc)]],_0x264935=[..._0x521cab[_0x295dfd(0x1c3)]['max_per_unit']],_0x3008f0=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x160)]],_0x2cd9d1=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x17d)]],_0xfaebbe=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x1b9)]],_0x258bd1=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x18a)]],_0x44e915=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x186)]],_0x126dea=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x1c1)]],_0x329c82=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x156)]],_0x5a7a71=[..._0x521cab['body'][_0x295dfd(0xe5)]],_0x5a5685=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x131)]],_0x2f2cb6=[..._0x521cab[_0x295dfd(0x1c3)]['actual_uom']],_0x2a21b7=[..._0x521cab[_0x295dfd(0x1c3)][_0x295dfd(0x1d9)]];const _0x1361e2=_0xf8bf80[_0x295dfd(0xfc)](_0x3140b0=>{return _0x3140b0={'product_name':_0x3140b0};});_0x4be2c0[_0x295dfd(0x129)]((_0x3c03ef,_0x3a7c53)=>{var _0x1c975e=_0x295dfd;_0x1361e2[_0x3a7c53]['stock']=Math[_0x1c975e(0x19d)](_0x3c03ef);}),_0x5a5685[_0x295dfd(0x129)]((_0x5be956,_0x1853ac)=>{var _0x2fd4ca=_0x295dfd;_0x1361e2[_0x1853ac][_0x2fd4ca(0x131)]=Math['abs'](_0x5be956);}),_0x2f2cb6[_0x295dfd(0x129)]((_0x2727f5,_0x238076)=>{var _0x1cafe6=_0x295dfd;_0x1361e2[_0x238076][_0x1cafe6(0x182)]=_0x2727f5;}),_0x2a21b7[_0x295dfd(0x129)]((_0xfa5fc5,_0x114f3c)=>{var _0x1342d5=_0x295dfd;_0x1361e2[_0x114f3c][_0x1342d5(0x150)]=_0xfa5fc5;}),_0x2ea572[_0x295dfd(0x129)]((_0x2364da,_0x14775c)=>{_0x1361e2[_0x14775c]['quantity']=_0x2364da;}),_0x203a50[_0x295dfd(0x129)]((_0x5bdf20,_0x38ee59)=>{var _0x1d105f=_0x295dfd;_0x1361e2[_0x38ee59][_0x1d105f(0x12d)]=_0x5bdf20;}),_0x459706[_0x295dfd(0x129)]((_0x2af517,_0x1e61f4)=>{_0x1361e2[_0x1e61f4]['secondary_code']=_0x2af517;}),_0x253420['forEach']((_0x4e0287,_0x257c72)=>{var _0x49991a=_0x295dfd;_0x1361e2[_0x257c72][_0x49991a(0x127)]=_0x4e0287;}),_0x4552fa[_0x295dfd(0x129)]((_0x3a3325,_0x132dce)=>{_0x329c82['forEach']((_0x45f9c2,_0x578667)=>{var _0x581466=a0_0x2ca1;if(_0x45f9c2==_0x581466(0x103)&&_0x132dce==_0x578667){var _0x34bee0=_0x3a3325[_0x581466(0x1a8)](0x3);_0x1361e2[_0x132dce][_0x581466(0x1aa)]=_0x3a3325[0x0],_0x1361e2[_0x132dce][_0x581466(0xd9)]=_0x3a3325[0x1],_0x1361e2[_0x132dce][_0x581466(0x121)]=0x0,_0x1361e2[_0x132dce][_0x581466(0xe6)]=0x0,_0x1361e2[_0x132dce][_0x581466(0x184)]=_0x581466(0x197),_0x1361e2[_0x132dce][_0x581466(0xf3)]=_0x34bee0;}else{if(_0x45f9c2=='Shelves'&&_0x132dce==_0x578667){var _0x34bee0=_0x3a3325[_0x581466(0x1a8)](0x3);_0x1361e2[_0x132dce]['storage']=_0x3a3325[0x0],_0x1361e2[_0x132dce][_0x581466(0xd9)]=_0x3a3325[0x1],_0x1361e2[_0x132dce][_0x581466(0x121)]=0x0,_0x1361e2[_0x132dce][_0x581466(0xe6)]=0x0,_0x1361e2[_0x132dce][_0x581466(0x184)]=_0x581466(0x197),_0x1361e2[_0x132dce][_0x581466(0xf3)]=_0x3a3325[0x5];}else{if(_0x132dce==_0x578667){var _0x3da860;if(_0x3a3325[0x4]=='L')_0x3da860=_0x581466(0x1a0);else _0x3a3325[0x4]=='F'&&(_0x3da860=_0x581466(0x197));_0x1361e2[_0x132dce][_0x581466(0x1aa)]=_0x3a3325[0x0],_0x1361e2[_0x132dce]['rack']=_0x3a3325[0x1],_0x1361e2[_0x132dce][_0x581466(0x121)]=_0x3a3325[0x2],_0x1361e2[_0x132dce]['bin']=_0x3a3325[0x3],_0x1361e2[_0x132dce][_0x581466(0x184)]=_0x3da860,_0x1361e2[_0x132dce][_0x581466(0xf3)]=_0x3a3325[0x5];}}}});}),_0xd66263[_0x295dfd(0x129)]((_0x47e96e,_0x455bad)=>{_0x1361e2[_0x455bad]['unit']=_0x47e96e;}),_0x45b1b0[_0x295dfd(0x129)]((_0x127db2,_0x4a9d72)=>{var _0x110747=_0x295dfd;_0x1361e2[_0x4a9d72][_0x110747(0xf4)]=_0x127db2;}),_0x4b88f4[_0x295dfd(0x129)]((_0x4c7e18,_0x2419b1)=>{_0x1361e2[_0x2419b1]['batch_code']=_0x4c7e18;}),_0x11ec00['forEach']((_0x1f76da,_0x39ebc8)=>{var _0x7edd3b=_0x295dfd;_0x1361e2[_0x39ebc8][_0x7edd3b(0x1dc)]=_0x1f76da;}),_0x264935[_0x295dfd(0x129)]((_0x434150,_0xc22d9a)=>{var _0x4f081f=_0x295dfd;_0x1361e2[_0xc22d9a][_0x4f081f(0x133)]=_0x434150;}),_0x3008f0[_0x295dfd(0x129)]((_0x57ab12,_0x41bec2)=>{_0x1361e2[_0x41bec2]['production_date']=_0x57ab12;}),_0x2cd9d1[_0x295dfd(0x129)]((_0x4c6c56,_0x2cb70d)=>{var _0x33eeee=_0x295dfd;_0x1361e2[_0x2cb70d][_0x33eeee(0x17d)]=_0x4c6c56;}),_0xfaebbe[_0x295dfd(0x129)]((_0x3aee30,_0x15d7e3)=>{var _0x14b4a9=_0x295dfd;_0x1361e2[_0x15d7e3][_0x14b4a9(0x1b9)]=_0x3aee30;}),_0x258bd1[_0x295dfd(0x129)]((_0x14a43f,_0x4fdac0)=>{var _0x3174ba=_0x295dfd;_0x1361e2[_0x4fdac0][_0x3174ba(0x18a)]=_0x14a43f;}),_0x44e915[_0x295dfd(0x129)]((_0x4a7865,_0x2f1778)=>{var _0x1cfc94=_0x295dfd;_0x1361e2[_0x2f1778][_0x1cfc94(0x186)]=_0x4a7865;}),_0x126dea[_0x295dfd(0x129)]((_0x37b497,_0x2ab3eb)=>{var _0x5df754=_0x295dfd;_0x1361e2[_0x2ab3eb][_0x5df754(0x143)]=_0x37b497;}),_0x329c82[_0x295dfd(0x129)]((_0x5aa199,_0x1b5e80)=>{_0x1361e2[_0x1b5e80]['room_name']=_0x5aa199;}),_0x5a7a71[_0x295dfd(0x129)]((_0x56d8b8,_0x22c9b5)=>{var _0x50ef18=_0x295dfd;_0x1361e2[_0x22c9b5][_0x50ef18(0x136)]=_0x56d8b8;});var _0x275b03=0x0;_0x1361e2[_0x295dfd(0x129)](_0x3b3f5f=>{var _0x51fdec=_0x295dfd;(_0x3b3f5f['stock']<_0x3b3f5f[_0x51fdec(0x143)]||_0x3b3f5f[_0x51fdec(0x143)]==0x0)&&(console[_0x51fdec(0x19e)](_0x51fdec(0x189),_0x3b3f5f),_0x275b03++);});const _0x24aa0a=_0x1361e2['filter'](_0x5d3208=>_0x5d3208[_0x295dfd(0x1c1)]!=='0'&&_0x5d3208[_0x295dfd(0x1c1)]!==''),_0x4ee2c6=new sales({'invoice':_0x4f8464,'customer':_0x521cab['body'][_0x295dfd(0x17c)],'date':_0x1d1297,'warehouse_name':_0x441b9c,'sale_product':_0x24aa0a,'note':_0x40533a,'room':_0x273510,'primary_code':_0x1f7525,'secondary_code':_0x44a371,'prod_code':_0x27eeff,'SCRN':_0x125d07}),_0x2ddc20=await _0x4ee2c6['save']();_0x521cab[_0x295dfd(0x1c7)](_0x295dfd(0x123),_0x295dfd(0x118)),_0xda36b2[_0x295dfd(0x1c5)](_0x295dfd(0x15a)+_0x2ddc20[_0x295dfd(0x1d4)]);}catch(_0xe10967){console['log'](_0xe10967);}}),router[a0_0x5363ac(0x1b1)](a0_0x5363ac(0x1d8),auth,async(_0x8f8859,_0x46e21b)=>{var _0x46943a=a0_0x5363ac;try{const {username:_0x4be854,email:_0x1950b5,role:_0x591847}=_0x8f8859['user'],_0x18e391=_0x8f8859[_0x46943a(0x1b0)],_0x55253f=await profile[_0x46943a(0xeb)]({'email':_0x18e391[_0x46943a(0x164)]}),_0x174e9a=await master_shop['find'](),_0xb96ade=_0x8f8859['params']['id'],_0x32432f=await sales[_0x46943a(0x181)](_0xb96ade),_0x41f14d=await warehouse['aggregate']([{'$match':{'name':_0x32432f[_0x46943a(0x1cd)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x46943a(0x14b),'name':{'$first':_0x46943a(0x19c)},'product_stock':{'$first':_0x46943a(0x147)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x46943a(0x10f)},'type':{'$first':_0x46943a(0xd5)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x46943a(0xfb)},'storage':{'$first':_0x46943a(0x1b3)},'rack':{'$first':_0x46943a(0x1d0)},'expiry_date':{'$first':_0x46943a(0xcd)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2643c9=await customer[_0x46943a(0x1c2)]({});let _0x40cf66;if(_0x18e391['role']==_0x46943a(0x158)){const _0x2f966d=await staff[_0x46943a(0xeb)]({'email':_0x18e391[_0x46943a(0x164)]});_0x40cf66=await warehouse[_0x46943a(0x18c)]([{'$match':{'status':_0x46943a(0x112),'name':_0x2f966d[_0x46943a(0xd8)]}},{'$group':{'_id':_0x46943a(0x18d),'name':{'$first':_0x46943a(0x18d)}}}]);}else _0x40cf66=await warehouse[_0x46943a(0x18c)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x46943a(0x18d),'name':{'$first':_0x46943a(0x18d)}}}]);const _0x25148c=await product[_0x46943a(0x1c2)]({}),_0x360ff6=await suppliers['find']({});if(_0x174e9a[0x0][_0x46943a(0x187)]=='English\x20(US)'){var _0x44c715=users[_0x46943a(0x110)];console['log'](_0x44c715);}else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0x1b2))var _0x44c715=users[_0x46943a(0x1b2)];else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0x18f))var _0x44c715=users[_0x46943a(0x18f)];else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0x1ce))var _0x44c715=users[_0x46943a(0x1ce)];else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0xf9))var _0x44c715=users[_0x46943a(0xf9)];else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0x183))var _0x44c715=users[_0x46943a(0x1cc)];else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0xf6))var _0x44c715=users[_0x46943a(0xf6)];else{if(_0x174e9a[0x0][_0x46943a(0x187)]==_0x46943a(0x168))var _0x44c715=users[_0x46943a(0x149)];}}}}}}}_0x46e21b[_0x46943a(0x130)](_0x46943a(0x191),{'success':_0x8f8859[_0x46943a(0x1c7)]('success'),'errors':_0x8f8859[_0x46943a(0x1c7)](_0x46943a(0x12b)),'role':_0x18e391,'profile':_0x55253f,'customer':_0x2643c9,'warehouse':_0x40cf66,'product':_0x41f14d,'user':_0x32432f,'master_shop':_0x174e9a,'unit':_0x25148c,'language':_0x44c715,'suppliers':_0x360ff6});}catch(_0x1f65cb){console[_0x46943a(0x19e)](_0x1f65cb);}}),router['post'](a0_0x5363ac(0x1d8),auth,async(_0x53eb59,_0x158393)=>{var _0x34a3b7=a0_0x5363ac;try{const _0x103c70=_0x53eb59[_0x34a3b7(0x1b7)]['id'],{invoice:_0x24e524,warehouse_name:_0x328799,room:_0x2b0193}=_0x53eb59[_0x34a3b7(0x1c3)],_0x4f43d1=await sales[_0x34a3b7(0xeb)]({'invoice':_0x24e524}),_0xc87460=_0x4f43d1[_0x34a3b7(0xe7)][_0x34a3b7(0xfc)](async _0x127a64=>{var _0xd535c6=_0x34a3b7,_0x576ed5=await warehouse[_0xd535c6(0xeb)]({'name':_0x328799,'room':_0x127a64[_0xd535c6(0x1a1)],'warehouse_category':'Raw\x20Materials'});const _0x5e5422=_0x576ed5['product_details'][_0xd535c6(0xfc)](_0x13bb14=>{var _0x22e5ff=_0xd535c6;_0x13bb14['product_name']==_0x127a64[_0x22e5ff(0x193)]&&_0x13bb14[_0x22e5ff(0xf3)]==_0x127a64[_0x22e5ff(0xf3)]&&_0x13bb14[_0x22e5ff(0x184)]==_0x127a64['type']&&_0x13bb14['bin']==_0x127a64[_0x22e5ff(0xe6)]&&_0x13bb14['bay']==_0x127a64[_0x22e5ff(0x121)]&&_0x13bb14[_0x22e5ff(0xd9)]==_0x127a64[_0x22e5ff(0xd9)]&&_0x13bb14[_0x22e5ff(0x1aa)]==_0x127a64[_0x22e5ff(0x1aa)]&&_0x13bb14[_0x22e5ff(0x1dc)]==_0x127a64[_0x22e5ff(0x1dc)]&&_0x13bb14[_0x22e5ff(0x13e)]==_0x127a64['batch_code']&&_0x13bb14[_0x22e5ff(0x136)]==_0x127a64['invoice']&&_0x13bb14['_id']==_0x127a64['id_transaction_from']&&(_0x13bb14[_0x22e5ff(0x1ca)]=Math['max'](0x0,Math['abs'](_0x13bb14[_0x22e5ff(0x1ca)])-Math[_0x22e5ff(0x19d)](_0x127a64[_0x22e5ff(0x1c1)])));});return _0x576ed5;});Promise[_0x34a3b7(0x1bc)](_0xc87460)[_0x34a3b7(0x1a9)](async _0x16df68=>{var _0x222f48=_0x34a3b7;try{for(const _0x228606 of _0x16df68){await _0x228606[_0x222f48(0xff)]();}_0x4f43d1[_0x222f48(0x1c6)]='True';const _0x8951da=await _0x4f43d1[_0x222f48(0xff)](),_0x4b2828=await master_shop[_0x222f48(0x1c2)](),_0x4fceb2=await email_settings['findOne'](),_0x22b2a5=await supervisor_settings[_0x222f48(0x1c2)]();var _0x42620f=_0x4f43d1[_0x222f48(0xe7)],_0x1fe886='',_0x39a417;for(_0x39a417 in _0x42620f){_0x1fe886+=_0x222f48(0x12e)+_0x222f48(0x141)+_0x42620f[_0x39a417][_0x222f48(0x193)]+_0x222f48(0xe1)+_0x222f48(0x141)+_0x42620f[_0x39a417][_0x222f48(0x127)]+_0x222f48(0xe1)+_0x222f48(0x141)+_0x42620f[_0x39a417][_0x222f48(0x1c1)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x42620f[_0x39a417]['unit']+_0x222f48(0xe1)+_0x222f48(0x141)+_0x42620f[_0x39a417][_0x222f48(0xf4)]+'</td>'+_0x222f48(0x141)+_0x4f43d1[_0x222f48(0x1cd)]+_0x222f48(0xe1)+_0x222f48(0x141)+_0x42620f[_0x39a417][_0x222f48(0x1a1)]+_0x222f48(0xe1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x42620f[_0x39a417][_0x222f48(0x1aa)]+_0x42620f[_0x39a417]['rack']+_0x42620f[_0x39a417]['bay']+_0x42620f[_0x39a417]['bin']+_0x42620f[_0x39a417]['type'][0x0]+_0x42620f[_0x39a417][_0x222f48(0xf3)]+_0x222f48(0xe1),'</tr>';}let _0x45b74a=nodemailer[_0x222f48(0x1a6)]({'host':_0x4fceb2[_0x222f48(0x163)],'port':Number(_0x4fceb2[_0x222f48(0x114)]),'secure':![],'auth':{'user':_0x4fceb2[_0x222f48(0x164)],'pass':_0x4fceb2[_0x222f48(0x196)]}}),_0x28b789={'from':_0x4fceb2[_0x222f48(0x164)],'to':_0x22b2a5[0x0]['RMSEmail'],'subject':_0x222f48(0x167),'attachments':[{'filename':_0x222f48(0xe0),'path':__dirname+'/../public'+'/upload/'+_0x4b2828[0x0]['image'],'cid':_0x222f48(0x1a2)}],'html':_0x222f48(0xfa)+'<html><head><title></title>'+'</head><body>'+_0x222f48(0x192)+_0x222f48(0x10e)+_0x222f48(0x192)+_0x222f48(0x14f)+_0x222f48(0x122)+_0x222f48(0x192)+_0x222f48(0x170)+_0x4b2828[0x0]['site_title']+_0x222f48(0x109)+_0x222f48(0x122)+_0x222f48(0x122)+_0x222f48(0x15c)+'<div>'+_0x222f48(0xcf)+_0x222f48(0xea)+_0x4f43d1['invoice']+'\x20'+_0x222f48(0x132)+_0x222f48(0xd1)+_0x4f43d1['date']+'\x20'+'</span>'+_0x222f48(0x155)+_0x222f48(0x122)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x222f48(0x17f)+_0x222f48(0x12e)+_0x222f48(0x1bd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x222f48(0x166)+_0x222f48(0x1c9)+_0x222f48(0x10b)+_0x222f48(0x165)+_0x222f48(0x105)+_0x222f48(0xde)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1fe886+'\x20'+_0x222f48(0x157)+_0x222f48(0x13d)+_0x222f48(0x192)+_0x222f48(0x1a7)+'<h5>'+_0x4b2828[0x0][_0x222f48(0x16c)]+'</h5>'+_0x222f48(0x122)+_0x222f48(0x122)+_0x222f48(0x124)};_0x45b74a[_0x222f48(0x11b)](_0x28b789,function(_0x2e555a,_0x16e6dc){var _0x504a4d=_0x222f48;_0x2e555a?(console['log'](_0x2e555a),console[_0x504a4d(0x19e)]('Error\x20Occurs')):console[_0x504a4d(0x19e)](_0x504a4d(0x162));}),_0x53eb59[_0x222f48(0x1c7)](_0x222f48(0x123),_0x222f48(0x1db)),_0x158393[_0x222f48(0x1c5)](_0x222f48(0x15a)+_0x103c70);}catch(_0x5a7e2b){console[_0x222f48(0x1b6)](_0x5a7e2b),_0x158393[_0x222f48(0x1d7)](0x1f4)[_0x222f48(0xee)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x34a3b7(0xfd)](_0x2be323=>{var _0x1203f7=_0x34a3b7;console[_0x1203f7(0x1b6)](_0x2be323),_0x158393[_0x1203f7(0x1d7)](0x1f4)[_0x1203f7(0xee)]({'error':'An\x20error\x20occurred.'});});}catch(_0x4af426){console[_0x34a3b7(0x19e)](_0x4af426);}}),router[a0_0x5363ac(0x1b1)](a0_0x5363ac(0xd3),auth,async(_0x547758,_0x38f840)=>{var _0x46c0d4=a0_0x5363ac;try{const {username:_0x19cb95,email:_0x223ddf,role:_0x589488}=_0x547758[_0x46c0d4(0x1b0)],_0x24f4c6=_0x547758[_0x46c0d4(0x1b0)],_0xb7d7ce=await profile[_0x46c0d4(0xeb)]({'email':_0x24f4c6[_0x46c0d4(0x164)]}),_0x32056e=await master_shop['find'](),_0x26e859=_0x547758[_0x46c0d4(0x1b7)]['id'],_0x2af4e4=await sales[_0x46c0d4(0x181)](_0x26e859);var _0x15bc9e=[_0x46c0d4(0x108),_0x46c0d4(0x1a4)];const _0x4fcea0=await warehouse['aggregate']([{'$match':{'name':_0x2af4e4[_0x46c0d4(0x1cd)],'warehouse_category':_0x46c0d4(0x15f)}},{'$unwind':_0x46c0d4(0x1af)},{'$group':{'_id':_0x46c0d4(0x14b),'name':{'$first':_0x46c0d4(0x19c)},'product_stock':{'$first':_0x46c0d4(0x147)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x46c0d4(0x10f)},'type':{'$first':_0x46c0d4(0xd5)},'floorlevel':{'$first':_0x46c0d4(0x1d1)},'primary_code':{'$first':_0x46c0d4(0x1ac)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x46c0d4(0xfb)},'storage':{'$first':_0x46c0d4(0x1b3)},'rack':{'$first':_0x46c0d4(0x1d0)}}}]),_0x228b65=await customer[_0x46c0d4(0x1c2)]({});let _0x3edb9a;if(_0x24f4c6[_0x46c0d4(0x13a)]==_0x46c0d4(0x158)){const _0x191f2a=await staff[_0x46c0d4(0xeb)]({'email':_0x24f4c6[_0x46c0d4(0x164)]});_0x3edb9a=await warehouse[_0x46c0d4(0x18c)]([{'$match':{'status':'Enabled','name':_0x191f2a[_0x46c0d4(0xd8)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x46c0d4(0x18d)}}}]);}else _0x3edb9a=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x46c0d4(0x15f)}},{'$group':{'_id':_0x46c0d4(0x18d),'name':{'$first':_0x46c0d4(0x18d)}}}]);const _0x19da8e=await product[_0x46c0d4(0x1c2)]({});if(_0x32056e[0x0]['language']==_0x46c0d4(0x19a)){var _0x2bb8cb=users['English'];console[_0x46c0d4(0x19e)](_0x2bb8cb);}else{if(_0x32056e[0x0][_0x46c0d4(0x187)]==_0x46c0d4(0x1b2))var _0x2bb8cb=users[_0x46c0d4(0x1b2)];else{if(_0x32056e[0x0][_0x46c0d4(0x187)]==_0x46c0d4(0x18f))var _0x2bb8cb=users[_0x46c0d4(0x18f)];else{if(_0x32056e[0x0]['language']==_0x46c0d4(0x1ce))var _0x2bb8cb=users[_0x46c0d4(0x1ce)];else{if(_0x32056e[0x0]['language']=='French')var _0x2bb8cb=users['French'];else{if(_0x32056e[0x0][_0x46c0d4(0x187)]==_0x46c0d4(0x183))var _0x2bb8cb=users[_0x46c0d4(0x1cc)];else{if(_0x32056e[0x0][_0x46c0d4(0x187)]==_0x46c0d4(0xf6))var _0x2bb8cb=users[_0x46c0d4(0xf6)];else{if(_0x32056e[0x0][_0x46c0d4(0x187)]==_0x46c0d4(0x168))var _0x2bb8cb=users[_0x46c0d4(0x149)];}}}}}}}_0x38f840[_0x46c0d4(0x130)]('edit_sales',{'success':_0x547758[_0x46c0d4(0x1c7)]('success'),'errors':_0x547758[_0x46c0d4(0x1c7)]('errors'),'role':_0x24f4c6,'profile':_0xb7d7ce,'customer':_0x228b65,'warehouse':_0x3edb9a,'product':_0x4fcea0,'user':_0x2af4e4,'master_shop':_0x32056e,'unit':_0x19da8e,'language':_0x2bb8cb});}catch(_0x22a768){console[_0x46c0d4(0x19e)](_0x22a768);}}),router['post'](a0_0x5363ac(0xd3),auth,async(_0x18036e,_0x29b073)=>{var _0x436697=a0_0x5363ac;try{const _0x16220f=_0x18036e[_0x436697(0x1b7)]['id'],_0xa89d3c=await sales[_0x436697(0xeb)]({'_id':_0x18036e[_0x436697(0x1b7)]['id']}),_0x5d88d7=await warehouse[_0x436697(0xeb)]({'name':_0xa89d3c[_0x436697(0x1cd)],'room':_0x18036e['body'][_0x436697(0xe4)]}),{invoice:_0x3b0d96,date:_0x3da6ff,warehouse_name:_0x3dfdb0,product_name:_0x5a5b02,stock:_0x2964c4,quantity:_0x228a5e,note:_0x55917d,room:_0x9ceb8f,customer:_0xf414b7,SCRN:_0x3f25ac}=_0x18036e[_0x436697(0x1c3)];if(typeof _0x5a5b02=='string')var _0x62820d=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x193)]],_0x202737=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x1ba)]],_0x59bdb6=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x126)]],_0x4b2a40=[_0x18036e['body'][_0x436697(0x12d)]],_0x218bf8=[_0x18036e['body'][_0x436697(0x11c)]],_0x368082=[_0x18036e['body'][_0x436697(0x125)]],_0x4c0bc7=[_0x18036e[_0x436697(0x1c3)]['level']],_0x5646f0=[_0x18036e[_0x436697(0x1c3)][_0x436697(0xdd)]],_0x56566b=[_0x18036e[_0x436697(0x1c3)]['secondary_unit']],_0x2dd5ee=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x13e)]],_0x2c564c=[_0x18036e['body'][_0x436697(0x1dc)]],_0x1a9e78=[_0x18036e['body'][_0x436697(0x135)]],_0x5af930=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x160)]],_0x16d923=[_0x18036e['body']['requested_qty']],_0x25177d=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x1b9)]],_0x23e621=[_0x18036e[_0x436697(0x1c3)][_0x436697(0x18a)]],_0x5abccb=[_0x18036e['body'][_0x436697(0x186)]],_0x2f4a28=[_0x18036e['body'][_0x436697(0x1c1)]],_0x29dd70=[_0x18036e['body'][_0x436697(0x156)]];else var _0x62820d=[..._0x18036e['body'][_0x436697(0x193)]],_0x202737=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x1ba)]],_0x59bdb6=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x126)]],_0x4b2a40=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x12d)]],_0x218bf8=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x11c)]],_0x368082=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x125)]],_0x4c0bc7=[..._0x18036e[_0x436697(0x1c3)]['level']],_0x5646f0=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0xdd)]],_0x56566b=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0xf4)]],_0x2dd5ee=[..._0x18036e[_0x436697(0x1c3)]['batch_code']],_0x2c564c=[..._0x18036e[_0x436697(0x1c3)]['expiry_date']],_0x1a9e78=[..._0x18036e[_0x436697(0x1c3)]['max_per_unit']],_0x5af930=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x160)]],_0x16d923=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x17d)]],_0x25177d=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x1b9)]],_0x23e621=[..._0x18036e[_0x436697(0x1c3)][_0x436697(0x18a)]],_0x5abccb=[..._0x18036e[_0x436697(0x1c3)]['prod_cat']],_0x2f4a28=[..._0x18036e['body'][_0x436697(0x1c1)]],_0x29dd70=[..._0x18036e[_0x436697(0x1c3)]['RoomAssigned']];const _0xcbd51=_0x62820d[_0x436697(0xfc)](_0x3c6250=>{return _0x3c6250={'product_name':_0x3c6250};});_0x202737['forEach']((_0x463cba,_0x341780)=>{var _0x3d27be=_0x436697;_0xcbd51[_0x341780]['stock']=Math[_0x3d27be(0x19d)](_0x463cba);}),_0x59bdb6[_0x436697(0x129)]((_0x1594ee,_0x1435df)=>{var _0x2cb26c=_0x436697;_0xcbd51[_0x1435df][_0x2cb26c(0x1c1)]=_0x1594ee;}),_0x4b2a40[_0x436697(0x129)]((_0x465138,_0x59a247)=>{var _0x1cc585=_0x436697;_0xcbd51[_0x59a247][_0x1cc585(0x12d)]=_0x465138;}),_0x218bf8[_0x436697(0x129)]((_0x2c95f8,_0x51d6f2)=>{var _0x7bbeb6=_0x436697;_0xcbd51[_0x51d6f2][_0x7bbeb6(0x11c)]=_0x2c95f8;}),_0x368082[_0x436697(0x129)]((_0x1eefda,_0x16d41f)=>{_0xcbd51[_0x16d41f]['product_code']=_0x1eefda;}),_0x4c0bc7[_0x436697(0x129)]((_0x15cbfc,_0x66a9b8)=>{var _0x4b222a=_0x436697;_0x29dd70[_0x4b222a(0x129)]((_0x4d21cb,_0xa80861)=>{var _0x3660a1=_0x4b222a;if(_0x4d21cb==_0x3660a1(0x103)&&_0x66a9b8==_0xa80861){var _0xa9de4d=_0x15cbfc[_0x3660a1(0x1a8)](0x3);_0xcbd51[_0x66a9b8][_0x3660a1(0x1aa)]=_0x15cbfc[0x0],_0xcbd51[_0x66a9b8][_0x3660a1(0xd9)]=_0x15cbfc[0x1],_0xcbd51[_0x66a9b8][_0x3660a1(0x121)]=0x0,_0xcbd51[_0x66a9b8][_0x3660a1(0xe6)]=0x0,_0xcbd51[_0x66a9b8][_0x3660a1(0x184)]='Floor',_0xcbd51[_0x66a9b8]['floorlevel']=_0xa9de4d;}else{if(_0x4d21cb==_0x3660a1(0x1c4)&&_0x66a9b8==_0xa80861){var _0xa9de4d=_0x15cbfc[_0x3660a1(0x1a8)](0x3);_0xcbd51[_0x66a9b8][_0x3660a1(0x1aa)]=_0x15cbfc[0x0],_0xcbd51[_0x66a9b8]['rack']=_0x15cbfc[0x1],_0xcbd51[_0x66a9b8][_0x3660a1(0x121)]=0x0,_0xcbd51[_0x66a9b8][_0x3660a1(0xe6)]=0x0,_0xcbd51[_0x66a9b8][_0x3660a1(0x184)]='Floor',_0xcbd51[_0x66a9b8]['floorlevel']=_0x15cbfc[0x5];}else{if(_0x66a9b8==_0xa80861){var _0x211e2e;if(_0x15cbfc[0x4]=='L')_0x211e2e=_0x3660a1(0x1a0);else _0x15cbfc[0x4]=='F'&&(_0x211e2e=_0x3660a1(0x197));_0xcbd51[_0x66a9b8][_0x3660a1(0x1aa)]=_0x15cbfc[0x0],_0xcbd51[_0x66a9b8][_0x3660a1(0xd9)]=_0x15cbfc[0x1],_0xcbd51[_0x66a9b8]['bay']=_0x15cbfc[0x2],_0xcbd51[_0x66a9b8]['bin']=_0x15cbfc[0x3],_0xcbd51[_0x66a9b8][_0x3660a1(0x184)]=_0x211e2e,_0xcbd51[_0x66a9b8][_0x3660a1(0xf3)]=_0x15cbfc[0x5];}}}});}),_0x5646f0[_0x436697(0x129)]((_0x14ad66,_0x28f7c6)=>{var _0x421c2a=_0x436697;_0xcbd51[_0x28f7c6][_0x421c2a(0x18e)]=_0x14ad66;}),_0x56566b[_0x436697(0x129)]((_0x387864,_0x382bc8)=>{var _0x2c2895=_0x436697;_0xcbd51[_0x382bc8][_0x2c2895(0xf4)]=_0x387864;}),_0x2dd5ee['forEach']((_0x237b7f,_0xb42654)=>{var _0x26ed45=_0x436697;_0xcbd51[_0xb42654][_0x26ed45(0x13e)]=_0x237b7f;}),_0x2c564c[_0x436697(0x129)]((_0x298085,_0x16e2c3)=>{_0xcbd51[_0x16e2c3]['expiry_date']=_0x298085;}),_0x1a9e78[_0x436697(0x129)]((_0x2ccddf,_0x4ce708)=>{_0xcbd51[_0x4ce708]['maxperunit']=_0x2ccddf;}),_0x5af930[_0x436697(0x129)]((_0x52544c,_0x45a787)=>{_0xcbd51[_0x45a787]['production_date']=_0x52544c;}),_0x16d923[_0x436697(0x129)]((_0x473e53,_0x1effab)=>{var _0x242806=_0x436697;_0xcbd51[_0x1effab][_0x242806(0x17d)]=Math[_0x242806(0x19d)](_0x473e53);}),_0x25177d[_0x436697(0x129)]((_0x3f37cd,_0x5402ab)=>{_0xcbd51[_0x5402ab]['delivery_date']=_0x3f37cd;}),_0x23e621[_0x436697(0x129)]((_0x1eba80,_0xf2eeb5)=>{var _0x1e71be=_0x436697;_0xcbd51[_0xf2eeb5][_0x1e71be(0x18a)]=_0x1eba80;}),_0x5abccb[_0x436697(0x129)]((_0x289ccb,_0x385b6d)=>{var _0xc4744c=_0x436697;_0xcbd51[_0x385b6d][_0xc4744c(0x186)]=_0x289ccb;}),_0x2f4a28[_0x436697(0x129)]((_0x121506,_0x4db4c0)=>{_0xcbd51[_0x4db4c0]['quantity_notConverted']=_0x121506;}),_0x29dd70['forEach']((_0x1ca50c,_0x5dc3bc)=>{_0xcbd51[_0x5dc3bc]['room_name']=_0x1ca50c;});var _0x4adbb6=0x0;_0xcbd51[_0x436697(0x129)](_0x55c991=>{var _0x41ca41=_0x436697;console[_0x41ca41(0x19e)](_0x41ca41(0x189),_0x55c991),(parseInt(_0x55c991[_0x41ca41(0x1ba)])<parseInt(_0x55c991[_0x41ca41(0x1c1)])||parseInt(_0x55c991[_0x41ca41(0x1c1)])==0x0)&&_0x4adbb6++;});if(_0x4adbb6!=0x0)return _0x18036e[_0x436697(0x1c7)](_0x436697(0x12b),_0x436697(0xd2)),_0x29b073['redirect'](_0x436697(0x138));const _0x147f00=_0xcbd51[_0x436697(0xce)](_0x28cd6f=>_0x28cd6f[_0x436697(0x1c1)]!=='0'&&_0x28cd6f['quantity']!=='');_0xa89d3c[_0x436697(0x136)]=_0x3b0d96,_0xa89d3c[_0x436697(0x17c)]=_0xf414b7,_0xa89d3c['date']=_0x3da6ff,_0xa89d3c[_0x436697(0x1cd)]=_0x3dfdb0,_0xa89d3c[_0x436697(0xe7)]=_0x147f00,_0xa89d3c[_0x436697(0x117)]=_0x55917d,_0xa89d3c[_0x436697(0x175)]=_0x3f25ac,_0xa89d3c[_0x436697(0x1c6)]=_0x436697(0x1b8),_0xa89d3c[_0x436697(0x188)]=_0x436697(0x1b8);const _0x4ca7d4=await _0xa89d3c[_0x436697(0xff)]();_0x18036e[_0x436697(0x1c7)](_0x436697(0x123),_0x436697(0x1db)),_0x29b073['redirect'](_0x436697(0x1b4));}catch(_0xe78875){console[_0x436697(0x19e)](_0xe78875);}}),router['post'](a0_0x5363ac(0xef),auth,async(_0x235740,_0x1bf5c1)=>{var _0x3ce714=a0_0x5363ac;try{const _0x5c562e=_0x235740[_0x3ce714(0x1b7)]['id'],{invoice:_0x817ba0,customer:_0x53f225,receivable_amount:_0x5f4e77,received_amount:_0x55a554}=_0x235740[_0x3ce714(0x1c3)],_0x182005=await sales[_0x3ce714(0x181)](_0x5c562e);console['log'](_0x182005);var _0x2bf329=_0x5f4e77-_0x55a554;console['log'](_0x55a554),_0x182005['received_amount']=parseFloat(_0x55a554)+parseFloat(_0x182005['received_amount']),_0x182005['due_amount']=_0x2bf329,console[_0x3ce714(0x19e)](_0x182005);const _0x1b7952=await _0x182005[_0x3ce714(0xff)](),_0x309c36=await c_payment_data[_0x3ce714(0xeb)]({'invoice':_0x817ba0});_0x309c36['amount']=_0x2bf329,await _0x309c36[_0x3ce714(0xff)]();let _0x9d8a72=new Date(),_0x3393e5=('0'+_0x9d8a72[_0x3ce714(0x185)]())[_0x3ce714(0x1a8)](-0x2),_0x29ab5f=('0'+(_0x9d8a72[_0x3ce714(0xe2)]()+0x1))['slice'](-0x2),_0x52b115=_0x9d8a72[_0x3ce714(0x159)](),_0x185c1b=_0x52b115+'-'+_0x29ab5f+'-'+_0x3393e5;const _0x261d57=new customer_payment({'invoice':_0x817ba0,'date':_0x52b115+'-'+_0x29ab5f+'-'+_0x3393e5,'customer':_0x53f225,'reason':_0x3ce714(0x13f),'amount':_0x55a554}),_0x5e1279=await _0x261d57['save']();_0x235740[_0x3ce714(0x1c7)](_0x3ce714(0x123),_0x3ce714(0x111)),_0x1bf5c1['redirect'](_0x3ce714(0x1b4));}catch(_0x2ab530){console[_0x3ce714(0x19e)](_0x2ab530);}}),router['get'](a0_0x5363ac(0x137),auth,async(_0x23d186,_0x94193c)=>{var _0x721f70=a0_0x5363ac;try{const {username:_0x1a00b2,email:_0x265123,role:_0x25a6da}=_0x23d186[_0x721f70(0x1b0)],_0x1e622c=_0x23d186[_0x721f70(0x1b0)],_0x25c416=await profile['findOne']({'email':_0x1e622c['email']}),_0xf333c2=await master_shop[_0x721f70(0x1c2)]();console[_0x721f70(0x19e)](_0x721f70(0x1a3),_0xf333c2);const _0x15db36=_0x23d186[_0x721f70(0x1b7)]['id'],_0x524ea7=await sales[_0x721f70(0x181)](_0x15db36);console[_0x721f70(0x19e)](_0x524ea7);const _0x2fd8a6=await customer['findOne']({'name':_0x524ea7['customer']});console[_0x721f70(0x19e)](_0x2fd8a6);if(_0xf333c2[0x0][_0x721f70(0x187)]=='English\x20(US)'){var _0x15d4ea=users['English'];console[_0x721f70(0x19e)](_0x15d4ea);}else{if(_0xf333c2[0x0][_0x721f70(0x187)]=='Hindi')var _0x15d4ea=users[_0x721f70(0x1b2)];else{if(_0xf333c2[0x0][_0x721f70(0x187)]=='German')var _0x15d4ea=users[_0x721f70(0x18f)];else{if(_0xf333c2[0x0][_0x721f70(0x187)]==_0x721f70(0x1ce))var _0x15d4ea=users[_0x721f70(0x1ce)];else{if(_0xf333c2[0x0][_0x721f70(0x187)]==_0x721f70(0xf9))var _0x15d4ea=users[_0x721f70(0xf9)];else{if(_0xf333c2[0x0][_0x721f70(0x187)]==_0x721f70(0x183))var _0x15d4ea=users['Portuguese'];else{if(_0xf333c2[0x0][_0x721f70(0x187)]==_0x721f70(0xf6))var _0x15d4ea=users['Chinese'];else{if(_0xf333c2[0x0][_0x721f70(0x187)]==_0x721f70(0x168))var _0x15d4ea=users[_0x721f70(0x149)];}}}}}}}_0x94193c['render'](_0x721f70(0x1a5),{'success':_0x23d186['flash'](_0x721f70(0x123)),'errors':_0x23d186[_0x721f70(0x1c7)]('errors'),'role':_0x1e622c,'profile':_0x25c416,'master_shop':_0xf333c2,'customers':_0x2fd8a6,'sales':_0x524ea7,'language':_0x15d4ea});}catch(_0x60c2f7){console[_0x721f70(0x19e)](_0x60c2f7);}}),router[a0_0x5363ac(0x1b1)](a0_0x5363ac(0x173),auth,async(_0x3b0f06,_0x264033)=>{var _0x341e9f=a0_0x5363ac;try{const {username:_0x2f944e,email:_0x53570f,role:_0x2c64f2}=_0x3b0f06[_0x341e9f(0x1b0)],_0x5e6911=_0x3b0f06[_0x341e9f(0x1b0)],_0x36d40d=await profile[_0x341e9f(0xeb)]({'email':_0x5e6911[_0x341e9f(0x164)]}),_0x5c2ca0=await master_shop[_0x341e9f(0x1c2)]();console[_0x341e9f(0x19e)](_0x341e9f(0x1a3),_0x5c2ca0);const _0x504547=_0x3b0f06[_0x341e9f(0x1b7)]['id'];console[_0x341e9f(0x19e)](_0x504547);const _0xcc202a=await sales[_0x341e9f(0x181)](_0x504547);console['log'](_0x341e9f(0x199),_0xcc202a);const _0xdeb9fa=await warehouse[_0x341e9f(0x18c)]([{'$match':{'name':_0x341e9f(0x14e),'room':'Return\x20Rooms'}},{'$unwind':_0x341e9f(0x1af)},{'$group':{'_id':_0x341e9f(0x14b),'name':{'$first':_0x341e9f(0x19c)},'product_stock':{'$first':_0x341e9f(0x147)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x341e9f(0xe3)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x341e9f(0xfe)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x341e9f(0x19e)](_0x341e9f(0x16d),_0xdeb9fa);const _0x3866b7=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x341e9f(0x112),'name':_0x341e9f(0x14e),'warehouse_category':_0x341e9f(0x15f)}},{'$group':{'_id':_0x341e9f(0x18d),'name':{'$first':_0x341e9f(0x18d)}}},{'$sort':{'name':0x1}}]);var _0x48c38c=[_0x341e9f(0x15d)];if(_0x5c2ca0[0x0][_0x341e9f(0x187)]==_0x341e9f(0x19a)){var _0x3522cc=users[_0x341e9f(0x110)];console[_0x341e9f(0x19e)](_0x3522cc);}else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]==_0x341e9f(0x1b2))var _0x3522cc=users['Hindi'];else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]==_0x341e9f(0x18f))var _0x3522cc=users[_0x341e9f(0x18f)];else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]==_0x341e9f(0x1ce))var _0x3522cc=users[_0x341e9f(0x1ce)];else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]=='French')var _0x3522cc=users[_0x341e9f(0xf9)];else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]=='Portuguese\x20(BR)')var _0x3522cc=users[_0x341e9f(0x1cc)];else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]==_0x341e9f(0xf6))var _0x3522cc=users['Chinese'];else{if(_0x5c2ca0[0x0][_0x341e9f(0x187)]==_0x341e9f(0x168))var _0x3522cc=users['Arabic'];}}}}}}}_0x264033[_0x341e9f(0x130)](_0x341e9f(0x177),{'success':_0x3b0f06[_0x341e9f(0x1c7)](_0x341e9f(0x123)),'errors':_0x3b0f06[_0x341e9f(0x1c7)]('errors'),'role':_0x5e6911,'profile':_0x36d40d,'user':_0xcc202a,'stock':_0xdeb9fa,'master_shop':_0x5c2ca0,'unit':_0x3866b7,'language':_0x3522cc,'warehouses':warehouse_data,'rooms':_0x48c38c});}catch(_0x36d272){console[_0x341e9f(0x19e)](_0x36d272),_0x264033[_0x341e9f(0x1d7)](0xc8)['json']({'message':_0x36d272[_0x341e9f(0xd6)]});}}),router[a0_0x5363ac(0xdc)]('/view/return_sales/:id',auth,async(_0x5bb3c9,_0x383b76)=>{var _0x211687=a0_0x5363ac;try{const {invoice:_0x20237b,date:_0x2e4f66,warehouse_name:_0x599cba,product_name:_0x5d88c3,primary_code:_0x569207,secondary_code:_0x35368f,product_code:_0x21e7cc,sales_quantity:_0x3cc688,stocks:_0x2f4432,return_qty:_0x11731c,Room_name:_0x59fe62,to_warehouse_name:_0x13bfdb,to_Roomname:_0x56247e,to_Room_name:_0x526ab0,note:_0x564285,level:_0x1010a9,isle:_0x5b6ae4,pallet:_0x410848}=_0x5bb3c9[_0x211687(0x1c3)];if(typeof _0x5d88c3=='string')var _0xf1e56f=[_0x5bb3c9['body'][_0x211687(0x193)]],_0x18c2ce=[_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x12d)]],_0xca5ee5=[_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x11c)]],_0x20ef15=[_0x5bb3c9[_0x211687(0x1c3)]['product_code']],_0x4b8047=[_0x5bb3c9[_0x211687(0x1c3)]['sales_quantity']],_0x45b8bf=[_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x18b)]],_0x3c7268=[_0x5bb3c9['body'][_0x211687(0x12f)]],_0x5b3ccd=[_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x121)]],_0x4da87b=[_0x5bb3c9[_0x211687(0x1c3)]['bin']],_0x29f108=[_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x190)]],_0x227d33=[_0x5bb3c9[_0x211687(0x1c3)]['floorlevel']];else var _0xf1e56f=[..._0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x193)]],_0x18c2ce=[..._0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x12d)]],_0xca5ee5=[..._0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x11c)]],_0x20ef15=[..._0x5bb3c9[_0x211687(0x1c3)]['product_code']],_0x4b8047=[..._0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x1d6)]],_0x45b8bf=[..._0x5bb3c9['body'][_0x211687(0x18b)]],_0x3c7268=[..._0x5bb3c9['body'][_0x211687(0x12f)]],_0x5b3ccd=[..._0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x121)]],_0x4da87b=[..._0x5bb3c9[_0x211687(0x1c3)][_0x211687(0xe6)]],_0x29f108=[..._0x5bb3c9['body'][_0x211687(0x190)]],_0x227d33=[..._0x5bb3c9['body'][_0x211687(0xf3)]];const _0x2f35ed=_0xf1e56f['map'](_0x394b5e=>{return _0x394b5e={'product_name':_0x394b5e};});_0x18c2ce[_0x211687(0x129)]((_0x378d6c,_0x5c1835)=>{_0x2f35ed[_0x5c1835]['primary_code']=_0x378d6c;}),_0xca5ee5[_0x211687(0x129)]((_0x503b22,_0x50289c)=>{_0x2f35ed[_0x50289c]['secondary_code']=_0x503b22;}),_0x20ef15['forEach']((_0x454991,_0x55367a)=>{_0x2f35ed[_0x55367a]['product_code']=_0x454991;}),_0x4b8047[_0x211687(0x129)]((_0x1439a4,_0x3e8154)=>{var _0x1b113d=_0x211687;_0x2f35ed[_0x3e8154][_0x1b113d(0xd7)]=_0x1439a4;}),_0x45b8bf[_0x211687(0x129)]((_0x505005,_0x2b5154)=>{_0x2f35ed[_0x2b5154]['stock']=_0x505005;}),_0x3c7268['forEach']((_0x3fb32b,_0x5bf525)=>{var _0x5827fd=_0x211687;_0x2f35ed[_0x5bf525][_0x5827fd(0x12f)]=_0x3fb32b;}),_0x5b3ccd['forEach']((_0x3d47d2,_0x2b049d)=>{var _0x10be60=_0x211687;_0x2f35ed[_0x2b049d][_0x10be60(0x121)]=_0x3d47d2;}),_0x4da87b[_0x211687(0x129)]((_0x354fd4,_0x28bb65)=>{_0x2f35ed[_0x28bb65]['bin']=_0x354fd4;}),_0x29f108[_0x211687(0x129)]((_0xdd326e,_0x43a811)=>{var _0x2bc7dd=_0x211687;_0x2f35ed[_0x43a811][_0x2bc7dd(0x184)]=_0xdd326e;}),_0x227d33[_0x211687(0x129)]((_0x253f2c,_0x45b4fa)=>{var _0x1b994a=_0x211687;_0x2f35ed[_0x45b4fa][_0x1b994a(0xf3)]=_0x253f2c;});var _0x4da603=0x0;_0x2f35ed[_0x211687(0x129)](_0x2ccc03=>{var _0x177241=_0x211687;console['log'](_0x177241(0x189),_0x2ccc03),(parseInt(_0x2ccc03[_0x177241(0xd7)])<parseInt(_0x2ccc03['return_qty'])||parseInt(_0x2ccc03['stock'])<parseInt(_0x2ccc03[_0x177241(0x12f)])&&parseInt(_0x2ccc03[_0x177241(0xd7)])>parseInt(_0x2ccc03[_0x177241(0x12f)])||parseInt(_0x2ccc03[_0x177241(0x12f)])==0x0)&&_0x4da603++;});if(_0x4da603!=0x0)return _0x5bb3c9['flash'](_0x211687(0x12b),_0x211687(0x19f)),_0x383b76['redirect'](_0x211687(0x138));const _0x3f50f1=await sales[_0x211687(0xeb)]({'invoice':_0x20237b});console[_0x211687(0x19e)](_0x3f50f1),_0x3f50f1['return_data']='True';const _0x500680=await _0x3f50f1[_0x211687(0xff)](),_0x55ccf3=new sales_return({'invoice':_0x20237b,'customer':_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x17c)],'date':_0x2e4f66,'warehouse_name':_0x599cba,'room':_0x59fe62,'ToWarehouse':_0x13bfdb,'ToRoom':_0x526ab0,'return_sale':_0x2f35ed,'note':_0x564285}),_0xb5a74b=await _0x55ccf3[_0x211687(0xff)]();console[_0x211687(0x19e)](_0x55ccf3);const _0x55edd2=await sales_return[_0x211687(0xeb)]({'invoice':_0x20237b}),_0xfa0ad3=await warehouse[_0x211687(0xeb)]({'name':_0x13bfdb,'room':_0x526ab0});_0x55edd2['return_sale'][_0x211687(0x129)](_0x1e0946=>{var _0x3d7017=_0x211687,_0x164de1=0x0;const _0x529806=_0xfa0ad3[_0x3d7017(0x17e)][_0x3d7017(0xfc)](_0x336934=>{var _0x53c3c8=_0x3d7017;_0x336934['product_name']==_0x1e0946[_0x53c3c8(0x193)]&&_0x336934['floorlevel']==_0x1e0946[_0x53c3c8(0xf3)]&&_0x336934[_0x53c3c8(0x184)]==_0x1e0946['type']&&_0x336934[_0x53c3c8(0xe6)]==_0x1e0946[_0x53c3c8(0xe6)]&&_0x336934[_0x53c3c8(0x121)]==_0x1e0946['bay']&&(_0x336934[_0x53c3c8(0x1ca)]=parseInt(_0x336934[_0x53c3c8(0x1ca)])+parseInt(_0x1e0946[_0x53c3c8(0x12f)]),_0x164de1++);});_0x164de1=='0'&&(_0xfa0ad3[_0x3d7017(0x17e)]=_0xfa0ad3['product_details'][_0x3d7017(0x113)]({'product_name':_0x1e0946[_0x3d7017(0x193)],'product_stock':_0x1e0946[_0x3d7017(0x12f)],'primary_code':_0x1e0946[_0x3d7017(0x12d)],'secondary_code':_0x1e0946[_0x3d7017(0x11c)],'product_code':_0x1e0946[_0x3d7017(0x127)],'bay':_0x1e0946[_0x3d7017(0x121)],'bin':_0x1e0946[_0x3d7017(0xe6)],'type':_0x1e0946[_0x3d7017(0x184)],'floorlevel':_0x1e0946[_0x3d7017(0xf3)]})),console[_0x3d7017(0x19e)](_0x3d7017(0x10a),_0xfa0ad3);}),await _0xfa0ad3[_0x211687(0xff)](),console[_0x211687(0x19e)](_0x5bb3c9['body']);const _0x111945=new c_payment_data({'invoice':_0x20237b,'customer':_0x5bb3c9[_0x211687(0x1c3)][_0x211687(0x17c)],'reason':_0x211687(0x16e)});await _0x111945[_0x211687(0xff)]();const _0x5d786b=await master_shop['find']();console[_0x211687(0x19e)]('add\x20post',_0x5d786b[0x0][_0x211687(0x174)]);const _0x5b70ab=await email_settings['findOne'](),_0x867aca=await customer[_0x211687(0xeb)]({'name':_0x5bb3c9[_0x211687(0x1c3)]['customer']});console[_0x211687(0x19e)](_0x211687(0x134),_0x867aca);_0x5d786b[0x0][_0x211687(0x11e)]==0x1?(right_currency=_0x5d786b[0x0][_0x211687(0xdf)],left_currency=''):(right_currency='',left_currency=_0x5d786b[0x0][_0x211687(0xdf)]);var _0x45a538=_0xf1e56f,_0x308b85=_0x3c7268,_0x27fc6f='',_0x134a53;for(_0x134a53 in _0x45a538){_0x27fc6f+=_0x211687(0x12e)+_0x211687(0x141)+_0x45a538[_0x134a53]+_0x211687(0xe1)+_0x211687(0x141)+_0x308b85[_0x134a53]+'</td>'+_0x211687(0x105);}console['log']('product_list',_0x27fc6f);let _0x4fcfb0=nodemailer[_0x211687(0x1a6)]({'service':_0x211687(0x1be),'auth':{'user':_0x5b70ab[_0x211687(0x164)],'pass':_0x5b70ab[_0x211687(0x196)]}}),_0x3e63bc={'from':_0x5b70ab[_0x211687(0x164)],'to':_0x867aca['email'],'subject':_0x211687(0xec),'attachments':[{'filename':_0x211687(0xe0),'path':__dirname+_0x211687(0x1ad)+_0x211687(0x172)+_0x5d786b[0x0][_0x211687(0x174)],'cid':_0x211687(0x1a2)}],'html':_0x211687(0xfa)+_0x211687(0x144)+_0x211687(0xed)+_0x211687(0x192)+_0x211687(0x10e)+_0x211687(0x192)+_0x211687(0x14f)+'</div>'+_0x211687(0x192)+_0x211687(0x170)+_0x5d786b[0x0][_0x211687(0x16c)]+_0x211687(0x109)+_0x211687(0x122)+_0x211687(0x122)+_0x211687(0x15c)+_0x211687(0x192)+_0x211687(0xcf)+'\x20Order\x20Number\x20:\x20'+_0x20237b+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x211687(0xd1)+_0x2e4f66+'\x20'+_0x211687(0x142)+_0x211687(0x155)+'</div>'+_0x211687(0x140)+_0x211687(0x17f)+_0x211687(0x12e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x211687(0x1cf)+_0x211687(0x102)+_0x211687(0x105)+_0x211687(0xde)+_0x211687(0xf7)+'\x20'+_0x27fc6f+'\x20'+_0x211687(0x157)+_0x211687(0x13d)+'<div>'+_0x211687(0x1a7)+_0x211687(0x179)+_0x5d786b[0x0][_0x211687(0x16c)]+'</h5>'+_0x211687(0x122)+_0x211687(0x122)+_0x211687(0x124)};_0x4fcfb0[_0x211687(0x11b)](_0x3e63bc,function(_0xf33e17,_0x1ef1e4){var _0xfc3e32=_0x211687;_0xf33e17?(console['log'](_0xf33e17),console[_0xfc3e32(0x19e)]('Error\x20Occurs')):console[_0xfc3e32(0x19e)](_0xfc3e32(0x162));}),_0x5bb3c9[_0x211687(0x1c7)](_0x211687(0x123),'sales\x20item\x20return\x20successfull'),_0x383b76['redirect']('/all_sales/view');}catch(_0x1234b9){console[_0x211687(0x19e)](_0x1234b9),_0x383b76['status'](0xc8)['json']({'message1':_0x1234b9[_0x211687(0xd6)]});}}),router['get'](a0_0x5363ac(0x161),auth,async(_0x3e4f1c,_0xa37562)=>{var _0x3fe3a6=a0_0x5363ac;try{const {username:_0x5ae529,email:_0x29f62a,role:_0x3f827c}=_0x3e4f1c['user'],_0x2070c3=_0x3e4f1c['user'],_0x504caa=await profile[_0x3fe3a6(0xeb)]({'email':_0x2070c3[_0x3fe3a6(0x164)]}),_0x2cee15=await master_shop[_0x3fe3a6(0x1c2)]();console[_0x3fe3a6(0x19e)]('barcode\x20Product\x20master',_0x2cee15);const _0x493438=_0x3e4f1c[_0x3fe3a6(0x1b7)]['id'],_0x5449f7=await sales[_0x3fe3a6(0x181)](_0x493438);console[_0x3fe3a6(0x19e)](_0x3fe3a6(0xf1),_0x5449f7);if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0x19a))var _0x13bccb=users[_0x3fe3a6(0x110)];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0x1b2))var _0x13bccb=users[_0x3fe3a6(0x1b2)];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0x18f))var _0x13bccb=users[_0x3fe3a6(0x18f)];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]=='Spanish')var _0x13bccb=users[_0x3fe3a6(0x1ce)];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0xf9))var _0x13bccb=users[_0x3fe3a6(0xf9)];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0x183))var _0x13bccb=users['Portuguese'];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0xf6))var _0x13bccb=users[_0x3fe3a6(0xf6)];else{if(_0x2cee15[0x0][_0x3fe3a6(0x187)]==_0x3fe3a6(0x168))var _0x13bccb=users[_0x3fe3a6(0x149)];}}}}}}}_0xa37562[_0x3fe3a6(0x130)](_0x3fe3a6(0x10c),{'success':_0x3e4f1c[_0x3fe3a6(0x1c7)](_0x3fe3a6(0x123)),'errors':_0x3e4f1c[_0x3fe3a6(0x1c7)](_0x3fe3a6(0x12b)),'role':_0x2070c3,'profile':_0x504caa,'alldata':_0x5449f7,'master_shop':_0x2cee15,'language':_0x13bccb});}catch(_0x21aa54){console[_0x3fe3a6(0x19e)](_0x21aa54);}}),router['post'](a0_0x5363ac(0x12a),async(_0xfb0368,_0x4f1a06)=>{var _0x3875ff=a0_0x5363ac;const {product_code:_0x524b26,warehouse_name:_0x319f02,rooms_data:_0x4b91c8,Roomslist:_0x28dba9}=_0xfb0368[_0x3875ff(0x1c3)],_0x26802c=_0x28dba9[_0x3875ff(0x176)](','),_0x3ce5e7=[];async function _0x399233(_0x24584f){var _0x17f06c=_0x3875ff;const _0x42d181=await warehouse['aggregate']([{'$match':{'name':_0x319f02,'room':_0x24584f}},{'$unwind':_0x17f06c(0x1af)},{'$match':{'product_details.primary_code':_0x524b26}},{'$group':{'_id':_0x17f06c(0x14b),'name':{'$first':_0x17f06c(0x19c)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x17f06c(0x1ac)},'secondary_code':{'$first':_0x17f06c(0xfe)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x17f06c(0x106)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x17f06c(0xd5)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x17f06c(0x1d5)},'storage':{'$first':_0x17f06c(0x1b3)},'rack':{'$first':_0x17f06c(0x1d0)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x17f06c(0x116)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x17f06c(0x100)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x17f06c(0x1da)},'invoice':{'$first':_0x17f06c(0x12c)},'actual_qty':{'$first':_0x17f06c(0x19b)},'actual_uom':{'$first':_0x17f06c(0x16a)}}}]),_0x414fe7=await warehouse['aggregate']([{'$match':{'name':_0x319f02,'room':_0x24584f}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x524b26}},{'$group':{'_id':_0x17f06c(0x14b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x17f06c(0x147)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x17f06c(0xfe)},'product_code':{'$first':_0x17f06c(0xfb)},'level':{'$first':_0x17f06c(0x106)},'isle':{'$first':_0x17f06c(0x10f)},'type':{'$first':_0x17f06c(0xd5)},'pallet':{'$first':_0x17f06c(0x1d1)},'unit':{'$first':_0x17f06c(0x104)},'secondary_unit':{'$first':_0x17f06c(0x1d5)},'storage':{'$first':_0x17f06c(0x1b3)},'rack':{'$first':_0x17f06c(0x1d0)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x17f06c(0x1bb)},'batch_code':{'$first':_0x17f06c(0x100)},'product_cat':{'$first':_0x17f06c(0xe9)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x17f06c(0x1da)},'invoice':{'$first':_0x17f06c(0x12c)}}}]);if(_0x42d181[_0x17f06c(0x148)]>0x0)_0x3ce5e7['push'](_0x42d181);else _0x414fe7['length']>0x0&&_0x3ce5e7[_0x17f06c(0x1c0)](_0x414fe7);}const _0x969177=_0x26802c[_0x3875ff(0xfc)](_0x159ffb=>_0x399233(_0x159ffb));await Promise['all'](_0x969177),_0x4f1a06[_0x3875ff(0xee)](_0x3ce5e7);}),module['exports']=router;function a0_0x2ca1(_0x422a1d,_0x122e71){var _0x49ad84=a0_0x49ad();return a0_0x2ca1=function(_0x2ca156,_0x5e4b49){_0x2ca156=_0x2ca156-0xcd;var _0x5c7845=_0x49ad84[_0x2ca156];return _0x5c7845;},a0_0x2ca1(_0x422a1d,_0x122e71);}function a0_0x49ad(){var _0x242ec3=['stocks','aggregate','$name','unit','German','types','edit_sales_view','<div>','product_name','customers_docs','$product.product_name','password','Floor','../public/language/languages.json','user_id','English\x20(US)','$product_details.actual_qty','$product_details.product_name','abs','log','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Level','room_name','logo','master','Enclosed','sales_invoice','createTransport','<strong>\x20Regards\x20</strong>','slice','then','storage','1497504SHhCNZ','$product_details.primary_code','/../public','purchases_data','$product_details','user','get','Hindi','$product_details.storage','/all_sales/view','399009txLjoi','error','params','False','delivery_date','stock','$product_details.maxPerUnit','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','gmail','$_id','push','quantity','find','body','Shelves','redirect','finalize','flash','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_stock','38AQRLjD','Portuguese','warehouse_name','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.rack','$product_details.floorlevel','1774822jUFPPg','$warehouse_name','_id','$product_details.secondary_unit','sales_quantity','status','/preview/:id','id_transact','$room','Sales\x20Update\x20successfully','expiry_date','$product_details.expiry_date','filter','<h5\x20style=\x22text-align:\x20left;\x22>','/view/add_sale/product','\x20Order\x20Date\x20:\x20','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/view/:id','$product','$product_details.type','message','sale_qty','warehouse','rack','15666588oLNyAz','string','post','primary_unit','</thead>','currency','Logo.png','</td>','getMonth','$product_details.isle','room','prod_invoice','bin','sale_product','$isAllowEdit','$product_details.product_cat','\x20Order\x20Number\x20:\x20','findOne','Sale\x20Return\x20Mail','</head><body>','json','/give_payment/:id','$note','barcode\x20user_id','350290aquqcy','floorlevel','secondary_unit','/view/add_sales','Chinese','<tbody\x20style=\x22text-align:\x20center;\x22>','$sale_product.type','French','<!DOCTYPE\x20html>','$product_details.product_code','map','catch','$product_details.secondary_code','save','$product_details.batch_code','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Receiving\x20Area','$product_details.unit','</tr>','$product_details.bay','$sale_product.bay','Ambient','\x20</h2>','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','all_sales_barcode','/view/add_sales/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.bin','English','payment\x20successfull','Enabled','concat','port','OUT-','$product_details.production_date','note','Sales\x20Add\x20successfully','level','add_sales','sendMail','secondary_code','floor','currency_placement','nodemailer','express','bay','</div>','success','</body></html>','prod_code','carton','product_code','123957fgloaD','forEach','/barcode_scanner','errors','$product_details.invoice','primary_code','<tr>','return_qty','render','actual_qty','<span\x20style=\x22float:\x20right;\x22>','maxperunit','customer_data','max_per_unit','invoice','/invoice/:id','back','toString','role','$customers_docs','$return_data','</table>','batch_code','Received\x20Payment\x20For\x20Sale','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</span>','quantity_notConverted','<html><head><title></title>','random','$customer','$product_details.product_stock','length','Arabic','../middleware/auth','$product_details._id','customers','all_sales','Return\x20Goods','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','id_transaction_from','padStart','48XVpLZZ','../models/all_models','1851552sQHNOa','</h5>','RoomAssigned','</tbody>','staff','getFullYear','/all_sales/preview/','$sale_product.floorlevel','<hr\x20class=\x22my-3\x22>','Return\x20Rooms','name','Raw\x20Materials','production_date','/barcode/:id','Email\x20sent\x20successfully','host','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Sales\x20Mail','Arabic\x20(ae)','$sale_product.quantity','$product_details.actual_uom','$invoice','site_title','stock_data','Sale\x20Return','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<h2>\x20','product','/upload/','/view/return_sales/:id','image','SCRN','split','return_sale','$sale_product.bin','<h5>','/view','$finalize','customer','requested_qty','product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_data','findById','actual_uom','Portuguese\x20(BR)','type','getDate','prod_cat','language','isAllowEdit','foreach\x20newproduct','delivery_code'];a0_0x49ad=function(){return _0x242ec3;};return a0_0x49ad();}