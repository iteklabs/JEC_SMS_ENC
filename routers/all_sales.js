function a0_0x1462(_0x3748c4,_0x14c626){var _0x5013c5=a0_0x5013();return a0_0x1462=function(_0x146207,_0x36ab61){_0x146207=_0x146207-0x1de;var _0x465cf5=_0x5013c5[_0x146207];return _0x465cf5;},a0_0x1462(_0x3748c4,_0x14c626);}function a0_0x5013(){var _0x311d34=['$product_details.invoice','53031UINyjZ','unit','</div>','Return\x20Rooms','$name','Hindi','54178ybtPLb','$return_data','prod_invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','warehouse_name','/invoice/:id','Portuguese','1851870UpMBqY','/upload/','</td>','$product_details.rack','delivery_code','<tr>','bay','Router','catch','sale_product','$note','host','English\x20(US)','date','aggregate','$product','storage','post','$sale_product.quantity','currency','status','max_per_unit','final','error','batch_code','rack','master','return_qty','flash','id_transact','$product_details.secondary_code','Floor','product_code','/../public','/view/add_sales/:id','</h5>','$product_details.batch_code','$customers_docs','filter','$finalize','edit_sales','type','createTransport','$sale_product.bay','$sale_product.bin','name','getMonth','Enabled','$product_details.pallet','sendMail','render','barcode\x20Product\x20master','$product_details.bin','push','10WrcuPl','warehouse','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</thead>','2HPtrVK','foreach\x20newproduct','password','map','/all_sales/preview/','floorlevel','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getFullYear','German','1140XXSAGR','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.product_code','Chinese','$_id','product_name','return_data','all','$sale_product','add_sales','secondary_unit','product_data','length','/view/:id','id_transaction_from','$product_details.floorlevel','French','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/view/add_sales','user','Shelves','return_sale','<hr\x20class=\x22my-3\x22>','findById','log','toString','bin','Error\x20Occurs','email','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','invoice','stocks','barcode\x20user_id','/view/add_sale/product','customers_docs','Sale\x20Return','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details._id','$sale_product.type','room_name','\x20</h2>','Portuguese\x20(BR)','production_date','<div>','$product_details.level','forEach','add\x20post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/view/return_sales/:id','site_title','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<!DOCTYPE\x20html>','Ambient','</span>','$product_details.bay','$product_details.product_cat','body','max','expiry_date','$isAllowEdit','/all_sales/view','sales\x20item\x20return\x20successfull','gmail','Spanish','role','Arabic','express','received_amount','findOne','/give_payment/:id','$product_details.actual_uom','</tbody>','RMSEmail','<h5\x20style=\x22text-align:\x20left;\x22>','success','/barcode/:id','111952xlAGHF','message','$product_details.product_stock','padStart','<h2>\x20','An\x20error\x20occurred\x20while\x20saving\x20data.','requested_qty','Raw\x20Materials','types','maxperunit','string','4ctHXAx','edit_sales_view','json','Sales\x20Mail','/preview/:id','logo','get','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','port','customers','product','actual_uom','image','sales_invoice','concat','nodemailer','sale_qty','all_sales_barcode','sales_quantity','$product_details.unit','OUT-','save','payment\x20successfull','True','<span\x20style=\x22float:\x20right;\x22>','../public/language/languages.json','$product_details.product_name','$product_details.maxPerUnit','/barcode_scanner','prod_cat','all_sales','<table\x20style=\x22width:\x20100%\x20!important;\x22>','primary_unit','actual_qty','False','quantity','stock','sales\x20all_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','quantity_notConverted','Received\x20Payment\x20For\x20Sale','$product_details.storage','primary_code','customer','\x20Order\x20Number\x20:\x20','Return\x20Goods','params','note','$warehouse_name','then','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_stock','$room','abs','<h5>','$sale_product.floorlevel','Sales\x20Add\x20successfully','</head><body>','</table>','slice','delivery_date','currency_placement','$customer','language','$product_details','errors','$product_details.production_date','$invoice','exports','secondary_code','prod_code','Sales\x20Update\x20successfully','redirect','finalize','$product.product_name','_id','$product_details.type','Enclosed','carton','../models/all_models','Logo.png','RoomAssigned','purchases_data','10728954JyfPEM','level','product_details','SCRN','room','user_id','Arabic\x20(ae)','$product_details.expiry_date','stock_data','floor','8257190fuKnSE','find','../middleware/auth','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','98cFvUbD','Email\x20sent\x20successfully','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.actual_qty','<html><head><title></title>','10138152maJCLU','Receiving\x20Area','$product_details.isle'];a0_0x5013=function(){return _0x311d34;};return a0_0x5013();}var a0_0x4e76ac=a0_0x1462;(function(_0x147aeb,_0x3fb35b){var _0xa4f8e5=a0_0x1462,_0x1f0563=_0x147aeb();while(!![]){try{var _0x37d53f=-parseInt(_0xa4f8e5(0x2d3))/0x1*(-parseInt(_0xa4f8e5(0x292))/0x2)+parseInt(_0xa4f8e5(0x299))/0x3*(-parseInt(_0xa4f8e5(0x21f))/0x4)+parseInt(_0xa4f8e5(0x27d))/0x5+parseInt(_0xa4f8e5(0x288))/0x6+-parseInt(_0xa4f8e5(0x282))/0x7*(parseInt(_0xa4f8e5(0x214))/0x8)+parseInt(_0xa4f8e5(0x273))/0x9*(-parseInt(_0xa4f8e5(0x2cf))/0xa)+-parseInt(_0xa4f8e5(0x28c))/0xb*(parseInt(_0xa4f8e5(0x2dc))/0xc);if(_0x37d53f===_0x3fb35b)break;else _0x1f0563['push'](_0x1f0563['shift']());}catch(_0x39fbac){_0x1f0563['push'](_0x1f0563['shift']());}}}(a0_0x5013,0xe38a1));const express=require(a0_0x4e76ac(0x20a)),app=express(),router=express[a0_0x4e76ac(0x2a0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4e76ac(0x26f)),auth=require(a0_0x4e76ac(0x27f)),nodemailer=require(a0_0x4e76ac(0x22e)),users=require(a0_0x4e76ac(0x238));router[a0_0x4e76ac(0x225)]('/view',auth,async(_0x120d55,_0x4668b6)=>{var _0x374082=a0_0x4e76ac;try{const {username:_0x132377,email:_0x42f2b7,role:_0x3bc38b}=_0x120d55['user'],_0x480d38=_0x120d55[_0x374082(0x2ef)],_0x422c13=await profile[_0x374082(0x20c)]({'email':_0x480d38[_0x374082(0x1e2)]}),_0x341294=await master_shop[_0x374082(0x27e)]();let _0x3e0fdd;if(_0x480d38[_0x374082(0x208)]==_0x374082(0x280)){const _0x59dbf5=await staff[_0x374082(0x20c)]({'email':_0x480d38[_0x374082(0x1e2)]});_0x3e0fdd=await sales[_0x374082(0x2a7)]([{'$lookup':{'from':'customers','localField':_0x374082(0x24a),'foreignField':'name','as':_0x374082(0x1e8)}},{'$unwind':'$customers_docs'},{'$unwind':_0x374082(0x2e4)},{'$group':{'_id':_0x374082(0x2e0),'invoice':{'$first':_0x374082(0x263)},'customers':{'$first':_0x374082(0x25e)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x374082(0x24f)},'sale_product':{'$push':_0x374082(0x2e4)},'note':{'$first':_0x374082(0x2a3)},'return_data':{'$first':_0x374082(0x293)},'customers_docs':{'$first':_0x374082(0x2be)},'total_saleproduct_quantity':{'$sum':_0x374082(0x2ab)},'level':{'$addToSet':_0x374082(0x2c4)},'isle':{'$addToSet':_0x374082(0x2c5)},'type':{'$addToSet':_0x374082(0x1ec)},'pallet':{'$addToSet':_0x374082(0x257)},'finalize':{'$first':_0x374082(0x2c0)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3e0fdd=await sales['aggregate']([{'$lookup':{'from':_0x374082(0x228),'localField':_0x374082(0x24a),'foreignField':_0x374082(0x2c6),'as':_0x374082(0x1e8)}},{'$unwind':_0x374082(0x2be)},{'$unwind':_0x374082(0x2e4)},{'$group':{'_id':_0x374082(0x2e0),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x374082(0x24f)},'sale_product':{'$push':_0x374082(0x2e4)},'note':{'$first':_0x374082(0x2a3)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x374082(0x2be)},'total_saleproduct_quantity':{'$sum':_0x374082(0x2ab)},'level':{'$addToSet':_0x374082(0x2c4)},'isle':{'$addToSet':_0x374082(0x2c5)},'type':{'$addToSet':_0x374082(0x1ec)},'pallet':{'$addToSet':_0x374082(0x257)},'finalize':{'$first':_0x374082(0x2c0)},'isAllowEdit':{'$first':_0x374082(0x203)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x374082(0x1de)](_0x374082(0x244),_0x3e0fdd);if(_0x341294[0x0][_0x374082(0x25f)]=='English\x20(US)'){var _0x2d90d7=users['English'];console[_0x374082(0x1de)](_0x2d90d7);}else{if(_0x341294[0x0][_0x374082(0x25f)]==_0x374082(0x291))var _0x2d90d7=users[_0x374082(0x291)];else{if(_0x341294[0x0][_0x374082(0x25f)]=='German')var _0x2d90d7=users[_0x374082(0x2db)];else{if(_0x341294[0x0][_0x374082(0x25f)]==_0x374082(0x207))var _0x2d90d7=users[_0x374082(0x207)];else{if(_0x341294[0x0][_0x374082(0x25f)]=='French')var _0x2d90d7=users[_0x374082(0x2ec)];else{if(_0x341294[0x0][_0x374082(0x25f)]=='Portuguese\x20(BR)')var _0x2d90d7=users[_0x374082(0x298)];else{if(_0x341294[0x0]['language']==_0x374082(0x2df))var _0x2d90d7=users[_0x374082(0x2df)];else{if(_0x341294[0x0][_0x374082(0x25f)]==_0x374082(0x279))var _0x2d90d7=users[_0x374082(0x209)];}}}}}}}_0x4668b6['render'](_0x374082(0x23d),{'success':_0x120d55[_0x374082(0x2b5)](_0x374082(0x212)),'errors':_0x120d55[_0x374082(0x2b5)](_0x374082(0x261)),'sales':_0x3e0fdd,'profile':_0x422c13,'role':_0x480d38,'master_shop':_0x341294,'language':_0x2d90d7});}catch(_0x25ac63){console[_0x374082(0x1de)](_0x25ac63);}});async function getRandom8DigitNumber(){var _0x425b63=a0_0x4e76ac;const _0x4a5a80=0x989680,_0x5a2d19=0x5f5e0ff,_0x30edac=Math[_0x425b63(0x27c)](Math['random']()*(_0x5a2d19-_0x4a5a80+0x1))+_0x4a5a80;var _0x2439a6;const _0x11a37b=await sales[_0x425b63(0x20c)]({'invoice':_0x425b63(0x233)+_0x30edac});return _0x11a37b&&_0x11a37b['length']>0x0?_0x2439a6=_0x425b63(0x233)+_0x30edac:_0x2439a6=_0x425b63(0x233)+_0x30edac,_0x2439a6;}router['get'](a0_0x4e76ac(0x2ee),auth,async(_0x159daf,_0x27c5fd)=>{var _0x480095=a0_0x4e76ac;try{const {username:_0x19de3c,email:_0x1389f9,role:_0x1c091c}=_0x159daf[_0x480095(0x2ef)],_0x3b052e=_0x159daf[_0x480095(0x2ef)],_0x54febf=await profile[_0x480095(0x20c)]({'email':_0x3b052e[_0x480095(0x1e2)]}),_0x564bcd=await master_shop[_0x480095(0x27e)](),_0x2c6c46=await customer[_0x480095(0x27e)]({});let _0x184277;if(_0x3b052e[_0x480095(0x208)]==_0x480095(0x280)){const _0x3d6319=await staff[_0x480095(0x20c)]({'email':_0x3b052e[_0x480095(0x1e2)]});_0x184277=await warehouse[_0x480095(0x2a7)]([{'$match':{'status':'Enabled','name':_0x3d6319[_0x480095(0x2d0)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x480095(0x24c)}}},{'$group':{'_id':_0x480095(0x290),'name':{'$first':_0x480095(0x290)}}},{'$sort':{'name':0x1}}]);}else _0x184277=await warehouse[_0x480095(0x2a7)]([{'$match':{'status':_0x480095(0x2c8),'warehouse_category':_0x480095(0x21b),'name':{'$ne':_0x480095(0x24c)}}},{'$group':{'_id':_0x480095(0x290),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x3a34f8=await product[_0x480095(0x27e)]({});var _0x48a7d3=[_0x480095(0x1fc),_0x480095(0x26d)];const _0x42a829=await sales[_0x480095(0x27e)]({}),_0x3486e6=_0x42a829['length']+0x1,_0x1d4ccc=_0x480095(0x233)+_0x3486e6[_0x480095(0x1df)]()[_0x480095(0x217)](0x5,'0');if(_0x564bcd[0x0][_0x480095(0x25f)]=='English\x20(US)'){var _0x5e589f=users[_0x480095(0x251)];console[_0x480095(0x1de)](_0x5e589f);}else{if(_0x564bcd[0x0][_0x480095(0x25f)]==_0x480095(0x291))var _0x5e589f=users[_0x480095(0x291)];else{if(_0x564bcd[0x0][_0x480095(0x25f)]=='German')var _0x5e589f=users[_0x480095(0x2db)];else{if(_0x564bcd[0x0]['language']==_0x480095(0x207))var _0x5e589f=users[_0x480095(0x207)];else{if(_0x564bcd[0x0]['language']==_0x480095(0x2ec))var _0x5e589f=users[_0x480095(0x2ec)];else{if(_0x564bcd[0x0][_0x480095(0x25f)]=='Portuguese\x20(BR)')var _0x5e589f=users[_0x480095(0x298)];else{if(_0x564bcd[0x0]['language']==_0x480095(0x2df))var _0x5e589f=users[_0x480095(0x2df)];else{if(_0x564bcd[0x0][_0x480095(0x25f)]==_0x480095(0x279))var _0x5e589f=users[_0x480095(0x209)];}}}}}}}const _0x4bf29d=getRandom8DigitNumber();_0x4bf29d[_0x480095(0x250)](_0x3068f7=>{var _0x55376f=_0x480095;_0x27c5fd[_0x55376f(0x2cb)](_0x55376f(0x2e5),{'success':_0x159daf[_0x55376f(0x2b5)](_0x55376f(0x212)),'errors':_0x159daf['flash'](_0x55376f(0x261)),'role':_0x3b052e,'profile':_0x54febf,'customer':_0x2c6c46,'warehouse':_0x184277,'product':_0x3a34f8,'invoice':_0x3068f7,'master_shop':_0x564bcd,'language':_0x5e589f,'rooms_data':_0x48a7d3});})[_0x480095(0x2a1)](_0xe5ab0e=>{var _0x485dd2=_0x480095;_0x159daf[_0x485dd2(0x2b5)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x27c5fd[_0x485dd2(0x268)](_0x485dd2(0x204));});}catch(_0x32c1bb){console[_0x480095(0x1de)](_0x32c1bb);}}),router[a0_0x4e76ac(0x225)](a0_0x4e76ac(0x2bb),auth,async(_0x3453a1,_0x2324e7)=>{var _0x121514=a0_0x4e76ac;try{const _0x4b3a5e=_0x3453a1[_0x121514(0x24d)]['id'];console[_0x121514(0x1de)](_0x4b3a5e);const _0x60ddbd=await product['find'](),_0x22be9a=await purchases[_0x121514(0x2a7)]([{'$match':{'warehouse_name':_0x4b3a5e}},{'$unwind':_0x121514(0x2a8)},{'$group':{'_id':_0x121514(0x26a)}}]);console[_0x121514(0x1de)](_0x121514(0x272),_0x22be9a),_0x2324e7[_0x121514(0x2ad)](0xc8)[_0x121514(0x221)]({'purchases_data':_0x22be9a,'product_data':_0x60ddbd});}catch(_0x3c5ec3){console[_0x121514(0x1de)](_0x3c5ec3);}}),router[a0_0x4e76ac(0x2aa)](a0_0x4e76ac(0x1e7),auth,async(_0x495071,_0x1cfe04)=>{var _0x167542=a0_0x4e76ac;try{const {warehouse_data:_0x4cfed7,product_data:_0x1ff0e3}=_0x495071[_0x167542(0x200)];console[_0x167542(0x1de)](_0x495071[_0x167542(0x200)][_0x167542(0x2e7)]);;const _0x3e149d=await master_shop[_0x167542(0x27e)]();console[_0x167542(0x1de)](_0x167542(0x2b3),_0x3e149d);const _0x310c3c=await product[_0x167542(0x20c)]({'name':_0x1ff0e3});console[_0x167542(0x1de)](_0x167542(0x229),_0x310c3c);const _0x4f8d64=await warehouse[_0x167542(0x2a7)]([{'$match':{'name':_0x4cfed7}},{'$unwind':_0x167542(0x260)},{'$match':{'product_details.product_name':_0x1ff0e3}},{'$group':{'_id':_0x167542(0x239),'product_stock':{'$first':_0x167542(0x216)}}}]);console['log'](_0x167542(0x27b),_0x4f8d64),_0x1cfe04[_0x167542(0x2ad)](0xc8)['json']({'master':_0x3e149d,'new_product':_0x310c3c,'stock_data':_0x4f8d64});}catch(_0x1092be){console[_0x167542(0x1de)](_0x1092be);}}),router['post'](a0_0x4e76ac(0x2ee),auth,async(_0x54341b,_0x29944e)=>{var _0x323bea=a0_0x4e76ac;try{const {invoice:_0x345729,date:_0x2ff4fe,warehouse_name:_0x4c4cc5,product_name:_0x2653e8,stock:_0xc72c55,quantity:_0x193665,note:_0x1e41b6,room:_0x5afc47,primary_code:_0x20a5a6,secondary_code:_0x822174,prod_code:_0x482859,level:_0x13c987,isle:_0x3a7fc8,pallet:_0x556793,batch_code:_0x4eef0a,SCRN:_0x200df7,expiry_date:_0x117ab4}=_0x54341b[_0x323bea(0x200)];if(typeof _0x2653e8==_0x323bea(0x21e))var _0x570941=[_0x54341b['body'][_0x323bea(0x2e1)]],_0x20538f=[_0x54341b['body']['stock']],_0x2fe732=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x26e)]],_0x478228=[_0x54341b[_0x323bea(0x200)]['primary_code']],_0x3dab4e=[_0x54341b[_0x323bea(0x200)]['secondary_code']],_0x52ece4=[_0x54341b[_0x323bea(0x200)]['prod_code']],_0x3080c2=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x274)]],_0x281fa3=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x23f)]],_0x3488f5=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x2e6)]],_0xc928fe=[_0x54341b[_0x323bea(0x200)]['batch_code']],_0xb74fed=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x202)]],_0x1c75de=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x2ae)]],_0x2d113e=[_0x54341b['body'][_0x323bea(0x1f0)]],_0x1ad6c8=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x21a)]],_0x562ae5=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x25c)]],_0x109f02=[_0x54341b['body'][_0x323bea(0x29d)]],_0x195409=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x23c)]],_0x4b44e0=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x242)]],_0x372fac=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x271)]],_0x109db8=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x294)]],_0x4a2b74=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x240)]],_0x305f28=[_0x54341b[_0x323bea(0x200)][_0x323bea(0x22a)]],_0x555ee3=[_0x54341b['body'][_0x323bea(0x2b6)]];else var _0x570941=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x2e1)]],_0x20538f=[..._0x54341b[_0x323bea(0x200)]['stock']],_0x2fe732=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x26e)]],_0x478228=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x249)]],_0x3dab4e=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x265)]],_0x52ece4=[..._0x54341b['body'][_0x323bea(0x266)]],_0x3080c2=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x274)]],_0x281fa3=[..._0x54341b['body']['primary_unit']],_0x3488f5=[..._0x54341b[_0x323bea(0x200)]['secondary_unit']],_0xc928fe=[..._0x54341b[_0x323bea(0x200)]['batch_code']],_0xb74fed=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x202)]],_0x1c75de=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x2ae)]],_0x2d113e=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x1f0)]],_0x1ad6c8=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x21a)]],_0x562ae5=[..._0x54341b['body'][_0x323bea(0x25c)]],_0x109f02=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x29d)]],_0x195409=[..._0x54341b[_0x323bea(0x200)]['prod_cat']],_0x4b44e0=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x242)]],_0x372fac=[..._0x54341b[_0x323bea(0x200)]['RoomAssigned']],_0x109db8=[..._0x54341b['body'][_0x323bea(0x294)]],_0x4a2b74=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x240)]],_0x305f28=[..._0x54341b[_0x323bea(0x200)][_0x323bea(0x22a)]],_0x555ee3=[..._0x54341b['body'][_0x323bea(0x2b6)]];const _0x351bf6=_0x570941['map'](_0x54e6b3=>{return _0x54e6b3={'product_name':_0x54e6b3};});_0x20538f[_0x323bea(0x1f3)]((_0x3f9893,_0x3630a3)=>{var _0x362fdf=_0x323bea;_0x351bf6[_0x3630a3][_0x362fdf(0x243)]=Math[_0x362fdf(0x255)](_0x3f9893);}),_0x4a2b74[_0x323bea(0x1f3)]((_0x12d767,_0x3919ed)=>{var _0x1ab5f8=_0x323bea;_0x351bf6[_0x3919ed][_0x1ab5f8(0x240)]=Math['abs'](_0x12d767);}),_0x305f28[_0x323bea(0x1f3)]((_0x23920a,_0x201b2f)=>{var _0x581da3=_0x323bea;_0x351bf6[_0x201b2f][_0x581da3(0x22a)]=_0x23920a;}),_0x555ee3['forEach']((_0x426b03,_0x472d0b)=>{var _0x1380a3=_0x323bea;_0x351bf6[_0x472d0b][_0x1380a3(0x2ea)]=_0x426b03;}),_0x2fe732[_0x323bea(0x1f3)]((_0x53525e,_0x3fcc9a)=>{_0x351bf6[_0x3fcc9a]['quantity']=_0x53525e;}),_0x478228[_0x323bea(0x1f3)]((_0x143542,_0x18523c)=>{_0x351bf6[_0x18523c]['primary_code']=_0x143542;}),_0x3dab4e[_0x323bea(0x1f3)]((_0x118759,_0x4195c0)=>{var _0x3222bb=_0x323bea;_0x351bf6[_0x4195c0][_0x3222bb(0x265)]=_0x118759;}),_0x52ece4['forEach']((_0x1cca08,_0x44a0c8)=>{_0x351bf6[_0x44a0c8]['product_code']=_0x1cca08;}),_0x3080c2['forEach']((_0x5d7bd3,_0x1faab5)=>{_0x372fac['forEach']((_0x2fbb79,_0x232d07)=>{var _0x4ae843=a0_0x1462;if(_0x2fbb79==_0x4ae843(0x289)&&_0x1faab5==_0x232d07){var _0x189cb5=_0x5d7bd3[_0x4ae843(0x25b)](0x3);_0x351bf6[_0x1faab5][_0x4ae843(0x2a9)]=_0x5d7bd3[0x0],_0x351bf6[_0x1faab5][_0x4ae843(0x2b2)]=_0x5d7bd3[0x1],_0x351bf6[_0x1faab5][_0x4ae843(0x29f)]=0x0,_0x351bf6[_0x1faab5][_0x4ae843(0x1e0)]=0x0,_0x351bf6[_0x1faab5][_0x4ae843(0x2c2)]=_0x4ae843(0x2b8),_0x351bf6[_0x1faab5][_0x4ae843(0x2d8)]=_0x189cb5;}else{if(_0x2fbb79==_0x4ae843(0x2f0)&&_0x1faab5==_0x232d07){var _0x189cb5=_0x5d7bd3[_0x4ae843(0x25b)](0x3);_0x351bf6[_0x1faab5]['storage']=_0x5d7bd3[0x0],_0x351bf6[_0x1faab5][_0x4ae843(0x2b2)]=_0x5d7bd3[0x1],_0x351bf6[_0x1faab5][_0x4ae843(0x29f)]=0x0,_0x351bf6[_0x1faab5][_0x4ae843(0x1e0)]=0x0,_0x351bf6[_0x1faab5][_0x4ae843(0x2c2)]=_0x4ae843(0x2b8),_0x351bf6[_0x1faab5]['floorlevel']=_0x5d7bd3[0x5];}else{if(_0x1faab5==_0x232d07){var _0x2aa251;if(_0x5d7bd3[0x4]=='L')_0x2aa251='Level';else _0x5d7bd3[0x4]=='F'&&(_0x2aa251='Floor');_0x351bf6[_0x1faab5]['storage']=_0x5d7bd3[0x0],_0x351bf6[_0x1faab5][_0x4ae843(0x2b2)]=_0x5d7bd3[0x1],_0x351bf6[_0x1faab5]['bay']=_0x5d7bd3[0x2],_0x351bf6[_0x1faab5][_0x4ae843(0x1e0)]=_0x5d7bd3[0x3],_0x351bf6[_0x1faab5][_0x4ae843(0x2c2)]=_0x2aa251,_0x351bf6[_0x1faab5][_0x4ae843(0x2d8)]=_0x5d7bd3[0x5];}}}});}),_0x281fa3[_0x323bea(0x1f3)]((_0x2307c4,_0x136f6a)=>{var _0x10f5fb=_0x323bea;_0x351bf6[_0x136f6a][_0x10f5fb(0x28d)]=_0x2307c4;}),_0x3488f5[_0x323bea(0x1f3)]((_0x3ef760,_0xefeee4)=>{var _0x2fc697=_0x323bea;_0x351bf6[_0xefeee4][_0x2fc697(0x2e6)]=_0x3ef760;}),_0xc928fe[_0x323bea(0x1f3)]((_0x33f5c9,_0x4d6665)=>{var _0x30b048=_0x323bea;_0x351bf6[_0x4d6665][_0x30b048(0x2b1)]=_0x33f5c9;}),_0xb74fed[_0x323bea(0x1f3)]((_0xa7f28d,_0x1e9383)=>{var _0x4df603=_0x323bea;_0x351bf6[_0x1e9383][_0x4df603(0x202)]=_0xa7f28d;}),_0x1c75de[_0x323bea(0x1f3)]((_0x50632b,_0x4629de)=>{var _0x365034=_0x323bea;_0x351bf6[_0x4629de][_0x365034(0x21d)]=_0x50632b;}),_0x2d113e[_0x323bea(0x1f3)]((_0x45eb90,_0x183335)=>{var _0x436a9b=_0x323bea;_0x351bf6[_0x183335][_0x436a9b(0x1f0)]=_0x45eb90;}),_0x1ad6c8[_0x323bea(0x1f3)]((_0x1e3c06,_0x51fc2b)=>{_0x351bf6[_0x51fc2b]['requested_qty']=_0x1e3c06;}),_0x562ae5[_0x323bea(0x1f3)]((_0x544b94,_0x52e945)=>{var _0x3b101b=_0x323bea;_0x351bf6[_0x52e945][_0x3b101b(0x25c)]=_0x544b94;}),_0x109f02['forEach']((_0x2a57fd,_0x5d80a3)=>{var _0x217e78=_0x323bea;_0x351bf6[_0x5d80a3][_0x217e78(0x29d)]=_0x2a57fd;}),_0x195409[_0x323bea(0x1f3)]((_0x23bffe,_0x3ff261)=>{var _0x22de77=_0x323bea;_0x351bf6[_0x3ff261][_0x22de77(0x23c)]=_0x23bffe;}),_0x4b44e0[_0x323bea(0x1f3)]((_0x2de36f,_0x26be5f)=>{_0x351bf6[_0x26be5f]['quantity_notConverted']=_0x2de36f;}),_0x372fac[_0x323bea(0x1f3)]((_0x1754b2,_0x51f657)=>{var _0x4e21bd=_0x323bea;_0x351bf6[_0x51f657][_0x4e21bd(0x1ed)]=_0x1754b2;}),_0x109db8[_0x323bea(0x1f3)]((_0x5d66f1,_0xda5e96)=>{var _0x3102a8=_0x323bea;_0x351bf6[_0xda5e96][_0x3102a8(0x1e4)]=_0x5d66f1;});var _0x5045b0=0x0;_0x351bf6[_0x323bea(0x1f3)](_0x1912be=>{var _0x291c1b=_0x323bea;(_0x1912be[_0x291c1b(0x243)]<_0x1912be['quantity_notConverted']||_0x1912be[_0x291c1b(0x246)]==0x0)&&(console['log'](_0x291c1b(0x2d4),_0x1912be),_0x5045b0++);});const _0x442e08=_0x351bf6[_0x323bea(0x2bf)](_0x22a198=>_0x22a198[_0x323bea(0x242)]!=='0'&&_0x22a198[_0x323bea(0x242)]!==''),_0x39acd7=new sales({'invoice':_0x345729,'customer':_0x54341b[_0x323bea(0x200)][_0x323bea(0x24a)],'date':_0x2ff4fe,'warehouse_name':_0x4c4cc5,'sale_product':_0x442e08,'note':_0x1e41b6,'room':_0x5afc47,'primary_code':_0x20a5a6,'secondary_code':_0x822174,'prod_code':_0x482859,'SCRN':_0x200df7}),_0x1c346b=await _0x39acd7[_0x323bea(0x234)]();_0x54341b[_0x323bea(0x2b5)](_0x323bea(0x212),_0x323bea(0x258)),_0x29944e['redirect'](_0x323bea(0x2d7)+_0x1c346b['_id']);}catch(_0x530025){console[_0x323bea(0x1de)](_0x530025);}}),router['get']('/preview/:id',auth,async(_0x25f775,_0x261a46)=>{var _0x576633=a0_0x4e76ac;try{const {username:_0x5c1038,email:_0x2245dc,role:_0x885d9b}=_0x25f775[_0x576633(0x2ef)],_0x2b79e9=_0x25f775[_0x576633(0x2ef)],_0x5e26f6=await profile[_0x576633(0x20c)]({'email':_0x2b79e9['email']}),_0x56c041=await master_shop[_0x576633(0x27e)](),_0xf0fe6e=_0x25f775['params']['id'],_0x372ffe=await sales[_0x576633(0x2f3)](_0xf0fe6e),_0x272136=await warehouse[_0x576633(0x2a7)]([{'$match':{'name':_0x372ffe['warehouse_name']}},{'$unwind':_0x576633(0x260)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x576633(0x239)},'product_stock':{'$first':_0x576633(0x216)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x576633(0x2cd)},'type':{'$first':_0x576633(0x26c)},'floorlevel':{'$first':_0x576633(0x2eb)},'primary_code':{'$first':_0x576633(0x284)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x576633(0x2de)},'storage':{'$first':_0x576633(0x248)},'rack':{'$first':_0x576633(0x29c)},'expiry_date':{'$first':_0x576633(0x27a)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x576633(0x28b)}}}]),_0x2f4e3c=await customer[_0x576633(0x27e)]({});let _0x329707;if(_0x2b79e9[_0x576633(0x208)]==_0x576633(0x280)){const _0x3237aa=await staff['findOne']({'email':_0x2b79e9[_0x576633(0x1e2)]});_0x329707=await warehouse[_0x576633(0x2a7)]([{'$match':{'status':_0x576633(0x2c8),'name':_0x3237aa[_0x576633(0x2d0)]}},{'$group':{'_id':_0x576633(0x290),'name':{'$first':_0x576633(0x290)}}}]);}else _0x329707=await warehouse[_0x576633(0x2a7)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x44e19f=await product[_0x576633(0x27e)]({}),_0xd2af9c=await suppliers['find']({});if(_0x56c041[0x0][_0x576633(0x25f)]==_0x576633(0x2a5)){var _0x56ccc6=users[_0x576633(0x251)];console[_0x576633(0x1de)](_0x56ccc6);}else{if(_0x56c041[0x0][_0x576633(0x25f)]==_0x576633(0x291))var _0x56ccc6=users[_0x576633(0x291)];else{if(_0x56c041[0x0]['language']==_0x576633(0x2db))var _0x56ccc6=users[_0x576633(0x2db)];else{if(_0x56c041[0x0]['language']==_0x576633(0x207))var _0x56ccc6=users['Spanish'];else{if(_0x56c041[0x0][_0x576633(0x25f)]=='French')var _0x56ccc6=users[_0x576633(0x2ec)];else{if(_0x56c041[0x0][_0x576633(0x25f)]=='Portuguese\x20(BR)')var _0x56ccc6=users[_0x576633(0x298)];else{if(_0x56c041[0x0][_0x576633(0x25f)]==_0x576633(0x2df))var _0x56ccc6=users[_0x576633(0x2df)];else{if(_0x56c041[0x0][_0x576633(0x25f)]=='Arabic\x20(ae)')var _0x56ccc6=users['Arabic'];}}}}}}}_0x261a46[_0x576633(0x2cb)](_0x576633(0x220),{'success':_0x25f775[_0x576633(0x2b5)](_0x576633(0x212)),'errors':_0x25f775['flash'](_0x576633(0x261)),'role':_0x2b79e9,'profile':_0x5e26f6,'customer':_0x2f4e3c,'warehouse':_0x329707,'product':_0x272136,'user':_0x372ffe,'master_shop':_0x56c041,'unit':_0x44e19f,'language':_0x56ccc6,'suppliers':_0xd2af9c});}catch(_0x33f854){console['log'](_0x33f854);}}),router[a0_0x4e76ac(0x2aa)](a0_0x4e76ac(0x223),auth,async(_0x426b66,_0x23677a)=>{var _0x20ea66=a0_0x4e76ac;try{const _0x4ad781=_0x426b66['params']['id'],{invoice:_0x25ec0c,warehouse_name:_0x45b541,room:_0x19323b}=_0x426b66['body'],_0x42a5b=await sales['findOne']({'invoice':_0x25ec0c}),_0x17a936=_0x42a5b[_0x20ea66(0x2a2)][_0x20ea66(0x2d6)](async _0x2d82ee=>{var _0x48f366=_0x20ea66,_0x331e71=await warehouse[_0x48f366(0x20c)]({'name':_0x45b541,'room':_0x2d82ee[_0x48f366(0x1ed)],'warehouse_category':'Raw\x20Materials'});const _0x224471=_0x331e71[_0x48f366(0x275)][_0x48f366(0x2d6)](_0x33cea5=>{var _0xaf1f16=_0x48f366;_0x33cea5['product_name']==_0x2d82ee[_0xaf1f16(0x2e1)]&&_0x33cea5[_0xaf1f16(0x2d8)]==_0x2d82ee[_0xaf1f16(0x2d8)]&&_0x33cea5[_0xaf1f16(0x2c2)]==_0x2d82ee[_0xaf1f16(0x2c2)]&&_0x33cea5[_0xaf1f16(0x1e0)]==_0x2d82ee['bin']&&_0x33cea5[_0xaf1f16(0x29f)]==_0x2d82ee['bay']&&_0x33cea5[_0xaf1f16(0x2b2)]==_0x2d82ee[_0xaf1f16(0x2b2)]&&_0x33cea5[_0xaf1f16(0x2a9)]==_0x2d82ee[_0xaf1f16(0x2a9)]&&_0x33cea5[_0xaf1f16(0x202)]==_0x2d82ee['expiry_date']&&_0x33cea5[_0xaf1f16(0x2b1)]==_0x2d82ee[_0xaf1f16(0x2b1)]&&_0x33cea5[_0xaf1f16(0x1e4)]==_0x2d82ee[_0xaf1f16(0x1e4)]&&_0x33cea5[_0xaf1f16(0x26b)]==_0x2d82ee[_0xaf1f16(0x2ea)]&&(_0x33cea5[_0xaf1f16(0x253)]=Math[_0xaf1f16(0x201)](0x0,Math['abs'](_0x33cea5[_0xaf1f16(0x253)])-Math['abs'](_0x2d82ee[_0xaf1f16(0x242)])));});return _0x331e71;});Promise[_0x20ea66(0x2e3)](_0x17a936)[_0x20ea66(0x250)](async _0x449435=>{var _0x86358f=_0x20ea66;try{for(const _0x46fedc of _0x449435){await _0x46fedc[_0x86358f(0x234)]();}_0x42a5b[_0x86358f(0x269)]=_0x86358f(0x236);const _0x4ff1a0=await _0x42a5b[_0x86358f(0x234)](),_0x40e0d8=await master_shop['find'](),_0x45f5f2=await email_settings[_0x86358f(0x20c)](),_0x5ab2a9=await supervisor_settings[_0x86358f(0x27e)]();var _0x297c3b=_0x42a5b['sale_product'],_0x2abd96='',_0x137e51;for(_0x137e51 in _0x297c3b){_0x2abd96+=_0x86358f(0x29e)+_0x86358f(0x1e3)+_0x297c3b[_0x137e51][_0x86358f(0x2e1)]+_0x86358f(0x29b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x297c3b[_0x137e51]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x297c3b[_0x137e51][_0x86358f(0x242)]+'</td>'+_0x86358f(0x1e3)+_0x297c3b[_0x137e51][_0x86358f(0x28d)]+_0x86358f(0x29b)+_0x86358f(0x1e3)+_0x297c3b[_0x137e51][_0x86358f(0x2e6)]+_0x86358f(0x29b)+_0x86358f(0x1e3)+_0x42a5b[_0x86358f(0x296)]+_0x86358f(0x29b)+_0x86358f(0x1e3)+_0x297c3b[_0x137e51][_0x86358f(0x1ed)]+_0x86358f(0x29b)+_0x86358f(0x1e3)+_0x297c3b[_0x137e51][_0x86358f(0x2a9)]+_0x297c3b[_0x137e51]['rack']+_0x297c3b[_0x137e51][_0x86358f(0x29f)]+_0x297c3b[_0x137e51][_0x86358f(0x1e0)]+_0x297c3b[_0x137e51][_0x86358f(0x2c2)][0x0]+_0x297c3b[_0x137e51]['floorlevel']+'</td>',_0x86358f(0x1f8);}let _0x19f7bd=nodemailer['createTransport']({'host':_0x45f5f2[_0x86358f(0x2a4)],'port':Number(_0x45f5f2[_0x86358f(0x227)]),'secure':![],'auth':{'user':_0x45f5f2[_0x86358f(0x1e2)],'pass':_0x45f5f2[_0x86358f(0x2d5)]}}),_0x16f680={'from':_0x45f5f2[_0x86358f(0x1e2)],'to':_0x5ab2a9[0x0][_0x86358f(0x210)],'subject':_0x86358f(0x222),'attachments':[{'filename':_0x86358f(0x270),'path':__dirname+'/../public'+_0x86358f(0x29a)+_0x40e0d8[0x0][_0x86358f(0x22b)],'cid':_0x86358f(0x224)}],'html':_0x86358f(0x1fb)+_0x86358f(0x287)+_0x86358f(0x259)+'<div>'+_0x86358f(0x295)+_0x86358f(0x1f1)+_0x86358f(0x2d9)+'</div>'+_0x86358f(0x1f1)+_0x86358f(0x218)+_0x40e0d8[0x0][_0x86358f(0x1f7)]+_0x86358f(0x1ee)+_0x86358f(0x28e)+_0x86358f(0x28e)+_0x86358f(0x2f2)+_0x86358f(0x1f1)+_0x86358f(0x211)+'\x20Order\x20Number\x20:\x20'+_0x42a5b[_0x86358f(0x1e4)]+'\x20'+_0x86358f(0x237)+'\x20Order\x20Date\x20:\x20'+_0x42a5b[_0x86358f(0x2a6)]+'\x20'+'</span>'+_0x86358f(0x2bc)+_0x86358f(0x28e)+_0x86358f(0x23e)+_0x86358f(0x2ed)+_0x86358f(0x29e)+_0x86358f(0x245)+_0x86358f(0x285)+_0x86358f(0x2dd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x86358f(0x252)+_0x86358f(0x281)+_0x86358f(0x1fa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x86358f(0x1f8)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2abd96+'\x20'+_0x86358f(0x20f)+_0x86358f(0x25a)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x40e0d8[0x0]['site_title']+_0x86358f(0x2bc)+_0x86358f(0x28e)+_0x86358f(0x28e)+'</body></html>'};_0x19f7bd[_0x86358f(0x2ca)](_0x16f680,function(_0x419245,_0x2d1d68){var _0x548fea=_0x86358f;_0x419245?(console[_0x548fea(0x1de)](_0x419245),console[_0x548fea(0x1de)](_0x548fea(0x1e1))):console[_0x548fea(0x1de)](_0x548fea(0x283));}),_0x426b66['flash'](_0x86358f(0x212),_0x86358f(0x267)),_0x23677a[_0x86358f(0x268)](_0x86358f(0x2d7)+_0x4ad781);}catch(_0x38b1c7){console[_0x86358f(0x2b0)](_0x38b1c7),_0x23677a[_0x86358f(0x2ad)](0x1f4)['json']({'error':_0x86358f(0x219)});}})[_0x20ea66(0x2a1)](_0x18376d=>{var _0x8482ff=_0x20ea66;console[_0x8482ff(0x2b0)](_0x18376d),_0x23677a[_0x8482ff(0x2ad)](0x1f4)[_0x8482ff(0x221)]({'error':'An\x20error\x20occurred.'});});}catch(_0x2bb762){console[_0x20ea66(0x1de)](_0x2bb762);}}),router['get'](a0_0x4e76ac(0x2e9),auth,async(_0x461ad2,_0x7dc235)=>{var _0x165cfb=a0_0x4e76ac;try{const {username:_0x31aac6,email:_0x148dfb,role:_0x2b2eb0}=_0x461ad2[_0x165cfb(0x2ef)],_0x28eb85=_0x461ad2[_0x165cfb(0x2ef)],_0x382ff5=await profile[_0x165cfb(0x20c)]({'email':_0x28eb85['email']}),_0x11c7f7=await master_shop[_0x165cfb(0x27e)](),_0x46ff79=_0x461ad2[_0x165cfb(0x24d)]['id'],_0x44b2eb=await sales[_0x165cfb(0x2f3)](_0x46ff79);var _0x5ff18f=[_0x165cfb(0x1fc),'Enclosed'];const _0x39ca5d=await warehouse[_0x165cfb(0x2a7)]([{'$match':{'name':_0x44b2eb[_0x165cfb(0x296)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x165cfb(0x260)},{'$group':{'_id':_0x165cfb(0x1eb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x165cfb(0x2cd)},'type':{'$first':_0x165cfb(0x26c)},'floorlevel':{'$first':_0x165cfb(0x2eb)},'primary_code':{'$first':_0x165cfb(0x284)},'secondary_code':{'$first':_0x165cfb(0x2b7)},'product_code':{'$first':_0x165cfb(0x2de)},'storage':{'$first':_0x165cfb(0x248)},'rack':{'$first':_0x165cfb(0x29c)}}}]),_0x1866a1=await customer[_0x165cfb(0x27e)]({});let _0x15d5bc;if(_0x28eb85[_0x165cfb(0x208)]==_0x165cfb(0x280)){const _0x39481d=await staff[_0x165cfb(0x20c)]({'email':_0x28eb85[_0x165cfb(0x1e2)]});_0x15d5bc=await warehouse[_0x165cfb(0x2a7)]([{'$match':{'status':_0x165cfb(0x2c8),'name':_0x39481d[_0x165cfb(0x2d0)],'warehouse_category':_0x165cfb(0x21b)}},{'$group':{'_id':_0x165cfb(0x290),'name':{'$first':_0x165cfb(0x290)}}}]);}else _0x15d5bc=await warehouse[_0x165cfb(0x2a7)]([{'$match':{'status':_0x165cfb(0x2c8),'warehouse_category':_0x165cfb(0x21b)}},{'$group':{'_id':_0x165cfb(0x290),'name':{'$first':_0x165cfb(0x290)}}}]);const _0x2efd05=await product['find']({});if(_0x11c7f7[0x0][_0x165cfb(0x25f)]==_0x165cfb(0x2a5)){var _0x3b72a0=users[_0x165cfb(0x251)];console[_0x165cfb(0x1de)](_0x3b72a0);}else{if(_0x11c7f7[0x0]['language']==_0x165cfb(0x291))var _0x3b72a0=users[_0x165cfb(0x291)];else{if(_0x11c7f7[0x0][_0x165cfb(0x25f)]==_0x165cfb(0x2db))var _0x3b72a0=users[_0x165cfb(0x2db)];else{if(_0x11c7f7[0x0]['language']==_0x165cfb(0x207))var _0x3b72a0=users[_0x165cfb(0x207)];else{if(_0x11c7f7[0x0][_0x165cfb(0x25f)]=='French')var _0x3b72a0=users[_0x165cfb(0x2ec)];else{if(_0x11c7f7[0x0][_0x165cfb(0x25f)]==_0x165cfb(0x1ef))var _0x3b72a0=users[_0x165cfb(0x298)];else{if(_0x11c7f7[0x0][_0x165cfb(0x25f)]==_0x165cfb(0x2df))var _0x3b72a0=users[_0x165cfb(0x2df)];else{if(_0x11c7f7[0x0][_0x165cfb(0x25f)]==_0x165cfb(0x279))var _0x3b72a0=users[_0x165cfb(0x209)];}}}}}}}_0x7dc235[_0x165cfb(0x2cb)](_0x165cfb(0x2c1),{'success':_0x461ad2[_0x165cfb(0x2b5)]('success'),'errors':_0x461ad2[_0x165cfb(0x2b5)](_0x165cfb(0x261)),'role':_0x28eb85,'profile':_0x382ff5,'customer':_0x1866a1,'warehouse':_0x15d5bc,'product':_0x39ca5d,'user':_0x44b2eb,'master_shop':_0x11c7f7,'unit':_0x2efd05,'language':_0x3b72a0});}catch(_0x1f4c9a){console[_0x165cfb(0x1de)](_0x1f4c9a);}}),router[a0_0x4e76ac(0x2aa)](a0_0x4e76ac(0x2e9),auth,async(_0x4f76cf,_0x179598)=>{var _0x2ee50e=a0_0x4e76ac;try{const _0x56c034=_0x4f76cf[_0x2ee50e(0x24d)]['id'],_0x209e39=await sales[_0x2ee50e(0x20c)]({'_id':_0x4f76cf['params']['id']}),_0x2d33e9=await warehouse['findOne']({'name':_0x209e39[_0x2ee50e(0x296)],'room':_0x4f76cf['body'][_0x2ee50e(0x277)]}),{invoice:_0x1f791f,date:_0x40f52d,warehouse_name:_0x1678c8,product_name:_0x25d7ce,stock:_0x27bbee,quantity:_0x4d0b5a,note:_0x543955,room:_0x5a5811,customer:_0x239b93,SCRN:_0x207f26}=_0x4f76cf[_0x2ee50e(0x200)];if(typeof _0x25d7ce==_0x2ee50e(0x21e))var _0x381008=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x2e1)]],_0x33e5ef=[_0x4f76cf[_0x2ee50e(0x200)]['stock']],_0x1deb48=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x26e)]],_0x33857c=[_0x4f76cf['body'][_0x2ee50e(0x249)]],_0x275a96=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x265)]],_0xd2f28d=[_0x4f76cf['body']['prod_code']],_0x376664=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x274)]],_0x312062=[_0x4f76cf[_0x2ee50e(0x200)]['primary_unit']],_0x11c09d=[_0x4f76cf[_0x2ee50e(0x200)]['secondary_unit']],_0x3c7c72=[_0x4f76cf[_0x2ee50e(0x200)]['batch_code']],_0x4855f9=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x202)]],_0x17cbed=[_0x4f76cf['body'][_0x2ee50e(0x2ae)]],_0x591929=[_0x4f76cf[_0x2ee50e(0x200)]['production_date']],_0x5e82b7=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x21a)]],_0x325394=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x25c)]],_0x133f78=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x29d)]],_0x4f28b9=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x23c)]],_0x1033df=[_0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x242)]],_0x29dec9=[_0x4f76cf['body']['RoomAssigned']];else var _0x381008=[..._0x4f76cf[_0x2ee50e(0x200)]['product_name']],_0x33e5ef=[..._0x4f76cf[_0x2ee50e(0x200)]['stock']],_0x1deb48=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x26e)]],_0x33857c=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x249)]],_0x275a96=[..._0x4f76cf['body'][_0x2ee50e(0x265)]],_0xd2f28d=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x266)]],_0x376664=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x274)]],_0x312062=[..._0x4f76cf[_0x2ee50e(0x200)]['primary_unit']],_0x11c09d=[..._0x4f76cf[_0x2ee50e(0x200)]['secondary_unit']],_0x3c7c72=[..._0x4f76cf[_0x2ee50e(0x200)]['batch_code']],_0x4855f9=[..._0x4f76cf[_0x2ee50e(0x200)]['expiry_date']],_0x17cbed=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x2ae)]],_0x591929=[..._0x4f76cf[_0x2ee50e(0x200)]['production_date']],_0x5e82b7=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x21a)]],_0x325394=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x25c)]],_0x133f78=[..._0x4f76cf[_0x2ee50e(0x200)][_0x2ee50e(0x29d)]],_0x4f28b9=[..._0x4f76cf['body'][_0x2ee50e(0x23c)]],_0x1033df=[..._0x4f76cf[_0x2ee50e(0x200)]['quantity']],_0x29dec9=[..._0x4f76cf['body'][_0x2ee50e(0x271)]];const _0x371dcc=_0x381008[_0x2ee50e(0x2d6)](_0x4b4aac=>{return _0x4b4aac={'product_name':_0x4b4aac};});_0x33e5ef[_0x2ee50e(0x1f3)]((_0x343109,_0xbe3714)=>{var _0x585966=_0x2ee50e;_0x371dcc[_0xbe3714][_0x585966(0x243)]=Math['abs'](_0x343109);}),_0x1deb48[_0x2ee50e(0x1f3)]((_0xb0cfc1,_0x3ef6b4)=>{_0x371dcc[_0x3ef6b4]['quantity']=_0xb0cfc1;}),_0x33857c[_0x2ee50e(0x1f3)]((_0x1ef90f,_0x2a8c64)=>{var _0x19001e=_0x2ee50e;_0x371dcc[_0x2a8c64][_0x19001e(0x249)]=_0x1ef90f;}),_0x275a96['forEach']((_0x14f5ca,_0x5f591c)=>{var _0x390b5a=_0x2ee50e;_0x371dcc[_0x5f591c][_0x390b5a(0x265)]=_0x14f5ca;}),_0xd2f28d[_0x2ee50e(0x1f3)]((_0x16c008,_0x568d20)=>{var _0x15f3f7=_0x2ee50e;_0x371dcc[_0x568d20][_0x15f3f7(0x2b9)]=_0x16c008;}),_0x376664[_0x2ee50e(0x1f3)]((_0xcbf3ee,_0x57aa66)=>{var _0x1ea5c0=_0x2ee50e;_0x29dec9[_0x1ea5c0(0x1f3)]((_0xba4cf5,_0x11ffe8)=>{var _0x2ef574=_0x1ea5c0;if(_0xba4cf5==_0x2ef574(0x289)&&_0x57aa66==_0x11ffe8){var _0x353764=_0xcbf3ee['slice'](0x3);_0x371dcc[_0x57aa66][_0x2ef574(0x2a9)]=_0xcbf3ee[0x0],_0x371dcc[_0x57aa66][_0x2ef574(0x2b2)]=_0xcbf3ee[0x1],_0x371dcc[_0x57aa66][_0x2ef574(0x29f)]=0x0,_0x371dcc[_0x57aa66][_0x2ef574(0x1e0)]=0x0,_0x371dcc[_0x57aa66][_0x2ef574(0x2c2)]=_0x2ef574(0x2b8),_0x371dcc[_0x57aa66]['floorlevel']=_0x353764;}else{if(_0xba4cf5==_0x2ef574(0x2f0)&&_0x57aa66==_0x11ffe8){var _0x353764=_0xcbf3ee[_0x2ef574(0x25b)](0x3);_0x371dcc[_0x57aa66][_0x2ef574(0x2a9)]=_0xcbf3ee[0x0],_0x371dcc[_0x57aa66][_0x2ef574(0x2b2)]=_0xcbf3ee[0x1],_0x371dcc[_0x57aa66][_0x2ef574(0x29f)]=0x0,_0x371dcc[_0x57aa66][_0x2ef574(0x1e0)]=0x0,_0x371dcc[_0x57aa66]['type']='Floor',_0x371dcc[_0x57aa66]['floorlevel']=_0xcbf3ee[0x5];}else{if(_0x57aa66==_0x11ffe8){var _0x2e2325;if(_0xcbf3ee[0x4]=='L')_0x2e2325='Level';else _0xcbf3ee[0x4]=='F'&&(_0x2e2325='Floor');_0x371dcc[_0x57aa66][_0x2ef574(0x2a9)]=_0xcbf3ee[0x0],_0x371dcc[_0x57aa66][_0x2ef574(0x2b2)]=_0xcbf3ee[0x1],_0x371dcc[_0x57aa66][_0x2ef574(0x29f)]=_0xcbf3ee[0x2],_0x371dcc[_0x57aa66]['bin']=_0xcbf3ee[0x3],_0x371dcc[_0x57aa66][_0x2ef574(0x2c2)]=_0x2e2325,_0x371dcc[_0x57aa66][_0x2ef574(0x2d8)]=_0xcbf3ee[0x5];}}}});}),_0x312062[_0x2ee50e(0x1f3)]((_0x5d8af6,_0x14072a)=>{var _0x265363=_0x2ee50e;_0x371dcc[_0x14072a][_0x265363(0x28d)]=_0x5d8af6;}),_0x11c09d[_0x2ee50e(0x1f3)]((_0x524d00,_0x147692)=>{var _0x1d02c0=_0x2ee50e;_0x371dcc[_0x147692][_0x1d02c0(0x2e6)]=_0x524d00;}),_0x3c7c72['forEach']((_0x4900c3,_0x3985f3)=>{var _0x584e83=_0x2ee50e;_0x371dcc[_0x3985f3][_0x584e83(0x2b1)]=_0x4900c3;}),_0x4855f9['forEach']((_0x1bb3da,_0x5a800b)=>{var _0x457b1a=_0x2ee50e;_0x371dcc[_0x5a800b][_0x457b1a(0x202)]=_0x1bb3da;}),_0x17cbed[_0x2ee50e(0x1f3)]((_0x454cd7,_0x2da8b4)=>{var _0x593305=_0x2ee50e;_0x371dcc[_0x2da8b4][_0x593305(0x21d)]=_0x454cd7;}),_0x591929[_0x2ee50e(0x1f3)]((_0x142edf,_0x31bce9)=>{_0x371dcc[_0x31bce9]['production_date']=_0x142edf;}),_0x5e82b7[_0x2ee50e(0x1f3)]((_0x2094e6,_0x37bd71)=>{var _0x9be58c=_0x2ee50e;_0x371dcc[_0x37bd71]['requested_qty']=Math[_0x9be58c(0x255)](_0x2094e6);}),_0x325394[_0x2ee50e(0x1f3)]((_0x27af5e,_0x55cf6c)=>{var _0x146df4=_0x2ee50e;_0x371dcc[_0x55cf6c][_0x146df4(0x25c)]=_0x27af5e;}),_0x133f78[_0x2ee50e(0x1f3)]((_0x5f2691,_0x514ffa)=>{_0x371dcc[_0x514ffa]['delivery_code']=_0x5f2691;}),_0x4f28b9[_0x2ee50e(0x1f3)]((_0x214acc,_0x5f2c52)=>{var _0x5a5c27=_0x2ee50e;_0x371dcc[_0x5f2c52][_0x5a5c27(0x23c)]=_0x214acc;}),_0x1033df['forEach']((_0xfc88ad,_0x4592b8)=>{var _0x2881e7=_0x2ee50e;_0x371dcc[_0x4592b8][_0x2881e7(0x246)]=_0xfc88ad;}),_0x29dec9[_0x2ee50e(0x1f3)]((_0x54c905,_0x4c5b21)=>{var _0x441235=_0x2ee50e;_0x371dcc[_0x4c5b21][_0x441235(0x1ed)]=_0x54c905;});var _0x1c74ea=0x0;_0x371dcc[_0x2ee50e(0x1f3)](_0x1e9d45=>{var _0x1381e3=_0x2ee50e;console[_0x1381e3(0x1de)](_0x1381e3(0x2d4),_0x1e9d45),(parseInt(_0x1e9d45[_0x1381e3(0x243)])<parseInt(_0x1e9d45[_0x1381e3(0x242)])||parseInt(_0x1e9d45[_0x1381e3(0x242)])==0x0)&&_0x1c74ea++;});if(_0x1c74ea!=0x0)return _0x4f76cf[_0x2ee50e(0x2b5)]('errors',_0x2ee50e(0x226)),_0x179598[_0x2ee50e(0x268)]('back');const _0x47058c=_0x371dcc[_0x2ee50e(0x2bf)](_0x20ea2c=>_0x20ea2c[_0x2ee50e(0x242)]!=='0'&&_0x20ea2c[_0x2ee50e(0x242)]!=='');_0x209e39[_0x2ee50e(0x1e4)]=_0x1f791f,_0x209e39[_0x2ee50e(0x24a)]=_0x239b93,_0x209e39['date']=_0x40f52d,_0x209e39['warehouse_name']=_0x1678c8,_0x209e39[_0x2ee50e(0x2a2)]=_0x47058c,_0x209e39[_0x2ee50e(0x24e)]=_0x543955,_0x209e39[_0x2ee50e(0x276)]=_0x207f26,_0x209e39[_0x2ee50e(0x269)]=_0x2ee50e(0x241),_0x209e39['isAllowEdit']=_0x2ee50e(0x241);const _0x447250=await _0x209e39['save']();_0x4f76cf[_0x2ee50e(0x2b5)](_0x2ee50e(0x212),_0x2ee50e(0x267)),_0x179598[_0x2ee50e(0x268)](_0x2ee50e(0x204));}catch(_0x4691ee){console[_0x2ee50e(0x1de)](_0x4691ee);}}),router[a0_0x4e76ac(0x2aa)](a0_0x4e76ac(0x20d),auth,async(_0x5a3d41,_0x2c901e)=>{var _0x45b058=a0_0x4e76ac;try{const _0x539117=_0x5a3d41[_0x45b058(0x24d)]['id'],{invoice:_0x58878c,customer:_0x15b3b2,receivable_amount:_0x42ec4a,received_amount:_0x37e3b1}=_0x5a3d41[_0x45b058(0x200)],_0x1efd5a=await sales[_0x45b058(0x2f3)](_0x539117);console[_0x45b058(0x1de)](_0x1efd5a);var _0x366bff=_0x42ec4a-_0x37e3b1;console[_0x45b058(0x1de)](_0x37e3b1),_0x1efd5a['received_amount']=parseFloat(_0x37e3b1)+parseFloat(_0x1efd5a[_0x45b058(0x20b)]),_0x1efd5a['due_amount']=_0x366bff,console[_0x45b058(0x1de)](_0x1efd5a);const _0x5a0016=await _0x1efd5a[_0x45b058(0x234)](),_0x35db23=await c_payment_data[_0x45b058(0x20c)]({'invoice':_0x58878c});_0x35db23['amount']=_0x366bff,await _0x35db23[_0x45b058(0x234)]();let _0x4c14b2=new Date(),_0x55cbb8=('0'+_0x4c14b2['getDate']())[_0x45b058(0x25b)](-0x2),_0x173db4=('0'+(_0x4c14b2[_0x45b058(0x2c7)]()+0x1))['slice'](-0x2),_0x2089cf=_0x4c14b2[_0x45b058(0x2da)](),_0x563912=_0x2089cf+'-'+_0x173db4+'-'+_0x55cbb8;const _0x2e8279=new customer_payment({'invoice':_0x58878c,'date':_0x2089cf+'-'+_0x173db4+'-'+_0x55cbb8,'customer':_0x15b3b2,'reason':_0x45b058(0x247),'amount':_0x37e3b1}),_0x4512b8=await _0x2e8279['save']();_0x5a3d41[_0x45b058(0x2b5)]('success',_0x45b058(0x235)),_0x2c901e[_0x45b058(0x268)](_0x45b058(0x204));}catch(_0x1fc5d6){console[_0x45b058(0x1de)](_0x1fc5d6);}}),router[a0_0x4e76ac(0x225)](a0_0x4e76ac(0x297),auth,async(_0x2da66a,_0x7011ec)=>{var _0x3be30f=a0_0x4e76ac;try{const {username:_0x56d71e,email:_0x78c33e,role:_0x4e1612}=_0x2da66a[_0x3be30f(0x2ef)],_0x3195d3=_0x2da66a[_0x3be30f(0x2ef)],_0xf50ed4=await profile['findOne']({'email':_0x3195d3['email']}),_0x41f9c4=await master_shop[_0x3be30f(0x27e)]();console['log'](_0x3be30f(0x2b3),_0x41f9c4);const _0x4c8789=_0x2da66a[_0x3be30f(0x24d)]['id'],_0x509058=await sales[_0x3be30f(0x2f3)](_0x4c8789);console[_0x3be30f(0x1de)](_0x509058);const _0x2597bd=await customer[_0x3be30f(0x20c)]({'name':_0x509058[_0x3be30f(0x24a)]});console['log'](_0x2597bd);if(_0x41f9c4[0x0][_0x3be30f(0x25f)]==_0x3be30f(0x2a5)){var _0x303c67=users[_0x3be30f(0x251)];console['log'](_0x303c67);}else{if(_0x41f9c4[0x0][_0x3be30f(0x25f)]==_0x3be30f(0x291))var _0x303c67=users[_0x3be30f(0x291)];else{if(_0x41f9c4[0x0][_0x3be30f(0x25f)]==_0x3be30f(0x2db))var _0x303c67=users[_0x3be30f(0x2db)];else{if(_0x41f9c4[0x0]['language']==_0x3be30f(0x207))var _0x303c67=users[_0x3be30f(0x207)];else{if(_0x41f9c4[0x0][_0x3be30f(0x25f)]==_0x3be30f(0x2ec))var _0x303c67=users['French'];else{if(_0x41f9c4[0x0][_0x3be30f(0x25f)]==_0x3be30f(0x1ef))var _0x303c67=users[_0x3be30f(0x298)];else{if(_0x41f9c4[0x0][_0x3be30f(0x25f)]=='Chinese')var _0x303c67=users[_0x3be30f(0x2df)];else{if(_0x41f9c4[0x0][_0x3be30f(0x25f)]==_0x3be30f(0x279))var _0x303c67=users['Arabic'];}}}}}}}_0x7011ec[_0x3be30f(0x2cb)](_0x3be30f(0x22c),{'success':_0x2da66a['flash'](_0x3be30f(0x212)),'errors':_0x2da66a[_0x3be30f(0x2b5)](_0x3be30f(0x261)),'role':_0x3195d3,'profile':_0xf50ed4,'master_shop':_0x41f9c4,'customers':_0x2597bd,'sales':_0x509058,'language':_0x303c67});}catch(_0x391541){console['log'](_0x391541);}}),router[a0_0x4e76ac(0x225)](a0_0x4e76ac(0x1f6),auth,async(_0x27c1ce,_0x3bc8a1)=>{var _0x46e0ac=a0_0x4e76ac;try{const {username:_0x312f3e,email:_0x5f3f2c,role:_0x553978}=_0x27c1ce[_0x46e0ac(0x2ef)],_0x1bea21=_0x27c1ce[_0x46e0ac(0x2ef)],_0x169a4a=await profile[_0x46e0ac(0x20c)]({'email':_0x1bea21[_0x46e0ac(0x1e2)]}),_0x447527=await master_shop['find']();console[_0x46e0ac(0x1de)](_0x46e0ac(0x2b3),_0x447527);const _0x3c384d=_0x27c1ce['params']['id'];console['log'](_0x3c384d);const _0x12e0ba=await sales[_0x46e0ac(0x2f3)](_0x3c384d);console['log'](_0x46e0ac(0x278),_0x12e0ba);const _0x62efd3=await warehouse[_0x46e0ac(0x2a7)]([{'$match':{'name':_0x46e0ac(0x24c),'room':_0x46e0ac(0x28f)}},{'$unwind':_0x46e0ac(0x260)},{'$group':{'_id':_0x46e0ac(0x1eb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x46e0ac(0x216)},'level':{'$first':_0x46e0ac(0x1f2)},'isle':{'$first':_0x46e0ac(0x28a)},'pallet':{'$first':_0x46e0ac(0x2c9)},'primary_code':{'$first':_0x46e0ac(0x284)},'secondary_code':{'$first':_0x46e0ac(0x2b7)},'product_code':{'$first':_0x46e0ac(0x2de)}}}]);console['log'](_0x46e0ac(0x27b),_0x62efd3);const _0x3166f1=await product['find']({});warehouse_data=await warehouse[_0x46e0ac(0x2a7)]([{'$match':{'status':_0x46e0ac(0x2c8),'name':_0x46e0ac(0x24c),'warehouse_category':_0x46e0ac(0x21b)}},{'$group':{'_id':_0x46e0ac(0x290),'name':{'$first':_0x46e0ac(0x290)}}},{'$sort':{'name':0x1}}]);var _0x18c80b=[_0x46e0ac(0x28f)];if(_0x447527[0x0][_0x46e0ac(0x25f)]==_0x46e0ac(0x2a5)){var _0x421e6f=users[_0x46e0ac(0x251)];console[_0x46e0ac(0x1de)](_0x421e6f);}else{if(_0x447527[0x0][_0x46e0ac(0x25f)]==_0x46e0ac(0x291))var _0x421e6f=users[_0x46e0ac(0x291)];else{if(_0x447527[0x0][_0x46e0ac(0x25f)]==_0x46e0ac(0x2db))var _0x421e6f=users[_0x46e0ac(0x2db)];else{if(_0x447527[0x0][_0x46e0ac(0x25f)]=='Spanish')var _0x421e6f=users[_0x46e0ac(0x207)];else{if(_0x447527[0x0]['language']==_0x46e0ac(0x2ec))var _0x421e6f=users[_0x46e0ac(0x2ec)];else{if(_0x447527[0x0]['language']==_0x46e0ac(0x1ef))var _0x421e6f=users[_0x46e0ac(0x298)];else{if(_0x447527[0x0][_0x46e0ac(0x25f)]==_0x46e0ac(0x2df))var _0x421e6f=users[_0x46e0ac(0x2df)];else{if(_0x447527[0x0][_0x46e0ac(0x25f)]==_0x46e0ac(0x279))var _0x421e6f=users[_0x46e0ac(0x209)];}}}}}}}_0x3bc8a1[_0x46e0ac(0x2cb)](_0x46e0ac(0x2f1),{'success':_0x27c1ce['flash'](_0x46e0ac(0x212)),'errors':_0x27c1ce[_0x46e0ac(0x2b5)]('errors'),'role':_0x1bea21,'profile':_0x169a4a,'user':_0x12e0ba,'stock':_0x62efd3,'master_shop':_0x447527,'unit':_0x3166f1,'language':_0x421e6f,'warehouses':warehouse_data,'rooms':_0x18c80b});}catch(_0x49cf8e){console[_0x46e0ac(0x1de)](_0x49cf8e),_0x3bc8a1['status'](0xc8)['json']({'message':_0x49cf8e[_0x46e0ac(0x215)]});}}),router[a0_0x4e76ac(0x2aa)](a0_0x4e76ac(0x1f6),auth,async(_0xc78dc9,_0x1d20f3)=>{var _0x42b700=a0_0x4e76ac;try{const {invoice:_0x261f0a,date:_0x4d56fd,warehouse_name:_0x1f78e5,product_name:_0x41095c,primary_code:_0x3d2426,secondary_code:_0x225593,product_code:_0x3068d0,sales_quantity:_0x3ba1e3,stocks:_0x407374,return_qty:_0x597980,Room_name:_0x3d9c8d,to_warehouse_name:_0x90ed86,to_Roomname:_0x4d0d3c,to_Room_name:_0x41839c,note:_0x21e3b2,level:_0x352a3d,isle:_0x2c3447,pallet:_0x3b694c}=_0xc78dc9['body'];if(typeof _0x41095c==_0x42b700(0x21e))var _0x231b77=[_0xc78dc9[_0x42b700(0x200)]['product_name']],_0x186477=[_0xc78dc9[_0x42b700(0x200)][_0x42b700(0x249)]],_0x4dbff2=[_0xc78dc9[_0x42b700(0x200)]['secondary_code']],_0x25829e=[_0xc78dc9['body'][_0x42b700(0x2b9)]],_0xdabd60=[_0xc78dc9[_0x42b700(0x200)][_0x42b700(0x231)]],_0x2e95a0=[_0xc78dc9['body'][_0x42b700(0x1e5)]],_0x2c82f4=[_0xc78dc9[_0x42b700(0x200)]['return_qty']],_0x5203c5=[_0xc78dc9[_0x42b700(0x200)][_0x42b700(0x29f)]],_0x46f476=[_0xc78dc9['body']['bin']],_0x2b99c9=[_0xc78dc9[_0x42b700(0x200)][_0x42b700(0x21c)]],_0x3fa233=[_0xc78dc9['body'][_0x42b700(0x2d8)]];else var _0x231b77=[..._0xc78dc9[_0x42b700(0x200)]['product_name']],_0x186477=[..._0xc78dc9[_0x42b700(0x200)][_0x42b700(0x249)]],_0x4dbff2=[..._0xc78dc9[_0x42b700(0x200)][_0x42b700(0x265)]],_0x25829e=[..._0xc78dc9['body'][_0x42b700(0x2b9)]],_0xdabd60=[..._0xc78dc9[_0x42b700(0x200)]['sales_quantity']],_0x2e95a0=[..._0xc78dc9[_0x42b700(0x200)][_0x42b700(0x1e5)]],_0x2c82f4=[..._0xc78dc9['body'][_0x42b700(0x2b4)]],_0x5203c5=[..._0xc78dc9[_0x42b700(0x200)][_0x42b700(0x29f)]],_0x46f476=[..._0xc78dc9[_0x42b700(0x200)]['bin']],_0x2b99c9=[..._0xc78dc9[_0x42b700(0x200)][_0x42b700(0x21c)]],_0x3fa233=[..._0xc78dc9[_0x42b700(0x200)][_0x42b700(0x2d8)]];const _0x851bd7=_0x231b77[_0x42b700(0x2d6)](_0xd714c0=>{return _0xd714c0={'product_name':_0xd714c0};});_0x186477['forEach']((_0x124f84,_0x2aaf1a)=>{var _0x6e4cec=_0x42b700;_0x851bd7[_0x2aaf1a][_0x6e4cec(0x249)]=_0x124f84;}),_0x4dbff2[_0x42b700(0x1f3)]((_0x3b898c,_0x29a398)=>{var _0xaf6c65=_0x42b700;_0x851bd7[_0x29a398][_0xaf6c65(0x265)]=_0x3b898c;}),_0x25829e[_0x42b700(0x1f3)]((_0x23ae5f,_0x1924bd)=>{var _0x3edf56=_0x42b700;_0x851bd7[_0x1924bd][_0x3edf56(0x2b9)]=_0x23ae5f;}),_0xdabd60[_0x42b700(0x1f3)]((_0x26551f,_0x3b64f3)=>{var _0xc7eda0=_0x42b700;_0x851bd7[_0x3b64f3][_0xc7eda0(0x22f)]=_0x26551f;}),_0x2e95a0['forEach']((_0x33a23a,_0x1dc149)=>{var _0x1cc78c=_0x42b700;_0x851bd7[_0x1dc149][_0x1cc78c(0x243)]=_0x33a23a;}),_0x2c82f4[_0x42b700(0x1f3)]((_0x4c1b25,_0x363272)=>{var _0x4483e0=_0x42b700;_0x851bd7[_0x363272][_0x4483e0(0x2b4)]=_0x4c1b25;}),_0x5203c5[_0x42b700(0x1f3)]((_0x5ed116,_0x524a81)=>{var _0x4ba75b=_0x42b700;_0x851bd7[_0x524a81][_0x4ba75b(0x29f)]=_0x5ed116;}),_0x46f476[_0x42b700(0x1f3)]((_0x3cc45f,_0x2a96b3)=>{var _0x1ea02a=_0x42b700;_0x851bd7[_0x2a96b3][_0x1ea02a(0x1e0)]=_0x3cc45f;}),_0x2b99c9[_0x42b700(0x1f3)]((_0x15b32b,_0x446a44)=>{var _0x14a5dd=_0x42b700;_0x851bd7[_0x446a44][_0x14a5dd(0x2c2)]=_0x15b32b;}),_0x3fa233[_0x42b700(0x1f3)]((_0x4ef4d1,_0xd79115)=>{var _0x18736c=_0x42b700;_0x851bd7[_0xd79115][_0x18736c(0x2d8)]=_0x4ef4d1;});var _0x49ef60=0x0;_0x851bd7[_0x42b700(0x1f3)](_0x563ba2=>{var _0x29859c=_0x42b700;console[_0x29859c(0x1de)](_0x29859c(0x2d4),_0x563ba2),(parseInt(_0x563ba2['sale_qty'])<parseInt(_0x563ba2['return_qty'])||parseInt(_0x563ba2[_0x29859c(0x243)])<parseInt(_0x563ba2['return_qty'])&&parseInt(_0x563ba2['sale_qty'])>parseInt(_0x563ba2[_0x29859c(0x2b4)])||parseInt(_0x563ba2[_0x29859c(0x2b4)])==0x0)&&_0x49ef60++;});if(_0x49ef60!=0x0)return _0xc78dc9['flash'](_0x42b700(0x261),_0x42b700(0x2d1)),_0x1d20f3[_0x42b700(0x268)]('back');const _0x25e2b5=await sales[_0x42b700(0x20c)]({'invoice':_0x261f0a});console['log'](_0x25e2b5),_0x25e2b5[_0x42b700(0x2e2)]=_0x42b700(0x236);const _0x345ff5=await _0x25e2b5[_0x42b700(0x234)](),_0x2b6aec=new sales_return({'invoice':_0x261f0a,'customer':_0xc78dc9[_0x42b700(0x200)][_0x42b700(0x24a)],'date':_0x4d56fd,'warehouse_name':_0x1f78e5,'room':_0x3d9c8d,'ToWarehouse':_0x90ed86,'ToRoom':_0x41839c,'return_sale':_0x851bd7,'note':_0x21e3b2}),_0x3666ef=await _0x2b6aec[_0x42b700(0x234)]();console[_0x42b700(0x1de)](_0x2b6aec);const _0x19f727=await sales_return[_0x42b700(0x20c)]({'invoice':_0x261f0a}),_0x313fa1=await warehouse[_0x42b700(0x20c)]({'name':_0x90ed86,'room':_0x41839c});_0x19f727['return_sale'][_0x42b700(0x1f3)](_0x140576=>{var _0x32ac7b=_0x42b700,_0xb4d574=0x0;const _0x1960b3=_0x313fa1[_0x32ac7b(0x275)][_0x32ac7b(0x2d6)](_0x40919f=>{var _0x26fb6a=_0x32ac7b;_0x40919f[_0x26fb6a(0x2e1)]==_0x140576[_0x26fb6a(0x2e1)]&&_0x40919f[_0x26fb6a(0x2d8)]==_0x140576[_0x26fb6a(0x2d8)]&&_0x40919f[_0x26fb6a(0x2c2)]==_0x140576[_0x26fb6a(0x2c2)]&&_0x40919f[_0x26fb6a(0x1e0)]==_0x140576['bin']&&_0x40919f[_0x26fb6a(0x29f)]==_0x140576[_0x26fb6a(0x29f)]&&(_0x40919f[_0x26fb6a(0x253)]=parseInt(_0x40919f[_0x26fb6a(0x253)])+parseInt(_0x140576[_0x26fb6a(0x2b4)]),_0xb4d574++);});_0xb4d574=='0'&&(_0x313fa1[_0x32ac7b(0x275)]=_0x313fa1[_0x32ac7b(0x275)][_0x32ac7b(0x22d)]({'product_name':_0x140576[_0x32ac7b(0x2e1)],'product_stock':_0x140576[_0x32ac7b(0x2b4)],'primary_code':_0x140576[_0x32ac7b(0x249)],'secondary_code':_0x140576['secondary_code'],'product_code':_0x140576['product_code'],'bay':_0x140576['bay'],'bin':_0x140576[_0x32ac7b(0x1e0)],'type':_0x140576[_0x32ac7b(0x2c2)],'floorlevel':_0x140576['floorlevel']})),console[_0x32ac7b(0x1de)](_0x32ac7b(0x2af),_0x313fa1);}),await _0x313fa1[_0x42b700(0x234)](),console[_0x42b700(0x1de)](_0xc78dc9[_0x42b700(0x200)]);const _0x242c77=new c_payment_data({'invoice':_0x261f0a,'customer':_0xc78dc9['body']['customer'],'reason':_0x42b700(0x1e9)});await _0x242c77[_0x42b700(0x234)]();const _0x378667=await master_shop[_0x42b700(0x27e)]();console[_0x42b700(0x1de)](_0x42b700(0x1f4),_0x378667[0x0][_0x42b700(0x22b)]);const _0x3f5c27=await email_settings[_0x42b700(0x20c)](),_0x55edf4=await customer[_0x42b700(0x20c)]({'name':_0xc78dc9[_0x42b700(0x200)][_0x42b700(0x24a)]});console[_0x42b700(0x1de)]('customer_data',_0x55edf4);_0x378667[0x0][_0x42b700(0x25d)]==0x1?(right_currency=_0x378667[0x0][_0x42b700(0x2ac)],left_currency=''):(right_currency='',left_currency=_0x378667[0x0]['currency']);var _0x50ebe3=_0x231b77,_0x5d7eb9=_0x2c82f4,_0x48e4f1='',_0x3f654b;for(_0x3f654b in _0x50ebe3){_0x48e4f1+=_0x42b700(0x29e)+_0x42b700(0x1e3)+_0x50ebe3[_0x3f654b]+_0x42b700(0x29b)+_0x42b700(0x1e3)+_0x5d7eb9[_0x3f654b]+_0x42b700(0x29b)+_0x42b700(0x1f8);}console[_0x42b700(0x1de)]('product_list',_0x48e4f1);let _0x3540ec=nodemailer[_0x42b700(0x2c3)]({'service':_0x42b700(0x206),'auth':{'user':_0x3f5c27[_0x42b700(0x1e2)],'pass':_0x3f5c27['password']}}),_0x513b54={'from':_0x3f5c27['email'],'to':_0x55edf4[_0x42b700(0x1e2)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x42b700(0x270),'path':__dirname+_0x42b700(0x2ba)+_0x42b700(0x29a)+_0x378667[0x0][_0x42b700(0x22b)],'cid':_0x42b700(0x224)}],'html':_0x42b700(0x1fb)+_0x42b700(0x287)+_0x42b700(0x259)+_0x42b700(0x1f1)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x42b700(0x2d9)+_0x42b700(0x28e)+_0x42b700(0x1f1)+'<h2>\x20'+_0x378667[0x0][_0x42b700(0x1f7)]+_0x42b700(0x1ee)+_0x42b700(0x28e)+_0x42b700(0x28e)+_0x42b700(0x2f2)+_0x42b700(0x1f1)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x42b700(0x24b)+_0x261f0a+'\x20'+_0x42b700(0x237)+'\x20Order\x20Date\x20:\x20'+_0x4d56fd+'\x20'+_0x42b700(0x1fd)+'</h5>'+_0x42b700(0x28e)+_0x42b700(0x23e)+_0x42b700(0x2ed)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x42b700(0x1f5)+_0x42b700(0x1f9)+_0x42b700(0x1f8)+_0x42b700(0x2d2)+_0x42b700(0x1ea)+'\x20'+_0x48e4f1+'\x20'+_0x42b700(0x20f)+_0x42b700(0x25a)+_0x42b700(0x1f1)+'<strong>\x20Regards\x20</strong>'+_0x42b700(0x256)+_0x378667[0x0][_0x42b700(0x1f7)]+_0x42b700(0x2bc)+_0x42b700(0x28e)+_0x42b700(0x28e)+'</body></html>'};_0x3540ec['sendMail'](_0x513b54,function(_0x3d1309,_0x54b74e){var _0x31704b=_0x42b700;_0x3d1309?(console[_0x31704b(0x1de)](_0x3d1309),console['log'](_0x31704b(0x1e1))):console[_0x31704b(0x1de)]('Email\x20sent\x20successfully');}),_0xc78dc9[_0x42b700(0x2b5)](_0x42b700(0x212),_0x42b700(0x205)),_0x1d20f3['redirect'](_0x42b700(0x204));}catch(_0x346c7c){console[_0x42b700(0x1de)](_0x346c7c),_0x1d20f3['status'](0xc8)['json']({'message1':_0x346c7c[_0x42b700(0x215)]});}}),router[a0_0x4e76ac(0x225)](a0_0x4e76ac(0x213),auth,async(_0x1c3fc3,_0x276f61)=>{var _0x58ae92=a0_0x4e76ac;try{const {username:_0x1501e5,email:_0x50206c,role:_0x5ead16}=_0x1c3fc3[_0x58ae92(0x2ef)],_0x586324=_0x1c3fc3[_0x58ae92(0x2ef)],_0x3e67f9=await profile[_0x58ae92(0x20c)]({'email':_0x586324[_0x58ae92(0x1e2)]}),_0x80fce8=await master_shop[_0x58ae92(0x27e)]();console['log'](_0x58ae92(0x2cc),_0x80fce8);const _0x216472=_0x1c3fc3[_0x58ae92(0x24d)]['id'],_0x3945ff=await sales['findById'](_0x216472);console[_0x58ae92(0x1de)](_0x58ae92(0x1e6),_0x3945ff);if(_0x80fce8[0x0]['language']=='English\x20(US)')var _0x146c47=users[_0x58ae92(0x251)];else{if(_0x80fce8[0x0][_0x58ae92(0x25f)]==_0x58ae92(0x291))var _0x146c47=users[_0x58ae92(0x291)];else{if(_0x80fce8[0x0][_0x58ae92(0x25f)]==_0x58ae92(0x2db))var _0x146c47=users[_0x58ae92(0x2db)];else{if(_0x80fce8[0x0]['language']=='Spanish')var _0x146c47=users[_0x58ae92(0x207)];else{if(_0x80fce8[0x0][_0x58ae92(0x25f)]==_0x58ae92(0x2ec))var _0x146c47=users['French'];else{if(_0x80fce8[0x0][_0x58ae92(0x25f)]==_0x58ae92(0x1ef))var _0x146c47=users['Portuguese'];else{if(_0x80fce8[0x0][_0x58ae92(0x25f)]=='Chinese')var _0x146c47=users[_0x58ae92(0x2df)];else{if(_0x80fce8[0x0][_0x58ae92(0x25f)]==_0x58ae92(0x279))var _0x146c47=users[_0x58ae92(0x209)];}}}}}}}_0x276f61[_0x58ae92(0x2cb)](_0x58ae92(0x230),{'success':_0x1c3fc3[_0x58ae92(0x2b5)](_0x58ae92(0x212)),'errors':_0x1c3fc3['flash'](_0x58ae92(0x261)),'role':_0x586324,'profile':_0x3e67f9,'alldata':_0x3945ff,'master_shop':_0x80fce8,'language':_0x146c47});}catch(_0x1b3a3d){console[_0x58ae92(0x1de)](_0x1b3a3d);}}),router[a0_0x4e76ac(0x2aa)](a0_0x4e76ac(0x23b),async(_0x47ba90,_0xf1ec2d)=>{var _0x363300=a0_0x4e76ac;const {product_code:_0x510f24,warehouse_name:_0x106e77,rooms_data:_0x470132,Roomslist:_0x893dc3}=_0x47ba90['body'],_0x48ef3b=_0x893dc3['split'](','),_0x5af30b=[];async function _0x47d723(_0x40b515){var _0x4e9eb2=a0_0x1462;const _0x486bfa=await warehouse['aggregate']([{'$match':{'name':_0x106e77,'room':_0x40b515}},{'$unwind':_0x4e9eb2(0x260)},{'$match':{'product_details.primary_code':_0x510f24}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4e9eb2(0x239)},'product_stock':{'$first':_0x4e9eb2(0x216)},'primary_code':{'$first':_0x4e9eb2(0x284)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x4e9eb2(0x1fe)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4e9eb2(0x26c)},'pallet':{'$first':_0x4e9eb2(0x2eb)},'unit':{'$first':_0x4e9eb2(0x232)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4e9eb2(0x248)},'rack':{'$first':_0x4e9eb2(0x29c)},'expiry_date':{'$first':_0x4e9eb2(0x27a)},'production_date':{'$first':_0x4e9eb2(0x262)},'maxPerUnit':{'$first':_0x4e9eb2(0x23a)},'batch_code':{'$first':_0x4e9eb2(0x2bd)},'product_cat':{'$first':_0x4e9eb2(0x1ff)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4e9eb2(0x254)},'invoice':{'$first':_0x4e9eb2(0x28b)},'actual_qty':{'$first':_0x4e9eb2(0x286)},'actual_uom':{'$first':_0x4e9eb2(0x20e)}}}]),_0x2af91f=await warehouse[_0x4e9eb2(0x2a7)]([{'$match':{'name':_0x106e77,'room':_0x40b515}},{'$unwind':_0x4e9eb2(0x260)},{'$match':{'product_details.secondary_code':_0x510f24}},{'$group':{'_id':_0x4e9eb2(0x1eb),'name':{'$first':_0x4e9eb2(0x239)},'product_stock':{'$first':_0x4e9eb2(0x216)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4e9eb2(0x2b7)},'product_code':{'$first':_0x4e9eb2(0x2de)},'level':{'$first':_0x4e9eb2(0x1fe)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4e9eb2(0x26c)},'pallet':{'$first':_0x4e9eb2(0x2eb)},'unit':{'$first':_0x4e9eb2(0x232)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4e9eb2(0x248)},'rack':{'$first':_0x4e9eb2(0x29c)},'expiry_date':{'$first':_0x4e9eb2(0x27a)},'production_date':{'$first':_0x4e9eb2(0x262)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x4e9eb2(0x2bd)},'product_cat':{'$first':_0x4e9eb2(0x1ff)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4e9eb2(0x254)},'invoice':{'$first':_0x4e9eb2(0x28b)}}}]);if(_0x486bfa[_0x4e9eb2(0x2e8)]>0x0)_0x5af30b[_0x4e9eb2(0x2ce)](_0x486bfa);else _0x2af91f[_0x4e9eb2(0x2e8)]>0x0&&_0x5af30b[_0x4e9eb2(0x2ce)](_0x2af91f);}const _0x2dbcd2=_0x48ef3b[_0x363300(0x2d6)](_0x3f86cf=>_0x47d723(_0x3f86cf));await Promise[_0x363300(0x2e3)](_0x2dbcd2),_0xf1ec2d['json'](_0x5af30b);}),module[a0_0x4e76ac(0x264)]=router;