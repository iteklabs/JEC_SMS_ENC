var a0_0x5180e1=a0_0x32cf;(function(_0x324899,_0x51f770){var _0x2dd358=a0_0x32cf,_0x27d73e=_0x324899();while(!![]){try{var _0x5eeaa4=-parseInt(_0x2dd358(0x10a))/0x1*(-parseInt(_0x2dd358(0x75))/0x2)+-parseInt(_0x2dd358(0xdc))/0x3*(-parseInt(_0x2dd358(0x66))/0x4)+-parseInt(_0x2dd358(0x145))/0x5+-parseInt(_0x2dd358(0xad))/0x6*(parseInt(_0x2dd358(0x73))/0x7)+parseInt(_0x2dd358(0x144))/0x8*(-parseInt(_0x2dd358(0x125))/0x9)+parseInt(_0x2dd358(0x72))/0xa+-parseInt(_0x2dd358(0x117))/0xb*(parseInt(_0x2dd358(0x14b))/0xc);if(_0x5eeaa4===_0x51f770)break;else _0x27d73e['push'](_0x27d73e['shift']());}catch(_0x527699){_0x27d73e['push'](_0x27d73e['shift']());}}}(a0_0x101b,0x58d01));const express=require(a0_0x5180e1(0x13a)),app=express(),router=express[a0_0x5180e1(0x9a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x5180e1(0x11a)),auth=require('../middleware/auth'),nodemailer=require(a0_0x5180e1(0x82)),users=require(a0_0x5180e1(0x108));router[a0_0x5180e1(0x123)](a0_0x5180e1(0x97),auth,async(_0x434f5d,_0x2dd61c)=>{var _0x172416=a0_0x5180e1;try{const {username:_0x3f2443,email:_0x5bfda5,role:_0x4695c5}=_0x434f5d[_0x172416(0x6a)],_0x1bf9e5=_0x434f5d['user'],_0x4f5f92=await profile[_0x172416(0xf6)]({'email':_0x1bf9e5['email']}),_0xa1aa3d=await master_shop[_0x172416(0xe8)]();let _0x58875e;if(_0x1bf9e5[_0x172416(0x162)]==_0x172416(0x107)){const _0x4278c5=await staff['findOne']({'email':_0x1bf9e5[_0x172416(0x114)]});_0x58875e=await sales[_0x172416(0xdd)]([{'$lookup':{'from':_0x172416(0xe3),'localField':_0x172416(0xde),'foreignField':_0x172416(0xa0),'as':_0x172416(0xaa)}},{'$unwind':_0x172416(0xe6)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x172416(0x15b),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x172416(0x89)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x172416(0x166)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x172416(0xe6)},'total_saleproduct_quantity':{'$sum':_0x172416(0x78)},'level':{'$addToSet':_0x172416(0x92)},'isle':{'$addToSet':_0x172416(0xb2)},'type':{'$addToSet':_0x172416(0x103)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x172416(0xf8)},'isAllowEdit':{'$first':_0x172416(0xdb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x58875e=await sales['aggregate']([{'$lookup':{'from':_0x172416(0xe3),'localField':'customer','foreignField':'name','as':_0x172416(0xaa)}},{'$unwind':'$customers_docs'},{'$unwind':_0x172416(0x119)},{'$group':{'_id':_0x172416(0x15b),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x172416(0xa9)},'date':{'$first':_0x172416(0x89)},'warehouse_name':{'$first':_0x172416(0x152)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x172416(0x166)},'return_data':{'$first':_0x172416(0x124)},'customers_docs':{'$first':_0x172416(0xe6)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x172416(0x92)},'isle':{'$addToSet':_0x172416(0xb2)},'type':{'$addToSet':_0x172416(0x103)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x172416(0xdb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log']('sales\x20all_data',_0x58875e);if(_0xa1aa3d[0x0][_0x172416(0x12e)]==_0x172416(0x134)){var _0x45291e=users[_0x172416(0x16c)];console[_0x172416(0x110)](_0x45291e);}else{if(_0xa1aa3d[0x0][_0x172416(0x12e)]==_0x172416(0xf1))var _0x45291e=users[_0x172416(0xf1)];else{if(_0xa1aa3d[0x0][_0x172416(0x12e)]=='German')var _0x45291e=users[_0x172416(0x9b)];else{if(_0xa1aa3d[0x0][_0x172416(0x12e)]==_0x172416(0x11f))var _0x45291e=users[_0x172416(0x11f)];else{if(_0xa1aa3d[0x0][_0x172416(0x12e)]==_0x172416(0xd7))var _0x45291e=users[_0x172416(0xd7)];else{if(_0xa1aa3d[0x0][_0x172416(0x12e)]==_0x172416(0xcd))var _0x45291e=users['Portuguese'];else{if(_0xa1aa3d[0x0]['language']=='Chinese')var _0x45291e=users[_0x172416(0x6e)];else{if(_0xa1aa3d[0x0]['language']==_0x172416(0x14a))var _0x45291e=users[_0x172416(0x8a)];}}}}}}}_0x2dd61c[_0x172416(0x74)](_0x172416(0x83),{'success':_0x434f5d[_0x172416(0x95)](_0x172416(0x121)),'errors':_0x434f5d['flash'](_0x172416(0xb6)),'sales':_0x58875e,'profile':_0x4f5f92,'role':_0x1bf9e5,'master_shop':_0xa1aa3d,'language':_0x45291e});}catch(_0x7acb75){console[_0x172416(0x110)](_0x7acb75);}});async function getRandom8DigitNumber(){var _0x3f3896=a0_0x5180e1;const _0x2dd10d=0x989680,_0x4835ca=0x5f5e0ff,_0x1be52c=Math[_0x3f3896(0xfc)](Math[_0x3f3896(0x7d)]()*(_0x4835ca-_0x2dd10d+0x1))+_0x2dd10d;var _0x358e83;const _0x217c5b=await sales[_0x3f3896(0xf6)]({'invoice':_0x3f3896(0x109)+_0x1be52c});return _0x217c5b&&_0x217c5b[_0x3f3896(0xc3)]>0x0?_0x358e83=_0x3f3896(0x109)+_0x1be52c:_0x358e83=_0x3f3896(0x109)+_0x1be52c,_0x358e83;}function a0_0x101b(){var _0x48efc8=['room','$sale_product.type','currency','$product_details.product_cat','\x20Order\x20Number\x20:\x20','staff','../public/language/languages.json','OUT-','6klRXns','post','getFullYear','True','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</span>','log','/preview/:id','return_sale','/view/:id','email','An\x20error\x20occurred.','password','121DLBFca','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$sale_product','../models/all_models','_id','</tbody>','user_id','Level','Spanish','findById','success','return_qty','get','$return_data','99sEIjlN','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<tbody\x20style=\x22text-align:\x20center;\x22>','delivery_code','expiry_date','status','$product_details.invoice','stocks','params','language','</body></html>','site_title','id_transaction_from','add_sales','</head><body>','English\x20(US)','body','Raw\x20Materials','sales_invoice','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','express','</h5>','$product_details.secondary_unit','save','$product_details.product_code','json','sale_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Sale\x20Return','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','325224LHssCR','1168385mXKmDZ','<span\x20style=\x22float:\x20right;\x22>','Return\x20Rooms','<html><head><title></title>','Logo.png','Arabic\x20(ae)','185892vjBJTu','invoice','$product_details.pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','forEach','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','customer_data','$warehouse_name','push','primary_unit','/view/return_sales/:id','<h5>','Sales\x20Update\x20successfully','</thead>','Portuguese','isAllowEdit','$_id','unit','warehouse','$product_details.expiry_date','due_amount','id_transact','secondary_unit','role','stock','storage','\x20</h2>','$note','batch_code','warehouse_name','delivery_date','<tr>','$product_details','English','Enclosed','primary_code','138104KbZGUQ','received_amount','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','user','barcode\x20Product\x20master','string','product_data','Chinese','bin','sale_product','$product_details.primary_code','2774170xFpZXx','101983daVQuk','render','133258hDSqti','product','Floor','$sale_product.quantity','/invoice/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','message','payment\x20successfull','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_details','bay','edit_sales_view','nodemailer','all_sales','date','redirect','$product_details._id','$product_details.product_stock','$product_details.unit','$date','Arabic','prod_code','master','product_code','<h5\x20style=\x22text-align:\x20left;\x22>','note','$product_details.storage','image','$sale_product.bay','/barcode/:id','Shelves','flash','secondary_code','/view','/view/add_sales','room_name','Router','German','concat','/all_sales/view','rack','Ambient','name','prod_invoice','level','/view/add_sales/:id','$name','Return\x20Goods','finalize','maxperunit','$product_details.isle','$customer','customers_docs','getDate','</tr>','6BtTwNd','$product_details.secondary_code','abs','prod_cat','map','$sale_product.bin','split','</td>','stock_data','errors','$product_details.actual_uom','$product_details.bin','max','slice','floorlevel','$room','Sales\x20Mail','add\x20post','$product_details.product_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/upload/','production_date','length','barcode\x20user_id','False','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<strong>\x20Regards\x20</strong>','types','RoomAssigned','$product_details.production_date','SCRN','Portuguese\x20(BR)','product_name','actual_uom','/view/add_sale/product','$product_details.type','Sale\x20Return\x20Mail','$product_details.rack','product_stock','Enabled','getMonth','French','Error\x20Occurs','/../public','then','$isAllowEdit','48CzAkcP','aggregate','customer','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.batch_code','<h2>\x20','$product_details.maxPerUnit','customers','actual_qty','Email\x20sent\x20successfully','$customers_docs','Receiving\x20Area','find','max_per_unit','port','$product_details.actual_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','edit_sales','requested_qty','/barcode_scanner','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Hindi','padStart','quantity_notConverted','carton','all','findOne','type','$finalize','sales_quantity','catch','quantity','floor','<hr\x20class=\x22my-3\x22>','$product','foreach\x20newproduct','$product_details.bay','filter'];a0_0x101b=function(){return _0x48efc8;};return a0_0x101b();}function a0_0x32cf(_0x562581,_0x47074f){var _0x101b3d=a0_0x101b();return a0_0x32cf=function(_0x32cf0c,_0x274c5d){_0x32cf0c=_0x32cf0c-0x64;var _0x19db00=_0x101b3d[_0x32cf0c];return _0x19db00;},a0_0x32cf(_0x562581,_0x47074f);}router[a0_0x5180e1(0x123)]('/view/add_sales',auth,async(_0x32e341,_0x33b227)=>{var _0x350bc4=a0_0x5180e1;try{const {username:_0x2ed63b,email:_0x354a3d,role:_0x5a7f69}=_0x32e341[_0x350bc4(0x6a)],_0x3ec950=_0x32e341[_0x350bc4(0x6a)],_0x5e417f=await profile['findOne']({'email':_0x3ec950['email']}),_0x42e713=await master_shop[_0x350bc4(0xe8)](),_0x5e26b5=await customer[_0x350bc4(0xe8)]({});let _0x482605;if(_0x3ec950['role']=='staff'){const _0x2aae85=await staff[_0x350bc4(0xf6)]({'email':_0x3ec950[_0x350bc4(0x114)]});_0x482605=await warehouse[_0x350bc4(0xdd)]([{'$match':{'status':_0x350bc4(0xd5),'name':_0x2aae85[_0x350bc4(0x15d)],'warehouse_category':_0x350bc4(0x136),'name':{'$ne':_0x350bc4(0xa5)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x482605=await warehouse['aggregate']([{'$match':{'status':_0x350bc4(0xd5),'warehouse_category':_0x350bc4(0x136),'name':{'$ne':_0x350bc4(0xa5)}}},{'$group':{'_id':_0x350bc4(0xa4),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x408a3e=await product[_0x350bc4(0xe8)]({});var _0x389349=['Ambient',_0x350bc4(0x64)];const _0x5b2482=await sales[_0x350bc4(0xe8)]({}),_0x1e9e4a=_0x5b2482[_0x350bc4(0xc3)]+0x1,_0x4850f7=_0x350bc4(0x109)+_0x1e9e4a['toString']()[_0x350bc4(0xf2)](0x5,'0');if(_0x42e713[0x0][_0x350bc4(0x12e)]==_0x350bc4(0x134)){var _0x63628a=users[_0x350bc4(0x16c)];console[_0x350bc4(0x110)](_0x63628a);}else{if(_0x42e713[0x0][_0x350bc4(0x12e)]=='Hindi')var _0x63628a=users[_0x350bc4(0xf1)];else{if(_0x42e713[0x0][_0x350bc4(0x12e)]==_0x350bc4(0x9b))var _0x63628a=users[_0x350bc4(0x9b)];else{if(_0x42e713[0x0][_0x350bc4(0x12e)]==_0x350bc4(0x11f))var _0x63628a=users['Spanish'];else{if(_0x42e713[0x0][_0x350bc4(0x12e)]==_0x350bc4(0xd7))var _0x63628a=users['French'];else{if(_0x42e713[0x0][_0x350bc4(0x12e)]=='Portuguese\x20(BR)')var _0x63628a=users[_0x350bc4(0x159)];else{if(_0x42e713[0x0]['language']=='Chinese')var _0x63628a=users['Chinese'];else{if(_0x42e713[0x0][_0x350bc4(0x12e)]==_0x350bc4(0x14a))var _0x63628a=users[_0x350bc4(0x8a)];}}}}}}}const _0xd0fe60=getRandom8DigitNumber();_0xd0fe60['then'](_0x2e8415=>{var _0x4d9780=_0x350bc4;_0x33b227['render'](_0x4d9780(0x132),{'success':_0x32e341[_0x4d9780(0x95)](_0x4d9780(0x121)),'errors':_0x32e341[_0x4d9780(0x95)]('errors'),'role':_0x3ec950,'profile':_0x5e417f,'customer':_0x5e26b5,'warehouse':_0x482605,'product':_0x408a3e,'invoice':_0x2e8415,'master_shop':_0x42e713,'language':_0x63628a,'rooms_data':_0x389349});})[_0x350bc4(0xfa)](_0x4bd3e0=>{var _0x183c55=_0x350bc4;_0x32e341['flash'](_0x183c55(0xb6),_0x183c55(0x126)),_0x33b227[_0x183c55(0x85)](_0x183c55(0x9d));});}catch(_0x3ede7c){console[_0x350bc4(0x110)](_0x3ede7c);}}),router[a0_0x5180e1(0x123)](a0_0x5180e1(0xa3),auth,async(_0x131af1,_0x1c82df)=>{var _0x2a763e=a0_0x5180e1;try{const _0xfdefd0=_0x131af1[_0x2a763e(0x12d)]['id'];console[_0x2a763e(0x110)](_0xfdefd0);const _0x4ef866=await product[_0x2a763e(0xe8)](),_0x359267=await purchases['aggregate']([{'$match':{'warehouse_name':_0xfdefd0}},{'$unwind':_0x2a763e(0xfe)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x359267),_0x1c82df[_0x2a763e(0x12a)](0xc8)[_0x2a763e(0x13f)]({'purchases_data':_0x359267,'product_data':_0x4ef866});}catch(_0x1850b6){console[_0x2a763e(0x110)](_0x1850b6);}}),router[a0_0x5180e1(0x10b)](a0_0x5180e1(0xd0),auth,async(_0x1c4a9e,_0x3946eb)=>{var _0xad1a43=a0_0x5180e1;try{const {warehouse_data:_0x46eb1a,product_data:_0x560e82}=_0x1c4a9e[_0xad1a43(0x135)];console[_0xad1a43(0x110)](_0x1c4a9e[_0xad1a43(0x135)][_0xad1a43(0x6d)]);;const _0x5bdae8=await master_shop[_0xad1a43(0xe8)]();console[_0xad1a43(0x110)](_0xad1a43(0x8c),_0x5bdae8);const _0x2fe97b=await product[_0xad1a43(0xf6)]({'name':_0x560e82});console[_0xad1a43(0x110)](_0xad1a43(0x76),_0x2fe97b);const _0x388c99=await warehouse['aggregate']([{'$match':{'name':_0x46eb1a}},{'$unwind':_0xad1a43(0x16b)},{'$match':{'product_details.product_name':_0x560e82}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0xad1a43(0x87)}}}]);console[_0xad1a43(0x110)](_0xad1a43(0xb5),_0x388c99),_0x3946eb[_0xad1a43(0x12a)](0xc8)[_0xad1a43(0x13f)]({'master':_0x5bdae8,'new_product':_0x2fe97b,'stock_data':_0x388c99});}catch(_0x297551){console[_0xad1a43(0x110)](_0x297551);}}),router[a0_0x5180e1(0x10b)](a0_0x5180e1(0x98),auth,async(_0x2a13de,_0x48e940)=>{var _0x5bfde8=a0_0x5180e1;try{const {invoice:_0x5b7282,date:_0x4e8e5c,warehouse_name:_0x6d7349,product_name:_0x39a5a2,stock:_0x302762,quantity:_0x3259b6,note:_0x4a2457,room:_0xfd0bb9,primary_code:_0x1bdd46,secondary_code:_0x5762be,prod_code:_0x457a59,level:_0x5bf5f2,isle:_0x192378,pallet:_0x5530d8,batch_code:_0x3487bd,SCRN:_0x37113f,expiry_date:_0x5df06b}=_0x2a13de[_0x5bfde8(0x135)];if(typeof _0x39a5a2=='string')var _0x206402=[_0x2a13de['body'][_0x5bfde8(0xce)]],_0x3a9477=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x163)]],_0x57e5c6=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xf4)]],_0x2ec3bd=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x65)]],_0x172870=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x96)]],_0x1af78a=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x8b)]],_0x2cec43=[_0x2a13de['body'][_0x5bfde8(0xa2)]],_0x243edd=[_0x2a13de[_0x5bfde8(0x135)]['primary_unit']],_0x1d2d54=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x161)]],_0x26cb75=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x167)]],_0x21da71=[_0x2a13de['body']['expiry_date']],_0x875a82=[_0x2a13de[_0x5bfde8(0x135)]['max_per_unit']],_0x29ac41=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xc2)]],_0x2486c6=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xee)]],_0x4fb917=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x169)]],_0x470eeb=[_0x2a13de[_0x5bfde8(0x135)]['delivery_code']],_0x615ef5=[_0x2a13de['body'][_0x5bfde8(0xb0)]],_0x41bd79=[_0x2a13de[_0x5bfde8(0x135)]['quantity']],_0x2d7952=[_0x2a13de['body'][_0x5bfde8(0xca)]],_0x57ca0d=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xa1)]],_0x475a8f=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xe4)]],_0x2d80b2=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xcf)]],_0x34ab2c=[_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x160)]];else var _0x206402=[..._0x2a13de['body'][_0x5bfde8(0xce)]],_0x3a9477=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x163)]],_0x57e5c6=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xf4)]],_0x2ec3bd=[..._0x2a13de[_0x5bfde8(0x135)]['primary_code']],_0x172870=[..._0x2a13de[_0x5bfde8(0x135)]['secondary_code']],_0x1af78a=[..._0x2a13de[_0x5bfde8(0x135)]['prod_code']],_0x2cec43=[..._0x2a13de['body']['level']],_0x243edd=[..._0x2a13de[_0x5bfde8(0x135)]['primary_unit']],_0x1d2d54=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x161)]],_0x26cb75=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x167)]],_0x21da71=[..._0x2a13de['body']['expiry_date']],_0x875a82=[..._0x2a13de[_0x5bfde8(0x135)]['max_per_unit']],_0x29ac41=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xc2)]],_0x2486c6=[..._0x2a13de['body'][_0x5bfde8(0xee)]],_0x4fb917=[..._0x2a13de['body'][_0x5bfde8(0x169)]],_0x470eeb=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x128)]],_0x615ef5=[..._0x2a13de[_0x5bfde8(0x135)]['prod_cat']],_0x41bd79=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xfb)]],_0x2d7952=[..._0x2a13de[_0x5bfde8(0x135)]['RoomAssigned']],_0x57ca0d=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xa1)]],_0x475a8f=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xe4)]],_0x2d80b2=[..._0x2a13de['body']['actual_uom']],_0x34ab2c=[..._0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0x160)]];const _0x1464d0=_0x206402[_0x5bfde8(0xb1)](_0x3b2d81=>{return _0x3b2d81={'product_name':_0x3b2d81};});_0x3a9477[_0x5bfde8(0x14f)]((_0x1e590c,_0x2d1cfd)=>{var _0x54c889=_0x5bfde8;_0x1464d0[_0x2d1cfd][_0x54c889(0x163)]=Math[_0x54c889(0xaf)](_0x1e590c);}),_0x475a8f[_0x5bfde8(0x14f)]((_0x31a089,_0x4fa5d7)=>{var _0x303ba7=_0x5bfde8;_0x1464d0[_0x4fa5d7]['actual_qty']=Math[_0x303ba7(0xaf)](_0x31a089);}),_0x2d80b2[_0x5bfde8(0x14f)]((_0xd1a021,_0x328550)=>{var _0x2adf23=_0x5bfde8;_0x1464d0[_0x328550][_0x2adf23(0xcf)]=_0xd1a021;}),_0x34ab2c[_0x5bfde8(0x14f)]((_0x1ac9c8,_0x2f1d9f)=>{var _0x20beaa=_0x5bfde8;_0x1464d0[_0x2f1d9f][_0x20beaa(0x131)]=_0x1ac9c8;}),_0x57e5c6[_0x5bfde8(0x14f)]((_0x2da5a9,_0x18e6e4)=>{var _0x9705f5=_0x5bfde8;_0x1464d0[_0x18e6e4][_0x9705f5(0xfb)]=_0x2da5a9;}),_0x2ec3bd[_0x5bfde8(0x14f)]((_0x48c766,_0x92ba7a)=>{var _0x20e2c4=_0x5bfde8;_0x1464d0[_0x92ba7a][_0x20e2c4(0x65)]=_0x48c766;}),_0x172870[_0x5bfde8(0x14f)]((_0x27abe3,_0x3918a7)=>{var _0x45216e=_0x5bfde8;_0x1464d0[_0x3918a7][_0x45216e(0x96)]=_0x27abe3;}),_0x1af78a['forEach']((_0x30746c,_0x13ab9e)=>{_0x1464d0[_0x13ab9e]['product_code']=_0x30746c;}),_0x2cec43['forEach']((_0x1a2583,_0x5910fc)=>{var _0x23ed09=_0x5bfde8;_0x2d7952[_0x23ed09(0x14f)]((_0x5c0241,_0x543ebe)=>{var _0x53b48d=_0x23ed09;if(_0x5c0241==_0x53b48d(0xe7)&&_0x5910fc==_0x543ebe){var _0x1128d8=_0x1a2583['slice'](0x3);_0x1464d0[_0x5910fc][_0x53b48d(0x164)]=_0x1a2583[0x0],_0x1464d0[_0x5910fc][_0x53b48d(0x9e)]=_0x1a2583[0x1],_0x1464d0[_0x5910fc][_0x53b48d(0x80)]=0x0,_0x1464d0[_0x5910fc][_0x53b48d(0x6f)]=0x0,_0x1464d0[_0x5910fc][_0x53b48d(0xf7)]=_0x53b48d(0x77),_0x1464d0[_0x5910fc][_0x53b48d(0xbb)]=_0x1128d8;}else{if(_0x5c0241==_0x53b48d(0x94)&&_0x5910fc==_0x543ebe){var _0x1128d8=_0x1a2583['slice'](0x3);_0x1464d0[_0x5910fc][_0x53b48d(0x164)]=_0x1a2583[0x0],_0x1464d0[_0x5910fc][_0x53b48d(0x9e)]=_0x1a2583[0x1],_0x1464d0[_0x5910fc][_0x53b48d(0x80)]=0x0,_0x1464d0[_0x5910fc]['bin']=0x0,_0x1464d0[_0x5910fc][_0x53b48d(0xf7)]=_0x53b48d(0x77),_0x1464d0[_0x5910fc]['floorlevel']=_0x1a2583[0x5];}else{if(_0x5910fc==_0x543ebe){var _0x2cbf58;if(_0x1a2583[0x4]=='L')_0x2cbf58=_0x53b48d(0x11e);else _0x1a2583[0x4]=='F'&&(_0x2cbf58=_0x53b48d(0x77));_0x1464d0[_0x5910fc][_0x53b48d(0x164)]=_0x1a2583[0x0],_0x1464d0[_0x5910fc][_0x53b48d(0x9e)]=_0x1a2583[0x1],_0x1464d0[_0x5910fc][_0x53b48d(0x80)]=_0x1a2583[0x2],_0x1464d0[_0x5910fc][_0x53b48d(0x6f)]=_0x1a2583[0x3],_0x1464d0[_0x5910fc][_0x53b48d(0xf7)]=_0x2cbf58,_0x1464d0[_0x5910fc][_0x53b48d(0xbb)]=_0x1a2583[0x5];}}}});}),_0x243edd[_0x5bfde8(0x14f)]((_0x4cc6bc,_0x584640)=>{var _0x35102e=_0x5bfde8;_0x1464d0[_0x584640][_0x35102e(0x15c)]=_0x4cc6bc;}),_0x1d2d54[_0x5bfde8(0x14f)]((_0x82e640,_0x2f246b)=>{var _0x2a90ce=_0x5bfde8;_0x1464d0[_0x2f246b][_0x2a90ce(0x161)]=_0x82e640;}),_0x26cb75[_0x5bfde8(0x14f)]((_0x5ca9e2,_0x36d7ec)=>{var _0x2cb513=_0x5bfde8;_0x1464d0[_0x36d7ec][_0x2cb513(0x167)]=_0x5ca9e2;}),_0x21da71['forEach']((_0x545353,_0x3e63ae)=>{var _0x391992=_0x5bfde8;_0x1464d0[_0x3e63ae][_0x391992(0x129)]=_0x545353;}),_0x875a82['forEach']((_0x359e6b,_0x256ee5)=>{var _0x52c98f=_0x5bfde8;_0x1464d0[_0x256ee5][_0x52c98f(0xa7)]=_0x359e6b;}),_0x29ac41[_0x5bfde8(0x14f)]((_0x45e500,_0x562745)=>{var _0x288e08=_0x5bfde8;_0x1464d0[_0x562745][_0x288e08(0xc2)]=_0x45e500;}),_0x2486c6[_0x5bfde8(0x14f)]((_0x188de0,_0x2fc5b7)=>{var _0x1439ef=_0x5bfde8;_0x1464d0[_0x2fc5b7][_0x1439ef(0xee)]=_0x188de0;}),_0x4fb917[_0x5bfde8(0x14f)]((_0x216e7a,_0x321cfd)=>{var _0x4fcb13=_0x5bfde8;_0x1464d0[_0x321cfd][_0x4fcb13(0x169)]=_0x216e7a;}),_0x470eeb['forEach']((_0x1ba616,_0x1e5716)=>{var _0x53293b=_0x5bfde8;_0x1464d0[_0x1e5716][_0x53293b(0x128)]=_0x1ba616;}),_0x615ef5[_0x5bfde8(0x14f)]((_0x2a4588,_0x1b05ce)=>{var _0x1a2b69=_0x5bfde8;_0x1464d0[_0x1b05ce][_0x1a2b69(0xb0)]=_0x2a4588;}),_0x41bd79[_0x5bfde8(0x14f)]((_0x37b8e6,_0x3b0827)=>{var _0x166122=_0x5bfde8;_0x1464d0[_0x3b0827][_0x166122(0xf3)]=_0x37b8e6;}),_0x2d7952[_0x5bfde8(0x14f)]((_0x3ac3f3,_0x25d062)=>{var _0x185678=_0x5bfde8;_0x1464d0[_0x25d062][_0x185678(0x99)]=_0x3ac3f3;}),_0x57ca0d[_0x5bfde8(0x14f)]((_0x414df9,_0x32affb)=>{var _0x3fe44f=_0x5bfde8;_0x1464d0[_0x32affb][_0x3fe44f(0x14c)]=_0x414df9;});var _0x2bc4c6=0x0;_0x1464d0[_0x5bfde8(0x14f)](_0x29e400=>{var _0x3eebb0=_0x5bfde8;(_0x29e400['stock']<_0x29e400[_0x3eebb0(0xf3)]||_0x29e400['quantity_notConverted']==0x0)&&(console[_0x3eebb0(0x110)](_0x3eebb0(0xff),_0x29e400),_0x2bc4c6++);});const _0x3dfa02=_0x1464d0['filter'](_0x4ca4fb=>_0x4ca4fb[_0x5bfde8(0xfb)]!=='0'&&_0x4ca4fb[_0x5bfde8(0xfb)]!==''),_0x34a0ba=new sales({'invoice':_0x5b7282,'customer':_0x2a13de[_0x5bfde8(0x135)][_0x5bfde8(0xde)],'date':_0x4e8e5c,'warehouse_name':_0x6d7349,'sale_product':_0x3dfa02,'note':_0x4a2457,'room':_0xfd0bb9,'primary_code':_0x1bdd46,'secondary_code':_0x5762be,'prod_code':_0x457a59,'SCRN':_0x37113f}),_0x53c133=await _0x34a0ba[_0x5bfde8(0x13d)]();_0x2a13de['flash'](_0x5bfde8(0x121),'Sales\x20Add\x20successfully'),_0x48e940[_0x5bfde8(0x85)]('/all_sales/preview/'+_0x53c133[_0x5bfde8(0x11b)]);}catch(_0x23028b){console[_0x5bfde8(0x110)](_0x23028b);}}),router[a0_0x5180e1(0x123)](a0_0x5180e1(0x111),auth,async(_0x594033,_0x5a4fb7)=>{var _0x3e4798=a0_0x5180e1;try{const {username:_0x5504c9,email:_0x38b8a1,role:_0x3a4e00}=_0x594033[_0x3e4798(0x6a)],_0x11816f=_0x594033[_0x3e4798(0x6a)],_0x10f398=await profile[_0x3e4798(0xf6)]({'email':_0x11816f[_0x3e4798(0x114)]}),_0x7c74a7=await master_shop[_0x3e4798(0xe8)](),_0x36535f=_0x594033[_0x3e4798(0x12d)]['id'],_0xddb3c9=await sales['findById'](_0x36535f),_0x12b4b7=await warehouse[_0x3e4798(0xdd)]([{'$match':{'name':_0xddb3c9[_0x3e4798(0x168)]}},{'$unwind':_0x3e4798(0x16b)},{'$group':{'_id':_0x3e4798(0x86),'name':{'$first':_0x3e4798(0xbf)},'product_stock':{'$first':_0x3e4798(0x87)},'bay':{'$first':_0x3e4798(0x100)},'bin':{'$first':_0x3e4798(0xb8)},'type':{'$first':_0x3e4798(0xd1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3e4798(0x71)},'secondary_code':{'$first':_0x3e4798(0xae)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3e4798(0x90)},'rack':{'$first':_0x3e4798(0xd3)},'expiry_date':{'$first':_0x3e4798(0x15e)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x1eed48=await customer['find']({});let _0xe57f06;if(_0x11816f[_0x3e4798(0x162)]==_0x3e4798(0x107)){const _0x217918=await staff[_0x3e4798(0xf6)]({'email':_0x11816f['email']});_0xe57f06=await warehouse[_0x3e4798(0xdd)]([{'$match':{'status':_0x3e4798(0xd5),'name':_0x217918[_0x3e4798(0x15d)]}},{'$group':{'_id':_0x3e4798(0xa4),'name':{'$first':'$name'}}}]);}else _0xe57f06=await warehouse[_0x3e4798(0xdd)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x3e4798(0xa4)}}}]);const _0x39e261=await product[_0x3e4798(0xe8)]({}),_0x210b6d=await suppliers[_0x3e4798(0xe8)]({});if(_0x7c74a7[0x0]['language']==_0x3e4798(0x134)){var _0x2b4dd2=users['English'];console[_0x3e4798(0x110)](_0x2b4dd2);}else{if(_0x7c74a7[0x0][_0x3e4798(0x12e)]==_0x3e4798(0xf1))var _0x2b4dd2=users[_0x3e4798(0xf1)];else{if(_0x7c74a7[0x0]['language']==_0x3e4798(0x9b))var _0x2b4dd2=users[_0x3e4798(0x9b)];else{if(_0x7c74a7[0x0][_0x3e4798(0x12e)]==_0x3e4798(0x11f))var _0x2b4dd2=users['Spanish'];else{if(_0x7c74a7[0x0][_0x3e4798(0x12e)]==_0x3e4798(0xd7))var _0x2b4dd2=users[_0x3e4798(0xd7)];else{if(_0x7c74a7[0x0][_0x3e4798(0x12e)]==_0x3e4798(0xcd))var _0x2b4dd2=users['Portuguese'];else{if(_0x7c74a7[0x0][_0x3e4798(0x12e)]==_0x3e4798(0x6e))var _0x2b4dd2=users[_0x3e4798(0x6e)];else{if(_0x7c74a7[0x0][_0x3e4798(0x12e)]==_0x3e4798(0x14a))var _0x2b4dd2=users['Arabic'];}}}}}}}_0x5a4fb7['render'](_0x3e4798(0x81),{'success':_0x594033[_0x3e4798(0x95)](_0x3e4798(0x121)),'errors':_0x594033[_0x3e4798(0x95)]('errors'),'role':_0x11816f,'profile':_0x10f398,'customer':_0x1eed48,'warehouse':_0xe57f06,'product':_0x12b4b7,'user':_0xddb3c9,'master_shop':_0x7c74a7,'unit':_0x39e261,'language':_0x2b4dd2,'suppliers':_0x210b6d});}catch(_0x451012){console[_0x3e4798(0x110)](_0x451012);}}),router[a0_0x5180e1(0x10b)](a0_0x5180e1(0x111),auth,async(_0x20579,_0x3cf26a)=>{var _0x1c4a88=a0_0x5180e1;try{const _0x4e3532=_0x20579[_0x1c4a88(0x12d)]['id'],{invoice:_0x3682f0,warehouse_name:_0x42f02a,room:_0x1ec48e}=_0x20579[_0x1c4a88(0x135)],_0x444cac=await sales[_0x1c4a88(0xf6)]({'invoice':_0x3682f0}),_0x123b3d=_0x444cac[_0x1c4a88(0x70)][_0x1c4a88(0xb1)](async _0x5d453e=>{var _0x530c14=_0x1c4a88,_0x1d52be=await warehouse[_0x530c14(0xf6)]({'name':_0x42f02a,'room':_0x5d453e['room_name'],'warehouse_category':_0x530c14(0x136)});const _0x5d3e7f=_0x1d52be[_0x530c14(0x7f)]['map'](_0x10ead1=>{var _0x44f457=_0x530c14;_0x10ead1[_0x44f457(0xce)]==_0x5d453e[_0x44f457(0xce)]&&_0x10ead1['floorlevel']==_0x5d453e[_0x44f457(0xbb)]&&_0x10ead1[_0x44f457(0xf7)]==_0x5d453e[_0x44f457(0xf7)]&&_0x10ead1['bin']==_0x5d453e['bin']&&_0x10ead1[_0x44f457(0x80)]==_0x5d453e[_0x44f457(0x80)]&&_0x10ead1[_0x44f457(0x9e)]==_0x5d453e[_0x44f457(0x9e)]&&_0x10ead1[_0x44f457(0x164)]==_0x5d453e[_0x44f457(0x164)]&&_0x10ead1[_0x44f457(0x129)]==_0x5d453e[_0x44f457(0x129)]&&_0x10ead1[_0x44f457(0x167)]==_0x5d453e[_0x44f457(0x167)]&&_0x10ead1[_0x44f457(0x14c)]==_0x5d453e[_0x44f457(0x14c)]&&_0x10ead1[_0x44f457(0x11b)]==_0x5d453e[_0x44f457(0x131)]&&(_0x10ead1[_0x44f457(0xd4)]=Math[_0x44f457(0xb9)](0x0,Math['abs'](_0x10ead1[_0x44f457(0xd4)])-Math[_0x44f457(0xaf)](_0x5d453e[_0x44f457(0xfb)])));});return _0x1d52be;});Promise[_0x1c4a88(0xf5)](_0x123b3d)[_0x1c4a88(0xda)](async _0x12c55c=>{var _0x265ec7=_0x1c4a88;try{for(const _0x42977b of _0x12c55c){await _0x42977b[_0x265ec7(0x13d)]();}_0x444cac[_0x265ec7(0xa6)]=_0x265ec7(0x10d);const _0x2b96f3=await _0x444cac[_0x265ec7(0x13d)](),_0x135009=await master_shop[_0x265ec7(0xe8)](),_0x2d5062=await email_settings[_0x265ec7(0xf6)](),_0x231b6=await supervisor_settings[_0x265ec7(0xe8)]();var _0x10fb9a=_0x444cac[_0x265ec7(0x70)],_0x4fa925='',_0x4804cf;for(_0x4804cf in _0x10fb9a){_0x4fa925+=_0x265ec7(0x16a)+_0x265ec7(0x143)+_0x10fb9a[_0x4804cf][_0x265ec7(0xce)]+_0x265ec7(0xb4)+_0x265ec7(0x143)+_0x10fb9a[_0x4804cf][_0x265ec7(0x8d)]+'</td>'+_0x265ec7(0x143)+_0x10fb9a[_0x4804cf][_0x265ec7(0xfb)]+_0x265ec7(0xb4)+_0x265ec7(0x143)+_0x10fb9a[_0x4804cf]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x10fb9a[_0x4804cf][_0x265ec7(0x161)]+'</td>'+_0x265ec7(0x143)+_0x444cac[_0x265ec7(0x168)]+_0x265ec7(0xb4)+_0x265ec7(0x143)+_0x10fb9a[_0x4804cf][_0x265ec7(0x99)]+_0x265ec7(0xb4)+_0x265ec7(0x143)+_0x10fb9a[_0x4804cf][_0x265ec7(0x164)]+_0x10fb9a[_0x4804cf][_0x265ec7(0x9e)]+_0x10fb9a[_0x4804cf][_0x265ec7(0x80)]+_0x10fb9a[_0x4804cf]['bin']+_0x10fb9a[_0x4804cf]['type'][0x0]+_0x10fb9a[_0x4804cf][_0x265ec7(0xbb)]+_0x265ec7(0xb4),_0x265ec7(0xac);}let _0x285200=nodemailer['createTransport']({'host':_0x2d5062['host'],'port':Number(_0x2d5062[_0x265ec7(0xea)]),'secure':![],'auth':{'user':_0x2d5062[_0x265ec7(0x114)],'pass':_0x2d5062[_0x265ec7(0x116)]}}),_0x297a72={'from':_0x2d5062[_0x265ec7(0x114)],'to':_0x231b6[0x0]['RMSEmail'],'subject':_0x265ec7(0xbd),'attachments':[{'filename':_0x265ec7(0x149),'path':__dirname+_0x265ec7(0xd9)+_0x265ec7(0xc1)+_0x135009[0x0][_0x265ec7(0x91)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x265ec7(0x148)+_0x265ec7(0x133)+'<div>'+_0x265ec7(0x150)+_0x265ec7(0x138)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x265ec7(0x68)+_0x265ec7(0x138)+_0x265ec7(0xe1)+_0x135009[0x0][_0x265ec7(0x130)]+_0x265ec7(0x165)+_0x265ec7(0x68)+_0x265ec7(0x68)+'<hr\x20class=\x22my-3\x22>'+_0x265ec7(0x138)+_0x265ec7(0x8e)+_0x265ec7(0x106)+_0x444cac[_0x265ec7(0x14c)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x444cac[_0x265ec7(0x84)]+'\x20'+'</span>'+'</h5>'+_0x265ec7(0x68)+_0x265ec7(0xc0)+_0x265ec7(0x10e)+_0x265ec7(0x16a)+_0x265ec7(0xc7)+_0x265ec7(0x7e)+_0x265ec7(0x7a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x265ec7(0x14e)+_0x265ec7(0x118)+'</tr>'+_0x265ec7(0x158)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4fa925+'\x20'+_0x265ec7(0x11c)+'</table>'+_0x265ec7(0x138)+'<strong>\x20Regards\x20</strong>'+_0x265ec7(0x156)+_0x135009[0x0][_0x265ec7(0x130)]+_0x265ec7(0x13b)+_0x265ec7(0x68)+_0x265ec7(0x68)+_0x265ec7(0x12f)};_0x285200['sendMail'](_0x297a72,function(_0x29c203,_0x3e816a){var _0x43401c=_0x265ec7;_0x29c203?(console[_0x43401c(0x110)](_0x29c203),console[_0x43401c(0x110)](_0x43401c(0xd8))):console['log'](_0x43401c(0xe5));}),_0x20579[_0x265ec7(0x95)](_0x265ec7(0x121),_0x265ec7(0x157)),_0x3cf26a[_0x265ec7(0x85)]('/all_sales/preview/'+_0x4e3532);}catch(_0x4be6e3){console['error'](_0x4be6e3),_0x3cf26a[_0x265ec7(0x12a)](0x1f4)[_0x265ec7(0x13f)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1c4a88(0xfa)](_0x9be35e=>{var _0x12b75b=_0x1c4a88;console['error'](_0x9be35e),_0x3cf26a[_0x12b75b(0x12a)](0x1f4)['json']({'error':_0x12b75b(0x115)});});}catch(_0x1f2bc1){console['log'](_0x1f2bc1);}}),router[a0_0x5180e1(0x123)](a0_0x5180e1(0x113),auth,async(_0x10d1de,_0x57f5df)=>{var _0x5fb4d0=a0_0x5180e1;try{const {username:_0xe3754a,email:_0x44bc85,role:_0x211e2f}=_0x10d1de[_0x5fb4d0(0x6a)],_0x4ba107=_0x10d1de[_0x5fb4d0(0x6a)],_0x57b5cb=await profile[_0x5fb4d0(0xf6)]({'email':_0x4ba107[_0x5fb4d0(0x114)]}),_0x5a738e=await master_shop[_0x5fb4d0(0xe8)](),_0x2134fb=_0x10d1de[_0x5fb4d0(0x12d)]['id'],_0x169201=await sales['findById'](_0x2134fb);var _0x53cf66=[_0x5fb4d0(0x9f),_0x5fb4d0(0x64)];const _0x14eb34=await warehouse[_0x5fb4d0(0xdd)]([{'$match':{'name':_0x169201[_0x5fb4d0(0x168)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x5fb4d0(0x16b)},{'$group':{'_id':_0x5fb4d0(0x86),'name':{'$first':_0x5fb4d0(0xbf)},'product_stock':{'$first':_0x5fb4d0(0x87)},'bay':{'$first':_0x5fb4d0(0x100)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5fb4d0(0xd1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5fb4d0(0xae)},'product_code':{'$first':_0x5fb4d0(0x13e)},'storage':{'$first':_0x5fb4d0(0x90)},'rack':{'$first':_0x5fb4d0(0xd3)}}}]),_0xfd3501=await customer['find']({});let _0x4e33aa;if(_0x4ba107['role']==_0x5fb4d0(0x107)){const _0x17763e=await staff[_0x5fb4d0(0xf6)]({'email':_0x4ba107[_0x5fb4d0(0x114)]});_0x4e33aa=await warehouse[_0x5fb4d0(0xdd)]([{'$match':{'status':_0x5fb4d0(0xd5),'name':_0x17763e['warehouse'],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x5fb4d0(0xa4)}}}]);}else _0x4e33aa=await warehouse['aggregate']([{'$match':{'status':_0x5fb4d0(0xd5),'warehouse_category':_0x5fb4d0(0x136)}},{'$group':{'_id':_0x5fb4d0(0xa4),'name':{'$first':_0x5fb4d0(0xa4)}}}]);const _0x3774cc=await product['find']({});if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]==_0x5fb4d0(0x134)){var _0x36acd0=users[_0x5fb4d0(0x16c)];console[_0x5fb4d0(0x110)](_0x36acd0);}else{if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]==_0x5fb4d0(0xf1))var _0x36acd0=users[_0x5fb4d0(0xf1)];else{if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]=='German')var _0x36acd0=users['German'];else{if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]==_0x5fb4d0(0x11f))var _0x36acd0=users[_0x5fb4d0(0x11f)];else{if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]==_0x5fb4d0(0xd7))var _0x36acd0=users[_0x5fb4d0(0xd7)];else{if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]==_0x5fb4d0(0xcd))var _0x36acd0=users[_0x5fb4d0(0x159)];else{if(_0x5a738e[0x0][_0x5fb4d0(0x12e)]==_0x5fb4d0(0x6e))var _0x36acd0=users[_0x5fb4d0(0x6e)];else{if(_0x5a738e[0x0]['language']==_0x5fb4d0(0x14a))var _0x36acd0=users[_0x5fb4d0(0x8a)];}}}}}}}_0x57f5df[_0x5fb4d0(0x74)](_0x5fb4d0(0xed),{'success':_0x10d1de[_0x5fb4d0(0x95)](_0x5fb4d0(0x121)),'errors':_0x10d1de['flash'](_0x5fb4d0(0xb6)),'role':_0x4ba107,'profile':_0x57b5cb,'customer':_0xfd3501,'warehouse':_0x4e33aa,'product':_0x14eb34,'user':_0x169201,'master_shop':_0x5a738e,'unit':_0x3774cc,'language':_0x36acd0});}catch(_0x4ae9f1){console[_0x5fb4d0(0x110)](_0x4ae9f1);}}),router[a0_0x5180e1(0x10b)](a0_0x5180e1(0x113),auth,async(_0x482889,_0x391b5d)=>{var _0x27e124=a0_0x5180e1;try{const _0xbf05cd=_0x482889[_0x27e124(0x12d)]['id'],_0x501379=await sales[_0x27e124(0xf6)]({'_id':_0x482889[_0x27e124(0x12d)]['id']}),_0x235b50=await warehouse[_0x27e124(0xf6)]({'name':_0x501379[_0x27e124(0x168)],'room':_0x482889[_0x27e124(0x135)][_0x27e124(0x102)]}),{invoice:_0x2bca66,date:_0x1f0bcf,warehouse_name:_0x1631da,product_name:_0x161e64,stock:_0x13011a,quantity:_0x303641,note:_0x30d504,room:_0x44b624,customer:_0x3c6172,SCRN:_0x5f5bde}=_0x482889[_0x27e124(0x135)];if(typeof _0x161e64==_0x27e124(0x6c))var _0x1f4c18=[_0x482889['body'][_0x27e124(0xce)]],_0x3968e0=[_0x482889['body'][_0x27e124(0x163)]],_0xe438c5=[_0x482889[_0x27e124(0x135)][_0x27e124(0xf4)]],_0x295ce0=[_0x482889[_0x27e124(0x135)]['primary_code']],_0x4543fb=[_0x482889[_0x27e124(0x135)][_0x27e124(0x96)]],_0x5c7598=[_0x482889['body'][_0x27e124(0x8b)]],_0x2b4098=[_0x482889[_0x27e124(0x135)]['level']],_0x47c826=[_0x482889[_0x27e124(0x135)][_0x27e124(0x154)]],_0x5710b4=[_0x482889[_0x27e124(0x135)][_0x27e124(0x161)]],_0x3f3d43=[_0x482889['body']['batch_code']],_0x45ac72=[_0x482889[_0x27e124(0x135)]['expiry_date']],_0x2a20df=[_0x482889[_0x27e124(0x135)][_0x27e124(0xe9)]],_0x23abd7=[_0x482889[_0x27e124(0x135)][_0x27e124(0xc2)]],_0x2b28c6=[_0x482889[_0x27e124(0x135)][_0x27e124(0xee)]],_0xbe67ab=[_0x482889['body']['delivery_date']],_0x1a3203=[_0x482889[_0x27e124(0x135)][_0x27e124(0x128)]],_0x164952=[_0x482889[_0x27e124(0x135)][_0x27e124(0xb0)]],_0x1a455d=[_0x482889['body'][_0x27e124(0xfb)]],_0x15899a=[_0x482889['body'][_0x27e124(0xca)]];else var _0x1f4c18=[..._0x482889[_0x27e124(0x135)]['product_name']],_0x3968e0=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x163)]],_0xe438c5=[..._0x482889[_0x27e124(0x135)][_0x27e124(0xf4)]],_0x295ce0=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x65)]],_0x4543fb=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x96)]],_0x5c7598=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x8b)]],_0x2b4098=[..._0x482889['body']['level']],_0x47c826=[..._0x482889['body'][_0x27e124(0x154)]],_0x5710b4=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x161)]],_0x3f3d43=[..._0x482889[_0x27e124(0x135)]['batch_code']],_0x45ac72=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x129)]],_0x2a20df=[..._0x482889[_0x27e124(0x135)]['max_per_unit']],_0x23abd7=[..._0x482889[_0x27e124(0x135)][_0x27e124(0xc2)]],_0x2b28c6=[..._0x482889['body']['requested_qty']],_0xbe67ab=[..._0x482889[_0x27e124(0x135)][_0x27e124(0x169)]],_0x1a3203=[..._0x482889['body'][_0x27e124(0x128)]],_0x164952=[..._0x482889[_0x27e124(0x135)][_0x27e124(0xb0)]],_0x1a455d=[..._0x482889['body'][_0x27e124(0xfb)]],_0x15899a=[..._0x482889[_0x27e124(0x135)][_0x27e124(0xca)]];const _0x14a248=_0x1f4c18[_0x27e124(0xb1)](_0x4ded03=>{return _0x4ded03={'product_name':_0x4ded03};});_0x3968e0[_0x27e124(0x14f)]((_0x5e24c1,_0x8ef96)=>{_0x14a248[_0x8ef96]['stock']=Math['abs'](_0x5e24c1);}),_0xe438c5['forEach']((_0x5522d2,_0xb64481)=>{var _0x122a37=_0x27e124;_0x14a248[_0xb64481][_0x122a37(0xfb)]=_0x5522d2;}),_0x295ce0[_0x27e124(0x14f)]((_0x7e5ba9,_0x1584c1)=>{var _0x25d6a4=_0x27e124;_0x14a248[_0x1584c1][_0x25d6a4(0x65)]=_0x7e5ba9;}),_0x4543fb['forEach']((_0x511caa,_0xfda35d)=>{_0x14a248[_0xfda35d]['secondary_code']=_0x511caa;}),_0x5c7598[_0x27e124(0x14f)]((_0x5b494a,_0x43542f)=>{_0x14a248[_0x43542f]['product_code']=_0x5b494a;}),_0x2b4098[_0x27e124(0x14f)]((_0x3d7fce,_0x5c0411)=>{_0x15899a['forEach']((_0x503c5c,_0x4d899f)=>{var _0x4c25d5=a0_0x32cf;if(_0x503c5c==_0x4c25d5(0xe7)&&_0x5c0411==_0x4d899f){var _0x23cfea=_0x3d7fce[_0x4c25d5(0xba)](0x3);_0x14a248[_0x5c0411][_0x4c25d5(0x164)]=_0x3d7fce[0x0],_0x14a248[_0x5c0411][_0x4c25d5(0x9e)]=_0x3d7fce[0x1],_0x14a248[_0x5c0411][_0x4c25d5(0x80)]=0x0,_0x14a248[_0x5c0411][_0x4c25d5(0x6f)]=0x0,_0x14a248[_0x5c0411][_0x4c25d5(0xf7)]='Floor',_0x14a248[_0x5c0411][_0x4c25d5(0xbb)]=_0x23cfea;}else{if(_0x503c5c=='Shelves'&&_0x5c0411==_0x4d899f){var _0x23cfea=_0x3d7fce[_0x4c25d5(0xba)](0x3);_0x14a248[_0x5c0411]['storage']=_0x3d7fce[0x0],_0x14a248[_0x5c0411][_0x4c25d5(0x9e)]=_0x3d7fce[0x1],_0x14a248[_0x5c0411][_0x4c25d5(0x80)]=0x0,_0x14a248[_0x5c0411][_0x4c25d5(0x6f)]=0x0,_0x14a248[_0x5c0411][_0x4c25d5(0xf7)]=_0x4c25d5(0x77),_0x14a248[_0x5c0411]['floorlevel']=_0x3d7fce[0x5];}else{if(_0x5c0411==_0x4d899f){var _0x5408ee;if(_0x3d7fce[0x4]=='L')_0x5408ee=_0x4c25d5(0x11e);else _0x3d7fce[0x4]=='F'&&(_0x5408ee='Floor');_0x14a248[_0x5c0411]['storage']=_0x3d7fce[0x0],_0x14a248[_0x5c0411][_0x4c25d5(0x9e)]=_0x3d7fce[0x1],_0x14a248[_0x5c0411][_0x4c25d5(0x80)]=_0x3d7fce[0x2],_0x14a248[_0x5c0411]['bin']=_0x3d7fce[0x3],_0x14a248[_0x5c0411][_0x4c25d5(0xf7)]=_0x5408ee,_0x14a248[_0x5c0411][_0x4c25d5(0xbb)]=_0x3d7fce[0x5];}}}});}),_0x47c826[_0x27e124(0x14f)]((_0x5629b2,_0x2e7943)=>{var _0x527c27=_0x27e124;_0x14a248[_0x2e7943][_0x527c27(0x15c)]=_0x5629b2;}),_0x5710b4[_0x27e124(0x14f)]((_0x15d087,_0x4719d1)=>{var _0x4f8e0c=_0x27e124;_0x14a248[_0x4719d1][_0x4f8e0c(0x161)]=_0x15d087;}),_0x3f3d43[_0x27e124(0x14f)]((_0x443596,_0x1c2f3f)=>{var _0x22e8c8=_0x27e124;_0x14a248[_0x1c2f3f][_0x22e8c8(0x167)]=_0x443596;}),_0x45ac72[_0x27e124(0x14f)]((_0x3efdb4,_0x205302)=>{var _0x2909c7=_0x27e124;_0x14a248[_0x205302][_0x2909c7(0x129)]=_0x3efdb4;}),_0x2a20df[_0x27e124(0x14f)]((_0xd88206,_0x21eb75)=>{_0x14a248[_0x21eb75]['maxperunit']=_0xd88206;}),_0x23abd7[_0x27e124(0x14f)]((_0xff95b0,_0x58fec1)=>{var _0x4a87e3=_0x27e124;_0x14a248[_0x58fec1][_0x4a87e3(0xc2)]=_0xff95b0;}),_0x2b28c6[_0x27e124(0x14f)]((_0x1a97ae,_0x5a7111)=>{var _0x152e11=_0x27e124;_0x14a248[_0x5a7111][_0x152e11(0xee)]=Math[_0x152e11(0xaf)](_0x1a97ae);}),_0xbe67ab['forEach']((_0x4d7242,_0x4bdbc0)=>{_0x14a248[_0x4bdbc0]['delivery_date']=_0x4d7242;}),_0x1a3203['forEach']((_0x6d7d86,_0x4634ec)=>{var _0x5da4fa=_0x27e124;_0x14a248[_0x4634ec][_0x5da4fa(0x128)]=_0x6d7d86;}),_0x164952[_0x27e124(0x14f)]((_0x25fd2f,_0x1ebad9)=>{var _0x25225c=_0x27e124;_0x14a248[_0x1ebad9][_0x25225c(0xb0)]=_0x25fd2f;}),_0x1a455d[_0x27e124(0x14f)]((_0x5bde75,_0x13bc92)=>{var _0x153f21=_0x27e124;_0x14a248[_0x13bc92][_0x153f21(0xf3)]=_0x5bde75;}),_0x15899a['forEach']((_0x4e3097,_0x5ab36c)=>{var _0x23be8c=_0x27e124;_0x14a248[_0x5ab36c][_0x23be8c(0x99)]=_0x4e3097;});var _0x4fe335=0x0;_0x14a248['forEach'](_0x722713=>{var _0x5eafb1=_0x27e124;console[_0x5eafb1(0x110)](_0x5eafb1(0xff),_0x722713),(parseInt(_0x722713[_0x5eafb1(0x163)])<parseInt(_0x722713['quantity'])||parseInt(_0x722713[_0x5eafb1(0xfb)])==0x0)&&_0x4fe335++;});if(_0x4fe335!=0x0)return _0x482889[_0x27e124(0x95)](_0x27e124(0xb6),_0x27e124(0xdf)),_0x391b5d[_0x27e124(0x85)]('back');const _0x5b1cdc=_0x14a248[_0x27e124(0x101)](_0x5972df=>_0x5972df[_0x27e124(0xfb)]!=='0'&&_0x5972df[_0x27e124(0xfb)]!=='');_0x501379[_0x27e124(0x14c)]=_0x2bca66,_0x501379['customer']=_0x3c6172,_0x501379['date']=_0x1f0bcf,_0x501379[_0x27e124(0x168)]=_0x1631da,_0x501379[_0x27e124(0x70)]=_0x5b1cdc,_0x501379[_0x27e124(0x8f)]=_0x30d504,_0x501379[_0x27e124(0xcc)]=_0x5f5bde,_0x501379[_0x27e124(0xa6)]=_0x27e124(0xc5),_0x501379[_0x27e124(0x15a)]=_0x27e124(0xc5);const _0x255c86=await _0x501379[_0x27e124(0x13d)]();_0x482889[_0x27e124(0x95)](_0x27e124(0x121),_0x27e124(0x157)),_0x391b5d[_0x27e124(0x85)](_0x27e124(0x9d));}catch(_0x5b5363){console[_0x27e124(0x110)](_0x5b5363);}}),router[a0_0x5180e1(0x10b)]('/give_payment/:id',auth,async(_0x5d77fa,_0x165979)=>{var _0x52b5f6=a0_0x5180e1;try{const _0x355d3a=_0x5d77fa[_0x52b5f6(0x12d)]['id'],{invoice:_0x4d838b,customer:_0x3cbffb,receivable_amount:_0x15095b,received_amount:_0x45d004}=_0x5d77fa[_0x52b5f6(0x135)],_0x210fcd=await sales[_0x52b5f6(0x120)](_0x355d3a);console[_0x52b5f6(0x110)](_0x210fcd);var _0x4ede4e=_0x15095b-_0x45d004;console[_0x52b5f6(0x110)](_0x45d004),_0x210fcd[_0x52b5f6(0x67)]=parseFloat(_0x45d004)+parseFloat(_0x210fcd[_0x52b5f6(0x67)]),_0x210fcd[_0x52b5f6(0x15f)]=_0x4ede4e,console[_0x52b5f6(0x110)](_0x210fcd);const _0x1379c0=await _0x210fcd['save'](),_0x44bb86=await c_payment_data[_0x52b5f6(0xf6)]({'invoice':_0x4d838b});_0x44bb86['amount']=_0x4ede4e,await _0x44bb86['save']();let _0x885d59=new Date(),_0x38d893=('0'+_0x885d59[_0x52b5f6(0xab)]())[_0x52b5f6(0xba)](-0x2),_0x4781f8=('0'+(_0x885d59[_0x52b5f6(0xd6)]()+0x1))['slice'](-0x2),_0x425cec=_0x885d59[_0x52b5f6(0x10c)](),_0x4a4fc4=_0x425cec+'-'+_0x4781f8+'-'+_0x38d893;const _0x24c58b=new customer_payment({'invoice':_0x4d838b,'date':_0x425cec+'-'+_0x4781f8+'-'+_0x38d893,'customer':_0x3cbffb,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x45d004}),_0x38045d=await _0x24c58b[_0x52b5f6(0x13d)]();_0x5d77fa['flash'](_0x52b5f6(0x121),_0x52b5f6(0x7c)),_0x165979[_0x52b5f6(0x85)](_0x52b5f6(0x9d));}catch(_0x1b6ce3){console['log'](_0x1b6ce3);}}),router[a0_0x5180e1(0x123)](a0_0x5180e1(0x79),auth,async(_0x3230fa,_0x2f33a)=>{var _0x13833b=a0_0x5180e1;try{const {username:_0x530618,email:_0x3fdf4f,role:_0x40ca92}=_0x3230fa[_0x13833b(0x6a)],_0x598438=_0x3230fa[_0x13833b(0x6a)],_0xc3a8a5=await profile[_0x13833b(0xf6)]({'email':_0x598438[_0x13833b(0x114)]}),_0x920010=await master_shop[_0x13833b(0xe8)]();console['log'](_0x13833b(0x8c),_0x920010);const _0x3bea07=_0x3230fa[_0x13833b(0x12d)]['id'],_0x246b30=await sales[_0x13833b(0x120)](_0x3bea07);console[_0x13833b(0x110)](_0x246b30);const _0x279d8a=await customer[_0x13833b(0xf6)]({'name':_0x246b30[_0x13833b(0xde)]});console[_0x13833b(0x110)](_0x279d8a);if(_0x920010[0x0][_0x13833b(0x12e)]==_0x13833b(0x134)){var _0x39f0fb=users[_0x13833b(0x16c)];console[_0x13833b(0x110)](_0x39f0fb);}else{if(_0x920010[0x0][_0x13833b(0x12e)]==_0x13833b(0xf1))var _0x39f0fb=users['Hindi'];else{if(_0x920010[0x0][_0x13833b(0x12e)]==_0x13833b(0x9b))var _0x39f0fb=users['German'];else{if(_0x920010[0x0][_0x13833b(0x12e)]==_0x13833b(0x11f))var _0x39f0fb=users[_0x13833b(0x11f)];else{if(_0x920010[0x0][_0x13833b(0x12e)]==_0x13833b(0xd7))var _0x39f0fb=users[_0x13833b(0xd7)];else{if(_0x920010[0x0][_0x13833b(0x12e)]=='Portuguese\x20(BR)')var _0x39f0fb=users[_0x13833b(0x159)];else{if(_0x920010[0x0]['language']==_0x13833b(0x6e))var _0x39f0fb=users[_0x13833b(0x6e)];else{if(_0x920010[0x0]['language']==_0x13833b(0x14a))var _0x39f0fb=users[_0x13833b(0x8a)];}}}}}}}_0x2f33a[_0x13833b(0x74)](_0x13833b(0x137),{'success':_0x3230fa['flash'](_0x13833b(0x121)),'errors':_0x3230fa['flash'](_0x13833b(0xb6)),'role':_0x598438,'profile':_0xc3a8a5,'master_shop':_0x920010,'customers':_0x279d8a,'sales':_0x246b30,'language':_0x39f0fb});}catch(_0x4df836){console[_0x13833b(0x110)](_0x4df836);}}),router[a0_0x5180e1(0x123)]('/view/return_sales/:id',auth,async(_0x5c30e5,_0x7d3c10)=>{var _0x4dfe6b=a0_0x5180e1;try{const {username:_0x4dfde5,email:_0x95d8c9,role:_0x259f58}=_0x5c30e5[_0x4dfe6b(0x6a)],_0x433cb6=_0x5c30e5[_0x4dfe6b(0x6a)],_0x19d0de=await profile['findOne']({'email':_0x433cb6['email']}),_0x25a853=await master_shop[_0x4dfe6b(0xe8)]();console['log']('master',_0x25a853);const _0x44a38b=_0x5c30e5[_0x4dfe6b(0x12d)]['id'];console[_0x4dfe6b(0x110)](_0x44a38b);const _0x52ec2a=await sales[_0x4dfe6b(0x120)](_0x44a38b);console[_0x4dfe6b(0x110)](_0x4dfe6b(0x11d),_0x52ec2a);const _0x24f927=await warehouse[_0x4dfe6b(0xdd)]([{'$match':{'name':_0x4dfe6b(0xa5),'room':_0x4dfe6b(0x147)}},{'$unwind':_0x4dfe6b(0x16b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4dfe6b(0xbf)},'product_stock':{'$first':_0x4dfe6b(0x87)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x4dfe6b(0xa8)},'pallet':{'$first':_0x4dfe6b(0x14d)},'primary_code':{'$first':_0x4dfe6b(0x71)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4dfe6b(0x13e)}}}]);console[_0x4dfe6b(0x110)]('stock_data',_0x24f927);const _0x45641c=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x4dfe6b(0xa4)}}},{'$sort':{'name':0x1}}]);var _0x2d411f=[_0x4dfe6b(0x147)];if(_0x25a853[0x0][_0x4dfe6b(0x12e)]=='English\x20(US)'){var _0xbcf1=users['English'];console[_0x4dfe6b(0x110)](_0xbcf1);}else{if(_0x25a853[0x0][_0x4dfe6b(0x12e)]==_0x4dfe6b(0xf1))var _0xbcf1=users['Hindi'];else{if(_0x25a853[0x0]['language']==_0x4dfe6b(0x9b))var _0xbcf1=users['German'];else{if(_0x25a853[0x0]['language']==_0x4dfe6b(0x11f))var _0xbcf1=users[_0x4dfe6b(0x11f)];else{if(_0x25a853[0x0][_0x4dfe6b(0x12e)]==_0x4dfe6b(0xd7))var _0xbcf1=users['French'];else{if(_0x25a853[0x0][_0x4dfe6b(0x12e)]==_0x4dfe6b(0xcd))var _0xbcf1=users[_0x4dfe6b(0x159)];else{if(_0x25a853[0x0][_0x4dfe6b(0x12e)]==_0x4dfe6b(0x6e))var _0xbcf1=users['Chinese'];else{if(_0x25a853[0x0]['language']=='Arabic\x20(ae)')var _0xbcf1=users['Arabic'];}}}}}}}_0x7d3c10[_0x4dfe6b(0x74)](_0x4dfe6b(0x112),{'success':_0x5c30e5[_0x4dfe6b(0x95)](_0x4dfe6b(0x121)),'errors':_0x5c30e5[_0x4dfe6b(0x95)](_0x4dfe6b(0xb6)),'role':_0x433cb6,'profile':_0x19d0de,'user':_0x52ec2a,'stock':_0x24f927,'master_shop':_0x25a853,'unit':_0x45641c,'language':_0xbcf1,'warehouses':warehouse_data,'rooms':_0x2d411f});}catch(_0x13a16d){console[_0x4dfe6b(0x110)](_0x13a16d),_0x7d3c10[_0x4dfe6b(0x12a)](0xc8)['json']({'message':_0x13a16d[_0x4dfe6b(0x7b)]});}}),router[a0_0x5180e1(0x10b)](a0_0x5180e1(0x155),auth,async(_0x58a0d3,_0x49bed7)=>{var _0x198cd9=a0_0x5180e1;try{const {invoice:_0x58b41c,date:_0x3da9fd,warehouse_name:_0x35a3b7,product_name:_0x11ed62,primary_code:_0x5e24c7,secondary_code:_0x184449,product_code:_0x2b3c75,sales_quantity:_0x3fd3cb,stocks:_0x2781fb,return_qty:_0x51529e,Room_name:_0xa124ff,to_warehouse_name:_0x29ba95,to_Roomname:_0x3f40df,to_Room_name:_0x4b4c69,note:_0x366b76,level:_0xa1b901,isle:_0x23a1fe,pallet:_0x4ef92e}=_0x58a0d3[_0x198cd9(0x135)];if(typeof _0x11ed62=='string')var _0x101deb=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0xce)]],_0x2d6c67=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x65)]],_0x5b58e9=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x96)]],_0x4976d6=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x8d)]],_0x46e7e3=[_0x58a0d3['body'][_0x198cd9(0xf9)]],_0x187119=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x12c)]],_0x11d33b=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x122)]],_0x18088d=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x80)]],_0x329687=[_0x58a0d3['body']['bin']],_0x541d83=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0xc9)]],_0x39ab82=[_0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0xbb)]];else var _0x101deb=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0xce)]],_0x2d6c67=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x65)]],_0x5b58e9=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x96)]],_0x4976d6=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x8d)]],_0x46e7e3=[..._0x58a0d3[_0x198cd9(0x135)]['sales_quantity']],_0x187119=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x12c)]],_0x11d33b=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x122)]],_0x18088d=[..._0x58a0d3['body'][_0x198cd9(0x80)]],_0x329687=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0x6f)]],_0x541d83=[..._0x58a0d3[_0x198cd9(0x135)][_0x198cd9(0xc9)]],_0x39ab82=[..._0x58a0d3['body'][_0x198cd9(0xbb)]];const _0xee3a73=_0x101deb[_0x198cd9(0xb1)](_0x198834=>{return _0x198834={'product_name':_0x198834};});_0x2d6c67[_0x198cd9(0x14f)]((_0x19f832,_0x4596eb)=>{var _0x5cc61e=_0x198cd9;_0xee3a73[_0x4596eb][_0x5cc61e(0x65)]=_0x19f832;}),_0x5b58e9['forEach']((_0x3e90da,_0x5d1c80)=>{var _0x416fd3=_0x198cd9;_0xee3a73[_0x5d1c80][_0x416fd3(0x96)]=_0x3e90da;}),_0x4976d6['forEach']((_0x3140d2,_0x6522b3)=>{_0xee3a73[_0x6522b3]['product_code']=_0x3140d2;}),_0x46e7e3[_0x198cd9(0x14f)]((_0x200235,_0x5b1afc)=>{var _0x355bcb=_0x198cd9;_0xee3a73[_0x5b1afc][_0x355bcb(0x140)]=_0x200235;}),_0x187119[_0x198cd9(0x14f)]((_0x4835b8,_0x189415)=>{var _0x2e5f85=_0x198cd9;_0xee3a73[_0x189415][_0x2e5f85(0x163)]=_0x4835b8;}),_0x11d33b[_0x198cd9(0x14f)]((_0x32f038,_0x10d46a)=>{var _0x22efa4=_0x198cd9;_0xee3a73[_0x10d46a][_0x22efa4(0x122)]=_0x32f038;}),_0x18088d[_0x198cd9(0x14f)]((_0x3a8140,_0x4de6ca)=>{_0xee3a73[_0x4de6ca]['bay']=_0x3a8140;}),_0x329687[_0x198cd9(0x14f)]((_0x30accc,_0x4f1ff8)=>{var _0x11a9bf=_0x198cd9;_0xee3a73[_0x4f1ff8][_0x11a9bf(0x6f)]=_0x30accc;}),_0x541d83[_0x198cd9(0x14f)]((_0x35a97b,_0xbb11f2)=>{var _0x372139=_0x198cd9;_0xee3a73[_0xbb11f2][_0x372139(0xf7)]=_0x35a97b;}),_0x39ab82[_0x198cd9(0x14f)]((_0x254ae2,_0x5ab4c2)=>{_0xee3a73[_0x5ab4c2]['floorlevel']=_0x254ae2;});var _0x25f14d=0x0;_0xee3a73[_0x198cd9(0x14f)](_0x5c467b=>{var _0x4b97d=_0x198cd9;console[_0x4b97d(0x110)](_0x4b97d(0xff),_0x5c467b),(parseInt(_0x5c467b[_0x4b97d(0x140)])<parseInt(_0x5c467b[_0x4b97d(0x122)])||parseInt(_0x5c467b['stock'])<parseInt(_0x5c467b[_0x4b97d(0x122)])&&parseInt(_0x5c467b[_0x4b97d(0x140)])>parseInt(_0x5c467b[_0x4b97d(0x122)])||parseInt(_0x5c467b[_0x4b97d(0x122)])==0x0)&&_0x25f14d++;});if(_0x25f14d!=0x0)return _0x58a0d3[_0x198cd9(0x95)](_0x198cd9(0xb6),_0x198cd9(0xf0)),_0x49bed7[_0x198cd9(0x85)]('back');const _0x1a8575=await sales[_0x198cd9(0xf6)]({'invoice':_0x58b41c});console['log'](_0x1a8575),_0x1a8575['return_data']='True';const _0x2a7ab4=await _0x1a8575['save'](),_0x42e2f5=new sales_return({'invoice':_0x58b41c,'customer':_0x58a0d3['body'][_0x198cd9(0xde)],'date':_0x3da9fd,'warehouse_name':_0x35a3b7,'room':_0xa124ff,'ToWarehouse':_0x29ba95,'ToRoom':_0x4b4c69,'return_sale':_0xee3a73,'note':_0x366b76}),_0x465407=await _0x42e2f5['save']();console[_0x198cd9(0x110)](_0x42e2f5);const _0x188a4e=await sales_return[_0x198cd9(0xf6)]({'invoice':_0x58b41c}),_0xa93724=await warehouse[_0x198cd9(0xf6)]({'name':_0x29ba95,'room':_0x4b4c69});_0x188a4e[_0x198cd9(0x112)]['forEach'](_0x18cf69=>{var _0x39637f=_0x198cd9,_0x3f13d8=0x0;const _0x1348bb=_0xa93724[_0x39637f(0x7f)]['map'](_0x26dc47=>{var _0x5e2bec=_0x39637f;_0x26dc47[_0x5e2bec(0xce)]==_0x18cf69[_0x5e2bec(0xce)]&&_0x26dc47[_0x5e2bec(0xbb)]==_0x18cf69[_0x5e2bec(0xbb)]&&_0x26dc47['type']==_0x18cf69[_0x5e2bec(0xf7)]&&_0x26dc47[_0x5e2bec(0x6f)]==_0x18cf69[_0x5e2bec(0x6f)]&&_0x26dc47[_0x5e2bec(0x80)]==_0x18cf69[_0x5e2bec(0x80)]&&(_0x26dc47['product_stock']=parseInt(_0x26dc47[_0x5e2bec(0xd4)])+parseInt(_0x18cf69[_0x5e2bec(0x122)]),_0x3f13d8++);});_0x3f13d8=='0'&&(_0xa93724['product_details']=_0xa93724['product_details'][_0x39637f(0x9c)]({'product_name':_0x18cf69['product_name'],'product_stock':_0x18cf69[_0x39637f(0x122)],'primary_code':_0x18cf69[_0x39637f(0x65)],'secondary_code':_0x18cf69['secondary_code'],'product_code':_0x18cf69[_0x39637f(0x8d)],'bay':_0x18cf69[_0x39637f(0x80)],'bin':_0x18cf69[_0x39637f(0x6f)],'type':_0x18cf69[_0x39637f(0xf7)],'floorlevel':_0x18cf69[_0x39637f(0xbb)]})),console['log']('final',_0xa93724);}),await _0xa93724[_0x198cd9(0x13d)](),console[_0x198cd9(0x110)](_0x58a0d3[_0x198cd9(0x135)]);const _0x1c6f55=new c_payment_data({'invoice':_0x58b41c,'customer':_0x58a0d3['body']['customer'],'reason':_0x198cd9(0x142)});await _0x1c6f55[_0x198cd9(0x13d)]();const _0x456a5d=await master_shop[_0x198cd9(0xe8)]();console['log'](_0x198cd9(0xbe),_0x456a5d[0x0][_0x198cd9(0x91)]);const _0x2e2c04=await email_settings['findOne'](),_0x343cfc=await customer[_0x198cd9(0xf6)]({'name':_0x58a0d3['body'][_0x198cd9(0xde)]});console[_0x198cd9(0x110)](_0x198cd9(0x151),_0x343cfc);_0x456a5d[0x0]['currency_placement']==0x1?(right_currency=_0x456a5d[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x456a5d[0x0][_0x198cd9(0x104)]);var _0x396fe5=_0x101deb,_0x51c0bc=_0x11d33b,_0x48bf57='',_0x444dad;for(_0x444dad in _0x396fe5){_0x48bf57+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x396fe5[_0x444dad]+_0x198cd9(0xb4)+_0x198cd9(0x143)+_0x51c0bc[_0x444dad]+_0x198cd9(0xb4)+_0x198cd9(0xac);}console['log']('product_list',_0x48bf57);let _0x5edcac=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x2e2c04[_0x198cd9(0x114)],'pass':_0x2e2c04[_0x198cd9(0x116)]}}),_0x6df1db={'from':_0x2e2c04['email'],'to':_0x343cfc['email'],'subject':_0x198cd9(0xd2),'attachments':[{'filename':_0x198cd9(0x149),'path':__dirname+_0x198cd9(0xd9)+'/upload/'+_0x456a5d[0x0][_0x198cd9(0x91)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x198cd9(0x148)+_0x198cd9(0x133)+_0x198cd9(0x138)+_0x198cd9(0x150)+_0x198cd9(0x138)+_0x198cd9(0xec)+_0x198cd9(0x68)+_0x198cd9(0x138)+'<h2>\x20'+_0x456a5d[0x0][_0x198cd9(0x130)]+'\x20</h2>'+_0x198cd9(0x68)+_0x198cd9(0x68)+_0x198cd9(0xfd)+_0x198cd9(0x138)+_0x198cd9(0x8e)+_0x198cd9(0x106)+_0x58b41c+'\x20'+_0x198cd9(0x146)+'\x20Order\x20Date\x20:\x20'+_0x3da9fd+'\x20'+_0x198cd9(0x10f)+_0x198cd9(0x13b)+_0x198cd9(0x68)+_0x198cd9(0xc0)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x198cd9(0x16a)+_0x198cd9(0xc7)+_0x198cd9(0x69)+_0x198cd9(0x141)+_0x198cd9(0x139)+_0x198cd9(0xac)+_0x198cd9(0x158)+_0x198cd9(0x127)+'\x20'+_0x48bf57+'\x20'+_0x198cd9(0x11c)+'</table>'+_0x198cd9(0x138)+_0x198cd9(0xc8)+_0x198cd9(0x156)+_0x456a5d[0x0][_0x198cd9(0x130)]+_0x198cd9(0x13b)+_0x198cd9(0x68)+_0x198cd9(0x68)+'</body></html>'};_0x5edcac['sendMail'](_0x6df1db,function(_0x48529a,_0x96b049){var _0x40899f=_0x198cd9;_0x48529a?(console['log'](_0x48529a),console['log'](_0x40899f(0xd8))):console[_0x40899f(0x110)](_0x40899f(0xe5));}),_0x58a0d3[_0x198cd9(0x95)](_0x198cd9(0x121),'sales\x20item\x20return\x20successfull'),_0x49bed7[_0x198cd9(0x85)]('/all_sales/view');}catch(_0x133c38){console['log'](_0x133c38),_0x49bed7[_0x198cd9(0x12a)](0xc8)[_0x198cd9(0x13f)]({'message1':_0x133c38[_0x198cd9(0x7b)]});}}),router['get'](a0_0x5180e1(0x93),auth,async(_0x5309ac,_0x382a88)=>{var _0x3bf619=a0_0x5180e1;try{const {username:_0x173dc7,email:_0x190ab7,role:_0x3e82aa}=_0x5309ac[_0x3bf619(0x6a)],_0x29611b=_0x5309ac[_0x3bf619(0x6a)],_0x95e277=await profile[_0x3bf619(0xf6)]({'email':_0x29611b['email']}),_0xd85ed2=await master_shop[_0x3bf619(0xe8)]();console[_0x3bf619(0x110)](_0x3bf619(0x6b),_0xd85ed2);const _0x25958e=_0x5309ac[_0x3bf619(0x12d)]['id'],_0x41def7=await sales['findById'](_0x25958e);console[_0x3bf619(0x110)](_0x3bf619(0xc4),_0x41def7);if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0x134))var _0x44af28=users[_0x3bf619(0x16c)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0xf1))var _0x44af28=users[_0x3bf619(0xf1)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]=='German')var _0x44af28=users[_0x3bf619(0x9b)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0x11f))var _0x44af28=users[_0x3bf619(0x11f)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0xd7))var _0x44af28=users[_0x3bf619(0xd7)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0xcd))var _0x44af28=users[_0x3bf619(0x159)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0x6e))var _0x44af28=users[_0x3bf619(0x6e)];else{if(_0xd85ed2[0x0][_0x3bf619(0x12e)]==_0x3bf619(0x14a))var _0x44af28=users[_0x3bf619(0x8a)];}}}}}}}_0x382a88[_0x3bf619(0x74)]('all_sales_barcode',{'success':_0x5309ac[_0x3bf619(0x95)](_0x3bf619(0x121)),'errors':_0x5309ac['flash'](_0x3bf619(0xb6)),'role':_0x29611b,'profile':_0x95e277,'alldata':_0x41def7,'master_shop':_0xd85ed2,'language':_0x44af28});}catch(_0xc8ff7){console[_0x3bf619(0x110)](_0xc8ff7);}}),router[a0_0x5180e1(0x10b)](a0_0x5180e1(0xef),async(_0x223188,_0x4a5544)=>{var _0x5b0d50=a0_0x5180e1;const {product_code:_0x286061,warehouse_name:_0x3b74c8,rooms_data:_0x1c105e,Roomslist:_0x4e318f}=_0x223188[_0x5b0d50(0x135)],_0x5d2681=_0x4e318f[_0x5b0d50(0xb3)](','),_0x4cc0aa=[];async function _0x24d85c(_0x17d843){var _0x270227=_0x5b0d50;const _0x1e010e=await warehouse['aggregate']([{'$match':{'name':_0x3b74c8,'room':_0x17d843}},{'$unwind':_0x270227(0x16b)},{'$match':{'product_details.primary_code':_0x286061}},{'$group':{'_id':_0x270227(0x86),'name':{'$first':_0x270227(0xbf)},'product_stock':{'$first':_0x270227(0x87)},'primary_code':{'$first':_0x270227(0x71)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x270227(0x13e)},'level':{'$first':_0x270227(0x100)},'isle':{'$first':_0x270227(0xb8)},'type':{'$first':_0x270227(0xd1)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x270227(0x88)},'secondary_unit':{'$first':_0x270227(0x13c)},'storage':{'$first':_0x270227(0x90)},'rack':{'$first':_0x270227(0xd3)},'expiry_date':{'$first':_0x270227(0x15e)},'production_date':{'$first':_0x270227(0xcb)},'maxPerUnit':{'$first':_0x270227(0xe2)},'batch_code':{'$first':_0x270227(0xe0)},'product_cat':{'$first':_0x270227(0x105)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x270227(0x12b)},'actual_qty':{'$first':_0x270227(0xeb)},'actual_uom':{'$first':_0x270227(0xb7)}}}]),_0x465bc7=await warehouse[_0x270227(0xdd)]([{'$match':{'name':_0x3b74c8,'room':_0x17d843}},{'$unwind':_0x270227(0x16b)},{'$match':{'product_details.secondary_code':_0x286061}},{'$group':{'_id':_0x270227(0x86),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x270227(0x87)},'primary_code':{'$first':_0x270227(0x71)},'secondary_code':{'$first':_0x270227(0xae)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x270227(0x100)},'isle':{'$first':_0x270227(0xb8)},'type':{'$first':_0x270227(0xd1)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x270227(0x88)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x270227(0x90)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x270227(0xcb)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x270227(0xe0)},'product_cat':{'$first':_0x270227(0x105)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x270227(0xbc)},'invoice':{'$first':_0x270227(0x12b)}}}]);if(_0x1e010e[_0x270227(0xc3)]>0x0)_0x4cc0aa[_0x270227(0x153)](_0x1e010e);else _0x465bc7['length']>0x0&&_0x4cc0aa[_0x270227(0x153)](_0x465bc7);}const _0x2634e2=_0x5d2681[_0x5b0d50(0xb1)](_0xb80c14=>_0x24d85c(_0xb80c14));await Promise[_0x5b0d50(0xf5)](_0x2634e2),_0x4a5544[_0x5b0d50(0x13f)](_0x4cc0aa);}),module[a0_0x5180e1(0xc6)]=router;