var a0_0x205708=a0_0x14ac;function a0_0x1c38(){var _0x5de8ce=['/../public','$product_details.rack','$product_details.product_name','message','currency_placement','id_transaction_from','storage','quantity_notConverted','edit_sales_view','all','$product_details.bay','all_sales_barcode','/invoice/:id','all_sales','<span\x20style=\x22float:\x20right;\x22>','$sale_product.quantity','</thead>','</h5>','delivery_date','Portuguese','/preview/:id','Level','user','forEach','bay','actual_uom','primary_unit','<h5>','warehouse','$product_details._id','/view/:id','582xUvaER','then','<!DOCTYPE\x20html>','render','post','_id','length','flash','$sale_product','$product_details','</table>','push','$product_details.actual_uom','master','Receiving\x20Area','$product_details.product_cat','Floor','rack','$product_details.primary_code','/view/return_sales/:id','Email\x20sent\x20successfully','save','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Spanish','sales_invoice','SCRN','aggregate','Router','sales_quantity','success','$customers_docs','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','currency','$return_data','max','Received\x20Payment\x20For\x20Sale','production_date','$product','product','warehouse_name','/view','getFullYear','carton','English\x20(US)','actual_qty','payment\x20successfull','/upload/','OUT-','log','padStart','customer_data','name','An\x20error\x20occurred\x20while\x20saving\x20data.','bin','type','image','get','884uZUvUO','French','376YmkjfD','level','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','logo','/all_sales/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.unit','find','site_title','secondary_unit','Arabic\x20(ae)','floorlevel','$sale_product.bay','redirect','stock','error','password','sales\x20all_data','$product_details.expiry_date','Enclosed','Enabled','<div>','Hindi','$product.product_name','stock_data','express','room','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Portuguese\x20(BR)','requested_qty','nodemailer','13HxGKMm','getMonth','body','$product_details.secondary_code','Sales\x20Mail','18wiROfh','</tr>','expiry_date','prod_code','$finalize','/all_sales/preview/','False','return_sale','return_data','max_per_unit','catch','customers_docs','$warehouse_name','isAllowEdit','5398876utrsRO','status','<hr\x20class=\x22my-3\x22>','/barcode_scanner','$note','Return\x20Rooms','<html><head><title></title>','abs','$product_details.production_date','</div>','params','errors','$product_details.floorlevel','Chinese','stocks','types','\x20Order\x20Number\x20:\x20','$sale_product.bin','sale_qty','21cvvaki','product_name','Sale\x20Return\x20Mail','prod_cat','delivery_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_sale/product','Shelves','amount','Error\x20Occurs','room_name','findOne','received_amount','True','Return\x20Goods','filter','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$name','back','/view/add_sales','$product_details.bin','map','<tr>','final','<h5\x20style=\x22text-align:\x20left;\x22>','German','sales\x20item\x20return\x20successfull','$product_details.storage','purchases_data','product_details','<tbody\x20style=\x22text-align:\x20center;\x22>','377395jlKSFL','product_list','date','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Raw\x20Materials','$product_details.level','product_code','RoomAssigned','English','secondary_code','\x20</h2>','customers','staff','1681224YLqpPY','6olGPyM','RMSEmail','33026AUwEme','$product_details.batch_code','product_stock','add\x20post','$product_details.type','return_qty','Ambient','primary_code','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','</head><body>','11QpbpuP','sendMail','$product_details.maxPerUnit','barcode\x20user_id','</td>','Sales\x20Update\x20successfully','quantity','customer','$isAllowEdit','slice','note','21604SCbItl','getDate','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$date','Sale\x20Return','language','findById','email','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../models/all_models','$product_details.product_stock','\x20Order\x20Date\x20:\x20','</span>','</body></html>','unit','json','sale_product','edit_sales','$invoice','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','1437350pWtjTu','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','role','$room','$sale_product.type','batch_code','add_sales','host','string','$product_details.invoice','$product_details.secondary_unit','split','concat','Logo.png','floor','invoice','foreach\x20newproduct','maxperunit','Arabic','user_id'];a0_0x1c38=function(){return _0x5de8ce;};return a0_0x1c38();}(function(_0x40a55c,_0xf67262){var _0x3a9ce2=a0_0x14ac,_0x3b2098=_0x40a55c();while(!![]){try{var _0xa4cd5e=parseInt(_0x3a9ce2(0x17a))/0x1*(-parseInt(_0x3a9ce2(0x1b4))/0x2)+parseInt(_0x3a9ce2(0xeb))/0x3*(parseInt(_0x3a9ce2(0x130))/0x4)+parseInt(_0x3a9ce2(0x10b))/0x5*(parseInt(_0x3a9ce2(0x119))/0x6)+parseInt(_0x3a9ce2(0x11b))/0x7*(-parseInt(_0x3a9ce2(0x1b6))/0x8)+parseInt(_0x3a9ce2(0x1da))/0x9*(parseInt(_0x3a9ce2(0x147))/0xa)+parseInt(_0x3a9ce2(0x125))/0xb*(-parseInt(_0x3a9ce2(0x118))/0xc)+-parseInt(_0x3a9ce2(0x1d5))/0xd*(-parseInt(_0x3a9ce2(0x1e8))/0xe);if(_0xa4cd5e===_0xf67262)break;else _0x3b2098['push'](_0x3b2098['shift']());}catch(_0x123d90){_0x3b2098['push'](_0x3b2098['shift']());}}}(a0_0x1c38,0x28d82));const express=require(a0_0x205708(0x1cf)),app=express(),router=express[a0_0x205708(0x195)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x205708(0x13b)),auth=require('../middleware/auth'),nodemailer=require(a0_0x205708(0x1d4)),users=require('../public/language/languages.json');function a0_0x14ac(_0x571a60,_0x50d51d){var _0x1c3819=a0_0x1c38();return a0_0x14ac=function(_0x14ac05,_0x4f4355){_0x14ac05=_0x14ac05-0xdb;var _0x2b5ace=_0x1c3819[_0x14ac05];return _0x2b5ace;},a0_0x14ac(_0x571a60,_0x50d51d);}router[a0_0x205708(0x1b3)](a0_0x205708(0x1a3),auth,async(_0x47b60d,_0x5550a0)=>{var _0x4c5ad9=a0_0x205708;try{const {username:_0x48aff4,email:_0xfe1c14,role:_0x1b3087}=_0x47b60d[_0x4c5ad9(0x171)],_0x20988e=_0x47b60d[_0x4c5ad9(0x171)],_0x49c882=await profile['findOne']({'email':_0x20988e[_0x4c5ad9(0x138)]}),_0x3b33b1=await master_shop[_0x4c5ad9(0x1bd)]();let _0x523749;if(_0x20988e[_0x4c5ad9(0x149)]==_0x4c5ad9(0x117)){const _0x4f77d1=await staff[_0x4c5ad9(0xf6)]({'email':_0x20988e['email']});_0x523749=await sales[_0x4c5ad9(0x194)]([{'$lookup':{'from':_0x4c5ad9(0x116),'localField':'customer','foreignField':_0x4c5ad9(0x1ae),'as':_0x4c5ad9(0x1e5)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x4c5ad9(0x144)},'customers':{'$first':'$customer'},'date':{'$first':_0x4c5ad9(0x134)},'warehouse_name':{'$first':_0x4c5ad9(0x1e6)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4c5ad9(0xdc)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x4c5ad9(0x198)},'total_saleproduct_quantity':{'$sum':_0x4c5ad9(0x16a)},'level':{'$addToSet':_0x4c5ad9(0x1c2)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x4c5ad9(0x1de)},'isAllowEdit':{'$first':_0x4c5ad9(0x12d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x523749=await sales[_0x4c5ad9(0x194)]([{'$lookup':{'from':_0x4c5ad9(0x116),'localField':_0x4c5ad9(0x12c),'foreignField':_0x4c5ad9(0x1ae),'as':_0x4c5ad9(0x1e5)}},{'$unwind':'$customers_docs'},{'$unwind':_0x4c5ad9(0x182)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x4c5ad9(0x134)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4c5ad9(0xdc)},'return_data':{'$first':_0x4c5ad9(0x19c)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x4c5ad9(0x16a)},'level':{'$addToSet':_0x4c5ad9(0x1c2)},'isle':{'$addToSet':_0x4c5ad9(0xe9)},'type':{'$addToSet':_0x4c5ad9(0x14b)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x4c5ad9(0x12d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4c5ad9(0x1ab)](_0x4c5ad9(0x1c7),_0x523749);if(_0x3b33b1[0x0][_0x4c5ad9(0x136)]==_0x4c5ad9(0x1a6)){var _0x12196d=users[_0x4c5ad9(0x113)];console[_0x4c5ad9(0x1ab)](_0x12196d);}else{if(_0x3b33b1[0x0]['language']==_0x4c5ad9(0x1cc))var _0x12196d=users['Hindi'];else{if(_0x3b33b1[0x0][_0x4c5ad9(0x136)]=='German')var _0x12196d=users[_0x4c5ad9(0x105)];else{if(_0x3b33b1[0x0]['language']==_0x4c5ad9(0x191))var _0x12196d=users[_0x4c5ad9(0x191)];else{if(_0x3b33b1[0x0][_0x4c5ad9(0x136)]=='French')var _0x12196d=users[_0x4c5ad9(0x1b5)];else{if(_0x3b33b1[0x0][_0x4c5ad9(0x136)]=='Portuguese\x20(BR)')var _0x12196d=users[_0x4c5ad9(0x16e)];else{if(_0x3b33b1[0x0][_0x4c5ad9(0x136)]=='Chinese')var _0x12196d=users[_0x4c5ad9(0xe5)];else{if(_0x3b33b1[0x0][_0x4c5ad9(0x136)]==_0x4c5ad9(0x1c0))var _0x12196d=users[_0x4c5ad9(0x159)];}}}}}}}_0x5550a0['render'](_0x4c5ad9(0x168),{'success':_0x47b60d['flash']('success'),'errors':_0x47b60d['flash'](_0x4c5ad9(0xe3)),'sales':_0x523749,'profile':_0x49c882,'role':_0x20988e,'master_shop':_0x3b33b1,'language':_0x12196d});}catch(_0x2d7d99){console[_0x4c5ad9(0x1ab)](_0x2d7d99);}});async function getRandom8DigitNumber(){var _0x293bab=a0_0x205708;const _0x3bfc6d=0x989680,_0x3ca42b=0x5f5e0ff,_0x45796f=Math[_0x293bab(0x155)](Math['random']()*(_0x3ca42b-_0x3bfc6d+0x1))+_0x3bfc6d;var _0x1e35bc;const _0x1a5fa4=await sales[_0x293bab(0xf6)]({'invoice':_0x293bab(0x1aa)+_0x45796f});return _0x1a5fa4&&_0x1a5fa4[_0x293bab(0x180)]>0x0?_0x1e35bc=_0x293bab(0x1aa)+_0x45796f:_0x1e35bc=_0x293bab(0x1aa)+_0x45796f,_0x1e35bc;}router[a0_0x205708(0x1b3)](a0_0x205708(0xff),auth,async(_0x536864,_0x3f1eb7)=>{var _0x3501ce=a0_0x205708;try{const {username:_0x189b15,email:_0x3e7a4a,role:_0x323246}=_0x536864[_0x3501ce(0x171)],_0x2a5eb6=_0x536864['user'],_0x4233d7=await profile[_0x3501ce(0xf6)]({'email':_0x2a5eb6['email']}),_0x48a478=await master_shop['find'](),_0x89d0a8=await customer[_0x3501ce(0x1bd)]({});let _0xf1e0da;if(_0x2a5eb6[_0x3501ce(0x149)]==_0x3501ce(0x117)){const _0x5f2120=await staff[_0x3501ce(0xf6)]({'email':_0x2a5eb6[_0x3501ce(0x138)]});_0xf1e0da=await warehouse[_0x3501ce(0x194)]([{'$match':{'status':'Enabled','name':_0x5f2120[_0x3501ce(0x177)],'warehouse_category':_0x3501ce(0x10f),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x3501ce(0xfd)}}},{'$sort':{'name':0x1}}]);}else _0xf1e0da=await warehouse['aggregate']([{'$match':{'status':_0x3501ce(0x1ca),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3501ce(0xf9)}}},{'$group':{'_id':_0x3501ce(0xfd),'name':{'$first':_0x3501ce(0xfd)}}},{'$sort':{'name':0x1}}]);const _0x4cba33=await product[_0x3501ce(0x1bd)]({});var _0x115aac=[_0x3501ce(0x121),'Enclosed'];const _0x502a6b=await sales['find']({}),_0x319fa7=_0x502a6b[_0x3501ce(0x180)]+0x1,_0x572548=_0x3501ce(0x1aa)+_0x319fa7['toString']()[_0x3501ce(0x1ac)](0x5,'0');if(_0x48a478[0x0][_0x3501ce(0x136)]==_0x3501ce(0x1a6)){var _0x24d5c8=users['English'];console[_0x3501ce(0x1ab)](_0x24d5c8);}else{if(_0x48a478[0x0]['language']==_0x3501ce(0x1cc))var _0x24d5c8=users[_0x3501ce(0x1cc)];else{if(_0x48a478[0x0][_0x3501ce(0x136)]==_0x3501ce(0x105))var _0x24d5c8=users[_0x3501ce(0x105)];else{if(_0x48a478[0x0][_0x3501ce(0x136)]=='Spanish')var _0x24d5c8=users[_0x3501ce(0x191)];else{if(_0x48a478[0x0][_0x3501ce(0x136)]=='French')var _0x24d5c8=users[_0x3501ce(0x1b5)];else{if(_0x48a478[0x0][_0x3501ce(0x136)]==_0x3501ce(0x1d2))var _0x24d5c8=users[_0x3501ce(0x16e)];else{if(_0x48a478[0x0]['language']==_0x3501ce(0xe5))var _0x24d5c8=users[_0x3501ce(0xe5)];else{if(_0x48a478[0x0][_0x3501ce(0x136)]=='Arabic\x20(ae)')var _0x24d5c8=users['Arabic'];}}}}}}}const _0x3a3128=getRandom8DigitNumber();_0x3a3128[_0x3501ce(0x17b)](_0x5230e1=>{var _0x30bd9b=_0x3501ce;_0x3f1eb7['render'](_0x30bd9b(0x14d),{'success':_0x536864[_0x30bd9b(0x181)](_0x30bd9b(0x197)),'errors':_0x536864[_0x30bd9b(0x181)](_0x30bd9b(0xe3)),'role':_0x2a5eb6,'profile':_0x4233d7,'customer':_0x89d0a8,'warehouse':_0xf1e0da,'product':_0x4cba33,'invoice':_0x5230e1,'master_shop':_0x48a478,'language':_0x24d5c8,'rooms_data':_0x115aac});})[_0x3501ce(0x1e4)](_0x1521e8=>{var _0x8131c5=_0x3501ce;_0x536864[_0x8131c5(0x181)](_0x8131c5(0xe3),_0x8131c5(0x190)),_0x3f1eb7[_0x8131c5(0x1c3)]('/all_sales/view');});}catch(_0x41b34a){console[_0x3501ce(0x1ab)](_0x41b34a);}}),router[a0_0x205708(0x1b3)]('/view/add_sales/:id',auth,async(_0x389a49,_0x10f0ec)=>{var _0x41875d=a0_0x205708;try{const _0x5b9698=_0x389a49[_0x41875d(0xe2)]['id'];console['log'](_0x5b9698);const _0x594934=await product[_0x41875d(0x1bd)](),_0x1d63a7=await purchases[_0x41875d(0x194)]([{'$match':{'warehouse_name':_0x5b9698}},{'$unwind':_0x41875d(0x1a0)},{'$group':{'_id':_0x41875d(0x1cd)}}]);console[_0x41875d(0x1ab)](_0x41875d(0x108),_0x1d63a7),_0x10f0ec[_0x41875d(0x1e9)](0xc8)[_0x41875d(0x141)]({'purchases_data':_0x1d63a7,'product_data':_0x594934});}catch(_0x5b9a6f){console['log'](_0x5b9a6f);}}),router[a0_0x205708(0x17e)](a0_0x205708(0xf1),auth,async(_0x302fcc,_0x557b3c)=>{var _0xe0008c=a0_0x205708;try{const {warehouse_data:_0x15e45f,product_data:_0x1cd271}=_0x302fcc[_0xe0008c(0x1d7)];console['log'](_0x302fcc['body']['product_data']);;const _0x2d8257=await master_shop[_0xe0008c(0x1bd)]();console[_0xe0008c(0x1ab)](_0xe0008c(0x187),_0x2d8257);const _0x276a71=await product['findOne']({'name':_0x1cd271});console['log'](_0xe0008c(0x1a1),_0x276a71);const _0x3b9c5d=await warehouse[_0xe0008c(0x194)]([{'$match':{'name':_0x15e45f}},{'$unwind':_0xe0008c(0x183)},{'$match':{'product_details.product_name':_0x1cd271}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0xe0008c(0x13c)}}}]);console[_0xe0008c(0x1ab)](_0xe0008c(0x1ce),_0x3b9c5d),_0x557b3c['status'](0xc8)[_0xe0008c(0x141)]({'master':_0x2d8257,'new_product':_0x276a71,'stock_data':_0x3b9c5d});}catch(_0x46d2c8){console[_0xe0008c(0x1ab)](_0x46d2c8);}}),router['post'](a0_0x205708(0xff),auth,async(_0x37c185,_0x2dbc17)=>{var _0x2f48ee=a0_0x205708;try{const {invoice:_0x43d075,date:_0x1649a7,warehouse_name:_0x201ac5,product_name:_0x394ff1,stock:_0x574f0f,quantity:_0x42ef71,note:_0x5342cf,room:_0x41621f,primary_code:_0x4aeadc,secondary_code:_0x4d7a9c,prod_code:_0x5df254,level:_0x1ffb78,isle:_0x215320,pallet:_0x207563,batch_code:_0x3d6a23,SCRN:_0x185af6,expiry_date:_0x24c568}=_0x37c185['body'];if(typeof _0x394ff1=='string')var _0x2627a3=[_0x37c185[_0x2f48ee(0x1d7)]['product_name']],_0x436e75=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1c4)]],_0x17321d=[_0x37c185['body']['carton']],_0x2ccb28=[_0x37c185[_0x2f48ee(0x1d7)]['primary_code']],_0x83c1c0=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x114)]],_0x4bd96d=[_0x37c185['body'][_0x2f48ee(0x1dd)]],_0x20ff5c=[_0x37c185['body'][_0x2f48ee(0x1b7)]],_0x1848f6=[_0x37c185['body']['primary_unit']],_0x21d45a=[_0x37c185['body']['secondary_unit']],_0x1d01a8=[_0x37c185['body'][_0x2f48ee(0x14c)]],_0x2a1116=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1dc)]],_0x88d20e=[_0x37c185['body'][_0x2f48ee(0x1e3)]],_0x2cff54=[_0x37c185[_0x2f48ee(0x1d7)]['production_date']],_0x5d2f93=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1d3)]],_0x25880a=[_0x37c185[_0x2f48ee(0x1d7)]['delivery_date']],_0x5d5c89=[_0x37c185['body'][_0x2f48ee(0xef)]],_0x2f494e=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0xee)]],_0x11cc92=[_0x37c185['body'][_0x2f48ee(0x12b)]],_0x236100=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x112)]],_0x5330e3=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x139)]],_0x5909d4=[_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1a7)]],_0x12bf3b=[_0x37c185[_0x2f48ee(0x1d7)]['actual_uom']],_0x445a98=[_0x37c185[_0x2f48ee(0x1d7)]['id_transact']];else var _0x2627a3=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0xec)]],_0x436e75=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1c4)]],_0x17321d=[..._0x37c185[_0x2f48ee(0x1d7)]['carton']],_0x2ccb28=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x122)]],_0x83c1c0=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x114)]],_0x4bd96d=[..._0x37c185['body']['prod_code']],_0x20ff5c=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1b7)]],_0x1848f6=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x175)]],_0x21d45a=[..._0x37c185[_0x2f48ee(0x1d7)]['secondary_unit']],_0x1d01a8=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x14c)]],_0x2a1116=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1dc)]],_0x88d20e=[..._0x37c185['body'][_0x2f48ee(0x1e3)]],_0x2cff54=[..._0x37c185[_0x2f48ee(0x1d7)]['production_date']],_0x5d2f93=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x1d3)]],_0x25880a=[..._0x37c185['body'][_0x2f48ee(0x16d)]],_0x5d5c89=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0xef)]],_0x2f494e=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0xee)]],_0x11cc92=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x12b)]],_0x236100=[..._0x37c185[_0x2f48ee(0x1d7)]['RoomAssigned']],_0x5330e3=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x139)]],_0x5909d4=[..._0x37c185['body'][_0x2f48ee(0x1a7)]],_0x12bf3b=[..._0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x174)]],_0x445a98=[..._0x37c185[_0x2f48ee(0x1d7)]['id_transact']];const _0x37fa5c=_0x2627a3[_0x2f48ee(0x101)](_0x3fefb7=>{return _0x3fefb7={'product_name':_0x3fefb7};});_0x436e75[_0x2f48ee(0x172)]((_0x5e1bd9,_0x3d56b1)=>{var _0x30d463=_0x2f48ee;_0x37fa5c[_0x3d56b1][_0x30d463(0x1c4)]=Math[_0x30d463(0xdf)](_0x5e1bd9);}),_0x5909d4[_0x2f48ee(0x172)]((_0x4808c2,_0x184b86)=>{var _0x3d5f91=_0x2f48ee;_0x37fa5c[_0x184b86][_0x3d5f91(0x1a7)]=Math[_0x3d5f91(0xdf)](_0x4808c2);}),_0x12bf3b[_0x2f48ee(0x172)]((_0x564fbd,_0x4dc215)=>{_0x37fa5c[_0x4dc215]['actual_uom']=_0x564fbd;}),_0x445a98[_0x2f48ee(0x172)]((_0x5cb94d,_0x1d662c)=>{var _0x73dfcd=_0x2f48ee;_0x37fa5c[_0x1d662c][_0x73dfcd(0x160)]=_0x5cb94d;}),_0x17321d[_0x2f48ee(0x172)]((_0x7ebf8e,_0x182b6d)=>{var _0x34defa=_0x2f48ee;_0x37fa5c[_0x182b6d][_0x34defa(0x12b)]=_0x7ebf8e;}),_0x2ccb28[_0x2f48ee(0x172)]((_0xda8260,_0x403507)=>{var _0x46c945=_0x2f48ee;_0x37fa5c[_0x403507][_0x46c945(0x122)]=_0xda8260;}),_0x83c1c0[_0x2f48ee(0x172)]((_0x85fd9e,_0x51a747)=>{var _0x9a166c=_0x2f48ee;_0x37fa5c[_0x51a747][_0x9a166c(0x114)]=_0x85fd9e;}),_0x4bd96d[_0x2f48ee(0x172)]((_0x41a14f,_0x4b93c8)=>{var _0x1a6a90=_0x2f48ee;_0x37fa5c[_0x4b93c8][_0x1a6a90(0x111)]=_0x41a14f;}),_0x20ff5c['forEach']((_0x4d3398,_0x99813)=>{var _0x3221e0=_0x2f48ee;_0x236100[_0x3221e0(0x172)]((_0x9f1800,_0xbef77c)=>{var _0x2f030c=_0x3221e0;if(_0x9f1800==_0x2f030c(0x188)&&_0x99813==_0xbef77c){var _0xf8a602=_0x4d3398[_0x2f030c(0x12e)](0x3);_0x37fa5c[_0x99813][_0x2f030c(0x161)]=_0x4d3398[0x0],_0x37fa5c[_0x99813]['rack']=_0x4d3398[0x1],_0x37fa5c[_0x99813][_0x2f030c(0x173)]=0x0,_0x37fa5c[_0x99813][_0x2f030c(0x1b0)]=0x0,_0x37fa5c[_0x99813]['type']=_0x2f030c(0x18a),_0x37fa5c[_0x99813][_0x2f030c(0x1c1)]=_0xf8a602;}else{if(_0x9f1800==_0x2f030c(0xf2)&&_0x99813==_0xbef77c){var _0xf8a602=_0x4d3398[_0x2f030c(0x12e)](0x3);_0x37fa5c[_0x99813]['storage']=_0x4d3398[0x0],_0x37fa5c[_0x99813][_0x2f030c(0x18b)]=_0x4d3398[0x1],_0x37fa5c[_0x99813][_0x2f030c(0x173)]=0x0,_0x37fa5c[_0x99813][_0x2f030c(0x1b0)]=0x0,_0x37fa5c[_0x99813][_0x2f030c(0x1b1)]='Floor',_0x37fa5c[_0x99813]['floorlevel']=_0x4d3398[0x5];}else{if(_0x99813==_0xbef77c){var _0xa0da4a;if(_0x4d3398[0x4]=='L')_0xa0da4a=_0x2f030c(0x170);else _0x4d3398[0x4]=='F'&&(_0xa0da4a=_0x2f030c(0x18a));_0x37fa5c[_0x99813]['storage']=_0x4d3398[0x0],_0x37fa5c[_0x99813][_0x2f030c(0x18b)]=_0x4d3398[0x1],_0x37fa5c[_0x99813][_0x2f030c(0x173)]=_0x4d3398[0x2],_0x37fa5c[_0x99813][_0x2f030c(0x1b0)]=_0x4d3398[0x3],_0x37fa5c[_0x99813][_0x2f030c(0x1b1)]=_0xa0da4a,_0x37fa5c[_0x99813]['floorlevel']=_0x4d3398[0x5];}}}});}),_0x1848f6[_0x2f48ee(0x172)]((_0x14047d,_0x1f86d4)=>{_0x37fa5c[_0x1f86d4]['unit']=_0x14047d;}),_0x21d45a['forEach']((_0x2fb957,_0x1fca51)=>{var _0x5bcf6f=_0x2f48ee;_0x37fa5c[_0x1fca51][_0x5bcf6f(0x1bf)]=_0x2fb957;}),_0x1d01a8[_0x2f48ee(0x172)]((_0x3b9801,_0x2ddf66)=>{_0x37fa5c[_0x2ddf66]['batch_code']=_0x3b9801;}),_0x2a1116[_0x2f48ee(0x172)]((_0x2f1e8f,_0x44742e)=>{var _0x547afe=_0x2f48ee;_0x37fa5c[_0x44742e][_0x547afe(0x1dc)]=_0x2f1e8f;}),_0x88d20e[_0x2f48ee(0x172)]((_0x58742f,_0x5b6e0d)=>{_0x37fa5c[_0x5b6e0d]['maxperunit']=_0x58742f;}),_0x2cff54[_0x2f48ee(0x172)]((_0x14e991,_0x3fc2d5)=>{var _0x1a55ae=_0x2f48ee;_0x37fa5c[_0x3fc2d5][_0x1a55ae(0x19f)]=_0x14e991;}),_0x5d2f93[_0x2f48ee(0x172)]((_0x3be8e6,_0x1cc10c)=>{_0x37fa5c[_0x1cc10c]['requested_qty']=_0x3be8e6;}),_0x25880a[_0x2f48ee(0x172)]((_0x38ecf0,_0x2deb84)=>{_0x37fa5c[_0x2deb84]['delivery_date']=_0x38ecf0;}),_0x5d5c89['forEach']((_0x4cd233,_0x4f83c7)=>{var _0x3d2f84=_0x2f48ee;_0x37fa5c[_0x4f83c7][_0x3d2f84(0xef)]=_0x4cd233;}),_0x2f494e[_0x2f48ee(0x172)]((_0x121377,_0x41798f)=>{_0x37fa5c[_0x41798f]['prod_cat']=_0x121377;}),_0x11cc92['forEach']((_0x3d81d6,_0x508d55)=>{_0x37fa5c[_0x508d55]['quantity_notConverted']=_0x3d81d6;}),_0x236100['forEach']((_0x24a0ff,_0x69ee39)=>{_0x37fa5c[_0x69ee39]['room_name']=_0x24a0ff;}),_0x5330e3[_0x2f48ee(0x172)]((_0x307c61,_0x2d1937)=>{var _0x182a72=_0x2f48ee;_0x37fa5c[_0x2d1937][_0x182a72(0x156)]=_0x307c61;});var _0x5a6d14=0x0;_0x37fa5c['forEach'](_0x18052a=>{var _0x4bdd66=_0x2f48ee;(_0x18052a[_0x4bdd66(0x1c4)]<_0x18052a[_0x4bdd66(0x162)]||_0x18052a[_0x4bdd66(0x162)]==0x0)&&(console[_0x4bdd66(0x1ab)](_0x4bdd66(0x157),_0x18052a),_0x5a6d14++);});const _0xfcafae=_0x37fa5c[_0x2f48ee(0xfa)](_0xb95bce=>_0xb95bce['quantity']!=='0'&&_0xb95bce[_0x2f48ee(0x12b)]!==''),_0x4bf663=new sales({'invoice':_0x43d075,'customer':_0x37c185[_0x2f48ee(0x1d7)][_0x2f48ee(0x12c)],'date':_0x1649a7,'warehouse_name':_0x201ac5,'sale_product':_0xfcafae,'note':_0x5342cf,'room':_0x41621f,'primary_code':_0x4aeadc,'secondary_code':_0x4d7a9c,'prod_code':_0x5df254,'SCRN':_0x185af6}),_0x16b318=await _0x4bf663[_0x2f48ee(0x18f)]();_0x37c185[_0x2f48ee(0x181)](_0x2f48ee(0x197),'Sales\x20Add\x20successfully'),_0x2dbc17[_0x2f48ee(0x1c3)](_0x2f48ee(0x1df)+_0x16b318[_0x2f48ee(0x17f)]);}catch(_0x8affd2){console[_0x2f48ee(0x1ab)](_0x8affd2);}}),router['get'](a0_0x205708(0x16f),auth,async(_0x164f85,_0xdab393)=>{var _0x3b9c2f=a0_0x205708;try{const {username:_0x5849d2,email:_0x3dc24e,role:_0x577394}=_0x164f85[_0x3b9c2f(0x171)],_0x4eaf1d=_0x164f85[_0x3b9c2f(0x171)],_0x6efbc6=await profile[_0x3b9c2f(0xf6)]({'email':_0x4eaf1d['email']}),_0x12342b=await master_shop[_0x3b9c2f(0x1bd)](),_0x10ecf0=_0x164f85[_0x3b9c2f(0xe2)]['id'],_0x32a83=await sales[_0x3b9c2f(0x137)](_0x10ecf0),_0x5b8f45=await warehouse[_0x3b9c2f(0x194)]([{'$match':{'name':_0x32a83[_0x3b9c2f(0x1a2)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3b9c2f(0x178),'name':{'$first':_0x3b9c2f(0x15d)},'product_stock':{'$first':_0x3b9c2f(0x13c)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3b9c2f(0x100)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3b9c2f(0xe4)},'primary_code':{'$first':_0x3b9c2f(0x18c)},'secondary_code':{'$first':_0x3b9c2f(0x1d8)},'product_code':{'$first':_0x3b9c2f(0x199)},'storage':{'$first':_0x3b9c2f(0x107)},'rack':{'$first':_0x3b9c2f(0x15c)},'expiry_date':{'$first':_0x3b9c2f(0x1c8)},'production_date':{'$first':_0x3b9c2f(0xe0)},'invoice':{'$first':_0x3b9c2f(0x150)}}}]),_0x493f03=await customer[_0x3b9c2f(0x1bd)]({});let _0x367542;if(_0x4eaf1d[_0x3b9c2f(0x149)]=='staff'){const _0x582d8f=await staff['findOne']({'email':_0x4eaf1d[_0x3b9c2f(0x138)]});_0x367542=await warehouse[_0x3b9c2f(0x194)]([{'$match':{'status':_0x3b9c2f(0x1ca),'name':_0x582d8f[_0x3b9c2f(0x177)]}},{'$group':{'_id':_0x3b9c2f(0xfd),'name':{'$first':'$name'}}}]);}else _0x367542=await warehouse[_0x3b9c2f(0x194)]([{'$match':{'status':_0x3b9c2f(0x1ca)}},{'$group':{'_id':_0x3b9c2f(0xfd),'name':{'$first':'$name'}}}]);const _0x5dabd0=await product[_0x3b9c2f(0x1bd)]({}),_0x30a296=await suppliers[_0x3b9c2f(0x1bd)]({});if(_0x12342b[0x0]['language']=='English\x20(US)'){var _0x4f75cc=users[_0x3b9c2f(0x113)];console['log'](_0x4f75cc);}else{if(_0x12342b[0x0][_0x3b9c2f(0x136)]=='Hindi')var _0x4f75cc=users[_0x3b9c2f(0x1cc)];else{if(_0x12342b[0x0][_0x3b9c2f(0x136)]=='German')var _0x4f75cc=users[_0x3b9c2f(0x105)];else{if(_0x12342b[0x0][_0x3b9c2f(0x136)]==_0x3b9c2f(0x191))var _0x4f75cc=users[_0x3b9c2f(0x191)];else{if(_0x12342b[0x0][_0x3b9c2f(0x136)]==_0x3b9c2f(0x1b5))var _0x4f75cc=users['French'];else{if(_0x12342b[0x0][_0x3b9c2f(0x136)]==_0x3b9c2f(0x1d2))var _0x4f75cc=users[_0x3b9c2f(0x16e)];else{if(_0x12342b[0x0][_0x3b9c2f(0x136)]==_0x3b9c2f(0xe5))var _0x4f75cc=users['Chinese'];else{if(_0x12342b[0x0]['language']==_0x3b9c2f(0x1c0))var _0x4f75cc=users[_0x3b9c2f(0x159)];}}}}}}}_0xdab393[_0x3b9c2f(0x17d)](_0x3b9c2f(0x163),{'success':_0x164f85[_0x3b9c2f(0x181)]('success'),'errors':_0x164f85[_0x3b9c2f(0x181)](_0x3b9c2f(0xe3)),'role':_0x4eaf1d,'profile':_0x6efbc6,'customer':_0x493f03,'warehouse':_0x367542,'product':_0x5b8f45,'user':_0x32a83,'master_shop':_0x12342b,'unit':_0x5dabd0,'language':_0x4f75cc,'suppliers':_0x30a296});}catch(_0x29c64c){console['log'](_0x29c64c);}}),router['post'](a0_0x205708(0x16f),auth,async(_0x12637f,_0x325206)=>{var _0x547f5b=a0_0x205708;try{const _0x2a9572=_0x12637f[_0x547f5b(0xe2)]['id'],{invoice:_0x3a7cb4,warehouse_name:_0x2e5517,room:_0x179c77}=_0x12637f[_0x547f5b(0x1d7)],_0x3a17e5=await sales[_0x547f5b(0xf6)]({'invoice':_0x3a7cb4}),_0x47db18=_0x3a17e5[_0x547f5b(0x142)]['map'](async _0x25b9fb=>{var _0x1dc93f=_0x547f5b,_0x11c3dc=await warehouse['findOne']({'name':_0x2e5517,'room':_0x25b9fb[_0x1dc93f(0xf5)],'warehouse_category':_0x1dc93f(0x10f)});const _0x3bc3e9=_0x11c3dc[_0x1dc93f(0x109)][_0x1dc93f(0x101)](_0xe94c06=>{var _0x306635=_0x1dc93f;_0xe94c06[_0x306635(0xec)]==_0x25b9fb['product_name']&&_0xe94c06[_0x306635(0x1c1)]==_0x25b9fb[_0x306635(0x1c1)]&&_0xe94c06[_0x306635(0x1b1)]==_0x25b9fb[_0x306635(0x1b1)]&&_0xe94c06[_0x306635(0x1b0)]==_0x25b9fb[_0x306635(0x1b0)]&&_0xe94c06[_0x306635(0x173)]==_0x25b9fb[_0x306635(0x173)]&&_0xe94c06['rack']==_0x25b9fb[_0x306635(0x18b)]&&_0xe94c06[_0x306635(0x161)]==_0x25b9fb[_0x306635(0x161)]&&_0xe94c06[_0x306635(0x1dc)]==_0x25b9fb[_0x306635(0x1dc)]&&_0xe94c06[_0x306635(0x14c)]==_0x25b9fb['batch_code']&&_0xe94c06[_0x306635(0x156)]==_0x25b9fb[_0x306635(0x156)]&&_0xe94c06['_id']==_0x25b9fb[_0x306635(0x160)]&&(_0xe94c06[_0x306635(0x11d)]=Math[_0x306635(0x19d)](0x0,Math['abs'](_0xe94c06[_0x306635(0x11d)])-Math[_0x306635(0xdf)](_0x25b9fb['quantity'])));});return _0x11c3dc;});Promise[_0x547f5b(0x164)](_0x47db18)[_0x547f5b(0x17b)](async _0x240994=>{var _0x38a09a=_0x547f5b;try{for(const _0x292b6e of _0x240994){await _0x292b6e['save']();}_0x3a17e5['finalize']=_0x38a09a(0xf8);const _0x5dbdea=await _0x3a17e5[_0x38a09a(0x18f)](),_0x562ea1=await master_shop[_0x38a09a(0x1bd)](),_0xbb63cb=await email_settings[_0x38a09a(0xf6)](),_0x2f2fc7=await supervisor_settings['find']();var _0x1db5ad=_0x3a17e5[_0x38a09a(0x142)],_0xd4ec83='',_0x45120e;for(_0x45120e in _0x1db5ad){_0xd4ec83+='<tr>'+_0x38a09a(0x1d1)+_0x1db5ad[_0x45120e][_0x38a09a(0xec)]+_0x38a09a(0x129)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1db5ad[_0x45120e][_0x38a09a(0x111)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1db5ad[_0x45120e][_0x38a09a(0x12b)]+'</td>'+_0x38a09a(0x1d1)+_0x1db5ad[_0x45120e][_0x38a09a(0x140)]+_0x38a09a(0x129)+_0x38a09a(0x1d1)+_0x1db5ad[_0x45120e][_0x38a09a(0x1bf)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a17e5[_0x38a09a(0x1a2)]+'</td>'+_0x38a09a(0x1d1)+_0x1db5ad[_0x45120e][_0x38a09a(0xf5)]+_0x38a09a(0x129)+_0x38a09a(0x1d1)+_0x1db5ad[_0x45120e][_0x38a09a(0x161)]+_0x1db5ad[_0x45120e][_0x38a09a(0x18b)]+_0x1db5ad[_0x45120e]['bay']+_0x1db5ad[_0x45120e][_0x38a09a(0x1b0)]+_0x1db5ad[_0x45120e][_0x38a09a(0x1b1)][0x0]+_0x1db5ad[_0x45120e]['floorlevel']+_0x38a09a(0x129),_0x38a09a(0x1db);}let _0x15ea89=nodemailer['createTransport']({'host':_0xbb63cb[_0x38a09a(0x14e)],'port':Number(_0xbb63cb['port']),'secure':![],'auth':{'user':_0xbb63cb[_0x38a09a(0x138)],'pass':_0xbb63cb[_0x38a09a(0x1c6)]}}),_0x3858ac={'from':_0xbb63cb[_0x38a09a(0x138)],'to':_0x2f2fc7[0x0][_0x38a09a(0x11a)],'subject':_0x38a09a(0x1d9),'attachments':[{'filename':_0x38a09a(0x154),'path':__dirname+_0x38a09a(0x15b)+_0x38a09a(0x1a9)+_0x562ea1[0x0][_0x38a09a(0x1b2)],'cid':_0x38a09a(0x1b9)}],'html':_0x38a09a(0x17c)+'<html><head><title></title>'+_0x38a09a(0x124)+_0x38a09a(0x1cb)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x38a09a(0x1cb)+_0x38a09a(0xf0)+'</div>'+_0x38a09a(0x1cb)+'<h2>\x20'+_0x562ea1[0x0][_0x38a09a(0x1be)]+'\x20</h2>'+_0x38a09a(0xe1)+_0x38a09a(0xe1)+_0x38a09a(0x1ea)+_0x38a09a(0x1cb)+_0x38a09a(0x104)+'\x20Order\x20Number\x20:\x20'+_0x3a17e5[_0x38a09a(0x156)]+'\x20'+_0x38a09a(0x169)+'\x20Order\x20Date\x20:\x20'+_0x3a17e5[_0x38a09a(0x10d)]+'\x20'+_0x38a09a(0x13e)+'</h5>'+_0x38a09a(0xe1)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x38a09a(0x1b8)+'<tr>'+_0x38a09a(0x19a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x38a09a(0x133)+_0x38a09a(0x146)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x38a09a(0x13a)+_0x38a09a(0x1db)+_0x38a09a(0x16b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xd4ec83+'\x20'+_0x38a09a(0x132)+_0x38a09a(0x184)+_0x38a09a(0x1cb)+_0x38a09a(0xfb)+'<h5>'+_0x562ea1[0x0][_0x38a09a(0x1be)]+'</h5>'+_0x38a09a(0xe1)+_0x38a09a(0xe1)+_0x38a09a(0x13f)};_0x15ea89[_0x38a09a(0x126)](_0x3858ac,function(_0x3c7fb3,_0x7e95bb){var _0x178466=_0x38a09a;_0x3c7fb3?(console[_0x178466(0x1ab)](_0x3c7fb3),console[_0x178466(0x1ab)](_0x178466(0xf4))):console[_0x178466(0x1ab)](_0x178466(0x18e));}),_0x12637f['flash'](_0x38a09a(0x197),_0x38a09a(0x12a)),_0x325206['redirect'](_0x38a09a(0x1df)+_0x2a9572);}catch(_0x1ab5b1){console[_0x38a09a(0x1c5)](_0x1ab5b1),_0x325206[_0x38a09a(0x1e9)](0x1f4)[_0x38a09a(0x141)]({'error':_0x38a09a(0x1af)});}})[_0x547f5b(0x1e4)](_0x3c3b6d=>{var _0x59e036=_0x547f5b;console['error'](_0x3c3b6d),_0x325206[_0x59e036(0x1e9)](0x1f4)[_0x59e036(0x141)]({'error':'An\x20error\x20occurred.'});});}catch(_0x337c1a){console[_0x547f5b(0x1ab)](_0x337c1a);}}),router[a0_0x205708(0x1b3)](a0_0x205708(0x179),auth,async(_0x29aa7d,_0x3c5863)=>{var _0x171f57=a0_0x205708;try{const {username:_0x253063,email:_0xf6423d,role:_0x53622e}=_0x29aa7d[_0x171f57(0x171)],_0x9fb8db=_0x29aa7d[_0x171f57(0x171)],_0x22fa14=await profile[_0x171f57(0xf6)]({'email':_0x9fb8db[_0x171f57(0x138)]}),_0x4b8ae0=await master_shop[_0x171f57(0x1bd)](),_0x5ac150=_0x29aa7d[_0x171f57(0xe2)]['id'],_0x500fe4=await sales['findById'](_0x5ac150);var _0x4115a6=[_0x171f57(0x121),_0x171f57(0x1c9)];const _0x26e9b7=await warehouse['aggregate']([{'$match':{'name':_0x500fe4[_0x171f57(0x1a2)],'warehouse_category':_0x171f57(0x10f)}},{'$unwind':_0x171f57(0x183)},{'$group':{'_id':_0x171f57(0x178),'name':{'$first':_0x171f57(0x15d)},'product_stock':{'$first':_0x171f57(0x13c)},'bay':{'$first':_0x171f57(0x165)},'bin':{'$first':_0x171f57(0x100)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x171f57(0x18c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x171f57(0x199)},'storage':{'$first':_0x171f57(0x107)},'rack':{'$first':_0x171f57(0x15c)}}}]),_0x42bab1=await customer[_0x171f57(0x1bd)]({});let _0x47a995;if(_0x9fb8db[_0x171f57(0x149)]==_0x171f57(0x117)){const _0x258ea8=await staff[_0x171f57(0xf6)]({'email':_0x9fb8db[_0x171f57(0x138)]});_0x47a995=await warehouse[_0x171f57(0x194)]([{'$match':{'status':'Enabled','name':_0x258ea8[_0x171f57(0x177)],'warehouse_category':_0x171f57(0x10f)}},{'$group':{'_id':_0x171f57(0xfd),'name':{'$first':_0x171f57(0xfd)}}}]);}else _0x47a995=await warehouse['aggregate']([{'$match':{'status':_0x171f57(0x1ca),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x171f57(0xfd),'name':{'$first':_0x171f57(0xfd)}}}]);const _0x2554d8=await product[_0x171f57(0x1bd)]({});if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0x1a6)){var _0x1f9db2=users[_0x171f57(0x113)];console[_0x171f57(0x1ab)](_0x1f9db2);}else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0x1cc))var _0x1f9db2=users[_0x171f57(0x1cc)];else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0x105))var _0x1f9db2=users[_0x171f57(0x105)];else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]=='Spanish')var _0x1f9db2=users[_0x171f57(0x191)];else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0x1b5))var _0x1f9db2=users['French'];else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0x1d2))var _0x1f9db2=users['Portuguese'];else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0xe5))var _0x1f9db2=users[_0x171f57(0xe5)];else{if(_0x4b8ae0[0x0][_0x171f57(0x136)]==_0x171f57(0x1c0))var _0x1f9db2=users[_0x171f57(0x159)];}}}}}}}_0x3c5863[_0x171f57(0x17d)](_0x171f57(0x143),{'success':_0x29aa7d[_0x171f57(0x181)](_0x171f57(0x197)),'errors':_0x29aa7d[_0x171f57(0x181)](_0x171f57(0xe3)),'role':_0x9fb8db,'profile':_0x22fa14,'customer':_0x42bab1,'warehouse':_0x47a995,'product':_0x26e9b7,'user':_0x500fe4,'master_shop':_0x4b8ae0,'unit':_0x2554d8,'language':_0x1f9db2});}catch(_0xb26b7c){console[_0x171f57(0x1ab)](_0xb26b7c);}}),router[a0_0x205708(0x17e)](a0_0x205708(0x179),auth,async(_0x445715,_0x29cc0a)=>{var _0x431727=a0_0x205708;try{const _0x943b64=_0x445715[_0x431727(0xe2)]['id'],_0x1c3975=await sales[_0x431727(0xf6)]({'_id':_0x445715['params']['id']}),_0x565cdd=await warehouse[_0x431727(0xf6)]({'name':_0x1c3975['warehouse_name'],'room':_0x445715[_0x431727(0x1d7)][_0x431727(0x1d0)]}),{invoice:_0x54f370,date:_0x368bbe,warehouse_name:_0x4ef24c,product_name:_0x3cdc84,stock:_0x496062,quantity:_0x3b10a7,note:_0x58bca3,room:_0x2e4077,customer:_0x2ed020,SCRN:_0x36bec9}=_0x445715[_0x431727(0x1d7)];if(typeof _0x3cdc84==_0x431727(0x14f))var _0x1c2676=[_0x445715[_0x431727(0x1d7)]['product_name']],_0x2ddaaf=[_0x445715[_0x431727(0x1d7)]['stock']],_0x802f3=[_0x445715[_0x431727(0x1d7)][_0x431727(0x1a5)]],_0x19a907=[_0x445715[_0x431727(0x1d7)]['primary_code']],_0x5a0d39=[_0x445715[_0x431727(0x1d7)][_0x431727(0x114)]],_0x19f2fe=[_0x445715['body'][_0x431727(0x1dd)]],_0x504720=[_0x445715[_0x431727(0x1d7)][_0x431727(0x1b7)]],_0x3a84fa=[_0x445715['body'][_0x431727(0x175)]],_0x1d6b35=[_0x445715[_0x431727(0x1d7)][_0x431727(0x1bf)]],_0x3af61a=[_0x445715['body'][_0x431727(0x14c)]],_0x445d3a=[_0x445715[_0x431727(0x1d7)][_0x431727(0x1dc)]],_0x9e94ef=[_0x445715['body'][_0x431727(0x1e3)]],_0x1c1d1d=[_0x445715['body']['production_date']],_0x2c398a=[_0x445715[_0x431727(0x1d7)][_0x431727(0x1d3)]],_0x527f61=[_0x445715['body']['delivery_date']],_0x2e94e8=[_0x445715[_0x431727(0x1d7)][_0x431727(0xef)]],_0x4a970c=[_0x445715[_0x431727(0x1d7)][_0x431727(0xee)]],_0x376f43=[_0x445715[_0x431727(0x1d7)][_0x431727(0x12b)]],_0x5b8a53=[_0x445715['body'][_0x431727(0x112)]];else var _0x1c2676=[..._0x445715['body'][_0x431727(0xec)]],_0x2ddaaf=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x1c4)]],_0x802f3=[..._0x445715[_0x431727(0x1d7)]['carton']],_0x19a907=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x122)]],_0x5a0d39=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x114)]],_0x19f2fe=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x1dd)]],_0x504720=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x1b7)]],_0x3a84fa=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x175)]],_0x1d6b35=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x1bf)]],_0x3af61a=[..._0x445715['body'][_0x431727(0x14c)]],_0x445d3a=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x1dc)]],_0x9e94ef=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x1e3)]],_0x1c1d1d=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x19f)]],_0x2c398a=[..._0x445715['body'][_0x431727(0x1d3)]],_0x527f61=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x16d)]],_0x2e94e8=[..._0x445715['body']['delivery_code']],_0x4a970c=[..._0x445715[_0x431727(0x1d7)]['prod_cat']],_0x376f43=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x12b)]],_0x5b8a53=[..._0x445715[_0x431727(0x1d7)][_0x431727(0x112)]];const _0x4a1a37=_0x1c2676[_0x431727(0x101)](_0x3616a0=>{return _0x3616a0={'product_name':_0x3616a0};});_0x2ddaaf[_0x431727(0x172)]((_0x9f4424,_0x1e3b03)=>{var _0x4bce8e=_0x431727;_0x4a1a37[_0x1e3b03][_0x4bce8e(0x1c4)]=Math[_0x4bce8e(0xdf)](_0x9f4424);}),_0x802f3[_0x431727(0x172)]((_0x44c353,_0x1a1ecf)=>{var _0x4b182f=_0x431727;_0x4a1a37[_0x1a1ecf][_0x4b182f(0x12b)]=_0x44c353;}),_0x19a907[_0x431727(0x172)]((_0x3e678f,_0x113e6e)=>{var _0x2c006c=_0x431727;_0x4a1a37[_0x113e6e][_0x2c006c(0x122)]=_0x3e678f;}),_0x5a0d39['forEach']((_0x529001,_0xda6c7)=>{var _0x33b390=_0x431727;_0x4a1a37[_0xda6c7][_0x33b390(0x114)]=_0x529001;}),_0x19f2fe[_0x431727(0x172)]((_0x5b87ad,_0x3ee0cd)=>{_0x4a1a37[_0x3ee0cd]['product_code']=_0x5b87ad;}),_0x504720['forEach']((_0x428424,_0x51fa91)=>{var _0x142101=_0x431727;_0x5b8a53[_0x142101(0x172)]((_0xce3182,_0x50a9b3)=>{var _0x52062d=_0x142101;if(_0xce3182=='Receiving\x20Area'&&_0x51fa91==_0x50a9b3){var _0x5b10bf=_0x428424['slice'](0x3);_0x4a1a37[_0x51fa91][_0x52062d(0x161)]=_0x428424[0x0],_0x4a1a37[_0x51fa91]['rack']=_0x428424[0x1],_0x4a1a37[_0x51fa91][_0x52062d(0x173)]=0x0,_0x4a1a37[_0x51fa91][_0x52062d(0x1b0)]=0x0,_0x4a1a37[_0x51fa91][_0x52062d(0x1b1)]=_0x52062d(0x18a),_0x4a1a37[_0x51fa91][_0x52062d(0x1c1)]=_0x5b10bf;}else{if(_0xce3182==_0x52062d(0xf2)&&_0x51fa91==_0x50a9b3){var _0x5b10bf=_0x428424[_0x52062d(0x12e)](0x3);_0x4a1a37[_0x51fa91]['storage']=_0x428424[0x0],_0x4a1a37[_0x51fa91][_0x52062d(0x18b)]=_0x428424[0x1],_0x4a1a37[_0x51fa91][_0x52062d(0x173)]=0x0,_0x4a1a37[_0x51fa91]['bin']=0x0,_0x4a1a37[_0x51fa91]['type']='Floor',_0x4a1a37[_0x51fa91][_0x52062d(0x1c1)]=_0x428424[0x5];}else{if(_0x51fa91==_0x50a9b3){var _0x111094;if(_0x428424[0x4]=='L')_0x111094=_0x52062d(0x170);else _0x428424[0x4]=='F'&&(_0x111094=_0x52062d(0x18a));_0x4a1a37[_0x51fa91][_0x52062d(0x161)]=_0x428424[0x0],_0x4a1a37[_0x51fa91][_0x52062d(0x18b)]=_0x428424[0x1],_0x4a1a37[_0x51fa91][_0x52062d(0x173)]=_0x428424[0x2],_0x4a1a37[_0x51fa91][_0x52062d(0x1b0)]=_0x428424[0x3],_0x4a1a37[_0x51fa91][_0x52062d(0x1b1)]=_0x111094,_0x4a1a37[_0x51fa91]['floorlevel']=_0x428424[0x5];}}}});}),_0x3a84fa['forEach']((_0x30411f,_0x304681)=>{_0x4a1a37[_0x304681]['unit']=_0x30411f;}),_0x1d6b35[_0x431727(0x172)]((_0x2cec97,_0x3cd03f)=>{var _0x517247=_0x431727;_0x4a1a37[_0x3cd03f][_0x517247(0x1bf)]=_0x2cec97;}),_0x3af61a[_0x431727(0x172)]((_0x24395c,_0x3c26da)=>{var _0x208515=_0x431727;_0x4a1a37[_0x3c26da][_0x208515(0x14c)]=_0x24395c;}),_0x445d3a[_0x431727(0x172)]((_0x140853,_0x49869c)=>{var _0x4b8459=_0x431727;_0x4a1a37[_0x49869c][_0x4b8459(0x1dc)]=_0x140853;}),_0x9e94ef['forEach']((_0x3db1ef,_0x299ce9)=>{var _0x370003=_0x431727;_0x4a1a37[_0x299ce9][_0x370003(0x158)]=_0x3db1ef;}),_0x1c1d1d['forEach']((_0x33435e,_0x1532d9)=>{_0x4a1a37[_0x1532d9]['production_date']=_0x33435e;}),_0x2c398a[_0x431727(0x172)]((_0x345918,_0x2930fe)=>{var _0x57feda=_0x431727;_0x4a1a37[_0x2930fe][_0x57feda(0x1d3)]=Math['abs'](_0x345918);}),_0x527f61[_0x431727(0x172)]((_0x37478b,_0x19f675)=>{var _0x4c6080=_0x431727;_0x4a1a37[_0x19f675][_0x4c6080(0x16d)]=_0x37478b;}),_0x2e94e8[_0x431727(0x172)]((_0x238be7,_0xf92b)=>{_0x4a1a37[_0xf92b]['delivery_code']=_0x238be7;}),_0x4a970c[_0x431727(0x172)]((_0x1ee516,_0x19fc76)=>{_0x4a1a37[_0x19fc76]['prod_cat']=_0x1ee516;}),_0x376f43['forEach']((_0x347abd,_0x3f7cc9)=>{var _0x42b85c=_0x431727;_0x4a1a37[_0x3f7cc9][_0x42b85c(0x162)]=_0x347abd;}),_0x5b8a53[_0x431727(0x172)]((_0xa4b5e4,_0x80b618)=>{var _0xc30310=_0x431727;_0x4a1a37[_0x80b618][_0xc30310(0xf5)]=_0xa4b5e4;});var _0x4d67cd=0x0;_0x4a1a37[_0x431727(0x172)](_0x561a4e=>{var _0x53b66f=_0x431727;console[_0x53b66f(0x1ab)](_0x53b66f(0x157),_0x561a4e),(parseInt(_0x561a4e[_0x53b66f(0x1c4)])<parseInt(_0x561a4e[_0x53b66f(0x12b)])||parseInt(_0x561a4e[_0x53b66f(0x12b)])==0x0)&&_0x4d67cd++;});if(_0x4d67cd!=0x0)return _0x445715[_0x431727(0x181)](_0x431727(0xe3),_0x431727(0x123)),_0x29cc0a[_0x431727(0x1c3)](_0x431727(0xfe));const _0x323c15=_0x4a1a37[_0x431727(0xfa)](_0x495e8e=>_0x495e8e[_0x431727(0x12b)]!=='0'&&_0x495e8e[_0x431727(0x12b)]!=='');_0x1c3975[_0x431727(0x156)]=_0x54f370,_0x1c3975['customer']=_0x2ed020,_0x1c3975[_0x431727(0x10d)]=_0x368bbe,_0x1c3975[_0x431727(0x1a2)]=_0x4ef24c,_0x1c3975[_0x431727(0x142)]=_0x323c15,_0x1c3975[_0x431727(0x12f)]=_0x58bca3,_0x1c3975[_0x431727(0x193)]=_0x36bec9,_0x1c3975['finalize']=_0x431727(0x1e0),_0x1c3975[_0x431727(0x1e7)]=_0x431727(0x1e0);const _0xe2d300=await _0x1c3975[_0x431727(0x18f)]();_0x445715[_0x431727(0x181)](_0x431727(0x197),'Sales\x20Update\x20successfully'),_0x29cc0a[_0x431727(0x1c3)](_0x431727(0x1ba));}catch(_0x421925){console['log'](_0x421925);}}),router[a0_0x205708(0x17e)]('/give_payment/:id',auth,async(_0x554f94,_0x2c9475)=>{var _0x32699a=a0_0x205708;try{const _0x57b265=_0x554f94[_0x32699a(0xe2)]['id'],{invoice:_0x28b30b,customer:_0x204cec,receivable_amount:_0x11f77a,received_amount:_0x345a3c}=_0x554f94[_0x32699a(0x1d7)],_0x40b614=await sales[_0x32699a(0x137)](_0x57b265);console[_0x32699a(0x1ab)](_0x40b614);var _0x1dedd2=_0x11f77a-_0x345a3c;console[_0x32699a(0x1ab)](_0x345a3c),_0x40b614[_0x32699a(0xf7)]=parseFloat(_0x345a3c)+parseFloat(_0x40b614[_0x32699a(0xf7)]),_0x40b614['due_amount']=_0x1dedd2,console['log'](_0x40b614);const _0x3efcf6=await _0x40b614['save'](),_0x33b68c=await c_payment_data['findOne']({'invoice':_0x28b30b});_0x33b68c[_0x32699a(0xf3)]=_0x1dedd2,await _0x33b68c['save']();let _0x15a1bb=new Date(),_0x12c110=('0'+_0x15a1bb[_0x32699a(0x131)]())[_0x32699a(0x12e)](-0x2),_0x3548ad=('0'+(_0x15a1bb[_0x32699a(0x1d6)]()+0x1))[_0x32699a(0x12e)](-0x2),_0x311300=_0x15a1bb[_0x32699a(0x1a4)](),_0x475f8e=_0x311300+'-'+_0x3548ad+'-'+_0x12c110;const _0x29f774=new customer_payment({'invoice':_0x28b30b,'date':_0x311300+'-'+_0x3548ad+'-'+_0x12c110,'customer':_0x204cec,'reason':_0x32699a(0x19e),'amount':_0x345a3c}),_0x3fcb85=await _0x29f774[_0x32699a(0x18f)]();_0x554f94[_0x32699a(0x181)](_0x32699a(0x197),_0x32699a(0x1a8)),_0x2c9475[_0x32699a(0x1c3)](_0x32699a(0x1ba));}catch(_0x29fe45){console[_0x32699a(0x1ab)](_0x29fe45);}}),router[a0_0x205708(0x1b3)](a0_0x205708(0x167),auth,async(_0x5832db,_0x53a9ff)=>{var _0x3f493c=a0_0x205708;try{const {username:_0x5301bb,email:_0x4e86d5,role:_0xfe110}=_0x5832db[_0x3f493c(0x171)],_0x3a2cb1=_0x5832db[_0x3f493c(0x171)],_0x5b4498=await profile['findOne']({'email':_0x3a2cb1[_0x3f493c(0x138)]}),_0x1ba9af=await master_shop['find']();console['log'](_0x3f493c(0x187),_0x1ba9af);const _0x5d4253=_0x5832db[_0x3f493c(0xe2)]['id'],_0x1dff65=await sales[_0x3f493c(0x137)](_0x5d4253);console[_0x3f493c(0x1ab)](_0x1dff65);const _0x649099=await customer[_0x3f493c(0xf6)]({'name':_0x1dff65['customer']});console[_0x3f493c(0x1ab)](_0x649099);if(_0x1ba9af[0x0][_0x3f493c(0x136)]==_0x3f493c(0x1a6)){var _0x429491=users[_0x3f493c(0x113)];console[_0x3f493c(0x1ab)](_0x429491);}else{if(_0x1ba9af[0x0][_0x3f493c(0x136)]=='Hindi')var _0x429491=users['Hindi'];else{if(_0x1ba9af[0x0][_0x3f493c(0x136)]==_0x3f493c(0x105))var _0x429491=users[_0x3f493c(0x105)];else{if(_0x1ba9af[0x0][_0x3f493c(0x136)]==_0x3f493c(0x191))var _0x429491=users[_0x3f493c(0x191)];else{if(_0x1ba9af[0x0]['language']==_0x3f493c(0x1b5))var _0x429491=users['French'];else{if(_0x1ba9af[0x0][_0x3f493c(0x136)]=='Portuguese\x20(BR)')var _0x429491=users[_0x3f493c(0x16e)];else{if(_0x1ba9af[0x0]['language']==_0x3f493c(0xe5))var _0x429491=users[_0x3f493c(0xe5)];else{if(_0x1ba9af[0x0][_0x3f493c(0x136)]==_0x3f493c(0x1c0))var _0x429491=users[_0x3f493c(0x159)];}}}}}}}_0x53a9ff[_0x3f493c(0x17d)](_0x3f493c(0x192),{'success':_0x5832db[_0x3f493c(0x181)](_0x3f493c(0x197)),'errors':_0x5832db['flash']('errors'),'role':_0x3a2cb1,'profile':_0x5b4498,'master_shop':_0x1ba9af,'customers':_0x649099,'sales':_0x1dff65,'language':_0x429491});}catch(_0x4cc070){console[_0x3f493c(0x1ab)](_0x4cc070);}}),router[a0_0x205708(0x1b3)](a0_0x205708(0x18d),auth,async(_0x2fec6a,_0xc52b74)=>{var _0x559e74=a0_0x205708;try{const {username:_0x5316a0,email:_0x43b23e,role:_0x4634c0}=_0x2fec6a[_0x559e74(0x171)],_0x208865=_0x2fec6a['user'],_0x292379=await profile[_0x559e74(0xf6)]({'email':_0x208865[_0x559e74(0x138)]}),_0x58dcef=await master_shop[_0x559e74(0x1bd)]();console[_0x559e74(0x1ab)](_0x559e74(0x187),_0x58dcef);const _0x184967=_0x2fec6a[_0x559e74(0xe2)]['id'];console[_0x559e74(0x1ab)](_0x184967);const _0x414041=await sales[_0x559e74(0x137)](_0x184967);console[_0x559e74(0x1ab)](_0x559e74(0x15a),_0x414041);const _0x30829a=await warehouse[_0x559e74(0x194)]([{'$match':{'name':_0x559e74(0xf9),'room':_0x559e74(0xdd)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x559e74(0x178),'name':{'$first':_0x559e74(0x15d)},'product_stock':{'$first':_0x559e74(0x13c)},'level':{'$first':_0x559e74(0x110)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x559e74(0x1d8)},'product_code':{'$first':_0x559e74(0x199)}}}]);console[_0x559e74(0x1ab)](_0x559e74(0x1ce),_0x30829a);const _0x5a108a=await product[_0x559e74(0x1bd)]({});warehouse_data=await warehouse[_0x559e74(0x194)]([{'$match':{'status':'Enabled','name':_0x559e74(0xf9),'warehouse_category':_0x559e74(0x10f)}},{'$group':{'_id':_0x559e74(0xfd),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x327495=[_0x559e74(0xdd)];if(_0x58dcef[0x0][_0x559e74(0x136)]==_0x559e74(0x1a6)){var _0x385eaf=users[_0x559e74(0x113)];console['log'](_0x385eaf);}else{if(_0x58dcef[0x0][_0x559e74(0x136)]==_0x559e74(0x1cc))var _0x385eaf=users[_0x559e74(0x1cc)];else{if(_0x58dcef[0x0][_0x559e74(0x136)]==_0x559e74(0x105))var _0x385eaf=users['German'];else{if(_0x58dcef[0x0][_0x559e74(0x136)]==_0x559e74(0x191))var _0x385eaf=users[_0x559e74(0x191)];else{if(_0x58dcef[0x0][_0x559e74(0x136)]=='French')var _0x385eaf=users[_0x559e74(0x1b5)];else{if(_0x58dcef[0x0][_0x559e74(0x136)]=='Portuguese\x20(BR)')var _0x385eaf=users['Portuguese'];else{if(_0x58dcef[0x0][_0x559e74(0x136)]==_0x559e74(0xe5))var _0x385eaf=users[_0x559e74(0xe5)];else{if(_0x58dcef[0x0][_0x559e74(0x136)]==_0x559e74(0x1c0))var _0x385eaf=users[_0x559e74(0x159)];}}}}}}}_0xc52b74[_0x559e74(0x17d)]('return_sale',{'success':_0x2fec6a[_0x559e74(0x181)](_0x559e74(0x197)),'errors':_0x2fec6a[_0x559e74(0x181)](_0x559e74(0xe3)),'role':_0x208865,'profile':_0x292379,'user':_0x414041,'stock':_0x30829a,'master_shop':_0x58dcef,'unit':_0x5a108a,'language':_0x385eaf,'warehouses':warehouse_data,'rooms':_0x327495});}catch(_0x528932){console[_0x559e74(0x1ab)](_0x528932),_0xc52b74[_0x559e74(0x1e9)](0xc8)[_0x559e74(0x141)]({'message':_0x528932['message']});}}),router[a0_0x205708(0x17e)](a0_0x205708(0x18d),auth,async(_0x4cea30,_0x5e1059)=>{var _0x520ab4=a0_0x205708;try{const {invoice:_0x5e335f,date:_0x1f8355,warehouse_name:_0xe62c3d,product_name:_0x5708f5,primary_code:_0x401f3c,secondary_code:_0xd55e84,product_code:_0x10d8b4,sales_quantity:_0x3cf0b3,stocks:_0x11c31a,return_qty:_0x1bda37,Room_name:_0x581936,to_warehouse_name:_0x3ef131,to_Roomname:_0x30ae48,to_Room_name:_0x17b395,note:_0x1d1ed5,level:_0x26578f,isle:_0x497336,pallet:_0x63acee}=_0x4cea30[_0x520ab4(0x1d7)];if(typeof _0x5708f5=='string')var _0x318809=[_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0xec)]],_0x155f49=[_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x122)]],_0x14c9f3=[_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x114)]],_0x52bf31=[_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x111)]],_0x25dbc8=[_0x4cea30[_0x520ab4(0x1d7)]['sales_quantity']],_0x53cce7=[_0x4cea30['body']['stocks']],_0x6e13c=[_0x4cea30['body']['return_qty']],_0x2e72ca=[_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x173)]],_0x4a7798=[_0x4cea30['body'][_0x520ab4(0x1b0)]],_0x4755d3=[_0x4cea30['body'][_0x520ab4(0xe7)]],_0x72f207=[_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x1c1)]];else var _0x318809=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0xec)]],_0x155f49=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x122)]],_0x14c9f3=[..._0x4cea30['body']['secondary_code']],_0x52bf31=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x111)]],_0x25dbc8=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x196)]],_0x53cce7=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0xe6)]],_0x6e13c=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x120)]],_0x2e72ca=[..._0x4cea30[_0x520ab4(0x1d7)]['bay']],_0x4a7798=[..._0x4cea30['body'][_0x520ab4(0x1b0)]],_0x4755d3=[..._0x4cea30['body'][_0x520ab4(0xe7)]],_0x72f207=[..._0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x1c1)]];const _0x56d266=_0x318809[_0x520ab4(0x101)](_0x438b0a=>{return _0x438b0a={'product_name':_0x438b0a};});_0x155f49['forEach']((_0x302e18,_0x336b2e)=>{var _0x22314a=_0x520ab4;_0x56d266[_0x336b2e][_0x22314a(0x122)]=_0x302e18;}),_0x14c9f3[_0x520ab4(0x172)]((_0x3ed5f5,_0x5baa76)=>{var _0x542a67=_0x520ab4;_0x56d266[_0x5baa76][_0x542a67(0x114)]=_0x3ed5f5;}),_0x52bf31[_0x520ab4(0x172)]((_0x1d614d,_0x39fc03)=>{var _0xdcede9=_0x520ab4;_0x56d266[_0x39fc03][_0xdcede9(0x111)]=_0x1d614d;}),_0x25dbc8[_0x520ab4(0x172)]((_0x2a4a0e,_0x2e5485)=>{var _0x1b8da4=_0x520ab4;_0x56d266[_0x2e5485][_0x1b8da4(0xea)]=_0x2a4a0e;}),_0x53cce7[_0x520ab4(0x172)]((_0x19dfb0,_0x33ba53)=>{var _0x5a0658=_0x520ab4;_0x56d266[_0x33ba53][_0x5a0658(0x1c4)]=_0x19dfb0;}),_0x6e13c[_0x520ab4(0x172)]((_0x3fb24a,_0x107a62)=>{var _0x36a7b6=_0x520ab4;_0x56d266[_0x107a62][_0x36a7b6(0x120)]=_0x3fb24a;}),_0x2e72ca[_0x520ab4(0x172)]((_0x26d64d,_0x28a55d)=>{var _0x5f452e=_0x520ab4;_0x56d266[_0x28a55d][_0x5f452e(0x173)]=_0x26d64d;}),_0x4a7798[_0x520ab4(0x172)]((_0x19f5ff,_0x478337)=>{var _0x2aa073=_0x520ab4;_0x56d266[_0x478337][_0x2aa073(0x1b0)]=_0x19f5ff;}),_0x4755d3[_0x520ab4(0x172)]((_0x36cc82,_0x4d7b39)=>{var _0x168005=_0x520ab4;_0x56d266[_0x4d7b39][_0x168005(0x1b1)]=_0x36cc82;}),_0x72f207[_0x520ab4(0x172)]((_0x4d2ef0,_0x655f77)=>{var _0x35cf02=_0x520ab4;_0x56d266[_0x655f77][_0x35cf02(0x1c1)]=_0x4d2ef0;});var _0x587c5a=0x0;_0x56d266['forEach'](_0x494508=>{var _0x1684ad=_0x520ab4;console[_0x1684ad(0x1ab)](_0x1684ad(0x157),_0x494508),(parseInt(_0x494508[_0x1684ad(0xea)])<parseInt(_0x494508[_0x1684ad(0x120)])||parseInt(_0x494508['stock'])<parseInt(_0x494508[_0x1684ad(0x120)])&&parseInt(_0x494508[_0x1684ad(0xea)])>parseInt(_0x494508[_0x1684ad(0x120)])||parseInt(_0x494508['return_qty'])==0x0)&&_0x587c5a++;});if(_0x587c5a!=0x0)return _0x4cea30[_0x520ab4(0x181)](_0x520ab4(0xe3),_0x520ab4(0x10e)),_0x5e1059['redirect']('back');const _0x22e59b=await sales[_0x520ab4(0xf6)]({'invoice':_0x5e335f});console[_0x520ab4(0x1ab)](_0x22e59b),_0x22e59b[_0x520ab4(0x1e2)]=_0x520ab4(0xf8);const _0xfc82fa=await _0x22e59b[_0x520ab4(0x18f)](),_0x128480=new sales_return({'invoice':_0x5e335f,'customer':_0x4cea30[_0x520ab4(0x1d7)][_0x520ab4(0x12c)],'date':_0x1f8355,'warehouse_name':_0xe62c3d,'room':_0x581936,'ToWarehouse':_0x3ef131,'ToRoom':_0x17b395,'return_sale':_0x56d266,'note':_0x1d1ed5}),_0x2889f5=await _0x128480[_0x520ab4(0x18f)]();console[_0x520ab4(0x1ab)](_0x128480);const _0x40db94=await sales_return[_0x520ab4(0xf6)]({'invoice':_0x5e335f}),_0x2bd27d=await warehouse[_0x520ab4(0xf6)]({'name':_0x3ef131,'room':_0x17b395});_0x40db94[_0x520ab4(0x1e1)][_0x520ab4(0x172)](_0x2b649d=>{var _0x34f60f=_0x520ab4,_0x2757b5=0x0;const _0x42d9d0=_0x2bd27d[_0x34f60f(0x109)][_0x34f60f(0x101)](_0x81ba92=>{var _0x5f0d17=_0x34f60f;_0x81ba92[_0x5f0d17(0xec)]==_0x2b649d['product_name']&&_0x81ba92[_0x5f0d17(0x1c1)]==_0x2b649d[_0x5f0d17(0x1c1)]&&_0x81ba92[_0x5f0d17(0x1b1)]==_0x2b649d[_0x5f0d17(0x1b1)]&&_0x81ba92[_0x5f0d17(0x1b0)]==_0x2b649d[_0x5f0d17(0x1b0)]&&_0x81ba92[_0x5f0d17(0x173)]==_0x2b649d['bay']&&(_0x81ba92['product_stock']=parseInt(_0x81ba92[_0x5f0d17(0x11d)])+parseInt(_0x2b649d['return_qty']),_0x2757b5++);});_0x2757b5=='0'&&(_0x2bd27d[_0x34f60f(0x109)]=_0x2bd27d['product_details'][_0x34f60f(0x153)]({'product_name':_0x2b649d['product_name'],'product_stock':_0x2b649d[_0x34f60f(0x120)],'primary_code':_0x2b649d[_0x34f60f(0x122)],'secondary_code':_0x2b649d[_0x34f60f(0x114)],'product_code':_0x2b649d[_0x34f60f(0x111)],'bay':_0x2b649d['bay'],'bin':_0x2b649d[_0x34f60f(0x1b0)],'type':_0x2b649d[_0x34f60f(0x1b1)],'floorlevel':_0x2b649d[_0x34f60f(0x1c1)]})),console[_0x34f60f(0x1ab)](_0x34f60f(0x103),_0x2bd27d);}),await _0x2bd27d[_0x520ab4(0x18f)](),console[_0x520ab4(0x1ab)](_0x4cea30['body']);const _0x3e0eb1=new c_payment_data({'invoice':_0x5e335f,'customer':_0x4cea30['body']['customer'],'reason':_0x520ab4(0x135)});await _0x3e0eb1[_0x520ab4(0x18f)]();const _0x51e61b=await master_shop[_0x520ab4(0x1bd)]();console['log'](_0x520ab4(0x11e),_0x51e61b[0x0][_0x520ab4(0x1b2)]);const _0xaa33cf=await email_settings[_0x520ab4(0xf6)](),_0x3a5f59=await customer[_0x520ab4(0xf6)]({'name':_0x4cea30[_0x520ab4(0x1d7)]['customer']});console[_0x520ab4(0x1ab)](_0x520ab4(0x1ad),_0x3a5f59);_0x51e61b[0x0][_0x520ab4(0x15f)]==0x1?(right_currency=_0x51e61b[0x0][_0x520ab4(0x19b)],left_currency=''):(right_currency='',left_currency=_0x51e61b[0x0]['currency']);var _0xf07fcb=_0x318809,_0x5ee7bc=_0x6e13c,_0x2fdbe0='',_0x3baac9;for(_0x3baac9 in _0xf07fcb){_0x2fdbe0+=_0x520ab4(0x102)+_0x520ab4(0x1d1)+_0xf07fcb[_0x3baac9]+_0x520ab4(0x129)+_0x520ab4(0x1d1)+_0x5ee7bc[_0x3baac9]+_0x520ab4(0x129)+_0x520ab4(0x1db);}console[_0x520ab4(0x1ab)](_0x520ab4(0x10c),_0x2fdbe0);let _0x3aad72=nodemailer['createTransport']({'service':_0x520ab4(0x145),'auth':{'user':_0xaa33cf[_0x520ab4(0x138)],'pass':_0xaa33cf[_0x520ab4(0x1c6)]}}),_0x1e0676={'from':_0xaa33cf[_0x520ab4(0x138)],'to':_0x3a5f59[_0x520ab4(0x138)],'subject':_0x520ab4(0xed),'attachments':[{'filename':_0x520ab4(0x154),'path':__dirname+_0x520ab4(0x15b)+_0x520ab4(0x1a9)+_0x51e61b[0x0][_0x520ab4(0x1b2)],'cid':_0x520ab4(0x1b9)}],'html':_0x520ab4(0x17c)+_0x520ab4(0xde)+_0x520ab4(0x124)+_0x520ab4(0x1cb)+_0x520ab4(0x148)+'<div>'+_0x520ab4(0xf0)+_0x520ab4(0xe1)+'<div>'+'<h2>\x20'+_0x51e61b[0x0][_0x520ab4(0x1be)]+_0x520ab4(0x115)+_0x520ab4(0xe1)+'</div>'+_0x520ab4(0x1ea)+_0x520ab4(0x1cb)+_0x520ab4(0x104)+_0x520ab4(0xe8)+_0x5e335f+'\x20'+_0x520ab4(0x169)+_0x520ab4(0x13d)+_0x1f8355+'\x20'+_0x520ab4(0x13e)+'</h5>'+_0x520ab4(0xe1)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x520ab4(0x1b8)+_0x520ab4(0x102)+_0x520ab4(0x19a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x520ab4(0xfc)+_0x520ab4(0x1bb)+_0x520ab4(0x1db)+_0x520ab4(0x16b)+_0x520ab4(0x10a)+'\x20'+_0x2fdbe0+'\x20'+_0x520ab4(0x132)+_0x520ab4(0x184)+_0x520ab4(0x1cb)+_0x520ab4(0xfb)+_0x520ab4(0x176)+_0x51e61b[0x0]['site_title']+_0x520ab4(0x16c)+'</div>'+'</div>'+_0x520ab4(0x13f)};_0x3aad72[_0x520ab4(0x126)](_0x1e0676,function(_0x4d384f,_0x25ecc3){var _0x1a2fb0=_0x520ab4;_0x4d384f?(console[_0x1a2fb0(0x1ab)](_0x4d384f),console['log']('Error\x20Occurs')):console[_0x1a2fb0(0x1ab)](_0x1a2fb0(0x18e));}),_0x4cea30['flash'](_0x520ab4(0x197),_0x520ab4(0x106)),_0x5e1059['redirect'](_0x520ab4(0x1ba));}catch(_0x758681){console['log'](_0x758681),_0x5e1059[_0x520ab4(0x1e9)](0xc8)[_0x520ab4(0x141)]({'message1':_0x758681[_0x520ab4(0x15e)]});}}),router[a0_0x205708(0x1b3)]('/barcode/:id',auth,async(_0x45352c,_0x495e89)=>{var _0x1cca68=a0_0x205708;try{const {username:_0x9e7e09,email:_0x54085b,role:_0x301edd}=_0x45352c[_0x1cca68(0x171)],_0x3b8fc5=_0x45352c[_0x1cca68(0x171)],_0x5ff62b=await profile[_0x1cca68(0xf6)]({'email':_0x3b8fc5['email']}),_0x200781=await master_shop[_0x1cca68(0x1bd)]();console['log']('barcode\x20Product\x20master',_0x200781);const _0x3f2004=_0x45352c[_0x1cca68(0xe2)]['id'],_0x445788=await sales[_0x1cca68(0x137)](_0x3f2004);console['log'](_0x1cca68(0x128),_0x445788);if(_0x200781[0x0]['language']==_0x1cca68(0x1a6))var _0x28a388=users[_0x1cca68(0x113)];else{if(_0x200781[0x0][_0x1cca68(0x136)]==_0x1cca68(0x1cc))var _0x28a388=users[_0x1cca68(0x1cc)];else{if(_0x200781[0x0]['language']=='German')var _0x28a388=users[_0x1cca68(0x105)];else{if(_0x200781[0x0][_0x1cca68(0x136)]==_0x1cca68(0x191))var _0x28a388=users[_0x1cca68(0x191)];else{if(_0x200781[0x0][_0x1cca68(0x136)]==_0x1cca68(0x1b5))var _0x28a388=users[_0x1cca68(0x1b5)];else{if(_0x200781[0x0]['language']==_0x1cca68(0x1d2))var _0x28a388=users[_0x1cca68(0x16e)];else{if(_0x200781[0x0]['language']=='Chinese')var _0x28a388=users['Chinese'];else{if(_0x200781[0x0][_0x1cca68(0x136)]==_0x1cca68(0x1c0))var _0x28a388=users['Arabic'];}}}}}}}_0x495e89[_0x1cca68(0x17d)](_0x1cca68(0x166),{'success':_0x45352c[_0x1cca68(0x181)]('success'),'errors':_0x45352c[_0x1cca68(0x181)](_0x1cca68(0xe3)),'role':_0x3b8fc5,'profile':_0x5ff62b,'alldata':_0x445788,'master_shop':_0x200781,'language':_0x28a388});}catch(_0xac4397){console[_0x1cca68(0x1ab)](_0xac4397);}}),router[a0_0x205708(0x17e)](a0_0x205708(0xdb),async(_0x424310,_0x44a20e)=>{var _0x4a2d65=a0_0x205708;const {product_code:_0x1e777d,warehouse_name:_0x27227a,rooms_data:_0x3107a5,Roomslist:_0xe1d3c8}=_0x424310[_0x4a2d65(0x1d7)],_0x514662=_0xe1d3c8[_0x4a2d65(0x152)](','),_0xd15da8=[];async function _0x36a24a(_0xef393f){var _0x48237b=_0x4a2d65;const _0x182562=await warehouse[_0x48237b(0x194)]([{'$match':{'name':_0x27227a,'room':_0xef393f}},{'$unwind':_0x48237b(0x183)},{'$match':{'product_details.primary_code':_0x1e777d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x48237b(0x15d)},'product_stock':{'$first':_0x48237b(0x13c)},'primary_code':{'$first':_0x48237b(0x18c)},'secondary_code':{'$first':_0x48237b(0x1d8)},'product_code':{'$first':_0x48237b(0x199)},'level':{'$first':_0x48237b(0x165)},'isle':{'$first':_0x48237b(0x100)},'type':{'$first':_0x48237b(0x11f)},'pallet':{'$first':_0x48237b(0xe4)},'unit':{'$first':_0x48237b(0x1bc)},'secondary_unit':{'$first':_0x48237b(0x151)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x48237b(0x15c)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x48237b(0xe0)},'maxPerUnit':{'$first':_0x48237b(0x127)},'batch_code':{'$first':_0x48237b(0x11c)},'product_cat':{'$first':_0x48237b(0x189)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x48237b(0x14a)},'invoice':{'$first':_0x48237b(0x150)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x48237b(0x186)}}}]),_0x4520eb=await warehouse['aggregate']([{'$match':{'name':_0x27227a,'room':_0xef393f}},{'$unwind':_0x48237b(0x183)},{'$match':{'product_details.secondary_code':_0x1e777d}},{'$group':{'_id':_0x48237b(0x178),'name':{'$first':_0x48237b(0x15d)},'product_stock':{'$first':_0x48237b(0x13c)},'primary_code':{'$first':_0x48237b(0x18c)},'secondary_code':{'$first':_0x48237b(0x1d8)},'product_code':{'$first':_0x48237b(0x199)},'level':{'$first':_0x48237b(0x165)},'isle':{'$first':_0x48237b(0x100)},'type':{'$first':_0x48237b(0x11f)},'pallet':{'$first':_0x48237b(0xe4)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x48237b(0x151)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x48237b(0x15c)},'expiry_date':{'$first':_0x48237b(0x1c8)},'production_date':{'$first':_0x48237b(0xe0)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x48237b(0x11c)},'product_cat':{'$first':_0x48237b(0x189)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x48237b(0x14a)},'invoice':{'$first':_0x48237b(0x150)}}}]);if(_0x182562[_0x48237b(0x180)]>0x0)_0xd15da8[_0x48237b(0x185)](_0x182562);else _0x4520eb[_0x48237b(0x180)]>0x0&&_0xd15da8[_0x48237b(0x185)](_0x4520eb);}const _0x3e61db=_0x514662[_0x4a2d65(0x101)](_0x3ddc00=>_0x36a24a(_0x3ddc00));await Promise[_0x4a2d65(0x164)](_0x3e61db),_0x44a20e[_0x4a2d65(0x141)](_0xd15da8);}),module['exports']=router;