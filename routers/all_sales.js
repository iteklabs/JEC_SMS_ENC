function a0_0x3010(_0x1ca445,_0x9832c3){var _0x382bc9=a0_0x382b();return a0_0x3010=function(_0x301012,_0x403a3d){_0x301012=_0x301012-0x1e5;var _0x3e205e=_0x382bc9[_0x301012];return _0x3e205e;},a0_0x3010(_0x1ca445,_0x9832c3);}function a0_0x382b(){var _0x101ec5=['<h5\x20style=\x22text-align:\x20left;\x22>','error','365561LQuHCW','</div>','port','amount','product_stock','createTransport','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','getFullYear','aggregate','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sales_invoice','3099272iFFnbH','barcode\x20user_id','</head><body>','</table>','German','Sales\x20Add\x20successfully','/preview/:id','$_id','nodemailer','$product_details.product_cat','Return\x20Rooms','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Raw\x20Materials','primary_unit','Return\x20Goods','currency','Chinese','actual_uom','$product_details.actual_uom','customers_docs','warehouse_name','production_date','date','name','level','An\x20error\x20occurred\x20while\x20saving\x20data.','stock_data','save','storage','$finalize','received_amount','finalize','Arabic','False','add_sales','customer','product_data','/view/add_sales/:id','slice','status','barcode\x20Product\x20master','max','<hr\x20class=\x22my-3\x22>','due_amount','Sale\x20Return\x20Mail','../middleware/auth','staff','453330cEovJu','return_sale','RMSEmail','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<h5>','</body></html>','forEach','/view/return_sales/:id','filter','Router','requested_qty','all_sales','$invoice','$product_details.secondary_code','\x20Order\x20Date\x20:\x20','</td>','Sales\x20Mail','unit','then','<!DOCTYPE\x20html>','Enabled','Arabic\x20(ae)','$product_details.production_date','$product_details.rack','/give_payment/:id','30462YBXfHE','OUT-','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','abs','expiry_date','Logo.png','<span\x20style=\x22float:\x20right;\x22>','248bbPYDr','return_qty','length','<div>','prod_code','Sales\x20Update\x20successfully','email','product_name','Spanish','back','post','$isAllowEdit','site_title','password','add\x20post','</tr>','3157930jICwvu','$product_details.invoice','</tbody>','primary_code','foreach\x20newproduct','rack','payment\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','customer_data','product_code','prod_invoice','sales\x20item\x20return\x20successfull','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','string','</h5>','RoomAssigned','redirect','bin','/view','$sale_product.quantity','English','render','$product_details.secondary_unit','all_sales_barcode','warehouse','/invoice/:id','exports','/all_sales/preview/','sale_product','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','French','floorlevel','sendMail','gmail','findById','<tbody\x20style=\x22text-align:\x20center;\x22>','errors','bay','$product_details.actual_qty','</span>','$customer','stocks','master','prod_cat','Email\x20sent\x20successfully','$sale_product.type','secondary_unit','quantity','secondary_code','product','padStart','<html><head><title></title>','delivery_date','sale_qty','$sale_product.bin','Floor','$note','../models/all_models','$product_details.batch_code','flash','9msmXbt','/all_sales/view','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$sale_product','Enclosed','/barcode_scanner','map','max_per_unit','$product_details.product_stock','$product_details.bin','$product_details.product_name','id_transact','/view/add_sale/product','isAllowEdit','body','logo','find','floor','invoice','45235790wheXiT','quantity_notConverted','getMonth','room_name','$customers_docs','sales_quantity','$product_details.maxPerUnit','delivery_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','findOne','<h2>\x20','$date','edit_sales','express','<strong>\x20Regards\x20</strong>','$name','$product_details.floorlevel','getDate','$room','sales\x20all_data','<tr>','$product_details','maxperunit','params','Portuguese','$product_details.expiry_date','$sale_product.floorlevel','Ambient','True','746430sKIbsN','$product_details.bay','get','id_transaction_from','Level','/../public','$product_details.primary_code','types','$product_details.isle','\x20Order\x20Number\x20:\x20','user_id','$return_data','790JvSlhb','toString','user','role','product_details','batch_code','push','return_data','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','edit_sales_view','/upload/','$product_details.product_code','actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','SCRN','language','Hindi','/view/add_sales','log','Receiving\x20Area','type','success','carton','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Portuguese\x20(BR)','host','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Shelves','json','stock','$product','final','$product_details.storage','$product_details._id','English\x20(US)'];a0_0x382b=function(){return _0x101ec5;};return a0_0x382b();}var a0_0x30fd53=a0_0x3010;(function(_0x3fb969,_0x45d745){var _0x45f97a=a0_0x3010,_0x478c63=_0x3fb969();while(!![]){try{var _0x1991d4=parseInt(_0x45f97a(0x25f))/0x1+parseInt(_0x45f97a(0x1f3))/0x2+-parseInt(_0x45f97a(0x2cd))/0x3+parseInt(_0x45f97a(0x29e))/0x4+parseInt(_0x45f97a(0x26b))/0x5*(parseInt(_0x45f97a(0x2e7))/0x6)+parseInt(_0x45f97a(0x292))/0x7*(parseInt(_0x45f97a(0x2ef))/0x8)+parseInt(_0x45f97a(0x22f))/0x9*(-parseInt(_0x45f97a(0x242))/0xa);if(_0x1991d4===_0x45d745)break;else _0x478c63['push'](_0x478c63['shift']());}catch(_0x15f840){_0x478c63['push'](_0x478c63['shift']());}}}(a0_0x382b,0xceb0b));const express=require(a0_0x30fd53(0x24f)),app=express(),router=express[a0_0x30fd53(0x2d7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x30fd53(0x22c)),auth=require(a0_0x30fd53(0x2cb)),nodemailer=require(a0_0x30fd53(0x2a6)),users=require('../public/language/languages.json');router[a0_0x30fd53(0x261)](a0_0x30fd53(0x205),auth,async(_0xcab88e,_0x2e03dc)=>{var _0x3f2ff3=a0_0x30fd53;try{const {username:_0x1db6c7,email:_0x1e40c7,role:_0x4340c4}=_0xcab88e[_0x3f2ff3(0x26d)],_0x2e1a90=_0xcab88e[_0x3f2ff3(0x26d)],_0x5334ab=await profile[_0x3f2ff3(0x24b)]({'email':_0x2e1a90['email']}),_0x15a226=await master_shop[_0x3f2ff3(0x23f)]();let _0x58f81f;if(_0x2e1a90[_0x3f2ff3(0x26e)]==_0x3f2ff3(0x2cc)){const _0x11678f=await staff[_0x3f2ff3(0x24b)]({'email':_0x2e1a90[_0x3f2ff3(0x1e9)]});_0x58f81f=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x3f2ff3(0x2c1),'foreignField':_0x3f2ff3(0x2b5),'as':'customers_docs'}},{'$unwind':_0x3f2ff3(0x246)},{'$unwind':_0x3f2ff3(0x232)},{'$group':{'_id':_0x3f2ff3(0x2a5),'invoice':{'$first':_0x3f2ff3(0x2da)},'customers':{'$first':_0x3f2ff3(0x21b)},'date':{'$first':_0x3f2ff3(0x24d)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3f2ff3(0x232)},'note':{'$first':_0x3f2ff3(0x22b)},'return_data':{'$first':_0x3f2ff3(0x26a)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3f2ff3(0x2e9)},'isle':{'$addToSet':_0x3f2ff3(0x229)},'type':{'$addToSet':_0x3f2ff3(0x220)},'pallet':{'$addToSet':_0x3f2ff3(0x25c)},'finalize':{'$first':_0x3f2ff3(0x2bb)},'isAllowEdit':{'$first':_0x3f2ff3(0x1ee)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x58f81f=await sales[_0x3f2ff3(0x29b)]([{'$lookup':{'from':'customers','localField':_0x3f2ff3(0x2c1),'foreignField':'name','as':_0x3f2ff3(0x2b1)}},{'$unwind':_0x3f2ff3(0x246)},{'$unwind':_0x3f2ff3(0x232)},{'$group':{'_id':_0x3f2ff3(0x2a5),'invoice':{'$first':_0x3f2ff3(0x2da)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3f2ff3(0x232)},'note':{'$first':_0x3f2ff3(0x22b)},'return_data':{'$first':_0x3f2ff3(0x26a)},'customers_docs':{'$first':_0x3f2ff3(0x246)},'total_saleproduct_quantity':{'$sum':_0x3f2ff3(0x206)},'level':{'$addToSet':_0x3f2ff3(0x2e9)},'isle':{'$addToSet':_0x3f2ff3(0x229)},'type':{'$addToSet':_0x3f2ff3(0x220)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3f2ff3(0x2bb)},'isAllowEdit':{'$first':_0x3f2ff3(0x1ee)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3f2ff3(0x27d)](_0x3f2ff3(0x255),_0x58f81f);if(_0x15a226[0x0][_0x3f2ff3(0x27a)]==_0x3f2ff3(0x28f)){var _0x3c723c=users[_0x3f2ff3(0x207)];console[_0x3f2ff3(0x27d)](_0x3c723c);}else{if(_0x15a226[0x0]['language']=='Hindi')var _0x3c723c=users[_0x3f2ff3(0x27b)];else{if(_0x15a226[0x0][_0x3f2ff3(0x27a)]=='German')var _0x3c723c=users['German'];else{if(_0x15a226[0x0][_0x3f2ff3(0x27a)]==_0x3f2ff3(0x1eb))var _0x3c723c=users['Spanish'];else{if(_0x15a226[0x0]['language']=='French')var _0x3c723c=users[_0x3f2ff3(0x211)];else{if(_0x15a226[0x0][_0x3f2ff3(0x27a)]==_0x3f2ff3(0x284))var _0x3c723c=users[_0x3f2ff3(0x25a)];else{if(_0x15a226[0x0][_0x3f2ff3(0x27a)]==_0x3f2ff3(0x2ae))var _0x3c723c=users[_0x3f2ff3(0x2ae)];else{if(_0x15a226[0x0][_0x3f2ff3(0x27a)]==_0x3f2ff3(0x2e3))var _0x3c723c=users[_0x3f2ff3(0x2be)];}}}}}}}_0x2e03dc['render'](_0x3f2ff3(0x2d9),{'success':_0xcab88e['flash']('success'),'errors':_0xcab88e['flash'](_0x3f2ff3(0x217)),'sales':_0x58f81f,'profile':_0x5334ab,'role':_0x2e1a90,'master_shop':_0x15a226,'language':_0x3c723c});}catch(_0x10ce01){console[_0x3f2ff3(0x27d)](_0x10ce01);}});async function getRandom8DigitNumber(){var _0x4ddef9=a0_0x30fd53;const _0x1b65e9=0x989680,_0x58d84d=0x5f5e0ff,_0x4ec826=Math[_0x4ddef9(0x240)](Math['random']()*(_0x58d84d-_0x1b65e9+0x1))+_0x1b65e9;var _0xc6f9fe;const _0x409618=await sales[_0x4ddef9(0x24b)]({'invoice':'OUT-'+_0x4ec826});return _0x409618&&_0x409618[_0x4ddef9(0x1e5)]>0x0?_0xc6f9fe=_0x4ddef9(0x2e8)+_0x4ec826:_0xc6f9fe=_0x4ddef9(0x2e8)+_0x4ec826,_0xc6f9fe;}router[a0_0x30fd53(0x261)](a0_0x30fd53(0x27c),auth,async(_0x27cdfa,_0x149494)=>{var _0x4fd0f7=a0_0x30fd53;try{const {username:_0x316d42,email:_0x18eac4,role:_0x4f9b15}=_0x27cdfa['user'],_0xbc4774=_0x27cdfa[_0x4fd0f7(0x26d)],_0x438c9c=await profile[_0x4fd0f7(0x24b)]({'email':_0xbc4774['email']}),_0x1099da=await master_shop[_0x4fd0f7(0x23f)](),_0xeab6bf=await customer[_0x4fd0f7(0x23f)]({});let _0x38c1d7;if(_0xbc4774[_0x4fd0f7(0x26e)]==_0x4fd0f7(0x2cc)){const _0x259131=await staff[_0x4fd0f7(0x24b)]({'email':_0xbc4774[_0x4fd0f7(0x1e9)]});_0x38c1d7=await warehouse['aggregate']([{'$match':{'status':_0x4fd0f7(0x2e2),'name':_0x259131[_0x4fd0f7(0x20b)],'warehouse_category':_0x4fd0f7(0x2aa),'name':{'$ne':_0x4fd0f7(0x2ac)}}},{'$group':{'_id':'$name','name':{'$first':_0x4fd0f7(0x251)}}},{'$sort':{'name':0x1}}]);}else _0x38c1d7=await warehouse[_0x4fd0f7(0x29b)]([{'$match':{'status':'Enabled','warehouse_category':_0x4fd0f7(0x2aa),'name':{'$ne':_0x4fd0f7(0x2ac)}}},{'$group':{'_id':_0x4fd0f7(0x251),'name':{'$first':_0x4fd0f7(0x251)}}},{'$sort':{'name':0x1}}]);const _0x44cef4=await product[_0x4fd0f7(0x23f)]({});var _0x42ea67=[_0x4fd0f7(0x25d),_0x4fd0f7(0x233)];const _0xacaa6c=await sales[_0x4fd0f7(0x23f)]({}),_0x1a1c9a=_0xacaa6c[_0x4fd0f7(0x1e5)]+0x1,_0x3ef9ff=_0x4fd0f7(0x2e8)+_0x1a1c9a[_0x4fd0f7(0x26c)]()[_0x4fd0f7(0x225)](0x5,'0');if(_0x1099da[0x0][_0x4fd0f7(0x27a)]==_0x4fd0f7(0x28f)){var _0x1b5e5e=users[_0x4fd0f7(0x207)];console[_0x4fd0f7(0x27d)](_0x1b5e5e);}else{if(_0x1099da[0x0][_0x4fd0f7(0x27a)]==_0x4fd0f7(0x27b))var _0x1b5e5e=users['Hindi'];else{if(_0x1099da[0x0]['language']==_0x4fd0f7(0x2a2))var _0x1b5e5e=users[_0x4fd0f7(0x2a2)];else{if(_0x1099da[0x0][_0x4fd0f7(0x27a)]==_0x4fd0f7(0x1eb))var _0x1b5e5e=users['Spanish'];else{if(_0x1099da[0x0][_0x4fd0f7(0x27a)]==_0x4fd0f7(0x211))var _0x1b5e5e=users[_0x4fd0f7(0x211)];else{if(_0x1099da[0x0][_0x4fd0f7(0x27a)]=='Portuguese\x20(BR)')var _0x1b5e5e=users['Portuguese'];else{if(_0x1099da[0x0][_0x4fd0f7(0x27a)]=='Chinese')var _0x1b5e5e=users[_0x4fd0f7(0x2ae)];else{if(_0x1099da[0x0][_0x4fd0f7(0x27a)]==_0x4fd0f7(0x2e3))var _0x1b5e5e=users[_0x4fd0f7(0x2be)];}}}}}}}const _0x28f048=getRandom8DigitNumber();_0x28f048['then'](_0x3bb4fd=>{var _0x475977=_0x4fd0f7;_0x149494[_0x475977(0x208)](_0x475977(0x2c0),{'success':_0x27cdfa[_0x475977(0x22e)](_0x475977(0x280)),'errors':_0x27cdfa[_0x475977(0x22e)]('errors'),'role':_0xbc4774,'profile':_0x438c9c,'customer':_0xeab6bf,'warehouse':_0x38c1d7,'product':_0x44cef4,'invoice':_0x3bb4fd,'master_shop':_0x1099da,'language':_0x1b5e5e,'rooms_data':_0x42ea67});})['catch'](_0x473198=>{var _0x1e747d=_0x4fd0f7;_0x27cdfa[_0x1e747d(0x22e)](_0x1e747d(0x217),_0x1e747d(0x231)),_0x149494['redirect']('/all_sales/view');});}catch(_0x4f763c){console[_0x4fd0f7(0x27d)](_0x4f763c);}}),router[a0_0x30fd53(0x261)](a0_0x30fd53(0x2c3),auth,async(_0x2481d7,_0x5df566)=>{var _0x16c059=a0_0x30fd53;try{const _0x2eacba=_0x2481d7[_0x16c059(0x259)]['id'];console[_0x16c059(0x27d)](_0x2eacba);const _0x157f8d=await product[_0x16c059(0x23f)](),_0x32d2c2=await purchases[_0x16c059(0x29b)]([{'$match':{'warehouse_name':_0x2eacba}},{'$unwind':_0x16c059(0x28b)},{'$group':{'_id':'$product.product_name'}}]);console[_0x16c059(0x27d)]('purchases_data',_0x32d2c2),_0x5df566[_0x16c059(0x2c5)](0xc8)[_0x16c059(0x289)]({'purchases_data':_0x32d2c2,'product_data':_0x157f8d});}catch(_0x2ce973){console[_0x16c059(0x27d)](_0x2ce973);}}),router[a0_0x30fd53(0x1ed)](a0_0x30fd53(0x23b),auth,async(_0x5af9d5,_0xc824b5)=>{var _0x121570=a0_0x30fd53;try{const {warehouse_data:_0x361476,product_data:_0x51404f}=_0x5af9d5[_0x121570(0x23d)];console['log'](_0x5af9d5[_0x121570(0x23d)][_0x121570(0x2c2)]);;const _0x5b7449=await master_shop['find']();console[_0x121570(0x27d)]('master',_0x5b7449);const _0x5b0f8d=await product[_0x121570(0x24b)]({'name':_0x51404f});console[_0x121570(0x27d)](_0x121570(0x224),_0x5b0f8d);const _0xe81cd1=await warehouse['aggregate']([{'$match':{'name':_0x361476}},{'$unwind':_0x121570(0x257)},{'$match':{'product_details.product_name':_0x51404f}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x121570(0x237)}}}]);console[_0x121570(0x27d)](_0x121570(0x2b8),_0xe81cd1),_0xc824b5[_0x121570(0x2c5)](0xc8)[_0x121570(0x289)]({'master':_0x5b7449,'new_product':_0x5b0f8d,'stock_data':_0xe81cd1});}catch(_0x54596d){console[_0x121570(0x27d)](_0x54596d);}}),router[a0_0x30fd53(0x1ed)](a0_0x30fd53(0x27c),auth,async(_0x469835,_0x56ba47)=>{var _0x37728d=a0_0x30fd53;try{const {invoice:_0xf5b3e9,date:_0x38fc73,warehouse_name:_0x491ffe,product_name:_0x53a867,stock:_0x28ab81,quantity:_0x26b633,note:_0x5beaa1,room:_0x407e27,primary_code:_0x4f533b,secondary_code:_0x265abf,prod_code:_0x4c57ad,level:_0x186e11,isle:_0x4f7bfb,pallet:_0xc54ab0,batch_code:_0x445144,SCRN:_0xe183c1,expiry_date:_0x25c799}=_0x469835[_0x37728d(0x23d)];if(typeof _0x53a867==_0x37728d(0x200))var _0x37f614=[_0x469835['body'][_0x37728d(0x1ea)]],_0x1e8d3b=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x28a)]],_0x421de8=[_0x469835[_0x37728d(0x23d)]['carton']],_0x31e67a=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x1f6)]],_0x5b2ba6=[_0x469835[_0x37728d(0x23d)]['secondary_code']],_0x4e4fa7=[_0x469835['body'][_0x37728d(0x1e7)]],_0x508042=[_0x469835['body'][_0x37728d(0x2b6)]],_0x5c131a=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x2ab)]],_0x68f9e8=[_0x469835[_0x37728d(0x23d)]['secondary_unit']],_0x27080c=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x270)]],_0x27002f=[_0x469835['body']['expiry_date']],_0x40cc03=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x236)]],_0xa7db2d=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x2b3)]],_0x272a57=[_0x469835[_0x37728d(0x23d)]['requested_qty']],_0x15b254=[_0x469835['body']['delivery_date']],_0x3cb308=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x249)]],_0x11bbbe=[_0x469835['body'][_0x37728d(0x21e)]],_0x37bd72=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x222)]],_0x21ff0b=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x202)]],_0x7ecbf9=[_0x469835[_0x37728d(0x23d)]['prod_invoice']],_0x582a87=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x277)]],_0x50a6be=[_0x469835['body'][_0x37728d(0x2af)]],_0x5109e0=[_0x469835[_0x37728d(0x23d)][_0x37728d(0x23a)]];else var _0x37f614=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x1ea)]],_0x1e8d3b=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x28a)]],_0x421de8=[..._0x469835['body'][_0x37728d(0x281)]],_0x31e67a=[..._0x469835[_0x37728d(0x23d)]['primary_code']],_0x5b2ba6=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x223)]],_0x4e4fa7=[..._0x469835[_0x37728d(0x23d)]['prod_code']],_0x508042=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x2b6)]],_0x5c131a=[..._0x469835[_0x37728d(0x23d)]['primary_unit']],_0x68f9e8=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x221)]],_0x27080c=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x270)]],_0x27002f=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x2ec)]],_0x40cc03=[..._0x469835['body'][_0x37728d(0x236)]],_0xa7db2d=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x2b3)]],_0x272a57=[..._0x469835['body'][_0x37728d(0x2d8)]],_0x15b254=[..._0x469835['body']['delivery_date']],_0x3cb308=[..._0x469835['body'][_0x37728d(0x249)]],_0x11bbbe=[..._0x469835[_0x37728d(0x23d)]['prod_cat']],_0x37bd72=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x222)]],_0x21ff0b=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x202)]],_0x7ecbf9=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x1fd)]],_0x582a87=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x277)]],_0x50a6be=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x2af)]],_0x5109e0=[..._0x469835[_0x37728d(0x23d)][_0x37728d(0x23a)]];const _0x1a447c=_0x37f614[_0x37728d(0x235)](_0x4ea551=>{return _0x4ea551={'product_name':_0x4ea551};});_0x1e8d3b[_0x37728d(0x2d4)]((_0x326c61,_0x4e9f2d)=>{var _0x78ac99=_0x37728d;_0x1a447c[_0x4e9f2d][_0x78ac99(0x28a)]=Math[_0x78ac99(0x2eb)](_0x326c61);}),_0x582a87[_0x37728d(0x2d4)]((_0x4ea023,_0x4c2552)=>{var _0x5c36b1=_0x37728d;_0x1a447c[_0x4c2552][_0x5c36b1(0x277)]=Math[_0x5c36b1(0x2eb)](_0x4ea023);}),_0x50a6be['forEach']((_0x436990,_0x4ca845)=>{var _0x4ad0b9=_0x37728d;_0x1a447c[_0x4ca845][_0x4ad0b9(0x2af)]=_0x436990;}),_0x5109e0[_0x37728d(0x2d4)]((_0x20c214,_0x2ac73b)=>{var _0x6750d4=_0x37728d;_0x1a447c[_0x2ac73b][_0x6750d4(0x262)]=_0x20c214;}),_0x421de8[_0x37728d(0x2d4)]((_0x4fce86,_0x5362c4)=>{var _0x364678=_0x37728d;_0x1a447c[_0x5362c4][_0x364678(0x222)]=_0x4fce86;}),_0x31e67a[_0x37728d(0x2d4)]((_0x582bce,_0x53bc47)=>{_0x1a447c[_0x53bc47]['primary_code']=_0x582bce;}),_0x5b2ba6[_0x37728d(0x2d4)]((_0x50377b,_0x2ee016)=>{var _0x4ea9af=_0x37728d;_0x1a447c[_0x2ee016][_0x4ea9af(0x223)]=_0x50377b;}),_0x4e4fa7['forEach']((_0x2b34a0,_0x4aba5a)=>{var _0x372064=_0x37728d;_0x1a447c[_0x4aba5a][_0x372064(0x1fc)]=_0x2b34a0;}),_0x508042[_0x37728d(0x2d4)]((_0x5bc59c,_0x32841b)=>{_0x21ff0b['forEach']((_0x279091,_0x56e867)=>{var _0x1545af=a0_0x3010;if(_0x279091==_0x1545af(0x27e)&&_0x32841b==_0x56e867){var _0x105350=_0x5bc59c[_0x1545af(0x2c4)](0x3);_0x1a447c[_0x32841b][_0x1545af(0x2ba)]=_0x5bc59c[0x0],_0x1a447c[_0x32841b][_0x1545af(0x1f8)]=_0x5bc59c[0x1],_0x1a447c[_0x32841b]['bay']=0x0,_0x1a447c[_0x32841b][_0x1545af(0x204)]=0x0,_0x1a447c[_0x32841b][_0x1545af(0x27f)]=_0x1545af(0x22a),_0x1a447c[_0x32841b][_0x1545af(0x212)]=_0x105350;}else{if(_0x279091==_0x1545af(0x288)&&_0x32841b==_0x56e867){var _0x105350=_0x5bc59c['slice'](0x3);_0x1a447c[_0x32841b][_0x1545af(0x2ba)]=_0x5bc59c[0x0],_0x1a447c[_0x32841b][_0x1545af(0x1f8)]=_0x5bc59c[0x1],_0x1a447c[_0x32841b]['bay']=0x0,_0x1a447c[_0x32841b][_0x1545af(0x204)]=0x0,_0x1a447c[_0x32841b][_0x1545af(0x27f)]=_0x1545af(0x22a),_0x1a447c[_0x32841b][_0x1545af(0x212)]=_0x5bc59c[0x5];}else{if(_0x32841b==_0x56e867){var _0x371d4e;if(_0x5bc59c[0x4]=='L')_0x371d4e=_0x1545af(0x263);else _0x5bc59c[0x4]=='F'&&(_0x371d4e=_0x1545af(0x22a));_0x1a447c[_0x32841b]['storage']=_0x5bc59c[0x0],_0x1a447c[_0x32841b][_0x1545af(0x1f8)]=_0x5bc59c[0x1],_0x1a447c[_0x32841b]['bay']=_0x5bc59c[0x2],_0x1a447c[_0x32841b][_0x1545af(0x204)]=_0x5bc59c[0x3],_0x1a447c[_0x32841b][_0x1545af(0x27f)]=_0x371d4e,_0x1a447c[_0x32841b][_0x1545af(0x212)]=_0x5bc59c[0x5];}}}});}),_0x5c131a[_0x37728d(0x2d4)]((_0x1e76f6,_0x202b1d)=>{var _0x4990e2=_0x37728d;_0x1a447c[_0x202b1d][_0x4990e2(0x2df)]=_0x1e76f6;}),_0x68f9e8[_0x37728d(0x2d4)]((_0x2cc992,_0x4c79c7)=>{_0x1a447c[_0x4c79c7]['secondary_unit']=_0x2cc992;}),_0x27080c[_0x37728d(0x2d4)]((_0x12c317,_0x5ae3b6)=>{var _0x4da259=_0x37728d;_0x1a447c[_0x5ae3b6][_0x4da259(0x270)]=_0x12c317;}),_0x27002f[_0x37728d(0x2d4)]((_0x2f4c69,_0x507c7f)=>{var _0x28570e=_0x37728d;_0x1a447c[_0x507c7f][_0x28570e(0x2ec)]=_0x2f4c69;}),_0x40cc03['forEach']((_0x2c4efb,_0x5665d0)=>{var _0x4467c4=_0x37728d;_0x1a447c[_0x5665d0][_0x4467c4(0x258)]=_0x2c4efb;}),_0xa7db2d['forEach']((_0x3afbcf,_0x33c21e)=>{var _0x289eec=_0x37728d;_0x1a447c[_0x33c21e][_0x289eec(0x2b3)]=_0x3afbcf;}),_0x272a57[_0x37728d(0x2d4)]((_0x5481eb,_0x1ae7d8)=>{var _0x175d0d=_0x37728d;_0x1a447c[_0x1ae7d8][_0x175d0d(0x2d8)]=_0x5481eb;}),_0x15b254[_0x37728d(0x2d4)]((_0x314819,_0x1701d6)=>{var _0x163bca=_0x37728d;_0x1a447c[_0x1701d6][_0x163bca(0x227)]=_0x314819;}),_0x3cb308[_0x37728d(0x2d4)]((_0x182f43,_0x1a3ea6)=>{_0x1a447c[_0x1a3ea6]['delivery_code']=_0x182f43;}),_0x11bbbe[_0x37728d(0x2d4)]((_0xba64b7,_0xc62487)=>{var _0x125c1b=_0x37728d;_0x1a447c[_0xc62487][_0x125c1b(0x21e)]=_0xba64b7;}),_0x37bd72[_0x37728d(0x2d4)]((_0x474123,_0x35e00c)=>{var _0x294e72=_0x37728d;_0x1a447c[_0x35e00c][_0x294e72(0x243)]=_0x474123;}),_0x21ff0b['forEach']((_0x1c9616,_0x15d937)=>{var _0x418fd8=_0x37728d;_0x1a447c[_0x15d937][_0x418fd8(0x245)]=_0x1c9616;}),_0x7ecbf9[_0x37728d(0x2d4)]((_0x1b2c7e,_0x516390)=>{var _0x8f7d3f=_0x37728d;_0x1a447c[_0x516390][_0x8f7d3f(0x241)]=_0x1b2c7e;});var _0x6077b=0x0;_0x1a447c['forEach'](_0x8adc77=>{var _0x524667=_0x37728d;(_0x8adc77[_0x524667(0x28a)]<_0x8adc77[_0x524667(0x243)]||_0x8adc77['quantity_notConverted']==0x0)&&(console[_0x524667(0x27d)](_0x524667(0x1f7),_0x8adc77),_0x6077b++);});const _0x3e90ff=_0x1a447c[_0x37728d(0x2d6)](_0x447738=>_0x447738[_0x37728d(0x222)]!=='0'&&_0x447738['quantity']!==''),_0x57b542=new sales({'invoice':_0xf5b3e9,'customer':_0x469835['body'][_0x37728d(0x2c1)],'date':_0x38fc73,'warehouse_name':_0x491ffe,'sale_product':_0x3e90ff,'note':_0x5beaa1,'room':_0x407e27,'primary_code':_0x4f533b,'secondary_code':_0x265abf,'prod_code':_0x4c57ad,'SCRN':_0xe183c1}),_0x3f6a4d=await _0x57b542[_0x37728d(0x2b9)]();_0x469835[_0x37728d(0x22e)](_0x37728d(0x280),_0x37728d(0x2a3)),_0x56ba47[_0x37728d(0x203)](_0x37728d(0x20e)+_0x3f6a4d['_id']);}catch(_0x2ecfbe){console[_0x37728d(0x27d)](_0x2ecfbe);}}),router[a0_0x30fd53(0x261)](a0_0x30fd53(0x2a4),auth,async(_0x2b83c3,_0x503aa5)=>{var _0x4b69e6=a0_0x30fd53;try{const {username:_0x3d80eb,email:_0x497f05,role:_0x5e73bd}=_0x2b83c3['user'],_0x11f010=_0x2b83c3['user'],_0xb4be7d=await profile[_0x4b69e6(0x24b)]({'email':_0x11f010[_0x4b69e6(0x1e9)]}),_0x4a1b8a=await master_shop['find'](),_0x794e8c=_0x2b83c3[_0x4b69e6(0x259)]['id'],_0x53c09a=await sales[_0x4b69e6(0x215)](_0x794e8c),_0xbeef3a=await warehouse[_0x4b69e6(0x29b)]([{'$match':{'name':_0x53c09a['warehouse_name']}},{'$unwind':_0x4b69e6(0x257)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4b69e6(0x237)},'bay':{'$first':_0x4b69e6(0x260)},'bin':{'$first':_0x4b69e6(0x238)},'type':{'$first':_0x4b69e6(0x298)},'floorlevel':{'$first':_0x4b69e6(0x252)},'primary_code':{'$first':_0x4b69e6(0x265)},'secondary_code':{'$first':_0x4b69e6(0x2db)},'product_code':{'$first':_0x4b69e6(0x276)},'storage':{'$first':_0x4b69e6(0x28d)},'rack':{'$first':_0x4b69e6(0x2e5)},'expiry_date':{'$first':_0x4b69e6(0x25b)},'production_date':{'$first':_0x4b69e6(0x2e4)},'invoice':{'$first':_0x4b69e6(0x1f4)}}}]),_0x37fc01=await customer[_0x4b69e6(0x23f)]({});let _0x458e92;if(_0x11f010['role']=='staff'){const _0xec7ec5=await staff['findOne']({'email':_0x11f010['email']});_0x458e92=await warehouse[_0x4b69e6(0x29b)]([{'$match':{'status':_0x4b69e6(0x2e2),'name':_0xec7ec5[_0x4b69e6(0x20b)]}},{'$group':{'_id':_0x4b69e6(0x251),'name':{'$first':_0x4b69e6(0x251)}}}]);}else _0x458e92=await warehouse[_0x4b69e6(0x29b)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4b69e6(0x251),'name':{'$first':_0x4b69e6(0x251)}}}]);const _0x59a1b7=await product[_0x4b69e6(0x23f)]({}),_0x7b9b40=await suppliers[_0x4b69e6(0x23f)]({});if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]==_0x4b69e6(0x28f)){var _0x369cf5=users['English'];console[_0x4b69e6(0x27d)](_0x369cf5);}else{if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]==_0x4b69e6(0x27b))var _0x369cf5=users[_0x4b69e6(0x27b)];else{if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]=='German')var _0x369cf5=users[_0x4b69e6(0x2a2)];else{if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]==_0x4b69e6(0x1eb))var _0x369cf5=users['Spanish'];else{if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]==_0x4b69e6(0x211))var _0x369cf5=users[_0x4b69e6(0x211)];else{if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]==_0x4b69e6(0x284))var _0x369cf5=users['Portuguese'];else{if(_0x4a1b8a[0x0][_0x4b69e6(0x27a)]==_0x4b69e6(0x2ae))var _0x369cf5=users[_0x4b69e6(0x2ae)];else{if(_0x4a1b8a[0x0]['language']==_0x4b69e6(0x2e3))var _0x369cf5=users[_0x4b69e6(0x2be)];}}}}}}}_0x503aa5['render'](_0x4b69e6(0x274),{'success':_0x2b83c3['flash'](_0x4b69e6(0x280)),'errors':_0x2b83c3[_0x4b69e6(0x22e)]('errors'),'role':_0x11f010,'profile':_0xb4be7d,'customer':_0x37fc01,'warehouse':_0x458e92,'product':_0xbeef3a,'user':_0x53c09a,'master_shop':_0x4a1b8a,'unit':_0x59a1b7,'language':_0x369cf5,'suppliers':_0x7b9b40});}catch(_0x2e807a){console[_0x4b69e6(0x27d)](_0x2e807a);}}),router[a0_0x30fd53(0x1ed)](a0_0x30fd53(0x2a4),auth,async(_0x2e9f1e,_0x1e1dfc)=>{var _0x365722=a0_0x30fd53;try{const _0x347c21=_0x2e9f1e[_0x365722(0x259)]['id'],{invoice:_0x271115,warehouse_name:_0x473d3e,room:_0x352a47}=_0x2e9f1e[_0x365722(0x23d)],_0x1d6c93=await sales[_0x365722(0x24b)]({'invoice':_0x271115}),_0x4123d2=_0x1d6c93[_0x365722(0x20f)][_0x365722(0x235)](async _0xbef275=>{var _0x306f57=_0x365722,_0x1ce54a=await warehouse[_0x306f57(0x24b)]({'name':_0x473d3e,'room':_0xbef275[_0x306f57(0x245)],'warehouse_category':_0x306f57(0x2aa)});const _0x4a1628=_0x1ce54a[_0x306f57(0x26f)][_0x306f57(0x235)](_0x4547d9=>{var _0x1df971=_0x306f57;_0x4547d9[_0x1df971(0x1ea)]==_0xbef275['product_name']&&_0x4547d9[_0x1df971(0x212)]==_0xbef275[_0x1df971(0x212)]&&_0x4547d9['type']==_0xbef275[_0x1df971(0x27f)]&&_0x4547d9[_0x1df971(0x204)]==_0xbef275[_0x1df971(0x204)]&&_0x4547d9['bay']==_0xbef275[_0x1df971(0x218)]&&_0x4547d9[_0x1df971(0x1f8)]==_0xbef275['rack']&&_0x4547d9['storage']==_0xbef275[_0x1df971(0x2ba)]&&_0x4547d9[_0x1df971(0x2ec)]==_0xbef275['expiry_date']&&_0x4547d9['batch_code']==_0xbef275[_0x1df971(0x270)]&&_0x4547d9['invoice']==_0xbef275[_0x1df971(0x241)]&&_0x4547d9['_id']==_0xbef275[_0x1df971(0x262)]&&(_0x4547d9[_0x1df971(0x296)]=Math[_0x1df971(0x2c7)](0x0,Math['abs'](_0x4547d9[_0x1df971(0x296)])-Math[_0x1df971(0x2eb)](_0xbef275[_0x1df971(0x222)])));});return _0x1ce54a;});Promise['all'](_0x4123d2)[_0x365722(0x2e0)](async _0x4e21ca=>{var _0x596cf3=_0x365722;try{for(const _0x4eb420 of _0x4e21ca){await _0x4eb420[_0x596cf3(0x2b9)]();}_0x1d6c93[_0x596cf3(0x2bd)]=_0x596cf3(0x25e);const _0xfd0d80=await _0x1d6c93[_0x596cf3(0x2b9)](),_0x10c0e0=await master_shop[_0x596cf3(0x23f)](),_0x4b67f0=await email_settings[_0x596cf3(0x24b)](),_0x520d85=await supervisor_settings[_0x596cf3(0x23f)]();var _0x250540=_0x1d6c93[_0x596cf3(0x20f)],_0x493bb8='',_0x4c5448;for(_0x4c5448 in _0x250540){_0x493bb8+=_0x596cf3(0x256)+_0x596cf3(0x273)+_0x250540[_0x4c5448][_0x596cf3(0x1ea)]+_0x596cf3(0x2dd)+_0x596cf3(0x273)+_0x250540[_0x4c5448]['product_code']+'</td>'+_0x596cf3(0x273)+_0x250540[_0x4c5448][_0x596cf3(0x222)]+_0x596cf3(0x2dd)+_0x596cf3(0x273)+_0x250540[_0x4c5448][_0x596cf3(0x2df)]+'</td>'+_0x596cf3(0x273)+_0x250540[_0x4c5448][_0x596cf3(0x221)]+_0x596cf3(0x2dd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d6c93[_0x596cf3(0x2b2)]+'</td>'+_0x596cf3(0x273)+_0x250540[_0x4c5448]['room_name']+_0x596cf3(0x2dd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x250540[_0x4c5448][_0x596cf3(0x2ba)]+_0x250540[_0x4c5448]['rack']+_0x250540[_0x4c5448][_0x596cf3(0x218)]+_0x250540[_0x4c5448][_0x596cf3(0x204)]+_0x250540[_0x4c5448]['type'][0x0]+_0x250540[_0x4c5448][_0x596cf3(0x212)]+_0x596cf3(0x2dd),_0x596cf3(0x1f2);}let _0x1e7afa=nodemailer['createTransport']({'host':_0x4b67f0[_0x596cf3(0x285)],'port':Number(_0x4b67f0[_0x596cf3(0x294)]),'secure':![],'auth':{'user':_0x4b67f0[_0x596cf3(0x1e9)],'pass':_0x4b67f0[_0x596cf3(0x1f0)]}}),_0x523cea={'from':_0x4b67f0[_0x596cf3(0x1e9)],'to':_0x520d85[0x0][_0x596cf3(0x2cf)],'subject':_0x596cf3(0x2de),'attachments':[{'filename':'Logo.png','path':__dirname+_0x596cf3(0x264)+_0x596cf3(0x275)+_0x10c0e0[0x0][_0x596cf3(0x282)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x596cf3(0x2a0)+'<div>'+_0x596cf3(0x210)+'<div>'+_0x596cf3(0x1fa)+_0x596cf3(0x293)+'<div>'+_0x596cf3(0x24c)+_0x10c0e0[0x0]['site_title']+'\x20</h2>'+_0x596cf3(0x293)+'</div>'+_0x596cf3(0x2c8)+'<div>'+_0x596cf3(0x290)+_0x596cf3(0x268)+_0x1d6c93[_0x596cf3(0x241)]+'\x20'+_0x596cf3(0x2ee)+_0x596cf3(0x2dc)+_0x1d6c93[_0x596cf3(0x2b4)]+'\x20'+_0x596cf3(0x21a)+_0x596cf3(0x201)+'</div>'+_0x596cf3(0x2a9)+_0x596cf3(0x29c)+'<tr>'+_0x596cf3(0x287)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x596cf3(0x24a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x596cf3(0x2d1)+_0x596cf3(0x2ea)+_0x596cf3(0x1f2)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x493bb8+'\x20'+'</tbody>'+_0x596cf3(0x2a1)+_0x596cf3(0x1e6)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x10c0e0[0x0]['site_title']+_0x596cf3(0x201)+_0x596cf3(0x293)+_0x596cf3(0x293)+'</body></html>'};_0x1e7afa[_0x596cf3(0x213)](_0x523cea,function(_0x14f03b,_0x4ed545){var _0x2bef5=_0x596cf3;_0x14f03b?(console[_0x2bef5(0x27d)](_0x14f03b),console[_0x2bef5(0x27d)]('Error\x20Occurs')):console[_0x2bef5(0x27d)](_0x2bef5(0x21f));}),_0x2e9f1e[_0x596cf3(0x22e)](_0x596cf3(0x280),_0x596cf3(0x1e8)),_0x1e1dfc[_0x596cf3(0x203)](_0x596cf3(0x20e)+_0x347c21);}catch(_0x21e359){console[_0x596cf3(0x291)](_0x21e359),_0x1e1dfc[_0x596cf3(0x2c5)](0x1f4)[_0x596cf3(0x289)]({'error':_0x596cf3(0x2b7)});}})[_0x365722(0x286)](_0x3acb6c=>{var _0x540419=_0x365722;console[_0x540419(0x291)](_0x3acb6c),_0x1e1dfc[_0x540419(0x2c5)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x157acf){console[_0x365722(0x27d)](_0x157acf);}}),router[a0_0x30fd53(0x261)]('/view/:id',auth,async(_0x5a9dc4,_0x21c408)=>{var _0x309338=a0_0x30fd53;try{const {username:_0x129bbf,email:_0x3863c6,role:_0x4ddd0f}=_0x5a9dc4[_0x309338(0x26d)],_0x16e562=_0x5a9dc4[_0x309338(0x26d)],_0x4786a8=await profile['findOne']({'email':_0x16e562[_0x309338(0x1e9)]}),_0x5aab39=await master_shop[_0x309338(0x23f)](),_0x49e429=_0x5a9dc4[_0x309338(0x259)]['id'],_0x5a9d2d=await sales[_0x309338(0x215)](_0x49e429);var _0x1f0196=['Ambient','Enclosed'];const _0x747ec=await warehouse[_0x309338(0x29b)]([{'$match':{'name':_0x5a9d2d[_0x309338(0x2b2)],'warehouse_category':_0x309338(0x2aa)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x309338(0x28e),'name':{'$first':_0x309338(0x239)},'product_stock':{'$first':_0x309338(0x237)},'bay':{'$first':_0x309338(0x260)},'bin':{'$first':_0x309338(0x238)},'type':{'$first':_0x309338(0x298)},'floorlevel':{'$first':_0x309338(0x252)},'primary_code':{'$first':_0x309338(0x265)},'secondary_code':{'$first':_0x309338(0x2db)},'product_code':{'$first':_0x309338(0x276)},'storage':{'$first':_0x309338(0x28d)},'rack':{'$first':_0x309338(0x2e5)}}}]),_0x501349=await customer[_0x309338(0x23f)]({});let _0x19e1a0;if(_0x16e562[_0x309338(0x26e)]=='staff'){const _0x384567=await staff['findOne']({'email':_0x16e562[_0x309338(0x1e9)]});_0x19e1a0=await warehouse[_0x309338(0x29b)]([{'$match':{'status':_0x309338(0x2e2),'name':_0x384567[_0x309338(0x20b)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x309338(0x251),'name':{'$first':_0x309338(0x251)}}}]);}else _0x19e1a0=await warehouse[_0x309338(0x29b)]([{'$match':{'status':_0x309338(0x2e2),'warehouse_category':_0x309338(0x2aa)}},{'$group':{'_id':_0x309338(0x251),'name':{'$first':'$name'}}}]);const _0xf925dc=await product[_0x309338(0x23f)]({});if(_0x5aab39[0x0]['language']==_0x309338(0x28f)){var _0x5ea63c=users['English'];console[_0x309338(0x27d)](_0x5ea63c);}else{if(_0x5aab39[0x0][_0x309338(0x27a)]==_0x309338(0x27b))var _0x5ea63c=users[_0x309338(0x27b)];else{if(_0x5aab39[0x0][_0x309338(0x27a)]==_0x309338(0x2a2))var _0x5ea63c=users['German'];else{if(_0x5aab39[0x0][_0x309338(0x27a)]=='Spanish')var _0x5ea63c=users[_0x309338(0x1eb)];else{if(_0x5aab39[0x0][_0x309338(0x27a)]==_0x309338(0x211))var _0x5ea63c=users['French'];else{if(_0x5aab39[0x0][_0x309338(0x27a)]==_0x309338(0x284))var _0x5ea63c=users[_0x309338(0x25a)];else{if(_0x5aab39[0x0][_0x309338(0x27a)]==_0x309338(0x2ae))var _0x5ea63c=users[_0x309338(0x2ae)];else{if(_0x5aab39[0x0][_0x309338(0x27a)]==_0x309338(0x2e3))var _0x5ea63c=users[_0x309338(0x2be)];}}}}}}}_0x21c408[_0x309338(0x208)](_0x309338(0x24e),{'success':_0x5a9dc4[_0x309338(0x22e)]('success'),'errors':_0x5a9dc4[_0x309338(0x22e)](_0x309338(0x217)),'role':_0x16e562,'profile':_0x4786a8,'customer':_0x501349,'warehouse':_0x19e1a0,'product':_0x747ec,'user':_0x5a9d2d,'master_shop':_0x5aab39,'unit':_0xf925dc,'language':_0x5ea63c});}catch(_0x15465d){console['log'](_0x15465d);}}),router[a0_0x30fd53(0x1ed)]('/view/:id',auth,async(_0x229e46,_0x3e5339)=>{var _0x767720=a0_0x30fd53;try{const _0x15e70b=_0x229e46[_0x767720(0x259)]['id'],_0x12cfad=await sales[_0x767720(0x24b)]({'_id':_0x229e46[_0x767720(0x259)]['id']}),_0xf8328f=await warehouse[_0x767720(0x24b)]({'name':_0x12cfad[_0x767720(0x2b2)],'room':_0x229e46[_0x767720(0x23d)]['room']}),{invoice:_0x5cdac0,date:_0x461c09,warehouse_name:_0x440520,product_name:_0x51b302,stock:_0x166c8c,quantity:_0x30cd63,note:_0x157f82,room:_0x145e4d,customer:_0x2d6b77,SCRN:_0x4933c1}=_0x229e46[_0x767720(0x23d)];if(typeof _0x51b302==_0x767720(0x200))var _0x51dbdb=[_0x229e46['body'][_0x767720(0x1ea)]],_0x31576e=[_0x229e46[_0x767720(0x23d)][_0x767720(0x28a)]],_0x5e472c=[_0x229e46[_0x767720(0x23d)][_0x767720(0x281)]],_0x2ae35c=[_0x229e46[_0x767720(0x23d)][_0x767720(0x1f6)]],_0x2ac48c=[_0x229e46[_0x767720(0x23d)][_0x767720(0x223)]],_0x411f97=[_0x229e46[_0x767720(0x23d)][_0x767720(0x1e7)]],_0x423a44=[_0x229e46[_0x767720(0x23d)]['level']],_0x3b2fad=[_0x229e46[_0x767720(0x23d)][_0x767720(0x2ab)]],_0x458ce9=[_0x229e46[_0x767720(0x23d)]['secondary_unit']],_0xbd06bf=[_0x229e46[_0x767720(0x23d)][_0x767720(0x270)]],_0x2105cc=[_0x229e46[_0x767720(0x23d)]['expiry_date']],_0x504455=[_0x229e46['body'][_0x767720(0x236)]],_0x52e9f2=[_0x229e46[_0x767720(0x23d)]['production_date']],_0x52db0c=[_0x229e46[_0x767720(0x23d)][_0x767720(0x2d8)]],_0x5838cc=[_0x229e46[_0x767720(0x23d)][_0x767720(0x227)]],_0x154d12=[_0x229e46[_0x767720(0x23d)][_0x767720(0x249)]],_0x4156fe=[_0x229e46['body'][_0x767720(0x21e)]],_0x302ec4=[_0x229e46[_0x767720(0x23d)][_0x767720(0x222)]],_0x12a07f=[_0x229e46[_0x767720(0x23d)][_0x767720(0x202)]];else var _0x51dbdb=[..._0x229e46['body'][_0x767720(0x1ea)]],_0x31576e=[..._0x229e46['body'][_0x767720(0x28a)]],_0x5e472c=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x281)]],_0x2ae35c=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x1f6)]],_0x2ac48c=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x223)]],_0x411f97=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x1e7)]],_0x423a44=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x2b6)]],_0x3b2fad=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x2ab)]],_0x458ce9=[..._0x229e46[_0x767720(0x23d)]['secondary_unit']],_0xbd06bf=[..._0x229e46['body'][_0x767720(0x270)]],_0x2105cc=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x2ec)]],_0x504455=[..._0x229e46['body'][_0x767720(0x236)]],_0x52e9f2=[..._0x229e46['body'][_0x767720(0x2b3)]],_0x52db0c=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x2d8)]],_0x5838cc=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x227)]],_0x154d12=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x249)]],_0x4156fe=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x21e)]],_0x302ec4=[..._0x229e46[_0x767720(0x23d)]['quantity']],_0x12a07f=[..._0x229e46[_0x767720(0x23d)][_0x767720(0x202)]];const _0x7b8fce=_0x51dbdb[_0x767720(0x235)](_0x2b2897=>{return _0x2b2897={'product_name':_0x2b2897};});_0x31576e[_0x767720(0x2d4)]((_0x5da709,_0x3668f5)=>{var _0x22f35f=_0x767720;_0x7b8fce[_0x3668f5][_0x22f35f(0x28a)]=Math[_0x22f35f(0x2eb)](_0x5da709);}),_0x5e472c['forEach']((_0x569022,_0x137353)=>{var _0x4cb2b0=_0x767720;_0x7b8fce[_0x137353][_0x4cb2b0(0x222)]=_0x569022;}),_0x2ae35c['forEach']((_0x95a950,_0x7480d5)=>{_0x7b8fce[_0x7480d5]['primary_code']=_0x95a950;}),_0x2ac48c[_0x767720(0x2d4)]((_0xb2ef71,_0xc4051d)=>{var _0x1bfd20=_0x767720;_0x7b8fce[_0xc4051d][_0x1bfd20(0x223)]=_0xb2ef71;}),_0x411f97[_0x767720(0x2d4)]((_0x4eae67,_0x2b0bc5)=>{_0x7b8fce[_0x2b0bc5]['product_code']=_0x4eae67;}),_0x423a44[_0x767720(0x2d4)]((_0x4f822b,_0x482c79)=>{_0x12a07f['forEach']((_0x2af1f1,_0x35ac7e)=>{var _0x261473=a0_0x3010;if(_0x2af1f1==_0x261473(0x27e)&&_0x482c79==_0x35ac7e){var _0x58bbe0=_0x4f822b[_0x261473(0x2c4)](0x3);_0x7b8fce[_0x482c79][_0x261473(0x2ba)]=_0x4f822b[0x0],_0x7b8fce[_0x482c79]['rack']=_0x4f822b[0x1],_0x7b8fce[_0x482c79][_0x261473(0x218)]=0x0,_0x7b8fce[_0x482c79][_0x261473(0x204)]=0x0,_0x7b8fce[_0x482c79][_0x261473(0x27f)]=_0x261473(0x22a),_0x7b8fce[_0x482c79][_0x261473(0x212)]=_0x58bbe0;}else{if(_0x2af1f1==_0x261473(0x288)&&_0x482c79==_0x35ac7e){var _0x58bbe0=_0x4f822b[_0x261473(0x2c4)](0x3);_0x7b8fce[_0x482c79][_0x261473(0x2ba)]=_0x4f822b[0x0],_0x7b8fce[_0x482c79][_0x261473(0x1f8)]=_0x4f822b[0x1],_0x7b8fce[_0x482c79]['bay']=0x0,_0x7b8fce[_0x482c79][_0x261473(0x204)]=0x0,_0x7b8fce[_0x482c79][_0x261473(0x27f)]=_0x261473(0x22a),_0x7b8fce[_0x482c79][_0x261473(0x212)]=_0x4f822b[0x5];}else{if(_0x482c79==_0x35ac7e){var _0x844ebc;if(_0x4f822b[0x4]=='L')_0x844ebc='Level';else _0x4f822b[0x4]=='F'&&(_0x844ebc=_0x261473(0x22a));_0x7b8fce[_0x482c79][_0x261473(0x2ba)]=_0x4f822b[0x0],_0x7b8fce[_0x482c79][_0x261473(0x1f8)]=_0x4f822b[0x1],_0x7b8fce[_0x482c79][_0x261473(0x218)]=_0x4f822b[0x2],_0x7b8fce[_0x482c79]['bin']=_0x4f822b[0x3],_0x7b8fce[_0x482c79][_0x261473(0x27f)]=_0x844ebc,_0x7b8fce[_0x482c79][_0x261473(0x212)]=_0x4f822b[0x5];}}}});}),_0x3b2fad[_0x767720(0x2d4)]((_0x75b795,_0x206ff2)=>{var _0x423dae=_0x767720;_0x7b8fce[_0x206ff2][_0x423dae(0x2df)]=_0x75b795;}),_0x458ce9[_0x767720(0x2d4)]((_0x21e8c6,_0x348794)=>{_0x7b8fce[_0x348794]['secondary_unit']=_0x21e8c6;}),_0xbd06bf[_0x767720(0x2d4)]((_0x394707,_0x25155d)=>{var _0x56cb23=_0x767720;_0x7b8fce[_0x25155d][_0x56cb23(0x270)]=_0x394707;}),_0x2105cc['forEach']((_0x17ca88,_0x497bbe)=>{var _0x489bac=_0x767720;_0x7b8fce[_0x497bbe][_0x489bac(0x2ec)]=_0x17ca88;}),_0x504455[_0x767720(0x2d4)]((_0x1ac033,_0x1fe5a0)=>{_0x7b8fce[_0x1fe5a0]['maxperunit']=_0x1ac033;}),_0x52e9f2[_0x767720(0x2d4)]((_0x1e69ab,_0x2d1575)=>{_0x7b8fce[_0x2d1575]['production_date']=_0x1e69ab;}),_0x52db0c['forEach']((_0x11a033,_0x39695f)=>{var _0x4d66cd=_0x767720;_0x7b8fce[_0x39695f][_0x4d66cd(0x2d8)]=Math['abs'](_0x11a033);}),_0x5838cc[_0x767720(0x2d4)]((_0xa55efa,_0x1b850a)=>{var _0x4075f8=_0x767720;_0x7b8fce[_0x1b850a][_0x4075f8(0x227)]=_0xa55efa;}),_0x154d12[_0x767720(0x2d4)]((_0x2c73bf,_0x11f119)=>{var _0x14f0dc=_0x767720;_0x7b8fce[_0x11f119][_0x14f0dc(0x249)]=_0x2c73bf;}),_0x4156fe['forEach']((_0x5e59c1,_0x39f63b)=>{var _0x3ec8a8=_0x767720;_0x7b8fce[_0x39f63b][_0x3ec8a8(0x21e)]=_0x5e59c1;}),_0x302ec4[_0x767720(0x2d4)]((_0x59ccbe,_0x49eeea)=>{var _0x445254=_0x767720;_0x7b8fce[_0x49eeea][_0x445254(0x243)]=_0x59ccbe;}),_0x12a07f[_0x767720(0x2d4)]((_0x5a143c,_0x2cdcb6)=>{var _0x57e094=_0x767720;_0x7b8fce[_0x2cdcb6][_0x57e094(0x245)]=_0x5a143c;});var _0x2296ae=0x0;_0x7b8fce[_0x767720(0x2d4)](_0x5dfc4c=>{var _0x376442=_0x767720;console[_0x376442(0x27d)](_0x376442(0x1f7),_0x5dfc4c),(parseInt(_0x5dfc4c[_0x376442(0x28a)])<parseInt(_0x5dfc4c[_0x376442(0x222)])||parseInt(_0x5dfc4c['quantity'])==0x0)&&_0x2296ae++;});if(_0x2296ae!=0x0)return _0x229e46[_0x767720(0x22e)](_0x767720(0x217),_0x767720(0x1ff)),_0x3e5339[_0x767720(0x203)](_0x767720(0x1ec));const _0x85d5ef=_0x7b8fce['filter'](_0x1247e7=>_0x1247e7[_0x767720(0x222)]!=='0'&&_0x1247e7[_0x767720(0x222)]!=='');_0x12cfad['invoice']=_0x5cdac0,_0x12cfad[_0x767720(0x2c1)]=_0x2d6b77,_0x12cfad['date']=_0x461c09,_0x12cfad[_0x767720(0x2b2)]=_0x440520,_0x12cfad[_0x767720(0x20f)]=_0x85d5ef,_0x12cfad['note']=_0x157f82,_0x12cfad[_0x767720(0x279)]=_0x4933c1,_0x12cfad['finalize']=_0x767720(0x2bf),_0x12cfad[_0x767720(0x23c)]=_0x767720(0x2bf);const _0x11a129=await _0x12cfad[_0x767720(0x2b9)]();_0x229e46[_0x767720(0x22e)](_0x767720(0x280),_0x767720(0x1e8)),_0x3e5339[_0x767720(0x203)]('/all_sales/view');}catch(_0x7ab785){console['log'](_0x7ab785);}}),router[a0_0x30fd53(0x1ed)](a0_0x30fd53(0x2e6),auth,async(_0x579eb3,_0x129d83)=>{var _0xc2e811=a0_0x30fd53;try{const _0x3583ba=_0x579eb3[_0xc2e811(0x259)]['id'],{invoice:_0x5b7cde,customer:_0x1ca0ca,receivable_amount:_0x5d248f,received_amount:_0x3bb6a6}=_0x579eb3[_0xc2e811(0x23d)],_0x204296=await sales['findById'](_0x3583ba);console[_0xc2e811(0x27d)](_0x204296);var _0x416345=_0x5d248f-_0x3bb6a6;console['log'](_0x3bb6a6),_0x204296[_0xc2e811(0x2bc)]=parseFloat(_0x3bb6a6)+parseFloat(_0x204296['received_amount']),_0x204296[_0xc2e811(0x2c9)]=_0x416345,console['log'](_0x204296);const _0x1091af=await _0x204296['save'](),_0x169dce=await c_payment_data[_0xc2e811(0x24b)]({'invoice':_0x5b7cde});_0x169dce[_0xc2e811(0x295)]=_0x416345,await _0x169dce[_0xc2e811(0x2b9)]();let _0x1a33cc=new Date(),_0xe70ac3=('0'+_0x1a33cc[_0xc2e811(0x253)]())[_0xc2e811(0x2c4)](-0x2),_0x485253=('0'+(_0x1a33cc[_0xc2e811(0x244)]()+0x1))[_0xc2e811(0x2c4)](-0x2),_0x14786e=_0x1a33cc[_0xc2e811(0x29a)](),_0x57c77f=_0x14786e+'-'+_0x485253+'-'+_0xe70ac3;const _0x48adfd=new customer_payment({'invoice':_0x5b7cde,'date':_0x14786e+'-'+_0x485253+'-'+_0xe70ac3,'customer':_0x1ca0ca,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3bb6a6}),_0x4ec98e=await _0x48adfd[_0xc2e811(0x2b9)]();_0x579eb3[_0xc2e811(0x22e)](_0xc2e811(0x280),_0xc2e811(0x1f9)),_0x129d83['redirect'](_0xc2e811(0x230));}catch(_0x34bfe8){console['log'](_0x34bfe8);}}),router[a0_0x30fd53(0x261)](a0_0x30fd53(0x20c),auth,async(_0x2ef19c,_0x1bf2b3)=>{var _0x2fa7ff=a0_0x30fd53;try{const {username:_0x12780f,email:_0x3b7b43,role:_0x4aa542}=_0x2ef19c[_0x2fa7ff(0x26d)],_0x319222=_0x2ef19c[_0x2fa7ff(0x26d)],_0x5d05c4=await profile[_0x2fa7ff(0x24b)]({'email':_0x319222[_0x2fa7ff(0x1e9)]}),_0x5c4ddd=await master_shop[_0x2fa7ff(0x23f)]();console[_0x2fa7ff(0x27d)]('master',_0x5c4ddd);const _0x88141d=_0x2ef19c[_0x2fa7ff(0x259)]['id'],_0x3813e6=await sales[_0x2fa7ff(0x215)](_0x88141d);console[_0x2fa7ff(0x27d)](_0x3813e6);const _0x432c3d=await customer[_0x2fa7ff(0x24b)]({'name':_0x3813e6[_0x2fa7ff(0x2c1)]});console[_0x2fa7ff(0x27d)](_0x432c3d);if(_0x5c4ddd[0x0][_0x2fa7ff(0x27a)]=='English\x20(US)'){var _0x4f65f1=users[_0x2fa7ff(0x207)];console[_0x2fa7ff(0x27d)](_0x4f65f1);}else{if(_0x5c4ddd[0x0][_0x2fa7ff(0x27a)]==_0x2fa7ff(0x27b))var _0x4f65f1=users[_0x2fa7ff(0x27b)];else{if(_0x5c4ddd[0x0]['language']=='German')var _0x4f65f1=users[_0x2fa7ff(0x2a2)];else{if(_0x5c4ddd[0x0][_0x2fa7ff(0x27a)]==_0x2fa7ff(0x1eb))var _0x4f65f1=users[_0x2fa7ff(0x1eb)];else{if(_0x5c4ddd[0x0][_0x2fa7ff(0x27a)]==_0x2fa7ff(0x211))var _0x4f65f1=users[_0x2fa7ff(0x211)];else{if(_0x5c4ddd[0x0][_0x2fa7ff(0x27a)]=='Portuguese\x20(BR)')var _0x4f65f1=users[_0x2fa7ff(0x25a)];else{if(_0x5c4ddd[0x0][_0x2fa7ff(0x27a)]==_0x2fa7ff(0x2ae))var _0x4f65f1=users[_0x2fa7ff(0x2ae)];else{if(_0x5c4ddd[0x0]['language']==_0x2fa7ff(0x2e3))var _0x4f65f1=users[_0x2fa7ff(0x2be)];}}}}}}}_0x1bf2b3[_0x2fa7ff(0x208)](_0x2fa7ff(0x29d),{'success':_0x2ef19c[_0x2fa7ff(0x22e)](_0x2fa7ff(0x280)),'errors':_0x2ef19c[_0x2fa7ff(0x22e)](_0x2fa7ff(0x217)),'role':_0x319222,'profile':_0x5d05c4,'master_shop':_0x5c4ddd,'customers':_0x432c3d,'sales':_0x3813e6,'language':_0x4f65f1});}catch(_0x1921c8){console[_0x2fa7ff(0x27d)](_0x1921c8);}}),router['get'](a0_0x30fd53(0x2d5),auth,async(_0x47dbcc,_0x2bc6ba)=>{var _0x410d8f=a0_0x30fd53;try{const {username:_0x366c22,email:_0x16c773,role:_0x3f916b}=_0x47dbcc[_0x410d8f(0x26d)],_0x34ebea=_0x47dbcc['user'],_0x220789=await profile[_0x410d8f(0x24b)]({'email':_0x34ebea['email']}),_0x415273=await master_shop[_0x410d8f(0x23f)]();console[_0x410d8f(0x27d)](_0x410d8f(0x21d),_0x415273);const _0x906ae5=_0x47dbcc['params']['id'];console[_0x410d8f(0x27d)](_0x906ae5);const _0x223633=await sales[_0x410d8f(0x215)](_0x906ae5);console[_0x410d8f(0x27d)](_0x410d8f(0x269),_0x223633);const _0x618dc8=await warehouse[_0x410d8f(0x29b)]([{'$match':{'name':'Return\x20Goods','room':_0x410d8f(0x2a8)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x410d8f(0x28e),'name':{'$first':_0x410d8f(0x239)},'product_stock':{'$first':_0x410d8f(0x237)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x410d8f(0x267)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x410d8f(0x265)},'secondary_code':{'$first':_0x410d8f(0x2db)},'product_code':{'$first':_0x410d8f(0x276)}}}]);console[_0x410d8f(0x27d)](_0x410d8f(0x2b8),_0x618dc8);const _0x1ef1cb=await product[_0x410d8f(0x23f)]({});warehouse_data=await warehouse[_0x410d8f(0x29b)]([{'$match':{'status':'Enabled','name':_0x410d8f(0x2ac),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x410d8f(0x251),'name':{'$first':_0x410d8f(0x251)}}},{'$sort':{'name':0x1}}]);var _0x308a56=[_0x410d8f(0x2a8)];if(_0x415273[0x0][_0x410d8f(0x27a)]==_0x410d8f(0x28f)){var _0x2f2890=users[_0x410d8f(0x207)];console[_0x410d8f(0x27d)](_0x2f2890);}else{if(_0x415273[0x0][_0x410d8f(0x27a)]==_0x410d8f(0x27b))var _0x2f2890=users[_0x410d8f(0x27b)];else{if(_0x415273[0x0][_0x410d8f(0x27a)]=='German')var _0x2f2890=users[_0x410d8f(0x2a2)];else{if(_0x415273[0x0][_0x410d8f(0x27a)]==_0x410d8f(0x1eb))var _0x2f2890=users[_0x410d8f(0x1eb)];else{if(_0x415273[0x0]['language']=='French')var _0x2f2890=users[_0x410d8f(0x211)];else{if(_0x415273[0x0][_0x410d8f(0x27a)]=='Portuguese\x20(BR)')var _0x2f2890=users[_0x410d8f(0x25a)];else{if(_0x415273[0x0][_0x410d8f(0x27a)]==_0x410d8f(0x2ae))var _0x2f2890=users[_0x410d8f(0x2ae)];else{if(_0x415273[0x0]['language']==_0x410d8f(0x2e3))var _0x2f2890=users['Arabic'];}}}}}}}_0x2bc6ba[_0x410d8f(0x208)](_0x410d8f(0x2ce),{'success':_0x47dbcc[_0x410d8f(0x22e)](_0x410d8f(0x280)),'errors':_0x47dbcc[_0x410d8f(0x22e)](_0x410d8f(0x217)),'role':_0x34ebea,'profile':_0x220789,'user':_0x223633,'stock':_0x618dc8,'master_shop':_0x415273,'unit':_0x1ef1cb,'language':_0x2f2890,'warehouses':warehouse_data,'rooms':_0x308a56});}catch(_0x321ea1){console[_0x410d8f(0x27d)](_0x321ea1),_0x2bc6ba[_0x410d8f(0x2c5)](0xc8)[_0x410d8f(0x289)]({'message':_0x321ea1['message']});}}),router[a0_0x30fd53(0x1ed)](a0_0x30fd53(0x2d5),auth,async(_0x3eca0b,_0x5372dd)=>{var _0x2d5ec5=a0_0x30fd53;try{const {invoice:_0x33b8bf,date:_0x1c4b55,warehouse_name:_0x2637e2,product_name:_0x287f62,primary_code:_0x1ea284,secondary_code:_0xfa43ec,product_code:_0x28e530,sales_quantity:_0x30a636,stocks:_0x258375,return_qty:_0x5966ec,Room_name:_0x581bda,to_warehouse_name:_0x19afb2,to_Roomname:_0xbf05fc,to_Room_name:_0x3f4b59,note:_0x5af401,level:_0x3ca8cf,isle:_0x19b56e,pallet:_0x581ffb}=_0x3eca0b['body'];if(typeof _0x287f62==_0x2d5ec5(0x200))var _0x1a2e92=[_0x3eca0b['body'][_0x2d5ec5(0x1ea)]],_0x20ada7=[_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x1f6)]],_0x54cfa2=[_0x3eca0b[_0x2d5ec5(0x23d)]['secondary_code']],_0xadf2dc=[_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x1fc)]],_0x5f3896=[_0x3eca0b[_0x2d5ec5(0x23d)]['sales_quantity']],_0x373191=[_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x21c)]],_0x58881f=[_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x2f0)]],_0x55b4d6=[_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x218)]],_0x479c05=[_0x3eca0b[_0x2d5ec5(0x23d)]['bin']],_0x3d213d=[_0x3eca0b[_0x2d5ec5(0x23d)]['types']],_0x278ad9=[_0x3eca0b[_0x2d5ec5(0x23d)]['floorlevel']];else var _0x1a2e92=[..._0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x1ea)]],_0x20ada7=[..._0x3eca0b['body'][_0x2d5ec5(0x1f6)]],_0x54cfa2=[..._0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x223)]],_0xadf2dc=[..._0x3eca0b[_0x2d5ec5(0x23d)]['product_code']],_0x5f3896=[..._0x3eca0b['body'][_0x2d5ec5(0x247)]],_0x373191=[..._0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x21c)]],_0x58881f=[..._0x3eca0b[_0x2d5ec5(0x23d)]['return_qty']],_0x55b4d6=[..._0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x218)]],_0x479c05=[..._0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x204)]],_0x3d213d=[..._0x3eca0b['body'][_0x2d5ec5(0x266)]],_0x278ad9=[..._0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x212)]];const _0x32f0b0=_0x1a2e92[_0x2d5ec5(0x235)](_0xb45b67=>{return _0xb45b67={'product_name':_0xb45b67};});_0x20ada7['forEach']((_0x470587,_0x4b8b3b)=>{_0x32f0b0[_0x4b8b3b]['primary_code']=_0x470587;}),_0x54cfa2[_0x2d5ec5(0x2d4)]((_0x159dd7,_0x2374d5)=>{_0x32f0b0[_0x2374d5]['secondary_code']=_0x159dd7;}),_0xadf2dc['forEach']((_0x4692b9,_0x4288b7)=>{var _0x986f02=_0x2d5ec5;_0x32f0b0[_0x4288b7][_0x986f02(0x1fc)]=_0x4692b9;}),_0x5f3896[_0x2d5ec5(0x2d4)]((_0x32a6ba,_0x5dae6d)=>{var _0x2cf830=_0x2d5ec5;_0x32f0b0[_0x5dae6d][_0x2cf830(0x228)]=_0x32a6ba;}),_0x373191[_0x2d5ec5(0x2d4)]((_0x5df5e3,_0x23885a)=>{var _0x3447a6=_0x2d5ec5;_0x32f0b0[_0x23885a][_0x3447a6(0x28a)]=_0x5df5e3;}),_0x58881f[_0x2d5ec5(0x2d4)]((_0x6210d7,_0x9bee71)=>{var _0x43b2fe=_0x2d5ec5;_0x32f0b0[_0x9bee71][_0x43b2fe(0x2f0)]=_0x6210d7;}),_0x55b4d6[_0x2d5ec5(0x2d4)]((_0x3dbf0f,_0xd76337)=>{_0x32f0b0[_0xd76337]['bay']=_0x3dbf0f;}),_0x479c05[_0x2d5ec5(0x2d4)]((_0x3461ae,_0x24b840)=>{var _0xf8bd21=_0x2d5ec5;_0x32f0b0[_0x24b840][_0xf8bd21(0x204)]=_0x3461ae;}),_0x3d213d[_0x2d5ec5(0x2d4)]((_0x15e7fc,_0x5f1363)=>{var _0x1f3c42=_0x2d5ec5;_0x32f0b0[_0x5f1363][_0x1f3c42(0x27f)]=_0x15e7fc;}),_0x278ad9[_0x2d5ec5(0x2d4)]((_0xe33335,_0x3ce07d)=>{var _0x2dd3d8=_0x2d5ec5;_0x32f0b0[_0x3ce07d][_0x2dd3d8(0x212)]=_0xe33335;});var _0x1b0ec2=0x0;_0x32f0b0['forEach'](_0x1f5d1e=>{var _0x1eefb9=_0x2d5ec5;console['log']('foreach\x20newproduct',_0x1f5d1e),(parseInt(_0x1f5d1e[_0x1eefb9(0x228)])<parseInt(_0x1f5d1e['return_qty'])||parseInt(_0x1f5d1e[_0x1eefb9(0x28a)])<parseInt(_0x1f5d1e[_0x1eefb9(0x2f0)])&&parseInt(_0x1f5d1e[_0x1eefb9(0x228)])>parseInt(_0x1f5d1e[_0x1eefb9(0x2f0)])||parseInt(_0x1f5d1e[_0x1eefb9(0x2f0)])==0x0)&&_0x1b0ec2++;});if(_0x1b0ec2!=0x0)return _0x3eca0b[_0x2d5ec5(0x22e)](_0x2d5ec5(0x217),_0x2d5ec5(0x2d0)),_0x5372dd[_0x2d5ec5(0x203)](_0x2d5ec5(0x1ec));const _0x4a7ed8=await sales[_0x2d5ec5(0x24b)]({'invoice':_0x33b8bf});console[_0x2d5ec5(0x27d)](_0x4a7ed8),_0x4a7ed8[_0x2d5ec5(0x272)]='True';const _0x32656d=await _0x4a7ed8['save'](),_0x54bd78=new sales_return({'invoice':_0x33b8bf,'customer':_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x2c1)],'date':_0x1c4b55,'warehouse_name':_0x2637e2,'room':_0x581bda,'ToWarehouse':_0x19afb2,'ToRoom':_0x3f4b59,'return_sale':_0x32f0b0,'note':_0x5af401}),_0x5d611a=await _0x54bd78[_0x2d5ec5(0x2b9)]();console[_0x2d5ec5(0x27d)](_0x54bd78);const _0x4d49c7=await sales_return['findOne']({'invoice':_0x33b8bf}),_0x194ee6=await warehouse['findOne']({'name':_0x19afb2,'room':_0x3f4b59});_0x4d49c7[_0x2d5ec5(0x2ce)]['forEach'](_0x83615f=>{var _0x169ccb=_0x2d5ec5,_0x3fa0e8=0x0;const _0x495d0b=_0x194ee6[_0x169ccb(0x26f)][_0x169ccb(0x235)](_0x45bd98=>{var _0x5ec155=_0x169ccb;_0x45bd98[_0x5ec155(0x1ea)]==_0x83615f[_0x5ec155(0x1ea)]&&_0x45bd98[_0x5ec155(0x212)]==_0x83615f[_0x5ec155(0x212)]&&_0x45bd98['type']==_0x83615f[_0x5ec155(0x27f)]&&_0x45bd98[_0x5ec155(0x204)]==_0x83615f[_0x5ec155(0x204)]&&_0x45bd98['bay']==_0x83615f[_0x5ec155(0x218)]&&(_0x45bd98[_0x5ec155(0x296)]=parseInt(_0x45bd98[_0x5ec155(0x296)])+parseInt(_0x83615f[_0x5ec155(0x2f0)]),_0x3fa0e8++);});_0x3fa0e8=='0'&&(_0x194ee6[_0x169ccb(0x26f)]=_0x194ee6[_0x169ccb(0x26f)]['concat']({'product_name':_0x83615f[_0x169ccb(0x1ea)],'product_stock':_0x83615f[_0x169ccb(0x2f0)],'primary_code':_0x83615f[_0x169ccb(0x1f6)],'secondary_code':_0x83615f['secondary_code'],'product_code':_0x83615f[_0x169ccb(0x1fc)],'bay':_0x83615f[_0x169ccb(0x218)],'bin':_0x83615f[_0x169ccb(0x204)],'type':_0x83615f[_0x169ccb(0x27f)],'floorlevel':_0x83615f[_0x169ccb(0x212)]})),console[_0x169ccb(0x27d)](_0x169ccb(0x28c),_0x194ee6);}),await _0x194ee6[_0x2d5ec5(0x2b9)](),console['log'](_0x3eca0b['body']);const _0x225573=new c_payment_data({'invoice':_0x33b8bf,'customer':_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x2c1)],'reason':'Sale\x20Return'});await _0x225573[_0x2d5ec5(0x2b9)]();const _0x17c64f=await master_shop[_0x2d5ec5(0x23f)]();console[_0x2d5ec5(0x27d)](_0x2d5ec5(0x1f1),_0x17c64f[0x0]['image']);const _0x484492=await email_settings[_0x2d5ec5(0x24b)](),_0x2f8ee3=await customer[_0x2d5ec5(0x24b)]({'name':_0x3eca0b[_0x2d5ec5(0x23d)][_0x2d5ec5(0x2c1)]});console[_0x2d5ec5(0x27d)](_0x2d5ec5(0x1fb),_0x2f8ee3);_0x17c64f[0x0]['currency_placement']==0x1?(right_currency=_0x17c64f[0x0][_0x2d5ec5(0x2ad)],left_currency=''):(right_currency='',left_currency=_0x17c64f[0x0][_0x2d5ec5(0x2ad)]);var _0x500c77=_0x1a2e92,_0x390b35=_0x58881f,_0x5811a0='',_0x9d5126;for(_0x9d5126 in _0x500c77){_0x5811a0+='<tr>'+_0x2d5ec5(0x273)+_0x500c77[_0x9d5126]+_0x2d5ec5(0x2dd)+_0x2d5ec5(0x273)+_0x390b35[_0x9d5126]+_0x2d5ec5(0x2dd)+_0x2d5ec5(0x1f2);}console['log']('product_list',_0x5811a0);let _0x45bca4=nodemailer[_0x2d5ec5(0x297)]({'service':_0x2d5ec5(0x214),'auth':{'user':_0x484492[_0x2d5ec5(0x1e9)],'pass':_0x484492['password']}}),_0x5303c2={'from':_0x484492['email'],'to':_0x2f8ee3[_0x2d5ec5(0x1e9)],'subject':_0x2d5ec5(0x2ca),'attachments':[{'filename':_0x2d5ec5(0x2ed),'path':__dirname+_0x2d5ec5(0x264)+_0x2d5ec5(0x275)+_0x17c64f[0x0][_0x2d5ec5(0x282)],'cid':_0x2d5ec5(0x23e)}],'html':_0x2d5ec5(0x2e1)+_0x2d5ec5(0x226)+'</head><body>'+_0x2d5ec5(0x1e6)+_0x2d5ec5(0x210)+_0x2d5ec5(0x1e6)+_0x2d5ec5(0x1fa)+'</div>'+_0x2d5ec5(0x1e6)+_0x2d5ec5(0x24c)+_0x17c64f[0x0][_0x2d5ec5(0x1ef)]+'\x20</h2>'+_0x2d5ec5(0x293)+_0x2d5ec5(0x293)+_0x2d5ec5(0x2c8)+_0x2d5ec5(0x1e6)+_0x2d5ec5(0x290)+_0x2d5ec5(0x268)+_0x33b8bf+'\x20'+_0x2d5ec5(0x2ee)+_0x2d5ec5(0x2dc)+_0x1c4b55+'\x20'+'</span>'+_0x2d5ec5(0x201)+_0x2d5ec5(0x293)+_0x2d5ec5(0x2a9)+_0x2d5ec5(0x29c)+_0x2d5ec5(0x256)+_0x2d5ec5(0x287)+_0x2d5ec5(0x278)+_0x2d5ec5(0x283)+_0x2d5ec5(0x299)+'</tr>'+'</thead>'+_0x2d5ec5(0x216)+'\x20'+_0x5811a0+'\x20'+_0x2d5ec5(0x1f5)+_0x2d5ec5(0x2a1)+_0x2d5ec5(0x1e6)+_0x2d5ec5(0x250)+_0x2d5ec5(0x2d2)+_0x17c64f[0x0][_0x2d5ec5(0x1ef)]+'</h5>'+_0x2d5ec5(0x293)+_0x2d5ec5(0x293)+_0x2d5ec5(0x2d3)};_0x45bca4[_0x2d5ec5(0x213)](_0x5303c2,function(_0x2ea2ef,_0x4aac45){var _0x5453a0=_0x2d5ec5;_0x2ea2ef?(console['log'](_0x2ea2ef),console[_0x5453a0(0x27d)]('Error\x20Occurs')):console['log'](_0x5453a0(0x21f));}),_0x3eca0b[_0x2d5ec5(0x22e)](_0x2d5ec5(0x280),_0x2d5ec5(0x1fe)),_0x5372dd['redirect'](_0x2d5ec5(0x230));}catch(_0x32cbdd){console[_0x2d5ec5(0x27d)](_0x32cbdd),_0x5372dd[_0x2d5ec5(0x2c5)](0xc8)[_0x2d5ec5(0x289)]({'message1':_0x32cbdd['message']});}}),router[a0_0x30fd53(0x261)]('/barcode/:id',auth,async(_0x4fd27e,_0x1a8c41)=>{var _0x437c8a=a0_0x30fd53;try{const {username:_0x5af5ce,email:_0x13fcce,role:_0x437d63}=_0x4fd27e[_0x437c8a(0x26d)],_0x39a0a1=_0x4fd27e[_0x437c8a(0x26d)],_0x297b2b=await profile['findOne']({'email':_0x39a0a1[_0x437c8a(0x1e9)]}),_0x29b7e7=await master_shop[_0x437c8a(0x23f)]();console['log'](_0x437c8a(0x2c6),_0x29b7e7);const _0x397adf=_0x4fd27e[_0x437c8a(0x259)]['id'],_0xe3d28a=await sales[_0x437c8a(0x215)](_0x397adf);console[_0x437c8a(0x27d)](_0x437c8a(0x29f),_0xe3d28a);if(_0x29b7e7[0x0]['language']=='English\x20(US)')var _0x38e4e5=users[_0x437c8a(0x207)];else{if(_0x29b7e7[0x0][_0x437c8a(0x27a)]=='Hindi')var _0x38e4e5=users[_0x437c8a(0x27b)];else{if(_0x29b7e7[0x0][_0x437c8a(0x27a)]==_0x437c8a(0x2a2))var _0x38e4e5=users[_0x437c8a(0x2a2)];else{if(_0x29b7e7[0x0][_0x437c8a(0x27a)]==_0x437c8a(0x1eb))var _0x38e4e5=users[_0x437c8a(0x1eb)];else{if(_0x29b7e7[0x0]['language']=='French')var _0x38e4e5=users['French'];else{if(_0x29b7e7[0x0]['language']==_0x437c8a(0x284))var _0x38e4e5=users['Portuguese'];else{if(_0x29b7e7[0x0][_0x437c8a(0x27a)]==_0x437c8a(0x2ae))var _0x38e4e5=users[_0x437c8a(0x2ae)];else{if(_0x29b7e7[0x0][_0x437c8a(0x27a)]==_0x437c8a(0x2e3))var _0x38e4e5=users[_0x437c8a(0x2be)];}}}}}}}_0x1a8c41[_0x437c8a(0x208)](_0x437c8a(0x20a),{'success':_0x4fd27e['flash'](_0x437c8a(0x280)),'errors':_0x4fd27e[_0x437c8a(0x22e)](_0x437c8a(0x217)),'role':_0x39a0a1,'profile':_0x297b2b,'alldata':_0xe3d28a,'master_shop':_0x29b7e7,'language':_0x38e4e5});}catch(_0x517e39){console['log'](_0x517e39);}}),router[a0_0x30fd53(0x1ed)](a0_0x30fd53(0x234),async(_0x54c6a6,_0x115526)=>{var _0x1e7c2d=a0_0x30fd53;const {product_code:_0x20bc4c,warehouse_name:_0x59fe7a,rooms_data:_0xee715d,Roomslist:_0x4858cf}=_0x54c6a6[_0x1e7c2d(0x23d)],_0x412a02=_0x4858cf['split'](','),_0x41d89c=[];async function _0x48d992(_0x12c5be){var _0x49ff11=_0x1e7c2d;const _0x3834e6=await warehouse[_0x49ff11(0x29b)]([{'$match':{'name':_0x59fe7a,'room':_0x12c5be}},{'$unwind':_0x49ff11(0x257)},{'$match':{'product_details.primary_code':_0x20bc4c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x49ff11(0x239)},'product_stock':{'$first':_0x49ff11(0x237)},'primary_code':{'$first':_0x49ff11(0x265)},'secondary_code':{'$first':_0x49ff11(0x2db)},'product_code':{'$first':_0x49ff11(0x276)},'level':{'$first':_0x49ff11(0x260)},'isle':{'$first':_0x49ff11(0x238)},'type':{'$first':_0x49ff11(0x298)},'pallet':{'$first':_0x49ff11(0x252)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x49ff11(0x28d)},'rack':{'$first':_0x49ff11(0x2e5)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x49ff11(0x2e4)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x49ff11(0x22d)},'product_cat':{'$first':_0x49ff11(0x2a7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x49ff11(0x254)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x49ff11(0x219)},'actual_uom':{'$first':_0x49ff11(0x2b0)}}}]),_0x5e2e53=await warehouse[_0x49ff11(0x29b)]([{'$match':{'name':_0x59fe7a,'room':_0x12c5be}},{'$unwind':_0x49ff11(0x257)},{'$match':{'product_details.secondary_code':_0x20bc4c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x49ff11(0x239)},'product_stock':{'$first':_0x49ff11(0x237)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x49ff11(0x2db)},'product_code':{'$first':_0x49ff11(0x276)},'level':{'$first':_0x49ff11(0x260)},'isle':{'$first':_0x49ff11(0x238)},'type':{'$first':_0x49ff11(0x298)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x49ff11(0x209)},'storage':{'$first':_0x49ff11(0x28d)},'rack':{'$first':_0x49ff11(0x2e5)},'expiry_date':{'$first':_0x49ff11(0x25b)},'production_date':{'$first':_0x49ff11(0x2e4)},'maxPerUnit':{'$first':_0x49ff11(0x248)},'batch_code':{'$first':_0x49ff11(0x22d)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x49ff11(0x1f4)}}}]);if(_0x3834e6['length']>0x0)_0x41d89c['push'](_0x3834e6);else _0x5e2e53[_0x49ff11(0x1e5)]>0x0&&_0x41d89c[_0x49ff11(0x271)](_0x5e2e53);}const _0x30dd52=_0x412a02[_0x1e7c2d(0x235)](_0x55df44=>_0x48d992(_0x55df44));await Promise['all'](_0x30dd52),_0x115526['json'](_0x41d89c);}),module[a0_0x30fd53(0x20d)]=router;