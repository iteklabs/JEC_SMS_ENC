var a0_0x4aaa0d=a0_0x5b5c;(function(_0x21939a,_0x27d27a){var _0xeeaa5f=a0_0x5b5c,_0x452126=_0x21939a();while(!![]){try{var _0x4bd1c4=parseInt(_0xeeaa5f(0x237))/0x1+parseInt(_0xeeaa5f(0x1d4))/0x2+parseInt(_0xeeaa5f(0x210))/0x3*(parseInt(_0xeeaa5f(0x1fe))/0x4)+parseInt(_0xeeaa5f(0x1cb))/0x5*(parseInt(_0xeeaa5f(0x22c))/0x6)+parseInt(_0xeeaa5f(0x220))/0x7*(-parseInt(_0xeeaa5f(0x215))/0x8)+-parseInt(_0xeeaa5f(0x173))/0x9*(parseInt(_0xeeaa5f(0x192))/0xa)+-parseInt(_0xeeaa5f(0x20f))/0xb;if(_0x4bd1c4===_0x27d27a)break;else _0x452126['push'](_0x452126['shift']());}catch(_0x4d0aa9){_0x452126['push'](_0x452126['shift']());}}}(a0_0x7b35,0x51bf9));const express=require(a0_0x4aaa0d(0x18f)),app=express(),router=express[a0_0x4aaa0d(0x1e0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4aaa0d(0x24d)),auth=require(a0_0x4aaa0d(0x197)),nodemailer=require(a0_0x4aaa0d(0x18a)),users=require(a0_0x4aaa0d(0x1e1));function a0_0x7b35(){var _0x5c5c0c=['barcode\x20Product\x20master','site_title','type','$product_details.primary_code','json','role','return_sale','\x20Order\x20Number\x20:\x20','received_amount','finalize','$sale_product.type','secondary_unit','Error\x20Occurs','findById','currency_placement','_id','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','delivery_code','$sale_product.bin','user','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','purchases_data','max','SCRN','$customers_docs','/all_sales/view','Spanish','body','storage','id_transaction_from','barcode\x20user_id','batch_code','requested_qty','invoice','OUT-','</div>','add\x20post','/view/return_sales/:id','$sale_product.bay','35dPortM','warehouse','$note','/barcode/:id','Portuguese\x20(BR)','$product_details.level','Sale\x20Return','slice','actual_uom','308114gJMJmB','actual_qty','Sales\x20Mail','$isAllowEdit','$product_details.actual_qty','save','floorlevel','Sale\x20Return\x20Mail','then','$sale_product.quantity','</span>','log','Router','../public/language/languages.json','delivery_date','<h2>\x20','max_per_unit','/view/add_sale/product','unit','name','Receiving\x20Area','$return_data','language','success','back','payment\x20successfull','post','</h5>','$product_details.product_code','return_qty','customer','/view/add_sales/:id','<!DOCTYPE\x20html>','</body></html>','findOne','sales_invoice','/give_payment/:id','Floor','floor','/../public','$product.product_name','/barcode_scanner','4rDHoXt','bay','There\x27s\x20a\x20error\x20in\x20this\x20transaction','catch','sales_quantity','Return\x20Goods','room_name','customers_docs','$finalize','padStart','$_id','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_data','/invoice/:id','$warehouse_name','<hr\x20class=\x22my-3\x22>','3085093duOOSp','784167zMTNgK','<span\x20style=\x22float:\x20right;\x22>','$date','master','$product_details.maxPerUnit','7920fkzyWA','amount','quantity','English','warehouse_name','sales\x20item\x20return\x20successfull','primary_unit','abs','Raw\x20Materials','<h5>','flash','882bagKzg','getDate','maxperunit','map','forEach','logo','sale_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','customer_data','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Level','$product_details.floorlevel','301656zLPtNI','/upload/','email','currency','$sale_product.floorlevel','exports','<table\x20style=\x22width:\x20100%\x20!important;\x22>','push','customers','staff','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','340707GVgyXp','Email\x20sent\x20successfully','image','$name','$customer','split','get','Hindi','/preview/:id','$product_details.product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','redirect','product_name','<tbody\x20style=\x22text-align:\x20center;\x22>','sendMail','$product_details.pallet','Sales\x20Update\x20successfully','edit_sales_view','find','True','/view/add_sales','RMSEmail','../models/all_models','English\x20(US)','Arabic\x20(ae)','\x20</h2>','$product_details.secondary_code','random','$sale_product','$room','getFullYear','filter','production_date','</td>','False','note','quantity_notConverted','primary_code','prod_cat','\x20Order\x20Date\x20:\x20','$product_details.bay','prod_invoice','stocks','Return\x20Rooms','error','all_sales_barcode','/view','stock','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','toString','all','$product_details.batch_code','RoomAssigned','secondary_code','level','string','Logo.png','password','/all_sales/preview/','getMonth','Enclosed','user_id','German','$product_details','$product_details.secondary_unit','add_sales','stock_data','product','$product_details.type','Portuguese','<html><head><title></title>','French','</tbody>','bin','params','$product_details.actual_uom','product_details','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.production_date','Ambient','date','$product_details.product_stock','9vhsqUB','aggregate','product_code','render','$product_details.expiry_date','</table>','status','<h5\x20style=\x22text-align:\x20left;\x22>','foreach\x20newproduct','<tr>','Chinese','carton','$product_details.storage','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$invoice','gmail','sales\x20all_data','Enabled','sale_product','<div>','due_amount','$product','nodemailer','prod_code','$product_details.invoice','expiry_date','/view/:id','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','createTransport','3680410xgSotV','An\x20error\x20occurred.','length','types','product_stock','../middleware/auth','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','rack','$product_details.product_name','</head><body>','errors','$product_details._id','</thead>','</tr>','id_transact','message'];a0_0x7b35=function(){return _0x5c5c0c;};return a0_0x7b35();}function a0_0x5b5c(_0x42c7ad,_0x279173){var _0x7b35cb=a0_0x7b35();return a0_0x5b5c=function(_0x5b5c0e,_0x45e7c6){_0x5b5c0e=_0x5b5c0e-0x136;var _0x5418c8=_0x7b35cb[_0x5b5c0e];return _0x5418c8;},a0_0x5b5c(_0x42c7ad,_0x279173);}router[a0_0x4aaa0d(0x23d)](a0_0x4aaa0d(0x14d),auth,async(_0x2d0612,_0x40c4f3)=>{var _0x5f15d9=a0_0x4aaa0d;try{const {username:_0x482286,email:_0x4395ee,role:_0x3c620b}=_0x2d0612[_0x5f15d9(0x1b7)],_0x8b0ca6=_0x2d0612[_0x5f15d9(0x1b7)],_0x32cca2=await profile[_0x5f15d9(0x1f6)]({'email':_0x8b0ca6[_0x5f15d9(0x22e)]}),_0x1c5c22=await master_shop[_0x5f15d9(0x249)]();let _0x356a8b;if(_0x8b0ca6['role']==_0x5f15d9(0x235)){const _0x440538=await staff[_0x5f15d9(0x1f6)]({'email':_0x8b0ca6[_0x5f15d9(0x22e)]});_0x356a8b=await sales[_0x5f15d9(0x174)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x5f15d9(0x1e7),'as':_0x5f15d9(0x205)}},{'$unwind':_0x5f15d9(0x1bc)},{'$unwind':_0x5f15d9(0x13b)},{'$group':{'_id':_0x5f15d9(0x208),'invoice':{'$first':_0x5f15d9(0x182)},'customers':{'$first':_0x5f15d9(0x23b)},'date':{'$first':_0x5f15d9(0x212)},'warehouse_name':{'$first':_0x5f15d9(0x20d)},'sale_product':{'$push':_0x5f15d9(0x13b)},'note':{'$first':_0x5f15d9(0x1cd)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5f15d9(0x1bc)},'total_saleproduct_quantity':{'$sum':_0x5f15d9(0x1dd)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x5f15d9(0x1b6)},'type':{'$addToSet':_0x5f15d9(0x1ac)},'pallet':{'$addToSet':_0x5f15d9(0x230)},'finalize':{'$first':_0x5f15d9(0x206)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x356a8b=await sales[_0x5f15d9(0x174)]([{'$lookup':{'from':_0x5f15d9(0x234),'localField':_0x5f15d9(0x1f2),'foreignField':_0x5f15d9(0x1e7),'as':_0x5f15d9(0x205)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5f15d9(0x13b)},{'$group':{'_id':_0x5f15d9(0x208),'invoice':{'$first':_0x5f15d9(0x182)},'customers':{'$first':_0x5f15d9(0x23b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5f15d9(0x20d)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5f15d9(0x1cd)},'return_data':{'$first':_0x5f15d9(0x1e9)},'customers_docs':{'$first':_0x5f15d9(0x1bc)},'total_saleproduct_quantity':{'$sum':_0x5f15d9(0x1dd)},'level':{'$addToSet':_0x5f15d9(0x1ca)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5f15d9(0x1ac)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5f15d9(0x206)},'isAllowEdit':{'$first':_0x5f15d9(0x1d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5f15d9(0x1df)](_0x5f15d9(0x184),_0x356a8b);if(_0x1c5c22[0x0]['language']==_0x5f15d9(0x136)){var _0x1e7cd4=users[_0x5f15d9(0x218)];console['log'](_0x1e7cd4);}else{if(_0x1c5c22[0x0]['language']==_0x5f15d9(0x23e))var _0x1e7cd4=users[_0x5f15d9(0x23e)];else{if(_0x1c5c22[0x0][_0x5f15d9(0x1ea)]==_0x5f15d9(0x15f))var _0x1e7cd4=users[_0x5f15d9(0x15f)];else{if(_0x1c5c22[0x0][_0x5f15d9(0x1ea)]==_0x5f15d9(0x1be))var _0x1e7cd4=users['Spanish'];else{if(_0x1c5c22[0x0]['language']=='French')var _0x1e7cd4=users[_0x5f15d9(0x168)];else{if(_0x1c5c22[0x0][_0x5f15d9(0x1ea)]==_0x5f15d9(0x1cf))var _0x1e7cd4=users[_0x5f15d9(0x166)];else{if(_0x1c5c22[0x0][_0x5f15d9(0x1ea)]=='Chinese')var _0x1e7cd4=users[_0x5f15d9(0x17d)];else{if(_0x1c5c22[0x0]['language']==_0x5f15d9(0x137))var _0x1e7cd4=users[_0x5f15d9(0x1b2)];}}}}}}}_0x40c4f3[_0x5f15d9(0x176)]('all_sales',{'success':_0x2d0612[_0x5f15d9(0x21f)](_0x5f15d9(0x1eb)),'errors':_0x2d0612[_0x5f15d9(0x21f)]('errors'),'sales':_0x356a8b,'profile':_0x32cca2,'role':_0x8b0ca6,'master_shop':_0x1c5c22,'language':_0x1e7cd4});}catch(_0x2b18af){console['log'](_0x2b18af);}});async function getRandom8DigitNumber(){var _0x2b51ba=a0_0x4aaa0d;const _0x5c5977=0x989680,_0x4197b2=0x5f5e0ff,_0x270c15=Math[_0x2b51ba(0x1fa)](Math[_0x2b51ba(0x13a)]()*(_0x4197b2-_0x5c5977+0x1))+_0x5c5977;var _0x591505;const _0x1b1a02=await sales[_0x2b51ba(0x1f6)]({'invoice':_0x2b51ba(0x1c6)+_0x270c15});return _0x1b1a02&&_0x1b1a02['length']>0x0?_0x591505=_0x2b51ba(0x1c6)+_0x270c15:_0x591505=_0x2b51ba(0x1c6)+_0x270c15,_0x591505;}router[a0_0x4aaa0d(0x23d)](a0_0x4aaa0d(0x24b),auth,async(_0x11e582,_0x23b489)=>{var _0x52eb41=a0_0x4aaa0d;try{const {username:_0x4a1acb,email:_0x2a938a,role:_0x5b5d32}=_0x11e582[_0x52eb41(0x1b7)],_0x195441=_0x11e582[_0x52eb41(0x1b7)],_0x30607d=await profile['findOne']({'email':_0x195441[_0x52eb41(0x22e)]}),_0x293b7b=await master_shop[_0x52eb41(0x249)](),_0xeccc92=await customer[_0x52eb41(0x249)]({});let _0x281c8f;if(_0x195441[_0x52eb41(0x1a7)]==_0x52eb41(0x235)){const _0xb00341=await staff[_0x52eb41(0x1f6)]({'email':_0x195441['email']});_0x281c8f=await warehouse[_0x52eb41(0x174)]([{'$match':{'status':_0x52eb41(0x185),'name':_0xb00341['warehouse'],'warehouse_category':_0x52eb41(0x21d),'name':{'$ne':_0x52eb41(0x203)}}},{'$group':{'_id':_0x52eb41(0x23a),'name':{'$first':_0x52eb41(0x23a)}}},{'$sort':{'name':0x1}}]);}else _0x281c8f=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x52eb41(0x21d),'name':{'$ne':_0x52eb41(0x203)}}},{'$group':{'_id':_0x52eb41(0x23a),'name':{'$first':_0x52eb41(0x23a)}}},{'$sort':{'name':0x1}}]);const _0x2feaa2=await product[_0x52eb41(0x249)]({});var _0x1b6ecf=[_0x52eb41(0x170),_0x52eb41(0x15d)];const _0x3a9809=await sales[_0x52eb41(0x249)]({}),_0x3d60ca=_0x3a9809[_0x52eb41(0x194)]+0x1,_0x265d79=_0x52eb41(0x1c6)+_0x3d60ca[_0x52eb41(0x152)]()[_0x52eb41(0x207)](0x5,'0');if(_0x293b7b[0x0]['language']==_0x52eb41(0x136)){var _0x15baf3=users[_0x52eb41(0x218)];console[_0x52eb41(0x1df)](_0x15baf3);}else{if(_0x293b7b[0x0][_0x52eb41(0x1ea)]==_0x52eb41(0x23e))var _0x15baf3=users[_0x52eb41(0x23e)];else{if(_0x293b7b[0x0][_0x52eb41(0x1ea)]=='German')var _0x15baf3=users[_0x52eb41(0x15f)];else{if(_0x293b7b[0x0][_0x52eb41(0x1ea)]==_0x52eb41(0x1be))var _0x15baf3=users[_0x52eb41(0x1be)];else{if(_0x293b7b[0x0][_0x52eb41(0x1ea)]==_0x52eb41(0x168))var _0x15baf3=users[_0x52eb41(0x168)];else{if(_0x293b7b[0x0]['language']==_0x52eb41(0x1cf))var _0x15baf3=users['Portuguese'];else{if(_0x293b7b[0x0][_0x52eb41(0x1ea)]==_0x52eb41(0x17d))var _0x15baf3=users[_0x52eb41(0x17d)];else{if(_0x293b7b[0x0][_0x52eb41(0x1ea)]=='Arabic\x20(ae)')var _0x15baf3=users['Arabic'];}}}}}}}const _0x41ebe0=getRandom8DigitNumber();_0x41ebe0['then'](_0xa07466=>{var _0x13a204=_0x52eb41;_0x23b489['render'](_0x13a204(0x162),{'success':_0x11e582[_0x13a204(0x21f)]('success'),'errors':_0x11e582[_0x13a204(0x21f)](_0x13a204(0x19c)),'role':_0x195441,'profile':_0x30607d,'customer':_0xeccc92,'warehouse':_0x281c8f,'product':_0x2feaa2,'invoice':_0xa07466,'master_shop':_0x293b7b,'language':_0x15baf3,'rooms_data':_0x1b6ecf});})['catch'](_0x978605=>{var _0x22e66d=_0x52eb41;_0x11e582['flash'](_0x22e66d(0x19c),_0x22e66d(0x200)),_0x23b489[_0x22e66d(0x242)](_0x22e66d(0x1bd));});}catch(_0x20df1f){console[_0x52eb41(0x1df)](_0x20df1f);}}),router['get'](a0_0x4aaa0d(0x1f3),auth,async(_0x445ce9,_0x2e599b)=>{var _0xcad27d=a0_0x4aaa0d;try{const _0x4485f2=_0x445ce9[_0xcad27d(0x16b)]['id'];console[_0xcad27d(0x1df)](_0x4485f2);const _0x5433dc=await product['find'](),_0x118306=await purchases[_0xcad27d(0x174)]([{'$match':{'warehouse_name':_0x4485f2}},{'$unwind':_0xcad27d(0x189)},{'$group':{'_id':_0xcad27d(0x1fc)}}]);console[_0xcad27d(0x1df)](_0xcad27d(0x1b9),_0x118306),_0x2e599b[_0xcad27d(0x179)](0xc8)['json']({'purchases_data':_0x118306,'product_data':_0x5433dc});}catch(_0xf407e2){console[_0xcad27d(0x1df)](_0xf407e2);}}),router['post'](a0_0x4aaa0d(0x1e5),auth,async(_0x1539d6,_0x4620f2)=>{var _0x55f206=a0_0x4aaa0d;try{const {warehouse_data:_0x517e1b,product_data:_0x8da4f8}=_0x1539d6[_0x55f206(0x1bf)];console[_0x55f206(0x1df)](_0x1539d6['body'][_0x55f206(0x20b)]);;const _0x2ea2dc=await master_shop['find']();console[_0x55f206(0x1df)](_0x55f206(0x213),_0x2ea2dc);const _0x29ae16=await product['findOne']({'name':_0x8da4f8});console[_0x55f206(0x1df)](_0x55f206(0x164),_0x29ae16);const _0x475807=await warehouse[_0x55f206(0x174)]([{'$match':{'name':_0x517e1b}},{'$unwind':_0x55f206(0x160)},{'$match':{'product_details.product_name':_0x8da4f8}},{'$group':{'_id':_0x55f206(0x19a),'product_stock':{'$first':_0x55f206(0x172)}}}]);console['log'](_0x55f206(0x163),_0x475807),_0x4620f2['status'](0xc8)[_0x55f206(0x1a6)]({'master':_0x2ea2dc,'new_product':_0x29ae16,'stock_data':_0x475807});}catch(_0x328671){console['log'](_0x328671);}}),router[a0_0x4aaa0d(0x1ee)](a0_0x4aaa0d(0x24b),auth,async(_0x2d206e,_0x207b54)=>{var _0x4499ea=a0_0x4aaa0d;try{const {invoice:_0xa0961b,date:_0x28a775,warehouse_name:_0x52dca5,product_name:_0x19545b,stock:_0x1f91ad,quantity:_0x6e1388,note:_0x1ba949,room:_0x33061d,primary_code:_0x9f6805,secondary_code:_0x566f4e,prod_code:_0x57b2da,level:_0x34a8c6,isle:_0x1651ab,pallet:_0x4931bb,batch_code:_0x2151c6,SCRN:_0x19407a,expiry_date:_0x21fd56}=_0x2d206e[_0x4499ea(0x1bf)];if(typeof _0x19545b=='string')var _0xa5dd19=[_0x2d206e['body']['product_name']],_0x551e2a=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x14e)]],_0x260fab=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x17e)]],_0x1650b6=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x144)]],_0x1394af=[_0x2d206e['body']['secondary_code']],_0xea7be5=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x18b)]],_0xb8b23d=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x157)]],_0x10588d=[_0x2d206e['body'][_0x4499ea(0x21b)]],_0x5c29aa=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1ad)]],_0x5fc17b=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1c3)]],_0x50093c=[_0x2d206e['body'][_0x4499ea(0x18d)]],_0x5bc31e=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1e4)]],_0x2c0a85=[_0x2d206e[_0x4499ea(0x1bf)]['production_date']],_0x2896c8=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1c4)]],_0x59756e=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1e2)]],_0x296215=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1b5)]],_0x4ecf8f=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x145)]],_0x23359f=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x217)]],_0x236d0a=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x155)]],_0x5a03b8=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x148)]],_0x1a9659=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1d5)]],_0x1b9fbf=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1d3)]],_0x132aab=[_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1a0)]];else var _0xa5dd19=[..._0x2d206e['body'][_0x4499ea(0x243)]],_0x551e2a=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x14e)]],_0x260fab=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x17e)]],_0x1650b6=[..._0x2d206e['body'][_0x4499ea(0x144)]],_0x1394af=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x156)]],_0xea7be5=[..._0x2d206e[_0x4499ea(0x1bf)]['prod_code']],_0xb8b23d=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x157)]],_0x10588d=[..._0x2d206e['body'][_0x4499ea(0x21b)]],_0x5c29aa=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1ad)]],_0x5fc17b=[..._0x2d206e['body'][_0x4499ea(0x1c3)]],_0x50093c=[..._0x2d206e['body'][_0x4499ea(0x18d)]],_0x5bc31e=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1e4)]],_0x2c0a85=[..._0x2d206e['body'][_0x4499ea(0x13f)]],_0x2896c8=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1c4)]],_0x59756e=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1e2)]],_0x296215=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1b5)]],_0x4ecf8f=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x145)]],_0x23359f=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x217)]],_0x236d0a=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x155)]],_0x5a03b8=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x148)]],_0x1a9659=[..._0x2d206e[_0x4499ea(0x1bf)]['actual_qty']],_0x1b9fbf=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1d3)]],_0x132aab=[..._0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1a0)]];const _0x728e72=_0xa5dd19['map'](_0x3e0a58=>{return _0x3e0a58={'product_name':_0x3e0a58};});_0x551e2a[_0x4499ea(0x224)]((_0x2e06ee,_0x332518)=>{var _0x15b7b7=_0x4499ea;_0x728e72[_0x332518][_0x15b7b7(0x14e)]=Math[_0x15b7b7(0x21c)](_0x2e06ee);}),_0x1a9659['forEach']((_0x2b7c9b,_0x81c896)=>{var _0x5f27aa=_0x4499ea;_0x728e72[_0x81c896][_0x5f27aa(0x1d5)]=Math[_0x5f27aa(0x21c)](_0x2b7c9b);}),_0x1b9fbf[_0x4499ea(0x224)]((_0x17c77d,_0x23098d)=>{var _0x562ef5=_0x4499ea;_0x728e72[_0x23098d][_0x562ef5(0x1d3)]=_0x17c77d;}),_0x132aab[_0x4499ea(0x224)]((_0x4e41bb,_0x3d9c06)=>{_0x728e72[_0x3d9c06]['id_transaction_from']=_0x4e41bb;}),_0x260fab['forEach']((_0x53cd83,_0x4a8d94)=>{var _0x1aeeef=_0x4499ea;_0x728e72[_0x4a8d94][_0x1aeeef(0x217)]=_0x53cd83;}),_0x1650b6['forEach']((_0x3ae0b0,_0x50c07a)=>{var _0xd859b5=_0x4499ea;_0x728e72[_0x50c07a][_0xd859b5(0x144)]=_0x3ae0b0;}),_0x1394af[_0x4499ea(0x224)]((_0x502e4c,_0x490482)=>{var _0x341c98=_0x4499ea;_0x728e72[_0x490482][_0x341c98(0x156)]=_0x502e4c;}),_0xea7be5[_0x4499ea(0x224)]((_0x4d75f2,_0x37ca51)=>{_0x728e72[_0x37ca51]['product_code']=_0x4d75f2;}),_0xb8b23d[_0x4499ea(0x224)]((_0x88b6cf,_0x404815)=>{var _0x48abda=_0x4499ea;_0x236d0a[_0x48abda(0x224)]((_0x4d0e93,_0x424938)=>{var _0x739bba=_0x48abda;if(_0x4d0e93==_0x739bba(0x1e8)&&_0x404815==_0x424938){var _0x581452=_0x88b6cf['slice'](0x3);_0x728e72[_0x404815][_0x739bba(0x1c0)]=_0x88b6cf[0x0],_0x728e72[_0x404815][_0x739bba(0x199)]=_0x88b6cf[0x1],_0x728e72[_0x404815]['bay']=0x0,_0x728e72[_0x404815][_0x739bba(0x16a)]=0x0,_0x728e72[_0x404815][_0x739bba(0x1a4)]=_0x739bba(0x1f9),_0x728e72[_0x404815][_0x739bba(0x1da)]=_0x581452;}else{if(_0x4d0e93=='Shelves'&&_0x404815==_0x424938){var _0x581452=_0x88b6cf[_0x739bba(0x1d2)](0x3);_0x728e72[_0x404815][_0x739bba(0x1c0)]=_0x88b6cf[0x0],_0x728e72[_0x404815]['rack']=_0x88b6cf[0x1],_0x728e72[_0x404815][_0x739bba(0x1ff)]=0x0,_0x728e72[_0x404815]['bin']=0x0,_0x728e72[_0x404815][_0x739bba(0x1a4)]=_0x739bba(0x1f9),_0x728e72[_0x404815][_0x739bba(0x1da)]=_0x88b6cf[0x5];}else{if(_0x404815==_0x424938){var _0x55b863;if(_0x88b6cf[0x4]=='L')_0x55b863=_0x739bba(0x22a);else _0x88b6cf[0x4]=='F'&&(_0x55b863=_0x739bba(0x1f9));_0x728e72[_0x404815]['storage']=_0x88b6cf[0x0],_0x728e72[_0x404815][_0x739bba(0x199)]=_0x88b6cf[0x1],_0x728e72[_0x404815][_0x739bba(0x1ff)]=_0x88b6cf[0x2],_0x728e72[_0x404815]['bin']=_0x88b6cf[0x3],_0x728e72[_0x404815][_0x739bba(0x1a4)]=_0x55b863,_0x728e72[_0x404815][_0x739bba(0x1da)]=_0x88b6cf[0x5];}}}});}),_0x10588d[_0x4499ea(0x224)]((_0x38e93d,_0x59921c)=>{var _0xb38cb6=_0x4499ea;_0x728e72[_0x59921c][_0xb38cb6(0x1e6)]=_0x38e93d;}),_0x5c29aa[_0x4499ea(0x224)]((_0x4a8cba,_0x43a738)=>{var _0x585a37=_0x4499ea;_0x728e72[_0x43a738][_0x585a37(0x1ad)]=_0x4a8cba;}),_0x5fc17b[_0x4499ea(0x224)]((_0x24b8a1,_0x483f75)=>{var _0x25d662=_0x4499ea;_0x728e72[_0x483f75][_0x25d662(0x1c3)]=_0x24b8a1;}),_0x50093c['forEach']((_0x37ca2d,_0x43e719)=>{var _0x11e255=_0x4499ea;_0x728e72[_0x43e719][_0x11e255(0x18d)]=_0x37ca2d;}),_0x5bc31e[_0x4499ea(0x224)]((_0x3edee4,_0x399230)=>{var _0x36fdb6=_0x4499ea;_0x728e72[_0x399230][_0x36fdb6(0x222)]=_0x3edee4;}),_0x2c0a85['forEach']((_0x1f5038,_0x4399a1)=>{var _0xed1215=_0x4499ea;_0x728e72[_0x4399a1][_0xed1215(0x13f)]=_0x1f5038;}),_0x2896c8[_0x4499ea(0x224)]((_0x357db4,_0x29c772)=>{var _0x2ce8da=_0x4499ea;_0x728e72[_0x29c772][_0x2ce8da(0x1c4)]=_0x357db4;}),_0x59756e[_0x4499ea(0x224)]((_0x12f5a0,_0xdd80ad)=>{_0x728e72[_0xdd80ad]['delivery_date']=_0x12f5a0;}),_0x296215[_0x4499ea(0x224)]((_0x11cdf1,_0x7bd3d8)=>{var _0x5a385c=_0x4499ea;_0x728e72[_0x7bd3d8][_0x5a385c(0x1b5)]=_0x11cdf1;}),_0x4ecf8f[_0x4499ea(0x224)]((_0xc1729c,_0x31f340)=>{var _0xdfd3bf=_0x4499ea;_0x728e72[_0x31f340][_0xdfd3bf(0x145)]=_0xc1729c;}),_0x23359f[_0x4499ea(0x224)]((_0x5b3b0c,_0x27a741)=>{var _0x12c6a5=_0x4499ea;_0x728e72[_0x27a741][_0x12c6a5(0x143)]=_0x5b3b0c;}),_0x236d0a[_0x4499ea(0x224)]((_0x4cdb65,_0x37b439)=>{var _0x3b9781=_0x4499ea;_0x728e72[_0x37b439][_0x3b9781(0x204)]=_0x4cdb65;}),_0x5a03b8['forEach']((_0x5833c3,_0x45fd25)=>{var _0x4f2e2a=_0x4499ea;_0x728e72[_0x45fd25][_0x4f2e2a(0x1c5)]=_0x5833c3;});var _0x4220f9=0x0;_0x728e72[_0x4499ea(0x224)](_0x1670b6=>{var _0x40a8c4=_0x4499ea;(_0x1670b6[_0x40a8c4(0x14e)]<_0x1670b6[_0x40a8c4(0x143)]||_0x1670b6['quantity_notConverted']==0x0)&&(console[_0x40a8c4(0x1df)](_0x40a8c4(0x17b),_0x1670b6),_0x4220f9++);});const _0x5bbaea=_0x728e72[_0x4499ea(0x13e)](_0x330b9b=>_0x330b9b['quantity']!=='0'&&_0x330b9b[_0x4499ea(0x217)]!==''),_0x2d365a=new sales({'invoice':_0xa0961b,'customer':_0x2d206e[_0x4499ea(0x1bf)][_0x4499ea(0x1f2)],'date':_0x28a775,'warehouse_name':_0x52dca5,'sale_product':_0x5bbaea,'note':_0x1ba949,'room':_0x33061d,'primary_code':_0x9f6805,'secondary_code':_0x566f4e,'prod_code':_0x57b2da,'SCRN':_0x19407a}),_0x1860cf=await _0x2d365a[_0x4499ea(0x1d9)]();_0x2d206e['flash']('success','Sales\x20Add\x20successfully'),_0x207b54[_0x4499ea(0x242)](_0x4499ea(0x15b)+_0x1860cf['_id']);}catch(_0x59faaf){console[_0x4499ea(0x1df)](_0x59faaf);}}),router['get'](a0_0x4aaa0d(0x23f),auth,async(_0x3eac92,_0x5e78d1)=>{var _0x896cb4=a0_0x4aaa0d;try{const {username:_0x1d5e5d,email:_0x451598,role:_0x5a6e15}=_0x3eac92[_0x896cb4(0x1b7)],_0x2f22c9=_0x3eac92['user'],_0x5234a1=await profile['findOne']({'email':_0x2f22c9[_0x896cb4(0x22e)]}),_0x40e21d=await master_shop[_0x896cb4(0x249)](),_0x59f628=_0x3eac92[_0x896cb4(0x16b)]['id'],_0x1a4c30=await sales[_0x896cb4(0x1af)](_0x59f628),_0x1bdb96=await warehouse[_0x896cb4(0x174)]([{'$match':{'name':_0x1a4c30[_0x896cb4(0x219)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x896cb4(0x19a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x896cb4(0x180)},'type':{'$first':_0x896cb4(0x165)},'floorlevel':{'$first':_0x896cb4(0x22b)},'primary_code':{'$first':_0x896cb4(0x1a5)},'secondary_code':{'$first':_0x896cb4(0x139)},'product_code':{'$first':_0x896cb4(0x1f0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x896cb4(0x14f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x896cb4(0x16f)},'invoice':{'$first':_0x896cb4(0x18c)}}}]),_0x3cb2fd=await customer[_0x896cb4(0x249)]({});let _0x28dc16;if(_0x2f22c9['role']=='staff'){const _0x539a1e=await staff['findOne']({'email':_0x2f22c9['email']});_0x28dc16=await warehouse[_0x896cb4(0x174)]([{'$match':{'status':'Enabled','name':_0x539a1e[_0x896cb4(0x1cc)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x28dc16=await warehouse[_0x896cb4(0x174)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x896cb4(0x23a),'name':{'$first':'$name'}}}]);const _0x424e40=await product[_0x896cb4(0x249)]({}),_0x196b87=await suppliers[_0x896cb4(0x249)]({});if(_0x40e21d[0x0][_0x896cb4(0x1ea)]=='English\x20(US)'){var _0x17b37f=users[_0x896cb4(0x218)];console[_0x896cb4(0x1df)](_0x17b37f);}else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]==_0x896cb4(0x23e))var _0x17b37f=users[_0x896cb4(0x23e)];else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]==_0x896cb4(0x15f))var _0x17b37f=users[_0x896cb4(0x15f)];else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]==_0x896cb4(0x1be))var _0x17b37f=users[_0x896cb4(0x1be)];else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]==_0x896cb4(0x168))var _0x17b37f=users['French'];else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]==_0x896cb4(0x1cf))var _0x17b37f=users['Portuguese'];else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]=='Chinese')var _0x17b37f=users['Chinese'];else{if(_0x40e21d[0x0][_0x896cb4(0x1ea)]==_0x896cb4(0x137))var _0x17b37f=users[_0x896cb4(0x1b2)];}}}}}}}_0x5e78d1['render'](_0x896cb4(0x248),{'success':_0x3eac92[_0x896cb4(0x21f)](_0x896cb4(0x1eb)),'errors':_0x3eac92[_0x896cb4(0x21f)](_0x896cb4(0x19c)),'role':_0x2f22c9,'profile':_0x5234a1,'customer':_0x3cb2fd,'warehouse':_0x28dc16,'product':_0x1bdb96,'user':_0x1a4c30,'master_shop':_0x40e21d,'unit':_0x424e40,'language':_0x17b37f,'suppliers':_0x196b87});}catch(_0x262b32){console[_0x896cb4(0x1df)](_0x262b32);}}),router[a0_0x4aaa0d(0x1ee)](a0_0x4aaa0d(0x23f),auth,async(_0x266fe7,_0xa64251)=>{var _0x3485b3=a0_0x4aaa0d;try{const _0x2fb543=_0x266fe7[_0x3485b3(0x16b)]['id'],{invoice:_0xe174b9,warehouse_name:_0x240c76,room:_0x5b0dd8}=_0x266fe7[_0x3485b3(0x1bf)],_0x998579=await sales[_0x3485b3(0x1f6)]({'invoice':_0xe174b9}),_0x2c6a08=_0x998579[_0x3485b3(0x186)]['map'](async _0x39bb46=>{var _0x579c46=_0x3485b3,_0x51dbd3=await warehouse[_0x579c46(0x1f6)]({'name':_0x240c76,'room':_0x39bb46['room_name'],'warehouse_category':_0x579c46(0x21d)});const _0x40f8f5=_0x51dbd3['product_details']['map'](_0x40879e=>{var _0x1d5932=_0x579c46;_0x40879e[_0x1d5932(0x243)]==_0x39bb46[_0x1d5932(0x243)]&&_0x40879e[_0x1d5932(0x1da)]==_0x39bb46[_0x1d5932(0x1da)]&&_0x40879e['type']==_0x39bb46[_0x1d5932(0x1a4)]&&_0x40879e[_0x1d5932(0x16a)]==_0x39bb46[_0x1d5932(0x16a)]&&_0x40879e['bay']==_0x39bb46['bay']&&_0x40879e['rack']==_0x39bb46[_0x1d5932(0x199)]&&_0x40879e['storage']==_0x39bb46[_0x1d5932(0x1c0)]&&_0x40879e['expiry_date']==_0x39bb46['expiry_date']&&_0x40879e['batch_code']==_0x39bb46[_0x1d5932(0x1c3)]&&_0x40879e[_0x1d5932(0x1c5)]==_0x39bb46[_0x1d5932(0x1c5)]&&_0x40879e[_0x1d5932(0x1b1)]==_0x39bb46[_0x1d5932(0x1c1)]&&(_0x40879e[_0x1d5932(0x196)]=Math[_0x1d5932(0x1ba)](0x0,Math[_0x1d5932(0x21c)](_0x40879e[_0x1d5932(0x196)])-Math[_0x1d5932(0x21c)](_0x39bb46['quantity'])));});return _0x51dbd3;});Promise[_0x3485b3(0x153)](_0x2c6a08)[_0x3485b3(0x1dc)](async _0x1dc1ed=>{var _0x5733f3=_0x3485b3;try{for(const _0xcacbc9 of _0x1dc1ed){await _0xcacbc9[_0x5733f3(0x1d9)]();}_0x998579[_0x5733f3(0x1ab)]=_0x5733f3(0x24a);const _0x24c465=await _0x998579[_0x5733f3(0x1d9)](),_0x38e01a=await master_shop[_0x5733f3(0x249)](),_0x4d2f9f=await email_settings[_0x5733f3(0x1f6)](),_0x18871a=await supervisor_settings['find']();var _0x5fbd30=_0x998579[_0x5733f3(0x186)],_0x264e0d='',_0x2d5592;for(_0x2d5592 in _0x5fbd30){_0x264e0d+='<tr>'+_0x5733f3(0x1b4)+_0x5fbd30[_0x2d5592]['product_name']+_0x5733f3(0x140)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5fbd30[_0x2d5592][_0x5733f3(0x175)]+_0x5733f3(0x140)+_0x5733f3(0x1b4)+_0x5fbd30[_0x2d5592][_0x5733f3(0x217)]+'</td>'+_0x5733f3(0x1b4)+_0x5fbd30[_0x2d5592][_0x5733f3(0x1e6)]+_0x5733f3(0x140)+_0x5733f3(0x1b4)+_0x5fbd30[_0x2d5592][_0x5733f3(0x1ad)]+_0x5733f3(0x140)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x998579[_0x5733f3(0x219)]+_0x5733f3(0x140)+_0x5733f3(0x1b4)+_0x5fbd30[_0x2d5592][_0x5733f3(0x204)]+_0x5733f3(0x140)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5fbd30[_0x2d5592]['storage']+_0x5fbd30[_0x2d5592][_0x5733f3(0x199)]+_0x5fbd30[_0x2d5592]['bay']+_0x5fbd30[_0x2d5592]['bin']+_0x5fbd30[_0x2d5592][_0x5733f3(0x1a4)][0x0]+_0x5fbd30[_0x2d5592][_0x5733f3(0x1da)]+_0x5733f3(0x140),_0x5733f3(0x19f);}let _0x480a45=nodemailer[_0x5733f3(0x191)]({'host':_0x4d2f9f[_0x5733f3(0x209)],'port':Number(_0x4d2f9f['port']),'secure':![],'auth':{'user':_0x4d2f9f[_0x5733f3(0x22e)],'pass':_0x4d2f9f[_0x5733f3(0x15a)]}}),_0x260f34={'from':_0x4d2f9f[_0x5733f3(0x22e)],'to':_0x18871a[0x0][_0x5733f3(0x24c)],'subject':_0x5733f3(0x1d6),'attachments':[{'filename':_0x5733f3(0x159),'path':__dirname+_0x5733f3(0x1fb)+_0x5733f3(0x22d)+_0x38e01a[0x0][_0x5733f3(0x239)],'cid':_0x5733f3(0x225)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x5733f3(0x19b)+_0x5733f3(0x187)+_0x5733f3(0x229)+'<div>'+_0x5733f3(0x236)+_0x5733f3(0x1c7)+'<div>'+_0x5733f3(0x1e3)+_0x38e01a[0x0]['site_title']+_0x5733f3(0x138)+_0x5733f3(0x1c7)+_0x5733f3(0x1c7)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5733f3(0x1a9)+_0x998579[_0x5733f3(0x1c5)]+'\x20'+_0x5733f3(0x211)+_0x5733f3(0x146)+_0x998579[_0x5733f3(0x171)]+'\x20'+_0x5733f3(0x1de)+'</h5>'+'</div>'+_0x5733f3(0x232)+_0x5733f3(0x198)+_0x5733f3(0x17c)+_0x5733f3(0x150)+_0x5733f3(0x20a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5733f3(0x227)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x5733f3(0x151)+_0x5733f3(0x241)+_0x5733f3(0x190)+_0x5733f3(0x19f)+_0x5733f3(0x19e)+_0x5733f3(0x244)+'\x20'+_0x264e0d+'\x20'+_0x5733f3(0x169)+_0x5733f3(0x178)+_0x5733f3(0x187)+'<strong>\x20Regards\x20</strong>'+_0x5733f3(0x21e)+_0x38e01a[0x0][_0x5733f3(0x1a3)]+'</h5>'+_0x5733f3(0x1c7)+'</div>'+_0x5733f3(0x1f5)};_0x480a45[_0x5733f3(0x245)](_0x260f34,function(_0x269256,_0x2858b2){var _0x2f5b1d=_0x5733f3;_0x269256?(console[_0x2f5b1d(0x1df)](_0x269256),console[_0x2f5b1d(0x1df)](_0x2f5b1d(0x1ae))):console[_0x2f5b1d(0x1df)]('Email\x20sent\x20successfully');}),_0x266fe7['flash'](_0x5733f3(0x1eb),'Sales\x20Update\x20successfully'),_0xa64251['redirect'](_0x5733f3(0x15b)+_0x2fb543);}catch(_0x481ff8){console[_0x5733f3(0x14b)](_0x481ff8),_0xa64251['status'](0x1f4)[_0x5733f3(0x1a6)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3485b3(0x201)](_0x258540=>{var _0x41c2f9=_0x3485b3;console[_0x41c2f9(0x14b)](_0x258540),_0xa64251[_0x41c2f9(0x179)](0x1f4)['json']({'error':_0x41c2f9(0x193)});});}catch(_0x307941){console[_0x3485b3(0x1df)](_0x307941);}}),router[a0_0x4aaa0d(0x23d)](a0_0x4aaa0d(0x18e),auth,async(_0x2541b5,_0x3e510d)=>{var _0x2ad699=a0_0x4aaa0d;try{const {username:_0x1ec7eb,email:_0x2e9940,role:_0x271eac}=_0x2541b5[_0x2ad699(0x1b7)],_0x5e941c=_0x2541b5[_0x2ad699(0x1b7)],_0x4bb394=await profile[_0x2ad699(0x1f6)]({'email':_0x5e941c['email']}),_0x3ea5ba=await master_shop[_0x2ad699(0x249)](),_0x49cd99=_0x2541b5[_0x2ad699(0x16b)]['id'],_0x40e092=await sales[_0x2ad699(0x1af)](_0x49cd99);var _0x38172e=[_0x2ad699(0x170),'Enclosed'];const _0x301273=await warehouse['aggregate']([{'$match':{'name':_0x40e092['warehouse_name'],'warehouse_category':_0x2ad699(0x21d)}},{'$unwind':_0x2ad699(0x160)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2ad699(0x19a)},'product_stock':{'$first':_0x2ad699(0x172)},'bay':{'$first':_0x2ad699(0x147)},'bin':{'$first':_0x2ad699(0x180)},'type':{'$first':_0x2ad699(0x165)},'floorlevel':{'$first':_0x2ad699(0x22b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2ad699(0x139)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2ad699(0x17f)},'rack':{'$first':_0x2ad699(0x14f)}}}]),_0x1c0842=await customer['find']({});let _0x573c09;if(_0x5e941c[_0x2ad699(0x1a7)]==_0x2ad699(0x235)){const _0x46712e=await staff[_0x2ad699(0x1f6)]({'email':_0x5e941c[_0x2ad699(0x22e)]});_0x573c09=await warehouse[_0x2ad699(0x174)]([{'$match':{'status':'Enabled','name':_0x46712e['warehouse'],'warehouse_category':_0x2ad699(0x21d)}},{'$group':{'_id':_0x2ad699(0x23a),'name':{'$first':_0x2ad699(0x23a)}}}]);}else _0x573c09=await warehouse[_0x2ad699(0x174)]([{'$match':{'status':_0x2ad699(0x185),'warehouse_category':_0x2ad699(0x21d)}},{'$group':{'_id':'$name','name':{'$first':_0x2ad699(0x23a)}}}]);const _0x422a23=await product[_0x2ad699(0x249)]({});if(_0x3ea5ba[0x0][_0x2ad699(0x1ea)]==_0x2ad699(0x136)){var _0x1c6a7c=users['English'];console['log'](_0x1c6a7c);}else{if(_0x3ea5ba[0x0][_0x2ad699(0x1ea)]=='Hindi')var _0x1c6a7c=users[_0x2ad699(0x23e)];else{if(_0x3ea5ba[0x0][_0x2ad699(0x1ea)]==_0x2ad699(0x15f))var _0x1c6a7c=users[_0x2ad699(0x15f)];else{if(_0x3ea5ba[0x0]['language']==_0x2ad699(0x1be))var _0x1c6a7c=users['Spanish'];else{if(_0x3ea5ba[0x0][_0x2ad699(0x1ea)]==_0x2ad699(0x168))var _0x1c6a7c=users[_0x2ad699(0x168)];else{if(_0x3ea5ba[0x0][_0x2ad699(0x1ea)]==_0x2ad699(0x1cf))var _0x1c6a7c=users[_0x2ad699(0x166)];else{if(_0x3ea5ba[0x0][_0x2ad699(0x1ea)]==_0x2ad699(0x17d))var _0x1c6a7c=users[_0x2ad699(0x17d)];else{if(_0x3ea5ba[0x0]['language']=='Arabic\x20(ae)')var _0x1c6a7c=users[_0x2ad699(0x1b2)];}}}}}}}_0x3e510d[_0x2ad699(0x176)]('edit_sales',{'success':_0x2541b5['flash']('success'),'errors':_0x2541b5[_0x2ad699(0x21f)]('errors'),'role':_0x5e941c,'profile':_0x4bb394,'customer':_0x1c0842,'warehouse':_0x573c09,'product':_0x301273,'user':_0x40e092,'master_shop':_0x3ea5ba,'unit':_0x422a23,'language':_0x1c6a7c});}catch(_0x15337a){console[_0x2ad699(0x1df)](_0x15337a);}}),router[a0_0x4aaa0d(0x1ee)]('/view/:id',auth,async(_0x4d1fcb,_0x18bec9)=>{var _0x1aed53=a0_0x4aaa0d;try{const _0x699d5c=_0x4d1fcb[_0x1aed53(0x16b)]['id'],_0x175791=await sales['findOne']({'_id':_0x4d1fcb[_0x1aed53(0x16b)]['id']}),_0x4aea87=await warehouse['findOne']({'name':_0x175791[_0x1aed53(0x219)],'room':_0x4d1fcb[_0x1aed53(0x1bf)]['room']}),{invoice:_0x3f84dd,date:_0x10a27a,warehouse_name:_0x5a858a,product_name:_0x51653f,stock:_0x2da724,quantity:_0x54f81a,note:_0xd2bab5,room:_0x3e1c7c,customer:_0x3a9170,SCRN:_0x44180b}=_0x4d1fcb[_0x1aed53(0x1bf)];if(typeof _0x51653f==_0x1aed53(0x158))var _0x3403e4=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x243)]],_0x3cfa7a=[_0x4d1fcb[_0x1aed53(0x1bf)]['stock']],_0x456ab1=[_0x4d1fcb[_0x1aed53(0x1bf)]['carton']],_0x441cf2=[_0x4d1fcb['body'][_0x1aed53(0x144)]],_0x5dc93d=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x156)]],_0x578202=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x18b)]],_0x3cccc8=[_0x4d1fcb['body'][_0x1aed53(0x157)]],_0x1ede33=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x21b)]],_0x3afe60=[_0x4d1fcb[_0x1aed53(0x1bf)]['secondary_unit']],_0x1e508f=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x1c3)]],_0xcb0af9=[_0x4d1fcb['body'][_0x1aed53(0x18d)]],_0x45f951=[_0x4d1fcb['body'][_0x1aed53(0x1e4)]],_0x238e4a=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x13f)]],_0xcf2570=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x1c4)]],_0x55c2e5=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x1e2)]],_0x3012c0=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x1b5)]],_0x52b36b=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x145)]],_0x16dea7=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x217)]],_0x535ede=[_0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x155)]];else var _0x3403e4=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x243)]],_0x3cfa7a=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x14e)]],_0x456ab1=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x17e)]],_0x441cf2=[..._0x4d1fcb[_0x1aed53(0x1bf)]['primary_code']],_0x5dc93d=[..._0x4d1fcb['body'][_0x1aed53(0x156)]],_0x578202=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x18b)]],_0x3cccc8=[..._0x4d1fcb[_0x1aed53(0x1bf)]['level']],_0x1ede33=[..._0x4d1fcb['body'][_0x1aed53(0x21b)]],_0x3afe60=[..._0x4d1fcb[_0x1aed53(0x1bf)]['secondary_unit']],_0x1e508f=[..._0x4d1fcb['body'][_0x1aed53(0x1c3)]],_0xcb0af9=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x18d)]],_0x45f951=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x1e4)]],_0x238e4a=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x13f)]],_0xcf2570=[..._0x4d1fcb[_0x1aed53(0x1bf)]['requested_qty']],_0x55c2e5=[..._0x4d1fcb[_0x1aed53(0x1bf)]['delivery_date']],_0x3012c0=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x1b5)]],_0x52b36b=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x145)]],_0x16dea7=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x217)]],_0x535ede=[..._0x4d1fcb[_0x1aed53(0x1bf)][_0x1aed53(0x155)]];const _0x2fafed=_0x3403e4[_0x1aed53(0x223)](_0x65bc24=>{return _0x65bc24={'product_name':_0x65bc24};});_0x3cfa7a[_0x1aed53(0x224)]((_0x46bb63,_0x305218)=>{var _0x50bb1b=_0x1aed53;_0x2fafed[_0x305218][_0x50bb1b(0x14e)]=Math[_0x50bb1b(0x21c)](_0x46bb63);}),_0x456ab1['forEach']((_0x442df5,_0x36033c)=>{var _0x51eab4=_0x1aed53;_0x2fafed[_0x36033c][_0x51eab4(0x217)]=_0x442df5;}),_0x441cf2[_0x1aed53(0x224)]((_0xa4314e,_0x144309)=>{var _0x141d5c=_0x1aed53;_0x2fafed[_0x144309][_0x141d5c(0x144)]=_0xa4314e;}),_0x5dc93d[_0x1aed53(0x224)]((_0x925431,_0x306019)=>{var _0xd29a83=_0x1aed53;_0x2fafed[_0x306019][_0xd29a83(0x156)]=_0x925431;}),_0x578202[_0x1aed53(0x224)]((_0xa50440,_0x5b67d8)=>{_0x2fafed[_0x5b67d8]['product_code']=_0xa50440;}),_0x3cccc8[_0x1aed53(0x224)]((_0x18890f,_0x4a3246)=>{_0x535ede['forEach']((_0x2bb7f4,_0x106013)=>{var _0x5c2be2=a0_0x5b5c;if(_0x2bb7f4=='Receiving\x20Area'&&_0x4a3246==_0x106013){var _0x4129c9=_0x18890f[_0x5c2be2(0x1d2)](0x3);_0x2fafed[_0x4a3246]['storage']=_0x18890f[0x0],_0x2fafed[_0x4a3246][_0x5c2be2(0x199)]=_0x18890f[0x1],_0x2fafed[_0x4a3246]['bay']=0x0,_0x2fafed[_0x4a3246][_0x5c2be2(0x16a)]=0x0,_0x2fafed[_0x4a3246][_0x5c2be2(0x1a4)]=_0x5c2be2(0x1f9),_0x2fafed[_0x4a3246][_0x5c2be2(0x1da)]=_0x4129c9;}else{if(_0x2bb7f4=='Shelves'&&_0x4a3246==_0x106013){var _0x4129c9=_0x18890f['slice'](0x3);_0x2fafed[_0x4a3246][_0x5c2be2(0x1c0)]=_0x18890f[0x0],_0x2fafed[_0x4a3246][_0x5c2be2(0x199)]=_0x18890f[0x1],_0x2fafed[_0x4a3246][_0x5c2be2(0x1ff)]=0x0,_0x2fafed[_0x4a3246][_0x5c2be2(0x16a)]=0x0,_0x2fafed[_0x4a3246][_0x5c2be2(0x1a4)]=_0x5c2be2(0x1f9),_0x2fafed[_0x4a3246][_0x5c2be2(0x1da)]=_0x18890f[0x5];}else{if(_0x4a3246==_0x106013){var _0x2052fa;if(_0x18890f[0x4]=='L')_0x2052fa=_0x5c2be2(0x22a);else _0x18890f[0x4]=='F'&&(_0x2052fa='Floor');_0x2fafed[_0x4a3246]['storage']=_0x18890f[0x0],_0x2fafed[_0x4a3246][_0x5c2be2(0x199)]=_0x18890f[0x1],_0x2fafed[_0x4a3246][_0x5c2be2(0x1ff)]=_0x18890f[0x2],_0x2fafed[_0x4a3246][_0x5c2be2(0x16a)]=_0x18890f[0x3],_0x2fafed[_0x4a3246][_0x5c2be2(0x1a4)]=_0x2052fa,_0x2fafed[_0x4a3246][_0x5c2be2(0x1da)]=_0x18890f[0x5];}}}});}),_0x1ede33[_0x1aed53(0x224)]((_0x5a0410,_0x22d1bb)=>{_0x2fafed[_0x22d1bb]['unit']=_0x5a0410;}),_0x3afe60[_0x1aed53(0x224)]((_0x5d323e,_0x43a77f)=>{_0x2fafed[_0x43a77f]['secondary_unit']=_0x5d323e;}),_0x1e508f['forEach']((_0x5abe89,_0x248682)=>{var _0x58d9ba=_0x1aed53;_0x2fafed[_0x248682][_0x58d9ba(0x1c3)]=_0x5abe89;}),_0xcb0af9['forEach']((_0x309d5a,_0x5dba27)=>{var _0x10f737=_0x1aed53;_0x2fafed[_0x5dba27][_0x10f737(0x18d)]=_0x309d5a;}),_0x45f951[_0x1aed53(0x224)]((_0x3baf57,_0x5e5b89)=>{var _0x4180c8=_0x1aed53;_0x2fafed[_0x5e5b89][_0x4180c8(0x222)]=_0x3baf57;}),_0x238e4a[_0x1aed53(0x224)]((_0x2e677e,_0x2d147d)=>{var _0x10cb55=_0x1aed53;_0x2fafed[_0x2d147d][_0x10cb55(0x13f)]=_0x2e677e;}),_0xcf2570[_0x1aed53(0x224)]((_0x413b16,_0x22148a)=>{var _0x3096c7=_0x1aed53;_0x2fafed[_0x22148a][_0x3096c7(0x1c4)]=Math[_0x3096c7(0x21c)](_0x413b16);}),_0x55c2e5[_0x1aed53(0x224)]((_0x53832d,_0x32f772)=>{var _0x554ee9=_0x1aed53;_0x2fafed[_0x32f772][_0x554ee9(0x1e2)]=_0x53832d;}),_0x3012c0[_0x1aed53(0x224)]((_0x36ecd5,_0x1090c9)=>{var _0x42e6d5=_0x1aed53;_0x2fafed[_0x1090c9][_0x42e6d5(0x1b5)]=_0x36ecd5;}),_0x52b36b[_0x1aed53(0x224)]((_0x2333d2,_0x5eaafc)=>{_0x2fafed[_0x5eaafc]['prod_cat']=_0x2333d2;}),_0x16dea7[_0x1aed53(0x224)]((_0x434abc,_0x4e4e3d)=>{var _0x2a2959=_0x1aed53;_0x2fafed[_0x4e4e3d][_0x2a2959(0x143)]=_0x434abc;}),_0x535ede[_0x1aed53(0x224)]((_0x3ff639,_0x15125f)=>{_0x2fafed[_0x15125f]['room_name']=_0x3ff639;});var _0x4978f9=0x0;_0x2fafed['forEach'](_0x4edcd4=>{var _0x55d08d=_0x1aed53;console[_0x55d08d(0x1df)](_0x55d08d(0x17b),_0x4edcd4),(parseInt(_0x4edcd4[_0x55d08d(0x14e)])<parseInt(_0x4edcd4['quantity'])||parseInt(_0x4edcd4[_0x55d08d(0x217)])==0x0)&&_0x4978f9++;});if(_0x4978f9!=0x0)return _0x4d1fcb[_0x1aed53(0x21f)](_0x1aed53(0x19c),_0x1aed53(0x16e)),_0x18bec9['redirect'](_0x1aed53(0x1ec));const _0x8184af=_0x2fafed[_0x1aed53(0x13e)](_0x29fed7=>_0x29fed7[_0x1aed53(0x217)]!=='0'&&_0x29fed7[_0x1aed53(0x217)]!=='');_0x175791[_0x1aed53(0x1c5)]=_0x3f84dd,_0x175791[_0x1aed53(0x1f2)]=_0x3a9170,_0x175791[_0x1aed53(0x171)]=_0x10a27a,_0x175791['warehouse_name']=_0x5a858a,_0x175791[_0x1aed53(0x186)]=_0x8184af,_0x175791[_0x1aed53(0x142)]=_0xd2bab5,_0x175791[_0x1aed53(0x1bb)]=_0x44180b,_0x175791[_0x1aed53(0x1ab)]=_0x1aed53(0x141),_0x175791['isAllowEdit']=_0x1aed53(0x141);const _0x24e09b=await _0x175791['save']();_0x4d1fcb[_0x1aed53(0x21f)](_0x1aed53(0x1eb),_0x1aed53(0x247)),_0x18bec9[_0x1aed53(0x242)](_0x1aed53(0x1bd));}catch(_0x1f064f){console[_0x1aed53(0x1df)](_0x1f064f);}}),router[a0_0x4aaa0d(0x1ee)](a0_0x4aaa0d(0x1f8),auth,async(_0xe6970f,_0x410de)=>{var _0x24c2ea=a0_0x4aaa0d;try{const _0xf3470d=_0xe6970f[_0x24c2ea(0x16b)]['id'],{invoice:_0x8a4af2,customer:_0x154fac,receivable_amount:_0x4cc8ba,received_amount:_0x5463b4}=_0xe6970f[_0x24c2ea(0x1bf)],_0x3f398a=await sales[_0x24c2ea(0x1af)](_0xf3470d);console['log'](_0x3f398a);var _0x46b35b=_0x4cc8ba-_0x5463b4;console[_0x24c2ea(0x1df)](_0x5463b4),_0x3f398a[_0x24c2ea(0x1aa)]=parseFloat(_0x5463b4)+parseFloat(_0x3f398a[_0x24c2ea(0x1aa)]),_0x3f398a[_0x24c2ea(0x188)]=_0x46b35b,console[_0x24c2ea(0x1df)](_0x3f398a);const _0x53ec4b=await _0x3f398a[_0x24c2ea(0x1d9)](),_0x2cf594=await c_payment_data[_0x24c2ea(0x1f6)]({'invoice':_0x8a4af2});_0x2cf594[_0x24c2ea(0x216)]=_0x46b35b,await _0x2cf594['save']();let _0x3e1d23=new Date(),_0x1ed26c=('0'+_0x3e1d23[_0x24c2ea(0x221)]())[_0x24c2ea(0x1d2)](-0x2),_0x32760d=('0'+(_0x3e1d23[_0x24c2ea(0x15c)]()+0x1))[_0x24c2ea(0x1d2)](-0x2),_0x23efbd=_0x3e1d23[_0x24c2ea(0x13d)](),_0x4df4e7=_0x23efbd+'-'+_0x32760d+'-'+_0x1ed26c;const _0x537312=new customer_payment({'invoice':_0x8a4af2,'date':_0x23efbd+'-'+_0x32760d+'-'+_0x1ed26c,'customer':_0x154fac,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x5463b4}),_0x1a9cb8=await _0x537312[_0x24c2ea(0x1d9)]();_0xe6970f[_0x24c2ea(0x21f)](_0x24c2ea(0x1eb),_0x24c2ea(0x1ed)),_0x410de['redirect'](_0x24c2ea(0x1bd));}catch(_0x2868c8){console[_0x24c2ea(0x1df)](_0x2868c8);}}),router[a0_0x4aaa0d(0x23d)](a0_0x4aaa0d(0x20c),auth,async(_0x54d26b,_0xe87f00)=>{var _0x1c3a60=a0_0x4aaa0d;try{const {username:_0x318f47,email:_0x5379bf,role:_0x11061c}=_0x54d26b[_0x1c3a60(0x1b7)],_0x24801e=_0x54d26b[_0x1c3a60(0x1b7)],_0x174794=await profile[_0x1c3a60(0x1f6)]({'email':_0x24801e[_0x1c3a60(0x22e)]}),_0x45c6eb=await master_shop[_0x1c3a60(0x249)]();console[_0x1c3a60(0x1df)](_0x1c3a60(0x213),_0x45c6eb);const _0x80b05c=_0x54d26b['params']['id'],_0x437f54=await sales[_0x1c3a60(0x1af)](_0x80b05c);console[_0x1c3a60(0x1df)](_0x437f54);const _0x2a247b=await customer[_0x1c3a60(0x1f6)]({'name':_0x437f54[_0x1c3a60(0x1f2)]});console[_0x1c3a60(0x1df)](_0x2a247b);if(_0x45c6eb[0x0][_0x1c3a60(0x1ea)]=='English\x20(US)'){var _0x1b3670=users[_0x1c3a60(0x218)];console['log'](_0x1b3670);}else{if(_0x45c6eb[0x0][_0x1c3a60(0x1ea)]==_0x1c3a60(0x23e))var _0x1b3670=users[_0x1c3a60(0x23e)];else{if(_0x45c6eb[0x0]['language']==_0x1c3a60(0x15f))var _0x1b3670=users[_0x1c3a60(0x15f)];else{if(_0x45c6eb[0x0][_0x1c3a60(0x1ea)]==_0x1c3a60(0x1be))var _0x1b3670=users[_0x1c3a60(0x1be)];else{if(_0x45c6eb[0x0][_0x1c3a60(0x1ea)]==_0x1c3a60(0x168))var _0x1b3670=users['French'];else{if(_0x45c6eb[0x0]['language']=='Portuguese\x20(BR)')var _0x1b3670=users[_0x1c3a60(0x166)];else{if(_0x45c6eb[0x0]['language']=='Chinese')var _0x1b3670=users['Chinese'];else{if(_0x45c6eb[0x0][_0x1c3a60(0x1ea)]==_0x1c3a60(0x137))var _0x1b3670=users[_0x1c3a60(0x1b2)];}}}}}}}_0xe87f00[_0x1c3a60(0x176)](_0x1c3a60(0x1f7),{'success':_0x54d26b['flash'](_0x1c3a60(0x1eb)),'errors':_0x54d26b[_0x1c3a60(0x21f)](_0x1c3a60(0x19c)),'role':_0x24801e,'profile':_0x174794,'master_shop':_0x45c6eb,'customers':_0x2a247b,'sales':_0x437f54,'language':_0x1b3670});}catch(_0x5227d9){console[_0x1c3a60(0x1df)](_0x5227d9);}}),router['get'](a0_0x4aaa0d(0x1c9),auth,async(_0xa1b62,_0x56313a)=>{var _0xb780e3=a0_0x4aaa0d;try{const {username:_0x2e253c,email:_0x542911,role:_0x2384b6}=_0xa1b62['user'],_0x572ffa=_0xa1b62['user'],_0x34d5cc=await profile[_0xb780e3(0x1f6)]({'email':_0x572ffa[_0xb780e3(0x22e)]}),_0x3587b6=await master_shop[_0xb780e3(0x249)]();console[_0xb780e3(0x1df)](_0xb780e3(0x213),_0x3587b6);const _0x9612b4=_0xa1b62[_0xb780e3(0x16b)]['id'];console[_0xb780e3(0x1df)](_0x9612b4);const _0x43ecb5=await sales[_0xb780e3(0x1af)](_0x9612b4);console[_0xb780e3(0x1df)](_0xb780e3(0x15e),_0x43ecb5);const _0x3b8385=await warehouse[_0xb780e3(0x174)]([{'$match':{'name':_0xb780e3(0x203),'room':_0xb780e3(0x14a)}},{'$unwind':_0xb780e3(0x160)},{'$group':{'_id':_0xb780e3(0x19d),'name':{'$first':_0xb780e3(0x19a)},'product_stock':{'$first':_0xb780e3(0x172)},'level':{'$first':_0xb780e3(0x1d0)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xb780e3(0x246)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xb780e3(0x139)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0xb780e3(0x1df)](_0xb780e3(0x163),_0x3b8385);const _0x430a98=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0xb780e3(0x185),'name':_0xb780e3(0x203),'warehouse_category':_0xb780e3(0x21d)}},{'$group':{'_id':_0xb780e3(0x23a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x1b3cb4=[_0xb780e3(0x14a)];if(_0x3587b6[0x0]['language']==_0xb780e3(0x136)){var _0x139b62=users['English'];console['log'](_0x139b62);}else{if(_0x3587b6[0x0][_0xb780e3(0x1ea)]=='Hindi')var _0x139b62=users[_0xb780e3(0x23e)];else{if(_0x3587b6[0x0][_0xb780e3(0x1ea)]=='German')var _0x139b62=users[_0xb780e3(0x15f)];else{if(_0x3587b6[0x0][_0xb780e3(0x1ea)]=='Spanish')var _0x139b62=users[_0xb780e3(0x1be)];else{if(_0x3587b6[0x0][_0xb780e3(0x1ea)]==_0xb780e3(0x168))var _0x139b62=users[_0xb780e3(0x168)];else{if(_0x3587b6[0x0]['language']==_0xb780e3(0x1cf))var _0x139b62=users[_0xb780e3(0x166)];else{if(_0x3587b6[0x0]['language']==_0xb780e3(0x17d))var _0x139b62=users['Chinese'];else{if(_0x3587b6[0x0][_0xb780e3(0x1ea)]==_0xb780e3(0x137))var _0x139b62=users[_0xb780e3(0x1b2)];}}}}}}}_0x56313a[_0xb780e3(0x176)](_0xb780e3(0x1a8),{'success':_0xa1b62['flash']('success'),'errors':_0xa1b62[_0xb780e3(0x21f)](_0xb780e3(0x19c)),'role':_0x572ffa,'profile':_0x34d5cc,'user':_0x43ecb5,'stock':_0x3b8385,'master_shop':_0x3587b6,'unit':_0x430a98,'language':_0x139b62,'warehouses':warehouse_data,'rooms':_0x1b3cb4});}catch(_0x540a9e){console[_0xb780e3(0x1df)](_0x540a9e),_0x56313a[_0xb780e3(0x179)](0xc8)[_0xb780e3(0x1a6)]({'message':_0x540a9e[_0xb780e3(0x1a1)]});}}),router[a0_0x4aaa0d(0x1ee)](a0_0x4aaa0d(0x1c9),auth,async(_0xf6d1f1,_0x4d16c7)=>{var _0x3d090c=a0_0x4aaa0d;try{const {invoice:_0x5b5457,date:_0x4a3c77,warehouse_name:_0x4a79df,product_name:_0x5ebe49,primary_code:_0x2a2bec,secondary_code:_0x2fa2ca,product_code:_0x2a1557,sales_quantity:_0x220efe,stocks:_0x4f391c,return_qty:_0x2789bd,Room_name:_0x51faa5,to_warehouse_name:_0x4c6bce,to_Roomname:_0x28312a,to_Room_name:_0x2a86c9,note:_0x3e1003,level:_0xcc15b3,isle:_0x3a20ca,pallet:_0x20c728}=_0xf6d1f1['body'];if(typeof _0x5ebe49==_0x3d090c(0x158))var _0x3a1397=[_0xf6d1f1['body'][_0x3d090c(0x243)]],_0x1ece32=[_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x144)]],_0x59bfb9=[_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x156)]],_0x2bf274=[_0xf6d1f1[_0x3d090c(0x1bf)]['product_code']],_0x43102d=[_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x202)]],_0xf91034=[_0xf6d1f1['body']['stocks']],_0x4d3600=[_0xf6d1f1['body']['return_qty']],_0x15b7b1=[_0xf6d1f1[_0x3d090c(0x1bf)]['bay']],_0xf4a97f=[_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x16a)]],_0x535dc5=[_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x195)]],_0x4daa82=[_0xf6d1f1['body'][_0x3d090c(0x1da)]];else var _0x3a1397=[..._0xf6d1f1[_0x3d090c(0x1bf)]['product_name']],_0x1ece32=[..._0xf6d1f1[_0x3d090c(0x1bf)]['primary_code']],_0x59bfb9=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x156)]],_0x2bf274=[..._0xf6d1f1['body'][_0x3d090c(0x175)]],_0x43102d=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x202)]],_0xf91034=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x149)]],_0x4d3600=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x1f1)]],_0x15b7b1=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x1ff)]],_0xf4a97f=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x16a)]],_0x535dc5=[..._0xf6d1f1[_0x3d090c(0x1bf)]['types']],_0x4daa82=[..._0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x1da)]];const _0x4d6ca6=_0x3a1397[_0x3d090c(0x223)](_0x13b3cc=>{return _0x13b3cc={'product_name':_0x13b3cc};});_0x1ece32['forEach']((_0x4ff5b3,_0x2bd994)=>{_0x4d6ca6[_0x2bd994]['primary_code']=_0x4ff5b3;}),_0x59bfb9[_0x3d090c(0x224)]((_0xe45143,_0x53108b)=>{var _0x36a856=_0x3d090c;_0x4d6ca6[_0x53108b][_0x36a856(0x156)]=_0xe45143;}),_0x2bf274[_0x3d090c(0x224)]((_0x19c7c2,_0x3ac66c)=>{_0x4d6ca6[_0x3ac66c]['product_code']=_0x19c7c2;}),_0x43102d[_0x3d090c(0x224)]((_0x51b8ac,_0x13aa42)=>{var _0x228ea7=_0x3d090c;_0x4d6ca6[_0x13aa42][_0x228ea7(0x226)]=_0x51b8ac;}),_0xf91034[_0x3d090c(0x224)]((_0x4f1f01,_0x3bb767)=>{var _0x733316=_0x3d090c;_0x4d6ca6[_0x3bb767][_0x733316(0x14e)]=_0x4f1f01;}),_0x4d3600[_0x3d090c(0x224)]((_0xb6315f,_0x4e7f90)=>{var _0x303f51=_0x3d090c;_0x4d6ca6[_0x4e7f90][_0x303f51(0x1f1)]=_0xb6315f;}),_0x15b7b1[_0x3d090c(0x224)]((_0x420ce6,_0x477c01)=>{var _0xf4533d=_0x3d090c;_0x4d6ca6[_0x477c01][_0xf4533d(0x1ff)]=_0x420ce6;}),_0xf4a97f['forEach']((_0x5de14b,_0x402d7a)=>{var _0x2cd956=_0x3d090c;_0x4d6ca6[_0x402d7a][_0x2cd956(0x16a)]=_0x5de14b;}),_0x535dc5[_0x3d090c(0x224)]((_0x147e7d,_0x446750)=>{_0x4d6ca6[_0x446750]['type']=_0x147e7d;}),_0x4daa82[_0x3d090c(0x224)]((_0x1df639,_0x127858)=>{var _0x45dbf4=_0x3d090c;_0x4d6ca6[_0x127858][_0x45dbf4(0x1da)]=_0x1df639;});var _0x50bbbb=0x0;_0x4d6ca6[_0x3d090c(0x224)](_0x1266cc=>{var _0x342cc8=_0x3d090c;console[_0x342cc8(0x1df)](_0x342cc8(0x17b),_0x1266cc),(parseInt(_0x1266cc['sale_qty'])<parseInt(_0x1266cc['return_qty'])||parseInt(_0x1266cc['stock'])<parseInt(_0x1266cc['return_qty'])&&parseInt(_0x1266cc[_0x342cc8(0x226)])>parseInt(_0x1266cc[_0x342cc8(0x1f1)])||parseInt(_0x1266cc[_0x342cc8(0x1f1)])==0x0)&&_0x50bbbb++;});if(_0x50bbbb!=0x0)return _0xf6d1f1[_0x3d090c(0x21f)]('errors',_0x3d090c(0x1b8)),_0x4d16c7[_0x3d090c(0x242)](_0x3d090c(0x1ec));const _0x12cd38=await sales[_0x3d090c(0x1f6)]({'invoice':_0x5b5457});console[_0x3d090c(0x1df)](_0x12cd38),_0x12cd38['return_data']=_0x3d090c(0x24a);const _0x4b457b=await _0x12cd38[_0x3d090c(0x1d9)](),_0x540f66=new sales_return({'invoice':_0x5b5457,'customer':_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x1f2)],'date':_0x4a3c77,'warehouse_name':_0x4a79df,'room':_0x51faa5,'ToWarehouse':_0x4c6bce,'ToRoom':_0x2a86c9,'return_sale':_0x4d6ca6,'note':_0x3e1003}),_0x3925dd=await _0x540f66[_0x3d090c(0x1d9)]();console[_0x3d090c(0x1df)](_0x540f66);const _0x4009c5=await sales_return['findOne']({'invoice':_0x5b5457}),_0x59e261=await warehouse[_0x3d090c(0x1f6)]({'name':_0x4c6bce,'room':_0x2a86c9});_0x4009c5[_0x3d090c(0x1a8)][_0x3d090c(0x224)](_0x374271=>{var _0x4f8532=_0x3d090c,_0x138800=0x0;const _0x189838=_0x59e261[_0x4f8532(0x16d)][_0x4f8532(0x223)](_0x2d7580=>{var _0x10522f=_0x4f8532;_0x2d7580['product_name']==_0x374271[_0x10522f(0x243)]&&_0x2d7580[_0x10522f(0x1da)]==_0x374271[_0x10522f(0x1da)]&&_0x2d7580[_0x10522f(0x1a4)]==_0x374271[_0x10522f(0x1a4)]&&_0x2d7580[_0x10522f(0x16a)]==_0x374271['bin']&&_0x2d7580[_0x10522f(0x1ff)]==_0x374271[_0x10522f(0x1ff)]&&(_0x2d7580[_0x10522f(0x196)]=parseInt(_0x2d7580[_0x10522f(0x196)])+parseInt(_0x374271['return_qty']),_0x138800++);});_0x138800=='0'&&(_0x59e261[_0x4f8532(0x16d)]=_0x59e261[_0x4f8532(0x16d)]['concat']({'product_name':_0x374271[_0x4f8532(0x243)],'product_stock':_0x374271[_0x4f8532(0x1f1)],'primary_code':_0x374271[_0x4f8532(0x144)],'secondary_code':_0x374271['secondary_code'],'product_code':_0x374271[_0x4f8532(0x175)],'bay':_0x374271[_0x4f8532(0x1ff)],'bin':_0x374271['bin'],'type':_0x374271[_0x4f8532(0x1a4)],'floorlevel':_0x374271[_0x4f8532(0x1da)]})),console['log']('final',_0x59e261);}),await _0x59e261['save'](),console[_0x3d090c(0x1df)](_0xf6d1f1[_0x3d090c(0x1bf)]);const _0x475cfe=new c_payment_data({'invoice':_0x5b5457,'customer':_0xf6d1f1[_0x3d090c(0x1bf)][_0x3d090c(0x1f2)],'reason':_0x3d090c(0x1d1)});await _0x475cfe[_0x3d090c(0x1d9)]();const _0x2972a8=await master_shop[_0x3d090c(0x249)]();console[_0x3d090c(0x1df)](_0x3d090c(0x1c8),_0x2972a8[0x0][_0x3d090c(0x239)]);const _0x2cb886=await email_settings[_0x3d090c(0x1f6)](),_0x995d60=await customer['findOne']({'name':_0xf6d1f1[_0x3d090c(0x1bf)]['customer']});console['log'](_0x3d090c(0x228),_0x995d60);_0x2972a8[0x0][_0x3d090c(0x1b0)]==0x1?(right_currency=_0x2972a8[0x0][_0x3d090c(0x22f)],left_currency=''):(right_currency='',left_currency=_0x2972a8[0x0][_0x3d090c(0x22f)]);var _0x251a41=_0x3a1397,_0x49e874=_0x4d3600,_0x1ed4e5='',_0x4da7f8;for(_0x4da7f8 in _0x251a41){_0x1ed4e5+=_0x3d090c(0x17c)+_0x3d090c(0x1b4)+_0x251a41[_0x4da7f8]+_0x3d090c(0x140)+_0x3d090c(0x1b4)+_0x49e874[_0x4da7f8]+_0x3d090c(0x140)+_0x3d090c(0x19f);}console[_0x3d090c(0x1df)]('product_list',_0x1ed4e5);let _0x4226bf=nodemailer[_0x3d090c(0x191)]({'service':_0x3d090c(0x183),'auth':{'user':_0x2cb886[_0x3d090c(0x22e)],'pass':_0x2cb886['password']}}),_0x19a546={'from':_0x2cb886[_0x3d090c(0x22e)],'to':_0x995d60[_0x3d090c(0x22e)],'subject':_0x3d090c(0x1db),'attachments':[{'filename':_0x3d090c(0x159),'path':__dirname+_0x3d090c(0x1fb)+_0x3d090c(0x22d)+_0x2972a8[0x0]['image'],'cid':_0x3d090c(0x225)}],'html':_0x3d090c(0x1f4)+_0x3d090c(0x167)+_0x3d090c(0x19b)+_0x3d090c(0x187)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3d090c(0x187)+_0x3d090c(0x236)+_0x3d090c(0x1c7)+_0x3d090c(0x187)+_0x3d090c(0x1e3)+_0x2972a8[0x0][_0x3d090c(0x1a3)]+_0x3d090c(0x138)+'</div>'+_0x3d090c(0x1c7)+_0x3d090c(0x20e)+_0x3d090c(0x187)+_0x3d090c(0x17a)+_0x3d090c(0x1a9)+_0x5b5457+'\x20'+_0x3d090c(0x211)+_0x3d090c(0x146)+_0x4a3c77+'\x20'+'</span>'+'</h5>'+'</div>'+_0x3d090c(0x232)+_0x3d090c(0x198)+_0x3d090c(0x17c)+_0x3d090c(0x150)+_0x3d090c(0x181)+_0x3d090c(0x1b3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3d090c(0x19f)+_0x3d090c(0x19e)+_0x3d090c(0x244)+'\x20'+_0x1ed4e5+'\x20'+_0x3d090c(0x169)+_0x3d090c(0x178)+_0x3d090c(0x187)+'<strong>\x20Regards\x20</strong>'+_0x3d090c(0x21e)+_0x2972a8[0x0][_0x3d090c(0x1a3)]+_0x3d090c(0x1ef)+_0x3d090c(0x1c7)+_0x3d090c(0x1c7)+_0x3d090c(0x1f5)};_0x4226bf[_0x3d090c(0x245)](_0x19a546,function(_0x4ebb47,_0x47a316){var _0xc026b1=_0x3d090c;_0x4ebb47?(console['log'](_0x4ebb47),console['log'](_0xc026b1(0x1ae))):console[_0xc026b1(0x1df)](_0xc026b1(0x238));}),_0xf6d1f1['flash'](_0x3d090c(0x1eb),_0x3d090c(0x21a)),_0x4d16c7['redirect']('/all_sales/view');}catch(_0x461dd7){console[_0x3d090c(0x1df)](_0x461dd7),_0x4d16c7['status'](0xc8)[_0x3d090c(0x1a6)]({'message1':_0x461dd7['message']});}}),router[a0_0x4aaa0d(0x23d)](a0_0x4aaa0d(0x1ce),auth,async(_0x103171,_0xa8617f)=>{var _0x4a9162=a0_0x4aaa0d;try{const {username:_0x286e8c,email:_0x3c496a,role:_0x291763}=_0x103171[_0x4a9162(0x1b7)],_0x53851c=_0x103171[_0x4a9162(0x1b7)],_0x267338=await profile[_0x4a9162(0x1f6)]({'email':_0x53851c[_0x4a9162(0x22e)]}),_0x42efba=await master_shop[_0x4a9162(0x249)]();console['log'](_0x4a9162(0x1a2),_0x42efba);const _0x3a5615=_0x103171[_0x4a9162(0x16b)]['id'],_0xa71835=await sales[_0x4a9162(0x1af)](_0x3a5615);console[_0x4a9162(0x1df)](_0x4a9162(0x1c2),_0xa71835);if(_0x42efba[0x0][_0x4a9162(0x1ea)]==_0x4a9162(0x136))var _0x4ed84d=users[_0x4a9162(0x218)];else{if(_0x42efba[0x0][_0x4a9162(0x1ea)]==_0x4a9162(0x23e))var _0x4ed84d=users['Hindi'];else{if(_0x42efba[0x0][_0x4a9162(0x1ea)]=='German')var _0x4ed84d=users['German'];else{if(_0x42efba[0x0][_0x4a9162(0x1ea)]==_0x4a9162(0x1be))var _0x4ed84d=users[_0x4a9162(0x1be)];else{if(_0x42efba[0x0]['language']==_0x4a9162(0x168))var _0x4ed84d=users[_0x4a9162(0x168)];else{if(_0x42efba[0x0]['language']==_0x4a9162(0x1cf))var _0x4ed84d=users[_0x4a9162(0x166)];else{if(_0x42efba[0x0][_0x4a9162(0x1ea)]=='Chinese')var _0x4ed84d=users[_0x4a9162(0x17d)];else{if(_0x42efba[0x0][_0x4a9162(0x1ea)]==_0x4a9162(0x137))var _0x4ed84d=users[_0x4a9162(0x1b2)];}}}}}}}_0xa8617f[_0x4a9162(0x176)](_0x4a9162(0x14c),{'success':_0x103171[_0x4a9162(0x21f)](_0x4a9162(0x1eb)),'errors':_0x103171['flash'](_0x4a9162(0x19c)),'role':_0x53851c,'profile':_0x267338,'alldata':_0xa71835,'master_shop':_0x42efba,'language':_0x4ed84d});}catch(_0xd5c678){console[_0x4a9162(0x1df)](_0xd5c678);}}),router[a0_0x4aaa0d(0x1ee)](a0_0x4aaa0d(0x1fd),async(_0x2a184d,_0x2214df)=>{var _0x5c6576=a0_0x4aaa0d;const {product_code:_0x2b9d4d,warehouse_name:_0x482a81,rooms_data:_0x1350ef,Roomslist:_0x438614}=_0x2a184d[_0x5c6576(0x1bf)],_0x4b2b05=_0x438614[_0x5c6576(0x23c)](','),_0x2f2b0e=[];async function _0xc2c699(_0x9c3e9e){var _0x532814=_0x5c6576;const _0x2d303=await warehouse[_0x532814(0x174)]([{'$match':{'name':_0x482a81,'room':_0x9c3e9e}},{'$unwind':_0x532814(0x160)},{'$match':{'product_details.primary_code':_0x2b9d4d}},{'$group':{'_id':_0x532814(0x19d),'name':{'$first':_0x532814(0x19a)},'product_stock':{'$first':_0x532814(0x172)},'primary_code':{'$first':_0x532814(0x1a5)},'secondary_code':{'$first':_0x532814(0x139)},'product_code':{'$first':_0x532814(0x1f0)},'level':{'$first':_0x532814(0x147)},'isle':{'$first':_0x532814(0x180)},'type':{'$first':_0x532814(0x165)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x532814(0x161)},'storage':{'$first':_0x532814(0x17f)},'rack':{'$first':_0x532814(0x14f)},'expiry_date':{'$first':_0x532814(0x177)},'production_date':{'$first':_0x532814(0x16f)},'maxPerUnit':{'$first':_0x532814(0x214)},'batch_code':{'$first':_0x532814(0x154)},'product_cat':{'$first':_0x532814(0x240)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x532814(0x13c)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x532814(0x1d8)},'actual_uom':{'$first':_0x532814(0x16c)}}}]),_0x35f0bd=await warehouse[_0x532814(0x174)]([{'$match':{'name':_0x482a81,'room':_0x9c3e9e}},{'$unwind':_0x532814(0x160)},{'$match':{'product_details.secondary_code':_0x2b9d4d}},{'$group':{'_id':_0x532814(0x19d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x532814(0x172)},'primary_code':{'$first':_0x532814(0x1a5)},'secondary_code':{'$first':_0x532814(0x139)},'product_code':{'$first':_0x532814(0x1f0)},'level':{'$first':_0x532814(0x147)},'isle':{'$first':_0x532814(0x180)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x532814(0x17f)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x532814(0x16f)},'maxPerUnit':{'$first':_0x532814(0x214)},'batch_code':{'$first':_0x532814(0x154)},'product_cat':{'$first':_0x532814(0x240)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x532814(0x13c)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2d303[_0x532814(0x194)]>0x0)_0x2f2b0e[_0x532814(0x233)](_0x2d303);else _0x35f0bd[_0x532814(0x194)]>0x0&&_0x2f2b0e[_0x532814(0x233)](_0x35f0bd);}const _0x46ce90=_0x4b2b05[_0x5c6576(0x223)](_0x452963=>_0xc2c699(_0x452963));await Promise[_0x5c6576(0x153)](_0x46ce90),_0x2214df[_0x5c6576(0x1a6)](_0x2f2b0e);}),module[a0_0x4aaa0d(0x231)]=router;