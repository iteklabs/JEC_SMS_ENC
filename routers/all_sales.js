function a0_0x4f87(){var _0x2e8b2e=['flash','primary_code','SCRN','stock_data','level','<tbody\x20style=\x22text-align:\x20center;\x22>','staff','Ambient','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','type','note','room','/all_sales/view','secondary_code','$product_details.maxPerUnit','id_transaction_from','back','errors','Email\x20sent\x20successfully','$product_details.storage','product_data','bay','sale_product','$product_details.product_name','$product_details.expiry_date','all','prod_cat','express','<span\x20style=\x22float:\x20right;\x22>','Spanish','floorlevel','$sale_product.floorlevel','product_name','product_details','$product_details.invoice','edit_sales','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','language','bin','Sales\x20Update\x20successfully','customer_data','types','sale_qty','$product_details.isle','/barcode_scanner','customers_docs','$product_details.bin','$name','stock','Logo.png','</div>','isAllowEdit','$product_details.product_stock','final','find','product_code','$sale_product.bin','$product_details.floorlevel','Floor','Chinese','$product_details.bay','maxperunit','</body></html>','prod_invoice','False','status','body','prod_code','amount','\x20</h2>','sales_quantity','Portuguese','$finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','image','$sale_product.quantity','$note','$product_details.actual_qty','<strong>\x20Regards\x20</strong>','padStart','port','$product_details.secondary_unit','</head><body>','$isAllowEdit','/barcode/:id','$customers_docs','Return\x20Goods','$product_details._id','json','/view/:id','142OJqceh','save','Hindi','<hr\x20class=\x22my-3\x22>','success','finalize','<tr>','currency','RoomAssigned','sales\x20item\x20return\x20successfull','$invoice','actual_uom','user','/view/add_sales/:id','Enabled','$warehouse_name','</h5>','French','foreach\x20newproduct','then','$product_details.actual_uom','Arabic','Received\x20Payment\x20For\x20Sale','unit','getFullYear','purchases_data','split','Sale\x20Return\x20Mail','$product_details.batch_code','catch','exports','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Date\x20:\x20','error','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.primary_code','<h5>','max_per_unit','German','</thead>','requested_qty','get','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product','return_qty','Return\x20Rooms','Raw\x20Materials','$product_details.product_code','True','/preview/:id','all_sales_barcode','$_id','/give_payment/:id','log','max','547521pCouhF','638740JIeoQv','10143GkqwgN','message','$sale_product.bay','site_title','gmail','barcode\x20Product\x20master','logo','$product_details.pallet','<h2>\x20','/all_sales/preview/','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$sale_product','/view/add_sales','product_stock','$product_details.level','72sdmPDg','RMSEmail','aggregate','redirect','Router','English\x20(US)','$product_details.product_cat','concat','findById','payment\x20successfull','render','customer','actual_qty','<!DOCTYPE\x20html>','received_amount','batch_code','$date','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','edit_sales_view','post','warehouse_name','361236xYwtdr','customers','master','all_sales','return_sale','148792sBxIQh','sendMail','password','<div>','Arabic\x20(ae)','Sale\x20Return','stocks','date','$return_data','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.rack','$sale_product.type','slice','$product_details.type','$product_details','OUT-','room_name','delivery_date','An\x20error\x20occurred.','$room','Portuguese\x20(BR)','$product.product_name','params','nodemailer','map','abs','$product_details.production_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','51093RNGSqd','/view/return_sales/:id','findOne','getDate','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</td>','quantity_notConverted','carton','primary_unit','delivery_code','due_amount','Receiving\x20Area','push','toString','filter','_id','</tbody>','expiry_date','warehouse','email','$product','An\x20error\x20occurred\x20while\x20saving\x20data.','English','quantity','Level','</table>','../middleware/auth','storage','../public/language/languages.json','createTransport','production_date','string','add_sales','</span>','rack','role','<h5\x20style=\x22text-align:\x20left;\x22>','name','secondary_unit','barcode\x20user_id','$product_details.secondary_code','505ehAVuW'];a0_0x4f87=function(){return _0x2e8b2e;};return a0_0x4f87();}var a0_0x56a9de=a0_0x459e;function a0_0x459e(_0x3a33bc,_0x16fa7c){var _0x4f878d=a0_0x4f87();return a0_0x459e=function(_0x459ec0,_0x51a86b){_0x459ec0=_0x459ec0-0xf7;var _0xbba652=_0x4f878d[_0x459ec0];return _0xbba652;},a0_0x459e(_0x3a33bc,_0x16fa7c);}(function(_0xa7d2e2,_0x1fc4e7){var _0x2863d3=a0_0x459e,_0x3f6495=_0xa7d2e2();while(!![]){try{var _0x259afe=-parseInt(_0x2863d3(0x17e))/0x1*(-parseInt(_0x2863d3(0x1da))/0x2)+parseInt(_0x2863d3(0x10b))/0x3+parseInt(_0x2863d3(0x138))/0x4+-parseInt(_0x2863d3(0x10c))/0x5+-parseInt(_0x2863d3(0x133))/0x6+parseInt(_0x2863d3(0x10d))/0x7+parseInt(_0x2863d3(0x11d))/0x8*(parseInt(_0x2863d3(0x154))/0x9);if(_0x259afe===_0x1fc4e7)break;else _0x3f6495['push'](_0x3f6495['shift']());}catch(_0x11d822){_0x3f6495['push'](_0x3f6495['shift']());}}}(a0_0x4f87,0x1d554));const express=require(a0_0x56a9de(0x19a)),app=express(),router=express[a0_0x56a9de(0x121)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x56a9de(0x16f)),nodemailer=require(a0_0x56a9de(0x14f)),users=require(a0_0x56a9de(0x171));router['get']('/view',auth,async(_0x37e032,_0x184af3)=>{var _0x4c2924=a0_0x56a9de;try{const {username:_0xcaa666,email:_0x5c911b,role:_0x5ff209}=_0x37e032['user'],_0x149ef0=_0x37e032[_0x4c2924(0x1e6)],_0x5381cd=await profile[_0x4c2924(0x156)]({'email':_0x149ef0[_0x4c2924(0x168)]}),_0x3c96ea=await master_shop[_0x4c2924(0x1b6)]();let _0x297f69;if(_0x149ef0['role']==_0x4c2924(0x185)){const _0x8f061a=await staff[_0x4c2924(0x156)]({'email':_0x149ef0[_0x4c2924(0x168)]});_0x297f69=await sales[_0x4c2924(0x11f)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':_0x4c2924(0x1ad)}},{'$unwind':'$customers_docs'},{'$unwind':_0x4c2924(0x119)},{'$group':{'_id':_0x4c2924(0x107),'invoice':{'$first':_0x4c2924(0x1e4)},'customers':{'$first':'$customer'},'date':{'$first':_0x4c2924(0x12d)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4c2924(0x119)},'note':{'$first':_0x4c2924(0x1cc)},'return_data':{'$first':_0x4c2924(0x140)},'customers_docs':{'$first':_0x4c2924(0x1d5)},'total_saleproduct_quantity':{'$sum':_0x4c2924(0x1cb)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x4c2924(0x1b8)},'type':{'$addToSet':_0x4c2924(0x143)},'pallet':{'$addToSet':_0x4c2924(0x19e)},'finalize':{'$first':_0x4c2924(0x1c8)},'isAllowEdit':{'$first':_0x4c2924(0x1d3)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x297f69=await sales['aggregate']([{'$lookup':{'from':_0x4c2924(0x134),'localField':_0x4c2924(0x128),'foreignField':_0x4c2924(0x17a),'as':'customers_docs'}},{'$unwind':_0x4c2924(0x1d5)},{'$unwind':_0x4c2924(0x119)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4c2924(0x1e9)},'sale_product':{'$push':_0x4c2924(0x119)},'note':{'$first':'$note'},'return_data':{'$first':_0x4c2924(0x140)},'customers_docs':{'$first':_0x4c2924(0x1d5)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4c2924(0x10f)},'isle':{'$addToSet':_0x4c2924(0x1b8)},'type':{'$addToSet':_0x4c2924(0x143)},'pallet':{'$addToSet':_0x4c2924(0x19e)},'finalize':{'$first':_0x4c2924(0x1c8)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4c2924(0x109)]('sales\x20all_data',_0x297f69);if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]==_0x4c2924(0x122)){var _0x52c726=users[_0x4c2924(0x16b)];console[_0x4c2924(0x109)](_0x52c726);}else{if(_0x3c96ea[0x0]['language']==_0x4c2924(0x1dc))var _0x52c726=users[_0x4c2924(0x1dc)];else{if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]==_0x4c2924(0xf9))var _0x52c726=users[_0x4c2924(0xf9)];else{if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]=='Spanish')var _0x52c726=users[_0x4c2924(0x19c)];else{if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]=='French')var _0x52c726=users[_0x4c2924(0x1eb)];else{if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]==_0x4c2924(0x14c))var _0x52c726=users[_0x4c2924(0x1c7)];else{if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]=='Chinese')var _0x52c726=users['Chinese'];else{if(_0x3c96ea[0x0][_0x4c2924(0x1a5)]==_0x4c2924(0x13c))var _0x52c726=users[_0x4c2924(0x1ef)];}}}}}}}_0x184af3[_0x4c2924(0x127)](_0x4c2924(0x136),{'success':_0x37e032[_0x4c2924(0x17f)](_0x4c2924(0x1de)),'errors':_0x37e032[_0x4c2924(0x17f)](_0x4c2924(0x190)),'sales':_0x297f69,'profile':_0x5381cd,'role':_0x149ef0,'master_shop':_0x3c96ea,'language':_0x52c726});}catch(_0x26dd87){console['log'](_0x26dd87);}});async function getRandom8DigitNumber(){var _0x3618db=a0_0x56a9de;const _0x5d7617=0x989680,_0x4a825c=0x5f5e0ff,_0x1ac846=Math['floor'](Math['random']()*(_0x4a825c-_0x5d7617+0x1))+_0x5d7617;var _0x55f7c7;const _0x5cf904=await sales[_0x3618db(0x156)]({'invoice':_0x3618db(0x147)+_0x1ac846});return _0x5cf904&&_0x5cf904['length']>0x0?_0x55f7c7=_0x3618db(0x147)+_0x1ac846:_0x55f7c7=_0x3618db(0x147)+_0x1ac846,_0x55f7c7;}router[a0_0x56a9de(0xfc)]('/view/add_sales',auth,async(_0x11f232,_0x393660)=>{var _0x3e24e0=a0_0x56a9de;try{const {username:_0x538b56,email:_0x2ed204,role:_0x20803f}=_0x11f232[_0x3e24e0(0x1e6)],_0x1d99f2=_0x11f232[_0x3e24e0(0x1e6)],_0x5ee948=await profile[_0x3e24e0(0x156)]({'email':_0x1d99f2['email']}),_0x105f04=await master_shop[_0x3e24e0(0x1b6)](),_0x109ec1=await customer[_0x3e24e0(0x1b6)]({});let _0x586f06;if(_0x1d99f2[_0x3e24e0(0x178)]=='staff'){const _0x395f53=await staff[_0x3e24e0(0x156)]({'email':_0x1d99f2[_0x3e24e0(0x168)]});_0x586f06=await warehouse[_0x3e24e0(0x11f)]([{'$match':{'status':_0x3e24e0(0x1e8),'name':_0x395f53[_0x3e24e0(0x167)],'warehouse_category':_0x3e24e0(0x102),'name':{'$ne':_0x3e24e0(0x1d6)}}},{'$group':{'_id':_0x3e24e0(0x1af),'name':{'$first':_0x3e24e0(0x1af)}}},{'$sort':{'name':0x1}}]);}else _0x586f06=await warehouse[_0x3e24e0(0x11f)]([{'$match':{'status':'Enabled','warehouse_category':_0x3e24e0(0x102),'name':{'$ne':_0x3e24e0(0x1d6)}}},{'$group':{'_id':'$name','name':{'$first':_0x3e24e0(0x1af)}}},{'$sort':{'name':0x1}}]);const _0x2cbe4d=await product['find']({});var _0x43f7cb=[_0x3e24e0(0x186),'Enclosed'];const _0x27543e=await sales[_0x3e24e0(0x1b6)]({}),_0x2f24bb=_0x27543e['length']+0x1,_0x34657e=_0x3e24e0(0x147)+_0x2f24bb[_0x3e24e0(0x162)]()[_0x3e24e0(0x1cf)](0x5,'0');if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0x122)){var _0x409929=users['English'];console['log'](_0x409929);}else{if(_0x105f04[0x0]['language']==_0x3e24e0(0x1dc))var _0x409929=users['Hindi'];else{if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0xf9))var _0x409929=users['German'];else{if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0x19c))var _0x409929=users[_0x3e24e0(0x19c)];else{if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0x1eb))var _0x409929=users[_0x3e24e0(0x1eb)];else{if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0x14c))var _0x409929=users[_0x3e24e0(0x1c7)];else{if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0x1bb))var _0x409929=users['Chinese'];else{if(_0x105f04[0x0][_0x3e24e0(0x1a5)]==_0x3e24e0(0x13c))var _0x409929=users[_0x3e24e0(0x1ef)];}}}}}}}const _0x1b211d=getRandom8DigitNumber();_0x1b211d[_0x3e24e0(0x1ed)](_0x2dddea=>{var _0x583ba6=_0x3e24e0;_0x393660[_0x583ba6(0x127)](_0x583ba6(0x175),{'success':_0x11f232[_0x583ba6(0x17f)](_0x583ba6(0x1de)),'errors':_0x11f232['flash'](_0x583ba6(0x190)),'role':_0x1d99f2,'profile':_0x5ee948,'customer':_0x109ec1,'warehouse':_0x586f06,'product':_0x2cbe4d,'invoice':_0x2dddea,'master_shop':_0x105f04,'language':_0x409929,'rooms_data':_0x43f7cb});})[_0x3e24e0(0x1f7)](_0x181067=>{var _0x2d8e92=_0x3e24e0;_0x11f232[_0x2d8e92(0x17f)]('errors',_0x2d8e92(0x141)),_0x393660['redirect']('/all_sales/view');});}catch(_0x35832a){console[_0x3e24e0(0x109)](_0x35832a);}}),router[a0_0x56a9de(0xfc)](a0_0x56a9de(0x1e7),auth,async(_0x147216,_0x381a4e)=>{var _0x14fc11=a0_0x56a9de;try{const _0x2e62f6=_0x147216['params']['id'];console[_0x14fc11(0x109)](_0x2e62f6);const _0x5ecb39=await product[_0x14fc11(0x1b6)](),_0x1cbc70=await purchases[_0x14fc11(0x11f)]([{'$match':{'warehouse_name':_0x2e62f6}},{'$unwind':_0x14fc11(0x169)},{'$group':{'_id':_0x14fc11(0x14d)}}]);console['log'](_0x14fc11(0x1f3),_0x1cbc70),_0x381a4e[_0x14fc11(0x1c1)](0xc8)['json']({'purchases_data':_0x1cbc70,'product_data':_0x5ecb39});}catch(_0x48c49c){console['log'](_0x48c49c);}}),router[a0_0x56a9de(0x131)]('/view/add_sale/product',auth,async(_0x55c932,_0x4287fd)=>{var _0x2e7dce=a0_0x56a9de;try{const {warehouse_data:_0x269a91,product_data:_0x12e4df}=_0x55c932[_0x2e7dce(0x1c2)];console[_0x2e7dce(0x109)](_0x55c932[_0x2e7dce(0x1c2)][_0x2e7dce(0x193)]);;const _0x27adf8=await master_shop[_0x2e7dce(0x1b6)]();console['log'](_0x2e7dce(0x135),_0x27adf8);const _0x1a209c=await product[_0x2e7dce(0x156)]({'name':_0x12e4df});console[_0x2e7dce(0x109)](_0x2e7dce(0xff),_0x1a209c);const _0x2f6107=await warehouse[_0x2e7dce(0x11f)]([{'$match':{'name':_0x269a91}},{'$unwind':_0x2e7dce(0x146)},{'$match':{'product_details.product_name':_0x12e4df}},{'$group':{'_id':_0x2e7dce(0x196),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x2e7dce(0x109)](_0x2e7dce(0x182),_0x2f6107),_0x4287fd['status'](0xc8)['json']({'master':_0x27adf8,'new_product':_0x1a209c,'stock_data':_0x2f6107});}catch(_0x1c44c2){console[_0x2e7dce(0x109)](_0x1c44c2);}}),router['post'](a0_0x56a9de(0x11a),auth,async(_0x17ea8e,_0x4d4986)=>{var _0x47eb1b=a0_0x56a9de;try{const {invoice:_0x1cb81c,date:_0x2747df,warehouse_name:_0x19bbb0,product_name:_0x53418f,stock:_0x279f37,quantity:_0x204396,note:_0x3c705f,room:_0x2b24fd,primary_code:_0x479512,secondary_code:_0x5c11a6,prod_code:_0xe84489,level:_0x16f2ac,isle:_0x170697,pallet:_0x448abb,batch_code:_0x24f71c,SCRN:_0x5ef479,expiry_date:_0x540bff}=_0x17ea8e[_0x47eb1b(0x1c2)];if(typeof _0x53418f==_0x47eb1b(0x174))var _0xab2978=[_0x17ea8e['body'][_0x47eb1b(0x19f)]],_0x196fad=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1b0)]],_0x396071=[_0x17ea8e[_0x47eb1b(0x1c2)]['carton']],_0x3435eb=[_0x17ea8e[_0x47eb1b(0x1c2)]['primary_code']],_0x1cd784=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x18c)]],_0x58cdd5=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1c3)]],_0x50b7c7=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x183)]],_0x473425=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x15d)]],_0x562f34=[_0x17ea8e[_0x47eb1b(0x1c2)]['secondary_unit']],_0x1b42f4=[_0x17ea8e['body'][_0x47eb1b(0x12c)]],_0x1cf8b9=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x166)]],_0x3e21ec=[_0x17ea8e[_0x47eb1b(0x1c2)]['max_per_unit']],_0xb477ee=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x173)]],_0x1c4eb0=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0xfb)]],_0x59542d=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x149)]],_0x22c7ea=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x15e)]],_0x273345=[_0x17ea8e['body']['prod_cat']],_0xd2498a=[_0x17ea8e['body'][_0x47eb1b(0x16c)]],_0xf11fcd=[_0x17ea8e['body'][_0x47eb1b(0x1e2)]],_0x2f107b=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1bf)]],_0x56c338=[_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x129)]],_0x5b76f1=[_0x17ea8e['body'][_0x47eb1b(0x1e5)]],_0x30126e=[_0x17ea8e[_0x47eb1b(0x1c2)]['id_transact']];else var _0xab2978=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x19f)]],_0x196fad=[..._0x17ea8e['body']['stock']],_0x396071=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x15c)]],_0x3435eb=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x180)]],_0x1cd784=[..._0x17ea8e['body'][_0x47eb1b(0x18c)]],_0x58cdd5=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1c3)]],_0x50b7c7=[..._0x17ea8e[_0x47eb1b(0x1c2)]['level']],_0x473425=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x15d)]],_0x562f34=[..._0x17ea8e['body'][_0x47eb1b(0x17b)]],_0x1b42f4=[..._0x17ea8e['body'][_0x47eb1b(0x12c)]],_0x1cf8b9=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x166)]],_0x3e21ec=[..._0x17ea8e['body']['max_per_unit']],_0xb477ee=[..._0x17ea8e['body'][_0x47eb1b(0x173)]],_0x1c4eb0=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0xfb)]],_0x59542d=[..._0x17ea8e[_0x47eb1b(0x1c2)]['delivery_date']],_0x22c7ea=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x15e)]],_0x273345=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x199)]],_0xd2498a=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x16c)]],_0xf11fcd=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1e2)]],_0x2f107b=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1bf)]],_0x56c338=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x129)]],_0x5b76f1=[..._0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x1e5)]],_0x30126e=[..._0x17ea8e['body']['id_transact']];const _0x2c2891=_0xab2978[_0x47eb1b(0x150)](_0x1b9845=>{return _0x1b9845={'product_name':_0x1b9845};});_0x196fad['forEach']((_0xd14906,_0x1b057d)=>{var _0x222af9=_0x47eb1b;_0x2c2891[_0x1b057d][_0x222af9(0x1b0)]=Math['abs'](_0xd14906);}),_0x56c338[_0x47eb1b(0xfd)]((_0x5abf9d,_0x2be12e)=>{var _0x10fa5d=_0x47eb1b;_0x2c2891[_0x2be12e]['actual_qty']=Math[_0x10fa5d(0x151)](_0x5abf9d);}),_0x5b76f1[_0x47eb1b(0xfd)]((_0x4a4402,_0x21634d)=>{_0x2c2891[_0x21634d]['actual_uom']=_0x4a4402;}),_0x30126e[_0x47eb1b(0xfd)]((_0x4d74fd,_0x4e4922)=>{var _0x2a651c=_0x47eb1b;_0x2c2891[_0x4e4922][_0x2a651c(0x18e)]=_0x4d74fd;}),_0x396071[_0x47eb1b(0xfd)]((_0xc47f77,_0x3fb309)=>{var _0x1b7a6f=_0x47eb1b;_0x2c2891[_0x3fb309][_0x1b7a6f(0x16c)]=_0xc47f77;}),_0x3435eb['forEach']((_0xe6f8ee,_0x38ddd2)=>{var _0x26f441=_0x47eb1b;_0x2c2891[_0x38ddd2][_0x26f441(0x180)]=_0xe6f8ee;}),_0x1cd784[_0x47eb1b(0xfd)]((_0x1395e0,_0xf4051a)=>{var _0x1c212f=_0x47eb1b;_0x2c2891[_0xf4051a][_0x1c212f(0x18c)]=_0x1395e0;}),_0x58cdd5[_0x47eb1b(0xfd)]((_0x316fe4,_0x3a3dd3)=>{_0x2c2891[_0x3a3dd3]['product_code']=_0x316fe4;}),_0x50b7c7['forEach']((_0x38896e,_0x3e8429)=>{var _0x1cf323=_0x47eb1b;_0xf11fcd[_0x1cf323(0xfd)]((_0x3f40c7,_0x57d8a4)=>{var _0x480b73=_0x1cf323;if(_0x3f40c7==_0x480b73(0x160)&&_0x3e8429==_0x57d8a4){var _0x35e26a=_0x38896e[_0x480b73(0x144)](0x3);_0x2c2891[_0x3e8429][_0x480b73(0x170)]=_0x38896e[0x0],_0x2c2891[_0x3e8429][_0x480b73(0x177)]=_0x38896e[0x1],_0x2c2891[_0x3e8429][_0x480b73(0x194)]=0x0,_0x2c2891[_0x3e8429][_0x480b73(0x1a6)]=0x0,_0x2c2891[_0x3e8429][_0x480b73(0x188)]=_0x480b73(0x1ba),_0x2c2891[_0x3e8429][_0x480b73(0x19d)]=_0x35e26a;}else{if(_0x3f40c7=='Shelves'&&_0x3e8429==_0x57d8a4){var _0x35e26a=_0x38896e[_0x480b73(0x144)](0x3);_0x2c2891[_0x3e8429][_0x480b73(0x170)]=_0x38896e[0x0],_0x2c2891[_0x3e8429][_0x480b73(0x177)]=_0x38896e[0x1],_0x2c2891[_0x3e8429][_0x480b73(0x194)]=0x0,_0x2c2891[_0x3e8429][_0x480b73(0x1a6)]=0x0,_0x2c2891[_0x3e8429][_0x480b73(0x188)]=_0x480b73(0x1ba),_0x2c2891[_0x3e8429][_0x480b73(0x19d)]=_0x38896e[0x5];}else{if(_0x3e8429==_0x57d8a4){var _0x5d0e6c;if(_0x38896e[0x4]=='L')_0x5d0e6c=_0x480b73(0x16d);else _0x38896e[0x4]=='F'&&(_0x5d0e6c=_0x480b73(0x1ba));_0x2c2891[_0x3e8429][_0x480b73(0x170)]=_0x38896e[0x0],_0x2c2891[_0x3e8429][_0x480b73(0x177)]=_0x38896e[0x1],_0x2c2891[_0x3e8429]['bay']=_0x38896e[0x2],_0x2c2891[_0x3e8429][_0x480b73(0x1a6)]=_0x38896e[0x3],_0x2c2891[_0x3e8429][_0x480b73(0x188)]=_0x5d0e6c,_0x2c2891[_0x3e8429][_0x480b73(0x19d)]=_0x38896e[0x5];}}}});}),_0x473425['forEach']((_0x55f098,_0x3f0d33)=>{var _0x469274=_0x47eb1b;_0x2c2891[_0x3f0d33][_0x469274(0x1f1)]=_0x55f098;}),_0x562f34['forEach']((_0x1ecee4,_0x3bae14)=>{var _0x21fbc6=_0x47eb1b;_0x2c2891[_0x3bae14][_0x21fbc6(0x17b)]=_0x1ecee4;}),_0x1b42f4[_0x47eb1b(0xfd)]((_0x3b667d,_0x28035f)=>{_0x2c2891[_0x28035f]['batch_code']=_0x3b667d;}),_0x1cf8b9['forEach']((_0x258175,_0x8e4356)=>{var _0x360376=_0x47eb1b;_0x2c2891[_0x8e4356][_0x360376(0x166)]=_0x258175;}),_0x3e21ec[_0x47eb1b(0xfd)]((_0x454f40,_0x320b5c)=>{_0x2c2891[_0x320b5c]['maxperunit']=_0x454f40;}),_0xb477ee[_0x47eb1b(0xfd)]((_0x2c28ea,_0x132ce0)=>{_0x2c2891[_0x132ce0]['production_date']=_0x2c28ea;}),_0x1c4eb0['forEach']((_0x6dace6,_0x2f8c46)=>{var _0x1a02fa=_0x47eb1b;_0x2c2891[_0x2f8c46][_0x1a02fa(0xfb)]=_0x6dace6;}),_0x59542d[_0x47eb1b(0xfd)]((_0x113467,_0x158687)=>{var _0x578966=_0x47eb1b;_0x2c2891[_0x158687][_0x578966(0x149)]=_0x113467;}),_0x22c7ea[_0x47eb1b(0xfd)]((_0x508114,_0x4b64ad)=>{var _0x22c995=_0x47eb1b;_0x2c2891[_0x4b64ad][_0x22c995(0x15e)]=_0x508114;}),_0x273345['forEach']((_0x2d2d83,_0xb687cb)=>{var _0x39683f=_0x47eb1b;_0x2c2891[_0xb687cb][_0x39683f(0x199)]=_0x2d2d83;}),_0xd2498a[_0x47eb1b(0xfd)]((_0x15a423,_0x1cb0b2)=>{_0x2c2891[_0x1cb0b2]['quantity_notConverted']=_0x15a423;}),_0xf11fcd[_0x47eb1b(0xfd)]((_0x3fe3fd,_0x259874)=>{var _0x4e4875=_0x47eb1b;_0x2c2891[_0x259874][_0x4e4875(0x148)]=_0x3fe3fd;}),_0x2f107b[_0x47eb1b(0xfd)]((_0x4be227,_0x1a8b20)=>{var _0x51ba66=_0x47eb1b;_0x2c2891[_0x1a8b20][_0x51ba66(0x117)]=_0x4be227;});var _0x123f82=0x0;_0x2c2891[_0x47eb1b(0xfd)](_0x5ee9b3=>{var _0x4a934e=_0x47eb1b;(_0x5ee9b3[_0x4a934e(0x1b0)]<_0x5ee9b3[_0x4a934e(0x15b)]||_0x5ee9b3[_0x4a934e(0x15b)]==0x0)&&(console[_0x4a934e(0x109)](_0x4a934e(0x1ec),_0x5ee9b3),_0x123f82++);});const _0x4572a6=_0x2c2891[_0x47eb1b(0x163)](_0x485358=>_0x485358[_0x47eb1b(0x16c)]!=='0'&&_0x485358['quantity']!==''),_0x79260f=new sales({'invoice':_0x1cb81c,'customer':_0x17ea8e[_0x47eb1b(0x1c2)][_0x47eb1b(0x128)],'date':_0x2747df,'warehouse_name':_0x19bbb0,'sale_product':_0x4572a6,'note':_0x3c705f,'room':_0x2b24fd,'primary_code':_0x479512,'secondary_code':_0x5c11a6,'prod_code':_0xe84489,'SCRN':_0x5ef479}),_0x55d3a1=await _0x79260f[_0x47eb1b(0x1db)]();_0x17ea8e[_0x47eb1b(0x17f)](_0x47eb1b(0x1de),'Sales\x20Add\x20successfully'),_0x4d4986['redirect']('/all_sales/preview/'+_0x55d3a1[_0x47eb1b(0x164)]);}catch(_0x368b77){console[_0x47eb1b(0x109)](_0x368b77);}}),router[a0_0x56a9de(0xfc)](a0_0x56a9de(0x105),auth,async(_0x2d9fd7,_0x2384fa)=>{var _0x22da80=a0_0x56a9de;try{const {username:_0x25fad0,email:_0x217c3d,role:_0x198b1f}=_0x2d9fd7[_0x22da80(0x1e6)],_0x5359e=_0x2d9fd7[_0x22da80(0x1e6)],_0xe57af7=await profile[_0x22da80(0x156)]({'email':_0x5359e[_0x22da80(0x168)]}),_0x574f20=await master_shop[_0x22da80(0x1b6)](),_0x2ccf5c=_0x2d9fd7[_0x22da80(0x14e)]['id'],_0x44734a=await sales[_0x22da80(0x125)](_0x2ccf5c),_0x43ae56=await warehouse[_0x22da80(0x11f)]([{'$match':{'name':_0x44734a['warehouse_name']}},{'$unwind':_0x22da80(0x146)},{'$group':{'_id':_0x22da80(0x1d7),'name':{'$first':_0x22da80(0x196)},'product_stock':{'$first':_0x22da80(0x1b4)},'bay':{'$first':_0x22da80(0x1bc)},'bin':{'$first':_0x22da80(0x1ae)},'type':{'$first':_0x22da80(0x145)},'floorlevel':{'$first':_0x22da80(0x1b9)},'primary_code':{'$first':_0x22da80(0x1fd)},'secondary_code':{'$first':_0x22da80(0x17d)},'product_code':{'$first':_0x22da80(0x103)},'storage':{'$first':_0x22da80(0x192)},'rack':{'$first':_0x22da80(0x142)},'expiry_date':{'$first':_0x22da80(0x197)},'production_date':{'$first':_0x22da80(0x152)},'invoice':{'$first':_0x22da80(0x1a1)}}}]),_0x430c2e=await customer[_0x22da80(0x1b6)]({});let _0x43bce4;if(_0x5359e[_0x22da80(0x178)]==_0x22da80(0x185)){const _0x2ed317=await staff['findOne']({'email':_0x5359e[_0x22da80(0x168)]});_0x43bce4=await warehouse[_0x22da80(0x11f)]([{'$match':{'status':_0x22da80(0x1e8),'name':_0x2ed317[_0x22da80(0x167)]}},{'$group':{'_id':_0x22da80(0x1af),'name':{'$first':_0x22da80(0x1af)}}}]);}else _0x43bce4=await warehouse['aggregate']([{'$match':{'status':_0x22da80(0x1e8)}},{'$group':{'_id':_0x22da80(0x1af),'name':{'$first':_0x22da80(0x1af)}}}]);const _0x4529c1=await product[_0x22da80(0x1b6)]({}),_0x481acc=await suppliers['find']({});if(_0x574f20[0x0][_0x22da80(0x1a5)]==_0x22da80(0x122)){var _0x42f180=users[_0x22da80(0x16b)];console['log'](_0x42f180);}else{if(_0x574f20[0x0]['language']==_0x22da80(0x1dc))var _0x42f180=users['Hindi'];else{if(_0x574f20[0x0][_0x22da80(0x1a5)]=='German')var _0x42f180=users[_0x22da80(0xf9)];else{if(_0x574f20[0x0][_0x22da80(0x1a5)]==_0x22da80(0x19c))var _0x42f180=users[_0x22da80(0x19c)];else{if(_0x574f20[0x0]['language']==_0x22da80(0x1eb))var _0x42f180=users[_0x22da80(0x1eb)];else{if(_0x574f20[0x0][_0x22da80(0x1a5)]=='Portuguese\x20(BR)')var _0x42f180=users['Portuguese'];else{if(_0x574f20[0x0][_0x22da80(0x1a5)]==_0x22da80(0x1bb))var _0x42f180=users[_0x22da80(0x1bb)];else{if(_0x574f20[0x0][_0x22da80(0x1a5)]=='Arabic\x20(ae)')var _0x42f180=users[_0x22da80(0x1ef)];}}}}}}}_0x2384fa[_0x22da80(0x127)](_0x22da80(0x130),{'success':_0x2d9fd7['flash']('success'),'errors':_0x2d9fd7[_0x22da80(0x17f)](_0x22da80(0x190)),'role':_0x5359e,'profile':_0xe57af7,'customer':_0x430c2e,'warehouse':_0x43bce4,'product':_0x43ae56,'user':_0x44734a,'master_shop':_0x574f20,'unit':_0x4529c1,'language':_0x42f180,'suppliers':_0x481acc});}catch(_0x256b28){console[_0x22da80(0x109)](_0x256b28);}}),router['post'](a0_0x56a9de(0x105),auth,async(_0x1105f5,_0xa52156)=>{var _0x30eec7=a0_0x56a9de;try{const _0x118013=_0x1105f5[_0x30eec7(0x14e)]['id'],{invoice:_0x183bb0,warehouse_name:_0x2882db,room:_0x4fe173}=_0x1105f5[_0x30eec7(0x1c2)],_0xc0cd36=await sales[_0x30eec7(0x156)]({'invoice':_0x183bb0}),_0x46b358=_0xc0cd36[_0x30eec7(0x195)][_0x30eec7(0x150)](async _0x117310=>{var _0x6e5e8=_0x30eec7,_0x40622a=await warehouse[_0x6e5e8(0x156)]({'name':_0x2882db,'room':_0x117310[_0x6e5e8(0x148)],'warehouse_category':_0x6e5e8(0x102)});const _0x30575c=_0x40622a['product_details'][_0x6e5e8(0x150)](_0x3987ff=>{var _0x196dd5=_0x6e5e8;_0x3987ff[_0x196dd5(0x19f)]==_0x117310['product_name']&&_0x3987ff['floorlevel']==_0x117310[_0x196dd5(0x19d)]&&_0x3987ff[_0x196dd5(0x188)]==_0x117310[_0x196dd5(0x188)]&&_0x3987ff[_0x196dd5(0x1a6)]==_0x117310['bin']&&_0x3987ff['bay']==_0x117310[_0x196dd5(0x194)]&&_0x3987ff[_0x196dd5(0x177)]==_0x117310[_0x196dd5(0x177)]&&_0x3987ff[_0x196dd5(0x170)]==_0x117310[_0x196dd5(0x170)]&&_0x3987ff[_0x196dd5(0x166)]==_0x117310['expiry_date']&&_0x3987ff[_0x196dd5(0x12c)]==_0x117310[_0x196dd5(0x12c)]&&_0x3987ff[_0x196dd5(0x117)]==_0x117310[_0x196dd5(0x117)]&&_0x3987ff[_0x196dd5(0x164)]==_0x117310[_0x196dd5(0x18e)]&&(_0x3987ff[_0x196dd5(0x11b)]=Math[_0x196dd5(0x10a)](0x0,Math[_0x196dd5(0x151)](_0x3987ff[_0x196dd5(0x11b)])-Math[_0x196dd5(0x151)](_0x117310['quantity'])));});return _0x40622a;});Promise[_0x30eec7(0x198)](_0x46b358)['then'](async _0x2416b6=>{var _0x58e929=_0x30eec7;try{for(const _0x20cdcf of _0x2416b6){await _0x20cdcf[_0x58e929(0x1db)]();}_0xc0cd36[_0x58e929(0x1df)]=_0x58e929(0x104);const _0x10111a=await _0xc0cd36[_0x58e929(0x1db)](),_0x32ceac=await master_shop[_0x58e929(0x1b6)](),_0x1cef97=await email_settings[_0x58e929(0x156)](),_0x5b41a2=await supervisor_settings[_0x58e929(0x1b6)]();var _0xffd4de=_0xc0cd36[_0x58e929(0x195)],_0x28d59b='',_0x36257d;for(_0x36257d in _0xffd4de){_0x28d59b+=_0x58e929(0x1e0)+_0x58e929(0x153)+_0xffd4de[_0x36257d][_0x58e929(0x19f)]+_0x58e929(0x15a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xffd4de[_0x36257d][_0x58e929(0x1b7)]+_0x58e929(0x15a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xffd4de[_0x36257d][_0x58e929(0x16c)]+_0x58e929(0x15a)+_0x58e929(0x153)+_0xffd4de[_0x36257d][_0x58e929(0x1f1)]+_0x58e929(0x15a)+_0x58e929(0x153)+_0xffd4de[_0x36257d]['secondary_unit']+_0x58e929(0x15a)+_0x58e929(0x153)+_0xc0cd36[_0x58e929(0x132)]+_0x58e929(0x15a)+_0x58e929(0x153)+_0xffd4de[_0x36257d][_0x58e929(0x148)]+_0x58e929(0x15a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xffd4de[_0x36257d]['storage']+_0xffd4de[_0x36257d][_0x58e929(0x177)]+_0xffd4de[_0x36257d][_0x58e929(0x194)]+_0xffd4de[_0x36257d][_0x58e929(0x1a6)]+_0xffd4de[_0x36257d][_0x58e929(0x188)][0x0]+_0xffd4de[_0x36257d][_0x58e929(0x19d)]+_0x58e929(0x15a),'</tr>';}let _0x34a463=nodemailer['createTransport']({'host':_0x1cef97['host'],'port':Number(_0x1cef97[_0x58e929(0x1d0)]),'secure':![],'auth':{'user':_0x1cef97[_0x58e929(0x168)],'pass':_0x1cef97[_0x58e929(0x13a)]}}),_0x5b7dc7={'from':_0x1cef97['email'],'to':_0x5b41a2[0x0][_0x58e929(0x11e)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x58e929(0x1b1),'path':__dirname+_0x58e929(0x12e)+'/upload/'+_0x32ceac[0x0]['image'],'cid':_0x58e929(0x113)}],'html':_0x58e929(0x12a)+'<html><head><title></title>'+_0x58e929(0x1d2)+_0x58e929(0x13b)+_0x58e929(0x1a3)+_0x58e929(0x13b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x58e929(0x13b)+_0x58e929(0x115)+_0x32ceac[0x0]['site_title']+_0x58e929(0x1c5)+_0x58e929(0x1b2)+_0x58e929(0x1b2)+_0x58e929(0x1dd)+_0x58e929(0x13b)+_0x58e929(0x179)+'\x20Order\x20Number\x20:\x20'+_0xc0cd36[_0x58e929(0x117)]+'\x20'+_0x58e929(0x19b)+_0x58e929(0x1fa)+_0xc0cd36[_0x58e929(0x13f)]+'\x20'+'</span>'+_0x58e929(0x1ea)+_0x58e929(0x1b2)+_0x58e929(0x1fc)+_0x58e929(0x1f9)+_0x58e929(0x1e0)+_0x58e929(0x1a4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x58e929(0xfe)+_0x58e929(0x1c9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x58e929(0x159)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x58e929(0xfa)+_0x58e929(0x184)+'\x20'+_0x28d59b+'\x20'+'</tbody>'+_0x58e929(0x16e)+'<div>'+_0x58e929(0x1ce)+_0x58e929(0xf7)+_0x32ceac[0x0][_0x58e929(0x110)]+_0x58e929(0x1ea)+_0x58e929(0x1b2)+_0x58e929(0x1b2)+_0x58e929(0x1be)};_0x34a463[_0x58e929(0x139)](_0x5b7dc7,function(_0x27f1c7,_0x11fde2){var _0x1cd002=_0x58e929;_0x27f1c7?(console[_0x1cd002(0x109)](_0x27f1c7),console[_0x1cd002(0x109)]('Error\x20Occurs')):console['log'](_0x1cd002(0x191));}),_0x1105f5[_0x58e929(0x17f)]('success',_0x58e929(0x1a7)),_0xa52156[_0x58e929(0x120)](_0x58e929(0x116)+_0x118013);}catch(_0x4a2d25){console[_0x58e929(0x1fb)](_0x4a2d25),_0xa52156[_0x58e929(0x1c1)](0x1f4)['json']({'error':_0x58e929(0x16a)});}})['catch'](_0xb04425=>{var _0x13bfe3=_0x30eec7;console[_0x13bfe3(0x1fb)](_0xb04425),_0xa52156[_0x13bfe3(0x1c1)](0x1f4)[_0x13bfe3(0x1d8)]({'error':_0x13bfe3(0x14a)});});}catch(_0x30dedf){console[_0x30eec7(0x109)](_0x30dedf);}}),router[a0_0x56a9de(0xfc)](a0_0x56a9de(0x1d9),auth,async(_0x587964,_0x5386af)=>{var _0x3075b3=a0_0x56a9de;try{const {username:_0x11a791,email:_0x883f64,role:_0x2f5102}=_0x587964['user'],_0x333e39=_0x587964[_0x3075b3(0x1e6)],_0x385e2a=await profile[_0x3075b3(0x156)]({'email':_0x333e39[_0x3075b3(0x168)]}),_0xf8152c=await master_shop[_0x3075b3(0x1b6)](),_0x249ff7=_0x587964[_0x3075b3(0x14e)]['id'],_0x3f1ee5=await sales[_0x3075b3(0x125)](_0x249ff7);var _0x4fc3f6=[_0x3075b3(0x186),'Enclosed'];const _0x27b1d2=await warehouse[_0x3075b3(0x11f)]([{'$match':{'name':_0x3f1ee5[_0x3075b3(0x132)],'warehouse_category':_0x3075b3(0x102)}},{'$unwind':_0x3075b3(0x146)},{'$group':{'_id':_0x3075b3(0x1d7),'name':{'$first':_0x3075b3(0x196)},'product_stock':{'$first':_0x3075b3(0x1b4)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3075b3(0x145)},'floorlevel':{'$first':_0x3075b3(0x1b9)},'primary_code':{'$first':_0x3075b3(0x1fd)},'secondary_code':{'$first':_0x3075b3(0x17d)},'product_code':{'$first':_0x3075b3(0x103)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3075b3(0x142)}}}]),_0x5655c4=await customer[_0x3075b3(0x1b6)]({});let _0x52f3da;if(_0x333e39[_0x3075b3(0x178)]==_0x3075b3(0x185)){const _0x548926=await staff['findOne']({'email':_0x333e39[_0x3075b3(0x168)]});_0x52f3da=await warehouse[_0x3075b3(0x11f)]([{'$match':{'status':_0x3075b3(0x1e8),'name':_0x548926[_0x3075b3(0x167)],'warehouse_category':_0x3075b3(0x102)}},{'$group':{'_id':'$name','name':{'$first':_0x3075b3(0x1af)}}}]);}else _0x52f3da=await warehouse[_0x3075b3(0x11f)]([{'$match':{'status':'Enabled','warehouse_category':_0x3075b3(0x102)}},{'$group':{'_id':'$name','name':{'$first':_0x3075b3(0x1af)}}}]);const _0x2b5f0a=await product[_0x3075b3(0x1b6)]({});if(_0xf8152c[0x0][_0x3075b3(0x1a5)]==_0x3075b3(0x122)){var _0x8aa370=users[_0x3075b3(0x16b)];console[_0x3075b3(0x109)](_0x8aa370);}else{if(_0xf8152c[0x0]['language']==_0x3075b3(0x1dc))var _0x8aa370=users[_0x3075b3(0x1dc)];else{if(_0xf8152c[0x0][_0x3075b3(0x1a5)]==_0x3075b3(0xf9))var _0x8aa370=users[_0x3075b3(0xf9)];else{if(_0xf8152c[0x0][_0x3075b3(0x1a5)]==_0x3075b3(0x19c))var _0x8aa370=users[_0x3075b3(0x19c)];else{if(_0xf8152c[0x0]['language']==_0x3075b3(0x1eb))var _0x8aa370=users[_0x3075b3(0x1eb)];else{if(_0xf8152c[0x0]['language']=='Portuguese\x20(BR)')var _0x8aa370=users['Portuguese'];else{if(_0xf8152c[0x0][_0x3075b3(0x1a5)]==_0x3075b3(0x1bb))var _0x8aa370=users[_0x3075b3(0x1bb)];else{if(_0xf8152c[0x0][_0x3075b3(0x1a5)]=='Arabic\x20(ae)')var _0x8aa370=users[_0x3075b3(0x1ef)];}}}}}}}_0x5386af[_0x3075b3(0x127)](_0x3075b3(0x1a2),{'success':_0x587964[_0x3075b3(0x17f)]('success'),'errors':_0x587964[_0x3075b3(0x17f)](_0x3075b3(0x190)),'role':_0x333e39,'profile':_0x385e2a,'customer':_0x5655c4,'warehouse':_0x52f3da,'product':_0x27b1d2,'user':_0x3f1ee5,'master_shop':_0xf8152c,'unit':_0x2b5f0a,'language':_0x8aa370});}catch(_0x47f925){console[_0x3075b3(0x109)](_0x47f925);}}),router[a0_0x56a9de(0x131)]('/view/:id',auth,async(_0x5c07e6,_0x39435c)=>{var _0x50f421=a0_0x56a9de;try{const _0xa643fa=_0x5c07e6[_0x50f421(0x14e)]['id'],_0x211cfa=await sales[_0x50f421(0x156)]({'_id':_0x5c07e6['params']['id']}),_0xfe8b93=await warehouse['findOne']({'name':_0x211cfa[_0x50f421(0x132)],'room':_0x5c07e6['body'][_0x50f421(0x18a)]}),{invoice:_0x5f523f,date:_0x3d9e81,warehouse_name:_0x3ce15c,product_name:_0xe7b27b,stock:_0x184935,quantity:_0x164213,note:_0x1a8129,room:_0x5c84cb,customer:_0x3ef794,SCRN:_0xeb784b}=_0x5c07e6[_0x50f421(0x1c2)];if(typeof _0xe7b27b==_0x50f421(0x174))var _0x5770c3=[_0x5c07e6['body'][_0x50f421(0x19f)]],_0x21cd8d=[_0x5c07e6[_0x50f421(0x1c2)]['stock']],_0x4c1775=[_0x5c07e6['body'][_0x50f421(0x15c)]],_0x3eb446=[_0x5c07e6[_0x50f421(0x1c2)]['primary_code']],_0x26e794=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x18c)]],_0x471c21=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x1c3)]],_0x52e0a8=[_0x5c07e6['body'][_0x50f421(0x183)]],_0x39f356=[_0x5c07e6[_0x50f421(0x1c2)]['primary_unit']],_0x33f8e4=[_0x5c07e6['body']['secondary_unit']],_0x50456e=[_0x5c07e6['body'][_0x50f421(0x12c)]],_0x2b7fa6=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x166)]],_0x33dfc1=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0xf8)]],_0x5a0899=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x173)]],_0x33ebe2=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0xfb)]],_0x37366e=[_0x5c07e6['body']['delivery_date']],_0x34eadd=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x15e)]],_0x36e3e2=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x199)]],_0xec14d9=[_0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x16c)]],_0x42f8cc=[_0x5c07e6['body'][_0x50f421(0x1e2)]];else var _0x5770c3=[..._0x5c07e6[_0x50f421(0x1c2)]['product_name']],_0x21cd8d=[..._0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x1b0)]],_0x4c1775=[..._0x5c07e6[_0x50f421(0x1c2)]['carton']],_0x3eb446=[..._0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x180)]],_0x26e794=[..._0x5c07e6[_0x50f421(0x1c2)]['secondary_code']],_0x471c21=[..._0x5c07e6[_0x50f421(0x1c2)]['prod_code']],_0x52e0a8=[..._0x5c07e6['body'][_0x50f421(0x183)]],_0x39f356=[..._0x5c07e6[_0x50f421(0x1c2)]['primary_unit']],_0x33f8e4=[..._0x5c07e6['body'][_0x50f421(0x17b)]],_0x50456e=[..._0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x12c)]],_0x2b7fa6=[..._0x5c07e6[_0x50f421(0x1c2)]['expiry_date']],_0x33dfc1=[..._0x5c07e6['body']['max_per_unit']],_0x5a0899=[..._0x5c07e6['body'][_0x50f421(0x173)]],_0x33ebe2=[..._0x5c07e6['body'][_0x50f421(0xfb)]],_0x37366e=[..._0x5c07e6['body'][_0x50f421(0x149)]],_0x34eadd=[..._0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x15e)]],_0x36e3e2=[..._0x5c07e6[_0x50f421(0x1c2)]['prod_cat']],_0xec14d9=[..._0x5c07e6['body'][_0x50f421(0x16c)]],_0x42f8cc=[..._0x5c07e6[_0x50f421(0x1c2)][_0x50f421(0x1e2)]];const _0x2138f1=_0x5770c3[_0x50f421(0x150)](_0x10bc36=>{return _0x10bc36={'product_name':_0x10bc36};});_0x21cd8d[_0x50f421(0xfd)]((_0x1aafb2,_0x51b854)=>{var _0x1ce53d=_0x50f421;_0x2138f1[_0x51b854][_0x1ce53d(0x1b0)]=Math[_0x1ce53d(0x151)](_0x1aafb2);}),_0x4c1775[_0x50f421(0xfd)]((_0x52486f,_0x4d2529)=>{var _0x38a565=_0x50f421;_0x2138f1[_0x4d2529][_0x38a565(0x16c)]=_0x52486f;}),_0x3eb446[_0x50f421(0xfd)]((_0x52e818,_0x162e53)=>{_0x2138f1[_0x162e53]['primary_code']=_0x52e818;}),_0x26e794[_0x50f421(0xfd)]((_0x4ac66e,_0x1937b4)=>{var _0xcacfe1=_0x50f421;_0x2138f1[_0x1937b4][_0xcacfe1(0x18c)]=_0x4ac66e;}),_0x471c21[_0x50f421(0xfd)]((_0x51dfd7,_0x19768e)=>{_0x2138f1[_0x19768e]['product_code']=_0x51dfd7;}),_0x52e0a8[_0x50f421(0xfd)]((_0x4e762a,_0x1d6f0e)=>{_0x42f8cc['forEach']((_0x3811a7,_0x497926)=>{var _0x1e951b=a0_0x459e;if(_0x3811a7==_0x1e951b(0x160)&&_0x1d6f0e==_0x497926){var _0xf2b514=_0x4e762a[_0x1e951b(0x144)](0x3);_0x2138f1[_0x1d6f0e][_0x1e951b(0x170)]=_0x4e762a[0x0],_0x2138f1[_0x1d6f0e]['rack']=_0x4e762a[0x1],_0x2138f1[_0x1d6f0e]['bay']=0x0,_0x2138f1[_0x1d6f0e][_0x1e951b(0x1a6)]=0x0,_0x2138f1[_0x1d6f0e]['type']=_0x1e951b(0x1ba),_0x2138f1[_0x1d6f0e][_0x1e951b(0x19d)]=_0xf2b514;}else{if(_0x3811a7=='Shelves'&&_0x1d6f0e==_0x497926){var _0xf2b514=_0x4e762a[_0x1e951b(0x144)](0x3);_0x2138f1[_0x1d6f0e][_0x1e951b(0x170)]=_0x4e762a[0x0],_0x2138f1[_0x1d6f0e]['rack']=_0x4e762a[0x1],_0x2138f1[_0x1d6f0e][_0x1e951b(0x194)]=0x0,_0x2138f1[_0x1d6f0e]['bin']=0x0,_0x2138f1[_0x1d6f0e]['type']=_0x1e951b(0x1ba),_0x2138f1[_0x1d6f0e][_0x1e951b(0x19d)]=_0x4e762a[0x5];}else{if(_0x1d6f0e==_0x497926){var _0x34d6ad;if(_0x4e762a[0x4]=='L')_0x34d6ad=_0x1e951b(0x16d);else _0x4e762a[0x4]=='F'&&(_0x34d6ad=_0x1e951b(0x1ba));_0x2138f1[_0x1d6f0e][_0x1e951b(0x170)]=_0x4e762a[0x0],_0x2138f1[_0x1d6f0e][_0x1e951b(0x177)]=_0x4e762a[0x1],_0x2138f1[_0x1d6f0e][_0x1e951b(0x194)]=_0x4e762a[0x2],_0x2138f1[_0x1d6f0e]['bin']=_0x4e762a[0x3],_0x2138f1[_0x1d6f0e][_0x1e951b(0x188)]=_0x34d6ad,_0x2138f1[_0x1d6f0e][_0x1e951b(0x19d)]=_0x4e762a[0x5];}}}});}),_0x39f356[_0x50f421(0xfd)]((_0x110c2d,_0x1b9b3e)=>{_0x2138f1[_0x1b9b3e]['unit']=_0x110c2d;}),_0x33f8e4[_0x50f421(0xfd)]((_0x2f20d3,_0x2e97d4)=>{var _0x343e3e=_0x50f421;_0x2138f1[_0x2e97d4][_0x343e3e(0x17b)]=_0x2f20d3;}),_0x50456e[_0x50f421(0xfd)]((_0x41e11e,_0x49b93c)=>{var _0x24bd2b=_0x50f421;_0x2138f1[_0x49b93c][_0x24bd2b(0x12c)]=_0x41e11e;}),_0x2b7fa6['forEach']((_0x2fd527,_0x156fcd)=>{_0x2138f1[_0x156fcd]['expiry_date']=_0x2fd527;}),_0x33dfc1[_0x50f421(0xfd)]((_0x3a9ee0,_0x443ca4)=>{var _0x55ade8=_0x50f421;_0x2138f1[_0x443ca4][_0x55ade8(0x1bd)]=_0x3a9ee0;}),_0x5a0899[_0x50f421(0xfd)]((_0x8f9c46,_0xefc18b)=>{_0x2138f1[_0xefc18b]['production_date']=_0x8f9c46;}),_0x33ebe2[_0x50f421(0xfd)]((_0x4f5270,_0xe08f2f)=>{var _0x4c0714=_0x50f421;_0x2138f1[_0xe08f2f][_0x4c0714(0xfb)]=Math[_0x4c0714(0x151)](_0x4f5270);}),_0x37366e[_0x50f421(0xfd)]((_0x1e8fa8,_0xe7182e)=>{_0x2138f1[_0xe7182e]['delivery_date']=_0x1e8fa8;}),_0x34eadd[_0x50f421(0xfd)]((_0x356b59,_0x257a11)=>{var _0x390fd9=_0x50f421;_0x2138f1[_0x257a11][_0x390fd9(0x15e)]=_0x356b59;}),_0x36e3e2['forEach']((_0x14bb31,_0x55ba89)=>{var _0xd66f3=_0x50f421;_0x2138f1[_0x55ba89][_0xd66f3(0x199)]=_0x14bb31;}),_0xec14d9[_0x50f421(0xfd)]((_0x3f433d,_0x120522)=>{var _0x1acb9b=_0x50f421;_0x2138f1[_0x120522][_0x1acb9b(0x15b)]=_0x3f433d;}),_0x42f8cc[_0x50f421(0xfd)]((_0x564d62,_0x5e46e9)=>{var _0x639247=_0x50f421;_0x2138f1[_0x5e46e9][_0x639247(0x148)]=_0x564d62;});var _0x31a27e=0x0;_0x2138f1[_0x50f421(0xfd)](_0x466e8f=>{var _0x251ea0=_0x50f421;console[_0x251ea0(0x109)](_0x251ea0(0x1ec),_0x466e8f),(parseInt(_0x466e8f[_0x251ea0(0x1b0)])<parseInt(_0x466e8f[_0x251ea0(0x16c)])||parseInt(_0x466e8f[_0x251ea0(0x16c)])==0x0)&&_0x31a27e++;});if(_0x31a27e!=0x0)return _0x5c07e6['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x39435c['redirect']('back');const _0x1cfc79=_0x2138f1[_0x50f421(0x163)](_0x914270=>_0x914270[_0x50f421(0x16c)]!=='0'&&_0x914270[_0x50f421(0x16c)]!=='');_0x211cfa[_0x50f421(0x117)]=_0x5f523f,_0x211cfa[_0x50f421(0x128)]=_0x3ef794,_0x211cfa[_0x50f421(0x13f)]=_0x3d9e81,_0x211cfa[_0x50f421(0x132)]=_0x3ce15c,_0x211cfa['sale_product']=_0x1cfc79,_0x211cfa[_0x50f421(0x189)]=_0x1a8129,_0x211cfa[_0x50f421(0x181)]=_0xeb784b,_0x211cfa[_0x50f421(0x1df)]=_0x50f421(0x1c0),_0x211cfa[_0x50f421(0x1b3)]=_0x50f421(0x1c0);const _0x3dcc16=await _0x211cfa[_0x50f421(0x1db)]();_0x5c07e6[_0x50f421(0x17f)](_0x50f421(0x1de),_0x50f421(0x1a7)),_0x39435c[_0x50f421(0x120)](_0x50f421(0x18b));}catch(_0x394c96){console['log'](_0x394c96);}}),router[a0_0x56a9de(0x131)](a0_0x56a9de(0x108),auth,async(_0x19e2b7,_0x42cc55)=>{var _0x26bc1b=a0_0x56a9de;try{const _0x100e82=_0x19e2b7[_0x26bc1b(0x14e)]['id'],{invoice:_0x534639,customer:_0x6a4989,receivable_amount:_0x30a6b5,received_amount:_0xeb1b2f}=_0x19e2b7['body'],_0x173ac0=await sales['findById'](_0x100e82);console[_0x26bc1b(0x109)](_0x173ac0);var _0x5825bd=_0x30a6b5-_0xeb1b2f;console['log'](_0xeb1b2f),_0x173ac0[_0x26bc1b(0x12b)]=parseFloat(_0xeb1b2f)+parseFloat(_0x173ac0[_0x26bc1b(0x12b)]),_0x173ac0[_0x26bc1b(0x15f)]=_0x5825bd,console[_0x26bc1b(0x109)](_0x173ac0);const _0x5bd2ae=await _0x173ac0[_0x26bc1b(0x1db)](),_0x5c86ac=await c_payment_data[_0x26bc1b(0x156)]({'invoice':_0x534639});_0x5c86ac[_0x26bc1b(0x1c4)]=_0x5825bd,await _0x5c86ac[_0x26bc1b(0x1db)]();let _0xb3673e=new Date(),_0x17c4e3=('0'+_0xb3673e[_0x26bc1b(0x157)]())[_0x26bc1b(0x144)](-0x2),_0x19c10f=('0'+(_0xb3673e['getMonth']()+0x1))[_0x26bc1b(0x144)](-0x2),_0x5e3304=_0xb3673e[_0x26bc1b(0x1f2)](),_0x241836=_0x5e3304+'-'+_0x19c10f+'-'+_0x17c4e3;const _0x4294eb=new customer_payment({'invoice':_0x534639,'date':_0x5e3304+'-'+_0x19c10f+'-'+_0x17c4e3,'customer':_0x6a4989,'reason':_0x26bc1b(0x1f0),'amount':_0xeb1b2f}),_0x1ffb6f=await _0x4294eb['save']();_0x19e2b7[_0x26bc1b(0x17f)](_0x26bc1b(0x1de),_0x26bc1b(0x126)),_0x42cc55[_0x26bc1b(0x120)](_0x26bc1b(0x18b));}catch(_0x113ea4){console[_0x26bc1b(0x109)](_0x113ea4);}}),router[a0_0x56a9de(0xfc)]('/invoice/:id',auth,async(_0x5135fa,_0x4e97ac)=>{var _0x4b4f91=a0_0x56a9de;try{const {username:_0x3c175f,email:_0x561956,role:_0xea1eb}=_0x5135fa['user'],_0x4764d5=_0x5135fa[_0x4b4f91(0x1e6)],_0xebe502=await profile[_0x4b4f91(0x156)]({'email':_0x4764d5[_0x4b4f91(0x168)]}),_0x4d8db8=await master_shop[_0x4b4f91(0x1b6)]();console[_0x4b4f91(0x109)](_0x4b4f91(0x135),_0x4d8db8);const _0x744e7d=_0x5135fa['params']['id'],_0xe373c2=await sales['findById'](_0x744e7d);console['log'](_0xe373c2);const _0x5dcd15=await customer[_0x4b4f91(0x156)]({'name':_0xe373c2[_0x4b4f91(0x128)]});console[_0x4b4f91(0x109)](_0x5dcd15);if(_0x4d8db8[0x0][_0x4b4f91(0x1a5)]==_0x4b4f91(0x122)){var _0x8a68cd=users[_0x4b4f91(0x16b)];console['log'](_0x8a68cd);}else{if(_0x4d8db8[0x0][_0x4b4f91(0x1a5)]==_0x4b4f91(0x1dc))var _0x8a68cd=users[_0x4b4f91(0x1dc)];else{if(_0x4d8db8[0x0][_0x4b4f91(0x1a5)]==_0x4b4f91(0xf9))var _0x8a68cd=users[_0x4b4f91(0xf9)];else{if(_0x4d8db8[0x0]['language']==_0x4b4f91(0x19c))var _0x8a68cd=users[_0x4b4f91(0x19c)];else{if(_0x4d8db8[0x0]['language']=='French')var _0x8a68cd=users[_0x4b4f91(0x1eb)];else{if(_0x4d8db8[0x0][_0x4b4f91(0x1a5)]=='Portuguese\x20(BR)')var _0x8a68cd=users[_0x4b4f91(0x1c7)];else{if(_0x4d8db8[0x0][_0x4b4f91(0x1a5)]==_0x4b4f91(0x1bb))var _0x8a68cd=users[_0x4b4f91(0x1bb)];else{if(_0x4d8db8[0x0][_0x4b4f91(0x1a5)]==_0x4b4f91(0x13c))var _0x8a68cd=users[_0x4b4f91(0x1ef)];}}}}}}}_0x4e97ac[_0x4b4f91(0x127)]('sales_invoice',{'success':_0x5135fa['flash'](_0x4b4f91(0x1de)),'errors':_0x5135fa[_0x4b4f91(0x17f)](_0x4b4f91(0x190)),'role':_0x4764d5,'profile':_0xebe502,'master_shop':_0x4d8db8,'customers':_0x5dcd15,'sales':_0xe373c2,'language':_0x8a68cd});}catch(_0x36aae8){console['log'](_0x36aae8);}}),router['get'](a0_0x56a9de(0x155),auth,async(_0x1d83a5,_0x1ea816)=>{var _0x2ffeb9=a0_0x56a9de;try{const {username:_0xa2e1e7,email:_0x778cd6,role:_0x33449f}=_0x1d83a5['user'],_0x40dca1=_0x1d83a5['user'],_0x197863=await profile['findOne']({'email':_0x40dca1[_0x2ffeb9(0x168)]}),_0x166681=await master_shop['find']();console['log'](_0x2ffeb9(0x135),_0x166681);const _0x2821fa=_0x1d83a5[_0x2ffeb9(0x14e)]['id'];console[_0x2ffeb9(0x109)](_0x2821fa);const _0x4f9a8f=await sales[_0x2ffeb9(0x125)](_0x2821fa);console['log']('user_id',_0x4f9a8f);const _0x1516a7=await warehouse['aggregate']([{'$match':{'name':_0x2ffeb9(0x1d6),'room':_0x2ffeb9(0x101)}},{'$unwind':_0x2ffeb9(0x146)},{'$group':{'_id':_0x2ffeb9(0x1d7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2ffeb9(0x1b4)},'level':{'$first':_0x2ffeb9(0x11c)},'isle':{'$first':_0x2ffeb9(0x1ab)},'pallet':{'$first':_0x2ffeb9(0x114)},'primary_code':{'$first':_0x2ffeb9(0x1fd)},'secondary_code':{'$first':_0x2ffeb9(0x17d)},'product_code':{'$first':_0x2ffeb9(0x103)}}}]);console[_0x2ffeb9(0x109)]('stock_data',_0x1516a7);const _0x54e215=await product[_0x2ffeb9(0x1b6)]({});warehouse_data=await warehouse[_0x2ffeb9(0x11f)]([{'$match':{'status':_0x2ffeb9(0x1e8),'name':_0x2ffeb9(0x1d6),'warehouse_category':_0x2ffeb9(0x102)}},{'$group':{'_id':_0x2ffeb9(0x1af),'name':{'$first':_0x2ffeb9(0x1af)}}},{'$sort':{'name':0x1}}]);var _0xca7f19=[_0x2ffeb9(0x101)];if(_0x166681[0x0][_0x2ffeb9(0x1a5)]==_0x2ffeb9(0x122)){var _0x1a2dc0=users[_0x2ffeb9(0x16b)];console[_0x2ffeb9(0x109)](_0x1a2dc0);}else{if(_0x166681[0x0][_0x2ffeb9(0x1a5)]==_0x2ffeb9(0x1dc))var _0x1a2dc0=users[_0x2ffeb9(0x1dc)];else{if(_0x166681[0x0][_0x2ffeb9(0x1a5)]=='German')var _0x1a2dc0=users[_0x2ffeb9(0xf9)];else{if(_0x166681[0x0][_0x2ffeb9(0x1a5)]==_0x2ffeb9(0x19c))var _0x1a2dc0=users[_0x2ffeb9(0x19c)];else{if(_0x166681[0x0]['language']==_0x2ffeb9(0x1eb))var _0x1a2dc0=users[_0x2ffeb9(0x1eb)];else{if(_0x166681[0x0]['language']=='Portuguese\x20(BR)')var _0x1a2dc0=users[_0x2ffeb9(0x1c7)];else{if(_0x166681[0x0][_0x2ffeb9(0x1a5)]==_0x2ffeb9(0x1bb))var _0x1a2dc0=users[_0x2ffeb9(0x1bb)];else{if(_0x166681[0x0][_0x2ffeb9(0x1a5)]==_0x2ffeb9(0x13c))var _0x1a2dc0=users['Arabic'];}}}}}}}_0x1ea816[_0x2ffeb9(0x127)](_0x2ffeb9(0x137),{'success':_0x1d83a5[_0x2ffeb9(0x17f)](_0x2ffeb9(0x1de)),'errors':_0x1d83a5[_0x2ffeb9(0x17f)](_0x2ffeb9(0x190)),'role':_0x40dca1,'profile':_0x197863,'user':_0x4f9a8f,'stock':_0x1516a7,'master_shop':_0x166681,'unit':_0x54e215,'language':_0x1a2dc0,'warehouses':warehouse_data,'rooms':_0xca7f19});}catch(_0x318667){console[_0x2ffeb9(0x109)](_0x318667),_0x1ea816['status'](0xc8)[_0x2ffeb9(0x1d8)]({'message':_0x318667[_0x2ffeb9(0x10e)]});}}),router[a0_0x56a9de(0x131)](a0_0x56a9de(0x155),auth,async(_0x4efa86,_0x3eda3b)=>{var _0x395aaa=a0_0x56a9de;try{const {invoice:_0x12f302,date:_0x874963,warehouse_name:_0x3f2f56,product_name:_0x5c8a14,primary_code:_0x36016a,secondary_code:_0x276578,product_code:_0x4a4e36,sales_quantity:_0x3043f2,stocks:_0x34c596,return_qty:_0x425699,Room_name:_0x567f72,to_warehouse_name:_0x2fab40,to_Roomname:_0x20ad61,to_Room_name:_0x3fb01f,note:_0x575e1c,level:_0x148626,isle:_0x45f99c,pallet:_0x55a9a4}=_0x4efa86['body'];if(typeof _0x5c8a14==_0x395aaa(0x174))var _0x5ea316=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x19f)]],_0x400962=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x180)]],_0x1e491d=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x18c)]],_0x4987a4=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x1b7)]],_0x1c9de2=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x1c6)]],_0x2c8a27=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x13e)]],_0x5c6c40=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x100)]],_0x8957ff=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x194)]],_0x54d65e=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x1a6)]],_0x35bf6a=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x1a9)]],_0x273c27=[_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x19d)]];else var _0x5ea316=[..._0x4efa86['body'][_0x395aaa(0x19f)]],_0x400962=[..._0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x180)]],_0x1e491d=[..._0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x18c)]],_0x4987a4=[..._0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x1b7)]],_0x1c9de2=[..._0x4efa86['body']['sales_quantity']],_0x2c8a27=[..._0x4efa86['body'][_0x395aaa(0x13e)]],_0x5c6c40=[..._0x4efa86[_0x395aaa(0x1c2)]['return_qty']],_0x8957ff=[..._0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x194)]],_0x54d65e=[..._0x4efa86['body'][_0x395aaa(0x1a6)]],_0x35bf6a=[..._0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x1a9)]],_0x273c27=[..._0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x19d)]];const _0x50b2ba=_0x5ea316[_0x395aaa(0x150)](_0x19f001=>{return _0x19f001={'product_name':_0x19f001};});_0x400962[_0x395aaa(0xfd)]((_0x4ef610,_0x10fc50)=>{_0x50b2ba[_0x10fc50]['primary_code']=_0x4ef610;}),_0x1e491d[_0x395aaa(0xfd)]((_0x1dab69,_0xc75439)=>{_0x50b2ba[_0xc75439]['secondary_code']=_0x1dab69;}),_0x4987a4['forEach']((_0x385dc4,_0x484b53)=>{var _0x4c1e43=_0x395aaa;_0x50b2ba[_0x484b53][_0x4c1e43(0x1b7)]=_0x385dc4;}),_0x1c9de2['forEach']((_0x230ab2,_0x513217)=>{var _0x3b923d=_0x395aaa;_0x50b2ba[_0x513217][_0x3b923d(0x1aa)]=_0x230ab2;}),_0x2c8a27[_0x395aaa(0xfd)]((_0x310af7,_0x47f3b1)=>{var _0x245a69=_0x395aaa;_0x50b2ba[_0x47f3b1][_0x245a69(0x1b0)]=_0x310af7;}),_0x5c6c40['forEach']((_0x56de2a,_0x20b1ce)=>{_0x50b2ba[_0x20b1ce]['return_qty']=_0x56de2a;}),_0x8957ff['forEach']((_0x5f3ac9,_0x2464ab)=>{var _0x32c586=_0x395aaa;_0x50b2ba[_0x2464ab][_0x32c586(0x194)]=_0x5f3ac9;}),_0x54d65e['forEach']((_0x112d72,_0x29979e)=>{var _0x2bee29=_0x395aaa;_0x50b2ba[_0x29979e][_0x2bee29(0x1a6)]=_0x112d72;}),_0x35bf6a[_0x395aaa(0xfd)]((_0x5eabed,_0xb42f1e)=>{var _0x1362b3=_0x395aaa;_0x50b2ba[_0xb42f1e][_0x1362b3(0x188)]=_0x5eabed;}),_0x273c27[_0x395aaa(0xfd)]((_0x311b23,_0x5551de)=>{var _0x203f77=_0x395aaa;_0x50b2ba[_0x5551de][_0x203f77(0x19d)]=_0x311b23;});var _0x4566ce=0x0;_0x50b2ba[_0x395aaa(0xfd)](_0x541a69=>{var _0x16ed3b=_0x395aaa;console['log']('foreach\x20newproduct',_0x541a69),(parseInt(_0x541a69[_0x16ed3b(0x1aa)])<parseInt(_0x541a69['return_qty'])||parseInt(_0x541a69[_0x16ed3b(0x1b0)])<parseInt(_0x541a69[_0x16ed3b(0x100)])&&parseInt(_0x541a69[_0x16ed3b(0x1aa)])>parseInt(_0x541a69[_0x16ed3b(0x100)])||parseInt(_0x541a69[_0x16ed3b(0x100)])==0x0)&&_0x4566ce++;});if(_0x4566ce!=0x0)return _0x4efa86['flash']('errors',_0x395aaa(0x187)),_0x3eda3b[_0x395aaa(0x120)](_0x395aaa(0x18f));const _0x5c6c9d=await sales['findOne']({'invoice':_0x12f302});console['log'](_0x5c6c9d),_0x5c6c9d['return_data']=_0x395aaa(0x104);const _0x2ea5e0=await _0x5c6c9d[_0x395aaa(0x1db)](),_0x20fd68=new sales_return({'invoice':_0x12f302,'customer':_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x128)],'date':_0x874963,'warehouse_name':_0x3f2f56,'room':_0x567f72,'ToWarehouse':_0x2fab40,'ToRoom':_0x3fb01f,'return_sale':_0x50b2ba,'note':_0x575e1c}),_0x5afd97=await _0x20fd68['save']();console[_0x395aaa(0x109)](_0x20fd68);const _0x551b8d=await sales_return[_0x395aaa(0x156)]({'invoice':_0x12f302}),_0x196ead=await warehouse['findOne']({'name':_0x2fab40,'room':_0x3fb01f});_0x551b8d[_0x395aaa(0x137)]['forEach'](_0x1688c4=>{var _0x4f481d=_0x395aaa,_0x31fe82=0x0;const _0x373a1b=_0x196ead[_0x4f481d(0x1a0)][_0x4f481d(0x150)](_0x4fe597=>{var _0x2c4192=_0x4f481d;_0x4fe597[_0x2c4192(0x19f)]==_0x1688c4[_0x2c4192(0x19f)]&&_0x4fe597[_0x2c4192(0x19d)]==_0x1688c4['floorlevel']&&_0x4fe597[_0x2c4192(0x188)]==_0x1688c4[_0x2c4192(0x188)]&&_0x4fe597[_0x2c4192(0x1a6)]==_0x1688c4['bin']&&_0x4fe597[_0x2c4192(0x194)]==_0x1688c4['bay']&&(_0x4fe597[_0x2c4192(0x11b)]=parseInt(_0x4fe597[_0x2c4192(0x11b)])+parseInt(_0x1688c4[_0x2c4192(0x100)]),_0x31fe82++);});_0x31fe82=='0'&&(_0x196ead[_0x4f481d(0x1a0)]=_0x196ead[_0x4f481d(0x1a0)][_0x4f481d(0x124)]({'product_name':_0x1688c4['product_name'],'product_stock':_0x1688c4['return_qty'],'primary_code':_0x1688c4[_0x4f481d(0x180)],'secondary_code':_0x1688c4[_0x4f481d(0x18c)],'product_code':_0x1688c4['product_code'],'bay':_0x1688c4[_0x4f481d(0x194)],'bin':_0x1688c4[_0x4f481d(0x1a6)],'type':_0x1688c4[_0x4f481d(0x188)],'floorlevel':_0x1688c4[_0x4f481d(0x19d)]})),console['log'](_0x4f481d(0x1b5),_0x196ead);}),await _0x196ead['save'](),console['log'](_0x4efa86[_0x395aaa(0x1c2)]);const _0x2b4907=new c_payment_data({'invoice':_0x12f302,'customer':_0x4efa86[_0x395aaa(0x1c2)]['customer'],'reason':_0x395aaa(0x13d)});await _0x2b4907[_0x395aaa(0x1db)]();const _0x1a7ea9=await master_shop[_0x395aaa(0x1b6)]();console['log']('add\x20post',_0x1a7ea9[0x0][_0x395aaa(0x1ca)]);const _0x305e26=await email_settings['findOne'](),_0x5190d9=await customer[_0x395aaa(0x156)]({'name':_0x4efa86[_0x395aaa(0x1c2)][_0x395aaa(0x128)]});console[_0x395aaa(0x109)](_0x395aaa(0x1a8),_0x5190d9);_0x1a7ea9[0x0]['currency_placement']==0x1?(right_currency=_0x1a7ea9[0x0][_0x395aaa(0x1e1)],left_currency=''):(right_currency='',left_currency=_0x1a7ea9[0x0][_0x395aaa(0x1e1)]);var _0x5b0007=_0x5ea316,_0x45269a=_0x5c6c40,_0x27cb4='',_0x47a5a8;for(_0x47a5a8 in _0x5b0007){_0x27cb4+=_0x395aaa(0x1e0)+_0x395aaa(0x153)+_0x5b0007[_0x47a5a8]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x45269a[_0x47a5a8]+'</td>'+'</tr>';}console[_0x395aaa(0x109)]('product_list',_0x27cb4);let _0x10a8a1=nodemailer[_0x395aaa(0x172)]({'service':_0x395aaa(0x111),'auth':{'user':_0x305e26['email'],'pass':_0x305e26['password']}}),_0x18072f={'from':_0x305e26['email'],'to':_0x5190d9[_0x395aaa(0x168)],'subject':_0x395aaa(0x1f5),'attachments':[{'filename':_0x395aaa(0x1b1),'path':__dirname+_0x395aaa(0x12e)+'/upload/'+_0x1a7ea9[0x0][_0x395aaa(0x1ca)],'cid':'logo'}],'html':_0x395aaa(0x12a)+'<html><head><title></title>'+'</head><body>'+_0x395aaa(0x13b)+_0x395aaa(0x1a3)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x395aaa(0x13b)+'<h2>\x20'+_0x1a7ea9[0x0]['site_title']+'\x20</h2>'+_0x395aaa(0x1b2)+_0x395aaa(0x1b2)+_0x395aaa(0x1dd)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x12f302+'\x20'+_0x395aaa(0x19b)+_0x395aaa(0x1fa)+_0x874963+'\x20'+_0x395aaa(0x176)+_0x395aaa(0x1ea)+_0x395aaa(0x1b2)+_0x395aaa(0x1fc)+_0x395aaa(0x1f9)+'<tr>'+_0x395aaa(0x1a4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x395aaa(0x12f)+_0x395aaa(0x118)+_0x395aaa(0x158)+_0x395aaa(0xfa)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x27cb4+'\x20'+_0x395aaa(0x165)+_0x395aaa(0x16e)+_0x395aaa(0x13b)+_0x395aaa(0x1ce)+_0x395aaa(0xf7)+_0x1a7ea9[0x0][_0x395aaa(0x110)]+_0x395aaa(0x1ea)+'</div>'+_0x395aaa(0x1b2)+_0x395aaa(0x1be)};_0x10a8a1[_0x395aaa(0x139)](_0x18072f,function(_0x3c2c5b,_0x31f478){var _0x588200=_0x395aaa;_0x3c2c5b?(console[_0x588200(0x109)](_0x3c2c5b),console[_0x588200(0x109)]('Error\x20Occurs')):console[_0x588200(0x109)](_0x588200(0x191));}),_0x4efa86[_0x395aaa(0x17f)]('success',_0x395aaa(0x1e3)),_0x3eda3b[_0x395aaa(0x120)]('/all_sales/view');}catch(_0x4927a9){console[_0x395aaa(0x109)](_0x4927a9),_0x3eda3b['status'](0xc8)[_0x395aaa(0x1d8)]({'message1':_0x4927a9[_0x395aaa(0x10e)]});}}),router['get'](a0_0x56a9de(0x1d4),auth,async(_0x105aca,_0x599e3b)=>{var _0x355276=a0_0x56a9de;try{const {username:_0x5f0cc1,email:_0x13323e,role:_0x497277}=_0x105aca[_0x355276(0x1e6)],_0x55f3aa=_0x105aca[_0x355276(0x1e6)],_0x524b1a=await profile['findOne']({'email':_0x55f3aa[_0x355276(0x168)]}),_0x439b6e=await master_shop[_0x355276(0x1b6)]();console[_0x355276(0x109)](_0x355276(0x112),_0x439b6e);const _0x3a071d=_0x105aca['params']['id'],_0x82c15=await sales[_0x355276(0x125)](_0x3a071d);console[_0x355276(0x109)](_0x355276(0x17c),_0x82c15);if(_0x439b6e[0x0][_0x355276(0x1a5)]==_0x355276(0x122))var _0x1a88c1=users[_0x355276(0x16b)];else{if(_0x439b6e[0x0][_0x355276(0x1a5)]==_0x355276(0x1dc))var _0x1a88c1=users['Hindi'];else{if(_0x439b6e[0x0]['language']=='German')var _0x1a88c1=users[_0x355276(0xf9)];else{if(_0x439b6e[0x0][_0x355276(0x1a5)]==_0x355276(0x19c))var _0x1a88c1=users[_0x355276(0x19c)];else{if(_0x439b6e[0x0][_0x355276(0x1a5)]=='French')var _0x1a88c1=users['French'];else{if(_0x439b6e[0x0][_0x355276(0x1a5)]==_0x355276(0x14c))var _0x1a88c1=users['Portuguese'];else{if(_0x439b6e[0x0][_0x355276(0x1a5)]=='Chinese')var _0x1a88c1=users[_0x355276(0x1bb)];else{if(_0x439b6e[0x0][_0x355276(0x1a5)]=='Arabic\x20(ae)')var _0x1a88c1=users[_0x355276(0x1ef)];}}}}}}}_0x599e3b[_0x355276(0x127)](_0x355276(0x106),{'success':_0x105aca[_0x355276(0x17f)](_0x355276(0x1de)),'errors':_0x105aca['flash'](_0x355276(0x190)),'role':_0x55f3aa,'profile':_0x524b1a,'alldata':_0x82c15,'master_shop':_0x439b6e,'language':_0x1a88c1});}catch(_0x5607b7){console['log'](_0x5607b7);}}),router['post'](a0_0x56a9de(0x1ac),async(_0xd15b34,_0x4cb861)=>{var _0x252ee4=a0_0x56a9de;const {product_code:_0x5118cf,warehouse_name:_0x1ce9b1,rooms_data:_0x13717d,Roomslist:_0x3a587c}=_0xd15b34[_0x252ee4(0x1c2)],_0x56dd91=_0x3a587c[_0x252ee4(0x1f4)](','),_0x21b8ee=[];async function _0x4cc02e(_0x1616b2){var _0x1639d1=_0x252ee4;const _0x4253b8=await warehouse['aggregate']([{'$match':{'name':_0x1ce9b1,'room':_0x1616b2}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x5118cf}},{'$group':{'_id':_0x1639d1(0x1d7),'name':{'$first':_0x1639d1(0x196)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1639d1(0x17d)},'product_code':{'$first':_0x1639d1(0x103)},'level':{'$first':_0x1639d1(0x1bc)},'isle':{'$first':_0x1639d1(0x1ae)},'type':{'$first':_0x1639d1(0x145)},'pallet':{'$first':_0x1639d1(0x1b9)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1639d1(0x1d1)},'storage':{'$first':_0x1639d1(0x192)},'rack':{'$first':_0x1639d1(0x142)},'expiry_date':{'$first':_0x1639d1(0x197)},'production_date':{'$first':_0x1639d1(0x152)},'maxPerUnit':{'$first':_0x1639d1(0x18d)},'batch_code':{'$first':_0x1639d1(0x1f6)},'product_cat':{'$first':_0x1639d1(0x123)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1639d1(0x1a1)},'actual_qty':{'$first':_0x1639d1(0x1cd)},'actual_uom':{'$first':_0x1639d1(0x1ee)}}}]),_0x99eeeb=await warehouse[_0x1639d1(0x11f)]([{'$match':{'name':_0x1ce9b1,'room':_0x1616b2}},{'$unwind':_0x1639d1(0x146)},{'$match':{'product_details.secondary_code':_0x5118cf}},{'$group':{'_id':_0x1639d1(0x1d7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1639d1(0x1b4)},'primary_code':{'$first':_0x1639d1(0x1fd)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1639d1(0x103)},'level':{'$first':_0x1639d1(0x1bc)},'isle':{'$first':_0x1639d1(0x1ae)},'type':{'$first':_0x1639d1(0x145)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1639d1(0x1d1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1639d1(0x142)},'expiry_date':{'$first':_0x1639d1(0x197)},'production_date':{'$first':_0x1639d1(0x152)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x1639d1(0x123)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1639d1(0x14b)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x4253b8['length']>0x0)_0x21b8ee[_0x1639d1(0x161)](_0x4253b8);else _0x99eeeb['length']>0x0&&_0x21b8ee['push'](_0x99eeeb);}const _0x2f2c9b=_0x56dd91[_0x252ee4(0x150)](_0x18ec86=>_0x4cc02e(_0x18ec86));await Promise[_0x252ee4(0x198)](_0x2f2c9b),_0x4cb861['json'](_0x21b8ee);}),module[a0_0x56a9de(0x1f8)]=router;