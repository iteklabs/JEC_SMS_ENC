var a0_0x57f966=a0_0x4cf1;(function(_0x228f8a,_0x52292f){var _0x7cd080=a0_0x4cf1,_0x19cc88=_0x228f8a();while(!![]){try{var _0x5f0775=-parseInt(_0x7cd080(0x151))/0x1+parseInt(_0x7cd080(0x168))/0x2*(parseInt(_0x7cd080(0x163))/0x3)+-parseInt(_0x7cd080(0x154))/0x4*(parseInt(_0x7cd080(0x1a7))/0x5)+parseInt(_0x7cd080(0x113))/0x6*(parseInt(_0x7cd080(0x1ae))/0x7)+-parseInt(_0x7cd080(0x15b))/0x8*(parseInt(_0x7cd080(0x13c))/0x9)+parseInt(_0x7cd080(0x1b1))/0xa+-parseInt(_0x7cd080(0x192))/0xb;if(_0x5f0775===_0x52292f)break;else _0x19cc88['push'](_0x19cc88['shift']());}catch(_0xa99186){_0x19cc88['push'](_0x19cc88['shift']());}}}(a0_0x3745,0x918f9));const express=require(a0_0x57f966(0x1d6)),app=express(),router=express[a0_0x57f966(0x15f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x57f966(0xe2)),auth=require(a0_0x57f966(0x1e6)),nodemailer=require(a0_0x57f966(0x16d)),users=require(a0_0x57f966(0x1c5));function a0_0x4cf1(_0x4b0d97,_0x1b2559){var _0x37455e=a0_0x3745();return a0_0x4cf1=function(_0x4cf179,_0x3cfc56){_0x4cf179=_0x4cf179-0xe1;var _0x4167c7=_0x37455e[_0x4cf179];return _0x4167c7;},a0_0x4cf1(_0x4b0d97,_0x1b2559);}router[a0_0x57f966(0x180)](a0_0x57f966(0x1c6),auth,async(_0x55777d,_0x396648)=>{var _0x248989=a0_0x57f966;try{const {username:_0x17f0c9,email:_0x5b003b,role:_0x12e401}=_0x55777d[_0x248989(0x1c7)],_0x3b37fe=_0x55777d[_0x248989(0x1c7)],_0x45691a=await profile[_0x248989(0x133)]({'email':_0x3b37fe[_0x248989(0x1be)]}),_0x3524be=await master_shop[_0x248989(0x16e)]();let _0x4bcdcb;if(_0x3b37fe[_0x248989(0x1ef)]==_0x248989(0x18a)){const _0x1d3068=await staff[_0x248989(0x133)]({'email':_0x3b37fe[_0x248989(0x1be)]});_0x4bcdcb=await sales['aggregate']([{'$lookup':{'from':_0x248989(0x1d9),'localField':'customer','foreignField':_0x248989(0x1f5),'as':'customers_docs'}},{'$unwind':_0x248989(0x181)},{'$unwind':_0x248989(0x15a)},{'$group':{'_id':_0x248989(0xfd),'invoice':{'$first':_0x248989(0xf3)},'customers':{'$first':'$customer'},'date':{'$first':_0x248989(0x199)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x248989(0x15a)},'note':{'$first':_0x248989(0x137)},'return_data':{'$first':_0x248989(0x165)},'customers_docs':{'$first':_0x248989(0x181)},'total_saleproduct_quantity':{'$sum':_0x248989(0x1cf)},'level':{'$addToSet':_0x248989(0xf2)},'isle':{'$addToSet':_0x248989(0x19b)},'type':{'$addToSet':_0x248989(0x19a)},'pallet':{'$addToSet':_0x248989(0x186)},'finalize':{'$first':_0x248989(0x12a)},'isAllowEdit':{'$first':_0x248989(0x160)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4bcdcb=await sales[_0x248989(0x122)]([{'$lookup':{'from':_0x248989(0x1d9),'localField':_0x248989(0x1b7),'foreignField':_0x248989(0x1f5),'as':_0x248989(0x188)}},{'$unwind':_0x248989(0x181)},{'$unwind':_0x248989(0x15a)},{'$group':{'_id':_0x248989(0xfd),'invoice':{'$first':_0x248989(0xf3)},'customers':{'$first':_0x248989(0x14a)},'date':{'$first':_0x248989(0x199)},'warehouse_name':{'$first':_0x248989(0x124)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x248989(0x165)},'customers_docs':{'$first':_0x248989(0x181)},'total_saleproduct_quantity':{'$sum':_0x248989(0x1cf)},'level':{'$addToSet':_0x248989(0xf2)},'isle':{'$addToSet':_0x248989(0x19b)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x248989(0x186)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x248989(0x160)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x248989(0xf8),_0x4bcdcb);if(_0x3524be[0x0][_0x248989(0xfb)]=='English\x20(US)'){var _0x224048=users[_0x248989(0x1b4)];console[_0x248989(0x128)](_0x224048);}else{if(_0x3524be[0x0]['language']==_0x248989(0x179))var _0x224048=users[_0x248989(0x179)];else{if(_0x3524be[0x0][_0x248989(0xfb)]==_0x248989(0x1dc))var _0x224048=users[_0x248989(0x1dc)];else{if(_0x3524be[0x0]['language']==_0x248989(0x140))var _0x224048=users[_0x248989(0x140)];else{if(_0x3524be[0x0][_0x248989(0xfb)]==_0x248989(0x1d1))var _0x224048=users['French'];else{if(_0x3524be[0x0]['language']=='Portuguese\x20(BR)')var _0x224048=users['Portuguese'];else{if(_0x3524be[0x0][_0x248989(0xfb)]==_0x248989(0x1a1))var _0x224048=users[_0x248989(0x1a1)];else{if(_0x3524be[0x0]['language']==_0x248989(0x1b2))var _0x224048=users['Arabic'];}}}}}}}_0x396648[_0x248989(0x1c0)](_0x248989(0x1e2),{'success':_0x55777d[_0x248989(0x12c)](_0x248989(0x1c2)),'errors':_0x55777d[_0x248989(0x12c)](_0x248989(0xee)),'sales':_0x4bcdcb,'profile':_0x45691a,'role':_0x3b37fe,'master_shop':_0x3524be,'language':_0x224048});}catch(_0x3c5964){console[_0x248989(0x128)](_0x3c5964);}});async function getRandom8DigitNumber(){var _0xfaff29=a0_0x57f966;const _0x30595f=0x989680,_0x5327e6=0x5f5e0ff,_0x5825f5=Math[_0xfaff29(0x1b0)](Math[_0xfaff29(0x1a0)]()*(_0x5327e6-_0x30595f+0x1))+_0x30595f;var _0x41c4e9;const _0x3aa981=await sales[_0xfaff29(0x133)]({'invoice':'OUT-'+_0x5825f5});return _0x3aa981&&_0x3aa981[_0xfaff29(0x1d7)]>0x0?_0x41c4e9='OUT-'+_0x5825f5:_0x41c4e9='OUT-'+_0x5825f5,_0x41c4e9;}function a0_0x3745(){var _0x5f5c1c=['</head><body>','bin','Return\x20Rooms','170622pUEofw','getMonth','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</thead>','Spanish','primary_unit','production_date','secondary_unit','stock','$product_details.production_date','<span\x20style=\x22float:\x20right;\x22>','received_amount','Floor','padStart','$customer','Sale\x20Return\x20Mail','/all_sales/view','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/return_sales/:id','$product_details.level','forEach','85485sAQYDH','Raw\x20Materials','message','92IMulge','$product_details.product_stock','product_details','Sales\x20Add\x20successfully','post','delivery_date','$sale_product','144IzIsbN','Portuguese\x20(BR)','body','sale_qty','Router','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sendMail','27grfzzT','English\x20(US)','$return_data','expiry_date','customer_data','249202cnmjdc','invoice','rack','<div>','/view/add_sales','nodemailer','find','due_amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Ambient','quantity','concat','stocks','</td>','$product_details.product_name','$product_details.storage','</body></html>','Hindi','quantity_notConverted','floorlevel','id_transact','<html><head><title></title>','Level','$product_details.product_code','get','$customers_docs','room','secondary_code','product_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.floorlevel','json','customers_docs','$product_details.actual_uom','staff','product_name','all_sales_barcode','master','RoomAssigned','$product_details.product_cat','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.bay','13939717aDrBkW','Enabled','Received\x20Payment\x20For\x20Sale','map','finalize','An\x20error\x20occurred.','$room','$date','$sale_product.type','$sale_product.bin','max','final','currency','Error\x20Occurs','random','Chinese','$product_details.maxPerUnit','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','actual_uom','$product_details.rack','82585aFcsvb','stock_data','password','Sales\x20Update\x20successfully','logo','<tbody\x20style=\x22text-align:\x20center;\x22>','batch_code','84XOHDhm','level','floor','9968070GaDgqw','Arabic\x20(ae)','Sale\x20Return','English','Sales\x20Mail','types','customer','$product_details._id','SCRN','/barcode_scanner','amount','<!DOCTYPE\x20html>','</tr>','email','catch','render','$product_details.secondary_code','success','$product_details.type','/upload/','../public/language/languages.json','/view','user','params','gmail','status','Receiving\x20Area','delivery_code','user_id','$product_details.primary_code','$sale_product.quantity','Enclosed','French','</tbody>','prod_code','$product_details','all','express','length','prod_invoice','customers','$product_details.unit','room_name','German','date','redirect','id_transaction_from','<tr>','findById','all_sales','abs','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.invoice','../middleware/auth','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.expiry_date','primary_code','add\x20post','/invoice/:id','</div>','/all_sales/preview/','$product_details.secondary_unit','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','edit_sales','/give_payment/:id','</h5>','type','name','Shelves','/preview/:id','../models/all_models','product_stock','$product_details.actual_qty','\x20Order\x20Number\x20:\x20','slice','site_title','add_sales','sales_invoice','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Arabic','back','errors','product_code','unit','bay','$sale_product.bay','$invoice','foreach\x20newproduct','string','warehouse','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sales\x20all_data','exports','Logo.png','language','sales\x20item\x20return\x20successfull','$_id','$product_details.isle','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','isAllowEdit','payment\x20successfull','Email\x20sent\x20successfully','product','True','getDate','$product_details.floorlevel','<hr\x20class=\x22my-3\x22>','sale_product','_id','save','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','image','toString','\x20Order\x20Date\x20:\x20','maxperunit','<h5>','275934TQGJjx','error','\x20</h2>','/../public','requested_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','currency_placement','/barcode/:id','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_list','/view/add_sale/product','Return\x20Goods','/view/:id','aggregate','then','$warehouse_name','$product.product_name','purchases_data','createTransport','log','</span>','$finalize','filter','flash','return_qty','<h2>\x20','Portuguese','push','max_per_unit','$product_details.bin','findOne','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','return_sale','storage','$note','warehouse_name'];a0_0x3745=function(){return _0x5f5c1c;};return a0_0x3745();}router[a0_0x57f966(0x180)](a0_0x57f966(0x16c),auth,async(_0x537570,_0x54d969)=>{var _0x38f91a=a0_0x57f966;try{const {username:_0x5ebf0e,email:_0x169dae,role:_0x5ad086}=_0x537570[_0x38f91a(0x1c7)],_0x4d1d5e=_0x537570['user'],_0x40ff1c=await profile[_0x38f91a(0x133)]({'email':_0x4d1d5e[_0x38f91a(0x1be)]}),_0x823366=await master_shop['find'](),_0x4368ac=await customer[_0x38f91a(0x16e)]({});let _0x2e3b07;if(_0x4d1d5e[_0x38f91a(0x1ef)]==_0x38f91a(0x18a)){const _0x13a6e9=await staff[_0x38f91a(0x133)]({'email':_0x4d1d5e[_0x38f91a(0x1be)]});_0x2e3b07=await warehouse[_0x38f91a(0x122)]([{'$match':{'status':_0x38f91a(0x193),'name':_0x13a6e9['warehouse'],'warehouse_category':_0x38f91a(0x152),'name':{'$ne':_0x38f91a(0x120)}}},{'$group':{'_id':_0x38f91a(0x10c),'name':{'$first':_0x38f91a(0x10c)}}},{'$sort':{'name':0x1}}]);}else _0x2e3b07=await warehouse[_0x38f91a(0x122)]([{'$match':{'status':'Enabled','warehouse_category':_0x38f91a(0x152),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x38f91a(0x10c)}}},{'$sort':{'name':0x1}}]);const _0x4cb634=await product[_0x38f91a(0x16e)]({});var _0x4d6ba6=[_0x38f91a(0x171),_0x38f91a(0x1d0)];const _0x364144=await sales[_0x38f91a(0x16e)]({}),_0x118435=_0x364144['length']+0x1,_0x4247c0='OUT-'+_0x118435[_0x38f91a(0x10f)]()[_0x38f91a(0x149)](0x5,'0');if(_0x823366[0x0][_0x38f91a(0xfb)]==_0x38f91a(0x164)){var _0x3b0682=users[_0x38f91a(0x1b4)];console['log'](_0x3b0682);}else{if(_0x823366[0x0][_0x38f91a(0xfb)]==_0x38f91a(0x179))var _0x3b0682=users[_0x38f91a(0x179)];else{if(_0x823366[0x0][_0x38f91a(0xfb)]=='German')var _0x3b0682=users[_0x38f91a(0x1dc)];else{if(_0x823366[0x0]['language']==_0x38f91a(0x140))var _0x3b0682=users['Spanish'];else{if(_0x823366[0x0][_0x38f91a(0xfb)]==_0x38f91a(0x1d1))var _0x3b0682=users[_0x38f91a(0x1d1)];else{if(_0x823366[0x0][_0x38f91a(0xfb)]==_0x38f91a(0x15c))var _0x3b0682=users[_0x38f91a(0x12f)];else{if(_0x823366[0x0][_0x38f91a(0xfb)]==_0x38f91a(0x1a1))var _0x3b0682=users[_0x38f91a(0x1a1)];else{if(_0x823366[0x0][_0x38f91a(0xfb)]==_0x38f91a(0x1b2))var _0x3b0682=users[_0x38f91a(0xec)];}}}}}}}const _0x548c72=getRandom8DigitNumber();_0x548c72[_0x38f91a(0x123)](_0x5317db=>{var _0x1bf132=_0x38f91a;_0x54d969[_0x1bf132(0x1c0)](_0x1bf132(0xe8),{'success':_0x537570[_0x1bf132(0x12c)](_0x1bf132(0x1c2)),'errors':_0x537570['flash'](_0x1bf132(0xee)),'role':_0x4d1d5e,'profile':_0x40ff1c,'customer':_0x4368ac,'warehouse':_0x2e3b07,'product':_0x4cb634,'invoice':_0x5317db,'master_shop':_0x823366,'language':_0x3b0682,'rooms_data':_0x4d6ba6});})[_0x38f91a(0x1bf)](_0x481ae1=>{var _0x40f7b3=_0x38f91a;_0x537570[_0x40f7b3(0x12c)](_0x40f7b3(0xee),_0x40f7b3(0x13e)),_0x54d969[_0x40f7b3(0x1de)](_0x40f7b3(0x14c));});}catch(_0xfb2088){console[_0x38f91a(0x128)](_0xfb2088);}}),router['get']('/view/add_sales/:id',auth,async(_0x341a92,_0x6d85dc)=>{var _0x56be31=a0_0x57f966;try{const _0x4d0353=_0x341a92[_0x56be31(0x1c8)]['id'];console[_0x56be31(0x128)](_0x4d0353);const _0x4aa442=await product[_0x56be31(0x16e)](),_0x11374a=await purchases[_0x56be31(0x122)]([{'$match':{'warehouse_name':_0x4d0353}},{'$unwind':'$product'},{'$group':{'_id':_0x56be31(0x125)}}]);console['log'](_0x56be31(0x126),_0x11374a),_0x6d85dc['status'](0xc8)[_0x56be31(0x187)]({'purchases_data':_0x11374a,'product_data':_0x4aa442});}catch(_0x3de4ee){console[_0x56be31(0x128)](_0x3de4ee);}}),router[a0_0x57f966(0x158)](a0_0x57f966(0x11f),auth,async(_0xab7fce,_0xdbf194)=>{var _0x20a232=a0_0x57f966;try{const {warehouse_data:_0x1d8ab4,product_data:_0x4a98a8}=_0xab7fce[_0x20a232(0x15d)];console[_0x20a232(0x128)](_0xab7fce['body'][_0x20a232(0x184)]);;const _0x552da1=await master_shop[_0x20a232(0x16e)]();console[_0x20a232(0x128)](_0x20a232(0x18d),_0x552da1);const _0x36374d=await product[_0x20a232(0x133)]({'name':_0x4a98a8});console[_0x20a232(0x128)](_0x20a232(0x104),_0x36374d);const _0x6133a1=await warehouse[_0x20a232(0x122)]([{'$match':{'name':_0x1d8ab4}},{'$unwind':_0x20a232(0x1d4)},{'$match':{'product_details.product_name':_0x4a98a8}},{'$group':{'_id':_0x20a232(0x176),'product_stock':{'$first':_0x20a232(0x155)}}}]);console[_0x20a232(0x128)](_0x20a232(0x1a8),_0x6133a1),_0xdbf194[_0x20a232(0x1ca)](0xc8)[_0x20a232(0x187)]({'master':_0x552da1,'new_product':_0x36374d,'stock_data':_0x6133a1});}catch(_0x369f7b){console[_0x20a232(0x128)](_0x369f7b);}}),router[a0_0x57f966(0x158)](a0_0x57f966(0x16c),auth,async(_0x459b8c,_0x2b0b4f)=>{var _0x3b0b75=a0_0x57f966;try{const {invoice:_0x3d10dd,date:_0x527cb4,warehouse_name:_0xe3567,product_name:_0x3b490b,stock:_0x2aa2bb,quantity:_0x169d81,note:_0x457ff8,room:_0x6c1ddf,primary_code:_0x4255d6,secondary_code:_0x54468f,prod_code:_0x404b12,level:_0x412c96,isle:_0x311b0e,pallet:_0x42a514,batch_code:_0x17b2a8,SCRN:_0x263d20,expiry_date:_0x482a2d}=_0x459b8c[_0x3b0b75(0x15d)];if(typeof _0x3b490b=='string')var _0xedfc12=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x18b)]],_0x370440=[_0x459b8c[_0x3b0b75(0x15d)]['stock']],_0x2bcdf9=[_0x459b8c['body'][_0x3b0b75(0x1a3)]],_0x8e2f51=[_0x459b8c['body'][_0x3b0b75(0x1e9)]],_0x2045b0=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x183)]],_0x1896ef=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x1d3)]],_0x4fb40f=[_0x459b8c[_0x3b0b75(0x15d)]['level']],_0x42f3e2=[_0x459b8c['body'][_0x3b0b75(0x141)]],_0x1fbc13=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x143)]],_0x2eea4a=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x1ad)]],_0x478493=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x166)]],_0x132f0b=[_0x459b8c['body']['max_per_unit']],_0x12f58e=[_0x459b8c['body'][_0x3b0b75(0x142)]],_0x5df8f4=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x117)]],_0xce63ad=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x159)]],_0x477c1b=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x1cc)]],_0x17fb6b=[_0x459b8c['body'][_0x3b0b75(0x11c)]],_0x329dae=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x172)]],_0x190b34=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x18e)]],_0x581ef0=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x1d8)]],_0x4c617e=[_0x459b8c[_0x3b0b75(0x15d)]['actual_qty']],_0x1e7f4a=[_0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x1a5)]],_0x447c4b=[_0x459b8c[_0x3b0b75(0x15d)]['id_transact']];else var _0xedfc12=[..._0x459b8c[_0x3b0b75(0x15d)]['product_name']],_0x370440=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x144)]],_0x2bcdf9=[..._0x459b8c['body'][_0x3b0b75(0x1a3)]],_0x8e2f51=[..._0x459b8c[_0x3b0b75(0x15d)]['primary_code']],_0x2045b0=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x183)]],_0x1896ef=[..._0x459b8c['body'][_0x3b0b75(0x1d3)]],_0x4fb40f=[..._0x459b8c[_0x3b0b75(0x15d)]['level']],_0x42f3e2=[..._0x459b8c['body'][_0x3b0b75(0x141)]],_0x1fbc13=[..._0x459b8c['body'][_0x3b0b75(0x143)]],_0x2eea4a=[..._0x459b8c['body']['batch_code']],_0x478493=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x166)]],_0x132f0b=[..._0x459b8c['body'][_0x3b0b75(0x131)]],_0x12f58e=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x142)]],_0x5df8f4=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x117)]],_0xce63ad=[..._0x459b8c['body'][_0x3b0b75(0x159)]],_0x477c1b=[..._0x459b8c[_0x3b0b75(0x15d)]['delivery_code']],_0x17fb6b=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x11c)]],_0x329dae=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x172)]],_0x190b34=[..._0x459b8c[_0x3b0b75(0x15d)]['RoomAssigned']],_0x581ef0=[..._0x459b8c[_0x3b0b75(0x15d)]['prod_invoice']],_0x4c617e=[..._0x459b8c[_0x3b0b75(0x15d)]['actual_qty']],_0x1e7f4a=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x1a5)]],_0x447c4b=[..._0x459b8c[_0x3b0b75(0x15d)][_0x3b0b75(0x17c)]];const _0x21ef61=_0xedfc12[_0x3b0b75(0x195)](_0x559f5b=>{return _0x559f5b={'product_name':_0x559f5b};});_0x370440[_0x3b0b75(0x150)]((_0x1e81db,_0x4973cb)=>{var _0x529f89=_0x3b0b75;_0x21ef61[_0x4973cb][_0x529f89(0x144)]=Math[_0x529f89(0x1e3)](_0x1e81db);}),_0x4c617e[_0x3b0b75(0x150)]((_0x4be52e,_0x222c7d)=>{_0x21ef61[_0x222c7d]['actual_qty']=Math['abs'](_0x4be52e);}),_0x1e7f4a[_0x3b0b75(0x150)]((_0x2bda1e,_0x5e0623)=>{var _0x19b53f=_0x3b0b75;_0x21ef61[_0x5e0623][_0x19b53f(0x1a5)]=_0x2bda1e;}),_0x447c4b[_0x3b0b75(0x150)]((_0x2bd757,_0x466cd3)=>{var _0x3e69c6=_0x3b0b75;_0x21ef61[_0x466cd3][_0x3e69c6(0x1df)]=_0x2bd757;}),_0x2bcdf9['forEach']((_0x655304,_0x9abbce)=>{var _0x122739=_0x3b0b75;_0x21ef61[_0x9abbce][_0x122739(0x172)]=_0x655304;}),_0x8e2f51['forEach']((_0x1c0368,_0x493972)=>{_0x21ef61[_0x493972]['primary_code']=_0x1c0368;}),_0x2045b0[_0x3b0b75(0x150)]((_0x170d32,_0x5beb2d)=>{var _0x1ff1b0=_0x3b0b75;_0x21ef61[_0x5beb2d][_0x1ff1b0(0x183)]=_0x170d32;}),_0x1896ef['forEach']((_0x21451e,_0x1249b9)=>{var _0x2fb95e=_0x3b0b75;_0x21ef61[_0x1249b9][_0x2fb95e(0xef)]=_0x21451e;}),_0x4fb40f[_0x3b0b75(0x150)]((_0x1c8eb6,_0x5285e0)=>{var _0x1ba91b=_0x3b0b75;_0x190b34[_0x1ba91b(0x150)]((_0x3f6119,_0x1a452b)=>{var _0x5d72f4=_0x1ba91b;if(_0x3f6119=='Receiving\x20Area'&&_0x5285e0==_0x1a452b){var _0x11f5eb=_0x1c8eb6[_0x5d72f4(0xe6)](0x3);_0x21ef61[_0x5285e0][_0x5d72f4(0x136)]=_0x1c8eb6[0x0],_0x21ef61[_0x5285e0]['rack']=_0x1c8eb6[0x1],_0x21ef61[_0x5285e0][_0x5d72f4(0xf1)]=0x0,_0x21ef61[_0x5285e0][_0x5d72f4(0x13a)]=0x0,_0x21ef61[_0x5285e0][_0x5d72f4(0x1f4)]=_0x5d72f4(0x148),_0x21ef61[_0x5285e0]['floorlevel']=_0x11f5eb;}else{if(_0x3f6119==_0x5d72f4(0x1f6)&&_0x5285e0==_0x1a452b){var _0x11f5eb=_0x1c8eb6['slice'](0x3);_0x21ef61[_0x5285e0][_0x5d72f4(0x136)]=_0x1c8eb6[0x0],_0x21ef61[_0x5285e0]['rack']=_0x1c8eb6[0x1],_0x21ef61[_0x5285e0][_0x5d72f4(0xf1)]=0x0,_0x21ef61[_0x5285e0][_0x5d72f4(0x13a)]=0x0,_0x21ef61[_0x5285e0]['type']='Floor',_0x21ef61[_0x5285e0][_0x5d72f4(0x17b)]=_0x1c8eb6[0x5];}else{if(_0x5285e0==_0x1a452b){var _0x26a315;if(_0x1c8eb6[0x4]=='L')_0x26a315=_0x5d72f4(0x17e);else _0x1c8eb6[0x4]=='F'&&(_0x26a315=_0x5d72f4(0x148));_0x21ef61[_0x5285e0]['storage']=_0x1c8eb6[0x0],_0x21ef61[_0x5285e0]['rack']=_0x1c8eb6[0x1],_0x21ef61[_0x5285e0][_0x5d72f4(0xf1)]=_0x1c8eb6[0x2],_0x21ef61[_0x5285e0]['bin']=_0x1c8eb6[0x3],_0x21ef61[_0x5285e0][_0x5d72f4(0x1f4)]=_0x26a315,_0x21ef61[_0x5285e0][_0x5d72f4(0x17b)]=_0x1c8eb6[0x5];}}}});}),_0x42f3e2['forEach']((_0x10d9a6,_0x4e29b9)=>{_0x21ef61[_0x4e29b9]['unit']=_0x10d9a6;}),_0x1fbc13[_0x3b0b75(0x150)]((_0x29eb12,_0xe5cf79)=>{var _0x204870=_0x3b0b75;_0x21ef61[_0xe5cf79][_0x204870(0x143)]=_0x29eb12;}),_0x2eea4a[_0x3b0b75(0x150)]((_0x1ab7c0,_0x3ef462)=>{var _0x36fc38=_0x3b0b75;_0x21ef61[_0x3ef462][_0x36fc38(0x1ad)]=_0x1ab7c0;}),_0x478493['forEach']((_0x2b2db9,_0x777831)=>{_0x21ef61[_0x777831]['expiry_date']=_0x2b2db9;}),_0x132f0b[_0x3b0b75(0x150)]((_0x2a10d4,_0x470967)=>{var _0x49985f=_0x3b0b75;_0x21ef61[_0x470967][_0x49985f(0x111)]=_0x2a10d4;}),_0x12f58e[_0x3b0b75(0x150)]((_0x575d2e,_0xa6d57d)=>{_0x21ef61[_0xa6d57d]['production_date']=_0x575d2e;}),_0x5df8f4[_0x3b0b75(0x150)]((_0x4b1d0a,_0x323ecd)=>{var _0x3b059d=_0x3b0b75;_0x21ef61[_0x323ecd][_0x3b059d(0x117)]=_0x4b1d0a;}),_0xce63ad[_0x3b0b75(0x150)]((_0x438631,_0xd6a8fc)=>{var _0x36e27d=_0x3b0b75;_0x21ef61[_0xd6a8fc][_0x36e27d(0x159)]=_0x438631;}),_0x477c1b[_0x3b0b75(0x150)]((_0x26d3d3,_0x772c9a)=>{var _0xf8fdc2=_0x3b0b75;_0x21ef61[_0x772c9a][_0xf8fdc2(0x1cc)]=_0x26d3d3;}),_0x17fb6b['forEach']((_0x4b5671,_0x567dc0)=>{var _0x56f727=_0x3b0b75;_0x21ef61[_0x567dc0][_0x56f727(0x11c)]=_0x4b5671;}),_0x329dae['forEach']((_0xdfcce,_0x8c289c)=>{_0x21ef61[_0x8c289c]['quantity_notConverted']=_0xdfcce;}),_0x190b34[_0x3b0b75(0x150)]((_0x260dfd,_0x4da6e5)=>{_0x21ef61[_0x4da6e5]['room_name']=_0x260dfd;}),_0x581ef0[_0x3b0b75(0x150)]((_0x59199d,_0x417a5d)=>{var _0x41f443=_0x3b0b75;_0x21ef61[_0x417a5d][_0x41f443(0x169)]=_0x59199d;});var _0x431643=0x0;_0x21ef61[_0x3b0b75(0x150)](_0x3808bc=>{var _0x1c43c1=_0x3b0b75;(_0x3808bc[_0x1c43c1(0x144)]<_0x3808bc[_0x1c43c1(0x17a)]||_0x3808bc[_0x1c43c1(0x17a)]==0x0)&&(console[_0x1c43c1(0x128)]('foreach\x20newproduct',_0x3808bc),_0x431643++);});const _0x3ef96a=_0x21ef61[_0x3b0b75(0x12b)](_0x2c8478=>_0x2c8478['quantity']!=='0'&&_0x2c8478[_0x3b0b75(0x172)]!==''),_0x457a04=new sales({'invoice':_0x3d10dd,'customer':_0x459b8c[_0x3b0b75(0x15d)]['customer'],'date':_0x527cb4,'warehouse_name':_0xe3567,'sale_product':_0x3ef96a,'note':_0x457ff8,'room':_0x6c1ddf,'primary_code':_0x4255d6,'secondary_code':_0x54468f,'prod_code':_0x404b12,'SCRN':_0x263d20}),_0x11dfeb=await _0x457a04[_0x3b0b75(0x10b)]();_0x459b8c['flash'](_0x3b0b75(0x1c2),_0x3b0b75(0x157)),_0x2b0b4f['redirect']('/all_sales/preview/'+_0x11dfeb[_0x3b0b75(0x10a)]);}catch(_0x38c305){console['log'](_0x38c305);}}),router[a0_0x57f966(0x180)]('/preview/:id',auth,async(_0x10b634,_0x549f4f)=>{var _0x12e9fb=a0_0x57f966;try{const {username:_0x30b4f0,email:_0x366bf9,role:_0x34c57f}=_0x10b634[_0x12e9fb(0x1c7)],_0x2ceeda=_0x10b634[_0x12e9fb(0x1c7)],_0x31fe2c=await profile[_0x12e9fb(0x133)]({'email':_0x2ceeda[_0x12e9fb(0x1be)]}),_0x515373=await master_shop[_0x12e9fb(0x16e)](),_0x1f18bb=_0x10b634[_0x12e9fb(0x1c8)]['id'],_0x482075=await sales[_0x12e9fb(0x1e1)](_0x1f18bb),_0x4a37c2=await warehouse[_0x12e9fb(0x122)]([{'$match':{'name':_0x482075[_0x12e9fb(0x138)]}},{'$unwind':_0x12e9fb(0x1d4)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x12e9fb(0x176)},'product_stock':{'$first':_0x12e9fb(0x155)},'bay':{'$first':_0x12e9fb(0x191)},'bin':{'$first':_0x12e9fb(0x132)},'type':{'$first':_0x12e9fb(0x1c3)},'floorlevel':{'$first':_0x12e9fb(0x107)},'primary_code':{'$first':_0x12e9fb(0x1ce)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x12e9fb(0x17f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x12e9fb(0x1a6)},'expiry_date':{'$first':_0x12e9fb(0x1e8)},'production_date':{'$first':_0x12e9fb(0x145)},'invoice':{'$first':_0x12e9fb(0x1e5)}}}]),_0x225584=await customer[_0x12e9fb(0x16e)]({});let _0x473061;if(_0x2ceeda[_0x12e9fb(0x1ef)]=='staff'){const _0x3cb775=await staff[_0x12e9fb(0x133)]({'email':_0x2ceeda[_0x12e9fb(0x1be)]});_0x473061=await warehouse[_0x12e9fb(0x122)]([{'$match':{'status':_0x12e9fb(0x193),'name':_0x3cb775['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x12e9fb(0x10c)}}}]);}else _0x473061=await warehouse[_0x12e9fb(0x122)]([{'$match':{'status':_0x12e9fb(0x193)}},{'$group':{'_id':_0x12e9fb(0x10c),'name':{'$first':_0x12e9fb(0x10c)}}}]);const _0x46ebf0=await product[_0x12e9fb(0x16e)]({}),_0x2bbe7b=await suppliers['find']({});if(_0x515373[0x0][_0x12e9fb(0xfb)]==_0x12e9fb(0x164)){var _0x53cab8=users['English'];console['log'](_0x53cab8);}else{if(_0x515373[0x0][_0x12e9fb(0xfb)]==_0x12e9fb(0x179))var _0x53cab8=users[_0x12e9fb(0x179)];else{if(_0x515373[0x0][_0x12e9fb(0xfb)]=='German')var _0x53cab8=users[_0x12e9fb(0x1dc)];else{if(_0x515373[0x0][_0x12e9fb(0xfb)]==_0x12e9fb(0x140))var _0x53cab8=users[_0x12e9fb(0x140)];else{if(_0x515373[0x0][_0x12e9fb(0xfb)]==_0x12e9fb(0x1d1))var _0x53cab8=users[_0x12e9fb(0x1d1)];else{if(_0x515373[0x0][_0x12e9fb(0xfb)]==_0x12e9fb(0x15c))var _0x53cab8=users[_0x12e9fb(0x12f)];else{if(_0x515373[0x0][_0x12e9fb(0xfb)]=='Chinese')var _0x53cab8=users[_0x12e9fb(0x1a1)];else{if(_0x515373[0x0][_0x12e9fb(0xfb)]==_0x12e9fb(0x1b2))var _0x53cab8=users[_0x12e9fb(0xec)];}}}}}}}_0x549f4f[_0x12e9fb(0x1c0)]('edit_sales_view',{'success':_0x10b634['flash']('success'),'errors':_0x10b634['flash'](_0x12e9fb(0xee)),'role':_0x2ceeda,'profile':_0x31fe2c,'customer':_0x225584,'warehouse':_0x473061,'product':_0x4a37c2,'user':_0x482075,'master_shop':_0x515373,'unit':_0x46ebf0,'language':_0x53cab8,'suppliers':_0x2bbe7b});}catch(_0x2814dc){console[_0x12e9fb(0x128)](_0x2814dc);}}),router['post'](a0_0x57f966(0xe1),auth,async(_0x32b410,_0x1c607e)=>{var _0x3bbfb0=a0_0x57f966;try{const _0x3a6714=_0x32b410[_0x3bbfb0(0x1c8)]['id'],{invoice:_0x16119b,warehouse_name:_0x1b8202,room:_0x125b72}=_0x32b410[_0x3bbfb0(0x15d)],_0x8d6944=await sales[_0x3bbfb0(0x133)]({'invoice':_0x16119b}),_0x36da78=_0x8d6944[_0x3bbfb0(0x109)][_0x3bbfb0(0x195)](async _0x561a7a=>{var _0x576e2a=_0x3bbfb0,_0x27afdb=await warehouse[_0x576e2a(0x133)]({'name':_0x1b8202,'room':_0x561a7a['room_name'],'warehouse_category':_0x576e2a(0x152)});const _0x75d7f3=_0x27afdb[_0x576e2a(0x156)][_0x576e2a(0x195)](_0x488043=>{var _0x4a8995=_0x576e2a;_0x488043[_0x4a8995(0x18b)]==_0x561a7a[_0x4a8995(0x18b)]&&_0x488043[_0x4a8995(0x17b)]==_0x561a7a[_0x4a8995(0x17b)]&&_0x488043[_0x4a8995(0x1f4)]==_0x561a7a[_0x4a8995(0x1f4)]&&_0x488043['bin']==_0x561a7a[_0x4a8995(0x13a)]&&_0x488043['bay']==_0x561a7a[_0x4a8995(0xf1)]&&_0x488043[_0x4a8995(0x16a)]==_0x561a7a[_0x4a8995(0x16a)]&&_0x488043['storage']==_0x561a7a[_0x4a8995(0x136)]&&_0x488043[_0x4a8995(0x166)]==_0x561a7a[_0x4a8995(0x166)]&&_0x488043[_0x4a8995(0x1ad)]==_0x561a7a['batch_code']&&_0x488043[_0x4a8995(0x169)]==_0x561a7a[_0x4a8995(0x169)]&&_0x488043[_0x4a8995(0x10a)]==_0x561a7a[_0x4a8995(0x1df)]&&(_0x488043[_0x4a8995(0xe3)]=Math[_0x4a8995(0x19c)](0x0,Math['abs'](_0x488043[_0x4a8995(0xe3)])-Math[_0x4a8995(0x1e3)](_0x561a7a[_0x4a8995(0x172)])));});return _0x27afdb;});Promise[_0x3bbfb0(0x1d5)](_0x36da78)[_0x3bbfb0(0x123)](async _0x422d12=>{var _0x5073e0=_0x3bbfb0;try{for(const _0xb1afcc of _0x422d12){await _0xb1afcc[_0x5073e0(0x10b)]();}_0x8d6944[_0x5073e0(0x196)]=_0x5073e0(0x105);const _0x978299=await _0x8d6944[_0x5073e0(0x10b)](),_0x2e631e=await master_shop['find'](),_0x35636d=await email_settings[_0x5073e0(0x133)](),_0x222c7a=await supervisor_settings[_0x5073e0(0x16e)]();var _0xf8a461=_0x8d6944[_0x5073e0(0x109)],_0x524870='',_0xe8a203;for(_0xe8a203 in _0xf8a461){_0x524870+=_0x5073e0(0x1e0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf8a461[_0xe8a203][_0x5073e0(0x18b)]+_0x5073e0(0x175)+_0x5073e0(0x14d)+_0xf8a461[_0xe8a203][_0x5073e0(0xef)]+_0x5073e0(0x175)+_0x5073e0(0x14d)+_0xf8a461[_0xe8a203]['quantity']+_0x5073e0(0x175)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf8a461[_0xe8a203][_0x5073e0(0xf0)]+'</td>'+_0x5073e0(0x14d)+_0xf8a461[_0xe8a203][_0x5073e0(0x143)]+_0x5073e0(0x175)+_0x5073e0(0x14d)+_0x8d6944[_0x5073e0(0x138)]+_0x5073e0(0x175)+_0x5073e0(0x14d)+_0xf8a461[_0xe8a203][_0x5073e0(0x1db)]+_0x5073e0(0x175)+_0x5073e0(0x14d)+_0xf8a461[_0xe8a203][_0x5073e0(0x136)]+_0xf8a461[_0xe8a203][_0x5073e0(0x16a)]+_0xf8a461[_0xe8a203][_0x5073e0(0xf1)]+_0xf8a461[_0xe8a203][_0x5073e0(0x13a)]+_0xf8a461[_0xe8a203][_0x5073e0(0x1f4)][0x0]+_0xf8a461[_0xe8a203]['floorlevel']+_0x5073e0(0x175),_0x5073e0(0x1bd);}let _0x405801=nodemailer[_0x5073e0(0x127)]({'host':_0x35636d['host'],'port':Number(_0x35636d['port']),'secure':![],'auth':{'user':_0x35636d[_0x5073e0(0x1be)],'pass':_0x35636d['password']}}),_0x3c8673={'from':_0x35636d['email'],'to':_0x222c7a[0x0]['RMSEmail'],'subject':_0x5073e0(0x1b5),'attachments':[{'filename':_0x5073e0(0xfa),'path':__dirname+'/../public'+_0x5073e0(0x1c4)+_0x2e631e[0x0][_0x5073e0(0x10e)],'cid':_0x5073e0(0x1ab)}],'html':_0x5073e0(0x1bc)+_0x5073e0(0x17d)+_0x5073e0(0x139)+_0x5073e0(0x16b)+_0x5073e0(0xf7)+_0x5073e0(0x16b)+_0x5073e0(0x1e4)+'</div>'+_0x5073e0(0x16b)+_0x5073e0(0x12e)+_0x2e631e[0x0][_0x5073e0(0xe7)]+'\x20</h2>'+_0x5073e0(0x1ec)+'</div>'+_0x5073e0(0x108)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5073e0(0xe5)+_0x8d6944[_0x5073e0(0x169)]+'\x20'+_0x5073e0(0x146)+_0x5073e0(0x110)+_0x8d6944[_0x5073e0(0x1dd)]+'\x20'+'</span>'+_0x5073e0(0x1f3)+'</div>'+_0x5073e0(0x170)+_0x5073e0(0x185)+_0x5073e0(0x1e0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5073e0(0x1f0)+_0x5073e0(0x10d)+_0x5073e0(0x118)+_0x5073e0(0x11d)+_0x5073e0(0x100)+_0x5073e0(0xeb)+_0x5073e0(0x119)+_0x5073e0(0x1bd)+_0x5073e0(0x13f)+_0x5073e0(0x1ac)+'\x20'+_0x524870+'\x20'+_0x5073e0(0x1d2)+'</table>'+'<div>'+_0x5073e0(0xff)+_0x5073e0(0x112)+_0x2e631e[0x0][_0x5073e0(0xe7)]+_0x5073e0(0x1f3)+'</div>'+_0x5073e0(0x1ec)+_0x5073e0(0x178)};_0x405801[_0x5073e0(0x162)](_0x3c8673,function(_0x8a6432,_0x41401e){var _0x447357=_0x5073e0;_0x8a6432?(console[_0x447357(0x128)](_0x8a6432),console['log'](_0x447357(0x19f))):console[_0x447357(0x128)](_0x447357(0x103));}),_0x32b410[_0x5073e0(0x12c)](_0x5073e0(0x1c2),'Sales\x20Update\x20successfully'),_0x1c607e[_0x5073e0(0x1de)](_0x5073e0(0x1ed)+_0x3a6714);}catch(_0x32d50a){console[_0x5073e0(0x114)](_0x32d50a),_0x1c607e[_0x5073e0(0x1ca)](0x1f4)[_0x5073e0(0x187)]({'error':_0x5073e0(0x1e7)});}})[_0x3bbfb0(0x1bf)](_0x145f6e=>{var _0x5c0d40=_0x3bbfb0;console[_0x5c0d40(0x114)](_0x145f6e),_0x1c607e['status'](0x1f4)[_0x5c0d40(0x187)]({'error':_0x5c0d40(0x197)});});}catch(_0x2aa3b0){console[_0x3bbfb0(0x128)](_0x2aa3b0);}}),router['get'](a0_0x57f966(0x121),auth,async(_0x2e8e89,_0x149891)=>{var _0x4114ab=a0_0x57f966;try{const {username:_0x4ec4bd,email:_0x41e872,role:_0x32567d}=_0x2e8e89['user'],_0x5b862c=_0x2e8e89['user'],_0x115ae3=await profile['findOne']({'email':_0x5b862c[_0x4114ab(0x1be)]}),_0x5c4470=await master_shop['find'](),_0x2d09ce=_0x2e8e89['params']['id'],_0x4f0706=await sales[_0x4114ab(0x1e1)](_0x2d09ce);var _0x5643c6=['Ambient',_0x4114ab(0x1d0)];const _0x57e8bd=await warehouse[_0x4114ab(0x122)]([{'$match':{'name':_0x4f0706[_0x4114ab(0x138)],'warehouse_category':_0x4114ab(0x152)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4114ab(0x1b8),'name':{'$first':_0x4114ab(0x176)},'product_stock':{'$first':_0x4114ab(0x155)},'bay':{'$first':_0x4114ab(0x191)},'bin':{'$first':_0x4114ab(0x132)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4114ab(0x107)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4114ab(0x1c1)},'product_code':{'$first':_0x4114ab(0x17f)},'storage':{'$first':_0x4114ab(0x177)},'rack':{'$first':'$product_details.rack'}}}]),_0x2e892d=await customer['find']({});let _0x5658f7;if(_0x5b862c[_0x4114ab(0x1ef)]==_0x4114ab(0x18a)){const _0x26d14b=await staff[_0x4114ab(0x133)]({'email':_0x5b862c[_0x4114ab(0x1be)]});_0x5658f7=await warehouse[_0x4114ab(0x122)]([{'$match':{'status':_0x4114ab(0x193),'name':_0x26d14b[_0x4114ab(0xf6)],'warehouse_category':_0x4114ab(0x152)}},{'$group':{'_id':_0x4114ab(0x10c),'name':{'$first':_0x4114ab(0x10c)}}}]);}else _0x5658f7=await warehouse[_0x4114ab(0x122)]([{'$match':{'status':_0x4114ab(0x193),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4114ab(0x10c),'name':{'$first':_0x4114ab(0x10c)}}}]);const _0x1c4813=await product[_0x4114ab(0x16e)]({});if(_0x5c4470[0x0]['language']==_0x4114ab(0x164)){var _0x4d54ed=users[_0x4114ab(0x1b4)];console[_0x4114ab(0x128)](_0x4d54ed);}else{if(_0x5c4470[0x0][_0x4114ab(0xfb)]==_0x4114ab(0x179))var _0x4d54ed=users[_0x4114ab(0x179)];else{if(_0x5c4470[0x0]['language']=='German')var _0x4d54ed=users[_0x4114ab(0x1dc)];else{if(_0x5c4470[0x0][_0x4114ab(0xfb)]==_0x4114ab(0x140))var _0x4d54ed=users['Spanish'];else{if(_0x5c4470[0x0][_0x4114ab(0xfb)]==_0x4114ab(0x1d1))var _0x4d54ed=users['French'];else{if(_0x5c4470[0x0][_0x4114ab(0xfb)]==_0x4114ab(0x15c))var _0x4d54ed=users[_0x4114ab(0x12f)];else{if(_0x5c4470[0x0]['language']==_0x4114ab(0x1a1))var _0x4d54ed=users[_0x4114ab(0x1a1)];else{if(_0x5c4470[0x0][_0x4114ab(0xfb)]==_0x4114ab(0x1b2))var _0x4d54ed=users['Arabic'];}}}}}}}_0x149891[_0x4114ab(0x1c0)](_0x4114ab(0x1f1),{'success':_0x2e8e89[_0x4114ab(0x12c)](_0x4114ab(0x1c2)),'errors':_0x2e8e89[_0x4114ab(0x12c)](_0x4114ab(0xee)),'role':_0x5b862c,'profile':_0x115ae3,'customer':_0x2e892d,'warehouse':_0x5658f7,'product':_0x57e8bd,'user':_0x4f0706,'master_shop':_0x5c4470,'unit':_0x1c4813,'language':_0x4d54ed});}catch(_0x4990d3){console[_0x4114ab(0x128)](_0x4990d3);}}),router['post'](a0_0x57f966(0x121),auth,async(_0x11df42,_0x17062c)=>{var _0x4d127c=a0_0x57f966;try{const _0x29b760=_0x11df42[_0x4d127c(0x1c8)]['id'],_0x320f8a=await sales['findOne']({'_id':_0x11df42['params']['id']}),_0x5f559e=await warehouse[_0x4d127c(0x133)]({'name':_0x320f8a['warehouse_name'],'room':_0x11df42['body'][_0x4d127c(0x182)]}),{invoice:_0xb2cc0c,date:_0x1ecac8,warehouse_name:_0x2fdf16,product_name:_0x31d1bf,stock:_0xdf8651,quantity:_0x375eeb,note:_0xc0005f,room:_0x361221,customer:_0x90b788,SCRN:_0x5b50ca}=_0x11df42[_0x4d127c(0x15d)];if(typeof _0x31d1bf==_0x4d127c(0xf5))var _0x238418=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x18b)]],_0x24a78d=[_0x11df42['body'][_0x4d127c(0x144)]],_0x3cb1f5=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1a3)]],_0x4547ad=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1e9)]],_0x3d4d41=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x183)]],_0x4f73e0=[_0x11df42[_0x4d127c(0x15d)]['prod_code']],_0x3c2eb2=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1af)]],_0x5e9ca5=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x141)]],_0x4e2654=[_0x11df42['body'][_0x4d127c(0x143)]],_0x4c6110=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1ad)]],_0x1f6cc0=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x166)]],_0x395a84=[_0x11df42[_0x4d127c(0x15d)]['max_per_unit']],_0x5263ba=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x142)]],_0x200a22=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x117)]],_0x4fe07e=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x159)]],_0x1e7d2a=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1cc)]],_0x1072ba=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x11c)]],_0x17e486=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x172)]],_0x55f910=[_0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x18e)]];else var _0x238418=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x18b)]],_0x24a78d=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x144)]],_0x3cb1f5=[..._0x11df42['body'][_0x4d127c(0x1a3)]],_0x4547ad=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1e9)]],_0x3d4d41=[..._0x11df42['body'][_0x4d127c(0x183)]],_0x4f73e0=[..._0x11df42['body'][_0x4d127c(0x1d3)]],_0x3c2eb2=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1af)]],_0x5e9ca5=[..._0x11df42['body'][_0x4d127c(0x141)]],_0x4e2654=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x143)]],_0x4c6110=[..._0x11df42['body']['batch_code']],_0x1f6cc0=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x166)]],_0x395a84=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x131)]],_0x5263ba=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x142)]],_0x200a22=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x117)]],_0x4fe07e=[..._0x11df42['body'][_0x4d127c(0x159)]],_0x1e7d2a=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x1cc)]],_0x1072ba=[..._0x11df42['body'][_0x4d127c(0x11c)]],_0x17e486=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x172)]],_0x55f910=[..._0x11df42[_0x4d127c(0x15d)][_0x4d127c(0x18e)]];const _0xed798a=_0x238418[_0x4d127c(0x195)](_0x3847cb=>{return _0x3847cb={'product_name':_0x3847cb};});_0x24a78d[_0x4d127c(0x150)]((_0x38aac0,_0x105542)=>{var _0x326313=_0x4d127c;_0xed798a[_0x105542]['stock']=Math[_0x326313(0x1e3)](_0x38aac0);}),_0x3cb1f5[_0x4d127c(0x150)]((_0x441250,_0x363d5b)=>{var _0x317c15=_0x4d127c;_0xed798a[_0x363d5b][_0x317c15(0x172)]=_0x441250;}),_0x4547ad[_0x4d127c(0x150)]((_0x415038,_0x250c88)=>{var _0x51d548=_0x4d127c;_0xed798a[_0x250c88][_0x51d548(0x1e9)]=_0x415038;}),_0x3d4d41[_0x4d127c(0x150)]((_0x5962d5,_0x16499e)=>{var _0x1b57d7=_0x4d127c;_0xed798a[_0x16499e][_0x1b57d7(0x183)]=_0x5962d5;}),_0x4f73e0[_0x4d127c(0x150)]((_0x1fc496,_0x5c9742)=>{var _0x59808b=_0x4d127c;_0xed798a[_0x5c9742][_0x59808b(0xef)]=_0x1fc496;}),_0x3c2eb2[_0x4d127c(0x150)]((_0x30c62a,_0xe4247b)=>{var _0x3ea009=_0x4d127c;_0x55f910[_0x3ea009(0x150)]((_0x4d8905,_0x4cbd82)=>{var _0x5ab10a=_0x3ea009;if(_0x4d8905==_0x5ab10a(0x1cb)&&_0xe4247b==_0x4cbd82){var _0x94eac6=_0x30c62a['slice'](0x3);_0xed798a[_0xe4247b]['storage']=_0x30c62a[0x0],_0xed798a[_0xe4247b][_0x5ab10a(0x16a)]=_0x30c62a[0x1],_0xed798a[_0xe4247b]['bay']=0x0,_0xed798a[_0xe4247b][_0x5ab10a(0x13a)]=0x0,_0xed798a[_0xe4247b][_0x5ab10a(0x1f4)]=_0x5ab10a(0x148),_0xed798a[_0xe4247b][_0x5ab10a(0x17b)]=_0x94eac6;}else{if(_0x4d8905==_0x5ab10a(0x1f6)&&_0xe4247b==_0x4cbd82){var _0x94eac6=_0x30c62a[_0x5ab10a(0xe6)](0x3);_0xed798a[_0xe4247b]['storage']=_0x30c62a[0x0],_0xed798a[_0xe4247b][_0x5ab10a(0x16a)]=_0x30c62a[0x1],_0xed798a[_0xe4247b]['bay']=0x0,_0xed798a[_0xe4247b][_0x5ab10a(0x13a)]=0x0,_0xed798a[_0xe4247b]['type']=_0x5ab10a(0x148),_0xed798a[_0xe4247b][_0x5ab10a(0x17b)]=_0x30c62a[0x5];}else{if(_0xe4247b==_0x4cbd82){var _0x350318;if(_0x30c62a[0x4]=='L')_0x350318=_0x5ab10a(0x17e);else _0x30c62a[0x4]=='F'&&(_0x350318='Floor');_0xed798a[_0xe4247b][_0x5ab10a(0x136)]=_0x30c62a[0x0],_0xed798a[_0xe4247b][_0x5ab10a(0x16a)]=_0x30c62a[0x1],_0xed798a[_0xe4247b][_0x5ab10a(0xf1)]=_0x30c62a[0x2],_0xed798a[_0xe4247b][_0x5ab10a(0x13a)]=_0x30c62a[0x3],_0xed798a[_0xe4247b][_0x5ab10a(0x1f4)]=_0x350318,_0xed798a[_0xe4247b][_0x5ab10a(0x17b)]=_0x30c62a[0x5];}}}});}),_0x5e9ca5[_0x4d127c(0x150)]((_0x37bfc8,_0x1185fd)=>{var _0x399482=_0x4d127c;_0xed798a[_0x1185fd][_0x399482(0xf0)]=_0x37bfc8;}),_0x4e2654[_0x4d127c(0x150)]((_0x4d8845,_0x3e82ab)=>{var _0x54a33e=_0x4d127c;_0xed798a[_0x3e82ab][_0x54a33e(0x143)]=_0x4d8845;}),_0x4c6110[_0x4d127c(0x150)]((_0x4e5fa7,_0x34e3c9)=>{var _0x238d70=_0x4d127c;_0xed798a[_0x34e3c9][_0x238d70(0x1ad)]=_0x4e5fa7;}),_0x1f6cc0[_0x4d127c(0x150)]((_0x4ccffe,_0x1b549a)=>{var _0x29c404=_0x4d127c;_0xed798a[_0x1b549a][_0x29c404(0x166)]=_0x4ccffe;}),_0x395a84['forEach']((_0x276f1d,_0x1acee7)=>{var _0x18675d=_0x4d127c;_0xed798a[_0x1acee7][_0x18675d(0x111)]=_0x276f1d;}),_0x5263ba[_0x4d127c(0x150)]((_0x40d8b7,_0x13865a)=>{_0xed798a[_0x13865a]['production_date']=_0x40d8b7;}),_0x200a22[_0x4d127c(0x150)]((_0x491346,_0x5b9e5a)=>{var _0x33c55d=_0x4d127c;_0xed798a[_0x5b9e5a][_0x33c55d(0x117)]=Math[_0x33c55d(0x1e3)](_0x491346);}),_0x4fe07e[_0x4d127c(0x150)]((_0x5dc042,_0x4d9a65)=>{_0xed798a[_0x4d9a65]['delivery_date']=_0x5dc042;}),_0x1e7d2a[_0x4d127c(0x150)]((_0x123a93,_0x491cee)=>{var _0x13bfec=_0x4d127c;_0xed798a[_0x491cee][_0x13bfec(0x1cc)]=_0x123a93;}),_0x1072ba['forEach']((_0x3211ea,_0x3026cb)=>{var _0xd482ab=_0x4d127c;_0xed798a[_0x3026cb][_0xd482ab(0x11c)]=_0x3211ea;}),_0x17e486[_0x4d127c(0x150)]((_0x418d09,_0x1b5d7c)=>{var _0x390f2b=_0x4d127c;_0xed798a[_0x1b5d7c][_0x390f2b(0x17a)]=_0x418d09;}),_0x55f910[_0x4d127c(0x150)]((_0x29311f,_0x1112d0)=>{_0xed798a[_0x1112d0]['room_name']=_0x29311f;});var _0x4f4a61=0x0;_0xed798a[_0x4d127c(0x150)](_0x22eeb2=>{var _0x5b8525=_0x4d127c;console['log'](_0x5b8525(0xf4),_0x22eeb2),(parseInt(_0x22eeb2['stock'])<parseInt(_0x22eeb2[_0x5b8525(0x172)])||parseInt(_0x22eeb2[_0x5b8525(0x172)])==0x0)&&_0x4f4a61++;});if(_0x4f4a61!=0x0)return _0x11df42['flash'](_0x4d127c(0xee),_0x4d127c(0x134)),_0x17062c[_0x4d127c(0x1de)](_0x4d127c(0xed));const _0x32e13a=_0xed798a[_0x4d127c(0x12b)](_0x5306b7=>_0x5306b7[_0x4d127c(0x172)]!=='0'&&_0x5306b7[_0x4d127c(0x172)]!=='');_0x320f8a['invoice']=_0xb2cc0c,_0x320f8a['customer']=_0x90b788,_0x320f8a[_0x4d127c(0x1dd)]=_0x1ecac8,_0x320f8a[_0x4d127c(0x138)]=_0x2fdf16,_0x320f8a[_0x4d127c(0x109)]=_0x32e13a,_0x320f8a['note']=_0xc0005f,_0x320f8a[_0x4d127c(0x1b9)]=_0x5b50ca,_0x320f8a[_0x4d127c(0x196)]='False',_0x320f8a[_0x4d127c(0x101)]='False';const _0x5142fa=await _0x320f8a[_0x4d127c(0x10b)]();_0x11df42[_0x4d127c(0x12c)](_0x4d127c(0x1c2),_0x4d127c(0x1aa)),_0x17062c[_0x4d127c(0x1de)](_0x4d127c(0x14c));}catch(_0x4f650d){console[_0x4d127c(0x128)](_0x4f650d);}}),router['post'](a0_0x57f966(0x1f2),auth,async(_0x32464c,_0x4bc1c0)=>{var _0x5658a9=a0_0x57f966;try{const _0x2cea70=_0x32464c[_0x5658a9(0x1c8)]['id'],{invoice:_0x5b1260,customer:_0x1e4e73,receivable_amount:_0xcca2a6,received_amount:_0x291fd0}=_0x32464c[_0x5658a9(0x15d)],_0x567bd2=await sales[_0x5658a9(0x1e1)](_0x2cea70);console[_0x5658a9(0x128)](_0x567bd2);var _0x22185f=_0xcca2a6-_0x291fd0;console[_0x5658a9(0x128)](_0x291fd0),_0x567bd2['received_amount']=parseFloat(_0x291fd0)+parseFloat(_0x567bd2[_0x5658a9(0x147)]),_0x567bd2[_0x5658a9(0x16f)]=_0x22185f,console[_0x5658a9(0x128)](_0x567bd2);const _0x54939e=await _0x567bd2[_0x5658a9(0x10b)](),_0x33cd8f=await c_payment_data[_0x5658a9(0x133)]({'invoice':_0x5b1260});_0x33cd8f[_0x5658a9(0x1bb)]=_0x22185f,await _0x33cd8f[_0x5658a9(0x10b)]();let _0x3f1e4f=new Date(),_0x1fa6b1=('0'+_0x3f1e4f[_0x5658a9(0x106)]())[_0x5658a9(0xe6)](-0x2),_0x2253d8=('0'+(_0x3f1e4f[_0x5658a9(0x13d)]()+0x1))['slice'](-0x2),_0x3db466=_0x3f1e4f['getFullYear'](),_0x224198=_0x3db466+'-'+_0x2253d8+'-'+_0x1fa6b1;const _0x35526d=new customer_payment({'invoice':_0x5b1260,'date':_0x3db466+'-'+_0x2253d8+'-'+_0x1fa6b1,'customer':_0x1e4e73,'reason':_0x5658a9(0x194),'amount':_0x291fd0}),_0x3fb2b6=await _0x35526d['save']();_0x32464c[_0x5658a9(0x12c)](_0x5658a9(0x1c2),_0x5658a9(0x102)),_0x4bc1c0[_0x5658a9(0x1de)](_0x5658a9(0x14c));}catch(_0x3c7a94){console[_0x5658a9(0x128)](_0x3c7a94);}}),router[a0_0x57f966(0x180)](a0_0x57f966(0x1eb),auth,async(_0x120891,_0x5bcd21)=>{var _0x1efa65=a0_0x57f966;try{const {username:_0x2368a5,email:_0x3d2999,role:_0x10556b}=_0x120891[_0x1efa65(0x1c7)],_0x3548c1=_0x120891[_0x1efa65(0x1c7)],_0x82fadb=await profile[_0x1efa65(0x133)]({'email':_0x3548c1['email']}),_0x203b2b=await master_shop[_0x1efa65(0x16e)]();console[_0x1efa65(0x128)](_0x1efa65(0x18d),_0x203b2b);const _0x9d241d=_0x120891[_0x1efa65(0x1c8)]['id'],_0x55c3a1=await sales[_0x1efa65(0x1e1)](_0x9d241d);console[_0x1efa65(0x128)](_0x55c3a1);const _0x3e9c5c=await customer['findOne']({'name':_0x55c3a1[_0x1efa65(0x1b7)]});console['log'](_0x3e9c5c);if(_0x203b2b[0x0]['language']==_0x1efa65(0x164)){var _0x54cea9=users[_0x1efa65(0x1b4)];console[_0x1efa65(0x128)](_0x54cea9);}else{if(_0x203b2b[0x0]['language']==_0x1efa65(0x179))var _0x54cea9=users[_0x1efa65(0x179)];else{if(_0x203b2b[0x0]['language']==_0x1efa65(0x1dc))var _0x54cea9=users['German'];else{if(_0x203b2b[0x0]['language']==_0x1efa65(0x140))var _0x54cea9=users[_0x1efa65(0x140)];else{if(_0x203b2b[0x0]['language']==_0x1efa65(0x1d1))var _0x54cea9=users[_0x1efa65(0x1d1)];else{if(_0x203b2b[0x0][_0x1efa65(0xfb)]=='Portuguese\x20(BR)')var _0x54cea9=users[_0x1efa65(0x12f)];else{if(_0x203b2b[0x0]['language']==_0x1efa65(0x1a1))var _0x54cea9=users[_0x1efa65(0x1a1)];else{if(_0x203b2b[0x0][_0x1efa65(0xfb)]==_0x1efa65(0x1b2))var _0x54cea9=users[_0x1efa65(0xec)];}}}}}}}_0x5bcd21[_0x1efa65(0x1c0)](_0x1efa65(0xe9),{'success':_0x120891['flash'](_0x1efa65(0x1c2)),'errors':_0x120891[_0x1efa65(0x12c)](_0x1efa65(0xee)),'role':_0x3548c1,'profile':_0x82fadb,'master_shop':_0x203b2b,'customers':_0x3e9c5c,'sales':_0x55c3a1,'language':_0x54cea9});}catch(_0x593336){console[_0x1efa65(0x128)](_0x593336);}}),router[a0_0x57f966(0x180)](a0_0x57f966(0x14e),auth,async(_0x583eb6,_0x39283d)=>{var _0x46b92e=a0_0x57f966;try{const {username:_0x20719a,email:_0x5ab4fe,role:_0x2b159a}=_0x583eb6[_0x46b92e(0x1c7)],_0x96a261=_0x583eb6['user'],_0x7d4024=await profile['findOne']({'email':_0x96a261[_0x46b92e(0x1be)]}),_0xde2460=await master_shop[_0x46b92e(0x16e)]();console[_0x46b92e(0x128)]('master',_0xde2460);const _0x314313=_0x583eb6[_0x46b92e(0x1c8)]['id'];console[_0x46b92e(0x128)](_0x314313);const _0xcd103d=await sales[_0x46b92e(0x1e1)](_0x314313);console[_0x46b92e(0x128)](_0x46b92e(0x1cd),_0xcd103d);const _0x4dcd32=await warehouse[_0x46b92e(0x122)]([{'$match':{'name':_0x46b92e(0x120),'room':_0x46b92e(0x13b)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x46b92e(0x14f)},'isle':{'$first':_0x46b92e(0xfe)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x46b92e(0x1ce)},'secondary_code':{'$first':_0x46b92e(0x1c1)},'product_code':{'$first':_0x46b92e(0x17f)}}}]);console['log'](_0x46b92e(0x1a8),_0x4dcd32);const _0x4805ec=await product[_0x46b92e(0x16e)]({});warehouse_data=await warehouse[_0x46b92e(0x122)]([{'$match':{'status':_0x46b92e(0x193),'name':_0x46b92e(0x120),'warehouse_category':_0x46b92e(0x152)}},{'$group':{'_id':'$name','name':{'$first':_0x46b92e(0x10c)}}},{'$sort':{'name':0x1}}]);var _0x10f3e9=[_0x46b92e(0x13b)];if(_0xde2460[0x0][_0x46b92e(0xfb)]==_0x46b92e(0x164)){var _0x3db6cd=users[_0x46b92e(0x1b4)];console[_0x46b92e(0x128)](_0x3db6cd);}else{if(_0xde2460[0x0][_0x46b92e(0xfb)]=='Hindi')var _0x3db6cd=users[_0x46b92e(0x179)];else{if(_0xde2460[0x0][_0x46b92e(0xfb)]==_0x46b92e(0x1dc))var _0x3db6cd=users[_0x46b92e(0x1dc)];else{if(_0xde2460[0x0][_0x46b92e(0xfb)]==_0x46b92e(0x140))var _0x3db6cd=users[_0x46b92e(0x140)];else{if(_0xde2460[0x0][_0x46b92e(0xfb)]==_0x46b92e(0x1d1))var _0x3db6cd=users[_0x46b92e(0x1d1)];else{if(_0xde2460[0x0][_0x46b92e(0xfb)]==_0x46b92e(0x15c))var _0x3db6cd=users[_0x46b92e(0x12f)];else{if(_0xde2460[0x0][_0x46b92e(0xfb)]==_0x46b92e(0x1a1))var _0x3db6cd=users[_0x46b92e(0x1a1)];else{if(_0xde2460[0x0][_0x46b92e(0xfb)]=='Arabic\x20(ae)')var _0x3db6cd=users[_0x46b92e(0xec)];}}}}}}}_0x39283d[_0x46b92e(0x1c0)](_0x46b92e(0x135),{'success':_0x583eb6[_0x46b92e(0x12c)]('success'),'errors':_0x583eb6[_0x46b92e(0x12c)]('errors'),'role':_0x96a261,'profile':_0x7d4024,'user':_0xcd103d,'stock':_0x4dcd32,'master_shop':_0xde2460,'unit':_0x4805ec,'language':_0x3db6cd,'warehouses':warehouse_data,'rooms':_0x10f3e9});}catch(_0x45956c){console['log'](_0x45956c),_0x39283d['status'](0xc8)[_0x46b92e(0x187)]({'message':_0x45956c[_0x46b92e(0x153)]});}}),router[a0_0x57f966(0x158)](a0_0x57f966(0x14e),auth,async(_0x1739fe,_0x35a7d5)=>{var _0x4523c2=a0_0x57f966;try{const {invoice:_0x3223c1,date:_0x284487,warehouse_name:_0x117f63,product_name:_0x5b4b60,primary_code:_0x16cd57,secondary_code:_0xfadbcc,product_code:_0x30e4e6,sales_quantity:_0x3ad68e,stocks:_0x3625ee,return_qty:_0x40a91c,Room_name:_0x4b0787,to_warehouse_name:_0x2388c7,to_Roomname:_0x5b691f,to_Room_name:_0xa24133,note:_0x2e8211,level:_0x2eea04,isle:_0x352805,pallet:_0x48a729}=_0x1739fe['body'];if(typeof _0x5b4b60==_0x4523c2(0xf5))var _0x538ad0=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x18b)]],_0x24cebf=[_0x1739fe['body'][_0x4523c2(0x1e9)]],_0x3048c9=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x183)]],_0x3bdc16=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0xef)]],_0x185ac6=[_0x1739fe[_0x4523c2(0x15d)]['sales_quantity']],_0x3843cf=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x174)]],_0x275cf5=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x12d)]],_0x1d208f=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0xf1)]],_0x4e2c94=[_0x1739fe[_0x4523c2(0x15d)]['bin']],_0x8daa91=[_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x1b6)]],_0x1a0d94=[_0x1739fe[_0x4523c2(0x15d)]['floorlevel']];else var _0x538ad0=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x18b)]],_0x24cebf=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x1e9)]],_0x3048c9=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x183)]],_0x3bdc16=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0xef)]],_0x185ac6=[..._0x1739fe[_0x4523c2(0x15d)]['sales_quantity']],_0x3843cf=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x174)]],_0x275cf5=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x12d)]],_0x1d208f=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0xf1)]],_0x4e2c94=[..._0x1739fe[_0x4523c2(0x15d)]['bin']],_0x8daa91=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x1b6)]],_0x1a0d94=[..._0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x17b)]];const _0x491a51=_0x538ad0[_0x4523c2(0x195)](_0xeba0f2=>{return _0xeba0f2={'product_name':_0xeba0f2};});_0x24cebf['forEach']((_0x3cb323,_0x5ad59d)=>{var _0x568963=_0x4523c2;_0x491a51[_0x5ad59d][_0x568963(0x1e9)]=_0x3cb323;}),_0x3048c9[_0x4523c2(0x150)]((_0x1a952d,_0x3776a6)=>{_0x491a51[_0x3776a6]['secondary_code']=_0x1a952d;}),_0x3bdc16[_0x4523c2(0x150)]((_0x1d41f6,_0x22b28b)=>{var _0x2e447b=_0x4523c2;_0x491a51[_0x22b28b][_0x2e447b(0xef)]=_0x1d41f6;}),_0x185ac6[_0x4523c2(0x150)]((_0x4dca8e,_0x37acaa)=>{var _0x3a44b6=_0x4523c2;_0x491a51[_0x37acaa][_0x3a44b6(0x15e)]=_0x4dca8e;}),_0x3843cf[_0x4523c2(0x150)]((_0x26f9b7,_0x33fd1a)=>{var _0x593201=_0x4523c2;_0x491a51[_0x33fd1a][_0x593201(0x144)]=_0x26f9b7;}),_0x275cf5[_0x4523c2(0x150)]((_0x3c9814,_0x4e02e0)=>{var _0xd90371=_0x4523c2;_0x491a51[_0x4e02e0][_0xd90371(0x12d)]=_0x3c9814;}),_0x1d208f[_0x4523c2(0x150)]((_0x8abf07,_0x2c036d)=>{var _0x266f18=_0x4523c2;_0x491a51[_0x2c036d][_0x266f18(0xf1)]=_0x8abf07;}),_0x4e2c94[_0x4523c2(0x150)]((_0x30be33,_0xc6f8ab)=>{var _0x4d9183=_0x4523c2;_0x491a51[_0xc6f8ab][_0x4d9183(0x13a)]=_0x30be33;}),_0x8daa91[_0x4523c2(0x150)]((_0x46a27a,_0x590a0a)=>{var _0x2526c6=_0x4523c2;_0x491a51[_0x590a0a][_0x2526c6(0x1f4)]=_0x46a27a;}),_0x1a0d94[_0x4523c2(0x150)]((_0x1ab0ad,_0x436bed)=>{_0x491a51[_0x436bed]['floorlevel']=_0x1ab0ad;});var _0x528992=0x0;_0x491a51[_0x4523c2(0x150)](_0x51831c=>{var _0x143291=_0x4523c2;console[_0x143291(0x128)]('foreach\x20newproduct',_0x51831c),(parseInt(_0x51831c[_0x143291(0x15e)])<parseInt(_0x51831c['return_qty'])||parseInt(_0x51831c['stock'])<parseInt(_0x51831c[_0x143291(0x12d)])&&parseInt(_0x51831c[_0x143291(0x15e)])>parseInt(_0x51831c['return_qty'])||parseInt(_0x51831c[_0x143291(0x12d)])==0x0)&&_0x528992++;});if(_0x528992!=0x0)return _0x1739fe[_0x4523c2(0x12c)](_0x4523c2(0xee),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x35a7d5[_0x4523c2(0x1de)](_0x4523c2(0xed));const _0x4509d3=await sales[_0x4523c2(0x133)]({'invoice':_0x3223c1});console[_0x4523c2(0x128)](_0x4509d3),_0x4509d3['return_data']=_0x4523c2(0x105);const _0x16ac5b=await _0x4509d3['save'](),_0x89b7b4=new sales_return({'invoice':_0x3223c1,'customer':_0x1739fe['body'][_0x4523c2(0x1b7)],'date':_0x284487,'warehouse_name':_0x117f63,'room':_0x4b0787,'ToWarehouse':_0x2388c7,'ToRoom':_0xa24133,'return_sale':_0x491a51,'note':_0x2e8211}),_0x3bf8dc=await _0x89b7b4[_0x4523c2(0x10b)]();console[_0x4523c2(0x128)](_0x89b7b4);const _0x19c6a2=await sales_return[_0x4523c2(0x133)]({'invoice':_0x3223c1}),_0x250d7a=await warehouse[_0x4523c2(0x133)]({'name':_0x2388c7,'room':_0xa24133});_0x19c6a2[_0x4523c2(0x135)]['forEach'](_0x48e6da=>{var _0x39f757=_0x4523c2,_0x563dcd=0x0;const _0x4e6520=_0x250d7a[_0x39f757(0x156)][_0x39f757(0x195)](_0x762c8=>{var _0x1a8c00=_0x39f757;_0x762c8['product_name']==_0x48e6da[_0x1a8c00(0x18b)]&&_0x762c8[_0x1a8c00(0x17b)]==_0x48e6da['floorlevel']&&_0x762c8[_0x1a8c00(0x1f4)]==_0x48e6da[_0x1a8c00(0x1f4)]&&_0x762c8['bin']==_0x48e6da[_0x1a8c00(0x13a)]&&_0x762c8[_0x1a8c00(0xf1)]==_0x48e6da['bay']&&(_0x762c8[_0x1a8c00(0xe3)]=parseInt(_0x762c8[_0x1a8c00(0xe3)])+parseInt(_0x48e6da[_0x1a8c00(0x12d)]),_0x563dcd++);});_0x563dcd=='0'&&(_0x250d7a[_0x39f757(0x156)]=_0x250d7a['product_details'][_0x39f757(0x173)]({'product_name':_0x48e6da['product_name'],'product_stock':_0x48e6da[_0x39f757(0x12d)],'primary_code':_0x48e6da[_0x39f757(0x1e9)],'secondary_code':_0x48e6da['secondary_code'],'product_code':_0x48e6da['product_code'],'bay':_0x48e6da[_0x39f757(0xf1)],'bin':_0x48e6da[_0x39f757(0x13a)],'type':_0x48e6da[_0x39f757(0x1f4)],'floorlevel':_0x48e6da[_0x39f757(0x17b)]})),console['log'](_0x39f757(0x19d),_0x250d7a);}),await _0x250d7a[_0x4523c2(0x10b)](),console[_0x4523c2(0x128)](_0x1739fe[_0x4523c2(0x15d)]);const _0x417e46=new c_payment_data({'invoice':_0x3223c1,'customer':_0x1739fe[_0x4523c2(0x15d)][_0x4523c2(0x1b7)],'reason':_0x4523c2(0x1b3)});await _0x417e46[_0x4523c2(0x10b)]();const _0x4bb3ed=await master_shop[_0x4523c2(0x16e)]();console['log'](_0x4523c2(0x1ea),_0x4bb3ed[0x0][_0x4523c2(0x10e)]);const _0x1dada9=await email_settings['findOne'](),_0x1eb527=await customer['findOne']({'name':_0x1739fe['body'][_0x4523c2(0x1b7)]});console[_0x4523c2(0x128)](_0x4523c2(0x167),_0x1eb527);_0x4bb3ed[0x0][_0x4523c2(0x11a)]==0x1?(right_currency=_0x4bb3ed[0x0][_0x4523c2(0x19e)],left_currency=''):(right_currency='',left_currency=_0x4bb3ed[0x0][_0x4523c2(0x19e)]);var _0x29b33c=_0x538ad0,_0x30e394=_0x275cf5,_0x2f9fe5='',_0x2f0678;for(_0x2f0678 in _0x29b33c){_0x2f9fe5+=_0x4523c2(0x1e0)+_0x4523c2(0x14d)+_0x29b33c[_0x2f0678]+_0x4523c2(0x175)+_0x4523c2(0x14d)+_0x30e394[_0x2f0678]+_0x4523c2(0x175)+'</tr>';}console['log'](_0x4523c2(0x11e),_0x2f9fe5);let _0x238bdb=nodemailer['createTransport']({'service':_0x4523c2(0x1c9),'auth':{'user':_0x1dada9[_0x4523c2(0x1be)],'pass':_0x1dada9[_0x4523c2(0x1a9)]}}),_0x441da7={'from':_0x1dada9['email'],'to':_0x1eb527[_0x4523c2(0x1be)],'subject':_0x4523c2(0x14b),'attachments':[{'filename':_0x4523c2(0xfa),'path':__dirname+_0x4523c2(0x116)+'/upload/'+_0x4bb3ed[0x0][_0x4523c2(0x10e)],'cid':_0x4523c2(0x1ab)}],'html':'<!DOCTYPE\x20html>'+_0x4523c2(0x17d)+_0x4523c2(0x139)+_0x4523c2(0x16b)+_0x4523c2(0xf7)+_0x4523c2(0x16b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4523c2(0x1ec)+'<div>'+'<h2>\x20'+_0x4bb3ed[0x0]['site_title']+_0x4523c2(0x115)+_0x4523c2(0x1ec)+_0x4523c2(0x1ec)+_0x4523c2(0x108)+'<div>'+_0x4523c2(0x190)+_0x4523c2(0xe5)+_0x3223c1+'\x20'+_0x4523c2(0x146)+'\x20Order\x20Date\x20:\x20'+_0x284487+'\x20'+_0x4523c2(0x129)+_0x4523c2(0x1f3)+_0x4523c2(0x1ec)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4523c2(0x1e0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x4523c2(0x161)+_0x4523c2(0x1a4)+_0x4523c2(0x1bd)+_0x4523c2(0x13f)+_0x4523c2(0x1ac)+'\x20'+_0x2f9fe5+'\x20'+_0x4523c2(0x1d2)+'</table>'+'<div>'+_0x4523c2(0xff)+_0x4523c2(0x112)+_0x4bb3ed[0x0][_0x4523c2(0xe7)]+_0x4523c2(0x1f3)+_0x4523c2(0x1ec)+_0x4523c2(0x1ec)+_0x4523c2(0x178)};_0x238bdb[_0x4523c2(0x162)](_0x441da7,function(_0x1c2659,_0x423336){var _0x4a3979=_0x4523c2;_0x1c2659?(console[_0x4a3979(0x128)](_0x1c2659),console['log']('Error\x20Occurs')):console[_0x4a3979(0x128)](_0x4a3979(0x103));}),_0x1739fe[_0x4523c2(0x12c)]('success',_0x4523c2(0xfc)),_0x35a7d5[_0x4523c2(0x1de)]('/all_sales/view');}catch(_0x2202e3){console[_0x4523c2(0x128)](_0x2202e3),_0x35a7d5['status'](0xc8)[_0x4523c2(0x187)]({'message1':_0x2202e3[_0x4523c2(0x153)]});}}),router[a0_0x57f966(0x180)](a0_0x57f966(0x11b),auth,async(_0x22815d,_0x40186f)=>{var _0x3729ab=a0_0x57f966;try{const {username:_0x5b7d58,email:_0x391a5f,role:_0x584138}=_0x22815d[_0x3729ab(0x1c7)],_0x3c02e9=_0x22815d[_0x3729ab(0x1c7)],_0x151bdf=await profile['findOne']({'email':_0x3c02e9[_0x3729ab(0x1be)]}),_0x1ac82d=await master_shop[_0x3729ab(0x16e)]();console[_0x3729ab(0x128)]('barcode\x20Product\x20master',_0x1ac82d);const _0x7d1d16=_0x22815d['params']['id'],_0x1dfef3=await sales[_0x3729ab(0x1e1)](_0x7d1d16);console[_0x3729ab(0x128)]('barcode\x20user_id',_0x1dfef3);if(_0x1ac82d[0x0][_0x3729ab(0xfb)]=='English\x20(US)')var _0x4e199c=users[_0x3729ab(0x1b4)];else{if(_0x1ac82d[0x0][_0x3729ab(0xfb)]==_0x3729ab(0x179))var _0x4e199c=users['Hindi'];else{if(_0x1ac82d[0x0][_0x3729ab(0xfb)]==_0x3729ab(0x1dc))var _0x4e199c=users[_0x3729ab(0x1dc)];else{if(_0x1ac82d[0x0][_0x3729ab(0xfb)]==_0x3729ab(0x140))var _0x4e199c=users['Spanish'];else{if(_0x1ac82d[0x0]['language']==_0x3729ab(0x1d1))var _0x4e199c=users[_0x3729ab(0x1d1)];else{if(_0x1ac82d[0x0][_0x3729ab(0xfb)]==_0x3729ab(0x15c))var _0x4e199c=users[_0x3729ab(0x12f)];else{if(_0x1ac82d[0x0][_0x3729ab(0xfb)]==_0x3729ab(0x1a1))var _0x4e199c=users[_0x3729ab(0x1a1)];else{if(_0x1ac82d[0x0][_0x3729ab(0xfb)]=='Arabic\x20(ae)')var _0x4e199c=users[_0x3729ab(0xec)];}}}}}}}_0x40186f[_0x3729ab(0x1c0)](_0x3729ab(0x18c),{'success':_0x22815d['flash'](_0x3729ab(0x1c2)),'errors':_0x22815d[_0x3729ab(0x12c)](_0x3729ab(0xee)),'role':_0x3c02e9,'profile':_0x151bdf,'alldata':_0x1dfef3,'master_shop':_0x1ac82d,'language':_0x4e199c});}catch(_0x226de1){console[_0x3729ab(0x128)](_0x226de1);}}),router['post'](a0_0x57f966(0x1ba),async(_0x30c769,_0x2c043b)=>{var _0x3d4123=a0_0x57f966;const {product_code:_0x1c7f31,warehouse_name:_0x18c38f,rooms_data:_0x145f30,Roomslist:_0x1fbe54}=_0x30c769['body'],_0x32e39b=_0x1fbe54['split'](','),_0x13a1d3=[];async function _0x2ed625(_0x11d99d){var _0x2cf0fc=a0_0x4cf1;const _0xabcf9e=await warehouse['aggregate']([{'$match':{'name':_0x18c38f,'room':_0x11d99d}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1c7f31}},{'$group':{'_id':_0x2cf0fc(0x1b8),'name':{'$first':_0x2cf0fc(0x176)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2cf0fc(0x1c1)},'product_code':{'$first':_0x2cf0fc(0x17f)},'level':{'$first':_0x2cf0fc(0x191)},'isle':{'$first':_0x2cf0fc(0x132)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2cf0fc(0x1da)},'secondary_unit':{'$first':_0x2cf0fc(0x1ee)},'storage':{'$first':_0x2cf0fc(0x177)},'rack':{'$first':_0x2cf0fc(0x1a6)},'expiry_date':{'$first':_0x2cf0fc(0x1e8)},'production_date':{'$first':_0x2cf0fc(0x145)},'maxPerUnit':{'$first':_0x2cf0fc(0x1a2)},'batch_code':{'$first':_0x2cf0fc(0xea)},'product_cat':{'$first':_0x2cf0fc(0x18f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2cf0fc(0x198)},'invoice':{'$first':_0x2cf0fc(0x1e5)},'actual_qty':{'$first':_0x2cf0fc(0xe4)},'actual_uom':{'$first':_0x2cf0fc(0x189)}}}]),_0x337867=await warehouse[_0x2cf0fc(0x122)]([{'$match':{'name':_0x18c38f,'room':_0x11d99d}},{'$unwind':_0x2cf0fc(0x1d4)},{'$match':{'product_details.secondary_code':_0x1c7f31}},{'$group':{'_id':_0x2cf0fc(0x1b8),'name':{'$first':_0x2cf0fc(0x176)},'product_stock':{'$first':_0x2cf0fc(0x155)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2cf0fc(0x1c1)},'product_code':{'$first':_0x2cf0fc(0x17f)},'level':{'$first':_0x2cf0fc(0x191)},'isle':{'$first':_0x2cf0fc(0x132)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2cf0fc(0x107)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2cf0fc(0x1ee)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2cf0fc(0x1a6)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2cf0fc(0x145)},'maxPerUnit':{'$first':_0x2cf0fc(0x1a2)},'batch_code':{'$first':_0x2cf0fc(0xea)},'product_cat':{'$first':_0x2cf0fc(0x18f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2cf0fc(0x1e5)}}}]);if(_0xabcf9e[_0x2cf0fc(0x1d7)]>0x0)_0x13a1d3[_0x2cf0fc(0x130)](_0xabcf9e);else _0x337867[_0x2cf0fc(0x1d7)]>0x0&&_0x13a1d3['push'](_0x337867);}const _0x1f40e1=_0x32e39b[_0x3d4123(0x195)](_0x201890=>_0x2ed625(_0x201890));await Promise[_0x3d4123(0x1d5)](_0x1f40e1),_0x2c043b[_0x3d4123(0x187)](_0x13a1d3);}),module[a0_0x57f966(0xf9)]=router;