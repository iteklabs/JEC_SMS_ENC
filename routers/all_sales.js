var a0_0x18ae79=a0_0x59b6;(function(_0x1e3d81,_0x957b94){var _0x6aae06=a0_0x59b6,_0x47673d=_0x1e3d81();while(!![]){try{var _0x4f096c=-parseInt(_0x6aae06(0x1ba))/0x1+parseInt(_0x6aae06(0x185))/0x2+parseInt(_0x6aae06(0x1de))/0x3+parseInt(_0x6aae06(0x1c9))/0x4*(-parseInt(_0x6aae06(0x1ae))/0x5)+parseInt(_0x6aae06(0x124))/0x6+parseInt(_0x6aae06(0x198))/0x7+-parseInt(_0x6aae06(0xe7))/0x8;if(_0x4f096c===_0x957b94)break;else _0x47673d['push'](_0x47673d['shift']());}catch(_0x551960){_0x47673d['push'](_0x47673d['shift']());}}}(a0_0xec01,0xd414e));const express=require(a0_0x18ae79(0x1a3)),app=express(),router=express[a0_0x18ae79(0x178)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x18ae79(0xf1)),nodemailer=require(a0_0x18ae79(0xf7)),users=require(a0_0x18ae79(0x106));function a0_0x59b6(_0x12f6f4,_0x3d72aa){var _0xec01b8=a0_0xec01();return a0_0x59b6=function(_0x59b6ff,_0x325be6){_0x59b6ff=_0x59b6ff-0xe1;var _0x17d931=_0xec01b8[_0x59b6ff];return _0x17d931;},a0_0x59b6(_0x12f6f4,_0x3d72aa);}router[a0_0x18ae79(0xf2)](a0_0x18ae79(0x1c3),auth,async(_0xf9c07d,_0xd5c238)=>{var _0x4e25a4=a0_0x18ae79;try{const {username:_0x1c1a61,email:_0x2f2395,role:_0x56a2d6}=_0xf9c07d[_0x4e25a4(0x113)],_0x5ef368=_0xf9c07d[_0x4e25a4(0x113)],_0x25f70d=await profile['findOne']({'email':_0x5ef368[_0x4e25a4(0x13e)]}),_0x4f7ae1=await master_shop[_0x4e25a4(0x10c)]();let _0x1bf2f8;if(_0x5ef368['role']==_0x4e25a4(0x164)){const _0x14e8f6=await staff['findOne']({'email':_0x5ef368[_0x4e25a4(0x13e)]});_0x1bf2f8=await sales[_0x4e25a4(0x121)]([{'$lookup':{'from':_0x4e25a4(0x100),'localField':_0x4e25a4(0x137),'foreignField':_0x4e25a4(0x133),'as':_0x4e25a4(0x128)}},{'$unwind':_0x4e25a4(0x13b)},{'$unwind':_0x4e25a4(0x16c)},{'$group':{'_id':_0x4e25a4(0x158),'invoice':{'$first':_0x4e25a4(0x151)},'customers':{'$first':_0x4e25a4(0xf5)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4e25a4(0xfa)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4e25a4(0x159)},'return_data':{'$first':_0x4e25a4(0x1d4)},'customers_docs':{'$first':_0x4e25a4(0x13b)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4e25a4(0x1db)},'pallet':{'$addToSet':_0x4e25a4(0x152)},'finalize':{'$first':_0x4e25a4(0x1e8)},'isAllowEdit':{'$first':_0x4e25a4(0x1aa)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x1bf2f8=await sales[_0x4e25a4(0x121)]([{'$lookup':{'from':_0x4e25a4(0x100),'localField':_0x4e25a4(0x137),'foreignField':_0x4e25a4(0x133),'as':'customers_docs'}},{'$unwind':_0x4e25a4(0x13b)},{'$unwind':_0x4e25a4(0x16c)},{'$group':{'_id':_0x4e25a4(0x158),'invoice':{'$first':_0x4e25a4(0x151)},'customers':{'$first':_0x4e25a4(0xf5)},'date':{'$first':_0x4e25a4(0x148)},'warehouse_name':{'$first':_0x4e25a4(0xfa)},'sale_product':{'$push':_0x4e25a4(0x16c)},'note':{'$first':_0x4e25a4(0x159)},'return_data':{'$first':_0x4e25a4(0x1d4)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x4e25a4(0x154)},'level':{'$addToSet':_0x4e25a4(0x131)},'isle':{'$addToSet':_0x4e25a4(0x1b4)},'type':{'$addToSet':_0x4e25a4(0x1db)},'pallet':{'$addToSet':_0x4e25a4(0x152)},'finalize':{'$first':_0x4e25a4(0x1e8)},'isAllowEdit':{'$first':_0x4e25a4(0x1aa)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4e25a4(0x1bf)](_0x4e25a4(0x18e),_0x1bf2f8);if(_0x4f7ae1[0x0][_0x4e25a4(0x157)]==_0x4e25a4(0x18d)){var _0x242353=users[_0x4e25a4(0x13a)];console[_0x4e25a4(0x1bf)](_0x242353);}else{if(_0x4f7ae1[0x0][_0x4e25a4(0x157)]=='Hindi')var _0x242353=users['Hindi'];else{if(_0x4f7ae1[0x0][_0x4e25a4(0x157)]==_0x4e25a4(0x10b))var _0x242353=users[_0x4e25a4(0x10b)];else{if(_0x4f7ae1[0x0][_0x4e25a4(0x157)]=='Spanish')var _0x242353=users['Spanish'];else{if(_0x4f7ae1[0x0]['language']==_0x4e25a4(0x1e3))var _0x242353=users[_0x4e25a4(0x1e3)];else{if(_0x4f7ae1[0x0][_0x4e25a4(0x157)]==_0x4e25a4(0x1ab))var _0x242353=users[_0x4e25a4(0x145)];else{if(_0x4f7ae1[0x0][_0x4e25a4(0x157)]==_0x4e25a4(0xe2))var _0x242353=users[_0x4e25a4(0xe2)];else{if(_0x4f7ae1[0x0]['language']=='Arabic\x20(ae)')var _0x242353=users[_0x4e25a4(0x18b)];}}}}}}}_0xd5c238[_0x4e25a4(0x111)](_0x4e25a4(0x125),{'success':_0xf9c07d['flash'](_0x4e25a4(0x1c2)),'errors':_0xf9c07d[_0x4e25a4(0x115)]('errors'),'sales':_0x1bf2f8,'profile':_0x25f70d,'role':_0x5ef368,'master_shop':_0x4f7ae1,'language':_0x242353});}catch(_0x2104e4){console[_0x4e25a4(0x1bf)](_0x2104e4);}});async function getRandom8DigitNumber(){var _0x12db52=a0_0x18ae79;const _0xd1cd9=0x989680,_0x5e7be4=0x5f5e0ff,_0x441876=Math['floor'](Math[_0x12db52(0xe5)]()*(_0x5e7be4-_0xd1cd9+0x1))+_0xd1cd9;var _0x5310e7;const _0x324a34=await sales[_0x12db52(0x140)]({'invoice':_0x12db52(0x127)+_0x441876});return _0x324a34&&_0x324a34[_0x12db52(0x196)]>0x0?_0x5310e7='OUT-'+_0x441876:_0x5310e7='OUT-'+_0x441876,_0x5310e7;}router[a0_0x18ae79(0xf2)](a0_0x18ae79(0x102),auth,async(_0x329cb0,_0x4d60aa)=>{var _0x1557d9=a0_0x18ae79;try{const {username:_0x40fa2b,email:_0x4a5a6a,role:_0x143c55}=_0x329cb0[_0x1557d9(0x113)],_0x39382f=_0x329cb0[_0x1557d9(0x113)],_0x5797d7=await profile[_0x1557d9(0x140)]({'email':_0x39382f[_0x1557d9(0x13e)]}),_0x52c935=await master_shop['find'](),_0x2f0f86=await customer[_0x1557d9(0x10c)]({});let _0x14a467;if(_0x39382f[_0x1557d9(0x122)]==_0x1557d9(0x164)){const _0xdb0d8f=await staff[_0x1557d9(0x140)]({'email':_0x39382f[_0x1557d9(0x13e)]});_0x14a467=await warehouse[_0x1557d9(0x121)]([{'$match':{'status':'Enabled','name':_0xdb0d8f[_0x1557d9(0x143)],'warehouse_category':_0x1557d9(0x135),'name':{'$ne':_0x1557d9(0x12c)}}},{'$group':{'_id':'$name','name':{'$first':_0x1557d9(0x14d)}}},{'$sort':{'name':0x1}}]);}else _0x14a467=await warehouse[_0x1557d9(0x121)]([{'$match':{'status':'Enabled','warehouse_category':_0x1557d9(0x135),'name':{'$ne':_0x1557d9(0x12c)}}},{'$group':{'_id':_0x1557d9(0x14d),'name':{'$first':_0x1557d9(0x14d)}}},{'$sort':{'name':0x1}}]);const _0x9f1798=await product['find']({});var _0x1b0cf4=[_0x1557d9(0x13c),_0x1557d9(0x192)];const _0x5dd1c6=await sales['find']({}),_0x5c95de=_0x5dd1c6['length']+0x1,_0x225f0e='OUT-'+_0x5c95de['toString']()[_0x1557d9(0x120)](0x5,'0');if(_0x52c935[0x0][_0x1557d9(0x157)]=='English\x20(US)'){var _0x5d55fb=users[_0x1557d9(0x13a)];console[_0x1557d9(0x1bf)](_0x5d55fb);}else{if(_0x52c935[0x0][_0x1557d9(0x157)]==_0x1557d9(0x177))var _0x5d55fb=users[_0x1557d9(0x177)];else{if(_0x52c935[0x0]['language']==_0x1557d9(0x10b))var _0x5d55fb=users[_0x1557d9(0x10b)];else{if(_0x52c935[0x0][_0x1557d9(0x157)]==_0x1557d9(0x10a))var _0x5d55fb=users[_0x1557d9(0x10a)];else{if(_0x52c935[0x0][_0x1557d9(0x157)]==_0x1557d9(0x1e3))var _0x5d55fb=users['French'];else{if(_0x52c935[0x0][_0x1557d9(0x157)]==_0x1557d9(0x1ab))var _0x5d55fb=users[_0x1557d9(0x145)];else{if(_0x52c935[0x0][_0x1557d9(0x157)]==_0x1557d9(0xe2))var _0x5d55fb=users[_0x1557d9(0xe2)];else{if(_0x52c935[0x0][_0x1557d9(0x157)]=='Arabic\x20(ae)')var _0x5d55fb=users[_0x1557d9(0x18b)];}}}}}}}const _0x35ea60=getRandom8DigitNumber();_0x35ea60[_0x1557d9(0x1a4)](_0x116a0d=>{var _0x38207c=_0x1557d9;_0x4d60aa[_0x38207c(0x111)]('add_sales',{'success':_0x329cb0[_0x38207c(0x115)](_0x38207c(0x1c2)),'errors':_0x329cb0['flash'](_0x38207c(0x17f)),'role':_0x39382f,'profile':_0x5797d7,'customer':_0x2f0f86,'warehouse':_0x14a467,'product':_0x9f1798,'invoice':_0x116a0d,'master_shop':_0x52c935,'language':_0x5d55fb,'rooms_data':_0x1b0cf4});})[_0x1557d9(0x1ac)](_0x2c490a=>{var _0x3cff83=_0x1557d9;_0x329cb0[_0x3cff83(0x115)](_0x3cff83(0x17f),_0x3cff83(0x107)),_0x4d60aa['redirect'](_0x3cff83(0x1a8));});}catch(_0x1cc94c){console[_0x1557d9(0x1bf)](_0x1cc94c);}}),router['get'](a0_0x18ae79(0x18f),auth,async(_0x513d0e,_0x257abf)=>{var _0x54ae43=a0_0x18ae79;try{const _0x353ab5=_0x513d0e['params']['id'];console['log'](_0x353ab5);const _0xe569c7=await product[_0x54ae43(0x10c)](),_0x1c6c45=await purchases[_0x54ae43(0x121)]([{'$match':{'warehouse_name':_0x353ab5}},{'$unwind':'$product'},{'$group':{'_id':_0x54ae43(0x174)}}]);console[_0x54ae43(0x1bf)](_0x54ae43(0x18c),_0x1c6c45),_0x257abf[_0x54ae43(0x186)](0xc8)[_0x54ae43(0x13d)]({'purchases_data':_0x1c6c45,'product_data':_0xe569c7});}catch(_0x58c760){console['log'](_0x58c760);}}),router[a0_0x18ae79(0x1be)](a0_0x18ae79(0x1df),auth,async(_0x3acbd6,_0x2f3f1f)=>{var _0x54124f=a0_0x18ae79;try{const {warehouse_data:_0x44c9de,product_data:_0x2d7629}=_0x3acbd6['body'];console[_0x54124f(0x1bf)](_0x3acbd6[_0x54124f(0x11c)][_0x54124f(0x146)]);;const _0x30ba5d=await master_shop[_0x54124f(0x10c)]();console[_0x54124f(0x1bf)](_0x54124f(0x156),_0x30ba5d);const _0x23a69e=await product[_0x54124f(0x140)]({'name':_0x2d7629});console[_0x54124f(0x1bf)](_0x54124f(0x129),_0x23a69e);const _0x3674c6=await warehouse[_0x54124f(0x121)]([{'$match':{'name':_0x44c9de}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x2d7629}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x54124f(0x1bf)](_0x54124f(0x1c7),_0x3674c6),_0x2f3f1f[_0x54124f(0x186)](0xc8)['json']({'master':_0x30ba5d,'new_product':_0x23a69e,'stock_data':_0x3674c6});}catch(_0x1537db){console[_0x54124f(0x1bf)](_0x1537db);}}),router['post'](a0_0x18ae79(0x102),auth,async(_0x12e62a,_0x55046c)=>{var _0x31400c=a0_0x18ae79;try{const {invoice:_0x4916e2,date:_0x503a50,warehouse_name:_0xcf3d25,product_name:_0x3781fa,stock:_0x5fe55e,quantity:_0x19727d,note:_0x1a04b4,room:_0x913f69,primary_code:_0x2737f5,secondary_code:_0x5dad79,prod_code:_0x1ba8b7,level:_0x519360,isle:_0x6eacad,pallet:_0x3d66fa,batch_code:_0x1db41c,SCRN:_0x4f2e33,expiry_date:_0x3372ff}=_0x12e62a[_0x31400c(0x11c)];if(typeof _0x3781fa==_0x31400c(0x1c5))var _0x5aea1e=[_0x12e62a['body'][_0x31400c(0x1d0)]],_0x23a18b=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x12a)]],_0xff1a09=[_0x12e62a['body'][_0x31400c(0x199)]],_0x2abea1=[_0x12e62a[_0x31400c(0x11c)]['primary_code']],_0x28a5c8=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x1e9)]],_0x381a31=[_0x12e62a['body']['prod_code']],_0x913c40=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x17b)]],_0x24ba26=[_0x12e62a[_0x31400c(0x11c)]['primary_unit']],_0x250302=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x10f)]],_0x4b4985=[_0x12e62a['body'][_0x31400c(0x19a)]],_0x3f4e60=[_0x12e62a[_0x31400c(0x11c)]['expiry_date']],_0x6e2614=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x163)]],_0xad8c9e=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x117)]],_0x3ce52c=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0xe4)]],_0x3c94ab=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x166)]],_0x2c854e=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x17c)]],_0x2f65c6=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x191)]],_0x1bbee1=[_0x12e62a[_0x31400c(0x11c)]['quantity']],_0xcfbb91=[_0x12e62a['body'][_0x31400c(0xfd)]],_0x1828b9=[_0x12e62a['body'][_0x31400c(0x104)]],_0x5dec93=[_0x12e62a[_0x31400c(0x11c)]['actual_qty']],_0x19ea8e=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x16d)]],_0x26288d=[_0x12e62a[_0x31400c(0x11c)][_0x31400c(0x195)]];else var _0x5aea1e=[..._0x12e62a['body']['product_name']],_0x23a18b=[..._0x12e62a[_0x31400c(0x11c)]['stock']],_0xff1a09=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x199)]],_0x2abea1=[..._0x12e62a[_0x31400c(0x11c)]['primary_code']],_0x28a5c8=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x1e9)]],_0x381a31=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x1af)]],_0x913c40=[..._0x12e62a['body'][_0x31400c(0x17b)]],_0x24ba26=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x160)]],_0x250302=[..._0x12e62a[_0x31400c(0x11c)]['secondary_unit']],_0x4b4985=[..._0x12e62a['body']['batch_code']],_0x3f4e60=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x167)]],_0x6e2614=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x163)]],_0xad8c9e=[..._0x12e62a[_0x31400c(0x11c)]['production_date']],_0x3ce52c=[..._0x12e62a['body']['requested_qty']],_0x3c94ab=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x166)]],_0x2c854e=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x17c)]],_0x2f65c6=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x191)]],_0x1bbee1=[..._0x12e62a[_0x31400c(0x11c)]['quantity']],_0xcfbb91=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0xfd)]],_0x1828b9=[..._0x12e62a[_0x31400c(0x11c)]['prod_invoice']],_0x5dec93=[..._0x12e62a['body']['actual_qty']],_0x19ea8e=[..._0x12e62a['body'][_0x31400c(0x16d)]],_0x26288d=[..._0x12e62a[_0x31400c(0x11c)][_0x31400c(0x195)]];const _0x37211b=_0x5aea1e[_0x31400c(0x1a5)](_0x5d2f89=>{return _0x5d2f89={'product_name':_0x5d2f89};});_0x23a18b[_0x31400c(0x112)]((_0x2e63f2,_0x5a7716)=>{var _0xac9acc=_0x31400c;_0x37211b[_0x5a7716][_0xac9acc(0x12a)]=Math[_0xac9acc(0x1e5)](_0x2e63f2);}),_0x5dec93[_0x31400c(0x112)]((_0x8f3cb0,_0x46c6a9)=>{var _0x53a9b5=_0x31400c;_0x37211b[_0x46c6a9][_0x53a9b5(0x12e)]=Math['abs'](_0x8f3cb0);}),_0x19ea8e[_0x31400c(0x112)]((_0x29488d,_0x2eb6ad)=>{var _0x2d66a5=_0x31400c;_0x37211b[_0x2eb6ad][_0x2d66a5(0x16d)]=_0x29488d;}),_0x26288d[_0x31400c(0x112)]((_0x3f12df,_0x21c4e2)=>{_0x37211b[_0x21c4e2]['id_transaction_from']=_0x3f12df;}),_0xff1a09['forEach']((_0x461b72,_0x3da517)=>{var _0x5d638a=_0x31400c;_0x37211b[_0x3da517][_0x5d638a(0x1d8)]=_0x461b72;}),_0x2abea1[_0x31400c(0x112)]((_0x322b98,_0xaba658)=>{var _0x45235c=_0x31400c;_0x37211b[_0xaba658][_0x45235c(0x15a)]=_0x322b98;}),_0x28a5c8['forEach']((_0x14a472,_0xbeb8bc)=>{_0x37211b[_0xbeb8bc]['secondary_code']=_0x14a472;}),_0x381a31[_0x31400c(0x112)]((_0x504350,_0x5dbe67)=>{var _0x336901=_0x31400c;_0x37211b[_0x5dbe67][_0x336901(0x1ca)]=_0x504350;}),_0x913c40[_0x31400c(0x112)]((_0x9bfc0c,_0x44f72d)=>{_0xcfbb91['forEach']((_0x1d6c9c,_0x58bd03)=>{var _0x4ab787=a0_0x59b6;if(_0x1d6c9c=='Receiving\x20Area'&&_0x44f72d==_0x58bd03){var _0x3d3111=_0x9bfc0c[_0x4ab787(0x16f)](0x3);_0x37211b[_0x44f72d][_0x4ab787(0xec)]=_0x9bfc0c[0x0],_0x37211b[_0x44f72d]['rack']=_0x9bfc0c[0x1],_0x37211b[_0x44f72d][_0x4ab787(0x1b9)]=0x0,_0x37211b[_0x44f72d][_0x4ab787(0x1d9)]=0x0,_0x37211b[_0x44f72d][_0x4ab787(0x1e2)]=_0x4ab787(0x179),_0x37211b[_0x44f72d][_0x4ab787(0xff)]=_0x3d3111;}else{if(_0x1d6c9c==_0x4ab787(0x1a6)&&_0x44f72d==_0x58bd03){var _0x3d3111=_0x9bfc0c[_0x4ab787(0x16f)](0x3);_0x37211b[_0x44f72d][_0x4ab787(0xec)]=_0x9bfc0c[0x0],_0x37211b[_0x44f72d][_0x4ab787(0x1dd)]=_0x9bfc0c[0x1],_0x37211b[_0x44f72d]['bay']=0x0,_0x37211b[_0x44f72d][_0x4ab787(0x1d9)]=0x0,_0x37211b[_0x44f72d]['type']=_0x4ab787(0x179),_0x37211b[_0x44f72d][_0x4ab787(0xff)]=_0x9bfc0c[0x5];}else{if(_0x44f72d==_0x58bd03){var _0x50db7d;if(_0x9bfc0c[0x4]=='L')_0x50db7d=_0x4ab787(0x136);else _0x9bfc0c[0x4]=='F'&&(_0x50db7d='Floor');_0x37211b[_0x44f72d][_0x4ab787(0xec)]=_0x9bfc0c[0x0],_0x37211b[_0x44f72d][_0x4ab787(0x1dd)]=_0x9bfc0c[0x1],_0x37211b[_0x44f72d][_0x4ab787(0x1b9)]=_0x9bfc0c[0x2],_0x37211b[_0x44f72d][_0x4ab787(0x1d9)]=_0x9bfc0c[0x3],_0x37211b[_0x44f72d][_0x4ab787(0x1e2)]=_0x50db7d,_0x37211b[_0x44f72d][_0x4ab787(0xff)]=_0x9bfc0c[0x5];}}}});}),_0x24ba26[_0x31400c(0x112)]((_0x41782b,_0x23e722)=>{_0x37211b[_0x23e722]['unit']=_0x41782b;}),_0x250302[_0x31400c(0x112)]((_0x314d57,_0x58d595)=>{_0x37211b[_0x58d595]['secondary_unit']=_0x314d57;}),_0x4b4985[_0x31400c(0x112)]((_0xfbafd5,_0xd96a29)=>{_0x37211b[_0xd96a29]['batch_code']=_0xfbafd5;}),_0x3f4e60['forEach']((_0x2b1a00,_0x9d2270)=>{_0x37211b[_0x9d2270]['expiry_date']=_0x2b1a00;}),_0x6e2614[_0x31400c(0x112)]((_0x4d58d9,_0x36aa27)=>{var _0x467530=_0x31400c;_0x37211b[_0x36aa27][_0x467530(0x11b)]=_0x4d58d9;}),_0xad8c9e[_0x31400c(0x112)]((_0x2917bd,_0x42c96e)=>{var _0x32fe06=_0x31400c;_0x37211b[_0x42c96e][_0x32fe06(0x117)]=_0x2917bd;}),_0x3ce52c[_0x31400c(0x112)]((_0x54aae2,_0x25ce3a)=>{var _0x54e333=_0x31400c;_0x37211b[_0x25ce3a][_0x54e333(0xe4)]=_0x54aae2;}),_0x3c94ab[_0x31400c(0x112)]((_0x268f0b,_0x9ac1f2)=>{var _0x122c9b=_0x31400c;_0x37211b[_0x9ac1f2][_0x122c9b(0x166)]=_0x268f0b;}),_0x2c854e[_0x31400c(0x112)]((_0x116d15,_0x9c9b3d)=>{var _0x1eb82c=_0x31400c;_0x37211b[_0x9c9b3d][_0x1eb82c(0x17c)]=_0x116d15;}),_0x2f65c6['forEach']((_0x1c59de,_0x3f5655)=>{_0x37211b[_0x3f5655]['prod_cat']=_0x1c59de;}),_0x1bbee1[_0x31400c(0x112)]((_0x54636e,_0x55673d)=>{_0x37211b[_0x55673d]['quantity_notConverted']=_0x54636e;}),_0xcfbb91[_0x31400c(0x112)]((_0x26d19f,_0x45d80a)=>{_0x37211b[_0x45d80a]['room_name']=_0x26d19f;}),_0x1828b9['forEach']((_0x4333fc,_0x12827a)=>{var _0x2ba2e4=_0x31400c;_0x37211b[_0x12827a][_0x2ba2e4(0x184)]=_0x4333fc;});var _0x1878e4=0x0;_0x37211b[_0x31400c(0x112)](_0x263483=>{var _0x3f2191=_0x31400c;(_0x263483[_0x3f2191(0x12a)]<_0x263483[_0x3f2191(0x1a0)]||_0x263483['quantity_notConverted']==0x0)&&(console[_0x3f2191(0x1bf)]('foreach\x20newproduct',_0x263483),_0x1878e4++);});const _0x5df361=_0x37211b['filter'](_0x501fc4=>_0x501fc4[_0x31400c(0x1d8)]!=='0'&&_0x501fc4[_0x31400c(0x1d8)]!==''),_0x147b9d=new sales({'invoice':_0x4916e2,'customer':_0x12e62a['body'][_0x31400c(0x137)],'date':_0x503a50,'warehouse_name':_0xcf3d25,'sale_product':_0x5df361,'note':_0x1a04b4,'room':_0x913f69,'primary_code':_0x2737f5,'secondary_code':_0x5dad79,'prod_code':_0x1ba8b7,'SCRN':_0x4f2e33}),_0x4c8b21=await _0x147b9d['save']();_0x12e62a[_0x31400c(0x115)]('success',_0x31400c(0xe9)),_0x55046c[_0x31400c(0x1cb)](_0x31400c(0x1b7)+_0x4c8b21[_0x31400c(0x114)]);}catch(_0x2ae019){console['log'](_0x2ae019);}}),router[a0_0x18ae79(0xf2)](a0_0x18ae79(0x19e),auth,async(_0x2e7c4d,_0x41153a)=>{var _0x1be6ff=a0_0x18ae79;try{const {username:_0x4e475d,email:_0x24b349,role:_0x458fb2}=_0x2e7c4d[_0x1be6ff(0x113)],_0x1c9198=_0x2e7c4d[_0x1be6ff(0x113)],_0x3ce8f0=await profile['findOne']({'email':_0x1c9198[_0x1be6ff(0x13e)]}),_0x24aeda=await master_shop[_0x1be6ff(0x10c)](),_0xdb73c6=_0x2e7c4d['params']['id'],_0x121a16=await sales['findById'](_0xdb73c6),_0x4865ff=await warehouse[_0x1be6ff(0x121)]([{'$match':{'name':_0x121a16[_0x1be6ff(0x10d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1be6ff(0x141),'name':{'$first':_0x1be6ff(0x1c1)},'product_stock':{'$first':_0x1be6ff(0x1b1)},'bay':{'$first':_0x1be6ff(0x110)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1be6ff(0x161)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1be6ff(0x1ce)},'secondary_code':{'$first':_0x1be6ff(0x189)},'product_code':{'$first':_0x1be6ff(0x1d5)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1be6ff(0x175)},'expiry_date':{'$first':_0x1be6ff(0x1d7)},'production_date':{'$first':_0x1be6ff(0x14f)},'invoice':{'$first':_0x1be6ff(0xfb)}}}]),_0x2edb3d=await customer[_0x1be6ff(0x10c)]({});let _0x1f6345;if(_0x1c9198[_0x1be6ff(0x122)]==_0x1be6ff(0x164)){const _0x259078=await staff['findOne']({'email':_0x1c9198[_0x1be6ff(0x13e)]});_0x1f6345=await warehouse['aggregate']([{'$match':{'status':_0x1be6ff(0x19b),'name':_0x259078[_0x1be6ff(0x143)]}},{'$group':{'_id':'$name','name':{'$first':_0x1be6ff(0x14d)}}}]);}else _0x1f6345=await warehouse[_0x1be6ff(0x121)]([{'$match':{'status':_0x1be6ff(0x19b)}},{'$group':{'_id':_0x1be6ff(0x14d),'name':{'$first':_0x1be6ff(0x14d)}}}]);const _0xb82512=await product[_0x1be6ff(0x10c)]({}),_0x174404=await suppliers[_0x1be6ff(0x10c)]({});if(_0x24aeda[0x0][_0x1be6ff(0x157)]=='English\x20(US)'){var _0x463e5e=users['English'];console[_0x1be6ff(0x1bf)](_0x463e5e);}else{if(_0x24aeda[0x0][_0x1be6ff(0x157)]==_0x1be6ff(0x177))var _0x463e5e=users['Hindi'];else{if(_0x24aeda[0x0][_0x1be6ff(0x157)]=='German')var _0x463e5e=users[_0x1be6ff(0x10b)];else{if(_0x24aeda[0x0][_0x1be6ff(0x157)]==_0x1be6ff(0x10a))var _0x463e5e=users[_0x1be6ff(0x10a)];else{if(_0x24aeda[0x0][_0x1be6ff(0x157)]==_0x1be6ff(0x1e3))var _0x463e5e=users[_0x1be6ff(0x1e3)];else{if(_0x24aeda[0x0][_0x1be6ff(0x157)]==_0x1be6ff(0x1ab))var _0x463e5e=users[_0x1be6ff(0x145)];else{if(_0x24aeda[0x0]['language']==_0x1be6ff(0xe2))var _0x463e5e=users[_0x1be6ff(0xe2)];else{if(_0x24aeda[0x0][_0x1be6ff(0x157)]==_0x1be6ff(0x147))var _0x463e5e=users[_0x1be6ff(0x18b)];}}}}}}}_0x41153a[_0x1be6ff(0x111)]('edit_sales_view',{'success':_0x2e7c4d[_0x1be6ff(0x115)]('success'),'errors':_0x2e7c4d[_0x1be6ff(0x115)](_0x1be6ff(0x17f)),'role':_0x1c9198,'profile':_0x3ce8f0,'customer':_0x2edb3d,'warehouse':_0x1f6345,'product':_0x4865ff,'user':_0x121a16,'master_shop':_0x24aeda,'unit':_0xb82512,'language':_0x463e5e,'suppliers':_0x174404});}catch(_0x39e695){console['log'](_0x39e695);}}),router[a0_0x18ae79(0x1be)]('/preview/:id',auth,async(_0x2e813f,_0x2bdbac)=>{var _0x1cd718=a0_0x18ae79;try{const _0x27b003=_0x2e813f[_0x1cd718(0x1b8)]['id'],{invoice:_0x1a94fc,warehouse_name:_0x274429,room:_0x2b3a7c}=_0x2e813f[_0x1cd718(0x11c)],_0x226116=await sales['findOne']({'invoice':_0x1a94fc}),_0x361ba5=_0x226116[_0x1cd718(0x188)][_0x1cd718(0x1a5)](async _0x1ae9a0=>{var _0x29d043=_0x1cd718,_0x17eaac=await warehouse[_0x29d043(0x140)]({'name':_0x274429,'room':_0x1ae9a0[_0x29d043(0x1bc)],'warehouse_category':_0x29d043(0x135)});const _0x540597=_0x17eaac[_0x29d043(0x17d)][_0x29d043(0x1a5)](_0x4218cf=>{var _0x205c3e=_0x29d043;_0x4218cf['product_name']==_0x1ae9a0[_0x205c3e(0x1d0)]&&_0x4218cf[_0x205c3e(0xff)]==_0x1ae9a0['floorlevel']&&_0x4218cf['type']==_0x1ae9a0['type']&&_0x4218cf[_0x205c3e(0x1d9)]==_0x1ae9a0[_0x205c3e(0x1d9)]&&_0x4218cf['bay']==_0x1ae9a0[_0x205c3e(0x1b9)]&&_0x4218cf[_0x205c3e(0x1dd)]==_0x1ae9a0[_0x205c3e(0x1dd)]&&_0x4218cf[_0x205c3e(0xec)]==_0x1ae9a0[_0x205c3e(0xec)]&&_0x4218cf[_0x205c3e(0x167)]==_0x1ae9a0[_0x205c3e(0x167)]&&_0x4218cf[_0x205c3e(0x19a)]==_0x1ae9a0['batch_code']&&_0x4218cf['invoice']==_0x1ae9a0[_0x205c3e(0x184)]&&_0x4218cf['_id']==_0x1ae9a0['id_transaction_from']&&(_0x4218cf[_0x205c3e(0x132)]=Math[_0x205c3e(0x1a7)](0x0,Math[_0x205c3e(0x1e5)](_0x4218cf['product_stock'])-Math[_0x205c3e(0x1e5)](_0x1ae9a0[_0x205c3e(0x1d8)])));});return _0x17eaac;});Promise[_0x1cd718(0x1b2)](_0x361ba5)[_0x1cd718(0x1a4)](async _0x2b8ae1=>{var _0x12916f=_0x1cd718;try{for(const _0x14baef of _0x2b8ae1){await _0x14baef['save']();}_0x226116[_0x12916f(0x13f)]=_0x12916f(0x12b);const _0x1b3d2e=await _0x226116[_0x12916f(0x15c)](),_0x223fc8=await master_shop[_0x12916f(0x10c)](),_0x5c8b9b=await email_settings[_0x12916f(0x140)](),_0x269f73=await supervisor_settings['find']();var _0x4085d2=_0x226116[_0x12916f(0x188)],_0x559277='',_0x2c2137;for(_0x2c2137 in _0x4085d2){_0x559277+=_0x12916f(0x14c)+_0x12916f(0x118)+_0x4085d2[_0x2c2137][_0x12916f(0x1d0)]+_0x12916f(0xe1)+_0x12916f(0x118)+_0x4085d2[_0x2c2137][_0x12916f(0x1ca)]+_0x12916f(0xe1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4085d2[_0x2c2137][_0x12916f(0x1d8)]+'</td>'+_0x12916f(0x118)+_0x4085d2[_0x2c2137][_0x12916f(0xef)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4085d2[_0x2c2137][_0x12916f(0x10f)]+_0x12916f(0xe1)+_0x12916f(0x118)+_0x226116['warehouse_name']+_0x12916f(0xe1)+_0x12916f(0x118)+_0x4085d2[_0x2c2137][_0x12916f(0x1bc)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4085d2[_0x2c2137][_0x12916f(0xec)]+_0x4085d2[_0x2c2137][_0x12916f(0x1dd)]+_0x4085d2[_0x2c2137][_0x12916f(0x1b9)]+_0x4085d2[_0x2c2137]['bin']+_0x4085d2[_0x2c2137][_0x12916f(0x1e2)][0x0]+_0x4085d2[_0x2c2137][_0x12916f(0xff)]+'</td>',_0x12916f(0xe3);}let _0x2fcfd1=nodemailer[_0x12916f(0x103)]({'host':_0x5c8b9b[_0x12916f(0x1a2)],'port':Number(_0x5c8b9b['port']),'secure':![],'auth':{'user':_0x5c8b9b[_0x12916f(0x13e)],'pass':_0x5c8b9b[_0x12916f(0x138)]}}),_0x4de1a0={'from':_0x5c8b9b[_0x12916f(0x13e)],'to':_0x269f73[0x0][_0x12916f(0x19d)],'subject':_0x12916f(0x16a),'attachments':[{'filename':_0x12916f(0x1e4),'path':__dirname+_0x12916f(0x1e7)+_0x12916f(0x1bd)+_0x223fc8[0x0][_0x12916f(0xf3)],'cid':_0x12916f(0x15f)}],'html':'<!DOCTYPE\x20html>'+_0x12916f(0x16e)+_0x12916f(0x1cf)+_0x12916f(0x142)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x12916f(0x142)+_0x12916f(0xfe)+'</div>'+_0x12916f(0x142)+_0x12916f(0x182)+_0x223fc8[0x0]['site_title']+_0x12916f(0x116)+_0x12916f(0x180)+_0x12916f(0x180)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x12916f(0x11f)+_0x226116['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x12916f(0x139)+_0x226116[_0x12916f(0x176)]+'\x20'+_0x12916f(0x15e)+_0x12916f(0xee)+'</div>'+_0x12916f(0x10e)+_0x12916f(0x126)+_0x12916f(0x14c)+_0x12916f(0x19c)+_0x12916f(0xe8)+_0x12916f(0x172)+_0x12916f(0x1d2)+_0x12916f(0x173)+_0x12916f(0xf9)+_0x12916f(0x1d3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x12916f(0xe3)+_0x12916f(0xeb)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x559277+'\x20'+_0x12916f(0x11d)+'</table>'+_0x12916f(0x142)+_0x12916f(0x190)+_0x12916f(0x170)+_0x223fc8[0x0][_0x12916f(0x11e)]+_0x12916f(0xee)+_0x12916f(0x180)+_0x12916f(0x180)+_0x12916f(0xe6)};_0x2fcfd1['sendMail'](_0x4de1a0,function(_0x1c2d2e,_0x57a57a){var _0x3ddfe2=_0x12916f;_0x1c2d2e?(console[_0x3ddfe2(0x1bf)](_0x1c2d2e),console[_0x3ddfe2(0x1bf)]('Error\x20Occurs')):console[_0x3ddfe2(0x1bf)](_0x3ddfe2(0x197));}),_0x2e813f[_0x12916f(0x115)]('success',_0x12916f(0x1a1)),_0x2bdbac[_0x12916f(0x1cb)](_0x12916f(0x1b7)+_0x27b003);}catch(_0xaae124){console[_0x12916f(0x1b6)](_0xaae124),_0x2bdbac[_0x12916f(0x186)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1cd718(0x1ac)](_0x1e3055=>{var _0x30d199=_0x1cd718;console[_0x30d199(0x1b6)](_0x1e3055),_0x2bdbac['status'](0x1f4)['json']({'error':_0x30d199(0x15d)});});}catch(_0x309486){console[_0x1cd718(0x1bf)](_0x309486);}}),router[a0_0x18ae79(0xf2)](a0_0x18ae79(0x144),auth,async(_0x3a0aff,_0xabe8ea)=>{var _0x3b1f00=a0_0x18ae79;try{const {username:_0x437781,email:_0x43a597,role:_0x494d90}=_0x3a0aff[_0x3b1f00(0x113)],_0x178fbe=_0x3a0aff[_0x3b1f00(0x113)],_0x1f30f8=await profile[_0x3b1f00(0x140)]({'email':_0x178fbe['email']}),_0x30147d=await master_shop[_0x3b1f00(0x10c)](),_0x187d11=_0x3a0aff[_0x3b1f00(0x1b8)]['id'],_0x2df687=await sales[_0x3b1f00(0x14b)](_0x187d11);var _0x581ccd=[_0x3b1f00(0x13c),_0x3b1f00(0x192)];const _0x1d11cf=await warehouse['aggregate']([{'$match':{'name':_0x2df687['warehouse_name'],'warehouse_category':_0x3b1f00(0x135)}},{'$unwind':_0x3b1f00(0x162)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b1f00(0x1b1)},'bay':{'$first':_0x3b1f00(0x110)},'bin':{'$first':_0x3b1f00(0x108)},'type':{'$first':_0x3b1f00(0x161)},'floorlevel':{'$first':_0x3b1f00(0x1dc)},'primary_code':{'$first':_0x3b1f00(0x1ce)},'secondary_code':{'$first':_0x3b1f00(0x189)},'product_code':{'$first':_0x3b1f00(0x1d5)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3b1f00(0x175)}}}]),_0x4a074e=await customer[_0x3b1f00(0x10c)]({});let _0x1d341c;if(_0x178fbe[_0x3b1f00(0x122)]==_0x3b1f00(0x164)){const _0x1dbeb2=await staff['findOne']({'email':_0x178fbe[_0x3b1f00(0x13e)]});_0x1d341c=await warehouse[_0x3b1f00(0x121)]([{'$match':{'status':_0x3b1f00(0x19b),'name':_0x1dbeb2[_0x3b1f00(0x143)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3b1f00(0x14d),'name':{'$first':_0x3b1f00(0x14d)}}}]);}else _0x1d341c=await warehouse[_0x3b1f00(0x121)]([{'$match':{'status':_0x3b1f00(0x19b),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3b1f00(0x14d),'name':{'$first':_0x3b1f00(0x14d)}}}]);const _0xafa9c1=await product[_0x3b1f00(0x10c)]({});if(_0x30147d[0x0][_0x3b1f00(0x157)]==_0x3b1f00(0x18d)){var _0xf0f673=users[_0x3b1f00(0x13a)];console[_0x3b1f00(0x1bf)](_0xf0f673);}else{if(_0x30147d[0x0][_0x3b1f00(0x157)]==_0x3b1f00(0x177))var _0xf0f673=users[_0x3b1f00(0x177)];else{if(_0x30147d[0x0][_0x3b1f00(0x157)]==_0x3b1f00(0x10b))var _0xf0f673=users[_0x3b1f00(0x10b)];else{if(_0x30147d[0x0]['language']=='Spanish')var _0xf0f673=users['Spanish'];else{if(_0x30147d[0x0]['language']==_0x3b1f00(0x1e3))var _0xf0f673=users[_0x3b1f00(0x1e3)];else{if(_0x30147d[0x0]['language']==_0x3b1f00(0x1ab))var _0xf0f673=users[_0x3b1f00(0x145)];else{if(_0x30147d[0x0][_0x3b1f00(0x157)]==_0x3b1f00(0xe2))var _0xf0f673=users[_0x3b1f00(0xe2)];else{if(_0x30147d[0x0][_0x3b1f00(0x157)]==_0x3b1f00(0x147))var _0xf0f673=users[_0x3b1f00(0x18b)];}}}}}}}_0xabe8ea[_0x3b1f00(0x111)](_0x3b1f00(0x19f),{'success':_0x3a0aff['flash'](_0x3b1f00(0x1c2)),'errors':_0x3a0aff[_0x3b1f00(0x115)]('errors'),'role':_0x178fbe,'profile':_0x1f30f8,'customer':_0x4a074e,'warehouse':_0x1d341c,'product':_0x1d11cf,'user':_0x2df687,'master_shop':_0x30147d,'unit':_0xafa9c1,'language':_0xf0f673});}catch(_0x39fae5){console[_0x3b1f00(0x1bf)](_0x39fae5);}}),router[a0_0x18ae79(0x1be)]('/view/:id',auth,async(_0x129941,_0x370eea)=>{var _0xa14d48=a0_0x18ae79;try{const _0x229f3d=_0x129941[_0xa14d48(0x1b8)]['id'],_0xfd2162=await sales[_0xa14d48(0x140)]({'_id':_0x129941[_0xa14d48(0x1b8)]['id']}),_0x2d9420=await warehouse[_0xa14d48(0x140)]({'name':_0xfd2162[_0xa14d48(0x10d)],'room':_0x129941[_0xa14d48(0x11c)][_0xa14d48(0xf0)]}),{invoice:_0x1864a0,date:_0x468ca9,warehouse_name:_0x3f8d05,product_name:_0x56f416,stock:_0x3bfc0c,quantity:_0x22adb7,note:_0x4794e4,room:_0x3280a2,customer:_0x5bd34d,SCRN:_0x3d617e}=_0x129941['body'];if(typeof _0x56f416==_0xa14d48(0x1c5))var _0x44562b=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x1d0)]],_0x2d7e4f=[_0x129941['body']['stock']],_0xffa261=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x199)]],_0x365bc9=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x15a)]],_0xb21c36=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x1e9)]],_0x2baf9a=[_0x129941['body'][_0xa14d48(0x1af)]],_0x1ba8ba=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x17b)]],_0x7d0453=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x160)]],_0x3bc9b5=[_0x129941['body'][_0xa14d48(0x10f)]],_0x56b8d9=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x19a)]],_0x5119d3=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x167)]],_0x26de0c=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x163)]],_0x20748a=[_0x129941['body'][_0xa14d48(0x117)]],_0x4c4a04=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0xe4)]],_0x37ecfb=[_0x129941['body'][_0xa14d48(0x166)]],_0x3f029f=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x17c)]],_0x369602=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x191)]],_0x566f65=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0x1d8)]],_0x350ea4=[_0x129941[_0xa14d48(0x11c)][_0xa14d48(0xfd)]];else var _0x44562b=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x1d0)]],_0x2d7e4f=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x12a)]],_0xffa261=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x199)]],_0x365bc9=[..._0x129941['body'][_0xa14d48(0x15a)]],_0xb21c36=[..._0x129941[_0xa14d48(0x11c)]['secondary_code']],_0x2baf9a=[..._0x129941['body'][_0xa14d48(0x1af)]],_0x1ba8ba=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x17b)]],_0x7d0453=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x160)]],_0x3bc9b5=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x10f)]],_0x56b8d9=[..._0x129941[_0xa14d48(0x11c)]['batch_code']],_0x5119d3=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x167)]],_0x26de0c=[..._0x129941[_0xa14d48(0x11c)]['max_per_unit']],_0x20748a=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x117)]],_0x4c4a04=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0xe4)]],_0x37ecfb=[..._0x129941[_0xa14d48(0x11c)]['delivery_date']],_0x3f029f=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0x17c)]],_0x369602=[..._0x129941[_0xa14d48(0x11c)]['prod_cat']],_0x566f65=[..._0x129941['body'][_0xa14d48(0x1d8)]],_0x350ea4=[..._0x129941[_0xa14d48(0x11c)][_0xa14d48(0xfd)]];const _0xa19145=_0x44562b[_0xa14d48(0x1a5)](_0x5357ab=>{return _0x5357ab={'product_name':_0x5357ab};});_0x2d7e4f[_0xa14d48(0x112)]((_0x559293,_0x16401b)=>{var _0x217ba7=_0xa14d48;_0xa19145[_0x16401b][_0x217ba7(0x12a)]=Math['abs'](_0x559293);}),_0xffa261['forEach']((_0x560594,_0x100b55)=>{_0xa19145[_0x100b55]['quantity']=_0x560594;}),_0x365bc9[_0xa14d48(0x112)]((_0x594f38,_0xe62caa)=>{var _0x3c6a64=_0xa14d48;_0xa19145[_0xe62caa][_0x3c6a64(0x15a)]=_0x594f38;}),_0xb21c36[_0xa14d48(0x112)]((_0x47b852,_0x38343f)=>{var _0x5a1c5a=_0xa14d48;_0xa19145[_0x38343f][_0x5a1c5a(0x1e9)]=_0x47b852;}),_0x2baf9a[_0xa14d48(0x112)]((_0x4ebfc,_0x2aba3e)=>{_0xa19145[_0x2aba3e]['product_code']=_0x4ebfc;}),_0x1ba8ba[_0xa14d48(0x112)]((_0x319968,_0x2517a3)=>{var _0x35976d=_0xa14d48;_0x350ea4[_0x35976d(0x112)]((_0x194e7e,_0x979114)=>{var _0x27385e=_0x35976d;if(_0x194e7e==_0x27385e(0x101)&&_0x2517a3==_0x979114){var _0x234a82=_0x319968['slice'](0x3);_0xa19145[_0x2517a3][_0x27385e(0xec)]=_0x319968[0x0],_0xa19145[_0x2517a3][_0x27385e(0x1dd)]=_0x319968[0x1],_0xa19145[_0x2517a3][_0x27385e(0x1b9)]=0x0,_0xa19145[_0x2517a3][_0x27385e(0x1d9)]=0x0,_0xa19145[_0x2517a3][_0x27385e(0x1e2)]=_0x27385e(0x179),_0xa19145[_0x2517a3][_0x27385e(0xff)]=_0x234a82;}else{if(_0x194e7e==_0x27385e(0x1a6)&&_0x2517a3==_0x979114){var _0x234a82=_0x319968['slice'](0x3);_0xa19145[_0x2517a3]['storage']=_0x319968[0x0],_0xa19145[_0x2517a3][_0x27385e(0x1dd)]=_0x319968[0x1],_0xa19145[_0x2517a3]['bay']=0x0,_0xa19145[_0x2517a3]['bin']=0x0,_0xa19145[_0x2517a3][_0x27385e(0x1e2)]=_0x27385e(0x179),_0xa19145[_0x2517a3][_0x27385e(0xff)]=_0x319968[0x5];}else{if(_0x2517a3==_0x979114){var _0x3513de;if(_0x319968[0x4]=='L')_0x3513de=_0x27385e(0x136);else _0x319968[0x4]=='F'&&(_0x3513de=_0x27385e(0x179));_0xa19145[_0x2517a3][_0x27385e(0xec)]=_0x319968[0x0],_0xa19145[_0x2517a3][_0x27385e(0x1dd)]=_0x319968[0x1],_0xa19145[_0x2517a3]['bay']=_0x319968[0x2],_0xa19145[_0x2517a3][_0x27385e(0x1d9)]=_0x319968[0x3],_0xa19145[_0x2517a3]['type']=_0x3513de,_0xa19145[_0x2517a3][_0x27385e(0xff)]=_0x319968[0x5];}}}});}),_0x7d0453[_0xa14d48(0x112)]((_0x515d19,_0x1d1c92)=>{var _0x28fd5e=_0xa14d48;_0xa19145[_0x1d1c92][_0x28fd5e(0xef)]=_0x515d19;}),_0x3bc9b5['forEach']((_0x401eaf,_0x18e33f)=>{var _0x5012c2=_0xa14d48;_0xa19145[_0x18e33f][_0x5012c2(0x10f)]=_0x401eaf;}),_0x56b8d9[_0xa14d48(0x112)]((_0x21052c,_0x2d5642)=>{_0xa19145[_0x2d5642]['batch_code']=_0x21052c;}),_0x5119d3[_0xa14d48(0x112)]((_0x333bcb,_0x2de2ec)=>{var _0x1f4ab0=_0xa14d48;_0xa19145[_0x2de2ec][_0x1f4ab0(0x167)]=_0x333bcb;}),_0x26de0c[_0xa14d48(0x112)]((_0x23231f,_0xe1f1a)=>{var _0x419695=_0xa14d48;_0xa19145[_0xe1f1a][_0x419695(0x11b)]=_0x23231f;}),_0x20748a[_0xa14d48(0x112)]((_0x166db8,_0x186c0f)=>{var _0x267424=_0xa14d48;_0xa19145[_0x186c0f][_0x267424(0x117)]=_0x166db8;}),_0x4c4a04[_0xa14d48(0x112)]((_0x1529d2,_0x94de05)=>{var _0x51716a=_0xa14d48;_0xa19145[_0x94de05][_0x51716a(0xe4)]=Math['abs'](_0x1529d2);}),_0x37ecfb[_0xa14d48(0x112)]((_0x320341,_0x504e64)=>{var _0x453089=_0xa14d48;_0xa19145[_0x504e64][_0x453089(0x166)]=_0x320341;}),_0x3f029f[_0xa14d48(0x112)]((_0x3e2619,_0x2d0f59)=>{var _0x34cad5=_0xa14d48;_0xa19145[_0x2d0f59][_0x34cad5(0x17c)]=_0x3e2619;}),_0x369602[_0xa14d48(0x112)]((_0x5f482c,_0x14cd4e)=>{var _0x43433f=_0xa14d48;_0xa19145[_0x14cd4e][_0x43433f(0x191)]=_0x5f482c;}),_0x566f65[_0xa14d48(0x112)]((_0x2913c4,_0x492618)=>{var _0x47b491=_0xa14d48;_0xa19145[_0x492618][_0x47b491(0x1a0)]=_0x2913c4;}),_0x350ea4[_0xa14d48(0x112)]((_0x1e1150,_0x2232f5)=>{_0xa19145[_0x2232f5]['room_name']=_0x1e1150;});var _0x4372de=0x0;_0xa19145['forEach'](_0x25577e=>{var _0x39300d=_0xa14d48;console['log'](_0x39300d(0x14a),_0x25577e),(parseInt(_0x25577e[_0x39300d(0x12a)])<parseInt(_0x25577e[_0x39300d(0x1d8)])||parseInt(_0x25577e['quantity'])==0x0)&&_0x4372de++;});if(_0x4372de!=0x0)return _0x129941['flash'](_0xa14d48(0x17f),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x370eea['redirect']('back');const _0x4ac575=_0xa19145[_0xa14d48(0x12d)](_0x2f5e34=>_0x2f5e34[_0xa14d48(0x1d8)]!=='0'&&_0x2f5e34[_0xa14d48(0x1d8)]!=='');_0xfd2162[_0xa14d48(0x184)]=_0x1864a0,_0xfd2162[_0xa14d48(0x137)]=_0x5bd34d,_0xfd2162[_0xa14d48(0x176)]=_0x468ca9,_0xfd2162[_0xa14d48(0x10d)]=_0x3f8d05,_0xfd2162[_0xa14d48(0x188)]=_0x4ac575,_0xfd2162['note']=_0x4794e4,_0xfd2162[_0xa14d48(0x1e0)]=_0x3d617e,_0xfd2162['finalize']=_0xa14d48(0x134),_0xfd2162[_0xa14d48(0x183)]=_0xa14d48(0x134);const _0xf56691=await _0xfd2162[_0xa14d48(0x15c)]();_0x129941[_0xa14d48(0x115)](_0xa14d48(0x1c2),_0xa14d48(0x1a1)),_0x370eea[_0xa14d48(0x1cb)]('/all_sales/view');}catch(_0x39a468){console[_0xa14d48(0x1bf)](_0x39a468);}}),router[a0_0x18ae79(0x1be)](a0_0x18ae79(0x1cd),auth,async(_0x1d99a6,_0x7378f7)=>{var _0x121c02=a0_0x18ae79;try{const _0x37060f=_0x1d99a6[_0x121c02(0x1b8)]['id'],{invoice:_0x5e9622,customer:_0x44646b,receivable_amount:_0x2c1e0f,received_amount:_0x1fee51}=_0x1d99a6[_0x121c02(0x11c)],_0x51d7c0=await sales[_0x121c02(0x14b)](_0x37060f);console[_0x121c02(0x1bf)](_0x51d7c0);var _0x5c475c=_0x2c1e0f-_0x1fee51;console[_0x121c02(0x1bf)](_0x1fee51),_0x51d7c0[_0x121c02(0x1c6)]=parseFloat(_0x1fee51)+parseFloat(_0x51d7c0['received_amount']),_0x51d7c0['due_amount']=_0x5c475c,console[_0x121c02(0x1bf)](_0x51d7c0);const _0x1cc57a=await _0x51d7c0[_0x121c02(0x15c)](),_0x585d6c=await c_payment_data[_0x121c02(0x140)]({'invoice':_0x5e9622});_0x585d6c[_0x121c02(0x171)]=_0x5c475c,await _0x585d6c['save']();let _0x325a0a=new Date(),_0x178d89=('0'+_0x325a0a[_0x121c02(0x1bb)]())[_0x121c02(0x16f)](-0x2),_0x126ce3=('0'+(_0x325a0a[_0x121c02(0x11a)]()+0x1))[_0x121c02(0x16f)](-0x2),_0x53a021=_0x325a0a['getFullYear'](),_0x1381bb=_0x53a021+'-'+_0x126ce3+'-'+_0x178d89;const _0x2e9218=new customer_payment({'invoice':_0x5e9622,'date':_0x53a021+'-'+_0x126ce3+'-'+_0x178d89,'customer':_0x44646b,'reason':_0x121c02(0xf6),'amount':_0x1fee51}),_0x3bdfe9=await _0x2e9218[_0x121c02(0x15c)]();_0x1d99a6[_0x121c02(0x115)](_0x121c02(0x1c2),_0x121c02(0x1ad)),_0x7378f7[_0x121c02(0x1cb)](_0x121c02(0x1a8));}catch(_0x34ba02){console[_0x121c02(0x1bf)](_0x34ba02);}}),router[a0_0x18ae79(0xf2)](a0_0x18ae79(0x16b),auth,async(_0x48fafe,_0x5a1740)=>{var _0x24493e=a0_0x18ae79;try{const {username:_0x358678,email:_0x4cbae0,role:_0xb72323}=_0x48fafe[_0x24493e(0x113)],_0x1603a5=_0x48fafe[_0x24493e(0x113)],_0x5bba4a=await profile[_0x24493e(0x140)]({'email':_0x1603a5[_0x24493e(0x13e)]}),_0x1636e5=await master_shop[_0x24493e(0x10c)]();console[_0x24493e(0x1bf)](_0x24493e(0x156),_0x1636e5);const _0x25db4d=_0x48fafe[_0x24493e(0x1b8)]['id'],_0x57297f=await sales['findById'](_0x25db4d);console[_0x24493e(0x1bf)](_0x57297f);const _0x5d0824=await customer[_0x24493e(0x140)]({'name':_0x57297f[_0x24493e(0x137)]});console['log'](_0x5d0824);if(_0x1636e5[0x0]['language']=='English\x20(US)'){var _0x39789b=users[_0x24493e(0x13a)];console[_0x24493e(0x1bf)](_0x39789b);}else{if(_0x1636e5[0x0][_0x24493e(0x157)]==_0x24493e(0x177))var _0x39789b=users[_0x24493e(0x177)];else{if(_0x1636e5[0x0][_0x24493e(0x157)]=='German')var _0x39789b=users[_0x24493e(0x10b)];else{if(_0x1636e5[0x0][_0x24493e(0x157)]=='Spanish')var _0x39789b=users[_0x24493e(0x10a)];else{if(_0x1636e5[0x0]['language']=='French')var _0x39789b=users[_0x24493e(0x1e3)];else{if(_0x1636e5[0x0][_0x24493e(0x157)]==_0x24493e(0x1ab))var _0x39789b=users[_0x24493e(0x145)];else{if(_0x1636e5[0x0][_0x24493e(0x157)]=='Chinese')var _0x39789b=users[_0x24493e(0xe2)];else{if(_0x1636e5[0x0][_0x24493e(0x157)]=='Arabic\x20(ae)')var _0x39789b=users[_0x24493e(0x18b)];}}}}}}}_0x5a1740['render'](_0x24493e(0x165),{'success':_0x48fafe['flash']('success'),'errors':_0x48fafe[_0x24493e(0x115)](_0x24493e(0x17f)),'role':_0x1603a5,'profile':_0x5bba4a,'master_shop':_0x1636e5,'customers':_0x5d0824,'sales':_0x57297f,'language':_0x39789b});}catch(_0x2e7f1a){console[_0x24493e(0x1bf)](_0x2e7f1a);}}),router[a0_0x18ae79(0xf2)](a0_0x18ae79(0xed),auth,async(_0x39f7f7,_0x342baa)=>{var _0x5b91a5=a0_0x18ae79;try{const {username:_0x3b53ad,email:_0x581c43,role:_0xf7033b}=_0x39f7f7[_0x5b91a5(0x113)],_0x1a540c=_0x39f7f7[_0x5b91a5(0x113)],_0x1012a5=await profile['findOne']({'email':_0x1a540c[_0x5b91a5(0x13e)]}),_0x4b32de=await master_shop[_0x5b91a5(0x10c)]();console['log'](_0x5b91a5(0x156),_0x4b32de);const _0x469b5b=_0x39f7f7['params']['id'];console[_0x5b91a5(0x1bf)](_0x469b5b);const _0x1843e2=await sales[_0x5b91a5(0x14b)](_0x469b5b);console[_0x5b91a5(0x1bf)](_0x5b91a5(0x1cc),_0x1843e2);const _0x2cb48d=await warehouse[_0x5b91a5(0x121)]([{'$match':{'name':'Return\x20Goods','room':_0x5b91a5(0x1da)}},{'$unwind':_0x5b91a5(0x162)},{'$group':{'_id':_0x5b91a5(0x141),'name':{'$first':_0x5b91a5(0x1c1)},'product_stock':{'$first':_0x5b91a5(0x1b1)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x5b91a5(0x1b3)},'pallet':{'$first':_0x5b91a5(0x109)},'primary_code':{'$first':_0x5b91a5(0x1ce)},'secondary_code':{'$first':_0x5b91a5(0x189)},'product_code':{'$first':_0x5b91a5(0x1d5)}}}]);console[_0x5b91a5(0x1bf)](_0x5b91a5(0x1c7),_0x2cb48d);const _0x3f6830=await product[_0x5b91a5(0x10c)]({});warehouse_data=await warehouse[_0x5b91a5(0x121)]([{'$match':{'status':_0x5b91a5(0x19b),'name':_0x5b91a5(0x12c),'warehouse_category':_0x5b91a5(0x135)}},{'$group':{'_id':_0x5b91a5(0x14d),'name':{'$first':_0x5b91a5(0x14d)}}},{'$sort':{'name':0x1}}]);var _0x28425d=[_0x5b91a5(0x1da)];if(_0x4b32de[0x0]['language']=='English\x20(US)'){var _0x4fb006=users['English'];console[_0x5b91a5(0x1bf)](_0x4fb006);}else{if(_0x4b32de[0x0][_0x5b91a5(0x157)]==_0x5b91a5(0x177))var _0x4fb006=users[_0x5b91a5(0x177)];else{if(_0x4b32de[0x0][_0x5b91a5(0x157)]==_0x5b91a5(0x10b))var _0x4fb006=users[_0x5b91a5(0x10b)];else{if(_0x4b32de[0x0]['language']=='Spanish')var _0x4fb006=users[_0x5b91a5(0x10a)];else{if(_0x4b32de[0x0]['language']==_0x5b91a5(0x1e3))var _0x4fb006=users['French'];else{if(_0x4b32de[0x0][_0x5b91a5(0x157)]==_0x5b91a5(0x1ab))var _0x4fb006=users[_0x5b91a5(0x145)];else{if(_0x4b32de[0x0]['language']=='Chinese')var _0x4fb006=users[_0x5b91a5(0xe2)];else{if(_0x4b32de[0x0][_0x5b91a5(0x157)]==_0x5b91a5(0x147))var _0x4fb006=users['Arabic'];}}}}}}}_0x342baa[_0x5b91a5(0x111)](_0x5b91a5(0x155),{'success':_0x39f7f7[_0x5b91a5(0x115)](_0x5b91a5(0x1c2)),'errors':_0x39f7f7[_0x5b91a5(0x115)](_0x5b91a5(0x17f)),'role':_0x1a540c,'profile':_0x1012a5,'user':_0x1843e2,'stock':_0x2cb48d,'master_shop':_0x4b32de,'unit':_0x3f6830,'language':_0x4fb006,'warehouses':warehouse_data,'rooms':_0x28425d});}catch(_0x44bb5a){console['log'](_0x44bb5a),_0x342baa['status'](0xc8)[_0x5b91a5(0x13d)]({'message':_0x44bb5a[_0x5b91a5(0x181)]});}}),router[a0_0x18ae79(0x1be)](a0_0x18ae79(0xed),auth,async(_0x5bd9a8,_0x569ae7)=>{var _0x3a4f3f=a0_0x18ae79;try{const {invoice:_0x5e3cf1,date:_0x4009e1,warehouse_name:_0x2b34a5,product_name:_0x3708d4,primary_code:_0x590117,secondary_code:_0x4053e7,product_code:_0x4139d6,sales_quantity:_0x4e5e2b,stocks:_0x4e8697,return_qty:_0x32d3a3,Room_name:_0x2ba87c,to_warehouse_name:_0x4383a8,to_Roomname:_0xe387d9,to_Room_name:_0x1d058a,note:_0x1da730,level:_0x472ef1,isle:_0x79b183,pallet:_0x391fc4}=_0x5bd9a8['body'];if(typeof _0x3708d4==_0x3a4f3f(0x1c5))var _0x5f3664=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1d0)]],_0x4ae2a7=[_0x5bd9a8['body']['primary_code']],_0x7abf67=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1e9)]],_0x2eff16=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1ca)]],_0x266b22=[_0x5bd9a8['body']['sales_quantity']],_0x2c06ae=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x17e)]],_0x48a2e9=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x187)]],_0x45e416=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1b9)]],_0x3f5414=[_0x5bd9a8[_0x3a4f3f(0x11c)]['bin']],_0x422cd9=[_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1a9)]],_0x1889e9=[_0x5bd9a8['body'][_0x3a4f3f(0xff)]];else var _0x5f3664=[..._0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1d0)]],_0x4ae2a7=[..._0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x15a)]],_0x7abf67=[..._0x5bd9a8['body']['secondary_code']],_0x2eff16=[..._0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1ca)]],_0x266b22=[..._0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1e1)]],_0x2c06ae=[..._0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x17e)]],_0x48a2e9=[..._0x5bd9a8['body'][_0x3a4f3f(0x187)]],_0x45e416=[..._0x5bd9a8[_0x3a4f3f(0x11c)]['bay']],_0x3f5414=[..._0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x1d9)]],_0x422cd9=[..._0x5bd9a8['body']['types']],_0x1889e9=[..._0x5bd9a8['body']['floorlevel']];const _0x4e6620=_0x5f3664['map'](_0xb6630c=>{return _0xb6630c={'product_name':_0xb6630c};});_0x4ae2a7[_0x3a4f3f(0x112)]((_0x2642f9,_0x1f6d14)=>{var _0x328e95=_0x3a4f3f;_0x4e6620[_0x1f6d14][_0x328e95(0x15a)]=_0x2642f9;}),_0x7abf67[_0x3a4f3f(0x112)]((_0x5d9e82,_0x334d90)=>{var _0x587805=_0x3a4f3f;_0x4e6620[_0x334d90][_0x587805(0x1e9)]=_0x5d9e82;}),_0x2eff16[_0x3a4f3f(0x112)]((_0x11d414,_0x23e09a)=>{_0x4e6620[_0x23e09a]['product_code']=_0x11d414;}),_0x266b22[_0x3a4f3f(0x112)]((_0x2f1a4b,_0x58bd9f)=>{_0x4e6620[_0x58bd9f]['sale_qty']=_0x2f1a4b;}),_0x2c06ae['forEach']((_0x38251b,_0x51cd61)=>{var _0x5e1c8c=_0x3a4f3f;_0x4e6620[_0x51cd61][_0x5e1c8c(0x12a)]=_0x38251b;}),_0x48a2e9[_0x3a4f3f(0x112)]((_0x207bae,_0x4ff3a7)=>{var _0x43b07f=_0x3a4f3f;_0x4e6620[_0x4ff3a7][_0x43b07f(0x187)]=_0x207bae;}),_0x45e416[_0x3a4f3f(0x112)]((_0x5d8e00,_0xc8b0af)=>{var _0x5d6b77=_0x3a4f3f;_0x4e6620[_0xc8b0af][_0x5d6b77(0x1b9)]=_0x5d8e00;}),_0x3f5414['forEach']((_0x2c3191,_0x12f507)=>{var _0x2870f5=_0x3a4f3f;_0x4e6620[_0x12f507][_0x2870f5(0x1d9)]=_0x2c3191;}),_0x422cd9[_0x3a4f3f(0x112)]((_0x3f35be,_0x26cfd3)=>{var _0x28a977=_0x3a4f3f;_0x4e6620[_0x26cfd3][_0x28a977(0x1e2)]=_0x3f35be;}),_0x1889e9[_0x3a4f3f(0x112)]((_0x129b0e,_0x2dbf06)=>{var _0xf5748c=_0x3a4f3f;_0x4e6620[_0x2dbf06][_0xf5748c(0xff)]=_0x129b0e;});var _0x1c71a5=0x0;_0x4e6620[_0x3a4f3f(0x112)](_0xc97ff0=>{var _0x1377e4=_0x3a4f3f;console['log']('foreach\x20newproduct',_0xc97ff0),(parseInt(_0xc97ff0[_0x1377e4(0x1b5)])<parseInt(_0xc97ff0[_0x1377e4(0x187)])||parseInt(_0xc97ff0[_0x1377e4(0x12a)])<parseInt(_0xc97ff0[_0x1377e4(0x187)])&&parseInt(_0xc97ff0[_0x1377e4(0x1b5)])>parseInt(_0xc97ff0[_0x1377e4(0x187)])||parseInt(_0xc97ff0[_0x1377e4(0x187)])==0x0)&&_0x1c71a5++;});if(_0x1c71a5!=0x0)return _0x5bd9a8[_0x3a4f3f(0x115)](_0x3a4f3f(0x17f),_0x3a4f3f(0x1c8)),_0x569ae7[_0x3a4f3f(0x1cb)](_0x3a4f3f(0x105));const _0x3f4ca3=await sales[_0x3a4f3f(0x140)]({'invoice':_0x5e3cf1});console[_0x3a4f3f(0x1bf)](_0x3f4ca3),_0x3f4ca3['return_data']='True';const _0x33d7c6=await _0x3f4ca3[_0x3a4f3f(0x15c)](),_0x304ba4=new sales_return({'invoice':_0x5e3cf1,'customer':_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x137)],'date':_0x4009e1,'warehouse_name':_0x2b34a5,'room':_0x2ba87c,'ToWarehouse':_0x4383a8,'ToRoom':_0x1d058a,'return_sale':_0x4e6620,'note':_0x1da730}),_0x27971b=await _0x304ba4[_0x3a4f3f(0x15c)]();console[_0x3a4f3f(0x1bf)](_0x304ba4);const _0xd27168=await sales_return['findOne']({'invoice':_0x5e3cf1}),_0x3ccf0c=await warehouse[_0x3a4f3f(0x140)]({'name':_0x4383a8,'room':_0x1d058a});_0xd27168[_0x3a4f3f(0x155)][_0x3a4f3f(0x112)](_0x44d19b=>{var _0x2bdaea=_0x3a4f3f,_0x4db12c=0x0;const _0x38fe96=_0x3ccf0c[_0x2bdaea(0x17d)][_0x2bdaea(0x1a5)](_0x39974a=>{var _0x2572b4=_0x2bdaea;_0x39974a[_0x2572b4(0x1d0)]==_0x44d19b[_0x2572b4(0x1d0)]&&_0x39974a[_0x2572b4(0xff)]==_0x44d19b['floorlevel']&&_0x39974a['type']==_0x44d19b[_0x2572b4(0x1e2)]&&_0x39974a[_0x2572b4(0x1d9)]==_0x44d19b[_0x2572b4(0x1d9)]&&_0x39974a[_0x2572b4(0x1b9)]==_0x44d19b[_0x2572b4(0x1b9)]&&(_0x39974a[_0x2572b4(0x132)]=parseInt(_0x39974a[_0x2572b4(0x132)])+parseInt(_0x44d19b['return_qty']),_0x4db12c++);});_0x4db12c=='0'&&(_0x3ccf0c[_0x2bdaea(0x17d)]=_0x3ccf0c[_0x2bdaea(0x17d)][_0x2bdaea(0x193)]({'product_name':_0x44d19b[_0x2bdaea(0x1d0)],'product_stock':_0x44d19b[_0x2bdaea(0x187)],'primary_code':_0x44d19b['primary_code'],'secondary_code':_0x44d19b[_0x2bdaea(0x1e9)],'product_code':_0x44d19b[_0x2bdaea(0x1ca)],'bay':_0x44d19b['bay'],'bin':_0x44d19b[_0x2bdaea(0x1d9)],'type':_0x44d19b[_0x2bdaea(0x1e2)],'floorlevel':_0x44d19b['floorlevel']})),console[_0x2bdaea(0x1bf)]('final',_0x3ccf0c);}),await _0x3ccf0c[_0x3a4f3f(0x15c)](),console[_0x3a4f3f(0x1bf)](_0x5bd9a8[_0x3a4f3f(0x11c)]);const _0x2fafa1=new c_payment_data({'invoice':_0x5e3cf1,'customer':_0x5bd9a8['body'][_0x3a4f3f(0x137)],'reason':'Sale\x20Return'});await _0x2fafa1['save']();const _0x1a612e=await master_shop[_0x3a4f3f(0x10c)]();console[_0x3a4f3f(0x1bf)]('add\x20post',_0x1a612e[0x0][_0x3a4f3f(0xf3)]);const _0x286aef=await email_settings['findOne'](),_0x2eb88a=await customer[_0x3a4f3f(0x140)]({'name':_0x5bd9a8[_0x3a4f3f(0x11c)][_0x3a4f3f(0x137)]});console[_0x3a4f3f(0x1bf)]('customer_data',_0x2eb88a);_0x1a612e[0x0][_0x3a4f3f(0xea)]==0x1?(right_currency=_0x1a612e[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1a612e[0x0][_0x3a4f3f(0x18a)]);var _0x2ddb91=_0x5f3664,_0x7b3a39=_0x48a2e9,_0x343fa8='',_0x41394d;for(_0x41394d in _0x2ddb91){_0x343fa8+=_0x3a4f3f(0x14c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ddb91[_0x41394d]+'</td>'+_0x3a4f3f(0x118)+_0x7b3a39[_0x41394d]+_0x3a4f3f(0xe1)+_0x3a4f3f(0xe3);}console[_0x3a4f3f(0x1bf)](_0x3a4f3f(0x1c4),_0x343fa8);let _0x26b91e=nodemailer['createTransport']({'service':_0x3a4f3f(0x150),'auth':{'user':_0x286aef[_0x3a4f3f(0x13e)],'pass':_0x286aef[_0x3a4f3f(0x138)]}}),_0x47490a={'from':_0x286aef[_0x3a4f3f(0x13e)],'to':_0x2eb88a[_0x3a4f3f(0x13e)],'subject':_0x3a4f3f(0x12f),'attachments':[{'filename':_0x3a4f3f(0x1e4),'path':__dirname+'/../public'+_0x3a4f3f(0x1bd)+_0x1a612e[0x0]['image'],'cid':_0x3a4f3f(0x15f)}],'html':_0x3a4f3f(0x1d6)+_0x3a4f3f(0x16e)+'</head><body>'+_0x3a4f3f(0x142)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3a4f3f(0x142)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3a4f3f(0x180)+_0x3a4f3f(0x142)+_0x3a4f3f(0x182)+_0x1a612e[0x0][_0x3a4f3f(0x11e)]+_0x3a4f3f(0x116)+'</div>'+_0x3a4f3f(0x180)+'<hr\x20class=\x22my-3\x22>'+_0x3a4f3f(0x142)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x5e3cf1+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3a4f3f(0x139)+_0x4009e1+'\x20'+_0x3a4f3f(0x15e)+_0x3a4f3f(0xee)+_0x3a4f3f(0x180)+_0x3a4f3f(0x10e)+_0x3a4f3f(0x126)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x3a4f3f(0x14e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x3a4f3f(0x153)+_0x3a4f3f(0xe3)+_0x3a4f3f(0xeb)+_0x3a4f3f(0x169)+'\x20'+_0x343fa8+'\x20'+_0x3a4f3f(0x11d)+'</table>'+_0x3a4f3f(0x142)+_0x3a4f3f(0x190)+_0x3a4f3f(0x170)+_0x1a612e[0x0][_0x3a4f3f(0x11e)]+_0x3a4f3f(0xee)+'</div>'+_0x3a4f3f(0x180)+_0x3a4f3f(0xe6)};_0x26b91e[_0x3a4f3f(0x1e6)](_0x47490a,function(_0x1a9268,_0x34eba2){var _0x4bc7bc=_0x3a4f3f;_0x1a9268?(console[_0x4bc7bc(0x1bf)](_0x1a9268),console[_0x4bc7bc(0x1bf)](_0x4bc7bc(0xfc))):console[_0x4bc7bc(0x1bf)](_0x4bc7bc(0x197));}),_0x5bd9a8[_0x3a4f3f(0x115)](_0x3a4f3f(0x1c2),_0x3a4f3f(0x17a)),_0x569ae7['redirect'](_0x3a4f3f(0x1a8));}catch(_0x13f44e){console[_0x3a4f3f(0x1bf)](_0x13f44e),_0x569ae7[_0x3a4f3f(0x186)](0xc8)[_0x3a4f3f(0x13d)]({'message1':_0x13f44e[_0x3a4f3f(0x181)]});}}),router['get']('/barcode/:id',auth,async(_0x4ded7d,_0x5464bb)=>{var _0x5043c6=a0_0x18ae79;try{const {username:_0x30fb8b,email:_0x1d3334,role:_0x55a83b}=_0x4ded7d[_0x5043c6(0x113)],_0x45f944=_0x4ded7d['user'],_0x3e64ff=await profile[_0x5043c6(0x140)]({'email':_0x45f944['email']}),_0x5e5b24=await master_shop[_0x5043c6(0x10c)]();console[_0x5043c6(0x1bf)](_0x5043c6(0x168),_0x5e5b24);const _0x44c756=_0x4ded7d[_0x5043c6(0x1b8)]['id'],_0x93772f=await sales['findById'](_0x44c756);console[_0x5043c6(0x1bf)]('barcode\x20user_id',_0x93772f);if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0x18d))var _0x2561ce=users['English'];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0x177))var _0x2561ce=users['Hindi'];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]=='German')var _0x2561ce=users[_0x5043c6(0x10b)];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0x10a))var _0x2561ce=users[_0x5043c6(0x10a)];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0x1e3))var _0x2561ce=users[_0x5043c6(0x1e3)];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0x1ab))var _0x2561ce=users[_0x5043c6(0x145)];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0xe2))var _0x2561ce=users['Chinese'];else{if(_0x5e5b24[0x0][_0x5043c6(0x157)]==_0x5043c6(0x147))var _0x2561ce=users[_0x5043c6(0x18b)];}}}}}}}_0x5464bb['render']('all_sales_barcode',{'success':_0x4ded7d[_0x5043c6(0x115)]('success'),'errors':_0x4ded7d[_0x5043c6(0x115)]('errors'),'role':_0x45f944,'profile':_0x3e64ff,'alldata':_0x93772f,'master_shop':_0x5e5b24,'language':_0x2561ce});}catch(_0x524a5b){console[_0x5043c6(0x1bf)](_0x524a5b);}}),router[a0_0x18ae79(0x1be)](a0_0x18ae79(0x15b),async(_0x204bb4,_0x377a23)=>{var _0x2abf1d=a0_0x18ae79;const {product_code:_0xb2ece2,warehouse_name:_0x275975,rooms_data:_0x51a154,Roomslist:_0x39ad81}=_0x204bb4[_0x2abf1d(0x11c)],_0x296dce=_0x39ad81[_0x2abf1d(0x194)](','),_0x1cb856=[];async function _0x1821d6(_0x5d9067){var _0x1909c0=_0x2abf1d;const _0x1833a1=await warehouse['aggregate']([{'$match':{'name':_0x275975,'room':_0x5d9067}},{'$unwind':_0x1909c0(0x162)},{'$match':{'product_details.primary_code':_0xb2ece2}},{'$group':{'_id':_0x1909c0(0x141),'name':{'$first':_0x1909c0(0x1c1)},'product_stock':{'$first':_0x1909c0(0x1b1)},'primary_code':{'$first':_0x1909c0(0x1ce)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1909c0(0x1d5)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1909c0(0x108)},'type':{'$first':_0x1909c0(0x161)},'pallet':{'$first':_0x1909c0(0x1dc)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1909c0(0x1b0)},'storage':{'$first':_0x1909c0(0x123)},'rack':{'$first':_0x1909c0(0x175)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1909c0(0x14f)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x1909c0(0x130)},'product_cat':{'$first':_0x1909c0(0xf8)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1909c0(0xfb)},'actual_qty':{'$first':_0x1909c0(0x119)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x795a68=await warehouse[_0x1909c0(0x121)]([{'$match':{'name':_0x275975,'room':_0x5d9067}},{'$unwind':_0x1909c0(0x162)},{'$match':{'product_details.secondary_code':_0xb2ece2}},{'$group':{'_id':_0x1909c0(0x141),'name':{'$first':_0x1909c0(0x1c1)},'product_stock':{'$first':_0x1909c0(0x1b1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1909c0(0x189)},'product_code':{'$first':_0x1909c0(0x1d5)},'level':{'$first':_0x1909c0(0x110)},'isle':{'$first':_0x1909c0(0x108)},'type':{'$first':_0x1909c0(0x161)},'pallet':{'$first':_0x1909c0(0x1dc)},'unit':{'$first':_0x1909c0(0x1d1)},'secondary_unit':{'$first':_0x1909c0(0x1b0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1909c0(0x175)},'expiry_date':{'$first':_0x1909c0(0x1d7)},'production_date':{'$first':_0x1909c0(0x14f)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1909c0(0x1c0)},'invoice':{'$first':_0x1909c0(0xfb)}}}]);if(_0x1833a1['length']>0x0)_0x1cb856[_0x1909c0(0x149)](_0x1833a1);else _0x795a68[_0x1909c0(0x196)]>0x0&&_0x1cb856[_0x1909c0(0x149)](_0x795a68);}const _0x3aff2f=_0x296dce[_0x2abf1d(0x1a5)](_0x2288e6=>_0x1821d6(_0x2288e6));await Promise['all'](_0x3aff2f),_0x377a23['json'](_0x1cb856);}),module[a0_0x18ae79(0xf4)]=router;function a0_0xec01(){var _0x1527b3=['product_data','Arabic\x20(ae)','$date','push','foreach\x20newproduct','findById','<tr>','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.production_date','gmail','$invoice','$sale_product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$sale_product.quantity','return_sale','master','language','$_id','$note','primary_code','/barcode_scanner','save','An\x20error\x20occurred.','</span>','logo','primary_unit','$product_details.type','$product_details','max_per_unit','staff','sales_invoice','delivery_date','expiry_date','barcode\x20Product\x20master','<tbody\x20style=\x22text-align:\x20center;\x22>','Sales\x20Mail','/invoice/:id','$sale_product','actual_uom','<html><head><title></title>','slice','<h5>','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product.product_name','$product_details.rack','date','Hindi','Router','Floor','sales\x20item\x20return\x20successfull','level','delivery_code','product_details','stocks','errors','</div>','message','<h2>\x20','isAllowEdit','invoice','2006622HgXfOd','status','return_qty','sale_product','$product_details.secondary_code','currency','Arabic','purchases_data','English\x20(US)','sales\x20all_data','/view/add_sales/:id','<strong>\x20Regards\x20</strong>','prod_cat','Enclosed','concat','split','id_transact','length','Email\x20sent\x20successfully','11341813KDuAnj','carton','batch_code','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','RMSEmail','/preview/:id','edit_sales','quantity_notConverted','Sales\x20Update\x20successfully','host','express','then','map','Shelves','max','/all_sales/view','types','$isAllowEdit','Portuguese\x20(BR)','catch','payment\x20successfull','831605oCeFpg','prod_code','$product_details.secondary_unit','$product_details.product_stock','all','$product_details.isle','$sale_product.bin','sale_qty','error','/all_sales/preview/','params','bay','1528283WRGdWY','getDate','room_name','/upload/','post','log','$room','$product_details.product_name','success','/view','product_list','string','received_amount','stock_data','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','32twUaWY','product_code','redirect','user_id','/give_payment/:id','$product_details.primary_code','</head><body>','product_name','$product_details.unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$return_data','$product_details.product_code','<!DOCTYPE\x20html>','$product_details.expiry_date','quantity','bin','Return\x20Rooms','$sale_product.type','$product_details.floorlevel','rack','486078HmsvYv','/view/add_sale/product','SCRN','sales_quantity','type','French','Logo.png','abs','sendMail','/../public','$finalize','secondary_code','</td>','Chinese','</tr>','requested_qty','random','</body></html>','3747656gbgEqa','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Sales\x20Add\x20successfully','currency_placement','</thead>','storage','/view/return_sales/:id','</h5>','unit','room','../middleware/auth','get','image','exports','$customer','Received\x20Payment\x20For\x20Sale','nodemailer','$product_details.product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$warehouse_name','$product_details.invoice','Error\x20Occurs','RoomAssigned','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','floorlevel','customers','Receiving\x20Area','/view/add_sales','createTransport','prod_invoice','back','../public/language/languages.json','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.bin','$product_details.pallet','Spanish','German','find','warehouse_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_unit','$product_details.bay','render','forEach','user','_id','flash','\x20</h2>','production_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.actual_qty','getMonth','maxperunit','body','</tbody>','site_title','\x20Order\x20Number\x20:\x20','padStart','aggregate','role','$product_details.storage','8462388byipti','all_sales','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','OUT-','customers_docs','product','stock','True','Return\x20Goods','filter','actual_qty','Sale\x20Return\x20Mail','$product_details.batch_code','$sale_product.bay','product_stock','name','False','Raw\x20Materials','Level','customer','password','\x20Order\x20Date\x20:\x20','English','$customers_docs','Ambient','json','email','finalize','findOne','$product_details._id','<div>','warehouse','/view/:id','Portuguese'];a0_0xec01=function(){return _0x1527b3;};return a0_0xec01();}