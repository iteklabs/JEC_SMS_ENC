var a0_0x2f4975=a0_0x16e8;(function(_0x5e6f56,_0x3a3487){var _0x37dcfc=a0_0x16e8,_0x5c1091=_0x5e6f56();while(!![]){try{var _0x27a46b=-parseInt(_0x37dcfc(0x1f9))/0x1+-parseInt(_0x37dcfc(0x1a2))/0x2*(-parseInt(_0x37dcfc(0x136))/0x3)+parseInt(_0x37dcfc(0x1e0))/0x4+-parseInt(_0x37dcfc(0x1c5))/0x5+-parseInt(_0x37dcfc(0x121))/0x6+-parseInt(_0x37dcfc(0x1ef))/0x7*(-parseInt(_0x37dcfc(0x1b5))/0x8)+-parseInt(_0x37dcfc(0x17d))/0x9*(parseInt(_0x37dcfc(0x1ad))/0xa);if(_0x27a46b===_0x3a3487)break;else _0x5c1091['push'](_0x5c1091['shift']());}catch(_0x12be36){_0x5c1091['push'](_0x5c1091['shift']());}}}(a0_0x1509,0x44926));const express=require(a0_0x2f4975(0x215)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2f4975(0x1b0)),auth=require(a0_0x2f4975(0x15b)),nodemailer=require(a0_0x2f4975(0x1b6)),users=require(a0_0x2f4975(0x11a));function a0_0x16e8(_0x5cd2c3,_0x9d790b){var _0x150926=a0_0x1509();return a0_0x16e8=function(_0x16e8fe,_0xd72a61){_0x16e8fe=_0x16e8fe-0x111;var _0x58fa5c=_0x150926[_0x16e8fe];return _0x58fa5c;},a0_0x16e8(_0x5cd2c3,_0x9d790b);}router[a0_0x2f4975(0x1e3)]('/view',auth,async(_0x166c09,_0x18692e)=>{var _0x44363e=a0_0x2f4975;try{const {username:_0xa23782,email:_0x35fc12,role:_0x565b93}=_0x166c09[_0x44363e(0x114)],_0x5dc10f=_0x166c09['user'],_0x4740fb=await profile[_0x44363e(0x1f5)]({'email':_0x5dc10f[_0x44363e(0x1fc)]}),_0x1b33ec=await master_shop[_0x44363e(0x1b9)]();let _0xac0b0e;if(_0x5dc10f[_0x44363e(0x1f3)]=='staff'){const _0x5bfe1d=await staff['findOne']({'email':_0x5dc10f[_0x44363e(0x1fc)]});_0xac0b0e=await sales[_0x44363e(0x141)]([{'$lookup':{'from':_0x44363e(0x17e),'localField':'customer','foreignField':_0x44363e(0x206),'as':_0x44363e(0x161)}},{'$unwind':_0x44363e(0x14f)},{'$unwind':_0x44363e(0x1dc)},{'$group':{'_id':_0x44363e(0x118),'invoice':{'$first':_0x44363e(0x1e7)},'customers':{'$first':_0x44363e(0x116)},'date':{'$first':_0x44363e(0x20b)},'warehouse_name':{'$first':_0x44363e(0x174)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x44363e(0x146)},'return_data':{'$first':_0x44363e(0x1fe)},'customers_docs':{'$first':_0x44363e(0x14f)},'total_saleproduct_quantity':{'$sum':_0x44363e(0x192)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x44363e(0x219)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x44363e(0x11d)},'isAllowEdit':{'$first':_0x44363e(0x11e)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xac0b0e=await sales[_0x44363e(0x141)]([{'$lookup':{'from':_0x44363e(0x17e),'localField':_0x44363e(0x14c),'foreignField':_0x44363e(0x206),'as':_0x44363e(0x161)}},{'$unwind':_0x44363e(0x14f)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x44363e(0x1e7)},'customers':{'$first':_0x44363e(0x116)},'date':{'$first':_0x44363e(0x20b)},'warehouse_name':{'$first':_0x44363e(0x174)},'sale_product':{'$push':_0x44363e(0x1dc)},'note':{'$first':'$note'},'return_data':{'$first':_0x44363e(0x1fe)},'customers_docs':{'$first':_0x44363e(0x14f)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x44363e(0x193)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x44363e(0x219)},'pallet':{'$addToSet':_0x44363e(0x176)},'finalize':{'$first':_0x44363e(0x11d)},'isAllowEdit':{'$first':_0x44363e(0x11e)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x44363e(0x1e8),_0xac0b0e);if(_0x1b33ec[0x0]['language']==_0x44363e(0x1e1)){var _0x575648=users[_0x44363e(0x1ac)];console[_0x44363e(0x20a)](_0x575648);}else{if(_0x1b33ec[0x0]['language']==_0x44363e(0x199))var _0x575648=users['Hindi'];else{if(_0x1b33ec[0x0][_0x44363e(0x1aa)]=='German')var _0x575648=users[_0x44363e(0x1c8)];else{if(_0x1b33ec[0x0]['language']==_0x44363e(0x170))var _0x575648=users[_0x44363e(0x170)];else{if(_0x1b33ec[0x0][_0x44363e(0x1aa)]==_0x44363e(0x155))var _0x575648=users[_0x44363e(0x155)];else{if(_0x1b33ec[0x0][_0x44363e(0x1aa)]=='Portuguese\x20(BR)')var _0x575648=users[_0x44363e(0x1e9)];else{if(_0x1b33ec[0x0][_0x44363e(0x1aa)]==_0x44363e(0x20e))var _0x575648=users['Chinese'];else{if(_0x1b33ec[0x0][_0x44363e(0x1aa)]=='Arabic\x20(ae)')var _0x575648=users[_0x44363e(0x197)];}}}}}}}_0x18692e[_0x44363e(0x1a8)]('all_sales',{'success':_0x166c09[_0x44363e(0x218)](_0x44363e(0x1b4)),'errors':_0x166c09['flash'](_0x44363e(0x12e)),'sales':_0xac0b0e,'profile':_0x4740fb,'role':_0x5dc10f,'master_shop':_0x1b33ec,'language':_0x575648});}catch(_0x4aecdf){console['log'](_0x4aecdf);}});async function getRandom8DigitNumber(){var _0x3a4d4e=a0_0x2f4975;const _0x330d0f=0x989680,_0x57043a=0x5f5e0ff,_0x5b6d24=Math[_0x3a4d4e(0x1c2)](Math[_0x3a4d4e(0x13b)]()*(_0x57043a-_0x330d0f+0x1))+_0x330d0f;var _0xeacd4d;const _0x11a9fb=await sales[_0x3a4d4e(0x1f5)]({'invoice':_0x3a4d4e(0x120)+_0x5b6d24});return _0x11a9fb&&_0x11a9fb[_0x3a4d4e(0x19d)]>0x0?_0xeacd4d=_0x3a4d4e(0x120)+_0x5b6d24:_0xeacd4d=_0x3a4d4e(0x120)+_0x5b6d24,_0xeacd4d;}router['get']('/view/add_sales',auth,async(_0x2335b2,_0x246003)=>{var _0xc43773=a0_0x2f4975;try{const {username:_0xc2f922,email:_0x3c1d49,role:_0x3a85fd}=_0x2335b2[_0xc43773(0x114)],_0x5741ea=_0x2335b2['user'],_0x265721=await profile[_0xc43773(0x1f5)]({'email':_0x5741ea[_0xc43773(0x1fc)]}),_0x16b240=await master_shop[_0xc43773(0x1b9)](),_0x2ae431=await customer['find']({});let _0x33507b;if(_0x5741ea['role']==_0xc43773(0x127)){const _0x5967a5=await staff[_0xc43773(0x1f5)]({'email':_0x5741ea[_0xc43773(0x1fc)]});_0x33507b=await warehouse[_0xc43773(0x141)]([{'$match':{'status':_0xc43773(0x184),'name':_0x5967a5[_0xc43773(0x124)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xc43773(0x180)}}},{'$group':{'_id':'$name','name':{'$first':_0xc43773(0x11f)}}},{'$sort':{'name':0x1}}]);}else _0x33507b=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xc43773(0x21d),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0xc43773(0x11f),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x4d067e=await product['find']({});var _0x1794bc=['Ambient',_0xc43773(0x153)];const _0x1f9679=await sales[_0xc43773(0x1b9)]({}),_0x4d492e=_0x1f9679['length']+0x1,_0x15ac80=_0xc43773(0x120)+_0x4d492e['toString']()['padStart'](0x5,'0');if(_0x16b240[0x0][_0xc43773(0x1aa)]==_0xc43773(0x1e1)){var _0x3c64c4=users[_0xc43773(0x1ac)];console['log'](_0x3c64c4);}else{if(_0x16b240[0x0][_0xc43773(0x1aa)]=='Hindi')var _0x3c64c4=users[_0xc43773(0x199)];else{if(_0x16b240[0x0][_0xc43773(0x1aa)]==_0xc43773(0x1c8))var _0x3c64c4=users[_0xc43773(0x1c8)];else{if(_0x16b240[0x0][_0xc43773(0x1aa)]=='Spanish')var _0x3c64c4=users['Spanish'];else{if(_0x16b240[0x0][_0xc43773(0x1aa)]=='French')var _0x3c64c4=users['French'];else{if(_0x16b240[0x0][_0xc43773(0x1aa)]=='Portuguese\x20(BR)')var _0x3c64c4=users['Portuguese'];else{if(_0x16b240[0x0]['language']==_0xc43773(0x20e))var _0x3c64c4=users[_0xc43773(0x20e)];else{if(_0x16b240[0x0][_0xc43773(0x1aa)]==_0xc43773(0x1fa))var _0x3c64c4=users[_0xc43773(0x197)];}}}}}}}const _0x58df73=getRandom8DigitNumber();_0x58df73[_0xc43773(0x201)](_0x25a334=>{var _0x1d4aaa=_0xc43773;_0x246003[_0x1d4aaa(0x1a8)](_0x1d4aaa(0x211),{'success':_0x2335b2['flash']('success'),'errors':_0x2335b2[_0x1d4aaa(0x218)](_0x1d4aaa(0x12e)),'role':_0x5741ea,'profile':_0x265721,'customer':_0x2ae431,'warehouse':_0x33507b,'product':_0x4d067e,'invoice':_0x25a334,'master_shop':_0x16b240,'language':_0x3c64c4,'rooms_data':_0x1794bc});})[_0xc43773(0x1cd)](_0x301f4e=>{var _0x56f691=_0xc43773;_0x2335b2['flash'](_0x56f691(0x12e),_0x56f691(0x123)),_0x246003[_0x56f691(0x17b)](_0x56f691(0x1a6));});}catch(_0x2a8979){console[_0xc43773(0x20a)](_0x2a8979);}}),router['get'](a0_0x2f4975(0x18d),auth,async(_0x39aa3a,_0x2db222)=>{var _0x3c25e5=a0_0x2f4975;try{const _0xfb6a85=_0x39aa3a[_0x3c25e5(0x181)]['id'];console[_0x3c25e5(0x20a)](_0xfb6a85);const _0x314a72=await product[_0x3c25e5(0x1b9)](),_0x4c57bd=await purchases[_0x3c25e5(0x141)]([{'$match':{'warehouse_name':_0xfb6a85}},{'$unwind':_0x3c25e5(0x188)},{'$group':{'_id':_0x3c25e5(0x1f1)}}]);console['log'](_0x3c25e5(0x1d6),_0x4c57bd),_0x2db222['status'](0xc8)[_0x3c25e5(0x12c)]({'purchases_data':_0x4c57bd,'product_data':_0x314a72});}catch(_0x307e45){console['log'](_0x307e45);}}),router[a0_0x2f4975(0x21f)](a0_0x2f4975(0x12d),auth,async(_0x49fc4c,_0x3edbd3)=>{var _0xd55f4a=a0_0x2f4975;try{const {warehouse_data:_0xcad8eb,product_data:_0x52fa4e}=_0x49fc4c[_0xd55f4a(0x163)];console[_0xd55f4a(0x20a)](_0x49fc4c[_0xd55f4a(0x163)][_0xd55f4a(0x19e)]);;const _0x4d36a0=await master_shop[_0xd55f4a(0x1b9)]();console['log']('master',_0x4d36a0);const _0x21bc95=await product['findOne']({'name':_0x52fa4e});console['log'](_0xd55f4a(0x1bb),_0x21bc95);const _0x16ffa7=await warehouse[_0xd55f4a(0x141)]([{'$match':{'name':_0xcad8eb}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x52fa4e}},{'$group':{'_id':_0xd55f4a(0x11c),'product_stock':{'$first':_0xd55f4a(0x140)}}}]);console[_0xd55f4a(0x20a)]('stock_data',_0x16ffa7),_0x3edbd3[_0xd55f4a(0x1ee)](0xc8)[_0xd55f4a(0x12c)]({'master':_0x4d36a0,'new_product':_0x21bc95,'stock_data':_0x16ffa7});}catch(_0x42b29c){console['log'](_0x42b29c);}}),router[a0_0x2f4975(0x21f)](a0_0x2f4975(0x21e),auth,async(_0x168bea,_0x3dddca)=>{var _0x10b7de=a0_0x2f4975;try{const {invoice:_0xd525ab,date:_0x509737,warehouse_name:_0x42a216,product_name:_0x315adc,stock:_0x48dc34,quantity:_0x460631,note:_0x410ce3,room:_0x483a2c,primary_code:_0x734710,secondary_code:_0xb89a67,prod_code:_0x331b83,level:_0x1ed28b,isle:_0x22a6c9,pallet:_0x15cc41,batch_code:_0x1e0770,SCRN:_0x392fc8,expiry_date:_0x1ad1cd}=_0x168bea[_0x10b7de(0x163)];if(typeof _0x315adc==_0x10b7de(0x1d8))var _0x5cf822=[_0x168bea['body']['product_name']],_0x3ae269=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1ed)]],_0x53ae36=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x196)]],_0x549afd=[_0x168bea['body'][_0x10b7de(0x143)]],_0x319d05=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x11b)]],_0x2c5403=[_0x168bea['body'][_0x10b7de(0x179)]],_0x4ca334=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x164)]],_0x516bfe=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x18e)]],_0x37b829=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1bf)]],_0x5ab902=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x125)]],_0x3ec10e=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1b1)]],_0x394662=[_0x168bea['body'][_0x10b7de(0x16c)]],_0x202e2d=[_0x168bea[_0x10b7de(0x163)]['production_date']],_0x1261b6=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1f7)]],_0x4f6c73=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1cc)]],_0x1f9048=[_0x168bea[_0x10b7de(0x163)]['delivery_code']],_0x41e034=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x17f)]],_0x4906b1=[_0x168bea[_0x10b7de(0x163)]['quantity']],_0xab10b9=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x200)]],_0x372fba=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1af)]],_0x2a1f15=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1da)]],_0x2ec632=[_0x168bea['body'][_0x10b7de(0x13f)]],_0x317af8=[_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1d9)]];else var _0x5cf822=[..._0x168bea[_0x10b7de(0x163)]['product_name']],_0x3ae269=[..._0x168bea['body'][_0x10b7de(0x1ed)]],_0x53ae36=[..._0x168bea[_0x10b7de(0x163)]['carton']],_0x549afd=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x143)]],_0x319d05=[..._0x168bea['body'][_0x10b7de(0x11b)]],_0x2c5403=[..._0x168bea['body'][_0x10b7de(0x179)]],_0x4ca334=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x164)]],_0x516bfe=[..._0x168bea['body'][_0x10b7de(0x18e)]],_0x37b829=[..._0x168bea['body'][_0x10b7de(0x1bf)]],_0x5ab902=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x125)]],_0x3ec10e=[..._0x168bea['body'][_0x10b7de(0x1b1)]],_0x394662=[..._0x168bea['body']['max_per_unit']],_0x202e2d=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1ab)]],_0x1261b6=[..._0x168bea[_0x10b7de(0x163)]['requested_qty']],_0x4f6c73=[..._0x168bea['body'][_0x10b7de(0x1cc)]],_0x1f9048=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1e2)]],_0x41e034=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x17f)]],_0x4906b1=[..._0x168bea[_0x10b7de(0x163)]['quantity']],_0xab10b9=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x200)]],_0x372fba=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1af)]],_0x2a1f15=[..._0x168bea['body'][_0x10b7de(0x1da)]],_0x2ec632=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x13f)]],_0x317af8=[..._0x168bea[_0x10b7de(0x163)][_0x10b7de(0x1d9)]];const _0x95b575=_0x5cf822[_0x10b7de(0x186)](_0x3beffe=>{return _0x3beffe={'product_name':_0x3beffe};});_0x3ae269[_0x10b7de(0x175)]((_0x3ab439,_0x2cc2fd)=>{var _0x4c7341=_0x10b7de;_0x95b575[_0x2cc2fd][_0x4c7341(0x1ed)]=Math[_0x4c7341(0x1b2)](_0x3ab439);}),_0x2a1f15['forEach']((_0x1ec452,_0x5a08ea)=>{var _0x161172=_0x10b7de;_0x95b575[_0x5a08ea][_0x161172(0x1da)]=Math[_0x161172(0x1b2)](_0x1ec452);}),_0x2ec632[_0x10b7de(0x175)]((_0x2ba129,_0x51b294)=>{_0x95b575[_0x51b294]['actual_uom']=_0x2ba129;}),_0x317af8['forEach']((_0x2784ba,_0x596548)=>{_0x95b575[_0x596548]['id_transaction_from']=_0x2784ba;}),_0x53ae36[_0x10b7de(0x175)]((_0x33f258,_0x28d7e3)=>{var _0x3b03b1=_0x10b7de;_0x95b575[_0x28d7e3][_0x3b03b1(0x1d7)]=_0x33f258;}),_0x549afd[_0x10b7de(0x175)]((_0x3a6ae9,_0x1b2108)=>{var _0x5b50ce=_0x10b7de;_0x95b575[_0x1b2108][_0x5b50ce(0x143)]=_0x3a6ae9;}),_0x319d05[_0x10b7de(0x175)]((_0x20e5f2,_0x37922f)=>{var _0x358c97=_0x10b7de;_0x95b575[_0x37922f][_0x358c97(0x11b)]=_0x20e5f2;}),_0x2c5403[_0x10b7de(0x175)]((_0x1412d9,_0xe935db)=>{_0x95b575[_0xe935db]['product_code']=_0x1412d9;}),_0x4ca334[_0x10b7de(0x175)]((_0x35b136,_0x50e070)=>{var _0x1cdd48=_0x10b7de;_0xab10b9[_0x1cdd48(0x175)]((_0x27b471,_0x2dc3fb)=>{var _0x352d18=_0x1cdd48;if(_0x27b471==_0x352d18(0x1fb)&&_0x50e070==_0x2dc3fb){var _0x34dd56=_0x35b136['slice'](0x3);_0x95b575[_0x50e070]['storage']=_0x35b136[0x0],_0x95b575[_0x50e070][_0x352d18(0x167)]=_0x35b136[0x1],_0x95b575[_0x50e070][_0x352d18(0x1df)]=0x0,_0x95b575[_0x50e070][_0x352d18(0x139)]=0x0,_0x95b575[_0x50e070]['type']=_0x352d18(0x1f0),_0x95b575[_0x50e070][_0x352d18(0x20c)]=_0x34dd56;}else{if(_0x27b471==_0x352d18(0x165)&&_0x50e070==_0x2dc3fb){var _0x34dd56=_0x35b136[_0x352d18(0x117)](0x3);_0x95b575[_0x50e070][_0x352d18(0x1ca)]=_0x35b136[0x0],_0x95b575[_0x50e070][_0x352d18(0x167)]=_0x35b136[0x1],_0x95b575[_0x50e070][_0x352d18(0x1df)]=0x0,_0x95b575[_0x50e070][_0x352d18(0x139)]=0x0,_0x95b575[_0x50e070][_0x352d18(0x1c6)]='Floor',_0x95b575[_0x50e070][_0x352d18(0x20c)]=_0x35b136[0x5];}else{if(_0x50e070==_0x2dc3fb){var _0x1b12fe;if(_0x35b136[0x4]=='L')_0x1b12fe=_0x352d18(0x162);else _0x35b136[0x4]=='F'&&(_0x1b12fe=_0x352d18(0x1f0));_0x95b575[_0x50e070]['storage']=_0x35b136[0x0],_0x95b575[_0x50e070]['rack']=_0x35b136[0x1],_0x95b575[_0x50e070][_0x352d18(0x1df)]=_0x35b136[0x2],_0x95b575[_0x50e070][_0x352d18(0x139)]=_0x35b136[0x3],_0x95b575[_0x50e070][_0x352d18(0x1c6)]=_0x1b12fe,_0x95b575[_0x50e070][_0x352d18(0x20c)]=_0x35b136[0x5];}}}});}),_0x516bfe[_0x10b7de(0x175)]((_0x435875,_0x17f5cf)=>{var _0x1d9a98=_0x10b7de;_0x95b575[_0x17f5cf][_0x1d9a98(0x1c0)]=_0x435875;}),_0x37b829[_0x10b7de(0x175)]((_0xf3a44d,_0x48f70f)=>{var _0x584373=_0x10b7de;_0x95b575[_0x48f70f][_0x584373(0x1bf)]=_0xf3a44d;}),_0x5ab902[_0x10b7de(0x175)]((_0x3c219a,_0x264f7f)=>{var _0x2f9020=_0x10b7de;_0x95b575[_0x264f7f][_0x2f9020(0x125)]=_0x3c219a;}),_0x3ec10e['forEach']((_0x724e9,_0x4539ae)=>{var _0x340a2f=_0x10b7de;_0x95b575[_0x4539ae][_0x340a2f(0x1b1)]=_0x724e9;}),_0x394662['forEach']((_0x157071,_0x446624)=>{var _0x81437=_0x10b7de;_0x95b575[_0x446624][_0x81437(0x144)]=_0x157071;}),_0x202e2d[_0x10b7de(0x175)]((_0x15d014,_0x5a1508)=>{var _0x3f3f7c=_0x10b7de;_0x95b575[_0x5a1508][_0x3f3f7c(0x1ab)]=_0x15d014;}),_0x1261b6['forEach']((_0x4c93af,_0x38d577)=>{_0x95b575[_0x38d577]['requested_qty']=_0x4c93af;}),_0x4f6c73['forEach']((_0x22dd6c,_0x47ba6c)=>{var _0x196b2b=_0x10b7de;_0x95b575[_0x47ba6c][_0x196b2b(0x1cc)]=_0x22dd6c;}),_0x1f9048[_0x10b7de(0x175)]((_0xc76d6e,_0x58c80d)=>{var _0x3f66d0=_0x10b7de;_0x95b575[_0x58c80d][_0x3f66d0(0x1e2)]=_0xc76d6e;}),_0x41e034[_0x10b7de(0x175)]((_0xa686a4,_0x543b2a)=>{var _0x1824ca=_0x10b7de;_0x95b575[_0x543b2a][_0x1824ca(0x17f)]=_0xa686a4;}),_0x4906b1[_0x10b7de(0x175)]((_0x4f6471,_0xbd5456)=>{var _0xbcce7e=_0x10b7de;_0x95b575[_0xbd5456][_0xbcce7e(0x18a)]=_0x4f6471;}),_0xab10b9[_0x10b7de(0x175)]((_0x24eeb0,_0x14fcdf)=>{_0x95b575[_0x14fcdf]['room_name']=_0x24eeb0;}),_0x372fba[_0x10b7de(0x175)]((_0x464c7d,_0x57e6d6)=>{var _0x2323a5=_0x10b7de;_0x95b575[_0x57e6d6][_0x2323a5(0x1b8)]=_0x464c7d;});var _0x328dc2=0x0;_0x95b575[_0x10b7de(0x175)](_0x402ef0=>{var _0x297c5d=_0x10b7de;(_0x402ef0[_0x297c5d(0x1ed)]<_0x402ef0[_0x297c5d(0x18a)]||_0x402ef0[_0x297c5d(0x18a)]==0x0)&&(console[_0x297c5d(0x20a)](_0x297c5d(0x1de),_0x402ef0),_0x328dc2++);});const _0x23064c=_0x95b575[_0x10b7de(0x205)](_0x1c0ebc=>_0x1c0ebc['quantity']!=='0'&&_0x1c0ebc[_0x10b7de(0x1d7)]!==''),_0x38b8e5=new sales({'invoice':_0xd525ab,'customer':_0x168bea[_0x10b7de(0x163)][_0x10b7de(0x14c)],'date':_0x509737,'warehouse_name':_0x42a216,'sale_product':_0x23064c,'note':_0x410ce3,'room':_0x483a2c,'primary_code':_0x734710,'secondary_code':_0xb89a67,'prod_code':_0x331b83,'SCRN':_0x392fc8}),_0x384d89=await _0x38b8e5[_0x10b7de(0x1e5)]();_0x168bea['flash'](_0x10b7de(0x1b4),_0x10b7de(0x1ff)),_0x3dddca[_0x10b7de(0x17b)]('/all_sales/preview/'+_0x384d89[_0x10b7de(0x209)]);}catch(_0x185f9d){console['log'](_0x185f9d);}}),router[a0_0x2f4975(0x1e3)](a0_0x2f4975(0x113),auth,async(_0x4f1bb7,_0x460fb6)=>{var _0x1c7584=a0_0x2f4975;try{const {username:_0x210134,email:_0x1772d7,role:_0x47a913}=_0x4f1bb7[_0x1c7584(0x114)],_0x3c6849=_0x4f1bb7['user'],_0x4b388e=await profile[_0x1c7584(0x1f5)]({'email':_0x3c6849[_0x1c7584(0x1fc)]}),_0x46c1bf=await master_shop[_0x1c7584(0x1b9)](),_0xa1bc4b=_0x4f1bb7[_0x1c7584(0x181)]['id'],_0x4df700=await sales['findById'](_0xa1bc4b),_0x4a80be=await warehouse[_0x1c7584(0x141)]([{'$match':{'name':_0x4df700[_0x1c7584(0x15c)]}},{'$unwind':_0x1c7584(0x142)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1c7584(0x140)},'bay':{'$first':_0x1c7584(0x129)},'bin':{'$first':_0x1c7584(0x187)},'type':{'$first':_0x1c7584(0x1fd)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1c7584(0x1a7)},'secondary_code':{'$first':_0x1c7584(0x131)},'product_code':{'$first':_0x1c7584(0x1d4)},'storage':{'$first':_0x1c7584(0x15a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1c7584(0x1ce)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x1c7584(0x19c)}}}]),_0x47dbb5=await customer[_0x1c7584(0x1b9)]({});let _0x356b17;if(_0x3c6849[_0x1c7584(0x1f3)]=='staff'){const _0x4a8e1e=await staff[_0x1c7584(0x1f5)]({'email':_0x3c6849[_0x1c7584(0x1fc)]});_0x356b17=await warehouse['aggregate']([{'$match':{'status':_0x1c7584(0x184),'name':_0x4a8e1e[_0x1c7584(0x124)]}},{'$group':{'_id':_0x1c7584(0x11f),'name':{'$first':'$name'}}}]);}else _0x356b17=await warehouse[_0x1c7584(0x141)]([{'$match':{'status':_0x1c7584(0x184)}},{'$group':{'_id':'$name','name':{'$first':_0x1c7584(0x11f)}}}]);const _0x9a2208=await product[_0x1c7584(0x1b9)]({}),_0x2eaa7d=await suppliers['find']({});if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]==_0x1c7584(0x1e1)){var _0x1f49c4=users[_0x1c7584(0x1ac)];console['log'](_0x1f49c4);}else{if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]==_0x1c7584(0x199))var _0x1f49c4=users['Hindi'];else{if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]=='German')var _0x1f49c4=users[_0x1c7584(0x1c8)];else{if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]==_0x1c7584(0x170))var _0x1f49c4=users[_0x1c7584(0x170)];else{if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]==_0x1c7584(0x155))var _0x1f49c4=users[_0x1c7584(0x155)];else{if(_0x46c1bf[0x0]['language']==_0x1c7584(0x15f))var _0x1f49c4=users['Portuguese'];else{if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]==_0x1c7584(0x20e))var _0x1f49c4=users[_0x1c7584(0x20e)];else{if(_0x46c1bf[0x0][_0x1c7584(0x1aa)]==_0x1c7584(0x1fa))var _0x1f49c4=users[_0x1c7584(0x197)];}}}}}}}_0x460fb6[_0x1c7584(0x1a8)]('edit_sales_view',{'success':_0x4f1bb7[_0x1c7584(0x218)](_0x1c7584(0x1b4)),'errors':_0x4f1bb7['flash'](_0x1c7584(0x12e)),'role':_0x3c6849,'profile':_0x4b388e,'customer':_0x47dbb5,'warehouse':_0x356b17,'product':_0x4a80be,'user':_0x4df700,'master_shop':_0x46c1bf,'unit':_0x9a2208,'language':_0x1f49c4,'suppliers':_0x2eaa7d});}catch(_0x5ef787){console[_0x1c7584(0x20a)](_0x5ef787);}}),router[a0_0x2f4975(0x21f)](a0_0x2f4975(0x113),auth,async(_0x38be91,_0x46b382)=>{var _0x5ec363=a0_0x2f4975;try{const _0x283cc9=_0x38be91['params']['id'],{invoice:_0x399a34,warehouse_name:_0x47e318,room:_0x5da30f}=_0x38be91[_0x5ec363(0x163)],_0x5bd05f=await sales['findOne']({'invoice':_0x399a34}),_0x483caa=_0x5bd05f[_0x5ec363(0x16a)][_0x5ec363(0x186)](async _0x5d7d8c=>{var _0x4e2da3=_0x5ec363,_0xd42d27=await warehouse[_0x4e2da3(0x1f5)]({'name':_0x47e318,'room':_0x5d7d8c[_0x4e2da3(0x20d)],'warehouse_category':_0x4e2da3(0x21d)});const _0x32da96=_0xd42d27['product_details'][_0x4e2da3(0x186)](_0x3a45a9=>{var _0xed8a94=_0x4e2da3;_0x3a45a9[_0xed8a94(0x1ec)]==_0x5d7d8c[_0xed8a94(0x1ec)]&&_0x3a45a9[_0xed8a94(0x20c)]==_0x5d7d8c[_0xed8a94(0x20c)]&&_0x3a45a9['type']==_0x5d7d8c[_0xed8a94(0x1c6)]&&_0x3a45a9['bin']==_0x5d7d8c[_0xed8a94(0x139)]&&_0x3a45a9['bay']==_0x5d7d8c['bay']&&_0x3a45a9[_0xed8a94(0x167)]==_0x5d7d8c[_0xed8a94(0x167)]&&_0x3a45a9[_0xed8a94(0x1ca)]==_0x5d7d8c[_0xed8a94(0x1ca)]&&_0x3a45a9['expiry_date']==_0x5d7d8c[_0xed8a94(0x1b1)]&&_0x3a45a9[_0xed8a94(0x125)]==_0x5d7d8c[_0xed8a94(0x125)]&&_0x3a45a9[_0xed8a94(0x1b8)]==_0x5d7d8c['invoice']&&_0x3a45a9[_0xed8a94(0x209)]==_0x5d7d8c['id_transaction_from']&&(_0x3a45a9[_0xed8a94(0x1b7)]=Math[_0xed8a94(0x122)](0x0,Math[_0xed8a94(0x1b2)](_0x3a45a9[_0xed8a94(0x1b7)])-Math[_0xed8a94(0x1b2)](_0x5d7d8c[_0xed8a94(0x1d7)])));});return _0xd42d27;});Promise['all'](_0x483caa)[_0x5ec363(0x201)](async _0x435216=>{var _0x5e6093=_0x5ec363;try{for(const _0x18c967 of _0x435216){await _0x18c967[_0x5e6093(0x1e5)]();}_0x5bd05f[_0x5e6093(0x210)]=_0x5e6093(0x13c);const _0x3ee48a=await _0x5bd05f[_0x5e6093(0x1e5)](),_0x5b6fd4=await master_shop[_0x5e6093(0x1b9)](),_0x308ef5=await email_settings['findOne'](),_0x339222=await supervisor_settings['find']();var _0x440cd2=_0x5bd05f[_0x5e6093(0x16a)],_0x1170fd='',_0x39311e;for(_0x39311e in _0x440cd2){_0x1170fd+='<tr>'+_0x5e6093(0x13a)+_0x440cd2[_0x39311e][_0x5e6093(0x1ec)]+_0x5e6093(0x222)+_0x5e6093(0x13a)+_0x440cd2[_0x39311e]['product_code']+'</td>'+_0x5e6093(0x13a)+_0x440cd2[_0x39311e][_0x5e6093(0x1d7)]+_0x5e6093(0x222)+_0x5e6093(0x13a)+_0x440cd2[_0x39311e][_0x5e6093(0x1c0)]+_0x5e6093(0x222)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x440cd2[_0x39311e][_0x5e6093(0x1bf)]+_0x5e6093(0x222)+_0x5e6093(0x13a)+_0x5bd05f['warehouse_name']+_0x5e6093(0x222)+_0x5e6093(0x13a)+_0x440cd2[_0x39311e]['room_name']+'</td>'+_0x5e6093(0x13a)+_0x440cd2[_0x39311e][_0x5e6093(0x1ca)]+_0x440cd2[_0x39311e]['rack']+_0x440cd2[_0x39311e][_0x5e6093(0x1df)]+_0x440cd2[_0x39311e]['bin']+_0x440cd2[_0x39311e][_0x5e6093(0x1c6)][0x0]+_0x440cd2[_0x39311e][_0x5e6093(0x20c)]+_0x5e6093(0x222),_0x5e6093(0x130);}let _0x28cd28=nodemailer[_0x5e6093(0x182)]({'host':_0x308ef5[_0x5e6093(0x12f)],'port':Number(_0x308ef5[_0x5e6093(0x1f8)]),'secure':![],'auth':{'user':_0x308ef5[_0x5e6093(0x1fc)],'pass':_0x308ef5[_0x5e6093(0x204)]}}),_0x3c8b20={'from':_0x308ef5[_0x5e6093(0x1fc)],'to':_0x339222[0x0]['RMSEmail'],'subject':_0x5e6093(0x221),'attachments':[{'filename':_0x5e6093(0x213),'path':__dirname+'/../public'+_0x5e6093(0x21b)+_0x5b6fd4[0x0][_0x5e6093(0x190)],'cid':_0x5e6093(0x19f)}],'html':_0x5e6093(0x1e6)+_0x5e6093(0x169)+'</head><body>'+_0x5e6093(0x160)+_0x5e6093(0x191)+'<div>'+_0x5e6093(0x13e)+'</div>'+_0x5e6093(0x160)+_0x5e6093(0x1d2)+_0x5b6fd4[0x0][_0x5e6093(0x112)]+_0x5e6093(0x138)+_0x5e6093(0x194)+'</div>'+_0x5e6093(0x150)+_0x5e6093(0x160)+_0x5e6093(0x17a)+_0x5e6093(0x1c9)+_0x5bd05f['invoice']+'\x20'+_0x5e6093(0x189)+_0x5e6093(0x1ea)+_0x5bd05f[_0x5e6093(0x1f2)]+'\x20'+'</span>'+_0x5e6093(0x21c)+'</div>'+_0x5e6093(0x185)+_0x5e6093(0x203)+_0x5e6093(0x214)+_0x5e6093(0x15d)+_0x5e6093(0x1bc)+_0x5e6093(0x18b)+_0x5e6093(0x1a0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x5e6093(0x216)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x5e6093(0x1a4)+_0x5e6093(0x154)+'\x20'+_0x1170fd+'\x20'+_0x5e6093(0x1c4)+_0x5e6093(0x16e)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x5e6093(0x1ae)+_0x5b6fd4[0x0][_0x5e6093(0x112)]+_0x5e6093(0x21c)+_0x5e6093(0x194)+_0x5e6093(0x194)+_0x5e6093(0x111)};_0x28cd28[_0x5e6093(0x1cf)](_0x3c8b20,function(_0xc8a585,_0x3ae10f){var _0x2c4da0=_0x5e6093;_0xc8a585?(console[_0x2c4da0(0x20a)](_0xc8a585),console[_0x2c4da0(0x20a)]('Error\x20Occurs')):console[_0x2c4da0(0x20a)]('Email\x20sent\x20successfully');}),_0x38be91['flash'](_0x5e6093(0x1b4),'Sales\x20Update\x20successfully'),_0x46b382[_0x5e6093(0x17b)](_0x5e6093(0x156)+_0x283cc9);}catch(_0x16b57b){console['error'](_0x16b57b),_0x46b382[_0x5e6093(0x1ee)](0x1f4)[_0x5e6093(0x12c)]({'error':_0x5e6093(0x195)});}})[_0x5ec363(0x1cd)](_0x279025=>{var _0x4109cf=_0x5ec363;console['error'](_0x279025),_0x46b382['status'](0x1f4)[_0x4109cf(0x12c)]({'error':_0x4109cf(0x157)});});}catch(_0x3094f7){console[_0x5ec363(0x20a)](_0x3094f7);}}),router[a0_0x2f4975(0x1e3)](a0_0x2f4975(0x16b),auth,async(_0x5c9dd3,_0x14caef)=>{var _0x20049e=a0_0x2f4975;try{const {username:_0x10466a,email:_0x3b04d3,role:_0xa95a6d}=_0x5c9dd3[_0x20049e(0x114)],_0x2e0ef7=_0x5c9dd3[_0x20049e(0x114)],_0x4dc715=await profile['findOne']({'email':_0x2e0ef7[_0x20049e(0x1fc)]}),_0x21a129=await master_shop[_0x20049e(0x1b9)](),_0x1fd9c8=_0x5c9dd3[_0x20049e(0x181)]['id'],_0xaf7e1d=await sales[_0x20049e(0x166)](_0x1fd9c8);var _0x26d66c=[_0x20049e(0x202),_0x20049e(0x153)];const _0x5f1e90=await warehouse[_0x20049e(0x141)]([{'$match':{'name':_0xaf7e1d['warehouse_name'],'warehouse_category':_0x20049e(0x21d)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x20049e(0x14b),'name':{'$first':_0x20049e(0x11c)},'product_stock':{'$first':_0x20049e(0x140)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x20049e(0x187)},'type':{'$first':_0x20049e(0x1fd)},'floorlevel':{'$first':_0x20049e(0x1a3)},'primary_code':{'$first':_0x20049e(0x1a7)},'secondary_code':{'$first':_0x20049e(0x131)},'product_code':{'$first':_0x20049e(0x1d4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x20049e(0x1d3)}}}]),_0xe3de6f=await customer[_0x20049e(0x1b9)]({});let _0x23d145;if(_0x2e0ef7['role']==_0x20049e(0x127)){const _0x42c31b=await staff[_0x20049e(0x1f5)]({'email':_0x2e0ef7[_0x20049e(0x1fc)]});_0x23d145=await warehouse[_0x20049e(0x141)]([{'$match':{'status':_0x20049e(0x184),'name':_0x42c31b[_0x20049e(0x124)],'warehouse_category':_0x20049e(0x21d)}},{'$group':{'_id':_0x20049e(0x11f),'name':{'$first':'$name'}}}]);}else _0x23d145=await warehouse['aggregate']([{'$match':{'status':_0x20049e(0x184),'warehouse_category':_0x20049e(0x21d)}},{'$group':{'_id':_0x20049e(0x11f),'name':{'$first':_0x20049e(0x11f)}}}]);const _0x2782f1=await product['find']({});if(_0x21a129[0x0][_0x20049e(0x1aa)]=='English\x20(US)'){var _0xd1ef3e=users[_0x20049e(0x1ac)];console[_0x20049e(0x20a)](_0xd1ef3e);}else{if(_0x21a129[0x0][_0x20049e(0x1aa)]==_0x20049e(0x199))var _0xd1ef3e=users[_0x20049e(0x199)];else{if(_0x21a129[0x0][_0x20049e(0x1aa)]=='German')var _0xd1ef3e=users[_0x20049e(0x1c8)];else{if(_0x21a129[0x0][_0x20049e(0x1aa)]==_0x20049e(0x170))var _0xd1ef3e=users[_0x20049e(0x170)];else{if(_0x21a129[0x0][_0x20049e(0x1aa)]==_0x20049e(0x155))var _0xd1ef3e=users[_0x20049e(0x155)];else{if(_0x21a129[0x0][_0x20049e(0x1aa)]==_0x20049e(0x15f))var _0xd1ef3e=users[_0x20049e(0x1e9)];else{if(_0x21a129[0x0][_0x20049e(0x1aa)]==_0x20049e(0x20e))var _0xd1ef3e=users[_0x20049e(0x20e)];else{if(_0x21a129[0x0][_0x20049e(0x1aa)]==_0x20049e(0x1fa))var _0xd1ef3e=users['Arabic'];}}}}}}}_0x14caef[_0x20049e(0x1a8)]('edit_sales',{'success':_0x5c9dd3['flash'](_0x20049e(0x1b4)),'errors':_0x5c9dd3[_0x20049e(0x218)](_0x20049e(0x12e)),'role':_0x2e0ef7,'profile':_0x4dc715,'customer':_0xe3de6f,'warehouse':_0x23d145,'product':_0x5f1e90,'user':_0xaf7e1d,'master_shop':_0x21a129,'unit':_0x2782f1,'language':_0xd1ef3e});}catch(_0x37cdfa){console[_0x20049e(0x20a)](_0x37cdfa);}}),router[a0_0x2f4975(0x21f)]('/view/:id',auth,async(_0x5e6ae9,_0x44217f)=>{var _0x536f7d=a0_0x2f4975;try{const _0x54b444=_0x5e6ae9[_0x536f7d(0x181)]['id'],_0x148060=await sales[_0x536f7d(0x1f5)]({'_id':_0x5e6ae9[_0x536f7d(0x181)]['id']}),_0x286655=await warehouse[_0x536f7d(0x1f5)]({'name':_0x148060[_0x536f7d(0x15c)],'room':_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x178)]}),{invoice:_0x100908,date:_0x25821c,warehouse_name:_0x42ed90,product_name:_0x2c63a8,stock:_0x3ef98f,quantity:_0x1de8f6,note:_0x111f71,room:_0x579487,customer:_0x3d30ce,SCRN:_0x292e17}=_0x5e6ae9[_0x536f7d(0x163)];if(typeof _0x2c63a8==_0x536f7d(0x1d8))var _0x3a4d47=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1ec)]],_0xc260cc=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1ed)]],_0x44961b=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x196)]],_0x4cc172=[_0x5e6ae9[_0x536f7d(0x163)]['primary_code']],_0x171e8c=[_0x5e6ae9[_0x536f7d(0x163)]['secondary_code']],_0x3b7fab=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x179)]],_0x165dce=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x164)]],_0x2d142d=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x18e)]],_0x480557=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1bf)]],_0x505a0c=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x125)]],_0x393364=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1b1)]],_0x423bd2=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x16c)]],_0x5ca6f6=[_0x5e6ae9['body']['production_date']],_0x4bf88e=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1f7)]],_0x2fac5a=[_0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1cc)]],_0x2b91fa=[_0x5e6ae9['body'][_0x536f7d(0x1e2)]],_0x3bdbac=[_0x5e6ae9['body'][_0x536f7d(0x17f)]],_0x5daa07=[_0x5e6ae9[_0x536f7d(0x163)]['quantity']],_0x5a06e0=[_0x5e6ae9[_0x536f7d(0x163)]['RoomAssigned']];else var _0x3a4d47=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1ec)]],_0xc260cc=[..._0x5e6ae9['body'][_0x536f7d(0x1ed)]],_0x44961b=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x196)]],_0x4cc172=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x143)]],_0x171e8c=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x11b)]],_0x3b7fab=[..._0x5e6ae9['body']['prod_code']],_0x165dce=[..._0x5e6ae9[_0x536f7d(0x163)]['level']],_0x2d142d=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x18e)]],_0x480557=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1bf)]],_0x505a0c=[..._0x5e6ae9['body'][_0x536f7d(0x125)]],_0x393364=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1b1)]],_0x423bd2=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x16c)]],_0x5ca6f6=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1ab)]],_0x4bf88e=[..._0x5e6ae9['body'][_0x536f7d(0x1f7)]],_0x2fac5a=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1cc)]],_0x2b91fa=[..._0x5e6ae9[_0x536f7d(0x163)]['delivery_code']],_0x3bdbac=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x17f)]],_0x5daa07=[..._0x5e6ae9[_0x536f7d(0x163)][_0x536f7d(0x1d7)]],_0x5a06e0=[..._0x5e6ae9[_0x536f7d(0x163)]['RoomAssigned']];const _0x3ac8e5=_0x3a4d47[_0x536f7d(0x186)](_0x288e7f=>{return _0x288e7f={'product_name':_0x288e7f};});_0xc260cc['forEach']((_0x392c5d,_0x43d3f5)=>{var _0xa02aac=_0x536f7d;_0x3ac8e5[_0x43d3f5][_0xa02aac(0x1ed)]=Math[_0xa02aac(0x1b2)](_0x392c5d);}),_0x44961b[_0x536f7d(0x175)]((_0x727408,_0x56bf22)=>{var _0x40a6e3=_0x536f7d;_0x3ac8e5[_0x56bf22][_0x40a6e3(0x1d7)]=_0x727408;}),_0x4cc172[_0x536f7d(0x175)]((_0x498cc2,_0x15bac4)=>{var _0x2cc044=_0x536f7d;_0x3ac8e5[_0x15bac4][_0x2cc044(0x143)]=_0x498cc2;}),_0x171e8c[_0x536f7d(0x175)]((_0x1846c6,_0x430f6d)=>{var _0xfd7cb9=_0x536f7d;_0x3ac8e5[_0x430f6d][_0xfd7cb9(0x11b)]=_0x1846c6;}),_0x3b7fab[_0x536f7d(0x175)]((_0xd6bd2,_0x5299ca)=>{_0x3ac8e5[_0x5299ca]['product_code']=_0xd6bd2;}),_0x165dce[_0x536f7d(0x175)]((_0x5d2a9c,_0x46ba39)=>{var _0x56dca9=_0x536f7d;_0x5a06e0[_0x56dca9(0x175)]((_0x5f4c96,_0x17313b)=>{var _0x4f60fa=_0x56dca9;if(_0x5f4c96=='Receiving\x20Area'&&_0x46ba39==_0x17313b){var _0x117051=_0x5d2a9c[_0x4f60fa(0x117)](0x3);_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1ca)]=_0x5d2a9c[0x0],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x167)]=_0x5d2a9c[0x1],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1df)]=0x0,_0x3ac8e5[_0x46ba39]['bin']=0x0,_0x3ac8e5[_0x46ba39]['type']=_0x4f60fa(0x1f0),_0x3ac8e5[_0x46ba39]['floorlevel']=_0x117051;}else{if(_0x5f4c96=='Shelves'&&_0x46ba39==_0x17313b){var _0x117051=_0x5d2a9c[_0x4f60fa(0x117)](0x3);_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1ca)]=_0x5d2a9c[0x0],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x167)]=_0x5d2a9c[0x1],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1df)]=0x0,_0x3ac8e5[_0x46ba39]['bin']=0x0,_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1c6)]=_0x4f60fa(0x1f0),_0x3ac8e5[_0x46ba39]['floorlevel']=_0x5d2a9c[0x5];}else{if(_0x46ba39==_0x17313b){var _0x580ea1;if(_0x5d2a9c[0x4]=='L')_0x580ea1=_0x4f60fa(0x162);else _0x5d2a9c[0x4]=='F'&&(_0x580ea1='Floor');_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1ca)]=_0x5d2a9c[0x0],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x167)]=_0x5d2a9c[0x1],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1df)]=_0x5d2a9c[0x2],_0x3ac8e5[_0x46ba39]['bin']=_0x5d2a9c[0x3],_0x3ac8e5[_0x46ba39][_0x4f60fa(0x1c6)]=_0x580ea1,_0x3ac8e5[_0x46ba39][_0x4f60fa(0x20c)]=_0x5d2a9c[0x5];}}}});}),_0x2d142d[_0x536f7d(0x175)]((_0xd68602,_0x53895a)=>{var _0x2b359d=_0x536f7d;_0x3ac8e5[_0x53895a][_0x2b359d(0x1c0)]=_0xd68602;}),_0x480557[_0x536f7d(0x175)]((_0x53bdd1,_0xf1db5e)=>{_0x3ac8e5[_0xf1db5e]['secondary_unit']=_0x53bdd1;}),_0x505a0c[_0x536f7d(0x175)]((_0x1d9ba6,_0x137b8c)=>{var _0x152b16=_0x536f7d;_0x3ac8e5[_0x137b8c][_0x152b16(0x125)]=_0x1d9ba6;}),_0x393364['forEach']((_0x5d76f9,_0x11df52)=>{var _0x25e91f=_0x536f7d;_0x3ac8e5[_0x11df52][_0x25e91f(0x1b1)]=_0x5d76f9;}),_0x423bd2['forEach']((_0x848c77,_0x51577b)=>{var _0x5d6767=_0x536f7d;_0x3ac8e5[_0x51577b][_0x5d6767(0x144)]=_0x848c77;}),_0x5ca6f6[_0x536f7d(0x175)]((_0x103dd8,_0x1c240c)=>{_0x3ac8e5[_0x1c240c]['production_date']=_0x103dd8;}),_0x4bf88e['forEach']((_0x12d0f6,_0x3c9bcb)=>{var _0x15dd1c=_0x536f7d;_0x3ac8e5[_0x3c9bcb][_0x15dd1c(0x1f7)]=Math[_0x15dd1c(0x1b2)](_0x12d0f6);}),_0x2fac5a[_0x536f7d(0x175)]((_0x40e70e,_0x1de0ee)=>{var _0x49c2ad=_0x536f7d;_0x3ac8e5[_0x1de0ee][_0x49c2ad(0x1cc)]=_0x40e70e;}),_0x2b91fa[_0x536f7d(0x175)]((_0x3fced7,_0x5685c8)=>{var _0x115bae=_0x536f7d;_0x3ac8e5[_0x5685c8][_0x115bae(0x1e2)]=_0x3fced7;}),_0x3bdbac['forEach']((_0x2bd183,_0x13955e)=>{var _0x2a26e7=_0x536f7d;_0x3ac8e5[_0x13955e][_0x2a26e7(0x17f)]=_0x2bd183;}),_0x5daa07[_0x536f7d(0x175)]((_0x2d6ee4,_0x5da22b)=>{var _0x1c8c92=_0x536f7d;_0x3ac8e5[_0x5da22b][_0x1c8c92(0x18a)]=_0x2d6ee4;}),_0x5a06e0[_0x536f7d(0x175)]((_0x37ce19,_0x1b0983)=>{var _0x38ccae=_0x536f7d;_0x3ac8e5[_0x1b0983][_0x38ccae(0x20d)]=_0x37ce19;});var _0x485dd0=0x0;_0x3ac8e5[_0x536f7d(0x175)](_0x4889b3=>{var _0x1b98bc=_0x536f7d;console[_0x1b98bc(0x20a)](_0x1b98bc(0x1de),_0x4889b3),(parseInt(_0x4889b3[_0x1b98bc(0x1ed)])<parseInt(_0x4889b3[_0x1b98bc(0x1d7)])||parseInt(_0x4889b3[_0x1b98bc(0x1d7)])==0x0)&&_0x485dd0++;});if(_0x485dd0!=0x0)return _0x5e6ae9[_0x536f7d(0x218)](_0x536f7d(0x12e),_0x536f7d(0x147)),_0x44217f[_0x536f7d(0x17b)](_0x536f7d(0x12a));const _0x593153=_0x3ac8e5[_0x536f7d(0x205)](_0x2780e6=>_0x2780e6[_0x536f7d(0x1d7)]!=='0'&&_0x2780e6[_0x536f7d(0x1d7)]!=='');_0x148060[_0x536f7d(0x1b8)]=_0x100908,_0x148060[_0x536f7d(0x14c)]=_0x3d30ce,_0x148060['date']=_0x25821c,_0x148060[_0x536f7d(0x15c)]=_0x42ed90,_0x148060[_0x536f7d(0x16a)]=_0x593153,_0x148060[_0x536f7d(0x217)]=_0x111f71,_0x148060[_0x536f7d(0x1cb)]=_0x292e17,_0x148060[_0x536f7d(0x210)]=_0x536f7d(0x145),_0x148060[_0x536f7d(0x1a1)]=_0x536f7d(0x145);const _0x34b418=await _0x148060[_0x536f7d(0x1e5)]();_0x5e6ae9[_0x536f7d(0x218)](_0x536f7d(0x1b4),_0x536f7d(0x1d0)),_0x44217f[_0x536f7d(0x17b)](_0x536f7d(0x1a6));}catch(_0x52ecc8){console[_0x536f7d(0x20a)](_0x52ecc8);}}),router[a0_0x2f4975(0x21f)](a0_0x2f4975(0x119),auth,async(_0x2f4b5c,_0x14071e)=>{var _0x310c88=a0_0x2f4975;try{const _0x547e18=_0x2f4b5c[_0x310c88(0x181)]['id'],{invoice:_0x58a40f,customer:_0x57bc46,receivable_amount:_0x24b9be,received_amount:_0x3a97f2}=_0x2f4b5c[_0x310c88(0x163)],_0x1c7479=await sales[_0x310c88(0x166)](_0x547e18);console['log'](_0x1c7479);var _0x825fa4=_0x24b9be-_0x3a97f2;console[_0x310c88(0x20a)](_0x3a97f2),_0x1c7479[_0x310c88(0x1f4)]=parseFloat(_0x3a97f2)+parseFloat(_0x1c7479['received_amount']),_0x1c7479[_0x310c88(0x1dd)]=_0x825fa4,console[_0x310c88(0x20a)](_0x1c7479);const _0x1c095a=await _0x1c7479[_0x310c88(0x1e5)](),_0x54348b=await c_payment_data['findOne']({'invoice':_0x58a40f});_0x54348b[_0x310c88(0x126)]=_0x825fa4,await _0x54348b[_0x310c88(0x1e5)]();let _0x294154=new Date(),_0x539f5f=('0'+_0x294154[_0x310c88(0x12b)]())[_0x310c88(0x117)](-0x2),_0x3260d0=('0'+(_0x294154[_0x310c88(0x16d)]()+0x1))[_0x310c88(0x117)](-0x2),_0x45ed3b=_0x294154[_0x310c88(0x1d5)](),_0x399c58=_0x45ed3b+'-'+_0x3260d0+'-'+_0x539f5f;const _0xf0e276=new customer_payment({'invoice':_0x58a40f,'date':_0x45ed3b+'-'+_0x3260d0+'-'+_0x539f5f,'customer':_0x57bc46,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3a97f2}),_0x3385ba=await _0xf0e276['save']();_0x2f4b5c[_0x310c88(0x218)](_0x310c88(0x1b4),_0x310c88(0x159)),_0x14071e[_0x310c88(0x17b)](_0x310c88(0x1a6));}catch(_0x2ad285){console[_0x310c88(0x20a)](_0x2ad285);}}),router[a0_0x2f4975(0x1e3)]('/invoice/:id',auth,async(_0x114f61,_0x388451)=>{var _0x323457=a0_0x2f4975;try{const {username:_0x3399ee,email:_0x1ac651,role:_0x2ae713}=_0x114f61[_0x323457(0x114)],_0xa105df=_0x114f61[_0x323457(0x114)],_0x499ea1=await profile['findOne']({'email':_0xa105df['email']}),_0x216542=await master_shop[_0x323457(0x1b9)]();console['log'](_0x323457(0x18f),_0x216542);const _0x5c71f3=_0x114f61[_0x323457(0x181)]['id'],_0x3a7896=await sales['findById'](_0x5c71f3);console['log'](_0x3a7896);const _0x181088=await customer[_0x323457(0x1f5)]({'name':_0x3a7896[_0x323457(0x14c)]});console[_0x323457(0x20a)](_0x181088);if(_0x216542[0x0][_0x323457(0x1aa)]==_0x323457(0x1e1)){var _0x101616=users[_0x323457(0x1ac)];console[_0x323457(0x20a)](_0x101616);}else{if(_0x216542[0x0][_0x323457(0x1aa)]==_0x323457(0x199))var _0x101616=users['Hindi'];else{if(_0x216542[0x0][_0x323457(0x1aa)]==_0x323457(0x1c8))var _0x101616=users[_0x323457(0x1c8)];else{if(_0x216542[0x0][_0x323457(0x1aa)]==_0x323457(0x170))var _0x101616=users[_0x323457(0x170)];else{if(_0x216542[0x0][_0x323457(0x1aa)]=='French')var _0x101616=users[_0x323457(0x155)];else{if(_0x216542[0x0][_0x323457(0x1aa)]==_0x323457(0x15f))var _0x101616=users[_0x323457(0x1e9)];else{if(_0x216542[0x0]['language']=='Chinese')var _0x101616=users[_0x323457(0x20e)];else{if(_0x216542[0x0][_0x323457(0x1aa)]==_0x323457(0x1fa))var _0x101616=users[_0x323457(0x197)];}}}}}}}_0x388451['render'](_0x323457(0x1a9),{'success':_0x114f61['flash']('success'),'errors':_0x114f61[_0x323457(0x218)](_0x323457(0x12e)),'role':_0xa105df,'profile':_0x499ea1,'master_shop':_0x216542,'customers':_0x181088,'sales':_0x3a7896,'language':_0x101616});}catch(_0x12d8e6){console[_0x323457(0x20a)](_0x12d8e6);}}),router[a0_0x2f4975(0x1e3)](a0_0x2f4975(0x1c1),auth,async(_0x6fa402,_0x58826d)=>{var _0x3d60a8=a0_0x2f4975;try{const {username:_0x4a1a42,email:_0x377e0c,role:_0x562c4c}=_0x6fa402[_0x3d60a8(0x114)],_0x53dace=_0x6fa402['user'],_0x1162cc=await profile['findOne']({'email':_0x53dace[_0x3d60a8(0x1fc)]}),_0x4a5975=await master_shop[_0x3d60a8(0x1b9)]();console[_0x3d60a8(0x20a)](_0x3d60a8(0x18f),_0x4a5975);const _0x146ab3=_0x6fa402[_0x3d60a8(0x181)]['id'];console[_0x3d60a8(0x20a)](_0x146ab3);const _0x4a1a66=await sales['findById'](_0x146ab3);console[_0x3d60a8(0x20a)](_0x3d60a8(0x149),_0x4a1a66);const _0x2af806=await warehouse[_0x3d60a8(0x141)]([{'$match':{'name':_0x3d60a8(0x180),'room':'Return\x20Rooms'}},{'$unwind':_0x3d60a8(0x142)},{'$group':{'_id':_0x3d60a8(0x14b),'name':{'$first':_0x3d60a8(0x11c)},'product_stock':{'$first':_0x3d60a8(0x140)},'level':{'$first':_0x3d60a8(0x220)},'isle':{'$first':_0x3d60a8(0x1eb)},'pallet':{'$first':_0x3d60a8(0x168)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3d60a8(0x131)},'product_code':{'$first':_0x3d60a8(0x1d4)}}}]);console[_0x3d60a8(0x20a)](_0x3d60a8(0x198),_0x2af806);const _0x362db3=await product[_0x3d60a8(0x1b9)]({});warehouse_data=await warehouse[_0x3d60a8(0x141)]([{'$match':{'status':_0x3d60a8(0x184),'name':_0x3d60a8(0x180),'warehouse_category':_0x3d60a8(0x21d)}},{'$group':{'_id':_0x3d60a8(0x11f),'name':{'$first':_0x3d60a8(0x11f)}}},{'$sort':{'name':0x1}}]);var _0x329bdf=[_0x3d60a8(0x1d1)];if(_0x4a5975[0x0]['language']=='English\x20(US)'){var _0x5d0d4a=users['English'];console[_0x3d60a8(0x20a)](_0x5d0d4a);}else{if(_0x4a5975[0x0][_0x3d60a8(0x1aa)]==_0x3d60a8(0x199))var _0x5d0d4a=users['Hindi'];else{if(_0x4a5975[0x0][_0x3d60a8(0x1aa)]==_0x3d60a8(0x1c8))var _0x5d0d4a=users['German'];else{if(_0x4a5975[0x0][_0x3d60a8(0x1aa)]==_0x3d60a8(0x170))var _0x5d0d4a=users[_0x3d60a8(0x170)];else{if(_0x4a5975[0x0]['language']=='French')var _0x5d0d4a=users[_0x3d60a8(0x155)];else{if(_0x4a5975[0x0][_0x3d60a8(0x1aa)]=='Portuguese\x20(BR)')var _0x5d0d4a=users[_0x3d60a8(0x1e9)];else{if(_0x4a5975[0x0][_0x3d60a8(0x1aa)]==_0x3d60a8(0x20e))var _0x5d0d4a=users[_0x3d60a8(0x20e)];else{if(_0x4a5975[0x0][_0x3d60a8(0x1aa)]==_0x3d60a8(0x1fa))var _0x5d0d4a=users[_0x3d60a8(0x197)];}}}}}}}_0x58826d['render']('return_sale',{'success':_0x6fa402[_0x3d60a8(0x218)](_0x3d60a8(0x1b4)),'errors':_0x6fa402[_0x3d60a8(0x218)](_0x3d60a8(0x12e)),'role':_0x53dace,'profile':_0x1162cc,'user':_0x4a1a66,'stock':_0x2af806,'master_shop':_0x4a5975,'unit':_0x362db3,'language':_0x5d0d4a,'warehouses':warehouse_data,'rooms':_0x329bdf});}catch(_0x2af5a3){console['log'](_0x2af5a3),_0x58826d[_0x3d60a8(0x1ee)](0xc8)['json']({'message':_0x2af5a3[_0x3d60a8(0x135)]});}}),router[a0_0x2f4975(0x21f)](a0_0x2f4975(0x1c1),auth,async(_0x40811a,_0x164a26)=>{var _0x2f9dae=a0_0x2f4975;try{const {invoice:_0x1a2fa2,date:_0x58c901,warehouse_name:_0x36ab7b,product_name:_0x5240fb,primary_code:_0xad3a5f,secondary_code:_0x368ca0,product_code:_0x1d5a26,sales_quantity:_0x5eaaa8,stocks:_0x1a2ca1,return_qty:_0x5b79b7,Room_name:_0x3be2f6,to_warehouse_name:_0xd137aa,to_Roomname:_0x55b1e7,to_Room_name:_0x28d666,note:_0x5145dd,level:_0x348e4e,isle:_0x5f3fc4,pallet:_0x149911}=_0x40811a[_0x2f9dae(0x163)];if(typeof _0x5240fb==_0x2f9dae(0x1d8))var _0x49ef37=[_0x40811a['body']['product_name']],_0x5426c5=[_0x40811a['body'][_0x2f9dae(0x143)]],_0x41ac0f=[_0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x11b)]],_0x2d7470=[_0x40811a[_0x2f9dae(0x163)]['product_code']],_0x213595=[_0x40811a[_0x2f9dae(0x163)]['sales_quantity']],_0x5b12d2=[_0x40811a['body'][_0x2f9dae(0x207)]],_0x41a969=[_0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x133)]],_0x4b3a46=[_0x40811a[_0x2f9dae(0x163)]['bay']],_0x508964=[_0x40811a[_0x2f9dae(0x163)]['bin']],_0x4a55ff=[_0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x137)]],_0x51f13e=[_0x40811a[_0x2f9dae(0x163)]['floorlevel']];else var _0x49ef37=[..._0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x1ec)]],_0x5426c5=[..._0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x143)]],_0x41ac0f=[..._0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x11b)]],_0x2d7470=[..._0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x173)]],_0x213595=[..._0x40811a['body']['sales_quantity']],_0x5b12d2=[..._0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x207)]],_0x41a969=[..._0x40811a['body'][_0x2f9dae(0x133)]],_0x4b3a46=[..._0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x1df)]],_0x508964=[..._0x40811a['body'][_0x2f9dae(0x139)]],_0x4a55ff=[..._0x40811a['body'][_0x2f9dae(0x137)]],_0x51f13e=[..._0x40811a['body'][_0x2f9dae(0x20c)]];const _0x49e724=_0x49ef37[_0x2f9dae(0x186)](_0x2735cc=>{return _0x2735cc={'product_name':_0x2735cc};});_0x5426c5[_0x2f9dae(0x175)]((_0xf22c46,_0x471679)=>{_0x49e724[_0x471679]['primary_code']=_0xf22c46;}),_0x41ac0f['forEach']((_0x185585,_0x5e4679)=>{var _0x3151e6=_0x2f9dae;_0x49e724[_0x5e4679][_0x3151e6(0x11b)]=_0x185585;}),_0x2d7470['forEach']((_0x502edc,_0x1f908b)=>{var _0x42ce3f=_0x2f9dae;_0x49e724[_0x1f908b][_0x42ce3f(0x173)]=_0x502edc;}),_0x213595[_0x2f9dae(0x175)]((_0x403d6a,_0x102793)=>{_0x49e724[_0x102793]['sale_qty']=_0x403d6a;}),_0x5b12d2[_0x2f9dae(0x175)]((_0x52e3dc,_0x3712e9)=>{_0x49e724[_0x3712e9]['stock']=_0x52e3dc;}),_0x41a969[_0x2f9dae(0x175)]((_0xbf35d6,_0x139ee2)=>{var _0x4d94a1=_0x2f9dae;_0x49e724[_0x139ee2][_0x4d94a1(0x133)]=_0xbf35d6;}),_0x4b3a46['forEach']((_0x59705c,_0x32b2be)=>{var _0x1993d6=_0x2f9dae;_0x49e724[_0x32b2be][_0x1993d6(0x1df)]=_0x59705c;}),_0x508964[_0x2f9dae(0x175)]((_0x388b56,_0x2d008b)=>{var _0x11693c=_0x2f9dae;_0x49e724[_0x2d008b][_0x11693c(0x139)]=_0x388b56;}),_0x4a55ff[_0x2f9dae(0x175)]((_0x5c95a7,_0x36bbde)=>{var _0x51f884=_0x2f9dae;_0x49e724[_0x36bbde][_0x51f884(0x1c6)]=_0x5c95a7;}),_0x51f13e[_0x2f9dae(0x175)]((_0x21bfdc,_0x8b2c8a)=>{var _0x133352=_0x2f9dae;_0x49e724[_0x8b2c8a][_0x133352(0x20c)]=_0x21bfdc;});var _0x38359e=0x0;_0x49e724['forEach'](_0x44b03d=>{var _0x21497a=_0x2f9dae;console[_0x21497a(0x20a)]('foreach\x20newproduct',_0x44b03d),(parseInt(_0x44b03d['sale_qty'])<parseInt(_0x44b03d[_0x21497a(0x133)])||parseInt(_0x44b03d['stock'])<parseInt(_0x44b03d[_0x21497a(0x133)])&&parseInt(_0x44b03d[_0x21497a(0x132)])>parseInt(_0x44b03d[_0x21497a(0x133)])||parseInt(_0x44b03d[_0x21497a(0x133)])==0x0)&&_0x38359e++;});if(_0x38359e!=0x0)return _0x40811a['flash'](_0x2f9dae(0x12e),_0x2f9dae(0x177)),_0x164a26[_0x2f9dae(0x17b)](_0x2f9dae(0x12a));const _0x38daef=await sales['findOne']({'invoice':_0x1a2fa2});console[_0x2f9dae(0x20a)](_0x38daef),_0x38daef[_0x2f9dae(0x1db)]=_0x2f9dae(0x13c);const _0x2175b0=await _0x38daef[_0x2f9dae(0x1e5)](),_0x9eaca5=new sales_return({'invoice':_0x1a2fa2,'customer':_0x40811a[_0x2f9dae(0x163)][_0x2f9dae(0x14c)],'date':_0x58c901,'warehouse_name':_0x36ab7b,'room':_0x3be2f6,'ToWarehouse':_0xd137aa,'ToRoom':_0x28d666,'return_sale':_0x49e724,'note':_0x5145dd}),_0x115bf1=await _0x9eaca5[_0x2f9dae(0x1e5)]();console[_0x2f9dae(0x20a)](_0x9eaca5);const _0x5dd66f=await sales_return[_0x2f9dae(0x1f5)]({'invoice':_0x1a2fa2}),_0x395ed4=await warehouse[_0x2f9dae(0x1f5)]({'name':_0xd137aa,'room':_0x28d666});_0x5dd66f[_0x2f9dae(0x172)][_0x2f9dae(0x175)](_0x53e762=>{var _0x3f4859=_0x2f9dae,_0x36b2fd=0x0;const _0x28e39c=_0x395ed4['product_details'][_0x3f4859(0x186)](_0x105e96=>{var _0x5d3450=_0x3f4859;_0x105e96[_0x5d3450(0x1ec)]==_0x53e762[_0x5d3450(0x1ec)]&&_0x105e96[_0x5d3450(0x20c)]==_0x53e762[_0x5d3450(0x20c)]&&_0x105e96[_0x5d3450(0x1c6)]==_0x53e762[_0x5d3450(0x1c6)]&&_0x105e96[_0x5d3450(0x139)]==_0x53e762[_0x5d3450(0x139)]&&_0x105e96[_0x5d3450(0x1df)]==_0x53e762[_0x5d3450(0x1df)]&&(_0x105e96[_0x5d3450(0x1b7)]=parseInt(_0x105e96[_0x5d3450(0x1b7)])+parseInt(_0x53e762[_0x5d3450(0x133)]),_0x36b2fd++);});_0x36b2fd=='0'&&(_0x395ed4[_0x3f4859(0x151)]=_0x395ed4['product_details'][_0x3f4859(0x20f)]({'product_name':_0x53e762['product_name'],'product_stock':_0x53e762[_0x3f4859(0x133)],'primary_code':_0x53e762['primary_code'],'secondary_code':_0x53e762['secondary_code'],'product_code':_0x53e762[_0x3f4859(0x173)],'bay':_0x53e762['bay'],'bin':_0x53e762[_0x3f4859(0x139)],'type':_0x53e762[_0x3f4859(0x1c6)],'floorlevel':_0x53e762[_0x3f4859(0x20c)]})),console[_0x3f4859(0x20a)](_0x3f4859(0x21a),_0x395ed4);}),await _0x395ed4['save'](),console[_0x2f9dae(0x20a)](_0x40811a['body']);const _0x40c7bc=new c_payment_data({'invoice':_0x1a2fa2,'customer':_0x40811a['body'][_0x2f9dae(0x14c)],'reason':_0x2f9dae(0x115)});await _0x40c7bc[_0x2f9dae(0x1e5)]();const _0x448605=await master_shop[_0x2f9dae(0x1b9)]();console[_0x2f9dae(0x20a)]('add\x20post',_0x448605[0x0]['image']);const _0x5607da=await email_settings[_0x2f9dae(0x1f5)](),_0x306e48=await customer[_0x2f9dae(0x1f5)]({'name':_0x40811a[_0x2f9dae(0x163)]['customer']});console[_0x2f9dae(0x20a)](_0x2f9dae(0x15e),_0x306e48);_0x448605[0x0][_0x2f9dae(0x1c3)]==0x1?(right_currency=_0x448605[0x0][_0x2f9dae(0x152)],left_currency=''):(right_currency='',left_currency=_0x448605[0x0][_0x2f9dae(0x152)]);var _0x465517=_0x49ef37,_0x2eacfe=_0x41a969,_0xf1fb83='',_0x7429a;for(_0x7429a in _0x465517){_0xf1fb83+=_0x2f9dae(0x214)+_0x2f9dae(0x13a)+_0x465517[_0x7429a]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2eacfe[_0x7429a]+_0x2f9dae(0x222)+_0x2f9dae(0x130);}console[_0x2f9dae(0x20a)](_0x2f9dae(0x1b3),_0xf1fb83);let _0x4f71f1=nodemailer[_0x2f9dae(0x182)]({'service':_0x2f9dae(0x19a),'auth':{'user':_0x5607da[_0x2f9dae(0x1fc)],'pass':_0x5607da[_0x2f9dae(0x204)]}}),_0x501088={'from':_0x5607da[_0x2f9dae(0x1fc)],'to':_0x306e48[_0x2f9dae(0x1fc)],'subject':_0x2f9dae(0x183),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2f9dae(0x14a)+_0x2f9dae(0x21b)+_0x448605[0x0][_0x2f9dae(0x190)],'cid':_0x2f9dae(0x19f)}],'html':_0x2f9dae(0x1e6)+_0x2f9dae(0x169)+'</head><body>'+_0x2f9dae(0x160)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2f9dae(0x160)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x2f9dae(0x160)+_0x2f9dae(0x1d2)+_0x448605[0x0][_0x2f9dae(0x112)]+_0x2f9dae(0x138)+'</div>'+_0x2f9dae(0x194)+_0x2f9dae(0x150)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2f9dae(0x1c9)+_0x1a2fa2+'\x20'+_0x2f9dae(0x189)+_0x2f9dae(0x1ea)+_0x58c901+'\x20'+_0x2f9dae(0x19b)+'</h5>'+_0x2f9dae(0x194)+_0x2f9dae(0x185)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2f9dae(0x214)+_0x2f9dae(0x15d)+_0x2f9dae(0x1ba)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x2f9dae(0x128)+_0x2f9dae(0x130)+_0x2f9dae(0x1a4)+_0x2f9dae(0x154)+'\x20'+_0xf1fb83+'\x20'+_0x2f9dae(0x1c4)+_0x2f9dae(0x16e)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x2f9dae(0x1ae)+_0x448605[0x0][_0x2f9dae(0x112)]+_0x2f9dae(0x21c)+_0x2f9dae(0x194)+'</div>'+_0x2f9dae(0x111)};_0x4f71f1['sendMail'](_0x501088,function(_0x2d6eef,_0x4325b3){var _0x36f967=_0x2f9dae;_0x2d6eef?(console[_0x36f967(0x20a)](_0x2d6eef),console['log'](_0x36f967(0x1e4))):console['log'](_0x36f967(0x171));}),_0x40811a['flash']('success',_0x2f9dae(0x16f)),_0x164a26['redirect']('/all_sales/view');}catch(_0x488574){console[_0x2f9dae(0x20a)](_0x488574),_0x164a26['status'](0xc8)[_0x2f9dae(0x12c)]({'message1':_0x488574[_0x2f9dae(0x135)]});}}),router[a0_0x2f4975(0x1e3)](a0_0x2f4975(0x1bd),auth,async(_0x2e662c,_0x425ff2)=>{var _0x37657e=a0_0x2f4975;try{const {username:_0x13e3df,email:_0x1fd0c7,role:_0x1194a7}=_0x2e662c[_0x37657e(0x114)],_0x35cf93=_0x2e662c[_0x37657e(0x114)],_0x1d5533=await profile[_0x37657e(0x1f5)]({'email':_0x35cf93[_0x37657e(0x1fc)]}),_0x1f3d83=await master_shop[_0x37657e(0x1b9)]();console['log'](_0x37657e(0x14e),_0x1f3d83);const _0x388806=_0x2e662c[_0x37657e(0x181)]['id'],_0x41ced3=await sales[_0x37657e(0x166)](_0x388806);console[_0x37657e(0x20a)](_0x37657e(0x13d),_0x41ced3);if(_0x1f3d83[0x0][_0x37657e(0x1aa)]=='English\x20(US)')var _0x1a17d8=users[_0x37657e(0x1ac)];else{if(_0x1f3d83[0x0]['language']==_0x37657e(0x199))var _0x1a17d8=users[_0x37657e(0x199)];else{if(_0x1f3d83[0x0]['language']=='German')var _0x1a17d8=users[_0x37657e(0x1c8)];else{if(_0x1f3d83[0x0][_0x37657e(0x1aa)]==_0x37657e(0x170))var _0x1a17d8=users[_0x37657e(0x170)];else{if(_0x1f3d83[0x0]['language']==_0x37657e(0x155))var _0x1a17d8=users[_0x37657e(0x155)];else{if(_0x1f3d83[0x0][_0x37657e(0x1aa)]==_0x37657e(0x15f))var _0x1a17d8=users[_0x37657e(0x1e9)];else{if(_0x1f3d83[0x0][_0x37657e(0x1aa)]==_0x37657e(0x20e))var _0x1a17d8=users['Chinese'];else{if(_0x1f3d83[0x0]['language']==_0x37657e(0x1fa))var _0x1a17d8=users['Arabic'];}}}}}}}_0x425ff2['render'](_0x37657e(0x18c),{'success':_0x2e662c[_0x37657e(0x218)]('success'),'errors':_0x2e662c[_0x37657e(0x218)](_0x37657e(0x12e)),'role':_0x35cf93,'profile':_0x1d5533,'alldata':_0x41ced3,'master_shop':_0x1f3d83,'language':_0x1a17d8});}catch(_0x5544d2){console['log'](_0x5544d2);}}),router[a0_0x2f4975(0x21f)](a0_0x2f4975(0x1c7),async(_0x3612d,_0x266486)=>{var _0x55723b=a0_0x2f4975;const {product_code:_0x4b8275,warehouse_name:_0x4d7c67,rooms_data:_0x35dbe3,Roomslist:_0x257468}=_0x3612d[_0x55723b(0x163)],_0x16c11f=_0x257468[_0x55723b(0x158)](','),_0x40ebdc=[];async function _0x43ca27(_0x4b38de){var _0x8ede36=_0x55723b;const _0x542f9e=await warehouse[_0x8ede36(0x141)]([{'$match':{'name':_0x4d7c67,'room':_0x4b38de}},{'$unwind':_0x8ede36(0x142)},{'$match':{'product_details.primary_code':_0x4b8275}},{'$group':{'_id':_0x8ede36(0x14b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x8ede36(0x1a7)},'secondary_code':{'$first':_0x8ede36(0x131)},'product_code':{'$first':_0x8ede36(0x1d4)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x8ede36(0x187)},'type':{'$first':_0x8ede36(0x1fd)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x8ede36(0x134)},'secondary_unit':{'$first':_0x8ede36(0x14d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x8ede36(0x1d3)},'expiry_date':{'$first':_0x8ede36(0x1ce)},'production_date':{'$first':_0x8ede36(0x1a5)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x8ede36(0x148)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x8ede36(0x1be)},'invoice':{'$first':_0x8ede36(0x19c)},'actual_qty':{'$first':_0x8ede36(0x208)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x5d5ca4=await warehouse[_0x8ede36(0x141)]([{'$match':{'name':_0x4d7c67,'room':_0x4b38de}},{'$unwind':_0x8ede36(0x142)},{'$match':{'product_details.secondary_code':_0x4b8275}},{'$group':{'_id':_0x8ede36(0x14b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x8ede36(0x140)},'primary_code':{'$first':_0x8ede36(0x1a7)},'secondary_code':{'$first':_0x8ede36(0x131)},'product_code':{'$first':_0x8ede36(0x1d4)},'level':{'$first':_0x8ede36(0x129)},'isle':{'$first':_0x8ede36(0x187)},'type':{'$first':_0x8ede36(0x1fd)},'pallet':{'$first':_0x8ede36(0x1a3)},'unit':{'$first':_0x8ede36(0x134)},'secondary_unit':{'$first':_0x8ede36(0x14d)},'storage':{'$first':_0x8ede36(0x15a)},'rack':{'$first':_0x8ede36(0x1d3)},'expiry_date':{'$first':_0x8ede36(0x1ce)},'production_date':{'$first':_0x8ede36(0x1a5)},'maxPerUnit':{'$first':_0x8ede36(0x17c)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x8ede36(0x1be)},'invoice':{'$first':_0x8ede36(0x19c)}}}]);if(_0x542f9e['length']>0x0)_0x40ebdc['push'](_0x542f9e);else _0x5d5ca4[_0x8ede36(0x19d)]>0x0&&_0x40ebdc[_0x8ede36(0x212)](_0x5d5ca4);}const _0x1bf1a0=_0x16c11f[_0x55723b(0x186)](_0x5e4d25=>_0x43ca27(_0x5e4d25));await Promise[_0x55723b(0x1f6)](_0x1bf1a0),_0x266486['json'](_0x40ebdc);}),module['exports']=router;function a0_0x1509(){var _0x3a4647=['/view/:id','max_per_unit','getMonth','</table>','sales\x20item\x20return\x20successfull','Spanish','Email\x20sent\x20successfully','return_sale','product_code','$warehouse_name','forEach','$sale_product.floorlevel','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','room','prod_code','<h5\x20style=\x22text-align:\x20left;\x22>','redirect','$product_details.maxPerUnit','347121GzAxaR','customers','prod_cat','Return\x20Goods','params','createTransport','Sale\x20Return\x20Mail','Enabled','<table\x20style=\x22width:\x20100%\x20!important;\x22>','map','$product_details.bin','$product','<span\x20style=\x22float:\x20right;\x22>','quantity_notConverted','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','all_sales_barcode','/view/add_sales/:id','primary_unit','master','image','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$sale_product.quantity','$sale_product.bay','</div>','An\x20error\x20occurred\x20while\x20saving\x20data.','carton','Arabic','stock_data','Hindi','gmail','</span>','$product_details.invoice','length','product_data','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','isAllowEdit','300842TMfukG','$product_details.floorlevel','</thead>','$product_details.production_date','/all_sales/view','$product_details.primary_code','render','sales_invoice','language','production_date','English','70DfNiqz','<h5>','prod_invoice','../models/all_models','expiry_date','abs','product_list','success','805152sTzdhN','nodemailer','product_stock','invoice','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/barcode/:id','$room','secondary_unit','unit','/view/return_sales/:id','floor','currency_placement','</tbody>','115900zYxMOv','type','/barcode_scanner','German','\x20Order\x20Number\x20:\x20','storage','SCRN','delivery_date','catch','$product_details.expiry_date','sendMail','Sales\x20Update\x20successfully','Return\x20Rooms','<h2>\x20','$product_details.rack','$product_details.product_code','getFullYear','purchases_data','quantity','string','id_transact','actual_qty','return_data','$sale_product','due_amount','foreach\x20newproduct','bay','1082188ymITTw','English\x20(US)','delivery_code','get','Error\x20Occurs','save','<!DOCTYPE\x20html>','$invoice','sales\x20all_data','Portuguese','\x20Order\x20Date\x20:\x20','$product_details.isle','product_name','stock','status','35XsYkzE','Floor','$product.product_name','date','role','received_amount','findOne','all','requested_qty','port','364354OlVBmw','Arabic\x20(ae)','Receiving\x20Area','email','$product_details.type','$return_data','Sales\x20Add\x20successfully','RoomAssigned','then','Ambient','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','password','filter','name','stocks','$product_details.actual_qty','_id','log','$date','floorlevel','room_name','Chinese','concat','finalize','add_sales','push','Logo.png','<tr>','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','note','flash','$sale_product.type','final','/upload/','</h5>','Raw\x20Materials','/view/add_sales','post','$product_details.level','Sales\x20Mail','</td>','</body></html>','site_title','/preview/:id','user','Sale\x20Return','$customer','slice','$_id','/give_payment/:id','../public/language/languages.json','secondary_code','$product_details.product_name','$finalize','$isAllowEdit','$name','OUT-','1719858MltbPV','max','There\x27s\x20a\x20error\x20in\x20this\x20transaction','warehouse','batch_code','amount','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.bay','back','getDate','json','/view/add_sale/product','errors','host','</tr>','$product_details.secondary_code','sale_qty','return_qty','$product_details.unit','message','9waZagV','types','\x20</h2>','bin','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','random','True','barcode\x20user_id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','actual_uom','$product_details.product_stock','aggregate','$product_details','primary_code','maxperunit','False','$note','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.product_cat','user_id','/../public','$product_details._id','customer','$product_details.secondary_unit','barcode\x20Product\x20master','$customers_docs','<hr\x20class=\x22my-3\x22>','product_details','currency','Enclosed','<tbody\x20style=\x22text-align:\x20center;\x22>','French','/all_sales/preview/','An\x20error\x20occurred.','split','payment\x20successfull','$product_details.storage','../middleware/auth','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','customer_data','Portuguese\x20(BR)','<div>','customers_docs','Level','body','level','Shelves','findById','rack','$product_details.pallet','<html><head><title></title>','sale_product'];a0_0x1509=function(){return _0x3a4647;};return a0_0x1509();}