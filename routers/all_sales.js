function a0_0x5492(_0x534fb2,_0x219261){var _0x3eab2f=a0_0x3eab();return a0_0x5492=function(_0x54927b,_0x1c7f8f){_0x54927b=_0x54927b-0xef;var _0x57b50b=_0x3eab2f[_0x54927b];return _0x57b50b;},a0_0x5492(_0x534fb2,_0x219261);}var a0_0x304b9a=a0_0x5492;(function(_0x30f88e,_0x2f3ef5){var _0x31f168=a0_0x5492,_0x4a276b=_0x30f88e();while(!![]){try{var _0x5312d0=parseInt(_0x31f168(0x18e))/0x1*(parseInt(_0x31f168(0x10c))/0x2)+parseInt(_0x31f168(0x110))/0x3+-parseInt(_0x31f168(0x179))/0x4+parseInt(_0x31f168(0x1f5))/0x5+parseInt(_0x31f168(0x1c8))/0x6+-parseInt(_0x31f168(0x128))/0x7*(parseInt(_0x31f168(0x1ad))/0x8)+-parseInt(_0x31f168(0x177))/0x9;if(_0x5312d0===_0x2f3ef5)break;else _0x4a276b['push'](_0x4a276b['shift']());}catch(_0xecff23){_0x4a276b['push'](_0x4a276b['shift']());}}}(a0_0x3eab,0xcf239));const express=require(a0_0x304b9a(0x1a8)),app=express(),router=express[a0_0x304b9a(0x1c5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x304b9a(0x1a9)),auth=require('../middleware/auth'),nodemailer=require(a0_0x304b9a(0x150)),users=require(a0_0x304b9a(0x1b2));router['get']('/view',auth,async(_0x3f0aa6,_0x4520ea)=>{var _0x93da01=a0_0x304b9a;try{const {username:_0x53430a,email:_0x53f445,role:_0x1a41d1}=_0x3f0aa6[_0x93da01(0x19f)],_0x3c01ee=_0x3f0aa6[_0x93da01(0x19f)],_0x470a7b=await profile['findOne']({'email':_0x3c01ee['email']}),_0x5c160c=await master_shop[_0x93da01(0x124)]();let _0xc06e71;if(_0x3c01ee[_0x93da01(0x104)]=='staff'){const _0x366f8d=await staff[_0x93da01(0x11e)]({'email':_0x3c01ee['email']});_0xc06e71=await sales[_0x93da01(0x147)]([{'$lookup':{'from':_0x93da01(0x19b),'localField':_0x93da01(0xfb),'foreignField':_0x93da01(0x1c6),'as':'customers_docs'}},{'$unwind':_0x93da01(0x1e1)},{'$unwind':_0x93da01(0x174)},{'$group':{'_id':'$_id','invoice':{'$first':_0x93da01(0x1f3)},'customers':{'$first':_0x93da01(0x17b)},'date':{'$first':_0x93da01(0x136)},'warehouse_name':{'$first':_0x93da01(0xff)},'sale_product':{'$push':_0x93da01(0x174)},'note':{'$first':_0x93da01(0x13a)},'return_data':{'$first':_0x93da01(0x1c3)},'customers_docs':{'$first':_0x93da01(0x1e1)},'total_saleproduct_quantity':{'$sum':_0x93da01(0x134)},'level':{'$addToSet':_0x93da01(0x162)},'isle':{'$addToSet':_0x93da01(0x10e)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x93da01(0x135)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x93da01(0x116)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xc06e71=await sales[_0x93da01(0x147)]([{'$lookup':{'from':_0x93da01(0x19b),'localField':_0x93da01(0xfb),'foreignField':'name','as':_0x93da01(0x144)}},{'$unwind':'$customers_docs'},{'$unwind':_0x93da01(0x174)},{'$group':{'_id':_0x93da01(0x1b5),'invoice':{'$first':_0x93da01(0x1f3)},'customers':{'$first':_0x93da01(0x17b)},'date':{'$first':_0x93da01(0x136)},'warehouse_name':{'$first':_0x93da01(0xff)},'sale_product':{'$push':_0x93da01(0x174)},'note':{'$first':'$note'},'return_data':{'$first':_0x93da01(0x1c3)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x93da01(0x162)},'isle':{'$addToSet':_0x93da01(0x10e)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x93da01(0x135)},'finalize':{'$first':_0x93da01(0x192)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x93da01(0x143)](_0x93da01(0x153),_0xc06e71);if(_0x5c160c[0x0]['language']==_0x93da01(0x152)){var _0x1dab27=users['English'];console['log'](_0x1dab27);}else{if(_0x5c160c[0x0][_0x93da01(0x15e)]=='Hindi')var _0x1dab27=users[_0x93da01(0x105)];else{if(_0x5c160c[0x0][_0x93da01(0x15e)]==_0x93da01(0x123))var _0x1dab27=users[_0x93da01(0x123)];else{if(_0x5c160c[0x0]['language']==_0x93da01(0x1f7))var _0x1dab27=users[_0x93da01(0x1f7)];else{if(_0x5c160c[0x0][_0x93da01(0x15e)]==_0x93da01(0x14e))var _0x1dab27=users[_0x93da01(0x14e)];else{if(_0x5c160c[0x0][_0x93da01(0x15e)]==_0x93da01(0x187))var _0x1dab27=users[_0x93da01(0x1bd)];else{if(_0x5c160c[0x0][_0x93da01(0x15e)]==_0x93da01(0x160))var _0x1dab27=users[_0x93da01(0x160)];else{if(_0x5c160c[0x0]['language']==_0x93da01(0x1cb))var _0x1dab27=users[_0x93da01(0x1d9)];}}}}}}}_0x4520ea[_0x93da01(0x1bf)](_0x93da01(0x145),{'success':_0x3f0aa6[_0x93da01(0x100)](_0x93da01(0x10f)),'errors':_0x3f0aa6['flash'](_0x93da01(0x1cd)),'sales':_0xc06e71,'profile':_0x470a7b,'role':_0x3c01ee,'master_shop':_0x5c160c,'language':_0x1dab27});}catch(_0xdf3e4e){console[_0x93da01(0x143)](_0xdf3e4e);}});function a0_0x3eab(){var _0x2ad5b1=['delivery_code','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','SCRN','id_transaction_from','get','createTransport','delivery_date','/view/:id','<h5\x20style=\x22text-align:\x20left;\x22>','body','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','payment\x20successfull','$sale_product','</tbody>','level','8679285VcdKxX','An\x20error\x20occurred\x20while\x20saving\x20data.','6725032PQAbJU','add\x20post','$customer','save','<h2>\x20','</span>','sale_qty','sales_quantity','<table\x20style=\x22width:\x20100%\x20!important;\x22>','primary_unit','barcode\x20user_id','host','$product_details.actual_qty','Return\x20Goods','Portuguese\x20(BR)','secondary_code','<hr\x20class=\x22my-3\x22>','<tr>','OUT-','finalize','bay','728509qRGLeE','foreach\x20newproduct','<h5>','$product_details.actual_uom','$finalize','/view/add_sales','edit_sales_view','/barcode_scanner','product_details','/all_sales/view','currency','<html><head><title></title>','port','customers','Floor','RoomAssigned','$product_details.product_code','user','invoice','Level','product','<!DOCTYPE\x20html>','secondary_unit','back','$product_details','There\x27s\x20a\x20error\x20in\x20this\x20transaction','express','../models/all_models','requested_qty','split','warehouse','112QgXZpM','primary_code','Sales\x20Add\x20successfully','redirect','Enabled','../public/language/languages.json','due_amount','json','$_id','customer_data','True','stock','/invoice/:id','</td>','actual_uom','max_per_unit','Portuguese','room_name','render','<strong>\x20Regards\x20</strong>','error','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$return_data','master','Router','name','English','6493068HtaDta','$product_details.product_cat','sale_product','Arabic\x20(ae)','forEach','errors','message','prod_code','random','/all_sales/preview/','$product_details.secondary_code','Enclosed','</tr>','/barcode/:id','carton','image','$product_details.maxPerUnit','Arabic','<span\x20style=\x22float:\x20right;\x22>','</h5>','/view/return_sales/:id','email','id_transact','all','catch','$customers_docs','\x20Order\x20Date\x20:\x20','exports','prod_cat','type','getFullYear','$product_details.batch_code','Return\x20Rooms','types','status','padStart','post','$product_details.production_date','sales_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','production_date','<tbody\x20style=\x22text-align:\x20center;\x22>','$invoice','stock_data','5822245kYDwIy','/view/add_sales/:id','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.rack','staff','actual_qty','$product_details.invoice','product_name','</div>','$product_details.storage','note','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','rack','</table>','Shelves','$product_details.secondary_unit','customer','purchases_data','$product_details.product_name','RMSEmail','$warehouse_name','flash','Sales\x20Update\x20successfully','password','Ambient','role','Hindi','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Error\x20Occurs','abs','Sales\x20Mail','\x20</h2>','return_sale','4XOVkZm','string','$sale_product.bin','success','2533815BWkrdv','isAllowEdit','Sale\x20Return\x20Mail','/upload/','params','\x20Order\x20Number\x20:\x20','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','edit_sales','floorlevel','/../public','</head><body>','quantity_notConverted','getDate','findOne','_id','filter','sales\x20item\x20return\x20successfull','Received\x20Payment\x20For\x20Sale','German','find','site_title','$product_details.bay','$product_details.type','527093uPfMIp','logo','expiry_date','unit','False','map','$product_details.floorlevel','maxperunit','$product_details.isle','/preview/:id','max','slice','$sale_product.quantity','$sale_product.floorlevel','$date','prod_invoice','bin','final','$note','Logo.png','length','amount','received_amount','<div>','user_id','warehouse_name','batch_code','log','customers_docs','all_sales','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','aggregate','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','date','stocks','$product_details.expiry_date','$product_details.primary_code','</body></html>','French','</thead>','nodemailer','Email\x20sent\x20successfully','English\x20(US)','sales\x20all_data','$product_details.product_stock','push','Raw\x20Materials','$product_details._id','add_sales','return_qty','findById','$product_details.unit','/give_payment/:id','then','language','product_stock','Chinese','quantity','$sale_product.bay','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$room'];a0_0x3eab=function(){return _0x2ad5b1;};return a0_0x3eab();}async function getRandom8DigitNumber(){var _0x9fa0bd=a0_0x304b9a;const _0x181f71=0x989680,_0x26133c=0x5f5e0ff,_0x38e15b=Math['floor'](Math[_0x9fa0bd(0x1d0)]()*(_0x26133c-_0x181f71+0x1))+_0x181f71;var _0x2c499d;const _0xe81a5f=await sales[_0x9fa0bd(0x11e)]({'invoice':_0x9fa0bd(0x18b)+_0x38e15b});return _0xe81a5f&&_0xe81a5f[_0x9fa0bd(0x13c)]>0x0?_0x2c499d=_0x9fa0bd(0x18b)+_0x38e15b:_0x2c499d=_0x9fa0bd(0x18b)+_0x38e15b,_0x2c499d;}router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x193),auth,async(_0x1d314d,_0x4c0172)=>{var _0x356110=a0_0x304b9a;try{const {username:_0x1e102b,email:_0x46716d,role:_0x2ecbcc}=_0x1d314d[_0x356110(0x19f)],_0x49fee2=_0x1d314d['user'],_0x157de3=await profile[_0x356110(0x11e)]({'email':_0x49fee2['email']}),_0x30016c=await master_shop[_0x356110(0x124)](),_0x1efa22=await customer['find']({});let _0x120a4e;if(_0x49fee2['role']==_0x356110(0x1fa)){const _0xc27dce=await staff['findOne']({'email':_0x49fee2[_0x356110(0x1dd)]});_0x120a4e=await warehouse['aggregate']([{'$match':{'status':_0x356110(0x1b1),'name':_0xc27dce['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x356110(0x186)}}},{'$group':{'_id':_0x356110(0xf5),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x120a4e=await warehouse['aggregate']([{'$match':{'status':_0x356110(0x1b1),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x356110(0x186)}}},{'$group':{'_id':_0x356110(0xf5),'name':{'$first':_0x356110(0xf5)}}},{'$sort':{'name':0x1}}]);const _0xc95bfd=await product[_0x356110(0x124)]({});var _0x2d2187=[_0x356110(0x103),'Enclosed'];const _0x273832=await sales[_0x356110(0x124)]({}),_0x4afa6e=_0x273832[_0x356110(0x13c)]+0x1,_0x5d7d2f=_0x356110(0x18b)+_0x4afa6e['toString']()[_0x356110(0x1eb)](0x5,'0');if(_0x30016c[0x0][_0x356110(0x15e)]==_0x356110(0x152)){var _0x899ed2=users[_0x356110(0x1c7)];console[_0x356110(0x143)](_0x899ed2);}else{if(_0x30016c[0x0][_0x356110(0x15e)]==_0x356110(0x105))var _0x899ed2=users[_0x356110(0x105)];else{if(_0x30016c[0x0][_0x356110(0x15e)]==_0x356110(0x123))var _0x899ed2=users[_0x356110(0x123)];else{if(_0x30016c[0x0]['language']==_0x356110(0x1f7))var _0x899ed2=users['Spanish'];else{if(_0x30016c[0x0][_0x356110(0x15e)]==_0x356110(0x14e))var _0x899ed2=users[_0x356110(0x14e)];else{if(_0x30016c[0x0][_0x356110(0x15e)]==_0x356110(0x187))var _0x899ed2=users[_0x356110(0x1bd)];else{if(_0x30016c[0x0]['language']==_0x356110(0x160))var _0x899ed2=users[_0x356110(0x160)];else{if(_0x30016c[0x0]['language']==_0x356110(0x1cb))var _0x899ed2=users[_0x356110(0x1d9)];}}}}}}}const _0x2cc41d=getRandom8DigitNumber();_0x2cc41d[_0x356110(0x15d)](_0x3dbd90=>{var _0x1b6516=_0x356110;_0x4c0172['render'](_0x1b6516(0x158),{'success':_0x1d314d['flash'](_0x1b6516(0x10f)),'errors':_0x1d314d[_0x1b6516(0x100)](_0x1b6516(0x1cd)),'role':_0x49fee2,'profile':_0x157de3,'customer':_0x1efa22,'warehouse':_0x120a4e,'product':_0xc95bfd,'invoice':_0x3dbd90,'master_shop':_0x30016c,'language':_0x899ed2,'rooms_data':_0x2d2187});})[_0x356110(0x1e0)](_0x1f2c42=>{var _0x2cf53=_0x356110;_0x1d314d['flash']('errors',_0x2cf53(0x1a7)),_0x4c0172[_0x2cf53(0x1b0)]('/all_sales/view');});}catch(_0x1d0586){console['log'](_0x1d0586);}}),router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x1f6),auth,async(_0x37a88a,_0x2b93df)=>{var _0x539996=a0_0x304b9a;try{const _0x2ae11e=_0x37a88a['params']['id'];console[_0x539996(0x143)](_0x2ae11e);const _0x40532f=await product['find'](),_0x2ab1b4=await purchases[_0x539996(0x147)]([{'$match':{'warehouse_name':_0x2ae11e}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x539996(0xfc),_0x2ab1b4),_0x2b93df[_0x539996(0x1ea)](0xc8)[_0x539996(0x1b4)]({'purchases_data':_0x2ab1b4,'product_data':_0x40532f});}catch(_0x443cec){console[_0x539996(0x143)](_0x443cec);}}),router[a0_0x304b9a(0x1ec)]('/view/add_sale/product',auth,async(_0x1753ab,_0x1df6ef)=>{var _0x18d50a=a0_0x304b9a;try{const {warehouse_data:_0x466a1e,product_data:_0x17f0d1}=_0x1753ab['body'];console[_0x18d50a(0x143)](_0x1753ab[_0x18d50a(0x170)]['product_data']);;const _0x797309=await master_shop[_0x18d50a(0x124)]();console[_0x18d50a(0x143)]('master',_0x797309);const _0x419c19=await product[_0x18d50a(0x11e)]({'name':_0x17f0d1});console[_0x18d50a(0x143)](_0x18d50a(0x1a2),_0x419c19);const _0x23782a=await warehouse[_0x18d50a(0x147)]([{'$match':{'name':_0x466a1e}},{'$unwind':_0x18d50a(0x1a6)},{'$match':{'product_details.product_name':_0x17f0d1}},{'$group':{'_id':_0x18d50a(0xfd),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x18d50a(0x143)](_0x18d50a(0x1f4),_0x23782a),_0x1df6ef[_0x18d50a(0x1ea)](0xc8)['json']({'master':_0x797309,'new_product':_0x419c19,'stock_data':_0x23782a});}catch(_0xe3a433){console[_0x18d50a(0x143)](_0xe3a433);}}),router[a0_0x304b9a(0x1ec)](a0_0x304b9a(0x193),auth,async(_0x24bc59,_0x2e6790)=>{var _0x3278c9=a0_0x304b9a;try{const {invoice:_0x2fc8c3,date:_0x43a407,warehouse_name:_0x13816d,product_name:_0x5deed3,stock:_0x3ed9ab,quantity:_0x47206c,note:_0x16ba13,room:_0x596b28,primary_code:_0xb425f1,secondary_code:_0x1c824b,prod_code:_0x37ac85,level:_0x3fd1d1,isle:_0x33bc83,pallet:_0x56c1ef,batch_code:_0x5187ab,SCRN:_0x582418,expiry_date:_0x226cca}=_0x24bc59[_0x3278c9(0x170)];if(typeof _0x5deed3==_0x3278c9(0x10d))var _0x154771=[_0x24bc59[_0x3278c9(0x170)]['product_name']],_0x3377e6=[_0x24bc59['body'][_0x3278c9(0x1b8)]],_0x4a22d8=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1d6)]],_0x1318c6=[_0x24bc59[_0x3278c9(0x170)]['primary_code']],_0x57ae68=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x188)]],_0x2dbdf3=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1cf)]],_0x395b76=[_0x24bc59['body'][_0x3278c9(0x176)]],_0x5ef96f=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x182)]],_0x7be1f=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1a4)]],_0x44bca7=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x142)]],_0x42e98e=[_0x24bc59['body'][_0x3278c9(0x12a)]],_0x560084=[_0x24bc59['body'][_0x3278c9(0x1bc)]],_0x35cf67=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1f1)]],_0x1f9dbc=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1aa)]],_0x35febc=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x16d)]],_0x22743d=[_0x24bc59['body'][_0x3278c9(0x166)]],_0x595ca8=[_0x24bc59['body'][_0x3278c9(0x1e4)]],_0x54eae1=[_0x24bc59[_0x3278c9(0x170)]['quantity']],_0x2fd5d6=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x19d)]],_0x2200e6=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x137)]],_0x4149eb=[_0x24bc59[_0x3278c9(0x170)][_0x3278c9(0xef)]],_0x11cfc6=[_0x24bc59['body'][_0x3278c9(0x1bb)]],_0x358364=[_0x24bc59['body'][_0x3278c9(0x1de)]];else var _0x154771=[..._0x24bc59['body'][_0x3278c9(0xf1)]],_0x3377e6=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1b8)]],_0x4a22d8=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1d6)]],_0x1318c6=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1ae)]],_0x57ae68=[..._0x24bc59['body'][_0x3278c9(0x188)]],_0x2dbdf3=[..._0x24bc59['body'][_0x3278c9(0x1cf)]],_0x395b76=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x176)]],_0x5ef96f=[..._0x24bc59[_0x3278c9(0x170)]['primary_unit']],_0x7be1f=[..._0x24bc59[_0x3278c9(0x170)]['secondary_unit']],_0x44bca7=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x142)]],_0x42e98e=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x12a)]],_0x560084=[..._0x24bc59[_0x3278c9(0x170)]['max_per_unit']],_0x35cf67=[..._0x24bc59['body'][_0x3278c9(0x1f1)]],_0x1f9dbc=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1aa)]],_0x35febc=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x16d)]],_0x22743d=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x166)]],_0x595ca8=[..._0x24bc59['body'][_0x3278c9(0x1e4)]],_0x54eae1=[..._0x24bc59[_0x3278c9(0x170)]['quantity']],_0x2fd5d6=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x19d)]],_0x2200e6=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x137)]],_0x4149eb=[..._0x24bc59['body']['actual_qty']],_0x11cfc6=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1bb)]],_0x358364=[..._0x24bc59[_0x3278c9(0x170)][_0x3278c9(0x1de)]];const _0x3f5550=_0x154771['map'](_0x3011ab=>{return _0x3011ab={'product_name':_0x3011ab};});_0x3377e6[_0x3278c9(0x1cc)]((_0x47e3a7,_0x492e30)=>{var _0x297ba4=_0x3278c9;_0x3f5550[_0x492e30]['stock']=Math[_0x297ba4(0x108)](_0x47e3a7);}),_0x4149eb['forEach']((_0x390219,_0x4c16bf)=>{var _0xf7ac65=_0x3278c9;_0x3f5550[_0x4c16bf][_0xf7ac65(0xef)]=Math['abs'](_0x390219);}),_0x11cfc6[_0x3278c9(0x1cc)]((_0x5eb5be,_0x2e4550)=>{var _0x410fe9=_0x3278c9;_0x3f5550[_0x2e4550][_0x410fe9(0x1bb)]=_0x5eb5be;}),_0x358364['forEach']((_0x1a9ce0,_0x1471f3)=>{var _0x20a437=_0x3278c9;_0x3f5550[_0x1471f3][_0x20a437(0x16a)]=_0x1a9ce0;}),_0x4a22d8[_0x3278c9(0x1cc)]((_0x3009d8,_0x466ec1)=>{_0x3f5550[_0x466ec1]['quantity']=_0x3009d8;}),_0x1318c6['forEach']((_0x441c4a,_0x247eb2)=>{var _0x564441=_0x3278c9;_0x3f5550[_0x247eb2][_0x564441(0x1ae)]=_0x441c4a;}),_0x57ae68['forEach']((_0x53ad49,_0x41f51d)=>{var _0x5d88f3=_0x3278c9;_0x3f5550[_0x41f51d][_0x5d88f3(0x188)]=_0x53ad49;}),_0x2dbdf3[_0x3278c9(0x1cc)]((_0x1bfdb1,_0x8d9bb1)=>{_0x3f5550[_0x8d9bb1]['product_code']=_0x1bfdb1;}),_0x395b76[_0x3278c9(0x1cc)]((_0x361d4d,_0xdcafcc)=>{var _0x486dde=_0x3278c9;_0x2fd5d6[_0x486dde(0x1cc)]((_0x4c19db,_0x4d4432)=>{var _0x1e46ac=_0x486dde;if(_0x4c19db=='Receiving\x20Area'&&_0xdcafcc==_0x4d4432){var _0x8596f=_0x361d4d[_0x1e46ac(0x133)](0x3);_0x3f5550[_0xdcafcc][_0x1e46ac(0x163)]=_0x361d4d[0x0],_0x3f5550[_0xdcafcc]['rack']=_0x361d4d[0x1],_0x3f5550[_0xdcafcc][_0x1e46ac(0x18d)]=0x0,_0x3f5550[_0xdcafcc][_0x1e46ac(0x138)]=0x0,_0x3f5550[_0xdcafcc][_0x1e46ac(0x1e5)]=_0x1e46ac(0x19c),_0x3f5550[_0xdcafcc][_0x1e46ac(0x119)]=_0x8596f;}else{if(_0x4c19db==_0x1e46ac(0xf9)&&_0xdcafcc==_0x4d4432){var _0x8596f=_0x361d4d['slice'](0x3);_0x3f5550[_0xdcafcc]['storage']=_0x361d4d[0x0],_0x3f5550[_0xdcafcc][_0x1e46ac(0xf7)]=_0x361d4d[0x1],_0x3f5550[_0xdcafcc][_0x1e46ac(0x18d)]=0x0,_0x3f5550[_0xdcafcc][_0x1e46ac(0x138)]=0x0,_0x3f5550[_0xdcafcc][_0x1e46ac(0x1e5)]=_0x1e46ac(0x19c),_0x3f5550[_0xdcafcc]['floorlevel']=_0x361d4d[0x5];}else{if(_0xdcafcc==_0x4d4432){var _0x39f524;if(_0x361d4d[0x4]=='L')_0x39f524=_0x1e46ac(0x1a1);else _0x361d4d[0x4]=='F'&&(_0x39f524='Floor');_0x3f5550[_0xdcafcc]['storage']=_0x361d4d[0x0],_0x3f5550[_0xdcafcc][_0x1e46ac(0xf7)]=_0x361d4d[0x1],_0x3f5550[_0xdcafcc][_0x1e46ac(0x18d)]=_0x361d4d[0x2],_0x3f5550[_0xdcafcc][_0x1e46ac(0x138)]=_0x361d4d[0x3],_0x3f5550[_0xdcafcc][_0x1e46ac(0x1e5)]=_0x39f524,_0x3f5550[_0xdcafcc][_0x1e46ac(0x119)]=_0x361d4d[0x5];}}}});}),_0x5ef96f['forEach']((_0x14f32c,_0x555124)=>{var _0x21f4e0=_0x3278c9;_0x3f5550[_0x555124][_0x21f4e0(0x12b)]=_0x14f32c;}),_0x7be1f[_0x3278c9(0x1cc)]((_0x166a88,_0x5963cf)=>{_0x3f5550[_0x5963cf]['secondary_unit']=_0x166a88;}),_0x44bca7[_0x3278c9(0x1cc)]((_0x25698d,_0x5d7105)=>{var _0xe59002=_0x3278c9;_0x3f5550[_0x5d7105][_0xe59002(0x142)]=_0x25698d;}),_0x42e98e[_0x3278c9(0x1cc)]((_0x195f37,_0x2a33b9)=>{var _0x901c7a=_0x3278c9;_0x3f5550[_0x2a33b9][_0x901c7a(0x12a)]=_0x195f37;}),_0x560084[_0x3278c9(0x1cc)]((_0x2c9397,_0x4f2ab1)=>{var _0x5e07ce=_0x3278c9;_0x3f5550[_0x4f2ab1][_0x5e07ce(0x12f)]=_0x2c9397;}),_0x35cf67[_0x3278c9(0x1cc)]((_0x2b2632,_0xb43755)=>{var _0x2d8ab2=_0x3278c9;_0x3f5550[_0xb43755][_0x2d8ab2(0x1f1)]=_0x2b2632;}),_0x1f9dbc[_0x3278c9(0x1cc)]((_0x1b4326,_0x7c5753)=>{var _0x3ba9ba=_0x3278c9;_0x3f5550[_0x7c5753][_0x3ba9ba(0x1aa)]=_0x1b4326;}),_0x35febc[_0x3278c9(0x1cc)]((_0x2f810b,_0x422953)=>{var _0x4aad6e=_0x3278c9;_0x3f5550[_0x422953][_0x4aad6e(0x16d)]=_0x2f810b;}),_0x22743d[_0x3278c9(0x1cc)]((_0x2ae384,_0x4520cb)=>{var _0xfc7893=_0x3278c9;_0x3f5550[_0x4520cb][_0xfc7893(0x166)]=_0x2ae384;}),_0x595ca8[_0x3278c9(0x1cc)]((_0x515018,_0x1ef5c7)=>{var _0x26026b=_0x3278c9;_0x3f5550[_0x1ef5c7][_0x26026b(0x1e4)]=_0x515018;}),_0x54eae1[_0x3278c9(0x1cc)]((_0x336174,_0x52df59)=>{var _0x578ac6=_0x3278c9;_0x3f5550[_0x52df59][_0x578ac6(0x11c)]=_0x336174;}),_0x2fd5d6[_0x3278c9(0x1cc)]((_0x36c3fa,_0x10a561)=>{var _0x14d46a=_0x3278c9;_0x3f5550[_0x10a561][_0x14d46a(0x1be)]=_0x36c3fa;}),_0x2200e6['forEach']((_0x1790fe,_0x3f16d1)=>{var _0x384060=_0x3278c9;_0x3f5550[_0x3f16d1][_0x384060(0x1a0)]=_0x1790fe;});var _0x157c56=0x0;_0x3f5550['forEach'](_0x51b489=>{var _0x5915d1=_0x3278c9;(_0x51b489[_0x5915d1(0x1b8)]<_0x51b489[_0x5915d1(0x11c)]||_0x51b489[_0x5915d1(0x11c)]==0x0)&&(console['log'](_0x5915d1(0x18f),_0x51b489),_0x157c56++);});const _0x3db541=_0x3f5550[_0x3278c9(0x120)](_0x560858=>_0x560858[_0x3278c9(0x161)]!=='0'&&_0x560858[_0x3278c9(0x161)]!==''),_0x5becec=new sales({'invoice':_0x2fc8c3,'customer':_0x24bc59[_0x3278c9(0x170)]['customer'],'date':_0x43a407,'warehouse_name':_0x13816d,'sale_product':_0x3db541,'note':_0x16ba13,'room':_0x596b28,'primary_code':_0xb425f1,'secondary_code':_0x1c824b,'prod_code':_0x37ac85,'SCRN':_0x582418}),_0xc85d01=await _0x5becec[_0x3278c9(0x17c)]();_0x24bc59['flash'](_0x3278c9(0x10f),_0x3278c9(0x1af)),_0x2e6790[_0x3278c9(0x1b0)](_0x3278c9(0x1d1)+_0xc85d01['_id']);}catch(_0x4a9d6d){console[_0x3278c9(0x143)](_0x4a9d6d);}}),router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x131),auth,async(_0x48ac0d,_0x1862f7)=>{var _0x4e15d9=a0_0x304b9a;try{const {username:_0x2b9dec,email:_0x309f3d,role:_0x37e2fc}=_0x48ac0d[_0x4e15d9(0x19f)],_0x245365=_0x48ac0d[_0x4e15d9(0x19f)],_0x5a4734=await profile['findOne']({'email':_0x245365[_0x4e15d9(0x1dd)]}),_0x5f2ff7=await master_shop[_0x4e15d9(0x124)](),_0x18fe5c=_0x48ac0d['params']['id'],_0x2df4a1=await sales['findById'](_0x18fe5c),_0x5094d7=await warehouse['aggregate']([{'$match':{'name':_0x2df4a1[_0x4e15d9(0x141)]}},{'$unwind':_0x4e15d9(0x1a6)},{'$group':{'_id':_0x4e15d9(0x157),'name':{'$first':_0x4e15d9(0xfd)},'product_stock':{'$first':_0x4e15d9(0x154)},'bay':{'$first':_0x4e15d9(0x126)},'bin':{'$first':_0x4e15d9(0x167)},'type':{'$first':_0x4e15d9(0x127)},'floorlevel':{'$first':_0x4e15d9(0x12e)},'primary_code':{'$first':_0x4e15d9(0x14c)},'secondary_code':{'$first':_0x4e15d9(0x1d2)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4e15d9(0x1f9)},'expiry_date':{'$first':_0x4e15d9(0x14b)},'production_date':{'$first':_0x4e15d9(0x1ed)},'invoice':{'$first':_0x4e15d9(0xf0)}}}]),_0x30b3d2=await customer[_0x4e15d9(0x124)]({});let _0x18b62;if(_0x245365[_0x4e15d9(0x104)]=='staff'){const _0xe4ee76=await staff[_0x4e15d9(0x11e)]({'email':_0x245365[_0x4e15d9(0x1dd)]});_0x18b62=await warehouse[_0x4e15d9(0x147)]([{'$match':{'status':_0x4e15d9(0x1b1),'name':_0xe4ee76[_0x4e15d9(0x1ac)]}},{'$group':{'_id':_0x4e15d9(0xf5),'name':{'$first':'$name'}}}]);}else _0x18b62=await warehouse['aggregate']([{'$match':{'status':_0x4e15d9(0x1b1)}},{'$group':{'_id':'$name','name':{'$first':_0x4e15d9(0xf5)}}}]);const _0x4623b3=await product['find']({}),_0x4def67=await suppliers[_0x4e15d9(0x124)]({});if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]==_0x4e15d9(0x152)){var _0x2b4ce0=users[_0x4e15d9(0x1c7)];console['log'](_0x2b4ce0);}else{if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]==_0x4e15d9(0x105))var _0x2b4ce0=users[_0x4e15d9(0x105)];else{if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]==_0x4e15d9(0x123))var _0x2b4ce0=users[_0x4e15d9(0x123)];else{if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]=='Spanish')var _0x2b4ce0=users[_0x4e15d9(0x1f7)];else{if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]==_0x4e15d9(0x14e))var _0x2b4ce0=users[_0x4e15d9(0x14e)];else{if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]==_0x4e15d9(0x187))var _0x2b4ce0=users['Portuguese'];else{if(_0x5f2ff7[0x0]['language']=='Chinese')var _0x2b4ce0=users[_0x4e15d9(0x160)];else{if(_0x5f2ff7[0x0][_0x4e15d9(0x15e)]=='Arabic\x20(ae)')var _0x2b4ce0=users[_0x4e15d9(0x1d9)];}}}}}}}_0x1862f7['render'](_0x4e15d9(0x194),{'success':_0x48ac0d[_0x4e15d9(0x100)]('success'),'errors':_0x48ac0d[_0x4e15d9(0x100)](_0x4e15d9(0x1cd)),'role':_0x245365,'profile':_0x5a4734,'customer':_0x30b3d2,'warehouse':_0x18b62,'product':_0x5094d7,'user':_0x2df4a1,'master_shop':_0x5f2ff7,'unit':_0x4623b3,'language':_0x2b4ce0,'suppliers':_0x4def67});}catch(_0x270a53){console['log'](_0x270a53);}}),router[a0_0x304b9a(0x1ec)](a0_0x304b9a(0x131),auth,async(_0x30bfb4,_0x44c82e)=>{var _0x4795fa=a0_0x304b9a;try{const _0x354538=_0x30bfb4[_0x4795fa(0x114)]['id'],{invoice:_0x2cd84d,warehouse_name:_0x9d4c19,room:_0x521c09}=_0x30bfb4[_0x4795fa(0x170)],_0x3653cf=await sales[_0x4795fa(0x11e)]({'invoice':_0x2cd84d}),_0x5ef011=_0x3653cf['sale_product'][_0x4795fa(0x12d)](async _0x4a8ea0=>{var _0x1dbbba=_0x4795fa,_0x5949e2=await warehouse[_0x1dbbba(0x11e)]({'name':_0x9d4c19,'room':_0x4a8ea0[_0x1dbbba(0x1be)],'warehouse_category':'Raw\x20Materials'});const _0x33865e=_0x5949e2[_0x1dbbba(0x196)]['map'](_0x568022=>{var _0x66f8f8=_0x1dbbba;_0x568022[_0x66f8f8(0xf1)]==_0x4a8ea0[_0x66f8f8(0xf1)]&&_0x568022[_0x66f8f8(0x119)]==_0x4a8ea0[_0x66f8f8(0x119)]&&_0x568022[_0x66f8f8(0x1e5)]==_0x4a8ea0[_0x66f8f8(0x1e5)]&&_0x568022['bin']==_0x4a8ea0[_0x66f8f8(0x138)]&&_0x568022[_0x66f8f8(0x18d)]==_0x4a8ea0[_0x66f8f8(0x18d)]&&_0x568022[_0x66f8f8(0xf7)]==_0x4a8ea0[_0x66f8f8(0xf7)]&&_0x568022['storage']==_0x4a8ea0[_0x66f8f8(0x163)]&&_0x568022[_0x66f8f8(0x12a)]==_0x4a8ea0[_0x66f8f8(0x12a)]&&_0x568022['batch_code']==_0x4a8ea0[_0x66f8f8(0x142)]&&_0x568022['invoice']==_0x4a8ea0[_0x66f8f8(0x1a0)]&&_0x568022[_0x66f8f8(0x11f)]==_0x4a8ea0['id_transaction_from']&&(_0x568022[_0x66f8f8(0x15f)]=Math[_0x66f8f8(0x132)](0x0,Math['abs'](_0x568022[_0x66f8f8(0x15f)])-Math[_0x66f8f8(0x108)](_0x4a8ea0[_0x66f8f8(0x161)])));});return _0x5949e2;});Promise[_0x4795fa(0x1df)](_0x5ef011)[_0x4795fa(0x15d)](async _0x418aea=>{var _0x10aca3=_0x4795fa;try{for(const _0x44286e of _0x418aea){await _0x44286e[_0x10aca3(0x17c)]();}_0x3653cf[_0x10aca3(0x18c)]=_0x10aca3(0x1b7);const _0x584a3c=await _0x3653cf[_0x10aca3(0x17c)](),_0x1b9954=await master_shop[_0x10aca3(0x124)](),_0x123c66=await email_settings['findOne'](),_0x46f0c5=await supervisor_settings[_0x10aca3(0x124)]();var _0x42af82=_0x3653cf[_0x10aca3(0x1ca)],_0x3efca3='',_0x13df03;for(_0x13df03 in _0x42af82){_0x3efca3+=_0x10aca3(0x18a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x42af82[_0x13df03][_0x10aca3(0xf1)]+_0x10aca3(0x1ba)+_0x10aca3(0x148)+_0x42af82[_0x13df03][_0x10aca3(0x171)]+_0x10aca3(0x1ba)+_0x10aca3(0x148)+_0x42af82[_0x13df03][_0x10aca3(0x161)]+_0x10aca3(0x1ba)+_0x10aca3(0x148)+_0x42af82[_0x13df03][_0x10aca3(0x12b)]+_0x10aca3(0x1ba)+_0x10aca3(0x148)+_0x42af82[_0x13df03][_0x10aca3(0x1a4)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3653cf[_0x10aca3(0x141)]+_0x10aca3(0x1ba)+_0x10aca3(0x148)+_0x42af82[_0x13df03][_0x10aca3(0x1be)]+_0x10aca3(0x1ba)+_0x10aca3(0x148)+_0x42af82[_0x13df03][_0x10aca3(0x163)]+_0x42af82[_0x13df03][_0x10aca3(0xf7)]+_0x42af82[_0x13df03][_0x10aca3(0x18d)]+_0x42af82[_0x13df03][_0x10aca3(0x138)]+_0x42af82[_0x13df03][_0x10aca3(0x1e5)][0x0]+_0x42af82[_0x13df03]['floorlevel']+_0x10aca3(0x1ba),_0x10aca3(0x1d4);}let _0x549139=nodemailer[_0x10aca3(0x16c)]({'host':_0x123c66[_0x10aca3(0x184)],'port':Number(_0x123c66[_0x10aca3(0x19a)]),'secure':![],'auth':{'user':_0x123c66[_0x10aca3(0x1dd)],'pass':_0x123c66[_0x10aca3(0x102)]}}),_0x160237={'from':_0x123c66['email'],'to':_0x46f0c5[0x0][_0x10aca3(0xfe)],'subject':_0x10aca3(0x109),'attachments':[{'filename':'Logo.png','path':__dirname+_0x10aca3(0x11a)+_0x10aca3(0x113)+_0x1b9954[0x0]['image'],'cid':_0x10aca3(0x129)}],'html':_0x10aca3(0x1a3)+_0x10aca3(0x199)+_0x10aca3(0x11b)+_0x10aca3(0x13f)+_0x10aca3(0x106)+_0x10aca3(0x13f)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x10aca3(0xf2)+_0x10aca3(0x13f)+_0x10aca3(0x17d)+_0x1b9954[0x0][_0x10aca3(0x125)]+'\x20</h2>'+'</div>'+'</div>'+_0x10aca3(0x189)+_0x10aca3(0x13f)+_0x10aca3(0x16f)+_0x10aca3(0x115)+_0x3653cf[_0x10aca3(0x1a0)]+'\x20'+_0x10aca3(0x1da)+_0x10aca3(0x1e2)+_0x3653cf[_0x10aca3(0x149)]+'\x20'+_0x10aca3(0x17e)+_0x10aca3(0x1db)+'</div>'+_0x10aca3(0x181)+_0x10aca3(0x1f0)+_0x10aca3(0x18a)+_0x10aca3(0x1ef)+_0x10aca3(0x172)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x10aca3(0xf6)+_0x10aca3(0x1f8)+_0x10aca3(0x164)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x10aca3(0x1d4)+_0x10aca3(0x14f)+_0x10aca3(0x1f2)+'\x20'+_0x3efca3+'\x20'+_0x10aca3(0x175)+_0x10aca3(0xf8)+'<div>'+_0x10aca3(0x1c0)+_0x10aca3(0x190)+_0x1b9954[0x0][_0x10aca3(0x125)]+_0x10aca3(0x1db)+'</div>'+'</div>'+_0x10aca3(0x14d)};_0x549139['sendMail'](_0x160237,function(_0x27bcb1,_0xaef5e4){var _0x2c0bbe=_0x10aca3;_0x27bcb1?(console[_0x2c0bbe(0x143)](_0x27bcb1),console[_0x2c0bbe(0x143)](_0x2c0bbe(0x107))):console[_0x2c0bbe(0x143)](_0x2c0bbe(0x151));}),_0x30bfb4[_0x10aca3(0x100)](_0x10aca3(0x10f),'Sales\x20Update\x20successfully'),_0x44c82e[_0x10aca3(0x1b0)](_0x10aca3(0x1d1)+_0x354538);}catch(_0x37717a){console[_0x10aca3(0x1c1)](_0x37717a),_0x44c82e[_0x10aca3(0x1ea)](0x1f4)[_0x10aca3(0x1b4)]({'error':_0x10aca3(0x178)});}})[_0x4795fa(0x1e0)](_0x4c86bd=>{var _0x5bfeda=_0x4795fa;console[_0x5bfeda(0x1c1)](_0x4c86bd),_0x44c82e[_0x5bfeda(0x1ea)](0x1f4)[_0x5bfeda(0x1b4)]({'error':'An\x20error\x20occurred.'});});}catch(_0x333a16){console[_0x4795fa(0x143)](_0x333a16);}}),router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x16e),auth,async(_0x1a24da,_0x229fbb)=>{var _0x400c89=a0_0x304b9a;try{const {username:_0x48afde,email:_0x58976a,role:_0x426973}=_0x1a24da[_0x400c89(0x19f)],_0x13dc05=_0x1a24da[_0x400c89(0x19f)],_0x4fda3c=await profile[_0x400c89(0x11e)]({'email':_0x13dc05[_0x400c89(0x1dd)]}),_0x34133a=await master_shop[_0x400c89(0x124)](),_0x5b473a=_0x1a24da[_0x400c89(0x114)]['id'],_0x486ec2=await sales['findById'](_0x5b473a);var _0x38f196=['Ambient',_0x400c89(0x1d3)];const _0x470c62=await warehouse[_0x400c89(0x147)]([{'$match':{'name':_0x486ec2['warehouse_name'],'warehouse_category':_0x400c89(0x156)}},{'$unwind':_0x400c89(0x1a6)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x400c89(0x126)},'bin':{'$first':_0x400c89(0x167)},'type':{'$first':_0x400c89(0x127)},'floorlevel':{'$first':_0x400c89(0x12e)},'primary_code':{'$first':_0x400c89(0x14c)},'secondary_code':{'$first':_0x400c89(0x1d2)},'product_code':{'$first':_0x400c89(0x19e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x400c89(0x1f9)}}}]),_0x45eb7c=await customer[_0x400c89(0x124)]({});let _0x3543b2;if(_0x13dc05[_0x400c89(0x104)]=='staff'){const _0x4db3e0=await staff[_0x400c89(0x11e)]({'email':_0x13dc05['email']});_0x3543b2=await warehouse[_0x400c89(0x147)]([{'$match':{'status':'Enabled','name':_0x4db3e0[_0x400c89(0x1ac)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x400c89(0xf5),'name':{'$first':'$name'}}}]);}else _0x3543b2=await warehouse[_0x400c89(0x147)]([{'$match':{'status':_0x400c89(0x1b1),'warehouse_category':_0x400c89(0x156)}},{'$group':{'_id':'$name','name':{'$first':_0x400c89(0xf5)}}}]);const _0x113f24=await product[_0x400c89(0x124)]({});if(_0x34133a[0x0][_0x400c89(0x15e)]==_0x400c89(0x152)){var _0x1745f1=users['English'];console[_0x400c89(0x143)](_0x1745f1);}else{if(_0x34133a[0x0][_0x400c89(0x15e)]==_0x400c89(0x105))var _0x1745f1=users[_0x400c89(0x105)];else{if(_0x34133a[0x0][_0x400c89(0x15e)]=='German')var _0x1745f1=users[_0x400c89(0x123)];else{if(_0x34133a[0x0][_0x400c89(0x15e)]=='Spanish')var _0x1745f1=users[_0x400c89(0x1f7)];else{if(_0x34133a[0x0][_0x400c89(0x15e)]=='French')var _0x1745f1=users['French'];else{if(_0x34133a[0x0][_0x400c89(0x15e)]==_0x400c89(0x187))var _0x1745f1=users[_0x400c89(0x1bd)];else{if(_0x34133a[0x0][_0x400c89(0x15e)]==_0x400c89(0x160))var _0x1745f1=users[_0x400c89(0x160)];else{if(_0x34133a[0x0][_0x400c89(0x15e)]==_0x400c89(0x1cb))var _0x1745f1=users[_0x400c89(0x1d9)];}}}}}}}_0x229fbb['render'](_0x400c89(0x118),{'success':_0x1a24da[_0x400c89(0x100)]('success'),'errors':_0x1a24da[_0x400c89(0x100)](_0x400c89(0x1cd)),'role':_0x13dc05,'profile':_0x4fda3c,'customer':_0x45eb7c,'warehouse':_0x3543b2,'product':_0x470c62,'user':_0x486ec2,'master_shop':_0x34133a,'unit':_0x113f24,'language':_0x1745f1});}catch(_0x25835e){console[_0x400c89(0x143)](_0x25835e);}}),router[a0_0x304b9a(0x1ec)](a0_0x304b9a(0x16e),auth,async(_0x30f812,_0x1b1162)=>{var _0x324e73=a0_0x304b9a;try{const _0x2ae5c6=_0x30f812[_0x324e73(0x114)]['id'],_0x4e1d83=await sales[_0x324e73(0x11e)]({'_id':_0x30f812['params']['id']}),_0x53b03e=await warehouse[_0x324e73(0x11e)]({'name':_0x4e1d83[_0x324e73(0x141)],'room':_0x30f812['body']['room']}),{invoice:_0x231a7b,date:_0x5e6d43,warehouse_name:_0x2de0f7,product_name:_0x5526b0,stock:_0x5d2f01,quantity:_0x5373ae,note:_0x2c16d6,room:_0x145c1e,customer:_0x1b9e96,SCRN:_0x160c41}=_0x30f812['body'];if(typeof _0x5526b0==_0x324e73(0x10d))var _0x1f6b2c=[_0x30f812[_0x324e73(0x170)]['product_name']],_0x2353fe=[_0x30f812['body'][_0x324e73(0x1b8)]],_0x4072fd=[_0x30f812[_0x324e73(0x170)]['carton']],_0x5d3bf9=[_0x30f812['body'][_0x324e73(0x1ae)]],_0x10ac4e=[_0x30f812[_0x324e73(0x170)]['secondary_code']],_0x311408=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x1cf)]],_0x359b23=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x176)]],_0x369476=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x182)]],_0x177d60=[_0x30f812[_0x324e73(0x170)]['secondary_unit']],_0x527d99=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x142)]],_0x12bd59=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x12a)]],_0x8e14a8=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x1bc)]],_0x525890=[_0x30f812['body']['production_date']],_0xcc378=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x1aa)]],_0x2d9fb7=[_0x30f812[_0x324e73(0x170)][_0x324e73(0x16d)]],_0x344e7c=[_0x30f812[_0x324e73(0x170)]['delivery_code']],_0x3020bd=[_0x30f812['body'][_0x324e73(0x1e4)]],_0x51ea55=[_0x30f812[_0x324e73(0x170)]['quantity']],_0x26f790=[_0x30f812[_0x324e73(0x170)]['RoomAssigned']];else var _0x1f6b2c=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0xf1)]],_0x2353fe=[..._0x30f812[_0x324e73(0x170)]['stock']],_0x4072fd=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x1d6)]],_0x5d3bf9=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x1ae)]],_0x10ac4e=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x188)]],_0x311408=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x1cf)]],_0x359b23=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x176)]],_0x369476=[..._0x30f812['body'][_0x324e73(0x182)]],_0x177d60=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x1a4)]],_0x527d99=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x142)]],_0x12bd59=[..._0x30f812[_0x324e73(0x170)]['expiry_date']],_0x8e14a8=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x1bc)]],_0x525890=[..._0x30f812['body'][_0x324e73(0x1f1)]],_0xcc378=[..._0x30f812['body'][_0x324e73(0x1aa)]],_0x2d9fb7=[..._0x30f812['body'][_0x324e73(0x16d)]],_0x344e7c=[..._0x30f812[_0x324e73(0x170)][_0x324e73(0x166)]],_0x3020bd=[..._0x30f812['body'][_0x324e73(0x1e4)]],_0x51ea55=[..._0x30f812['body'][_0x324e73(0x161)]],_0x26f790=[..._0x30f812['body']['RoomAssigned']];const _0x1d7ca3=_0x1f6b2c['map'](_0x511fbc=>{return _0x511fbc={'product_name':_0x511fbc};});_0x2353fe[_0x324e73(0x1cc)]((_0x3c4e48,_0x2d5d65)=>{var _0x52ce80=_0x324e73;_0x1d7ca3[_0x2d5d65][_0x52ce80(0x1b8)]=Math['abs'](_0x3c4e48);}),_0x4072fd[_0x324e73(0x1cc)]((_0x2e7e06,_0xe4a748)=>{var _0x2573f3=_0x324e73;_0x1d7ca3[_0xe4a748][_0x2573f3(0x161)]=_0x2e7e06;}),_0x5d3bf9[_0x324e73(0x1cc)]((_0x53cb58,_0x1f2da8)=>{_0x1d7ca3[_0x1f2da8]['primary_code']=_0x53cb58;}),_0x10ac4e[_0x324e73(0x1cc)]((_0x469b14,_0x248018)=>{var _0x481e8f=_0x324e73;_0x1d7ca3[_0x248018][_0x481e8f(0x188)]=_0x469b14;}),_0x311408[_0x324e73(0x1cc)]((_0x965dd9,_0x359cb2)=>{var _0x4c9bd5=_0x324e73;_0x1d7ca3[_0x359cb2][_0x4c9bd5(0x171)]=_0x965dd9;}),_0x359b23[_0x324e73(0x1cc)]((_0x348fe8,_0x470e83)=>{_0x26f790['forEach']((_0x1ea751,_0x2b8793)=>{var _0x3d9b80=a0_0x5492;if(_0x1ea751=='Receiving\x20Area'&&_0x470e83==_0x2b8793){var _0x2e927c=_0x348fe8[_0x3d9b80(0x133)](0x3);_0x1d7ca3[_0x470e83][_0x3d9b80(0x163)]=_0x348fe8[0x0],_0x1d7ca3[_0x470e83]['rack']=_0x348fe8[0x1],_0x1d7ca3[_0x470e83]['bay']=0x0,_0x1d7ca3[_0x470e83][_0x3d9b80(0x138)]=0x0,_0x1d7ca3[_0x470e83][_0x3d9b80(0x1e5)]=_0x3d9b80(0x19c),_0x1d7ca3[_0x470e83]['floorlevel']=_0x2e927c;}else{if(_0x1ea751==_0x3d9b80(0xf9)&&_0x470e83==_0x2b8793){var _0x2e927c=_0x348fe8[_0x3d9b80(0x133)](0x3);_0x1d7ca3[_0x470e83]['storage']=_0x348fe8[0x0],_0x1d7ca3[_0x470e83][_0x3d9b80(0xf7)]=_0x348fe8[0x1],_0x1d7ca3[_0x470e83][_0x3d9b80(0x18d)]=0x0,_0x1d7ca3[_0x470e83][_0x3d9b80(0x138)]=0x0,_0x1d7ca3[_0x470e83]['type']=_0x3d9b80(0x19c),_0x1d7ca3[_0x470e83][_0x3d9b80(0x119)]=_0x348fe8[0x5];}else{if(_0x470e83==_0x2b8793){var _0x56fb8d;if(_0x348fe8[0x4]=='L')_0x56fb8d='Level';else _0x348fe8[0x4]=='F'&&(_0x56fb8d='Floor');_0x1d7ca3[_0x470e83][_0x3d9b80(0x163)]=_0x348fe8[0x0],_0x1d7ca3[_0x470e83][_0x3d9b80(0xf7)]=_0x348fe8[0x1],_0x1d7ca3[_0x470e83][_0x3d9b80(0x18d)]=_0x348fe8[0x2],_0x1d7ca3[_0x470e83][_0x3d9b80(0x138)]=_0x348fe8[0x3],_0x1d7ca3[_0x470e83]['type']=_0x56fb8d,_0x1d7ca3[_0x470e83][_0x3d9b80(0x119)]=_0x348fe8[0x5];}}}});}),_0x369476[_0x324e73(0x1cc)]((_0xaa934d,_0xa84564)=>{var _0x38cd6f=_0x324e73;_0x1d7ca3[_0xa84564][_0x38cd6f(0x12b)]=_0xaa934d;}),_0x177d60[_0x324e73(0x1cc)]((_0x2fe91b,_0x5c7ee7)=>{var _0x21d85d=_0x324e73;_0x1d7ca3[_0x5c7ee7][_0x21d85d(0x1a4)]=_0x2fe91b;}),_0x527d99[_0x324e73(0x1cc)]((_0x467b3a,_0x33de07)=>{var _0x2ce90b=_0x324e73;_0x1d7ca3[_0x33de07][_0x2ce90b(0x142)]=_0x467b3a;}),_0x12bd59['forEach']((_0x13fc99,_0x267061)=>{_0x1d7ca3[_0x267061]['expiry_date']=_0x13fc99;}),_0x8e14a8[_0x324e73(0x1cc)]((_0x2ae1f0,_0x15c11d)=>{var _0x4317dd=_0x324e73;_0x1d7ca3[_0x15c11d][_0x4317dd(0x12f)]=_0x2ae1f0;}),_0x525890[_0x324e73(0x1cc)]((_0x57e88d,_0xfb86dc)=>{var _0x8ece9=_0x324e73;_0x1d7ca3[_0xfb86dc][_0x8ece9(0x1f1)]=_0x57e88d;}),_0xcc378[_0x324e73(0x1cc)]((_0x514437,_0x4fed7c)=>{var _0x3184a8=_0x324e73;_0x1d7ca3[_0x4fed7c][_0x3184a8(0x1aa)]=Math[_0x3184a8(0x108)](_0x514437);}),_0x2d9fb7['forEach']((_0x2cd1ac,_0x51389a)=>{var _0x6472fb=_0x324e73;_0x1d7ca3[_0x51389a][_0x6472fb(0x16d)]=_0x2cd1ac;}),_0x344e7c[_0x324e73(0x1cc)]((_0x377e4d,_0x7a3dab)=>{var _0x24a1b1=_0x324e73;_0x1d7ca3[_0x7a3dab][_0x24a1b1(0x166)]=_0x377e4d;}),_0x3020bd[_0x324e73(0x1cc)]((_0x10ec7c,_0x1d1dce)=>{_0x1d7ca3[_0x1d1dce]['prod_cat']=_0x10ec7c;}),_0x51ea55[_0x324e73(0x1cc)]((_0x2b1bd4,_0x180623)=>{var _0x5c0fd3=_0x324e73;_0x1d7ca3[_0x180623][_0x5c0fd3(0x11c)]=_0x2b1bd4;}),_0x26f790[_0x324e73(0x1cc)]((_0x56c5aa,_0x27bc12)=>{var _0x383c13=_0x324e73;_0x1d7ca3[_0x27bc12][_0x383c13(0x1be)]=_0x56c5aa;});var _0x130c6c=0x0;_0x1d7ca3[_0x324e73(0x1cc)](_0x484502=>{var _0x1bedf4=_0x324e73;console[_0x1bedf4(0x143)](_0x1bedf4(0x18f),_0x484502),(parseInt(_0x484502[_0x1bedf4(0x1b8)])<parseInt(_0x484502['quantity'])||parseInt(_0x484502[_0x1bedf4(0x161)])==0x0)&&_0x130c6c++;});if(_0x130c6c!=0x0)return _0x30f812['flash'](_0x324e73(0x1cd),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x1b1162[_0x324e73(0x1b0)](_0x324e73(0x1a5));const _0x46ff1a=_0x1d7ca3['filter'](_0x4be325=>_0x4be325['quantity']!=='0'&&_0x4be325['quantity']!=='');_0x4e1d83[_0x324e73(0x1a0)]=_0x231a7b,_0x4e1d83[_0x324e73(0xfb)]=_0x1b9e96,_0x4e1d83[_0x324e73(0x149)]=_0x5e6d43,_0x4e1d83[_0x324e73(0x141)]=_0x2de0f7,_0x4e1d83[_0x324e73(0x1ca)]=_0x46ff1a,_0x4e1d83[_0x324e73(0xf4)]=_0x2c16d6,_0x4e1d83[_0x324e73(0x169)]=_0x160c41,_0x4e1d83[_0x324e73(0x18c)]=_0x324e73(0x12c),_0x4e1d83[_0x324e73(0x111)]=_0x324e73(0x12c);const _0x571c3f=await _0x4e1d83[_0x324e73(0x17c)]();_0x30f812['flash'](_0x324e73(0x10f),_0x324e73(0x101)),_0x1b1162[_0x324e73(0x1b0)](_0x324e73(0x197));}catch(_0x37f69e){console['log'](_0x37f69e);}}),router[a0_0x304b9a(0x1ec)](a0_0x304b9a(0x15c),auth,async(_0x44fde7,_0x4274da)=>{var _0x55fb98=a0_0x304b9a;try{const _0x5d3450=_0x44fde7[_0x55fb98(0x114)]['id'],{invoice:_0x4abfdd,customer:_0x2b5cfe,receivable_amount:_0xbe9d92,received_amount:_0x248c8d}=_0x44fde7[_0x55fb98(0x170)],_0x1ca0be=await sales[_0x55fb98(0x15a)](_0x5d3450);console[_0x55fb98(0x143)](_0x1ca0be);var _0x5c503d=_0xbe9d92-_0x248c8d;console[_0x55fb98(0x143)](_0x248c8d),_0x1ca0be['received_amount']=parseFloat(_0x248c8d)+parseFloat(_0x1ca0be[_0x55fb98(0x13e)]),_0x1ca0be[_0x55fb98(0x1b3)]=_0x5c503d,console[_0x55fb98(0x143)](_0x1ca0be);const _0x1a13df=await _0x1ca0be[_0x55fb98(0x17c)](),_0x3d1f63=await c_payment_data[_0x55fb98(0x11e)]({'invoice':_0x4abfdd});_0x3d1f63[_0x55fb98(0x13d)]=_0x5c503d,await _0x3d1f63[_0x55fb98(0x17c)]();let _0x3f99f7=new Date(),_0x25056b=('0'+_0x3f99f7[_0x55fb98(0x11d)]())[_0x55fb98(0x133)](-0x2),_0x4a4eb8=('0'+(_0x3f99f7['getMonth']()+0x1))['slice'](-0x2),_0x10bfdb=_0x3f99f7[_0x55fb98(0x1e6)](),_0x557d16=_0x10bfdb+'-'+_0x4a4eb8+'-'+_0x25056b;const _0x1fa405=new customer_payment({'invoice':_0x4abfdd,'date':_0x10bfdb+'-'+_0x4a4eb8+'-'+_0x25056b,'customer':_0x2b5cfe,'reason':_0x55fb98(0x122),'amount':_0x248c8d}),_0x3dc949=await _0x1fa405[_0x55fb98(0x17c)]();_0x44fde7[_0x55fb98(0x100)]('success',_0x55fb98(0x173)),_0x4274da[_0x55fb98(0x1b0)](_0x55fb98(0x197));}catch(_0x33f8ea){console[_0x55fb98(0x143)](_0x33f8ea);}}),router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x1b9),auth,async(_0x35acca,_0x46a592)=>{var _0x2ffe3c=a0_0x304b9a;try{const {username:_0x5e66db,email:_0x178c1f,role:_0x2a9485}=_0x35acca[_0x2ffe3c(0x19f)],_0x348873=_0x35acca[_0x2ffe3c(0x19f)],_0x8440bc=await profile[_0x2ffe3c(0x11e)]({'email':_0x348873[_0x2ffe3c(0x1dd)]}),_0x432e=await master_shop[_0x2ffe3c(0x124)]();console['log'](_0x2ffe3c(0x1c4),_0x432e);const _0x2c2594=_0x35acca[_0x2ffe3c(0x114)]['id'],_0xf58cc=await sales[_0x2ffe3c(0x15a)](_0x2c2594);console[_0x2ffe3c(0x143)](_0xf58cc);const _0x54b59e=await customer['findOne']({'name':_0xf58cc[_0x2ffe3c(0xfb)]});console[_0x2ffe3c(0x143)](_0x54b59e);if(_0x432e[0x0]['language']==_0x2ffe3c(0x152)){var _0x231a5c=users['English'];console[_0x2ffe3c(0x143)](_0x231a5c);}else{if(_0x432e[0x0][_0x2ffe3c(0x15e)]==_0x2ffe3c(0x105))var _0x231a5c=users[_0x2ffe3c(0x105)];else{if(_0x432e[0x0][_0x2ffe3c(0x15e)]=='German')var _0x231a5c=users[_0x2ffe3c(0x123)];else{if(_0x432e[0x0][_0x2ffe3c(0x15e)]=='Spanish')var _0x231a5c=users['Spanish'];else{if(_0x432e[0x0][_0x2ffe3c(0x15e)]=='French')var _0x231a5c=users[_0x2ffe3c(0x14e)];else{if(_0x432e[0x0]['language']==_0x2ffe3c(0x187))var _0x231a5c=users['Portuguese'];else{if(_0x432e[0x0][_0x2ffe3c(0x15e)]==_0x2ffe3c(0x160))var _0x231a5c=users[_0x2ffe3c(0x160)];else{if(_0x432e[0x0][_0x2ffe3c(0x15e)]==_0x2ffe3c(0x1cb))var _0x231a5c=users[_0x2ffe3c(0x1d9)];}}}}}}}_0x46a592[_0x2ffe3c(0x1bf)](_0x2ffe3c(0x1ee),{'success':_0x35acca[_0x2ffe3c(0x100)](_0x2ffe3c(0x10f)),'errors':_0x35acca[_0x2ffe3c(0x100)](_0x2ffe3c(0x1cd)),'role':_0x348873,'profile':_0x8440bc,'master_shop':_0x432e,'customers':_0x54b59e,'sales':_0xf58cc,'language':_0x231a5c});}catch(_0x350e61){console[_0x2ffe3c(0x143)](_0x350e61);}}),router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x1dc),auth,async(_0x4c5a4f,_0x3ae001)=>{var _0x495a9e=a0_0x304b9a;try{const {username:_0x18960e,email:_0x16bdfc,role:_0x275b04}=_0x4c5a4f['user'],_0xbfde86=_0x4c5a4f[_0x495a9e(0x19f)],_0x2b3f79=await profile[_0x495a9e(0x11e)]({'email':_0xbfde86['email']}),_0x1e1841=await master_shop[_0x495a9e(0x124)]();console[_0x495a9e(0x143)](_0x495a9e(0x1c4),_0x1e1841);const _0x1a9002=_0x4c5a4f[_0x495a9e(0x114)]['id'];console[_0x495a9e(0x143)](_0x1a9002);const _0x4a75c4=await sales[_0x495a9e(0x15a)](_0x1a9002);console[_0x495a9e(0x143)](_0x495a9e(0x140),_0x4a75c4);const _0x1f9028=await warehouse[_0x495a9e(0x147)]([{'$match':{'name':_0x495a9e(0x186),'room':_0x495a9e(0x1e8)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x495a9e(0x157),'name':{'$first':_0x495a9e(0xfd)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x495a9e(0x130)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x495a9e(0x14c)},'secondary_code':{'$first':_0x495a9e(0x1d2)},'product_code':{'$first':_0x495a9e(0x19e)}}}]);console[_0x495a9e(0x143)](_0x495a9e(0x1f4),_0x1f9028);const _0x4ea598=await product[_0x495a9e(0x124)]({});warehouse_data=await warehouse[_0x495a9e(0x147)]([{'$match':{'status':_0x495a9e(0x1b1),'name':_0x495a9e(0x186),'warehouse_category':_0x495a9e(0x156)}},{'$group':{'_id':_0x495a9e(0xf5),'name':{'$first':_0x495a9e(0xf5)}}},{'$sort':{'name':0x1}}]);var _0x3a0934=['Return\x20Rooms'];if(_0x1e1841[0x0][_0x495a9e(0x15e)]=='English\x20(US)'){var _0x4563a5=users[_0x495a9e(0x1c7)];console[_0x495a9e(0x143)](_0x4563a5);}else{if(_0x1e1841[0x0][_0x495a9e(0x15e)]==_0x495a9e(0x105))var _0x4563a5=users['Hindi'];else{if(_0x1e1841[0x0][_0x495a9e(0x15e)]==_0x495a9e(0x123))var _0x4563a5=users[_0x495a9e(0x123)];else{if(_0x1e1841[0x0][_0x495a9e(0x15e)]==_0x495a9e(0x1f7))var _0x4563a5=users['Spanish'];else{if(_0x1e1841[0x0][_0x495a9e(0x15e)]=='French')var _0x4563a5=users['French'];else{if(_0x1e1841[0x0][_0x495a9e(0x15e)]==_0x495a9e(0x187))var _0x4563a5=users[_0x495a9e(0x1bd)];else{if(_0x1e1841[0x0]['language']==_0x495a9e(0x160))var _0x4563a5=users[_0x495a9e(0x160)];else{if(_0x1e1841[0x0][_0x495a9e(0x15e)]=='Arabic\x20(ae)')var _0x4563a5=users[_0x495a9e(0x1d9)];}}}}}}}_0x3ae001[_0x495a9e(0x1bf)](_0x495a9e(0x10b),{'success':_0x4c5a4f[_0x495a9e(0x100)](_0x495a9e(0x10f)),'errors':_0x4c5a4f[_0x495a9e(0x100)](_0x495a9e(0x1cd)),'role':_0xbfde86,'profile':_0x2b3f79,'user':_0x4a75c4,'stock':_0x1f9028,'master_shop':_0x1e1841,'unit':_0x4ea598,'language':_0x4563a5,'warehouses':warehouse_data,'rooms':_0x3a0934});}catch(_0x2ee3a9){console[_0x495a9e(0x143)](_0x2ee3a9),_0x3ae001['status'](0xc8)['json']({'message':_0x2ee3a9[_0x495a9e(0x1ce)]});}}),router[a0_0x304b9a(0x1ec)]('/view/return_sales/:id',auth,async(_0x10fdae,_0x57158b)=>{var _0x5e14d6=a0_0x304b9a;try{const {invoice:_0x4b07fe,date:_0x3363f1,warehouse_name:_0x261623,product_name:_0x503b8c,primary_code:_0x12bf3d,secondary_code:_0x344bf5,product_code:_0x15a49,sales_quantity:_0x425be4,stocks:_0x570eb3,return_qty:_0x1d8434,Room_name:_0x3b8bc1,to_warehouse_name:_0x79f9a2,to_Roomname:_0x395dbb,to_Room_name:_0x213112,note:_0x2c06ab,level:_0xd3c2b7,isle:_0x50c69c,pallet:_0x4f023f}=_0x10fdae['body'];if(typeof _0x503b8c==_0x5e14d6(0x10d))var _0x3d7e6e=[_0x10fdae[_0x5e14d6(0x170)]['product_name']],_0x2fedcd=[_0x10fdae[_0x5e14d6(0x170)]['primary_code']],_0x553e33=[_0x10fdae[_0x5e14d6(0x170)]['secondary_code']],_0x2a593b=[_0x10fdae['body']['product_code']],_0x1a55bb=[_0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x180)]],_0x53be0c=[_0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x14a)]],_0x53a398=[_0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x159)]],_0x5584a6=[_0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x18d)]],_0x1f7a31=[_0x10fdae[_0x5e14d6(0x170)]['bin']],_0x20e4e0=[_0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x1e9)]],_0x181737=[_0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x119)]];else var _0x3d7e6e=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0xf1)]],_0x2fedcd=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x1ae)]],_0x553e33=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x188)]],_0x2a593b=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x171)]],_0x1a55bb=[..._0x10fdae['body']['sales_quantity']],_0x53be0c=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x14a)]],_0x53a398=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x159)]],_0x5584a6=[..._0x10fdae[_0x5e14d6(0x170)]['bay']],_0x1f7a31=[..._0x10fdae[_0x5e14d6(0x170)]['bin']],_0x20e4e0=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x1e9)]],_0x181737=[..._0x10fdae[_0x5e14d6(0x170)][_0x5e14d6(0x119)]];const _0x30f7be=_0x3d7e6e[_0x5e14d6(0x12d)](_0x14a270=>{return _0x14a270={'product_name':_0x14a270};});_0x2fedcd[_0x5e14d6(0x1cc)]((_0x47a3b8,_0x1e705a)=>{var _0x508a9c=_0x5e14d6;_0x30f7be[_0x1e705a][_0x508a9c(0x1ae)]=_0x47a3b8;}),_0x553e33[_0x5e14d6(0x1cc)]((_0x195c8e,_0x15fd6b)=>{var _0x2a8775=_0x5e14d6;_0x30f7be[_0x15fd6b][_0x2a8775(0x188)]=_0x195c8e;}),_0x2a593b['forEach']((_0x175603,_0x52cf78)=>{var _0xefbc1a=_0x5e14d6;_0x30f7be[_0x52cf78][_0xefbc1a(0x171)]=_0x175603;}),_0x1a55bb['forEach']((_0x43d756,_0x25aeac)=>{var _0x1484aa=_0x5e14d6;_0x30f7be[_0x25aeac][_0x1484aa(0x17f)]=_0x43d756;}),_0x53be0c[_0x5e14d6(0x1cc)]((_0x1c1e52,_0x2981f7)=>{var _0x4cef1f=_0x5e14d6;_0x30f7be[_0x2981f7][_0x4cef1f(0x1b8)]=_0x1c1e52;}),_0x53a398[_0x5e14d6(0x1cc)]((_0x8b7733,_0x39637b)=>{var _0xb6af29=_0x5e14d6;_0x30f7be[_0x39637b][_0xb6af29(0x159)]=_0x8b7733;}),_0x5584a6[_0x5e14d6(0x1cc)]((_0x2c9b04,_0x4c0a7a)=>{var _0x5575bf=_0x5e14d6;_0x30f7be[_0x4c0a7a][_0x5575bf(0x18d)]=_0x2c9b04;}),_0x1f7a31[_0x5e14d6(0x1cc)]((_0x571a38,_0x343618)=>{var _0x54a9fe=_0x5e14d6;_0x30f7be[_0x343618][_0x54a9fe(0x138)]=_0x571a38;}),_0x20e4e0[_0x5e14d6(0x1cc)]((_0x2164fd,_0x505ae3)=>{var _0x25e434=_0x5e14d6;_0x30f7be[_0x505ae3][_0x25e434(0x1e5)]=_0x2164fd;}),_0x181737['forEach']((_0x45c47f,_0x415d21)=>{_0x30f7be[_0x415d21]['floorlevel']=_0x45c47f;});var _0xd79c2f=0x0;_0x30f7be[_0x5e14d6(0x1cc)](_0x2c8d75=>{var _0xd05364=_0x5e14d6;console['log'](_0xd05364(0x18f),_0x2c8d75),(parseInt(_0x2c8d75[_0xd05364(0x17f)])<parseInt(_0x2c8d75[_0xd05364(0x159)])||parseInt(_0x2c8d75[_0xd05364(0x1b8)])<parseInt(_0x2c8d75['return_qty'])&&parseInt(_0x2c8d75['sale_qty'])>parseInt(_0x2c8d75['return_qty'])||parseInt(_0x2c8d75[_0xd05364(0x159)])==0x0)&&_0xd79c2f++;});if(_0xd79c2f!=0x0)return _0x10fdae[_0x5e14d6(0x100)](_0x5e14d6(0x1cd),_0x5e14d6(0x146)),_0x57158b['redirect'](_0x5e14d6(0x1a5));const _0x14bdbd=await sales['findOne']({'invoice':_0x4b07fe});console[_0x5e14d6(0x143)](_0x14bdbd),_0x14bdbd['return_data']=_0x5e14d6(0x1b7);const _0x4cfcc9=await _0x14bdbd[_0x5e14d6(0x17c)](),_0x332e28=new sales_return({'invoice':_0x4b07fe,'customer':_0x10fdae['body'][_0x5e14d6(0xfb)],'date':_0x3363f1,'warehouse_name':_0x261623,'room':_0x3b8bc1,'ToWarehouse':_0x79f9a2,'ToRoom':_0x213112,'return_sale':_0x30f7be,'note':_0x2c06ab}),_0x385396=await _0x332e28[_0x5e14d6(0x17c)]();console[_0x5e14d6(0x143)](_0x332e28);const _0x5dbeca=await sales_return[_0x5e14d6(0x11e)]({'invoice':_0x4b07fe}),_0x31ec04=await warehouse[_0x5e14d6(0x11e)]({'name':_0x79f9a2,'room':_0x213112});_0x5dbeca[_0x5e14d6(0x10b)][_0x5e14d6(0x1cc)](_0x2832de=>{var _0x1f204c=_0x5e14d6,_0x36ccf8=0x0;const _0x11c5e9=_0x31ec04['product_details']['map'](_0x50fc5c=>{var _0x1e79fd=a0_0x5492;_0x50fc5c[_0x1e79fd(0xf1)]==_0x2832de[_0x1e79fd(0xf1)]&&_0x50fc5c[_0x1e79fd(0x119)]==_0x2832de[_0x1e79fd(0x119)]&&_0x50fc5c[_0x1e79fd(0x1e5)]==_0x2832de[_0x1e79fd(0x1e5)]&&_0x50fc5c[_0x1e79fd(0x138)]==_0x2832de['bin']&&_0x50fc5c[_0x1e79fd(0x18d)]==_0x2832de[_0x1e79fd(0x18d)]&&(_0x50fc5c[_0x1e79fd(0x15f)]=parseInt(_0x50fc5c[_0x1e79fd(0x15f)])+parseInt(_0x2832de[_0x1e79fd(0x159)]),_0x36ccf8++);});_0x36ccf8=='0'&&(_0x31ec04[_0x1f204c(0x196)]=_0x31ec04[_0x1f204c(0x196)]['concat']({'product_name':_0x2832de['product_name'],'product_stock':_0x2832de[_0x1f204c(0x159)],'primary_code':_0x2832de[_0x1f204c(0x1ae)],'secondary_code':_0x2832de[_0x1f204c(0x188)],'product_code':_0x2832de[_0x1f204c(0x171)],'bay':_0x2832de['bay'],'bin':_0x2832de[_0x1f204c(0x138)],'type':_0x2832de[_0x1f204c(0x1e5)],'floorlevel':_0x2832de[_0x1f204c(0x119)]})),console['log'](_0x1f204c(0x139),_0x31ec04);}),await _0x31ec04['save'](),console[_0x5e14d6(0x143)](_0x10fdae[_0x5e14d6(0x170)]);const _0xd758ef=new c_payment_data({'invoice':_0x4b07fe,'customer':_0x10fdae['body'][_0x5e14d6(0xfb)],'reason':'Sale\x20Return'});await _0xd758ef[_0x5e14d6(0x17c)]();const _0x43fdfa=await master_shop['find']();console[_0x5e14d6(0x143)](_0x5e14d6(0x17a),_0x43fdfa[0x0][_0x5e14d6(0x1d7)]);const _0x30f850=await email_settings[_0x5e14d6(0x11e)](),_0x1e9be3=await customer[_0x5e14d6(0x11e)]({'name':_0x10fdae['body'][_0x5e14d6(0xfb)]});console[_0x5e14d6(0x143)](_0x5e14d6(0x1b6),_0x1e9be3);_0x43fdfa[0x0]['currency_placement']==0x1?(right_currency=_0x43fdfa[0x0][_0x5e14d6(0x198)],left_currency=''):(right_currency='',left_currency=_0x43fdfa[0x0][_0x5e14d6(0x198)]);var _0x533246=_0x3d7e6e,_0x3a00cc=_0x53a398,_0x51a5a2='',_0x39411a;for(_0x39411a in _0x533246){_0x51a5a2+=_0x5e14d6(0x18a)+_0x5e14d6(0x148)+_0x533246[_0x39411a]+_0x5e14d6(0x1ba)+_0x5e14d6(0x148)+_0x3a00cc[_0x39411a]+'</td>'+'</tr>';}console[_0x5e14d6(0x143)]('product_list',_0x51a5a2);let _0x242b7b=nodemailer[_0x5e14d6(0x16c)]({'service':'gmail','auth':{'user':_0x30f850[_0x5e14d6(0x1dd)],'pass':_0x30f850['password']}}),_0x3a5c1e={'from':_0x30f850['email'],'to':_0x1e9be3[_0x5e14d6(0x1dd)],'subject':_0x5e14d6(0x112),'attachments':[{'filename':_0x5e14d6(0x13b),'path':__dirname+_0x5e14d6(0x11a)+_0x5e14d6(0x113)+_0x43fdfa[0x0][_0x5e14d6(0x1d7)],'cid':_0x5e14d6(0x129)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x5e14d6(0x11b)+_0x5e14d6(0x13f)+_0x5e14d6(0x106)+_0x5e14d6(0x13f)+_0x5e14d6(0x1c2)+_0x5e14d6(0xf2)+_0x5e14d6(0x13f)+'<h2>\x20'+_0x43fdfa[0x0][_0x5e14d6(0x125)]+_0x5e14d6(0x10a)+'</div>'+_0x5e14d6(0xf2)+_0x5e14d6(0x189)+_0x5e14d6(0x13f)+_0x5e14d6(0x16f)+_0x5e14d6(0x115)+_0x4b07fe+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5e14d6(0x1e2)+_0x3363f1+'\x20'+'</span>'+_0x5e14d6(0x1db)+_0x5e14d6(0xf2)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5e14d6(0x1f0)+'<tr>'+_0x5e14d6(0x1ef)+_0x5e14d6(0x117)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x5e14d6(0x168)+_0x5e14d6(0x1d4)+'</thead>'+_0x5e14d6(0x1f2)+'\x20'+_0x51a5a2+'\x20'+'</tbody>'+_0x5e14d6(0xf8)+_0x5e14d6(0x13f)+_0x5e14d6(0x1c0)+'<h5>'+_0x43fdfa[0x0][_0x5e14d6(0x125)]+_0x5e14d6(0x1db)+_0x5e14d6(0xf2)+_0x5e14d6(0xf2)+_0x5e14d6(0x14d)};_0x242b7b['sendMail'](_0x3a5c1e,function(_0x5a12e9,_0x56f166){var _0x540cd6=_0x5e14d6;_0x5a12e9?(console['log'](_0x5a12e9),console[_0x540cd6(0x143)]('Error\x20Occurs')):console[_0x540cd6(0x143)](_0x540cd6(0x151));}),_0x10fdae[_0x5e14d6(0x100)]('success',_0x5e14d6(0x121)),_0x57158b[_0x5e14d6(0x1b0)](_0x5e14d6(0x197));}catch(_0xa07066){console[_0x5e14d6(0x143)](_0xa07066),_0x57158b['status'](0xc8)[_0x5e14d6(0x1b4)]({'message1':_0xa07066[_0x5e14d6(0x1ce)]});}}),router[a0_0x304b9a(0x16b)](a0_0x304b9a(0x1d5),auth,async(_0x382263,_0x2dda72)=>{var _0x2c948b=a0_0x304b9a;try{const {username:_0x1eb60d,email:_0x4462ce,role:_0x48654a}=_0x382263[_0x2c948b(0x19f)],_0x334193=_0x382263['user'],_0x2fe48a=await profile[_0x2c948b(0x11e)]({'email':_0x334193['email']}),_0x4b2f9f=await master_shop[_0x2c948b(0x124)]();console[_0x2c948b(0x143)]('barcode\x20Product\x20master',_0x4b2f9f);const _0x511fd1=_0x382263[_0x2c948b(0x114)]['id'],_0x5cbab6=await sales[_0x2c948b(0x15a)](_0x511fd1);console[_0x2c948b(0x143)](_0x2c948b(0x183),_0x5cbab6);if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]==_0x2c948b(0x152))var _0x514bbc=users[_0x2c948b(0x1c7)];else{if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]=='Hindi')var _0x514bbc=users[_0x2c948b(0x105)];else{if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]==_0x2c948b(0x123))var _0x514bbc=users[_0x2c948b(0x123)];else{if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]==_0x2c948b(0x1f7))var _0x514bbc=users[_0x2c948b(0x1f7)];else{if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]==_0x2c948b(0x14e))var _0x514bbc=users[_0x2c948b(0x14e)];else{if(_0x4b2f9f[0x0]['language']=='Portuguese\x20(BR)')var _0x514bbc=users[_0x2c948b(0x1bd)];else{if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]==_0x2c948b(0x160))var _0x514bbc=users[_0x2c948b(0x160)];else{if(_0x4b2f9f[0x0][_0x2c948b(0x15e)]=='Arabic\x20(ae)')var _0x514bbc=users['Arabic'];}}}}}}}_0x2dda72[_0x2c948b(0x1bf)]('all_sales_barcode',{'success':_0x382263[_0x2c948b(0x100)](_0x2c948b(0x10f)),'errors':_0x382263[_0x2c948b(0x100)](_0x2c948b(0x1cd)),'role':_0x334193,'profile':_0x2fe48a,'alldata':_0x5cbab6,'master_shop':_0x4b2f9f,'language':_0x514bbc});}catch(_0x29dfcc){console[_0x2c948b(0x143)](_0x29dfcc);}}),router[a0_0x304b9a(0x1ec)](a0_0x304b9a(0x195),async(_0x440dae,_0x38859d)=>{var _0x48e1b1=a0_0x304b9a;const {product_code:_0x41059d,warehouse_name:_0x432b78,rooms_data:_0x239177,Roomslist:_0x1bc87f}=_0x440dae[_0x48e1b1(0x170)],_0x123272=_0x1bc87f[_0x48e1b1(0x1ab)](','),_0x21637a=[];async function _0x1af5c4(_0x2a8047){var _0x4c7f6a=_0x48e1b1;const _0x356b15=await warehouse[_0x4c7f6a(0x147)]([{'$match':{'name':_0x432b78,'room':_0x2a8047}},{'$unwind':_0x4c7f6a(0x1a6)},{'$match':{'product_details.primary_code':_0x41059d}},{'$group':{'_id':_0x4c7f6a(0x157),'name':{'$first':_0x4c7f6a(0xfd)},'product_stock':{'$first':_0x4c7f6a(0x154)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4c7f6a(0x1d2)},'product_code':{'$first':_0x4c7f6a(0x19e)},'level':{'$first':_0x4c7f6a(0x126)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4c7f6a(0x127)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4c7f6a(0xfa)},'storage':{'$first':_0x4c7f6a(0xf3)},'rack':{'$first':_0x4c7f6a(0x1f9)},'expiry_date':{'$first':_0x4c7f6a(0x14b)},'production_date':{'$first':_0x4c7f6a(0x1ed)},'maxPerUnit':{'$first':_0x4c7f6a(0x1d8)},'batch_code':{'$first':_0x4c7f6a(0x1e7)},'product_cat':{'$first':_0x4c7f6a(0x1c9)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4c7f6a(0x165)},'invoice':{'$first':_0x4c7f6a(0xf0)},'actual_qty':{'$first':_0x4c7f6a(0x185)},'actual_uom':{'$first':_0x4c7f6a(0x191)}}}]),_0x41c6e8=await warehouse[_0x4c7f6a(0x147)]([{'$match':{'name':_0x432b78,'room':_0x2a8047}},{'$unwind':_0x4c7f6a(0x1a6)},{'$match':{'product_details.secondary_code':_0x41059d}},{'$group':{'_id':_0x4c7f6a(0x157),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4c7f6a(0x154)},'primary_code':{'$first':_0x4c7f6a(0x14c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4c7f6a(0x19e)},'level':{'$first':_0x4c7f6a(0x126)},'isle':{'$first':_0x4c7f6a(0x167)},'type':{'$first':_0x4c7f6a(0x127)},'pallet':{'$first':_0x4c7f6a(0x12e)},'unit':{'$first':_0x4c7f6a(0x15b)},'secondary_unit':{'$first':_0x4c7f6a(0xfa)},'storage':{'$first':_0x4c7f6a(0xf3)},'rack':{'$first':_0x4c7f6a(0x1f9)},'expiry_date':{'$first':_0x4c7f6a(0x14b)},'production_date':{'$first':_0x4c7f6a(0x1ed)},'maxPerUnit':{'$first':_0x4c7f6a(0x1d8)},'batch_code':{'$first':_0x4c7f6a(0x1e7)},'product_cat':{'$first':_0x4c7f6a(0x1c9)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4c7f6a(0x165)},'invoice':{'$first':_0x4c7f6a(0xf0)}}}]);if(_0x356b15[_0x4c7f6a(0x13c)]>0x0)_0x21637a[_0x4c7f6a(0x155)](_0x356b15);else _0x41c6e8[_0x4c7f6a(0x13c)]>0x0&&_0x21637a['push'](_0x41c6e8);}const _0x4f3eeb=_0x123272[_0x48e1b1(0x12d)](_0x18e0c6=>_0x1af5c4(_0x18e0c6));await Promise['all'](_0x4f3eeb),_0x38859d[_0x48e1b1(0x1b4)](_0x21637a);}),module[a0_0x304b9a(0x1e3)]=router;