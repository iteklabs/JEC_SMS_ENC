var a0_0x294f75=a0_0x5d38;(function(_0x33db57,_0x365987){var _0x5d7bc2=a0_0x5d38,_0x41af20=_0x33db57();while(!![]){try{var _0x1c569c=-parseInt(_0x5d7bc2(0x151))/0x1*(parseInt(_0x5d7bc2(0x137))/0x2)+parseInt(_0x5d7bc2(0x124))/0x3+-parseInt(_0x5d7bc2(0x167))/0x4+-parseInt(_0x5d7bc2(0x118))/0x5*(parseInt(_0x5d7bc2(0x106))/0x6)+-parseInt(_0x5d7bc2(0x10b))/0x7+parseInt(_0x5d7bc2(0x10d))/0x8*(parseInt(_0x5d7bc2(0x161))/0x9)+parseInt(_0x5d7bc2(0x18d))/0xa;if(_0x1c569c===_0x365987)break;else _0x41af20['push'](_0x41af20['shift']());}catch(_0x513993){_0x41af20['push'](_0x41af20['shift']());}}}(a0_0x1c43,0x580fb));function a0_0x5d38(_0xeb903,_0x5476de){var _0x1c4399=a0_0x1c43();return a0_0x5d38=function(_0x5d383c,_0x5894bb){_0x5d383c=_0x5d383c-0x80;var _0x2436b8=_0x1c4399[_0x5d383c];return _0x2436b8;},a0_0x5d38(_0xeb903,_0x5476de);}const express=require(a0_0x294f75(0x91)),app=express(),router=express[a0_0x294f75(0x119)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x294f75(0x102)),auth=require(a0_0x294f75(0xda)),nodemailer=require(a0_0x294f75(0xc9)),users=require('../public/language/languages.json');function a0_0x1c43(){var _0x1498d0=['requested_qty','product','/barcode/:id','user','sales\x20all_data','\x20Order\x20Number\x20:\x20','customer','purchases_data','Error\x20Occurs','return_sale','/view/add_sales','batch_code','exports','$product.product_name','Sales\x20Add\x20successfully','get','/view/return_sales/:id','findById','payment\x20successfull','Shelves','<tr>','Arabic','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Raw\x20Materials','$isAllowEdit','due_amount','$product_details.rack','site_title','port','date','$product_details.level','isAllowEdit','German','<html><head><title></title>','warehouse','then','nodemailer','$product_details.batch_code','bin','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','_id','$return_data','Enclosed','$product_details.expiry_date','/view/add_sales/:id','product_code','sale_product','Return\x20Rooms','add\x20post','<hr\x20class=\x22my-3\x22>','English','Portuguese\x20(BR)','../middleware/auth','</table>','room_name','return_qty','Logo.png','$sale_product.bay','$product_details.secondary_unit','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','English\x20(US)','string','Email\x20sent\x20successfully','findOne','$product_details._id','$product_details.storage','<h5\x20style=\x22text-align:\x20left;\x22>','all','edit_sales_view','host','catch','abs','params','primary_unit','$sale_product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</head><body>','customers_docs','</tbody>','forEach','slice','$sale_product','random','delivery_code','stock','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','logo','find','body','\x20</h2>','all_sales','../models/all_models','product_stock','message','<table\x20style=\x22width:\x20100%\x20!important;\x22>','18nLNArZ','$product_details.product_stock','error','Chinese','padStart','3870818kogYXC','\x20Order\x20Date\x20:\x20','48ujKpgq','Level','password','level','sale_qty','quantity_notConverted','unit','$product_details.bin','$product_details.production_date','/preview/:id','createTransport','296145txDLTt','Router','stock_data','rack','SCRN','actual_uom','getMonth','<span\x20style=\x22float:\x20right;\x22>','$product_details.product_name','staff','<div>','<h5>','1361910XYmTXd','$product_details.floorlevel','foreach\x20newproduct','finalize','type','Return\x20Goods','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','received_amount','flash','Sale\x20Return\x20Mail','master','Sales\x20Mail','Floor','sales_quantity','<h2>\x20','aggregate','RMSEmail','language','Hindi','3964WCpbLJ','$product_details.product_code','final','customer_data','currency','OUT-','amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$date','</tr>','An\x20error\x20occurred.','product_data','filter','</td>','RoomAssigned','/view','prod_cat','invoice','$invoice','$sale_product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_invoice','email','$sale_product.type','getDate','/all_sales/view','69yoiOZB','Portuguese','role','status','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','json','/upload/','product_name','room','sendMail','storage','redirect','id_transaction_from','getFullYear','993933FOxJGa','$product_details.maxPerUnit','actual_qty','product_details','warehouse_name','$note','1809460wKZuzJ','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','concat','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','user_id','stocks','production_date','sales\x20item\x20return\x20successfull','<!DOCTYPE\x20html>','$product_details.secondary_code','$product_details.actual_uom','push','floor','Sales\x20Update\x20successfully','maxperunit','secondary_code','barcode\x20Product\x20master','$product_details.product_cat','Arabic\x20(ae)','image','$customers_docs','post','primary_code','length','sales_invoice','$_id','$sale_product.floorlevel','<strong>\x20Regards\x20</strong>','</thead>','customers','$product_details','id_transact','render','$name','edit_sales','</h5>','secondary_unit','5638910IyeiUB','expiry_date','prod_code','$warehouse_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.bay','$product_details.isle','gmail','False','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Spanish','Received\x20Payment\x20For\x20Sale','Receiving\x20Area','</body></html>','product_list','save','split','/barcode_scanner','$customer','quantity','log','types','$product_details.unit','True','express','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.pallet','note','/view/:id','carton','delivery_date','Enabled','success','bay','barcode\x20user_id','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','map','<tbody\x20style=\x22text-align:\x20center;\x22>','/../public','</div>','$product_details.type','name'];a0_0x1c43=function(){return _0x1498d0;};return a0_0x1c43();}router[a0_0x294f75(0xb3)](a0_0x294f75(0x146),auth,async(_0x4a1cc3,_0x56c829)=>{var _0x2a3a2e=a0_0x294f75;try{const {username:_0x4bf047,email:_0x49d24b,role:_0x5bf0d9}=_0x4a1cc3[_0x2a3a2e(0xa7)],_0x2aefb5=_0x4a1cc3[_0x2a3a2e(0xa7)],_0x5daf74=await profile['findOne']({'email':_0x2aefb5[_0x2a3a2e(0x14d)]}),_0x3a1a15=await master_shop[_0x2a3a2e(0xfe)]();let _0x13ce43;if(_0x2aefb5[_0x2a3a2e(0x153)]=='staff'){const _0x259549=await staff[_0x2a3a2e(0xe5)]({'email':_0x2aefb5[_0x2a3a2e(0x14d)]});_0x13ce43=await sales['aggregate']([{'$lookup':{'from':_0x2a3a2e(0x185),'localField':'customer','foreignField':_0x2a3a2e(0xa3),'as':_0x2a3a2e(0xf3)}},{'$unwind':_0x2a3a2e(0x17c)},{'$unwind':_0x2a3a2e(0xf7)},{'$group':{'_id':_0x2a3a2e(0x181),'invoice':{'$first':_0x2a3a2e(0x149)},'customers':{'$first':_0x2a3a2e(0x8b)},'date':{'$first':_0x2a3a2e(0x13f)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x2a3a2e(0x166)},'return_data':{'$first':_0x2a3a2e(0xcf)},'customers_docs':{'$first':_0x2a3a2e(0x17c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2a3a2e(0xdf)},'isle':{'$addToSet':_0x2a3a2e(0xf0)},'type':{'$addToSet':_0x2a3a2e(0x14e)},'pallet':{'$addToSet':_0x2a3a2e(0x182)},'finalize':{'$first':_0x2a3a2e(0x156)},'isAllowEdit':{'$first':_0x2a3a2e(0xbd)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x13ce43=await sales['aggregate']([{'$lookup':{'from':_0x2a3a2e(0x185),'localField':_0x2a3a2e(0xaa),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x2a3a2e(0x17c)},{'$unwind':_0x2a3a2e(0xf7)},{'$group':{'_id':_0x2a3a2e(0x181),'invoice':{'$first':_0x2a3a2e(0x149)},'customers':{'$first':_0x2a3a2e(0x8b)},'date':{'$first':_0x2a3a2e(0x13f)},'warehouse_name':{'$first':_0x2a3a2e(0x190)},'sale_product':{'$push':_0x2a3a2e(0xf7)},'note':{'$first':_0x2a3a2e(0x166)},'return_data':{'$first':_0x2a3a2e(0xcf)},'customers_docs':{'$first':_0x2a3a2e(0x17c)},'total_saleproduct_quantity':{'$sum':_0x2a3a2e(0x14a)},'level':{'$addToSet':_0x2a3a2e(0xdf)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x2a3a2e(0x182)},'finalize':{'$first':_0x2a3a2e(0x156)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x2a3a2e(0x8d)](_0x2a3a2e(0xa8),_0x13ce43);if(_0x3a1a15[0x0]['language']=='English\x20(US)'){var _0x5b7084=users[_0x2a3a2e(0xd8)];console['log'](_0x5b7084);}else{if(_0x3a1a15[0x0]['language']=='Hindi')var _0x5b7084=users['Hindi'];else{if(_0x3a1a15[0x0][_0x2a3a2e(0x135)]==_0x2a3a2e(0xc5))var _0x5b7084=users[_0x2a3a2e(0xc5)];else{if(_0x3a1a15[0x0][_0x2a3a2e(0x135)]==_0x2a3a2e(0x83))var _0x5b7084=users[_0x2a3a2e(0x83)];else{if(_0x3a1a15[0x0]['language']==_0x2a3a2e(0xba))var _0x5b7084=users[_0x2a3a2e(0xba)];else{if(_0x3a1a15[0x0][_0x2a3a2e(0x135)]==_0x2a3a2e(0xd9))var _0x5b7084=users[_0x2a3a2e(0x152)];else{if(_0x3a1a15[0x0][_0x2a3a2e(0x135)]=='Chinese')var _0x5b7084=users['Chinese'];else{if(_0x3a1a15[0x0][_0x2a3a2e(0x135)]==_0x2a3a2e(0x17a))var _0x5b7084=users[_0x2a3a2e(0xb9)];}}}}}}}_0x56c829[_0x2a3a2e(0x188)](_0x2a3a2e(0x101),{'success':_0x4a1cc3[_0x2a3a2e(0x12c)](_0x2a3a2e(0x99)),'errors':_0x4a1cc3[_0x2a3a2e(0x12c)](_0x2a3a2e(0x168)),'sales':_0x13ce43,'profile':_0x5daf74,'role':_0x2aefb5,'master_shop':_0x3a1a15,'language':_0x5b7084});}catch(_0x1e3d37){console[_0x2a3a2e(0x8d)](_0x1e3d37);}});async function getRandom8DigitNumber(){var _0x52b643=a0_0x294f75;const _0x4fcd1e=0x989680,_0x4cdff6=0x5f5e0ff,_0x31961c=Math[_0x52b643(0x174)](Math[_0x52b643(0xf8)]()*(_0x4cdff6-_0x4fcd1e+0x1))+_0x4fcd1e;var _0x16b33e;const _0x563f51=await sales[_0x52b643(0xe5)]({'invoice':_0x52b643(0x13c)+_0x31961c});return _0x563f51&&_0x563f51['length']>0x0?_0x16b33e=_0x52b643(0x13c)+_0x31961c:_0x16b33e=_0x52b643(0x13c)+_0x31961c,_0x16b33e;}router[a0_0x294f75(0xb3)]('/view/add_sales',auth,async(_0x5d7156,_0x5ec8a7)=>{var _0x21251c=a0_0x294f75;try{const {username:_0x3de71b,email:_0x285266,role:_0x4a6f16}=_0x5d7156[_0x21251c(0xa7)],_0x39634c=_0x5d7156['user'],_0x544707=await profile['findOne']({'email':_0x39634c[_0x21251c(0x14d)]}),_0xf9eabd=await master_shop[_0x21251c(0xfe)](),_0x56cc2f=await customer[_0x21251c(0xfe)]({});let _0x58192f;if(_0x39634c[_0x21251c(0x153)]==_0x21251c(0x121)){const _0x338710=await staff[_0x21251c(0xe5)]({'email':_0x39634c['email']});_0x58192f=await warehouse[_0x21251c(0x133)]([{'$match':{'status':_0x21251c(0x98),'name':_0x338710['warehouse'],'warehouse_category':_0x21251c(0xbc),'name':{'$ne':_0x21251c(0x129)}}},{'$group':{'_id':'$name','name':{'$first':_0x21251c(0x189)}}},{'$sort':{'name':0x1}}]);}else _0x58192f=await warehouse[_0x21251c(0x133)]([{'$match':{'status':'Enabled','warehouse_category':_0x21251c(0xbc),'name':{'$ne':_0x21251c(0x129)}}},{'$group':{'_id':_0x21251c(0x189),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x459b59=await product[_0x21251c(0xfe)]({});var _0x462db9=['Ambient','Enclosed'];const _0x3cc498=await sales['find']({}),_0x15d8c4=_0x3cc498[_0x21251c(0x17f)]+0x1,_0x4dd584=_0x21251c(0x13c)+_0x15d8c4['toString']()[_0x21251c(0x10a)](0x5,'0');if(_0xf9eabd[0x0][_0x21251c(0x135)]=='English\x20(US)'){var _0x29186f=users[_0x21251c(0xd8)];console[_0x21251c(0x8d)](_0x29186f);}else{if(_0xf9eabd[0x0][_0x21251c(0x135)]==_0x21251c(0x136))var _0x29186f=users[_0x21251c(0x136)];else{if(_0xf9eabd[0x0]['language']=='German')var _0x29186f=users['German'];else{if(_0xf9eabd[0x0][_0x21251c(0x135)]==_0x21251c(0x83))var _0x29186f=users[_0x21251c(0x83)];else{if(_0xf9eabd[0x0][_0x21251c(0x135)]==_0x21251c(0xba))var _0x29186f=users[_0x21251c(0xba)];else{if(_0xf9eabd[0x0]['language']==_0x21251c(0xd9))var _0x29186f=users[_0x21251c(0x152)];else{if(_0xf9eabd[0x0]['language']==_0x21251c(0x109))var _0x29186f=users[_0x21251c(0x109)];else{if(_0xf9eabd[0x0][_0x21251c(0x135)]==_0x21251c(0x17a))var _0x29186f=users[_0x21251c(0xb9)];}}}}}}}const _0x1bcf90=getRandom8DigitNumber();_0x1bcf90[_0x21251c(0xc8)](_0x47a044=>{var _0x34375d=_0x21251c;_0x5ec8a7[_0x34375d(0x188)]('add_sales',{'success':_0x5d7156[_0x34375d(0x12c)](_0x34375d(0x99)),'errors':_0x5d7156['flash']('errors'),'role':_0x39634c,'profile':_0x544707,'customer':_0x56cc2f,'warehouse':_0x58192f,'product':_0x459b59,'invoice':_0x47a044,'master_shop':_0xf9eabd,'language':_0x29186f,'rooms_data':_0x462db9});})[_0x21251c(0xec)](_0x40275e=>{var _0x1566d2=_0x21251c;_0x5d7156[_0x1566d2(0x12c)](_0x1566d2(0x168),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5ec8a7[_0x1566d2(0x15e)](_0x1566d2(0x150));});}catch(_0x113907){console[_0x21251c(0x8d)](_0x113907);}}),router[a0_0x294f75(0xb3)](a0_0x294f75(0xd2),auth,async(_0x538c5c,_0x30c29d)=>{var _0x28b75f=a0_0x294f75;try{const _0x4862e7=_0x538c5c[_0x28b75f(0xee)]['id'];console[_0x28b75f(0x8d)](_0x4862e7);const _0xdad05b=await product[_0x28b75f(0xfe)](),_0x1b4ab2=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4862e7}},{'$unwind':'$product'},{'$group':{'_id':_0x28b75f(0xb1)}}]);console[_0x28b75f(0x8d)](_0x28b75f(0xab),_0x1b4ab2),_0x30c29d[_0x28b75f(0x154)](0xc8)[_0x28b75f(0x158)]({'purchases_data':_0x1b4ab2,'product_data':_0xdad05b});}catch(_0x5dfa0b){console['log'](_0x5dfa0b);}}),router[a0_0x294f75(0x17d)]('/view/add_sale/product',auth,async(_0x2657a3,_0x4628c3)=>{var _0x24bcbf=a0_0x294f75;try{const {warehouse_data:_0x3752d1,product_data:_0x39d8cb}=_0x2657a3[_0x24bcbf(0xff)];console[_0x24bcbf(0x8d)](_0x2657a3[_0x24bcbf(0xff)][_0x24bcbf(0x142)]);;const _0x28cb4e=await master_shop[_0x24bcbf(0xfe)]();console[_0x24bcbf(0x8d)]('master',_0x28cb4e);const _0x5475a8=await product['findOne']({'name':_0x39d8cb});console[_0x24bcbf(0x8d)](_0x24bcbf(0xa5),_0x5475a8);const _0x519bfd=await warehouse[_0x24bcbf(0x133)]([{'$match':{'name':_0x3752d1}},{'$unwind':_0x24bcbf(0x186)},{'$match':{'product_details.product_name':_0x39d8cb}},{'$group':{'_id':_0x24bcbf(0x120),'product_stock':{'$first':_0x24bcbf(0x107)}}}]);console[_0x24bcbf(0x8d)]('stock_data',_0x519bfd),_0x4628c3[_0x24bcbf(0x154)](0xc8)[_0x24bcbf(0x158)]({'master':_0x28cb4e,'new_product':_0x5475a8,'stock_data':_0x519bfd});}catch(_0xaa9b82){console[_0x24bcbf(0x8d)](_0xaa9b82);}}),router[a0_0x294f75(0x17d)](a0_0x294f75(0xae),auth,async(_0xa9700b,_0xda53b5)=>{var _0x4adbd8=a0_0x294f75;try{const {invoice:_0x311fc6,date:_0x2d93e7,warehouse_name:_0x1c8012,product_name:_0x17972f,stock:_0x51f530,quantity:_0x8cdc47,note:_0x5f30d9,room:_0x3f8d64,primary_code:_0xa87088,secondary_code:_0x15f56f,prod_code:_0x1c21be,level:_0xd479b6,isle:_0x58e74f,pallet:_0xed56b9,batch_code:_0x3f235f,SCRN:_0x1fa0f1,expiry_date:_0x2818c0}=_0xa9700b[_0x4adbd8(0xff)];if(typeof _0x17972f==_0x4adbd8(0xe3))var _0x33595c=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x15a)]],_0x35afc0=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xfa)]],_0x3e52fd=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x96)]],_0x164332=[_0xa9700b[_0x4adbd8(0xff)]['primary_code']],_0x3838f0=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x177)]],_0x1b092f=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x18f)]],_0x4af44a=[_0xa9700b['body'][_0x4adbd8(0x110)]],_0x7bf09e=[_0xa9700b['body'][_0x4adbd8(0xef)]],_0x23ca9e=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x18c)]],_0x1d30a9=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xaf)]],_0x2fe485=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x18e)]],_0x3e0e44=[_0xa9700b[_0x4adbd8(0xff)]['max_per_unit']],_0x1045cc=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x16e)]],_0x19d905=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xa4)]],_0x12f28d=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x97)]],_0x2afd9c=[_0xa9700b['body'][_0x4adbd8(0xf9)]],_0x56b185=[_0xa9700b['body']['prod_cat']],_0x4b0004=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x8c)]],_0x4ba9d0=[_0xa9700b[_0x4adbd8(0xff)]['RoomAssigned']],_0x543866=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x14c)]],_0xda66a8=[_0xa9700b[_0x4adbd8(0xff)]['actual_qty']],_0x5515b3=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x11d)]],_0x39133d=[_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x187)]];else var _0x33595c=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x15a)]],_0x35afc0=[..._0xa9700b['body'][_0x4adbd8(0xfa)]],_0x3e52fd=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x96)]],_0x164332=[..._0xa9700b['body'][_0x4adbd8(0x17e)]],_0x3838f0=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x177)]],_0x1b092f=[..._0xa9700b['body'][_0x4adbd8(0x18f)]],_0x4af44a=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x110)]],_0x7bf09e=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xef)]],_0x23ca9e=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x18c)]],_0x1d30a9=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xaf)]],_0x2fe485=[..._0xa9700b['body'][_0x4adbd8(0x18e)]],_0x3e0e44=[..._0xa9700b[_0x4adbd8(0xff)]['max_per_unit']],_0x1045cc=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x16e)]],_0x19d905=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xa4)]],_0x12f28d=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x97)]],_0x2afd9c=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xf9)]],_0x56b185=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x147)]],_0x4b0004=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x8c)]],_0x4ba9d0=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x145)]],_0x543866=[..._0xa9700b['body']['prod_invoice']],_0xda66a8=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x163)]],_0x5515b3=[..._0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0x11d)]],_0x39133d=[..._0xa9700b[_0x4adbd8(0xff)]['id_transact']];const _0x2f94cc=_0x33595c['map'](_0x4e4ab8=>{return _0x4e4ab8={'product_name':_0x4e4ab8};});_0x35afc0[_0x4adbd8(0xf5)]((_0x512192,_0x2142bd)=>{var _0x400b02=_0x4adbd8;_0x2f94cc[_0x2142bd][_0x400b02(0xfa)]=Math['abs'](_0x512192);}),_0xda66a8[_0x4adbd8(0xf5)]((_0x4b2d3d,_0x196d28)=>{var _0x59d0f1=_0x4adbd8;_0x2f94cc[_0x196d28]['actual_qty']=Math[_0x59d0f1(0xed)](_0x4b2d3d);}),_0x5515b3[_0x4adbd8(0xf5)]((_0x411261,_0xc9107d)=>{_0x2f94cc[_0xc9107d]['actual_uom']=_0x411261;}),_0x39133d['forEach']((_0x1fbef6,_0x4db518)=>{var _0x2dca1d=_0x4adbd8;_0x2f94cc[_0x4db518][_0x2dca1d(0x15f)]=_0x1fbef6;}),_0x3e52fd[_0x4adbd8(0xf5)]((_0x3130d0,_0x8a1dd5)=>{var _0x2eef1b=_0x4adbd8;_0x2f94cc[_0x8a1dd5][_0x2eef1b(0x8c)]=_0x3130d0;}),_0x164332[_0x4adbd8(0xf5)]((_0xe04c69,_0x37c44a)=>{_0x2f94cc[_0x37c44a]['primary_code']=_0xe04c69;}),_0x3838f0['forEach']((_0x443a7b,_0x50ce60)=>{var _0x593570=_0x4adbd8;_0x2f94cc[_0x50ce60][_0x593570(0x177)]=_0x443a7b;}),_0x1b092f[_0x4adbd8(0xf5)]((_0x523b67,_0x585867)=>{var _0x4789c9=_0x4adbd8;_0x2f94cc[_0x585867][_0x4789c9(0xd3)]=_0x523b67;}),_0x4af44a[_0x4adbd8(0xf5)]((_0x8d4fcf,_0x48f884)=>{var _0x1143d8=_0x4adbd8;_0x4ba9d0[_0x1143d8(0xf5)]((_0x12d973,_0x17d056)=>{var _0x36d45d=_0x1143d8;if(_0x12d973==_0x36d45d(0x85)&&_0x48f884==_0x17d056){var _0x3306ef=_0x8d4fcf['slice'](0x3);_0x2f94cc[_0x48f884][_0x36d45d(0x15d)]=_0x8d4fcf[0x0],_0x2f94cc[_0x48f884][_0x36d45d(0x11b)]=_0x8d4fcf[0x1],_0x2f94cc[_0x48f884]['bay']=0x0,_0x2f94cc[_0x48f884][_0x36d45d(0xcb)]=0x0,_0x2f94cc[_0x48f884][_0x36d45d(0x128)]=_0x36d45d(0x130),_0x2f94cc[_0x48f884]['floorlevel']=_0x3306ef;}else{if(_0x12d973=='Shelves'&&_0x48f884==_0x17d056){var _0x3306ef=_0x8d4fcf[_0x36d45d(0xf6)](0x3);_0x2f94cc[_0x48f884][_0x36d45d(0x15d)]=_0x8d4fcf[0x0],_0x2f94cc[_0x48f884][_0x36d45d(0x11b)]=_0x8d4fcf[0x1],_0x2f94cc[_0x48f884][_0x36d45d(0x9a)]=0x0,_0x2f94cc[_0x48f884][_0x36d45d(0xcb)]=0x0,_0x2f94cc[_0x48f884]['type']='Floor',_0x2f94cc[_0x48f884][_0x36d45d(0xcc)]=_0x8d4fcf[0x5];}else{if(_0x48f884==_0x17d056){var _0x114279;if(_0x8d4fcf[0x4]=='L')_0x114279=_0x36d45d(0x10e);else _0x8d4fcf[0x4]=='F'&&(_0x114279=_0x36d45d(0x130));_0x2f94cc[_0x48f884]['storage']=_0x8d4fcf[0x0],_0x2f94cc[_0x48f884][_0x36d45d(0x11b)]=_0x8d4fcf[0x1],_0x2f94cc[_0x48f884]['bay']=_0x8d4fcf[0x2],_0x2f94cc[_0x48f884]['bin']=_0x8d4fcf[0x3],_0x2f94cc[_0x48f884]['type']=_0x114279,_0x2f94cc[_0x48f884][_0x36d45d(0xcc)]=_0x8d4fcf[0x5];}}}});}),_0x7bf09e[_0x4adbd8(0xf5)]((_0x570f9b,_0xe3b0b1)=>{var _0x34b43c=_0x4adbd8;_0x2f94cc[_0xe3b0b1][_0x34b43c(0x113)]=_0x570f9b;}),_0x23ca9e['forEach']((_0x1eb48f,_0x1a8183)=>{var _0x19e57a=_0x4adbd8;_0x2f94cc[_0x1a8183][_0x19e57a(0x18c)]=_0x1eb48f;}),_0x1d30a9[_0x4adbd8(0xf5)]((_0x43f270,_0x41d8bf)=>{var _0x378712=_0x4adbd8;_0x2f94cc[_0x41d8bf][_0x378712(0xaf)]=_0x43f270;}),_0x2fe485[_0x4adbd8(0xf5)]((_0x164901,_0x155d2c)=>{_0x2f94cc[_0x155d2c]['expiry_date']=_0x164901;}),_0x3e0e44[_0x4adbd8(0xf5)]((_0xf6b911,_0x5f21fe)=>{var _0x352fc3=_0x4adbd8;_0x2f94cc[_0x5f21fe][_0x352fc3(0x176)]=_0xf6b911;}),_0x1045cc[_0x4adbd8(0xf5)]((_0x3ada17,_0x517134)=>{var _0x24fe58=_0x4adbd8;_0x2f94cc[_0x517134][_0x24fe58(0x16e)]=_0x3ada17;}),_0x19d905[_0x4adbd8(0xf5)]((_0x7b8d0,_0x4d3ca5)=>{var _0x4a9d6e=_0x4adbd8;_0x2f94cc[_0x4d3ca5][_0x4a9d6e(0xa4)]=_0x7b8d0;}),_0x12f28d['forEach']((_0x11e488,_0x20e45b)=>{_0x2f94cc[_0x20e45b]['delivery_date']=_0x11e488;}),_0x2afd9c[_0x4adbd8(0xf5)]((_0x3d69ae,_0x32f848)=>{_0x2f94cc[_0x32f848]['delivery_code']=_0x3d69ae;}),_0x56b185['forEach']((_0x62b630,_0x1f6ae3)=>{var _0x395a74=_0x4adbd8;_0x2f94cc[_0x1f6ae3][_0x395a74(0x147)]=_0x62b630;}),_0x4b0004[_0x4adbd8(0xf5)]((_0x7619c2,_0x3e20a0)=>{var _0x1bd045=_0x4adbd8;_0x2f94cc[_0x3e20a0][_0x1bd045(0x112)]=_0x7619c2;}),_0x4ba9d0[_0x4adbd8(0xf5)]((_0x56b0b1,_0x4dc994)=>{_0x2f94cc[_0x4dc994]['room_name']=_0x56b0b1;}),_0x543866[_0x4adbd8(0xf5)]((_0x5483e5,_0x25ece2)=>{var _0x110786=_0x4adbd8;_0x2f94cc[_0x25ece2][_0x110786(0x148)]=_0x5483e5;});var _0x41e304=0x0;_0x2f94cc[_0x4adbd8(0xf5)](_0x58330e=>{var _0xcfc8c6=_0x4adbd8;(_0x58330e[_0xcfc8c6(0xfa)]<_0x58330e[_0xcfc8c6(0x112)]||_0x58330e['quantity_notConverted']==0x0)&&(console['log'](_0xcfc8c6(0x126),_0x58330e),_0x41e304++);});const _0x4301a8=_0x2f94cc[_0x4adbd8(0x143)](_0x21756f=>_0x21756f[_0x4adbd8(0x8c)]!=='0'&&_0x21756f[_0x4adbd8(0x8c)]!==''),_0x413ee1=new sales({'invoice':_0x311fc6,'customer':_0xa9700b[_0x4adbd8(0xff)][_0x4adbd8(0xaa)],'date':_0x2d93e7,'warehouse_name':_0x1c8012,'sale_product':_0x4301a8,'note':_0x5f30d9,'room':_0x3f8d64,'primary_code':_0xa87088,'secondary_code':_0x15f56f,'prod_code':_0x1c21be,'SCRN':_0x1fa0f1}),_0x2a5fa7=await _0x413ee1[_0x4adbd8(0x88)]();_0xa9700b[_0x4adbd8(0x12c)]('success',_0x4adbd8(0xb2)),_0xda53b5[_0x4adbd8(0x15e)]('/all_sales/preview/'+_0x2a5fa7[_0x4adbd8(0xce)]);}catch(_0x35d8f5){console['log'](_0x35d8f5);}}),router[a0_0x294f75(0xb3)]('/preview/:id',auth,async(_0xa58d02,_0x521b02)=>{var _0x14188f=a0_0x294f75;try{const {username:_0x355840,email:_0x29e147,role:_0xb3f591}=_0xa58d02[_0x14188f(0xa7)],_0x38a2ad=_0xa58d02[_0x14188f(0xa7)],_0x59c979=await profile[_0x14188f(0xe5)]({'email':_0x38a2ad[_0x14188f(0x14d)]}),_0xaa9d01=await master_shop[_0x14188f(0xfe)](),_0x48ef82=_0xa58d02[_0x14188f(0xee)]['id'],_0x38fe0c=await sales[_0x14188f(0xb5)](_0x48ef82),_0x1e46fb=await warehouse[_0x14188f(0x133)]([{'$match':{'name':_0x38fe0c[_0x14188f(0x165)]}},{'$unwind':_0x14188f(0x186)},{'$group':{'_id':_0x14188f(0xe6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x14188f(0x107)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x14188f(0x114)},'type':{'$first':_0x14188f(0xa2)},'floorlevel':{'$first':_0x14188f(0x125)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x14188f(0x138)},'storage':{'$first':_0x14188f(0xe7)},'rack':{'$first':_0x14188f(0xbf)},'expiry_date':{'$first':_0x14188f(0xd1)},'production_date':{'$first':_0x14188f(0x115)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x274a14=await customer[_0x14188f(0xfe)]({});let _0x199068;if(_0x38a2ad[_0x14188f(0x153)]==_0x14188f(0x121)){const _0x5c5f1b=await staff['findOne']({'email':_0x38a2ad[_0x14188f(0x14d)]});_0x199068=await warehouse[_0x14188f(0x133)]([{'$match':{'status':'Enabled','name':_0x5c5f1b[_0x14188f(0xc7)]}},{'$group':{'_id':_0x14188f(0x189),'name':{'$first':_0x14188f(0x189)}}}]);}else _0x199068=await warehouse[_0x14188f(0x133)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x14188f(0x189),'name':{'$first':_0x14188f(0x189)}}}]);const _0x3b21f0=await product[_0x14188f(0xfe)]({}),_0x5bfffc=await suppliers[_0x14188f(0xfe)]({});if(_0xaa9d01[0x0][_0x14188f(0x135)]=='English\x20(US)'){var _0x2fa5ff=users[_0x14188f(0xd8)];console['log'](_0x2fa5ff);}else{if(_0xaa9d01[0x0][_0x14188f(0x135)]=='Hindi')var _0x2fa5ff=users[_0x14188f(0x136)];else{if(_0xaa9d01[0x0][_0x14188f(0x135)]=='German')var _0x2fa5ff=users[_0x14188f(0xc5)];else{if(_0xaa9d01[0x0][_0x14188f(0x135)]==_0x14188f(0x83))var _0x2fa5ff=users[_0x14188f(0x83)];else{if(_0xaa9d01[0x0][_0x14188f(0x135)]=='French')var _0x2fa5ff=users[_0x14188f(0xba)];else{if(_0xaa9d01[0x0][_0x14188f(0x135)]==_0x14188f(0xd9))var _0x2fa5ff=users[_0x14188f(0x152)];else{if(_0xaa9d01[0x0][_0x14188f(0x135)]=='Chinese')var _0x2fa5ff=users[_0x14188f(0x109)];else{if(_0xaa9d01[0x0][_0x14188f(0x135)]==_0x14188f(0x17a))var _0x2fa5ff=users[_0x14188f(0xb9)];}}}}}}}_0x521b02['render'](_0x14188f(0xea),{'success':_0xa58d02['flash']('success'),'errors':_0xa58d02[_0x14188f(0x12c)](_0x14188f(0x168)),'role':_0x38a2ad,'profile':_0x59c979,'customer':_0x274a14,'warehouse':_0x199068,'product':_0x1e46fb,'user':_0x38fe0c,'master_shop':_0xaa9d01,'unit':_0x3b21f0,'language':_0x2fa5ff,'suppliers':_0x5bfffc});}catch(_0x2ff66){console[_0x14188f(0x8d)](_0x2ff66);}}),router['post'](a0_0x294f75(0x116),auth,async(_0x776663,_0x342e08)=>{var _0x988d71=a0_0x294f75;try{const _0x509821=_0x776663[_0x988d71(0xee)]['id'],{invoice:_0x89eb50,warehouse_name:_0x2109d6,room:_0x1625ff}=_0x776663[_0x988d71(0xff)],_0x3ca0a1=await sales[_0x988d71(0xe5)]({'invoice':_0x89eb50}),_0x2d1486=_0x3ca0a1[_0x988d71(0xd4)][_0x988d71(0x9e)](async _0x584459=>{var _0x329235=_0x988d71,_0x4ca628=await warehouse['findOne']({'name':_0x2109d6,'room':_0x584459['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x329ba7=_0x4ca628[_0x329235(0x164)]['map'](_0x4479b8=>{var _0x2ff81d=_0x329235;_0x4479b8[_0x2ff81d(0x15a)]==_0x584459[_0x2ff81d(0x15a)]&&_0x4479b8[_0x2ff81d(0xcc)]==_0x584459['floorlevel']&&_0x4479b8[_0x2ff81d(0x128)]==_0x584459[_0x2ff81d(0x128)]&&_0x4479b8[_0x2ff81d(0xcb)]==_0x584459[_0x2ff81d(0xcb)]&&_0x4479b8[_0x2ff81d(0x9a)]==_0x584459[_0x2ff81d(0x9a)]&&_0x4479b8['rack']==_0x584459[_0x2ff81d(0x11b)]&&_0x4479b8[_0x2ff81d(0x15d)]==_0x584459[_0x2ff81d(0x15d)]&&_0x4479b8[_0x2ff81d(0x18e)]==_0x584459[_0x2ff81d(0x18e)]&&_0x4479b8['batch_code']==_0x584459[_0x2ff81d(0xaf)]&&_0x4479b8['invoice']==_0x584459[_0x2ff81d(0x148)]&&_0x4479b8[_0x2ff81d(0xce)]==_0x584459[_0x2ff81d(0x15f)]&&(_0x4479b8[_0x2ff81d(0x103)]=Math['max'](0x0,Math['abs'](_0x4479b8['product_stock'])-Math[_0x2ff81d(0xed)](_0x584459['quantity'])));});return _0x4ca628;});Promise[_0x988d71(0xe9)](_0x2d1486)['then'](async _0x390107=>{var _0x2c7612=_0x988d71;try{for(const _0x3f5905 of _0x390107){await _0x3f5905[_0x2c7612(0x88)]();}_0x3ca0a1[_0x2c7612(0x127)]=_0x2c7612(0x90);const _0x3ed484=await _0x3ca0a1[_0x2c7612(0x88)](),_0x37de06=await master_shop[_0x2c7612(0xfe)](),_0x4bd323=await email_settings[_0x2c7612(0xe5)](),_0x57ad19=await supervisor_settings[_0x2c7612(0xfe)]();var _0x39b13c=_0x3ca0a1[_0x2c7612(0xd4)],_0x29f716='',_0xb0eeff;for(_0xb0eeff in _0x39b13c){_0x29f716+=_0x2c7612(0xb8)+_0x2c7612(0x13e)+_0x39b13c[_0xb0eeff]['product_name']+'</td>'+_0x2c7612(0x13e)+_0x39b13c[_0xb0eeff][_0x2c7612(0xd3)]+_0x2c7612(0x144)+_0x2c7612(0x13e)+_0x39b13c[_0xb0eeff][_0x2c7612(0x8c)]+_0x2c7612(0x144)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x39b13c[_0xb0eeff]['unit']+_0x2c7612(0x144)+_0x2c7612(0x13e)+_0x39b13c[_0xb0eeff]['secondary_unit']+_0x2c7612(0x144)+_0x2c7612(0x13e)+_0x3ca0a1[_0x2c7612(0x165)]+_0x2c7612(0x144)+_0x2c7612(0x13e)+_0x39b13c[_0xb0eeff][_0x2c7612(0xdc)]+_0x2c7612(0x144)+_0x2c7612(0x13e)+_0x39b13c[_0xb0eeff]['storage']+_0x39b13c[_0xb0eeff][_0x2c7612(0x11b)]+_0x39b13c[_0xb0eeff][_0x2c7612(0x9a)]+_0x39b13c[_0xb0eeff][_0x2c7612(0xcb)]+_0x39b13c[_0xb0eeff][_0x2c7612(0x128)][0x0]+_0x39b13c[_0xb0eeff]['floorlevel']+_0x2c7612(0x144),'</tr>';}let _0x28df27=nodemailer[_0x2c7612(0x117)]({'host':_0x4bd323[_0x2c7612(0xeb)],'port':Number(_0x4bd323[_0x2c7612(0xc1)]),'secure':![],'auth':{'user':_0x4bd323[_0x2c7612(0x14d)],'pass':_0x4bd323[_0x2c7612(0x10f)]}}),_0x49b28d={'from':_0x4bd323[_0x2c7612(0x14d)],'to':_0x57ad19[0x0][_0x2c7612(0x134)],'subject':_0x2c7612(0x12f),'attachments':[{'filename':_0x2c7612(0xde),'path':__dirname+'/../public'+_0x2c7612(0x159)+_0x37de06[0x0][_0x2c7612(0x17b)],'cid':_0x2c7612(0xfd)}],'html':_0x2c7612(0x170)+_0x2c7612(0xc6)+_0x2c7612(0xf2)+_0x2c7612(0x122)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x2c7612(0x155)+'</div>'+_0x2c7612(0x122)+_0x2c7612(0x132)+_0x37de06[0x0]['site_title']+_0x2c7612(0x100)+_0x2c7612(0xa1)+_0x2c7612(0xa1)+_0x2c7612(0xd7)+'<div>'+_0x2c7612(0xe8)+_0x2c7612(0xa9)+_0x3ca0a1['invoice']+'\x20'+_0x2c7612(0x11f)+_0x2c7612(0x10c)+_0x3ca0a1[_0x2c7612(0xc2)]+'\x20'+'</span>'+_0x2c7612(0x18b)+_0x2c7612(0xa1)+_0x2c7612(0x105)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2c7612(0xb8)+_0x2c7612(0xfc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x2c7612(0xbb)+_0x2c7612(0x169)+_0x2c7612(0x9d)+_0x2c7612(0xcd)+_0x2c7612(0x157)+_0x2c7612(0x140)+_0x2c7612(0x184)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x29f716+'\x20'+_0x2c7612(0xf4)+_0x2c7612(0xdb)+'<div>'+_0x2c7612(0x183)+_0x2c7612(0x123)+_0x37de06[0x0][_0x2c7612(0xc0)]+'</h5>'+_0x2c7612(0xa1)+_0x2c7612(0xa1)+_0x2c7612(0x86)};_0x28df27[_0x2c7612(0x15c)](_0x49b28d,function(_0x409d5b,_0x10b548){var _0x56567e=_0x2c7612;_0x409d5b?(console[_0x56567e(0x8d)](_0x409d5b),console['log']('Error\x20Occurs')):console[_0x56567e(0x8d)]('Email\x20sent\x20successfully');}),_0x776663[_0x2c7612(0x12c)](_0x2c7612(0x99),_0x2c7612(0x175)),_0x342e08['redirect']('/all_sales/preview/'+_0x509821);}catch(_0x5161dc){console['error'](_0x5161dc),_0x342e08[_0x2c7612(0x154)](0x1f4)[_0x2c7612(0x158)]({'error':_0x2c7612(0x92)});}})['catch'](_0x4a3573=>{var _0xb3746a=_0x988d71;console[_0xb3746a(0x108)](_0x4a3573),_0x342e08[_0xb3746a(0x154)](0x1f4)[_0xb3746a(0x158)]({'error':_0xb3746a(0x141)});});}catch(_0x3e7d61){console[_0x988d71(0x8d)](_0x3e7d61);}}),router[a0_0x294f75(0xb3)]('/view/:id',auth,async(_0x5bac6f,_0x23ac85)=>{var _0x5e2290=a0_0x294f75;try{const {username:_0x5d8919,email:_0x16e2d7,role:_0x37f382}=_0x5bac6f[_0x5e2290(0xa7)],_0x1b69cd=_0x5bac6f['user'],_0x417c25=await profile[_0x5e2290(0xe5)]({'email':_0x1b69cd[_0x5e2290(0x14d)]}),_0x37742d=await master_shop[_0x5e2290(0xfe)](),_0x393406=_0x5bac6f[_0x5e2290(0xee)]['id'],_0x27a7bd=await sales[_0x5e2290(0xb5)](_0x393406);var _0x14c9d9=[_0x5e2290(0x81),_0x5e2290(0xd0)];const _0xc7e026=await warehouse[_0x5e2290(0x133)]([{'$match':{'name':_0x27a7bd[_0x5e2290(0x165)],'warehouse_category':_0x5e2290(0xbc)}},{'$unwind':_0x5e2290(0x186)},{'$group':{'_id':_0x5e2290(0xe6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5e2290(0x107)},'bay':{'$first':_0x5e2290(0x192)},'bin':{'$first':_0x5e2290(0x114)},'type':{'$first':_0x5e2290(0xa2)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5e2290(0xbf)}}}]),_0x53e894=await customer[_0x5e2290(0xfe)]({});let _0x2b60d8;if(_0x1b69cd[_0x5e2290(0x153)]=='staff'){const _0x48b2f0=await staff[_0x5e2290(0xe5)]({'email':_0x1b69cd[_0x5e2290(0x14d)]});_0x2b60d8=await warehouse[_0x5e2290(0x133)]([{'$match':{'status':_0x5e2290(0x98),'name':_0x48b2f0[_0x5e2290(0xc7)],'warehouse_category':_0x5e2290(0xbc)}},{'$group':{'_id':_0x5e2290(0x189),'name':{'$first':_0x5e2290(0x189)}}}]);}else _0x2b60d8=await warehouse[_0x5e2290(0x133)]([{'$match':{'status':'Enabled','warehouse_category':_0x5e2290(0xbc)}},{'$group':{'_id':_0x5e2290(0x189),'name':{'$first':'$name'}}}]);const _0x237c0b=await product[_0x5e2290(0xfe)]({});if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0xe2)){var _0x507acb=users['English'];console[_0x5e2290(0x8d)](_0x507acb);}else{if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0x136))var _0x507acb=users[_0x5e2290(0x136)];else{if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0xc5))var _0x507acb=users['German'];else{if(_0x37742d[0x0][_0x5e2290(0x135)]=='Spanish')var _0x507acb=users[_0x5e2290(0x83)];else{if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0xba))var _0x507acb=users[_0x5e2290(0xba)];else{if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0xd9))var _0x507acb=users[_0x5e2290(0x152)];else{if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0x109))var _0x507acb=users[_0x5e2290(0x109)];else{if(_0x37742d[0x0][_0x5e2290(0x135)]==_0x5e2290(0x17a))var _0x507acb=users['Arabic'];}}}}}}}_0x23ac85[_0x5e2290(0x188)](_0x5e2290(0x18a),{'success':_0x5bac6f[_0x5e2290(0x12c)](_0x5e2290(0x99)),'errors':_0x5bac6f['flash']('errors'),'role':_0x1b69cd,'profile':_0x417c25,'customer':_0x53e894,'warehouse':_0x2b60d8,'product':_0xc7e026,'user':_0x27a7bd,'master_shop':_0x37742d,'unit':_0x237c0b,'language':_0x507acb});}catch(_0x383da6){console[_0x5e2290(0x8d)](_0x383da6);}}),router[a0_0x294f75(0x17d)](a0_0x294f75(0x95),auth,async(_0x470b4,_0x4a94f0)=>{var _0x3a466f=a0_0x294f75;try{const _0x50b99c=_0x470b4['params']['id'],_0x3d9cd0=await sales['findOne']({'_id':_0x470b4[_0x3a466f(0xee)]['id']}),_0x22c826=await warehouse[_0x3a466f(0xe5)]({'name':_0x3d9cd0[_0x3a466f(0x165)],'room':_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x15b)]}),{invoice:_0x42756b,date:_0x23d850,warehouse_name:_0x199c40,product_name:_0x4a3fa8,stock:_0x4024d8,quantity:_0x36a990,note:_0x58eed4,room:_0x227e8c,customer:_0x4bceea,SCRN:_0x34d7a3}=_0x470b4[_0x3a466f(0xff)];if(typeof _0x4a3fa8==_0x3a466f(0xe3))var _0x5dfc08=[_0x470b4[_0x3a466f(0xff)]['product_name']],_0x38c84f=[_0x470b4[_0x3a466f(0xff)]['stock']],_0x54d913=[_0x470b4[_0x3a466f(0xff)]['carton']],_0xcf7ea9=[_0x470b4['body'][_0x3a466f(0x17e)]],_0x424ed7=[_0x470b4['body'][_0x3a466f(0x177)]],_0x118fec=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x18f)]],_0x29783a=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x110)]],_0x2b4271=[_0x470b4[_0x3a466f(0xff)]['primary_unit']],_0x4a9a34=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x18c)]],_0x1a373b=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0xaf)]],_0x154250=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x18e)]],_0x2980bf=[_0x470b4[_0x3a466f(0xff)]['max_per_unit']],_0x1fe522=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x16e)]],_0x1e1add=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0xa4)]],_0x21b436=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x97)]],_0x3fb4f4=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0xf9)]],_0x28ff8a=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x147)]],_0x576330=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x8c)]],_0x450951=[_0x470b4[_0x3a466f(0xff)][_0x3a466f(0x145)]];else var _0x5dfc08=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x15a)]],_0x38c84f=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0xfa)]],_0x54d913=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x96)]],_0xcf7ea9=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x17e)]],_0x424ed7=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x177)]],_0x118fec=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x18f)]],_0x29783a=[..._0x470b4[_0x3a466f(0xff)]['level']],_0x2b4271=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0xef)]],_0x4a9a34=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x18c)]],_0x1a373b=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0xaf)]],_0x154250=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x18e)]],_0x2980bf=[..._0x470b4[_0x3a466f(0xff)]['max_per_unit']],_0x1fe522=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x16e)]],_0x1e1add=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0xa4)]],_0x21b436=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x97)]],_0x3fb4f4=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0xf9)]],_0x28ff8a=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x147)]],_0x576330=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x8c)]],_0x450951=[..._0x470b4[_0x3a466f(0xff)][_0x3a466f(0x145)]];const _0x447722=_0x5dfc08['map'](_0x337500=>{return _0x337500={'product_name':_0x337500};});_0x38c84f[_0x3a466f(0xf5)]((_0x37b7ff,_0x1deea5)=>{var _0x3ebb4d=_0x3a466f;_0x447722[_0x1deea5][_0x3ebb4d(0xfa)]=Math[_0x3ebb4d(0xed)](_0x37b7ff);}),_0x54d913[_0x3a466f(0xf5)]((_0x260918,_0x230b5c)=>{var _0x5cbce5=_0x3a466f;_0x447722[_0x230b5c][_0x5cbce5(0x8c)]=_0x260918;}),_0xcf7ea9[_0x3a466f(0xf5)]((_0x25f046,_0x29ac48)=>{var _0x173fba=_0x3a466f;_0x447722[_0x29ac48][_0x173fba(0x17e)]=_0x25f046;}),_0x424ed7[_0x3a466f(0xf5)]((_0xc04974,_0x11dbdd)=>{_0x447722[_0x11dbdd]['secondary_code']=_0xc04974;}),_0x118fec[_0x3a466f(0xf5)]((_0x23035c,_0x19a03e)=>{var _0x17ea3b=_0x3a466f;_0x447722[_0x19a03e][_0x17ea3b(0xd3)]=_0x23035c;}),_0x29783a[_0x3a466f(0xf5)]((_0x397d1c,_0x5123d1)=>{var _0x314a88=_0x3a466f;_0x450951[_0x314a88(0xf5)]((_0x14e620,_0xfd28f2)=>{var _0x5f3624=_0x314a88;if(_0x14e620==_0x5f3624(0x85)&&_0x5123d1==_0xfd28f2){var _0x472364=_0x397d1c[_0x5f3624(0xf6)](0x3);_0x447722[_0x5123d1][_0x5f3624(0x15d)]=_0x397d1c[0x0],_0x447722[_0x5123d1]['rack']=_0x397d1c[0x1],_0x447722[_0x5123d1]['bay']=0x0,_0x447722[_0x5123d1]['bin']=0x0,_0x447722[_0x5123d1]['type']=_0x5f3624(0x130),_0x447722[_0x5123d1]['floorlevel']=_0x472364;}else{if(_0x14e620==_0x5f3624(0xb7)&&_0x5123d1==_0xfd28f2){var _0x472364=_0x397d1c[_0x5f3624(0xf6)](0x3);_0x447722[_0x5123d1][_0x5f3624(0x15d)]=_0x397d1c[0x0],_0x447722[_0x5123d1][_0x5f3624(0x11b)]=_0x397d1c[0x1],_0x447722[_0x5123d1]['bay']=0x0,_0x447722[_0x5123d1][_0x5f3624(0xcb)]=0x0,_0x447722[_0x5123d1][_0x5f3624(0x128)]=_0x5f3624(0x130),_0x447722[_0x5123d1][_0x5f3624(0xcc)]=_0x397d1c[0x5];}else{if(_0x5123d1==_0xfd28f2){var _0x4ae598;if(_0x397d1c[0x4]=='L')_0x4ae598=_0x5f3624(0x10e);else _0x397d1c[0x4]=='F'&&(_0x4ae598=_0x5f3624(0x130));_0x447722[_0x5123d1]['storage']=_0x397d1c[0x0],_0x447722[_0x5123d1][_0x5f3624(0x11b)]=_0x397d1c[0x1],_0x447722[_0x5123d1]['bay']=_0x397d1c[0x2],_0x447722[_0x5123d1][_0x5f3624(0xcb)]=_0x397d1c[0x3],_0x447722[_0x5123d1]['type']=_0x4ae598,_0x447722[_0x5123d1][_0x5f3624(0xcc)]=_0x397d1c[0x5];}}}});}),_0x2b4271[_0x3a466f(0xf5)]((_0x422440,_0x13c0da)=>{var _0x5973f8=_0x3a466f;_0x447722[_0x13c0da][_0x5973f8(0x113)]=_0x422440;}),_0x4a9a34[_0x3a466f(0xf5)]((_0x2498ff,_0xb1dd63)=>{var _0x5f0709=_0x3a466f;_0x447722[_0xb1dd63][_0x5f0709(0x18c)]=_0x2498ff;}),_0x1a373b[_0x3a466f(0xf5)]((_0x15e834,_0x54314f)=>{var _0x16913e=_0x3a466f;_0x447722[_0x54314f][_0x16913e(0xaf)]=_0x15e834;}),_0x154250[_0x3a466f(0xf5)]((_0x33feb7,_0xb56fbf)=>{var _0x7309b7=_0x3a466f;_0x447722[_0xb56fbf][_0x7309b7(0x18e)]=_0x33feb7;}),_0x2980bf[_0x3a466f(0xf5)]((_0x2d4c51,_0x22247b)=>{var _0x3be4c9=_0x3a466f;_0x447722[_0x22247b][_0x3be4c9(0x176)]=_0x2d4c51;}),_0x1fe522[_0x3a466f(0xf5)]((_0x4fe9f8,_0x48cf61)=>{var _0x5225d7=_0x3a466f;_0x447722[_0x48cf61][_0x5225d7(0x16e)]=_0x4fe9f8;}),_0x1e1add['forEach']((_0xdb77d5,_0x324f74)=>{var _0xb579c5=_0x3a466f;_0x447722[_0x324f74][_0xb579c5(0xa4)]=Math['abs'](_0xdb77d5);}),_0x21b436[_0x3a466f(0xf5)]((_0x21636d,_0x18f4ae)=>{_0x447722[_0x18f4ae]['delivery_date']=_0x21636d;}),_0x3fb4f4['forEach']((_0x4b01e5,_0x43855a)=>{var _0x5d6cc7=_0x3a466f;_0x447722[_0x43855a][_0x5d6cc7(0xf9)]=_0x4b01e5;}),_0x28ff8a['forEach']((_0x31f5dd,_0x3bce6e)=>{_0x447722[_0x3bce6e]['prod_cat']=_0x31f5dd;}),_0x576330[_0x3a466f(0xf5)]((_0x1bbfcd,_0x2f5934)=>{_0x447722[_0x2f5934]['quantity_notConverted']=_0x1bbfcd;}),_0x450951[_0x3a466f(0xf5)]((_0x133218,_0x4f63aa)=>{var _0x2f1a0c=_0x3a466f;_0x447722[_0x4f63aa][_0x2f1a0c(0xdc)]=_0x133218;});var _0x1dc51f=0x0;_0x447722[_0x3a466f(0xf5)](_0xa2ddf9=>{var _0x85187b=_0x3a466f;console[_0x85187b(0x8d)](_0x85187b(0x126),_0xa2ddf9),(parseInt(_0xa2ddf9[_0x85187b(0xfa)])<parseInt(_0xa2ddf9[_0x85187b(0x8c)])||parseInt(_0xa2ddf9['quantity'])==0x0)&&_0x1dc51f++;});if(_0x1dc51f!=0x0)return _0x470b4[_0x3a466f(0x12c)](_0x3a466f(0x168),_0x3a466f(0x12a)),_0x4a94f0[_0x3a466f(0x15e)]('back');const _0x493471=_0x447722['filter'](_0x303ed1=>_0x303ed1[_0x3a466f(0x8c)]!=='0'&&_0x303ed1[_0x3a466f(0x8c)]!=='');_0x3d9cd0[_0x3a466f(0x148)]=_0x42756b,_0x3d9cd0[_0x3a466f(0xaa)]=_0x4bceea,_0x3d9cd0['date']=_0x23d850,_0x3d9cd0[_0x3a466f(0x165)]=_0x199c40,_0x3d9cd0[_0x3a466f(0xd4)]=_0x493471,_0x3d9cd0[_0x3a466f(0x94)]=_0x58eed4,_0x3d9cd0[_0x3a466f(0x11c)]=_0x34d7a3,_0x3d9cd0[_0x3a466f(0x127)]=_0x3a466f(0x80),_0x3d9cd0[_0x3a466f(0xc4)]=_0x3a466f(0x80);const _0x5116df=await _0x3d9cd0[_0x3a466f(0x88)]();_0x470b4['flash'](_0x3a466f(0x99),_0x3a466f(0x175)),_0x4a94f0[_0x3a466f(0x15e)](_0x3a466f(0x150));}catch(_0x21c5cd){console[_0x3a466f(0x8d)](_0x21c5cd);}}),router[a0_0x294f75(0x17d)]('/give_payment/:id',auth,async(_0x513a47,_0xe012c1)=>{var _0x48ec25=a0_0x294f75;try{const _0x48edb5=_0x513a47[_0x48ec25(0xee)]['id'],{invoice:_0x32ad2e,customer:_0xccf2e4,receivable_amount:_0x289e7c,received_amount:_0x246989}=_0x513a47['body'],_0x976cdd=await sales[_0x48ec25(0xb5)](_0x48edb5);console['log'](_0x976cdd);var _0x30876a=_0x289e7c-_0x246989;console['log'](_0x246989),_0x976cdd[_0x48ec25(0x12b)]=parseFloat(_0x246989)+parseFloat(_0x976cdd['received_amount']),_0x976cdd[_0x48ec25(0xbe)]=_0x30876a,console[_0x48ec25(0x8d)](_0x976cdd);const _0x590935=await _0x976cdd['save'](),_0x1cf515=await c_payment_data['findOne']({'invoice':_0x32ad2e});_0x1cf515[_0x48ec25(0x13d)]=_0x30876a,await _0x1cf515['save']();let _0x320d2d=new Date(),_0x589c42=('0'+_0x320d2d[_0x48ec25(0x14f)]())[_0x48ec25(0xf6)](-0x2),_0x5a3405=('0'+(_0x320d2d[_0x48ec25(0x11e)]()+0x1))[_0x48ec25(0xf6)](-0x2),_0x7a6b9=_0x320d2d[_0x48ec25(0x160)](),_0x50b7e5=_0x7a6b9+'-'+_0x5a3405+'-'+_0x589c42;const _0x26d434=new customer_payment({'invoice':_0x32ad2e,'date':_0x7a6b9+'-'+_0x5a3405+'-'+_0x589c42,'customer':_0xccf2e4,'reason':_0x48ec25(0x84),'amount':_0x246989}),_0x2efe7b=await _0x26d434[_0x48ec25(0x88)]();_0x513a47[_0x48ec25(0x12c)](_0x48ec25(0x99),_0x48ec25(0xb6)),_0xe012c1[_0x48ec25(0x15e)](_0x48ec25(0x150));}catch(_0x416800){console[_0x48ec25(0x8d)](_0x416800);}}),router[a0_0x294f75(0xb3)]('/invoice/:id',auth,async(_0x15678f,_0x87cebb)=>{var _0x1ed188=a0_0x294f75;try{const {username:_0x1813a6,email:_0xe5fe9b,role:_0x260416}=_0x15678f['user'],_0x37636a=_0x15678f[_0x1ed188(0xa7)],_0x32a2e1=await profile[_0x1ed188(0xe5)]({'email':_0x37636a['email']}),_0x985f3a=await master_shop[_0x1ed188(0xfe)]();console[_0x1ed188(0x8d)](_0x1ed188(0x12e),_0x985f3a);const _0x6edd7c=_0x15678f[_0x1ed188(0xee)]['id'],_0xddc53=await sales['findById'](_0x6edd7c);console['log'](_0xddc53);const _0x23e87d=await customer['findOne']({'name':_0xddc53[_0x1ed188(0xaa)]});console[_0x1ed188(0x8d)](_0x23e87d);if(_0x985f3a[0x0][_0x1ed188(0x135)]==_0x1ed188(0xe2)){var _0x20ff06=users['English'];console[_0x1ed188(0x8d)](_0x20ff06);}else{if(_0x985f3a[0x0][_0x1ed188(0x135)]=='Hindi')var _0x20ff06=users[_0x1ed188(0x136)];else{if(_0x985f3a[0x0][_0x1ed188(0x135)]=='German')var _0x20ff06=users[_0x1ed188(0xc5)];else{if(_0x985f3a[0x0][_0x1ed188(0x135)]==_0x1ed188(0x83))var _0x20ff06=users['Spanish'];else{if(_0x985f3a[0x0][_0x1ed188(0x135)]==_0x1ed188(0xba))var _0x20ff06=users['French'];else{if(_0x985f3a[0x0][_0x1ed188(0x135)]==_0x1ed188(0xd9))var _0x20ff06=users['Portuguese'];else{if(_0x985f3a[0x0][_0x1ed188(0x135)]=='Chinese')var _0x20ff06=users[_0x1ed188(0x109)];else{if(_0x985f3a[0x0][_0x1ed188(0x135)]==_0x1ed188(0x17a))var _0x20ff06=users[_0x1ed188(0xb9)];}}}}}}}_0x87cebb[_0x1ed188(0x188)](_0x1ed188(0x180),{'success':_0x15678f['flash']('success'),'errors':_0x15678f[_0x1ed188(0x12c)]('errors'),'role':_0x37636a,'profile':_0x32a2e1,'master_shop':_0x985f3a,'customers':_0x23e87d,'sales':_0xddc53,'language':_0x20ff06});}catch(_0x27ea68){console[_0x1ed188(0x8d)](_0x27ea68);}}),router[a0_0x294f75(0xb3)](a0_0x294f75(0xb4),auth,async(_0x367068,_0x3da48e)=>{var _0x41e8cb=a0_0x294f75;try{const {username:_0xb3a2f3,email:_0x5b39ea,role:_0x9e891}=_0x367068[_0x41e8cb(0xa7)],_0x50f0a3=_0x367068[_0x41e8cb(0xa7)],_0x1ade37=await profile[_0x41e8cb(0xe5)]({'email':_0x50f0a3[_0x41e8cb(0x14d)]}),_0xe00f15=await master_shop[_0x41e8cb(0xfe)]();console[_0x41e8cb(0x8d)](_0x41e8cb(0x12e),_0xe00f15);const _0x4b7274=_0x367068[_0x41e8cb(0xee)]['id'];console['log'](_0x4b7274);const _0x4edee3=await sales['findById'](_0x4b7274);console[_0x41e8cb(0x8d)](_0x41e8cb(0x16c),_0x4edee3);const _0x3d9b2a=await warehouse[_0x41e8cb(0x133)]([{'$match':{'name':'Return\x20Goods','room':_0x41e8cb(0xd5)}},{'$unwind':_0x41e8cb(0x186)},{'$group':{'_id':_0x41e8cb(0xe6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x41e8cb(0x107)},'level':{'$first':_0x41e8cb(0xc3)},'isle':{'$first':_0x41e8cb(0x193)},'pallet':{'$first':_0x41e8cb(0x93)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x41e8cb(0x171)},'product_code':{'$first':_0x41e8cb(0x138)}}}]);console[_0x41e8cb(0x8d)](_0x41e8cb(0x11a),_0x3d9b2a);const _0x1b1dc8=await product['find']({});warehouse_data=await warehouse[_0x41e8cb(0x133)]([{'$match':{'status':_0x41e8cb(0x98),'name':'Return\x20Goods','warehouse_category':_0x41e8cb(0xbc)}},{'$group':{'_id':_0x41e8cb(0x189),'name':{'$first':_0x41e8cb(0x189)}}},{'$sort':{'name':0x1}}]);var _0x41e2df=[_0x41e8cb(0xd5)];if(_0xe00f15[0x0][_0x41e8cb(0x135)]==_0x41e8cb(0xe2)){var _0x2206d2=users[_0x41e8cb(0xd8)];console[_0x41e8cb(0x8d)](_0x2206d2);}else{if(_0xe00f15[0x0][_0x41e8cb(0x135)]=='Hindi')var _0x2206d2=users[_0x41e8cb(0x136)];else{if(_0xe00f15[0x0]['language']=='German')var _0x2206d2=users['German'];else{if(_0xe00f15[0x0][_0x41e8cb(0x135)]==_0x41e8cb(0x83))var _0x2206d2=users[_0x41e8cb(0x83)];else{if(_0xe00f15[0x0][_0x41e8cb(0x135)]==_0x41e8cb(0xba))var _0x2206d2=users[_0x41e8cb(0xba)];else{if(_0xe00f15[0x0]['language']==_0x41e8cb(0xd9))var _0x2206d2=users[_0x41e8cb(0x152)];else{if(_0xe00f15[0x0]['language']==_0x41e8cb(0x109))var _0x2206d2=users['Chinese'];else{if(_0xe00f15[0x0][_0x41e8cb(0x135)]==_0x41e8cb(0x17a))var _0x2206d2=users[_0x41e8cb(0xb9)];}}}}}}}_0x3da48e[_0x41e8cb(0x188)](_0x41e8cb(0xad),{'success':_0x367068['flash']('success'),'errors':_0x367068['flash'](_0x41e8cb(0x168)),'role':_0x50f0a3,'profile':_0x1ade37,'user':_0x4edee3,'stock':_0x3d9b2a,'master_shop':_0xe00f15,'unit':_0x1b1dc8,'language':_0x2206d2,'warehouses':warehouse_data,'rooms':_0x41e2df});}catch(_0x3c924f){console['log'](_0x3c924f),_0x3da48e[_0x41e8cb(0x154)](0xc8)[_0x41e8cb(0x158)]({'message':_0x3c924f[_0x41e8cb(0x104)]});}}),router[a0_0x294f75(0x17d)](a0_0x294f75(0xb4),auth,async(_0x4ad78a,_0x2f1107)=>{var _0x1493cf=a0_0x294f75;try{const {invoice:_0x16f687,date:_0x375f02,warehouse_name:_0x3ca0ba,product_name:_0x55e587,primary_code:_0x4b48f6,secondary_code:_0x56cab4,product_code:_0x590795,sales_quantity:_0x31c489,stocks:_0x335327,return_qty:_0x269bd7,Room_name:_0x67f505,to_warehouse_name:_0x406b2c,to_Roomname:_0x5b323c,to_Room_name:_0x3f7a74,note:_0x5c2be0,level:_0x403b8e,isle:_0xbe1c7,pallet:_0x364164}=_0x4ad78a['body'];if(typeof _0x55e587=='string')var _0x3247ca=[_0x4ad78a[_0x1493cf(0xff)]['product_name']],_0x2aeb3c=[_0x4ad78a['body'][_0x1493cf(0x17e)]],_0x3c2455=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x177)]],_0x36431c=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0xd3)]],_0x7a6141=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x131)]],_0x25f47c=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x16d)]],_0x1fbce4=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0xdd)]],_0x1d027c=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x9a)]],_0xa8ad2d=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0xcb)]],_0x4c2bb2=[_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x8e)]],_0x7e7932=[_0x4ad78a['body'][_0x1493cf(0xcc)]];else var _0x3247ca=[..._0x4ad78a[_0x1493cf(0xff)]['product_name']],_0x2aeb3c=[..._0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x17e)]],_0x3c2455=[..._0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x177)]],_0x36431c=[..._0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0xd3)]],_0x7a6141=[..._0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x131)]],_0x25f47c=[..._0x4ad78a['body'][_0x1493cf(0x16d)]],_0x1fbce4=[..._0x4ad78a[_0x1493cf(0xff)]['return_qty']],_0x1d027c=[..._0x4ad78a['body'][_0x1493cf(0x9a)]],_0xa8ad2d=[..._0x4ad78a['body'][_0x1493cf(0xcb)]],_0x4c2bb2=[..._0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0x8e)]],_0x7e7932=[..._0x4ad78a['body']['floorlevel']];const _0x5da0dd=_0x3247ca[_0x1493cf(0x9e)](_0x556192=>{return _0x556192={'product_name':_0x556192};});_0x2aeb3c[_0x1493cf(0xf5)]((_0x43d51c,_0xc3d8ea)=>{var _0xbca811=_0x1493cf;_0x5da0dd[_0xc3d8ea][_0xbca811(0x17e)]=_0x43d51c;}),_0x3c2455['forEach']((_0x30ef23,_0x5328b8)=>{var _0x493a1a=_0x1493cf;_0x5da0dd[_0x5328b8][_0x493a1a(0x177)]=_0x30ef23;}),_0x36431c['forEach']((_0xb8050c,_0x235ee3)=>{_0x5da0dd[_0x235ee3]['product_code']=_0xb8050c;}),_0x7a6141[_0x1493cf(0xf5)]((_0x349b5e,_0x16cba6)=>{var _0x3d723b=_0x1493cf;_0x5da0dd[_0x16cba6][_0x3d723b(0x111)]=_0x349b5e;}),_0x25f47c['forEach']((_0xdc760b,_0x24095f)=>{var _0x197153=_0x1493cf;_0x5da0dd[_0x24095f][_0x197153(0xfa)]=_0xdc760b;}),_0x1fbce4['forEach']((_0x495707,_0xee02ff)=>{var _0x3ded14=_0x1493cf;_0x5da0dd[_0xee02ff][_0x3ded14(0xdd)]=_0x495707;}),_0x1d027c[_0x1493cf(0xf5)]((_0x5c4a0d,_0x516d05)=>{var _0x1ade39=_0x1493cf;_0x5da0dd[_0x516d05][_0x1ade39(0x9a)]=_0x5c4a0d;}),_0xa8ad2d[_0x1493cf(0xf5)]((_0x2f2bef,_0xf4f0d0)=>{_0x5da0dd[_0xf4f0d0]['bin']=_0x2f2bef;}),_0x4c2bb2[_0x1493cf(0xf5)]((_0x4c14ba,_0x358f76)=>{var _0xb18e26=_0x1493cf;_0x5da0dd[_0x358f76][_0xb18e26(0x128)]=_0x4c14ba;}),_0x7e7932['forEach']((_0x59f202,_0xb6567d)=>{var _0x2e12dc=_0x1493cf;_0x5da0dd[_0xb6567d][_0x2e12dc(0xcc)]=_0x59f202;});var _0xb4fbff=0x0;_0x5da0dd[_0x1493cf(0xf5)](_0x3a5fba=>{var _0x3ad854=_0x1493cf;console['log']('foreach\x20newproduct',_0x3a5fba),(parseInt(_0x3a5fba[_0x3ad854(0x111)])<parseInt(_0x3a5fba[_0x3ad854(0xdd)])||parseInt(_0x3a5fba['stock'])<parseInt(_0x3a5fba['return_qty'])&&parseInt(_0x3a5fba['sale_qty'])>parseInt(_0x3a5fba[_0x3ad854(0xdd)])||parseInt(_0x3a5fba[_0x3ad854(0xdd)])==0x0)&&_0xb4fbff++;});if(_0xb4fbff!=0x0)return _0x4ad78a[_0x1493cf(0x12c)](_0x1493cf(0x168),_0x1493cf(0xe1)),_0x2f1107[_0x1493cf(0x15e)]('back');const _0x3cb4b5=await sales[_0x1493cf(0xe5)]({'invoice':_0x16f687});console['log'](_0x3cb4b5),_0x3cb4b5['return_data']=_0x1493cf(0x90);const _0x266310=await _0x3cb4b5[_0x1493cf(0x88)](),_0x4f7709=new sales_return({'invoice':_0x16f687,'customer':_0x4ad78a[_0x1493cf(0xff)]['customer'],'date':_0x375f02,'warehouse_name':_0x3ca0ba,'room':_0x67f505,'ToWarehouse':_0x406b2c,'ToRoom':_0x3f7a74,'return_sale':_0x5da0dd,'note':_0x5c2be0}),_0x48f0e8=await _0x4f7709['save']();console[_0x1493cf(0x8d)](_0x4f7709);const _0x5118f4=await sales_return[_0x1493cf(0xe5)]({'invoice':_0x16f687}),_0x40f845=await warehouse[_0x1493cf(0xe5)]({'name':_0x406b2c,'room':_0x3f7a74});_0x5118f4['return_sale'][_0x1493cf(0xf5)](_0x562c70=>{var _0x182ff2=_0x1493cf,_0x54a5d0=0x0;const _0x486f2a=_0x40f845[_0x182ff2(0x164)][_0x182ff2(0x9e)](_0xca1ca1=>{var _0x30f32f=_0x182ff2;_0xca1ca1['product_name']==_0x562c70[_0x30f32f(0x15a)]&&_0xca1ca1[_0x30f32f(0xcc)]==_0x562c70[_0x30f32f(0xcc)]&&_0xca1ca1[_0x30f32f(0x128)]==_0x562c70[_0x30f32f(0x128)]&&_0xca1ca1[_0x30f32f(0xcb)]==_0x562c70[_0x30f32f(0xcb)]&&_0xca1ca1['bay']==_0x562c70[_0x30f32f(0x9a)]&&(_0xca1ca1[_0x30f32f(0x103)]=parseInt(_0xca1ca1[_0x30f32f(0x103)])+parseInt(_0x562c70['return_qty']),_0x54a5d0++);});_0x54a5d0=='0'&&(_0x40f845['product_details']=_0x40f845['product_details'][_0x182ff2(0x16a)]({'product_name':_0x562c70['product_name'],'product_stock':_0x562c70[_0x182ff2(0xdd)],'primary_code':_0x562c70[_0x182ff2(0x17e)],'secondary_code':_0x562c70[_0x182ff2(0x177)],'product_code':_0x562c70[_0x182ff2(0xd3)],'bay':_0x562c70[_0x182ff2(0x9a)],'bin':_0x562c70['bin'],'type':_0x562c70[_0x182ff2(0x128)],'floorlevel':_0x562c70['floorlevel']})),console['log'](_0x182ff2(0x139),_0x40f845);}),await _0x40f845[_0x1493cf(0x88)](),console[_0x1493cf(0x8d)](_0x4ad78a[_0x1493cf(0xff)]);const _0xe83e69=new c_payment_data({'invoice':_0x16f687,'customer':_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0xaa)],'reason':'Sale\x20Return'});await _0xe83e69[_0x1493cf(0x88)]();const _0x477bfc=await master_shop[_0x1493cf(0xfe)]();console[_0x1493cf(0x8d)](_0x1493cf(0xd6),_0x477bfc[0x0][_0x1493cf(0x17b)]);const _0x463031=await email_settings[_0x1493cf(0xe5)](),_0x202b5b=await customer['findOne']({'name':_0x4ad78a[_0x1493cf(0xff)][_0x1493cf(0xaa)]});console['log'](_0x1493cf(0x13a),_0x202b5b);_0x477bfc[0x0]['currency_placement']==0x1?(right_currency=_0x477bfc[0x0][_0x1493cf(0x13b)],left_currency=''):(right_currency='',left_currency=_0x477bfc[0x0][_0x1493cf(0x13b)]);var _0x5739f6=_0x3247ca,_0x21108b=_0x1fbce4,_0x41cb5d='',_0x2c7a2e;for(_0x2c7a2e in _0x5739f6){_0x41cb5d+=_0x1493cf(0xb8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5739f6[_0x2c7a2e]+_0x1493cf(0x144)+_0x1493cf(0x13e)+_0x21108b[_0x2c7a2e]+_0x1493cf(0x144)+_0x1493cf(0x140);}console[_0x1493cf(0x8d)](_0x1493cf(0x87),_0x41cb5d);let _0x543852=nodemailer[_0x1493cf(0x117)]({'service':_0x1493cf(0x194),'auth':{'user':_0x463031['email'],'pass':_0x463031[_0x1493cf(0x10f)]}}),_0x16923a={'from':_0x463031[_0x1493cf(0x14d)],'to':_0x202b5b[_0x1493cf(0x14d)],'subject':_0x1493cf(0x12d),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1493cf(0xa0)+_0x1493cf(0x159)+_0x477bfc[0x0][_0x1493cf(0x17b)],'cid':_0x1493cf(0xfd)}],'html':_0x1493cf(0x170)+_0x1493cf(0xc6)+'</head><body>'+_0x1493cf(0x122)+_0x1493cf(0x191)+_0x1493cf(0x122)+_0x1493cf(0x155)+'</div>'+_0x1493cf(0x122)+_0x1493cf(0x132)+_0x477bfc[0x0][_0x1493cf(0xc0)]+_0x1493cf(0x100)+_0x1493cf(0xa1)+_0x1493cf(0xa1)+_0x1493cf(0xd7)+_0x1493cf(0x122)+_0x1493cf(0xe8)+_0x1493cf(0xa9)+_0x16f687+'\x20'+_0x1493cf(0x11f)+_0x1493cf(0x10c)+_0x375f02+'\x20'+_0x1493cf(0xfb)+_0x1493cf(0x18b)+'</div>'+_0x1493cf(0x105)+_0x1493cf(0x16b)+_0x1493cf(0xb8)+_0x1493cf(0xfc)+_0x1493cf(0xf1)+_0x1493cf(0x82)+_0x1493cf(0x14b)+_0x1493cf(0x140)+'</thead>'+_0x1493cf(0x9f)+'\x20'+_0x41cb5d+'\x20'+_0x1493cf(0xf4)+'</table>'+_0x1493cf(0x122)+'<strong>\x20Regards\x20</strong>'+_0x1493cf(0x123)+_0x477bfc[0x0][_0x1493cf(0xc0)]+_0x1493cf(0x18b)+_0x1493cf(0xa1)+'</div>'+_0x1493cf(0x86)};_0x543852[_0x1493cf(0x15c)](_0x16923a,function(_0x5a0c2b,_0x2991ca){var _0x5f466d=_0x1493cf;_0x5a0c2b?(console['log'](_0x5a0c2b),console[_0x5f466d(0x8d)](_0x5f466d(0xac))):console[_0x5f466d(0x8d)](_0x5f466d(0xe4));}),_0x4ad78a[_0x1493cf(0x12c)](_0x1493cf(0x99),_0x1493cf(0x16f)),_0x2f1107[_0x1493cf(0x15e)](_0x1493cf(0x150));}catch(_0x3b26ff){console[_0x1493cf(0x8d)](_0x3b26ff),_0x2f1107[_0x1493cf(0x154)](0xc8)[_0x1493cf(0x158)]({'message1':_0x3b26ff[_0x1493cf(0x104)]});}}),router[a0_0x294f75(0xb3)](a0_0x294f75(0xa6),auth,async(_0x39b401,_0x160627)=>{var _0x1b1981=a0_0x294f75;try{const {username:_0x2e4dcb,email:_0x18d6f4,role:_0xa4f576}=_0x39b401[_0x1b1981(0xa7)],_0x28f842=_0x39b401[_0x1b1981(0xa7)],_0x28274a=await profile[_0x1b1981(0xe5)]({'email':_0x28f842[_0x1b1981(0x14d)]}),_0x4170de=await master_shop[_0x1b1981(0xfe)]();console[_0x1b1981(0x8d)](_0x1b1981(0x178),_0x4170de);const _0x2c863a=_0x39b401[_0x1b1981(0xee)]['id'],_0xcab908=await sales[_0x1b1981(0xb5)](_0x2c863a);console[_0x1b1981(0x8d)](_0x1b1981(0x9b),_0xcab908);if(_0x4170de[0x0][_0x1b1981(0x135)]=='English\x20(US)')var _0x27134e=users['English'];else{if(_0x4170de[0x0]['language']==_0x1b1981(0x136))var _0x27134e=users[_0x1b1981(0x136)];else{if(_0x4170de[0x0]['language']==_0x1b1981(0xc5))var _0x27134e=users[_0x1b1981(0xc5)];else{if(_0x4170de[0x0]['language']=='Spanish')var _0x27134e=users[_0x1b1981(0x83)];else{if(_0x4170de[0x0][_0x1b1981(0x135)]==_0x1b1981(0xba))var _0x27134e=users[_0x1b1981(0xba)];else{if(_0x4170de[0x0][_0x1b1981(0x135)]==_0x1b1981(0xd9))var _0x27134e=users[_0x1b1981(0x152)];else{if(_0x4170de[0x0][_0x1b1981(0x135)]==_0x1b1981(0x109))var _0x27134e=users[_0x1b1981(0x109)];else{if(_0x4170de[0x0][_0x1b1981(0x135)]==_0x1b1981(0x17a))var _0x27134e=users[_0x1b1981(0xb9)];}}}}}}}_0x160627[_0x1b1981(0x188)]('all_sales_barcode',{'success':_0x39b401[_0x1b1981(0x12c)](_0x1b1981(0x99)),'errors':_0x39b401['flash'](_0x1b1981(0x168)),'role':_0x28f842,'profile':_0x28274a,'alldata':_0xcab908,'master_shop':_0x4170de,'language':_0x27134e});}catch(_0x3eb06c){console['log'](_0x3eb06c);}}),router['post'](a0_0x294f75(0x8a),async(_0x5ac4ca,_0x2ae0b2)=>{var _0x33c982=a0_0x294f75;const {product_code:_0x204b29,warehouse_name:_0x2ea24a,rooms_data:_0x466bb8,Roomslist:_0x25b6f3}=_0x5ac4ca[_0x33c982(0xff)],_0x218c2f=_0x25b6f3[_0x33c982(0x89)](','),_0x7c9ad9=[];async function _0x4da1d8(_0x484202){var _0x31f843=_0x33c982;const _0x24b849=await warehouse[_0x31f843(0x133)]([{'$match':{'name':_0x2ea24a,'room':_0x484202}},{'$unwind':_0x31f843(0x186)},{'$match':{'product_details.primary_code':_0x204b29}},{'$group':{'_id':_0x31f843(0xe6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x31f843(0x107)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x31f843(0x171)},'product_code':{'$first':_0x31f843(0x138)},'level':{'$first':_0x31f843(0x192)},'isle':{'$first':_0x31f843(0x114)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x31f843(0x125)},'unit':{'$first':_0x31f843(0x8f)},'secondary_unit':{'$first':_0x31f843(0xe0)},'storage':{'$first':_0x31f843(0xe7)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x31f843(0xd1)},'production_date':{'$first':_0x31f843(0x115)},'maxPerUnit':{'$first':_0x31f843(0x162)},'batch_code':{'$first':_0x31f843(0xca)},'product_cat':{'$first':_0x31f843(0x179)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x31f843(0x172)}}}]),_0xd2a555=await warehouse['aggregate']([{'$match':{'name':_0x2ea24a,'room':_0x484202}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x204b29}},{'$group':{'_id':_0x31f843(0xe6),'name':{'$first':_0x31f843(0x120)},'product_stock':{'$first':_0x31f843(0x107)},'primary_code':{'$first':_0x31f843(0x9c)},'secondary_code':{'$first':_0x31f843(0x171)},'product_code':{'$first':_0x31f843(0x138)},'level':{'$first':_0x31f843(0x192)},'isle':{'$first':_0x31f843(0x114)},'type':{'$first':_0x31f843(0xa2)},'pallet':{'$first':_0x31f843(0x125)},'unit':{'$first':_0x31f843(0x8f)},'secondary_unit':{'$first':_0x31f843(0xe0)},'storage':{'$first':_0x31f843(0xe7)},'rack':{'$first':_0x31f843(0xbf)},'expiry_date':{'$first':_0x31f843(0xd1)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x31f843(0xca)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x24b849[_0x31f843(0x17f)]>0x0)_0x7c9ad9[_0x31f843(0x173)](_0x24b849);else _0xd2a555['length']>0x0&&_0x7c9ad9[_0x31f843(0x173)](_0xd2a555);}const _0x119d35=_0x218c2f[_0x33c982(0x9e)](_0x3eedd8=>_0x4da1d8(_0x3eedd8));await Promise[_0x33c982(0xe9)](_0x119d35),_0x2ae0b2[_0x33c982(0x158)](_0x7c9ad9);}),module[a0_0x294f75(0xb0)]=router;