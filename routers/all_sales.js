var a0_0x28d369=a0_0x7e76;function a0_0x5c90(){var _0x508082=['production_date','status','<hr\x20class=\x22my-3\x22>','Return\x20Rooms','</table>','$product_details.invoice','</body></html>','283014YLntAt','error','master','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','4482477ebWzzB','/view/add_sales/:id','getDate','$product_details.rack','$product_details.secondary_unit','primary_code','$return_data','max','</thead>','aggregate','abs','product_list','French','RoomAssigned','warehouse','padStart','success','Enabled','$product_details.pallet','<tbody\x20style=\x22text-align:\x20center;\x22>','id_transact','log','all_sales_barcode','sales_quantity','An\x20error\x20occurred.','Arabic\x20(ae)','</span>','$product_details.storage','_id','<!DOCTYPE\x20html>','$product','all','customers_docs','customer_data','$sale_product.bin','sales\x20item\x20return\x20successfull','$product_details.primary_code','SCRN','staff','toString','Received\x20Payment\x20For\x20Sale','email','carton','secondary_unit','$product_details.bin','delivery_date','Email\x20sent\x20successfully','/view/return_sales/:id','$sale_product','$room','Chinese','product_details','message','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','secondary_code','nodemailer','catch','Level','$product_details.product_name','product','final','<tr>','Sales\x20Add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_invoice','unit','body','RMSEmail','/give_payment/:id','338rzkhXo','19987308sMTbGq','customer','prod_code','rack','<span\x20style=\x22float:\x20right;\x22>','batch_code','$date','Shelves','$customers_docs','note','$product_details.batch_code','$note','get','$product_details.product_stock','$product_details.bay','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','English\x20(US)','Portuguese','$sale_product.type','</td>','$product_details.actual_uom','True','../middleware/auth','json','$customer','back','</h5>','Ambient','render','customers','flash','Return\x20Goods','Sales\x20Update\x20successfully','/invoice/:id','product_code','stock_data','$product_details.expiry_date','</tr>','slice','\x20</h2>','$product.product_name','../models/all_models','Sales\x20Mail','Sale\x20Return','findById','findOne','</div>','5074fMFhHN','warehouse_name','floor','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','/all_sales/view','gmail','push','/barcode/:id','primary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','invoice','$product_details.product_code','bin','<h2>\x20','requested_qty','/view/add_sale/product','An\x20error\x20occurred\x20while\x20saving\x20data.','../public/language/languages.json','post','quantity_notConverted','forEach','$product_details.floorlevel','$product_details.type','$product_details.isle','/barcode_scanner','received_amount','Portuguese\x20(BR)','map','redirect','\x20Order\x20Date\x20:\x20','/view','barcode\x20user_id','find','$product_details.product_cat','date','sale_product','prod_cat','host','split','string','getFullYear','delivery_code','room_name','$isAllowEdit','Hindi','bay','$sale_product.quantity','quantity','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Floor','site_title','<html><head><title></title>','$product_details.level','Router','Arabic','</tbody>','Receiving\x20Area','expiry_date','all_sales','/preview/:id','Logo.png','$invoice','product_name','7516360JTGnxu','name','$sale_product.floorlevel','actual_qty','21TKutTZ','edit_sales_view','floorlevel','$product_details.actual_qty','storage','<table\x20style=\x22width:\x20100%\x20!important;\x22>','save','<h5\x20style=\x22text-align:\x20left;\x22>','stocks','level','189984gBaJHg','password','Sale\x20Return\x20Mail','return_data','sale_qty','actual_uom','/../public','params','$_id','$product_details.maxPerUnit','currency','max_per_unit','$product_details._id','types','1775776QfrHoe','OUT-','purchases_data','English','room','$product_details.production_date','/all_sales/preview/','German','exports','filter','finalize','Error\x20Occurs','\x20Order\x20Number\x20:\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Raw\x20Materials','False','/upload/','product_stock','image','user','$name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','type','return_sale','$product_details','$sale_product.bay','errors','<div>','language','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','sales\x20all_data','$warehouse_name','$product_details.secondary_code','stock','foreach\x20newproduct','Enclosed','sales_invoice','/view/:id','length','then','return_qty','maxperunit','</head><body>','Spanish','/view/add_sales'];a0_0x5c90=function(){return _0x508082;};return a0_0x5c90();}(function(_0x4ba58e,_0x4ccb50){var _0x5b6bcb=a0_0x7e76,_0x47c14d=_0x4ba58e();while(!![]){try{var _0x2a9b62=-parseInt(_0x5b6bcb(0x274))/0x1*(parseInt(_0x5b6bcb(0x244))/0x2)+-parseInt(_0x5b6bcb(0x1fe))/0x3+-parseInt(_0x5b6bcb(0x1c5))/0x4+parseInt(_0x5b6bcb(0x1a9))/0x5+parseInt(_0x5b6bcb(0x1f9))/0x6+-parseInt(_0x5b6bcb(0x1ad))/0x7*(parseInt(_0x5b6bcb(0x1b7))/0x8)+parseInt(_0x5b6bcb(0x245))/0x9;if(_0x2a9b62===_0x4ccb50)break;else _0x47c14d['push'](_0x47c14d['shift']());}catch(_0x4d895e){_0x47c14d['push'](_0x47c14d['shift']());}}}(a0_0x5c90,0xdccd0));function a0_0x7e76(_0x5815c5,_0x39a6e9){var _0x5c905e=a0_0x5c90();return a0_0x7e76=function(_0x7e76e7,_0x43aa88){_0x7e76e7=_0x7e76e7-0x187;var _0x58aefd=_0x5c905e[_0x7e76e7];return _0x58aefd;},a0_0x7e76(_0x5815c5,_0x39a6e9);}const express=require('express'),app=express(),router=express[a0_0x28d369(0x19f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x28d369(0x26e)),auth=require(a0_0x28d369(0x25b)),nodemailer=require(a0_0x28d369(0x236)),users=require(a0_0x28d369(0x285));router[a0_0x28d369(0x251)](a0_0x28d369(0x187),auth,async(_0x2dd105,_0xbc6916)=>{var _0x185972=a0_0x28d369;try{const {username:_0x50ffef,email:_0x152391,role:_0x31b3f7}=_0x2dd105[_0x185972(0x1d8)],_0x3a4ce1=_0x2dd105[_0x185972(0x1d8)],_0x2979dd=await profile[_0x185972(0x272)]({'email':_0x3a4ce1['email']}),_0xc3cc7c=await master_shop['find']();let _0x225178;if(_0x3a4ce1[_0x185972(0x233)]==_0x185972(0x224)){const _0x5af758=await staff['findOne']({'email':_0x3a4ce1[_0x185972(0x227)]});_0x225178=await sales[_0x185972(0x207)]([{'$lookup':{'from':_0x185972(0x262),'localField':_0x185972(0x246),'foreignField':_0x185972(0x1aa),'as':_0x185972(0x21e)}},{'$unwind':_0x185972(0x24d)},{'$unwind':_0x185972(0x22e)},{'$group':{'_id':_0x185972(0x1bf),'invoice':{'$first':_0x185972(0x1a7)},'customers':{'$first':_0x185972(0x25d)},'date':{'$first':_0x185972(0x24b)},'warehouse_name':{'$first':_0x185972(0x1e4)},'sale_product':{'$push':_0x185972(0x22e)},'note':{'$first':_0x185972(0x250)},'return_data':{'$first':_0x185972(0x204)},'customers_docs':{'$first':_0x185972(0x24d)},'total_saleproduct_quantity':{'$sum':_0x185972(0x197)},'level':{'$addToSet':_0x185972(0x1de)},'isle':{'$addToSet':_0x185972(0x220)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x185972(0x1ab)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x225178=await sales[_0x185972(0x207)]([{'$lookup':{'from':_0x185972(0x262),'localField':_0x185972(0x246),'foreignField':_0x185972(0x1aa),'as':_0x185972(0x21e)}},{'$unwind':_0x185972(0x24d)},{'$unwind':_0x185972(0x22e)},{'$group':{'_id':_0x185972(0x1bf),'invoice':{'$first':_0x185972(0x1a7)},'customers':{'$first':_0x185972(0x25d)},'date':{'$first':_0x185972(0x24b)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x185972(0x22e)},'note':{'$first':_0x185972(0x250)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x185972(0x197)},'level':{'$addToSet':_0x185972(0x1de)},'isle':{'$addToSet':_0x185972(0x220)},'type':{'$addToSet':_0x185972(0x257)},'pallet':{'$addToSet':_0x185972(0x1ab)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x185972(0x194)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x185972(0x213)](_0x185972(0x1e3),_0x225178);if(_0xc3cc7c[0x0][_0x185972(0x1e1)]==_0x185972(0x255)){var _0x10100e=users[_0x185972(0x1c8)];console[_0x185972(0x213)](_0x10100e);}else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]==_0x185972(0x195))var _0x10100e=users['Hindi'];else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]==_0x185972(0x1cc))var _0x10100e=users['German'];else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]==_0x185972(0x1f0))var _0x10100e=users[_0x185972(0x1f0)];else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]==_0x185972(0x20a))var _0x10100e=users['French'];else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]==_0x185972(0x28e))var _0x10100e=users[_0x185972(0x256)];else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]=='Chinese')var _0x10100e=users[_0x185972(0x230)];else{if(_0xc3cc7c[0x0][_0x185972(0x1e1)]=='Arabic\x20(ae)')var _0x10100e=users['Arabic'];}}}}}}}_0xbc6916[_0x185972(0x261)](_0x185972(0x1a4),{'success':_0x2dd105['flash'](_0x185972(0x20e)),'errors':_0x2dd105[_0x185972(0x263)](_0x185972(0x1df)),'sales':_0x225178,'profile':_0x2979dd,'role':_0x3a4ce1,'master_shop':_0xc3cc7c,'language':_0x10100e});}catch(_0x5808a2){console[_0x185972(0x213)](_0x5808a2);}});async function getRandom8DigitNumber(){var _0x597ca0=a0_0x28d369;const _0x1610ac=0x989680,_0x2abb47=0x5f5e0ff,_0x428abd=Math[_0x597ca0(0x276)](Math['random']()*(_0x2abb47-_0x1610ac+0x1))+_0x1610ac;var _0x427e03;const _0x2efe76=await sales[_0x597ca0(0x272)]({'invoice':'OUT-'+_0x428abd});return _0x2efe76&&_0x2efe76[_0x597ca0(0x1eb)]>0x0?_0x427e03=_0x597ca0(0x1c6)+_0x428abd:_0x427e03='OUT-'+_0x428abd,_0x427e03;}router['get'](a0_0x28d369(0x1f1),auth,async(_0x33471e,_0x5da049)=>{var _0x318f93=a0_0x28d369;try{const {username:_0x5df95d,email:_0x18b3e1,role:_0x300b26}=_0x33471e['user'],_0xb3c72d=_0x33471e[_0x318f93(0x1d8)],_0x228a11=await profile['findOne']({'email':_0xb3c72d['email']}),_0x2b724f=await master_shop['find'](),_0xa85614=await customer[_0x318f93(0x189)]({});let _0x1bad5e;if(_0xb3c72d[_0x318f93(0x233)]==_0x318f93(0x224)){const _0x1d9cf7=await staff[_0x318f93(0x272)]({'email':_0xb3c72d[_0x318f93(0x227)]});_0x1bad5e=await warehouse[_0x318f93(0x207)]([{'$match':{'status':'Enabled','name':_0x1d9cf7[_0x318f93(0x20c)],'warehouse_category':_0x318f93(0x1d3),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x318f93(0x1d9),'name':{'$first':_0x318f93(0x1d9)}}},{'$sort':{'name':0x1}}]);}else _0x1bad5e=await warehouse[_0x318f93(0x207)]([{'$match':{'status':_0x318f93(0x20f),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x318f93(0x264)}}},{'$group':{'_id':_0x318f93(0x1d9),'name':{'$first':_0x318f93(0x1d9)}}},{'$sort':{'name':0x1}}]);const _0x1d3afd=await product['find']({});var _0x2f7ede=['Ambient',_0x318f93(0x1e8)];const _0x20af34=await sales[_0x318f93(0x189)]({}),_0x42b05a=_0x20af34[_0x318f93(0x1eb)]+0x1,_0x41b955=_0x318f93(0x1c6)+_0x42b05a[_0x318f93(0x225)]()[_0x318f93(0x20d)](0x5,'0');if(_0x2b724f[0x0][_0x318f93(0x1e1)]=='English\x20(US)'){var _0x48d81e=users[_0x318f93(0x1c8)];console[_0x318f93(0x213)](_0x48d81e);}else{if(_0x2b724f[0x0]['language']==_0x318f93(0x195))var _0x48d81e=users[_0x318f93(0x195)];else{if(_0x2b724f[0x0][_0x318f93(0x1e1)]==_0x318f93(0x1cc))var _0x48d81e=users['German'];else{if(_0x2b724f[0x0][_0x318f93(0x1e1)]=='Spanish')var _0x48d81e=users[_0x318f93(0x1f0)];else{if(_0x2b724f[0x0][_0x318f93(0x1e1)]==_0x318f93(0x20a))var _0x48d81e=users[_0x318f93(0x20a)];else{if(_0x2b724f[0x0][_0x318f93(0x1e1)]==_0x318f93(0x28e))var _0x48d81e=users['Portuguese'];else{if(_0x2b724f[0x0][_0x318f93(0x1e1)]==_0x318f93(0x230))var _0x48d81e=users[_0x318f93(0x230)];else{if(_0x2b724f[0x0][_0x318f93(0x1e1)]==_0x318f93(0x217))var _0x48d81e=users['Arabic'];}}}}}}}const _0x576f33=getRandom8DigitNumber();_0x576f33[_0x318f93(0x1ec)](_0x4e5743=>{var _0x28c580=_0x318f93;_0x5da049['render']('add_sales',{'success':_0x33471e[_0x28c580(0x263)](_0x28c580(0x20e)),'errors':_0x33471e[_0x28c580(0x263)]('errors'),'role':_0xb3c72d,'profile':_0x228a11,'customer':_0xa85614,'warehouse':_0x1bad5e,'product':_0x1d3afd,'invoice':_0x4e5743,'master_shop':_0x2b724f,'language':_0x48d81e,'rooms_data':_0x2f7ede});})['catch'](_0x19b1a5=>{var _0x92a497=_0x318f93;_0x33471e[_0x92a497(0x263)](_0x92a497(0x1df),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5da049[_0x92a497(0x290)](_0x92a497(0x278));});}catch(_0x4f0d6d){console[_0x318f93(0x213)](_0x4f0d6d);}}),router[a0_0x28d369(0x251)](a0_0x28d369(0x1ff),auth,async(_0x160835,_0x2cdb9b)=>{var _0x4fdace=a0_0x28d369;try{const _0x457503=_0x160835[_0x4fdace(0x1be)]['id'];console['log'](_0x457503);const _0x1d2a89=await product[_0x4fdace(0x189)](),_0x5a4ff6=await purchases[_0x4fdace(0x207)]([{'$match':{'warehouse_name':_0x457503}},{'$unwind':_0x4fdace(0x21c)},{'$group':{'_id':_0x4fdace(0x26d)}}]);console[_0x4fdace(0x213)](_0x4fdace(0x1c7),_0x5a4ff6),_0x2cdb9b[_0x4fdace(0x1f3)](0xc8)[_0x4fdace(0x25c)]({'purchases_data':_0x5a4ff6,'product_data':_0x1d2a89});}catch(_0x253c6f){console[_0x4fdace(0x213)](_0x253c6f);}}),router['post'](a0_0x28d369(0x283),auth,async(_0x5f19d3,_0x2681c8)=>{var _0x5af131=a0_0x28d369;try{const {warehouse_data:_0x42a2c1,product_data:_0x3956a2}=_0x5f19d3[_0x5af131(0x241)];console['log'](_0x5f19d3['body']['product_data']);;const _0x50e433=await master_shop[_0x5af131(0x189)]();console['log']('master',_0x50e433);const _0x24537f=await product[_0x5af131(0x272)]({'name':_0x3956a2});console[_0x5af131(0x213)](_0x5af131(0x23a),_0x24537f);const _0x2cb496=await warehouse[_0x5af131(0x207)]([{'$match':{'name':_0x42a2c1}},{'$unwind':_0x5af131(0x1dd)},{'$match':{'product_details.product_name':_0x3956a2}},{'$group':{'_id':_0x5af131(0x239),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x5af131(0x213)](_0x5af131(0x268),_0x2cb496),_0x2681c8['status'](0xc8)[_0x5af131(0x25c)]({'master':_0x50e433,'new_product':_0x24537f,'stock_data':_0x2cb496});}catch(_0xb7907d){console[_0x5af131(0x213)](_0xb7907d);}}),router[a0_0x28d369(0x286)]('/view/add_sales',auth,async(_0x381cb5,_0x4c7e7f)=>{var _0x39da0c=a0_0x28d369;try{const {invoice:_0x278d47,date:_0x101939,warehouse_name:_0x48402d,product_name:_0x2d1a29,stock:_0x43f41f,quantity:_0x9efaf,note:_0xf1baf2,room:_0x574187,primary_code:_0xb65647,secondary_code:_0x53b16e,prod_code:_0x26e7e4,level:_0x9cdc88,isle:_0x4e1aa7,pallet:_0x240213,batch_code:_0x5aeaec,SCRN:_0x52270d,expiry_date:_0x5e2523}=_0x381cb5[_0x39da0c(0x241)];if(typeof _0x2d1a29==_0x39da0c(0x190))var _0x40e239=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1a8)]],_0x46487a=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1e6)]],_0x26a76c=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x228)]],_0x4c1094=[_0x381cb5['body'][_0x39da0c(0x203)]],_0x10588d=[_0x381cb5['body']['secondary_code']],_0x4b9681=[_0x381cb5[_0x39da0c(0x241)]['prod_code']],_0x51501d=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1b6)]],_0x96b343=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x27c)]],_0x1d6262=[_0x381cb5['body'][_0x39da0c(0x229)]],_0x3441b3=[_0x381cb5[_0x39da0c(0x241)]['batch_code']],_0x258ab0=[_0x381cb5[_0x39da0c(0x241)]['expiry_date']],_0x31f531=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1c2)]],_0x3c4fc4=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1f2)]],_0xc03244=[_0x381cb5['body'][_0x39da0c(0x282)]],_0xa23a67=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x22b)]],_0x18b702=[_0x381cb5['body']['delivery_code']],_0x1b1928=[_0x381cb5['body'][_0x39da0c(0x18d)]],_0x133376=[_0x381cb5['body'][_0x39da0c(0x198)]],_0x203f43=[_0x381cb5['body']['RoomAssigned']],_0x9d9430=[_0x381cb5['body'][_0x39da0c(0x23f)]],_0x51a14a=[_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1ac)]],_0x1e4207=[_0x381cb5[_0x39da0c(0x241)]['actual_uom']],_0x3fd358=[_0x381cb5[_0x39da0c(0x241)]['id_transact']];else var _0x40e239=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1a8)]],_0x46487a=[..._0x381cb5['body'][_0x39da0c(0x1e6)]],_0x26a76c=[..._0x381cb5['body']['carton']],_0x4c1094=[..._0x381cb5[_0x39da0c(0x241)]['primary_code']],_0x10588d=[..._0x381cb5['body'][_0x39da0c(0x235)]],_0x4b9681=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x247)]],_0x51501d=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1b6)]],_0x96b343=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x27c)]],_0x1d6262=[..._0x381cb5['body'][_0x39da0c(0x229)]],_0x3441b3=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x24a)]],_0x258ab0=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1a3)]],_0x31f531=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1c2)]],_0x3c4fc4=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1f2)]],_0xc03244=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x282)]],_0xa23a67=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x22b)]],_0x18b702=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x192)]],_0x1b1928=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x18d)]],_0x133376=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x198)]],_0x203f43=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x20b)]],_0x9d9430=[..._0x381cb5[_0x39da0c(0x241)]['prod_invoice']],_0x51a14a=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1ac)]],_0x1e4207=[..._0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x1bc)]],_0x3fd358=[..._0x381cb5['body'][_0x39da0c(0x212)]];const _0x3593b5=_0x40e239['map'](_0x3bbd91=>{return _0x3bbd91={'product_name':_0x3bbd91};});_0x46487a[_0x39da0c(0x288)]((_0x312a43,_0xd909d4)=>{var _0x4d2608=_0x39da0c;_0x3593b5[_0xd909d4][_0x4d2608(0x1e6)]=Math['abs'](_0x312a43);}),_0x51a14a[_0x39da0c(0x288)]((_0xa51755,_0x1c376e)=>{var _0x35cc2d=_0x39da0c;_0x3593b5[_0x1c376e]['actual_qty']=Math[_0x35cc2d(0x208)](_0xa51755);}),_0x1e4207[_0x39da0c(0x288)]((_0x477d2c,_0x5f9ff9)=>{var _0x4b777a=_0x39da0c;_0x3593b5[_0x5f9ff9][_0x4b777a(0x1bc)]=_0x477d2c;}),_0x3fd358[_0x39da0c(0x288)]((_0x2891fe,_0x2ad772)=>{_0x3593b5[_0x2ad772]['id_transaction_from']=_0x2891fe;}),_0x26a76c['forEach']((_0x10e912,_0xa756f2)=>{_0x3593b5[_0xa756f2]['quantity']=_0x10e912;}),_0x4c1094[_0x39da0c(0x288)]((_0x4a851c,_0x3a89ee)=>{_0x3593b5[_0x3a89ee]['primary_code']=_0x4a851c;}),_0x10588d[_0x39da0c(0x288)]((_0x3d428c,_0x152e85)=>{_0x3593b5[_0x152e85]['secondary_code']=_0x3d428c;}),_0x4b9681['forEach']((_0x1ee43c,_0x4cd64e)=>{var _0x200547=_0x39da0c;_0x3593b5[_0x4cd64e][_0x200547(0x267)]=_0x1ee43c;}),_0x51501d['forEach']((_0xf22087,_0x206b38)=>{_0x203f43['forEach']((_0x396873,_0x3cc159)=>{var _0x20e707=a0_0x7e76;if(_0x396873=='Receiving\x20Area'&&_0x206b38==_0x3cc159){var _0x50db01=_0xf22087[_0x20e707(0x26b)](0x3);_0x3593b5[_0x206b38][_0x20e707(0x1b1)]=_0xf22087[0x0],_0x3593b5[_0x206b38][_0x20e707(0x248)]=_0xf22087[0x1],_0x3593b5[_0x206b38][_0x20e707(0x196)]=0x0,_0x3593b5[_0x206b38]['bin']=0x0,_0x3593b5[_0x206b38][_0x20e707(0x1db)]=_0x20e707(0x19b),_0x3593b5[_0x206b38][_0x20e707(0x1af)]=_0x50db01;}else{if(_0x396873==_0x20e707(0x24c)&&_0x206b38==_0x3cc159){var _0x50db01=_0xf22087['slice'](0x3);_0x3593b5[_0x206b38][_0x20e707(0x1b1)]=_0xf22087[0x0],_0x3593b5[_0x206b38][_0x20e707(0x248)]=_0xf22087[0x1],_0x3593b5[_0x206b38][_0x20e707(0x196)]=0x0,_0x3593b5[_0x206b38]['bin']=0x0,_0x3593b5[_0x206b38]['type']=_0x20e707(0x19b),_0x3593b5[_0x206b38][_0x20e707(0x1af)]=_0xf22087[0x5];}else{if(_0x206b38==_0x3cc159){var _0x3a4f57;if(_0xf22087[0x4]=='L')_0x3a4f57=_0x20e707(0x238);else _0xf22087[0x4]=='F'&&(_0x3a4f57=_0x20e707(0x19b));_0x3593b5[_0x206b38][_0x20e707(0x1b1)]=_0xf22087[0x0],_0x3593b5[_0x206b38][_0x20e707(0x248)]=_0xf22087[0x1],_0x3593b5[_0x206b38]['bay']=_0xf22087[0x2],_0x3593b5[_0x206b38]['bin']=_0xf22087[0x3],_0x3593b5[_0x206b38][_0x20e707(0x1db)]=_0x3a4f57,_0x3593b5[_0x206b38][_0x20e707(0x1af)]=_0xf22087[0x5];}}}});}),_0x96b343[_0x39da0c(0x288)]((_0xc58e85,_0x25cc2f)=>{var _0x26ef03=_0x39da0c;_0x3593b5[_0x25cc2f][_0x26ef03(0x240)]=_0xc58e85;}),_0x1d6262[_0x39da0c(0x288)]((_0x4ce5f5,_0x41dc7b)=>{var _0x19b4c0=_0x39da0c;_0x3593b5[_0x41dc7b][_0x19b4c0(0x229)]=_0x4ce5f5;}),_0x3441b3[_0x39da0c(0x288)]((_0x59f603,_0x2613a3)=>{_0x3593b5[_0x2613a3]['batch_code']=_0x59f603;}),_0x258ab0[_0x39da0c(0x288)]((_0x108376,_0x12f1ef)=>{var _0x10de8e=_0x39da0c;_0x3593b5[_0x12f1ef][_0x10de8e(0x1a3)]=_0x108376;}),_0x31f531['forEach']((_0x2d01da,_0x2b5372)=>{var _0x53699c=_0x39da0c;_0x3593b5[_0x2b5372][_0x53699c(0x1ee)]=_0x2d01da;}),_0x3c4fc4[_0x39da0c(0x288)]((_0x1c2053,_0x4c48b4)=>{var _0x2947d6=_0x39da0c;_0x3593b5[_0x4c48b4][_0x2947d6(0x1f2)]=_0x1c2053;}),_0xc03244[_0x39da0c(0x288)]((_0x328be1,_0x4b1342)=>{var _0x45d3bd=_0x39da0c;_0x3593b5[_0x4b1342][_0x45d3bd(0x282)]=_0x328be1;}),_0xa23a67[_0x39da0c(0x288)]((_0x203e6f,_0xacb05)=>{var _0x362f73=_0x39da0c;_0x3593b5[_0xacb05][_0x362f73(0x22b)]=_0x203e6f;}),_0x18b702['forEach']((_0x579f84,_0x33440e)=>{var _0x8a0892=_0x39da0c;_0x3593b5[_0x33440e][_0x8a0892(0x192)]=_0x579f84;}),_0x1b1928['forEach']((_0x4460e9,_0xc02276)=>{var _0x47abf2=_0x39da0c;_0x3593b5[_0xc02276][_0x47abf2(0x18d)]=_0x4460e9;}),_0x133376[_0x39da0c(0x288)]((_0x38dd3c,_0x7b829e)=>{_0x3593b5[_0x7b829e]['quantity_notConverted']=_0x38dd3c;}),_0x203f43[_0x39da0c(0x288)]((_0x55d183,_0x37dec3)=>{_0x3593b5[_0x37dec3]['room_name']=_0x55d183;}),_0x9d9430[_0x39da0c(0x288)]((_0x5599bb,_0x4d10bb)=>{var _0x417567=_0x39da0c;_0x3593b5[_0x4d10bb][_0x417567(0x27e)]=_0x5599bb;});var _0x44ba0c=0x0;_0x3593b5[_0x39da0c(0x288)](_0x4fa31f=>{var _0x48408e=_0x39da0c;(_0x4fa31f[_0x48408e(0x1e6)]<_0x4fa31f[_0x48408e(0x287)]||_0x4fa31f[_0x48408e(0x287)]==0x0)&&(console[_0x48408e(0x213)](_0x48408e(0x1e7),_0x4fa31f),_0x44ba0c++);});const _0x1c7ce1=_0x3593b5[_0x39da0c(0x1ce)](_0x3ad1ba=>_0x3ad1ba['quantity']!=='0'&&_0x3ad1ba[_0x39da0c(0x198)]!==''),_0xff2cbe=new sales({'invoice':_0x278d47,'customer':_0x381cb5[_0x39da0c(0x241)][_0x39da0c(0x246)],'date':_0x101939,'warehouse_name':_0x48402d,'sale_product':_0x1c7ce1,'note':_0xf1baf2,'room':_0x574187,'primary_code':_0xb65647,'secondary_code':_0x53b16e,'prod_code':_0x26e7e4,'SCRN':_0x52270d}),_0x4635=await _0xff2cbe[_0x39da0c(0x1b3)]();_0x381cb5['flash'](_0x39da0c(0x20e),_0x39da0c(0x23d)),_0x4c7e7f[_0x39da0c(0x290)](_0x39da0c(0x1cb)+_0x4635['_id']);}catch(_0x296d){console[_0x39da0c(0x213)](_0x296d);}}),router['get'](a0_0x28d369(0x1a5),auth,async(_0x4df845,_0x585a6d)=>{var _0x169db3=a0_0x28d369;try{const {username:_0x537df2,email:_0x39957e,role:_0x51f860}=_0x4df845[_0x169db3(0x1d8)],_0x1c0e24=_0x4df845[_0x169db3(0x1d8)],_0x36eda5=await profile['findOne']({'email':_0x1c0e24[_0x169db3(0x227)]}),_0x567ca1=await master_shop[_0x169db3(0x189)](),_0x58c610=_0x4df845['params']['id'],_0x1986c1=await sales[_0x169db3(0x271)](_0x58c610),_0x10dce7=await warehouse[_0x169db3(0x207)]([{'$match':{'name':_0x1986c1[_0x169db3(0x275)]}},{'$unwind':_0x169db3(0x1dd)},{'$group':{'_id':_0x169db3(0x1c3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x169db3(0x252)},'bay':{'$first':_0x169db3(0x253)},'bin':{'$first':_0x169db3(0x22a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x169db3(0x289)},'primary_code':{'$first':_0x169db3(0x222)},'secondary_code':{'$first':_0x169db3(0x1e5)},'product_code':{'$first':_0x169db3(0x27f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x169db3(0x201)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x169db3(0x1ca)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x196714=await customer[_0x169db3(0x189)]({});let _0x2fea4c;if(_0x1c0e24[_0x169db3(0x233)]==_0x169db3(0x224)){const _0x19ce6b=await staff[_0x169db3(0x272)]({'email':_0x1c0e24[_0x169db3(0x227)]});_0x2fea4c=await warehouse[_0x169db3(0x207)]([{'$match':{'status':_0x169db3(0x20f),'name':_0x19ce6b[_0x169db3(0x20c)]}},{'$group':{'_id':'$name','name':{'$first':_0x169db3(0x1d9)}}}]);}else _0x2fea4c=await warehouse[_0x169db3(0x207)]([{'$match':{'status':_0x169db3(0x20f)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1173d6=await product[_0x169db3(0x189)]({}),_0x4fb45d=await suppliers[_0x169db3(0x189)]({});if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x255)){var _0x50248f=users[_0x169db3(0x1c8)];console['log'](_0x50248f);}else{if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x195))var _0x50248f=users['Hindi'];else{if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x1cc))var _0x50248f=users[_0x169db3(0x1cc)];else{if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x1f0))var _0x50248f=users[_0x169db3(0x1f0)];else{if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x20a))var _0x50248f=users[_0x169db3(0x20a)];else{if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x28e))var _0x50248f=users[_0x169db3(0x256)];else{if(_0x567ca1[0x0][_0x169db3(0x1e1)]==_0x169db3(0x230))var _0x50248f=users['Chinese'];else{if(_0x567ca1[0x0]['language']==_0x169db3(0x217))var _0x50248f=users[_0x169db3(0x1a0)];}}}}}}}_0x585a6d['render'](_0x169db3(0x1ae),{'success':_0x4df845[_0x169db3(0x263)]('success'),'errors':_0x4df845[_0x169db3(0x263)](_0x169db3(0x1df)),'role':_0x1c0e24,'profile':_0x36eda5,'customer':_0x196714,'warehouse':_0x2fea4c,'product':_0x10dce7,'user':_0x1986c1,'master_shop':_0x567ca1,'unit':_0x1173d6,'language':_0x50248f,'suppliers':_0x4fb45d});}catch(_0x4a080b){console[_0x169db3(0x213)](_0x4a080b);}}),router[a0_0x28d369(0x286)](a0_0x28d369(0x1a5),auth,async(_0x4133d7,_0x3fb9b4)=>{var _0x2ac9df=a0_0x28d369;try{const _0x1163cf=_0x4133d7[_0x2ac9df(0x1be)]['id'],{invoice:_0x3ecc3d,warehouse_name:_0x329c38,room:_0x582c88}=_0x4133d7[_0x2ac9df(0x241)],_0x2c66b6=await sales['findOne']({'invoice':_0x3ecc3d}),_0x368037=_0x2c66b6[_0x2ac9df(0x18c)][_0x2ac9df(0x28f)](async _0x344251=>{var _0x90e7cb=_0x2ac9df,_0x5ad5db=await warehouse[_0x90e7cb(0x272)]({'name':_0x329c38,'room':_0x344251['room_name'],'warehouse_category':_0x90e7cb(0x1d3)});const _0x19f532=_0x5ad5db['product_details']['map'](_0x5a8ee9=>{var _0x3de52f=_0x90e7cb;_0x5a8ee9['product_name']==_0x344251[_0x3de52f(0x1a8)]&&_0x5a8ee9[_0x3de52f(0x1af)]==_0x344251[_0x3de52f(0x1af)]&&_0x5a8ee9[_0x3de52f(0x1db)]==_0x344251['type']&&_0x5a8ee9[_0x3de52f(0x280)]==_0x344251['bin']&&_0x5a8ee9[_0x3de52f(0x196)]==_0x344251[_0x3de52f(0x196)]&&_0x5a8ee9[_0x3de52f(0x248)]==_0x344251[_0x3de52f(0x248)]&&_0x5a8ee9['storage']==_0x344251[_0x3de52f(0x1b1)]&&_0x5a8ee9['expiry_date']==_0x344251[_0x3de52f(0x1a3)]&&_0x5a8ee9[_0x3de52f(0x24a)]==_0x344251[_0x3de52f(0x24a)]&&_0x5a8ee9['invoice']==_0x344251[_0x3de52f(0x27e)]&&_0x5a8ee9[_0x3de52f(0x21a)]==_0x344251['id_transaction_from']&&(_0x5a8ee9[_0x3de52f(0x1d6)]=Math[_0x3de52f(0x205)](0x0,Math[_0x3de52f(0x208)](_0x5a8ee9['product_stock'])-Math[_0x3de52f(0x208)](_0x344251[_0x3de52f(0x198)])));});return _0x5ad5db;});Promise[_0x2ac9df(0x21d)](_0x368037)[_0x2ac9df(0x1ec)](async _0x1d93ce=>{var _0x502fcb=_0x2ac9df;try{for(const _0x19bade of _0x1d93ce){await _0x19bade[_0x502fcb(0x1b3)]();}_0x2c66b6[_0x502fcb(0x1cf)]=_0x502fcb(0x25a);const _0xc2f931=await _0x2c66b6[_0x502fcb(0x1b3)](),_0x88e3d=await master_shop['find'](),_0x3c1c91=await email_settings[_0x502fcb(0x272)](),_0x165b64=await supervisor_settings[_0x502fcb(0x189)]();var _0xcff1f2=_0x2c66b6[_0x502fcb(0x18c)],_0x2da6b1='',_0x570b3c;for(_0x570b3c in _0xcff1f2){_0x2da6b1+=_0x502fcb(0x23c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcff1f2[_0x570b3c][_0x502fcb(0x1a8)]+_0x502fcb(0x258)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcff1f2[_0x570b3c][_0x502fcb(0x267)]+_0x502fcb(0x258)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcff1f2[_0x570b3c][_0x502fcb(0x198)]+_0x502fcb(0x258)+_0x502fcb(0x1da)+_0xcff1f2[_0x570b3c][_0x502fcb(0x240)]+_0x502fcb(0x258)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcff1f2[_0x570b3c][_0x502fcb(0x229)]+'</td>'+_0x502fcb(0x1da)+_0x2c66b6[_0x502fcb(0x275)]+_0x502fcb(0x258)+_0x502fcb(0x1da)+_0xcff1f2[_0x570b3c][_0x502fcb(0x193)]+'</td>'+_0x502fcb(0x1da)+_0xcff1f2[_0x570b3c][_0x502fcb(0x1b1)]+_0xcff1f2[_0x570b3c][_0x502fcb(0x248)]+_0xcff1f2[_0x570b3c][_0x502fcb(0x196)]+_0xcff1f2[_0x570b3c][_0x502fcb(0x280)]+_0xcff1f2[_0x570b3c][_0x502fcb(0x1db)][0x0]+_0xcff1f2[_0x570b3c]['floorlevel']+_0x502fcb(0x258),_0x502fcb(0x26a);}let _0x2bacca=nodemailer['createTransport']({'host':_0x3c1c91[_0x502fcb(0x18e)],'port':Number(_0x3c1c91['port']),'secure':![],'auth':{'user':_0x3c1c91[_0x502fcb(0x227)],'pass':_0x3c1c91[_0x502fcb(0x1b8)]}}),_0x26e370={'from':_0x3c1c91[_0x502fcb(0x227)],'to':_0x165b64[0x0][_0x502fcb(0x242)],'subject':_0x502fcb(0x26f),'attachments':[{'filename':_0x502fcb(0x1a6),'path':__dirname+_0x502fcb(0x1bd)+_0x502fcb(0x1d5)+_0x88e3d[0x0]['image'],'cid':_0x502fcb(0x1fc)}],'html':_0x502fcb(0x21b)+_0x502fcb(0x19d)+_0x502fcb(0x1ef)+_0x502fcb(0x1e0)+_0x502fcb(0x254)+_0x502fcb(0x1e0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x502fcb(0x1e0)+_0x502fcb(0x281)+_0x88e3d[0x0][_0x502fcb(0x19c)]+_0x502fcb(0x26c)+_0x502fcb(0x273)+_0x502fcb(0x273)+_0x502fcb(0x1f4)+_0x502fcb(0x1e0)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x502fcb(0x1d1)+_0x2c66b6[_0x502fcb(0x27e)]+'\x20'+_0x502fcb(0x249)+_0x502fcb(0x291)+_0x2c66b6[_0x502fcb(0x18b)]+'\x20'+_0x502fcb(0x218)+'</h5>'+_0x502fcb(0x273)+_0x502fcb(0x1b2)+_0x502fcb(0x1d2)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x502fcb(0x234)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x502fcb(0x27d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x502fcb(0x26a)+_0x502fcb(0x206)+_0x502fcb(0x211)+'\x20'+_0x2da6b1+'\x20'+'</tbody>'+_0x502fcb(0x1f6)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x502fcb(0x199)+_0x88e3d[0x0][_0x502fcb(0x19c)]+_0x502fcb(0x25f)+_0x502fcb(0x273)+_0x502fcb(0x273)+_0x502fcb(0x1f8)};_0x2bacca['sendMail'](_0x26e370,function(_0x5badf3,_0x1037fe){var _0x56dca9=_0x502fcb;_0x5badf3?(console[_0x56dca9(0x213)](_0x5badf3),console[_0x56dca9(0x213)](_0x56dca9(0x1d0))):console[_0x56dca9(0x213)](_0x56dca9(0x22c));}),_0x4133d7[_0x502fcb(0x263)](_0x502fcb(0x20e),_0x502fcb(0x265)),_0x3fb9b4['redirect'](_0x502fcb(0x1cb)+_0x1163cf);}catch(_0x31b7bc){console[_0x502fcb(0x1fa)](_0x31b7bc),_0x3fb9b4[_0x502fcb(0x1f3)](0x1f4)[_0x502fcb(0x25c)]({'error':_0x502fcb(0x284)});}})[_0x2ac9df(0x237)](_0x38c9d6=>{var _0x46a8c7=_0x2ac9df;console[_0x46a8c7(0x1fa)](_0x38c9d6),_0x3fb9b4[_0x46a8c7(0x1f3)](0x1f4)['json']({'error':_0x46a8c7(0x216)});});}catch(_0x303d1f){console[_0x2ac9df(0x213)](_0x303d1f);}}),router['get']('/view/:id',auth,async(_0x35813c,_0x59146c)=>{var _0x3a3535=a0_0x28d369;try{const {username:_0xfa3ffc,email:_0x2a41a1,role:_0x273007}=_0x35813c[_0x3a3535(0x1d8)],_0x3aa6d9=_0x35813c[_0x3a3535(0x1d8)],_0x50cd9f=await profile['findOne']({'email':_0x3aa6d9[_0x3a3535(0x227)]}),_0x2000db=await master_shop['find'](),_0x491421=_0x35813c[_0x3a3535(0x1be)]['id'],_0x5eb2c2=await sales[_0x3a3535(0x271)](_0x491421);var _0x4c7dea=[_0x3a3535(0x260),_0x3a3535(0x1e8)];const _0x2b2e17=await warehouse[_0x3a3535(0x207)]([{'$match':{'name':_0x5eb2c2[_0x3a3535(0x275)],'warehouse_category':_0x3a3535(0x1d3)}},{'$unwind':_0x3a3535(0x1dd)},{'$group':{'_id':_0x3a3535(0x1c3),'name':{'$first':_0x3a3535(0x239)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3a3535(0x28a)},'floorlevel':{'$first':_0x3a3535(0x289)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3a3535(0x1e5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3a3535(0x219)},'rack':{'$first':_0x3a3535(0x201)}}}]),_0x1cd78e=await customer[_0x3a3535(0x189)]({});let _0x1e3e7f;if(_0x3aa6d9[_0x3a3535(0x233)]==_0x3a3535(0x224)){const _0x36fe87=await staff[_0x3a3535(0x272)]({'email':_0x3aa6d9[_0x3a3535(0x227)]});_0x1e3e7f=await warehouse[_0x3a3535(0x207)]([{'$match':{'status':'Enabled','name':_0x36fe87[_0x3a3535(0x20c)],'warehouse_category':_0x3a3535(0x1d3)}},{'$group':{'_id':_0x3a3535(0x1d9),'name':{'$first':'$name'}}}]);}else _0x1e3e7f=await warehouse[_0x3a3535(0x207)]([{'$match':{'status':'Enabled','warehouse_category':_0x3a3535(0x1d3)}},{'$group':{'_id':_0x3a3535(0x1d9),'name':{'$first':_0x3a3535(0x1d9)}}}]);const _0x2be506=await product[_0x3a3535(0x189)]({});if(_0x2000db[0x0]['language']=='English\x20(US)'){var _0x288855=users['English'];console['log'](_0x288855);}else{if(_0x2000db[0x0][_0x3a3535(0x1e1)]=='Hindi')var _0x288855=users[_0x3a3535(0x195)];else{if(_0x2000db[0x0][_0x3a3535(0x1e1)]==_0x3a3535(0x1cc))var _0x288855=users['German'];else{if(_0x2000db[0x0][_0x3a3535(0x1e1)]==_0x3a3535(0x1f0))var _0x288855=users[_0x3a3535(0x1f0)];else{if(_0x2000db[0x0][_0x3a3535(0x1e1)]=='French')var _0x288855=users[_0x3a3535(0x20a)];else{if(_0x2000db[0x0]['language']==_0x3a3535(0x28e))var _0x288855=users[_0x3a3535(0x256)];else{if(_0x2000db[0x0][_0x3a3535(0x1e1)]==_0x3a3535(0x230))var _0x288855=users['Chinese'];else{if(_0x2000db[0x0]['language']==_0x3a3535(0x217))var _0x288855=users[_0x3a3535(0x1a0)];}}}}}}}_0x59146c['render']('edit_sales',{'success':_0x35813c[_0x3a3535(0x263)](_0x3a3535(0x20e)),'errors':_0x35813c[_0x3a3535(0x263)](_0x3a3535(0x1df)),'role':_0x3aa6d9,'profile':_0x50cd9f,'customer':_0x1cd78e,'warehouse':_0x1e3e7f,'product':_0x2b2e17,'user':_0x5eb2c2,'master_shop':_0x2000db,'unit':_0x2be506,'language':_0x288855});}catch(_0x220659){console[_0x3a3535(0x213)](_0x220659);}}),router[a0_0x28d369(0x286)](a0_0x28d369(0x1ea),auth,async(_0x5f206b,_0x908c51)=>{var _0x38e959=a0_0x28d369;try{const _0x23607a=_0x5f206b[_0x38e959(0x1be)]['id'],_0x523735=await sales[_0x38e959(0x272)]({'_id':_0x5f206b['params']['id']}),_0x4be895=await warehouse[_0x38e959(0x272)]({'name':_0x523735['warehouse_name'],'room':_0x5f206b[_0x38e959(0x241)][_0x38e959(0x1c9)]}),{invoice:_0x279ef9,date:_0x43f44d,warehouse_name:_0x57fe35,product_name:_0x4e25e5,stock:_0x4ce390,quantity:_0x1ec49d,note:_0x4d6d26,room:_0xfb599e,customer:_0xd97328,SCRN:_0x46b1c6}=_0x5f206b[_0x38e959(0x241)];if(typeof _0x4e25e5==_0x38e959(0x190))var _0x2808f7=[_0x5f206b['body'][_0x38e959(0x1a8)]],_0x1d5405=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x1e6)]],_0x31dac5=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x228)]],_0x51bae4=[_0x5f206b['body'][_0x38e959(0x203)]],_0x4aebc4=[_0x5f206b[_0x38e959(0x241)]['secondary_code']],_0x2a8c86=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x247)]],_0x561102=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x1b6)]],_0x26837b=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x27c)]],_0x53d7dd=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x229)]],_0x2f815b=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x24a)]],_0x5ec86a=[_0x5f206b[_0x38e959(0x241)]['expiry_date']],_0x8b5321=[_0x5f206b['body'][_0x38e959(0x1c2)]],_0x542137=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x1f2)]],_0x7d8e0c=[_0x5f206b['body'][_0x38e959(0x282)]],_0x36517a=[_0x5f206b['body']['delivery_date']],_0x11224e=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x192)]],_0x39ffa5=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x18d)]],_0x5b4983=[_0x5f206b['body'][_0x38e959(0x198)]],_0x1bfa97=[_0x5f206b[_0x38e959(0x241)][_0x38e959(0x20b)]];else var _0x2808f7=[..._0x5f206b['body'][_0x38e959(0x1a8)]],_0x1d5405=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x1e6)]],_0x31dac5=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x228)]],_0x51bae4=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x203)]],_0x4aebc4=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x235)]],_0x2a8c86=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x247)]],_0x561102=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x1b6)]],_0x26837b=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x27c)]],_0x53d7dd=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x229)]],_0x2f815b=[..._0x5f206b[_0x38e959(0x241)]['batch_code']],_0x5ec86a=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x1a3)]],_0x8b5321=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x1c2)]],_0x542137=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x1f2)]],_0x7d8e0c=[..._0x5f206b[_0x38e959(0x241)]['requested_qty']],_0x36517a=[..._0x5f206b['body']['delivery_date']],_0x11224e=[..._0x5f206b[_0x38e959(0x241)]['delivery_code']],_0x39ffa5=[..._0x5f206b['body']['prod_cat']],_0x5b4983=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x198)]],_0x1bfa97=[..._0x5f206b[_0x38e959(0x241)][_0x38e959(0x20b)]];const _0x50584b=_0x2808f7[_0x38e959(0x28f)](_0x377788=>{return _0x377788={'product_name':_0x377788};});_0x1d5405[_0x38e959(0x288)]((_0x5734ec,_0x16de88)=>{var _0x39b3b6=_0x38e959;_0x50584b[_0x16de88]['stock']=Math[_0x39b3b6(0x208)](_0x5734ec);}),_0x31dac5[_0x38e959(0x288)]((_0x45577d,_0xe7a567)=>{_0x50584b[_0xe7a567]['quantity']=_0x45577d;}),_0x51bae4['forEach']((_0x1f23b8,_0x11706b)=>{_0x50584b[_0x11706b]['primary_code']=_0x1f23b8;}),_0x4aebc4['forEach']((_0x4f50ac,_0xcb1f34)=>{_0x50584b[_0xcb1f34]['secondary_code']=_0x4f50ac;}),_0x2a8c86['forEach']((_0x478b51,_0x21018b)=>{var _0x70aa3a=_0x38e959;_0x50584b[_0x21018b][_0x70aa3a(0x267)]=_0x478b51;}),_0x561102[_0x38e959(0x288)]((_0x28439c,_0x4aedc8)=>{var _0x522615=_0x38e959;_0x1bfa97[_0x522615(0x288)]((_0x44d81,_0x3dfdf2)=>{var _0x12707=_0x522615;if(_0x44d81==_0x12707(0x1a2)&&_0x4aedc8==_0x3dfdf2){var _0x317afc=_0x28439c[_0x12707(0x26b)](0x3);_0x50584b[_0x4aedc8][_0x12707(0x1b1)]=_0x28439c[0x0],_0x50584b[_0x4aedc8][_0x12707(0x248)]=_0x28439c[0x1],_0x50584b[_0x4aedc8][_0x12707(0x196)]=0x0,_0x50584b[_0x4aedc8][_0x12707(0x280)]=0x0,_0x50584b[_0x4aedc8][_0x12707(0x1db)]=_0x12707(0x19b),_0x50584b[_0x4aedc8]['floorlevel']=_0x317afc;}else{if(_0x44d81==_0x12707(0x24c)&&_0x4aedc8==_0x3dfdf2){var _0x317afc=_0x28439c[_0x12707(0x26b)](0x3);_0x50584b[_0x4aedc8][_0x12707(0x1b1)]=_0x28439c[0x0],_0x50584b[_0x4aedc8][_0x12707(0x248)]=_0x28439c[0x1],_0x50584b[_0x4aedc8][_0x12707(0x196)]=0x0,_0x50584b[_0x4aedc8][_0x12707(0x280)]=0x0,_0x50584b[_0x4aedc8][_0x12707(0x1db)]=_0x12707(0x19b),_0x50584b[_0x4aedc8][_0x12707(0x1af)]=_0x28439c[0x5];}else{if(_0x4aedc8==_0x3dfdf2){var _0xb4943c;if(_0x28439c[0x4]=='L')_0xb4943c='Level';else _0x28439c[0x4]=='F'&&(_0xb4943c=_0x12707(0x19b));_0x50584b[_0x4aedc8]['storage']=_0x28439c[0x0],_0x50584b[_0x4aedc8][_0x12707(0x248)]=_0x28439c[0x1],_0x50584b[_0x4aedc8][_0x12707(0x196)]=_0x28439c[0x2],_0x50584b[_0x4aedc8][_0x12707(0x280)]=_0x28439c[0x3],_0x50584b[_0x4aedc8][_0x12707(0x1db)]=_0xb4943c,_0x50584b[_0x4aedc8][_0x12707(0x1af)]=_0x28439c[0x5];}}}});}),_0x26837b[_0x38e959(0x288)]((_0x1c70a6,_0x949664)=>{var _0x2a3fa3=_0x38e959;_0x50584b[_0x949664][_0x2a3fa3(0x240)]=_0x1c70a6;}),_0x53d7dd[_0x38e959(0x288)]((_0x146f8a,_0x445ad0)=>{var _0x5ca691=_0x38e959;_0x50584b[_0x445ad0][_0x5ca691(0x229)]=_0x146f8a;}),_0x2f815b[_0x38e959(0x288)]((_0x461369,_0x1fd676)=>{_0x50584b[_0x1fd676]['batch_code']=_0x461369;}),_0x5ec86a['forEach']((_0x31f916,_0x20a9e1)=>{var _0xe76490=_0x38e959;_0x50584b[_0x20a9e1][_0xe76490(0x1a3)]=_0x31f916;}),_0x8b5321[_0x38e959(0x288)]((_0x132170,_0x476ecb)=>{_0x50584b[_0x476ecb]['maxperunit']=_0x132170;}),_0x542137[_0x38e959(0x288)]((_0x1142d8,_0x371e19)=>{_0x50584b[_0x371e19]['production_date']=_0x1142d8;}),_0x7d8e0c[_0x38e959(0x288)]((_0x43b334,_0x3fcc67)=>{var _0x265a24=_0x38e959;_0x50584b[_0x3fcc67][_0x265a24(0x282)]=Math[_0x265a24(0x208)](_0x43b334);}),_0x36517a[_0x38e959(0x288)]((_0x26ba56,_0x424009)=>{var _0x5db0a1=_0x38e959;_0x50584b[_0x424009][_0x5db0a1(0x22b)]=_0x26ba56;}),_0x11224e[_0x38e959(0x288)]((_0x53d1b7,_0x58745a)=>{var _0x5e463c=_0x38e959;_0x50584b[_0x58745a][_0x5e463c(0x192)]=_0x53d1b7;}),_0x39ffa5[_0x38e959(0x288)]((_0x5524b3,_0x5402ca)=>{var _0xb5032d=_0x38e959;_0x50584b[_0x5402ca][_0xb5032d(0x18d)]=_0x5524b3;}),_0x5b4983[_0x38e959(0x288)]((_0x23755e,_0x1fad8d)=>{var _0x4f1780=_0x38e959;_0x50584b[_0x1fad8d][_0x4f1780(0x287)]=_0x23755e;}),_0x1bfa97[_0x38e959(0x288)]((_0xdf55d2,_0xca9987)=>{var _0x40e4cc=_0x38e959;_0x50584b[_0xca9987][_0x40e4cc(0x193)]=_0xdf55d2;});var _0x36ceeb=0x0;_0x50584b['forEach'](_0x38bef2=>{var _0x1fa30a=_0x38e959;console[_0x1fa30a(0x213)](_0x1fa30a(0x1e7),_0x38bef2),(parseInt(_0x38bef2[_0x1fa30a(0x1e6)])<parseInt(_0x38bef2[_0x1fa30a(0x198)])||parseInt(_0x38bef2['quantity'])==0x0)&&_0x36ceeb++;});if(_0x36ceeb!=0x0)return _0x5f206b[_0x38e959(0x263)](_0x38e959(0x1df),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x908c51['redirect'](_0x38e959(0x25e));const _0x3a928d=_0x50584b[_0x38e959(0x1ce)](_0x3a0f27=>_0x3a0f27[_0x38e959(0x198)]!=='0'&&_0x3a0f27[_0x38e959(0x198)]!=='');_0x523735['invoice']=_0x279ef9,_0x523735[_0x38e959(0x246)]=_0xd97328,_0x523735[_0x38e959(0x18b)]=_0x43f44d,_0x523735['warehouse_name']=_0x57fe35,_0x523735['sale_product']=_0x3a928d,_0x523735[_0x38e959(0x24e)]=_0x4d6d26,_0x523735[_0x38e959(0x223)]=_0x46b1c6,_0x523735['finalize']=_0x38e959(0x1d4),_0x523735['isAllowEdit']=_0x38e959(0x1d4);const _0x4bebca=await _0x523735[_0x38e959(0x1b3)]();_0x5f206b[_0x38e959(0x263)](_0x38e959(0x20e),_0x38e959(0x265)),_0x908c51[_0x38e959(0x290)](_0x38e959(0x278));}catch(_0xd12c99){console[_0x38e959(0x213)](_0xd12c99);}}),router['post'](a0_0x28d369(0x243),auth,async(_0x230b5b,_0x27b931)=>{var _0x54e867=a0_0x28d369;try{const _0x8cad8b=_0x230b5b[_0x54e867(0x1be)]['id'],{invoice:_0x4baa5d,customer:_0x2d2460,receivable_amount:_0x5d42c1,received_amount:_0x2e4803}=_0x230b5b['body'],_0x558c2e=await sales['findById'](_0x8cad8b);console[_0x54e867(0x213)](_0x558c2e);var _0x20ece7=_0x5d42c1-_0x2e4803;console['log'](_0x2e4803),_0x558c2e[_0x54e867(0x28d)]=parseFloat(_0x2e4803)+parseFloat(_0x558c2e['received_amount']),_0x558c2e['due_amount']=_0x20ece7,console[_0x54e867(0x213)](_0x558c2e);const _0x8308a9=await _0x558c2e['save'](),_0x242943=await c_payment_data[_0x54e867(0x272)]({'invoice':_0x4baa5d});_0x242943['amount']=_0x20ece7,await _0x242943['save']();let _0x18b627=new Date(),_0xd1307b=('0'+_0x18b627[_0x54e867(0x200)]())[_0x54e867(0x26b)](-0x2),_0x3627da=('0'+(_0x18b627['getMonth']()+0x1))[_0x54e867(0x26b)](-0x2),_0x8ef675=_0x18b627[_0x54e867(0x191)](),_0x8abc48=_0x8ef675+'-'+_0x3627da+'-'+_0xd1307b;const _0x4163f0=new customer_payment({'invoice':_0x4baa5d,'date':_0x8ef675+'-'+_0x3627da+'-'+_0xd1307b,'customer':_0x2d2460,'reason':_0x54e867(0x226),'amount':_0x2e4803}),_0x56f4a1=await _0x4163f0[_0x54e867(0x1b3)]();_0x230b5b['flash'](_0x54e867(0x20e),'payment\x20successfull'),_0x27b931[_0x54e867(0x290)](_0x54e867(0x278));}catch(_0x59684f){console[_0x54e867(0x213)](_0x59684f);}}),router[a0_0x28d369(0x251)](a0_0x28d369(0x266),auth,async(_0x33932d,_0xd3a32c)=>{var _0x36bfba=a0_0x28d369;try{const {username:_0x37c055,email:_0x4b95b2,role:_0x4f7174}=_0x33932d[_0x36bfba(0x1d8)],_0x98a302=_0x33932d['user'],_0x2dcf3f=await profile[_0x36bfba(0x272)]({'email':_0x98a302[_0x36bfba(0x227)]}),_0x46feb2=await master_shop[_0x36bfba(0x189)]();console[_0x36bfba(0x213)](_0x36bfba(0x1fb),_0x46feb2);const _0x231bab=_0x33932d[_0x36bfba(0x1be)]['id'],_0x29385d=await sales[_0x36bfba(0x271)](_0x231bab);console['log'](_0x29385d);const _0x1f144d=await customer[_0x36bfba(0x272)]({'name':_0x29385d[_0x36bfba(0x246)]});console['log'](_0x1f144d);if(_0x46feb2[0x0][_0x36bfba(0x1e1)]==_0x36bfba(0x255)){var _0x57d344=users[_0x36bfba(0x1c8)];console[_0x36bfba(0x213)](_0x57d344);}else{if(_0x46feb2[0x0][_0x36bfba(0x1e1)]==_0x36bfba(0x195))var _0x57d344=users[_0x36bfba(0x195)];else{if(_0x46feb2[0x0]['language']==_0x36bfba(0x1cc))var _0x57d344=users['German'];else{if(_0x46feb2[0x0][_0x36bfba(0x1e1)]==_0x36bfba(0x1f0))var _0x57d344=users['Spanish'];else{if(_0x46feb2[0x0][_0x36bfba(0x1e1)]==_0x36bfba(0x20a))var _0x57d344=users['French'];else{if(_0x46feb2[0x0][_0x36bfba(0x1e1)]=='Portuguese\x20(BR)')var _0x57d344=users[_0x36bfba(0x256)];else{if(_0x46feb2[0x0][_0x36bfba(0x1e1)]==_0x36bfba(0x230))var _0x57d344=users['Chinese'];else{if(_0x46feb2[0x0][_0x36bfba(0x1e1)]==_0x36bfba(0x217))var _0x57d344=users[_0x36bfba(0x1a0)];}}}}}}}_0xd3a32c['render'](_0x36bfba(0x1e9),{'success':_0x33932d[_0x36bfba(0x263)](_0x36bfba(0x20e)),'errors':_0x33932d[_0x36bfba(0x263)](_0x36bfba(0x1df)),'role':_0x98a302,'profile':_0x2dcf3f,'master_shop':_0x46feb2,'customers':_0x1f144d,'sales':_0x29385d,'language':_0x57d344});}catch(_0x33a878){console['log'](_0x33a878);}}),router[a0_0x28d369(0x251)]('/view/return_sales/:id',auth,async(_0x3606c7,_0x30a336)=>{var _0x3583b6=a0_0x28d369;try{const {username:_0x54f5d7,email:_0x5d14e1,role:_0x32e875}=_0x3606c7[_0x3583b6(0x1d8)],_0xa07575=_0x3606c7['user'],_0x3b930b=await profile[_0x3583b6(0x272)]({'email':_0xa07575[_0x3583b6(0x227)]}),_0x40f4f5=await master_shop[_0x3583b6(0x189)]();console[_0x3583b6(0x213)](_0x3583b6(0x1fb),_0x40f4f5);const _0x463654=_0x3606c7['params']['id'];console[_0x3583b6(0x213)](_0x463654);const _0x4598df=await sales[_0x3583b6(0x271)](_0x463654);console[_0x3583b6(0x213)]('user_id',_0x4598df);const _0x3d40ca=await warehouse[_0x3583b6(0x207)]([{'$match':{'name':_0x3583b6(0x264),'room':_0x3583b6(0x1f5)}},{'$unwind':_0x3583b6(0x1dd)},{'$group':{'_id':_0x3583b6(0x1c3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3583b6(0x252)},'level':{'$first':_0x3583b6(0x19e)},'isle':{'$first':_0x3583b6(0x28b)},'pallet':{'$first':_0x3583b6(0x210)},'primary_code':{'$first':_0x3583b6(0x222)},'secondary_code':{'$first':_0x3583b6(0x1e5)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x3583b6(0x213)](_0x3583b6(0x268),_0x3d40ca);const _0x521c40=await product[_0x3583b6(0x189)]({});warehouse_data=await warehouse[_0x3583b6(0x207)]([{'$match':{'status':_0x3583b6(0x20f),'name':_0x3583b6(0x264),'warehouse_category':_0x3583b6(0x1d3)}},{'$group':{'_id':_0x3583b6(0x1d9),'name':{'$first':_0x3583b6(0x1d9)}}},{'$sort':{'name':0x1}}]);var _0x2550d2=[_0x3583b6(0x1f5)];if(_0x40f4f5[0x0][_0x3583b6(0x1e1)]==_0x3583b6(0x255)){var _0x1451d7=users[_0x3583b6(0x1c8)];console['log'](_0x1451d7);}else{if(_0x40f4f5[0x0][_0x3583b6(0x1e1)]==_0x3583b6(0x195))var _0x1451d7=users[_0x3583b6(0x195)];else{if(_0x40f4f5[0x0][_0x3583b6(0x1e1)]==_0x3583b6(0x1cc))var _0x1451d7=users[_0x3583b6(0x1cc)];else{if(_0x40f4f5[0x0]['language']=='Spanish')var _0x1451d7=users[_0x3583b6(0x1f0)];else{if(_0x40f4f5[0x0][_0x3583b6(0x1e1)]=='French')var _0x1451d7=users[_0x3583b6(0x20a)];else{if(_0x40f4f5[0x0]['language']=='Portuguese\x20(BR)')var _0x1451d7=users[_0x3583b6(0x256)];else{if(_0x40f4f5[0x0][_0x3583b6(0x1e1)]=='Chinese')var _0x1451d7=users[_0x3583b6(0x230)];else{if(_0x40f4f5[0x0][_0x3583b6(0x1e1)]==_0x3583b6(0x217))var _0x1451d7=users['Arabic'];}}}}}}}_0x30a336[_0x3583b6(0x261)](_0x3583b6(0x1dc),{'success':_0x3606c7[_0x3583b6(0x263)]('success'),'errors':_0x3606c7[_0x3583b6(0x263)](_0x3583b6(0x1df)),'role':_0xa07575,'profile':_0x3b930b,'user':_0x4598df,'stock':_0x3d40ca,'master_shop':_0x40f4f5,'unit':_0x521c40,'language':_0x1451d7,'warehouses':warehouse_data,'rooms':_0x2550d2});}catch(_0x42fb27){console[_0x3583b6(0x213)](_0x42fb27),_0x30a336[_0x3583b6(0x1f3)](0xc8)[_0x3583b6(0x25c)]({'message':_0x42fb27[_0x3583b6(0x232)]});}}),router[a0_0x28d369(0x286)](a0_0x28d369(0x22d),auth,async(_0x378aab,_0x9dd827)=>{var _0x378da7=a0_0x28d369;try{const {invoice:_0x4e8343,date:_0x2ffbe3,warehouse_name:_0x377333,product_name:_0xb3d634,primary_code:_0x5d29ac,secondary_code:_0x20f015,product_code:_0x405960,sales_quantity:_0x236935,stocks:_0x3ff3f3,return_qty:_0x48a2e6,Room_name:_0x476cb5,to_warehouse_name:_0x4953d8,to_Roomname:_0x21fbf1,to_Room_name:_0x321173,note:_0xd5ebd0,level:_0x448fe7,isle:_0x27cd62,pallet:_0x229236}=_0x378aab[_0x378da7(0x241)];if(typeof _0xb3d634==_0x378da7(0x190))var _0x443b93=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x1a8)]],_0x283326=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x203)]],_0x3cbc69=[_0x378aab[_0x378da7(0x241)]['secondary_code']],_0x466003=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x267)]],_0x47cdcd=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x215)]],_0x4ffa96=[_0x378aab[_0x378da7(0x241)]['stocks']],_0x5a8b79=[_0x378aab['body'][_0x378da7(0x1ed)]],_0x5ef197=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x196)]],_0x207e49=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x280)]],_0xf6cb18=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x1c4)]],_0x1cc51e=[_0x378aab[_0x378da7(0x241)][_0x378da7(0x1af)]];else var _0x443b93=[..._0x378aab[_0x378da7(0x241)][_0x378da7(0x1a8)]],_0x283326=[..._0x378aab[_0x378da7(0x241)]['primary_code']],_0x3cbc69=[..._0x378aab[_0x378da7(0x241)][_0x378da7(0x235)]],_0x466003=[..._0x378aab[_0x378da7(0x241)][_0x378da7(0x267)]],_0x47cdcd=[..._0x378aab['body'][_0x378da7(0x215)]],_0x4ffa96=[..._0x378aab['body'][_0x378da7(0x1b5)]],_0x5a8b79=[..._0x378aab[_0x378da7(0x241)][_0x378da7(0x1ed)]],_0x5ef197=[..._0x378aab[_0x378da7(0x241)]['bay']],_0x207e49=[..._0x378aab[_0x378da7(0x241)][_0x378da7(0x280)]],_0xf6cb18=[..._0x378aab['body']['types']],_0x1cc51e=[..._0x378aab[_0x378da7(0x241)]['floorlevel']];const _0x13d5ee=_0x443b93['map'](_0x549e24=>{return _0x549e24={'product_name':_0x549e24};});_0x283326[_0x378da7(0x288)]((_0x5e4d40,_0x1cc006)=>{var _0xe5e8b4=_0x378da7;_0x13d5ee[_0x1cc006][_0xe5e8b4(0x203)]=_0x5e4d40;}),_0x3cbc69[_0x378da7(0x288)]((_0x3edbad,_0x1e1b42)=>{var _0x218a3e=_0x378da7;_0x13d5ee[_0x1e1b42][_0x218a3e(0x235)]=_0x3edbad;}),_0x466003['forEach']((_0x227629,_0x79da61)=>{var _0x35b5e4=_0x378da7;_0x13d5ee[_0x79da61][_0x35b5e4(0x267)]=_0x227629;}),_0x47cdcd[_0x378da7(0x288)]((_0x47affb,_0x5a45a9)=>{_0x13d5ee[_0x5a45a9]['sale_qty']=_0x47affb;}),_0x4ffa96[_0x378da7(0x288)]((_0x76377b,_0x2add06)=>{_0x13d5ee[_0x2add06]['stock']=_0x76377b;}),_0x5a8b79[_0x378da7(0x288)]((_0xa98d9,_0xea5d40)=>{_0x13d5ee[_0xea5d40]['return_qty']=_0xa98d9;}),_0x5ef197[_0x378da7(0x288)]((_0x29bfcb,_0x5d8f31)=>{var _0x424457=_0x378da7;_0x13d5ee[_0x5d8f31][_0x424457(0x196)]=_0x29bfcb;}),_0x207e49[_0x378da7(0x288)]((_0x215849,_0x4672af)=>{var _0x5ac049=_0x378da7;_0x13d5ee[_0x4672af][_0x5ac049(0x280)]=_0x215849;}),_0xf6cb18[_0x378da7(0x288)]((_0x537824,_0x198c59)=>{var _0x289e74=_0x378da7;_0x13d5ee[_0x198c59][_0x289e74(0x1db)]=_0x537824;}),_0x1cc51e[_0x378da7(0x288)]((_0xeda9b9,_0x4ecac4)=>{_0x13d5ee[_0x4ecac4]['floorlevel']=_0xeda9b9;});var _0x262a00=0x0;_0x13d5ee[_0x378da7(0x288)](_0x5a69b3=>{var _0x20087e=_0x378da7;console['log']('foreach\x20newproduct',_0x5a69b3),(parseInt(_0x5a69b3[_0x20087e(0x1bb)])<parseInt(_0x5a69b3[_0x20087e(0x1ed)])||parseInt(_0x5a69b3[_0x20087e(0x1e6)])<parseInt(_0x5a69b3[_0x20087e(0x1ed)])&&parseInt(_0x5a69b3[_0x20087e(0x1bb)])>parseInt(_0x5a69b3[_0x20087e(0x1ed)])||parseInt(_0x5a69b3[_0x20087e(0x1ed)])==0x0)&&_0x262a00++;});if(_0x262a00!=0x0)return _0x378aab[_0x378da7(0x263)](_0x378da7(0x1df),_0x378da7(0x277)),_0x9dd827[_0x378da7(0x290)](_0x378da7(0x25e));const _0xfe03d9=await sales[_0x378da7(0x272)]({'invoice':_0x4e8343});console[_0x378da7(0x213)](_0xfe03d9),_0xfe03d9[_0x378da7(0x1ba)]=_0x378da7(0x25a);const _0x573e8a=await _0xfe03d9[_0x378da7(0x1b3)](),_0xc4c545=new sales_return({'invoice':_0x4e8343,'customer':_0x378aab[_0x378da7(0x241)][_0x378da7(0x246)],'date':_0x2ffbe3,'warehouse_name':_0x377333,'room':_0x476cb5,'ToWarehouse':_0x4953d8,'ToRoom':_0x321173,'return_sale':_0x13d5ee,'note':_0xd5ebd0}),_0x1bb810=await _0xc4c545[_0x378da7(0x1b3)]();console[_0x378da7(0x213)](_0xc4c545);const _0x4bfef9=await sales_return[_0x378da7(0x272)]({'invoice':_0x4e8343}),_0x245647=await warehouse[_0x378da7(0x272)]({'name':_0x4953d8,'room':_0x321173});_0x4bfef9[_0x378da7(0x1dc)][_0x378da7(0x288)](_0x125b68=>{var _0x248f5c=_0x378da7,_0x5a6cbb=0x0;const _0x1859db=_0x245647['product_details'][_0x248f5c(0x28f)](_0x17ed21=>{var _0x5a215d=_0x248f5c;_0x17ed21[_0x5a215d(0x1a8)]==_0x125b68[_0x5a215d(0x1a8)]&&_0x17ed21[_0x5a215d(0x1af)]==_0x125b68[_0x5a215d(0x1af)]&&_0x17ed21['type']==_0x125b68['type']&&_0x17ed21[_0x5a215d(0x280)]==_0x125b68['bin']&&_0x17ed21[_0x5a215d(0x196)]==_0x125b68[_0x5a215d(0x196)]&&(_0x17ed21[_0x5a215d(0x1d6)]=parseInt(_0x17ed21[_0x5a215d(0x1d6)])+parseInt(_0x125b68[_0x5a215d(0x1ed)]),_0x5a6cbb++);});_0x5a6cbb=='0'&&(_0x245647[_0x248f5c(0x231)]=_0x245647[_0x248f5c(0x231)]['concat']({'product_name':_0x125b68[_0x248f5c(0x1a8)],'product_stock':_0x125b68[_0x248f5c(0x1ed)],'primary_code':_0x125b68[_0x248f5c(0x203)],'secondary_code':_0x125b68[_0x248f5c(0x235)],'product_code':_0x125b68['product_code'],'bay':_0x125b68[_0x248f5c(0x196)],'bin':_0x125b68[_0x248f5c(0x280)],'type':_0x125b68[_0x248f5c(0x1db)],'floorlevel':_0x125b68[_0x248f5c(0x1af)]})),console[_0x248f5c(0x213)](_0x248f5c(0x23b),_0x245647);}),await _0x245647[_0x378da7(0x1b3)](),console[_0x378da7(0x213)](_0x378aab[_0x378da7(0x241)]);const _0x498d63=new c_payment_data({'invoice':_0x4e8343,'customer':_0x378aab[_0x378da7(0x241)][_0x378da7(0x246)],'reason':_0x378da7(0x270)});await _0x498d63[_0x378da7(0x1b3)]();const _0x3af2b7=await master_shop[_0x378da7(0x189)]();console[_0x378da7(0x213)]('add\x20post',_0x3af2b7[0x0][_0x378da7(0x1d7)]);const _0x3f34f6=await email_settings[_0x378da7(0x272)](),_0x3eb3cc=await customer[_0x378da7(0x272)]({'name':_0x378aab['body'][_0x378da7(0x246)]});console[_0x378da7(0x213)](_0x378da7(0x21f),_0x3eb3cc);_0x3af2b7[0x0]['currency_placement']==0x1?(right_currency=_0x3af2b7[0x0][_0x378da7(0x1c1)],left_currency=''):(right_currency='',left_currency=_0x3af2b7[0x0][_0x378da7(0x1c1)]);var _0x391fae=_0x443b93,_0x147a35=_0x5a8b79,_0x313435='',_0x300e7d;for(_0x300e7d in _0x391fae){_0x313435+=_0x378da7(0x23c)+_0x378da7(0x1da)+_0x391fae[_0x300e7d]+_0x378da7(0x258)+_0x378da7(0x1da)+_0x147a35[_0x300e7d]+'</td>'+_0x378da7(0x26a);}console['log'](_0x378da7(0x209),_0x313435);let _0x4887cd=nodemailer['createTransport']({'service':_0x378da7(0x279),'auth':{'user':_0x3f34f6[_0x378da7(0x227)],'pass':_0x3f34f6[_0x378da7(0x1b8)]}}),_0xc1b4e6={'from':_0x3f34f6[_0x378da7(0x227)],'to':_0x3eb3cc[_0x378da7(0x227)],'subject':_0x378da7(0x1b9),'attachments':[{'filename':_0x378da7(0x1a6),'path':__dirname+'/../public'+_0x378da7(0x1d5)+_0x3af2b7[0x0][_0x378da7(0x1d7)],'cid':_0x378da7(0x1fc)}],'html':'<!DOCTYPE\x20html>'+_0x378da7(0x19d)+_0x378da7(0x1ef)+'<div>'+_0x378da7(0x254)+_0x378da7(0x1e0)+_0x378da7(0x1e2)+_0x378da7(0x273)+_0x378da7(0x1e0)+_0x378da7(0x281)+_0x3af2b7[0x0][_0x378da7(0x19c)]+_0x378da7(0x26c)+_0x378da7(0x273)+'</div>'+_0x378da7(0x1f4)+'<div>'+_0x378da7(0x1b4)+_0x378da7(0x1d1)+_0x4e8343+'\x20'+_0x378da7(0x249)+'\x20Order\x20Date\x20:\x20'+_0x2ffbe3+'\x20'+_0x378da7(0x218)+'</h5>'+'</div>'+_0x378da7(0x1b2)+_0x378da7(0x1d2)+_0x378da7(0x23c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x378da7(0x19a)+_0x378da7(0x1fd)+_0x378da7(0x23e)+_0x378da7(0x26a)+'</thead>'+_0x378da7(0x211)+'\x20'+_0x313435+'\x20'+_0x378da7(0x1a1)+_0x378da7(0x1f6)+_0x378da7(0x1e0)+'<strong>\x20Regards\x20</strong>'+_0x378da7(0x199)+_0x3af2b7[0x0][_0x378da7(0x19c)]+_0x378da7(0x25f)+_0x378da7(0x273)+_0x378da7(0x273)+_0x378da7(0x1f8)};_0x4887cd['sendMail'](_0xc1b4e6,function(_0x2ecc4a,_0x5afd0d){var _0x36677c=_0x378da7;_0x2ecc4a?(console[_0x36677c(0x213)](_0x2ecc4a),console[_0x36677c(0x213)]('Error\x20Occurs')):console[_0x36677c(0x213)](_0x36677c(0x22c));}),_0x378aab['flash'](_0x378da7(0x20e),_0x378da7(0x221)),_0x9dd827[_0x378da7(0x290)]('/all_sales/view');}catch(_0x31a4ad){console[_0x378da7(0x213)](_0x31a4ad),_0x9dd827[_0x378da7(0x1f3)](0xc8)[_0x378da7(0x25c)]({'message1':_0x31a4ad[_0x378da7(0x232)]});}}),router['get'](a0_0x28d369(0x27b),auth,async(_0x42109d,_0xe88716)=>{var _0x2d41bc=a0_0x28d369;try{const {username:_0x51f352,email:_0x5491ff,role:_0x22bf66}=_0x42109d[_0x2d41bc(0x1d8)],_0x305675=_0x42109d[_0x2d41bc(0x1d8)],_0x5aca22=await profile[_0x2d41bc(0x272)]({'email':_0x305675[_0x2d41bc(0x227)]}),_0x1805d2=await master_shop[_0x2d41bc(0x189)]();console[_0x2d41bc(0x213)]('barcode\x20Product\x20master',_0x1805d2);const _0xeeee6c=_0x42109d[_0x2d41bc(0x1be)]['id'],_0x4170b6=await sales['findById'](_0xeeee6c);console['log'](_0x2d41bc(0x188),_0x4170b6);if(_0x1805d2[0x0][_0x2d41bc(0x1e1)]==_0x2d41bc(0x255))var _0x2e64b1=users[_0x2d41bc(0x1c8)];else{if(_0x1805d2[0x0]['language']==_0x2d41bc(0x195))var _0x2e64b1=users[_0x2d41bc(0x195)];else{if(_0x1805d2[0x0]['language']==_0x2d41bc(0x1cc))var _0x2e64b1=users[_0x2d41bc(0x1cc)];else{if(_0x1805d2[0x0][_0x2d41bc(0x1e1)]==_0x2d41bc(0x1f0))var _0x2e64b1=users['Spanish'];else{if(_0x1805d2[0x0][_0x2d41bc(0x1e1)]==_0x2d41bc(0x20a))var _0x2e64b1=users['French'];else{if(_0x1805d2[0x0][_0x2d41bc(0x1e1)]==_0x2d41bc(0x28e))var _0x2e64b1=users[_0x2d41bc(0x256)];else{if(_0x1805d2[0x0]['language']==_0x2d41bc(0x230))var _0x2e64b1=users[_0x2d41bc(0x230)];else{if(_0x1805d2[0x0][_0x2d41bc(0x1e1)]==_0x2d41bc(0x217))var _0x2e64b1=users[_0x2d41bc(0x1a0)];}}}}}}}_0xe88716[_0x2d41bc(0x261)](_0x2d41bc(0x214),{'success':_0x42109d[_0x2d41bc(0x263)]('success'),'errors':_0x42109d[_0x2d41bc(0x263)](_0x2d41bc(0x1df)),'role':_0x305675,'profile':_0x5aca22,'alldata':_0x4170b6,'master_shop':_0x1805d2,'language':_0x2e64b1});}catch(_0x923e35){console[_0x2d41bc(0x213)](_0x923e35);}}),router['post'](a0_0x28d369(0x28c),async(_0x4e5ffd,_0x3c8ca4)=>{var _0x337327=a0_0x28d369;const {product_code:_0x4b5dcb,warehouse_name:_0x7ca49f,rooms_data:_0x12c9fe,Roomslist:_0x26f2e7}=_0x4e5ffd[_0x337327(0x241)],_0x2f1aec=_0x26f2e7[_0x337327(0x18f)](','),_0x3470d4=[];async function _0x431a79(_0x27c76a){var _0x2fd6e4=_0x337327;const _0x5ecf60=await warehouse[_0x2fd6e4(0x207)]([{'$match':{'name':_0x7ca49f,'room':_0x27c76a}},{'$unwind':_0x2fd6e4(0x1dd)},{'$match':{'product_details.primary_code':_0x4b5dcb}},{'$group':{'_id':_0x2fd6e4(0x1c3),'name':{'$first':_0x2fd6e4(0x239)},'product_stock':{'$first':_0x2fd6e4(0x252)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2fd6e4(0x1e5)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2fd6e4(0x253)},'isle':{'$first':_0x2fd6e4(0x22a)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2fd6e4(0x289)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2fd6e4(0x201)},'expiry_date':{'$first':_0x2fd6e4(0x269)},'production_date':{'$first':_0x2fd6e4(0x1ca)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2fd6e4(0x24f)},'product_cat':{'$first':_0x2fd6e4(0x18a)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2fd6e4(0x22f)},'invoice':{'$first':_0x2fd6e4(0x1f7)},'actual_qty':{'$first':_0x2fd6e4(0x1b0)},'actual_uom':{'$first':_0x2fd6e4(0x259)}}}]),_0x533494=await warehouse[_0x2fd6e4(0x207)]([{'$match':{'name':_0x7ca49f,'room':_0x27c76a}},{'$unwind':_0x2fd6e4(0x1dd)},{'$match':{'product_details.secondary_code':_0x4b5dcb}},{'$group':{'_id':_0x2fd6e4(0x1c3),'name':{'$first':_0x2fd6e4(0x239)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2fd6e4(0x222)},'secondary_code':{'$first':_0x2fd6e4(0x1e5)},'product_code':{'$first':_0x2fd6e4(0x27f)},'level':{'$first':_0x2fd6e4(0x253)},'isle':{'$first':_0x2fd6e4(0x22a)},'type':{'$first':_0x2fd6e4(0x28a)},'pallet':{'$first':_0x2fd6e4(0x289)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2fd6e4(0x202)},'storage':{'$first':_0x2fd6e4(0x219)},'rack':{'$first':_0x2fd6e4(0x201)},'expiry_date':{'$first':_0x2fd6e4(0x269)},'production_date':{'$first':_0x2fd6e4(0x1ca)},'maxPerUnit':{'$first':_0x2fd6e4(0x1c0)},'batch_code':{'$first':_0x2fd6e4(0x24f)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2fd6e4(0x22f)},'invoice':{'$first':_0x2fd6e4(0x1f7)}}}]);if(_0x5ecf60[_0x2fd6e4(0x1eb)]>0x0)_0x3470d4[_0x2fd6e4(0x27a)](_0x5ecf60);else _0x533494[_0x2fd6e4(0x1eb)]>0x0&&_0x3470d4[_0x2fd6e4(0x27a)](_0x533494);}const _0x6ec68f=_0x2f1aec['map'](_0x290369=>_0x431a79(_0x290369));await Promise[_0x337327(0x21d)](_0x6ec68f),_0x3c8ca4[_0x337327(0x25c)](_0x3470d4);}),module[a0_0x28d369(0x1cd)]=router;