var a0_0x1d5e30=a0_0x2be9;(function(_0x24913f,_0x17f3bb){var _0x30208e=a0_0x2be9,_0x2b3538=_0x24913f();while(!![]){try{var _0x26ad92=parseInt(_0x30208e(0x2f3))/0x1+parseInt(_0x30208e(0x298))/0x2*(-parseInt(_0x30208e(0x2ad))/0x3)+parseInt(_0x30208e(0x2a1))/0x4*(-parseInt(_0x30208e(0x225))/0x5)+-parseInt(_0x30208e(0x2c4))/0x6+-parseInt(_0x30208e(0x240))/0x7+-parseInt(_0x30208e(0x2f6))/0x8+parseInt(_0x30208e(0x29f))/0x9*(parseInt(_0x30208e(0x27b))/0xa);if(_0x26ad92===_0x17f3bb)break;else _0x2b3538['push'](_0x2b3538['shift']());}catch(_0x47dc84){_0x2b3538['push'](_0x2b3538['shift']());}}}(a0_0x14af,0xb45a7));const express=require(a0_0x1d5e30(0x207)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1d5e30(0x2c2)),auth=require(a0_0x1d5e30(0x208)),nodemailer=require(a0_0x1d5e30(0x29e)),users=require(a0_0x1d5e30(0x241));function a0_0x14af(){var _0x1931cc=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','all_sales','$sale_product.bay','$name','Portuguese','user','</head><body>','return_qty','/view/add_sale/product','aggregate','RMSEmail','$customers_docs','prod_invoice','params','/view/return_sales/:id','Arabic','</td>','Email\x20sent\x20successfully','bin','Shelves','errors','primary_code','filter','<div>','actual_uom','Enabled','stocks','28496550DNiQEd','</div>','$isAllowEdit','error','secondary_unit','return_sale','prod_code','_id','product_code','expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','Spanish','$product_details.product_name','$_id','maxperunit','logo','Receiving\x20Area','find','$product_details.product_stock','<tr>','delivery_code','$date','Floor','customers_docs','prod_cat','Arabic\x20(ae)','Received\x20Payment\x20For\x20Sale','amount','Sales\x20Update\x20successfully','30UCVgdi','Sale\x20Return','get','name','product_data','/barcode_scanner','nodemailer','9xfxmEh','barcode\x20user_id','24UuYDBM','types','$customer','payment\x20successfull','finalize','sales_quantity','$product_details.expiry_date','$product_details.secondary_unit','unit','$room','stock_data','edit_sales','13077bVyGvx','secondary_code','$sale_product.bin','/../public','room_name','warehouse_name','port','An\x20error\x20occurred.','findOne','Enclosed','success','\x20</h2>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_details','redirect','date','</tbody>','batch_code','/view/:id','/upload/','json','../models/all_models','delivery_date','5304384AGppVH','email','save','password','Return\x20Rooms','body','\x20Order\x20Number\x20:\x20','$sale_product.type','sale_qty','max_per_unit','$sale_product.quantity','$product_details.secondary_code','product_name','note','Portuguese\x20(BR)','log','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/all_sales/preview/','random','rack','$product_details.floorlevel','post','$finalize','final','requested_qty','</thead>','$product_details.bay','/all_sales/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.maxPerUnit','Ambient','<hr\x20class=\x22my-3\x22>','$product_details.level','bay','False','</span>','$product','$product_details.invoice','Sales\x20Add\x20successfully','sale_product','Sales\x20Mail','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','catch','$return_data','foreach\x20newproduct','934135JAkjIy','$product_details.unit','level','8099784AoTnjc','status','$product_details.primary_code','getMonth','Error\x20Occurs','staff','id_transaction_from','Chinese','quantity_notConverted','primary_unit','carton','floor','return_data','$product_details.batch_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','production_date','image','$product_details','$product_details.isle','storage','findById','Return\x20Goods','<table\x20style=\x22width:\x20100%\x20!important;\x22>','forEach','exports','flash','\x20Order\x20Date\x20:\x20','German','currency_placement','master','Raw\x20Materials','actual_qty','express','../middleware/auth','warehouse','max','<html><head><title></title>','abs','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','quantity','$note','OUT-','isAllowEdit','type','<h5\x20style=\x22text-align:\x20left;\x22>','RoomAssigned','customers','then','$product_details.storage','</tr>','/view/add_sales','stock','$product_details.product_code','language','Logo.png','$invoice','length','room','slice','$product.product_name','getFullYear','433375evRkmo','invoice','/give_payment/:id','$sale_product','map','floorlevel','$product_details.production_date','Level','$product_details.type','$product_details.actual_qty','sales\x20item\x20return\x20successfull','back','message','True','sales\x20all_data','Hindi','</h5>','English\x20(US)','due_amount','$sale_product.floorlevel','currency','customer','</body></html>','concat','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','id_transact','/view','3941637OGsIEY','../public/language/languages.json','sendMail','all','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','received_amount','English','string','/invoice/:id','site_title','$product_details.bin','<!DOCTYPE\x20html>','all_sales_barcode','$product_details.pallet','$product_details.product_cat','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','French','<h5>','<span\x20style=\x22float:\x20right;\x22>','product_list','$product_details.rack','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details._id','</table>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','push','render','<h2>\x20'];a0_0x14af=function(){return _0x1931cc;};return a0_0x14af();}router['get'](a0_0x1d5e30(0x23f),auth,async(_0x4a6c13,_0x59abc0)=>{var _0x3c430c=a0_0x1d5e30;try{const {username:_0xdc78e2,email:_0x1b99ad,role:_0x3843e9}=_0x4a6c13[_0x3c430c(0x265)],_0x24c013=_0x4a6c13[_0x3c430c(0x265)],_0x1aa01f=await profile[_0x3c430c(0x2b5)]({'email':_0x24c013[_0x3c430c(0x2c5)]}),_0x11995=await master_shop[_0x3c430c(0x28c)]();let _0x2570bd;if(_0x24c013[_0x3c430c(0x20d)]==_0x3c430c(0x2fb)){const _0x4f9645=await staff['findOne']({'email':_0x24c013[_0x3c430c(0x2c5)]});_0x2570bd=await sales[_0x3c430c(0x269)]([{'$lookup':{'from':_0x3c430c(0x216),'localField':_0x3c430c(0x23a),'foreignField':_0x3c430c(0x29b),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x3c430c(0x228)},{'$group':{'_id':_0x3c430c(0x288),'invoice':{'$first':_0x3c430c(0x21f)},'customers':{'$first':_0x3c430c(0x2a3)},'date':{'$first':_0x3c430c(0x290)},'warehouse_name':{'$first':_0x3c430c(0x2d4)},'sale_product':{'$push':_0x3c430c(0x228)},'note':{'$first':'$note'},'return_data':{'$first':_0x3c430c(0x2f1)},'customers_docs':{'$first':_0x3c430c(0x26b)},'total_saleproduct_quantity':{'$sum':_0x3c430c(0x2ce)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x3c430c(0x2af)},'type':{'$addToSet':_0x3c430c(0x2cb)},'pallet':{'$addToSet':_0x3c430c(0x238)},'finalize':{'$first':_0x3c430c(0x2db)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2570bd=await sales[_0x3c430c(0x269)]([{'$lookup':{'from':_0x3c430c(0x216),'localField':_0x3c430c(0x23a),'foreignField':_0x3c430c(0x29b),'as':_0x3c430c(0x292)}},{'$unwind':_0x3c430c(0x26b)},{'$unwind':_0x3c430c(0x228)},{'$group':{'_id':_0x3c430c(0x288),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3c430c(0x2a3)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3c430c(0x2d4)},'sale_product':{'$push':_0x3c430c(0x228)},'note':{'$first':_0x3c430c(0x210)},'return_data':{'$first':_0x3c430c(0x2f1)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3c430c(0x262)},'isle':{'$addToSet':_0x3c430c(0x2af)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x3c430c(0x238)},'finalize':{'$first':_0x3c430c(0x2db)},'isAllowEdit':{'$first':_0x3c430c(0x27d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3c430c(0x2d3)](_0x3c430c(0x233),_0x2570bd);if(_0x11995[0x0]['language']==_0x3c430c(0x236)){var _0x262075=users[_0x3c430c(0x247)];console[_0x3c430c(0x2d3)](_0x262075);}else{if(_0x11995[0x0]['language']==_0x3c430c(0x234))var _0x262075=users[_0x3c430c(0x234)];else{if(_0x11995[0x0]['language']==_0x3c430c(0x202))var _0x262075=users['German'];else{if(_0x11995[0x0][_0x3c430c(0x21d)]==_0x3c430c(0x286))var _0x262075=users[_0x3c430c(0x286)];else{if(_0x11995[0x0][_0x3c430c(0x21d)]==_0x3c430c(0x253))var _0x262075=users[_0x3c430c(0x253)];else{if(_0x11995[0x0][_0x3c430c(0x21d)]==_0x3c430c(0x2d2))var _0x262075=users[_0x3c430c(0x264)];else{if(_0x11995[0x0][_0x3c430c(0x21d)]==_0x3c430c(0x2fd))var _0x262075=users[_0x3c430c(0x2fd)];else{if(_0x11995[0x0][_0x3c430c(0x21d)]=='Arabic\x20(ae)')var _0x262075=users['Arabic'];}}}}}}}_0x59abc0['render'](_0x3c430c(0x261),{'success':_0x4a6c13[_0x3c430c(0x200)]('success'),'errors':_0x4a6c13[_0x3c430c(0x200)](_0x3c430c(0x274)),'sales':_0x2570bd,'profile':_0x1aa01f,'role':_0x24c013,'master_shop':_0x11995,'language':_0x262075});}catch(_0x229f36){console['log'](_0x229f36);}});async function getRandom8DigitNumber(){var _0x885e1b=a0_0x1d5e30;const _0x19a700=0x989680,_0x1ca6ef=0x5f5e0ff,_0x28a664=Math[_0x885e1b(0x301)](Math[_0x885e1b(0x2d7)]()*(_0x1ca6ef-_0x19a700+0x1))+_0x19a700;var _0x5946b9;const _0x2c8572=await sales[_0x885e1b(0x2b5)]({'invoice':_0x885e1b(0x211)+_0x28a664});return _0x2c8572&&_0x2c8572['length']>0x0?_0x5946b9=_0x885e1b(0x211)+_0x28a664:_0x5946b9=_0x885e1b(0x211)+_0x28a664,_0x5946b9;}function a0_0x2be9(_0x1f571b,_0x4fa523){var _0x14af6c=a0_0x14af();return a0_0x2be9=function(_0x2be9b1,_0x229240){_0x2be9b1=_0x2be9b1-0x1f4;var _0x43b21a=_0x14af6c[_0x2be9b1];return _0x43b21a;},a0_0x2be9(_0x1f571b,_0x4fa523);}router[a0_0x1d5e30(0x29a)]('/view/add_sales',auth,async(_0x1f6ae1,_0x2a99d7)=>{var _0x2ace7e=a0_0x1d5e30;try{const {username:_0x34f5c8,email:_0x1405b0,role:_0x584996}=_0x1f6ae1[_0x2ace7e(0x265)],_0x2f487d=_0x1f6ae1['user'],_0x13b191=await profile[_0x2ace7e(0x2b5)]({'email':_0x2f487d['email']}),_0x4e2d20=await master_shop[_0x2ace7e(0x28c)](),_0x2ea582=await customer[_0x2ace7e(0x28c)]({});let _0x51c9dd;if(_0x2f487d['role']==_0x2ace7e(0x2fb)){const _0x4f695b=await staff[_0x2ace7e(0x2b5)]({'email':_0x2f487d[_0x2ace7e(0x2c5)]});_0x51c9dd=await warehouse[_0x2ace7e(0x269)]([{'$match':{'status':_0x2ace7e(0x279),'name':_0x4f695b['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x2ace7e(0x263)}}},{'$sort':{'name':0x1}}]);}else _0x51c9dd=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x2ace7e(0x205),'name':{'$ne':_0x2ace7e(0x1fc)}}},{'$group':{'_id':_0x2ace7e(0x263),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x2d3c7b=await product[_0x2ace7e(0x28c)]({});var _0x586ec8=['Ambient',_0x2ace7e(0x2b6)];const _0x1d575a=await sales[_0x2ace7e(0x28c)]({}),_0x5c97f7=_0x1d575a['length']+0x1,_0xd2244e=_0x2ace7e(0x211)+_0x5c97f7['toString']()['padStart'](0x5,'0');if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]==_0x2ace7e(0x236)){var _0x5071cf=users['English'];console['log'](_0x5071cf);}else{if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]==_0x2ace7e(0x234))var _0x5071cf=users['Hindi'];else{if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]==_0x2ace7e(0x202))var _0x5071cf=users[_0x2ace7e(0x202)];else{if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]==_0x2ace7e(0x286))var _0x5071cf=users[_0x2ace7e(0x286)];else{if(_0x4e2d20[0x0]['language']==_0x2ace7e(0x253))var _0x5071cf=users[_0x2ace7e(0x253)];else{if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]==_0x2ace7e(0x2d2))var _0x5071cf=users[_0x2ace7e(0x264)];else{if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]==_0x2ace7e(0x2fd))var _0x5071cf=users[_0x2ace7e(0x2fd)];else{if(_0x4e2d20[0x0][_0x2ace7e(0x21d)]=='Arabic\x20(ae)')var _0x5071cf=users[_0x2ace7e(0x26f)];}}}}}}}const _0x43063f=getRandom8DigitNumber();_0x43063f[_0x2ace7e(0x217)](_0x382472=>{var _0x571b4a=_0x2ace7e;_0x2a99d7[_0x571b4a(0x25e)]('add_sales',{'success':_0x1f6ae1[_0x571b4a(0x200)]('success'),'errors':_0x1f6ae1[_0x571b4a(0x200)](_0x571b4a(0x274)),'role':_0x2f487d,'profile':_0x13b191,'customer':_0x2ea582,'warehouse':_0x51c9dd,'product':_0x2d3c7b,'invoice':_0x382472,'master_shop':_0x4e2d20,'language':_0x5071cf,'rooms_data':_0x586ec8});})[_0x2ace7e(0x2f0)](_0x24c404=>{var _0x7be5e1=_0x2ace7e;_0x1f6ae1[_0x7be5e1(0x200)](_0x7be5e1(0x274),_0x7be5e1(0x1f5)),_0x2a99d7['redirect'](_0x7be5e1(0x2e0));});}catch(_0x278731){console[_0x2ace7e(0x2d3)](_0x278731);}}),router[a0_0x1d5e30(0x29a)]('/view/add_sales/:id',auth,async(_0x56d288,_0x482cab)=>{var _0x396dd9=a0_0x1d5e30;try{const _0x686785=_0x56d288[_0x396dd9(0x26d)]['id'];console[_0x396dd9(0x2d3)](_0x686785);const _0x5400ee=await product['find'](),_0x22db11=await purchases[_0x396dd9(0x269)]([{'$match':{'warehouse_name':_0x686785}},{'$unwind':_0x396dd9(0x2e9)},{'$group':{'_id':_0x396dd9(0x223)}}]);console['log'](_0x396dd9(0x2ee),_0x22db11),_0x482cab[_0x396dd9(0x2f7)](0xc8)[_0x396dd9(0x2c1)]({'purchases_data':_0x22db11,'product_data':_0x5400ee});}catch(_0x1e346a){console[_0x396dd9(0x2d3)](_0x1e346a);}}),router[a0_0x1d5e30(0x2da)](a0_0x1d5e30(0x268),auth,async(_0x16ade1,_0x1052d1)=>{var _0x4d5803=a0_0x1d5e30;try{const {warehouse_data:_0x376dfd,product_data:_0x2ca894}=_0x16ade1[_0x4d5803(0x2c9)];console[_0x4d5803(0x2d3)](_0x16ade1['body'][_0x4d5803(0x29c)]);;const _0x4fb537=await master_shop[_0x4d5803(0x28c)]();console[_0x4d5803(0x2d3)]('master',_0x4fb537);const _0x56c9be=await product[_0x4d5803(0x2b5)]({'name':_0x2ca894});console['log']('product',_0x56c9be);const _0x186706=await warehouse['aggregate']([{'$match':{'name':_0x376dfd}},{'$unwind':_0x4d5803(0x1f8)},{'$match':{'product_details.product_name':_0x2ca894}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x4d5803(0x2d3)](_0x4d5803(0x2ab),_0x186706),_0x1052d1[_0x4d5803(0x2f7)](0xc8)['json']({'master':_0x4fb537,'new_product':_0x56c9be,'stock_data':_0x186706});}catch(_0x5dff0c){console[_0x4d5803(0x2d3)](_0x5dff0c);}}),router['post'](a0_0x1d5e30(0x21a),auth,async(_0x5f9d60,_0x30dcff)=>{var _0x24acad=a0_0x1d5e30;try{const {invoice:_0x556840,date:_0x58d8c9,warehouse_name:_0x1a9feb,product_name:_0x218a17,stock:_0x169224,quantity:_0x141b35,note:_0x3290ab,room:_0x2f8de1,primary_code:_0x35a3c1,secondary_code:_0x387ca4,prod_code:_0x22c1d9,level:_0x35f169,isle:_0x1366df,pallet:_0x409846,batch_code:_0x3984de,SCRN:_0x152e9e,expiry_date:_0x14b424}=_0x5f9d60[_0x24acad(0x2c9)];if(typeof _0x218a17==_0x24acad(0x248))var _0x3545fe=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2d0)]],_0xf49bd7=[_0x5f9d60[_0x24acad(0x2c9)]['stock']],_0x223388=[_0x5f9d60['body']['carton']],_0x5810c1=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x275)]],_0x64dbce=[_0x5f9d60[_0x24acad(0x2c9)]['secondary_code']],_0x5cf583=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x281)]],_0xb0a7ae=[_0x5f9d60[_0x24acad(0x2c9)]['level']],_0x124ed9=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2ff)]],_0x374cd9=[_0x5f9d60[_0x24acad(0x2c9)]['secondary_unit']],_0x43ffcb=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2be)]],_0x1a3eb3=[_0x5f9d60['body'][_0x24acad(0x284)]],_0x4d4507=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2cd)]],_0x4aef87=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x1f6)]],_0x313d93=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2dd)]],_0x26f667=[_0x5f9d60['body'][_0x24acad(0x2c3)]],_0x1dc048=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x28f)]],_0x416d35=[_0x5f9d60[_0x24acad(0x2c9)]['prod_cat']],_0x2c8d96=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x20f)]],_0x4a7026=[_0x5f9d60[_0x24acad(0x2c9)]['RoomAssigned']],_0x4a6e43=[_0x5f9d60['body']['prod_invoice']],_0x1a404f=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x206)]],_0x5d3d1d=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x278)]],_0x1dac4a=[_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x23e)]];else var _0x3545fe=[..._0x5f9d60['body'][_0x24acad(0x2d0)]],_0xf49bd7=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x21b)]],_0x223388=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x300)]],_0x5810c1=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x275)]],_0x64dbce=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2ae)]],_0x5cf583=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x281)]],_0xb0a7ae=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2f5)]],_0x124ed9=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2ff)]],_0x374cd9=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x27f)]],_0x43ffcb=[..._0x5f9d60['body'][_0x24acad(0x2be)]],_0x1a3eb3=[..._0x5f9d60[_0x24acad(0x2c9)]['expiry_date']],_0x4d4507=[..._0x5f9d60['body'][_0x24acad(0x2cd)]],_0x4aef87=[..._0x5f9d60['body'][_0x24acad(0x1f6)]],_0x313d93=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2dd)]],_0x26f667=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x2c3)]],_0x1dc048=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x28f)]],_0x416d35=[..._0x5f9d60['body'][_0x24acad(0x293)]],_0x2c8d96=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x20f)]],_0x4a7026=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x215)]],_0x4a6e43=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x26c)]],_0x1a404f=[..._0x5f9d60[_0x24acad(0x2c9)]['actual_qty']],_0x5d3d1d=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x278)]],_0x1dac4a=[..._0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x23e)]];const _0xb568b6=_0x3545fe[_0x24acad(0x229)](_0x285589=>{return _0x285589={'product_name':_0x285589};});_0xf49bd7['forEach']((_0x4c676d,_0x1d4e65)=>{var _0x1ff0d3=_0x24acad;_0xb568b6[_0x1d4e65][_0x1ff0d3(0x21b)]=Math['abs'](_0x4c676d);}),_0x1a404f['forEach']((_0x276a8d,_0x5990b3)=>{var _0x1aad05=_0x24acad;_0xb568b6[_0x5990b3][_0x1aad05(0x206)]=Math[_0x1aad05(0x20c)](_0x276a8d);}),_0x5d3d1d['forEach']((_0x500d3a,_0x23a776)=>{_0xb568b6[_0x23a776]['actual_uom']=_0x500d3a;}),_0x1dac4a['forEach']((_0x4292b7,_0x745b28)=>{var _0x13e3ee=_0x24acad;_0xb568b6[_0x745b28][_0x13e3ee(0x2fc)]=_0x4292b7;}),_0x223388[_0x24acad(0x1fe)]((_0x58679b,_0x585593)=>{var _0x3de465=_0x24acad;_0xb568b6[_0x585593][_0x3de465(0x20f)]=_0x58679b;}),_0x5810c1[_0x24acad(0x1fe)]((_0x362e0d,_0x2840e6)=>{_0xb568b6[_0x2840e6]['primary_code']=_0x362e0d;}),_0x64dbce['forEach']((_0x311f2c,_0x39718f)=>{var _0x2a1b35=_0x24acad;_0xb568b6[_0x39718f][_0x2a1b35(0x2ae)]=_0x311f2c;}),_0x5cf583[_0x24acad(0x1fe)]((_0x236a1d,_0x369c94)=>{var _0x27c22e=_0x24acad;_0xb568b6[_0x369c94][_0x27c22e(0x283)]=_0x236a1d;}),_0xb0a7ae[_0x24acad(0x1fe)]((_0x3112e0,_0x19217a)=>{var _0x2698e3=_0x24acad;_0x4a7026[_0x2698e3(0x1fe)]((_0x4a3a57,_0x1fb8e0)=>{var _0x100b33=_0x2698e3;if(_0x4a3a57==_0x100b33(0x28b)&&_0x19217a==_0x1fb8e0){var _0xc57189=_0x3112e0[_0x100b33(0x222)](0x3);_0xb568b6[_0x19217a][_0x100b33(0x1fa)]=_0x3112e0[0x0],_0xb568b6[_0x19217a]['rack']=_0x3112e0[0x1],_0xb568b6[_0x19217a]['bay']=0x0,_0xb568b6[_0x19217a][_0x100b33(0x272)]=0x0,_0xb568b6[_0x19217a][_0x100b33(0x213)]=_0x100b33(0x291),_0xb568b6[_0x19217a][_0x100b33(0x22a)]=_0xc57189;}else{if(_0x4a3a57==_0x100b33(0x273)&&_0x19217a==_0x1fb8e0){var _0xc57189=_0x3112e0['slice'](0x3);_0xb568b6[_0x19217a]['storage']=_0x3112e0[0x0],_0xb568b6[_0x19217a][_0x100b33(0x2d8)]=_0x3112e0[0x1],_0xb568b6[_0x19217a][_0x100b33(0x2e6)]=0x0,_0xb568b6[_0x19217a]['bin']=0x0,_0xb568b6[_0x19217a][_0x100b33(0x213)]=_0x100b33(0x291),_0xb568b6[_0x19217a][_0x100b33(0x22a)]=_0x3112e0[0x5];}else{if(_0x19217a==_0x1fb8e0){var _0x192175;if(_0x3112e0[0x4]=='L')_0x192175=_0x100b33(0x22c);else _0x3112e0[0x4]=='F'&&(_0x192175=_0x100b33(0x291));_0xb568b6[_0x19217a][_0x100b33(0x1fa)]=_0x3112e0[0x0],_0xb568b6[_0x19217a][_0x100b33(0x2d8)]=_0x3112e0[0x1],_0xb568b6[_0x19217a][_0x100b33(0x2e6)]=_0x3112e0[0x2],_0xb568b6[_0x19217a][_0x100b33(0x272)]=_0x3112e0[0x3],_0xb568b6[_0x19217a][_0x100b33(0x213)]=_0x192175,_0xb568b6[_0x19217a][_0x100b33(0x22a)]=_0x3112e0[0x5];}}}});}),_0x124ed9['forEach']((_0x1d4b9f,_0x433f4c)=>{var _0x34c112=_0x24acad;_0xb568b6[_0x433f4c][_0x34c112(0x2a9)]=_0x1d4b9f;}),_0x374cd9[_0x24acad(0x1fe)]((_0x4646f4,_0x69b1f0)=>{var _0x2e20e7=_0x24acad;_0xb568b6[_0x69b1f0][_0x2e20e7(0x27f)]=_0x4646f4;}),_0x43ffcb['forEach']((_0xe75b43,_0x5d239c)=>{_0xb568b6[_0x5d239c]['batch_code']=_0xe75b43;}),_0x1a3eb3['forEach']((_0x1b2a9f,_0x2da454)=>{var _0x274254=_0x24acad;_0xb568b6[_0x2da454][_0x274254(0x284)]=_0x1b2a9f;}),_0x4d4507['forEach']((_0x5be8bc,_0x54fb6e)=>{var _0x2e2ff5=_0x24acad;_0xb568b6[_0x54fb6e][_0x2e2ff5(0x289)]=_0x5be8bc;}),_0x4aef87[_0x24acad(0x1fe)]((_0x36e38c,_0x17702a)=>{_0xb568b6[_0x17702a]['production_date']=_0x36e38c;}),_0x313d93[_0x24acad(0x1fe)]((_0x575aa0,_0x4f78f2)=>{var _0x5af00a=_0x24acad;_0xb568b6[_0x4f78f2][_0x5af00a(0x2dd)]=_0x575aa0;}),_0x26f667['forEach']((_0xb61986,_0x2b63a2)=>{_0xb568b6[_0x2b63a2]['delivery_date']=_0xb61986;}),_0x1dc048[_0x24acad(0x1fe)]((_0x430412,_0x23fa62)=>{var _0x46d5d2=_0x24acad;_0xb568b6[_0x23fa62][_0x46d5d2(0x28f)]=_0x430412;}),_0x416d35['forEach']((_0x9ca44c,_0x5f3e57)=>{var _0x4101f7=_0x24acad;_0xb568b6[_0x5f3e57][_0x4101f7(0x293)]=_0x9ca44c;}),_0x2c8d96[_0x24acad(0x1fe)]((_0x1d344c,_0x3845a1)=>{var _0x5ee67c=_0x24acad;_0xb568b6[_0x3845a1][_0x5ee67c(0x2fe)]=_0x1d344c;}),_0x4a7026['forEach']((_0x4f2be8,_0xc8b386)=>{var _0x664953=_0x24acad;_0xb568b6[_0xc8b386][_0x664953(0x2b1)]=_0x4f2be8;}),_0x4a6e43['forEach']((_0x1df69b,_0x11e057)=>{var _0x3753c8=_0x24acad;_0xb568b6[_0x11e057][_0x3753c8(0x226)]=_0x1df69b;});var _0x13823e=0x0;_0xb568b6[_0x24acad(0x1fe)](_0x3f71aa=>{var _0x3bcaef=_0x24acad;(_0x3f71aa['stock']<_0x3f71aa[_0x3bcaef(0x2fe)]||_0x3f71aa[_0x3bcaef(0x2fe)]==0x0)&&(console[_0x3bcaef(0x2d3)](_0x3bcaef(0x2f2),_0x3f71aa),_0x13823e++);});const _0x485dc6=_0xb568b6['filter'](_0x46ae95=>_0x46ae95['quantity']!=='0'&&_0x46ae95[_0x24acad(0x20f)]!==''),_0x59b360=new sales({'invoice':_0x556840,'customer':_0x5f9d60[_0x24acad(0x2c9)][_0x24acad(0x23a)],'date':_0x58d8c9,'warehouse_name':_0x1a9feb,'sale_product':_0x485dc6,'note':_0x3290ab,'room':_0x2f8de1,'primary_code':_0x35a3c1,'secondary_code':_0x387ca4,'prod_code':_0x22c1d9,'SCRN':_0x152e9e}),_0x1280b5=await _0x59b360[_0x24acad(0x2c6)]();_0x5f9d60['flash'](_0x24acad(0x2b7),_0x24acad(0x2eb)),_0x30dcff['redirect'](_0x24acad(0x2d6)+_0x1280b5[_0x24acad(0x282)]);}catch(_0x33a2ef){console['log'](_0x33a2ef);}}),router[a0_0x1d5e30(0x29a)]('/preview/:id',auth,async(_0x553d5e,_0x29a890)=>{var _0x2f49b9=a0_0x1d5e30;try{const {username:_0x1ecc79,email:_0x13a48a,role:_0x5d1cf8}=_0x553d5e['user'],_0xbeaf78=_0x553d5e['user'],_0x179c4c=await profile[_0x2f49b9(0x2b5)]({'email':_0xbeaf78[_0x2f49b9(0x2c5)]}),_0x90038=await master_shop['find'](),_0x12799d=_0x553d5e[_0x2f49b9(0x26d)]['id'],_0x56a541=await sales[_0x2f49b9(0x1fb)](_0x12799d),_0x2af069=await warehouse['aggregate']([{'$match':{'name':_0x56a541[_0x2f49b9(0x2b2)]}},{'$unwind':_0x2f49b9(0x1f8)},{'$group':{'_id':_0x2f49b9(0x259),'name':{'$first':_0x2f49b9(0x287)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2f49b9(0x24b)},'type':{'$first':_0x2f49b9(0x22d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2f49b9(0x2f8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2f49b9(0x21c)},'storage':{'$first':_0x2f49b9(0x218)},'rack':{'$first':_0x2f49b9(0x257)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2f49b9(0x22b)},'invoice':{'$first':_0x2f49b9(0x2ea)}}}]),_0x47c849=await customer[_0x2f49b9(0x28c)]({});let _0x3a648e;if(_0xbeaf78[_0x2f49b9(0x20d)]==_0x2f49b9(0x2fb)){const _0x27d4e4=await staff[_0x2f49b9(0x2b5)]({'email':_0xbeaf78[_0x2f49b9(0x2c5)]});_0x3a648e=await warehouse[_0x2f49b9(0x269)]([{'$match':{'status':_0x2f49b9(0x279),'name':_0x27d4e4[_0x2f49b9(0x209)]}},{'$group':{'_id':_0x2f49b9(0x263),'name':{'$first':'$name'}}}]);}else _0x3a648e=await warehouse[_0x2f49b9(0x269)]([{'$match':{'status':_0x2f49b9(0x279)}},{'$group':{'_id':'$name','name':{'$first':_0x2f49b9(0x263)}}}]);const _0x2d7aec=await product[_0x2f49b9(0x28c)]({}),_0x5f8c73=await suppliers['find']({});if(_0x90038[0x0][_0x2f49b9(0x21d)]==_0x2f49b9(0x236)){var _0x56bc71=users[_0x2f49b9(0x247)];console[_0x2f49b9(0x2d3)](_0x56bc71);}else{if(_0x90038[0x0][_0x2f49b9(0x21d)]==_0x2f49b9(0x234))var _0x56bc71=users[_0x2f49b9(0x234)];else{if(_0x90038[0x0][_0x2f49b9(0x21d)]==_0x2f49b9(0x202))var _0x56bc71=users[_0x2f49b9(0x202)];else{if(_0x90038[0x0][_0x2f49b9(0x21d)]=='Spanish')var _0x56bc71=users['Spanish'];else{if(_0x90038[0x0][_0x2f49b9(0x21d)]==_0x2f49b9(0x253))var _0x56bc71=users[_0x2f49b9(0x253)];else{if(_0x90038[0x0][_0x2f49b9(0x21d)]==_0x2f49b9(0x2d2))var _0x56bc71=users[_0x2f49b9(0x264)];else{if(_0x90038[0x0][_0x2f49b9(0x21d)]=='Chinese')var _0x56bc71=users[_0x2f49b9(0x2fd)];else{if(_0x90038[0x0]['language']=='Arabic\x20(ae)')var _0x56bc71=users['Arabic'];}}}}}}}_0x29a890[_0x2f49b9(0x25e)]('edit_sales_view',{'success':_0x553d5e[_0x2f49b9(0x200)](_0x2f49b9(0x2b7)),'errors':_0x553d5e[_0x2f49b9(0x200)](_0x2f49b9(0x274)),'role':_0xbeaf78,'profile':_0x179c4c,'customer':_0x47c849,'warehouse':_0x3a648e,'product':_0x2af069,'user':_0x56a541,'master_shop':_0x90038,'unit':_0x2d7aec,'language':_0x56bc71,'suppliers':_0x5f8c73});}catch(_0x31a2df){console['log'](_0x31a2df);}}),router['post']('/preview/:id',auth,async(_0xcc7f4d,_0x436272)=>{var _0x2754b6=a0_0x1d5e30;try{const _0x320d7c=_0xcc7f4d[_0x2754b6(0x26d)]['id'],{invoice:_0x3c2add,warehouse_name:_0x1e8041,room:_0x436a8b}=_0xcc7f4d['body'],_0x495f01=await sales[_0x2754b6(0x2b5)]({'invoice':_0x3c2add}),_0x1edc7a=_0x495f01[_0x2754b6(0x2ec)][_0x2754b6(0x229)](async _0x1805b5=>{var _0xa95f9f=_0x2754b6,_0x711b08=await warehouse[_0xa95f9f(0x2b5)]({'name':_0x1e8041,'room':_0x1805b5[_0xa95f9f(0x2b1)],'warehouse_category':'Raw\x20Materials'});const _0x298d7b=_0x711b08['product_details'][_0xa95f9f(0x229)](_0x400a25=>{var _0x38e573=_0xa95f9f;_0x400a25['product_name']==_0x1805b5[_0x38e573(0x2d0)]&&_0x400a25[_0x38e573(0x22a)]==_0x1805b5['floorlevel']&&_0x400a25[_0x38e573(0x213)]==_0x1805b5['type']&&_0x400a25[_0x38e573(0x272)]==_0x1805b5[_0x38e573(0x272)]&&_0x400a25[_0x38e573(0x2e6)]==_0x1805b5[_0x38e573(0x2e6)]&&_0x400a25[_0x38e573(0x2d8)]==_0x1805b5[_0x38e573(0x2d8)]&&_0x400a25[_0x38e573(0x1fa)]==_0x1805b5['storage']&&_0x400a25[_0x38e573(0x284)]==_0x1805b5[_0x38e573(0x284)]&&_0x400a25['batch_code']==_0x1805b5[_0x38e573(0x2be)]&&_0x400a25[_0x38e573(0x226)]==_0x1805b5[_0x38e573(0x226)]&&_0x400a25[_0x38e573(0x282)]==_0x1805b5[_0x38e573(0x2fc)]&&(_0x400a25['product_stock']=Math[_0x38e573(0x20a)](0x0,Math['abs'](_0x400a25['product_stock'])-Math[_0x38e573(0x20c)](_0x1805b5[_0x38e573(0x20f)])));});return _0x711b08;});Promise[_0x2754b6(0x243)](_0x1edc7a)[_0x2754b6(0x217)](async _0x3eb693=>{var _0x341b57=_0x2754b6;try{for(const _0x28aef0 of _0x3eb693){await _0x28aef0[_0x341b57(0x2c6)]();}_0x495f01['finalize']='True';const _0x1b2bdb=await _0x495f01[_0x341b57(0x2c6)](),_0x449789=await master_shop[_0x341b57(0x28c)](),_0x579688=await email_settings[_0x341b57(0x2b5)](),_0x41cc31=await supervisor_settings['find']();var _0x17d34d=_0x495f01[_0x341b57(0x2ec)],_0x4ff65d='',_0x19bf91;for(_0x19bf91 in _0x17d34d){_0x4ff65d+=_0x341b57(0x28e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x17d34d[_0x19bf91][_0x341b57(0x2d0)]+'</td>'+_0x341b57(0x25b)+_0x17d34d[_0x19bf91][_0x341b57(0x283)]+'</td>'+_0x341b57(0x25b)+_0x17d34d[_0x19bf91][_0x341b57(0x20f)]+_0x341b57(0x270)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x17d34d[_0x19bf91][_0x341b57(0x2a9)]+_0x341b57(0x270)+_0x341b57(0x25b)+_0x17d34d[_0x19bf91][_0x341b57(0x27f)]+'</td>'+_0x341b57(0x25b)+_0x495f01[_0x341b57(0x2b2)]+'</td>'+_0x341b57(0x25b)+_0x17d34d[_0x19bf91][_0x341b57(0x2b1)]+_0x341b57(0x270)+_0x341b57(0x25b)+_0x17d34d[_0x19bf91]['storage']+_0x17d34d[_0x19bf91][_0x341b57(0x2d8)]+_0x17d34d[_0x19bf91][_0x341b57(0x2e6)]+_0x17d34d[_0x19bf91]['bin']+_0x17d34d[_0x19bf91][_0x341b57(0x213)][0x0]+_0x17d34d[_0x19bf91]['floorlevel']+_0x341b57(0x270),_0x341b57(0x219);}let _0x2069e6=nodemailer['createTransport']({'host':_0x579688['host'],'port':Number(_0x579688[_0x341b57(0x2b3)]),'secure':![],'auth':{'user':_0x579688['email'],'pass':_0x579688[_0x341b57(0x2c7)]}}),_0x351e5c={'from':_0x579688[_0x341b57(0x2c5)],'to':_0x41cc31[0x0][_0x341b57(0x26a)],'subject':_0x341b57(0x2ed),'attachments':[{'filename':_0x341b57(0x21e),'path':__dirname+_0x341b57(0x2b0)+_0x341b57(0x2c0)+_0x449789[0x0][_0x341b57(0x1f7)],'cid':_0x341b57(0x28a)}],'html':_0x341b57(0x24c)+_0x341b57(0x20b)+_0x341b57(0x266)+_0x341b57(0x277)+_0x341b57(0x23d)+_0x341b57(0x277)+_0x341b57(0x2b9)+_0x341b57(0x27c)+_0x341b57(0x277)+_0x341b57(0x25f)+_0x449789[0x0][_0x341b57(0x24a)]+_0x341b57(0x2b8)+'</div>'+_0x341b57(0x27c)+'<hr\x20class=\x22my-3\x22>'+_0x341b57(0x277)+_0x341b57(0x214)+_0x341b57(0x2ca)+_0x495f01[_0x341b57(0x226)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x341b57(0x201)+_0x495f01[_0x341b57(0x2bc)]+'\x20'+_0x341b57(0x2e8)+_0x341b57(0x235)+'</div>'+_0x341b57(0x1fd)+_0x341b57(0x252)+_0x341b57(0x28e)+_0x341b57(0x260)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x341b57(0x251)+_0x341b57(0x20e)+_0x341b57(0x2ef)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x341b57(0x245)+_0x341b57(0x2e1)+'</tr>'+_0x341b57(0x2de)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4ff65d+'\x20'+_0x341b57(0x2bd)+_0x341b57(0x25a)+_0x341b57(0x277)+'<strong>\x20Regards\x20</strong>'+_0x341b57(0x254)+_0x449789[0x0][_0x341b57(0x24a)]+'</h5>'+_0x341b57(0x27c)+_0x341b57(0x27c)+_0x341b57(0x23b)};_0x2069e6[_0x341b57(0x242)](_0x351e5c,function(_0x118b0e,_0x1cd3dc){var _0xc4c47d=_0x341b57;_0x118b0e?(console[_0xc4c47d(0x2d3)](_0x118b0e),console[_0xc4c47d(0x2d3)](_0xc4c47d(0x2fa))):console[_0xc4c47d(0x2d3)](_0xc4c47d(0x271));}),_0xcc7f4d[_0x341b57(0x200)]('success',_0x341b57(0x297)),_0x436272[_0x341b57(0x2bb)](_0x341b57(0x2d6)+_0x320d7c);}catch(_0xfd6ef6){console[_0x341b57(0x27e)](_0xfd6ef6),_0x436272['status'](0x1f4)['json']({'error':_0x341b57(0x285)});}})['catch'](_0x414825=>{var _0x4b3c57=_0x2754b6;console['error'](_0x414825),_0x436272[_0x4b3c57(0x2f7)](0x1f4)[_0x4b3c57(0x2c1)]({'error':_0x4b3c57(0x2b4)});});}catch(_0x1468a3){console[_0x2754b6(0x2d3)](_0x1468a3);}}),router['get'](a0_0x1d5e30(0x2bf),auth,async(_0xccfb5f,_0x4a446a)=>{var _0x21e063=a0_0x1d5e30;try{const {username:_0x2721f8,email:_0x2b860c,role:_0x328783}=_0xccfb5f[_0x21e063(0x265)],_0x2b78c5=_0xccfb5f[_0x21e063(0x265)],_0x439bb0=await profile[_0x21e063(0x2b5)]({'email':_0x2b78c5[_0x21e063(0x2c5)]}),_0x1a4ebd=await master_shop[_0x21e063(0x28c)](),_0x507d01=_0xccfb5f[_0x21e063(0x26d)]['id'],_0x504e31=await sales[_0x21e063(0x1fb)](_0x507d01);var _0x9258f8=[_0x21e063(0x2e3),_0x21e063(0x2b6)];const _0x13a898=await warehouse['aggregate']([{'$match':{'name':_0x504e31['warehouse_name'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x21e063(0x1f8)},{'$group':{'_id':_0x21e063(0x259),'name':{'$first':_0x21e063(0x287)},'product_stock':{'$first':_0x21e063(0x28d)},'bay':{'$first':_0x21e063(0x2df)},'bin':{'$first':_0x21e063(0x24b)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x21e063(0x2f8)},'secondary_code':{'$first':_0x21e063(0x2cf)},'product_code':{'$first':_0x21e063(0x21c)},'storage':{'$first':_0x21e063(0x218)},'rack':{'$first':'$product_details.rack'}}}]),_0xefa11b=await customer['find']({});let _0x5770e8;if(_0x2b78c5['role']=='staff'){const _0x2525e0=await staff['findOne']({'email':_0x2b78c5[_0x21e063(0x2c5)]});_0x5770e8=await warehouse[_0x21e063(0x269)]([{'$match':{'status':_0x21e063(0x279),'name':_0x2525e0[_0x21e063(0x209)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x21e063(0x263)}}}]);}else _0x5770e8=await warehouse[_0x21e063(0x269)]([{'$match':{'status':_0x21e063(0x279),'warehouse_category':_0x21e063(0x205)}},{'$group':{'_id':_0x21e063(0x263),'name':{'$first':_0x21e063(0x263)}}}]);const _0x51805a=await product[_0x21e063(0x28c)]({});if(_0x1a4ebd[0x0][_0x21e063(0x21d)]==_0x21e063(0x236)){var _0x2ece3f=users[_0x21e063(0x247)];console['log'](_0x2ece3f);}else{if(_0x1a4ebd[0x0][_0x21e063(0x21d)]==_0x21e063(0x234))var _0x2ece3f=users['Hindi'];else{if(_0x1a4ebd[0x0][_0x21e063(0x21d)]==_0x21e063(0x202))var _0x2ece3f=users[_0x21e063(0x202)];else{if(_0x1a4ebd[0x0]['language']=='Spanish')var _0x2ece3f=users['Spanish'];else{if(_0x1a4ebd[0x0][_0x21e063(0x21d)]=='French')var _0x2ece3f=users[_0x21e063(0x253)];else{if(_0x1a4ebd[0x0][_0x21e063(0x21d)]=='Portuguese\x20(BR)')var _0x2ece3f=users[_0x21e063(0x264)];else{if(_0x1a4ebd[0x0][_0x21e063(0x21d)]==_0x21e063(0x2fd))var _0x2ece3f=users[_0x21e063(0x2fd)];else{if(_0x1a4ebd[0x0]['language']=='Arabic\x20(ae)')var _0x2ece3f=users['Arabic'];}}}}}}}_0x4a446a[_0x21e063(0x25e)](_0x21e063(0x2ac),{'success':_0xccfb5f[_0x21e063(0x200)](_0x21e063(0x2b7)),'errors':_0xccfb5f['flash'](_0x21e063(0x274)),'role':_0x2b78c5,'profile':_0x439bb0,'customer':_0xefa11b,'warehouse':_0x5770e8,'product':_0x13a898,'user':_0x504e31,'master_shop':_0x1a4ebd,'unit':_0x51805a,'language':_0x2ece3f});}catch(_0x4ef9f3){console['log'](_0x4ef9f3);}}),router[a0_0x1d5e30(0x2da)](a0_0x1d5e30(0x2bf),auth,async(_0x3314fc,_0x300ff2)=>{var _0x331b0b=a0_0x1d5e30;try{const _0x33d167=_0x3314fc['params']['id'],_0x1858f9=await sales[_0x331b0b(0x2b5)]({'_id':_0x3314fc['params']['id']}),_0x30d71f=await warehouse[_0x331b0b(0x2b5)]({'name':_0x1858f9[_0x331b0b(0x2b2)],'room':_0x3314fc['body'][_0x331b0b(0x221)]}),{invoice:_0x46b49d,date:_0x68dd19,warehouse_name:_0x4d7bdf,product_name:_0x3ec04a,stock:_0x15af19,quantity:_0x423a24,note:_0x3a6a22,room:_0x1dd4cc,customer:_0xb49512,SCRN:_0x45de1c}=_0x3314fc[_0x331b0b(0x2c9)];if(typeof _0x3ec04a==_0x331b0b(0x248))var _0x126191=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2d0)]],_0x310d84=[_0x3314fc['body'][_0x331b0b(0x21b)]],_0x213018=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x300)]],_0x49bc3a=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x275)]],_0x2cebaf=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2ae)]],_0x551e3a=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x281)]],_0x56820c=[_0x3314fc[_0x331b0b(0x2c9)]['level']],_0x56fe81=[_0x3314fc['body']['primary_unit']],_0x47b9fd=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x27f)]],_0x2cceb1=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2be)]],_0x2d9344=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x284)]],_0x300fde=[_0x3314fc['body']['max_per_unit']],_0x42f5d3=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x1f6)]],_0x3d2d0a=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2dd)]],_0x5f371a=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2c3)]],_0x301dde=[_0x3314fc[_0x331b0b(0x2c9)]['delivery_code']],_0x884581=[_0x3314fc[_0x331b0b(0x2c9)]['prod_cat']],_0x1ac533=[_0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x20f)]],_0x4028ee=[_0x3314fc[_0x331b0b(0x2c9)]['RoomAssigned']];else var _0x126191=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2d0)]],_0x310d84=[..._0x3314fc['body'][_0x331b0b(0x21b)]],_0x213018=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x300)]],_0x49bc3a=[..._0x3314fc[_0x331b0b(0x2c9)]['primary_code']],_0x2cebaf=[..._0x3314fc[_0x331b0b(0x2c9)]['secondary_code']],_0x551e3a=[..._0x3314fc['body'][_0x331b0b(0x281)]],_0x56820c=[..._0x3314fc['body']['level']],_0x56fe81=[..._0x3314fc['body'][_0x331b0b(0x2ff)]],_0x47b9fd=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x27f)]],_0x2cceb1=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2be)]],_0x2d9344=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x284)]],_0x300fde=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x2cd)]],_0x42f5d3=[..._0x3314fc['body'][_0x331b0b(0x1f6)]],_0x3d2d0a=[..._0x3314fc[_0x331b0b(0x2c9)]['requested_qty']],_0x5f371a=[..._0x3314fc[_0x331b0b(0x2c9)]['delivery_date']],_0x301dde=[..._0x3314fc['body'][_0x331b0b(0x28f)]],_0x884581=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x293)]],_0x1ac533=[..._0x3314fc[_0x331b0b(0x2c9)]['quantity']],_0x4028ee=[..._0x3314fc[_0x331b0b(0x2c9)][_0x331b0b(0x215)]];const _0x3ed18d=_0x126191[_0x331b0b(0x229)](_0x604471=>{return _0x604471={'product_name':_0x604471};});_0x310d84['forEach']((_0x4a38e7,_0x1d6e96)=>{var _0x5c3e6d=_0x331b0b;_0x3ed18d[_0x1d6e96][_0x5c3e6d(0x21b)]=Math[_0x5c3e6d(0x20c)](_0x4a38e7);}),_0x213018[_0x331b0b(0x1fe)]((_0x524091,_0x154baa)=>{var _0x499dd5=_0x331b0b;_0x3ed18d[_0x154baa][_0x499dd5(0x20f)]=_0x524091;}),_0x49bc3a[_0x331b0b(0x1fe)]((_0x326f07,_0x4d77eb)=>{_0x3ed18d[_0x4d77eb]['primary_code']=_0x326f07;}),_0x2cebaf[_0x331b0b(0x1fe)]((_0x12da67,_0xa05eda)=>{_0x3ed18d[_0xa05eda]['secondary_code']=_0x12da67;}),_0x551e3a['forEach']((_0x5b4671,_0x41faf2)=>{var _0x52bedf=_0x331b0b;_0x3ed18d[_0x41faf2][_0x52bedf(0x283)]=_0x5b4671;}),_0x56820c[_0x331b0b(0x1fe)]((_0x24f549,_0x3217ce)=>{var _0x4b58d5=_0x331b0b;_0x4028ee[_0x4b58d5(0x1fe)]((_0x57ed42,_0x4b5691)=>{var _0x4fd7c3=_0x4b58d5;if(_0x57ed42==_0x4fd7c3(0x28b)&&_0x3217ce==_0x4b5691){var _0xb7fac3=_0x24f549['slice'](0x3);_0x3ed18d[_0x3217ce][_0x4fd7c3(0x1fa)]=_0x24f549[0x0],_0x3ed18d[_0x3217ce][_0x4fd7c3(0x2d8)]=_0x24f549[0x1],_0x3ed18d[_0x3217ce]['bay']=0x0,_0x3ed18d[_0x3217ce][_0x4fd7c3(0x272)]=0x0,_0x3ed18d[_0x3217ce][_0x4fd7c3(0x213)]=_0x4fd7c3(0x291),_0x3ed18d[_0x3217ce][_0x4fd7c3(0x22a)]=_0xb7fac3;}else{if(_0x57ed42==_0x4fd7c3(0x273)&&_0x3217ce==_0x4b5691){var _0xb7fac3=_0x24f549[_0x4fd7c3(0x222)](0x3);_0x3ed18d[_0x3217ce][_0x4fd7c3(0x1fa)]=_0x24f549[0x0],_0x3ed18d[_0x3217ce]['rack']=_0x24f549[0x1],_0x3ed18d[_0x3217ce][_0x4fd7c3(0x2e6)]=0x0,_0x3ed18d[_0x3217ce][_0x4fd7c3(0x272)]=0x0,_0x3ed18d[_0x3217ce][_0x4fd7c3(0x213)]=_0x4fd7c3(0x291),_0x3ed18d[_0x3217ce][_0x4fd7c3(0x22a)]=_0x24f549[0x5];}else{if(_0x3217ce==_0x4b5691){var _0x573643;if(_0x24f549[0x4]=='L')_0x573643=_0x4fd7c3(0x22c);else _0x24f549[0x4]=='F'&&(_0x573643='Floor');_0x3ed18d[_0x3217ce][_0x4fd7c3(0x1fa)]=_0x24f549[0x0],_0x3ed18d[_0x3217ce][_0x4fd7c3(0x2d8)]=_0x24f549[0x1],_0x3ed18d[_0x3217ce][_0x4fd7c3(0x2e6)]=_0x24f549[0x2],_0x3ed18d[_0x3217ce][_0x4fd7c3(0x272)]=_0x24f549[0x3],_0x3ed18d[_0x3217ce][_0x4fd7c3(0x213)]=_0x573643,_0x3ed18d[_0x3217ce][_0x4fd7c3(0x22a)]=_0x24f549[0x5];}}}});}),_0x56fe81[_0x331b0b(0x1fe)]((_0x5f0e72,_0x1bdc25)=>{var _0x429632=_0x331b0b;_0x3ed18d[_0x1bdc25][_0x429632(0x2a9)]=_0x5f0e72;}),_0x47b9fd[_0x331b0b(0x1fe)]((_0x3e4831,_0x3d2883)=>{var _0x260146=_0x331b0b;_0x3ed18d[_0x3d2883][_0x260146(0x27f)]=_0x3e4831;}),_0x2cceb1[_0x331b0b(0x1fe)]((_0x2dc2c6,_0x4aaa13)=>{var _0x33c480=_0x331b0b;_0x3ed18d[_0x4aaa13][_0x33c480(0x2be)]=_0x2dc2c6;}),_0x2d9344[_0x331b0b(0x1fe)]((_0x2ba8b8,_0x34b0d8)=>{var _0x55baa7=_0x331b0b;_0x3ed18d[_0x34b0d8][_0x55baa7(0x284)]=_0x2ba8b8;}),_0x300fde[_0x331b0b(0x1fe)]((_0x424369,_0x19e708)=>{var _0x2b261e=_0x331b0b;_0x3ed18d[_0x19e708][_0x2b261e(0x289)]=_0x424369;}),_0x42f5d3[_0x331b0b(0x1fe)]((_0x3618a8,_0x4107c2)=>{_0x3ed18d[_0x4107c2]['production_date']=_0x3618a8;}),_0x3d2d0a['forEach']((_0x1fc3ab,_0x4bc6e4)=>{var _0x5da3ab=_0x331b0b;_0x3ed18d[_0x4bc6e4]['requested_qty']=Math[_0x5da3ab(0x20c)](_0x1fc3ab);}),_0x5f371a[_0x331b0b(0x1fe)]((_0x172a68,_0x1d2e27)=>{var _0x357963=_0x331b0b;_0x3ed18d[_0x1d2e27][_0x357963(0x2c3)]=_0x172a68;}),_0x301dde[_0x331b0b(0x1fe)]((_0x4b3fcc,_0x4ed194)=>{_0x3ed18d[_0x4ed194]['delivery_code']=_0x4b3fcc;}),_0x884581[_0x331b0b(0x1fe)]((_0x6caf30,_0x331a50)=>{var _0x268f8f=_0x331b0b;_0x3ed18d[_0x331a50][_0x268f8f(0x293)]=_0x6caf30;}),_0x1ac533['forEach']((_0x14e2b8,_0x31dfcc)=>{var _0x46c4fd=_0x331b0b;_0x3ed18d[_0x31dfcc][_0x46c4fd(0x2fe)]=_0x14e2b8;}),_0x4028ee['forEach']((_0x3a85e1,_0x6e4f9a)=>{_0x3ed18d[_0x6e4f9a]['room_name']=_0x3a85e1;});var _0x5ef38e=0x0;_0x3ed18d[_0x331b0b(0x1fe)](_0x331182=>{var _0x3e214a=_0x331b0b;console[_0x3e214a(0x2d3)](_0x3e214a(0x2f2),_0x331182),(parseInt(_0x331182['stock'])<parseInt(_0x331182[_0x3e214a(0x20f)])||parseInt(_0x331182['quantity'])==0x0)&&_0x5ef38e++;});if(_0x5ef38e!=0x0)return _0x3314fc[_0x331b0b(0x200)]('errors',_0x331b0b(0x258)),_0x300ff2[_0x331b0b(0x2bb)](_0x331b0b(0x230));const _0x11f750=_0x3ed18d[_0x331b0b(0x276)](_0x20ead4=>_0x20ead4[_0x331b0b(0x20f)]!=='0'&&_0x20ead4[_0x331b0b(0x20f)]!=='');_0x1858f9[_0x331b0b(0x226)]=_0x46b49d,_0x1858f9[_0x331b0b(0x23a)]=_0xb49512,_0x1858f9[_0x331b0b(0x2bc)]=_0x68dd19,_0x1858f9['warehouse_name']=_0x4d7bdf,_0x1858f9['sale_product']=_0x11f750,_0x1858f9[_0x331b0b(0x2d1)]=_0x3a6a22,_0x1858f9['SCRN']=_0x45de1c,_0x1858f9[_0x331b0b(0x2a5)]=_0x331b0b(0x2e7),_0x1858f9[_0x331b0b(0x212)]=_0x331b0b(0x2e7);const _0x3025d4=await _0x1858f9[_0x331b0b(0x2c6)]();_0x3314fc[_0x331b0b(0x200)](_0x331b0b(0x2b7),'Sales\x20Update\x20successfully'),_0x300ff2[_0x331b0b(0x2bb)](_0x331b0b(0x2e0));}catch(_0x14bfea){console[_0x331b0b(0x2d3)](_0x14bfea);}}),router[a0_0x1d5e30(0x2da)](a0_0x1d5e30(0x227),auth,async(_0x42ab12,_0x274be1)=>{var _0x18dbf7=a0_0x1d5e30;try{const _0x4927b3=_0x42ab12[_0x18dbf7(0x26d)]['id'],{invoice:_0x54d890,customer:_0x464911,receivable_amount:_0x3ccbcc,received_amount:_0x590be1}=_0x42ab12[_0x18dbf7(0x2c9)],_0xf69a36=await sales['findById'](_0x4927b3);console[_0x18dbf7(0x2d3)](_0xf69a36);var _0x407e80=_0x3ccbcc-_0x590be1;console[_0x18dbf7(0x2d3)](_0x590be1),_0xf69a36[_0x18dbf7(0x246)]=parseFloat(_0x590be1)+parseFloat(_0xf69a36[_0x18dbf7(0x246)]),_0xf69a36[_0x18dbf7(0x237)]=_0x407e80,console[_0x18dbf7(0x2d3)](_0xf69a36);const _0x49d5f7=await _0xf69a36['save'](),_0x108e48=await c_payment_data[_0x18dbf7(0x2b5)]({'invoice':_0x54d890});_0x108e48[_0x18dbf7(0x296)]=_0x407e80,await _0x108e48[_0x18dbf7(0x2c6)]();let _0x39dedb=new Date(),_0xdfa201=('0'+_0x39dedb['getDate']())['slice'](-0x2),_0x3d3d7f=('0'+(_0x39dedb[_0x18dbf7(0x2f9)]()+0x1))['slice'](-0x2),_0x5f2318=_0x39dedb[_0x18dbf7(0x224)](),_0x367892=_0x5f2318+'-'+_0x3d3d7f+'-'+_0xdfa201;const _0x33f88f=new customer_payment({'invoice':_0x54d890,'date':_0x5f2318+'-'+_0x3d3d7f+'-'+_0xdfa201,'customer':_0x464911,'reason':_0x18dbf7(0x295),'amount':_0x590be1}),_0x38b2ce=await _0x33f88f[_0x18dbf7(0x2c6)]();_0x42ab12[_0x18dbf7(0x200)](_0x18dbf7(0x2b7),_0x18dbf7(0x2a4)),_0x274be1[_0x18dbf7(0x2bb)](_0x18dbf7(0x2e0));}catch(_0x3f6f00){console[_0x18dbf7(0x2d3)](_0x3f6f00);}}),router['get'](a0_0x1d5e30(0x249),auth,async(_0x332614,_0x206d05)=>{var _0xca2709=a0_0x1d5e30;try{const {username:_0x3a5230,email:_0x47cb92,role:_0x338ee1}=_0x332614[_0xca2709(0x265)],_0x5a8bca=_0x332614[_0xca2709(0x265)],_0x11751b=await profile[_0xca2709(0x2b5)]({'email':_0x5a8bca[_0xca2709(0x2c5)]}),_0x31df17=await master_shop['find']();console[_0xca2709(0x2d3)](_0xca2709(0x204),_0x31df17);const _0x4909c0=_0x332614[_0xca2709(0x26d)]['id'],_0x11cb95=await sales[_0xca2709(0x1fb)](_0x4909c0);console['log'](_0x11cb95);const _0x1f4f09=await customer[_0xca2709(0x2b5)]({'name':_0x11cb95[_0xca2709(0x23a)]});console[_0xca2709(0x2d3)](_0x1f4f09);if(_0x31df17[0x0][_0xca2709(0x21d)]=='English\x20(US)'){var _0x40502c=users[_0xca2709(0x247)];console[_0xca2709(0x2d3)](_0x40502c);}else{if(_0x31df17[0x0]['language']==_0xca2709(0x234))var _0x40502c=users[_0xca2709(0x234)];else{if(_0x31df17[0x0][_0xca2709(0x21d)]==_0xca2709(0x202))var _0x40502c=users[_0xca2709(0x202)];else{if(_0x31df17[0x0][_0xca2709(0x21d)]==_0xca2709(0x286))var _0x40502c=users[_0xca2709(0x286)];else{if(_0x31df17[0x0][_0xca2709(0x21d)]==_0xca2709(0x253))var _0x40502c=users[_0xca2709(0x253)];else{if(_0x31df17[0x0]['language']=='Portuguese\x20(BR)')var _0x40502c=users['Portuguese'];else{if(_0x31df17[0x0][_0xca2709(0x21d)]==_0xca2709(0x2fd))var _0x40502c=users[_0xca2709(0x2fd)];else{if(_0x31df17[0x0][_0xca2709(0x21d)]==_0xca2709(0x294))var _0x40502c=users[_0xca2709(0x26f)];}}}}}}}_0x206d05[_0xca2709(0x25e)]('sales_invoice',{'success':_0x332614[_0xca2709(0x200)](_0xca2709(0x2b7)),'errors':_0x332614[_0xca2709(0x200)](_0xca2709(0x274)),'role':_0x5a8bca,'profile':_0x11751b,'master_shop':_0x31df17,'customers':_0x1f4f09,'sales':_0x11cb95,'language':_0x40502c});}catch(_0x4ce8c6){console[_0xca2709(0x2d3)](_0x4ce8c6);}}),router[a0_0x1d5e30(0x29a)]('/view/return_sales/:id',auth,async(_0x1b5390,_0x4ad186)=>{var _0x4b93b8=a0_0x1d5e30;try{const {username:_0x49aca0,email:_0x428aaa,role:_0x481a1a}=_0x1b5390[_0x4b93b8(0x265)],_0x2db904=_0x1b5390[_0x4b93b8(0x265)],_0x2ddd01=await profile[_0x4b93b8(0x2b5)]({'email':_0x2db904[_0x4b93b8(0x2c5)]}),_0x58dbe1=await master_shop[_0x4b93b8(0x28c)]();console[_0x4b93b8(0x2d3)](_0x4b93b8(0x204),_0x58dbe1);const _0x554fe5=_0x1b5390[_0x4b93b8(0x26d)]['id'];console['log'](_0x554fe5);const _0x2aff87=await sales[_0x4b93b8(0x1fb)](_0x554fe5);console[_0x4b93b8(0x2d3)]('user_id',_0x2aff87);const _0x4a0c06=await warehouse[_0x4b93b8(0x269)]([{'$match':{'name':_0x4b93b8(0x1fc),'room':_0x4b93b8(0x2c8)}},{'$unwind':_0x4b93b8(0x1f8)},{'$group':{'_id':_0x4b93b8(0x259),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4b93b8(0x28d)},'level':{'$first':_0x4b93b8(0x2e5)},'isle':{'$first':_0x4b93b8(0x1f9)},'pallet':{'$first':_0x4b93b8(0x24e)},'primary_code':{'$first':_0x4b93b8(0x2f8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4b93b8(0x21c)}}}]);console[_0x4b93b8(0x2d3)](_0x4b93b8(0x2ab),_0x4a0c06);const _0x39d596=await product[_0x4b93b8(0x28c)]({});warehouse_data=await warehouse[_0x4b93b8(0x269)]([{'$match':{'status':_0x4b93b8(0x279),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4b93b8(0x263),'name':{'$first':_0x4b93b8(0x263)}}},{'$sort':{'name':0x1}}]);var _0x433dd2=['Return\x20Rooms'];if(_0x58dbe1[0x0][_0x4b93b8(0x21d)]==_0x4b93b8(0x236)){var _0x4a9941=users[_0x4b93b8(0x247)];console['log'](_0x4a9941);}else{if(_0x58dbe1[0x0]['language']=='Hindi')var _0x4a9941=users[_0x4b93b8(0x234)];else{if(_0x58dbe1[0x0][_0x4b93b8(0x21d)]==_0x4b93b8(0x202))var _0x4a9941=users['German'];else{if(_0x58dbe1[0x0]['language']==_0x4b93b8(0x286))var _0x4a9941=users['Spanish'];else{if(_0x58dbe1[0x0]['language']=='French')var _0x4a9941=users[_0x4b93b8(0x253)];else{if(_0x58dbe1[0x0][_0x4b93b8(0x21d)]==_0x4b93b8(0x2d2))var _0x4a9941=users['Portuguese'];else{if(_0x58dbe1[0x0][_0x4b93b8(0x21d)]==_0x4b93b8(0x2fd))var _0x4a9941=users[_0x4b93b8(0x2fd)];else{if(_0x58dbe1[0x0][_0x4b93b8(0x21d)]==_0x4b93b8(0x294))var _0x4a9941=users[_0x4b93b8(0x26f)];}}}}}}}_0x4ad186['render'](_0x4b93b8(0x280),{'success':_0x1b5390[_0x4b93b8(0x200)](_0x4b93b8(0x2b7)),'errors':_0x1b5390['flash'](_0x4b93b8(0x274)),'role':_0x2db904,'profile':_0x2ddd01,'user':_0x2aff87,'stock':_0x4a0c06,'master_shop':_0x58dbe1,'unit':_0x39d596,'language':_0x4a9941,'warehouses':warehouse_data,'rooms':_0x433dd2});}catch(_0x5bc7f3){console[_0x4b93b8(0x2d3)](_0x5bc7f3),_0x4ad186[_0x4b93b8(0x2f7)](0xc8)[_0x4b93b8(0x2c1)]({'message':_0x5bc7f3[_0x4b93b8(0x231)]});}}),router[a0_0x1d5e30(0x2da)](a0_0x1d5e30(0x26e),auth,async(_0x22f694,_0x25b150)=>{var _0x8099c4=a0_0x1d5e30;try{const {invoice:_0x357a17,date:_0x13eaf1,warehouse_name:_0x59c384,product_name:_0x50e3c6,primary_code:_0x4527d4,secondary_code:_0x2e33e1,product_code:_0x13e766,sales_quantity:_0x3a452c,stocks:_0x11f962,return_qty:_0x288b9f,Room_name:_0x5681e8,to_warehouse_name:_0x4260b3,to_Roomname:_0x8cf1c,to_Room_name:_0x4d508c,note:_0x5bf090,level:_0x232074,isle:_0x21542e,pallet:_0xb3cc08}=_0x22f694[_0x8099c4(0x2c9)];if(typeof _0x50e3c6==_0x8099c4(0x248))var _0x50e22b=[_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x2d0)]],_0x272b1f=[_0x22f694['body'][_0x8099c4(0x275)]],_0x1bce18=[_0x22f694['body'][_0x8099c4(0x2ae)]],_0x1bc3e1=[_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x283)]],_0x46f9e3=[_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x2a6)]],_0x46055d=[_0x22f694['body'][_0x8099c4(0x27a)]],_0x135d77=[_0x22f694['body']['return_qty']],_0x84dfe4=[_0x22f694['body'][_0x8099c4(0x2e6)]],_0x25d682=[_0x22f694[_0x8099c4(0x2c9)]['bin']],_0x175c3e=[_0x22f694['body'][_0x8099c4(0x2a2)]],_0x4cf6bc=[_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x22a)]];else var _0x50e22b=[..._0x22f694[_0x8099c4(0x2c9)]['product_name']],_0x272b1f=[..._0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x275)]],_0x1bce18=[..._0x22f694['body'][_0x8099c4(0x2ae)]],_0x1bc3e1=[..._0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x283)]],_0x46f9e3=[..._0x22f694['body'][_0x8099c4(0x2a6)]],_0x46055d=[..._0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x27a)]],_0x135d77=[..._0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x267)]],_0x84dfe4=[..._0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x2e6)]],_0x25d682=[..._0x22f694['body'][_0x8099c4(0x272)]],_0x175c3e=[..._0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x2a2)]],_0x4cf6bc=[..._0x22f694['body'][_0x8099c4(0x22a)]];const _0x4ccb40=_0x50e22b['map'](_0x4d272a=>{return _0x4d272a={'product_name':_0x4d272a};});_0x272b1f[_0x8099c4(0x1fe)]((_0x298759,_0x26433c)=>{var _0x538043=_0x8099c4;_0x4ccb40[_0x26433c][_0x538043(0x275)]=_0x298759;}),_0x1bce18['forEach']((_0x52455b,_0x207e9c)=>{var _0x2b3ea2=_0x8099c4;_0x4ccb40[_0x207e9c][_0x2b3ea2(0x2ae)]=_0x52455b;}),_0x1bc3e1['forEach']((_0x32f943,_0x4f1819)=>{var _0xb4b3dd=_0x8099c4;_0x4ccb40[_0x4f1819][_0xb4b3dd(0x283)]=_0x32f943;}),_0x46f9e3[_0x8099c4(0x1fe)]((_0x38d5e9,_0x10f92e)=>{_0x4ccb40[_0x10f92e]['sale_qty']=_0x38d5e9;}),_0x46055d['forEach']((_0x474696,_0x1a60a7)=>{var _0x2b7f19=_0x8099c4;_0x4ccb40[_0x1a60a7][_0x2b7f19(0x21b)]=_0x474696;}),_0x135d77[_0x8099c4(0x1fe)]((_0x572316,_0x28b900)=>{var _0x59d141=_0x8099c4;_0x4ccb40[_0x28b900][_0x59d141(0x267)]=_0x572316;}),_0x84dfe4[_0x8099c4(0x1fe)]((_0x3c470d,_0x376bcc)=>{var _0x5a458e=_0x8099c4;_0x4ccb40[_0x376bcc][_0x5a458e(0x2e6)]=_0x3c470d;}),_0x25d682[_0x8099c4(0x1fe)]((_0x3c0c5a,_0x23896a)=>{var _0x2922e2=_0x8099c4;_0x4ccb40[_0x23896a][_0x2922e2(0x272)]=_0x3c0c5a;}),_0x175c3e[_0x8099c4(0x1fe)]((_0x432d0c,_0x1fd6fd)=>{_0x4ccb40[_0x1fd6fd]['type']=_0x432d0c;}),_0x4cf6bc[_0x8099c4(0x1fe)]((_0x36d156,_0x129d40)=>{var _0x394051=_0x8099c4;_0x4ccb40[_0x129d40][_0x394051(0x22a)]=_0x36d156;});var _0x4c9d54=0x0;_0x4ccb40['forEach'](_0x24f2ad=>{var _0x5c68b9=_0x8099c4;console[_0x5c68b9(0x2d3)](_0x5c68b9(0x2f2),_0x24f2ad),(parseInt(_0x24f2ad[_0x5c68b9(0x2cc)])<parseInt(_0x24f2ad['return_qty'])||parseInt(_0x24f2ad[_0x5c68b9(0x21b)])<parseInt(_0x24f2ad[_0x5c68b9(0x267)])&&parseInt(_0x24f2ad[_0x5c68b9(0x2cc)])>parseInt(_0x24f2ad[_0x5c68b9(0x267)])||parseInt(_0x24f2ad[_0x5c68b9(0x267)])==0x0)&&_0x4c9d54++;});if(_0x4c9d54!=0x0)return _0x22f694[_0x8099c4(0x200)]('errors',_0x8099c4(0x244)),_0x25b150['redirect'](_0x8099c4(0x230));const _0x3b7229=await sales['findOne']({'invoice':_0x357a17});console[_0x8099c4(0x2d3)](_0x3b7229),_0x3b7229[_0x8099c4(0x302)]=_0x8099c4(0x232);const _0x2c606f=await _0x3b7229[_0x8099c4(0x2c6)](),_0x384a47=new sales_return({'invoice':_0x357a17,'customer':_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x23a)],'date':_0x13eaf1,'warehouse_name':_0x59c384,'room':_0x5681e8,'ToWarehouse':_0x4260b3,'ToRoom':_0x4d508c,'return_sale':_0x4ccb40,'note':_0x5bf090}),_0x27dcfc=await _0x384a47['save']();console['log'](_0x384a47);const _0x5b6d24=await sales_return['findOne']({'invoice':_0x357a17}),_0xe421aa=await warehouse[_0x8099c4(0x2b5)]({'name':_0x4260b3,'room':_0x4d508c});_0x5b6d24['return_sale'][_0x8099c4(0x1fe)](_0x1c0115=>{var _0x4febaf=_0x8099c4,_0x350ade=0x0;const _0x25778d=_0xe421aa[_0x4febaf(0x2ba)][_0x4febaf(0x229)](_0x1df1e0=>{var _0x356dda=_0x4febaf;_0x1df1e0[_0x356dda(0x2d0)]==_0x1c0115['product_name']&&_0x1df1e0['floorlevel']==_0x1c0115[_0x356dda(0x22a)]&&_0x1df1e0[_0x356dda(0x213)]==_0x1c0115[_0x356dda(0x213)]&&_0x1df1e0[_0x356dda(0x272)]==_0x1c0115['bin']&&_0x1df1e0['bay']==_0x1c0115[_0x356dda(0x2e6)]&&(_0x1df1e0[_0x356dda(0x250)]=parseInt(_0x1df1e0[_0x356dda(0x250)])+parseInt(_0x1c0115[_0x356dda(0x267)]),_0x350ade++);});_0x350ade=='0'&&(_0xe421aa[_0x4febaf(0x2ba)]=_0xe421aa[_0x4febaf(0x2ba)][_0x4febaf(0x23c)]({'product_name':_0x1c0115[_0x4febaf(0x2d0)],'product_stock':_0x1c0115[_0x4febaf(0x267)],'primary_code':_0x1c0115['primary_code'],'secondary_code':_0x1c0115[_0x4febaf(0x2ae)],'product_code':_0x1c0115[_0x4febaf(0x283)],'bay':_0x1c0115[_0x4febaf(0x2e6)],'bin':_0x1c0115['bin'],'type':_0x1c0115[_0x4febaf(0x213)],'floorlevel':_0x1c0115[_0x4febaf(0x22a)]})),console['log'](_0x4febaf(0x2dc),_0xe421aa);}),await _0xe421aa[_0x8099c4(0x2c6)](),console[_0x8099c4(0x2d3)](_0x22f694['body']);const _0x468bbe=new c_payment_data({'invoice':_0x357a17,'customer':_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x23a)],'reason':_0x8099c4(0x299)});await _0x468bbe[_0x8099c4(0x2c6)]();const _0x350f39=await master_shop[_0x8099c4(0x28c)]();console['log']('add\x20post',_0x350f39[0x0][_0x8099c4(0x1f7)]);const _0x368dc0=await email_settings[_0x8099c4(0x2b5)](),_0xc01103=await customer['findOne']({'name':_0x22f694[_0x8099c4(0x2c9)][_0x8099c4(0x23a)]});console['log']('customer_data',_0xc01103);_0x350f39[0x0][_0x8099c4(0x203)]==0x1?(right_currency=_0x350f39[0x0][_0x8099c4(0x239)],left_currency=''):(right_currency='',left_currency=_0x350f39[0x0]['currency']);var _0x298dee=_0x50e22b,_0x46dfe2=_0x135d77,_0x2bbd93='',_0x21853c;for(_0x21853c in _0x298dee){_0x2bbd93+=_0x8099c4(0x28e)+_0x8099c4(0x25b)+_0x298dee[_0x21853c]+_0x8099c4(0x270)+_0x8099c4(0x25b)+_0x46dfe2[_0x21853c]+_0x8099c4(0x270)+_0x8099c4(0x219);}console[_0x8099c4(0x2d3)](_0x8099c4(0x256),_0x2bbd93);let _0x5b5a64=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x368dc0[_0x8099c4(0x2c5)],'pass':_0x368dc0['password']}}),_0x3de0f3={'from':_0x368dc0[_0x8099c4(0x2c5)],'to':_0xc01103[_0x8099c4(0x2c5)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x8099c4(0x21e),'path':__dirname+_0x8099c4(0x2b0)+_0x8099c4(0x2c0)+_0x350f39[0x0][_0x8099c4(0x1f7)],'cid':'logo'}],'html':_0x8099c4(0x24c)+'<html><head><title></title>'+_0x8099c4(0x266)+_0x8099c4(0x277)+_0x8099c4(0x23d)+_0x8099c4(0x277)+_0x8099c4(0x2b9)+_0x8099c4(0x27c)+_0x8099c4(0x277)+'<h2>\x20'+_0x350f39[0x0][_0x8099c4(0x24a)]+_0x8099c4(0x2b8)+_0x8099c4(0x27c)+_0x8099c4(0x27c)+_0x8099c4(0x2e4)+_0x8099c4(0x277)+_0x8099c4(0x214)+_0x8099c4(0x2ca)+_0x357a17+'\x20'+_0x8099c4(0x255)+_0x8099c4(0x201)+_0x13eaf1+'\x20'+_0x8099c4(0x2e8)+'</h5>'+_0x8099c4(0x27c)+_0x8099c4(0x1fd)+_0x8099c4(0x252)+_0x8099c4(0x28e)+_0x8099c4(0x260)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x8099c4(0x2d5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x8099c4(0x219)+_0x8099c4(0x2de)+_0x8099c4(0x25c)+'\x20'+_0x2bbd93+'\x20'+_0x8099c4(0x2bd)+_0x8099c4(0x25a)+_0x8099c4(0x277)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x350f39[0x0][_0x8099c4(0x24a)]+_0x8099c4(0x235)+_0x8099c4(0x27c)+_0x8099c4(0x27c)+_0x8099c4(0x23b)};_0x5b5a64[_0x8099c4(0x242)](_0x3de0f3,function(_0x13b4e4,_0x56b09d){var _0x321e1b=_0x8099c4;_0x13b4e4?(console[_0x321e1b(0x2d3)](_0x13b4e4),console[_0x321e1b(0x2d3)](_0x321e1b(0x2fa))):console[_0x321e1b(0x2d3)]('Email\x20sent\x20successfully');}),_0x22f694[_0x8099c4(0x200)](_0x8099c4(0x2b7),_0x8099c4(0x22f)),_0x25b150[_0x8099c4(0x2bb)](_0x8099c4(0x2e0));}catch(_0x5d4614){console[_0x8099c4(0x2d3)](_0x5d4614),_0x25b150[_0x8099c4(0x2f7)](0xc8)[_0x8099c4(0x2c1)]({'message1':_0x5d4614[_0x8099c4(0x231)]});}}),router['get']('/barcode/:id',auth,async(_0x29899,_0xe8911e)=>{var _0x4450eb=a0_0x1d5e30;try{const {username:_0x3d14c6,email:_0x50817d,role:_0x2e3825}=_0x29899[_0x4450eb(0x265)],_0x43c812=_0x29899['user'],_0x3f1b32=await profile[_0x4450eb(0x2b5)]({'email':_0x43c812['email']}),_0x4e93ed=await master_shop[_0x4450eb(0x28c)]();console[_0x4450eb(0x2d3)]('barcode\x20Product\x20master',_0x4e93ed);const _0x463a24=_0x29899['params']['id'],_0x4e9fd2=await sales[_0x4450eb(0x1fb)](_0x463a24);console[_0x4450eb(0x2d3)](_0x4450eb(0x2a0),_0x4e9fd2);if(_0x4e93ed[0x0][_0x4450eb(0x21d)]=='English\x20(US)')var _0xd9c23e=users[_0x4450eb(0x247)];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]==_0x4450eb(0x234))var _0xd9c23e=users['Hindi'];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]==_0x4450eb(0x202))var _0xd9c23e=users[_0x4450eb(0x202)];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]=='Spanish')var _0xd9c23e=users[_0x4450eb(0x286)];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]=='French')var _0xd9c23e=users[_0x4450eb(0x253)];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]=='Portuguese\x20(BR)')var _0xd9c23e=users['Portuguese'];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]==_0x4450eb(0x2fd))var _0xd9c23e=users['Chinese'];else{if(_0x4e93ed[0x0][_0x4450eb(0x21d)]==_0x4450eb(0x294))var _0xd9c23e=users['Arabic'];}}}}}}}_0xe8911e[_0x4450eb(0x25e)](_0x4450eb(0x24d),{'success':_0x29899[_0x4450eb(0x200)]('success'),'errors':_0x29899[_0x4450eb(0x200)]('errors'),'role':_0x43c812,'profile':_0x3f1b32,'alldata':_0x4e9fd2,'master_shop':_0x4e93ed,'language':_0xd9c23e});}catch(_0x2a9688){console[_0x4450eb(0x2d3)](_0x2a9688);}}),router[a0_0x1d5e30(0x2da)](a0_0x1d5e30(0x29d),async(_0x16f323,_0x5c407a)=>{var _0x2a2be2=a0_0x1d5e30;const {product_code:_0x58ed49,warehouse_name:_0x5abb33,rooms_data:_0x559323,Roomslist:_0x55acfa}=_0x16f323[_0x2a2be2(0x2c9)],_0x1f5653=_0x55acfa['split'](','),_0x561abb=[];async function _0x3d75b5(_0x1faa30){var _0x5644c8=_0x2a2be2;const _0x524996=await warehouse[_0x5644c8(0x269)]([{'$match':{'name':_0x5abb33,'room':_0x1faa30}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x58ed49}},{'$group':{'_id':_0x5644c8(0x259),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5644c8(0x28d)},'primary_code':{'$first':_0x5644c8(0x2f8)},'secondary_code':{'$first':_0x5644c8(0x2cf)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5644c8(0x2df)},'isle':{'$first':_0x5644c8(0x24b)},'type':{'$first':_0x5644c8(0x22d)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x5644c8(0x2f4)},'secondary_unit':{'$first':_0x5644c8(0x2a8)},'storage':{'$first':_0x5644c8(0x218)},'rack':{'$first':_0x5644c8(0x257)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x5644c8(0x2e2)},'batch_code':{'$first':_0x5644c8(0x1f4)},'product_cat':{'$first':_0x5644c8(0x24f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x5644c8(0x2aa)},'invoice':{'$first':_0x5644c8(0x2ea)},'actual_qty':{'$first':_0x5644c8(0x22e)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x5048da=await warehouse['aggregate']([{'$match':{'name':_0x5abb33,'room':_0x1faa30}},{'$unwind':_0x5644c8(0x1f8)},{'$match':{'product_details.secondary_code':_0x58ed49}},{'$group':{'_id':_0x5644c8(0x259),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5644c8(0x28d)},'primary_code':{'$first':_0x5644c8(0x2f8)},'secondary_code':{'$first':_0x5644c8(0x2cf)},'product_code':{'$first':_0x5644c8(0x21c)},'level':{'$first':_0x5644c8(0x2df)},'isle':{'$first':_0x5644c8(0x24b)},'type':{'$first':_0x5644c8(0x22d)},'pallet':{'$first':_0x5644c8(0x2d9)},'unit':{'$first':_0x5644c8(0x2f4)},'secondary_unit':{'$first':_0x5644c8(0x2a8)},'storage':{'$first':_0x5644c8(0x218)},'rack':{'$first':_0x5644c8(0x257)},'expiry_date':{'$first':_0x5644c8(0x2a7)},'production_date':{'$first':_0x5644c8(0x22b)},'maxPerUnit':{'$first':_0x5644c8(0x2e2)},'batch_code':{'$first':_0x5644c8(0x1f4)},'product_cat':{'$first':_0x5644c8(0x24f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x524996[_0x5644c8(0x220)]>0x0)_0x561abb[_0x5644c8(0x25d)](_0x524996);else _0x5048da[_0x5644c8(0x220)]>0x0&&_0x561abb[_0x5644c8(0x25d)](_0x5048da);}const _0x1a6dda=_0x1f5653['map'](_0x5e48f0=>_0x3d75b5(_0x5e48f0));await Promise[_0x2a2be2(0x243)](_0x1a6dda),_0x5c407a[_0x2a2be2(0x2c1)](_0x561abb);}),module[a0_0x1d5e30(0x1ff)]=router;