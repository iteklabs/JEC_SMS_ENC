var a0_0x554414=a0_0x50ff;(function(_0x13c73e,_0x3a8549){var _0x1592cf=a0_0x50ff,_0x45c56b=_0x13c73e();while(!![]){try{var _0x576aa5=-parseInt(_0x1592cf(0x221))/0x1*(-parseInt(_0x1592cf(0x22f))/0x2)+-parseInt(_0x1592cf(0x23a))/0x3*(-parseInt(_0x1592cf(0x1e0))/0x4)+parseInt(_0x1592cf(0x2b1))/0x5+-parseInt(_0x1592cf(0x214))/0x6+parseInt(_0x1592cf(0x1e5))/0x7*(parseInt(_0x1592cf(0x2a5))/0x8)+parseInt(_0x1592cf(0x29b))/0x9+-parseInt(_0x1592cf(0x1d2))/0xa;if(_0x576aa5===_0x3a8549)break;else _0x45c56b['push'](_0x45c56b['shift']());}catch(_0x23dc68){_0x45c56b['push'](_0x45c56b['shift']());}}}(a0_0x1359,0x4363c));function a0_0x1359(){var _0x50ecf2=['<table\x20style=\x22width:\x20100%\x20!important;\x22>','_id','bin','sale_product','quantity_notConverted','getMonth','$_id','catch','master','final','render','production_date','customers_docs','$finalize','/../public','$product_details.level','string','due_amount','sales\x20item\x20return\x20successfull','Portuguese','floorlevel','<html><head><title></title>','split','warehouse','success','2242080AFlEcN','prod_code','note','return_sale','return_data','received_amount','edit_sales_view','redirect','message','$product.product_name','3440uEXtlG','secondary_code','max_per_unit','back','$product_details.secondary_unit','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.bay','</tr>','/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','random','2254135asBkdf','room_name','/all_sales/view','host','actual_uom','aggregate','An\x20error\x20occurred\x20while\x20saving\x20data.','French','$product_details.bin','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.actual_uom','primary_code','$name','Raw\x20Materials','<div>','$product_details.product_name','German','findOne','<!DOCTYPE\x20html>','type','status','Chinese','bay','<h5>','</tbody>','Sale\x20Return\x20Mail','types','An\x20error\x20occurred.','/view/:id','$product_details.pallet','Spanish','$product_details.primary_code','$product_details','length','customers','/barcode_scanner','carton','$note','</h5>','stock','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</div>','$product_details.maxPerUnit','../models/all_models','/view/return_sales/:id','Enclosed','Arabic\x20(ae)','$sale_product.floorlevel','Hindi','13565450nNCcJS','$product_details.unit','all','$invoice','warehouse_name','Logo.png','toString','$sale_product.bin','</body></html>','Level','secondary_unit','Error\x20Occurs','user','RoomAssigned','2268ZLhKoD','staff','email','unit','$product_details.secondary_code','7700kpHOZj','<span\x20style=\x22float:\x20right;\x22>','Return\x20Rooms','$date','$product_details.batch_code','params','product_stock','../middleware/auth','<tbody\x20style=\x22text-align:\x20center;\x22>','barcode\x20Product\x20master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$return_data','logo','$warehouse_name','<h5\x20style=\x22text-align:\x20left;\x22>','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</td>','exports','/upload/','$customer','/all_sales/preview/','$isAllowEdit','push','quantity','<tr>','product_list','product_name','Arabic','find','requested_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_sale/product','map','$product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','currency_placement','/view/add_sales','OUT-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Sales\x20Add\x20successfully','foreach\x20newproduct','room','Receiving\x20Area','forEach','<strong>\x20Regards\x20</strong>','product_data','1284186UTZTjB','body','delivery_date','max','$room','rack','Floor','$product_details.product_stock','slice','$sale_product.type','<h2>\x20','</span>','Shelves','31588WFIJEJ','/give_payment/:id','Enabled','flash','$product_details.floorlevel','json','add\x20post','$product_details.production_date','id_transaction_from','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$sale_product','$product_details._id','isAllowEdit','level','20KIOVKZ','edit_sales','Router','$product_details.storage','language','delivery_code','currency','$product_details.invoice','$product_details.bay','Return\x20Goods','actual_qty','1893pQesxC','$product_details.type','$product_details.product_cat','save','$product_details.product_code','expiry_date','prod_invoice','Portuguese\x20(BR)','get','\x20Order\x20Date\x20:\x20','role','invoice','../public/language/languages.json','/invoice/:id','/barcode/:id','customer_data','product_details','sales_invoice','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','sales_quantity','Sales\x20Mail','Sales\x20Update\x20successfully','False','post','$product_details.rack','password','$product_details.expiry_date','True','</thead>','error','$customers_docs','English','customer','site_title','</head><body>','finalize','add_sales','storage','sales\x20all_data','/preview/:id','padStart','batch_code','\x20</h2>','then','product','name','</table>','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','findById','gmail','abs','Ambient','prod_cat','return_qty','sale_qty','sendMail','primary_unit','errors','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','filter','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','English\x20(US)','RMSEmail','all_sales','maxperunit','\x20Order\x20Number\x20:\x20','date','$sale_product.quantity','product_code','Email\x20sent\x20successfully'];a0_0x1359=function(){return _0x50ecf2;};return a0_0x1359();}const express=require('express'),app=express(),router=express[a0_0x554414(0x231)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x554414(0x2dc)),auth=require(a0_0x554414(0x1ec)),nodemailer=require('nodemailer'),users=require(a0_0x554414(0x246));router['get'](a0_0x554414(0x2ae),auth,async(_0x489e67,_0x280b14)=>{var _0xce28ee=a0_0x554414;try{const {username:_0x4c44e4,email:_0x4c6128,role:_0x212562}=_0x489e67[_0xce28ee(0x1de)],_0x52f0ed=_0x489e67[_0xce28ee(0x1de)],_0x5bd603=await profile[_0xce28ee(0x2c2)]({'email':_0x52f0ed['email']}),_0x31ae66=await master_shop[_0xce28ee(0x202)]();let _0x4fd013;if(_0x52f0ed['role']=='staff'){const _0x268b63=await staff[_0xce28ee(0x2c2)]({'email':_0x52f0ed[_0xce28ee(0x1e2)]});_0x4fd013=await sales[_0xce28ee(0x2b6)]([{'$lookup':{'from':_0xce28ee(0x2d3),'localField':_0xce28ee(0x25b),'foreignField':_0xce28ee(0x268),'as':'customers_docs'}},{'$unwind':_0xce28ee(0x259)},{'$unwind':_0xce28ee(0x22b)},{'$group':{'_id':_0xce28ee(0x288),'invoice':{'$first':_0xce28ee(0x1d5)},'customers':{'$first':_0xce28ee(0x1f9)},'date':{'$first':_0xce28ee(0x1e8)},'warehouse_name':{'$first':_0xce28ee(0x1f2)},'sale_product':{'$push':_0xce28ee(0x22b)},'note':{'$first':_0xce28ee(0x2d6)},'return_data':{'$first':_0xce28ee(0x1f0)},'customers_docs':{'$first':_0xce28ee(0x259)},'total_saleproduct_quantity':{'$sum':_0xce28ee(0x27f)},'level':{'$addToSet':_0xce28ee(0x2ac)},'isle':{'$addToSet':_0xce28ee(0x1d9)},'type':{'$addToSet':_0xce28ee(0x21d)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0xce28ee(0x1fb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4fd013=await sales[_0xce28ee(0x2b6)]([{'$lookup':{'from':_0xce28ee(0x2d3),'localField':_0xce28ee(0x25b),'foreignField':_0xce28ee(0x268),'as':_0xce28ee(0x28e)}},{'$unwind':_0xce28ee(0x259)},{'$unwind':_0xce28ee(0x22b)},{'$group':{'_id':_0xce28ee(0x288),'invoice':{'$first':_0xce28ee(0x1d5)},'customers':{'$first':_0xce28ee(0x1f9)},'date':{'$first':_0xce28ee(0x1e8)},'warehouse_name':{'$first':_0xce28ee(0x1f2)},'sale_product':{'$push':_0xce28ee(0x22b)},'note':{'$first':_0xce28ee(0x2d6)},'return_data':{'$first':_0xce28ee(0x1f0)},'customers_docs':{'$first':_0xce28ee(0x259)},'total_saleproduct_quantity':{'$sum':_0xce28ee(0x27f)},'level':{'$addToSet':_0xce28ee(0x2ac)},'isle':{'$addToSet':_0xce28ee(0x1d9)},'type':{'$addToSet':_0xce28ee(0x21d)},'pallet':{'$addToSet':_0xce28ee(0x1d0)},'finalize':{'$first':_0xce28ee(0x28f)},'isAllowEdit':{'$first':_0xce28ee(0x1fb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0xce28ee(0x2aa)](_0xce28ee(0x261),_0x4fd013);if(_0x31ae66[0x0][_0xce28ee(0x233)]==_0xce28ee(0x279)){var _0x5bb516=users['English'];console[_0xce28ee(0x2aa)](_0x5bb516);}else{if(_0x31ae66[0x0]['language']==_0xce28ee(0x1d1))var _0x5bb516=users['Hindi'];else{if(_0x31ae66[0x0][_0xce28ee(0x233)]==_0xce28ee(0x2c1))var _0x5bb516=users[_0xce28ee(0x2c1)];else{if(_0x31ae66[0x0][_0xce28ee(0x233)]==_0xce28ee(0x2cf))var _0x5bb516=users[_0xce28ee(0x2cf)];else{if(_0x31ae66[0x0][_0xce28ee(0x233)]==_0xce28ee(0x2b8))var _0x5bb516=users['French'];else{if(_0x31ae66[0x0][_0xce28ee(0x233)]==_0xce28ee(0x241))var _0x5bb516=users[_0xce28ee(0x295)];else{if(_0x31ae66[0x0][_0xce28ee(0x233)]==_0xce28ee(0x2c6))var _0x5bb516=users[_0xce28ee(0x2c6)];else{if(_0x31ae66[0x0]['language']==_0xce28ee(0x2df))var _0x5bb516=users[_0xce28ee(0x201)];}}}}}}}_0x280b14[_0xce28ee(0x28c)](_0xce28ee(0x27b),{'success':_0x489e67[_0xce28ee(0x224)](_0xce28ee(0x29a)),'errors':_0x489e67[_0xce28ee(0x224)](_0xce28ee(0x275)),'sales':_0x4fd013,'profile':_0x5bd603,'role':_0x52f0ed,'master_shop':_0x31ae66,'language':_0x5bb516});}catch(_0x237acb){console[_0xce28ee(0x2aa)](_0x237acb);}});function a0_0x50ff(_0x17573f,_0x7da4ba){var _0x1359d3=a0_0x1359();return a0_0x50ff=function(_0x50ff0d,_0x162cda){_0x50ff0d=_0x50ff0d-0x1d0;var _0x11ce60=_0x1359d3[_0x50ff0d];return _0x11ce60;},a0_0x50ff(_0x17573f,_0x7da4ba);}async function getRandom8DigitNumber(){var _0x429f8b=a0_0x554414;const _0x62bf84=0x989680,_0x5c1fa8=0x5f5e0ff,_0x34ce79=Math['floor'](Math[_0x429f8b(0x2b0)]()*(_0x5c1fa8-_0x62bf84+0x1))+_0x62bf84;var _0x29ab40;const _0x4b7f78=await sales[_0x429f8b(0x2c2)]({'invoice':_0x429f8b(0x20b)+_0x34ce79});return _0x4b7f78&&_0x4b7f78[_0x429f8b(0x2d2)]>0x0?_0x29ab40=_0x429f8b(0x20b)+_0x34ce79:_0x29ab40=_0x429f8b(0x20b)+_0x34ce79,_0x29ab40;}router['get'](a0_0x554414(0x20a),auth,async(_0x348be7,_0x543d9a)=>{var _0x569fff=a0_0x554414;try{const {username:_0x1ec8a2,email:_0x47bd29,role:_0x27c547}=_0x348be7[_0x569fff(0x1de)],_0x83eba8=_0x348be7['user'],_0x511509=await profile[_0x569fff(0x2c2)]({'email':_0x83eba8[_0x569fff(0x1e2)]}),_0x166e30=await master_shop['find'](),_0x471565=await customer[_0x569fff(0x202)]({});let _0x9ab6c9;if(_0x83eba8['role']==_0x569fff(0x1e1)){const _0xfd8a5d=await staff[_0x569fff(0x2c2)]({'email':_0x83eba8[_0x569fff(0x1e2)]});_0x9ab6c9=await warehouse[_0x569fff(0x2b6)]([{'$match':{'status':_0x569fff(0x223),'name':_0xfd8a5d[_0x569fff(0x299)],'warehouse_category':_0x569fff(0x2be),'name':{'$ne':_0x569fff(0x238)}}},{'$group':{'_id':_0x569fff(0x2bd),'name':{'$first':_0x569fff(0x2bd)}}},{'$sort':{'name':0x1}}]);}else _0x9ab6c9=await warehouse[_0x569fff(0x2b6)]([{'$match':{'status':_0x569fff(0x223),'warehouse_category':_0x569fff(0x2be),'name':{'$ne':_0x569fff(0x238)}}},{'$group':{'_id':_0x569fff(0x2bd),'name':{'$first':_0x569fff(0x2bd)}}},{'$sort':{'name':0x1}}]);const _0x4caf3c=await product[_0x569fff(0x202)]({});var _0x4677ae=[_0x569fff(0x26f),_0x569fff(0x2de)];const _0x2873f6=await sales[_0x569fff(0x202)]({}),_0x5b6f68=_0x2873f6[_0x569fff(0x2d2)]+0x1,_0x516ef4='OUT-'+_0x5b6f68[_0x569fff(0x1d8)]()[_0x569fff(0x263)](0x5,'0');if(_0x166e30[0x0]['language']==_0x569fff(0x279)){var _0x54887c=users[_0x569fff(0x25a)];console[_0x569fff(0x2aa)](_0x54887c);}else{if(_0x166e30[0x0][_0x569fff(0x233)]=='Hindi')var _0x54887c=users[_0x569fff(0x1d1)];else{if(_0x166e30[0x0][_0x569fff(0x233)]==_0x569fff(0x2c1))var _0x54887c=users[_0x569fff(0x2c1)];else{if(_0x166e30[0x0]['language']==_0x569fff(0x2cf))var _0x54887c=users[_0x569fff(0x2cf)];else{if(_0x166e30[0x0]['language']=='French')var _0x54887c=users[_0x569fff(0x2b8)];else{if(_0x166e30[0x0]['language']=='Portuguese\x20(BR)')var _0x54887c=users['Portuguese'];else{if(_0x166e30[0x0][_0x569fff(0x233)]==_0x569fff(0x2c6))var _0x54887c=users[_0x569fff(0x2c6)];else{if(_0x166e30[0x0]['language']=='Arabic\x20(ae)')var _0x54887c=users[_0x569fff(0x201)];}}}}}}}const _0x511c9a=getRandom8DigitNumber();_0x511c9a[_0x569fff(0x266)](_0x588782=>{var _0xca348=_0x569fff;_0x543d9a[_0xca348(0x28c)](_0xca348(0x25f),{'success':_0x348be7[_0xca348(0x224)](_0xca348(0x29a)),'errors':_0x348be7[_0xca348(0x224)](_0xca348(0x275)),'role':_0x83eba8,'profile':_0x511509,'customer':_0x471565,'warehouse':_0x9ab6c9,'product':_0x4caf3c,'invoice':_0x588782,'master_shop':_0x166e30,'language':_0x54887c,'rooms_data':_0x4677ae});})[_0x569fff(0x289)](_0x430840=>{var _0xc2748a=_0x569fff;_0x348be7[_0xc2748a(0x224)](_0xc2748a(0x275),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x543d9a[_0xc2748a(0x2a2)](_0xc2748a(0x2b3));});}catch(_0x34ea00){console[_0x569fff(0x2aa)](_0x34ea00);}}),router[a0_0x554414(0x242)]('/view/add_sales/:id',auth,async(_0x16ff0a,_0x3e35c9)=>{var _0x177185=a0_0x554414;try{const _0xf3930f=_0x16ff0a[_0x177185(0x1ea)]['id'];console[_0x177185(0x2aa)](_0xf3930f);const _0x1c72a4=await product[_0x177185(0x202)](),_0x359a34=await purchases[_0x177185(0x2b6)]([{'$match':{'warehouse_name':_0xf3930f}},{'$unwind':_0x177185(0x207)},{'$group':{'_id':_0x177185(0x2a4)}}]);console['log'](_0x177185(0x26a),_0x359a34),_0x3e35c9['status'](0xc8)[_0x177185(0x226)]({'purchases_data':_0x359a34,'product_data':_0x1c72a4});}catch(_0x465f82){console[_0x177185(0x2aa)](_0x465f82);}}),router['post'](a0_0x554414(0x205),auth,async(_0x170591,_0x4ac408)=>{var _0x462edd=a0_0x554414;try{const {warehouse_data:_0x1b22f2,product_data:_0x506f61}=_0x170591['body'];console[_0x462edd(0x2aa)](_0x170591[_0x462edd(0x215)][_0x462edd(0x213)]);;const _0x298fc9=await master_shop['find']();console[_0x462edd(0x2aa)]('master',_0x298fc9);const _0x3c0af7=await product['findOne']({'name':_0x506f61});console[_0x462edd(0x2aa)](_0x462edd(0x267),_0x3c0af7);const _0xe0b9cc=await warehouse[_0x462edd(0x2b6)]([{'$match':{'name':_0x1b22f2}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x506f61}},{'$group':{'_id':_0x462edd(0x2c0),'product_stock':{'$first':_0x462edd(0x21b)}}}]);console[_0x462edd(0x2aa)]('stock_data',_0xe0b9cc),_0x4ac408[_0x462edd(0x2c5)](0xc8)[_0x462edd(0x226)]({'master':_0x298fc9,'new_product':_0x3c0af7,'stock_data':_0xe0b9cc});}catch(_0x16ac5){console[_0x462edd(0x2aa)](_0x16ac5);}}),router[a0_0x554414(0x252)](a0_0x554414(0x20a),auth,async(_0x58c002,_0x4b175f)=>{var _0x39f7b0=a0_0x554414;try{const {invoice:_0x52494a,date:_0x5943e4,warehouse_name:_0x10689f,product_name:_0x34aa0b,stock:_0x30bdd4,quantity:_0x226f5c,note:_0x32c6f7,room:_0x86370a,primary_code:_0x594a91,secondary_code:_0x1d8419,prod_code:_0x50e81b,level:_0x33712c,isle:_0x58285c,pallet:_0xc0ad76,batch_code:_0x3ba7ae,SCRN:_0x4536d1,expiry_date:_0x239a28}=_0x58c002['body'];if(typeof _0x34aa0b==_0x39f7b0(0x292))var _0x10e9b4=[_0x58c002[_0x39f7b0(0x215)]['product_name']],_0x129a0f=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2d8)]],_0x1258c3=[_0x58c002['body']['carton']],_0x5ed2de=[_0x58c002['body'][_0x39f7b0(0x2bc)]],_0x3e2b61=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2a6)]],_0x176b93=[_0x58c002['body'][_0x39f7b0(0x29c)]],_0xb7366b=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x22e)]],_0x4fab95=[_0x58c002['body']['primary_unit']],_0x3ee603=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x1dc)]],_0x5169eb=[_0x58c002['body'][_0x39f7b0(0x264)]],_0x14eaca=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x23f)]],_0x8ead52=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2a7)]],_0xb2384f=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x28d)]],_0x501b74=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x203)]],_0x6691f4=[_0x58c002['body'][_0x39f7b0(0x216)]],_0x5ebf6c=[_0x58c002[_0x39f7b0(0x215)]['delivery_code']],_0x3ca44a=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x270)]],_0x41325c=[_0x58c002['body'][_0x39f7b0(0x1fd)]],_0x1abd10=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x1df)]],_0x84c13a=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x240)]],_0x5b34c2=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x239)]],_0x12afb5=[_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2b5)]],_0xe048c6=[_0x58c002[_0x39f7b0(0x215)]['id_transact']];else var _0x10e9b4=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x200)]],_0x129a0f=[..._0x58c002[_0x39f7b0(0x215)]['stock']],_0x1258c3=[..._0x58c002[_0x39f7b0(0x215)]['carton']],_0x5ed2de=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2bc)]],_0x3e2b61=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2a6)]],_0x176b93=[..._0x58c002[_0x39f7b0(0x215)]['prod_code']],_0xb7366b=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x22e)]],_0x4fab95=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x274)]],_0x3ee603=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x1dc)]],_0x5169eb=[..._0x58c002[_0x39f7b0(0x215)]['batch_code']],_0x14eaca=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x23f)]],_0x8ead52=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2a7)]],_0xb2384f=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x28d)]],_0x501b74=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x203)]],_0x6691f4=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x216)]],_0x5ebf6c=[..._0x58c002['body'][_0x39f7b0(0x234)]],_0x3ca44a=[..._0x58c002['body'][_0x39f7b0(0x270)]],_0x41325c=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x1fd)]],_0x1abd10=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x1df)]],_0x84c13a=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x240)]],_0x5b34c2=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x239)]],_0x12afb5=[..._0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x2b5)]],_0xe048c6=[..._0x58c002[_0x39f7b0(0x215)]['id_transact']];const _0x2cc2c4=_0x10e9b4['map'](_0x388609=>{return _0x388609={'product_name':_0x388609};});_0x129a0f[_0x39f7b0(0x211)]((_0x34f9c2,_0x707d18)=>{var _0x49d47c=_0x39f7b0;_0x2cc2c4[_0x707d18][_0x49d47c(0x2d8)]=Math[_0x49d47c(0x26e)](_0x34f9c2);}),_0x5b34c2[_0x39f7b0(0x211)]((_0x3412aa,_0x48175f)=>{var _0x5a3df6=_0x39f7b0;_0x2cc2c4[_0x48175f][_0x5a3df6(0x239)]=Math[_0x5a3df6(0x26e)](_0x3412aa);}),_0x12afb5[_0x39f7b0(0x211)]((_0x52afeb,_0x43defe)=>{var _0x537483=_0x39f7b0;_0x2cc2c4[_0x43defe][_0x537483(0x2b5)]=_0x52afeb;}),_0xe048c6[_0x39f7b0(0x211)]((_0x4d341d,_0x471503)=>{var _0x36fcd4=_0x39f7b0;_0x2cc2c4[_0x471503][_0x36fcd4(0x229)]=_0x4d341d;}),_0x1258c3[_0x39f7b0(0x211)]((_0x5d1007,_0xa7295d)=>{_0x2cc2c4[_0xa7295d]['quantity']=_0x5d1007;}),_0x5ed2de['forEach']((_0x1444b2,_0x152851)=>{var _0x51dc64=_0x39f7b0;_0x2cc2c4[_0x152851][_0x51dc64(0x2bc)]=_0x1444b2;}),_0x3e2b61[_0x39f7b0(0x211)]((_0x2b2150,_0x4e4eb5)=>{var _0x30b320=_0x39f7b0;_0x2cc2c4[_0x4e4eb5][_0x30b320(0x2a6)]=_0x2b2150;}),_0x176b93[_0x39f7b0(0x211)]((_0x567f36,_0x2af22e)=>{var _0x13ebf2=_0x39f7b0;_0x2cc2c4[_0x2af22e][_0x13ebf2(0x280)]=_0x567f36;}),_0xb7366b['forEach']((_0x42158c,_0x13c231)=>{var _0x52094f=_0x39f7b0;_0x1abd10[_0x52094f(0x211)]((_0x5859a4,_0x569b19)=>{var _0x331768=_0x52094f;if(_0x5859a4==_0x331768(0x210)&&_0x13c231==_0x569b19){var _0x252523=_0x42158c['slice'](0x3);_0x2cc2c4[_0x13c231][_0x331768(0x260)]=_0x42158c[0x0],_0x2cc2c4[_0x13c231][_0x331768(0x219)]=_0x42158c[0x1],_0x2cc2c4[_0x13c231][_0x331768(0x2c7)]=0x0,_0x2cc2c4[_0x13c231][_0x331768(0x284)]=0x0,_0x2cc2c4[_0x13c231]['type']=_0x331768(0x21a),_0x2cc2c4[_0x13c231][_0x331768(0x296)]=_0x252523;}else{if(_0x5859a4=='Shelves'&&_0x13c231==_0x569b19){var _0x252523=_0x42158c[_0x331768(0x21c)](0x3);_0x2cc2c4[_0x13c231][_0x331768(0x260)]=_0x42158c[0x0],_0x2cc2c4[_0x13c231][_0x331768(0x219)]=_0x42158c[0x1],_0x2cc2c4[_0x13c231][_0x331768(0x2c7)]=0x0,_0x2cc2c4[_0x13c231][_0x331768(0x284)]=0x0,_0x2cc2c4[_0x13c231][_0x331768(0x2c4)]='Floor',_0x2cc2c4[_0x13c231][_0x331768(0x296)]=_0x42158c[0x5];}else{if(_0x13c231==_0x569b19){var _0x395cc8;if(_0x42158c[0x4]=='L')_0x395cc8=_0x331768(0x1db);else _0x42158c[0x4]=='F'&&(_0x395cc8=_0x331768(0x21a));_0x2cc2c4[_0x13c231][_0x331768(0x260)]=_0x42158c[0x0],_0x2cc2c4[_0x13c231][_0x331768(0x219)]=_0x42158c[0x1],_0x2cc2c4[_0x13c231][_0x331768(0x2c7)]=_0x42158c[0x2],_0x2cc2c4[_0x13c231][_0x331768(0x284)]=_0x42158c[0x3],_0x2cc2c4[_0x13c231][_0x331768(0x2c4)]=_0x395cc8,_0x2cc2c4[_0x13c231][_0x331768(0x296)]=_0x42158c[0x5];}}}});}),_0x4fab95['forEach']((_0xdbe767,_0x5f3702)=>{_0x2cc2c4[_0x5f3702]['unit']=_0xdbe767;}),_0x3ee603[_0x39f7b0(0x211)]((_0x1427ba,_0x1255df)=>{_0x2cc2c4[_0x1255df]['secondary_unit']=_0x1427ba;}),_0x5169eb[_0x39f7b0(0x211)]((_0x47a9d9,_0xc32cd2)=>{var _0x353e69=_0x39f7b0;_0x2cc2c4[_0xc32cd2][_0x353e69(0x264)]=_0x47a9d9;}),_0x14eaca[_0x39f7b0(0x211)]((_0x2ff248,_0x115f7e)=>{var _0x498352=_0x39f7b0;_0x2cc2c4[_0x115f7e][_0x498352(0x23f)]=_0x2ff248;}),_0x8ead52[_0x39f7b0(0x211)]((_0x3cfc3d,_0x3dfca7)=>{var _0x14d588=_0x39f7b0;_0x2cc2c4[_0x3dfca7][_0x14d588(0x27c)]=_0x3cfc3d;}),_0xb2384f[_0x39f7b0(0x211)]((_0x3290c4,_0x1a1c2d)=>{var _0x38d453=_0x39f7b0;_0x2cc2c4[_0x1a1c2d][_0x38d453(0x28d)]=_0x3290c4;}),_0x501b74[_0x39f7b0(0x211)]((_0x223f7b,_0x59ddec)=>{var _0x15f6a3=_0x39f7b0;_0x2cc2c4[_0x59ddec][_0x15f6a3(0x203)]=_0x223f7b;}),_0x6691f4[_0x39f7b0(0x211)]((_0x4d5019,_0x1d1222)=>{var _0x400560=_0x39f7b0;_0x2cc2c4[_0x1d1222][_0x400560(0x216)]=_0x4d5019;}),_0x5ebf6c['forEach']((_0x39989b,_0xf7edfc)=>{var _0x19c36f=_0x39f7b0;_0x2cc2c4[_0xf7edfc][_0x19c36f(0x234)]=_0x39989b;}),_0x3ca44a['forEach']((_0x4c9225,_0x1b49c8)=>{var _0x369159=_0x39f7b0;_0x2cc2c4[_0x1b49c8][_0x369159(0x270)]=_0x4c9225;}),_0x41325c[_0x39f7b0(0x211)]((_0x55826e,_0x369504)=>{var _0x12443a=_0x39f7b0;_0x2cc2c4[_0x369504][_0x12443a(0x286)]=_0x55826e;}),_0x1abd10[_0x39f7b0(0x211)]((_0x237353,_0x3ff93a)=>{_0x2cc2c4[_0x3ff93a]['room_name']=_0x237353;}),_0x84c13a['forEach']((_0x3c6a19,_0x497eee)=>{var _0x1142fd=_0x39f7b0;_0x2cc2c4[_0x497eee][_0x1142fd(0x245)]=_0x3c6a19;});var _0x13bb25=0x0;_0x2cc2c4[_0x39f7b0(0x211)](_0x591ae4=>{var _0x524fba=_0x39f7b0;(_0x591ae4[_0x524fba(0x2d8)]<_0x591ae4[_0x524fba(0x286)]||_0x591ae4[_0x524fba(0x286)]==0x0)&&(console[_0x524fba(0x2aa)]('foreach\x20newproduct',_0x591ae4),_0x13bb25++);});const _0x21e839=_0x2cc2c4[_0x39f7b0(0x277)](_0x19b709=>_0x19b709[_0x39f7b0(0x1fd)]!=='0'&&_0x19b709[_0x39f7b0(0x1fd)]!==''),_0x412e37=new sales({'invoice':_0x52494a,'customer':_0x58c002[_0x39f7b0(0x215)][_0x39f7b0(0x25b)],'date':_0x5943e4,'warehouse_name':_0x10689f,'sale_product':_0x21e839,'note':_0x32c6f7,'room':_0x86370a,'primary_code':_0x594a91,'secondary_code':_0x1d8419,'prod_code':_0x50e81b,'SCRN':_0x4536d1}),_0x4f1109=await _0x412e37['save']();_0x58c002[_0x39f7b0(0x224)](_0x39f7b0(0x29a),_0x39f7b0(0x20d)),_0x4b175f[_0x39f7b0(0x2a2)](_0x39f7b0(0x1fa)+_0x4f1109[_0x39f7b0(0x283)]);}catch(_0x24e838){console[_0x39f7b0(0x2aa)](_0x24e838);}}),router[a0_0x554414(0x242)](a0_0x554414(0x262),auth,async(_0x4c2097,_0x220617)=>{var _0x54553e=a0_0x554414;try{const {username:_0x3ac2b3,email:_0x54f173,role:_0x39b92f}=_0x4c2097['user'],_0x143997=_0x4c2097['user'],_0x424267=await profile[_0x54553e(0x2c2)]({'email':_0x143997['email']}),_0x1afd8e=await master_shop[_0x54553e(0x202)](),_0xe9aacd=_0x4c2097['params']['id'],_0x478efa=await sales[_0x54553e(0x26c)](_0xe9aacd),_0x5d2336=await warehouse[_0x54553e(0x2b6)]([{'$match':{'name':_0x478efa[_0x54553e(0x1d6)]}},{'$unwind':_0x54553e(0x2d1)},{'$group':{'_id':_0x54553e(0x22c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x54553e(0x21b)},'bay':{'$first':_0x54553e(0x237)},'bin':{'$first':_0x54553e(0x2b9)},'type':{'$first':_0x54553e(0x23b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x54553e(0x2d0)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x54553e(0x23e)},'storage':{'$first':_0x54553e(0x232)},'rack':{'$first':_0x54553e(0x253)},'expiry_date':{'$first':_0x54553e(0x255)},'production_date':{'$first':_0x54553e(0x228)},'invoice':{'$first':_0x54553e(0x236)}}}]),_0x307e2a=await customer[_0x54553e(0x202)]({});let _0x3d94f7;if(_0x143997[_0x54553e(0x244)]==_0x54553e(0x1e1)){const _0x57243f=await staff[_0x54553e(0x2c2)]({'email':_0x143997[_0x54553e(0x1e2)]});_0x3d94f7=await warehouse['aggregate']([{'$match':{'status':_0x54553e(0x223),'name':_0x57243f[_0x54553e(0x299)]}},{'$group':{'_id':_0x54553e(0x2bd),'name':{'$first':_0x54553e(0x2bd)}}}]);}else _0x3d94f7=await warehouse[_0x54553e(0x2b6)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x54553e(0x2bd)}}}]);const _0x6b771c=await product[_0x54553e(0x202)]({}),_0xf03de3=await suppliers[_0x54553e(0x202)]({});if(_0x1afd8e[0x0][_0x54553e(0x233)]=='English\x20(US)'){var _0x2d001d=users[_0x54553e(0x25a)];console[_0x54553e(0x2aa)](_0x2d001d);}else{if(_0x1afd8e[0x0][_0x54553e(0x233)]=='Hindi')var _0x2d001d=users[_0x54553e(0x1d1)];else{if(_0x1afd8e[0x0][_0x54553e(0x233)]==_0x54553e(0x2c1))var _0x2d001d=users[_0x54553e(0x2c1)];else{if(_0x1afd8e[0x0][_0x54553e(0x233)]=='Spanish')var _0x2d001d=users[_0x54553e(0x2cf)];else{if(_0x1afd8e[0x0][_0x54553e(0x233)]=='French')var _0x2d001d=users[_0x54553e(0x2b8)];else{if(_0x1afd8e[0x0]['language']=='Portuguese\x20(BR)')var _0x2d001d=users['Portuguese'];else{if(_0x1afd8e[0x0]['language']==_0x54553e(0x2c6))var _0x2d001d=users[_0x54553e(0x2c6)];else{if(_0x1afd8e[0x0][_0x54553e(0x233)]==_0x54553e(0x2df))var _0x2d001d=users['Arabic'];}}}}}}}_0x220617[_0x54553e(0x28c)](_0x54553e(0x2a1),{'success':_0x4c2097[_0x54553e(0x224)](_0x54553e(0x29a)),'errors':_0x4c2097[_0x54553e(0x224)](_0x54553e(0x275)),'role':_0x143997,'profile':_0x424267,'customer':_0x307e2a,'warehouse':_0x3d94f7,'product':_0x5d2336,'user':_0x478efa,'master_shop':_0x1afd8e,'unit':_0x6b771c,'language':_0x2d001d,'suppliers':_0xf03de3});}catch(_0x5b5b87){console[_0x54553e(0x2aa)](_0x5b5b87);}}),router[a0_0x554414(0x252)](a0_0x554414(0x262),auth,async(_0x48ae0d,_0xb23904)=>{var _0x33dab9=a0_0x554414;try{const _0x4f2658=_0x48ae0d[_0x33dab9(0x1ea)]['id'],{invoice:_0x13b553,warehouse_name:_0x573dd3,room:_0x26a58d}=_0x48ae0d['body'],_0x4541b1=await sales[_0x33dab9(0x2c2)]({'invoice':_0x13b553}),_0x1e9b17=_0x4541b1['sale_product'][_0x33dab9(0x206)](async _0x36eddd=>{var _0x1cac49=_0x33dab9,_0x8c4173=await warehouse[_0x1cac49(0x2c2)]({'name':_0x573dd3,'room':_0x36eddd[_0x1cac49(0x2b2)],'warehouse_category':'Raw\x20Materials'});const _0x1d1543=_0x8c4173['product_details'][_0x1cac49(0x206)](_0x43ed8d=>{var _0x55537f=_0x1cac49;_0x43ed8d['product_name']==_0x36eddd[_0x55537f(0x200)]&&_0x43ed8d[_0x55537f(0x296)]==_0x36eddd[_0x55537f(0x296)]&&_0x43ed8d['type']==_0x36eddd['type']&&_0x43ed8d[_0x55537f(0x284)]==_0x36eddd[_0x55537f(0x284)]&&_0x43ed8d[_0x55537f(0x2c7)]==_0x36eddd[_0x55537f(0x2c7)]&&_0x43ed8d[_0x55537f(0x219)]==_0x36eddd['rack']&&_0x43ed8d[_0x55537f(0x260)]==_0x36eddd[_0x55537f(0x260)]&&_0x43ed8d[_0x55537f(0x23f)]==_0x36eddd[_0x55537f(0x23f)]&&_0x43ed8d[_0x55537f(0x264)]==_0x36eddd[_0x55537f(0x264)]&&_0x43ed8d[_0x55537f(0x245)]==_0x36eddd[_0x55537f(0x245)]&&_0x43ed8d[_0x55537f(0x283)]==_0x36eddd[_0x55537f(0x229)]&&(_0x43ed8d[_0x55537f(0x1eb)]=Math[_0x55537f(0x217)](0x0,Math[_0x55537f(0x26e)](_0x43ed8d[_0x55537f(0x1eb)])-Math[_0x55537f(0x26e)](_0x36eddd[_0x55537f(0x1fd)])));});return _0x8c4173;});Promise[_0x33dab9(0x1d4)](_0x1e9b17)['then'](async _0xe7b696=>{var _0x4f3fd5=_0x33dab9;try{for(const _0x4936ea of _0xe7b696){await _0x4936ea[_0x4f3fd5(0x23d)]();}_0x4541b1[_0x4f3fd5(0x25e)]=_0x4f3fd5(0x256);const _0x3e1718=await _0x4541b1[_0x4f3fd5(0x23d)](),_0x429f51=await master_shop['find'](),_0x306df3=await email_settings['findOne'](),_0x576c2b=await supervisor_settings[_0x4f3fd5(0x202)]();var _0x44b597=_0x4541b1[_0x4f3fd5(0x285)],_0x23e94d='',_0x36c8dc;for(_0x36c8dc in _0x44b597){_0x23e94d+=_0x4f3fd5(0x1fe)+_0x4f3fd5(0x278)+_0x44b597[_0x36c8dc]['product_name']+'</td>'+_0x4f3fd5(0x278)+_0x44b597[_0x36c8dc]['product_code']+_0x4f3fd5(0x1f6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44b597[_0x36c8dc]['quantity']+_0x4f3fd5(0x1f6)+_0x4f3fd5(0x278)+_0x44b597[_0x36c8dc][_0x4f3fd5(0x1e3)]+_0x4f3fd5(0x1f6)+_0x4f3fd5(0x278)+_0x44b597[_0x36c8dc][_0x4f3fd5(0x1dc)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4541b1[_0x4f3fd5(0x1d6)]+_0x4f3fd5(0x1f6)+_0x4f3fd5(0x278)+_0x44b597[_0x36c8dc][_0x4f3fd5(0x2b2)]+'</td>'+_0x4f3fd5(0x278)+_0x44b597[_0x36c8dc][_0x4f3fd5(0x260)]+_0x44b597[_0x36c8dc]['rack']+_0x44b597[_0x36c8dc][_0x4f3fd5(0x2c7)]+_0x44b597[_0x36c8dc][_0x4f3fd5(0x284)]+_0x44b597[_0x36c8dc]['type'][0x0]+_0x44b597[_0x36c8dc][_0x4f3fd5(0x296)]+'</td>','</tr>';}let _0x1bf638=nodemailer[_0x4f3fd5(0x1f4)]({'host':_0x306df3[_0x4f3fd5(0x2b4)],'port':Number(_0x306df3['port']),'secure':![],'auth':{'user':_0x306df3[_0x4f3fd5(0x1e2)],'pass':_0x306df3[_0x4f3fd5(0x254)]}}),_0x1e84c7={'from':_0x306df3[_0x4f3fd5(0x1e2)],'to':_0x576c2b[0x0][_0x4f3fd5(0x27a)],'subject':_0x4f3fd5(0x24f),'attachments':[{'filename':_0x4f3fd5(0x1d7),'path':__dirname+_0x4f3fd5(0x290)+_0x4f3fd5(0x1f8)+_0x429f51[0x0][_0x4f3fd5(0x24c)],'cid':_0x4f3fd5(0x1f1)}],'html':_0x4f3fd5(0x2c3)+'<html><head><title></title>'+_0x4f3fd5(0x25d)+_0x4f3fd5(0x2bf)+_0x4f3fd5(0x2d9)+_0x4f3fd5(0x2bf)+_0x4f3fd5(0x204)+_0x4f3fd5(0x2da)+_0x4f3fd5(0x2bf)+'<h2>\x20'+_0x429f51[0x0]['site_title']+_0x4f3fd5(0x265)+_0x4f3fd5(0x2da)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x4f3fd5(0x2bf)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x4541b1[_0x4f3fd5(0x245)]+'\x20'+_0x4f3fd5(0x1e6)+_0x4f3fd5(0x243)+_0x4541b1[_0x4f3fd5(0x27e)]+'\x20'+_0x4f3fd5(0x21f)+_0x4f3fd5(0x2d7)+_0x4f3fd5(0x2da)+_0x4f3fd5(0x282)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4f3fd5(0x1fe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4f3fd5(0x1f5)+_0x4f3fd5(0x20c)+_0x4f3fd5(0x24d)+_0x4f3fd5(0x22a)+_0x4f3fd5(0x2ab)+_0x4f3fd5(0x26b)+_0x4f3fd5(0x2ad)+'</thead>'+_0x4f3fd5(0x1ed)+'\x20'+_0x23e94d+'\x20'+_0x4f3fd5(0x2c9)+_0x4f3fd5(0x269)+_0x4f3fd5(0x2bf)+_0x4f3fd5(0x212)+_0x4f3fd5(0x2c8)+_0x429f51[0x0][_0x4f3fd5(0x25c)]+'</h5>'+_0x4f3fd5(0x2da)+'</div>'+_0x4f3fd5(0x1da)};_0x1bf638['sendMail'](_0x1e84c7,function(_0x2d91f4,_0x39a5db){var _0x8352bb=_0x4f3fd5;_0x2d91f4?(console[_0x8352bb(0x2aa)](_0x2d91f4),console[_0x8352bb(0x2aa)](_0x8352bb(0x1dd))):console[_0x8352bb(0x2aa)](_0x8352bb(0x281));}),_0x48ae0d[_0x4f3fd5(0x224)]('success',_0x4f3fd5(0x250)),_0xb23904[_0x4f3fd5(0x2a2)](_0x4f3fd5(0x1fa)+_0x4f2658);}catch(_0x25c8c8){console[_0x4f3fd5(0x258)](_0x25c8c8),_0xb23904[_0x4f3fd5(0x2c5)](0x1f4)['json']({'error':_0x4f3fd5(0x2b7)});}})['catch'](_0x48ce97=>{var _0x501619=_0x33dab9;console[_0x501619(0x258)](_0x48ce97),_0xb23904[_0x501619(0x2c5)](0x1f4)[_0x501619(0x226)]({'error':_0x501619(0x2cc)});});}catch(_0x32ef47){console['log'](_0x32ef47);}}),router[a0_0x554414(0x242)]('/view/:id',auth,async(_0x51d7e4,_0x3963cb)=>{var _0x3c2498=a0_0x554414;try{const {username:_0x264379,email:_0x5487bc,role:_0x35aecb}=_0x51d7e4[_0x3c2498(0x1de)],_0x480fe0=_0x51d7e4['user'],_0x40c532=await profile['findOne']({'email':_0x480fe0['email']}),_0x34312e=await master_shop['find'](),_0x5f3d7d=_0x51d7e4[_0x3c2498(0x1ea)]['id'],_0x51c72b=await sales['findById'](_0x5f3d7d);var _0x5bc5f4=[_0x3c2498(0x26f),_0x3c2498(0x2de)];const _0x4622e9=await warehouse['aggregate']([{'$match':{'name':_0x51c72b[_0x3c2498(0x1d6)],'warehouse_category':_0x3c2498(0x2be)}},{'$unwind':_0x3c2498(0x2d1)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3c2498(0x2c0)},'product_stock':{'$first':_0x3c2498(0x21b)},'bay':{'$first':_0x3c2498(0x237)},'bin':{'$first':_0x3c2498(0x2b9)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3c2498(0x2d0)},'secondary_code':{'$first':_0x3c2498(0x1e4)},'product_code':{'$first':_0x3c2498(0x23e)},'storage':{'$first':_0x3c2498(0x232)},'rack':{'$first':_0x3c2498(0x253)}}}]),_0x3bc452=await customer[_0x3c2498(0x202)]({});let _0x4397c9;if(_0x480fe0[_0x3c2498(0x244)]==_0x3c2498(0x1e1)){const _0x1a795e=await staff[_0x3c2498(0x2c2)]({'email':_0x480fe0[_0x3c2498(0x1e2)]});_0x4397c9=await warehouse[_0x3c2498(0x2b6)]([{'$match':{'status':_0x3c2498(0x223),'name':_0x1a795e[_0x3c2498(0x299)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x3c2498(0x2bd)}}}]);}else _0x4397c9=await warehouse[_0x3c2498(0x2b6)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3c2498(0x2bd),'name':{'$first':_0x3c2498(0x2bd)}}}]);const _0x2d7412=await product['find']({});if(_0x34312e[0x0]['language']==_0x3c2498(0x279)){var _0x4968ed=users[_0x3c2498(0x25a)];console[_0x3c2498(0x2aa)](_0x4968ed);}else{if(_0x34312e[0x0][_0x3c2498(0x233)]==_0x3c2498(0x1d1))var _0x4968ed=users[_0x3c2498(0x1d1)];else{if(_0x34312e[0x0]['language']==_0x3c2498(0x2c1))var _0x4968ed=users[_0x3c2498(0x2c1)];else{if(_0x34312e[0x0][_0x3c2498(0x233)]==_0x3c2498(0x2cf))var _0x4968ed=users[_0x3c2498(0x2cf)];else{if(_0x34312e[0x0][_0x3c2498(0x233)]==_0x3c2498(0x2b8))var _0x4968ed=users[_0x3c2498(0x2b8)];else{if(_0x34312e[0x0][_0x3c2498(0x233)]==_0x3c2498(0x241))var _0x4968ed=users['Portuguese'];else{if(_0x34312e[0x0][_0x3c2498(0x233)]==_0x3c2498(0x2c6))var _0x4968ed=users[_0x3c2498(0x2c6)];else{if(_0x34312e[0x0][_0x3c2498(0x233)]==_0x3c2498(0x2df))var _0x4968ed=users[_0x3c2498(0x201)];}}}}}}}_0x3963cb['render'](_0x3c2498(0x230),{'success':_0x51d7e4[_0x3c2498(0x224)](_0x3c2498(0x29a)),'errors':_0x51d7e4[_0x3c2498(0x224)](_0x3c2498(0x275)),'role':_0x480fe0,'profile':_0x40c532,'customer':_0x3bc452,'warehouse':_0x4397c9,'product':_0x4622e9,'user':_0x51c72b,'master_shop':_0x34312e,'unit':_0x2d7412,'language':_0x4968ed});}catch(_0x5f2ce6){console['log'](_0x5f2ce6);}}),router[a0_0x554414(0x252)](a0_0x554414(0x2cd),auth,async(_0x362791,_0x34c9e9)=>{var _0x49cafa=a0_0x554414;try{const _0x52d8c7=_0x362791['params']['id'],_0x19324b=await sales[_0x49cafa(0x2c2)]({'_id':_0x362791[_0x49cafa(0x1ea)]['id']}),_0x17a988=await warehouse['findOne']({'name':_0x19324b[_0x49cafa(0x1d6)],'room':_0x362791[_0x49cafa(0x215)][_0x49cafa(0x20f)]}),{invoice:_0x1843c5,date:_0x139072,warehouse_name:_0x2ad99b,product_name:_0x45efe2,stock:_0x297770,quantity:_0x5e6ce4,note:_0x4fe6a1,room:_0x353858,customer:_0x2cc0c6,SCRN:_0x54e789}=_0x362791[_0x49cafa(0x215)];if(typeof _0x45efe2=='string')var _0x5ea620=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x200)]],_0x28df55=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x2d8)]],_0x1e0e0f=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x2d5)]],_0x3a0cdb=[_0x362791[_0x49cafa(0x215)]['primary_code']],_0x310d04=[_0x362791[_0x49cafa(0x215)]['secondary_code']],_0x437d2f=[_0x362791['body'][_0x49cafa(0x29c)]],_0x22c03c=[_0x362791['body'][_0x49cafa(0x22e)]],_0x3eafd4=[_0x362791['body']['primary_unit']],_0x443aad=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x1dc)]],_0x379dc9=[_0x362791['body'][_0x49cafa(0x264)]],_0x59598b=[_0x362791['body'][_0x49cafa(0x23f)]],_0x10aedb=[_0x362791[_0x49cafa(0x215)]['max_per_unit']],_0x2ce2e1=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x28d)]],_0x300ac9=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x203)]],_0x20464d=[_0x362791['body'][_0x49cafa(0x216)]],_0x21046e=[_0x362791['body'][_0x49cafa(0x234)]],_0x493539=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x270)]],_0x3eed71=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x1fd)]],_0x1c9a0a=[_0x362791[_0x49cafa(0x215)][_0x49cafa(0x1df)]];else var _0x5ea620=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x200)]],_0x28df55=[..._0x362791[_0x49cafa(0x215)]['stock']],_0x1e0e0f=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x2d5)]],_0x3a0cdb=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x2bc)]],_0x310d04=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x2a6)]],_0x437d2f=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x29c)]],_0x22c03c=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x22e)]],_0x3eafd4=[..._0x362791[_0x49cafa(0x215)]['primary_unit']],_0x443aad=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x1dc)]],_0x379dc9=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x264)]],_0x59598b=[..._0x362791['body'][_0x49cafa(0x23f)]],_0x10aedb=[..._0x362791[_0x49cafa(0x215)]['max_per_unit']],_0x2ce2e1=[..._0x362791['body'][_0x49cafa(0x28d)]],_0x300ac9=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x203)]],_0x20464d=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x216)]],_0x21046e=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x234)]],_0x493539=[..._0x362791[_0x49cafa(0x215)][_0x49cafa(0x270)]],_0x3eed71=[..._0x362791['body']['quantity']],_0x1c9a0a=[..._0x362791['body']['RoomAssigned']];const _0x527eb7=_0x5ea620[_0x49cafa(0x206)](_0x4ede54=>{return _0x4ede54={'product_name':_0x4ede54};});_0x28df55[_0x49cafa(0x211)]((_0x37bc3c,_0x4fc2b8)=>{var _0x12c655=_0x49cafa;_0x527eb7[_0x4fc2b8][_0x12c655(0x2d8)]=Math[_0x12c655(0x26e)](_0x37bc3c);}),_0x1e0e0f['forEach']((_0x1c9a50,_0x51d5ec)=>{var _0x5b145b=_0x49cafa;_0x527eb7[_0x51d5ec][_0x5b145b(0x1fd)]=_0x1c9a50;}),_0x3a0cdb['forEach']((_0x4015a7,_0x4b8070)=>{_0x527eb7[_0x4b8070]['primary_code']=_0x4015a7;}),_0x310d04[_0x49cafa(0x211)]((_0x1bcde1,_0x2ee66e)=>{var _0x5e3f5d=_0x49cafa;_0x527eb7[_0x2ee66e][_0x5e3f5d(0x2a6)]=_0x1bcde1;}),_0x437d2f[_0x49cafa(0x211)]((_0x289f6c,_0x38963b)=>{var _0x1bb0a7=_0x49cafa;_0x527eb7[_0x38963b][_0x1bb0a7(0x280)]=_0x289f6c;}),_0x22c03c[_0x49cafa(0x211)]((_0x22fd1e,_0x4baba0)=>{var _0xc6e285=_0x49cafa;_0x1c9a0a[_0xc6e285(0x211)]((_0xe2e9eb,_0x256177)=>{var _0x2473e8=_0xc6e285;if(_0xe2e9eb==_0x2473e8(0x210)&&_0x4baba0==_0x256177){var _0x508e28=_0x22fd1e['slice'](0x3);_0x527eb7[_0x4baba0][_0x2473e8(0x260)]=_0x22fd1e[0x0],_0x527eb7[_0x4baba0][_0x2473e8(0x219)]=_0x22fd1e[0x1],_0x527eb7[_0x4baba0][_0x2473e8(0x2c7)]=0x0,_0x527eb7[_0x4baba0]['bin']=0x0,_0x527eb7[_0x4baba0][_0x2473e8(0x2c4)]=_0x2473e8(0x21a),_0x527eb7[_0x4baba0][_0x2473e8(0x296)]=_0x508e28;}else{if(_0xe2e9eb==_0x2473e8(0x220)&&_0x4baba0==_0x256177){var _0x508e28=_0x22fd1e[_0x2473e8(0x21c)](0x3);_0x527eb7[_0x4baba0][_0x2473e8(0x260)]=_0x22fd1e[0x0],_0x527eb7[_0x4baba0][_0x2473e8(0x219)]=_0x22fd1e[0x1],_0x527eb7[_0x4baba0][_0x2473e8(0x2c7)]=0x0,_0x527eb7[_0x4baba0][_0x2473e8(0x284)]=0x0,_0x527eb7[_0x4baba0]['type']=_0x2473e8(0x21a),_0x527eb7[_0x4baba0]['floorlevel']=_0x22fd1e[0x5];}else{if(_0x4baba0==_0x256177){var _0xd60d86;if(_0x22fd1e[0x4]=='L')_0xd60d86=_0x2473e8(0x1db);else _0x22fd1e[0x4]=='F'&&(_0xd60d86=_0x2473e8(0x21a));_0x527eb7[_0x4baba0]['storage']=_0x22fd1e[0x0],_0x527eb7[_0x4baba0][_0x2473e8(0x219)]=_0x22fd1e[0x1],_0x527eb7[_0x4baba0][_0x2473e8(0x2c7)]=_0x22fd1e[0x2],_0x527eb7[_0x4baba0]['bin']=_0x22fd1e[0x3],_0x527eb7[_0x4baba0][_0x2473e8(0x2c4)]=_0xd60d86,_0x527eb7[_0x4baba0]['floorlevel']=_0x22fd1e[0x5];}}}});}),_0x3eafd4[_0x49cafa(0x211)]((_0x4aeae6,_0x36164f)=>{var _0x1edede=_0x49cafa;_0x527eb7[_0x36164f][_0x1edede(0x1e3)]=_0x4aeae6;}),_0x443aad['forEach']((_0x266a31,_0xe37eea)=>{var _0x39ad8a=_0x49cafa;_0x527eb7[_0xe37eea][_0x39ad8a(0x1dc)]=_0x266a31;}),_0x379dc9['forEach']((_0x404fca,_0x58b5d8)=>{var _0x3ac977=_0x49cafa;_0x527eb7[_0x58b5d8][_0x3ac977(0x264)]=_0x404fca;}),_0x59598b[_0x49cafa(0x211)]((_0x4f97c7,_0x339e8a)=>{var _0x148820=_0x49cafa;_0x527eb7[_0x339e8a][_0x148820(0x23f)]=_0x4f97c7;}),_0x10aedb[_0x49cafa(0x211)]((_0x297950,_0x2b4c7c)=>{_0x527eb7[_0x2b4c7c]['maxperunit']=_0x297950;}),_0x2ce2e1[_0x49cafa(0x211)]((_0x500053,_0x26d0ae)=>{var _0x515435=_0x49cafa;_0x527eb7[_0x26d0ae][_0x515435(0x28d)]=_0x500053;}),_0x300ac9[_0x49cafa(0x211)]((_0x54653f,_0x3f1a0a)=>{var _0x28b7db=_0x49cafa;_0x527eb7[_0x3f1a0a]['requested_qty']=Math[_0x28b7db(0x26e)](_0x54653f);}),_0x20464d[_0x49cafa(0x211)]((_0x116309,_0x32e23b)=>{var _0x58b620=_0x49cafa;_0x527eb7[_0x32e23b][_0x58b620(0x216)]=_0x116309;}),_0x21046e['forEach']((_0x44ffea,_0xfacc70)=>{var _0x3b5870=_0x49cafa;_0x527eb7[_0xfacc70][_0x3b5870(0x234)]=_0x44ffea;}),_0x493539[_0x49cafa(0x211)]((_0x1c5f3c,_0x42dc60)=>{var _0x6c927b=_0x49cafa;_0x527eb7[_0x42dc60][_0x6c927b(0x270)]=_0x1c5f3c;}),_0x3eed71['forEach']((_0x3ea9f4,_0x215d46)=>{var _0x18d2dc=_0x49cafa;_0x527eb7[_0x215d46][_0x18d2dc(0x286)]=_0x3ea9f4;}),_0x1c9a0a[_0x49cafa(0x211)]((_0x5bdd44,_0x204726)=>{var _0x4e8ce1=_0x49cafa;_0x527eb7[_0x204726][_0x4e8ce1(0x2b2)]=_0x5bdd44;});var _0x36cec9=0x0;_0x527eb7[_0x49cafa(0x211)](_0x273502=>{var _0x5f0476=_0x49cafa;console[_0x5f0476(0x2aa)]('foreach\x20newproduct',_0x273502),(parseInt(_0x273502['stock'])<parseInt(_0x273502[_0x5f0476(0x1fd)])||parseInt(_0x273502[_0x5f0476(0x1fd)])==0x0)&&_0x36cec9++;});if(_0x36cec9!=0x0)return _0x362791['flash'](_0x49cafa(0x275),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x34c9e9['redirect'](_0x49cafa(0x2a8));const _0xfe5080=_0x527eb7['filter'](_0x5bcd9f=>_0x5bcd9f['quantity']!=='0'&&_0x5bcd9f[_0x49cafa(0x1fd)]!=='');_0x19324b['invoice']=_0x1843c5,_0x19324b[_0x49cafa(0x25b)]=_0x2cc0c6,_0x19324b[_0x49cafa(0x27e)]=_0x139072,_0x19324b['warehouse_name']=_0x2ad99b,_0x19324b[_0x49cafa(0x285)]=_0xfe5080,_0x19324b[_0x49cafa(0x29d)]=_0x4fe6a1,_0x19324b['SCRN']=_0x54e789,_0x19324b[_0x49cafa(0x25e)]=_0x49cafa(0x251),_0x19324b[_0x49cafa(0x22d)]=_0x49cafa(0x251);const _0x33e867=await _0x19324b[_0x49cafa(0x23d)]();_0x362791[_0x49cafa(0x224)](_0x49cafa(0x29a),'Sales\x20Update\x20successfully'),_0x34c9e9['redirect'](_0x49cafa(0x2b3));}catch(_0x5e2d60){console[_0x49cafa(0x2aa)](_0x5e2d60);}}),router[a0_0x554414(0x252)](a0_0x554414(0x222),auth,async(_0x351746,_0x224c33)=>{var _0x2e626c=a0_0x554414;try{const _0x48fb8f=_0x351746['params']['id'],{invoice:_0x1a4c40,customer:_0x238f34,receivable_amount:_0x27fa95,received_amount:_0x172af4}=_0x351746[_0x2e626c(0x215)],_0x2117f5=await sales['findById'](_0x48fb8f);console['log'](_0x2117f5);var _0x5d450d=_0x27fa95-_0x172af4;console[_0x2e626c(0x2aa)](_0x172af4),_0x2117f5[_0x2e626c(0x2a0)]=parseFloat(_0x172af4)+parseFloat(_0x2117f5[_0x2e626c(0x2a0)]),_0x2117f5[_0x2e626c(0x293)]=_0x5d450d,console[_0x2e626c(0x2aa)](_0x2117f5);const _0x51872c=await _0x2117f5[_0x2e626c(0x23d)](),_0x225298=await c_payment_data['findOne']({'invoice':_0x1a4c40});_0x225298['amount']=_0x5d450d,await _0x225298[_0x2e626c(0x23d)]();let _0x4387d7=new Date(),_0x461bb9=('0'+_0x4387d7['getDate']())[_0x2e626c(0x21c)](-0x2),_0xe680f2=('0'+(_0x4387d7[_0x2e626c(0x287)]()+0x1))[_0x2e626c(0x21c)](-0x2),_0x3a0a92=_0x4387d7['getFullYear'](),_0x52a0ad=_0x3a0a92+'-'+_0xe680f2+'-'+_0x461bb9;const _0x5ed81f=new customer_payment({'invoice':_0x1a4c40,'date':_0x3a0a92+'-'+_0xe680f2+'-'+_0x461bb9,'customer':_0x238f34,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x172af4}),_0x5f5380=await _0x5ed81f[_0x2e626c(0x23d)]();_0x351746[_0x2e626c(0x224)](_0x2e626c(0x29a),'payment\x20successfull'),_0x224c33['redirect'](_0x2e626c(0x2b3));}catch(_0x249af9){console[_0x2e626c(0x2aa)](_0x249af9);}}),router[a0_0x554414(0x242)](a0_0x554414(0x247),auth,async(_0x3b4f69,_0x3bbd10)=>{var _0x362aa0=a0_0x554414;try{const {username:_0x343ccb,email:_0x58d258,role:_0x32c0ee}=_0x3b4f69[_0x362aa0(0x1de)],_0x428ba3=_0x3b4f69['user'],_0x476fca=await profile[_0x362aa0(0x2c2)]({'email':_0x428ba3['email']}),_0x33f50e=await master_shop['find']();console[_0x362aa0(0x2aa)](_0x362aa0(0x28a),_0x33f50e);const _0x50eead=_0x3b4f69[_0x362aa0(0x1ea)]['id'],_0x12854c=await sales[_0x362aa0(0x26c)](_0x50eead);console[_0x362aa0(0x2aa)](_0x12854c);const _0x15e535=await customer[_0x362aa0(0x2c2)]({'name':_0x12854c[_0x362aa0(0x25b)]});console['log'](_0x15e535);if(_0x33f50e[0x0]['language']==_0x362aa0(0x279)){var _0xd1af6=users[_0x362aa0(0x25a)];console[_0x362aa0(0x2aa)](_0xd1af6);}else{if(_0x33f50e[0x0][_0x362aa0(0x233)]==_0x362aa0(0x1d1))var _0xd1af6=users[_0x362aa0(0x1d1)];else{if(_0x33f50e[0x0][_0x362aa0(0x233)]==_0x362aa0(0x2c1))var _0xd1af6=users[_0x362aa0(0x2c1)];else{if(_0x33f50e[0x0][_0x362aa0(0x233)]=='Spanish')var _0xd1af6=users[_0x362aa0(0x2cf)];else{if(_0x33f50e[0x0][_0x362aa0(0x233)]==_0x362aa0(0x2b8))var _0xd1af6=users['French'];else{if(_0x33f50e[0x0]['language']==_0x362aa0(0x241))var _0xd1af6=users['Portuguese'];else{if(_0x33f50e[0x0][_0x362aa0(0x233)]=='Chinese')var _0xd1af6=users[_0x362aa0(0x2c6)];else{if(_0x33f50e[0x0][_0x362aa0(0x233)]==_0x362aa0(0x2df))var _0xd1af6=users[_0x362aa0(0x201)];}}}}}}}_0x3bbd10[_0x362aa0(0x28c)](_0x362aa0(0x24b),{'success':_0x3b4f69[_0x362aa0(0x224)]('success'),'errors':_0x3b4f69[_0x362aa0(0x224)](_0x362aa0(0x275)),'role':_0x428ba3,'profile':_0x476fca,'master_shop':_0x33f50e,'customers':_0x15e535,'sales':_0x12854c,'language':_0xd1af6});}catch(_0x69a688){console['log'](_0x69a688);}}),router[a0_0x554414(0x242)](a0_0x554414(0x2dd),auth,async(_0x1df08c,_0x5f5c3c)=>{var _0x4accdc=a0_0x554414;try{const {username:_0x57353a,email:_0x35088f,role:_0x4cbdb9}=_0x1df08c[_0x4accdc(0x1de)],_0x275aa6=_0x1df08c[_0x4accdc(0x1de)],_0x29fa33=await profile[_0x4accdc(0x2c2)]({'email':_0x275aa6[_0x4accdc(0x1e2)]}),_0x5e1c3d=await master_shop[_0x4accdc(0x202)]();console[_0x4accdc(0x2aa)](_0x4accdc(0x28a),_0x5e1c3d);const _0x2e8cad=_0x1df08c[_0x4accdc(0x1ea)]['id'];console['log'](_0x2e8cad);const _0x3c4a65=await sales['findById'](_0x2e8cad);console['log']('user_id',_0x3c4a65);const _0x23db1b=await warehouse[_0x4accdc(0x2b6)]([{'$match':{'name':_0x4accdc(0x238),'room':_0x4accdc(0x1e7)}},{'$unwind':_0x4accdc(0x2d1)},{'$group':{'_id':_0x4accdc(0x22c),'name':{'$first':_0x4accdc(0x2c0)},'product_stock':{'$first':_0x4accdc(0x21b)},'level':{'$first':_0x4accdc(0x291)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4accdc(0x2ce)},'primary_code':{'$first':_0x4accdc(0x2d0)},'secondary_code':{'$first':_0x4accdc(0x1e4)},'product_code':{'$first':_0x4accdc(0x23e)}}}]);console[_0x4accdc(0x2aa)]('stock_data',_0x23db1b);const _0x5c7204=await product[_0x4accdc(0x202)]({});warehouse_data=await warehouse[_0x4accdc(0x2b6)]([{'$match':{'status':_0x4accdc(0x223),'name':_0x4accdc(0x238),'warehouse_category':_0x4accdc(0x2be)}},{'$group':{'_id':_0x4accdc(0x2bd),'name':{'$first':_0x4accdc(0x2bd)}}},{'$sort':{'name':0x1}}]);var _0x5807d0=[_0x4accdc(0x1e7)];if(_0x5e1c3d[0x0][_0x4accdc(0x233)]==_0x4accdc(0x279)){var _0x3d8ebd=users[_0x4accdc(0x25a)];console['log'](_0x3d8ebd);}else{if(_0x5e1c3d[0x0][_0x4accdc(0x233)]=='Hindi')var _0x3d8ebd=users[_0x4accdc(0x1d1)];else{if(_0x5e1c3d[0x0][_0x4accdc(0x233)]==_0x4accdc(0x2c1))var _0x3d8ebd=users['German'];else{if(_0x5e1c3d[0x0][_0x4accdc(0x233)]==_0x4accdc(0x2cf))var _0x3d8ebd=users['Spanish'];else{if(_0x5e1c3d[0x0][_0x4accdc(0x233)]==_0x4accdc(0x2b8))var _0x3d8ebd=users[_0x4accdc(0x2b8)];else{if(_0x5e1c3d[0x0][_0x4accdc(0x233)]==_0x4accdc(0x241))var _0x3d8ebd=users[_0x4accdc(0x295)];else{if(_0x5e1c3d[0x0]['language']=='Chinese')var _0x3d8ebd=users[_0x4accdc(0x2c6)];else{if(_0x5e1c3d[0x0]['language']==_0x4accdc(0x2df))var _0x3d8ebd=users[_0x4accdc(0x201)];}}}}}}}_0x5f5c3c[_0x4accdc(0x28c)]('return_sale',{'success':_0x1df08c[_0x4accdc(0x224)]('success'),'errors':_0x1df08c[_0x4accdc(0x224)](_0x4accdc(0x275)),'role':_0x275aa6,'profile':_0x29fa33,'user':_0x3c4a65,'stock':_0x23db1b,'master_shop':_0x5e1c3d,'unit':_0x5c7204,'language':_0x3d8ebd,'warehouses':warehouse_data,'rooms':_0x5807d0});}catch(_0xf1917){console[_0x4accdc(0x2aa)](_0xf1917),_0x5f5c3c[_0x4accdc(0x2c5)](0xc8)[_0x4accdc(0x226)]({'message':_0xf1917['message']});}}),router[a0_0x554414(0x252)](a0_0x554414(0x2dd),auth,async(_0x58337b,_0x33235d)=>{var _0xdb20e8=a0_0x554414;try{const {invoice:_0x72bc21,date:_0x175051,warehouse_name:_0x209fe0,product_name:_0x5b156c,primary_code:_0x38ed0f,secondary_code:_0x59ce30,product_code:_0x457d04,sales_quantity:_0x1c6660,stocks:_0x567b56,return_qty:_0x32e188,Room_name:_0x246a61,to_warehouse_name:_0x563c7c,to_Roomname:_0x3b7eff,to_Room_name:_0x144632,note:_0x168e33,level:_0x3c3f80,isle:_0x2a1d0b,pallet:_0x2d0791}=_0x58337b[_0xdb20e8(0x215)];if(typeof _0x5b156c==_0xdb20e8(0x292))var _0x3233e4=[_0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x200)]],_0x14a09d=[_0x58337b['body'][_0xdb20e8(0x2bc)]],_0x4934b6=[_0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x2a6)]],_0x56c327=[_0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x280)]],_0x319a6f=[_0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x24e)]],_0x2cd704=[_0x58337b[_0xdb20e8(0x215)]['stocks']],_0x7849ab=[_0x58337b[_0xdb20e8(0x215)]['return_qty']],_0x44fc77=[_0x58337b['body'][_0xdb20e8(0x2c7)]],_0x547f06=[_0x58337b['body'][_0xdb20e8(0x284)]],_0x9abaa6=[_0x58337b['body'][_0xdb20e8(0x2cb)]],_0xb3aa20=[_0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x296)]];else var _0x3233e4=[..._0x58337b['body']['product_name']],_0x14a09d=[..._0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x2bc)]],_0x4934b6=[..._0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x2a6)]],_0x56c327=[..._0x58337b['body'][_0xdb20e8(0x280)]],_0x319a6f=[..._0x58337b['body'][_0xdb20e8(0x24e)]],_0x2cd704=[..._0x58337b[_0xdb20e8(0x215)]['stocks']],_0x7849ab=[..._0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x271)]],_0x44fc77=[..._0x58337b[_0xdb20e8(0x215)]['bay']],_0x547f06=[..._0x58337b['body'][_0xdb20e8(0x284)]],_0x9abaa6=[..._0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x2cb)]],_0xb3aa20=[..._0x58337b[_0xdb20e8(0x215)]['floorlevel']];const _0x2b6090=_0x3233e4[_0xdb20e8(0x206)](_0x1d23c0=>{return _0x1d23c0={'product_name':_0x1d23c0};});_0x14a09d[_0xdb20e8(0x211)]((_0x3a271d,_0x372706)=>{var _0x2c1cf2=_0xdb20e8;_0x2b6090[_0x372706][_0x2c1cf2(0x2bc)]=_0x3a271d;}),_0x4934b6[_0xdb20e8(0x211)]((_0x2e18ef,_0x1b2d55)=>{var _0x1d7f08=_0xdb20e8;_0x2b6090[_0x1b2d55][_0x1d7f08(0x2a6)]=_0x2e18ef;}),_0x56c327[_0xdb20e8(0x211)]((_0x17397f,_0x5e1052)=>{_0x2b6090[_0x5e1052]['product_code']=_0x17397f;}),_0x319a6f['forEach']((_0x43ca2a,_0x3e9317)=>{var _0x42e481=_0xdb20e8;_0x2b6090[_0x3e9317][_0x42e481(0x272)]=_0x43ca2a;}),_0x2cd704['forEach']((_0x1719a7,_0x38b0b0)=>{_0x2b6090[_0x38b0b0]['stock']=_0x1719a7;}),_0x7849ab[_0xdb20e8(0x211)]((_0x74e8a8,_0x4475f5)=>{var _0x3e423b=_0xdb20e8;_0x2b6090[_0x4475f5][_0x3e423b(0x271)]=_0x74e8a8;}),_0x44fc77[_0xdb20e8(0x211)]((_0x13e3c3,_0x1ee404)=>{var _0x175a99=_0xdb20e8;_0x2b6090[_0x1ee404][_0x175a99(0x2c7)]=_0x13e3c3;}),_0x547f06[_0xdb20e8(0x211)]((_0x450ba5,_0x210f73)=>{_0x2b6090[_0x210f73]['bin']=_0x450ba5;}),_0x9abaa6[_0xdb20e8(0x211)]((_0x34378b,_0x1035de)=>{_0x2b6090[_0x1035de]['type']=_0x34378b;}),_0xb3aa20[_0xdb20e8(0x211)]((_0x1b5f1d,_0x360d64)=>{_0x2b6090[_0x360d64]['floorlevel']=_0x1b5f1d;});var _0x55343d=0x0;_0x2b6090[_0xdb20e8(0x211)](_0x590759=>{var _0x4c50d4=_0xdb20e8;console[_0x4c50d4(0x2aa)](_0x4c50d4(0x20e),_0x590759),(parseInt(_0x590759[_0x4c50d4(0x272)])<parseInt(_0x590759[_0x4c50d4(0x271)])||parseInt(_0x590759[_0x4c50d4(0x2d8)])<parseInt(_0x590759[_0x4c50d4(0x271)])&&parseInt(_0x590759[_0x4c50d4(0x272)])>parseInt(_0x590759[_0x4c50d4(0x271)])||parseInt(_0x590759['return_qty'])==0x0)&&_0x55343d++;});if(_0x55343d!=0x0)return _0x58337b[_0xdb20e8(0x224)]('errors',_0xdb20e8(0x2ba)),_0x33235d[_0xdb20e8(0x2a2)]('back');const _0x3bffbc=await sales[_0xdb20e8(0x2c2)]({'invoice':_0x72bc21});console['log'](_0x3bffbc),_0x3bffbc[_0xdb20e8(0x29f)]=_0xdb20e8(0x256);const _0x2b9031=await _0x3bffbc['save'](),_0x35542d=new sales_return({'invoice':_0x72bc21,'customer':_0x58337b['body'][_0xdb20e8(0x25b)],'date':_0x175051,'warehouse_name':_0x209fe0,'room':_0x246a61,'ToWarehouse':_0x563c7c,'ToRoom':_0x144632,'return_sale':_0x2b6090,'note':_0x168e33}),_0x1a22a7=await _0x35542d[_0xdb20e8(0x23d)]();console[_0xdb20e8(0x2aa)](_0x35542d);const _0x5256ba=await sales_return[_0xdb20e8(0x2c2)]({'invoice':_0x72bc21}),_0x9aff8a=await warehouse[_0xdb20e8(0x2c2)]({'name':_0x563c7c,'room':_0x144632});_0x5256ba[_0xdb20e8(0x29e)][_0xdb20e8(0x211)](_0x18baec=>{var _0x542940=_0xdb20e8,_0x146402=0x0;const _0x938e08=_0x9aff8a[_0x542940(0x24a)][_0x542940(0x206)](_0x17192b=>{var _0x5cd2fd=_0x542940;_0x17192b['product_name']==_0x18baec[_0x5cd2fd(0x200)]&&_0x17192b[_0x5cd2fd(0x296)]==_0x18baec[_0x5cd2fd(0x296)]&&_0x17192b['type']==_0x18baec[_0x5cd2fd(0x2c4)]&&_0x17192b['bin']==_0x18baec[_0x5cd2fd(0x284)]&&_0x17192b[_0x5cd2fd(0x2c7)]==_0x18baec['bay']&&(_0x17192b[_0x5cd2fd(0x1eb)]=parseInt(_0x17192b[_0x5cd2fd(0x1eb)])+parseInt(_0x18baec[_0x5cd2fd(0x271)]),_0x146402++);});_0x146402=='0'&&(_0x9aff8a[_0x542940(0x24a)]=_0x9aff8a[_0x542940(0x24a)]['concat']({'product_name':_0x18baec[_0x542940(0x200)],'product_stock':_0x18baec['return_qty'],'primary_code':_0x18baec[_0x542940(0x2bc)],'secondary_code':_0x18baec[_0x542940(0x2a6)],'product_code':_0x18baec[_0x542940(0x280)],'bay':_0x18baec[_0x542940(0x2c7)],'bin':_0x18baec['bin'],'type':_0x18baec[_0x542940(0x2c4)],'floorlevel':_0x18baec[_0x542940(0x296)]})),console[_0x542940(0x2aa)](_0x542940(0x28b),_0x9aff8a);}),await _0x9aff8a[_0xdb20e8(0x23d)](),console[_0xdb20e8(0x2aa)](_0x58337b[_0xdb20e8(0x215)]);const _0xbd8189=new c_payment_data({'invoice':_0x72bc21,'customer':_0x58337b[_0xdb20e8(0x215)]['customer'],'reason':'Sale\x20Return'});await _0xbd8189[_0xdb20e8(0x23d)]();const _0xfe55b1=await master_shop[_0xdb20e8(0x202)]();console[_0xdb20e8(0x2aa)](_0xdb20e8(0x227),_0xfe55b1[0x0][_0xdb20e8(0x24c)]);const _0x494667=await email_settings[_0xdb20e8(0x2c2)](),_0xe9cba0=await customer[_0xdb20e8(0x2c2)]({'name':_0x58337b[_0xdb20e8(0x215)][_0xdb20e8(0x25b)]});console[_0xdb20e8(0x2aa)](_0xdb20e8(0x249),_0xe9cba0);_0xfe55b1[0x0][_0xdb20e8(0x209)]==0x1?(right_currency=_0xfe55b1[0x0][_0xdb20e8(0x235)],left_currency=''):(right_currency='',left_currency=_0xfe55b1[0x0]['currency']);var _0x58879e=_0x3233e4,_0x59d4bd=_0x7849ab,_0x1fd29e='',_0x3bfcb7;for(_0x3bfcb7 in _0x58879e){_0x1fd29e+=_0xdb20e8(0x1fe)+_0xdb20e8(0x278)+_0x58879e[_0x3bfcb7]+_0xdb20e8(0x1f6)+_0xdb20e8(0x278)+_0x59d4bd[_0x3bfcb7]+_0xdb20e8(0x1f6)+'</tr>';}console[_0xdb20e8(0x2aa)](_0xdb20e8(0x1ff),_0x1fd29e);let _0x593dc4=nodemailer[_0xdb20e8(0x1f4)]({'service':_0xdb20e8(0x26d),'auth':{'user':_0x494667[_0xdb20e8(0x1e2)],'pass':_0x494667['password']}}),_0x1a0b34={'from':_0x494667[_0xdb20e8(0x1e2)],'to':_0xe9cba0[_0xdb20e8(0x1e2)],'subject':_0xdb20e8(0x2ca),'attachments':[{'filename':_0xdb20e8(0x1d7),'path':__dirname+'/../public'+_0xdb20e8(0x1f8)+_0xfe55b1[0x0][_0xdb20e8(0x24c)],'cid':'logo'}],'html':_0xdb20e8(0x2c3)+_0xdb20e8(0x297)+'</head><body>'+_0xdb20e8(0x2bf)+_0xdb20e8(0x2d9)+_0xdb20e8(0x2bf)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xdb20e8(0x2da)+_0xdb20e8(0x2bf)+_0xdb20e8(0x21e)+_0xfe55b1[0x0]['site_title']+'\x20</h2>'+'</div>'+_0xdb20e8(0x2da)+'<hr\x20class=\x22my-3\x22>'+_0xdb20e8(0x2bf)+_0xdb20e8(0x1f3)+_0xdb20e8(0x27d)+_0x72bc21+'\x20'+_0xdb20e8(0x1e6)+'\x20Order\x20Date\x20:\x20'+_0x175051+'\x20'+_0xdb20e8(0x21f)+_0xdb20e8(0x2d7)+_0xdb20e8(0x2da)+_0xdb20e8(0x282)+_0xdb20e8(0x276)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xdb20e8(0x1ef)+_0xdb20e8(0x2af)+_0xdb20e8(0x208)+_0xdb20e8(0x2ad)+_0xdb20e8(0x257)+_0xdb20e8(0x1ed)+'\x20'+_0x1fd29e+'\x20'+_0xdb20e8(0x2c9)+'</table>'+_0xdb20e8(0x2bf)+_0xdb20e8(0x212)+'<h5>'+_0xfe55b1[0x0]['site_title']+_0xdb20e8(0x2d7)+_0xdb20e8(0x2da)+'</div>'+_0xdb20e8(0x1da)};_0x593dc4[_0xdb20e8(0x273)](_0x1a0b34,function(_0x1d2a0c,_0x5cf121){var _0x3b2dc6=_0xdb20e8;_0x1d2a0c?(console[_0x3b2dc6(0x2aa)](_0x1d2a0c),console[_0x3b2dc6(0x2aa)]('Error\x20Occurs')):console['log'](_0x3b2dc6(0x281));}),_0x58337b[_0xdb20e8(0x224)](_0xdb20e8(0x29a),_0xdb20e8(0x294)),_0x33235d[_0xdb20e8(0x2a2)](_0xdb20e8(0x2b3));}catch(_0x453a26){console[_0xdb20e8(0x2aa)](_0x453a26),_0x33235d[_0xdb20e8(0x2c5)](0xc8)[_0xdb20e8(0x226)]({'message1':_0x453a26[_0xdb20e8(0x2a3)]});}}),router[a0_0x554414(0x242)](a0_0x554414(0x248),auth,async(_0xc21df0,_0x4888ce)=>{var _0x3397b0=a0_0x554414;try{const {username:_0x5c86e8,email:_0x30405f,role:_0x6773e3}=_0xc21df0['user'],_0x1661dc=_0xc21df0[_0x3397b0(0x1de)],_0x22a0a8=await profile[_0x3397b0(0x2c2)]({'email':_0x1661dc[_0x3397b0(0x1e2)]}),_0x4ec94c=await master_shop[_0x3397b0(0x202)]();console[_0x3397b0(0x2aa)](_0x3397b0(0x1ee),_0x4ec94c);const _0x4db031=_0xc21df0[_0x3397b0(0x1ea)]['id'],_0x1945ab=await sales[_0x3397b0(0x26c)](_0x4db031);console[_0x3397b0(0x2aa)]('barcode\x20user_id',_0x1945ab);if(_0x4ec94c[0x0]['language']==_0x3397b0(0x279))var _0x3436d9=users['English'];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]==_0x3397b0(0x1d1))var _0x3436d9=users[_0x3397b0(0x1d1)];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]==_0x3397b0(0x2c1))var _0x3436d9=users['German'];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]==_0x3397b0(0x2cf))var _0x3436d9=users[_0x3397b0(0x2cf)];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]==_0x3397b0(0x2b8))var _0x3436d9=users[_0x3397b0(0x2b8)];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]=='Portuguese\x20(BR)')var _0x3436d9=users['Portuguese'];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]==_0x3397b0(0x2c6))var _0x3436d9=users[_0x3397b0(0x2c6)];else{if(_0x4ec94c[0x0][_0x3397b0(0x233)]==_0x3397b0(0x2df))var _0x3436d9=users[_0x3397b0(0x201)];}}}}}}}_0x4888ce['render']('all_sales_barcode',{'success':_0xc21df0['flash'](_0x3397b0(0x29a)),'errors':_0xc21df0['flash'](_0x3397b0(0x275)),'role':_0x1661dc,'profile':_0x22a0a8,'alldata':_0x1945ab,'master_shop':_0x4ec94c,'language':_0x3436d9});}catch(_0x39a7c0){console[_0x3397b0(0x2aa)](_0x39a7c0);}}),router['post'](a0_0x554414(0x2d4),async(_0x57bba8,_0x1f79e4)=>{var _0x12971d=a0_0x554414;const {product_code:_0x3118cb,warehouse_name:_0x2de060,rooms_data:_0x9fb6a9,Roomslist:_0x51c15b}=_0x57bba8[_0x12971d(0x215)],_0x5d60c9=_0x51c15b[_0x12971d(0x298)](','),_0x519aad=[];async function _0x58a6c7(_0x2475d3){var _0x1386ee=_0x12971d;const _0xf1ca33=await warehouse[_0x1386ee(0x2b6)]([{'$match':{'name':_0x2de060,'room':_0x2475d3}},{'$unwind':_0x1386ee(0x2d1)},{'$match':{'product_details.primary_code':_0x3118cb}},{'$group':{'_id':_0x1386ee(0x22c),'name':{'$first':_0x1386ee(0x2c0)},'product_stock':{'$first':_0x1386ee(0x21b)},'primary_code':{'$first':_0x1386ee(0x2d0)},'secondary_code':{'$first':_0x1386ee(0x1e4)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1386ee(0x2b9)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1386ee(0x225)},'unit':{'$first':_0x1386ee(0x1d3)},'secondary_unit':{'$first':_0x1386ee(0x2a9)},'storage':{'$first':_0x1386ee(0x232)},'rack':{'$first':_0x1386ee(0x253)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x1386ee(0x2db)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1386ee(0x218)},'invoice':{'$first':_0x1386ee(0x236)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x1386ee(0x2bb)}}}]),_0x2228b7=await warehouse[_0x1386ee(0x2b6)]([{'$match':{'name':_0x2de060,'room':_0x2475d3}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3118cb}},{'$group':{'_id':_0x1386ee(0x22c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1386ee(0x2d0)},'secondary_code':{'$first':_0x1386ee(0x1e4)},'product_code':{'$first':_0x1386ee(0x23e)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1386ee(0x23b)},'pallet':{'$first':_0x1386ee(0x225)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1386ee(0x2a9)},'storage':{'$first':_0x1386ee(0x232)},'rack':{'$first':_0x1386ee(0x253)},'expiry_date':{'$first':_0x1386ee(0x255)},'production_date':{'$first':_0x1386ee(0x228)},'maxPerUnit':{'$first':_0x1386ee(0x2db)},'batch_code':{'$first':_0x1386ee(0x1e9)},'product_cat':{'$first':_0x1386ee(0x23c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1386ee(0x218)},'invoice':{'$first':_0x1386ee(0x236)}}}]);if(_0xf1ca33['length']>0x0)_0x519aad[_0x1386ee(0x1fc)](_0xf1ca33);else _0x2228b7[_0x1386ee(0x2d2)]>0x0&&_0x519aad[_0x1386ee(0x1fc)](_0x2228b7);}const _0x40def8=_0x5d60c9['map'](_0x36f9a0=>_0x58a6c7(_0x36f9a0));await Promise[_0x12971d(0x1d4)](_0x40def8),_0x1f79e4['json'](_0x519aad);}),module[a0_0x554414(0x1f7)]=router;