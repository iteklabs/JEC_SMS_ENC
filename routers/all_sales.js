var a0_0x151a2f=a0_0x2c41;(function(_0x5e8564,_0x57ae91){var _0x43bfcb=a0_0x2c41,_0x5a63e4=_0x5e8564();while(!![]){try{var _0x8ab08a=parseInt(_0x43bfcb(0x1e8))/0x1+-parseInt(_0x43bfcb(0x1f4))/0x2+-parseInt(_0x43bfcb(0x1e2))/0x3*(parseInt(_0x43bfcb(0x1af))/0x4)+-parseInt(_0x43bfcb(0x1d5))/0x5*(parseInt(_0x43bfcb(0x17f))/0x6)+parseInt(_0x43bfcb(0x225))/0x7*(-parseInt(_0x43bfcb(0x277))/0x8)+parseInt(_0x43bfcb(0x1b8))/0x9+parseInt(_0x43bfcb(0x1b3))/0xa*(-parseInt(_0x43bfcb(0x1c2))/0xb);if(_0x8ab08a===_0x57ae91)break;else _0x5a63e4['push'](_0x5a63e4['shift']());}catch(_0x2da52b){_0x5a63e4['push'](_0x5a63e4['shift']());}}}(a0_0x33d4,0x7639c));function a0_0x2c41(_0x380d1b,_0x3e29a9){var _0x33d4f8=a0_0x33d4();return a0_0x2c41=function(_0x2c4199,_0x370e83){_0x2c4199=_0x2c4199-0x177;var _0x17da50=_0x33d4f8[_0x2c4199];return _0x17da50;},a0_0x2c41(_0x380d1b,_0x3e29a9);}const express=require('express'),app=express(),router=express[a0_0x151a2f(0x19d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x151a2f(0x1ea)),nodemailer=require('nodemailer'),users=require(a0_0x151a2f(0x1c5));router[a0_0x151a2f(0x1fa)]('/view',auth,async(_0x22a800,_0x202268)=>{var _0x1baced=a0_0x151a2f;try{const {username:_0x52de98,email:_0xdd52f5,role:_0x3e1a5e}=_0x22a800[_0x1baced(0x23a)],_0x3b22fb=_0x22a800[_0x1baced(0x23a)],_0x1414bb=await profile[_0x1baced(0x191)]({'email':_0x3b22fb[_0x1baced(0x244)]}),_0x511137=await master_shop['find']();let _0x2e87ca;if(_0x3b22fb['role']=='staff'){const _0x102314=await staff[_0x1baced(0x191)]({'email':_0x3b22fb[_0x1baced(0x244)]});_0x2e87ca=await sales[_0x1baced(0x224)]([{'$lookup':{'from':_0x1baced(0x1cf),'localField':_0x1baced(0x1d9),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x1baced(0x266)},{'$unwind':_0x1baced(0x251)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1baced(0x1ac)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1baced(0x22d)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1baced(0x265)},'return_data':{'$first':_0x1baced(0x254)},'customers_docs':{'$first':_0x1baced(0x266)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x1baced(0x1a0)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x1baced(0x1d6)},'pallet':{'$addToSet':_0x1baced(0x18d)},'finalize':{'$first':_0x1baced(0x1d8)},'isAllowEdit':{'$first':_0x1baced(0x222)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2e87ca=await sales['aggregate']([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x1baced(0x27e),'as':_0x1baced(0x23f)}},{'$unwind':'$customers_docs'},{'$unwind':_0x1baced(0x251)},{'$group':{'_id':_0x1baced(0x259),'invoice':{'$first':_0x1baced(0x1ac)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1baced(0x22d)},'sale_product':{'$push':_0x1baced(0x251)},'note':{'$first':_0x1baced(0x265)},'return_data':{'$first':_0x1baced(0x254)},'customers_docs':{'$first':_0x1baced(0x266)},'total_saleproduct_quantity':{'$sum':_0x1baced(0x1a8)},'level':{'$addToSet':_0x1baced(0x1a0)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x1baced(0x1d6)},'pallet':{'$addToSet':_0x1baced(0x18d)},'finalize':{'$first':_0x1baced(0x1d8)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x1baced(0x177),_0x2e87ca);if(_0x511137[0x0][_0x1baced(0x272)]=='English\x20(US)'){var _0x8e4feb=users[_0x1baced(0x26c)];console[_0x1baced(0x1ff)](_0x8e4feb);}else{if(_0x511137[0x0][_0x1baced(0x272)]==_0x1baced(0x17b))var _0x8e4feb=users['Hindi'];else{if(_0x511137[0x0]['language']=='German')var _0x8e4feb=users[_0x1baced(0x178)];else{if(_0x511137[0x0][_0x1baced(0x272)]==_0x1baced(0x237))var _0x8e4feb=users[_0x1baced(0x237)];else{if(_0x511137[0x0][_0x1baced(0x272)]==_0x1baced(0x18c))var _0x8e4feb=users[_0x1baced(0x18c)];else{if(_0x511137[0x0][_0x1baced(0x272)]==_0x1baced(0x1b2))var _0x8e4feb=users['Portuguese'];else{if(_0x511137[0x0][_0x1baced(0x272)]==_0x1baced(0x21f))var _0x8e4feb=users[_0x1baced(0x21f)];else{if(_0x511137[0x0][_0x1baced(0x272)]==_0x1baced(0x27a))var _0x8e4feb=users['Arabic'];}}}}}}}_0x202268[_0x1baced(0x27b)](_0x1baced(0x24a),{'success':_0x22a800[_0x1baced(0x241)](_0x1baced(0x1e5)),'errors':_0x22a800['flash']('errors'),'sales':_0x2e87ca,'profile':_0x1414bb,'role':_0x3b22fb,'master_shop':_0x511137,'language':_0x8e4feb});}catch(_0x1a81a7){console[_0x1baced(0x1ff)](_0x1a81a7);}});function a0_0x33d4(){var _0x2b5fe3=['storage','sales_quantity','French','$sale_product.floorlevel','</tr>','<h5\x20style=\x22text-align:\x20left;\x22>','currency_placement','findOne','back','Enclosed','received_amount','<tr>','$product_details.secondary_code','type','batch_code','$product_details.product_name','$product_details.production_date','warehouse_name','Enabled','Router','sales\x20item\x20return\x20successfull','$product_details.invoice','$sale_product.bay','</body></html>','foreach\x20newproduct','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Error\x20Occurs','</span>','/view/add_sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$sale_product.quantity','$product_details._id','expiry_date','English\x20(US)','$invoice','<strong>\x20Regards\x20</strong>','<!DOCTYPE\x20html>','56oqYQfT','/view/return_sales/:id','master','Portuguese\x20(BR)','20sAwvOl','$product_details.pallet','secondary_unit','OUT-','then','2651355UBURTz','findById','Ambient','params','_id','return_sale','Level','padStart','$product_details.level','prod_cat','120021bIinKn','Return\x20Rooms','Raw\x20Materials','../public/language/languages.json','product','exports','$product_details.type','port','product_stock','\x20</h2>','image','staff','</tbody>','customers','$product_details.bay','$product_details.maxPerUnit','product_data','purchases_data','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','45WOsXee','$sale_product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$finalize','customer','max','push','$product_details','max_per_unit','date','save','post','password','4113lMjmgD','There\x27s\x20a\x20error\x20in\x20this\x20transaction','concat','success','status','currency','639294FrTfgA','$room','../middleware/auth','split','Email\x20sent\x20successfully','site_title','stock','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','room_name','$product_details.product_code','floor','/view/:id','205706jtfeVS','requested_qty','</head><body>','RoomAssigned','stocks','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','$product_details.bin','$product_details.secondary_unit','primary_unit','</td>','log','delivery_date','catch','prod_invoice','product_code','length','carton','quantity','final','False','errors','<tbody\x20style=\x22text-align:\x20center;\x22>','invoice','$product_details.floorlevel','delivery_code','SCRN','add\x20post','Receiving\x20Area','Arabic','Sales\x20Add\x20successfully','user_id','find','secondary_code','actual_qty','slice','/give_payment/:id','Floor','$product_details.storage','types','forEach','getFullYear','all_sales_barcode','Chinese','error','return_qty','$isAllowEdit','role','aggregate','7cIYfVy','body','barcode\x20user_id','$product_details.expiry_date','Sale\x20Return\x20Mail','RMSEmail','sale_product','Return\x20Goods','$warehouse_name','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','createTransport','room','id_transact','product_details','return_data','maxperunit','primary_code','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','stock_data','user','\x20Order\x20Date\x20:\x20','</div>','product_list','Shelves','customers_docs','customer_data','flash','getDate','</table>','email','floorlevel','unit','$product_details.batch_code','bin','add_sales','all_sales','</h5>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','redirect','host','all','$sale_product','finalize','prod_code','$return_data','Sale\x20Return','filter','map','$product_details.product_stock','$_id','/barcode_scanner','$product_details.rack','string','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','warehouse','</thead>','$product_details.unit','sales_invoice','$note','$customers_docs','json','abs','product_name','sale_qty','/preview/:id','English','/../public','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.product_cat','payment\x20successfull','language','actual_uom','barcode\x20Product\x20master','Portuguese','<div>','2192056mtIASd','<h2>\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Arabic\x20(ae)','render','$name','sendMail','name','/all_sales/view','sales\x20all_data','German','/upload/','Sales\x20Mail','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.primary_code','rack','21174yXIQjG','$product.product_name','bay','quantity_notConverted','<hr\x20class=\x22my-3\x22>','\x20Order\x20Number\x20:\x20','production_date','Logo.png','due_amount','logo','<html><head><title></title>'];a0_0x33d4=function(){return _0x2b5fe3;};return a0_0x33d4();}async function getRandom8DigitNumber(){var _0x56ed74=a0_0x151a2f;const _0x3722c4=0x989680,_0xd483cd=0x5f5e0ff,_0x1567bd=Math[_0x56ed74(0x1f2)](Math['random']()*(_0xd483cd-_0x3722c4+0x1))+_0x3722c4;var _0x42b2fb;const _0x35bbe9=await sales[_0x56ed74(0x191)]({'invoice':_0x56ed74(0x1b6)+_0x1567bd});return _0x35bbe9&&_0x35bbe9[_0x56ed74(0x204)]>0x0?_0x42b2fb=_0x56ed74(0x1b6)+_0x1567bd:_0x42b2fb=_0x56ed74(0x1b6)+_0x1567bd,_0x42b2fb;}router['get'](a0_0x151a2f(0x1a6),auth,async(_0x3319a9,_0x54ef72)=>{var _0x245fad=a0_0x151a2f;try{const {username:_0x49555e,email:_0x897e2a,role:_0x3030f4}=_0x3319a9[_0x245fad(0x23a)],_0x12b721=_0x3319a9['user'],_0x121806=await profile[_0x245fad(0x191)]({'email':_0x12b721[_0x245fad(0x244)]}),_0x59f13d=await master_shop[_0x245fad(0x214)](),_0x1def93=await customer[_0x245fad(0x214)]({});let _0xb9ea9a;if(_0x12b721[_0x245fad(0x223)]==_0x245fad(0x1cd)){const _0x27440d=await staff[_0x245fad(0x191)]({'email':_0x12b721[_0x245fad(0x244)]});_0xb9ea9a=await warehouse[_0x245fad(0x224)]([{'$match':{'status':_0x245fad(0x19c),'name':_0x27440d['warehouse'],'warehouse_category':_0x245fad(0x1c4),'name':{'$ne':_0x245fad(0x22c)}}},{'$group':{'_id':'$name','name':{'$first':_0x245fad(0x27c)}}},{'$sort':{'name':0x1}}]);}else _0xb9ea9a=await warehouse[_0x245fad(0x224)]([{'$match':{'status':'Enabled','warehouse_category':_0x245fad(0x1c4),'name':{'$ne':_0x245fad(0x22c)}}},{'$group':{'_id':_0x245fad(0x27c),'name':{'$first':_0x245fad(0x27c)}}},{'$sort':{'name':0x1}}]);const _0x4a30dd=await product[_0x245fad(0x214)]({});var _0x52f7b6=[_0x245fad(0x1ba),_0x245fad(0x193)];const _0x5c2142=await sales[_0x245fad(0x214)]({}),_0x481fe1=_0x5c2142[_0x245fad(0x204)]+0x1,_0x2446cc='OUT-'+_0x481fe1['toString']()[_0x245fad(0x1bf)](0x5,'0');if(_0x59f13d[0x0][_0x245fad(0x272)]==_0x245fad(0x1ab)){var _0x4c1320=users[_0x245fad(0x26c)];console[_0x245fad(0x1ff)](_0x4c1320);}else{if(_0x59f13d[0x0]['language']==_0x245fad(0x17b))var _0x4c1320=users['Hindi'];else{if(_0x59f13d[0x0]['language']==_0x245fad(0x178))var _0x4c1320=users[_0x245fad(0x178)];else{if(_0x59f13d[0x0][_0x245fad(0x272)]==_0x245fad(0x237))var _0x4c1320=users[_0x245fad(0x237)];else{if(_0x59f13d[0x0]['language']=='French')var _0x4c1320=users[_0x245fad(0x18c)];else{if(_0x59f13d[0x0][_0x245fad(0x272)]==_0x245fad(0x1b2))var _0x4c1320=users[_0x245fad(0x275)];else{if(_0x59f13d[0x0][_0x245fad(0x272)]==_0x245fad(0x21f))var _0x4c1320=users['Chinese'];else{if(_0x59f13d[0x0][_0x245fad(0x272)]==_0x245fad(0x27a))var _0x4c1320=users['Arabic'];}}}}}}}const _0x565709=getRandom8DigitNumber();_0x565709[_0x245fad(0x1b7)](_0x3af863=>{var _0xd6dc9b=_0x245fad;_0x54ef72[_0xd6dc9b(0x27b)](_0xd6dc9b(0x249),{'success':_0x3319a9['flash']('success'),'errors':_0x3319a9[_0xd6dc9b(0x241)](_0xd6dc9b(0x209)),'role':_0x12b721,'profile':_0x121806,'customer':_0x1def93,'warehouse':_0xb9ea9a,'product':_0x4a30dd,'invoice':_0x3af863,'master_shop':_0x59f13d,'language':_0x4c1320,'rooms_data':_0x52f7b6});})[_0x245fad(0x201)](_0x47d774=>{var _0x5bd1bd=_0x245fad;_0x3319a9[_0x5bd1bd(0x241)](_0x5bd1bd(0x209),_0x5bd1bd(0x1e3)),_0x54ef72[_0x5bd1bd(0x24e)](_0x5bd1bd(0x27f));});}catch(_0x165c7b){console['log'](_0x165c7b);}}),router[a0_0x151a2f(0x1fa)]('/view/add_sales/:id',auth,async(_0x3476a7,_0x1487fd)=>{var _0x567504=a0_0x151a2f;try{const _0x14d8af=_0x3476a7[_0x567504(0x1bb)]['id'];console['log'](_0x14d8af);const _0x21e0a3=await product['find'](),_0x35cd25=await purchases['aggregate']([{'$match':{'warehouse_name':_0x14d8af}},{'$unwind':'$product'},{'$group':{'_id':_0x567504(0x180)}}]);console[_0x567504(0x1ff)](_0x567504(0x1d3),_0x35cd25),_0x1487fd[_0x567504(0x1e6)](0xc8)[_0x567504(0x267)]({'purchases_data':_0x35cd25,'product_data':_0x21e0a3});}catch(_0x92ffaf){console[_0x567504(0x1ff)](_0x92ffaf);}}),router['post']('/view/add_sale/product',auth,async(_0x82fc35,_0x5ebf48)=>{var _0x1b4e0b=a0_0x151a2f;try{const {warehouse_data:_0x238673,product_data:_0x464526}=_0x82fc35[_0x1b4e0b(0x226)];console[_0x1b4e0b(0x1ff)](_0x82fc35[_0x1b4e0b(0x226)][_0x1b4e0b(0x1d2)]);;const _0x4cf06d=await master_shop[_0x1b4e0b(0x214)]();console[_0x1b4e0b(0x1ff)](_0x1b4e0b(0x1b1),_0x4cf06d);const _0x487f23=await product[_0x1b4e0b(0x191)]({'name':_0x464526});console[_0x1b4e0b(0x1ff)](_0x1b4e0b(0x1c6),_0x487f23);const _0x50ed7c=await warehouse[_0x1b4e0b(0x224)]([{'$match':{'name':_0x238673}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x464526}},{'$group':{'_id':_0x1b4e0b(0x199),'product_stock':{'$first':_0x1b4e0b(0x258)}}}]);console[_0x1b4e0b(0x1ff)](_0x1b4e0b(0x239),_0x50ed7c),_0x5ebf48[_0x1b4e0b(0x1e6)](0xc8)[_0x1b4e0b(0x267)]({'master':_0x4cf06d,'new_product':_0x487f23,'stock_data':_0x50ed7c});}catch(_0x3e7da7){console[_0x1b4e0b(0x1ff)](_0x3e7da7);}}),router[a0_0x151a2f(0x1e0)]('/view/add_sales',auth,async(_0x4920aa,_0x16522b)=>{var _0x3961a0=a0_0x151a2f;try{const {invoice:_0x4732b2,date:_0xcf7513,warehouse_name:_0xc5f732,product_name:_0x2d7b9f,stock:_0x4e8de7,quantity:_0x3c7822,note:_0x2fb7bc,room:_0x336336,primary_code:_0x54fa0e,secondary_code:_0x2d8055,prod_code:_0x530ed2,level:_0xc31ff8,isle:_0x1fedc1,pallet:_0x4c68bc,batch_code:_0x5e8990,SCRN:_0x6d3906,expiry_date:_0x3494eb}=_0x4920aa[_0x3961a0(0x226)];if(typeof _0x2d7b9f==_0x3961a0(0x25c))var _0x138ea0=[_0x4920aa[_0x3961a0(0x226)]['product_name']],_0x145384=[_0x4920aa[_0x3961a0(0x226)]['stock']],_0x308f34=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x205)]],_0x21fc18=[_0x4920aa['body'][_0x3961a0(0x236)]],_0x48cb9e=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x215)]],_0x2dd9bb=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x253)]],_0x2f3c82=[_0x4920aa['body'][_0x3961a0(0x25f)]],_0xa02c9e=[_0x4920aa['body']['primary_unit']],_0x200bbb=[_0x4920aa[_0x3961a0(0x226)]['secondary_unit']],_0x305fd2=[_0x4920aa['body'][_0x3961a0(0x198)]],_0x4e3d3f=[_0x4920aa['body'][_0x3961a0(0x1aa)]],_0x159574=[_0x4920aa['body'][_0x3961a0(0x1dd)]],_0x54fe21=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x185)]],_0x31d316=[_0x4920aa['body'][_0x3961a0(0x1f5)]],_0x429168=[_0x4920aa[_0x3961a0(0x226)]['delivery_date']],_0x2646bf=[_0x4920aa['body'][_0x3961a0(0x20d)]],_0x1078a4=[_0x4920aa[_0x3961a0(0x226)]['prod_cat']],_0x303443=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x206)]],_0x34b709=[_0x4920aa[_0x3961a0(0x226)]['RoomAssigned']],_0x3307de=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x202)]],_0x2efc3c=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x216)]],_0x3a9bb6=[_0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x273)]],_0x1f466e=[_0x4920aa['body'][_0x3961a0(0x232)]];else var _0x138ea0=[..._0x4920aa[_0x3961a0(0x226)]['product_name']],_0x145384=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x1ee)]],_0x308f34=[..._0x4920aa['body'][_0x3961a0(0x205)]],_0x21fc18=[..._0x4920aa[_0x3961a0(0x226)]['primary_code']],_0x48cb9e=[..._0x4920aa['body'][_0x3961a0(0x215)]],_0x2dd9bb=[..._0x4920aa[_0x3961a0(0x226)]['prod_code']],_0x2f3c82=[..._0x4920aa['body'][_0x3961a0(0x25f)]],_0xa02c9e=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x1fd)]],_0x200bbb=[..._0x4920aa[_0x3961a0(0x226)]['secondary_unit']],_0x305fd2=[..._0x4920aa['body'][_0x3961a0(0x198)]],_0x4e3d3f=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x1aa)]],_0x159574=[..._0x4920aa[_0x3961a0(0x226)]['max_per_unit']],_0x54fe21=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x185)]],_0x31d316=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x1f5)]],_0x429168=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x200)]],_0x2646bf=[..._0x4920aa['body'][_0x3961a0(0x20d)]],_0x1078a4=[..._0x4920aa[_0x3961a0(0x226)]['prod_cat']],_0x303443=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x206)]],_0x34b709=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x1f7)]],_0x3307de=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x202)]],_0x2efc3c=[..._0x4920aa['body']['actual_qty']],_0x3a9bb6=[..._0x4920aa[_0x3961a0(0x226)]['actual_uom']],_0x1f466e=[..._0x4920aa[_0x3961a0(0x226)][_0x3961a0(0x232)]];const _0x5408c8=_0x138ea0[_0x3961a0(0x257)](_0x55b4a0=>{return _0x55b4a0={'product_name':_0x55b4a0};});_0x145384[_0x3961a0(0x21c)]((_0x5cccdb,_0x25404f)=>{var _0x4e0395=_0x3961a0;_0x5408c8[_0x25404f][_0x4e0395(0x1ee)]=Math[_0x4e0395(0x268)](_0x5cccdb);}),_0x2efc3c[_0x3961a0(0x21c)]((_0x575f8c,_0x3730ac)=>{var _0x154301=_0x3961a0;_0x5408c8[_0x3730ac][_0x154301(0x216)]=Math[_0x154301(0x268)](_0x575f8c);}),_0x3a9bb6[_0x3961a0(0x21c)]((_0x13d439,_0x2b484e)=>{var _0x58f18b=_0x3961a0;_0x5408c8[_0x2b484e][_0x58f18b(0x273)]=_0x13d439;}),_0x1f466e[_0x3961a0(0x21c)]((_0x1b7b9a,_0x3f7fd8)=>{_0x5408c8[_0x3f7fd8]['id_transaction_from']=_0x1b7b9a;}),_0x308f34[_0x3961a0(0x21c)]((_0x2c0e1e,_0x3f47e0)=>{var _0x121cfa=_0x3961a0;_0x5408c8[_0x3f47e0][_0x121cfa(0x206)]=_0x2c0e1e;}),_0x21fc18['forEach']((_0x38aa4d,_0x172174)=>{var _0xce1d17=_0x3961a0;_0x5408c8[_0x172174][_0xce1d17(0x236)]=_0x38aa4d;}),_0x48cb9e['forEach']((_0x211da6,_0x2acd6d)=>{var _0xe87817=_0x3961a0;_0x5408c8[_0x2acd6d][_0xe87817(0x215)]=_0x211da6;}),_0x2dd9bb[_0x3961a0(0x21c)]((_0x2edf12,_0x511c61)=>{var _0x26f069=_0x3961a0;_0x5408c8[_0x511c61][_0x26f069(0x203)]=_0x2edf12;}),_0x2f3c82[_0x3961a0(0x21c)]((_0x11f4de,_0x325c00)=>{var _0x4857b2=_0x3961a0;_0x34b709[_0x4857b2(0x21c)]((_0x1acba5,_0x286347)=>{var _0x5ab3a4=_0x4857b2;if(_0x1acba5=='Receiving\x20Area'&&_0x325c00==_0x286347){var _0x5f47ab=_0x11f4de['slice'](0x3);_0x5408c8[_0x325c00][_0x5ab3a4(0x18a)]=_0x11f4de[0x0],_0x5408c8[_0x325c00][_0x5ab3a4(0x17e)]=_0x11f4de[0x1],_0x5408c8[_0x325c00][_0x5ab3a4(0x181)]=0x0,_0x5408c8[_0x325c00][_0x5ab3a4(0x248)]=0x0,_0x5408c8[_0x325c00][_0x5ab3a4(0x197)]=_0x5ab3a4(0x219),_0x5408c8[_0x325c00][_0x5ab3a4(0x245)]=_0x5f47ab;}else{if(_0x1acba5==_0x5ab3a4(0x23e)&&_0x325c00==_0x286347){var _0x5f47ab=_0x11f4de[_0x5ab3a4(0x217)](0x3);_0x5408c8[_0x325c00][_0x5ab3a4(0x18a)]=_0x11f4de[0x0],_0x5408c8[_0x325c00][_0x5ab3a4(0x17e)]=_0x11f4de[0x1],_0x5408c8[_0x325c00][_0x5ab3a4(0x181)]=0x0,_0x5408c8[_0x325c00][_0x5ab3a4(0x248)]=0x0,_0x5408c8[_0x325c00][_0x5ab3a4(0x197)]=_0x5ab3a4(0x219),_0x5408c8[_0x325c00]['floorlevel']=_0x11f4de[0x5];}else{if(_0x325c00==_0x286347){var _0x5537c0;if(_0x11f4de[0x4]=='L')_0x5537c0='Level';else _0x11f4de[0x4]=='F'&&(_0x5537c0=_0x5ab3a4(0x219));_0x5408c8[_0x325c00][_0x5ab3a4(0x18a)]=_0x11f4de[0x0],_0x5408c8[_0x325c00]['rack']=_0x11f4de[0x1],_0x5408c8[_0x325c00][_0x5ab3a4(0x181)]=_0x11f4de[0x2],_0x5408c8[_0x325c00][_0x5ab3a4(0x248)]=_0x11f4de[0x3],_0x5408c8[_0x325c00][_0x5ab3a4(0x197)]=_0x5537c0,_0x5408c8[_0x325c00][_0x5ab3a4(0x245)]=_0x11f4de[0x5];}}}});}),_0xa02c9e[_0x3961a0(0x21c)]((_0x16ad9c,_0x447f53)=>{var _0x458046=_0x3961a0;_0x5408c8[_0x447f53][_0x458046(0x246)]=_0x16ad9c;}),_0x200bbb['forEach']((_0x3035b4,_0x3dcac0)=>{var _0xf794bb=_0x3961a0;_0x5408c8[_0x3dcac0][_0xf794bb(0x1b5)]=_0x3035b4;}),_0x305fd2[_0x3961a0(0x21c)]((_0x3763d1,_0x14da5b)=>{var _0x3950ac=_0x3961a0;_0x5408c8[_0x14da5b][_0x3950ac(0x198)]=_0x3763d1;}),_0x4e3d3f[_0x3961a0(0x21c)]((_0x45461a,_0x569411)=>{_0x5408c8[_0x569411]['expiry_date']=_0x45461a;}),_0x159574['forEach']((_0x268e54,_0x5e6f87)=>{_0x5408c8[_0x5e6f87]['maxperunit']=_0x268e54;}),_0x54fe21[_0x3961a0(0x21c)]((_0x2b2072,_0x5d64c6)=>{var _0x110910=_0x3961a0;_0x5408c8[_0x5d64c6][_0x110910(0x185)]=_0x2b2072;}),_0x31d316[_0x3961a0(0x21c)]((_0xe04bdd,_0x1100c7)=>{var _0x20deb7=_0x3961a0;_0x5408c8[_0x1100c7][_0x20deb7(0x1f5)]=_0xe04bdd;}),_0x429168['forEach']((_0x308752,_0x33c31a)=>{var _0x2a0b33=_0x3961a0;_0x5408c8[_0x33c31a][_0x2a0b33(0x200)]=_0x308752;}),_0x2646bf[_0x3961a0(0x21c)]((_0x292df9,_0x598a53)=>{var _0x4496e1=_0x3961a0;_0x5408c8[_0x598a53][_0x4496e1(0x20d)]=_0x292df9;}),_0x1078a4[_0x3961a0(0x21c)]((_0x26ae26,_0x1ea124)=>{_0x5408c8[_0x1ea124]['prod_cat']=_0x26ae26;}),_0x303443[_0x3961a0(0x21c)]((_0x435f46,_0x679b29)=>{var _0x3c9575=_0x3961a0;_0x5408c8[_0x679b29][_0x3c9575(0x182)]=_0x435f46;}),_0x34b709[_0x3961a0(0x21c)]((_0x1b2714,_0x54736f)=>{var _0x585006=_0x3961a0;_0x5408c8[_0x54736f][_0x585006(0x1f0)]=_0x1b2714;}),_0x3307de[_0x3961a0(0x21c)]((_0x58ecf3,_0x1906a5)=>{var _0x5167f9=_0x3961a0;_0x5408c8[_0x1906a5][_0x5167f9(0x20b)]=_0x58ecf3;});var _0x25b849=0x0;_0x5408c8[_0x3961a0(0x21c)](_0x5f456d=>{var _0x424e8b=_0x3961a0;(_0x5f456d[_0x424e8b(0x1ee)]<_0x5f456d[_0x424e8b(0x182)]||_0x5f456d[_0x424e8b(0x182)]==0x0)&&(console[_0x424e8b(0x1ff)](_0x424e8b(0x1a2),_0x5f456d),_0x25b849++);});const _0x18a1ae=_0x5408c8['filter'](_0x241330=>_0x241330[_0x3961a0(0x206)]!=='0'&&_0x241330[_0x3961a0(0x206)]!==''),_0x64e072=new sales({'invoice':_0x4732b2,'customer':_0x4920aa[_0x3961a0(0x226)]['customer'],'date':_0xcf7513,'warehouse_name':_0xc5f732,'sale_product':_0x18a1ae,'note':_0x2fb7bc,'room':_0x336336,'primary_code':_0x54fa0e,'secondary_code':_0x2d8055,'prod_code':_0x530ed2,'SCRN':_0x6d3906}),_0x472bf5=await _0x64e072[_0x3961a0(0x1df)]();_0x4920aa[_0x3961a0(0x241)](_0x3961a0(0x1e5),_0x3961a0(0x212)),_0x16522b[_0x3961a0(0x24e)]('/all_sales/preview/'+_0x472bf5['_id']);}catch(_0x2a491c){console[_0x3961a0(0x1ff)](_0x2a491c);}}),router[a0_0x151a2f(0x1fa)](a0_0x151a2f(0x26b),auth,async(_0x21f0f2,_0x2d2cc6)=>{var _0xfcde94=a0_0x151a2f;try{const {username:_0x150dbf,email:_0x5f1a9f,role:_0x5ea43c}=_0x21f0f2[_0xfcde94(0x23a)],_0x2cbd2a=_0x21f0f2['user'],_0x3938d9=await profile[_0xfcde94(0x191)]({'email':_0x2cbd2a['email']}),_0x49ea70=await master_shop['find'](),_0xc47698=_0x21f0f2[_0xfcde94(0x1bb)]['id'],_0xf6782d=await sales[_0xfcde94(0x1b9)](_0xc47698),_0x6c0712=await warehouse[_0xfcde94(0x224)]([{'$match':{'name':_0xf6782d[_0xfcde94(0x19b)]}},{'$unwind':_0xfcde94(0x1dc)},{'$group':{'_id':_0xfcde94(0x1a9),'name':{'$first':_0xfcde94(0x199)},'product_stock':{'$first':_0xfcde94(0x258)},'bay':{'$first':_0xfcde94(0x1d0)},'bin':{'$first':_0xfcde94(0x1fb)},'type':{'$first':_0xfcde94(0x1c8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xfcde94(0x17d)},'secondary_code':{'$first':_0xfcde94(0x196)},'product_code':{'$first':_0xfcde94(0x1f1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xfcde94(0x25b)},'expiry_date':{'$first':_0xfcde94(0x228)},'production_date':{'$first':_0xfcde94(0x19a)},'invoice':{'$first':_0xfcde94(0x19f)}}}]),_0x2aecbc=await customer['find']({});let _0x1206bc;if(_0x2cbd2a[_0xfcde94(0x223)]==_0xfcde94(0x1cd)){const _0x9e2c4a=await staff[_0xfcde94(0x191)]({'email':_0x2cbd2a[_0xfcde94(0x244)]});_0x1206bc=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x9e2c4a['warehouse']}},{'$group':{'_id':_0xfcde94(0x27c),'name':{'$first':_0xfcde94(0x27c)}}}]);}else _0x1206bc=await warehouse[_0xfcde94(0x224)]([{'$match':{'status':_0xfcde94(0x19c)}},{'$group':{'_id':_0xfcde94(0x27c),'name':{'$first':_0xfcde94(0x27c)}}}]);const _0x2d03a9=await product[_0xfcde94(0x214)]({}),_0x5021b4=await suppliers['find']({});if(_0x49ea70[0x0][_0xfcde94(0x272)]==_0xfcde94(0x1ab)){var _0x1cc2c3=users['English'];console[_0xfcde94(0x1ff)](_0x1cc2c3);}else{if(_0x49ea70[0x0][_0xfcde94(0x272)]==_0xfcde94(0x17b))var _0x1cc2c3=users['Hindi'];else{if(_0x49ea70[0x0][_0xfcde94(0x272)]==_0xfcde94(0x178))var _0x1cc2c3=users['German'];else{if(_0x49ea70[0x0][_0xfcde94(0x272)]==_0xfcde94(0x237))var _0x1cc2c3=users[_0xfcde94(0x237)];else{if(_0x49ea70[0x0][_0xfcde94(0x272)]==_0xfcde94(0x18c))var _0x1cc2c3=users['French'];else{if(_0x49ea70[0x0]['language']=='Portuguese\x20(BR)')var _0x1cc2c3=users[_0xfcde94(0x275)];else{if(_0x49ea70[0x0]['language']==_0xfcde94(0x21f))var _0x1cc2c3=users['Chinese'];else{if(_0x49ea70[0x0]['language']==_0xfcde94(0x27a))var _0x1cc2c3=users[_0xfcde94(0x211)];}}}}}}}_0x2d2cc6['render']('edit_sales_view',{'success':_0x21f0f2[_0xfcde94(0x241)]('success'),'errors':_0x21f0f2['flash'](_0xfcde94(0x209)),'role':_0x2cbd2a,'profile':_0x3938d9,'customer':_0x2aecbc,'warehouse':_0x1206bc,'product':_0x6c0712,'user':_0xf6782d,'master_shop':_0x49ea70,'unit':_0x2d03a9,'language':_0x1cc2c3,'suppliers':_0x5021b4});}catch(_0x2a2b63){console[_0xfcde94(0x1ff)](_0x2a2b63);}}),router[a0_0x151a2f(0x1e0)]('/preview/:id',auth,async(_0x912efa,_0x4690ca)=>{var _0x4f08e6=a0_0x151a2f;try{const _0x49d51e=_0x912efa['params']['id'],{invoice:_0xcbfa6c,warehouse_name:_0x3ffda4,room:_0xa8c1bf}=_0x912efa['body'],_0x50c4f7=await sales[_0x4f08e6(0x191)]({'invoice':_0xcbfa6c}),_0x376382=_0x50c4f7[_0x4f08e6(0x22b)][_0x4f08e6(0x257)](async _0x27f38d=>{var _0x57aa04=_0x4f08e6,_0x8a154b=await warehouse['findOne']({'name':_0x3ffda4,'room':_0x27f38d[_0x57aa04(0x1f0)],'warehouse_category':_0x57aa04(0x1c4)});const _0x311754=_0x8a154b[_0x57aa04(0x233)][_0x57aa04(0x257)](_0x53f299=>{var _0x560a97=_0x57aa04;_0x53f299[_0x560a97(0x269)]==_0x27f38d[_0x560a97(0x269)]&&_0x53f299[_0x560a97(0x245)]==_0x27f38d[_0x560a97(0x245)]&&_0x53f299[_0x560a97(0x197)]==_0x27f38d['type']&&_0x53f299[_0x560a97(0x248)]==_0x27f38d[_0x560a97(0x248)]&&_0x53f299['bay']==_0x27f38d['bay']&&_0x53f299[_0x560a97(0x17e)]==_0x27f38d[_0x560a97(0x17e)]&&_0x53f299['storage']==_0x27f38d['storage']&&_0x53f299['expiry_date']==_0x27f38d[_0x560a97(0x1aa)]&&_0x53f299[_0x560a97(0x198)]==_0x27f38d[_0x560a97(0x198)]&&_0x53f299[_0x560a97(0x20b)]==_0x27f38d[_0x560a97(0x20b)]&&_0x53f299[_0x560a97(0x1bc)]==_0x27f38d['id_transaction_from']&&(_0x53f299[_0x560a97(0x1ca)]=Math[_0x560a97(0x1da)](0x0,Math[_0x560a97(0x268)](_0x53f299[_0x560a97(0x1ca)])-Math['abs'](_0x27f38d['quantity'])));});return _0x8a154b;});Promise[_0x4f08e6(0x250)](_0x376382)['then'](async _0x377ff3=>{var _0x45f01e=_0x4f08e6;try{for(const _0x41ebe8 of _0x377ff3){await _0x41ebe8[_0x45f01e(0x1df)]();}_0x50c4f7[_0x45f01e(0x252)]='True';const _0x2d7e8b=await _0x50c4f7[_0x45f01e(0x1df)](),_0x59b265=await master_shop[_0x45f01e(0x214)](),_0x3bebc6=await email_settings[_0x45f01e(0x191)](),_0x4d25ed=await supervisor_settings[_0x45f01e(0x214)]();var _0x54d81a=_0x50c4f7[_0x45f01e(0x22b)],_0x1e7ab2='',_0x231278;for(_0x231278 in _0x54d81a){_0x1e7ab2+=_0x45f01e(0x195)+_0x45f01e(0x1f9)+_0x54d81a[_0x231278][_0x45f01e(0x269)]+_0x45f01e(0x1fe)+_0x45f01e(0x1f9)+_0x54d81a[_0x231278][_0x45f01e(0x203)]+_0x45f01e(0x1fe)+_0x45f01e(0x1f9)+_0x54d81a[_0x231278][_0x45f01e(0x206)]+_0x45f01e(0x1fe)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54d81a[_0x231278][_0x45f01e(0x246)]+_0x45f01e(0x1fe)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54d81a[_0x231278]['secondary_unit']+_0x45f01e(0x1fe)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50c4f7[_0x45f01e(0x19b)]+_0x45f01e(0x1fe)+_0x45f01e(0x1f9)+_0x54d81a[_0x231278][_0x45f01e(0x1f0)]+_0x45f01e(0x1fe)+_0x45f01e(0x1f9)+_0x54d81a[_0x231278]['storage']+_0x54d81a[_0x231278][_0x45f01e(0x17e)]+_0x54d81a[_0x231278][_0x45f01e(0x181)]+_0x54d81a[_0x231278][_0x45f01e(0x248)]+_0x54d81a[_0x231278][_0x45f01e(0x197)][0x0]+_0x54d81a[_0x231278][_0x45f01e(0x245)]+'</td>','</tr>';}let _0x2f0bf8=nodemailer[_0x45f01e(0x230)]({'host':_0x3bebc6[_0x45f01e(0x24f)],'port':Number(_0x3bebc6[_0x45f01e(0x1c9)]),'secure':![],'auth':{'user':_0x3bebc6['email'],'pass':_0x3bebc6['password']}}),_0x5527d6={'from':_0x3bebc6['email'],'to':_0x4d25ed[0x0][_0x45f01e(0x22a)],'subject':_0x45f01e(0x17a),'attachments':[{'filename':_0x45f01e(0x186),'path':__dirname+_0x45f01e(0x26d)+'/upload/'+_0x59b265[0x0]['image'],'cid':'logo'}],'html':_0x45f01e(0x1ae)+_0x45f01e(0x189)+_0x45f01e(0x1f6)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x45f01e(0x23c)+_0x45f01e(0x276)+_0x45f01e(0x278)+_0x59b265[0x0][_0x45f01e(0x1ed)]+_0x45f01e(0x1cb)+'</div>'+_0x45f01e(0x23c)+_0x45f01e(0x183)+'<div>'+_0x45f01e(0x18f)+'\x20Order\x20Number\x20:\x20'+_0x50c4f7[_0x45f01e(0x20b)]+'\x20'+_0x45f01e(0x22e)+_0x45f01e(0x23b)+_0x50c4f7[_0x45f01e(0x1de)]+'\x20'+_0x45f01e(0x1a5)+_0x45f01e(0x24b)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x45f01e(0x1ef)+_0x45f01e(0x195)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x45f01e(0x26f)+_0x45f01e(0x25e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x45f01e(0x22f)+_0x45f01e(0x260)+_0x45f01e(0x24d)+_0x45f01e(0x17c)+_0x45f01e(0x18e)+_0x45f01e(0x262)+_0x45f01e(0x20a)+'\x20'+_0x1e7ab2+'\x20'+'</tbody>'+_0x45f01e(0x243)+_0x45f01e(0x276)+_0x45f01e(0x1ad)+'<h5>'+_0x59b265[0x0][_0x45f01e(0x1ed)]+'</h5>'+_0x45f01e(0x23c)+_0x45f01e(0x23c)+_0x45f01e(0x1a1)};_0x2f0bf8[_0x45f01e(0x27d)](_0x5527d6,function(_0x15f0a3,_0x22d97a){var _0x233132=_0x45f01e;_0x15f0a3?(console['log'](_0x15f0a3),console[_0x233132(0x1ff)]('Error\x20Occurs')):console['log'](_0x233132(0x1ec));}),_0x912efa['flash'](_0x45f01e(0x1e5),_0x45f01e(0x26e)),_0x4690ca[_0x45f01e(0x24e)]('/all_sales/preview/'+_0x49d51e);}catch(_0x4d5ca7){console[_0x45f01e(0x220)](_0x4d5ca7),_0x4690ca[_0x45f01e(0x1e6)](0x1f4)[_0x45f01e(0x267)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x185327=>{var _0x368f9b=_0x4f08e6;console[_0x368f9b(0x220)](_0x185327),_0x4690ca['status'](0x1f4)[_0x368f9b(0x267)]({'error':'An\x20error\x20occurred.'});});}catch(_0x255933){console[_0x4f08e6(0x1ff)](_0x255933);}}),router['get'](a0_0x151a2f(0x1f3),auth,async(_0x3204cc,_0x526e3a)=>{var _0x365dc4=a0_0x151a2f;try{const {username:_0x874ecc,email:_0x2be4f4,role:_0x535ecb}=_0x3204cc[_0x365dc4(0x23a)],_0x477252=_0x3204cc[_0x365dc4(0x23a)],_0x19841b=await profile['findOne']({'email':_0x477252[_0x365dc4(0x244)]}),_0x2104a3=await master_shop[_0x365dc4(0x214)](),_0x188b4a=_0x3204cc[_0x365dc4(0x1bb)]['id'],_0x27b69f=await sales[_0x365dc4(0x1b9)](_0x188b4a);var _0x353185=['Ambient','Enclosed'];const _0x45f892=await warehouse[_0x365dc4(0x224)]([{'$match':{'name':_0x27b69f[_0x365dc4(0x19b)],'warehouse_category':_0x365dc4(0x1c4)}},{'$unwind':_0x365dc4(0x1dc)},{'$group':{'_id':_0x365dc4(0x1a9),'name':{'$first':_0x365dc4(0x199)},'product_stock':{'$first':_0x365dc4(0x258)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x365dc4(0x1fb)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x365dc4(0x20c)},'primary_code':{'$first':_0x365dc4(0x17d)},'secondary_code':{'$first':_0x365dc4(0x196)},'product_code':{'$first':_0x365dc4(0x1f1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x365dc4(0x25b)}}}]),_0x14e2ad=await customer['find']({});let _0x4d3854;if(_0x477252[_0x365dc4(0x223)]=='staff'){const _0x2c3512=await staff['findOne']({'email':_0x477252['email']});_0x4d3854=await warehouse[_0x365dc4(0x224)]([{'$match':{'status':_0x365dc4(0x19c),'name':_0x2c3512[_0x365dc4(0x261)],'warehouse_category':_0x365dc4(0x1c4)}},{'$group':{'_id':_0x365dc4(0x27c),'name':{'$first':_0x365dc4(0x27c)}}}]);}else _0x4d3854=await warehouse[_0x365dc4(0x224)]([{'$match':{'status':_0x365dc4(0x19c),'warehouse_category':_0x365dc4(0x1c4)}},{'$group':{'_id':_0x365dc4(0x27c),'name':{'$first':_0x365dc4(0x27c)}}}]);const _0x3e5b71=await product[_0x365dc4(0x214)]({});if(_0x2104a3[0x0]['language']=='English\x20(US)'){var _0x13658c=users[_0x365dc4(0x26c)];console['log'](_0x13658c);}else{if(_0x2104a3[0x0]['language']==_0x365dc4(0x17b))var _0x13658c=users[_0x365dc4(0x17b)];else{if(_0x2104a3[0x0][_0x365dc4(0x272)]=='German')var _0x13658c=users[_0x365dc4(0x178)];else{if(_0x2104a3[0x0][_0x365dc4(0x272)]==_0x365dc4(0x237))var _0x13658c=users['Spanish'];else{if(_0x2104a3[0x0][_0x365dc4(0x272)]==_0x365dc4(0x18c))var _0x13658c=users['French'];else{if(_0x2104a3[0x0][_0x365dc4(0x272)]==_0x365dc4(0x1b2))var _0x13658c=users['Portuguese'];else{if(_0x2104a3[0x0]['language']=='Chinese')var _0x13658c=users[_0x365dc4(0x21f)];else{if(_0x2104a3[0x0]['language']==_0x365dc4(0x27a))var _0x13658c=users['Arabic'];}}}}}}}_0x526e3a[_0x365dc4(0x27b)]('edit_sales',{'success':_0x3204cc[_0x365dc4(0x241)](_0x365dc4(0x1e5)),'errors':_0x3204cc[_0x365dc4(0x241)](_0x365dc4(0x209)),'role':_0x477252,'profile':_0x19841b,'customer':_0x14e2ad,'warehouse':_0x4d3854,'product':_0x45f892,'user':_0x27b69f,'master_shop':_0x2104a3,'unit':_0x3e5b71,'language':_0x13658c});}catch(_0x252aea){console[_0x365dc4(0x1ff)](_0x252aea);}}),router[a0_0x151a2f(0x1e0)](a0_0x151a2f(0x1f3),auth,async(_0x1d3b41,_0x58a08c)=>{var _0x5e455e=a0_0x151a2f;try{const _0x592e08=_0x1d3b41[_0x5e455e(0x1bb)]['id'],_0x1b535f=await sales[_0x5e455e(0x191)]({'_id':_0x1d3b41[_0x5e455e(0x1bb)]['id']}),_0x1cda0b=await warehouse[_0x5e455e(0x191)]({'name':_0x1b535f[_0x5e455e(0x19b)],'room':_0x1d3b41['body'][_0x5e455e(0x231)]}),{invoice:_0x2fab27,date:_0x94ac29,warehouse_name:_0x1e5f09,product_name:_0x380a8d,stock:_0x479173,quantity:_0x46ddff,note:_0xbe3677,room:_0x424989,customer:_0x1d7e16,SCRN:_0x54d94c}=_0x1d3b41[_0x5e455e(0x226)];if(typeof _0x380a8d==_0x5e455e(0x25c))var _0x307733=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x269)]],_0x545662=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1ee)]],_0x84454e=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x205)]],_0x1e36dd=[_0x1d3b41[_0x5e455e(0x226)]['primary_code']],_0x453549=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x215)]],_0x41d2a0=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x253)]],_0x39827a=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x25f)]],_0x2e31bf=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1fd)]],_0x132004=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1b5)]],_0x5f35da=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x198)]],_0x49b0a1=[_0x1d3b41['body']['expiry_date']],_0x4c51e5=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1dd)]],_0x117162=[_0x1d3b41[_0x5e455e(0x226)]['production_date']],_0x4ad6e1=[_0x1d3b41['body']['requested_qty']],_0x1bd331=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x200)]],_0x39a3b6=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x20d)]],_0x2fa747=[_0x1d3b41[_0x5e455e(0x226)]['prod_cat']],_0x531b78=[_0x1d3b41[_0x5e455e(0x226)]['quantity']],_0x272e26=[_0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1f7)]];else var _0x307733=[..._0x1d3b41['body'][_0x5e455e(0x269)]],_0x545662=[..._0x1d3b41['body']['stock']],_0x84454e=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x205)]],_0x1e36dd=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x236)]],_0x453549=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x215)]],_0x41d2a0=[..._0x1d3b41['body'][_0x5e455e(0x253)]],_0x39827a=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x25f)]],_0x2e31bf=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1fd)]],_0x132004=[..._0x1d3b41['body'][_0x5e455e(0x1b5)]],_0x5f35da=[..._0x1d3b41[_0x5e455e(0x226)]['batch_code']],_0x49b0a1=[..._0x1d3b41[_0x5e455e(0x226)]['expiry_date']],_0x4c51e5=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x1dd)]],_0x117162=[..._0x1d3b41['body'][_0x5e455e(0x185)]],_0x4ad6e1=[..._0x1d3b41[_0x5e455e(0x226)]['requested_qty']],_0x1bd331=[..._0x1d3b41[_0x5e455e(0x226)]['delivery_date']],_0x39a3b6=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x20d)]],_0x2fa747=[..._0x1d3b41['body'][_0x5e455e(0x1c1)]],_0x531b78=[..._0x1d3b41[_0x5e455e(0x226)][_0x5e455e(0x206)]],_0x272e26=[..._0x1d3b41['body']['RoomAssigned']];const _0x2bac05=_0x307733[_0x5e455e(0x257)](_0xdd165a=>{return _0xdd165a={'product_name':_0xdd165a};});_0x545662[_0x5e455e(0x21c)]((_0x478e76,_0xb7dbb8)=>{var _0x276686=_0x5e455e;_0x2bac05[_0xb7dbb8]['stock']=Math[_0x276686(0x268)](_0x478e76);}),_0x84454e['forEach']((_0xa90f8e,_0x44c022)=>{var _0x11d1ec=_0x5e455e;_0x2bac05[_0x44c022][_0x11d1ec(0x206)]=_0xa90f8e;}),_0x1e36dd[_0x5e455e(0x21c)]((_0x550712,_0x2d3aa1)=>{var _0x4831c7=_0x5e455e;_0x2bac05[_0x2d3aa1][_0x4831c7(0x236)]=_0x550712;}),_0x453549['forEach']((_0x4524d2,_0x4dfdd7)=>{var _0x543bfd=_0x5e455e;_0x2bac05[_0x4dfdd7][_0x543bfd(0x215)]=_0x4524d2;}),_0x41d2a0[_0x5e455e(0x21c)]((_0x33a481,_0x3cd039)=>{_0x2bac05[_0x3cd039]['product_code']=_0x33a481;}),_0x39827a['forEach']((_0x4429a1,_0x1a7672)=>{var _0x13e84f=_0x5e455e;_0x272e26[_0x13e84f(0x21c)]((_0x4a7096,_0x2a467e)=>{var _0x31ce80=_0x13e84f;if(_0x4a7096==_0x31ce80(0x210)&&_0x1a7672==_0x2a467e){var _0x3c10ab=_0x4429a1['slice'](0x3);_0x2bac05[_0x1a7672][_0x31ce80(0x18a)]=_0x4429a1[0x0],_0x2bac05[_0x1a7672]['rack']=_0x4429a1[0x1],_0x2bac05[_0x1a7672]['bay']=0x0,_0x2bac05[_0x1a7672][_0x31ce80(0x248)]=0x0,_0x2bac05[_0x1a7672][_0x31ce80(0x197)]=_0x31ce80(0x219),_0x2bac05[_0x1a7672]['floorlevel']=_0x3c10ab;}else{if(_0x4a7096==_0x31ce80(0x23e)&&_0x1a7672==_0x2a467e){var _0x3c10ab=_0x4429a1[_0x31ce80(0x217)](0x3);_0x2bac05[_0x1a7672]['storage']=_0x4429a1[0x0],_0x2bac05[_0x1a7672][_0x31ce80(0x17e)]=_0x4429a1[0x1],_0x2bac05[_0x1a7672][_0x31ce80(0x181)]=0x0,_0x2bac05[_0x1a7672][_0x31ce80(0x248)]=0x0,_0x2bac05[_0x1a7672][_0x31ce80(0x197)]=_0x31ce80(0x219),_0x2bac05[_0x1a7672]['floorlevel']=_0x4429a1[0x5];}else{if(_0x1a7672==_0x2a467e){var _0x2e6dce;if(_0x4429a1[0x4]=='L')_0x2e6dce=_0x31ce80(0x1be);else _0x4429a1[0x4]=='F'&&(_0x2e6dce='Floor');_0x2bac05[_0x1a7672][_0x31ce80(0x18a)]=_0x4429a1[0x0],_0x2bac05[_0x1a7672][_0x31ce80(0x17e)]=_0x4429a1[0x1],_0x2bac05[_0x1a7672][_0x31ce80(0x181)]=_0x4429a1[0x2],_0x2bac05[_0x1a7672]['bin']=_0x4429a1[0x3],_0x2bac05[_0x1a7672][_0x31ce80(0x197)]=_0x2e6dce,_0x2bac05[_0x1a7672][_0x31ce80(0x245)]=_0x4429a1[0x5];}}}});}),_0x2e31bf[_0x5e455e(0x21c)]((_0x2eeef4,_0x22d461)=>{var _0x3d8017=_0x5e455e;_0x2bac05[_0x22d461][_0x3d8017(0x246)]=_0x2eeef4;}),_0x132004[_0x5e455e(0x21c)]((_0x2ae770,_0x34c228)=>{var _0x3e4f0f=_0x5e455e;_0x2bac05[_0x34c228][_0x3e4f0f(0x1b5)]=_0x2ae770;}),_0x5f35da[_0x5e455e(0x21c)]((_0x5ef200,_0x33fbad)=>{var _0x3433af=_0x5e455e;_0x2bac05[_0x33fbad][_0x3433af(0x198)]=_0x5ef200;}),_0x49b0a1['forEach']((_0xa1914f,_0x34e89c)=>{var _0x1ce59a=_0x5e455e;_0x2bac05[_0x34e89c][_0x1ce59a(0x1aa)]=_0xa1914f;}),_0x4c51e5[_0x5e455e(0x21c)]((_0x4ca629,_0x523711)=>{var _0x2ffd2e=_0x5e455e;_0x2bac05[_0x523711][_0x2ffd2e(0x235)]=_0x4ca629;}),_0x117162[_0x5e455e(0x21c)]((_0x33fb2b,_0x3f6595)=>{var _0x4b30b4=_0x5e455e;_0x2bac05[_0x3f6595][_0x4b30b4(0x185)]=_0x33fb2b;}),_0x4ad6e1[_0x5e455e(0x21c)]((_0x21decd,_0x34f991)=>{_0x2bac05[_0x34f991]['requested_qty']=Math['abs'](_0x21decd);}),_0x1bd331[_0x5e455e(0x21c)]((_0x44b897,_0x223e80)=>{var _0x41ef10=_0x5e455e;_0x2bac05[_0x223e80][_0x41ef10(0x200)]=_0x44b897;}),_0x39a3b6[_0x5e455e(0x21c)]((_0x4f8957,_0x591ef2)=>{var _0x3af04b=_0x5e455e;_0x2bac05[_0x591ef2][_0x3af04b(0x20d)]=_0x4f8957;}),_0x2fa747[_0x5e455e(0x21c)]((_0x23b469,_0x14440f)=>{var _0x1074b9=_0x5e455e;_0x2bac05[_0x14440f][_0x1074b9(0x1c1)]=_0x23b469;}),_0x531b78[_0x5e455e(0x21c)]((_0x4489c7,_0x59c679)=>{var _0x190160=_0x5e455e;_0x2bac05[_0x59c679][_0x190160(0x182)]=_0x4489c7;}),_0x272e26['forEach']((_0x328b21,_0x460f3e)=>{_0x2bac05[_0x460f3e]['room_name']=_0x328b21;});var _0x4df916=0x0;_0x2bac05[_0x5e455e(0x21c)](_0x1c0e1d=>{var _0x2e349d=_0x5e455e;console['log'](_0x2e349d(0x1a2),_0x1c0e1d),(parseInt(_0x1c0e1d[_0x2e349d(0x1ee)])<parseInt(_0x1c0e1d[_0x2e349d(0x206)])||parseInt(_0x1c0e1d[_0x2e349d(0x206)])==0x0)&&_0x4df916++;});if(_0x4df916!=0x0)return _0x1d3b41['flash'](_0x5e455e(0x209),_0x5e455e(0x24c)),_0x58a08c['redirect'](_0x5e455e(0x192));const _0x186f9c=_0x2bac05[_0x5e455e(0x256)](_0x2c5ba5=>_0x2c5ba5['quantity']!=='0'&&_0x2c5ba5[_0x5e455e(0x206)]!=='');_0x1b535f[_0x5e455e(0x20b)]=_0x2fab27,_0x1b535f['customer']=_0x1d7e16,_0x1b535f[_0x5e455e(0x1de)]=_0x94ac29,_0x1b535f[_0x5e455e(0x19b)]=_0x1e5f09,_0x1b535f[_0x5e455e(0x22b)]=_0x186f9c,_0x1b535f['note']=_0xbe3677,_0x1b535f[_0x5e455e(0x20e)]=_0x54d94c,_0x1b535f[_0x5e455e(0x252)]=_0x5e455e(0x208),_0x1b535f['isAllowEdit']=_0x5e455e(0x208);const _0x5866a0=await _0x1b535f[_0x5e455e(0x1df)]();_0x1d3b41['flash']('success',_0x5e455e(0x26e)),_0x58a08c[_0x5e455e(0x24e)]('/all_sales/view');}catch(_0x1a3cd1){console[_0x5e455e(0x1ff)](_0x1a3cd1);}}),router[a0_0x151a2f(0x1e0)](a0_0x151a2f(0x218),auth,async(_0x4ee3ca,_0x286c73)=>{var _0x3cc80a=a0_0x151a2f;try{const _0x1cef50=_0x4ee3ca[_0x3cc80a(0x1bb)]['id'],{invoice:_0x360683,customer:_0x4d6e3c,receivable_amount:_0x1268d3,received_amount:_0x13751b}=_0x4ee3ca[_0x3cc80a(0x226)],_0x3c738f=await sales[_0x3cc80a(0x1b9)](_0x1cef50);console[_0x3cc80a(0x1ff)](_0x3c738f);var _0x14a89f=_0x1268d3-_0x13751b;console[_0x3cc80a(0x1ff)](_0x13751b),_0x3c738f[_0x3cc80a(0x194)]=parseFloat(_0x13751b)+parseFloat(_0x3c738f[_0x3cc80a(0x194)]),_0x3c738f[_0x3cc80a(0x187)]=_0x14a89f,console['log'](_0x3c738f);const _0x33a89d=await _0x3c738f[_0x3cc80a(0x1df)](),_0x2b7c75=await c_payment_data['findOne']({'invoice':_0x360683});_0x2b7c75['amount']=_0x14a89f,await _0x2b7c75[_0x3cc80a(0x1df)]();let _0x36cf58=new Date(),_0x2b5518=('0'+_0x36cf58[_0x3cc80a(0x242)]())[_0x3cc80a(0x217)](-0x2),_0x1e94e0=('0'+(_0x36cf58['getMonth']()+0x1))[_0x3cc80a(0x217)](-0x2),_0x27916f=_0x36cf58[_0x3cc80a(0x21d)](),_0x3d356d=_0x27916f+'-'+_0x1e94e0+'-'+_0x2b5518;const _0x544b34=new customer_payment({'invoice':_0x360683,'date':_0x27916f+'-'+_0x1e94e0+'-'+_0x2b5518,'customer':_0x4d6e3c,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x13751b}),_0x262948=await _0x544b34['save']();_0x4ee3ca[_0x3cc80a(0x241)](_0x3cc80a(0x1e5),_0x3cc80a(0x271)),_0x286c73[_0x3cc80a(0x24e)](_0x3cc80a(0x27f));}catch(_0x215107){console[_0x3cc80a(0x1ff)](_0x215107);}}),router[a0_0x151a2f(0x1fa)]('/invoice/:id',auth,async(_0x2b020e,_0x7f920e)=>{var _0x540ddd=a0_0x151a2f;try{const {username:_0x19e142,email:_0xbf0690,role:_0x4ab2a3}=_0x2b020e['user'],_0x2db62c=_0x2b020e[_0x540ddd(0x23a)],_0x1ff59a=await profile[_0x540ddd(0x191)]({'email':_0x2db62c[_0x540ddd(0x244)]}),_0x432a49=await master_shop['find']();console[_0x540ddd(0x1ff)]('master',_0x432a49);const _0x577baa=_0x2b020e[_0x540ddd(0x1bb)]['id'],_0x5c8825=await sales[_0x540ddd(0x1b9)](_0x577baa);console[_0x540ddd(0x1ff)](_0x5c8825);const _0x1f2216=await customer[_0x540ddd(0x191)]({'name':_0x5c8825[_0x540ddd(0x1d9)]});console['log'](_0x1f2216);if(_0x432a49[0x0][_0x540ddd(0x272)]==_0x540ddd(0x1ab)){var _0x134f05=users['English'];console[_0x540ddd(0x1ff)](_0x134f05);}else{if(_0x432a49[0x0][_0x540ddd(0x272)]==_0x540ddd(0x17b))var _0x134f05=users[_0x540ddd(0x17b)];else{if(_0x432a49[0x0][_0x540ddd(0x272)]=='German')var _0x134f05=users['German'];else{if(_0x432a49[0x0][_0x540ddd(0x272)]==_0x540ddd(0x237))var _0x134f05=users['Spanish'];else{if(_0x432a49[0x0][_0x540ddd(0x272)]==_0x540ddd(0x18c))var _0x134f05=users['French'];else{if(_0x432a49[0x0]['language']==_0x540ddd(0x1b2))var _0x134f05=users['Portuguese'];else{if(_0x432a49[0x0][_0x540ddd(0x272)]==_0x540ddd(0x21f))var _0x134f05=users[_0x540ddd(0x21f)];else{if(_0x432a49[0x0][_0x540ddd(0x272)]==_0x540ddd(0x27a))var _0x134f05=users['Arabic'];}}}}}}}_0x7f920e[_0x540ddd(0x27b)](_0x540ddd(0x264),{'success':_0x2b020e['flash'](_0x540ddd(0x1e5)),'errors':_0x2b020e[_0x540ddd(0x241)]('errors'),'role':_0x2db62c,'profile':_0x1ff59a,'master_shop':_0x432a49,'customers':_0x1f2216,'sales':_0x5c8825,'language':_0x134f05});}catch(_0x2ef4d4){console['log'](_0x2ef4d4);}}),router[a0_0x151a2f(0x1fa)](a0_0x151a2f(0x1b0),auth,async(_0x1c01cd,_0x288233)=>{var _0x1c8f17=a0_0x151a2f;try{const {username:_0x234861,email:_0x3f6362,role:_0x3243aa}=_0x1c01cd[_0x1c8f17(0x23a)],_0x29014e=_0x1c01cd[_0x1c8f17(0x23a)],_0x2fc294=await profile[_0x1c8f17(0x191)]({'email':_0x29014e[_0x1c8f17(0x244)]}),_0x2a445d=await master_shop[_0x1c8f17(0x214)]();console['log'](_0x1c8f17(0x1b1),_0x2a445d);const _0x4003a6=_0x1c01cd[_0x1c8f17(0x1bb)]['id'];console[_0x1c8f17(0x1ff)](_0x4003a6);const _0x210249=await sales[_0x1c8f17(0x1b9)](_0x4003a6);console[_0x1c8f17(0x1ff)](_0x1c8f17(0x213),_0x210249);const _0x8691da=await warehouse[_0x1c8f17(0x224)]([{'$match':{'name':_0x1c8f17(0x22c),'room':_0x1c8f17(0x1c3)}},{'$unwind':_0x1c8f17(0x1dc)},{'$group':{'_id':_0x1c8f17(0x1a9),'name':{'$first':_0x1c8f17(0x199)},'product_stock':{'$first':_0x1c8f17(0x258)},'level':{'$first':_0x1c8f17(0x1c0)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x1c8f17(0x1b4)},'primary_code':{'$first':_0x1c8f17(0x17d)},'secondary_code':{'$first':_0x1c8f17(0x196)},'product_code':{'$first':_0x1c8f17(0x1f1)}}}]);console['log'](_0x1c8f17(0x239),_0x8691da);const _0x392d1b=await product[_0x1c8f17(0x214)]({});warehouse_data=await warehouse[_0x1c8f17(0x224)]([{'$match':{'status':_0x1c8f17(0x19c),'name':_0x1c8f17(0x22c),'warehouse_category':_0x1c8f17(0x1c4)}},{'$group':{'_id':_0x1c8f17(0x27c),'name':{'$first':_0x1c8f17(0x27c)}}},{'$sort':{'name':0x1}}]);var _0x2c6ea6=[_0x1c8f17(0x1c3)];if(_0x2a445d[0x0][_0x1c8f17(0x272)]==_0x1c8f17(0x1ab)){var _0x3a1466=users[_0x1c8f17(0x26c)];console[_0x1c8f17(0x1ff)](_0x3a1466);}else{if(_0x2a445d[0x0][_0x1c8f17(0x272)]==_0x1c8f17(0x17b))var _0x3a1466=users[_0x1c8f17(0x17b)];else{if(_0x2a445d[0x0][_0x1c8f17(0x272)]==_0x1c8f17(0x178))var _0x3a1466=users[_0x1c8f17(0x178)];else{if(_0x2a445d[0x0]['language']==_0x1c8f17(0x237))var _0x3a1466=users['Spanish'];else{if(_0x2a445d[0x0][_0x1c8f17(0x272)]=='French')var _0x3a1466=users['French'];else{if(_0x2a445d[0x0][_0x1c8f17(0x272)]==_0x1c8f17(0x1b2))var _0x3a1466=users[_0x1c8f17(0x275)];else{if(_0x2a445d[0x0][_0x1c8f17(0x272)]=='Chinese')var _0x3a1466=users['Chinese'];else{if(_0x2a445d[0x0][_0x1c8f17(0x272)]==_0x1c8f17(0x27a))var _0x3a1466=users[_0x1c8f17(0x211)];}}}}}}}_0x288233[_0x1c8f17(0x27b)](_0x1c8f17(0x1bd),{'success':_0x1c01cd[_0x1c8f17(0x241)](_0x1c8f17(0x1e5)),'errors':_0x1c01cd[_0x1c8f17(0x241)](_0x1c8f17(0x209)),'role':_0x29014e,'profile':_0x2fc294,'user':_0x210249,'stock':_0x8691da,'master_shop':_0x2a445d,'unit':_0x392d1b,'language':_0x3a1466,'warehouses':warehouse_data,'rooms':_0x2c6ea6});}catch(_0x22c853){console[_0x1c8f17(0x1ff)](_0x22c853),_0x288233[_0x1c8f17(0x1e6)](0xc8)['json']({'message':_0x22c853['message']});}}),router[a0_0x151a2f(0x1e0)](a0_0x151a2f(0x1b0),auth,async(_0x5c58bb,_0x5bda0c)=>{var _0x5b9645=a0_0x151a2f;try{const {invoice:_0x2bf960,date:_0x2785d8,warehouse_name:_0x119e5c,product_name:_0x4e6fd9,primary_code:_0x5644f1,secondary_code:_0x528709,product_code:_0x10bc3c,sales_quantity:_0x25c999,stocks:_0x21ef98,return_qty:_0x26c397,Room_name:_0x4243ec,to_warehouse_name:_0x5958ff,to_Roomname:_0x34fe91,to_Room_name:_0x53c0ae,note:_0x405812,level:_0x3497c9,isle:_0x1f7af1,pallet:_0x4e0f88}=_0x5c58bb[_0x5b9645(0x226)];if(typeof _0x4e6fd9==_0x5b9645(0x25c))var _0x7cfdb8=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x269)]],_0xc48cfa=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x236)]],_0x337606=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x215)]],_0x4e62b2=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x203)]],_0x20e8c6=[_0x5c58bb[_0x5b9645(0x226)]['sales_quantity']],_0xa302a0=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x1f8)]],_0x4510da=[_0x5c58bb[_0x5b9645(0x226)]['return_qty']],_0x1be48b=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x181)]],_0x2f2650=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x248)]],_0x554596=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x21b)]],_0x23d456=[_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x245)]];else var _0x7cfdb8=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x269)]],_0xc48cfa=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x236)]],_0x337606=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x215)]],_0x4e62b2=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x203)]],_0x20e8c6=[..._0x5c58bb['body'][_0x5b9645(0x18b)]],_0xa302a0=[..._0x5c58bb[_0x5b9645(0x226)]['stocks']],_0x4510da=[..._0x5c58bb[_0x5b9645(0x226)]['return_qty']],_0x1be48b=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x181)]],_0x2f2650=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x248)]],_0x554596=[..._0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x21b)]],_0x23d456=[..._0x5c58bb[_0x5b9645(0x226)]['floorlevel']];const _0x32a458=_0x7cfdb8[_0x5b9645(0x257)](_0x22190c=>{return _0x22190c={'product_name':_0x22190c};});_0xc48cfa['forEach']((_0x2dacb1,_0x145ed4)=>{_0x32a458[_0x145ed4]['primary_code']=_0x2dacb1;}),_0x337606[_0x5b9645(0x21c)]((_0xfdb4fd,_0xf950ff)=>{_0x32a458[_0xf950ff]['secondary_code']=_0xfdb4fd;}),_0x4e62b2[_0x5b9645(0x21c)]((_0x16bbd4,_0x2c9874)=>{_0x32a458[_0x2c9874]['product_code']=_0x16bbd4;}),_0x20e8c6['forEach']((_0x2b71bb,_0x3328ea)=>{var _0x428c14=_0x5b9645;_0x32a458[_0x3328ea][_0x428c14(0x26a)]=_0x2b71bb;}),_0xa302a0[_0x5b9645(0x21c)]((_0x4df5e3,_0x367386)=>{var _0x4440db=_0x5b9645;_0x32a458[_0x367386][_0x4440db(0x1ee)]=_0x4df5e3;}),_0x4510da[_0x5b9645(0x21c)]((_0x1dd14c,_0x458a1d)=>{_0x32a458[_0x458a1d]['return_qty']=_0x1dd14c;}),_0x1be48b[_0x5b9645(0x21c)]((_0x4c0e40,_0x141808)=>{_0x32a458[_0x141808]['bay']=_0x4c0e40;}),_0x2f2650[_0x5b9645(0x21c)]((_0x3269bc,_0x3bae14)=>{var _0x23235b=_0x5b9645;_0x32a458[_0x3bae14][_0x23235b(0x248)]=_0x3269bc;}),_0x554596[_0x5b9645(0x21c)]((_0xb86451,_0x29cffa)=>{_0x32a458[_0x29cffa]['type']=_0xb86451;}),_0x23d456[_0x5b9645(0x21c)]((_0x290d2a,_0x25b00b)=>{_0x32a458[_0x25b00b]['floorlevel']=_0x290d2a;});var _0x51115a=0x0;_0x32a458['forEach'](_0x3699b0=>{var _0x1f6b39=_0x5b9645;console['log'](_0x1f6b39(0x1a2),_0x3699b0),(parseInt(_0x3699b0[_0x1f6b39(0x26a)])<parseInt(_0x3699b0['return_qty'])||parseInt(_0x3699b0[_0x1f6b39(0x1ee)])<parseInt(_0x3699b0[_0x1f6b39(0x221)])&&parseInt(_0x3699b0[_0x1f6b39(0x26a)])>parseInt(_0x3699b0['return_qty'])||parseInt(_0x3699b0[_0x1f6b39(0x221)])==0x0)&&_0x51115a++;});if(_0x51115a!=0x0)return _0x5c58bb[_0x5b9645(0x241)](_0x5b9645(0x209),_0x5b9645(0x1d4)),_0x5bda0c[_0x5b9645(0x24e)](_0x5b9645(0x192));const _0x563f4e=await sales['findOne']({'invoice':_0x2bf960});console[_0x5b9645(0x1ff)](_0x563f4e),_0x563f4e[_0x5b9645(0x234)]='True';const _0x39e73d=await _0x563f4e[_0x5b9645(0x1df)](),_0x481512=new sales_return({'invoice':_0x2bf960,'customer':_0x5c58bb['body']['customer'],'date':_0x2785d8,'warehouse_name':_0x119e5c,'room':_0x4243ec,'ToWarehouse':_0x5958ff,'ToRoom':_0x53c0ae,'return_sale':_0x32a458,'note':_0x405812}),_0x5f2d4f=await _0x481512[_0x5b9645(0x1df)]();console[_0x5b9645(0x1ff)](_0x481512);const _0xeddaa1=await sales_return[_0x5b9645(0x191)]({'invoice':_0x2bf960}),_0x58cfc2=await warehouse[_0x5b9645(0x191)]({'name':_0x5958ff,'room':_0x53c0ae});_0xeddaa1[_0x5b9645(0x1bd)][_0x5b9645(0x21c)](_0x25cd94=>{var _0x293d97=_0x5b9645,_0x40e58c=0x0;const _0x2cbfa2=_0x58cfc2[_0x293d97(0x233)][_0x293d97(0x257)](_0x977b0e=>{var _0x3af7c3=_0x293d97;_0x977b0e[_0x3af7c3(0x269)]==_0x25cd94[_0x3af7c3(0x269)]&&_0x977b0e['floorlevel']==_0x25cd94['floorlevel']&&_0x977b0e[_0x3af7c3(0x197)]==_0x25cd94[_0x3af7c3(0x197)]&&_0x977b0e[_0x3af7c3(0x248)]==_0x25cd94[_0x3af7c3(0x248)]&&_0x977b0e[_0x3af7c3(0x181)]==_0x25cd94['bay']&&(_0x977b0e[_0x3af7c3(0x1ca)]=parseInt(_0x977b0e['product_stock'])+parseInt(_0x25cd94[_0x3af7c3(0x221)]),_0x40e58c++);});_0x40e58c=='0'&&(_0x58cfc2[_0x293d97(0x233)]=_0x58cfc2[_0x293d97(0x233)][_0x293d97(0x1e4)]({'product_name':_0x25cd94[_0x293d97(0x269)],'product_stock':_0x25cd94[_0x293d97(0x221)],'primary_code':_0x25cd94[_0x293d97(0x236)],'secondary_code':_0x25cd94[_0x293d97(0x215)],'product_code':_0x25cd94[_0x293d97(0x203)],'bay':_0x25cd94['bay'],'bin':_0x25cd94[_0x293d97(0x248)],'type':_0x25cd94[_0x293d97(0x197)],'floorlevel':_0x25cd94[_0x293d97(0x245)]})),console[_0x293d97(0x1ff)](_0x293d97(0x207),_0x58cfc2);}),await _0x58cfc2[_0x5b9645(0x1df)](),console['log'](_0x5c58bb[_0x5b9645(0x226)]);const _0x1c39ff=new c_payment_data({'invoice':_0x2bf960,'customer':_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x1d9)],'reason':_0x5b9645(0x255)});await _0x1c39ff[_0x5b9645(0x1df)]();const _0x48dca6=await master_shop[_0x5b9645(0x214)]();console['log'](_0x5b9645(0x20f),_0x48dca6[0x0][_0x5b9645(0x1cc)]);const _0x3c3d33=await email_settings[_0x5b9645(0x191)](),_0x15a76a=await customer[_0x5b9645(0x191)]({'name':_0x5c58bb[_0x5b9645(0x226)][_0x5b9645(0x1d9)]});console[_0x5b9645(0x1ff)](_0x5b9645(0x240),_0x15a76a);_0x48dca6[0x0][_0x5b9645(0x190)]==0x1?(right_currency=_0x48dca6[0x0][_0x5b9645(0x1e7)],left_currency=''):(right_currency='',left_currency=_0x48dca6[0x0][_0x5b9645(0x1e7)]);var _0x3796f5=_0x7cfdb8,_0x3f7ae8=_0x4510da,_0x3bbbbd='',_0x40684f;for(_0x40684f in _0x3796f5){_0x3bbbbd+=_0x5b9645(0x195)+_0x5b9645(0x1f9)+_0x3796f5[_0x40684f]+_0x5b9645(0x1fe)+_0x5b9645(0x1f9)+_0x3f7ae8[_0x40684f]+_0x5b9645(0x1fe)+_0x5b9645(0x18e);}console[_0x5b9645(0x1ff)](_0x5b9645(0x23d),_0x3bbbbd);let _0x309fcd=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x3c3d33[_0x5b9645(0x244)],'pass':_0x3c3d33[_0x5b9645(0x1e1)]}}),_0x17fc36={'from':_0x3c3d33[_0x5b9645(0x244)],'to':_0x15a76a[_0x5b9645(0x244)],'subject':_0x5b9645(0x229),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5b9645(0x26d)+_0x5b9645(0x179)+_0x48dca6[0x0]['image'],'cid':_0x5b9645(0x188)}],'html':_0x5b9645(0x1ae)+_0x5b9645(0x189)+_0x5b9645(0x1f6)+_0x5b9645(0x276)+_0x5b9645(0x25d)+'<div>'+_0x5b9645(0x279)+_0x5b9645(0x23c)+'<div>'+_0x5b9645(0x278)+_0x48dca6[0x0][_0x5b9645(0x1ed)]+'\x20</h2>'+_0x5b9645(0x23c)+'</div>'+_0x5b9645(0x183)+_0x5b9645(0x276)+_0x5b9645(0x18f)+_0x5b9645(0x184)+_0x2bf960+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5b9645(0x23b)+_0x2785d8+'\x20'+_0x5b9645(0x1a5)+_0x5b9645(0x24b)+_0x5b9645(0x23c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5b9645(0x1ef)+'<tr>'+_0x5b9645(0x238)+_0x5b9645(0x1a7)+_0x5b9645(0x1d7)+_0x5b9645(0x1a3)+_0x5b9645(0x18e)+_0x5b9645(0x262)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3bbbbd+'\x20'+_0x5b9645(0x1ce)+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x48dca6[0x0][_0x5b9645(0x1ed)]+_0x5b9645(0x24b)+'</div>'+_0x5b9645(0x23c)+_0x5b9645(0x1a1)};_0x309fcd[_0x5b9645(0x27d)](_0x17fc36,function(_0x3bd807,_0x808270){var _0x2947b9=_0x5b9645;_0x3bd807?(console['log'](_0x3bd807),console['log'](_0x2947b9(0x1a4))):console[_0x2947b9(0x1ff)](_0x2947b9(0x1ec));}),_0x5c58bb[_0x5b9645(0x241)](_0x5b9645(0x1e5),_0x5b9645(0x19e)),_0x5bda0c['redirect'](_0x5b9645(0x27f));}catch(_0xb5d54){console[_0x5b9645(0x1ff)](_0xb5d54),_0x5bda0c[_0x5b9645(0x1e6)](0xc8)['json']({'message1':_0xb5d54['message']});}}),router['get']('/barcode/:id',auth,async(_0x2c2128,_0x3e3261)=>{var _0x570c77=a0_0x151a2f;try{const {username:_0x30dd07,email:_0x3f467b,role:_0x3faaab}=_0x2c2128[_0x570c77(0x23a)],_0xd34d94=_0x2c2128[_0x570c77(0x23a)],_0x4a272f=await profile[_0x570c77(0x191)]({'email':_0xd34d94[_0x570c77(0x244)]}),_0x3b212e=await master_shop[_0x570c77(0x214)]();console[_0x570c77(0x1ff)](_0x570c77(0x274),_0x3b212e);const _0x4a4a98=_0x2c2128[_0x570c77(0x1bb)]['id'],_0x241a4c=await sales[_0x570c77(0x1b9)](_0x4a4a98);console[_0x570c77(0x1ff)](_0x570c77(0x227),_0x241a4c);if(_0x3b212e[0x0]['language']==_0x570c77(0x1ab))var _0x2fd15b=users[_0x570c77(0x26c)];else{if(_0x3b212e[0x0]['language']=='Hindi')var _0x2fd15b=users['Hindi'];else{if(_0x3b212e[0x0][_0x570c77(0x272)]==_0x570c77(0x178))var _0x2fd15b=users[_0x570c77(0x178)];else{if(_0x3b212e[0x0][_0x570c77(0x272)]==_0x570c77(0x237))var _0x2fd15b=users[_0x570c77(0x237)];else{if(_0x3b212e[0x0][_0x570c77(0x272)]==_0x570c77(0x18c))var _0x2fd15b=users['French'];else{if(_0x3b212e[0x0][_0x570c77(0x272)]==_0x570c77(0x1b2))var _0x2fd15b=users[_0x570c77(0x275)];else{if(_0x3b212e[0x0][_0x570c77(0x272)]=='Chinese')var _0x2fd15b=users[_0x570c77(0x21f)];else{if(_0x3b212e[0x0][_0x570c77(0x272)]==_0x570c77(0x27a))var _0x2fd15b=users[_0x570c77(0x211)];}}}}}}}_0x3e3261[_0x570c77(0x27b)](_0x570c77(0x21e),{'success':_0x2c2128[_0x570c77(0x241)]('success'),'errors':_0x2c2128['flash'](_0x570c77(0x209)),'role':_0xd34d94,'profile':_0x4a272f,'alldata':_0x241a4c,'master_shop':_0x3b212e,'language':_0x2fd15b});}catch(_0x220790){console[_0x570c77(0x1ff)](_0x220790);}}),router[a0_0x151a2f(0x1e0)](a0_0x151a2f(0x25a),async(_0x262e8b,_0x5d4f72)=>{var _0x28ecfa=a0_0x151a2f;const {product_code:_0x10b0af,warehouse_name:_0xccce5c,rooms_data:_0xc27d44,Roomslist:_0x5c31a7}=_0x262e8b['body'],_0x2492e3=_0x5c31a7[_0x28ecfa(0x1eb)](','),_0x17d743=[];async function _0x2e263f(_0xe5d214){var _0x8f99bd=_0x28ecfa;const _0x104182=await warehouse['aggregate']([{'$match':{'name':_0xccce5c,'room':_0xe5d214}},{'$unwind':_0x8f99bd(0x1dc)},{'$match':{'product_details.primary_code':_0x10b0af}},{'$group':{'_id':_0x8f99bd(0x1a9),'name':{'$first':_0x8f99bd(0x199)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x8f99bd(0x17d)},'secondary_code':{'$first':_0x8f99bd(0x196)},'product_code':{'$first':_0x8f99bd(0x1f1)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x8f99bd(0x1fb)},'type':{'$first':_0x8f99bd(0x1c8)},'pallet':{'$first':_0x8f99bd(0x20c)},'unit':{'$first':_0x8f99bd(0x263)},'secondary_unit':{'$first':_0x8f99bd(0x1fc)},'storage':{'$first':_0x8f99bd(0x21a)},'rack':{'$first':_0x8f99bd(0x25b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x8f99bd(0x19a)},'maxPerUnit':{'$first':_0x8f99bd(0x1d1)},'batch_code':{'$first':_0x8f99bd(0x247)},'product_cat':{'$first':_0x8f99bd(0x270)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x8f99bd(0x1e9)},'invoice':{'$first':_0x8f99bd(0x19f)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x5ba3c3=await warehouse['aggregate']([{'$match':{'name':_0xccce5c,'room':_0xe5d214}},{'$unwind':_0x8f99bd(0x1dc)},{'$match':{'product_details.secondary_code':_0x10b0af}},{'$group':{'_id':_0x8f99bd(0x1a9),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x8f99bd(0x17d)},'secondary_code':{'$first':_0x8f99bd(0x196)},'product_code':{'$first':_0x8f99bd(0x1f1)},'level':{'$first':_0x8f99bd(0x1d0)},'isle':{'$first':_0x8f99bd(0x1fb)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x8f99bd(0x20c)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x8f99bd(0x1fc)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x8f99bd(0x25b)},'expiry_date':{'$first':_0x8f99bd(0x228)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x8f99bd(0x1d1)},'batch_code':{'$first':_0x8f99bd(0x247)},'product_cat':{'$first':_0x8f99bd(0x270)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x8f99bd(0x1e9)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x104182['length']>0x0)_0x17d743[_0x8f99bd(0x1db)](_0x104182);else _0x5ba3c3[_0x8f99bd(0x204)]>0x0&&_0x17d743[_0x8f99bd(0x1db)](_0x5ba3c3);}const _0x1a2cc5=_0x2492e3['map'](_0x1147c6=>_0x2e263f(_0x1147c6));await Promise[_0x28ecfa(0x250)](_0x1a2cc5),_0x5d4f72[_0x28ecfa(0x267)](_0x17d743);}),module[a0_0x151a2f(0x1c7)]=router;