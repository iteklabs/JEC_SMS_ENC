function a0_0x3f66(){var _0x4228ff=['$product_details.product_cat','/barcode_scanner','expiry_date','carton','password','actual_qty','delivery_code','return_sale','An\x20error\x20occurred.','$product_details.product_stock','$product_details.isle','63WWbClA','save','4611288ylBjkB','$product_details.secondary_code','$product_details.storage','$sale_product.type','slice','error','$product_details.rack','/view/:id','<!DOCTYPE\x20html>','Enabled','English\x20(US)','$sale_product.bin','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','floorlevel','master','</h5>','$product_details.bin','exports','host','</thead>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</td>','getFullYear','$sale_product','$room','aggregate','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','padStart','bin','push','/view/add_sales','$_id','room_name','find','language','Error\x20Occurs','$customer','</tbody>','/view/return_sales/:id','purchases_data','$product_details.product_code','name','$product_details.expiry_date','stocks','Sales\x20Add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_invoice','Arabic','/../public','findOne','customer','log','$sale_product.quantity','requested_qty','Ambient','<tr>','email','<div>','English','Arabic\x20(ae)','14JJzygA','add\x20post','findById','delivery_date','sendMail','catch','due_amount','sales_quantity','4997340eIyqZZ','string','$sale_product.bay','product_list','</tr>','batch_code','invoice','Chinese','finalize','post','$product_details.primary_code','Email\x20sent\x20successfully','../models/all_models','<h5>','split','$product_details','$warehouse_name','Portuguese','abs','back','then','$product_details._id','$product_details.maxPerUnit','Sales\x20Mail','Sale\x20Return\x20Mail','/upload/','$date','/view/add_sale/product','all','flash','redirect','$product_details.floorlevel','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Sales\x20Update\x20successfully','SCRN','$invoice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$finalize','quantity','gmail','product_stock','$product_details.secondary_unit','message','</div>','Shelves','<hr\x20class=\x22my-3\x22>','</head><body>','_id','map','type','render','prod_cat','/view/add_sales/:id','$product_details.actual_uom','room','id_transact','barcode\x20Product\x20master','519280IwoVaU','$name','site_title','received_amount','forEach','return_qty','$product_details.type','/all_sales/view','58144yYeLza','params','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','errors','$product_details.unit','edit_sales_view','getMonth','product_data','floor','prod_code','17900YInbfu','get','585588GORdiH','actual_uom','69uXtjQX','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$sale_product.floorlevel','<tbody\x20style=\x22text-align:\x20center;\x22>','RoomAssigned','sale_product','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<strong>\x20Regards\x20</strong>','$isAllowEdit','\x20Order\x20Number\x20:\x20','$product','storage','German','return_data','</body></html>','<span\x20style=\x22float:\x20right;\x22>','success','<table\x20style=\x22width:\x20100%\x20!important;\x22>','../public/language/languages.json','/preview/:id','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sale_qty','id_transaction_from','primary_code','Router','Return\x20Goods','product_code','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Logo.png','primary_unit','maxperunit','warehouse','$return_data','Level','stock','Hindi','$product_details.actual_qty','True','image','max_per_unit','260SaFYHw','\x20</h2>','</span>','foreach\x20newproduct','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','production_date','False','Portuguese\x20(BR)','$customers_docs','product_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/view','Raw\x20Materials','payment\x20successfull','currency_placement','user','warehouse_name','$product_details.batch_code','stock_data','rack','/all_sales/preview/','date','logo','json','length','types','$product_details.production_date','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','RMSEmail','$product_details.product_name','Sale\x20Return','status','French','final','Return\x20Rooms','Receiving\x20Area','currency','quantity_notConverted','product_details','</table>','secondary_unit','role','unit','body','$product_details.invoice','customers','OUT-','<h2>\x20','staff','barcode\x20user_id','\x20Order\x20Date\x20:\x20','customers_docs','Floor','Spanish','sales_invoice','1129030IiDMqS'];a0_0x3f66=function(){return _0x4228ff;};return a0_0x3f66();}var a0_0x357d96=a0_0x4336;(function(_0xf09aac,_0x24a1c9){var _0x522a64=a0_0x4336,_0x4c72db=_0xf09aac();while(!![]){try{var _0x11ad08=parseInt(_0x522a64(0x178))/0x1+parseInt(_0x522a64(0x176))/0x2*(parseInt(_0x522a64(0x17a))/0x3)+-parseInt(_0x522a64(0x16b))/0x4*(-parseInt(_0x522a64(0x1a5))/0x5)+-parseInt(_0x522a64(0x233))/0x6+parseInt(_0x522a64(0x22b))/0x7*(parseInt(_0x522a64(0x163))/0x8)+-parseInt(_0x522a64(0x1ea))/0x9*(parseInt(_0x522a64(0x1de))/0xa)+parseInt(_0x522a64(0x1ec))/0xb;if(_0x11ad08===_0x24a1c9)break;else _0x4c72db['push'](_0x4c72db['shift']());}catch(_0x10bb1f){_0x4c72db['push'](_0x4c72db['shift']());}}}(a0_0x3f66,0x73827));const express=require('express'),app=express(),router=express[a0_0x357d96(0x194)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x357d96(0x23f)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x357d96(0x18e));function a0_0x4336(_0x2912af,_0x3d1cd0){var _0x3f6697=a0_0x3f66();return a0_0x4336=function(_0x43364d,_0x48c79f){_0x43364d=_0x43364d-0x156;var _0x2ef6b5=_0x3f6697[_0x43364d];return _0x2ef6b5;},a0_0x4336(_0x2912af,_0x3d1cd0);}router['get'](a0_0x357d96(0x1b1),auth,async(_0x277aac,_0x39ad0d)=>{var _0xcdb9c6=a0_0x357d96;try{const {username:_0x811a52,email:_0x481576,role:_0x38ad19}=_0x277aac[_0xcdb9c6(0x1b5)],_0x4e1557=_0x277aac[_0xcdb9c6(0x1b5)],_0x620a19=await profile[_0xcdb9c6(0x220)]({'email':_0x4e1557['email']}),_0x4c62c6=await master_shop[_0xcdb9c6(0x210)]();let _0x158755;if(_0x4e1557[_0xcdb9c6(0x1d0)]==_0xcdb9c6(0x1d7)){const _0x41eabd=await staff['findOne']({'email':_0x4e1557['email']});_0x158755=await sales[_0xcdb9c6(0x208)]([{'$lookup':{'from':_0xcdb9c6(0x1d4),'localField':'customer','foreignField':_0xcdb9c6(0x218),'as':_0xcdb9c6(0x1da)}},{'$unwind':_0xcdb9c6(0x1ae)},{'$unwind':_0xcdb9c6(0x206)},{'$group':{'_id':_0xcdb9c6(0x20e),'invoice':{'$first':_0xcdb9c6(0x256)},'customers':{'$first':_0xcdb9c6(0x213)},'date':{'$first':_0xcdb9c6(0x24d)},'warehouse_name':{'$first':_0xcdb9c6(0x243)},'sale_product':{'$push':_0xcdb9c6(0x206)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xcdb9c6(0x1ae)},'total_saleproduct_quantity':{'$sum':_0xcdb9c6(0x223)},'level':{'$addToSet':_0xcdb9c6(0x235)},'isle':{'$addToSet':_0xcdb9c6(0x1f7)},'type':{'$addToSet':_0xcdb9c6(0x1ef)},'pallet':{'$addToSet':_0xcdb9c6(0x17c)},'finalize':{'$first':_0xcdb9c6(0x258)},'isAllowEdit':{'$first':_0xcdb9c6(0x184)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x158755=await sales[_0xcdb9c6(0x208)]([{'$lookup':{'from':_0xcdb9c6(0x1d4),'localField':'customer','foreignField':'name','as':_0xcdb9c6(0x1da)}},{'$unwind':_0xcdb9c6(0x1ae)},{'$unwind':'$sale_product'},{'$group':{'_id':_0xcdb9c6(0x20e),'invoice':{'$first':_0xcdb9c6(0x256)},'customers':{'$first':_0xcdb9c6(0x213)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xcdb9c6(0x243)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0xcdb9c6(0x19d)},'customers_docs':{'$first':_0xcdb9c6(0x1ae)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xcdb9c6(0x235)},'isle':{'$addToSet':_0xcdb9c6(0x1f7)},'type':{'$addToSet':_0xcdb9c6(0x1ef)},'pallet':{'$addToSet':_0xcdb9c6(0x17c)},'finalize':{'$first':_0xcdb9c6(0x258)},'isAllowEdit':{'$first':_0xcdb9c6(0x184)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0xcdb9c6(0x222)]('sales\x20all_data',_0x158755);if(_0x4c62c6[0x0]['language']==_0xcdb9c6(0x1f6)){var _0x3c2cf7=users['English'];console[_0xcdb9c6(0x222)](_0x3c2cf7);}else{if(_0x4c62c6[0x0]['language']==_0xcdb9c6(0x1a0))var _0x3c2cf7=users[_0xcdb9c6(0x1a0)];else{if(_0x4c62c6[0x0][_0xcdb9c6(0x211)]==_0xcdb9c6(0x188))var _0x3c2cf7=users['German'];else{if(_0x4c62c6[0x0][_0xcdb9c6(0x211)]==_0xcdb9c6(0x1dc))var _0x3c2cf7=users[_0xcdb9c6(0x1dc)];else{if(_0x4c62c6[0x0][_0xcdb9c6(0x211)]==_0xcdb9c6(0x1c7))var _0x3c2cf7=users['French'];else{if(_0x4c62c6[0x0][_0xcdb9c6(0x211)]==_0xcdb9c6(0x1ad))var _0x3c2cf7=users[_0xcdb9c6(0x244)];else{if(_0x4c62c6[0x0]['language']=='Chinese')var _0x3c2cf7=users[_0xcdb9c6(0x23a)];else{if(_0x4c62c6[0x0][_0xcdb9c6(0x211)]==_0xcdb9c6(0x22a))var _0x3c2cf7=users[_0xcdb9c6(0x21e)];}}}}}}}_0x39ad0d['render']('all_sales',{'success':_0x277aac['flash'](_0xcdb9c6(0x18c)),'errors':_0x277aac['flash'](_0xcdb9c6(0x16f)),'sales':_0x158755,'profile':_0x620a19,'role':_0x4e1557,'master_shop':_0x4c62c6,'language':_0x3c2cf7});}catch(_0x3253cc){console['log'](_0x3253cc);}});async function getRandom8DigitNumber(){var _0xe9e86a=a0_0x357d96;const _0x402281=0x989680,_0x5ae60d=0x5f5e0ff,_0x866908=Math[_0xe9e86a(0x174)](Math['random']()*(_0x5ae60d-_0x402281+0x1))+_0x402281;var _0x146733;const _0x123b5b=await sales[_0xe9e86a(0x220)]({'invoice':'OUT-'+_0x866908});return _0x123b5b&&_0x123b5b['length']>0x0?_0x146733='OUT-'+_0x866908:_0x146733=_0xe9e86a(0x1d5)+_0x866908,_0x146733;}router[a0_0x357d96(0x177)](a0_0x357d96(0x20d),auth,async(_0x2ba4e4,_0x5fb181)=>{var _0x2a5670=a0_0x357d96;try{const {username:_0x1429fe,email:_0x4893a7,role:_0x886542}=_0x2ba4e4['user'],_0x3f2d22=_0x2ba4e4[_0x2a5670(0x1b5)],_0x518165=await profile['findOne']({'email':_0x3f2d22[_0x2a5670(0x227)]}),_0x33f757=await master_shop[_0x2a5670(0x210)](),_0x33046b=await customer[_0x2a5670(0x210)]({});let _0x25c70f;if(_0x3f2d22[_0x2a5670(0x1d0)]==_0x2a5670(0x1d7)){const _0x448869=await staff[_0x2a5670(0x220)]({'email':_0x3f2d22[_0x2a5670(0x227)]});_0x25c70f=await warehouse[_0x2a5670(0x208)]([{'$match':{'status':_0x2a5670(0x1f5),'name':_0x448869[_0x2a5670(0x19c)],'warehouse_category':_0x2a5670(0x1b2),'name':{'$ne':_0x2a5670(0x195)}}},{'$group':{'_id':'$name','name':{'$first':_0x2a5670(0x164)}}},{'$sort':{'name':0x1}}]);}else _0x25c70f=await warehouse[_0x2a5670(0x208)]([{'$match':{'status':_0x2a5670(0x1f5),'warehouse_category':_0x2a5670(0x1b2),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2a5670(0x164),'name':{'$first':_0x2a5670(0x164)}}},{'$sort':{'name':0x1}}]);const _0xbf9275=await product['find']({});var _0x1a1eb4=[_0x2a5670(0x225),'Enclosed'];const _0x39294d=await sales['find']({}),_0x2160e5=_0x39294d[_0x2a5670(0x1be)]+0x1,_0x328226=_0x2a5670(0x1d5)+_0x2160e5['toString']()[_0x2a5670(0x20a)](0x5,'0');if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x1f6)){var _0x1da04b=users['English'];console['log'](_0x1da04b);}else{if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x1a0))var _0x1da04b=users[_0x2a5670(0x1a0)];else{if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x188))var _0x1da04b=users[_0x2a5670(0x188)];else{if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x1dc))var _0x1da04b=users[_0x2a5670(0x1dc)];else{if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x1c7))var _0x1da04b=users['French'];else{if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x1ad))var _0x1da04b=users[_0x2a5670(0x244)];else{if(_0x33f757[0x0][_0x2a5670(0x211)]==_0x2a5670(0x23a))var _0x1da04b=users['Chinese'];else{if(_0x33f757[0x0]['language']==_0x2a5670(0x22a))var _0x1da04b=users['Arabic'];}}}}}}}const _0x2f8bf3=getRandom8DigitNumber();_0x2f8bf3[_0x2a5670(0x247)](_0x6c3a6b=>{var _0x501e21=_0x2a5670;_0x5fb181['render']('add_sales',{'success':_0x2ba4e4[_0x501e21(0x250)](_0x501e21(0x18c)),'errors':_0x2ba4e4[_0x501e21(0x250)](_0x501e21(0x16f)),'role':_0x3f2d22,'profile':_0x518165,'customer':_0x33046b,'warehouse':_0x25c70f,'product':_0xbf9275,'invoice':_0x6c3a6b,'master_shop':_0x33f757,'language':_0x1da04b,'rooms_data':_0x1a1eb4});})['catch'](_0x1f9ae0=>{var _0x533533=_0x2a5670;_0x2ba4e4[_0x533533(0x250)](_0x533533(0x16f),_0x533533(0x17b)),_0x5fb181[_0x533533(0x251)]('/all_sales/view');});}catch(_0x51e530){console[_0x2a5670(0x222)](_0x51e530);}}),router['get'](a0_0x357d96(0x15e),auth,async(_0xc685da,_0x108092)=>{var _0x3cb066=a0_0x357d96;try{const _0x2fe3d0=_0xc685da[_0x3cb066(0x16c)]['id'];console[_0x3cb066(0x222)](_0x2fe3d0);const _0x5f2d9c=await product[_0x3cb066(0x210)](),_0x1a2aab=await purchases[_0x3cb066(0x208)]([{'$match':{'warehouse_name':_0x2fe3d0}},{'$unwind':_0x3cb066(0x186)},{'$group':{'_id':'$product.product_name'}}]);console[_0x3cb066(0x222)](_0x3cb066(0x216),_0x1a2aab),_0x108092[_0x3cb066(0x1c6)](0xc8)[_0x3cb066(0x1bd)]({'purchases_data':_0x1a2aab,'product_data':_0x5f2d9c});}catch(_0x5c20a3){console[_0x3cb066(0x222)](_0x5c20a3);}}),router[a0_0x357d96(0x23c)](a0_0x357d96(0x24e),auth,async(_0x124177,_0x1d017a)=>{var _0x5a7d3e=a0_0x357d96;try{const {warehouse_data:_0xf6608c,product_data:_0xf5437b}=_0x124177[_0x5a7d3e(0x1d2)];console['log'](_0x124177[_0x5a7d3e(0x1d2)][_0x5a7d3e(0x173)]);;const _0x45482d=await master_shop[_0x5a7d3e(0x210)]();console['log'](_0x5a7d3e(0x1fd),_0x45482d);const _0x1d4169=await product[_0x5a7d3e(0x220)]({'name':_0xf5437b});console[_0x5a7d3e(0x222)]('product',_0x1d4169);const _0x5b7eb3=await warehouse[_0x5a7d3e(0x208)]([{'$match':{'name':_0xf6608c}},{'$unwind':_0x5a7d3e(0x242)},{'$match':{'product_details.product_name':_0xf5437b}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x5a7d3e(0x222)](_0x5a7d3e(0x1b8),_0x5b7eb3),_0x1d017a[_0x5a7d3e(0x1c6)](0xc8)[_0x5a7d3e(0x1bd)]({'master':_0x45482d,'new_product':_0x1d4169,'stock_data':_0x5b7eb3});}catch(_0x5a7aa0){console[_0x5a7d3e(0x222)](_0x5a7aa0);}}),router[a0_0x357d96(0x23c)](a0_0x357d96(0x20d),auth,async(_0x552e4c,_0x416424)=>{var _0x562ae2=a0_0x357d96;try{const {invoice:_0x2a36f8,date:_0x264974,warehouse_name:_0x550243,product_name:_0x5547ae,stock:_0x5724ba,quantity:_0x444f29,note:_0x489e63,room:_0x336286,primary_code:_0xfb0f0b,secondary_code:_0xa72133,prod_code:_0x5d06f7,level:_0x51e395,isle:_0xa50ec6,pallet:_0x275345,batch_code:_0x32ba93,SCRN:_0x45240b,expiry_date:_0x116a00}=_0x552e4c['body'];if(typeof _0x5547ae=='string')var _0x5dff05=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1af)]],_0x2d0a4f=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x19f)]],_0x1094c3=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1e2)]],_0x2c4e55=[_0x552e4c['body'][_0x562ae2(0x193)]],_0x157799=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x16d)]],_0x14f964=[_0x552e4c['body'][_0x562ae2(0x175)]],_0x44d98b=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1c1)]],_0x2f71b1=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x19a)]],_0x23bbcc=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1cf)]],_0x4f520e=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x238)]],_0x927bd=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1e1)]],_0x8adcaf=[_0x552e4c['body'][_0x562ae2(0x1a4)]],_0xf5642c=[_0x552e4c['body'][_0x562ae2(0x1ab)]],_0x1d4f56=[_0x552e4c['body']['requested_qty']],_0x2d5cdc=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x22e)]],_0x4ce124=[_0x552e4c['body']['delivery_code']],_0x297b87=[_0x552e4c['body'][_0x562ae2(0x15d)]],_0x2a59ff=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x259)]],_0x2df198=[_0x552e4c[_0x562ae2(0x1d2)]['RoomAssigned']],_0x5c736d=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x21d)]],_0x336cfb=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1e4)]],_0x5ee7c2=[_0x552e4c['body'][_0x562ae2(0x179)]],_0xa3ba23=[_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x161)]];else var _0x5dff05=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1af)]],_0x2d0a4f=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x19f)]],_0x1094c3=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1e2)]],_0x2c4e55=[..._0x552e4c['body']['primary_code']],_0x157799=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x16d)]],_0x14f964=[..._0x552e4c[_0x562ae2(0x1d2)]['prod_code']],_0x44d98b=[..._0x552e4c[_0x562ae2(0x1d2)]['level']],_0x2f71b1=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x19a)]],_0x23bbcc=[..._0x552e4c[_0x562ae2(0x1d2)]['secondary_unit']],_0x4f520e=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x238)]],_0x927bd=[..._0x552e4c[_0x562ae2(0x1d2)]['expiry_date']],_0x8adcaf=[..._0x552e4c['body'][_0x562ae2(0x1a4)]],_0xf5642c=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1ab)]],_0x1d4f56=[..._0x552e4c[_0x562ae2(0x1d2)]['requested_qty']],_0x2d5cdc=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x22e)]],_0x4ce124=[..._0x552e4c['body'][_0x562ae2(0x1e5)]],_0x297b87=[..._0x552e4c['body'][_0x562ae2(0x15d)]],_0x2a59ff=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x259)]],_0x2df198=[..._0x552e4c['body']['RoomAssigned']],_0x5c736d=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x21d)]],_0x336cfb=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x1e4)]],_0x5ee7c2=[..._0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x179)]],_0xa3ba23=[..._0x552e4c[_0x562ae2(0x1d2)]['id_transact']];const _0x6b790a=_0x5dff05[_0x562ae2(0x15a)](_0x4878bb=>{return _0x4878bb={'product_name':_0x4878bb};});_0x2d0a4f[_0x562ae2(0x167)]((_0x33d755,_0x24fc01)=>{var _0x3837f7=_0x562ae2;_0x6b790a[_0x24fc01][_0x3837f7(0x19f)]=Math[_0x3837f7(0x245)](_0x33d755);}),_0x336cfb[_0x562ae2(0x167)]((_0x2084b8,_0x4c7bef)=>{var _0x23dfbb=_0x562ae2;_0x6b790a[_0x4c7bef][_0x23dfbb(0x1e4)]=Math['abs'](_0x2084b8);}),_0x5ee7c2[_0x562ae2(0x167)]((_0x155f30,_0x12909d)=>{var _0x32dafb=_0x562ae2;_0x6b790a[_0x12909d][_0x32dafb(0x179)]=_0x155f30;}),_0xa3ba23['forEach']((_0x522b66,_0x385882)=>{var _0x39a6ab=_0x562ae2;_0x6b790a[_0x385882][_0x39a6ab(0x192)]=_0x522b66;}),_0x1094c3[_0x562ae2(0x167)]((_0xdd38a0,_0xca5873)=>{var _0x49f2b2=_0x562ae2;_0x6b790a[_0xca5873][_0x49f2b2(0x259)]=_0xdd38a0;}),_0x2c4e55['forEach']((_0x10a648,_0x10d0e7)=>{var _0x328cfc=_0x562ae2;_0x6b790a[_0x10d0e7][_0x328cfc(0x193)]=_0x10a648;}),_0x157799[_0x562ae2(0x167)]((_0x2154f0,_0x124da1)=>{var _0x14cacc=_0x562ae2;_0x6b790a[_0x124da1][_0x14cacc(0x16d)]=_0x2154f0;}),_0x14f964[_0x562ae2(0x167)]((_0x196fa8,_0x5586b2)=>{var _0x580c17=_0x562ae2;_0x6b790a[_0x5586b2][_0x580c17(0x196)]=_0x196fa8;}),_0x44d98b[_0x562ae2(0x167)]((_0x57ade4,_0xfffa85)=>{_0x2df198['forEach']((_0x46b491,_0x27cd4d)=>{var _0x5db03e=a0_0x4336;if(_0x46b491==_0x5db03e(0x1ca)&&_0xfffa85==_0x27cd4d){var _0xa5c8e3=_0x57ade4[_0x5db03e(0x1f0)](0x3);_0x6b790a[_0xfffa85][_0x5db03e(0x187)]=_0x57ade4[0x0],_0x6b790a[_0xfffa85][_0x5db03e(0x1b9)]=_0x57ade4[0x1],_0x6b790a[_0xfffa85][_0x5db03e(0x1a9)]=0x0,_0x6b790a[_0xfffa85][_0x5db03e(0x20b)]=0x0,_0x6b790a[_0xfffa85]['type']=_0x5db03e(0x1db),_0x6b790a[_0xfffa85][_0x5db03e(0x1fc)]=_0xa5c8e3;}else{if(_0x46b491==_0x5db03e(0x156)&&_0xfffa85==_0x27cd4d){var _0xa5c8e3=_0x57ade4[_0x5db03e(0x1f0)](0x3);_0x6b790a[_0xfffa85]['storage']=_0x57ade4[0x0],_0x6b790a[_0xfffa85]['rack']=_0x57ade4[0x1],_0x6b790a[_0xfffa85][_0x5db03e(0x1a9)]=0x0,_0x6b790a[_0xfffa85]['bin']=0x0,_0x6b790a[_0xfffa85][_0x5db03e(0x15b)]=_0x5db03e(0x1db),_0x6b790a[_0xfffa85]['floorlevel']=_0x57ade4[0x5];}else{if(_0xfffa85==_0x27cd4d){var _0x1c6d2c;if(_0x57ade4[0x4]=='L')_0x1c6d2c=_0x5db03e(0x19e);else _0x57ade4[0x4]=='F'&&(_0x1c6d2c=_0x5db03e(0x1db));_0x6b790a[_0xfffa85]['storage']=_0x57ade4[0x0],_0x6b790a[_0xfffa85][_0x5db03e(0x1b9)]=_0x57ade4[0x1],_0x6b790a[_0xfffa85][_0x5db03e(0x1a9)]=_0x57ade4[0x2],_0x6b790a[_0xfffa85][_0x5db03e(0x20b)]=_0x57ade4[0x3],_0x6b790a[_0xfffa85][_0x5db03e(0x15b)]=_0x1c6d2c,_0x6b790a[_0xfffa85][_0x5db03e(0x1fc)]=_0x57ade4[0x5];}}}});}),_0x2f71b1[_0x562ae2(0x167)]((_0x13524c,_0x7e657f)=>{_0x6b790a[_0x7e657f]['unit']=_0x13524c;}),_0x23bbcc[_0x562ae2(0x167)]((_0x1f8021,_0x45cb64)=>{_0x6b790a[_0x45cb64]['secondary_unit']=_0x1f8021;}),_0x4f520e[_0x562ae2(0x167)]((_0x3ce59b,_0x11e660)=>{var _0x525434=_0x562ae2;_0x6b790a[_0x11e660][_0x525434(0x238)]=_0x3ce59b;}),_0x927bd[_0x562ae2(0x167)]((_0x25d4da,_0x213f51)=>{_0x6b790a[_0x213f51]['expiry_date']=_0x25d4da;}),_0x8adcaf[_0x562ae2(0x167)]((_0xd63065,_0x48ab09)=>{var _0x5d470c=_0x562ae2;_0x6b790a[_0x48ab09][_0x5d470c(0x19b)]=_0xd63065;}),_0xf5642c['forEach']((_0x254225,_0x4b98ce)=>{var _0x2d64f4=_0x562ae2;_0x6b790a[_0x4b98ce][_0x2d64f4(0x1ab)]=_0x254225;}),_0x1d4f56[_0x562ae2(0x167)]((_0x5ca31f,_0x1e9cd4)=>{var _0x46ac=_0x562ae2;_0x6b790a[_0x1e9cd4][_0x46ac(0x224)]=_0x5ca31f;}),_0x2d5cdc[_0x562ae2(0x167)]((_0x4cef84,_0x188d79)=>{var _0x355c2a=_0x562ae2;_0x6b790a[_0x188d79][_0x355c2a(0x22e)]=_0x4cef84;}),_0x4ce124[_0x562ae2(0x167)]((_0x8f8c1f,_0x3e8927)=>{var _0x2f93e6=_0x562ae2;_0x6b790a[_0x3e8927][_0x2f93e6(0x1e5)]=_0x8f8c1f;}),_0x297b87['forEach']((_0x120ccb,_0x2bbf21)=>{var _0x120b57=_0x562ae2;_0x6b790a[_0x2bbf21][_0x120b57(0x15d)]=_0x120ccb;}),_0x2a59ff[_0x562ae2(0x167)]((_0x4e41f1,_0x2fdffb)=>{var _0x3454a3=_0x562ae2;_0x6b790a[_0x2fdffb][_0x3454a3(0x1cc)]=_0x4e41f1;}),_0x2df198[_0x562ae2(0x167)]((_0x568a8b,_0x19515a)=>{_0x6b790a[_0x19515a]['room_name']=_0x568a8b;}),_0x5c736d[_0x562ae2(0x167)]((_0x582100,_0x4d655a)=>{var _0xbf39c4=_0x562ae2;_0x6b790a[_0x4d655a][_0xbf39c4(0x239)]=_0x582100;});var _0x125fcb=0x0;_0x6b790a[_0x562ae2(0x167)](_0xc16809=>{var _0x2e15b0=_0x562ae2;(_0xc16809[_0x2e15b0(0x19f)]<_0xc16809[_0x2e15b0(0x1cc)]||_0xc16809[_0x2e15b0(0x1cc)]==0x0)&&(console[_0x2e15b0(0x222)]('foreach\x20newproduct',_0xc16809),_0x125fcb++);});const _0x378034=_0x6b790a['filter'](_0x2a98c0=>_0x2a98c0[_0x562ae2(0x259)]!=='0'&&_0x2a98c0[_0x562ae2(0x259)]!==''),_0x149706=new sales({'invoice':_0x2a36f8,'customer':_0x552e4c[_0x562ae2(0x1d2)][_0x562ae2(0x221)],'date':_0x264974,'warehouse_name':_0x550243,'sale_product':_0x378034,'note':_0x489e63,'room':_0x336286,'primary_code':_0xfb0f0b,'secondary_code':_0xa72133,'prod_code':_0x5d06f7,'SCRN':_0x45240b}),_0x501c19=await _0x149706['save']();_0x552e4c['flash'](_0x562ae2(0x18c),_0x562ae2(0x21b)),_0x416424[_0x562ae2(0x251)](_0x562ae2(0x1ba)+_0x501c19[_0x562ae2(0x159)]);}catch(_0x3f4d9e){console[_0x562ae2(0x222)](_0x3f4d9e);}}),router['get'](a0_0x357d96(0x18f),auth,async(_0x4b0799,_0x334d9d)=>{var _0x36d13d=a0_0x357d96;try{const {username:_0x42aaaa,email:_0x2cd44e,role:_0x37edc4}=_0x4b0799['user'],_0x122b30=_0x4b0799[_0x36d13d(0x1b5)],_0x48eab2=await profile[_0x36d13d(0x220)]({'email':_0x122b30[_0x36d13d(0x227)]}),_0x417338=await master_shop[_0x36d13d(0x210)](),_0x49fef0=_0x4b0799[_0x36d13d(0x16c)]['id'],_0x34ff71=await sales['findById'](_0x49fef0),_0x2cc23e=await warehouse[_0x36d13d(0x208)]([{'$match':{'name':_0x34ff71[_0x36d13d(0x1b6)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x36d13d(0x248),'name':{'$first':_0x36d13d(0x1c4)},'product_stock':{'$first':_0x36d13d(0x1e8)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x36d13d(0x1ff)},'type':{'$first':_0x36d13d(0x169)},'floorlevel':{'$first':_0x36d13d(0x252)},'primary_code':{'$first':_0x36d13d(0x23d)},'secondary_code':{'$first':_0x36d13d(0x1ed)},'product_code':{'$first':_0x36d13d(0x217)},'storage':{'$first':_0x36d13d(0x1ee)},'rack':{'$first':_0x36d13d(0x1f2)},'expiry_date':{'$first':_0x36d13d(0x219)},'production_date':{'$first':_0x36d13d(0x1c0)},'invoice':{'$first':_0x36d13d(0x1d3)}}}]),_0x1b5abe=await customer[_0x36d13d(0x210)]({});let _0x15465e;if(_0x122b30[_0x36d13d(0x1d0)]==_0x36d13d(0x1d7)){const _0x5f1c0a=await staff[_0x36d13d(0x220)]({'email':_0x122b30[_0x36d13d(0x227)]});_0x15465e=await warehouse[_0x36d13d(0x208)]([{'$match':{'status':'Enabled','name':_0x5f1c0a[_0x36d13d(0x19c)]}},{'$group':{'_id':_0x36d13d(0x164),'name':{'$first':_0x36d13d(0x164)}}}]);}else _0x15465e=await warehouse[_0x36d13d(0x208)]([{'$match':{'status':_0x36d13d(0x1f5)}},{'$group':{'_id':'$name','name':{'$first':_0x36d13d(0x164)}}}]);const _0x4c10b2=await product['find']({}),_0xed3c99=await suppliers['find']({});if(_0x417338[0x0][_0x36d13d(0x211)]==_0x36d13d(0x1f6)){var _0x4eb927=users[_0x36d13d(0x229)];console['log'](_0x4eb927);}else{if(_0x417338[0x0][_0x36d13d(0x211)]==_0x36d13d(0x1a0))var _0x4eb927=users[_0x36d13d(0x1a0)];else{if(_0x417338[0x0]['language']==_0x36d13d(0x188))var _0x4eb927=users[_0x36d13d(0x188)];else{if(_0x417338[0x0][_0x36d13d(0x211)]==_0x36d13d(0x1dc))var _0x4eb927=users['Spanish'];else{if(_0x417338[0x0]['language']==_0x36d13d(0x1c7))var _0x4eb927=users[_0x36d13d(0x1c7)];else{if(_0x417338[0x0]['language']==_0x36d13d(0x1ad))var _0x4eb927=users[_0x36d13d(0x244)];else{if(_0x417338[0x0][_0x36d13d(0x211)]==_0x36d13d(0x23a))var _0x4eb927=users[_0x36d13d(0x23a)];else{if(_0x417338[0x0][_0x36d13d(0x211)]==_0x36d13d(0x22a))var _0x4eb927=users[_0x36d13d(0x21e)];}}}}}}}_0x334d9d[_0x36d13d(0x15c)](_0x36d13d(0x171),{'success':_0x4b0799[_0x36d13d(0x250)]('success'),'errors':_0x4b0799[_0x36d13d(0x250)](_0x36d13d(0x16f)),'role':_0x122b30,'profile':_0x48eab2,'customer':_0x1b5abe,'warehouse':_0x15465e,'product':_0x2cc23e,'user':_0x34ff71,'master_shop':_0x417338,'unit':_0x4c10b2,'language':_0x4eb927,'suppliers':_0xed3c99});}catch(_0x5d4cb4){console[_0x36d13d(0x222)](_0x5d4cb4);}}),router[a0_0x357d96(0x23c)](a0_0x357d96(0x18f),auth,async(_0x591366,_0x17acb9)=>{var _0x201ac7=a0_0x357d96;try{const _0x13ed82=_0x591366[_0x201ac7(0x16c)]['id'],{invoice:_0x5370cf,warehouse_name:_0x2f2511,room:_0xceeff9}=_0x591366[_0x201ac7(0x1d2)],_0x5eb9b2=await sales[_0x201ac7(0x220)]({'invoice':_0x5370cf}),_0xcbf9f5=_0x5eb9b2['sale_product'][_0x201ac7(0x15a)](async _0x34d428=>{var _0x5ae56c=_0x201ac7,_0x42cef4=await warehouse[_0x5ae56c(0x220)]({'name':_0x2f2511,'room':_0x34d428[_0x5ae56c(0x20f)],'warehouse_category':_0x5ae56c(0x1b2)});const _0x8658b5=_0x42cef4[_0x5ae56c(0x1cd)]['map'](_0x2da848=>{var _0x1fcc63=_0x5ae56c;_0x2da848[_0x1fcc63(0x1af)]==_0x34d428[_0x1fcc63(0x1af)]&&_0x2da848[_0x1fcc63(0x1fc)]==_0x34d428[_0x1fcc63(0x1fc)]&&_0x2da848[_0x1fcc63(0x15b)]==_0x34d428['type']&&_0x2da848['bin']==_0x34d428[_0x1fcc63(0x20b)]&&_0x2da848[_0x1fcc63(0x1a9)]==_0x34d428[_0x1fcc63(0x1a9)]&&_0x2da848[_0x1fcc63(0x1b9)]==_0x34d428[_0x1fcc63(0x1b9)]&&_0x2da848[_0x1fcc63(0x187)]==_0x34d428[_0x1fcc63(0x187)]&&_0x2da848[_0x1fcc63(0x1e1)]==_0x34d428['expiry_date']&&_0x2da848[_0x1fcc63(0x238)]==_0x34d428[_0x1fcc63(0x238)]&&_0x2da848[_0x1fcc63(0x239)]==_0x34d428['invoice']&&_0x2da848[_0x1fcc63(0x159)]==_0x34d428['id_transaction_from']&&(_0x2da848[_0x1fcc63(0x25b)]=Math[_0x1fcc63(0x197)](0x0,Math[_0x1fcc63(0x245)](_0x2da848[_0x1fcc63(0x25b)])-Math[_0x1fcc63(0x245)](_0x34d428[_0x1fcc63(0x259)])));});return _0x42cef4;});Promise[_0x201ac7(0x24f)](_0xcbf9f5)[_0x201ac7(0x247)](async _0x15b664=>{var _0xeb3980=_0x201ac7;try{for(const _0x153c15 of _0x15b664){await _0x153c15['save']();}_0x5eb9b2[_0xeb3980(0x23b)]='True';const _0x3198e2=await _0x5eb9b2[_0xeb3980(0x1eb)](),_0xb433f2=await master_shop['find'](),_0x562791=await email_settings['findOne'](),_0x47afb8=await supervisor_settings[_0xeb3980(0x210)]();var _0x39373b=_0x5eb9b2[_0xeb3980(0x17f)],_0x330fc9='',_0xf919fe;for(_0xf919fe in _0x39373b){_0x330fc9+='<tr>'+_0xeb3980(0x257)+_0x39373b[_0xf919fe][_0xeb3980(0x1af)]+'</td>'+_0xeb3980(0x257)+_0x39373b[_0xf919fe][_0xeb3980(0x196)]+_0xeb3980(0x204)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x39373b[_0xf919fe][_0xeb3980(0x259)]+_0xeb3980(0x204)+_0xeb3980(0x257)+_0x39373b[_0xf919fe][_0xeb3980(0x1d1)]+_0xeb3980(0x204)+_0xeb3980(0x257)+_0x39373b[_0xf919fe][_0xeb3980(0x1cf)]+_0xeb3980(0x204)+_0xeb3980(0x257)+_0x5eb9b2[_0xeb3980(0x1b6)]+_0xeb3980(0x204)+_0xeb3980(0x257)+_0x39373b[_0xf919fe][_0xeb3980(0x20f)]+_0xeb3980(0x204)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x39373b[_0xf919fe][_0xeb3980(0x187)]+_0x39373b[_0xf919fe]['rack']+_0x39373b[_0xf919fe]['bay']+_0x39373b[_0xf919fe][_0xeb3980(0x20b)]+_0x39373b[_0xf919fe]['type'][0x0]+_0x39373b[_0xf919fe]['floorlevel']+_0xeb3980(0x204),_0xeb3980(0x237);}let _0xf04ab7=nodemailer['createTransport']({'host':_0x562791[_0xeb3980(0x201)],'port':Number(_0x562791['port']),'secure':![],'auth':{'user':_0x562791[_0xeb3980(0x227)],'pass':_0x562791['password']}}),_0x2681bf={'from':_0x562791[_0xeb3980(0x227)],'to':_0x47afb8[0x0][_0xeb3980(0x1c3)],'subject':_0xeb3980(0x24a),'attachments':[{'filename':_0xeb3980(0x199),'path':__dirname+'/../public'+_0xeb3980(0x24c)+_0xb433f2[0x0]['image'],'cid':_0xeb3980(0x1bc)}],'html':_0xeb3980(0x1f4)+'<html><head><title></title>'+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xeb3980(0x228)+_0xeb3980(0x209)+_0xeb3980(0x25e)+_0xeb3980(0x228)+_0xeb3980(0x1d6)+_0xb433f2[0x0]['site_title']+'\x20</h2>'+_0xeb3980(0x25e)+_0xeb3980(0x25e)+_0xeb3980(0x157)+_0xeb3980(0x228)+_0xeb3980(0x180)+_0xeb3980(0x185)+_0x5eb9b2[_0xeb3980(0x239)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xeb3980(0x1d9)+_0x5eb9b2[_0xeb3980(0x1bb)]+'\x20'+'</span>'+_0xeb3980(0x1fe)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xeb3980(0x226)+_0xeb3980(0x198)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0xeb3980(0x182)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0xeb3980(0x1fb)+_0xeb3980(0x16e)+_0xeb3980(0x21c)+_0xeb3980(0x237)+_0xeb3980(0x202)+_0xeb3980(0x17d)+'\x20'+_0x330fc9+'\x20'+_0xeb3980(0x214)+_0xeb3980(0x1ce)+_0xeb3980(0x228)+_0xeb3980(0x183)+_0xeb3980(0x240)+_0xb433f2[0x0][_0xeb3980(0x165)]+_0xeb3980(0x1fe)+_0xeb3980(0x25e)+_0xeb3980(0x25e)+_0xeb3980(0x18a)};_0xf04ab7[_0xeb3980(0x22f)](_0x2681bf,function(_0xdd2b15,_0x42e409){var _0x48e886=_0xeb3980;_0xdd2b15?(console[_0x48e886(0x222)](_0xdd2b15),console[_0x48e886(0x222)](_0x48e886(0x212))):console['log']('Email\x20sent\x20successfully');}),_0x591366['flash']('success','Sales\x20Update\x20successfully'),_0x17acb9[_0xeb3980(0x251)](_0xeb3980(0x1ba)+_0x13ed82);}catch(_0x3c1e45){console[_0xeb3980(0x1f1)](_0x3c1e45),_0x17acb9[_0xeb3980(0x1c6)](0x1f4)[_0xeb3980(0x1bd)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x201ac7(0x230)](_0x227d29=>{var _0x3503e7=_0x201ac7;console['error'](_0x227d29),_0x17acb9[_0x3503e7(0x1c6)](0x1f4)[_0x3503e7(0x1bd)]({'error':_0x3503e7(0x1e7)});});}catch(_0x4e51de){console[_0x201ac7(0x222)](_0x4e51de);}}),router[a0_0x357d96(0x177)](a0_0x357d96(0x1f3),auth,async(_0x5392a8,_0xd4108f)=>{var _0x1180c1=a0_0x357d96;try{const {username:_0x29f8eb,email:_0x586278,role:_0x4c0ea3}=_0x5392a8[_0x1180c1(0x1b5)],_0x372874=_0x5392a8[_0x1180c1(0x1b5)],_0xe6ae04=await profile['findOne']({'email':_0x372874[_0x1180c1(0x227)]}),_0x2372f4=await master_shop['find'](),_0x443b2c=_0x5392a8[_0x1180c1(0x16c)]['id'],_0x5b1df4=await sales[_0x1180c1(0x22d)](_0x443b2c);var _0x3af773=[_0x1180c1(0x225),'Enclosed'];const _0x1e2b55=await warehouse[_0x1180c1(0x208)]([{'$match':{'name':_0x5b1df4['warehouse_name'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x1180c1(0x242)},{'$group':{'_id':_0x1180c1(0x248),'name':{'$first':_0x1180c1(0x1c4)},'product_stock':{'$first':_0x1180c1(0x1e8)},'bay':{'$first':_0x1180c1(0x181)},'bin':{'$first':_0x1180c1(0x1ff)},'type':{'$first':_0x1180c1(0x169)},'floorlevel':{'$first':_0x1180c1(0x252)},'primary_code':{'$first':_0x1180c1(0x23d)},'secondary_code':{'$first':_0x1180c1(0x1ed)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1180c1(0x1ee)},'rack':{'$first':_0x1180c1(0x1f2)}}}]),_0x501f12=await customer[_0x1180c1(0x210)]({});let _0x544189;if(_0x372874[_0x1180c1(0x1d0)]==_0x1180c1(0x1d7)){const _0x5c1ea1=await staff[_0x1180c1(0x220)]({'email':_0x372874[_0x1180c1(0x227)]});_0x544189=await warehouse['aggregate']([{'$match':{'status':_0x1180c1(0x1f5),'name':_0x5c1ea1['warehouse'],'warehouse_category':_0x1180c1(0x1b2)}},{'$group':{'_id':_0x1180c1(0x164),'name':{'$first':_0x1180c1(0x164)}}}]);}else _0x544189=await warehouse[_0x1180c1(0x208)]([{'$match':{'status':'Enabled','warehouse_category':_0x1180c1(0x1b2)}},{'$group':{'_id':'$name','name':{'$first':_0x1180c1(0x164)}}}]);const _0x5bbd57=await product[_0x1180c1(0x210)]({});if(_0x2372f4[0x0][_0x1180c1(0x211)]==_0x1180c1(0x1f6)){var _0x46c0ec=users[_0x1180c1(0x229)];console['log'](_0x46c0ec);}else{if(_0x2372f4[0x0][_0x1180c1(0x211)]==_0x1180c1(0x1a0))var _0x46c0ec=users[_0x1180c1(0x1a0)];else{if(_0x2372f4[0x0]['language']==_0x1180c1(0x188))var _0x46c0ec=users[_0x1180c1(0x188)];else{if(_0x2372f4[0x0][_0x1180c1(0x211)]=='Spanish')var _0x46c0ec=users[_0x1180c1(0x1dc)];else{if(_0x2372f4[0x0][_0x1180c1(0x211)]=='French')var _0x46c0ec=users[_0x1180c1(0x1c7)];else{if(_0x2372f4[0x0][_0x1180c1(0x211)]==_0x1180c1(0x1ad))var _0x46c0ec=users[_0x1180c1(0x244)];else{if(_0x2372f4[0x0][_0x1180c1(0x211)]==_0x1180c1(0x23a))var _0x46c0ec=users[_0x1180c1(0x23a)];else{if(_0x2372f4[0x0][_0x1180c1(0x211)]==_0x1180c1(0x22a))var _0x46c0ec=users[_0x1180c1(0x21e)];}}}}}}}_0xd4108f[_0x1180c1(0x15c)]('edit_sales',{'success':_0x5392a8[_0x1180c1(0x250)]('success'),'errors':_0x5392a8[_0x1180c1(0x250)](_0x1180c1(0x16f)),'role':_0x372874,'profile':_0xe6ae04,'customer':_0x501f12,'warehouse':_0x544189,'product':_0x1e2b55,'user':_0x5b1df4,'master_shop':_0x2372f4,'unit':_0x5bbd57,'language':_0x46c0ec});}catch(_0x2af000){console['log'](_0x2af000);}}),router['post'](a0_0x357d96(0x1f3),auth,async(_0x402a82,_0x43a35d)=>{var _0x345679=a0_0x357d96;try{const _0x57cf94=_0x402a82[_0x345679(0x16c)]['id'],_0xeb1bbd=await sales[_0x345679(0x220)]({'_id':_0x402a82[_0x345679(0x16c)]['id']}),_0x543f2b=await warehouse['findOne']({'name':_0xeb1bbd[_0x345679(0x1b6)],'room':_0x402a82['body'][_0x345679(0x160)]}),{invoice:_0x3bdba6,date:_0x51484a,warehouse_name:_0x4803f3,product_name:_0x191dee,stock:_0x2d1d2d,quantity:_0x375e77,note:_0x2f2430,room:_0x752f06,customer:_0x503c2f,SCRN:_0x4ebb33}=_0x402a82['body'];if(typeof _0x191dee==_0x345679(0x234))var _0x285451=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x1af)]],_0x3141cc=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x19f)]],_0x11f9db=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x1e2)]],_0x32f3d8=[_0x402a82['body'][_0x345679(0x193)]],_0x5280e2=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x16d)]],_0x2c55fd=[_0x402a82['body'][_0x345679(0x175)]],_0x1a2739=[_0x402a82['body'][_0x345679(0x1c1)]],_0x25d7b1=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x19a)]],_0x3b4cc1=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x1cf)]],_0x23056a=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x238)]],_0x399dd7=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x1e1)]],_0xbb44d8=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x1a4)]],_0x515a54=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x1ab)]],_0x44f149=[_0x402a82['body']['requested_qty']],_0x2cb179=[_0x402a82['body'][_0x345679(0x22e)]],_0x3d57b1=[_0x402a82[_0x345679(0x1d2)]['delivery_code']],_0x187e4a=[_0x402a82[_0x345679(0x1d2)]['prod_cat']],_0x4ac55c=[_0x402a82[_0x345679(0x1d2)]['quantity']],_0x5a45d0=[_0x402a82[_0x345679(0x1d2)][_0x345679(0x17e)]];else var _0x285451=[..._0x402a82[_0x345679(0x1d2)]['product_name']],_0x3141cc=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x19f)]],_0x11f9db=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x1e2)]],_0x32f3d8=[..._0x402a82['body'][_0x345679(0x193)]],_0x5280e2=[..._0x402a82['body'][_0x345679(0x16d)]],_0x2c55fd=[..._0x402a82['body']['prod_code']],_0x1a2739=[..._0x402a82[_0x345679(0x1d2)]['level']],_0x25d7b1=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x19a)]],_0x3b4cc1=[..._0x402a82[_0x345679(0x1d2)]['secondary_unit']],_0x23056a=[..._0x402a82[_0x345679(0x1d2)]['batch_code']],_0x399dd7=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x1e1)]],_0xbb44d8=[..._0x402a82[_0x345679(0x1d2)]['max_per_unit']],_0x515a54=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x1ab)]],_0x44f149=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x224)]],_0x2cb179=[..._0x402a82[_0x345679(0x1d2)]['delivery_date']],_0x3d57b1=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x1e5)]],_0x187e4a=[..._0x402a82['body'][_0x345679(0x15d)]],_0x4ac55c=[..._0x402a82[_0x345679(0x1d2)][_0x345679(0x259)]],_0x5a45d0=[..._0x402a82[_0x345679(0x1d2)]['RoomAssigned']];const _0x53ed04=_0x285451[_0x345679(0x15a)](_0x24a4e2=>{return _0x24a4e2={'product_name':_0x24a4e2};});_0x3141cc[_0x345679(0x167)]((_0x114667,_0x30883c)=>{var _0xc2445c=_0x345679;_0x53ed04[_0x30883c][_0xc2445c(0x19f)]=Math[_0xc2445c(0x245)](_0x114667);}),_0x11f9db[_0x345679(0x167)]((_0x179fe0,_0x5994c4)=>{var _0x39b241=_0x345679;_0x53ed04[_0x5994c4][_0x39b241(0x259)]=_0x179fe0;}),_0x32f3d8['forEach']((_0x238634,_0x59ca16)=>{var _0x1ee651=_0x345679;_0x53ed04[_0x59ca16][_0x1ee651(0x193)]=_0x238634;}),_0x5280e2[_0x345679(0x167)]((_0xf9f3f9,_0x13e02d)=>{_0x53ed04[_0x13e02d]['secondary_code']=_0xf9f3f9;}),_0x2c55fd[_0x345679(0x167)]((_0x534def,_0x76324c)=>{var _0x2d5d2c=_0x345679;_0x53ed04[_0x76324c][_0x2d5d2c(0x196)]=_0x534def;}),_0x1a2739[_0x345679(0x167)]((_0x132bc1,_0x10f3ff)=>{var _0x5d9425=_0x345679;_0x5a45d0[_0x5d9425(0x167)]((_0x1084e6,_0x55411e)=>{var _0x5b8977=_0x5d9425;if(_0x1084e6==_0x5b8977(0x1ca)&&_0x10f3ff==_0x55411e){var _0x47be98=_0x132bc1[_0x5b8977(0x1f0)](0x3);_0x53ed04[_0x10f3ff][_0x5b8977(0x187)]=_0x132bc1[0x0],_0x53ed04[_0x10f3ff][_0x5b8977(0x1b9)]=_0x132bc1[0x1],_0x53ed04[_0x10f3ff]['bay']=0x0,_0x53ed04[_0x10f3ff][_0x5b8977(0x20b)]=0x0,_0x53ed04[_0x10f3ff][_0x5b8977(0x15b)]=_0x5b8977(0x1db),_0x53ed04[_0x10f3ff]['floorlevel']=_0x47be98;}else{if(_0x1084e6==_0x5b8977(0x156)&&_0x10f3ff==_0x55411e){var _0x47be98=_0x132bc1[_0x5b8977(0x1f0)](0x3);_0x53ed04[_0x10f3ff][_0x5b8977(0x187)]=_0x132bc1[0x0],_0x53ed04[_0x10f3ff][_0x5b8977(0x1b9)]=_0x132bc1[0x1],_0x53ed04[_0x10f3ff]['bay']=0x0,_0x53ed04[_0x10f3ff]['bin']=0x0,_0x53ed04[_0x10f3ff][_0x5b8977(0x15b)]=_0x5b8977(0x1db),_0x53ed04[_0x10f3ff][_0x5b8977(0x1fc)]=_0x132bc1[0x5];}else{if(_0x10f3ff==_0x55411e){var _0x28a886;if(_0x132bc1[0x4]=='L')_0x28a886=_0x5b8977(0x19e);else _0x132bc1[0x4]=='F'&&(_0x28a886=_0x5b8977(0x1db));_0x53ed04[_0x10f3ff][_0x5b8977(0x187)]=_0x132bc1[0x0],_0x53ed04[_0x10f3ff]['rack']=_0x132bc1[0x1],_0x53ed04[_0x10f3ff][_0x5b8977(0x1a9)]=_0x132bc1[0x2],_0x53ed04[_0x10f3ff][_0x5b8977(0x20b)]=_0x132bc1[0x3],_0x53ed04[_0x10f3ff][_0x5b8977(0x15b)]=_0x28a886,_0x53ed04[_0x10f3ff][_0x5b8977(0x1fc)]=_0x132bc1[0x5];}}}});}),_0x25d7b1[_0x345679(0x167)]((_0x4496ab,_0x3d2da9)=>{var _0x4d14cc=_0x345679;_0x53ed04[_0x3d2da9][_0x4d14cc(0x1d1)]=_0x4496ab;}),_0x3b4cc1['forEach']((_0x3f7195,_0x3bb5d8)=>{var _0x3ed451=_0x345679;_0x53ed04[_0x3bb5d8][_0x3ed451(0x1cf)]=_0x3f7195;}),_0x23056a[_0x345679(0x167)]((_0x384d5e,_0x4b4978)=>{var _0x1ef8f9=_0x345679;_0x53ed04[_0x4b4978][_0x1ef8f9(0x238)]=_0x384d5e;}),_0x399dd7[_0x345679(0x167)]((_0x4243e2,_0x653341)=>{var _0x20292a=_0x345679;_0x53ed04[_0x653341][_0x20292a(0x1e1)]=_0x4243e2;}),_0xbb44d8['forEach']((_0x4c664e,_0x29c3d3)=>{var _0x349820=_0x345679;_0x53ed04[_0x29c3d3][_0x349820(0x19b)]=_0x4c664e;}),_0x515a54[_0x345679(0x167)]((_0x3aaa6c,_0x40f823)=>{_0x53ed04[_0x40f823]['production_date']=_0x3aaa6c;}),_0x44f149[_0x345679(0x167)]((_0x45fc8d,_0x2eeed1)=>{var _0x271e54=_0x345679;_0x53ed04[_0x2eeed1][_0x271e54(0x224)]=Math[_0x271e54(0x245)](_0x45fc8d);}),_0x2cb179[_0x345679(0x167)]((_0x17cd23,_0x33a1b7)=>{var _0x514eb4=_0x345679;_0x53ed04[_0x33a1b7][_0x514eb4(0x22e)]=_0x17cd23;}),_0x3d57b1[_0x345679(0x167)]((_0x409df8,_0x1f1b3b)=>{var _0x3a90e2=_0x345679;_0x53ed04[_0x1f1b3b][_0x3a90e2(0x1e5)]=_0x409df8;}),_0x187e4a[_0x345679(0x167)]((_0x2fb625,_0xcf59b1)=>{_0x53ed04[_0xcf59b1]['prod_cat']=_0x2fb625;}),_0x4ac55c['forEach']((_0x4af503,_0x4478bc)=>{var _0xfdc579=_0x345679;_0x53ed04[_0x4478bc][_0xfdc579(0x1cc)]=_0x4af503;}),_0x5a45d0[_0x345679(0x167)]((_0xd4cc6c,_0x3e1494)=>{_0x53ed04[_0x3e1494]['room_name']=_0xd4cc6c;});var _0x1e2f8a=0x0;_0x53ed04[_0x345679(0x167)](_0xd748e=>{var _0x2d6abc=_0x345679;console[_0x2d6abc(0x222)]('foreach\x20newproduct',_0xd748e),(parseInt(_0xd748e[_0x2d6abc(0x19f)])<parseInt(_0xd748e[_0x2d6abc(0x259)])||parseInt(_0xd748e[_0x2d6abc(0x259)])==0x0)&&_0x1e2f8a++;});if(_0x1e2f8a!=0x0)return _0x402a82[_0x345679(0x250)](_0x345679(0x16f),_0x345679(0x1b0)),_0x43a35d['redirect'](_0x345679(0x246));const _0x571905=_0x53ed04['filter'](_0x394c51=>_0x394c51['quantity']!=='0'&&_0x394c51[_0x345679(0x259)]!=='');_0xeb1bbd[_0x345679(0x239)]=_0x3bdba6,_0xeb1bbd[_0x345679(0x221)]=_0x503c2f,_0xeb1bbd[_0x345679(0x1bb)]=_0x51484a,_0xeb1bbd[_0x345679(0x1b6)]=_0x4803f3,_0xeb1bbd[_0x345679(0x17f)]=_0x571905,_0xeb1bbd[_0x345679(0x1fa)]=_0x2f2430,_0xeb1bbd[_0x345679(0x255)]=_0x4ebb33,_0xeb1bbd[_0x345679(0x23b)]=_0x345679(0x1ac),_0xeb1bbd['isAllowEdit']=_0x345679(0x1ac);const _0x3223a9=await _0xeb1bbd[_0x345679(0x1eb)]();_0x402a82[_0x345679(0x250)](_0x345679(0x18c),_0x345679(0x254)),_0x43a35d['redirect'](_0x345679(0x16a));}catch(_0x43219b){console['log'](_0x43219b);}}),router[a0_0x357d96(0x23c)]('/give_payment/:id',auth,async(_0x5a14bc,_0x30f91f)=>{var _0x460fd7=a0_0x357d96;try{const _0x1bf22a=_0x5a14bc[_0x460fd7(0x16c)]['id'],{invoice:_0x39c3ab,customer:_0x396221,receivable_amount:_0x49a579,received_amount:_0xed2af}=_0x5a14bc['body'],_0x5211c6=await sales[_0x460fd7(0x22d)](_0x1bf22a);console['log'](_0x5211c6);var _0x4aafb7=_0x49a579-_0xed2af;console[_0x460fd7(0x222)](_0xed2af),_0x5211c6[_0x460fd7(0x166)]=parseFloat(_0xed2af)+parseFloat(_0x5211c6[_0x460fd7(0x166)]),_0x5211c6[_0x460fd7(0x231)]=_0x4aafb7,console[_0x460fd7(0x222)](_0x5211c6);const _0x1f8943=await _0x5211c6[_0x460fd7(0x1eb)](),_0x2d9cfb=await c_payment_data[_0x460fd7(0x220)]({'invoice':_0x39c3ab});_0x2d9cfb['amount']=_0x4aafb7,await _0x2d9cfb['save']();let _0x11a086=new Date(),_0xb7d716=('0'+_0x11a086['getDate']())['slice'](-0x2),_0x49390b=('0'+(_0x11a086[_0x460fd7(0x172)]()+0x1))['slice'](-0x2),_0xf545a3=_0x11a086[_0x460fd7(0x205)](),_0x3c7e70=_0xf545a3+'-'+_0x49390b+'-'+_0xb7d716;const _0x3b295f=new customer_payment({'invoice':_0x39c3ab,'date':_0xf545a3+'-'+_0x49390b+'-'+_0xb7d716,'customer':_0x396221,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0xed2af}),_0x5b6d23=await _0x3b295f['save']();_0x5a14bc[_0x460fd7(0x250)](_0x460fd7(0x18c),_0x460fd7(0x1b3)),_0x30f91f[_0x460fd7(0x251)]('/all_sales/view');}catch(_0x3d8dc7){console[_0x460fd7(0x222)](_0x3d8dc7);}}),router[a0_0x357d96(0x177)]('/invoice/:id',auth,async(_0x25f73c,_0x3c21f2)=>{var _0xa2df35=a0_0x357d96;try{const {username:_0x46871b,email:_0x14c626,role:_0x127dac}=_0x25f73c[_0xa2df35(0x1b5)],_0x4f9a79=_0x25f73c['user'],_0x59668b=await profile[_0xa2df35(0x220)]({'email':_0x4f9a79['email']}),_0x21b466=await master_shop[_0xa2df35(0x210)]();console[_0xa2df35(0x222)](_0xa2df35(0x1fd),_0x21b466);const _0x251b1f=_0x25f73c[_0xa2df35(0x16c)]['id'],_0x2286c9=await sales[_0xa2df35(0x22d)](_0x251b1f);console[_0xa2df35(0x222)](_0x2286c9);const _0x4b6826=await customer[_0xa2df35(0x220)]({'name':_0x2286c9[_0xa2df35(0x221)]});console[_0xa2df35(0x222)](_0x4b6826);if(_0x21b466[0x0][_0xa2df35(0x211)]==_0xa2df35(0x1f6)){var _0x1edd9c=users[_0xa2df35(0x229)];console[_0xa2df35(0x222)](_0x1edd9c);}else{if(_0x21b466[0x0][_0xa2df35(0x211)]=='Hindi')var _0x1edd9c=users[_0xa2df35(0x1a0)];else{if(_0x21b466[0x0][_0xa2df35(0x211)]==_0xa2df35(0x188))var _0x1edd9c=users['German'];else{if(_0x21b466[0x0][_0xa2df35(0x211)]==_0xa2df35(0x1dc))var _0x1edd9c=users[_0xa2df35(0x1dc)];else{if(_0x21b466[0x0][_0xa2df35(0x211)]=='French')var _0x1edd9c=users[_0xa2df35(0x1c7)];else{if(_0x21b466[0x0][_0xa2df35(0x211)]==_0xa2df35(0x1ad))var _0x1edd9c=users[_0xa2df35(0x244)];else{if(_0x21b466[0x0][_0xa2df35(0x211)]=='Chinese')var _0x1edd9c=users[_0xa2df35(0x23a)];else{if(_0x21b466[0x0][_0xa2df35(0x211)]==_0xa2df35(0x22a))var _0x1edd9c=users['Arabic'];}}}}}}}_0x3c21f2[_0xa2df35(0x15c)](_0xa2df35(0x1dd),{'success':_0x25f73c[_0xa2df35(0x250)]('success'),'errors':_0x25f73c['flash'](_0xa2df35(0x16f)),'role':_0x4f9a79,'profile':_0x59668b,'master_shop':_0x21b466,'customers':_0x4b6826,'sales':_0x2286c9,'language':_0x1edd9c});}catch(_0x4b9132){console['log'](_0x4b9132);}}),router['get'](a0_0x357d96(0x215),auth,async(_0x118c13,_0x240d6e)=>{var _0x50b0b3=a0_0x357d96;try{const {username:_0x85da28,email:_0x59e7ff,role:_0x31f66d}=_0x118c13['user'],_0x540514=_0x118c13['user'],_0x27d770=await profile[_0x50b0b3(0x220)]({'email':_0x540514[_0x50b0b3(0x227)]}),_0x1d02e2=await master_shop[_0x50b0b3(0x210)]();console[_0x50b0b3(0x222)](_0x50b0b3(0x1fd),_0x1d02e2);const _0x9f659d=_0x118c13[_0x50b0b3(0x16c)]['id'];console[_0x50b0b3(0x222)](_0x9f659d);const _0x475dff=await sales['findById'](_0x9f659d);console[_0x50b0b3(0x222)]('user_id',_0x475dff);const _0x559bf7=await warehouse[_0x50b0b3(0x208)]([{'$match':{'name':_0x50b0b3(0x195),'room':_0x50b0b3(0x1c9)}},{'$unwind':_0x50b0b3(0x242)},{'$group':{'_id':_0x50b0b3(0x248),'name':{'$first':_0x50b0b3(0x1c4)},'product_stock':{'$first':_0x50b0b3(0x1e8)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x50b0b3(0x1e9)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x50b0b3(0x1ed)},'product_code':{'$first':_0x50b0b3(0x217)}}}]);console['log']('stock_data',_0x559bf7);const _0x45aaa9=await product[_0x50b0b3(0x210)]({});warehouse_data=await warehouse[_0x50b0b3(0x208)]([{'$match':{'status':'Enabled','name':_0x50b0b3(0x195),'warehouse_category':_0x50b0b3(0x1b2)}},{'$group':{'_id':_0x50b0b3(0x164),'name':{'$first':_0x50b0b3(0x164)}}},{'$sort':{'name':0x1}}]);var _0x3b7ac3=[_0x50b0b3(0x1c9)];if(_0x1d02e2[0x0]['language']=='English\x20(US)'){var _0x2fa871=users[_0x50b0b3(0x229)];console[_0x50b0b3(0x222)](_0x2fa871);}else{if(_0x1d02e2[0x0][_0x50b0b3(0x211)]=='Hindi')var _0x2fa871=users[_0x50b0b3(0x1a0)];else{if(_0x1d02e2[0x0]['language']==_0x50b0b3(0x188))var _0x2fa871=users[_0x50b0b3(0x188)];else{if(_0x1d02e2[0x0][_0x50b0b3(0x211)]==_0x50b0b3(0x1dc))var _0x2fa871=users[_0x50b0b3(0x1dc)];else{if(_0x1d02e2[0x0]['language']==_0x50b0b3(0x1c7))var _0x2fa871=users[_0x50b0b3(0x1c7)];else{if(_0x1d02e2[0x0][_0x50b0b3(0x211)]==_0x50b0b3(0x1ad))var _0x2fa871=users[_0x50b0b3(0x244)];else{if(_0x1d02e2[0x0][_0x50b0b3(0x211)]=='Chinese')var _0x2fa871=users[_0x50b0b3(0x23a)];else{if(_0x1d02e2[0x0]['language']=='Arabic\x20(ae)')var _0x2fa871=users[_0x50b0b3(0x21e)];}}}}}}}_0x240d6e['render']('return_sale',{'success':_0x118c13[_0x50b0b3(0x250)](_0x50b0b3(0x18c)),'errors':_0x118c13[_0x50b0b3(0x250)](_0x50b0b3(0x16f)),'role':_0x540514,'profile':_0x27d770,'user':_0x475dff,'stock':_0x559bf7,'master_shop':_0x1d02e2,'unit':_0x45aaa9,'language':_0x2fa871,'warehouses':warehouse_data,'rooms':_0x3b7ac3});}catch(_0xb0b5df){console[_0x50b0b3(0x222)](_0xb0b5df),_0x240d6e[_0x50b0b3(0x1c6)](0xc8)[_0x50b0b3(0x1bd)]({'message':_0xb0b5df[_0x50b0b3(0x25d)]});}}),router['post'](a0_0x357d96(0x215),auth,async(_0x205043,_0x4717f2)=>{var _0x210838=a0_0x357d96;try{const {invoice:_0x13909a,date:_0xf24070,warehouse_name:_0x227cec,product_name:_0x55f806,primary_code:_0x26d2a8,secondary_code:_0x1e52fa,product_code:_0x3730ed,sales_quantity:_0x303fec,stocks:_0x5b15be,return_qty:_0x4b1b8a,Room_name:_0x3cbc13,to_warehouse_name:_0x357d75,to_Roomname:_0x16d623,to_Room_name:_0x220c33,note:_0xd0338b,level:_0x3266a5,isle:_0x52c421,pallet:_0x14685b}=_0x205043['body'];if(typeof _0x55f806==_0x210838(0x234))var _0x1ff517=[_0x205043['body']['product_name']],_0x480de5=[_0x205043[_0x210838(0x1d2)][_0x210838(0x193)]],_0x3f27b7=[_0x205043['body']['secondary_code']],_0x2341d1=[_0x205043[_0x210838(0x1d2)][_0x210838(0x196)]],_0x2ab04e=[_0x205043[_0x210838(0x1d2)]['sales_quantity']],_0x1ed50d=[_0x205043[_0x210838(0x1d2)][_0x210838(0x21a)]],_0x257ef2=[_0x205043['body'][_0x210838(0x168)]],_0xb69c20=[_0x205043[_0x210838(0x1d2)]['bay']],_0xd414f8=[_0x205043['body'][_0x210838(0x20b)]],_0xf95077=[_0x205043['body'][_0x210838(0x1bf)]],_0x3a2943=[_0x205043[_0x210838(0x1d2)][_0x210838(0x1fc)]];else var _0x1ff517=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x1af)]],_0x480de5=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x193)]],_0x3f27b7=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x16d)]],_0x2341d1=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x196)]],_0x2ab04e=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x232)]],_0x1ed50d=[..._0x205043[_0x210838(0x1d2)]['stocks']],_0x257ef2=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x168)]],_0xb69c20=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x1a9)]],_0xd414f8=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x20b)]],_0xf95077=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x1bf)]],_0x3a2943=[..._0x205043[_0x210838(0x1d2)][_0x210838(0x1fc)]];const _0x156d59=_0x1ff517[_0x210838(0x15a)](_0x2ec27c=>{return _0x2ec27c={'product_name':_0x2ec27c};});_0x480de5[_0x210838(0x167)]((_0x5a61ed,_0x232654)=>{_0x156d59[_0x232654]['primary_code']=_0x5a61ed;}),_0x3f27b7['forEach']((_0x77a238,_0x23515a)=>{_0x156d59[_0x23515a]['secondary_code']=_0x77a238;}),_0x2341d1['forEach']((_0x12ab9f,_0x513379)=>{_0x156d59[_0x513379]['product_code']=_0x12ab9f;}),_0x2ab04e[_0x210838(0x167)]((_0x32790e,_0x204041)=>{_0x156d59[_0x204041]['sale_qty']=_0x32790e;}),_0x1ed50d[_0x210838(0x167)]((_0xef9cfb,_0x474faf)=>{var _0x561b9d=_0x210838;_0x156d59[_0x474faf][_0x561b9d(0x19f)]=_0xef9cfb;}),_0x257ef2[_0x210838(0x167)]((_0x4b4c7a,_0x591564)=>{var _0x120c7d=_0x210838;_0x156d59[_0x591564][_0x120c7d(0x168)]=_0x4b4c7a;}),_0xb69c20[_0x210838(0x167)]((_0x2e0c37,_0x4b3aea)=>{_0x156d59[_0x4b3aea]['bay']=_0x2e0c37;}),_0xd414f8['forEach']((_0x17a786,_0x2a1b41)=>{var _0x2d856d=_0x210838;_0x156d59[_0x2a1b41][_0x2d856d(0x20b)]=_0x17a786;}),_0xf95077[_0x210838(0x167)]((_0x5eac77,_0xaf0cc1)=>{_0x156d59[_0xaf0cc1]['type']=_0x5eac77;}),_0x3a2943[_0x210838(0x167)]((_0x3fa461,_0x22271c)=>{_0x156d59[_0x22271c]['floorlevel']=_0x3fa461;});var _0x25da75=0x0;_0x156d59['forEach'](_0xfb797c=>{var _0x82e44a=_0x210838;console[_0x82e44a(0x222)](_0x82e44a(0x1a8),_0xfb797c),(parseInt(_0xfb797c[_0x82e44a(0x191)])<parseInt(_0xfb797c[_0x82e44a(0x168)])||parseInt(_0xfb797c[_0x82e44a(0x19f)])<parseInt(_0xfb797c[_0x82e44a(0x168)])&&parseInt(_0xfb797c['sale_qty'])>parseInt(_0xfb797c['return_qty'])||parseInt(_0xfb797c[_0x82e44a(0x168)])==0x0)&&_0x25da75++;});if(_0x25da75!=0x0)return _0x205043[_0x210838(0x250)](_0x210838(0x16f),_0x210838(0x190)),_0x4717f2['redirect']('back');const _0x208fcc=await sales['findOne']({'invoice':_0x13909a});console['log'](_0x208fcc),_0x208fcc[_0x210838(0x189)]=_0x210838(0x1a2);const _0x407b8a=await _0x208fcc[_0x210838(0x1eb)](),_0x9c8046=new sales_return({'invoice':_0x13909a,'customer':_0x205043[_0x210838(0x1d2)][_0x210838(0x221)],'date':_0xf24070,'warehouse_name':_0x227cec,'room':_0x3cbc13,'ToWarehouse':_0x357d75,'ToRoom':_0x220c33,'return_sale':_0x156d59,'note':_0xd0338b}),_0x15ea10=await _0x9c8046['save']();console[_0x210838(0x222)](_0x9c8046);const _0x22e293=await sales_return[_0x210838(0x220)]({'invoice':_0x13909a}),_0x692955=await warehouse[_0x210838(0x220)]({'name':_0x357d75,'room':_0x220c33});_0x22e293[_0x210838(0x1e6)][_0x210838(0x167)](_0x366969=>{var _0x4e7895=_0x210838,_0x23a25c=0x0;const _0x3cee06=_0x692955[_0x4e7895(0x1cd)][_0x4e7895(0x15a)](_0x1e210a=>{var _0x42c453=_0x4e7895;_0x1e210a[_0x42c453(0x1af)]==_0x366969[_0x42c453(0x1af)]&&_0x1e210a[_0x42c453(0x1fc)]==_0x366969[_0x42c453(0x1fc)]&&_0x1e210a[_0x42c453(0x15b)]==_0x366969[_0x42c453(0x15b)]&&_0x1e210a['bin']==_0x366969[_0x42c453(0x20b)]&&_0x1e210a[_0x42c453(0x1a9)]==_0x366969[_0x42c453(0x1a9)]&&(_0x1e210a[_0x42c453(0x25b)]=parseInt(_0x1e210a[_0x42c453(0x25b)])+parseInt(_0x366969[_0x42c453(0x168)]),_0x23a25c++);});_0x23a25c=='0'&&(_0x692955[_0x4e7895(0x1cd)]=_0x692955[_0x4e7895(0x1cd)]['concat']({'product_name':_0x366969['product_name'],'product_stock':_0x366969[_0x4e7895(0x168)],'primary_code':_0x366969[_0x4e7895(0x193)],'secondary_code':_0x366969['secondary_code'],'product_code':_0x366969[_0x4e7895(0x196)],'bay':_0x366969[_0x4e7895(0x1a9)],'bin':_0x366969[_0x4e7895(0x20b)],'type':_0x366969[_0x4e7895(0x15b)],'floorlevel':_0x366969[_0x4e7895(0x1fc)]})),console['log'](_0x4e7895(0x1c8),_0x692955);}),await _0x692955[_0x210838(0x1eb)](),console[_0x210838(0x222)](_0x205043[_0x210838(0x1d2)]);const _0x170e20=new c_payment_data({'invoice':_0x13909a,'customer':_0x205043[_0x210838(0x1d2)][_0x210838(0x221)],'reason':_0x210838(0x1c5)});await _0x170e20[_0x210838(0x1eb)]();const _0x234dde=await master_shop['find']();console[_0x210838(0x222)](_0x210838(0x22c),_0x234dde[0x0]['image']);const _0x331e2f=await email_settings[_0x210838(0x220)](),_0x35827b=await customer['findOne']({'name':_0x205043[_0x210838(0x1d2)][_0x210838(0x221)]});console['log']('customer_data',_0x35827b);_0x234dde[0x0][_0x210838(0x1b4)]==0x1?(right_currency=_0x234dde[0x0][_0x210838(0x1cb)],left_currency=''):(right_currency='',left_currency=_0x234dde[0x0][_0x210838(0x1cb)]);var _0x5ebb35=_0x1ff517,_0x1513c7=_0x257ef2,_0x35f874='',_0x82251f;for(_0x82251f in _0x5ebb35){_0x35f874+=_0x210838(0x226)+_0x210838(0x257)+_0x5ebb35[_0x82251f]+_0x210838(0x204)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1513c7[_0x82251f]+'</td>'+_0x210838(0x237);}console[_0x210838(0x222)](_0x210838(0x236),_0x35f874);let _0x4094bd=nodemailer[_0x210838(0x1f8)]({'service':_0x210838(0x25a),'auth':{'user':_0x331e2f['email'],'pass':_0x331e2f[_0x210838(0x1e3)]}}),_0x4095b8={'from':_0x331e2f[_0x210838(0x227)],'to':_0x35827b['email'],'subject':_0x210838(0x24b),'attachments':[{'filename':_0x210838(0x199),'path':__dirname+_0x210838(0x21f)+_0x210838(0x24c)+_0x234dde[0x0][_0x210838(0x1a3)],'cid':_0x210838(0x1bc)}],'html':_0x210838(0x1f4)+'<html><head><title></title>'+_0x210838(0x158)+_0x210838(0x228)+_0x210838(0x253)+_0x210838(0x228)+_0x210838(0x209)+'</div>'+_0x210838(0x228)+_0x210838(0x1d6)+_0x234dde[0x0][_0x210838(0x165)]+_0x210838(0x1a6)+_0x210838(0x25e)+_0x210838(0x25e)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x210838(0x180)+'\x20Order\x20Number\x20:\x20'+_0x13909a+'\x20'+_0x210838(0x18b)+_0x210838(0x1d9)+_0xf24070+'\x20'+_0x210838(0x1a7)+_0x210838(0x1fe)+_0x210838(0x25e)+_0x210838(0x18d)+_0x210838(0x203)+_0x210838(0x226)+_0x210838(0x198)+_0x210838(0x1aa)+_0x210838(0x1f9)+_0x210838(0x1c2)+_0x210838(0x237)+_0x210838(0x202)+_0x210838(0x17d)+'\x20'+_0x35f874+'\x20'+_0x210838(0x214)+_0x210838(0x1ce)+_0x210838(0x228)+'<strong>\x20Regards\x20</strong>'+_0x210838(0x240)+_0x234dde[0x0][_0x210838(0x165)]+_0x210838(0x1fe)+_0x210838(0x25e)+'</div>'+'</body></html>'};_0x4094bd[_0x210838(0x22f)](_0x4095b8,function(_0x4be46d,_0x2fafa4){var _0x2d8f0a=_0x210838;_0x4be46d?(console[_0x2d8f0a(0x222)](_0x4be46d),console[_0x2d8f0a(0x222)](_0x2d8f0a(0x212))):console[_0x2d8f0a(0x222)](_0x2d8f0a(0x23e));}),_0x205043[_0x210838(0x250)](_0x210838(0x18c),'sales\x20item\x20return\x20successfull'),_0x4717f2[_0x210838(0x251)](_0x210838(0x16a));}catch(_0xc6a454){console[_0x210838(0x222)](_0xc6a454),_0x4717f2['status'](0xc8)[_0x210838(0x1bd)]({'message1':_0xc6a454[_0x210838(0x25d)]});}}),router['get']('/barcode/:id',auth,async(_0x243c8c,_0x57956b)=>{var _0xb77d7f=a0_0x357d96;try{const {username:_0x27f34c,email:_0x128d30,role:_0x5a3144}=_0x243c8c[_0xb77d7f(0x1b5)],_0x38952c=_0x243c8c[_0xb77d7f(0x1b5)],_0x4bdf5e=await profile[_0xb77d7f(0x220)]({'email':_0x38952c['email']}),_0x3d24a8=await master_shop['find']();console['log'](_0xb77d7f(0x162),_0x3d24a8);const _0x508022=_0x243c8c[_0xb77d7f(0x16c)]['id'],_0x3bb335=await sales['findById'](_0x508022);console[_0xb77d7f(0x222)](_0xb77d7f(0x1d8),_0x3bb335);if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x1f6))var _0x22091f=users[_0xb77d7f(0x229)];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x1a0))var _0x22091f=users[_0xb77d7f(0x1a0)];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x188))var _0x22091f=users['German'];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x1dc))var _0x22091f=users[_0xb77d7f(0x1dc)];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x1c7))var _0x22091f=users['French'];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]=='Portuguese\x20(BR)')var _0x22091f=users[_0xb77d7f(0x244)];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x23a))var _0x22091f=users[_0xb77d7f(0x23a)];else{if(_0x3d24a8[0x0][_0xb77d7f(0x211)]==_0xb77d7f(0x22a))var _0x22091f=users[_0xb77d7f(0x21e)];}}}}}}}_0x57956b[_0xb77d7f(0x15c)]('all_sales_barcode',{'success':_0x243c8c['flash']('success'),'errors':_0x243c8c[_0xb77d7f(0x250)](_0xb77d7f(0x16f)),'role':_0x38952c,'profile':_0x4bdf5e,'alldata':_0x3bb335,'master_shop':_0x3d24a8,'language':_0x22091f});}catch(_0x4aa95a){console[_0xb77d7f(0x222)](_0x4aa95a);}}),router['post'](a0_0x357d96(0x1e0),async(_0x483b0b,_0x32c0df)=>{var _0x280dee=a0_0x357d96;const {product_code:_0x3dbea6,warehouse_name:_0x289369,rooms_data:_0x2f64bb,Roomslist:_0x5e35e4}=_0x483b0b[_0x280dee(0x1d2)],_0x3c3fca=_0x5e35e4[_0x280dee(0x241)](','),_0x46fc1b=[];async function _0x2021a8(_0xdede89){var _0x1def09=_0x280dee;const _0x3a4417=await warehouse['aggregate']([{'$match':{'name':_0x289369,'room':_0xdede89}},{'$unwind':_0x1def09(0x242)},{'$match':{'product_details.primary_code':_0x3dbea6}},{'$group':{'_id':_0x1def09(0x248),'name':{'$first':_0x1def09(0x1c4)},'product_stock':{'$first':_0x1def09(0x1e8)},'primary_code':{'$first':_0x1def09(0x23d)},'secondary_code':{'$first':_0x1def09(0x1ed)},'product_code':{'$first':_0x1def09(0x217)},'level':{'$first':_0x1def09(0x181)},'isle':{'$first':_0x1def09(0x1ff)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1def09(0x252)},'unit':{'$first':_0x1def09(0x170)},'secondary_unit':{'$first':_0x1def09(0x25c)},'storage':{'$first':_0x1def09(0x1ee)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1def09(0x219)},'production_date':{'$first':_0x1def09(0x1c0)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x1def09(0x1b7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1def09(0x207)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x1def09(0x1a1)},'actual_uom':{'$first':_0x1def09(0x15f)}}}]),_0xea1e92=await warehouse['aggregate']([{'$match':{'name':_0x289369,'room':_0xdede89}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3dbea6}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1def09(0x1c4)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1def09(0x23d)},'secondary_code':{'$first':_0x1def09(0x1ed)},'product_code':{'$first':_0x1def09(0x217)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1def09(0x1ff)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1def09(0x170)},'secondary_unit':{'$first':_0x1def09(0x25c)},'storage':{'$first':_0x1def09(0x1ee)},'rack':{'$first':_0x1def09(0x1f2)},'expiry_date':{'$first':_0x1def09(0x219)},'production_date':{'$first':_0x1def09(0x1c0)},'maxPerUnit':{'$first':_0x1def09(0x249)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x1def09(0x1df)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1def09(0x207)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x3a4417[_0x1def09(0x1be)]>0x0)_0x46fc1b[_0x1def09(0x20c)](_0x3a4417);else _0xea1e92[_0x1def09(0x1be)]>0x0&&_0x46fc1b['push'](_0xea1e92);}const _0x2705e0=_0x3c3fca[_0x280dee(0x15a)](_0x13bf6b=>_0x2021a8(_0x13bf6b));await Promise[_0x280dee(0x24f)](_0x2705e0),_0x32c0df['json'](_0x46fc1b);}),module[a0_0x357d96(0x200)]=router;