var a0_0x2604b3=a0_0x43f1;function a0_0x4479(){var _0x56dcbe=['carton','isAllowEdit','/give_payment/:id','prod_cat','$customers_docs','1410828SqQLjj','findById','actual_uom','sales_invoice','json','Chinese','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<h2>\x20','bay','status','$invoice','return_sale','\x20Order\x20Date\x20:\x20','<tr>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','quantity','Router','delivery_date','English\x20(US)','/upload/','Logo.png','received_amount','Raw\x20Materials','$sale_product','getDate','$product_details.secondary_code','product_stock','$product_details.level','id_transact','$sale_product.floorlevel','$product_details.floorlevel','bin','primary_code','</td>','errors','SCRN','$sale_product.type','purchases_data','sales\x20all_data','$product_details.rack','master','production_date','</thead>','<!DOCTYPE\x20html>','get','$customer','filter','message','$product_details.bay','logo','$product_details','catch','length','product','</tr>','Enclosed','$product_details.pallet','$date','finalize','site_title','back','string','721000gIaLVI','find','storage','Sales\x20Update\x20successfully','getFullYear','$product_details.production_date','abs','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Sales\x20Add\x20successfully','$product_details.unit','$product_details.primary_code','/view/add_sales/:id','/all_sales/view','rack','/view','Arabic\x20(ae)','Sales\x20Mail','map','$product','Shelves','</div>','max','batch_code','Floor','user_id','\x20Order\x20Number\x20:\x20','Hindi','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/view/:id','payment\x20successfull','add_sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.type','stock_data','63562VMLqSF','slice','host','Arabic','push','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','actual_qty','True','max_per_unit','<hr\x20class=\x22my-3\x22>','primary_unit','forEach','$product_details.product_stock','<html><head><title></title>','$sale_product.quantity','621978ZoAZiW','secondary_unit','Receiving\x20Area','RMSEmail','<h5>','quantity_notConverted','date','sales\x20item\x20return\x20successfull','$product_details.invoice','floorlevel','$product_details.product_name','secondary_code','amount','$product.product_name','floor','prod_code','<div>','$warehouse_name','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Return\x20Goods','sale_product','$return_data','$sale_product.bay','language','aggregate','warehouse','Email\x20sent\x20successfully','/../public','</span>','$product_details.secondary_unit','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20</h2>','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.batch_code','all_sales','$product_details.actual_uom','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','7OuMeVk','Spanish','OUT-','room','image','barcode\x20Product\x20master','Enabled','add\x20post','$room','warehouse_name','False','invoice','</body></html>','all','customers_docs','createTransport','post','role','unit','German','edit_sales','<span\x20style=\x22float:\x20right;\x22>','expiry_date','split','$finalize','level','$product_details.bin','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','all_sales_barcode','$sale_product.bin','$product_details._id','room_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.expiry_date','port','English','/view/return_sales/:id','product_details','requested_qty','product_name','log','params','$name','Return\x20Rooms','1716308AWrbjC','$product_details.product_cat','flash','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.storage','save','</table>','customers','_id','staff','nodemailer','password','success','/all_sales/preview/','<strong>\x20Regards\x20</strong>','body','<tbody\x20style=\x22text-align:\x20center;\x22>','customer_data','295293MHwNQv','currency_placement','return_qty','$_id','1055030sguUFD','/barcode/:id','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','email','id_transaction_from','express','</head><body>','type','foreach\x20newproduct','French','getMonth','/invoice/:id','delivery_code','redirect','Level','Ambient','</tbody>','$note','error','Portuguese','$product_details.isle','An\x20error\x20occurred.','$product_details.actual_qty','note','prod_invoice','maxperunit','random','Error\x20Occurs','currency','Sale\x20Return','sales_quantity','stocks','stock','render','Portuguese\x20(BR)','customer','$isAllowEdit','product_code','<h5\x20style=\x22text-align:\x20left;\x22>','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','RoomAssigned','types'];a0_0x4479=function(){return _0x56dcbe;};return a0_0x4479();}(function(_0x4f2ffa,_0x20e293){var _0x204b08=a0_0x43f1,_0x2e1ac0=_0x4f2ffa();while(!![]){try{var _0x10f384=-parseInt(_0x204b08(0x1b0))/0x1+parseInt(_0x204b08(0x1bf))/0x2+-parseInt(_0x204b08(0x11a))/0x3+-parseInt(_0x204b08(0x108))/0x4+parseInt(_0x204b08(0x11e))/0x5+-parseInt(_0x204b08(0x14f))/0x6*(-parseInt(_0x204b08(0x1e7))/0x7)+parseInt(_0x204b08(0x18d))/0x8;if(_0x10f384===_0x20e293)break;else _0x2e1ac0['push'](_0x2e1ac0['shift']());}catch(_0x377462){_0x2e1ac0['push'](_0x2e1ac0['shift']());}}}(a0_0x4479,0x3e8bc));const express=require(a0_0x2604b3(0x124)),app=express(),router=express[a0_0x2604b3(0x15f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x2604b3(0x112)),users=require('../public/language/languages.json');router[a0_0x2604b3(0x17b)](a0_0x2604b3(0x19b),auth,async(_0x2a8d1a,_0x371636)=>{var _0xa847b2=a0_0x2604b3;try{const {username:_0x11ad92,email:_0x3eaf3d,role:_0x1bf4ce}=_0x2a8d1a['user'],_0x25b857=_0x2a8d1a[_0xa847b2(0x1a8)],_0x7f7a8d=await profile[_0xa847b2(0x1d1)]({'email':_0x25b857['email']}),_0x4926dd=await master_shop['find']();let _0x28b11e;if(_0x25b857['role']==_0xa847b2(0x111)){const _0x324292=await staff[_0xa847b2(0x1d1)]({'email':_0x25b857['email']});_0x28b11e=await sales[_0xa847b2(0x1d8)]([{'$lookup':{'from':_0xa847b2(0x10f),'localField':_0xa847b2(0x142),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0xa847b2(0x14e)},{'$unwind':_0xa847b2(0x166)},{'$group':{'_id':_0xa847b2(0x11d),'invoice':{'$first':_0xa847b2(0x159)},'customers':{'$first':_0xa847b2(0x17c)},'date':{'$first':_0xa847b2(0x188)},'warehouse_name':{'$first':_0xa847b2(0x1d0)},'sale_product':{'$push':_0xa847b2(0x166)},'note':{'$first':_0xa847b2(0x130)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0xa847b2(0x1be)},'level':{'$addToSet':_0xa847b2(0x1d6)},'isle':{'$addToSet':_0xa847b2(0xf8)},'type':{'$addToSet':_0xa847b2(0x173)},'pallet':{'$addToSet':_0xa847b2(0x16c)},'finalize':{'$first':_0xa847b2(0xf2)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x28b11e=await sales[_0xa847b2(0x1d8)]([{'$lookup':{'from':_0xa847b2(0x10f),'localField':_0xa847b2(0x142),'foreignField':'name','as':_0xa847b2(0x1f5)}},{'$unwind':'$customers_docs'},{'$unwind':_0xa847b2(0x166)},{'$group':{'_id':_0xa847b2(0x11d),'invoice':{'$first':_0xa847b2(0x159)},'customers':{'$first':_0xa847b2(0x17c)},'date':{'$first':_0xa847b2(0x188)},'warehouse_name':{'$first':_0xa847b2(0x1d0)},'sale_product':{'$push':_0xa847b2(0x166)},'note':{'$first':'$note'},'return_data':{'$first':_0xa847b2(0x1d5)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xa847b2(0x1d6)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0xa847b2(0x16c)},'finalize':{'$first':_0xa847b2(0xf2)},'isAllowEdit':{'$first':_0xa847b2(0x143)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0xa847b2(0x104)](_0xa847b2(0x175),_0x28b11e);if(_0x4926dd[0x0]['language']==_0xa847b2(0x161)){var _0x26cf2b=users[_0xa847b2(0xff)];console[_0xa847b2(0x104)](_0x26cf2b);}else{if(_0x4926dd[0x0][_0xa847b2(0x1d7)]==_0xa847b2(0x1a7))var _0x26cf2b=users['Hindi'];else{if(_0x4926dd[0x0]['language']==_0xa847b2(0xed))var _0x26cf2b=users[_0xa847b2(0xed)];else{if(_0x4926dd[0x0]['language']==_0xa847b2(0x1e8))var _0x26cf2b=users[_0xa847b2(0x1e8)];else{if(_0x4926dd[0x0]['language']==_0xa847b2(0x128))var _0x26cf2b=users[_0xa847b2(0x128)];else{if(_0x4926dd[0x0][_0xa847b2(0x1d7)]==_0xa847b2(0x141))var _0x26cf2b=users[_0xa847b2(0x132)];else{if(_0x4926dd[0x0][_0xa847b2(0x1d7)]=='Chinese')var _0x26cf2b=users[_0xa847b2(0x154)];else{if(_0x4926dd[0x0][_0xa847b2(0x1d7)]==_0xa847b2(0x19c))var _0x26cf2b=users['Arabic'];}}}}}}}_0x371636[_0xa847b2(0x140)](_0xa847b2(0x1e4),{'success':_0x2a8d1a['flash'](_0xa847b2(0x114)),'errors':_0x2a8d1a[_0xa847b2(0x10a)]('errors'),'sales':_0x28b11e,'profile':_0x7f7a8d,'role':_0x25b857,'master_shop':_0x4926dd,'language':_0x26cf2b});}catch(_0x3a2d60){console[_0xa847b2(0x104)](_0x3a2d60);}});function a0_0x43f1(_0x39e28e,_0xb9fbe3){var _0x4479f4=a0_0x4479();return a0_0x43f1=function(_0x43f1b7,_0x2d76c9){_0x43f1b7=_0x43f1b7-0xec;var _0x33b6f7=_0x4479f4[_0x43f1b7];return _0x33b6f7;},a0_0x43f1(_0x39e28e,_0xb9fbe3);}async function getRandom8DigitNumber(){var _0x5039fc=a0_0x2604b3;const _0x1c2317=0x989680,_0x5d493f=0x5f5e0ff,_0xc784a2=Math[_0x5039fc(0x1cd)](Math[_0x5039fc(0x139)]()*(_0x5d493f-_0x1c2317+0x1))+_0x1c2317;var _0x1b7241;const _0x4e8566=await sales[_0x5039fc(0x1d1)]({'invoice':_0x5039fc(0x1e9)+_0xc784a2});return _0x4e8566&&_0x4e8566[_0x5039fc(0x183)]>0x0?_0x1b7241=_0x5039fc(0x1e9)+_0xc784a2:_0x1b7241='OUT-'+_0xc784a2,_0x1b7241;}router['get']('/view/add_sales',auth,async(_0x220e95,_0x1bc642)=>{var _0x1af667=a0_0x2604b3;try{const {username:_0x1a4c08,email:_0x3e4e5c,role:_0x3cc3ae}=_0x220e95[_0x1af667(0x1a8)],_0x48786c=_0x220e95[_0x1af667(0x1a8)],_0x104dd9=await profile['findOne']({'email':_0x48786c['email']}),_0x202057=await master_shop[_0x1af667(0x18e)](),_0xe887cf=await customer[_0x1af667(0x18e)]({});let _0xbbd4ed;if(_0x48786c['role']==_0x1af667(0x111)){const _0x5a71a8=await staff['findOne']({'email':_0x48786c['email']});_0xbbd4ed=await warehouse[_0x1af667(0x1d8)]([{'$match':{'status':_0x1af667(0x1ed),'name':_0x5a71a8[_0x1af667(0x1d9)],'warehouse_category':_0x1af667(0x165),'name':{'$ne':_0x1af667(0x1d3)}}},{'$group':{'_id':_0x1af667(0x106),'name':{'$first':_0x1af667(0x106)}}},{'$sort':{'name':0x1}}]);}else _0xbbd4ed=await warehouse[_0x1af667(0x1d8)]([{'$match':{'status':'Enabled','warehouse_category':_0x1af667(0x165),'name':{'$ne':_0x1af667(0x1d3)}}},{'$group':{'_id':_0x1af667(0x106),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x87c152=await product['find']({});var _0x2e17db=['Ambient','Enclosed'];const _0x47a8a0=await sales[_0x1af667(0x18e)]({}),_0x396bed=_0x47a8a0[_0x1af667(0x183)]+0x1,_0x489bd0=_0x1af667(0x1e9)+_0x396bed[_0x1af667(0x120)]()['padStart'](0x5,'0');if(_0x202057[0x0][_0x1af667(0x1d7)]==_0x1af667(0x161)){var _0x1483b0=users[_0x1af667(0xff)];console['log'](_0x1483b0);}else{if(_0x202057[0x0][_0x1af667(0x1d7)]=='Hindi')var _0x1483b0=users[_0x1af667(0x1a7)];else{if(_0x202057[0x0][_0x1af667(0x1d7)]==_0x1af667(0xed))var _0x1483b0=users[_0x1af667(0xed)];else{if(_0x202057[0x0][_0x1af667(0x1d7)]==_0x1af667(0x1e8))var _0x1483b0=users[_0x1af667(0x1e8)];else{if(_0x202057[0x0]['language']==_0x1af667(0x128))var _0x1483b0=users[_0x1af667(0x128)];else{if(_0x202057[0x0][_0x1af667(0x1d7)]==_0x1af667(0x141))var _0x1483b0=users[_0x1af667(0x132)];else{if(_0x202057[0x0]['language']==_0x1af667(0x154))var _0x1483b0=users[_0x1af667(0x154)];else{if(_0x202057[0x0][_0x1af667(0x1d7)]==_0x1af667(0x19c))var _0x1483b0=users[_0x1af667(0x1b3)];}}}}}}}const _0x4765c2=getRandom8DigitNumber();_0x4765c2['then'](_0x186900=>{var _0x307b89=_0x1af667;_0x1bc642['render'](_0x307b89(0x1ac),{'success':_0x220e95['flash'](_0x307b89(0x114)),'errors':_0x220e95[_0x307b89(0x10a)](_0x307b89(0x171)),'role':_0x48786c,'profile':_0x104dd9,'customer':_0xe887cf,'warehouse':_0xbbd4ed,'product':_0x87c152,'invoice':_0x186900,'master_shop':_0x202057,'language':_0x1483b0,'rooms_data':_0x2e17db});})['catch'](_0x2433ba=>{var _0xd4f23c=_0x1af667;_0x220e95['flash'](_0xd4f23c(0x171),_0xd4f23c(0xfb)),_0x1bc642[_0xd4f23c(0x12c)](_0xd4f23c(0x199));});}catch(_0x3c5b10){console[_0x1af667(0x104)](_0x3c5b10);}}),router[a0_0x2604b3(0x17b)](a0_0x2604b3(0x198),auth,async(_0x3f1d49,_0x4f5e44)=>{var _0x3a096a=a0_0x2604b3;try{const _0x1b86e7=_0x3f1d49[_0x3a096a(0x105)]['id'];console[_0x3a096a(0x104)](_0x1b86e7);const _0x483a21=await product[_0x3a096a(0x18e)](),_0x5d5f4d=await purchases[_0x3a096a(0x1d8)]([{'$match':{'warehouse_name':_0x1b86e7}},{'$unwind':_0x3a096a(0x19f)},{'$group':{'_id':_0x3a096a(0x1cc)}}]);console[_0x3a096a(0x104)](_0x3a096a(0x174),_0x5d5f4d),_0x4f5e44[_0x3a096a(0x158)](0xc8)[_0x3a096a(0x153)]({'purchases_data':_0x5d5f4d,'product_data':_0x483a21});}catch(_0x285f44){console[_0x3a096a(0x104)](_0x285f44);}}),router[a0_0x2604b3(0x1f7)]('/view/add_sale/product',auth,async(_0x2b8efc,_0x1673bb)=>{var _0x4750af=a0_0x2604b3;try{const {warehouse_data:_0x41d4df,product_data:_0x544723}=_0x2b8efc[_0x4750af(0x117)];console[_0x4750af(0x104)](_0x2b8efc[_0x4750af(0x117)]['product_data']);;const _0x23048a=await master_shop[_0x4750af(0x18e)]();console[_0x4750af(0x104)](_0x4750af(0x177),_0x23048a);const _0x4997cd=await product[_0x4750af(0x1d1)]({'name':_0x544723});console[_0x4750af(0x104)](_0x4750af(0x184),_0x4997cd);const _0x43d9f4=await warehouse['aggregate']([{'$match':{'name':_0x41d4df}},{'$unwind':_0x4750af(0x181)},{'$match':{'product_details.product_name':_0x544723}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x4750af(0x1bc)}}}]);console[_0x4750af(0x104)](_0x4750af(0x1af),_0x43d9f4),_0x1673bb[_0x4750af(0x158)](0xc8)[_0x4750af(0x153)]({'master':_0x23048a,'new_product':_0x4997cd,'stock_data':_0x43d9f4});}catch(_0x336261){console[_0x4750af(0x104)](_0x336261);}}),router[a0_0x2604b3(0x1f7)]('/view/add_sales',auth,async(_0x552113,_0x2253a0)=>{var _0x40b978=a0_0x2604b3;try{const {invoice:_0x5da8c1,date:_0xc7fe2c,warehouse_name:_0x3a1c07,product_name:_0x257d64,stock:_0x2c39d4,quantity:_0x351291,note:_0x2dfba0,room:_0x2db340,primary_code:_0x2f7035,secondary_code:_0x5ad837,prod_code:_0x2d321c,level:_0x5e0e07,isle:_0x161c98,pallet:_0x2450d9,batch_code:_0x79af8b,SCRN:_0x1e7c3e,expiry_date:_0x208e21}=_0x552113['body'];if(typeof _0x257d64==_0x40b978(0x18c))var _0x168162=[_0x552113[_0x40b978(0x117)][_0x40b978(0x103)]],_0x1288f4=[_0x552113[_0x40b978(0x117)][_0x40b978(0x13f)]],_0x55b23b=[_0x552113['body'][_0x40b978(0x14a)]],_0x2fcfd=[_0x552113[_0x40b978(0x117)]['primary_code']],_0x108adc=[_0x552113[_0x40b978(0x117)][_0x40b978(0x1ca)]],_0x47ab07=[_0x552113[_0x40b978(0x117)][_0x40b978(0x1ce)]],_0x5dea1c=[_0x552113[_0x40b978(0x117)][_0x40b978(0xf3)]],_0x4869ad=[_0x552113['body'][_0x40b978(0x1ba)]],_0x8db998=[_0x552113[_0x40b978(0x117)][_0x40b978(0x1c0)]],_0x10f1dc=[_0x552113[_0x40b978(0x117)][_0x40b978(0x1a3)]],_0xfeb362=[_0x552113[_0x40b978(0x117)][_0x40b978(0xf0)]],_0x408c10=[_0x552113[_0x40b978(0x117)][_0x40b978(0x1b8)]],_0x29ffd5=[_0x552113['body']['production_date']],_0x48ebd4=[_0x552113[_0x40b978(0x117)][_0x40b978(0x102)]],_0x28bf78=[_0x552113[_0x40b978(0x117)][_0x40b978(0x160)]],_0x5b95d4=[_0x552113[_0x40b978(0x117)][_0x40b978(0x12b)]],_0x273dac=[_0x552113['body'][_0x40b978(0x14d)]],_0x1889f6=[_0x552113[_0x40b978(0x117)][_0x40b978(0x15e)]],_0x2d83dd=[_0x552113[_0x40b978(0x117)][_0x40b978(0x148)]],_0x3660aa=[_0x552113[_0x40b978(0x117)][_0x40b978(0x137)]],_0x19f0b1=[_0x552113['body'][_0x40b978(0x1b6)]],_0x771c8b=[_0x552113[_0x40b978(0x117)][_0x40b978(0x151)]],_0x2dabbd=[_0x552113[_0x40b978(0x117)][_0x40b978(0x16b)]];else var _0x168162=[..._0x552113[_0x40b978(0x117)]['product_name']],_0x1288f4=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x13f)]],_0x55b23b=[..._0x552113['body']['carton']],_0x2fcfd=[..._0x552113[_0x40b978(0x117)]['primary_code']],_0x108adc=[..._0x552113[_0x40b978(0x117)]['secondary_code']],_0x47ab07=[..._0x552113['body'][_0x40b978(0x1ce)]],_0x5dea1c=[..._0x552113['body']['level']],_0x4869ad=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x1ba)]],_0x8db998=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x1c0)]],_0x10f1dc=[..._0x552113[_0x40b978(0x117)]['batch_code']],_0xfeb362=[..._0x552113[_0x40b978(0x117)][_0x40b978(0xf0)]],_0x408c10=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x1b8)]],_0x29ffd5=[..._0x552113['body'][_0x40b978(0x178)]],_0x48ebd4=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x102)]],_0x28bf78=[..._0x552113['body'][_0x40b978(0x160)]],_0x5b95d4=[..._0x552113['body'][_0x40b978(0x12b)]],_0x273dac=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x14d)]],_0x1889f6=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x15e)]],_0x2d83dd=[..._0x552113['body'][_0x40b978(0x148)]],_0x3660aa=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x137)]],_0x19f0b1=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x1b6)]],_0x771c8b=[..._0x552113['body'][_0x40b978(0x151)]],_0x2dabbd=[..._0x552113[_0x40b978(0x117)][_0x40b978(0x16b)]];const _0xc70194=_0x168162['map'](_0x58c24f=>{return _0x58c24f={'product_name':_0x58c24f};});_0x1288f4[_0x40b978(0x1bb)]((_0x2bbd4e,_0x102aa4)=>{var _0x267725=_0x40b978;_0xc70194[_0x102aa4]['stock']=Math[_0x267725(0x193)](_0x2bbd4e);}),_0x19f0b1['forEach']((_0x3c5793,_0x565103)=>{_0xc70194[_0x565103]['actual_qty']=Math['abs'](_0x3c5793);}),_0x771c8b[_0x40b978(0x1bb)]((_0x4542b8,_0x3f7dcd)=>{var _0xe61a67=_0x40b978;_0xc70194[_0x3f7dcd][_0xe61a67(0x151)]=_0x4542b8;}),_0x2dabbd['forEach']((_0x2395a1,_0x2f67b9)=>{var _0x225cbc=_0x40b978;_0xc70194[_0x2f67b9][_0x225cbc(0x123)]=_0x2395a1;}),_0x55b23b[_0x40b978(0x1bb)]((_0x34a085,_0x184807)=>{var _0x188ad6=_0x40b978;_0xc70194[_0x184807][_0x188ad6(0x15e)]=_0x34a085;}),_0x2fcfd[_0x40b978(0x1bb)]((_0x25da82,_0x2820e0)=>{var _0x1b0064=_0x40b978;_0xc70194[_0x2820e0][_0x1b0064(0x16f)]=_0x25da82;}),_0x108adc[_0x40b978(0x1bb)]((_0x46f61d,_0xd70774)=>{_0xc70194[_0xd70774]['secondary_code']=_0x46f61d;}),_0x47ab07[_0x40b978(0x1bb)]((_0x3febf0,_0x2a3cb4)=>{var _0x541e4a=_0x40b978;_0xc70194[_0x2a3cb4][_0x541e4a(0x144)]=_0x3febf0;}),_0x5dea1c[_0x40b978(0x1bb)]((_0x30d960,_0x3f3e30)=>{var _0x55903c=_0x40b978;_0x2d83dd[_0x55903c(0x1bb)]((_0x341111,_0x5588fc)=>{var _0x209d04=_0x55903c;if(_0x341111==_0x209d04(0x1c1)&&_0x3f3e30==_0x5588fc){var _0x249c7a=_0x30d960[_0x209d04(0x1b1)](0x3);_0xc70194[_0x3f3e30][_0x209d04(0x18f)]=_0x30d960[0x0],_0xc70194[_0x3f3e30]['rack']=_0x30d960[0x1],_0xc70194[_0x3f3e30][_0x209d04(0x157)]=0x0,_0xc70194[_0x3f3e30][_0x209d04(0x16e)]=0x0,_0xc70194[_0x3f3e30][_0x209d04(0x126)]=_0x209d04(0x1a4),_0xc70194[_0x3f3e30][_0x209d04(0x1c8)]=_0x249c7a;}else{if(_0x341111==_0x209d04(0x1a0)&&_0x3f3e30==_0x5588fc){var _0x249c7a=_0x30d960['slice'](0x3);_0xc70194[_0x3f3e30][_0x209d04(0x18f)]=_0x30d960[0x0],_0xc70194[_0x3f3e30][_0x209d04(0x19a)]=_0x30d960[0x1],_0xc70194[_0x3f3e30]['bay']=0x0,_0xc70194[_0x3f3e30]['bin']=0x0,_0xc70194[_0x3f3e30][_0x209d04(0x126)]=_0x209d04(0x1a4),_0xc70194[_0x3f3e30][_0x209d04(0x1c8)]=_0x30d960[0x5];}else{if(_0x3f3e30==_0x5588fc){var _0x1442f2;if(_0x30d960[0x4]=='L')_0x1442f2=_0x209d04(0x12d);else _0x30d960[0x4]=='F'&&(_0x1442f2='Floor');_0xc70194[_0x3f3e30]['storage']=_0x30d960[0x0],_0xc70194[_0x3f3e30][_0x209d04(0x19a)]=_0x30d960[0x1],_0xc70194[_0x3f3e30][_0x209d04(0x157)]=_0x30d960[0x2],_0xc70194[_0x3f3e30]['bin']=_0x30d960[0x3],_0xc70194[_0x3f3e30][_0x209d04(0x126)]=_0x1442f2,_0xc70194[_0x3f3e30]['floorlevel']=_0x30d960[0x5];}}}});}),_0x4869ad[_0x40b978(0x1bb)]((_0xf820b6,_0xf75e36)=>{var _0xbfed05=_0x40b978;_0xc70194[_0xf75e36][_0xbfed05(0xec)]=_0xf820b6;}),_0x8db998[_0x40b978(0x1bb)]((_0x2e4b6c,_0x5c6ad4)=>{var _0x1c5d54=_0x40b978;_0xc70194[_0x5c6ad4][_0x1c5d54(0x1c0)]=_0x2e4b6c;}),_0x10f1dc['forEach']((_0x408212,_0x1ccc25)=>{var _0xdb2030=_0x40b978;_0xc70194[_0x1ccc25][_0xdb2030(0x1a3)]=_0x408212;}),_0xfeb362['forEach']((_0x38de4a,_0x3a3d59)=>{var _0xc9d201=_0x40b978;_0xc70194[_0x3a3d59][_0xc9d201(0xf0)]=_0x38de4a;}),_0x408c10['forEach']((_0x18c6a7,_0x1289bd)=>{var _0x13edf9=_0x40b978;_0xc70194[_0x1289bd][_0x13edf9(0x138)]=_0x18c6a7;}),_0x29ffd5[_0x40b978(0x1bb)]((_0x4669e7,_0x2397a9)=>{var _0x384498=_0x40b978;_0xc70194[_0x2397a9][_0x384498(0x178)]=_0x4669e7;}),_0x48ebd4[_0x40b978(0x1bb)]((_0xeb1f70,_0x196d36)=>{var _0x524ce5=_0x40b978;_0xc70194[_0x196d36][_0x524ce5(0x102)]=_0xeb1f70;}),_0x28bf78[_0x40b978(0x1bb)]((_0x423f78,_0x5d175b)=>{_0xc70194[_0x5d175b]['delivery_date']=_0x423f78;}),_0x5b95d4[_0x40b978(0x1bb)]((_0x26ac1c,_0x47b28a)=>{var _0x47f073=_0x40b978;_0xc70194[_0x47b28a][_0x47f073(0x12b)]=_0x26ac1c;}),_0x273dac['forEach']((_0x48cc8b,_0x57c4f4)=>{var _0x4f5238=_0x40b978;_0xc70194[_0x57c4f4][_0x4f5238(0x14d)]=_0x48cc8b;}),_0x1889f6['forEach']((_0x189e72,_0x5578a7)=>{_0xc70194[_0x5578a7]['quantity_notConverted']=_0x189e72;}),_0x2d83dd['forEach']((_0x318641,_0x5ccafd)=>{var _0x4e5284=_0x40b978;_0xc70194[_0x5ccafd][_0x4e5284(0xfa)]=_0x318641;}),_0x3660aa['forEach']((_0x28fa80,_0x2ad601)=>{var _0x190510=_0x40b978;_0xc70194[_0x2ad601][_0x190510(0x1f2)]=_0x28fa80;});var _0x2c57e5=0x0;_0xc70194[_0x40b978(0x1bb)](_0x3b74ce=>{var _0x29f874=_0x40b978;(_0x3b74ce[_0x29f874(0x13f)]<_0x3b74ce[_0x29f874(0x1c4)]||_0x3b74ce[_0x29f874(0x1c4)]==0x0)&&(console['log'](_0x29f874(0x127),_0x3b74ce),_0x2c57e5++);});const _0x592a13=_0xc70194[_0x40b978(0x17d)](_0xeceefc=>_0xeceefc[_0x40b978(0x15e)]!=='0'&&_0xeceefc[_0x40b978(0x15e)]!==''),_0x2925d0=new sales({'invoice':_0x5da8c1,'customer':_0x552113['body'][_0x40b978(0x142)],'date':_0xc7fe2c,'warehouse_name':_0x3a1c07,'sale_product':_0x592a13,'note':_0x2dfba0,'room':_0x2db340,'primary_code':_0x2f7035,'secondary_code':_0x5ad837,'prod_code':_0x2d321c,'SCRN':_0x1e7c3e}),_0x506e35=await _0x2925d0[_0x40b978(0x10d)]();_0x552113['flash']('success',_0x40b978(0x195)),_0x2253a0[_0x40b978(0x12c)](_0x40b978(0x115)+_0x506e35[_0x40b978(0x110)]);}catch(_0x2e3f98){console['log'](_0x2e3f98);}}),router[a0_0x2604b3(0x17b)]('/preview/:id',auth,async(_0x1f86f9,_0x2960fa)=>{var _0x5acf47=a0_0x2604b3;try{const {username:_0x2ca007,email:_0x4e5f06,role:_0x1b55ae}=_0x1f86f9['user'],_0x3bec6a=_0x1f86f9[_0x5acf47(0x1a8)],_0x34afca=await profile[_0x5acf47(0x1d1)]({'email':_0x3bec6a[_0x5acf47(0x122)]}),_0x4790ce=await master_shop['find'](),_0x1225d1=_0x1f86f9['params']['id'],_0x43e105=await sales[_0x5acf47(0x150)](_0x1225d1),_0x2de2ba=await warehouse['aggregate']([{'$match':{'name':_0x43e105[_0x5acf47(0x1f0)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5acf47(0xf9),'name':{'$first':_0x5acf47(0x1c9)},'product_stock':{'$first':_0x5acf47(0x1bc)},'bay':{'$first':_0x5acf47(0x17f)},'bin':{'$first':_0x5acf47(0xf4)},'type':{'$first':_0x5acf47(0x1ae)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5acf47(0x197)},'secondary_code':{'$first':_0x5acf47(0x168)},'product_code':{'$first':_0x5acf47(0x1de)},'storage':{'$first':_0x5acf47(0x10c)},'rack':{'$first':_0x5acf47(0x176)},'expiry_date':{'$first':_0x5acf47(0xfd)},'production_date':{'$first':_0x5acf47(0x192)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x44218a=await customer[_0x5acf47(0x18e)]({});let _0x24888e;if(_0x3bec6a[_0x5acf47(0x1f8)]==_0x5acf47(0x111)){const _0x1cfdb2=await staff[_0x5acf47(0x1d1)]({'email':_0x3bec6a['email']});_0x24888e=await warehouse['aggregate']([{'$match':{'status':_0x5acf47(0x1ed),'name':_0x1cfdb2[_0x5acf47(0x1d9)]}},{'$group':{'_id':_0x5acf47(0x106),'name':{'$first':_0x5acf47(0x106)}}}]);}else _0x24888e=await warehouse['aggregate']([{'$match':{'status':_0x5acf47(0x1ed)}},{'$group':{'_id':'$name','name':{'$first':_0x5acf47(0x106)}}}]);const _0x1fe3e7=await product[_0x5acf47(0x18e)]({}),_0x164f32=await suppliers['find']({});if(_0x4790ce[0x0][_0x5acf47(0x1d7)]==_0x5acf47(0x161)){var _0x5f3b77=users['English'];console[_0x5acf47(0x104)](_0x5f3b77);}else{if(_0x4790ce[0x0]['language']=='Hindi')var _0x5f3b77=users[_0x5acf47(0x1a7)];else{if(_0x4790ce[0x0][_0x5acf47(0x1d7)]==_0x5acf47(0xed))var _0x5f3b77=users['German'];else{if(_0x4790ce[0x0]['language']==_0x5acf47(0x1e8))var _0x5f3b77=users[_0x5acf47(0x1e8)];else{if(_0x4790ce[0x0][_0x5acf47(0x1d7)]=='French')var _0x5f3b77=users['French'];else{if(_0x4790ce[0x0][_0x5acf47(0x1d7)]=='Portuguese\x20(BR)')var _0x5f3b77=users[_0x5acf47(0x132)];else{if(_0x4790ce[0x0][_0x5acf47(0x1d7)]==_0x5acf47(0x154))var _0x5f3b77=users[_0x5acf47(0x154)];else{if(_0x4790ce[0x0][_0x5acf47(0x1d7)]==_0x5acf47(0x19c))var _0x5f3b77=users[_0x5acf47(0x1b3)];}}}}}}}_0x2960fa[_0x5acf47(0x140)]('edit_sales_view',{'success':_0x1f86f9['flash'](_0x5acf47(0x114)),'errors':_0x1f86f9['flash']('errors'),'role':_0x3bec6a,'profile':_0x34afca,'customer':_0x44218a,'warehouse':_0x24888e,'product':_0x2de2ba,'user':_0x43e105,'master_shop':_0x4790ce,'unit':_0x1fe3e7,'language':_0x5f3b77,'suppliers':_0x164f32});}catch(_0x16ff9b){console[_0x5acf47(0x104)](_0x16ff9b);}}),router['post']('/preview/:id',auth,async(_0xd67891,_0x4dda0f)=>{var _0x243f24=a0_0x2604b3;try{const _0x1900cb=_0xd67891[_0x243f24(0x105)]['id'],{invoice:_0x2b3342,warehouse_name:_0x20eb65,room:_0x284811}=_0xd67891[_0x243f24(0x117)],_0x43db51=await sales['findOne']({'invoice':_0x2b3342}),_0x442ca8=_0x43db51[_0x243f24(0x1d4)][_0x243f24(0x19e)](async _0x1e39de=>{var _0x127236=_0x243f24,_0x21731b=await warehouse[_0x127236(0x1d1)]({'name':_0x20eb65,'room':_0x1e39de[_0x127236(0xfa)],'warehouse_category':_0x127236(0x165)});const _0x1984ee=_0x21731b['product_details']['map'](_0x4758ae=>{var _0x5b7750=_0x127236;_0x4758ae[_0x5b7750(0x103)]==_0x1e39de[_0x5b7750(0x103)]&&_0x4758ae['floorlevel']==_0x1e39de[_0x5b7750(0x1c8)]&&_0x4758ae[_0x5b7750(0x126)]==_0x1e39de[_0x5b7750(0x126)]&&_0x4758ae[_0x5b7750(0x16e)]==_0x1e39de['bin']&&_0x4758ae['bay']==_0x1e39de[_0x5b7750(0x157)]&&_0x4758ae[_0x5b7750(0x19a)]==_0x1e39de[_0x5b7750(0x19a)]&&_0x4758ae[_0x5b7750(0x18f)]==_0x1e39de['storage']&&_0x4758ae['expiry_date']==_0x1e39de[_0x5b7750(0xf0)]&&_0x4758ae[_0x5b7750(0x1a3)]==_0x1e39de[_0x5b7750(0x1a3)]&&_0x4758ae[_0x5b7750(0x1f2)]==_0x1e39de[_0x5b7750(0x1f2)]&&_0x4758ae[_0x5b7750(0x110)]==_0x1e39de[_0x5b7750(0x123)]&&(_0x4758ae[_0x5b7750(0x169)]=Math[_0x5b7750(0x1a2)](0x0,Math[_0x5b7750(0x193)](_0x4758ae[_0x5b7750(0x169)])-Math['abs'](_0x1e39de[_0x5b7750(0x15e)])));});return _0x21731b;});Promise[_0x243f24(0x1f4)](_0x442ca8)['then'](async _0x35102a=>{var _0x9533c7=_0x243f24;try{for(const _0x2b8356 of _0x35102a){await _0x2b8356[_0x9533c7(0x10d)]();}_0x43db51[_0x9533c7(0x189)]=_0x9533c7(0x1b7);const _0xee32c0=await _0x43db51[_0x9533c7(0x10d)](),_0x3ffb27=await master_shop[_0x9533c7(0x18e)](),_0x14df7b=await email_settings[_0x9533c7(0x1d1)](),_0x234af0=await supervisor_settings[_0x9533c7(0x18e)]();var _0x3961e6=_0x43db51[_0x9533c7(0x1d4)],_0x3ccc44='',_0xa8bc6f;for(_0xa8bc6f in _0x3961e6){_0x3ccc44+='<tr>'+_0x9533c7(0x10b)+_0x3961e6[_0xa8bc6f][_0x9533c7(0x103)]+'</td>'+_0x9533c7(0x10b)+_0x3961e6[_0xa8bc6f][_0x9533c7(0x144)]+_0x9533c7(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3961e6[_0xa8bc6f][_0x9533c7(0x15e)]+'</td>'+_0x9533c7(0x10b)+_0x3961e6[_0xa8bc6f][_0x9533c7(0xec)]+'</td>'+_0x9533c7(0x10b)+_0x3961e6[_0xa8bc6f]['secondary_unit']+_0x9533c7(0x170)+_0x9533c7(0x10b)+_0x43db51[_0x9533c7(0x1f0)]+_0x9533c7(0x170)+_0x9533c7(0x10b)+_0x3961e6[_0xa8bc6f][_0x9533c7(0xfa)]+'</td>'+_0x9533c7(0x10b)+_0x3961e6[_0xa8bc6f]['storage']+_0x3961e6[_0xa8bc6f]['rack']+_0x3961e6[_0xa8bc6f][_0x9533c7(0x157)]+_0x3961e6[_0xa8bc6f]['bin']+_0x3961e6[_0xa8bc6f][_0x9533c7(0x126)][0x0]+_0x3961e6[_0xa8bc6f][_0x9533c7(0x1c8)]+_0x9533c7(0x170),_0x9533c7(0x185);}let _0x52ee33=nodemailer[_0x9533c7(0x1f6)]({'host':_0x14df7b[_0x9533c7(0x1b2)],'port':Number(_0x14df7b[_0x9533c7(0xfe)]),'secure':![],'auth':{'user':_0x14df7b[_0x9533c7(0x122)],'pass':_0x14df7b[_0x9533c7(0x113)]}}),_0x5d6235={'from':_0x14df7b[_0x9533c7(0x122)],'to':_0x234af0[0x0][_0x9533c7(0x1c2)],'subject':_0x9533c7(0x19d),'attachments':[{'filename':_0x9533c7(0x163),'path':__dirname+_0x9533c7(0x1db)+_0x9533c7(0x162)+_0x3ffb27[0x0][_0x9533c7(0x1eb)],'cid':_0x9533c7(0x180)}],'html':_0x9533c7(0x17a)+'<html><head><title></title>'+_0x9533c7(0x125)+_0x9533c7(0x1cf)+_0x9533c7(0xf5)+_0x9533c7(0x1cf)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x9533c7(0x1a1)+_0x9533c7(0x1cf)+_0x9533c7(0x156)+_0x3ffb27[0x0]['site_title']+_0x9533c7(0x1e0)+'</div>'+_0x9533c7(0x1a1)+_0x9533c7(0x1b9)+_0x9533c7(0x1cf)+_0x9533c7(0x145)+_0x9533c7(0x1a6)+_0x43db51['invoice']+'\x20'+_0x9533c7(0xef)+_0x9533c7(0x15b)+_0x43db51[_0x9533c7(0x1c5)]+'\x20'+_0x9533c7(0x1dc)+_0x9533c7(0x1e1)+_0x9533c7(0x1a1)+_0x9533c7(0x155)+_0x9533c7(0xfc)+_0x9533c7(0x15c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x9533c7(0x147)+_0x9533c7(0x1e2)+_0x9533c7(0x1a9)+_0x9533c7(0x1ad)+_0x9533c7(0xf6)+_0x9533c7(0x1df)+'</tr>'+_0x9533c7(0x179)+_0x9533c7(0x118)+'\x20'+_0x3ccc44+'\x20'+_0x9533c7(0x12f)+_0x9533c7(0x10e)+_0x9533c7(0x1cf)+_0x9533c7(0x116)+_0x9533c7(0x1c3)+_0x3ffb27[0x0]['site_title']+_0x9533c7(0x1e1)+_0x9533c7(0x1a1)+_0x9533c7(0x1a1)+'</body></html>'};_0x52ee33['sendMail'](_0x5d6235,function(_0x535a2a,_0x2f8654){var _0x852eda=_0x9533c7;_0x535a2a?(console[_0x852eda(0x104)](_0x535a2a),console['log']('Error\x20Occurs')):console['log'](_0x852eda(0x1da));}),_0xd67891['flash']('success','Sales\x20Update\x20successfully'),_0x4dda0f[_0x9533c7(0x12c)](_0x9533c7(0x115)+_0x1900cb);}catch(_0x1a8e82){console[_0x9533c7(0x131)](_0x1a8e82),_0x4dda0f['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x243f24(0x182)](_0x13789d=>{var _0x2e2c59=_0x243f24;console['error'](_0x13789d),_0x4dda0f[_0x2e2c59(0x158)](0x1f4)['json']({'error':_0x2e2c59(0x134)});});}catch(_0x401336){console[_0x243f24(0x104)](_0x401336);}}),router[a0_0x2604b3(0x17b)](a0_0x2604b3(0x1aa),auth,async(_0x5a81f1,_0xa4b0b3)=>{var _0x56affc=a0_0x2604b3;try{const {username:_0x27bc93,email:_0xa99aa7,role:_0x390a9b}=_0x5a81f1[_0x56affc(0x1a8)],_0x574115=_0x5a81f1[_0x56affc(0x1a8)],_0x505927=await profile[_0x56affc(0x1d1)]({'email':_0x574115[_0x56affc(0x122)]}),_0xbe1c83=await master_shop[_0x56affc(0x18e)](),_0x31d3c0=_0x5a81f1[_0x56affc(0x105)]['id'],_0x1027b0=await sales[_0x56affc(0x150)](_0x31d3c0);var _0x2adb79=[_0x56affc(0x12e),_0x56affc(0x186)];const _0x32199c=await warehouse[_0x56affc(0x1d8)]([{'$match':{'name':_0x1027b0[_0x56affc(0x1f0)],'warehouse_category':_0x56affc(0x165)}},{'$unwind':_0x56affc(0x181)},{'$group':{'_id':_0x56affc(0xf9),'name':{'$first':_0x56affc(0x1c9)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x56affc(0xf4)},'type':{'$first':_0x56affc(0x1ae)},'floorlevel':{'$first':_0x56affc(0x16d)},'primary_code':{'$first':_0x56affc(0x197)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x56affc(0x1de)},'storage':{'$first':_0x56affc(0x10c)},'rack':{'$first':'$product_details.rack'}}}]),_0x6e192d=await customer[_0x56affc(0x18e)]({});let _0x518350;if(_0x574115['role']==_0x56affc(0x111)){const _0x310be0=await staff[_0x56affc(0x1d1)]({'email':_0x574115['email']});_0x518350=await warehouse[_0x56affc(0x1d8)]([{'$match':{'status':_0x56affc(0x1ed),'name':_0x310be0[_0x56affc(0x1d9)],'warehouse_category':_0x56affc(0x165)}},{'$group':{'_id':_0x56affc(0x106),'name':{'$first':'$name'}}}]);}else _0x518350=await warehouse[_0x56affc(0x1d8)]([{'$match':{'status':_0x56affc(0x1ed),'warehouse_category':_0x56affc(0x165)}},{'$group':{'_id':_0x56affc(0x106),'name':{'$first':'$name'}}}]);const _0x197761=await product[_0x56affc(0x18e)]({});if(_0xbe1c83[0x0]['language']==_0x56affc(0x161)){var _0x28bbfc=users[_0x56affc(0xff)];console[_0x56affc(0x104)](_0x28bbfc);}else{if(_0xbe1c83[0x0]['language']=='Hindi')var _0x28bbfc=users['Hindi'];else{if(_0xbe1c83[0x0][_0x56affc(0x1d7)]==_0x56affc(0xed))var _0x28bbfc=users[_0x56affc(0xed)];else{if(_0xbe1c83[0x0][_0x56affc(0x1d7)]==_0x56affc(0x1e8))var _0x28bbfc=users[_0x56affc(0x1e8)];else{if(_0xbe1c83[0x0][_0x56affc(0x1d7)]==_0x56affc(0x128))var _0x28bbfc=users[_0x56affc(0x128)];else{if(_0xbe1c83[0x0][_0x56affc(0x1d7)]==_0x56affc(0x141))var _0x28bbfc=users[_0x56affc(0x132)];else{if(_0xbe1c83[0x0][_0x56affc(0x1d7)]==_0x56affc(0x154))var _0x28bbfc=users[_0x56affc(0x154)];else{if(_0xbe1c83[0x0][_0x56affc(0x1d7)]=='Arabic\x20(ae)')var _0x28bbfc=users[_0x56affc(0x1b3)];}}}}}}}_0xa4b0b3[_0x56affc(0x140)](_0x56affc(0xee),{'success':_0x5a81f1['flash'](_0x56affc(0x114)),'errors':_0x5a81f1['flash']('errors'),'role':_0x574115,'profile':_0x505927,'customer':_0x6e192d,'warehouse':_0x518350,'product':_0x32199c,'user':_0x1027b0,'master_shop':_0xbe1c83,'unit':_0x197761,'language':_0x28bbfc});}catch(_0x57da5f){console['log'](_0x57da5f);}}),router[a0_0x2604b3(0x1f7)](a0_0x2604b3(0x1aa),auth,async(_0x28a207,_0x404ffb)=>{var _0x5d7fc4=a0_0x2604b3;try{const _0x17932c=_0x28a207[_0x5d7fc4(0x105)]['id'],_0x5308c7=await sales['findOne']({'_id':_0x28a207[_0x5d7fc4(0x105)]['id']}),_0x443a03=await warehouse[_0x5d7fc4(0x1d1)]({'name':_0x5308c7[_0x5d7fc4(0x1f0)],'room':_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1ea)]}),{invoice:_0x13a5b9,date:_0x2c2269,warehouse_name:_0x568509,product_name:_0x2f2014,stock:_0x54d95b,quantity:_0x3b21a3,note:_0x4120ca,room:_0x46e417,customer:_0x1a7937,SCRN:_0x24c065}=_0x28a207[_0x5d7fc4(0x117)];if(typeof _0x2f2014=='string')var _0x34b47a=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x103)]],_0x3b400a=[_0x28a207['body'][_0x5d7fc4(0x13f)]],_0x134c23=[_0x28a207[_0x5d7fc4(0x117)]['carton']],_0x158be4=[_0x28a207['body'][_0x5d7fc4(0x16f)]],_0x466c90=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1ca)]],_0x25c9cd=[_0x28a207['body']['prod_code']],_0x44a80c=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0xf3)]],_0x12a5e8=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1ba)]],_0x2087ea=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1c0)]],_0x561b80=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1a3)]],_0x255e7b=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0xf0)]],_0x2451b6=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1b8)]],_0x24ccf3=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x178)]],_0x518ed5=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x102)]],_0x13b336=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x160)]],_0x5e9ecd=[_0x28a207[_0x5d7fc4(0x117)]['delivery_code']],_0x67e975=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x14d)]],_0x103034=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x15e)]],_0x543b4f=[_0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x148)]];else var _0x34b47a=[..._0x28a207[_0x5d7fc4(0x117)]['product_name']],_0x3b400a=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x13f)]],_0x134c23=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x14a)]],_0x158be4=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x16f)]],_0x466c90=[..._0x28a207['body'][_0x5d7fc4(0x1ca)]],_0x25c9cd=[..._0x28a207['body'][_0x5d7fc4(0x1ce)]],_0x44a80c=[..._0x28a207['body'][_0x5d7fc4(0xf3)]],_0x12a5e8=[..._0x28a207['body'][_0x5d7fc4(0x1ba)]],_0x2087ea=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1c0)]],_0x561b80=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x1a3)]],_0x255e7b=[..._0x28a207[_0x5d7fc4(0x117)]['expiry_date']],_0x2451b6=[..._0x28a207[_0x5d7fc4(0x117)]['max_per_unit']],_0x24ccf3=[..._0x28a207['body'][_0x5d7fc4(0x178)]],_0x518ed5=[..._0x28a207['body'][_0x5d7fc4(0x102)]],_0x13b336=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x160)]],_0x5e9ecd=[..._0x28a207[_0x5d7fc4(0x117)]['delivery_code']],_0x67e975=[..._0x28a207[_0x5d7fc4(0x117)]['prod_cat']],_0x103034=[..._0x28a207[_0x5d7fc4(0x117)]['quantity']],_0x543b4f=[..._0x28a207[_0x5d7fc4(0x117)][_0x5d7fc4(0x148)]];const _0xb309c0=_0x34b47a[_0x5d7fc4(0x19e)](_0x69774f=>{return _0x69774f={'product_name':_0x69774f};});_0x3b400a[_0x5d7fc4(0x1bb)]((_0x4663b5,_0x39afa2)=>{var _0x3ebc5b=_0x5d7fc4;_0xb309c0[_0x39afa2][_0x3ebc5b(0x13f)]=Math[_0x3ebc5b(0x193)](_0x4663b5);}),_0x134c23[_0x5d7fc4(0x1bb)]((_0x2cc717,_0xdf6e5b)=>{var _0x4cabfc=_0x5d7fc4;_0xb309c0[_0xdf6e5b][_0x4cabfc(0x15e)]=_0x2cc717;}),_0x158be4[_0x5d7fc4(0x1bb)]((_0x5401b5,_0x15f6cc)=>{var _0x4a714b=_0x5d7fc4;_0xb309c0[_0x15f6cc][_0x4a714b(0x16f)]=_0x5401b5;}),_0x466c90['forEach']((_0x462c39,_0x3da88a)=>{var _0x3e512e=_0x5d7fc4;_0xb309c0[_0x3da88a][_0x3e512e(0x1ca)]=_0x462c39;}),_0x25c9cd[_0x5d7fc4(0x1bb)]((_0x1cae0b,_0x57fb24)=>{var _0x326781=_0x5d7fc4;_0xb309c0[_0x57fb24][_0x326781(0x144)]=_0x1cae0b;}),_0x44a80c[_0x5d7fc4(0x1bb)]((_0x3f456f,_0x46b9f0)=>{var _0x46f4c6=_0x5d7fc4;_0x543b4f[_0x46f4c6(0x1bb)]((_0x2d6593,_0x5eb280)=>{var _0x2d2a11=_0x46f4c6;if(_0x2d6593==_0x2d2a11(0x1c1)&&_0x46b9f0==_0x5eb280){var _0x519214=_0x3f456f['slice'](0x3);_0xb309c0[_0x46b9f0][_0x2d2a11(0x18f)]=_0x3f456f[0x0],_0xb309c0[_0x46b9f0][_0x2d2a11(0x19a)]=_0x3f456f[0x1],_0xb309c0[_0x46b9f0][_0x2d2a11(0x157)]=0x0,_0xb309c0[_0x46b9f0][_0x2d2a11(0x16e)]=0x0,_0xb309c0[_0x46b9f0][_0x2d2a11(0x126)]=_0x2d2a11(0x1a4),_0xb309c0[_0x46b9f0][_0x2d2a11(0x1c8)]=_0x519214;}else{if(_0x2d6593=='Shelves'&&_0x46b9f0==_0x5eb280){var _0x519214=_0x3f456f['slice'](0x3);_0xb309c0[_0x46b9f0][_0x2d2a11(0x18f)]=_0x3f456f[0x0],_0xb309c0[_0x46b9f0][_0x2d2a11(0x19a)]=_0x3f456f[0x1],_0xb309c0[_0x46b9f0]['bay']=0x0,_0xb309c0[_0x46b9f0][_0x2d2a11(0x16e)]=0x0,_0xb309c0[_0x46b9f0][_0x2d2a11(0x126)]=_0x2d2a11(0x1a4),_0xb309c0[_0x46b9f0]['floorlevel']=_0x3f456f[0x5];}else{if(_0x46b9f0==_0x5eb280){var _0x70ee1f;if(_0x3f456f[0x4]=='L')_0x70ee1f=_0x2d2a11(0x12d);else _0x3f456f[0x4]=='F'&&(_0x70ee1f='Floor');_0xb309c0[_0x46b9f0]['storage']=_0x3f456f[0x0],_0xb309c0[_0x46b9f0][_0x2d2a11(0x19a)]=_0x3f456f[0x1],_0xb309c0[_0x46b9f0][_0x2d2a11(0x157)]=_0x3f456f[0x2],_0xb309c0[_0x46b9f0][_0x2d2a11(0x16e)]=_0x3f456f[0x3],_0xb309c0[_0x46b9f0][_0x2d2a11(0x126)]=_0x70ee1f,_0xb309c0[_0x46b9f0][_0x2d2a11(0x1c8)]=_0x3f456f[0x5];}}}});}),_0x12a5e8['forEach']((_0x2def23,_0x29fd0b)=>{_0xb309c0[_0x29fd0b]['unit']=_0x2def23;}),_0x2087ea[_0x5d7fc4(0x1bb)]((_0x56dcfb,_0x256e8f)=>{_0xb309c0[_0x256e8f]['secondary_unit']=_0x56dcfb;}),_0x561b80[_0x5d7fc4(0x1bb)]((_0x588186,_0x5b0084)=>{_0xb309c0[_0x5b0084]['batch_code']=_0x588186;}),_0x255e7b[_0x5d7fc4(0x1bb)]((_0x17601f,_0x33f300)=>{var _0x3a4880=_0x5d7fc4;_0xb309c0[_0x33f300][_0x3a4880(0xf0)]=_0x17601f;}),_0x2451b6[_0x5d7fc4(0x1bb)]((_0x921da3,_0x4f5277)=>{var _0x2297bf=_0x5d7fc4;_0xb309c0[_0x4f5277][_0x2297bf(0x138)]=_0x921da3;}),_0x24ccf3[_0x5d7fc4(0x1bb)]((_0x3336e1,_0x290c22)=>{_0xb309c0[_0x290c22]['production_date']=_0x3336e1;}),_0x518ed5[_0x5d7fc4(0x1bb)]((_0x3bfe06,_0x26c6d0)=>{var _0x217288=_0x5d7fc4;_0xb309c0[_0x26c6d0][_0x217288(0x102)]=Math[_0x217288(0x193)](_0x3bfe06);}),_0x13b336[_0x5d7fc4(0x1bb)]((_0x53468f,_0x5931cf)=>{_0xb309c0[_0x5931cf]['delivery_date']=_0x53468f;}),_0x5e9ecd[_0x5d7fc4(0x1bb)]((_0x2752b4,_0x29e537)=>{var _0x5aefbf=_0x5d7fc4;_0xb309c0[_0x29e537][_0x5aefbf(0x12b)]=_0x2752b4;}),_0x67e975[_0x5d7fc4(0x1bb)]((_0x209d1c,_0x53de54)=>{var _0x2db029=_0x5d7fc4;_0xb309c0[_0x53de54][_0x2db029(0x14d)]=_0x209d1c;}),_0x103034[_0x5d7fc4(0x1bb)]((_0x47522e,_0x497e83)=>{_0xb309c0[_0x497e83]['quantity_notConverted']=_0x47522e;}),_0x543b4f[_0x5d7fc4(0x1bb)]((_0x23f088,_0x3e4ac1)=>{var _0x4fc9ff=_0x5d7fc4;_0xb309c0[_0x3e4ac1][_0x4fc9ff(0xfa)]=_0x23f088;});var _0x40a18e=0x0;_0xb309c0[_0x5d7fc4(0x1bb)](_0x118cc1=>{var _0x1b9eb4=_0x5d7fc4;console['log'](_0x1b9eb4(0x127),_0x118cc1),(parseInt(_0x118cc1[_0x1b9eb4(0x13f)])<parseInt(_0x118cc1[_0x1b9eb4(0x15e)])||parseInt(_0x118cc1[_0x1b9eb4(0x15e)])==0x0)&&_0x40a18e++;});if(_0x40a18e!=0x0)return _0x28a207[_0x5d7fc4(0x10a)](_0x5d7fc4(0x171),_0x5d7fc4(0x194)),_0x404ffb[_0x5d7fc4(0x12c)](_0x5d7fc4(0x18b));const _0x11c122=_0xb309c0[_0x5d7fc4(0x17d)](_0x594a11=>_0x594a11['quantity']!=='0'&&_0x594a11[_0x5d7fc4(0x15e)]!=='');_0x5308c7['invoice']=_0x13a5b9,_0x5308c7[_0x5d7fc4(0x142)]=_0x1a7937,_0x5308c7[_0x5d7fc4(0x1c5)]=_0x2c2269,_0x5308c7[_0x5d7fc4(0x1f0)]=_0x568509,_0x5308c7[_0x5d7fc4(0x1d4)]=_0x11c122,_0x5308c7[_0x5d7fc4(0x136)]=_0x4120ca,_0x5308c7[_0x5d7fc4(0x172)]=_0x24c065,_0x5308c7[_0x5d7fc4(0x189)]='False',_0x5308c7[_0x5d7fc4(0x14b)]=_0x5d7fc4(0x1f1);const _0x43c3bb=await _0x5308c7[_0x5d7fc4(0x10d)]();_0x28a207[_0x5d7fc4(0x10a)]('success',_0x5d7fc4(0x190)),_0x404ffb[_0x5d7fc4(0x12c)](_0x5d7fc4(0x199));}catch(_0x3d9ec8){console[_0x5d7fc4(0x104)](_0x3d9ec8);}}),router[a0_0x2604b3(0x1f7)](a0_0x2604b3(0x14c),auth,async(_0x1de6c7,_0x2c0037)=>{var _0x3fa5b0=a0_0x2604b3;try{const _0x866698=_0x1de6c7[_0x3fa5b0(0x105)]['id'],{invoice:_0x357a63,customer:_0x3fe736,receivable_amount:_0x346dc2,received_amount:_0x88e349}=_0x1de6c7['body'],_0x7122c4=await sales['findById'](_0x866698);console[_0x3fa5b0(0x104)](_0x7122c4);var _0x10c849=_0x346dc2-_0x88e349;console[_0x3fa5b0(0x104)](_0x88e349),_0x7122c4['received_amount']=parseFloat(_0x88e349)+parseFloat(_0x7122c4[_0x3fa5b0(0x164)]),_0x7122c4['due_amount']=_0x10c849,console['log'](_0x7122c4);const _0x51bc78=await _0x7122c4[_0x3fa5b0(0x10d)](),_0x59493d=await c_payment_data[_0x3fa5b0(0x1d1)]({'invoice':_0x357a63});_0x59493d[_0x3fa5b0(0x1cb)]=_0x10c849,await _0x59493d[_0x3fa5b0(0x10d)]();let _0x47e115=new Date(),_0x350835=('0'+_0x47e115[_0x3fa5b0(0x167)]())[_0x3fa5b0(0x1b1)](-0x2),_0x5719cc=('0'+(_0x47e115[_0x3fa5b0(0x129)]()+0x1))[_0x3fa5b0(0x1b1)](-0x2),_0x1c17eb=_0x47e115[_0x3fa5b0(0x191)](),_0x3b8049=_0x1c17eb+'-'+_0x5719cc+'-'+_0x350835;const _0x2a4e16=new customer_payment({'invoice':_0x357a63,'date':_0x1c17eb+'-'+_0x5719cc+'-'+_0x350835,'customer':_0x3fe736,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x88e349}),_0x366b2d=await _0x2a4e16['save']();_0x1de6c7['flash'](_0x3fa5b0(0x114),_0x3fa5b0(0x1ab)),_0x2c0037[_0x3fa5b0(0x12c)](_0x3fa5b0(0x199));}catch(_0x26bc3b){console['log'](_0x26bc3b);}}),router[a0_0x2604b3(0x17b)](a0_0x2604b3(0x12a),auth,async(_0xd1c529,_0x1169da)=>{var _0x1fa6f8=a0_0x2604b3;try{const {username:_0x55fc70,email:_0x3cc68e,role:_0x1c0c4e}=_0xd1c529[_0x1fa6f8(0x1a8)],_0x474740=_0xd1c529[_0x1fa6f8(0x1a8)],_0x1b549e=await profile['findOne']({'email':_0x474740['email']}),_0x53a0e4=await master_shop['find']();console[_0x1fa6f8(0x104)](_0x1fa6f8(0x177),_0x53a0e4);const _0x2fc9af=_0xd1c529[_0x1fa6f8(0x105)]['id'],_0x178e12=await sales[_0x1fa6f8(0x150)](_0x2fc9af);console['log'](_0x178e12);const _0x56a569=await customer['findOne']({'name':_0x178e12[_0x1fa6f8(0x142)]});console[_0x1fa6f8(0x104)](_0x56a569);if(_0x53a0e4[0x0][_0x1fa6f8(0x1d7)]=='English\x20(US)'){var _0x20bd25=users[_0x1fa6f8(0xff)];console[_0x1fa6f8(0x104)](_0x20bd25);}else{if(_0x53a0e4[0x0]['language']=='Hindi')var _0x20bd25=users[_0x1fa6f8(0x1a7)];else{if(_0x53a0e4[0x0][_0x1fa6f8(0x1d7)]=='German')var _0x20bd25=users[_0x1fa6f8(0xed)];else{if(_0x53a0e4[0x0][_0x1fa6f8(0x1d7)]==_0x1fa6f8(0x1e8))var _0x20bd25=users[_0x1fa6f8(0x1e8)];else{if(_0x53a0e4[0x0]['language']==_0x1fa6f8(0x128))var _0x20bd25=users['French'];else{if(_0x53a0e4[0x0][_0x1fa6f8(0x1d7)]==_0x1fa6f8(0x141))var _0x20bd25=users[_0x1fa6f8(0x132)];else{if(_0x53a0e4[0x0][_0x1fa6f8(0x1d7)]==_0x1fa6f8(0x154))var _0x20bd25=users['Chinese'];else{if(_0x53a0e4[0x0][_0x1fa6f8(0x1d7)]==_0x1fa6f8(0x19c))var _0x20bd25=users[_0x1fa6f8(0x1b3)];}}}}}}}_0x1169da[_0x1fa6f8(0x140)](_0x1fa6f8(0x152),{'success':_0xd1c529[_0x1fa6f8(0x10a)](_0x1fa6f8(0x114)),'errors':_0xd1c529[_0x1fa6f8(0x10a)](_0x1fa6f8(0x171)),'role':_0x474740,'profile':_0x1b549e,'master_shop':_0x53a0e4,'customers':_0x56a569,'sales':_0x178e12,'language':_0x20bd25});}catch(_0xf43bbc){console['log'](_0xf43bbc);}}),router[a0_0x2604b3(0x17b)](a0_0x2604b3(0x100),auth,async(_0x460f2c,_0xe7ec37)=>{var _0x21edab=a0_0x2604b3;try{const {username:_0x2a779f,email:_0x52f145,role:_0x27f012}=_0x460f2c['user'],_0x3743c4=_0x460f2c['user'],_0x15b9e7=await profile['findOne']({'email':_0x3743c4[_0x21edab(0x122)]}),_0xf67aab=await master_shop[_0x21edab(0x18e)]();console['log']('master',_0xf67aab);const _0x528162=_0x460f2c[_0x21edab(0x105)]['id'];console[_0x21edab(0x104)](_0x528162);const _0x26297e=await sales['findById'](_0x528162);console['log'](_0x21edab(0x1a5),_0x26297e);const _0x35bfb3=await warehouse['aggregate']([{'$match':{'name':_0x21edab(0x1d3),'room':_0x21edab(0x107)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x21edab(0x1c9)},'product_stock':{'$first':_0x21edab(0x1bc)},'level':{'$first':_0x21edab(0x16a)},'isle':{'$first':_0x21edab(0x133)},'pallet':{'$first':_0x21edab(0x187)},'primary_code':{'$first':_0x21edab(0x197)},'secondary_code':{'$first':_0x21edab(0x168)},'product_code':{'$first':_0x21edab(0x1de)}}}]);console[_0x21edab(0x104)]('stock_data',_0x35bfb3);const _0x4d3e4d=await product[_0x21edab(0x18e)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x21edab(0x1ed),'name':_0x21edab(0x1d3),'warehouse_category':_0x21edab(0x165)}},{'$group':{'_id':_0x21edab(0x106),'name':{'$first':_0x21edab(0x106)}}},{'$sort':{'name':0x1}}]);var _0x4ccd91=[_0x21edab(0x107)];if(_0xf67aab[0x0][_0x21edab(0x1d7)]=='English\x20(US)'){var _0x2e02f5=users[_0x21edab(0xff)];console[_0x21edab(0x104)](_0x2e02f5);}else{if(_0xf67aab[0x0][_0x21edab(0x1d7)]==_0x21edab(0x1a7))var _0x2e02f5=users[_0x21edab(0x1a7)];else{if(_0xf67aab[0x0][_0x21edab(0x1d7)]=='German')var _0x2e02f5=users['German'];else{if(_0xf67aab[0x0][_0x21edab(0x1d7)]==_0x21edab(0x1e8))var _0x2e02f5=users[_0x21edab(0x1e8)];else{if(_0xf67aab[0x0][_0x21edab(0x1d7)]==_0x21edab(0x128))var _0x2e02f5=users[_0x21edab(0x128)];else{if(_0xf67aab[0x0][_0x21edab(0x1d7)]=='Portuguese\x20(BR)')var _0x2e02f5=users['Portuguese'];else{if(_0xf67aab[0x0]['language']==_0x21edab(0x154))var _0x2e02f5=users[_0x21edab(0x154)];else{if(_0xf67aab[0x0][_0x21edab(0x1d7)]=='Arabic\x20(ae)')var _0x2e02f5=users[_0x21edab(0x1b3)];}}}}}}}_0xe7ec37[_0x21edab(0x140)](_0x21edab(0x15a),{'success':_0x460f2c[_0x21edab(0x10a)](_0x21edab(0x114)),'errors':_0x460f2c[_0x21edab(0x10a)](_0x21edab(0x171)),'role':_0x3743c4,'profile':_0x15b9e7,'user':_0x26297e,'stock':_0x35bfb3,'master_shop':_0xf67aab,'unit':_0x4d3e4d,'language':_0x2e02f5,'warehouses':warehouse_data,'rooms':_0x4ccd91});}catch(_0x2c89d4){console[_0x21edab(0x104)](_0x2c89d4),_0xe7ec37[_0x21edab(0x158)](0xc8)[_0x21edab(0x153)]({'message':_0x2c89d4[_0x21edab(0x17e)]});}}),router[a0_0x2604b3(0x1f7)]('/view/return_sales/:id',auth,async(_0x2a9379,_0x40e7ed)=>{var _0x561a80=a0_0x2604b3;try{const {invoice:_0x35fddf,date:_0x29dd5a,warehouse_name:_0x5e29d4,product_name:_0x35e64a,primary_code:_0x3951d2,secondary_code:_0x4150a9,product_code:_0x5f0b34,sales_quantity:_0x51667e,stocks:_0x566314,return_qty:_0x1564ca,Room_name:_0x3d0a98,to_warehouse_name:_0xcbdef9,to_Roomname:_0x22523b,to_Room_name:_0x5755bf,note:_0x52ee31,level:_0x5eba53,isle:_0x9c1e38,pallet:_0x537746}=_0x2a9379['body'];if(typeof _0x35e64a==_0x561a80(0x18c))var _0x29a0b7=[_0x2a9379[_0x561a80(0x117)][_0x561a80(0x103)]],_0x643fb1=[_0x2a9379['body'][_0x561a80(0x16f)]],_0x7c2bec=[_0x2a9379[_0x561a80(0x117)]['secondary_code']],_0x3cf776=[_0x2a9379[_0x561a80(0x117)]['product_code']],_0x415228=[_0x2a9379[_0x561a80(0x117)][_0x561a80(0x13d)]],_0xff968c=[_0x2a9379[_0x561a80(0x117)][_0x561a80(0x13e)]],_0x1603f5=[_0x2a9379['body'][_0x561a80(0x11c)]],_0x33d837=[_0x2a9379[_0x561a80(0x117)][_0x561a80(0x157)]],_0x47488f=[_0x2a9379[_0x561a80(0x117)]['bin']],_0x512dd9=[_0x2a9379[_0x561a80(0x117)][_0x561a80(0x149)]],_0x350d52=[_0x2a9379[_0x561a80(0x117)]['floorlevel']];else var _0x29a0b7=[..._0x2a9379['body']['product_name']],_0x643fb1=[..._0x2a9379[_0x561a80(0x117)]['primary_code']],_0x7c2bec=[..._0x2a9379['body'][_0x561a80(0x1ca)]],_0x3cf776=[..._0x2a9379[_0x561a80(0x117)]['product_code']],_0x415228=[..._0x2a9379['body'][_0x561a80(0x13d)]],_0xff968c=[..._0x2a9379[_0x561a80(0x117)][_0x561a80(0x13e)]],_0x1603f5=[..._0x2a9379['body']['return_qty']],_0x33d837=[..._0x2a9379[_0x561a80(0x117)]['bay']],_0x47488f=[..._0x2a9379['body']['bin']],_0x512dd9=[..._0x2a9379[_0x561a80(0x117)]['types']],_0x350d52=[..._0x2a9379[_0x561a80(0x117)]['floorlevel']];const _0x2edffd=_0x29a0b7[_0x561a80(0x19e)](_0x29688f=>{return _0x29688f={'product_name':_0x29688f};});_0x643fb1[_0x561a80(0x1bb)]((_0x19dae4,_0xf745c)=>{var _0x1247f6=_0x561a80;_0x2edffd[_0xf745c][_0x1247f6(0x16f)]=_0x19dae4;}),_0x7c2bec[_0x561a80(0x1bb)]((_0x51235c,_0x12803d)=>{var _0x3d541f=_0x561a80;_0x2edffd[_0x12803d][_0x3d541f(0x1ca)]=_0x51235c;}),_0x3cf776[_0x561a80(0x1bb)]((_0x1b49ce,_0x512035)=>{var _0x2674e3=_0x561a80;_0x2edffd[_0x512035][_0x2674e3(0x144)]=_0x1b49ce;}),_0x415228[_0x561a80(0x1bb)]((_0x3a7713,_0x227393)=>{_0x2edffd[_0x227393]['sale_qty']=_0x3a7713;}),_0xff968c[_0x561a80(0x1bb)]((_0x412600,_0x19bc18)=>{var _0x39d90a=_0x561a80;_0x2edffd[_0x19bc18][_0x39d90a(0x13f)]=_0x412600;}),_0x1603f5['forEach']((_0x386260,_0x13db17)=>{var _0x174dbd=_0x561a80;_0x2edffd[_0x13db17][_0x174dbd(0x11c)]=_0x386260;}),_0x33d837['forEach']((_0x2d44fe,_0x6898bc)=>{var _0x512ea6=_0x561a80;_0x2edffd[_0x6898bc][_0x512ea6(0x157)]=_0x2d44fe;}),_0x47488f[_0x561a80(0x1bb)]((_0x4dd24d,_0x34e21f)=>{var _0xbb58de=_0x561a80;_0x2edffd[_0x34e21f][_0xbb58de(0x16e)]=_0x4dd24d;}),_0x512dd9[_0x561a80(0x1bb)]((_0x8dbe74,_0x118dfd)=>{_0x2edffd[_0x118dfd]['type']=_0x8dbe74;}),_0x350d52[_0x561a80(0x1bb)]((_0x29f97a,_0x3bfa07)=>{var _0xc44ec0=_0x561a80;_0x2edffd[_0x3bfa07][_0xc44ec0(0x1c8)]=_0x29f97a;});var _0x327fc4=0x0;_0x2edffd[_0x561a80(0x1bb)](_0x130bc9=>{var _0x55627a=_0x561a80;console[_0x55627a(0x104)](_0x55627a(0x127),_0x130bc9),(parseInt(_0x130bc9['sale_qty'])<parseInt(_0x130bc9[_0x55627a(0x11c)])||parseInt(_0x130bc9[_0x55627a(0x13f)])<parseInt(_0x130bc9['return_qty'])&&parseInt(_0x130bc9['sale_qty'])>parseInt(_0x130bc9[_0x55627a(0x11c)])||parseInt(_0x130bc9[_0x55627a(0x11c)])==0x0)&&_0x327fc4++;});if(_0x327fc4!=0x0)return _0x2a9379['flash']('errors',_0x561a80(0x1b5)),_0x40e7ed['redirect'](_0x561a80(0x18b));const _0x374975=await sales['findOne']({'invoice':_0x35fddf});console[_0x561a80(0x104)](_0x374975),_0x374975['return_data']=_0x561a80(0x1b7);const _0x177f9d=await _0x374975['save'](),_0x7b3ddd=new sales_return({'invoice':_0x35fddf,'customer':_0x2a9379[_0x561a80(0x117)]['customer'],'date':_0x29dd5a,'warehouse_name':_0x5e29d4,'room':_0x3d0a98,'ToWarehouse':_0xcbdef9,'ToRoom':_0x5755bf,'return_sale':_0x2edffd,'note':_0x52ee31}),_0x1456eb=await _0x7b3ddd[_0x561a80(0x10d)]();console['log'](_0x7b3ddd);const _0x8e5885=await sales_return[_0x561a80(0x1d1)]({'invoice':_0x35fddf}),_0x364f1b=await warehouse[_0x561a80(0x1d1)]({'name':_0xcbdef9,'room':_0x5755bf});_0x8e5885[_0x561a80(0x15a)][_0x561a80(0x1bb)](_0x5bd3bf=>{var _0x4955e5=_0x561a80,_0x1f32c7=0x0;const _0x4d9419=_0x364f1b[_0x4955e5(0x101)][_0x4955e5(0x19e)](_0x268446=>{var _0x99844b=_0x4955e5;_0x268446[_0x99844b(0x103)]==_0x5bd3bf[_0x99844b(0x103)]&&_0x268446[_0x99844b(0x1c8)]==_0x5bd3bf[_0x99844b(0x1c8)]&&_0x268446[_0x99844b(0x126)]==_0x5bd3bf['type']&&_0x268446['bin']==_0x5bd3bf['bin']&&_0x268446[_0x99844b(0x157)]==_0x5bd3bf[_0x99844b(0x157)]&&(_0x268446[_0x99844b(0x169)]=parseInt(_0x268446[_0x99844b(0x169)])+parseInt(_0x5bd3bf[_0x99844b(0x11c)]),_0x1f32c7++);});_0x1f32c7=='0'&&(_0x364f1b[_0x4955e5(0x101)]=_0x364f1b[_0x4955e5(0x101)]['concat']({'product_name':_0x5bd3bf[_0x4955e5(0x103)],'product_stock':_0x5bd3bf[_0x4955e5(0x11c)],'primary_code':_0x5bd3bf['primary_code'],'secondary_code':_0x5bd3bf['secondary_code'],'product_code':_0x5bd3bf[_0x4955e5(0x144)],'bay':_0x5bd3bf[_0x4955e5(0x157)],'bin':_0x5bd3bf[_0x4955e5(0x16e)],'type':_0x5bd3bf[_0x4955e5(0x126)],'floorlevel':_0x5bd3bf[_0x4955e5(0x1c8)]})),console['log'](_0x4955e5(0x146),_0x364f1b);}),await _0x364f1b[_0x561a80(0x10d)](),console[_0x561a80(0x104)](_0x2a9379['body']);const _0xcf0e4c=new c_payment_data({'invoice':_0x35fddf,'customer':_0x2a9379['body'][_0x561a80(0x142)],'reason':_0x561a80(0x13c)});await _0xcf0e4c[_0x561a80(0x10d)]();const _0x3cb0dd=await master_shop[_0x561a80(0x18e)]();console[_0x561a80(0x104)](_0x561a80(0x1ee),_0x3cb0dd[0x0][_0x561a80(0x1eb)]);const _0x29758e=await email_settings[_0x561a80(0x1d1)](),_0x349385=await customer[_0x561a80(0x1d1)]({'name':_0x2a9379[_0x561a80(0x117)][_0x561a80(0x142)]});console[_0x561a80(0x104)](_0x561a80(0x119),_0x349385);_0x3cb0dd[0x0][_0x561a80(0x11b)]==0x1?(right_currency=_0x3cb0dd[0x0][_0x561a80(0x13b)],left_currency=''):(right_currency='',left_currency=_0x3cb0dd[0x0][_0x561a80(0x13b)]);var _0x410de7=_0x29a0b7,_0x5f1bce=_0x1603f5,_0x168a08='',_0x1511bb;for(_0x1511bb in _0x410de7){_0x168a08+='<tr>'+_0x561a80(0x10b)+_0x410de7[_0x1511bb]+_0x561a80(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f1bce[_0x1511bb]+'</td>'+_0x561a80(0x185);}console[_0x561a80(0x104)]('product_list',_0x168a08);let _0x3b7ece=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x29758e[_0x561a80(0x122)],'pass':_0x29758e[_0x561a80(0x113)]}}),_0x38fa60={'from':_0x29758e[_0x561a80(0x122)],'to':_0x349385[_0x561a80(0x122)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x561a80(0x1db)+_0x561a80(0x162)+_0x3cb0dd[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x561a80(0x1bd)+_0x561a80(0x125)+_0x561a80(0x1cf)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x561a80(0x1cf)+_0x561a80(0x15d)+_0x561a80(0x1a1)+_0x561a80(0x1cf)+_0x561a80(0x156)+_0x3cb0dd[0x0][_0x561a80(0x18a)]+_0x561a80(0x1e0)+_0x561a80(0x1a1)+_0x561a80(0x1a1)+_0x561a80(0x1b9)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x561a80(0x1a6)+_0x35fddf+'\x20'+_0x561a80(0xef)+'\x20Order\x20Date\x20:\x20'+_0x29dd5a+'\x20'+'</span>'+'</h5>'+_0x561a80(0x1a1)+_0x561a80(0x155)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x561a80(0x15c)+_0x561a80(0x1d2)+_0x561a80(0x121)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x561a80(0x1e6)+_0x561a80(0x185)+'</thead>'+_0x561a80(0x118)+'\x20'+_0x168a08+'\x20'+_0x561a80(0x12f)+'</table>'+_0x561a80(0x1cf)+_0x561a80(0x116)+_0x561a80(0x1c3)+_0x3cb0dd[0x0][_0x561a80(0x18a)]+_0x561a80(0x1e1)+'</div>'+_0x561a80(0x1a1)+_0x561a80(0x1f3)};_0x3b7ece['sendMail'](_0x38fa60,function(_0x30c4eb,_0x51ecb7){var _0x9ac205=_0x561a80;_0x30c4eb?(console[_0x9ac205(0x104)](_0x30c4eb),console[_0x9ac205(0x104)](_0x9ac205(0x13a))):console[_0x9ac205(0x104)]('Email\x20sent\x20successfully');}),_0x2a9379['flash'](_0x561a80(0x114),_0x561a80(0x1c6)),_0x40e7ed[_0x561a80(0x12c)](_0x561a80(0x199));}catch(_0x394c8f){console['log'](_0x394c8f),_0x40e7ed[_0x561a80(0x158)](0xc8)[_0x561a80(0x153)]({'message1':_0x394c8f[_0x561a80(0x17e)]});}}),router[a0_0x2604b3(0x17b)](a0_0x2604b3(0x11f),auth,async(_0xcd5ebc,_0x3cf98d)=>{var _0x55a07a=a0_0x2604b3;try{const {username:_0x5cda45,email:_0x48afc9,role:_0x3c467e}=_0xcd5ebc['user'],_0x44ac16=_0xcd5ebc[_0x55a07a(0x1a8)],_0x45dc4d=await profile['findOne']({'email':_0x44ac16['email']}),_0x2cd617=await master_shop[_0x55a07a(0x18e)]();console[_0x55a07a(0x104)](_0x55a07a(0x1ec),_0x2cd617);const _0x53ae38=_0xcd5ebc[_0x55a07a(0x105)]['id'],_0xda53ef=await sales[_0x55a07a(0x150)](_0x53ae38);console[_0x55a07a(0x104)]('barcode\x20user_id',_0xda53ef);if(_0x2cd617[0x0][_0x55a07a(0x1d7)]==_0x55a07a(0x161))var _0x405522=users[_0x55a07a(0xff)];else{if(_0x2cd617[0x0]['language']==_0x55a07a(0x1a7))var _0x405522=users[_0x55a07a(0x1a7)];else{if(_0x2cd617[0x0][_0x55a07a(0x1d7)]==_0x55a07a(0xed))var _0x405522=users[_0x55a07a(0xed)];else{if(_0x2cd617[0x0]['language']==_0x55a07a(0x1e8))var _0x405522=users['Spanish'];else{if(_0x2cd617[0x0][_0x55a07a(0x1d7)]==_0x55a07a(0x128))var _0x405522=users['French'];else{if(_0x2cd617[0x0][_0x55a07a(0x1d7)]==_0x55a07a(0x141))var _0x405522=users['Portuguese'];else{if(_0x2cd617[0x0][_0x55a07a(0x1d7)]==_0x55a07a(0x154))var _0x405522=users[_0x55a07a(0x154)];else{if(_0x2cd617[0x0]['language']=='Arabic\x20(ae)')var _0x405522=users[_0x55a07a(0x1b3)];}}}}}}}_0x3cf98d[_0x55a07a(0x140)](_0x55a07a(0xf7),{'success':_0xcd5ebc[_0x55a07a(0x10a)](_0x55a07a(0x114)),'errors':_0xcd5ebc[_0x55a07a(0x10a)](_0x55a07a(0x171)),'role':_0x44ac16,'profile':_0x45dc4d,'alldata':_0xda53ef,'master_shop':_0x2cd617,'language':_0x405522});}catch(_0x25b69b){console[_0x55a07a(0x104)](_0x25b69b);}}),router[a0_0x2604b3(0x1f7)]('/barcode_scanner',async(_0x27335f,_0x469f39)=>{var _0x1453ee=a0_0x2604b3;const {product_code:_0x5e276d,warehouse_name:_0xac9c1a,rooms_data:_0x1adab8,Roomslist:_0x4ad3df}=_0x27335f[_0x1453ee(0x117)],_0x3c1318=_0x4ad3df[_0x1453ee(0xf1)](','),_0x430089=[];async function _0x4c3e00(_0x1617d2){var _0x5d15c1=_0x1453ee;const _0x26f2f6=await warehouse[_0x5d15c1(0x1d8)]([{'$match':{'name':_0xac9c1a,'room':_0x1617d2}},{'$unwind':_0x5d15c1(0x181)},{'$match':{'product_details.primary_code':_0x5e276d}},{'$group':{'_id':_0x5d15c1(0xf9),'name':{'$first':_0x5d15c1(0x1c9)},'product_stock':{'$first':_0x5d15c1(0x1bc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d15c1(0x168)},'product_code':{'$first':_0x5d15c1(0x1de)},'level':{'$first':_0x5d15c1(0x17f)},'isle':{'$first':_0x5d15c1(0xf4)},'type':{'$first':_0x5d15c1(0x1ae)},'pallet':{'$first':_0x5d15c1(0x16d)},'unit':{'$first':_0x5d15c1(0x196)},'secondary_unit':{'$first':_0x5d15c1(0x1dd)},'storage':{'$first':_0x5d15c1(0x10c)},'rack':{'$first':_0x5d15c1(0x176)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5d15c1(0x192)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x5d15c1(0x1e3)},'product_cat':{'$first':_0x5d15c1(0x109)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x5d15c1(0x1ef)},'invoice':{'$first':_0x5d15c1(0x1c7)},'actual_qty':{'$first':_0x5d15c1(0x135)},'actual_uom':{'$first':_0x5d15c1(0x1e5)}}}]),_0x57080a=await warehouse['aggregate']([{'$match':{'name':_0xac9c1a,'room':_0x1617d2}},{'$unwind':_0x5d15c1(0x181)},{'$match':{'product_details.secondary_code':_0x5e276d}},{'$group':{'_id':_0x5d15c1(0xf9),'name':{'$first':_0x5d15c1(0x1c9)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x5d15c1(0x197)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5d15c1(0x17f)},'isle':{'$first':_0x5d15c1(0xf4)},'type':{'$first':_0x5d15c1(0x1ae)},'pallet':{'$first':_0x5d15c1(0x16d)},'unit':{'$first':_0x5d15c1(0x196)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x5d15c1(0x10c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5d15c1(0xfd)},'production_date':{'$first':_0x5d15c1(0x192)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x5d15c1(0x1e3)},'product_cat':{'$first':_0x5d15c1(0x109)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x5d15c1(0x1ef)},'invoice':{'$first':_0x5d15c1(0x1c7)}}}]);if(_0x26f2f6[_0x5d15c1(0x183)]>0x0)_0x430089[_0x5d15c1(0x1b4)](_0x26f2f6);else _0x57080a['length']>0x0&&_0x430089[_0x5d15c1(0x1b4)](_0x57080a);}const _0x26900f=_0x3c1318[_0x1453ee(0x19e)](_0x5aff2a=>_0x4c3e00(_0x5aff2a));await Promise[_0x1453ee(0x1f4)](_0x26900f),_0x469f39[_0x1453ee(0x153)](_0x430089);}),module['exports']=router;