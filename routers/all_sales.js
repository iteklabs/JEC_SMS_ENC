function a0_0x2af8(_0x491882,_0x48e704){var _0x2e0ffa=a0_0x2e0f();return a0_0x2af8=function(_0x2af896,_0x18db47){_0x2af896=_0x2af896-0x9b;var _0x1d494f=_0x2e0ffa[_0x2af896];return _0x1d494f;},a0_0x2af8(_0x491882,_0x48e704);}var a0_0x4f2468=a0_0x2af8;(function(_0x3e53e3,_0x29094f){var _0x52cdd9=a0_0x2af8,_0x3151f3=_0x3e53e3();while(!![]){try{var _0x31bd99=parseInt(_0x52cdd9(0xa8))/0x1*(parseInt(_0x52cdd9(0x17d))/0x2)+parseInt(_0x52cdd9(0x10b))/0x3*(parseInt(_0x52cdd9(0xd6))/0x4)+parseInt(_0x52cdd9(0x169))/0x5+-parseInt(_0x52cdd9(0x114))/0x6+parseInt(_0x52cdd9(0x128))/0x7+-parseInt(_0x52cdd9(0x197))/0x8+-parseInt(_0x52cdd9(0x187))/0x9;if(_0x31bd99===_0x29094f)break;else _0x3151f3['push'](_0x3151f3['shift']());}catch(_0x82e49b){_0x3151f3['push'](_0x3151f3['shift']());}}}(a0_0x2e0f,0xe536c));const express=require(a0_0x4f2468(0x191)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4f2468(0x163)),auth=require(a0_0x4f2468(0x123)),nodemailer=require(a0_0x4f2468(0xee)),users=require('../public/language/languages.json');router[a0_0x4f2468(0xd1)](a0_0x4f2468(0x17f),auth,async(_0x327f34,_0x2d638f)=>{var _0x142b20=a0_0x4f2468;try{const {username:_0x1cc817,email:_0x146f56,role:_0x40e2fa}=_0x327f34[_0x142b20(0xf8)],_0x58ee0d=_0x327f34['user'],_0x949a93=await profile[_0x142b20(0xe2)]({'email':_0x58ee0d[_0x142b20(0xe7)]}),_0x11cbcc=await master_shop[_0x142b20(0x124)]();let _0x52dc43;if(_0x58ee0d[_0x142b20(0xc7)]==_0x142b20(0xc6)){const _0x10f7a2=await staff[_0x142b20(0xe2)]({'email':_0x58ee0d['email']});_0x52dc43=await sales[_0x142b20(0x14d)]([{'$lookup':{'from':_0x142b20(0x125),'localField':_0x142b20(0x14a),'foreignField':'name','as':_0x142b20(0x102)}},{'$unwind':'$customers_docs'},{'$unwind':_0x142b20(0x147)},{'$group':{'_id':_0x142b20(0x127),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x142b20(0xfb)},'warehouse_name':{'$first':_0x142b20(0x15f)},'sale_product':{'$push':_0x142b20(0x147)},'note':{'$first':'$note'},'return_data':{'$first':_0x142b20(0xd8)},'customers_docs':{'$first':_0x142b20(0x18c)},'total_saleproduct_quantity':{'$sum':_0x142b20(0x12d)},'level':{'$addToSet':_0x142b20(0xd3)},'isle':{'$addToSet':_0x142b20(0xa9)},'type':{'$addToSet':_0x142b20(0xce)},'pallet':{'$addToSet':_0x142b20(0xb3)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x52dc43=await sales[_0x142b20(0x14d)]([{'$lookup':{'from':'customers','localField':_0x142b20(0x14a),'foreignField':'name','as':_0x142b20(0x102)}},{'$unwind':_0x142b20(0x18c)},{'$unwind':_0x142b20(0x147)},{'$group':{'_id':_0x142b20(0x127),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x142b20(0xfb)},'warehouse_name':{'$first':_0x142b20(0x15f)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x142b20(0x14e)},'return_data':{'$first':_0x142b20(0xd8)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x142b20(0xa9)},'type':{'$addToSet':_0x142b20(0xce)},'pallet':{'$addToSet':_0x142b20(0xb3)},'finalize':{'$first':_0x142b20(0x105)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x142b20(0xae)]('sales\x20all_data',_0x52dc43);if(_0x11cbcc[0x0][_0x142b20(0xdc)]==_0x142b20(0x9f)){var _0x3fae80=users[_0x142b20(0xde)];console[_0x142b20(0xae)](_0x3fae80);}else{if(_0x11cbcc[0x0][_0x142b20(0xdc)]==_0x142b20(0x15e))var _0x3fae80=users[_0x142b20(0x15e)];else{if(_0x11cbcc[0x0][_0x142b20(0xdc)]==_0x142b20(0x15c))var _0x3fae80=users['German'];else{if(_0x11cbcc[0x0][_0x142b20(0xdc)]==_0x142b20(0x132))var _0x3fae80=users[_0x142b20(0x132)];else{if(_0x11cbcc[0x0][_0x142b20(0xdc)]==_0x142b20(0xff))var _0x3fae80=users['French'];else{if(_0x11cbcc[0x0][_0x142b20(0xdc)]==_0x142b20(0x194))var _0x3fae80=users['Portuguese'];else{if(_0x11cbcc[0x0][_0x142b20(0xdc)]=='Chinese')var _0x3fae80=users[_0x142b20(0x156)];else{if(_0x11cbcc[0x0]['language']=='Arabic\x20(ae)')var _0x3fae80=users[_0x142b20(0xa0)];}}}}}}}_0x2d638f[_0x142b20(0x177)](_0x142b20(0x109),{'success':_0x327f34['flash'](_0x142b20(0x16f)),'errors':_0x327f34[_0x142b20(0x16b)](_0x142b20(0xd9)),'sales':_0x52dc43,'profile':_0x949a93,'role':_0x58ee0d,'master_shop':_0x11cbcc,'language':_0x3fae80});}catch(_0x385aba){console['log'](_0x385aba);}});async function getRandom8DigitNumber(){var _0x2d4591=a0_0x4f2468;const _0x4c88d6=0x989680,_0x251163=0x5f5e0ff,_0x26880d=Math[_0x2d4591(0x11d)](Math['random']()*(_0x251163-_0x4c88d6+0x1))+_0x4c88d6;var _0x2da646;const _0x29a2cd=await sales['findOne']({'invoice':_0x2d4591(0xa1)+_0x26880d});return _0x29a2cd&&_0x29a2cd[_0x2d4591(0x199)]>0x0?_0x2da646=_0x2d4591(0xa1)+_0x26880d:_0x2da646='OUT-'+_0x26880d,_0x2da646;}function a0_0x2e0f(){var _0x3f3f7c=['$product_details.invoice','actual_qty','$sale_product.type','unit','forEach','get','_id','$sale_product.bay','/view/:id','secondary_unit','184jIOfhv','prod_cat','$return_data','errors','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','language','product_list','English','$product_details.storage','<div>','id_transaction_from','findOne','quantity','customer_data','<hr\x20class=\x22my-3\x22>','/../public','email','invoice','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/add_sales/:id','getDate','Received\x20Payment\x20For\x20Sale','$product','nodemailer','Ambient','stock_data','$product_details.bay','/invoice/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','expiry_date','add\x20post','body','findById','user','max_per_unit','catch','$date','/barcode_scanner','all_sales_barcode','$product_details.actual_qty','French','return_qty','product_stock','customers_docs','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$finalize','$product_details.product_code','json','</td>','all_sales','carton','40305UscJDF','isAllowEdit','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','post','RMSEmail','types','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','10086870kSmrlc','stocks','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Error\x20Occurs','$product_details.batch_code','requested_qty','edit_sales','currency_placement','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','floor','foreach\x20newproduct','Arabic\x20(ae)','product_details','Floor','product_data','../middleware/auth','find','customers','actual_uom','$_id','11265667tMaYwR','Email\x20sent\x20successfully','received_amount','rack','image','$sale_product.quantity','gmail','Portuguese','$product_details.unit','barcode\x20Product\x20master','Spanish','</thead>','</div>','An\x20error\x20occurred.','getMonth','<span\x20style=\x22float:\x20right;\x22>','user_id','RoomAssigned','save','/view/add_sale/product','There\x27s\x20a\x20error\x20in\x20this\x20transaction','amount','$product.product_name','<!DOCTYPE\x20html>','$product_details.expiry_date','$name','Shelves','return_sale','$product_details.isle','</table>','batch_code','$sale_product','Sales\x20Add\x20successfully','</tbody>','customer','<strong>\x20Regards\x20</strong>','delivery_date','aggregate','$note','host','quantity_notConverted','/give_payment/:id','SCRN','warehouse','Return\x20Goods','$product_details.secondary_unit','Chinese','Receiving\x20Area','level','site_title','room','then','German','prod_code','Hindi','$warehouse_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.level','../models/all_models','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','stock','slice','/all_sales/preview/','\x20</h2>','4422705snpFYV','False','flash','sales\x20item\x20return\x20successfull','error','sendMail','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','delivery_code','prod_invoice','/view/add_sales','$product_details._id','Sales\x20Mail','render','master','map','$product_details.production_date','split','sales_invoice','1504028nceBwK','True','/view','message','primary_code','<h2>\x20','logo','filter','</span>','back','11066832DcDDUc','floorlevel','sales_quantity','exports','$product_details.bin','$customers_docs','toString','$product_details.type','production_date','Logo.png','express','product_code','Raw\x20Materials','Portuguese\x20(BR)','primary_unit','Return\x20Rooms','114344GGRpyh','id_transact','length','$product_details.primary_code','date','$product_details.product_name','product_name','note','<html><head><title></title>','<h5\x20style=\x22text-align:\x20left;\x22>','abs','<tr>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','params','</body></html>','status','secondary_code','push','English\x20(US)','Arabic','OUT-','bin','$product_details.actual_uom','maxperunit','$product_details.product_stock','max','$product_details','1MZRaIE','$sale_product.bin','$product_details.secondary_code','</tr>','currency','$product_details.maxPerUnit','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sale_qty','purchases_data','Level','$sale_product.floorlevel','createTransport','/view/return_sales/:id','warehouse_name','/all_sales/view','port','password','Enabled','type','bay','string','storage','\x20Order\x20Date\x20:\x20','Enclosed','Sales\x20Update\x20successfully','$room','all','sale_product','/preview/:id','staff','role','/upload/','$product_details.floorlevel','room_name','$product_details.rack'];a0_0x2e0f=function(){return _0x3f3f7c;};return a0_0x2e0f();}router[a0_0x4f2468(0xd1)](a0_0x4f2468(0x174),auth,async(_0x2ae2a8,_0x5bad3f)=>{var _0x5b9393=a0_0x4f2468;try{const {username:_0x5a98d3,email:_0x46626e,role:_0x2bb9f2}=_0x2ae2a8[_0x5b9393(0xf8)],_0x9a8ba7=_0x2ae2a8[_0x5b9393(0xf8)],_0x4dbdbe=await profile[_0x5b9393(0xe2)]({'email':_0x9a8ba7[_0x5b9393(0xe7)]}),_0x1e51dc=await master_shop[_0x5b9393(0x124)](),_0x2541c0=await customer[_0x5b9393(0x124)]({});let _0x41e279;if(_0x9a8ba7[_0x5b9393(0xc7)]=='staff'){const _0x46cd6d=await staff[_0x5b9393(0xe2)]({'email':_0x9a8ba7[_0x5b9393(0xe7)]});_0x41e279=await warehouse[_0x5b9393(0x14d)]([{'$match':{'status':_0x5b9393(0xba),'name':_0x46cd6d['warehouse'],'warehouse_category':_0x5b9393(0x193),'name':{'$ne':_0x5b9393(0x154)}}},{'$group':{'_id':'$name','name':{'$first':_0x5b9393(0x141)}}},{'$sort':{'name':0x1}}]);}else _0x41e279=await warehouse['aggregate']([{'$match':{'status':_0x5b9393(0xba),'warehouse_category':_0x5b9393(0x193),'name':{'$ne':_0x5b9393(0x154)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x437ad1=await product[_0x5b9393(0x124)]({});var _0x11350b=[_0x5b9393(0xef),_0x5b9393(0xc0)];const _0x45e9af=await sales[_0x5b9393(0x124)]({}),_0x1d614b=_0x45e9af[_0x5b9393(0x199)]+0x1,_0x4de74e='OUT-'+_0x1d614b[_0x5b9393(0x18d)]()['padStart'](0x5,'0');if(_0x1e51dc[0x0]['language']=='English\x20(US)'){var _0x122f0f=users[_0x5b9393(0xde)];console[_0x5b9393(0xae)](_0x122f0f);}else{if(_0x1e51dc[0x0]['language']=='Hindi')var _0x122f0f=users[_0x5b9393(0x15e)];else{if(_0x1e51dc[0x0]['language']==_0x5b9393(0x15c))var _0x122f0f=users[_0x5b9393(0x15c)];else{if(_0x1e51dc[0x0][_0x5b9393(0xdc)]==_0x5b9393(0x132))var _0x122f0f=users[_0x5b9393(0x132)];else{if(_0x1e51dc[0x0][_0x5b9393(0xdc)]=='French')var _0x122f0f=users[_0x5b9393(0xff)];else{if(_0x1e51dc[0x0][_0x5b9393(0xdc)]==_0x5b9393(0x194))var _0x122f0f=users[_0x5b9393(0x12f)];else{if(_0x1e51dc[0x0][_0x5b9393(0xdc)]==_0x5b9393(0x156))var _0x122f0f=users[_0x5b9393(0x156)];else{if(_0x1e51dc[0x0][_0x5b9393(0xdc)]==_0x5b9393(0x11f))var _0x122f0f=users['Arabic'];}}}}}}}const _0xa7fb2e=getRandom8DigitNumber();_0xa7fb2e[_0x5b9393(0x15b)](_0xf461ef=>{var _0x15640c=_0x5b9393;_0x5bad3f[_0x15640c(0x177)]('add_sales',{'success':_0x2ae2a8[_0x15640c(0x16b)](_0x15640c(0x16f)),'errors':_0x2ae2a8[_0x15640c(0x16b)](_0x15640c(0xd9)),'role':_0x9a8ba7,'profile':_0x4dbdbe,'customer':_0x2541c0,'warehouse':_0x41e279,'product':_0x437ad1,'invoice':_0xf461ef,'master_shop':_0x1e51dc,'language':_0x122f0f,'rooms_data':_0x11350b});})['catch'](_0x21649f=>{var _0x2f1077=_0x5b9393;_0x2ae2a8[_0x2f1077(0x16b)](_0x2f1077(0xd9),_0x2f1077(0x13c)),_0x5bad3f[_0x2f1077(0x171)](_0x2f1077(0xb7));});}catch(_0x3bf732){console[_0x5b9393(0xae)](_0x3bf732);}}),router[a0_0x4f2468(0xd1)](a0_0x4f2468(0xea),auth,async(_0x3fe0d1,_0xcb3713)=>{var _0x263904=a0_0x4f2468;try{const _0x30af0e=_0x3fe0d1['params']['id'];console['log'](_0x30af0e);const _0x11fc7b=await product[_0x263904(0x124)](),_0x20de7e=await purchases[_0x263904(0x14d)]([{'$match':{'warehouse_name':_0x30af0e}},{'$unwind':_0x263904(0xed)},{'$group':{'_id':_0x263904(0x13e)}}]);console[_0x263904(0xae)](_0x263904(0xb1),_0x20de7e),_0xcb3713[_0x263904(0x9c)](0xc8)[_0x263904(0x107)]({'purchases_data':_0x20de7e,'product_data':_0x11fc7b});}catch(_0x12bc45){console[_0x263904(0xae)](_0x12bc45);}}),router[a0_0x4f2468(0x10f)](a0_0x4f2468(0x13b),auth,async(_0x260636,_0xf03268)=>{var _0xe9dc77=a0_0x4f2468;try{const {warehouse_data:_0x223a2d,product_data:_0x4ada55}=_0x260636[_0xe9dc77(0xf6)];console[_0xe9dc77(0xae)](_0x260636[_0xe9dc77(0xf6)][_0xe9dc77(0x122)]);;const _0x27f4e4=await master_shop[_0xe9dc77(0x124)]();console[_0xe9dc77(0xae)](_0xe9dc77(0x178),_0x27f4e4);const _0x15e465=await product[_0xe9dc77(0xe2)]({'name':_0x4ada55});console[_0xe9dc77(0xae)]('product',_0x15e465);const _0x217900=await warehouse[_0xe9dc77(0x14d)]([{'$match':{'name':_0x223a2d}},{'$unwind':_0xe9dc77(0xa7)},{'$match':{'product_details.product_name':_0x4ada55}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0xe9dc77(0xa5)}}}]);console[_0xe9dc77(0xae)](_0xe9dc77(0xf0),_0x217900),_0xf03268[_0xe9dc77(0x9c)](0xc8)['json']({'master':_0x27f4e4,'new_product':_0x15e465,'stock_data':_0x217900});}catch(_0x235b22){console['log'](_0x235b22);}}),router[a0_0x4f2468(0x10f)](a0_0x4f2468(0x174),auth,async(_0x16de2e,_0x4bc9b6)=>{var _0x187b6e=a0_0x4f2468;try{const {invoice:_0x1ba687,date:_0x3a31d0,warehouse_name:_0x1cbcb9,product_name:_0xd2db88,stock:_0x2c3788,quantity:_0x396e5f,note:_0x541924,room:_0x570bbe,primary_code:_0x22e0f3,secondary_code:_0x10688b,prod_code:_0x36c921,level:_0x182bf8,isle:_0x575638,pallet:_0x839ad5,batch_code:_0x439ded,SCRN:_0x14c998,expiry_date:_0x3b5f26}=_0x16de2e[_0x187b6e(0xf6)];if(typeof _0xd2db88=='string')var _0x44389a=[_0x16de2e['body']['product_name']],_0x366c44=[_0x16de2e[_0x187b6e(0xf6)]['stock']],_0x480368=[_0x16de2e['body'][_0x187b6e(0x10a)]],_0x2c91f7=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x181)]],_0x4c92aa=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x9d)]],_0x4a98b6=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x15d)]],_0x35ef77=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x158)]],_0x18bc7a=[_0x16de2e['body'][_0x187b6e(0x195)]],_0x2a26d0=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xd5)]],_0x2d2cb2=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x146)]],_0x46da55=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xf4)]],_0x35dbd1=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xf9)]],_0x1b2e90=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x18f)]],_0x552413=[_0x16de2e[_0x187b6e(0xf6)]['requested_qty']],_0x469f3d=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x14c)]],_0x1806e8=[_0x16de2e['body'][_0x187b6e(0x172)]],_0x2cade4=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xd7)]],_0x536ce9=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xe3)]],_0x17a3aa=[_0x16de2e[_0x187b6e(0xf6)]['RoomAssigned']],_0x1e5d82=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x173)]],_0x100b1e=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xcd)]],_0x17bd92=[_0x16de2e['body'][_0x187b6e(0x126)]],_0x13a34c=[_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x198)]];else var _0x44389a=[..._0x16de2e[_0x187b6e(0xf6)]['product_name']],_0x366c44=[..._0x16de2e['body'][_0x187b6e(0x165)]],_0x480368=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x10a)]],_0x2c91f7=[..._0x16de2e['body'][_0x187b6e(0x181)]],_0x4c92aa=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x9d)]],_0x4a98b6=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x15d)]],_0x35ef77=[..._0x16de2e['body'][_0x187b6e(0x158)]],_0x18bc7a=[..._0x16de2e['body'][_0x187b6e(0x195)]],_0x2a26d0=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xd5)]],_0x2d2cb2=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x146)]],_0x46da55=[..._0x16de2e['body']['expiry_date']],_0x35dbd1=[..._0x16de2e[_0x187b6e(0xf6)]['max_per_unit']],_0x1b2e90=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x18f)]],_0x552413=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x119)]],_0x469f3d=[..._0x16de2e['body']['delivery_date']],_0x1806e8=[..._0x16de2e['body'][_0x187b6e(0x172)]],_0x2cade4=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0xd7)]],_0x536ce9=[..._0x16de2e[_0x187b6e(0xf6)]['quantity']],_0x17a3aa=[..._0x16de2e['body']['RoomAssigned']],_0x1e5d82=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x173)]],_0x100b1e=[..._0x16de2e[_0x187b6e(0xf6)]['actual_qty']],_0x17bd92=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x126)]],_0x13a34c=[..._0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x198)]];const _0x16e460=_0x44389a[_0x187b6e(0x179)](_0x35865f=>{return _0x35865f={'product_name':_0x35865f};});_0x366c44[_0x187b6e(0xd0)]((_0x18e183,_0x4ea8ed)=>{var _0x16ed06=_0x187b6e;_0x16e460[_0x4ea8ed][_0x16ed06(0x165)]=Math[_0x16ed06(0x1a1)](_0x18e183);}),_0x100b1e['forEach']((_0x59eb5f,_0xe92e2e)=>{var _0x3cc881=_0x187b6e;_0x16e460[_0xe92e2e][_0x3cc881(0xcd)]=Math['abs'](_0x59eb5f);}),_0x17bd92[_0x187b6e(0xd0)]((_0x432227,_0x2d5d19)=>{var _0x9ddeb5=_0x187b6e;_0x16e460[_0x2d5d19][_0x9ddeb5(0x126)]=_0x432227;}),_0x13a34c[_0x187b6e(0xd0)]((_0x259b02,_0x47b45b)=>{var _0x31b40f=_0x187b6e;_0x16e460[_0x47b45b][_0x31b40f(0xe1)]=_0x259b02;}),_0x480368[_0x187b6e(0xd0)]((_0x47a17d,_0x2ca8cd)=>{var _0x415c93=_0x187b6e;_0x16e460[_0x2ca8cd][_0x415c93(0xe3)]=_0x47a17d;}),_0x2c91f7[_0x187b6e(0xd0)]((_0x28928c,_0x1d8622)=>{var _0x389388=_0x187b6e;_0x16e460[_0x1d8622][_0x389388(0x181)]=_0x28928c;}),_0x4c92aa[_0x187b6e(0xd0)]((_0x43d605,_0x18a1ee)=>{_0x16e460[_0x18a1ee]['secondary_code']=_0x43d605;}),_0x4a98b6['forEach']((_0x115a35,_0x1ea24c)=>{var _0x30d477=_0x187b6e;_0x16e460[_0x1ea24c][_0x30d477(0x192)]=_0x115a35;}),_0x35ef77[_0x187b6e(0xd0)]((_0x10e3b9,_0x140fa1)=>{var _0x34f6d6=_0x187b6e;_0x17a3aa[_0x34f6d6(0xd0)]((_0x1c9e78,_0x10c72e)=>{var _0x432d6e=_0x34f6d6;if(_0x1c9e78==_0x432d6e(0x157)&&_0x140fa1==_0x10c72e){var _0x451da8=_0x10e3b9['slice'](0x3);_0x16e460[_0x140fa1]['storage']=_0x10e3b9[0x0],_0x16e460[_0x140fa1]['rack']=_0x10e3b9[0x1],_0x16e460[_0x140fa1][_0x432d6e(0xbc)]=0x0,_0x16e460[_0x140fa1][_0x432d6e(0xa2)]=0x0,_0x16e460[_0x140fa1]['type']=_0x432d6e(0x121),_0x16e460[_0x140fa1][_0x432d6e(0x188)]=_0x451da8;}else{if(_0x1c9e78==_0x432d6e(0x142)&&_0x140fa1==_0x10c72e){var _0x451da8=_0x10e3b9[_0x432d6e(0x166)](0x3);_0x16e460[_0x140fa1]['storage']=_0x10e3b9[0x0],_0x16e460[_0x140fa1][_0x432d6e(0x12b)]=_0x10e3b9[0x1],_0x16e460[_0x140fa1][_0x432d6e(0xbc)]=0x0,_0x16e460[_0x140fa1][_0x432d6e(0xa2)]=0x0,_0x16e460[_0x140fa1][_0x432d6e(0xbb)]=_0x432d6e(0x121),_0x16e460[_0x140fa1][_0x432d6e(0x188)]=_0x10e3b9[0x5];}else{if(_0x140fa1==_0x10c72e){var _0x5064ff;if(_0x10e3b9[0x4]=='L')_0x5064ff=_0x432d6e(0xb2);else _0x10e3b9[0x4]=='F'&&(_0x5064ff=_0x432d6e(0x121));_0x16e460[_0x140fa1]['storage']=_0x10e3b9[0x0],_0x16e460[_0x140fa1][_0x432d6e(0x12b)]=_0x10e3b9[0x1],_0x16e460[_0x140fa1][_0x432d6e(0xbc)]=_0x10e3b9[0x2],_0x16e460[_0x140fa1][_0x432d6e(0xa2)]=_0x10e3b9[0x3],_0x16e460[_0x140fa1][_0x432d6e(0xbb)]=_0x5064ff,_0x16e460[_0x140fa1][_0x432d6e(0x188)]=_0x10e3b9[0x5];}}}});}),_0x18bc7a[_0x187b6e(0xd0)]((_0x2d6405,_0x28974c)=>{var _0x42a2af=_0x187b6e;_0x16e460[_0x28974c][_0x42a2af(0xcf)]=_0x2d6405;}),_0x2a26d0[_0x187b6e(0xd0)]((_0x3697f6,_0x26036d)=>{var _0x236aad=_0x187b6e;_0x16e460[_0x26036d][_0x236aad(0xd5)]=_0x3697f6;}),_0x2d2cb2[_0x187b6e(0xd0)]((_0x5b31e1,_0x4ccffa)=>{_0x16e460[_0x4ccffa]['batch_code']=_0x5b31e1;}),_0x46da55['forEach']((_0x1a7d6a,_0x4efff3)=>{_0x16e460[_0x4efff3]['expiry_date']=_0x1a7d6a;}),_0x35dbd1[_0x187b6e(0xd0)]((_0x5b814d,_0x13cb49)=>{var _0x54cc99=_0x187b6e;_0x16e460[_0x13cb49][_0x54cc99(0xa4)]=_0x5b814d;}),_0x1b2e90['forEach']((_0x5a366b,_0x484c5f)=>{_0x16e460[_0x484c5f]['production_date']=_0x5a366b;}),_0x552413['forEach']((_0xfd0d87,_0x44ab58)=>{_0x16e460[_0x44ab58]['requested_qty']=_0xfd0d87;}),_0x469f3d[_0x187b6e(0xd0)]((_0x56a8b7,_0x577336)=>{_0x16e460[_0x577336]['delivery_date']=_0x56a8b7;}),_0x1806e8[_0x187b6e(0xd0)]((_0x3e8458,_0xf56d54)=>{var _0x4a919f=_0x187b6e;_0x16e460[_0xf56d54][_0x4a919f(0x172)]=_0x3e8458;}),_0x2cade4['forEach']((_0x5bdba7,_0x24f6a1)=>{var _0x3e08a8=_0x187b6e;_0x16e460[_0x24f6a1][_0x3e08a8(0xd7)]=_0x5bdba7;}),_0x536ce9['forEach']((_0x2626ee,_0x4a13ea)=>{var _0x5f1caf=_0x187b6e;_0x16e460[_0x4a13ea][_0x5f1caf(0x150)]=_0x2626ee;}),_0x17a3aa[_0x187b6e(0xd0)]((_0x3d85c0,_0x476de9)=>{var _0x1e3847=_0x187b6e;_0x16e460[_0x476de9][_0x1e3847(0xca)]=_0x3d85c0;}),_0x1e5d82[_0x187b6e(0xd0)]((_0x351252,_0x240676)=>{var _0x3360d2=_0x187b6e;_0x16e460[_0x240676][_0x3360d2(0xe8)]=_0x351252;});var _0x8ff238=0x0;_0x16e460['forEach'](_0x10a447=>{var _0x4067ed=_0x187b6e;(_0x10a447[_0x4067ed(0x165)]<_0x10a447['quantity_notConverted']||_0x10a447[_0x4067ed(0x150)]==0x0)&&(console[_0x4067ed(0xae)](_0x4067ed(0x11e),_0x10a447),_0x8ff238++);});const _0x47838d=_0x16e460[_0x187b6e(0x184)](_0x29da62=>_0x29da62[_0x187b6e(0xe3)]!=='0'&&_0x29da62[_0x187b6e(0xe3)]!==''),_0x4cb9c4=new sales({'invoice':_0x1ba687,'customer':_0x16de2e[_0x187b6e(0xf6)][_0x187b6e(0x14a)],'date':_0x3a31d0,'warehouse_name':_0x1cbcb9,'sale_product':_0x47838d,'note':_0x541924,'room':_0x570bbe,'primary_code':_0x22e0f3,'secondary_code':_0x10688b,'prod_code':_0x36c921,'SCRN':_0x14c998}),_0x575225=await _0x4cb9c4[_0x187b6e(0x13a)]();_0x16de2e[_0x187b6e(0x16b)](_0x187b6e(0x16f),_0x187b6e(0x148)),_0x4bc9b6[_0x187b6e(0x171)](_0x187b6e(0x167)+_0x575225[_0x187b6e(0xd2)]);}catch(_0x3f62e7){console[_0x187b6e(0xae)](_0x3f62e7);}}),router[a0_0x4f2468(0xd1)](a0_0x4f2468(0xc5),auth,async(_0x497714,_0x3a0c56)=>{var _0x4f5b8f=a0_0x4f2468;try{const {username:_0x161f51,email:_0x5a37d8,role:_0x4f5eb9}=_0x497714[_0x4f5b8f(0xf8)],_0x3e272f=_0x497714[_0x4f5b8f(0xf8)],_0x50a802=await profile[_0x4f5b8f(0xe2)]({'email':_0x3e272f[_0x4f5b8f(0xe7)]}),_0x6acfb7=await master_shop[_0x4f5b8f(0x124)](),_0x1210ca=_0x497714[_0x4f5b8f(0x1a4)]['id'],_0x539e7f=await sales[_0x4f5b8f(0xf7)](_0x1210ca),_0x3b21d5=await warehouse[_0x4f5b8f(0x14d)]([{'$match':{'name':_0x539e7f[_0x4f5b8f(0xb6)]}},{'$unwind':_0x4f5b8f(0xa7)},{'$group':{'_id':_0x4f5b8f(0x175),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4f5b8f(0x18e)},'floorlevel':{'$first':_0x4f5b8f(0xc9)},'primary_code':{'$first':_0x4f5b8f(0x19a)},'secondary_code':{'$first':_0x4f5b8f(0xaa)},'product_code':{'$first':_0x4f5b8f(0x106)},'storage':{'$first':_0x4f5b8f(0xdf)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4f5b8f(0x140)},'production_date':{'$first':_0x4f5b8f(0x17a)},'invoice':{'$first':_0x4f5b8f(0xcc)}}}]),_0x12312c=await customer['find']({});let _0x2039a4;if(_0x3e272f['role']=='staff'){const _0x138569=await staff[_0x4f5b8f(0xe2)]({'email':_0x3e272f['email']});_0x2039a4=await warehouse['aggregate']([{'$match':{'status':_0x4f5b8f(0xba),'name':_0x138569[_0x4f5b8f(0x153)]}},{'$group':{'_id':'$name','name':{'$first':_0x4f5b8f(0x141)}}}]);}else _0x2039a4=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x4f5b8f(0x141)}}}]);const _0x3a4904=await product[_0x4f5b8f(0x124)]({}),_0x17432c=await suppliers[_0x4f5b8f(0x124)]({});if(_0x6acfb7[0x0]['language']=='English\x20(US)'){var _0x59b22e=users['English'];console['log'](_0x59b22e);}else{if(_0x6acfb7[0x0]['language']==_0x4f5b8f(0x15e))var _0x59b22e=users[_0x4f5b8f(0x15e)];else{if(_0x6acfb7[0x0][_0x4f5b8f(0xdc)]==_0x4f5b8f(0x15c))var _0x59b22e=users[_0x4f5b8f(0x15c)];else{if(_0x6acfb7[0x0][_0x4f5b8f(0xdc)]=='Spanish')var _0x59b22e=users['Spanish'];else{if(_0x6acfb7[0x0][_0x4f5b8f(0xdc)]==_0x4f5b8f(0xff))var _0x59b22e=users[_0x4f5b8f(0xff)];else{if(_0x6acfb7[0x0][_0x4f5b8f(0xdc)]==_0x4f5b8f(0x194))var _0x59b22e=users[_0x4f5b8f(0x12f)];else{if(_0x6acfb7[0x0][_0x4f5b8f(0xdc)]=='Chinese')var _0x59b22e=users[_0x4f5b8f(0x156)];else{if(_0x6acfb7[0x0][_0x4f5b8f(0xdc)]==_0x4f5b8f(0x11f))var _0x59b22e=users['Arabic'];}}}}}}}_0x3a0c56[_0x4f5b8f(0x177)]('edit_sales_view',{'success':_0x497714[_0x4f5b8f(0x16b)](_0x4f5b8f(0x16f)),'errors':_0x497714['flash'](_0x4f5b8f(0xd9)),'role':_0x3e272f,'profile':_0x50a802,'customer':_0x12312c,'warehouse':_0x2039a4,'product':_0x3b21d5,'user':_0x539e7f,'master_shop':_0x6acfb7,'unit':_0x3a4904,'language':_0x59b22e,'suppliers':_0x17432c});}catch(_0x1ea004){console['log'](_0x1ea004);}}),router[a0_0x4f2468(0x10f)](a0_0x4f2468(0xc5),auth,async(_0x5a60de,_0x375adf)=>{var _0x1695f7=a0_0x4f2468;try{const _0x5418aa=_0x5a60de['params']['id'],{invoice:_0x4308f7,warehouse_name:_0x960cb6,room:_0x1bc03d}=_0x5a60de['body'],_0x47cbc0=await sales['findOne']({'invoice':_0x4308f7}),_0x9eaf37=_0x47cbc0[_0x1695f7(0xc4)]['map'](async _0xac9c2f=>{var _0x5bdf1d=_0x1695f7,_0x270ac5=await warehouse[_0x5bdf1d(0xe2)]({'name':_0x960cb6,'room':_0xac9c2f['room_name'],'warehouse_category':_0x5bdf1d(0x193)});const _0xf4a822=_0x270ac5[_0x5bdf1d(0x120)][_0x5bdf1d(0x179)](_0x52da1a=>{var _0x3357d0=_0x5bdf1d;_0x52da1a[_0x3357d0(0x19d)]==_0xac9c2f[_0x3357d0(0x19d)]&&_0x52da1a[_0x3357d0(0x188)]==_0xac9c2f[_0x3357d0(0x188)]&&_0x52da1a[_0x3357d0(0xbb)]==_0xac9c2f[_0x3357d0(0xbb)]&&_0x52da1a['bin']==_0xac9c2f['bin']&&_0x52da1a['bay']==_0xac9c2f[_0x3357d0(0xbc)]&&_0x52da1a['rack']==_0xac9c2f['rack']&&_0x52da1a[_0x3357d0(0xbe)]==_0xac9c2f[_0x3357d0(0xbe)]&&_0x52da1a[_0x3357d0(0xf4)]==_0xac9c2f['expiry_date']&&_0x52da1a['batch_code']==_0xac9c2f['batch_code']&&_0x52da1a[_0x3357d0(0xe8)]==_0xac9c2f[_0x3357d0(0xe8)]&&_0x52da1a[_0x3357d0(0xd2)]==_0xac9c2f[_0x3357d0(0xe1)]&&(_0x52da1a[_0x3357d0(0x101)]=Math[_0x3357d0(0xa6)](0x0,Math[_0x3357d0(0x1a1)](_0x52da1a[_0x3357d0(0x101)])-Math[_0x3357d0(0x1a1)](_0xac9c2f[_0x3357d0(0xe3)])));});return _0x270ac5;});Promise[_0x1695f7(0xc3)](_0x9eaf37)[_0x1695f7(0x15b)](async _0x38bdec=>{var _0xe223e7=_0x1695f7;try{for(const _0x3aa558 of _0x38bdec){await _0x3aa558[_0xe223e7(0x13a)]();}_0x47cbc0['finalize']=_0xe223e7(0x17e);const _0xe1e4e9=await _0x47cbc0[_0xe223e7(0x13a)](),_0x33bd80=await master_shop[_0xe223e7(0x124)](),_0x647b3d=await email_settings['findOne'](),_0x1acc41=await supervisor_settings[_0xe223e7(0x124)]();var _0x179446=_0x47cbc0[_0xe223e7(0xc4)],_0x41b412='',_0x8f5d0f;for(_0x8f5d0f in _0x179446){_0x41b412+=_0xe223e7(0x1a2)+_0xe223e7(0x164)+_0x179446[_0x8f5d0f]['product_name']+_0xe223e7(0x108)+_0xe223e7(0x164)+_0x179446[_0x8f5d0f][_0xe223e7(0x192)]+_0xe223e7(0x108)+_0xe223e7(0x164)+_0x179446[_0x8f5d0f]['quantity']+_0xe223e7(0x108)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x179446[_0x8f5d0f][_0xe223e7(0xcf)]+_0xe223e7(0x108)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x179446[_0x8f5d0f][_0xe223e7(0xd5)]+'</td>'+_0xe223e7(0x164)+_0x47cbc0[_0xe223e7(0xb6)]+_0xe223e7(0x108)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x179446[_0x8f5d0f][_0xe223e7(0xca)]+_0xe223e7(0x108)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x179446[_0x8f5d0f][_0xe223e7(0xbe)]+_0x179446[_0x8f5d0f][_0xe223e7(0x12b)]+_0x179446[_0x8f5d0f][_0xe223e7(0xbc)]+_0x179446[_0x8f5d0f]['bin']+_0x179446[_0x8f5d0f][_0xe223e7(0xbb)][0x0]+_0x179446[_0x8f5d0f][_0xe223e7(0x188)]+_0xe223e7(0x108),'</tr>';}let _0x3d3042=nodemailer['createTransport']({'host':_0x647b3d[_0xe223e7(0x14f)],'port':Number(_0x647b3d[_0xe223e7(0xb8)]),'secure':![],'auth':{'user':_0x647b3d[_0xe223e7(0xe7)],'pass':_0x647b3d[_0xe223e7(0xb9)]}}),_0x589315={'from':_0x647b3d[_0xe223e7(0xe7)],'to':_0x1acc41[0x0][_0xe223e7(0x110)],'subject':_0xe223e7(0x176),'attachments':[{'filename':_0xe223e7(0x190),'path':__dirname+'/../public'+_0xe223e7(0xc8)+_0x33bd80[0x0][_0xe223e7(0x12c)],'cid':_0xe223e7(0x183)}],'html':_0xe223e7(0x13f)+'<html><head><title></title>'+'</head><body>'+_0xe223e7(0xe0)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xe223e7(0xe0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0xe223e7(0xe0)+_0xe223e7(0x182)+_0x33bd80[0x0]['site_title']+_0xe223e7(0x168)+_0xe223e7(0x134)+_0xe223e7(0x134)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x47cbc0[_0xe223e7(0xe8)]+'\x20'+_0xe223e7(0x137)+'\x20Order\x20Date\x20:\x20'+_0x47cbc0[_0xe223e7(0x19b)]+'\x20'+_0xe223e7(0x185)+_0xe223e7(0x10d)+'</div>'+_0xe223e7(0x113)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xe223e7(0x1a2)+_0xe223e7(0xaf)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0xe223e7(0xdb)+_0xe223e7(0x170)+_0xe223e7(0x104)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0xe223e7(0x11c)+_0xe223e7(0xab)+'</thead>'+_0xe223e7(0xe9)+'\x20'+_0x41b412+'\x20'+_0xe223e7(0x149)+_0xe223e7(0x145)+_0xe223e7(0xe0)+_0xe223e7(0x14b)+'<h5>'+_0x33bd80[0x0][_0xe223e7(0x159)]+'</h5>'+_0xe223e7(0x134)+_0xe223e7(0x134)+_0xe223e7(0x9b)};_0x3d3042[_0xe223e7(0x16e)](_0x589315,function(_0x2aea38,_0x4eae5e){var _0x3421b3=_0xe223e7;_0x2aea38?(console[_0x3421b3(0xae)](_0x2aea38),console[_0x3421b3(0xae)](_0x3421b3(0x117))):console[_0x3421b3(0xae)](_0x3421b3(0x129));}),_0x5a60de['flash']('success','Sales\x20Update\x20successfully'),_0x375adf[_0xe223e7(0x171)](_0xe223e7(0x167)+_0x5418aa);}catch(_0x15ed4b){console[_0xe223e7(0x16d)](_0x15ed4b),_0x375adf[_0xe223e7(0x9c)](0x1f4)[_0xe223e7(0x107)]({'error':_0xe223e7(0xf3)});}})[_0x1695f7(0xfa)](_0x5a0263=>{var _0x1525b6=_0x1695f7;console['error'](_0x5a0263),_0x375adf[_0x1525b6(0x9c)](0x1f4)['json']({'error':_0x1525b6(0x135)});});}catch(_0x59ddb8){console['log'](_0x59ddb8);}}),router[a0_0x4f2468(0xd1)](a0_0x4f2468(0xd4),auth,async(_0x5af8f2,_0x1c5593)=>{var _0x7b6756=a0_0x4f2468;try{const {username:_0x3b652b,email:_0x18effc,role:_0xf6e5ec}=_0x5af8f2[_0x7b6756(0xf8)],_0x3cf12d=_0x5af8f2[_0x7b6756(0xf8)],_0x3bd49d=await profile['findOne']({'email':_0x3cf12d[_0x7b6756(0xe7)]}),_0x1191eb=await master_shop['find'](),_0x3766f6=_0x5af8f2['params']['id'],_0x406a6d=await sales[_0x7b6756(0xf7)](_0x3766f6);var _0x5a8e3e=[_0x7b6756(0xef),_0x7b6756(0xc0)];const _0x107454=await warehouse[_0x7b6756(0x14d)]([{'$match':{'name':_0x406a6d['warehouse_name'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x7b6756(0xa7)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x7b6756(0x19c)},'product_stock':{'$first':_0x7b6756(0xa5)},'bay':{'$first':_0x7b6756(0xf1)},'bin':{'$first':_0x7b6756(0x18b)},'type':{'$first':_0x7b6756(0x18e)},'floorlevel':{'$first':_0x7b6756(0xc9)},'primary_code':{'$first':_0x7b6756(0x19a)},'secondary_code':{'$first':_0x7b6756(0xaa)},'product_code':{'$first':_0x7b6756(0x106)},'storage':{'$first':_0x7b6756(0xdf)},'rack':{'$first':_0x7b6756(0xcb)}}}]),_0x210f3b=await customer[_0x7b6756(0x124)]({});let _0x38cbfc;if(_0x3cf12d[_0x7b6756(0xc7)]==_0x7b6756(0xc6)){const _0x15be6e=await staff[_0x7b6756(0xe2)]({'email':_0x3cf12d[_0x7b6756(0xe7)]});_0x38cbfc=await warehouse[_0x7b6756(0x14d)]([{'$match':{'status':_0x7b6756(0xba),'name':_0x15be6e[_0x7b6756(0x153)],'warehouse_category':_0x7b6756(0x193)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x38cbfc=await warehouse[_0x7b6756(0x14d)]([{'$match':{'status':_0x7b6756(0xba),'warehouse_category':_0x7b6756(0x193)}},{'$group':{'_id':_0x7b6756(0x141),'name':{'$first':_0x7b6756(0x141)}}}]);const _0x9c88a0=await product[_0x7b6756(0x124)]({});if(_0x1191eb[0x0][_0x7b6756(0xdc)]==_0x7b6756(0x9f)){var _0x2163a5=users[_0x7b6756(0xde)];console['log'](_0x2163a5);}else{if(_0x1191eb[0x0][_0x7b6756(0xdc)]==_0x7b6756(0x15e))var _0x2163a5=users[_0x7b6756(0x15e)];else{if(_0x1191eb[0x0][_0x7b6756(0xdc)]=='German')var _0x2163a5=users[_0x7b6756(0x15c)];else{if(_0x1191eb[0x0][_0x7b6756(0xdc)]=='Spanish')var _0x2163a5=users[_0x7b6756(0x132)];else{if(_0x1191eb[0x0][_0x7b6756(0xdc)]=='French')var _0x2163a5=users[_0x7b6756(0xff)];else{if(_0x1191eb[0x0]['language']==_0x7b6756(0x194))var _0x2163a5=users[_0x7b6756(0x12f)];else{if(_0x1191eb[0x0][_0x7b6756(0xdc)]==_0x7b6756(0x156))var _0x2163a5=users[_0x7b6756(0x156)];else{if(_0x1191eb[0x0][_0x7b6756(0xdc)]==_0x7b6756(0x11f))var _0x2163a5=users['Arabic'];}}}}}}}_0x1c5593[_0x7b6756(0x177)](_0x7b6756(0x11a),{'success':_0x5af8f2['flash'](_0x7b6756(0x16f)),'errors':_0x5af8f2['flash'](_0x7b6756(0xd9)),'role':_0x3cf12d,'profile':_0x3bd49d,'customer':_0x210f3b,'warehouse':_0x38cbfc,'product':_0x107454,'user':_0x406a6d,'master_shop':_0x1191eb,'unit':_0x9c88a0,'language':_0x2163a5});}catch(_0x18af3d){console[_0x7b6756(0xae)](_0x18af3d);}}),router['post'](a0_0x4f2468(0xd4),auth,async(_0x2d85f5,_0x23decb)=>{var _0x41d5a0=a0_0x4f2468;try{const _0x55acda=_0x2d85f5[_0x41d5a0(0x1a4)]['id'],_0xfa2701=await sales[_0x41d5a0(0xe2)]({'_id':_0x2d85f5['params']['id']}),_0x4fb41e=await warehouse[_0x41d5a0(0xe2)]({'name':_0xfa2701[_0x41d5a0(0xb6)],'room':_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x15a)]}),{invoice:_0x22dc8f,date:_0x34a48c,warehouse_name:_0x1c6ee1,product_name:_0x50eccc,stock:_0x226e3d,quantity:_0x247280,note:_0x162ae4,room:_0x389426,customer:_0x43117c,SCRN:_0x4f4ff1}=_0x2d85f5[_0x41d5a0(0xf6)];if(typeof _0x50eccc==_0x41d5a0(0xbd))var _0x11fd76=[_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x19d)]],_0x37bbf1=[_0x2d85f5[_0x41d5a0(0xf6)]['stock']],_0x4813d6=[_0x2d85f5[_0x41d5a0(0xf6)]['carton']],_0x477571=[_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x181)]],_0x475101=[_0x2d85f5['body'][_0x41d5a0(0x9d)]],_0x2e9d64=[_0x2d85f5[_0x41d5a0(0xf6)]['prod_code']],_0x299ff3=[_0x2d85f5[_0x41d5a0(0xf6)]['level']],_0x532607=[_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x195)]],_0x7104f9=[_0x2d85f5[_0x41d5a0(0xf6)]['secondary_unit']],_0x37f031=[_0x2d85f5['body'][_0x41d5a0(0x146)]],_0x31051c=[_0x2d85f5['body'][_0x41d5a0(0xf4)]],_0x5af9df=[_0x2d85f5[_0x41d5a0(0xf6)]['max_per_unit']],_0x32d24e=[_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x18f)]],_0x231124=[_0x2d85f5['body'][_0x41d5a0(0x119)]],_0x42bf78=[_0x2d85f5[_0x41d5a0(0xf6)]['delivery_date']],_0x2144da=[_0x2d85f5['body'][_0x41d5a0(0x172)]],_0x1d2524=[_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0xd7)]],_0x26d8d8=[_0x2d85f5['body'][_0x41d5a0(0xe3)]],_0xd6f273=[_0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x139)]];else var _0x11fd76=[..._0x2d85f5[_0x41d5a0(0xf6)]['product_name']],_0x37bbf1=[..._0x2d85f5['body']['stock']],_0x4813d6=[..._0x2d85f5['body'][_0x41d5a0(0x10a)]],_0x477571=[..._0x2d85f5['body'][_0x41d5a0(0x181)]],_0x475101=[..._0x2d85f5['body']['secondary_code']],_0x2e9d64=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x15d)]],_0x299ff3=[..._0x2d85f5[_0x41d5a0(0xf6)]['level']],_0x532607=[..._0x2d85f5['body'][_0x41d5a0(0x195)]],_0x7104f9=[..._0x2d85f5[_0x41d5a0(0xf6)]['secondary_unit']],_0x37f031=[..._0x2d85f5['body'][_0x41d5a0(0x146)]],_0x31051c=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0xf4)]],_0x5af9df=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0xf9)]],_0x32d24e=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x18f)]],_0x231124=[..._0x2d85f5[_0x41d5a0(0xf6)]['requested_qty']],_0x42bf78=[..._0x2d85f5['body'][_0x41d5a0(0x14c)]],_0x2144da=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x172)]],_0x1d2524=[..._0x2d85f5['body'][_0x41d5a0(0xd7)]],_0x26d8d8=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0xe3)]],_0xd6f273=[..._0x2d85f5[_0x41d5a0(0xf6)][_0x41d5a0(0x139)]];const _0x1e26ab=_0x11fd76[_0x41d5a0(0x179)](_0x1a5645=>{return _0x1a5645={'product_name':_0x1a5645};});_0x37bbf1[_0x41d5a0(0xd0)]((_0x366c37,_0x583f97)=>{var _0x3d40cd=_0x41d5a0;_0x1e26ab[_0x583f97]['stock']=Math[_0x3d40cd(0x1a1)](_0x366c37);}),_0x4813d6[_0x41d5a0(0xd0)]((_0x177576,_0x5169a8)=>{_0x1e26ab[_0x5169a8]['quantity']=_0x177576;}),_0x477571[_0x41d5a0(0xd0)]((_0x59ebdf,_0xb6cc5b)=>{var _0x21cdad=_0x41d5a0;_0x1e26ab[_0xb6cc5b][_0x21cdad(0x181)]=_0x59ebdf;}),_0x475101[_0x41d5a0(0xd0)]((_0x58b6fc,_0x497614)=>{var _0x457de6=_0x41d5a0;_0x1e26ab[_0x497614][_0x457de6(0x9d)]=_0x58b6fc;}),_0x2e9d64[_0x41d5a0(0xd0)]((_0x3c47e0,_0x5d6933)=>{_0x1e26ab[_0x5d6933]['product_code']=_0x3c47e0;}),_0x299ff3['forEach']((_0xdbdff6,_0x467493)=>{_0xd6f273['forEach']((_0x303516,_0x82b5c6)=>{var _0x2dda30=a0_0x2af8;if(_0x303516==_0x2dda30(0x157)&&_0x467493==_0x82b5c6){var _0x3b408a=_0xdbdff6[_0x2dda30(0x166)](0x3);_0x1e26ab[_0x467493][_0x2dda30(0xbe)]=_0xdbdff6[0x0],_0x1e26ab[_0x467493]['rack']=_0xdbdff6[0x1],_0x1e26ab[_0x467493][_0x2dda30(0xbc)]=0x0,_0x1e26ab[_0x467493][_0x2dda30(0xa2)]=0x0,_0x1e26ab[_0x467493][_0x2dda30(0xbb)]=_0x2dda30(0x121),_0x1e26ab[_0x467493][_0x2dda30(0x188)]=_0x3b408a;}else{if(_0x303516==_0x2dda30(0x142)&&_0x467493==_0x82b5c6){var _0x3b408a=_0xdbdff6[_0x2dda30(0x166)](0x3);_0x1e26ab[_0x467493][_0x2dda30(0xbe)]=_0xdbdff6[0x0],_0x1e26ab[_0x467493][_0x2dda30(0x12b)]=_0xdbdff6[0x1],_0x1e26ab[_0x467493][_0x2dda30(0xbc)]=0x0,_0x1e26ab[_0x467493][_0x2dda30(0xa2)]=0x0,_0x1e26ab[_0x467493][_0x2dda30(0xbb)]=_0x2dda30(0x121),_0x1e26ab[_0x467493]['floorlevel']=_0xdbdff6[0x5];}else{if(_0x467493==_0x82b5c6){var _0x5f44a0;if(_0xdbdff6[0x4]=='L')_0x5f44a0=_0x2dda30(0xb2);else _0xdbdff6[0x4]=='F'&&(_0x5f44a0=_0x2dda30(0x121));_0x1e26ab[_0x467493]['storage']=_0xdbdff6[0x0],_0x1e26ab[_0x467493][_0x2dda30(0x12b)]=_0xdbdff6[0x1],_0x1e26ab[_0x467493][_0x2dda30(0xbc)]=_0xdbdff6[0x2],_0x1e26ab[_0x467493][_0x2dda30(0xa2)]=_0xdbdff6[0x3],_0x1e26ab[_0x467493][_0x2dda30(0xbb)]=_0x5f44a0,_0x1e26ab[_0x467493]['floorlevel']=_0xdbdff6[0x5];}}}});}),_0x532607['forEach']((_0x5e84ad,_0x58879a)=>{_0x1e26ab[_0x58879a]['unit']=_0x5e84ad;}),_0x7104f9['forEach']((_0x88d225,_0x191dfc)=>{var _0x1eb12d=_0x41d5a0;_0x1e26ab[_0x191dfc][_0x1eb12d(0xd5)]=_0x88d225;}),_0x37f031[_0x41d5a0(0xd0)]((_0x60b493,_0x3b50d5)=>{var _0x50501b=_0x41d5a0;_0x1e26ab[_0x3b50d5][_0x50501b(0x146)]=_0x60b493;}),_0x31051c[_0x41d5a0(0xd0)]((_0x20c896,_0x1ce78a)=>{_0x1e26ab[_0x1ce78a]['expiry_date']=_0x20c896;}),_0x5af9df[_0x41d5a0(0xd0)]((_0x186345,_0x5722dd)=>{var _0x3f193e=_0x41d5a0;_0x1e26ab[_0x5722dd][_0x3f193e(0xa4)]=_0x186345;}),_0x32d24e['forEach']((_0x5a7b74,_0x5d4430)=>{_0x1e26ab[_0x5d4430]['production_date']=_0x5a7b74;}),_0x231124['forEach']((_0x51dbb4,_0x37b76b)=>{var _0x49c8b4=_0x41d5a0;_0x1e26ab[_0x37b76b][_0x49c8b4(0x119)]=Math[_0x49c8b4(0x1a1)](_0x51dbb4);}),_0x42bf78[_0x41d5a0(0xd0)]((_0x3fd1fe,_0x5a731d)=>{_0x1e26ab[_0x5a731d]['delivery_date']=_0x3fd1fe;}),_0x2144da[_0x41d5a0(0xd0)]((_0x2b57bb,_0x4617eb)=>{var _0x434873=_0x41d5a0;_0x1e26ab[_0x4617eb][_0x434873(0x172)]=_0x2b57bb;}),_0x1d2524[_0x41d5a0(0xd0)]((_0x4099e4,_0x2e7828)=>{var _0x5c1ea2=_0x41d5a0;_0x1e26ab[_0x2e7828][_0x5c1ea2(0xd7)]=_0x4099e4;}),_0x26d8d8[_0x41d5a0(0xd0)]((_0x11b44a,_0x4486e5)=>{var _0x594960=_0x41d5a0;_0x1e26ab[_0x4486e5][_0x594960(0x150)]=_0x11b44a;}),_0xd6f273['forEach']((_0x3ee1d5,_0x25589d)=>{var _0xb8eb80=_0x41d5a0;_0x1e26ab[_0x25589d][_0xb8eb80(0xca)]=_0x3ee1d5;});var _0x1f6719=0x0;_0x1e26ab['forEach'](_0x637380=>{var _0x88174b=_0x41d5a0;console['log'](_0x88174b(0x11e),_0x637380),(parseInt(_0x637380[_0x88174b(0x165)])<parseInt(_0x637380[_0x88174b(0xe3)])||parseInt(_0x637380[_0x88174b(0xe3)])==0x0)&&_0x1f6719++;});if(_0x1f6719!=0x0)return _0x2d85f5[_0x41d5a0(0x16b)]('errors',_0x41d5a0(0x1a3)),_0x23decb[_0x41d5a0(0x171)](_0x41d5a0(0x186));const _0x4c47fc=_0x1e26ab['filter'](_0x14d265=>_0x14d265[_0x41d5a0(0xe3)]!=='0'&&_0x14d265['quantity']!=='');_0xfa2701['invoice']=_0x22dc8f,_0xfa2701[_0x41d5a0(0x14a)]=_0x43117c,_0xfa2701[_0x41d5a0(0x19b)]=_0x34a48c,_0xfa2701[_0x41d5a0(0xb6)]=_0x1c6ee1,_0xfa2701[_0x41d5a0(0xc4)]=_0x4c47fc,_0xfa2701[_0x41d5a0(0x19e)]=_0x162ae4,_0xfa2701[_0x41d5a0(0x152)]=_0x4f4ff1,_0xfa2701['finalize']=_0x41d5a0(0x16a),_0xfa2701[_0x41d5a0(0x10c)]=_0x41d5a0(0x16a);const _0x374757=await _0xfa2701[_0x41d5a0(0x13a)]();_0x2d85f5[_0x41d5a0(0x16b)](_0x41d5a0(0x16f),_0x41d5a0(0xc1)),_0x23decb[_0x41d5a0(0x171)](_0x41d5a0(0xb7));}catch(_0x4adff4){console[_0x41d5a0(0xae)](_0x4adff4);}}),router[a0_0x4f2468(0x10f)](a0_0x4f2468(0x151),auth,async(_0x3fc8d2,_0x3a8e5f)=>{var _0x11c9c7=a0_0x4f2468;try{const _0x11df7d=_0x3fc8d2[_0x11c9c7(0x1a4)]['id'],{invoice:_0x1dfe27,customer:_0x1b76eb,receivable_amount:_0x281ba0,received_amount:_0x2aabee}=_0x3fc8d2['body'],_0x271747=await sales['findById'](_0x11df7d);console[_0x11c9c7(0xae)](_0x271747);var _0x59745e=_0x281ba0-_0x2aabee;console[_0x11c9c7(0xae)](_0x2aabee),_0x271747[_0x11c9c7(0x12a)]=parseFloat(_0x2aabee)+parseFloat(_0x271747['received_amount']),_0x271747['due_amount']=_0x59745e,console['log'](_0x271747);const _0x2d9f7c=await _0x271747['save'](),_0x28588a=await c_payment_data[_0x11c9c7(0xe2)]({'invoice':_0x1dfe27});_0x28588a[_0x11c9c7(0x13d)]=_0x59745e,await _0x28588a[_0x11c9c7(0x13a)]();let _0x57ba25=new Date(),_0x1cf263=('0'+_0x57ba25[_0x11c9c7(0xeb)]())['slice'](-0x2),_0x5a2200=('0'+(_0x57ba25[_0x11c9c7(0x136)]()+0x1))[_0x11c9c7(0x166)](-0x2),_0x162c77=_0x57ba25['getFullYear'](),_0x551423=_0x162c77+'-'+_0x5a2200+'-'+_0x1cf263;const _0x5827ec=new customer_payment({'invoice':_0x1dfe27,'date':_0x162c77+'-'+_0x5a2200+'-'+_0x1cf263,'customer':_0x1b76eb,'reason':_0x11c9c7(0xec),'amount':_0x2aabee}),_0xa5ebb4=await _0x5827ec[_0x11c9c7(0x13a)]();_0x3fc8d2[_0x11c9c7(0x16b)](_0x11c9c7(0x16f),'payment\x20successfull'),_0x3a8e5f[_0x11c9c7(0x171)](_0x11c9c7(0xb7));}catch(_0x4f116a){console[_0x11c9c7(0xae)](_0x4f116a);}}),router['get'](a0_0x4f2468(0xf2),auth,async(_0x5c7339,_0x163821)=>{var _0x331202=a0_0x4f2468;try{const {username:_0x113296,email:_0x33c49c,role:_0x2aa76c}=_0x5c7339[_0x331202(0xf8)],_0x8d73f9=_0x5c7339[_0x331202(0xf8)],_0xeb0067=await profile[_0x331202(0xe2)]({'email':_0x8d73f9[_0x331202(0xe7)]}),_0x428b4f=await master_shop['find']();console[_0x331202(0xae)](_0x331202(0x178),_0x428b4f);const _0x265877=_0x5c7339[_0x331202(0x1a4)]['id'],_0x14a976=await sales['findById'](_0x265877);console['log'](_0x14a976);const _0x4fb0c4=await customer['findOne']({'name':_0x14a976['customer']});console['log'](_0x4fb0c4);if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0x9f)){var _0x3aa4df=users[_0x331202(0xde)];console[_0x331202(0xae)](_0x3aa4df);}else{if(_0x428b4f[0x0]['language']==_0x331202(0x15e))var _0x3aa4df=users[_0x331202(0x15e)];else{if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0x15c))var _0x3aa4df=users[_0x331202(0x15c)];else{if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0x132))var _0x3aa4df=users['Spanish'];else{if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0xff))var _0x3aa4df=users[_0x331202(0xff)];else{if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0x194))var _0x3aa4df=users[_0x331202(0x12f)];else{if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0x156))var _0x3aa4df=users[_0x331202(0x156)];else{if(_0x428b4f[0x0][_0x331202(0xdc)]==_0x331202(0x11f))var _0x3aa4df=users[_0x331202(0xa0)];}}}}}}}_0x163821['render'](_0x331202(0x17c),{'success':_0x5c7339[_0x331202(0x16b)]('success'),'errors':_0x5c7339[_0x331202(0x16b)](_0x331202(0xd9)),'role':_0x8d73f9,'profile':_0xeb0067,'master_shop':_0x428b4f,'customers':_0x4fb0c4,'sales':_0x14a976,'language':_0x3aa4df});}catch(_0xda41ea){console[_0x331202(0xae)](_0xda41ea);}}),router[a0_0x4f2468(0xd1)](a0_0x4f2468(0xb5),auth,async(_0x38c53e,_0x44ac64)=>{var _0x51b804=a0_0x4f2468;try{const {username:_0x1834f9,email:_0x1ed0ca,role:_0x26107f}=_0x38c53e[_0x51b804(0xf8)],_0x2db870=_0x38c53e[_0x51b804(0xf8)],_0x422113=await profile['findOne']({'email':_0x2db870['email']}),_0x6a4243=await master_shop[_0x51b804(0x124)]();console[_0x51b804(0xae)](_0x51b804(0x178),_0x6a4243);const _0x51854b=_0x38c53e[_0x51b804(0x1a4)]['id'];console[_0x51b804(0xae)](_0x51854b);const _0x5dab51=await sales['findById'](_0x51854b);console[_0x51b804(0xae)](_0x51b804(0x138),_0x5dab51);const _0x3a45b9=await warehouse['aggregate']([{'$match':{'name':'Return\x20Goods','room':_0x51b804(0x196)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x51b804(0x175),'name':{'$first':_0x51b804(0x19c)},'product_stock':{'$first':_0x51b804(0xa5)},'level':{'$first':_0x51b804(0x162)},'isle':{'$first':_0x51b804(0x144)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x51b804(0x19a)},'secondary_code':{'$first':_0x51b804(0xaa)},'product_code':{'$first':_0x51b804(0x106)}}}]);console[_0x51b804(0xae)](_0x51b804(0xf0),_0x3a45b9);const _0x189b14=await product['find']({});warehouse_data=await warehouse[_0x51b804(0x14d)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x51b804(0x193)}},{'$group':{'_id':_0x51b804(0x141),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x377d71=['Return\x20Rooms'];if(_0x6a4243[0x0][_0x51b804(0xdc)]=='English\x20(US)'){var _0x1bdfcf=users['English'];console['log'](_0x1bdfcf);}else{if(_0x6a4243[0x0]['language']==_0x51b804(0x15e))var _0x1bdfcf=users[_0x51b804(0x15e)];else{if(_0x6a4243[0x0][_0x51b804(0xdc)]==_0x51b804(0x15c))var _0x1bdfcf=users['German'];else{if(_0x6a4243[0x0][_0x51b804(0xdc)]==_0x51b804(0x132))var _0x1bdfcf=users[_0x51b804(0x132)];else{if(_0x6a4243[0x0]['language']==_0x51b804(0xff))var _0x1bdfcf=users['French'];else{if(_0x6a4243[0x0][_0x51b804(0xdc)]==_0x51b804(0x194))var _0x1bdfcf=users['Portuguese'];else{if(_0x6a4243[0x0][_0x51b804(0xdc)]==_0x51b804(0x156))var _0x1bdfcf=users['Chinese'];else{if(_0x6a4243[0x0][_0x51b804(0xdc)]=='Arabic\x20(ae)')var _0x1bdfcf=users[_0x51b804(0xa0)];}}}}}}}_0x44ac64['render'](_0x51b804(0x143),{'success':_0x38c53e[_0x51b804(0x16b)](_0x51b804(0x16f)),'errors':_0x38c53e[_0x51b804(0x16b)](_0x51b804(0xd9)),'role':_0x2db870,'profile':_0x422113,'user':_0x5dab51,'stock':_0x3a45b9,'master_shop':_0x6a4243,'unit':_0x189b14,'language':_0x1bdfcf,'warehouses':warehouse_data,'rooms':_0x377d71});}catch(_0x417252){console['log'](_0x417252),_0x44ac64[_0x51b804(0x9c)](0xc8)['json']({'message':_0x417252[_0x51b804(0x180)]});}}),router[a0_0x4f2468(0x10f)](a0_0x4f2468(0xb5),auth,async(_0x3944d2,_0x3e9b8b)=>{var _0x161115=a0_0x4f2468;try{const {invoice:_0x2fea44,date:_0x51f4ee,warehouse_name:_0x2c6b65,product_name:_0xcbbf28,primary_code:_0xc46118,secondary_code:_0x5b1e76,product_code:_0x2dfea5,sales_quantity:_0x267c5c,stocks:_0xa2dd06,return_qty:_0x26e53f,Room_name:_0x1208be,to_warehouse_name:_0x3e5fcc,to_Roomname:_0x2c615a,to_Room_name:_0x259d96,note:_0x503ec6,level:_0x51e3ab,isle:_0x5826c9,pallet:_0x412288}=_0x3944d2['body'];if(typeof _0xcbbf28==_0x161115(0xbd))var _0x1ab3a8=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x19d)]],_0x74161f=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x181)]],_0x2aab74=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x9d)]],_0x404557=[_0x3944d2['body']['product_code']],_0x49a55c=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x189)]],_0x376359=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x115)]],_0x3a2c1c=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x100)]],_0x48d2bc=[_0x3944d2[_0x161115(0xf6)]['bay']],_0x4723ea=[_0x3944d2[_0x161115(0xf6)][_0x161115(0xa2)]],_0x56a120=[_0x3944d2[_0x161115(0xf6)][_0x161115(0x111)]],_0x52fb0a=[_0x3944d2['body'][_0x161115(0x188)]];else var _0x1ab3a8=[..._0x3944d2[_0x161115(0xf6)][_0x161115(0x19d)]],_0x74161f=[..._0x3944d2[_0x161115(0xf6)]['primary_code']],_0x2aab74=[..._0x3944d2['body'][_0x161115(0x9d)]],_0x404557=[..._0x3944d2[_0x161115(0xf6)][_0x161115(0x192)]],_0x49a55c=[..._0x3944d2[_0x161115(0xf6)][_0x161115(0x189)]],_0x376359=[..._0x3944d2[_0x161115(0xf6)]['stocks']],_0x3a2c1c=[..._0x3944d2['body'][_0x161115(0x100)]],_0x48d2bc=[..._0x3944d2[_0x161115(0xf6)]['bay']],_0x4723ea=[..._0x3944d2['body']['bin']],_0x56a120=[..._0x3944d2[_0x161115(0xf6)][_0x161115(0x111)]],_0x52fb0a=[..._0x3944d2[_0x161115(0xf6)][_0x161115(0x188)]];const _0xd87a88=_0x1ab3a8[_0x161115(0x179)](_0x3bad4b=>{return _0x3bad4b={'product_name':_0x3bad4b};});_0x74161f[_0x161115(0xd0)]((_0xbaf920,_0xa0d0)=>{var _0x277e52=_0x161115;_0xd87a88[_0xa0d0][_0x277e52(0x181)]=_0xbaf920;}),_0x2aab74[_0x161115(0xd0)]((_0x3696a8,_0x4a760b)=>{var _0x571f8d=_0x161115;_0xd87a88[_0x4a760b][_0x571f8d(0x9d)]=_0x3696a8;}),_0x404557[_0x161115(0xd0)]((_0x3b0cc1,_0x926681)=>{_0xd87a88[_0x926681]['product_code']=_0x3b0cc1;}),_0x49a55c[_0x161115(0xd0)]((_0x428411,_0x4985ee)=>{_0xd87a88[_0x4985ee]['sale_qty']=_0x428411;}),_0x376359[_0x161115(0xd0)]((_0x2365de,_0x213235)=>{var _0x2b0e61=_0x161115;_0xd87a88[_0x213235][_0x2b0e61(0x165)]=_0x2365de;}),_0x3a2c1c['forEach']((_0x46ceab,_0x40d2ec)=>{var _0x47c0e1=_0x161115;_0xd87a88[_0x40d2ec][_0x47c0e1(0x100)]=_0x46ceab;}),_0x48d2bc[_0x161115(0xd0)]((_0x51255c,_0x2e5f4e)=>{var _0x445e5d=_0x161115;_0xd87a88[_0x2e5f4e][_0x445e5d(0xbc)]=_0x51255c;}),_0x4723ea[_0x161115(0xd0)]((_0x1e3aa3,_0x17e1fb)=>{_0xd87a88[_0x17e1fb]['bin']=_0x1e3aa3;}),_0x56a120[_0x161115(0xd0)]((_0x252ed2,_0x266c40)=>{var _0x5aa389=_0x161115;_0xd87a88[_0x266c40][_0x5aa389(0xbb)]=_0x252ed2;}),_0x52fb0a['forEach']((_0x11ff64,_0x469408)=>{var _0x3282ee=_0x161115;_0xd87a88[_0x469408][_0x3282ee(0x188)]=_0x11ff64;});var _0x15b55f=0x0;_0xd87a88[_0x161115(0xd0)](_0x51280f=>{var _0x56161f=_0x161115;console[_0x56161f(0xae)]('foreach\x20newproduct',_0x51280f),(parseInt(_0x51280f['sale_qty'])<parseInt(_0x51280f[_0x56161f(0x100)])||parseInt(_0x51280f['stock'])<parseInt(_0x51280f[_0x56161f(0x100)])&&parseInt(_0x51280f[_0x56161f(0xb0)])>parseInt(_0x51280f[_0x56161f(0x100)])||parseInt(_0x51280f[_0x56161f(0x100)])==0x0)&&_0x15b55f++;});if(_0x15b55f!=0x0)return _0x3944d2['flash'](_0x161115(0xd9),_0x161115(0x161)),_0x3e9b8b[_0x161115(0x171)](_0x161115(0x186));const _0x1a16da=await sales['findOne']({'invoice':_0x2fea44});console[_0x161115(0xae)](_0x1a16da),_0x1a16da[_0x161115(0xda)]='True';const _0x75b729=await _0x1a16da[_0x161115(0x13a)](),_0x134ce2=new sales_return({'invoice':_0x2fea44,'customer':_0x3944d2[_0x161115(0xf6)][_0x161115(0x14a)],'date':_0x51f4ee,'warehouse_name':_0x2c6b65,'room':_0x1208be,'ToWarehouse':_0x3e5fcc,'ToRoom':_0x259d96,'return_sale':_0xd87a88,'note':_0x503ec6}),_0x231e05=await _0x134ce2['save']();console[_0x161115(0xae)](_0x134ce2);const _0xd2809c=await sales_return[_0x161115(0xe2)]({'invoice':_0x2fea44}),_0x2c7773=await warehouse[_0x161115(0xe2)]({'name':_0x3e5fcc,'room':_0x259d96});_0xd2809c[_0x161115(0x143)][_0x161115(0xd0)](_0x10d7d2=>{var _0x165016=_0x161115,_0x2ddb58=0x0;const _0x2721cc=_0x2c7773[_0x165016(0x120)][_0x165016(0x179)](_0x409312=>{var _0x3ce1dd=_0x165016;_0x409312[_0x3ce1dd(0x19d)]==_0x10d7d2[_0x3ce1dd(0x19d)]&&_0x409312[_0x3ce1dd(0x188)]==_0x10d7d2[_0x3ce1dd(0x188)]&&_0x409312[_0x3ce1dd(0xbb)]==_0x10d7d2[_0x3ce1dd(0xbb)]&&_0x409312[_0x3ce1dd(0xa2)]==_0x10d7d2[_0x3ce1dd(0xa2)]&&_0x409312[_0x3ce1dd(0xbc)]==_0x10d7d2[_0x3ce1dd(0xbc)]&&(_0x409312['product_stock']=parseInt(_0x409312[_0x3ce1dd(0x101)])+parseInt(_0x10d7d2[_0x3ce1dd(0x100)]),_0x2ddb58++);});_0x2ddb58=='0'&&(_0x2c7773[_0x165016(0x120)]=_0x2c7773[_0x165016(0x120)]['concat']({'product_name':_0x10d7d2[_0x165016(0x19d)],'product_stock':_0x10d7d2['return_qty'],'primary_code':_0x10d7d2[_0x165016(0x181)],'secondary_code':_0x10d7d2[_0x165016(0x9d)],'product_code':_0x10d7d2[_0x165016(0x192)],'bay':_0x10d7d2['bay'],'bin':_0x10d7d2['bin'],'type':_0x10d7d2[_0x165016(0xbb)],'floorlevel':_0x10d7d2[_0x165016(0x188)]})),console['log'](_0x165016(0x103),_0x2c7773);}),await _0x2c7773[_0x161115(0x13a)](),console[_0x161115(0xae)](_0x3944d2[_0x161115(0xf6)]);const _0x439ba4=new c_payment_data({'invoice':_0x2fea44,'customer':_0x3944d2['body']['customer'],'reason':'Sale\x20Return'});await _0x439ba4['save']();const _0x153606=await master_shop[_0x161115(0x124)]();console[_0x161115(0xae)](_0x161115(0xf5),_0x153606[0x0][_0x161115(0x12c)]);const _0x18bec4=await email_settings['findOne'](),_0xe57a99=await customer['findOne']({'name':_0x3944d2[_0x161115(0xf6)][_0x161115(0x14a)]});console[_0x161115(0xae)](_0x161115(0xe4),_0xe57a99);_0x153606[0x0][_0x161115(0x11b)]==0x1?(right_currency=_0x153606[0x0][_0x161115(0xac)],left_currency=''):(right_currency='',left_currency=_0x153606[0x0][_0x161115(0xac)]);var _0x3062be=_0x1ab3a8,_0x12ace9=_0x3a2c1c,_0x464a28='',_0x3a454d;for(_0x3a454d in _0x3062be){_0x464a28+='<tr>'+_0x161115(0x164)+_0x3062be[_0x3a454d]+'</td>'+_0x161115(0x164)+_0x12ace9[_0x3a454d]+'</td>'+'</tr>';}console[_0x161115(0xae)](_0x161115(0xdd),_0x464a28);let _0x4c3b6a=nodemailer[_0x161115(0xb4)]({'service':_0x161115(0x12e),'auth':{'user':_0x18bec4['email'],'pass':_0x18bec4[_0x161115(0xb9)]}}),_0x5222bf={'from':_0x18bec4[_0x161115(0xe7)],'to':_0xe57a99['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x161115(0x190),'path':__dirname+_0x161115(0xe6)+_0x161115(0xc8)+_0x153606[0x0][_0x161115(0x12c)],'cid':_0x161115(0x183)}],'html':_0x161115(0x13f)+_0x161115(0x19f)+'</head><body>'+_0x161115(0xe0)+_0x161115(0x116)+_0x161115(0xe0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x161115(0x134)+_0x161115(0xe0)+'<h2>\x20'+_0x153606[0x0][_0x161115(0x159)]+_0x161115(0x168)+_0x161115(0x134)+_0x161115(0x134)+_0x161115(0xe5)+'<div>'+_0x161115(0x1a0)+'\x20Order\x20Number\x20:\x20'+_0x2fea44+'\x20'+_0x161115(0x137)+_0x161115(0xbf)+_0x51f4ee+'\x20'+_0x161115(0x185)+'</h5>'+_0x161115(0x134)+_0x161115(0x113)+_0x161115(0x160)+_0x161115(0x1a2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x161115(0x112)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x161115(0x10e)+_0x161115(0xab)+_0x161115(0x133)+_0x161115(0xe9)+'\x20'+_0x464a28+'\x20'+_0x161115(0x149)+'</table>'+'<div>'+_0x161115(0x14b)+'<h5>'+_0x153606[0x0]['site_title']+_0x161115(0x10d)+_0x161115(0x134)+_0x161115(0x134)+_0x161115(0x9b)};_0x4c3b6a['sendMail'](_0x5222bf,function(_0xd27abe,_0x3596b1){var _0x47f309=_0x161115;_0xd27abe?(console[_0x47f309(0xae)](_0xd27abe),console[_0x47f309(0xae)]('Error\x20Occurs')):console[_0x47f309(0xae)](_0x47f309(0x129));}),_0x3944d2[_0x161115(0x16b)]('success',_0x161115(0x16c)),_0x3e9b8b[_0x161115(0x171)](_0x161115(0xb7));}catch(_0x2fc495){console[_0x161115(0xae)](_0x2fc495),_0x3e9b8b[_0x161115(0x9c)](0xc8)[_0x161115(0x107)]({'message1':_0x2fc495['message']});}}),router[a0_0x4f2468(0xd1)]('/barcode/:id',auth,async(_0x8aa5bc,_0x3b5e4c)=>{var _0x4d4a65=a0_0x4f2468;try{const {username:_0xdb38c7,email:_0xc96eb9,role:_0x496926}=_0x8aa5bc[_0x4d4a65(0xf8)],_0x4eb40d=_0x8aa5bc[_0x4d4a65(0xf8)],_0x417a8d=await profile[_0x4d4a65(0xe2)]({'email':_0x4eb40d['email']}),_0x1fab25=await master_shop[_0x4d4a65(0x124)]();console[_0x4d4a65(0xae)](_0x4d4a65(0x131),_0x1fab25);const _0x27f14e=_0x8aa5bc[_0x4d4a65(0x1a4)]['id'],_0x304ab6=await sales[_0x4d4a65(0xf7)](_0x27f14e);console[_0x4d4a65(0xae)]('barcode\x20user_id',_0x304ab6);if(_0x1fab25[0x0][_0x4d4a65(0xdc)]=='English\x20(US)')var _0x2cad5=users[_0x4d4a65(0xde)];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]==_0x4d4a65(0x15e))var _0x2cad5=users[_0x4d4a65(0x15e)];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]==_0x4d4a65(0x15c))var _0x2cad5=users[_0x4d4a65(0x15c)];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]=='Spanish')var _0x2cad5=users['Spanish'];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]==_0x4d4a65(0xff))var _0x2cad5=users['French'];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]==_0x4d4a65(0x194))var _0x2cad5=users[_0x4d4a65(0x12f)];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]==_0x4d4a65(0x156))var _0x2cad5=users[_0x4d4a65(0x156)];else{if(_0x1fab25[0x0][_0x4d4a65(0xdc)]=='Arabic\x20(ae)')var _0x2cad5=users[_0x4d4a65(0xa0)];}}}}}}}_0x3b5e4c[_0x4d4a65(0x177)](_0x4d4a65(0xfd),{'success':_0x8aa5bc[_0x4d4a65(0x16b)](_0x4d4a65(0x16f)),'errors':_0x8aa5bc[_0x4d4a65(0x16b)]('errors'),'role':_0x4eb40d,'profile':_0x417a8d,'alldata':_0x304ab6,'master_shop':_0x1fab25,'language':_0x2cad5});}catch(_0x13632c){console[_0x4d4a65(0xae)](_0x13632c);}}),router['post'](a0_0x4f2468(0xfc),async(_0x5dff25,_0x3a92f3)=>{var _0x3a667b=a0_0x4f2468;const {product_code:_0x9ba42d,warehouse_name:_0x50d016,rooms_data:_0x1e6a04,Roomslist:_0x35941c}=_0x5dff25[_0x3a667b(0xf6)],_0x447991=_0x35941c[_0x3a667b(0x17b)](','),_0x2e0544=[];async function _0x5392bc(_0x56caca){var _0x370cda=_0x3a667b;const _0x2d5de0=await warehouse[_0x370cda(0x14d)]([{'$match':{'name':_0x50d016,'room':_0x56caca}},{'$unwind':_0x370cda(0xa7)},{'$match':{'product_details.primary_code':_0x9ba42d}},{'$group':{'_id':_0x370cda(0x175),'name':{'$first':_0x370cda(0x19c)},'product_stock':{'$first':_0x370cda(0xa5)},'primary_code':{'$first':_0x370cda(0x19a)},'secondary_code':{'$first':_0x370cda(0xaa)},'product_code':{'$first':_0x370cda(0x106)},'level':{'$first':_0x370cda(0xf1)},'isle':{'$first':_0x370cda(0x18b)},'type':{'$first':_0x370cda(0x18e)},'pallet':{'$first':_0x370cda(0xc9)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x370cda(0x155)},'storage':{'$first':_0x370cda(0xdf)},'rack':{'$first':_0x370cda(0xcb)},'expiry_date':{'$first':_0x370cda(0x140)},'production_date':{'$first':_0x370cda(0x17a)},'maxPerUnit':{'$first':_0x370cda(0xad)},'batch_code':{'$first':_0x370cda(0x118)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x370cda(0xc2)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x370cda(0xfe)},'actual_uom':{'$first':_0x370cda(0xa3)}}}]),_0x4c0947=await warehouse[_0x370cda(0x14d)]([{'$match':{'name':_0x50d016,'room':_0x56caca}},{'$unwind':_0x370cda(0xa7)},{'$match':{'product_details.secondary_code':_0x9ba42d}},{'$group':{'_id':_0x370cda(0x175),'name':{'$first':_0x370cda(0x19c)},'product_stock':{'$first':_0x370cda(0xa5)},'primary_code':{'$first':_0x370cda(0x19a)},'secondary_code':{'$first':_0x370cda(0xaa)},'product_code':{'$first':_0x370cda(0x106)},'level':{'$first':_0x370cda(0xf1)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x370cda(0xc9)},'unit':{'$first':_0x370cda(0x130)},'secondary_unit':{'$first':_0x370cda(0x155)},'storage':{'$first':_0x370cda(0xdf)},'rack':{'$first':_0x370cda(0xcb)},'expiry_date':{'$first':_0x370cda(0x140)},'production_date':{'$first':_0x370cda(0x17a)},'maxPerUnit':{'$first':_0x370cda(0xad)},'batch_code':{'$first':_0x370cda(0x118)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x370cda(0xc2)},'invoice':{'$first':_0x370cda(0xcc)}}}]);if(_0x2d5de0[_0x370cda(0x199)]>0x0)_0x2e0544[_0x370cda(0x9e)](_0x2d5de0);else _0x4c0947['length']>0x0&&_0x2e0544[_0x370cda(0x9e)](_0x4c0947);}const _0x2ae1c7=_0x447991['map'](_0x547153=>_0x5392bc(_0x547153));await Promise[_0x3a667b(0xc3)](_0x2ae1c7),_0x3a92f3[_0x3a667b(0x107)](_0x2e0544);}),module[a0_0x4f2468(0x18a)]=router;