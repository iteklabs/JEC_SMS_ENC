var a0_0x31cebd=a0_0x5991;function a0_0x5991(_0x3d7082,_0x6939){var _0x3b4669=a0_0x3b46();return a0_0x5991=function(_0x59914,_0x264a2c){_0x59914=_0x59914-0x1b2;var _0x27ef27=_0x3b4669[_0x59914];return _0x27ef27;},a0_0x5991(_0x3d7082,_0x6939);}function a0_0x3b46(){var _0x19854a=['<hr\x20class=\x22my-3\x22>','</head><body>','<div>','getMonth','sales_quantity','$product_details.product_code','\x20Order\x20Date\x20:\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','finalize','success','aggregate','max_per_unit','map','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','status','Logo.png','return_sale','sales_invoice','date','length','SCRN','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','findById','Spanish','purchases_data','True','product_stock','Received\x20Payment\x20For\x20Sale','$note','<h2>\x20','English\x20(US)','/view/add_sales/:id','Arabic','_id','German','Enclosed','<strong>\x20Regards\x20</strong>','email','split','rack','barcode\x20user_id','render','isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','product_details','<!DOCTYPE\x20html>','currency','$product_details.unit','foreach\x20newproduct','RoomAssigned','Chinese','Ambient','log','delivery_code','id_transact','logo','delivery_date','5pSoaWx','received_amount','</span>','/view/return_sales/:id','amount','Return\x20Goods','$_id','error','id_transaction_from','466EKGaaQ','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','post','$product_details.product_cat','floor','Email\x20sent\x20successfully','express','</tr>','product_list','secondary_code','French','catch','Error\x20Occurs','toString','staff','barcode\x20Product\x20master','port','prod_invoice','Sale\x20Return','edit_sales','stock_data','customer','<tr>','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','exports','<h5>','$product_details.storage','$product_details.batch_code','Portuguese','Enabled','/../public','$product_details','filter','$product_details.type','$sale_product.type','findOne','warehouse','$product_details.product_name','</td>','RMSEmail','currency_placement','role','primary_code','$product_details.production_date','gmail','$product_details.bay','body','$product_details._id','carton','stock','Raw\x20Materials','</h5>','errors','room_name','$sale_product.quantity','string','$room','random','quantity','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','language','Sales\x20Update\x20successfully','$name','invoice','site_title','Level','$finalize','</div>','batch_code','back','$sale_product.floorlevel','$product','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','level','$product_details.secondary_code','message','</table>','product_data','$product_details.invoice','prod_cat','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<span\x20style=\x22float:\x20right;\x22>','Arabic\x20(ae)','</thead>','Floor','nodemailer','$sale_product.bay','stocks','unit','<tbody\x20style=\x22text-align:\x20center;\x22>','Return\x20Rooms','edit_sales_view','$product_details.bin','floorlevel','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','348461QkMleQ','/view/add_sales','$date','\x20Order\x20Number\x20:\x20','then','882dNrlse','add\x20post','return_data','slice','password','$product.product_name','$product_details.primary_code','\x20</h2>','maxperunit','/give_payment/:id','</tbody>','sale_product','850320ihwMXk','/invoice/:id','/barcode/:id','save','Sales\x20Mail','$product_details.secondary_unit','$product_details.rack','get','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','customers','all_sales','production_date','$product_details.pallet','all_sales_barcode','$sale_product','expiry_date','$product_details.maxPerUnit','product_code','bin','$customers_docs','types','35692JYirmP','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','secondary_unit','flash','11292fLmbTE','master','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/all_sales/preview/','add_sales','all','forEach','/view/:id','push','primary_unit','200530jSUPAc','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Receiving\x20Area','product_name','Sales\x20Add\x20successfully','name','OUT-','actual_qty','requested_qty','user','image','quantity_notConverted','customers_docs','$return_data','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','find','bay','warehouse_name','product','$product_details.expiry_date','return_qty','$isAllowEdit','/all_sales/view','getDate','$invoice','sale_qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view','sendMail','json','actual_uom','max','Portuguese\x20(BR)','Shelves','Hindi','$product_details.level','params','abs','English','<html><head><title></title>','customer_data','/view/add_sale/product','$sale_product.bin','$product_details.floorlevel','/preview/:id','$product_details.actual_uom','Sale\x20Return\x20Mail','$product_details.product_stock','</body></html>','4532612IRNEhn','/upload/','3723168EyYCuw','type','redirect'];a0_0x3b46=function(){return _0x19854a;};return a0_0x3b46();}(function(_0x5eeedc,_0x2c6727){var _0x139662=a0_0x5991,_0x15b504=_0x5eeedc();while(!![]){try{var _0x307735=-parseInt(_0x139662(0x252))/0x1+-parseInt(_0x139662(0x1f0))/0x2*(parseInt(_0x139662(0x27c))/0x3)+parseInt(_0x139662(0x278))/0x4*(parseInt(_0x139662(0x1e7))/0x5)+parseInt(_0x139662(0x2ba))/0x6+-parseInt(_0x139662(0x2b8))/0x7+-parseInt(_0x139662(0x263))/0x8+-parseInt(_0x139662(0x257))/0x9*(-parseInt(_0x139662(0x287))/0xa);if(_0x307735===_0x2c6727)break;else _0x15b504['push'](_0x15b504['shift']());}catch(_0x505415){_0x15b504['push'](_0x15b504['shift']());}}}(a0_0x3b46,0x963c6));const express=require(a0_0x31cebd(0x1f6)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x31cebd(0x207)),auth=require('../middleware/auth'),nodemailer=require(a0_0x31cebd(0x247)),users=require('../public/language/languages.json');router[a0_0x31cebd(0x26a)](a0_0x31cebd(0x2a2),auth,async(_0x2f9a24,_0x120326)=>{var _0xe8655f=a0_0x31cebd;try{const {username:_0x22977f,email:_0x5174e1,role:_0x286724}=_0x2f9a24[_0xe8655f(0x290)],_0x5852db=_0x2f9a24[_0xe8655f(0x290)],_0x3447f9=await profile[_0xe8655f(0x214)]({'email':_0x5852db['email']}),_0x24039b=await master_shop[_0xe8655f(0x296)]();let _0x1e84df;if(_0x5852db[_0xe8655f(0x21a)]=='staff'){const _0x47a444=await staff[_0xe8655f(0x214)]({'email':_0x5852db[_0xe8655f(0x1d3)]});_0x1e84df=await sales[_0xe8655f(0x1b7)]([{'$lookup':{'from':_0xe8655f(0x26c),'localField':_0xe8655f(0x205),'foreignField':_0xe8655f(0x28c),'as':_0xe8655f(0x293)}},{'$unwind':_0xe8655f(0x276)},{'$unwind':_0xe8655f(0x271)},{'$group':{'_id':'$_id','invoice':{'$first':_0xe8655f(0x29f)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0xe8655f(0x271)},'note':{'$first':_0xe8655f(0x1ca)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xe8655f(0x276)},'total_saleproduct_quantity':{'$sum':_0xe8655f(0x227)},'level':{'$addToSet':_0xe8655f(0x248)},'isle':{'$addToSet':_0xe8655f(0x2b1)},'type':{'$addToSet':_0xe8655f(0x213)},'pallet':{'$addToSet':_0xe8655f(0x238)},'finalize':{'$first':_0xe8655f(0x234)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x1e84df=await sales['aggregate']([{'$lookup':{'from':_0xe8655f(0x26c),'localField':_0xe8655f(0x205),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0xe8655f(0x276)},{'$unwind':_0xe8655f(0x271)},{'$group':{'_id':_0xe8655f(0x1ed),'invoice':{'$first':_0xe8655f(0x29f)},'customers':{'$first':'$customer'},'date':{'$first':_0xe8655f(0x254)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0xe8655f(0x271)},'note':{'$first':_0xe8655f(0x1ca)},'return_data':{'$first':_0xe8655f(0x294)},'customers_docs':{'$first':_0xe8655f(0x276)},'total_saleproduct_quantity':{'$sum':_0xe8655f(0x227)},'level':{'$addToSet':_0xe8655f(0x248)},'isle':{'$addToSet':_0xe8655f(0x2b1)},'type':{'$addToSet':_0xe8655f(0x213)},'pallet':{'$addToSet':_0xe8655f(0x238)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0xe8655f(0x29c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0xe8655f(0x1e2)]('sales\x20all_data',_0x1e84df);if(_0x24039b[0x0][_0xe8655f(0x22e)]==_0xe8655f(0x1cc)){var _0x2ff470=users[_0xe8655f(0x2ad)];console[_0xe8655f(0x1e2)](_0x2ff470);}else{if(_0x24039b[0x0][_0xe8655f(0x22e)]==_0xe8655f(0x2a9))var _0x2ff470=users[_0xe8655f(0x2a9)];else{if(_0x24039b[0x0][_0xe8655f(0x22e)]=='German')var _0x2ff470=users[_0xe8655f(0x1d0)];else{if(_0x24039b[0x0][_0xe8655f(0x22e)]==_0xe8655f(0x1c5))var _0x2ff470=users[_0xe8655f(0x1c5)];else{if(_0x24039b[0x0][_0xe8655f(0x22e)]=='French')var _0x2ff470=users[_0xe8655f(0x1fa)];else{if(_0x24039b[0x0]['language']=='Portuguese\x20(BR)')var _0x2ff470=users[_0xe8655f(0x20d)];else{if(_0x24039b[0x0][_0xe8655f(0x22e)]==_0xe8655f(0x1e0))var _0x2ff470=users[_0xe8655f(0x1e0)];else{if(_0x24039b[0x0]['language']==_0xe8655f(0x244))var _0x2ff470=users[_0xe8655f(0x1ce)];}}}}}}}_0x120326[_0xe8655f(0x1d7)](_0xe8655f(0x26d),{'success':_0x2f9a24[_0xe8655f(0x27b)](_0xe8655f(0x1b6)),'errors':_0x2f9a24[_0xe8655f(0x27b)](_0xe8655f(0x225)),'sales':_0x1e84df,'profile':_0x3447f9,'role':_0x5852db,'master_shop':_0x24039b,'language':_0x2ff470});}catch(_0x3c476f){console['log'](_0x3c476f);}});async function getRandom8DigitNumber(){var _0x1f60c6=a0_0x31cebd;const _0x1a2e9a=0x989680,_0x38457c=0x5f5e0ff,_0x4c7641=Math[_0x1f60c6(0x1f4)](Math[_0x1f60c6(0x22a)]()*(_0x38457c-_0x1a2e9a+0x1))+_0x1a2e9a;var _0x231497;const _0x39cb86=await sales[_0x1f60c6(0x214)]({'invoice':_0x1f60c6(0x28d)+_0x4c7641});return _0x39cb86&&_0x39cb86[_0x1f60c6(0x1c1)]>0x0?_0x231497=_0x1f60c6(0x28d)+_0x4c7641:_0x231497=_0x1f60c6(0x28d)+_0x4c7641,_0x231497;}router[a0_0x31cebd(0x26a)](a0_0x31cebd(0x253),auth,async(_0x4683d7,_0x560048)=>{var _0x38633a=a0_0x31cebd;try{const {username:_0x3d409f,email:_0x121421,role:_0xe3f7c0}=_0x4683d7[_0x38633a(0x290)],_0x44c1f8=_0x4683d7[_0x38633a(0x290)],_0x2b1ed3=await profile[_0x38633a(0x214)]({'email':_0x44c1f8[_0x38633a(0x1d3)]}),_0x2bb5a4=await master_shop[_0x38633a(0x296)](),_0x9d1a06=await customer[_0x38633a(0x296)]({});let _0x1aa0f2;if(_0x44c1f8['role']==_0x38633a(0x1fe)){const _0x4c0dc4=await staff['findOne']({'email':_0x44c1f8['email']});_0x1aa0f2=await warehouse[_0x38633a(0x1b7)]([{'$match':{'status':_0x38633a(0x20e),'name':_0x4c0dc4[_0x38633a(0x215)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x38633a(0x1ec)}}},{'$group':{'_id':_0x38633a(0x230),'name':{'$first':_0x38633a(0x230)}}},{'$sort':{'name':0x1}}]);}else _0x1aa0f2=await warehouse[_0x38633a(0x1b7)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x38633a(0x1ec)}}},{'$group':{'_id':'$name','name':{'$first':_0x38633a(0x230)}}},{'$sort':{'name':0x1}}]);const _0x2118c5=await product['find']({});var _0x5d3155=[_0x38633a(0x1e1),_0x38633a(0x1d1)];const _0x2eebec=await sales[_0x38633a(0x296)]({}),_0xa18edf=_0x2eebec['length']+0x1,_0x435a47=_0x38633a(0x28d)+_0xa18edf[_0x38633a(0x1fd)]()['padStart'](0x5,'0');if(_0x2bb5a4[0x0][_0x38633a(0x22e)]=='English\x20(US)'){var _0x369773=users[_0x38633a(0x2ad)];console[_0x38633a(0x1e2)](_0x369773);}else{if(_0x2bb5a4[0x0][_0x38633a(0x22e)]=='Hindi')var _0x369773=users[_0x38633a(0x2a9)];else{if(_0x2bb5a4[0x0][_0x38633a(0x22e)]==_0x38633a(0x1d0))var _0x369773=users[_0x38633a(0x1d0)];else{if(_0x2bb5a4[0x0]['language']==_0x38633a(0x1c5))var _0x369773=users['Spanish'];else{if(_0x2bb5a4[0x0]['language']==_0x38633a(0x1fa))var _0x369773=users[_0x38633a(0x1fa)];else{if(_0x2bb5a4[0x0]['language']==_0x38633a(0x2a7))var _0x369773=users[_0x38633a(0x20d)];else{if(_0x2bb5a4[0x0][_0x38633a(0x22e)]=='Chinese')var _0x369773=users[_0x38633a(0x1e0)];else{if(_0x2bb5a4[0x0][_0x38633a(0x22e)]==_0x38633a(0x244))var _0x369773=users[_0x38633a(0x1ce)];}}}}}}}const _0xeb373a=getRandom8DigitNumber();_0xeb373a[_0x38633a(0x256)](_0x2f28ff=>{var _0x4a1703=_0x38633a;_0x560048[_0x4a1703(0x1d7)](_0x4a1703(0x281),{'success':_0x4683d7[_0x4a1703(0x27b)](_0x4a1703(0x1b6)),'errors':_0x4683d7[_0x4a1703(0x27b)](_0x4a1703(0x225)),'role':_0x44c1f8,'profile':_0x2b1ed3,'customer':_0x9d1a06,'warehouse':_0x1aa0f2,'product':_0x2118c5,'invoice':_0x2f28ff,'master_shop':_0x2bb5a4,'language':_0x369773,'rooms_data':_0x5d3155});})[_0x38633a(0x1fb)](_0x19d8c7=>{var _0x490e11=_0x38633a;_0x4683d7['flash']('errors',_0x490e11(0x242)),_0x560048[_0x490e11(0x2bc)]('/all_sales/view');});}catch(_0x45d933){console[_0x38633a(0x1e2)](_0x45d933);}}),router[a0_0x31cebd(0x26a)](a0_0x31cebd(0x1cd),auth,async(_0x2eee3b,_0x2021be)=>{var _0x9038f0=a0_0x31cebd;try{const _0x2634e5=_0x2eee3b[_0x9038f0(0x2ab)]['id'];console['log'](_0x2634e5);const _0x312814=await product[_0x9038f0(0x296)](),_0x28125a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x2634e5}},{'$unwind':_0x9038f0(0x239)},{'$group':{'_id':_0x9038f0(0x25c)}}]);console[_0x9038f0(0x1e2)](_0x9038f0(0x1c6),_0x28125a),_0x2021be[_0x9038f0(0x1bc)](0xc8)[_0x9038f0(0x2a4)]({'purchases_data':_0x28125a,'product_data':_0x312814});}catch(_0x191630){console[_0x9038f0(0x1e2)](_0x191630);}}),router[a0_0x31cebd(0x1f2)](a0_0x31cebd(0x2b0),auth,async(_0x46a71d,_0x1e651e)=>{var _0x52ab9a=a0_0x31cebd;try{const {warehouse_data:_0x356206,product_data:_0x5c8a70}=_0x46a71d[_0x52ab9a(0x21f)];console[_0x52ab9a(0x1e2)](_0x46a71d[_0x52ab9a(0x21f)][_0x52ab9a(0x23f)]);;const _0x3b6f15=await master_shop[_0x52ab9a(0x296)]();console[_0x52ab9a(0x1e2)]('master',_0x3b6f15);const _0x571df0=await product[_0x52ab9a(0x214)]({'name':_0x5c8a70});console[_0x52ab9a(0x1e2)](_0x52ab9a(0x299),_0x571df0);const _0x1b7aff=await warehouse[_0x52ab9a(0x1b7)]([{'$match':{'name':_0x356206}},{'$unwind':_0x52ab9a(0x210)},{'$match':{'product_details.product_name':_0x5c8a70}},{'$group':{'_id':_0x52ab9a(0x216),'product_stock':{'$first':_0x52ab9a(0x2b6)}}}]);console[_0x52ab9a(0x1e2)](_0x52ab9a(0x204),_0x1b7aff),_0x1e651e['status'](0xc8)[_0x52ab9a(0x2a4)]({'master':_0x3b6f15,'new_product':_0x571df0,'stock_data':_0x1b7aff});}catch(_0x14a5be){console[_0x52ab9a(0x1e2)](_0x14a5be);}}),router[a0_0x31cebd(0x1f2)]('/view/add_sales',auth,async(_0x2ad855,_0x1d919e)=>{var _0x1f41c3=a0_0x31cebd;try{const {invoice:_0x100167,date:_0x2ca29f,warehouse_name:_0x30eb2c,product_name:_0x1802f2,stock:_0x3bb754,quantity:_0x665900,note:_0x2f8ab7,room:_0xd1224c,primary_code:_0x50f528,secondary_code:_0x4c4e4a,prod_code:_0x1fb5e2,level:_0x9e095a,isle:_0x514093,pallet:_0x5a6f0f,batch_code:_0x2f9cb0,SCRN:_0x56bf11,expiry_date:_0x3df986}=_0x2ad855[_0x1f41c3(0x21f)];if(typeof _0x1802f2==_0x1f41c3(0x228))var _0x190319=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x28a)]],_0x2607c2=[_0x2ad855['body'][_0x1f41c3(0x222)]],_0x13ecef=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x221)]],_0x83848a=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x21b)]],_0x352412=[_0x2ad855['body'][_0x1f41c3(0x1f9)]],_0x4c903f=[_0x2ad855['body'][_0x1f41c3(0x27e)]],_0x513342=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x23b)]],_0x478f2a=[_0x2ad855['body'][_0x1f41c3(0x286)]],_0x19d358=[_0x2ad855[_0x1f41c3(0x21f)]['secondary_unit']],_0x4159f2=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x236)]],_0x1f3244=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x272)]],_0x5bb0d3=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x1b8)]],_0x4f9358=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x26e)]],_0x4fb372=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x28f)]],_0x37a424=[_0x2ad855['body'][_0x1f41c3(0x1e6)]],_0x460a9c=[_0x2ad855['body'][_0x1f41c3(0x1e3)]],_0x57b0d5=[_0x2ad855[_0x1f41c3(0x21f)]['prod_cat']],_0x43735c=[_0x2ad855[_0x1f41c3(0x21f)]['quantity']],_0x896b6f=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x1df)]],_0x53c40c=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x201)]],_0x33c2f7=[_0x2ad855['body']['actual_qty']],_0x50e1ba=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x2a5)]],_0x576a98=[_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x1e4)]];else var _0x190319=[..._0x2ad855['body'][_0x1f41c3(0x28a)]],_0x2607c2=[..._0x2ad855['body'][_0x1f41c3(0x222)]],_0x13ecef=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x221)]],_0x83848a=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x21b)]],_0x352412=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x1f9)]],_0x4c903f=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x27e)]],_0x513342=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x23b)]],_0x478f2a=[..._0x2ad855['body'][_0x1f41c3(0x286)]],_0x19d358=[..._0x2ad855[_0x1f41c3(0x21f)]['secondary_unit']],_0x4159f2=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x236)]],_0x1f3244=[..._0x2ad855['body'][_0x1f41c3(0x272)]],_0x5bb0d3=[..._0x2ad855['body'][_0x1f41c3(0x1b8)]],_0x4f9358=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x26e)]],_0x4fb372=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x28f)]],_0x37a424=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x1e6)]],_0x460a9c=[..._0x2ad855[_0x1f41c3(0x21f)]['delivery_code']],_0x57b0d5=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x241)]],_0x43735c=[..._0x2ad855['body'][_0x1f41c3(0x22b)]],_0x896b6f=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x1df)]],_0x53c40c=[..._0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x201)]],_0x33c2f7=[..._0x2ad855['body']['actual_qty']],_0x50e1ba=[..._0x2ad855[_0x1f41c3(0x21f)]['actual_uom']],_0x576a98=[..._0x2ad855[_0x1f41c3(0x21f)]['id_transact']];const _0x160e0f=_0x190319[_0x1f41c3(0x1b9)](_0x184336=>{return _0x184336={'product_name':_0x184336};});_0x2607c2[_0x1f41c3(0x283)]((_0x5996ad,_0x8da182)=>{var _0x59bf50=_0x1f41c3;_0x160e0f[_0x8da182][_0x59bf50(0x222)]=Math['abs'](_0x5996ad);}),_0x33c2f7[_0x1f41c3(0x283)]((_0x5ad762,_0x346bff)=>{var _0x45c718=_0x1f41c3;_0x160e0f[_0x346bff][_0x45c718(0x28e)]=Math['abs'](_0x5ad762);}),_0x50e1ba[_0x1f41c3(0x283)]((_0x3141eb,_0xfa5a20)=>{var _0x4ee34c=_0x1f41c3;_0x160e0f[_0xfa5a20][_0x4ee34c(0x2a5)]=_0x3141eb;}),_0x576a98[_0x1f41c3(0x283)]((_0x2a1379,_0x56458f)=>{var _0x4af300=_0x1f41c3;_0x160e0f[_0x56458f][_0x4af300(0x1ef)]=_0x2a1379;}),_0x13ecef['forEach']((_0x110ee5,_0x1c5686)=>{var _0x26314f=_0x1f41c3;_0x160e0f[_0x1c5686][_0x26314f(0x22b)]=_0x110ee5;}),_0x83848a[_0x1f41c3(0x283)]((_0x2c03e0,_0x3624e7)=>{var _0x404692=_0x1f41c3;_0x160e0f[_0x3624e7][_0x404692(0x21b)]=_0x2c03e0;}),_0x352412[_0x1f41c3(0x283)]((_0x3755aa,_0x35500b)=>{var _0x715ade=_0x1f41c3;_0x160e0f[_0x35500b][_0x715ade(0x1f9)]=_0x3755aa;}),_0x4c903f[_0x1f41c3(0x283)]((_0x2d5d5c,_0x482072)=>{var _0x46e3f=_0x1f41c3;_0x160e0f[_0x482072][_0x46e3f(0x274)]=_0x2d5d5c;}),_0x513342['forEach']((_0x191e78,_0x46091b)=>{var _0x1dc012=_0x1f41c3;_0x896b6f[_0x1dc012(0x283)]((_0x212e5a,_0x200b6d)=>{var _0x4f62a8=_0x1dc012;if(_0x212e5a==_0x4f62a8(0x289)&&_0x46091b==_0x200b6d){var _0x3f2616=_0x191e78[_0x4f62a8(0x25a)](0x3);_0x160e0f[_0x46091b][_0x4f62a8(0x1ba)]=_0x191e78[0x0],_0x160e0f[_0x46091b]['rack']=_0x191e78[0x1],_0x160e0f[_0x46091b][_0x4f62a8(0x297)]=0x0,_0x160e0f[_0x46091b][_0x4f62a8(0x275)]=0x0,_0x160e0f[_0x46091b][_0x4f62a8(0x2bb)]=_0x4f62a8(0x246),_0x160e0f[_0x46091b][_0x4f62a8(0x24f)]=_0x3f2616;}else{if(_0x212e5a=='Shelves'&&_0x46091b==_0x200b6d){var _0x3f2616=_0x191e78[_0x4f62a8(0x25a)](0x3);_0x160e0f[_0x46091b][_0x4f62a8(0x1ba)]=_0x191e78[0x0],_0x160e0f[_0x46091b][_0x4f62a8(0x1d5)]=_0x191e78[0x1],_0x160e0f[_0x46091b]['bay']=0x0,_0x160e0f[_0x46091b][_0x4f62a8(0x275)]=0x0,_0x160e0f[_0x46091b]['type']=_0x4f62a8(0x246),_0x160e0f[_0x46091b][_0x4f62a8(0x24f)]=_0x191e78[0x5];}else{if(_0x46091b==_0x200b6d){var _0x3bfae2;if(_0x191e78[0x4]=='L')_0x3bfae2=_0x4f62a8(0x233);else _0x191e78[0x4]=='F'&&(_0x3bfae2=_0x4f62a8(0x246));_0x160e0f[_0x46091b][_0x4f62a8(0x1ba)]=_0x191e78[0x0],_0x160e0f[_0x46091b]['rack']=_0x191e78[0x1],_0x160e0f[_0x46091b][_0x4f62a8(0x297)]=_0x191e78[0x2],_0x160e0f[_0x46091b][_0x4f62a8(0x275)]=_0x191e78[0x3],_0x160e0f[_0x46091b][_0x4f62a8(0x2bb)]=_0x3bfae2,_0x160e0f[_0x46091b]['floorlevel']=_0x191e78[0x5];}}}});}),_0x478f2a[_0x1f41c3(0x283)]((_0x379d70,_0x325afb)=>{var _0x3fecb9=_0x1f41c3;_0x160e0f[_0x325afb][_0x3fecb9(0x24a)]=_0x379d70;}),_0x19d358[_0x1f41c3(0x283)]((_0x4e649a,_0x311f33)=>{_0x160e0f[_0x311f33]['secondary_unit']=_0x4e649a;}),_0x4159f2[_0x1f41c3(0x283)]((_0xefdcd,_0x5513d3)=>{var _0x301130=_0x1f41c3;_0x160e0f[_0x5513d3][_0x301130(0x236)]=_0xefdcd;}),_0x1f3244[_0x1f41c3(0x283)]((_0x13c98d,_0x582cf7)=>{var _0x2157cc=_0x1f41c3;_0x160e0f[_0x582cf7][_0x2157cc(0x272)]=_0x13c98d;}),_0x5bb0d3['forEach']((_0xde3554,_0x4304f6)=>{var _0x2c9768=_0x1f41c3;_0x160e0f[_0x4304f6][_0x2c9768(0x25f)]=_0xde3554;}),_0x4f9358[_0x1f41c3(0x283)]((_0x1e752a,_0x42583f)=>{_0x160e0f[_0x42583f]['production_date']=_0x1e752a;}),_0x4fb372['forEach']((_0x47af47,_0x24e09f)=>{var _0x2d1e3c=_0x1f41c3;_0x160e0f[_0x24e09f][_0x2d1e3c(0x28f)]=_0x47af47;}),_0x37a424[_0x1f41c3(0x283)]((_0x4efb11,_0x2d5176)=>{var _0x4684d0=_0x1f41c3;_0x160e0f[_0x2d5176][_0x4684d0(0x1e6)]=_0x4efb11;}),_0x460a9c[_0x1f41c3(0x283)]((_0x3500c4,_0x418a34)=>{var _0x30efdf=_0x1f41c3;_0x160e0f[_0x418a34][_0x30efdf(0x1e3)]=_0x3500c4;}),_0x57b0d5['forEach']((_0x206bf0,_0x11fa91)=>{var _0x177dbc=_0x1f41c3;_0x160e0f[_0x11fa91][_0x177dbc(0x241)]=_0x206bf0;}),_0x43735c[_0x1f41c3(0x283)]((_0x367de1,_0x2ab9fa)=>{var _0x5b569b=_0x1f41c3;_0x160e0f[_0x2ab9fa][_0x5b569b(0x292)]=_0x367de1;}),_0x896b6f[_0x1f41c3(0x283)]((_0x1b7b46,_0x512d4a)=>{var _0x5b0b89=_0x1f41c3;_0x160e0f[_0x512d4a][_0x5b0b89(0x226)]=_0x1b7b46;}),_0x53c40c['forEach']((_0x3d78a2,_0x5bae33)=>{var _0x52a655=_0x1f41c3;_0x160e0f[_0x5bae33][_0x52a655(0x231)]=_0x3d78a2;});var _0x4b6a96=0x0;_0x160e0f[_0x1f41c3(0x283)](_0x3e9fd3=>{var _0x2d8fd5=_0x1f41c3;(_0x3e9fd3[_0x2d8fd5(0x222)]<_0x3e9fd3[_0x2d8fd5(0x292)]||_0x3e9fd3[_0x2d8fd5(0x292)]==0x0)&&(console['log']('foreach\x20newproduct',_0x3e9fd3),_0x4b6a96++);});const _0xe59467=_0x160e0f[_0x1f41c3(0x211)](_0x24acac=>_0x24acac[_0x1f41c3(0x22b)]!=='0'&&_0x24acac[_0x1f41c3(0x22b)]!==''),_0x189efd=new sales({'invoice':_0x100167,'customer':_0x2ad855[_0x1f41c3(0x21f)][_0x1f41c3(0x205)],'date':_0x2ca29f,'warehouse_name':_0x30eb2c,'sale_product':_0xe59467,'note':_0x2f8ab7,'room':_0xd1224c,'primary_code':_0x50f528,'secondary_code':_0x4c4e4a,'prod_code':_0x1fb5e2,'SCRN':_0x56bf11}),_0x54faba=await _0x189efd[_0x1f41c3(0x266)]();_0x2ad855['flash'](_0x1f41c3(0x1b6),_0x1f41c3(0x28b)),_0x1d919e[_0x1f41c3(0x2bc)]('/all_sales/preview/'+_0x54faba[_0x1f41c3(0x1cf)]);}catch(_0xff94d6){console[_0x1f41c3(0x1e2)](_0xff94d6);}}),router[a0_0x31cebd(0x26a)](a0_0x31cebd(0x2b3),auth,async(_0x4b04ca,_0x11a9b2)=>{var _0x2a6a80=a0_0x31cebd;try{const {username:_0x4fd8c5,email:_0x2a9c53,role:_0x42a60c}=_0x4b04ca[_0x2a6a80(0x290)],_0xc38f1d=_0x4b04ca[_0x2a6a80(0x290)],_0x520f23=await profile[_0x2a6a80(0x214)]({'email':_0xc38f1d['email']}),_0x247ae6=await master_shop[_0x2a6a80(0x296)](),_0x4369fc=_0x4b04ca[_0x2a6a80(0x2ab)]['id'],_0x31fb1c=await sales[_0x2a6a80(0x1c4)](_0x4369fc),_0x1c0f34=await warehouse[_0x2a6a80(0x1b7)]([{'$match':{'name':_0x31fb1c['warehouse_name']}},{'$unwind':_0x2a6a80(0x210)},{'$group':{'_id':_0x2a6a80(0x220),'name':{'$first':_0x2a6a80(0x216)},'product_stock':{'$first':_0x2a6a80(0x2b6)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2a6a80(0x212)},'floorlevel':{'$first':_0x2a6a80(0x2b2)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2a6a80(0x23c)},'product_code':{'$first':_0x2a6a80(0x1b2)},'storage':{'$first':_0x2a6a80(0x20b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2a6a80(0x29a)},'production_date':{'$first':_0x2a6a80(0x21c)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4dc938=await customer[_0x2a6a80(0x296)]({});let _0x593364;if(_0xc38f1d[_0x2a6a80(0x21a)]==_0x2a6a80(0x1fe)){const _0x18f666=await staff['findOne']({'email':_0xc38f1d[_0x2a6a80(0x1d3)]});_0x593364=await warehouse[_0x2a6a80(0x1b7)]([{'$match':{'status':_0x2a6a80(0x20e),'name':_0x18f666['warehouse']}},{'$group':{'_id':_0x2a6a80(0x230),'name':{'$first':'$name'}}}]);}else _0x593364=await warehouse[_0x2a6a80(0x1b7)]([{'$match':{'status':_0x2a6a80(0x20e)}},{'$group':{'_id':_0x2a6a80(0x230),'name':{'$first':_0x2a6a80(0x230)}}}]);const _0x221dca=await product[_0x2a6a80(0x296)]({}),_0x199c0c=await suppliers[_0x2a6a80(0x296)]({});if(_0x247ae6[0x0][_0x2a6a80(0x22e)]==_0x2a6a80(0x1cc)){var _0x549e6a=users[_0x2a6a80(0x2ad)];console['log'](_0x549e6a);}else{if(_0x247ae6[0x0]['language']==_0x2a6a80(0x2a9))var _0x549e6a=users['Hindi'];else{if(_0x247ae6[0x0][_0x2a6a80(0x22e)]==_0x2a6a80(0x1d0))var _0x549e6a=users['German'];else{if(_0x247ae6[0x0][_0x2a6a80(0x22e)]==_0x2a6a80(0x1c5))var _0x549e6a=users[_0x2a6a80(0x1c5)];else{if(_0x247ae6[0x0][_0x2a6a80(0x22e)]=='French')var _0x549e6a=users[_0x2a6a80(0x1fa)];else{if(_0x247ae6[0x0][_0x2a6a80(0x22e)]==_0x2a6a80(0x2a7))var _0x549e6a=users[_0x2a6a80(0x20d)];else{if(_0x247ae6[0x0][_0x2a6a80(0x22e)]==_0x2a6a80(0x1e0))var _0x549e6a=users[_0x2a6a80(0x1e0)];else{if(_0x247ae6[0x0][_0x2a6a80(0x22e)]==_0x2a6a80(0x244))var _0x549e6a=users[_0x2a6a80(0x1ce)];}}}}}}}_0x11a9b2[_0x2a6a80(0x1d7)](_0x2a6a80(0x24d),{'success':_0x4b04ca['flash'](_0x2a6a80(0x1b6)),'errors':_0x4b04ca['flash'](_0x2a6a80(0x225)),'role':_0xc38f1d,'profile':_0x520f23,'customer':_0x4dc938,'warehouse':_0x593364,'product':_0x1c0f34,'user':_0x31fb1c,'master_shop':_0x247ae6,'unit':_0x221dca,'language':_0x549e6a,'suppliers':_0x199c0c});}catch(_0xa18db2){console[_0x2a6a80(0x1e2)](_0xa18db2);}}),router[a0_0x31cebd(0x1f2)](a0_0x31cebd(0x2b3),auth,async(_0x3a5975,_0x1c9f0a)=>{var _0x3a2a5c=a0_0x31cebd;try{const _0x98fda9=_0x3a5975[_0x3a2a5c(0x2ab)]['id'],{invoice:_0x27c9a1,warehouse_name:_0x53fc76,room:_0xb0399f}=_0x3a5975['body'],_0x3d4f5c=await sales[_0x3a2a5c(0x214)]({'invoice':_0x27c9a1}),_0x1e9ece=_0x3d4f5c[_0x3a2a5c(0x262)]['map'](async _0x584d55=>{var _0x3fad2f=_0x3a2a5c,_0x3467a9=await warehouse['findOne']({'name':_0x53fc76,'room':_0x584d55[_0x3fad2f(0x226)],'warehouse_category':_0x3fad2f(0x223)});const _0x148f01=_0x3467a9[_0x3fad2f(0x1da)][_0x3fad2f(0x1b9)](_0x243a11=>{var _0x8b48a4=_0x3fad2f;_0x243a11['product_name']==_0x584d55[_0x8b48a4(0x28a)]&&_0x243a11[_0x8b48a4(0x24f)]==_0x584d55[_0x8b48a4(0x24f)]&&_0x243a11[_0x8b48a4(0x2bb)]==_0x584d55[_0x8b48a4(0x2bb)]&&_0x243a11[_0x8b48a4(0x275)]==_0x584d55[_0x8b48a4(0x275)]&&_0x243a11['bay']==_0x584d55[_0x8b48a4(0x297)]&&_0x243a11[_0x8b48a4(0x1d5)]==_0x584d55[_0x8b48a4(0x1d5)]&&_0x243a11[_0x8b48a4(0x1ba)]==_0x584d55[_0x8b48a4(0x1ba)]&&_0x243a11[_0x8b48a4(0x272)]==_0x584d55[_0x8b48a4(0x272)]&&_0x243a11[_0x8b48a4(0x236)]==_0x584d55['batch_code']&&_0x243a11[_0x8b48a4(0x231)]==_0x584d55[_0x8b48a4(0x231)]&&_0x243a11[_0x8b48a4(0x1cf)]==_0x584d55[_0x8b48a4(0x1ef)]&&(_0x243a11[_0x8b48a4(0x1c8)]=Math[_0x8b48a4(0x2a6)](0x0,Math[_0x8b48a4(0x2ac)](_0x243a11['product_stock'])-Math[_0x8b48a4(0x2ac)](_0x584d55[_0x8b48a4(0x22b)])));});return _0x3467a9;});Promise[_0x3a2a5c(0x282)](_0x1e9ece)['then'](async _0x200f7=>{var _0x162157=_0x3a2a5c;try{for(const _0x36b0d8 of _0x200f7){await _0x36b0d8[_0x162157(0x266)]();}_0x3d4f5c[_0x162157(0x1b5)]=_0x162157(0x1c7);const _0x4c9ab7=await _0x3d4f5c[_0x162157(0x266)](),_0x238e6e=await master_shop['find'](),_0x2e1d00=await email_settings[_0x162157(0x214)](),_0x2c27ec=await supervisor_settings['find']();var _0x41ea95=_0x3d4f5c[_0x162157(0x262)],_0x1d2a52='',_0x3fb66b;for(_0x3fb66b in _0x41ea95){_0x1d2a52+=_0x162157(0x206)+_0x162157(0x250)+_0x41ea95[_0x3fb66b][_0x162157(0x28a)]+_0x162157(0x217)+_0x162157(0x250)+_0x41ea95[_0x3fb66b]['product_code']+'</td>'+_0x162157(0x250)+_0x41ea95[_0x3fb66b]['quantity']+_0x162157(0x217)+_0x162157(0x250)+_0x41ea95[_0x3fb66b][_0x162157(0x24a)]+'</td>'+_0x162157(0x250)+_0x41ea95[_0x3fb66b]['secondary_unit']+_0x162157(0x217)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d4f5c[_0x162157(0x298)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x41ea95[_0x3fb66b][_0x162157(0x226)]+_0x162157(0x217)+_0x162157(0x250)+_0x41ea95[_0x3fb66b][_0x162157(0x1ba)]+_0x41ea95[_0x3fb66b][_0x162157(0x1d5)]+_0x41ea95[_0x3fb66b][_0x162157(0x297)]+_0x41ea95[_0x3fb66b][_0x162157(0x275)]+_0x41ea95[_0x3fb66b]['type'][0x0]+_0x41ea95[_0x3fb66b]['floorlevel']+_0x162157(0x217),_0x162157(0x1f7);}let _0x286cad=nodemailer['createTransport']({'host':_0x2e1d00['host'],'port':Number(_0x2e1d00[_0x162157(0x200)]),'secure':![],'auth':{'user':_0x2e1d00['email'],'pass':_0x2e1d00[_0x162157(0x25b)]}}),_0x4b1bee={'from':_0x2e1d00[_0x162157(0x1d3)],'to':_0x2c27ec[0x0][_0x162157(0x218)],'subject':_0x162157(0x267),'attachments':[{'filename':'Logo.png','path':__dirname+_0x162157(0x20f)+'/upload/'+_0x238e6e[0x0][_0x162157(0x291)],'cid':_0x162157(0x1e5)}],'html':_0x162157(0x1db)+_0x162157(0x2ae)+_0x162157(0x2be)+_0x162157(0x2bf)+_0x162157(0x23a)+'<div>'+_0x162157(0x1b4)+_0x162157(0x235)+_0x162157(0x2bf)+_0x162157(0x1cb)+_0x238e6e[0x0][_0x162157(0x232)]+_0x162157(0x25e)+_0x162157(0x235)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x162157(0x251)+_0x162157(0x255)+_0x3d4f5c['invoice']+'\x20'+_0x162157(0x243)+_0x162157(0x1b3)+_0x3d4f5c[_0x162157(0x1c0)]+'\x20'+_0x162157(0x1e9)+_0x162157(0x224)+_0x162157(0x235)+_0x162157(0x2a1)+_0x162157(0x26b)+'<tr>'+_0x162157(0x27f)+_0x162157(0x208)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x162157(0x1d9)+_0x162157(0x288)+_0x162157(0x1c3)+_0x162157(0x1bb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x162157(0x245)+_0x162157(0x24b)+'\x20'+_0x1d2a52+'\x20'+_0x162157(0x261)+'</table>'+_0x162157(0x2bf)+_0x162157(0x1d2)+_0x162157(0x20a)+_0x238e6e[0x0]['site_title']+_0x162157(0x224)+_0x162157(0x235)+_0x162157(0x235)+_0x162157(0x2b7)};_0x286cad[_0x162157(0x2a3)](_0x4b1bee,function(_0x5ab673,_0x4d5869){var _0x1f6918=_0x162157;_0x5ab673?(console['log'](_0x5ab673),console[_0x1f6918(0x1e2)](_0x1f6918(0x1fc))):console[_0x1f6918(0x1e2)](_0x1f6918(0x1f5));}),_0x3a5975[_0x162157(0x27b)](_0x162157(0x1b6),'Sales\x20Update\x20successfully'),_0x1c9f0a['redirect'](_0x162157(0x280)+_0x98fda9);}catch(_0x465dba){console[_0x162157(0x1ee)](_0x465dba),_0x1c9f0a['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3a2a5c(0x1fb)](_0x54993d=>{var _0x43c25f=_0x3a2a5c;console[_0x43c25f(0x1ee)](_0x54993d),_0x1c9f0a[_0x43c25f(0x1bc)](0x1f4)[_0x43c25f(0x2a4)]({'error':'An\x20error\x20occurred.'});});}catch(_0x13e23a){console['log'](_0x13e23a);}}),router[a0_0x31cebd(0x26a)](a0_0x31cebd(0x284),auth,async(_0x525db7,_0x3e5f2a)=>{var _0x187714=a0_0x31cebd;try{const {username:_0x164fee,email:_0x7c640,role:_0x53d98f}=_0x525db7[_0x187714(0x290)],_0x6e15a8=_0x525db7[_0x187714(0x290)],_0x44aab4=await profile[_0x187714(0x214)]({'email':_0x6e15a8['email']}),_0x11ad9b=await master_shop[_0x187714(0x296)](),_0x48ffdd=_0x525db7['params']['id'],_0xd54b65=await sales[_0x187714(0x1c4)](_0x48ffdd);var _0x4550fe=[_0x187714(0x1e1),_0x187714(0x1d1)];const _0x5c34e4=await warehouse['aggregate']([{'$match':{'name':_0xd54b65[_0x187714(0x298)],'warehouse_category':_0x187714(0x223)}},{'$unwind':_0x187714(0x210)},{'$group':{'_id':_0x187714(0x220),'name':{'$first':_0x187714(0x216)},'product_stock':{'$first':_0x187714(0x2b6)},'bay':{'$first':_0x187714(0x21e)},'bin':{'$first':_0x187714(0x24e)},'type':{'$first':_0x187714(0x212)},'floorlevel':{'$first':_0x187714(0x2b2)},'primary_code':{'$first':_0x187714(0x25d)},'secondary_code':{'$first':_0x187714(0x23c)},'product_code':{'$first':_0x187714(0x1b2)},'storage':{'$first':_0x187714(0x20b)},'rack':{'$first':_0x187714(0x269)}}}]),_0x1579ab=await customer[_0x187714(0x296)]({});let _0x5c1695;if(_0x6e15a8[_0x187714(0x21a)]==_0x187714(0x1fe)){const _0x288094=await staff[_0x187714(0x214)]({'email':_0x6e15a8[_0x187714(0x1d3)]});_0x5c1695=await warehouse[_0x187714(0x1b7)]([{'$match':{'status':_0x187714(0x20e),'name':_0x288094[_0x187714(0x215)],'warehouse_category':_0x187714(0x223)}},{'$group':{'_id':_0x187714(0x230),'name':{'$first':'$name'}}}]);}else _0x5c1695=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x187714(0x223)}},{'$group':{'_id':_0x187714(0x230),'name':{'$first':_0x187714(0x230)}}}]);const _0xbb540e=await product[_0x187714(0x296)]({});if(_0x11ad9b[0x0][_0x187714(0x22e)]=='English\x20(US)'){var _0x4e12d3=users[_0x187714(0x2ad)];console[_0x187714(0x1e2)](_0x4e12d3);}else{if(_0x11ad9b[0x0]['language']==_0x187714(0x2a9))var _0x4e12d3=users[_0x187714(0x2a9)];else{if(_0x11ad9b[0x0]['language']==_0x187714(0x1d0))var _0x4e12d3=users[_0x187714(0x1d0)];else{if(_0x11ad9b[0x0][_0x187714(0x22e)]==_0x187714(0x1c5))var _0x4e12d3=users[_0x187714(0x1c5)];else{if(_0x11ad9b[0x0][_0x187714(0x22e)]==_0x187714(0x1fa))var _0x4e12d3=users['French'];else{if(_0x11ad9b[0x0][_0x187714(0x22e)]==_0x187714(0x2a7))var _0x4e12d3=users[_0x187714(0x20d)];else{if(_0x11ad9b[0x0][_0x187714(0x22e)]==_0x187714(0x1e0))var _0x4e12d3=users[_0x187714(0x1e0)];else{if(_0x11ad9b[0x0]['language']==_0x187714(0x244))var _0x4e12d3=users[_0x187714(0x1ce)];}}}}}}}_0x3e5f2a[_0x187714(0x1d7)](_0x187714(0x203),{'success':_0x525db7[_0x187714(0x27b)]('success'),'errors':_0x525db7[_0x187714(0x27b)]('errors'),'role':_0x6e15a8,'profile':_0x44aab4,'customer':_0x1579ab,'warehouse':_0x5c1695,'product':_0x5c34e4,'user':_0xd54b65,'master_shop':_0x11ad9b,'unit':_0xbb540e,'language':_0x4e12d3});}catch(_0x1ea7a6){console[_0x187714(0x1e2)](_0x1ea7a6);}}),router[a0_0x31cebd(0x1f2)](a0_0x31cebd(0x284),auth,async(_0x259376,_0x25ae3e)=>{var _0x3d85c2=a0_0x31cebd;try{const _0x39b2b0=_0x259376['params']['id'],_0x23cf18=await sales[_0x3d85c2(0x214)]({'_id':_0x259376[_0x3d85c2(0x2ab)]['id']}),_0x53c20c=await warehouse[_0x3d85c2(0x214)]({'name':_0x23cf18[_0x3d85c2(0x298)],'room':_0x259376[_0x3d85c2(0x21f)]['room']}),{invoice:_0x58f936,date:_0x335910,warehouse_name:_0x2d7210,product_name:_0x2b693e,stock:_0x3c94fa,quantity:_0x4a40ea,note:_0x44d1d1,room:_0x42af4d,customer:_0xfefc37,SCRN:_0x497f1b}=_0x259376[_0x3d85c2(0x21f)];if(typeof _0x2b693e==_0x3d85c2(0x228))var _0x27bc9c=[_0x259376['body'][_0x3d85c2(0x28a)]],_0x3f42a9=[_0x259376['body'][_0x3d85c2(0x222)]],_0x2508bb=[_0x259376['body'][_0x3d85c2(0x221)]],_0x546b73=[_0x259376[_0x3d85c2(0x21f)]['primary_code']],_0x31f08c=[_0x259376['body'][_0x3d85c2(0x1f9)]],_0x684ad4=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x27e)]],_0x4bbd4b=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x23b)]],_0x4ac09e=[_0x259376['body'][_0x3d85c2(0x286)]],_0xda8c75=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x27a)]],_0x4bccbc=[_0x259376['body'][_0x3d85c2(0x236)]],_0x2afab9=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x272)]],_0x54639c=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x1b8)]],_0x2dc65e=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x26e)]],_0x1b05af=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x28f)]],_0x276d3a=[_0x259376['body'][_0x3d85c2(0x1e6)]],_0x5c462a=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x1e3)]],_0x1b09ba=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x241)]],_0x38a040=[_0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x22b)]],_0x5d0494=[_0x259376[_0x3d85c2(0x21f)]['RoomAssigned']];else var _0x27bc9c=[..._0x259376['body'][_0x3d85c2(0x28a)]],_0x3f42a9=[..._0x259376['body']['stock']],_0x2508bb=[..._0x259376['body']['carton']],_0x546b73=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x21b)]],_0x31f08c=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x1f9)]],_0x684ad4=[..._0x259376[_0x3d85c2(0x21f)]['prod_code']],_0x4bbd4b=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x23b)]],_0x4ac09e=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x286)]],_0xda8c75=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x27a)]],_0x4bccbc=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x236)]],_0x2afab9=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x272)]],_0x54639c=[..._0x259376[_0x3d85c2(0x21f)]['max_per_unit']],_0x2dc65e=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x26e)]],_0x1b05af=[..._0x259376['body'][_0x3d85c2(0x28f)]],_0x276d3a=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x1e6)]],_0x5c462a=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x1e3)]],_0x1b09ba=[..._0x259376[_0x3d85c2(0x21f)][_0x3d85c2(0x241)]],_0x38a040=[..._0x259376['body'][_0x3d85c2(0x22b)]],_0x5d0494=[..._0x259376[_0x3d85c2(0x21f)]['RoomAssigned']];const _0x59fb35=_0x27bc9c[_0x3d85c2(0x1b9)](_0x1287f7=>{return _0x1287f7={'product_name':_0x1287f7};});_0x3f42a9['forEach']((_0x5877fc,_0x4632e8)=>{var _0x1ec52e=_0x3d85c2;_0x59fb35[_0x4632e8][_0x1ec52e(0x222)]=Math['abs'](_0x5877fc);}),_0x2508bb[_0x3d85c2(0x283)]((_0x589b62,_0x13d051)=>{_0x59fb35[_0x13d051]['quantity']=_0x589b62;}),_0x546b73[_0x3d85c2(0x283)]((_0x409c45,_0x22f181)=>{var _0x21ac38=_0x3d85c2;_0x59fb35[_0x22f181][_0x21ac38(0x21b)]=_0x409c45;}),_0x31f08c[_0x3d85c2(0x283)]((_0x58141a,_0xc1c225)=>{var _0x18199d=_0x3d85c2;_0x59fb35[_0xc1c225][_0x18199d(0x1f9)]=_0x58141a;}),_0x684ad4[_0x3d85c2(0x283)]((_0x4dfc48,_0x3daa4f)=>{var _0x478fc5=_0x3d85c2;_0x59fb35[_0x3daa4f][_0x478fc5(0x274)]=_0x4dfc48;}),_0x4bbd4b[_0x3d85c2(0x283)]((_0xfc02ef,_0x1eee1d)=>{var _0x25bf3a=_0x3d85c2;_0x5d0494[_0x25bf3a(0x283)]((_0x3ea15a,_0x369a17)=>{var _0x58c43b=_0x25bf3a;if(_0x3ea15a==_0x58c43b(0x289)&&_0x1eee1d==_0x369a17){var _0x22fdd6=_0xfc02ef['slice'](0x3);_0x59fb35[_0x1eee1d]['storage']=_0xfc02ef[0x0],_0x59fb35[_0x1eee1d][_0x58c43b(0x1d5)]=_0xfc02ef[0x1],_0x59fb35[_0x1eee1d][_0x58c43b(0x297)]=0x0,_0x59fb35[_0x1eee1d][_0x58c43b(0x275)]=0x0,_0x59fb35[_0x1eee1d]['type']=_0x58c43b(0x246),_0x59fb35[_0x1eee1d][_0x58c43b(0x24f)]=_0x22fdd6;}else{if(_0x3ea15a==_0x58c43b(0x2a8)&&_0x1eee1d==_0x369a17){var _0x22fdd6=_0xfc02ef[_0x58c43b(0x25a)](0x3);_0x59fb35[_0x1eee1d][_0x58c43b(0x1ba)]=_0xfc02ef[0x0],_0x59fb35[_0x1eee1d][_0x58c43b(0x1d5)]=_0xfc02ef[0x1],_0x59fb35[_0x1eee1d][_0x58c43b(0x297)]=0x0,_0x59fb35[_0x1eee1d][_0x58c43b(0x275)]=0x0,_0x59fb35[_0x1eee1d]['type']=_0x58c43b(0x246),_0x59fb35[_0x1eee1d][_0x58c43b(0x24f)]=_0xfc02ef[0x5];}else{if(_0x1eee1d==_0x369a17){var _0x540f29;if(_0xfc02ef[0x4]=='L')_0x540f29='Level';else _0xfc02ef[0x4]=='F'&&(_0x540f29=_0x58c43b(0x246));_0x59fb35[_0x1eee1d][_0x58c43b(0x1ba)]=_0xfc02ef[0x0],_0x59fb35[_0x1eee1d][_0x58c43b(0x1d5)]=_0xfc02ef[0x1],_0x59fb35[_0x1eee1d]['bay']=_0xfc02ef[0x2],_0x59fb35[_0x1eee1d][_0x58c43b(0x275)]=_0xfc02ef[0x3],_0x59fb35[_0x1eee1d][_0x58c43b(0x2bb)]=_0x540f29,_0x59fb35[_0x1eee1d][_0x58c43b(0x24f)]=_0xfc02ef[0x5];}}}});}),_0x4ac09e[_0x3d85c2(0x283)]((_0x5406a0,_0x41f2a3)=>{var _0x70f905=_0x3d85c2;_0x59fb35[_0x41f2a3][_0x70f905(0x24a)]=_0x5406a0;}),_0xda8c75[_0x3d85c2(0x283)]((_0x4cc423,_0x55dd99)=>{var _0x1ddaf9=_0x3d85c2;_0x59fb35[_0x55dd99][_0x1ddaf9(0x27a)]=_0x4cc423;}),_0x4bccbc[_0x3d85c2(0x283)]((_0x2a4b15,_0x1c0df0)=>{_0x59fb35[_0x1c0df0]['batch_code']=_0x2a4b15;}),_0x2afab9[_0x3d85c2(0x283)]((_0x56b3fb,_0x3223c6)=>{var _0x4fab2f=_0x3d85c2;_0x59fb35[_0x3223c6][_0x4fab2f(0x272)]=_0x56b3fb;}),_0x54639c[_0x3d85c2(0x283)]((_0x31cbef,_0x4e6fc3)=>{var _0x4cd621=_0x3d85c2;_0x59fb35[_0x4e6fc3][_0x4cd621(0x25f)]=_0x31cbef;}),_0x2dc65e[_0x3d85c2(0x283)]((_0x276cff,_0x5db28e)=>{var _0x36da23=_0x3d85c2;_0x59fb35[_0x5db28e][_0x36da23(0x26e)]=_0x276cff;}),_0x1b05af[_0x3d85c2(0x283)]((_0x2134f8,_0xdd25a5)=>{var _0x5e609f=_0x3d85c2;_0x59fb35[_0xdd25a5][_0x5e609f(0x28f)]=Math['abs'](_0x2134f8);}),_0x276d3a['forEach']((_0xf610d6,_0x3fd742)=>{var _0x1b29ad=_0x3d85c2;_0x59fb35[_0x3fd742][_0x1b29ad(0x1e6)]=_0xf610d6;}),_0x5c462a[_0x3d85c2(0x283)]((_0x142df3,_0x3f8b6f)=>{var _0xf17ca2=_0x3d85c2;_0x59fb35[_0x3f8b6f][_0xf17ca2(0x1e3)]=_0x142df3;}),_0x1b09ba[_0x3d85c2(0x283)]((_0x4a24b0,_0x44c87a)=>{var _0x1a2d99=_0x3d85c2;_0x59fb35[_0x44c87a][_0x1a2d99(0x241)]=_0x4a24b0;}),_0x38a040['forEach']((_0x2e0e7e,_0x2ffbf2)=>{var _0x449860=_0x3d85c2;_0x59fb35[_0x2ffbf2][_0x449860(0x292)]=_0x2e0e7e;}),_0x5d0494[_0x3d85c2(0x283)]((_0x584a8c,_0x3db8e4)=>{_0x59fb35[_0x3db8e4]['room_name']=_0x584a8c;});var _0x251c92=0x0;_0x59fb35[_0x3d85c2(0x283)](_0x1127a7=>{var _0x456a96=_0x3d85c2;console['log']('foreach\x20newproduct',_0x1127a7),(parseInt(_0x1127a7['stock'])<parseInt(_0x1127a7[_0x456a96(0x22b)])||parseInt(_0x1127a7[_0x456a96(0x22b)])==0x0)&&_0x251c92++;});if(_0x251c92!=0x0)return _0x259376[_0x3d85c2(0x27b)](_0x3d85c2(0x225),_0x3d85c2(0x295)),_0x25ae3e[_0x3d85c2(0x2bc)](_0x3d85c2(0x237));const _0x232e60=_0x59fb35[_0x3d85c2(0x211)](_0x1c26a0=>_0x1c26a0[_0x3d85c2(0x22b)]!=='0'&&_0x1c26a0['quantity']!=='');_0x23cf18[_0x3d85c2(0x231)]=_0x58f936,_0x23cf18[_0x3d85c2(0x205)]=_0xfefc37,_0x23cf18[_0x3d85c2(0x1c0)]=_0x335910,_0x23cf18[_0x3d85c2(0x298)]=_0x2d7210,_0x23cf18['sale_product']=_0x232e60,_0x23cf18['note']=_0x44d1d1,_0x23cf18[_0x3d85c2(0x1c2)]=_0x497f1b,_0x23cf18[_0x3d85c2(0x1b5)]='False',_0x23cf18[_0x3d85c2(0x1d8)]='False';const _0x5001f3=await _0x23cf18[_0x3d85c2(0x266)]();_0x259376[_0x3d85c2(0x27b)](_0x3d85c2(0x1b6),_0x3d85c2(0x22f)),_0x25ae3e['redirect'](_0x3d85c2(0x29d));}catch(_0x5cf4f7){console[_0x3d85c2(0x1e2)](_0x5cf4f7);}}),router[a0_0x31cebd(0x1f2)](a0_0x31cebd(0x260),auth,async(_0x576624,_0x59f258)=>{var _0xf0b84c=a0_0x31cebd;try{const _0x11c79d=_0x576624[_0xf0b84c(0x2ab)]['id'],{invoice:_0x204f99,customer:_0x49f001,receivable_amount:_0x2803b3,received_amount:_0x2b961e}=_0x576624[_0xf0b84c(0x21f)],_0x3e87fc=await sales['findById'](_0x11c79d);console['log'](_0x3e87fc);var _0x544cb1=_0x2803b3-_0x2b961e;console['log'](_0x2b961e),_0x3e87fc[_0xf0b84c(0x1e8)]=parseFloat(_0x2b961e)+parseFloat(_0x3e87fc['received_amount']),_0x3e87fc['due_amount']=_0x544cb1,console[_0xf0b84c(0x1e2)](_0x3e87fc);const _0x1a15bc=await _0x3e87fc[_0xf0b84c(0x266)](),_0x5d5aca=await c_payment_data['findOne']({'invoice':_0x204f99});_0x5d5aca[_0xf0b84c(0x1eb)]=_0x544cb1,await _0x5d5aca['save']();let _0x406f52=new Date(),_0x5d6057=('0'+_0x406f52[_0xf0b84c(0x29e)]())[_0xf0b84c(0x25a)](-0x2),_0x357039=('0'+(_0x406f52[_0xf0b84c(0x2c0)]()+0x1))[_0xf0b84c(0x25a)](-0x2),_0x38bc95=_0x406f52['getFullYear'](),_0x2d6089=_0x38bc95+'-'+_0x357039+'-'+_0x5d6057;const _0x2cd75d=new customer_payment({'invoice':_0x204f99,'date':_0x38bc95+'-'+_0x357039+'-'+_0x5d6057,'customer':_0x49f001,'reason':_0xf0b84c(0x1c9),'amount':_0x2b961e}),_0x4e346c=await _0x2cd75d[_0xf0b84c(0x266)]();_0x576624['flash']('success','payment\x20successfull'),_0x59f258[_0xf0b84c(0x2bc)](_0xf0b84c(0x29d));}catch(_0x43b4cb){console[_0xf0b84c(0x1e2)](_0x43b4cb);}}),router['get'](a0_0x31cebd(0x264),auth,async(_0x15023d,_0xce387b)=>{var _0x20d887=a0_0x31cebd;try{const {username:_0x4c9e66,email:_0x1c6ace,role:_0x431e31}=_0x15023d[_0x20d887(0x290)],_0x12ef92=_0x15023d[_0x20d887(0x290)],_0x5b10e2=await profile[_0x20d887(0x214)]({'email':_0x12ef92[_0x20d887(0x1d3)]}),_0x2fb711=await master_shop['find']();console[_0x20d887(0x1e2)](_0x20d887(0x27d),_0x2fb711);const _0x1715eb=_0x15023d[_0x20d887(0x2ab)]['id'],_0x5ee621=await sales['findById'](_0x1715eb);console['log'](_0x5ee621);const _0xd17778=await customer[_0x20d887(0x214)]({'name':_0x5ee621[_0x20d887(0x205)]});console[_0x20d887(0x1e2)](_0xd17778);if(_0x2fb711[0x0][_0x20d887(0x22e)]==_0x20d887(0x1cc)){var _0x33fd2b=users['English'];console[_0x20d887(0x1e2)](_0x33fd2b);}else{if(_0x2fb711[0x0][_0x20d887(0x22e)]==_0x20d887(0x2a9))var _0x33fd2b=users[_0x20d887(0x2a9)];else{if(_0x2fb711[0x0][_0x20d887(0x22e)]==_0x20d887(0x1d0))var _0x33fd2b=users[_0x20d887(0x1d0)];else{if(_0x2fb711[0x0][_0x20d887(0x22e)]==_0x20d887(0x1c5))var _0x33fd2b=users[_0x20d887(0x1c5)];else{if(_0x2fb711[0x0][_0x20d887(0x22e)]==_0x20d887(0x1fa))var _0x33fd2b=users[_0x20d887(0x1fa)];else{if(_0x2fb711[0x0][_0x20d887(0x22e)]==_0x20d887(0x2a7))var _0x33fd2b=users[_0x20d887(0x20d)];else{if(_0x2fb711[0x0]['language']=='Chinese')var _0x33fd2b=users['Chinese'];else{if(_0x2fb711[0x0][_0x20d887(0x22e)]=='Arabic\x20(ae)')var _0x33fd2b=users[_0x20d887(0x1ce)];}}}}}}}_0xce387b[_0x20d887(0x1d7)](_0x20d887(0x1bf),{'success':_0x15023d[_0x20d887(0x27b)](_0x20d887(0x1b6)),'errors':_0x15023d['flash']('errors'),'role':_0x12ef92,'profile':_0x5b10e2,'master_shop':_0x2fb711,'customers':_0xd17778,'sales':_0x5ee621,'language':_0x33fd2b});}catch(_0x3a57a3){console[_0x20d887(0x1e2)](_0x3a57a3);}}),router[a0_0x31cebd(0x26a)](a0_0x31cebd(0x1ea),auth,async(_0x3dff94,_0x401206)=>{var _0x5eb196=a0_0x31cebd;try{const {username:_0x1a200e,email:_0x3abd24,role:_0x21f4cf}=_0x3dff94['user'],_0x24162f=_0x3dff94[_0x5eb196(0x290)],_0x364073=await profile[_0x5eb196(0x214)]({'email':_0x24162f[_0x5eb196(0x1d3)]}),_0x3c5e6b=await master_shop[_0x5eb196(0x296)]();console[_0x5eb196(0x1e2)](_0x5eb196(0x27d),_0x3c5e6b);const _0x79d05a=_0x3dff94[_0x5eb196(0x2ab)]['id'];console[_0x5eb196(0x1e2)](_0x79d05a);const _0x37b78b=await sales[_0x5eb196(0x1c4)](_0x79d05a);console[_0x5eb196(0x1e2)]('user_id',_0x37b78b);const _0x684fe4=await warehouse[_0x5eb196(0x1b7)]([{'$match':{'name':'Return\x20Goods','room':_0x5eb196(0x24c)}},{'$unwind':_0x5eb196(0x210)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5eb196(0x216)},'product_stock':{'$first':_0x5eb196(0x2b6)},'level':{'$first':_0x5eb196(0x2aa)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5eb196(0x26f)},'primary_code':{'$first':_0x5eb196(0x25d)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5eb196(0x1b2)}}}]);console[_0x5eb196(0x1e2)](_0x5eb196(0x204),_0x684fe4);const _0x891542=await product[_0x5eb196(0x296)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x5eb196(0x20e),'name':_0x5eb196(0x1ec),'warehouse_category':_0x5eb196(0x223)}},{'$group':{'_id':_0x5eb196(0x230),'name':{'$first':_0x5eb196(0x230)}}},{'$sort':{'name':0x1}}]);var _0x5c7685=['Return\x20Rooms'];if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x1cc)){var _0x55a53a=users[_0x5eb196(0x2ad)];console[_0x5eb196(0x1e2)](_0x55a53a);}else{if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x2a9))var _0x55a53a=users[_0x5eb196(0x2a9)];else{if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x1d0))var _0x55a53a=users[_0x5eb196(0x1d0)];else{if(_0x3c5e6b[0x0]['language']=='Spanish')var _0x55a53a=users[_0x5eb196(0x1c5)];else{if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x1fa))var _0x55a53a=users['French'];else{if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x2a7))var _0x55a53a=users['Portuguese'];else{if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x1e0))var _0x55a53a=users[_0x5eb196(0x1e0)];else{if(_0x3c5e6b[0x0][_0x5eb196(0x22e)]==_0x5eb196(0x244))var _0x55a53a=users[_0x5eb196(0x1ce)];}}}}}}}_0x401206[_0x5eb196(0x1d7)](_0x5eb196(0x1be),{'success':_0x3dff94[_0x5eb196(0x27b)]('success'),'errors':_0x3dff94[_0x5eb196(0x27b)](_0x5eb196(0x225)),'role':_0x24162f,'profile':_0x364073,'user':_0x37b78b,'stock':_0x684fe4,'master_shop':_0x3c5e6b,'unit':_0x891542,'language':_0x55a53a,'warehouses':warehouse_data,'rooms':_0x5c7685});}catch(_0x25c921){console['log'](_0x25c921),_0x401206['status'](0xc8)[_0x5eb196(0x2a4)]({'message':_0x25c921['message']});}}),router['post'](a0_0x31cebd(0x1ea),auth,async(_0x3f9600,_0x1f7707)=>{var _0x2222e0=a0_0x31cebd;try{const {invoice:_0x71f1f4,date:_0x5d68f2,warehouse_name:_0x11fdcc,product_name:_0x192574,primary_code:_0x20cc13,secondary_code:_0x123510,product_code:_0x1641be,sales_quantity:_0xb05077,stocks:_0x599674,return_qty:_0x372a15,Room_name:_0x5bd35f,to_warehouse_name:_0x24f4f1,to_Roomname:_0x99e4de,to_Room_name:_0x1448e1,note:_0x2d5527,level:_0x2c72d2,isle:_0x227de1,pallet:_0x21f352}=_0x3f9600[_0x2222e0(0x21f)];if(typeof _0x192574==_0x2222e0(0x228))var _0x4e715e=[_0x3f9600[_0x2222e0(0x21f)]['product_name']],_0x5c6031=[_0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x21b)]],_0x5790bc=[_0x3f9600[_0x2222e0(0x21f)]['secondary_code']],_0xa4f602=[_0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x274)]],_0x599302=[_0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x2c1)]],_0x2339e0=[_0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x249)]],_0x104c77=[_0x3f9600[_0x2222e0(0x21f)]['return_qty']],_0x1f4aa1=[_0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x297)]],_0x51a9e6=[_0x3f9600[_0x2222e0(0x21f)]['bin']],_0x991c9=[_0x3f9600[_0x2222e0(0x21f)]['types']],_0x7d3741=[_0x3f9600['body'][_0x2222e0(0x24f)]];else var _0x4e715e=[..._0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x28a)]],_0x5c6031=[..._0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x21b)]],_0x5790bc=[..._0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x1f9)]],_0xa4f602=[..._0x3f9600['body'][_0x2222e0(0x274)]],_0x599302=[..._0x3f9600[_0x2222e0(0x21f)]['sales_quantity']],_0x2339e0=[..._0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x249)]],_0x104c77=[..._0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x29b)]],_0x1f4aa1=[..._0x3f9600[_0x2222e0(0x21f)]['bay']],_0x51a9e6=[..._0x3f9600[_0x2222e0(0x21f)]['bin']],_0x991c9=[..._0x3f9600[_0x2222e0(0x21f)][_0x2222e0(0x277)]],_0x7d3741=[..._0x3f9600[_0x2222e0(0x21f)]['floorlevel']];const _0x35d46f=_0x4e715e['map'](_0x2f9d27=>{return _0x2f9d27={'product_name':_0x2f9d27};});_0x5c6031['forEach']((_0x3c0619,_0x5720df)=>{var _0xd9034=_0x2222e0;_0x35d46f[_0x5720df][_0xd9034(0x21b)]=_0x3c0619;}),_0x5790bc[_0x2222e0(0x283)]((_0x3f465c,_0xb3d2d5)=>{_0x35d46f[_0xb3d2d5]['secondary_code']=_0x3f465c;}),_0xa4f602[_0x2222e0(0x283)]((_0xa3fb6a,_0xf4cad3)=>{var _0x502d56=_0x2222e0;_0x35d46f[_0xf4cad3][_0x502d56(0x274)]=_0xa3fb6a;}),_0x599302[_0x2222e0(0x283)]((_0x4f46d4,_0x522b50)=>{var _0x96c525=_0x2222e0;_0x35d46f[_0x522b50][_0x96c525(0x2a0)]=_0x4f46d4;}),_0x2339e0[_0x2222e0(0x283)]((_0x241cd1,_0xf8fee0)=>{var _0x4a15aa=_0x2222e0;_0x35d46f[_0xf8fee0][_0x4a15aa(0x222)]=_0x241cd1;}),_0x104c77[_0x2222e0(0x283)]((_0x17bd78,_0x56aa11)=>{_0x35d46f[_0x56aa11]['return_qty']=_0x17bd78;}),_0x1f4aa1['forEach']((_0x386856,_0xff14b6)=>{_0x35d46f[_0xff14b6]['bay']=_0x386856;}),_0x51a9e6['forEach']((_0x580217,_0x4cfe8b)=>{var _0x5bef29=_0x2222e0;_0x35d46f[_0x4cfe8b][_0x5bef29(0x275)]=_0x580217;}),_0x991c9['forEach']((_0x4249d9,_0xe237bd)=>{var _0x2a2c21=_0x2222e0;_0x35d46f[_0xe237bd][_0x2a2c21(0x2bb)]=_0x4249d9;}),_0x7d3741[_0x2222e0(0x283)]((_0x4eb986,_0x24e649)=>{var _0x25fa40=_0x2222e0;_0x35d46f[_0x24e649][_0x25fa40(0x24f)]=_0x4eb986;});var _0x5b9c15=0x0;_0x35d46f[_0x2222e0(0x283)](_0x1a557f=>{var _0x2e3dc7=_0x2222e0;console[_0x2e3dc7(0x1e2)](_0x2e3dc7(0x1de),_0x1a557f),(parseInt(_0x1a557f[_0x2e3dc7(0x2a0)])<parseInt(_0x1a557f[_0x2e3dc7(0x29b)])||parseInt(_0x1a557f[_0x2e3dc7(0x222)])<parseInt(_0x1a557f[_0x2e3dc7(0x29b)])&&parseInt(_0x1a557f['sale_qty'])>parseInt(_0x1a557f[_0x2e3dc7(0x29b)])||parseInt(_0x1a557f[_0x2e3dc7(0x29b)])==0x0)&&_0x5b9c15++;});if(_0x5b9c15!=0x0)return _0x3f9600[_0x2222e0(0x27b)]('errors',_0x2222e0(0x1f1)),_0x1f7707['redirect']('back');const _0xa3e747=await sales[_0x2222e0(0x214)]({'invoice':_0x71f1f4});console[_0x2222e0(0x1e2)](_0xa3e747),_0xa3e747[_0x2222e0(0x259)]=_0x2222e0(0x1c7);const _0x9662ed=await _0xa3e747['save'](),_0x51d7c3=new sales_return({'invoice':_0x71f1f4,'customer':_0x3f9600['body'][_0x2222e0(0x205)],'date':_0x5d68f2,'warehouse_name':_0x11fdcc,'room':_0x5bd35f,'ToWarehouse':_0x24f4f1,'ToRoom':_0x1448e1,'return_sale':_0x35d46f,'note':_0x2d5527}),_0x2b7889=await _0x51d7c3[_0x2222e0(0x266)]();console[_0x2222e0(0x1e2)](_0x51d7c3);const _0x3456f8=await sales_return[_0x2222e0(0x214)]({'invoice':_0x71f1f4}),_0x1202c6=await warehouse['findOne']({'name':_0x24f4f1,'room':_0x1448e1});_0x3456f8[_0x2222e0(0x1be)][_0x2222e0(0x283)](_0x521d0c=>{var _0xe1cbfa=_0x2222e0,_0x22550f=0x0;const _0x257154=_0x1202c6['product_details']['map'](_0x50780e=>{var _0x4361d1=a0_0x5991;_0x50780e[_0x4361d1(0x28a)]==_0x521d0c[_0x4361d1(0x28a)]&&_0x50780e[_0x4361d1(0x24f)]==_0x521d0c[_0x4361d1(0x24f)]&&_0x50780e['type']==_0x521d0c['type']&&_0x50780e['bin']==_0x521d0c[_0x4361d1(0x275)]&&_0x50780e[_0x4361d1(0x297)]==_0x521d0c[_0x4361d1(0x297)]&&(_0x50780e['product_stock']=parseInt(_0x50780e[_0x4361d1(0x1c8)])+parseInt(_0x521d0c[_0x4361d1(0x29b)]),_0x22550f++);});_0x22550f=='0'&&(_0x1202c6[_0xe1cbfa(0x1da)]=_0x1202c6['product_details'][_0xe1cbfa(0x22c)]({'product_name':_0x521d0c[_0xe1cbfa(0x28a)],'product_stock':_0x521d0c['return_qty'],'primary_code':_0x521d0c[_0xe1cbfa(0x21b)],'secondary_code':_0x521d0c[_0xe1cbfa(0x1f9)],'product_code':_0x521d0c['product_code'],'bay':_0x521d0c[_0xe1cbfa(0x297)],'bin':_0x521d0c[_0xe1cbfa(0x275)],'type':_0x521d0c[_0xe1cbfa(0x2bb)],'floorlevel':_0x521d0c['floorlevel']})),console[_0xe1cbfa(0x1e2)]('final',_0x1202c6);}),await _0x1202c6[_0x2222e0(0x266)](),console['log'](_0x3f9600[_0x2222e0(0x21f)]);const _0x1b7ac3=new c_payment_data({'invoice':_0x71f1f4,'customer':_0x3f9600['body'][_0x2222e0(0x205)],'reason':_0x2222e0(0x202)});await _0x1b7ac3['save']();const _0x311297=await master_shop['find']();console[_0x2222e0(0x1e2)](_0x2222e0(0x258),_0x311297[0x0][_0x2222e0(0x291)]);const _0x5679c2=await email_settings[_0x2222e0(0x214)](),_0xd0b40d=await customer[_0x2222e0(0x214)]({'name':_0x3f9600['body'][_0x2222e0(0x205)]});console[_0x2222e0(0x1e2)](_0x2222e0(0x2af),_0xd0b40d);_0x311297[0x0][_0x2222e0(0x219)]==0x1?(right_currency=_0x311297[0x0][_0x2222e0(0x1dc)],left_currency=''):(right_currency='',left_currency=_0x311297[0x0][_0x2222e0(0x1dc)]);var _0x2648e3=_0x4e715e,_0x1dac6f=_0x104c77,_0x1b42a3='',_0x1f4f75;for(_0x1f4f75 in _0x2648e3){_0x1b42a3+=_0x2222e0(0x206)+_0x2222e0(0x250)+_0x2648e3[_0x1f4f75]+_0x2222e0(0x217)+_0x2222e0(0x250)+_0x1dac6f[_0x1f4f75]+_0x2222e0(0x217)+'</tr>';}console[_0x2222e0(0x1e2)](_0x2222e0(0x1f8),_0x1b42a3);let _0x471d2d=nodemailer['createTransport']({'service':_0x2222e0(0x21d),'auth':{'user':_0x5679c2['email'],'pass':_0x5679c2[_0x2222e0(0x25b)]}}),_0x5a8a41={'from':_0x5679c2[_0x2222e0(0x1d3)],'to':_0xd0b40d[_0x2222e0(0x1d3)],'subject':_0x2222e0(0x2b5),'attachments':[{'filename':_0x2222e0(0x1bd),'path':__dirname+_0x2222e0(0x20f)+_0x2222e0(0x2b9)+_0x311297[0x0][_0x2222e0(0x291)],'cid':_0x2222e0(0x1e5)}],'html':_0x2222e0(0x1db)+'<html><head><title></title>'+'</head><body>'+_0x2222e0(0x2bf)+_0x2222e0(0x23a)+_0x2222e0(0x2bf)+_0x2222e0(0x1b4)+'</div>'+_0x2222e0(0x2bf)+_0x2222e0(0x1cb)+_0x311297[0x0]['site_title']+_0x2222e0(0x25e)+_0x2222e0(0x235)+_0x2222e0(0x235)+_0x2222e0(0x2bd)+_0x2222e0(0x2bf)+_0x2222e0(0x251)+'\x20Order\x20Number\x20:\x20'+_0x71f1f4+'\x20'+_0x2222e0(0x243)+_0x2222e0(0x1b3)+_0x5d68f2+'\x20'+_0x2222e0(0x1e9)+_0x2222e0(0x224)+'</div>'+_0x2222e0(0x2a1)+_0x2222e0(0x26b)+_0x2222e0(0x206)+_0x2222e0(0x27f)+_0x2222e0(0x279)+_0x2222e0(0x22d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2222e0(0x1f7)+_0x2222e0(0x245)+_0x2222e0(0x24b)+'\x20'+_0x1b42a3+'\x20'+_0x2222e0(0x261)+_0x2222e0(0x23e)+'<div>'+_0x2222e0(0x1d2)+_0x2222e0(0x20a)+_0x311297[0x0][_0x2222e0(0x232)]+_0x2222e0(0x224)+'</div>'+_0x2222e0(0x235)+_0x2222e0(0x2b7)};_0x471d2d[_0x2222e0(0x2a3)](_0x5a8a41,function(_0x156a17,_0x2f9e26){var _0xeaacb6=_0x2222e0;_0x156a17?(console[_0xeaacb6(0x1e2)](_0x156a17),console['log'](_0xeaacb6(0x1fc))):console[_0xeaacb6(0x1e2)](_0xeaacb6(0x1f5));}),_0x3f9600[_0x2222e0(0x27b)]('success','sales\x20item\x20return\x20successfull'),_0x1f7707['redirect'](_0x2222e0(0x29d));}catch(_0x1d79ff){console[_0x2222e0(0x1e2)](_0x1d79ff),_0x1f7707[_0x2222e0(0x1bc)](0xc8)[_0x2222e0(0x2a4)]({'message1':_0x1d79ff[_0x2222e0(0x23d)]});}}),router['get'](a0_0x31cebd(0x265),auth,async(_0x47370b,_0x5a167c)=>{var _0x2e0602=a0_0x31cebd;try{const {username:_0x4d51fa,email:_0x486076,role:_0x4c12cb}=_0x47370b[_0x2e0602(0x290)],_0x38231b=_0x47370b[_0x2e0602(0x290)],_0x2aa74a=await profile[_0x2e0602(0x214)]({'email':_0x38231b[_0x2e0602(0x1d3)]}),_0x34db49=await master_shop[_0x2e0602(0x296)]();console[_0x2e0602(0x1e2)](_0x2e0602(0x1ff),_0x34db49);const _0x472284=_0x47370b[_0x2e0602(0x2ab)]['id'],_0x2fa87f=await sales[_0x2e0602(0x1c4)](_0x472284);console[_0x2e0602(0x1e2)](_0x2e0602(0x1d6),_0x2fa87f);if(_0x34db49[0x0]['language']=='English\x20(US)')var _0x364e47=users['English'];else{if(_0x34db49[0x0]['language']==_0x2e0602(0x2a9))var _0x364e47=users['Hindi'];else{if(_0x34db49[0x0][_0x2e0602(0x22e)]==_0x2e0602(0x1d0))var _0x364e47=users['German'];else{if(_0x34db49[0x0]['language']=='Spanish')var _0x364e47=users[_0x2e0602(0x1c5)];else{if(_0x34db49[0x0]['language']==_0x2e0602(0x1fa))var _0x364e47=users['French'];else{if(_0x34db49[0x0][_0x2e0602(0x22e)]==_0x2e0602(0x2a7))var _0x364e47=users['Portuguese'];else{if(_0x34db49[0x0]['language']==_0x2e0602(0x1e0))var _0x364e47=users[_0x2e0602(0x1e0)];else{if(_0x34db49[0x0]['language']==_0x2e0602(0x244))var _0x364e47=users[_0x2e0602(0x1ce)];}}}}}}}_0x5a167c[_0x2e0602(0x1d7)](_0x2e0602(0x270),{'success':_0x47370b['flash'](_0x2e0602(0x1b6)),'errors':_0x47370b[_0x2e0602(0x27b)](_0x2e0602(0x225)),'role':_0x38231b,'profile':_0x2aa74a,'alldata':_0x2fa87f,'master_shop':_0x34db49,'language':_0x364e47});}catch(_0x20d85a){console[_0x2e0602(0x1e2)](_0x20d85a);}}),router['post']('/barcode_scanner',async(_0x300353,_0x320802)=>{var _0x33e766=a0_0x31cebd;const {product_code:_0x759b88,warehouse_name:_0x25e9c,rooms_data:_0x52781a,Roomslist:_0x49e0b6}=_0x300353[_0x33e766(0x21f)],_0x5ae541=_0x49e0b6[_0x33e766(0x1d4)](','),_0x1bf164=[];async function _0x192d8d(_0x210526){var _0x1d39ce=_0x33e766;const _0x1401a0=await warehouse[_0x1d39ce(0x1b7)]([{'$match':{'name':_0x25e9c,'room':_0x210526}},{'$unwind':_0x1d39ce(0x210)},{'$match':{'product_details.primary_code':_0x759b88}},{'$group':{'_id':_0x1d39ce(0x220),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1d39ce(0x2b6)},'primary_code':{'$first':_0x1d39ce(0x25d)},'secondary_code':{'$first':_0x1d39ce(0x23c)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1d39ce(0x212)},'pallet':{'$first':_0x1d39ce(0x2b2)},'unit':{'$first':_0x1d39ce(0x1dd)},'secondary_unit':{'$first':_0x1d39ce(0x268)},'storage':{'$first':_0x1d39ce(0x20b)},'rack':{'$first':_0x1d39ce(0x269)},'expiry_date':{'$first':_0x1d39ce(0x29a)},'production_date':{'$first':_0x1d39ce(0x21c)},'maxPerUnit':{'$first':_0x1d39ce(0x273)},'batch_code':{'$first':_0x1d39ce(0x20c)},'product_cat':{'$first':_0x1d39ce(0x1f3)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1d39ce(0x229)},'invoice':{'$first':_0x1d39ce(0x240)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x1d39ce(0x2b4)}}}]),_0x565b98=await warehouse['aggregate']([{'$match':{'name':_0x25e9c,'room':_0x210526}},{'$unwind':_0x1d39ce(0x210)},{'$match':{'product_details.secondary_code':_0x759b88}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1d39ce(0x216)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1d39ce(0x25d)},'secondary_code':{'$first':_0x1d39ce(0x23c)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1d39ce(0x21e)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1d39ce(0x212)},'pallet':{'$first':_0x1d39ce(0x2b2)},'unit':{'$first':_0x1d39ce(0x1dd)},'secondary_unit':{'$first':_0x1d39ce(0x268)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1d39ce(0x21c)},'maxPerUnit':{'$first':_0x1d39ce(0x273)},'batch_code':{'$first':_0x1d39ce(0x20c)},'product_cat':{'$first':_0x1d39ce(0x1f3)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1d39ce(0x229)},'invoice':{'$first':_0x1d39ce(0x240)}}}]);if(_0x1401a0[_0x1d39ce(0x1c1)]>0x0)_0x1bf164[_0x1d39ce(0x285)](_0x1401a0);else _0x565b98[_0x1d39ce(0x1c1)]>0x0&&_0x1bf164[_0x1d39ce(0x285)](_0x565b98);}const _0x2529b9=_0x5ae541[_0x33e766(0x1b9)](_0x5556fe=>_0x192d8d(_0x5556fe));await Promise['all'](_0x2529b9),_0x320802[_0x33e766(0x2a4)](_0x1bf164);}),module[a0_0x31cebd(0x209)]=router;