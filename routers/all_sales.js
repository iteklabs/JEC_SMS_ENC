function a0_0x1055(_0x2957de,_0x167dd3){var _0x26659e=a0_0x2665();return a0_0x1055=function(_0x105571,_0x3f1368){_0x105571=_0x105571-0xb2;var _0x55f89b=_0x26659e[_0x105571];return _0x55f89b;},a0_0x1055(_0x2957de,_0x167dd3);}var a0_0x942bf9=a0_0x1055;(function(_0x4674c8,_0x57d8cb){var _0x309895=a0_0x1055,_0x70ffb3=_0x4674c8();while(!![]){try{var _0x375915=parseInt(_0x309895(0x124))/0x1+parseInt(_0x309895(0x1ab))/0x2+-parseInt(_0x309895(0x1b6))/0x3*(-parseInt(_0x309895(0xcb))/0x4)+-parseInt(_0x309895(0x148))/0x5*(parseInt(_0x309895(0xbd))/0x6)+parseInt(_0x309895(0x137))/0x7*(parseInt(_0x309895(0xc9))/0x8)+parseInt(_0x309895(0x173))/0x9*(parseInt(_0x309895(0xbf))/0xa)+-parseInt(_0x309895(0x13c))/0xb;if(_0x375915===_0x57d8cb)break;else _0x70ffb3['push'](_0x70ffb3['shift']());}catch(_0xac09d4){_0x70ffb3['push'](_0x70ffb3['shift']());}}}(a0_0x2665,0xed17a));const express=require(a0_0x942bf9(0x11e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x942bf9(0x1a6)),auth=require(a0_0x942bf9(0xe8)),nodemailer=require(a0_0x942bf9(0x18d)),users=require(a0_0x942bf9(0x160));function a0_0x2665(){var _0x5398c3=['return_sale','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','French','isAllowEdit','$product_details.product_code','finalize','/preview/:id','/../public','findById','port','user','<h5>','Portuguese\x20(BR)','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','English\x20(US)','find','6pAhMAF','German','31330DxNSLd','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','secondary_code','$warehouse_name','\x20</h2>','map','<div>','customers_docs','abs','push','16eXGeTG','json','124240lIedlT','filter','floorlevel','room','$product_details.isle','amount','body','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$sale_product.floorlevel','$product_details.secondary_unit','$product_details.expiry_date','\x20Order\x20Date\x20:\x20','$customer','sales\x20item\x20return\x20successfull','findOne','rack','requested_qty','Arabic','name','error','bin','/view/return_sales/:id','errors','primary_unit','catch','Floor','$product_details.production_date','batch_code','level','../middleware/auth','product_data','Ambient','return_data','get','$name','/all_sales/view','$finalize','warehouse','barcode\x20user_id','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/upload/','$sale_product.quantity','<tbody\x20style=\x22text-align:\x20center;\x22>','Enabled','customer','params','forEach','flash','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$sale_product.bin','$product_details.rack','Arabic\x20(ae)','$isAllowEdit','</body></html>','Sales\x20Add\x20successfully','product','</head><body>','$product','/invoice/:id','/barcode_scanner','types','getFullYear','invoice','product_code','site_title','Error\x20Occurs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','$product_details.storage','master','Chinese','add_sales','/view/add_sales/:id','</tr>','email','<html><head><title></title>','Hindi','$product_details._id','customer_data','delivery_code','_id','express','Return\x20Goods','delivery_date','$sale_product','warehouse_name','SCRN','459990AceGDO','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_invoice','$_id','id_transaction_from','$product_details.bay','slice','sales\x20all_data','log','primary_code','purchases_data','Sale\x20Return\x20Mail','Logo.png','foreach\x20newproduct','Receiving\x20Area','<tr>','False','</thead>','$sale_product.type','6497407ruDfKG','OUT-','split','bay','$product_details.secondary_code','51524572RpjKMs','$product_details.bin','stocks','currency','gmail','then','Sale\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<h2>\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','2410615qudVQm','storage','maxperunit','return_qty','logo','</div>','True','/barcode/:id','product_details','edit_sales_view','stock','$product_details.invoice','/view/add_sales','secondary_unit','$date','$product.product_name','</span>','product_stock','$product_details.primary_code','$product_details.actual_qty','post','status','</tbody>','$product_details','../public/language/languages.json','redirect','image','sale_product','getMonth','$product_details.maxPerUnit','add\x20post','id_transact','product_name','expiry_date','language','edit_sales','room_name','staff','</td>','actual_qty','/view/add_sale/product','actual_uom','stock_data','4032thLYpj','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','customers','Shelves','unit','Portuguese','all','sendMail','RMSEmail','Sales\x20Update\x20successfully','Enclosed','toString','max_per_unit','English','type','$return_data','$note','production_date','/all_sales/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','prod_cat','sale_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','message','$product_details.batch_code','quantity','nodemailer','success','$product_details.product_stock','</h5>','<hr\x20class=\x22my-3\x22>','carton','aggregate','<span\x20style=\x22float:\x20right;\x22>','$product_details.type','$customers_docs','$product_details.unit','render','role','$product_details.level','RoomAssigned','save','prod_code','concat','<strong>\x20Regards\x20</strong>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','An\x20error\x20occurred.','Spanish','$product_details.floorlevel','received_amount','date','../models/all_models','/view/:id','</table>','/view','quantity_notConverted','2660458tYHIRE','payment\x20successfull','length','back','Raw\x20Materials','$invoice','Email\x20sent\x20successfully','/give_payment/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','note','\x20Order\x20Number\x20:\x20','105jDEvMh','string'];a0_0x2665=function(){return _0x5398c3;};return a0_0x2665();}router[a0_0x942bf9(0xec)](a0_0x942bf9(0x1a9),auth,async(_0x5178d1,_0x850617)=>{var _0x2bfea5=a0_0x942bf9;try{const {username:_0x48a2ea,email:_0x10ed01,role:_0x50673d}=_0x5178d1['user'],_0x1a6f9a=_0x5178d1[_0x2bfea5(0xb7)],_0x2ef82d=await profile[_0x2bfea5(0xd9)]({'email':_0x1a6f9a[_0x2bfea5(0x117)]}),_0x58f09f=await master_shop[_0x2bfea5(0xbc)]();let _0x15294f;if(_0x1a6f9a[_0x2bfea5(0x199)]==_0x2bfea5(0x16d)){const _0x4f249b=await staff[_0x2bfea5(0xd9)]({'email':_0x1a6f9a[_0x2bfea5(0x117)]});_0x15294f=await sales[_0x2bfea5(0x193)]([{'$lookup':{'from':_0x2bfea5(0x175),'localField':'customer','foreignField':_0x2bfea5(0xdd),'as':'customers_docs'}},{'$unwind':_0x2bfea5(0x196)},{'$unwind':_0x2bfea5(0x121)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x2bfea5(0xd7)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2bfea5(0xc2)},'sale_product':{'$push':_0x2bfea5(0x121)},'note':{'$first':_0x2bfea5(0x183)},'return_data':{'$first':_0x2bfea5(0x182)},'customers_docs':{'$first':_0x2bfea5(0x196)},'total_saleproduct_quantity':{'$sum':_0x2bfea5(0xf5)},'level':{'$addToSet':_0x2bfea5(0x144)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2bfea5(0x136)},'pallet':{'$addToSet':_0x2bfea5(0xd3)},'finalize':{'$first':_0x2bfea5(0xef)},'isAllowEdit':{'$first':_0x2bfea5(0x101)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x15294f=await sales['aggregate']([{'$lookup':{'from':_0x2bfea5(0x175),'localField':_0x2bfea5(0xf8),'foreignField':_0x2bfea5(0xdd),'as':_0x2bfea5(0xc6)}},{'$unwind':'$customers_docs'},{'$unwind':_0x2bfea5(0x121)},{'$group':{'_id':_0x2bfea5(0x127),'invoice':{'$first':_0x2bfea5(0x1b0)},'customers':{'$first':_0x2bfea5(0xd7)},'date':{'$first':_0x2bfea5(0x156)},'warehouse_name':{'$first':_0x2bfea5(0xc2)},'sale_product':{'$push':_0x2bfea5(0x121)},'note':{'$first':_0x2bfea5(0x183)},'return_data':{'$first':_0x2bfea5(0x182)},'customers_docs':{'$first':_0x2bfea5(0x196)},'total_saleproduct_quantity':{'$sum':_0x2bfea5(0xf5)},'level':{'$addToSet':_0x2bfea5(0x144)},'isle':{'$addToSet':_0x2bfea5(0xfe)},'type':{'$addToSet':_0x2bfea5(0x136)},'pallet':{'$addToSet':_0x2bfea5(0xd3)},'finalize':{'$first':_0x2bfea5(0xef)},'isAllowEdit':{'$first':_0x2bfea5(0x101)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x2bfea5(0x12b),_0x15294f);if(_0x58f09f[0x0][_0x2bfea5(0x16a)]==_0x2bfea5(0xbb)){var _0x39555a=users[_0x2bfea5(0x180)];console[_0x2bfea5(0x12c)](_0x39555a);}else{if(_0x58f09f[0x0][_0x2bfea5(0x16a)]=='Hindi')var _0x39555a=users['Hindi'];else{if(_0x58f09f[0x0][_0x2bfea5(0x16a)]==_0x2bfea5(0xbe))var _0x39555a=users[_0x2bfea5(0xbe)];else{if(_0x58f09f[0x0][_0x2bfea5(0x16a)]=='Spanish')var _0x39555a=users['Spanish'];else{if(_0x58f09f[0x0][_0x2bfea5(0x16a)]==_0x2bfea5(0x1bb))var _0x39555a=users[_0x2bfea5(0x1bb)];else{if(_0x58f09f[0x0][_0x2bfea5(0x16a)]==_0x2bfea5(0xb9))var _0x39555a=users[_0x2bfea5(0x178)];else{if(_0x58f09f[0x0]['language']==_0x2bfea5(0x113))var _0x39555a=users[_0x2bfea5(0x113)];else{if(_0x58f09f[0x0][_0x2bfea5(0x16a)]==_0x2bfea5(0x100))var _0x39555a=users['Arabic'];}}}}}}}_0x850617[_0x2bfea5(0x198)]('all_sales',{'success':_0x5178d1['flash'](_0x2bfea5(0x18e)),'errors':_0x5178d1[_0x2bfea5(0xfb)](_0x2bfea5(0xe1)),'sales':_0x15294f,'profile':_0x2ef82d,'role':_0x1a6f9a,'master_shop':_0x58f09f,'language':_0x39555a});}catch(_0x27fefb){console[_0x2bfea5(0x12c)](_0x27fefb);}});async function getRandom8DigitNumber(){var _0x23ea2a=a0_0x942bf9;const _0x19a1de=0x989680,_0x4af66a=0x5f5e0ff,_0x5ecc26=Math['floor'](Math['random']()*(_0x4af66a-_0x19a1de+0x1))+_0x19a1de;var _0x2369c3;const _0x15595b=await sales[_0x23ea2a(0xd9)]({'invoice':_0x23ea2a(0x138)+_0x5ecc26});return _0x15595b&&_0x15595b[_0x23ea2a(0x1ad)]>0x0?_0x2369c3=_0x23ea2a(0x138)+_0x5ecc26:_0x2369c3=_0x23ea2a(0x138)+_0x5ecc26,_0x2369c3;}router[a0_0x942bf9(0xec)](a0_0x942bf9(0x154),auth,async(_0x114c15,_0x44776e)=>{var _0x2447c8=a0_0x942bf9;try{const {username:_0x2e0cc1,email:_0x57729d,role:_0xfa637b}=_0x114c15[_0x2447c8(0xb7)],_0x51d74b=_0x114c15[_0x2447c8(0xb7)],_0x10c748=await profile[_0x2447c8(0xd9)]({'email':_0x51d74b[_0x2447c8(0x117)]}),_0x1b335f=await master_shop[_0x2447c8(0xbc)](),_0x72c504=await customer[_0x2447c8(0xbc)]({});let _0x51ec2c;if(_0x51d74b['role']==_0x2447c8(0x16d)){const _0x3ae76a=await staff['findOne']({'email':_0x51d74b['email']});_0x51ec2c=await warehouse[_0x2447c8(0x193)]([{'$match':{'status':_0x2447c8(0xf7),'name':_0x3ae76a[_0x2447c8(0xf0)],'warehouse_category':_0x2447c8(0x1af),'name':{'$ne':_0x2447c8(0x11f)}}},{'$group':{'_id':_0x2447c8(0xed),'name':{'$first':_0x2447c8(0xed)}}},{'$sort':{'name':0x1}}]);}else _0x51ec2c=await warehouse[_0x2447c8(0x193)]([{'$match':{'status':_0x2447c8(0xf7),'warehouse_category':_0x2447c8(0x1af),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2447c8(0xed),'name':{'$first':_0x2447c8(0xed)}}},{'$sort':{'name':0x1}}]);const _0x50ab6b=await product[_0x2447c8(0xbc)]({});var _0x26e008=[_0x2447c8(0xea),'Enclosed'];const _0x5397e2=await sales['find']({}),_0x5b60f2=_0x5397e2['length']+0x1,_0x4d90bb='OUT-'+_0x5b60f2[_0x2447c8(0x17e)]()['padStart'](0x5,'0');if(_0x1b335f[0x0][_0x2447c8(0x16a)]==_0x2447c8(0xbb)){var _0x263a41=users[_0x2447c8(0x180)];console[_0x2447c8(0x12c)](_0x263a41);}else{if(_0x1b335f[0x0][_0x2447c8(0x16a)]==_0x2447c8(0x119))var _0x263a41=users[_0x2447c8(0x119)];else{if(_0x1b335f[0x0][_0x2447c8(0x16a)]=='German')var _0x263a41=users['German'];else{if(_0x1b335f[0x0][_0x2447c8(0x16a)]==_0x2447c8(0x1a2))var _0x263a41=users['Spanish'];else{if(_0x1b335f[0x0][_0x2447c8(0x16a)]==_0x2447c8(0x1bb))var _0x263a41=users['French'];else{if(_0x1b335f[0x0][_0x2447c8(0x16a)]==_0x2447c8(0xb9))var _0x263a41=users[_0x2447c8(0x178)];else{if(_0x1b335f[0x0][_0x2447c8(0x16a)]==_0x2447c8(0x113))var _0x263a41=users[_0x2447c8(0x113)];else{if(_0x1b335f[0x0]['language']=='Arabic\x20(ae)')var _0x263a41=users['Arabic'];}}}}}}}const _0x2ebc4d=getRandom8DigitNumber();_0x2ebc4d[_0x2447c8(0x141)](_0x4ebea6=>{var _0x2dcb5b=_0x2447c8;_0x44776e[_0x2dcb5b(0x198)](_0x2dcb5b(0x114),{'success':_0x114c15[_0x2dcb5b(0xfb)](_0x2dcb5b(0x18e)),'errors':_0x114c15[_0x2dcb5b(0xfb)]('errors'),'role':_0x51d74b,'profile':_0x10c748,'customer':_0x72c504,'warehouse':_0x51ec2c,'product':_0x50ab6b,'invoice':_0x4ebea6,'master_shop':_0x1b335f,'language':_0x263a41,'rooms_data':_0x26e008});})[_0x2447c8(0xe3)](_0x3c494d=>{var _0x1689cd=_0x2447c8;_0x114c15[_0x1689cd(0xfb)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x44776e[_0x1689cd(0x161)]('/all_sales/view');});}catch(_0x4f9376){console[_0x2447c8(0x12c)](_0x4f9376);}}),router[a0_0x942bf9(0xec)](a0_0x942bf9(0x115),auth,async(_0x425eb4,_0x56c0cd)=>{var _0x331bd6=a0_0x942bf9;try{const _0xcea792=_0x425eb4['params']['id'];console[_0x331bd6(0x12c)](_0xcea792);const _0x3deaac=await product[_0x331bd6(0xbc)](),_0x1d16df=await purchases[_0x331bd6(0x193)]([{'$match':{'warehouse_name':_0xcea792}},{'$unwind':_0x331bd6(0x106)},{'$group':{'_id':_0x331bd6(0x157)}}]);console[_0x331bd6(0x12c)](_0x331bd6(0x12e),_0x1d16df),_0x56c0cd[_0x331bd6(0x15d)](0xc8)[_0x331bd6(0xca)]({'purchases_data':_0x1d16df,'product_data':_0x3deaac});}catch(_0x51cd35){console['log'](_0x51cd35);}}),router[a0_0x942bf9(0x15c)](a0_0x942bf9(0x170),auth,async(_0x314ebc,_0x1890ed)=>{var _0x580da4=a0_0x942bf9;try{const {warehouse_data:_0x45324f,product_data:_0x2db093}=_0x314ebc[_0x580da4(0xd1)];console[_0x580da4(0x12c)](_0x314ebc[_0x580da4(0xd1)][_0x580da4(0xe9)]);;const _0x16717b=await master_shop['find']();console['log'](_0x580da4(0x112),_0x16717b);const _0xe9ec7d=await product[_0x580da4(0xd9)]({'name':_0x2db093});console[_0x580da4(0x12c)](_0x580da4(0x104),_0xe9ec7d);const _0x5a651a=await warehouse[_0x580da4(0x193)]([{'$match':{'name':_0x45324f}},{'$unwind':_0x580da4(0x15f)},{'$match':{'product_details.product_name':_0x2db093}},{'$group':{'_id':_0x580da4(0x110),'product_stock':{'$first':_0x580da4(0x18f)}}}]);console[_0x580da4(0x12c)](_0x580da4(0x172),_0x5a651a),_0x1890ed[_0x580da4(0x15d)](0xc8)[_0x580da4(0xca)]({'master':_0x16717b,'new_product':_0xe9ec7d,'stock_data':_0x5a651a});}catch(_0x41deec){console['log'](_0x41deec);}}),router[a0_0x942bf9(0x15c)](a0_0x942bf9(0x154),auth,async(_0xed9826,_0x595387)=>{var _0x5d69d3=a0_0x942bf9;try{const {invoice:_0x547e13,date:_0x5a711e,warehouse_name:_0x107fda,product_name:_0x500f5e,stock:_0x558ced,quantity:_0x86be16,note:_0x51f0ff,room:_0x44bcfa,primary_code:_0x371cde,secondary_code:_0x316158,prod_code:_0xaea8ca,level:_0x1415f8,isle:_0x1cdd5f,pallet:_0x59c091,batch_code:_0xae6ccd,SCRN:_0x2feaee,expiry_date:_0x3ef67b}=_0xed9826['body'];if(typeof _0x500f5e==_0x5d69d3(0x1b7))var _0x33f44e=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x168)]],_0x3fc5d6=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x152)]],_0x5902d8=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x192)]],_0x62475e=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x12d)]],_0x1bcd65=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xc1)]],_0x30bec7=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x19d)]],_0x31d867=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xe7)]],_0x143521=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xe2)]],_0x5362eb=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x155)]],_0x3b2f6c=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xe6)]],_0x546d65=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x169)]],_0x586548=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x17f)]],_0x1efe54=[_0xed9826['body'][_0x5d69d3(0x184)]],_0xba59a4=[_0xed9826['body']['requested_qty']],_0x3096f9=[_0xed9826[_0x5d69d3(0xd1)]['delivery_date']],_0x571b07=[_0xed9826['body'][_0x5d69d3(0x11c)]],_0x1f9639=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x187)]],_0xb8f70a=[_0xed9826[_0x5d69d3(0xd1)]['quantity']],_0x15c950=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x19b)]],_0x5353a2=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x126)]],_0x4f6def=[_0xed9826[_0x5d69d3(0xd1)]['actual_qty']],_0x4f2854=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x171)]],_0x2dc97d=[_0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x167)]];else var _0x33f44e=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x168)]],_0x3fc5d6=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x152)]],_0x5902d8=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x192)]],_0x62475e=[..._0xed9826['body']['primary_code']],_0x1bcd65=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xc1)]],_0x30bec7=[..._0xed9826[_0x5d69d3(0xd1)]['prod_code']],_0x31d867=[..._0xed9826[_0x5d69d3(0xd1)]['level']],_0x143521=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xe2)]],_0x5362eb=[..._0xed9826['body']['secondary_unit']],_0x3b2f6c=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0xe6)]],_0x546d65=[..._0xed9826['body'][_0x5d69d3(0x169)]],_0x586548=[..._0xed9826['body'][_0x5d69d3(0x17f)]],_0x1efe54=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x184)]],_0xba59a4=[..._0xed9826['body'][_0x5d69d3(0xdb)]],_0x3096f9=[..._0xed9826[_0x5d69d3(0xd1)]['delivery_date']],_0x571b07=[..._0xed9826['body']['delivery_code']],_0x1f9639=[..._0xed9826[_0x5d69d3(0xd1)]['prod_cat']],_0xb8f70a=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x18c)]],_0x15c950=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x19b)]],_0x5353a2=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x126)]],_0x4f6def=[..._0xed9826['body'][_0x5d69d3(0x16f)]],_0x4f2854=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x171)]],_0x2dc97d=[..._0xed9826[_0x5d69d3(0xd1)][_0x5d69d3(0x167)]];const _0x21a47a=_0x33f44e[_0x5d69d3(0xc4)](_0x40ed69=>{return _0x40ed69={'product_name':_0x40ed69};});_0x3fc5d6['forEach']((_0x5061f2,_0x3e1a1f)=>{var _0xcbda81=_0x5d69d3;_0x21a47a[_0x3e1a1f][_0xcbda81(0x152)]=Math['abs'](_0x5061f2);}),_0x4f6def[_0x5d69d3(0xfa)]((_0x3571d8,_0x26012a)=>{var _0x4df5b3=_0x5d69d3;_0x21a47a[_0x26012a]['actual_qty']=Math[_0x4df5b3(0xc7)](_0x3571d8);}),_0x4f2854['forEach']((_0x5ca2af,_0x3987ef)=>{_0x21a47a[_0x3987ef]['actual_uom']=_0x5ca2af;}),_0x2dc97d[_0x5d69d3(0xfa)]((_0x4273d0,_0x3c9031)=>{var _0x5ddb76=_0x5d69d3;_0x21a47a[_0x3c9031][_0x5ddb76(0x128)]=_0x4273d0;}),_0x5902d8['forEach']((_0x566506,_0x273e50)=>{_0x21a47a[_0x273e50]['quantity']=_0x566506;}),_0x62475e['forEach']((_0x322d6d,_0x19eae1)=>{var _0xf70792=_0x5d69d3;_0x21a47a[_0x19eae1][_0xf70792(0x12d)]=_0x322d6d;}),_0x1bcd65[_0x5d69d3(0xfa)]((_0x379cc7,_0x50e453)=>{_0x21a47a[_0x50e453]['secondary_code']=_0x379cc7;}),_0x30bec7['forEach']((_0x44c858,_0x52580c)=>{var _0x29b798=_0x5d69d3;_0x21a47a[_0x52580c][_0x29b798(0x10c)]=_0x44c858;}),_0x31d867[_0x5d69d3(0xfa)]((_0xb56a9a,_0x5d00e8)=>{var _0x1e98e1=_0x5d69d3;_0x15c950[_0x1e98e1(0xfa)]((_0x30b7a0,_0x4f0dc9)=>{var _0x547b39=_0x1e98e1;if(_0x30b7a0==_0x547b39(0x132)&&_0x5d00e8==_0x4f0dc9){var _0x3d33be=_0xb56a9a[_0x547b39(0x12a)](0x3);_0x21a47a[_0x5d00e8]['storage']=_0xb56a9a[0x0],_0x21a47a[_0x5d00e8][_0x547b39(0xda)]=_0xb56a9a[0x1],_0x21a47a[_0x5d00e8][_0x547b39(0x13a)]=0x0,_0x21a47a[_0x5d00e8][_0x547b39(0xdf)]=0x0,_0x21a47a[_0x5d00e8][_0x547b39(0x181)]='Floor',_0x21a47a[_0x5d00e8][_0x547b39(0xcd)]=_0x3d33be;}else{if(_0x30b7a0==_0x547b39(0x176)&&_0x5d00e8==_0x4f0dc9){var _0x3d33be=_0xb56a9a['slice'](0x3);_0x21a47a[_0x5d00e8]['storage']=_0xb56a9a[0x0],_0x21a47a[_0x5d00e8][_0x547b39(0xda)]=_0xb56a9a[0x1],_0x21a47a[_0x5d00e8][_0x547b39(0x13a)]=0x0,_0x21a47a[_0x5d00e8][_0x547b39(0xdf)]=0x0,_0x21a47a[_0x5d00e8][_0x547b39(0x181)]=_0x547b39(0xe4),_0x21a47a[_0x5d00e8][_0x547b39(0xcd)]=_0xb56a9a[0x5];}else{if(_0x5d00e8==_0x4f0dc9){var _0x3d3107;if(_0xb56a9a[0x4]=='L')_0x3d3107='Level';else _0xb56a9a[0x4]=='F'&&(_0x3d3107='Floor');_0x21a47a[_0x5d00e8][_0x547b39(0x149)]=_0xb56a9a[0x0],_0x21a47a[_0x5d00e8]['rack']=_0xb56a9a[0x1],_0x21a47a[_0x5d00e8][_0x547b39(0x13a)]=_0xb56a9a[0x2],_0x21a47a[_0x5d00e8]['bin']=_0xb56a9a[0x3],_0x21a47a[_0x5d00e8][_0x547b39(0x181)]=_0x3d3107,_0x21a47a[_0x5d00e8]['floorlevel']=_0xb56a9a[0x5];}}}});}),_0x143521[_0x5d69d3(0xfa)]((_0x216d8a,_0x19cd0d)=>{var _0x69b183=_0x5d69d3;_0x21a47a[_0x19cd0d][_0x69b183(0x177)]=_0x216d8a;}),_0x5362eb['forEach']((_0x15b283,_0x1204b2)=>{var _0x1049f5=_0x5d69d3;_0x21a47a[_0x1204b2][_0x1049f5(0x155)]=_0x15b283;}),_0x3b2f6c[_0x5d69d3(0xfa)]((_0x4ee033,_0x2c1681)=>{_0x21a47a[_0x2c1681]['batch_code']=_0x4ee033;}),_0x546d65['forEach']((_0x49c024,_0x3770ce)=>{_0x21a47a[_0x3770ce]['expiry_date']=_0x49c024;}),_0x586548[_0x5d69d3(0xfa)]((_0x143cdd,_0xc4224b)=>{_0x21a47a[_0xc4224b]['maxperunit']=_0x143cdd;}),_0x1efe54[_0x5d69d3(0xfa)]((_0x26f782,_0x4cff83)=>{var _0x4972ca=_0x5d69d3;_0x21a47a[_0x4cff83][_0x4972ca(0x184)]=_0x26f782;}),_0xba59a4[_0x5d69d3(0xfa)]((_0x5451d3,_0x1d6d31)=>{var _0x1e2435=_0x5d69d3;_0x21a47a[_0x1d6d31][_0x1e2435(0xdb)]=_0x5451d3;}),_0x3096f9[_0x5d69d3(0xfa)]((_0x194ce7,_0x4ce763)=>{_0x21a47a[_0x4ce763]['delivery_date']=_0x194ce7;}),_0x571b07['forEach']((_0x1ea475,_0x7cd548)=>{var _0x2e59e9=_0x5d69d3;_0x21a47a[_0x7cd548][_0x2e59e9(0x11c)]=_0x1ea475;}),_0x1f9639[_0x5d69d3(0xfa)]((_0x3ee758,_0x49bded)=>{var _0xfd27de=_0x5d69d3;_0x21a47a[_0x49bded][_0xfd27de(0x187)]=_0x3ee758;}),_0xb8f70a[_0x5d69d3(0xfa)]((_0x132462,_0x3f1eb5)=>{var _0xde7adb=_0x5d69d3;_0x21a47a[_0x3f1eb5][_0xde7adb(0x1aa)]=_0x132462;}),_0x15c950['forEach']((_0x84184d,_0x26dfab)=>{var _0x322973=_0x5d69d3;_0x21a47a[_0x26dfab][_0x322973(0x16c)]=_0x84184d;}),_0x5353a2[_0x5d69d3(0xfa)]((_0x53cf9f,_0x36300c)=>{var _0xac530=_0x5d69d3;_0x21a47a[_0x36300c][_0xac530(0x10b)]=_0x53cf9f;});var _0x1652b4=0x0;_0x21a47a[_0x5d69d3(0xfa)](_0x3da17c=>{var _0x2c6854=_0x5d69d3;(_0x3da17c[_0x2c6854(0x152)]<_0x3da17c['quantity_notConverted']||_0x3da17c[_0x2c6854(0x1aa)]==0x0)&&(console[_0x2c6854(0x12c)](_0x2c6854(0x131),_0x3da17c),_0x1652b4++);});const _0x1c42c0=_0x21a47a[_0x5d69d3(0xcc)](_0x31a399=>_0x31a399['quantity']!=='0'&&_0x31a399['quantity']!==''),_0x2b87d7=new sales({'invoice':_0x547e13,'customer':_0xed9826[_0x5d69d3(0xd1)]['customer'],'date':_0x5a711e,'warehouse_name':_0x107fda,'sale_product':_0x1c42c0,'note':_0x51f0ff,'room':_0x44bcfa,'primary_code':_0x371cde,'secondary_code':_0x316158,'prod_code':_0xaea8ca,'SCRN':_0x2feaee}),_0x492248=await _0x2b87d7['save']();_0xed9826[_0x5d69d3(0xfb)](_0x5d69d3(0x18e),_0x5d69d3(0x103)),_0x595387[_0x5d69d3(0x161)](_0x5d69d3(0x185)+_0x492248['_id']);}catch(_0x5d0614){console[_0x5d69d3(0x12c)](_0x5d0614);}}),router[a0_0x942bf9(0xec)](a0_0x942bf9(0xb3),auth,async(_0x76131d,_0x37566e)=>{var _0xb2e465=a0_0x942bf9;try{const {username:_0x41fa9c,email:_0x1170a2,role:_0x3368f9}=_0x76131d[_0xb2e465(0xb7)],_0x3b3f16=_0x76131d[_0xb2e465(0xb7)],_0xe05ba2=await profile[_0xb2e465(0xd9)]({'email':_0x3b3f16['email']}),_0x3c65a6=await master_shop['find'](),_0x251041=_0x76131d[_0xb2e465(0xf9)]['id'],_0x41a750=await sales['findById'](_0x251041),_0x332f74=await warehouse['aggregate']([{'$match':{'name':_0x41a750[_0xb2e465(0x122)]}},{'$unwind':_0xb2e465(0x15f)},{'$group':{'_id':_0xb2e465(0x11a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xb2e465(0x13d)},'type':{'$first':_0xb2e465(0x195)},'floorlevel':{'$first':_0xb2e465(0x1a3)},'primary_code':{'$first':_0xb2e465(0x15a)},'secondary_code':{'$first':_0xb2e465(0x13b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xb2e465(0x111)},'rack':{'$first':_0xb2e465(0xff)},'expiry_date':{'$first':_0xb2e465(0xd5)},'production_date':{'$first':_0xb2e465(0xe5)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x26f022=await customer[_0xb2e465(0xbc)]({});let _0x28ee69;if(_0x3b3f16['role']=='staff'){const _0x1f8cc5=await staff['findOne']({'email':_0x3b3f16[_0xb2e465(0x117)]});_0x28ee69=await warehouse['aggregate']([{'$match':{'status':_0xb2e465(0xf7),'name':_0x1f8cc5[_0xb2e465(0xf0)]}},{'$group':{'_id':_0xb2e465(0xed),'name':{'$first':_0xb2e465(0xed)}}}]);}else _0x28ee69=await warehouse[_0xb2e465(0x193)]([{'$match':{'status':_0xb2e465(0xf7)}},{'$group':{'_id':_0xb2e465(0xed),'name':{'$first':'$name'}}}]);const _0x4be1e1=await product[_0xb2e465(0xbc)]({}),_0x3e623d=await suppliers[_0xb2e465(0xbc)]({});if(_0x3c65a6[0x0][_0xb2e465(0x16a)]=='English\x20(US)'){var _0x19ea74=users[_0xb2e465(0x180)];console[_0xb2e465(0x12c)](_0x19ea74);}else{if(_0x3c65a6[0x0][_0xb2e465(0x16a)]==_0xb2e465(0x119))var _0x19ea74=users[_0xb2e465(0x119)];else{if(_0x3c65a6[0x0][_0xb2e465(0x16a)]==_0xb2e465(0xbe))var _0x19ea74=users[_0xb2e465(0xbe)];else{if(_0x3c65a6[0x0][_0xb2e465(0x16a)]==_0xb2e465(0x1a2))var _0x19ea74=users['Spanish'];else{if(_0x3c65a6[0x0][_0xb2e465(0x16a)]==_0xb2e465(0x1bb))var _0x19ea74=users[_0xb2e465(0x1bb)];else{if(_0x3c65a6[0x0]['language']==_0xb2e465(0xb9))var _0x19ea74=users[_0xb2e465(0x178)];else{if(_0x3c65a6[0x0][_0xb2e465(0x16a)]==_0xb2e465(0x113))var _0x19ea74=users['Chinese'];else{if(_0x3c65a6[0x0]['language']==_0xb2e465(0x100))var _0x19ea74=users['Arabic'];}}}}}}}_0x37566e[_0xb2e465(0x198)](_0xb2e465(0x151),{'success':_0x76131d[_0xb2e465(0xfb)](_0xb2e465(0x18e)),'errors':_0x76131d[_0xb2e465(0xfb)]('errors'),'role':_0x3b3f16,'profile':_0xe05ba2,'customer':_0x26f022,'warehouse':_0x28ee69,'product':_0x332f74,'user':_0x41a750,'master_shop':_0x3c65a6,'unit':_0x4be1e1,'language':_0x19ea74,'suppliers':_0x3e623d});}catch(_0x1c0c4c){console[_0xb2e465(0x12c)](_0x1c0c4c);}}),router['post'](a0_0x942bf9(0xb3),auth,async(_0x1f611f,_0x27b3fe)=>{var _0x43b451=a0_0x942bf9;try{const _0x31d20c=_0x1f611f[_0x43b451(0xf9)]['id'],{invoice:_0x2001fc,warehouse_name:_0x22c1f4,room:_0x59dda8}=_0x1f611f[_0x43b451(0xd1)],_0x276464=await sales[_0x43b451(0xd9)]({'invoice':_0x2001fc}),_0x53df17=_0x276464[_0x43b451(0x163)][_0x43b451(0xc4)](async _0x5b00cc=>{var _0x5c0243=_0x43b451,_0x24e9a3=await warehouse[_0x5c0243(0xd9)]({'name':_0x22c1f4,'room':_0x5b00cc['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x462dcb=_0x24e9a3['product_details']['map'](_0x8c428e=>{var _0x1ff2d6=_0x5c0243;_0x8c428e[_0x1ff2d6(0x168)]==_0x5b00cc[_0x1ff2d6(0x168)]&&_0x8c428e[_0x1ff2d6(0xcd)]==_0x5b00cc[_0x1ff2d6(0xcd)]&&_0x8c428e['type']==_0x5b00cc[_0x1ff2d6(0x181)]&&_0x8c428e['bin']==_0x5b00cc[_0x1ff2d6(0xdf)]&&_0x8c428e[_0x1ff2d6(0x13a)]==_0x5b00cc['bay']&&_0x8c428e['rack']==_0x5b00cc[_0x1ff2d6(0xda)]&&_0x8c428e[_0x1ff2d6(0x149)]==_0x5b00cc[_0x1ff2d6(0x149)]&&_0x8c428e[_0x1ff2d6(0x169)]==_0x5b00cc['expiry_date']&&_0x8c428e[_0x1ff2d6(0xe6)]==_0x5b00cc[_0x1ff2d6(0xe6)]&&_0x8c428e[_0x1ff2d6(0x10b)]==_0x5b00cc[_0x1ff2d6(0x10b)]&&_0x8c428e[_0x1ff2d6(0x11d)]==_0x5b00cc[_0x1ff2d6(0x128)]&&(_0x8c428e['product_stock']=Math['max'](0x0,Math[_0x1ff2d6(0xc7)](_0x8c428e[_0x1ff2d6(0x159)])-Math[_0x1ff2d6(0xc7)](_0x5b00cc[_0x1ff2d6(0x18c)])));});return _0x24e9a3;});Promise[_0x43b451(0x179)](_0x53df17)[_0x43b451(0x141)](async _0x2e7107=>{var _0x50e5f7=_0x43b451;try{for(const _0x57d946 of _0x2e7107){await _0x57d946[_0x50e5f7(0x19c)]();}_0x276464[_0x50e5f7(0xb2)]=_0x50e5f7(0x14e);const _0x2707cc=await _0x276464[_0x50e5f7(0x19c)](),_0x2e9a2d=await master_shop[_0x50e5f7(0xbc)](),_0x4217d1=await email_settings[_0x50e5f7(0xd9)](),_0xde01eb=await supervisor_settings['find']();var _0x11de65=_0x276464[_0x50e5f7(0x163)],_0x1a84f4='',_0x1f9424;for(_0x1f9424 in _0x11de65){_0x1a84f4+=_0x50e5f7(0x133)+_0x50e5f7(0xba)+_0x11de65[_0x1f9424][_0x50e5f7(0x168)]+_0x50e5f7(0x16e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x11de65[_0x1f9424][_0x50e5f7(0x10c)]+_0x50e5f7(0x16e)+_0x50e5f7(0xba)+_0x11de65[_0x1f9424]['quantity']+'</td>'+_0x50e5f7(0xba)+_0x11de65[_0x1f9424][_0x50e5f7(0x177)]+_0x50e5f7(0x16e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x11de65[_0x1f9424][_0x50e5f7(0x155)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x276464[_0x50e5f7(0x122)]+_0x50e5f7(0x16e)+_0x50e5f7(0xba)+_0x11de65[_0x1f9424]['room_name']+_0x50e5f7(0x16e)+_0x50e5f7(0xba)+_0x11de65[_0x1f9424][_0x50e5f7(0x149)]+_0x11de65[_0x1f9424][_0x50e5f7(0xda)]+_0x11de65[_0x1f9424][_0x50e5f7(0x13a)]+_0x11de65[_0x1f9424][_0x50e5f7(0xdf)]+_0x11de65[_0x1f9424][_0x50e5f7(0x181)][0x0]+_0x11de65[_0x1f9424]['floorlevel']+_0x50e5f7(0x16e),'</tr>';}let _0x553040=nodemailer['createTransport']({'host':_0x4217d1['host'],'port':Number(_0x4217d1[_0x50e5f7(0xb6)]),'secure':![],'auth':{'user':_0x4217d1[_0x50e5f7(0x117)],'pass':_0x4217d1['password']}}),_0x1d1c6c={'from':_0x4217d1[_0x50e5f7(0x117)],'to':_0xde01eb[0x0][_0x50e5f7(0x17b)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x50e5f7(0x130),'path':__dirname+_0x50e5f7(0xb4)+'/upload/'+_0x2e9a2d[0x0][_0x50e5f7(0x162)],'cid':'logo'}],'html':_0x50e5f7(0x1b9)+_0x50e5f7(0x118)+_0x50e5f7(0x105)+'<div>'+_0x50e5f7(0x147)+_0x50e5f7(0xc5)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x50e5f7(0x14d)+_0x50e5f7(0xc5)+'<h2>\x20'+_0x2e9a2d[0x0]['site_title']+_0x50e5f7(0xc3)+_0x50e5f7(0x14d)+'</div>'+_0x50e5f7(0x191)+_0x50e5f7(0xc5)+_0x50e5f7(0xfc)+_0x50e5f7(0x1b5)+_0x276464[_0x50e5f7(0x10b)]+'\x20'+_0x50e5f7(0x194)+_0x50e5f7(0xd6)+_0x276464[_0x50e5f7(0x1a5)]+'\x20'+_0x50e5f7(0x158)+_0x50e5f7(0x190)+_0x50e5f7(0x14d)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x50e5f7(0x10f)+_0x50e5f7(0x133)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x50e5f7(0x1ba)+_0x50e5f7(0x1b3)+_0x50e5f7(0xc0)+_0x50e5f7(0xf3)+_0x50e5f7(0xfd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x50e5f7(0x125)+'</tr>'+_0x50e5f7(0x135)+_0x50e5f7(0xf6)+'\x20'+_0x1a84f4+'\x20'+_0x50e5f7(0x15e)+_0x50e5f7(0x1a8)+_0x50e5f7(0xc5)+_0x50e5f7(0x19f)+_0x50e5f7(0xb8)+_0x2e9a2d[0x0][_0x50e5f7(0x10d)]+_0x50e5f7(0x190)+_0x50e5f7(0x14d)+_0x50e5f7(0x14d)+_0x50e5f7(0x102)};_0x553040['sendMail'](_0x1d1c6c,function(_0x5567ba,_0x419e82){var _0x1d8d42=_0x50e5f7;_0x5567ba?(console[_0x1d8d42(0x12c)](_0x5567ba),console[_0x1d8d42(0x12c)](_0x1d8d42(0x10e))):console[_0x1d8d42(0x12c)](_0x1d8d42(0x1b1));}),_0x1f611f[_0x50e5f7(0xfb)](_0x50e5f7(0x18e),_0x50e5f7(0x17c)),_0x27b3fe[_0x50e5f7(0x161)](_0x50e5f7(0x185)+_0x31d20c);}catch(_0x69fc6e){console[_0x50e5f7(0xde)](_0x69fc6e),_0x27b3fe[_0x50e5f7(0x15d)](0x1f4)[_0x50e5f7(0xca)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x43b451(0xe3)](_0x60b5f4=>{var _0x17f348=_0x43b451;console['error'](_0x60b5f4),_0x27b3fe[_0x17f348(0x15d)](0x1f4)[_0x17f348(0xca)]({'error':_0x17f348(0x1a1)});});}catch(_0x2431da){console[_0x43b451(0x12c)](_0x2431da);}}),router['get'](a0_0x942bf9(0x1a7),auth,async(_0x2126ee,_0x532816)=>{var _0x4cbfef=a0_0x942bf9;try{const {username:_0x1ca307,email:_0x161e4c,role:_0x4c6408}=_0x2126ee[_0x4cbfef(0xb7)],_0x53d956=_0x2126ee['user'],_0x5d7252=await profile[_0x4cbfef(0xd9)]({'email':_0x53d956[_0x4cbfef(0x117)]}),_0x505fc8=await master_shop['find'](),_0x4430f5=_0x2126ee[_0x4cbfef(0xf9)]['id'],_0x5df2d0=await sales[_0x4cbfef(0xb5)](_0x4430f5);var _0x2fa9ec=[_0x4cbfef(0xea),_0x4cbfef(0x17d)];const _0x1b7d5f=await warehouse[_0x4cbfef(0x193)]([{'$match':{'name':_0x5df2d0[_0x4cbfef(0x122)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x4cbfef(0x15f)},{'$group':{'_id':_0x4cbfef(0x11a),'name':{'$first':_0x4cbfef(0x110)},'product_stock':{'$first':_0x4cbfef(0x18f)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4cbfef(0x13d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4cbfef(0x1a3)},'primary_code':{'$first':_0x4cbfef(0x15a)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4cbfef(0x111)},'rack':{'$first':_0x4cbfef(0xff)}}}]),_0x52d49d=await customer[_0x4cbfef(0xbc)]({});let _0x37b606;if(_0x53d956[_0x4cbfef(0x199)]==_0x4cbfef(0x16d)){const _0x59a6a1=await staff[_0x4cbfef(0xd9)]({'email':_0x53d956[_0x4cbfef(0x117)]});_0x37b606=await warehouse[_0x4cbfef(0x193)]([{'$match':{'status':'Enabled','name':_0x59a6a1[_0x4cbfef(0xf0)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4cbfef(0xed),'name':{'$first':_0x4cbfef(0xed)}}}]);}else _0x37b606=await warehouse[_0x4cbfef(0x193)]([{'$match':{'status':_0x4cbfef(0xf7),'warehouse_category':_0x4cbfef(0x1af)}},{'$group':{'_id':_0x4cbfef(0xed),'name':{'$first':_0x4cbfef(0xed)}}}]);const _0x5a466d=await product[_0x4cbfef(0xbc)]({});if(_0x505fc8[0x0]['language']=='English\x20(US)'){var _0x3cafdf=users['English'];console['log'](_0x3cafdf);}else{if(_0x505fc8[0x0][_0x4cbfef(0x16a)]==_0x4cbfef(0x119))var _0x3cafdf=users[_0x4cbfef(0x119)];else{if(_0x505fc8[0x0][_0x4cbfef(0x16a)]==_0x4cbfef(0xbe))var _0x3cafdf=users[_0x4cbfef(0xbe)];else{if(_0x505fc8[0x0]['language']==_0x4cbfef(0x1a2))var _0x3cafdf=users['Spanish'];else{if(_0x505fc8[0x0]['language']==_0x4cbfef(0x1bb))var _0x3cafdf=users[_0x4cbfef(0x1bb)];else{if(_0x505fc8[0x0][_0x4cbfef(0x16a)]==_0x4cbfef(0xb9))var _0x3cafdf=users['Portuguese'];else{if(_0x505fc8[0x0][_0x4cbfef(0x16a)]==_0x4cbfef(0x113))var _0x3cafdf=users[_0x4cbfef(0x113)];else{if(_0x505fc8[0x0][_0x4cbfef(0x16a)]==_0x4cbfef(0x100))var _0x3cafdf=users[_0x4cbfef(0xdc)];}}}}}}}_0x532816[_0x4cbfef(0x198)](_0x4cbfef(0x16b),{'success':_0x2126ee[_0x4cbfef(0xfb)](_0x4cbfef(0x18e)),'errors':_0x2126ee[_0x4cbfef(0xfb)](_0x4cbfef(0xe1)),'role':_0x53d956,'profile':_0x5d7252,'customer':_0x52d49d,'warehouse':_0x37b606,'product':_0x1b7d5f,'user':_0x5df2d0,'master_shop':_0x505fc8,'unit':_0x5a466d,'language':_0x3cafdf});}catch(_0x4ecfd0){console['log'](_0x4ecfd0);}}),router[a0_0x942bf9(0x15c)](a0_0x942bf9(0x1a7),auth,async(_0x1f0358,_0x5bf246)=>{var _0x43e4e5=a0_0x942bf9;try{const _0x57dfbf=_0x1f0358[_0x43e4e5(0xf9)]['id'],_0x387f31=await sales[_0x43e4e5(0xd9)]({'_id':_0x1f0358['params']['id']}),_0x4d2d02=await warehouse['findOne']({'name':_0x387f31[_0x43e4e5(0x122)],'room':_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0xce)]}),{invoice:_0x23866f,date:_0x103481,warehouse_name:_0x48035f,product_name:_0x55a758,stock:_0x142ae7,quantity:_0x484055,note:_0x1b7a81,room:_0x2a4504,customer:_0x758037,SCRN:_0x18265b}=_0x1f0358[_0x43e4e5(0xd1)];if(typeof _0x55a758==_0x43e4e5(0x1b7))var _0x9d0d90=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x168)]],_0x222a6a=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x152)]],_0x2ce4e4=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x192)]],_0x44c617=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x12d)]],_0x4fc3e0=[_0x1f0358['body'][_0x43e4e5(0xc1)]],_0x3345f1=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x19d)]],_0x21952c=[_0x1f0358['body'][_0x43e4e5(0xe7)]],_0x5ea734=[_0x1f0358['body'][_0x43e4e5(0xe2)]],_0x2cf3d9=[_0x1f0358['body'][_0x43e4e5(0x155)]],_0xaf2cf5=[_0x1f0358['body'][_0x43e4e5(0xe6)]],_0x41cac2=[_0x1f0358[_0x43e4e5(0xd1)]['expiry_date']],_0x4f6b29=[_0x1f0358[_0x43e4e5(0xd1)]['max_per_unit']],_0xacf006=[_0x1f0358['body']['production_date']],_0x69de83=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0xdb)]],_0xf8abe7=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x120)]],_0x500336=[_0x1f0358['body'][_0x43e4e5(0x11c)]],_0x3ccc90=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x187)]],_0x7884e2=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x18c)]],_0x2be839=[_0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x19b)]];else var _0x9d0d90=[..._0x1f0358[_0x43e4e5(0xd1)]['product_name']],_0x222a6a=[..._0x1f0358[_0x43e4e5(0xd1)]['stock']],_0x2ce4e4=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x192)]],_0x44c617=[..._0x1f0358['body']['primary_code']],_0x4fc3e0=[..._0x1f0358['body'][_0x43e4e5(0xc1)]],_0x3345f1=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x19d)]],_0x21952c=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0xe7)]],_0x5ea734=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0xe2)]],_0x2cf3d9=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x155)]],_0xaf2cf5=[..._0x1f0358['body']['batch_code']],_0x41cac2=[..._0x1f0358[_0x43e4e5(0xd1)]['expiry_date']],_0x4f6b29=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x17f)]],_0xacf006=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x184)]],_0x69de83=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0xdb)]],_0xf8abe7=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x120)]],_0x500336=[..._0x1f0358[_0x43e4e5(0xd1)]['delivery_code']],_0x3ccc90=[..._0x1f0358[_0x43e4e5(0xd1)]['prod_cat']],_0x7884e2=[..._0x1f0358[_0x43e4e5(0xd1)][_0x43e4e5(0x18c)]],_0x2be839=[..._0x1f0358[_0x43e4e5(0xd1)]['RoomAssigned']];const _0x24c533=_0x9d0d90[_0x43e4e5(0xc4)](_0x4daa87=>{return _0x4daa87={'product_name':_0x4daa87};});_0x222a6a[_0x43e4e5(0xfa)]((_0x2ea56d,_0x3bba7e)=>{var _0x290c9e=_0x43e4e5;_0x24c533[_0x3bba7e]['stock']=Math[_0x290c9e(0xc7)](_0x2ea56d);}),_0x2ce4e4[_0x43e4e5(0xfa)]((_0x49a556,_0x37f3dd)=>{_0x24c533[_0x37f3dd]['quantity']=_0x49a556;}),_0x44c617[_0x43e4e5(0xfa)]((_0x3f33e8,_0x22e5ca)=>{var _0x532c7b=_0x43e4e5;_0x24c533[_0x22e5ca][_0x532c7b(0x12d)]=_0x3f33e8;}),_0x4fc3e0[_0x43e4e5(0xfa)]((_0x1c10a7,_0x9946e6)=>{_0x24c533[_0x9946e6]['secondary_code']=_0x1c10a7;}),_0x3345f1['forEach']((_0x39ae19,_0x5f18be)=>{var _0x508dcb=_0x43e4e5;_0x24c533[_0x5f18be][_0x508dcb(0x10c)]=_0x39ae19;}),_0x21952c['forEach']((_0x58b8ca,_0x2914b4)=>{_0x2be839['forEach']((_0xeb1fb0,_0x101c21)=>{var _0x580f19=a0_0x1055;if(_0xeb1fb0==_0x580f19(0x132)&&_0x2914b4==_0x101c21){var _0x59d84c=_0x58b8ca[_0x580f19(0x12a)](0x3);_0x24c533[_0x2914b4][_0x580f19(0x149)]=_0x58b8ca[0x0],_0x24c533[_0x2914b4]['rack']=_0x58b8ca[0x1],_0x24c533[_0x2914b4]['bay']=0x0,_0x24c533[_0x2914b4][_0x580f19(0xdf)]=0x0,_0x24c533[_0x2914b4][_0x580f19(0x181)]=_0x580f19(0xe4),_0x24c533[_0x2914b4][_0x580f19(0xcd)]=_0x59d84c;}else{if(_0xeb1fb0==_0x580f19(0x176)&&_0x2914b4==_0x101c21){var _0x59d84c=_0x58b8ca[_0x580f19(0x12a)](0x3);_0x24c533[_0x2914b4][_0x580f19(0x149)]=_0x58b8ca[0x0],_0x24c533[_0x2914b4][_0x580f19(0xda)]=_0x58b8ca[0x1],_0x24c533[_0x2914b4][_0x580f19(0x13a)]=0x0,_0x24c533[_0x2914b4][_0x580f19(0xdf)]=0x0,_0x24c533[_0x2914b4][_0x580f19(0x181)]=_0x580f19(0xe4),_0x24c533[_0x2914b4][_0x580f19(0xcd)]=_0x58b8ca[0x5];}else{if(_0x2914b4==_0x101c21){var _0x20131e;if(_0x58b8ca[0x4]=='L')_0x20131e='Level';else _0x58b8ca[0x4]=='F'&&(_0x20131e=_0x580f19(0xe4));_0x24c533[_0x2914b4][_0x580f19(0x149)]=_0x58b8ca[0x0],_0x24c533[_0x2914b4][_0x580f19(0xda)]=_0x58b8ca[0x1],_0x24c533[_0x2914b4][_0x580f19(0x13a)]=_0x58b8ca[0x2],_0x24c533[_0x2914b4]['bin']=_0x58b8ca[0x3],_0x24c533[_0x2914b4][_0x580f19(0x181)]=_0x20131e,_0x24c533[_0x2914b4][_0x580f19(0xcd)]=_0x58b8ca[0x5];}}}});}),_0x5ea734[_0x43e4e5(0xfa)]((_0x166622,_0x2688a8)=>{var _0x5b02b0=_0x43e4e5;_0x24c533[_0x2688a8][_0x5b02b0(0x177)]=_0x166622;}),_0x2cf3d9[_0x43e4e5(0xfa)]((_0x2274ea,_0x2b287f)=>{var _0x16a36f=_0x43e4e5;_0x24c533[_0x2b287f][_0x16a36f(0x155)]=_0x2274ea;}),_0xaf2cf5[_0x43e4e5(0xfa)]((_0x4d34db,_0xd937b7)=>{var _0x3d0f98=_0x43e4e5;_0x24c533[_0xd937b7][_0x3d0f98(0xe6)]=_0x4d34db;}),_0x41cac2[_0x43e4e5(0xfa)]((_0x5838cb,_0x54cce6)=>{var _0x43b04a=_0x43e4e5;_0x24c533[_0x54cce6][_0x43b04a(0x169)]=_0x5838cb;}),_0x4f6b29[_0x43e4e5(0xfa)]((_0x5dcd61,_0x5e50f5)=>{var _0x23299b=_0x43e4e5;_0x24c533[_0x5e50f5][_0x23299b(0x14a)]=_0x5dcd61;}),_0xacf006[_0x43e4e5(0xfa)]((_0x1fede4,_0x383ebe)=>{var _0x2b6aef=_0x43e4e5;_0x24c533[_0x383ebe][_0x2b6aef(0x184)]=_0x1fede4;}),_0x69de83[_0x43e4e5(0xfa)]((_0x22f1fa,_0x4e9faf)=>{var _0x13cac8=_0x43e4e5;_0x24c533[_0x4e9faf][_0x13cac8(0xdb)]=Math[_0x13cac8(0xc7)](_0x22f1fa);}),_0xf8abe7[_0x43e4e5(0xfa)]((_0x521ee3,_0x5ec22c)=>{var _0x2390f0=_0x43e4e5;_0x24c533[_0x5ec22c][_0x2390f0(0x120)]=_0x521ee3;}),_0x500336[_0x43e4e5(0xfa)]((_0x303106,_0x44dc06)=>{_0x24c533[_0x44dc06]['delivery_code']=_0x303106;}),_0x3ccc90[_0x43e4e5(0xfa)]((_0x3d8fdb,_0x524cfc)=>{var _0x3c92c0=_0x43e4e5;_0x24c533[_0x524cfc][_0x3c92c0(0x187)]=_0x3d8fdb;}),_0x7884e2[_0x43e4e5(0xfa)]((_0x5a61eb,_0x164cf8)=>{var _0x5ef6c8=_0x43e4e5;_0x24c533[_0x164cf8][_0x5ef6c8(0x1aa)]=_0x5a61eb;}),_0x2be839[_0x43e4e5(0xfa)]((_0x6687e4,_0xcff40c)=>{var _0x2e3121=_0x43e4e5;_0x24c533[_0xcff40c][_0x2e3121(0x16c)]=_0x6687e4;});var _0x195897=0x0;_0x24c533[_0x43e4e5(0xfa)](_0x391bc2=>{var _0x5c2fb5=_0x43e4e5;console[_0x5c2fb5(0x12c)](_0x5c2fb5(0x131),_0x391bc2),(parseInt(_0x391bc2['stock'])<parseInt(_0x391bc2[_0x5c2fb5(0x18c)])||parseInt(_0x391bc2[_0x5c2fb5(0x18c)])==0x0)&&_0x195897++;});if(_0x195897!=0x0)return _0x1f0358[_0x43e4e5(0xfb)](_0x43e4e5(0xe1),_0x43e4e5(0xd2)),_0x5bf246[_0x43e4e5(0x161)]('back');const _0x3618ce=_0x24c533[_0x43e4e5(0xcc)](_0x507039=>_0x507039[_0x43e4e5(0x18c)]!=='0'&&_0x507039[_0x43e4e5(0x18c)]!=='');_0x387f31[_0x43e4e5(0x10b)]=_0x23866f,_0x387f31[_0x43e4e5(0xf8)]=_0x758037,_0x387f31[_0x43e4e5(0x1a5)]=_0x103481,_0x387f31[_0x43e4e5(0x122)]=_0x48035f,_0x387f31[_0x43e4e5(0x163)]=_0x3618ce,_0x387f31[_0x43e4e5(0x1b4)]=_0x1b7a81,_0x387f31[_0x43e4e5(0x123)]=_0x18265b,_0x387f31[_0x43e4e5(0xb2)]=_0x43e4e5(0x134),_0x387f31[_0x43e4e5(0x1bc)]=_0x43e4e5(0x134);const _0x261b19=await _0x387f31[_0x43e4e5(0x19c)]();_0x1f0358['flash'](_0x43e4e5(0x18e),_0x43e4e5(0x17c)),_0x5bf246[_0x43e4e5(0x161)](_0x43e4e5(0xee));}catch(_0x186f1a){console[_0x43e4e5(0x12c)](_0x186f1a);}}),router[a0_0x942bf9(0x15c)](a0_0x942bf9(0x1b2),auth,async(_0x313282,_0x4642c7)=>{var _0x217f35=a0_0x942bf9;try{const _0x49b0d8=_0x313282[_0x217f35(0xf9)]['id'],{invoice:_0x3c628a,customer:_0x335e85,receivable_amount:_0x54e0aa,received_amount:_0x3a5fe7}=_0x313282[_0x217f35(0xd1)],_0x4f6db5=await sales[_0x217f35(0xb5)](_0x49b0d8);console[_0x217f35(0x12c)](_0x4f6db5);var _0x4a96b8=_0x54e0aa-_0x3a5fe7;console[_0x217f35(0x12c)](_0x3a5fe7),_0x4f6db5[_0x217f35(0x1a4)]=parseFloat(_0x3a5fe7)+parseFloat(_0x4f6db5['received_amount']),_0x4f6db5['due_amount']=_0x4a96b8,console[_0x217f35(0x12c)](_0x4f6db5);const _0x377708=await _0x4f6db5[_0x217f35(0x19c)](),_0x3d74d0=await c_payment_data[_0x217f35(0xd9)]({'invoice':_0x3c628a});_0x3d74d0[_0x217f35(0xd0)]=_0x4a96b8,await _0x3d74d0[_0x217f35(0x19c)]();let _0xf4050a=new Date(),_0x44050f=('0'+_0xf4050a['getDate']())[_0x217f35(0x12a)](-0x2),_0x46356e=('0'+(_0xf4050a[_0x217f35(0x164)]()+0x1))['slice'](-0x2),_0x49cabc=_0xf4050a[_0x217f35(0x10a)](),_0x1449b7=_0x49cabc+'-'+_0x46356e+'-'+_0x44050f;const _0x224630=new customer_payment({'invoice':_0x3c628a,'date':_0x49cabc+'-'+_0x46356e+'-'+_0x44050f,'customer':_0x335e85,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3a5fe7}),_0x20ad7a=await _0x224630['save']();_0x313282[_0x217f35(0xfb)](_0x217f35(0x18e),_0x217f35(0x1ac)),_0x4642c7[_0x217f35(0x161)](_0x217f35(0xee));}catch(_0x258291){console['log'](_0x258291);}}),router[a0_0x942bf9(0xec)](a0_0x942bf9(0x107),auth,async(_0x53fb9d,_0x3cf469)=>{var _0x3d1351=a0_0x942bf9;try{const {username:_0x551935,email:_0x28c014,role:_0x5b437e}=_0x53fb9d[_0x3d1351(0xb7)],_0x4ea623=_0x53fb9d[_0x3d1351(0xb7)],_0x1ab456=await profile['findOne']({'email':_0x4ea623['email']}),_0x4479ff=await master_shop[_0x3d1351(0xbc)]();console[_0x3d1351(0x12c)]('master',_0x4479ff);const _0x1a4758=_0x53fb9d[_0x3d1351(0xf9)]['id'],_0x132870=await sales[_0x3d1351(0xb5)](_0x1a4758);console[_0x3d1351(0x12c)](_0x132870);const _0x303519=await customer[_0x3d1351(0xd9)]({'name':_0x132870[_0x3d1351(0xf8)]});console[_0x3d1351(0x12c)](_0x303519);if(_0x4479ff[0x0][_0x3d1351(0x16a)]=='English\x20(US)'){var _0x414bd4=users[_0x3d1351(0x180)];console[_0x3d1351(0x12c)](_0x414bd4);}else{if(_0x4479ff[0x0][_0x3d1351(0x16a)]==_0x3d1351(0x119))var _0x414bd4=users[_0x3d1351(0x119)];else{if(_0x4479ff[0x0]['language']==_0x3d1351(0xbe))var _0x414bd4=users[_0x3d1351(0xbe)];else{if(_0x4479ff[0x0][_0x3d1351(0x16a)]==_0x3d1351(0x1a2))var _0x414bd4=users['Spanish'];else{if(_0x4479ff[0x0]['language']==_0x3d1351(0x1bb))var _0x414bd4=users[_0x3d1351(0x1bb)];else{if(_0x4479ff[0x0][_0x3d1351(0x16a)]=='Portuguese\x20(BR)')var _0x414bd4=users[_0x3d1351(0x178)];else{if(_0x4479ff[0x0][_0x3d1351(0x16a)]==_0x3d1351(0x113))var _0x414bd4=users['Chinese'];else{if(_0x4479ff[0x0][_0x3d1351(0x16a)]==_0x3d1351(0x100))var _0x414bd4=users['Arabic'];}}}}}}}_0x3cf469[_0x3d1351(0x198)]('sales_invoice',{'success':_0x53fb9d[_0x3d1351(0xfb)](_0x3d1351(0x18e)),'errors':_0x53fb9d['flash']('errors'),'role':_0x4ea623,'profile':_0x1ab456,'master_shop':_0x4479ff,'customers':_0x303519,'sales':_0x132870,'language':_0x414bd4});}catch(_0x16f02b){console[_0x3d1351(0x12c)](_0x16f02b);}}),router[a0_0x942bf9(0xec)](a0_0x942bf9(0xe0),auth,async(_0x2809e6,_0xedb7bb)=>{var _0x3013e1=a0_0x942bf9;try{const {username:_0x7e687c,email:_0x11b4f9,role:_0x283074}=_0x2809e6[_0x3013e1(0xb7)],_0x23c785=_0x2809e6[_0x3013e1(0xb7)],_0x13e3b2=await profile[_0x3013e1(0xd9)]({'email':_0x23c785[_0x3013e1(0x117)]}),_0x5b42c9=await master_shop[_0x3013e1(0xbc)]();console[_0x3013e1(0x12c)](_0x3013e1(0x112),_0x5b42c9);const _0x1cd2ba=_0x2809e6['params']['id'];console[_0x3013e1(0x12c)](_0x1cd2ba);const _0x31722c=await sales[_0x3013e1(0xb5)](_0x1cd2ba);console[_0x3013e1(0x12c)]('user_id',_0x31722c);const _0x3f0f00=await warehouse['aggregate']([{'$match':{'name':'Return\x20Goods','room':'Return\x20Rooms'}},{'$unwind':_0x3013e1(0x15f)},{'$group':{'_id':_0x3013e1(0x11a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3013e1(0x18f)},'level':{'$first':_0x3013e1(0x19a)},'isle':{'$first':_0x3013e1(0xcf)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x3013e1(0x15a)},'secondary_code':{'$first':_0x3013e1(0x13b)},'product_code':{'$first':_0x3013e1(0x1bd)}}}]);console[_0x3013e1(0x12c)](_0x3013e1(0x172),_0x3f0f00);const _0x67af3a=await product[_0x3013e1(0xbc)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x3013e1(0xf7),'name':_0x3013e1(0x11f),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3013e1(0xed),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x5c5945=['Return\x20Rooms'];if(_0x5b42c9[0x0][_0x3013e1(0x16a)]==_0x3013e1(0xbb)){var _0x1087f7=users[_0x3013e1(0x180)];console['log'](_0x1087f7);}else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]=='Hindi')var _0x1087f7=users[_0x3013e1(0x119)];else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]==_0x3013e1(0xbe))var _0x1087f7=users[_0x3013e1(0xbe)];else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]==_0x3013e1(0x1a2))var _0x1087f7=users[_0x3013e1(0x1a2)];else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]=='French')var _0x1087f7=users[_0x3013e1(0x1bb)];else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]==_0x3013e1(0xb9))var _0x1087f7=users[_0x3013e1(0x178)];else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]==_0x3013e1(0x113))var _0x1087f7=users[_0x3013e1(0x113)];else{if(_0x5b42c9[0x0][_0x3013e1(0x16a)]=='Arabic\x20(ae)')var _0x1087f7=users['Arabic'];}}}}}}}_0xedb7bb['render'](_0x3013e1(0x1b8),{'success':_0x2809e6[_0x3013e1(0xfb)](_0x3013e1(0x18e)),'errors':_0x2809e6[_0x3013e1(0xfb)](_0x3013e1(0xe1)),'role':_0x23c785,'profile':_0x13e3b2,'user':_0x31722c,'stock':_0x3f0f00,'master_shop':_0x5b42c9,'unit':_0x67af3a,'language':_0x1087f7,'warehouses':warehouse_data,'rooms':_0x5c5945});}catch(_0x4dc954){console['log'](_0x4dc954),_0xedb7bb[_0x3013e1(0x15d)](0xc8)['json']({'message':_0x4dc954[_0x3013e1(0x18a)]});}}),router[a0_0x942bf9(0x15c)](a0_0x942bf9(0xe0),auth,async(_0x58044b,_0x438c47)=>{var _0x2693e3=a0_0x942bf9;try{const {invoice:_0x31acc3,date:_0x1e1bdc,warehouse_name:_0x790426,product_name:_0x486060,primary_code:_0x1a97fa,secondary_code:_0x142806,product_code:_0x4b7219,sales_quantity:_0xcc567,stocks:_0x558ae6,return_qty:_0x2d4459,Room_name:_0x26005e,to_warehouse_name:_0x18b247,to_Roomname:_0x31073e,to_Room_name:_0x678090,note:_0x41dbfb,level:_0x3c4bd3,isle:_0x1c623d,pallet:_0xb42ecb}=_0x58044b[_0x2693e3(0xd1)];if(typeof _0x486060==_0x2693e3(0x1b7))var _0x58b038=[_0x58044b['body'][_0x2693e3(0x168)]],_0x4f3c31=[_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x12d)]],_0x116bff=[_0x58044b[_0x2693e3(0xd1)]['secondary_code']],_0x8d40ee=[_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x10c)]],_0x2a3e44=[_0x58044b[_0x2693e3(0xd1)]['sales_quantity']],_0x130529=[_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x13e)]],_0x27154d=[_0x58044b['body']['return_qty']],_0x31a1dd=[_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x13a)]],_0x1864c3=[_0x58044b[_0x2693e3(0xd1)]['bin']],_0x1ec3e5=[_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x109)]],_0x239b6c=[_0x58044b[_0x2693e3(0xd1)]['floorlevel']];else var _0x58b038=[..._0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x168)]],_0x4f3c31=[..._0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x12d)]],_0x116bff=[..._0x58044b[_0x2693e3(0xd1)]['secondary_code']],_0x8d40ee=[..._0x58044b[_0x2693e3(0xd1)][_0x2693e3(0x10c)]],_0x2a3e44=[..._0x58044b[_0x2693e3(0xd1)]['sales_quantity']],_0x130529=[..._0x58044b[_0x2693e3(0xd1)]['stocks']],_0x27154d=[..._0x58044b['body'][_0x2693e3(0x14b)]],_0x31a1dd=[..._0x58044b['body'][_0x2693e3(0x13a)]],_0x1864c3=[..._0x58044b[_0x2693e3(0xd1)][_0x2693e3(0xdf)]],_0x1ec3e5=[..._0x58044b[_0x2693e3(0xd1)]['types']],_0x239b6c=[..._0x58044b[_0x2693e3(0xd1)][_0x2693e3(0xcd)]];const _0x36e9cd=_0x58b038[_0x2693e3(0xc4)](_0x5030f2=>{return _0x5030f2={'product_name':_0x5030f2};});_0x4f3c31[_0x2693e3(0xfa)]((_0x487852,_0x4a83cf)=>{var _0x233976=_0x2693e3;_0x36e9cd[_0x4a83cf][_0x233976(0x12d)]=_0x487852;}),_0x116bff[_0x2693e3(0xfa)]((_0x19809d,_0x136515)=>{var _0x446c49=_0x2693e3;_0x36e9cd[_0x136515][_0x446c49(0xc1)]=_0x19809d;}),_0x8d40ee[_0x2693e3(0xfa)]((_0x5e25b2,_0x19fc7b)=>{var _0x4d9e97=_0x2693e3;_0x36e9cd[_0x19fc7b][_0x4d9e97(0x10c)]=_0x5e25b2;}),_0x2a3e44['forEach']((_0x576d41,_0x547961)=>{var _0x9cf817=_0x2693e3;_0x36e9cd[_0x547961][_0x9cf817(0x188)]=_0x576d41;}),_0x130529[_0x2693e3(0xfa)]((_0x235a7d,_0x11a5d6)=>{var _0x267877=_0x2693e3;_0x36e9cd[_0x11a5d6][_0x267877(0x152)]=_0x235a7d;}),_0x27154d[_0x2693e3(0xfa)]((_0x103225,_0x4898b6)=>{var _0x3c8fe6=_0x2693e3;_0x36e9cd[_0x4898b6][_0x3c8fe6(0x14b)]=_0x103225;}),_0x31a1dd[_0x2693e3(0xfa)]((_0x1083b0,_0x388480)=>{var _0x4de417=_0x2693e3;_0x36e9cd[_0x388480][_0x4de417(0x13a)]=_0x1083b0;}),_0x1864c3[_0x2693e3(0xfa)]((_0x1496c1,_0x87dbba)=>{var _0x37a994=_0x2693e3;_0x36e9cd[_0x87dbba][_0x37a994(0xdf)]=_0x1496c1;}),_0x1ec3e5['forEach']((_0x5d7c14,_0x528c38)=>{var _0x4d6e92=_0x2693e3;_0x36e9cd[_0x528c38][_0x4d6e92(0x181)]=_0x5d7c14;}),_0x239b6c[_0x2693e3(0xfa)]((_0x303f4d,_0x4c42ce)=>{var _0x364df8=_0x2693e3;_0x36e9cd[_0x4c42ce][_0x364df8(0xcd)]=_0x303f4d;});var _0x58b57f=0x0;_0x36e9cd[_0x2693e3(0xfa)](_0x2f09f2=>{var _0x3dd84d=_0x2693e3;console[_0x3dd84d(0x12c)](_0x3dd84d(0x131),_0x2f09f2),(parseInt(_0x2f09f2['sale_qty'])<parseInt(_0x2f09f2['return_qty'])||parseInt(_0x2f09f2[_0x3dd84d(0x152)])<parseInt(_0x2f09f2[_0x3dd84d(0x14b)])&&parseInt(_0x2f09f2[_0x3dd84d(0x188)])>parseInt(_0x2f09f2[_0x3dd84d(0x14b)])||parseInt(_0x2f09f2['return_qty'])==0x0)&&_0x58b57f++;});if(_0x58b57f!=0x0)return _0x58044b[_0x2693e3(0xfb)](_0x2693e3(0xe1),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x438c47['redirect'](_0x2693e3(0x1ae));const _0x300533=await sales[_0x2693e3(0xd9)]({'invoice':_0x31acc3});console['log'](_0x300533),_0x300533[_0x2693e3(0xeb)]=_0x2693e3(0x14e);const _0x375aa9=await _0x300533['save'](),_0x4b4191=new sales_return({'invoice':_0x31acc3,'customer':_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0xf8)],'date':_0x1e1bdc,'warehouse_name':_0x790426,'room':_0x26005e,'ToWarehouse':_0x18b247,'ToRoom':_0x678090,'return_sale':_0x36e9cd,'note':_0x41dbfb}),_0x523cf7=await _0x4b4191[_0x2693e3(0x19c)]();console[_0x2693e3(0x12c)](_0x4b4191);const _0x314f53=await sales_return[_0x2693e3(0xd9)]({'invoice':_0x31acc3}),_0x2dd405=await warehouse[_0x2693e3(0xd9)]({'name':_0x18b247,'room':_0x678090});_0x314f53[_0x2693e3(0x1b8)]['forEach'](_0x504c5f=>{var _0x500056=_0x2693e3,_0x578276=0x0;const _0x4702f4=_0x2dd405['product_details'][_0x500056(0xc4)](_0x83cf89=>{var _0x480c06=_0x500056;_0x83cf89['product_name']==_0x504c5f[_0x480c06(0x168)]&&_0x83cf89[_0x480c06(0xcd)]==_0x504c5f['floorlevel']&&_0x83cf89[_0x480c06(0x181)]==_0x504c5f['type']&&_0x83cf89[_0x480c06(0xdf)]==_0x504c5f[_0x480c06(0xdf)]&&_0x83cf89[_0x480c06(0x13a)]==_0x504c5f[_0x480c06(0x13a)]&&(_0x83cf89[_0x480c06(0x159)]=parseInt(_0x83cf89[_0x480c06(0x159)])+parseInt(_0x504c5f['return_qty']),_0x578276++);});_0x578276=='0'&&(_0x2dd405[_0x500056(0x150)]=_0x2dd405[_0x500056(0x150)][_0x500056(0x19e)]({'product_name':_0x504c5f['product_name'],'product_stock':_0x504c5f['return_qty'],'primary_code':_0x504c5f[_0x500056(0x12d)],'secondary_code':_0x504c5f['secondary_code'],'product_code':_0x504c5f[_0x500056(0x10c)],'bay':_0x504c5f[_0x500056(0x13a)],'bin':_0x504c5f[_0x500056(0xdf)],'type':_0x504c5f['type'],'floorlevel':_0x504c5f['floorlevel']})),console[_0x500056(0x12c)]('final',_0x2dd405);}),await _0x2dd405[_0x2693e3(0x19c)](),console[_0x2693e3(0x12c)](_0x58044b[_0x2693e3(0xd1)]);const _0x5ef687=new c_payment_data({'invoice':_0x31acc3,'customer':_0x58044b[_0x2693e3(0xd1)][_0x2693e3(0xf8)],'reason':_0x2693e3(0x142)});await _0x5ef687[_0x2693e3(0x19c)]();const _0x3fb944=await master_shop[_0x2693e3(0xbc)]();console[_0x2693e3(0x12c)](_0x2693e3(0x166),_0x3fb944[0x0][_0x2693e3(0x162)]);const _0x3745d7=await email_settings[_0x2693e3(0xd9)](),_0x238ad1=await customer['findOne']({'name':_0x58044b['body'][_0x2693e3(0xf8)]});console[_0x2693e3(0x12c)](_0x2693e3(0x11b),_0x238ad1);_0x3fb944[0x0]['currency_placement']==0x1?(right_currency=_0x3fb944[0x0][_0x2693e3(0x13f)],left_currency=''):(right_currency='',left_currency=_0x3fb944[0x0]['currency']);var _0x2d666b=_0x58b038,_0x23e1ad=_0x27154d,_0x5601cc='',_0x53e122;for(_0x53e122 in _0x2d666b){_0x5601cc+=_0x2693e3(0x133)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d666b[_0x53e122]+_0x2693e3(0x16e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x23e1ad[_0x53e122]+_0x2693e3(0x16e)+'</tr>';}console[_0x2693e3(0x12c)]('product_list',_0x5601cc);let _0x1b0669=nodemailer['createTransport']({'service':_0x2693e3(0x140),'auth':{'user':_0x3745d7[_0x2693e3(0x117)],'pass':_0x3745d7[_0x2693e3(0xf2)]}}),_0x5f4c08={'from':_0x3745d7['email'],'to':_0x238ad1[_0x2693e3(0x117)],'subject':_0x2693e3(0x12f),'attachments':[{'filename':_0x2693e3(0x130),'path':__dirname+_0x2693e3(0xb4)+_0x2693e3(0xf4)+_0x3fb944[0x0]['image'],'cid':_0x2693e3(0x14c)}],'html':'<!DOCTYPE\x20html>'+_0x2693e3(0x118)+_0x2693e3(0x105)+_0x2693e3(0xc5)+_0x2693e3(0x147)+'<div>'+_0x2693e3(0x174)+_0x2693e3(0x14d)+_0x2693e3(0xc5)+_0x2693e3(0x146)+_0x3fb944[0x0][_0x2693e3(0x10d)]+'\x20</h2>'+'</div>'+_0x2693e3(0x14d)+_0x2693e3(0x191)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2693e3(0x1b5)+_0x31acc3+'\x20'+_0x2693e3(0x194)+'\x20Order\x20Date\x20:\x20'+_0x1e1bdc+'\x20'+'</span>'+_0x2693e3(0x190)+'</div>'+_0x2693e3(0x1a0)+_0x2693e3(0x10f)+'<tr>'+_0x2693e3(0x145)+_0x2693e3(0x189)+_0x2693e3(0x186)+_0x2693e3(0x143)+_0x2693e3(0x116)+_0x2693e3(0x135)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5601cc+'\x20'+_0x2693e3(0x15e)+_0x2693e3(0x1a8)+_0x2693e3(0xc5)+_0x2693e3(0x19f)+_0x2693e3(0xb8)+_0x3fb944[0x0][_0x2693e3(0x10d)]+_0x2693e3(0x190)+'</div>'+_0x2693e3(0x14d)+_0x2693e3(0x102)};_0x1b0669[_0x2693e3(0x17a)](_0x5f4c08,function(_0xa9fcf2,_0x1c65c7){var _0x347cba=_0x2693e3;_0xa9fcf2?(console[_0x347cba(0x12c)](_0xa9fcf2),console[_0x347cba(0x12c)](_0x347cba(0x10e))):console[_0x347cba(0x12c)](_0x347cba(0x1b1));}),_0x58044b[_0x2693e3(0xfb)](_0x2693e3(0x18e),_0x2693e3(0xd8)),_0x438c47[_0x2693e3(0x161)](_0x2693e3(0xee));}catch(_0x48d1c7){console['log'](_0x48d1c7),_0x438c47[_0x2693e3(0x15d)](0xc8)[_0x2693e3(0xca)]({'message1':_0x48d1c7[_0x2693e3(0x18a)]});}}),router[a0_0x942bf9(0xec)](a0_0x942bf9(0x14f),auth,async(_0x2e40b0,_0x360db4)=>{var _0x46fac7=a0_0x942bf9;try{const {username:_0x2838ba,email:_0x26c3ca,role:_0x9d57cb}=_0x2e40b0[_0x46fac7(0xb7)],_0x5c3b61=_0x2e40b0['user'],_0x6f38cb=await profile['findOne']({'email':_0x5c3b61[_0x46fac7(0x117)]}),_0x1178ed=await master_shop['find']();console[_0x46fac7(0x12c)]('barcode\x20Product\x20master',_0x1178ed);const _0x55b5e2=_0x2e40b0['params']['id'],_0x2ae270=await sales[_0x46fac7(0xb5)](_0x55b5e2);console[_0x46fac7(0x12c)](_0x46fac7(0xf1),_0x2ae270);if(_0x1178ed[0x0][_0x46fac7(0x16a)]==_0x46fac7(0xbb))var _0x153553=users['English'];else{if(_0x1178ed[0x0][_0x46fac7(0x16a)]=='Hindi')var _0x153553=users[_0x46fac7(0x119)];else{if(_0x1178ed[0x0][_0x46fac7(0x16a)]==_0x46fac7(0xbe))var _0x153553=users['German'];else{if(_0x1178ed[0x0][_0x46fac7(0x16a)]==_0x46fac7(0x1a2))var _0x153553=users['Spanish'];else{if(_0x1178ed[0x0]['language']=='French')var _0x153553=users[_0x46fac7(0x1bb)];else{if(_0x1178ed[0x0][_0x46fac7(0x16a)]==_0x46fac7(0xb9))var _0x153553=users['Portuguese'];else{if(_0x1178ed[0x0]['language']=='Chinese')var _0x153553=users[_0x46fac7(0x113)];else{if(_0x1178ed[0x0]['language']==_0x46fac7(0x100))var _0x153553=users[_0x46fac7(0xdc)];}}}}}}}_0x360db4[_0x46fac7(0x198)]('all_sales_barcode',{'success':_0x2e40b0['flash'](_0x46fac7(0x18e)),'errors':_0x2e40b0['flash']('errors'),'role':_0x5c3b61,'profile':_0x6f38cb,'alldata':_0x2ae270,'master_shop':_0x1178ed,'language':_0x153553});}catch(_0x342b0d){console['log'](_0x342b0d);}}),router[a0_0x942bf9(0x15c)](a0_0x942bf9(0x108),async(_0x11aaf3,_0x1a363a)=>{var _0xf90256=a0_0x942bf9;const {product_code:_0x5fa877,warehouse_name:_0x11c1d1,rooms_data:_0x58f659,Roomslist:_0x51f200}=_0x11aaf3[_0xf90256(0xd1)],_0x59193f=_0x51f200[_0xf90256(0x139)](','),_0x44137e=[];async function _0x214438(_0x3c6043){var _0x2184c4=_0xf90256;const _0x2b4cbd=await warehouse[_0x2184c4(0x193)]([{'$match':{'name':_0x11c1d1,'room':_0x3c6043}},{'$unwind':_0x2184c4(0x15f)},{'$match':{'product_details.primary_code':_0x5fa877}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2184c4(0x110)},'product_stock':{'$first':_0x2184c4(0x18f)},'primary_code':{'$first':_0x2184c4(0x15a)},'secondary_code':{'$first':_0x2184c4(0x13b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2184c4(0x129)},'isle':{'$first':_0x2184c4(0x13d)},'type':{'$first':_0x2184c4(0x195)},'pallet':{'$first':_0x2184c4(0x1a3)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2184c4(0xd4)},'storage':{'$first':_0x2184c4(0x111)},'rack':{'$first':_0x2184c4(0xff)},'expiry_date':{'$first':_0x2184c4(0xd5)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2184c4(0x18b)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2184c4(0x153)},'actual_qty':{'$first':_0x2184c4(0x15b)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x352b9f=await warehouse['aggregate']([{'$match':{'name':_0x11c1d1,'room':_0x3c6043}},{'$unwind':_0x2184c4(0x15f)},{'$match':{'product_details.secondary_code':_0x5fa877}},{'$group':{'_id':_0x2184c4(0x11a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2184c4(0x18f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2184c4(0x13b)},'product_code':{'$first':_0x2184c4(0x1bd)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2184c4(0x13d)},'type':{'$first':_0x2184c4(0x195)},'pallet':{'$first':_0x2184c4(0x1a3)},'unit':{'$first':_0x2184c4(0x197)},'secondary_unit':{'$first':_0x2184c4(0xd4)},'storage':{'$first':_0x2184c4(0x111)},'rack':{'$first':_0x2184c4(0xff)},'expiry_date':{'$first':_0x2184c4(0xd5)},'production_date':{'$first':_0x2184c4(0xe5)},'maxPerUnit':{'$first':_0x2184c4(0x165)},'batch_code':{'$first':_0x2184c4(0x18b)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2184c4(0x153)}}}]);if(_0x2b4cbd['length']>0x0)_0x44137e[_0x2184c4(0xc8)](_0x2b4cbd);else _0x352b9f['length']>0x0&&_0x44137e[_0x2184c4(0xc8)](_0x352b9f);}const _0x2d9c88=_0x59193f[_0xf90256(0xc4)](_0x5c3e09=>_0x214438(_0x5c3e09));await Promise[_0xf90256(0x179)](_0x2d9c88),_0x1a363a[_0xf90256(0xca)](_0x44137e);}),module['exports']=router;