var a0_0x597c1b=a0_0x2e5e;function a0_0x2e5e(_0x31abf7,_0xcf8d){var _0x454868=a0_0x4548();return a0_0x2e5e=function(_0x2e5ebb,_0x210bb7){_0x2e5ebb=_0x2e5ebb-0x1c3;var _0xe624f8=_0x454868[_0x2e5ebb];return _0xe624f8;},a0_0x2e5e(_0x31abf7,_0xcf8d);}(function(_0x1b1936,_0x56ed98){var _0x87ed69=a0_0x2e5e,_0x3ae145=_0x1b1936();while(!![]){try{var _0x41f415=-parseInt(_0x87ed69(0x22b))/0x1*(parseInt(_0x87ed69(0x283))/0x2)+parseInt(_0x87ed69(0x23d))/0x3+-parseInt(_0x87ed69(0x2aa))/0x4*(parseInt(_0x87ed69(0x1f0))/0x5)+-parseInt(_0x87ed69(0x295))/0x6*(-parseInt(_0x87ed69(0x1d2))/0x7)+-parseInt(_0x87ed69(0x2a6))/0x8*(-parseInt(_0x87ed69(0x1db))/0x9)+parseInt(_0x87ed69(0x1df))/0xa*(parseInt(_0x87ed69(0x274))/0xb)+parseInt(_0x87ed69(0x271))/0xc;if(_0x41f415===_0x56ed98)break;else _0x3ae145['push'](_0x3ae145['shift']());}catch(_0x1e422c){_0x3ae145['push'](_0x3ae145['shift']());}}}(a0_0x4548,0x70bdd));const express=require(a0_0x597c1b(0x1d7)),app=express(),router=express[a0_0x597c1b(0x1ec)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x597c1b(0x2cf)),nodemailer=require(a0_0x597c1b(0x1e9)),users=require('../public/language/languages.json');router[a0_0x597c1b(0x214)](a0_0x597c1b(0x2c8),auth,async(_0x268d55,_0x4dfcfa)=>{var _0x52e9f4=a0_0x597c1b;try{const {username:_0x1f3d9e,email:_0x5b220c,role:_0x258d6c}=_0x268d55[_0x52e9f4(0x259)],_0x1a3109=_0x268d55[_0x52e9f4(0x259)],_0x15d78d=await profile[_0x52e9f4(0x232)]({'email':_0x1a3109['email']}),_0x42138f=await master_shop[_0x52e9f4(0x255)]();let _0x21798d;if(_0x1a3109[_0x52e9f4(0x252)]=='staff'){const _0x5d011d=await staff['findOne']({'email':_0x1a3109[_0x52e9f4(0x2d2)]});_0x21798d=await sales[_0x52e9f4(0x28c)]([{'$lookup':{'from':_0x52e9f4(0x21d),'localField':_0x52e9f4(0x1c8),'foreignField':_0x52e9f4(0x219),'as':_0x52e9f4(0x224)}},{'$unwind':_0x52e9f4(0x1d0)},{'$unwind':_0x52e9f4(0x2be)},{'$group':{'_id':_0x52e9f4(0x1cc),'invoice':{'$first':_0x52e9f4(0x1ee)},'customers':{'$first':_0x52e9f4(0x23c)},'date':{'$first':_0x52e9f4(0x28b)},'warehouse_name':{'$first':_0x52e9f4(0x1f8)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x52e9f4(0x2c6)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x52e9f4(0x1e6)},'level':{'$addToSet':_0x52e9f4(0x223)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x52e9f4(0x28e)},'pallet':{'$addToSet':_0x52e9f4(0x231)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x21798d=await sales[_0x52e9f4(0x28c)]([{'$lookup':{'from':'customers','localField':_0x52e9f4(0x1c8),'foreignField':_0x52e9f4(0x219),'as':'customers_docs'}},{'$unwind':_0x52e9f4(0x1d0)},{'$unwind':_0x52e9f4(0x2be)},{'$group':{'_id':_0x52e9f4(0x1cc),'invoice':{'$first':_0x52e9f4(0x1ee)},'customers':{'$first':_0x52e9f4(0x23c)},'date':{'$first':_0x52e9f4(0x28b)},'warehouse_name':{'$first':_0x52e9f4(0x1f8)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x52e9f4(0x2c6)},'return_data':{'$first':_0x52e9f4(0x2a9)},'customers_docs':{'$first':_0x52e9f4(0x1d0)},'total_saleproduct_quantity':{'$sum':_0x52e9f4(0x1e6)},'level':{'$addToSet':_0x52e9f4(0x223)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x52e9f4(0x28e)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x52e9f4(0x296)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x52e9f4(0x1f9)](_0x52e9f4(0x286),_0x21798d);if(_0x42138f[0x0]['language']==_0x52e9f4(0x29b)){var _0x2aac0f=users[_0x52e9f4(0x22e)];console[_0x52e9f4(0x1f9)](_0x2aac0f);}else{if(_0x42138f[0x0][_0x52e9f4(0x2c3)]==_0x52e9f4(0x1ea))var _0x2aac0f=users[_0x52e9f4(0x1ea)];else{if(_0x42138f[0x0][_0x52e9f4(0x2c3)]=='German')var _0x2aac0f=users[_0x52e9f4(0x26f)];else{if(_0x42138f[0x0]['language']==_0x52e9f4(0x1e5))var _0x2aac0f=users[_0x52e9f4(0x1e5)];else{if(_0x42138f[0x0][_0x52e9f4(0x2c3)]==_0x52e9f4(0x278))var _0x2aac0f=users[_0x52e9f4(0x278)];else{if(_0x42138f[0x0][_0x52e9f4(0x2c3)]==_0x52e9f4(0x288))var _0x2aac0f=users['Portuguese'];else{if(_0x42138f[0x0][_0x52e9f4(0x2c3)]==_0x52e9f4(0x20d))var _0x2aac0f=users['Chinese'];else{if(_0x42138f[0x0][_0x52e9f4(0x2c3)]==_0x52e9f4(0x1dd))var _0x2aac0f=users[_0x52e9f4(0x2b4)];}}}}}}}_0x4dfcfa[_0x52e9f4(0x262)](_0x52e9f4(0x24b),{'success':_0x268d55[_0x52e9f4(0x207)](_0x52e9f4(0x1c5)),'errors':_0x268d55[_0x52e9f4(0x207)](_0x52e9f4(0x201)),'sales':_0x21798d,'profile':_0x15d78d,'role':_0x1a3109,'master_shop':_0x42138f,'language':_0x2aac0f});}catch(_0xfd04c7){console[_0x52e9f4(0x1f9)](_0xfd04c7);}});async function getRandom8DigitNumber(){var _0x372f58=a0_0x597c1b;const _0x57afa4=0x989680,_0x112064=0x5f5e0ff,_0x66c60b=Math[_0x372f58(0x250)](Math[_0x372f58(0x25c)]()*(_0x112064-_0x57afa4+0x1))+_0x57afa4;var _0x48e9c7;const _0x2417d2=await sales[_0x372f58(0x232)]({'invoice':'OUT-'+_0x66c60b});return _0x2417d2&&_0x2417d2['length']>0x0?_0x48e9c7='OUT-'+_0x66c60b:_0x48e9c7='OUT-'+_0x66c60b,_0x48e9c7;}function a0_0x4548(){var _0x5128e5=['$return_data','4SeSYtd','Return\x20Rooms','<!DOCTYPE\x20html>','<strong>\x20Regards\x20</strong>','password','\x20Order\x20Date\x20:\x20','quantity','purchases_data','<h5>','Raw\x20Materials','Arabic','$product_details.invoice','stock_data','RMSEmail','rack','$name','</div>','requested_qty','Return\x20Goods','sendMail','$sale_product','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Level','floorlevel','port','language','primary_unit','gmail','$note','body','/view','True','/barcode_scanner','getDate','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','invoice','../middleware/auth','status','prod_code','email','<tbody\x20style=\x22text-align:\x20center;\x22>','$product.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','filter','Received\x20Payment\x20For\x20Sale','success','currency_placement','foreach\x20newproduct','customer','/view/:id','sale_qty','</tbody>','$_id','unit','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$customers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','99701TYsnSB','$product_details.product_name','$product_details.pallet','$product_details.floorlevel','error','express','maxperunit','prod_cat','image','9yQIwCV','$product_details.level','Arabic\x20(ae)','master','207070ykMOQi','$product_details.batch_code','padStart','final','/preview/:id','type','Spanish','$sale_product.quantity','$product_details','note','nodemailer','Hindi','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Router','</table>','$invoice','forEach','4519675KgCjbw','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.type','id_transact','</thead>','</span>','Sales\x20Update\x20successfully','$warehouse_name','log','host','date','False','/upload/','An\x20error\x20occurred\x20while\x20saving\x20data.','string','Ambient','errors','Shelves','findById','\x20Order\x20Number\x20:\x20','carton','stock','flash','id_transaction_from','payment\x20successfull','$product_details.storage','warehouse','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Chinese','warehouse_name','secondary_unit','/view/add_sale/product','$product_details.product_code','$product_details.expiry_date','sales_invoice','get','Sales\x20Mail','bay','add\x20post','split','name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','createTransport','expiry_date','customers','$product_details.secondary_code','Enabled','then','product_stock','params','$sale_product.bay','customers_docs','concat','An\x20error\x20occurred.','types','sale_product','sales\x20item\x20return\x20successfull','$product_details.bin','1LxiGka','$product_details.bay','/view/add_sales/:id','English','actual_qty','length','$sale_product.floorlevel','findOne','</td>','Receiving\x20Area','product_name','$product_details._id','bin','post','exports','save','/all_sales/view','$customer','629562NHUOdg','finalize','room_name','Email\x20sent\x20successfully','$product_details.actual_uom','map','$product_details.unit','$room','delivery_code','room','<hr\x20class=\x22my-3\x22>','product_details','product_code','sales_quantity','all_sales','actual_uom','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','barcode\x20Product\x20master','return_qty','floor','product','role','Floor','</tr>','find','secondary_code','<div>','add_sales','user','quantity_notConverted','received_amount','random','$product_details.rack','abs','</body></html>','Sale\x20Return\x20Mail','getMonth','render','/all_sales/preview/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','return_sale','edit_sales_view','<html><head><title></title>','$product_details.primary_code','<tr>','slice','<span\x20style=\x22float:\x20right;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/../public','There\x27s\x20a\x20error\x20in\x20this\x20transaction','German','product_data','4253544jgTnQu','Sales\x20Add\x20successfully','$product_details.actual_qty','253JHCGOn','primary_code','max_per_unit','product_list','French','/view/return_sales/:id','storage','push','RoomAssigned','<h5\x20style=\x22text-align:\x20left;\x22>','amount','staff','all','$product_details.maxPerUnit','level','508054xKTTaL','Logo.png','$product_details.product_stock','sales\x20all_data','return_data','Portuguese\x20(BR)','$product_details.secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$date','aggregate','json','$sale_product.type','/view/add_sales','Sale\x20Return','site_title','stocks','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','78OEVozT','$finalize','OUT-','</h5>','message','max','English\x20(US)','currency','isAllowEdit','Error\x20Occurs','batch_code','$product_details.product_cat','delivery_date','redirect','SCRN','back','user_id','3152120qUUjDg','prod_invoice','due_amount'];a0_0x4548=function(){return _0x5128e5;};return a0_0x4548();}router[a0_0x597c1b(0x214)]('/view/add_sales',auth,async(_0x310251,_0xe4f701)=>{var _0x1c106b=a0_0x597c1b;try{const {username:_0x10eab0,email:_0x4113c1,role:_0x5a955d}=_0x310251[_0x1c106b(0x259)],_0x14c60f=_0x310251[_0x1c106b(0x259)],_0x116c80=await profile[_0x1c106b(0x232)]({'email':_0x14c60f[_0x1c106b(0x2d2)]}),_0x1b012b=await master_shop[_0x1c106b(0x255)](),_0xab87cc=await customer[_0x1c106b(0x255)]({});let _0x34798e;if(_0x14c60f[_0x1c106b(0x252)]=='staff'){const _0x367308=await staff['findOne']({'email':_0x14c60f[_0x1c106b(0x2d2)]});_0x34798e=await warehouse[_0x1c106b(0x28c)]([{'$match':{'status':_0x1c106b(0x21f),'name':_0x367308[_0x1c106b(0x20b)],'warehouse_category':_0x1c106b(0x2b3),'name':{'$ne':_0x1c106b(0x2bc)}}},{'$group':{'_id':'$name','name':{'$first':_0x1c106b(0x2b9)}}},{'$sort':{'name':0x1}}]);}else _0x34798e=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x1c106b(0x2b3),'name':{'$ne':_0x1c106b(0x2bc)}}},{'$group':{'_id':_0x1c106b(0x2b9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x249e3a=await product[_0x1c106b(0x255)]({});var _0x26e5db=[_0x1c106b(0x200),'Enclosed'];const _0x3f4cf9=await sales['find']({}),_0x2a3c6a=_0x3f4cf9[_0x1c106b(0x230)]+0x1,_0x5753ef=_0x1c106b(0x297)+_0x2a3c6a['toString']()[_0x1c106b(0x1e1)](0x5,'0');if(_0x1b012b[0x0][_0x1c106b(0x2c3)]==_0x1c106b(0x29b)){var _0x57cbab=users[_0x1c106b(0x22e)];console[_0x1c106b(0x1f9)](_0x57cbab);}else{if(_0x1b012b[0x0][_0x1c106b(0x2c3)]==_0x1c106b(0x1ea))var _0x57cbab=users[_0x1c106b(0x1ea)];else{if(_0x1b012b[0x0][_0x1c106b(0x2c3)]=='German')var _0x57cbab=users[_0x1c106b(0x26f)];else{if(_0x1b012b[0x0][_0x1c106b(0x2c3)]==_0x1c106b(0x1e5))var _0x57cbab=users[_0x1c106b(0x1e5)];else{if(_0x1b012b[0x0][_0x1c106b(0x2c3)]=='French')var _0x57cbab=users[_0x1c106b(0x278)];else{if(_0x1b012b[0x0][_0x1c106b(0x2c3)]==_0x1c106b(0x288))var _0x57cbab=users[_0x1c106b(0x1f1)];else{if(_0x1b012b[0x0]['language']=='Chinese')var _0x57cbab=users['Chinese'];else{if(_0x1b012b[0x0]['language']==_0x1c106b(0x1dd))var _0x57cbab=users[_0x1c106b(0x2b4)];}}}}}}}const _0x5e8be7=getRandom8DigitNumber();_0x5e8be7[_0x1c106b(0x220)](_0x4ecc3f=>{var _0x1d1c10=_0x1c106b;_0xe4f701[_0x1d1c10(0x262)](_0x1d1c10(0x258),{'success':_0x310251[_0x1d1c10(0x207)]('success'),'errors':_0x310251[_0x1d1c10(0x207)](_0x1d1c10(0x201)),'role':_0x14c60f,'profile':_0x116c80,'customer':_0xab87cc,'warehouse':_0x34798e,'product':_0x249e3a,'invoice':_0x4ecc3f,'master_shop':_0x1b012b,'language':_0x57cbab,'rooms_data':_0x26e5db});})['catch'](_0x5003a0=>{var _0x59dc6b=_0x1c106b;_0x310251[_0x59dc6b(0x207)]('errors',_0x59dc6b(0x26e)),_0xe4f701['redirect']('/all_sales/view');});}catch(_0x489c8d){console[_0x1c106b(0x1f9)](_0x489c8d);}}),router[a0_0x597c1b(0x214)](a0_0x597c1b(0x22d),auth,async(_0xa22f91,_0x1a4f1c)=>{var _0x5b1951=a0_0x597c1b;try{const _0x183d87=_0xa22f91['params']['id'];console[_0x5b1951(0x1f9)](_0x183d87);const _0x584566=await product[_0x5b1951(0x255)](),_0x48709e=await purchases[_0x5b1951(0x28c)]([{'$match':{'warehouse_name':_0x183d87}},{'$unwind':'$product'},{'$group':{'_id':_0x5b1951(0x2d4)}}]);console[_0x5b1951(0x1f9)](_0x5b1951(0x2b1),_0x48709e),_0x1a4f1c['status'](0xc8)[_0x5b1951(0x28d)]({'purchases_data':_0x48709e,'product_data':_0x584566});}catch(_0x5b2b52){console[_0x5b1951(0x1f9)](_0x5b2b52);}}),router['post'](a0_0x597c1b(0x210),auth,async(_0x3446c5,_0x3cd684)=>{var _0x390dd3=a0_0x597c1b;try{const {warehouse_data:_0x541211,product_data:_0x45f9a0}=_0x3446c5[_0x390dd3(0x2c7)];console[_0x390dd3(0x1f9)](_0x3446c5[_0x390dd3(0x2c7)][_0x390dd3(0x270)]);;const _0x58957b=await master_shop[_0x390dd3(0x255)]();console[_0x390dd3(0x1f9)](_0x390dd3(0x1de),_0x58957b);const _0x3aeae5=await product[_0x390dd3(0x232)]({'name':_0x45f9a0});console[_0x390dd3(0x1f9)](_0x390dd3(0x251),_0x3aeae5);const _0x281dd7=await warehouse[_0x390dd3(0x28c)]([{'$match':{'name':_0x541211}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x45f9a0}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x390dd3(0x285)}}}]);console[_0x390dd3(0x1f9)](_0x390dd3(0x2b6),_0x281dd7),_0x3cd684[_0x390dd3(0x2d0)](0xc8)[_0x390dd3(0x28d)]({'master':_0x58957b,'new_product':_0x3aeae5,'stock_data':_0x281dd7});}catch(_0x18c3d2){console[_0x390dd3(0x1f9)](_0x18c3d2);}}),router['post'](a0_0x597c1b(0x28f),auth,async(_0x5524df,_0x441835)=>{var _0x10f7a9=a0_0x597c1b;try{const {invoice:_0x5f34ff,date:_0x369fc6,warehouse_name:_0x299696,product_name:_0x2c3eda,stock:_0x3fbcd0,quantity:_0x33da93,note:_0x993a12,room:_0x6d8fec,primary_code:_0x355aac,secondary_code:_0x14dcd5,prod_code:_0x2b912b,level:_0x5d75f8,isle:_0x2316bc,pallet:_0x398b2a,batch_code:_0x4852d6,SCRN:_0x5b7d61,expiry_date:_0x494333}=_0x5524df[_0x10f7a9(0x2c7)];if(typeof _0x2c3eda==_0x10f7a9(0x1ff))var _0x57920c=[_0x5524df[_0x10f7a9(0x2c7)]['product_name']],_0x811b53=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x206)]],_0x354255=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x205)]],_0x3cb13d=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x275)]],_0x36be90=[_0x5524df[_0x10f7a9(0x2c7)]['secondary_code']],_0x45250b=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2d1)]],_0x35adc3=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x282)]],_0x4f0c4d=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2c4)]],_0x5184ab=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x20f)]],_0x23c93d=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x29f)]],_0x4e050e=[_0x5524df['body'][_0x10f7a9(0x21c)]],_0x526e87=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x276)]],_0x1105a4=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x1ce)]],_0x16d068=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2bb)]],_0x2f3807=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2a1)]],_0x1284e3=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x245)]],_0x11baa4=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x1d9)]],_0x1a6e6d=[_0x5524df[_0x10f7a9(0x2c7)]['quantity']],_0xcb5c7f=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x27c)]],_0x326705=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2a7)]],_0x32edab=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x22f)]],_0x33d4ce=[_0x5524df['body']['actual_uom']],_0x321e4d=[_0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x1f4)]];else var _0x57920c=[..._0x5524df['body'][_0x10f7a9(0x235)]],_0x811b53=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x206)]],_0x354255=[..._0x5524df['body'][_0x10f7a9(0x205)]],_0x3cb13d=[..._0x5524df[_0x10f7a9(0x2c7)]['primary_code']],_0x36be90=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x256)]],_0x45250b=[..._0x5524df['body'][_0x10f7a9(0x2d1)]],_0x35adc3=[..._0x5524df['body'][_0x10f7a9(0x282)]],_0x4f0c4d=[..._0x5524df[_0x10f7a9(0x2c7)]['primary_unit']],_0x5184ab=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x20f)]],_0x23c93d=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x29f)]],_0x4e050e=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x21c)]],_0x526e87=[..._0x5524df['body'][_0x10f7a9(0x276)]],_0x1105a4=[..._0x5524df[_0x10f7a9(0x2c7)]['production_date']],_0x16d068=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2bb)]],_0x2f3807=[..._0x5524df['body'][_0x10f7a9(0x2a1)]],_0x1284e3=[..._0x5524df['body']['delivery_code']],_0x11baa4=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x1d9)]],_0x1a6e6d=[..._0x5524df['body']['quantity']],_0xcb5c7f=[..._0x5524df[_0x10f7a9(0x2c7)]['RoomAssigned']],_0x326705=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x2a7)]],_0x32edab=[..._0x5524df[_0x10f7a9(0x2c7)]['actual_qty']],_0x33d4ce=[..._0x5524df[_0x10f7a9(0x2c7)][_0x10f7a9(0x24c)]],_0x321e4d=[..._0x5524df['body'][_0x10f7a9(0x1f4)]];const _0x31a593=_0x57920c[_0x10f7a9(0x242)](_0x4c968c=>{return _0x4c968c={'product_name':_0x4c968c};});_0x811b53[_0x10f7a9(0x1ef)]((_0x4d838b,_0x379216)=>{var _0xf14642=_0x10f7a9;_0x31a593[_0x379216]['stock']=Math[_0xf14642(0x25e)](_0x4d838b);}),_0x32edab[_0x10f7a9(0x1ef)]((_0xad50b7,_0x16744b)=>{_0x31a593[_0x16744b]['actual_qty']=Math['abs'](_0xad50b7);}),_0x33d4ce[_0x10f7a9(0x1ef)]((_0x292f0a,_0x42ce16)=>{var _0x4cac68=_0x10f7a9;_0x31a593[_0x42ce16][_0x4cac68(0x24c)]=_0x292f0a;}),_0x321e4d[_0x10f7a9(0x1ef)]((_0x3af684,_0x5025d4)=>{_0x31a593[_0x5025d4]['id_transaction_from']=_0x3af684;}),_0x354255[_0x10f7a9(0x1ef)]((_0x4c4ded,_0x1d17cb)=>{var _0x4ccbb8=_0x10f7a9;_0x31a593[_0x1d17cb][_0x4ccbb8(0x2b0)]=_0x4c4ded;}),_0x3cb13d[_0x10f7a9(0x1ef)]((_0x23ee08,_0x335d26)=>{_0x31a593[_0x335d26]['primary_code']=_0x23ee08;}),_0x36be90[_0x10f7a9(0x1ef)]((_0x508b99,_0x26d3e0)=>{var _0x398d7d=_0x10f7a9;_0x31a593[_0x26d3e0][_0x398d7d(0x256)]=_0x508b99;}),_0x45250b[_0x10f7a9(0x1ef)]((_0x1bc140,_0x636573)=>{var _0x24fa2a=_0x10f7a9;_0x31a593[_0x636573][_0x24fa2a(0x249)]=_0x1bc140;}),_0x35adc3['forEach']((_0x1f6450,_0x202ce6)=>{_0xcb5c7f['forEach']((_0x2f4639,_0x3e96d3)=>{var _0x43a3d2=a0_0x2e5e;if(_0x2f4639=='Receiving\x20Area'&&_0x202ce6==_0x3e96d3){var _0x2194ba=_0x1f6450[_0x43a3d2(0x26a)](0x3);_0x31a593[_0x202ce6][_0x43a3d2(0x27a)]=_0x1f6450[0x0],_0x31a593[_0x202ce6]['rack']=_0x1f6450[0x1],_0x31a593[_0x202ce6][_0x43a3d2(0x216)]=0x0,_0x31a593[_0x202ce6][_0x43a3d2(0x237)]=0x0,_0x31a593[_0x202ce6][_0x43a3d2(0x1e4)]='Floor',_0x31a593[_0x202ce6][_0x43a3d2(0x2c1)]=_0x2194ba;}else{if(_0x2f4639=='Shelves'&&_0x202ce6==_0x3e96d3){var _0x2194ba=_0x1f6450[_0x43a3d2(0x26a)](0x3);_0x31a593[_0x202ce6]['storage']=_0x1f6450[0x0],_0x31a593[_0x202ce6]['rack']=_0x1f6450[0x1],_0x31a593[_0x202ce6][_0x43a3d2(0x216)]=0x0,_0x31a593[_0x202ce6][_0x43a3d2(0x237)]=0x0,_0x31a593[_0x202ce6][_0x43a3d2(0x1e4)]='Floor',_0x31a593[_0x202ce6][_0x43a3d2(0x2c1)]=_0x1f6450[0x5];}else{if(_0x202ce6==_0x3e96d3){var _0x460186;if(_0x1f6450[0x4]=='L')_0x460186=_0x43a3d2(0x2c0);else _0x1f6450[0x4]=='F'&&(_0x460186=_0x43a3d2(0x253));_0x31a593[_0x202ce6][_0x43a3d2(0x27a)]=_0x1f6450[0x0],_0x31a593[_0x202ce6][_0x43a3d2(0x2b8)]=_0x1f6450[0x1],_0x31a593[_0x202ce6][_0x43a3d2(0x216)]=_0x1f6450[0x2],_0x31a593[_0x202ce6][_0x43a3d2(0x237)]=_0x1f6450[0x3],_0x31a593[_0x202ce6][_0x43a3d2(0x1e4)]=_0x460186,_0x31a593[_0x202ce6][_0x43a3d2(0x2c1)]=_0x1f6450[0x5];}}}});}),_0x4f0c4d[_0x10f7a9(0x1ef)]((_0x2c16cc,_0x2e694b)=>{var _0x4c6453=_0x10f7a9;_0x31a593[_0x2e694b][_0x4c6453(0x1cd)]=_0x2c16cc;}),_0x5184ab['forEach']((_0x23e7dd,_0x42eb8f)=>{var _0x11fdc8=_0x10f7a9;_0x31a593[_0x42eb8f][_0x11fdc8(0x20f)]=_0x23e7dd;}),_0x23c93d[_0x10f7a9(0x1ef)]((_0x3b6a14,_0x3046f5)=>{_0x31a593[_0x3046f5]['batch_code']=_0x3b6a14;}),_0x4e050e[_0x10f7a9(0x1ef)]((_0x449b56,_0x2b6621)=>{var _0x344e5e=_0x10f7a9;_0x31a593[_0x2b6621][_0x344e5e(0x21c)]=_0x449b56;}),_0x526e87[_0x10f7a9(0x1ef)]((_0x354df7,_0x3c5a23)=>{var _0x106413=_0x10f7a9;_0x31a593[_0x3c5a23][_0x106413(0x1d8)]=_0x354df7;}),_0x1105a4[_0x10f7a9(0x1ef)]((_0x33c5ef,_0x2da2a4)=>{var _0x5d24a5=_0x10f7a9;_0x31a593[_0x2da2a4][_0x5d24a5(0x1ce)]=_0x33c5ef;}),_0x16d068[_0x10f7a9(0x1ef)]((_0x441ca2,_0x3f8cde)=>{var _0x4807e6=_0x10f7a9;_0x31a593[_0x3f8cde][_0x4807e6(0x2bb)]=_0x441ca2;}),_0x2f3807[_0x10f7a9(0x1ef)]((_0x4b0d40,_0x17c249)=>{var _0xf9ce6c=_0x10f7a9;_0x31a593[_0x17c249][_0xf9ce6c(0x2a1)]=_0x4b0d40;}),_0x1284e3['forEach']((_0xf7a5c7,_0x571bc6)=>{_0x31a593[_0x571bc6]['delivery_code']=_0xf7a5c7;}),_0x11baa4['forEach']((_0x4fe251,_0x466630)=>{var _0x47bdac=_0x10f7a9;_0x31a593[_0x466630][_0x47bdac(0x1d9)]=_0x4fe251;}),_0x1a6e6d[_0x10f7a9(0x1ef)]((_0x10f077,_0x47da63)=>{var _0x4e5e7f=_0x10f7a9;_0x31a593[_0x47da63][_0x4e5e7f(0x25a)]=_0x10f077;}),_0xcb5c7f['forEach']((_0x2ba682,_0x4aa95e)=>{_0x31a593[_0x4aa95e]['room_name']=_0x2ba682;}),_0x326705[_0x10f7a9(0x1ef)]((_0x45ac52,_0x449636)=>{var _0x4778a3=_0x10f7a9;_0x31a593[_0x449636][_0x4778a3(0x2ce)]=_0x45ac52;});var _0x3ea9ea=0x0;_0x31a593[_0x10f7a9(0x1ef)](_0x5e0b76=>{var _0x46194f=_0x10f7a9;(_0x5e0b76[_0x46194f(0x206)]<_0x5e0b76[_0x46194f(0x25a)]||_0x5e0b76[_0x46194f(0x25a)]==0x0)&&(console['log']('foreach\x20newproduct',_0x5e0b76),_0x3ea9ea++);});const _0x10e3ce=_0x31a593[_0x10f7a9(0x1c3)](_0x3f84fc=>_0x3f84fc[_0x10f7a9(0x2b0)]!=='0'&&_0x3f84fc[_0x10f7a9(0x2b0)]!==''),_0x4854f5=new sales({'invoice':_0x5f34ff,'customer':_0x5524df[_0x10f7a9(0x2c7)]['customer'],'date':_0x369fc6,'warehouse_name':_0x299696,'sale_product':_0x10e3ce,'note':_0x993a12,'room':_0x6d8fec,'primary_code':_0x355aac,'secondary_code':_0x14dcd5,'prod_code':_0x2b912b,'SCRN':_0x5b7d61}),_0x332ec0=await _0x4854f5[_0x10f7a9(0x23a)]();_0x5524df['flash'](_0x10f7a9(0x1c5),_0x10f7a9(0x272)),_0x441835[_0x10f7a9(0x2a2)](_0x10f7a9(0x263)+_0x332ec0[_0x10f7a9(0x2cc)]);}catch(_0x4a24a7){console[_0x10f7a9(0x1f9)](_0x4a24a7);}}),router[a0_0x597c1b(0x214)](a0_0x597c1b(0x1e3),auth,async(_0x15fdd4,_0x29a5a3)=>{var _0x2dc30f=a0_0x597c1b;try{const {username:_0x39fd94,email:_0x1e8a6d,role:_0x35f5f1}=_0x15fdd4[_0x2dc30f(0x259)],_0x2fd01e=_0x15fdd4['user'],_0x3d9ccb=await profile[_0x2dc30f(0x232)]({'email':_0x2fd01e[_0x2dc30f(0x2d2)]}),_0x25003e=await master_shop[_0x2dc30f(0x255)](),_0x24eae8=_0x15fdd4[_0x2dc30f(0x222)]['id'],_0x32fccd=await sales[_0x2dc30f(0x203)](_0x24eae8),_0x3e12a0=await warehouse[_0x2dc30f(0x28c)]([{'$match':{'name':_0x32fccd['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2dc30f(0x236),'name':{'$first':_0x2dc30f(0x1d3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2dc30f(0x1d5)},'primary_code':{'$first':_0x2dc30f(0x268)},'secondary_code':{'$first':_0x2dc30f(0x21e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2dc30f(0x20a)},'rack':{'$first':_0x2dc30f(0x25d)},'expiry_date':{'$first':_0x2dc30f(0x212)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x2dc30f(0x2b5)}}}]),_0x4abaae=await customer['find']({});let _0x3bede4;if(_0x2fd01e[_0x2dc30f(0x252)]==_0x2dc30f(0x27f)){const _0x47430c=await staff['findOne']({'email':_0x2fd01e[_0x2dc30f(0x2d2)]});_0x3bede4=await warehouse[_0x2dc30f(0x28c)]([{'$match':{'status':_0x2dc30f(0x21f),'name':_0x47430c['warehouse']}},{'$group':{'_id':_0x2dc30f(0x2b9),'name':{'$first':_0x2dc30f(0x2b9)}}}]);}else _0x3bede4=await warehouse[_0x2dc30f(0x28c)]([{'$match':{'status':_0x2dc30f(0x21f)}},{'$group':{'_id':_0x2dc30f(0x2b9),'name':{'$first':'$name'}}}]);const _0x570054=await product[_0x2dc30f(0x255)]({}),_0x489d15=await suppliers['find']({});if(_0x25003e[0x0]['language']==_0x2dc30f(0x29b)){var _0x53aba6=users[_0x2dc30f(0x22e)];console['log'](_0x53aba6);}else{if(_0x25003e[0x0][_0x2dc30f(0x2c3)]=='Hindi')var _0x53aba6=users['Hindi'];else{if(_0x25003e[0x0]['language']==_0x2dc30f(0x26f))var _0x53aba6=users[_0x2dc30f(0x26f)];else{if(_0x25003e[0x0][_0x2dc30f(0x2c3)]=='Spanish')var _0x53aba6=users[_0x2dc30f(0x1e5)];else{if(_0x25003e[0x0]['language']==_0x2dc30f(0x278))var _0x53aba6=users[_0x2dc30f(0x278)];else{if(_0x25003e[0x0][_0x2dc30f(0x2c3)]=='Portuguese\x20(BR)')var _0x53aba6=users[_0x2dc30f(0x1f1)];else{if(_0x25003e[0x0]['language']==_0x2dc30f(0x20d))var _0x53aba6=users['Chinese'];else{if(_0x25003e[0x0]['language']=='Arabic\x20(ae)')var _0x53aba6=users[_0x2dc30f(0x2b4)];}}}}}}}_0x29a5a3[_0x2dc30f(0x262)](_0x2dc30f(0x266),{'success':_0x15fdd4[_0x2dc30f(0x207)](_0x2dc30f(0x1c5)),'errors':_0x15fdd4['flash'](_0x2dc30f(0x201)),'role':_0x2fd01e,'profile':_0x3d9ccb,'customer':_0x4abaae,'warehouse':_0x3bede4,'product':_0x3e12a0,'user':_0x32fccd,'master_shop':_0x25003e,'unit':_0x570054,'language':_0x53aba6,'suppliers':_0x489d15});}catch(_0x38706c){console[_0x2dc30f(0x1f9)](_0x38706c);}}),router['post'](a0_0x597c1b(0x1e3),auth,async(_0x44cd33,_0x59a337)=>{var _0x474ac0=a0_0x597c1b;try{const _0x203338=_0x44cd33[_0x474ac0(0x222)]['id'],{invoice:_0x46299c,warehouse_name:_0x1bdc32,room:_0xee73ad}=_0x44cd33[_0x474ac0(0x2c7)],_0xfd8136=await sales[_0x474ac0(0x232)]({'invoice':_0x46299c}),_0x38ed77=_0xfd8136[_0x474ac0(0x228)][_0x474ac0(0x242)](async _0x58a27f=>{var _0x2254a7=_0x474ac0,_0x3a97da=await warehouse[_0x2254a7(0x232)]({'name':_0x1bdc32,'room':_0x58a27f['room_name'],'warehouse_category':_0x2254a7(0x2b3)});const _0x188cdf=_0x3a97da['product_details'][_0x2254a7(0x242)](_0x126dbf=>{var _0x3476d8=_0x2254a7;_0x126dbf[_0x3476d8(0x235)]==_0x58a27f[_0x3476d8(0x235)]&&_0x126dbf['floorlevel']==_0x58a27f[_0x3476d8(0x2c1)]&&_0x126dbf[_0x3476d8(0x1e4)]==_0x58a27f[_0x3476d8(0x1e4)]&&_0x126dbf['bin']==_0x58a27f[_0x3476d8(0x237)]&&_0x126dbf[_0x3476d8(0x216)]==_0x58a27f[_0x3476d8(0x216)]&&_0x126dbf[_0x3476d8(0x2b8)]==_0x58a27f[_0x3476d8(0x2b8)]&&_0x126dbf[_0x3476d8(0x27a)]==_0x58a27f[_0x3476d8(0x27a)]&&_0x126dbf[_0x3476d8(0x21c)]==_0x58a27f['expiry_date']&&_0x126dbf[_0x3476d8(0x29f)]==_0x58a27f[_0x3476d8(0x29f)]&&_0x126dbf['invoice']==_0x58a27f[_0x3476d8(0x2ce)]&&_0x126dbf[_0x3476d8(0x2cc)]==_0x58a27f[_0x3476d8(0x208)]&&(_0x126dbf[_0x3476d8(0x221)]=Math[_0x3476d8(0x29a)](0x0,Math[_0x3476d8(0x25e)](_0x126dbf[_0x3476d8(0x221)])-Math[_0x3476d8(0x25e)](_0x58a27f[_0x3476d8(0x2b0)])));});return _0x3a97da;});Promise[_0x474ac0(0x280)](_0x38ed77)['then'](async _0x58bf51=>{var _0x3fd40d=_0x474ac0;try{for(const _0x3dac4c of _0x58bf51){await _0x3dac4c[_0x3fd40d(0x23a)]();}_0xfd8136[_0x3fd40d(0x23e)]=_0x3fd40d(0x2c9);const _0x11bc1b=await _0xfd8136[_0x3fd40d(0x23a)](),_0x5ed281=await master_shop[_0x3fd40d(0x255)](),_0x3f1b71=await email_settings[_0x3fd40d(0x232)](),_0x149215=await supervisor_settings[_0x3fd40d(0x255)]();var _0x57e7e9=_0xfd8136[_0x3fd40d(0x228)],_0x6c39d6='',_0x220cd2;for(_0x220cd2 in _0x57e7e9){_0x6c39d6+=_0x3fd40d(0x269)+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2][_0x3fd40d(0x235)]+_0x3fd40d(0x233)+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2][_0x3fd40d(0x249)]+'</td>'+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2][_0x3fd40d(0x2b0)]+_0x3fd40d(0x233)+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2][_0x3fd40d(0x1cd)]+_0x3fd40d(0x233)+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2]['secondary_unit']+_0x3fd40d(0x233)+_0x3fd40d(0x2bf)+_0xfd8136[_0x3fd40d(0x20e)]+_0x3fd40d(0x233)+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2][_0x3fd40d(0x23f)]+_0x3fd40d(0x233)+_0x3fd40d(0x2bf)+_0x57e7e9[_0x220cd2][_0x3fd40d(0x27a)]+_0x57e7e9[_0x220cd2][_0x3fd40d(0x2b8)]+_0x57e7e9[_0x220cd2]['bay']+_0x57e7e9[_0x220cd2]['bin']+_0x57e7e9[_0x220cd2][_0x3fd40d(0x1e4)][0x0]+_0x57e7e9[_0x220cd2]['floorlevel']+_0x3fd40d(0x233),_0x3fd40d(0x254);}let _0x133583=nodemailer[_0x3fd40d(0x21b)]({'host':_0x3f1b71[_0x3fd40d(0x1fa)],'port':Number(_0x3f1b71[_0x3fd40d(0x2c2)]),'secure':![],'auth':{'user':_0x3f1b71[_0x3fd40d(0x2d2)],'pass':_0x3f1b71[_0x3fd40d(0x2ae)]}}),_0x5a198e={'from':_0x3f1b71[_0x3fd40d(0x2d2)],'to':_0x149215[0x0][_0x3fd40d(0x2b7)],'subject':_0x3fd40d(0x215),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x3fd40d(0x1fd)+_0x5ed281[0x0][_0x3fd40d(0x1da)],'cid':'logo'}],'html':_0x3fd40d(0x2ac)+_0x3fd40d(0x267)+'</head><body>'+_0x3fd40d(0x257)+_0x3fd40d(0x20c)+_0x3fd40d(0x257)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x3fd40d(0x257)+'<h2>\x20'+_0x5ed281[0x0]['site_title']+'\x20</h2>'+_0x3fd40d(0x2ba)+_0x3fd40d(0x2ba)+'<hr\x20class=\x22my-3\x22>'+_0x3fd40d(0x257)+_0x3fd40d(0x27d)+_0x3fd40d(0x204)+_0xfd8136[_0x3fd40d(0x2ce)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3fd40d(0x2af)+_0xfd8136['date']+'\x20'+_0x3fd40d(0x1f6)+_0x3fd40d(0x298)+_0x3fd40d(0x2ba)+_0x3fd40d(0x264)+_0x3fd40d(0x26c)+_0x3fd40d(0x269)+_0x3fd40d(0x2d5)+_0x3fd40d(0x1cf)+_0x3fd40d(0x21a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x3fd40d(0x2cd)+_0x3fd40d(0x294)+_0x3fd40d(0x28a)+_0x3fd40d(0x24d)+_0x3fd40d(0x254)+'</thead>'+_0x3fd40d(0x2d3)+'\x20'+_0x6c39d6+'\x20'+_0x3fd40d(0x1cb)+'</table>'+_0x3fd40d(0x257)+_0x3fd40d(0x2ad)+_0x3fd40d(0x2b2)+_0x5ed281[0x0][_0x3fd40d(0x291)]+_0x3fd40d(0x298)+'</div>'+'</div>'+_0x3fd40d(0x25f)};_0x133583[_0x3fd40d(0x2bd)](_0x5a198e,function(_0x4e1bb7,_0x5d1ef2){var _0x209d55=_0x3fd40d;_0x4e1bb7?(console['log'](_0x4e1bb7),console[_0x209d55(0x1f9)](_0x209d55(0x29e))):console[_0x209d55(0x1f9)](_0x209d55(0x240));}),_0x44cd33[_0x3fd40d(0x207)](_0x3fd40d(0x1c5),_0x3fd40d(0x1f7)),_0x59a337[_0x3fd40d(0x2a2)]('/all_sales/preview/'+_0x203338);}catch(_0x8939f9){console['error'](_0x8939f9),_0x59a337[_0x3fd40d(0x2d0)](0x1f4)['json']({'error':_0x3fd40d(0x1fe)});}})['catch'](_0x1c56fb=>{var _0x29be59=_0x474ac0;console[_0x29be59(0x1d6)](_0x1c56fb),_0x59a337['status'](0x1f4)['json']({'error':_0x29be59(0x226)});});}catch(_0x20a5e9){console[_0x474ac0(0x1f9)](_0x20a5e9);}}),router[a0_0x597c1b(0x214)](a0_0x597c1b(0x1c9),auth,async(_0x582ecd,_0x3ff9b6)=>{var _0x4cedb4=a0_0x597c1b;try{const {username:_0x1c7cca,email:_0xee15ac,role:_0x332ee7}=_0x582ecd[_0x4cedb4(0x259)],_0x4f523c=_0x582ecd[_0x4cedb4(0x259)],_0xd7ee95=await profile[_0x4cedb4(0x232)]({'email':_0x4f523c[_0x4cedb4(0x2d2)]}),_0x4b11e0=await master_shop['find'](),_0x1c8182=_0x582ecd[_0x4cedb4(0x222)]['id'],_0x15ba1d=await sales['findById'](_0x1c8182);var _0x5dec58=['Ambient','Enclosed'];const _0x3b1391=await warehouse[_0x4cedb4(0x28c)]([{'$match':{'name':_0x15ba1d[_0x4cedb4(0x20e)],'warehouse_category':_0x4cedb4(0x2b3)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4cedb4(0x285)},'bay':{'$first':_0x4cedb4(0x22c)},'bin':{'$first':_0x4cedb4(0x22a)},'type':{'$first':_0x4cedb4(0x1f3)},'floorlevel':{'$first':_0x4cedb4(0x1d5)},'primary_code':{'$first':_0x4cedb4(0x268)},'secondary_code':{'$first':_0x4cedb4(0x21e)},'product_code':{'$first':_0x4cedb4(0x211)},'storage':{'$first':_0x4cedb4(0x20a)},'rack':{'$first':_0x4cedb4(0x25d)}}}]),_0x4f208c=await customer['find']({});let _0x3f8eb5;if(_0x4f523c[_0x4cedb4(0x252)]==_0x4cedb4(0x27f)){const _0x5267b5=await staff[_0x4cedb4(0x232)]({'email':_0x4f523c['email']});_0x3f8eb5=await warehouse['aggregate']([{'$match':{'status':_0x4cedb4(0x21f),'name':_0x5267b5['warehouse'],'warehouse_category':_0x4cedb4(0x2b3)}},{'$group':{'_id':_0x4cedb4(0x2b9),'name':{'$first':_0x4cedb4(0x2b9)}}}]);}else _0x3f8eb5=await warehouse[_0x4cedb4(0x28c)]([{'$match':{'status':_0x4cedb4(0x21f),'warehouse_category':_0x4cedb4(0x2b3)}},{'$group':{'_id':_0x4cedb4(0x2b9),'name':{'$first':_0x4cedb4(0x2b9)}}}]);const _0x438040=await product['find']({});if(_0x4b11e0[0x0][_0x4cedb4(0x2c3)]==_0x4cedb4(0x29b)){var _0x56edec=users[_0x4cedb4(0x22e)];console[_0x4cedb4(0x1f9)](_0x56edec);}else{if(_0x4b11e0[0x0][_0x4cedb4(0x2c3)]=='Hindi')var _0x56edec=users['Hindi'];else{if(_0x4b11e0[0x0][_0x4cedb4(0x2c3)]==_0x4cedb4(0x26f))var _0x56edec=users[_0x4cedb4(0x26f)];else{if(_0x4b11e0[0x0]['language']==_0x4cedb4(0x1e5))var _0x56edec=users['Spanish'];else{if(_0x4b11e0[0x0][_0x4cedb4(0x2c3)]=='French')var _0x56edec=users[_0x4cedb4(0x278)];else{if(_0x4b11e0[0x0][_0x4cedb4(0x2c3)]==_0x4cedb4(0x288))var _0x56edec=users['Portuguese'];else{if(_0x4b11e0[0x0][_0x4cedb4(0x2c3)]==_0x4cedb4(0x20d))var _0x56edec=users[_0x4cedb4(0x20d)];else{if(_0x4b11e0[0x0]['language']==_0x4cedb4(0x1dd))var _0x56edec=users[_0x4cedb4(0x2b4)];}}}}}}}_0x3ff9b6[_0x4cedb4(0x262)]('edit_sales',{'success':_0x582ecd[_0x4cedb4(0x207)](_0x4cedb4(0x1c5)),'errors':_0x582ecd[_0x4cedb4(0x207)]('errors'),'role':_0x4f523c,'profile':_0xd7ee95,'customer':_0x4f208c,'warehouse':_0x3f8eb5,'product':_0x3b1391,'user':_0x15ba1d,'master_shop':_0x4b11e0,'unit':_0x438040,'language':_0x56edec});}catch(_0xf3cf38){console['log'](_0xf3cf38);}}),router[a0_0x597c1b(0x238)](a0_0x597c1b(0x1c9),auth,async(_0x22b9ee,_0x600a24)=>{var _0x2ed4ac=a0_0x597c1b;try{const _0x1deba2=_0x22b9ee[_0x2ed4ac(0x222)]['id'],_0x321e12=await sales[_0x2ed4ac(0x232)]({'_id':_0x22b9ee[_0x2ed4ac(0x222)]['id']}),_0x2c13a5=await warehouse[_0x2ed4ac(0x232)]({'name':_0x321e12[_0x2ed4ac(0x20e)],'room':_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x246)]}),{invoice:_0x25187f,date:_0x2c39c0,warehouse_name:_0x39ada6,product_name:_0x36aa30,stock:_0x333f8a,quantity:_0x266cf7,note:_0x3f6856,room:_0x5abcd2,customer:_0x540a58,SCRN:_0x5ee8b0}=_0x22b9ee[_0x2ed4ac(0x2c7)];if(typeof _0x36aa30==_0x2ed4ac(0x1ff))var _0x1c618b=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x235)]],_0x4b94de=[_0x22b9ee['body'][_0x2ed4ac(0x206)]],_0x207cae=[_0x22b9ee['body'][_0x2ed4ac(0x205)]],_0x1286e3=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x275)]],_0x308dc1=[_0x22b9ee['body'][_0x2ed4ac(0x256)]],_0x56ada0=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x2d1)]],_0x142c89=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x282)]],_0x1d0496=[_0x22b9ee['body'][_0x2ed4ac(0x2c4)]],_0x59935e=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x20f)]],_0x7dd80a=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x29f)]],_0x47ec9a=[_0x22b9ee['body'][_0x2ed4ac(0x21c)]],_0x21ad14=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x276)]],_0x41359e=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x1ce)]],_0x4dc631=[_0x22b9ee[_0x2ed4ac(0x2c7)]['requested_qty']],_0x4914e=[_0x22b9ee[_0x2ed4ac(0x2c7)]['delivery_date']],_0xe6ac43=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x245)]],_0x568dfb=[_0x22b9ee[_0x2ed4ac(0x2c7)]['prod_cat']],_0xece196=[_0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x2b0)]],_0x1a43cb=[_0x22b9ee[_0x2ed4ac(0x2c7)]['RoomAssigned']];else var _0x1c618b=[..._0x22b9ee['body'][_0x2ed4ac(0x235)]],_0x4b94de=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x206)]],_0x207cae=[..._0x22b9ee[_0x2ed4ac(0x2c7)]['carton']],_0x1286e3=[..._0x22b9ee[_0x2ed4ac(0x2c7)]['primary_code']],_0x308dc1=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x256)]],_0x56ada0=[..._0x22b9ee['body'][_0x2ed4ac(0x2d1)]],_0x142c89=[..._0x22b9ee['body'][_0x2ed4ac(0x282)]],_0x1d0496=[..._0x22b9ee['body'][_0x2ed4ac(0x2c4)]],_0x59935e=[..._0x22b9ee[_0x2ed4ac(0x2c7)]['secondary_unit']],_0x7dd80a=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x29f)]],_0x47ec9a=[..._0x22b9ee['body'][_0x2ed4ac(0x21c)]],_0x21ad14=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x276)]],_0x41359e=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x1ce)]],_0x4dc631=[..._0x22b9ee[_0x2ed4ac(0x2c7)]['requested_qty']],_0x4914e=[..._0x22b9ee['body'][_0x2ed4ac(0x2a1)]],_0xe6ac43=[..._0x22b9ee[_0x2ed4ac(0x2c7)]['delivery_code']],_0x568dfb=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x1d9)]],_0xece196=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x2b0)]],_0x1a43cb=[..._0x22b9ee[_0x2ed4ac(0x2c7)][_0x2ed4ac(0x27c)]];const _0x41f212=_0x1c618b[_0x2ed4ac(0x242)](_0x4ef774=>{return _0x4ef774={'product_name':_0x4ef774};});_0x4b94de['forEach']((_0x127952,_0x17f41d)=>{var _0x350ca5=_0x2ed4ac;_0x41f212[_0x17f41d][_0x350ca5(0x206)]=Math[_0x350ca5(0x25e)](_0x127952);}),_0x207cae[_0x2ed4ac(0x1ef)]((_0x1c7576,_0x2a9c5e)=>{var _0x35c784=_0x2ed4ac;_0x41f212[_0x2a9c5e][_0x35c784(0x2b0)]=_0x1c7576;}),_0x1286e3['forEach']((_0x18c7f2,_0x29190b)=>{_0x41f212[_0x29190b]['primary_code']=_0x18c7f2;}),_0x308dc1['forEach']((_0x358f84,_0xec8338)=>{var _0x1381fd=_0x2ed4ac;_0x41f212[_0xec8338][_0x1381fd(0x256)]=_0x358f84;}),_0x56ada0['forEach']((_0x5bd035,_0x56ba0f)=>{_0x41f212[_0x56ba0f]['product_code']=_0x5bd035;}),_0x142c89[_0x2ed4ac(0x1ef)]((_0x3ae847,_0x3b4dd6)=>{var _0xfa4bc5=_0x2ed4ac;_0x1a43cb[_0xfa4bc5(0x1ef)]((_0x437d38,_0x580313)=>{var _0x6b475=_0xfa4bc5;if(_0x437d38==_0x6b475(0x234)&&_0x3b4dd6==_0x580313){var _0x328969=_0x3ae847[_0x6b475(0x26a)](0x3);_0x41f212[_0x3b4dd6][_0x6b475(0x27a)]=_0x3ae847[0x0],_0x41f212[_0x3b4dd6][_0x6b475(0x2b8)]=_0x3ae847[0x1],_0x41f212[_0x3b4dd6]['bay']=0x0,_0x41f212[_0x3b4dd6]['bin']=0x0,_0x41f212[_0x3b4dd6]['type']='Floor',_0x41f212[_0x3b4dd6][_0x6b475(0x2c1)]=_0x328969;}else{if(_0x437d38==_0x6b475(0x202)&&_0x3b4dd6==_0x580313){var _0x328969=_0x3ae847[_0x6b475(0x26a)](0x3);_0x41f212[_0x3b4dd6][_0x6b475(0x27a)]=_0x3ae847[0x0],_0x41f212[_0x3b4dd6][_0x6b475(0x2b8)]=_0x3ae847[0x1],_0x41f212[_0x3b4dd6][_0x6b475(0x216)]=0x0,_0x41f212[_0x3b4dd6]['bin']=0x0,_0x41f212[_0x3b4dd6][_0x6b475(0x1e4)]=_0x6b475(0x253),_0x41f212[_0x3b4dd6][_0x6b475(0x2c1)]=_0x3ae847[0x5];}else{if(_0x3b4dd6==_0x580313){var _0x57c3af;if(_0x3ae847[0x4]=='L')_0x57c3af=_0x6b475(0x2c0);else _0x3ae847[0x4]=='F'&&(_0x57c3af=_0x6b475(0x253));_0x41f212[_0x3b4dd6][_0x6b475(0x27a)]=_0x3ae847[0x0],_0x41f212[_0x3b4dd6][_0x6b475(0x2b8)]=_0x3ae847[0x1],_0x41f212[_0x3b4dd6][_0x6b475(0x216)]=_0x3ae847[0x2],_0x41f212[_0x3b4dd6][_0x6b475(0x237)]=_0x3ae847[0x3],_0x41f212[_0x3b4dd6]['type']=_0x57c3af,_0x41f212[_0x3b4dd6][_0x6b475(0x2c1)]=_0x3ae847[0x5];}}}});}),_0x1d0496[_0x2ed4ac(0x1ef)]((_0x5065dd,_0x560395)=>{_0x41f212[_0x560395]['unit']=_0x5065dd;}),_0x59935e['forEach']((_0x277362,_0x149003)=>{var _0x4745f7=_0x2ed4ac;_0x41f212[_0x149003][_0x4745f7(0x20f)]=_0x277362;}),_0x7dd80a[_0x2ed4ac(0x1ef)]((_0x1ff0cf,_0x5c922b)=>{var _0x2572b5=_0x2ed4ac;_0x41f212[_0x5c922b][_0x2572b5(0x29f)]=_0x1ff0cf;}),_0x47ec9a[_0x2ed4ac(0x1ef)]((_0x3e574e,_0x1390ab)=>{var _0x567d8e=_0x2ed4ac;_0x41f212[_0x1390ab][_0x567d8e(0x21c)]=_0x3e574e;}),_0x21ad14[_0x2ed4ac(0x1ef)]((_0x47a1f6,_0x52d3b4)=>{var _0x6b6ee9=_0x2ed4ac;_0x41f212[_0x52d3b4][_0x6b6ee9(0x1d8)]=_0x47a1f6;}),_0x41359e[_0x2ed4ac(0x1ef)]((_0x483c0b,_0x1af27d)=>{_0x41f212[_0x1af27d]['production_date']=_0x483c0b;}),_0x4dc631[_0x2ed4ac(0x1ef)]((_0x18c938,_0x14bb31)=>{var _0xbb401d=_0x2ed4ac;_0x41f212[_0x14bb31][_0xbb401d(0x2bb)]=Math['abs'](_0x18c938);}),_0x4914e[_0x2ed4ac(0x1ef)]((_0x5f5081,_0x2f03dd)=>{var _0x10ab18=_0x2ed4ac;_0x41f212[_0x2f03dd][_0x10ab18(0x2a1)]=_0x5f5081;}),_0xe6ac43[_0x2ed4ac(0x1ef)]((_0x230f4c,_0x31496d)=>{_0x41f212[_0x31496d]['delivery_code']=_0x230f4c;}),_0x568dfb[_0x2ed4ac(0x1ef)]((_0xb0729b,_0x491e8b)=>{var _0x14c2b4=_0x2ed4ac;_0x41f212[_0x491e8b][_0x14c2b4(0x1d9)]=_0xb0729b;}),_0xece196['forEach']((_0x3f9592,_0x44db81)=>{var _0x47d96e=_0x2ed4ac;_0x41f212[_0x44db81][_0x47d96e(0x25a)]=_0x3f9592;}),_0x1a43cb[_0x2ed4ac(0x1ef)]((_0x29cba0,_0x79e647)=>{var _0x5bee8b=_0x2ed4ac;_0x41f212[_0x79e647][_0x5bee8b(0x23f)]=_0x29cba0;});var _0x4d516a=0x0;_0x41f212['forEach'](_0x4cca19=>{var _0x7f67ce=_0x2ed4ac;console[_0x7f67ce(0x1f9)]('foreach\x20newproduct',_0x4cca19),(parseInt(_0x4cca19['stock'])<parseInt(_0x4cca19[_0x7f67ce(0x2b0)])||parseInt(_0x4cca19[_0x7f67ce(0x2b0)])==0x0)&&_0x4d516a++;});if(_0x4d516a!=0x0)return _0x22b9ee['flash'](_0x2ed4ac(0x201),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x600a24['redirect']('back');const _0x786997=_0x41f212[_0x2ed4ac(0x1c3)](_0x52f7ec=>_0x52f7ec['quantity']!=='0'&&_0x52f7ec[_0x2ed4ac(0x2b0)]!=='');_0x321e12[_0x2ed4ac(0x2ce)]=_0x25187f,_0x321e12[_0x2ed4ac(0x1c8)]=_0x540a58,_0x321e12[_0x2ed4ac(0x1fb)]=_0x2c39c0,_0x321e12[_0x2ed4ac(0x20e)]=_0x39ada6,_0x321e12[_0x2ed4ac(0x228)]=_0x786997,_0x321e12[_0x2ed4ac(0x1e8)]=_0x3f6856,_0x321e12[_0x2ed4ac(0x2a3)]=_0x5ee8b0,_0x321e12[_0x2ed4ac(0x23e)]=_0x2ed4ac(0x1fc),_0x321e12[_0x2ed4ac(0x29d)]='False';const _0x301205=await _0x321e12['save']();_0x22b9ee[_0x2ed4ac(0x207)](_0x2ed4ac(0x1c5),_0x2ed4ac(0x1f7)),_0x600a24[_0x2ed4ac(0x2a2)](_0x2ed4ac(0x23b));}catch(_0x36db53){console[_0x2ed4ac(0x1f9)](_0x36db53);}}),router[a0_0x597c1b(0x238)]('/give_payment/:id',auth,async(_0x466b32,_0x5799af)=>{var _0x4702bf=a0_0x597c1b;try{const _0xab0d04=_0x466b32[_0x4702bf(0x222)]['id'],{invoice:_0xdbda28,customer:_0x547d27,receivable_amount:_0xbc9df,received_amount:_0xc27468}=_0x466b32['body'],_0x3aef3a=await sales[_0x4702bf(0x203)](_0xab0d04);console['log'](_0x3aef3a);var _0x2802f2=_0xbc9df-_0xc27468;console[_0x4702bf(0x1f9)](_0xc27468),_0x3aef3a[_0x4702bf(0x25b)]=parseFloat(_0xc27468)+parseFloat(_0x3aef3a[_0x4702bf(0x25b)]),_0x3aef3a[_0x4702bf(0x2a8)]=_0x2802f2,console[_0x4702bf(0x1f9)](_0x3aef3a);const _0x5ee663=await _0x3aef3a[_0x4702bf(0x23a)](),_0x40d6d=await c_payment_data[_0x4702bf(0x232)]({'invoice':_0xdbda28});_0x40d6d[_0x4702bf(0x27e)]=_0x2802f2,await _0x40d6d[_0x4702bf(0x23a)]();let _0x37120f=new Date(),_0x326729=('0'+_0x37120f[_0x4702bf(0x2cb)]())[_0x4702bf(0x26a)](-0x2),_0x5c639c=('0'+(_0x37120f[_0x4702bf(0x261)]()+0x1))[_0x4702bf(0x26a)](-0x2),_0x52caec=_0x37120f['getFullYear'](),_0x3a3f95=_0x52caec+'-'+_0x5c639c+'-'+_0x326729;const _0x3db690=new customer_payment({'invoice':_0xdbda28,'date':_0x52caec+'-'+_0x5c639c+'-'+_0x326729,'customer':_0x547d27,'reason':_0x4702bf(0x1c4),'amount':_0xc27468}),_0x43c1f6=await _0x3db690[_0x4702bf(0x23a)]();_0x466b32[_0x4702bf(0x207)](_0x4702bf(0x1c5),_0x4702bf(0x209)),_0x5799af[_0x4702bf(0x2a2)](_0x4702bf(0x23b));}catch(_0x242af9){console['log'](_0x242af9);}}),router[a0_0x597c1b(0x214)]('/invoice/:id',auth,async(_0x494610,_0x282ee7)=>{var _0x533167=a0_0x597c1b;try{const {username:_0x47e720,email:_0x1d2fb5,role:_0x5ae7cb}=_0x494610['user'],_0xf24123=_0x494610['user'],_0x4e2c8f=await profile[_0x533167(0x232)]({'email':_0xf24123['email']}),_0x52f02d=await master_shop[_0x533167(0x255)]();console['log'](_0x533167(0x1de),_0x52f02d);const _0x19677f=_0x494610[_0x533167(0x222)]['id'],_0x39c768=await sales['findById'](_0x19677f);console[_0x533167(0x1f9)](_0x39c768);const _0x17764d=await customer[_0x533167(0x232)]({'name':_0x39c768[_0x533167(0x1c8)]});console[_0x533167(0x1f9)](_0x17764d);if(_0x52f02d[0x0][_0x533167(0x2c3)]==_0x533167(0x29b)){var _0x1e8f82=users[_0x533167(0x22e)];console[_0x533167(0x1f9)](_0x1e8f82);}else{if(_0x52f02d[0x0]['language']=='Hindi')var _0x1e8f82=users[_0x533167(0x1ea)];else{if(_0x52f02d[0x0][_0x533167(0x2c3)]=='German')var _0x1e8f82=users['German'];else{if(_0x52f02d[0x0][_0x533167(0x2c3)]==_0x533167(0x1e5))var _0x1e8f82=users[_0x533167(0x1e5)];else{if(_0x52f02d[0x0][_0x533167(0x2c3)]==_0x533167(0x278))var _0x1e8f82=users[_0x533167(0x278)];else{if(_0x52f02d[0x0][_0x533167(0x2c3)]=='Portuguese\x20(BR)')var _0x1e8f82=users[_0x533167(0x1f1)];else{if(_0x52f02d[0x0][_0x533167(0x2c3)]==_0x533167(0x20d))var _0x1e8f82=users[_0x533167(0x20d)];else{if(_0x52f02d[0x0][_0x533167(0x2c3)]==_0x533167(0x1dd))var _0x1e8f82=users['Arabic'];}}}}}}}_0x282ee7[_0x533167(0x262)](_0x533167(0x213),{'success':_0x494610[_0x533167(0x207)]('success'),'errors':_0x494610[_0x533167(0x207)](_0x533167(0x201)),'role':_0xf24123,'profile':_0x4e2c8f,'master_shop':_0x52f02d,'customers':_0x17764d,'sales':_0x39c768,'language':_0x1e8f82});}catch(_0x5025eb){console[_0x533167(0x1f9)](_0x5025eb);}}),router[a0_0x597c1b(0x214)]('/view/return_sales/:id',auth,async(_0x2e0c16,_0x152abc)=>{var _0x2c6932=a0_0x597c1b;try{const {username:_0x313b62,email:_0x37d085,role:_0x1d6e7e}=_0x2e0c16[_0x2c6932(0x259)],_0x403843=_0x2e0c16[_0x2c6932(0x259)],_0x570fc6=await profile[_0x2c6932(0x232)]({'email':_0x403843['email']}),_0x1ac548=await master_shop['find']();console['log'](_0x2c6932(0x1de),_0x1ac548);const _0x31c792=_0x2e0c16[_0x2c6932(0x222)]['id'];console[_0x2c6932(0x1f9)](_0x31c792);const _0xd923ed=await sales[_0x2c6932(0x203)](_0x31c792);console[_0x2c6932(0x1f9)](_0x2c6932(0x2a5),_0xd923ed);const _0x425789=await warehouse[_0x2c6932(0x28c)]([{'$match':{'name':_0x2c6932(0x2bc),'room':_0x2c6932(0x2ab)}},{'$unwind':_0x2c6932(0x1e7)},{'$group':{'_id':_0x2c6932(0x236),'name':{'$first':_0x2c6932(0x1d3)},'product_stock':{'$first':_0x2c6932(0x285)},'level':{'$first':_0x2c6932(0x1dc)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x2c6932(0x1d4)},'primary_code':{'$first':_0x2c6932(0x268)},'secondary_code':{'$first':_0x2c6932(0x21e)},'product_code':{'$first':_0x2c6932(0x211)}}}]);console[_0x2c6932(0x1f9)]('stock_data',_0x425789);const _0x13d7a8=await product['find']({});warehouse_data=await warehouse[_0x2c6932(0x28c)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2c6932(0x2b9),'name':{'$first':_0x2c6932(0x2b9)}}},{'$sort':{'name':0x1}}]);var _0x42f343=[_0x2c6932(0x2ab)];if(_0x1ac548[0x0][_0x2c6932(0x2c3)]==_0x2c6932(0x29b)){var _0x3556e5=users[_0x2c6932(0x22e)];console['log'](_0x3556e5);}else{if(_0x1ac548[0x0][_0x2c6932(0x2c3)]=='Hindi')var _0x3556e5=users['Hindi'];else{if(_0x1ac548[0x0][_0x2c6932(0x2c3)]=='German')var _0x3556e5=users[_0x2c6932(0x26f)];else{if(_0x1ac548[0x0][_0x2c6932(0x2c3)]==_0x2c6932(0x1e5))var _0x3556e5=users[_0x2c6932(0x1e5)];else{if(_0x1ac548[0x0][_0x2c6932(0x2c3)]==_0x2c6932(0x278))var _0x3556e5=users[_0x2c6932(0x278)];else{if(_0x1ac548[0x0]['language']==_0x2c6932(0x288))var _0x3556e5=users[_0x2c6932(0x1f1)];else{if(_0x1ac548[0x0]['language']==_0x2c6932(0x20d))var _0x3556e5=users[_0x2c6932(0x20d)];else{if(_0x1ac548[0x0][_0x2c6932(0x2c3)]==_0x2c6932(0x1dd))var _0x3556e5=users['Arabic'];}}}}}}}_0x152abc[_0x2c6932(0x262)]('return_sale',{'success':_0x2e0c16[_0x2c6932(0x207)](_0x2c6932(0x1c5)),'errors':_0x2e0c16[_0x2c6932(0x207)](_0x2c6932(0x201)),'role':_0x403843,'profile':_0x570fc6,'user':_0xd923ed,'stock':_0x425789,'master_shop':_0x1ac548,'unit':_0x13d7a8,'language':_0x3556e5,'warehouses':warehouse_data,'rooms':_0x42f343});}catch(_0x2d12dc){console['log'](_0x2d12dc),_0x152abc[_0x2c6932(0x2d0)](0xc8)[_0x2c6932(0x28d)]({'message':_0x2d12dc[_0x2c6932(0x299)]});}}),router['post'](a0_0x597c1b(0x279),auth,async(_0x5d48ea,_0x5d9ca2)=>{var _0x228ec0=a0_0x597c1b;try{const {invoice:_0x393f3c,date:_0x5c2f00,warehouse_name:_0x5eaf7d,product_name:_0x46dc47,primary_code:_0x2b24ae,secondary_code:_0x378392,product_code:_0x17833c,sales_quantity:_0x1f6c02,stocks:_0xab544e,return_qty:_0x38b368,Room_name:_0x4aa372,to_warehouse_name:_0x29f4eb,to_Roomname:_0x38b5f4,to_Room_name:_0x29a437,note:_0x55935e,level:_0x1e9bc3,isle:_0x51f7d4,pallet:_0x263f54}=_0x5d48ea[_0x228ec0(0x2c7)];if(typeof _0x46dc47==_0x228ec0(0x1ff))var _0x173f81=[_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x235)]],_0x9e37f7=[_0x5d48ea[_0x228ec0(0x2c7)]['primary_code']],_0x4f1b8c=[_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x256)]],_0x43e495=[_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x249)]],_0x30e3f9=[_0x5d48ea['body']['sales_quantity']],_0x5ad0c5=[_0x5d48ea['body']['stocks']],_0x5c856=[_0x5d48ea['body'][_0x228ec0(0x24f)]],_0x3ff1cd=[_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x216)]],_0x28d904=[_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x237)]],_0x370d33=[_0x5d48ea['body'][_0x228ec0(0x227)]],_0x3467d7=[_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x2c1)]];else var _0x173f81=[..._0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x235)]],_0x9e37f7=[..._0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x275)]],_0x4f1b8c=[..._0x5d48ea['body']['secondary_code']],_0x43e495=[..._0x5d48ea['body'][_0x228ec0(0x249)]],_0x30e3f9=[..._0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x24a)]],_0x5ad0c5=[..._0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x292)]],_0x5c856=[..._0x5d48ea['body']['return_qty']],_0x3ff1cd=[..._0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x216)]],_0x28d904=[..._0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x237)]],_0x370d33=[..._0x5d48ea['body'][_0x228ec0(0x227)]],_0x3467d7=[..._0x5d48ea['body'][_0x228ec0(0x2c1)]];const _0x560e43=_0x173f81[_0x228ec0(0x242)](_0x35760a=>{return _0x35760a={'product_name':_0x35760a};});_0x9e37f7[_0x228ec0(0x1ef)]((_0x38ff29,_0x4d7726)=>{_0x560e43[_0x4d7726]['primary_code']=_0x38ff29;}),_0x4f1b8c[_0x228ec0(0x1ef)]((_0xb32c93,_0x4a73b6)=>{_0x560e43[_0x4a73b6]['secondary_code']=_0xb32c93;}),_0x43e495[_0x228ec0(0x1ef)]((_0x4c93b0,_0x196dc9)=>{var _0x1f4dd0=_0x228ec0;_0x560e43[_0x196dc9][_0x1f4dd0(0x249)]=_0x4c93b0;}),_0x30e3f9[_0x228ec0(0x1ef)]((_0x240258,_0x5e2900)=>{var _0x51aa0f=_0x228ec0;_0x560e43[_0x5e2900][_0x51aa0f(0x1ca)]=_0x240258;}),_0x5ad0c5['forEach']((_0x16c12a,_0x3d22a7)=>{var _0x3abf8a=_0x228ec0;_0x560e43[_0x3d22a7][_0x3abf8a(0x206)]=_0x16c12a;}),_0x5c856['forEach']((_0x230339,_0x4ae6b3)=>{var _0x4e8bb3=_0x228ec0;_0x560e43[_0x4ae6b3][_0x4e8bb3(0x24f)]=_0x230339;}),_0x3ff1cd[_0x228ec0(0x1ef)]((_0x2c6744,_0x5590b6)=>{var _0x23b855=_0x228ec0;_0x560e43[_0x5590b6][_0x23b855(0x216)]=_0x2c6744;}),_0x28d904[_0x228ec0(0x1ef)]((_0x2d26d3,_0x31262b)=>{_0x560e43[_0x31262b]['bin']=_0x2d26d3;}),_0x370d33[_0x228ec0(0x1ef)]((_0x118a28,_0x3a4ea7)=>{var _0x102227=_0x228ec0;_0x560e43[_0x3a4ea7][_0x102227(0x1e4)]=_0x118a28;}),_0x3467d7['forEach']((_0x2cff9d,_0x1c37a3)=>{var _0x31fffa=_0x228ec0;_0x560e43[_0x1c37a3][_0x31fffa(0x2c1)]=_0x2cff9d;});var _0x310c2d=0x0;_0x560e43[_0x228ec0(0x1ef)](_0x513bf2=>{var _0x1107d8=_0x228ec0;console[_0x1107d8(0x1f9)](_0x1107d8(0x1c7),_0x513bf2),(parseInt(_0x513bf2[_0x1107d8(0x1ca)])<parseInt(_0x513bf2[_0x1107d8(0x24f)])||parseInt(_0x513bf2['stock'])<parseInt(_0x513bf2[_0x1107d8(0x24f)])&&parseInt(_0x513bf2[_0x1107d8(0x1ca)])>parseInt(_0x513bf2['return_qty'])||parseInt(_0x513bf2[_0x1107d8(0x24f)])==0x0)&&_0x310c2d++;});if(_0x310c2d!=0x0)return _0x5d48ea[_0x228ec0(0x207)](_0x228ec0(0x201),_0x228ec0(0x1eb)),_0x5d9ca2[_0x228ec0(0x2a2)](_0x228ec0(0x2a4));const _0x5f2f84=await sales[_0x228ec0(0x232)]({'invoice':_0x393f3c});console[_0x228ec0(0x1f9)](_0x5f2f84),_0x5f2f84[_0x228ec0(0x287)]=_0x228ec0(0x2c9);const _0xf46bb4=await _0x5f2f84[_0x228ec0(0x23a)](),_0xb22453=new sales_return({'invoice':_0x393f3c,'customer':_0x5d48ea['body'][_0x228ec0(0x1c8)],'date':_0x5c2f00,'warehouse_name':_0x5eaf7d,'room':_0x4aa372,'ToWarehouse':_0x29f4eb,'ToRoom':_0x29a437,'return_sale':_0x560e43,'note':_0x55935e}),_0x50bd7a=await _0xb22453['save']();console[_0x228ec0(0x1f9)](_0xb22453);const _0x1be795=await sales_return[_0x228ec0(0x232)]({'invoice':_0x393f3c}),_0x57d4ab=await warehouse[_0x228ec0(0x232)]({'name':_0x29f4eb,'room':_0x29a437});_0x1be795[_0x228ec0(0x265)][_0x228ec0(0x1ef)](_0x55e37f=>{var _0x3d6790=_0x228ec0,_0x1568df=0x0;const _0x4bac9c=_0x57d4ab[_0x3d6790(0x248)][_0x3d6790(0x242)](_0x11aefe=>{var _0x34ae1f=_0x3d6790;_0x11aefe[_0x34ae1f(0x235)]==_0x55e37f[_0x34ae1f(0x235)]&&_0x11aefe[_0x34ae1f(0x2c1)]==_0x55e37f[_0x34ae1f(0x2c1)]&&_0x11aefe[_0x34ae1f(0x1e4)]==_0x55e37f[_0x34ae1f(0x1e4)]&&_0x11aefe[_0x34ae1f(0x237)]==_0x55e37f[_0x34ae1f(0x237)]&&_0x11aefe[_0x34ae1f(0x216)]==_0x55e37f[_0x34ae1f(0x216)]&&(_0x11aefe[_0x34ae1f(0x221)]=parseInt(_0x11aefe[_0x34ae1f(0x221)])+parseInt(_0x55e37f[_0x34ae1f(0x24f)]),_0x1568df++);});_0x1568df=='0'&&(_0x57d4ab['product_details']=_0x57d4ab[_0x3d6790(0x248)][_0x3d6790(0x225)]({'product_name':_0x55e37f['product_name'],'product_stock':_0x55e37f[_0x3d6790(0x24f)],'primary_code':_0x55e37f[_0x3d6790(0x275)],'secondary_code':_0x55e37f[_0x3d6790(0x256)],'product_code':_0x55e37f[_0x3d6790(0x249)],'bay':_0x55e37f[_0x3d6790(0x216)],'bin':_0x55e37f[_0x3d6790(0x237)],'type':_0x55e37f['type'],'floorlevel':_0x55e37f[_0x3d6790(0x2c1)]})),console[_0x3d6790(0x1f9)](_0x3d6790(0x1e2),_0x57d4ab);}),await _0x57d4ab['save'](),console[_0x228ec0(0x1f9)](_0x5d48ea[_0x228ec0(0x2c7)]);const _0x15867e=new c_payment_data({'invoice':_0x393f3c,'customer':_0x5d48ea['body'][_0x228ec0(0x1c8)],'reason':_0x228ec0(0x290)});await _0x15867e[_0x228ec0(0x23a)]();const _0x212f48=await master_shop['find']();console[_0x228ec0(0x1f9)](_0x228ec0(0x217),_0x212f48[0x0][_0x228ec0(0x1da)]);const _0x53a5b3=await email_settings[_0x228ec0(0x232)](),_0x285e19=await customer[_0x228ec0(0x232)]({'name':_0x5d48ea[_0x228ec0(0x2c7)][_0x228ec0(0x1c8)]});console[_0x228ec0(0x1f9)]('customer_data',_0x285e19);_0x212f48[0x0][_0x228ec0(0x1c6)]==0x1?(right_currency=_0x212f48[0x0][_0x228ec0(0x29c)],left_currency=''):(right_currency='',left_currency=_0x212f48[0x0][_0x228ec0(0x29c)]);var _0x1d60b2=_0x173f81,_0x18bed2=_0x5c856,_0xafb35c='',_0x21b314;for(_0x21b314 in _0x1d60b2){_0xafb35c+=_0x228ec0(0x269)+_0x228ec0(0x2bf)+_0x1d60b2[_0x21b314]+_0x228ec0(0x233)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x18bed2[_0x21b314]+_0x228ec0(0x233)+_0x228ec0(0x254);}console[_0x228ec0(0x1f9)](_0x228ec0(0x277),_0xafb35c);let _0x27402f=nodemailer[_0x228ec0(0x21b)]({'service':_0x228ec0(0x2c5),'auth':{'user':_0x53a5b3[_0x228ec0(0x2d2)],'pass':_0x53a5b3[_0x228ec0(0x2ae)]}}),_0x1fb21b={'from':_0x53a5b3[_0x228ec0(0x2d2)],'to':_0x285e19[_0x228ec0(0x2d2)],'subject':_0x228ec0(0x260),'attachments':[{'filename':_0x228ec0(0x284),'path':__dirname+_0x228ec0(0x26d)+_0x228ec0(0x1fd)+_0x212f48[0x0][_0x228ec0(0x1da)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x228ec0(0x267)+'</head><body>'+_0x228ec0(0x257)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x228ec0(0x257)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x228ec0(0x2ba)+_0x228ec0(0x257)+'<h2>\x20'+_0x212f48[0x0][_0x228ec0(0x291)]+'\x20</h2>'+'</div>'+'</div>'+_0x228ec0(0x247)+_0x228ec0(0x257)+_0x228ec0(0x27d)+'\x20Order\x20Number\x20:\x20'+_0x393f3c+'\x20'+_0x228ec0(0x26b)+'\x20Order\x20Date\x20:\x20'+_0x5c2f00+'\x20'+_0x228ec0(0x1f6)+'</h5>'+_0x228ec0(0x2ba)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x228ec0(0x26c)+'<tr>'+_0x228ec0(0x2d5)+_0x228ec0(0x1d1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x228ec0(0x1f2)+_0x228ec0(0x254)+_0x228ec0(0x1f5)+_0x228ec0(0x2d3)+'\x20'+_0xafb35c+'\x20'+'</tbody>'+_0x228ec0(0x1ed)+_0x228ec0(0x257)+_0x228ec0(0x2ad)+_0x228ec0(0x2b2)+_0x212f48[0x0]['site_title']+_0x228ec0(0x298)+_0x228ec0(0x2ba)+_0x228ec0(0x2ba)+_0x228ec0(0x25f)};_0x27402f[_0x228ec0(0x2bd)](_0x1fb21b,function(_0x3cddc1,_0x16e8e5){var _0x25c320=_0x228ec0;_0x3cddc1?(console[_0x25c320(0x1f9)](_0x3cddc1),console[_0x25c320(0x1f9)](_0x25c320(0x29e))):console['log'](_0x25c320(0x240));}),_0x5d48ea[_0x228ec0(0x207)](_0x228ec0(0x1c5),_0x228ec0(0x229)),_0x5d9ca2[_0x228ec0(0x2a2)](_0x228ec0(0x23b));}catch(_0x3eceb1){console[_0x228ec0(0x1f9)](_0x3eceb1),_0x5d9ca2[_0x228ec0(0x2d0)](0xc8)[_0x228ec0(0x28d)]({'message1':_0x3eceb1[_0x228ec0(0x299)]});}}),router['get']('/barcode/:id',auth,async(_0x3b9a5c,_0x165516)=>{var _0x2644f9=a0_0x597c1b;try{const {username:_0x333168,email:_0x47361b,role:_0x53aa9b}=_0x3b9a5c[_0x2644f9(0x259)],_0x4c68fe=_0x3b9a5c[_0x2644f9(0x259)],_0x410c83=await profile['findOne']({'email':_0x4c68fe['email']}),_0xda955c=await master_shop[_0x2644f9(0x255)]();console[_0x2644f9(0x1f9)](_0x2644f9(0x24e),_0xda955c);const _0x106076=_0x3b9a5c[_0x2644f9(0x222)]['id'],_0xe2fc16=await sales[_0x2644f9(0x203)](_0x106076);console[_0x2644f9(0x1f9)]('barcode\x20user_id',_0xe2fc16);if(_0xda955c[0x0][_0x2644f9(0x2c3)]==_0x2644f9(0x29b))var _0x688270=users[_0x2644f9(0x22e)];else{if(_0xda955c[0x0]['language']==_0x2644f9(0x1ea))var _0x688270=users[_0x2644f9(0x1ea)];else{if(_0xda955c[0x0]['language']==_0x2644f9(0x26f))var _0x688270=users[_0x2644f9(0x26f)];else{if(_0xda955c[0x0][_0x2644f9(0x2c3)]==_0x2644f9(0x1e5))var _0x688270=users[_0x2644f9(0x1e5)];else{if(_0xda955c[0x0][_0x2644f9(0x2c3)]=='French')var _0x688270=users[_0x2644f9(0x278)];else{if(_0xda955c[0x0][_0x2644f9(0x2c3)]==_0x2644f9(0x288))var _0x688270=users['Portuguese'];else{if(_0xda955c[0x0][_0x2644f9(0x2c3)]==_0x2644f9(0x20d))var _0x688270=users[_0x2644f9(0x20d)];else{if(_0xda955c[0x0][_0x2644f9(0x2c3)]==_0x2644f9(0x1dd))var _0x688270=users[_0x2644f9(0x2b4)];}}}}}}}_0x165516['render']('all_sales_barcode',{'success':_0x3b9a5c[_0x2644f9(0x207)](_0x2644f9(0x1c5)),'errors':_0x3b9a5c[_0x2644f9(0x207)](_0x2644f9(0x201)),'role':_0x4c68fe,'profile':_0x410c83,'alldata':_0xe2fc16,'master_shop':_0xda955c,'language':_0x688270});}catch(_0x149d66){console['log'](_0x149d66);}}),router[a0_0x597c1b(0x238)](a0_0x597c1b(0x2ca),async(_0x3514ad,_0x2a91d5)=>{var _0x100160=a0_0x597c1b;const {product_code:_0x466057,warehouse_name:_0x220275,rooms_data:_0x16c7f4,Roomslist:_0x530331}=_0x3514ad[_0x100160(0x2c7)],_0x22d0e4=_0x530331[_0x100160(0x218)](','),_0x438386=[];async function _0x397254(_0x3578ed){var _0x83039c=_0x100160;const _0x351b90=await warehouse[_0x83039c(0x28c)]([{'$match':{'name':_0x220275,'room':_0x3578ed}},{'$unwind':_0x83039c(0x1e7)},{'$match':{'product_details.primary_code':_0x466057}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x83039c(0x285)},'primary_code':{'$first':_0x83039c(0x268)},'secondary_code':{'$first':_0x83039c(0x21e)},'product_code':{'$first':_0x83039c(0x211)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x83039c(0x22a)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x83039c(0x1d5)},'unit':{'$first':_0x83039c(0x243)},'secondary_unit':{'$first':_0x83039c(0x289)},'storage':{'$first':_0x83039c(0x20a)},'rack':{'$first':_0x83039c(0x25d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x83039c(0x293)},'maxPerUnit':{'$first':_0x83039c(0x281)},'batch_code':{'$first':_0x83039c(0x1e0)},'product_cat':{'$first':_0x83039c(0x2a0)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x83039c(0x2b5)},'actual_qty':{'$first':_0x83039c(0x273)},'actual_uom':{'$first':_0x83039c(0x241)}}}]),_0x48643c=await warehouse[_0x83039c(0x28c)]([{'$match':{'name':_0x220275,'room':_0x3578ed}},{'$unwind':_0x83039c(0x1e7)},{'$match':{'product_details.secondary_code':_0x466057}},{'$group':{'_id':_0x83039c(0x236),'name':{'$first':_0x83039c(0x1d3)},'product_stock':{'$first':_0x83039c(0x285)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x83039c(0x22c)},'isle':{'$first':_0x83039c(0x22a)},'type':{'$first':_0x83039c(0x1f3)},'pallet':{'$first':_0x83039c(0x1d5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x83039c(0x289)},'storage':{'$first':_0x83039c(0x20a)},'rack':{'$first':_0x83039c(0x25d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x83039c(0x293)},'maxPerUnit':{'$first':_0x83039c(0x281)},'batch_code':{'$first':_0x83039c(0x1e0)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x83039c(0x244)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x351b90[_0x83039c(0x230)]>0x0)_0x438386['push'](_0x351b90);else _0x48643c[_0x83039c(0x230)]>0x0&&_0x438386[_0x83039c(0x27b)](_0x48643c);}const _0x55432b=_0x22d0e4['map'](_0x5149b6=>_0x397254(_0x5149b6));await Promise[_0x100160(0x280)](_0x55432b),_0x2a91d5['json'](_0x438386);}),module[a0_0x597c1b(0x239)]=router;