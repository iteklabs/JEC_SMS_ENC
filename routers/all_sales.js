var a0_0x6b9e37=a0_0x4dc7;function a0_0x4dc7(_0x322aab,_0x20e01e){var _0xdef13f=a0_0xdef1();return a0_0x4dc7=function(_0x4dc7d3,_0x31a77d){_0x4dc7d3=_0x4dc7d3-0xb7;var _0x12c8bb=_0xdef13f[_0x4dc7d3];return _0x12c8bb;},a0_0x4dc7(_0x322aab,_0x20e01e);}function a0_0xdef1(){var _0x3c0ef3=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','actual_uom','/barcode/:id','\x20Order\x20Date\x20:\x20','../models/all_models','$sale_product.quantity','$product_details.invoice','Logo.png','success','<div>','$product_details.pallet','../public/language/languages.json','save','redirect','24836JjPoHv','purchases_data','findOne','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','615681aMyUUJ','name','product_data','types','There\x27s\x20a\x20error\x20in\x20this\x20transaction','8493210NrqjHB','foreach\x20newproduct','OUT-','/view/add_sales/:id','warehouse','secondary_code','\x20</h2>','$product_details.product_cat','delivery_code','site_title','Spanish','</h5>','<html><head><title></title>','500hAXToQ','Received\x20Payment\x20For\x20Sale','$product_details.bin','push','rack','61965LrmDpD','Enclosed','/all_sales/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sales_quantity','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</span>','status','bin','Sales\x20Update\x20successfully','$room','prod_cat','Enabled','stock','floor','room_name','delivery_date','/view/:id','all','/all_sales/view','forEach','/view/add_sales','language','string','post','all_sales','gmail','9615izopcj','currency_placement','$product_details.secondary_unit','max','$customers_docs','<span\x20style=\x22float:\x20right;\x22>','$isAllowEdit','An\x20error\x20occurred.','toString','bay','Arabic','invoice','9516899rerMUy','floorlevel','catch','Ambient','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</body></html>','sales_invoice','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.actual_uom','stock_data','Portuguese\x20(BR)','sales\x20all_data','sale_product','product_code','$product_details.expiry_date','$name','slice','max_per_unit','$sale_product.bin','$date','sale_qty','map','customer_data','$product_details.product_code','<!DOCTYPE\x20html>','English\x20(US)','True','Sale\x20Return','requested_qty','primary_unit','carton','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','customers','Chinese','$product_details.rack','SCRN','length','2994uKYDNY','edit_sales_view','$customer','<hr\x20class=\x22my-3\x22>','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','English','$product_details.level','primary_code','$product_details.actual_qty','json','room','product_stock','quantity','$product_details.maxPerUnit','getMonth','prod_invoice','customer','$product_details.bay','$warehouse_name','abs','<tbody\x20style=\x22text-align:\x20center;\x22>','$_id','8Dccvnq','$finalize','body','return_sale','</tbody>','/upload/','master','/view/return_sales/:id','type','date','<h5>','German','Sale\x20Return\x20Mail','$product_details','$product_details.batch_code','</td>','stocks','</thead>','sendMail','Floor','findById','return_qty','$product_details.production_date','quantity_notConverted','405uRFLeJ','id_transaction_from','barcode\x20Product\x20master','<h2>\x20','maxperunit','/invoice/:id','$sale_product.type','Raw\x20Materials','params','/view/add_sale/product','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','finalize','secondary_unit','actual_qty','_id','$product_details.product_stock','$note','</tr>','image','sales\x20item\x20return\x20successfull','Portuguese','note','$return_data','edit_sales','<table\x20style=\x22width:\x20100%\x20!important;\x22>','expiry_date','$product_details.storage','back','flash','<tr>','$product.product_name','logo','product_details','barcode\x20user_id','Arabic\x20(ae)','Shelves','<strong>\x20Regards\x20</strong>','Return\x20Rooms','email','port','customers_docs','/give_payment/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','host','Receiving\x20Area','warehouse_name','2838060pIpoPD','random','aggregate','Email\x20sent\x20successfully','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','role','Return\x20Goods','exports','French','createTransport','Error\x20Occurs','$product_details.floorlevel','error','$product_details.secondary_code','RoomAssigned','</head><body>','$product_details.product_name','$invoice','Router','user_id','/view','find','Hindi','$product_details._id','id_transact','payment\x20successfull','$product_details.type','$sale_product.bay','user','errors','received_amount','express','storage','$product_details.unit','False','RMSEmail','filter','$sale_product','level','Level','product_name','$product_details.primary_code','batch_code','$sale_product.floorlevel','production_date','</table>','</div>','currency','then','prod_code','log','final','get','product','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','message'];a0_0xdef1=function(){return _0x3c0ef3;};return a0_0xdef1();}(function(_0x4b9653,_0x43fef){var _0xa18504=a0_0x4dc7,_0x5ee3e3=_0x4b9653();while(!![]){try{var _0x3170ef=-parseInt(_0xa18504(0x154))/0x1+parseInt(_0xa18504(0xf1))/0x2+-parseInt(_0xa18504(0xc1))/0x3*(-parseInt(_0xa18504(0x138))/0x4)+parseInt(_0xa18504(0x16f))/0x5*(-parseInt(_0xa18504(0x1a1))/0x6)+parseInt(_0xa18504(0x17b))/0x7+parseInt(_0xa18504(0x1b8))/0x8*(parseInt(_0xa18504(0x142))/0x9)+parseInt(_0xa18504(0x14f))/0xa*(-parseInt(_0xa18504(0x13d))/0xb);if(_0x3170ef===_0x43fef)break;else _0x5ee3e3['push'](_0x5ee3e3['shift']());}catch(_0x4e205f){_0x5ee3e3['push'](_0x5ee3e3['shift']());}}}(a0_0xdef1,0xb4c30));const express=require(a0_0x6b9e37(0x110)),app=express(),router=express[a0_0x6b9e37(0x103)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x6b9e37(0x12e)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x6b9e37(0x135));router[a0_0x6b9e37(0x125)](a0_0x6b9e37(0x105),auth,async(_0x3cf22e,_0x53e829)=>{var _0x3a5a42=a0_0x6b9e37;try{const {username:_0xcae90,email:_0x48a60e,role:_0x2498b2}=_0x3cf22e[_0x3a5a42(0x10d)],_0x673772=_0x3cf22e[_0x3a5a42(0x10d)],_0x6adda9=await profile[_0x3a5a42(0x13a)]({'email':_0x673772[_0x3a5a42(0xe8)]}),_0x17a9e1=await master_shop['find']();let _0x53360d;if(_0x673772['role']=='staff'){const _0x325029=await staff[_0x3a5a42(0x13a)]({'email':_0x673772['email']});_0x53360d=await sales[_0x3a5a42(0xf3)]([{'$lookup':{'from':_0x3a5a42(0x19c),'localField':'customer','foreignField':_0x3a5a42(0x13e),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x3a5a42(0x116)},{'$group':{'_id':_0x3a5a42(0x1b7),'invoice':{'$first':_0x3a5a42(0x102)},'customers':{'$first':_0x3a5a42(0x1a3)},'date':{'$first':_0x3a5a42(0x18f)},'warehouse_name':{'$first':_0x3a5a42(0x1b4)},'sale_product':{'$push':_0x3a5a42(0x116)},'note':{'$first':_0x3a5a42(0xd2)},'return_data':{'$first':_0x3a5a42(0xd8)},'customers_docs':{'$first':_0x3a5a42(0x173)},'total_saleproduct_quantity':{'$sum':_0x3a5a42(0x12f)},'level':{'$addToSet':_0x3a5a42(0x10c)},'isle':{'$addToSet':_0x3a5a42(0x18e)},'type':{'$addToSet':_0x3a5a42(0xc7)},'pallet':{'$addToSet':_0x3a5a42(0x11c)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x53360d=await sales[_0x3a5a42(0xf3)]([{'$lookup':{'from':_0x3a5a42(0x19c),'localField':_0x3a5a42(0x1b2),'foreignField':_0x3a5a42(0x13e),'as':_0x3a5a42(0xea)}},{'$unwind':_0x3a5a42(0x173)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3a5a42(0x1b7),'invoice':{'$first':_0x3a5a42(0x102)},'customers':{'$first':_0x3a5a42(0x1a3)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3a5a42(0x116)},'note':{'$first':_0x3a5a42(0xd2)},'return_data':{'$first':_0x3a5a42(0xd8)},'customers_docs':{'$first':_0x3a5a42(0x173)},'total_saleproduct_quantity':{'$sum':_0x3a5a42(0x12f)},'level':{'$addToSet':_0x3a5a42(0x10c)},'isle':{'$addToSet':_0x3a5a42(0x18e)},'type':{'$addToSet':_0x3a5a42(0xc7)},'pallet':{'$addToSet':_0x3a5a42(0x11c)},'finalize':{'$first':_0x3a5a42(0x1b9)},'isAllowEdit':{'$first':_0x3a5a42(0x175)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3a5a42(0x123)](_0x3a5a42(0x187),_0x53360d);if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]==_0x3a5a42(0x195)){var _0x59af78=users['English'];console[_0x3a5a42(0x123)](_0x59af78);}else{if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]==_0x3a5a42(0x107))var _0x59af78=users[_0x3a5a42(0x107)];else{if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]==_0x3a5a42(0x1c3))var _0x59af78=users['German'];else{if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]=='Spanish')var _0x59af78=users[_0x3a5a42(0x14c)];else{if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]==_0x3a5a42(0xf9))var _0x59af78=users['French'];else{if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]=='Portuguese\x20(BR)')var _0x59af78=users[_0x3a5a42(0xd6)];else{if(_0x17a9e1[0x0]['language']==_0x3a5a42(0x19d))var _0x59af78=users['Chinese'];else{if(_0x17a9e1[0x0][_0x3a5a42(0x16a)]=='Arabic\x20(ae)')var _0x59af78=users[_0x3a5a42(0x179)];}}}}}}}_0x53e829[_0x3a5a42(0xcb)](_0x3a5a42(0x16d),{'success':_0x3cf22e['flash']('success'),'errors':_0x3cf22e[_0x3a5a42(0xde)](_0x3a5a42(0x10e)),'sales':_0x53360d,'profile':_0x6adda9,'role':_0x673772,'master_shop':_0x17a9e1,'language':_0x59af78});}catch(_0xf3dc5a){console[_0x3a5a42(0x123)](_0xf3dc5a);}});async function getRandom8DigitNumber(){var _0x532209=a0_0x6b9e37;const _0x531a29=0x989680,_0x3f8db5=0x5f5e0ff,_0x22c84f=Math[_0x532209(0x162)](Math[_0x532209(0xf2)]()*(_0x3f8db5-_0x531a29+0x1))+_0x531a29;var _0x3d95c9;const _0x5905bf=await sales[_0x532209(0x13a)]({'invoice':_0x532209(0x144)+_0x22c84f});return _0x5905bf&&_0x5905bf[_0x532209(0x1a0)]>0x0?_0x3d95c9='OUT-'+_0x22c84f:_0x3d95c9='OUT-'+_0x22c84f,_0x3d95c9;}router['get'](a0_0x6b9e37(0x169),auth,async(_0x26468e,_0x43c529)=>{var _0x4f7c88=a0_0x6b9e37;try{const {username:_0x2e158e,email:_0x34a9a1,role:_0x1465e9}=_0x26468e[_0x4f7c88(0x10d)],_0xee9ebe=_0x26468e[_0x4f7c88(0x10d)],_0x55c096=await profile[_0x4f7c88(0x13a)]({'email':_0xee9ebe[_0x4f7c88(0xe8)]}),_0x59a72d=await master_shop[_0x4f7c88(0x106)](),_0x246158=await customer['find']({});let _0x1dcb90;if(_0xee9ebe[_0x4f7c88(0xf6)]=='staff'){const _0x50c42e=await staff['findOne']({'email':_0xee9ebe[_0x4f7c88(0xe8)]});_0x1dcb90=await warehouse[_0x4f7c88(0xf3)]([{'$match':{'status':_0x4f7c88(0x160),'name':_0x50c42e[_0x4f7c88(0x146)],'warehouse_category':_0x4f7c88(0xc8),'name':{'$ne':_0x4f7c88(0xf7)}}},{'$group':{'_id':_0x4f7c88(0x18b),'name':{'$first':_0x4f7c88(0x18b)}}},{'$sort':{'name':0x1}}]);}else _0x1dcb90=await warehouse['aggregate']([{'$match':{'status':_0x4f7c88(0x160),'warehouse_category':_0x4f7c88(0xc8),'name':{'$ne':_0x4f7c88(0xf7)}}},{'$group':{'_id':_0x4f7c88(0x18b),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x4a21b2=await product[_0x4f7c88(0x106)]({});var _0x38d1b8=['Ambient','Enclosed'];const _0x3e2861=await sales['find']({}),_0x2de18e=_0x3e2861[_0x4f7c88(0x1a0)]+0x1,_0x1abc5c='OUT-'+_0x2de18e[_0x4f7c88(0x177)]()['padStart'](0x5,'0');if(_0x59a72d[0x0][_0x4f7c88(0x16a)]=='English\x20(US)'){var _0x3d197a=users[_0x4f7c88(0x1a7)];console[_0x4f7c88(0x123)](_0x3d197a);}else{if(_0x59a72d[0x0][_0x4f7c88(0x16a)]==_0x4f7c88(0x107))var _0x3d197a=users[_0x4f7c88(0x107)];else{if(_0x59a72d[0x0][_0x4f7c88(0x16a)]==_0x4f7c88(0x1c3))var _0x3d197a=users[_0x4f7c88(0x1c3)];else{if(_0x59a72d[0x0]['language']==_0x4f7c88(0x14c))var _0x3d197a=users[_0x4f7c88(0x14c)];else{if(_0x59a72d[0x0]['language']==_0x4f7c88(0xf9))var _0x3d197a=users[_0x4f7c88(0xf9)];else{if(_0x59a72d[0x0]['language']==_0x4f7c88(0x186))var _0x3d197a=users['Portuguese'];else{if(_0x59a72d[0x0][_0x4f7c88(0x16a)]==_0x4f7c88(0x19d))var _0x3d197a=users[_0x4f7c88(0x19d)];else{if(_0x59a72d[0x0][_0x4f7c88(0x16a)]==_0x4f7c88(0xe4))var _0x3d197a=users[_0x4f7c88(0x179)];}}}}}}}const _0x1875e3=getRandom8DigitNumber();_0x1875e3[_0x4f7c88(0x121)](_0x51fdae=>{var _0x11a727=_0x4f7c88;_0x43c529[_0x11a727(0xcb)]('add_sales',{'success':_0x26468e[_0x11a727(0xde)](_0x11a727(0x132)),'errors':_0x26468e[_0x11a727(0xde)](_0x11a727(0x10e)),'role':_0xee9ebe,'profile':_0x55c096,'customer':_0x246158,'warehouse':_0x1dcb90,'product':_0x4a21b2,'invoice':_0x51fdae,'master_shop':_0x59a72d,'language':_0x3d197a,'rooms_data':_0x38d1b8});})[_0x4f7c88(0x17d)](_0x3a0f62=>{var _0x9a6824=_0x4f7c88;_0x26468e[_0x9a6824(0xde)](_0x9a6824(0x10e),_0x9a6824(0x141)),_0x43c529[_0x9a6824(0x137)](_0x9a6824(0x167));});}catch(_0x15e525){console['log'](_0x15e525);}}),router['get'](a0_0x6b9e37(0x145),auth,async(_0x4b8ac4,_0x4604d6)=>{var _0x5d63ed=a0_0x6b9e37;try{const _0xc8b11f=_0x4b8ac4[_0x5d63ed(0xc9)]['id'];console[_0x5d63ed(0x123)](_0xc8b11f);const _0x153cbc=await product[_0x5d63ed(0x106)](),_0x52ec2c=await purchases[_0x5d63ed(0xf3)]([{'$match':{'warehouse_name':_0xc8b11f}},{'$unwind':'$product'},{'$group':{'_id':_0x5d63ed(0xe0)}}]);console['log'](_0x5d63ed(0x139),_0x52ec2c),_0x4604d6[_0x5d63ed(0x15b)](0xc8)[_0x5d63ed(0x1ab)]({'purchases_data':_0x52ec2c,'product_data':_0x153cbc});}catch(_0x2e55a6){console[_0x5d63ed(0x123)](_0x2e55a6);}}),router['post'](a0_0x6b9e37(0xca),auth,async(_0x3dfc20,_0x37133a)=>{var _0x324251=a0_0x6b9e37;try{const {warehouse_data:_0x88a93a,product_data:_0x3cc057}=_0x3dfc20[_0x324251(0x1ba)];console[_0x324251(0x123)](_0x3dfc20[_0x324251(0x1ba)][_0x324251(0x13f)]);;const _0x76f4e3=await master_shop[_0x324251(0x106)]();console[_0x324251(0x123)]('master',_0x76f4e3);const _0x3ecee5=await product[_0x324251(0x13a)]({'name':_0x3cc057});console[_0x324251(0x123)](_0x324251(0x126),_0x3ecee5);const _0x35029c=await warehouse[_0x324251(0xf3)]([{'$match':{'name':_0x88a93a}},{'$unwind':_0x324251(0x1c5)},{'$match':{'product_details.product_name':_0x3cc057}},{'$group':{'_id':_0x324251(0x101),'product_stock':{'$first':_0x324251(0xd1)}}}]);console[_0x324251(0x123)](_0x324251(0x185),_0x35029c),_0x37133a[_0x324251(0x15b)](0xc8)[_0x324251(0x1ab)]({'master':_0x76f4e3,'new_product':_0x3ecee5,'stock_data':_0x35029c});}catch(_0x1264a1){console[_0x324251(0x123)](_0x1264a1);}}),router[a0_0x6b9e37(0x16c)](a0_0x6b9e37(0x169),auth,async(_0x2f4327,_0xb3dd31)=>{var _0x4b2907=a0_0x6b9e37;try{const {invoice:_0x157086,date:_0x44ee27,warehouse_name:_0x5e411a,product_name:_0x1d0f37,stock:_0x3f8ea2,quantity:_0x2add57,note:_0x35055d,room:_0xf8f517,primary_code:_0x3c0f74,secondary_code:_0x293a45,prod_code:_0x12d5e6,level:_0x451abe,isle:_0x4e74b1,pallet:_0x50ea43,batch_code:_0x18f26c,SCRN:_0x4f8150,expiry_date:_0x3d131a}=_0x2f4327[_0x4b2907(0x1ba)];if(typeof _0x1d0f37==_0x4b2907(0x16b))var _0x33275c=[_0x2f4327['body'][_0x4b2907(0x119)]],_0x13e3cc=[_0x2f4327['body'][_0x4b2907(0x161)]],_0x29ec43=[_0x2f4327['body'][_0x4b2907(0x19a)]],_0x3a5e04=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x1a9)]],_0x579701=[_0x2f4327[_0x4b2907(0x1ba)]['secondary_code']],_0x734f41=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x122)]],_0x590955=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x117)]],_0x1436e9=[_0x2f4327[_0x4b2907(0x1ba)]['primary_unit']],_0x4d3351=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0xce)]],_0x398934=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x11b)]],_0x2a4263=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0xdb)]],_0x198985=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x18d)]],_0x322178=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x11d)]],_0x1dfbda=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x198)]],_0x2826b8=[_0x2f4327['body'][_0x4b2907(0x164)]],_0x1f6480=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x14a)]],_0x22a1d7=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x15f)]],_0x11287d=[_0x2f4327[_0x4b2907(0x1ba)]['quantity']],_0x28850e=[_0x2f4327[_0x4b2907(0x1ba)]['RoomAssigned']],_0x13ce1c=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x1b1)]],_0x301c15=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0xcf)]],_0x329d46=[_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x12b)]],_0x21ae84=[_0x2f4327['body'][_0x4b2907(0x109)]];else var _0x33275c=[..._0x2f4327['body']['product_name']],_0x13e3cc=[..._0x2f4327[_0x4b2907(0x1ba)]['stock']],_0x29ec43=[..._0x2f4327['body'][_0x4b2907(0x19a)]],_0x3a5e04=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x1a9)]],_0x579701=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x147)]],_0x734f41=[..._0x2f4327['body'][_0x4b2907(0x122)]],_0x590955=[..._0x2f4327['body'][_0x4b2907(0x117)]],_0x1436e9=[..._0x2f4327['body'][_0x4b2907(0x199)]],_0x4d3351=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0xce)]],_0x398934=[..._0x2f4327[_0x4b2907(0x1ba)]['batch_code']],_0x2a4263=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0xdb)]],_0x198985=[..._0x2f4327['body'][_0x4b2907(0x18d)]],_0x322178=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x11d)]],_0x1dfbda=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x198)]],_0x2826b8=[..._0x2f4327[_0x4b2907(0x1ba)]['delivery_date']],_0x1f6480=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x14a)]],_0x22a1d7=[..._0x2f4327[_0x4b2907(0x1ba)]['prod_cat']],_0x11287d=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x1ae)]],_0x28850e=[..._0x2f4327['body'][_0x4b2907(0xff)]],_0x13ce1c=[..._0x2f4327['body']['prod_invoice']],_0x301c15=[..._0x2f4327[_0x4b2907(0x1ba)]['actual_qty']],_0x329d46=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x12b)]],_0x21ae84=[..._0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x109)]];const _0x470506=_0x33275c['map'](_0x24bd96=>{return _0x24bd96={'product_name':_0x24bd96};});_0x13e3cc[_0x4b2907(0x168)]((_0x3818b3,_0x1317a3)=>{var _0x59bb8f=_0x4b2907;_0x470506[_0x1317a3][_0x59bb8f(0x161)]=Math['abs'](_0x3818b3);}),_0x301c15['forEach']((_0x32dda5,_0x400d0d)=>{_0x470506[_0x400d0d]['actual_qty']=Math['abs'](_0x32dda5);}),_0x329d46[_0x4b2907(0x168)]((_0xb490b4,_0x3b1705)=>{var _0x14faa3=_0x4b2907;_0x470506[_0x3b1705][_0x14faa3(0x12b)]=_0xb490b4;}),_0x21ae84[_0x4b2907(0x168)]((_0x43204b,_0x2d8694)=>{var _0x3ffd3d=_0x4b2907;_0x470506[_0x2d8694][_0x3ffd3d(0xc2)]=_0x43204b;}),_0x29ec43[_0x4b2907(0x168)]((_0x4ad75e,_0xd71a85)=>{_0x470506[_0xd71a85]['quantity']=_0x4ad75e;}),_0x3a5e04[_0x4b2907(0x168)]((_0x597d7d,_0xe3d262)=>{var _0x5e8ff1=_0x4b2907;_0x470506[_0xe3d262][_0x5e8ff1(0x1a9)]=_0x597d7d;}),_0x579701['forEach']((_0x5baaa9,_0x3f72e9)=>{var _0x30aff1=_0x4b2907;_0x470506[_0x3f72e9][_0x30aff1(0x147)]=_0x5baaa9;}),_0x734f41[_0x4b2907(0x168)]((_0x6e78b4,_0x5eed0a)=>{var _0x389663=_0x4b2907;_0x470506[_0x5eed0a][_0x389663(0x189)]=_0x6e78b4;}),_0x590955[_0x4b2907(0x168)]((_0x11e34c,_0x2ceec9)=>{_0x28850e['forEach']((_0x179a48,_0x3fb7e8)=>{var _0x5b1f88=a0_0x4dc7;if(_0x179a48==_0x5b1f88(0xef)&&_0x2ceec9==_0x3fb7e8){var _0x9255c3=_0x11e34c[_0x5b1f88(0x18c)](0x3);_0x470506[_0x2ceec9][_0x5b1f88(0x111)]=_0x11e34c[0x0],_0x470506[_0x2ceec9][_0x5b1f88(0x153)]=_0x11e34c[0x1],_0x470506[_0x2ceec9]['bay']=0x0,_0x470506[_0x2ceec9]['bin']=0x0,_0x470506[_0x2ceec9]['type']=_0x5b1f88(0xbc),_0x470506[_0x2ceec9][_0x5b1f88(0x17c)]=_0x9255c3;}else{if(_0x179a48==_0x5b1f88(0xe5)&&_0x2ceec9==_0x3fb7e8){var _0x9255c3=_0x11e34c[_0x5b1f88(0x18c)](0x3);_0x470506[_0x2ceec9][_0x5b1f88(0x111)]=_0x11e34c[0x0],_0x470506[_0x2ceec9][_0x5b1f88(0x153)]=_0x11e34c[0x1],_0x470506[_0x2ceec9]['bay']=0x0,_0x470506[_0x2ceec9][_0x5b1f88(0x15c)]=0x0,_0x470506[_0x2ceec9][_0x5b1f88(0x1c0)]=_0x5b1f88(0xbc),_0x470506[_0x2ceec9][_0x5b1f88(0x17c)]=_0x11e34c[0x5];}else{if(_0x2ceec9==_0x3fb7e8){var _0x33d7e9;if(_0x11e34c[0x4]=='L')_0x33d7e9=_0x5b1f88(0x118);else _0x11e34c[0x4]=='F'&&(_0x33d7e9='Floor');_0x470506[_0x2ceec9]['storage']=_0x11e34c[0x0],_0x470506[_0x2ceec9]['rack']=_0x11e34c[0x1],_0x470506[_0x2ceec9][_0x5b1f88(0x178)]=_0x11e34c[0x2],_0x470506[_0x2ceec9][_0x5b1f88(0x15c)]=_0x11e34c[0x3],_0x470506[_0x2ceec9]['type']=_0x33d7e9,_0x470506[_0x2ceec9]['floorlevel']=_0x11e34c[0x5];}}}});}),_0x1436e9[_0x4b2907(0x168)]((_0x38a527,_0x12e874)=>{_0x470506[_0x12e874]['unit']=_0x38a527;}),_0x4d3351[_0x4b2907(0x168)]((_0x2a8c8c,_0x37da68)=>{var _0x2636c2=_0x4b2907;_0x470506[_0x37da68][_0x2636c2(0xce)]=_0x2a8c8c;}),_0x398934[_0x4b2907(0x168)]((_0x50c456,_0x3208f7)=>{_0x470506[_0x3208f7]['batch_code']=_0x50c456;}),_0x2a4263[_0x4b2907(0x168)]((_0x1bd1f2,_0x53dfde)=>{var _0x2fd684=_0x4b2907;_0x470506[_0x53dfde][_0x2fd684(0xdb)]=_0x1bd1f2;}),_0x198985['forEach']((_0x20c092,_0x1415fc)=>{var _0xb1be9f=_0x4b2907;_0x470506[_0x1415fc][_0xb1be9f(0xc5)]=_0x20c092;}),_0x322178['forEach']((_0xacbca,_0x53f0c0)=>{var _0x22c121=_0x4b2907;_0x470506[_0x53f0c0][_0x22c121(0x11d)]=_0xacbca;}),_0x1dfbda[_0x4b2907(0x168)]((_0x2c31f2,_0x466843)=>{var _0x46ac4b=_0x4b2907;_0x470506[_0x466843][_0x46ac4b(0x198)]=_0x2c31f2;}),_0x2826b8[_0x4b2907(0x168)]((_0x34898b,_0x8095bc)=>{_0x470506[_0x8095bc]['delivery_date']=_0x34898b;}),_0x1f6480['forEach']((_0x535bbc,_0x21ccd4)=>{var _0x2f2d22=_0x4b2907;_0x470506[_0x21ccd4][_0x2f2d22(0x14a)]=_0x535bbc;}),_0x22a1d7['forEach']((_0x34fbab,_0x37b720)=>{var _0x206c75=_0x4b2907;_0x470506[_0x37b720][_0x206c75(0x15f)]=_0x34fbab;}),_0x11287d['forEach']((_0x134c4a,_0x3949f9)=>{var _0x17b295=_0x4b2907;_0x470506[_0x3949f9][_0x17b295(0xc0)]=_0x134c4a;}),_0x28850e[_0x4b2907(0x168)]((_0x457557,_0x40fd5c)=>{_0x470506[_0x40fd5c]['room_name']=_0x457557;}),_0x13ce1c[_0x4b2907(0x168)]((_0x2c9ab4,_0x453d4a)=>{_0x470506[_0x453d4a]['invoice']=_0x2c9ab4;});var _0x2298b3=0x0;_0x470506['forEach'](_0x2f7b0e=>{var _0x2c10a6=_0x4b2907;(_0x2f7b0e[_0x2c10a6(0x161)]<_0x2f7b0e['quantity_notConverted']||_0x2f7b0e[_0x2c10a6(0xc0)]==0x0)&&(console['log'](_0x2c10a6(0x143),_0x2f7b0e),_0x2298b3++);});const _0x300cfa=_0x470506[_0x4b2907(0x115)](_0x2264f4=>_0x2264f4[_0x4b2907(0x1ae)]!=='0'&&_0x2264f4[_0x4b2907(0x1ae)]!==''),_0x42c643=new sales({'invoice':_0x157086,'customer':_0x2f4327[_0x4b2907(0x1ba)][_0x4b2907(0x1b2)],'date':_0x44ee27,'warehouse_name':_0x5e411a,'sale_product':_0x300cfa,'note':_0x35055d,'room':_0xf8f517,'primary_code':_0x3c0f74,'secondary_code':_0x293a45,'prod_code':_0x12d5e6,'SCRN':_0x4f8150}),_0x45c1b3=await _0x42c643[_0x4b2907(0x136)]();_0x2f4327[_0x4b2907(0xde)](_0x4b2907(0x132),'Sales\x20Add\x20successfully'),_0xb3dd31[_0x4b2907(0x137)]('/all_sales/preview/'+_0x45c1b3[_0x4b2907(0xd0)]);}catch(_0x497bc1){console[_0x4b2907(0x123)](_0x497bc1);}}),router[a0_0x6b9e37(0x125)](a0_0x6b9e37(0x17f),auth,async(_0x506861,_0x409442)=>{var _0x42f24d=a0_0x6b9e37;try{const {username:_0x29b947,email:_0x431d93,role:_0x271362}=_0x506861[_0x42f24d(0x10d)],_0xdec544=_0x506861[_0x42f24d(0x10d)],_0x43b165=await profile['findOne']({'email':_0xdec544[_0x42f24d(0xe8)]}),_0x3e5d94=await master_shop[_0x42f24d(0x106)](),_0x773f7b=_0x506861[_0x42f24d(0xc9)]['id'],_0x36cdff=await sales['findById'](_0x773f7b),_0x4eb593=await warehouse[_0x42f24d(0xf3)]([{'$match':{'name':_0x36cdff[_0x42f24d(0xf0)]}},{'$unwind':_0x42f24d(0x1c5)},{'$group':{'_id':_0x42f24d(0x108),'name':{'$first':_0x42f24d(0x101)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x42f24d(0x1b3)},'bin':{'$first':_0x42f24d(0x151)},'type':{'$first':_0x42f24d(0x10b)},'floorlevel':{'$first':_0x42f24d(0xfc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x42f24d(0xfe)},'product_code':{'$first':_0x42f24d(0x193)},'storage':{'$first':_0x42f24d(0xdc)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x42f24d(0xbf)},'invoice':{'$first':_0x42f24d(0x130)}}}]),_0x1785cd=await customer[_0x42f24d(0x106)]({});let _0x4929a8;if(_0xdec544[_0x42f24d(0xf6)]==_0x42f24d(0x13b)){const _0x98e1df=await staff[_0x42f24d(0x13a)]({'email':_0xdec544[_0x42f24d(0xe8)]});_0x4929a8=await warehouse[_0x42f24d(0xf3)]([{'$match':{'status':'Enabled','name':_0x98e1df[_0x42f24d(0x146)]}},{'$group':{'_id':_0x42f24d(0x18b),'name':{'$first':_0x42f24d(0x18b)}}}]);}else _0x4929a8=await warehouse[_0x42f24d(0xf3)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x42f24d(0x18b),'name':{'$first':_0x42f24d(0x18b)}}}]);const _0x3be810=await product[_0x42f24d(0x106)]({}),_0x5b03c1=await suppliers[_0x42f24d(0x106)]({});if(_0x3e5d94[0x0]['language']==_0x42f24d(0x195)){var _0x1d6a10=users['English'];console[_0x42f24d(0x123)](_0x1d6a10);}else{if(_0x3e5d94[0x0][_0x42f24d(0x16a)]==_0x42f24d(0x107))var _0x1d6a10=users['Hindi'];else{if(_0x3e5d94[0x0]['language']==_0x42f24d(0x1c3))var _0x1d6a10=users[_0x42f24d(0x1c3)];else{if(_0x3e5d94[0x0][_0x42f24d(0x16a)]==_0x42f24d(0x14c))var _0x1d6a10=users[_0x42f24d(0x14c)];else{if(_0x3e5d94[0x0]['language']==_0x42f24d(0xf9))var _0x1d6a10=users[_0x42f24d(0xf9)];else{if(_0x3e5d94[0x0][_0x42f24d(0x16a)]==_0x42f24d(0x186))var _0x1d6a10=users[_0x42f24d(0xd6)];else{if(_0x3e5d94[0x0]['language']==_0x42f24d(0x19d))var _0x1d6a10=users[_0x42f24d(0x19d)];else{if(_0x3e5d94[0x0]['language']==_0x42f24d(0xe4))var _0x1d6a10=users[_0x42f24d(0x179)];}}}}}}}_0x409442[_0x42f24d(0xcb)](_0x42f24d(0x1a2),{'success':_0x506861[_0x42f24d(0xde)](_0x42f24d(0x132)),'errors':_0x506861[_0x42f24d(0xde)](_0x42f24d(0x10e)),'role':_0xdec544,'profile':_0x43b165,'customer':_0x1785cd,'warehouse':_0x4929a8,'product':_0x4eb593,'user':_0x36cdff,'master_shop':_0x3e5d94,'unit':_0x3be810,'language':_0x1d6a10,'suppliers':_0x5b03c1});}catch(_0x22f0fc){console[_0x42f24d(0x123)](_0x22f0fc);}}),router[a0_0x6b9e37(0x16c)](a0_0x6b9e37(0x17f),auth,async(_0x371d3f,_0x14be37)=>{var _0x1ff473=a0_0x6b9e37;try{const _0x39fd90=_0x371d3f[_0x1ff473(0xc9)]['id'],{invoice:_0x2e9437,warehouse_name:_0x4ab51b,room:_0x371432}=_0x371d3f[_0x1ff473(0x1ba)],_0x153fd9=await sales[_0x1ff473(0x13a)]({'invoice':_0x2e9437}),_0x19c9fb=_0x153fd9[_0x1ff473(0x188)]['map'](async _0x570027=>{var _0x550480=_0x1ff473,_0x4bc33e=await warehouse['findOne']({'name':_0x4ab51b,'room':_0x570027['room_name'],'warehouse_category':_0x550480(0xc8)});const _0x221c8b=_0x4bc33e[_0x550480(0xe2)][_0x550480(0x191)](_0x10e6ec=>{var _0x58cce0=_0x550480;_0x10e6ec[_0x58cce0(0x119)]==_0x570027[_0x58cce0(0x119)]&&_0x10e6ec[_0x58cce0(0x17c)]==_0x570027['floorlevel']&&_0x10e6ec[_0x58cce0(0x1c0)]==_0x570027[_0x58cce0(0x1c0)]&&_0x10e6ec[_0x58cce0(0x15c)]==_0x570027[_0x58cce0(0x15c)]&&_0x10e6ec[_0x58cce0(0x178)]==_0x570027[_0x58cce0(0x178)]&&_0x10e6ec['rack']==_0x570027['rack']&&_0x10e6ec[_0x58cce0(0x111)]==_0x570027[_0x58cce0(0x111)]&&_0x10e6ec[_0x58cce0(0xdb)]==_0x570027[_0x58cce0(0xdb)]&&_0x10e6ec['batch_code']==_0x570027[_0x58cce0(0x11b)]&&_0x10e6ec['invoice']==_0x570027[_0x58cce0(0x17a)]&&_0x10e6ec[_0x58cce0(0xd0)]==_0x570027[_0x58cce0(0xc2)]&&(_0x10e6ec['product_stock']=Math[_0x58cce0(0x172)](0x0,Math[_0x58cce0(0x1b5)](_0x10e6ec[_0x58cce0(0x1ad)])-Math[_0x58cce0(0x1b5)](_0x570027[_0x58cce0(0x1ae)])));});return _0x4bc33e;});Promise[_0x1ff473(0x166)](_0x19c9fb)[_0x1ff473(0x121)](async _0x1d0fe3=>{var _0xcb3b1b=_0x1ff473;try{for(const _0x161bdb of _0x1d0fe3){await _0x161bdb[_0xcb3b1b(0x136)]();}_0x153fd9[_0xcb3b1b(0xcd)]=_0xcb3b1b(0x196);const _0x4751c1=await _0x153fd9[_0xcb3b1b(0x136)](),_0x13281c=await master_shop[_0xcb3b1b(0x106)](),_0x2d553e=await email_settings[_0xcb3b1b(0x13a)](),_0x25a707=await supervisor_settings[_0xcb3b1b(0x106)]();var _0x30e081=_0x153fd9[_0xcb3b1b(0x188)],_0x2db558='',_0x5c9f18;for(_0x5c9f18 in _0x30e081){_0x2db558+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30e081[_0x5c9f18][_0xcb3b1b(0x119)]+_0xcb3b1b(0xb8)+_0xcb3b1b(0x159)+_0x30e081[_0x5c9f18][_0xcb3b1b(0x189)]+'</td>'+_0xcb3b1b(0x159)+_0x30e081[_0x5c9f18][_0xcb3b1b(0x1ae)]+'</td>'+_0xcb3b1b(0x159)+_0x30e081[_0x5c9f18]['unit']+_0xcb3b1b(0xb8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30e081[_0x5c9f18]['secondary_unit']+'</td>'+_0xcb3b1b(0x159)+_0x153fd9[_0xcb3b1b(0xf0)]+_0xcb3b1b(0xb8)+_0xcb3b1b(0x159)+_0x30e081[_0x5c9f18][_0xcb3b1b(0x163)]+_0xcb3b1b(0xb8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30e081[_0x5c9f18][_0xcb3b1b(0x111)]+_0x30e081[_0x5c9f18][_0xcb3b1b(0x153)]+_0x30e081[_0x5c9f18][_0xcb3b1b(0x178)]+_0x30e081[_0x5c9f18][_0xcb3b1b(0x15c)]+_0x30e081[_0x5c9f18]['type'][0x0]+_0x30e081[_0x5c9f18][_0xcb3b1b(0x17c)]+_0xcb3b1b(0xb8),_0xcb3b1b(0xd3);}let _0x40bb90=nodemailer[_0xcb3b1b(0xfa)]({'host':_0x2d553e[_0xcb3b1b(0xee)],'port':Number(_0x2d553e[_0xcb3b1b(0xe9)]),'secure':![],'auth':{'user':_0x2d553e[_0xcb3b1b(0xe8)],'pass':_0x2d553e[_0xcb3b1b(0x127)]}}),_0x5c1a82={'from':_0x2d553e[_0xcb3b1b(0xe8)],'to':_0x25a707[0x0][_0xcb3b1b(0x114)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0xcb3b1b(0x1bd)+_0x13281c[0x0]['image'],'cid':_0xcb3b1b(0xe1)}],'html':_0xcb3b1b(0x194)+_0xcb3b1b(0x14e)+_0xcb3b1b(0x100)+_0xcb3b1b(0x133)+_0xcb3b1b(0xed)+_0xcb3b1b(0x133)+_0xcb3b1b(0x19b)+_0xcb3b1b(0x11f)+_0xcb3b1b(0x133)+'<h2>\x20'+_0x13281c[0x0][_0xcb3b1b(0x14b)]+_0xcb3b1b(0x148)+_0xcb3b1b(0x11f)+_0xcb3b1b(0x11f)+_0xcb3b1b(0x1a4)+_0xcb3b1b(0x133)+_0xcb3b1b(0x183)+'\x20Order\x20Number\x20:\x20'+_0x153fd9[_0xcb3b1b(0x17a)]+'\x20'+_0xcb3b1b(0x174)+_0xcb3b1b(0x12d)+_0x153fd9['date']+'\x20'+_0xcb3b1b(0x15a)+_0xcb3b1b(0x14d)+_0xcb3b1b(0x11f)+_0xcb3b1b(0xda)+_0xcb3b1b(0xec)+_0xcb3b1b(0xdf)+_0xcb3b1b(0x180)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0xcb3b1b(0x12a)+_0xcb3b1b(0x13c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0xcb3b1b(0x1a6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xcb3b1b(0xd3)+_0xcb3b1b(0xba)+_0xcb3b1b(0x1b6)+'\x20'+_0x2db558+'\x20'+'</tbody>'+_0xcb3b1b(0x11e)+_0xcb3b1b(0x133)+_0xcb3b1b(0xe6)+_0xcb3b1b(0x1c2)+_0x13281c[0x0][_0xcb3b1b(0x14b)]+_0xcb3b1b(0x14d)+_0xcb3b1b(0x11f)+'</div>'+_0xcb3b1b(0x181)};_0x40bb90[_0xcb3b1b(0xbb)](_0x5c1a82,function(_0x106e1c,_0x2cb673){var _0xd072fe=_0xcb3b1b;_0x106e1c?(console[_0xd072fe(0x123)](_0x106e1c),console[_0xd072fe(0x123)](_0xd072fe(0xfb))):console['log']('Email\x20sent\x20successfully');}),_0x371d3f[_0xcb3b1b(0xde)](_0xcb3b1b(0x132),_0xcb3b1b(0x15d)),_0x14be37[_0xcb3b1b(0x137)](_0xcb3b1b(0x156)+_0x39fd90);}catch(_0x496239){console[_0xcb3b1b(0xfd)](_0x496239),_0x14be37[_0xcb3b1b(0x15b)](0x1f4)[_0xcb3b1b(0x1ab)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1ff473(0x17d)](_0x1509b5=>{var _0xe7e645=_0x1ff473;console[_0xe7e645(0xfd)](_0x1509b5),_0x14be37['status'](0x1f4)['json']({'error':_0xe7e645(0x176)});});}catch(_0x28c63d){console['log'](_0x28c63d);}}),router[a0_0x6b9e37(0x125)](a0_0x6b9e37(0x165),auth,async(_0x300f67,_0x229f11)=>{var _0x797c4d=a0_0x6b9e37;try{const {username:_0x14ef35,email:_0x171b78,role:_0x447cd8}=_0x300f67[_0x797c4d(0x10d)],_0x491813=_0x300f67[_0x797c4d(0x10d)],_0x28fa9f=await profile[_0x797c4d(0x13a)]({'email':_0x491813[_0x797c4d(0xe8)]}),_0x2a4034=await master_shop[_0x797c4d(0x106)](),_0x238a07=_0x300f67[_0x797c4d(0xc9)]['id'],_0x13d1b6=await sales['findById'](_0x238a07);var _0x2f6b8c=[_0x797c4d(0x17e),_0x797c4d(0x155)];const _0x506080=await warehouse['aggregate']([{'$match':{'name':_0x13d1b6[_0x797c4d(0xf0)],'warehouse_category':_0x797c4d(0xc8)}},{'$unwind':_0x797c4d(0x1c5)},{'$group':{'_id':_0x797c4d(0x108),'name':{'$first':_0x797c4d(0x101)},'product_stock':{'$first':_0x797c4d(0xd1)},'bay':{'$first':_0x797c4d(0x1b3)},'bin':{'$first':_0x797c4d(0x151)},'type':{'$first':_0x797c4d(0x10b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x797c4d(0xfe)},'product_code':{'$first':_0x797c4d(0x193)},'storage':{'$first':_0x797c4d(0xdc)},'rack':{'$first':'$product_details.rack'}}}]),_0x2ec512=await customer[_0x797c4d(0x106)]({});let _0x2edcbd;if(_0x491813[_0x797c4d(0xf6)]=='staff'){const _0x9e8046=await staff[_0x797c4d(0x13a)]({'email':_0x491813[_0x797c4d(0xe8)]});_0x2edcbd=await warehouse[_0x797c4d(0xf3)]([{'$match':{'status':_0x797c4d(0x160),'name':_0x9e8046[_0x797c4d(0x146)],'warehouse_category':_0x797c4d(0xc8)}},{'$group':{'_id':_0x797c4d(0x18b),'name':{'$first':_0x797c4d(0x18b)}}}]);}else _0x2edcbd=await warehouse[_0x797c4d(0xf3)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x797c4d(0x18b),'name':{'$first':_0x797c4d(0x18b)}}}]);const _0x4465f5=await product[_0x797c4d(0x106)]({});if(_0x2a4034[0x0][_0x797c4d(0x16a)]=='English\x20(US)'){var _0x1424df=users[_0x797c4d(0x1a7)];console[_0x797c4d(0x123)](_0x1424df);}else{if(_0x2a4034[0x0]['language']==_0x797c4d(0x107))var _0x1424df=users[_0x797c4d(0x107)];else{if(_0x2a4034[0x0][_0x797c4d(0x16a)]==_0x797c4d(0x1c3))var _0x1424df=users[_0x797c4d(0x1c3)];else{if(_0x2a4034[0x0]['language']=='Spanish')var _0x1424df=users[_0x797c4d(0x14c)];else{if(_0x2a4034[0x0]['language']=='French')var _0x1424df=users[_0x797c4d(0xf9)];else{if(_0x2a4034[0x0][_0x797c4d(0x16a)]==_0x797c4d(0x186))var _0x1424df=users[_0x797c4d(0xd6)];else{if(_0x2a4034[0x0][_0x797c4d(0x16a)]==_0x797c4d(0x19d))var _0x1424df=users[_0x797c4d(0x19d)];else{if(_0x2a4034[0x0][_0x797c4d(0x16a)]==_0x797c4d(0xe4))var _0x1424df=users['Arabic'];}}}}}}}_0x229f11[_0x797c4d(0xcb)](_0x797c4d(0xd9),{'success':_0x300f67[_0x797c4d(0xde)](_0x797c4d(0x132)),'errors':_0x300f67[_0x797c4d(0xde)](_0x797c4d(0x10e)),'role':_0x491813,'profile':_0x28fa9f,'customer':_0x2ec512,'warehouse':_0x2edcbd,'product':_0x506080,'user':_0x13d1b6,'master_shop':_0x2a4034,'unit':_0x4465f5,'language':_0x1424df});}catch(_0x26b525){console[_0x797c4d(0x123)](_0x26b525);}}),router['post'](a0_0x6b9e37(0x165),auth,async(_0x5dc45a,_0x48a3e8)=>{var _0xc634b4=a0_0x6b9e37;try{const _0xb3ab67=_0x5dc45a[_0xc634b4(0xc9)]['id'],_0x272521=await sales[_0xc634b4(0x13a)]({'_id':_0x5dc45a['params']['id']}),_0x10ed39=await warehouse[_0xc634b4(0x13a)]({'name':_0x272521[_0xc634b4(0xf0)],'room':_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x1ac)]}),{invoice:_0xf628d4,date:_0x1bdc03,warehouse_name:_0x1d3fab,product_name:_0x5ba3e0,stock:_0x415fb9,quantity:_0x434494,note:_0x16034f,room:_0xf4cfee,customer:_0x1131bf,SCRN:_0x4e02ae}=_0x5dc45a['body'];if(typeof _0x5ba3e0==_0xc634b4(0x16b))var _0x36719c=[_0x5dc45a['body'][_0xc634b4(0x119)]],_0x3d4578=[_0x5dc45a[_0xc634b4(0x1ba)]['stock']],_0x52dd8b=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x19a)]],_0x293a52=[_0x5dc45a[_0xc634b4(0x1ba)]['primary_code']],_0x5178a4=[_0x5dc45a['body']['secondary_code']],_0xe02cfe=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x122)]],_0x54b789=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x117)]],_0x93288c=[_0x5dc45a['body'][_0xc634b4(0x199)]],_0x2558c9=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0xce)]],_0x44d064=[_0x5dc45a['body'][_0xc634b4(0x11b)]],_0x52a759=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0xdb)]],_0x4a5366=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x18d)]],_0x252d27=[_0x5dc45a['body'][_0xc634b4(0x11d)]],_0x4ef8c3=[_0x5dc45a[_0xc634b4(0x1ba)]['requested_qty']],_0x562d77=[_0x5dc45a['body'][_0xc634b4(0x164)]],_0x43af5c=[_0x5dc45a['body'][_0xc634b4(0x14a)]],_0x87fd51=[_0x5dc45a['body'][_0xc634b4(0x15f)]],_0x36e4a5=[_0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x1ae)]],_0x4553ae=[_0x5dc45a['body'][_0xc634b4(0xff)]];else var _0x36719c=[..._0x5dc45a[_0xc634b4(0x1ba)]['product_name']],_0x3d4578=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x161)]],_0x52dd8b=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x19a)]],_0x293a52=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x1a9)]],_0x5178a4=[..._0x5dc45a[_0xc634b4(0x1ba)]['secondary_code']],_0xe02cfe=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x122)]],_0x54b789=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x117)]],_0x93288c=[..._0x5dc45a[_0xc634b4(0x1ba)]['primary_unit']],_0x2558c9=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0xce)]],_0x44d064=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x11b)]],_0x52a759=[..._0x5dc45a['body'][_0xc634b4(0xdb)]],_0x4a5366=[..._0x5dc45a['body'][_0xc634b4(0x18d)]],_0x252d27=[..._0x5dc45a[_0xc634b4(0x1ba)]['production_date']],_0x4ef8c3=[..._0x5dc45a['body'][_0xc634b4(0x198)]],_0x562d77=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x164)]],_0x43af5c=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x14a)]],_0x87fd51=[..._0x5dc45a[_0xc634b4(0x1ba)]['prod_cat']],_0x36e4a5=[..._0x5dc45a[_0xc634b4(0x1ba)][_0xc634b4(0x1ae)]],_0x4553ae=[..._0x5dc45a[_0xc634b4(0x1ba)]['RoomAssigned']];const _0x2fbdb4=_0x36719c[_0xc634b4(0x191)](_0x1d6e24=>{return _0x1d6e24={'product_name':_0x1d6e24};});_0x3d4578['forEach']((_0x1504e0,_0x1e4978)=>{var _0x50fb64=_0xc634b4;_0x2fbdb4[_0x1e4978][_0x50fb64(0x161)]=Math[_0x50fb64(0x1b5)](_0x1504e0);}),_0x52dd8b[_0xc634b4(0x168)]((_0x4a1ed9,_0x116d29)=>{var _0x438598=_0xc634b4;_0x2fbdb4[_0x116d29][_0x438598(0x1ae)]=_0x4a1ed9;}),_0x293a52['forEach']((_0x182994,_0x4e7257)=>{var _0x22e15d=_0xc634b4;_0x2fbdb4[_0x4e7257][_0x22e15d(0x1a9)]=_0x182994;}),_0x5178a4['forEach']((_0x68990d,_0x49a82a)=>{var _0x5018ab=_0xc634b4;_0x2fbdb4[_0x49a82a][_0x5018ab(0x147)]=_0x68990d;}),_0xe02cfe[_0xc634b4(0x168)]((_0x49d7fc,_0x25de70)=>{_0x2fbdb4[_0x25de70]['product_code']=_0x49d7fc;}),_0x54b789['forEach']((_0xe32614,_0x3123f7)=>{var _0x309ec7=_0xc634b4;_0x4553ae[_0x309ec7(0x168)]((_0x4b0f17,_0x48cfd4)=>{var _0x1157ab=_0x309ec7;if(_0x4b0f17==_0x1157ab(0xef)&&_0x3123f7==_0x48cfd4){var _0x30799e=_0xe32614[_0x1157ab(0x18c)](0x3);_0x2fbdb4[_0x3123f7][_0x1157ab(0x111)]=_0xe32614[0x0],_0x2fbdb4[_0x3123f7]['rack']=_0xe32614[0x1],_0x2fbdb4[_0x3123f7][_0x1157ab(0x178)]=0x0,_0x2fbdb4[_0x3123f7][_0x1157ab(0x15c)]=0x0,_0x2fbdb4[_0x3123f7][_0x1157ab(0x1c0)]=_0x1157ab(0xbc),_0x2fbdb4[_0x3123f7][_0x1157ab(0x17c)]=_0x30799e;}else{if(_0x4b0f17==_0x1157ab(0xe5)&&_0x3123f7==_0x48cfd4){var _0x30799e=_0xe32614[_0x1157ab(0x18c)](0x3);_0x2fbdb4[_0x3123f7][_0x1157ab(0x111)]=_0xe32614[0x0],_0x2fbdb4[_0x3123f7]['rack']=_0xe32614[0x1],_0x2fbdb4[_0x3123f7]['bay']=0x0,_0x2fbdb4[_0x3123f7][_0x1157ab(0x15c)]=0x0,_0x2fbdb4[_0x3123f7]['type']=_0x1157ab(0xbc),_0x2fbdb4[_0x3123f7]['floorlevel']=_0xe32614[0x5];}else{if(_0x3123f7==_0x48cfd4){var _0x227e75;if(_0xe32614[0x4]=='L')_0x227e75=_0x1157ab(0x118);else _0xe32614[0x4]=='F'&&(_0x227e75=_0x1157ab(0xbc));_0x2fbdb4[_0x3123f7][_0x1157ab(0x111)]=_0xe32614[0x0],_0x2fbdb4[_0x3123f7]['rack']=_0xe32614[0x1],_0x2fbdb4[_0x3123f7][_0x1157ab(0x178)]=_0xe32614[0x2],_0x2fbdb4[_0x3123f7][_0x1157ab(0x15c)]=_0xe32614[0x3],_0x2fbdb4[_0x3123f7]['type']=_0x227e75,_0x2fbdb4[_0x3123f7][_0x1157ab(0x17c)]=_0xe32614[0x5];}}}});}),_0x93288c[_0xc634b4(0x168)]((_0x26a690,_0x45caff)=>{_0x2fbdb4[_0x45caff]['unit']=_0x26a690;}),_0x2558c9['forEach']((_0x3641e0,_0x17c3bd)=>{var _0x2f2156=_0xc634b4;_0x2fbdb4[_0x17c3bd][_0x2f2156(0xce)]=_0x3641e0;}),_0x44d064[_0xc634b4(0x168)]((_0x5982b2,_0x225174)=>{var _0x4076d9=_0xc634b4;_0x2fbdb4[_0x225174][_0x4076d9(0x11b)]=_0x5982b2;}),_0x52a759[_0xc634b4(0x168)]((_0x5eb250,_0x480e28)=>{var _0xde1057=_0xc634b4;_0x2fbdb4[_0x480e28][_0xde1057(0xdb)]=_0x5eb250;}),_0x4a5366['forEach']((_0x2c1860,_0x45043d)=>{var _0x4c9f30=_0xc634b4;_0x2fbdb4[_0x45043d][_0x4c9f30(0xc5)]=_0x2c1860;}),_0x252d27['forEach']((_0x3f94c4,_0xe659a0)=>{_0x2fbdb4[_0xe659a0]['production_date']=_0x3f94c4;}),_0x4ef8c3['forEach']((_0x46a179,_0x34fff0)=>{var _0x50e9a4=_0xc634b4;_0x2fbdb4[_0x34fff0]['requested_qty']=Math[_0x50e9a4(0x1b5)](_0x46a179);}),_0x562d77['forEach']((_0x35f081,_0xfcc1b4)=>{var _0x449141=_0xc634b4;_0x2fbdb4[_0xfcc1b4][_0x449141(0x164)]=_0x35f081;}),_0x43af5c[_0xc634b4(0x168)]((_0xd5f837,_0x4df22f)=>{_0x2fbdb4[_0x4df22f]['delivery_code']=_0xd5f837;}),_0x87fd51[_0xc634b4(0x168)]((_0x5641d5,_0x2a1c8a)=>{_0x2fbdb4[_0x2a1c8a]['prod_cat']=_0x5641d5;}),_0x36e4a5[_0xc634b4(0x168)]((_0x3e537f,_0xa2fbab)=>{var _0x52c3d9=_0xc634b4;_0x2fbdb4[_0xa2fbab][_0x52c3d9(0xc0)]=_0x3e537f;}),_0x4553ae[_0xc634b4(0x168)]((_0x221f6f,_0x59ed21)=>{var _0x203d76=_0xc634b4;_0x2fbdb4[_0x59ed21][_0x203d76(0x163)]=_0x221f6f;});var _0xa5750c=0x0;_0x2fbdb4['forEach'](_0x38923c=>{var _0x242280=_0xc634b4;console['log'](_0x242280(0x143),_0x38923c),(parseInt(_0x38923c[_0x242280(0x161)])<parseInt(_0x38923c[_0x242280(0x1ae)])||parseInt(_0x38923c['quantity'])==0x0)&&_0xa5750c++;});if(_0xa5750c!=0x0)return _0x5dc45a[_0xc634b4(0xde)]('errors',_0xc634b4(0xf5)),_0x48a3e8[_0xc634b4(0x137)](_0xc634b4(0xdd));const _0x3485f1=_0x2fbdb4[_0xc634b4(0x115)](_0x309bc5=>_0x309bc5[_0xc634b4(0x1ae)]!=='0'&&_0x309bc5[_0xc634b4(0x1ae)]!=='');_0x272521[_0xc634b4(0x17a)]=_0xf628d4,_0x272521[_0xc634b4(0x1b2)]=_0x1131bf,_0x272521[_0xc634b4(0x1c1)]=_0x1bdc03,_0x272521[_0xc634b4(0xf0)]=_0x1d3fab,_0x272521[_0xc634b4(0x188)]=_0x3485f1,_0x272521[_0xc634b4(0xd7)]=_0x16034f,_0x272521[_0xc634b4(0x19f)]=_0x4e02ae,_0x272521[_0xc634b4(0xcd)]='False',_0x272521['isAllowEdit']=_0xc634b4(0x113);const _0xf4e5b6=await _0x272521['save']();_0x5dc45a['flash'](_0xc634b4(0x132),'Sales\x20Update\x20successfully'),_0x48a3e8[_0xc634b4(0x137)]('/all_sales/view');}catch(_0x23ebff){console['log'](_0x23ebff);}}),router[a0_0x6b9e37(0x16c)](a0_0x6b9e37(0xeb),auth,async(_0x5868b6,_0x4dfb6d)=>{var _0xa5cf56=a0_0x6b9e37;try{const _0x2c6e18=_0x5868b6['params']['id'],{invoice:_0x579bf8,customer:_0xd6577e,receivable_amount:_0x526faa,received_amount:_0x183127}=_0x5868b6[_0xa5cf56(0x1ba)],_0x17a66d=await sales[_0xa5cf56(0xbd)](_0x2c6e18);console[_0xa5cf56(0x123)](_0x17a66d);var _0x3ce6ea=_0x526faa-_0x183127;console['log'](_0x183127),_0x17a66d[_0xa5cf56(0x10f)]=parseFloat(_0x183127)+parseFloat(_0x17a66d['received_amount']),_0x17a66d['due_amount']=_0x3ce6ea,console[_0xa5cf56(0x123)](_0x17a66d);const _0x1d4171=await _0x17a66d[_0xa5cf56(0x136)](),_0x2d45a8=await c_payment_data[_0xa5cf56(0x13a)]({'invoice':_0x579bf8});_0x2d45a8['amount']=_0x3ce6ea,await _0x2d45a8[_0xa5cf56(0x136)]();let _0x18048f=new Date(),_0x1781e7=('0'+_0x18048f['getDate']())['slice'](-0x2),_0x97010e=('0'+(_0x18048f[_0xa5cf56(0x1b0)]()+0x1))[_0xa5cf56(0x18c)](-0x2),_0x254c82=_0x18048f['getFullYear'](),_0x3d724b=_0x254c82+'-'+_0x97010e+'-'+_0x1781e7;const _0x546586=new customer_payment({'invoice':_0x579bf8,'date':_0x254c82+'-'+_0x97010e+'-'+_0x1781e7,'customer':_0xd6577e,'reason':_0xa5cf56(0x150),'amount':_0x183127}),_0x127782=await _0x546586[_0xa5cf56(0x136)]();_0x5868b6[_0xa5cf56(0xde)]('success',_0xa5cf56(0x10a)),_0x4dfb6d['redirect'](_0xa5cf56(0x167));}catch(_0x274daf){console[_0xa5cf56(0x123)](_0x274daf);}}),router[a0_0x6b9e37(0x125)](a0_0x6b9e37(0xc6),auth,async(_0x9cba79,_0x289f53)=>{var _0x6d828a=a0_0x6b9e37;try{const {username:_0x49d094,email:_0x4b0cd1,role:_0x5948ba}=_0x9cba79['user'],_0x55bc4f=_0x9cba79['user'],_0x3b48d3=await profile[_0x6d828a(0x13a)]({'email':_0x55bc4f[_0x6d828a(0xe8)]}),_0x315e1c=await master_shop[_0x6d828a(0x106)]();console[_0x6d828a(0x123)]('master',_0x315e1c);const _0x508cbd=_0x9cba79[_0x6d828a(0xc9)]['id'],_0x62cac8=await sales[_0x6d828a(0xbd)](_0x508cbd);console[_0x6d828a(0x123)](_0x62cac8);const _0x5a988c=await customer[_0x6d828a(0x13a)]({'name':_0x62cac8['customer']});console['log'](_0x5a988c);if(_0x315e1c[0x0][_0x6d828a(0x16a)]==_0x6d828a(0x195)){var _0x15d96f=users[_0x6d828a(0x1a7)];console[_0x6d828a(0x123)](_0x15d96f);}else{if(_0x315e1c[0x0]['language']==_0x6d828a(0x107))var _0x15d96f=users['Hindi'];else{if(_0x315e1c[0x0][_0x6d828a(0x16a)]==_0x6d828a(0x1c3))var _0x15d96f=users[_0x6d828a(0x1c3)];else{if(_0x315e1c[0x0][_0x6d828a(0x16a)]==_0x6d828a(0x14c))var _0x15d96f=users['Spanish'];else{if(_0x315e1c[0x0]['language']==_0x6d828a(0xf9))var _0x15d96f=users[_0x6d828a(0xf9)];else{if(_0x315e1c[0x0][_0x6d828a(0x16a)]==_0x6d828a(0x186))var _0x15d96f=users[_0x6d828a(0xd6)];else{if(_0x315e1c[0x0][_0x6d828a(0x16a)]==_0x6d828a(0x19d))var _0x15d96f=users[_0x6d828a(0x19d)];else{if(_0x315e1c[0x0][_0x6d828a(0x16a)]==_0x6d828a(0xe4))var _0x15d96f=users[_0x6d828a(0x179)];}}}}}}}_0x289f53['render'](_0x6d828a(0x182),{'success':_0x9cba79[_0x6d828a(0xde)](_0x6d828a(0x132)),'errors':_0x9cba79['flash'](_0x6d828a(0x10e)),'role':_0x55bc4f,'profile':_0x3b48d3,'master_shop':_0x315e1c,'customers':_0x5a988c,'sales':_0x62cac8,'language':_0x15d96f});}catch(_0x1aa89d){console[_0x6d828a(0x123)](_0x1aa89d);}}),router['get'](a0_0x6b9e37(0x1bf),auth,async(_0x509345,_0x28934b)=>{var _0x329bc9=a0_0x6b9e37;try{const {username:_0x544f27,email:_0x56d3de,role:_0x88eb34}=_0x509345[_0x329bc9(0x10d)],_0x16fdef=_0x509345[_0x329bc9(0x10d)],_0x510226=await profile['findOne']({'email':_0x16fdef['email']}),_0x36de02=await master_shop[_0x329bc9(0x106)]();console[_0x329bc9(0x123)](_0x329bc9(0x1be),_0x36de02);const _0x43ac9f=_0x509345['params']['id'];console[_0x329bc9(0x123)](_0x43ac9f);const _0x301ad1=await sales[_0x329bc9(0xbd)](_0x43ac9f);console[_0x329bc9(0x123)](_0x329bc9(0x104),_0x301ad1);const _0x5c5c41=await warehouse['aggregate']([{'$match':{'name':_0x329bc9(0xf7),'room':_0x329bc9(0xe7)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x329bc9(0x101)},'product_stock':{'$first':_0x329bc9(0xd1)},'level':{'$first':_0x329bc9(0x1a8)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x329bc9(0x134)},'primary_code':{'$first':_0x329bc9(0x11a)},'secondary_code':{'$first':_0x329bc9(0xfe)},'product_code':{'$first':_0x329bc9(0x193)}}}]);console[_0x329bc9(0x123)](_0x329bc9(0x185),_0x5c5c41);const _0x2b0bfd=await product[_0x329bc9(0x106)]({});warehouse_data=await warehouse[_0x329bc9(0xf3)]([{'$match':{'status':_0x329bc9(0x160),'name':_0x329bc9(0xf7),'warehouse_category':_0x329bc9(0xc8)}},{'$group':{'_id':_0x329bc9(0x18b),'name':{'$first':_0x329bc9(0x18b)}}},{'$sort':{'name':0x1}}]);var _0x48560c=[_0x329bc9(0xe7)];if(_0x36de02[0x0][_0x329bc9(0x16a)]==_0x329bc9(0x195)){var _0x505d73=users[_0x329bc9(0x1a7)];console[_0x329bc9(0x123)](_0x505d73);}else{if(_0x36de02[0x0][_0x329bc9(0x16a)]==_0x329bc9(0x107))var _0x505d73=users[_0x329bc9(0x107)];else{if(_0x36de02[0x0][_0x329bc9(0x16a)]==_0x329bc9(0x1c3))var _0x505d73=users[_0x329bc9(0x1c3)];else{if(_0x36de02[0x0][_0x329bc9(0x16a)]==_0x329bc9(0x14c))var _0x505d73=users[_0x329bc9(0x14c)];else{if(_0x36de02[0x0][_0x329bc9(0x16a)]==_0x329bc9(0xf9))var _0x505d73=users[_0x329bc9(0xf9)];else{if(_0x36de02[0x0][_0x329bc9(0x16a)]=='Portuguese\x20(BR)')var _0x505d73=users[_0x329bc9(0xd6)];else{if(_0x36de02[0x0][_0x329bc9(0x16a)]==_0x329bc9(0x19d))var _0x505d73=users[_0x329bc9(0x19d)];else{if(_0x36de02[0x0][_0x329bc9(0x16a)]=='Arabic\x20(ae)')var _0x505d73=users['Arabic'];}}}}}}}_0x28934b[_0x329bc9(0xcb)](_0x329bc9(0x1bb),{'success':_0x509345['flash'](_0x329bc9(0x132)),'errors':_0x509345[_0x329bc9(0xde)](_0x329bc9(0x10e)),'role':_0x16fdef,'profile':_0x510226,'user':_0x301ad1,'stock':_0x5c5c41,'master_shop':_0x36de02,'unit':_0x2b0bfd,'language':_0x505d73,'warehouses':warehouse_data,'rooms':_0x48560c});}catch(_0x12dce7){console['log'](_0x12dce7),_0x28934b['status'](0xc8)[_0x329bc9(0x1ab)]({'message':_0x12dce7[_0x329bc9(0x129)]});}}),router[a0_0x6b9e37(0x16c)](a0_0x6b9e37(0x1bf),auth,async(_0x153e8c,_0x4bcefa)=>{var _0x418f69=a0_0x6b9e37;try{const {invoice:_0x5ea16d,date:_0x23bd62,warehouse_name:_0x37d119,product_name:_0x138a8c,primary_code:_0x337434,secondary_code:_0x1d1172,product_code:_0xe28e7d,sales_quantity:_0x35adf0,stocks:_0x530149,return_qty:_0x38bdd3,Room_name:_0x20229e,to_warehouse_name:_0x428120,to_Roomname:_0x590765,to_Room_name:_0x5a11da,note:_0x428d00,level:_0x3e990a,isle:_0x496edf,pallet:_0x5cabda}=_0x153e8c['body'];if(typeof _0x138a8c==_0x418f69(0x16b))var _0x24cdd5=[_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x119)]],_0x4e8f52=[_0x153e8c[_0x418f69(0x1ba)]['primary_code']],_0x59e022=[_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x147)]],_0x152bfb=[_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x189)]],_0x5f3bc0=[_0x153e8c['body']['sales_quantity']],_0x45e2ee=[_0x153e8c[_0x418f69(0x1ba)]['stocks']],_0x8f70a5=[_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0xbe)]],_0x2b6649=[_0x153e8c['body'][_0x418f69(0x178)]],_0x244845=[_0x153e8c[_0x418f69(0x1ba)]['bin']],_0xa4647=[_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x140)]],_0x171675=[_0x153e8c['body'][_0x418f69(0x17c)]];else var _0x24cdd5=[..._0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x119)]],_0x4e8f52=[..._0x153e8c[_0x418f69(0x1ba)]['primary_code']],_0x59e022=[..._0x153e8c['body'][_0x418f69(0x147)]],_0x152bfb=[..._0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x189)]],_0x5f3bc0=[..._0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x158)]],_0x45e2ee=[..._0x153e8c[_0x418f69(0x1ba)][_0x418f69(0xb9)]],_0x8f70a5=[..._0x153e8c[_0x418f69(0x1ba)][_0x418f69(0xbe)]],_0x2b6649=[..._0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x178)]],_0x244845=[..._0x153e8c[_0x418f69(0x1ba)]['bin']],_0xa4647=[..._0x153e8c[_0x418f69(0x1ba)]['types']],_0x171675=[..._0x153e8c[_0x418f69(0x1ba)]['floorlevel']];const _0x4b18f3=_0x24cdd5[_0x418f69(0x191)](_0x4a33c5=>{return _0x4a33c5={'product_name':_0x4a33c5};});_0x4e8f52['forEach']((_0x520bcd,_0x1b6c8d)=>{var _0x2a4618=_0x418f69;_0x4b18f3[_0x1b6c8d][_0x2a4618(0x1a9)]=_0x520bcd;}),_0x59e022[_0x418f69(0x168)]((_0x4666e9,_0x2b978c)=>{_0x4b18f3[_0x2b978c]['secondary_code']=_0x4666e9;}),_0x152bfb['forEach']((_0xbb5219,_0x28e7d2)=>{_0x4b18f3[_0x28e7d2]['product_code']=_0xbb5219;}),_0x5f3bc0[_0x418f69(0x168)]((_0x40dc95,_0xee95e2)=>{var _0x218b9e=_0x418f69;_0x4b18f3[_0xee95e2][_0x218b9e(0x190)]=_0x40dc95;}),_0x45e2ee['forEach']((_0x82f38d,_0x404407)=>{var _0x4e6a4d=_0x418f69;_0x4b18f3[_0x404407][_0x4e6a4d(0x161)]=_0x82f38d;}),_0x8f70a5['forEach']((_0x470fb9,_0x7285fe)=>{var _0x3db7a5=_0x418f69;_0x4b18f3[_0x7285fe][_0x3db7a5(0xbe)]=_0x470fb9;}),_0x2b6649['forEach']((_0x131231,_0x51b388)=>{var _0xb3bdaa=_0x418f69;_0x4b18f3[_0x51b388][_0xb3bdaa(0x178)]=_0x131231;}),_0x244845[_0x418f69(0x168)]((_0x5ec7ce,_0xdf2e04)=>{_0x4b18f3[_0xdf2e04]['bin']=_0x5ec7ce;}),_0xa4647[_0x418f69(0x168)]((_0x457eec,_0x26b248)=>{var _0x366231=_0x418f69;_0x4b18f3[_0x26b248][_0x366231(0x1c0)]=_0x457eec;}),_0x171675[_0x418f69(0x168)]((_0x411780,_0x22a875)=>{var _0x5b7a21=_0x418f69;_0x4b18f3[_0x22a875][_0x5b7a21(0x17c)]=_0x411780;});var _0x4c850f=0x0;_0x4b18f3[_0x418f69(0x168)](_0x51654d=>{var _0x2e0377=_0x418f69;console[_0x2e0377(0x123)](_0x2e0377(0x143),_0x51654d),(parseInt(_0x51654d[_0x2e0377(0x190)])<parseInt(_0x51654d[_0x2e0377(0xbe)])||parseInt(_0x51654d['stock'])<parseInt(_0x51654d[_0x2e0377(0xbe)])&&parseInt(_0x51654d[_0x2e0377(0x190)])>parseInt(_0x51654d['return_qty'])||parseInt(_0x51654d['return_qty'])==0x0)&&_0x4c850f++;});if(_0x4c850f!=0x0)return _0x153e8c[_0x418f69(0xde)]('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x4bcefa[_0x418f69(0x137)]('back');const _0x31a3f9=await sales[_0x418f69(0x13a)]({'invoice':_0x5ea16d});console[_0x418f69(0x123)](_0x31a3f9),_0x31a3f9['return_data']=_0x418f69(0x196);const _0x146674=await _0x31a3f9[_0x418f69(0x136)](),_0x2002c5=new sales_return({'invoice':_0x5ea16d,'customer':_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x1b2)],'date':_0x23bd62,'warehouse_name':_0x37d119,'room':_0x20229e,'ToWarehouse':_0x428120,'ToRoom':_0x5a11da,'return_sale':_0x4b18f3,'note':_0x428d00}),_0x7c15e7=await _0x2002c5[_0x418f69(0x136)]();console['log'](_0x2002c5);const _0x3a7703=await sales_return[_0x418f69(0x13a)]({'invoice':_0x5ea16d}),_0x61bb3e=await warehouse['findOne']({'name':_0x428120,'room':_0x5a11da});_0x3a7703[_0x418f69(0x1bb)][_0x418f69(0x168)](_0xec217a=>{var _0x3e9aa3=_0x418f69,_0x1b6aa4=0x0;const _0x5cc45b=_0x61bb3e['product_details'][_0x3e9aa3(0x191)](_0x5d9157=>{var _0xcc9d4d=_0x3e9aa3;_0x5d9157['product_name']==_0xec217a[_0xcc9d4d(0x119)]&&_0x5d9157[_0xcc9d4d(0x17c)]==_0xec217a[_0xcc9d4d(0x17c)]&&_0x5d9157['type']==_0xec217a[_0xcc9d4d(0x1c0)]&&_0x5d9157[_0xcc9d4d(0x15c)]==_0xec217a[_0xcc9d4d(0x15c)]&&_0x5d9157[_0xcc9d4d(0x178)]==_0xec217a['bay']&&(_0x5d9157[_0xcc9d4d(0x1ad)]=parseInt(_0x5d9157['product_stock'])+parseInt(_0xec217a[_0xcc9d4d(0xbe)]),_0x1b6aa4++);});_0x1b6aa4=='0'&&(_0x61bb3e['product_details']=_0x61bb3e[_0x3e9aa3(0xe2)][_0x3e9aa3(0x1a5)]({'product_name':_0xec217a['product_name'],'product_stock':_0xec217a[_0x3e9aa3(0xbe)],'primary_code':_0xec217a[_0x3e9aa3(0x1a9)],'secondary_code':_0xec217a[_0x3e9aa3(0x147)],'product_code':_0xec217a['product_code'],'bay':_0xec217a[_0x3e9aa3(0x178)],'bin':_0xec217a[_0x3e9aa3(0x15c)],'type':_0xec217a['type'],'floorlevel':_0xec217a[_0x3e9aa3(0x17c)]})),console[_0x3e9aa3(0x123)](_0x3e9aa3(0x124),_0x61bb3e);}),await _0x61bb3e[_0x418f69(0x136)](),console[_0x418f69(0x123)](_0x153e8c[_0x418f69(0x1ba)]);const _0x4bd4d9=new c_payment_data({'invoice':_0x5ea16d,'customer':_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x1b2)],'reason':_0x418f69(0x197)});await _0x4bd4d9['save']();const _0x84a7b7=await master_shop['find']();console[_0x418f69(0x123)]('add\x20post',_0x84a7b7[0x0][_0x418f69(0xd4)]);const _0x49d83f=await email_settings['findOne'](),_0x2704c4=await customer[_0x418f69(0x13a)]({'name':_0x153e8c[_0x418f69(0x1ba)][_0x418f69(0x1b2)]});console[_0x418f69(0x123)](_0x418f69(0x192),_0x2704c4);_0x84a7b7[0x0][_0x418f69(0x170)]==0x1?(right_currency=_0x84a7b7[0x0][_0x418f69(0x120)],left_currency=''):(right_currency='',left_currency=_0x84a7b7[0x0][_0x418f69(0x120)]);var _0x320253=_0x24cdd5,_0x2cc726=_0x8f70a5,_0x42083a='',_0x733198;for(_0x733198 in _0x320253){_0x42083a+=_0x418f69(0xdf)+_0x418f69(0x159)+_0x320253[_0x733198]+_0x418f69(0xb8)+_0x418f69(0x159)+_0x2cc726[_0x733198]+_0x418f69(0xb8)+_0x418f69(0xd3);}console[_0x418f69(0x123)]('product_list',_0x42083a);let _0x4d5e41=nodemailer[_0x418f69(0xfa)]({'service':_0x418f69(0x16e),'auth':{'user':_0x49d83f[_0x418f69(0xe8)],'pass':_0x49d83f[_0x418f69(0x127)]}}),_0x5f0144={'from':_0x49d83f[_0x418f69(0xe8)],'to':_0x2704c4[_0x418f69(0xe8)],'subject':_0x418f69(0x1c4),'attachments':[{'filename':_0x418f69(0x131),'path':__dirname+'/../public'+_0x418f69(0x1bd)+_0x84a7b7[0x0][_0x418f69(0xd4)],'cid':'logo'}],'html':_0x418f69(0x194)+_0x418f69(0x14e)+'</head><body>'+_0x418f69(0x133)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x418f69(0x133)+_0x418f69(0x19b)+_0x418f69(0x11f)+_0x418f69(0x133)+_0x418f69(0xc4)+_0x84a7b7[0x0][_0x418f69(0x14b)]+_0x418f69(0x148)+'</div>'+_0x418f69(0x11f)+'<hr\x20class=\x22my-3\x22>'+_0x418f69(0x133)+_0x418f69(0x183)+'\x20Order\x20Number\x20:\x20'+_0x5ea16d+'\x20'+_0x418f69(0x174)+_0x418f69(0x12d)+_0x23bd62+'\x20'+_0x418f69(0x15a)+'</h5>'+'</div>'+_0x418f69(0xda)+_0x418f69(0xec)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x418f69(0xcc)+_0x418f69(0x128)+_0x418f69(0x157)+_0x418f69(0xd3)+_0x418f69(0xba)+_0x418f69(0x1b6)+'\x20'+_0x42083a+'\x20'+_0x418f69(0x1bc)+_0x418f69(0x11e)+_0x418f69(0x133)+_0x418f69(0xe6)+'<h5>'+_0x84a7b7[0x0][_0x418f69(0x14b)]+'</h5>'+_0x418f69(0x11f)+'</div>'+_0x418f69(0x181)};_0x4d5e41[_0x418f69(0xbb)](_0x5f0144,function(_0x5256cd,_0x527554){var _0x37f369=_0x418f69;_0x5256cd?(console[_0x37f369(0x123)](_0x5256cd),console[_0x37f369(0x123)](_0x37f369(0xfb))):console['log'](_0x37f369(0xf4));}),_0x153e8c['flash']('success',_0x418f69(0xd5)),_0x4bcefa[_0x418f69(0x137)]('/all_sales/view');}catch(_0x4eb255){console['log'](_0x4eb255),_0x4bcefa[_0x418f69(0x15b)](0xc8)['json']({'message1':_0x4eb255['message']});}}),router['get'](a0_0x6b9e37(0x12c),auth,async(_0x24fe9b,_0xa93eac)=>{var _0x25ba23=a0_0x6b9e37;try{const {username:_0x28fa5b,email:_0x23d73d,role:_0x34dd99}=_0x24fe9b[_0x25ba23(0x10d)],_0x2e2eec=_0x24fe9b[_0x25ba23(0x10d)],_0x498c48=await profile[_0x25ba23(0x13a)]({'email':_0x2e2eec['email']}),_0x5b9858=await master_shop[_0x25ba23(0x106)]();console['log'](_0x25ba23(0xc3),_0x5b9858);const _0x5ae9c8=_0x24fe9b[_0x25ba23(0xc9)]['id'],_0x4b1fe2=await sales[_0x25ba23(0xbd)](_0x5ae9c8);console[_0x25ba23(0x123)](_0x25ba23(0xe3),_0x4b1fe2);if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0x195))var _0x13d946=users[_0x25ba23(0x1a7)];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0x107))var _0x13d946=users[_0x25ba23(0x107)];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0x1c3))var _0x13d946=users[_0x25ba23(0x1c3)];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0x14c))var _0x13d946=users['Spanish'];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0xf9))var _0x13d946=users['French'];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0x186))var _0x13d946=users[_0x25ba23(0xd6)];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0x19d))var _0x13d946=users[_0x25ba23(0x19d)];else{if(_0x5b9858[0x0][_0x25ba23(0x16a)]==_0x25ba23(0xe4))var _0x13d946=users[_0x25ba23(0x179)];}}}}}}}_0xa93eac['render']('all_sales_barcode',{'success':_0x24fe9b['flash'](_0x25ba23(0x132)),'errors':_0x24fe9b[_0x25ba23(0xde)](_0x25ba23(0x10e)),'role':_0x2e2eec,'profile':_0x498c48,'alldata':_0x4b1fe2,'master_shop':_0x5b9858,'language':_0x13d946});}catch(_0x3e224a){console['log'](_0x3e224a);}}),router['post']('/barcode_scanner',async(_0x5cb690,_0x232c5)=>{var _0x451dd9=a0_0x6b9e37;const {product_code:_0x531cc7,warehouse_name:_0x2ea087,rooms_data:_0x545001,Roomslist:_0x3218b4}=_0x5cb690[_0x451dd9(0x1ba)],_0x5d7886=_0x3218b4['split'](','),_0x815583=[];async function _0x3b129d(_0x1511b0){var _0x2037d0=_0x451dd9;const _0x2aecf1=await warehouse['aggregate']([{'$match':{'name':_0x2ea087,'room':_0x1511b0}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x531cc7}},{'$group':{'_id':_0x2037d0(0x108),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2037d0(0xd1)},'primary_code':{'$first':_0x2037d0(0x11a)},'secondary_code':{'$first':_0x2037d0(0xfe)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2037d0(0x1b3)},'isle':{'$first':_0x2037d0(0x151)},'type':{'$first':_0x2037d0(0x10b)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2037d0(0x112)},'secondary_unit':{'$first':_0x2037d0(0x171)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2037d0(0x19e)},'expiry_date':{'$first':_0x2037d0(0x18a)},'production_date':{'$first':_0x2037d0(0xbf)},'maxPerUnit':{'$first':_0x2037d0(0x1af)},'batch_code':{'$first':_0x2037d0(0xb7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2037d0(0x15e)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x2037d0(0x1aa)},'actual_uom':{'$first':_0x2037d0(0x184)}}}]),_0x14409e=await warehouse[_0x2037d0(0xf3)]([{'$match':{'name':_0x2ea087,'room':_0x1511b0}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x531cc7}},{'$group':{'_id':_0x2037d0(0x108),'name':{'$first':_0x2037d0(0x101)},'product_stock':{'$first':_0x2037d0(0xd1)},'primary_code':{'$first':_0x2037d0(0x11a)},'secondary_code':{'$first':_0x2037d0(0xfe)},'product_code':{'$first':_0x2037d0(0x193)},'level':{'$first':_0x2037d0(0x1b3)},'isle':{'$first':_0x2037d0(0x151)},'type':{'$first':_0x2037d0(0x10b)},'pallet':{'$first':_0x2037d0(0xfc)},'unit':{'$first':_0x2037d0(0x112)},'secondary_unit':{'$first':_0x2037d0(0x171)},'storage':{'$first':_0x2037d0(0xdc)},'rack':{'$first':_0x2037d0(0x19e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x2037d0(0x1af)},'batch_code':{'$first':_0x2037d0(0xb7)},'product_cat':{'$first':_0x2037d0(0x149)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2037d0(0x15e)},'invoice':{'$first':_0x2037d0(0x130)}}}]);if(_0x2aecf1[_0x2037d0(0x1a0)]>0x0)_0x815583['push'](_0x2aecf1);else _0x14409e[_0x2037d0(0x1a0)]>0x0&&_0x815583[_0x2037d0(0x152)](_0x14409e);}const _0x174838=_0x5d7886[_0x451dd9(0x191)](_0x994f64=>_0x3b129d(_0x994f64));await Promise[_0x451dd9(0x166)](_0x174838),_0x232c5[_0x451dd9(0x1ab)](_0x815583);}),module[a0_0x6b9e37(0xf8)]=router;