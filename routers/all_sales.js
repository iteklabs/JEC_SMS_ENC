var a0_0x1d99b8=a0_0x1063;function a0_0x60be(){var _0x32d054=['1059864sHeLaZ','error','Shelves','_id','Arabic\x20(ae)','max','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/view/add_sales','id_transact','<html><head><title></title>','$sale_product.bay','split','warehouse_name','max_per_unit','redirect','bay','prod_code','False','storage','$product_details.level','filter','save','\x20Order\x20Number\x20:\x20','Floor','$warehouse_name','back','stock_data','Email\x20sent\x20successfully','due_amount','id_transaction_from','</div>','Arabic','isAllowEdit','/upload/','received_amount','</td>','</head><body>','1620877Rqjwvi','find','$sale_product','bin','log','currency','warehouse','site_title','OUT-','customer_data','findOne','json','sendMail','$product_details.pallet','padStart','<span\x20style=\x22float:\x20right;\x22>','Level','$product_details.isle','Sales\x20Update\x20successfully','$product_details.storage','then','$product_details.product_cat','Sale\x20Return','image','$product_details.unit','\x20</h2>','actual_uom','An\x20error\x20occurred.','sale_qty','RoomAssigned','return_data','gmail','Portuguese','secondary_code','final','2417310dMvvAu','$customers_docs','$isAllowEdit','Raw\x20Materials','finalize','product_name','body','Return\x20Goods','barcode\x20Product\x20master','flash','product_stock','date','return_sale','sales\x20item\x20return\x20successfull','<tbody\x20style=\x22text-align:\x20center;\x22>','return_qty','requested_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','room_name','/view','$product_details.secondary_unit','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<hr\x20class=\x22my-3\x22>','push','$product_details.product_name','6434172QeNJvJ','logo','all_sales','$sale_product.floorlevel','Chinese','Portuguese\x20(BR)','1741004JTYcXU','floorlevel','$product_details.floorlevel','$product_details.type','Return\x20Rooms','Spanish','production_date','<h2>\x20','rack','language','staff','exports','2UhHmiC','<div>','</tbody>','note','Hindi','level','forEach','customers','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Sales\x20Mail','aggregate','delivery_code','/view/return_sales/:id','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','random','<strong>\x20Regards\x20</strong>','French','</tr>','sale_product','$return_data','role','/view/add_sale/product','$room','Error\x20Occurs','string','$product_details.secondary_code','customers_docs','$name','</thead>','$product_details.maxPerUnit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/all_sales/view','expiry_date','product_code','$product_details.expiry_date','getFullYear','/barcode_scanner','password','product_list','sales_invoice','Enabled','host','stocks','German','edit_sales_view','render','delivery_date','catch','email','product_details','quantity','$product_details.product_code','$product_details.production_date','length','prod_invoice','params','$product_details.product_stock','$product_details.invoice','/invoice/:id','5sFhUDP','$product_details.bay','invoice','all','payment\x20successfull','/give_payment/:id','$_id','</h5>','../middleware/auth','$product_details','carton','concat','actual_qty','quantity_notConverted','$product_details.rack','$note','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','purchases_data','English','status','$date','<tr>','prod_cat','success','name','10712023xHDEsB','Ambient','express','$product_details.primary_code','get','findById','$finalize','secondary_unit','SCRN','Receiving\x20Area','<!DOCTYPE\x20html>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.batch_code','slice','../models/all_models','$customer','<h5>','primary_unit','post','<h5\x20style=\x22text-align:\x20left;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','20400651QMcasX','/view/:id','$product','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Enclosed','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','type','$sale_product.bin','all_sales_barcode','getDate','user','product_data','batch_code','../public/language/languages.json','master','$product.product_name','Logo.png','</table>','customer','stock','</body></html>','nodemailer','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','primary_code','$product_details._id','/../public','createTransport','\x20Order\x20Date\x20:\x20','/preview/:id','unit','foreach\x20newproduct','$invoice','$product_details.bin','/view/add_sales/:id'];a0_0x60be=function(){return _0x32d054;};return a0_0x60be();}(function(_0x1911ba,_0x1d103c){var _0xc443e2=a0_0x1063,_0x55d491=_0x1911ba();while(!![]){try{var _0x1083b3=-parseInt(_0xc443e2(0x267))/0x1*(-parseInt(_0xc443e2(0x2b6))/0x2)+-parseInt(_0xc443e2(0x28a))/0x3+-parseInt(_0xc443e2(0x2aa))/0x4+parseInt(_0xc443e2(0x1ef))/0x5*(parseInt(_0xc443e2(0x2a4))/0x6)+parseInt(_0xc443e2(0x209))/0x7+parseInt(_0xc443e2(0x241))/0x8+-parseInt(_0xc443e2(0x21e))/0x9;if(_0x1083b3===_0x1d103c)break;else _0x55d491['push'](_0x55d491['shift']());}catch(_0x2fc995){_0x55d491['push'](_0x55d491['shift']());}}}(a0_0x60be,0xcf17b));const express=require(a0_0x1d99b8(0x20b)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1d99b8(0x217)),auth=require(a0_0x1d99b8(0x1f7)),nodemailer=require(a0_0x1d99b8(0x234)),users=require(a0_0x1d99b8(0x22c));router['get'](a0_0x1d99b8(0x29d),auth,async(_0x530a27,_0x4f30f9)=>{var _0x5d3fd9=a0_0x1d99b8;try{const {username:_0x221821,email:_0x2b69f6,role:_0x39f929}=_0x530a27[_0x5d3fd9(0x229)],_0x2dc688=_0x530a27['user'],_0x2767cf=await profile['findOne']({'email':_0x2dc688[_0x5d3fd9(0x1e4)]}),_0x1a0cfc=await master_shop['find']();let _0x427e0b;if(_0x2dc688['role']=='staff'){const _0x9b2605=await staff[_0x5d3fd9(0x271)]({'email':_0x2dc688[_0x5d3fd9(0x1e4)]});_0x427e0b=await sales[_0x5d3fd9(0x2c3)]([{'$lookup':{'from':_0x5d3fd9(0x2bd),'localField':_0x5d3fd9(0x231),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x5d3fd9(0x28b)},{'$unwind':_0x5d3fd9(0x269)},{'$group':{'_id':_0x5d3fd9(0x1f5),'invoice':{'$first':_0x5d3fd9(0x23e)},'customers':{'$first':_0x5d3fd9(0x218)},'date':{'$first':_0x5d3fd9(0x204)},'warehouse_name':{'$first':_0x5d3fd9(0x25a)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5d3fd9(0x1fe)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5d3fd9(0x24c)},'isle':{'$addToSet':_0x5d3fd9(0x226)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x5d3fd9(0x2a7)},'finalize':{'$first':_0x5d3fd9(0x20f)},'isAllowEdit':{'$first':_0x5d3fd9(0x28c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x427e0b=await sales[_0x5d3fd9(0x2c3)]([{'$lookup':{'from':_0x5d3fd9(0x2bd),'localField':'customer','foreignField':_0x5d3fd9(0x208),'as':_0x5d3fd9(0x1ce)}},{'$unwind':_0x5d3fd9(0x28b)},{'$unwind':_0x5d3fd9(0x269)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5d3fd9(0x23e)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x5d3fd9(0x269)},'note':{'$first':_0x5d3fd9(0x1fe)},'return_data':{'$first':_0x5d3fd9(0x1c7)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5d3fd9(0x24c)},'isle':{'$addToSet':_0x5d3fd9(0x226)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x5d3fd9(0x2a7)},'finalize':{'$first':_0x5d3fd9(0x20f)},'isAllowEdit':{'$first':_0x5d3fd9(0x28c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log']('sales\x20all_data',_0x427e0b);if(_0x1a0cfc[0x0][_0x5d3fd9(0x2b3)]==_0x5d3fd9(0x247)){var _0x5f8aa4=users['English'];console[_0x5d3fd9(0x26b)](_0x5f8aa4);}else{if(_0x1a0cfc[0x0][_0x5d3fd9(0x2b3)]==_0x5d3fd9(0x2ba))var _0x5f8aa4=users['Hindi'];else{if(_0x1a0cfc[0x0][_0x5d3fd9(0x2b3)]==_0x5d3fd9(0x1df))var _0x5f8aa4=users['German'];else{if(_0x1a0cfc[0x0][_0x5d3fd9(0x2b3)]==_0x5d3fd9(0x2af))var _0x5f8aa4=users[_0x5d3fd9(0x2af)];else{if(_0x1a0cfc[0x0][_0x5d3fd9(0x2b3)]==_0x5d3fd9(0x1c4))var _0x5f8aa4=users[_0x5d3fd9(0x1c4)];else{if(_0x1a0cfc[0x0]['language']=='Portuguese\x20(BR)')var _0x5f8aa4=users[_0x5d3fd9(0x287)];else{if(_0x1a0cfc[0x0]['language']==_0x5d3fd9(0x2a8))var _0x5f8aa4=users[_0x5d3fd9(0x2a8)];else{if(_0x1a0cfc[0x0][_0x5d3fd9(0x2b3)]==_0x5d3fd9(0x245))var _0x5f8aa4=users['Arabic'];}}}}}}}_0x4f30f9[_0x5d3fd9(0x1e1)](_0x5d3fd9(0x2a6),{'success':_0x530a27[_0x5d3fd9(0x293)](_0x5d3fd9(0x207)),'errors':_0x530a27[_0x5d3fd9(0x293)](_0x5d3fd9(0x29f)),'sales':_0x427e0b,'profile':_0x2767cf,'role':_0x2dc688,'master_shop':_0x1a0cfc,'language':_0x5f8aa4});}catch(_0x137779){console[_0x5d3fd9(0x26b)](_0x137779);}});async function getRandom8DigitNumber(){var _0x15d4a3=a0_0x1d99b8;const _0x33c217=0x989680,_0x5d0ac3=0x5f5e0ff,_0x5750f7=Math[_0x15d4a3(0x2c6)](Math[_0x15d4a3(0x2c8)]()*(_0x5d0ac3-_0x33c217+0x1))+_0x33c217;var _0x284713;const _0x27e13f=await sales[_0x15d4a3(0x271)]({'invoice':_0x15d4a3(0x26f)+_0x5750f7});return _0x27e13f&&_0x27e13f[_0x15d4a3(0x1e9)]>0x0?_0x284713='OUT-'+_0x5750f7:_0x284713=_0x15d4a3(0x26f)+_0x5750f7,_0x284713;}function a0_0x1063(_0x10b4f7,_0x305f11){var _0x60be34=a0_0x60be();return a0_0x1063=function(_0x106399,_0x2731f9){_0x106399=_0x106399-0x1c4;var _0x3fece4=_0x60be34[_0x106399];return _0x3fece4;},a0_0x1063(_0x10b4f7,_0x305f11);}router['get'](a0_0x1d99b8(0x249),auth,async(_0x1c700c,_0x33bbf6)=>{var _0x17159d=a0_0x1d99b8;try{const {username:_0x14e534,email:_0x3a5a38,role:_0x1ff7be}=_0x1c700c[_0x17159d(0x229)],_0x1d5c83=_0x1c700c[_0x17159d(0x229)],_0x3121cf=await profile[_0x17159d(0x271)]({'email':_0x1d5c83[_0x17159d(0x1e4)]}),_0x37d4bf=await master_shop[_0x17159d(0x268)](),_0x137454=await customer[_0x17159d(0x268)]({});let _0x1959fb;if(_0x1d5c83[_0x17159d(0x1c8)]==_0x17159d(0x2b4)){const _0x334149=await staff[_0x17159d(0x271)]({'email':_0x1d5c83['email']});_0x1959fb=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x334149['warehouse'],'warehouse_category':_0x17159d(0x28d),'name':{'$ne':_0x17159d(0x291)}}},{'$group':{'_id':_0x17159d(0x1cf),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x1959fb=await warehouse[_0x17159d(0x2c3)]([{'$match':{'status':_0x17159d(0x1dc),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x17159d(0x291)}}},{'$group':{'_id':_0x17159d(0x1cf),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x2db08c=await product[_0x17159d(0x268)]({});var _0x1cb637=['Ambient',_0x17159d(0x222)];const _0x56cc22=await sales[_0x17159d(0x268)]({}),_0x3ee6b8=_0x56cc22[_0x17159d(0x1e9)]+0x1,_0x21248c=_0x17159d(0x26f)+_0x3ee6b8['toString']()[_0x17159d(0x275)](0x5,'0');if(_0x37d4bf[0x0][_0x17159d(0x2b3)]==_0x17159d(0x247)){var _0x7fa045=users['English'];console['log'](_0x7fa045);}else{if(_0x37d4bf[0x0][_0x17159d(0x2b3)]=='Hindi')var _0x7fa045=users[_0x17159d(0x2ba)];else{if(_0x37d4bf[0x0][_0x17159d(0x2b3)]=='German')var _0x7fa045=users[_0x17159d(0x1df)];else{if(_0x37d4bf[0x0][_0x17159d(0x2b3)]==_0x17159d(0x2af))var _0x7fa045=users[_0x17159d(0x2af)];else{if(_0x37d4bf[0x0][_0x17159d(0x2b3)]==_0x17159d(0x1c4))var _0x7fa045=users[_0x17159d(0x1c4)];else{if(_0x37d4bf[0x0]['language']==_0x17159d(0x2a9))var _0x7fa045=users['Portuguese'];else{if(_0x37d4bf[0x0]['language']=='Chinese')var _0x7fa045=users[_0x17159d(0x2a8)];else{if(_0x37d4bf[0x0][_0x17159d(0x2b3)]==_0x17159d(0x245))var _0x7fa045=users[_0x17159d(0x261)];}}}}}}}const _0xacc98f=getRandom8DigitNumber();_0xacc98f['then'](_0x311231=>{var _0x3be225=_0x17159d;_0x33bbf6['render']('add_sales',{'success':_0x1c700c[_0x3be225(0x293)](_0x3be225(0x207)),'errors':_0x1c700c[_0x3be225(0x293)](_0x3be225(0x29f)),'role':_0x1d5c83,'profile':_0x3121cf,'customer':_0x137454,'warehouse':_0x1959fb,'product':_0x2db08c,'invoice':_0x311231,'master_shop':_0x37d4bf,'language':_0x7fa045,'rooms_data':_0x1cb637});})[_0x17159d(0x1e3)](_0x3bbbcb=>{var _0x238ec8=_0x17159d;_0x1c700c[_0x238ec8(0x293)]('errors',_0x238ec8(0x221)),_0x33bbf6['redirect'](_0x238ec8(0x1d3));});}catch(_0x29cebc){console[_0x17159d(0x26b)](_0x29cebc);}}),router[a0_0x1d99b8(0x20d)](a0_0x1d99b8(0x240),auth,async(_0x324a0d,_0x154160)=>{var _0x39a6d3=a0_0x1d99b8;try{const _0x43922d=_0x324a0d[_0x39a6d3(0x1eb)]['id'];console[_0x39a6d3(0x26b)](_0x43922d);const _0x64cba5=await product['find'](),_0x57502b=await purchases[_0x39a6d3(0x2c3)]([{'$match':{'warehouse_name':_0x43922d}},{'$unwind':_0x39a6d3(0x220)},{'$group':{'_id':_0x39a6d3(0x22e)}}]);console[_0x39a6d3(0x26b)](_0x39a6d3(0x201),_0x57502b),_0x154160[_0x39a6d3(0x203)](0xc8)[_0x39a6d3(0x272)]({'purchases_data':_0x57502b,'product_data':_0x64cba5});}catch(_0x30d878){console[_0x39a6d3(0x26b)](_0x30d878);}}),router[a0_0x1d99b8(0x21b)](a0_0x1d99b8(0x1c9),auth,async(_0x4875c3,_0xe9c2cf)=>{var _0x44eea1=a0_0x1d99b8;try{const {warehouse_data:_0x44511b,product_data:_0x3a0680}=_0x4875c3[_0x44eea1(0x290)];console[_0x44eea1(0x26b)](_0x4875c3['body'][_0x44eea1(0x22a)]);;const _0x4f8f2a=await master_shop[_0x44eea1(0x268)]();console[_0x44eea1(0x26b)](_0x44eea1(0x22d),_0x4f8f2a);const _0x2b661a=await product['findOne']({'name':_0x3a0680});console['log']('product',_0x2b661a);const _0x573237=await warehouse[_0x44eea1(0x2c3)]([{'$match':{'name':_0x44511b}},{'$unwind':_0x44eea1(0x1f8)},{'$match':{'product_details.product_name':_0x3a0680}},{'$group':{'_id':_0x44eea1(0x2a3),'product_stock':{'$first':_0x44eea1(0x1ec)}}}]);console[_0x44eea1(0x26b)](_0x44eea1(0x25c),_0x573237),_0xe9c2cf[_0x44eea1(0x203)](0xc8)[_0x44eea1(0x272)]({'master':_0x4f8f2a,'new_product':_0x2b661a,'stock_data':_0x573237});}catch(_0x41c00d){console[_0x44eea1(0x26b)](_0x41c00d);}}),router[a0_0x1d99b8(0x21b)]('/view/add_sales',auth,async(_0x3c3950,_0x4a53ea)=>{var _0x5254ee=a0_0x1d99b8;try{const {invoice:_0x3b1580,date:_0x34cd36,warehouse_name:_0x4ab52c,product_name:_0x42b479,stock:_0xd50d92,quantity:_0x37410d,note:_0x59408c,room:_0x2e5836,primary_code:_0x6c164d,secondary_code:_0xa4c2e9,prod_code:_0x35e15c,level:_0x30276b,isle:_0x2ed40b,pallet:_0x59ff44,batch_code:_0x44d2cc,SCRN:_0x1fa448,expiry_date:_0x2ad993}=_0x3c3950[_0x5254ee(0x290)];if(typeof _0x42b479=='string')var _0x5a5b13=[_0x3c3950[_0x5254ee(0x290)]['product_name']],_0x24c012=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x232)]],_0x331095=[_0x3c3950['body'][_0x5254ee(0x1f9)]],_0x5c61e4=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x236)]],_0x2832b0=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x288)]],_0x216da8=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x252)]],_0x118cc4=[_0x3c3950[_0x5254ee(0x290)]['level']],_0x577ea8=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x21a)]],_0x44489f=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x210)]],_0x3e5aad=[_0x3c3950['body'][_0x5254ee(0x22b)]],_0x180612=[_0x3c3950['body'][_0x5254ee(0x1d4)]],_0x54e528=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x24f)]],_0x233004=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x2b0)]],_0x5b10f0=[_0x3c3950[_0x5254ee(0x290)]['requested_qty']],_0x19bc89=[_0x3c3950['body'][_0x5254ee(0x1e2)]],_0x29e5cf=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x2c4)]],_0x2f5177=[_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x206)]],_0x4d9237=[_0x3c3950[_0x5254ee(0x290)]['quantity']],_0x4b4f0d=[_0x3c3950[_0x5254ee(0x290)]['RoomAssigned']],_0x31eead=[_0x3c3950['body'][_0x5254ee(0x1ea)]],_0x4109ef=[_0x3c3950['body'][_0x5254ee(0x1fb)]],_0x28f20d=[_0x3c3950[_0x5254ee(0x290)]['actual_uom']],_0x586320=[_0x3c3950[_0x5254ee(0x290)]['id_transact']];else var _0x5a5b13=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x28f)]],_0x24c012=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x232)]],_0x331095=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x1f9)]],_0x5c61e4=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x236)]],_0x2832b0=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x288)]],_0x216da8=[..._0x3c3950['body']['prod_code']],_0x118cc4=[..._0x3c3950['body'][_0x5254ee(0x2bb)]],_0x577ea8=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x21a)]],_0x44489f=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x210)]],_0x3e5aad=[..._0x3c3950['body'][_0x5254ee(0x22b)]],_0x180612=[..._0x3c3950[_0x5254ee(0x290)]['expiry_date']],_0x54e528=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x24f)]],_0x233004=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x2b0)]],_0x5b10f0=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x29a)]],_0x19bc89=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x1e2)]],_0x29e5cf=[..._0x3c3950['body'][_0x5254ee(0x2c4)]],_0x2f5177=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x206)]],_0x4d9237=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x1e6)]],_0x4b4f0d=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x284)]],_0x31eead=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x1ea)]],_0x4109ef=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x1fb)]],_0x28f20d=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x281)]],_0x586320=[..._0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x24a)]];const _0x5c7e89=_0x5a5b13[_0x5254ee(0x2bf)](_0x99d0d=>{return _0x99d0d={'product_name':_0x99d0d};});_0x24c012['forEach']((_0x5e3d04,_0x6a5ea7)=>{var _0xfb6449=_0x5254ee;_0x5c7e89[_0x6a5ea7][_0xfb6449(0x232)]=Math['abs'](_0x5e3d04);}),_0x4109ef[_0x5254ee(0x2bc)]((_0x4f5cc2,_0x3b1f9d)=>{var _0x82d44f=_0x5254ee;_0x5c7e89[_0x3b1f9d][_0x82d44f(0x1fb)]=Math[_0x82d44f(0x1ff)](_0x4f5cc2);}),_0x28f20d[_0x5254ee(0x2bc)]((_0x3d954c,_0x335bf1)=>{_0x5c7e89[_0x335bf1]['actual_uom']=_0x3d954c;}),_0x586320['forEach']((_0x194e88,_0x3cf44f)=>{var _0x57e873=_0x5254ee;_0x5c7e89[_0x3cf44f][_0x57e873(0x25f)]=_0x194e88;}),_0x331095['forEach']((_0x34301a,_0x3652bc)=>{var _0x2f5f00=_0x5254ee;_0x5c7e89[_0x3652bc][_0x2f5f00(0x1e6)]=_0x34301a;}),_0x5c61e4[_0x5254ee(0x2bc)]((_0x5e38ad,_0x17d834)=>{var _0x55d8c5=_0x5254ee;_0x5c7e89[_0x17d834][_0x55d8c5(0x236)]=_0x5e38ad;}),_0x2832b0[_0x5254ee(0x2bc)]((_0x5d3d65,_0x29eea5)=>{var _0x5d616c=_0x5254ee;_0x5c7e89[_0x29eea5][_0x5d616c(0x288)]=_0x5d3d65;}),_0x216da8[_0x5254ee(0x2bc)]((_0x28a04f,_0x1e579c)=>{var _0x555ae5=_0x5254ee;_0x5c7e89[_0x1e579c][_0x555ae5(0x1d5)]=_0x28a04f;}),_0x118cc4[_0x5254ee(0x2bc)]((_0x2d0417,_0xfaada4)=>{_0x4b4f0d['forEach']((_0x18d7a7,_0x199e90)=>{var _0x1a6bae=a0_0x1063;if(_0x18d7a7==_0x1a6bae(0x212)&&_0xfaada4==_0x199e90){var _0x5525d8=_0x2d0417[_0x1a6bae(0x216)](0x3);_0x5c7e89[_0xfaada4][_0x1a6bae(0x254)]=_0x2d0417[0x0],_0x5c7e89[_0xfaada4]['rack']=_0x2d0417[0x1],_0x5c7e89[_0xfaada4][_0x1a6bae(0x251)]=0x0,_0x5c7e89[_0xfaada4]['bin']=0x0,_0x5c7e89[_0xfaada4]['type']=_0x1a6bae(0x259),_0x5c7e89[_0xfaada4]['floorlevel']=_0x5525d8;}else{if(_0x18d7a7==_0x1a6bae(0x243)&&_0xfaada4==_0x199e90){var _0x5525d8=_0x2d0417[_0x1a6bae(0x216)](0x3);_0x5c7e89[_0xfaada4]['storage']=_0x2d0417[0x0],_0x5c7e89[_0xfaada4]['rack']=_0x2d0417[0x1],_0x5c7e89[_0xfaada4][_0x1a6bae(0x251)]=0x0,_0x5c7e89[_0xfaada4]['bin']=0x0,_0x5c7e89[_0xfaada4][_0x1a6bae(0x225)]=_0x1a6bae(0x259),_0x5c7e89[_0xfaada4][_0x1a6bae(0x2ab)]=_0x2d0417[0x5];}else{if(_0xfaada4==_0x199e90){var _0x3aa61f;if(_0x2d0417[0x4]=='L')_0x3aa61f=_0x1a6bae(0x277);else _0x2d0417[0x4]=='F'&&(_0x3aa61f=_0x1a6bae(0x259));_0x5c7e89[_0xfaada4][_0x1a6bae(0x254)]=_0x2d0417[0x0],_0x5c7e89[_0xfaada4][_0x1a6bae(0x2b2)]=_0x2d0417[0x1],_0x5c7e89[_0xfaada4][_0x1a6bae(0x251)]=_0x2d0417[0x2],_0x5c7e89[_0xfaada4]['bin']=_0x2d0417[0x3],_0x5c7e89[_0xfaada4][_0x1a6bae(0x225)]=_0x3aa61f,_0x5c7e89[_0xfaada4][_0x1a6bae(0x2ab)]=_0x2d0417[0x5];}}}});}),_0x577ea8[_0x5254ee(0x2bc)]((_0x529591,_0x4e9918)=>{var _0x561d21=_0x5254ee;_0x5c7e89[_0x4e9918][_0x561d21(0x23c)]=_0x529591;}),_0x44489f[_0x5254ee(0x2bc)]((_0x323852,_0x29382a)=>{_0x5c7e89[_0x29382a]['secondary_unit']=_0x323852;}),_0x3e5aad[_0x5254ee(0x2bc)]((_0x57043a,_0x4166ce)=>{var _0x2daa42=_0x5254ee;_0x5c7e89[_0x4166ce][_0x2daa42(0x22b)]=_0x57043a;}),_0x180612[_0x5254ee(0x2bc)]((_0x5982e1,_0x1a22ef)=>{var _0x3ce9fa=_0x5254ee;_0x5c7e89[_0x1a22ef][_0x3ce9fa(0x1d4)]=_0x5982e1;}),_0x54e528['forEach']((_0x3e7821,_0x41187b)=>{_0x5c7e89[_0x41187b]['maxperunit']=_0x3e7821;}),_0x233004['forEach']((_0x306f9e,_0x1270b6)=>{var _0x206f59=_0x5254ee;_0x5c7e89[_0x1270b6][_0x206f59(0x2b0)]=_0x306f9e;}),_0x5b10f0['forEach']((_0x4ca29d,_0x4a393d)=>{var _0x5df356=_0x5254ee;_0x5c7e89[_0x4a393d][_0x5df356(0x29a)]=_0x4ca29d;}),_0x19bc89[_0x5254ee(0x2bc)]((_0x5123f4,_0x22b9b1)=>{_0x5c7e89[_0x22b9b1]['delivery_date']=_0x5123f4;}),_0x29e5cf[_0x5254ee(0x2bc)]((_0x32338d,_0x3f185f)=>{var _0x4d1320=_0x5254ee;_0x5c7e89[_0x3f185f][_0x4d1320(0x2c4)]=_0x32338d;}),_0x2f5177[_0x5254ee(0x2bc)]((_0x4f92c1,_0x51845e)=>{var _0x2e08ed=_0x5254ee;_0x5c7e89[_0x51845e][_0x2e08ed(0x206)]=_0x4f92c1;}),_0x4d9237[_0x5254ee(0x2bc)]((_0x397b54,_0xfaa592)=>{var _0x4c73e8=_0x5254ee;_0x5c7e89[_0xfaa592][_0x4c73e8(0x1fc)]=_0x397b54;}),_0x4b4f0d['forEach']((_0xf9bfee,_0xcd726d)=>{var _0x2a8aff=_0x5254ee;_0x5c7e89[_0xcd726d][_0x2a8aff(0x29c)]=_0xf9bfee;}),_0x31eead[_0x5254ee(0x2bc)]((_0x2bdb0c,_0x17a1cf)=>{_0x5c7e89[_0x17a1cf]['invoice']=_0x2bdb0c;});var _0x1dd98f=0x0;_0x5c7e89[_0x5254ee(0x2bc)](_0x6fd12d=>{var _0x4dcc5f=_0x5254ee;(_0x6fd12d['stock']<_0x6fd12d[_0x4dcc5f(0x1fc)]||_0x6fd12d['quantity_notConverted']==0x0)&&(console[_0x4dcc5f(0x26b)](_0x4dcc5f(0x23d),_0x6fd12d),_0x1dd98f++);});const _0x2d8bda=_0x5c7e89['filter'](_0x179c70=>_0x179c70['quantity']!=='0'&&_0x179c70['quantity']!==''),_0x5807c8=new sales({'invoice':_0x3b1580,'customer':_0x3c3950[_0x5254ee(0x290)][_0x5254ee(0x231)],'date':_0x34cd36,'warehouse_name':_0x4ab52c,'sale_product':_0x2d8bda,'note':_0x59408c,'room':_0x2e5836,'primary_code':_0x6c164d,'secondary_code':_0xa4c2e9,'prod_code':_0x35e15c,'SCRN':_0x1fa448}),_0x446873=await _0x5807c8[_0x5254ee(0x257)]();_0x3c3950['flash'](_0x5254ee(0x207),'Sales\x20Add\x20successfully'),_0x4a53ea[_0x5254ee(0x250)]('/all_sales/preview/'+_0x446873[_0x5254ee(0x244)]);}catch(_0x57a55d){console[_0x5254ee(0x26b)](_0x57a55d);}}),router[a0_0x1d99b8(0x20d)](a0_0x1d99b8(0x23b),auth,async(_0xc111b8,_0xb11624)=>{var _0x29a6d2=a0_0x1d99b8;try{const {username:_0x5debd1,email:_0xc0a22,role:_0x4149a0}=_0xc111b8['user'],_0x97aaac=_0xc111b8[_0x29a6d2(0x229)],_0x456cb3=await profile[_0x29a6d2(0x271)]({'email':_0x97aaac[_0x29a6d2(0x1e4)]}),_0x6d5611=await master_shop[_0x29a6d2(0x268)](),_0x3d6d23=_0xc111b8[_0x29a6d2(0x1eb)]['id'],_0x602ba9=await sales[_0x29a6d2(0x20e)](_0x3d6d23),_0x10bb39=await warehouse[_0x29a6d2(0x2c3)]([{'$match':{'name':_0x602ba9[_0x29a6d2(0x24e)]}},{'$unwind':_0x29a6d2(0x1f8)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x29a6d2(0x23f)},'type':{'$first':_0x29a6d2(0x2ad)},'floorlevel':{'$first':_0x29a6d2(0x2ac)},'primary_code':{'$first':_0x29a6d2(0x20c)},'secondary_code':{'$first':_0x29a6d2(0x1cd)},'product_code':{'$first':_0x29a6d2(0x1e7)},'storage':{'$first':_0x29a6d2(0x27a)},'rack':{'$first':_0x29a6d2(0x1fd)},'expiry_date':{'$first':_0x29a6d2(0x1d6)},'production_date':{'$first':_0x29a6d2(0x1e8)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2c1e9c=await customer[_0x29a6d2(0x268)]({});let _0x1ff824;if(_0x97aaac[_0x29a6d2(0x1c8)]==_0x29a6d2(0x2b4)){const _0x37e5ea=await staff[_0x29a6d2(0x271)]({'email':_0x97aaac[_0x29a6d2(0x1e4)]});_0x1ff824=await warehouse[_0x29a6d2(0x2c3)]([{'$match':{'status':_0x29a6d2(0x1dc),'name':_0x37e5ea[_0x29a6d2(0x26d)]}},{'$group':{'_id':_0x29a6d2(0x1cf),'name':{'$first':_0x29a6d2(0x1cf)}}}]);}else _0x1ff824=await warehouse[_0x29a6d2(0x2c3)]([{'$match':{'status':_0x29a6d2(0x1dc)}},{'$group':{'_id':_0x29a6d2(0x1cf),'name':{'$first':_0x29a6d2(0x1cf)}}}]);const _0x4478e0=await product[_0x29a6d2(0x268)]({}),_0x1c142b=await suppliers['find']({});if(_0x6d5611[0x0][_0x29a6d2(0x2b3)]==_0x29a6d2(0x247)){var _0x27145f=users[_0x29a6d2(0x202)];console['log'](_0x27145f);}else{if(_0x6d5611[0x0][_0x29a6d2(0x2b3)]=='Hindi')var _0x27145f=users[_0x29a6d2(0x2ba)];else{if(_0x6d5611[0x0][_0x29a6d2(0x2b3)]==_0x29a6d2(0x1df))var _0x27145f=users[_0x29a6d2(0x1df)];else{if(_0x6d5611[0x0]['language']==_0x29a6d2(0x2af))var _0x27145f=users['Spanish'];else{if(_0x6d5611[0x0][_0x29a6d2(0x2b3)]==_0x29a6d2(0x1c4))var _0x27145f=users[_0x29a6d2(0x1c4)];else{if(_0x6d5611[0x0]['language']==_0x29a6d2(0x2a9))var _0x27145f=users[_0x29a6d2(0x287)];else{if(_0x6d5611[0x0][_0x29a6d2(0x2b3)]==_0x29a6d2(0x2a8))var _0x27145f=users['Chinese'];else{if(_0x6d5611[0x0][_0x29a6d2(0x2b3)]==_0x29a6d2(0x245))var _0x27145f=users[_0x29a6d2(0x261)];}}}}}}}_0xb11624[_0x29a6d2(0x1e1)](_0x29a6d2(0x1e0),{'success':_0xc111b8['flash'](_0x29a6d2(0x207)),'errors':_0xc111b8['flash'](_0x29a6d2(0x29f)),'role':_0x97aaac,'profile':_0x456cb3,'customer':_0x2c1e9c,'warehouse':_0x1ff824,'product':_0x10bb39,'user':_0x602ba9,'master_shop':_0x6d5611,'unit':_0x4478e0,'language':_0x27145f,'suppliers':_0x1c142b});}catch(_0x3a3f9e){console[_0x29a6d2(0x26b)](_0x3a3f9e);}}),router[a0_0x1d99b8(0x21b)]('/preview/:id',auth,async(_0x49a222,_0x22b518)=>{var _0x3540dc=a0_0x1d99b8;try{const _0x1274c9=_0x49a222['params']['id'],{invoice:_0x5606a6,warehouse_name:_0x20f693,room:_0x5cf08c}=_0x49a222['body'],_0x1cdbb8=await sales[_0x3540dc(0x271)]({'invoice':_0x5606a6}),_0x3105a4=_0x1cdbb8[_0x3540dc(0x1c6)][_0x3540dc(0x2bf)](async _0x2cd719=>{var _0x34d2ba=_0x3540dc,_0x16aec0=await warehouse[_0x34d2ba(0x271)]({'name':_0x20f693,'room':_0x2cd719['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x4eeed6=_0x16aec0[_0x34d2ba(0x1e5)]['map'](_0x5d5fda=>{var _0x1fe459=_0x34d2ba;_0x5d5fda[_0x1fe459(0x28f)]==_0x2cd719['product_name']&&_0x5d5fda[_0x1fe459(0x2ab)]==_0x2cd719[_0x1fe459(0x2ab)]&&_0x5d5fda[_0x1fe459(0x225)]==_0x2cd719[_0x1fe459(0x225)]&&_0x5d5fda['bin']==_0x2cd719[_0x1fe459(0x26a)]&&_0x5d5fda['bay']==_0x2cd719[_0x1fe459(0x251)]&&_0x5d5fda[_0x1fe459(0x2b2)]==_0x2cd719['rack']&&_0x5d5fda[_0x1fe459(0x254)]==_0x2cd719[_0x1fe459(0x254)]&&_0x5d5fda['expiry_date']==_0x2cd719[_0x1fe459(0x1d4)]&&_0x5d5fda[_0x1fe459(0x22b)]==_0x2cd719['batch_code']&&_0x5d5fda[_0x1fe459(0x1f1)]==_0x2cd719[_0x1fe459(0x1f1)]&&_0x5d5fda[_0x1fe459(0x244)]==_0x2cd719[_0x1fe459(0x25f)]&&(_0x5d5fda[_0x1fe459(0x294)]=Math[_0x1fe459(0x246)](0x0,Math[_0x1fe459(0x1ff)](_0x5d5fda[_0x1fe459(0x294)])-Math[_0x1fe459(0x1ff)](_0x2cd719[_0x1fe459(0x1e6)])));});return _0x16aec0;});Promise[_0x3540dc(0x1f2)](_0x3105a4)[_0x3540dc(0x27b)](async _0x25c48e=>{var _0x2db988=_0x3540dc;try{for(const _0x557b48 of _0x25c48e){await _0x557b48[_0x2db988(0x257)]();}_0x1cdbb8[_0x2db988(0x28e)]='True';const _0x4015ad=await _0x1cdbb8['save'](),_0x573881=await master_shop[_0x2db988(0x268)](),_0x1f4bd1=await email_settings[_0x2db988(0x271)](),_0x43d9be=await supervisor_settings[_0x2db988(0x268)]();var _0xecb538=_0x1cdbb8['sale_product'],_0x4bf698='',_0x1a397f;for(_0x1a397f in _0xecb538){_0x4bf698+=_0x2db988(0x205)+_0x2db988(0x214)+_0xecb538[_0x1a397f][_0x2db988(0x28f)]+_0x2db988(0x265)+_0x2db988(0x214)+_0xecb538[_0x1a397f][_0x2db988(0x1d5)]+_0x2db988(0x265)+_0x2db988(0x214)+_0xecb538[_0x1a397f][_0x2db988(0x1e6)]+_0x2db988(0x265)+_0x2db988(0x214)+_0xecb538[_0x1a397f][_0x2db988(0x23c)]+_0x2db988(0x265)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xecb538[_0x1a397f][_0x2db988(0x210)]+_0x2db988(0x265)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1cdbb8[_0x2db988(0x24e)]+_0x2db988(0x265)+_0x2db988(0x214)+_0xecb538[_0x1a397f][_0x2db988(0x29c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xecb538[_0x1a397f][_0x2db988(0x254)]+_0xecb538[_0x1a397f][_0x2db988(0x2b2)]+_0xecb538[_0x1a397f]['bay']+_0xecb538[_0x1a397f][_0x2db988(0x26a)]+_0xecb538[_0x1a397f][_0x2db988(0x225)][0x0]+_0xecb538[_0x1a397f][_0x2db988(0x2ab)]+'</td>',_0x2db988(0x1c5);}let _0x5baafd=nodemailer[_0x2db988(0x239)]({'host':_0x1f4bd1[_0x2db988(0x1dd)],'port':Number(_0x1f4bd1['port']),'secure':![],'auth':{'user':_0x1f4bd1[_0x2db988(0x1e4)],'pass':_0x1f4bd1[_0x2db988(0x1d9)]}}),_0x5b8a0e={'from':_0x1f4bd1['email'],'to':_0x43d9be[0x0]['RMSEmail'],'subject':_0x2db988(0x2c2),'attachments':[{'filename':_0x2db988(0x22f),'path':__dirname+_0x2db988(0x238)+_0x2db988(0x263)+_0x573881[0x0][_0x2db988(0x27e)],'cid':_0x2db988(0x2a5)}],'html':'<!DOCTYPE\x20html>'+_0x2db988(0x24b)+_0x2db988(0x266)+_0x2db988(0x2b7)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2db988(0x2b7)+_0x2db988(0x2c1)+_0x2db988(0x260)+_0x2db988(0x2b7)+_0x2db988(0x2b1)+_0x573881[0x0][_0x2db988(0x26e)]+_0x2db988(0x280)+'</div>'+_0x2db988(0x260)+_0x2db988(0x2a1)+_0x2db988(0x2b7)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2db988(0x258)+_0x1cdbb8[_0x2db988(0x1f1)]+'\x20'+_0x2db988(0x276)+_0x2db988(0x23a)+_0x1cdbb8[_0x2db988(0x295)]+'\x20'+'</span>'+_0x2db988(0x1f6)+_0x2db988(0x260)+_0x2db988(0x1d2)+_0x2db988(0x21d)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x2db988(0x2c0)+_0x2db988(0x200)+_0x2db988(0x2c7)+_0x2db988(0x224)+_0x2db988(0x1c5)+_0x2db988(0x1d0)+_0x2db988(0x298)+'\x20'+_0x4bf698+'\x20'+_0x2db988(0x2b8)+_0x2db988(0x230)+_0x2db988(0x2b7)+_0x2db988(0x2c9)+'<h5>'+_0x573881[0x0][_0x2db988(0x26e)]+_0x2db988(0x1f6)+'</div>'+_0x2db988(0x260)+'</body></html>'};_0x5baafd[_0x2db988(0x273)](_0x5b8a0e,function(_0x5add6a,_0x264e7f){var _0x4734f4=_0x2db988;_0x5add6a?(console[_0x4734f4(0x26b)](_0x5add6a),console[_0x4734f4(0x26b)](_0x4734f4(0x1cb))):console[_0x4734f4(0x26b)](_0x4734f4(0x25d));}),_0x49a222['flash'](_0x2db988(0x207),_0x2db988(0x279)),_0x22b518[_0x2db988(0x250)]('/all_sales/preview/'+_0x1274c9);}catch(_0x4d4d7c){console[_0x2db988(0x242)](_0x4d4d7c),_0x22b518['status'](0x1f4)[_0x2db988(0x272)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3540dc(0x1e3)](_0x2a916c=>{var _0x2ff815=_0x3540dc;console[_0x2ff815(0x242)](_0x2a916c),_0x22b518[_0x2ff815(0x203)](0x1f4)['json']({'error':_0x2ff815(0x282)});});}catch(_0x39a926){console[_0x3540dc(0x26b)](_0x39a926);}}),router[a0_0x1d99b8(0x20d)](a0_0x1d99b8(0x21f),auth,async(_0xd3a9a9,_0x5a9d60)=>{var _0x5ea6f6=a0_0x1d99b8;try{const {username:_0x4ca4ad,email:_0x58be96,role:_0x431ce4}=_0xd3a9a9[_0x5ea6f6(0x229)],_0x124bb2=_0xd3a9a9[_0x5ea6f6(0x229)],_0x572e62=await profile[_0x5ea6f6(0x271)]({'email':_0x124bb2[_0x5ea6f6(0x1e4)]}),_0x5f4a97=await master_shop['find'](),_0x231e6d=_0xd3a9a9[_0x5ea6f6(0x1eb)]['id'],_0x4a18f2=await sales[_0x5ea6f6(0x20e)](_0x231e6d);var _0xc35d47=[_0x5ea6f6(0x20a),_0x5ea6f6(0x222)];const _0x1cf61d=await warehouse[_0x5ea6f6(0x2c3)]([{'$match':{'name':_0x4a18f2['warehouse_name'],'warehouse_category':_0x5ea6f6(0x28d)}},{'$unwind':_0x5ea6f6(0x1f8)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5ea6f6(0x2a3)},'product_stock':{'$first':_0x5ea6f6(0x1ec)},'bay':{'$first':_0x5ea6f6(0x1f0)},'bin':{'$first':_0x5ea6f6(0x23f)},'type':{'$first':_0x5ea6f6(0x2ad)},'floorlevel':{'$first':_0x5ea6f6(0x2ac)},'primary_code':{'$first':_0x5ea6f6(0x20c)},'secondary_code':{'$first':_0x5ea6f6(0x1cd)},'product_code':{'$first':_0x5ea6f6(0x1e7)},'storage':{'$first':_0x5ea6f6(0x27a)},'rack':{'$first':_0x5ea6f6(0x1fd)}}}]),_0x5983bf=await customer[_0x5ea6f6(0x268)]({});let _0x7243ff;if(_0x124bb2['role']==_0x5ea6f6(0x2b4)){const _0x12d339=await staff[_0x5ea6f6(0x271)]({'email':_0x124bb2[_0x5ea6f6(0x1e4)]});_0x7243ff=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x12d339['warehouse'],'warehouse_category':_0x5ea6f6(0x28d)}},{'$group':{'_id':_0x5ea6f6(0x1cf),'name':{'$first':_0x5ea6f6(0x1cf)}}}]);}else _0x7243ff=await warehouse[_0x5ea6f6(0x2c3)]([{'$match':{'status':_0x5ea6f6(0x1dc),'warehouse_category':_0x5ea6f6(0x28d)}},{'$group':{'_id':_0x5ea6f6(0x1cf),'name':{'$first':_0x5ea6f6(0x1cf)}}}]);const _0x3c3a88=await product['find']({});if(_0x5f4a97[0x0]['language']==_0x5ea6f6(0x247)){var _0xc7c424=users['English'];console[_0x5ea6f6(0x26b)](_0xc7c424);}else{if(_0x5f4a97[0x0]['language']==_0x5ea6f6(0x2ba))var _0xc7c424=users[_0x5ea6f6(0x2ba)];else{if(_0x5f4a97[0x0]['language']==_0x5ea6f6(0x1df))var _0xc7c424=users[_0x5ea6f6(0x1df)];else{if(_0x5f4a97[0x0][_0x5ea6f6(0x2b3)]=='Spanish')var _0xc7c424=users[_0x5ea6f6(0x2af)];else{if(_0x5f4a97[0x0][_0x5ea6f6(0x2b3)]=='French')var _0xc7c424=users[_0x5ea6f6(0x1c4)];else{if(_0x5f4a97[0x0][_0x5ea6f6(0x2b3)]==_0x5ea6f6(0x2a9))var _0xc7c424=users[_0x5ea6f6(0x287)];else{if(_0x5f4a97[0x0]['language']==_0x5ea6f6(0x2a8))var _0xc7c424=users['Chinese'];else{if(_0x5f4a97[0x0][_0x5ea6f6(0x2b3)]==_0x5ea6f6(0x245))var _0xc7c424=users[_0x5ea6f6(0x261)];}}}}}}}_0x5a9d60['render']('edit_sales',{'success':_0xd3a9a9['flash'](_0x5ea6f6(0x207)),'errors':_0xd3a9a9[_0x5ea6f6(0x293)](_0x5ea6f6(0x29f)),'role':_0x124bb2,'profile':_0x572e62,'customer':_0x5983bf,'warehouse':_0x7243ff,'product':_0x1cf61d,'user':_0x4a18f2,'master_shop':_0x5f4a97,'unit':_0x3c3a88,'language':_0xc7c424});}catch(_0x2244a3){console[_0x5ea6f6(0x26b)](_0x2244a3);}}),router[a0_0x1d99b8(0x21b)](a0_0x1d99b8(0x21f),auth,async(_0x42ca51,_0x23a0ab)=>{var _0x5107fd=a0_0x1d99b8;try{const _0x5b3615=_0x42ca51[_0x5107fd(0x1eb)]['id'],_0x55d60a=await sales['findOne']({'_id':_0x42ca51['params']['id']}),_0x3e9d29=await warehouse[_0x5107fd(0x271)]({'name':_0x55d60a[_0x5107fd(0x24e)],'room':_0x42ca51[_0x5107fd(0x290)]['room']}),{invoice:_0x28bd8d,date:_0x558ef9,warehouse_name:_0xf8a926,product_name:_0x4c3fcf,stock:_0x3ba2b0,quantity:_0x506075,note:_0x55505f,room:_0x406574,customer:_0x2e15cb,SCRN:_0x19c3f7}=_0x42ca51[_0x5107fd(0x290)];if(typeof _0x4c3fcf=='string')var _0x218529=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x28f)]],_0x4773c4=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x232)]],_0x52219f=[_0x42ca51[_0x5107fd(0x290)]['carton']],_0x48385e=[_0x42ca51[_0x5107fd(0x290)]['primary_code']],_0x2c1a33=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x288)]],_0x43c97a=[_0x42ca51['body'][_0x5107fd(0x252)]],_0x5a580d=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x2bb)]],_0x4c77d5=[_0x42ca51[_0x5107fd(0x290)]['primary_unit']],_0xe16482=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x210)]],_0x1523e2=[_0x42ca51[_0x5107fd(0x290)]['batch_code']],_0x48ff0a=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x1d4)]],_0x5e25e2=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x24f)]],_0x2d8d37=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x2b0)]],_0x28e1b4=[_0x42ca51[_0x5107fd(0x290)]['requested_qty']],_0x9177df=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x1e2)]],_0x32ce5=[_0x42ca51['body'][_0x5107fd(0x2c4)]],_0x58f454=[_0x42ca51['body']['prod_cat']],_0x14f7ef=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x1e6)]],_0x3b5064=[_0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x284)]];else var _0x218529=[..._0x42ca51['body'][_0x5107fd(0x28f)]],_0x4773c4=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x232)]],_0x52219f=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x1f9)]],_0x48385e=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x236)]],_0x2c1a33=[..._0x42ca51[_0x5107fd(0x290)]['secondary_code']],_0x43c97a=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x252)]],_0x5a580d=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x2bb)]],_0x4c77d5=[..._0x42ca51[_0x5107fd(0x290)]['primary_unit']],_0xe16482=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x210)]],_0x1523e2=[..._0x42ca51[_0x5107fd(0x290)]['batch_code']],_0x48ff0a=[..._0x42ca51[_0x5107fd(0x290)]['expiry_date']],_0x5e25e2=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x24f)]],_0x2d8d37=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x2b0)]],_0x28e1b4=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x29a)]],_0x9177df=[..._0x42ca51[_0x5107fd(0x290)]['delivery_date']],_0x32ce5=[..._0x42ca51[_0x5107fd(0x290)]['delivery_code']],_0x58f454=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x206)]],_0x14f7ef=[..._0x42ca51[_0x5107fd(0x290)]['quantity']],_0x3b5064=[..._0x42ca51[_0x5107fd(0x290)][_0x5107fd(0x284)]];const _0x36d7dd=_0x218529[_0x5107fd(0x2bf)](_0xcff64a=>{return _0xcff64a={'product_name':_0xcff64a};});_0x4773c4[_0x5107fd(0x2bc)]((_0x4a394f,_0x43f58d)=>{var _0x540962=_0x5107fd;_0x36d7dd[_0x43f58d]['stock']=Math[_0x540962(0x1ff)](_0x4a394f);}),_0x52219f[_0x5107fd(0x2bc)]((_0x7c8993,_0x3c3e67)=>{var _0x18bdb2=_0x5107fd;_0x36d7dd[_0x3c3e67][_0x18bdb2(0x1e6)]=_0x7c8993;}),_0x48385e[_0x5107fd(0x2bc)]((_0x27d46f,_0x21125c)=>{_0x36d7dd[_0x21125c]['primary_code']=_0x27d46f;}),_0x2c1a33[_0x5107fd(0x2bc)]((_0x30cf6a,_0x4586d9)=>{var _0x48ba35=_0x5107fd;_0x36d7dd[_0x4586d9][_0x48ba35(0x288)]=_0x30cf6a;}),_0x43c97a[_0x5107fd(0x2bc)]((_0x12a2f1,_0x21fd39)=>{var _0x168044=_0x5107fd;_0x36d7dd[_0x21fd39][_0x168044(0x1d5)]=_0x12a2f1;}),_0x5a580d['forEach']((_0x319384,_0x17e76d)=>{var _0x2c44cf=_0x5107fd;_0x3b5064[_0x2c44cf(0x2bc)]((_0x3c6b47,_0xdc3fc1)=>{var _0x47ec80=_0x2c44cf;if(_0x3c6b47==_0x47ec80(0x212)&&_0x17e76d==_0xdc3fc1){var _0x28ebeb=_0x319384[_0x47ec80(0x216)](0x3);_0x36d7dd[_0x17e76d][_0x47ec80(0x254)]=_0x319384[0x0],_0x36d7dd[_0x17e76d][_0x47ec80(0x2b2)]=_0x319384[0x1],_0x36d7dd[_0x17e76d][_0x47ec80(0x251)]=0x0,_0x36d7dd[_0x17e76d][_0x47ec80(0x26a)]=0x0,_0x36d7dd[_0x17e76d][_0x47ec80(0x225)]=_0x47ec80(0x259),_0x36d7dd[_0x17e76d][_0x47ec80(0x2ab)]=_0x28ebeb;}else{if(_0x3c6b47=='Shelves'&&_0x17e76d==_0xdc3fc1){var _0x28ebeb=_0x319384[_0x47ec80(0x216)](0x3);_0x36d7dd[_0x17e76d][_0x47ec80(0x254)]=_0x319384[0x0],_0x36d7dd[_0x17e76d][_0x47ec80(0x2b2)]=_0x319384[0x1],_0x36d7dd[_0x17e76d]['bay']=0x0,_0x36d7dd[_0x17e76d][_0x47ec80(0x26a)]=0x0,_0x36d7dd[_0x17e76d]['type']=_0x47ec80(0x259),_0x36d7dd[_0x17e76d][_0x47ec80(0x2ab)]=_0x319384[0x5];}else{if(_0x17e76d==_0xdc3fc1){var _0x30d9d6;if(_0x319384[0x4]=='L')_0x30d9d6=_0x47ec80(0x277);else _0x319384[0x4]=='F'&&(_0x30d9d6=_0x47ec80(0x259));_0x36d7dd[_0x17e76d]['storage']=_0x319384[0x0],_0x36d7dd[_0x17e76d]['rack']=_0x319384[0x1],_0x36d7dd[_0x17e76d]['bay']=_0x319384[0x2],_0x36d7dd[_0x17e76d][_0x47ec80(0x26a)]=_0x319384[0x3],_0x36d7dd[_0x17e76d][_0x47ec80(0x225)]=_0x30d9d6,_0x36d7dd[_0x17e76d]['floorlevel']=_0x319384[0x5];}}}});}),_0x4c77d5[_0x5107fd(0x2bc)]((_0x2190ad,_0x475ed5)=>{var _0x6c2a07=_0x5107fd;_0x36d7dd[_0x475ed5][_0x6c2a07(0x23c)]=_0x2190ad;}),_0xe16482['forEach']((_0x54ac70,_0x9105ba)=>{var _0x1a76ce=_0x5107fd;_0x36d7dd[_0x9105ba][_0x1a76ce(0x210)]=_0x54ac70;}),_0x1523e2[_0x5107fd(0x2bc)]((_0x28f284,_0x14947f)=>{var _0x4dda97=_0x5107fd;_0x36d7dd[_0x14947f][_0x4dda97(0x22b)]=_0x28f284;}),_0x48ff0a[_0x5107fd(0x2bc)]((_0x32326d,_0xd00165)=>{var _0x68b60a=_0x5107fd;_0x36d7dd[_0xd00165][_0x68b60a(0x1d4)]=_0x32326d;}),_0x5e25e2[_0x5107fd(0x2bc)]((_0x161a0e,_0xb9e87a)=>{_0x36d7dd[_0xb9e87a]['maxperunit']=_0x161a0e;}),_0x2d8d37['forEach']((_0x40a348,_0xd9256a)=>{var _0x23a504=_0x5107fd;_0x36d7dd[_0xd9256a][_0x23a504(0x2b0)]=_0x40a348;}),_0x28e1b4['forEach']((_0x55a1c5,_0x22bc62)=>{var _0x11596e=_0x5107fd;_0x36d7dd[_0x22bc62][_0x11596e(0x29a)]=Math['abs'](_0x55a1c5);}),_0x9177df[_0x5107fd(0x2bc)]((_0x5248c4,_0x386e26)=>{var _0x5ee284=_0x5107fd;_0x36d7dd[_0x386e26][_0x5ee284(0x1e2)]=_0x5248c4;}),_0x32ce5[_0x5107fd(0x2bc)]((_0x73970d,_0x40004f)=>{_0x36d7dd[_0x40004f]['delivery_code']=_0x73970d;}),_0x58f454[_0x5107fd(0x2bc)]((_0x1332fd,_0x5771e2)=>{var _0x293a8d=_0x5107fd;_0x36d7dd[_0x5771e2][_0x293a8d(0x206)]=_0x1332fd;}),_0x14f7ef[_0x5107fd(0x2bc)]((_0x238488,_0x41b78c)=>{var _0x203b31=_0x5107fd;_0x36d7dd[_0x41b78c][_0x203b31(0x1fc)]=_0x238488;}),_0x3b5064['forEach']((_0x37b1bd,_0x47849e)=>{var _0x2a893a=_0x5107fd;_0x36d7dd[_0x47849e][_0x2a893a(0x29c)]=_0x37b1bd;});var _0x131eef=0x0;_0x36d7dd['forEach'](_0x41ee5a=>{var _0x1b591d=_0x5107fd;console[_0x1b591d(0x26b)](_0x1b591d(0x23d),_0x41ee5a),(parseInt(_0x41ee5a[_0x1b591d(0x232)])<parseInt(_0x41ee5a['quantity'])||parseInt(_0x41ee5a['quantity'])==0x0)&&_0x131eef++;});if(_0x131eef!=0x0)return _0x42ca51[_0x5107fd(0x293)]('errors',_0x5107fd(0x235)),_0x23a0ab[_0x5107fd(0x250)]('back');const _0x316c4d=_0x36d7dd[_0x5107fd(0x256)](_0xa585d7=>_0xa585d7['quantity']!=='0'&&_0xa585d7[_0x5107fd(0x1e6)]!=='');_0x55d60a[_0x5107fd(0x1f1)]=_0x28bd8d,_0x55d60a[_0x5107fd(0x231)]=_0x2e15cb,_0x55d60a['date']=_0x558ef9,_0x55d60a[_0x5107fd(0x24e)]=_0xf8a926,_0x55d60a[_0x5107fd(0x1c6)]=_0x316c4d,_0x55d60a[_0x5107fd(0x2b9)]=_0x55505f,_0x55d60a[_0x5107fd(0x211)]=_0x19c3f7,_0x55d60a['finalize']=_0x5107fd(0x253),_0x55d60a[_0x5107fd(0x262)]=_0x5107fd(0x253);const _0x9cc679=await _0x55d60a[_0x5107fd(0x257)]();_0x42ca51[_0x5107fd(0x293)]('success',_0x5107fd(0x279)),_0x23a0ab[_0x5107fd(0x250)](_0x5107fd(0x1d3));}catch(_0x3e520d){console[_0x5107fd(0x26b)](_0x3e520d);}}),router[a0_0x1d99b8(0x21b)](a0_0x1d99b8(0x1f4),auth,async(_0x6fb7e5,_0x5647a1)=>{var _0x15c458=a0_0x1d99b8;try{const _0x464e65=_0x6fb7e5[_0x15c458(0x1eb)]['id'],{invoice:_0x40d7a8,customer:_0x56c51e,receivable_amount:_0x117772,received_amount:_0x626a4f}=_0x6fb7e5['body'],_0x7670b8=await sales[_0x15c458(0x20e)](_0x464e65);console[_0x15c458(0x26b)](_0x7670b8);var _0x10b5b9=_0x117772-_0x626a4f;console[_0x15c458(0x26b)](_0x626a4f),_0x7670b8[_0x15c458(0x264)]=parseFloat(_0x626a4f)+parseFloat(_0x7670b8[_0x15c458(0x264)]),_0x7670b8[_0x15c458(0x25e)]=_0x10b5b9,console[_0x15c458(0x26b)](_0x7670b8);const _0xa7ab5b=await _0x7670b8[_0x15c458(0x257)](),_0x2a2187=await c_payment_data[_0x15c458(0x271)]({'invoice':_0x40d7a8});_0x2a2187['amount']=_0x10b5b9,await _0x2a2187[_0x15c458(0x257)]();let _0x24abf3=new Date(),_0x32cf3b=('0'+_0x24abf3[_0x15c458(0x228)]())[_0x15c458(0x216)](-0x2),_0x2f07ce=('0'+(_0x24abf3['getMonth']()+0x1))[_0x15c458(0x216)](-0x2),_0x4909b3=_0x24abf3[_0x15c458(0x1d7)](),_0x4a2604=_0x4909b3+'-'+_0x2f07ce+'-'+_0x32cf3b;const _0x133572=new customer_payment({'invoice':_0x40d7a8,'date':_0x4909b3+'-'+_0x2f07ce+'-'+_0x32cf3b,'customer':_0x56c51e,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x626a4f}),_0x2c220f=await _0x133572['save']();_0x6fb7e5[_0x15c458(0x293)](_0x15c458(0x207),_0x15c458(0x1f3)),_0x5647a1[_0x15c458(0x250)](_0x15c458(0x1d3));}catch(_0x44a00a){console['log'](_0x44a00a);}}),router[a0_0x1d99b8(0x20d)](a0_0x1d99b8(0x1ee),auth,async(_0x26078e,_0x4ffcd8)=>{var _0x5124c8=a0_0x1d99b8;try{const {username:_0x2c38ec,email:_0x513f53,role:_0xb136ff}=_0x26078e[_0x5124c8(0x229)],_0x19a090=_0x26078e[_0x5124c8(0x229)],_0x52e6c1=await profile[_0x5124c8(0x271)]({'email':_0x19a090[_0x5124c8(0x1e4)]}),_0x46bc7c=await master_shop[_0x5124c8(0x268)]();console['log'](_0x5124c8(0x22d),_0x46bc7c);const _0x32f89f=_0x26078e[_0x5124c8(0x1eb)]['id'],_0x3ddb74=await sales[_0x5124c8(0x20e)](_0x32f89f);console['log'](_0x3ddb74);const _0xd6af67=await customer[_0x5124c8(0x271)]({'name':_0x3ddb74[_0x5124c8(0x231)]});console[_0x5124c8(0x26b)](_0xd6af67);if(_0x46bc7c[0x0][_0x5124c8(0x2b3)]==_0x5124c8(0x247)){var _0x5aea1f=users[_0x5124c8(0x202)];console[_0x5124c8(0x26b)](_0x5aea1f);}else{if(_0x46bc7c[0x0]['language']=='Hindi')var _0x5aea1f=users[_0x5124c8(0x2ba)];else{if(_0x46bc7c[0x0][_0x5124c8(0x2b3)]==_0x5124c8(0x1df))var _0x5aea1f=users[_0x5124c8(0x1df)];else{if(_0x46bc7c[0x0][_0x5124c8(0x2b3)]==_0x5124c8(0x2af))var _0x5aea1f=users[_0x5124c8(0x2af)];else{if(_0x46bc7c[0x0][_0x5124c8(0x2b3)]==_0x5124c8(0x1c4))var _0x5aea1f=users[_0x5124c8(0x1c4)];else{if(_0x46bc7c[0x0]['language']=='Portuguese\x20(BR)')var _0x5aea1f=users[_0x5124c8(0x287)];else{if(_0x46bc7c[0x0][_0x5124c8(0x2b3)]==_0x5124c8(0x2a8))var _0x5aea1f=users[_0x5124c8(0x2a8)];else{if(_0x46bc7c[0x0][_0x5124c8(0x2b3)]==_0x5124c8(0x245))var _0x5aea1f=users[_0x5124c8(0x261)];}}}}}}}_0x4ffcd8[_0x5124c8(0x1e1)](_0x5124c8(0x1db),{'success':_0x26078e[_0x5124c8(0x293)]('success'),'errors':_0x26078e[_0x5124c8(0x293)](_0x5124c8(0x29f)),'role':_0x19a090,'profile':_0x52e6c1,'master_shop':_0x46bc7c,'customers':_0xd6af67,'sales':_0x3ddb74,'language':_0x5aea1f});}catch(_0x30a3d1){console[_0x5124c8(0x26b)](_0x30a3d1);}}),router[a0_0x1d99b8(0x20d)](a0_0x1d99b8(0x2c5),auth,async(_0x5d1379,_0xd17f04)=>{var _0x19b66e=a0_0x1d99b8;try{const {username:_0x42f521,email:_0x1167f0,role:_0x1366fd}=_0x5d1379[_0x19b66e(0x229)],_0xf6863d=_0x5d1379[_0x19b66e(0x229)],_0x166710=await profile[_0x19b66e(0x271)]({'email':_0xf6863d[_0x19b66e(0x1e4)]}),_0x2e02e8=await master_shop[_0x19b66e(0x268)]();console[_0x19b66e(0x26b)](_0x19b66e(0x22d),_0x2e02e8);const _0x2b7f01=_0x5d1379[_0x19b66e(0x1eb)]['id'];console[_0x19b66e(0x26b)](_0x2b7f01);const _0x50fc48=await sales['findById'](_0x2b7f01);console[_0x19b66e(0x26b)]('user_id',_0x50fc48);const _0x1328c4=await warehouse[_0x19b66e(0x2c3)]([{'$match':{'name':'Return\x20Goods','room':_0x19b66e(0x2ae)}},{'$unwind':_0x19b66e(0x1f8)},{'$group':{'_id':_0x19b66e(0x237),'name':{'$first':_0x19b66e(0x2a3)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x19b66e(0x255)},'isle':{'$first':_0x19b66e(0x278)},'pallet':{'$first':_0x19b66e(0x274)},'primary_code':{'$first':_0x19b66e(0x20c)},'secondary_code':{'$first':_0x19b66e(0x1cd)},'product_code':{'$first':_0x19b66e(0x1e7)}}}]);console['log'](_0x19b66e(0x25c),_0x1328c4);const _0x267e4d=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x19b66e(0x291),'warehouse_category':_0x19b66e(0x28d)}},{'$group':{'_id':_0x19b66e(0x1cf),'name':{'$first':_0x19b66e(0x1cf)}}},{'$sort':{'name':0x1}}]);var _0x4806d8=[_0x19b66e(0x2ae)];if(_0x2e02e8[0x0][_0x19b66e(0x2b3)]==_0x19b66e(0x247)){var _0x4fb93d=users[_0x19b66e(0x202)];console[_0x19b66e(0x26b)](_0x4fb93d);}else{if(_0x2e02e8[0x0][_0x19b66e(0x2b3)]==_0x19b66e(0x2ba))var _0x4fb93d=users['Hindi'];else{if(_0x2e02e8[0x0][_0x19b66e(0x2b3)]==_0x19b66e(0x1df))var _0x4fb93d=users[_0x19b66e(0x1df)];else{if(_0x2e02e8[0x0]['language']==_0x19b66e(0x2af))var _0x4fb93d=users[_0x19b66e(0x2af)];else{if(_0x2e02e8[0x0]['language']==_0x19b66e(0x1c4))var _0x4fb93d=users[_0x19b66e(0x1c4)];else{if(_0x2e02e8[0x0][_0x19b66e(0x2b3)]=='Portuguese\x20(BR)')var _0x4fb93d=users[_0x19b66e(0x287)];else{if(_0x2e02e8[0x0][_0x19b66e(0x2b3)]=='Chinese')var _0x4fb93d=users['Chinese'];else{if(_0x2e02e8[0x0][_0x19b66e(0x2b3)]==_0x19b66e(0x245))var _0x4fb93d=users['Arabic'];}}}}}}}_0xd17f04[_0x19b66e(0x1e1)](_0x19b66e(0x296),{'success':_0x5d1379[_0x19b66e(0x293)]('success'),'errors':_0x5d1379[_0x19b66e(0x293)](_0x19b66e(0x29f)),'role':_0xf6863d,'profile':_0x166710,'user':_0x50fc48,'stock':_0x1328c4,'master_shop':_0x2e02e8,'unit':_0x267e4d,'language':_0x4fb93d,'warehouses':warehouse_data,'rooms':_0x4806d8});}catch(_0x671afa){console[_0x19b66e(0x26b)](_0x671afa),_0xd17f04[_0x19b66e(0x203)](0xc8)['json']({'message':_0x671afa['message']});}}),router['post'](a0_0x1d99b8(0x2c5),auth,async(_0x400c38,_0x5b4545)=>{var _0x33646e=a0_0x1d99b8;try{const {invoice:_0x1e286f,date:_0x5a2f24,warehouse_name:_0x3b9a62,product_name:_0xf43e8f,primary_code:_0x33d6db,secondary_code:_0x540c63,product_code:_0x19fff4,sales_quantity:_0x5593c7,stocks:_0x5c604c,return_qty:_0x4f9886,Room_name:_0x58d26c,to_warehouse_name:_0x3bfc28,to_Roomname:_0x4b6fa3,to_Room_name:_0x418e32,note:_0x2f6006,level:_0x8310ab,isle:_0x4ca668,pallet:_0x2168f1}=_0x400c38[_0x33646e(0x290)];if(typeof _0xf43e8f==_0x33646e(0x1cc))var _0x1b752b=[_0x400c38[_0x33646e(0x290)][_0x33646e(0x28f)]],_0x27bae9=[_0x400c38['body'][_0x33646e(0x236)]],_0x41e38d=[_0x400c38['body'][_0x33646e(0x288)]],_0x3abdea=[_0x400c38[_0x33646e(0x290)][_0x33646e(0x1d5)]],_0xab67a8=[_0x400c38[_0x33646e(0x290)]['sales_quantity']],_0x311bb2=[_0x400c38[_0x33646e(0x290)][_0x33646e(0x1de)]],_0x3cc13a=[_0x400c38[_0x33646e(0x290)][_0x33646e(0x299)]],_0x1d2c3d=[_0x400c38[_0x33646e(0x290)]['bay']],_0xb9af51=[_0x400c38[_0x33646e(0x290)]['bin']],_0x2654fb=[_0x400c38['body']['types']],_0x44587a=[_0x400c38[_0x33646e(0x290)][_0x33646e(0x2ab)]];else var _0x1b752b=[..._0x400c38['body']['product_name']],_0x27bae9=[..._0x400c38['body'][_0x33646e(0x236)]],_0x41e38d=[..._0x400c38[_0x33646e(0x290)][_0x33646e(0x288)]],_0x3abdea=[..._0x400c38['body'][_0x33646e(0x1d5)]],_0xab67a8=[..._0x400c38['body']['sales_quantity']],_0x311bb2=[..._0x400c38[_0x33646e(0x290)]['stocks']],_0x3cc13a=[..._0x400c38[_0x33646e(0x290)][_0x33646e(0x299)]],_0x1d2c3d=[..._0x400c38['body'][_0x33646e(0x251)]],_0xb9af51=[..._0x400c38[_0x33646e(0x290)][_0x33646e(0x26a)]],_0x2654fb=[..._0x400c38[_0x33646e(0x290)]['types']],_0x44587a=[..._0x400c38[_0x33646e(0x290)][_0x33646e(0x2ab)]];const _0x3fbe63=_0x1b752b[_0x33646e(0x2bf)](_0x42d88f=>{return _0x42d88f={'product_name':_0x42d88f};});_0x27bae9[_0x33646e(0x2bc)]((_0x1a869f,_0x214fe1)=>{var _0x1d2ecb=_0x33646e;_0x3fbe63[_0x214fe1][_0x1d2ecb(0x236)]=_0x1a869f;}),_0x41e38d[_0x33646e(0x2bc)]((_0x4a0381,_0x35cff6)=>{var _0x50afbe=_0x33646e;_0x3fbe63[_0x35cff6][_0x50afbe(0x288)]=_0x4a0381;}),_0x3abdea[_0x33646e(0x2bc)]((_0x11e7b2,_0x5f19a2)=>{_0x3fbe63[_0x5f19a2]['product_code']=_0x11e7b2;}),_0xab67a8[_0x33646e(0x2bc)]((_0x3cdc8e,_0x3bfa31)=>{var _0x20a5eb=_0x33646e;_0x3fbe63[_0x3bfa31][_0x20a5eb(0x283)]=_0x3cdc8e;}),_0x311bb2[_0x33646e(0x2bc)]((_0x4711a5,_0x52ec5f)=>{var _0x1e6dc3=_0x33646e;_0x3fbe63[_0x52ec5f][_0x1e6dc3(0x232)]=_0x4711a5;}),_0x3cc13a[_0x33646e(0x2bc)]((_0xdaf28f,_0x23dbda)=>{var _0xca7c0b=_0x33646e;_0x3fbe63[_0x23dbda][_0xca7c0b(0x299)]=_0xdaf28f;}),_0x1d2c3d[_0x33646e(0x2bc)]((_0x46c7aa,_0x4d773d)=>{var _0x3bda93=_0x33646e;_0x3fbe63[_0x4d773d][_0x3bda93(0x251)]=_0x46c7aa;}),_0xb9af51[_0x33646e(0x2bc)]((_0x42e71a,_0x595d06)=>{var _0x5a3385=_0x33646e;_0x3fbe63[_0x595d06][_0x5a3385(0x26a)]=_0x42e71a;}),_0x2654fb['forEach']((_0x2283dc,_0xaf992d)=>{var _0x533a1c=_0x33646e;_0x3fbe63[_0xaf992d][_0x533a1c(0x225)]=_0x2283dc;}),_0x44587a['forEach']((_0x2bee91,_0xe8efd7)=>{var _0x44ba6b=_0x33646e;_0x3fbe63[_0xe8efd7][_0x44ba6b(0x2ab)]=_0x2bee91;});var _0x3bf1b9=0x0;_0x3fbe63[_0x33646e(0x2bc)](_0xf74840=>{var _0x51c71e=_0x33646e;console[_0x51c71e(0x26b)]('foreach\x20newproduct',_0xf74840),(parseInt(_0xf74840[_0x51c71e(0x283)])<parseInt(_0xf74840[_0x51c71e(0x299)])||parseInt(_0xf74840['stock'])<parseInt(_0xf74840[_0x51c71e(0x299)])&&parseInt(_0xf74840[_0x51c71e(0x283)])>parseInt(_0xf74840[_0x51c71e(0x299)])||parseInt(_0xf74840[_0x51c71e(0x299)])==0x0)&&_0x3bf1b9++;});if(_0x3bf1b9!=0x0)return _0x400c38['flash'](_0x33646e(0x29f),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x5b4545[_0x33646e(0x250)](_0x33646e(0x25b));const _0x2bf45f=await sales['findOne']({'invoice':_0x1e286f});console[_0x33646e(0x26b)](_0x2bf45f),_0x2bf45f[_0x33646e(0x285)]='True';const _0x52f444=await _0x2bf45f['save'](),_0x56beb3=new sales_return({'invoice':_0x1e286f,'customer':_0x400c38[_0x33646e(0x290)]['customer'],'date':_0x5a2f24,'warehouse_name':_0x3b9a62,'room':_0x58d26c,'ToWarehouse':_0x3bfc28,'ToRoom':_0x418e32,'return_sale':_0x3fbe63,'note':_0x2f6006}),_0x5eb886=await _0x56beb3['save']();console[_0x33646e(0x26b)](_0x56beb3);const _0x104f72=await sales_return[_0x33646e(0x271)]({'invoice':_0x1e286f}),_0x2888d1=await warehouse[_0x33646e(0x271)]({'name':_0x3bfc28,'room':_0x418e32});_0x104f72[_0x33646e(0x296)][_0x33646e(0x2bc)](_0x269666=>{var _0x3af2c0=_0x33646e,_0x423149=0x0;const _0xb2e4d7=_0x2888d1['product_details'][_0x3af2c0(0x2bf)](_0x9a2c7a=>{var _0xbdbf58=_0x3af2c0;_0x9a2c7a[_0xbdbf58(0x28f)]==_0x269666[_0xbdbf58(0x28f)]&&_0x9a2c7a[_0xbdbf58(0x2ab)]==_0x269666[_0xbdbf58(0x2ab)]&&_0x9a2c7a[_0xbdbf58(0x225)]==_0x269666[_0xbdbf58(0x225)]&&_0x9a2c7a[_0xbdbf58(0x26a)]==_0x269666[_0xbdbf58(0x26a)]&&_0x9a2c7a[_0xbdbf58(0x251)]==_0x269666[_0xbdbf58(0x251)]&&(_0x9a2c7a[_0xbdbf58(0x294)]=parseInt(_0x9a2c7a[_0xbdbf58(0x294)])+parseInt(_0x269666[_0xbdbf58(0x299)]),_0x423149++);});_0x423149=='0'&&(_0x2888d1['product_details']=_0x2888d1['product_details'][_0x3af2c0(0x1fa)]({'product_name':_0x269666['product_name'],'product_stock':_0x269666['return_qty'],'primary_code':_0x269666[_0x3af2c0(0x236)],'secondary_code':_0x269666['secondary_code'],'product_code':_0x269666[_0x3af2c0(0x1d5)],'bay':_0x269666[_0x3af2c0(0x251)],'bin':_0x269666[_0x3af2c0(0x26a)],'type':_0x269666[_0x3af2c0(0x225)],'floorlevel':_0x269666[_0x3af2c0(0x2ab)]})),console[_0x3af2c0(0x26b)](_0x3af2c0(0x289),_0x2888d1);}),await _0x2888d1[_0x33646e(0x257)](),console[_0x33646e(0x26b)](_0x400c38[_0x33646e(0x290)]);const _0x2d825f=new c_payment_data({'invoice':_0x1e286f,'customer':_0x400c38[_0x33646e(0x290)][_0x33646e(0x231)],'reason':_0x33646e(0x27d)});await _0x2d825f[_0x33646e(0x257)]();const _0x50b39b=await master_shop[_0x33646e(0x268)]();console[_0x33646e(0x26b)]('add\x20post',_0x50b39b[0x0][_0x33646e(0x27e)]);const _0x56f236=await email_settings['findOne'](),_0x3452c4=await customer[_0x33646e(0x271)]({'name':_0x400c38[_0x33646e(0x290)][_0x33646e(0x231)]});console['log'](_0x33646e(0x270),_0x3452c4);_0x50b39b[0x0]['currency_placement']==0x1?(right_currency=_0x50b39b[0x0][_0x33646e(0x26c)],left_currency=''):(right_currency='',left_currency=_0x50b39b[0x0][_0x33646e(0x26c)]);var _0x5f6aa4=_0x1b752b,_0x22c508=_0x3cc13a,_0x425dd5='',_0x19b17a;for(_0x19b17a in _0x5f6aa4){_0x425dd5+=_0x33646e(0x205)+_0x33646e(0x214)+_0x5f6aa4[_0x19b17a]+_0x33646e(0x265)+_0x33646e(0x214)+_0x22c508[_0x19b17a]+_0x33646e(0x265)+_0x33646e(0x1c5);}console[_0x33646e(0x26b)](_0x33646e(0x1da),_0x425dd5);let _0x218d33=nodemailer[_0x33646e(0x239)]({'service':_0x33646e(0x286),'auth':{'user':_0x56f236['email'],'pass':_0x56f236['password']}}),_0x10bc24={'from':_0x56f236[_0x33646e(0x1e4)],'to':_0x3452c4[_0x33646e(0x1e4)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x50b39b[0x0]['image'],'cid':_0x33646e(0x2a5)}],'html':_0x33646e(0x213)+_0x33646e(0x24b)+_0x33646e(0x266)+_0x33646e(0x2b7)+_0x33646e(0x2be)+'<div>'+_0x33646e(0x2c1)+_0x33646e(0x260)+'<div>'+_0x33646e(0x2b1)+_0x50b39b[0x0][_0x33646e(0x26e)]+'\x20</h2>'+'</div>'+_0x33646e(0x260)+_0x33646e(0x2a1)+_0x33646e(0x2b7)+_0x33646e(0x21c)+_0x33646e(0x258)+_0x1e286f+'\x20'+_0x33646e(0x276)+_0x33646e(0x23a)+_0x5a2f24+'\x20'+'</span>'+_0x33646e(0x1f6)+'</div>'+_0x33646e(0x1d2)+_0x33646e(0x21d)+_0x33646e(0x205)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x33646e(0x29b)+_0x33646e(0x2a0)+_0x33646e(0x248)+_0x33646e(0x1c5)+_0x33646e(0x1d0)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x425dd5+'\x20'+_0x33646e(0x2b8)+_0x33646e(0x230)+_0x33646e(0x2b7)+_0x33646e(0x2c9)+_0x33646e(0x219)+_0x50b39b[0x0]['site_title']+_0x33646e(0x1f6)+'</div>'+_0x33646e(0x260)+_0x33646e(0x233)};_0x218d33['sendMail'](_0x10bc24,function(_0x29862b,_0x4fb6fc){var _0x420aa3=_0x33646e;_0x29862b?(console[_0x420aa3(0x26b)](_0x29862b),console[_0x420aa3(0x26b)](_0x420aa3(0x1cb))):console[_0x420aa3(0x26b)]('Email\x20sent\x20successfully');}),_0x400c38['flash'](_0x33646e(0x207),_0x33646e(0x297)),_0x5b4545[_0x33646e(0x250)](_0x33646e(0x1d3));}catch(_0x2f6f81){console['log'](_0x2f6f81),_0x5b4545[_0x33646e(0x203)](0xc8)[_0x33646e(0x272)]({'message1':_0x2f6f81[_0x33646e(0x223)]});}}),router[a0_0x1d99b8(0x20d)]('/barcode/:id',auth,async(_0x4ccd2b,_0x9573d1)=>{var _0xe05383=a0_0x1d99b8;try{const {username:_0x13f9c7,email:_0x56a7e4,role:_0x1f0620}=_0x4ccd2b[_0xe05383(0x229)],_0x182aa8=_0x4ccd2b[_0xe05383(0x229)],_0x28c34e=await profile['findOne']({'email':_0x182aa8[_0xe05383(0x1e4)]}),_0x4131f3=await master_shop['find']();console['log'](_0xe05383(0x292),_0x4131f3);const _0x46b941=_0x4ccd2b[_0xe05383(0x1eb)]['id'],_0x4ef2fa=await sales[_0xe05383(0x20e)](_0x46b941);console['log']('barcode\x20user_id',_0x4ef2fa);if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x247))var _0x4e70ff=users[_0xe05383(0x202)];else{if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x2ba))var _0x4e70ff=users[_0xe05383(0x2ba)];else{if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x1df))var _0x4e70ff=users[_0xe05383(0x1df)];else{if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x2af))var _0x4e70ff=users['Spanish'];else{if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x1c4))var _0x4e70ff=users[_0xe05383(0x1c4)];else{if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x2a9))var _0x4e70ff=users[_0xe05383(0x287)];else{if(_0x4131f3[0x0][_0xe05383(0x2b3)]==_0xe05383(0x2a8))var _0x4e70ff=users[_0xe05383(0x2a8)];else{if(_0x4131f3[0x0]['language']==_0xe05383(0x245))var _0x4e70ff=users[_0xe05383(0x261)];}}}}}}}_0x9573d1[_0xe05383(0x1e1)](_0xe05383(0x227),{'success':_0x4ccd2b[_0xe05383(0x293)](_0xe05383(0x207)),'errors':_0x4ccd2b[_0xe05383(0x293)](_0xe05383(0x29f)),'role':_0x182aa8,'profile':_0x28c34e,'alldata':_0x4ef2fa,'master_shop':_0x4131f3,'language':_0x4e70ff});}catch(_0x52957f){console['log'](_0x52957f);}}),router[a0_0x1d99b8(0x21b)](a0_0x1d99b8(0x1d8),async(_0x1a256d,_0x4e4f7b)=>{var _0x4b3a2d=a0_0x1d99b8;const {product_code:_0x560948,warehouse_name:_0x414e4b,rooms_data:_0x500e69,Roomslist:_0x5d48b5}=_0x1a256d[_0x4b3a2d(0x290)],_0x5309ce=_0x5d48b5[_0x4b3a2d(0x24d)](','),_0xd494e8=[];async function _0x36eb2d(_0x58ddaf){var _0x436647=_0x4b3a2d;const _0x2bc3a2=await warehouse[_0x436647(0x2c3)]([{'$match':{'name':_0x414e4b,'room':_0x58ddaf}},{'$unwind':_0x436647(0x1f8)},{'$match':{'product_details.primary_code':_0x560948}},{'$group':{'_id':_0x436647(0x237),'name':{'$first':_0x436647(0x2a3)},'product_stock':{'$first':_0x436647(0x1ec)},'primary_code':{'$first':_0x436647(0x20c)},'secondary_code':{'$first':_0x436647(0x1cd)},'product_code':{'$first':_0x436647(0x1e7)},'level':{'$first':_0x436647(0x1f0)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x436647(0x2ad)},'pallet':{'$first':_0x436647(0x2ac)},'unit':{'$first':_0x436647(0x27f)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x436647(0x27a)},'rack':{'$first':_0x436647(0x1fd)},'expiry_date':{'$first':_0x436647(0x1d6)},'production_date':{'$first':_0x436647(0x1e8)},'maxPerUnit':{'$first':_0x436647(0x1d1)},'batch_code':{'$first':_0x436647(0x215)},'product_cat':{'$first':_0x436647(0x27c)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x436647(0x1ca)},'invoice':{'$first':_0x436647(0x1ed)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x26a842=await warehouse[_0x436647(0x2c3)]([{'$match':{'name':_0x414e4b,'room':_0x58ddaf}},{'$unwind':_0x436647(0x1f8)},{'$match':{'product_details.secondary_code':_0x560948}},{'$group':{'_id':_0x436647(0x237),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x436647(0x1cd)},'product_code':{'$first':_0x436647(0x1e7)},'level':{'$first':_0x436647(0x1f0)},'isle':{'$first':_0x436647(0x23f)},'type':{'$first':_0x436647(0x2ad)},'pallet':{'$first':_0x436647(0x2ac)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x436647(0x29e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x436647(0x1fd)},'expiry_date':{'$first':_0x436647(0x1d6)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x436647(0x1d1)},'batch_code':{'$first':_0x436647(0x215)},'product_cat':{'$first':_0x436647(0x27c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x436647(0x1ca)},'invoice':{'$first':_0x436647(0x1ed)}}}]);if(_0x2bc3a2[_0x436647(0x1e9)]>0x0)_0xd494e8[_0x436647(0x2a2)](_0x2bc3a2);else _0x26a842[_0x436647(0x1e9)]>0x0&&_0xd494e8[_0x436647(0x2a2)](_0x26a842);}const _0xd536f8=_0x5309ce['map'](_0x442e52=>_0x36eb2d(_0x442e52));await Promise[_0x4b3a2d(0x1f2)](_0xd536f8),_0x4e4f7b[_0x4b3a2d(0x272)](_0xd494e8);}),module[a0_0x1d99b8(0x2b5)]=router;