function a0_0x3457(_0xeacda7,_0x112022){var _0x3bc3dc=a0_0x3bc3();return a0_0x3457=function(_0x345787,_0x520ece){_0x345787=_0x345787-0x1a4;var _0x21b9f8=_0x3bc3dc[_0x345787];return _0x21b9f8;},a0_0x3457(_0xeacda7,_0x112022);}function a0_0x3bc3(){var _0x4f184b=['$product_details.maxPerUnit','False','\x20Order\x20Number\x20:\x20','product_details','createTransport','random','$product_details.floorlevel','</div>','1145332NrGrsP','forEach','162201Vopfac','product_code','port','Email\x20sent\x20successfully','user','$product_details.batch_code','customers','all_sales','Raw\x20Materials','</span>','product_stock','Received\x20Payment\x20For\x20Sale','aggregate','Arabic','SCRN','$sale_product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$note','Floor','Return\x20Rooms','product_name','</thead>','map','find','5891480gzTesa','all_sales_barcode','$sale_product.type','</h5>','$product_details.rack','$product_details.product_stock','<h5\x20style=\x22text-align:\x20left;\x22>','get','nodemailer','/barcode_scanner','<div>','abs','$customer','floorlevel','getFullYear','Arabic\x20(ae)','warehouse_name','True','$customers_docs','stock_data','/preview/:id','$product_details.actual_uom','errors','received_amount','room_name','/view/return_sales/:id','RMSEmail','foreach\x20newproduct','/../public','English','secondary_code','$product_details.invoice','actual_uom','bay','barcode\x20Product\x20master','barcode\x20user_id','$sale_product.quantity','$product_details.product_cat','language','OUT-','return_sale','Spanish','Portuguese\x20(BR)','5hJHbfn','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','all','maxperunit','expiry_date','/upload/','$sale_product.bay','Shelves','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','edit_sales_view','$product_details.isle','Level','product_data','$room','bin','push','5219910fwCLEj','</body></html>','$product_details.pallet','prod_invoice','$product_details.bin','52WeHLzf','</table>','Router','/view/add_sale/product','staff','There\x27s\x20a\x20error\x20in\x20this\x20transaction','unit','return_data','warehouse','concat','delivery_code','delivery_date','type','primary_code','batch_code','$product_details.storage','post','slice','Sales\x20Mail','Enabled','$product_details.secondary_unit','sale_product','Return\x20Goods','message','/view/add_sales','Sale\x20Return','stock','$name','/view/:id','_id','<hr\x20class=\x22my-3\x22>','flash','primary_unit','production_date','<strong>\x20Regards\x20</strong>','product_list','$sale_product.bin','$product_details.production_date','room','split','name','$product_details.type','redirect','</td>','email','sale_qty','736728KHdlET','host','max','quantity_notConverted','id_transact','prod_code','amount','image','/all_sales/view','Logo.png','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','then','toString','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','floor','date','due_amount','\x20</h2>','storage','customer','secondary_unit','<span\x20style=\x22float:\x20right;\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Sale\x20Return\x20Mail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$return_data','$product.product_name','types','payment\x20successfull','Sales\x20Add\x20successfully','/view','$product_details.unit','<html><head><title></title>','password','logo','render','prod_cat','<table\x20style=\x22width:\x20100%\x20!important;\x22>','sales_quantity','rack','add\x20post','role','id_transaction_from','stocks','finalize','Portuguese','sendMail','add_sales','$_id','3748129pINEtc','\x20Order\x20Date\x20:\x20','requested_qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','save','$product_details','filter','<tr>','$product','$product_details.bay','invoice','findById','actual_qty','$product_details.primary_code','quantity','Sales\x20Update\x20successfully','gmail','$warehouse_name','log','../public/language/languages.json','customer_data','isAllowEdit','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','findOne','customers_docs','max_per_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$date','Enclosed','$product_details.level','status','$product_details.expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Ambient','back','</tbody>','$product_details.secondary_code','English\x20(US)','site_title','$product_details._id','German','success','length','<h2>\x20','purchases_data','/all_sales/preview/','Receiving\x20Area','191936pEDqvC','json','carton','$isAllowEdit','/invoice/:id','French','$product_details.actual_qty','currency','<!DOCTYPE\x20html>','error','../middleware/auth','master','getDate','<h5>','</tr>','/give_payment/:id','$product_details.product_code','sales_invoice','$invoice','/view/add_sales/:id','An\x20error\x20occurred.','../models/all_models','return_qty','$sale_product','note','currency_placement','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.product_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$finalize','RoomAssigned','exports','Hindi','string','params'];a0_0x3bc3=function(){return _0x4f184b;};return a0_0x3bc3();}var a0_0x1ca151=a0_0x3457;(function(_0x2f75c4,_0x687ef4){var _0x141da6=a0_0x3457,_0x561f2f=_0x2f75c4();while(!![]){try{var _0x2ce32d=-parseInt(_0x141da6(0x1f6))/0x1+parseInt(_0x141da6(0x221))/0x2+-parseInt(_0x141da6(0x223))/0x3*(-parseInt(_0x141da6(0x27d))/0x4)+parseInt(_0x141da6(0x266))/0x5*(parseInt(_0x141da6(0x2ab))/0x6)+parseInt(_0x141da6(0x1c4))/0x7+-parseInt(_0x141da6(0x23b))/0x8+-parseInt(_0x141da6(0x278))/0x9;if(_0x2ce32d===_0x687ef4)break;else _0x561f2f['push'](_0x561f2f['shift']());}catch(_0x3ebf11){_0x561f2f['push'](_0x561f2f['shift']());}}}(a0_0x3bc3,0x67dc3));const express=require('express'),app=express(),router=express[a0_0x1ca151(0x27f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1ca151(0x20b)),auth=require(a0_0x1ca151(0x200)),nodemailer=require(a0_0x1ca151(0x243)),users=require(a0_0x1ca151(0x1d7));router['get'](a0_0x1ca151(0x1b1),auth,async(_0x1a77b9,_0x3e0d8a)=>{var _0x261d0b=a0_0x1ca151;try{const {username:_0x2418be,email:_0xaf050,role:_0x1f8144}=_0x1a77b9[_0x261d0b(0x227)],_0x439ca4=_0x1a77b9[_0x261d0b(0x227)],_0x218836=await profile[_0x261d0b(0x1dc)]({'email':_0x439ca4[_0x261d0b(0x2a9)]}),_0x3b8552=await master_shop[_0x261d0b(0x23a)]();let _0x2d710e;if(_0x439ca4[_0x261d0b(0x1bc)]==_0x261d0b(0x281)){const _0x4668f8=await staff[_0x261d0b(0x1dc)]({'email':_0x439ca4[_0x261d0b(0x2a9)]});_0x2d710e=await sales[_0x261d0b(0x22f)]([{'$lookup':{'from':_0x261d0b(0x229),'localField':'customer','foreignField':'name','as':_0x261d0b(0x1dd)}},{'$unwind':_0x261d0b(0x24d)},{'$unwind':_0x261d0b(0x20d)},{'$group':{'_id':_0x261d0b(0x1c3),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x261d0b(0x247)},'date':{'$first':_0x261d0b(0x1e0)},'warehouse_name':{'$first':_0x261d0b(0x1d5)},'sale_product':{'$push':_0x261d0b(0x20d)},'note':{'$first':_0x261d0b(0x234)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x261d0b(0x24d)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x261d0b(0x26d)},'isle':{'$addToSet':_0x261d0b(0x2a1)},'type':{'$addToSet':_0x261d0b(0x23d)},'pallet':{'$addToSet':_0x261d0b(0x232)},'finalize':{'$first':_0x261d0b(0x213)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2d710e=await sales[_0x261d0b(0x22f)]([{'$lookup':{'from':'customers','localField':_0x261d0b(0x1a6),'foreignField':_0x261d0b(0x2a5),'as':_0x261d0b(0x1dd)}},{'$unwind':'$customers_docs'},{'$unwind':_0x261d0b(0x20d)},{'$group':{'_id':_0x261d0b(0x1c3),'invoice':{'$first':_0x261d0b(0x208)},'customers':{'$first':'$customer'},'date':{'$first':_0x261d0b(0x1e0)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x261d0b(0x20d)},'note':{'$first':_0x261d0b(0x234)},'return_data':{'$first':_0x261d0b(0x1ac)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x261d0b(0x25f)},'level':{'$addToSet':_0x261d0b(0x26d)},'isle':{'$addToSet':_0x261d0b(0x2a1)},'type':{'$addToSet':_0x261d0b(0x23d)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x261d0b(0x213)},'isAllowEdit':{'$first':_0x261d0b(0x1f9)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x261d0b(0x1d6)]('sales\x20all_data',_0x2d710e);if(_0x3b8552[0x0][_0x261d0b(0x261)]==_0x261d0b(0x1ec)){var _0x2e482e=users[_0x261d0b(0x258)];console[_0x261d0b(0x1d6)](_0x2e482e);}else{if(_0x3b8552[0x0][_0x261d0b(0x261)]=='Hindi')var _0x2e482e=users[_0x261d0b(0x216)];else{if(_0x3b8552[0x0][_0x261d0b(0x261)]=='German')var _0x2e482e=users['German'];else{if(_0x3b8552[0x0][_0x261d0b(0x261)]==_0x261d0b(0x264))var _0x2e482e=users[_0x261d0b(0x264)];else{if(_0x3b8552[0x0]['language']==_0x261d0b(0x1fb))var _0x2e482e=users[_0x261d0b(0x1fb)];else{if(_0x3b8552[0x0][_0x261d0b(0x261)]==_0x261d0b(0x265))var _0x2e482e=users['Portuguese'];else{if(_0x3b8552[0x0]['language']==_0x261d0b(0x1e6))var _0x2e482e=users[_0x261d0b(0x1e6)];else{if(_0x3b8552[0x0]['language']==_0x261d0b(0x24a))var _0x2e482e=users[_0x261d0b(0x230)];}}}}}}}_0x3e0d8a[_0x261d0b(0x1b6)](_0x261d0b(0x22a),{'success':_0x1a77b9['flash'](_0x261d0b(0x1f0)),'errors':_0x1a77b9[_0x261d0b(0x29c)]('errors'),'sales':_0x2d710e,'profile':_0x218836,'role':_0x439ca4,'master_shop':_0x3b8552,'language':_0x2e482e});}catch(_0x56fd31){console[_0x261d0b(0x1d6)](_0x56fd31);}});async function getRandom8DigitNumber(){var _0x48a3db=a0_0x1ca151;const _0x4feac8=0x989680,_0x53e556=0x5f5e0ff,_0x148a3f=Math[_0x48a3db(0x2bb)](Math[_0x48a3db(0x21e)]()*(_0x53e556-_0x4feac8+0x1))+_0x4feac8;var _0x1d0cb8;const _0x886c68=await sales['findOne']({'invoice':_0x48a3db(0x262)+_0x148a3f});return _0x886c68&&_0x886c68[_0x48a3db(0x1f1)]>0x0?_0x1d0cb8=_0x48a3db(0x262)+_0x148a3f:_0x1d0cb8='OUT-'+_0x148a3f,_0x1d0cb8;}router['get']('/view/add_sales',auth,async(_0x1efdf3,_0x3adc76)=>{var _0x3eec57=a0_0x1ca151;try{const {username:_0x587fee,email:_0x538f5c,role:_0x5140fe}=_0x1efdf3[_0x3eec57(0x227)],_0x1c150a=_0x1efdf3[_0x3eec57(0x227)],_0x447027=await profile[_0x3eec57(0x1dc)]({'email':_0x1c150a[_0x3eec57(0x2a9)]}),_0x41fbd9=await master_shop[_0x3eec57(0x23a)](),_0x17cc9a=await customer['find']({});let _0x169857;if(_0x1c150a[_0x3eec57(0x1bc)]=='staff'){const _0x39d1ef=await staff[_0x3eec57(0x1dc)]({'email':_0x1c150a[_0x3eec57(0x2a9)]});_0x169857=await warehouse[_0x3eec57(0x22f)]([{'$match':{'status':_0x3eec57(0x290),'name':_0x39d1ef[_0x3eec57(0x285)],'warehouse_category':_0x3eec57(0x22b),'name':{'$ne':_0x3eec57(0x293)}}},{'$group':{'_id':'$name','name':{'$first':_0x3eec57(0x298)}}},{'$sort':{'name':0x1}}]);}else _0x169857=await warehouse[_0x3eec57(0x22f)]([{'$match':{'status':_0x3eec57(0x290),'warehouse_category':_0x3eec57(0x22b),'name':{'$ne':_0x3eec57(0x293)}}},{'$group':{'_id':_0x3eec57(0x298),'name':{'$first':_0x3eec57(0x298)}}},{'$sort':{'name':0x1}}]);const _0x43120c=await product['find']({});var _0x50ed8c=[_0x3eec57(0x1e8),_0x3eec57(0x1e1)];const _0x2a2ab4=await sales[_0x3eec57(0x23a)]({}),_0x44cce0=_0x2a2ab4[_0x3eec57(0x1f1)]+0x1,_0x12418a=_0x3eec57(0x262)+_0x44cce0[_0x3eec57(0x2b8)]()[_0x3eec57(0x2b9)](0x5,'0');if(_0x41fbd9[0x0]['language']==_0x3eec57(0x1ec)){var _0x5c8209=users[_0x3eec57(0x258)];console['log'](_0x5c8209);}else{if(_0x41fbd9[0x0][_0x3eec57(0x261)]==_0x3eec57(0x216))var _0x5c8209=users['Hindi'];else{if(_0x41fbd9[0x0]['language']=='German')var _0x5c8209=users['German'];else{if(_0x41fbd9[0x0][_0x3eec57(0x261)]==_0x3eec57(0x264))var _0x5c8209=users[_0x3eec57(0x264)];else{if(_0x41fbd9[0x0][_0x3eec57(0x261)]==_0x3eec57(0x1fb))var _0x5c8209=users[_0x3eec57(0x1fb)];else{if(_0x41fbd9[0x0][_0x3eec57(0x261)]==_0x3eec57(0x265))var _0x5c8209=users['Portuguese'];else{if(_0x41fbd9[0x0][_0x3eec57(0x261)]==_0x3eec57(0x1e6))var _0x5c8209=users[_0x3eec57(0x1e6)];else{if(_0x41fbd9[0x0][_0x3eec57(0x261)]==_0x3eec57(0x24a))var _0x5c8209=users[_0x3eec57(0x230)];}}}}}}}const _0x210f8c=getRandom8DigitNumber();_0x210f8c[_0x3eec57(0x2b7)](_0x35ec7f=>{var _0x5c7651=_0x3eec57;_0x3adc76[_0x5c7651(0x1b6)](_0x5c7651(0x1c2),{'success':_0x1efdf3['flash'](_0x5c7651(0x1f0)),'errors':_0x1efdf3['flash'](_0x5c7651(0x251)),'role':_0x1c150a,'profile':_0x447027,'customer':_0x17cc9a,'warehouse':_0x169857,'product':_0x43120c,'invoice':_0x35ec7f,'master_shop':_0x41fbd9,'language':_0x5c8209,'rooms_data':_0x50ed8c});})[_0x3eec57(0x2b5)](_0x12a7da=>{var _0x22fc4a=_0x3eec57;_0x1efdf3[_0x22fc4a(0x29c)]('errors',_0x22fc4a(0x282)),_0x3adc76[_0x22fc4a(0x2a7)]('/all_sales/view');});}catch(_0x215da){console[_0x3eec57(0x1d6)](_0x215da);}}),router['get'](a0_0x1ca151(0x209),auth,async(_0x1037d2,_0x307f37)=>{var _0x439c9a=a0_0x1ca151;try{const _0x173dac=_0x1037d2[_0x439c9a(0x218)]['id'];console[_0x439c9a(0x1d6)](_0x173dac);const _0x20086f=await product[_0x439c9a(0x23a)](),_0x10ba9f=await purchases[_0x439c9a(0x22f)]([{'$match':{'warehouse_name':_0x173dac}},{'$unwind':_0x439c9a(0x1cc)},{'$group':{'_id':_0x439c9a(0x1ad)}}]);console[_0x439c9a(0x1d6)](_0x439c9a(0x1f3),_0x10ba9f),_0x307f37[_0x439c9a(0x1e3)](0xc8)[_0x439c9a(0x1f7)]({'purchases_data':_0x10ba9f,'product_data':_0x20086f});}catch(_0x3074c0){console[_0x439c9a(0x1d6)](_0x3074c0);}}),router['post'](a0_0x1ca151(0x280),auth,async(_0x5dd664,_0x2b0431)=>{var _0x3e1e0a=a0_0x1ca151;try{const {warehouse_data:_0x48d9fa,product_data:_0x29beb9}=_0x5dd664[_0x3e1e0a(0x26f)];console[_0x3e1e0a(0x1d6)](_0x5dd664[_0x3e1e0a(0x26f)][_0x3e1e0a(0x274)]);;const _0x52ac0d=await master_shop[_0x3e1e0a(0x23a)]();console[_0x3e1e0a(0x1d6)]('master',_0x52ac0d);const _0x579df2=await product[_0x3e1e0a(0x1dc)]({'name':_0x29beb9});console[_0x3e1e0a(0x1d6)]('product',_0x579df2);const _0x264cf2=await warehouse['aggregate']([{'$match':{'name':_0x48d9fa}},{'$unwind':_0x3e1e0a(0x1c9)},{'$match':{'product_details.product_name':_0x29beb9}},{'$group':{'_id':_0x3e1e0a(0x211),'product_stock':{'$first':_0x3e1e0a(0x240)}}}]);console[_0x3e1e0a(0x1d6)]('stock_data',_0x264cf2),_0x2b0431[_0x3e1e0a(0x1e3)](0xc8)[_0x3e1e0a(0x1f7)]({'master':_0x52ac0d,'new_product':_0x579df2,'stock_data':_0x264cf2});}catch(_0x475327){console[_0x3e1e0a(0x1d6)](_0x475327);}}),router[a0_0x1ca151(0x28d)](a0_0x1ca151(0x295),auth,async(_0x2113f2,_0x1b875f)=>{var _0x5e7fa9=a0_0x1ca151;try{const {invoice:_0x48a4f4,date:_0x31f35f,warehouse_name:_0x430f4e,product_name:_0xe934e1,stock:_0x21dc2b,quantity:_0x352042,note:_0x4ebbcd,room:_0x4ddd29,primary_code:_0x37da3e,secondary_code:_0x32e00f,prod_code:_0x322a54,level:_0x382a58,isle:_0xb63c86,pallet:_0xf7f02d,batch_code:_0x20d9c4,SCRN:_0x42e30c,expiry_date:_0x390f95}=_0x2113f2[_0x5e7fa9(0x26f)];if(typeof _0xe934e1==_0x5e7fa9(0x217))var _0xa759c=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x237)]],_0x38efc6=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x297)]],_0xa3923d=[_0x2113f2[_0x5e7fa9(0x26f)]['carton']],_0x52f40b=[_0x2113f2['body']['primary_code']],_0x23dea2=[_0x2113f2[_0x5e7fa9(0x26f)]['secondary_code']],_0x480995=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x2b0)]],_0x497af9=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x267)]],_0x4e959d=[_0x2113f2[_0x5e7fa9(0x26f)]['primary_unit']],_0x399339=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1a7)]],_0x11f69a=[_0x2113f2[_0x5e7fa9(0x26f)]['batch_code']],_0xd7dbe3=[_0x2113f2['body']['expiry_date']],_0x2e094e=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1de)]],_0x4aa80f=[_0x2113f2[_0x5e7fa9(0x26f)]['production_date']],_0x32af88=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1c6)]],_0x6da461=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x288)]],_0x3e0332=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x287)]],_0x52e416=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1b7)]],_0x44a865=[_0x2113f2['body'][_0x5e7fa9(0x1d2)]],_0x4c8e4b=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x214)]],_0x5a7973=[_0x2113f2[_0x5e7fa9(0x26f)]['prod_invoice']],_0x4b54f6=[_0x2113f2[_0x5e7fa9(0x26f)]['actual_qty']],_0x5c74a7=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x25b)]],_0x316f62=[_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x2af)]];else var _0xa759c=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x237)]],_0x38efc6=[..._0x2113f2['body'][_0x5e7fa9(0x297)]],_0xa3923d=[..._0x2113f2['body'][_0x5e7fa9(0x1f8)]],_0x52f40b=[..._0x2113f2['body']['primary_code']],_0x23dea2=[..._0x2113f2[_0x5e7fa9(0x26f)]['secondary_code']],_0x480995=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x2b0)]],_0x497af9=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x267)]],_0x4e959d=[..._0x2113f2['body'][_0x5e7fa9(0x29d)]],_0x399339=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1a7)]],_0x11f69a=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x28b)]],_0xd7dbe3=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x26b)]],_0x2e094e=[..._0x2113f2[_0x5e7fa9(0x26f)]['max_per_unit']],_0x4aa80f=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x29e)]],_0x32af88=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1c6)]],_0x6da461=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x288)]],_0x3e0332=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x287)]],_0x52e416=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1b7)]],_0x44a865=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1d2)]],_0x4c8e4b=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x214)]],_0x5a7973=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x27b)]],_0x4b54f6=[..._0x2113f2[_0x5e7fa9(0x26f)]['actual_qty']],_0x5c74a7=[..._0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x25b)]],_0x316f62=[..._0x2113f2['body'][_0x5e7fa9(0x2af)]];const _0x5105a7=_0xa759c[_0x5e7fa9(0x239)](_0x56cd94=>{return _0x56cd94={'product_name':_0x56cd94};});_0x38efc6['forEach']((_0x2a2f55,_0x573afd)=>{var _0x577254=_0x5e7fa9;_0x5105a7[_0x573afd][_0x577254(0x297)]=Math[_0x577254(0x246)](_0x2a2f55);}),_0x4b54f6['forEach']((_0x2772e0,_0x47e13f)=>{var _0xc242ab=_0x5e7fa9;_0x5105a7[_0x47e13f][_0xc242ab(0x1d0)]=Math[_0xc242ab(0x246)](_0x2772e0);}),_0x5c74a7['forEach']((_0x4047c2,_0x3371d7)=>{_0x5105a7[_0x3371d7]['actual_uom']=_0x4047c2;}),_0x316f62[_0x5e7fa9(0x222)]((_0x4ab129,_0x36b9d7)=>{var _0x13ad84=_0x5e7fa9;_0x5105a7[_0x36b9d7][_0x13ad84(0x1bd)]=_0x4ab129;}),_0xa3923d[_0x5e7fa9(0x222)]((_0xbeb376,_0x2b7708)=>{var _0x260125=_0x5e7fa9;_0x5105a7[_0x2b7708][_0x260125(0x1d2)]=_0xbeb376;}),_0x52f40b['forEach']((_0x28f2cc,_0x2a11ea)=>{var _0x38366e=_0x5e7fa9;_0x5105a7[_0x2a11ea][_0x38366e(0x28a)]=_0x28f2cc;}),_0x23dea2[_0x5e7fa9(0x222)]((_0x430e13,_0x230d70)=>{_0x5105a7[_0x230d70]['secondary_code']=_0x430e13;}),_0x480995['forEach']((_0x4352c4,_0x2e443a)=>{var _0x2dc193=_0x5e7fa9;_0x5105a7[_0x2e443a][_0x2dc193(0x224)]=_0x4352c4;}),_0x497af9['forEach']((_0xe89b47,_0x3ac2c0)=>{_0x4c8e4b['forEach']((_0x1f8115,_0x45aebb)=>{var _0x189f4c=a0_0x3457;if(_0x1f8115==_0x189f4c(0x1f5)&&_0x3ac2c0==_0x45aebb){var _0xce9740=_0xe89b47[_0x189f4c(0x28e)](0x3);_0x5105a7[_0x3ac2c0]['storage']=_0xe89b47[0x0],_0x5105a7[_0x3ac2c0][_0x189f4c(0x1ba)]=_0xe89b47[0x1],_0x5105a7[_0x3ac2c0][_0x189f4c(0x25c)]=0x0,_0x5105a7[_0x3ac2c0][_0x189f4c(0x276)]=0x0,_0x5105a7[_0x3ac2c0][_0x189f4c(0x289)]=_0x189f4c(0x235),_0x5105a7[_0x3ac2c0][_0x189f4c(0x248)]=_0xce9740;}else{if(_0x1f8115==_0x189f4c(0x26e)&&_0x3ac2c0==_0x45aebb){var _0xce9740=_0xe89b47['slice'](0x3);_0x5105a7[_0x3ac2c0][_0x189f4c(0x1a5)]=_0xe89b47[0x0],_0x5105a7[_0x3ac2c0][_0x189f4c(0x1ba)]=_0xe89b47[0x1],_0x5105a7[_0x3ac2c0][_0x189f4c(0x25c)]=0x0,_0x5105a7[_0x3ac2c0][_0x189f4c(0x276)]=0x0,_0x5105a7[_0x3ac2c0]['type']=_0x189f4c(0x235),_0x5105a7[_0x3ac2c0]['floorlevel']=_0xe89b47[0x5];}else{if(_0x3ac2c0==_0x45aebb){var _0x4a6b2c;if(_0xe89b47[0x4]=='L')_0x4a6b2c=_0x189f4c(0x273);else _0xe89b47[0x4]=='F'&&(_0x4a6b2c=_0x189f4c(0x235));_0x5105a7[_0x3ac2c0][_0x189f4c(0x1a5)]=_0xe89b47[0x0],_0x5105a7[_0x3ac2c0][_0x189f4c(0x1ba)]=_0xe89b47[0x1],_0x5105a7[_0x3ac2c0][_0x189f4c(0x25c)]=_0xe89b47[0x2],_0x5105a7[_0x3ac2c0][_0x189f4c(0x276)]=_0xe89b47[0x3],_0x5105a7[_0x3ac2c0]['type']=_0x4a6b2c,_0x5105a7[_0x3ac2c0][_0x189f4c(0x248)]=_0xe89b47[0x5];}}}});}),_0x4e959d[_0x5e7fa9(0x222)]((_0x52a4b8,_0x313a8c)=>{var _0x20dc03=_0x5e7fa9;_0x5105a7[_0x313a8c][_0x20dc03(0x283)]=_0x52a4b8;}),_0x399339[_0x5e7fa9(0x222)]((_0x3e6703,_0x84115d)=>{var _0x4c3251=_0x5e7fa9;_0x5105a7[_0x84115d][_0x4c3251(0x1a7)]=_0x3e6703;}),_0x11f69a['forEach']((_0x2734df,_0x2fc909)=>{_0x5105a7[_0x2fc909]['batch_code']=_0x2734df;}),_0xd7dbe3['forEach']((_0x22a399,_0x512662)=>{var _0x315187=_0x5e7fa9;_0x5105a7[_0x512662][_0x315187(0x26b)]=_0x22a399;}),_0x2e094e[_0x5e7fa9(0x222)]((_0x2020cc,_0x2c67fd)=>{var _0x8beaa=_0x5e7fa9;_0x5105a7[_0x2c67fd][_0x8beaa(0x26a)]=_0x2020cc;}),_0x4aa80f[_0x5e7fa9(0x222)]((_0x4da998,_0x3a94ed)=>{var _0x2ad5ff=_0x5e7fa9;_0x5105a7[_0x3a94ed][_0x2ad5ff(0x29e)]=_0x4da998;}),_0x32af88[_0x5e7fa9(0x222)]((_0x4ec599,_0x4ed027)=>{var _0xe492f=_0x5e7fa9;_0x5105a7[_0x4ed027][_0xe492f(0x1c6)]=_0x4ec599;}),_0x6da461['forEach']((_0x213916,_0xf6dcda)=>{var _0x4d1f33=_0x5e7fa9;_0x5105a7[_0xf6dcda][_0x4d1f33(0x288)]=_0x213916;}),_0x3e0332['forEach']((_0x2d7ecf,_0x24f285)=>{var _0x5c3248=_0x5e7fa9;_0x5105a7[_0x24f285][_0x5c3248(0x287)]=_0x2d7ecf;}),_0x52e416[_0x5e7fa9(0x222)]((_0x30e3a2,_0x20d662)=>{var _0x95595f=_0x5e7fa9;_0x5105a7[_0x20d662][_0x95595f(0x1b7)]=_0x30e3a2;}),_0x44a865[_0x5e7fa9(0x222)]((_0x212825,_0x46faee)=>{var _0x41870c=_0x5e7fa9;_0x5105a7[_0x46faee][_0x41870c(0x2ae)]=_0x212825;}),_0x4c8e4b[_0x5e7fa9(0x222)]((_0x5f3a33,_0x1d4643)=>{_0x5105a7[_0x1d4643]['room_name']=_0x5f3a33;}),_0x5a7973['forEach']((_0x3e9379,_0x174e64)=>{_0x5105a7[_0x174e64]['invoice']=_0x3e9379;});var _0x209cfb=0x0;_0x5105a7[_0x5e7fa9(0x222)](_0x15abc5=>{var _0x40c21a=_0x5e7fa9;(_0x15abc5[_0x40c21a(0x297)]<_0x15abc5[_0x40c21a(0x2ae)]||_0x15abc5[_0x40c21a(0x2ae)]==0x0)&&(console[_0x40c21a(0x1d6)](_0x40c21a(0x256),_0x15abc5),_0x209cfb++);});const _0x1e769c=_0x5105a7[_0x5e7fa9(0x1ca)](_0xd8ad8a=>_0xd8ad8a[_0x5e7fa9(0x1d2)]!=='0'&&_0xd8ad8a['quantity']!==''),_0x239600=new sales({'invoice':_0x48a4f4,'customer':_0x2113f2[_0x5e7fa9(0x26f)][_0x5e7fa9(0x1a6)],'date':_0x31f35f,'warehouse_name':_0x430f4e,'sale_product':_0x1e769c,'note':_0x4ebbcd,'room':_0x4ddd29,'primary_code':_0x37da3e,'secondary_code':_0x32e00f,'prod_code':_0x322a54,'SCRN':_0x42e30c}),_0x523fb5=await _0x239600[_0x5e7fa9(0x1c8)]();_0x2113f2[_0x5e7fa9(0x29c)]('success',_0x5e7fa9(0x1b0)),_0x1b875f[_0x5e7fa9(0x2a7)]('/all_sales/preview/'+_0x523fb5[_0x5e7fa9(0x29a)]);}catch(_0x3c5cd0){console[_0x5e7fa9(0x1d6)](_0x3c5cd0);}}),router[a0_0x1ca151(0x242)]('/preview/:id',auth,async(_0x4393f6,_0x515318)=>{var _0x1b638d=a0_0x1ca151;try{const {username:_0x5aa094,email:_0x40b80c,role:_0x50609b}=_0x4393f6[_0x1b638d(0x227)],_0x323665=_0x4393f6[_0x1b638d(0x227)],_0x33b2d7=await profile[_0x1b638d(0x1dc)]({'email':_0x323665[_0x1b638d(0x2a9)]}),_0x25b171=await master_shop[_0x1b638d(0x23a)](),_0x441740=_0x4393f6[_0x1b638d(0x218)]['id'],_0x3de096=await sales[_0x1b638d(0x1cf)](_0x441740),_0x4e1e72=await warehouse['aggregate']([{'$match':{'name':_0x3de096[_0x1b638d(0x24b)]}},{'$unwind':_0x1b638d(0x1c9)},{'$group':{'_id':_0x1b638d(0x1ee),'name':{'$first':_0x1b638d(0x211)},'product_stock':{'$first':_0x1b638d(0x240)},'bay':{'$first':_0x1b638d(0x1cd)},'bin':{'$first':_0x1b638d(0x27c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1b638d(0x21f)},'primary_code':{'$first':_0x1b638d(0x1d1)},'secondary_code':{'$first':_0x1b638d(0x1eb)},'product_code':{'$first':_0x1b638d(0x206)},'storage':{'$first':_0x1b638d(0x28c)},'rack':{'$first':_0x1b638d(0x23f)},'expiry_date':{'$first':_0x1b638d(0x1e4)},'production_date':{'$first':_0x1b638d(0x2a2)},'invoice':{'$first':_0x1b638d(0x25a)}}}]),_0x1ad616=await customer['find']({});let _0x27f147;if(_0x323665[_0x1b638d(0x1bc)]==_0x1b638d(0x281)){const _0x3ea95c=await staff['findOne']({'email':_0x323665[_0x1b638d(0x2a9)]});_0x27f147=await warehouse[_0x1b638d(0x22f)]([{'$match':{'status':_0x1b638d(0x290),'name':_0x3ea95c[_0x1b638d(0x285)]}},{'$group':{'_id':_0x1b638d(0x298),'name':{'$first':_0x1b638d(0x298)}}}]);}else _0x27f147=await warehouse[_0x1b638d(0x22f)]([{'$match':{'status':_0x1b638d(0x290)}},{'$group':{'_id':_0x1b638d(0x298),'name':{'$first':_0x1b638d(0x298)}}}]);const _0x44e7eb=await product['find']({}),_0x202a7d=await suppliers[_0x1b638d(0x23a)]({});if(_0x25b171[0x0]['language']==_0x1b638d(0x1ec)){var _0x1a91ab=users[_0x1b638d(0x258)];console[_0x1b638d(0x1d6)](_0x1a91ab);}else{if(_0x25b171[0x0][_0x1b638d(0x261)]=='Hindi')var _0x1a91ab=users[_0x1b638d(0x216)];else{if(_0x25b171[0x0][_0x1b638d(0x261)]==_0x1b638d(0x1ef))var _0x1a91ab=users[_0x1b638d(0x1ef)];else{if(_0x25b171[0x0]['language']=='Spanish')var _0x1a91ab=users[_0x1b638d(0x264)];else{if(_0x25b171[0x0][_0x1b638d(0x261)]==_0x1b638d(0x1fb))var _0x1a91ab=users['French'];else{if(_0x25b171[0x0][_0x1b638d(0x261)]==_0x1b638d(0x265))var _0x1a91ab=users[_0x1b638d(0x1c0)];else{if(_0x25b171[0x0][_0x1b638d(0x261)]==_0x1b638d(0x1e6))var _0x1a91ab=users['Chinese'];else{if(_0x25b171[0x0][_0x1b638d(0x261)]==_0x1b638d(0x24a))var _0x1a91ab=users[_0x1b638d(0x230)];}}}}}}}_0x515318[_0x1b638d(0x1b6)](_0x1b638d(0x271),{'success':_0x4393f6[_0x1b638d(0x29c)](_0x1b638d(0x1f0)),'errors':_0x4393f6[_0x1b638d(0x29c)](_0x1b638d(0x251)),'role':_0x323665,'profile':_0x33b2d7,'customer':_0x1ad616,'warehouse':_0x27f147,'product':_0x4e1e72,'user':_0x3de096,'master_shop':_0x25b171,'unit':_0x44e7eb,'language':_0x1a91ab,'suppliers':_0x202a7d});}catch(_0x1c3174){console[_0x1b638d(0x1d6)](_0x1c3174);}}),router[a0_0x1ca151(0x28d)](a0_0x1ca151(0x24f),auth,async(_0x167e14,_0x43f6d0)=>{var _0x31dfb7=a0_0x1ca151;try{const _0x5d0348=_0x167e14['params']['id'],{invoice:_0x1c37bb,warehouse_name:_0x43263e,room:_0x43723d}=_0x167e14['body'],_0x1daf8c=await sales['findOne']({'invoice':_0x1c37bb}),_0x5279fe=_0x1daf8c[_0x31dfb7(0x292)][_0x31dfb7(0x239)](async _0x3a8fd7=>{var _0x2bd6e7=_0x31dfb7,_0x3e1656=await warehouse['findOne']({'name':_0x43263e,'room':_0x3a8fd7[_0x2bd6e7(0x253)],'warehouse_category':_0x2bd6e7(0x22b)});const _0x2c26e3=_0x3e1656[_0x2bd6e7(0x21c)]['map'](_0x11e898=>{var _0x55a12e=_0x2bd6e7;_0x11e898[_0x55a12e(0x237)]==_0x3a8fd7[_0x55a12e(0x237)]&&_0x11e898[_0x55a12e(0x248)]==_0x3a8fd7[_0x55a12e(0x248)]&&_0x11e898[_0x55a12e(0x289)]==_0x3a8fd7[_0x55a12e(0x289)]&&_0x11e898[_0x55a12e(0x276)]==_0x3a8fd7['bin']&&_0x11e898[_0x55a12e(0x25c)]==_0x3a8fd7[_0x55a12e(0x25c)]&&_0x11e898[_0x55a12e(0x1ba)]==_0x3a8fd7[_0x55a12e(0x1ba)]&&_0x11e898[_0x55a12e(0x1a5)]==_0x3a8fd7['storage']&&_0x11e898['expiry_date']==_0x3a8fd7[_0x55a12e(0x26b)]&&_0x11e898[_0x55a12e(0x28b)]==_0x3a8fd7['batch_code']&&_0x11e898[_0x55a12e(0x1ce)]==_0x3a8fd7[_0x55a12e(0x1ce)]&&_0x11e898[_0x55a12e(0x29a)]==_0x3a8fd7[_0x55a12e(0x1bd)]&&(_0x11e898[_0x55a12e(0x22d)]=Math[_0x55a12e(0x2ad)](0x0,Math['abs'](_0x11e898[_0x55a12e(0x22d)])-Math[_0x55a12e(0x246)](_0x3a8fd7[_0x55a12e(0x1d2)])));});return _0x3e1656;});Promise[_0x31dfb7(0x269)](_0x5279fe)[_0x31dfb7(0x2b7)](async _0x3eba55=>{var _0x4865d8=_0x31dfb7;try{for(const _0x1f60e6 of _0x3eba55){await _0x1f60e6[_0x4865d8(0x1c8)]();}_0x1daf8c[_0x4865d8(0x1bf)]=_0x4865d8(0x24c);const _0x26be1d=await _0x1daf8c[_0x4865d8(0x1c8)](),_0x142cb4=await master_shop[_0x4865d8(0x23a)](),_0xf6cf62=await email_settings[_0x4865d8(0x1dc)](),_0x3e7277=await supervisor_settings[_0x4865d8(0x23a)]();var _0x5c7a5c=_0x1daf8c[_0x4865d8(0x292)],_0x364fc2='',_0x3d3398;for(_0x3d3398 in _0x5c7a5c){_0x364fc2+=_0x4865d8(0x1cb)+_0x4865d8(0x1a9)+_0x5c7a5c[_0x3d3398][_0x4865d8(0x237)]+_0x4865d8(0x2a8)+_0x4865d8(0x1a9)+_0x5c7a5c[_0x3d3398][_0x4865d8(0x224)]+_0x4865d8(0x2a8)+_0x4865d8(0x1a9)+_0x5c7a5c[_0x3d3398][_0x4865d8(0x1d2)]+_0x4865d8(0x2a8)+_0x4865d8(0x1a9)+_0x5c7a5c[_0x3d3398][_0x4865d8(0x283)]+_0x4865d8(0x2a8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c7a5c[_0x3d3398]['secondary_unit']+_0x4865d8(0x2a8)+_0x4865d8(0x1a9)+_0x1daf8c[_0x4865d8(0x24b)]+_0x4865d8(0x2a8)+_0x4865d8(0x1a9)+_0x5c7a5c[_0x3d3398]['room_name']+_0x4865d8(0x2a8)+_0x4865d8(0x1a9)+_0x5c7a5c[_0x3d3398][_0x4865d8(0x1a5)]+_0x5c7a5c[_0x3d3398][_0x4865d8(0x1ba)]+_0x5c7a5c[_0x3d3398][_0x4865d8(0x25c)]+_0x5c7a5c[_0x3d3398][_0x4865d8(0x276)]+_0x5c7a5c[_0x3d3398][_0x4865d8(0x289)][0x0]+_0x5c7a5c[_0x3d3398]['floorlevel']+'</td>','</tr>';}let _0x363791=nodemailer[_0x4865d8(0x21d)]({'host':_0xf6cf62[_0x4865d8(0x2ac)],'port':Number(_0xf6cf62[_0x4865d8(0x225)]),'secure':![],'auth':{'user':_0xf6cf62[_0x4865d8(0x2a9)],'pass':_0xf6cf62[_0x4865d8(0x1b4)]}}),_0x332d64={'from':_0xf6cf62[_0x4865d8(0x2a9)],'to':_0x3e7277[0x0][_0x4865d8(0x255)],'subject':_0x4865d8(0x28f),'attachments':[{'filename':_0x4865d8(0x2b4),'path':__dirname+_0x4865d8(0x257)+_0x4865d8(0x26c)+_0x142cb4[0x0][_0x4865d8(0x2b2)],'cid':'logo'}],'html':_0x4865d8(0x1fe)+_0x4865d8(0x1b3)+'</head><body>'+'<div>'+_0x4865d8(0x1c7)+'<div>'+_0x4865d8(0x212)+_0x4865d8(0x220)+_0x4865d8(0x245)+_0x4865d8(0x1f2)+_0x142cb4[0x0][_0x4865d8(0x1ed)]+_0x4865d8(0x1a4)+_0x4865d8(0x220)+_0x4865d8(0x220)+_0x4865d8(0x29b)+_0x4865d8(0x245)+_0x4865d8(0x241)+_0x4865d8(0x21b)+_0x1daf8c[_0x4865d8(0x1ce)]+'\x20'+_0x4865d8(0x1a8)+'\x20Order\x20Date\x20:\x20'+_0x1daf8c[_0x4865d8(0x2bc)]+'\x20'+_0x4865d8(0x22c)+_0x4865d8(0x23e)+_0x4865d8(0x220)+_0x4865d8(0x1b8)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4865d8(0x1cb)+_0x4865d8(0x2ba)+_0x4865d8(0x233)+_0x4865d8(0x210)+_0x4865d8(0x270)+_0x4865d8(0x1e7)+_0x4865d8(0x1db)+_0x4865d8(0x1df)+_0x4865d8(0x2b6)+_0x4865d8(0x204)+_0x4865d8(0x238)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x364fc2+'\x20'+_0x4865d8(0x1ea)+_0x4865d8(0x27e)+'<div>'+_0x4865d8(0x29f)+'<h5>'+_0x142cb4[0x0][_0x4865d8(0x1ed)]+_0x4865d8(0x23e)+_0x4865d8(0x220)+_0x4865d8(0x220)+_0x4865d8(0x279)};_0x363791[_0x4865d8(0x1c1)](_0x332d64,function(_0x327a1a,_0x139c00){var _0x102e03=_0x4865d8;_0x327a1a?(console['log'](_0x327a1a),console[_0x102e03(0x1d6)](_0x102e03(0x1da))):console[_0x102e03(0x1d6)]('Email\x20sent\x20successfully');}),_0x167e14[_0x4865d8(0x29c)](_0x4865d8(0x1f0),'Sales\x20Update\x20successfully'),_0x43f6d0[_0x4865d8(0x2a7)](_0x4865d8(0x1f4)+_0x5d0348);}catch(_0x1bbdc2){console[_0x4865d8(0x1ff)](_0x1bbdc2),_0x43f6d0[_0x4865d8(0x1e3)](0x1f4)[_0x4865d8(0x1f7)]({'error':_0x4865d8(0x1e5)});}})[_0x31dfb7(0x2b5)](_0x305c46=>{var _0xc1e75f=_0x31dfb7;console[_0xc1e75f(0x1ff)](_0x305c46),_0x43f6d0[_0xc1e75f(0x1e3)](0x1f4)[_0xc1e75f(0x1f7)]({'error':_0xc1e75f(0x20a)});});}catch(_0x30ee0c){console['log'](_0x30ee0c);}}),router[a0_0x1ca151(0x242)](a0_0x1ca151(0x299),auth,async(_0x422ae8,_0x23998e)=>{var _0x31b887=a0_0x1ca151;try{const {username:_0x2f9066,email:_0xd81136,role:_0x5e5574}=_0x422ae8['user'],_0x351046=_0x422ae8['user'],_0x4cc34b=await profile[_0x31b887(0x1dc)]({'email':_0x351046[_0x31b887(0x2a9)]}),_0x4909ae=await master_shop[_0x31b887(0x23a)](),_0xd32b=_0x422ae8[_0x31b887(0x218)]['id'],_0x2af293=await sales['findById'](_0xd32b);var _0x49b87a=[_0x31b887(0x1e8),_0x31b887(0x1e1)];const _0x3c131=await warehouse[_0x31b887(0x22f)]([{'$match':{'name':_0x2af293[_0x31b887(0x24b)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x31b887(0x1c9)},{'$group':{'_id':_0x31b887(0x1ee),'name':{'$first':_0x31b887(0x211)},'product_stock':{'$first':_0x31b887(0x240)},'bay':{'$first':_0x31b887(0x1cd)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x31b887(0x1d1)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x31b887(0x206)},'storage':{'$first':_0x31b887(0x28c)},'rack':{'$first':'$product_details.rack'}}}]),_0x548ddb=await customer[_0x31b887(0x23a)]({});let _0x268f91;if(_0x351046[_0x31b887(0x1bc)]==_0x31b887(0x281)){const _0x4c0030=await staff[_0x31b887(0x1dc)]({'email':_0x351046[_0x31b887(0x2a9)]});_0x268f91=await warehouse['aggregate']([{'$match':{'status':_0x31b887(0x290),'name':_0x4c0030[_0x31b887(0x285)],'warehouse_category':_0x31b887(0x22b)}},{'$group':{'_id':_0x31b887(0x298),'name':{'$first':_0x31b887(0x298)}}}]);}else _0x268f91=await warehouse[_0x31b887(0x22f)]([{'$match':{'status':_0x31b887(0x290),'warehouse_category':_0x31b887(0x22b)}},{'$group':{'_id':'$name','name':{'$first':_0x31b887(0x298)}}}]);const _0x2a0745=await product[_0x31b887(0x23a)]({});if(_0x4909ae[0x0][_0x31b887(0x261)]==_0x31b887(0x1ec)){var _0x56b52c=users[_0x31b887(0x258)];console['log'](_0x56b52c);}else{if(_0x4909ae[0x0][_0x31b887(0x261)]=='Hindi')var _0x56b52c=users['Hindi'];else{if(_0x4909ae[0x0]['language']==_0x31b887(0x1ef))var _0x56b52c=users['German'];else{if(_0x4909ae[0x0]['language']==_0x31b887(0x264))var _0x56b52c=users[_0x31b887(0x264)];else{if(_0x4909ae[0x0]['language']=='French')var _0x56b52c=users[_0x31b887(0x1fb)];else{if(_0x4909ae[0x0][_0x31b887(0x261)]==_0x31b887(0x265))var _0x56b52c=users[_0x31b887(0x1c0)];else{if(_0x4909ae[0x0][_0x31b887(0x261)]==_0x31b887(0x1e6))var _0x56b52c=users[_0x31b887(0x1e6)];else{if(_0x4909ae[0x0][_0x31b887(0x261)]=='Arabic\x20(ae)')var _0x56b52c=users[_0x31b887(0x230)];}}}}}}}_0x23998e[_0x31b887(0x1b6)]('edit_sales',{'success':_0x422ae8[_0x31b887(0x29c)](_0x31b887(0x1f0)),'errors':_0x422ae8[_0x31b887(0x29c)](_0x31b887(0x251)),'role':_0x351046,'profile':_0x4cc34b,'customer':_0x548ddb,'warehouse':_0x268f91,'product':_0x3c131,'user':_0x2af293,'master_shop':_0x4909ae,'unit':_0x2a0745,'language':_0x56b52c});}catch(_0x4fc502){console[_0x31b887(0x1d6)](_0x4fc502);}}),router[a0_0x1ca151(0x28d)](a0_0x1ca151(0x299),auth,async(_0x1f2aba,_0x144382)=>{var _0xa8cb6d=a0_0x1ca151;try{const _0x2516b4=_0x1f2aba['params']['id'],_0x3287ac=await sales['findOne']({'_id':_0x1f2aba[_0xa8cb6d(0x218)]['id']}),_0x3ab45e=await warehouse['findOne']({'name':_0x3287ac[_0xa8cb6d(0x24b)],'room':_0x1f2aba['body'][_0xa8cb6d(0x2a3)]}),{invoice:_0x26823e,date:_0x2208bd,warehouse_name:_0x82cf45,product_name:_0x63399f,stock:_0x57273e,quantity:_0x482664,note:_0x3e9183,room:_0x4b359f,customer:_0x1e761b,SCRN:_0x55c691}=_0x1f2aba[_0xa8cb6d(0x26f)];if(typeof _0x63399f=='string')var _0x18fb80=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x237)]],_0x2ecf7d=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x297)]],_0xcaec5=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1f8)]],_0x2b4c1c=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x28a)]],_0x4575dc=[_0x1f2aba[_0xa8cb6d(0x26f)]['secondary_code']],_0x2cd8e1=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x2b0)]],_0x18b646=[_0x1f2aba[_0xa8cb6d(0x26f)]['level']],_0xe16d3a=[_0x1f2aba['body'][_0xa8cb6d(0x29d)]],_0xcb5e3b=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1a7)]],_0x401a0d=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x28b)]],_0x31710a=[_0x1f2aba[_0xa8cb6d(0x26f)]['expiry_date']],_0x80cd10=[_0x1f2aba['body']['max_per_unit']],_0x12b110=[_0x1f2aba[_0xa8cb6d(0x26f)]['production_date']],_0x4d891=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1c6)]],_0x25893c=[_0x1f2aba[_0xa8cb6d(0x26f)]['delivery_date']],_0x5cf922=[_0x1f2aba['body']['delivery_code']],_0x2d8faa=[_0x1f2aba[_0xa8cb6d(0x26f)]['prod_cat']],_0x418be3=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1d2)]],_0x387a73=[_0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x214)]];else var _0x18fb80=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x237)]],_0x2ecf7d=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x297)]],_0xcaec5=[..._0x1f2aba['body'][_0xa8cb6d(0x1f8)]],_0x2b4c1c=[..._0x1f2aba['body']['primary_code']],_0x4575dc=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x259)]],_0x2cd8e1=[..._0x1f2aba['body'][_0xa8cb6d(0x2b0)]],_0x18b646=[..._0x1f2aba[_0xa8cb6d(0x26f)]['level']],_0xe16d3a=[..._0x1f2aba[_0xa8cb6d(0x26f)]['primary_unit']],_0xcb5e3b=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1a7)]],_0x401a0d=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x28b)]],_0x31710a=[..._0x1f2aba['body'][_0xa8cb6d(0x26b)]],_0x80cd10=[..._0x1f2aba[_0xa8cb6d(0x26f)]['max_per_unit']],_0x12b110=[..._0x1f2aba['body'][_0xa8cb6d(0x29e)]],_0x4d891=[..._0x1f2aba['body'][_0xa8cb6d(0x1c6)]],_0x25893c=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x288)]],_0x5cf922=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x287)]],_0x2d8faa=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1b7)]],_0x418be3=[..._0x1f2aba[_0xa8cb6d(0x26f)][_0xa8cb6d(0x1d2)]],_0x387a73=[..._0x1f2aba['body']['RoomAssigned']];const _0x205cde=_0x18fb80[_0xa8cb6d(0x239)](_0x18ac25=>{return _0x18ac25={'product_name':_0x18ac25};});_0x2ecf7d[_0xa8cb6d(0x222)]((_0x35e119,_0x5a502b)=>{var _0x4f1390=_0xa8cb6d;_0x205cde[_0x5a502b][_0x4f1390(0x297)]=Math[_0x4f1390(0x246)](_0x35e119);}),_0xcaec5[_0xa8cb6d(0x222)]((_0xc9748a,_0x41b998)=>{var _0xc6509e=_0xa8cb6d;_0x205cde[_0x41b998][_0xc6509e(0x1d2)]=_0xc9748a;}),_0x2b4c1c[_0xa8cb6d(0x222)]((_0x5eb23c,_0x19e2c7)=>{var _0x54af6c=_0xa8cb6d;_0x205cde[_0x19e2c7][_0x54af6c(0x28a)]=_0x5eb23c;}),_0x4575dc[_0xa8cb6d(0x222)]((_0x13e6c5,_0x36cf2c)=>{var _0x2bcdce=_0xa8cb6d;_0x205cde[_0x36cf2c][_0x2bcdce(0x259)]=_0x13e6c5;}),_0x2cd8e1[_0xa8cb6d(0x222)]((_0x11c5bc,_0xc21073)=>{var _0x50dbac=_0xa8cb6d;_0x205cde[_0xc21073][_0x50dbac(0x224)]=_0x11c5bc;}),_0x18b646['forEach']((_0x21b351,_0x3bdf75)=>{var _0x1f9520=_0xa8cb6d;_0x387a73[_0x1f9520(0x222)]((_0x18c848,_0x5b2b08)=>{var _0x3a9fa1=_0x1f9520;if(_0x18c848==_0x3a9fa1(0x1f5)&&_0x3bdf75==_0x5b2b08){var _0x25a528=_0x21b351[_0x3a9fa1(0x28e)](0x3);_0x205cde[_0x3bdf75][_0x3a9fa1(0x1a5)]=_0x21b351[0x0],_0x205cde[_0x3bdf75]['rack']=_0x21b351[0x1],_0x205cde[_0x3bdf75][_0x3a9fa1(0x25c)]=0x0,_0x205cde[_0x3bdf75][_0x3a9fa1(0x276)]=0x0,_0x205cde[_0x3bdf75]['type']='Floor',_0x205cde[_0x3bdf75]['floorlevel']=_0x25a528;}else{if(_0x18c848==_0x3a9fa1(0x26e)&&_0x3bdf75==_0x5b2b08){var _0x25a528=_0x21b351[_0x3a9fa1(0x28e)](0x3);_0x205cde[_0x3bdf75][_0x3a9fa1(0x1a5)]=_0x21b351[0x0],_0x205cde[_0x3bdf75][_0x3a9fa1(0x1ba)]=_0x21b351[0x1],_0x205cde[_0x3bdf75][_0x3a9fa1(0x25c)]=0x0,_0x205cde[_0x3bdf75][_0x3a9fa1(0x276)]=0x0,_0x205cde[_0x3bdf75]['type']=_0x3a9fa1(0x235),_0x205cde[_0x3bdf75][_0x3a9fa1(0x248)]=_0x21b351[0x5];}else{if(_0x3bdf75==_0x5b2b08){var _0xf44f27;if(_0x21b351[0x4]=='L')_0xf44f27='Level';else _0x21b351[0x4]=='F'&&(_0xf44f27='Floor');_0x205cde[_0x3bdf75][_0x3a9fa1(0x1a5)]=_0x21b351[0x0],_0x205cde[_0x3bdf75][_0x3a9fa1(0x1ba)]=_0x21b351[0x1],_0x205cde[_0x3bdf75]['bay']=_0x21b351[0x2],_0x205cde[_0x3bdf75][_0x3a9fa1(0x276)]=_0x21b351[0x3],_0x205cde[_0x3bdf75]['type']=_0xf44f27,_0x205cde[_0x3bdf75][_0x3a9fa1(0x248)]=_0x21b351[0x5];}}}});}),_0xe16d3a[_0xa8cb6d(0x222)]((_0x1779ed,_0x1e5043)=>{var _0x39db81=_0xa8cb6d;_0x205cde[_0x1e5043][_0x39db81(0x283)]=_0x1779ed;}),_0xcb5e3b[_0xa8cb6d(0x222)]((_0x510102,_0x49b5c3)=>{var _0x15a934=_0xa8cb6d;_0x205cde[_0x49b5c3][_0x15a934(0x1a7)]=_0x510102;}),_0x401a0d[_0xa8cb6d(0x222)]((_0x401936,_0x241e80)=>{var _0x539e29=_0xa8cb6d;_0x205cde[_0x241e80][_0x539e29(0x28b)]=_0x401936;}),_0x31710a[_0xa8cb6d(0x222)]((_0x5d8bfa,_0x217769)=>{var _0x4d3961=_0xa8cb6d;_0x205cde[_0x217769][_0x4d3961(0x26b)]=_0x5d8bfa;}),_0x80cd10[_0xa8cb6d(0x222)]((_0x44ecfa,_0xcc0557)=>{_0x205cde[_0xcc0557]['maxperunit']=_0x44ecfa;}),_0x12b110[_0xa8cb6d(0x222)]((_0x262738,_0x24161e)=>{var _0x1adc30=_0xa8cb6d;_0x205cde[_0x24161e][_0x1adc30(0x29e)]=_0x262738;}),_0x4d891[_0xa8cb6d(0x222)]((_0x1b8294,_0x2bf860)=>{var _0x57561f=_0xa8cb6d;_0x205cde[_0x2bf860][_0x57561f(0x1c6)]=Math[_0x57561f(0x246)](_0x1b8294);}),_0x25893c[_0xa8cb6d(0x222)]((_0x32e8af,_0x1601ad)=>{_0x205cde[_0x1601ad]['delivery_date']=_0x32e8af;}),_0x5cf922[_0xa8cb6d(0x222)]((_0xa46958,_0x3c37b9)=>{_0x205cde[_0x3c37b9]['delivery_code']=_0xa46958;}),_0x2d8faa['forEach']((_0x1fa8e0,_0x9b9972)=>{var _0x413005=_0xa8cb6d;_0x205cde[_0x9b9972][_0x413005(0x1b7)]=_0x1fa8e0;}),_0x418be3['forEach']((_0x51b262,_0x2ba73c)=>{var _0x5451b8=_0xa8cb6d;_0x205cde[_0x2ba73c][_0x5451b8(0x2ae)]=_0x51b262;}),_0x387a73['forEach']((_0x1bae66,_0x1b5603)=>{var _0x5efa86=_0xa8cb6d;_0x205cde[_0x1b5603][_0x5efa86(0x253)]=_0x1bae66;});var _0x39a4cd=0x0;_0x205cde[_0xa8cb6d(0x222)](_0x3e4e35=>{var _0x3d0e42=_0xa8cb6d;console[_0x3d0e42(0x1d6)]('foreach\x20newproduct',_0x3e4e35),(parseInt(_0x3e4e35[_0x3d0e42(0x297)])<parseInt(_0x3e4e35[_0x3d0e42(0x1d2)])||parseInt(_0x3e4e35[_0x3d0e42(0x1d2)])==0x0)&&_0x39a4cd++;});if(_0x39a4cd!=0x0)return _0x1f2aba[_0xa8cb6d(0x29c)](_0xa8cb6d(0x251),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x144382[_0xa8cb6d(0x2a7)]('back');const _0x39d2f6=_0x205cde['filter'](_0x4eb546=>_0x4eb546[_0xa8cb6d(0x1d2)]!=='0'&&_0x4eb546[_0xa8cb6d(0x1d2)]!=='');_0x3287ac[_0xa8cb6d(0x1ce)]=_0x26823e,_0x3287ac[_0xa8cb6d(0x1a6)]=_0x1e761b,_0x3287ac[_0xa8cb6d(0x2bc)]=_0x2208bd,_0x3287ac[_0xa8cb6d(0x24b)]=_0x82cf45,_0x3287ac[_0xa8cb6d(0x292)]=_0x39d2f6,_0x3287ac[_0xa8cb6d(0x20e)]=_0x3e9183,_0x3287ac[_0xa8cb6d(0x231)]=_0x55c691,_0x3287ac[_0xa8cb6d(0x1bf)]=_0xa8cb6d(0x21a),_0x3287ac[_0xa8cb6d(0x1d9)]=_0xa8cb6d(0x21a);const _0x12218a=await _0x3287ac['save']();_0x1f2aba[_0xa8cb6d(0x29c)]('success',_0xa8cb6d(0x1d3)),_0x144382['redirect']('/all_sales/view');}catch(_0xdcce00){console['log'](_0xdcce00);}}),router[a0_0x1ca151(0x28d)](a0_0x1ca151(0x205),auth,async(_0xe4d4c0,_0x581657)=>{var _0x1d1afa=a0_0x1ca151;try{const _0x38f40e=_0xe4d4c0['params']['id'],{invoice:_0x4b2222,customer:_0x34f297,receivable_amount:_0x57b19e,received_amount:_0x53f53c}=_0xe4d4c0[_0x1d1afa(0x26f)],_0x373df4=await sales[_0x1d1afa(0x1cf)](_0x38f40e);console[_0x1d1afa(0x1d6)](_0x373df4);var _0x19a7b5=_0x57b19e-_0x53f53c;console[_0x1d1afa(0x1d6)](_0x53f53c),_0x373df4[_0x1d1afa(0x252)]=parseFloat(_0x53f53c)+parseFloat(_0x373df4['received_amount']),_0x373df4[_0x1d1afa(0x2bd)]=_0x19a7b5,console[_0x1d1afa(0x1d6)](_0x373df4);const _0x2136d5=await _0x373df4['save'](),_0x10e1be=await c_payment_data[_0x1d1afa(0x1dc)]({'invoice':_0x4b2222});_0x10e1be[_0x1d1afa(0x2b1)]=_0x19a7b5,await _0x10e1be['save']();let _0x1d0f03=new Date(),_0x504658=('0'+_0x1d0f03[_0x1d1afa(0x202)]())['slice'](-0x2),_0xe49665=('0'+(_0x1d0f03['getMonth']()+0x1))[_0x1d1afa(0x28e)](-0x2),_0x183fdb=_0x1d0f03[_0x1d1afa(0x249)](),_0x540724=_0x183fdb+'-'+_0xe49665+'-'+_0x504658;const _0x4cae6e=new customer_payment({'invoice':_0x4b2222,'date':_0x183fdb+'-'+_0xe49665+'-'+_0x504658,'customer':_0x34f297,'reason':_0x1d1afa(0x22e),'amount':_0x53f53c}),_0x116210=await _0x4cae6e['save']();_0xe4d4c0[_0x1d1afa(0x29c)]('success',_0x1d1afa(0x1af)),_0x581657[_0x1d1afa(0x2a7)](_0x1d1afa(0x2b3));}catch(_0x5c549d){console[_0x1d1afa(0x1d6)](_0x5c549d);}}),router[a0_0x1ca151(0x242)](a0_0x1ca151(0x1fa),auth,async(_0x267c15,_0xab0f5f)=>{var _0x56d9da=a0_0x1ca151;try{const {username:_0x4c9125,email:_0x9058e5,role:_0x8bbf27}=_0x267c15[_0x56d9da(0x227)],_0x419eb7=_0x267c15['user'],_0x30f57b=await profile[_0x56d9da(0x1dc)]({'email':_0x419eb7['email']}),_0x44b56f=await master_shop[_0x56d9da(0x23a)]();console[_0x56d9da(0x1d6)]('master',_0x44b56f);const _0x5c39a1=_0x267c15[_0x56d9da(0x218)]['id'],_0x2fb854=await sales[_0x56d9da(0x1cf)](_0x5c39a1);console[_0x56d9da(0x1d6)](_0x2fb854);const _0x4b4bd1=await customer[_0x56d9da(0x1dc)]({'name':_0x2fb854[_0x56d9da(0x1a6)]});console[_0x56d9da(0x1d6)](_0x4b4bd1);if(_0x44b56f[0x0]['language']==_0x56d9da(0x1ec)){var _0x279a56=users['English'];console['log'](_0x279a56);}else{if(_0x44b56f[0x0][_0x56d9da(0x261)]=='Hindi')var _0x279a56=users[_0x56d9da(0x216)];else{if(_0x44b56f[0x0][_0x56d9da(0x261)]=='German')var _0x279a56=users[_0x56d9da(0x1ef)];else{if(_0x44b56f[0x0][_0x56d9da(0x261)]=='Spanish')var _0x279a56=users[_0x56d9da(0x264)];else{if(_0x44b56f[0x0][_0x56d9da(0x261)]==_0x56d9da(0x1fb))var _0x279a56=users[_0x56d9da(0x1fb)];else{if(_0x44b56f[0x0][_0x56d9da(0x261)]==_0x56d9da(0x265))var _0x279a56=users[_0x56d9da(0x1c0)];else{if(_0x44b56f[0x0][_0x56d9da(0x261)]==_0x56d9da(0x1e6))var _0x279a56=users['Chinese'];else{if(_0x44b56f[0x0][_0x56d9da(0x261)]==_0x56d9da(0x24a))var _0x279a56=users['Arabic'];}}}}}}}_0xab0f5f[_0x56d9da(0x1b6)](_0x56d9da(0x207),{'success':_0x267c15['flash'](_0x56d9da(0x1f0)),'errors':_0x267c15[_0x56d9da(0x29c)]('errors'),'role':_0x419eb7,'profile':_0x30f57b,'master_shop':_0x44b56f,'customers':_0x4b4bd1,'sales':_0x2fb854,'language':_0x279a56});}catch(_0x4fffde){console[_0x56d9da(0x1d6)](_0x4fffde);}}),router[a0_0x1ca151(0x242)](a0_0x1ca151(0x254),auth,async(_0x57da36,_0x22b811)=>{var _0x8027c4=a0_0x1ca151;try{const {username:_0x123057,email:_0x33e0ab,role:_0x3ef65f}=_0x57da36[_0x8027c4(0x227)],_0x4e2e7f=_0x57da36[_0x8027c4(0x227)],_0x1b512a=await profile[_0x8027c4(0x1dc)]({'email':_0x4e2e7f[_0x8027c4(0x2a9)]}),_0x5abffa=await master_shop['find']();console['log'](_0x8027c4(0x201),_0x5abffa);const _0x4daaa3=_0x57da36['params']['id'];console['log'](_0x4daaa3);const _0xe98050=await sales[_0x8027c4(0x1cf)](_0x4daaa3);console['log']('user_id',_0xe98050);const _0x44a66d=await warehouse[_0x8027c4(0x22f)]([{'$match':{'name':_0x8027c4(0x293),'room':_0x8027c4(0x236)}},{'$unwind':_0x8027c4(0x1c9)},{'$group':{'_id':_0x8027c4(0x1ee),'name':{'$first':_0x8027c4(0x211)},'product_stock':{'$first':_0x8027c4(0x240)},'level':{'$first':_0x8027c4(0x1e2)},'isle':{'$first':_0x8027c4(0x272)},'pallet':{'$first':_0x8027c4(0x27a)},'primary_code':{'$first':_0x8027c4(0x1d1)},'secondary_code':{'$first':_0x8027c4(0x1eb)},'product_code':{'$first':_0x8027c4(0x206)}}}]);console[_0x8027c4(0x1d6)](_0x8027c4(0x24e),_0x44a66d);const _0x53bf8d=await product['find']({});warehouse_data=await warehouse[_0x8027c4(0x22f)]([{'$match':{'status':_0x8027c4(0x290),'name':_0x8027c4(0x293),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x8027c4(0x298)}}},{'$sort':{'name':0x1}}]);var _0x79c217=[_0x8027c4(0x236)];if(_0x5abffa[0x0]['language']=='English\x20(US)'){var _0xfb77c=users[_0x8027c4(0x258)];console[_0x8027c4(0x1d6)](_0xfb77c);}else{if(_0x5abffa[0x0][_0x8027c4(0x261)]==_0x8027c4(0x216))var _0xfb77c=users['Hindi'];else{if(_0x5abffa[0x0][_0x8027c4(0x261)]==_0x8027c4(0x1ef))var _0xfb77c=users[_0x8027c4(0x1ef)];else{if(_0x5abffa[0x0][_0x8027c4(0x261)]=='Spanish')var _0xfb77c=users[_0x8027c4(0x264)];else{if(_0x5abffa[0x0][_0x8027c4(0x261)]==_0x8027c4(0x1fb))var _0xfb77c=users['French'];else{if(_0x5abffa[0x0][_0x8027c4(0x261)]=='Portuguese\x20(BR)')var _0xfb77c=users[_0x8027c4(0x1c0)];else{if(_0x5abffa[0x0][_0x8027c4(0x261)]==_0x8027c4(0x1e6))var _0xfb77c=users[_0x8027c4(0x1e6)];else{if(_0x5abffa[0x0][_0x8027c4(0x261)]==_0x8027c4(0x24a))var _0xfb77c=users[_0x8027c4(0x230)];}}}}}}}_0x22b811[_0x8027c4(0x1b6)](_0x8027c4(0x263),{'success':_0x57da36[_0x8027c4(0x29c)](_0x8027c4(0x1f0)),'errors':_0x57da36[_0x8027c4(0x29c)](_0x8027c4(0x251)),'role':_0x4e2e7f,'profile':_0x1b512a,'user':_0xe98050,'stock':_0x44a66d,'master_shop':_0x5abffa,'unit':_0x53bf8d,'language':_0xfb77c,'warehouses':warehouse_data,'rooms':_0x79c217});}catch(_0x4850e9){console[_0x8027c4(0x1d6)](_0x4850e9),_0x22b811[_0x8027c4(0x1e3)](0xc8)[_0x8027c4(0x1f7)]({'message':_0x4850e9[_0x8027c4(0x294)]});}}),router[a0_0x1ca151(0x28d)](a0_0x1ca151(0x254),auth,async(_0x181c1c,_0xbb93a7)=>{var _0x4fbdf1=a0_0x1ca151;try{const {invoice:_0x20216c,date:_0x454fda,warehouse_name:_0x47212e,product_name:_0x2a1882,primary_code:_0x127d47,secondary_code:_0x25aa6a,product_code:_0x1cdf6e,sales_quantity:_0x56ac3e,stocks:_0x385fdd,return_qty:_0x44e417,Room_name:_0x2ebc14,to_warehouse_name:_0x2e7f4c,to_Roomname:_0x5db0eb,to_Room_name:_0x34a3c1,note:_0x35c270,level:_0x1c9219,isle:_0x420396,pallet:_0x505732}=_0x181c1c[_0x4fbdf1(0x26f)];if(typeof _0x2a1882==_0x4fbdf1(0x217))var _0x41a079=[_0x181c1c['body'][_0x4fbdf1(0x237)]],_0x4e8eed=[_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x28a)]],_0x40b632=[_0x181c1c['body']['secondary_code']],_0xdad2c1=[_0x181c1c['body'][_0x4fbdf1(0x224)]],_0x2b1919=[_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x1b9)]],_0x5935db=[_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x1be)]],_0x3565be=[_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x20c)]],_0x1a95d0=[_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x25c)]],_0x2fda87=[_0x181c1c[_0x4fbdf1(0x26f)]['bin']],_0x218850=[_0x181c1c[_0x4fbdf1(0x26f)]['types']],_0x34d337=[_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x248)]];else var _0x41a079=[..._0x181c1c['body'][_0x4fbdf1(0x237)]],_0x4e8eed=[..._0x181c1c[_0x4fbdf1(0x26f)]['primary_code']],_0x40b632=[..._0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x259)]],_0xdad2c1=[..._0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x224)]],_0x2b1919=[..._0x181c1c['body'][_0x4fbdf1(0x1b9)]],_0x5935db=[..._0x181c1c[_0x4fbdf1(0x26f)]['stocks']],_0x3565be=[..._0x181c1c[_0x4fbdf1(0x26f)]['return_qty']],_0x1a95d0=[..._0x181c1c[_0x4fbdf1(0x26f)]['bay']],_0x2fda87=[..._0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x276)]],_0x218850=[..._0x181c1c['body'][_0x4fbdf1(0x1ae)]],_0x34d337=[..._0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x248)]];const _0x5b5361=_0x41a079[_0x4fbdf1(0x239)](_0x5850b4=>{return _0x5850b4={'product_name':_0x5850b4};});_0x4e8eed[_0x4fbdf1(0x222)]((_0x12a8df,_0xc4f65a)=>{_0x5b5361[_0xc4f65a]['primary_code']=_0x12a8df;}),_0x40b632[_0x4fbdf1(0x222)]((_0x2797de,_0x1850fa)=>{_0x5b5361[_0x1850fa]['secondary_code']=_0x2797de;}),_0xdad2c1[_0x4fbdf1(0x222)]((_0x5b66b6,_0x100eb6)=>{var _0x240564=_0x4fbdf1;_0x5b5361[_0x100eb6][_0x240564(0x224)]=_0x5b66b6;}),_0x2b1919[_0x4fbdf1(0x222)]((_0x1c1546,_0x533e31)=>{var _0x4d9acc=_0x4fbdf1;_0x5b5361[_0x533e31][_0x4d9acc(0x2aa)]=_0x1c1546;}),_0x5935db[_0x4fbdf1(0x222)]((_0x3eb765,_0x47a0de)=>{var _0x364e3a=_0x4fbdf1;_0x5b5361[_0x47a0de][_0x364e3a(0x297)]=_0x3eb765;}),_0x3565be[_0x4fbdf1(0x222)]((_0x41bd06,_0x2f51b4)=>{var _0x3d0cdf=_0x4fbdf1;_0x5b5361[_0x2f51b4][_0x3d0cdf(0x20c)]=_0x41bd06;}),_0x1a95d0['forEach']((_0x256c29,_0x1474c7)=>{var _0x37bd54=_0x4fbdf1;_0x5b5361[_0x1474c7][_0x37bd54(0x25c)]=_0x256c29;}),_0x2fda87['forEach']((_0x4d3062,_0x57cdd1)=>{_0x5b5361[_0x57cdd1]['bin']=_0x4d3062;}),_0x218850['forEach']((_0x2f532d,_0x5c347a)=>{var _0x17aa20=_0x4fbdf1;_0x5b5361[_0x5c347a][_0x17aa20(0x289)]=_0x2f532d;}),_0x34d337[_0x4fbdf1(0x222)]((_0x544609,_0x5e9980)=>{var _0x4a7630=_0x4fbdf1;_0x5b5361[_0x5e9980][_0x4a7630(0x248)]=_0x544609;});var _0x374896=0x0;_0x5b5361[_0x4fbdf1(0x222)](_0x3b4f0e=>{var _0x4e5cc6=_0x4fbdf1;console[_0x4e5cc6(0x1d6)](_0x4e5cc6(0x256),_0x3b4f0e),(parseInt(_0x3b4f0e[_0x4e5cc6(0x2aa)])<parseInt(_0x3b4f0e['return_qty'])||parseInt(_0x3b4f0e[_0x4e5cc6(0x297)])<parseInt(_0x3b4f0e['return_qty'])&&parseInt(_0x3b4f0e[_0x4e5cc6(0x2aa)])>parseInt(_0x3b4f0e[_0x4e5cc6(0x20c)])||parseInt(_0x3b4f0e[_0x4e5cc6(0x20c)])==0x0)&&_0x374896++;});if(_0x374896!=0x0)return _0x181c1c[_0x4fbdf1(0x29c)](_0x4fbdf1(0x251),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0xbb93a7[_0x4fbdf1(0x2a7)](_0x4fbdf1(0x1e9));const _0xd858a0=await sales[_0x4fbdf1(0x1dc)]({'invoice':_0x20216c});console[_0x4fbdf1(0x1d6)](_0xd858a0),_0xd858a0[_0x4fbdf1(0x284)]=_0x4fbdf1(0x24c);const _0x38ed5a=await _0xd858a0[_0x4fbdf1(0x1c8)](),_0x5ad328=new sales_return({'invoice':_0x20216c,'customer':_0x181c1c[_0x4fbdf1(0x26f)][_0x4fbdf1(0x1a6)],'date':_0x454fda,'warehouse_name':_0x47212e,'room':_0x2ebc14,'ToWarehouse':_0x2e7f4c,'ToRoom':_0x34a3c1,'return_sale':_0x5b5361,'note':_0x35c270}),_0x1a05c2=await _0x5ad328[_0x4fbdf1(0x1c8)]();console[_0x4fbdf1(0x1d6)](_0x5ad328);const _0x46fcf0=await sales_return[_0x4fbdf1(0x1dc)]({'invoice':_0x20216c}),_0x4ea0bb=await warehouse[_0x4fbdf1(0x1dc)]({'name':_0x2e7f4c,'room':_0x34a3c1});_0x46fcf0['return_sale'][_0x4fbdf1(0x222)](_0xdd4a00=>{var _0x543775=_0x4fbdf1,_0x5782fe=0x0;const _0x48d5e3=_0x4ea0bb['product_details']['map'](_0x22e529=>{var _0x591fa4=a0_0x3457;_0x22e529[_0x591fa4(0x237)]==_0xdd4a00['product_name']&&_0x22e529['floorlevel']==_0xdd4a00['floorlevel']&&_0x22e529[_0x591fa4(0x289)]==_0xdd4a00[_0x591fa4(0x289)]&&_0x22e529[_0x591fa4(0x276)]==_0xdd4a00[_0x591fa4(0x276)]&&_0x22e529['bay']==_0xdd4a00[_0x591fa4(0x25c)]&&(_0x22e529[_0x591fa4(0x22d)]=parseInt(_0x22e529[_0x591fa4(0x22d)])+parseInt(_0xdd4a00[_0x591fa4(0x20c)]),_0x5782fe++);});_0x5782fe=='0'&&(_0x4ea0bb[_0x543775(0x21c)]=_0x4ea0bb[_0x543775(0x21c)][_0x543775(0x286)]({'product_name':_0xdd4a00[_0x543775(0x237)],'product_stock':_0xdd4a00[_0x543775(0x20c)],'primary_code':_0xdd4a00[_0x543775(0x28a)],'secondary_code':_0xdd4a00[_0x543775(0x259)],'product_code':_0xdd4a00['product_code'],'bay':_0xdd4a00[_0x543775(0x25c)],'bin':_0xdd4a00['bin'],'type':_0xdd4a00[_0x543775(0x289)],'floorlevel':_0xdd4a00['floorlevel']})),console[_0x543775(0x1d6)]('final',_0x4ea0bb);}),await _0x4ea0bb[_0x4fbdf1(0x1c8)](),console['log'](_0x181c1c[_0x4fbdf1(0x26f)]);const _0x3c4816=new c_payment_data({'invoice':_0x20216c,'customer':_0x181c1c['body']['customer'],'reason':_0x4fbdf1(0x296)});await _0x3c4816[_0x4fbdf1(0x1c8)]();const _0x5f37e9=await master_shop[_0x4fbdf1(0x23a)]();console[_0x4fbdf1(0x1d6)](_0x4fbdf1(0x1bb),_0x5f37e9[0x0][_0x4fbdf1(0x2b2)]);const _0x137872=await email_settings[_0x4fbdf1(0x1dc)](),_0x144864=await customer[_0x4fbdf1(0x1dc)]({'name':_0x181c1c['body'][_0x4fbdf1(0x1a6)]});console[_0x4fbdf1(0x1d6)](_0x4fbdf1(0x1d8),_0x144864);_0x5f37e9[0x0][_0x4fbdf1(0x20f)]==0x1?(right_currency=_0x5f37e9[0x0][_0x4fbdf1(0x1fd)],left_currency=''):(right_currency='',left_currency=_0x5f37e9[0x0]['currency']);var _0x6bc0d4=_0x41a079,_0x5d121f=_0x3565be,_0x2f5743='',_0x392134;for(_0x392134 in _0x6bc0d4){_0x2f5743+=_0x4fbdf1(0x1cb)+_0x4fbdf1(0x1a9)+_0x6bc0d4[_0x392134]+'</td>'+_0x4fbdf1(0x1a9)+_0x5d121f[_0x392134]+_0x4fbdf1(0x2a8)+_0x4fbdf1(0x204);}console['log'](_0x4fbdf1(0x2a0),_0x2f5743);let _0xdbde94=nodemailer[_0x4fbdf1(0x21d)]({'service':_0x4fbdf1(0x1d4),'auth':{'user':_0x137872['email'],'pass':_0x137872[_0x4fbdf1(0x1b4)]}}),_0x4fc9c0={'from':_0x137872[_0x4fbdf1(0x2a9)],'to':_0x144864[_0x4fbdf1(0x2a9)],'subject':_0x4fbdf1(0x1aa),'attachments':[{'filename':_0x4fbdf1(0x2b4),'path':__dirname+'/../public'+_0x4fbdf1(0x26c)+_0x5f37e9[0x0]['image'],'cid':_0x4fbdf1(0x1b5)}],'html':'<!DOCTYPE\x20html>'+_0x4fbdf1(0x1b3)+'</head><body>'+_0x4fbdf1(0x245)+_0x4fbdf1(0x1c7)+'<div>'+_0x4fbdf1(0x212)+_0x4fbdf1(0x220)+'<div>'+_0x4fbdf1(0x1f2)+_0x5f37e9[0x0]['site_title']+_0x4fbdf1(0x1a4)+_0x4fbdf1(0x220)+'</div>'+_0x4fbdf1(0x29b)+_0x4fbdf1(0x245)+_0x4fbdf1(0x241)+'\x20Order\x20Number\x20:\x20'+_0x20216c+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4fbdf1(0x1c5)+_0x454fda+'\x20'+_0x4fbdf1(0x22c)+_0x4fbdf1(0x23e)+_0x4fbdf1(0x220)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4fbdf1(0x1ab)+_0x4fbdf1(0x1cb)+_0x4fbdf1(0x2ba)+_0x4fbdf1(0x268)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4fbdf1(0x204)+_0x4fbdf1(0x238)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2f5743+'\x20'+_0x4fbdf1(0x1ea)+_0x4fbdf1(0x27e)+_0x4fbdf1(0x245)+_0x4fbdf1(0x29f)+_0x4fbdf1(0x203)+_0x5f37e9[0x0]['site_title']+_0x4fbdf1(0x23e)+_0x4fbdf1(0x220)+'</div>'+_0x4fbdf1(0x279)};_0xdbde94[_0x4fbdf1(0x1c1)](_0x4fc9c0,function(_0x2019fb,_0x5c8e7d){var _0x40c836=_0x4fbdf1;_0x2019fb?(console[_0x40c836(0x1d6)](_0x2019fb),console[_0x40c836(0x1d6)](_0x40c836(0x1da))):console[_0x40c836(0x1d6)](_0x40c836(0x226));}),_0x181c1c[_0x4fbdf1(0x29c)](_0x4fbdf1(0x1f0),'sales\x20item\x20return\x20successfull'),_0xbb93a7[_0x4fbdf1(0x2a7)]('/all_sales/view');}catch(_0x55c291){console[_0x4fbdf1(0x1d6)](_0x55c291),_0xbb93a7[_0x4fbdf1(0x1e3)](0xc8)[_0x4fbdf1(0x1f7)]({'message1':_0x55c291[_0x4fbdf1(0x294)]});}}),router[a0_0x1ca151(0x242)]('/barcode/:id',auth,async(_0x30ae4d,_0x1df642)=>{var _0x4ef810=a0_0x1ca151;try{const {username:_0x3e3ed0,email:_0xc8bd7f,role:_0xa12bca}=_0x30ae4d[_0x4ef810(0x227)],_0x4dff48=_0x30ae4d['user'],_0x52da6e=await profile['findOne']({'email':_0x4dff48[_0x4ef810(0x2a9)]}),_0x155348=await master_shop[_0x4ef810(0x23a)]();console[_0x4ef810(0x1d6)](_0x4ef810(0x25d),_0x155348);const _0x32dbcd=_0x30ae4d[_0x4ef810(0x218)]['id'],_0x577b88=await sales[_0x4ef810(0x1cf)](_0x32dbcd);console[_0x4ef810(0x1d6)](_0x4ef810(0x25e),_0x577b88);if(_0x155348[0x0]['language']=='English\x20(US)')var _0x348ad9=users[_0x4ef810(0x258)];else{if(_0x155348[0x0][_0x4ef810(0x261)]==_0x4ef810(0x216))var _0x348ad9=users[_0x4ef810(0x216)];else{if(_0x155348[0x0][_0x4ef810(0x261)]==_0x4ef810(0x1ef))var _0x348ad9=users[_0x4ef810(0x1ef)];else{if(_0x155348[0x0][_0x4ef810(0x261)]==_0x4ef810(0x264))var _0x348ad9=users[_0x4ef810(0x264)];else{if(_0x155348[0x0][_0x4ef810(0x261)]=='French')var _0x348ad9=users[_0x4ef810(0x1fb)];else{if(_0x155348[0x0]['language']==_0x4ef810(0x265))var _0x348ad9=users['Portuguese'];else{if(_0x155348[0x0][_0x4ef810(0x261)]==_0x4ef810(0x1e6))var _0x348ad9=users[_0x4ef810(0x1e6)];else{if(_0x155348[0x0]['language']=='Arabic\x20(ae)')var _0x348ad9=users['Arabic'];}}}}}}}_0x1df642[_0x4ef810(0x1b6)](_0x4ef810(0x23c),{'success':_0x30ae4d[_0x4ef810(0x29c)]('success'),'errors':_0x30ae4d['flash'](_0x4ef810(0x251)),'role':_0x4dff48,'profile':_0x52da6e,'alldata':_0x577b88,'master_shop':_0x155348,'language':_0x348ad9});}catch(_0x546dee){console['log'](_0x546dee);}}),router[a0_0x1ca151(0x28d)](a0_0x1ca151(0x244),async(_0x54fcd4,_0x2d3626)=>{var _0x1e3178=a0_0x1ca151;const {product_code:_0x404894,warehouse_name:_0x50c743,rooms_data:_0x2d8839,Roomslist:_0x20b6cf}=_0x54fcd4[_0x1e3178(0x26f)],_0x89d271=_0x20b6cf[_0x1e3178(0x2a4)](','),_0x30cd4d=[];async function _0x16387c(_0x43da8b){var _0x1496d7=_0x1e3178;const _0x514cad=await warehouse[_0x1496d7(0x22f)]([{'$match':{'name':_0x50c743,'room':_0x43da8b}},{'$unwind':_0x1496d7(0x1c9)},{'$match':{'product_details.primary_code':_0x404894}},{'$group':{'_id':_0x1496d7(0x1ee),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1496d7(0x240)},'primary_code':{'$first':_0x1496d7(0x1d1)},'secondary_code':{'$first':_0x1496d7(0x1eb)},'product_code':{'$first':_0x1496d7(0x206)},'level':{'$first':_0x1496d7(0x1cd)},'isle':{'$first':_0x1496d7(0x27c)},'type':{'$first':_0x1496d7(0x2a6)},'pallet':{'$first':_0x1496d7(0x21f)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1496d7(0x291)},'storage':{'$first':_0x1496d7(0x28c)},'rack':{'$first':_0x1496d7(0x23f)},'expiry_date':{'$first':_0x1496d7(0x1e4)},'production_date':{'$first':_0x1496d7(0x2a2)},'maxPerUnit':{'$first':_0x1496d7(0x219)},'batch_code':{'$first':_0x1496d7(0x228)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1496d7(0x275)},'invoice':{'$first':_0x1496d7(0x25a)},'actual_qty':{'$first':_0x1496d7(0x1fc)},'actual_uom':{'$first':_0x1496d7(0x250)}}}]),_0x470508=await warehouse['aggregate']([{'$match':{'name':_0x50c743,'room':_0x43da8b}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x404894}},{'$group':{'_id':_0x1496d7(0x1ee),'name':{'$first':_0x1496d7(0x211)},'product_stock':{'$first':_0x1496d7(0x240)},'primary_code':{'$first':_0x1496d7(0x1d1)},'secondary_code':{'$first':_0x1496d7(0x1eb)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1496d7(0x1cd)},'isle':{'$first':_0x1496d7(0x27c)},'type':{'$first':_0x1496d7(0x2a6)},'pallet':{'$first':_0x1496d7(0x21f)},'unit':{'$first':_0x1496d7(0x1b2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1496d7(0x28c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1496d7(0x2a2)},'maxPerUnit':{'$first':_0x1496d7(0x219)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x1496d7(0x260)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1496d7(0x25a)}}}]);if(_0x514cad[_0x1496d7(0x1f1)]>0x0)_0x30cd4d[_0x1496d7(0x277)](_0x514cad);else _0x470508[_0x1496d7(0x1f1)]>0x0&&_0x30cd4d[_0x1496d7(0x277)](_0x470508);}const _0xae79d=_0x89d271[_0x1e3178(0x239)](_0x3f1db7=>_0x16387c(_0x3f1db7));await Promise['all'](_0xae79d),_0x2d3626['json'](_0x30cd4d);}),module[a0_0x1ca151(0x215)]=router;