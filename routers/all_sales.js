var a0_0x1bf8dd=a0_0x128d;(function(_0x12c382,_0x6977a7){var _0x50ba8b=a0_0x128d,_0x19985e=_0x12c382();while(!![]){try{var _0x4b87ca=parseInt(_0x50ba8b(0x14a))/0x1*(parseInt(_0x50ba8b(0x127))/0x2)+parseInt(_0x50ba8b(0x218))/0x3*(-parseInt(_0x50ba8b(0x1a7))/0x4)+-parseInt(_0x50ba8b(0x1d5))/0x5*(parseInt(_0x50ba8b(0x1e6))/0x6)+parseInt(_0x50ba8b(0x20e))/0x7+-parseInt(_0x50ba8b(0x1c5))/0x8+parseInt(_0x50ba8b(0x1c1))/0x9*(-parseInt(_0x50ba8b(0x1de))/0xa)+parseInt(_0x50ba8b(0x14d))/0xb*(parseInt(_0x50ba8b(0x19d))/0xc);if(_0x4b87ca===_0x6977a7)break;else _0x19985e['push'](_0x19985e['shift']());}catch(_0x237ec2){_0x19985e['push'](_0x19985e['shift']());}}}(a0_0x1ac9,0x7fdb7));function a0_0x1ac9(){var _0x494810=['\x20Order\x20Number\x20:\x20','expiry_date','getDate','product_stock','string','port','sales\x20all_data','/view/:id','Level','get','sale_qty','all_sales','floorlevel','body','English\x20(US)','prod_code','email','</td>','errors','site_title','padStart','$product_details.product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','unit','/all_sales/preview/','stock_data','catch','carton','sale_product','Chinese','Raw\x20Materials','47484OGWjHM','</span>','$finalize','types','Enclosed','$sale_product.type','$name','host','Ambient','warehouse_name','52optqmf','date','product_list','../public/language/languages.json','id_transact','all_sales_barcode','$product','$product_details.bin','$product_details.isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','express','$warehouse_name','storage','$product_details.maxPerUnit','batch_code','sales_invoice','$room','$product_details.rack','customer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Sale\x20Return\x20Mail','back','return_data','getMonth','$product_details.product_stock','return_qty','6159501HMxRev','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</head><body>','$product_details.invoice','2874216vgBopG','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','quantity','Shelves','<!DOCTYPE\x20html>','max_per_unit','\x20</h2>','$sale_product.bay','<tr>','id_transaction_from','purchases_data','/all_sales/view','<table\x20style=\x22width:\x20100%\x20!important;\x22>','name','<hr\x20class=\x22my-3\x22>','</table>','5icLvNE','add_sales','product_code','<h5>','map','_id','Return\x20Goods','master','message','10TcFZRx','$note','production_date','primary_unit','Spanish','SCRN','actual_qty','delivery_code','135186KsMLMY','$return_data','return_sale','maxperunit','all','</body></html>','image','$product_details.primary_code','quantity_notConverted','findOne','random','$customer','params','success','createTransport','toString','$product_details.batch_code','RMSEmail','</h5>','$customers_docs','</thead>','French','bin','$date','product_details','currency','Email\x20sent\x20successfully','requested_qty','push','final','edit_sales','warehouse','Logo.png','Sales\x20Add\x20successfully','$sale_product.quantity','user_id','An\x20error\x20occurred.','secondary_unit','../models/all_models','Enabled','945609OxBHih','Portuguese\x20(BR)','RoomAssigned','customer_data','role','$isAllowEdit','../middleware/auth','Error\x20Occurs','customers_docs','Arabic\x20(ae)','144966oZltIe','sales_quantity','save','$product_details.secondary_unit','$sale_product.bin','secondary_code','<h5\x20style=\x22text-align:\x20left;\x22>','filter','find','/preview/:id','sendMail','post','note','actual_uom','<div>','English','Hindi','sales\x20item\x20return\x20successfull','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','False','$product_details.secondary_code','log','$product.product_name','isAllowEdit','</div>','type','stocks','12812qtXwoN','product','<strong>\x20Regards\x20</strong>','split','findById','<h2>\x20','error','payment\x20successfull','add\x20post','status','Received\x20Payment\x20For\x20Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','redirect','/view/add_sale/product','German','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','staff','</tr>','$product_details.unit','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$sale_product.floorlevel','/upload/','/view/add_sales','json','length','/barcode_scanner','Portuguese','$product_details.expiry_date','floor','aggregate','Arabic','room_name','Return\x20Rooms','138uCHppH','render','Receiving\x20Area','3333CKVHPQ','$_id','<html><head><title></title>','logo','slice','$product_details.product_name','OUT-','$product_details.bay','customers','/barcode/:id','primary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','foreach\x20newproduct','received_amount','/../public','True','then','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','nodemailer','invoice','$product_details.pallet','$product_details.product_code','$product_details._id','forEach','$product_details.storage','abs','user','Floor','$product_details.production_date','prod_invoice','$product_details.type','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/return_sales/:id','prod_cat','delivery_date','bay','stock','getFullYear','level','</tbody>','product_name','language','password','$product_details','An\x20error\x20occurred\x20while\x20saving\x20data.','rack'];a0_0x1ac9=function(){return _0x494810;};return a0_0x1ac9();}function a0_0x128d(_0x5899c4,_0x184690){var _0x1ac9d9=a0_0x1ac9();return a0_0x128d=function(_0x128d4e,_0x48e77c){_0x128d4e=_0x128d4e-0x11d;var _0x97adbf=_0x1ac9d9[_0x128d4e];return _0x97adbf;},a0_0x128d(_0x5899c4,_0x184690);}const express=require(a0_0x1bf8dd(0x1b1)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1bf8dd(0x20c)),auth=require(a0_0x1bf8dd(0x214)),nodemailer=require(a0_0x1bf8dd(0x162)),users=require(a0_0x1bf8dd(0x1aa));router['get']('/view',auth,async(_0x40b3ea,_0x5c777e)=>{var _0x517b44=a0_0x1bf8dd;try{const {username:_0xf047b4,email:_0x5e72e1,role:_0x17a8f4}=_0x40b3ea[_0x517b44(0x16a)],_0x19419c=_0x40b3ea[_0x517b44(0x16a)],_0x38e989=await profile[_0x517b44(0x1ef)]({'email':_0x19419c[_0x517b44(0x18e)]}),_0x43541c=await master_shop['find']();let _0x2078fa;if(_0x19419c[_0x517b44(0x212)]=='staff'){const _0x129888=await staff[_0x517b44(0x1ef)]({'email':_0x19419c[_0x517b44(0x18e)]});_0x2078fa=await sales[_0x517b44(0x146)]([{'$lookup':{'from':_0x517b44(0x155),'localField':_0x517b44(0x1b9),'foreignField':_0x517b44(0x1d2),'as':_0x517b44(0x216)}},{'$unwind':'$customers_docs'},{'$unwind':_0x517b44(0x13b)},{'$group':{'_id':_0x517b44(0x14e),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x517b44(0x1f1)},'date':{'$first':_0x517b44(0x1fd)},'warehouse_name':{'$first':_0x517b44(0x1b2)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x517b44(0x1df)},'return_data':{'$first':_0x517b44(0x1e7)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x517b44(0x208)},'level':{'$addToSet':_0x517b44(0x1cc)},'isle':{'$addToSet':_0x517b44(0x21c)},'type':{'$addToSet':_0x517b44(0x1a2)},'pallet':{'$addToSet':_0x517b44(0x13d)},'finalize':{'$first':_0x517b44(0x19f)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2078fa=await sales[_0x517b44(0x146)]([{'$lookup':{'from':_0x517b44(0x155),'localField':'customer','foreignField':'name','as':_0x517b44(0x216)}},{'$unwind':_0x517b44(0x1f9)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x517b44(0x14e),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x517b44(0x1f1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x517b44(0x1b2)},'sale_product':{'$push':_0x517b44(0x13b)},'note':{'$first':_0x517b44(0x1df)},'return_data':{'$first':_0x517b44(0x1e7)},'customers_docs':{'$first':_0x517b44(0x1f9)},'total_saleproduct_quantity':{'$sum':_0x517b44(0x208)},'level':{'$addToSet':_0x517b44(0x1cc)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x517b44(0x13d)},'finalize':{'$first':_0x517b44(0x19f)},'isAllowEdit':{'$first':_0x517b44(0x213)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x517b44(0x184),_0x2078fa);if(_0x43541c[0x0][_0x517b44(0x179)]==_0x517b44(0x18c)){var _0x1f8e52=users[_0x517b44(0x227)];console[_0x517b44(0x121)](_0x1f8e52);}else{if(_0x43541c[0x0][_0x517b44(0x179)]==_0x517b44(0x228))var _0x1f8e52=users[_0x517b44(0x228)];else{if(_0x43541c[0x0][_0x517b44(0x179)]=='German')var _0x1f8e52=users[_0x517b44(0x135)];else{if(_0x43541c[0x0]['language']==_0x517b44(0x1e2))var _0x1f8e52=users['Spanish'];else{if(_0x43541c[0x0][_0x517b44(0x179)]==_0x517b44(0x1fb))var _0x1f8e52=users[_0x517b44(0x1fb)];else{if(_0x43541c[0x0][_0x517b44(0x179)]==_0x517b44(0x20f))var _0x1f8e52=users['Portuguese'];else{if(_0x43541c[0x0]['language']==_0x517b44(0x19b))var _0x1f8e52=users[_0x517b44(0x19b)];else{if(_0x43541c[0x0][_0x517b44(0x179)]==_0x517b44(0x217))var _0x1f8e52=users[_0x517b44(0x147)];}}}}}}}_0x5c777e[_0x517b44(0x14b)](_0x517b44(0x189),{'success':_0x40b3ea[_0x517b44(0x136)]('success'),'errors':_0x40b3ea[_0x517b44(0x136)]('errors'),'sales':_0x2078fa,'profile':_0x38e989,'role':_0x19419c,'master_shop':_0x43541c,'language':_0x1f8e52});}catch(_0x12f70b){console[_0x517b44(0x121)](_0x12f70b);}});async function getRandom8DigitNumber(){var _0xcb89ae=a0_0x1bf8dd;const _0x2db283=0x989680,_0x8dccbb=0x5f5e0ff,_0x3ccaf1=Math[_0xcb89ae(0x145)](Math[_0xcb89ae(0x1f0)]()*(_0x8dccbb-_0x2db283+0x1))+_0x2db283;var _0x286cd5;const _0x2fd69f=await sales[_0xcb89ae(0x1ef)]({'invoice':_0xcb89ae(0x153)+_0x3ccaf1});return _0x2fd69f&&_0x2fd69f[_0xcb89ae(0x141)]>0x0?_0x286cd5=_0xcb89ae(0x153)+_0x3ccaf1:_0x286cd5=_0xcb89ae(0x153)+_0x3ccaf1,_0x286cd5;}router[a0_0x1bf8dd(0x187)]('/view/add_sales',auth,async(_0x1a1378,_0x176710)=>{var _0x3cae84=a0_0x1bf8dd;try{const {username:_0x2ef7a6,email:_0x410b28,role:_0x1ccfb7}=_0x1a1378[_0x3cae84(0x16a)],_0x587e75=_0x1a1378[_0x3cae84(0x16a)],_0x489cc0=await profile[_0x3cae84(0x1ef)]({'email':_0x587e75['email']}),_0x4b32b9=await master_shop[_0x3cae84(0x220)](),_0x372425=await customer[_0x3cae84(0x220)]({});let _0x2e42ff;if(_0x587e75[_0x3cae84(0x212)]=='staff'){const _0x185026=await staff[_0x3cae84(0x1ef)]({'email':_0x587e75[_0x3cae84(0x18e)]});_0x2e42ff=await warehouse['aggregate']([{'$match':{'status':_0x3cae84(0x20d),'name':_0x185026['warehouse'],'warehouse_category':_0x3cae84(0x19c),'name':{'$ne':_0x3cae84(0x1db)}}},{'$group':{'_id':_0x3cae84(0x1a3),'name':{'$first':_0x3cae84(0x1a3)}}},{'$sort':{'name':0x1}}]);}else _0x2e42ff=await warehouse[_0x3cae84(0x146)]([{'$match':{'status':_0x3cae84(0x20d),'warehouse_category':_0x3cae84(0x19c),'name':{'$ne':_0x3cae84(0x1db)}}},{'$group':{'_id':_0x3cae84(0x1a3),'name':{'$first':_0x3cae84(0x1a3)}}},{'$sort':{'name':0x1}}]);const _0x11aee7=await product['find']({});var _0x499683=[_0x3cae84(0x1a5),_0x3cae84(0x1a1)];const _0x38b41a=await sales[_0x3cae84(0x220)]({}),_0x1a5f51=_0x38b41a[_0x3cae84(0x141)]+0x1,_0x3fc841=_0x3cae84(0x153)+_0x1a5f51[_0x3cae84(0x1f5)]()[_0x3cae84(0x192)](0x5,'0');if(_0x4b32b9[0x0]['language']==_0x3cae84(0x18c)){var _0x559226=users[_0x3cae84(0x227)];console[_0x3cae84(0x121)](_0x559226);}else{if(_0x4b32b9[0x0][_0x3cae84(0x179)]=='Hindi')var _0x559226=users[_0x3cae84(0x228)];else{if(_0x4b32b9[0x0][_0x3cae84(0x179)]==_0x3cae84(0x135))var _0x559226=users['German'];else{if(_0x4b32b9[0x0][_0x3cae84(0x179)]=='Spanish')var _0x559226=users[_0x3cae84(0x1e2)];else{if(_0x4b32b9[0x0][_0x3cae84(0x179)]==_0x3cae84(0x1fb))var _0x559226=users[_0x3cae84(0x1fb)];else{if(_0x4b32b9[0x0][_0x3cae84(0x179)]==_0x3cae84(0x20f))var _0x559226=users['Portuguese'];else{if(_0x4b32b9[0x0][_0x3cae84(0x179)]==_0x3cae84(0x19b))var _0x559226=users[_0x3cae84(0x19b)];else{if(_0x4b32b9[0x0]['language']=='Arabic\x20(ae)')var _0x559226=users['Arabic'];}}}}}}}const _0x1653bd=getRandom8DigitNumber();_0x1653bd[_0x3cae84(0x15e)](_0x1b7c56=>{var _0x2d3767=_0x3cae84;_0x176710['render'](_0x2d3767(0x1d6),{'success':_0x1a1378['flash'](_0x2d3767(0x1f3)),'errors':_0x1a1378[_0x2d3767(0x136)]('errors'),'role':_0x587e75,'profile':_0x489cc0,'customer':_0x372425,'warehouse':_0x2e42ff,'product':_0x11aee7,'invoice':_0x1b7c56,'master_shop':_0x4b32b9,'language':_0x559226,'rooms_data':_0x499683});})['catch'](_0x3ddb54=>{var _0x336428=_0x3cae84;_0x1a1378[_0x336428(0x136)]('errors',_0x336428(0x158)),_0x176710[_0x336428(0x133)](_0x336428(0x1d0));});}catch(_0x2bc93c){console['log'](_0x2bc93c);}}),router['get']('/view/add_sales/:id',auth,async(_0x1ec045,_0x55e84b)=>{var _0x4d98ad=a0_0x1bf8dd;try{const _0x328467=_0x1ec045['params']['id'];console[_0x4d98ad(0x121)](_0x328467);const _0x1a2c0c=await product[_0x4d98ad(0x220)](),_0xe60c78=await purchases[_0x4d98ad(0x146)]([{'$match':{'warehouse_name':_0x328467}},{'$unwind':_0x4d98ad(0x1ad)},{'$group':{'_id':_0x4d98ad(0x122)}}]);console[_0x4d98ad(0x121)](_0x4d98ad(0x1cf),_0xe60c78),_0x55e84b[_0x4d98ad(0x130)](0xc8)[_0x4d98ad(0x140)]({'purchases_data':_0xe60c78,'product_data':_0x1a2c0c});}catch(_0x402a06){console[_0x4d98ad(0x121)](_0x402a06);}}),router[a0_0x1bf8dd(0x223)](a0_0x1bf8dd(0x134),auth,async(_0x21267a,_0x1c6cf1)=>{var _0x43a71e=a0_0x1bf8dd;try{const {warehouse_data:_0x5a20f5,product_data:_0x30335e}=_0x21267a[_0x43a71e(0x18b)];console[_0x43a71e(0x121)](_0x21267a['body']['product_data']);;const _0x26a67a=await master_shop[_0x43a71e(0x220)]();console[_0x43a71e(0x121)](_0x43a71e(0x1dc),_0x26a67a);const _0x506396=await product['findOne']({'name':_0x30335e});console[_0x43a71e(0x121)](_0x43a71e(0x128),_0x506396);const _0x65ebe3=await warehouse[_0x43a71e(0x146)]([{'$match':{'name':_0x5a20f5}},{'$unwind':_0x43a71e(0x17b)},{'$match':{'product_details.product_name':_0x30335e}},{'$group':{'_id':_0x43a71e(0x152),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x43a71e(0x121)](_0x43a71e(0x197),_0x65ebe3),_0x1c6cf1[_0x43a71e(0x130)](0xc8)[_0x43a71e(0x140)]({'master':_0x26a67a,'new_product':_0x506396,'stock_data':_0x65ebe3});}catch(_0x5cff27){console[_0x43a71e(0x121)](_0x5cff27);}}),router[a0_0x1bf8dd(0x223)](a0_0x1bf8dd(0x13f),auth,async(_0x2b0cef,_0x23ab91)=>{var _0x549983=a0_0x1bf8dd;try{const {invoice:_0x37e347,date:_0x37c651,warehouse_name:_0x48f111,product_name:_0x5efc97,stock:_0x3d2540,quantity:_0x3e3085,note:_0x1a8c39,room:_0x5a4dae,primary_code:_0x2b564a,secondary_code:_0x10f5d6,prod_code:_0x36ddeb,level:_0x30f732,isle:_0x376efe,pallet:_0x501a8f,batch_code:_0x4c0fed,SCRN:_0x585c46,expiry_date:_0x1d7e31}=_0x2b0cef[_0x549983(0x18b)];if(typeof _0x5efc97==_0x549983(0x182))var _0x6bac5c=[_0x2b0cef['body'][_0x549983(0x178)]],_0x5e4997=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x174)]],_0x678eb2=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x199)]],_0x1db357=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x157)]],_0x1b129a=[_0x2b0cef['body'][_0x549983(0x21d)]],_0x5218b4=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x18d)]],_0x5d9ee5=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x176)]],_0x33de07=[_0x2b0cef['body'][_0x549983(0x1e1)]],_0x36c655=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x20b)]],_0x402542=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x1b5)]],_0x1a84ce=[_0x2b0cef[_0x549983(0x18b)]['expiry_date']],_0x431143=[_0x2b0cef['body'][_0x549983(0x1ca)]],_0x12d9f7=[_0x2b0cef['body'][_0x549983(0x1e0)]],_0x3eee83=[_0x2b0cef['body'][_0x549983(0x201)]],_0x2f992b=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x172)]],_0x2bdede=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x1e5)]],_0x4a5465=[_0x2b0cef['body'][_0x549983(0x171)]],_0x2aa9fa=[_0x2b0cef['body'][_0x549983(0x1c7)]],_0x3b465f=[_0x2b0cef['body'][_0x549983(0x210)]],_0x775973=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x16d)]],_0x3f0e52=[_0x2b0cef['body'][_0x549983(0x1e4)]],_0x31974a=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x225)]],_0x370dbb=[_0x2b0cef[_0x549983(0x18b)][_0x549983(0x1ab)]];else var _0x6bac5c=[..._0x2b0cef['body'][_0x549983(0x178)]],_0x5e4997=[..._0x2b0cef['body'][_0x549983(0x174)]],_0x678eb2=[..._0x2b0cef['body']['carton']],_0x1db357=[..._0x2b0cef[_0x549983(0x18b)]['primary_code']],_0x1b129a=[..._0x2b0cef[_0x549983(0x18b)]['secondary_code']],_0x5218b4=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x18d)]],_0x5d9ee5=[..._0x2b0cef['body'][_0x549983(0x176)]],_0x33de07=[..._0x2b0cef[_0x549983(0x18b)]['primary_unit']],_0x36c655=[..._0x2b0cef['body'][_0x549983(0x20b)]],_0x402542=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x1b5)]],_0x1a84ce=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x17f)]],_0x431143=[..._0x2b0cef['body']['max_per_unit']],_0x12d9f7=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x1e0)]],_0x3eee83=[..._0x2b0cef[_0x549983(0x18b)]['requested_qty']],_0x2f992b=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x172)]],_0x2bdede=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x1e5)]],_0x4a5465=[..._0x2b0cef['body']['prod_cat']],_0x2aa9fa=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x1c7)]],_0x3b465f=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x210)]],_0x775973=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x16d)]],_0x3f0e52=[..._0x2b0cef[_0x549983(0x18b)]['actual_qty']],_0x31974a=[..._0x2b0cef[_0x549983(0x18b)]['actual_uom']],_0x370dbb=[..._0x2b0cef[_0x549983(0x18b)][_0x549983(0x1ab)]];const _0x893d3d=_0x6bac5c[_0x549983(0x1d9)](_0x40fa86=>{return _0x40fa86={'product_name':_0x40fa86};});_0x5e4997[_0x549983(0x167)]((_0x48ff76,_0x7e8ba4)=>{var _0x505dca=_0x549983;_0x893d3d[_0x7e8ba4][_0x505dca(0x174)]=Math[_0x505dca(0x169)](_0x48ff76);}),_0x3f0e52[_0x549983(0x167)]((_0x434fad,_0x1f7317)=>{var _0x33bcfd=_0x549983;_0x893d3d[_0x1f7317]['actual_qty']=Math[_0x33bcfd(0x169)](_0x434fad);}),_0x31974a[_0x549983(0x167)]((_0x47e761,_0x383491)=>{var _0x43dfe4=_0x549983;_0x893d3d[_0x383491][_0x43dfe4(0x225)]=_0x47e761;}),_0x370dbb['forEach']((_0x49339b,_0x169490)=>{var _0x2d5792=_0x549983;_0x893d3d[_0x169490][_0x2d5792(0x1ce)]=_0x49339b;}),_0x678eb2['forEach']((_0x2da4d4,_0x15e276)=>{var _0x31c58c=_0x549983;_0x893d3d[_0x15e276][_0x31c58c(0x1c7)]=_0x2da4d4;}),_0x1db357['forEach']((_0x3e66d8,_0x23cbab)=>{var _0x364fe1=_0x549983;_0x893d3d[_0x23cbab][_0x364fe1(0x157)]=_0x3e66d8;}),_0x1b129a[_0x549983(0x167)]((_0x530476,_0x513c70)=>{_0x893d3d[_0x513c70]['secondary_code']=_0x530476;}),_0x5218b4[_0x549983(0x167)]((_0x142bc6,_0x5975a7)=>{_0x893d3d[_0x5975a7]['product_code']=_0x142bc6;}),_0x5d9ee5[_0x549983(0x167)]((_0x1aac7c,_0x56af92)=>{var _0x36481c=_0x549983;_0x3b465f[_0x36481c(0x167)]((_0x38719e,_0x449b9f)=>{var _0x33212c=_0x36481c;if(_0x38719e=='Receiving\x20Area'&&_0x56af92==_0x449b9f){var _0xfe65b1=_0x1aac7c[_0x33212c(0x151)](0x3);_0x893d3d[_0x56af92][_0x33212c(0x1b3)]=_0x1aac7c[0x0],_0x893d3d[_0x56af92][_0x33212c(0x17d)]=_0x1aac7c[0x1],_0x893d3d[_0x56af92][_0x33212c(0x173)]=0x0,_0x893d3d[_0x56af92]['bin']=0x0,_0x893d3d[_0x56af92]['type']=_0x33212c(0x16b),_0x893d3d[_0x56af92][_0x33212c(0x18a)]=_0xfe65b1;}else{if(_0x38719e==_0x33212c(0x1c8)&&_0x56af92==_0x449b9f){var _0xfe65b1=_0x1aac7c[_0x33212c(0x151)](0x3);_0x893d3d[_0x56af92]['storage']=_0x1aac7c[0x0],_0x893d3d[_0x56af92][_0x33212c(0x17d)]=_0x1aac7c[0x1],_0x893d3d[_0x56af92][_0x33212c(0x173)]=0x0,_0x893d3d[_0x56af92][_0x33212c(0x1fc)]=0x0,_0x893d3d[_0x56af92][_0x33212c(0x125)]=_0x33212c(0x16b),_0x893d3d[_0x56af92][_0x33212c(0x18a)]=_0x1aac7c[0x5];}else{if(_0x56af92==_0x449b9f){var _0x9b9c4e;if(_0x1aac7c[0x4]=='L')_0x9b9c4e=_0x33212c(0x186);else _0x1aac7c[0x4]=='F'&&(_0x9b9c4e=_0x33212c(0x16b));_0x893d3d[_0x56af92][_0x33212c(0x1b3)]=_0x1aac7c[0x0],_0x893d3d[_0x56af92]['rack']=_0x1aac7c[0x1],_0x893d3d[_0x56af92][_0x33212c(0x173)]=_0x1aac7c[0x2],_0x893d3d[_0x56af92][_0x33212c(0x1fc)]=_0x1aac7c[0x3],_0x893d3d[_0x56af92][_0x33212c(0x125)]=_0x9b9c4e,_0x893d3d[_0x56af92][_0x33212c(0x18a)]=_0x1aac7c[0x5];}}}});}),_0x33de07['forEach']((_0x368ea6,_0x32ac2c)=>{var _0x4bf359=_0x549983;_0x893d3d[_0x32ac2c][_0x4bf359(0x195)]=_0x368ea6;}),_0x36c655[_0x549983(0x167)]((_0x5abab1,_0x1cf5be)=>{var _0x384c1b=_0x549983;_0x893d3d[_0x1cf5be][_0x384c1b(0x20b)]=_0x5abab1;}),_0x402542[_0x549983(0x167)]((_0x305da6,_0x4a183e)=>{_0x893d3d[_0x4a183e]['batch_code']=_0x305da6;}),_0x1a84ce[_0x549983(0x167)]((_0x553a44,_0x5783a1)=>{var _0x3aace7=_0x549983;_0x893d3d[_0x5783a1][_0x3aace7(0x17f)]=_0x553a44;}),_0x431143[_0x549983(0x167)]((_0x85f61d,_0x1b017a)=>{var _0x33a3e9=_0x549983;_0x893d3d[_0x1b017a][_0x33a3e9(0x1e9)]=_0x85f61d;}),_0x12d9f7[_0x549983(0x167)]((_0x36eff6,_0x4f954e)=>{var _0x287a7f=_0x549983;_0x893d3d[_0x4f954e][_0x287a7f(0x1e0)]=_0x36eff6;}),_0x3eee83[_0x549983(0x167)]((_0x1cc724,_0x162ff4)=>{var _0xdbab6=_0x549983;_0x893d3d[_0x162ff4][_0xdbab6(0x201)]=_0x1cc724;}),_0x2f992b['forEach']((_0x55769e,_0x4bd758)=>{var _0x391a16=_0x549983;_0x893d3d[_0x4bd758][_0x391a16(0x172)]=_0x55769e;}),_0x2bdede[_0x549983(0x167)]((_0x2537a1,_0x2af46a)=>{var _0x57b6fb=_0x549983;_0x893d3d[_0x2af46a][_0x57b6fb(0x1e5)]=_0x2537a1;}),_0x4a5465[_0x549983(0x167)]((_0x340d8c,_0x2fc42e)=>{_0x893d3d[_0x2fc42e]['prod_cat']=_0x340d8c;}),_0x2aa9fa[_0x549983(0x167)]((_0x455fa9,_0x1a38ac)=>{var _0x3d9291=_0x549983;_0x893d3d[_0x1a38ac][_0x3d9291(0x1ee)]=_0x455fa9;}),_0x3b465f[_0x549983(0x167)]((_0x692793,_0x4e7eb2)=>{var _0x194831=_0x549983;_0x893d3d[_0x4e7eb2][_0x194831(0x148)]=_0x692793;}),_0x775973[_0x549983(0x167)]((_0x55a2a1,_0x569f50)=>{var _0x23e890=_0x549983;_0x893d3d[_0x569f50][_0x23e890(0x163)]=_0x55a2a1;});var _0x1c4431=0x0;_0x893d3d[_0x549983(0x167)](_0x5c361a=>{var _0x3a9e10=_0x549983;(_0x5c361a[_0x3a9e10(0x174)]<_0x5c361a[_0x3a9e10(0x1ee)]||_0x5c361a[_0x3a9e10(0x1ee)]==0x0)&&(console[_0x3a9e10(0x121)](_0x3a9e10(0x15a),_0x5c361a),_0x1c4431++);});const _0x2850a1=_0x893d3d[_0x549983(0x21f)](_0xb7e20b=>_0xb7e20b['quantity']!=='0'&&_0xb7e20b['quantity']!==''),_0xf720c4=new sales({'invoice':_0x37e347,'customer':_0x2b0cef[_0x549983(0x18b)][_0x549983(0x1b9)],'date':_0x37c651,'warehouse_name':_0x48f111,'sale_product':_0x2850a1,'note':_0x1a8c39,'room':_0x5a4dae,'primary_code':_0x2b564a,'secondary_code':_0x10f5d6,'prod_code':_0x36ddeb,'SCRN':_0x585c46}),_0x4f2987=await _0xf720c4[_0x549983(0x21a)]();_0x2b0cef[_0x549983(0x136)](_0x549983(0x1f3),_0x549983(0x207)),_0x23ab91['redirect']('/all_sales/preview/'+_0x4f2987[_0x549983(0x1da)]);}catch(_0x5343a3){console[_0x549983(0x121)](_0x5343a3);}}),router[a0_0x1bf8dd(0x187)](a0_0x1bf8dd(0x221),auth,async(_0x5da0cd,_0x19ea99)=>{var _0x10eb37=a0_0x1bf8dd;try{const {username:_0x3f8840,email:_0x19bcf1,role:_0xeda82a}=_0x5da0cd[_0x10eb37(0x16a)],_0x1dad9a=_0x5da0cd[_0x10eb37(0x16a)],_0x58726d=await profile[_0x10eb37(0x1ef)]({'email':_0x1dad9a[_0x10eb37(0x18e)]}),_0x531887=await master_shop[_0x10eb37(0x220)](),_0x1ea04a=_0x5da0cd[_0x10eb37(0x1f2)]['id'],_0x294433=await sales[_0x10eb37(0x12b)](_0x1ea04a),_0x477b21=await warehouse[_0x10eb37(0x146)]([{'$match':{'name':_0x294433[_0x10eb37(0x1a6)]}},{'$unwind':_0x10eb37(0x17b)},{'$group':{'_id':_0x10eb37(0x166),'name':{'$first':_0x10eb37(0x152)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x10eb37(0x154)},'bin':{'$first':_0x10eb37(0x1ae)},'type':{'$first':_0x10eb37(0x16e)},'floorlevel':{'$first':_0x10eb37(0x15f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x10eb37(0x165)},'storage':{'$first':_0x10eb37(0x168)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x10eb37(0x144)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x10eb37(0x1c4)}}}]),_0x31f8cc=await customer[_0x10eb37(0x220)]({});let _0x25fb5e;if(_0x1dad9a['role']==_0x10eb37(0x138)){const _0x5417f4=await staff[_0x10eb37(0x1ef)]({'email':_0x1dad9a[_0x10eb37(0x18e)]});_0x25fb5e=await warehouse['aggregate']([{'$match':{'status':_0x10eb37(0x20d),'name':_0x5417f4[_0x10eb37(0x205)]}},{'$group':{'_id':_0x10eb37(0x1a3),'name':{'$first':_0x10eb37(0x1a3)}}}]);}else _0x25fb5e=await warehouse[_0x10eb37(0x146)]([{'$match':{'status':_0x10eb37(0x20d)}},{'$group':{'_id':_0x10eb37(0x1a3),'name':{'$first':'$name'}}}]);const _0x5848de=await product[_0x10eb37(0x220)]({}),_0x56a73a=await suppliers[_0x10eb37(0x220)]({});if(_0x531887[0x0]['language']==_0x10eb37(0x18c)){var _0xdae987=users[_0x10eb37(0x227)];console['log'](_0xdae987);}else{if(_0x531887[0x0][_0x10eb37(0x179)]==_0x10eb37(0x228))var _0xdae987=users[_0x10eb37(0x228)];else{if(_0x531887[0x0]['language']=='German')var _0xdae987=users[_0x10eb37(0x135)];else{if(_0x531887[0x0][_0x10eb37(0x179)]=='Spanish')var _0xdae987=users[_0x10eb37(0x1e2)];else{if(_0x531887[0x0][_0x10eb37(0x179)]=='French')var _0xdae987=users[_0x10eb37(0x1fb)];else{if(_0x531887[0x0]['language']==_0x10eb37(0x20f))var _0xdae987=users[_0x10eb37(0x143)];else{if(_0x531887[0x0][_0x10eb37(0x179)]==_0x10eb37(0x19b))var _0xdae987=users[_0x10eb37(0x19b)];else{if(_0x531887[0x0][_0x10eb37(0x179)]=='Arabic\x20(ae)')var _0xdae987=users['Arabic'];}}}}}}}_0x19ea99[_0x10eb37(0x14b)]('edit_sales_view',{'success':_0x5da0cd[_0x10eb37(0x136)]('success'),'errors':_0x5da0cd[_0x10eb37(0x136)](_0x10eb37(0x190)),'role':_0x1dad9a,'profile':_0x58726d,'customer':_0x31f8cc,'warehouse':_0x25fb5e,'product':_0x477b21,'user':_0x294433,'master_shop':_0x531887,'unit':_0x5848de,'language':_0xdae987,'suppliers':_0x56a73a});}catch(_0x39c72a){console[_0x10eb37(0x121)](_0x39c72a);}}),router[a0_0x1bf8dd(0x223)](a0_0x1bf8dd(0x221),auth,async(_0x4e384f,_0x564fbc)=>{var _0x49b0d6=a0_0x1bf8dd;try{const _0x526822=_0x4e384f[_0x49b0d6(0x1f2)]['id'],{invoice:_0x44a7fd,warehouse_name:_0x20122a,room:_0x2a17ac}=_0x4e384f['body'],_0x3c0cf1=await sales['findOne']({'invoice':_0x44a7fd}),_0x3e99ef=_0x3c0cf1[_0x49b0d6(0x19a)][_0x49b0d6(0x1d9)](async _0x5e1263=>{var _0x503f45=_0x49b0d6,_0x2eae7d=await warehouse['findOne']({'name':_0x20122a,'room':_0x5e1263[_0x503f45(0x148)],'warehouse_category':_0x503f45(0x19c)});const _0x2af39b=_0x2eae7d[_0x503f45(0x1fe)][_0x503f45(0x1d9)](_0x5d7c3b=>{var _0x3a8c54=_0x503f45;_0x5d7c3b[_0x3a8c54(0x178)]==_0x5e1263[_0x3a8c54(0x178)]&&_0x5d7c3b['floorlevel']==_0x5e1263[_0x3a8c54(0x18a)]&&_0x5d7c3b[_0x3a8c54(0x125)]==_0x5e1263[_0x3a8c54(0x125)]&&_0x5d7c3b[_0x3a8c54(0x1fc)]==_0x5e1263[_0x3a8c54(0x1fc)]&&_0x5d7c3b['bay']==_0x5e1263['bay']&&_0x5d7c3b[_0x3a8c54(0x17d)]==_0x5e1263[_0x3a8c54(0x17d)]&&_0x5d7c3b[_0x3a8c54(0x1b3)]==_0x5e1263['storage']&&_0x5d7c3b['expiry_date']==_0x5e1263[_0x3a8c54(0x17f)]&&_0x5d7c3b[_0x3a8c54(0x1b5)]==_0x5e1263[_0x3a8c54(0x1b5)]&&_0x5d7c3b[_0x3a8c54(0x163)]==_0x5e1263[_0x3a8c54(0x163)]&&_0x5d7c3b[_0x3a8c54(0x1da)]==_0x5e1263[_0x3a8c54(0x1ce)]&&(_0x5d7c3b[_0x3a8c54(0x181)]=Math['max'](0x0,Math[_0x3a8c54(0x169)](_0x5d7c3b[_0x3a8c54(0x181)])-Math[_0x3a8c54(0x169)](_0x5e1263[_0x3a8c54(0x1c7)])));});return _0x2eae7d;});Promise[_0x49b0d6(0x1ea)](_0x3e99ef)[_0x49b0d6(0x15e)](async _0x3cb473=>{var _0x2836f8=_0x49b0d6;try{for(const _0x27ef7a of _0x3cb473){await _0x27ef7a[_0x2836f8(0x21a)]();}_0x3c0cf1['finalize']=_0x2836f8(0x15d);const _0x18bb9a=await _0x3c0cf1[_0x2836f8(0x21a)](),_0x22fcdb=await master_shop[_0x2836f8(0x220)](),_0x9831f7=await email_settings[_0x2836f8(0x1ef)](),_0x116124=await supervisor_settings[_0x2836f8(0x220)]();var _0xaf2428=_0x3c0cf1['sale_product'],_0x25ede4='',_0x170b87;for(_0x170b87 in _0xaf2428){_0x25ede4+=_0x2836f8(0x1cd)+_0x2836f8(0x1c2)+_0xaf2428[_0x170b87]['product_name']+_0x2836f8(0x18f)+_0x2836f8(0x1c2)+_0xaf2428[_0x170b87]['product_code']+_0x2836f8(0x18f)+_0x2836f8(0x1c2)+_0xaf2428[_0x170b87][_0x2836f8(0x1c7)]+_0x2836f8(0x18f)+_0x2836f8(0x1c2)+_0xaf2428[_0x170b87][_0x2836f8(0x195)]+_0x2836f8(0x18f)+_0x2836f8(0x1c2)+_0xaf2428[_0x170b87]['secondary_unit']+'</td>'+_0x2836f8(0x1c2)+_0x3c0cf1[_0x2836f8(0x1a6)]+_0x2836f8(0x18f)+_0x2836f8(0x1c2)+_0xaf2428[_0x170b87]['room_name']+_0x2836f8(0x18f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xaf2428[_0x170b87][_0x2836f8(0x1b3)]+_0xaf2428[_0x170b87][_0x2836f8(0x17d)]+_0xaf2428[_0x170b87][_0x2836f8(0x173)]+_0xaf2428[_0x170b87]['bin']+_0xaf2428[_0x170b87][_0x2836f8(0x125)][0x0]+_0xaf2428[_0x170b87]['floorlevel']+_0x2836f8(0x18f),_0x2836f8(0x139);}let _0x195312=nodemailer['createTransport']({'host':_0x9831f7[_0x2836f8(0x1a4)],'port':Number(_0x9831f7[_0x2836f8(0x183)]),'secure':![],'auth':{'user':_0x9831f7[_0x2836f8(0x18e)],'pass':_0x9831f7[_0x2836f8(0x17a)]}}),_0x34c722={'from':_0x9831f7[_0x2836f8(0x18e)],'to':_0x116124[0x0][_0x2836f8(0x1f7)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x2836f8(0x206),'path':__dirname+_0x2836f8(0x15c)+_0x2836f8(0x13e)+_0x22fcdb[0x0][_0x2836f8(0x1ec)],'cid':_0x2836f8(0x150)}],'html':'<!DOCTYPE\x20html>'+_0x2836f8(0x14f)+_0x2836f8(0x1c3)+_0x2836f8(0x226)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2836f8(0x226)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2836f8(0x124)+_0x2836f8(0x226)+_0x2836f8(0x12c)+_0x22fcdb[0x0]['site_title']+_0x2836f8(0x1cb)+_0x2836f8(0x124)+'</div>'+_0x2836f8(0x1d3)+'<div>'+_0x2836f8(0x21e)+_0x2836f8(0x17e)+_0x3c0cf1[_0x2836f8(0x163)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x3c0cf1['date']+'\x20'+_0x2836f8(0x19e)+'</h5>'+'</div>'+_0x2836f8(0x1d1)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x2836f8(0x137)+_0x2836f8(0x13c)+_0x2836f8(0x159)+_0x2836f8(0x132)+_0x2836f8(0x1c6)+_0x2836f8(0x1b0)+_0x2836f8(0x160)+_0x2836f8(0x1ba)+_0x2836f8(0x139)+_0x2836f8(0x1fa)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x25ede4+'\x20'+_0x2836f8(0x177)+_0x2836f8(0x1d4)+_0x2836f8(0x226)+_0x2836f8(0x129)+'<h5>'+_0x22fcdb[0x0]['site_title']+_0x2836f8(0x1f8)+_0x2836f8(0x124)+_0x2836f8(0x124)+_0x2836f8(0x1eb)};_0x195312['sendMail'](_0x34c722,function(_0x22fe5a,_0x44cb12){var _0x1dced9=_0x2836f8;_0x22fe5a?(console[_0x1dced9(0x121)](_0x22fe5a),console[_0x1dced9(0x121)](_0x1dced9(0x215))):console[_0x1dced9(0x121)]('Email\x20sent\x20successfully');}),_0x4e384f[_0x2836f8(0x136)]('success','Sales\x20Update\x20successfully'),_0x564fbc['redirect'](_0x2836f8(0x196)+_0x526822);}catch(_0x52bbac){console[_0x2836f8(0x12d)](_0x52bbac),_0x564fbc['status'](0x1f4)['json']({'error':_0x2836f8(0x17c)});}})[_0x49b0d6(0x198)](_0x53ee40=>{var _0x172446=_0x49b0d6;console[_0x172446(0x12d)](_0x53ee40),_0x564fbc['status'](0x1f4)[_0x172446(0x140)]({'error':_0x172446(0x20a)});});}catch(_0x4aa9a1){console[_0x49b0d6(0x121)](_0x4aa9a1);}}),router[a0_0x1bf8dd(0x187)](a0_0x1bf8dd(0x185),auth,async(_0x5d5eb1,_0x2da967)=>{var _0x5d6a68=a0_0x1bf8dd;try{const {username:_0x42654a,email:_0x20abf7,role:_0xba226b}=_0x5d5eb1[_0x5d6a68(0x16a)],_0x32d86c=_0x5d5eb1['user'],_0x64e915=await profile[_0x5d6a68(0x1ef)]({'email':_0x32d86c['email']}),_0x2958d4=await master_shop[_0x5d6a68(0x220)](),_0x2c16e9=_0x5d5eb1[_0x5d6a68(0x1f2)]['id'],_0x400216=await sales[_0x5d6a68(0x12b)](_0x2c16e9);var _0x1c57d3=[_0x5d6a68(0x1a5),'Enclosed'];const _0x1dbbfd=await warehouse[_0x5d6a68(0x146)]([{'$match':{'name':_0x400216[_0x5d6a68(0x1a6)],'warehouse_category':_0x5d6a68(0x19c)}},{'$unwind':_0x5d6a68(0x17b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5d6a68(0x152)},'product_stock':{'$first':_0x5d6a68(0x1bf)},'bay':{'$first':_0x5d6a68(0x154)},'bin':{'$first':_0x5d6a68(0x1ae)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5d6a68(0x15f)},'primary_code':{'$first':_0x5d6a68(0x1ed)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5d6a68(0x165)},'storage':{'$first':_0x5d6a68(0x168)},'rack':{'$first':_0x5d6a68(0x1b8)}}}]),_0x40e922=await customer[_0x5d6a68(0x220)]({});let _0x51c030;if(_0x32d86c[_0x5d6a68(0x212)]==_0x5d6a68(0x138)){const _0x2cb62d=await staff[_0x5d6a68(0x1ef)]({'email':_0x32d86c['email']});_0x51c030=await warehouse[_0x5d6a68(0x146)]([{'$match':{'status':'Enabled','name':_0x2cb62d['warehouse'],'warehouse_category':_0x5d6a68(0x19c)}},{'$group':{'_id':_0x5d6a68(0x1a3),'name':{'$first':_0x5d6a68(0x1a3)}}}]);}else _0x51c030=await warehouse[_0x5d6a68(0x146)]([{'$match':{'status':_0x5d6a68(0x20d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x5d6a68(0x1a3)}}}]);const _0x5d7505=await product[_0x5d6a68(0x220)]({});if(_0x2958d4[0x0]['language']==_0x5d6a68(0x18c)){var _0x475035=users['English'];console['log'](_0x475035);}else{if(_0x2958d4[0x0][_0x5d6a68(0x179)]==_0x5d6a68(0x228))var _0x475035=users[_0x5d6a68(0x228)];else{if(_0x2958d4[0x0][_0x5d6a68(0x179)]==_0x5d6a68(0x135))var _0x475035=users[_0x5d6a68(0x135)];else{if(_0x2958d4[0x0]['language']==_0x5d6a68(0x1e2))var _0x475035=users['Spanish'];else{if(_0x2958d4[0x0][_0x5d6a68(0x179)]=='French')var _0x475035=users[_0x5d6a68(0x1fb)];else{if(_0x2958d4[0x0]['language']=='Portuguese\x20(BR)')var _0x475035=users[_0x5d6a68(0x143)];else{if(_0x2958d4[0x0]['language']==_0x5d6a68(0x19b))var _0x475035=users[_0x5d6a68(0x19b)];else{if(_0x2958d4[0x0][_0x5d6a68(0x179)]=='Arabic\x20(ae)')var _0x475035=users[_0x5d6a68(0x147)];}}}}}}}_0x2da967[_0x5d6a68(0x14b)](_0x5d6a68(0x204),{'success':_0x5d5eb1[_0x5d6a68(0x136)](_0x5d6a68(0x1f3)),'errors':_0x5d5eb1[_0x5d6a68(0x136)]('errors'),'role':_0x32d86c,'profile':_0x64e915,'customer':_0x40e922,'warehouse':_0x51c030,'product':_0x1dbbfd,'user':_0x400216,'master_shop':_0x2958d4,'unit':_0x5d7505,'language':_0x475035});}catch(_0x55171f){console[_0x5d6a68(0x121)](_0x55171f);}}),router[a0_0x1bf8dd(0x223)](a0_0x1bf8dd(0x185),auth,async(_0x499e98,_0x24b794)=>{var _0x4b0abb=a0_0x1bf8dd;try{const _0x8a9f88=_0x499e98[_0x4b0abb(0x1f2)]['id'],_0x30cb94=await sales[_0x4b0abb(0x1ef)]({'_id':_0x499e98['params']['id']}),_0x31df94=await warehouse[_0x4b0abb(0x1ef)]({'name':_0x30cb94[_0x4b0abb(0x1a6)],'room':_0x499e98[_0x4b0abb(0x18b)]['room']}),{invoice:_0x4d48b8,date:_0x1b85c6,warehouse_name:_0x1ee77d,product_name:_0x46e2bb,stock:_0x3298a6,quantity:_0x3cbb5d,note:_0x1cbce4,room:_0x1d1f2d,customer:_0x546c71,SCRN:_0x380e97}=_0x499e98[_0x4b0abb(0x18b)];if(typeof _0x46e2bb==_0x4b0abb(0x182))var _0x39bd39=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x178)]],_0x44b167=[_0x499e98[_0x4b0abb(0x18b)]['stock']],_0x2b2ef1=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x199)]],_0x4319af=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x157)]],_0x4e6c43=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x21d)]],_0x5257fa=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x18d)]],_0x4e3520=[_0x499e98['body']['level']],_0x3df91a=[_0x499e98['body']['primary_unit']],_0x44a454=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x20b)]],_0x425e22=[_0x499e98['body'][_0x4b0abb(0x1b5)]],_0x570a2d=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x17f)]],_0x3bfcea=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1ca)]],_0x57b0b5=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1e0)]],_0x2537d3=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x201)]],_0x166a99=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x172)]],_0x34b769=[_0x499e98[_0x4b0abb(0x18b)]['delivery_code']],_0x81908d=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x171)]],_0x22ddbd=[_0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1c7)]],_0x283a71=[_0x499e98['body'][_0x4b0abb(0x210)]];else var _0x39bd39=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x178)]],_0x44b167=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x174)]],_0x2b2ef1=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x199)]],_0x4319af=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x157)]],_0x4e6c43=[..._0x499e98['body'][_0x4b0abb(0x21d)]],_0x5257fa=[..._0x499e98['body'][_0x4b0abb(0x18d)]],_0x4e3520=[..._0x499e98[_0x4b0abb(0x18b)]['level']],_0x3df91a=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1e1)]],_0x44a454=[..._0x499e98[_0x4b0abb(0x18b)]['secondary_unit']],_0x425e22=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1b5)]],_0x570a2d=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x17f)]],_0x3bfcea=[..._0x499e98['body'][_0x4b0abb(0x1ca)]],_0x57b0b5=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1e0)]],_0x2537d3=[..._0x499e98['body'][_0x4b0abb(0x201)]],_0x166a99=[..._0x499e98[_0x4b0abb(0x18b)]['delivery_date']],_0x34b769=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x1e5)]],_0x81908d=[..._0x499e98['body']['prod_cat']],_0x22ddbd=[..._0x499e98['body'][_0x4b0abb(0x1c7)]],_0x283a71=[..._0x499e98[_0x4b0abb(0x18b)][_0x4b0abb(0x210)]];const _0x14531b=_0x39bd39['map'](_0xabb320=>{return _0xabb320={'product_name':_0xabb320};});_0x44b167['forEach']((_0xee6424,_0x4a10a9)=>{var _0x3667e8=_0x4b0abb;_0x14531b[_0x4a10a9][_0x3667e8(0x174)]=Math['abs'](_0xee6424);}),_0x2b2ef1[_0x4b0abb(0x167)]((_0xc60488,_0xac6602)=>{var _0xd776c9=_0x4b0abb;_0x14531b[_0xac6602][_0xd776c9(0x1c7)]=_0xc60488;}),_0x4319af[_0x4b0abb(0x167)]((_0xeb7c68,_0x3d93fe)=>{var _0xcb6ad2=_0x4b0abb;_0x14531b[_0x3d93fe][_0xcb6ad2(0x157)]=_0xeb7c68;}),_0x4e6c43['forEach']((_0x30f937,_0x325793)=>{var _0x29b99d=_0x4b0abb;_0x14531b[_0x325793][_0x29b99d(0x21d)]=_0x30f937;}),_0x5257fa[_0x4b0abb(0x167)]((_0x1886f2,_0x276610)=>{var _0x557b39=_0x4b0abb;_0x14531b[_0x276610][_0x557b39(0x1d7)]=_0x1886f2;}),_0x4e3520[_0x4b0abb(0x167)]((_0x1ca13b,_0x1ce1c8)=>{_0x283a71['forEach']((_0x43b680,_0x8950fb)=>{var _0x44d1f8=a0_0x128d;if(_0x43b680==_0x44d1f8(0x14c)&&_0x1ce1c8==_0x8950fb){var _0x5a67bf=_0x1ca13b['slice'](0x3);_0x14531b[_0x1ce1c8][_0x44d1f8(0x1b3)]=_0x1ca13b[0x0],_0x14531b[_0x1ce1c8][_0x44d1f8(0x17d)]=_0x1ca13b[0x1],_0x14531b[_0x1ce1c8][_0x44d1f8(0x173)]=0x0,_0x14531b[_0x1ce1c8][_0x44d1f8(0x1fc)]=0x0,_0x14531b[_0x1ce1c8][_0x44d1f8(0x125)]=_0x44d1f8(0x16b),_0x14531b[_0x1ce1c8][_0x44d1f8(0x18a)]=_0x5a67bf;}else{if(_0x43b680==_0x44d1f8(0x1c8)&&_0x1ce1c8==_0x8950fb){var _0x5a67bf=_0x1ca13b[_0x44d1f8(0x151)](0x3);_0x14531b[_0x1ce1c8][_0x44d1f8(0x1b3)]=_0x1ca13b[0x0],_0x14531b[_0x1ce1c8]['rack']=_0x1ca13b[0x1],_0x14531b[_0x1ce1c8][_0x44d1f8(0x173)]=0x0,_0x14531b[_0x1ce1c8][_0x44d1f8(0x1fc)]=0x0,_0x14531b[_0x1ce1c8][_0x44d1f8(0x125)]=_0x44d1f8(0x16b),_0x14531b[_0x1ce1c8][_0x44d1f8(0x18a)]=_0x1ca13b[0x5];}else{if(_0x1ce1c8==_0x8950fb){var _0x3d3122;if(_0x1ca13b[0x4]=='L')_0x3d3122=_0x44d1f8(0x186);else _0x1ca13b[0x4]=='F'&&(_0x3d3122='Floor');_0x14531b[_0x1ce1c8]['storage']=_0x1ca13b[0x0],_0x14531b[_0x1ce1c8][_0x44d1f8(0x17d)]=_0x1ca13b[0x1],_0x14531b[_0x1ce1c8][_0x44d1f8(0x173)]=_0x1ca13b[0x2],_0x14531b[_0x1ce1c8]['bin']=_0x1ca13b[0x3],_0x14531b[_0x1ce1c8][_0x44d1f8(0x125)]=_0x3d3122,_0x14531b[_0x1ce1c8]['floorlevel']=_0x1ca13b[0x5];}}}});}),_0x3df91a[_0x4b0abb(0x167)]((_0x24f7d4,_0x42b397)=>{var _0x246807=_0x4b0abb;_0x14531b[_0x42b397][_0x246807(0x195)]=_0x24f7d4;}),_0x44a454[_0x4b0abb(0x167)]((_0x54f702,_0x1f7096)=>{var _0x5801a7=_0x4b0abb;_0x14531b[_0x1f7096][_0x5801a7(0x20b)]=_0x54f702;}),_0x425e22[_0x4b0abb(0x167)]((_0x4f2a39,_0x998991)=>{_0x14531b[_0x998991]['batch_code']=_0x4f2a39;}),_0x570a2d[_0x4b0abb(0x167)]((_0x14adc4,_0x1f7b85)=>{_0x14531b[_0x1f7b85]['expiry_date']=_0x14adc4;}),_0x3bfcea[_0x4b0abb(0x167)]((_0x3fb5f6,_0x4ae6a6)=>{var _0x46bd26=_0x4b0abb;_0x14531b[_0x4ae6a6][_0x46bd26(0x1e9)]=_0x3fb5f6;}),_0x57b0b5[_0x4b0abb(0x167)]((_0x33bfeb,_0x11fac3)=>{_0x14531b[_0x11fac3]['production_date']=_0x33bfeb;}),_0x2537d3[_0x4b0abb(0x167)]((_0x5d4da3,_0x4ee39f)=>{var _0x46504f=_0x4b0abb;_0x14531b[_0x4ee39f][_0x46504f(0x201)]=Math[_0x46504f(0x169)](_0x5d4da3);}),_0x166a99[_0x4b0abb(0x167)]((_0x55a49f,_0x3a0102)=>{var _0x2382c1=_0x4b0abb;_0x14531b[_0x3a0102][_0x2382c1(0x172)]=_0x55a49f;}),_0x34b769[_0x4b0abb(0x167)]((_0x2fead0,_0xcf8a47)=>{var _0x5259a7=_0x4b0abb;_0x14531b[_0xcf8a47][_0x5259a7(0x1e5)]=_0x2fead0;}),_0x81908d[_0x4b0abb(0x167)]((_0x1f4687,_0x2599d9)=>{_0x14531b[_0x2599d9]['prod_cat']=_0x1f4687;}),_0x22ddbd[_0x4b0abb(0x167)]((_0xf62c59,_0x4c05e2)=>{var _0x52e417=_0x4b0abb;_0x14531b[_0x4c05e2][_0x52e417(0x1ee)]=_0xf62c59;}),_0x283a71[_0x4b0abb(0x167)]((_0x4c453a,_0x43ee30)=>{var _0x515b53=_0x4b0abb;_0x14531b[_0x43ee30][_0x515b53(0x148)]=_0x4c453a;});var _0x148718=0x0;_0x14531b[_0x4b0abb(0x167)](_0x1f822f=>{var _0x19573b=_0x4b0abb;console['log'](_0x19573b(0x15a),_0x1f822f),(parseInt(_0x1f822f[_0x19573b(0x174)])<parseInt(_0x1f822f[_0x19573b(0x1c7)])||parseInt(_0x1f822f['quantity'])==0x0)&&_0x148718++;});if(_0x148718!=0x0)return _0x499e98['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x24b794['redirect'](_0x4b0abb(0x1bc));const _0x41071e=_0x14531b[_0x4b0abb(0x21f)](_0x55e450=>_0x55e450['quantity']!=='0'&&_0x55e450['quantity']!=='');_0x30cb94[_0x4b0abb(0x163)]=_0x4d48b8,_0x30cb94[_0x4b0abb(0x1b9)]=_0x546c71,_0x30cb94[_0x4b0abb(0x1a8)]=_0x1b85c6,_0x30cb94[_0x4b0abb(0x1a6)]=_0x1ee77d,_0x30cb94[_0x4b0abb(0x19a)]=_0x41071e,_0x30cb94[_0x4b0abb(0x224)]=_0x1cbce4,_0x30cb94[_0x4b0abb(0x1e3)]=_0x380e97,_0x30cb94['finalize']='False',_0x30cb94[_0x4b0abb(0x123)]=_0x4b0abb(0x11f);const _0x2028bd=await _0x30cb94[_0x4b0abb(0x21a)]();_0x499e98[_0x4b0abb(0x136)](_0x4b0abb(0x1f3),'Sales\x20Update\x20successfully'),_0x24b794['redirect']('/all_sales/view');}catch(_0x570a9d){console['log'](_0x570a9d);}}),router[a0_0x1bf8dd(0x223)]('/give_payment/:id',auth,async(_0x3d0dd6,_0x1b02cd)=>{var _0x538521=a0_0x1bf8dd;try{const _0x5299ad=_0x3d0dd6[_0x538521(0x1f2)]['id'],{invoice:_0x30174b,customer:_0x245cdf,receivable_amount:_0xeaa41c,received_amount:_0x8b7c93}=_0x3d0dd6[_0x538521(0x18b)],_0x4641b3=await sales[_0x538521(0x12b)](_0x5299ad);console[_0x538521(0x121)](_0x4641b3);var _0x5abfe3=_0xeaa41c-_0x8b7c93;console[_0x538521(0x121)](_0x8b7c93),_0x4641b3[_0x538521(0x15b)]=parseFloat(_0x8b7c93)+parseFloat(_0x4641b3[_0x538521(0x15b)]),_0x4641b3['due_amount']=_0x5abfe3,console['log'](_0x4641b3);const _0x4b01c5=await _0x4641b3[_0x538521(0x21a)](),_0x18f6e8=await c_payment_data[_0x538521(0x1ef)]({'invoice':_0x30174b});_0x18f6e8['amount']=_0x5abfe3,await _0x18f6e8['save']();let _0x204efb=new Date(),_0x3970ea=('0'+_0x204efb[_0x538521(0x180)]())[_0x538521(0x151)](-0x2),_0x36b275=('0'+(_0x204efb[_0x538521(0x1be)]()+0x1))[_0x538521(0x151)](-0x2),_0x21a2ce=_0x204efb[_0x538521(0x175)](),_0x263fcc=_0x21a2ce+'-'+_0x36b275+'-'+_0x3970ea;const _0x175f08=new customer_payment({'invoice':_0x30174b,'date':_0x21a2ce+'-'+_0x36b275+'-'+_0x3970ea,'customer':_0x245cdf,'reason':_0x538521(0x131),'amount':_0x8b7c93}),_0x126812=await _0x175f08[_0x538521(0x21a)]();_0x3d0dd6[_0x538521(0x136)](_0x538521(0x1f3),_0x538521(0x12e)),_0x1b02cd[_0x538521(0x133)](_0x538521(0x1d0));}catch(_0x866027){console[_0x538521(0x121)](_0x866027);}}),router['get']('/invoice/:id',auth,async(_0x3f3e68,_0x9c18eb)=>{var _0x3998c3=a0_0x1bf8dd;try{const {username:_0x49bb4a,email:_0x257d29,role:_0x1a988a}=_0x3f3e68[_0x3998c3(0x16a)],_0x23e6c3=_0x3f3e68[_0x3998c3(0x16a)],_0x4eebee=await profile[_0x3998c3(0x1ef)]({'email':_0x23e6c3[_0x3998c3(0x18e)]}),_0x3c707e=await master_shop[_0x3998c3(0x220)]();console['log'](_0x3998c3(0x1dc),_0x3c707e);const _0x50191c=_0x3f3e68[_0x3998c3(0x1f2)]['id'],_0x50265b=await sales[_0x3998c3(0x12b)](_0x50191c);console['log'](_0x50265b);const _0x564d95=await customer[_0x3998c3(0x1ef)]({'name':_0x50265b[_0x3998c3(0x1b9)]});console['log'](_0x564d95);if(_0x3c707e[0x0][_0x3998c3(0x179)]==_0x3998c3(0x18c)){var _0x56f547=users[_0x3998c3(0x227)];console[_0x3998c3(0x121)](_0x56f547);}else{if(_0x3c707e[0x0][_0x3998c3(0x179)]=='Hindi')var _0x56f547=users['Hindi'];else{if(_0x3c707e[0x0][_0x3998c3(0x179)]=='German')var _0x56f547=users[_0x3998c3(0x135)];else{if(_0x3c707e[0x0]['language']==_0x3998c3(0x1e2))var _0x56f547=users['Spanish'];else{if(_0x3c707e[0x0][_0x3998c3(0x179)]==_0x3998c3(0x1fb))var _0x56f547=users[_0x3998c3(0x1fb)];else{if(_0x3c707e[0x0]['language']==_0x3998c3(0x20f))var _0x56f547=users[_0x3998c3(0x143)];else{if(_0x3c707e[0x0][_0x3998c3(0x179)]==_0x3998c3(0x19b))var _0x56f547=users['Chinese'];else{if(_0x3c707e[0x0][_0x3998c3(0x179)]==_0x3998c3(0x217))var _0x56f547=users['Arabic'];}}}}}}}_0x9c18eb[_0x3998c3(0x14b)](_0x3998c3(0x1b6),{'success':_0x3f3e68[_0x3998c3(0x136)](_0x3998c3(0x1f3)),'errors':_0x3f3e68[_0x3998c3(0x136)](_0x3998c3(0x190)),'role':_0x23e6c3,'profile':_0x4eebee,'master_shop':_0x3c707e,'customers':_0x564d95,'sales':_0x50265b,'language':_0x56f547});}catch(_0x2cb5e6){console['log'](_0x2cb5e6);}}),router[a0_0x1bf8dd(0x187)](a0_0x1bf8dd(0x170),auth,async(_0x4428f0,_0x348de7)=>{var _0x59b591=a0_0x1bf8dd;try{const {username:_0x456978,email:_0x296707,role:_0x140b11}=_0x4428f0[_0x59b591(0x16a)],_0x55586a=_0x4428f0[_0x59b591(0x16a)],_0x3fc418=await profile[_0x59b591(0x1ef)]({'email':_0x55586a['email']}),_0x2a631=await master_shop[_0x59b591(0x220)]();console['log'](_0x59b591(0x1dc),_0x2a631);const _0xe2a5b4=_0x4428f0[_0x59b591(0x1f2)]['id'];console[_0x59b591(0x121)](_0xe2a5b4);const _0x57a9b4=await sales[_0x59b591(0x12b)](_0xe2a5b4);console[_0x59b591(0x121)](_0x59b591(0x209),_0x57a9b4);const _0x5afbbf=await warehouse[_0x59b591(0x146)]([{'$match':{'name':_0x59b591(0x1db),'room':_0x59b591(0x149)}},{'$unwind':_0x59b591(0x17b)},{'$group':{'_id':_0x59b591(0x166),'name':{'$first':_0x59b591(0x152)},'product_stock':{'$first':_0x59b591(0x1bf)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x59b591(0x1af)},'pallet':{'$first':_0x59b591(0x164)},'primary_code':{'$first':_0x59b591(0x1ed)},'secondary_code':{'$first':_0x59b591(0x120)},'product_code':{'$first':'$product_details.product_code'}}}]);console['log']('stock_data',_0x5afbbf);const _0x35221e=await product[_0x59b591(0x220)]({});warehouse_data=await warehouse[_0x59b591(0x146)]([{'$match':{'status':'Enabled','name':_0x59b591(0x1db),'warehouse_category':_0x59b591(0x19c)}},{'$group':{'_id':'$name','name':{'$first':_0x59b591(0x1a3)}}},{'$sort':{'name':0x1}}]);var _0x558575=['Return\x20Rooms'];if(_0x2a631[0x0][_0x59b591(0x179)]==_0x59b591(0x18c)){var _0x5895a2=users['English'];console[_0x59b591(0x121)](_0x5895a2);}else{if(_0x2a631[0x0]['language']==_0x59b591(0x228))var _0x5895a2=users['Hindi'];else{if(_0x2a631[0x0][_0x59b591(0x179)]==_0x59b591(0x135))var _0x5895a2=users[_0x59b591(0x135)];else{if(_0x2a631[0x0][_0x59b591(0x179)]==_0x59b591(0x1e2))var _0x5895a2=users[_0x59b591(0x1e2)];else{if(_0x2a631[0x0][_0x59b591(0x179)]=='French')var _0x5895a2=users[_0x59b591(0x1fb)];else{if(_0x2a631[0x0][_0x59b591(0x179)]==_0x59b591(0x20f))var _0x5895a2=users[_0x59b591(0x143)];else{if(_0x2a631[0x0][_0x59b591(0x179)]=='Chinese')var _0x5895a2=users[_0x59b591(0x19b)];else{if(_0x2a631[0x0][_0x59b591(0x179)]==_0x59b591(0x217))var _0x5895a2=users[_0x59b591(0x147)];}}}}}}}_0x348de7[_0x59b591(0x14b)]('return_sale',{'success':_0x4428f0[_0x59b591(0x136)](_0x59b591(0x1f3)),'errors':_0x4428f0['flash'](_0x59b591(0x190)),'role':_0x55586a,'profile':_0x3fc418,'user':_0x57a9b4,'stock':_0x5afbbf,'master_shop':_0x2a631,'unit':_0x35221e,'language':_0x5895a2,'warehouses':warehouse_data,'rooms':_0x558575});}catch(_0xe094a9){console[_0x59b591(0x121)](_0xe094a9),_0x348de7[_0x59b591(0x130)](0xc8)[_0x59b591(0x140)]({'message':_0xe094a9[_0x59b591(0x1dd)]});}}),router[a0_0x1bf8dd(0x223)]('/view/return_sales/:id',auth,async(_0x23a402,_0x18f763)=>{var _0x196703=a0_0x1bf8dd;try{const {invoice:_0x48085f,date:_0x4228fb,warehouse_name:_0x580cbd,product_name:_0xcd407a,primary_code:_0x4b27d7,secondary_code:_0x2ecc5f,product_code:_0x55cfc6,sales_quantity:_0x15a964,stocks:_0x1835b5,return_qty:_0x7b57eb,Room_name:_0x504f8f,to_warehouse_name:_0x577d9c,to_Roomname:_0x4b01e1,to_Room_name:_0x3c8857,note:_0x143830,level:_0x5b3714,isle:_0x4bc282,pallet:_0x227f57}=_0x23a402['body'];if(typeof _0xcd407a==_0x196703(0x182))var _0x1506df=[_0x23a402[_0x196703(0x18b)][_0x196703(0x178)]],_0x9a44d7=[_0x23a402[_0x196703(0x18b)][_0x196703(0x157)]],_0x2a23e6=[_0x23a402['body']['secondary_code']],_0x273d9b=[_0x23a402[_0x196703(0x18b)]['product_code']],_0x53d6c2=[_0x23a402['body'][_0x196703(0x219)]],_0xe11715=[_0x23a402['body'][_0x196703(0x126)]],_0x140f17=[_0x23a402[_0x196703(0x18b)][_0x196703(0x1c0)]],_0x2c66c3=[_0x23a402[_0x196703(0x18b)]['bay']],_0x3e221f=[_0x23a402['body'][_0x196703(0x1fc)]],_0x401be0=[_0x23a402[_0x196703(0x18b)][_0x196703(0x1a0)]],_0xda9f50=[_0x23a402[_0x196703(0x18b)][_0x196703(0x18a)]];else var _0x1506df=[..._0x23a402[_0x196703(0x18b)][_0x196703(0x178)]],_0x9a44d7=[..._0x23a402['body'][_0x196703(0x157)]],_0x2a23e6=[..._0x23a402[_0x196703(0x18b)]['secondary_code']],_0x273d9b=[..._0x23a402['body'][_0x196703(0x1d7)]],_0x53d6c2=[..._0x23a402['body'][_0x196703(0x219)]],_0xe11715=[..._0x23a402['body'][_0x196703(0x126)]],_0x140f17=[..._0x23a402[_0x196703(0x18b)][_0x196703(0x1c0)]],_0x2c66c3=[..._0x23a402[_0x196703(0x18b)]['bay']],_0x3e221f=[..._0x23a402[_0x196703(0x18b)][_0x196703(0x1fc)]],_0x401be0=[..._0x23a402['body'][_0x196703(0x1a0)]],_0xda9f50=[..._0x23a402['body'][_0x196703(0x18a)]];const _0x5cf4c3=_0x1506df[_0x196703(0x1d9)](_0x1a7312=>{return _0x1a7312={'product_name':_0x1a7312};});_0x9a44d7[_0x196703(0x167)]((_0x4f1548,_0x9aae46)=>{var _0x10c5a4=_0x196703;_0x5cf4c3[_0x9aae46][_0x10c5a4(0x157)]=_0x4f1548;}),_0x2a23e6[_0x196703(0x167)]((_0xf8b7f3,_0x4c09b4)=>{var _0x636fec=_0x196703;_0x5cf4c3[_0x4c09b4][_0x636fec(0x21d)]=_0xf8b7f3;}),_0x273d9b['forEach']((_0x58b31c,_0x43df8a)=>{var _0x216d3d=_0x196703;_0x5cf4c3[_0x43df8a][_0x216d3d(0x1d7)]=_0x58b31c;}),_0x53d6c2['forEach']((_0x1aeebd,_0x126868)=>{_0x5cf4c3[_0x126868]['sale_qty']=_0x1aeebd;}),_0xe11715[_0x196703(0x167)]((_0x4654c0,_0x4a855f)=>{_0x5cf4c3[_0x4a855f]['stock']=_0x4654c0;}),_0x140f17[_0x196703(0x167)]((_0x52590a,_0x549751)=>{var _0x3fd1c4=_0x196703;_0x5cf4c3[_0x549751][_0x3fd1c4(0x1c0)]=_0x52590a;}),_0x2c66c3[_0x196703(0x167)]((_0x5e345e,_0x579daa)=>{var _0x2fc9b7=_0x196703;_0x5cf4c3[_0x579daa][_0x2fc9b7(0x173)]=_0x5e345e;}),_0x3e221f[_0x196703(0x167)]((_0x34d1f8,_0x170dde)=>{var _0x221113=_0x196703;_0x5cf4c3[_0x170dde][_0x221113(0x1fc)]=_0x34d1f8;}),_0x401be0[_0x196703(0x167)]((_0x20bfc3,_0x45a470)=>{var _0x5b301a=_0x196703;_0x5cf4c3[_0x45a470][_0x5b301a(0x125)]=_0x20bfc3;}),_0xda9f50[_0x196703(0x167)]((_0x5c5474,_0x233cb2)=>{var _0x1327b9=_0x196703;_0x5cf4c3[_0x233cb2][_0x1327b9(0x18a)]=_0x5c5474;});var _0x2ee61a=0x0;_0x5cf4c3[_0x196703(0x167)](_0x621ac5=>{var _0x49160d=_0x196703;console['log'](_0x49160d(0x15a),_0x621ac5),(parseInt(_0x621ac5[_0x49160d(0x188)])<parseInt(_0x621ac5[_0x49160d(0x1c0)])||parseInt(_0x621ac5[_0x49160d(0x174)])<parseInt(_0x621ac5[_0x49160d(0x1c0)])&&parseInt(_0x621ac5[_0x49160d(0x188)])>parseInt(_0x621ac5[_0x49160d(0x1c0)])||parseInt(_0x621ac5['return_qty'])==0x0)&&_0x2ee61a++;});if(_0x2ee61a!=0x0)return _0x23a402[_0x196703(0x136)](_0x196703(0x190),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x18f763[_0x196703(0x133)]('back');const _0x21e4f7=await sales['findOne']({'invoice':_0x48085f});console['log'](_0x21e4f7),_0x21e4f7[_0x196703(0x1bd)]='True';const _0x59840d=await _0x21e4f7[_0x196703(0x21a)](),_0x14cb6d=new sales_return({'invoice':_0x48085f,'customer':_0x23a402[_0x196703(0x18b)][_0x196703(0x1b9)],'date':_0x4228fb,'warehouse_name':_0x580cbd,'room':_0x504f8f,'ToWarehouse':_0x577d9c,'ToRoom':_0x3c8857,'return_sale':_0x5cf4c3,'note':_0x143830}),_0x343258=await _0x14cb6d['save']();console['log'](_0x14cb6d);const _0x4e9f4e=await sales_return[_0x196703(0x1ef)]({'invoice':_0x48085f}),_0x24e5a3=await warehouse[_0x196703(0x1ef)]({'name':_0x577d9c,'room':_0x3c8857});_0x4e9f4e[_0x196703(0x1e8)][_0x196703(0x167)](_0x43c2c9=>{var _0x494755=_0x196703,_0x2dd98a=0x0;const _0x1e19ec=_0x24e5a3[_0x494755(0x1fe)][_0x494755(0x1d9)](_0xab4352=>{var _0x58da15=_0x494755;_0xab4352['product_name']==_0x43c2c9[_0x58da15(0x178)]&&_0xab4352[_0x58da15(0x18a)]==_0x43c2c9[_0x58da15(0x18a)]&&_0xab4352['type']==_0x43c2c9[_0x58da15(0x125)]&&_0xab4352[_0x58da15(0x1fc)]==_0x43c2c9[_0x58da15(0x1fc)]&&_0xab4352[_0x58da15(0x173)]==_0x43c2c9[_0x58da15(0x173)]&&(_0xab4352[_0x58da15(0x181)]=parseInt(_0xab4352[_0x58da15(0x181)])+parseInt(_0x43c2c9['return_qty']),_0x2dd98a++);});_0x2dd98a=='0'&&(_0x24e5a3[_0x494755(0x1fe)]=_0x24e5a3[_0x494755(0x1fe)]['concat']({'product_name':_0x43c2c9[_0x494755(0x178)],'product_stock':_0x43c2c9[_0x494755(0x1c0)],'primary_code':_0x43c2c9[_0x494755(0x157)],'secondary_code':_0x43c2c9[_0x494755(0x21d)],'product_code':_0x43c2c9[_0x494755(0x1d7)],'bay':_0x43c2c9[_0x494755(0x173)],'bin':_0x43c2c9[_0x494755(0x1fc)],'type':_0x43c2c9['type'],'floorlevel':_0x43c2c9[_0x494755(0x18a)]})),console['log'](_0x494755(0x203),_0x24e5a3);}),await _0x24e5a3[_0x196703(0x21a)](),console['log'](_0x23a402[_0x196703(0x18b)]);const _0x768e64=new c_payment_data({'invoice':_0x48085f,'customer':_0x23a402[_0x196703(0x18b)][_0x196703(0x1b9)],'reason':'Sale\x20Return'});await _0x768e64[_0x196703(0x21a)]();const _0x239bbb=await master_shop[_0x196703(0x220)]();console[_0x196703(0x121)](_0x196703(0x12f),_0x239bbb[0x0][_0x196703(0x1ec)]);const _0x2c87b1=await email_settings['findOne'](),_0x15ddf1=await customer[_0x196703(0x1ef)]({'name':_0x23a402[_0x196703(0x18b)][_0x196703(0x1b9)]});console[_0x196703(0x121)](_0x196703(0x211),_0x15ddf1);_0x239bbb[0x0]['currency_placement']==0x1?(right_currency=_0x239bbb[0x0][_0x196703(0x1ff)],left_currency=''):(right_currency='',left_currency=_0x239bbb[0x0][_0x196703(0x1ff)]);var _0x2012ad=_0x1506df,_0x4f1610=_0x140f17,_0x4b419a='',_0x39785e;for(_0x39785e in _0x2012ad){_0x4b419a+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2012ad[_0x39785e]+_0x196703(0x18f)+_0x196703(0x1c2)+_0x4f1610[_0x39785e]+_0x196703(0x18f)+'</tr>';}console[_0x196703(0x121)](_0x196703(0x1a9),_0x4b419a);let _0x492355=nodemailer[_0x196703(0x1f4)]({'service':'gmail','auth':{'user':_0x2c87b1[_0x196703(0x18e)],'pass':_0x2c87b1[_0x196703(0x17a)]}}),_0x3794f8={'from':_0x2c87b1[_0x196703(0x18e)],'to':_0x15ddf1[_0x196703(0x18e)],'subject':_0x196703(0x1bb),'attachments':[{'filename':_0x196703(0x206),'path':__dirname+_0x196703(0x15c)+_0x196703(0x13e)+_0x239bbb[0x0][_0x196703(0x1ec)],'cid':_0x196703(0x150)}],'html':_0x196703(0x1c9)+_0x196703(0x14f)+'</head><body>'+_0x196703(0x226)+_0x196703(0x11e)+_0x196703(0x226)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x196703(0x124)+_0x196703(0x226)+_0x196703(0x12c)+_0x239bbb[0x0][_0x196703(0x191)]+_0x196703(0x1cb)+_0x196703(0x124)+_0x196703(0x124)+_0x196703(0x1d3)+'<div>'+_0x196703(0x21e)+'\x20Order\x20Number\x20:\x20'+_0x48085f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x4228fb+'\x20'+_0x196703(0x19e)+_0x196703(0x1f8)+_0x196703(0x124)+_0x196703(0x1d1)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x196703(0x1cd)+_0x196703(0x137)+_0x196703(0x161)+_0x196703(0x194)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x196703(0x16f)+'\x20'+_0x4b419a+'\x20'+_0x196703(0x177)+_0x196703(0x1d4)+_0x196703(0x226)+_0x196703(0x129)+_0x196703(0x1d8)+_0x239bbb[0x0][_0x196703(0x191)]+_0x196703(0x1f8)+'</div>'+_0x196703(0x124)+'</body></html>'};_0x492355[_0x196703(0x222)](_0x3794f8,function(_0x2416c2,_0xe408af){var _0x4e7960=_0x196703;_0x2416c2?(console[_0x4e7960(0x121)](_0x2416c2),console[_0x4e7960(0x121)](_0x4e7960(0x215))):console['log'](_0x4e7960(0x200));}),_0x23a402[_0x196703(0x136)](_0x196703(0x1f3),_0x196703(0x11d)),_0x18f763['redirect'](_0x196703(0x1d0));}catch(_0x96cd98){console[_0x196703(0x121)](_0x96cd98),_0x18f763[_0x196703(0x130)](0xc8)[_0x196703(0x140)]({'message1':_0x96cd98[_0x196703(0x1dd)]});}}),router[a0_0x1bf8dd(0x187)](a0_0x1bf8dd(0x156),auth,async(_0x3df75c,_0x57b26a)=>{var _0x4d6631=a0_0x1bf8dd;try{const {username:_0x13920f,email:_0x12a8f3,role:_0x5954dc}=_0x3df75c[_0x4d6631(0x16a)],_0x3bea15=_0x3df75c['user'],_0x5522bc=await profile['findOne']({'email':_0x3bea15[_0x4d6631(0x18e)]}),_0x2c419c=await master_shop['find']();console[_0x4d6631(0x121)]('barcode\x20Product\x20master',_0x2c419c);const _0x39327d=_0x3df75c[_0x4d6631(0x1f2)]['id'],_0x3d0473=await sales[_0x4d6631(0x12b)](_0x39327d);console[_0x4d6631(0x121)]('barcode\x20user_id',_0x3d0473);if(_0x2c419c[0x0][_0x4d6631(0x179)]=='English\x20(US)')var _0x1c5d3f=users['English'];else{if(_0x2c419c[0x0][_0x4d6631(0x179)]==_0x4d6631(0x228))var _0x1c5d3f=users['Hindi'];else{if(_0x2c419c[0x0][_0x4d6631(0x179)]==_0x4d6631(0x135))var _0x1c5d3f=users[_0x4d6631(0x135)];else{if(_0x2c419c[0x0][_0x4d6631(0x179)]==_0x4d6631(0x1e2))var _0x1c5d3f=users['Spanish'];else{if(_0x2c419c[0x0][_0x4d6631(0x179)]==_0x4d6631(0x1fb))var _0x1c5d3f=users[_0x4d6631(0x1fb)];else{if(_0x2c419c[0x0][_0x4d6631(0x179)]==_0x4d6631(0x20f))var _0x1c5d3f=users['Portuguese'];else{if(_0x2c419c[0x0]['language']==_0x4d6631(0x19b))var _0x1c5d3f=users[_0x4d6631(0x19b)];else{if(_0x2c419c[0x0][_0x4d6631(0x179)]==_0x4d6631(0x217))var _0x1c5d3f=users[_0x4d6631(0x147)];}}}}}}}_0x57b26a[_0x4d6631(0x14b)](_0x4d6631(0x1ac),{'success':_0x3df75c[_0x4d6631(0x136)]('success'),'errors':_0x3df75c[_0x4d6631(0x136)](_0x4d6631(0x190)),'role':_0x3bea15,'profile':_0x5522bc,'alldata':_0x3d0473,'master_shop':_0x2c419c,'language':_0x1c5d3f});}catch(_0x20facc){console['log'](_0x20facc);}}),router[a0_0x1bf8dd(0x223)](a0_0x1bf8dd(0x142),async(_0x4415bb,_0x1b4c61)=>{var _0x2e0d9d=a0_0x1bf8dd;const {product_code:_0xe8b9b3,warehouse_name:_0x5910db,rooms_data:_0x26421a,Roomslist:_0x42377a}=_0x4415bb[_0x2e0d9d(0x18b)],_0x4f001d=_0x42377a[_0x2e0d9d(0x12a)](','),_0x4d0f25=[];async function _0x4da45f(_0x25507d){var _0x2ca526=_0x2e0d9d;const _0x3e7e63=await warehouse[_0x2ca526(0x146)]([{'$match':{'name':_0x5910db,'room':_0x25507d}},{'$unwind':_0x2ca526(0x17b)},{'$match':{'product_details.primary_code':_0xe8b9b3}},{'$group':{'_id':_0x2ca526(0x166),'name':{'$first':_0x2ca526(0x152)},'product_stock':{'$first':_0x2ca526(0x1bf)},'primary_code':{'$first':_0x2ca526(0x1ed)},'secondary_code':{'$first':_0x2ca526(0x120)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2ca526(0x154)},'isle':{'$first':_0x2ca526(0x1ae)},'type':{'$first':_0x2ca526(0x16e)},'pallet':{'$first':_0x2ca526(0x15f)},'unit':{'$first':_0x2ca526(0x13a)},'secondary_unit':{'$first':_0x2ca526(0x21b)},'storage':{'$first':_0x2ca526(0x168)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2ca526(0x144)},'production_date':{'$first':_0x2ca526(0x16c)},'maxPerUnit':{'$first':_0x2ca526(0x1b4)},'batch_code':{'$first':_0x2ca526(0x1f6)},'product_cat':{'$first':_0x2ca526(0x193)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2ca526(0x1b7)},'invoice':{'$first':_0x2ca526(0x1c4)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x2359f3=await warehouse[_0x2ca526(0x146)]([{'$match':{'name':_0x5910db,'room':_0x25507d}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0xe8b9b3}},{'$group':{'_id':_0x2ca526(0x166),'name':{'$first':_0x2ca526(0x152)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2ca526(0x1ed)},'secondary_code':{'$first':_0x2ca526(0x120)},'product_code':{'$first':_0x2ca526(0x165)},'level':{'$first':_0x2ca526(0x154)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2ca526(0x16e)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2ca526(0x13a)},'secondary_unit':{'$first':_0x2ca526(0x21b)},'storage':{'$first':_0x2ca526(0x168)},'rack':{'$first':_0x2ca526(0x1b8)},'expiry_date':{'$first':_0x2ca526(0x144)},'production_date':{'$first':_0x2ca526(0x16c)},'maxPerUnit':{'$first':_0x2ca526(0x1b4)},'batch_code':{'$first':_0x2ca526(0x1f6)},'product_cat':{'$first':_0x2ca526(0x193)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2ca526(0x1b7)},'invoice':{'$first':_0x2ca526(0x1c4)}}}]);if(_0x3e7e63[_0x2ca526(0x141)]>0x0)_0x4d0f25[_0x2ca526(0x202)](_0x3e7e63);else _0x2359f3[_0x2ca526(0x141)]>0x0&&_0x4d0f25[_0x2ca526(0x202)](_0x2359f3);}const _0x581171=_0x4f001d[_0x2e0d9d(0x1d9)](_0x26a110=>_0x4da45f(_0x26a110));await Promise[_0x2e0d9d(0x1ea)](_0x581171),_0x1b4c61[_0x2e0d9d(0x140)](_0x4d0f25);}),module['exports']=router;