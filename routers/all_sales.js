var a0_0x485c6b=a0_0x165b;(function(_0x49d040,_0x49a9c1){var _0x294532=a0_0x165b,_0x1dfcb3=_0x49d040();while(!![]){try{var _0x25fed8=-parseInt(_0x294532(0x1c2))/0x1+parseInt(_0x294532(0x129))/0x2*(-parseInt(_0x294532(0x1ad))/0x3)+parseInt(_0x294532(0x111))/0x4+parseInt(_0x294532(0x17b))/0x5*(parseInt(_0x294532(0x121))/0x6)+parseInt(_0x294532(0x196))/0x7*(-parseInt(_0x294532(0x19c))/0x8)+-parseInt(_0x294532(0x14d))/0x9*(parseInt(_0x294532(0xf4))/0xa)+parseInt(_0x294532(0x108))/0xb;if(_0x25fed8===_0x49a9c1)break;else _0x1dfcb3['push'](_0x1dfcb3['shift']());}catch(_0x2aeaad){_0x1dfcb3['push'](_0x1dfcb3['shift']());}}}(a0_0x4bc1,0x589cc));const express=require(a0_0x485c6b(0x1b6)),app=express(),router=express[a0_0x485c6b(0x1e2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x485c6b(0x1c6)),auth=require(a0_0x485c6b(0xe6)),nodemailer=require(a0_0x485c6b(0x139)),users=require(a0_0x485c6b(0x198));function a0_0x165b(_0x1f9e02,_0x3c0873){var _0x4bc11a=a0_0x4bc1();return a0_0x165b=function(_0x165b9a,_0x3991f6){_0x165b9a=_0x165b9a-0xe4;var _0x3e7f4b=_0x4bc11a[_0x165b9a];return _0x3e7f4b;},a0_0x165b(_0x1f9e02,_0x3c0873);}router['get'](a0_0x485c6b(0x1c9),auth,async(_0x34303d,_0x222d70)=>{var _0x2e4b3e=a0_0x485c6b;try{const {username:_0x52ae17,email:_0x187ca6,role:_0x2e7adb}=_0x34303d['user'],_0x5773f1=_0x34303d[_0x2e4b3e(0x199)],_0x1a26ff=await profile[_0x2e4b3e(0x13f)]({'email':_0x5773f1[_0x2e4b3e(0x1ba)]}),_0x14a08f=await master_shop[_0x2e4b3e(0x16c)]();let _0x363073;if(_0x5773f1[_0x2e4b3e(0xfd)]==_0x2e4b3e(0x172)){const _0x14f6b9=await staff[_0x2e4b3e(0x13f)]({'email':_0x5773f1[_0x2e4b3e(0x1ba)]});_0x363073=await sales['aggregate']([{'$lookup':{'from':_0x2e4b3e(0x10b),'localField':_0x2e4b3e(0x1f6),'foreignField':_0x2e4b3e(0xf3),'as':_0x2e4b3e(0x188)}},{'$unwind':_0x2e4b3e(0x133)},{'$unwind':_0x2e4b3e(0x1e8)},{'$group':{'_id':_0x2e4b3e(0x12b),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x2e4b3e(0x16b)},'date':{'$first':_0x2e4b3e(0x123)},'warehouse_name':{'$first':_0x2e4b3e(0x170)},'sale_product':{'$push':_0x2e4b3e(0x1e8)},'note':{'$first':_0x2e4b3e(0x17e)},'return_data':{'$first':_0x2e4b3e(0x11c)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2e4b3e(0x11d)},'isle':{'$addToSet':_0x2e4b3e(0x110)},'type':{'$addToSet':_0x2e4b3e(0x12d)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2e4b3e(0x1b3)},'isAllowEdit':{'$first':_0x2e4b3e(0x1d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x363073=await sales[_0x2e4b3e(0xf2)]([{'$lookup':{'from':_0x2e4b3e(0x10b),'localField':_0x2e4b3e(0x1f6),'foreignField':_0x2e4b3e(0xf3),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x2e4b3e(0x1e8)},{'$group':{'_id':_0x2e4b3e(0x12b),'invoice':{'$first':_0x2e4b3e(0x12c)},'customers':{'$first':_0x2e4b3e(0x16b)},'date':{'$first':_0x2e4b3e(0x123)},'warehouse_name':{'$first':_0x2e4b3e(0x170)},'sale_product':{'$push':_0x2e4b3e(0x1e8)},'note':{'$first':'$note'},'return_data':{'$first':_0x2e4b3e(0x11c)},'customers_docs':{'$first':_0x2e4b3e(0x133)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2e4b3e(0x11d)},'isle':{'$addToSet':_0x2e4b3e(0x110)},'type':{'$addToSet':_0x2e4b3e(0x12d)},'pallet':{'$addToSet':_0x2e4b3e(0x161)},'finalize':{'$first':_0x2e4b3e(0x1b3)},'isAllowEdit':{'$first':_0x2e4b3e(0x1d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x2e4b3e(0xe8)](_0x2e4b3e(0x1ef),_0x363073);if(_0x14a08f[0x0][_0x2e4b3e(0x185)]==_0x2e4b3e(0x1f3)){var _0x5f53cd=users[_0x2e4b3e(0x144)];console[_0x2e4b3e(0xe8)](_0x5f53cd);}else{if(_0x14a08f[0x0][_0x2e4b3e(0x185)]==_0x2e4b3e(0x130))var _0x5f53cd=users[_0x2e4b3e(0x130)];else{if(_0x14a08f[0x0][_0x2e4b3e(0x185)]=='German')var _0x5f53cd=users[_0x2e4b3e(0x11f)];else{if(_0x14a08f[0x0]['language']=='Spanish')var _0x5f53cd=users['Spanish'];else{if(_0x14a08f[0x0][_0x2e4b3e(0x185)]==_0x2e4b3e(0x158))var _0x5f53cd=users['French'];else{if(_0x14a08f[0x0][_0x2e4b3e(0x185)]=='Portuguese\x20(BR)')var _0x5f53cd=users[_0x2e4b3e(0x19b)];else{if(_0x14a08f[0x0][_0x2e4b3e(0x185)]==_0x2e4b3e(0x105))var _0x5f53cd=users[_0x2e4b3e(0x105)];else{if(_0x14a08f[0x0][_0x2e4b3e(0x185)]==_0x2e4b3e(0x167))var _0x5f53cd=users[_0x2e4b3e(0x1dc)];}}}}}}}_0x222d70[_0x2e4b3e(0x143)](_0x2e4b3e(0x1cd),{'success':_0x34303d[_0x2e4b3e(0x171)](_0x2e4b3e(0x18a)),'errors':_0x34303d[_0x2e4b3e(0x171)](_0x2e4b3e(0x1a9)),'sales':_0x363073,'profile':_0x1a26ff,'role':_0x5773f1,'master_shop':_0x14a08f,'language':_0x5f53cd});}catch(_0x11e038){console[_0x2e4b3e(0xe8)](_0x11e038);}});async function getRandom8DigitNumber(){var _0x5dc3f4=a0_0x485c6b;const _0x39ce05=0x989680,_0x58f41e=0x5f5e0ff,_0x39de64=Math[_0x5dc3f4(0x18e)](Math['random']()*(_0x58f41e-_0x39ce05+0x1))+_0x39ce05;var _0x259a0a;const _0x3e45e4=await sales[_0x5dc3f4(0x13f)]({'invoice':_0x5dc3f4(0xed)+_0x39de64});return _0x3e45e4&&_0x3e45e4['length']>0x0?_0x259a0a=_0x5dc3f4(0xed)+_0x39de64:_0x259a0a='OUT-'+_0x39de64,_0x259a0a;}function a0_0x4bc1(){var _0x1ef743=['product_list','Received\x20Payment\x20For\x20Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.rack','Receiving\x20Area','</head><body>','675899vPnLEd','quantity','../public/language/languages.json','user','return_qty','Portuguese','8sjDUuy','post','product_code','$product_details.product_stock','$product_details.secondary_unit','prod_code','barcode\x20Product\x20master','master','Return\x20Goods','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','edit_sales','string','batch_code','errors','error','concat','sendMail','3PquLOY','$product_details.actual_uom','padStart','$product_details.invoice','body','get','$finalize','$product_details.product_code','catch','express','$product_details._id','floorlevel','<h5\x20style=\x22text-align:\x20left;\x22>','email','Sale\x20Return\x20Mail','/all_sales/preview/','back','sales\x20item\x20return\x20successfull','Spanish','</span>','Level','195808oIPZHD','Ambient','redirect','<!DOCTYPE\x20html>','../models/all_models','received_amount','warehouse','/view','purchases_data','return_data','$name','all_sales','sales_invoice','split','exports','date','$product_details.primary_code','<html><head><title></title>','unit','/view/:id','json','$isAllowEdit','primary_code','actual_uom','getMonth','</h5>','Arabic','createTransport','abs','getFullYear','max_per_unit','warehouse_name','Router','filter','An\x20error\x20occurred.','host','/give_payment/:id','user_id','$sale_product','$product_details.type','\x20Order\x20Number\x20:\x20','<table\x20style=\x22width:\x20100%\x20!important;\x22>','slice','product_details','$product_details.storage','sales\x20all_data','An\x20error\x20occurred\x20while\x20saving\x20data.','params','production_date','English\x20(US)','</body></html>','forEach','customer','currency','image','site_title','$product','_id','Error\x20Occurs','secondary_unit','../middleware/auth','/view/return_sales/:id','log','$product_details','carton','product','delivery_code','OUT-','$product_details.pallet','Logo.png','Sale\x20Return','types','aggregate','name','3080GOKdje','delivery_date','Email\x20sent\x20successfully','product_stock','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','True','invoice','role','port','/invoice/:id','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','logo','Floor','secondary_code','Chinese','Sales\x20Mail','$product_details.unit','8938578nDeuWv','due_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','customers','$product_details.batch_code','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','type','status','$sale_product.bin','97768NhbhGD','length','all','gmail','Return\x20Rooms','add\x20post','isAllowEdit','$product_details.expiry_date','RMSEmail','$product.product_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$return_data','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','German','There\x27s\x20a\x20error\x20in\x20this\x20transaction','1020798PqOyGJ','/../public','$date','$product_details.bin','product_name','/barcode/:id','/preview/:id','Portuguese\x20(BR)','607226VMGiqk','prod_invoice','$_id','$invoice','$sale_product.type','expiry_date','$product_details.production_date','Hindi','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$customers_docs','</tr>','note','actual_qty','all_sales_barcode','Raw\x20Materials','nodemailer','</div>','foreach\x20newproduct','/all_sales/view','requested_qty','$product_details.bay','findOne','$product_details.actual_qty','finalize','False','render','English','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<hr\x20class=\x22my-3\x22>','$product_details.maxPerUnit','<strong>\x20Regards\x20</strong>','primary_unit','sale_product','$product_details.floorlevel','6381yXiHPn','password','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_cat','currency_placement','rack','id_transaction_from','bay','$room','French','$product_details.product_cat','return_sale','customer_data','<span\x20style=\x22float:\x20right;\x22>','<div>','add_sales','map','level','$sale_product.floorlevel','maxperunit','room_name','save','findById','/view/add_sales/:id','Arabic\x20(ae)','/view/add_sales','$product_details.product_name','Sales\x20Add\x20successfully','$customer','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','room','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$warehouse_name','flash','staff','max','stock_data','/view/add_sale/product','Enclosed','/barcode_scanner','</table>','</td>','<tr>','10yvOhnS','Enabled','bin','$note','Sales\x20Update\x20successfully','message','payment\x20successfull','sale_qty','storage','then','language','\x20Order\x20Date\x20:\x20','RoomAssigned','customers_docs','amount','success','stock','stocks','Shelves','floor','quantity_notConverted'];a0_0x4bc1=function(){return _0x1ef743;};return a0_0x4bc1();}router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0x168),auth,async(_0x3a69df,_0x22f369)=>{var _0x4e00f5=a0_0x485c6b;try{const {username:_0x27f6c3,email:_0x3d9bb5,role:_0x1b413c}=_0x3a69df['user'],_0x43341f=_0x3a69df[_0x4e00f5(0x199)],_0x2f01e1=await profile['findOne']({'email':_0x43341f[_0x4e00f5(0x1ba)]}),_0x259a82=await master_shop[_0x4e00f5(0x16c)](),_0x281801=await customer[_0x4e00f5(0x16c)]({});let _0x5e8cd9;if(_0x43341f[_0x4e00f5(0xfd)]==_0x4e00f5(0x172)){const _0x948916=await staff['findOne']({'email':_0x43341f[_0x4e00f5(0x1ba)]});_0x5e8cd9=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x948916[_0x4e00f5(0x1c8)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x4e00f5(0x1a4)}}},{'$group':{'_id':_0x4e00f5(0x1cc),'name':{'$first':_0x4e00f5(0x1cc)}}},{'$sort':{'name':0x1}}]);}else _0x5e8cd9=await warehouse[_0x4e00f5(0xf2)]([{'$match':{'status':_0x4e00f5(0x17c),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x282f1a=await product[_0x4e00f5(0x16c)]({});var _0x5ff77a=[_0x4e00f5(0x1c3),_0x4e00f5(0x176)];const _0x36e787=await sales[_0x4e00f5(0x16c)]({}),_0x20a342=_0x36e787[_0x4e00f5(0x112)]+0x1,_0x38cff1=_0x4e00f5(0xed)+_0x20a342['toString']()[_0x4e00f5(0x1af)](0x5,'0');if(_0x259a82[0x0]['language']==_0x4e00f5(0x1f3)){var _0x53b261=users[_0x4e00f5(0x144)];console[_0x4e00f5(0xe8)](_0x53b261);}else{if(_0x259a82[0x0][_0x4e00f5(0x185)]==_0x4e00f5(0x130))var _0x53b261=users[_0x4e00f5(0x130)];else{if(_0x259a82[0x0]['language']==_0x4e00f5(0x11f))var _0x53b261=users[_0x4e00f5(0x11f)];else{if(_0x259a82[0x0]['language']=='Spanish')var _0x53b261=users['Spanish'];else{if(_0x259a82[0x0]['language']==_0x4e00f5(0x158))var _0x53b261=users[_0x4e00f5(0x158)];else{if(_0x259a82[0x0][_0x4e00f5(0x185)]=='Portuguese\x20(BR)')var _0x53b261=users[_0x4e00f5(0x19b)];else{if(_0x259a82[0x0][_0x4e00f5(0x185)]==_0x4e00f5(0x105))var _0x53b261=users['Chinese'];else{if(_0x259a82[0x0][_0x4e00f5(0x185)]==_0x4e00f5(0x167))var _0x53b261=users[_0x4e00f5(0x1dc)];}}}}}}}const _0x4c97d0=getRandom8DigitNumber();_0x4c97d0[_0x4e00f5(0x184)](_0x5b1998=>{var _0x4f7f56=_0x4e00f5;_0x22f369[_0x4f7f56(0x143)](_0x4f7f56(0x15e),{'success':_0x3a69df[_0x4f7f56(0x171)](_0x4f7f56(0x18a)),'errors':_0x3a69df[_0x4f7f56(0x171)](_0x4f7f56(0x1a9)),'role':_0x43341f,'profile':_0x2f01e1,'customer':_0x281801,'warehouse':_0x5e8cd9,'product':_0x282f1a,'invoice':_0x5b1998,'master_shop':_0x259a82,'language':_0x53b261,'rooms_data':_0x5ff77a});})['catch'](_0x68f5f8=>{var _0x3a39e9=_0x4e00f5;_0x3a69df['flash'](_0x3a39e9(0x1a9),_0x3a39e9(0x120)),_0x22f369[_0x3a39e9(0x1c4)](_0x3a39e9(0x13c));});}catch(_0x2e6189){console[_0x4e00f5(0xe8)](_0x2e6189);}}),router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0x166),auth,async(_0x4182f0,_0x383a0e)=>{var _0x1e1752=a0_0x485c6b;try{const _0x38a7c9=_0x4182f0[_0x1e1752(0x1f1)]['id'];console[_0x1e1752(0xe8)](_0x38a7c9);const _0x11e06f=await product['find'](),_0x1517d1=await purchases[_0x1e1752(0xf2)]([{'$match':{'warehouse_name':_0x38a7c9}},{'$unwind':_0x1e1752(0x1fa)},{'$group':{'_id':_0x1e1752(0x11a)}}]);console[_0x1e1752(0xe8)](_0x1e1752(0x1ca),_0x1517d1),_0x383a0e[_0x1e1752(0x10f)](0xc8)[_0x1e1752(0x1d6)]({'purchases_data':_0x1517d1,'product_data':_0x11e06f});}catch(_0x294c69){console[_0x1e1752(0xe8)](_0x294c69);}}),router['post'](a0_0x485c6b(0x175),auth,async(_0x47ddb2,_0x30113d)=>{var _0x304790=a0_0x485c6b;try{const {warehouse_data:_0xc87744,product_data:_0x4ecbd6}=_0x47ddb2[_0x304790(0x1b1)];console[_0x304790(0xe8)](_0x47ddb2[_0x304790(0x1b1)]['product_data']);;const _0x2c785b=await master_shop['find']();console[_0x304790(0xe8)](_0x304790(0x1a3),_0x2c785b);const _0x203b26=await product[_0x304790(0x13f)]({'name':_0x4ecbd6});console[_0x304790(0xe8)](_0x304790(0xeb),_0x203b26);const _0x1c2367=await warehouse['aggregate']([{'$match':{'name':_0xc87744}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x4ecbd6}},{'$group':{'_id':_0x304790(0x169),'product_stock':{'$first':_0x304790(0x19f)}}}]);console[_0x304790(0xe8)](_0x304790(0x174),_0x1c2367),_0x30113d[_0x304790(0x10f)](0xc8)[_0x304790(0x1d6)]({'master':_0x2c785b,'new_product':_0x203b26,'stock_data':_0x1c2367});}catch(_0x4f1f0c){console['log'](_0x4f1f0c);}}),router[a0_0x485c6b(0x19d)]('/view/add_sales',auth,async(_0xa7daff,_0xaa6e52)=>{var _0xe6d932=a0_0x485c6b;try{const {invoice:_0x448872,date:_0x27c6bc,warehouse_name:_0xd4f138,product_name:_0x2ee398,stock:_0x2ee5ea,quantity:_0x3faedd,note:_0xb43e19,room:_0x3c7d67,primary_code:_0x35f732,secondary_code:_0x2af7e2,prod_code:_0x57ffeb,level:_0x5195ef,isle:_0x3a3721,pallet:_0x1bdf89,batch_code:_0x3981e2,SCRN:_0x12ffcc,expiry_date:_0x52e1d6}=_0xa7daff[_0xe6d932(0x1b1)];if(typeof _0x2ee398==_0xe6d932(0x1a7))var _0x15a994=[_0xa7daff['body'][_0xe6d932(0x125)]],_0x43843c=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x18b)]],_0x4f3a5c=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0xea)]],_0x472d36=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1d8)]],_0x1b53cd=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x104)]],_0x32d4da=[_0xa7daff['body'][_0xe6d932(0x1a1)]],_0x5553fa=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x160)]],_0x1de2bd=[_0xa7daff[_0xe6d932(0x1b1)]['primary_unit']],_0x270be5=[_0xa7daff['body'][_0xe6d932(0xe5)]],_0x217949=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1a8)]],_0x4a236d=[_0xa7daff['body']['expiry_date']],_0x45882c=[_0xa7daff['body'][_0xe6d932(0x1e0)]],_0x5c7f23=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1f2)]],_0xd69da1=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x13d)]],_0xe943a9=[_0xa7daff['body'][_0xe6d932(0xf5)]],_0x12aeed=[_0xa7daff[_0xe6d932(0x1b1)]['delivery_code']],_0x5dcb89=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x152)]],_0x561406=[_0xa7daff[_0xe6d932(0x1b1)]['quantity']],_0x3d10aa=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x187)]],_0x153af0=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x12a)]],_0x3fd261=[_0xa7daff[_0xe6d932(0x1b1)]['actual_qty']],_0x32d8ca=[_0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1d9)]],_0xd1154f=[_0xa7daff[_0xe6d932(0x1b1)]['id_transact']];else var _0x15a994=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x125)]],_0x43843c=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x18b)]],_0x4f3a5c=[..._0xa7daff['body']['carton']],_0x472d36=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1d8)]],_0x1b53cd=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x104)]],_0x32d4da=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1a1)]],_0x5553fa=[..._0xa7daff[_0xe6d932(0x1b1)]['level']],_0x1de2bd=[..._0xa7daff[_0xe6d932(0x1b1)]['primary_unit']],_0x270be5=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0xe5)]],_0x217949=[..._0xa7daff[_0xe6d932(0x1b1)]['batch_code']],_0x4a236d=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x12e)]],_0x45882c=[..._0xa7daff[_0xe6d932(0x1b1)]['max_per_unit']],_0x5c7f23=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1f2)]],_0xd69da1=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x13d)]],_0xe943a9=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0xf5)]],_0x12aeed=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0xec)]],_0x5dcb89=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x152)]],_0x561406=[..._0xa7daff['body'][_0xe6d932(0x197)]],_0x3d10aa=[..._0xa7daff[_0xe6d932(0x1b1)]['RoomAssigned']],_0x153af0=[..._0xa7daff['body']['prod_invoice']],_0x3fd261=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x136)]],_0x32d8ca=[..._0xa7daff[_0xe6d932(0x1b1)][_0xe6d932(0x1d9)]],_0xd1154f=[..._0xa7daff[_0xe6d932(0x1b1)]['id_transact']];const _0x3829c5=_0x15a994[_0xe6d932(0x15f)](_0x5f4499=>{return _0x5f4499={'product_name':_0x5f4499};});_0x43843c['forEach']((_0xa5357b,_0x198018)=>{var _0x2b6dd4=_0xe6d932;_0x3829c5[_0x198018][_0x2b6dd4(0x18b)]=Math[_0x2b6dd4(0x1de)](_0xa5357b);}),_0x3fd261[_0xe6d932(0x1f5)]((_0xb5b329,_0x1653ff)=>{var _0x2b4edc=_0xe6d932;_0x3829c5[_0x1653ff]['actual_qty']=Math[_0x2b4edc(0x1de)](_0xb5b329);}),_0x32d8ca[_0xe6d932(0x1f5)]((_0x576b87,_0x587210)=>{var _0x5cb962=_0xe6d932;_0x3829c5[_0x587210][_0x5cb962(0x1d9)]=_0x576b87;}),_0xd1154f[_0xe6d932(0x1f5)]((_0x42654f,_0x20f073)=>{var _0x8dc341=_0xe6d932;_0x3829c5[_0x20f073][_0x8dc341(0x155)]=_0x42654f;}),_0x4f3a5c[_0xe6d932(0x1f5)]((_0x4a4390,_0x3a628f)=>{var _0x450adc=_0xe6d932;_0x3829c5[_0x3a628f][_0x450adc(0x197)]=_0x4a4390;}),_0x472d36[_0xe6d932(0x1f5)]((_0x4dbd67,_0x4d895b)=>{var _0x131461=_0xe6d932;_0x3829c5[_0x4d895b][_0x131461(0x1d8)]=_0x4dbd67;}),_0x1b53cd[_0xe6d932(0x1f5)]((_0x165813,_0x266687)=>{var _0x2c43f7=_0xe6d932;_0x3829c5[_0x266687][_0x2c43f7(0x104)]=_0x165813;}),_0x32d4da[_0xe6d932(0x1f5)]((_0x259a1e,_0x2a36e7)=>{var _0x1b20e4=_0xe6d932;_0x3829c5[_0x2a36e7][_0x1b20e4(0x19e)]=_0x259a1e;}),_0x5553fa['forEach']((_0x4c2cd6,_0x4927b6)=>{_0x3d10aa['forEach']((_0x4dde3d,_0xf5afe)=>{var _0x214dad=a0_0x165b;if(_0x4dde3d=='Receiving\x20Area'&&_0x4927b6==_0xf5afe){var _0x4205b2=_0x4c2cd6[_0x214dad(0x1ec)](0x3);_0x3829c5[_0x4927b6][_0x214dad(0x183)]=_0x4c2cd6[0x0],_0x3829c5[_0x4927b6]['rack']=_0x4c2cd6[0x1],_0x3829c5[_0x4927b6]['bay']=0x0,_0x3829c5[_0x4927b6]['bin']=0x0,_0x3829c5[_0x4927b6][_0x214dad(0x10e)]=_0x214dad(0x103),_0x3829c5[_0x4927b6][_0x214dad(0x1b8)]=_0x4205b2;}else{if(_0x4dde3d==_0x214dad(0x18d)&&_0x4927b6==_0xf5afe){var _0x4205b2=_0x4c2cd6[_0x214dad(0x1ec)](0x3);_0x3829c5[_0x4927b6][_0x214dad(0x183)]=_0x4c2cd6[0x0],_0x3829c5[_0x4927b6][_0x214dad(0x154)]=_0x4c2cd6[0x1],_0x3829c5[_0x4927b6][_0x214dad(0x156)]=0x0,_0x3829c5[_0x4927b6][_0x214dad(0x17d)]=0x0,_0x3829c5[_0x4927b6][_0x214dad(0x10e)]=_0x214dad(0x103),_0x3829c5[_0x4927b6][_0x214dad(0x1b8)]=_0x4c2cd6[0x5];}else{if(_0x4927b6==_0xf5afe){var _0x11537c;if(_0x4c2cd6[0x4]=='L')_0x11537c=_0x214dad(0x1c1);else _0x4c2cd6[0x4]=='F'&&(_0x11537c=_0x214dad(0x103));_0x3829c5[_0x4927b6][_0x214dad(0x183)]=_0x4c2cd6[0x0],_0x3829c5[_0x4927b6][_0x214dad(0x154)]=_0x4c2cd6[0x1],_0x3829c5[_0x4927b6][_0x214dad(0x156)]=_0x4c2cd6[0x2],_0x3829c5[_0x4927b6][_0x214dad(0x17d)]=_0x4c2cd6[0x3],_0x3829c5[_0x4927b6][_0x214dad(0x10e)]=_0x11537c,_0x3829c5[_0x4927b6][_0x214dad(0x1b8)]=_0x4c2cd6[0x5];}}}});}),_0x1de2bd[_0xe6d932(0x1f5)]((_0x3b62ea,_0x2c2e24)=>{_0x3829c5[_0x2c2e24]['unit']=_0x3b62ea;}),_0x270be5[_0xe6d932(0x1f5)]((_0x57d23a,_0x32d9ef)=>{var _0x175e0f=_0xe6d932;_0x3829c5[_0x32d9ef][_0x175e0f(0xe5)]=_0x57d23a;}),_0x217949['forEach']((_0x23fe15,_0x5c2a29)=>{var _0x3a9150=_0xe6d932;_0x3829c5[_0x5c2a29][_0x3a9150(0x1a8)]=_0x23fe15;}),_0x4a236d[_0xe6d932(0x1f5)]((_0x5295db,_0x172995)=>{var _0x28b507=_0xe6d932;_0x3829c5[_0x172995][_0x28b507(0x12e)]=_0x5295db;}),_0x45882c['forEach']((_0x121dc8,_0x469d10)=>{_0x3829c5[_0x469d10]['maxperunit']=_0x121dc8;}),_0x5c7f23['forEach']((_0x5b28a7,_0x36d772)=>{var _0x4e6292=_0xe6d932;_0x3829c5[_0x36d772][_0x4e6292(0x1f2)]=_0x5b28a7;}),_0xd69da1[_0xe6d932(0x1f5)]((_0x51c77b,_0x3e37b4)=>{var _0xb6bbfc=_0xe6d932;_0x3829c5[_0x3e37b4][_0xb6bbfc(0x13d)]=_0x51c77b;}),_0xe943a9[_0xe6d932(0x1f5)]((_0x1a3bc2,_0x32e5e9)=>{_0x3829c5[_0x32e5e9]['delivery_date']=_0x1a3bc2;}),_0x12aeed[_0xe6d932(0x1f5)]((_0x4da98a,_0x14ef78)=>{_0x3829c5[_0x14ef78]['delivery_code']=_0x4da98a;}),_0x5dcb89[_0xe6d932(0x1f5)]((_0x2d919c,_0x2344ba)=>{var _0x5f9860=_0xe6d932;_0x3829c5[_0x2344ba][_0x5f9860(0x152)]=_0x2d919c;}),_0x561406[_0xe6d932(0x1f5)]((_0x39b53e,_0x47d2f0)=>{var _0x4afec4=_0xe6d932;_0x3829c5[_0x47d2f0][_0x4afec4(0x18f)]=_0x39b53e;}),_0x3d10aa[_0xe6d932(0x1f5)]((_0x6ecb4,_0x2b0470)=>{var _0x40b4d1=_0xe6d932;_0x3829c5[_0x2b0470][_0x40b4d1(0x163)]=_0x6ecb4;}),_0x153af0[_0xe6d932(0x1f5)]((_0x4c908a,_0x297aaf)=>{var _0x513c9a=_0xe6d932;_0x3829c5[_0x297aaf][_0x513c9a(0xfc)]=_0x4c908a;});var _0x12a648=0x0;_0x3829c5['forEach'](_0x48cf0b=>{var _0x4c58e9=_0xe6d932;(_0x48cf0b[_0x4c58e9(0x18b)]<_0x48cf0b[_0x4c58e9(0x18f)]||_0x48cf0b[_0x4c58e9(0x18f)]==0x0)&&(console['log']('foreach\x20newproduct',_0x48cf0b),_0x12a648++);});const _0xecee6a=_0x3829c5[_0xe6d932(0x1e3)](_0x78f75d=>_0x78f75d[_0xe6d932(0x197)]!=='0'&&_0x78f75d['quantity']!==''),_0x56fc0a=new sales({'invoice':_0x448872,'customer':_0xa7daff[_0xe6d932(0x1b1)]['customer'],'date':_0x27c6bc,'warehouse_name':_0xd4f138,'sale_product':_0xecee6a,'note':_0xb43e19,'room':_0x3c7d67,'primary_code':_0x35f732,'secondary_code':_0x2af7e2,'prod_code':_0x57ffeb,'SCRN':_0x12ffcc}),_0x55800d=await _0x56fc0a[_0xe6d932(0x164)]();_0xa7daff[_0xe6d932(0x171)](_0xe6d932(0x18a),_0xe6d932(0x16a)),_0xaa6e52[_0xe6d932(0x1c4)](_0xe6d932(0x1bc)+_0x55800d[_0xe6d932(0x1fb)]);}catch(_0x39cb95){console[_0xe6d932(0xe8)](_0x39cb95);}}),router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0x127),auth,async(_0x43b7f6,_0x37b744)=>{var _0x49af0b=a0_0x485c6b;try{const {username:_0x272cba,email:_0x37a0f5,role:_0x36f6c5}=_0x43b7f6[_0x49af0b(0x199)],_0x2f2d9e=_0x43b7f6[_0x49af0b(0x199)],_0x5437d1=await profile[_0x49af0b(0x13f)]({'email':_0x2f2d9e['email']}),_0x1a54ed=await master_shop[_0x49af0b(0x16c)](),_0x35a280=_0x43b7f6[_0x49af0b(0x1f1)]['id'],_0x2f036e=await sales[_0x49af0b(0x165)](_0x35a280),_0x349068=await warehouse[_0x49af0b(0xf2)]([{'$match':{'name':_0x2f036e[_0x49af0b(0x1e1)]}},{'$unwind':_0x49af0b(0xe9)},{'$group':{'_id':_0x49af0b(0x1b7),'name':{'$first':_0x49af0b(0x169)},'product_stock':{'$first':_0x49af0b(0x19f)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x49af0b(0x124)},'type':{'$first':_0x49af0b(0x1e9)},'floorlevel':{'$first':_0x49af0b(0x14c)},'primary_code':{'$first':_0x49af0b(0x1d2)},'secondary_code':{'$first':_0x49af0b(0x131)},'product_code':{'$first':_0x49af0b(0x1b4)},'storage':{'$first':_0x49af0b(0x1ee)},'rack':{'$first':_0x49af0b(0x193)},'expiry_date':{'$first':_0x49af0b(0x118)},'production_date':{'$first':_0x49af0b(0x12f)},'invoice':{'$first':_0x49af0b(0x1b0)}}}]),_0x321a77=await customer['find']({});let _0x4d463a;if(_0x2f2d9e[_0x49af0b(0xfd)]=='staff'){const _0x275f6a=await staff[_0x49af0b(0x13f)]({'email':_0x2f2d9e[_0x49af0b(0x1ba)]});_0x4d463a=await warehouse['aggregate']([{'$match':{'status':_0x49af0b(0x17c),'name':_0x275f6a[_0x49af0b(0x1c8)]}},{'$group':{'_id':'$name','name':{'$first':_0x49af0b(0x1cc)}}}]);}else _0x4d463a=await warehouse[_0x49af0b(0xf2)]([{'$match':{'status':_0x49af0b(0x17c)}},{'$group':{'_id':_0x49af0b(0x1cc),'name':{'$first':'$name'}}}]);const _0x518aad=await product[_0x49af0b(0x16c)]({}),_0x55b498=await suppliers['find']({});if(_0x1a54ed[0x0][_0x49af0b(0x185)]=='English\x20(US)'){var _0x49a136=users[_0x49af0b(0x144)];console[_0x49af0b(0xe8)](_0x49a136);}else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]==_0x49af0b(0x130))var _0x49a136=users[_0x49af0b(0x130)];else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]==_0x49af0b(0x11f))var _0x49a136=users[_0x49af0b(0x11f)];else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]==_0x49af0b(0x1bf))var _0x49a136=users['Spanish'];else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]==_0x49af0b(0x158))var _0x49a136=users['French'];else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]=='Portuguese\x20(BR)')var _0x49a136=users['Portuguese'];else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]==_0x49af0b(0x105))var _0x49a136=users[_0x49af0b(0x105)];else{if(_0x1a54ed[0x0][_0x49af0b(0x185)]==_0x49af0b(0x167))var _0x49a136=users[_0x49af0b(0x1dc)];}}}}}}}_0x37b744['render']('edit_sales_view',{'success':_0x43b7f6['flash'](_0x49af0b(0x18a)),'errors':_0x43b7f6['flash']('errors'),'role':_0x2f2d9e,'profile':_0x5437d1,'customer':_0x321a77,'warehouse':_0x4d463a,'product':_0x349068,'user':_0x2f036e,'master_shop':_0x1a54ed,'unit':_0x518aad,'language':_0x49a136,'suppliers':_0x55b498});}catch(_0x2483ee){console[_0x49af0b(0xe8)](_0x2483ee);}}),router[a0_0x485c6b(0x19d)]('/preview/:id',auth,async(_0xaf7b1e,_0xb81ec6)=>{var _0x5a4e70=a0_0x485c6b;try{const _0xa641d2=_0xaf7b1e[_0x5a4e70(0x1f1)]['id'],{invoice:_0x2efc69,warehouse_name:_0xfdb82a,room:_0x13872c}=_0xaf7b1e[_0x5a4e70(0x1b1)],_0x35abeb=await sales['findOne']({'invoice':_0x2efc69}),_0x10fb35=_0x35abeb['sale_product'][_0x5a4e70(0x15f)](async _0x29fd10=>{var _0x38e130=_0x5a4e70,_0x2c1b6d=await warehouse[_0x38e130(0x13f)]({'name':_0xfdb82a,'room':_0x29fd10[_0x38e130(0x163)],'warehouse_category':_0x38e130(0x138)});const _0x192750=_0x2c1b6d[_0x38e130(0x1ed)][_0x38e130(0x15f)](_0x292f8f=>{var _0x5a3610=_0x38e130;_0x292f8f[_0x5a3610(0x125)]==_0x29fd10[_0x5a3610(0x125)]&&_0x292f8f['floorlevel']==_0x29fd10[_0x5a3610(0x1b8)]&&_0x292f8f[_0x5a3610(0x10e)]==_0x29fd10['type']&&_0x292f8f[_0x5a3610(0x17d)]==_0x29fd10[_0x5a3610(0x17d)]&&_0x292f8f[_0x5a3610(0x156)]==_0x29fd10[_0x5a3610(0x156)]&&_0x292f8f[_0x5a3610(0x154)]==_0x29fd10[_0x5a3610(0x154)]&&_0x292f8f['storage']==_0x29fd10['storage']&&_0x292f8f[_0x5a3610(0x12e)]==_0x29fd10['expiry_date']&&_0x292f8f['batch_code']==_0x29fd10['batch_code']&&_0x292f8f[_0x5a3610(0xfc)]==_0x29fd10[_0x5a3610(0xfc)]&&_0x292f8f[_0x5a3610(0x1fb)]==_0x29fd10[_0x5a3610(0x155)]&&(_0x292f8f[_0x5a3610(0xf7)]=Math[_0x5a3610(0x173)](0x0,Math[_0x5a3610(0x1de)](_0x292f8f[_0x5a3610(0xf7)])-Math[_0x5a3610(0x1de)](_0x29fd10[_0x5a3610(0x197)])));});return _0x2c1b6d;});Promise[_0x5a4e70(0x113)](_0x10fb35)[_0x5a4e70(0x184)](async _0x4e0ddc=>{var _0x578e1d=_0x5a4e70;try{for(const _0x5fe153 of _0x4e0ddc){await _0x5fe153[_0x578e1d(0x164)]();}_0x35abeb[_0x578e1d(0x141)]='True';const _0x51d90b=await _0x35abeb[_0x578e1d(0x164)](),_0xf7e9cd=await master_shop['find'](),_0xe59b9=await email_settings[_0x578e1d(0x13f)](),_0x257d67=await supervisor_settings[_0x578e1d(0x16c)]();var _0x1b1dba=_0x35abeb[_0x578e1d(0x14b)],_0x4184e7='',_0x1b8754;for(_0x1b8754 in _0x1b1dba){_0x4184e7+=_0x578e1d(0x17a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b1dba[_0x1b8754][_0x578e1d(0x125)]+_0x578e1d(0x179)+_0x578e1d(0x11b)+_0x1b1dba[_0x1b8754][_0x578e1d(0x19e)]+_0x578e1d(0x179)+_0x578e1d(0x11b)+_0x1b1dba[_0x1b8754][_0x578e1d(0x197)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b1dba[_0x1b8754][_0x578e1d(0x1d4)]+_0x578e1d(0x179)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b1dba[_0x1b8754][_0x578e1d(0xe5)]+_0x578e1d(0x179)+_0x578e1d(0x11b)+_0x35abeb['warehouse_name']+_0x578e1d(0x179)+_0x578e1d(0x11b)+_0x1b1dba[_0x1b8754][_0x578e1d(0x163)]+'</td>'+_0x578e1d(0x11b)+_0x1b1dba[_0x1b8754][_0x578e1d(0x183)]+_0x1b1dba[_0x1b8754][_0x578e1d(0x154)]+_0x1b1dba[_0x1b8754][_0x578e1d(0x156)]+_0x1b1dba[_0x1b8754]['bin']+_0x1b1dba[_0x1b8754][_0x578e1d(0x10e)][0x0]+_0x1b1dba[_0x1b8754]['floorlevel']+_0x578e1d(0x179),_0x578e1d(0x134);}let _0x2b3296=nodemailer[_0x578e1d(0x1dd)]({'host':_0xe59b9[_0x578e1d(0x1e5)],'port':Number(_0xe59b9[_0x578e1d(0xfe)]),'secure':![],'auth':{'user':_0xe59b9[_0x578e1d(0x1ba)],'pass':_0xe59b9[_0x578e1d(0x14e)]}}),_0x59ec75={'from':_0xe59b9[_0x578e1d(0x1ba)],'to':_0x257d67[0x0][_0x578e1d(0x119)],'subject':_0x578e1d(0x106),'attachments':[{'filename':_0x578e1d(0xef),'path':__dirname+_0x578e1d(0x122)+'/upload/'+_0xf7e9cd[0x0][_0x578e1d(0x1f8)],'cid':_0x578e1d(0x102)}],'html':_0x578e1d(0x1c5)+_0x578e1d(0x1d3)+_0x578e1d(0x195)+_0x578e1d(0x15d)+_0x578e1d(0x1a5)+_0x578e1d(0x15d)+_0x578e1d(0x151)+_0x578e1d(0x13a)+_0x578e1d(0x15d)+'<h2>\x20'+_0xf7e9cd[0x0][_0x578e1d(0x1f9)]+_0x578e1d(0x145)+_0x578e1d(0x13a)+_0x578e1d(0x13a)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x35abeb[_0x578e1d(0xfc)]+'\x20'+_0x578e1d(0x15c)+_0x578e1d(0x186)+_0x35abeb[_0x578e1d(0x1d1)]+'\x20'+'</span>'+'</h5>'+_0x578e1d(0x13a)+_0x578e1d(0x1eb)+_0x578e1d(0x16f)+'<tr>'+_0x578e1d(0x146)+_0x578e1d(0xf9)+_0x578e1d(0x192)+_0x578e1d(0x11e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x578e1d(0x16d)+_0x578e1d(0x150)+_0x578e1d(0x101)+_0x578e1d(0x134)+_0x578e1d(0x100)+_0x578e1d(0x10a)+'\x20'+_0x4184e7+'\x20'+'</tbody>'+_0x578e1d(0x178)+_0x578e1d(0x15d)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0xf7e9cd[0x0][_0x578e1d(0x1f9)]+_0x578e1d(0x1db)+'</div>'+_0x578e1d(0x13a)+_0x578e1d(0x1f4)};_0x2b3296[_0x578e1d(0x1ac)](_0x59ec75,function(_0x2f9bb0,_0x26264c){var _0x29578a=_0x578e1d;_0x2f9bb0?(console['log'](_0x2f9bb0),console[_0x29578a(0xe8)](_0x29578a(0xe4))):console['log'](_0x29578a(0xf6));}),_0xaf7b1e[_0x578e1d(0x171)](_0x578e1d(0x18a),_0x578e1d(0x17f)),_0xb81ec6['redirect']('/all_sales/preview/'+_0xa641d2);}catch(_0x5bf673){console['error'](_0x5bf673),_0xb81ec6[_0x578e1d(0x10f)](0x1f4)[_0x578e1d(0x1d6)]({'error':_0x578e1d(0x1f0)});}})[_0x5a4e70(0x1b5)](_0x1cecb1=>{var _0x1d4cf8=_0x5a4e70;console[_0x1d4cf8(0x1aa)](_0x1cecb1),_0xb81ec6[_0x1d4cf8(0x10f)](0x1f4)['json']({'error':_0x1d4cf8(0x1e4)});});}catch(_0x381b77){console[_0x5a4e70(0xe8)](_0x381b77);}}),router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0x1d5),auth,async(_0x2dde90,_0x5ead0a)=>{var _0x5da97e=a0_0x485c6b;try{const {username:_0x5ee28f,email:_0x2ee1af,role:_0x527806}=_0x2dde90[_0x5da97e(0x199)],_0x545516=_0x2dde90['user'],_0x1e7f1f=await profile[_0x5da97e(0x13f)]({'email':_0x545516[_0x5da97e(0x1ba)]}),_0x24406d=await master_shop['find'](),_0x2dcf73=_0x2dde90['params']['id'],_0xe5171b=await sales[_0x5da97e(0x165)](_0x2dcf73);var _0x298b8a=['Ambient',_0x5da97e(0x176)];const _0x411f46=await warehouse[_0x5da97e(0xf2)]([{'$match':{'name':_0xe5171b['warehouse_name'],'warehouse_category':_0x5da97e(0x138)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5da97e(0x169)},'product_stock':{'$first':_0x5da97e(0x19f)},'bay':{'$first':_0x5da97e(0x13e)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5da97e(0x1e9)},'floorlevel':{'$first':_0x5da97e(0x14c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5da97e(0x131)},'product_code':{'$first':_0x5da97e(0x1b4)},'storage':{'$first':_0x5da97e(0x1ee)},'rack':{'$first':'$product_details.rack'}}}]),_0x3c298c=await customer['find']({});let _0x113106;if(_0x545516[_0x5da97e(0xfd)]==_0x5da97e(0x172)){const _0x4a3a9e=await staff[_0x5da97e(0x13f)]({'email':_0x545516[_0x5da97e(0x1ba)]});_0x113106=await warehouse[_0x5da97e(0xf2)]([{'$match':{'status':'Enabled','name':_0x4a3a9e[_0x5da97e(0x1c8)],'warehouse_category':_0x5da97e(0x138)}},{'$group':{'_id':_0x5da97e(0x1cc),'name':{'$first':_0x5da97e(0x1cc)}}}]);}else _0x113106=await warehouse[_0x5da97e(0xf2)]([{'$match':{'status':_0x5da97e(0x17c),'warehouse_category':_0x5da97e(0x138)}},{'$group':{'_id':_0x5da97e(0x1cc),'name':{'$first':_0x5da97e(0x1cc)}}}]);const _0xdbbf83=await product[_0x5da97e(0x16c)]({});if(_0x24406d[0x0][_0x5da97e(0x185)]=='English\x20(US)'){var _0xed3015=users[_0x5da97e(0x144)];console[_0x5da97e(0xe8)](_0xed3015);}else{if(_0x24406d[0x0]['language']==_0x5da97e(0x130))var _0xed3015=users['Hindi'];else{if(_0x24406d[0x0][_0x5da97e(0x185)]==_0x5da97e(0x11f))var _0xed3015=users[_0x5da97e(0x11f)];else{if(_0x24406d[0x0]['language']=='Spanish')var _0xed3015=users[_0x5da97e(0x1bf)];else{if(_0x24406d[0x0][_0x5da97e(0x185)]==_0x5da97e(0x158))var _0xed3015=users['French'];else{if(_0x24406d[0x0][_0x5da97e(0x185)]=='Portuguese\x20(BR)')var _0xed3015=users[_0x5da97e(0x19b)];else{if(_0x24406d[0x0][_0x5da97e(0x185)]==_0x5da97e(0x105))var _0xed3015=users[_0x5da97e(0x105)];else{if(_0x24406d[0x0]['language']==_0x5da97e(0x167))var _0xed3015=users[_0x5da97e(0x1dc)];}}}}}}}_0x5ead0a[_0x5da97e(0x143)](_0x5da97e(0x1a6),{'success':_0x2dde90[_0x5da97e(0x171)](_0x5da97e(0x18a)),'errors':_0x2dde90[_0x5da97e(0x171)](_0x5da97e(0x1a9)),'role':_0x545516,'profile':_0x1e7f1f,'customer':_0x3c298c,'warehouse':_0x113106,'product':_0x411f46,'user':_0xe5171b,'master_shop':_0x24406d,'unit':_0xdbbf83,'language':_0xed3015});}catch(_0x5bfd47){console[_0x5da97e(0xe8)](_0x5bfd47);}}),router[a0_0x485c6b(0x19d)](a0_0x485c6b(0x1d5),auth,async(_0x3b49e3,_0x3ebe6a)=>{var _0x4eda12=a0_0x485c6b;try{const _0x1a150a=_0x3b49e3['params']['id'],_0x4de5dc=await sales[_0x4eda12(0x13f)]({'_id':_0x3b49e3[_0x4eda12(0x1f1)]['id']}),_0x29f8da=await warehouse[_0x4eda12(0x13f)]({'name':_0x4de5dc[_0x4eda12(0x1e1)],'room':_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x16e)]}),{invoice:_0x170727,date:_0x590974,warehouse_name:_0x38c5ba,product_name:_0x2ba25b,stock:_0x4f938f,quantity:_0x195a12,note:_0x423e4c,room:_0x3994f8,customer:_0x5b8046,SCRN:_0x47cd60}=_0x3b49e3[_0x4eda12(0x1b1)];if(typeof _0x2ba25b=='string')var _0x4405ec=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x125)]],_0xee8e88=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x18b)]],_0x38186e=[_0x3b49e3[_0x4eda12(0x1b1)]['carton']],_0x4c41b6=[_0x3b49e3[_0x4eda12(0x1b1)]['primary_code']],_0x5f51c9=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x104)]],_0x4d9c4b=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x1a1)]],_0x30315d=[_0x3b49e3[_0x4eda12(0x1b1)]['level']],_0xe45bb5=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x14a)]],_0x218375=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0xe5)]],_0x53edb2=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x1a8)]],_0x465dd2=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x12e)]],_0x5c8703=[_0x3b49e3['body'][_0x4eda12(0x1e0)]],_0x44c3e9=[_0x3b49e3['body'][_0x4eda12(0x1f2)]],_0x4cb7ad=[_0x3b49e3[_0x4eda12(0x1b1)]['requested_qty']],_0x1f5f73=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0xf5)]],_0x453c7c=[_0x3b49e3[_0x4eda12(0x1b1)]['delivery_code']],_0x457968=[_0x3b49e3[_0x4eda12(0x1b1)]['prod_cat']],_0x35dced=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x197)]],_0x595aa9=[_0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x187)]];else var _0x4405ec=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x125)]],_0xee8e88=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x18b)]],_0x38186e=[..._0x3b49e3[_0x4eda12(0x1b1)]['carton']],_0x4c41b6=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x1d8)]],_0x5f51c9=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x104)]],_0x4d9c4b=[..._0x3b49e3['body'][_0x4eda12(0x1a1)]],_0x30315d=[..._0x3b49e3[_0x4eda12(0x1b1)]['level']],_0xe45bb5=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x14a)]],_0x218375=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0xe5)]],_0x53edb2=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x1a8)]],_0x465dd2=[..._0x3b49e3[_0x4eda12(0x1b1)]['expiry_date']],_0x5c8703=[..._0x3b49e3['body']['max_per_unit']],_0x44c3e9=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x1f2)]],_0x4cb7ad=[..._0x3b49e3[_0x4eda12(0x1b1)]['requested_qty']],_0x1f5f73=[..._0x3b49e3['body'][_0x4eda12(0xf5)]],_0x453c7c=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0xec)]],_0x457968=[..._0x3b49e3['body'][_0x4eda12(0x152)]],_0x35dced=[..._0x3b49e3[_0x4eda12(0x1b1)]['quantity']],_0x595aa9=[..._0x3b49e3[_0x4eda12(0x1b1)][_0x4eda12(0x187)]];const _0x4b5a3e=_0x4405ec[_0x4eda12(0x15f)](_0x3e0c2a=>{return _0x3e0c2a={'product_name':_0x3e0c2a};});_0xee8e88['forEach']((_0x19fe32,_0x1796f1)=>{var _0x43f8fc=_0x4eda12;_0x4b5a3e[_0x1796f1]['stock']=Math[_0x43f8fc(0x1de)](_0x19fe32);}),_0x38186e[_0x4eda12(0x1f5)]((_0x2eed28,_0x339102)=>{_0x4b5a3e[_0x339102]['quantity']=_0x2eed28;}),_0x4c41b6[_0x4eda12(0x1f5)]((_0x4f82b3,_0x5a2bd6)=>{var _0x315ad4=_0x4eda12;_0x4b5a3e[_0x5a2bd6][_0x315ad4(0x1d8)]=_0x4f82b3;}),_0x5f51c9[_0x4eda12(0x1f5)]((_0x277df3,_0x1d911c)=>{var _0x347b15=_0x4eda12;_0x4b5a3e[_0x1d911c][_0x347b15(0x104)]=_0x277df3;}),_0x4d9c4b[_0x4eda12(0x1f5)]((_0x4095f6,_0x369926)=>{var _0x2860d7=_0x4eda12;_0x4b5a3e[_0x369926][_0x2860d7(0x19e)]=_0x4095f6;}),_0x30315d['forEach']((_0x2b7b3f,_0x566b15)=>{_0x595aa9['forEach']((_0x48c946,_0x41f5a5)=>{var _0x5522c7=a0_0x165b;if(_0x48c946==_0x5522c7(0x194)&&_0x566b15==_0x41f5a5){var _0x367fb0=_0x2b7b3f[_0x5522c7(0x1ec)](0x3);_0x4b5a3e[_0x566b15][_0x5522c7(0x183)]=_0x2b7b3f[0x0],_0x4b5a3e[_0x566b15][_0x5522c7(0x154)]=_0x2b7b3f[0x1],_0x4b5a3e[_0x566b15][_0x5522c7(0x156)]=0x0,_0x4b5a3e[_0x566b15][_0x5522c7(0x17d)]=0x0,_0x4b5a3e[_0x566b15]['type']=_0x5522c7(0x103),_0x4b5a3e[_0x566b15][_0x5522c7(0x1b8)]=_0x367fb0;}else{if(_0x48c946==_0x5522c7(0x18d)&&_0x566b15==_0x41f5a5){var _0x367fb0=_0x2b7b3f[_0x5522c7(0x1ec)](0x3);_0x4b5a3e[_0x566b15]['storage']=_0x2b7b3f[0x0],_0x4b5a3e[_0x566b15][_0x5522c7(0x154)]=_0x2b7b3f[0x1],_0x4b5a3e[_0x566b15][_0x5522c7(0x156)]=0x0,_0x4b5a3e[_0x566b15][_0x5522c7(0x17d)]=0x0,_0x4b5a3e[_0x566b15][_0x5522c7(0x10e)]=_0x5522c7(0x103),_0x4b5a3e[_0x566b15][_0x5522c7(0x1b8)]=_0x2b7b3f[0x5];}else{if(_0x566b15==_0x41f5a5){var _0x261354;if(_0x2b7b3f[0x4]=='L')_0x261354=_0x5522c7(0x1c1);else _0x2b7b3f[0x4]=='F'&&(_0x261354='Floor');_0x4b5a3e[_0x566b15][_0x5522c7(0x183)]=_0x2b7b3f[0x0],_0x4b5a3e[_0x566b15][_0x5522c7(0x154)]=_0x2b7b3f[0x1],_0x4b5a3e[_0x566b15][_0x5522c7(0x156)]=_0x2b7b3f[0x2],_0x4b5a3e[_0x566b15]['bin']=_0x2b7b3f[0x3],_0x4b5a3e[_0x566b15][_0x5522c7(0x10e)]=_0x261354,_0x4b5a3e[_0x566b15][_0x5522c7(0x1b8)]=_0x2b7b3f[0x5];}}}});}),_0xe45bb5[_0x4eda12(0x1f5)]((_0x1292db,_0x106fd2)=>{var _0x42fdfa=_0x4eda12;_0x4b5a3e[_0x106fd2][_0x42fdfa(0x1d4)]=_0x1292db;}),_0x218375[_0x4eda12(0x1f5)]((_0x534fdf,_0x12499a)=>{_0x4b5a3e[_0x12499a]['secondary_unit']=_0x534fdf;}),_0x53edb2[_0x4eda12(0x1f5)]((_0x1fc4f1,_0x239c9d)=>{var _0x12bee1=_0x4eda12;_0x4b5a3e[_0x239c9d][_0x12bee1(0x1a8)]=_0x1fc4f1;}),_0x465dd2[_0x4eda12(0x1f5)]((_0x3cd049,_0x44f9a9)=>{var _0x4f0b10=_0x4eda12;_0x4b5a3e[_0x44f9a9][_0x4f0b10(0x12e)]=_0x3cd049;}),_0x5c8703[_0x4eda12(0x1f5)]((_0x53d8ef,_0x1fa157)=>{var _0x2be97d=_0x4eda12;_0x4b5a3e[_0x1fa157][_0x2be97d(0x162)]=_0x53d8ef;}),_0x44c3e9[_0x4eda12(0x1f5)]((_0x2d15ef,_0x1be9e6)=>{_0x4b5a3e[_0x1be9e6]['production_date']=_0x2d15ef;}),_0x4cb7ad[_0x4eda12(0x1f5)]((_0x2bb52b,_0x2e10c6)=>{var _0x18ce13=_0x4eda12;_0x4b5a3e[_0x2e10c6]['requested_qty']=Math[_0x18ce13(0x1de)](_0x2bb52b);}),_0x1f5f73[_0x4eda12(0x1f5)]((_0x25e834,_0x40abf9)=>{var _0x931c3c=_0x4eda12;_0x4b5a3e[_0x40abf9][_0x931c3c(0xf5)]=_0x25e834;}),_0x453c7c[_0x4eda12(0x1f5)]((_0x1dab75,_0x216763)=>{var _0x2bae6e=_0x4eda12;_0x4b5a3e[_0x216763][_0x2bae6e(0xec)]=_0x1dab75;}),_0x457968[_0x4eda12(0x1f5)]((_0x193699,_0x1e1b74)=>{var _0x46a829=_0x4eda12;_0x4b5a3e[_0x1e1b74][_0x46a829(0x152)]=_0x193699;}),_0x35dced[_0x4eda12(0x1f5)]((_0x138b41,_0x55efc5)=>{_0x4b5a3e[_0x55efc5]['quantity_notConverted']=_0x138b41;}),_0x595aa9[_0x4eda12(0x1f5)]((_0x131444,_0x5cf9c5)=>{var _0x46ae98=_0x4eda12;_0x4b5a3e[_0x5cf9c5][_0x46ae98(0x163)]=_0x131444;});var _0x48e2c4=0x0;_0x4b5a3e[_0x4eda12(0x1f5)](_0x3afc75=>{var _0xce947a=_0x4eda12;console[_0xce947a(0xe8)]('foreach\x20newproduct',_0x3afc75),(parseInt(_0x3afc75[_0xce947a(0x18b)])<parseInt(_0x3afc75[_0xce947a(0x197)])||parseInt(_0x3afc75[_0xce947a(0x197)])==0x0)&&_0x48e2c4++;});if(_0x48e2c4!=0x0)return _0x3b49e3[_0x4eda12(0x171)](_0x4eda12(0x1a9),_0x4eda12(0xf8)),_0x3ebe6a['redirect']('back');const _0x4db175=_0x4b5a3e[_0x4eda12(0x1e3)](_0xd34a0f=>_0xd34a0f[_0x4eda12(0x197)]!=='0'&&_0xd34a0f['quantity']!=='');_0x4de5dc['invoice']=_0x170727,_0x4de5dc[_0x4eda12(0x1f6)]=_0x5b8046,_0x4de5dc['date']=_0x590974,_0x4de5dc[_0x4eda12(0x1e1)]=_0x38c5ba,_0x4de5dc['sale_product']=_0x4db175,_0x4de5dc[_0x4eda12(0x135)]=_0x423e4c,_0x4de5dc['SCRN']=_0x47cd60,_0x4de5dc[_0x4eda12(0x141)]=_0x4eda12(0x142),_0x4de5dc[_0x4eda12(0x117)]=_0x4eda12(0x142);const _0x2f32ab=await _0x4de5dc[_0x4eda12(0x164)]();_0x3b49e3[_0x4eda12(0x171)](_0x4eda12(0x18a),_0x4eda12(0x17f)),_0x3ebe6a[_0x4eda12(0x1c4)](_0x4eda12(0x13c));}catch(_0x3d3916){console[_0x4eda12(0xe8)](_0x3d3916);}}),router[a0_0x485c6b(0x19d)](a0_0x485c6b(0x1e6),auth,async(_0xf6b80c,_0x228f38)=>{var _0x26c6ee=a0_0x485c6b;try{const _0x69843=_0xf6b80c[_0x26c6ee(0x1f1)]['id'],{invoice:_0x1abde4,customer:_0x14b1b7,receivable_amount:_0x1f1229,received_amount:_0x334aad}=_0xf6b80c[_0x26c6ee(0x1b1)],_0x5b08ff=await sales[_0x26c6ee(0x165)](_0x69843);console[_0x26c6ee(0xe8)](_0x5b08ff);var _0x510d6f=_0x1f1229-_0x334aad;console[_0x26c6ee(0xe8)](_0x334aad),_0x5b08ff[_0x26c6ee(0x1c7)]=parseFloat(_0x334aad)+parseFloat(_0x5b08ff[_0x26c6ee(0x1c7)]),_0x5b08ff[_0x26c6ee(0x109)]=_0x510d6f,console[_0x26c6ee(0xe8)](_0x5b08ff);const _0x5013f2=await _0x5b08ff[_0x26c6ee(0x164)](),_0x37b2e8=await c_payment_data['findOne']({'invoice':_0x1abde4});_0x37b2e8[_0x26c6ee(0x189)]=_0x510d6f,await _0x37b2e8['save']();let _0x5c0d78=new Date(),_0x11b93d=('0'+_0x5c0d78['getDate']())[_0x26c6ee(0x1ec)](-0x2),_0x8a8b37=('0'+(_0x5c0d78[_0x26c6ee(0x1da)]()+0x1))[_0x26c6ee(0x1ec)](-0x2),_0x50577a=_0x5c0d78[_0x26c6ee(0x1df)](),_0x32bbbe=_0x50577a+'-'+_0x8a8b37+'-'+_0x11b93d;const _0x40ac76=new customer_payment({'invoice':_0x1abde4,'date':_0x50577a+'-'+_0x8a8b37+'-'+_0x11b93d,'customer':_0x14b1b7,'reason':_0x26c6ee(0x191),'amount':_0x334aad}),_0x365728=await _0x40ac76['save']();_0xf6b80c[_0x26c6ee(0x171)](_0x26c6ee(0x18a),_0x26c6ee(0x181)),_0x228f38[_0x26c6ee(0x1c4)]('/all_sales/view');}catch(_0x3afb8c){console['log'](_0x3afb8c);}}),router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0xff),auth,async(_0x59baf9,_0x26f128)=>{var _0x32d3b1=a0_0x485c6b;try{const {username:_0x4abe06,email:_0xbef070,role:_0x2e79b4}=_0x59baf9[_0x32d3b1(0x199)],_0x19b372=_0x59baf9['user'],_0x24c9c2=await profile[_0x32d3b1(0x13f)]({'email':_0x19b372[_0x32d3b1(0x1ba)]}),_0x197bb0=await master_shop[_0x32d3b1(0x16c)]();console['log'](_0x32d3b1(0x1a3),_0x197bb0);const _0x18ad48=_0x59baf9[_0x32d3b1(0x1f1)]['id'],_0x11ff32=await sales['findById'](_0x18ad48);console['log'](_0x11ff32);const _0x51ef33=await customer['findOne']({'name':_0x11ff32['customer']});console[_0x32d3b1(0xe8)](_0x51ef33);if(_0x197bb0[0x0]['language']=='English\x20(US)'){var _0x93ba5e=users['English'];console[_0x32d3b1(0xe8)](_0x93ba5e);}else{if(_0x197bb0[0x0][_0x32d3b1(0x185)]=='Hindi')var _0x93ba5e=users[_0x32d3b1(0x130)];else{if(_0x197bb0[0x0][_0x32d3b1(0x185)]=='German')var _0x93ba5e=users['German'];else{if(_0x197bb0[0x0][_0x32d3b1(0x185)]=='Spanish')var _0x93ba5e=users[_0x32d3b1(0x1bf)];else{if(_0x197bb0[0x0][_0x32d3b1(0x185)]==_0x32d3b1(0x158))var _0x93ba5e=users[_0x32d3b1(0x158)];else{if(_0x197bb0[0x0][_0x32d3b1(0x185)]==_0x32d3b1(0x128))var _0x93ba5e=users[_0x32d3b1(0x19b)];else{if(_0x197bb0[0x0][_0x32d3b1(0x185)]==_0x32d3b1(0x105))var _0x93ba5e=users[_0x32d3b1(0x105)];else{if(_0x197bb0[0x0]['language']==_0x32d3b1(0x167))var _0x93ba5e=users['Arabic'];}}}}}}}_0x26f128[_0x32d3b1(0x143)](_0x32d3b1(0x1ce),{'success':_0x59baf9[_0x32d3b1(0x171)](_0x32d3b1(0x18a)),'errors':_0x59baf9[_0x32d3b1(0x171)](_0x32d3b1(0x1a9)),'role':_0x19b372,'profile':_0x24c9c2,'master_shop':_0x197bb0,'customers':_0x51ef33,'sales':_0x11ff32,'language':_0x93ba5e});}catch(_0x2b3bed){console['log'](_0x2b3bed);}}),router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0xe7),auth,async(_0x3d39a1,_0x19350c)=>{var _0x122cc6=a0_0x485c6b;try{const {username:_0x2e3a49,email:_0x12c44c,role:_0x200630}=_0x3d39a1[_0x122cc6(0x199)],_0x46971c=_0x3d39a1['user'],_0x4d641b=await profile[_0x122cc6(0x13f)]({'email':_0x46971c[_0x122cc6(0x1ba)]}),_0x1f246d=await master_shop['find']();console['log'](_0x122cc6(0x1a3),_0x1f246d);const _0x5dc906=_0x3d39a1[_0x122cc6(0x1f1)]['id'];console['log'](_0x5dc906);const _0x155dcf=await sales[_0x122cc6(0x165)](_0x5dc906);console[_0x122cc6(0xe8)](_0x122cc6(0x1e7),_0x155dcf);const _0x32e89=await warehouse[_0x122cc6(0xf2)]([{'$match':{'name':'Return\x20Goods','room':_0x122cc6(0x115)}},{'$unwind':_0x122cc6(0xe9)},{'$group':{'_id':_0x122cc6(0x1b7),'name':{'$first':_0x122cc6(0x169)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x122cc6(0xee)},'primary_code':{'$first':_0x122cc6(0x1d2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x122cc6(0x1b4)}}}]);console[_0x122cc6(0xe8)](_0x122cc6(0x174),_0x32e89);const _0x210365=await product[_0x122cc6(0x16c)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x122cc6(0x17c),'name':_0x122cc6(0x1a4),'warehouse_category':_0x122cc6(0x138)}},{'$group':{'_id':_0x122cc6(0x1cc),'name':{'$first':_0x122cc6(0x1cc)}}},{'$sort':{'name':0x1}}]);var _0x2b1288=[_0x122cc6(0x115)];if(_0x1f246d[0x0]['language']==_0x122cc6(0x1f3)){var _0x58d111=users[_0x122cc6(0x144)];console[_0x122cc6(0xe8)](_0x58d111);}else{if(_0x1f246d[0x0][_0x122cc6(0x185)]==_0x122cc6(0x130))var _0x58d111=users['Hindi'];else{if(_0x1f246d[0x0]['language']==_0x122cc6(0x11f))var _0x58d111=users[_0x122cc6(0x11f)];else{if(_0x1f246d[0x0][_0x122cc6(0x185)]==_0x122cc6(0x1bf))var _0x58d111=users['Spanish'];else{if(_0x1f246d[0x0][_0x122cc6(0x185)]==_0x122cc6(0x158))var _0x58d111=users[_0x122cc6(0x158)];else{if(_0x1f246d[0x0][_0x122cc6(0x185)]=='Portuguese\x20(BR)')var _0x58d111=users[_0x122cc6(0x19b)];else{if(_0x1f246d[0x0][_0x122cc6(0x185)]==_0x122cc6(0x105))var _0x58d111=users[_0x122cc6(0x105)];else{if(_0x1f246d[0x0][_0x122cc6(0x185)]==_0x122cc6(0x167))var _0x58d111=users[_0x122cc6(0x1dc)];}}}}}}}_0x19350c['render'](_0x122cc6(0x15a),{'success':_0x3d39a1['flash'](_0x122cc6(0x18a)),'errors':_0x3d39a1[_0x122cc6(0x171)](_0x122cc6(0x1a9)),'role':_0x46971c,'profile':_0x4d641b,'user':_0x155dcf,'stock':_0x32e89,'master_shop':_0x1f246d,'unit':_0x210365,'language':_0x58d111,'warehouses':warehouse_data,'rooms':_0x2b1288});}catch(_0x1e1475){console[_0x122cc6(0xe8)](_0x1e1475),_0x19350c[_0x122cc6(0x10f)](0xc8)['json']({'message':_0x1e1475[_0x122cc6(0x180)]});}}),router['post'](a0_0x485c6b(0xe7),auth,async(_0x3fd405,_0x4649d4)=>{var _0x1e9b6a=a0_0x485c6b;try{const {invoice:_0x50fe4e,date:_0x2681b5,warehouse_name:_0x54c677,product_name:_0x42c608,primary_code:_0x29ac8c,secondary_code:_0x4dc5fd,product_code:_0x149446,sales_quantity:_0x497351,stocks:_0x24ef09,return_qty:_0x3ccf89,Room_name:_0x51d795,to_warehouse_name:_0x342096,to_Roomname:_0x3d1677,to_Room_name:_0x245077,note:_0x4f86e3,level:_0xac5cee,isle:_0x11820c,pallet:_0x504a90}=_0x3fd405[_0x1e9b6a(0x1b1)];if(typeof _0x42c608=='string')var _0xc0fc75=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x125)]],_0x4bedfe=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x1d8)]],_0x5ef02a=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x104)]],_0x16e5c4=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x19e)]],_0x16fc9a=[_0x3fd405[_0x1e9b6a(0x1b1)]['sales_quantity']],_0x893fc3=[_0x3fd405[_0x1e9b6a(0x1b1)]['stocks']],_0x5d27f7=[_0x3fd405['body'][_0x1e9b6a(0x19a)]],_0x20bc16=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x156)]],_0x5f2dfc=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x17d)]],_0xe75cdc=[_0x3fd405[_0x1e9b6a(0x1b1)]['types']],_0x3b90a4=[_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x1b8)]];else var _0xc0fc75=[..._0x3fd405['body'][_0x1e9b6a(0x125)]],_0x4bedfe=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x1d8)]],_0x5ef02a=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x104)]],_0x16e5c4=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x19e)]],_0x16fc9a=[..._0x3fd405[_0x1e9b6a(0x1b1)]['sales_quantity']],_0x893fc3=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x18c)]],_0x5d27f7=[..._0x3fd405[_0x1e9b6a(0x1b1)]['return_qty']],_0x20bc16=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x156)]],_0x5f2dfc=[..._0x3fd405['body'][_0x1e9b6a(0x17d)]],_0xe75cdc=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0xf1)]],_0x3b90a4=[..._0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x1b8)]];const _0x5e86ef=_0xc0fc75['map'](_0x122123=>{return _0x122123={'product_name':_0x122123};});_0x4bedfe[_0x1e9b6a(0x1f5)]((_0xabadb4,_0x1112c6)=>{var _0x488965=_0x1e9b6a;_0x5e86ef[_0x1112c6][_0x488965(0x1d8)]=_0xabadb4;}),_0x5ef02a[_0x1e9b6a(0x1f5)]((_0x59b4ac,_0x592e61)=>{var _0x37d758=_0x1e9b6a;_0x5e86ef[_0x592e61][_0x37d758(0x104)]=_0x59b4ac;}),_0x16e5c4['forEach']((_0x520120,_0x546ef2)=>{_0x5e86ef[_0x546ef2]['product_code']=_0x520120;}),_0x16fc9a[_0x1e9b6a(0x1f5)]((_0x148f0a,_0xb21461)=>{var _0x24f06d=_0x1e9b6a;_0x5e86ef[_0xb21461][_0x24f06d(0x182)]=_0x148f0a;}),_0x893fc3[_0x1e9b6a(0x1f5)]((_0x5e10d5,_0x1fbd72)=>{var _0x49f20b=_0x1e9b6a;_0x5e86ef[_0x1fbd72][_0x49f20b(0x18b)]=_0x5e10d5;}),_0x5d27f7[_0x1e9b6a(0x1f5)]((_0x142da5,_0x2ad10e)=>{_0x5e86ef[_0x2ad10e]['return_qty']=_0x142da5;}),_0x20bc16[_0x1e9b6a(0x1f5)]((_0x724a16,_0x53e00e)=>{var _0x47d6c7=_0x1e9b6a;_0x5e86ef[_0x53e00e][_0x47d6c7(0x156)]=_0x724a16;}),_0x5f2dfc['forEach']((_0x21e061,_0x379975)=>{var _0x5ef046=_0x1e9b6a;_0x5e86ef[_0x379975][_0x5ef046(0x17d)]=_0x21e061;}),_0xe75cdc[_0x1e9b6a(0x1f5)]((_0x189da6,_0x3901e9)=>{var _0x3634aa=_0x1e9b6a;_0x5e86ef[_0x3901e9][_0x3634aa(0x10e)]=_0x189da6;}),_0x3b90a4['forEach']((_0x912edd,_0x285073)=>{_0x5e86ef[_0x285073]['floorlevel']=_0x912edd;});var _0x33e466=0x0;_0x5e86ef[_0x1e9b6a(0x1f5)](_0x2f72ad=>{var _0x3b84fd=_0x1e9b6a;console[_0x3b84fd(0xe8)](_0x3b84fd(0x13b),_0x2f72ad),(parseInt(_0x2f72ad[_0x3b84fd(0x182)])<parseInt(_0x2f72ad['return_qty'])||parseInt(_0x2f72ad[_0x3b84fd(0x18b)])<parseInt(_0x2f72ad[_0x3b84fd(0x19a)])&&parseInt(_0x2f72ad[_0x3b84fd(0x182)])>parseInt(_0x2f72ad[_0x3b84fd(0x19a)])||parseInt(_0x2f72ad[_0x3b84fd(0x19a)])==0x0)&&_0x33e466++;});if(_0x33e466!=0x0)return _0x3fd405['flash']('errors',_0x1e9b6a(0x10d)),_0x4649d4[_0x1e9b6a(0x1c4)](_0x1e9b6a(0x1bd));const _0x42b197=await sales['findOne']({'invoice':_0x50fe4e});console[_0x1e9b6a(0xe8)](_0x42b197),_0x42b197[_0x1e9b6a(0x1cb)]=_0x1e9b6a(0xfb);const _0x33e9c4=await _0x42b197[_0x1e9b6a(0x164)](),_0x2ed29b=new sales_return({'invoice':_0x50fe4e,'customer':_0x3fd405[_0x1e9b6a(0x1b1)]['customer'],'date':_0x2681b5,'warehouse_name':_0x54c677,'room':_0x51d795,'ToWarehouse':_0x342096,'ToRoom':_0x245077,'return_sale':_0x5e86ef,'note':_0x4f86e3}),_0xe14e92=await _0x2ed29b[_0x1e9b6a(0x164)]();console['log'](_0x2ed29b);const _0x15ab20=await sales_return[_0x1e9b6a(0x13f)]({'invoice':_0x50fe4e}),_0x5dc110=await warehouse[_0x1e9b6a(0x13f)]({'name':_0x342096,'room':_0x245077});_0x15ab20[_0x1e9b6a(0x15a)][_0x1e9b6a(0x1f5)](_0xc43f07=>{var _0x30a0b3=_0x1e9b6a,_0x1ec151=0x0;const _0x367914=_0x5dc110[_0x30a0b3(0x1ed)][_0x30a0b3(0x15f)](_0x59f077=>{var _0x366e1d=_0x30a0b3;_0x59f077[_0x366e1d(0x125)]==_0xc43f07[_0x366e1d(0x125)]&&_0x59f077[_0x366e1d(0x1b8)]==_0xc43f07[_0x366e1d(0x1b8)]&&_0x59f077[_0x366e1d(0x10e)]==_0xc43f07[_0x366e1d(0x10e)]&&_0x59f077['bin']==_0xc43f07[_0x366e1d(0x17d)]&&_0x59f077[_0x366e1d(0x156)]==_0xc43f07[_0x366e1d(0x156)]&&(_0x59f077[_0x366e1d(0xf7)]=parseInt(_0x59f077[_0x366e1d(0xf7)])+parseInt(_0xc43f07[_0x366e1d(0x19a)]),_0x1ec151++);});_0x1ec151=='0'&&(_0x5dc110[_0x30a0b3(0x1ed)]=_0x5dc110[_0x30a0b3(0x1ed)][_0x30a0b3(0x1ab)]({'product_name':_0xc43f07['product_name'],'product_stock':_0xc43f07[_0x30a0b3(0x19a)],'primary_code':_0xc43f07[_0x30a0b3(0x1d8)],'secondary_code':_0xc43f07[_0x30a0b3(0x104)],'product_code':_0xc43f07[_0x30a0b3(0x19e)],'bay':_0xc43f07[_0x30a0b3(0x156)],'bin':_0xc43f07[_0x30a0b3(0x17d)],'type':_0xc43f07[_0x30a0b3(0x10e)],'floorlevel':_0xc43f07[_0x30a0b3(0x1b8)]})),console[_0x30a0b3(0xe8)](_0x30a0b3(0x14f),_0x5dc110);}),await _0x5dc110['save'](),console['log'](_0x3fd405[_0x1e9b6a(0x1b1)]);const _0x4d06ba=new c_payment_data({'invoice':_0x50fe4e,'customer':_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x1f6)],'reason':_0x1e9b6a(0xf0)});await _0x4d06ba[_0x1e9b6a(0x164)]();const _0xacf7a2=await master_shop['find']();console[_0x1e9b6a(0xe8)](_0x1e9b6a(0x116),_0xacf7a2[0x0]['image']);const _0x303ee9=await email_settings[_0x1e9b6a(0x13f)](),_0x50de27=await customer[_0x1e9b6a(0x13f)]({'name':_0x3fd405[_0x1e9b6a(0x1b1)][_0x1e9b6a(0x1f6)]});console[_0x1e9b6a(0xe8)](_0x1e9b6a(0x15b),_0x50de27);_0xacf7a2[0x0][_0x1e9b6a(0x153)]==0x1?(right_currency=_0xacf7a2[0x0][_0x1e9b6a(0x1f7)],left_currency=''):(right_currency='',left_currency=_0xacf7a2[0x0][_0x1e9b6a(0x1f7)]);var _0xcc8b76=_0xc0fc75,_0x23c8f3=_0x5d27f7,_0x4ab834='',_0x86660f;for(_0x86660f in _0xcc8b76){_0x4ab834+='<tr>'+_0x1e9b6a(0x11b)+_0xcc8b76[_0x86660f]+_0x1e9b6a(0x179)+_0x1e9b6a(0x11b)+_0x23c8f3[_0x86660f]+_0x1e9b6a(0x179)+_0x1e9b6a(0x134);}console[_0x1e9b6a(0xe8)](_0x1e9b6a(0x190),_0x4ab834);let _0x31c724=nodemailer['createTransport']({'service':_0x1e9b6a(0x114),'auth':{'user':_0x303ee9[_0x1e9b6a(0x1ba)],'pass':_0x303ee9[_0x1e9b6a(0x14e)]}}),_0xc5fba7={'from':_0x303ee9[_0x1e9b6a(0x1ba)],'to':_0x50de27[_0x1e9b6a(0x1ba)],'subject':_0x1e9b6a(0x1bb),'attachments':[{'filename':_0x1e9b6a(0xef),'path':__dirname+'/../public'+'/upload/'+_0xacf7a2[0x0]['image'],'cid':_0x1e9b6a(0x102)}],'html':_0x1e9b6a(0x1c5)+_0x1e9b6a(0x1d3)+_0x1e9b6a(0x195)+'<div>'+_0x1e9b6a(0x1a5)+_0x1e9b6a(0x15d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1e9b6a(0x13a)+_0x1e9b6a(0x15d)+'<h2>\x20'+_0xacf7a2[0x0][_0x1e9b6a(0x1f9)]+_0x1e9b6a(0x145)+_0x1e9b6a(0x13a)+_0x1e9b6a(0x13a)+_0x1e9b6a(0x147)+'<div>'+_0x1e9b6a(0x1b9)+_0x1e9b6a(0x1ea)+_0x50fe4e+'\x20'+_0x1e9b6a(0x15c)+_0x1e9b6a(0x186)+_0x2681b5+'\x20'+_0x1e9b6a(0x1c0)+_0x1e9b6a(0x1db)+_0x1e9b6a(0x13a)+_0x1e9b6a(0x1eb)+_0x1e9b6a(0x16f)+_0x1e9b6a(0x17a)+_0x1e9b6a(0x146)+_0x1e9b6a(0xfa)+_0x1e9b6a(0x132)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x1e9b6a(0x10a)+'\x20'+_0x4ab834+'\x20'+'</tbody>'+_0x1e9b6a(0x178)+_0x1e9b6a(0x15d)+_0x1e9b6a(0x149)+'<h5>'+_0xacf7a2[0x0][_0x1e9b6a(0x1f9)]+_0x1e9b6a(0x1db)+_0x1e9b6a(0x13a)+_0x1e9b6a(0x13a)+_0x1e9b6a(0x1f4)};_0x31c724['sendMail'](_0xc5fba7,function(_0x279d7a,_0x1d7441){var _0x2fc5c6=_0x1e9b6a;_0x279d7a?(console[_0x2fc5c6(0xe8)](_0x279d7a),console[_0x2fc5c6(0xe8)](_0x2fc5c6(0xe4))):console[_0x2fc5c6(0xe8)]('Email\x20sent\x20successfully');}),_0x3fd405[_0x1e9b6a(0x171)](_0x1e9b6a(0x18a),_0x1e9b6a(0x1be)),_0x4649d4[_0x1e9b6a(0x1c4)](_0x1e9b6a(0x13c));}catch(_0x40bb95){console[_0x1e9b6a(0xe8)](_0x40bb95),_0x4649d4[_0x1e9b6a(0x10f)](0xc8)['json']({'message1':_0x40bb95[_0x1e9b6a(0x180)]});}}),router[a0_0x485c6b(0x1b2)](a0_0x485c6b(0x126),auth,async(_0x19020a,_0x34a815)=>{var _0x54b1d9=a0_0x485c6b;try{const {username:_0x5e3b7c,email:_0xde09e1,role:_0x21bb93}=_0x19020a[_0x54b1d9(0x199)],_0x5606a1=_0x19020a['user'],_0x11cc41=await profile['findOne']({'email':_0x5606a1[_0x54b1d9(0x1ba)]}),_0x22e521=await master_shop['find']();console[_0x54b1d9(0xe8)](_0x54b1d9(0x1a2),_0x22e521);const _0x4675b5=_0x19020a[_0x54b1d9(0x1f1)]['id'],_0x53149d=await sales['findById'](_0x4675b5);console[_0x54b1d9(0xe8)]('barcode\x20user_id',_0x53149d);if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x1f3))var _0x46e405=users[_0x54b1d9(0x144)];else{if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x130))var _0x46e405=users[_0x54b1d9(0x130)];else{if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x11f))var _0x46e405=users[_0x54b1d9(0x11f)];else{if(_0x22e521[0x0]['language']==_0x54b1d9(0x1bf))var _0x46e405=users[_0x54b1d9(0x1bf)];else{if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x158))var _0x46e405=users['French'];else{if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x128))var _0x46e405=users['Portuguese'];else{if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x105))var _0x46e405=users['Chinese'];else{if(_0x22e521[0x0][_0x54b1d9(0x185)]==_0x54b1d9(0x167))var _0x46e405=users[_0x54b1d9(0x1dc)];}}}}}}}_0x34a815[_0x54b1d9(0x143)](_0x54b1d9(0x137),{'success':_0x19020a[_0x54b1d9(0x171)](_0x54b1d9(0x18a)),'errors':_0x19020a[_0x54b1d9(0x171)](_0x54b1d9(0x1a9)),'role':_0x5606a1,'profile':_0x11cc41,'alldata':_0x53149d,'master_shop':_0x22e521,'language':_0x46e405});}catch(_0x24808a){console[_0x54b1d9(0xe8)](_0x24808a);}}),router[a0_0x485c6b(0x19d)](a0_0x485c6b(0x177),async(_0x84235a,_0x223b93)=>{var _0x42405b=a0_0x485c6b;const {product_code:_0xa14ae9,warehouse_name:_0x985827,rooms_data:_0x5cd266,Roomslist:_0xc46b6d}=_0x84235a[_0x42405b(0x1b1)],_0x56c7ee=_0xc46b6d[_0x42405b(0x1cf)](','),_0x40a3bd=[];async function _0x3859b7(_0x56000f){var _0x128776=_0x42405b;const _0x3a0bae=await warehouse[_0x128776(0xf2)]([{'$match':{'name':_0x985827,'room':_0x56000f}},{'$unwind':_0x128776(0xe9)},{'$match':{'product_details.primary_code':_0xa14ae9}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x128776(0x169)},'product_stock':{'$first':_0x128776(0x19f)},'primary_code':{'$first':_0x128776(0x1d2)},'secondary_code':{'$first':_0x128776(0x131)},'product_code':{'$first':_0x128776(0x1b4)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x128776(0x1e9)},'pallet':{'$first':_0x128776(0x14c)},'unit':{'$first':_0x128776(0x107)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x128776(0x1ee)},'rack':{'$first':_0x128776(0x193)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x128776(0x12f)},'maxPerUnit':{'$first':_0x128776(0x148)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x128776(0x1b0)},'actual_qty':{'$first':_0x128776(0x140)},'actual_uom':{'$first':_0x128776(0x1ae)}}}]),_0x5dd651=await warehouse[_0x128776(0xf2)]([{'$match':{'name':_0x985827,'room':_0x56000f}},{'$unwind':_0x128776(0xe9)},{'$match':{'product_details.secondary_code':_0xa14ae9}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x128776(0x169)},'product_stock':{'$first':_0x128776(0x19f)},'primary_code':{'$first':_0x128776(0x1d2)},'secondary_code':{'$first':_0x128776(0x131)},'product_code':{'$first':_0x128776(0x1b4)},'level':{'$first':_0x128776(0x13e)},'isle':{'$first':_0x128776(0x124)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x128776(0x14c)},'unit':{'$first':_0x128776(0x107)},'secondary_unit':{'$first':_0x128776(0x1a0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x128776(0x193)},'expiry_date':{'$first':_0x128776(0x118)},'production_date':{'$first':_0x128776(0x12f)},'maxPerUnit':{'$first':_0x128776(0x148)},'batch_code':{'$first':_0x128776(0x10c)},'product_cat':{'$first':_0x128776(0x159)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x128776(0x157)},'invoice':{'$first':_0x128776(0x1b0)}}}]);if(_0x3a0bae[_0x128776(0x112)]>0x0)_0x40a3bd['push'](_0x3a0bae);else _0x5dd651[_0x128776(0x112)]>0x0&&_0x40a3bd['push'](_0x5dd651);}const _0x3c35aa=_0x56c7ee[_0x42405b(0x15f)](_0x36a855=>_0x3859b7(_0x36a855));await Promise[_0x42405b(0x113)](_0x3c35aa),_0x223b93[_0x42405b(0x1d6)](_0x40a3bd);}),module[a0_0x485c6b(0x1d0)]=router;