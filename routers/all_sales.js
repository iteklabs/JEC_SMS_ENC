function a0_0x2109(_0x334683,_0x2a5e50){var _0x382e14=a0_0x382e();return a0_0x2109=function(_0x21095c,_0x559fe5){_0x21095c=_0x21095c-0x1cd;var _0x4ee28a=_0x382e14[_0x21095c];return _0x4ee28a;},a0_0x2109(_0x334683,_0x2a5e50);}var a0_0x32557a=a0_0x2109;function a0_0x382e(){var _0x22dd6f=['/view/return_sales/:id','string','language','customer','sales\x20item\x20return\x20successfull','/all_sales/view','/preview/:id','_id','/give_payment/:id','Shelves','/upload/','17586pdOPoz','Sale\x20Return','floorlevel','Ambient','$product_details.primary_code','master','/barcode/:id','/barcode_scanner','$invoice','message','/view/add_sale/product','$product_details.expiry_date','</body></html>','delivery_date','$product_details.isle','carton','$date','Chinese','37520VTvoNi','$sale_product.quantity','body','findOne','Floor','$product.product_name','invoice','secondary_code','site_title','$product_details.product_name','storage','maxperunit','product_details','json','$product_details.secondary_code','bay','floor','</div>','params','quantity_notConverted','180kuHwSw','expiry_date','$sale_product.bin','product','error','isAllowEdit','product_data','<tr>','$product_details.secondary_unit','<tbody\x20style=\x22text-align:\x20center;\x22>','<!DOCTYPE\x20html>','$warehouse_name','quantity','image','/all_sales/preview/','$return_data','Enabled','foreach\x20newproduct','staff','<h2>\x20','warehouse_name','Received\x20Payment\x20For\x20Sale','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','host','Hindi','Sales\x20Add\x20successfully','unit','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','room_name','</span>','purchases_data','redirect','Sale\x20Return\x20Mail','return_sale','$product_details.bay','sales_quantity','find','</table>','currency','product_stock','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_cat','note','$product_details.storage','Raw\x20Materials','finalize','customer_data','French','prod_invoice','</td>','getFullYear','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$customer','final','\x20Order\x20Number\x20:\x20','/invoice/:id','$product_details.actual_uom','/view/:id','$product_details.floorlevel','user','actual_uom','63EiPJSA','/view/add_sales/:id','catch','filter','</tr>','product_name','$product_details.batch_code','$product_details','$product','\x20</h2>','currency_placement','True','aggregate','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','1912GFpjat','batch_code','then','padStart','$sale_product.bay','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','../middleware/auth','stock_data','$room','Return\x20Rooms','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','secondary_unit','Email\x20sent\x20successfully','</tbody>','errors','prod_code','add\x20post','map','return_qty','$_id','findById','OUT-','RoomAssigned','$product_details.production_date','Spanish','$sale_product','requested_qty','length','$product_details.bin','German','post','Enclosed','save','customers','sales\x20all_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','getMonth','</h5>','../models/all_models','logo','False','createTransport','$product_details.invoice','Receiving\x20Area','Logo.png','type','all_sales','amount','password','Error\x20Occurs','<html><head><title></title>','Arabic','$customers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','English','<strong>\x20Regards\x20</strong>','barcode\x20Product\x20master','all','sendMail','delivery_code','$product_details.product_stock','push','get','sale_qty','</thead>','max_per_unit','random','add_sales','Router','16756270eqbago','primary_unit','$product_details.rack','abs','RMSEmail','slice','<h5>','$product_details.product_code','bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','render','edit_sales','$product_details.maxPerUnit','customers_docs','product_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','rack','Portuguese\x20(BR)','log','English\x20(US)','level','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$finalize','<div>','<hr\x20class=\x22my-3\x22>','An\x20error\x20occurred.','$note','Return\x20Goods','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','id_transact','sale_product','Sales\x20Mail','$product_details.product_cat','sales_invoice','success','$sale_product.floorlevel','$isAllowEdit','name','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/view/add_sales','received_amount','types','Arabic\x20(ae)','$name','date','../public/language/languages.json','actual_qty','<span\x20style=\x22float:\x20right;\x22>','status','stock','$product_details._id','230250nLDZHM','gmail','463561fEDyrX','back','warehouse','1001770zWFgQi','/../public','</head><body>','port','max','forEach','primary_code','flash','SCRN','production_date','Level','\x20Order\x20Date\x20:\x20','Portuguese','role','$sale_product.type','31446BQTvlw','$product_details.unit','$product_details.type'];a0_0x382e=function(){return _0x22dd6f;};return a0_0x382e();}(function(_0x1ae187,_0xa7fad){var _0x16db52=a0_0x2109,_0x3709ff=_0x1ae187();while(!![]){try{var _0x21e698=parseInt(_0x16db52(0x2c5))/0x1+-parseInt(_0x16db52(0x2c8))/0x2+-parseInt(_0x16db52(0x2d7))/0x3*(parseInt(_0x16db52(0x1fb))/0x4)+-parseInt(_0x16db52(0x1e7))/0x5+parseInt(_0x16db52(0x2c3))/0x6*(-parseInt(_0x16db52(0x23b))/0x7)+parseInt(_0x16db52(0x249))/0x8*(-parseInt(_0x16db52(0x1d5))/0x9)+parseInt(_0x16db52(0x28f))/0xa;if(_0x21e698===_0xa7fad)break;else _0x3709ff['push'](_0x3709ff['shift']());}catch(_0x19b7df){_0x3709ff['push'](_0x3709ff['shift']());}}}(a0_0x382e,0x54a68));const express=require('express'),app=express(),router=express[a0_0x32557a(0x28e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x32557a(0x270)),auth=require(a0_0x32557a(0x250)),nodemailer=require('nodemailer'),users=require(a0_0x32557a(0x2bd));router[a0_0x32557a(0x288)]('/view',auth,async(_0x4d2f43,_0x465f32)=>{var _0x33fe37=a0_0x32557a;try{const {username:_0x17d0bc,email:_0x5c88fc,role:_0x1ab971}=_0x4d2f43[_0x33fe37(0x239)],_0x58a27c=_0x4d2f43['user'],_0x194687=await profile[_0x33fe37(0x1ea)]({'email':_0x58a27c[_0x33fe37(0x225)]}),_0x129b81=await master_shop[_0x33fe37(0x221)]();let _0x443202;if(_0x58a27c[_0x33fe37(0x2d5)]==_0x33fe37(0x20d)){const _0x3da879=await staff['findOne']({'email':_0x58a27c[_0x33fe37(0x225)]});_0x443202=await sales[_0x33fe37(0x247)]([{'$lookup':{'from':_0x33fe37(0x26b),'localField':_0x33fe37(0x1cd),'foreignField':_0x33fe37(0x2b4),'as':_0x33fe37(0x29c)}},{'$unwind':_0x33fe37(0x27e)},{'$unwind':_0x33fe37(0x263)},{'$group':{'_id':_0x33fe37(0x25d),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x33fe37(0x232)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x33fe37(0x263)},'note':{'$first':_0x33fe37(0x2a9)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x33fe37(0x1e8)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x33fe37(0x1fd)},'type':{'$addToSet':_0x33fe37(0x2d6)},'pallet':{'$addToSet':_0x33fe37(0x2b2)},'finalize':{'$first':_0x33fe37(0x2a5)},'isAllowEdit':{'$first':_0x33fe37(0x2b3)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x443202=await sales['aggregate']([{'$lookup':{'from':_0x33fe37(0x26b),'localField':_0x33fe37(0x1cd),'foreignField':_0x33fe37(0x2b4),'as':_0x33fe37(0x29c)}},{'$unwind':'$customers_docs'},{'$unwind':_0x33fe37(0x263)},{'$group':{'_id':_0x33fe37(0x25d),'invoice':{'$first':_0x33fe37(0x1dd)},'customers':{'$first':'$customer'},'date':{'$first':_0x33fe37(0x1e5)},'warehouse_name':{'$first':_0x33fe37(0x206)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x33fe37(0x2a9)},'return_data':{'$first':_0x33fe37(0x20a)},'customers_docs':{'$first':_0x33fe37(0x27e)},'total_saleproduct_quantity':{'$sum':_0x33fe37(0x1e8)},'level':{'$addToSet':_0x33fe37(0x24d)},'isle':{'$addToSet':_0x33fe37(0x1fd)},'type':{'$addToSet':_0x33fe37(0x2d6)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x33fe37(0x2a5)},'isAllowEdit':{'$first':_0x33fe37(0x2b3)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x33fe37(0x2a1)](_0x33fe37(0x26c),_0x443202);if(_0x129b81[0x0][_0x33fe37(0x2dc)]=='English\x20(US)'){var _0x20b461=users[_0x33fe37(0x280)];console[_0x33fe37(0x2a1)](_0x20b461);}else{if(_0x129b81[0x0][_0x33fe37(0x2dc)]==_0x33fe37(0x214))var _0x20b461=users[_0x33fe37(0x214)];else{if(_0x129b81[0x0][_0x33fe37(0x2dc)]==_0x33fe37(0x267))var _0x20b461=users[_0x33fe37(0x267)];else{if(_0x129b81[0x0][_0x33fe37(0x2dc)]==_0x33fe37(0x262))var _0x20b461=users[_0x33fe37(0x262)];else{if(_0x129b81[0x0][_0x33fe37(0x2dc)]==_0x33fe37(0x22d))var _0x20b461=users[_0x33fe37(0x22d)];else{if(_0x129b81[0x0][_0x33fe37(0x2dc)]==_0x33fe37(0x2a0))var _0x20b461=users[_0x33fe37(0x2d4)];else{if(_0x129b81[0x0]['language']=='Chinese')var _0x20b461=users['Chinese'];else{if(_0x129b81[0x0][_0x33fe37(0x2dc)]=='Arabic\x20(ae)')var _0x20b461=users[_0x33fe37(0x27d)];}}}}}}}_0x465f32['render'](_0x33fe37(0x278),{'success':_0x4d2f43[_0x33fe37(0x2cf)](_0x33fe37(0x2b1)),'errors':_0x4d2f43[_0x33fe37(0x2cf)](_0x33fe37(0x258)),'sales':_0x443202,'profile':_0x194687,'role':_0x58a27c,'master_shop':_0x129b81,'language':_0x20b461});}catch(_0x548968){console[_0x33fe37(0x2a1)](_0x548968);}});async function getRandom8DigitNumber(){var _0x25390a=a0_0x32557a;const _0x3ce485=0x989680,_0x27cb46=0x5f5e0ff,_0x2216b1=Math[_0x25390a(0x1f7)](Math[_0x25390a(0x28c)]()*(_0x27cb46-_0x3ce485+0x1))+_0x3ce485;var _0x5b64c3;const _0x2cef66=await sales[_0x25390a(0x1ea)]({'invoice':_0x25390a(0x25f)+_0x2216b1});return _0x2cef66&&_0x2cef66[_0x25390a(0x265)]>0x0?_0x5b64c3=_0x25390a(0x25f)+_0x2216b1:_0x5b64c3=_0x25390a(0x25f)+_0x2216b1,_0x5b64c3;}router[a0_0x32557a(0x288)](a0_0x32557a(0x2b7),auth,async(_0x185328,_0x5163b3)=>{var _0x1cb6ce=a0_0x32557a;try{const {username:_0x5267b5,email:_0x58c505,role:_0xd825e9}=_0x185328[_0x1cb6ce(0x239)],_0x9e0e1e=_0x185328['user'],_0x42582e=await profile[_0x1cb6ce(0x1ea)]({'email':_0x9e0e1e[_0x1cb6ce(0x225)]}),_0xaee6ef=await master_shop[_0x1cb6ce(0x221)](),_0x2085cd=await customer[_0x1cb6ce(0x221)]({});let _0x211927;if(_0x9e0e1e[_0x1cb6ce(0x2d5)]==_0x1cb6ce(0x20d)){const _0x45d418=await staff[_0x1cb6ce(0x1ea)]({'email':_0x9e0e1e[_0x1cb6ce(0x225)]});_0x211927=await warehouse[_0x1cb6ce(0x247)]([{'$match':{'status':'Enabled','name':_0x45d418[_0x1cb6ce(0x2c7)],'warehouse_category':_0x1cb6ce(0x22a),'name':{'$ne':_0x1cb6ce(0x2aa)}}},{'$group':{'_id':_0x1cb6ce(0x2bb),'name':{'$first':_0x1cb6ce(0x2bb)}}},{'$sort':{'name':0x1}}]);}else _0x211927=await warehouse[_0x1cb6ce(0x247)]([{'$match':{'status':'Enabled','warehouse_category':_0x1cb6ce(0x22a),'name':{'$ne':_0x1cb6ce(0x2aa)}}},{'$group':{'_id':_0x1cb6ce(0x2bb),'name':{'$first':_0x1cb6ce(0x2bb)}}},{'$sort':{'name':0x1}}]);const _0x48a5cf=await product[_0x1cb6ce(0x221)]({});var _0x5138bb=[_0x1cb6ce(0x1d8),_0x1cb6ce(0x269)];const _0x24df9f=await sales[_0x1cb6ce(0x221)]({}),_0x2b07ca=_0x24df9f[_0x1cb6ce(0x265)]+0x1,_0x443303=_0x1cb6ce(0x25f)+_0x2b07ca['toString']()[_0x1cb6ce(0x24c)](0x5,'0');if(_0xaee6ef[0x0][_0x1cb6ce(0x2dc)]=='English\x20(US)'){var _0x28f55e=users[_0x1cb6ce(0x280)];console[_0x1cb6ce(0x2a1)](_0x28f55e);}else{if(_0xaee6ef[0x0][_0x1cb6ce(0x2dc)]==_0x1cb6ce(0x214))var _0x28f55e=users[_0x1cb6ce(0x214)];else{if(_0xaee6ef[0x0]['language']==_0x1cb6ce(0x267))var _0x28f55e=users[_0x1cb6ce(0x267)];else{if(_0xaee6ef[0x0][_0x1cb6ce(0x2dc)]==_0x1cb6ce(0x262))var _0x28f55e=users[_0x1cb6ce(0x262)];else{if(_0xaee6ef[0x0]['language']==_0x1cb6ce(0x22d))var _0x28f55e=users[_0x1cb6ce(0x22d)];else{if(_0xaee6ef[0x0]['language']==_0x1cb6ce(0x2a0))var _0x28f55e=users['Portuguese'];else{if(_0xaee6ef[0x0][_0x1cb6ce(0x2dc)]=='Chinese')var _0x28f55e=users['Chinese'];else{if(_0xaee6ef[0x0][_0x1cb6ce(0x2dc)]==_0x1cb6ce(0x2ba))var _0x28f55e=users[_0x1cb6ce(0x27d)];}}}}}}}const _0x14693a=getRandom8DigitNumber();_0x14693a[_0x1cb6ce(0x24b)](_0x3a4c18=>{var _0x416f4e=_0x1cb6ce;_0x5163b3[_0x416f4e(0x299)](_0x416f4e(0x28d),{'success':_0x185328[_0x416f4e(0x2cf)]('success'),'errors':_0x185328[_0x416f4e(0x2cf)](_0x416f4e(0x258)),'role':_0x9e0e1e,'profile':_0x42582e,'customer':_0x2085cd,'warehouse':_0x211927,'product':_0x48a5cf,'invoice':_0x3a4c18,'master_shop':_0xaee6ef,'language':_0x28f55e,'rooms_data':_0x5138bb});})['catch'](_0x2e49d3=>{var _0x3401a6=_0x1cb6ce;_0x185328[_0x3401a6(0x2cf)]('errors',_0x3401a6(0x2a4)),_0x5163b3[_0x3401a6(0x21c)](_0x3401a6(0x1cf));});}catch(_0x52eaf8){console[_0x1cb6ce(0x2a1)](_0x52eaf8);}}),router[a0_0x32557a(0x288)](a0_0x32557a(0x23c),auth,async(_0x27eb66,_0x30d08d)=>{var _0x599878=a0_0x32557a;try{const _0x951b3f=_0x27eb66[_0x599878(0x1f9)]['id'];console[_0x599878(0x2a1)](_0x951b3f);const _0x3a7b24=await product[_0x599878(0x221)](),_0x2bd3a5=await purchases[_0x599878(0x247)]([{'$match':{'warehouse_name':_0x951b3f}},{'$unwind':_0x599878(0x243)},{'$group':{'_id':_0x599878(0x1ec)}}]);console[_0x599878(0x2a1)](_0x599878(0x21b),_0x2bd3a5),_0x30d08d[_0x599878(0x2c0)](0xc8)[_0x599878(0x1f4)]({'purchases_data':_0x2bd3a5,'product_data':_0x3a7b24});}catch(_0x2a4b46){console['log'](_0x2a4b46);}}),router[a0_0x32557a(0x268)](a0_0x32557a(0x1df),auth,async(_0x5a8842,_0x4b6f62)=>{var _0x5240a5=a0_0x32557a;try{const {warehouse_data:_0xd3213,product_data:_0x5e8467}=_0x5a8842[_0x5240a5(0x1e9)];console[_0x5240a5(0x2a1)](_0x5a8842[_0x5240a5(0x1e9)][_0x5240a5(0x201)]);;const _0xc7c99a=await master_shop[_0x5240a5(0x221)]();console['log']('master',_0xc7c99a);const _0x32e7ad=await product[_0x5240a5(0x1ea)]({'name':_0x5e8467});console[_0x5240a5(0x2a1)](_0x5240a5(0x1fe),_0x32e7ad);const _0x13a267=await warehouse['aggregate']([{'$match':{'name':_0xd3213}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5e8467}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x5240a5(0x286)}}}]);console[_0x5240a5(0x2a1)](_0x5240a5(0x251),_0x13a267),_0x4b6f62[_0x5240a5(0x2c0)](0xc8)[_0x5240a5(0x1f4)]({'master':_0xc7c99a,'new_product':_0x32e7ad,'stock_data':_0x13a267});}catch(_0xf5f500){console[_0x5240a5(0x2a1)](_0xf5f500);}}),router[a0_0x32557a(0x268)](a0_0x32557a(0x2b7),auth,async(_0x14ccec,_0x3231d2)=>{var _0x36900b=a0_0x32557a;try{const {invoice:_0x3e96e1,date:_0x4e0fca,warehouse_name:_0x1947c7,product_name:_0x30a7ed,stock:_0x234943,quantity:_0x22215b,note:_0x3f0d68,room:_0x2d8c77,primary_code:_0x213b41,secondary_code:_0x3a25a0,prod_code:_0x248ae4,level:_0x52c576,isle:_0x5aeccf,pallet:_0x500510,batch_code:_0x1f86f4,SCRN:_0xf3b694,expiry_date:_0x171829}=_0x14ccec[_0x36900b(0x1e9)];if(typeof _0x30a7ed=='string')var _0x2ab663=[_0x14ccec['body'][_0x36900b(0x240)]],_0x378391=[_0x14ccec['body'][_0x36900b(0x2c1)]],_0x18df69=[_0x14ccec['body'][_0x36900b(0x1e4)]],_0x99bf80=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2ce)]],_0x5d04b6=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x1ee)]],_0x5dd49c=[_0x14ccec[_0x36900b(0x1e9)]['prod_code']],_0x20af7f=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2a3)]],_0xbaebb2=[_0x14ccec[_0x36900b(0x1e9)]['primary_unit']],_0x3cb85e=[_0x14ccec['body']['secondary_unit']],_0x306cc9=[_0x14ccec['body']['batch_code']],_0x4606dc=[_0x14ccec['body'][_0x36900b(0x1fc)]],_0x401832=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x28b)]],_0x5b1b44=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2d1)]],_0x188c1f=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x264)]],_0xb58d16=[_0x14ccec['body'][_0x36900b(0x1e2)]],_0x46dee7=[_0x14ccec['body']['delivery_code']],_0x13c2b5=[_0x14ccec[_0x36900b(0x1e9)]['prod_cat']],_0x157c67=[_0x14ccec['body'][_0x36900b(0x207)]],_0x5ba27c=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x260)]],_0xf4f5dd=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x22e)]],_0x502b2d=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2be)]],_0x22a470=[_0x14ccec[_0x36900b(0x1e9)]['actual_uom']],_0x1393fa=[_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2ac)]];else var _0x2ab663=[..._0x14ccec[_0x36900b(0x1e9)]['product_name']],_0x378391=[..._0x14ccec['body']['stock']],_0x18df69=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x1e4)]],_0x99bf80=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2ce)]],_0x5d04b6=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x1ee)]],_0x5dd49c=[..._0x14ccec['body'][_0x36900b(0x259)]],_0x20af7f=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2a3)]],_0xbaebb2=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x290)]],_0x3cb85e=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x255)]],_0x306cc9=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x24a)]],_0x4606dc=[..._0x14ccec['body'][_0x36900b(0x1fc)]],_0x401832=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x28b)]],_0x5b1b44=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x2d1)]],_0x188c1f=[..._0x14ccec[_0x36900b(0x1e9)]['requested_qty']],_0xb58d16=[..._0x14ccec['body'][_0x36900b(0x1e2)]],_0x46dee7=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x285)]],_0x13c2b5=[..._0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x227)]],_0x157c67=[..._0x14ccec[_0x36900b(0x1e9)]['quantity']],_0x5ba27c=[..._0x14ccec[_0x36900b(0x1e9)]['RoomAssigned']],_0xf4f5dd=[..._0x14ccec[_0x36900b(0x1e9)]['prod_invoice']],_0x502b2d=[..._0x14ccec['body'][_0x36900b(0x2be)]],_0x22a470=[..._0x14ccec[_0x36900b(0x1e9)]['actual_uom']],_0x1393fa=[..._0x14ccec[_0x36900b(0x1e9)]['id_transact']];const _0x43663f=_0x2ab663[_0x36900b(0x25b)](_0x4cecb2=>{return _0x4cecb2={'product_name':_0x4cecb2};});_0x378391[_0x36900b(0x2cd)]((_0x992aa3,_0x586ace)=>{var _0x1c48cb=_0x36900b;_0x43663f[_0x586ace][_0x1c48cb(0x2c1)]=Math[_0x1c48cb(0x292)](_0x992aa3);}),_0x502b2d[_0x36900b(0x2cd)]((_0x295174,_0x4a2027)=>{var _0x52fb25=_0x36900b;_0x43663f[_0x4a2027][_0x52fb25(0x2be)]=Math[_0x52fb25(0x292)](_0x295174);}),_0x22a470[_0x36900b(0x2cd)]((_0x1d1627,_0x589e6a)=>{var _0x103752=_0x36900b;_0x43663f[_0x589e6a][_0x103752(0x23a)]=_0x1d1627;}),_0x1393fa[_0x36900b(0x2cd)]((_0x52b219,_0x5abcaa)=>{_0x43663f[_0x5abcaa]['id_transaction_from']=_0x52b219;}),_0x18df69[_0x36900b(0x2cd)]((_0x2b3a4b,_0x50aacd)=>{var _0x572f=_0x36900b;_0x43663f[_0x50aacd][_0x572f(0x207)]=_0x2b3a4b;}),_0x99bf80[_0x36900b(0x2cd)]((_0x3a6d01,_0x5722d3)=>{var _0x42c5d7=_0x36900b;_0x43663f[_0x5722d3][_0x42c5d7(0x2ce)]=_0x3a6d01;}),_0x5d04b6[_0x36900b(0x2cd)]((_0x4d053c,_0x248816)=>{var _0x4ca3d1=_0x36900b;_0x43663f[_0x248816][_0x4ca3d1(0x1ee)]=_0x4d053c;}),_0x5dd49c[_0x36900b(0x2cd)]((_0x40377c,_0x1922e4)=>{var _0x422b3a=_0x36900b;_0x43663f[_0x1922e4][_0x422b3a(0x29d)]=_0x40377c;}),_0x20af7f[_0x36900b(0x2cd)]((_0x5cf1b8,_0x566c23)=>{var _0x431694=_0x36900b;_0x5ba27c[_0x431694(0x2cd)]((_0x357bfb,_0x43a655)=>{var _0x98bb6b=_0x431694;if(_0x357bfb==_0x98bb6b(0x275)&&_0x566c23==_0x43a655){var _0x35d7f5=_0x5cf1b8[_0x98bb6b(0x294)](0x3);_0x43663f[_0x566c23]['storage']=_0x5cf1b8[0x0],_0x43663f[_0x566c23][_0x98bb6b(0x29f)]=_0x5cf1b8[0x1],_0x43663f[_0x566c23]['bay']=0x0,_0x43663f[_0x566c23]['bin']=0x0,_0x43663f[_0x566c23][_0x98bb6b(0x277)]=_0x98bb6b(0x1eb),_0x43663f[_0x566c23][_0x98bb6b(0x1d7)]=_0x35d7f5;}else{if(_0x357bfb=='Shelves'&&_0x566c23==_0x43a655){var _0x35d7f5=_0x5cf1b8['slice'](0x3);_0x43663f[_0x566c23]['storage']=_0x5cf1b8[0x0],_0x43663f[_0x566c23][_0x98bb6b(0x29f)]=_0x5cf1b8[0x1],_0x43663f[_0x566c23][_0x98bb6b(0x1f6)]=0x0,_0x43663f[_0x566c23][_0x98bb6b(0x297)]=0x0,_0x43663f[_0x566c23][_0x98bb6b(0x277)]=_0x98bb6b(0x1eb),_0x43663f[_0x566c23][_0x98bb6b(0x1d7)]=_0x5cf1b8[0x5];}else{if(_0x566c23==_0x43a655){var _0x7931c5;if(_0x5cf1b8[0x4]=='L')_0x7931c5=_0x98bb6b(0x2d2);else _0x5cf1b8[0x4]=='F'&&(_0x7931c5='Floor');_0x43663f[_0x566c23][_0x98bb6b(0x1f1)]=_0x5cf1b8[0x0],_0x43663f[_0x566c23]['rack']=_0x5cf1b8[0x1],_0x43663f[_0x566c23][_0x98bb6b(0x1f6)]=_0x5cf1b8[0x2],_0x43663f[_0x566c23][_0x98bb6b(0x297)]=_0x5cf1b8[0x3],_0x43663f[_0x566c23][_0x98bb6b(0x277)]=_0x7931c5,_0x43663f[_0x566c23][_0x98bb6b(0x1d7)]=_0x5cf1b8[0x5];}}}});}),_0xbaebb2['forEach']((_0x46caf5,_0x5096c1)=>{_0x43663f[_0x5096c1]['unit']=_0x46caf5;}),_0x3cb85e[_0x36900b(0x2cd)]((_0x4cd80a,_0xe3d8b0)=>{_0x43663f[_0xe3d8b0]['secondary_unit']=_0x4cd80a;}),_0x306cc9[_0x36900b(0x2cd)]((_0x1b2b4e,_0x3e0ec3)=>{var _0x35ed31=_0x36900b;_0x43663f[_0x3e0ec3][_0x35ed31(0x24a)]=_0x1b2b4e;}),_0x4606dc[_0x36900b(0x2cd)]((_0x3c052d,_0x329b00)=>{_0x43663f[_0x329b00]['expiry_date']=_0x3c052d;}),_0x401832[_0x36900b(0x2cd)]((_0xdc99cb,_0x4fa04e)=>{var _0x2dece1=_0x36900b;_0x43663f[_0x4fa04e][_0x2dece1(0x1f2)]=_0xdc99cb;}),_0x5b1b44[_0x36900b(0x2cd)]((_0x58477a,_0x307ff4)=>{var _0x6cac3d=_0x36900b;_0x43663f[_0x307ff4][_0x6cac3d(0x2d1)]=_0x58477a;}),_0x188c1f[_0x36900b(0x2cd)]((_0x50d661,_0x22f4f4)=>{var _0x569ee9=_0x36900b;_0x43663f[_0x22f4f4][_0x569ee9(0x264)]=_0x50d661;}),_0xb58d16[_0x36900b(0x2cd)]((_0x91d7c8,_0x531cd1)=>{_0x43663f[_0x531cd1]['delivery_date']=_0x91d7c8;}),_0x46dee7['forEach']((_0x7d7fb,_0x599ab9)=>{var _0x532e7c=_0x36900b;_0x43663f[_0x599ab9][_0x532e7c(0x285)]=_0x7d7fb;}),_0x13c2b5[_0x36900b(0x2cd)]((_0x4cec6b,_0x2c6634)=>{_0x43663f[_0x2c6634]['prod_cat']=_0x4cec6b;}),_0x157c67[_0x36900b(0x2cd)]((_0x3e81fd,_0x644d70)=>{var _0x362063=_0x36900b;_0x43663f[_0x644d70][_0x362063(0x1fa)]=_0x3e81fd;}),_0x5ba27c['forEach']((_0x566934,_0x5d892e)=>{var _0x196cc6=_0x36900b;_0x43663f[_0x5d892e][_0x196cc6(0x219)]=_0x566934;}),_0xf4f5dd[_0x36900b(0x2cd)]((_0x219f9a,_0x4c769c)=>{var _0xf2dc12=_0x36900b;_0x43663f[_0x4c769c][_0xf2dc12(0x1ed)]=_0x219f9a;});var _0x599e3e=0x0;_0x43663f['forEach'](_0x52fb06=>{var _0x1ad28d=_0x36900b;(_0x52fb06[_0x1ad28d(0x2c1)]<_0x52fb06['quantity_notConverted']||_0x52fb06[_0x1ad28d(0x1fa)]==0x0)&&(console[_0x1ad28d(0x2a1)](_0x1ad28d(0x20c),_0x52fb06),_0x599e3e++);});const _0x24683b=_0x43663f[_0x36900b(0x23e)](_0x1c5a6d=>_0x1c5a6d[_0x36900b(0x207)]!=='0'&&_0x1c5a6d[_0x36900b(0x207)]!==''),_0x210ba5=new sales({'invoice':_0x3e96e1,'customer':_0x14ccec[_0x36900b(0x1e9)][_0x36900b(0x1cd)],'date':_0x4e0fca,'warehouse_name':_0x1947c7,'sale_product':_0x24683b,'note':_0x3f0d68,'room':_0x2d8c77,'primary_code':_0x213b41,'secondary_code':_0x3a25a0,'prod_code':_0x248ae4,'SCRN':_0xf3b694}),_0x25f554=await _0x210ba5[_0x36900b(0x26a)]();_0x14ccec[_0x36900b(0x2cf)](_0x36900b(0x2b1),_0x36900b(0x215)),_0x3231d2[_0x36900b(0x21c)](_0x36900b(0x209)+_0x25f554[_0x36900b(0x1d1)]);}catch(_0x44035a){console[_0x36900b(0x2a1)](_0x44035a);}}),router[a0_0x32557a(0x288)](a0_0x32557a(0x1d0),auth,async(_0x46798f,_0x531d99)=>{var _0x3f1368=a0_0x32557a;try{const {username:_0x4a9b17,email:_0x4d992f,role:_0x27fab2}=_0x46798f[_0x3f1368(0x239)],_0x53073f=_0x46798f['user'],_0xd3a592=await profile['findOne']({'email':_0x53073f['email']}),_0x4f8036=await master_shop[_0x3f1368(0x221)](),_0x2be623=_0x46798f[_0x3f1368(0x1f9)]['id'],_0x27914f=await sales[_0x3f1368(0x25e)](_0x2be623),_0x39c4bb=await warehouse[_0x3f1368(0x247)]([{'$match':{'name':_0x27914f[_0x3f1368(0x20f)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3f1368(0x1f0)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3f1368(0x21f)},'bin':{'$first':_0x3f1368(0x266)},'type':{'$first':_0x3f1368(0x2d9)},'floorlevel':{'$first':_0x3f1368(0x238)},'primary_code':{'$first':_0x3f1368(0x1d9)},'secondary_code':{'$first':_0x3f1368(0x1f5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3f1368(0x291)},'expiry_date':{'$first':_0x3f1368(0x1e0)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x3f1368(0x274)}}}]),_0x1ade7e=await customer[_0x3f1368(0x221)]({});let _0x4be2d0;if(_0x53073f[_0x3f1368(0x2d5)]=='staff'){const _0x47ff3f=await staff[_0x3f1368(0x1ea)]({'email':_0x53073f[_0x3f1368(0x225)]});_0x4be2d0=await warehouse[_0x3f1368(0x247)]([{'$match':{'status':_0x3f1368(0x20b),'name':_0x47ff3f['warehouse']}},{'$group':{'_id':_0x3f1368(0x2bb),'name':{'$first':_0x3f1368(0x2bb)}}}]);}else _0x4be2d0=await warehouse['aggregate']([{'$match':{'status':_0x3f1368(0x20b)}},{'$group':{'_id':'$name','name':{'$first':_0x3f1368(0x2bb)}}}]);const _0x47a6c5=await product[_0x3f1368(0x221)]({}),_0x3c92a0=await suppliers[_0x3f1368(0x221)]({});if(_0x4f8036[0x0][_0x3f1368(0x2dc)]==_0x3f1368(0x2a2)){var _0x2dd869=users['English'];console[_0x3f1368(0x2a1)](_0x2dd869);}else{if(_0x4f8036[0x0][_0x3f1368(0x2dc)]==_0x3f1368(0x214))var _0x2dd869=users[_0x3f1368(0x214)];else{if(_0x4f8036[0x0][_0x3f1368(0x2dc)]=='German')var _0x2dd869=users['German'];else{if(_0x4f8036[0x0]['language']==_0x3f1368(0x262))var _0x2dd869=users['Spanish'];else{if(_0x4f8036[0x0][_0x3f1368(0x2dc)]=='French')var _0x2dd869=users[_0x3f1368(0x22d)];else{if(_0x4f8036[0x0][_0x3f1368(0x2dc)]=='Portuguese\x20(BR)')var _0x2dd869=users[_0x3f1368(0x2d4)];else{if(_0x4f8036[0x0][_0x3f1368(0x2dc)]==_0x3f1368(0x1e6))var _0x2dd869=users['Chinese'];else{if(_0x4f8036[0x0][_0x3f1368(0x2dc)]==_0x3f1368(0x2ba))var _0x2dd869=users['Arabic'];}}}}}}}_0x531d99[_0x3f1368(0x299)]('edit_sales_view',{'success':_0x46798f[_0x3f1368(0x2cf)](_0x3f1368(0x2b1)),'errors':_0x46798f[_0x3f1368(0x2cf)](_0x3f1368(0x258)),'role':_0x53073f,'profile':_0xd3a592,'customer':_0x1ade7e,'warehouse':_0x4be2d0,'product':_0x39c4bb,'user':_0x27914f,'master_shop':_0x4f8036,'unit':_0x47a6c5,'language':_0x2dd869,'suppliers':_0x3c92a0});}catch(_0x40de76){console[_0x3f1368(0x2a1)](_0x40de76);}}),router[a0_0x32557a(0x268)](a0_0x32557a(0x1d0),auth,async(_0x51b210,_0x1eb8f9)=>{var _0x18de2f=a0_0x32557a;try{const _0xae0bbf=_0x51b210[_0x18de2f(0x1f9)]['id'],{invoice:_0x50532f,warehouse_name:_0x13ca23,room:_0x5ca707}=_0x51b210[_0x18de2f(0x1e9)],_0x19f920=await sales[_0x18de2f(0x1ea)]({'invoice':_0x50532f}),_0x67cd5d=_0x19f920[_0x18de2f(0x2ad)][_0x18de2f(0x25b)](async _0x96f40e=>{var _0x3b54c1=_0x18de2f,_0x5a0dff=await warehouse[_0x3b54c1(0x1ea)]({'name':_0x13ca23,'room':_0x96f40e['room_name'],'warehouse_category':_0x3b54c1(0x22a)});const _0x552645=_0x5a0dff[_0x3b54c1(0x1f3)][_0x3b54c1(0x25b)](_0x444996=>{var _0x14671f=_0x3b54c1;_0x444996[_0x14671f(0x240)]==_0x96f40e[_0x14671f(0x240)]&&_0x444996[_0x14671f(0x1d7)]==_0x96f40e['floorlevel']&&_0x444996[_0x14671f(0x277)]==_0x96f40e[_0x14671f(0x277)]&&_0x444996[_0x14671f(0x297)]==_0x96f40e[_0x14671f(0x297)]&&_0x444996[_0x14671f(0x1f6)]==_0x96f40e[_0x14671f(0x1f6)]&&_0x444996['rack']==_0x96f40e['rack']&&_0x444996[_0x14671f(0x1f1)]==_0x96f40e[_0x14671f(0x1f1)]&&_0x444996[_0x14671f(0x1fc)]==_0x96f40e[_0x14671f(0x1fc)]&&_0x444996[_0x14671f(0x24a)]==_0x96f40e[_0x14671f(0x24a)]&&_0x444996[_0x14671f(0x1ed)]==_0x96f40e['invoice']&&_0x444996['_id']==_0x96f40e['id_transaction_from']&&(_0x444996[_0x14671f(0x224)]=Math[_0x14671f(0x2cc)](0x0,Math[_0x14671f(0x292)](_0x444996[_0x14671f(0x224)])-Math[_0x14671f(0x292)](_0x96f40e[_0x14671f(0x207)])));});return _0x5a0dff;});Promise['all'](_0x67cd5d)['then'](async _0x9ce5be=>{var _0x59aeda=_0x18de2f;try{for(const _0x1e1804 of _0x9ce5be){await _0x1e1804[_0x59aeda(0x26a)]();}_0x19f920[_0x59aeda(0x22b)]=_0x59aeda(0x246);const _0x110862=await _0x19f920[_0x59aeda(0x26a)](),_0x22d928=await master_shop[_0x59aeda(0x221)](),_0xfaccd7=await email_settings[_0x59aeda(0x1ea)](),_0x954a2c=await supervisor_settings[_0x59aeda(0x221)]();var _0x270cd7=_0x19f920[_0x59aeda(0x2ad)],_0x882518='',_0x52b964;for(_0x52b964 in _0x270cd7){_0x882518+=_0x59aeda(0x202)+_0x59aeda(0x254)+_0x270cd7[_0x52b964][_0x59aeda(0x240)]+_0x59aeda(0x22f)+_0x59aeda(0x254)+_0x270cd7[_0x52b964][_0x59aeda(0x29d)]+_0x59aeda(0x22f)+_0x59aeda(0x254)+_0x270cd7[_0x52b964][_0x59aeda(0x207)]+_0x59aeda(0x22f)+_0x59aeda(0x254)+_0x270cd7[_0x52b964]['unit']+_0x59aeda(0x22f)+_0x59aeda(0x254)+_0x270cd7[_0x52b964][_0x59aeda(0x255)]+'</td>'+_0x59aeda(0x254)+_0x19f920['warehouse_name']+_0x59aeda(0x22f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x270cd7[_0x52b964]['room_name']+_0x59aeda(0x22f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x270cd7[_0x52b964]['storage']+_0x270cd7[_0x52b964][_0x59aeda(0x29f)]+_0x270cd7[_0x52b964][_0x59aeda(0x1f6)]+_0x270cd7[_0x52b964][_0x59aeda(0x297)]+_0x270cd7[_0x52b964][_0x59aeda(0x277)][0x0]+_0x270cd7[_0x52b964]['floorlevel']+'</td>','</tr>';}let _0x52cc20=nodemailer[_0x59aeda(0x273)]({'host':_0xfaccd7[_0x59aeda(0x213)],'port':Number(_0xfaccd7[_0x59aeda(0x2cb)]),'secure':![],'auth':{'user':_0xfaccd7['email'],'pass':_0xfaccd7[_0x59aeda(0x27a)]}}),_0x54dd99={'from':_0xfaccd7[_0x59aeda(0x225)],'to':_0x954a2c[0x0][_0x59aeda(0x293)],'subject':_0x59aeda(0x2ae),'attachments':[{'filename':'Logo.png','path':__dirname+_0x59aeda(0x2c9)+_0x59aeda(0x1d4)+_0x22d928[0x0]['image'],'cid':_0x59aeda(0x271)}],'html':_0x59aeda(0x205)+_0x59aeda(0x27c)+'</head><body>'+_0x59aeda(0x2a6)+_0x59aeda(0x2ab)+'<div>'+_0x59aeda(0x231)+'</div>'+_0x59aeda(0x2a6)+_0x59aeda(0x20e)+_0x22d928[0x0][_0x59aeda(0x1ef)]+'\x20</h2>'+'</div>'+'</div>'+_0x59aeda(0x2a7)+_0x59aeda(0x2a6)+_0x59aeda(0x211)+_0x59aeda(0x234)+_0x19f920[_0x59aeda(0x1ed)]+'\x20'+_0x59aeda(0x2bf)+_0x59aeda(0x2d3)+_0x19f920[_0x59aeda(0x2bc)]+'\x20'+'</span>'+_0x59aeda(0x26f)+_0x59aeda(0x1f8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x59aeda(0x29e)+'<tr>'+_0x59aeda(0x27f)+_0x59aeda(0x226)+_0x59aeda(0x212)+_0x59aeda(0x2b6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x59aeda(0x218)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x59aeda(0x26d)+_0x59aeda(0x23f)+_0x59aeda(0x28a)+_0x59aeda(0x204)+'\x20'+_0x882518+'\x20'+'</tbody>'+'</table>'+_0x59aeda(0x2a6)+_0x59aeda(0x281)+_0x59aeda(0x295)+_0x22d928[0x0][_0x59aeda(0x1ef)]+_0x59aeda(0x26f)+_0x59aeda(0x1f8)+_0x59aeda(0x1f8)+_0x59aeda(0x1e1)};_0x52cc20['sendMail'](_0x54dd99,function(_0x3a51e5,_0x16eb27){var _0x48bd9c=_0x59aeda;_0x3a51e5?(console['log'](_0x3a51e5),console[_0x48bd9c(0x2a1)](_0x48bd9c(0x27b))):console[_0x48bd9c(0x2a1)](_0x48bd9c(0x256));}),_0x51b210['flash'](_0x59aeda(0x2b1),_0x59aeda(0x2b5)),_0x1eb8f9[_0x59aeda(0x21c)](_0x59aeda(0x209)+_0xae0bbf);}catch(_0x1fd996){console[_0x59aeda(0x1ff)](_0x1fd996),_0x1eb8f9[_0x59aeda(0x2c0)](0x1f4)[_0x59aeda(0x1f4)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x18de2f(0x23d)](_0x7c5f4e=>{var _0x2ffd07=_0x18de2f;console[_0x2ffd07(0x1ff)](_0x7c5f4e),_0x1eb8f9['status'](0x1f4)['json']({'error':_0x2ffd07(0x2a8)});});}catch(_0x5bedd0){console[_0x18de2f(0x2a1)](_0x5bedd0);}}),router[a0_0x32557a(0x288)](a0_0x32557a(0x237),auth,async(_0x5d4f36,_0x1284c3)=>{var _0x19d7b8=a0_0x32557a;try{const {username:_0x37c531,email:_0x2f76f7,role:_0x1c5603}=_0x5d4f36[_0x19d7b8(0x239)],_0x1ca73a=_0x5d4f36[_0x19d7b8(0x239)],_0x352556=await profile[_0x19d7b8(0x1ea)]({'email':_0x1ca73a[_0x19d7b8(0x225)]}),_0xb8aafd=await master_shop[_0x19d7b8(0x221)](),_0x8df022=_0x5d4f36['params']['id'],_0x13a4f1=await sales[_0x19d7b8(0x25e)](_0x8df022);var _0x25f3e6=['Ambient',_0x19d7b8(0x269)];const _0x3a9bfc=await warehouse['aggregate']([{'$match':{'name':_0x13a4f1[_0x19d7b8(0x20f)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x19d7b8(0x242)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x19d7b8(0x1f0)},'product_stock':{'$first':_0x19d7b8(0x286)},'bay':{'$first':_0x19d7b8(0x21f)},'bin':{'$first':_0x19d7b8(0x266)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x19d7b8(0x238)},'primary_code':{'$first':_0x19d7b8(0x1d9)},'secondary_code':{'$first':_0x19d7b8(0x1f5)},'product_code':{'$first':_0x19d7b8(0x296)},'storage':{'$first':_0x19d7b8(0x229)},'rack':{'$first':_0x19d7b8(0x291)}}}]),_0x24f61c=await customer[_0x19d7b8(0x221)]({});let _0x37bb9a;if(_0x1ca73a[_0x19d7b8(0x2d5)]==_0x19d7b8(0x20d)){const _0x5cbba8=await staff[_0x19d7b8(0x1ea)]({'email':_0x1ca73a['email']});_0x37bb9a=await warehouse[_0x19d7b8(0x247)]([{'$match':{'status':'Enabled','name':_0x5cbba8['warehouse'],'warehouse_category':_0x19d7b8(0x22a)}},{'$group':{'_id':'$name','name':{'$first':_0x19d7b8(0x2bb)}}}]);}else _0x37bb9a=await warehouse[_0x19d7b8(0x247)]([{'$match':{'status':_0x19d7b8(0x20b),'warehouse_category':_0x19d7b8(0x22a)}},{'$group':{'_id':_0x19d7b8(0x2bb),'name':{'$first':_0x19d7b8(0x2bb)}}}]);const _0x2058a3=await product[_0x19d7b8(0x221)]({});if(_0xb8aafd[0x0][_0x19d7b8(0x2dc)]==_0x19d7b8(0x2a2)){var _0x51eb0b=users[_0x19d7b8(0x280)];console[_0x19d7b8(0x2a1)](_0x51eb0b);}else{if(_0xb8aafd[0x0][_0x19d7b8(0x2dc)]=='Hindi')var _0x51eb0b=users[_0x19d7b8(0x214)];else{if(_0xb8aafd[0x0]['language']==_0x19d7b8(0x267))var _0x51eb0b=users['German'];else{if(_0xb8aafd[0x0][_0x19d7b8(0x2dc)]=='Spanish')var _0x51eb0b=users[_0x19d7b8(0x262)];else{if(_0xb8aafd[0x0][_0x19d7b8(0x2dc)]==_0x19d7b8(0x22d))var _0x51eb0b=users['French'];else{if(_0xb8aafd[0x0][_0x19d7b8(0x2dc)]==_0x19d7b8(0x2a0))var _0x51eb0b=users[_0x19d7b8(0x2d4)];else{if(_0xb8aafd[0x0]['language']=='Chinese')var _0x51eb0b=users[_0x19d7b8(0x1e6)];else{if(_0xb8aafd[0x0][_0x19d7b8(0x2dc)]==_0x19d7b8(0x2ba))var _0x51eb0b=users[_0x19d7b8(0x27d)];}}}}}}}_0x1284c3[_0x19d7b8(0x299)](_0x19d7b8(0x29a),{'success':_0x5d4f36[_0x19d7b8(0x2cf)](_0x19d7b8(0x2b1)),'errors':_0x5d4f36[_0x19d7b8(0x2cf)]('errors'),'role':_0x1ca73a,'profile':_0x352556,'customer':_0x24f61c,'warehouse':_0x37bb9a,'product':_0x3a9bfc,'user':_0x13a4f1,'master_shop':_0xb8aafd,'unit':_0x2058a3,'language':_0x51eb0b});}catch(_0x4e03aa){console[_0x19d7b8(0x2a1)](_0x4e03aa);}}),router['post'](a0_0x32557a(0x237),auth,async(_0x5136b7,_0x34855b)=>{var _0x4567d0=a0_0x32557a;try{const _0x2ba5e3=_0x5136b7[_0x4567d0(0x1f9)]['id'],_0x2188b9=await sales[_0x4567d0(0x1ea)]({'_id':_0x5136b7[_0x4567d0(0x1f9)]['id']}),_0x1c4c20=await warehouse[_0x4567d0(0x1ea)]({'name':_0x2188b9[_0x4567d0(0x20f)],'room':_0x5136b7['body']['room']}),{invoice:_0x1af264,date:_0x3cf9e8,warehouse_name:_0x3f9d96,product_name:_0x33b3e4,stock:_0x25e3db,quantity:_0x41e770,note:_0x34f662,room:_0x3090ba,customer:_0x6e8c90,SCRN:_0x166c7f}=_0x5136b7['body'];if(typeof _0x33b3e4==_0x4567d0(0x2db))var _0xa17fbb=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x240)]],_0x505ddd=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x2c1)]],_0x4ccc1c=[_0x5136b7['body']['carton']],_0x5ebb8a=[_0x5136b7['body'][_0x4567d0(0x2ce)]],_0x40ebc2=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x1ee)]],_0x49b6b6=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x259)]],_0x270f8e=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x2a3)]],_0x3c4c10=[_0x5136b7['body'][_0x4567d0(0x290)]],_0xbe4fca=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x255)]],_0x49e3dd=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x24a)]],_0x181ee6=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x1fc)]],_0x139f74=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x28b)]],_0x5de303=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x2d1)]],_0x16e612=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x264)]],_0x30108e=[_0x5136b7['body'][_0x4567d0(0x1e2)]],_0x25eb01=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x285)]],_0xdb23ce=[_0x5136b7['body'][_0x4567d0(0x227)]],_0x3b2b15=[_0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x207)]],_0x5d1b88=[_0x5136b7[_0x4567d0(0x1e9)]['RoomAssigned']];else var _0xa17fbb=[..._0x5136b7['body'][_0x4567d0(0x240)]],_0x505ddd=[..._0x5136b7[_0x4567d0(0x1e9)]['stock']],_0x4ccc1c=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x1e4)]],_0x5ebb8a=[..._0x5136b7[_0x4567d0(0x1e9)]['primary_code']],_0x40ebc2=[..._0x5136b7[_0x4567d0(0x1e9)]['secondary_code']],_0x49b6b6=[..._0x5136b7['body'][_0x4567d0(0x259)]],_0x270f8e=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x2a3)]],_0x3c4c10=[..._0x5136b7[_0x4567d0(0x1e9)]['primary_unit']],_0xbe4fca=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x255)]],_0x49e3dd=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x24a)]],_0x181ee6=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x1fc)]],_0x139f74=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x28b)]],_0x5de303=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x2d1)]],_0x16e612=[..._0x5136b7[_0x4567d0(0x1e9)]['requested_qty']],_0x30108e=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x1e2)]],_0x25eb01=[..._0x5136b7['body'][_0x4567d0(0x285)]],_0xdb23ce=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x227)]],_0x3b2b15=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x207)]],_0x5d1b88=[..._0x5136b7[_0x4567d0(0x1e9)][_0x4567d0(0x260)]];const _0x45405d=_0xa17fbb['map'](_0x2049ac=>{return _0x2049ac={'product_name':_0x2049ac};});_0x505ddd[_0x4567d0(0x2cd)]((_0x13ed9c,_0x9e65cf)=>{var _0x5b2df4=_0x4567d0;_0x45405d[_0x9e65cf][_0x5b2df4(0x2c1)]=Math[_0x5b2df4(0x292)](_0x13ed9c);}),_0x4ccc1c[_0x4567d0(0x2cd)]((_0x3d947a,_0x750da0)=>{var _0x383d7d=_0x4567d0;_0x45405d[_0x750da0][_0x383d7d(0x207)]=_0x3d947a;}),_0x5ebb8a[_0x4567d0(0x2cd)]((_0x514bf8,_0x192e96)=>{var _0x38baa6=_0x4567d0;_0x45405d[_0x192e96][_0x38baa6(0x2ce)]=_0x514bf8;}),_0x40ebc2[_0x4567d0(0x2cd)]((_0x1071ce,_0x493aa2)=>{var _0x5468bd=_0x4567d0;_0x45405d[_0x493aa2][_0x5468bd(0x1ee)]=_0x1071ce;}),_0x49b6b6[_0x4567d0(0x2cd)]((_0x5459c1,_0x4efa21)=>{_0x45405d[_0x4efa21]['product_code']=_0x5459c1;}),_0x270f8e[_0x4567d0(0x2cd)]((_0x5b49a2,_0x123abe)=>{var _0x196630=_0x4567d0;_0x5d1b88[_0x196630(0x2cd)]((_0x22ff7d,_0x41f049)=>{var _0x51d39e=_0x196630;if(_0x22ff7d==_0x51d39e(0x275)&&_0x123abe==_0x41f049){var _0x57b3ba=_0x5b49a2[_0x51d39e(0x294)](0x3);_0x45405d[_0x123abe][_0x51d39e(0x1f1)]=_0x5b49a2[0x0],_0x45405d[_0x123abe]['rack']=_0x5b49a2[0x1],_0x45405d[_0x123abe][_0x51d39e(0x1f6)]=0x0,_0x45405d[_0x123abe]['bin']=0x0,_0x45405d[_0x123abe][_0x51d39e(0x277)]=_0x51d39e(0x1eb),_0x45405d[_0x123abe][_0x51d39e(0x1d7)]=_0x57b3ba;}else{if(_0x22ff7d==_0x51d39e(0x1d3)&&_0x123abe==_0x41f049){var _0x57b3ba=_0x5b49a2[_0x51d39e(0x294)](0x3);_0x45405d[_0x123abe]['storage']=_0x5b49a2[0x0],_0x45405d[_0x123abe][_0x51d39e(0x29f)]=_0x5b49a2[0x1],_0x45405d[_0x123abe][_0x51d39e(0x1f6)]=0x0,_0x45405d[_0x123abe][_0x51d39e(0x297)]=0x0,_0x45405d[_0x123abe][_0x51d39e(0x277)]=_0x51d39e(0x1eb),_0x45405d[_0x123abe][_0x51d39e(0x1d7)]=_0x5b49a2[0x5];}else{if(_0x123abe==_0x41f049){var _0x28267e;if(_0x5b49a2[0x4]=='L')_0x28267e=_0x51d39e(0x2d2);else _0x5b49a2[0x4]=='F'&&(_0x28267e=_0x51d39e(0x1eb));_0x45405d[_0x123abe][_0x51d39e(0x1f1)]=_0x5b49a2[0x0],_0x45405d[_0x123abe][_0x51d39e(0x29f)]=_0x5b49a2[0x1],_0x45405d[_0x123abe][_0x51d39e(0x1f6)]=_0x5b49a2[0x2],_0x45405d[_0x123abe][_0x51d39e(0x297)]=_0x5b49a2[0x3],_0x45405d[_0x123abe][_0x51d39e(0x277)]=_0x28267e,_0x45405d[_0x123abe]['floorlevel']=_0x5b49a2[0x5];}}}});}),_0x3c4c10['forEach']((_0x22a8df,_0x5b6029)=>{var _0x28f148=_0x4567d0;_0x45405d[_0x5b6029][_0x28f148(0x216)]=_0x22a8df;}),_0xbe4fca[_0x4567d0(0x2cd)]((_0x4ebf6b,_0x3f651c)=>{var _0x18cda1=_0x4567d0;_0x45405d[_0x3f651c][_0x18cda1(0x255)]=_0x4ebf6b;}),_0x49e3dd['forEach']((_0x494e10,_0x1b77a2)=>{var _0x226a58=_0x4567d0;_0x45405d[_0x1b77a2][_0x226a58(0x24a)]=_0x494e10;}),_0x181ee6[_0x4567d0(0x2cd)]((_0x202811,_0x5cbd40)=>{_0x45405d[_0x5cbd40]['expiry_date']=_0x202811;}),_0x139f74[_0x4567d0(0x2cd)]((_0x274aa0,_0xc02da9)=>{var _0x117573=_0x4567d0;_0x45405d[_0xc02da9][_0x117573(0x1f2)]=_0x274aa0;}),_0x5de303[_0x4567d0(0x2cd)]((_0x267c04,_0x45c756)=>{var _0x1a415c=_0x4567d0;_0x45405d[_0x45c756][_0x1a415c(0x2d1)]=_0x267c04;}),_0x16e612[_0x4567d0(0x2cd)]((_0x139472,_0x41023e)=>{var _0x24910b=_0x4567d0;_0x45405d[_0x41023e]['requested_qty']=Math[_0x24910b(0x292)](_0x139472);}),_0x30108e[_0x4567d0(0x2cd)]((_0x11dbe9,_0x32cdf4)=>{_0x45405d[_0x32cdf4]['delivery_date']=_0x11dbe9;}),_0x25eb01['forEach']((_0xe851c5,_0x119477)=>{var _0x1c5020=_0x4567d0;_0x45405d[_0x119477][_0x1c5020(0x285)]=_0xe851c5;}),_0xdb23ce[_0x4567d0(0x2cd)]((_0x17785c,_0x1894ba)=>{var _0x5e02ca=_0x4567d0;_0x45405d[_0x1894ba][_0x5e02ca(0x227)]=_0x17785c;}),_0x3b2b15[_0x4567d0(0x2cd)]((_0x4af61c,_0x31d1e3)=>{var _0x762683=_0x4567d0;_0x45405d[_0x31d1e3][_0x762683(0x1fa)]=_0x4af61c;}),_0x5d1b88[_0x4567d0(0x2cd)]((_0x24ff0b,_0x290010)=>{_0x45405d[_0x290010]['room_name']=_0x24ff0b;});var _0x331b03=0x0;_0x45405d['forEach'](_0x424eba=>{var _0x322f6a=_0x4567d0;console[_0x322f6a(0x2a1)](_0x322f6a(0x20c),_0x424eba),(parseInt(_0x424eba[_0x322f6a(0x2c1)])<parseInt(_0x424eba[_0x322f6a(0x207)])||parseInt(_0x424eba[_0x322f6a(0x207)])==0x0)&&_0x331b03++;});if(_0x331b03!=0x0)return _0x5136b7[_0x4567d0(0x2cf)](_0x4567d0(0x258),_0x4567d0(0x248)),_0x34855b[_0x4567d0(0x21c)](_0x4567d0(0x2c6));const _0x428465=_0x45405d['filter'](_0x23bb4f=>_0x23bb4f[_0x4567d0(0x207)]!=='0'&&_0x23bb4f[_0x4567d0(0x207)]!=='');_0x2188b9[_0x4567d0(0x1ed)]=_0x1af264,_0x2188b9[_0x4567d0(0x1cd)]=_0x6e8c90,_0x2188b9[_0x4567d0(0x2bc)]=_0x3cf9e8,_0x2188b9['warehouse_name']=_0x3f9d96,_0x2188b9[_0x4567d0(0x2ad)]=_0x428465,_0x2188b9[_0x4567d0(0x228)]=_0x34f662,_0x2188b9[_0x4567d0(0x2d0)]=_0x166c7f,_0x2188b9[_0x4567d0(0x22b)]=_0x4567d0(0x272),_0x2188b9[_0x4567d0(0x200)]=_0x4567d0(0x272);const _0x57bf01=await _0x2188b9['save']();_0x5136b7[_0x4567d0(0x2cf)](_0x4567d0(0x2b1),_0x4567d0(0x2b5)),_0x34855b['redirect'](_0x4567d0(0x1cf));}catch(_0x33acfc){console[_0x4567d0(0x2a1)](_0x33acfc);}}),router[a0_0x32557a(0x268)](a0_0x32557a(0x1d2),auth,async(_0xa690d2,_0x13a748)=>{var _0x358a2c=a0_0x32557a;try{const _0x3da629=_0xa690d2[_0x358a2c(0x1f9)]['id'],{invoice:_0x3cf9df,customer:_0x40255c,receivable_amount:_0x18d378,received_amount:_0x39aded}=_0xa690d2[_0x358a2c(0x1e9)],_0x1e8368=await sales['findById'](_0x3da629);console[_0x358a2c(0x2a1)](_0x1e8368);var _0x339179=_0x18d378-_0x39aded;console[_0x358a2c(0x2a1)](_0x39aded),_0x1e8368[_0x358a2c(0x2b8)]=parseFloat(_0x39aded)+parseFloat(_0x1e8368[_0x358a2c(0x2b8)]),_0x1e8368['due_amount']=_0x339179,console[_0x358a2c(0x2a1)](_0x1e8368);const _0x1c45d8=await _0x1e8368[_0x358a2c(0x26a)](),_0x211cc3=await c_payment_data['findOne']({'invoice':_0x3cf9df});_0x211cc3[_0x358a2c(0x279)]=_0x339179,await _0x211cc3[_0x358a2c(0x26a)]();let _0x48d6c9=new Date(),_0x2657f7=('0'+_0x48d6c9['getDate']())['slice'](-0x2),_0x1d27d2=('0'+(_0x48d6c9[_0x358a2c(0x26e)]()+0x1))[_0x358a2c(0x294)](-0x2),_0x3128bd=_0x48d6c9[_0x358a2c(0x230)](),_0x175145=_0x3128bd+'-'+_0x1d27d2+'-'+_0x2657f7;const _0x131c3b=new customer_payment({'invoice':_0x3cf9df,'date':_0x3128bd+'-'+_0x1d27d2+'-'+_0x2657f7,'customer':_0x40255c,'reason':_0x358a2c(0x210),'amount':_0x39aded}),_0x3fabcc=await _0x131c3b[_0x358a2c(0x26a)]();_0xa690d2[_0x358a2c(0x2cf)](_0x358a2c(0x2b1),_0x358a2c(0x24e)),_0x13a748[_0x358a2c(0x21c)](_0x358a2c(0x1cf));}catch(_0x55eb1f){console['log'](_0x55eb1f);}}),router[a0_0x32557a(0x288)](a0_0x32557a(0x235),auth,async(_0x4dde86,_0x3ea207)=>{var _0x2e17d7=a0_0x32557a;try{const {username:_0x1fd458,email:_0x576f64,role:_0x1bd321}=_0x4dde86[_0x2e17d7(0x239)],_0x3432b8=_0x4dde86[_0x2e17d7(0x239)],_0x3d2f50=await profile[_0x2e17d7(0x1ea)]({'email':_0x3432b8[_0x2e17d7(0x225)]}),_0xc43556=await master_shop[_0x2e17d7(0x221)]();console[_0x2e17d7(0x2a1)](_0x2e17d7(0x1da),_0xc43556);const _0x34c900=_0x4dde86[_0x2e17d7(0x1f9)]['id'],_0x53fbb3=await sales[_0x2e17d7(0x25e)](_0x34c900);console[_0x2e17d7(0x2a1)](_0x53fbb3);const _0x4ed73f=await customer['findOne']({'name':_0x53fbb3[_0x2e17d7(0x1cd)]});console['log'](_0x4ed73f);if(_0xc43556[0x0][_0x2e17d7(0x2dc)]==_0x2e17d7(0x2a2)){var _0x1fed77=users[_0x2e17d7(0x280)];console[_0x2e17d7(0x2a1)](_0x1fed77);}else{if(_0xc43556[0x0][_0x2e17d7(0x2dc)]==_0x2e17d7(0x214))var _0x1fed77=users[_0x2e17d7(0x214)];else{if(_0xc43556[0x0]['language']==_0x2e17d7(0x267))var _0x1fed77=users[_0x2e17d7(0x267)];else{if(_0xc43556[0x0][_0x2e17d7(0x2dc)]=='Spanish')var _0x1fed77=users[_0x2e17d7(0x262)];else{if(_0xc43556[0x0][_0x2e17d7(0x2dc)]==_0x2e17d7(0x22d))var _0x1fed77=users[_0x2e17d7(0x22d)];else{if(_0xc43556[0x0][_0x2e17d7(0x2dc)]==_0x2e17d7(0x2a0))var _0x1fed77=users['Portuguese'];else{if(_0xc43556[0x0]['language']=='Chinese')var _0x1fed77=users[_0x2e17d7(0x1e6)];else{if(_0xc43556[0x0][_0x2e17d7(0x2dc)]==_0x2e17d7(0x2ba))var _0x1fed77=users[_0x2e17d7(0x27d)];}}}}}}}_0x3ea207[_0x2e17d7(0x299)](_0x2e17d7(0x2b0),{'success':_0x4dde86[_0x2e17d7(0x2cf)](_0x2e17d7(0x2b1)),'errors':_0x4dde86[_0x2e17d7(0x2cf)](_0x2e17d7(0x258)),'role':_0x3432b8,'profile':_0x3d2f50,'master_shop':_0xc43556,'customers':_0x4ed73f,'sales':_0x53fbb3,'language':_0x1fed77});}catch(_0x48bd25){console[_0x2e17d7(0x2a1)](_0x48bd25);}}),router['get'](a0_0x32557a(0x2da),auth,async(_0x155e38,_0x3fad2f)=>{var _0x1033f0=a0_0x32557a;try{const {username:_0x2192d9,email:_0x4b9960,role:_0x152088}=_0x155e38['user'],_0x27c95d=_0x155e38[_0x1033f0(0x239)],_0x25c52e=await profile['findOne']({'email':_0x27c95d[_0x1033f0(0x225)]}),_0x2107f3=await master_shop[_0x1033f0(0x221)]();console[_0x1033f0(0x2a1)](_0x1033f0(0x1da),_0x2107f3);const _0x27a58a=_0x155e38['params']['id'];console[_0x1033f0(0x2a1)](_0x27a58a);const _0x521fc7=await sales[_0x1033f0(0x25e)](_0x27a58a);console[_0x1033f0(0x2a1)]('user_id',_0x521fc7);const _0x1369d8=await warehouse[_0x1033f0(0x247)]([{'$match':{'name':_0x1033f0(0x2aa),'room':_0x1033f0(0x253)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1033f0(0x2c2),'name':{'$first':_0x1033f0(0x1f0)},'product_stock':{'$first':_0x1033f0(0x286)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x1033f0(0x1e3)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x1033f0(0x1d9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x1033f0(0x2a1)](_0x1033f0(0x251),_0x1369d8);const _0x1a300b=await product[_0x1033f0(0x221)]({});warehouse_data=await warehouse[_0x1033f0(0x247)]([{'$match':{'status':'Enabled','name':_0x1033f0(0x2aa),'warehouse_category':_0x1033f0(0x22a)}},{'$group':{'_id':'$name','name':{'$first':_0x1033f0(0x2bb)}}},{'$sort':{'name':0x1}}]);var _0x58ff3d=['Return\x20Rooms'];if(_0x2107f3[0x0]['language']==_0x1033f0(0x2a2)){var _0x34ac43=users[_0x1033f0(0x280)];console[_0x1033f0(0x2a1)](_0x34ac43);}else{if(_0x2107f3[0x0][_0x1033f0(0x2dc)]==_0x1033f0(0x214))var _0x34ac43=users[_0x1033f0(0x214)];else{if(_0x2107f3[0x0][_0x1033f0(0x2dc)]=='German')var _0x34ac43=users['German'];else{if(_0x2107f3[0x0][_0x1033f0(0x2dc)]==_0x1033f0(0x262))var _0x34ac43=users[_0x1033f0(0x262)];else{if(_0x2107f3[0x0][_0x1033f0(0x2dc)]==_0x1033f0(0x22d))var _0x34ac43=users['French'];else{if(_0x2107f3[0x0][_0x1033f0(0x2dc)]=='Portuguese\x20(BR)')var _0x34ac43=users[_0x1033f0(0x2d4)];else{if(_0x2107f3[0x0][_0x1033f0(0x2dc)]=='Chinese')var _0x34ac43=users[_0x1033f0(0x1e6)];else{if(_0x2107f3[0x0]['language']==_0x1033f0(0x2ba))var _0x34ac43=users[_0x1033f0(0x27d)];}}}}}}}_0x3fad2f['render']('return_sale',{'success':_0x155e38[_0x1033f0(0x2cf)]('success'),'errors':_0x155e38[_0x1033f0(0x2cf)](_0x1033f0(0x258)),'role':_0x27c95d,'profile':_0x25c52e,'user':_0x521fc7,'stock':_0x1369d8,'master_shop':_0x2107f3,'unit':_0x1a300b,'language':_0x34ac43,'warehouses':warehouse_data,'rooms':_0x58ff3d});}catch(_0xe6722e){console[_0x1033f0(0x2a1)](_0xe6722e),_0x3fad2f[_0x1033f0(0x2c0)](0xc8)[_0x1033f0(0x1f4)]({'message':_0xe6722e['message']});}}),router[a0_0x32557a(0x268)](a0_0x32557a(0x2da),auth,async(_0x13d760,_0x4affb5)=>{var _0xff766b=a0_0x32557a;try{const {invoice:_0x5c65fa,date:_0x10aa12,warehouse_name:_0x418ba6,product_name:_0x49f232,primary_code:_0x2aaa44,secondary_code:_0x39079b,product_code:_0x33d7fe,sales_quantity:_0x16b15f,stocks:_0x35d4b5,return_qty:_0x5119b3,Room_name:_0x244288,to_warehouse_name:_0x1561c6,to_Roomname:_0x2c0843,to_Room_name:_0x20f638,note:_0x25ce0a,level:_0x902385,isle:_0x58dde2,pallet:_0x1a5dbd}=_0x13d760[_0xff766b(0x1e9)];if(typeof _0x49f232=='string')var _0xa86e2d=[_0x13d760[_0xff766b(0x1e9)]['product_name']],_0x29ac2c=[_0x13d760[_0xff766b(0x1e9)]['primary_code']],_0xbabcc6=[_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x1ee)]],_0x5b7508=[_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x29d)]],_0x1809bb=[_0x13d760[_0xff766b(0x1e9)]['sales_quantity']],_0x39e47d=[_0x13d760[_0xff766b(0x1e9)]['stocks']],_0x30f386=[_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x25c)]],_0x5437c9=[_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x1f6)]],_0x1b1281=[_0x13d760[_0xff766b(0x1e9)]['bin']],_0x1f84e9=[_0x13d760[_0xff766b(0x1e9)]['types']],_0x3a2fb5=[_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x1d7)]];else var _0xa86e2d=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x240)]],_0x29ac2c=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x2ce)]],_0xbabcc6=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x1ee)]],_0x5b7508=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x29d)]],_0x1809bb=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x220)]],_0x39e47d=[..._0x13d760[_0xff766b(0x1e9)]['stocks']],_0x30f386=[..._0x13d760['body']['return_qty']],_0x5437c9=[..._0x13d760[_0xff766b(0x1e9)]['bay']],_0x1b1281=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x297)]],_0x1f84e9=[..._0x13d760[_0xff766b(0x1e9)][_0xff766b(0x2b9)]],_0x3a2fb5=[..._0x13d760[_0xff766b(0x1e9)]['floorlevel']];const _0x5ee173=_0xa86e2d[_0xff766b(0x25b)](_0x1834f6=>{return _0x1834f6={'product_name':_0x1834f6};});_0x29ac2c[_0xff766b(0x2cd)]((_0x33fea8,_0x279342)=>{var _0x59b001=_0xff766b;_0x5ee173[_0x279342][_0x59b001(0x2ce)]=_0x33fea8;}),_0xbabcc6[_0xff766b(0x2cd)]((_0x1f0d15,_0x190bcc)=>{var _0x18f6df=_0xff766b;_0x5ee173[_0x190bcc][_0x18f6df(0x1ee)]=_0x1f0d15;}),_0x5b7508[_0xff766b(0x2cd)]((_0x119557,_0x362559)=>{var _0x33adbd=_0xff766b;_0x5ee173[_0x362559][_0x33adbd(0x29d)]=_0x119557;}),_0x1809bb[_0xff766b(0x2cd)]((_0x107151,_0x3d3680)=>{var _0xf776e1=_0xff766b;_0x5ee173[_0x3d3680][_0xf776e1(0x289)]=_0x107151;}),_0x39e47d[_0xff766b(0x2cd)]((_0x14ac5c,_0x3df46f)=>{_0x5ee173[_0x3df46f]['stock']=_0x14ac5c;}),_0x30f386['forEach']((_0x14b472,_0x34e30d)=>{var _0x5e92f0=_0xff766b;_0x5ee173[_0x34e30d][_0x5e92f0(0x25c)]=_0x14b472;}),_0x5437c9['forEach']((_0x15979a,_0x53567a)=>{var _0x85729d=_0xff766b;_0x5ee173[_0x53567a][_0x85729d(0x1f6)]=_0x15979a;}),_0x1b1281[_0xff766b(0x2cd)]((_0x34fc86,_0x253035)=>{var _0x10fdaa=_0xff766b;_0x5ee173[_0x253035][_0x10fdaa(0x297)]=_0x34fc86;}),_0x1f84e9[_0xff766b(0x2cd)]((_0x169211,_0x3225bf)=>{var _0x5b9648=_0xff766b;_0x5ee173[_0x3225bf][_0x5b9648(0x277)]=_0x169211;}),_0x3a2fb5[_0xff766b(0x2cd)]((_0x579fb6,_0x25ffa7)=>{var _0x3fdf8f=_0xff766b;_0x5ee173[_0x25ffa7][_0x3fdf8f(0x1d7)]=_0x579fb6;});var _0x50c602=0x0;_0x5ee173[_0xff766b(0x2cd)](_0xc258fe=>{var _0x3abb46=_0xff766b;console[_0x3abb46(0x2a1)](_0x3abb46(0x20c),_0xc258fe),(parseInt(_0xc258fe[_0x3abb46(0x289)])<parseInt(_0xc258fe[_0x3abb46(0x25c)])||parseInt(_0xc258fe['stock'])<parseInt(_0xc258fe[_0x3abb46(0x25c)])&&parseInt(_0xc258fe[_0x3abb46(0x289)])>parseInt(_0xc258fe[_0x3abb46(0x25c)])||parseInt(_0xc258fe[_0x3abb46(0x25c)])==0x0)&&_0x50c602++;});if(_0x50c602!=0x0)return _0x13d760[_0xff766b(0x2cf)](_0xff766b(0x258),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x4affb5[_0xff766b(0x21c)](_0xff766b(0x2c6));const _0x16bbaf=await sales[_0xff766b(0x1ea)]({'invoice':_0x5c65fa});console[_0xff766b(0x2a1)](_0x16bbaf),_0x16bbaf['return_data']=_0xff766b(0x246);const _0x14c6ff=await _0x16bbaf[_0xff766b(0x26a)](),_0x447fc2=new sales_return({'invoice':_0x5c65fa,'customer':_0x13d760['body'][_0xff766b(0x1cd)],'date':_0x10aa12,'warehouse_name':_0x418ba6,'room':_0x244288,'ToWarehouse':_0x1561c6,'ToRoom':_0x20f638,'return_sale':_0x5ee173,'note':_0x25ce0a}),_0x4d6f73=await _0x447fc2[_0xff766b(0x26a)]();console[_0xff766b(0x2a1)](_0x447fc2);const _0x27fedb=await sales_return[_0xff766b(0x1ea)]({'invoice':_0x5c65fa}),_0x132efb=await warehouse[_0xff766b(0x1ea)]({'name':_0x1561c6,'room':_0x20f638});_0x27fedb[_0xff766b(0x21e)][_0xff766b(0x2cd)](_0x312be4=>{var _0x4d67e0=_0xff766b,_0x22fc66=0x0;const _0x44ead4=_0x132efb[_0x4d67e0(0x1f3)][_0x4d67e0(0x25b)](_0x345690=>{var _0xc0e109=_0x4d67e0;_0x345690[_0xc0e109(0x240)]==_0x312be4['product_name']&&_0x345690[_0xc0e109(0x1d7)]==_0x312be4['floorlevel']&&_0x345690[_0xc0e109(0x277)]==_0x312be4[_0xc0e109(0x277)]&&_0x345690['bin']==_0x312be4[_0xc0e109(0x297)]&&_0x345690[_0xc0e109(0x1f6)]==_0x312be4[_0xc0e109(0x1f6)]&&(_0x345690[_0xc0e109(0x224)]=parseInt(_0x345690[_0xc0e109(0x224)])+parseInt(_0x312be4[_0xc0e109(0x25c)]),_0x22fc66++);});_0x22fc66=='0'&&(_0x132efb[_0x4d67e0(0x1f3)]=_0x132efb[_0x4d67e0(0x1f3)][_0x4d67e0(0x217)]({'product_name':_0x312be4[_0x4d67e0(0x240)],'product_stock':_0x312be4[_0x4d67e0(0x25c)],'primary_code':_0x312be4[_0x4d67e0(0x2ce)],'secondary_code':_0x312be4['secondary_code'],'product_code':_0x312be4[_0x4d67e0(0x29d)],'bay':_0x312be4[_0x4d67e0(0x1f6)],'bin':_0x312be4[_0x4d67e0(0x297)],'type':_0x312be4[_0x4d67e0(0x277)],'floorlevel':_0x312be4[_0x4d67e0(0x1d7)]})),console[_0x4d67e0(0x2a1)](_0x4d67e0(0x233),_0x132efb);}),await _0x132efb['save'](),console[_0xff766b(0x2a1)](_0x13d760[_0xff766b(0x1e9)]);const _0x135680=new c_payment_data({'invoice':_0x5c65fa,'customer':_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x1cd)],'reason':_0xff766b(0x1d6)});await _0x135680['save']();const _0x41e8fc=await master_shop[_0xff766b(0x221)]();console[_0xff766b(0x2a1)](_0xff766b(0x25a),_0x41e8fc[0x0][_0xff766b(0x208)]);const _0x31fce7=await email_settings[_0xff766b(0x1ea)](),_0x2fcf5b=await customer[_0xff766b(0x1ea)]({'name':_0x13d760[_0xff766b(0x1e9)][_0xff766b(0x1cd)]});console['log'](_0xff766b(0x22c),_0x2fcf5b);_0x41e8fc[0x0][_0xff766b(0x245)]==0x1?(right_currency=_0x41e8fc[0x0][_0xff766b(0x223)],left_currency=''):(right_currency='',left_currency=_0x41e8fc[0x0][_0xff766b(0x223)]);var _0x348cbf=_0xa86e2d,_0xf3ad87=_0x30f386,_0x4f9842='',_0x1cbb87;for(_0x1cbb87 in _0x348cbf){_0x4f9842+=_0xff766b(0x202)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x348cbf[_0x1cbb87]+_0xff766b(0x22f)+_0xff766b(0x254)+_0xf3ad87[_0x1cbb87]+'</td>'+_0xff766b(0x23f);}console[_0xff766b(0x2a1)]('product_list',_0x4f9842);let _0x59a478=nodemailer[_0xff766b(0x273)]({'service':_0xff766b(0x2c4),'auth':{'user':_0x31fce7[_0xff766b(0x225)],'pass':_0x31fce7[_0xff766b(0x27a)]}}),_0xc962e1={'from':_0x31fce7[_0xff766b(0x225)],'to':_0x2fcf5b[_0xff766b(0x225)],'subject':_0xff766b(0x21d),'attachments':[{'filename':_0xff766b(0x276),'path':__dirname+_0xff766b(0x2c9)+'/upload/'+_0x41e8fc[0x0]['image'],'cid':_0xff766b(0x271)}],'html':_0xff766b(0x205)+_0xff766b(0x27c)+_0xff766b(0x2ca)+_0xff766b(0x2a6)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xff766b(0x2a6)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xff766b(0x1f8)+_0xff766b(0x2a6)+_0xff766b(0x20e)+_0x41e8fc[0x0][_0xff766b(0x1ef)]+_0xff766b(0x244)+_0xff766b(0x1f8)+_0xff766b(0x1f8)+_0xff766b(0x2a7)+_0xff766b(0x2a6)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xff766b(0x234)+_0x5c65fa+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xff766b(0x2d3)+_0x10aa12+'\x20'+_0xff766b(0x21a)+_0xff766b(0x26f)+_0xff766b(0x1f8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xff766b(0x29e)+_0xff766b(0x202)+_0xff766b(0x27f)+_0xff766b(0x298)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0xff766b(0x24f)+_0xff766b(0x23f)+_0xff766b(0x28a)+_0xff766b(0x204)+'\x20'+_0x4f9842+'\x20'+_0xff766b(0x257)+_0xff766b(0x222)+'<div>'+_0xff766b(0x281)+'<h5>'+_0x41e8fc[0x0][_0xff766b(0x1ef)]+_0xff766b(0x26f)+_0xff766b(0x1f8)+_0xff766b(0x1f8)+_0xff766b(0x1e1)};_0x59a478[_0xff766b(0x284)](_0xc962e1,function(_0x337b3f,_0x32ce9b){var _0x3b36ac=_0xff766b;_0x337b3f?(console[_0x3b36ac(0x2a1)](_0x337b3f),console['log'](_0x3b36ac(0x27b))):console[_0x3b36ac(0x2a1)](_0x3b36ac(0x256));}),_0x13d760[_0xff766b(0x2cf)](_0xff766b(0x2b1),_0xff766b(0x1ce)),_0x4affb5[_0xff766b(0x21c)](_0xff766b(0x1cf));}catch(_0x1c0cb6){console[_0xff766b(0x2a1)](_0x1c0cb6),_0x4affb5[_0xff766b(0x2c0)](0xc8)[_0xff766b(0x1f4)]({'message1':_0x1c0cb6[_0xff766b(0x1de)]});}}),router[a0_0x32557a(0x288)](a0_0x32557a(0x1db),auth,async(_0x424382,_0x49d827)=>{var _0x15da21=a0_0x32557a;try{const {username:_0x2163ed,email:_0x49926b,role:_0x88df18}=_0x424382[_0x15da21(0x239)],_0x54a89e=_0x424382[_0x15da21(0x239)],_0x341a11=await profile[_0x15da21(0x1ea)]({'email':_0x54a89e[_0x15da21(0x225)]}),_0x442be0=await master_shop['find']();console[_0x15da21(0x2a1)](_0x15da21(0x282),_0x442be0);const _0x19fd80=_0x424382[_0x15da21(0x1f9)]['id'],_0x281409=await sales['findById'](_0x19fd80);console[_0x15da21(0x2a1)]('barcode\x20user_id',_0x281409);if(_0x442be0[0x0][_0x15da21(0x2dc)]==_0x15da21(0x2a2))var _0x368391=users[_0x15da21(0x280)];else{if(_0x442be0[0x0]['language']=='Hindi')var _0x368391=users['Hindi'];else{if(_0x442be0[0x0][_0x15da21(0x2dc)]=='German')var _0x368391=users[_0x15da21(0x267)];else{if(_0x442be0[0x0][_0x15da21(0x2dc)]==_0x15da21(0x262))var _0x368391=users[_0x15da21(0x262)];else{if(_0x442be0[0x0][_0x15da21(0x2dc)]==_0x15da21(0x22d))var _0x368391=users[_0x15da21(0x22d)];else{if(_0x442be0[0x0][_0x15da21(0x2dc)]=='Portuguese\x20(BR)')var _0x368391=users[_0x15da21(0x2d4)];else{if(_0x442be0[0x0]['language']=='Chinese')var _0x368391=users[_0x15da21(0x1e6)];else{if(_0x442be0[0x0]['language']==_0x15da21(0x2ba))var _0x368391=users['Arabic'];}}}}}}}_0x49d827['render']('all_sales_barcode',{'success':_0x424382[_0x15da21(0x2cf)]('success'),'errors':_0x424382[_0x15da21(0x2cf)]('errors'),'role':_0x54a89e,'profile':_0x341a11,'alldata':_0x281409,'master_shop':_0x442be0,'language':_0x368391});}catch(_0x1d7395){console[_0x15da21(0x2a1)](_0x1d7395);}}),router[a0_0x32557a(0x268)](a0_0x32557a(0x1dc),async(_0x56d43b,_0x4fcd1c)=>{var _0x4e258a=a0_0x32557a;const {product_code:_0x1a3eb3,warehouse_name:_0x363e9a,rooms_data:_0x356c7b,Roomslist:_0x2df819}=_0x56d43b[_0x4e258a(0x1e9)],_0x24063a=_0x2df819['split'](','),_0xf4f02d=[];async function _0x1483be(_0x51d490){var _0x315db6=_0x4e258a;const _0x277742=await warehouse[_0x315db6(0x247)]([{'$match':{'name':_0x363e9a,'room':_0x51d490}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1a3eb3}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x315db6(0x286)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x315db6(0x1f5)},'product_code':{'$first':_0x315db6(0x296)},'level':{'$first':_0x315db6(0x21f)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x315db6(0x238)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x315db6(0x203)},'storage':{'$first':_0x315db6(0x229)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x315db6(0x1e0)},'production_date':{'$first':_0x315db6(0x261)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x315db6(0x241)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x315db6(0x252)},'invoice':{'$first':_0x315db6(0x274)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x315db6(0x236)}}}]),_0x18266f=await warehouse[_0x315db6(0x247)]([{'$match':{'name':_0x363e9a,'room':_0x51d490}},{'$unwind':_0x315db6(0x242)},{'$match':{'product_details.secondary_code':_0x1a3eb3}},{'$group':{'_id':_0x315db6(0x2c2),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x315db6(0x286)},'primary_code':{'$first':_0x315db6(0x1d9)},'secondary_code':{'$first':_0x315db6(0x1f5)},'product_code':{'$first':_0x315db6(0x296)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x315db6(0x266)},'type':{'$first':_0x315db6(0x2d9)},'pallet':{'$first':_0x315db6(0x238)},'unit':{'$first':_0x315db6(0x2d8)},'secondary_unit':{'$first':_0x315db6(0x203)},'storage':{'$first':_0x315db6(0x229)},'rack':{'$first':_0x315db6(0x291)},'expiry_date':{'$first':_0x315db6(0x1e0)},'production_date':{'$first':_0x315db6(0x261)},'maxPerUnit':{'$first':_0x315db6(0x29b)},'batch_code':{'$first':_0x315db6(0x241)},'product_cat':{'$first':_0x315db6(0x2af)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x315db6(0x252)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x277742['length']>0x0)_0xf4f02d[_0x315db6(0x287)](_0x277742);else _0x18266f[_0x315db6(0x265)]>0x0&&_0xf4f02d['push'](_0x18266f);}const _0x56a800=_0x24063a[_0x4e258a(0x25b)](_0x44ac6d=>_0x1483be(_0x44ac6d));await Promise[_0x4e258a(0x283)](_0x56a800),_0x4fcd1c[_0x4e258a(0x1f4)](_0xf4f02d);}),module['exports']=router;