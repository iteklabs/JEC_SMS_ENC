const a0_0x430596=a0_0x19d4;(function(_0x39dc5e,_0xd3e541){const _0x34489c=a0_0x19d4,_0x45f8d0=_0x39dc5e();while(!![]){try{const _0x29029f=parseInt(_0x34489c(0x1b8))/0x1*(-parseInt(_0x34489c(0x1b6))/0x2)+parseInt(_0x34489c(0x18f))/0x3*(parseInt(_0x34489c(0x170))/0x4)+parseInt(_0x34489c(0x1a5))/0x5+parseInt(_0x34489c(0x1a1))/0x6*(parseInt(_0x34489c(0x1b5))/0x7)+parseInt(_0x34489c(0x19f))/0x8*(parseInt(_0x34489c(0x1b7))/0x9)+-parseInt(_0x34489c(0x16f))/0xa*(-parseInt(_0x34489c(0x19c))/0xb)+-parseInt(_0x34489c(0x177))/0xc;if(_0x29029f===_0xd3e541)break;else _0x45f8d0['push'](_0x45f8d0['shift']());}catch(_0x9a67a3){_0x45f8d0['push'](_0x45f8d0['shift']());}}}(a0_0x4836,0x3355a));const express=require(a0_0x430596(0x173)),app=express(),router=express[a0_0x430596(0x1ad)](),multer=require('multer'),{profile,master_shop,email_settings,warehouse,purchases,staff}=require(a0_0x430596(0x1a9)),auth=require('../middleware/auth');var timezones=require(a0_0x430596(0x180));const users=require(a0_0x430596(0x1a2));function a0_0x19d4(_0x4cdab9,_0x183b87){const _0x483614=a0_0x4836();return a0_0x19d4=function(_0x19d48c,_0x1f9a26){_0x19d48c=_0x19d48c-0x16a;let _0x4e74ee=_0x483614[_0x19d48c];return _0x4e74ee;},a0_0x19d4(_0x4cdab9,_0x183b87);}router['get'](a0_0x430596(0x1a6),auth,async(_0x2fc584,_0x2af66f)=>{const _0x1b5927=a0_0x430596;try{const {username:_0x8a4b59,email:_0x274169,role:_0x405a69}=_0x2fc584['user'],_0x45b569=_0x2fc584[_0x1b5927(0x175)],_0x529c46=await profile['findOne']({'email':_0x45b569[_0x1b5927(0x191)]}),_0x3f2f94=await master_shop['find']();let _0x1cf6f7;if(_0x45b569[_0x1b5927(0x16a)]=='staff'){const _0x1a5321=await staff['findOne']({'email':_0x45b569[_0x1b5927(0x191)]});_0x1cf6f7=await warehouse['aggregate']([{'$match':{'status':_0x1b5927(0x1b9),'name':_0x1a5321[_0x1b5927(0x195)]}},{'$group':{'_id':_0x1b5927(0x18c),'name':{'$first':_0x1b5927(0x18c)}}},{'$sort':{'name':-0x1}}]);}else _0x1cf6f7=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x1b5927(0x18c),'name':{'$first':_0x1b5927(0x18c)}}},{'$sort':{'name':-0x1}}]);const _0x47ae9c=new Date()[_0x1b5927(0x172)](_0x1b5927(0x1ae),{'timeZone':_0x3f2f94[0x0]['timezone']});if(_0x3f2f94[0x0][_0x1b5927(0x1bd)]==_0x1b5927(0x17a))var _0x276752=users[_0x1b5927(0x17f)];else{if(_0x3f2f94[0x0][_0x1b5927(0x1bd)]==_0x1b5927(0x1bb))var _0x276752=users[_0x1b5927(0x1bb)];else{if(_0x3f2f94[0x0]['language']=='German')var _0x276752=users[_0x1b5927(0x188)];else{if(_0x3f2f94[0x0]['language']==_0x1b5927(0x1b1))var _0x276752=users[_0x1b5927(0x1b1)];else{if(_0x3f2f94[0x0][_0x1b5927(0x1bd)]==_0x1b5927(0x179))var _0x276752=users[_0x1b5927(0x179)];else{if(_0x3f2f94[0x0]['language']==_0x1b5927(0x19a))var _0x276752=users[_0x1b5927(0x186)];else{if(_0x3f2f94[0x0][_0x1b5927(0x1bd)]==_0x1b5927(0x1ab))var _0x276752=users[_0x1b5927(0x1ab)];else{if(_0x3f2f94[0x0][_0x1b5927(0x1bd)]==_0x1b5927(0x1ac))var _0x276752=users[_0x1b5927(0x181)];}}}}}}}_0x2af66f[_0x1b5927(0x185)]('warehousemap_incoming',{'success':_0x2fc584['flash'](_0x1b5927(0x16d)),'errors':_0x2fc584['flash'](_0x1b5927(0x193)),'role':_0x45b569,'profile':_0x529c46,'master_shop':_0x3f2f94,'timezones':timezones,'language':_0x276752,'warehouse':_0x1cf6f7});}catch(_0x5e771a){console['log'](_0x5e771a),_0x2af66f[_0x1b5927(0x18a)](0xc8)['json']({'message':_0x5e771a[_0x1b5927(0x1a4)]});}}),router['post'](a0_0x430596(0x19d),async(_0x521aeb,_0x40cb5e)=>{const _0x1047a4=a0_0x430596,{warehouseNew:_0x17a5e4,rooms:_0x5a913a,Type:_0x3fde88}=_0x521aeb['body'],_0x10c573=await warehouse[_0x1047a4(0x19b)]([{'$unwind':'$product_details'},{'$match':{'name':_0x17a5e4,'room':_0x5a913a,'product_details.type':_0x3fde88}},{'$group':{'_id':{'bay':_0x1047a4(0x1a8),'bin':_0x1047a4(0x198),'type':'$product_details.type','floorlevel':_0x1047a4(0x1bc)},'products':{'$push':{'product_name':_0x1047a4(0x18d),'product_quantity':_0x1047a4(0x1aa),'product_code':'$product_details.product_code'}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':['$product_details.product_stock',0x0]},'then':_0x1047a4(0x1aa),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x1047a4(0x1a3),'bin':'$_id.bin','type':_0x1047a4(0x16e),'floorlevel':'$_id.floorlevel','products':{'$filter':{'input':_0x1047a4(0x199),'as':'product','cond':{'$gt':['$$product.product_quantity',0x0]}}},'totalQuantity':0x1}}]);_0x40cb5e[_0x1047a4(0x178)](_0x10c573);}),router['post'](a0_0x430596(0x183),async(_0x992818,_0x5cd00c)=>{const _0x4148b0=a0_0x430596,{warehouseNew:_0x4fc992,rooms:_0x37adb7,room_cat:_0x2bbeb2}=_0x992818[_0x4148b0(0x1c0)];let _0x3fc461;if(_0x2bbeb2==_0x4148b0(0x1ba))_0x3fc461=await warehouse[_0x4148b0(0x19b)]([{'$unwind':_0x4148b0(0x1b2)},{'$match':{'name':_0x4fc992}},{'$group':{'_id':{'bay':_0x4148b0(0x1a8),'product':_0x4148b0(0x18d),'expiry':_0x4148b0(0x17e)},'count':{'$sum':_0x4148b0(0x1aa)},'production_date':{'$first':_0x4148b0(0x16c)},'expiry_date':{'$first':_0x4148b0(0x17e)},'batch_code':{'$first':_0x4148b0(0x16b)},'product_code':{'$first':_0x4148b0(0x1a0)}}},{'$group':{'_id':'$_id.bay','products':{'$push':{'product':_0x4148b0(0x1b4),'quantity':_0x4148b0(0x182),'production_date':'$production_date','expiry_date':_0x4148b0(0x176),'batch_code':_0x4148b0(0x1bf),'product_code':_0x4148b0(0x174)}},'totalQuantity':{'$sum':'$count'}}},{'$match':{'totalQuantity':{'$gt':0x0}}},{'$project':{'_id':0x0,'bay':_0x4148b0(0x192),'products':0x1,'totalQuantity':0x1}}]),console[_0x4148b0(0x1be)](_0x2bbeb2);else{}_0x5cd00c[_0x4148b0(0x178)](_0x3fc461);}),router[a0_0x430596(0x18b)](a0_0x430596(0x19e),async(_0x37bad4,_0x2d0ddb)=>{const _0x23a52a=a0_0x430596;try{const {warehouse_name:_0x570ee1}=_0x37bad4[_0x23a52a(0x1c0)];var _0x228a2b='';_0x228a2b=[{'$match':{'name':_0x570ee1,'status':_0x23a52a(0x1b9)}},{'$group':{'_id':_0x23a52a(0x192),'room_name':{'$first':_0x23a52a(0x187)}}},{'$sort':{'room_name':0x1}}];const _0x37f261=await warehouse[_0x23a52a(0x19b)](_0x228a2b);_0x2d0ddb[_0x23a52a(0x18a)](0xc8)[_0x23a52a(0x178)](_0x37f261);}catch(_0x32bd6d){_0x2d0ddb[_0x23a52a(0x18a)](0x190)[_0x23a52a(0x178)]({'errorMessage':_0x32bd6d[_0x23a52a(0x1a4)]});}}),router[a0_0x430596(0x18b)](a0_0x430596(0x196),async(_0x4b42de,_0x25027f)=>{const _0x4b0181=a0_0x430596;try{const {warehouse_name:_0x335691,cat:_0x24b360,valNew:_0x5c15f7}=_0x4b42de[_0x4b0181(0x1c0)];var _0xcfbeed='',_0x4f7ece='';if(_0x24b360==_0x4b0181(0x197))_0xcfbeed=_0x4b0181(0x1a7),_0x5c15f7=='pack'?_0x4f7ece=[{'$match':{'status':'Enabled','warehouse_category':_0x24b360,'name':{'$ne':_0xcfbeed},'name':'DRY\x20STORAGE'}},{'$group':{'_id':_0x4b0181(0x18c),'room_name':{'$first':_0x4b0181(0x18c)}}},{'$sort':{'room_name':0x1}}]:_0x4f7ece=[{'$match':{'status':_0x4b0181(0x1b9),'warehouse_category':_0x24b360,'name':{'$ne':_0xcfbeed}}},{'$group':{'_id':'$name','room_name':{'$first':'$name'}}},{'$sort':{'room_name':0x1}}];else _0x24b360=='Finished\x20Goods'?(_0xcfbeed=_0x4b0181(0x17d),_0x4f7ece=[{'$match':{'status':_0x4b0181(0x1b9),'warehouse_category':_0x24b360,'name':{'$ne':_0xcfbeed}}},{'$group':{'_id':_0x4b0181(0x18c),'room_name':{'$first':_0x4b0181(0x18c)}}},{'$sort':{'room_name':0x1}}]):_0x4f7ece=[{'$match':{'status':_0x4b0181(0x1b9)}},{'$group':{'_id':'$name','room_name':{'$first':_0x4b0181(0x18c)}}},{'$sort':{'room_name':0x1}}];const _0x351196=await warehouse[_0x4b0181(0x19b)](_0x4f7ece);_0x25027f[_0x4b0181(0x18a)](0xc8)[_0x4b0181(0x178)](_0x351196);}catch(_0x4257d9){_0x25027f['status'](0x190)['json']({'errorMessage':_0x4257d9[_0x4b0181(0x1a4)]}),console[_0x4b0181(0x1be)](_0x4257d9);}}),router[a0_0x430596(0x18b)](a0_0x430596(0x171),async(_0x2b6978,_0x1a4c0a)=>{const _0x108168=a0_0x430596;try{const {warehouse_name:_0x47cfd8,cat:_0xedac93}=_0x2b6978[_0x108168(0x1c0)],_0x22eee0=await warehouse['aggregate']([{'$match':{'status':_0x108168(0x1b9),'warehouse_category':_0xedac93,'name':_0x47cfd8}},{'$group':{'_id':'$room','room_name':{'$first':_0x108168(0x187)}}},{'$sort':{'room_name':0x1}}]);_0x1a4c0a[_0x108168(0x18a)](0xc8)[_0x108168(0x178)](_0x22eee0);}catch(_0x3c10f6){_0x1a4c0a[_0x108168(0x18a)](0x190)[_0x108168(0x178)]({'errorMessage':_0x3c10f6[_0x108168(0x1a4)]});}}),router[a0_0x430596(0x18b)](a0_0x430596(0x189),async(_0xbe932a,_0x4f61b0)=>{const _0x2c3142=a0_0x430596;try{const {typeofsales:_0x20d52e}=_0xbe932a[_0x2c3142(0x1c0)],_0x1db5c4=await staff[_0x2c3142(0x17c)]({'account_category':'sa','type_of_acc_cat':_0x20d52e});_0x4f61b0[_0x2c3142(0x18a)](0xc8)[_0x2c3142(0x178)](_0x1db5c4);}catch(_0x4066fa){_0x4f61b0['status'](0x190)[_0x2c3142(0x178)]({'errorMessage':_0x4066fa['message']});}}),router[a0_0x430596(0x18b)](a0_0x430596(0x18e),async(_0x4a40aa,_0x38dfea)=>{const _0x43ec26=a0_0x430596;try{const {id:_0x329ed3}=_0x4a40aa[_0x43ec26(0x1c0)],_0x5b039b=await staff[_0x43ec26(0x17c)]({'_id':_0x329ed3});_0x38dfea[_0x43ec26(0x18a)](0xc8)[_0x43ec26(0x178)](_0x5b039b);}catch(_0x1d4afd){_0x38dfea[_0x43ec26(0x18a)](0x190)[_0x43ec26(0x178)]({'errorMessage':_0x1d4afd['message']});}}),router[a0_0x430596(0x18b)](a0_0x430596(0x184),async(_0x5196c1,_0x2f276e)=>{const _0x3bd577=a0_0x430596;try{const {warehouse_name:_0x129cd5,room_value:_0x131bac}=_0x5196c1[_0x3bd577(0x1c0)];let _0x33c908;_0x131bac=='all'?_0x33c908=await warehouse['aggregate']([{'$unwind':_0x3bd577(0x1b2)},{'$match':{'name':_0x129cd5}},{'$group':{'_id':{'bay':'$product_details.bay','level':_0x3bd577(0x17b),'type':'$product_details.type','floorlevel':_0x3bd577(0x1bc)},'products':{'$push':{'product_name':_0x3bd577(0x18d),'product_quantity':_0x3bd577(0x1aa),'product_code':'$product_details.product_code'}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x3bd577(0x1aa),0x0]},'then':_0x3bd577(0x1aa),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x3bd577(0x1a3),'level':_0x3bd577(0x1af),'type':_0x3bd577(0x16e),'floorlevel':_0x3bd577(0x194),'products':{'$filter':{'input':'$products','as':_0x3bd577(0x190),'cond':{'$gt':[_0x3bd577(0x1b3),0x0]}}},'totalQuantity':0x1}}]):_0x33c908=await warehouse[_0x3bd577(0x19b)]([{'$unwind':_0x3bd577(0x1b2)},{'$match':{'name':_0x129cd5,'room':_0x131bac}},{'$group':{'_id':{'bay':_0x3bd577(0x1a8),'level':_0x3bd577(0x17b),'type':_0x3bd577(0x1b0),'floorlevel':_0x3bd577(0x1bc)},'products':{'$push':{'product_name':'$product_details.product_name','product_quantity':_0x3bd577(0x1aa),'product_code':_0x3bd577(0x1a0)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x3bd577(0x1aa),0x0]},'then':_0x3bd577(0x1aa),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x3bd577(0x1a3),'level':'$_id.level','type':'$_id.type','floorlevel':_0x3bd577(0x194),'products':{'$filter':{'input':'$products','as':_0x3bd577(0x190),'cond':{'$gt':[_0x3bd577(0x1b3),0x0]}}},'totalQuantity':0x1}}]),_0x2f276e[_0x3bd577(0x18a)](0xc8)[_0x3bd577(0x178)](_0x33c908);}catch(_0x303660){_0x2f276e[_0x3bd577(0x18a)](0x190)[_0x3bd577(0x178)]({'errorMessage':_0x303660[_0x3bd577(0x1a4)]});}}),module['exports']=router;function a0_0x4836(){const _0x6149e5=['Hindi','$product_details.floorlevel','language','log','$batch_code','body','role','$product_details.batch_code','$product_details.production_date','success','$_id.type','705440CwYJAM','4252dEjkrU','/Rooms_data3','toLocaleString','express','$product_code','user','$expiry_date','11731932HewqJr','json','French','English\x20(US)','$product_details.level','find','QA\x20Warehouse','$product_details.expiry_date','English','timezones-list','Arabic','$count','/MapData2','/map_value','render','Portuguese','$room','German','/staff_sales','status','post','$name','$product_details.product_name','/staff_sales_id','1095XrmdCm','product','email','$_id','errors','$_id.floorlevel','warehouse','/Rooms_data2','Raw\x20Materials','$product_details.bin','$products','Portuguese\x20(BR)','aggregate','44FnweZO','/MapData','/Rooms_data','8ZLomTq','$product_details.product_code','4122upAYVw','../public/language/languages.json','$_id.bay','message','2036495CMMnUK','/view','Return\x20Goods','$product_details.bay','../models/all_models','$product_details.product_stock','Chinese','Arabic\x20(ae)','Router','en-US','$_id.level','$product_details.type','Spanish','$product_details','$$product.product_quantity','$_id.product','1281xjasUw','2DXtFVz','2219571RwQNMq','261883flpIaX','Enabled','All'];a0_0x4836=function(){return _0x6149e5;};return a0_0x4836();}