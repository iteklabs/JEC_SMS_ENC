const a0_0x5065aa=a0_0xbefd;(function(_0x33010a,_0x1e09fb){const _0x6c8fde=a0_0xbefd,_0x422343=_0x33010a();while(!![]){try{const _0x22beca=parseInt(_0x6c8fde(0x18b))/0x1+-parseInt(_0x6c8fde(0x1cb))/0x2+parseInt(_0x6c8fde(0x1c0))/0x3+-parseInt(_0x6c8fde(0x1be))/0x4+parseInt(_0x6c8fde(0x1c5))/0x5+-parseInt(_0x6c8fde(0x1b0))/0x6+parseInt(_0x6c8fde(0x1a2))/0x7;if(_0x22beca===_0x1e09fb)break;else _0x422343['push'](_0x422343['shift']());}catch(_0x167f3b){_0x422343['push'](_0x422343['shift']());}}}(a0_0x5e94,0x1bb6b));function a0_0x5e94(){const _0x5803ad=['/staff_sales','product','Spanish','/MapData','Hindi','English','express','$_id.bay','user','$_id','/map_value','timezone','$product_details.bay','$_id.product','$name','/Rooms_data3','$_id.level','body','aggregate','../models/all_models','$products','2180752ewGJhb','Portuguese','Enabled','findOne','role','language','Finished\x20Goods','toLocaleString','pack','Arabic','staff','$production_date','$count','../middleware/auth','572502peKcnd','German','$_id.floorlevel','flash','English\x20(US)','all','$product_details.floorlevel','find','post','$product_details.product_code','success','/Rooms_data2','message','/Rooms_data','839780fqYZHT','$product_details.type','429405KRxrXe','status','$_id.type','/MapData2','$product_details.product_stock','16930EnQJZh','json','DRY\x20STORAGE','errors','email','$$product.product_quantity','336582HzBoeS','get','Arabic\x20(ae)','$product_details.expiry_date','warehouse','Chinese','$product_details.production_date','en-US','$_id.bin','$product_details','$room','exports','/staff_sales_id','log','/view','$product_details.product_name','Return\x20Goods','French','129111rtUlqy','$product_details.level'];a0_0x5e94=function(){return _0x5803ad;};return a0_0x5e94();}function a0_0xbefd(_0x59d585,_0x246b87){const _0x5e94bb=a0_0x5e94();return a0_0xbefd=function(_0xbefd8f,_0x17bccc){_0xbefd8f=_0xbefd8f-0x182;let _0x26cad3=_0x5e94bb[_0xbefd8f];return _0x26cad3;},a0_0xbefd(_0x59d585,_0x246b87);}const express=require(a0_0x5065aa(0x193)),app=express(),router=express['Router'](),multer=require('multer'),{profile,master_shop,email_settings,warehouse,purchases,staff}=require(a0_0x5065aa(0x1a0)),auth=require(a0_0x5065aa(0x1af));var timezones=require('timezones-list');const users=require('../public/language/languages.json');router[a0_0x5065aa(0x1cc)](a0_0x5065aa(0x187),auth,async(_0xbaf902,_0x335f99)=>{const _0xcda779=a0_0x5065aa;try{const {username:_0x16a6f3,email:_0x4cd8bd,role:_0x5ee58c}=_0xbaf902[_0xcda779(0x195)],_0x321ec1=_0xbaf902[_0xcda779(0x195)],_0x513a43=await profile[_0xcda779(0x1a5)]({'email':_0x321ec1[_0xcda779(0x1c9)]}),_0x21bfe8=await master_shop[_0xcda779(0x1b7)]();let _0x4868a7;if(_0x321ec1[_0xcda779(0x1a6)]==_0xcda779(0x1ac)){const _0x34ee80=await staff[_0xcda779(0x1a5)]({'email':_0x321ec1['email']});_0x4868a7=await warehouse['aggregate']([{'$match':{'status':_0xcda779(0x1a4),'name':_0x34ee80[_0xcda779(0x1cf)]}},{'$group':{'_id':_0xcda779(0x19b),'name':{'$first':_0xcda779(0x19b)}}},{'$sort':{'name':-0x1}}]);}else _0x4868a7=await warehouse[_0xcda779(0x19f)]([{'$match':{'status':_0xcda779(0x1a4)}},{'$group':{'_id':_0xcda779(0x19b),'name':{'$first':_0xcda779(0x19b)}}},{'$sort':{'name':-0x1}}]);const _0x432713=new Date()[_0xcda779(0x1a9)](_0xcda779(0x1d2),{'timeZone':_0x21bfe8[0x0][_0xcda779(0x198)]});if(_0x21bfe8[0x0][_0xcda779(0x1a7)]==_0xcda779(0x1b4))var _0x2dd119=users[_0xcda779(0x192)];else{if(_0x21bfe8[0x0][_0xcda779(0x1a7)]==_0xcda779(0x191))var _0x2dd119=users[_0xcda779(0x191)];else{if(_0x21bfe8[0x0]['language']==_0xcda779(0x1b1))var _0x2dd119=users[_0xcda779(0x1b1)];else{if(_0x21bfe8[0x0][_0xcda779(0x1a7)]=='Spanish')var _0x2dd119=users[_0xcda779(0x18f)];else{if(_0x21bfe8[0x0]['language']==_0xcda779(0x18a))var _0x2dd119=users[_0xcda779(0x18a)];else{if(_0x21bfe8[0x0][_0xcda779(0x1a7)]=='Portuguese\x20(BR)')var _0x2dd119=users[_0xcda779(0x1a3)];else{if(_0x21bfe8[0x0]['language']==_0xcda779(0x1d0))var _0x2dd119=users[_0xcda779(0x1d0)];else{if(_0x21bfe8[0x0][_0xcda779(0x1a7)]==_0xcda779(0x1cd))var _0x2dd119=users[_0xcda779(0x1ab)];}}}}}}}_0x335f99['render']('warehousemap_incoming',{'success':_0xbaf902[_0xcda779(0x1b3)](_0xcda779(0x1ba)),'errors':_0xbaf902[_0xcda779(0x1b3)](_0xcda779(0x1c8)),'role':_0x321ec1,'profile':_0x513a43,'master_shop':_0x21bfe8,'timezones':timezones,'language':_0x2dd119,'warehouse':_0x4868a7});}catch(_0x459b70){console[_0xcda779(0x186)](_0x459b70),_0x335f99[_0xcda779(0x1c1)](0xc8)[_0xcda779(0x1c6)]({'message':_0x459b70[_0xcda779(0x1bc)]});}}),router['post'](a0_0x5065aa(0x190),async(_0x2ecca6,_0x573312)=>{const _0x1e91df=a0_0x5065aa,{warehouseNew:_0x23abe5,rooms:_0x583c6e,Type:_0x482a6d}=_0x2ecca6['body'],_0x3a2575=await warehouse[_0x1e91df(0x19f)]([{'$unwind':'$product_details'},{'$match':{'name':_0x23abe5,'room':_0x583c6e,'product_details.type':_0x482a6d}},{'$group':{'_id':{'bay':_0x1e91df(0x199),'bin':'$product_details.bin','type':_0x1e91df(0x1bf),'floorlevel':_0x1e91df(0x1b6)},'products':{'$push':{'product_name':_0x1e91df(0x188),'product_quantity':_0x1e91df(0x1c4),'product_code':_0x1e91df(0x1b9)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x1e91df(0x1c4),0x0]},'then':_0x1e91df(0x1c4),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x1e91df(0x194),'bin':_0x1e91df(0x1d3),'type':_0x1e91df(0x1c2),'floorlevel':'$_id.floorlevel','products':{'$filter':{'input':_0x1e91df(0x1a1),'as':_0x1e91df(0x18e),'cond':{'$gt':['$$product.product_quantity',0x0]}}},'totalQuantity':0x1}}]);_0x573312[_0x1e91df(0x1c6)](_0x3a2575);}),router[a0_0x5065aa(0x1b8)](a0_0x5065aa(0x1c3),async(_0x198894,_0x3f0be1)=>{const _0x65f47b=a0_0x5065aa,{warehouseNew:_0x11a7a6,rooms:_0x3483fc,room_cat:_0x429422}=_0x198894[_0x65f47b(0x19e)];let _0x4e59cf;if(_0x429422=='All')_0x4e59cf=await warehouse['aggregate']([{'$unwind':_0x65f47b(0x182)},{'$match':{'name':_0x11a7a6}},{'$group':{'_id':{'bay':_0x65f47b(0x199),'product':_0x65f47b(0x188),'expiry':_0x65f47b(0x1ce)},'count':{'$sum':_0x65f47b(0x1c4)},'production_date':{'$first':_0x65f47b(0x1d1)},'expiry_date':{'$first':'$product_details.expiry_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_code':{'$first':_0x65f47b(0x1b9)}}},{'$group':{'_id':_0x65f47b(0x194),'products':{'$push':{'product':_0x65f47b(0x19a),'quantity':_0x65f47b(0x1ae),'production_date':_0x65f47b(0x1ad),'expiry_date':'$expiry_date','batch_code':'$batch_code','product_code':'$product_code'}},'totalQuantity':{'$sum':_0x65f47b(0x1ae)}}},{'$match':{'totalQuantity':{'$gt':0x0}}},{'$project':{'_id':0x0,'bay':'$_id','products':0x1,'totalQuantity':0x1}}]),console[_0x65f47b(0x186)](_0x429422);else{}_0x3f0be1[_0x65f47b(0x1c6)](_0x4e59cf);}),router[a0_0x5065aa(0x1b8)](a0_0x5065aa(0x1bd),async(_0x4170c6,_0x1fd549)=>{const _0x33c287=a0_0x5065aa;try{const {warehouse_name:_0x366a96}=_0x4170c6[_0x33c287(0x19e)];var _0x5ea3e8='';_0x5ea3e8=[{'$match':{'name':_0x366a96,'status':_0x33c287(0x1a4)}},{'$group':{'_id':_0x33c287(0x196),'room_name':{'$first':_0x33c287(0x183)}}},{'$sort':{'room_name':0x1}}];const _0x45474d=await warehouse[_0x33c287(0x19f)](_0x5ea3e8);_0x1fd549['status'](0xc8)['json'](_0x45474d);}catch(_0x457dee){_0x1fd549['status'](0x190)[_0x33c287(0x1c6)]({'errorMessage':_0x457dee[_0x33c287(0x1bc)]});}}),router[a0_0x5065aa(0x1b8)](a0_0x5065aa(0x1bb),async(_0x289bf8,_0x1b1ac9)=>{const _0xd2a156=a0_0x5065aa;try{const {warehouse_name:_0x1df6fd,cat:_0x84bac9,valNew:_0x5cc686}=_0x289bf8[_0xd2a156(0x19e)];var _0x4d6720='',_0x2d6f5a='';if(_0x84bac9=='Raw\x20Materials')_0x4d6720=_0xd2a156(0x189),_0x5cc686==_0xd2a156(0x1aa)?_0x2d6f5a=[{'$match':{'status':'Enabled','warehouse_category':_0x84bac9,'name':{'$ne':_0x4d6720},'name':_0xd2a156(0x1c7)}},{'$group':{'_id':_0xd2a156(0x19b),'room_name':{'$first':'$name'}}},{'$sort':{'room_name':0x1}}]:_0x2d6f5a=[{'$match':{'status':_0xd2a156(0x1a4),'warehouse_category':_0x84bac9,'name':{'$ne':_0x4d6720}}},{'$group':{'_id':_0xd2a156(0x19b),'room_name':{'$first':_0xd2a156(0x19b)}}},{'$sort':{'room_name':0x1}}];else _0x84bac9==_0xd2a156(0x1a8)?(_0x4d6720='QA\x20Warehouse',_0x2d6f5a=[{'$match':{'status':_0xd2a156(0x1a4),'warehouse_category':_0x84bac9,'name':{'$ne':_0x4d6720}}},{'$group':{'_id':_0xd2a156(0x19b),'room_name':{'$first':_0xd2a156(0x19b)}}},{'$sort':{'room_name':0x1}}]):_0x2d6f5a=[{'$match':{'status':_0xd2a156(0x1a4)}},{'$group':{'_id':_0xd2a156(0x19b),'room_name':{'$first':_0xd2a156(0x19b)}}},{'$sort':{'room_name':0x1}}];const _0x4616a9=await warehouse[_0xd2a156(0x19f)](_0x2d6f5a);_0x1b1ac9[_0xd2a156(0x1c1)](0xc8)[_0xd2a156(0x1c6)](_0x4616a9);}catch(_0x29b251){_0x1b1ac9[_0xd2a156(0x1c1)](0x190)['json']({'errorMessage':_0x29b251[_0xd2a156(0x1bc)]}),console[_0xd2a156(0x186)](_0x29b251);}}),router[a0_0x5065aa(0x1b8)](a0_0x5065aa(0x19c),async(_0x3cc0a9,_0x41149d)=>{const _0x35f4b2=a0_0x5065aa;try{const {warehouse_name:_0x484453,cat:_0x52e370}=_0x3cc0a9[_0x35f4b2(0x19e)],_0x3044a6=await warehouse['aggregate']([{'$match':{'status':_0x35f4b2(0x1a4),'warehouse_category':_0x52e370,'name':_0x484453}},{'$group':{'_id':_0x35f4b2(0x183),'room_name':{'$first':_0x35f4b2(0x183)}}},{'$sort':{'room_name':0x1}}]);_0x41149d[_0x35f4b2(0x1c1)](0xc8)[_0x35f4b2(0x1c6)](_0x3044a6);}catch(_0x39610c){_0x41149d[_0x35f4b2(0x1c1)](0x190)[_0x35f4b2(0x1c6)]({'errorMessage':_0x39610c[_0x35f4b2(0x1bc)]});}}),router['post'](a0_0x5065aa(0x18d),async(_0xa839c8,_0x30e442)=>{const _0x5b1bbb=a0_0x5065aa;try{const {typeofsales:_0x14069b}=_0xa839c8['body'];var _0xde8f82;_0x14069b=='1'&&(_0xde8f82=await staff[_0x5b1bbb(0x1b7)]({'account_category':'sa','type_of_acc_cat':_0x14069b})),_0x30e442[_0x5b1bbb(0x1c1)](0xc8)[_0x5b1bbb(0x1c6)](_0xde8f82);}catch(_0x4905db){_0x30e442[_0x5b1bbb(0x1c1)](0x190)[_0x5b1bbb(0x1c6)]({'errorMessage':_0x4905db[_0x5b1bbb(0x1bc)]});}}),router[a0_0x5065aa(0x1b8)](a0_0x5065aa(0x185),async(_0x3c1e8d,_0x30c91e)=>{const _0x2fb09f=a0_0x5065aa;try{const {id:_0x191c3f}=_0x3c1e8d[_0x2fb09f(0x19e)],_0x80a55a=await staff[_0x2fb09f(0x1b7)]({'_id':_0x191c3f});_0x30c91e[_0x2fb09f(0x1c1)](0xc8)['json'](_0x80a55a);}catch(_0x53fdb6){_0x30c91e[_0x2fb09f(0x1c1)](0x190)[_0x2fb09f(0x1c6)]({'errorMessage':_0x53fdb6[_0x2fb09f(0x1bc)]});}}),router[a0_0x5065aa(0x1b8)](a0_0x5065aa(0x197),async(_0x589dab,_0xf4164a)=>{const _0x59e1ab=a0_0x5065aa;try{const {warehouse_name:_0x1c4dc9,room_value:_0x6c812}=_0x589dab['body'];let _0x580bd5;_0x6c812==_0x59e1ab(0x1b5)?_0x580bd5=await warehouse[_0x59e1ab(0x19f)]([{'$unwind':_0x59e1ab(0x182)},{'$match':{'name':_0x1c4dc9}},{'$group':{'_id':{'bay':_0x59e1ab(0x199),'level':_0x59e1ab(0x18c),'type':_0x59e1ab(0x1bf),'floorlevel':_0x59e1ab(0x1b6)},'products':{'$push':{'product_name':'$product_details.product_name','product_quantity':'$product_details.product_stock','product_code':_0x59e1ab(0x1b9)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x59e1ab(0x1c4),0x0]},'then':'$product_details.product_stock','else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x59e1ab(0x194),'level':_0x59e1ab(0x19d),'type':_0x59e1ab(0x1c2),'floorlevel':_0x59e1ab(0x1b2),'products':{'$filter':{'input':_0x59e1ab(0x1a1),'as':_0x59e1ab(0x18e),'cond':{'$gt':[_0x59e1ab(0x1ca),0x0]}}},'totalQuantity':0x1}}]):_0x580bd5=await warehouse[_0x59e1ab(0x19f)]([{'$unwind':_0x59e1ab(0x182)},{'$match':{'name':_0x1c4dc9,'room':_0x6c812}},{'$group':{'_id':{'bay':_0x59e1ab(0x199),'level':'$product_details.level','type':_0x59e1ab(0x1bf),'floorlevel':_0x59e1ab(0x1b6)},'products':{'$push':{'product_name':_0x59e1ab(0x188),'product_quantity':_0x59e1ab(0x1c4),'product_code':'$product_details.product_code'}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x59e1ab(0x1c4),0x0]},'then':'$product_details.product_stock','else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x59e1ab(0x194),'level':_0x59e1ab(0x19d),'type':'$_id.type','floorlevel':_0x59e1ab(0x1b2),'products':{'$filter':{'input':_0x59e1ab(0x1a1),'as':'product','cond':{'$gt':['$$product.product_quantity',0x0]}}},'totalQuantity':0x1}}]),_0xf4164a['status'](0xc8)[_0x59e1ab(0x1c6)](_0x580bd5);}catch(_0x44527e){_0xf4164a[_0x59e1ab(0x1c1)](0x190)['json']({'errorMessage':_0x44527e[_0x59e1ab(0x1bc)]});}}),module[a0_0x5065aa(0x184)]=router;